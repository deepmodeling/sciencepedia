{"hands_on_practices": [{"introduction": "The dissociation constant, $K_d$, provides a crucial measure of binding affinity, but its true power is revealed when connected to the fundamental thermodynamics of the interaction. This practice guides you through the conversion of an experimentally determined $K_d$ into the standard Gibbs free energy change, $\\Delta G^\\circ$, which quantifies the stability of the protein-ligand complex in energetic terms. Mastering this calculation requires careful attention to the definition of the thermodynamic standard state, a concept critical for ensuring consistency and comparability across different molecular systems [@problem_id:2544421].", "problem": "A monovalent ligand binds a single site on a protein via the association reaction $P + L \\to PL$ in aqueous buffer at temperature $T = 298\\ \\mathrm{K}$. Under these conditions, activity coefficients are approximately unity, so that activities can be taken as concentrations scaled by the standard concentration. The experimentally determined dissociation constant is $K_d = 10\\ \\mathrm{nM}$. Adopt the conventional standard state for solutes $c^\\circ = 1\\ \\mathrm{M}$. Using only fundamental thermodynamic definitions, compute the standard Gibbs free energy change $\\Delta G^\\circ$ for the association reaction. Express the final result in $\\mathrm{kcal\\ mol^{-1}}$. Use $R = 1.987204 \\times 10^{-3}\\ \\mathrm{kcal\\ mol^{-1}\\ K^{-1}}$. Round your answer to three significant figures.", "solution": "The problem as stated is valid. It is scientifically grounded, well-posed, and contains sufficient information for a unique solution. We will proceed with the calculation.\n\nThe fundamental relationship between the standard Gibbs free energy change, $\\Delta G^\\circ$, and the dimensionless thermodynamic equilibrium constant, $K_{eq}$, for a reaction at constant temperature $T$ is given by:\n$$ \\Delta G^\\circ = -RT \\ln K_{eq} $$\nHere, $R$ is the ideal gas constant. The problem asks for $\\Delta G^\\circ$ for the association reaction:\n$$ P + L \\rightleftharpoons PL $$\nTherefore, $K_{eq}$ must be the thermodynamic equilibrium constant for this association process, which we will denote as $K_{eq, a}$.\n\nThe thermodynamic equilibrium constant must be a dimensionless quantity, defined in terms of the activities, $a_i$, of the species involved. For the association reaction, this is:\n$$ K_{eq, a} = \\frac{a_{PL}}{a_P a_L} $$\nThe problem states that for solutes in aqueous solution, activities can be approximated by their molar concentrations, $[C_i]$, scaled by the standard concentration, $c^\\circ = 1\\ \\mathrm{M}$. Thus, $a_i = \\frac{[C_i]}{c^\\circ}$. Substituting this into the expression for $K_{eq, a}$:\n$$ K_{eq, a} = \\frac{[PL]/c^\\circ}{([P]/c^\\circ)([L]/c^\\circ)} = \\frac{[PL]}{[P][L]} c^\\circ $$\nThe term $\\frac{[PL]}{[P][L]}$ is the concentration-based association constant, $K_a$. So, we have:\n$$ K_{eq, a} = K_a c^\\circ $$\n\nThe problem provides the dissociation constant, $K_d$, for the reverse reaction, $PL \\rightleftharpoons P + L$. The concentration-based dissociation constant is defined as:\n$$ K_d = \\frac{[P][L]}{[PL]} $$\nIt is evident from the definitions that the association and dissociation constants are reciprocals of each other:\n$$ K_a = \\frac{1}{K_d} $$\nSubstituting this into our expression for $K_{eq, a}$ gives:\n$$ K_{eq, a} = \\frac{c^\\circ}{K_d} $$\n\nWe are given the following values:\n$K_d = 10\\ \\mathrm{nM}$\n$c^\\circ = 1\\ \\mathrm{M}$\n$T = 298\\ \\mathrm{K}$\n$R = 1.987204 \\times 10^{-3}\\ \\mathrm{kcal\\ mol^{-1}\\ K^{-1}}$\n\nFirst, we must express $K_d$ and $c^\\circ$ in consistent units. The standard unit for concentration in this context is Molarity ($\\mathrm{M}$).\n$K_d = 10\\ \\mathrm{nM} = 10 \\times 10^{-9}\\ \\mathrm{M} = 1 \\times 10^{-8}\\ \\mathrm{M}$.\nThe standard concentration is $c^\\circ = 1\\ \\mathrm{M}$.\n\nNow, we calculate the dimensionless thermodynamic association constant, $K_{eq, a}$:\n$$ K_{eq, a} = \\frac{1\\ \\mathrm{M}}{1 \\times 10^{-8}\\ \\mathrm{M}} = 1 \\times 10^8 $$\nThis value is dimensionless, as required for the Gibbs free energy equation.\n\nWe can now compute the standard Gibbs free energy change for association:\n$$ \\Delta G^\\circ = -RT \\ln(1 \\times 10^8) $$\nSubstituting the numerical values for $R$ and $T$:\n$$ \\Delta G^\\circ = -(1.987204 \\times 10^{-3}\\ \\mathrm{kcal\\ mol^{-1}\\ K^{-1}}) \\times (298\\ \\mathrm{K}) \\times \\ln(10^8) $$\nLet's first calculate the product $RT$:\n$$ RT = (1.987204 \\times 10^{-3}) \\times 298\\ \\mathrm{kcal\\ mol^{-1}} \\approx 0.5921868\\ \\mathrm{kcal\\ mol^{-1}} $$\nAnd the natural logarithm:\n$$ \\ln(10^8) = 8 \\ln(10) \\approx 8 \\times 2.302585 = 18.42068 $$\nNow, we compute $\\Delta G^\\circ$:\n$$ \\Delta G^\\circ \\approx - (0.5921868\\ \\mathrm{kcal\\ mol^{-1}}) \\times (18.42068) $$\n$$ \\Delta G^\\circ \\approx -10.9085\\ \\mathrm{kcal\\ mol^{-1}} $$\nThe problem requires the answer to be rounded to three significant figures.\n$$ \\Delta G^\\circ = -10.9\\ \\mathrm{kcal\\ mol^{-1}} $$", "answer": "$$\\boxed{-10.9}$$", "id": "2544421"}, {"introduction": "While the simple hyperbolic binding isotherm is a cornerstone of biochemistry, its validity rests on the assumption that the concentration of free ligand is not significantly depleted by binding. This practice explores the more general—and more realistic—scenario where this assumption does not hold, a common situation in tight-binding systems or when protein concentrations are high. By deriving and applying the exact quadratic binding equation, you will learn to accurately model these conditions and understand the limitations of simpler approximations [@problem_id:2544387].", "problem": "A single-site reversible binding between a protein and a ligand, $P + L \\rightleftharpoons PL$, is studied under conditions where the total protein concentration is $P_t = 100\\ \\mathrm{nM}$, the total ligand concentration is $L_t = 1\\ \\mathrm{\\mu M}$, and the dissociation constant is $K_d = 200\\ \\mathrm{nM}$. Starting only from the law of mass action for reversible binding and the conservation of mass for each species, derive the algebraic equation for the equilibrium complex concentration $[PL]$ and solve it exactly. Then, obtain the hyperbolic approximation by treating the free ligand as equal to the total ligand and compute the approximate $[PL]$ under this assumption. Finally, quantify the comparison by reporting the absolute fractional deviation between the hyperbolic approximation and the exact solution, defined as\n$$\n\\frac{\\left|[PL]_{\\mathrm{hyp}} - [PL]_{\\mathrm{exact}}\\right|}{[PL]_{\\mathrm{exact}}},\n$$\nas a pure number. Perform all calculations using nanomolar units for concentrations. Round your final reported number to four significant figures and express it as a decimal with no unit.", "solution": "The problem is subjected to validation and is found to be scientifically grounded, well-posed, and objective. It presents a standard exercise in quantitative biochemistry, involving the derivation and solution of binding equilibrium equations. The provided data are consistent and realistic. Therefore, a solution will be presented.\n\nThe reversible, single-site binding of a protein ($P$) and a ligand ($L$) to form a complex ($PL$) is described by the equilibrium:\n$$ P + L \\rightleftharpoons PL $$\nThis system is governed by three fundamental relationships at equilibrium.\n\nFirst, the law of mass action defines the dissociation constant, $K_d$:\n$$ K_d = \\frac{[P][L]}{[PL]} $$\nwhere $[P]$, $[L]$, and $[PL]$ are the equilibrium concentrations of free protein, free ligand, and protein-ligand complex, respectively.\n\nSecond, the conservation of mass for the protein requires that the total protein concentration, $[P]_t$, is the sum of the free protein and the bound protein:\n$$ [P]_t = [P] + [PL] $$\n\nThird, the conservation of mass for the ligand analogously requires that the total ligand concentration, $[L]_t$, is the sum of the free ligand and the bound ligand:\n$$ [L]_t = [L] + [PL] $$\n\nTo find the exact concentration of the complex, $[PL]$, we must solve this system of equations. Let us denote the unknown variable $[PL]$ as $x$. Using the conservation laws, we can express the free concentrations $[P]$ and $[L]$ in terms of $x$ and the total concentrations:\n$$ [P] = [P]_t - x $$\n$$ [L] = [L]_t - x $$\nSubstituting these expressions into the equation for $K_d$:\n$$ K_d = \\frac{([P]_t - x)([L]_t - x)}{x} $$\nThis equation can be rearranged into a quadratic form, $ax^2 + bx + c = 0$.\n$$ K_d x = ([P]_t - x)([L]_t - x) $$\n$$ K_d x = [P]_t[L]_t - [P]_t x - [L]_t x + x^2 $$\n$$ x^2 - ([P]_t + [L]_t + K_d)x + [P]_t[L]_t = 0 $$\nThis is the exact algebraic equation for the equilibrium complex concentration $x = [PL]$.\n\nWe are given the following values: $[P]_t = 100\\ \\mathrm{nM}$, $[L]_t = 1\\ \\mathrm{\\mu M} = 1000\\ \\mathrm{nM}$, and $K_d = 200\\ \\mathrm{nM}$. For calculation, we use these values as pure numbers, with the understanding that the unit of concentration is nanomolar ($nM$).\n$$ [P]_t = 100 $$\n$$ [L]_t = 1000 $$\n$$ K_d = 200 $$\nSubstituting these values into the quadratic equation:\n$$ x^2 - (100 + 1000 + 200)x + (100)(1000) = 0 $$\n$$ x^2 - 1300x + 100000 = 0 $$\nWe solve for $x$ using the quadratic formula, $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$ x = \\frac{1300 \\pm \\sqrt{(-1300)^2 - 4(1)(100000)}}{2} $$\n$$ x = \\frac{1300 \\pm \\sqrt{1690000 - 400000}}{2} $$\n$$ x = \\frac{1300 \\pm \\sqrt{1290000}}{2} $$\n$$ x = \\frac{1300 \\pm 100\\sqrt{129}}{2} = 650 \\pm 50\\sqrt{129} $$\nThe two possible solutions are:\n$$ x_1 = 650 + 50\\sqrt{129} \\approx 650 + 50(11.358) \\approx 1217.9 $$\n$$ x_2 = 650 - 50\\sqrt{129} \\approx 650 - 50(11.358) \\approx 82.1 $$\nThe concentration of the complex, $x = [PL]$, cannot exceed the total concentration of the limiting binding partner, which is the protein ($[P]_t = 100$). Therefore, the solution $x_1$ is physically impossible. The correct, exact solution is $x_2$.\n$$ [PL]_{\\mathrm{exact}} = 650 - 50\\sqrt{129} \\approx 82.1091886\\ \\mathrm{nM} $$\n\nNext, we evaluate the hyperbolic approximation. This approximation is valid when the total ligand concentration is much greater than the total protein concentration ($[L]_t \\gg [P]_t$), which allows us to assume that the free ligand concentration is approximately equal to the total ligand concentration ($[L] \\approx [L]_t$). This simplifies the binding equation significantly.\nThe fraction of bound protein is $\\theta = \\frac{[PL]}{[P]_t} = \\frac{[L]}{K_d + [L]}$.\nThus, $[PL] = [P]_t \\frac{[L]}{K_d + [L]}$.\nApplying the approximation $[L] \\approx [L]_t$:\n$$ [PL]_{\\mathrm{hyp}} = [P]_t \\frac{[L]_t}{K_d + [L]_t} $$\nSubstituting the given values:\n$$ [PL]_{\\mathrm{hyp}} = 100 \\times \\frac{1000}{200 + 1000} = 100 \\times \\frac{1000}{1200} = 100 \\times \\frac{5}{6} = \\frac{250}{3} $$\n$$ [PL]_{\\mathrm{hyp}} \\approx 83.3333333\\ \\mathrm{nM} $$\n\nFinally, we compute the absolute fractional deviation between the hyperbolic approximation and the exact solution:\n$$ \\text{Deviation} = \\frac{\\left|[PL]_{\\mathrm{hyp}} - [PL]_{\\mathrm{exact}}\\right|}{[PL]_{\\mathrm{exact}}} $$\n$$ \\text{Deviation} = \\frac{\\left|\\frac{250}{3} - (650 - 50\\sqrt{129})\\right|}{650 - 50\\sqrt{129}} $$\nUsing the calculated numerical values:\n$$ \\text{Deviation} = \\frac{|83.3333333... - 82.1091886...|}{82.1091886...} $$\n$$ \\text{Deviation} = \\frac{1.2241447...}{82.1091886...} \\approx 0.0149086 $$\nRounding this final result to four significant figures gives $0.01491$.", "answer": "$$\\boxed{0.01491}$$", "id": "2544387"}, {"introduction": "Modern biophysical experiments often generate complex datasets, such as spectroscopic titrations measured at multiple wavelengths. This advanced practice challenges you to develop and implement a global fitting model, a powerful technique used to analyze such data by simultaneously accounting for all observations to extract a single, robust value for the dissociation constant, $K_d$. You will learn to distinguish between global parameters like $K_d$ that describe the underlying physical chemistry and local, nuisance parameters that describe the instrument response, a fundamental principle in rigorous data modeling [@problem_id:2544408].", "problem": "You are asked to implement and apply a global nonlinear fit for multiwavelength spectroscopic titration data under a single reversible 1:1 binding equilibrium, where multiple detection wavelengths share a common dissociation constant $K_d$ but have distinct spectral baselines and amplitudes. You must start from the defining law of mass action $K_d = \\dfrac{[P][L]}{[PL]}$ and the mass-conservation constraints, and derive the model that maps the total ligand concentration $L_t$ and the total protein concentration $P_t$ to the fraction of protein that is ligand-bound. Using this derived relationship, formulate a global fitting problem where $K_d$ is shared across all wavelengths, while each wavelength $i$ has independent linear baseline parameters and an independent binding-linked amplitude. The fitted $K_d$ must be reported in molar units (M). You must justify, using first principles, why $K_d$ must be shared while baseline and amplitude parameters must be wavelength-specific.\n\nYour program must implement the following requirements:\n\n- Begin from the fundamental definition of dissociation constant $K_d$ and mass conservation to derive a closed-form expression for the bound complex concentration and thus the fraction bound as a function of $L_t$, $P_t$, and $K_d$. You must not assume any pre-derived expression without a derivation.\n- Construct a global spectral model at each wavelength $i$ for an observable $y_{i}(L_t)$ that is the sum of a linear baseline in $L_t$ and a binding-linked contribution proportional to the fraction bound. The shared $K_d$ must be a single scalar that applies to all wavelengths in a given experiment, while each wavelength $i$ must have its own independent baseline offset, baseline slope, and amplitude.\n- Implement a numerical estimation procedure that minimizes the total sum of squared residuals across all wavelengths and all titration points. Ensure that $K_d$ is constrained to be positive by a suitable parameterization choice. You may use any robust nonlinear least squares or separated (separable) least squares strategy consistent with the above model.\n\nData generation for testing must be internal to your program and must use the following test suite. For each test case, synthesize multiwavelength titration data using the stated “true” parameters and independent identically distributed additive Gaussian noise with standard deviation $\\sigma$ (in the same arbitrary absorbance units as $y$). Then perform the global fit and return the fitted $K_d$ for that test case.\n\n- Test Case $1$ (moderate binding, moderate noise):\n  - $P_t = 5{\\times}10^{-6}\\ \\text{M}$,\n  - $K_d^{\\text{true}} = 2{\\times}10^{-6}\\ \\text{M}$,\n  - $L_t$ values: linearly spaced from $0$ to $1.2{\\times}10^{-5}\\ \\text{M}$ inclusive with $13$ points,\n  - Number of wavelengths $n_\\lambda = 4$,\n  - Amplitudes $\\alpha = [\\,0.06,\\ 0.04,\\ 0.03,\\ 0.05\\,]$,\n  - Baseline offsets $\\beta_0 = [\\,0.15,\\ 0.22,\\ 0.10,\\ 0.30\\,]$,\n  - Baseline slopes $\\beta_1 = [\\,3{\\times}10^{3},\\ 5{\\times}10^{3},\\ 2{\\times}10^{3},\\ 4{\\times}10^{3}\\,]\\ \\text{M}^{-1}$,\n  - Noise $\\sigma = 5{\\times}10^{-4}$,\n  - Random seed $= 123$.\n\n- Test Case $2$ (weak binding, higher ligand range, higher noise):\n  - $P_t = 5{\\times}10^{-6}\\ \\text{M}$,\n  - $K_d^{\\text{true}} = 5{\\times}10^{-5}\\ \\text{M}$,\n  - $L_t$ values: linearly spaced from $0$ to $2.0{\\times}10^{-4}\\ \\text{M}$ inclusive with $16$ points,\n  - Number of wavelengths $n_\\lambda = 3$,\n  - Amplitudes $\\alpha = [\\,0.05,\\ 0.03,\\ 0.02\\,]$,\n  - Baseline offsets $\\beta_0 = [\\,0.12,\\ 0.18,\\ 0.09\\,]$,\n  - Baseline slopes $\\beta_1 = [\\,2{\\times}10^{3},\\ 4{\\times}10^{3},\\ 3{\\times}10^{3}\\,]\\ \\text{M}^{-1}$,\n  - Noise $\\sigma = 1{\\times}10^{-3}$,\n  - Random seed $= 456$.\n\n- Test Case $3$ (tight binding, near-stoichiometric regime, low noise):\n  - $P_t = 1{\\times}10^{-6}\\ \\text{M}$,\n  - $K_d^{\\text{true}} = 2{\\times}10^{-8}\\ \\text{M}$,\n  - $L_t$ values: linearly spaced from $0$ to $3.0{\\times}10^{-6}\\ \\text{M}$ inclusive with $13$ points,\n  - Number of wavelengths $n_\\lambda = 5$,\n  - Amplitudes $\\alpha = [\\,0.04,\\ 0.06,\\ 0.05,\\ 0.03,\\ 0.07\\,]$,\n  - Baseline offsets $\\beta_0 = [\\,0.20,\\ 0.25,\\ 0.18,\\ 0.22,\\ 0.15\\,]$,\n  - Baseline slopes $\\beta_1 = [\\,1.0{\\times}10^{3},\\ 2.5{\\times}10^{3},\\ 1.5{\\times}10^{3},\\ 2.0{\\times}10^{3},\\ 3.0{\\times}10^{3}\\,]\\ \\text{M}^{-1}$,\n  - Noise $\\sigma = 5{\\times}10^{-4}$,\n  - Random seed $= 789$.\n\n- Test Case $4$ (moderate binding, strong baseline variations, higher noise):\n  - $P_t = 2{\\times}10^{-6}\\ \\text{M}$,\n  - $K_d^{\\text{true}} = 1{\\times}10^{-6}\\ \\text{M}$,\n  - $L_t$ values: linearly spaced from $0$ to $1.0{\\times}10^{-5}\\ \\text{M}$ inclusive with $21$ points,\n  - Number of wavelengths $n_\\lambda = 4$,\n  - Amplitudes $\\alpha = [\\,0.02,\\ 0.05,\\ 0.03,\\ 0.04\\,]$,\n  - Baseline offsets $\\beta_0 = [\\,0.10,\\ 0.28,\\ 0.16,\\ 0.22\\,]$,\n  - Baseline slopes $\\beta_1 = [\\,8{\\times}10^{3},\\ 1{\\times}10^{4},\\ 6{\\times}10^{3},\\ 9{\\times}10^{3}\\,]\\ \\text{M}^{-1}$,\n  - Noise $\\sigma = 2{\\times}10^{-3}$,\n  - Random seed $= 321$.\n\nIn all cases, simulate the noiseless signal at wavelength $i$ as\n$$\ny_i(L_t) = \\beta_{0,i} + \\beta_{1,i}\\,L_t + \\alpha_i\\,f_b(L_t; P_t, K_d^{\\text{true}}),\n$$\nthen add independent Gaussian noise with standard deviation $\\sigma$.\n\nYour program must finally estimate the globally shared $K_d$ for each test case from the noisy data. Express each estimated $K_d$ in $\\text{M}$ (molar) units. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each result is the fitted $K_d$ for the corresponding test case in the order listed above. Each result must be a floating-point number.\n\nAnswer solely with the required single-line output produced by your program when it is run, with no additional text.", "solution": "The problem requires the derivation and implementation of a global nonlinear fitting procedure for multi-wavelength spectroscopic titration data corresponding to a 1:1 binding equilibrium. The analysis must be grounded in first principles, starting from the law of mass action.\n\nFirst, we must justify the fundamental distinction between global and local parameters in the model. The dissociation constant, $K_d$, represents a thermodynamic property of the molecular system, specifically the equilibrium between the free protein ($P$), the free ligand ($L$), and the protein-ligand complex ($PL$). This equilibrium is governed by the change in Gibbs free energy for the binding reaction under specified conditions of temperature, pressure, and solvent composition. As a thermodynamic constant, $K_d$ is an intrinsic property of the interacting pair and is independent of the observational method. Consequently, its value must be the same regardless of which wavelength is used for detection. Therefore, in a global analysis of multi-wavelength data from a single experiment, $K_d$ is correctly treated as a single, shared (global) parameter. In contrast, the spectroscopic parameters are inherently wavelength-dependent. The observed signal, for example, absorbance, is a function of the concentrations and molar extinction coefficients of all species present. The baseline signal, modeled here with an offset $\\beta_{0,i}$ and a linear slope $\\beta_{1,i}$, accounts for contributions from the buffer and any unbound species whose concentrations change during the titration (primarily the ligand). These contributions are determined by the extinction coefficients of these components at wavelength $i$, which vary with wavelength. The binding-induced signal amplitude, $\\alpha_i$, is proportional to the change in the spectroscopic property upon complex formation. For absorbance, $\\alpha_i$ is proportional to $(\\epsilon_{PL,i} - \\epsilon_{P,i}) \\cdot P_t$, where $\\epsilon_{X,i}$ is the molar extinction coefficient of species $X$ at wavelength $i$. Since extinction coefficients are functions of wavelength, the parameters $\\beta_{0,i}$, $\\beta_{1,i}$, and $\\alpha_i$ must be treated as independent, wavelength-specific (local) parameters.\n\nThe core of the model is the fraction of bound protein, $f_b$, as a function of the total protein concentration, $P_t$, and total ligand concentration, $L_t$. We derive this from first principles. The binding equilibrium is $P + L \\rightleftharpoons PL$. The dissociation constant is defined by the law of mass action:\n$$\nK_d = \\frac{[P][L]}{[PL]}\n$$\nThe total concentrations are conserved, providing two additional constraints:\n$$\nP_t = [P] + [PL] \\quad \\implies \\quad [P] = P_t - [PL]\n$$\n$$\nL_t = [L] + [PL] \\quad \\implies \\quad [L] = L_t - [PL]\n$$\nSubstituting the expressions for the free concentrations $[P]$ and $[L]$ into the $K_d$ equation yields:\n$$\nK_d = \\frac{(P_t - [PL])(L_t - [PL])}{[PL]}\n$$\nRearranging this equation gives a quadratic equation for the unknown concentration of the complex, $[PL]$:\n$$\nK_d [PL] = P_t L_t - P_t [PL] - L_t [PL] + [PL]^2\n$$\n$$\n[PL]^2 - (P_t + L_t + K_d)[PL] + P_t L_t = 0\n$$\nThis is a standard quadratic equation of the form $ax^2 + bx + c = 0$, with $x = [PL]$, $a=1$, $b=-(P_t + L_t + K_d)$, and $c=P_t L_t$. Applying the quadratic formula, $x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$, we obtain the two mathematical solutions for $[PL]$:\n$$\n[PL] = \\frac{(P_t + L_t + K_d) \\pm \\sqrt{(P_t + L_t + K_d)^2 - 4 P_t L_t}}{2}\n$$\nTo select the physically meaningful root, we consider that the concentration of the complex, $[PL]$, cannot exceed the total concentration of either reactant, $P_t$ or $L_t$. The solution with the plus sign would lead to a value for $[PL]$ that can exceed $P_t + L_t$, which is physically impossible. Therefore, the correct physical solution is the one with the minus sign:\n$$\n[PL](L_t; P_t, K_d) = \\frac{(P_t + L_t + K_d) - \\sqrt{(P_t + L_t + K_d)^2 - 4 P_t L_t}}{2}\n$$\nThe fraction of bound protein, $f_b$, is then obtained by dividing $[PL]$ by the total protein concentration $P_t$:\n$$\nf_b(L_t; P_t, K_d) = \\frac{[PL]}{P_t} = \\frac{(P_t + L_t + K_d) - \\sqrt{(P_t + L_t + K_d)^2 - 4 P_t L_t}}{2 P_t}\n$$\nThis is the general binding isotherm for a 1:1 interaction, often referred to as the Morrison equation. It is valid across all binding regimes, from weak ($K_d \\gg P_t$) to tight ($K_d \\lesssim P_t$).\n\nThe global fitting problem aims to find the set of parameters $(K_d, \\{\\alpha_i, \\beta_{0,i}, \\beta_{1,i}\\}_{i=1}^{n_\\lambda})$ that best describes the observed data across all $n_\\lambda$ wavelengths. The model for the signal $y_{i,j}$ at wavelength $i$ and ligand concentration point $j$ is:\n$$\ny_{i,j}^{\\text{model}} = \\beta_{0,i} + \\beta_{1,i} L_{t,j} + \\alpha_i f_b(L_{t,j}; P_t, K_d)\n$$\nThe objective is to minimize the total sum of squared residuals (SSR), $\\chi^2$, between the observed data $y_{i,j}^{\\text{obs}}$ and the model predictions:\n$$\n\\chi^2(K_d, \\{\\alpha_i, \\beta_{0,i}, \\beta_{1,i}\\}) = \\sum_{i=1}^{n_\\lambda} \\sum_{j=1}^{n_{\\text{points}}} (y_{i,j}^{\\text{obs}} - y_{i,j}^{\\text{model}})^2\n$$\nThis is a nonlinear least-squares problem due to the nonlinear dependence on $K_d$. However, for any fixed value of $K_d$, the model is linear with respect to the local parameters $\\alpha_i$, $\\beta_{0,i}$, and $\\beta_{1,i}$. This structure allows for a more robust and efficient solution using a separable least-squares (or variable projection) approach. The procedure is as follows:\n$1$. The optimization is performed with respect to the single nonlinear parameter, $K_d$. To enforce the physical constraint $K_d > 0$, we reparameterize and optimize over $p = \\log_{10}(K_d)$, so $K_d = 10^p$.\n$2$. For a given value of $p$ (and thus $K_d$), we compute the vector of bound fractions, $\\vec{f_b}$, for all ligand concentrations $L_{t,j}$.\n$3$. The problem decouples by wavelength. For each wavelength $i$, we solve a linear least-squares problem to find the optimal local parameters $(\\beta_{0,i}, \\beta_{1,i}, \\alpha_i)$. This is done by constructing a design matrix $M_i$ whose columns are the basis functions: a vector of ones, the vector of ligand concentrations $\\vec{L_t}$, and the vector $\\vec{f_b}$. The linear problem to solve is $\\vec{y}_{i}^{\\text{obs}} \\approx M_i \\cdot [\\beta_{0,i}, \\beta_{1,i}, \\alpha_i]^T$. The solution yields the optimal linear parameters for that specific $K_d$.\n$4$. With these optimal linear parameters, we calculate the sum of squared residuals for each wavelength. The sum of these values across all wavelengths gives the total SSR, which is a function of only the chosen $K_d$.\n$5$. A one-dimensional numerical optimizer is used to find the value of $p$ (and thus $K_d$) that minimizes this total SSR. This yields the globally optimal estimate for the dissociation constant.\nThis method correctly couples the datasets through the shared physical parameter $K_d$ while allowing for independent spectroscopic variations at each wavelength, resulting in a robust and accurate determination of binding affinity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Main function to run the global fitting simulation for all test cases.\n    \"\"\"\n    \n    test_cases = [\n        # Test Case 1: moderate binding, moderate noise\n        {\n            \"Pt\": 5e-6, \"Kd_true\": 2e-6,\n            \"Lt_range\": (0, 1.2e-5), \"n_points\": 13,\n            \"n_lambda\": 4,\n            \"alpha\": np.array([0.06, 0.04, 0.03, 0.05]),\n            \"beta0\": np.array([0.15, 0.22, 0.10, 0.30]),\n            \"beta1\": np.array([3e3, 5e3, 2e3, 4e3]),\n            \"sigma\": 5e-4, \"seed\": 123\n        },\n        # Test Case 2: weak binding, higher ligand range, higher noise\n        {\n            \"Pt\": 5e-6, \"Kd_true\": 5e-5,\n            \"Lt_range\": (0, 2.0e-4), \"n_points\": 16,\n            \"n_lambda\": 3,\n            \"alpha\": np.array([0.05, 0.03, 0.02]),\n            \"beta0\": np.array([0.12, 0.18, 0.09]),\n            \"beta1\": np.array([2e3, 4e3, 3e3]),\n            \"sigma\": 1e-3, \"seed\": 456\n        },\n        # Test Case 3: tight binding, near-stoichiometric regime, low noise\n        {\n            \"Pt\": 1e-6, \"Kd_true\": 2e-8,\n            \"Lt_range\": (0, 3.0e-6), \"n_points\": 13,\n            \"n_lambda\": 5,\n            \"alpha\": np.array([0.04, 0.06, 0.05, 0.03, 0.07]),\n            \"beta0\": np.array([0.20, 0.25, 0.18, 0.22, 0.15]),\n            \"beta1\": np.array([1.0e3, 2.5e3, 1.5e3, 2.0e3, 3.0e3]),\n            \"sigma\": 5e-4, \"seed\": 789\n        },\n        # Test Case 4: moderate binding, strong baseline variations, higher noise\n        {\n            \"Pt\": 2e-6, \"Kd_true\": 1e-6,\n            \"Lt_range\": (0, 1.0e-5), \"n_points\": 21,\n            \"n_lambda\": 4,\n            \"alpha\": np.array([0.02, 0.05, 0.03, 0.04]),\n            \"beta0\": np.array([0.10, 0.28, 0.16, 0.22]),\n            \"beta1\": np.array([8e3, 1e4, 6e3, 9e3]),\n            \"sigma\": 2e-3, \"seed\": 321\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Generate synthetic data\n        Pt = case[\"Pt\"]\n        Kd_true = case[\"Kd_true\"]\n        Lt = np.linspace(case[\"Lt_range\"][0], case[\"Lt_range\"][1], case[\"n_points\"])\n        \n        fb_true = calculate_fb(Lt, Pt, Kd_true)\n        \n        Y_noiseless = np.zeros((case[\"n_lambda\"], case[\"n_points\"]))\n        for i in range(case[\"n_lambda\"]):\n            Y_noiseless[i, :] = case[\"beta0\"][i] + case[\"beta1\"][i] * Lt + case[\"alpha\"][i] * fb_true\n            \n        rng = np.random.default_rng(case[\"seed\"])\n        noise = rng.normal(0, case[\"sigma\"], size=Y_noiseless.shape)\n        Y_noisy = Y_noiseless + noise\n        \n        # Perform global fit\n        # The objective function takes log10(Kd) and minimizes the total SSR\n        def objective_function(log10_kd, Y_data, Lt_data, Pt_data):\n            kd = 10**log10_kd\n            \n            # This can happen if Kd is extremely small, leading to numerical issues.\n            if kd  1e-20: return 1e9 \n\n            fb_model = calculate_fb(Lt_data, Pt_data, kd)\n\n            # Design matrix for the linear part, excluding the f_b column which is Kd-dependent\n            M = np.vstack([np.ones_like(Lt_data), Lt_data, fb_model]).T\n            \n            total_ssr = 0\n            # If fb_model contains NaN or Inf, it's an invalid Kd value.\n            if np.any(np.isnan(fb_model)) or np.any(np.isinf(fb_model)):\n                return 1e10 # Return a large number to steer optimizer away\n\n            for i in range(Y_data.shape[0]):\n                y_obs = Y_data[i, :]\n                # For each wavelength, solve the linear problem for the local parameters\n                # np.linalg.lstsq returns the sum of squared residuals as the second element\n                _, residuals, _, _ = np.linalg.lstsq(M, y_obs, rcond=None)\n                \n                # Check if the linear solve was successful\n                if residuals.size > 0:\n                    total_ssr += residuals[0]\n                else: # This happens if the system is perfectly determined or over-determined with exact fit\n                    total_ssr += np.sum((y_obs - M @ np.linalg.lstsq(M, y_obs, rcond=None)[0])**2)\n\n            return total_ssr\n            \n        # Optimize over log10(Kd). Reasonable bounds for biophysical systems.\n        # Kd=1M -> log10_kd=0; Kd=1nM -> log10_kd=-9; Kd=1pM -> log10_kd=-12\n        res = minimize_scalar(\n            objective_function, \n            args=(Y_noisy, Lt, Pt), \n            bounds=(-12, -2), \n            method='bounded'\n        )\n        \n        fitted_log10_kd = res.x\n        fitted_kd = 10**fitted_log10_kd\n        results.append(fitted_kd)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef calculate_fb(Lt, Pt, Kd):\n    \"\"\"\n    Calculates the fraction of bound protein using the quadratic Morrison equation.\n    \n    Args:\n        Lt (np.ndarray): Array of total ligand concentrations.\n        Pt (float): Total protein concentration.\n        Kd (float): Dissociation constant.\n        \n    Returns:\n        np.ndarray: Array of fraction of bound protein.\n    \"\"\"\n    # Numerically stable calculation of [PL] using the quadratic solution\n    # [PL] = ( (Pt + Lt + Kd) - sqrt((Pt + Lt + Kd)^2 - 4*Pt*Lt) ) / 2\n    b = Pt + Lt + Kd\n    # Use np.sqrt on non-negative array. The argument is always non-negative for real concentrations.\n    c = 4 * Pt * Lt\n    # Guard against potential negative values in sqrt due to float precision\n    sqrt_discriminant = np.sqrt(np.maximum(0, b**2 - c))\n    \n    PL = 0.5 * (b - sqrt_discriminant)\n    \n    # Avoid division by zero if Pt = 0 (though not expected here)\n    if Pt > 0:\n        return PL / Pt\n    else:\n        return np.zeros_like(Lt)\n\nsolve()\n```", "id": "2544408"}]}