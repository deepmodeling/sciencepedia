{"hands_on_practices": [{"introduction": "To quantitatively understand cellular lineage, we must first model the recording process itself. This initial practice grounds our exploration in first principles by considering a simple, yet powerful, discrete model of molecular recording. By calculating the expected genetic distance between two cells after a set number of divisions, you will build intuition for how microscopic edit events translate into macroscopic, measurable differences that encode history [@problem_id:2751994].", "problem": "A synthetic molecular recorder is engineered into a cell as an array of $L$ independent binary sites, each initialized in an unedited state denoted by $0$. On each cell division, and for each site independently, an edit occurs with probability $p$ if and only if the site is still unedited, and once edited the site irreversibly switches to state $1$ and is faithfully inherited thereafter (no reversion and no further state changes). Two lineages are founded by physically separating the common ancestor at generation $0$ into two isolated cultures (for example, two microdroplets) so that there are no shared divisions after this split. Each lineage then undergoes exactly $g$ rounds of division, yielding terminal cells at generation $g$ in each culture. One terminal cell is sampled from each culture. The pairwise Hamming distance is defined as the number of sites (out of $L$) at which the two sampled cells differ in state.\n\nStarting only from basic probabilistic principles (independence of Bernoulli trials, the complement rule for “at least one” events, and linearity of expectation), derive an analytical expression for the expected pairwise Hamming distance between the two sampled cells as a function of $L$, $p$, and $g$. Express your final answer as a closed-form symbolic expression in terms of $L$, $p$, and $g$. No units are required.", "solution": "The problem statement is critically evaluated and deemed valid. It is scientifically grounded within the context of synthetic biology, well-posed, and contains sufficient information for a unique solution. The key to a consistent interpretation is understanding that the two lineages diverge at generation $0$, and each undergoes an independent path of $g$ divisions. The common ancestor serves only to define the initial all-zero state. The problem asks for the expected pairwise Hamming distance, which can be derived from first principles.\n\nLet $L$ be the number of sites in the array.\nLet $p$ be the probability of an unedited site being edited during a single cell division.\nLet $g$ be the number of divisions each lineage undergoes.\n\nLet us denote the state of the two sampled cells as vectors $C_1 = (X_1, X_2, \\dots, X_L)$ and $C_2 = (Y_1, Y_2, \\dots, Y_L)$, where $X_i, Y_i \\in \\{0, 1\\}$ are the states of the $i$-th site in cell $1$ and cell $2$, respectively. The problem states that all sites are initially in state $0$.\n\nThe pairwise Hamming distance, $H$, is defined as the number of sites at which the two cells differ. Mathematically, this is:\n$$H = \\sum_{i=1}^{L} \\mathbb{I}(X_i \\neq Y_i)$$\nwhere $\\mathbb{I}(\\cdot)$ is the indicator function, which is $1$ if its argument is true and $0$ otherwise.\n\nWe are asked to find the expectation of $H$, denoted $E[H]$. By the linearity of expectation, we can write:\n$$E[H] = E\\left[\\sum_{i=1}^{L} \\mathbb{I}(X_i \\neq Y_i)\\right] = \\sum_{i=1}^{L} E[\\mathbb{I}(X_i \\neq Y_i)]$$\n\nThe expectation of an indicator function is the probability of the event it indicates. Therefore:\n$$E[\\mathbb{I}(X_i \\neq Y_i)] = P(X_i \\neq Y_i)$$\n\nThe problem states that all $L$ sites are independent and operate under identical rules. Thus, the probability $P(X_i \\neq Y_i)$ is the same for all sites $i=1, \\dots, L$. We can therefore simplify the expression for $E[H]$:\n$$E[H] = L \\cdot P(X_1 \\neq Y_1)$$\n\nNow, we must calculate the probability that the states of a single, arbitrary site (say, site $1$) differ between the two cells. Let $X_1$ be its state in cell $1$ and $Y_1$ be its state in cell $2$.\nThe event $X_1 \\neq Y_1$ occurs in two mutually exclusive cases:\n$1$. $X_1 = 1$ and $Y_1 = 0$.\n$2$. $X_1 = 0$ and $Y_1 = 1$.\n\nSo, we have:\n$$P(X_1 \\neq Y_1) = P(X_1=1, Y_1=0) + P(X_1=0, Y_1=1)$$\n\nThe two lineages are founded from a common ancestor at generation $0$ and then evolve in isolated cultures. This means the evolutionary paths of the two sampled cells are independent after the initial state. Therefore, the state of a site in cell $1$ is independent of the state of the same site in cell $2$. We can thus write:\n$$P(X_1 \\neq Y_1) = P(X_1=1)P(Y_1=0) + P(X_1=0)P(Y_1=1)$$\n\nNext, we must find the probability that a single site is in state $0$ or $1$ after $g$ generations. Let $P_0$ be the probability that a site remains in state $0$ after $g$ divisions, and $P_1$ be the probability that it is in state $1$.\n\nA site starts in state $0$. At each division, if it is still in state $0$, it fails to be edited with probability $(1-p)$. For the site to remain in state $0$ after $g$ divisions, it must escape editing in all $g$ independent division events. The probability of this is:\n$$P_0 = P(\\text{site is } 0) = (1-p) \\times (1-p) \\times \\dots \\times (1-p) \\text{ ($g$ times)} = (1-p)^g$$\n\nThe only other possibility is that the site is in state $1$. This is the complementary event to remaining in state $0$. Using the complement rule:\n$$P_1 = P(\\text{site is } 1) = 1 - P(\\text{site is } 0) = 1 - (1-p)^g$$\n\nBy symmetry, the probabilities $P_0$ and $P_1$ are the same for both lineages.\n$P(X_1=0) = P(Y_1=0) = P_0 = (1-p)^g$\n$P(X_1=1) = P(Y_1=1) = P_1 = 1 - (1-p)^g$\n\nSubstituting these probabilities back into the expression for $P(X_1 \\neq Y_1)$:\n$$P(X_1 \\neq Y_1) = P_1 \\cdot P_0 + P_0 \\cdot P_1 = 2 P_0 P_1$$\n$$P(X_1 \\neq Y_1) = 2 \\left( (1-p)^g \\right) \\left( 1 - (1-p)^g \\right)$$\n\nFinally, we substitute this result back into the expression for the expected Hamming distance:\n$$E[H] = L \\cdot P(X_1 \\neq Y_1) = 2L (1-p)^g (1 - (1-p)^g)$$\nThis is the final, closed-form analytical expression derived from the given principles.", "answer": "$$\\boxed{2L(1-p)^g(1 - (1-p)^g)}$$", "id": "2751994"}, {"introduction": "While discrete models are insightful, most biological processes unfold in continuous time. This exercise advances our toolkit by introducing the cornerstone of modern phylogenetics: likelihood-based inference on a tree. You will derive the likelihood of observing specific states in a population of cells under a continuous-time Markov model and then apply this framework to a simplified case to compute the maximum likelihood estimate of the recording rate, connecting theoretical models to data-driven parameter estimation [@problem_id:2752064].", "problem": "A laboratory uses a Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR)-based molecular event recorder to trace cellular lineages. The recorder consists of $L$ independent genomic barcode sites that are initially unedited at the root cell at time $t=0$. Each site is modeled as a two-state continuous-time process with states $\\{0,1\\}$, where $0$ denotes unedited and $1$ denotes irreversibly edited. Along any lineage branch of duration $t$, the transition $0 \\to 1$ occurs according to a Poisson process with constant rate $\\mu$ per site per unit time, and back-mutation $1 \\to 0$ is impossible. The cell lineage forms a rooted tree topology $\\mathcal{T}$ with known branch durations. All sampled leaves are observed at the same final time. The observed data are the leaf states (edited or unedited) for each site.\n\nStarting only from the definitions of a Poisson process and a continuous-time Markov chain, and assuming site independence and identical rates across sites:\n\n- Derive the single-site likelihood of the observed leaf states given the topology $\\mathcal{T}$ and rate $\\mu$, by summing over unobserved ancestral states on internal nodes. Then write the full likelihood for $L$ independent sites.\n\n- Now specialize to the case where $\\mathcal{T}$ is a rooted star topology with $m$ leaves, each branch having the same duration $t$. In this case, for each site, leaves evolve independently from the known root state $0$. Suppose $m=4$, $t=20$ h, and $L=1000$. Across all $mL$ leaf-site pairs, you observed a total of $K=1230$ edited states ($1$) and $mL-K$ unedited states ($0$). Compute the maximum likelihood estimate $\\hat{\\mu}$ for $\\mu$ for this star topology dataset. Express the final rate in h$^{-1}$, and round your answer to four significant figures.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and self-contained. It describes a standard model in molecular evolution applied to the modern context of CRISPR-based event recording. The problem is valid, and a solution will be provided.\n\nThe problem is divided into two parts. First, the derivation of the general likelihood function for a molecular recorder on a tree. Second, the calculation of the maximum likelihood estimate for the recording rate $\\mu$ in a specific experimental scenario.\n\nPart 1: Derivation of the Likelihood Function\n\nThe state of a single barcode site is modeled as a two-state, continuous-time Markov chain with states $\\{0, 1\\}$, representing unedited and edited, respectively. The transition from state $0$ to state $1$ occurs with a constant rate $\\mu$. The reverse transition $1 \\to 0$ is forbidden, making state $1$ an absorbing state. The rate matrix, or generator, $Q$ for this process is:\n$$\nQ = \\begin{pmatrix} -\\mu & \\mu \\\\ 0 & 0 \\end{pmatrix}\n$$\nThe probability transition matrix $P(t)$ over a time interval $t$ is given by the matrix exponential $P(t) = \\exp(Qt)$. The elements $P_{ij}(t)$ give the probability of being in state $j$ at time $t$ given the state was $i$ at time $0$. The solution to the master equation $\\frac{d P(t)}{dt} = P(t)Q$ gives these probabilities. Specifically, for the probability of remaining in state $0$, $P_{00}(t)$:\n$$\n\\frac{d P_{00}(t)}{dt} = -\\mu P_{00}(t)\n$$\nWith the initial condition $P_{00}(0) = 1$, the solution is:\n$$\nP_{00}(t) = \\exp(-\\mu t)\n$$\nThis is the probability of zero editing events occurring in a time interval $t$, consistent with a Poisson process. Since there are only two states, the probability of transitioning from $0$ to $1$ is:\n$$\nP_{01}(t) = 1 - P_{00}(t) = 1 - \\exp(-\\mu t)\n$$\nBecause state $1$ is absorbing, we have:\n$$\nP_{11}(t) = 1\n$$\n$$\nP_{10}(t) = 0\n$$\nNow, consider a single site on a given rooted tree topology $\\mathcal{T}$ with known branch durations. The root cell at time $t=0$ has the site in state $0$. Let the set of leaf nodes be $\\mathcal{L}$ and the set of internal nodes be $\\mathcal{I}$ (including the root, $r$). The observed data for this site is the set of states $D = \\{s_v | v \\in \\mathcal{L}\\}$, where $s_v \\in \\{0, 1\\}$.\n\nThe likelihood of observing the data $D$ given the rate $\\mu$ is the probability $P(D | \\mu, \\mathcal{T})$. This is found by summing over all possible state assignments to the unobserved internal nodes (excluding the root, whose state is fixed at $0$).\nLet $s_{\\mathcal{I} \\setminus \\{r\\}}$ be a specific assignment of states to the internal nodes other than the root. The likelihood for a single site is:\n$$\nL_{\\text{site}}(\\mu) = P(D | s_r=0, \\mu, \\mathcal{T}) = \\sum_{s_{\\mathcal{I} \\setminus \\{r\\}}} P(D, s_{\\mathcal{I} \\setminus \\{r\\}} | s_r=0, \\mu, \\mathcal{T})\n$$\nThe joint probability for a full assignment of states to all nodes in the tree is the product of transition probabilities along each branch. Let $u$ be the parent of node $v$, and $t_{uv}$ be the duration of the branch connecting them.\n$$\nP(D, s_{\\mathcal{I} \\setminus \\{r\\}} | s_r=0, \\mu, \\mathcal{T}) = \\prod_{(u,v) \\in \\text{edges}} P_{s_u s_v}(t_{uv})\n$$\nThe sum can be computed efficiently using a dynamic programming approach, commonly known as Felsenstein's pruning algorithm. One defines a conditional likelihood $L_v(i)$ for each node $v$ and each state $i \\in \\{0, 1\\}$, representing the probability of the observed states in the subtree descending from $v$, given that $v$ is in state $i$. The computation proceeds from the leaves to the root. The final likelihood for the site is $L_v(0)$ evaluated at the root node $v=r$.\n\nSince the $L$ barcode sites are independent and have an identical rate $\\mu$, the total likelihood for the observed states across all sites is the product of the individual site likelihoods. Let $D_j$ be the data for site $j$.\n$$\nL_{\\text{total}}(\\mu) = \\prod_{j=1}^{L} L_{\\text{site}, j}(\\mu)\n$$\nwhere $L_{\\text{site}, j}(\\mu)$ is the likelihood for site $j$ calculated as described above.\n\nPart 2: Maximum Likelihood Estimation for a Star Topology\n\nThe problem now specializes to a rooted star topology with $m$ leaves, where each leaf is connected to the root by a branch of duration $t$. The root state is known to be $0$ for all sites. This structure greatly simplifies the likelihood calculation. Given the root state is $0$, the states of the $m$ leaves evolve independently from each other along their respective branches.\n\nFor any given site at any given leaf, the state is the result of a process of duration $t$ starting from state $0$. The probability of this leaf-site being unedited (state $0$) is:\n$$\np_0 = P(\\text{state}=0) = P_{00}(t) = \\exp(-\\mu t)\n$$\nThe probability of this leaf-site being edited (state $1$) is:\n$$\np_1 = P(\\text{state}=1) = P_{01}(t) = 1 - \\exp(-\\mu t)\n$$\nWe have a total of $N = m \\times L$ leaf-site pairs. Each of these constitutes an independent Bernoulli trial with a success probability of $p_1$ (where success is defined as being in the edited state $1$).\nThe data are summarized as observing $K$ total edited states ($1$) and $N-K$ unedited states ($0$). The likelihood of observing $K$ successes in $N$ independent trials follows a binomial distribution:\n$$\nL(\\mu) = \\binom{N}{K} (p_1)^K (p_0)^{N-K}\n$$\nSubstituting the expressions for $p_0$ and $p_1$:\n$$\nL(\\mu) = \\binom{N}{K} (1 - \\exp(-\\mu t))^K (\\exp(-\\mu t))^{N-K}\n$$\nTo find the maximum likelihood estimate (MLE) $\\hat{\\mu}$, we maximize $L(\\mu)$ with respect to $\\mu$. It is more convenient to maximize the log-likelihood, $\\ln L(\\mu)$:\n$$\n\\ln L(\\mu) = \\ln\\binom{N}{K} + K \\ln(1 - \\exp(-\\mu t)) + (N-K) \\ln(\\exp(-\\mu t))\n$$\n$$\n\\ln L(\\mu) = \\ln\\binom{N}{K} + K \\ln(1 - \\exp(-\\mu t)) - (N-K)\\mu t\n$$\nWe differentiate with respect to $\\mu$ and set the result to zero:\n$$\n\\frac{d}{d\\mu} \\ln L(\\mu) = K \\left( \\frac{1}{1 - \\exp(-\\mu t)} \\right) ( - \\exp(-\\mu t) ) (-t) - (N-K)t = 0\n$$\n$$\n\\frac{K t \\exp(-\\mu t)}{1 - \\exp(-\\mu t)} - (N-K)t = 0\n$$\nAssuming $t \\neq 0$, we can divide by $t$:\n$$\n\\frac{K \\exp(-\\mu t)}{1 - \\exp(-\\mu t)} = N-K\n$$\n$$\nK \\exp(-\\mu t) = (N-K)(1 - \\exp(-\\mu t))\n$$\n$$\nK \\exp(-\\mu t) = N - K - (N-K)\\exp(-\\mu t)\n$$\n$$\n(K + N - K) \\exp(-\\mu t) = N - K\n$$\n$$\nN \\exp(-\\mu t) = N - K\n$$\n$$\n\\exp(-\\mu t) = \\frac{N-K}{N} = 1 - \\frac{K}{N}\n$$\nSolving for $\\mu$ gives the MLE, $\\hat{\\mu}$:\n$$\n-\\hat{\\mu} t = \\ln\\left(1 - \\frac{K}{N}\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{t} \\ln\\left(1 - \\frac{K}{N}\\right)\n$$\nNow we substitute the given numerical values:\n$m = 4$\n$L = 1000$\n$t = 20$ h\n$K = 1230$\nThe total number of observations is $N = m \\times L = 4 \\times 1000 = 4000$.\n\nPlugging these into the formula for $\\hat{\\mu}$:\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln\\left(1 - \\frac{1230}{4000}\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln\\left(1 - 0.3075\\right)\n$$\n$$\n\\hat{\\mu} = -\\frac{1}{20} \\ln(0.6925)\n$$\nCalculating the value:\n$$\n\\hat{\\mu} \\approx -\\frac{1}{20} (-0.3674608) \\approx 0.01837304 \\, \\text{h}^{-1}\n$$\nRounding to four significant figures as required:\n$$\n\\hat{\\mu} \\approx 0.01837 \\, \\text{h}^{-1}\n$$", "answer": "$$\n\\boxed{0.01837}\n$$", "id": "2752064"}, {"introduction": "A sophisticated model is only as good as our ability to validate it. Given the complexity of lineage data, with its inherent correlations, assessing model performance and preventing overfitting requires careful statistical design. This final practice challenges you to move beyond model fitting to model criticism, evaluating different cross-validation strategies to understand which ones provide a statistically sound measure of a lineage tracing model's ability to generalize [@problem_id:2752017].", "problem": "You are given a synthetic lineage recorder dataset produced by Clustered Regularly Interspaced Short Palindromic Repeats (CRISPR)-based editing. Let $N$ denote the number of cells (leaves), $S$ the number of recorder sites, and $X \\in \\mathcal{X}^{N \\times S}$ the observed matrix of site states across cells. Assume a generative model in which a latent rooted tree $T$ with branch lengths $\\{b_{e}\\}$ governs inheritance, and each site $s \\in \\{1,\\dots,S\\}$ evolves along $T$ according to a parametric, time-homogeneous, site-specific stochastic process with parameter $\\theta_{s}$ (for example, an irreversible edit process with rate $\\lambda_{s}$ and outcome probabilities $\\pi_{s}$). Conditional on $(T,\\{\\theta_{s}\\}_{s=1}^{S})$, sites are independent, so that the likelihood factorizes as\n$$\np(X \\mid T,\\{\\theta_{s}\\}_{s=1}^{S}) \\;=\\; \\prod_{s=1}^{S} p\\big(X_{\\cdot s} \\mid T,\\theta_{s}\\big).\n$$\nFurther suppose either (i) sites are exchangeable with $\\theta_{s} \\stackrel{\\text{i.i.d.}}{\\sim} F$ for some distribution $F$, or (ii) sites partition into $G$ known groups (for example, cassettes or arrays) with group index $g(s) \\in \\{1,\\dots,G\\}$, where conditional independence holds across groups and parameters are exchangeable within a group: $\\theta_{s} \\mid g(s)=g \\stackrel{\\text{i.i.d.}}{\\sim} F_{g}$.\n\nYour goal is to assess and guard against overfitting in lineage tree inference by cross-validation. Consider the target of evaluation to be the out-of-sample predictive log-likelihood under the same data-generating process. When partitioning by sites, the target is performance on new sites drawn from the same process. When partitioning by cells, the target is performance on unobserved leaves generated by the same lineage and editing process.\n\nWhich of the following cross-validation designs yield an asymptotically unbiased estimator of the corresponding out-of-sample predictive log-likelihood target under the stated assumptions, and why?\n\nA. Randomly split the $N$ cells into $K$ folds. For each fold, fit $(\\hat{T},\\hat{\\Theta})$ on the training cells using all $S$ sites. For each test cell $c$, first attach $c$ to $\\hat{T}$ at the maximum likelihood position using $X_{c\\cdot}$, then compute $\\log p\\big(X_{c\\cdot} \\mid \\hat{T},\\hat{\\Theta}, \\widehat{\\text{attach}}(c)\\big)$ and average over test cells and folds.\n\nB. Perform $K$-fold cross-validation over sites: partition $\\{1,\\dots,S\\}$ into $K$ folds. For each fold, infer $(\\hat{T},\\hat{\\Theta}_{\\text{shared}})$ using the training sites only, where $\\hat{\\Theta}_{\\text{shared}}$ denotes any parameters shared across sites (for example, hyperparameters of $F$ or process constraints); then evaluate the held-out site predictive log-likelihood $\\sum_{s \\in \\text{test}} \\log p\\big(X_{\\cdot s} \\mid \\hat{T},\\hat{\\theta}_{s}^{\\star}\\big)$, where $\\hat{\\theta}_{s}^{\\star}$ is obtained by training-set-only empirical Bayes or integrating out $\\theta_{s}$ under a prior estimated from training sites. Average across folds.\n\nC. If sites are grouped into $G$ dependent cassettes, perform grouped $K$-fold cross-validation over site groups: partition $\\{1,\\dots,G\\}$ into folds, fit $(\\hat{T},\\{\\hat{F}_{g}\\})$ on training groups only, and evaluate the held-out group predictive log-likelihood by integrating over $\\theta_{s}$ for $s$ in held-out groups under the corresponding $\\hat{F}_{g}$. Average across folds.\n\nD. Clade-blocked cross-validation over cells: sample internal nodes at a prescribed depth range and hold out the entire descendant leaf sets as test clades. Fit $(\\hat{T},\\hat{\\Theta})$ on the remaining cells using all sites. For a held-out clade $C$, score its data by the posterior predictive density\n$$\n\\log p\\big(X_{C} \\mid X_{-C}\\big) \\;=\\; \\log \\int p\\big(X_{C} \\mid T,\\Theta\\big) \\, p\\big(T,\\Theta \\mid X_{-C}\\big) \\,\\mathrm{d}T\\,\\mathrm{d}\\Theta,\n$$\napproximated in practice by a plug-in $\\log p\\big(X_{C} \\mid \\hat{T},\\hat{\\Theta}\\big)$ or by Monte Carlo from $p\\big(T,\\Theta \\mid X_{-C}\\big)$. Average over held-out clades.\n\nE. To reduce dependence, randomly permute the entries within each site column $X_{\\cdot s}$ across cells, then perform random site-wise $K$-fold cross-validation as in option B.\n\nSelect all options that are statistically valid in the sense above, and justify your choice using first principles of likelihood factorization, exchangeability, and proper predictive scoring under hierarchical models. Your justification must explicitly connect the data partition to the independence or exchangeability structure and explain why the resulting estimator targets the desired out-of-sample quantity.", "solution": "The validity of a cross-validation scheme hinges on a single, critical principle: the procedure for partitioning data into training and test sets must produce test sets that are statistically representative of \"new\" data, for a specified definition of \"new\". An asymptotically unbiased estimator of out-of-sample predictive performance is achieved only if the data split respects the underlying dependency structure of the generative model. In the context of this problem, the data $X$ exhibits dependencies among both its rows (cells) and its columns (sites), mediated by the latent tree $T$ and the hierarchical structure of the site parameters $\\Theta$. We evaluate each proposed design against this principle.\n\nA. Randomly split the $N$ cells into $K$ folds. For each fold, fit $(\\hat{T},\\hat{\\Theta})$ on the training cells using all $S$ sites. For each test cell $c$, first attach $c$ to $\\hat{T}$ at the maximum likelihood position using $X_{c\\cdot}$, then compute $\\log p\\big(X_{c\\cdot} \\mid \\hat{T},\\hat{\\Theta}, \\widehat{\\text{attach}}(c)\\big)$ and average over test cells and folds.\n\nThis procedure is statistically invalid. The cells, being leaves of a single phylogenetic tree $T$, are not independent and identically distributed ($i.i.d.$) samples. Their states are correlated due to shared ancestry. A random partition of cells into training and test folds ignores this fundamental dependency. A test cell is likely to be closely related to one or more training cells. Information from these related training cells will make the prediction of the test cell's data artificially easy, leading to an optimistic bias in the estimated predictive log-likelihood. The resulting estimator does not measure generalization to genuinely \"new\" parts of a lineage but rather performance on interpolating single leaves into a known topology. This is a classic error in applying standard cross-validation to phylogenetically correlated data.\n\n**Verdict: Incorrect**\n\nB. Perform $K$-fold cross-validation over sites: partition $\\{1,\\dots,S\\}$ into $K$ folds. For each fold, infer $(\\hat{T},\\hat{\\Theta}_{\\text{shared}})$ using the training sites only, where $\\hat{\\Theta}_{\\text{shared}}$ denotes any parameters shared across sites (for example, hyperparameters of $F$ or process constraints); then evaluate the held-out site predictive log-likelihood $\\sum_{s \\in \\text{test}} \\log p\\big(X_{\\cdot s} \\mid \\hat{T},\\hat{\\theta}_{s}^{\\star}\\big)$, where $\\hat{\\theta}_{s}^{\\star}$ is obtained by training-set-only empirical Bayes or integrating out $\\theta_{s}$ under a prior estimated from training sites. Average across folds.\n\nThis procedure is statistically valid. The problem states that the sites are drawn from a process that renders them exchangeable: either $\\theta_s \\stackrel{\\text{i.i.d.}}{\\sim} F$ or they are exchangeable within groups. This exchangeability means that the columns of the data matrix, $X_{\\cdot s}$, are the fundamental, repeatable units of the \"experiment\" with respect to site properties. Partitioning by sites correctly creates training and test sets that are independent draws from this site-generating process. The training sites are used to learn the shared structure (the tree $\\hat{T}$) and the population-level parameters of site evolution ($\\hat{\\Theta}_{\\text{shared}}$, such as the hyperparameters of $F$). The procedure then correctly evaluates the model's ability to predict data for new sites, drawn from the same distribution, given the inferred shared structure. This precisely matches the stated goal of evaluating \"performance on new sites drawn from the same process.\" The use of empirical Bayes or marginalization to obtain $\\hat{\\theta}_{s}^{\\star}$ is the proper hierarchical modeling approach.\n\n**Verdict: Correct**\n\nC. If sites are grouped into $G$ dependent cassettes, perform grouped $K$-fold cross-validation over site groups: partition $\\{1,\\dots,G\\}$ into folds, fit $(\\hat{T},\\{\\hat{F}_{g}\\})$ on training groups only, and evaluate the held-out group predictive log-likelihood by integrating over $\\theta_{s}$ for $s$ in held-out groups under the corresponding $\\hat{F}_{g}$. Average across folds.\n\nThis procedure is also statistically valid and represents a necessary refinement of method B when a known group structure exists. The problem states that in case (ii), parameters are exchangeable *within* a group, and there is conditional independence *across* groups. This establishes the groups (cassettes) as the exchangeable units. Standard site-wise cross-validation as in B would be invalid if there are unmodeled dependencies among sites *within* a group, as it would break these dependencies and lead to optimistic performance estimates. By holding out entire groups, this procedure correctly accounts for any such intra-group correlation. It evaluates the model's ability to generalize to entirely new groups of sites, which is the correct target when such a group structure is present. This is a standard and robust application of blocked cross-validation, essential for data with hierarchical dependencies.\n\n**Verdict: Correct**\n\nD. Clade-blocked cross-validation over cells: sample internal nodes at a prescribed depth range and hold out the entire descendant leaf sets as test clades. Fit $(\\hat{T},\\hat{\\Theta})$ on the remaining cells using all sites. For a held-out clade $C$, score its data by the posterior predictive density $\\log p\\big(X_{C} \\mid X_{-C}\\big)$, approximated in practice. Average over held-out clades.\n\nThis procedure is statistically valid for the target of evaluating performance on unobserved leaves. It is a sophisticated method designed specifically to address the non-independence of cells. Unlike the naive random splitting in A, holding out entire clades respects the phylogenetic dependency structure. It simulates a more realistic scenario of missing data where an entire branch of the lineage was not sampled. The evaluation metric, the posterior predictive probability of the test data given the training data, $p\\big(X_{C} \\mid X_{-C}\\big)$, is the principled Bayesian measure for predictive model checking. This method correctly assesses how well a model, trained on one part of a lineage, can predict the evolutionary history and resulting states in a distinct, unobserved part of that same lineage. This is a well-established technique for structured data, analogous to forward chaining or blocked cross-validation for time series.\n\n**Verdict: Correct**\n\nE. To reduce dependence, randomly permute the entries within each site column $X_{\\cdot s}$ across cells, then perform random site-wise $K$-fold cross-validation as in option B.\n\nThis procedure is nonsensical and demonstrates a fundamental misunderstanding of the modeling goal. The core scientific task is to infer the lineage tree $T$, which is encoded in the correlations *between cells* (rows) across the various sites (columns). Randomly permuting the entries within each column $X_{\\cdot s}$ completely destroys this phylogenetic signal. The resulting data matrix has no relation to the true underlying tree $T$. Performing cross-validation on this permuted data would evaluate a model's ability to fit the marginal distributions of character states at each site, a task completely divorced from lineage reconstruction. The stated aim, \"to reduce dependence,\" is perverse; the dependence induced by the tree is the very signal to be modeled, not a nuisance to be eliminated. This procedure does not evaluate the specified model in any meaningful way.\n\n**Verdict: Incorrect**", "answer": "$$\\boxed{BCD}$$", "id": "2752017"}]}