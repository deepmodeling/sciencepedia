{"hands_on_practices": [{"introduction": "The journey of a single-cell experiment begins with the physical act of isolating individual cells, a process susceptible to subtle but significant biases. Before any molecular biology or sequencing occurs, fundamental physical laws can skew the composition of your captured cell population. This exercise [@problem_id:2773291] challenges you to think like a physicist and an engineer, applying principles like Stokes' Law for sedimentation to predict how cell size can create a capture bias in a common plate-based protocol. By evaluating different analytical strategies, you will develop the critical thinking skills needed to anticipate, detect, and account for physical artifacts in experimental design.", "problem": "A plate-based single-cell capture protocol relies on gravity-driven settling into wells during a finite loading interval, followed by adhesion to the well bottom. Consider a mixture of two subpopulations of mammalian cells in a quiescent medium: a \"small\" class with radius $r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$ and a \"large\" class with radius $r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$. The density difference between cells and medium is $\\Delta \\rho = 50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, dynamic viscosity is $\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$, gravitational acceleration is $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, fluid height in the well is $H = 2.0\\,\\mathrm{mm}$, and the loading time window is $T = 600\\,\\mathrm{s}$. Assume creeping flow (low Reynolds number) sedimentation and that adhesion propensity upon contact increases with cell-surface contact area. The input mixture is $50$–$50$ by number for small and large cells, viability is identical across sizes, and the suspension is well-mixed without convection.\n\nFrom first principles, explain why size-dependent sedimentation and adhesion can introduce compositional bias in the captured set, and propose quantitative metrics that could detect and attribute this bias in experiments. You may use standard physical laws for low Reynolds number sedimentation, standard probability definitions, and common statistical tools used in single-cell assay analysis, but do not assume any specialized device-specific tricks.\n\nWhich of the following analysis plans are appropriate and quantitatively justified ways to detect and attribute the bias? Select all that apply.\n\nA. Build a mechanistic size-enrichment curve by estimating the size-specific capture probability $p_{\\mathrm{cap}}(r)$ as the product of the probability to reach the bottom within time $T$ and the adhesion propensity that scales with contact area, then compute an enrichment function $E(r) = p_{\\mathrm{cap}}(r)/p_{\\mathrm{in}}(r)$ across size bins. Test whether $E(r)$ increases with $r$ and quantify distributional shift with a two-sample Kolmogorov–Smirnov (KS) statistic between input and captured size distributions.\n\nB. Fit a Poisson wells-occupancy model to the number of cells per well to estimate the mean loading $\\lambda$ and conclude there is no size bias if the fraction of empty wells is close to $\\exp(-\\lambda)$; no size stratification or covariates are necessary.\n\nC. Regress the binary capture outcome on a flow-cytometry forward scatter (FSC) size proxy using logistic regression with a known exposure offset for loading time, and test whether the size coefficient is positive. Calibrate the expected sign and approximate magnitude of the coefficient by combining low Reynolds number sedimentation scaling with an adhesion term that increases with contact area.\n\nD. Normalize the counts of captured cells by the total number captured per plate and confirm that the enrichment vanishes after this normalization; if the normalized composition matches the input mix, conclude no adhesion-driven bias exists.\n\nE. Spike in polystyrene beads with known radii spanning those of the cells and record time-lapse arrival events at the well bottom. Estimate the size exponent of the arrival rate from the bead data and compare it to that inferred from the cells via survival analysis of time-to-capture; attribute bias to sedimentation if the exponent matches the low Reynolds number prediction.\n\nChoose all that apply.", "solution": "The problem statement shall first be subjected to rigorous validation.\n\n### Step 1: Extract Givens\nThe following data and assumptions are provided in the problem statement:\n- **System:** Plate-based single-cell capture via gravity-driven settling and subsequent adhesion.\n- **Cell Populations:** A mixture of two subpopulations.\n  - Small cells: radius $r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$.\n  - Large cells: radius $r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$.\n- **Input Composition:** $50\\%$ small cells, $50\\%$ large cells by number.\n- **Physical Parameters:**\n  - Density difference between cells and medium: $\\Delta \\rho = 50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n  - Dynamic viscosity of the medium: $\\eta = 1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}$.\n  - Gravitational acceleration: $g = 9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$.\n- **Geometric and Temporal Parameters:**\n  - Fluid height in well: $H = 2.0\\,\\mathrm{mm} = 2.0 \\times 10^{-3}\\,\\mathrm{m}$.\n  - Loading time interval: $T = 600\\,\\mathrm{s}$.\n- **Assumptions:**\n  1. Sedimentation occurs under creeping flow conditions (low Reynolds number).\n  2. Adhesion propensity increases with cell-surface contact area.\n  3. The medium is quiescent (no convection).\n  4. The initial cell suspension is well-mixed (uniform spatial distribution).\n  5. Cell viability is identical across sizes.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the required criteria.\n- **Scientifically Grounded:** The problem is based on the well-established Stokes' Law for sedimentation of a sphere in a viscous fluid at low Reynolds number. The physical parameters are realistic for mammalian cells in an aqueous medium. The assumption of adhesion propensity scaling with contact area is a reasonable physical hypothesis.\n- **Well-Posed:** The problem provides sufficient information to analyze the physical processes and their statistical consequences. The question is clear and requires an explanation based on first principles and an evaluation of proposed methods.\n- **Objective:** The problem is stated using precise, quantitative language, free of subjectivity.\n\nLet us verify the low Reynolds number assumption. The terminal velocity $v_t$ of a settling sphere is determined by balancing the net gravitational force $F_g = (\\rho_{cell} - \\rho_{medium}) V g = \\Delta \\rho (\\frac{4}{3}\\pi r^3) g$ with the Stokes' drag force $F_d = 6\\pi\\eta r v_t$. This yields:\n$$v_t = \\frac{2 \\Delta \\rho g}{9 \\eta} r^2$$\nFor the larger cells ($r_{\\mathrm{l}} = 10 \\times 10^{-6}\\,\\mathrm{m}$), the velocity is:\n$$v_{t,l} = \\frac{2 (50\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2})}{9 (1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s})} (10 \\times 10^{-6}\\,\\mathrm{m})^2 \\approx 1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\nThe Reynolds number is $Re = \\frac{\\rho_{medium} v_t (2r)}{\\eta}$. Assuming the medium density is approximately that of water, $\\rho_{medium} \\approx 1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$:\n$$Re_l = \\frac{(1000\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) (2 \\times 10 \\times 10^{-6}\\,\\mathrm{m})}{1.0 \\times 10^{-3}\\,\\mathrm{Pa}\\cdot\\mathrm{s}} \\approx 2.2 \\times 10^{-4}$$\nSince $Re_l \\ll 1$, the creeping flow assumption is fully justified. The problem is free of scientific unsoundness, incompleteness, or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived.\n\n---\n### First Principles Analysis of Bias\n\nCompositional bias arises from any process where the probability of capture is dependent on a cell's intrinsic properties, in this case, its size (radius $r$). The overall capture probability, $p_{\\mathrm{cap}}(r)$, can be modeled as the product of two independent probabilities: the probability of reaching the well bottom within the loading time $T$, $P_{\\mathrm{reach}}(r, T)$, and the probability of adhering upon contact, $P_{\\mathrm{adhere}}(r)$.\n\n$$p_{\\mathrm{cap}}(r) = P_{\\mathrm{reach}}(r, T) \\cdot P_{\\mathrm{adhere}}(r)$$\n\nWe analyze each term's dependence on size.\n\n**1. Sedimentation Bias ($P_{\\mathrm{reach}}$):**\nThe terminal settling velocity is $v_t(r) = \\frac{2 \\Delta \\rho g}{9 \\eta} r^2$. This shows a strong dependence on size: $v_t \\propto r^2$. A cell starting at an initial height $h$ ($0 \\le h \\le H$) will reach the bottom at time $t = h/v_t(r)$. For a cell to be a candidate for capture, it must reach the bottom within the loading time $T$, meaning $h/v_t(r) \\le T$. This implies the cell must start from a height $h \\le v_t(r) T$. Let $h_{\\mathrm{max}}(r) = v_t(r) T$ be the maximum initial height from which a cell of radius $r$ can successfully settle.\nSince the initial suspension is well-mixed, the probability of a cell starting in the successful volume is the ratio of this height to the total height:\n$$P_{\\mathrm{reach}}(r, T) = \\min\\left(1, \\frac{h_{\\mathrm{max}}(r)}{H}\\right) = \\min\\left(1, \\frac{v_t(r) T}{H}\\right)$$\nLet's calculate this for the two cell types:\n- **Large cells ($r_{\\mathrm{l}} = 10\\,\\mu\\mathrm{m}$):**\n  $v_{t,l} \\approx 1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  The time to settle from the maximum height $H$ is $t_{settle,l} = H/v_{t,l} = (2.0 \\times 10^{-3}\\,\\mathrm{m}) / (1.09 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) \\approx 184\\,\\mathrm{s}$.\n  Since $t_{settle,l} < T = 600\\,\\mathrm{s}$, all large cells, regardless of their initial position, will reach the bottom. Thus, $P_{\\mathrm{reach}}(r_{\\mathrm{l}}, T) = 1$.\n- **Small cells ($r_{\\mathrm{s}} = 5\\,\\mu\\mathrm{m}$):**\n  The velocity scales as $r^2$, so $v_{t,s} = v_{t,l} (\\frac{r_s}{r_l})^2 = v_{t,l} (\\frac{5}{10})^2 = v_{t,l}/4 \\approx 2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  The time to settle from height $H$ is $t_{settle,s} = H/v_{t,s} \\approx (2.0 \\times 10^{-3}\\,\\mathrm{m}) / (2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) \\approx 734\\,\\mathrm{s}$.\n  Since $t_{settle,s} > T = 600\\,\\mathrm{s}$, only a fraction of small cells will reach the bottom. The maximum height is $h_{\\mathrm{max}}(r_s) = v_{t,s} T = (2.73 \\times 10^{-6}\\,\\mathrm{m}\\,\\mathrm{s}^{-1})(600\\,\\mathrm{s}) = 1.64 \\times 10^{-3}\\,\\mathrm{m}$.\n  The probability is $P_{\\mathrm{reach}}(r_{\\mathrm{s}}, T) = h_{\\mathrm{max}}(r_s)/H = (1.64 \\times 10^{-3}\\,\\mathrm{m}) / (2.0 \\times 10^{-3}\\,\\mathrm{m}) \\approx 0.82$.\nThis difference in $P_{\\mathrm{reach}}$ introduces a significant bias favoring the capture of large cells.\n\n**2. Adhesion Bias ($P_{\\mathrm{adhere}}$):**\nThe problem states that adhesion propensity increases with cell-surface contact area. For a spherical cell, the contact area, $A_c$, upon slight deformation against a flat surface, is an increasing function of its radius $r$. A simple model could have $A_c \\propto r^2$. If we assume $P_{\\mathrm{adhere}}(r)$ is proportional to this contact area (or some other monotonically increasing function of it), then larger cells that reach the bottom will have a higher probability of adhering than smaller cells. So, $P_{\\mathrm{adhere}}(r)$ is an increasing function of $r$.\n\n**Combined Effect:**\nBoth $P_{\\mathrm{reach}}(r, T)$ and $P_{\\mathrm{adhere}}(r)$ are non-decreasing functions of $r$, and at least one is strictly increasing over the relevant range of radii. Therefore, the total capture probability $p_{\\mathrm{cap}}(r)$ is a strictly increasing function of $r$. This will cause the population of captured cells to be enriched with larger cells compared to the $50$-$50$ input mixture.\n\n### Evaluation of Analysis Plans\n\n**A. Build a mechanistic size-enrichment curve...**\nThis proposal involves modeling the capture probability $p_{\\mathrm{cap}}(r)$ as a product of sedimentation and adhesion probabilities, which aligns perfectly with the first-principles analysis. An enrichment function, typically defined as the ratio of the output size distribution to the input size distribution, would be proportional to this $p_{\\mathrm{cap}}(r)$. Testing if this function increases with $r$ is a direct test of the bias hypothesis. Furthermore, employing a two-sample Kolmogorov-Smirnov (KS) test is a standard, non-parametric method to formally test if the input and captured size distributions are statistically different. This plan is both mechanistically sound and statistically rigorous.\n**Verdict: Correct.**\n\n**B. Fit a Poisson wells-occupancy model...**\nA Poisson model for well occupancy describes the probability of finding $k$ cells in a well, $P(k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$, where $\\lambda$ is the mean number of cells per well. This model is useful for assessing the quality of cell loading (e.g., distinguishing random loading from aggregation) and estimating overall capture efficiency. However, the model is completely agnostic to cell properties like size. The parameter $\\lambda$ aggregates all cell types. The distribution of cells per well could perfectly follow a Poisson distribution, yet the captured population could be $100\\%$ large cells. This method is fundamentally incapable of detecting or quantifying compositional bias. The claim that no size stratification is necessary is incorrect.\n**Verdict: Incorrect.**\n\n**C. Regress the binary capture outcome on a flow-cytometry forward scatter (FSC) size proxy...**\nThis describes a powerful statistical approach. For each cell in the input population (which can be characterized by FSC pre-loading), the outcome is binary: captured ($1$) or not captured ($0$). Logistic regression is the appropriate statistical tool for modeling this binary outcome as a function of covariates. The model would be $\\mathrm{logit}(p_{\\mathrm{cap}}) = \\beta_0 + \\beta_1 \\cdot \\mathrm{FSC}$. FSC is a common proxy for cell size. A positive and statistically significant coefficient $\\beta_1$ would provide quantitative evidence that larger cells have a higher probability of capture. The second part of the proposal, to \"calibrate\" the model by comparing the estimated coefficient with an expectation derived from the physical model ($v_t \\propto r^2$ and adhesion $\\propto r^x$), represents an excellent synthesis of statistical inference and physical modeling. It elevates the analysis from mere correlation to a validated, quantitative model.\n**Verdict: Correct.**\n\n**D. Normalize the counts of captured cells...**\nThis proposal is based on a misunderstanding of what \"normalization\" and \"enrichment\" mean in this context. Normalizing the counts of captured cells by the total number captured simply yields the fractional composition of the *captured* population. For instance, if $N_s$ small cells and $N_l$ large cells are captured, the normalized counts are $N_s/(N_s+N_l)$ and $N_l/(N_s+N_l)$. This is the output distribution. Stating that \"enrichment vanishes after this normalization\" is a meaningless tautology. Analysis requires comparing this normalized output composition to the known input composition ($50\\%$-$50\\%$). The final flawed step is the conclusion: \"if the normalized composition matches the input mix, conclude no adhesion-driven bias exists\". This is incorrect because (1) it ignores the significant sedimentation bias, and (2) a lack of *net* bias does not mean the absence of component biases, which could in principle cancel. This entire plan is methodologically flawed.\n**Verdict: Incorrect.**\n\n**E. Spike in polystyrene beads...**\nThis describes a sophisticated experimental design to deconvolve the two sources of bias: sedimentation and adhesion. Polystyrene beads are excellent negative controls for biological adhesion; they sediment based on their size and density but do not interact with the surface in the same way cells do. Using time-lapse imaging to record arrival events allows for the direct measurement of sedimentation dynamics. By measuring the arrival rate as a function of bead radius, one can determine the experimental scaling exponent and verify if it matches the theoretical $r^2$ from Stokes' Law. Applying the same analysis (e.g., survival analysis on time-to-arrival/capture) to the cells allows for a direct comparison. If the size-dependence of cell arrival matches the beads and theory, then the sedimentation part of the process is well understood. Any further deviation between the composition of cells *arriving* at the bottom and the final *captured* composition can then be attributed to size-dependent adhesion. This is a powerful method for attributing bias to its physical origins.\n**Verdict: Correct.**", "answer": "$$\\boxed{ACE}$$", "id": "2773291"}, {"introduction": "Modern single-cell genomics heavily relies on droplet microfluidics to partition thousands of cells into nanoliter-scale reactors for analysis. While incredibly powerful, this method introduces a core statistical challenge: the random co-encapsulation of multiple cells into a single droplet, known as a \"doublet,\" which can corrupt downstream analysis. This practice [@problem_id:2773333] guides you through a foundational derivation using the Poisson distribution to model cell loading and precisely calculate the expected doublet rate. Mastering this calculation provides a deep understanding of the critical trade-off between cell throughput and data quality that every researcher using these platforms must navigate.", "problem": "In a droplet-based single-cell encapsulation workflow used for single-cell measurement, cells are suspended at concentration $c$ (in units of cells per unit volume) and partitioned into identically sized droplets of volume $V$ using a microfluidic generator. Assume that cells are uniformly mixed and arrive to droplets independently, so that the number of cells $N$ per droplet follows a Poisson distribution with mean $\\lambda=cV$. Define a \"doublet\" as a droplet containing exactly $2$ cells. In typical single-cell pipelines, droplets containing $0$ cells are removed downstream by selection, leaving only droplets with $N \\geq 1$ for measurement. Starting from the definition and normalization of the Poisson distribution and basic probability rules, derive an analytic expression for the expected fraction $f_{\\mathrm{dbl}}(c,V)$ of occupied droplets (those with $N \\geq 1$) that are doublets. Express your final answer as a single simplified analytic expression in terms of $c$ and $V$. Report your result as a decimal fraction (not a percentage). Do not round.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Cell concentration: $c$ (cells per unit volume).\n- Droplet volume: $V$.\n- The number of cells per droplet, $N$, follows a Poisson distribution.\n- The mean of the Poisson distribution is $\\lambda = cV$.\n- A \"doublet\" is defined as a droplet with $N=2$.\n- \"Occupied droplets\" are those with $N \\ge 1$.\n- The objective is to derive an analytic expression for the fraction $f_{\\mathrm{dbl}}(c,V)$ of occupied droplets that are doublets.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded. The use of a Poisson distribution to model the encapsulation of particles (such as cells) in uniformly-sized droplets is a standard and well-validated model in microfluidics and single-cell biology. The assumptions of uniform mixing and independent arrival are fundamental to this model. The problem is well-posed, providing all necessary definitions and parameters ($c, V$) to derive the requested quantity, $f_{\\mathrm{dbl}}(c,V)$. The language is objective and precise. The problem is self-contained, consistent, and requires a non-trivial derivation based on fundamental probability theory. It does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A solution will be derived.\n\nThe number of cells $N$ in a given droplet is a random variable following a Poisson distribution with mean $\\lambda = cV$. The probability mass function (PMF) for the Poisson distribution is given by:\n$$P(N=k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}$$\nSubstituting the given expression for the mean, $\\lambda = cV$, we have:\n$$P(N=k) = \\frac{(cV)^{k} \\exp(-cV)}{k!}$$\nwhere $k$ is a non-negative integer representing the number of cells in the droplet.\n\nWe are tasked with finding the fraction of *occupied* droplets that are \"doublets\". An occupied droplet is one containing one or more cells ($N \\ge 1$). A doublet is a droplet containing exactly two cells ($N=2$). This fraction is a conditional probability: the probability that a droplet contains two cells, given that it contains at least one cell. We denote this as $f_{\\mathrm{dbl}}(c,V) = P(N=2 | N \\ge 1)$.\n\nUsing the definition of conditional probability, $P(A|B) = \\frac{P(A \\cap B)}{P(B)}$, we have:\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(\\{N=2\\} \\cap \\{N \\ge 1\\})}{P(N \\ge 1)}$$\nThe event $\\{N=2\\}$ is a subset of the event $\\{N \\ge 1\\}$. Therefore, their intersection is simply the event $\\{N=2\\}$ itself. The expression simplifies to:\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(N=2)}{P(N \\ge 1)}$$\n\nNow, we must calculate the probabilities in the numerator and the denominator.\n\nFirst, the probability of a droplet being a doublet ($N=2$) is found by setting $k=2$ in the PMF:\n$$P(N=2) = \\frac{(cV)^{2} \\exp(-cV)}{2!} = \\frac{(cV)^{2} \\exp(-cV)}{2}$$\n\nNext, the probability of a droplet being occupied ($N \\ge 1$) is the complement of the probability of a droplet being empty ($N=0$).\n$$P(N \\ge 1) = 1 - P(N=0)$$\nThe probability of a droplet being empty is found by setting $k=0$ in the PMF:\n$$P(N=0) = \\frac{(cV)^{0} \\exp(-cV)}{0!} = \\frac{1 \\cdot \\exp(-cV)}{1} = \\exp(-cV)$$\nTherefore, the probability of a droplet being occupied is:\n$$P(N \\ge 1) = 1 - \\exp(-cV)$$\n\nFinally, we substitute these probabilities back into the expression for $f_{\\mathrm{dbl}}(c,V)$:\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{P(N=2)}{P(N \\ge 1)} = \\frac{\\frac{(cV)^{2} \\exp(-cV)}{2}}{1 - \\exp(-cV)}$$\n\nTo simplify this expression, we can multiply the numerator and the denominator by $\\exp(cV)$:\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{\\left(\\frac{(cV)^{2} \\exp(-cV)}{2}\\right) \\exp(cV)}{(1 - \\exp(-cV)) \\exp(cV)} = \\frac{\\frac{(cV)^{2}}{2}}{\\exp(cV) - 1}$$\nThis gives the final, simplified analytic expression for the expected fraction of occupied droplets that are doublets.\n$$f_{\\mathrm{dbl}}(c,V) = \\frac{(cV)^{2}}{2(\\exp(cV) - 1)}$$\nThis completes the derivation.", "answer": "$$\\boxed{\\frac{(cV)^{2}}{2(\\exp(cV) - 1)}}$$", "id": "2773333"}, {"introduction": "Once single-cell sequencing is complete, the raw data is not yet a true reflection of biology; it is confounded by technical variability, most notably the differences in sequencing depth and mRNA capture efficiency across cells. To make meaningful biological comparisons, this technical noise must be computationally removed through a process called normalization. This hands-on problem [@problem_id:2773346] provides a toy dataset to let you implement a robust normalization strategy from first principles, calculate cell-specific size factors, and witness firsthand how this essential step reduces technical variance and reveals the underlying biological signal in the data.", "problem": "You are quantifying messenger RNA expression from a synthetic gene circuit using single-cell RNA sequencing (scRNA-seq) with Unique Molecular Identifier (UMI) counting. Consider a toy dataset of $G=4$ genes measured in $N=4$ single cells split across two conditions, $A$ (cells $1$ and $2$) and $B$ (cells $3$ and $4$). Let $x_{g,i}$ denote the raw UMI count for gene $g$ in cell $i$. The observed counts are:\n- Gene $G_1$: $(x_{1,1}, x_{1,2}, x_{1,3}, x_{1,4}) = (80, 120, 100, 150)$.\n- Gene $G_2$: $(x_{2,1}, x_{2,2}, x_{2,3}, x_{2,4}) = (40, 60, 100, 150)$.\n- Gene $G_3$: $(x_{3,1}, x_{3,2}, x_{3,3}, x_{3,4}) = (160, 240, 200, 300)$.\n- Gene $G_4$: $(x_{4,1}, x_{4,2}, x_{4,3}, x_{4,4}) = (64, 96, 80, 120)$.\n\nAssume a multiplicative sampling model for UMI counts in single-cell RNA sequencing where, for gene $g$ and cell $i$, the expectation satisfies $x_{g,i} \\approx s_i \\,\\lambda_{g,c(i)}$ with $s_i>0$ a cell-specific size (sequencing depth and capture efficiency) factor and $\\lambda_{g,c}$ the underlying expression level of gene $g$ in condition $c \\in \\{A,B\\}$. Further assume that for the vast majority of genes $g$, there is no biological differential expression across conditions so that $\\lambda_{g,A}=\\lambda_{g,B}=\\lambda_g$, and that technical noise is negligible in this toy example.\n\nTasks:\n- Using only the multiplicative model and the majority-no-change assumption stated above (and no additional shortcut formulas), derive a robust estimator for the per-cell size factors $s_i$ that is identifiable up to a single positive multiplicative constant across cells. Then compute the estimated $s_i$ for this dataset.\n- Use your estimated $s_i$ to construct normalized counts $\\tilde{x}_{g,i} = x_{g,i}/s_i$ for all genes and cells.\n- Quantitatively assess how normalization changes within-condition dispersion by computing, for each gene $g$, the sample variance of $\\{x_{g,i}: i \\in A\\}$ and $\\{x_{g,i}: i \\in B\\}$ before normalization, and of $\\{\\tilde{x}_{g,i}: i \\in A\\}$ and $\\{\\tilde{x}_{g,i}: i \\in B\\}$ after normalization. Briefly explain the changes you observe in light of the model.\n- Finally, compute the base-$2$ logarithm of the fold-change for gene $G_2$ between conditions $B$ and $A$ using the normalized counts, where the condition-level abundance is defined as the arithmetic mean of the normalized counts across cells in that condition. That is, compute $\\log_{2}\\!\\big(\\bar{\\tilde{x}}_{2,B} / \\bar{\\tilde{x}}_{2,A}\\big)$, where $\\bar{\\tilde{x}}_{2,A}$ and $\\bar{\\tilde{x}}_{2,B}$ are the means over cells $1,2$ and $3,4$, respectively.\n\nReport only the number from the final step as your answer. Round your answer to four significant figures. No units are required.", "solution": "The problem as stated is scientifically grounded and mathematically well-posed. We proceed with the derivation and solution as requested. The analysis will be conducted in four parts as outlined in the problem statement.\n\nThe provided data consists of UMI counts $x_{g,i}$ for $G=4$ genes across $N=4$ cells. The cells are partitioned into condition $A$ (cells $i=1,2$) and condition $B$ (cells $i=3,4$). The data is:\n- Gene $G_1$: $(80, 120, 100, 150)$\n- Gene $G_2$: $(40, 60, 100, 150)$\n- Gene $G_3$: $(160, 240, 200, 300)$\n- Gene $G_4$: $(64, 96, 80, 120)$\n\nThe underlying model is $x_{g,i} \\approx s_i \\lambda_{g,c(i)}$, where $s_i$ is the cell-specific size factor and $\\lambda_{g,c}$ is the true expression of gene $g$ in condition $c$. The core assumption is that for the majority of genes, $\\lambda_{g,A} = \\lambda_{g,B} = \\lambda_g$. For such non-differentially expressed (non-DE) genes, the model simplifies to $x_{g,i} \\approx s_i \\lambda_g$.\n\n**Part 1: Derivation and Estimation of Size Factors $s_i$**\n\nFrom the simplified model for non-DE genes, $x_{g,i} \\approx s_i \\lambda_g$, it follows that the ratio of counts for any two cells $i$ and $j$ should be constant across all non-DE genes: $x_{g,i}/x_{g,j} \\approx s_i/s_j$. We can use this property to identify the set of non-DE genes. Let us compute the ratio $x_{g,3}/x_{g,1}$ for each gene:\n- Gene $G_1$: $x_{1,3}/x_{1,1} = 100/80 = 1.25$\n- Gene $G_2$: $x_{2,3}/x_{2,1} = 100/40 = 2.5$\n- Gene $G_3$: $x_{3,3}/x_{3,1} = 200/160 = 1.25$\n- Gene $G_4$: $x_{4,3}/x_{4,1} = 80/64 = 1.25$\n\nThe ratios for genes $G_1$, $G_3$, and $G_4$ are identical, while the ratio for $G_2$ is an outlier. This confirms that the set of non-DE genes is $G_{nd} = \\{G_1, G_3, G_4\\}$, fulfilling the \"vast majority\" assumption ($3$ out of $4$ genes).\n\nTo derive a robust estimator for $s_i$, we follow a procedure analogous to that used by DESeq2. For each gene $g$, a pseudo-reference sample is created by computing the geometric mean of its counts across all cells: $\\hat{x}_g = (\\prod_{j=1}^N x_{g,j})^{1/N}$. The ratio $x_{g,i} / \\hat{x}_g$ then serves as an estimate of the size factor $s_i$ from gene $g$. To ensure robustness against outlier genes (like $G_2$), we define the size factor for cell $i$ as the median of these ratios over the set of non-DE genes:\n$$s_i = \\underset{g \\in G_{nd}}{\\text{median}} \\left\\{ \\frac{x_{g,i}}{(\\prod_{j=1}^N x_{g,j})^{1/N}} \\right\\}$$\nThe resulting values are identifiable up to a multiplicative constant. The specific choice of this estimator guarantees that the geometric mean of the estimated size factors across all cells is $1$.\n\nDue to the constructed nature of the data ($x_{3,i} = 2x_{1,i}$ and $x_{4,i} = 0.8x_{1,i}$), the ratio $x_{g,i}/\\hat{x}_g$ is identical for all $g \\in G_{nd}$. We can therefore compute the factors using any of these genes, for example, $G_1$:\nFirst, we compute the pseudo-reference for $G_1$:\n$$\\hat{x}_1 = (x_{1,1} x_{1,2} x_{1,3} x_{1,4})^{1/4} = (80 \\times 120 \\times 100 \\times 150)^{1/4} = (144,000,000)^{1/4} = 20\\sqrt{30}$$\nNow we compute the size factor for each cell $i$ as $s_i = x_{1,i} / \\hat{x}_1$:\n- $s_1 = 80 / (20\\sqrt{30}) = \\frac{4}{\\sqrt{30}}$\n- $s_2 = 120 / (20\\sqrt{30}) = \\frac{6}{\\sqrt{30}}$\n- $s_3 = 100 / (20\\sqrt{30}) = \\frac{5}{\\sqrt{30}}$\n- $s_4 = 150 / (20\\sqrt{30}) = \\frac{15}{2\\sqrt{30}}$\n\n**Part 2: Construction of Normalized Counts**\n\nThe normalized counts, $\\tilde{x}_{g,i}$, are computed as $\\tilde{x}_{g,i} = x_{g,i}/s_i$. These values represent the underlying expression levels $\\lambda_{g,c(i)}$.\n\n- **Gene $G_1$**:\n  $\\tilde{x}_{1,1} = 80 / (4/\\sqrt{30}) = 20\\sqrt{30}$\n  $\\tilde{x}_{1,2} = 120 / (6/\\sqrt{30}) = 20\\sqrt{30}$\n  $\\tilde{x}_{1,3} = 100 / (5/\\sqrt{30}) = 20\\sqrt{30}$\n  $\\tilde{x}_{1,4} = 150 / (15/(2\\sqrt{30})) = 20\\sqrt{30}$\n\n- **Gene $G_2$**:\n  $\\tilde{x}_{2,1} = 40 / (4/\\sqrt{30}) = 10\\sqrt{30}$\n  $\\tilde{x}_{2,2} = 60 / (6/\\sqrt{30}) = 10\\sqrt{30}$\n  $\\tilde{x}_{2,3} = 100 / (5/\\sqrt{30}) = 20\\sqrt{30}$\n  $\\tilde{x}_{2,4} = 150 / (15/(2\\sqrt{30})) = 20\\sqrt{30}$\n\n- **Gene $G_3$**: $\\tilde{x}_{3,i} = 40\\sqrt{30}$ for all $i=1,2,3,4$.\n- **Gene $G_4$**: $\\tilde{x}_{4,i} = 16\\sqrt{30}$ for all $i=1,2,3,4$.\n\n\n**Part 3: Assessment of Within-Condition Dispersion**\n\nWe compute the sample variance for each gene within each condition, both before and after normalization. For $n=2$ observations $(y_1, y_2)$, the sample variance is $(y_1 - y_2)^2 / 2$.\n\n- **Before Normalization (Raw Counts $x_{g,i}$):**\n  - $G_1$: Var(A) = $(80-120)^2/2 = 800$; Var(B) = $(100-150)^2/2 = 1250$\n  - $G_2$: Var(A) = $(40-60)^2/2 = 200$; Var(B) = $(100-150)^2/2 = 1250$\n  - $G_3$: Var(A) = $(160-240)^2/2 = 3200$; Var(B) = $(200-300)^2/2 = 5000$\n  - $G_4$: Var(A) = $(64-96)^2/2 = 512$; Var(B) = $(80-120)^2/2 = 800$\n\n- **After Normalization (Normalized Counts $\\tilde{x}_{g,i}$):**\n  For all genes, including the DE gene $G_2$, the normalized counts are identical for all cells within the same condition. For example, for $G_1$ in condition A, the counts are $(20\\sqrt{30}, 20\\sqrt{30})$.\n  - For all genes and both conditions, the sample variance of the normalized counts is $0$.\n\n**Explanation**: The multiplicative model $x_{g,i} \\approx s_i \\lambda_{g,c(i)}$ implies that the variation observed in raw counts within a condition (where $\\lambda_{g,c(i)}$ is constant) is attributable entirely to the differing size factors $s_i$. Normalization by dividing by $s_i$ is designed precisely to remove this source of technical variation. In this idealized, noiseless example, the normalization perfectly recovers the underlying expression levels $\\lambda_{g,c(i)}$, resulting in zero variance within each condition.\n\n**Part 4: Calculation of Log-Fold-Change for Gene $G_2$**\n\nWe compute the base-$2$ logarithm of the fold-change between conditions $B$ and $A$ for gene $G_2$ using the average normalized counts.\n\nThe normalized counts for $G_2$ are:\n- Condition A (cells $1,2$): $(10\\sqrt{30}, 10\\sqrt{30})$\n- Condition B (cells $3,4$): $(20\\sqrt{30}, 20\\sqrt{30})$\n\nThe mean normalized abundance for each condition is:\n- $\\bar{\\tilde{x}}_{2,A} = \\frac{10\\sqrt{30} + 10\\sqrt{30}}{2} = 10\\sqrt{30}$\n- $\\bar{\\tilde{x}}_{2,B} = \\frac{20\\sqrt{30} + 20\\sqrt{30}}{2} = 20\\sqrt{30}$\n\nThe fold-change is the ratio of these means:\n$$\\frac{\\bar{\\tilde{x}}_{2,B}}{\\bar{\\tilde{x}}_{2,A}} = \\frac{20\\sqrt{30}}{10\\sqrt{30}} = 2$$\n\nFinally, we compute the base-$2$ logarithm of this fold-change:\n$$\\log_{2}\\left(\\frac{\\bar{\\tilde{x}}_{2,B}}{\\bar{\\tilde{x}}_{2,A}}\\right) = \\log_{2}(2) = 1$$\nRounding to four significant figures as requested, the final answer is $1.000$.", "answer": "$$\\boxed{1.000}$$", "id": "2773346"}]}