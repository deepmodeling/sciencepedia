{"hands_on_practices": [{"introduction": "To understand how populations evolve, we must connect selection acting within one generation to the response seen in the next. This foundational practice introduces the breeder's equation, $R = h^2 S$, a cornerstone of quantitative genetics that provides a simple yet powerful prediction for evolutionary change. By calculating the expected response to selection from a given selection differential ($S$) and heritability ($h^2$), you will gain a hands-on appreciation for how these key parameters govern the pace and direction of evolution for a quantitative trait [@problem_id:2818449].", "problem": "A large, panmictic population expresses a quantitative trait $z$ determined by additive genetic effects and environmental influences, such that $z=a+e$ where $a$ is the additive genetic value and $e$ is the environmental deviation. The narrow-sense heritability ($h^2$) is defined as the ratio of additive genetic variance to phenotypic variance, $h^2 = V_A/V_P$, with $V_P=V_A+V_E$. In one generation of selection, the within-generation selection differential $S$ is defined as the difference between the mean phenotype of the selected reproducers and the mean phenotype of the population before selection. Assume random mating, no genotype–environment covariance, no maternal or paternal effects, and purely additive gene action underlying resemblance across generations.\n\nYou are given that $h^2=0.4$ and that the observed within-generation selection differential is $S=1.2$ trait units. Using only the core definitions above and standard quantitative genetic assumptions, compute the expected response to selection $R$, defined as the change in the population mean phenotype between the offspring generation and the pre-selection parental generation.\n\nAdditionally, based solely on the sign and meaning of $S$ in the current generation, justify which mode of selection on the trait (directional, stabilizing, or disruptive) is most consistent with these observations, and explain your reasoning in terms of expected changes in the mean and variance.\n\nReport only the numerical value of $R$ in trait units. Do not include units in your final numeric answer. No rounding is required.", "solution": "The problem requires the calculation of the expected response to selection, $R$, and the identification of the mode of selection based on the provided information.\n\nThe core principle governing the relationship between selection and evolutionary response for a quantitative trait under the given assumptions (additive gene action, random mating, etc.) is the breeder's equation. This fundamental equation of quantitative genetics is stated as:\n$R = h^2 S$\nwhere:\n-   $R$ is the response to selection, defined as the change in the mean phenotypic value of the trait from the parental generation (before selection) to the offspring generation. Mathematically, $R = \\bar{z}_{\\text{offspring}} - \\bar{z}_{\\text{parental}}$.\n-   $h^2$ is the narrow-sense heritability, defined as the proportion of total phenotypic variance ($V_P$) that is due to additive genetic variance ($V_A$). Mathematically, $h^2 = \\frac{V_A}{V_P}$. It represents the degree to which offspring resemble their parents due to additive genetic effects.\n-   $S$ is the selection differential, defined as the difference between the mean phenotype of the individuals selected to be parents ($\\bar{z}_{\\text{selected}}$) and the mean phenotype of the entire population before selection ($\\bar{z}_{\\text{parental}}$). Mathematically, $S = \\bar{z}_{\\text{selected}} - \\bar{z}_{\\text{parental}}$. It quantifies the intensity and direction of selection within a generation.\n\nThe problem provides the following values:\n-   The narrow-sense heritability, $h^2 = 0.4$.\n-   The selection differential, $S = 1.2$ trait units.\n\nTo compute the expected response to selection, $R$, we substitute these values directly into the breeder's equation:\n$$R = (0.4) \\times (1.2)$$\n$$R = 0.48$$\nThus, the expected change in the mean phenotype of the population in the next generation is an increase of $0.48$ trait units.\n\nThe second part of the task is to justify the mode of selection (directional, stabilizing, or disruptive) that is consistent with the observations. This justification must be based on the provided information, specifically the selection differential $S$.\n\nLet us review the modes of natural selection in the context of a quantitative trait:\n1.  **Directional Selection**: This mode favors individuals with phenotypes at one extreme of the distribution. This results in a shift of the population's mean phenotype over time towards the favored extreme. A key diagnostic feature is a non-zero selection differential, $S \\neq 0$. If $S > 0$, selection favors larger trait values. If $S  0$, selection favors smaller trait values.\n2.  **Stabilizing Selection**: This mode favors individuals with intermediate phenotypes and selects against individuals at both extremes. This reduces the phenotypic variance of the trait in the population but does not change the mean. The mean of the selected parents is the same as the mean of the initial population, so the selection differential is $S \\approx 0$.\n3.  **Disruptive Selection**: This mode favors individuals at both extremes of the phenotypic distribution while selecting against intermediate phenotypes. This can lead to an increase in phenotypic variance and potentially a bimodal distribution. While the mean of the selected individuals can be the same as the population mean (if selection is symmetric), leading to $S \\approx 0$, it is characterized by an increase in variance.\n\nIn this problem, we are given that the selection differential is $S=1.2$. This value is positive and significantly different from zero. By its definition, $S = \\bar{z}_{\\text{selected}} - \\bar{z}_{\\text{parental}} = 1.2 > 0$, which signifies that the mean phenotype of the reproducing individuals is greater than the mean phenotype of the population from which they were selected. This indicates that individuals with higher-than-average trait values have a reproductive advantage.\n\nThis observation is the defining characteristic of **directional selection**. The positive sign of $S$ specifies that selection is directed towards increasing the value of the trait $z$. The expected consequence, a non-zero response to selection ($R=0.48$), confirms that the population mean is predicted to shift, which is the expected outcome under directional selection. In contrast, for pure stabilizing or disruptive selection, one would expect $S \\approx 0$, and consequently $R \\approx 0$, as these modes of selection do not primarily act to change the population mean. Therefore, based solely on the sign and magnitude of $S$, the only consistent mode of selection is directional selection.", "answer": "$$\n\\boxed{0.48}\n$$", "id": "2818449"}, {"introduction": "Natural selection is rarely as simple as favoring one extreme indefinitely. This practice moves beyond idealized modes to address the common scenario where directional and stabilizing selection act simultaneously on a single trait. You will learn to interpret the combination of a linear selection gradient ($\\beta$) and a quadratic selection gradient ($\\gamma$) to reconstruct the underlying fitness surface and predict the population's movement toward a displaced optimum [@problem_id:2818427]. This exercise is crucial for developing a nuanced understanding of selection as a multifaceted process.", "problem": "A field study quantifies natural selection on a standardized quantitative trait $z$ in a wild population using the Lande–Arnold approach to estimate selection gradients from relative fitness $w$ regressed on $z$ and $z^2$. The estimated linear (directional) gradient is $\\beta = 0.3$ and the quadratic (curvature) gradient is $\\gamma = -0.6$. The trait has phenotypic variance $P = 1$ by construction, and the additive genetic variance is $G = 0.2$. Assume weak selection, random mating, and that genetic transmission is unbiased across one generation.\n\nWhich option best interprets the joint evidence for directional and stabilizing selection under these data and correctly predicts the sign and approximate magnitude of the short-term evolutionary response in the mean and the qualitative effect on the phenotypic variance?\n\n- A. The data indicate selection favoring larger trait values ($\\beta0$) while simultaneously favoring an intermediate optimum ($\\gamma0$). Under a quadratic fitness surface, the peak occurs at an intermediate phenotype; with the given estimates this peak is displaced from the current mean, and the population mean should increase modestly in the next generation by about $\\Delta \\bar z \\approx 0.06$, while phenotypic variance should decline. The magnitude $|\\gamma|$ determines how sharply fitness falls away from the optimum, so as $\\bar z$ approaches the peak, the effective directional component weakens and the response slows.\n\n- B. The data indicate directional and disruptive selection, so there is no intermediate optimum. The mean should increase strongly by about $\\Delta \\bar z \\approx 0.2$, and phenotypic variance should increase because extreme phenotypes are favored.\n\n- C. Stabilizing selection ($\\gamma0$) cancels directional selection when both are present, so the mean will not change over one generation ($\\Delta \\bar z \\approx 0$), although the variance will decline.\n\n- D. The data imply an optimum located below the current mean, so the mean should decrease by about $\\Delta \\bar z \\approx 0.06$, and variance should decline.\n\n- E. The data indicate selection toward an intermediate phenotype. Because the trait is standardized, the one-generation change in the mean equals $\\Delta \\bar z \\approx 0.3$, and variance should increase because curvature accelerates selection toward extremes away from the mean.", "solution": "The problem statement must first be validated for scientific and logical integrity.\n\n### Step 1: Extract Givens\n- A standardized quantitative trait is denoted by $z$.\n- Natural selection is quantified using the Lande–Arnold regression of relative fitness $w$ on the trait $z$ and its square $z^2$.\n- The estimated linear (directional) selection gradient is $\\beta = 0.3$.\n- The estimated quadratic (stabilizing/disruptive) selection gradient is $\\gamma = -0.6$.\n- The trait is standardized, so its phenotypic variance is $P = 1$ and its mean is $\\bar{z} = 0$.\n- The additive genetic variance for the trait is $G = 0.2$.\n- The following assumptions are made: weak selection, random mating, and unbiased genetic transmission.\n- The objective is to interpret the mode of selection and predict the one-generation evolutionary response in the mean trait value, $\\Delta\\bar{z}$, and the qualitative change in phenotypic variance.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded. It employs the standard Lande-Arnold framework for measuring selection, a cornerstone of evolutionary quantitative genetics. The parameters provided are consistent and realistic. The heritability of the trait is $h^2 = G/P = 0.2/1 = 0.2$, a plausible value for a quantitative trait. The question is well-posed, providing all necessary information to apply established theoretical models to predict evolutionary change. The language is precise and objective. There are no contradictions, ambiguities, or violations of fundamental principles.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be derived.\n\n### Derivation of the Solution\nThe analysis of evolutionary change in a quantitative trait under selection is governed by fundamental principles of quantitative genetics.\n\n1.  **Interpreting the Selection Gradients:**\n    - The directional selection gradient, $\\beta$, measures the strength and direction of linear selection on the trait mean. Here, $\\beta = 0.3$. Since $\\beta  0$, there is positive directional selection favoring individuals with larger values of the trait $z$.\n    - The quadratic selection gradient, $\\gamma$, measures the curvature of the fitness surface. It indicates whether selection is stabilizing or disruptive. Here, $\\gamma = -0.6$. Since $\\gamma  0$, selection is stabilizing (or concave). This form of selection penalizes individuals with extreme phenotypes (both very high and very low) and favors individuals with intermediate phenotypes. Disruptive selection would correspond to $\\gamma  0$.\n\n2.  **Predicting the Response in the Mean Trait:**\n    The short-term evolutionary response in the mean of a trait ($\\Delta\\bar{z}$) is predicted by the multivariate breeder's equation, which for a single trait simplifies to the product of the additive genetic variance and the directional selection gradient:\n    $$ \\Delta\\bar{z} = G \\beta $$\n    Substituting the given values:\n    $$ \\Delta\\bar{z} = (0.2) \\times (0.3) = 0.06 $$\n    The predicted change in the mean trait value over one generation is an increase of $0.06$ standard deviation units.\n\n3.  **Predicting the Change in Phenotypic Variance:**\n    Stabilizing selection, indicated by $\\gamma  0$, acts to reduce the variance of a trait within a generation by removing extreme phenotypes from the population before they reproduce. While an exact prediction for the change in phenotypic variance across generations requires considering other factors like mutation and recombination, the direct effect of selection is a reduction in variance. Therefore, the phenotypic variance is expected to decline.\n\n4.  **Locating the Fitness Optimum:**\n    The combination of non-zero $\\beta$ and $\\gamma$ describes a quadratic fitness surface, $w(z) \\approx \\text{const} + \\beta z + \\gamma z^2$. The peak of this surface, or the optimal phenotype $z_{opt}$, is found by setting the derivative with respect to $z$ to zero:\n    $$ \\frac{dw}{dz} = \\beta + 2\\gamma z = 0 $$\n    $$ z_{opt} = -\\frac{\\beta}{2\\gamma} $$\n    Substituting the given values:\n    $$ z_{opt} = -\\frac{0.3}{2(-0.6)} = -\\frac{0.3}{-1.2} = \\frac{1}{4} = 0.25 $$\n    The current population mean is $\\bar{z}=0$ (by standardization). The optimum is at $z_{opt} = 0.25$. The positive directional selection gradient $\\beta = 0.3$ correctly reflects that the current mean is below the optimum, and the population is evolving towards it.\n\n### Option-by-Option Analysis\n\n-   **A. The data indicate selection favoring larger trait values ($\\beta0$) while simultaneously favoring an intermediate optimum ($\\gamma0$). Under a quadratic fitness surface, the peak occurs at an intermediate phenotype; with the given estimates this peak is displaced from the current mean, and the population mean should increase modestly in the next generation by about $\\Delta \\bar z \\approx 0.06$, while phenotypic variance should decline. The magnitude $|\\gamma|$ determines how sharply fitness falls away from the optimum, so as $\\bar z$ approaches the peak, the effective directional component weakens and the response slows.**\n    - This statement is entirely consistent with the derivation above. It correctly identifies directional ($\\beta  0$) and stabilizing ($\\gamma  0$) selection. It correctly calculates the response in the mean as $\\Delta\\bar{z} \\approx 0.06$. It correctly predicts a decline in variance. It also correctly describes the long-term dynamic, where the response will slow as the mean approaches the optimum.\n    - **Verdict: Correct.**\n\n-   **B. The data indicate directional and disruptive selection, so there is no intermediate optimum. The mean should increase strongly by about $\\Delta \\bar z \\approx 0.2$, and phenotypic variance should increase because extreme phenotypes are favored.**\n    - This is incorrect. Selection is stabilizing ($\\gamma = -0.6$), not disruptive. The prediction for $\\Delta\\bar{z}$ is incorrect; the correct value is $0.06$. Phenotypic variance should decrease, not increase.\n    - **Verdict: Incorrect.**\n\n-   **C. Stabilizing selection ($\\gamma0$) cancels directional selection when both are present, so the mean will not change over one generation ($\\Delta \\bar z \\approx 0$), although the variance will decline.**\n    - This demonstrates a fundamental misunderstanding. Stabilizing and directional selection are orthogonal components of the fitness function in this model; they do not \"cancel\" each other's effects on the mean. The response of the mean is determined by $\\beta$ and $G$, and is non-zero. The prediction $\\Delta\\bar{z} \\approx 0$ is false.\n    - **Verdict: Incorrect.**\n\n-   **D. The data imply an optimum located below the current mean, so the mean should decrease by about $\\Delta \\bar z \\approx 0.06$, and variance should decline.**\n    - This is incorrect. A positive $\\beta$ implies the optimum is above the current mean, and thus the mean should increase. The calculation $z_{opt} = 0.25  0$ confirms this. The predicted direction of change is wrong.\n    - **Verdict: Incorrect.**\n\n-   **E. The data indicate selection toward an intermediate phenotype. Because the trait is standardized, the one-generation change in the mean equals $\\Delta \\bar z \\approx 0.3$, and variance should increase because curvature accelerates selection toward extremes away from the mean.**\n    - This is incorrect. The response $\\Delta\\bar{z}$ is not equal to $\\beta$; it must be scaled by the additive genetic variance ($G$). The prediction $\\Delta\\bar{z} \\approx 0.3$ is therefore false. Furthermore, negative curvature ($\\gamma  0$) causes a decrease in variance, not an increase.\n    - **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2818427"}, {"introduction": "This culminating exercise allows you to construct a virtual ecosystem from first principles to observe stabilizing selection in action. By building an individual-based simulation, you will see how a theoretical Gaussian fitness function, $w(z) = \\exp(-\\frac{(z-\\theta)^2}{2\\omega^2})$, translates into demographic outcomes, leads to a measurable reduction in trait variance, and can be accurately quantified using the regression-based methods you've studied [@problem_id:2818446]. This practice provides a powerful and intuitive link between the abstract theory of selection and the analysis of the data it generates.", "problem": "You will implement an individual-based simulation of stabilizing selection on a single quantitative trait and compute the realized quadratic selection gradient, denoted by $\\gamma$, from simulated trait and fitness data. The design must begin from the following foundational base:\n\n- A quantitative trait $Z$ is initially distributed in the population as a Gaussian (Normal) random variable with mean $\\mu$ and standard deviation $\\sigma$, so that individual trait values are independent draws $z_i \\sim \\mathcal{N}(\\mu,\\sigma^2)$.\n- Stabilizing selection is characterized by highest absolute fitness at an optimal trait value $\\theta$, decreasing symmetrically away from $\\theta$. A well-tested representation uses a Gaussian fitness function $w(z) = \\exp\\!\\left(-\\frac{(z-\\theta)^2}{2\\omega^2}\\right)$, where $\\omega$ controls the strength of stabilizing selection (smaller $\\omega$ implies stronger selection).\n\nFrom these bases, proceed as follows to derive what to simulate and how to measure the realized $\\gamma$:\n\n1) Model absolute fitness and realized reproduction. For each individual with trait $z_i$, set absolute fitness $w_i = w(z_i) = \\exp\\!\\left(-\\frac{(z_i-\\theta)^2}{2\\omega^2}\\right)$. Realized reproductive output $X_i$ is a Poisson random variable with mean $\\lambda_i = R_0 w_i$, i.e., $X_i \\sim \\text{Poisson}(R_0 w_i)$, where $R_0$ is a positive baseline fecundity constant. Define relative fitness as $r_i = \\frac{X_i}{\\bar{X}}$, where $\\bar{X} = \\frac{1}{N}\\sum_{i=1}^{N} X_i$.\n\n2) Standardize the trait for selection analysis. Let $\\bar{z} = \\frac{1}{N}\\sum_{i=1}^{N} z_i$ and $s_z = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2}$. Define the standardized trait $\\tilde{z}_i = \\frac{z_i - \\bar{z}}{s_z}$.\n\n3) Estimate the realized quadratic selection gradient. Using Ordinary Least Squares (OLS), regress relative fitness $r_i$ on an intercept, $\\tilde{z}_i$, and $\\tilde{z}_i^2$ to fit the model\n$$\nr_i = b_0 + b_1 \\tilde{z}_i + b_2 \\tilde{z}_i^2 + \\varepsilon_i.\n$$\nUnder the standard Lande–Arnold selection analysis, the realized quadratic selection gradient is $\\gamma = 2 b_2$.\n\n4) Quantify variance reduction under stabilizing selection. Compute the pre-selection variance $\\mathrm{Var}_{\\text{before}}(Z) = \\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2$. Model the post-selection trait distribution by weighting each $z_i$ by its realized reproductive count $X_i$ (interpreted as number of offspring carrying the parental phenotype in the absence of segregation variance). Compute the post-selection mean $\\mu_{\\text{after}} = \\frac{\\sum_{i=1}^{N} X_i z_i}{\\sum_{i=1}^{N} X_i}$ and post-selection variance $\\mathrm{Var}_{\\text{after}}(Z) = \\frac{\\sum_{i=1}^{N} X_i (z_i - \\mu_{\\text{after}})^2}{\\sum_{i=1}^{N} X_i}$. Report the variance ratio $\\rho = \\frac{\\mathrm{Var}_{\\text{after}}(Z)}{\\mathrm{Var}_{\\text{before}}(Z)}$, which is expected to be less than $1$ under stabilizing selection centered near the current mean when selection is nontrivial.\n\nYour program must:\n\n- Simulate one generation for each test case using the steps above.\n- Estimate the realized $\\gamma$ via OLS as described.\n- Compute $\\rho$ and a boolean flag indicating whether variance decreased, i.e., $\\rho  1$.\n\nUse the following test suite. Each test case is a $7$-tuple $(N,\\mu,\\sigma,\\theta,\\omega,R_0,\\text{seed})$:\n\n- Case A (baseline stabilizing): ($N=20000$, $\\mu=0.0$, $\\sigma=1.0$, $\\theta=0.0$, $\\omega=1.0$, $R_0=2.0$, seed=1)\n- Case B (strong stabilizing): ($N=20000$, $\\mu=0.0$, $\\sigma=1.0$, $\\theta=0.0$, $\\omega=0.5$, $R_0=2.0$, seed=2)\n- Case C (near-neutral): ($N=20000$, $\\mu=0.0$, $\\sigma=1.0$, $\\theta=0.0$, $\\omega=10^6$, $R_0=2.0$, seed=3)\n- Case D (offset optimum): ($N=20000$, $\\mu=0.0$, $\\sigma=1.0$, $\\theta=1.5$, $\\omega=1.0$, $R_0=2.0$, seed=4)\n\nFinal output specification:\n\n- For each test case, output a list $[\\gamma, \\rho, \\text{decreased}]$, where $\\gamma$ and $\\rho$ are floats rounded to $6$ decimal places, and $\\text{decreased}$ is a boolean indicating whether $\\rho  1$.\n- Aggregate the four per-case lists into a single list, and print exactly one line containing this aggregate list in the format\n\"[ [g_A, r_A, b_A], [g_B, r_B, b_B], [g_C, r_C, b_C], [g_D, r_D, b_D] ]\"\nwith no spaces after commas other than those needed to separate the per-case lists.", "solution": "The problem statement is valid. It presents a scientifically sound, well-posed, and objective task rooted in the fundamental principles of evolutionary quantitative genetics. All necessary parameters and procedures are explicitly defined, permitting a unique and verifiable solution. The problem requires the implementation of an individual-based simulation to explore the effects of stabilizing selection on a quantitative trait, and to quantify these effects using the established Lande-Arnold regression framework.\n\nThe solution will be constructed following the sequence of steps outlined in the problem.\n\nStep 1: Generation of Initial Population and Trait Values\nThe simulation begins by creating a population of $N$ individuals. For each test case, the population size is specified as $N=20000$. Each individual $i$ is assigned a value for a quantitative trait $Z$. These trait values, denoted $z_i$ for $i=1, \\dots, N$, are drawn as independent and identically distributed samples from a Gaussian (Normal) distribution, $z_i \\sim \\mathcal{N}(\\mu, \\sigma^2)$. The parameters for the initial mean $\\mu$ and standard deviation $\\sigma$ are provided for each case. The use of a specified random seed ensures that the sequence of random numbers is fixed, making the simulation results reproducible.\n\nStep 2: Modeling Fitness and Reproduction\nStabilizing selection is imposed via a Gaussian fitness function, which assigns the highest fitness to an optimal trait value $\\theta$. The absolute fitness $w_i$ of an individual with trait value $z_i$ is given by:\n$$\nw(z_i) = \\exp\\left(-\\frac{(z_i - \\theta)^2}{2\\omega^2}\\right)\n$$\nHere, $\\omega$ controls the strength of selection: a smaller $\\omega$ corresponds to a narrower fitness peak and thus stronger stabilizing selection. The next step is to model demography, specifically the realized number of offspring for each individual. The number of offspring, $X_i$, for individual $i$ is a random variable drawn from a Poisson distribution:\n$$\nX_i \\sim \\text{Poisson}(\\lambda_i)\n$$\nThe mean of the Poisson distribution, $\\lambda_i$, is the product of the individual's absolute fitness $w_i$ and a baseline fecundity constant $R_0$, such that $\\lambda_i = R_0 w_i$. This stochastic step introduces demographic variance into the simulation.\n\nStep 3: Trait Standardization for Selection Analysis\nTo measure selection in a standardized way, the trait values must be transformed. First, the pre-selection mean $\\bar{z}$ and standard deviation $s_z$ of the trait in the parental generation are computed:\n$$\n\\bar{z} = \\frac{1}{N}\\sum_{i=1}^{N} z_i\n$$\n$$\ns_z = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2}\n$$\nNote that this is the population standard deviation, not the sample standard deviation. Using these statistics, each individual's trait value $z_i$ is standardized to $\\tilde{z}_i$:\n$$\n\\tilde{z}_i = \\frac{z_i - \\bar{z}}{s_z}\n$$\nThe standardized trait $\\tilde{z}$ has a mean of $0$ and a standard deviation of $1$ by construction.\n\nStep 4: Estimation of the Quadratic Selection Gradient ($\\gamma$)\nThe quadratic selection gradient $\\gamma$ quantifies the strength and form of curvature in the relationship between trait and fitness. It is estimated using multiple linear regression. First, we define relative fitness $r_i$ for each individual as their realized offspring count $X_i$ divided by the average offspring count across the population, $\\bar{X}$:\n$$\nr_i = \\frac{X_i}{\\bar{X}}, \\quad \\text{where} \\quad \\bar{X} = \\frac{1}{N}\\sum_{i=1}^N X_i\n$$\nBy definition, the mean relative fitness is $1$. We then fit the following quadratic model using Ordinary Least Squares (OLS):\n$$\nr_i = b_0 + b_1 \\tilde{z}_i + b_2 \\tilde{z}_i^2 + \\varepsilon_i\n$$\nIn matrix notation, this is $\\mathbf{r} = \\mathbf{Z}\\mathbf{b} + \\boldsymbol{\\varepsilon}$, where $\\mathbf{r}$ is the vector of relative fitnesses, $\\mathbf{b} = [b_0, b_1, b_2]^T$ is the vector of coefficients, and $\\mathbf{Z}$ is the design matrix with columns corresponding to the intercept ($1$), the linear term ($\\tilde{z}_i$), and the quadratic term ($\\tilde{z}_i^2$). The OLS estimate for the coefficients is $\\hat{\\mathbf{b}} = (\\mathbf{Z}^T\\mathbf{Z})^{-1}\\mathbf{Z}^T\\mathbf{r}$. The realized quadratic selection gradient $\\gamma$ is defined as twice the estimated quadratic coefficient:\n$$\n\\gamma = 2 \\hat{b}_2\n$$\nA negative $\\gamma$ indicates stabilizing selection (fitness is concave down), while a positive $\\gamma$ indicates disruptive selection (fitness is concave up).\n\nStep 5: Quantification of Variance Reduction\nStabilizing selection is expected to reduce the variance of a trait in the population, as individuals with intermediate phenotypes have higher reproductive success. We quantify this by comparing the trait variance before and after selection.\nThe pre-selection variance is simply the square of the standard deviation calculated in Step 3:\n$$\n\\mathrm{Var}_{\\text{before}}(Z) = s_z^2 = \\frac{1}{N}\\sum_{i=1}^{N} (z_i - \\bar{z})^2\n$$\nThe post-selection trait distribution is composed of the offspring generation. Assuming no mutation or segregation variance, offspring have the same trait values as their parents. The post-selection distribution is therefore the parental trait distribution weighted by the number of offspring $X_i$. The total number of individuals in the offspring generation is $N_{\\text{after}} = \\sum_{i=1}^{N} X_i$.\nThe post-selection mean, $\\mu_{\\text{after}}$, is the weighted average of the parental traits:\n$$\n\\mu_{\\text{after}} = \\frac{\\sum_{i=1}^{N} X_i z_i}{\\sum_{i=1}^{N} X_i}\n$$\nThe post-selection variance, $\\mathrm{Var}_{\\text{after}}(Z)$, is the weighted variance:\n$$\n\\mathrm{Var}_{\\text{after}}(Z) = \\frac{\\sum_{i=1}^{N} X_i (z_i - \\mu_{\\text{after}})^2}{\\sum_{i=1}^{N} X_i}\n$$\nThe effect of selection on variance is measured by the ratio $\\rho$:\n$$\n\\rho = \\frac{\\mathrm{Var}_{\\text{after}}(Z)}{\\mathrm{Var}_{\\text{before}}(Z)}\n$$\nUnder effective stabilizing selection, we expect $\\rho  1$, indicating a reduction in trait variance. A boolean flag, `decreased`, is set to `True` if this condition holds. These calculations are performed for each test case to produce the required output.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates one generation of stabilizing selection on a quantitative trait\n    and computes the realized quadratic selection gradient (gamma) and the\n    change in variance (rho).\n    \"\"\"\n\n    # Test cases: (N, mu, sigma, theta, omega, R0, seed)\n    test_cases = [\n        # Case A (baseline stabilizing)\n        (20000, 0.0, 1.0, 0.0, 1.0, 2.0, 1),\n        # Case B (strong stabilizing)\n        (20000, 0.0, 1.0, 0.0, 0.5, 2.0, 2),\n        # Case C (near-neutral)\n        (20000, 0.0, 1.0, 0.0, 1e6, 2.0, 3),\n        # Case D (offset optimum)\n        (20000, 0.0, 1.0, 1.5, 1.0, 2.0, 4),\n    ]\n\n    results = []\n    \n    for N, mu, sigma, theta, omega, R0, seed in test_cases:\n        # Create a seeded random number generator for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # 1. Generate initial population's trait values\n        # z_i ~ N(mu, sigma^2)\n        z = rng.normal(loc=mu, scale=sigma, size=N)\n\n        # 2. Model absolute fitness and realized reproduction\n        # w(z) = exp(-(z-theta)^2 / (2*omega^2))\n        w = np.exp(-((z - theta)**2) / (2 * omega**2))\n        \n        # X_i ~ Poisson(R0 * w_i)\n        X = rng.poisson(lam=(R0 * w))\n\n        # 3. Standardize the trait for selection analysis\n        z_mean = np.mean(z)\n        # Use population standard deviation (ddof=0)\n        z_std = np.std(z, ddof=0) \n        \n        # Handle the edge case where z_std is zero\n        if z_std == 0:\n            z_tilde = np.zeros(N)\n        else:\n            z_tilde = (z - z_mean) / z_std\n\n        # 4. Estimate the realized quadratic selection gradient (gamma)\n        # Calculate relative fitness r_i = X_i / mean(X)\n        X_mean = np.mean(X)\n        if X_mean == 0:\n            # This is highly unlikely given the parameters but is a safe check.\n            # If no offspring are produced, relative fitness is undefined.\n            # We can set OLS coefficients to zero.\n            b0, b1, b2 = 0.0, 0.0, 0.0\n        else:\n            r = X / X_mean\n            \n            # Set up the design matrix for OLS: r = b0 + b1*z_tilde + b2*z_tilde^2\n            # Columns are for intercept, linear term, and quadratic term\n            Z_matrix = np.vstack([np.ones(N), z_tilde, z_tilde**2]).T\n            \n            # Solve for coefficients b = [b0, b1, b2] using OLS\n            b, _, _, _ = np.linalg.lstsq(Z_matrix, r, rcond=None)\n            b0, b1, b2 = b[0], b[1], b[2]\n\n        # Quadratic selection gradient is gamma = 2 * b2\n        gamma = 2 * b2\n\n        # 5. Quantify variance reduction\n        var_before = z_std**2\n        \n        # Post-selection statistics, weighted by offspring count X\n        # Total number of offspring\n        N_after = np.sum(X)\n        \n        if N_after == 0:\n            # If no offspring, post-selection variance is undefined, but can be set to 0.\n            # The ratio rho would be 0.\n            var_after = 0.0\n        else:\n            # Post-selection mean (weighted average)\n            mu_after = np.average(z, weights=X)\n            # Post-selection variance (weighted variance)\n            var_after = np.average((z - mu_after)**2, weights=X)\n\n        # Variance ratio rho\n        if var_before == 0:\n             # If initial variance is zero, rho is undefined (or 1 if var_after is also 0)\n            rho = 1.0 if var_after == 0.0 else np.inf\n        else:\n            rho = var_after / var_before\n\n        # Boolean flag for variance decrease\n        decreased = rho  1.0\n\n        # Append results for this case\n        results.append([gamma, rho, decreased])\n\n    # Format the final output string as per the specification\n    # e.g., \"[0.123456,0.987654,True]\"\n    # then join these strings with \", \"\n    string_parts = []\n    for g, r, b in results:\n        b_str = 'True' if b else 'False'\n        string_parts.append(f\"[{g:.6f},{r:.6f},{b_str}]\")\n    \n    final_output = f\"[{', '.join(string_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```", "id": "2818446"}]}