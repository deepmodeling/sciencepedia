{"hands_on_practices": [{"introduction": "The foundation of genetic mapping lies in understanding the relationship between the observable recombination fraction, $r$, and the theoretical map distance, $d$. This exercise clarifies that relationship by contrasting a simple linear approximation with a formal mapping function. By working through this problem, you will see firsthand why $r$ systematically underestimates $d$ due to the masking effect of multiple crossovers, a crucial insight for accurately interpreting linkage data [@problem_id:2817249].", "problem": "In a testcross of a doubly heterozygous individual, the observed recombination fraction between two loci is $r=0.18$. Using first principles of genetic mapping, do the following:\n- Estimate the map distance using the linear small-distance approximation that equates map distance (in Morgans) to recombination fraction $r$.\n- Independently estimate the map distance using an explicit no-interference mapping function based on a Poisson model of crossover formation along the interval (assume the Haldane model of no crossover interference).\n\nExpress both answers in centiMorgans (cM), and round your answers to four significant figures. Briefly justify which estimate is larger and why based on the underlying assumptions. Your final reported values must be the two numerical estimates only, with no units, in the order: linear approximation, then Haldane mapping-function estimate.", "solution": "The problem as stated is valid. It is scientifically grounded in the principles of genetic linkage analysis, is well-posed with all necessary information provided, and is expressed in objective, unambiguous language. We will now proceed with the solution.\n\nThe fundamental quantities are the recombination fraction, $r$, and the map distance, $d$. The recombination fraction $r$ is an observable quantity, defined as the proportion of recombinant offspring resulting from a cross. The map distance $d$, measured in Morgans, is a theoretical construct defined as the expected number of crossover events occurring in a chromosomal interval per meiosis. One Morgan corresponds to an average of one crossover per meiosis. A centiMorgan (cM) is $\\frac{1}{100}$ of a Morgan.\n\nThe problem provides an observed recombination fraction $r = 0.18$. We must estimate the map distance using two different models.\n\nFirst, we use the linear small-distance approximation. This model is valid only for very small values of $r$. It operates on the simplifying assumption that the probability of more than one crossover event within the interval is negligible. If at most one crossover can occur, then every crossover event results in recombinant gametes. In this case, the frequency of recombinant gametes ($r$) is equal to the frequency of crossover events ($d$).\nThus, the linear approximation is:\n$$d_{linear} \\approx r$$\nGiven $r = 0.18$, the map distance in Morgans is:\n$$d_{linear} = 0.18 \\text{ Morgans}$$\nTo express this in centiMorgans, we multiply by $100$:\n$$d_{linear, cM} = 0.18 \\times 100 = 18.00 \\text{ cM}$$\nRounding to four significant figures gives $18.00$ cM.\n\nSecond, we use the Haldane mapping function. This model assumes that crossovers are distributed along the chromosome according to a Poisson process, with a mean of $d$. This is a model of no crossover interference, meaning a crossover at one point does not affect the probability of another crossover nearby. Under the Poisson model, the probability of exactly $k$ crossovers occurring in the interval is given by:\n$$P(X=k) = \\frac{\\exp(-d)d^k}{k!}$$\nRecombination between two loci is observed only if an odd number of crossovers ($k=1, 3, 5, ...$) occurs between them. An even number of crossovers ($k=0, 2, 4, ...$) restores the parental linkage phase and thus produces non-recombinant gametes. The recombination fraction $r$ is therefore the sum of probabilities of all odd numbers of crossovers:\n$$r = \\sum_{k \\text{ odd}} P(X=k) = P(X=1) + P(X=3) + \\dots$$\nThis infinite series has a well-known closed-form solution:\n$$r = \\frac{1}{2}(1 - \\exp(-2d))$$\nThis is the Haldane mapping function. We are given $r = 0.18$ and must solve for $d$.\n$$0.18 = \\frac{1}{2}(1 - \\exp(-2d))$$\nMultiplying by $2$:\n$$0.36 = 1 - \\exp(-2d)$$\nRearranging the terms:\n$$\\exp(-2d) = 1 - 0.36 = 0.64$$\nTo solve for $d$, we take the natural logarithm of both sides:\n$$-2d = \\ln(0.64)$$\n$$d = -\\frac{1}{2}\\ln(0.64)$$\nThis gives the distance $d$ in Morgans. We calculate its numerical value:\n$$d \\approx -\\frac{1}{2}(-0.446287) \\approx 0.2231435 \\text{ Morgans}$$\nConverting to centiMorgans:\n$$d_{Haldane, cM} = 0.2231435 \\times 100 \\approx 22.31435 \\text{ cM}$$\nRounding to four significant figures gives $22.31$ cM.\n\nFinally, we must justify why the Haldane estimate ($d_{Haldane, cM} \\approx 22.31$) is larger than the linear approximation ($d_{linear, cM} = 18.00$). The discrepancy arises because the recombination fraction $r$ systematically underestimates the true map distance $d$. The linear approximation, $d \\approx r$, ignores the effect of multiple crossovers. The Haldane model explicitly accounts for them. Specifically, double crossover events (and all higher-order even-numbered crossover events) produce parental, non-recombinant haplotypes. These events contribute to the map distance $d$ (since $d$ counts all crossovers) but are not detected in the recombination fraction $r$. As the distance between genes increases, the probability of such multiple, \"masking\" crossovers becomes significant. To produce an observed recombination fraction of $r=0.18$, the true underlying frequency of crossovers, $d$, must be higher than $0.18$ to compensate for the fraction of double crossovers that are invisible to the recombination assay. The Haldane function provides the correct mathematical mapping to account for this underestimation. The linear approximation is only the first term in the Taylor series expansion of the Haldane function around $d=0$, which is $r = d - d^2 + \\dots$. For any $d > 0$, the map distance $d$ will always be greater than the recombination fraction $r$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n18.00 & 22.31\n\\end{pmatrix}\n}\n$$", "id": "2817249"}, {"introduction": "Moving from theory to application, this practice delves into the analysis of experimental data from tetrad-forming organisms, a classic model system in genetics. You will learn to estimate the recombination fraction $r$ directly from the observed counts of parental ditype (PD), nonparental ditype (NPD), and tetratype (TT) asci. More importantly, this exercise introduces the critical step of quantifying the precision of your estimate by deriving and calculating a confidence interval, a fundamental skill for any research scientist [@problem_id:2817196].", "problem": "A heterothallic fungus that forms unordered tetrads is crossed at two loci. You score and classify a total of $N=800$ complete tetrads into the three canonical classes based on spore genotypes: parental ditype (PD), tetratype (TT), and nonparental ditype (NPD). The observed counts are:\n- PD: $520$\n- TT: $250$\n- NPD: $30$\n\nAssume the following:\n- Tetrads are independent and, conditional on the underlying class probabilities, the vector of counts is multinomially distributed.\n- There is no chromatid interference and chromatid participation in crossovers is random.\n- By definition of the tetrad classes in unordered tetrads, a PD tetrad contains $0$ recombinant chromatids, a TT tetrad contains $2$ recombinant chromatids, and an NPD tetrad contains $4$ recombinant chromatids.\n\nUsing only these definitions and the multinomial sampling model as the fundamental base, do the following:\n1. Derive an estimator $\\hat{r}$ for the recombinant chromatid fraction $r$ between the two loci, and compute its numerical value from the data.\n2. Using the delta method, derive an expression for the large-sample variance of $\\hat{r}$ in terms of the class probabilities, and then obtain a numerical estimate of the standard error by substituting the empirical class proportions. Use the standard normal quantile $z_{0.975}=1.96$ to construct a $95\\%$ confidence interval for $r$ of the form $\\hat{r} \\pm z_{0.975}\\,\\mathrm{SE}(\\hat{r})$.\n\nReport the final numeric results for the point estimate $\\hat{r}$ and the lower and upper bounds of the $95\\%$ confidence interval as decimals (no percent signs), each rounded to four significant figures. Your final answer must be a single row matrix containing the three values in the order $\\hat{r}$, lower bound, upper bound.", "solution": "The posed problem is scientifically grounded, well-posed, and objective. It represents a standard statistical genetics exercise in tetrad analysis. All necessary data and definitions are provided, and the assumptions are clearly stated and consistent with common models in the field. The problem is valid and admits a unique, meaningful solution.\n\nThe objective is to estimate the recombinant chromatid fraction, $r$, between two genetic loci and to construct a confidence interval for this estimate.\n\nLet the true, unknown probabilities for observing a parental ditype (PD), tetratype (TT), or nonparental ditype (NPD) tetrad be $p_{PD}$, $p_{TT}$, and $p_{NPD}$, respectively, where $p_{PD} + p_{TT} + p_{NPD} = 1$. The observed counts $(n_{PD}, n_{TT}, n_{NPD})$ are assumed to follow a multinomial distribution with total count $N$ and these probabilities.\nThe provided data are: $N=800$, $n_{PD}=520$, $n_{TT}=250$, and $n_{NPD}=30$.\n\nThe recombinant chromatid fraction, $r$, represents the proportion of chromatids that have undergone recombination. By the problem's definition for unordered tetrads, a PD tetrad contains $0$ recombinant chromatids, a TT tetrad contains $2$, and an NPD tetrad contains $4$. A single tetrad consists of $4$ chromatids. Therefore, the expected fraction of recombinant chromatids is given by the weighted average:\n$$r = \\frac{0 \\cdot p_{PD} + 2 \\cdot p_{TT} + 4 \\cdot p_{NPD}}{4} = \\frac{1}{2} p_{TT} + p_{NPD}$$\n\n1. Derivation and computation of the estimator $\\hat{r}$.\n\nThe Maximum Likelihood Estimators (MLEs) for the multinomial probabilities are the observed sample proportions:\n$$ \\hat{p}_{PD} = \\frac{n_{PD}}{N}, \\quad \\hat{p}_{TT} = \\frac{n_{TT}}{N}, \\quad \\hat{p}_{NPD} = \\frac{n_{NPD}}{N} $$\nBy the invariance property of MLEs, the MLE for $r$, denoted $\\hat{r}$, is obtained by substituting these sample proportions into the expression for $r$:\n$$ \\hat{r} = g(\\hat{p}_{TT}, \\hat{p}_{NPD}) = \\frac{1}{2} \\hat{p}_{TT} + \\hat{p}_{NPD} = \\frac{1}{2} \\frac{n_{TT}}{N} + \\frac{n_{NPD}}{N} = \\frac{n_{TT} + 2n_{NPD}}{2N} $$\nThis estimator corresponds to the observed fraction of recombinant chromatids in the sample, which is a method-of-moments estimator and, in this case, also the MLE.\n\nUsing the provided data:\n$$ \\hat{r} = \\frac{250 + 2(30)}{2(800)} = \\frac{250 + 60}{1600} = \\frac{310}{1600} = \\frac{31}{160} = 0.19375 $$\n\n2. Derivation of the large-sample variance and construction of the confidence interval.\n\nThe estimator $\\hat{r}$ is a linear function of the random sample proportions $\\hat{p}_{TT}$ and $\\hat{p}_{NPD}$. The delta method for a linear function provides an exact formula for the variance, not an approximation. The large-sample variance of $\\hat{r}$ is derived from the covariance matrix of the multinomial proportions.\n$$ Var(\\hat{r}) = Var \\left( \\frac{1}{2} \\hat{p}_{TT} + \\hat{p}_{NPD} \\right) = \\frac{1}{4} Var(\\hat{p}_{TT}) + Var(\\hat{p}_{NPD}) + Cov(\\hat{p}_{TT}, \\hat{p}_{NPD}) $$\nFor a multinomial distribution of size $N$, the variances and covariances of the sample proportions are:\n$$ Var(\\hat{p}_i) = \\frac{p_i(1-p_i)}{N}, \\quad Cov(\\hat{p}_i, \\hat{p}_j) = -\\frac{p_i p_j}{N} \\quad \\text{for } i \\neq j $$\nSubstituting these into the variance expression for $\\hat{r}$:\n$$ Var(\\hat{r}) = \\frac{1}{4} \\frac{p_{TT}(1-p_{TT})}{N} + \\frac{p_{NPD}(1-p_{NPD})}{N} - \\frac{p_{TT}p_{NPD}}{N} $$\nThis expression can be expanded and simplified:\n$$ Var(\\hat{r}) = \\frac{1}{4N} [p_{TT}(1-p_{TT}) + 4p_{NPD}(1-p_{NPD}) - 4p_{TT}p_{NPD}] $$\n$$ Var(\\hat{r}) = \\frac{1}{4N} [p_{TT} - p_{TT}^2 + 4p_{NPD} - 4p_{NPD}^2 - 4p_{TT}p_{NPD}] $$\n$$ Var(\\hat{r}) = \\frac{1}{4N} [ (p_{TT} + 4p_{NPD}) - (p_{TT}^2 + 4p_{TT}p_{NPD} + 4p_{NPD}^2) ] $$\n$$ Var(\\hat{r}) = \\frac{(p_{TT} + 4p_{NPD}) - (p_{TT} + 2p_{NPD})^2}{4N} $$\nThis is the derived expression for the large-sample variance of $\\hat{r}$ in terms of the class probabilities.\n\nTo obtain a numerical estimate of this variance, we substitute the sample proportions for the true probabilities:\n$$ \\widehat{Var}(\\hat{r}) = \\frac{(\\hat{p}_{TT} + 4\\hat{p}_{NPD}) - (\\hat{p}_{TT} + 2\\hat{p}_{NPD})^2}{4N} $$\nFirst, we calculate the proportions:\n$$ \\hat{p}_{TT} = \\frac{250}{800} = 0.3125, \\quad \\hat{p}_{NPD} = \\frac{30}{800} = 0.0375 $$\nThen we compute the terms in the variance formula:\n$$ \\hat{p}_{TT} + 4\\hat{p}_{NPD} = 0.3125 + 4(0.0375) = 0.3125 + 0.15 = 0.4625 $$\n$$ \\hat{p}_{TT} + 2\\hat{p}_{NPD} = 0.3125 + 2(0.0375) = 0.3125 + 0.075 = 0.3875 $$\nNote that $\\hat{p}_{TT} + 2\\hat{p}_{NPD} = 2\\hat{r} = 2(0.19375) = 0.3875$, as expected.\nSubstituting these into the variance estimate formula:\n$$ \\widehat{Var}(\\hat{r}) = \\frac{0.4625 - (0.3875)^2}{4(800)} = \\frac{0.4625 - 0.15015625}{3200} = \\frac{0.31234375}{3200} \\approx 9.76074 \\times 10^{-5} $$\nThe standard error (SE) is the square root of the estimated variance:\n$$ \\mathrm{SE}(\\hat{r}) = \\sqrt{\\widehat{Var}(\\hat{r})} \\approx \\sqrt{9.76074 \\times 10^{-5}} \\approx 0.009879646 $$\nA $95\\%$ confidence interval for $r$ is constructed using the normal approximation: $\\hat{r} \\pm z_{0.975} \\, \\mathrm{SE}(\\hat{r})$. With $z_{0.975} = 1.96$:\nMargin of Error $= 1.96 \\times 0.009879646 \\approx 0.0193641$\nThe confidence interval is:\n$$ 0.19375 \\pm 0.0193641 $$\nLower Bound: $0.19375 - 0.0193641 = 0.1743859$\nUpper Bound: $0.19375 + 0.0193641 = 0.2131141$\n\nFinally, rounding the results to four significant figures as required:\nPoint estimate $\\hat{r} = 0.1938$\nLower bound $= 0.1744$\nUpper bound $= 0.2131$\n\nThese values are reported as a single row matrix.", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.1938 & 0.1744 & 0.2131 \\end{pmatrix} } $$", "id": "2817196"}, {"introduction": "In many real-world genetic studies, the linkage phase of heterozygous parents is unknown, presenting a significant analytical challenge. This advanced exercise introduces a powerful computational solution: the Expectation-Maximization (EM) algorithm. By deriving the algorithm's steps and applying it to a data set, you will learn how to jointly estimate the recombination fraction and infer the unknown phase, providing a glimpse into the sophisticated statistical methods that underpin modern genetic analysis [@problem_id:2817209].", "problem": "Consider two biallelic markers with alleles $A/a$ and $B/b$ in a testcross where a single heterozygous parent contributes gametes to a homozygous recessive tester. The heterozygous parent’s phase is unknown: it could be in coupling phase $AB/ab$ or in repulsion phase $Ab/aB$. Let the recombination fraction be $r \\in [0,0.5]$, and let $\\pi \\in (0,1)$ denote the mixing proportion that the parent is in coupling phase (so that $1-\\pi$ is the probability of repulsion phase). You observe counts of the four progeny genotype classes corresponding to gametic haplotypes, denoted by $x_{AB}$, $x_{Ab}$, $x_{aB}$, $x_{ab}$, with total $n = x_{AB} + x_{Ab} + x_{aB} + x_{ab}$.\n\nTask 1 (derivation): Starting only from the following foundations,\n- Mendelian segregation for a testcross with a single heterozygous parent, in which the two parental (non-recombinant) gametes each occur with probability $(1-r)/2$ and the two recombinant gametes each occur with probability $r/2$,\n- The definition of the recombination fraction $r$ as the probability of a recombination event between the two loci in meiosis,\n- The multinomial sampling model for counts $(x_{AB},x_{Ab},x_{aB},x_{ab})$ given category probabilities,\nderive from first principles the Expectation–Maximization (EM) algorithm (Expectation–Maximization (EM)) to jointly estimate the unknown phase (treated as a latent binary variable) and the recombination fraction $r$. In your derivation, explicitly:\n- Introduce a latent indicator $Z \\in \\{0,1\\}$ for phase, with $Z=1$ denoting coupling and $Z=0$ denoting repulsion.\n- Write the complete-data log-likelihood for $(\\pi,r)$.\n- Derive the E-step expression for the posterior weight $w = \\Pr(Z=1 \\mid \\text{data}, \\pi^{(t)}, r^{(t)})$ in terms of $(\\pi^{(t)}, r^{(t)})$ and the observed counts.\n- Derive the M-step updates $\\pi^{(t+1)}$ and $r^{(t+1)}$ that maximize the conditional expectation of the complete-data log-likelihood given the current parameters.\n\nTask 2 (implementation): Implement exactly one full EM iteration (one E-step followed by one M-step) on each of the following test cases. For numerical stability in the E-step, compute posterior weights using log-likelihoods. In the M-step, constrain the updated $r^{(t+1)}$ to the biologically valid interval $[0,0.5]$. Report all $r$ values as decimals (not as percentages).\n\nTest suite (each case provides $(x_{AB},x_{Ab},x_{aB},x_{ab},\\pi^{(0)},r^{(0)})$):\n- Case 1: $(x_{AB},x_{Ab},x_{aB},x_{ab}) = (40, 10, 12, 38)$, $\\pi^{(0)}=0.5, r^{(0)}=0.1$.\n- Case 2: $(x_{AB},x_{Ab},x_{aB},x_{ab}) = (10, 38, 40, 12)$, $\\pi^{(0)}=0.5, r^{(0)}=0.1$.\n- Case 3: $(x_{AB},x_{Ab},x_{aB},x_{ab}) = (25, 25, 25, 25)$, $\\pi^{(0)}=0.6, r^{(0)}=0.4$.\n- Case 4: $(x_{AB},x_{Ab},x_{aB},x_{ab}) = (49, 1, 1, 49)$, $\\pi^{(0)}=0.7, r^{(0)}=0.2$.\n\nFinal output format: Your program should produce a single line containing a list of results, one per test case, where each result is the two-element list $[\\pi^{(1)}, r^{(1)}]$ with both entries rounded to six decimal places. The entire output must be a single line in the form $[[\\pi^{(1)}_1,r^{(1)}_1],[\\pi^{(1)}_2,r^{(1)}_2],[\\pi^{(1)}_3,r^{(1)}_3],[\\pi^{(1)}_4,r^{(1)}_4]]$.", "solution": "The problem presented is a classic application of the Expectation-Maximization (EM) algorithm in statistical genetics, used to estimate the recombination fraction between two genetic markers when the linkage phase of the parent is unknown. The problem is well-posed, scientifically sound, and contains all necessary information for a rigorous solution. I shall proceed with the derivation as requested, followed by the computational implementation.\n\n### Task 1: Derivation of the EM Algorithm\n\nThe goal is to find the maximum likelihood estimates for the parameters $\\theta = (\\pi, r)$, where $r$ is the recombination fraction and $\\pi$ is the prior probability of the heterozygous parent being in coupling phase. The observed data are the counts of the four progeny haplotypes, $\\mathbf{x} = (x_{AB}, x_{Ab}, x_{aB}, x_{ab})$. The total number of progeny is $n = x_{AB} + x_{Ab} + x_{aB} + x_{ab}$. The linkage phase of the parent is a latent, or unobserved, variable.\n\n**1. Model Formulation and Complete-Data Likelihood**\n\nWe introduce a latent indicator variable $Z \\in \\{0, 1\\}$.\n- $Z=1$: The parent is in coupling phase ($AB/ab$).\n- $Z=0$: The parent is in repulsion phase ($Ab/aB$).\n\nThe prior probability of the parent being in coupling phase is given as $\\Pr(Z=1) = \\pi$, and thus $\\Pr(Z=0) = 1-\\pi$.\n\nThe probabilities of the four gamete types produced by the heterozygous parent depend on the phase $Z$ and the recombination fraction $r$. In a testcross, these probabilities are:\n- If $Z=1$ (coupling): The parental gametes are $AB$ and $ab$, and recombinant gametes are $Ab$ and $aB$.\n  $$p_{AB,1} = p_{ab,1} = \\frac{1-r}{2} \\quad \\text{(non-recombinant)}$$\n  $$p_{Ab,1} = p_{aB,1} = \\frac{r}{2} \\quad \\text{(recombinant)}$$\n- If $Z=0$ (repulsion): The parental gametes are $Ab$ and $aB$, and recombinant gametes are $AB$ and $ab$.\n  $$p_{Ab,0} = p_{aB,0} = \\frac{1-r}{2} \\quad \\text{(non-recombinant)}$$\n  $$p_{AB,0} = p_{ab,0} = \\frac{r}{2} \\quad \\text{(recombinant)}$$\n\nThe complete data consist of the observed counts $\\mathbf{x}$ and the latent phase $Z$. The likelihood of the complete data, denoted $L_c(\\pi, r; \\mathbf{x}, Z)$, is the probability of observing both the phase and the progeny counts:\n$$L_c(\\pi, r; \\mathbf{x}, Z) = \\Pr(Z|\\pi) \\Pr(\\mathbf{x}|Z, r)$$\nThe probability of the phase is $\\Pr(Z|\\pi) = \\pi^Z (1-\\pi)^{1-Z}$. The probability of the counts, given the phase and $r$, follows a multinomial distribution. Let us define the counts of coupling-like parental gametes as $N_P = x_{AB} + x_{ab}$ and coupling-like recombinant gametes as $N_R = x_{Ab} + x_{aB}$.\nThe conditional probabilities $\\Pr(\\mathbf{x}|Z,r)$ are:\n$$\\Pr(\\mathbf{x}|Z=1, r) = C \\cdot \\left(\\frac{1-r}{2}\\right)^{x_{AB}} \\left(\\frac{r}{2}\\right)^{x_{Ab}} \\left(\\frac{r}{2}\\right)^{x_{aB}} \\left(\\frac{1-r}{2}\\right)^{x_{ab}} = C \\cdot \\left(\\frac{1-r}{2}\\right)^{N_P} \\left(\\frac{r}{2}\\right)^{N_R}$$\n$$\\Pr(\\mathbf{x}|Z=0, r) = C \\cdot \\left(\\frac{r}{2}\\right)^{x_{AB}} \\left(\\frac{1-r}{2}\\right)^{x_{Ab}} \\left(\\frac{1-r}{2}\\right)^{x_{aB}} \\left(\\frac{r}{2}\\right)^{x_{ab}} = C \\cdot \\left(\\frac{r}{2}\\right)^{N_P} \\left(\\frac{1-r}{2}\\right)^{N_R}$$\nwhere $C = \\frac{n!}{x_{AB}! x_{Ab}! x_{aB}! x_{ab}!}$ is the multinomial coefficient.\n\nThe complete-data log-likelihood, $\\ell_c = \\log L_c$, can be written as:\n$$\\ell_c(\\pi, r) = Z \\log\\pi + (1-Z)\\log(1-\\pi) + \\log \\Pr(\\mathbf{x}|Z, r)$$\nExpanding $\\log \\Pr(\\mathbf{x}|Z, r)$ and ignoring the constant term $\\log C$:\n$$\\ell_c(\\pi, r) = Z \\log\\pi + (1-Z)\\log(1-\\pi) + Z \\left[N_P \\log(1-r) + N_R \\log r - n\\log 2 \\right] + (1-Z)\\left[N_R \\log(1-r) + N_P \\log r - n\\log 2\\right]$$\n\n**2. The E-Step: Expectation**\n\nIn the E-step of the $t$-th iteration, we compute the expectation of the complete-data log-likelihood with respect to the posterior distribution of the latent variable $Z$, given the observed data $\\mathbf{x}$ and the current parameter estimates $(\\pi^{(t)}, r^{(t)})$. This requires calculating the posterior probability of the parent being in coupling phase, which we denote by $w$:\n$$w = \\Pr(Z=1 | \\mathbf{x}, \\pi^{(t)}, r^{(t)}) = E[Z | \\mathbf{x}, \\pi^{(t)}, r^{(t)}]$$\nUsing Bayes' theorem:\n$$w = \\frac{\\Pr(Z=1|\\pi^{(t)}) \\Pr(\\mathbf{x}|Z=1, r^{(t)})}{\\Pr(Z=1|\\pi^{(t)}) \\Pr(\\mathbf{x}|Z=1, r^{(t)}) + \\Pr(Z=0|\\pi^{(t)}) \\Pr(\\mathbf{x}|Z=0, r^{(t)})}$$\nLet $L_1 = \\Pr(\\mathbf{x}|Z=1, r^{(t)})$ and $L_0 = \\Pr(\\mathbf{x}|Z=0, r^{(t)})$. The expression for $w$ becomes:\n$$w = \\frac{\\pi^{(t)} L_1}{\\pi^{(t)} L_1 + (1-\\pi^{(t)}) L_0}$$\nThe multinomial coefficient $C$ cancels from the numerator and denominator. We are left with:\n$$w = \\frac{\\pi^{(t)} (1-r^{(t)})^{N_P} (r^{(t)})^{N_R}}{\\pi^{(t)} (1-r^{(t)})^{N_P} (r^{(t)})^{N_R} + (1-\\pi^{(t)}) (r^{(t)})^{N_P} (1-r^{(t)})^{N_R}}$$\nFor numerical stability, we compute this using log-likelihoods. Let $\\ell_1 = \\log(L_1/C) = N_P \\log(1-r^{(t)}) + N_R \\log(r^{(t)})$ and $\\ell_0 = \\log(L_0/C) = N_R \\log(1-r^{(t)}) + N_P \\log(r^{(t)})$. Then we have:\n$$w = \\frac{\\pi^{(t)} e^{\\ell_1}}{\\pi^{(t)} e^{\\ell_1} + (1-\\pi^{(t)}) e^{\\ell_0}} = \\frac{1}{1 + \\frac{1-\\pi^{(t)}}{\\pi^{(t)}} e^{\\ell_0 - \\ell_1}} = \\frac{1}{1 + \\exp\\left(\\log(1-\\pi^{(t)}) - \\log(\\pi^{(t)}) + \\ell_0 - \\ell_1\\right)}$$\nThis completes the E-step. The quantity $w$ is the posterior weight for the coupling phase configuration.\n\n**3. The M-Step: Maximization**\n\nIn the M-step, we find the parameter values $(\\pi^{(t+1)}, r^{(t+1)})$ that maximize the expected complete-data log-likelihood, $Q(\\pi, r | \\pi^{(t)}, r^{(t)})$, which is defined as:\n$$Q(\\pi, r | \\pi^{(t)}, r^{(t)}) = E_{Z|\\mathbf{x}, \\theta^{(t)}}[\\ell_c(\\pi, r)]$$\nSubstituting $E[Z]=w$ and $E[1-Z]=1-w$ into the expression for $\\ell_c$:\n$$Q(\\pi, r) = w \\log\\pi + (1-w)\\log(1-\\pi) + w[N_P \\log(1-r) + N_R \\log r] + (1-w)[N_R \\log(1-r) + N_P \\log r]$$\nWe can maximize this function by optimizing with respect to $\\pi$ and $r$ separately.\n\nTo find $\\pi^{(t+1)}$, we solve $\\frac{\\partial Q}{\\partial \\pi} = 0$:\n$$\\frac{\\partial Q}{\\partial \\pi} = \\frac{w}{\\pi} - \\frac{1-w}{1-\\pi} = 0 \\implies w(1-\\pi) = (1-w)\\pi \\implies w = \\pi$$\nThus, the update rule for $\\pi$ is:\n$$\\pi^{(t+1)} = w$$\n\nTo find $r^{(t+1)}$, we group terms involving $r$ and solve $\\frac{\\partial Q}{\\partial r} = 0$:\n$$Q_r(r) = \\left(w N_P + (1-w)N_R\\right) \\log(1-r) + \\left(w N_R + (1-w)N_P\\right) \\log r$$\n$$\\frac{\\partial Q_r}{\\partial r} = -\\frac{w N_P + (1-w)N_R}{1-r} + \\frac{w N_R + (1-w)N_P}{r} = 0$$\nThis implies:\n$$r \\left(w N_P + (1-w)N_R\\right) = (1-r) \\left(w N_R + (1-w)N_P\\right)$$\n$$r \\left[ (w N_P + (1-w)N_R) + (w N_R + (1-w)N_P) \\right] = w N_R + (1-w)N_P$$\nThe term in the square brackets simplifies to $w(N_P+N_R) + (1-w)(N_R+N_P) = N_P+N_R = n$:\n$$r \\cdot n = w N_R + (1-w)N_P$$\nThe numerator is the expected number of recombinant offspring, given the data and current parameter estimates. The update rule for $r$ is the ratio of the expected number of recombinants to the total number of offspring:\n$$r^{(t+1)} = \\frac{w N_R + (1-w)N_P}{n} = \\frac{w (x_{Ab}+x_{aB}) + (1-w)(x_{AB}+x_{ab})}{n}$$\nFinally, we must enforce the biological constraint that $r \\in [0, 0.5]$. Since the calculated $r^{(t+1)}$ is always non-negative, the update is:\n$$r^{(t+1)} = \\min\\left(0.5, \\frac{w (x_{Ab}+x_{aB}) + (1-w)(x_{AB}+x_{ab})}{n}\\right)$$\nThis completes the M-step and the derivation of the EM algorithm.", "answer": "[[1.000000,0.220000],[0.000000,0.220000],[0.600000,0.500000],[1.000000,0.020000]]", "id": "2817209"}]}