{"hands_on_practices": [{"introduction": "The core of frequency-dependent selection can be elegantly captured using the tools of evolutionary game theory, where alleles are treated as competing strategies. This exercise grounds your understanding of frequency-dependent selection in a general mathematical framework. By deriving the equilibrium frequency from a simple payoff matrix, you will master the essential skill of translating strategic interactions into population-level evolutionary dynamics [@problem_id:2811537].", "problem": "A large, well-mixed haploid population carries two alleles, denoted by $A$ and $a$, at a single locus with frequencies $p$ and $1-p$, respectively. Individuals engage in a single, random, pairwise interaction each generation. The interaction is symmetric and characterized by the $2 \\times 2$ payoff matrix\n$$\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\gamma & \\delta\n\\end{pmatrix},\n$$\nwhere the entry in row $i$ and column $j$ gives the reproductive payoff to the focal type $i \\in \\{A,a\\}$ when paired with type $j \\in \\{A,a\\}$. Assume the following:\n- The reproductive payoff from the interaction is proportional to absolute fitness for that generation.\n- There is no mutation, migration, or genetic drift, and generations are discrete and non-overlapping.\n- Pairing is random, so the probability of encountering allele $A$ is $p$ and allele $a$ is $1-p$.\n\nStarting only from the foundational principle that, in discrete-time haploid selection, allele frequencies in the next generation are proportional to current frequencies multiplied by their expected absolute fitness, derive the allele-frequency dynamics for $p$ under random matching. Then, determine the internal equilibrium allele frequency $p^{\\ast}$ (with $0 < p^{\\ast} < 1$) in terms of $\\alpha$, $\\beta$, $\\gamma$, and $\\delta$, when it exists. Express your final answer as a single closed-form symbolic expression for $p^{\\ast}$. If multiple equilibria exist, report the internal one. No numerical approximation is required.", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Population: Large, well-mixed, haploid.\n- Alleles: $A$ and $a$.\n- Frequencies: $p$ for allele $A$, and $1-p$ for allele $a$.\n- Interaction: Single, random, pairwise per generation, symmetric.\n- Payoff Matrix:\n$$\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\gamma & \\delta\n\\end{pmatrix}\n$$\nwhere the entry in row $i$ and column $j$ is the payoff to type $i$ when interacting with type $j$.\n- Assumptions:\n  1. Reproductive payoff is proportional to absolute fitness.\n  2. No mutation, migration, or genetic drift.\n  3. Generations are discrete and non-overlapping.\n  4. Pairing is random.\n- Foundational Principle: Allele frequencies in the next generation are proportional to current frequencies multiplied by their expected absolute fitness.\n- Objective: Derive the allele-frequency dynamics for $p$ and determine the internal equilibrium allele frequency $p^{\\ast}$ (where $0 < p^{\\ast} < 1$).\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding:** The problem describes a canonical model of frequency-dependent selection in population genetics, often analyzed within the framework of evolutionary game theory. It is scientifically sound and a fundamental concept.\n- **Well-Posedness:** The problem provides all necessary information (alleles, frequencies, fitness structure via a payoff matrix, and the dynamic principle) to derive the requested equation and its equilibrium. It correctly specifies the search for an *internal* equilibrium, acknowledging that other equilibria ($p=0, p=1$) exist.\n- **Objectivity:** The problem is stated using formal mathematical language and symbolic parameters, free of any subjective or ambiguous terminology.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is a well-defined exercise in mathematical biology. We will proceed with the derivation.\n\nThe core of the problem lies in formalizing the concept of frequency-dependent fitness and applying the principle of discrete-time selection. Let $W_A$ and $W_a$ be the expected absolute fitnesses of individuals carrying alleles $A$ and $a$, respectively.\n\nGiven random pairing, an individual of type $A$ interacts with another type $A$ with probability $p$ and with a type $a$ with probability $1-p$. The payoffs for these interactions are $\\alpha$ and $\\beta$. Thus, the expected fitness of an $A$ individual is the weighted average of these payoffs:\n$$\nW_A = p \\cdot \\alpha + (1-p) \\cdot \\beta\n$$\nSimilarly, an individual of type $a$ interacts with type $A$ with probability $p$ (payoff $\\gamma$) and with type $a$ with probability $1-p$ (payoff $\\delta$). The expected fitness of an $a$ individual is:\n$$\nW_a = p \\cdot \\gamma + (1-p) \\cdot \\delta\n$$\nThe mean fitness of the entire population, $\\bar{W}$, is the average of the individual fitnesses, weighted by their frequencies:\n$$\n\\bar{W} = p \\cdot W_A + (1-p) \\cdot W_a\n$$\nThe problem states that the frequency of an allele in the next generation is its frequency in the current generation multiplied by its relative fitness. Let $p'$ be the frequency of allele $A$ in the next generation. According to the foundational principle provided:\n$$\np' = p \\frac{W_A}{\\bar{W}}\n$$\nThis equation describes the allele-frequency dynamics. An equilibrium is a state where the allele frequency does not change from one generation to the next, i.e., $p' = p$. This condition, represented as $\\Delta p = p' - p = 0$, is met if:\n$$\np \\frac{W_A}{\\bar{W}} = p\n$$\nThis equation has solutions if $p=0$ or if $\\frac{W_A}{\\bar{W}} = 1$, which implies $W_A = \\bar{W}$. Substituting the definition of $\\bar{W}$:\n$$\nW_A = p W_A + (1-p) W_a\n$$\n$$\n(1-p)W_A = (1-p)W_a\n$$\nThis condition is met if $p=1$ or if $W_A = W_a$.\n\nWe are tasked with finding the *internal* equilibrium, $p^{\\ast}$, for which $0 < p^{\\ast} < 1$. This equilibrium is found by setting the fitnesses of the two types equal to each other:\n$$\nW_A = W_a\n$$\nSubstituting the expressions for $W_A$ and $W_a$ at the equilibrium frequency $p^{\\ast}$:\n$$\np^{\\ast}\\alpha + (1-p^{\\ast})\\beta = p^{\\ast}\\gamma + (1-p^{\\ast})\\delta\n$$\nWe now solve this linear equation for $p^{\\ast}$. First, distribute the terms:\n$$\np^{\\ast}\\alpha + \\beta - p^{\\ast}\\beta = p^{\\ast}\\gamma + \\delta - p^{\\ast}\\delta\n$$\nNext, gather all terms involving $p^{\\ast}$ on one side and constant terms on the other:\n$$\np^{\\ast}\\alpha - p^{\\ast}\\beta - p^{\\ast}\\gamma + p^{\\ast}\\delta = \\delta - \\beta\n$$\nFactor out $p^{\\ast}$:\n$$\np^{\\ast}(\\alpha - \\beta - \\gamma + \\delta) = \\delta - \\beta\n$$\nProvided that the coefficient $(\\alpha - \\beta - \\gamma + \\delta)$ is non-zero, we can isolate $p^{\\ast}$:\n$$\np^{\\ast} = \\frac{\\delta - \\beta}{\\alpha - \\beta - \\gamma + \\delta}\n$$\nThis is the symbolic expression for the internal equilibrium allele frequency. Its existence as a valid frequency (i.e., $0 < p^{\\ast} < 1$) depends on the specific values of the payoff parameters $\\alpha$, $\\beta$, $\\gamma$, and $\\delta$. Specifically, for $p^{\\ast}$ to be between $0$ and $1$, the numerator $\\delta - \\beta$ and the denominator $\\alpha - \\beta - \\gamma + \\delta$ must have the same sign, and the absolute value of the numerator must be less than the absolute value of the denominator. The problem, however, only asks for the expression itself.", "answer": "$$\\boxed{\\frac{\\delta - \\beta}{\\alpha - \\beta - \\gamma + \\delta}}$$", "id": "2811537"}, {"introduction": "Negative frequency-dependent selection (NFDS) and overdominance are two primary mechanisms for maintaining genetic diversity. While they can result in identical equilibrium allele frequencies, their underlying dynamics differ fundamentally. This practice challenges you to look beyond the static equilibrium to analyze the system's stability, gaining deeper insight into how these selective regimes respond to perturbations [@problem_id:2811536].", "problem": "A single autosomal locus with alleles $A$ and $a$ segregates in a randomly mating, discrete-generation population under viability selection. Consider two models that both yield a stable internal equilibrium allele frequency but differ in how selection responds to deviations from equilibrium.\n\nModel $\\mathrm{OD}$ (overdominance): Genotype viabilities are constant and given by $w_{AA}=1-s$, $w_{Aa}=1$, $w_{aa}=1-t$, where $s>0$ and $t>0$ with $s<1$ and $t<1$ so that all viabilities are positive.\n\nModel $\\mathrm{NFDS}$ (negative frequency-dependent selection): Construct a symmetric, diploid, frequency-dependent viability scheme with the same internal equilibrium allele frequency $p^{\\*}$ as Model $\\mathrm{OD}$ by requiring that all genotypes have viability $1$ at $p=p^{\\*}$, the heterozygote has viability $w_{Aa}(p)\\equiv 1$ for all $p\\in[0,1]$, and the homozygote viabilities vary linearly with equal magnitude and opposite sign around $p^{\\*}$, namely $w_{AA}(p)=1-\\kappa\\,(p-p^{\\*})$ and $w_{aa}(p)=1+\\kappa\\,(p-p^{\\*})$ for some $\\kappa>0$ chosen small enough that all viabilities remain positive on $[0,1]$.\n\nLet $\\Delta p$ denote the one-generation change in allele $A$ frequency, $\\Delta p=p'-p$, under each model. Define the local restoring slope as the derivative $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}}$, whose magnitude summarizes the strength of the first-order tendency to return to equilibrium after a small perturbation.\n\nUsing only standard diploid viability-selection recursions under random mating, and linearization about the shared equilibrium $p^{\\*}$, compute the ratio $R$ of the magnitudes of these local restoring slopes under Model $\\mathrm{NFDS}$ and Model $\\mathrm{OD}$, expressed in closed form in terms of $s$, $t$, and $\\kappa$. Your final answer must be a single symbolic expression. Do not approximate or round.", "solution": "The problem requires the calculation of the ratio of the magnitudes of the local restoring slopes for two models of balancing selection, overdominance (Model OD) and negative frequency-dependent selection (Model NFDS). The local restoring slope at an equilibrium allele frequency $p^{\\*}$ is defined as the derivative of the one-generation change in allele frequency, $\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}}$.\n\nLet $p$ be the frequency of allele $A$ and $q=1-p$ be the frequency of allele $a$. Under viability selection in a randomly mating diploid population, the frequency of allele $A$ in the next generation, $p'$, is given by\n$$p' = \\frac{p^2 w_{AA} + pq w_{Aa}}{\\bar{w}}$$\nwhere $w_{ij}$ are the genotype viabilities and $\\bar{w} = p^2 w_{AA} + 2pq w_{Aa} + q^2 w_{aa}$ is the mean viability of the population. The one-generation change in allele frequency is $\\Delta p = p' - p$. Substituting the expression for $p'$ gives:\n$$\\Delta p = \\frac{p^2 w_{AA} + p(1-p) w_{Aa}}{\\bar{w}} - p = \\frac{p(p w_{AA} + (1-p) w_{Aa}) - p \\bar{w}}{\\bar{w}}$$\n$$\\Delta p = \\frac{p(p w_{AA} + (1-p) w_{Aa} - (p^2 w_{AA} + 2p(1-p) w_{Aa} + (1-p)^2 w_{aa}))}{\\bar{w}}$$\nSimplifying the numerator gives the standard expression for $\\Delta p$:\n$$\\Delta p = \\frac{p(1-p)[p w_{AA} + (1-2p) w_{Aa} - (1-p) w_{aa}]}{\\bar{w}}$$\nAn internal equilibrium frequency $p^{\\*}$ exists where $\\Delta p = 0$ for $p \\in (0,1)$. This requires the term in the square brackets to be zero:\n$$p^{\\*} w_{AA} + (1-2p^{\\*}) w_{Aa} - (1-p^{\\*}) w_{aa} = 0$$\n\nTo find the local restoring slope, we differentiate $\\Delta p$ with respect to $p$ and evaluate it at $p^{\\*}$. Let $\\Delta p(p) = \\frac{N(p)}{D(p)}$, where $N(p) = p(1-p)[p w_{AA} + (1-2p) w_{Aa} - (1-p) w_{aa}]$ and $D(p) = \\bar{w}(p)$. At equilibrium $p=p^{\\*}$, $N(p^{\\*}) = 0$. The derivative is:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{N'(p^{\\*})D(p^{\\*}) - N(p^{\\*})D'(p^{\\*})}{[D(p^{\\*})]^2} = \\frac{N'(p^{\\*})}{D(p^{\\*})} = \\frac{N'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\nLet $F(p) = p w_{AA}(p) + (1-2p) w_{Aa}(p) - (1-p) w_{aa}(p)$, so $N(p) = p(1-p)F(p)$. Then $N'(p) = (1-2p)F(p) + p(1-p)F'(p)$. At equilibrium, $F(p^{\\*})=0$, so $N'(p^{\\*}) = p^{\\*}(1-p^{\\*})F'(p^{\\*})$.\nThe local restoring slope is therefore:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}(p^{\\*})}$$\n\nFirst, we analyze Model OD. The viabilities are constant: $w_{AA}=1-s$, $w_{Aa}=1$, $w_{aa}=1-t$.\nThe equilibrium condition $p^{\\*}(1-s) + (1-2p^{\\*})(1) - (1-p^{\\*})(1-t) = 0$ simplifies to $p^{\\*}(-s-t)+t = 0$, which yields the equilibrium frequency:\n$$p^{\\*} = \\frac{t}{s+t}$$\nThe frequency of allele $a$ at equilibrium is $1-p^{\\*} = \\frac{s}{s+t}$.\nFor Model OD, the viabilities are not functions of $p$, so their derivatives are zero. $F'(p) = \\frac{d}{dp}[p(1-s) + (1-2p) - (1-p)(1-t)] = (1-s) - 2 - (-(1-t)) = -s-t$.\nSo, $F'(p^{\\*}) = -(s+t)$.\nThe mean viability at equilibrium is:\n$$\\bar{w}_{\\mathrm{OD}}(p^{\\*}) = \\left(\\frac{t}{s+t}\\right)^2(1-s) + 2\\frac{st}{(s+t)^2} + \\left(\\frac{s}{s+t}\\right)^2(1-t) = \\frac{t^2-st^2+2st+s^2-s^2t}{(s+t)^2}$$\n$$\\bar{w}_{\\mathrm{OD}}(p^{\\*}) = \\frac{(s+t)^2 - st(s+t)}{(s+t)^2} = 1 - \\frac{st}{s+t}$$\nThe slope for Model OD is:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}} = \\frac{p^{\\*}(1-p^{\\*})(-(s+t))}{1 - \\frac{st}{s+t}} = \\frac{(\\frac{t}{s+t})(\\frac{s}{s+t})(-(s+t))}{\\frac{s+t-st}{s+t}} = \\frac{-\\frac{st}{s+t}}{\\frac{s+t-st}{s+t}} = -\\frac{st}{s+t-st}$$\nThe magnitude of this slope is $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right| = \\frac{st}{s+t-st}$, since $s>0$, $t>0$ and $s,t<1$ ensure the denominator is positive.\n\nNext, we analyze Model NFDS. The model is constructed to have the same equilibrium $p^{\\*} = \\frac{t}{s+t}$.\nThe viabilities are frequency-dependent: $w_{AA}(p)=1-\\kappa(p-p^{\\*})$, $w_{Aa}(p)=1$, and $w_{aa}(p)=1+\\kappa(p-p^{\\*})$.\nAt $p=p^{\\*}$, all viabilities are equal to $1$. The mean viability at equilibrium is $\\bar{w}_{\\mathrm{NFDS}}(p^{\\*}) = (p^{\\*})^2(1) + 2p^{\\*}(1-p^{\\*})(1) + (1-p^{\\*})^2(1) = 1$.\nNow we compute $F'(p^{\\*})$ for this model. The function $F(p)$ includes frequency-dependent viabilities:\n$$F'(p) = \\frac{d}{dp}[p w_{AA}(p) + (1-2p) w_{Aa}(p) - (1-p) w_{aa}(p)]$$\nUsing the product rule:\n$$F'(p) = [w_{AA}(p) + p w'_{AA}(p)] - 2w_{Aa}(p) + w_{aa}(p) - (1-p)w'_{aa}(p)$$\nNote that $w'_{Aa}(p) = 0$. The derivatives of the homozygote viabilities are $w'_{AA}(p) = -\\kappa$ and $w'_{aa}(p) = \\kappa$.\nEvaluating at $p=p^{\\*}$:\n$$F'(p^{\\*}) = [w_{AA}(p^{\\*}) + p^{\\*} w'_{AA}(p^{\\*})] - 2w_{Aa}(p^{\\*}) + w_{aa}(p^{\\*}) - (1-p^{\\*})w'_{aa}(p^{\\*})$$\n$$F'(p^{\\*}) = [1 + p^{\\*}(-\\kappa)] - 2(1) + 1 - (1-p^{\\*})(\\kappa)$$\n$$F'(p^{\\*}) = 1 - \\kappa p^{\\*} - 2 + 1 - \\kappa + \\kappa p^{\\*} = -\\kappa$$\nThe slope for Model NFDS is:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = \\frac{p^{\\*}(1-p^{\\*})F'(p^{\\*})}{\\bar{w}_{\\mathrm{NFDS}}(p^{\\*})} = \\frac{p^{\\*}(1-p^{\\*})(-\\kappa)}{1} = -\\kappa p^{\\*}(1-p^{\\*})$$\nSubstituting $p^{\\*} = t/(s+t)$:\n$$\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}} = -\\kappa \\frac{t}{s+t} \\frac{s}{s+t} = -\\frac{\\kappa st}{(s+t)^2}$$\nThe magnitude is $\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right| = \\frac{\\kappa st}{(s+t)^2}$.\n\nFinally, we compute the ratio $R$ of the magnitudes of the restoring slopes, NFDS to OD:\n$$R = \\frac{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{NFDS}}\\right|}{\\left|\\left.\\frac{d}{dp}\\Delta p\\right|_{p^{\\*}, \\mathrm{OD}}\\right|} = \\frac{\\frac{\\kappa st}{(s+t)^2}}{\\frac{st}{s+t-st}}$$\nThe term $st$ cancels (since $s, t > 0$):\n$$R = \\frac{\\kappa}{(s+t)^2} \\cdot (s+t-st) = \\frac{\\kappa (s+t-st)}{(s+t)^2}$$\nThis is the final closed-form expression for the ratio in terms of the given parameters.", "answer": "$$\\boxed{\\frac{\\kappa(s+t-st)}{(s+t)^2}}$$", "id": "2811536"}, {"introduction": "Theoretical models are powerful, but their true test is explaining empirical data. Confronted with a time series of genotype frequencies, how can we determine whether overdominance or negative frequency-dependent selection provides a better explanation? This computational exercise bridges theory and application, guiding you through modern statistical model selection to quantitatively decide which mechanism more plausibly explains an observed evolutionary trajectory [@problem_id:2811510].", "problem": "You are given longitudinal genotype count data from a diploid pathogen antigen locus sampled once per discrete generation. The goal is to construct a quantitative, likelihood-based test to distinguish negative frequency-dependent selection (NFDS) from overdominance (heterozygote advantage with constant genotype fitness) using only these genotype time series. Your program must implement both models from first principles, estimate their parameters by maximum likelihood, compare them using an information-theoretic criterion, and classify which model better explains each dataset.\n\nThe fundamental base to be used consists of the following well-tested principles in population and quantitative genetics:\n- Random mating in a large diploid population implies Hardy–Weinberg genotype proportions at the zygotic stage: if the allele frequency of allele $A$ at generation $t$ is $p_t \\in (0,1)$, then the pre-selection genotype frequencies are $p_t^2$ for $AA$, $2 p_t (1-p_t)$ for $Aa$, and $(1-p_t)^2$ for $aa$.\n- Selection acts on genotypes via relative fitnesses, and the next generation’s allele frequency $p_{t+1}$ follows from weighting zygotic genotype frequencies by their fitnesses and applying Mendelian segregation. This is the standard Wright–Fisher selection recursion in discrete generations.\n- Observed genotype counts at each generation (sampled prior to selection) are distributed as independent multinomial draws with probabilities given by the Hardy–Weinberg genotype frequencies corresponding to the true $p_t$ for that generation.\n- The corrected Akaike Information Criterion (AICc) provides an information-theoretic model comparison for likelihood-based fits under finite samples.\n\nModel definitions to be implemented:\n- Overdominance (OD): Constant genotype fitnesses with $w_{AA} = 1 - s$, $w_{Aa} = 1$, $w_{aa} = 1 - t$, where $s \\in (0,1)$ and $t \\in (0,1)$. The allele frequency recursion $p_{t} \\mapsto p_{t+1}$ must be derived from the above principles. The model’s free parameters are $(s, t, p_0)$, where $p_0 \\in (0,1)$ is the initial allele $A$ frequency at the first observed generation.\n- Negative frequency-dependent selection (NFDS): Allele-specific fitness penalties that increase with current allele frequency, with additive contribution to genotype fitness. Let $\\alpha_A \\in (0,1)$ and $\\alpha_a \\in (0,1)$ quantify the strength of NFDS acting on alleles $A$ and $a$, respectively. At generation $t$, define allele-frequency–dependent genotype fitnesses by averaging the allelic penalties: $w_{AA}(p_t)$, $w_{Aa}(p_t)$, $w_{aa}(p_t)$. The allele frequency recursion $p_{t} \\mapsto p_{t+1}$ must be derived from the above principles. The model’s free parameters are $(\\alpha_A, \\alpha_a, p_0)$.\n\nStatistical inference to be implemented:\n- For a given model $M$ with parameter vector $\\theta$ and implied allele-frequency trajectory $\\{p_t(\\theta)\\}_{t=0}^{T}$, the likelihood of the observed genotype counts $\\{(n_{AA,t}, n_{Aa,t}, n_{aa,t})\\}_{t=0}^{T}$ is the product over generations of multinomial probabilities with probabilities $(p_t^2, 2 p_t (1-p_t), (1-p_t)^2)$. You must use the log-likelihood $\\ell(\\theta) = \\sum_{t=0}^{T} \\sum_{g \\in \\{AA,Aa,aa\\}} n_{g,t} \\log q_{g,t}$, where $q_{AA,t} = p_t^2$, $q_{Aa,t} = 2 p_t (1-p_t)$, $q_{aa,t} = (1-p_t)^2$.\n- For each model, numerically maximize the log-likelihood over its parameter bounds to obtain the maximum likelihood estimate (MLE) and the maximum log-likelihood value $\\ell_{\\max}$.\n- Compute the corrected Akaike Information Criterion (AICc) for each model as\n$$\n\\mathrm{AICc} = -2 \\,\\ell_{\\max} + 2 k + \\frac{2 k (k+1)}{n - k - 1},\n$$\nwhere $k$ is the number of free parameters of the model and $n$ is the number of observed generations (i.e., the number of multinomial observations). If $n - k - 1 \\le 0$, use $\\mathrm{AIC} = -2 \\,\\ell_{\\max} + 2 k$.\n- Decision rule per dataset: select NFDS if $\\mathrm{AICc}_{\\mathrm{NFDS}} + \\Delta < \\mathrm{AICc}_{\\mathrm{OD}}$, otherwise select OD, where $\\Delta = 2.0$ is the selection threshold. Report $1$ for NFDS selected, $0$ for OD selected.\n\nImplementation details that must be adhered to:\n- You must derive and implement the allele-frequency recursion $p_{t} \\mapsto p_{t+1}$ for each model from the above principles, ensuring $p_t \\in (0,1)$ for all $t$ and fitnesses remain positive given the parameter bounds.\n- The optimizer must handle bound constraints, and you should stabilize computations by flooring probabilities away from $0$ when evaluating $\\log$ to avoid undefined values.\n\nTest suite (three datasets) to ensure coverage of distinct regimes:\n- Dataset A (expected OD-like dynamics; monotone approach from high $p_t$):\n  - Time-indexed genotype counts $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$ for $t = 0, 1, 2, 3, 4, 5, 6$:\n    - $[(256,128,16),(218,155,27),(184,175,41),(155,188,57),(131,196,73),(112,199,89),(98,200,102)]$\n- Dataset B (expected NFDS-like dynamics; asymmetric rare-allele advantage):\n  - Time-indexed genotype counts $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$ for $t = 0, 1, 2, 3, 4, 5, 6$:\n    - $[(256,128,16),(221,153,26),(191,171,38),(164,184,52),(142,193,65),(124,197,79),(110,200,90)]$\n- Dataset C (near-neutral edge case with very slow dynamics around intermediate frequency):\n  - Time-indexed genotype counts $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$ for $t = 0, 1, 2, 3, 4, 5, 6$:\n    - $[(108,200,92),(108,199,93),(108,200,92),(107,200,93),(107,200,93),(107,200,93),(106,200,94)]$\n\nYour program must:\n- Implement maximum likelihood parameter estimation with bound-constrained numerical optimization for each model on each dataset.\n- Compute $\\mathrm{AICc}$ for each model on each dataset.\n- Apply the decision rule with threshold $\\Delta = 2.0$ to classify each dataset as NFDS ($1$) or OD ($0$).\n- Produce a single line of output containing the three integer results, in order for Datasets A, B, C, as a comma-separated list enclosed in square brackets (e.g., $[0,1,0]$). No other output is allowed.", "solution": "The problem is well-posed and grounded in fundamental principles of population genetics. We will proceed to derive the necessary formulae and construct the computational solution.\n\nThe foundation of our analysis is the standard Wright-Fisher model for a large, randomly mating diploid population with discrete generations. Let $p_t$ be the frequency of allele $A$ at generation $t$, and $1-p_t$ be the frequency of allele $a$. Under the assumption of random mating, the genotype frequencies at the zygotic stage are given by Hardy-Weinberg proportions:\n$$\n\\begin{cases}\n    \\text{freq}(AA) = p_t^2 \\\\\n    \\text{freq}(Aa) = 2 p_t (1-p_t) \\\\\n    \\text{freq}(aa) = (1-p_t)^2\n\\end{cases}\n$$\nSelection acts upon these genotypes, with relative fitnesses $w_{AA}$, $w_{Aa}$, and $w_{aa}$. The mean fitness of the population at generation $t$ is the weighted average of genotype fitnesses:\n$$\n\\bar{w}_t = p_t^2 w_{AA} + 2 p_t (1-p_t) w_{Aa} + (1-p_t)^2 w_{aa}\n$$\nThe frequency of allele $A$ in the next generation, $p_{t+1}$, is derived from the proportion of $A$ alleles in the gene pool after selection. This yields the general recursion:\n$$\np_{t+1} = \\frac{p_t^2 w_{AA} + p_t (1-p_t) w_{Aa}}{\\bar{w}_t}\n$$\nWe now specify this recursion for the two competing models.\n\n\\textbf{Model 1: Overdominance (OD)}\n\nThis model posits constant genotype fitnesses, with the heterozygote having the highest fitness. The fitnesses are defined relative to the heterozygote:\n$$\nw_{AA} = 1 - s, \\quad w_{Aa} = 1, \\quad w_{aa} = 1 - t\n$$\nThe parameters of this model are the selection coefficients $s \\in (0,1)$, $t \\in (0,1)$, and the initial allele frequency $p_0 \\in (0,1)$. The total number of free parameters is $k_{\\text{OD}} = 3$.\nThe mean fitness $\\bar{w}_t$ under this model is:\n$$\n\\bar{w}_t = p_t^2 (1-s) + 2p_t(1-p_t) + (1-p_t)^2(1-t) = 1 - s p_t^2 - t(1-p_t)^2\n$$\nSubstituting these fitnesses into the general recursion gives the allele frequency dynamics for the OD model:\n$$\np_{t+1}^{\\text{OD}} = \\frac{p_t^2 (1-s) + p_t (1-p_t)}{1 - s p_t^2 - t(1-p_t)^2} = \\frac{p_t(1 - s p_t)}{1 - s p_t^2 - t(1-p_t)^2}\n$$\n\n\\textbf{Model 2: Negative Frequency-Dependent Selection (NFDS)}\n\nThis model assumes that an allele's contribution to fitness is penalized in proportion to its own frequency. Let $\\alpha_A \\in (0,1)$ and $\\alpha_a \\in (0,1)$ be the selection intensity parameters. The problem statement specifies an additive contribution of allelic effects to genotype fitness. We interpret this by defining frequency-dependent genotype fitnesses based on allelic penalties that are linear in frequency:\n$$\n\\begin{aligned}\nw_{AA}(p_t) &= 1 - \\alpha_A p_t \\\\\nw_{Aa}(p_t) &= 1 - \\frac{\\alpha_A p_t + \\alpha_a(1-p_t)}{2} \\\\\nw_{aa}(p_t) &= 1 - \\alpha_a(1-p_t)\n\\end{aligned}\n$$\nThe heterozygote fitness is the average of the two homozygote fitnesses, representing additive gene action on the fitness scale, which is a standard approach. The parameters are $\\alpha_A$, $\\alpha_a$, and $p_0$, all in $(0,1)$, thus the number of free parameters is $k_{\\text{NFDS}} = 3$.\nThe mean fitness $\\bar{w}_t$ is calculated by averaging over genotypes:\n$$\n\\bar{w}_t = p_t^2 w_{AA}(p_t) + 2 p_t(1-p_t) w_{Aa}(p_t) + (1-p_t)^2 w_{aa}(p_t)\n$$\nSubstituting the fitness definitions and simplifying yields a compact form:\n$$\n\\bar{w}_t = 1 - \\alpha_A p_t^2 - \\alpha_a (1-p_t)^2\n$$\nThe numerator of the recursion is $p_t^2 w_{AA}(p_t) + p_t (1-p_t) w_{Aa}(p_t)$, which represents the total frequency of allele $A$ after selection. The allele frequency recursion for the NFDS model is therefore:\n$$\np_{t+1}^{\\text{NFDS}} = \\frac{p_t \\left(p_t(1-\\alpha_A p_t) + (1-p_t)\\left(1 - \\frac{\\alpha_A p_t + \\alpha_a(1-p_t)}{2}\\right)\\right)}{1 - \\alpha_A p_t^2 - \\alpha_a (1-p_t)^2}\n$$\n\n\\textbf{Statistical Inference and Model Selection}\n\nFor a given model $M$ with parameters $\\theta_M$, we generate a trajectory of allele frequencies $\\{p_t(\\theta_M)\\}_{t=0}^{T}$ using the corresponding recursion, starting from $p_0$. The observed genotype counts at generation $t$, $(n_{AA,t}, n_{Aa,t}, n_{aa,t})$, are assumed to be a single draw from a multinomial distribution with total count $N_t = n_{AA,t} + n_{Aa,t} + n_{aa,t}$ and probabilities determined by the predicted Hardy-Weinberg frequencies:\n$q_{AA,t} = p_t^2$, $q_{Aa,t} = 2 p_t(1-p_t)$, and $q_{aa,t} = (1-p_t)^2$.\nThe log-likelihood of the parameters $\\theta_M$ given the full time-series data $D = \\{(n_{AA,t}, n_{Aa,t}, n_{aa,t})\\}_{t=0}^{T}$ is the sum of the log-likelihoods for each independent multinomial observation:\n$$\n\\ell(\\theta_M | D) = \\sum_{t=0}^{T} \\left( n_{AA,t} \\log(q_{AA,t}) + n_{Aa,t} \\log(q_{Aa,t}) + n_{aa,t} \\log(q_{aa,t}) \\right)\n$$\nWe implement a numerical optimization procedure to find the maximum likelihood estimates (MLEs) of the parameters for each model, $\\hat{\\theta}_M$, which maximizes this function. This gives the maximum log-likelihood, $\\ell_{\\max, M} = \\ell(\\hat{\\theta}_M | D)$.\n\nTo compare the two models, we use the corrected Akaike Information Criterion (AICc), which penalizes models for the number of free parameters, $k$, and is suitable for small sample sizes, $n$.\n$$\n\\mathrm{AICc} = -2 \\ell_{\\max} + 2k + \\frac{2k(k+1)}{n-k-1}\n$$\nIn this problem, the number of observed generations is $n=7$ for all datasets. Both models have $k=3$ parameters. The denominator $n-k-1 = 7-3-1=3$ is positive, so the AICc formula is used directly.\n\nThe decision rule is to select the model with the lower AICc value. A selection threshold $\\Delta = 2.0$ is introduced to provide a buffer against overfitting, favoring the conceptually simpler OD model by default. We select NFDS if and only if:\n$$\n\\mathrm{AICc}_{\\mathrm{NFDS}} + \\Delta < \\mathrm{AICc}_{\\mathrm{OD}}\n$$\nGiven that both models have the same number of parameters ($k=3$), this inequality simplifies to a direct comparison of maximum log-likelihoods: an NFDS classification requires $\\ell_{\\max, \\text{NFDS}} > \\ell_{\\max, \\text{OD}} + \\frac{\\Delta}{2}$. With $\\Delta=2.0$, we select NFDS if its maximum log-likelihood is greater than that of OD by more than $1.0$. Otherwise, we select OD. The result is encoded as $1$ for NFDS and $0$ for OD. The implementation will execute this procedure for each of the three provided datasets.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the model selection problem for the three datasets.\n    \"\"\"\n    \n    # Define test cases from the problem statement\n    test_cases = [\n        # Dataset A\n        np.array([(256, 128, 16), (218, 155, 27), (184, 175, 41), (155, 188, 57), \n                  (131, 196, 73), (112, 199, 89), (98, 200, 102)]),\n        # Dataset B\n        np.array([(256, 128, 16), (221, 153, 26), (191, 171, 38), (164, 184, 52), \n                  (142, 193, 65), (124, 197, 79), (110, 200, 90)]),\n        # Dataset C\n        np.array([(108, 200, 92), (108, 199, 93), (108, 200, 92), (107, 200, 93), \n                  (107, 200, 93), (107, 200, 93), (106, 200, 94)])\n    ]\n    \n    results = []\n    for counts in test_cases:\n        results.append(process_dataset(counts))\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\ndef process_dataset(counts):\n    \"\"\"\n    Performs model fitting and selection for a single dataset.\n    \n    Args:\n        counts (np.ndarray): A (T x 3) array of genotype counts (n_AA, n_Aa, n_aa).\n    \n    Returns:\n        int: 1 if NFDS is selected, 0 if OD is selected.\n    \"\"\"\n    n = counts.shape[0]  # Number of generations\n    k = 3  # Number of parameters for both models\n    delta = 2.0\n    \n    # Estimate initial p0 from data for a better starting guess\n    n_AA_0, n_Aa_0, n_aa_0 = counts[0]\n    total_alleles_0 = 2 * (n_AA_0 + n_Aa_0 + n_aa_0)\n    p0_guess = (2 * n_AA_0 + n_Aa_0) / total_alleles_0\n\n    # Bounds for parameters (s, t, p0) or (alpha_A, alpha_a, p0)\n    epsilon = 1e-9\n    bounds = [(epsilon, 1 - epsilon), (epsilon, 1 - epsilon), (epsilon, 1 - epsilon)]\n\n    # --- Overdominance (OD) Model Fitting ---\n    x0_od = [0.1, 0.1, p0_guess]  # Initial guess for (s, t, p0)\n    res_od = minimize(\n        neg_log_likelihood,\n        x0_od,\n        args=(counts, 'OD'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_od = -res_od.fun\n\n    # --- Negative Frequency-Dependent Selection (NFDS) Model Fitting ---\n    x0_nfds = [0.1, 0.1, p0_guess] # Initial guess for (alpha_A, alpha_a, p0)\n    res_nfds = minimize(\n        neg_log_likelihood,\n        x0_nfds,\n        args=(counts, 'NFDS'),\n        method='L-BFGS-B',\n        bounds=bounds\n    )\n    ll_max_nfds = -res_nfds.fun\n\n    # --- Model Comparison using AICc ---\n    aicc_od = calculate_aicc(ll_max_od, k, n)\n    aicc_nfds = calculate_aicc(ll_max_nfds, k, n)\n\n    if aicc_nfds + delta < aicc_od:\n        return 1  # Select NFDS\n    else:\n        return 0  # Select OD\n\ndef neg_log_likelihood(params, counts, model):\n    \"\"\"\n    Calculates the negative log-likelihood for a given model and parameters.\n    \n    Args:\n        params (list): Model parameters: (s, t, p0) for OD or (alpha_A, alpha_a, p0) for NFDS.\n        counts (np.ndarray): Genotype counts data.\n        model (str): 'OD' or 'NFDS'.\n        \n    Returns:\n        float: Negative log-likelihood.\n    \"\"\"\n    num_generations = counts.shape[0]\n    p_traj = np.zeros(num_generations)\n    p_traj[0] = params[2] # p0\n    \n    # Generate allele frequency trajectory\n    for t in range(num_generations - 1):\n        p_curr = np.clip(p_traj[t], 1e-9, 1 - 1e-9)\n        if model == 'OD':\n            s, t_param = params[0], params[1]\n            p_traj[t+1] = p_next_od(p_curr, s, t_param)\n        elif model == 'NFDS':\n            alpha_A, alpha_a = params[0], params[1]\n            p_traj[t+1] = p_next_nfds(p_curr, alpha_A, alpha_a)\n\n    # Clip entire trajectory for stability in log\n    p_traj = np.clip(p_traj, 1e-9, 1 - 1e-9)\n\n    # Calculate HWE frequencies from trajectory\n    q_AA = p_traj**2\n    q_Aa = 2 * p_traj * (1 - p_traj)\n    q_aa = (1 - p_traj)**2\n\n    # Calculate log-likelihood\n    log_lik = np.sum(\n        counts[:, 0] * np.log(q_AA) +\n        counts[:, 1] * np.log(q_Aa) +\n        counts[:, 2] * np.log(q_aa)\n    )\n    \n    if np.isnan(log_lik):\n        return np.inf\n        \n    return -log_lik\n\ndef p_next_od(p_curr, s, t):\n    \"\"\"Allele frequency recursion for the OD model.\"\"\"\n    numerator = p_curr * (1 - s * p_curr)\n    denominator = 1 - s * p_curr**2 - t * (1 - p_curr)**2\n    return numerator / denominator\n\ndef p_next_nfds(p_curr, alpha_A, alpha_a):\n    \"\"\"Allele frequency recursion for the NFDS model.\"\"\"\n    p = p_curr\n    w_AA = 1 - alpha_A * p\n    w_Aa = 1 - 0.5 * (alpha_A * p + alpha_a * (1 - p))\n    \n    num_term = p * (p * w_AA + (1 - p) * w_Aa)\n    w_bar = 1 - alpha_A * p**2 - alpha_a * (1 - p)**2\n\n    return num_term / w_bar\n\ndef calculate_aicc(ll_max, k, n):\n    \"\"\"Calculates the corrected Akaike Information Criterion.\"\"\"\n    if n - k - 1 <= 0: # Fallback to AIC as per problem statement\n        return -2 * ll_max + 2 * k\n    else:\n        correction = (2 * k * (k + 1)) / (n - k - 1)\n        return -2 * ll_max + 2 * k + correction\n\nif __name__ == '__main__':\n    solve()\n```", "id": "2811510"}]}