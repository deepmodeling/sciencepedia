{"hands_on_practices": [{"introduction": "The first step in any analysis of molecular evolution is to quantify the differences between sequences. This practice grounds you in the fundamental calculation of divergence at synonymous and nonsynonymous sites. By directly using counts of observed differences and the number of potential sites for change, you will compute the raw proportions of divergence, denoted as $p_S$ and $p_N$ [@problem_id:2844396]. Mastering this initial, 'naive' calculation is crucial for understanding where these basic metrics originate before proceeding to more sophisticated models that account for hidden changes.", "problem": "A pairwise alignment of a protein-coding gene between two species spans $100$ codons, for a total of $300$ nucleotide positions. Under the standard genetic code, the gene is annotated with $230$ synonymous sites and $70$ nonsynonymous sites, where a “site” is counted fractionally according to the genetic-code degeneracy and then summed across the gene. In the alignment, there are $70$ observed synonymous differences and $21$ observed nonsynonymous differences.\n\nStarting from the foundational definitions that, in the absence of multiple-hit correction, the observed per-site divergence in each site class equals the number of observed differences divided by the number of sites in that class, and that the nonsynonymous-to-synonymous rate ratio (often denoted $d_N/d_S$ or $\\omega$) is defined as the ratio of the nonsynonymous substitution rate to the synonymous substitution rate, compute the following quantities without multiple-hit correction:\n- the synonymous divergence per synonymous site, $p_{S}$,\n- the nonsynonymous divergence per nonsynonymous site, $p_{N}$,\n- and the naive rate ratio $\\omega = d_{N}/d_{S}$ using $d_{S}=p_{S}$ and $d_{N}=p_{N}$.\n\nReport all three values as exact rational numbers with no rounding. Provide your final result as a row vector $\\big(p_{S},\\,p_{N},\\,\\omega\\big)$.", "solution": "The problem statement is subjected to validation.\n\nStep 1: Extract Givens.\n- Length of alignment: $100$ codons, total of $300$ nucleotide positions.\n- Number of synonymous sites: $S = 230$.\n- Number of nonsynonymous sites: $N = 70$.\n- Number of observed synonymous differences: $S_d = 70$.\n- Number of observed nonsynonymous differences: $N_d = 21$.\n- Definition of per-site divergence (without multiple-hit correction): number of observed differences divided by the number of sites in that class. This corresponds to $p_S$ and $p_N$.\n- Definition of nonsynonymous-to-synonymous rate ratio: $\\omega = d_{N}/d_{S}$.\n- Condition for calculation: use the naive assumption that $d_{S}=p_{S}$ and $d_{N}=p_{N}$.\n- Required output: three quantities, $p_S$, $p_N$, and $\\omega$, reported as exact rational numbers in a row vector.\n\nStep 2: Validate Using Extracted Givens.\nThe problem is scientifically grounded, as it concerns the fundamental concepts of molecular evolution, specifically the calculation of substitution rates. The concepts of synonymous sites ($S$), nonsynonymous sites ($N$), synonymous differences ($S_d$), and nonsynonymous differences ($N_d$) are standard in the field. The provided data are internally consistent; the total number of sites is $S + N = 230 + 70 = 300$, which matches the total number of nucleotide positions in a sequence of $100$ codons ($100 \\text{ codons} \\times 3 \\text{ nucleotides/codon} = 300$). The problem is well-posed, providing all necessary definitions and data to compute a unique solution. The instruction to forgo multiple-hit correction is a valid simplifying assumption for an introductory problem, leading to the calculation of \"p-distance\" for each site class. The problem is objective and contains no ambiguities.\n\nStep 3: Verdict and Action.\nThe problem is valid. The solution will proceed.\n\nThe problem requires the computation of three quantities related to sequence divergence: the synonymous divergence per synonymous site ($p_S$), the nonsynonymous divergence per nonsynonymous site ($p_N$), and the ratio of these rates under a simplifying assumption ($\\omega$).\n\nThe given quantities are:\n- Number of synonymous sites, $S = 230$.\n- Number of nonsynonymous sites, $N = 70$.\n- Number of observed synonymous differences, $S_d = 70$.\n- Number of observed nonsynonymous differences, $N_d = 21$.\n\nThe problem defines the observed per-site divergence for each class as the number of observed differences divided by the number of sites in that class. This gives the definitions for $p_S$ and $p_N$.\n\nFirst, we calculate the synonymous divergence per synonymous site, $p_S$. This is the proportion of synonymous sites that show a difference between the two sequences.\n$$p_S = \\frac{S_d}{S}$$\nSubstituting the given values:\n$$p_S = \\frac{70}{230}$$\nThis fraction can be simplified by dividing the numerator and denominator by their greatest common divisor, which is $10$.\n$$p_S = \\frac{7}{23}$$\n\nSecond, we calculate the nonsynonymous divergence per nonsynonymous site, $p_N$. This is the proportion of nonsynonymous sites at which a difference is observed.\n$$p_N = \\frac{N_d}{N}$$\nSubstituting the given values:\n$$p_N = \\frac{21}{70}$$\nThis fraction can be simplified by dividing the numerator and denominator by their greatest common divisor, which is $7$.\n$$p_N = \\frac{3}{10}$$\n\nThird, we compute the ratio $\\omega = d_N/d_S$. The problem explicitly states to use the naive approximation where the substitution rates $d_N$ and $d_S$ are taken to be equal to the observed divergences $p_N$ and $p_S$, respectively. This simplification ignores the possibility of multiple substitutions occurring at the same site, which would cause an underestimation of the true evolutionary distance, but we must follow the problem's directive.\nTherefore, we set $d_N = p_N$ and $d_S = p_S$. The ratio $\\omega$ is then:\n$$\\omega = \\frac{d_N}{d_S} = \\frac{p_N}{p_S}$$\nSubstituting the previously calculated values for $p_N$ and $p_S$:\n$$\\omega = \\frac{3/10}{7/23}$$\nTo simplify this complex fraction, we multiply the numerator by the reciprocal of the denominator:\n$$\\omega = \\frac{3}{10} \\times \\frac{23}{7} = \\frac{3 \\times 23}{10 \\times 7} = \\frac{69}{70}$$\n\nThe three quantities are $p_S = \\frac{7}{23}$, $p_N = \\frac{3}{10}$, and $\\omega = \\frac{69}{70}$. The problem asks for these to be reported as a row vector $\\big(p_{S},\\,p_{N},\\,\\omega\\big)$.\nThe final result is the vector containing these three exact rational numbers.", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{7}{23} & \\frac{3}{10} & \\frac{69}{70} \\end{pmatrix}}$$", "id": "2844396"}, {"introduction": "Observed sequence differences often tell an incomplete story, as multiple substitutions at the same site over long evolutionary timescales can go uncounted—a phenomenon known as mutational saturation. This exercise introduces a crucial correction for this issue by applying the classic Jukes-Cantor (1969) model of nucleotide substitution [@problem_id:2844443]. You will learn to transform the observed proportions of differences, $p_S$ and $p_N$, into more accurate estimates of evolutionary distance, $d_S$ and $d_N$, providing a more reliable foundation for inferring selective pressure.", "problem": "A pair of closely related protein-coding DNA sequences is analyzed by partitioning codon positions into synonymous and nonsynonymous site classes using the genetic code. Assume that substitutions at each site class follow an independent, homogeneous continuous-time Markov chain on the four nucleotides with equal exchangeabilities among all nucleotide pairs and equal stationary base frequencies (the Jukes–Cantor model). Let the observed fraction of differing sites between the two sequences be $p_{S}$ among synonymous sites and $p_{N}$ among nonsynonymous sites. Under this model, the observed fraction of differences $p$ at time $t$ is related to the expected number of substitutions per site $d$ by an exponential decay of the probability of identity, determined by the eigenstructure of the rate matrix and the total rate of leaving a state.\n\nUsing this framework, first derive the functional relationship linking $p$ to $d$ and then invert it to obtain $d$ in terms of $p$. Apply the resulting expression separately to the synonymous and nonsynonymous partitions to compute $d_{S}$ and $d_{N}$ from the following observed proportions:\n- $p_{S} = 0.18$\n- $p_{N} = 0.06$\n\nFinally, compute the ratio $\\omega$, defined as the nonsynonymous to synonymous substitution rate ratio $\\omega = d_{N}/d_{S}$, and briefly state what regime of selection this $\\omega$ implies for the protein-coding sequence. Report $d_{S}$, $d_{N}$, and $\\omega$ each rounded to $4$ significant figures. Express the three reported quantities as unitless numbers (expected substitutions per site are dimensionless).", "solution": "The problem as stated is scientifically grounded, well-posed, and contains all necessary information for a unique and meaningful solution. We will proceed with the derivation and calculation.\n\nThe problem specifies the Jukes–Cantor (1969) model of nucleotide substitution. This is a continuous-time Markov model with a $4 \\times 4$ rate matrix $Q$, where the rate of substitution from any nucleotide $i$ to any other nucleotide $j$ ($i \\neq j$) is a constant, $\\alpha$. The diagonal elements $Q_{ii}$ are defined such that the sum of each row is zero, so $Q_{ii} = -3\\alpha$. The rate matrix is:\n$$\nQ = \\begin{pmatrix}\n-3\\alpha & \\alpha & \\alpha & \\alpha \\\\\n\\alpha & -3\\alpha & \\alpha & \\alpha \\\\\n\\alpha & \\alpha & -3\\alpha & \\alpha \\\\\n\\alpha & \\alpha & \\alpha & -3\\alpha\n\\end{pmatrix} = \\alpha \\begin{pmatrix}\n-3 & 1 & 1 & 1 \\\\\n1 & -3 & 1 & 1 \\\\\n1 & 1 & -3 & 1 \\\\\n1 & 1 & 1 & -3\n\\end{pmatrix}\n$$\nThe probability transition matrix for a time interval $t$ is given by $P(t) = \\exp(Qt)$. Due to the symmetry of $Q$, we can find a closed-form expression. The probability that a site has the same nucleotide after time $t$, $P_{ii}(t)$, and the probability that it has changed to a specific different nucleotide, $P_{ij}(t)$ for $i \\neq j$, are:\n$$ P_{ii}(t) = \\frac{1}{4} + \\frac{3}{4}\\exp(-4\\alpha t) $$\n$$ P_{ij}(t) = \\frac{1}{4} - \\frac{1}{4}\\exp(-4\\alpha t) \\quad (i \\neq j) $$\nWe are considering two sequences that diverged from a common ancestor $t$ time units ago. The total evolutionary time separating them is $2t$. Let us find the probability, $F$, that a site is identical in both sequences. Assuming the ancestral nucleotide was state $k$, the site will be identical in the descendants if both lineages end in the same state $m$. The probability of this, summed over all possible final states $m$, is:\n$$ F = \\sum_{m=A,C,G,T} P_{km}(t) \\cdot P_{km}(t) = (P_{kk}(t))^2 + 3(P_{kj}(t))^2 \\quad (j \\neq k) $$\nwhere the term $P_{kk}(t)$ corresponds to both lineages having the same nucleotide as the ancestor, and the term $3(P_{kj}(t))^2$ corresponds to both lineages having changed to the *same* new nucleotide. Because the stationary distribution is uniform ($\\pi_i = 1/4$ for all $i$), this result is independent of the ancestral state $k$.\nSubstituting the expressions for $P_{ii}(t)$ and $P_{ij}(t)$:\n$$ F = \\left(\\frac{1}{4} + \\frac{3}{4}\\exp(-4\\alpha t)\\right)^2 + 3\\left(\\frac{1}{4} - \\frac{1}{4}\\exp(-4\\alpha t)\\right)^2 $$\n$$ F = \\frac{1}{16} \\left[ (1 + 3\\exp(-4\\alpha t))^2 + 3(1 - \\exp(-4\\alpha t))^2 \\right] $$\n$$ F = \\frac{1}{16} \\left[ (1 + 6\\exp(-4\\alpha t) + 9\\exp(-8\\alpha t)) + 3(1 - 2\\exp(-4\\alpha t) + \\exp(-8\\alpha t)) \\right] $$\n$$ F = \\frac{1}{16} \\left[ 1 + 6\\exp(-4\\alpha t) + 9\\exp(-8\\alpha t) + 3 - 6\\exp(-4\\alpha t) + 3\\exp(-8\\alpha t) \\right] $$\n$$ F = \\frac{1}{16} [4 + 12\\exp(-8\\alpha t)] = \\frac{1}{4} + \\frac{3}{4}\\exp(-8\\alpha t) $$\nThe observed fraction of differing sites, $p$, is the probability of non-identity, which is $1-F$.\n$$ p = 1 - F = 1 - \\left(\\frac{1}{4} + \\frac{3}{4}\\exp(-8\\alpha t)\\right) = \\frac{3}{4} - \\frac{3}{4}\\exp(-8\\alpha t) = \\frac{3}{4}(1 - \\exp(-8\\alpha t)) $$\nNext, we must relate this to the expected number of substitutions per site, $d$. The rate of substitution per site per unit time is the rate of leaving any state, which is $3\\alpha$. Since the two sequences are separated by a total branch length of $2t$, the expected number of substitutions per site is:\n$$ d = (3\\alpha) \\times (2t) = 6\\alpha t $$\nWe can express the term in the exponential, $8\\alpha t$, as a function of $d$:\n$$ 8\\alpha t = \\frac{8}{6} (6\\alpha t) = \\frac{4}{3}d $$\nSubstituting this into the expression for $p$, we obtain the functional relationship between $p$ and $d$:\n$$ p(d) = \\frac{3}{4}\\left(1 - \\exp\\left(-\\frac{4}{3}d\\right)\\right) $$\nTo find $d$ in terms of $p$, we must invert this equation:\n$$ \\frac{4}{3}p = 1 - \\exp\\left(-\\frac{4}{3}d\\right) $$\n$$ \\exp\\left(-\\frac{4}{3}d\\right) = 1 - \\frac{4}{3}p $$\n$$ -\\frac{4}{3}d = \\ln\\left(1 - \\frac{4}{3}p\\right) $$\n$$ d(p) = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}p\\right) $$\nThis is the Jukes–Cantor correction formula. We now apply this formula to the synonymous ($S$) and nonsynonymous ($N$) partitions, using the provided observed proportions of differences.\n\nFor synonymous sites, we have $p_S = 0.18$. The number of substitutions per synonymous site, $d_S$, is:\n$$ d_S = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}(0.18)\\right) = -\\frac{3}{4}\\ln(1 - 0.24) = -\\frac{3}{4}\\ln(0.76) $$\n$$ d_S \\approx -0.75 \\times (-0.2744368) \\approx 0.2058276 $$\nRounded to $4$ significant figures, $d_S = 0.2058$.\n\nFor nonsynonymous sites, we have $p_N = 0.06$. The number of substitutions per nonsynonymous site, $d_N$, is:\n$$ d_N = -\\frac{3}{4}\\ln\\left(1 - \\frac{4}{3}(0.06)\\right) = -\\frac{3}{4}\\ln(1 - 0.08) = -\\frac{3}{4}\\ln(0.92) $$\n$$ d_N \\approx -0.75 \\times (-0.0833816) \\approx 0.0625362 $$\nRounded to $4$ significant figures, $d_N = 0.06254$.\n\nFinally, we compute the ratio $\\omega = d_N / d_S$:\n$$ \\omega = \\frac{d_N}{d_S} \\approx \\frac{0.0625362}{0.2058276} \\approx 0.303828 $$\nRounded to $4$ significant figures, $\\omega = 0.3038$.\n\nThe ratio $\\omega$ measures the selective pressure on the protein. A value of $\\omega < 1$ indicates that nonsynonymous substitutions are removed by natural selection more frequently than synonymous (neutral) substitutions. This regime is known as **purifying selection** or negative selection, which suggests that the protein is functionally constrained and most amino acid changes are deleterious. Our result $\\omega \\approx 0.3038$ is significantly less than $1$ and thus is a clear indicator of purifying selection acting on this protein-coding sequence.", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.2058 & 0.06254 & 0.3038 \\end{pmatrix}}\n$$", "id": "2844443"}, {"introduction": "While calculating a single, gene-wide $\\omega$ ratio is a powerful tool, it assumes that the force of selection is uniform across every site in a protein, which is often biologically unrealistic. This exercise explores the critical concept of among-site rate variation, where different parts of a gene evolve under different selective pressures [@problem_id:2844378]. Through a hypothetical two-class model, you will discover how a simple average $\\omega$ can obscure important evolutionary signals, such as pockets of positive selection ($\\omega \\gt 1$) hidden within a gene that is overwhelmingly under purifying selection ($\\omega \\lt 1$).", "problem": "A protein-coding locus is modeled with two site classes that differ in their ratio of nonsynonymous to synonymous substitution rates, where the ratio of nonsynonymous to synonymous substitution rates is defined as $d_N/d_S$ (commonly denoted $\\omega$). Class $1$ comprises a proportion $p$ of sites with $\\omega_1 = 0.1$ (strong purifying selection), and class $2$ comprises a proportion $1 - p$ of sites with $\\omega_2 = 2.0$ (positive selection). Assume that the synonymous substitution rate per synonymous site, $dS$, is the same across site classes, that the per-site opportunities for synonymous change are comparable between classes, and that the aggregate across-site $d_N/d_S$ is defined as the expected nonsynonymous substitutions per nonsynonymous site divided by the expected synonymous substitutions per synonymous site, computed by pooling over sites.\n\nUsing only the definitions above and the notion of expectation under a mixture of site classes, derive the across-site average $d_N/d_S$, denoted $\\bar{\\omega}$, as a simplified function of $p$. Then, briefly explain why this across-site average can fail to reveal the presence of positive selection acting at a subset of sites in this model. Report only the simplified analytic expression for $\\bar{\\omega}$ as your final answer. No numerical rounding is required.", "solution": "The problem requires the derivation of the across-site average ratio of nonsynonymous to synonymous substitution rates, $\\bar{\\omega}$, for a protein-coding locus with two classes of sites.\n\nFirst, we formalize the given information and definitions.\nThe locus consists of two site classes.\nClass $1$: A proportion $p$ of sites are under strong purifying selection with a rate ratio $\\omega_1 = \\frac{dN_1}{dS_1} = 0.1$.\nClass $2$: A proportion $1-p$ of sites are under positive selection with a rate ratio $\\omega_2 = \\frac{dN_2}{dS_2} = 2.0$.\n\nHere, $dN_i$ is the rate of nonsynonymous substitution per nonsynonymous site for class $i$, and $dS_i$ is the rate of synonymous substitution per synonymous site for class $i$. A crucial simplifying assumption is provided: the synonymous substitution rate is identical across all sites, which means $dS_1 = dS_2 = dS$ for some constant rate $dS$.\n\nFrom the definitions of $\\omega_1$ and $\\omega_2$, we can express the nonsynonymous rates for each class in terms of the common synonymous rate $dS$:\n$$ dN_1 = \\omega_1 \\cdot dS_1 = 0.1 \\cdot dS $$\n$$ dN_2 = \\omega_2 \\cdot dS_2 = 2.0 \\cdot dS $$\n\nThe problem defines the aggregate across-site average, $\\bar{\\omega}$, as the ratio of the expected nonsynonymous substitution rate per nonsynonymous site, $E[dN]$, to the expected synonymous substitution rate per synonymous site, $E[dS]$, where the expectation is taken over the distribution of site classes.\n\nThe expected nonsynonymous substitution rate, $E[dN]$, is the weighted average of the rates from the two classes, with weights given by their proportions:\n$$ E[dN] = p \\cdot dN_1 + (1-p) \\cdot dN_2 $$\nSubstituting the expressions for $dN_1$ and $dN_2$:\n$$ E[dN] = p \\cdot (0.1 \\cdot dS) + (1-p) \\cdot (2.0 \\cdot dS) $$\nFactoring out the common term $dS$:\n$$ E[dN] = dS \\cdot [0.1p + 2.0(1-p)] $$\n\nThe expected synonymous substitution rate, $E[dS]$, is calculated similarly:\n$$ E[dS] = p \\cdot dS_1 + (1-p) \\cdot dS_2 $$\nSince $dS_1 = dS_2 = dS$:\n$$ E[dS] = p \\cdot dS + (1-p) \\cdot dS = (p + 1 - p) \\cdot dS = dS $$\nThis result is logical: if the rate is constant across all sites, its expected value is simply that constant.\n\nNow, we construct the aggregate ratio $\\bar{\\omega}$ as defined:\n$$ \\bar{\\omega} = \\frac{E[dN]}{E[dS]} = \\frac{dS \\cdot [0.1p + 2.0(1-p)]}{dS} $$\nThe unknown rate $dS$ cancels from the numerator and denominator, which is a necessary condition for a well-posed problem. This yields:\n$$ \\bar{\\omega} = 0.1p + 2.0(1-p) $$\nSimplifying this expression provides the final function of $p$:\n$$ \\bar{\\omega} = 0.1p + 2.0 - 2.0p $$\n$$ \\bar{\\omega} = 2.0 - 1.9p $$\n\nThe second part of the problem asks why this average, $\\bar{\\omega}$, can fail to reveal the presence of positive selection. Positive selection is typically inferred when the rate ratio is greater than $1$. In this model, class $2$ sites are unequivocally under positive selection because $\\omega_2 = 2.0 > 1$. However, the site-averaged measure $\\bar{\\omega}$ may be less than or equal to $1$, thus masking this signal.\n\nThis occurs when the contribution from the sites under purifying selection (class $1$, with $\\omega_1 = 0.1 < 1$) dominates the average. The value of $\\bar{\\omega}$ will be less than $1$ if:\n$$ 2.0 - 1.9p < 1 $$\n$$ 1.0 < 1.9p $$\n$$ p > \\frac{1.0}{1.9} \\approx 0.526 $$\n\nTherefore, if the proportion $p$ of sites under strong purifying selection is greater than approximately $52.6\\%$, the site-averaged $\\bar{\\omega}$ will be less than $1$. For instance, if $p = 0.8$, meaning $80\\%$ of sites are under purifying selection, the average $\\bar{\\omega}$ would be $2.0 - 1.9(0.8) = 2.0 - 1.52 = 0.48$. An observed value of $\\bar{\\omega} = 0.48$ would lead to the naive conclusion that the entire gene is under purifying selection, completely failing to detect the $20\\%$ of sites that are evolving under strong positive selection. This demonstrates a fundamental limitation of using a single, averaged $\\omega$ value for a gene or locus that is heterogeneous in its evolutionary pressures. The averaging process obscures the underlying heterogeneity, particularly when a minority of sites are under a selective pressure that opposes the majority.", "answer": "$$\\boxed{2.0 - 1.9p}$$", "id": "2844378"}]}