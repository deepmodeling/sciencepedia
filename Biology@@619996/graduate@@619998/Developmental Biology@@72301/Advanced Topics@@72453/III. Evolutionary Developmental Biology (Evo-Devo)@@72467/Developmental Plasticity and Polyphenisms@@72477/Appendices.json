{"hands_on_practices": [{"introduction": "Understanding developmental plasticity begins with translating biological mechanisms into quantitative, predictive models. This first practice challenges you to do just that by deriving a model for aphid wing polyphenism from first principles—a Poisson process for crowding cues and a logistic function for the developmental switch. By building and fitting this model to hypothetical data, you will gain hands-on experience in mechanistic modeling and parameter estimation, which are foundational skills for any student of plasticity [@problem_id:2629969].", "problem": "Aphid wing polyphenism is a developmental plasticity wherein mothers experiencing crowding produce a higher fraction of winged offspring. Construct and fit a density-dependent maternal effect model grounded in first principles of probabilistic contact processes and phenotype determination. Use the following foundations without importing any shortcut formulas for the final model; you must derive the model from these bases and then implement it.\n\nFoundational bases to use:\n- Definition of maternal effect: The probability of an offspring phenotype can depend on the mother’s environment rather than the offspring’s own environment.\n- Homogeneous Poisson process of tactile contacts: If contacts arrive at rate proportional to density, then the number of contacts in a fixed time window is Poisson distributed.\n- Binomial outcomes for morph counts: Given a fixed probability of a winged morph at a density, the number of winged morphs among a fixed number of offspring is binomially distributed.\n- Canonical logistic response: A sigmoidal transduction from a latent cue to a probability can be modeled using the logistic function.\n\nTasks:\n1) From the Poisson contact assumption, derive the maternal crowding cue as a function of density. Specifically, assume that the mother experiences tactile contacts with a Poisson rate proportional to density. In a fixed temporal integration window, let the mean of the Poisson process be $kD$, where $D$ is density and $k$ is a nonnegative rate constant. Using the probability of at least one contact, derive a bounded, increasing cue function $S(D)$.\n2) Assuming that the probability of producing a winged offspring is a logistic function of the cue, derive a probability function $p(D)$ of the form $p(D) = f(\\alpha, \\beta, k, D)$, where $\\alpha \\in \\mathbb{R}$ is a baseline log-odds, $\\beta \\ge 0$ is a transduction gain, and $k \\ge 0$ is the contact-rate scale parameter from the Poisson process.\n3) Given binomial observations across densities, define the log-likelihood for independent counts $w_i$ of winged offspring out of $n_i$ offspring at densities $D_i$, assuming $w_i \\sim \\text{Binomial}(n_i, p(D_i))$. To ensure numerical stability and identifiability under near-complete separation, include a small nonzero quadratic penalty on the parameters and maximize the penalized log-likelihood with respect to $\\alpha$, $\\beta$, and $k$ subject to nonnegativity constraints on $\\beta$ and $k$.\n\nImplementation details:\n- You must implement a numerical optimizer to obtain the maximum penalized likelihood estimates of $\\alpha$, $\\beta$, and $k$ for each dataset in the test suite below.\n- For each dataset, report the fitted parameter triple as a list $[\\alpha, \\beta, k]$, with each value rounded to four decimal places.\n- The final program output must be a single line containing a list of the three fitted parameter lists, for example: [[a1,b1,k1],[a2,b2,k2],[a3,b3,k3]]. Values are unitless fractions or log-odds; do not include any units.\n\nTest suite (densities $D_i$, total offspring $n_i$, winged offspring $w_i$):\n- Dataset A (happy path, moderate counts):\n  - $D = [0, 2, 4, 6, 8, 10]$\n  - $n = [100, 100, 100, 100, 100, 100]$\n  - $w = [5, 58, 86, 92, 94, 95]$\n- Dataset B (boundary with near separation at extremes):\n  - $D = [0, 1, 3, 5, 7, 9]$\n  - $n = [50, 50, 50, 50, 50, 50]$\n  - $w = [0, 2, 34, 42, 44, 44]$\n- Dataset C (small sample sizes with zeros possible):\n  - $D = [0, 0.5, 1.5, 3, 6]$\n  - $n = [10, 10, 10, 10, 10]$\n  - $w = [1, 2, 3, 4, 6]$\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of the three fitted parameter lists enclosed in square brackets, for example:\n[[alpha_A,beta_A,k_A],[alpha_B,beta_B,k_B],[alpha_C,beta_C,k_C]]\nValues must be rounded to four decimal places.", "solution": "The problem presented requires the construction and statistical fitting of a mechanistic model for aphid wing polyphenism, a classic example of developmental plasticity. The model must be derived from first principles as specified: a Poisson process for environmental cue acquisition, a logistic function for probabilistic phenotype determination, and a binomial distribution for observed counts. I will proceed by first validating the problem, then systematically deriving the model, defining the estimation procedure, and finally describing the computational implementation.\n\nThe problem is scientifically grounded, well-posed, and objective. It is based on established principles in biology and statistics. The tasks are specified clearly, and the provided data are consistent and realistic for such an experiment. A minor ambiguity regarding the magnitude of the \"small nonzero quadratic penalty\" is resolved by selecting a standard, small regularization parameter, $\\lambda_{reg} = 1 \\times 10^{-4}$, a common choice to ensure numerical stability without introducing significant bias. Thus, the problem is deemed valid and a solution will be provided.\n\nThe solution is developed in three stages as mandated by the problem statement.\n\n**1. Derivation of the Maternal Crowding Cue $S(D)$**\n\nThe model's foundation is that a mother aphid's perception of crowding is driven by tactile contacts from other aphids. We are instructed to model the arrival of these contacts as a homogeneous Poisson process.\n\nLet $N$ be the random variable representing the number of contacts an aphid experiences within a fixed temporal integration window. According to the problem, $N$ follows a Poisson distribution, $N \\sim \\text{Poisson}(\\mu)$, where the mean number of contacts, $\\mu$, is directly proportional to the population density $D$. Thus, we can write $\\mu = kD$, where $k$ is a non-negative rate constant representing the sensitivity of contact rate to density.\n\nThe probability mass function of $N$ is given by:\n$$ P(N=j) = \\frac{e^{-\\mu}\\mu^j}{j!} = \\frac{e^{-kD}(kD)^j}{j!} \\quad \\text{for } j = 0, 1, 2, \\dots $$\nThe problem defines the maternal crowding cue, which we denote $S(D)$, as the probability of experiencing at least one contact during the integration window. This corresponds to the event $N \\ge 1$. It is computationally more direct to calculate this probability via its complement, the event of experiencing zero contacts, $N=0$.\n$$ S(D) = P(N \\ge 1) = 1 - P(N=0) $$\nUsing the Poisson PMF for $j=0$:\n$$ P(N=0) = \\frac{e^{-kD}(kD)^0}{0!} = e^{-kD} $$\nTherefore, the maternal crowding cue as a function of density $D$ is:\n$$ S(D) = 1 - e^{-kD} $$\nThis function is bounded, with $S(D) \\in [0, 1)$, and is monotonically increasing with density $D$ for any $k > 0$, consistent with its role as a stimulus signal that saturates at high densities.\n\n**2. Derivation of the Wing Morph Probability Function $p(D)$**\n\nNext, we model the transduction of this crowding cue $S(D)$ into the probability of producing a winged offspring, $p(D)$. The problem specifies a canonical logistic response. The log-odds of the outcome (producing a winged offspring) is modeled as a linear function of the cue, including a baseline.\n\nLet the log-odds, or logit, of the probability $p(D)$ be given by:\n$$ \\text{logit}(p(D)) = \\ln\\left(\\frac{p(D)}{1-p(D)}\\right) = \\alpha + \\beta S(D) $$\nHere, $\\alpha \\in \\mathbb{R}$ is the baseline log-odds of producing a winged offspring in the complete absence of crowding (i.e., at $D=0$, where $S(0) = 0$). The parameter $\\beta \\ge 0$ is the transduction gain, which quantifies how strongly the crowding cue influences the probability. Substituting our derived expression for $S(D)$:\n$$ \\ln\\left(\\frac{p(D)}{1-p(D)}\\right) = \\alpha + \\beta(1 - e^{-kD}) $$\nTo find the probability $p(D)$, we solve for it by exponentiating both sides and rearranging, which is equivalent to applying the standard logistic (or sigmoid) function:\n$$ p(D) = \\frac{1}{1 + e^{-(\\alpha + \\beta(1 - e^{-kD}))}} $$\nThis equation represents the complete model $p(D) = f(\\alpha, \\beta, k, D)$ that links aphid density $D$ to the probability of producing a winged offspring, governed by the three biologically interpretable parameters: the baseline log-odds $\\alpha$, the transduction gain $\\beta$, and the contact-rate scale $k$.\n\n**3. Penalized Maximum Likelihood Estimation**\n\nThe final task is to estimate the parameters $\\theta = (\\alpha, \\beta, k)$ using the provided experimental data. The data for each density point $D_i$ consist of the total number of offspring, $n_i$, and the number of winged offspring, $w_i$.\n\nThe problem states that $w_i$ is binomially distributed, $w_i \\sim \\text{Binomial}(n_i, p(D_i))$. Assuming the observations at different densities are independent, the total likelihood of the observed data given the parameters $\\theta$ is the product of the individual binomial probabilities:\n$$ L(\\theta | \\text{data}) = \\prod_{i=1}^{M} \\binom{n_i}{w_i} p(D_i)^{w_i} (1 - p(D_i))^{n_i - w_i} $$\nwhere $M$ is the number of density points in a dataset. For optimization, it is standard to work with the log-likelihood function, $\\mathcal{L}(\\theta) = \\ln(L(\\theta))$. Dropping the binomial coefficient term $\\binom{n_i}{w_i}$, which is constant with respect to $\\theta$, we obtain the expression to be maximized:\n$$ \\mathcal{L}(\\theta) = \\sum_{i=1}^{M} \\left[ w_i \\ln(p(D_i)) + (n_i - w_i) \\ln(1 - p(D_i)) \\right] $$\nThe problem requires the inclusion of a small quadratic penalty on the parameters to ensure numerical stability and parameter identifiability, especially in cases of near-complete separation where probabilities approach $0$ or $1$. This corresponds to L2 regularization. The penalized log-likelihood is:\n$$ \\mathcal{L}_{pen}(\\theta) = \\mathcal{L}(\\theta) - \\frac{\\lambda_{reg}}{2} (\\alpha^2 + \\beta^2 + k^2) $$\nwhere $\\lambda_{reg}$ is the regularization strength. As discussed, a value of $\\lambda_{reg} = 1 \\times 10^{-4}$ is chosen. Maximizing $\\mathcal{L}_{pen}(\\theta)$ is equivalent to minimizing its negative, so our objective function for numerical optimization is:\n$$ J(\\theta) = - \\sum_{i=1}^{M} \\left[ w_i \\ln(p(D_i)) + (n_i - w_i) \\ln(1 - p(D_i)) \\right] + \\frac{\\lambda_{reg}}{2} (\\alpha^2 + \\beta^2 + k^2) $$\nThis minimization must be performed subject to the constraints $\\beta \\ge 0$ and $k \\ge 0$. This is a constrained nonlinear optimization problem. The implementation will employ a numerical optimizer, specifically the L-BFGS-B algorithm, which is well-suited for this task as it efficiently handles box constraints. For each dataset, the optimizer will be initialized with a reasonable guess for the parameters and will search for the parameter vector $(\\alpha, \\beta, k)$ that minimizes $J(\\theta)$. The resulting values are the maximum penalized likelihood estimates.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize\nfrom scipy.special import expit, logit\n\ndef solve():\n    \"\"\"\n    Constructs and fits a density-dependent maternal effect model for aphid wing polyphenism.\n    The solution derives the model from first principles and uses numerical optimization\n    to find the maximum penalized likelihood estimates for its parameters.\n    \"\"\"\n\n    # Test suite (densities Di, total offspring ni, winged offspring wi)\n    test_cases = {\n        'A': {\n            'D': np.array([0., 2., 4., 6., 8., 10.]),\n            'n': np.array([100, 100, 100, 100, 100, 100]),\n            'w': np.array([5, 58, 86, 92, 94, 95])\n        },\n        'B': {\n            'D': np.array([0., 1., 3., 5., 7., 9.]),\n            'n': np.array([50, 50, 50, 50, 50, 50]),\n            'w': np.array([0, 2, 34, 42, 44, 44])\n        },\n        'C': {\n            'D': np.array([0., 0.5, 1.5, 3., 6.]),\n            'n': np.array([10, 10, 10, 10, 10]),\n            'w': np.array([1, 2, 3, 4, 6])\n        }\n    }\n\n    # Regularization parameter for the L2 penalty\n    LAMBDA_REG = 1e-4\n\n    def objective_function(params, D, n, w):\n        \"\"\"\n        Calculates the negative penalized log-likelihood.\n        This is the objective function to be minimized.\n        \"\"\"\n        alpha, beta, k = params\n        \n        # Calculate the crowding cue S(D) = 1 - exp(-k*D)\n        S = 1.0 - np.exp(-k * D)\n        \n        # Calculate the linear predictor for the logit model: z = alpha + beta*S\n        z = alpha + beta * S\n        \n        # Calculate probability p(D) using the numerically stable logistic function\n        p = expit(z)\n        \n        # To avoid log(0) issues, clip probabilities to a small epsilon from 0 and 1\n        epsilon = 1e-10\n        p = np.clip(p, epsilon, 1.0 - epsilon)\n        \n        # Calculate the log-likelihood of the binomial observations\n        log_likelihood = np.sum(w * np.log(p) + (n - w) * np.log(1 - p))\n        \n        # Calculate the L2 penalty term\n        penalty = (LAMBDA_REG / 2.0) * (alpha**2 + beta**2 + k**2)\n        \n        # The function to be minimized is the negative penalized log-likelihood\n        return -log_likelihood + penalty\n\n    def solve_for_dataset(data):\n        \"\"\"\n        Finds the optimal parameters for a single dataset.\n        \"\"\"\n        D, n, w = data['D'], data['n'], data['w']\n        \n        # Generate a reasonable initial guess for the parameters\n        # For alpha, use a safe logit of the proportion at D=0\n        w0, n0 = w[0], n[0]\n        # Use Haldane-Anscombe correction for w0=0 or w0=n0 cases\n        p0_est = (w0 + 0.5) / (n0 + 1.0)\n        alpha_init = logit(p0_est)\n        \n        # Initial guess vector [alpha, beta, k]\n        initial_guess = [alpha_init, 1.0, 1.0]\n        \n        # Define bounds for the parameters: beta >= 0, k >= 0. alpha is unbounded.\n        bounds = [(None, None), (0, None), (0, None)]\n        \n        # Perform minimization\n        result = minimize(\n            fun=objective_function,\n            x0=initial_guess,\n            args=(D, n, w),\n            method='L-BFGS-B',\n            bounds=bounds\n        )\n        \n        # Extract and round the fitted parameters\n        fitted_params = [round(p, 4) for p in result.x]\n        return fitted_params\n\n    results = []\n    # Loop through datasets A, B, C in order\n    for key in sorted(test_cases.keys()):\n        data = test_cases[key]\n        params = solve_for_dataset(data)\n        results.append(params)\n\n    # Format the final output as a single-line string\n    print(results)\n\nsolve()\n```", "id": "2629969"}, {"introduction": "While a model can describe a plastic response, a primary goal in developmental biology is to understand its variation. This exercise shifts focus from modeling to experimental design, tasking you with devising a strategy to disentangle the genetic, maternal, and environmental contributions to a reaction norm. By evaluating different breeding designs, such as the paternal half-sib split-brood design, you will learn how to prospectively control for confounding factors and enable the robust estimation of genotype-by-environment interactions [@problem_id:2629992].", "problem": "A facultative cannibal morph in a salamander is induced by resource and conspecific-cue environments during larval development. You want to estimate the reaction norm of a quantitative morphology index, $Y$, across $E = 2$ rearing environments (control versus carnivore-inducing cues), and to quantify whether plasticity varies genetically (genotype-by-environment interaction), while controlling for maternal effects and common-environment effects. You can collect wild adults and perform controlled in vitro fertilizations.\n\nFoundational basis you may assume: (i) phenotypic variance can be decomposed as $V_P = V_G + V_E + V_{G \\times E} + V_M + V_{CE} + V_\\varepsilon$, where $V_G$ is genetic variance, $V_E$ is environmental variance, $V_{G \\times E}$ is genotype-by-environment variance (variation in reaction norms), $V_M$ is maternal effect variance, $V_{CE}$ is shared common-environment variance, and $V_\\varepsilon$ is residual variance; (ii) a reaction norm is the mapping from environment to phenotype for a genotype, and genetic variation in reaction norms appears statistically as variation in slopes among genetic groups; (iii) linear mixed-effects models can represent hierarchical sampling and random variation in intercepts and slopes across grouping factors.\n\nYou will implement a split-brood design. Each full-sib family is divided and reared across the two environments. Tanks are the experimental units within environments. You can measure covariates such as egg wet mass at oviposition for each clutch.\n\nWhich option below proposes a scientifically rigorous split-brood experimental design and a linear mixed-effects model that enables estimation of the population-level reaction norm, separation of additive genetic effects from maternal effects, and estimation of genetic variance in plasticity, while controlling for tank-level common environments?\n\nA. Experimental design: Paternal half-sib split-brood. Mate $S \\ge 10$ sires to $D \\ge 2$ dams each (total full-sib families $F = S \\times D$). For each family, distribute equal numbers of eggs at random into $R \\ge 2$ tanks in each of $E = 2$ environments. Record clutch mean egg wet mass. Randomize family contributions to tanks to balance across environments and tanks. Model:\n$$\nY_{ijklmn} \\;=\\; \\mu \\;+\\; \\alpha_E\\,E_l \\;+\\; \\beta\\,\\text{EggMass}_{ij} \\;+\\; s_i \\;+\\; d_{j(i)} \\;+\\; (sE)_{il} \\;+\\; (dE)_{j(i)l} \\;+\\; t_{k(l)} \\;+\\; \\varepsilon_{ijklmn},\n$$\nwhere $i \\in \\{1,\\dots,S\\}$ indexes sires, $j \\in \\{1,\\dots,D\\}$ dams nested within sire $i$, $l \\in \\{1,2\\}$ environments, $k$ tanks nested within environment $l$, and $n$ individuals. Fixed effects: intercept $\\mu$, environment $\\alpha_E\\,E_l$, covariate $\\beta\\,\\text{EggMass}_{ij}$. Random effects: $s_i \\sim \\mathcal{N}(0,\\sigma^2_{s})$ (additive genetic intercept via sire), $d_{j(i)} \\sim \\mathcal{N}(0,\\sigma^2_{d})$ (dam within sire, capturing maternal plus nonadditive family effects), $(sE)_{il} \\sim \\mathcal{N}(0,\\sigma^2_{sE})$ (additive genetic variance in reaction norm slope), $(dE)_{j(i)l} \\sim \\mathcal{N}(0,\\sigma^2_{dE})$ (maternal/family-specific plasticity), $t_{k(l)} \\sim \\mathcal{N}(0,\\sigma^2_{t})$ (tank within environment), and $\\varepsilon_{ijklmn} \\sim \\mathcal{N}(0,\\sigma^2_{\\varepsilon})$.\n\nB. Experimental design: Full-sib split-brood only. Mate each of $S$ sires to exactly one dam ($D = 1$), creating $F = S$ full-sib families. Split each family across $E = 2$ environments with $R \\ge 2$ tanks per environment. Do not record egg mass. Model:\n$$\nY_{ijkl} \\;=\\; \\mu \\;+\\; \\alpha_E\\,E_l \\;+\\; f_k \\;+\\; (fE)_{kl} \\;+\\; \\varepsilon_{ijkl},\n$$\nwith family $f_k$ and family-by-environment $(fE)_{kl}$ as random effects, but no sire or dam separation and no tank effect.\n\nC. Experimental design: Paternal half-sib split-brood as in A, but pool all offspring from a family into a single tank per environment ($R = 1$) to maximize sample size per tank and do not measure egg mass. Model:\n$$\nY_{ijl} \\;=\\; \\mu \\;+\\; E_l \\;+\\; s_i \\;+\\; d_{j(i)} \\;+\\; (sdE)_{ij l} \\;+\\; \\varepsilon_{ijl},\n$$\nwhere $(sdE)_{ij l}$ is a random family-by-environment term; no explicit tank effect or maternal covariate is included.\n\nD. Experimental design: Paternal half-sib split-brood as in A, additionally cross-foster half of each family’s eggs to tanks seeded with unrelated larvae to \"wash out\" maternal effects. Ignore egg mass. Model:\n$$\nY_{ijklm} \\;=\\; \\mu \\;+\\; \\alpha_E\\,E_l \\;+\\; \\alpha_F\\,F_m \\;+\\; (EF)_{lm} \\;+\\; t_k \\;+\\; \\varepsilon_{ijklm},\n$$\ntreating family $F_m$ and family-by-environment $(EF)_{lm}$ as fixed effects, with $t_k$ a random tank effect, and no sire or dam random terms.", "solution": "The problem statement is submitted for validation.\n\n### Step 1: Extract Givens\n- **System:** A facultative cannibal morph in a salamander.\n- **Phenotype:** A quantitative morphology index, denoted as $Y$.\n- **Environments:** $E = 2$ rearing environments (control vs. carnivore-inducing cues).\n- **Primary Goals:**\n    1. Estimate the population-level reaction norm of $Y$ across the two environments.\n    2. Quantify genetic variation in plasticity (genotype-by-environment interaction, $V_{G \\times E}$).\n    3. Separate additive genetic effects ($V_G$) from maternal effects ($V_M$).\n    4. Control for common-environment effects at the tank level ($V_{CE}$).\n- **Available Methods and Constraints:**\n    1. Use of wild-caught adults.\n    2. Controlled in vitro fertilizations are possible.\n    3. Implementation of a split-brood design where each full-sib family is divided across the two environments.\n    4. Tanks are the experimental units within environments.\n    5. Covariates such as egg wet mass can be measured for each clutch.\n- **Assumed Foundational Basis:**\n    1. Variance decomposition: $V_P = V_G + V_E + V_{G \\times E} + V_M + V_{CE} + V_\\varepsilon$.\n    2. Definition of reaction norm and $V_{G \\times E}$ as variation in slopes among genotypes.\n    3. The suitability of linear mixed-effects models for analyzing such data.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scrutinized for validity.\n1.  **Scientific Grounding:** The problem is firmly based in established principles of quantitative genetics and developmental biology. Facultative polyphenisms, reaction norms, genotype-by-environment interactions, and the decomposition of phenotypic variance are central concepts in evolutionary biology. The proposed experimental framework (paternal half-sib, split-brood) is a standard and powerful methodology for addressing such questions. The problem is scientifically sound.\n2.  **Well-Posedness:** The objectives are clearly stated and quantifiable: estimate a population-level effect, separate specific variance components ($V_G$, $V_M$, $V_{G \\times E}$), and control for a confounding factor ($V_{CE}$). The question asks for the evaluation of specific experimental designs and statistical models against these clear objectives. A unique, best option can be determined. The problem is well-posed.\n3.  **Objectivity:** The language is technical, precise, and free from subjective or ambiguous terminology. All terms used (`paternal half-sib`, `reaction norm`, `linear mixed-effects model`) have rigorous definitions in the field. The problem is objective.\n4.  **Other Flaws:** The problem statement is self-contained, consistent, and describes a feasible (though complex) biological experiment. It is not trivial, metaphorical, or otherwise flawed according to the validation criteria.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. A full solution will be derived by evaluating each presented option against the stated scientific objectives.\n\n### Analysis of Options\n\nThe objective is to find an experimental design and statistical model that can simultaneously:\n1.  Estimate the mean plasticity (the slope of the population-level reaction norm).\n2.  Separate additive genetic variance ($V_A$, a component of $V_G$) from maternal effect variance ($V_M$).\n3.  Estimate the additive genetic variance in plasticity ($V_{A \\times E}$, a component of $V_{G \\times E}$).\n4.  Control for common-environment effects due to shared tanks ($V_{CE}$).\n\n#### Option A\nThis option proposes a paternal half-sib split-brood design and a corresponding linear mixed-effects model.\n- **Design:** The paternal half-sib design, where each sire ($s_i$) is mated to multiple dams ($d_{j(i)}$), is the classical approach to disentangling additive genetic effects from maternal and other non-additive genetic effects. Variance among the offspring means of different sires allows for an estimate of $\\frac{1}{4}V_A$. Variance among the means of dams nested within sires allows for an estimate of $\\frac{1}{4}V_A + \\frac{1}{4}V_D + V_{M}$ (where $V_D$ is dominance genetic variance). This structure is essential for achieving **Goal 2**.\n- The split-brood aspect, where each family is exposed to both environments, is required to study plasticity and its genetic basis.\n- The use of replicate tanks ($R \\ge 2$) per family-environment combination is a critical feature. This replication allows for the separation of tank-level common environment variance ($V_{CE}$) from the family-by-environment interaction variance ($V_{G \\times E}$) and residual variance ($V_\\varepsilon$). This achieves **Goal 4**.\n- The measurement of egg mass and its inclusion as a covariate provides a direct statistical control for a major source of pre-natal maternal effects, further improving the estimation.\n- **Model:** The proposed model is comprehensive and correctly specified.\n    - $\\alpha_E\\,E_l$: The fixed effect of environment estimates the average difference between the two environments, which is the slope of the population-level reaction norm. This achieves **Goal 1**.\n    - $s_i$: The random sire effect estimates the additive genetic variance in the phenotype's intercept.\n    - $d_{j(i)}$: The random dam-within-sire effect estimates maternal and remaining genetic variance in the intercept. Together with $s_i$, this achieves **Goal 2**.\n    - $(sE)_{il}$: The random sire-by-environment interaction effect. Its variance, $\\sigma^2_{sE}$, directly estimates the additive genetic variance for the slope of the reaction norm ($\\frac{1}{4}V_{A \\times E}$). This is the explicit measure of genetic variation in plasticity, achieving **Goal 3**.\n    - $t_{k(l)}$: The random tank effect. Its variance, $\\sigma^2_t$, directly estimates $V_{CE}$, achieving **Goal 4**.\nThis option provides a scientifically rigorous design and a correctly specified model that addresses all requirements of the problem.\n\n**Verdict on A: Correct**\n\n#### Option B\nThis option proposes a full-sib split-brood design.\n- **Design:** A full-sib design ($S$ sires mated to $S$ dams, $D=1$) means that all genetic and parental effects are confounded within a single \"family\" effect ($f_k$). It is impossible to separate the sire's contribution (additive genetics) from the dam's contribution (additive genetics plus maternal effects). Therefore, **Goal 2** cannot be met.\n- **Model:** The model $$Y_{ijkl} \\;=\\; \\mu \\;+\\; \\alpha_E\\,E_l \\;+\\; f_k \\;+\\; (fE)_{kl} \\;+\\; \\varepsilon_{ijkl}$$ reflects this confounding. The variance of $f_k$ lumps together $V_G$, $V_M$, and family-specific common environment effects. The variance of the interaction term $(fE)_{kl}$ confounds $V_{G \\times E}$ and $V_{M \\times E}$.\n- Most importantly, the model completely omits a term for the tank effect. Since the experimental design specifies that there are replicate tanks ($R \\ge 2$), failing to model the tank effect constitutes a serious misspecification. Any true tank effect will be aliased into other variance components, biasing the estimates. This fails **Goal 4**.\n\n**Verdict on B: Incorrect**\n\n#### Option C\nThis option modifies the design from A by using only one tank per family-environment combination ($R=1$).\n- **Design:** The use of a single tank ($R=1$) is a fatal design flaw known as pseudoreplication. With this design, the effect of the tank is perfectly confounded with the family-by-environment interaction. It is impossible to determine if a family's unique phenotype in a given environment is due to its genetics ($G \\times E$) or the specific, unique conditions of the single tank it was reared in ($V_{CE}$). This design makes it impossible to achieve **Goal 4**.\n- **Model:** The model $$Y_{ijl} \\;=\\; \\mu \\;+\\; E_l \\;+\\; s_i \\;+\\; d_{j(i)} \\;+\\; (sdE)_{ij l} \\;+\\; \\varepsilon_{ijl}$$ omits a tank effect term because it cannot be estimated. The variance of the $(sdE)_{ij l}$ term would absorb both the true genetic interaction with the environment and the common-environment variance of the tank ($\\sigma^2_{sdE} = \\sigma^2_{G \\times E} + \\sigma^2_{M \\times E} + \\sigma^2_{CE}$), leading to an inflated and uninterpretable estimate of variance in plasticity. This fails to meet the core requirement of separating $V_{G \\times E}$ from $V_{CE}$.\n\n**Verdict on C: Incorrect**\n\n#### Option D\nThis option proposes a design with a vaguely described \"cross-fostering\" component and, most critically, an improperly specified model.\n- **Design:** While cross-fostering is a valid technique, the description here is unclear. The more significant issue lies with the model.\n- **Model:** The model $$Y_{ijklm} \\;=\\; \\mu \\;+\\; \\alpha_E\\,E_l \\;+\\; \\alpha_F\\,F_m \\;+\\; (EF)_{lm} \\;+\\; t_k \\;+\\; \\varepsilon_{ijklm}$$ specifies family ($F_m$) and the family-by-environment interaction ($(EF)_{lm}$) as **fixed effects**. The objective of a quantitative genetics study is to make inferences about a population, not just the specific families in the experiment. To do this, one must estimate variance components ($V_G$, $V_{G \\times E}$, etc.), which requires treating family (or sire and dam) as a **random effect**. Treating family as a fixed effect allows one to test whether *these specific families* differ, but it does not permit the estimation of the variance in the population from which the families were sampled. Therefore, this model makes it impossible to quantify $V_G$ or $V_{G \\times E}$, failing **Goals 2 and 3** fundamentally.\n- Furthermore, by lumping sire and dam into a single family term $F_m$, the model loses the ability to separate additive genetic from maternal effects, even if it were specified as a random effect.\n\n**Verdict on D: Incorrect**\n\n### Conclusion\nOnly Option A presents a complete and correct experimental and statistical framework. The paternal half-sib design allows for the separation of additive genetic from maternal effects. Replicating tanks within each family-environment combination is essential for separating common-environment effects from genotype-by-environment interactions. The proposed mixed-effects model correctly reflects this hierarchical design and includes all necessary random effects to estimate the target variance components ($\\sigma^2_s$, $\\sigma^2_{sE}$, $\\sigma^2_t$), thereby fulfilling all scientific objectives stated in the problem.", "answer": "$$\\boxed{A}$$", "id": "2629992"}, {"introduction": "Following a well-designed experiment, the final step is a rigorous statistical analysis to quantify the sources of phenotypic variation. This practice provides the analytical counterpart to the previous design exercise, guiding you through the formulation of a linear mixed-effects model to parse reaction norm data. You will derive an explicit expression for the genetic variance of a phenotype, $V_{G}(x)$, across an environmental gradient and learn how to formally partition it to isolate the genotype-by-environment interaction variance, $V_{G\\times E}(x)$ [@problem_id:2630142].", "problem": "A common way to formalize developmental plasticity and polyphenisms is through genotype-specific reaction norms that map an environmental index to a phenotype. Consider an experiment on a set of $n$ clonal genotypes reared across $m$ controlled environments characterized by a continuous environmental index $z$ that has been mean-centered so that $\\sum_{j=1}^{m} z_{j} = 0$. For each genotype $g \\in \\{1,\\dots,n\\}$ and environment $j \\in \\{1,\\dots,m\\}$, there are $r_{gj} \\ge 2$ replicate individuals indexed by $i$, yielding phenotypes $y_{igj}$. Assume a linear reaction norm for each genotype with genotype-specific intercept and slope, with replicate-level noise.\n\nUsing only the core definitions of reaction norms, linear mixed-effects modeling, and basic probability rules for linear transformations, complete the following:\n\n1) Formulate a hierarchical mixed-effects model that estimates genotype-specific intercepts and slopes. Your model must specify:\n- The individual-level equation for $y_{igj}$ in terms of a fixed intercept, a fixed slope with respect to $z_{j}$, random genotype-specific intercept and slope, and residual noise.\n- The joint distribution of the random genotype-specific effects and the distribution of residuals, including all variance components and any covariance that is necessary.\n- Independence assumptions needed for identifiability and valid inference.\n\n2) Starting from your model and using only the properties of variances and covariances of linear combinations, derive an explicit expression for the genetic variance of the phenotype at an arbitrary environment value $x$, denoted $V_{G}(x)$, in terms of the variance components of the random intercept and slope and their covariance. Then, define a principled “genotype-by-environment (GxE) variance at $x$,” $V_{G\\times E}(x)$, as the portion of $V_{G}(x)$ that arises from environment-dependent differences among genotypes relative to the mean environment $x=0$, and express $V_{G\\times E}(x)$ in closed form.\n\n3) Suppose restricted maximum likelihood (REML) estimation on the full dataset yields the following variance-component estimates for the random intercept and slope and their covariance, and for the residual variance: $\\sigma_{b0}^{2} = 0.20$, $\\sigma_{b1}^{2} = 0.10$, $\\sigma_{b0b1} = -0.02$, and $\\sigma_{e}^{2} = 0.50$. Using your derivations from part (2), compute the fraction of total phenotypic variance at environment value $x^{\\star} = 1.5$ that is attributable to GxE, defined as $V_{G\\times E}(x^{\\star})/\\left[V_{G}(x^{\\star}) + \\sigma_{e}^{2}\\right]$. Round your answer to four significant figures and report it as a decimal fraction with no units.", "solution": "The scientific base consists of the definition of a reaction norm, the linear mixed-effects (random-coefficients) model, and variance rules for linear combinations. A reaction norm maps an environmental index to a phenotype for each genotype. A linear mixed-effects model with random intercepts and slopes across genotypes captures genotype-specific reaction norms while borrowing strength across genotypes. Variance rules used include $\\operatorname{Var}(aX+bY)=a^{2}\\operatorname{Var}(X)+b^{2}\\operatorname{Var}(Y)+2ab\\,\\operatorname{Cov}(X,Y)$ and linearity of variance for independent components.\n\n1) Model formulation. Let $z_{j}$ be mean-centered. The hierarchical model is\n$$\ny_{igj} \\;=\\; \\big(\\beta_{0} + \\beta_{1} z_{j}\\big) \\;+\\; \\big(b_{0g} + b_{1g} z_{j}\\big) \\;+\\; \\varepsilon_{igj},\n$$\nwhere $\\beta_{0}$ and $\\beta_{1}$ are fixed effects representing the population-average intercept and slope of the reaction norm, and $b_{0g}$ and $b_{1g}$ are genotype-specific random deviations (random intercept and random slope). We assume the random effects are jointly Gaussian:\n$$\n\\begin{pmatrix}\nb_{0g}\\\\[4pt]\nb_{1g}\n\\end{pmatrix}\n\\sim \\mathcal{N}\\!\\left(\n\\begin{pmatrix}\n0\\\\[2pt]\n0\n\\end{pmatrix},\n\\;\\;\n\\boldsymbol{\\Sigma}_{b}\n\\right),\n\\qquad\n\\boldsymbol{\\Sigma}_{b} \\;=\\;\n\\begin{pmatrix}\n\\sigma_{b0}^{2} & \\sigma_{b0b1}\\\\[4pt]\n\\sigma_{b0b1} & \\sigma_{b1}^{2}\n\\end{pmatrix}.\n$$\nResiduals are independent and identically distributed with\n$$\n\\varepsilon_{igj} \\sim \\mathcal{N}(0,\\sigma_{e}^{2}).\n$$\nIndependence assumptions: $\\{(b_{0g},b_{1g})\\}$ are independent across genotypes, residuals $\\varepsilon_{igj}$ are independent across all individuals and independent of all random effects, and $z_{j}$ is treated as fixed by design (controlled environments) and mean-centered to improve interpretability and identifiability of $\\beta_{0}$ and $\\sigma_{b0b1}$.\n\nThis is a random-coefficients (random regression) mixed-effects model, estimating genotype-specific slopes and intercepts via the random effects $b_{0g}$ and $b_{1g}$.\n\n2) Genetic variance at environment value $x$. The genotype-specific contribution to the phenotype at environment value $x$ is the random linear predictor\n$$\n\\eta_{g}(x) \\;=\\; b_{0g} + b_{1g} x.\n$$\nBy the variance of a linear combination,\n$$\nV_{G}(x) \\;\\equiv\\; \\operatorname{Var}\\!\\big(\\eta_{g}(x)\\big)\n\\;=\\; \\operatorname{Var}(b_{0g}) \\;+\\; x^{2}\\operatorname{Var}(b_{1g}) \\;+\\; 2x\\,\\operatorname{Cov}(b_{0g},b_{1g})\n\\;=\\; \\sigma_{b0}^{2} \\;+\\; x^{2}\\sigma_{b1}^{2} \\;+\\; 2x\\,\\sigma_{b0b1}.\n$$\nBecause $z$ is mean-centered, the genetic variance at the mean environment is\n$$\nV_{G}(0) \\;=\\; \\sigma_{b0}^{2}.\n$$\nA principled way to define the genotype-by-environment (GxE) variance at $x$ is as the portion of genetic variance that arises from environment-dependent divergence among genotypes relative to the mean environment. That is,\n$$\nV_{G\\times E}(x) \\;\\equiv\\; V_{G}(x) \\;-\\; V_{G}(0)\n\\;=\\; \\big(\\sigma_{b0}^{2} + x^{2}\\sigma_{b1}^{2} + 2x\\,\\sigma_{b0b1}\\big) \\;-\\; \\sigma_{b0}^{2}\n\\;=\\; x^{2}\\sigma_{b1}^{2} \\;+\\; 2x\\,\\sigma_{b0b1}.\n$$\nThus $\\sigma_{b1}^{2}$ is the variance component capturing heterogeneity of slopes (a core GxE signature), while $\\sigma_{b0b1}$ captures whether genotypes with higher intercepts tend to increase or decrease more steeply with the environment, modulating $V_{G\\times E}(x)$ linearly in $x$.\n\nThe total phenotypic variance at $x$ under this model is\n$$\nV_{P}(x) \\;=\\; V_{G}(x) \\;+\\; \\sigma_{e}^{2}.\n$$\n\n3) Numerical evaluation at $x^{\\star}=1.5$ with the provided variance components. First compute\n$$\nV_{G}(x^{\\star}) \\;=\\; \\sigma_{b0}^{2} \\;+\\; (x^{\\star})^{2}\\sigma_{b1}^{2} \\;+\\; 2x^{\\star}\\sigma_{b0b1}\n\\;=\\; 0.20 \\;+\\; (1.5)^{2}\\cdot 0.10 \\;+\\; 2\\cdot 1.5 \\cdot (-0.02).\n$$\nCompute terms:\n- $(1.5)^{2}\\cdot 0.10 \\;=\\; 2.25 \\cdot 0.10 \\;=\\; 0.225$,\n- $2\\cdot 1.5 \\cdot (-0.02) \\;=\\; -0.06$.\nTherefore,\n$$\nV_{G}(1.5) \\;=\\; 0.20 + 0.225 - 0.06 \\;=\\; 0.365.\n$$\nThen\n$$\nV_{G\\times E}(1.5) \\;=\\; V_{G}(1.5) - V_{G}(0) \\;=\\; 0.365 - 0.20 \\;=\\; 0.165.\n$$\nTotal phenotypic variance at $x^{\\star}$ is\n$$\nV_{P}(1.5) \\;=\\; V_{G}(1.5) + \\sigma_{e}^{2} \\;=\\; 0.365 + 0.50 \\;=\\; 0.865.\n$$\nHence the requested fraction is\n$$\n\\frac{V_{G\\times E}(1.5)}{V_{P}(1.5)} \\;=\\; \\frac{0.165}{0.865} \\;=\\; \\frac{33}{173} \\;\\approx\\; 0.190751\\ldots\n$$\nRounded to four significant figures, this is $0.1908$ as a decimal fraction with no units.", "answer": "$$\\boxed{0.1908}$$", "id": "2630142"}]}