{"hands_on_practices": [{"introduction": "To begin our practical exploration of coalescent theory, we start with a fundamental question of probability. When we trace multiple genetic lineages back in time, any pair of them could be the next to 'coalesce' by finding a common ancestor. This exercise [@problem_id:1477306] challenges you to calculate the probability of a specific pair being the first to merge, introducing the core assumption that under a neutral model, every possible pair has an equal chance.", "problem": "A population geneticist is studying the ancestry of a species using a simplified model of population dynamics. In this model, the population size is assumed to be large and constant over time. The geneticist collects DNA from four distinct individuals, labeled A, B, C, and D, and traces their genetic history backward in time. Each of these individuals represents a unique genetic lineage.\n\nA 'coalescence event' is defined as the moment in the past when two distinct lineages trace back to a single Most Recent Common Ancestor (MRCA). The fundamental assumption of this model is that when looking backward in time, any pair of existing lineages is equally likely to be the next to coalesce.\n\nGiven the initial sample of four lineages (A, B, C, and D), what is the exact probability that the very first coalescence event to occur is the one that merges lineages A and B?\n\nExpress your answer as a simplified fraction.", "solution": "The problem asks for the probability of a specific pair of lineages, (A, B), being the first to coalesce out of a sample of four lineages (A, B, C, and D).\n\nThe core principle stated in the problem is that any pair of existing lineages is equally likely to be the next to coalesce. Therefore, to solve this problem, we need to determine the total number of possible pairs that could coalesce and then find the ratio of our specific outcome of interest to this total number.\n\nFirst, let's identify the total number of lineages in the sample, which is $n=4$. A coalescence event involves the merging of exactly two of these lineages. So, our task is to count how many distinct pairs of lineages can be formed from the set {A, B, C, D}. This is a problem of combinations, specifically choosing 2 items from a set of 4.\n\nThe number of ways to choose $k$ items from a set of $n$ items is given by the binomial coefficient, $\\binom{n}{k}$, calculated as:\n$$ \\binom{n}{k} = \\frac{n!}{k!(n-k)!} $$\nIn our case, $n=4$ and $k=2$. So, the total number of possible pairs for the first coalescence event is:\n$$ \\binom{4}{2} = \\frac{4!}{2!(4-2)!} = \\frac{4!}{2!2!} = \\frac{4 \\times 3 \\times 2 \\times 1}{(2 \\times 1)(2 \\times 1)} = \\frac{24}{4} = 6 $$\nThese 6 possible pairs are: (A, B), (A, C), (A, D), (B, C), (B, D), and (C, D).\n\nAccording to the model's assumption, each of these 6 possible coalescence events is equally likely to be the first one to occur. This set of 6 pairs represents the entire sample space of possible outcomes for the first coalescence event.\n\nThe specific event we are interested in is the coalescence of lineages A and B. This corresponds to just one of the possible outcomes: the pair (A, B).\n\nThe probability of a specific event is the ratio of the number of favorable outcomes to the total number of possible outcomes.\nNumber of favorable outcomes (coalescence of A and B) = 1.\nTotal number of possible outcomes (any pair coalescing) = 6.\n\nTherefore, the probability $P$ is:\n$$ P(\\text{A and B coalesce first}) = \\frac{\\text{Number of favorable outcomes}}{\\text{Total number of possible outcomes}} = \\frac{1}{6} $$\nThe answer is asked to be in the form of a simplified fraction, which $\\frac{1}{6}$ is.", "answer": "$$\\boxed{\\frac{1}{6}}$$", "id": "1477306"}, {"introduction": "Having established the probability of a specific coalescence, we now move to a question of timing: how long must we wait for the first ancestral connection to occur? This practice [@problem_id:1477286] introduces the concept of the expected waiting time for a coalescent event, a crucial parameter that depends on both the effective population size $N$ and the number of lineages being studied. Understanding this relationship is key to using genetic data to infer population history.", "problem": "Consider an idealized diploid population with a constant size of $N$ individuals. In this model, generations are discrete and non-overlapping. We assume that each allele in a given generation is a perfect copy of a randomly selected allele from the complete gene pool of the previous generation. The gene pool of any parental generation consists of $2N$ alleles in total.\n\nWhen tracing the ancestry of alleles backward in time, a 'coalescent event' is defined as the moment when two distinct genetic lineages originate from the same single parental allele in the immediately preceding generation.\n\nSuppose you have collected a sample containing four distinct alleles from the current population. You wish to trace their ancestries back in time. Calculate the expected number of generations one must go back until the first coalescent event occurs among any pair of these four lineages. Such an event will reduce the number of distinct ancestral lineages in your sample from four to three.\n\nExpress your answer as an analytical formula in terms of the population size $N$.", "solution": "We model reproduction by the Wrightâ€“Fisher scheme for a diploid population of constant size $N$, so that each of the $2N$ alleles in generation $t-1$ is an equally likely parent for any allele in generation $t$. Tracing $k$ sampled lineages backward one generation, each lineage independently chooses one parent allele uniformly from the $2N$ parental alleles.\n\nFor any specific pair of lineages, the probability that they coalesce in the immediately preceding generation (i.e., both choose the same parental allele) is\n$$\n\\frac{1}{2N},\n$$\nsince after the first lineage picks an ancestor, the second must match that choice among $2N$ equally likely alleles.\n\nWith $k=4$ lineages, there are $\\binom{4}{2}=6$ unordered pairs. Under the standard coalescent approximation (which ignores the probability of simultaneous multiple coalescences, an event of order $(2N)^{-2}$), the per-generation probability that at least one pair coalesces is\n$$\np=\\binom{4}{2}\\cdot\\frac{1}{2N}=\\frac{6}{2N}=\\frac{3}{N}.\n$$\nBecause each generation back either yields a coalescent event (reducing the number of lineages) or leaves all four lineages distinct, and the situation renews with the same probability in each step, the waiting time $T$ (in generations) to the first coalescent event has a geometric distribution with success parameter $p$. Therefore, the expected number of generations until the first coalescent event is\n$$\n\\mathbb{E}[T]=\\frac{1}{p}=\\frac{N}{3}.\n$$", "answer": "$$\\boxed{\\frac{N}{3}}$$", "id": "1477286"}, {"introduction": "In our final practice, we will synthesize what we've learned about individual coalescent events to answer a much larger question: what is the total expected time until all sampled lineages trace back to a single Most Recent Common Ancestor (MRCA)? This exercise [@problem_id:1477323] guides you through the derivation of one of the most important results in coalescent theory. By summing the expected waiting times for each successive step, you will see how the entire ancestral history of a sample can be modeled mathematically.", "problem": "In population genetics, the Wright-Fisher model provides a simplified mathematical framework for understanding genetic drift. Consider a stable, isolated population of a diploid species with a constant size of $N$ individuals. This means there are $2N$ copies of any given gene in the population's gene pool in each generation. Within this population, we sample $n$ gene copies (where $2 \\le n \\le 2N$) from the current generation and wish to trace their ancestry back in time. All lineages will eventually trace back to a single ancestral gene copy. We are interested in the expected Time to the Most Recent Common Ancestor (TMRCA) for this sample of $n$ genes.\n\nAssuming the principles of the Wright-Fisher model, where in each generation the entire gene pool is formed by sampling with replacement from the previous generation's gene pool, derive a closed-form analytical expression for the expected TMRCA of the $n$ sampled gene copies. Express your answer in units of generations, as a function of the population size $N$ and the sample size $n$.", "solution": "The problem asks for the expected Time to the Most Recent Common Ancestor (TMRCA) for a sample of $n$ gene copies from a diploid population of size $N$. Following the Wright-Fisher model, there are $2N$ total gene copies in the population. We can trace the lineages of the $n$ samples backwards in time.\n\nLet's denote the number of distinct ancestral lineages at a given past generation as $k$. Initially, at the time of sampling, we have $k=n$ distinct lineages. As we go back in time, these lineages coalesce (i.e., find a common ancestor). The process is complete when all lineages have coalesced into a single ancestor, so when $k=1$. The total time to the MRCA is the sum of the waiting times for the number of lineages to drop from $n$ to $n-1$, from $n-1$ to $n-2$, and so on, down to 2 to 1.\n\nLet's consider the system when there are $k$ distinct lineages. The probability that any two specific lineages find their common ancestor in the immediately preceding generation is the probability that they were both copied from the same parental gene. In a population of $2N$ gene copies, this probability is $\\frac{1}{2N}$.\n\nWhen we have $k$ lineages, there are $\\binom{k}{2}$ distinct pairs of lineages that could potentially coalesce. The probability of a single coalescence event happening in the preceding generation is the number of pairs multiplied by the probability of coalescence for a single pair. We assume the probability of more than one coalescence event in a single generation is negligible for large $N$.\nSo, the probability of a coalescence event happening when there are $k$ lineages is:\n$$P_k = \\binom{k}{2} \\frac{1}{2N} = \\frac{k(k-1)}{2} \\frac{1}{2N} = \\frac{k(k-1)}{4N}$$\n\nThe waiting time for a coalescence event to occur (i.e., the time for the number of lineages to drop from $k$ to $k-1$) follows a geometric distribution with success probability $P_k$. The expected waiting time, $E[T_k]$, for this interval is the reciprocal of the success probability:\n$$E[T_k] = \\frac{1}{P_k} = \\frac{4N}{k(k-1)}$$\n\nThe total expected time to the MRCA, $E[T_{\\text{total}}]$, is the sum of the expected waiting times for each interval, as the number of lineages decreases from $n$ to $2$. We sum from $k=n$ down to $k=2$.\n$$E[T_{\\text{total}}] = \\sum_{k=2}^{n} E[T_k] = \\sum_{k=2}^{n} \\frac{4N}{k(k-1)}$$\nWe can factor out the constant $4N$ from the summation:\n$$E[T_{\\text{total}}] = 4N \\sum_{k=2}^{n} \\frac{1}{k(k-1)}$$\nTo evaluate this sum, we use partial fraction decomposition for the term inside the summation:\n$$\\frac{1}{k(k-1)} = \\frac{A}{k} + \\frac{B}{k-1}$$\nMultiplying by $k(k-1)$ gives $1 = A(k-1) + Bk$.\nIf we set $k=1$, we get $1 = B(1) \\implies B=1$.\nIf we set $k=0$, we get $1 = A(-1) \\implies A=-1$.\nSo, the decomposition is:\n$$\\frac{1}{k(k-1)} = \\frac{1}{k-1} - \\frac{1}{k}$$\nNow we substitute this back into our summation. The sum becomes a telescoping series:\n$$E[T_{\\text{total}}] = 4N \\sum_{k=2}^{n} \\left(\\frac{1}{k-1} - \\frac{1}{k}\\right)$$\nLet's expand the terms of the sum:\nFor $k=2$: $\\frac{1}{1} - \\frac{1}{2}$\nFor $k=3$: $\\frac{1}{2} - \\frac{1}{3}$\nFor $k=4$: $\\frac{1}{3} - \\frac{1}{4}$\n...\nFor $k=n$: $\\frac{1}{n-1} - \\frac{1}{n}$\n\nSumming these up, all the intermediate terms cancel out:\n$$\\sum_{k=2}^{n} \\left(\\frac{1}{k-1} - \\frac{1}{k}\\right) = \\left(1 - \\frac{1}{2}\\right) + \\left(\\frac{1}{2} - \\frac{1}{3}\\right) + \\left(\\frac{1}{3} - \\frac{1}{4}\\right) + \\dots + \\left(\\frac{1}{n-1} - \\frac{1}{n}\\right) = 1 - \\frac{1}{n}$$\nSubstituting this result back into the expression for the expected total time:\n$$E[T_{\\text{total}}] = 4N \\left(1 - \\frac{1}{n}\\right)$$\nThis is the closed-form analytical expression for the expected TMRCA in units of generations.", "answer": "$$\\boxed{4N\\left(1 - \\frac{1}{n}\\right)}$$", "id": "1477323"}]}