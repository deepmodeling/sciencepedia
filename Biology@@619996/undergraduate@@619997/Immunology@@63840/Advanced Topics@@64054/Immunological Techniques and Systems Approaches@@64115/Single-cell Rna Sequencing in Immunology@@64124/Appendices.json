{"hands_on_practices": [{"introduction": "In single-cell RNA sequencing, we begin with a massive dataset measuring thousands of genes for every single cell. The first challenge is to reduce this high-dimensional complexity into a manageable form without losing the essential biological information. This exercise [@problem_id:2268292] delves into Principal Component Analysis (PCA), a cornerstone of this process, by modeling the trade-off between retaining genuine biological signal and incorporating technical noise. You will quantitatively determine the optimal number of principal components, a critical decision that profoundly impacts all subsequent analysis.", "problem": "An immunologist is analyzing data from a single-cell RNA sequencing (scRNA-seq) experiment designed to characterize the immune cell landscape within a tumor microenvironment. The initial step in the analysis is Principal Component Analysis (PCA), a dimensionality reduction technique used to identify the major axes of variation in the high-dimensional gene expression data.\n\nA simplified model is proposed to describe the variance captured by each principal component (PC). The total variance of the $i$-th PC, $V_i$, is composed of a biological signal component, $S_i$, and a random noise component, $N_i$, such that $V_i = S_i + N_i$.\n\nThe signal variance, which arises from true biological differences between cell types (e.g., T-cells vs. different macrophage subtypes), is modeled to decay exponentially for successive PCs:\n$$S_i = A \\exp(-\\alpha (i-1)) \\quad \\text{for } i \\ge 1$$\nThe noise variance, arising from technical artifacts and stochastic gene expression, is assumed to contribute a constant amount to each PC:\n$$N_i = N_0$$\nThe parameters for this model, derived from the data, are: $A = 100$ (in arbitrary units of variance), $\\alpha = 0.5$, and $N_0 = 5$.\n\nTo select the optimal number of PCs for downstream clustering, a two-part strategy is employed to balance capturing sufficient biological signal against including excessive noise.\n1.  Determine the 'elbow point', $k_{elbow}$, defined as the minimum integer $k$ for which the signal variance is smaller than the noise variance ($S_k < N_k$). Using PCs beyond this point is thought to predominantly add noise.\n2.  Determine the minimum number of PCs, $k_{signal}$, required to capture at least a fraction $f_S = 0.99$ of the *total* biological signal available across all possible PCs.\n\nThe final number of PCs to be used in the analysis, $k_{final}$, is chosen as the maximum of these two values, i.e., $k_{final} = \\max(k_{elbow}, k_{signal})$, to ensure both criteria are met.\n\nCalculate the integer value of $k_{final}$.", "solution": "We are given $V_{i}=S_{i}+N_{i}$ with $S_{i}=A\\exp(-\\alpha(i-1))$ and $N_{i}=N_{0}$, where $A=100$, $\\alpha=0.5$, and $N_{0}=5$. We must compute $k_{elbow}$ and $k_{signal}$, then take $k_{final}=\\max(k_{elbow},k_{signal})$.\n\nElbow point $k_{elbow}$: This is the minimum integer $k$ such that $S_{k}<N_{k}=N_{0}$. The inequality\n$$\nA\\exp(-\\alpha(k-1))<N_{0}\n$$\nis equivalent (using the monotonicity of the exponential and logarithm) to\n$$\n-\\alpha(k-1)<\\ln\\!\\left(\\frac{N_{0}}{A}\\right)\\quad\\Longrightarrow\\quad k-1>-\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{N_{0}}{A}\\right)=\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right).\n$$\nThus the minimal integer satisfying the strict inequality is\n$$\nk_{elbow}=\\left\\lfloor 1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)\\right\\rfloor+1.\n$$\nSubstituting $A=100$, $N_{0}=5$, and $\\alpha=0.5$ gives\n$$\n1+\\frac{1}{\\alpha}\\ln\\!\\left(\\frac{A}{N_{0}}\\right)=1+2\\ln(20)\\approx 1+2\\times 2.995732=6.991464,\n$$\nso $k_{elbow}=7$. Directly, $S_{7}=100\\exp(-0.5\\times 6)=100\\exp(-3)\\approx 4.9787<5$, while $S_{6}=100\\exp(-2.5)\\approx 8.2085>5$, confirming $k_{elbow}=7$.\n\nSignal coverage $k_{signal}$: Let $r=\\exp(-\\alpha)$. The total biological signal is the geometric series\n$$\nS_{\\text{total}}=\\sum_{i=1}^{\\infty}S_{i}=A\\sum_{j=0}^{\\infty}r^{j}=\\frac{A}{1-r}.\n$$\nThe partial sum through $k$ is\n$$\n\\sum_{i=1}^{k}S_{i}=A\\frac{1-r^{k}}{1-r}.\n$$\nWe require\n$$\nA\\frac{1-r^{k}}{1-r}\\ge f_{S}\\frac{A}{1-r}\\quad\\Longleftrightarrow\\quad 1-r^{k}\\ge f_{S}\\quad\\Longleftrightarrow\\quad r^{k}\\le 1-f_{S}.\n$$\nTaking natural logarithms (noting $0<r<1$ so $\\ln r<0$) gives\n$$\nk\\ln r\\le \\ln(1-f_{S})\\quad\\Longrightarrow\\quad k\\ge \\frac{\\ln(1-f_{S})}{\\ln r}.\n$$\nWith $r=\\exp(-\\alpha)$, $\\ln r=-\\alpha$, so\n$$\nk\\ge \\frac{\\ln(1-f_{S})}{-\\alpha}.\n$$\nFor $f_{S}=0.99$ and $\\alpha=0.5$,\n$$\nk\\ge \\frac{\\ln(0.01)}{-0.5}=\\frac{-\\ln(100)}{-0.5}=\\frac{-4.605170\\ldots}{-0.5}=9.21034\\ldots,\n$$\nso the minimal integer is $k_{signal}=\\lceil 9.21034\\ldots\\rceil=10$. Check: the captured fraction at $k=10$ is $1-r^{10}=1-\\exp(-5)\\approx 0.9933\\ge 0.99$, while at $k=9$ it is $1-\\exp(-4.5)\\approx 0.9889<0.99$.\n\nFinally,\n$$\nk_{final}=\\max(k_{elbow},k_{signal})=\\max(7,10)=10.\n$$", "answer": "$$\\boxed{10}$$", "id": "2268292"}, {"introduction": "After reducing the dimensionality of your data, the next goal is to group cells into biologically meaningful clusters, a step analogous to identifying different species in an ecosystem. However, defining the boundaries between closely related cell states, like activated versus resting immune cells, is a significant challenge. This practice [@problem_id:2268269] explores the crucial `resolution` parameter in clustering algorithms, illustrating the delicate balance between merging distinct populations (under-clustering) and artificially splitting a uniform population (over-clustering).", "problem": "An immunologist is analyzing a single-cell RNA sequencing (scRNA-seq) dataset from a mouse lymph node actively forming a Germinal Center (GC) during an immune response. The primary objective is to distinguish between two functionally distinct, yet closely related, B cell populations within the GC: the highly proliferative dark zone (DZ) B cells and the antigen-presenting light zone (LZ) B cells. The analysis workflow utilizes a standard graph-based clustering algorithm, which partitions cells into clusters based on transcriptional similarity. A key parameter in this algorithm is `resolution`. A low resolution value tends to produce fewer and larger clusters, while a high resolution value yields more and smaller clusters.\n\nThe immunologist performs clustering with two different parameter settings: a low resolution, `R_low`, and a high resolution, `R_high`.\n\n- Using `R_low`, the analysis identifies a single large cluster encompassing all GC B cells. While this cluster is correctly identified based on canonical GC markers, it fails to separate the DZ and LZ populations.\n- Using `R_high`, the analysis successfully separates the GC B cells into two distinct clusters that correspond precisely to the DZ and LZ populations, as validated by their differential expression of known marker genes (e.g., proliferative genes for DZ, antigen presentation genes for LZ). However, this setting also produces several additional small B cell clusters that do not correspond to any known cell types and whose biological relevance is uncertain.\n\nWhich of the following statements most accurately describes the fundamental trade-off illustrated by the outcomes of using `R_high` versus `R_low` in this specific scenario?\n\nA. The `R_high` setting is objectively superior because it maximizes the discovery of true biological diversity. The additional small clusters must represent novel, rare B cell subtypes that were previously unappreciated.\n\nB. The resolution parameter is a direct proxy for the statistical p-value used for cluster separation. Using `R_high` corresponds to a less stringent p-value, which increases the statistical power to detect real differences but at the cost of a higher false discovery rate.\n\nC. The choice of `R_high` enables the desired separation of DZ and LZ populations but introduces the significant risk of over-clustering. This phenomenon can artificially partition a single, biologically coherent cell population into multiple smaller clusters based on technical noise or minor stochastic variation, complicating interpretation.\n\nD. The `R_low` setting is preferable for studying closely related cell states because it produces more stable and robust clusters. The inability to distinguish DZ and LZ cells is an acceptable compromise to avoid the generation of spurious, meaningless cell clusters.\n\nE. The clustering outcome for closely related cell states like DZ and LZ B cells is primarily dependent on the initial number of principal components selected for the analysis, not the resolution parameter. The observed difference is likely an artifact of other upstream processing steps.", "solution": "We identify the core elements of the scenario: a graph-based clustering algorithm with a tunable resolution parameter, where low resolution ($R_{\\text{low}}$) yields fewer, larger clusters (risk of under-clustering) and high resolution ($R_{\\text{high}}$) yields more, smaller clusters (risk of over-clustering). Empirically, $R_{\\text{low}}$ merges dark zone (DZ) and light zone (LZ) B cells into a single GC cluster, demonstrating under-clustering that obscures biologically meaningful distinctions. Conversely, $R_{\\text{high}}$ separates DZ and LZ as validated by canonical markers (proliferative genes for DZ, antigen presentation genes for LZ), indicating successful resolution of relevant biological structure, but produces extra small clusters of uncertain biological relevance, which is characteristic of over-clustering.\n\nWe evaluate each option against standard properties of resolution in Louvain/Leiden clustering and scRNA-seq analysis practice:\n- Option A incorrectly asserts that higher resolution is objectively superior and that all additional clusters must be novel subtypes. This ignores the well-known phenomenon of over-clustering where technical noise or minor stochastic variation can yield artificial partitions.\n- Option B incorrectly equates the resolution parameter to a statistical p-value. Graph-based community detection does not use a hypothesis-testing p-value in this manner; resolution modifies the modularity landscape and cluster granularity, not a significance threshold.\n- Option C correctly states the trade-off: $R_{\\text{high}}$ enables the desired DZ/LZ separation but increases the risk of over-clustering, potentially fragmenting a coherent population into spurious clusters due to noise or subtle, possibly non-biological variability, complicating interpretation.\n- Option D recommends preferring $R_{\\text{low}}$ and accepting loss of DZ/LZ resolution for stability. This is not generally appropriate; the goal is to capture biologically meaningful distinctions, and stability does not necessarily improve at lower resolution nor justify missing key states.\n- Option E shifts the explanation to the number of principal components rather than resolution. While the choice of principal components affects the neighborhood graph and can influence clustering, the scenario explicitly contrasts outcomes due to changing resolution with validation by marker genes; thus attributing the effect primarily to PCs is not accurate here.\n\nTherefore, the fundamental trade-off in this scenario is correctly captured by the risk of over-clustering introduced by $R_{\\text{high}}$ despite achieving the desired DZ/LZ separation.", "answer": "$$\\boxed{C}$$", "id": "2268269"}, {"introduction": "With cell clusters defined, the exciting work of biological interpretation can begin. A key task is to understand what makes one cluster functionally different from another, and this is often answered by looking at the expression of specific genes. This exercise [@problem_id:2268290] will teach you how to read violin plots, which are rich visualizations that go beyond simple averages to show the full distribution of gene expression. Learning to interpret these plots is essential for uncovering the heterogeneity and functional state of immune cell populations.", "problem": "A team of immunologists is studying macrophage activation using single-cell RNA sequencing (scRNA-seq), a technique that measures gene expression levels in thousands of individual cells. After processing their data, they identified three distinct clusters of macrophages, which they labeled Cluster A, Cluster B, and Cluster C. They then generated violin plots to visualize the expression of the gene for Tumor Necrosis Factor (*TNF*), a potent pro-inflammatory cytokine, within each cluster.\n\nA violin plot is a method of plotting numerical data. The shape of the \"violin\" represents the probability density of the data at different values, with wider sections representing a higher frequency of cells expressing the gene at that level. A dot or line inside typically marks the median expression for the cluster.\n\nThe researchers observed the following characteristics for the *TNF* gene expression violin plots:\n\n*   **Cluster A:** The plot is broad and distinctly bimodal, meaning it has two peaks. One peak is near zero expression, and a second, substantial peak is at a high expression level. The median expression is moderate.\n*   **Cluster B:** The plot is very narrow and centered at a high expression level. The vast majority of cells in this cluster show a similar, high level of *TNF* expression.\n*   **Cluster C:** The plot is wide and strongly skewed towards zero expression. Most cells show little to no *TNF* expression, but there is a long \"tail\" of cells with progressively higher expression levels. The median expression is very low.\n\nBased on these descriptions of the violin plots for *TNF* expression, which of the following statements provides the most accurate biological interpretation?\n\nA. Cluster C represents the most potent pro-inflammatory macrophage population because its violin plot is the widest, indicating a diverse response.\n\nB. The cells in Cluster A are uniformly and strongly responding to a pro-inflammatory stimulus, as indicated by its moderate median *TNF* expression.\n\nC. Cluster B represents a highly homogeneous population of macrophages mounting a strong, consistent pro-inflammatory response, while Cluster A contains a heterogeneous population with a subset of strongly responding cells.\n\nD. The total amount of TNF protein produced by all cells in Cluster C is likely greater than that produced by Cluster B, because Cluster C's distribution covers a wider range of expression values.", "solution": "Interpretation principles for violin plots: the width at a given expression value $x$ reflects the probability density $p(x)$ of cells at that expression level; multiple peaks indicate multimodality; the median summarizes central tendency; skewness indicates the direction of a long tail. For biological interpretation of pro-inflammatory response via TNF, higher expression across many cells indicates stronger and more consistent activation, while heterogeneity indicates mixed responding and non-responding subpopulations.\n\nFor Cluster A, the violin is broad and bimodal with one peak near zero and another at high expression, and the median is moderate. Let $p_{A}(x)$ denote the expression distribution. The two modes, one near $x \\approx 0$ and one at a high $x$, imply a mixture model with a subpopulation of non- or low-responders and a subpopulation of strong responders. The moderate median arises because the cumulative distribution function crosses $0.5$ between the two modes, not because most cells are at a moderate level. Therefore, Cluster A is heterogeneous, not uniformly strongly responding.\n\nFor Cluster B, the violin is very narrow and centered at a high expression level. Let $p_{B}(x)$ be tightly concentrated with small variance around a large mean $\\mu_{B}$ and median $m_{B}$, both high. This indicates that nearly all cells have similar, high TNF expression; biologically, this is a homogeneous population mounting a strong, consistent pro-inflammatory response.\n\nFor Cluster C, the violin is wide and strongly skewed toward zero, with a long right tail and a very low median. Let $p_{C}(x)$ be heavily weighted near $x \\approx 0$ with a long tail to larger $x$. The low median $m_{C}$ and high density near zero imply that most cells have little to no TNF expression, with only a minority showing progressively higher levels. This indicates predominantly weak or absent response with a small subset of higher responders; variability (width) reflects heterogeneity, not potency.\n\nEvaluate the options:\n- Option A claims Cluster C is the most potent because its violin is widest. This confuses variability with potency. Given $m_{C}$ is very low and most density is near zero, Cluster C is not the most potent; the width reflects heterogeneity and a tail, not strong overall activation. Thus A is incorrect.\n- Option B claims Cluster A is uniformly and strongly responding based on a moderate median. The bimodality of $p_{A}(x)$ with a peak near zero contradicts uniform strong response; the moderate median is a consequence of mixing low and high subpopulations. Thus B is incorrect.\n- Option C states Cluster B is a highly homogeneous, strongly responding population, while Cluster A is heterogeneous with a subset of strong responders. This matches the narrow, high-centered $p_{B}(x)$ and the bimodal $p_{A}(x)$ with a high-expression subpopulation. Thus C is correct.\n- Option D claims the total TNF from Cluster C likely exceeds Cluster B because C’s distribution spans a wider range. Total production is proportional to the sum (or mean $\\mu$ times cell count), not the range or width. Given Cluster B has high expression for the vast majority of cells (large $\\mu_{B}$), whereas Cluster C has most cells near zero (small $\\mu_{C}$ despite a tail), it is not supported that Cluster C would produce more total TNF; the justification via range is flawed. Thus D is incorrect.\n\nTherefore, the most accurate interpretation is that Cluster B is homogeneous with a strong, consistent response, and Cluster A is heterogeneous with a subset of strongly responding cells.", "answer": "$$\\boxed{C}$$", "id": "2268290"}]}