{"hands_on_practices": [{"introduction": "A selective sweep's influence is spatially limited. The question of \"how far\" its effects extend along a chromosome is fundamental to understanding and detecting these events. This exercise provides a hands-on opportunity to derive the approximate radius of a selective sweep from first principles, connecting the selection coefficient ($s$), effective population size ($N_e$), and recombination rate ($r$) [@problem_id:2822133]. By calculating the genomic distance at which recombination is likely to have broken the association with the sweeping allele, you will develop a tangible intuition for the physical scale of hitchhiking.", "problem": "A newly arisen advantageous allele undergoes a hard selective sweep in a large, panmictic diploid population with effective population size (denoted $N_e$). Assume genic selection (no dominance), so that in the deterministic limit the allele frequency $p(t)$ evolves according to the logistic differential equation $dp/dt = s\\,p(1-p)$, where $s$ is the selection coefficient and $t$ is measured in generations. Suppose the per–base pair per–generation recombination rate is uniform and equal to $r$. For a neutral site at a physical distance $x$ base pairs from the selected site, approximate the recombination fraction between the sites as $c \\approx r\\,x$.\n\nFor the purposes of this problem, define the sweep radius $x^{\\ast}$ to be the distance at which the expected number of recombination events along a single ancestral lineage during the sweep (from introduction at frequency $p_0 = 1/(2N_e)$ to near-fixation at frequency $p_1 = 1 - 1/(2N_e)$) is approximately one. Use only first principles and explicit assumptions to derive and evaluate $x^{\\ast}$ for $N_e = 10^6$, $s = 0.01$, and $r = 1 \\times 10^{-8}$ per base pair per generation. Clearly state the assumptions you adopt in translating the selective sweep duration and recombination process into this radius.\n\nExpress the final answer as a single number in base pairs (bp) and round to one significant figure.", "solution": "The problem requires the derivation of the sweep radius, denoted $x^{\\ast}$. The problem statement must first be validated for scientific and logical integrity.\n\n**Problem Validation**\n\nThe givens are:\n- An effective population size $N_e$.\n- A diploid, panmictic population model.\n- An advantageous allele with a selection coefficient $s$ undergoing genic selection.\n- The deterministic frequency change is governed by the logistic equation $\\frac{dp}{dt} = s p(1-p)$.\n- A uniform per-base pair per-generation recombination rate $r$.\n- The recombination fraction $c$ between the selected locus and a neutral site at distance $x$ is approximated as $c \\approx r x$.\n- The sweep starts at an initial frequency $p_0 = \\frac{1}{2N_e}$ and ends at a near-fixation frequency of $p_1 = 1 - \\frac{1}{2N_e}$.\n- The sweep radius $x^{\\ast}$ is defined as the distance where the expected number of recombination events along a single ancestral lineage during the sweep is approximately $1$.\n- Numerical values provided are $N_e = 10^6$, $s = 0.01$, and $r = 1 \\times 10^{-8}$ per base pair per generation.\n\nThe problem is scientifically grounded in the established principles of population genetics, specifically the theory of selective sweeps and hitchhiking. The logistic model for allele frequency change is a standard, fundamental result. The definition of initial allele frequency, the relationship between physical distance and recombination fraction, and the concept of a sweep radius are all standard components of this field. The problem is well-posed, providing a clear, self-contained definition for the quantity to be derived, $x^{\\ast}$, and all necessary parameters for its calculation. The language is objective and precise. The numerical values are plausible. Thus, the problem is deemed valid.\n\n**Solution Derivation**\n\nThe derivation proceeds in three stages: first, formalizing the definition of the sweep radius $x^{\\ast}$; second, calculating the duration of the selective sweep, $T_{\\text{sweep}}$; and third, combining these results to find an analytical and numerical value for $x^{\\ast}$.\n\nThe sweep radius $x^{\\ast}$ is defined by the condition that the expected number of recombination events on a single ancestral lineage tracked over the duration of the sweep is equal to $1$. Let $E$ be this expected number. The rate of recombination for a lineage at a site with recombination fraction $c$ is simply $c$ per generation. For a total duration of $T_{\\text{sweep}}$ generations, the expected number of events is the product of the rate and the duration:\n$$E = c \\times T_{\\text{sweep}}$$\nUsing the provided approximation $c \\approx r x$, the expected number of events at a distance $x$ is:\n$$E(x) \\approx r x T_{\\text{sweep}}$$\nThe condition for the sweep radius $x = x^{\\ast}$ is $E(x^{\\ast}) = 1$. Therefore, we have:\n$$r x^{\\ast} T_{\\text{sweep}} \\approx 1$$\nThis yields an expression for $x^{\\ast}$ that depends on the sweep duration:\n$$x^{\\ast} \\approx \\frac{1}{r T_{\\text{sweep}}}$$\n\nThe next step is to calculate $T_{\\text{sweep}}$. This is the time required for the allele frequency $p(t)$ to increase from its initial value $p_0 = \\frac{1}{2N_e}$ to its final value $p_1 = 1 - \\frac{1}{2N_e}$. The dynamics are given by the differential equation:\n$$\\frac{dp}{dt} = s p(1-p)$$\nThis equation is separable. We can write:\n$$dt = \\frac{1}{s} \\frac{dp}{p(1-p)}$$\nTo find the total time $T_{\\text{sweep}}$, we integrate this expression from $p_0$ to $p_1$:\n$$T_{\\text{sweep}} = \\int_{0}^{T_{\\text{sweep}}} dt = \\frac{1}{s} \\int_{p_0}^{p_1} \\frac{dp}{p(1-p)}$$\nThe integrand is resolved using partial fraction decomposition:\n$$\\frac{1}{p(1-p)} = \\frac{1}{p} + \\frac{1}{1-p}$$\nSubstituting this back into the integral gives:\n$$T_{\\text{sweep}} = \\frac{1}{s} \\int_{p_0}^{p_1} \\left( \\frac{1}{p} + \\frac{1}{1-p} \\right) dp = \\frac{1}{s} \\left[ \\ln(p) - \\ln(1-p) \\right]_{p_0}^{p_1} = \\frac{1}{s} \\left[ \\ln\\left(\\frac{p}{1-p}\\right) \\right]_{p_0}^{p_1}$$\nEvaluating the expression at the limits of integration:\n$$T_{\\text{sweep}} = \\frac{1}{s} \\left( \\ln\\left(\\frac{p_1}{1-p_1}\\right) - \\ln\\left(\\frac{p_0}{1-p_0}\\right) \\right)$$\nNow we substitute the values of $p_0 = \\frac{1}{2N_e}$ and $p_1 = 1 - \\frac{1}{2N_e}$.\n$$\\frac{p_1}{1-p_1} = \\frac{1 - \\frac{1}{2N_e}}{\\frac{1}{2N_e}} = \\frac{2N_e - 1}{1} = 2N_e - 1$$\n$$\\frac{p_0}{1-p_0} = \\frac{\\frac{1}{2N_e}}{1 - \\frac{1}{2N_e}} = \\frac{1}{2N_e - 1}$$\nSubstituting these into the equation for $T_{\\text{sweep}}$:\n$$T_{\\text{sweep}} = \\frac{1}{s} \\left( \\ln(2N_e - 1) - \\ln\\left(\\frac{1}{2N_e - 1}\\right) \\right) = \\frac{1}{s} \\left( \\ln(2N_e - 1) + \\ln(2N_e - 1) \\right)$$\n$$T_{\\text{sweep}} = \\frac{2}{s} \\ln(2N_e - 1)$$\nSince the effective population size $N_e = 10^6$ is very large, $2N_e - 1 \\approx 2N_e$. We can use the excellent approximation:\n$$T_{\\text{sweep}} \\approx \\frac{2}{s} \\ln(2N_e)$$\nNow, we substitute this expression for $T_{\\text{sweep}}$ into our equation for $x^{\\ast}$:\n$$x^{\\ast} \\approx \\frac{1}{r \\left( \\frac{2}{s} \\ln(2N_e) \\right)} = \\frac{s}{2r \\ln(2N_e)}$$\nThis is the final analytical expression for the sweep radius.\n\nFinally, we substitute the provided numerical values: $s = 0.01$, $r = 1 \\times 10^{-8}$ per base pair per generation, and $N_e = 10^6$.\n$$x^{\\ast} \\approx \\frac{0.01}{2(1 \\times 10^{-8}) \\ln(2 \\times 10^6)}$$\n$$x^{\\ast} \\approx \\frac{10^{-2}}{2 \\times 10^{-8} \\ln(2 \\times 10^6)} = \\frac{10^6}{2 \\ln(2 \\times 10^6)}$$\nWe calculate the value of the logarithm:\n$$\\ln(2 \\times 10^6) = \\ln(2) + \\ln(10^6) = \\ln(2) + 6 \\ln(10) \\approx 0.6931 + 6 \\times 2.3026 = 14.5087$$\nSubstitute this value back into the expression for $x^{\\ast}$:\n$$x^{\\ast} \\approx \\frac{10^6}{2 \\times 14.5087} = \\frac{10^6}{29.0174} \\approx 34461.5 \\text{ base pairs}$$\nThe problem requires the answer to be rounded to one significant figure. The first significant figure is $3$. The next digit is $4$, so we round down.\n$$x^{\\ast} \\approx 30000 \\text{ base pairs}$$\nIn standard scientific notation, this is $3 \\times 10^4$ base pairs.", "answer": "$$\\boxed{3 \\times 10^{4}}$$", "id": "2822133"}, {"introduction": "Identifying a selective sweep from real genomic data is akin to forensic science; a single clue is rarely sufficient. This problem challenges you to synthesize multiple lines of evidence—including statistics based on the site frequency spectrum (Tajima’s $D$, Fay and Wu’s $H$) and patterns of linkage disequilibrium (EHH, iHS, $r^2$)—to build a robust case for selection [@problem_id:2822085]. Your task is to critically evaluate these signatures to distinguish a recent, hard selective sweep from confounding demographic events like population bottlenecks, a crucial skill in evolutionary genomics.", "problem": "A population-genomic scan in a panmictic diploid species identifies a focal $200$ kilobase region with markedly skewed site frequency spectrum. In a sample of $n=100$ chromosomes, the region shows Tajima’s $D=-2.3$ and Fay and Wu’s $H=-5.1$. You are told that the derived allele at a core single nucleotide polymorphism (SNP) near the center of the region is at frequency $f_{d}=0.90$. To evaluate whether the signal is more consistent with a recent hard selective sweep at or near the core SNP versus a population bottleneck, you collect auxiliary measures of linkage disequilibrium (LD) and haplotype structure. Linkage Disequilibrium (LD) is measured by the squared correlation $r^{2}$ between pairs of SNPs, Extended Haplotype Homozygosity (EHH) is the probability that two randomly chosen chromosomes carrying a specified core allele are identical by state for all markers until a given distance, and the integrated Haplotype Score (iHS) compares the decay of EHH on the derived versus the ancestral background. The recombination rate in this genomic region is approximately $1$ centimorgan per megabase and is similar to the genome-wide average.\n\nThe following observations are made for the focal region and for matched control regions across the genome:\n- In the focal region, conditioning on the derived core allele at frequency $f_{d}=0.90$, EHH remains above $0.60$ out to $\\approx 100$ kilobases on both sides of the core SNP, while conditioning on the ancestral core allele, EHH decays below $0.10$ within $\\approx 15$ kilobases.\n- The core SNP has an iHS of $-2.7$ (magnitude in the top $1\\%$ genome-wide), with the negative sign indicating more extended haplotype homozygosity on the derived background.\n- Pairwise LD measured by $r^{2}$ is elevated among SNPs on the left flank and among SNPs on the right flank of the core SNP (many pairs with $r^{2}>0.6$ at distances up to $80$ kilobases), but $r^{2}$ drops sharply across the core SNP itself (left–right pairs across the core site have $r^{2}<0.1$ at comparable distances).\n- Outside the focal region, genome-wide summaries show Tajima’s $D$ centered near $0$ with interquartile range approximately $[-0.4,0.2]$, Fay and Wu’s $H$ centered near $0$ with interquartile range approximately $[-0.5,0.3]$, and no enrichment of extreme iHS values; LD decay with distance elsewhere matches neutral expectations for the recombination map.\n\nStarting from fundamental definitions about how directional selection and demographic change affect the site frequency spectrum (SFS) and LD, decide which explanation is most consistent with all the observations and which LD feature is most diagnostic in distinguishing a recent hard sweep from a bottleneck in this dataset.\n\nChoose the single best option.\n\nA. A recent hard selective sweep centered near the core SNP; the most diagnostic LD feature is a single, unusually long, high-frequency derived haplotype with elevated EHH and high $r^{2}$ within flanks but a sharp drop in $r^{2}$ across the core site, localized to this region rather than genome-wide.\n\nB. A recent severe population bottleneck; the most diagnostic LD feature is an increase in long-range LD and extended haplotypes restricted to the derived allele at the core SNP, with iHS strongly negative but localized to one region.\n\nC. An ancient soft selective sweep from standing variation; the most diagnostic LD feature is multiple long, high-frequency haplotypes carrying the selected allele and approximately symmetric EHH decay for ancestral and derived core backgrounds.\n\nD. Background selection due to purifying selection on many linked deleterious sites; the most diagnostic LD feature is modestly reduced diversity with uniformly elevated LD across the region but without extreme iHS or allele-specific EHH asymmetry.", "solution": "The problem statement must first be validated for scientific soundness and logical consistency.\n\n**Step 1: Extract Givens**\n- Species: Panmictic diploid.\n- Focal region: $200$ kilobases (kb).\n- Sample size: $n=100$ chromosomes.\n- Site Frequency Spectrum (SFS) statistics for the focal region:\n    - Tajima’s $D = -2.3$.\n    - Fay and Wu’s $H = -5.1$.\n- Core SNP derived allele frequency: $f_{d}=0.90$.\n- Recombination rate: $\\approx 1 \\text{ cM/Mb}$.\n- Observations in the focal region:\n    - On the derived allele background ($f_{d}=0.90$), Extended Haplotype Homozygosity (EHH) remains above $0.60$ out to $\\approx 100$ kb.\n    - On the ancestral allele background, EHH decays below $0.10$ within $\\approx 15$ kb.\n    - The integrated Haplotype Score (iHS) for the core SNP is $-2.7$, with the negative sign indicating extended homozygosity on the derived background. This value is in the top $1\\%$ genome-wide.\n    - Pairwise Linkage Disequilibrium (LD), measured by $r^{2}$, is high ($r^{2}>0.6$) within the left and right flanks of the core SNP for distances up to $80$ kb.\n    - $r^{2}$ is low ($r^{2}<0.1$) for pairs of SNPs across the core site.\n- Observations in control regions (genome-wide):\n    - Tajima’s $D$ is centered near $0$ (interquartile range, IQR: $[-0.4, 0.2]$).\n    - Fay and Wu’s $H$ is centered near $0$ (IQR: $[-0.5, 0.3]$).\n    - No enrichment of extreme iHS values.\n    - LD decay matches neutral expectations.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined and scientifically grounded. All provided concepts—Tajima's $D$, Fay and Wu's $H$, EHH, iHS, LD ($r^2$), selective sweeps, and population bottlenecks—are standard in the field of population genetics. The numerical values are internally consistent and realistic for a scenario of strong, recent positive selection. For instance, a strong sweep is expected to produce a negative Tajima's $D$, a strongly negative Fay and Wu's $H$, and a specific signature of long-range haplotypes and LD, all of which are described. The contrast between the focal region and the genome-wide background is critical and correctly formulated to allow discrimination between locus-specific effects (selection) and genome-wide effects (demography). The problem is self-contained, objective, and well-posed.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. A rigorous analysis can proceed.\n\n**Derivation of Solution**\nThe task is to determine whether a recent hard selective sweep or a population bottleneck is more consistent with the provided data, and to identify the most diagnostic feature. We will analyze the evidence from first principles.\n\n1.  **Site Frequency Spectrum (SFS) Analysis**:\n    - Tajima's $D$ statistic compares two estimates of the population mutation parameter, $\\theta$: the average number of pairwise differences, $\\pi$, and the number of segregating sites, $S$. A negative $D$ (here, $D = -2.3$) indicates an excess of rare alleles compared to the standard neutral model. Both a recent selective sweep and a period of population growth following a bottleneck can produce negative Tajima's $D$. Therefore, this statistic is not sufficient on its own to distinguish between the two scenarios.\n    - Fay and Wu’s $H$ statistic compares $\\pi$ with an estimator based on the frequency of derived alleles. A strongly negative $H$ (here, $H = -5.1$) indicates a significant excess of high-frequency derived alleles. This is a classic signature of a selective sweep (hitchhiking), where a beneficial derived allele rises rapidly in frequency, dragging linked neutral derived alleles with it. A simple population bottleneck does not produce such a strong excess of high-frequency *derived* alleles in a specific genomic region. This statistic strongly favors selection over a bottleneck.\n\n2.  **Haplotype and Linkage Disequilibrium (LD) Analysis**:\n    The most decisive evidence comes from the haplotype structure and LD patterns, which differ fundamentally between a sweep and a bottleneck.\n    - **Bottleneck Effects**: A population bottleneck is a demographic event that affects the entire genome. It would cause a genome-wide increase in LD, a general reduction in diversity, and a shift in the entire SFS. The observation that control regions across the genome show neutral patterns (Tajima's $D \\approx 0$, $H \\approx 0$, normal LD decay) definitively rules out a recent, severe genome-wide bottleneck as the primary explanation for the signal in the focal region.\n    - **Selective Sweep Effects**: A selective sweep is a locus-specific event. A beneficial mutation arises on a particular chromosome (a single haplotype background). As this mutation sweeps to high frequency, the entire haplotype on which it resides hitchhikes with it. This process has several predictable consequences:\n        - **Extended Haplotype Homozygosity (EHH)**: The sweeping haplotype has not had time for recombination to break it down. Thus, it will be long and common. Haplotypes carrying the ancestral allele are older and have been subject to recombination for a longer time, so they are more diverse and shorter. The data show precisely this asymmetry: EHH on the high-frequency ($f_d=0.90$) derived allele background is high ($>0.60$) and extends far ($\\approx 100$ kb), while EHH on the ancestral background decays rapidly ($<0.10$ within $15$ kb).\n        - **Integrated Haplotype Score (iHS)**: The iHS statistic is designed specifically to detect such asymmetry. The observed large-magnitude negative value (iHS $= -2.7$) formally quantifies that the derived allele is associated with an unusually long haplotype, providing strong evidence for recent positive selection. The fact that this value is in the top $1\\%$ genome-wide confirms the signal is exceptional.\n        - **Pattern of LD ($r^{2}$)**: During a sweep, the hitchhiking effect creates strong LD (high $r^{2}$) among markers linked on the sweeping haplotype. This explains the high $r^{2}$ observed within the left and right flanks. However, recombination events that do occur during the sweep tend to happen between the sweeping haplotype and the diverse ancestral haplotypes. This shuffles the association between markers on opposite sides of the selected site, causing a characteristic breakdown of LD *across* the selected site. The observation of high $r^{2}$ within flanks but a sharp drop across the core SNP is a key diagnostic feature of a sweep, distinguishing it from demographic effects, which tend to increase LD more uniformly.\n\n3.  **Distinguishing Sweep Types**:\n    - **Hard vs. Soft Sweep**: The presence of a single, long, high-frequency haplotype is the classic signature of a \"hard sweep,\" where selection acts on a new mutation. A \"soft sweep\" from standing variation (where the allele was already present on multiple haplotype backgrounds) would result in several distinct haplotypes carrying the selected allele, leading to a weaker and more complex EHH/iHS signal. The data are most consistent with a hard sweep.\n    - **Recent vs. Ancient Sweep**: The great length of the haplotype ($\\approx 100$ kb) indicates the sweep was recent. Over time, recombination (at a rate of $1 \\text{ cM/Mb}$, or $10^{-5}$ per kb per generation) would break down this long-range association.\n\n**Conclusion**: All lines of evidence—particularly the localized nature of the signal and the specific patterns of allele-specific EHH, extreme iHS, and LD structure—point to a recent, hard selective sweep at the focal locus. A bottleneck is decisively ruled out by the genome-wide control data. The most diagnostic feature is the combination of haplotype and LD patterns that are unique to a recent sweep.\n\n**Evaluation of Options**\n\n**A. A recent hard selective sweep centered near the core SNP; the most diagnostic LD feature is a single, unusually long, high-frequency derived haplotype with elevated EHH and high $r^{2}$ within flanks but a sharp drop in $r^{2}$ across the core site, localized to this region rather than genome-wide.**\n- This option correctly identifies the evolutionary scenario as a recent hard selective sweep. It also correctly identifies the most diagnostic feature: the specific combination of a long, high-frequency derived haplotype (evidenced by EHH and iHS) and the unique LD pattern ($r^{2}$ high within flanks but low across the core). This entire signature is localized, distinguishing it from genome-wide demographic events. This statement is fully consistent with our derivation.\n- **Verdict: Correct.**\n\n**B. A recent severe population bottleneck; the most diagnostic LD feature is an increase in long-range LD and extended haplotypes restricted to the derived allele at the core SNP, with iHS strongly negative but localized to one region.**\n- This option incorrectly proposes a bottleneck. A bottleneck is a genome-wide phenomenon. The description of the \"diagnostic feature\" as being \"localized to one region\" and \"restricted to the derived allele\" contradicts the fundamental nature of a bottleneck. The explanation is internally inconsistent and refuted by the control region data.\n- **Verdict: Incorrect.**\n\n**C. An ancient soft selective sweep from standing variation; the most diagnostic LD feature is multiple long, high-frequency haplotypes carrying the selected allele and approximately symmetric EHH decay for ancestral and derived core backgrounds.**\n- This option is incorrect on multiple counts. The sweep is recent, not ancient, given the long haplotype. It is a hard sweep, not a soft sweep, given the single dominant haplotype signature. The diagnostic feature described (multiple haplotypes, symmetric EHH) is characteristic of a soft sweep but is directly contradicted by the problem's data (asymmetric EHH, strong iHS).\n- **Verdict: Incorrect.**\n\n**D. Background selection due to purifying selection on many linked deleterious sites; the most diagnostic LD feature is modestly reduced diversity with uniformly elevated LD across the region but without extreme iHS or allele-specific EHH asymmetry.**\n- This option incorrectly proposes background selection (BGS). BGS is a steady-state process that cannot produce the signatures of a rapid, recent event, such as an extremely negative Fay and Wu's $H$ or the highly asymmetric haplotype structure (extreme iHS). The diagnostic features described for BGS in this option are the opposite of what is observed in the data.\n- **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2822085"}, {"introduction": "Beyond simply detecting a sweep, a primary goal of population genetics is to quantify the evolutionary forces at play. This advanced exercise guides you through a complete computational workflow to infer the strength of selection ($s$) and the precise location of the selected site by modeling the characteristic \"trough\" in genetic diversity left by a sweep [@problem_id:2822053]. You will derive the mathematical form of this diversity reduction, simulate noisy genomic data, and apply nonlinear least squares fitting to estimate the parameters, providing a practical introduction to modern statistical inference in population genomics.", "problem": "You are asked to write a complete, runnable program that simulates and analyzes the hitchhiking effect caused by a hard selective sweep along a linear genome. The program must be self-contained and produce one single-line output as specified. The goal is to infer the selection coefficient and the selected site position by fitting a parametric trough model of the reduction in neutral diversity due to a recent hard selective sweep, and to quantify uncertainty using confidence intervals.\n\nFoundational base to use:\n- In a hard selective sweep, a strongly beneficial allele with selection coefficient $s$ rises in frequency and fixes. Under deterministic logistic growth, an approximation for the sweep duration (time that the allele rises from rare to near fixation) is\n$$\nT(s) \\approx \\frac{\\ln(2 N_e s)}{s},\n$$\nwhere $N_e$ is the effective population size. This approximation assumes $2 N_e s \\gg 1$.\n- Recombination between a neutral locus at genomic distance $d$ (in base pairs) from the selected site and the selected background occurs at rate $r = r_{\\mathrm{bp}} d$ per generation, where $r_{\\mathrm{bp}}$ is the per-base recombination rate per generation.\n- Pairwise neutral diversity is proportional to the expected pairwise coalescence time. In a recent hard sweep, diversity is reduced near the selected site because lineages that fail to recombine off the selected background coalesce rapidly. The normalized expected pairwise diversity at distance $d$ can be expressed in terms of the probability that at least one of two lineages recombines off the selected background during the sweep. You must derive a closed-form expression for the expected normalized diversity as a function of $d$, $s$, $N_e$, and $r_{\\mathrm{bp}}$ based on these principles.\n\nData-generation protocol:\n- Consider a linear genome of length $L$ measured in base pairs. Let the selected site be at position $x^\\star$ (in base pairs).\n- Define window centers at equally spaced positions $x_i$ across $[0, L]$, inclusive. Use exactly $101$ windows (that is, the step size is $L/100$ base pairs).\n- For each window, compute $d_i = |x_i - x^\\star|$ (in base pairs).\n- Let the expected normalized diversity at $x_i$ be given by the trough model you derived from the foundational base above. Denote this expectation by $m_i$; it is dimensionless and takes values in $[0,1]$.\n- Simulate observed normalized diversity as $y_i = \\min\\{\\max\\{m_i + \\varepsilon_i, 0\\}, 1\\}$ where the $\\varepsilon_i$ are independent and identically distributed Gaussian random variables with mean $0$ and standard deviation $\\sigma$. Use a fixed random seed of $42$ to ensure reproducibility.\n\nEstimation task:\n- Using the simulated data $\\{(x_i, y_i)\\}_{i=1}^{101}$, fit the parametric trough model by nonlinear least squares to estimate the selection coefficient $\\hat{s}$ and the selected site position $\\hat{x}^\\star$.\n- Treat $N_e$ and $r_{\\mathrm{bp}}$ as known constants. You may assume that the baseline (far-from-sweep) normalized diversity is $1$, so the model is specified entirely by the pair $\\theta = (s, x^\\star)$ along with the fixed $N_e$ and $r_{\\mathrm{bp}}$.\n- Use bounded optimization with constraints $s \\in [10^{-6}, 1]$ and $x^\\star \\in [0, L]$.\n- Use the following initialization rule: initial $s$ guess $s_0 = 0.01$, and initial $x^\\star$ guess equal to the window position with the minimum observed $y_i$.\n- Compute two-sided confidence intervals at confidence level $0.95$ for both parameters based on the asymptotic covariance of nonlinear least squares. If $r(\\theta)$ denotes the vector of residuals and $J(\\hat{\\theta})$ the Jacobian matrix of $r$ evaluated at the optimum, approximate the residual variance by\n$$\n\\hat{\\sigma}^2_{\\mathrm{res}} = \\frac{\\sum_{i=1}^{101} r_i(\\hat{\\theta})^2}{101 - 2},\n$$\nand approximate the parameter covariance matrix by\n$$\n\\widehat{\\mathrm{Cov}}(\\hat{\\theta}) \\approx \\hat{\\sigma}^2_{\\mathrm{res}} \\left(J(\\hat{\\theta})^\\top J(\\hat{\\theta})\\right)^{-1}.\n$$\nConstruct marginal intervals using the normal approximation with standard errors equal to the square roots of the diagonal entries. If needed, clip the interval endpoints to the parameter bounds.\n\nTest suite:\nYour program must implement the simulation and estimation for each of the following three parameter sets. In every case, positions must be expressed in base pairs, distances in base pairs, and the selection coefficient is dimensionless.\n\n- Case A (happy path): $L = 10^6$, $N_e = 10^4$, $r_{\\mathrm{bp}} = 10^{-8}$, true $s = 0.02$, true $x^\\star = 500{,}000$, noise standard deviation $\\sigma = 0.03$.\n- Case B (moderate effect, off-center): $L = 10^6$, $N_e = 10^4$, $r_{\\mathrm{bp}} = 10^{-8}$, true $s = 0.01$, true $x^\\star = 300{,}000$, noise standard deviation $\\sigma = 0.03$.\n- Case C (stronger selection, lower recombination, near end): $L = 10^6$, $N_e = 10^4$, $r_{\\mathrm{bp}} = 5 \\times 10^{-9}$, true $s = 0.05$, true $x^\\star = 800{,}000$, noise standard deviation $\\sigma = 0.02$.\n\nNumerical output and formatting:\n- For each case, report a list of six values: $[\\hat{s}, \\hat{x}^\\star, s_{\\mathrm{lo}}, s_{\\mathrm{hi}}, x^\\star_{\\mathrm{lo}}, x^\\star_{\\mathrm{hi}}]$, where the subscripts “lo” and “hi” denote the lower and upper endpoints of the confidence interval at confidence level $0.95$.\n- Round $\\hat{s}$, $s_{\\mathrm{lo}}$, and $s_{\\mathrm{hi}}$ to six decimal places (dimensionless). Round $\\hat{x}^\\star$, $x^\\star_{\\mathrm{lo}}$, and $x^\\star_{\\mathrm{hi}}$ to the nearest base pair (as integers).\n- The final output must be a single line containing a list of these three case-wise lists, with no additional text. For example, a syntactically valid line has the form\n$$\n[\\,[a_1,a_2,a_3,a_4,a_5,a_6],[b_1,b_2,b_3,b_4,b_5,b_6],[c_1,c_2,c_3,c_4,c_5,c_6]\\,],\n$$\nwhere each $a_i$, $b_i$, and $c_i$ is a number.\n\nScientific realism:\n- Ensure all computations are consistent with the foundational base. All simulated positions are in base pairs, all distances are in base pairs, the recombination rate is per base per generation, and the selection coefficient is dimensionless.\n\nYour program must not require any user input and must not access any external resources. It should deterministically generate the data using the fixed random seed $42$ and produce the single-line output in the exact format described above.", "solution": "The problem as stated is subjected to validation.\n\n**Step 1: Extract Givens**\n- **Model Framework**: Hard selective sweep, deterministic logistic growth approximation for a beneficial allele with selection coefficient $s$.\n- **Sweep Duration**: $T(s) \\approx \\frac{\\ln(2 N_e s)}{s}$, where $N_e$ is the effective population size. Valid for $2 N_e s \\gg 1$.\n- **Recombination**: Rate $r = r_{\\text{bp}} d$ per generation for a neutral locus at distance $d$ (base pairs) from the selected site. $r_{\\text{bp}}$ is the per-base-pair, per-generation recombination rate.\n- **Diversity Model**: Normalized expected pairwise diversity at distance $d$ is derived from the probability that at least one of two lineages recombines off the selected background during the sweep.\n- **Simulation setup**:\n    - Genome length $L$. Selected site $x^\\star$.\n    - $101$ equally spaced window centers $x_i$ on $[0, L]$.\n    - Expected normalized diversity at $x_i$: $m_i$, a function of $d_i = |x_i - x^\\star|$.\n    - Observed normalized diversity: $y_i = \\min\\{\\max\\{m_i + \\varepsilon_i, 0\\}, 1\\}$, with $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$ i.i.d.\n    - Random seed: $42$.\n- **Estimation task**:\n    - Estimate $\\theta = (s, x^\\star)$ via nonlinear least squares. $N_e, r_{\\text{bp}}$ are known constants.\n    - Parameter bounds: $s \\in [10^{-6}, 1]$, $x^\\star \\in [0, L]$.\n    - Initial guess: $s_0 = 0.01$, $x^\\star_0 = x_k$ where $y_k$ is the minimum observed diversity.\n    - Confidence intervals: $95\\%$ confidence level, based on asymptotic theory for NLS.\n        - Residual variance: $\\hat{\\sigma}^2_{\\text{res}} = \\frac{\\sum r_i(\\hat{\\theta})^2}{101 - 2}$.\n        - Covariance matrix: $\\widehat{\\mathrm{Cov}}(\\hat{\\theta}) \\approx \\hat{\\sigma}^2_{\\text{res}} (J(\\hat{\\theta})^\\top J(\\hat{\\theta}))^{-1}$.\n        - $J(\\hat{\\theta})$ is the Jacobian of the residuals at the estimate $\\hat{\\theta}$.\n- **Test Cases**:\n    - Case A: $L = 10^6$, $N_e = 10^4$, $r_{\\text{bp}} = 10^{-8}$, $s = 0.02$, $x^\\star = 500,000$, $\\sigma = 0.03$.\n    - Case B: $L = 10^6$, $N_e = 10^4$, $r_{\\text{bp}} = 10^{-8}$, $s = 0.01$, $x^\\star = 300,000$, $\\sigma = 0.03$.\n    - Case C: $L = 10^6$, $N_e = 10^4$, $r_{\\text{bp}} = 5 \\times 10^{-9}$, $s = 0.05$, $x^\\star = 800,000$, $\\sigma = 0.02$.\n- **Output Format**: A single-line list of lists containing $[\\hat{s}, \\hat{x}^\\star, s_{\\mathrm{lo}}, s_{\\mathrm{hi}}, x^\\star_{\\mathrm{lo}}, x^\\star_{\\mathrm{hi}}]$ for each case, with specified rounding.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is founded on the established theory of selective sweeps in population genetics. The model components, such as logistic growth, recombination, and coalescence, are standard. The provided sweep duration formula is a classic approximation. The parameter values are biologically plausible. The condition $2N_e s \\gg 1$ holds for all test cases, validating the use of the sweep duration formula.\n- **Well-Posedness**: The problem is well-posed. It details a complete procedure for data simulation and parameter estimation. The goal is clear, and the method specified (nonlinear least squares with confidence interval estimation) is a standard statistical approach for such problems.\n- **Objectivity**: The problem is expressed in precise, objective, and mathematical language. There are no subjective or ambiguous statements.\n- **Completeness**: All necessary parameters, constants, and procedural steps are provided. No information is missing. The problem is self-contained.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and complete. It represents a valid and non-trivial computational problem in statistical genetics. Therefore, a solution will be provided.\n\n**Solution Derivation and Implementation Strategy**\n\n**1. Derivation of the Diversity Trough Model**\n\nThe problem requires deriving an expression for the normalized expected pairwise diversity, $\\pi/\\pi_0$, at a neutral site. This quantity is equivalent to the probability that two lineages sampled from that site do not coalesce during the selective sweep. Coalescence during the sweep is avoided if at least one of the two lineages recombines onto the ancestral genetic background (the one without the beneficial allele) before the sweep completes.\n\nLet $r$ be the recombination rate per generation between the neutral locus and the selected site. The duration of the sweep is approximately $T(s) \\approx \\frac{\\ln(2 N_e s)}{s}$ generations.\n\nAssuming recombination is a Poisson process, the probability that a single lineage fails to recombine away from the selected background during the sweep of duration $T(s)$ is given by:\n$$ P(\\text{single lineage does not escape}) = e^{-r T(s)} $$\n\nWe consider two lineages. Assuming their recombination events are independent, the probability that *neither* lineage escapes the sweep is:\n$$ P(\\text{both lineages do not escape}) = (e^{-r T(s)})^2 = e^{-2rT(s)} $$\n\nIf both lineages fail to escape, they are trapped on the sweeping background and are forced to coalesce. The expected normalized diversity, which we denote $m$, is the complement of this probability, i.e., the probability that at least one lineage escapes:\n$$ m = P(\\text{at least one lineage escapes}) = 1 - P(\\text{both lineages do not escape}) = 1 - e^{-2rT(s)} $$\n\nSubstituting the given expressions for $r = r_{\\text{bp}} d$ and $T(s)$:\n$$ m(d; s, N_e, r_{\\text{bp}}) = 1 - \\exp\\left(-2 (r_{\\text{bp}} d) \\frac{\\ln(2 N_e s)}{s}\\right) $$\nwhere $d = |x - x^\\star|$ is the distance in base pairs from the observation point $x$ to the selected site $x^\\star$.\n\nThis is the parametric model to be fitted to the data. The parameters to be estimated are $\\theta = (s, x^\\star)$.\n\n**2. Simulation and Estimation Procedure**\n\nThe implementation will follow the problem specification precisely.\n\n- **Data Simulation**: For each test case, we first generate the \"true\" diversity landscape. We define $101$ window centers $x_i$ over the genomic interval $[0, L]$. For each $x_i$, we calculate the distance $d_i = |x_i - x^\\star_{\\text{true}}|$ to the true selected site and compute the expected normalized diversity $m_i$ using the derived model with the true parameters. Gaussian noise $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$ is added to $m_i$, and the result is clipped to the interval $[0, 1]$ to yield the simulated observation $y_i$. A single random seed of $42$ ensures the entire process is deterministic.\n\n- **Parameter Estimation**: We use nonlinear least squares to fit the model $f(x; s, x^\\star) = m(|x - x^\\star|; s, N_e, r_{\\text{bp}})$ to the simulated data points $(x_i, y_i)$. The `scipy.optimize.least_squares` function is suitable for this task. It minimizes the sum of squared residuals, $SSR = \\sum_{i=1}^{101} [y_i - f(x_i; s, x^\\star)]^2$. The optimization is performed subject to the bounds $s \\in [10^{-6}, 1]$ and $x^\\star \\in [0, L]$. The initial guess for $s$ is fixed at $s_0 = 0.01$, and for $x^\\star$ it is the coordinate of the window with the lowest observed diversity, $x^\\star_0 = x_k$ such that $y_k = \\min(y_i)$.\n\n- **Confidence Interval Calculation**: The asymptotic covariance matrix of the least-squares estimates $\\hat{\\theta} = (\\hat{s}, \\hat{x}^\\star)$ is given by $\\widehat{\\mathrm{Cov}}(\\hat{\\theta}) \\approx \\hat{\\sigma}^2_{\\mathrm{res}} (J^\\top J)^{-1}$.\n    - The residual variance, $\\hat{\\sigma}^2_{\\mathrm{res}}$, is estimated from the sum of squared residuals at the optimum, divided by the degrees of freedom ($n-p$), where $n=101$ is the number of data points and $p=2$ is the number of parameters: $\\hat{\\sigma}^2_{\\mathrm{res}} = \\frac{SSR}{101-2}$.\n    - The Jacobian matrix $J$ of the residuals with respect to the parameters, evaluated at the optimum $\\hat{\\theta}$, is numerically computed and provided by `scipy.optimize.least_squares`.\n    - The standard errors for $\\hat{s}$ and $\\hat{x}^\\star$ are the square roots of the diagonal elements of this covariance matrix.\n    - Two-sided $95\\%$ confidence intervals are constructed using the normal approximation: $[\\hat{\\theta}_j - z_{0.975} \\cdot SE(\\hat{\\theta}_j), \\hat{\\theta}_j + z_{0.975} \\cdot SE(\\hat{\\theta}_j)]$, where $z_{0.975} \\approx 1.96$ is the critical value from the standard normal distribution.\n    - Finally, the computed interval endpoints are clipped to the allowed parameter ranges.\n\n- **Output Formatting**: The results for each test case—the point estimates $(\\hat{s}, \\hat{x}^\\star)$ and the lower and upper bounds of their confidence intervals—are collected. The values for $s$ are rounded to six decimal places, and the values for $x^\\star$ are rounded to the nearest integer. The final output is structured as a single-line string representing a list of lists.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\nfrom scipy.stats import norm\n\n#\n# Professor's Note: The following program implements the complete simulation and\n# estimation pipeline as specified. It first derives the theoretical model for\n# the reduction in genetic diversity, then simulates noisy data according to\n# this model, and finally fits the model to infer the underlying parameters\n# and their uncertainty. The methodology is standard in the field of\n# statistical population genetics.\n#\n\ndef run_case(L, Ne, r_bp, s_true, x_star_true, sigma, num_windows=101):\n    \"\"\"\n    Simulates and analyzes a single selective sweep scenario.\n    \n    Args:\n        L (float): Genome length in base pairs.\n        Ne (float): Effective population size.\n        r_bp (float): Per-base recombination rate per generation.\n        s_true (float): True selection coefficient (dimensionless).\n        x_star_true (float): True position of the selected site in base pairs.\n        sigma (float): Standard deviation of the Gaussian noise.\n        num_windows (int): Number of windows to sample across the genome.\n\n    Returns:\n        list: A list of six numbers:\n              [s_hat, x_star_hat, s_lo, s_hi, x_star_lo, x_star_hi]\n              representing the estimates and their 95% confidence intervals.\n    \"\"\"\n    # Define window coordinates\n    x_coords = np.linspace(0, L, num_windows)\n\n    # --- 1. Data Generation ---\n    # The term combining constants and the true parameter s\n    alpha_true = (2 * r_bp * np.log(2 * Ne * s_true)) / s_true\n    d_true = np.abs(x_coords - x_star_true)\n    \n    # Expected normalized diversity based on the derived model\n    m_expected = 1 - np.exp(-alpha_true * d_true)\n    \n    # Generate observed diversity with Gaussian noise, clipped to [0, 1]\n    noise = np.random.normal(0, sigma, num_windows)\n    y_observed = np.clip(m_expected + noise, 0, 1)\n\n    # --- 2. Parameter Estimation ---\n    \n    # Parametric model function for the fitter\n    def model(params, x, Ne_const, r_bp_const):\n        s, x_star = params\n        # The term 2*Ne*s must be > 1 for the log to be positive.\n        # But for numerical stability with small s, handle edge cases.\n        if (2 * Ne_const * s) = 1:\n            # This corresponds to a very weak sweep, so no diversity reduction.\n            alpha = 1e-9 # Effectively produces diversity of 1 everywhere.\n        else:\n            alpha = (2 * r_bp_const * np.log(2 * Ne_const * s)) / s\n        \n        d = np.abs(x - x_star)\n        return 1 - np.exp(-alpha * d)\n\n    # Residuals function for least_squares\n    def residuals(params, x, y, Ne_const, r_bp_const):\n        return model(params, x, Ne_const, r_bp_const) - y\n\n    # Initial guesses as per problem statement\n    s0 = 0.01\n    x_star0 = x_coords[np.argmin(y_observed)]\n\n    # Parameter bounds\n    bounds = ([1e-6, 0.0], [1.0, L])\n\n    # Perform nonlinear least squares fitting\n    res_lsq = least_squares(\n        residuals,\n        x0=[s0, x_star0],\n        args=(x_coords, y_observed, Ne, r_bp),\n        bounds=bounds,\n        method='trf'\n    )\n    s_hat, x_star_hat = res_lsq.x\n\n    # --- 3. Confidence Interval Calculation ---\n    \n    # Jacobian of residuals evaluated at the solution\n    J = res_lsq.jac\n    \n    n_pts = len(y_observed)\n    n_params = len(res_lsq.x)\n\n    # Estimate of residual variance\n    sum_sq_res = np.sum(res_lsq.fun**2)\n    sigma2_res = sum_sq_res / (n_pts - n_params)\n\n    # Asymptotic covariance matrix\n    try:\n        cov_matrix = sigma2_res * np.linalg.inv(J.T @ J)\n        # Standard errors are sqrt of diagonal elements\n        se = np.sqrt(np.diag(cov_matrix))\n        se_s, se_x_star = se\n\n        # Z-score for 95% confidence\n        z_score = norm.ppf(0.975)\n\n        # Calculate interval endpoints\n        s_lo = s_hat - z_score * se_s\n        s_hi = s_hat + z_score * se_s\n        x_star_lo = x_star_hat - z_score * se_x_star\n        x_star_hi = x_star_hat + z_score * se_x_star\n\n    except np.linalg.LinAlgError:\n        # If matrix is singular, CIs cannot be computed.\n        s_lo, s_hi, x_star_lo, x_star_hi = (np.nan, np.nan, np.nan, np.nan)\n\n    # Clip interval endpoints to parameter bounds\n    s_lo = max(s_lo, bounds[0][0])\n    s_hi = min(s_hi, bounds[1][0])\n    x_star_lo = max(x_star_lo, bounds[0][1])\n    x_star_hi = min(x_star_hi, bounds[1][1])\n\n    # --- 4. Formatting Output ---\n    # Round according to problem specification\n    s_hat_f = round(s_hat, 6)\n    s_lo_f = round(s_lo, 6)\n    s_hi_f = round(s_hi, 6)\n    \n    x_star_hat_f = int(round(x_star_hat))\n    x_star_lo_f = int(round(x_star_lo))\n    x_star_hi_f = int(round(x_star_hi))\n    \n    return [s_hat_f, x_star_hat_f, s_lo_f, s_hi_f, x_star_lo_f, x_star_hi_f]\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Set a single random seed for reproducibility of the entire process\n    np.random.seed(42)\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case A: L, Ne, r_bp, s, x_star, sigma\n        (1e6, 1e4, 1e-8, 0.02, 500000.0, 0.03),\n        # Case B\n        (1e6, 1e4, 1e-8, 0.01, 300000.0, 0.03),\n        # Case C\n        (1e6, 1e4, 5e-9, 0.05, 800000.0, 0.02),\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        result = run_case(*case_params)\n        all_results.append(result)\n\n    # Format the final output string exactly as required,\n    # producing a list of lists representation without spaces.\n    inner_strings = [f\"[{','.join(map(str, res_list))}]\" for res_list in all_results]\n    final_output_str = f\"[{','.join(inner_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```", "id": "2822053"}]}