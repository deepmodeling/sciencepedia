{"hands_on_practices": [{"introduction": "This first practice establishes the fundamental workflow for analyzing a three-point testcross. By working through this classic scenario [@problem_id:2814423], you will solidify your understanding of how to identify parental, single crossover, and double crossover classes from progeny counts. This methodical approach is the key to determining the correct gene order and calculating map distances, providing the essential foundation for all linkage analysis.", "problem": "An autosomal three-point testcross is performed in Drosophila melanogaster. A heterozygous female with coupling-phase haplotypes *ABC/abc* is crossed to a triple-recessive tester *abc/abc*. You are given the following observed progeny classes, recorded as the haplotype of the gamete contributed by the heterozygous female and the corresponding counts out of a total of $1000$ progeny:\n\n- *ABC*: $380$\n- *abc*: $372$\n- *aBC*: $84$\n- *Abc*: $76$\n- *ABc*: $40$\n- *abC*: $36$\n- *AbC*: $5$\n- *aBc*: $7$\n\nTwo candidate gene orders have been proposed: A-B-C and A-C-B.\n\nUsing only foundational principles for linkage analysis in three-point testcrosses—namely, that progeny class categories reflect the gametes produced by the heterozygous parent; that the most frequent classes are the parental (nonrecombinant) types; that double crossover (DCO) classes are the least frequent; and that in a true three-point cross the DCO haplotypes differ from the parental haplotypes only at the middle locus—perform the following:\n\n- Identify the parental and the double crossover classes based on the above principles.\n- Use the defining property of DCOs to decide which of the two proposed gene orders is correct by determining which locus must be in the middle.\n- With the correct order in hand, classify single crossover (SCO) and DCO classes by interval, compute the recombination fractions for the two adjacent intervals, and from first principles compute the expected number of DCOs under independence of crossovers.\n- Define the coefficient of coincidence as the ratio of observed to expected DCOs, and define interference as one minus the coefficient of coincidence. Then compute the interference.\n\nReport only the final interference as a decimal fraction. Round your answer to four significant figures. Do not use a percent sign in your answer.", "solution": "The problem as stated is subjected to rigorous validation before any attempt at a solution is made.\n\nThe givens are extracted verbatim as follows:\n- A heterozygous female of genotype *ABC/abc*.\n- A tester male of genotype *abc/abc*.\n- A total progeny count of $N = 1000$.\n- Observed progeny F1 gamete classes and counts:\n    - *ABC*: $380$\n    - *abc*: $372$\n    - *aBC*: $84$\n    - *Abc*: $76$\n    - *ABc*: $40$\n    - *abC*: $36$\n    - *AbC*: $5$\n    - *aBc*: $7$\n- Two candidate gene orders: A-B-C and A-C-B.\n- Foundational principles for analysis are explicitly provided.\n- Required calculations include identification of parental and double crossover (DCO) classes, determination of the correct gene order, calculation of recombination fractions, expected DCOs, coefficient of coincidence, and interference.\n- The final answer must be the interference value, rounded to four significant figures.\n\nThe problem is scientifically grounded in the principles of Mendelian genetics and linkage analysis as developed by Alfred Sturtevant. It is well-posed, with a complete and consistent dataset; the sum of observed progeny is $380 + 372 + 84 + 76 + 40 + 36 + 5 + 7 = 1000$, which matches the stated total $N$. The problem is objective and formalizable. Therefore, the problem is deemed valid and a solution will be furnished.\n\nThe solution proceeds by adhering to the steps outlined in the problem statement.\n\nFirst, we identify the parental and double crossover (DCO) progeny classes. According to the foundational principles of linkage, the parental classes are the most frequent, and the DCO classes are the least frequent.\n- The most numerous progeny classes are *ABC* (with count $380$) and *abc* (with count $372$). These are the parental, or nonrecombinant, classes. Their total is $380 + 372 = 752$. This is consistent with the initial information that the female parent has the genotype *ABC/abc*.\n- The least numerous progeny classes are *AbC* (with count $5$) and *aBc* (with count $7$). These are the DCO classes. Their total is $5 + 7 = 12$.\n\nSecond, we determine the correct gene order. The defining characteristic of a DCO is that the resulting haplotype differs from the parental haplotypes only at the middle locus. We compare a parental haplotype with a DCO haplotype to identify which gene is in the middle. Let us compare the parental haplotype *ABC* with the DCO haplotype *AbC*. The alleles for the flanking loci A and C remain the same, while the allele for the middle locus is swapped (*B* $\\to$ *b*). To confirm, let us compare the other parental haplotype *abc* with the other DCO haplotype *aBc*. Again, the allele for locus B is swapped (*b* $\\to$ *B*), while A and C are not. This establishes unequivocally that the gene B is located between genes A and C. Therefore, the correct gene order is A-B-C.\n\nThird, with the correct gene order A-B-C established, we can classify the remaining progeny classes and calculate recombination frequencies for the two intervals, which are region I (A-B) and region II (B-C).\n\n- Single Crossover (SCO) in Region I (A-B): A crossover event between A and B would produce gametes of haplotype *Abc* and *aBC*. The observed counts for these classes are $76$ and $84$, respectively. The total number of SCOs in region I is $76 + 84 = 160$.\n- Single Crossover (SCO) in Region II (B-C): A crossover event between B and C would produce gametes of haplotype *ABc* and *abC*. The observed counts for these classes are $40$ and $36$, respectively. The total number of SCOs in region II is $40 + 36 = 76$.\n\nThe recombination frequency for a given interval is the ratio of the total number of recombinant progeny for that interval to the total number of progeny. Recombinant progeny for an interval include the single crossovers in that interval as well as all double crossovers, as a DCO involves a crossover in both intervals.\n\n- Recombination frequency for Region I (A-B), denoted $R_{A-B}$:\n$$R_{A-B} = \\frac{(\\text{SCO in I}) + (\\text{DCO})}{N} = \\frac{160 + 12}{1000} = \\frac{172}{1000} = 0.172$$\n\n- Recombination frequency for Region II (B-C), denoted $R_{B-C}$:\n$$R_{B-C} = \\frac{(\\text{SCO in II}) + (\\text{DCO})}{N} = \\frac{76 + 12}{1000} = \\frac{88}{1000} = 0.088$$\n\nFourth, we compute the expected number of DCOs and the interference. If crossover events in the two regions were independent, the expected frequency of DCOs would be the product of the individual recombination frequencies for each region.\n\n- Expected frequency of DCOs = $R_{A-B} \\times R_{B-C} = 0.172 \\times 0.088 = 0.015136$.\n- Expected number of DCOs = (Expected frequency) $\\times N = 0.015136 \\times 1000 = 15.136$.\n\nThe coefficient of coincidence, $C$, is defined as the ratio of the observed number of DCOs to the expected number of DCOs.\n$$C = \\frac{\\text{Observed DCOs}}{\\text{Expected DCOs}} = \\frac{12}{15.136}$$\n\nInterference, $I$, measures the degree to which a crossover in one region affects the probability of a crossover in an adjacent region. It is defined as $I = 1 - C$.\n$$I = 1 - C = 1 - \\frac{12}{15.136} \\approx 1 - 0.7928052... \\approx 0.2071947...$$\n\nThe problem requires the final answer to be rounded to four significant figures.\n$$I \\approx 0.2072$$\nThis positive interference value indicates that a crossover in one region reduces the likelihood of a simultaneous crossover in the adjacent region, which is a common biological phenomenon.", "answer": "$$\\boxed{0.2072}$$", "id": "2814423"}, {"introduction": "Real experimental data does not always yield a clear-cut answer, and simple heuristics can fail when certain progeny classes are absent. This exercise [@problem_id:2814417] introduces a more rigorous, statistical method for resolving ambiguity in gene order. You will use a likelihood-based framework to formally compare two competing models, demonstrating how to make a quantitative, data-driven decision rather than relying on visual inspection alone.", "problem": "A diploid individual heterozygous at three linked loci $A$, $B$, and $C$ in coupling phase, *ABC/abc*, is testcrossed to a triple-recessive *abc/abc*. The $8$ testcross progeny classes and observed counts are:\n- *ABC*: $410$\n- *abc*: $390$\n- *Abc*: $90$\n- *aBC*: $92$\n- *ABc*: $0$\n- *abC*: $0$\n- *AbC*: $45$\n- *aBc*: $43$\n\nClassical double-crossover (DCO) logic for gene-order determination is ambiguous here because the two smallest classes are absent (both have count $0$). Instead, construct a likelihood-based comparison of the two candidate linear gene orders A–B–C and A–C–B using all class counts.\n\nAssume the following foundational model:\n- Recombination in the two adjacent intervals occurs independently (no interference) and multiple crossovers within the same interval are negligible at these distances.\n- Reciprocal products occur with equal frequency (no chromatid interference).\n- Given an assumed order, let $r_1$ be the recombination fraction in the left interval and $r_2$ in the right interval. Under this model, the $8$ classes form a multinomial sample with category probabilities determined by $r_1$ and $r_2$.\n\nTasks:\n1. For a given order, express the multinomial likelihood $L(r_1,r_2)$ in terms of the totals over the four genetic categories: nonrecombinant (NR), single crossover in the left interval (SCO$_1$), single crossover in the right interval (SCO$_2$), and double crossover (DCO).\n2. For each candidate order A–B–C and A–C–B, map the $8$ observed classes to these four categories, maximize $L(r_1,r_2)$ over $r_1$ and $r_2$ to obtain $\\widehat{r}_1$ and $\\widehat{r}_2$, and evaluate the maximized log-likelihood $\\ln L(\\widehat{r}_1,\\widehat{r}_2)$.\n3. Compute the natural-log likelihood ratio statistic\n$$2\\ln\\Lambda \\;=\\; 2\\Big[\\ln L\\big(\\widehat{r}_1,\\widehat{r}_2;\\,A\\text{–}C\\text{–}B\\big)\\;-\\;\\ln L\\big(\\widehat{r}_1,\\widehat{r}_2;\\,A\\text{–}B\\text{–}C\\big)\\Big].$$\n\nRound your final numerical answer for $2\\ln\\Lambda$ to four significant figures.", "solution": "The problem requires a likelihood-based comparison of two competing gene orders, A-B-C and A-C-B, using progeny data from a three-point testcross where one class of recombinants has zero counts. The model assumes no interference.\n\nFirst, we address Task 1: expressing the likelihood function. The total progeny count is $N = 410 + 390 + 90 + 92 + 0 + 0 + 45 + 43 = 1070$.\nLet $N_{NR}$, $N_{SCO_1}$, $N_{SCO_2}$, and $N_{DCO}$ be the total counts in the four genetic categories. The log-likelihood function separates for each interval. The maximum likelihood estimates (MLEs) for the recombination fractions are given by the proportion of total crossovers in each interval:\n$$\\widehat{r}_1 = \\frac{N_{SCO_1} + N_{DCO}}{N} \\quad \\text{and} \\quad \\widehat{r}_2 = \\frac{N_{SCO_2} + N_{DCO}}{N}$$\nThe maximized log-likelihood is then calculated as the sum of two binomial log-likelihoods:\n$$\\ln L(\\widehat{r}_1,\\widehat{r}_2) = (N_{SCO_1}+N_{DCO})\\ln(\\widehat{r}_1) + (N_{NR}+N_{SCO_2})\\ln(1-\\widehat{r}_1) + (N_{SCO_2}+N_{DCO})\\ln(\\widehat{r}_2) + (N_{NR}+N_{SCO_1})\\ln(1-\\widehat{r}_2)$$\n\nNext, we perform Task 2 for each candidate order. The parental individual is *ABC/abc*, so the nonrecombinant (NR) progeny classes are *ABC* and *abc*. Thus, $N_{NR} = 410 + 390 = 800$.\n\nCase 1: Gene order A-B-C.\nFor this order, the DCO class involves swapping the middle gene, B, resulting in haplotypes *AbC* and *aBc*. The single crossover classes are *Abc*/*aBC* (SCO$_1$) and *ABc*/*abC* (SCO$_2$).\n- NR (*ABC*, *abc*): $N_{NR} = 800$.\n- SCO$_1$ (*Abc*, *aBC*): $N_{SCO_1} = 90 + 92 = 182$.\n- SCO$_2$ (*ABc*, *abC*): $N_{SCO_2} = 0 + 0 = 0$.\n- DCO (*AbC*, *aBc*): $N_{DCO} = 45 + 43 = 88$.\nThis classification is biologically inconsistent, as the DCO count (88) is larger than the SCO$_2$ count (0). However, we proceed with the formal likelihood calculation.\nThe total crossovers in each region are:\n- Region 1 (A-B): $N_1 = N_{SCO_1} + N_{DCO} = 182 + 88 = 270$.\n- Region 2 (B-C): $N_2 = N_{SCO_2} + N_{DCO} = 0 + 88 = 88$.\nThe MLEs are $\\widehat{r}_1 = 270/1070$ and $\\widehat{r}_2 = 88/1070$.\nThe maximized log-likelihood, $\\ln L_{A–B–C}$, is:\n$$\\ln L_{A–B–C} = 270\\ln\\left(\\frac{270}{1070}\\right) + 800\\ln\\left(\\frac{800}{1070}\\right) + 88\\ln\\left(\\frac{88}{1070}\\right) + 982\\ln\\left(\\frac{982}{1070}\\right) \\approx -908.7447$$\n\nCase 2: Gene order A-C-B.\nFor this order, the middle gene is C. A DCO event swaps C, resulting in haplotypes *ABc* and *abC*.\n- NR (*ABC*, *abc*): $N_{NR} = 800$.\n- SCO$_1$ (between A and C): Haplotypes are *Abc*, *aBC*. $N_{SCO_1} = 90 + 92 = 182$.\n- SCO$_2$ (between C and B): Haplotypes are *AbC*, *aBc*. $N_{SCO_2} = 45 + 43 = 88$.\n- DCO: Haplotypes are *ABc*, *abC*. $N_{DCO} = 0 + 0 = 0$.\nThis classification is biologically consistent: $N_{NR} > N_{SCO_1} > N_{SCO_2} > N_{DCO}$.\nThe total crossovers in each region are:\n- Region 1 (A-C): $N'_1 = N_{SCO_1} + N_{DCO} = 182 + 0 = 182$.\n- Region 2 (C-B): $N'_2 = N_{SCO_2} + N_{DCO} = 88 + 0 = 88$.\nThe MLEs are $\\widehat{r}'_1 = 182/1070$ and $\\widehat{r}'_2 = 88/1070$.\nThe maximized log-likelihood, $\\ln L_{A–C–B}$, is:\n$$\\ln L_{A–C–B} = 182\\ln\\left(\\frac{182}{1070}\\right) + 888\\ln\\left(\\frac{888}{1070}\\right) + 88\\ln\\left(\\frac{88}{1070}\\right) + 982\\ln\\left(\\frac{982}{1070}\\right) \\approx -834.1164$$\n\nFinally, for Task 3, we compute the natural-log likelihood ratio statistic. The model for order A-C-B has a substantially higher log-likelihood, indicating it provides a much better fit to the data.\n$$2\\ln\\Lambda = 2 \\Big[ \\ln L_{A–C–B} - \\ln L_{A–B–C} \\Big]$$\n$$2\\ln\\Lambda \\approx 2 \\Big[ (-834.1164) - (-908.7447) \\Big] = 2 \\Big[ 74.6283 \\Big] = 149.2566$$\nRounding to four significant figures, the result is $149.3$.", "answer": "$$\\boxed{149.3}$$", "id": "2814417"}, {"introduction": "Genetic analysis increasingly relies on computational tools to handle the complexities of large and often incomplete datasets. This advanced practice [@problem_id:2814383] moves into the realm of computational genetics by tackling the problem of missing data—a common issue in genotyping. You will implement the Expectation-Maximization (EM) algorithm to estimate recombination frequencies when genotypes for an intervening locus are unavailable, a powerful technique for maximizing the information from imperfect data.", "problem": "You are given a classical three-point testcross framework in which a cis-phase heterozygote *ABC/abc* is crossed to *abc/abc*. Assume the gene order hypothesis A-B-C throughout. The gamete produced by the heterozygote determines the progeny haplotype. Let the adjacent-interval recombination fractions be $r_{AB}$ and $r_{BC}$, with $0 \\le r_{AB} \\le \\tfrac{1}{2}$ and $0 \\le r_{BC} \\le \\tfrac{1}{2}$. Let $D$ denote the double-recombinant gamete fraction, subject to $0 \\le D \\le \\min(r_{AB}, r_{BC})$ and $1 - r_{AB} - r_{BC} + D \\ge 0$. Under these definitions, the quartet of class probabilities is\n$$\np \\equiv 1 - r_{AB} - r_{BC} + D,\\quad s_1 \\equiv r_{AB} - D,\\quad s_2 \\equiv r_{BC} - D,\\quad d \\equiv D,\n$$\nwith $p + s_1 + s_2 + d = 1$. The eight gametic haplotypes and their probabilities (each class split evenly into two haplotypes) are:\n- No crossover: *ABC* and *abc*, each with probability $p/2$.\n- Single crossover in AB: *Abc* and *aBC*, each with probability $s_1/2$.\n- Single crossover in BC: *ABc* and *abC*, each with probability $s_2/2$.\n- Double crossover: *AbC* and *aBc*, each with probability $d/2$.\n\nIn practice, some progeny have locus B untyped. Consequently, for those individuals only the pair (A,C) is observed, taking one of the four values: $A\\_C$ (meaning allele A and allele C), $A\\_c$, $a\\_C$, or $a\\_c$. These correspond to the haplotype pairs:\n- $A\\_C \\leftrightarrow \\{ABC, AbC\\}$,\n- $A\\_c \\leftrightarrow \\{ABc, Abc\\}$,\n- $a\\_C \\leftrightarrow \\{aBC, abC\\}$,\n- $a\\_c \\leftrightarrow \\{aBc, abc\\}$.\n\nTask. Starting only from the fundamental definitions of recombination fraction, linkage phase, and multinomial likelihood, derive an Expectation-Maximization (EM) algorithm that handles the untyped locus B by treating the exact haplotype for those individuals as latent. Your algorithm must maximize the marginal likelihood with respect to $(r_{AB}, r_{BC})$, profiling out $D$ via the complete-data multinomial maximum likelihood estimation (MLE) at each M-step. Specifically:\n\n- E-step. Given current parameter values $(r_{AB}, r_{BC}, D)$, compute the conditional probabilities that each partially observed (A,C) individual belongs to each of its two consistent haplotypes, and accumulate the corresponding expected complete-data counts.\n- M-step. Maximize the expected complete-data log-likelihood to update the class probabilities $(p, s_1, s_2, d)$ subject to nonnegativity and total sum $1$, then set\n$$\n\\widehat{r}_{AB} \\leftarrow s_1 + d,\\quad \\widehat{r}_{BC} \\leftarrow s_2 + d,\\quad \\widehat{D} \\leftarrow d.\n$$\nBecause the expected complete-data log-likelihood is multinomial and strictly concave on the simplex, the M-step reduces to normalizing the expected class counts. If a denominator in the E-step conditional probabilities becomes $0$ (e.g., $p + d = 0$ or $s_1 + s_2 = 0$), split the corresponding ambiguous counts evenly between the two compatible haplotypes.\n\nConvergence. Iterate until the sup-norm parameter change satisfies $\\max\\{|\\Delta r_{AB}|, |\\Delta r_{BC}|, |\\Delta D|\\} \\le \\varepsilon$ for a small tolerance $\\varepsilon$, or until a maximum number of iterations is reached. Report $(\\widehat{r}_{AB}, \\widehat{r}_{BC})$ as decimals (not percentages), rounded to $6$ decimal places.\n\nInput model. There is no external input. Your program must embed the following test suite as constants and execute the EM algorithm independently for each case.\n\nTest suite. Each test case supplies two sets of integer counts:\n- Fully typed haplotypes: counts for *ABC*, *ABc*, *AbC*, *Abc*, *aBC*, *aBc*, *abC*, *abc*.\n- Partially typed (A,C) groups: counts for $A\\_C$, $A\\_c$, $a\\_C$, $a\\_c$.\n\nAll counts are exact and scientifically plausible under a three-point cross.\n\n- Test case 1 (mixed typedness):\n  - Fully typed haplotypes ($8$ categories summing to $800$):\n    - *ABC* = 286, *ABc* = 66, *AbC* = 6, *Abc* = 42, *aBC* = 42, *aBc* = 6, *abC* = 66, *abc* = 286.\n  - Partially typed (A,C) groups ($4$ categories summing to $200$):\n    - $A\\_C$ = 73, $A\\_c$ = 27, $a\\_C$ = 27, $a\\_c$ = 73.\n- Test case 2 (all loci typed, double crossovers absent):\n  - Fully typed haplotypes ($8$ categories summing to $500$):\n    - *ABC* = 175, *ABc* = 25, *AbC* = 0, *Abc* = 50, *aBC* = 50, *aBc* = 0, *abC* = 25, *abc* = 175.\n  - Partially typed (A,C) groups: all $0$.\n- Test case 3 (heavy missingness at B):\n  - Fully typed haplotypes ($8$ categories summing to $100$):\n    - *ABC* = 35, *ABc* = 12, *AbC* = 1, *Abc* = 2, *aBC* = 2, *aBc* = 1, *abC* = 12, *abc* = 35.\n  - Partially typed (A,C) groups ($4$ categories summing to $900$):\n    - $A\\_C$ = 324, $A\\_c$ = 126, $a\\_C$ = 126, $a\\_c$ = 324.\n\nOutput specification. For each test case $i \\in \\{1,2,3\\}$, output the pair $(\\widehat{r}_{AB}^{(i)}, \\widehat{r}_{BC}^{(i)})$ as a two-element list $[\\widehat{r}_{AB}^{(i)}, \\widehat{r}_{BC}^{(i)}]$, with each value rounded to $6$ decimal places and expressed as a decimal in $[0, 0.5]$. Your program should produce a single line of output containing a list of these three results in order:\n$$\n[ [\\widehat{r}_{AB}^{(1)}, \\widehat{r}_{BC}^{(1)}], [\\widehat{r}_{AB}^{(2)}, \\widehat{r}_{BC}^{(2)}], [\\widehat{r}_{AB}^{(3)}, \\widehat{r}_{BC}^{(3)}] ].\n$$\nNo other text should be printed.", "solution": "The problem requires the derivation and implementation of an Expectation-Maximization (EM) algorithm to estimate recombination fractions from three-point testcross data, where some progeny have an untyped middle locus. The problem is scientifically sound, well-posed, and provides all necessary information for a solution. It constitutes a classical application of the EM algorithm to handle missing data in genetic linkage analysis.\n\n### 1. Statistical Model and Log-Likelihood\n\nThe experiment is a three-point testcross involving a cis-phase heterozygote, *ABC/abc*, and a homozygous recessive individual, *abc/abc*. The gene order is assumed to be A-B-C. The progeny's phenotype reveals the gamete contributed by the heterozygote. There are eight possible gametic haplotypes, which arise from four mutually exclusive events: no crossover (parental), single crossover in region 1 (A-B), single crossover in region 2 (B-C), and double crossover (one in each region).\n\nLet the model parameters be the recombination fractions $r_{AB}$ and $r_{BC}$, and the double-crossover fraction $D$. The probabilities of the four event classes are given as:\n- Parental class ($p$): $p = 1 - r_{AB} - r_{BC} + D$. Haplotypes: *ABC*, *abc*.\n- Region 1 SCO class ($s_1$): $s_1 = r_{AB} - D$. Haplotypes: *Abc*, *aBC*.\n- Region 2 SCO class ($s_2$): $s_2 = r_{BC} - D$. Haplotypes: *ABc*, *abC*.\n- Double crossover class ($d$): $d = D$. Haplotypes: *AbC*, *aBc*.\n\nThe probability of each of the two haplotypes within a class is half the class probability. For instance, $P(ABC) = P(abc) = p/2$.\n\nThe data consists of two parts:\n1.  **Complete Data**: Counts of $n_h$ for each of the $8$ fully typed haplotypes $h$.\n2.  **Incomplete Data**: Counts for the $4$ partially typed groups where locus B is unobserved: $N_{A\\_C}, N_{A\\_c}, N_{a\\_C}, N_{a\\_c}$. These observations are ambiguous, corresponding to pairs of underlying haplotypes.\n\nThe goal is to estimate $(r_{AB}, r_{BC})$ by maximizing the marginal likelihood of the observed data. The EM algorithm achieves this by iteratively working with the complete-data log-likelihood, which is simpler. If we knew the true count for every haplotype, the set of counts would follow a multinomial distribution. The complete-data log-likelihood, up to a constant, is:\n$$\n\\ell_c(p, s_1, s_2, d) \\propto N_p \\log p + N_{s1} \\log s_1 + N_{s2} \\log s_2 + N_d \\log d\n$$\nwhere $N_p, N_{s1}, N_{s2}, N_d$ are the total counts for the parental, SCO-1, SCO-2, and DCO classes, respectively.\n\n### 2. The Expectation-Maximization (EM) Algorithm\n\nThe EM algorithm is an iterative procedure for finding maximum likelihood estimates in problems with missing or latent data. Each iteration consists of two steps:\n- **E-step (Expectation):** Computes the expectation of the complete-data log-likelihood, conditioned on the observed data and the current parameter estimates. This is equivalent to computing the expected values of the sufficient statistics (the class counts $N_p, N_{s1}, N_{s2}, N_d$).\n- **M-step (Maximization):** Maximizes the expected log-likelihood computed in the E-step to find updated parameter estimates.\n\nLet $\\mathbf{\\theta}^{(t)} = (r_{AB}^{(t)}, r_{BC}^{(t)}, D^{(t)})$ be the parameter estimates at iteration $t$. These define the class probabilities $(p^{(t)}, s_1^{(t)}, s_2^{(t)}, d^{(t)})$.\n\n### 3. Derivation of the E-Step\n\nIn the E-step, we calculate the expected counts for each of the four crossover classes, which we denote $E_p, E_{s1}, E_{s2}, E_d$. These expected counts are the sum of the counts from the fully typed data and the expected contributions from the partially typed data.\n\nLet the counts from fully typed observations be:\n- $C_p = N_{ABC} + N_{abc}$\n- $C_{s1} = N_{Abc} + N_{aBC}$\n- $C_{s2} = N_{ABc} + N_{abC}$\n- $C_d = N_{AbC} + N_{aBc}$\n\nThe partially typed counts must be distributed among the classes based on conditional probabilities derived from the current parameter estimates $\\mathbf{\\theta}^{(t)}$.\n\n- An individual of type $A\\_C$ must have haplotype *ABC* (parental, prob. $p/2$) or *AbC* (double crossover, prob. $d/2$). The conditional probability of it being parental is:\n  $$P(\\text{parental} | A\\_C, \\mathbf{\\theta}^{(t)}) = \\frac{P(ABC)}{P(ABC) + P(AbC)} = \\frac{p^{(t)}/2}{p^{(t)}/2 + d^{(t)}/2} = \\frac{p^{(t)}}{p^{(t)} + d^{(t)}}$$\n- An individual of type $a\\_c$ must have haplotype *abc* (parental, prob. $p/2$) or *aBc* (double crossover, prob. d/2$). The conditional probability of it being parental is also $\\frac{p^{(t)}}{p^{(t)} + d^{(t)}}$.\n- An individual of type $A\\_c$ must have haplotype *Abc* (SCO-1, prob. $s_1/2$) or *ABc* (SCO-2, prob. $s_2/2$). The conditional probability of it being SCO-1 is:\n  $$P(\\text{SCO-1} | A\\_c, \\mathbf{\\theta}^{(t)}) = \\frac{P(Abc)}{P(Abc) + P(ABc)} = \\frac{s_1^{(t)}/2}{s_1^{(t)}/2 + s_2^{(t)}/2} = \\frac{s_1^{(t)}}{s_1^{(t)} + s_2^{(t)}}$$\n- An individual of type $a\\_C$ must have haplotype *aBC* (SCO-1, prob. $s_1/2$) or *abC* (SCO-2, prob. $s_2/2$). The conditional probability of it being SCO-1 is also $\\frac{s_1^{(t)}}{s_1^{(t)} + s_2^{(t)}}$.\n\nLet's define the allocation fractions, handling the special case of zero denominators as specified:\n- $\\gamma_p = \\frac{p^{(t)}}{p^{(t)} + d^{(t)}}$ if $p^{(t)} + d^{(t)} > 0$, else $0.5$.\n- $\\gamma_{s1} = \\frac{s_1^{(t)}}{s_1^{(t)} + s_2^{(t)}}$ if $s_1^{(t)} + s_2^{(t)} > 0$, else $0.5$.\n\nThe total expected counts for each class are then:\n- $E_p = C_p + (N_{A\\_C} + N_{a\\_c}) \\cdot \\gamma_p$\n- $E_{s1} = C_{s1} + (N_{A\\_c} + N_{a\\_C}) \\cdot \\gamma_{s1}$\n- $E_{s2} = C_{s2} + (N_{A\\_c} + N_{a\\_C}) \\cdot (1 - \\gamma_{s1})$\n- $E_d = C_d + (N_{A\\_C} + N_{a\\_c}) \\cdot (1 - \\gamma_p)$\n\n### 4. Derivation of the M-Step\n\nIn the M-step, we find the parameters $(p, s_1, s_2, d)$ that maximize the expected complete-data log-likelihood, which is equivalent to maximizing $E_p \\log p + E_{s1} \\log s_1 + E_{s2} \\log s_2 + E_d \\log d$ subject to the constraint that probabilities sum to $1$. This is a standard multinomial MLE problem, and the solution is to normalize the expected counts.\nLet $N_{total}$ be the total sample size (sum of all fully and partially typed counts).\nThe updated class probabilities are:\n$$\np^{(t+1)} = \\frac{E_p}{N_{total}}, \\quad s_1^{(t+1)} = \\frac{E_{s1}}{N_{total}}, \\quad s_2^{(t+1)} = \\frac{E_{s2}}{N_{total}}, \\quad d^{(t+1)} = \\frac{E_d}{N_{total}}\n$$\nFrom these, we update the recombination parameters according to their definitions:\n- $\\widehat{r}_{AB}^{(t+1)} \\leftarrow s_1^{(t+1)} + d^{(t+1)}$\n- $\\widehat{r}_{BC}^{(t+1)} \\leftarrow s_2^{(t+1)} + d^{(t+1)}$\n- $\\widehat{D}^{(t+1)} \\leftarrow d^{(t+1)}$\n\n### 5. Algorithm Summary\n\n1.  **Initialization**: Compute initial parameter estimates $(r_{AB}^{(0)}, r_{BC}^{(0)}, D^{(0)})$ using only the fully typed counts. If there are no fully typed counts, a non-informative starting point (e.g., $r_{AB}=r_{BC}=0.1, D=0.01$) can be used.\n2.  **Iteration**:\n    a.  **E-Step**: Given the current parameters $(p^{(t)}, s_1^{(t)}, s_2^{(t)}, d^{(t)})$, compute the expected class counts $(E_p, E_{s1}, E_{s2}, E_d)$ as derived above.\n    b.  **M-Step**: Update the class probabilities by normalizing the expected counts: $p^{(t+1)} = E_p/N_{total}$, etc. Then, update the recombination parameters $r_{AB}^{(t+1)}, r_{BC}^{(t+1)}, D^{(t+1)}$.\n3.  **Convergence**: Repeat the E- and M-steps until the change in parameters is smaller than a specified tolerance $\\varepsilon$ (e.g., $\\max\\{|\\Delta r_{AB}|, |\\Delta r_{BC}|, |\\Delta D|\\} \\le 10^{-7}$), or a maximum number of iterations is reached.\n4.  **Output**: Report the final estimates $(\\widehat{r}_{AB}, \\widehat{r}_{BC})$.\n\nThis completes the derivation of the required algorithm.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_suite = [\n        {\n            \"full_counts\": {\n                'ABC': 286, 'ABc': 66, 'AbC': 6, 'Abc': 42,\n                'aBC': 42, 'aBc': 6, 'abC': 66, 'abc': 286,\n            },\n            \"partial_counts\": {\n                'A_C': 73, 'A_c': 27, 'a_C': 27, 'a_c': 73,\n            }\n        },\n        {\n            \"full_counts\": {\n                'ABC': 175, 'ABc': 25, 'AbC': 0, 'Abc': 50,\n                'aBC': 50, 'aBc': 0, 'abC': 25, 'abc': 175,\n            },\n            \"partial_counts\": {\n                'A_C': 0, 'A_c': 0, 'a_C': 0, 'a_c': 0,\n            }\n        },\n        {\n            \"full_counts\": {\n                'ABC': 35, 'ABc': 12, 'AbC': 1, 'Abc': 2,\n                'aBC': 2, 'aBc': 1, 'abC': 12, 'abc': 35,\n            },\n            \"partial_counts\": {\n                'A_C': 324, 'A_c': 126, 'a_C': 126, 'a_c': 324,\n            }\n        }\n    ]\n\n    results = []\n    for case in test_suite:\n        r_ab, r_bc = run_em_algorithm(case['full_counts'], case['partial_counts'])\n        results.append([round(r_ab, 6), round(r_bc, 6)])\n\n    # The final print statement must follow the exact format given.\n    # Using str() on a list of lists produces the required formatting with spaces.\n    print(str(results))\n\ndef run_em_algorithm(full_counts, partial_counts, max_iter=1000, tol=1e-7):\n    \"\"\"\n    Implements the Expectation-Maximization (EM) algorithm for a single test case.\n    \n    Args:\n        full_counts (dict): Counts of the 8 fully typed haplotypes.\n        partial_counts (dict): Counts of the 4 partially typed (A,C) groups.\n        max_iter (int): Maximum number of iterations.\n        tol (float): Convergence tolerance.\n\n    Returns:\n        tuple: A tuple containing the estimated (r_AB, r_BC).\n    \"\"\"\n    # 1. Parse data and calculate total counts\n    # Class counts from fully typed observations\n    C_p = full_counts['ABC'] + full_counts['abc']\n    C_s1 = full_counts['Abc'] + full_counts['aBC']\n    C_s2 = full_counts['ABc'] + full_counts['abC']\n    C_d = full_counts['AbC'] + full_counts['aBc']\n\n    # Ambiguous group counts from partially typed observations\n    N_AC = partial_counts['A_C']\n    N_Ac = partial_counts['A_c']\n    N_aC = partial_counts['a_C']\n    N_ac = partial_counts['a_c']\n    \n    N_total_full = C_p + C_s1 + C_s2 + C_d\n    N_total_partial = N_AC + N_Ac + N_aC + N_ac\n    N_total = N_total_full + N_total_partial\n\n    # 2. Initialization\n    if N_total_full > 0:\n        p = C_p / N_total_full\n        s1 = C_s1 / N_total_full\n        s2 = C_s2 / N_total_full\n        d = C_d / N_total_full\n    else: # Fallback if no fully typed data, not required for these tests\n        p, s1, s2, d = 0.7, 0.1, 0.1, 0.1\n\n    r_ab = s1 + d\n    r_bc = s2 + d\n    D = d\n\n    # 3. EM Iteration loop\n    for _ in range(max_iter):\n        r_ab_old, r_bc_old, D_old = r_ab, r_bc, D\n\n        # E-Step: Calculate expected counts\n        \n        # Denominators for conditional probabilities\n        denom1 = p + d\n        denom2 = s1 + s2\n        \n        # Allocation fractions (gamma parameters)\n        # Handle zero denominator case as per problem spec\n        gamma_p = p / denom1 if denom1 > 0 else 0.5\n        \n        gamma_s1 = s1 / denom2 if denom2 > 0 else 0.5\n        gamma_s2 = 1.0 - gamma_s1\n\n        # Expected counts (E_p, E_s1, E_s2, E_d)\n        E_p = C_p + (N_AC + N_ac) * gamma_p\n        E_s1 = C_s1 + (N_Ac + N_aC) * gamma_s1\n        E_s2 = C_s2 + (N_Ac + N_aC) * gamma_s2\n        E_d = C_d + (N_AC + N_ac) * (1.0 - gamma_p)\n\n        # M-Step: Update parameters\n        p = E_p / N_total\n        s1 = E_s1 / N_total\n        s2 = E_s2 / N_total\n        d = E_d / N_total\n\n        r_ab = s1 + d\n        r_bc = s2 + d\n        D = d\n        \n        # Check for convergence\n        delta_r_ab = abs(r_ab - r_ab_old)\n        delta_r_bc = abs(r_bc - r_bc_old)\n        delta_D = abs(D - D_old)\n        \n        if max(delta_r_ab, delta_r_bc, delta_D)  tol:\n            break\n            \n    return r_ab, r_bc\n\n# Execute the solver\nif __name__ == '__main__':\n    solve()\n```", "id": "2814383"}]}