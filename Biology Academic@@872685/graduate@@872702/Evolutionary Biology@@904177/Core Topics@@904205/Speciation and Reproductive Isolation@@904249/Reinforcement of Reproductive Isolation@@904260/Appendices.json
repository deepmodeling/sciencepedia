{"hands_on_practices": [{"introduction": "To truly understand reinforcement, we must first grasp its fundamental economic trade-off. This exercise challenges you to derive the critical condition for reinforcement by comparing the fitness consequences of random versus assortative mating in a classic two-deme model. By calculating the threshold selection strength ($s^*$) needed to overcome migration ($m$) and the cost of choosiness ($c$), you will build a foundational understanding of the selective pressures that drive the evolution of reproductive isolation [@problem_id:2748821].", "problem": "Consider a two-deme population with discrete, non-overlapping generations and symmetric migration. In each generation, a fraction $m$ of individuals in each deme are immigrants from the other deme, and mating occurs after migration within each deme. Individuals are characterized by a lineage identity that determines whether a mating is conspecific (same lineage) or heterospecific (different lineage). Conspecific matings produce offspring with relative viability $1$, while heterospecific matings produce hybrids with relative viability $1 - s$, where $s \\in [0,1]$ is the selection coefficient against hybrids. Assume that lineage identity is reliably expressed such that, following migration, the fraction of potential mates in a given deme that are heterospecific is $m$, and the fraction that are conspecific is $1 - m$.\n\nThere is also a preference locus with two alleles: a non-choosy allele that mates randomly with available partners, and a choosy allele that enforces perfect assortative mating (it mates only with conspecifics) but incurs a fecundity cost $c \\in [0,1)$ that multiplicatively reduces the number of zygotes produced. Assume that the choosy allele is initially rare and does not alter the composition of the mating pool. Assume multiplicative fitness components across mating success, fecundity, and offspring viability.\n\nReinforcement of reproductive isolation is said to proceed if the choosy allele has a marginal fitness advantage when rare. Using only the assumptions and definitions above, derive the critical threshold $s^\\ast$ as a function of $m$ and $c$ such that reinforcement proceeds if and only if $s  s^\\ast$. Express your final answer as a closed-form analytic expression for $s^\\ast$ in terms of $m$ and $c$. No numerical evaluation is required.", "solution": "The problem requires the derivation of the critical threshold for postzygotic isolation, $s^\\ast$, above which an allele for assortative mating will successfully invade a population. This is a problem of reinforcement, which is analyzed by comparing the fitness of a rare \"choosy\" allele to the fitness of the resident \"non-choosy\" allele. The choosy allele invades if its marginal fitness is higher.\n\nWe define the relative fitness, $W$, of an individual based on the allele it carries at the preference locus. As per the problem statement, fitness is determined by the multiplicative effects of fecundity and the average viability of offspring produced. We are considering the case where the choosy allele is rare.\n\nFirst, we calculate the fitness of the resident non-choosy allele, which we denote as $W_{NC}$. Individuals with this allele mate randomly with the available partners in the deme. Following migration, the proportion of conspecific potential mates is $1-m$ and the proportion of heterospecific potential mates is $m$. The non-choosy allele carries no direct fecundity cost, so its relative fecundity is $1$.\n\nThe average offspring viability, $V_{NC}$, is therefore:\n$$V_{NC} = (1-m) \\cdot 1 + m \\cdot (1-s) = 1 - ms$$\nThe total relative fitness of the non-choosy allele, $W_{NC}$, is the product of its relative fecundity and average offspring viability:\n$$W_{NC} = 1 \\cdot V_{NC} = 1 - ms$$\n\nNext, we calculate the fitness of the rare, invading choosy allele, denoted as $W_{C}$. This allele enforces perfect assortative mating, meaning individuals carrying it mate exclusively with conspecifics. Because the allele is rare, we assume it does not deplete the pool of available conspecific mates and a mate is always found. All offspring are therefore from conspecific matings and have a relative viability of $1$.\n\nHowever, the choosy allele incurs a fecundity cost, $c$, which reduces the number of zygotes produced by a factor of $1-c$. The relative fecundity for the choosy allele is thus $1-c$.\n\nThe total relative fitness of the choosy allele, $W_{C}$, is the product of its reduced fecundity and the (maximum) viability of its offspring:\n$$W_{C} = (1-c) \\cdot 1 = 1-c$$\n\nReinforcement of reproductive isolation proceeds if the choosy allele can spread when rare. This occurs if its fitness is greater than that of the resident non-choosy allele, i.e., if $W_{C}  W_{NC}$. We can express this condition as the following inequality:\n$$1-c  1-ms$$\nThis inequality represents the fundamental trade-off of reinforcement: the intrinsic cost of choosiness, $c$, must be less than the fitness loss avoided by not producing unfit hybrids. The expected fitness loss from hybridization for a random-mating individual is the product of the rate of hybridization, $m$, and the selection cost against hybrids, $s$.\n\nTo find the condition on $s$, we solve the inequality. Subtracting $1$ from both sides gives:\n$$-c  -ms$$\nMultiplying by $-1$ reverses the inequality sign:\n$$c  ms$$\nAssuming that migration exists ($m  0$), we can divide by $m$ to isolate $s$:\n$$s  \\frac{c}{m}$$\nThis inequality specifies the condition under which reinforcement will proceed. The critical threshold, $s^\\ast$, is the value of $s$ for which the fitnesses of the two alleles are equal ($W_C = W_{NC}$). Reinforcement occurs if and only if $s  s^\\ast$. Therefore, the critical threshold is given by:\n$$s^\\ast = \\frac{c}{m}$$", "answer": "$$\\boxed{\\frac{c}{m}}$$", "id": "2748821"}, {"introduction": "Evolutionary patterns observed in nature rarely have a single, obvious cause; multiple processes can generate similar outcomes. This practice moves from theoretical derivation to the critical skill of hypothesis testing, pitting reinforcement against a common alternative, ecological character displacement. You will use Bayesian model selection to compute a Bayes factor ($BF_{\\mathcal{R},\\mathcal{E}}$), a powerful tool for quantifying the weight of evidence that a given dataset provides for one evolutionary model over another [@problem_id:2748801].", "problem": "In a secondary-contact zone between two closely related insect species, you are given two independent quantitative summaries of reproductive barrier patterns aggregated over many population pairs. The first summary, denoted by $S_{1}$, is the standardized difference in prezygotic isolation between sympatry and allopatry (positive values indicate stronger prezygotic isolation in sympatry). The second summary, denoted by $S_{2}$, is the Fisher $z$-transformed difference in trait–environment coupling between sympatry and allopatry (positive values indicate stronger ecological trait matching in sympatry). Assume that $S_{1}$ and $S_{2}$ are conditionally independent given their underlying effect parameters and that their sampling errors are approximately Gaussian with known standard deviations.\n\nTwo competing evolutionary hypotheses are to be compared by a Bayes factor: reinforcement of reproductive isolation (model $\\mathcal{R}$) and ecological character displacement (model $\\mathcal{E}$). The following generative models for the summaries are posited:\n\n- Under model $\\mathcal{R}$ (reinforcement): \n  - $S_{1} \\mid \\delta \\sim \\mathcal{N}(\\delta, \\sigma_{1}^{2})$ with $\\delta \\sim \\mathcal{N}(\\mu_{\\delta \\mathcal{R}}, \\tau_{\\delta}^{2})$ and $\\mu_{\\delta \\mathcal{R}} = 0.8$,\n  - $S_{2} \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma_{2}^{2})$ with $\\theta \\sim \\mathcal{N}(\\mu_{\\theta \\mathcal{R}}, \\tau_{\\theta}^{2})$ and $\\mu_{\\theta \\mathcal{R}} = 0$.\n\n- Under model $\\mathcal{E}$ (ecological character displacement): \n  - $S_{1} \\mid \\delta \\sim \\mathcal{N}(\\delta, \\sigma_{1}^{2})$ with $\\delta \\sim \\mathcal{N}(\\mu_{\\delta \\mathcal{E}}, \\tau_{\\delta}^{2})$ and $\\mu_{\\delta \\mathcal{E}} = 0$,\n  - $S_{2} \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma_{2}^{2})$ with $\\theta \\sim \\mathcal{N}(\\mu_{\\theta \\mathcal{E}}, \\tau_{\\theta}^{2})$ and $\\mu_{\\theta \\mathcal{E}} = 0.9$.\n\nAssume the prior standard deviations are shared across models as $\\tau_{\\delta} = 0.5$ and $\\tau_{\\theta} = 0.5$, and the sampling standard deviations are $\\sigma_{1} = 0.35$ and $\\sigma_{2} = 0.30$. The observed summaries are $S_{1} = 1.10$ and $S_{2} = 0.85$.\n\nStarting from Bayes’ theorem and the definition of the Bayes factor as the ratio of marginal likelihoods, compute the Bayes factor in favor of reinforcement over ecological character displacement, $BF_{\\mathcal{R},\\mathcal{E}}$. Treat $S_{1}$ and $S_{2}$ as independent given model parameters, and explicitly integrate out the latent effect parameters under each model. Round your final answer to four significant figures.", "solution": "The problem requires the computation of a Bayes factor, $BF_{\\mathcal{R},\\mathcal{E}}$, to compare two competing evolutionary hypotheses: reinforcement ($\\mathcal{R}$) and ecological character displacement ($\\mathcal{E}$), given two observed data summaries, $S_1$ and $S_2$.\n\nFirst, we conduct a validation of the problem statement.\nThe givens are:\nData: $S_1 = 1.10$, $S_2 = 0.85$.\nStandard deviations of sampling distributions: $\\sigma_1 = 0.35$, $\\sigma_2 = 0.30$.\nStandard deviations of prior distributions: $\\tau_\\delta = 0.5$, $\\tau_\\theta = 0.5$.\nModel $\\mathcal{R}$ (reinforcement):\n$S_1 \\mid \\delta \\sim \\mathcal{N}(\\delta, \\sigma_1^2)$ with $\\delta \\sim \\mathcal{N}(\\mu_{\\delta\\mathcal{R}}, \\tau_\\delta^2)$, where $\\mu_{\\delta\\mathcal{R}} = 0.8$.\n$S_2 \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma_2^2)$ with $\\theta \\sim \\mathcal{N}(\\mu_{\\theta\\mathcal{R}}, \\tau_\\theta^2)$, where $\\mu_{\\theta\\mathcal{R}} = 0$.\nModel $\\mathcal{E}$ (ecological character displacement):\n$S_1 \\mid \\delta \\sim \\mathcal{N}(\\delta, \\sigma_1^2)$ with $\\delta \\sim \\mathcal{N}(\\mu_{\\delta\\mathcal{E}}, \\tau_\\delta^2)$, where $\\mu_{\\delta\\mathcal{E}} = 0$.\n$S_2 \\mid \\theta \\sim \\mathcal{N}(\\theta, \\sigma_2^2)$ with $\\theta \\sim \\mathcal{N}(\\mu_{\\theta\\mathcal{E}}, \\tau_\\theta^2)$, where $\\mu_{\\theta\\mathcal{E}} = 0.9$.\nThe problem assumes $S_1$ and $S_2$ are independent given the model parameters. This implies that their joint marginal likelihood is the product of their individual marginal likelihoods.\n\nThe problem is scientifically grounded, using standard concepts from evolutionary biology (reinforcement, character displacement) and standard statistical methods (Bayesian model selection). It is well-posed, providing all necessary information for a unique solution. The language is objective and precise. The problem is valid.\n\nThe Bayes factor in favor of model $\\mathcal{R}$ over model $\\mathcal{E}$ is defined as the ratio of their marginal likelihoods:\n$$BF_{\\mathcal{R},\\mathcal{E}} = \\frac{p(S_1, S_2 | \\mathcal{R})}{p(S_1, S_2 | \\mathcal{E})}$$\nGiven the independence of the generative processes for $S_1$ and $S_2$ under each model, the joint marginal likelihood for a model $\\mathcal{M}$ factorizes:\n$$p(S_1, S_2 | \\mathcal{M}) = p(S_1 | \\mathcal{M}) p(S_2 | \\mathcal{M})$$\nThus, the Bayes factor can be written as:\n$$BF_{\\mathcal{R},\\mathcal{E}} = \\frac{p(S_1 | \\mathcal{R}) p(S_2 | \\mathcal{R})}{p(S_1 | \\mathcal{E}) p(S_2 | \\mathcal{E})}$$\nWe must compute the marginal likelihood for each data summary under each model. For a generic summary $S$, a latent parameter $\\lambda$, and a model $\\mathcal{M}$, the structure is:\nLikelihood: $S \\mid \\lambda \\sim \\mathcal{N}(\\lambda, \\sigma^2)$\nPrior: $\\lambda \\sim \\mathcal{N}(\\mu, \\tau^2)$\nThe marginal likelihood $p(S|\\mathcal{M})$ is obtained by integrating over the latent parameter $\\lambda$:\n$$p(S|\\mathcal{M}) = \\int_{-\\infty}^{\\infty} p(S \\mid \\lambda) p(\\lambda | \\mathcal{M}) d\\lambda$$\nThis is a standard result for a Gaussian-Gaussian conjugate model. The marginal distribution of $S$ is also Gaussian:\n$$S \\sim \\mathcal{N}(\\mu, \\sigma^2 + \\tau^2)$$\nThe marginal likelihood is the probability density function (PDF) of this resulting normal distribution, evaluated at the observed value of $S$:\n$$p(S|\\mathcal{M}) = \\frac{1}{\\sqrt{2\\pi(\\sigma^2 + \\tau^2)}} \\exp\\left(-\\frac{(S - \\mu)^2}{2(\\sigma^2 + \\tau^2)}\\right)$$\n\nLet us define the total variances for $S_1$ and $S_2$:\nFor $S_1$: $V_1 = \\sigma_1^2 + \\tau_\\delta^2 = (0.35)^2 + (0.5)^2 = 0.1225 + 0.25 = 0.3725$.\nFor $S_2$: $V_2 = \\sigma_2^2 + \\tau_\\theta^2 = (0.30)^2 + (0.5)^2 = 0.09 + 0.25 = 0.34$.\n\nNow we can write out the four marginal likelihood terms:\nUnder model $\\mathcal{R}$:\n$p(S_1 | \\mathcal{R}) = \\frac{1}{\\sqrt{2\\pi V_1}} \\exp\\left(-\\frac{(S_1 - \\mu_{\\delta\\mathcal{R}})^2}{2V_1}\\right)$\n$p(S_2 | \\mathcal{R}) = \\frac{1}{\\sqrt{2\\pi V_2}} \\exp\\left(-\\frac{(S_2 - \\mu_{\\theta\\mathcal{R}})^2}{2V_2}\\right)$\n\nUnder model $\\mathcal{E}$:\n$p(S_1 | \\mathcal{E}) = \\frac{1}{\\sqrt{2\\pi V_1}} \\exp\\left(-\\frac{(S_1 - \\mu_{\\delta\\mathcal{E}})^2}{2V_1}\\right)$\n$p(S_2 | \\mathcal{E}) = \\frac{1}{\\sqrt{2\\pi V_2}} \\exp\\left(-\\frac{(S_2 - \\mu_{\\theta\\mathcal{E}})^2}{2V_2}\\right)$\n\nSubstituting these into the expression for the Bayes factor, the normalization constants $\\frac{1}{\\sqrt{2\\pi V_1}}$ and $\\frac{1}{\\sqrt{2\\pi V_2}}$ cancel:\n$$BF_{\\mathcal{R},\\mathcal{E}} = \\frac{\\exp\\left(-\\frac{(S_1 - \\mu_{\\delta\\mathcal{R}})^2}{2V_1}\\right) \\exp\\left(-\\frac{(S_2 - \\mu_{\\theta\\mathcal{R}})^2}{2V_2}\\right)}{\\exp\\left(-\\frac{(S_1 - \\mu_{\\delta\\mathcal{E}})^2}{2V_1}\\right) \\exp\\left(-\\frac{(S_2 - \\mu_{\\theta\\mathcal{E}})^2}{2V_2}\\right)}$$\nThis simplifies to:\n$$BF_{\\mathcal{R},\\mathcal{E}} = \\exp\\left( -\\frac{1}{2} \\left[ \\frac{(S_1 - \\mu_{\\delta\\mathcal{R}})^2 - (S_1 - \\mu_{\\delta\\mathcal{E}})^2}{V_1} + \\frac{(S_2 - \\mu_{\\theta\\mathcal{R}})^2 - (S_2 - \\mu_{\\theta\\mathcal{E}})^2}{V_2} \\right] \\right)$$\nNow we substitute the numerical values:\n$S_1 = 1.10$, $S_2 = 0.85$.\n$\\mu_{\\delta\\mathcal{R}} = 0.8$, $\\mu_{\\delta\\mathcal{E}} = 0$.\n$\\mu_{\\theta\\mathcal{R}} = 0$, $\\mu_{\\theta\\mathcal{E}} = 0.9$.\n$V_1 = 0.3725$, $V_2 = 0.34$.\n\nLet's compute the terms inside the square brackets.\nFor the $S_1$ component:\n$$\\frac{(1.10 - 0.8)^2 - (1.10 - 0)^2}{0.3725} = \\frac{(0.3)^2 - (1.1)^2}{0.3725} = \\frac{0.09 - 1.21}{0.3725} = \\frac{-1.12}{0.3725}$$\nFor the $S_2$ component:\n$$\\frac{(0.85 - 0)^2 - (0.85 - 0.9)^2}{0.34} = \\frac{(0.85)^2 - (-0.05)^2}{0.34} = \\frac{0.7225 - 0.0025}{0.34} = \\frac{0.72}{0.34}$$\nThe sum of these two components is:\n$$\\frac{-1.12}{0.3725} + \\frac{0.72}{0.34} \\approx -3.0067114 + 2.1176471 = -0.8890643$$\nFinally, we compute the Bayes factor:\n$$BF_{\\mathcal{R},\\mathcal{E}} = \\exp\\left( -\\frac{1}{2} (-0.8890643) \\right) = \\exp(0.44453215) \\approx 1.559773$$\nRounding to four significant figures, the result is $1.560$. This value indicates that the observed data are approximately $1.56$ times more likely under the reinforcement model ($\\mathcal{R}$) than under the ecological character displacement model ($\\mathcal{E}$).", "answer": "$$\\boxed{1.560}$$", "id": "2748801"}, {"introduction": "While analytical models provide invaluable insights, they often rely on simplifying assumptions. This final practice immerses you in the world of computational biology, asking you to build a stochastic simulation to explore dynamics too complex for simple equations. By implementing a Wright-Fisher model, you will directly investigate how factors like genetic drift, migration ($m$), selection ($s$), and initial linkage disequilibrium ($D_0$) interact to determine the probability that reinforcement becomes established in a finite population [@problem_id:2748819].", "problem": "Consider a two-deme, discrete-generation model of reinforcement (the evolution of prezygotic isolation due to selection against hybrids) with three biallelic loci: two divergent ecological barrier loci $X \\in \\{0,1\\}$ and $Y \\in \\{0,1\\}$, and a preference locus $R \\in \\{0,1\\}$. The two demes are labeled $d \\in \\{0,1\\}$. In deme $d=0$, the locally adapted alleles are $X=1$ and $Y=1$; in deme $d=1$, the locally adapted alleles are $X=0$ and $Y=0$. The model assumes haploid adults, sexual reproduction with random pairing but assortative mate choice when $R=1$, viability selection against locally maladapted alleles, and symmetric migration between demes.\n\nFoundational base and definitions:\n- Each adult is a haploid gamete carrying a haplotype $(R,X,Y) \\in \\{0,1\\}^3$. A generation consists of mating, offspring production, viability selection, migration, and census.\n- Linkage Disequilibrium (LD) is defined for the barrier loci $X$ and $Y$ within a deme by $D = f_{11} f_{00} - f_{10} f_{01}$, where $f_{xy}$ is the frequency of the $XY$ haplotype with $X=x$ and $Y=y$.\n- Viability selection is multiplicative across the two barrier loci: in deme $d$, a haploid offspring with $k$ mismatches to the local optimum at $(X,Y)$ has viability $w = (1 - s)^k$, where $s \\in [0,1)$ is the per-allele selection coefficient and $k \\in \\{0,1,2\\}$ is the number of mismatches between the offspring $(X,Y)$ and the local optimum $(1,1)$ in deme $d=0$ or $(0,0)$ in deme $d=1$.\n- Mating and assortative preference: adults pair at random except that an adult with $R=1$ in deme $d$ upweights potential mates that carry the locally optimal barrier haplotype in that deme. Specifically, let $\\alpha \\in [0,1)$ be the assortative strength. For an $R=1$ chooser in deme $d$, the probability of choosing a mate of a given type is proportional to $(1+\\alpha)$ if that mate has the locally optimal $(X,Y)$ in deme $d$, and to $(1-\\alpha)$ otherwise; for $R=0$ choosers, all mates are equally likely (proportional to their current frequency).\n- Cost of preference: an adult with $R=1$ suffers a fertility cost $c \\in [0,1)$, implemented as a reduction in its expected number of matings by a factor $(1-c)$.\n- Offspring formation without intra-haplotype recombination: each mating produces exactly one haploid offspring that is the maternal haplotype with probability $1/2$ and the paternal haplotype with probability $1/2$. This implements genetic mixing at the level of partner choice while avoiding additional recombination within the haplotype.\n- Migration: after viability selection, a fraction $m \\in [0,1/2]$ of each deme’s survivors migrates to the other deme.\n- Census: each deme is rescaled to a fixed size $N$ by multinomial sampling from the post-migration composition, implementing a Wright–Fisher sampling step.\n\nInitialization:\n- Within each deme, initialize the barrier haplotype frequencies with specified initial linkage disequilibrium $D_0 \\in [-1/4,1/4]$ and marginal allele frequencies $P(X=1)=1/2$ and $P(Y=1)=1/2$. The initial barrier haplotype frequencies are\n$$\nf_{11}(0) = \\tfrac{1}{4} + D_0,\\quad\nf_{10}(0) = \\tfrac{1}{4} - D_0,\\quad\nf_{01}(0) = \\tfrac{1}{4} - D_0,\\quad\nf_{00}(0) = \\tfrac{1}{4} + D_0.\n$$\n- All initial adults have $R=0$ except that a single copy of $R=1$ is introduced in deme $d=0$ by replacing one randomly chosen adult (drawn according to the above barrier haplotype frequencies) so that the initial preference allele frequency is $1/N$ in deme $d=0$ and $0$ in deme $d=1$.\n\nQuantifying “reinforcement establishment”:\n- Let $\\theta \\in (0,1)$ be a threshold for establishment and $T$ the number of generations simulated. Define establishment as the event that the global frequency of $R=1$ across both demes at generation $T$ is at least $\\theta$.\n- For fixed parameters $(m,s,D_0)$, define the probability of reinforcement establishment as the fraction of independent replicate simulations that satisfy the establishment criterion.\n\nAlgorithmic requirements to implement:\n- Use a finite population Wright–Fisher sampling scheme with deme size $N$ and the life cycle described above.\n- In each generation and in each deme:\n  1. Determine the number of effective choosers per haplotype type after applying the fertility cost $(1-c)$ to $R=1$ individuals.\n  2. For each chooser haplotype type, sample mates according to the preference-weighted mate distribution defined above.\n  3. For each mating, sample the haploid offspring as the maternal or paternal haplotype with probability $1/2$ each.\n  4. Apply viability selection by weighting offspring counts by $(1-s)^k$, where $k$ is the number of maladapted barrier alleles relative to the local optimum.\n  5. Apply symmetric migration with rate $m$ between demes.\n  6. Resample each deme to population size $N$ by multinomial sampling.\n\n- The initial linkage disequilibrium $D_0$ must satisfy $D_0 \\in [-1/4,1/4]$ to ensure all initial frequencies are nonnegative.\n\nNumerical specification:\n- Use population size per deme $N = 200$.\n- Use number of generations $T = 150$.\n- Use assortative strength $\\alpha = 0.6$.\n- Use fertility cost $c = 0.01$.\n- Use establishment threshold $\\theta = 0.8$.\n- Use number of independent replicates per parameter set $R_{\\mathrm{rep}} = 64$.\n- Express the estimated probability of reinforcement establishment for each parameter set as a decimal in $[0,1]$ (not a percentage).\n\nTest suite:\nProvide a program that computes the probability of reinforcement establishment for each of the following parameter sets $(m,s,D_0)$ using the above model and numerical specification. The program must produce results in the same order:\n1. $(m,s,D_0) = (0.0,\\ 0.1,\\ 0.0)$.\n2. $(m,s,D_0) = (0.05,\\ 0.0,\\ 0.1)$.\n3. $(m,s,D_0) = (0.05,\\ 0.2,\\ 0.2)$.\n4. $(m,s,D_0) = (0.2,\\ 0.2,\\ 0.2)$.\n5. $(m,s,D_0) = (0.05,\\ 0.2,\\ -0.2)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,r_3,r_4,r_5]$, where each $r_i$ is the estimated probability (a decimal) for test case $i$ in the order listed above.", "solution": "The problem statement has been critically validated and is deemed valid. It is scientifically grounded in the principles of evolutionary population genetics, specifically the theory of reinforcement. The model is well-posed, with all parameters, initial conditions, and dynamics explicitly and unambiguously defined. The setup is self-contained, logically consistent, and free of scientific or factual unsoundness. It represents a standard, albeit specific, computational problem in theoretical biology that can be solved via direct simulation.\n\nThe task is to compute the probability of establishment for a preference allele, $R=1$, under different parameter combinations. The approach will be to implement a stochastic, discrete-generation Wright-Fisher simulation that precisely follows the specified life cycle. This will be repeated for $R_{\\mathrm{rep}} = 64$ independent replicates for each parameter set to estimate the establishment probability.\n\nThe state of the system is described by the counts of individuals for each of the $8$ possible haplotypes $(R,X,Y)$ in each of the two demes, $d \\in \\{0, 1\\}$. We can index the haplotypes from $0$ to $7$ using the mapping $(R,X,Y) \\to 4R + 2X + Y$. Thus, the population of each deme is represented by a vector of $8$ integer counts, summing to the deme size $N=200$.\n\nThe simulation proceeds as follows:\n\n**1. Initialization**\nFor each replicate simulation, the populations of the two demes are initialized.\n- Based on the initial linkage disequilibrium $D_0$, the frequencies of the four barrier haplotypes $(X,Y)$ are calculated: $f_{11} = \\tfrac{1}{4} + D_0$, $f_{10} = \\tfrac{1}{4} - D_0$, $f_{01} = \\tfrac{1}{4} - D_0$, and $f_{00} = \\tfrac{1}{4} + D_0$. All individuals initially have the non-preference allele $R=0$.\n- For each deme, an initial population of $N=200$ individuals is generated by drawing from a multinomial distribution with these frequencies. This determines the counts for haplotypes with $R=0$ (indices $0, 1, 2, 3$).\n- A single mutant allele $R=1$ is introduced in deme $d=0$. This is accomplished by randomly selecting one individual from the initial $N$ in deme $d=0$ and changing its $R$ allele from $0$ to $1$. This means its haplotype index $i \\in \\{0,1,2,3\\}$ changes to $i+4$. The initial frequency of the $R=1$ allele is therefore $1/N$ in deme $d=0$ and $0$ in deme $d=1$.\n\n**2. Generation Loop**\nThe simulation runs for $T=150$ generations. In each generation, the following life cycle events occur in sequence for each deme:\n\n**2a. Mating and Offspring Production**\nTo produce a new generation of $N$ offspring, $N$ matings are simulated.\n- **Chooser Determination**: Individuals are selected to be \"choosers\" (mothers). An individual with the preference allele $R=1$ has a reduced fertility, implemented by down-weighting its probability of being chosen by a factor $(1-c)$. The $N$ choosers are sampled based on these cost-adjusted frequencies.\n- **Mate Choice**: Each chooser selects a \"chosen\" mate (father) from the entire deme population of size $N$.\n    - If the chooser has allele $R=0$, the mate is chosen randomly according to its frequency in the population.\n    - If the chooser has allele $R=1$, its choice is assortative. The probability of choosing a mate is weighted by $(1+\\alpha)$ if the mate carries the locally optimal $(X,Y)$ haplotype (i.e., $(1,1)$ in deme $d=0$; $(0,0)$ in deme $d=1$) and by $(1-\\alpha)$ otherwise.\n- **Offspring Formation**: For each of the $N$ mating pairs, a single haploid offspring is produced. The offspring's haplotype is randomly chosen to be either the mother's haplotype or the father's haplotype, each with probability $1/2$. This process generates a pool of $N$ new offspring.\n\n**2b. Viability Selection**\nOffspring survival depends on their ecological barrier alleles $(X,Y)$.\n- In deme $d$, an offspring's viability is $w = (1-s)^k$, where $k \\in \\{0,1,2\\}$ is the number of its barrier alleles that do not match the locally optimal ones and $s$ is the per-allele selection coefficient. For example, in deme $d=0$ where the optimum is $(X,Y)=(1,1)$, a haplotype with $(X,Y)=(0,1)$ has $k=1$ mismatch.\n- The number of offspring of each haplotype is multiplied by its corresponding viability, yielding the expected number of survivors of each type.\n\n**2c. Migration**\nA fraction $m$ of the surviving individuals in each deme migrates to the other deme. Since migration is symmetric, the post-migration composition of deme $d=0$ is $(1-m)$ of its own survivors plus $m$ of the survivors from deme $d=1$. The composition of deme $d=1$ is updated reciprocally.\n\n**2d. Census (Wright-Fisher Sampling)**\nThe final step in a generation is density-dependent regulation, modeled as multinomial sampling.\n- The relative frequencies of all haplotypes in the post-migration pool of each deme are calculated.\n- A new population of exactly $N=200$ adults is sampled for each deme from a multinomial distribution defined by these frequencies. This constitutes the adult population for the start of the next generation.\n\n**3. Establishment Criterion**\nAfter $T=150$ generations, the simulation for one replicate concludes. The establishment of the preference allele $R=1$ is evaluated.\n- The global frequency of the $R=1$ allele is calculated as the total count of $R=1$ individuals across both demes, divided by the total population size $2N$.\n- If this global frequency is greater than or equal to the threshold $\\theta=0.8$, the allele is considered established for that replicate.\n- The final output for a given parameter set is the fraction of the $R_{\\mathrm{rep}}=64$ replicates in which establishment occurred. This provides a numerical estimate of the probability of reinforcement establishment.\n\nThis simulation framework will be implemented in Python using the NumPy library for efficient numerical and stochastic operations.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    # Numerical specifications from the problem statement\n    N = 200        # Population size per deme\n    T = 150        # Number of generations\n    alpha = 0.6    # Assortative strength\n    c = 0.01       # Fertility cost of preference\n    theta = 0.8    # Establishment threshold for R=1 allele frequency\n    R_rep = 64     # Number of independent replicates\n    \n    # Haplotype mapping: (R,X,Y) - 4*R + 2*X + Y\n    # (0,0,0) - 0, (0,0,1) - 1, (0,1,0) - 2, (0,1,1) - 3\n    # (1,0,0) - 4, (1,0,1) - 5, (1,1,0) - 6, (1,1,1) - 7\n\n    # Mismatch vectors for viability selection\n    # k = number of mismatches relative to local optimum\n    # Deme 0 optimum: (1,1). (X,Y) for indices 0,1,2,3 are (0,0),(0,1),(1,0),(1,1)\n    k_xy_deme0 = np.array([2, 1, 1, 0])\n    mismatch_vector_0 = np.concatenate([k_xy_deme0, k_xy_deme0])\n    \n    # Deme 1 optimum: (0,0)\n    k_xy_deme1 = np.array([0, 1, 1, 2])\n    mismatch_vector_1 = np.concatenate([k_xy_deme1, k_xy_deme1])\n\n    mismatch_vectors = [mismatch_vector_0, mismatch_vector_1]\n\n    # Preference masks for assortative mating\n    # is_optimal_mate[j] is True if haplotype j has the locally optimal (X,Y)\n    is_optimal_mate_0 = np.array([0,0,0,1,0,0,0,1], dtype=bool) # Optimum (1,1)\n    is_optimal_mate_1 = np.array([1,0,0,0,1,0,0,0], dtype=bool) # Optimum (0,0)\n    \n    optimal_mate_masks = [is_optimal_mate_0, is_optimal_mate_1]\n\n    test_cases = [\n        (0.0, 0.1, 0.0),\n        (0.05, 0.0, 0.1),\n        (0.05, 0.2, 0.2),\n        (0.2, 0.2, 0.2),\n        (0.05, 0.2, -0.2),\n    ]\n\n    results = []\n    for params in test_cases:\n        m, s, D0 = params\n        prob = run_replicates(params, N, T, alpha, c, theta, R_rep, \n                              mismatch_vectors, optimal_mate_masks)\n        results.append(prob)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_replicates(params, N, T, alpha, c, theta, R_rep, \n                   mismatch_vectors, optimal_mate_masks):\n    \"\"\"\n    Runs all replicates for a single parameter set.\n    \"\"\"\n    m, s, D0 = params\n    establishment_count = 0\n\n    # Pre-calculate viabilities as they are constant for a given 's'\n    viabilities = [(1 - s) ** mv for mv in mismatch_vectors]\n\n    for _ in range(R_rep):\n        pop0, pop1 = initialize_populations(D0, N)\n        \n        for _ in range(T):\n            pop0, pop1 = run_one_generation(pop0, pop1, N, m, alpha, c,\n                                            viabilities, optimal_mate_masks)\n\n        global_r1_freq = (np.sum(pop0[4:]) + np.sum(pop1[4:])) / (2 * N)\n        if global_r1_freq = theta:\n            establishment_count += 1\n            \n    return establishment_count / R_rep\n\ndef initialize_populations(D0, N):\n    \"\"\"\n    Initializes populations for two demes for one replicate.\n    \"\"\"\n    f11 = 0.25 + D0\n    f10 = 0.25 - D0\n    f01 = 0.25 - D0\n    f00 = 0.25 + D0\n    \n    # Ensure frequencies are valid\n    initial_barrier_freqs = np.array([f00, f01, f10, f11])\n    initial_barrier_freqs = np.maximum(0, initial_barrier_freqs)\n    initial_barrier_freqs /= np.sum(initial_barrier_freqs)\n\n    pop0 = np.zeros(8, dtype=int)\n    pop1 = np.zeros(8, dtype=int)\n    \n    pop0[0:4] = np.random.multinomial(N, initial_barrier_freqs)\n    pop1[0:4] = np.random.multinomial(N, initial_barrier_freqs)\n\n    # Introduce a single R=1 mutant in deme 0\n    if N  0:\n        # Probabilities of R=0 haplotypes in deme 0\n        victim_probs = pop0[0:4] / N\n        # Choose one R=0 haplotype to mutate\n        victim_draw = np.random.multinomial(1, victim_probs)\n        victim_idx_r0 = np.where(victim_draw == 1)[0][0]\n        \n        pop0[victim_idx_r0] -= 1\n        pop0[victim_idx_r0 + 4] += 1\n        \n    return pop0, pop1\n\ndef run_one_generation(pop0_in, pop1_in, N, m, alpha, c, viabilities, \n                       optimal_mate_masks):\n    \"\"\"\n    Simulates one full generation (mating, selection, migration, census).\n    \"\"\"\n    survivors0 = process_deme(pop0_in, 0, N, alpha, c, viabilities[0], optimal_mate_masks[0])\n    survivors1 = process_deme(pop1_in, 1, N, alpha, c, viabilities[1], optimal_mate_masks[1])\n\n    post_mig_0 = (1 - m) * survivors0 + m * survivors1\n    post_mig_1 = m * survivors0 + (1 - m) * survivors1\n    \n    # Census (Wright-Fisher sampling)\n    sum_post_mig_0 = np.sum(post_mig_0)\n    if sum_post_mig_0  0:\n        freqs0 = post_mig_0 / sum_post_mig_0\n        pop0_out = np.random.multinomial(N, freqs0)\n    else:\n        pop0_out = np.zeros(8, dtype=int)\n\n    sum_post_mig_1 = np.sum(post_mig_1)\n    if sum_post_mig_1  0:\n        freqs1 = post_mig_1 / sum_post_mig_1\n        pop1_out = np.random.multinomial(N, freqs1)\n    else:\n        pop1_out = np.zeros(8, dtype=int)\n        \n    return pop0_out, pop1_out\n\ndef process_deme(pop_in, deme_id, N, alpha, c, viability_vector, optimal_mate_mask):\n    \"\"\"\n    Processes a single deme through mating and viability selection.\n    \"\"\"\n    if np.sum(pop_in) == 0:\n        return np.zeros(8)\n        \n    # 1. Mating\n    # 1a. Effective choosers (accounting for cost c)\n    effective_choosers = pop_in.astype(float)\n    effective_choosers[4:] *= (1 - c)\n    total_eff_choosers = np.sum(effective_choosers)\n    if total_eff_choosers == 0:\n        return np.zeros(8)\n    chooser_probs = effective_choosers / total_eff_choosers\n    \n    # 1b. Mate choice probabilities\n    mate_freqs = pop_in / N\n    mate_choice_probs_R0 = mate_freqs\n    \n    weights_R1 = np.full(8, 1 - alpha)\n    weights_R1[optimal_mate_mask] = 1 + alpha\n    unnorm_probs_R1 = mate_freqs * weights_R1\n    sum_unnorm_probs_R1 = np.sum(unnorm_probs_R1)\n    mate_choice_probs_R1 = unnorm_probs_R1 / sum_unnorm_probs_R1 if sum_unnorm_probs_R1  0 else mate_freqs\n\n    # 1c. Offspring production\n    chooser_counts = np.random.multinomial(N, chooser_probs)\n    offspring_counts = np.zeros(8, dtype=int)\n\n    # R=0 choosers\n    n_choosers_r0 = np.sum(chooser_counts[0:4])\n    if n_choosers_r0  0:\n        maternal_haps = np.repeat(np.arange(4), chooser_counts[0:4])\n        paternal_haps = np.random.choice(8, size=n_choosers_r0, p=mate_choice_probs_R0)\n        is_maternal = np.random.rand(n_choosers_r0)  0.5\n        offspring_haps = np.where(is_maternal, maternal_haps, paternal_haps)\n        offspring_counts += np.bincount(offspring_haps, minlength=8)\n\n    # R=1 choosers\n    n_choosers_r1 = np.sum(chooser_counts[4:8])\n    if n_choosers_r1  0:\n        maternal_haps = np.repeat(np.arange(4, 8), chooser_counts[4:8])\n        paternal_haps = np.random.choice(8, size=n_choosers_r1, p=mate_choice_probs_R1)\n        is_maternal = np.random.rand(n_choosers_r1)  0.5\n        offspring_haps = np.where(is_maternal, maternal_haps, paternal_haps)\n        offspring_counts += np.bincount(offspring_haps, minlength=8)\n\n    # 2. Viability Selection\n    survivors = offspring_counts * viability_vector\n    return survivors\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "2748819"}]}