{"hands_on_practices": [{"introduction": "The core of the Fossilized Birth-Death (FBD) model is the fossilization process itself, which is modeled as a Poisson process occurring along the branches of the evolutionary tree. This first exercise provides a foundational check on your understanding of this key component. By calculating the expected number of fossils from the total lineage duration and the fossil sampling rate, you will practice applying the fundamental properties of Poisson processes and learn to distinguish essential parameters from extraneous information [@problem_id:2714602].", "problem": "A clade evolves under a Fossilized Birth-Death (FBD) process with per-lineage speciation rate $\\lambda$, extinction rate $\\mu$, fossil sampling rate $\\psi$ (homogeneous in time), and present-day sampling probability $\\rho$ for extant lineages. Fossil sampling events along lineages follow a homogeneous Poisson point process in continuous time with instantaneous rate $\\psi$ per lineage. Consider a realized diversification history of this clade for which the cumulative lineage duration (the sum of the durations of all lineages that ever existed in the clade, counting each lineage’s existence time once) is known to be $T=100$ Myr. The parameters are $(\\lambda,\\mu,\\psi,\\rho)=(0.3,0.2,0.05,0.8)$, all in units of $\\text{Myr}^{-1}$ for rates and dimensionless for $\\rho$. Assume that every fossil sampling event that occurs along a lineage is recorded and counted, including multiple samples on the same lineage at different times.\n\nUsing only the fundamental properties of homogeneous Poisson processes and linearity of expectation, compute the expected number of fossil samples from this clade conditional on $T$. Express your final answer as an exact number (no rounding required) and do not include units in the final answer box.", "solution": "The problem statement is subjected to rigorous validation before any attempt at a solution is made.\n\n### Step 1: Extract Givens\nThe explicit givens from the problem statement are:\n- **Model**: Fossilized Birth-Death (FBD) process.\n- **Per-lineage speciation rate**: $\\lambda = 0.3 \\, \\text{Myr}^{-1}$.\n- **Per-lineage extinction rate**: $\\mu = 0.2 \\, \\text{Myr}^{-1}$.\n- **Per-lineage fossil sampling rate**: $\\psi = 0.05 \\, \\text{Myr}^{-1}$.\n- **Present-day sampling probability**: $\\rho = 0.8$.\n- **Realized cumulative lineage duration**: $T = 100 \\, \\text{Myr}$.\n- **Fossil sampling mechanism**: A homogeneous Poisson point process along each lineage with instantaneous rate $\\psi$.\n- **Constraint on method**: The solution must use only fundamental properties of homogeneous Poisson processes and linearity of expectation.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the required criteria.\n1.  **Scientific Grounding**: The Fossilized Birth-Death process is a cornerstone model in modern paleobiology and macroevolution for phylogenetic inference and divergence time estimation. The parameters and the description of the fossil sampling process are standard for this model. The problem is scientifically sound.\n2.  **Well-Posedness and Completeness**: The problem asks for a conditional expectation, $E[N_f | T]$, where $N_f$ is the total number of fossils and $T$ is the total lineage duration. All parameters required to answer this specific question are provided. While additional parameters ($\\lambda, \\mu, \\rho$) are given, their relevance must be determined. Their presence does not render the problem incomplete or contradictory; it tests the ability to discern necessary from extraneous information. The problem is well-posed.\n3.  **Objectivity**: The problem is stated in precise, quantitative terms, free of subjective or ambiguous language.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a well-formulated question requiring the application of fundamental stochastic process theory to a standard evolutionary model. The solution proceeds.\n\nThe objective is to compute the expected number of fossil samples, denoted $N_f$, from a clade, conditional on the known cumulative lineage duration being $T = 100 \\, \\text{Myr}$.\n\nLet the realized diversification history of the clade be represented by a set of lineages $\\mathcal{L} = \\{L_1, L_2, \\dots, L_M\\}$, where $M$ is the total number of lineages that ever existed. Let $t_i$ be the temporal duration of lineage $L_i$. The cumulative lineage duration $T$ is the sum of these individual durations:\n$$T = \\sum_{i=1}^{M} t_i$$\nWe are given the condition that $T = 100 \\, \\text{Myr}$.\n\nThe problem states that fossil sampling along any single lineage $L_i$ follows a homogeneous Poisson process with a constant rate $\\psi$. A fundamental property of a homogeneous Poisson process with rate $\\psi$ over an interval of duration $t_i$ is that the expected number of events (in this case, fossil samples) is the product of the rate and the duration. Let $N_i$ be the number of fossils sampled from lineage $L_i$. The expected value of $N_i$ is:\n$$E[N_i] = \\psi t_i$$\n\nThe total number of fossil samples from the entire clade, $N_f$, is the sum of the fossils from all individual lineages:\n$$N_f = \\sum_{i=1}^{M} N_i$$\n\nWe are asked to find the expected value of $N_f$ conditional on the total lineage duration $T$. Let the specific realized history (i.e., the full set of lineages and their durations $\\{t_i\\}$) be denoted by $\\mathcal{H}$. The total lineage duration is a function of this history, $T(\\mathcal{H}) = \\sum_i t_i$. We wish to compute $E[N_f | T(\\mathcal{H}) = T]$.\n\nWe can use the law of total expectation (or iterated expectations). The expectation of $N_f$ conditioned on the value of $T$ is the expectation of the conditional expectation of $N_f$ given the full history $\\mathcal{H}$, over all possible histories $\\mathcal{H}$ that satisfy the condition $T(\\mathcal{H})=T$:\n$$E[N_f | T(\\mathcal{H}) = T] = E\\left[ E[N_f | \\mathcal{H}] \\Big| \\, T(\\mathcal{H}) = T \\right]$$\n\nFirst, we compute the inner expectation, $E[N_f | \\mathcal{H}]$. Given a specific history $\\mathcal{H}$, the durations $\\{t_i\\}$ are fixed. The random variables $N_i$ representing the fossil counts on each lineage are independent. By the linearity of expectation, the expected total number of fossils is the sum of the individual expectations:\n$$E[N_f | \\mathcal{H}] = E\\left[\\sum_{i=1}^{M} N_i \\Bigg| \\{t_i\\}_{i=1}^M \\right] = \\sum_{i=1}^{M} E[N_i | t_i]$$\nSubstituting $E[N_i | t_i] = \\psi t_i$, we obtain:\n$$E[N_f | \\mathcal{H}] = \\sum_{i=1}^{M} (\\psi t_i)$$\nSince $\\psi$ is a constant, we can factor it out of the summation:\n$$E[N_f | \\mathcal{H}] = \\psi \\left(\\sum_{i=1}^{M} t_i\\right) = \\psi T(\\mathcal{H})$$\nThis result shows that for any specific realized history $\\mathcal{H}$, the expected number of fossils depends only on the total lineage duration $T(\\mathcal{H})$ associated with it.\n\nNow we evaluate the outer expectation, subject to the condition that $T(\\mathcal{H})$ is fixed at the given value $T$:\n$$E[N_f | T(\\mathcal{H}) = T] = E[\\psi T(\\mathcal{H}) | T(\\mathcal{H}) = T]$$\nUnder the condition $T(\\mathcal{H}) = T$, the expression $\\psi T(\\mathcal{H})$ becomes the constant $\\psi T$. The expectation of a constant is the constant itself. Therefore:\n$$E[N_f | T(\\mathcal{H}) = T] = \\psi T$$\n\nThis result is derived using only the linearity of expectation and the fundamental property of the Poisson process, as required. The parameters $\\lambda$ (speciation rate), $\\mu$ (extinction rate), and $\\rho$ (present-day sampling probability) are irrelevant for this calculation. These parameters determine the probability distribution of the random variable $T(\\mathcal{H})$, but since we are conditioning on a specific value of $T$, we do not need to know this distribution. The parameter $\\rho$ concerns sampling of extant lineages at the present day, which is separate from the fossilization process that occurs throughout the history of all lineages.\n\nThe problem provides the necessary values:\n- Fossil sampling rate: $\\psi = 0.05 \\, \\text{Myr}^{-1}$\n- Cumulative lineage duration: $T = 100 \\, \\text{Myr}$\n\nSubstituting these values into our derived expression:\n$$E[N_f] = \\psi T = (0.05 \\, \\text{Myr}^{-1}) \\times (100 \\, \\text{Myr}) = 5$$\nThe expected number of fossil samples is $5$.", "answer": "$$\\boxed{5}$$", "id": "2714602"}, {"introduction": "Real-world datasets rarely match the idealized assumptions of our models, and understanding the consequences of this mismatch is a critical skill for any researcher. This practice challenges you to think critically about the systematic biases that arise from a common form of model misspecification: incorrectly assuming complete sampling of extant species. By reasoning from first principles, you will explore how this single error can propagate through the FBD model, affecting inferred turnover rates, the fossil sampling rate, and, most importantly, the estimated divergence times [@problem_id:2714616].", "problem": "A researcher analyzes a clade using a constant-rate Fossilized Birth-Death (FBD) process with speciation rate $\\lambda$, extinction rate $\\mu$, fossil sampling rate $\\psi$, and extant sampling proportion $\\rho$. The empirical dataset includes $n$ extant tips and $F$ fossil occurrences, and external knowledge indicates that only a fraction $\\rho^{\\star} \\in (0,1)$ of extant species were sampled (i.e., the extant sampling is incomplete). However, in the FBD analysis the researcher erroneously fixes $\\rho=1$ and estimates $(\\lambda,\\mu,\\psi)$ and divergence times from the data with otherwise diffuse priors.\n\nFrom first principles of birth-death-sampling processes and without appealing to any shortcut formulas, determine the most likely direction of bias this misspecification introduces in (i) inferred divergence times, (ii) the inferred fossil sampling rate $\\psi$, and (iii) inferred turnover or relative extinction (e.g., the ratio $\\mu/\\lambda$). Assume the fossil occurrence process is correctly modeled as a Poisson process along lineages with rate $\\psi$, and that the clade is supercritical with $\\lambda\\mu$.\n\nWhich option best describes the joint bias pattern expected under the misspecified assumption $\\rho=1$ when the truth is $\\rho^{\\star}1$?\n\nA. Divergence times are biased younger; $\\psi$ is biased upward; turnover (e.g., $\\mu/\\lambda$) is biased upward.\n\nB. Divergence times are biased older; $\\psi$ is biased downward; turnover is biased downward.\n\nC. Divergence times are approximately unbiased; only diversification rates are biased, with $\\lambda$ overestimated and $\\mu$ underestimated.\n\nD. The primary bias appears in the morphological clock rate, while the FBD parameters and divergence times remain approximately unbiased.", "solution": "The problem statement is subjected to validation before proceeding with a solution.\n\n### Step 1: Extract Givens\n-   **Model:** Constant-rate Fossilized Birth-Death (FBD) process.\n-   **Parameters:** Speciation rate $\\lambda$, extinction rate $\\mu$, fossil sampling rate $\\psi$, extant sampling proportion $\\rho$.\n-   **True Condition:** The true extant sampling proportion is $\\rho^{\\star} \\in (0,1)$.\n-   **Model Misspecification:** Analysis is performed with a fixed, incorrect assumption that $\\rho=1$.\n-   **Data:** An empirical dataset consisting of $n$ extant tips and $F$ fossil occurrences.\n-   **Inference:** Parameters $(\\lambda, \\mu, \\psi)$ and divergence times are estimated using diffuse priors.\n-   **Assumptions:** The fossil occurrence process is a Poisson process with rate $\\psi$. The clade is supercritical, meaning $\\lambda  \\mu$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as the Fossilized Birth-Death process is a cornerstone of modern divergence time estimation. The question addresses the consequences of model misspecification, a critical and realistic topic in statistical science. The parameters and assumptions listed are standard for this class of models. The problem is well-posed, objective, and contains sufficient information for a qualitative, principle-based deduction of the direction of parameter biases. It is not trivial, as the parameter interactions are complex. The problem is formalizable and verifiable through both mathematical analysis of the likelihood function and simulation studies.\n\n### Step 3: Verdict and Action\nThe problem statement is **valid**. A solution will be derived from first principles.\n\n### Derivation of Biases\n\nThe core of the problem is the misspecification of the extant sampling proportion $\\rho$. The researcher assumes complete sampling ($\\rho=1$), while the true data generating process involved incomplete sampling ($\\rho=\\rho^{\\star}  1$). The FBD model attempts to find the parameters $(\\lambda, \\mu, \\psi)$ and a timescale that best explain the observed reconstructed tree with its $n$ extant tips and $F$ fossils, under this false assumption. We analyze the resulting biases in inferred divergence times, fossil sampling rate $\\psi$, and turnover $\\mu/\\lambda$.\n\n**(iii) Bias in Turnover ($\\mu/\\lambda$)**\n\nThe most direct consequence of assuming $\\rho=1$ is the misinterpretation of unsampled extant lineages. The true evolutionary process produced a total number of surviving species, say $N_{extant}$, of which only $n = \\rho^{\\star} N_{extant}$ were sampled and included in the phylogeny. The remaining $(1-\\rho^{\\star})N_{extant}$ surviving species are missing from the data.\n\nFrom the perspective of the misspecified model, which assumes all survivors are included ($\\rho=1$), any lineage that does not lead to one of the $n$ observed tips must have gone extinct. The model therefore mistakes the large number of unsampled extant lineages for lineages that truly went extinct before the present. This leads to a gross overestimation of the number of extinction events. To account for this apparent high level of extinction, the model will infer a much higher extinction rate $\\mu$ than the true rate. While the speciation rate $\\lambda$ is also affected, the primary and strongest effect is the artificial inflation of the extinction rate. Consequently, the ratio of extinction to speciation, which is the turnover rate $\\mu/\\lambda$, is severely overestimated. The inferred turnover is **biased upward**.\n\n**(i) Bias in Divergence Times**\n\nThe misspecification of $\\rho$ also affects the perceived structure of the phylogenetic tree. Incomplete random sampling of tips preferentially removes species on short, recently-derived branches. This \"pruning\" of the true phylogeny leaves a reconstructed tree that is sparser, particularly near the present, and in which the surviving internal branches appear artificially long.\n\nThe FBD model must explain these long branches. The likelihood of a lineage persisting for a time $T$ without speciating is related to $e^{-\\lambda T}$. On one hand, the model infers a high extinction rate $\\mu$ (as explained above). To compensate and ensure the survival of any lineages at all to the present, the model must also infer a correspondingly high speciation rate $\\lambda$.\n\nNow the model faces a conflict: it has inferred a high speciation rate $\\hat{\\lambda}$, which implies that long branches should be rare, yet the tree it is analyzing contains artificially elongated branches due to sampling bias. The probability of observing a long branch of duration $T$ under a high speciation rate $\\hat{\\lambda}$ is exceedingly low. To reconcile the high inferred speciation rate with the observed long branches, the model's only recourse is to decrease the inferred duration $T$ of these branches. This effect systematically applies to all branches in the tree, causing the entire phylogeny to be compressed in time. As a result, the inferred divergence times, including the origin of the clade, are **biased to be younger** (i.e., closer to the present).\n\n**(ii) Bias in Fossil Sampling Rate ($\\psi$)**\n\nThe inferred fossil sampling rate $\\psi$ is the rate of fossil discoveries per lineage per unit of time. The total number of fossils, $F$, is a fixed piece of data. The model must explain these $F$ fossils occurring on the reconstructed tree. The total opportunity for fossilization is the total length of all branches in the tree, integrated over time (total lineage-duration).\n\nAs established above, the inferred divergence times are biased to be younger. This means the entire tree, from its origin to the present, is compressed into a shorter time interval. This compression reduces the total lineage-duration of the tree. To account for the observed number of fossils $F$ within a compressed tree that offers less cumulative time for fossils to be found, the rate of fossilization per unit time, $\\psi$, must be higher. The model compensates for the shortened timescale by inferring a higher fossil sampling rate. Therefore, the inferred fossil sampling rate $\\psi$ is **biased upward**.\n\nIn summary, the joint bias pattern is:\n-   (i) Divergence times are biased **younger**.\n-   (ii) Fossil sampling rate $\\psi$ is biased **upward**.\n-   (iii) Turnover $\\mu/\\lambda$ is biased **upward**.\n\n### Option-by-Option Analysis\n\n**A. Divergence times are biased younger; $\\psi$ is biased upward; turnover (e.g., $\\mu/\\lambda$) is biased upward.**\nThis option matches our derived conclusions for all three components.\n-   Divergence times are biased younger: **Correct**.\n-   $\\psi$ is biased upward: **Correct**.\n-   Turnover is biased upward: **Correct**.\nTherefore, this option is **Correct**.\n\n**B. Divergence times are biased older; $\\psi$ is biased downward; turnover is biased downward.**\nThis option contradicts our findings on all three points.\n-   Divergence times are biased older: **Incorrect**. The bias is towards younger ages.\n-   $\\psi$ is biased downward: **Incorrect**. The bias is upward.\n-   Turnover is biased downward: **Incorrect**. The bias is upward.\nTherefore, this option is **Incorrect**.\n\n**C. Divergence times are approximately unbiased; only diversification rates are biased, with $\\lambda$ overestimated and $\\mu$ underestimated.**\nThis option is incorrect for multiple reasons.\n-   Divergence times are biased, not approximately unbiased.\n-   While $\\lambda$ is indeed overestimated, $\\mu$ is strongly overestimated, not underestimated.\nTherefore, this option is **Incorrect**.\n\n**D. The primary bias appears in the morphological clock rate, while the FBD parameters and divergence times remain approximately unbiased.**\nThis option introduces the concept of a \"morphological clock rate,\" which is not part of the problem statement. The problem is strictly about the parameters of the FBD process ($\\lambda, \\mu, \\psi, \\rho$) and divergence times. The FBD parameters and times are, in fact, severely biased.\nTherefore, this option is irrelevant and **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "2714616"}, {"introduction": "The way an analysis is framed can have profound effects on its outcome, and in divergence time estimation, one of the most fundamental choices is the conditioning event. This advanced practice guides you through a computational comparison of conditioning on a \"stem\" group (the survival of a single lineage) versus a \"crown\" group (the diversification into at least two lineages). By implementing the underlying birth-death probability calculations, you will gain a tangible appreciation for how this choice biases the posterior distribution of the root age, a subtle but crucial concept for designing robust macroevolutionary studies [@problem_id:2714627].", "problem": "You are to write a complete program that computes and compares posterior root ages under two different conditionings in a fossilized birth-death framework, while holding the speciation rate $\\lambda$, extinction rate $\\mu$, and fossil sampling rate $\\psi$ fixed. The comparison focuses on how conditioning on a crown versus a stem lineage changes the posterior distribution of the origin time (root age) $T$ of a clade.\n\nThe mathematical and statistical context is as follows. Consider a time-homogeneous linear birth-death process with speciation rate $\\lambda$ and extinction rate $\\mu$, starting from a single lineage at time $T$ in the past and running until the present time $0$. Assume that fossils, when considered, arise along lineages at a constant per-lineage rate $\\psi$. In this problem, you will condition on events about the number of extant lineages at present and deliberately not use any fossil occurrence data. Therefore, $\\psi$ is held fixed but does not enter the event probabilities used; it is included purely to respect the requirement that $(\\lambda,\\mu,\\psi)$ are fixed parameters of the fossilized birth-death process.\n\nDefine two conditioning events on the number of extant lineages at present:\n- Stem conditioning $S$: “at least one extant lineage at present,” that is, $N_T \\geq 1$.\n- Crown conditioning $C$: “at least two extant lineages at present,” that is, $N_T \\geq 2$.\n\nAssume a prior distribution for the origin time (root age) $T$ that is uniform on the interval $[0, T_{\\max}]$. Let $p_{\\text{prior}}(T)$ denote this prior density and let $L_{\\mathcal{E}}(T)$ denote the likelihood of the conditioning event $\\mathcal{E}\\in\\{S,C\\}$ given $T$ under the linear birth-death process. The unnormalized posterior density is then $p_{\\text{prior}}(T)L_{\\mathcal{E}}(T)$, and the posterior mean of $T$ under conditioning event $\\mathcal{E}$ is\n$$\n\\mathbb{E}[T \\mid \\mathcal{E}] \\;=\\; \\frac{\\int_{0}^{T_{\\max}} T \\, L_{\\mathcal{E}}(T)\\, dT}{\\int_{0}^{T_{\\max}} L_{\\mathcal{E}}(T)\\, dT}.\n$$\nYour task is to compute the posterior means under both conditionings and then return the difference\n$$\n\\Delta \\;=\\; \\mathbb{E}[T \\mid C] \\;-\\; \\mathbb{E}[T \\mid S],\n$$\nwhich quantifies how crown conditioning favors older or younger root ages relative to stem conditioning when $(\\lambda,\\mu,\\psi)$ are fixed.\n\nFundamental principles to use:\n- The process is a standard linear birth-death process with constant rates. You may use the well-tested result that the distribution of the number of extant lineages at a fixed time $t$ has probabilities that can be expressed in closed form via $\\lambda$, $\\mu$, and $t$.\n- You must derive or justify the event likelihoods $L_S(T)$ and $L_C(T)$ from first principles of the linear birth-death process, not from any shortcut formulas provided in this problem statement.\n\nProgram requirements:\n- Implement numerical evaluation of the posterior means via one-dimensional numerical integration over $T \\in [0, T_{\\max}]$ using the uniform prior. You must not rely on closed-form antiderivatives.\n- Use the same time unit for all inputs and outputs; report the final results as real numbers in those units. Round each result to $6$ decimal places.\n- No angles are involved. Percentages are not involved.\n\nTest suite:\nUse the following parameter sets. Each test case is a tuple $(\\lambda,\\mu,\\psi,T_{\\max})$:\n1. $(0.8, 0.2, 0.1, 10.0)$ — a general “happy path” case with net diversification $ 0$.\n2. $(0.6, 0.59, 0.1, 10.0)$ — near-critical dynamics to probe numerical stability when $\\lambda \\approx \\mu$.\n3. $(0.5, 0.0, 0.05, 8.0)$ — a pure-birth special case.\n4. $(1.2, 0.4, 0.2, 2.0)$ — short time horizon to test boundary behavior.\n\nFor each test case, compute $\\Delta = \\mathbb{E}[T \\mid C] - \\mathbb{E}[T \\mid S]$ in the same time unit as $T_{\\max}$ and round to $6$ decimal places.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each \"result\" is the $\\Delta$ value for the corresponding test case listed in the same order as above, each rounded to $6$ decimal places.", "solution": "The problem as stated is valid. It is scientifically grounded in the theory of birth-death processes, a cornerstone of macroevolutionary modeling. It is well-posed, providing all necessary parameters and a clear, objective quantity to compute. All terms are defined formally and there are no internal contradictions. We may proceed with the solution.\n\nThe problem requires the computation of the difference in posterior mean root ages, $\\Delta = \\mathbb{E}[T \\mid C] - \\mathbb{E}[T \\mid S]$, under two different conditioning schemes for a clade's history, modeled as a linear birth-death process. The process starts with a single lineage at time $T$ in the past and evolves until the present (time $0$). The parameters are the speciation rate $\\lambda$, extinction rate $\\mu$, and fossil sampling rate $\\psi$. The prior distribution for the origin time $T$ is uniform on $[0, T_{\\max}]$. The fossil sampling rate $\\psi$ is extraneous to this problem, as the conditioning events concern only the number of extant lineages, not the fossil record.\n\nFirst, we must derive the likelihoods of the conditioning events from the first principles of the birth-death process. Let $p_n(t)$ be the probability that a single lineage at time $0$ gives rise to exactly $n$ lineages at time $t$. For a process of duration $T$, we are interested in $p_n(T)$.\n\nThe fundamental quantities are the probabilities of extinction ($p_0(T)$) and of having $n \\ge 1$ descendants ($p_n(T)$). These probabilities depend on whether the speciation and extinction rates are equal.\n\nCase 1: $\\lambda \\neq \\mu$.\nLet $r = \\lambda - \\mu$ be the net diversification rate. The probability of extinction by time $T$ is:\n$$ p_0(T) = \\frac{\\mu(e^{rT} - 1)}{\\lambda e^{rT} - \\mu} $$\nFor $n \\ge 1$, the probability of having $n$ descendants is given by:\n$$ p_n(T) = \\frac{r^2 e^{rT}}{(\\lambda e^{rT} - \\mu)^2} \\left( \\frac{\\lambda(e^{rT} - 1)}{\\lambda e^{rT} - \\mu} \\right)^{n-1} $$\nThis is derived from the generating function for the process.\n\nCase 2: $\\lambda = \\mu$ (the critical case).\nBy taking the limit $r \\to 0$, we find:\n$$ p_0(T) = \\frac{\\mu T}{1 + \\mu T} $$\nAnd for $n \\ge 1$:\n$$ p_n(T) = \\frac{1}{(1 + \\mu T)^2} \\left( \\frac{\\mu T}{1 + \\mu T} \\right)^{n-1} $$\n\nThe conditioning events are defined on the number of extant lineages at the present, $N_T$.\n- Stem conditioning $S$: \"at least one extant lineage,\" i.e., $N_T \\ge 1$.\n- Crown conditioning $C$: \"at least two extant lineages,\" i.e., $N_T \\ge 2$.\n\nThe likelihood of an event $\\mathcal{E}$ given the origin time $T$, denoted $L_{\\mathcal{E}}(T)$, is the probability of that event, $P(\\mathcal{E} \\mid T)$.\nFor stem conditioning, the likelihood is the probability of survival of the lineage:\n$$ L_S(T) = P(N_T \\ge 1) = 1 - p_0(T) $$\nFor crown conditioning, the likelihood is the probability of survival and diversification into at least two lineages:\n$$ L_C(T) = P(N_T \\ge 2) = P(N_T \\ge 1) - P(N_T=1) = (1 - p_0(T)) - p_1(T) $$\n\nUsing the expressions for $p_0(T)$ and $p_1(T)$, we can write down the explicit likelihood functions.\n\nCase 1: $\\lambda \\neq \\mu$.\n$$ L_S(T) = 1 - \\frac{\\mu(e^{rT} - 1)}{\\lambda e^{rT} - \\mu} = \\frac{\\lambda e^{rT} - \\mu - \\mu e^{rT} + \\mu}{\\lambda e^{rT} - \\mu} = \\frac{(\\lambda - \\mu)e^{rT}}{\\lambda e^{rT} - \\mu} = \\frac{r e^{rT}}{\\lambda e^{rT} - \\mu} $$\nFor $L_C(T)$, we first need $p_1(T)$:\n$$ p_1(T) = \\frac{r^2 e^{rT}}{(\\lambda e^{rT} - \\mu)^2} $$\nTherefore,\n$$ L_C(T) = L_S(T) - p_1(T) = \\frac{r e^{rT}}{\\lambda e^{rT} - \\mu} - \\frac{r^2 e^{rT}}{(\\lambda e^{rT} - \\mu)^2} = \\frac{r e^{rT}(\\lambda e^{rT} - \\mu) - r^2 e^{rT}}{(\\lambda e^{rT} - \\mu)^2} = \\frac{r\\lambda e^{2rT} - r\\mu e^{rT} - r^2 e^{rT}}{(\\lambda e^{rT} - \\mu)^2} = \\frac{r\\lambda e^{rT}(e^{rT}-1)}{(\\lambda e^{rT} - \\mu)^2} $$\nA special sub-case is the pure-birth process where $\\mu=0$. Here, $r=\\lambda$, $p_0(T)=0$, so $L_S(T)=1$. And $p_1(T)=e^{-\\lambda T}$, which gives $L_C(T)=1 - e^{-\\lambda T}$. These results are recovered from the general formulas by setting $\\mu=0$.\n\nCase 2: $\\lambda = \\mu$.\n$$ L_S(T) = 1 - \\frac{\\mu T}{1 + \\mu T} = \\frac{1}{1 + \\mu T} $$\n$$ p_1(T) = \\frac{1}{(1 + \\mu T)^2} $$\n$$ L_C(T) = L_S(T) - p_1(T) = \\frac{1}{1 + \\mu T} - \\frac{1}{(1 + \\mu T)^2} = \\frac{1 + \\mu T - 1}{(1 + \\mu T)^2} = \\frac{\\mu T}{(1 + \\mu T)^2} $$\n\nThe posterior probability density for $T$ given an event $\\mathcal{E}$ is $p(T|\\mathcal{E}) \\propto L_{\\mathcal{E}}(T) p_{\\text{prior}}(T)$. With a uniform prior $p_{\\text{prior}}(T) = 1/T_{\\max}$ for $T \\in [0, T_{\\max}]$, the posterior mean is:\n$$ \\mathbb{E}[T \\mid \\mathcal{E}] = \\frac{\\int_{0}^{T_{\\max}} T \\, L_{\\mathcal{E}}(T) (1/T_{\\max}) \\, dT}{\\int_{0}^{T_{\\max}} L_{\\mathcal{E}}(T) (1/T_{\\max}) \\, dT} = \\frac{\\int_{0}^{T_{\\max}} T \\, L_{\\mathcal{E}}(T) \\, dT}{\\int_{0}^{T_{\\max}} L_{\\mathcal{E}}(T) \\, dT} $$\nThe constant prior density cancels. We define four integrals for numerical evaluation:\n$$ I_{0,S} = \\int_{0}^{T_{\\max}} L_S(T) dT $$\n$$ I_{1,S} = \\int_{0}^{T_{\\max}} T \\, L_S(T) dT $$\n$$ I_{0,C} = \\int_{0}^{T_{\\max}} L_C(T) dT $$\n$$ I_{1,C} = \\int_{0}^{T_{\\max}} T \\, L_C(T) dT $$\nThe posterior means are $\\mathbb{E}[T \\mid S] = I_{1,S} / I_{0,S}$ and $\\mathbb{E}[T \\mid C] = I_{1,C} / I_{0,C}$. The final quantity to compute is $\\Delta = \\mathbb{E}[T \\mid C] - \\mathbb{E}[T \\mid S]$.\n\nThe implementation will evaluate these four integrals numerically for each parameter set. For numerical stability, particularly when $\\lambda  \\mu$, the expressions can be reformulated to avoid overflow with large exponents. For $r0$:\n$$ L_S(T) = \\frac{r}{\\lambda - \\mu e^{-rT}} $$\n$$ L_C(T) = \\frac{r\\lambda (1-e^{-rT})}{(\\lambda - \\mu e^{-rT})^2} $$\nFor $r0$, the original forms are stable as $e^{rT} \\to 0$ for large $T$. A small tolerance will be used to switch to the $\\lambda=\\mu$ case to handle near-critical dynamics.", "answer": "```python\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Computes and compares posterior root ages under stem vs. crown conditioning\n    in a fossilized birth-death framework.\n    \"\"\"\n    \n    # Test cases: (lambda, mu, psi, T_max)\n    test_cases = [\n        (0.8, 0.2, 0.1, 10.0),\n        (0.6, 0.59, 0.1, 10.0),\n        (0.5, 0.0, 0.05, 8.0),\n        (1.2, 0.4, 0.2, 2.0),\n    ]\n\n    results = []\n\n    for lam, mu, psi, T_max in test_cases:\n        \n        # Define likelihood functions L_S(T) and L_C(T) based on parameters.\n        # A small tolerance is used to select the critical case model.\n        if np.abs(lam - mu)  1e-9:\n            # Case lambda = mu\n            def L_S(T):\n                if T == 0: return 1.0\n                return 1.0 / (1.0 + mu * T)\n\n            def L_C(T):\n                if T == 0: return 0.0\n                return (mu * T) / ((1.0 + mu * T)**2)\n        elif mu == 0:\n            # Case mu = 0 (Pure-birth)\n            def L_S(T):\n                # Using np.ones_like ensures it works with array inputs from quad\n                return np.ones_like(T) if isinstance(T, np.ndarray) else 1.0\n\n            def L_C(T):\n                if T == 0: return 0.0\n                return 1.0 - np.exp(-lam * T)\n        else: # General case lambda != mu\n            r = lam - mu\n            if r > 0: # Numerically stable form for lambda > mu\n                def L_S(T):\n                    if T == 0: return 1.0\n                    return r / (lam - mu * np.exp(-r * T))\n                \n                def L_C(T):\n                    if T == 0: return 0.0\n                    exp_neg_rT = np.exp(-r * T)\n                    numerator = r * lam * (1.0 - exp_neg_rT)\n                    denominator = (lam - mu * exp_neg_rT)**2\n                    return numerator / denominator\n            else: # r  0, original form is stable\n                def L_S(T):\n                    if T == 0: return 1.0\n                    exp_rT = np.exp(r * T)\n                    return (r * exp_rT) / (lam * exp_rT - mu)\n                \n                def L_C(T):\n                    if T == 0: return 0.0\n                    exp_rT = np.exp(r * T)\n                    numerator = r * lam * exp_rT * (exp_rT - 1.0)\n                    denominator = (lam * exp_rT - mu)**2\n                    return numerator / denominator\n        \n        # Define integrands for posterior mean calculation.\n        # We need to compute integral of T*L(T) and integral of L(T).\n        def integrand1_S(T):\n            return T * L_S(T)\n        \n        def integrand0_S(T):\n            return L_S(T)\n            \n        def integrand1_C(T):\n            return T * L_C(T)\n\n        def integrand0_C(T):\n            return L_C(T)\n\n        # Numerically compute the four definite integrals over [0, T_max].\n        I1_S, _ = integrate.quad(integrand1_S, 0, T_max)\n        I0_S, _ = integrate.quad(integrand0_S, 0, T_max)\n        \n        I1_C, _ = integrate.quad(integrand1_C, 0, T_max)\n        I0_C, _ = integrate.quad(integrand0_C, 0, T_max)\n\n        # Calculate posterior means for T under each conditioning.\n        E_T_S = I1_S / I0_S if I0_S != 0 else 0.0\n        E_T_C = I1_C / I0_C if I0_C != 0 else 0.0\n        \n        # Compute the difference and round to 6 decimal places.\n        delta = E_T_C - E_T_S\n        results.append(round(delta, 6))\n\n    # Format the final output string.\n    print(f\"[{','.join(f'{res:.6f}' for res in results)}]\")\n\nsolve()\n```", "id": "2714627"}]}