{"hands_on_practices": [{"introduction": "This exercise delves into the fundamental paradox of PRDM9-directed recombination: the very act of initiating recombination leads to the self-destruction of the binding motif through biased gene conversion (BGC). By constructing and solving a simple population genetics model, you will derive the equilibrium frequency of a hotspot-defining allele when its loss due to BGC is counteracted by restorative mutation [@problem_id:2748059]. This analytical practice hones your ability to translate a molecular mechanism into a mathematical framework and solve for its long-term evolutionary outcome.", "problem": "A single locus in a large, randomly mating diploid population determines the presence of a recombination hotspot motif bound by PR domain-containing protein 9 (PRDM9). There are two alleles: $A$ encodes a strong PRDM9-binding motif and $a$ encodes a non-binding state. Assume no viability or fertility differences among genotypes. Instead, Biased Gene Conversion (BGC) acts as transmission ratio distortion in heterozygotes: in $A/a$ meioses, the probability that a gamete carries $A$ is $1/2 - \\delta$, where $0 < \\delta < 1/2$ quantifies the magnitude of bias against the PRDM9-binding allele $A$ caused by hotspot-initiated gene conversion. Homozygotes transmit their allele with probability $1$. After meiosis but before zygote formation, unidirectional mutation from $a$ to $A$ occurs in gametes at rate $\\mu$, with $0 < \\mu < 1$; there is no back mutation from $A$ to $a$. Mating is random, and zygote genotype frequencies each generation are given by the Hardy–Weinberg principle based on the gamete allele frequencies.\n\nStarting from these assumptions and fundamental rules of Mendelian segregation generalized to include transmission ratio distortion, derive an exact closed-form expression for the internal equilibrium allele frequency $x^{*}$ of $A$ (with $0 < x^{*} < 1$) as a function of $\\mu$ and $\\delta$. Express your final answer as a single simplified analytic expression. No rounding is required, and no units apply.", "solution": "The problem statement is subjected to validation before any attempt at a solution.\n\n**Step 1: Extract Givens**\n- Population: Large, randomly mating, diploid.\n- Locus: Single locus determining PRDM9 binding.\n- Alleles: $A$ (strong binding motif), $a$ (non-binding).\n- Fitness: No viability or fertility differences.\n- Biased Gene Conversion (BGC): Transmission ratio distortion in $A/a$ heterozygotes.\n- Transmission probability of $A$ from an $A/a$ individual: $P(A | A/a) = \\frac{1}{2} - \\delta$.\n- BGC parameter constraint: $0 < \\delta < \\frac{1}{2}$.\n- Homozygote transmission: Mendelian, probability $1$.\n- Mutation: Unidirectional from $a$ to $A$ in gametes at rate $\\mu$.\n- Mutation rate constraint: $0 < \\mu < 1$.\n- Back mutation: Rate from $A$ to $a$ is $0$.\n- Mating system: Random mating.\n- Genotype frequencies: Determined by Hardy–Weinberg principle from gamete frequencies.\n- Objective: Derive the exact closed-form expression for the internal equilibrium allele frequency $x^{*}$ of allele $A$, where $0 < x^{*} < 1$, as a function of $\\mu$ and $\\delta$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, situated within the standard framework of population genetics. It models the interplay of two evolutionary forces: biased gene conversion (a form of meiotic drive) and mutation. These are well-understood and mathematically formalizable processes. The problem is well-posed, providing all necessary parameters ($\\mu$, $\\delta$) and their constraints. The language is precise and objective, using standard terminology. There are no contradictions, no missing information for the stated goal, and no scientific or logical fallacies. The system described is a standard model for allele frequency dynamics, which is expected to have a meaningful equilibrium solution under certain parameter conditions. The problem is therefore deemed valid.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be derived.\n\nLet $x_t$ be the frequency of allele $A$ in the adult population at generation $t$. Consequently, the frequency of allele $a$ is $1 - x_t$. Under the assumption of random mating, the zygote genotype frequencies at the start of generation $t$ are given by the Hardy–Weinberg proportions:\n- Frequency of $AA$: $f(AA) = x_t^2$\n- Frequency of $Aa$: $f(Aa) = 2x_t(1 - x_t)$\n- Frequency of $aa$: $f(aa) = (1 - x_t)^2$\n\nNext, we determine the frequency of allele $A$ in the gamete pool produced by these adults. This calculation must account for biased gene conversion in heterozygotes. Let $x'_t$ be the frequency of allele $A$ in the gametes after meiosis but before mutation.\nThe frequency $x'_t$ is the sum of contributions from each genotype:\n- $AA$ individuals are homozygous and produce only $A$ gametes. Their contribution is $f(AA) \\times 1 = x_t^2$.\n- $Aa$ individuals are heterozygous and produce $A$ gametes with the specified distorted probability of $\\frac{1}{2} - \\delta$. Their contribution is $f(Aa) \\times (\\frac{1}{2} - \\delta) = 2x_t(1 - x_t)(\\frac{1}{2} - \\delta)$.\n- $aa$ individuals are homozygous and produce no $A$ gametes. Their contribution is $f(aa) \\times 0 = 0$.\n\nSumming these contributions gives the frequency of $A$ gametes:\n$$\nx'_t = x_t^2 + 2x_t(1 - x_t)\\left(\\frac{1}{2} - \\delta\\right)\n$$\nSimplifying this expression:\n$$\nx'_t = x_t^2 + x_t(1 - x_t)(1 - 2\\delta)\n$$\n$$\nx'_t = x_t^2 + x_t - 2\\delta x_t - x_t^2 + 2\\delta x_t^2\n$$\n$$\nx'_t = x_t - 2\\delta x_t + 2\\delta x_t^2 = x_t(1 - 2\\delta(1 - x_t))\n$$\nThe frequency of $a$ gametes before mutation is simply $1 - x'_t$.\n\nFollowing meiosis, unidirectional mutation from $a$ to $A$ occurs at a rate $\\mu$. The frequency of allele $A$ in the next generation, $x_{t+1}$, is the frequency in the gamete pool after mutation. It is the sum of $A$ gametes that did not mutate (this is irrelevant as there is no back mutation) and the new $A$ gametes created by mutation from $a$.\nThe frequency of $A$ alleles remains $x'_t$ and the frequency of $a$ alleles becomes $(1-\\mu)(1 - x'_t)$. The new frequency of $A$ alleles is the sum of the old $A$ alleles and the newly mutated ones:\n$$\nx_{t+1} = x'_{t} + \\mu(1 - x'_{t}) = (1-\\mu)x'_{t} + \\mu\n$$\nWe have now formulated a complete recurrence relation for the frequency of allele $A$:\n$$\nx_{t+1} = (1-\\mu)\\left[x_t - 2\\delta x_t(1 - x_t)\\right] + \\mu\n$$\nAt equilibrium, the allele frequency does not change between generations, so $x_{t+1} = x_t = x^{*}$. We seek the internal equilibrium, where $0 < x^{*} < 1$.\nThe change in allele frequency per generation, $\\Delta x$, is given by $\\Delta x = x_{t+1} - x_t$. At equilibrium, $\\Delta x = 0$.\n$$\n\\Delta x = \\left((1-\\mu)\\left[x_t - 2\\delta x_t(1 - x_t)\\right] + \\mu\\right) - x_t\n$$\n$$\n\\Delta x = x_t - 2\\delta(1-\\mu)x_t(1-x_t) - \\mu x_t + \\mu - x_t\n$$\n$$\n\\Delta x = \\mu(1 - x_t) - 2\\delta(1-\\mu)x_t(1-x_t)\n$$\nSetting $\\Delta x = 0$ and $x_t = x^{*}$ gives the equilibrium condition:\n$$\n0 = \\mu(1 - x^{*}) - 2\\delta(1-\\mu)x^{*}(1-x^{*})\n$$\nWe can factor out the term $(1 - x^{*})$:\n$$\n0 = (1 - x^{*})\\left[\\mu - 2\\delta(1-\\mu)x^{*}\\right]\n$$\nThis equation yields two possible equilibrium solutions.\nThe first is $1 - x^{*} = 0$, which gives $x^{*} = 1$. This is a boundary equilibrium where allele $A$ is fixed in the population. The problem asks for the internal equilibrium.\nThe second equilibrium is found by setting the second term in the brackets to zero:\n$$\n\\mu - 2\\delta(1-\\mu)x^{*} = 0\n$$\nSolving for $x^{*}$:\n$$\n2\\delta(1-\\mu)x^{*} = \\mu\n$$\n$$\nx^{*} = \\frac{\\mu}{2\\delta(1-\\mu)}\n$$\nThis expression gives the internal equilibrium frequency of allele $A$. The existence of this internal equilibrium ($0 < x^{*} < 1$) requires that the parameters $\\mu$ and $\\delta$ satisfy $\\mu < \\frac{2\\delta}{1+2\\delta}$. Since the problem statement asks for the expression for this equilibrium, we assume such conditions are met. This is the desired closed-form expression as a function of $\\mu$ and $\\delta$.", "answer": "$$\n\\boxed{\\frac{\\mu}{2\\delta(1-\\mu)}}\n$$", "id": "2748059"}, {"introduction": "Building on the principle of hotspot erosion, this practice shifts focus from the fate of a single target motif to the evolution of the PRDM9 gene itself. You will design a computational model to simulate the \"Red Queen\" dynamics that are thought to drive the rapid turnover of PRDM9 alleles [@problem_id:2748045]. Implementing this model of negative frequency-dependent selection will provide direct, hands-on insight into why PRDM9 is one of the fastest-evolving genes in vertebrates and how a dynamic equilibrium of allelic diversity can be maintained.", "problem": "Design and implement a deterministic population-genetic model that captures the turnover of alleles at PR domain-containing protein 9 (PRDM9), driven by negative frequency-dependent selection arising from hotspot erosion. Begin from the following fundamental bases and core definitions:\n\n- In each generation, a haploid population contains a set of PRDM9 alleles indexed by $i \\in \\{0,1,\\dots,K-1\\}$ with allele-frequency vector $\\mathbf{p}(t) = (p_0(t),\\dots,p_{K-1}(t))$ satisfying $\\sum_i p_i(t) = 1$ and $p_i(t) \\ge 0$.\n- Each PRDM9 allele $i$ targets a distinct binding motif whose intact genomic fraction at generation $t$ is $M_i(t) \\in [0,1]$. Think of $M_i(t)$ as the proportion of potentially targetable binding sites for specificity $i$ that remain intact in the genome.\n- Binding by PRDM9 programs Double-Strand Breaks (DSBs), and gene conversion at DSBs erodes target motifs over time. Specifically, assume that in generation $t$:\n  - Each intact motif copy for allele $i$ is destroyed with probability proportional to the population frequency of allele $i$, scaled by an erosion constant $e > 0$.\n  - Each non-intact motif copy can be restored to intact state by mutation at rate $\\mu \\ge 0$ per generation, independent of allele frequencies.\n  - Total motif capacity is normalized to $1$ for each motif class, so $M_i(t)$ is a fraction in $[0,1]$. Whenever your update would move $M_i(t)$ outside of $[0,1]$, you must clamp it back into the interval $[0,1]$.\n- Assume that the expected relative fitness of individuals carrying allele $i$ increases linearly with the current availability of intact target motifs. Let $s \\ge 0$ be the per-generation selection scaling on intact motif availability. The relative fitness of allele $i$ in generation $t$ is $w_i(t) = 1 + s\\,M_i(t)$.\n- Allele-frequency change follows the standard haploid selection recursion from elementary population genetics applied deterministically.\n\nFrom these bases, derive the fully specified discrete-time dynamical system for $\\mathbf{M}(t) = (M_0(t),\\dots,M_{K-1}(t))$ and $\\mathbf{p}(t)$ over $T$ generations that embodies negative frequency-dependent selection due to hotspot erosion. Your implementation must:\n\n- Start from user-specified initial conditions $\\mathbf{p}(0)$ with $\\sum_i p_i(0)=1$ and $\\mathbf{M}(0)$ with all components in $[0,1]$.\n- Update $\\mathbf{M}(t)$ and $\\mathbf{p}(t)$ deterministically each generation using only the assumptions above.\n- Enforce $M_i(t) \\in [0,1]$ at all times by clamping if necessary.\n\nDefine and compute the following summary metrics for each simulation:\n\n- Turnover count: the number of strict changes in the identity of the most frequent allele across generations $t=0,1,\\dots,T$. Ties for the highest frequency are resolved by choosing the allele with the smallest index. The turnover count increments by $1$ whenever the identity of this dominant index differs from the previous generation’s dominant index.\n- Convergence flag: a boolean indicating whether the dynamical system appears to have converged by the final generation. Define convergence as follows: compute the maximum absolute one-step change across all state variables at the final update,\n  $$\\Delta(T) \\equiv \\max\\Big(\\max_i\\lvert p_i(T)-p_i(T-1)\\rvert,\\ \\max_i\\lvert M_i(T)-M_i(T-1)\\rvert\\Big).$$\n  If $\\Delta(T) \\le 10^{-10}$, return $\\mathrm{True}$; otherwise return $\\mathrm{False}$.\n- Final dominant index: the index in $\\{0,1,\\dots,K-1\\}$ of the most frequent allele at generation $T$ under the same tie-breaking rule as above. Use zero-based indexing.\n\nAngle units are not applicable. There are no physical units to report. All numerical answers must be returned as primitive values.\n\nYour program must execute the model and return the metrics for each of the following test cases:\n\n- Case A (general cycling regime):\n  - $K = 3$, $T = 600$, $s = 0.2$, $e = 0.8$, $\\mu = 0.01$,\n  - $\\mathbf{p}(0) = (0.34, 0.33, 0.33)$, $\\mathbf{M}(0) = (1, 1, 1)$.\n- Case B (no erosion boundary):\n  - $K = 3$, $T = 300$, $s = 0.2$, $e = 0$, $\\mu = 0.01$,\n  - $\\mathbf{p}(0) = (1/3, 1/3, 1/3)$, $\\mathbf{M}(0) = (1, 1, 1)$.\n- Case C (two-allele interaction):\n  - $K = 2$, $T = 800$, $s = 0.3$, $e = 0.9$, $\\mu = 0.02$,\n  - $\\mathbf{p}(0) = (0.5, 0.5)$, $\\mathbf{M}(0) = (1, 1)$.\n- Case D (strong motif restoration):\n  - $K = 3$, $T = 1200$, $s = 0.15$, $e = 0.9$, $\\mu = 0.2$,\n  - $\\mathbf{p}(0) = (0.34, 0.33, 0.33)$, $\\mathbf{M}(0) = (1, 1, 1)$.\n\nFinal output format: Your program should produce a single line of output containing a list of per-case results, one per test case, in the order A, B, C, D. Each per-case result must be a list of the form $[\\text{turnovers}, \\text{converged}, \\text{final\\_dominant\\_index}]$, where $\\text{turnovers}$ is an integer, $\\text{converged}$ is either True or False, and $\\text{final\\_dominant\\_index}$ is an integer using zero-based indexing. For example, a valid output shape is\n- [[3,False,2],[0,True,0],[7,False,1],[1,True,0]].", "solution": "The problem requires the formulation and implementation of a deterministic population-genetic model for the coevolution of PRDM9 alleles and their corresponding binding motifs. The core of the model is negative frequency-dependent selection, where the fitness of an allele is inversely related to its own frequency due to the erosion of its target motifs. We will construct a discrete-time dynamical system for the allele frequencies $\\mathbf{p}(t)$ and the proportion of intact motifs $\\mathbf{M}(t)$.\n\nFirst, we formalize the system's dynamics. The state at any generation $t$ is described by two vectors: the allele frequency vector $\\mathbf{p}(t) = (p_0(t), \\dots, p_{K-1}(t))$ for $K$ alleles, and the motif intactness vector $\\mathbf{M}(t) = (M_0(t), \\dots, M_{K-1}(t))$.\n\nThe relative fitness of an individual carrying PRDM9 allele $i$ is defined as a linear function of the availability of its intact target motifs, $M_i(t)$. With a selection scaling coefficient $s \\ge 0$, the fitness $w_i(t)$ is given by:\n$$w_i(t) = 1 + s M_i(t)$$\nThis formulation implies that higher motif availability confers higher fitness, representing, for instance, more efficient meiotic recombination initiation.\n\nThe change in allele frequencies from one generation to the next is governed by the standard deterministic haploid selection model. The frequency of allele $i$ in generation $t+1$ is its frequency in generation $t$ multiplied by its relative fitness, normalized by the mean fitness of the population, $\\bar{w}(t)$.\nThe mean fitness is the weighted average of all allele fitnesses:\n$$\\bar{w}(t) = \\sum_{j=0}^{K-1} p_j(t) w_j(t) = \\sum_{j=0}^{K-1} p_j(t) (1 + s M_j(t)) = 1 + s \\sum_{j=0}^{K-1} p_j(t) M_j(t)$$\nThe recursion for the allele frequency $p_i(t)$ is therefore:\n$$p_i(t+1) = p_i(t) \\frac{w_i(t)}{\\bar{w}(t)} = p_i(t) \\frac{1 + s M_i(t)}{1 + s \\sum_{j=0}^{K-1} p_j(t) M_j(t)}$$\n\nNext, we establish the dynamics for the motif intactness, $M_i(t)$. The fraction of intact motifs of type $i$ changes due to two competing processes: erosion and restoration.\n1.  **Erosion:** Intact motifs of type $i$ are destroyed (eroded) by gene conversion events at a rate proportional to the frequency of the PRDM9 allele $i$ that binds them. The loss in $M_i(t)$ per generation from this process is $e \\cdot p_i(t) \\cdot M_i(t)$, where $e > 0$ is the erosion constant.\n2.  **Restoration:** Non-intact motifs, which constitute a fraction $1 - M_i(t)$ of the total potential sites for motif $i$, can be restored to an intact state by point mutations. This occurs at a constant rate $\\mu \\ge 0$, contributing an increase of $\\mu (1 - M_i(t))$ to the fraction of intact motifs.\n\nCombining these two effects, the net change in $M_i(t)$ is:\n$$\\Delta M_i(t) = \\mu (1 - M_i(t)) - e \\cdot p_i(t) \\cdot M_i(t)$$\nThis leads to the following update rule for $M_i(t+1)$:\n$$M_i(t+1) = M_i(t) + \\mu(1 - M_i(t)) - e \\cdot p_i(t) \\cdot M_i(t)$$\nRearranging for computational implementation gives:\n$$M_i(t+1) = M_i(t) (1 - \\mu - e \\cdot p_i(t)) + \\mu$$\nNote that the erosion term $e \\cdot p_i(t) \\cdot M_i(t)$ uses the allele frequency from generation $t$, $p_i(t)$, to determine the state of the motifs in generation $t+1$. Per the problem specification, the value of $M_i(t+1)$ must be constrained to the interval $[0, 1]$. We will enforce this by clamping the calculated value.\n\nThe simulation proceeds by iteratively applying these update rules for $T$ generations, starting from initial conditions $\\mathbf{p}(0)$ and $\\mathbf{M}(0)$.\n\nThe algorithm for a single simulation is as follows:\n1.  Initialize state vectors `p` and `M` with the provided initial conditions $\\mathbf{p}(0)$ and $\\mathbf{M}(0)$.\n2.  Initialize `turnover_count = 0` and determine the initial dominant allele index, `dominant_idx_prev = argmax(p)`. The `argmax` function inherently resolves ties by selecting the lowest index.\n3.  Iterate for $t$ from $0$ to $T-1$:\n    a. Store the current state vectors `p` and `M` as `p_prev` and `M_prev`.\n    b. Calculate allele fitnesses: $w_i = 1 + s M_{\\text{prev}, i}$ for all $i$.\n    c. Calculate mean fitness: $\\bar{w} = \\sum_j p_{\\text{prev}, j} w_j$.\n    d. Update allele frequencies: $p_i = p_{\\text{prev}, i} \\cdot w_i / \\bar{w}$.\n    e. Update motif intactness: $M_i = M_{\\text{prev}, i} \\cdot (1 - \\mu - e \\cdot p_{\\text{prev}, i}) + \\mu$.\n    f. Clamp motif intactness: $M_i = \\max(0, \\min(1, M_i))$.\n    g. Determine the new dominant allele index: `dominant_idx_curr = argmax(p)`.\n    h. If `dominant_idx_curr` is not equal to `dominant_idx_prev`, increment `turnover_count`.\n    i. Update `dominant_idx_prev = dominant_idx_curr`.\n4.  After the loop finishes, the final state is represented by `p` and `M` (at generation $T$), and the penultimate state by `p_prev` and `M_prev` (at generation $T-1$).\n5.  Compute the required summary metrics:\n    -   **Turnover count**: The final value of `turnover_count`.\n    -   **Convergence flag**: Calculate the maximum absolute change $\\Delta(T) = \\max(\\max_i |p_i - p_{\\text{prev}, i}|, \\max_i |M_i - M_{\\text{prev}, i}|)$. The flag is `True` if $\\Delta(T) \\le 10^{-10}$, and `False` otherwise.\n    -   **Final dominant index**: The final value of `dominant_idx_curr`.\n6.  Return these three metrics in a list.\n\nThis procedure is deterministic and will be applied to each test case specified in the problem. The use of vectorized operations with `NumPy` is highly recommended for an efficient and clear implementation.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulations for all test cases and print the results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (general cycling regime)\n        {\n            \"K\": 3, \"T\": 600, \"s\": 0.2, \"e\": 0.8, \"mu\": 0.01,\n            \"p0\": np.array([0.34, 0.33, 0.33]), \"M0\": np.array([1.0, 1.0, 1.0])\n        },\n        # Case B (no erosion boundary)\n        {\n            \"K\": 3, \"T\": 300, \"s\": 0.2, \"e\": 0.0, \"mu\": 0.01,\n            \"p0\": np.array([1/3, 1/3, 1/3]), \"M0\": np.array([1.0, 1.0, 1.0])\n        },\n        # Case C (two-allele interaction)\n        {\n            \"K\": 2, \"T\": 800, \"s\": 0.3, \"e\": 0.9, \"mu\": 0.02,\n            \"p0\": np.array([0.5, 0.5]), \"M0\": np.array([1.0, 1.0])\n        },\n        # Case D (strong motif restoration)\n        {\n            \"K\": 3, \"T\": 1200, \"s\": 0.15, \"e\": 0.9, \"mu\": 0.2,\n            \"p0\": np.array([0.34, 0.33, 0.33]), \"M0\": np.array([1.0, 1.0, 1.0])\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = run_simulation(params)\n        all_results.append(result)\n\n    # Format the final output as specified.\n    # e.g., [[3,False,2],[0,True,0],[7,False,1],[1,True,0]]\n    output_str = \"[\" + \",\".join(map(str, all_results)) + \"]\"\n    print(output_str)\n\ndef run_simulation(params):\n    \"\"\"\n    Executes the PRDM9 dynamics model for a single set of parameters.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the simulation:\n                       K, T, s, e, mu, p0, M0.\n\n    Returns:\n        list: A list containing [turnover_count, converged, final_dominant_index].\n    \"\"\"\n    T = params[\"T\"]\n    s = params[\"s\"]\n    e = params[\"e\"]\n    mu = params[\"mu\"]\n\n    p = params[\"p0\"].copy()\n    M = params[\"M0\"].copy()\n\n    # Metrics Initialization\n    turnover_count = 0\n    # numpy.argmax resolves ties by choosing the smallest index.\n    dominant_idx_prev = np.argmax(p)\n    \n    p_prev, M_prev = None, None\n\n    # Simulation loop from t=0 to T-1\n    for _ in range(T):\n        p_prev = p.copy()\n        M_prev = M.copy()\n\n        # 1. Calculate fitnesses and mean fitness\n        w = 1.0 + s * M_prev\n        w_bar = np.sum(p_prev * w)\n\n        # 2. Update allele frequencies\n        if w_bar > 0:\n            p = p_prev * w / w_bar\n        # else: p remains unchanged if w_bar is zero, which is unlikely given w_i >= 1.\n\n        # 3. Update motif intactness\n        M_raw = M_prev * (1.0 - mu - e * p_prev) + mu\n        # 4. Clamp motif intactness to [0, 1]\n        M = np.clip(M_raw, 0.0, 1.0)\n        \n        # 5. Update turnover count\n        dominant_idx_curr = np.argmax(p)\n        if dominant_idx_curr != dominant_idx_prev:\n            turnover_count += 1\n        dominant_idx_prev = dominant_idx_curr\n\n    # Final state is (p, M), previous state is (p_prev, M_prev)\n    \n    # Calculate final metrics\n    final_dominant_index = np.argmax(p)\n\n    # Convergence check\n    max_p_change = np.max(np.abs(p - p_prev))\n    max_M_change = np.max(np.abs(M - M_prev))\n    delta_T = np.max([max_p_change, max_M_change])\n    converged = delta_T <= 1e-10\n\n    return [turnover_count, bool(converged), int(final_dominant_index)]\n\n\nsolve()\n```", "id": "2748045"}, {"introduction": "This final practice explores the profound macroevolutionary consequences of PRDM9's rapid evolution: its role as a \"speciation gene\". You will construct a two-deme model to simulate how independent PRDM9 divergence in isolated or semi-isolated populations can lead to the formation of reproductive barriers [@problem_id:2748049]. By modeling the coevolution of PRDM9 alleles and their target sites under migration, you will quantify the emergence of hybrid incompatibilities, directly linking a specific molecular evolutionary process to the origin of species.", "problem": "Consider two large, randomly mating demes (deme 1 and deme 2) connected by symmetric migration at rate $m \\in [0,1/2]$ per generation in a deterministic, discrete-time, infinite-population model. A single diploid locus encodes the PR domain-containing protein 9 (PRDM9), which specifies binding to DNA motifs that recruit Double-Strand Breaks (DSBs) during meiosis. There are two PRDM9 alleles, denoted $A$ and $B$, which preferentially bind distinct motif classes denoted $a$ and $b$, respectively. Let $p_i \\in [0,1]$ be the frequency of allele $A$ in deme $i \\in \\{1,2\\}$, and $q_i = 1 - p_i$ the frequency of allele $B$. Let $t_a^i \\in [0,1]$ and $t_b^i \\in [0,1]$ denote the fractions of active, intact $a$- and $b$-class binding targets in the genome of individuals in deme $i$. \n\nBinding target fractions evolve due to two opposing forces each generation: erosion by biased gene conversion at bound hotspots, and replenishment by mutation/turnover. Erosion is proportional to the dosage of the matching PRDM9 allele: in deme $i$, the population-average dosage of allele $A$ is approximated by $p_i$ and of $B$ by $q_i$. Let $d \\in [0,1]$ be the per-generation erosion coefficient and $u \\in [0,1]$ the per-generation replenishment rate. The per-generation updates for target availability in deme $i$ are:\n$$\nt_a^{i,\\text{next}} = t_a^i \\, (1 - d \\, p_i) + u \\, (1 - t_a^i), \\quad\nt_b^{i,\\text{next}} = t_b^i \\, (1 - d \\, q_i) + u \\, (1 - t_b^i).\n$$\n\nFertility depends on the match between PRDM9 genotype and available targets within the deme. Let $s \\ge 0$ quantify the fertility gain per unit of matched target. For deme $i$, genotype fertilities are:\n$$\nW_{AA}^i = 1 + s \\, t_a^i, \\quad\nW_{AB}^i = 1 + \\frac{s}{2} \\left(t_a^i + t_b^i\\right), \\quad\nW_{BB}^i = 1 + s \\, t_b^i.\n$$\nAssume random mating and Hardy–Weinberg genotype frequencies within each deme before selection. Let $f_{AA}^i = p_i^2$, $f_{AB}^i = 2 p_i q_i$, and $f_{BB}^i = q_i^2$. After fertility selection in deme $i$, the mean fertility is\n$$\n\\overline{W}_i = f_{AA}^i \\, W_{AA}^i + f_{AB}^i \\, W_{AB}^i + f_{BB}^i \\, W_{BB}^i,\n$$\nand the frequency of allele $A$ updates to\n$$\np_i^{\\text{post-sel}} = \\frac{p_i^2 \\, W_{AA}^i + p_i q_i \\, W_{AB}^i}{\\overline{W}_i}.\n$$\n\nAssume adult migration occurs before selection and meiosis. Symmetric migration at rate $m$ mixes the two demes for every population-level state variable $x \\in \\{p, t_a, t_b\\}$ via\n$$\nx_1 \\leftarrow (1 - m) \\, x_1 + m \\, x_2, \\quad\nx_2 \\leftarrow (1 - m) \\, x_2 + m \\, x_1^{\\text{old}},\n$$\nwhere $x_1^{\\text{old}}$ denotes the value of $x_1$ before the update to $x_1$ in this migration step, ensuring the two demes are mixed symmetrically from their pre-migration values.\n\nLifecycle per generation:\n1. Migration: apply the migration update to $p_i$, $t_a^i$, and $t_b^i$ in both demes.\n2. Selection: update $p_i$ to $p_i^{\\text{post-sel}}$ using the genotype fertilities defined above.\n3. Erosion and replenishment: update $t_a^i$ and $t_b^i$ using the erosion–replenishment equations.\n\nDefine an inter-deme hybrid fertility metric at equilibrium as follows. Consider F1 hybrids formed by random mating between the two demes at equilibrium. The F1 genotype frequencies are \n$$\nF_{AA} = p_1 p_2, \\quad\nF_{AB} = p_1 q_2 + q_1 p_2, \\quad\nF_{BB} = q_1 q_2.\n$$\nAssume the effective target landscape experienced in F1 meiosis is the average of parental demes:\n$$\nt_a^{\\text{F1}} = \\frac{t_a^1 + t_a^2}{2}, \\quad\nt_b^{\\text{F1}} = \\frac{t_b^1 + t_b^2}{2}.\n$$\nHence the F1 genotype fertilities are\n$$\nW_{AA}^{\\text{F1}} = 1 + s \\, t_a^{\\text{F1}}, \\quad\nW_{AB}^{\\text{F1}} = 1 + \\frac{s}{2}\\left(t_a^{\\text{F1}} + t_b^{\\text{F1}}\\right), \\quad\nW_{BB}^{\\text{F1}} = 1 + s \\, t_b^{\\text{F1}}.\n$$\nThe mean F1 hybrid fertility is\n$$\n\\overline{W}_{\\text{hyb}} = F_{AA} \\, W_{AA}^{\\text{F1}} + F_{AB} \\, W_{AB}^{\\text{F1}} + F_{BB} \\, W_{BB}^{\\text{F1}}.\n$$\nDefine the baseline within-deme mean fertility as the average across demes at equilibrium:\n$$\n\\overline{W}_{\\text{within}} = \\frac{\\overline{W}_1 + \\overline{W}_2}{2}.\n$$\nDefine the reproductive isolation measure (dimensionless) as\n$$\nR = 1 - \\frac{\\overline{W}_{\\text{hyb}}}{\\overline{W}_{\\text{within}}}.\n$$\nNote that $R$ can be negative if F1 hybrids are more fertile than the within-deme baseline.\n\nYour task is to implement a program that, for each parameter set in the test suite below, performs the following:\n- Initialize $(p_1, t_a^1, t_b^1, p_2, t_a^2, t_b^2)$ to the provided initial values.\n- Iterate the lifecycle (migration, selection, erosion–replenishment) until convergence, defined as the maximum absolute change across all six state variables between successive generations dropping below $10^{-12}$, or until a maximum of $200{,}000$ generations is reached; if the maximum is reached without meeting the tolerance, use the final iterate as the approximate equilibrium.\n- Compute $R$ at the resulting equilibrium using the equations above.\n- Output the $R$ value rounded to $6$ decimal places.\n\nNo physical units apply in this model; all quantities are dimensionless. Angles are not used. Percentages, if any appear conceptually, must be represented as decimals, which is already satisfied by using real numbers in $[0,1]$.\n\nTest suite (each test case is a tuple ordered as $(m, s, d, u, p_1^{(0)}, t_a^{1,(0)}, t_b^{1,(0)}, p_2^{(0)}, t_a^{2,(0)}, t_b^{2,(0)})$):\n- Case 1 (low migration, divergent start): $(0.01, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9)$\n- Case 2 (high migration, homogenization expected): $(0.30, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9)$\n- Case 3 (no migration, independent divergence): $(0.00, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9)$\n- Case 4 (no erosion, no hotspot paradox): $(0.05, 0.2, 0.0, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9)$\n\nFinal output format:\nYour program should produce a single line of output containing the $R$ values for the four cases, as a comma-separated list enclosed in square brackets, with each value rounded to $6$ decimal places (e.g., \"[0.123456,0.000000,-0.010000,0.543210]\").", "solution": "The problem presented is a deterministic model of coevolution between a PRDM9 locus and its binding targets, situated within a population genetics framework. The task is to determine the equilibrium state of a two-deme system and compute a measure of reproductive isolation. This problem is scientifically grounded, well-posed, and contains all necessary information for a unique solution to be computed. The model is a discrete-time dynamical system, for which we seek a stable fixed point.\n\nLet the state of the system at generation $k$ be represented by a vector in $\\mathbb{R}^6$,\n$$ X_k = (p_1^{(k)}, t_a^{1,(k)}, t_b^{1,(k)}, p_2^{(k)}, t_a^{2,(k)}, t_b^{2,(k)})^T $$\nwhere $p_i^{(k)}$ is the frequency of PRDM9 allele $A$ in deme $i$, and $t_a^{i,(k)}, t_b^{i,(k)}$ are the fractions of available binding targets of classes $a$ and $b$, respectively, in deme $i$. The evolution of the system from one generation to the next, $X_{k+1} = F(X_k)$, is governed by a sequence of deterministic operations: migration, selection, and target erosion/replenishment.\n\nThe per-generation update is performed in three distinct steps as follows.\nLet the state at the beginning of a generation be $X = (p_1, t_a^1, t_b^1, p_2, t_a^2, t_b^2)$.\n\nStep 1: Migration.\nAll state variables undergo symmetric migration at rate $m$. Let the post-migration state be $X' = (p'_1, t'_a{}^1, t'_b{}^1, p'_2, t'_a{}^2, t'_b{}^2)$. For any state variable $x \\in \\{p, t_a, t_b\\}$, the update is:\n$$ x'_1 = (1 - m) \\, x_1 + m \\, x_2 $$\n$$ x'_2 = (1 - m) \\, x_2 + m \\, x_1 $$\nThis step models the movement of adult individuals between the two demes before reproduction.\n\nStep 2: Selection.\nFertility selection acts on the post-migration allele frequencies $p'_i$. The mean fertility in deme $i$ can be simplified from the given expression to:\n$$ \\overline{W}_i = 1 + s(p'_i t'_a{}^i + q'_i t'_b{}^i) $$\nwhere $q'_i = 1 - p'_i$. The allele frequency of $A$ after selection, $p_i^{\\text{post-sel}}$, is updated according to the standard formula for diploid selection, which is explicitly given in the problem statement:\n$$ p_i^{\\text{post-sel}} = \\frac{{p'_i}^2 \\, W_{AA}^i + p'_i q'_i \\, W_{AB}^i}{\\overline{W}_i} $$\nwhere the genotype fertilities $W_{XX}^i$ use the post-migration target fractions $t'_a{}^i$ and $t'_b{}^i$.\n\nStep 3: Erosion and Replenishment.\nThe binding target fractions for the next generation are updated based on the post-migration state variables. The equations are:\n$$ t_a^{i,\\text{next}} = t'_a{}^i (1 - d \\cdot p'_i) + u (1 - t'_a{}^i) $$\n$$ t_b^{i,\\text{next}} = t'_b{}^i (1 - d \\cdot q'_i) + u (1 - t'_b{}^i) $$\n\nThe problem requires finding the fixed point $X^*$ of this system of equations, where $X^* = F(X^*)$. This is achieved numerically by iterating the map $F$ starting from a given initial condition $X_0$ until the change between successive states, $\\|X_{k+1} - X_k\\|_\\infty$, falls below a specified tolerance of $10^{-12}$.\n\nOnce the equilibrium state $X^* = (p_1^*, t_a^{1,*}, t_b^{1,*}, p_2^*, t_a^{2,*}, t_b^{2,*})$ is found, the reproductive isolation measure $R$ is computed. The necessary components are the mean within-deme fitness, $\\overline{W}_{\\text{within}}$, and the mean F1 hybrid fitness, $\\overline{W}_{\\text{hyb}}$.\n\nThe mean within-deme fitness at equilibrium is the average of the mean fertilities of the two demes:\n$$ \\overline{W}_{\\text{within}} = \\frac{\\overline{W}_1^* + \\overline{W}_2^*}{2} = \\frac{1}{2} \\left[ (1 + s(p_1^* t_a^{1,*} + q_1^* t_b^{1,*})) + (1 + s(p_2^* t_a^{2,*} + q_2^* t_b^{2,*})) \\right] $$\n\nThe mean F1 hybrid fertility, $\\overline{W}_{\\text{hyb}}$, can also be expressed in a simplified form. By averaging parental allele frequencies ($p_{\\text{F1}} = (p_1^*+p_2^*)/2$) and target landscapes ($t_{a/b}^{\\text{F1}} = (t_a^{1,*}+t_a^{2,*})/2$), the mean hybrid fitness is:\n$$ \\overline{W}_{\\text{hyb}} = 1 + s \\left[ \\left(\\frac{p_1^*+p_2^*}{2}\\right) \\left(\\frac{t_a^{1,*} + t_a^{2,*}}{2}\\right) + \\left(\\frac{q_1^*+q_2^*}{2}\\right) \\left(\\frac{t_b^{1,*} + t_b^{2,*}}{2}\\right) \\right] $$\n\nFinally, the reproductive isolation $R$ is calculated as:\n$$ R = 1 - \\frac{\\overline{W}_{\\text{hyb}}}{\\overline{W}_{\\text{within}}} $$\n\nThe implementation involves a numerical simulation that iteratively applies these update equations for each test case until convergence is reached. The state variables are managed using NumPy arrays for efficient vector operations.", "answer": "```python\nimport numpy as np\n\ndef compute_R_for_case(params):\n    \"\"\"\n    Simulates the PRDM9 model for a single parameter set and computes reproductive isolation R.\n    \"\"\"\n    # Unpack parameters and initial conditions\n    m, s, d, u, p1, ta1, tb1, p2, ta2, tb2 = params\n    \n    # State vector: (p1, ta1, tb1, p2, ta2, tb2)\n    state = np.array([p1, ta1, tb1, p2, ta2, tb2], dtype=np.float64)\n    \n    # Simulation parameters\n    max_generations = 200000\n    tolerance = 1e-12\n\n    for _ in range(max_generations):\n        old_state = state.copy()\n        p1_t, ta1_t, tb1_t, p2_t, ta2_t, tb2_t = old_state\n        \n        # --- Lifecycle Step 1: Migration ---\n        # Migration applies to all state variables.\n        p1_mig = (1 - m) * p1_t + m * p2_t\n        p2_mig = (1 - m) * p2_t + m * p1_t\n        ta1_mig = (1 - m) * ta1_t + m * ta2_t\n        ta2_mig = (1 - m) * ta2_t + m * ta1_t\n        tb1_mig = (1 - m) * tb1_t + m * tb2_t\n        tb2_mig = (1 - m) * tb2_t + m * tb1_t\n\n        # --- Lifecycle Step 2: Selection ---\n        # This step updates allele frequencies for the next generation.\n        # It uses the post-migration state.\n        \n        # Deme 1\n        q1_mig = 1.0 - p1_mig\n        W_bar1 = 1.0 + s * (p1_mig * ta1_mig + q1_mig * tb1_mig)\n        # Correctly implement p_post-sel = (p^2 * W_AA + p*q * W_AB) / W_bar\n        W_AA1 = 1.0 + s * ta1_mig\n        W_AB1 = 1.0 + s/2.0 * (ta1_mig + tb1_mig)\n        p1_numerator = p1_mig**2 * W_AA1 + p1_mig * q1_mig * W_AB1\n        p1_next = p1_numerator / W_bar1\n\n        # Deme 2\n        q2_mig = 1.0 - p2_mig\n        W_bar2 = 1.0 + s * (p2_mig * ta2_mig + q2_mig * tb2_mig)\n        W_AA2 = 1.0 + s * ta2_mig\n        W_AB2 = 1.0 + s/2.0 * (ta2_mig + tb2_mig)\n        p2_numerator = p2_mig**2 * W_AA2 + p2_mig * q2_mig * W_AB2\n        p2_next = p2_numerator / W_bar2\n        \n        # --- Lifecycle Step 3: Erosion and Replenishment ---\n        # This step updates target landscapes for the next generation.\n        # It also uses the post-migration state.\n        ta1_next = ta1_mig * (1.0 - d * p1_mig) + u * (1.0 - ta1_mig)\n        tb1_next = tb1_mig * (1.0 - d * q1_mig) + u * (1.0 - tb1_mig)\n        ta2_next = ta2_mig * (1.0 - d * p2_mig) + u * (1.0 - ta2_mig)\n        tb2_next = tb2_mig * (1.0 - d * q2_mig) + u * (1.0 - tb2_mig)\n        \n        state = np.array([p1_next, ta1_next, tb1_next, p2_next, ta2_next, tb2_next])\n\n        # Check for convergence\n        if np.max(np.abs(state - old_state)) < tolerance:\n            break\n\n    # --- Calculation of R at Equilibrium ---\n    p1_eq, ta1_eq, tb1_eq, p2_eq, ta2_eq, tb2_eq = state\n    q1_eq = 1.0 - p1_eq\n    q2_eq = 1.0 - p2_eq\n\n    # Baseline within-deme mean fertility\n    W_bar1_eq = 1.0 + s * (p1_eq * ta1_eq + q1_eq * tb1_eq)\n    W_bar2_eq = 1.0 + s * (p2_eq * ta2_eq + q2_eq * tb2_eq)\n    W_bar_within = (W_bar1_eq + W_bar2_eq) / 2.0\n\n    # Mean F1 hybrid fertility\n    p_F1 = (p1_eq + p2_eq) / 2.0\n    q_F1 = 1.0 - p_F1\n    ta_F1 = (ta1_eq + ta2_eq) / 2.0\n    tb_F1 = (tb1_eq + tb2_eq) / 2.0\n    W_bar_hyb = 1.0 + s * (p_F1 * ta_F1 + q_F1 * tb_F1)\n    \n    # Reproductive Isolation R\n    # The denominator W_bar_within is >= 1, so no division by zero is expected.\n    R = 1.0 - W_bar_hyb / W_bar_within\n    \n    return R\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Test suite format: (m, s, d, u, p1_0, ta1_0, tb1_0, p2_0, ta2_0, tb2_0)\n    test_cases = [\n        (0.01, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9),\n        (0.30, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9),\n        (0.00, 0.2, 0.1, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9),\n        (0.05, 0.2, 0.0, 0.001, 0.9, 0.9, 0.5, 0.1, 0.5, 0.9),\n    ]\n\n    results = []\n    for case in test_cases:\n        r_value = compute_R_for_case(case)\n        results.append(r_value)\n\n    # Format the results as specified\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2748049"}]}