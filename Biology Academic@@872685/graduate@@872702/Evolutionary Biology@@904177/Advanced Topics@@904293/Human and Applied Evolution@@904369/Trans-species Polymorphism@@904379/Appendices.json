{"hands_on_practices": [{"introduction": "The defining feature of a trans-species polymorphism is that the allelic lineages are older than the species in which they reside. A foundational step in identifying candidate TSP is therefore to estimate the age of the alleles and compare it to the species divergence time. This exercise provides hands-on practice with this core concept, guiding you to calculate the time to the most recent common ancestor ($T_{\\text{allele}}$) for a pair of allelic clades from sequence divergence data and determine if it predates speciation [@problem_id:2759487].", "problem": "Two sister species, $\\mathrm{S_1}$ and $\\mathrm{S_2}$, diverged $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$ years ago. At a single nonrecombining locus that putatively experiences balancing selection, haplotypes sampled from both species form two deep allelic clades that are shared across species. Let the observed raw divergence between the consensus haplotypes representing these two allelic clades be $d = 0.015$ differences per site (that is, the proportion of nucleotide sites at which the clade representatives differ). Assume the per-site, per-generation mutation rate is $\\mu = 1.2 \\times 10^{-8}$, the Jukes–Cantor model of nucleotide substitution applies, and the generation time is $g = 6$ years per generation. \n\nStarting from appropriate first principles of the neutral coalescent with point mutation and a finite-sites correction consistent with the Jukes–Cantor model, estimate the allelic time to the most recent common ancestor (time to the most recent common ancestor (TMRCA)) in years from the observed $d$, and then compare it to the species divergence time by computing the ratio\n$$\nR \\equiv \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}.\n$$\nA value $R > 1$ would be consistent with a trans-species polymorphism. \n\nWhat is the numerical value of $R$? Express your final answer as a pure number (unitless) and round your answer to four significant figures.", "solution": "The problem requires the calculation of the ratio $R \\equiv \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}$, where $T_{\\mathrm{allele}}$ is the time to the most recent common ancestor (TMRCA) of two allelic clades and $T_{\\mathrm{spec}}$ is the species divergence time. This is a standard procedure in molecular evolution to test for trans-species polymorphism.\n\nFirst, a validation of the problem statement is necessary.\nThe provided givens are:\nSpecies divergence time, $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$ years.\nObserved raw divergence (proportion of differing sites), $d = 0.015$.\nPer-site, per-generation mutation rate, $\\mu = 1.2 \\times 10^{-8}$.\nGeneration time, $g = 6$ years.\nThe problem employs the Jukes–Cantor model for substitution correction.\nThe problem is scientifically grounded, well-posed, and objective. It provides all necessary parameters and uses established models from evolutionary genetics. The values are physically and biologically plausible. Therefore, the problem is valid, and we may proceed to the solution.\n\nThe first step is to convert the observed raw divergence, $d$, into an estimate of the expected number of substitutions per site, $K$. The raw divergence $d$ underestimates the true genetic distance because multiple substitution events at the same nucleotide site are not directly observed. The Jukes–Cantor model provides a correction for these multiple hits. The formula is:\n$$K = -\\frac{3}{4} \\ln \\left(1 - \\frac{4}{3}d\\right)$$\nSubstituting the given value $d = 0.015$:\n$$K = -\\frac{3}{4} \\ln \\left(1 - \\frac{4}{3}(0.015)\\right) = -\\frac{3}{4} \\ln (1 - 0.02) = -\\frac{3}{4} \\ln (0.98)$$\n\nThe second step is to relate this genetic distance $K$ to the divergence time. According to the molecular clock hypothesis, the expected number of substitutions per site between two homologous sequences is given by $K = 2 \\mu t$, where $\\mu$ is the mutation rate per site per generation and $t$ is the number of generations since the most recent common ancestor. The factor of $2$ accounts for the fact that mutations accumulate independently along the two lineages diverging from the ancestor. In our case, $t$ corresponds to the allelic TMRCA in generations, which we denote as $t_{\\mathrm{allele}}$.\n$$K = 2 \\mu t_{\\mathrm{allele}}$$\nWe can solve for $t_{\\mathrm{allele}}$:\n$$t_{\\mathrm{allele}} = \\frac{K}{2\\mu}$$\nThe problem requires the time in years, $T_{\\mathrm{allele}}$. This is obtained by multiplying the time in generations by the generation time, $g$:\n$$T_{\\mathrm{allele}} = t_{\\mathrm{allele}} \\cdot g = \\frac{Kg}{2\\mu}$$\n\nNow, we substitute the expression for $K$ derived from the Jukes-Cantor model into the equation for $T_{\\mathrm{allele}}$:\n$$T_{\\mathrm{allele}} = \\frac{\\left(-\\frac{3}{4} \\ln(0.98)\\right) g}{2\\mu}$$\nSubstituting the given numerical values for $g$ and $\\mu$:\n$$T_{\\mathrm{allele}} = \\frac{-\\frac{3}{4} \\ln(0.98) \\cdot 6}{2 \\cdot (1.2 \\times 10^{-8})} = \\frac{-4.5 \\ln(0.98)}{2.4 \\times 10^{-8}}$$\n\nThe final step is to compute the required ratio, $R$:\n$$R = \\frac{T_{\\mathrm{allele}}}{T_{\\mathrm{spec}}}$$\nSubstituting the expressions for $T_{\\mathrm{allele}}$ and the given value for $T_{\\mathrm{spec}} = 2.5 \\times 10^{6}$:\n$$R = \\frac{\\frac{-4.5 \\ln(0.98)}{2.4 \\times 10^{-8}}}{2.5 \\times 10^{6}} = \\frac{-4.5 \\ln(0.98)}{(2.4 \\times 10^{-8}) \\cdot (2.5 \\times 10^{6})}$$\nWe simplify the denominator:\n$$(2.4 \\times 10^{-8}) \\cdot (2.5 \\times 10^{6}) = (2.4 \\cdot 2.5) \\times 10^{-8+6} = 6.0 \\times 10^{-2} = 0.06$$\nThus, the expression for $R$ is:\n$$R = \\frac{-4.5 \\ln(0.98)}{0.06}$$\nNow, we compute the numerical value.\nThe natural logarithm of $0.98$ is approximately $\\ln(0.98) \\approx -0.0202027$.\n$$R \\approx \\frac{-4.5 \\times (-0.0202027)}{0.06} \\approx \\frac{0.09091215}{0.06} \\approx 1.5152025$$\nRounding the result to four significant figures, as required by the problem statement, we obtain:\n$$R \\approx 1.515$$\nThis value, being greater than $1$, indicates that the estimated divergence time of the alleles predates the divergence of the species, which is consistent with the alleles being a trans-species polymorphism.", "answer": "$$\\boxed{1.515}$$", "id": "2759487"}, {"introduction": "While an ancient allele age is a necessary criterion for trans-species polymorphism, it is not sufficient, as post-speciation gene flow (introgression) can create similar patterns of shared alleles. Distinguishing between these scenarios requires a careful synthesis of multiple lines of genomic evidence. This problem challenges you to evaluate a realistic dataset and formulate a rigorous decision rule, integrating information from site-pattern statistics like the $D$-statistic, local gene-tree topologies, and coalescent time estimates to build a robust case for either TSP or introgression [@problem_id:2759485].", "problem": "A four-taxon test is set up to investigate whether a shared functional allele observed in two sister species reflects trans-species polymorphism (ancient balanced polymorphism maintained across a speciation event) or introgression (post-speciation gene flow). The taxa are arranged as follows: species with the shared allele are $P_1$ and $P_2$, a more distant relative is $P_3$, and the outgroup is $O$. Independent lines of evidence are collected in a genomic region surrounding the focal site:\n\n1. Genome-wide background: sliding-window tests yield $D(P_1,P_2,P_3,O)$ with mean approximately $0$ and $|Z| < 1.5$ across most windows; $f_4$-ratio estimates of admixture between $P_1$ and $P_2$ are near $0$ with narrow confidence intervals.\n\n2. Local signals near the focal site: within a $2$ kilobase window centered at the focal polymorphism there are $n = 35$ informative sites with an estimated $D \\approx 0.06$ and standard error $\\approx 0.07$ ($Z \\approx 0.86$). In the immediately flanking $50$ kilobase windows on either side, $D \\approx 0.00 \\pm 0.01$ and $f_4$-ratio admixture estimates $\\hat{\\alpha} \\approx 0.00$ with $95\\%$ confidence intervals roughly $[-0.02, 0.02]$.\n\n3. Gene-tree topologies: in the $500$ base-pair segment containing the focal polymorphism, haplotypes cluster by allele state across species (all $P_1$ and $P_2$ haplotypes carrying allele $A$ cluster together, and all $P_1$ and $P_2$ haplotypes carrying allele $B$ cluster together). In the adjacent $10$ kilobase flanks, genealogies match the species tree, with $P_1$ monophyletic and $P_2$ monophyletic.\n\n4. Temporal and haplotype-length evidence: the time to the most recent common ancestor for the two long-lived allelic clades at the focal site is estimated as $T_{\\text{MRCA}} \\approx 3.2$ million years with a $95\\%$ confidence interval $[2.5, 3.9]$ million years, while the $P_1$–$P_2$ species split is dated to $T_S \\approx 1.1$ million years with a $95\\%$ confidence interval $[0.9, 1.3]$ million years. Mean identical-by-state tracts shared between $P_1$ and $P_2$ carriers of the same allele across the focal region are short (approximately $0.3$ kilobases), with no extended shared haplotypes.\n\nFrom first principles, formulate a decision rule that uses site-pattern statistics (e.g., $D$-statistics or $f_4$ ratios) together with gene-tree topologies to reject introgression in favor of trans-species polymorphism for the shared allele under these data. Which option below most rigorously captures such a rule?\n\nA. Reject introgression in favor of trans-species polymorphism if, in recombination-delimited windows flanking the focal site, $D$ and $f_4$-ratio estimates testing $P_1$–$P_2$ gene flow are not significantly different from $0$, the focal-site genealogy groups haplotypes by allele state across species while adjacent flanks recover the species tree, and $T_{\\text{MRCA}}$ for allelic clades exceeds $T_S$. Under these joint conditions, infer an ancient balanced polymorphism rather than introgression.\n\nB. Reject introgression in favor of trans-species polymorphism whenever any window spanning the focal site yields a non-zero $D$, regardless of sign, magnitude, or statistical significance, because any deviation from $0$ is incompatible with the null of no gene flow.\n\nC. Reject introgression in favor of trans-species polymorphism whenever the local gene tree at the focal site mixes $P_1$ and $P_2$ haplotypes, even if flanking $D$ is significantly non-zero, because mixture of species within a clade necessarily reflects ancestral polymorphism.\n\nD. Reject introgression in favor of trans-species polymorphism only if $D$ is significantly non-zero with opposite signs on either side of the focal site, because sign flips in $D$ across flanks indicate that incomplete lineage sorting cannot explain the data.\n\nE. Reject introgression in favor of trans-species polymorphism when the $f_4$-ratio admixture estimate $\\hat{\\alpha}$ between $P_1$ and $P_2$ is significantly greater than $0$ specifically in the focal window, on the grounds that focal excess sharing must reflect an ancient polymorphism rather than recent gene flow.", "solution": "The problem statement must first be validated for scientific coherence and logical consistency.\n\n**Step 1: Extraction of Givens**\n\nThe problem provides the following data concerning a four-taxon system of species $P_1$, $P_2$, $P_3$, and an outgroup $O$, with a species tree topology of $((P_1, P_2), P_3), O)$. $P_1$ and $P_2$ are sister species sharing an allele. The investigation concerns whether this sharing is due to trans-species polymorphism (TSP) or introgression.\n\n1.  **Genome-wide Background**:\n    *   Sliding-window $D(P_1,P_2,P_3,O)$ has a mean of approximately $0$.\n    *   The Z-score magnitude $|Z|$ is less than $1.5$ for most windows.\n    *   $f_4$-ratio estimates of admixture between $P_1$ and $P_2$ are near $0$ with narrow confidence intervals.\n\n2.  **Local Signals**:\n    *   In a $2$ kilobase ($kb$) window centered at the focal polymorphism, there are $n = 35$ informative sites.\n    *   In this focal window, the estimated $D$-statistic is $D \\approx 0.06$ with a standard error of approximately $0.07$, yielding a Z-score of $Z \\approx 0.86$.\n    *   In the two flanking $50$ kilobase ($kb$) windows, $D \\approx 0.00 \\pm 0.01$.\n    *   In these same flanking windows, $f_4$-ratio admixture estimates are $\\hat{\\alpha} \\approx 0.00$ with a $95\\%$ confidence interval of approximately $[-0.02, 0.02]$.\n\n3.  **Gene-Tree Topologies**:\n    *   In a $500$ base-pair ($bp$) segment containing the focal site, haplotypes from $P_1$ and $P_2$ cluster by allele state (e.g., allele $A$ from both species forms a clade, and allele $B$ from both species forms another). This is a trans-specific genealogy.\n    *   In adjacent $10$ kilobase ($kb$) flanks, genealogies recover the species tree, with $P_1$ haplotypes forming a monophyletic group and $P_2$ haplotypes forming another.\n\n4.  **Temporal and Haplotype-Length Evidence**:\n    *   The time to the most recent common ancestor ($T_{\\text{MRCA}}$) for the two allelic clades is estimated at $T_{\\text{MRCA}} \\approx 3.2$ million years (Mya), with a $95\\%$ confidence interval of $[2.5, 3.9]$ Mya.\n    *   The species split time between $P_1$ and $P_2$ ($T_S$) is dated to $T_S \\approx 1.1$ Mya, with a $95\\%$ confidence interval of $[0.9, 1.3]$ Mya.\n    *   Mean identical-by-state (IBS) tracts shared between carriers of the same allele in $P_1$ and $P_2$ are short, approximately $0.3$ kilobases ($kb$).\n\n**Step 2: Validation of Problem Statement**\n\nThe problem is scientifically grounded. It presents a classic scenario in evolutionary genomics: distinguishing introgression from incomplete lineage sorting (ILS), specifically the case of long-term balancing selection leading to trans-species polymorphism. The methods cited—the $D$-statistic (ABBA-BABA test), $f_4$-ratio, gene-tree topological analysis, coalescence time estimation ($T_{\\text{MRCA}}$), and haplotype tract length analysis—are standard and appropriate for this question. The data provided are internally consistent and plausible. For example, the genome-wide background shows no evidence of large-scale gene flow, correctly focusing the problem on a localized genomic region. The local data present a clear contrast between the focal site and its flanks, which is the expected pattern for a localized evolutionary process. The temporal data ($T_{\\text{MRCA}} > T_S$) is a key piece of evidence. The problem is well-posed, objective, and contains sufficient information to formulate a rigorous scientific conclusion.\n\n**Verdict: The problem is valid.**\n\n**Derivation of the Solution**\n\nThe task is to formulate a decision rule to reject the hypothesis of introgression in favor of trans-species polymorphism, using the provided lines of evidence. We must analyze the expected signatures of each phenomenon from first principles.\n\n**Trans-Species Polymorphism (TSP)** arises when a polymorphism existing in an ancestral population is maintained by balancing selection across a speciation event. Its characteristic signatures are:\n1.  **Deep Coalescence**: The common ancestor of the polymorphic alleles ($T_{\\text{MRCA}}$) must predate the speciation event ($T_S$). Thus, a key signature is $T_{\\text{MRCA}} > T_S$.\n2.  **Localized Genealogical Discordance**: At the locus under selection, the gene tree will not match the species tree. Haplotypes will cluster by allele type, not by species. However, due to recombination, this discordant signal is confined to a very small region. In the flanking regions, genealogies should revert to the species tree topology.\n3.  **Absence of Introgression Signal in Flanks**: Since the pattern is not due to post-speciation gene flow, there should be no extended block of shared ancestry. Statistical tests for introgression like the $D$-statistic or $f_4$-ratio should yield non-significant results (i.e., values close to $0$) in the genomic regions flanking the selected locus.\n4.  **Short Shared Haplotypes**: The allelic lineages have been diverging for a long time (since before $T_S$). Recombination acting over this extended period will have broken down ancestral haplotypes, leaving only very short tracts of identity around the selected site itself.\n\n**Introgression** is the transfer of genetic material between species after they have diverged. Its signatures are:\n1.  **Recent Coalescence**: An introgressed allele would show a coalescence time between the donor and recipient lineages that is more recent than the species split time.\n2.  **Extended Block of Discordance**: Introgression transfers a block of DNA. While recombination breaks this block down over time, recent introgression will result in a relatively long shared haplotype and a correspondingly large genomic window where gene trees are discordant with the species tree.\n3.  **Significant Signal of Admixture**: The excess sharing of derived alleles resulting from introgression will produce a statistically significant non-zero $D$-statistic or $f_4$-ratio in the introgressed region and its immediate flanks, before recombination fully breaks down the linkage.\n\n**Applying these Principles to the Data**\nThe provided data align perfectly with the expectations for trans-species polymorphism and contradict the expectations for introgression.\n-   **Temporal Evidence**: $T_{\\text{MRCA}} \\approx 3.2$ Mya is significantly greater than $T_S \\approx 1.1$ Mya. This is the strongest evidence for TSP.\n-   **Genealogical Evidence**: The gene tree is trans-specific at the focal locus but matches the species tree in the flanks. This localizes the signal, as expected for TSP.\n-   **Admixture Statistics**: The $D$-statistic and $f_4$-ratio are approximately $0$ in the flanks, with tight confidence intervals. This provides strong evidence against an introgressed block of any substantial size. The non-significant $D$-statistic in the focal window itself ($Z \\approx 0.86$) further argues against introgression.\n-   **Haplotype Evidence**: The shared IBS tracts are very short ($\\approx 0.3$ kb), which is inconsistent with recent introgression and consistent with an ancient shared polymorphism eroded by recombination over millions of years.\n\nTherefore, a correct decision rule must integrate these observations. The rule for rejecting introgression in favor of TSP must require (1) a lack of statistical evidence for introgression in the genomic background surrounding the locus, (2) a switch in gene-tree topology from trans-specific at the locus to species-concordant in the flanks, and (3) a coalescence time for the alleles that significantly predates the species split.\n\n**Evaluation of Provided Options**\n\n**A. Reject introgression in favor of trans-species polymorphism if, in recombination-delimited windows flanking the focal site, $D$ and $f_4$-ratio estimates testing $P_1$–$P_2$ gene flow are not significantly different from $0$, the focal-site genealogy groups haplotypes by allele state across species while adjacent flanks recover the species tree, and $T_{\\text{MRCA}}$ for allelic clades exceeds $T_S$. Under these joint conditions, infer an ancient balanced polymorphism rather than introgression.**\nThis option correctly synthesizes the multiple, crucial lines of evidence. It requires the absence of a gene flow signal in the flanks ($D \\approx 0, f_4 \\approx 0$), the specific pattern of localized genealogical discordance, and the definitive temporal criterion ($T_{\\text{MRCA}} > T_S$). This is a comprehensive and scientifically rigorous rule.\n**Verdict: Correct.**\n\n**B. Reject introgression in favor of trans-species polymorphism whenever any window spanning the focal site yields a non-zero $D$, regardless of sign, magnitude, or statistical significance, because any deviation from $0$ is incompatible with the null of no gene flow.**\nThis option is fundamentally flawed. The $D$-statistic is a random variable; it is expected to deviate from $0$ due to stochasticity (e.g., ILS, sampling error). Scientific inference requires hypothesis testing to determine if the deviation is statistically significant. Ignoring statistical significance is an egregious error.\n**Verdict: Incorrect.**\n\n**C. Reject introgression in favor of trans-species polymorphism whenever the local gene tree at the focal site mixes $P_1$ and $P_2$ haplotypes, even if flanking $D$ is significantly non-zero, because mixture of species within a clade necessarily reflects ancestral polymorphism.**\nThis option commits two errors. First, a mixed (trans-specific) gene tree is characteristic of *both* TSP and introgression; it cannot distinguish between them alone. Second, the assertion that it reflects ancestral polymorphism \"even if flanking $D$ is significantly non-zero\" is precisely backward. A significant $D$-statistic in the flanks is strong evidence *for* introgression.\n**Verdict: Incorrect.**\n\n**D. Reject introgression in favor of trans-species polymorphism only if $D$ is significantly non-zero with opposite signs on either side of the focal site, because sign flips in $D$ across flanks indicate that incomplete lineage sorting cannot explain the data.**\nThis describes a specific, complex pattern that can sometimes arise under balancing selection but is not a necessary or universal signature. To posit this as the *only* condition (\"only if\") is far too restrictive. The more fundamental evidence, such as $T_{\\text{MRCA}} > T_S$ and null $D$ in flanks, is more general and powerful. This rule is not consistent with the provided data where flanking $D \\approx 0$.\n**Verdict: Incorrect.**\n\n**E. Reject introgression in favor of trans-species polymorphism when the $f_4$-ratio admixture estimate $\\hat{\\alpha}$ between $P_1$ and $P_2$ is significantly greater than $0$ specifically in the focal window, on the grounds that focal excess sharing must reflect an ancient polymorphism rather than recent gene flow.**\nThis option fundamentally misinterprets the statistic. A significant, positive admixture estimate ($\\hat{\\alpha} > 0$) is the canonical signal of excess allele sharing due to introgression. To claim this \"must reflect an ancient polymorphism\" is a direct contradiction of the statistic's purpose and standard interpretation.\n**Verdict: Incorrect.**\n\nBased on this analysis, only Option A formulates a scientifically correct and comprehensive decision rule based on the provided data and established principles of evolutionary genetics.", "answer": "$$\\boxed{A}$$", "id": "2759485"}, {"introduction": "Our ability to make evolutionary inferences is fundamentally dependent on the quality of our data and the methods used to process it. A common pitfall in genomics is reference bias, where reads carrying non-reference alleles fail to map correctly, leading to inaccurate estimates of allele frequencies. This practice delves into this critical issue, tasking you with using a simulation to quantify how such a bioinformatic artifact can generate false positives for trans-species polymorphism, thereby underscoring the importance of bias-aware analysis pipelines in evolutionary genomics [@problem_id:2759434].", "problem": "You are given a mathematical abstraction of a read-mapping pipeline designed to minimize reference bias at highly polymorphic loci to avoid spurious inference of trans-species polymorphism. Two species, indexed by $s \\in \\{1,2\\}$, are sampled at the same biallelic locus. For species $s$, the true alternate-allele frequency at the locus is $f_s \\in [0,1]$. Across loci, $f_1$ and $f_2$ are independent and each follows a Beta distribution with parameters $(a_s,b_s)$, written $f_s \\sim \\mathrm{Beta}(a_s,b_s)$, where $a_s>0$ and $b_s>0$. Reads have length $L$ in base pairs (bp), and the per-base divergence between species $s$ and the linear reference is $\\mu_s \\in [0,1]$. The alignment acceptance probability for a read with $m$ mismatches is modeled as $\\exp(-\\alpha m)$ for some penalty parameter $\\alpha \\ge 0$. Assume that for a read from species $s$, the expected background number of mismatches unrelated to the focal biallelic site is $L \\mu_s$. A read carrying the reference allele has no focal mismatch, while a read carrying the non-reference allele has an additional focal mismatch of exactly one.\n\nTwo mapping pipelines are considered:\n\n- Single-reference mapping (SR): A read carrying the alternate allele incurs the focal mismatch penalty, so its expected mismatch count is $L \\mu_s + 1$. A read carrying the reference allele has expected mismatch count $L \\mu_s$.\n\n- Bias-minimized mapping (BM): A variant-aware index (e.g., multiple-haplotype or graph-based) eliminates focal mismatch penalties by including both alleles locally, so both alleles have expected mismatch count $L \\mu_s$.\n\nAssume a very large read count so that read count ratios converge to their expectations. Under these assumptions, for species $s$, the expected observed fraction of alternate-allele reads after mapping is\n$$\n\\widehat{f}_s \\;=\\; \\frac{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big)}{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big) + (1-f_s)\\, \\exp(-\\alpha L\\mu_s)},\n$$\nwhere $\\delta = 1$ under SR and $\\delta = 0$ under BM. Under BM, this simplifies to $\\widehat{f}_s = f_s$.\n\nDefine the decision rule for calling a locus as a trans-species polymorphism as: call a locus “shared polymorphic” if for both species $s \\in \\{1,2\\}$ the observed alternate-allele fraction lies within the inclusive interval $[t, 1-t]$ for a fixed threshold $t \\in (0, 0.5]$. Define a “true shared polymorphism” as the event that both $f_1$ and $f_2$ lie within $[t, 1-t]$. A “false positive” is any locus that is called shared polymorphic by the decision rule but is not a true shared polymorphism.\n\nYour task is to compute, for each test case below, the difference $\\Delta$ between the false positive fractions under SR and BM:\n$$\n\\Delta \\;=\\; \\mathrm{FPR}_{\\mathrm{SR}} \\;-\\; \\mathrm{FPR}_{\\mathrm{BM}},\n$$\nwhere $\\mathrm{FPR}_{\\mathrm{SR}}$ and $\\mathrm{FPR}_{\\mathrm{BM}}$ are the false positive fractions under SR and BM, respectively, estimated across $N$ independent loci. Use a Monte Carlo estimator that draws $N$ independent pairs $(f_1,f_2)$ as specified and applies the mapping model and decision rule. Because BM mapping has $\\widehat{f}_s = f_s$, any false positive under BM arises only from sampling noise, which is excluded by the large-read assumption; therefore, under this model, the expected false positive fraction under BM is zero. Still, you must implement the Monte Carlo computation consistently for both SR and BM for methodological symmetry.\n\nThe final output must be a single line containing a list of $\\Delta$ values, one per test case, in the same order as the test suite, formatted as a Python-style list of decimal numbers with exactly six places after the decimal, for example, `[ 0.123456, 0.000000 ]`.\n\nImplement your solution as a complete, runnable program that performs the following steps for each test case:\n- Draw $N$ independent samples of $(f_1,f_2)$ with $f_s \\sim \\mathrm{Beta}(a_s,b_s)$.\n- Compute the observed alternate-allele fractions under SR and BM using the given model.\n- Apply the decision rule with threshold $t$ to determine calls under SR and BM.\n- Compute the false positive fractions and hence $\\Delta$.\n\nConstraints that must be respected in your implementation:\n- Use vectorized computation to ensure numerical stability and runtime efficiency.\n- Use a fixed random seed so that results are deterministic.\n\nTest Suite:\n- Case 1 (happy path):\n  - $L = 100$, $\\alpha = 1.0$, $\\mu_1 = 0.02$, $\\mu_2 = 0.02$, $N = 200000$, $a_1 = 0.2$, $b_1 = 0.8$, $a_2 = 0.2$, $b_2 = 0.8$, $t = 0.2$.\n- Case 2 (boundary: no bias because $\\alpha = 0$):\n  - $L = 150$, $\\alpha = 0.0$, $\\mu_1 = 0.05$, $\\mu_2 = 0.05$, $N = 200000$, $a_1 = 0.2$, $b_1 = 0.8$, $a_2 = 0.2$, $b_2 = 0.8$, $t = 0.2$.\n- Case 3 (edge: strong bias and divergence):\n  - $L = 150$, $\\alpha = 1.5$, $\\mu_1 = 0.10$, $\\mu_2 = 0.12$, $N = 200000$, $a_1 = 0.05$, $b_1 = 0.95$, $a_2 = 0.05$, $b_2 = 0.95$, $t = 0.15$.\n- Case 4 (coverage of many genuinely polymorphic loci):\n  - $L = 100$, $\\alpha = 1.0$, $\\mu_1 = 0.02$, $\\mu_2 = 0.03$, $N = 200000$, $a_1 = 2.0$, $b_1 = 2.0$, $a_2 = 2.0$, $b_2 = 2.0$, $t = 0.2$.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order of the cases above, with each value printed to exactly six decimal places (for example, `[0.001234,0.000000,0.012345,0.000678]`)", "solution": "The problem statement has been rigorously validated and is determined to be valid. It is scientifically grounded, well-posed, and objective. It presents a simplified but coherent model of reference bias in genetic sequencing, a genuine problem in bioinformatics, and asks for a quantitative comparison of false positive rates under two distinct analysis pipelines. All parameters and definitions required for a unique, computational solution are provided.\n\nThe task is to compute the difference in false positive rates, $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}} - \\mathrm{FPR}_{\\mathrm{BM}}$, between a Single-Reference (SR) mapping and a Bias-Minimized (BM) mapping pipeline for detecting trans-species polymorphisms.\n\nA false positive (FP) is defined as a locus that is called a \"shared polymorphism\" but is not a \"true shared polymorphism\". The rate is the fraction of such FP events over a large number of $N$ simulated loci.\n- A locus is a **true shared polymorphism** if the true allele frequencies in both species, $f_1$ and $f_2$, fall within the interval $[t, 1-t]$.\n- A locus is **called a shared polymorphism** if the observed allele frequencies, $\\widehat{f}_1$ and $\\widehat{f}_2$, both fall within the interval $[t, 1-t]$.\n\nThe core of the problem lies in the model for the observed alternate-allele fraction, $\\widehat{f}_s$, for species $s$:\n$$\n\\widehat{f}_s = \\frac{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big)}{f_s \\, \\exp\\!\\big(-\\alpha(L\\mu_s + \\delta)\\big) + (1-f_s)\\, \\exp(-\\alpha L\\mu_s)}\n$$\nA critical first step is to simplify this expression. By factoring out the term $\\exp(-\\alpha L\\mu_s)$ from both the numerator and the denominator, we obtain a much simpler form:\n$$\n\\widehat{f}_s = \\frac{f_s \\, \\exp(-\\alpha\\delta)}{f_s \\, \\exp(-\\alpha\\delta) + (1-f_s)}\n$$\nThis simplification reveals that the mapping bias on the allele frequency estimate depends only on the penalty parameter $\\alpha$ and the mapping strategy parameter $\\delta$, and is surprisingly independent of the read length $L$ and the species-specific divergence $\\mu_s$.\n\nWe now analyze the two mapping strategies:\n\n1.  **Bias-Minimized (BM) Mapping**: For this pipeline, $\\delta=0$. The term $\\exp(-\\alpha\\delta)$ becomes $\\exp(0) = 1$. The formula simplifies to:\n    $$\n    \\widehat{f}_{s, \\mathrm{BM}} = \\frac{f_s \\cdot 1}{f_s \\cdot 1 + (1-f_s)} = f_s\n    $$\n    Under the BM model, the observed frequency is exactly equal to the true frequency. The condition to call a shared polymorphism $(\\widehat{f}_{1, \\mathrm{BM}} \\in [t, 1-t] \\land \\widehat{f}_{2, \\mathrm{BM}} \\in [t, 1-t])$ is therefore identical to the condition for a true shared polymorphism $(f_1 \\in [t, 1-t] \\land f_2 \\in [t, 1-t])$. Consequently, it is logically impossible to have a false positive, where a locus is called shared polymorphic but is not truly so. Thus, $\\mathrm{FPR}_{\\mathrm{BM}} = 0$.\n\n2.  **Single-Reference (SR) Mapping**: For this pipeline, $\\delta=1$. The formula becomes:\n    $$\n    \\widehat{f}_{s, \\mathrm{SR}} = \\frac{f_s \\, e^{-\\alpha}}{f_s \\, e^{-\\alpha} + (1-f_s)}\n    $$\n    For any non-zero penalty $\\alpha > 0$, the term $e^{-\\alpha}$ is less than $1$. This results in a systematic downward bias, where the observed frequency is always less than the true frequency, i.e., $\\widehat{f}_{s, \\mathrm{SR}} < f_s$. This is a mathematical formalization of reference bias. This bias can cause loci that are not true shared polymorphisms to be incorrectly classified. Specifically, a locus where the true frequency $f_s$ is above the polymorphic range (i.e., $f_s > 1-t$) can have its observed frequency $\\widehat{f}_{s, \\mathrm{SR}}$ biased downwards into the range $[t, 1-t]$, potentially creating a false positive call if this occurs for both species.\n\nThe quantity to compute is $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}} - \\mathrm{FPR}_{\\mathrm{BM}}$. Since we have established that $\\mathrm{FPR}_{\\mathrm{BM}}=0$, the task reduces to computing $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}}$.\n\nThe Monte Carlo simulation will be implemented as follows:\n\n1.  A fixed random seed is used to ensure deterministic and reproducible results.\n2.  For each test case, we generate $N$ independent pairs of true allele frequencies $(f_1, f_2)$ by drawing from their specified Beta distributions, $f_s \\sim \\mathrm{Beta}(a_s, b_s)$. This is done using vectorized operations for efficiency.\n3.  A boolean mask `is_true_shared` is computed to identify the set of loci that are true shared polymorphisms, where $(f_1 \\in [t, 1-t]) \\land (f_2 \\in [t, 1-t])$.\n4.  The observed frequencies under SR mapping, $\\widehat{f}_{1, \\mathrm{SR}}$ and $\\widehat{f}_{2, \\mathrm{SR}}$, are calculated for all $N$ loci using the simplified formula derived above. This is also a vectorized operation.\n5.  A boolean mask `is_called_sr` is computed to identify loci called as shared polymorphisms under SR, where $(\\widehat{f}_{1, \\mathrm{SR}} \\in [t, 1-t]) \\land (\\widehat{f}_{2, \\mathrm{SR}} \\in [t, 1-t])$.\n6.  The number of false positives, $N_{\\mathrm{FP}}$, is the count of loci where `is_called_sr` is true AND `is_true_shared` is false.\n7.  The false positive rate is then $\\mathrm{FPR}_{\\mathrm{SR}} = N_{\\mathrm{FP}} / N$.\n8.  As discussed, $\\Delta = \\mathrm{FPR}_{\\mathrm{SR}}$. For methodological consistency as instructed by the problem, the calculation for $\\mathrm{FPR}_{\\mathrm{BM}}$ is also performed, which will yield $0$ and not change the final result.\n\nThis procedure is repeated for each set of parameters in the test suite. The final output will be a list of the computed $\\Delta$ values, formatted to six decimal places.\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the difference in false positive rates for detecting trans-species\n    polymorphism between Single-Reference (SR) and Bias-Minimized (BM)\n    mapping pipelines using a Monte Carlo simulation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {'L': 100, 'alpha': 1.0, 'mu1': 0.02, 'mu2': 0.02, 'N': 200000, 'a1': 0.2, 'b1': 0.8, 'a2': 0.2, 'b2': 0.8, 't': 0.2},\n        # Case 2: boundary (no bias because alpha = 0)\n        {'L': 150, 'alpha': 0.0, 'mu1': 0.05, 'mu2': 0.05, 'N': 200000, 'a1': 0.2, 'b1': 0.8, 'a2': 0.2, 'b2': 0.8, 't': 0.2},\n        # Case 3: edge (strong bias and divergence)\n        {'L': 150, 'alpha': 1.5, 'mu1': 0.10, 'mu2': 0.12, 'N': 200000, 'a1': 0.05, 'b1': 0.95, 'a2': 0.05, 'b2': 0.95, 't': 0.15},\n        # Case 4: coverage of many genuinely polymorphic loci\n        {'L': 100, 'alpha': 1.0, 'mu1': 0.02, 'mu2': 0.03, 'N': 200000, 'a1': 2.0, 'b1': 2.0, 'a2': 2.0, 'b2': 2.0, 't': 0.2},\n    ]\n\n    results = []\n    # Use a fixed random seed for reproducibility.\n    # The default_rng is the modern, preferred way to handle random number generation.\n    rng = np.random.default_rng(42)\n\n    for case in test_cases:\n        N = case['N']\n        a1, b1 = case['a1'], case['b1']\n        a2, b2 = case['a2'], case['b2']\n        t = case['t']\n        alpha = case['alpha']\n\n        # Step 1: Draw N independent samples of (f1, f2)\n        f1_samples = rng.beta(a1, b1, size=N)\n        f2_samples = rng.beta(a2, b2, size=N)\n\n        # Step 2: Determine true shared polymorphisms\n        is_true_shared = ((f1_samples >= t)  (f1_samples = 1 - t))  \\\n                         ((f2_samples >= t)  (f2_samples = 1 - t))\n\n        # --- Calculate FPR for Bias-Minimized (BM) mapping ---\n        # Under BM, delta=0, so f_hat_s = f_s.\n        f_hat_1_bm = f1_samples\n        f_hat_2_bm = f2_samples\n        \n        is_called_bm = ((f_hat_1_bm >= t)  (f_hat_1_bm = 1 - t))  \\\n                       ((f_hat_2_bm >= t)  (f_hat_2_bm = 1 - t))\n        \n        # A false positive is a locus that is called shared but is not truly shared.\n        # Since is_called_bm is logically identical to is_true_shared, this is always False.\n        fp_bm_count = np.sum(is_called_bm  ~is_true_shared)\n        fpr_bm = fp_bm_count / N\n\n        # --- Calculate FPR for Single-Reference (SR) mapping ---\n        # Under SR, delta=1. The formula for observed frequency simplifies to:\n        # f_hat_s = (f_s * exp(-alpha)) / (f_s * exp(-alpha) + (1 - f_s))\n        \n        if alpha == 0.0:\n            # If alpha is 0, there is no bias, so SR is identical to BM.\n            f_hat_1_sr = f1_samples\n            f_hat_2_sr = f2_samples\n        else:\n            exp_minus_alpha = np.exp(-alpha)\n            \n            # Vectorized calculation for f_hat_1_sr\n            numerator_1 = f1_samples * exp_minus_alpha\n            denominator_1 = numerator_1 + (1 - f1_samples)\n            f_hat_1_sr = numerator_1 / denominator_1\n            \n            # Vectorized calculation for f_hat_2_sr\n            numerator_2 = f2_samples * exp_minus_alpha\n            denominator_2 = numerator_2 + (1 - f2_samples)\n            f_hat_2_sr = numerator_2 / denominator_2\n\n        is_called_sr = ((f_hat_1_sr >= t)  (f_hat_1_sr = 1 - t))  \\\n                       ((f_hat_2_sr >= t)  (f_hat_2_sr = 1 - t))\n\n        fp_sr_count = np.sum(is_called_sr  ~is_true_shared)\n        fpr_sr = fp_sr_count / N\n\n        # Calculate the difference in FPRs\n        delta = fpr_sr - fpr_bm\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "answer": "[0.038165,0.000000,0.043615,0.034335]", "id": "2759434"}]}