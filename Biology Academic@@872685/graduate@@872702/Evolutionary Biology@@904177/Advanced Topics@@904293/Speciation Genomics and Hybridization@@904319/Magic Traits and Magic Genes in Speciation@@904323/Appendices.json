{"hands_on_practices": [{"introduction": "This first practice is a foundational exercise in the theory of speciation with gene flow. We will build a discrete-generation model to determine the precise conditions under which a rare \"magic allele\" can successfully establish itself in a population that is split across two distinct ecological environments. Mastering this problem [@problem_id:2729726] will provide you with hands-on experience in using linear stability analysis to model the critical interplay between divergent selection, assortative mating, and migration during the initial stages of population divergence.", "problem": "Consider two demes of equal census size linked by symmetric migration at rate $m \\in [0,1/2]$ per generation. The life cycle within each generation is viability selection within demes followed by migration, then mating and reproduction. There is a single biallelic haploid locus with a resident allele $a$ and a novel “magic” allele $A$, where “magic” means that the same locus affects both ecological performance and premating behavior. Assume:\n- Baseline mating is random when $a$ is the only allele present.\n- Ecological performance of $A$ is locally divergent: in deme $1$, $A$ has viability $1+s$ relative to $a$ (which has viability $1$), while in deme $2$, $A$ has viability $1-s$ and $a$ has viability $1$, with $s \\in (0,1)$.\n- The assortative mating effect of $A$ is quantified by $a \\in [0,1)$ and acts as follows: relative to the random mating baseline, matings between phenotypically dissimilar partners are downweighted by a factor $1-a$ within each deme. When $A$ is rare, almost all $A$ carriers’ potential mates are $a$-carriers, so the per-capita reproductive output of $A$ is multiplicatively reduced by the factor $1-a$ in both demesmes.\n\nLet $n_{1,t}$ and $n_{2,t}$ denote the absolute numbers of $A$ carriers in demes $1$ and $2$ at generation $t$, with $A$ initially rare in both demes. Working to first order in rarity (so that the resident background’s demography is unaffected and normalization by mean fitness can be ignored for $A$), derive the exact closed-form expression for the critical symmetric migration rate $m_{c}(s,a)$ such that the leading eigenvalue of the rare-allele linearization is equal to $1$. Invasion from rarity occurs if and only if $m  m_{c}(s,a)$ and fails at $m > m_{c}(s,a)$. Express your final result as a single closed-form analytic expression in terms of $s$ and $a$. No approximation or rounding is permitted, and no units are required.", "solution": "The problem requires the derivation of the critical migration rate $m_c$ for the invasion of a rare \"magic\" allele, $A$. The allele is subject to divergent selection in two demes and confers a preference for assortative mating. The condition for invasion is determined by the leading eigenvalue of the linearized system for the dynamics of the rare allele.\n\nLet the state of the system at the beginning of generation $t$ be described by the vector of absolute numbers of the $A$ allele in each deme, $\\mathbf{n}_{t} = \\begin{pmatrix} n_{1,t} \\\\ n_{2,t} \\end{pmatrix}$. We will construct the transition matrix $\\mathbf{T}$ that maps the state from one generation to the next, $\\mathbf{n}_{t+1} = \\mathbf{T} \\mathbf{n}_{t}$, by following the specified life cycle: viability selection, then migration, then mating and reproduction.\n\n1.  **Viability Selection:**\nIn deme $1$, allele $A$ has a relative viability of $1+s$ compared to allele $a$. In deme $2$, its viability is $1-s$. Since allele $A$ is rare, the dynamics of its absolute count $n_{i,t}$ are approximately governed by its relative viability. Let $\\mathbf{n'}_{t}$ be the vector of counts after selection.\n$$\n\\mathbf{n'}_{t} = \\begin{pmatrix} n'_{1,t} \\\\ n'_{2,t} \\end{pmatrix} = \\begin{pmatrix} 1+s  0 \\\\ 0  1-s \\end{pmatrix} \\begin{pmatrix} n_{1,t} \\\\ n_{2,t} \\end{pmatrix} = \\mathbf{S} \\mathbf{n}_{t}\n$$\nHere, $\\mathbf{S}$ is the selection matrix.\n\n2.  **Migration:**\nMigration is symmetric between the two demes at a rate $m$. A fraction $m$ of individuals from each deme moves to the other. Let $\\mathbf{n''}_{t}$ be the vector of counts after migration.\n$$\n\\mathbf{n''}_{t} = \\begin{pmatrix} n''_{1,t} \\\\ n''_{2,t} \\end{pmatrix} = \\begin{pmatrix} 1-m  m \\\\ m  1-m \\end{pmatrix} \\begin{pmatrix} n'_{1,t} \\\\ n'_{2,t} \\end{pmatrix} = \\mathbf{M} \\mathbf{n'}_{t}\n$$\nHere, $\\mathbf{M}$ is the migration matrix.\n\n3.  **Mating and Reproduction:**\nThe problem states that due to assortative mating, the per-capita reproductive output of the rare allele $A$ is reduced by a factor of $1-a$. This is because $A$-carriers preferentially seek other $A$-carriers, which are rare, leading to fewer successful matings compared to random mating. This acts as a multiplicative fitness cost in both demes.\n$$\n\\mathbf{n}_{t+1} = \\begin{pmatrix} n_{1,t+1} \\\\ n_{2,t+1} \\end{pmatrix} = (1-a) \\mathbf{n''}_{t}\n$$\nThis can be represented by a matrix $\\mathbf{A} = (1-a)\\mathbf{I}$, where $\\mathbf{I}$ is the $2 \\times 2$ identity matrix.\n\nThe complete recurrence relation is given by combining these steps:\n$$\n\\mathbf{n}_{t+1} = \\mathbf{A} \\mathbf{M} \\mathbf{S} \\mathbf{n}_{t}\n$$\nThe transition matrix $\\mathbf{T}$ is therefore:\n$$\n\\mathbf{T} = \\mathbf{A} \\mathbf{M} \\mathbf{S} = (1-a) \\begin{pmatrix} 1-m  m \\\\ m  1-m \\end{pmatrix} \\begin{pmatrix} 1+s  0 \\\\ 0  1-s \\end{pmatrix} = (1-a) \\begin{pmatrix} (1-m)(1+s)  m(1-s) \\\\ m(1+s)  (1-m)(1-s) \\end{pmatrix}\n$$\nThe allele $A$ can invade from rarity if the leading eigenvalue of $\\mathbf{T}$, denoted $\\lambda_{\\text{lead}}$, is greater than $1$. The critical condition corresponds to $\\lambda_{\\text{lead}} = 1$. The eigenvalues $\\lambda$ of $\\mathbf{T}$ are given by the characteristic equation $\\det(\\mathbf{T} - \\lambda\\mathbf{I}) = 0$.\nLet $\\mathbf{T'} = \\frac{1}{1-a}\\mathbf{T} = \\mathbf{M}\\mathbf{S}$. The eigenvalues of $\\mathbf{T}$ are $\\lambda = (1-a)\\lambda'$, where $\\lambda'$ are the eigenvalues of $\\mathbf{T'}$.\nThe characteristic equation for $\\lambda'$ is $\\lambda'^2 - \\text{Tr}(\\mathbf{T'})\\lambda' + \\det(\\mathbf{T'}) = 0$.\nThe trace of $\\mathbf{T'}$ is:\n$$\n\\text{Tr}(\\mathbf{T'}) = (1-m)(1+s) + (1-m)(1-s) = (1-m)(1+s+1-s) = 2(1-m)\n$$\nThe determinant of $\\mathbf{T'}$ is:\n$$\n\\det(\\mathbf{T'}) = (1-m)(1+s)(1-m)(1-s) - m(1-s)m(1+s) \\\\\n= (1-m)^2(1-s^2) - m^2(1-s^2) \\\\\n= (1-s^2)((1-m)^2 - m^2) = (1-s^2)(1-2m+m^2-m^2) = (1-s^2)(1-2m)\n$$\nThe characteristic equation is $\\lambda'^2 - 2(1-m)\\lambda' + (1-s^2)(1-2m) = 0$.\nThe solutions for $\\lambda'$ are given by the quadratic formula:\n$$\n\\lambda' = \\frac{2(1-m) \\pm \\sqrt{4(1-m)^2 - 4(1-s^2)(1-2m)}}{2} = (1-m) \\pm \\sqrt{(1-m)^2 - (1-s^2)(1-2m)}\n$$\nThe term under the square root simplifies to:\n$$\n(1-2m+m^2) - (1-2m-s^2+2ms^2) = m^2 + s^2 - 2ms^2\n$$\nThe leading eigenvalue $\\lambda'_{\\text{lead}}$ corresponds to the positive root:\n$$\n\\lambda'_{\\text{lead}} = (1-m) + \\sqrt{m^2 + s^2 - 2ms^2}\n$$\nThe leading eigenvalue of the full system is $\\lambda_{\\text{lead}} = (1-a) \\lambda'_{\\text{lead}}$. The critical migration rate $m_c$ is found by setting $\\lambda_{\\text{lead}} = 1$ and solving for $m=m_c$:\n$$\n(1-a) \\left[ (1-m_c) + \\sqrt{m_c^2 + s^2 - 2m_cs^2} \\right] = 1\n$$\nLet us denote $m_c$ simply as $m$ for algebraic manipulation.\n$$\n(1-m) + \\sqrt{m^2 + s^2(1-2m)} = \\frac{1}{1-a}\n$$\n$$\n\\sqrt{m^2 + s^2(1-2m)} = \\frac{1}{1-a} - (1-m) = \\frac{1 - (1-a)(1-m)}{1-a} = \\frac{1 - (1-m-a+am)}{1-a} = \\frac{m+a-am}{1-a}\n$$\nSquaring both sides of the equation:\n$$\nm^2 + s^2 - 2ms^2 = \\left( \\frac{a+m(1-a)}{1-a} \\right)^2 = \\frac{a^2 + 2am(1-a) + m^2(1-a)^2}{(1-a)^2}\n$$\nTo eliminate the denominator, we multiply both sides by $(1-a)^2$:\n$$\n(m^2+s^2-2ms^2)(1-a)^2 = a^2 + 2am(1-a) + m^2(1-a)^2\n$$\n$$\nm^2(1-a)^2 + s^2(1-a)^2 - 2ms^2(1-a)^2 = a^2 + 2am(1-a) + m^2(1-a)^2\n$$\nThe term $m^2(1-a)^2$ cancels on both sides, which simplifies the equation to be linear in $m$:\n$$\ns^2(1-a)^2 - a^2 = m[2a(1-a) + 2s^2(1-a)^2]\n$$\nFinally, solving for $m=m_c$ yields the desired expression:\n$$\nm_c(s,a) = \\frac{s^2(1-a)^2 - a^2}{2a(1-a) + 2s^2(1-a)^2}\n$$\nThis expression can be factored to be presented more transparently. The numerator is a difference of squares and the denominator has a common factor:\n$$\nm_c(s,a) = \\frac{(s(1-a) - a)(s(1-a) + a)}{2(1-a)(a + s^2(1-a))}\n$$\nThis is the final closed-form analytical expression for the critical migration rate. Invasion of the magic allele is possible only if migration is weaker than this threshold, i.e., $m  m_c(s,a)$. This requires $m_c(s,a)  0$, which implies from the numerator that $s(1-a) > a$, or $a  \\frac{s}{1+s}$. If the cost of assortative mating is too high ($a > \\frac{s}{1+s}$), invasion is not possible even with complete isolation ($m=0$).", "answer": "$$\n\\boxed{\\frac{s^2(1-a)^2 - a^2}{2a(1-a) + 2s^2(1-a)^2}}\n$$", "id": "2729726"}, {"introduction": "Having established the conditions for invasion, we now shift our focus from a single allele to the divergence of a continuous trait, and from the initial invasion to the long-term equilibrium state. Using the framework of quantitative genetics, this exercise [@problem_id:2729712] directly contrasts a \"magic trait\" architecture with a non-pleiotropic one, where the ecological and mating traits are genetically unlinked. By deriving and comparing the equilibrium trait divergence for both scenarios, you will analytically demonstrate why pleiotropy provides such a powerful advantage in maintaining adaptive differences against the homogenizing pressure of gene flow.", "problem": "Consider a two-habitat population under divergent ecological selection on a quantitative ecological trait $z$ that also mediates assortative mating in one of two alternative preference architectures. Habitat $i \\in \\{1,2\\}$ has an ecological optimum $\\theta_{i}$ with $\\theta_{1} = \\theta$ and $\\theta_{2} = -\\theta$, where $\\theta  0$. Viability selection on $z$ is Gaussian with curvature $s  0$, so that under the Lande quantitative-genetic continuous-time approximation with additive genetic variance absorbed into a rescaled time unit, the viability selection gradient on the mean in habitat $i$ is $-s(\\bar{z}_{i} - \\theta_{i})$. Individuals migrate symmetrically at rate $m \\ge 0$ per unit time between habitats. Assume weak selection and weak migration so that the mean dynamics can be treated linearly.\n\nMating occurs after migration in each habitat and is assortative by phenotype with strength parameter $\\alpha \\in [0,1)$ such that a phenotypically mismatched pair has an acceptance probability reduced by the factor $1 - \\alpha$ relative to a matched pair. Compare the following two architectures:\n\n- Pleiotropic “magic trait” architecture: the same genetic basis determining $z$ also determines mating signal and preference, so immigrants are, to first order around the equilibrium, phenotypically mismatched with residents and thus experience a reduction in realized reproductive contribution proportional to $1 - \\alpha$.\n\n- Non-pleiotropic architecture: mating preference is determined by a genetically independent trait that is unlinked to $z$ and, under weak selection and free recombination, maintains negligible genetic covariance with $z$; therefore, to first order, immigrant trait genes do not experience a systematic mating disadvantage.\n\nAssume that the realized contribution of immigrants to the change in $\\bar{z}_{i}$ is proportional to their acceptance probability, so that the gene flow term in the mean dynamics is $m_{\\mathrm{eff}}(\\bar{z}_{j} - \\bar{z}_{i})$, with $m_{\\mathrm{eff}} = m(1 - \\alpha)$ in the pleiotropic case and $m_{\\mathrm{eff}} = m$ in the non-pleiotropic case.\n\nStarting from these assumptions and using only the quantitative-genetic mean dynamics with viability selection and effective migration as described above, derive the equilibrium trait divergence $\\Delta \\bar{z} = \\bar{z}_{1} - \\bar{z}_{2}$ separately under the pleiotropic and the non-pleiotropic architectures. Then, in closed form, compute the ratio $R(m)$ of the pleiotropic to the non-pleiotropic equilibrium divergences as an explicit function of $s$, $m$, $\\theta$, and $\\alpha$.\n\nYour final answer must be a single simplified analytic expression for $R(m)$. No numerical approximation is required, and no units are to be reported.", "solution": "The problem asks for the ratio of equilibrium trait divergences between two genetic architectures: a pleiotropic \"magic trait\" and a non-pleiotropic trait. We begin by establishing the dynamical equations for the mean trait values, $\\bar{z}_{1}$ and $\\bar{z}_{2}$, in the two habitats.\n\nAccording to the problem statement, the system is described by the Lande continuous-time quantitative-genetic approximation. The rate of change of the mean trait in each habitat is the sum of the effects of viability selection and migration.\n\nThe change due to viability selection in habitat $i$ is given by the selection gradient, which is $-s(\\bar{z}_{i} - \\theta_{i})$. The change due to migration into habitat $i$ from habitat $j$ is given by the term $m_{\\mathrm{eff}}(\\bar{z}_{j} - \\bar{z}_{i})$, where $m_{\\mathrm{eff}}$ is the effective migration rate.\n\nCombining these terms, we construct the system of ordinary differential equations for the mean traits $\\bar{z}_{1}$ and $\\bar{z}_{2}$:\n$$ \\frac{d\\bar{z}_{1}}{dt} = -s(\\bar{z}_{1} - \\theta_{1}) + m_{\\mathrm{eff}}(\\bar{z}_{2} - \\bar{z}_{1}) $$\n$$ \\frac{d\\bar{z}_{2}}{dt} = -s(\\bar{z}_{2} - \\theta_{2}) + m_{\\mathrm{eff}}(\\bar{z}_{1} - \\bar{z}_{2}) $$\n\nTo find the equilibrium state, we set the time derivatives to zero:\n$$ 0 = -s(\\bar{z}_{1} - \\theta_{1}) + m_{\\mathrm{eff}}(\\bar{z}_{2} - \\bar{z}_{1}) \\quad (1) $$\n$$ 0 = -s(\\bar{z}_{2} - \\theta_{2}) + m_{\\mathrm{eff}}(\\bar{z}_{1} - \\bar{z}_{2}) \\quad (2) $$\n\nWe are interested in the equilibrium trait divergence, $\\Delta \\bar{z} = \\bar{z}_{1} - \\bar{z}_{2}$. We can obtain an equation for $\\Delta \\bar{z}$ by subtracting equation $(2)$ from equation $(1)$:\n$$ 0 = [-s(\\bar{z}_{1} - \\theta_{1}) + m_{\\mathrm{eff}}(\\bar{z}_{2} - \\bar{z}_{1})] - [-s(\\bar{z}_{2} - \\theta_{2}) + m_{\\mathrm{eff}}(\\bar{z}_{1} - \\bar{z}_{2})] $$\n$$ 0 = -s\\bar{z}_{1} + s\\theta_{1} + m_{\\mathrm{eff}}\\bar{z}_{2} - m_{\\mathrm{eff}}\\bar{z}_{1} + s\\bar{z}_{2} - s\\theta_{2} - m_{\\mathrm{eff}}\\bar{z}_{1} + m_{\\mathrm{eff}}\\bar{z}_{2} $$\nWe group terms by $\\bar{z}_{1}$, $\\bar{z}_{2}$, and the optima $\\theta_{1}, \\theta_{2}$:\n$$ 0 = -s(\\bar{z}_{1} - \\bar{z}_{2}) + s(\\theta_{1} - \\theta_{2}) - 2m_{\\mathrm{eff}}(\\bar{z}_{1} - \\bar{z}_{2}) $$\nSubstituting $\\Delta \\bar{z} = \\bar{z}_{1} - \\bar{z}_{2}$:\n$$ 0 = -s\\Delta \\bar{z} + s(\\theta_{1} - \\theta_{2}) - 2m_{\\mathrm{eff}}\\Delta \\bar{z} $$\nRearranging to solve for $\\Delta \\bar{z}$:\n$$ (s + 2m_{\\mathrm{eff}})\\Delta \\bar{z} = s(\\theta_{1} - \\theta_{2}) $$\nThe problem states that $\\theta_{1} = \\theta$ and $\\theta_{2} = -\\theta$, so $\\theta_{1} - \\theta_{2} = \\theta - (-\\theta) = 2\\theta$.\n$$ (s + 2m_{\\mathrm{eff}})\\Delta \\bar{z} = s(2\\theta) $$\nThus, the general expression for the equilibrium divergence is:\n$$ \\Delta \\bar{z} = \\frac{2s\\theta}{s + 2m_{\\mathrm{eff}}} $$\nNow, we apply this general result to the two specified architectures.\n\nCase 1: Pleiotropic (\"magic trait\") architecture.\nIn this case, assortative mating reduces the reproductive success of immigrants. The effective migration rate is given as $m_{\\mathrm{eff}} = m(1 - \\alpha)$. The equilibrium divergence under this architecture, $(\\Delta \\bar{z})_{\\mathrm{pleo}}$, is:\n$$ (\\Delta \\bar{z})_{\\mathrm{pleo}} = \\frac{2s\\theta}{s + 2m(1 - \\alpha)} $$\n\nCase 2: Non-pleiotropic architecture.\nHere, the mating preference trait is independent of the ecological trait $z$. Immigrant genes do not suffer a systematic mating disadvantage, so the effective migration rate is simply the demographic rate, $m_{\\mathrm{eff}} = m$. The equilibrium divergence under this architecture, $(\\Delta \\bar{z})_{\\mathrm{non-pleo}}$, is:\n$$ (\\Delta \\bar{z})_{\\mathrm{non-pleo}} = \\frac{2s\\theta}{s + 2m} $$\n\nThe final step is to compute the ratio $R(m)$ of the pleiotropic to the non-pleiotropic equilibrium divergences.\n$$ R(m) = \\frac{(\\Delta \\bar{z})_{\\mathrm{pleo}}}{(\\Delta \\bar{z})_{\\mathrm{non-pleo}}} = \\frac{\\frac{2s\\theta}{s + 2m(1 - \\alpha)}}{\\frac{2s\\theta}{s + 2m}} $$\nThe term $2s\\theta$ cancels from the numerator and the denominator:\n$$ R(m) = \\frac{s + 2m}{s + 2m(1 - \\alpha)} $$\nThis can be written as:\n$$ R(m) = \\frac{s + 2m}{s + 2m - 2m\\alpha} $$\nThis is the final, simplified expression for the ratio $R(m)$ as a function of the given parameters $s$, $m$, and $\\alpha$. The parameter $\\theta$ cancels out, as it scales both divergences equally.", "answer": "$$\\boxed{\\frac{s + 2m}{s + 2m(1 - \\alpha)}}$$", "id": "2729712"}, {"introduction": "Our final practice advances into the powerful framework of adaptive dynamics and requires a computational approach to explore the long-term evolutionary outcomes of different genetic architectures. This problem [@problem_id:2729706] guides you to investigate how frequency-dependent ecological interactions can create disruptive selection, potentially leading to evolutionary branching—the diversification of a single lineage into two. By writing a program to numerically measure and compare the regions of parameter space that permit branching under magic versus non-magic scenarios, you will develop a concrete, quantitative intuition for how magic traits can function as potent catalysts for speciation.", "problem": "You are to write a complete, runnable program that, for a simple invasion fitness approximation under frequency-dependent ecological selection and assortative mating, computes whether coupling of ecological performance and mating (a so-called magic trait) increases the Lebesgue measure (represented numerically as a fractional volume over a grid) of parameter combinations that yield evolutionary branching relative to a non-magic scenario where the ecological trait and mating signal are at distinct loci coupled only by linkage. The task must be grounded in first principles and well-tested formulas, not shortcut expressions. You must implement the following model and analysis, starting from the specified base assumptions and definitions.\n\nBase definitions:\n- Consider a continuous ecological trait $x \\in \\mathbb{R}$ in a resident population monomorphic at $x = 0$. The carrying capacity is $K(x) \\propto \\exp\\left(-\\dfrac{x^2}{2\\sigma_K^2}\\right)$ with variance $\\sigma_K^2  0$, and the competition kernel is $C(x - y) \\propto \\exp\\left(-\\dfrac{(x - y)^2}{2\\sigma_C^2}\\right)$ with variance $\\sigma_C^2  0$. These Gaussian forms are widely used in adaptive dynamics for resource competition.\n- Assortative mating is modeled by a Gaussian preference with strength $\\alpha \\ge 0$, such that mating success for an individual with trait deviation $d$ from a potential mate is proportional to $\\exp\\left(-\\dfrac{\\alpha d^2}{2}\\right)$. In a magic trait scenario, $d$ is the difference in the ecological trait itself; in a non-magic scenario, assortment acts on a distinct mating signal locus and maps onto the ecological trait via linkage.\n- Assume weak selection and small mutational steps, so that near $x = 0$ the invasion fitness $f(x_{\\text{mut}}; x_{\\text{res}})$ for a rare mutant with $x_{\\text{mut}}$ in a resident at $x_{\\text{res}} = 0$ admits a second-order Taylor approximation in $x_{\\text{mut}}$ around $0$. The local condition for evolutionary branching at the singular point $x=0$ is that the singular is convergence stable and the curvature (the second derivative of invasion fitness with respect to mutant trait at the singular point) is positive. For the symmetric Gaussian environment specified above, the singular at $x=0$ is convergence stable, and the sign of the curvature determines whether the singular is a fitness maximum (negative curvature) or a fitness minimum (positive curvature). Thus, a positive total curvature indicates evolutionary instability of the singular while remaining convergence stable, i.e., a branching point.\n\nRequired derivation basis:\n- From the Gaussian ecological model, the curvature contribution from ecological interactions at $x=0$ is proportional to the difference in inverse variances. Use a selection intensity scaling $s_e  0$ so that the ecological curvature contribution at $x=0$ is $H_{\\text{eco}} = s_e\\left(\\dfrac{1}{\\sigma_C^2} - \\dfrac{1}{\\sigma_K^2}\\right)$.\n- From the Gaussian assortative mating function, deviations from the resident mean incur a stabilizing sexual selection curvature at $x=0$ that scales linearly with the assortative strength. Use a mating intensity scaling $s_m  0$ so that the sexual curvature contribution at $x=0$ is $H_{\\text{sex}} = - s_m \\alpha$ for a magic trait, because deviation reduces mating success symmetrically around $0$.\n- In the non-magic two-locus case, assume quasi-linkage equilibrium (QLE), a standard approximation under weak selection where linkage disequilibrium is of order selection divided by recombination. Model the effective projection of assortative mating onto the ecological trait by a coupling factor $w(r)$ that scales the sexual curvature, with recombination rate $r \\in [0, 0.5]$. Use $w(r) = \\dfrac{1}{1 + r/\\rho}$, where $\\rho  0$ sets the scale of decay from full coupling at $r=0$ to weak coupling for larger $r$. Under QLE, this decreasing function captures how recombination weakens the mapping from assortative mating to sexual selection on the ecological trait. Hence in the non-magic case, $H_{\\text{sex}} = - s_m \\alpha \\, w(r)$.\n- The total curvature at the singular point is $H_{\\text{total}} = H_{\\text{eco}} + H_{\\text{sex}}$. The evolutionary branching condition is $H_{\\text{total}}  0$.\n\nComputation of measures:\n- Define the “measure of parameter space yielding branching” as the fraction of grid points in a specified parameter set for which $H_{\\text{total}}  0$, i.e., the numerical Lebesgue measure approximation over a uniform grid. For the magic case, the grid is over $(\\alpha, \\sigma_C)$. For the non-magic case, the grid is over $(\\alpha, \\sigma_C, r)$.\n- For each test case, compute:\n  1. The magic measure $M_{\\text{magic}}$, the fraction of $(\\alpha, \\sigma_C)$ grid points with $H_{\\text{eco}} - s_m \\alpha  0$.\n  2. The non-magic measure $M_{\\text{nonmagic}}$, the fraction of $(\\alpha, \\sigma_C, r)$ grid points with $H_{\\text{eco}} - s_m \\alpha \\, w(r)  0$.\n  3. The difference $\\Delta = M_{\\text{magic}} - M_{\\text{nonmagic}}$ as a floating-point number.\n\nTest suite:\n- For all cases, set $\\sigma_K = 1.0$ and $s_e = 1.0$. Use uniform grids as specified. Angles do not appear. No physical units are involved.\n- Case $1$ (baseline):\n  - $s_m = 0.5$, $\\rho = 0.05$.\n  - $\\alpha$ grid: from $0.0$ to $1.0$ inclusive with $21$ evenly spaced points.\n  - $\\sigma_C$ grid: from $0.5$ to $1.5$ inclusive with $41$ evenly spaced points.\n  - $r$ grid: from $0.0$ to $0.5$ inclusive with $11$ evenly spaced points.\n- Case $2$ (stronger sexual selection):\n  - $s_m = 1.0$, $\\rho = 0.05$.\n  - Same grids for $\\alpha$, $\\sigma_C$, and $r$ as in Case $1$.\n- Case $3$ (weaker coupling due to smaller $\\rho$):\n  - $s_m = 0.5$, $\\rho = 0.01$.\n  - Same grids for $\\alpha$, $\\sigma_C$, and $r$ as in Case $1$.\n- Case $4$ (boundary with no assortative mating):\n  - $s_m = 1.0$, $\\rho = 0.10$.\n  - $\\alpha$ grid: a single point $\\{0.0\\}$.\n  - $\\sigma_C$ grid: from $0.5$ to $1.5$ inclusive with $41$ evenly spaced points.\n  - $r$ grid: from $0.0$ to $0.5$ inclusive with $11$ evenly spaced points.\n\nYour program must:\n- Implement the above curvature-based branching test using the provided base definitions and QLE-inspired coupling factor.\n- For each of the $4$ cases, compute $\\Delta = M_{\\text{magic}} - M_{\\text{nonmagic}}$ as a float, rounded to $6$ decimal places.\n- Produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, e.g., $[\\Delta_1,\\Delta_2,\\Delta_3,\\Delta_4]$.\n\nThe final outputs are floats. No additional text should be printed. The code must not read input or files and must be self-contained and deterministic.", "solution": "The problem statement poses a well-defined computational task grounded in the established theoretical framework of adaptive dynamics. It asks for a quantitative comparison between \"magic\" and \"non-magic\" trait architectures concerning their propensity to allow for evolutionary branching. The validation confirms that all premises are scientifically sound, all parameters and models are explicitly defined, and the computational objective is unambiguous. The problem is valid.\n\nThe core of the analysis rests on the curvature of the invasion fitness function at an evolutionarily singular point, here taken to be at trait value $x=0$. The problem states that this singular point is convergence stable, so the condition for evolutionary branching simplifies to the total curvature being positive. The total curvature, $H_{\\text{total}}$, is the sum of a component from ecological interactions, $H_{\\text{eco}}$, and a component from sexual selection, $H_{\\text{sex}}$. Branching occurs if:\n$$H_{\\text{total}} = H_{\\text{eco}} + H_{\\text{sex}}  0$$\n\nThe ecological contribution to curvature, $H_{\\text{eco}}$, is determined by the interplay between resource availability and competition. The provided formula is:\n$$H_{\\text{eco}} = s_e \\left( \\frac{1}{\\sigma_C^2} - \\frac{1}{\\sigma_K^2} \\right)$$\nwhere $s_e  0$ is the selection intensity, $\\sigma_K^2$ is the variance of the carrying capacity function, and $\\sigma_C^2$ is the variance of the competition kernel. Disruptive selection, which favors branching, occurs when competition is more specialized than the resource spectrum, i.e., $\\sigma_C  \\sigma_K$. For the given constants $s_e = 1.0$ and $\\sigma_K = 1.0$, this expression simplifies to:\n$$H_{\\text{eco}} = \\frac{1}{\\sigma_C^2} - 1$$\nThis ecological term is identical for both the magic and non-magic scenarios.\n\nThe sexual selection contribution, $H_{\\text{sex}}$, introduces a stabilizing effect that counteracts branching. Its formulation differs between the two scenarios.\n\nIn the **magic trait** scenario, the ecological trait itself is the object of mate choice. Assortative mating is strongest for individuals with similar traits, penalizing deviates from the population mean. This results in a stabilizing curvature:\n$$H_{\\text{sex, magic}} = -s_m \\alpha$$\nwhere $s_m  0$ is the mating intensity and $\\alpha \\ge 0$ is the strength of assortment. The branching condition for the magic trait case becomes:\n$$H_{\\text{eco}} - s_m \\alpha  0 \\quad \\implies \\quad \\frac{1}{\\sigma_C^2} - 1  s_m \\alpha$$\n\nIn the **non-magic trait** scenario, mate choice acts on a separate signal locus, which is genetically linked to the ecological trait locus. The effect of sexual selection on the ecological trait is therefore indirect and weakened by recombination. This is modeled using a coupling factor, $w(r)$, derived from a quasi-linkage equilibrium (QLE) approximation:\n$$w(r) = \\frac{1}{1 + r/\\rho}$$\nwhere $r \\in [0, 0.5]$ is the recombination rate and $\\rho  0$ is a scaling parameter. The sexual selection curvature is modulated by this factor:\n$$H_{\\text{sex, non-magic}} = -s_m \\alpha \\, w(r)$$\nThe branching condition for the non-magic trait case is thus dependent on the recombination rate:\n$$H_{\\text{eco}} - s_m \\alpha \\, w(r)  0 \\quad \\implies \\quad \\frac{1}{\\sigma_C^2} - 1  s_m \\alpha \\left( \\frac{1}{1 + r/\\rho} \\right)$$\n\nThe objective is to compute the difference, $\\Delta = M_{\\text{magic}} - M_{\\text{nonmagic}}$, between the measures of parameter space that permit branching. These measures are defined as the fraction of grid points satisfying the respective branching conditions.\n\nThe measure for the magic case, $M_{\\text{magic}}$, is computed over a two-dimensional grid of parameters $(\\alpha, \\sigma_C)$:\n$$M_{\\text{magic}} = \\frac{1}{N_{\\alpha} N_{\\sigma_C}} \\sum_{i,j} \\mathbb{I} \\left( \\left(\\frac{1}{\\sigma_{C,j}^2} - 1\\right) - s_m \\alpha_i  0 \\right)$$\nwhere $\\mathbb{I}(\\cdot)$ is the indicator function, and $N_{\\alpha}$, $N_{\\sigma_C}$ are the number of points in the grids for $\\alpha$ and $\\sigma_C$.\n\nThe measure for the non-magic case, $M_{\\text{nonmagic}}$, is computed over a three-dimensional grid of $(\\alpha, \\sigma_C, r)$:\n$$M_{\\text{nonmagic}} = \\frac{1}{N_{\\alpha} N_{\\sigma_C} N_{r}} \\sum_{i,j,k} \\mathbb{I} \\left( \\left(\\frac{1}{\\sigma_{C,j}^2} - 1\\right) - s_m \\alpha_i w(r_k)  0 \\right)$$\nwhere $N_r$ is the number of points in the grid for $r$.\n\nThe computational procedure involves constructing the specified uniform grids for the parameters $(\\alpha, \\sigma_C, r)$ for each test case. The branching inequalities are then evaluated across these grids. NumPy's broadcasting capabilities are employed to perform these computations efficiently over the entire multi-dimensional parameter space without explicit loops. For each scenario, the number of grid points satisfying the condition is counted and divided by the total number of points to obtain the measure. Finally, the difference $\\Delta$ is computed and stored. It is anticipated that $\\Delta \\le 0$, because recombination ($r  0$) weakens the stabilizing sexual selection term ($|H_{\\text{sex, non-magic}}| \\le |H_{\\text{sex, magic}}|$), making the branching condition easier to satisfy in the non-magic case. The special case of $\\alpha=0$ implies no sexual selection, rendering the magic and non-magic models identical and yielding $\\Delta=0$. The program implements this logic to produce the required numerical results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the difference in the measure of parameter space yielding evolutionary\n    branching for magic vs. non-magic trait architectures.\n    \"\"\"\n    test_cases = [\n        # Case 1: (s_m, rho, alpha_grid_params, sigma_c_grid_params, r_grid_params)\n        (0.5, 0.05, (0.0, 1.0, 21), (0.5, 1.5, 41), (0.0, 0.5, 11)),\n        # Case 2: stronger sexual selection\n        (1.0, 0.05, (0.0, 1.0, 21), (0.5, 1.5, 41), (0.0, 0.5, 11)),\n        # Case 3: weaker coupling (smaller rho)\n        (0.5, 0.01, (0.0, 1.0, 21), (0.5, 1.5, 41), (0.0, 0.5, 11)),\n        # Case 4: no assortative mating\n        (1.0, 0.10, (0.0, 0.0, 1), (0.5, 1.5, 41), (0.0, 0.5, 11)),\n    ]\n\n    results = []\n    \n    # Global constants from the problem statement\n    sigma_k = 1.0\n    s_e = 1.0\n\n    for s_m, rho, alpha_params, sigma_c_params, r_params in test_cases:\n        \n        # Create parameter grids\n        alpha_grid = np.linspace(*alpha_params)\n        sigma_c_grid = np.linspace(*sigma_c_params)\n        r_grid = np.linspace(*r_params)\n        \n        # Calculate ecological curvature contribution for each point in sigma_c grid\n        h_eco = s_e * (1.0 / sigma_c_grid**2 - 1.0 / sigma_k**2)\n\n        # --- Magic Trait Measure Calculation ---\n        n_alpha = len(alpha_grid)\n        n_sigma_c = len(sigma_c_grid)\n        total_points_magic = n_alpha * n_sigma_c\n        \n        # Sexual selection curvature for magic trait case\n        h_sex_magic = -s_m * alpha_grid\n        \n        # Use NumPy broadcasting to evaluate the condition over the 2D grid\n        # h_eco shape: (n_sigma_c,) -> (n_sigma_c, 1)\n        # h_sex_magic shape: (n_alpha,) -> (1, n_alpha)\n        # Resulting h_total_magic shape: (n_sigma_c, n_alpha)\n        h_total_magic = h_eco.reshape(-1, 1) + h_sex_magic.reshape(1, -1)\n        \n        count_magic = np.sum(h_total_magic > 0)\n        m_magic = float(count_magic) / total_points_magic if total_points_magic > 0 else 0.0\n\n        # --- Non-Magic Trait Measure Calculation ---\n        n_r = len(r_grid)\n        total_points_nonmagic = n_alpha * n_sigma_c * n_r\n\n        # Coupling factor w(r)\n        w_r = 1.0 / (1.0 + r_grid / rho)\n        \n        # Sexual selection curvature base for non-magic trait case\n        h_sex_nonmagic_base = -s_m * alpha_grid\n\n        # Use 3D broadcasting\n        # h_eco -> (n_sigma_c, 1, 1)\n        # h_sex_nonmagic_base -> (1, n_alpha, 1)\n        # w_r -> (1, 1, n_r)\n        h_eco_3d = h_eco.reshape(n_sigma_c, 1, 1)\n        h_sex_nonmagic_3d = h_sex_nonmagic_base.reshape(1, n_alpha, 1) * w_r.reshape(1, 1, n_r)\n        \n        h_total_nonmagic = h_eco_3d + h_sex_nonmagic_3d\n\n        count_nonmagic = np.sum(h_total_nonmagic > 0)\n        m_nonmagic = float(count_nonmagic) / total_points_nonmagic if total_points_nonmagic > 0 else 0.0\n\n        # --- Final Calculation ---\n        delta = m_magic - m_nonmagic\n        results.append(round(delta, 6))\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2729706"}]}