{"hands_on_practices": [{"introduction": "Astrocytes act as dynamic information processors in the brain, largely communicating through fluctuations in their intracellular calcium concentration. This exercise delves into the heart of this process by modeling how astrocytes respond to neuroinflammatory signals like ATP. By analyzing a simplified system of ordinary differential equations, you will use the principles of linear stability to determine the critical conditions under which an astrocyte's calcium response transitions from a steady state to sustained oscillations, a fundamental shift in its signaling behavior [@problem_id:2876481].", "problem": "Astrocytes integrate danger-associated molecular patterns in the central nervous system and are robustly activated by extracellular Adenosine Triphosphate (ATP) released during neuroinflammatory signaling. Binding of ATP to Purinergic P2Y receptors (P2YR) activates phospholipase C, elevating the concentration of Inositol 1,4,5-trisphosphate (IP3), which in turn opens IP3 receptor channels on the Endoplasmic Reticulum (ER) to release calcium into the cytosol. Two robust and widely accepted bases relevant here are: (i) channel-mediated calcium fluxes and pump/leak fluxes superpose to determine the cytosolic calcium concentration, and (ii) the IP3 receptor open probability is biphasically regulated by calcium through fast activation and slower inactivation gating; near a steady state, the dynamics of small perturbations are well captured by linearization of the underlying nonlinear ordinary differential equations (ODEs).\n\nConsider a single-compartment astrocyte under a constant extracellular ATP concentration denoted by $A$ (held fixed in time). Let $x(t)$ denote the small deviation of cytosolic calcium from its steady state under this $A$, and let $y(t)$ denote the small deviation of the fraction of de-inactivated IP3 receptors from its steady state. Linearization of the biophysical flux-balance ODEs around the steady state yields the small-signal system\n$$\n\\frac{d}{dt}\\begin{pmatrix} x \\\\ y \\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha_{0} + \\alpha_{1}\\,A  \\beta_{1}\\,A \\\\\n-\\,\\chi  -\\,\\kappa\n\\end{pmatrix}\n\\begin{pmatrix} x \\\\ y \\end{pmatrix},\n$$\nwhere:\n- $\\alpha_{0}$ captures the net linearized removal of calcium by pumps minus leak and basal release at vanishing agonist drive and satisfies $\\alpha_{0}  0$,\n- $\\alpha_{1}  0$ captures the calcium-induced calcium release gain that increases with ATP-dependent IP3 production,\n- $\\beta_{1}  0$ captures the sensitivity of channel-mediated calcium flux to the inactivation gate,\n- $\\chi  0$ captures the calcium-dependent inactivation rate sensitivity of the gate,\n- $\\kappa  0$ is the gate’s relaxation rate toward its steady state.\n\nUsing only first principles of linear stability for two-dimensional ODE systems and the biological sign constraints above, determine the exact ATP concentration $A_{\\mathrm{crit}}$ at which the system’s steady response transitions from non-oscillatory to oscillatory in the small-signal sense (that is, where the eigenvalues of the Jacobian move from real to complex-conjugate). Express your final result as a closed-form analytic expression in terms of the model parameters. Also identify in your working the parameter condition that must hold at this threshold for a bona fide Hopf-type onset of oscillations (purely imaginary eigenvalues with positive determinant). Do not substitute numerical values. Provide only $A_{\\mathrm{crit}}$ as your final answer. No rounding is required, and no units should be included in the final answer box.", "solution": "The problem requires the determination of the critical ATP concentration, denoted as $A_{\\mathrm{crit}}$, at which a linearized model of astrocyte calcium dynamics transitions from a non-oscillatory to an oscillatory response. The system is described by a set of two linear ordinary differential equations:\n$$\n\\frac{d}{dt}\\begin{pmatrix} x \\\\ y \\end{pmatrix}\n=\nJ\n\\begin{pmatrix} x \\\\ y \\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha_{0} + \\alpha_{1}\\,A  \\beta_{1}\\,A \\\\\n-\\,\\chi  -\\,\\kappa\n\\end{pmatrix}\n\\begin{pmatrix} x \\\\ y \\end{pmatrix}\n$$\nThe parameters are given with the following sign constraints: $\\alpha_{0}  0$, $\\alpha_{1}  0$, $\\beta_{1}  0$, $\\chi  0$, and $\\kappa  0$.\n\nFirst, a validation of the problem statement is necessary.\nThe problem is scientifically grounded in the established theory of cellular calcium dynamics and neuro-glial signaling. The use of linearization and stability analysis of a Jacobian matrix is a standard and rigorous method in mathematical biology for studying the behavior of systems near a steady state. The model parameters are defined with biophysically plausible roles and sign constraints. The problem is well-posed, providing all necessary information to determine a unique solution for the stated conditions. The language is objective and precise. Therefore, the problem is deemed valid and a solution may be pursued.\n\nThe nature of the solutions to this linear system is determined by the eigenvalues of the Jacobian matrix $J$. The eigenvalues, $\\lambda$, are the roots of the characteristic equation $\\lambda^2 - \\mathrm{Tr}(J)\\lambda + \\mathrm{Det}(J) = 0$. The trace, $\\mathrm{Tr}(J)$, and determinant, $\\mathrm{Det}(J)$, of the matrix are functions of the ATP concentration $A$:\n$$\n\\mathrm{Tr}(J) = (\\alpha_{0} + \\alpha_{1}\\,A) - \\kappa = \\alpha_{0} - \\kappa + \\alpha_{1}A\n$$\n$$\n\\mathrm{Det}(J) = (\\alpha_{0} + \\alpha_{1}\\,A)(-\\kappa) - (\\beta_{1}\\,A)(-\\chi) = -\\kappa\\alpha_{0} - \\kappa\\alpha_{1}A + \\chi\\beta_{1}A = -\\kappa\\alpha_{0} + (\\chi\\beta_{1} - \\kappa\\alpha_{1})A\n$$\nThe eigenvalues are given by $\\lambda_{1,2} = \\frac{1}{2}\\left(\\mathrm{Tr}(J) \\pm \\sqrt{\\mathrm{Tr}(J)^2 - 4\\,\\mathrm{Det}(J)}\\right)$.\n\nThe transition from real eigenvalues (non-oscillatory behavior) to complex-conjugate eigenvalues (oscillatory behavior) occurs when the discriminant of the characteristic equation, $\\Delta = \\mathrm{Tr}(J)^2 - 4\\,\\mathrm{Det}(J)$, changes from positive to zero to negative. The boundary is at $\\Delta = 0$.\n\nHowever, the problem also asks for the condition for a \"bona fide Hopf-type onset of oscillations\". A Hopf bifurcation is a critical point where a system's stability switches as a pair of complex conjugate eigenvalues crosses the imaginary axis of the complex plane. This event marks the birth of sustained oscillations (a limit cycle) from a fixed point, which is the most meaningful sense of an \"onset of oscillations\" in a biophysical context. A Hopf bifurcation occurs under two specific conditions:\n1.  The real part of the eigenvalues is zero: $\\mathrm{Re}(\\lambda) = 0$. For a 2D system, this is equivalent to the trace of the Jacobian being zero: $\\mathrm{Tr}(J) = 0$.\n2.  The imaginary part of the eigenvalues is non-zero. This requires the determinant of the Jacobian to be positive: $\\mathrm{Det}(J)  0$.\n\nInterpreting the problem's reference to a \"bona fide Hopf-type onset\" as the key requirement, we identify the critical concentration $A_{\\mathrm{crit}}$ as the value of $A$ at which the trace of the Jacobian is zero.\n\nWe set the trace to zero and solve for $A_{\\mathrm{crit}}$:\n$$\n\\mathrm{Tr}(J) = \\alpha_{0} - \\kappa + \\alpha_{1}A_{\\mathrm{crit}} = 0\n$$\nSolving for $A_{\\mathrm{crit}}$ yields:\n$$\n\\alpha_{1}A_{\\mathrm{crit}} = \\kappa - \\alpha_{0}\n$$\n$$\nA_{\\mathrm{crit}} = \\frac{\\kappa - \\alpha_{0}}{\\alpha_{1}}\n$$\nGiven the sign constraints ($\\kappa0$, $\\alpha_00$, $\\alpha_10$), the numerator $\\kappa-\\alpha_0$ is strictly positive, and the denominator $\\alpha_1$ is strictly positive. Thus, $A_{\\mathrm{crit}}$ is a physically meaningful positive concentration.\n\nNext, we identify the parameter condition required for a true Hopf bifurcation at this threshold. We must ensure that $\\mathrm{Det}(J)  0$ when $A = A_{\\mathrm{crit}}$. We substitute the expression for $A_{\\mathrm{crit}}$ into the determinant:\n$$\n\\mathrm{Det}(J(A_{\\mathrm{crit}})) = -\\kappa\\alpha_{0} + (\\chi\\beta_{1} - \\kappa\\alpha_{1})A_{\\mathrm{crit}}\n$$\n$$\n\\mathrm{Det}(J(A_{\\mathrm{crit}})) = -\\kappa\\alpha_{0} + (\\chi\\beta_{1} - \\kappa\\alpha_{1})\\left(\\frac{\\kappa - \\alpha_{0}}{\\alpha_{1}}\\right)\n$$\nTo simplify, we multiply the first term by $\\frac{\\alpha_{1}}{\\alpha_1}$:\n$$\n\\mathrm{Det}(J(A_{\\mathrm{crit}})) = \\frac{-\\kappa\\alpha_{0}\\alpha_{1} + (\\chi\\beta_{1} - \\kappa\\alpha_{1})(\\kappa - \\alpha_{0})}{\\alpha_{1}}\n$$\nExpanding the numerator:\n$$\n-\\kappa\\alpha_{0}\\alpha_{1} + \\chi\\beta_{1}\\kappa - \\chi\\beta_{1}\\alpha_{0} - \\kappa^2\\alpha_{1} + \\kappa\\alpha_{0}\\alpha_{1} = \\chi\\beta_{1}\\kappa - \\chi\\beta_{1}\\alpha_{0} - \\kappa^2\\alpha_{1} = \\chi\\beta_{1}(\\kappa - \\alpha_{0}) - \\kappa^2\\alpha_{1}\n$$\nSo, the determinant at the critical point is:\n$$\n\\mathrm{Det}(J(A_{\\mathrm{crit}})) = \\frac{\\chi\\beta_{1}(\\kappa - \\alpha_{0}) - \\kappa^2\\alpha_{1}}{\\alpha_{1}}\n$$\nThe condition $\\mathrm{Det}(J(A_{\\mathrm{crit}}))  0$, since $\\alpha_1  0$, simplifies to:\n$$\n\\chi\\beta_{1}(\\kappa - \\alpha_{0})  \\alpha_{1}\\kappa^2\n$$\nThis is the parameter condition for the occurrence of a Hopf bifurcation at $A = A_{\\mathrm{crit}}$.\n\nThe problem asks for the expression for $A_{\\mathrm{crit}}$. Based on the reasoning that the physically relevant transition to oscillations is the Hopf bifurcation, the result is the value of $A$ that nullifies the trace of the Jacobian.", "answer": "$$\\boxed{\\frac{\\kappa - \\alpha_{0}}{\\alpha_{1}}}$$", "id": "2876481"}, {"introduction": "Building on the dynamics within a single cell, we now turn to the functional consequences of communication between cells, specifically how activated microglia regulate astrocyte function. Astrocytes play a vital role in maintaining synaptic health by clearing excess glutamate, and this process can be precisely modeled using Michaelis-Menten kinetics. This problem challenges you to quantify the impact of a microglia-derived inflammatory signal, Tumor Necrosis Factor (TNF), on the rate of astrocytic glutamate uptake, providing a tangible link between neuroinflammation and potential excitotoxicity [@problem_id:2876469].", "problem": "Neuroinflammatory signaling from microglia affects astrocytic glutamate clearance by modifying the expression of the astrocytic Excitatory Amino Acid Transporter 2 (EAAT2). In a simplified, well-mixed extracellular compartment adjacent to an astrocyte, assume that EAAT2-mediated glutamate uptake can be modeled as a single-substrate, saturable transport process that follows the quasi–steady-state kinetics of an enzyme–substrate system, where the transporter is the enzyme. Start from the law of mass action applied to the elementary steps of transporter–substrate binding and unbinding, and the formation of transported product, and use the quasi–steady-state approximation for the transporter–substrate complex to derive the uptake rate as a function of the extracellular glutamate concentration, the maximal transport capacity, and the Michaelis constant.\n\nConsider the following biologically plausible parameters measured in an astrocyte-enriched membrane preparation:\n- Extracellular glutamate concentration is $[{\\mathrm{Glu}}] = 25~\\mu\\mathrm{M}$.\n- Basal maximal uptake capacity is $V_{max,\\mathrm{basal}} = 150$ pmol s$^{-1}$ mg$^{-1}$ protein.\n- Michaelis constant is $K_m = 30~\\mu\\mathrm{M}$.\n\nUnder microglia-derived Tumor Necrosis Factor (TNF) exposure, EAAT2 surface density is reduced due to transcriptional downregulation and altered trafficking. Assume that TNF causes a fractional reduction of $0.35$ in the total number of functional EAAT2 transporters at the membrane, with no change in individual transporter turnover or binding kinetics over the timescale considered, so that $K_m$ is unchanged and the new maximal capacity scales proportionally with transporter number.\n\nTasks:\n- Using the derivation described above, compute the basal glutamate uptake rate mediated by EAAT2 at the given $[{\\mathrm{Glu}}]$.\n- Incorporate the TNF-driven change to determine the new uptake rate under TNF exposure at the same $[{\\mathrm{Glu}}]$.\n\nReport only the TNF-exposed uptake rate as your final numeric answer. Express the final rate in pmol s$^{-1}$ mg$^{-1}$ protein and round your answer to four significant figures.", "solution": "The problem as stated will be validated before any attempt at a solution.\n\nStep 1: Extraction of Givens\n- Modeling approach: Glutamate uptake by EAAT2 is modeled as a single-substrate, saturable transport process following quasi-steady-state kinetics.\n- Derivation requirement: Derive the uptake rate from the law of mass action and the quasi-steady-state approximation.\n- Basal parameters:\n    - Extracellular glutamate concentration, $[{\\mathrm{Glu}}] = 25~\\mu\\mathrm{M}$.\n    - Basal maximal uptake capacity, $V_{max,\\mathrm{basal}} = 150$ pmol s$^{-1}$ mg$^{-1}$ protein.\n    - Michaelis constant, $K_m = 30~\\mu\\mathrm{M}$.\n- Condition under TNF exposure:\n    - Fractional reduction in functional EAAT2 transporters = $0.35$.\n    - The Michaelis constant, $K_m$, is unchanged.\n    - The new maximal capacity, $V_{max,\\mathrm{TNF}}$, scales proportionally with the number of transporters.\n- Required output:\n    - The TNF-exposed glutamate uptake rate.\n    - The final answer must be a numerical value in pmol s$^{-1}$ mg$^{-1}$ protein, rounded to four significant figures.\n\nStep 2: Validation\nThe problem is subjected to validation against established criteria.\n- **Scientific Grounding**: The problem is scientifically sound. It employs the Michaelis-Menten kinetic model, which is the standard framework for describing enzyme and transporter kinetics. The scenario described—neuroinflammatory modulation of astrocytic glutamate transporter expression by TNF—is a well-documented and fundamental concept in neuroimmunology. The provided parameter values are biologically plausible.\n- **Well-Posedness**: The problem is well-posed. It requires the derivation of a standard model and its application to a clearly defined initial state and a perturbed state. The effect of the perturbation is explicitly quantified, ensuring a unique solution exists.\n- **Objectivity**: The problem is formulated using precise, objective, and quantitative language, free of any subjective or ambiguous terminology.\n- **Completeness and Consistency**: The problem is self-contained and provides all necessary information and constraints for its solution. There are no internal contradictions.\n- **Feasibility**: The conditions and parameters are physically and biologically realistic for an in vitro or computational model of astrocytic function.\n\nStep 3: Verdict\nThe problem is deemed valid. A solution will be formulated.\n\nThe problem requires the derivation of the rate equation for a saturable transport process based on the quasi-steady-state approximation. Let $E$ represent the transporter (EAAT2), $S$ be the extracellular substrate (glutamate), $ES$ be the transporter-substrate complex, and $P$ be the transported product (intracellular glutamate). The process is described by the following elementary steps:\n- Binding of substrate to the transporter: $E + S \\xrightarrow{k_1} ES$\n- Unbinding of substrate from the complex: $ES \\xrightarrow{k_{-1}} E + S$\n- Translocation and release of product: $ES \\xrightarrow{k_2} E + P$\n\nThis can be written as a single reaction scheme:\n$$E + S \\underset{k_{-1}}{\\stackrel{k_1}{\\rightleftharpoons}} ES \\xrightarrow{k_2} E + P$$\nAccording to the law of mass action, the rate of change of the transporter-substrate complex concentration, $[ES]$, is given by:\n$$\\frac{d[ES]}{dt} = k_1 [E][S] - k_{-1}[ES] - k_2[ES] = k_1 [E][S] - (k_{-1} + k_2)[ES]$$\nThe total concentration of the transporter, $[E_T]$, is constant and is the sum of the free transporter and the bound transporter:\n$$[E_T] = [E] + [ES]$$\nThus, the concentration of the free transporter is $[E] = [E_T] - [ES]$. Substituting this into the rate equation for $[ES]$:\n$$\\frac{d[ES]}{dt} = k_1 ([E_T] - [ES])[S] - (k_{-1} + k_2)[ES]$$\nThe quasi-steady-state approximation (QSSA) assumes that the concentration of the intermediate complex $[ES]$ changes much more slowly than the substrate and product concentrations, and thus its rate of change can be set to zero:\n$$\\frac{d[ES]}{dt} \\approx 0$$\nApplying this approximation yields:\n$$k_1 ([E_T] - [ES])[S] = (k_{-1} + k_2)[ES]$$\nWe can now solve for the steady-state concentration of the complex, $[ES]$:\n$$k_1 [E_T][S] - k_1 [ES][S] = (k_{-1} + k_2)[ES]$$\n$$k_1 [E_T][S] = (k_1[S] + k_{-1} + k_2)[ES]$$\n$$[ES] = \\frac{k_1 [E_T][S]}{k_1[S] + k_{-1} + k_2}$$\nDividing the numerator and denominator by $k_1$:\n$$[ES] = \\frac{[E_T][S]}{[S] + \\frac{k_{-1} + k_2}{k_1}}$$\nWe define the Michaelis constant, $K_m$, as the ratio of rate constants:\n$$K_m = \\frac{k_{-1} + k_2}{k_1}$$\nSubstituting $K_m$ into the expression for $[ES]$ gives:\n$$[ES] = \\frac{[E_T][S]}{K_m + [S]}$$\nThe rate of glutamate uptake, $v$, is the rate of product formation, which is proportional to the concentration of the $ES$ complex:\n$$v = \\frac{d[P]}{dt} = k_2 [ES]$$\nSubstituting the expression for $[ES]$:\n$$v = \\frac{k_2 [E_T][S]}{K_m + [S]}$$\nThe maximal uptake rate, $V_{max}$, is achieved when the transporter is saturated with substrate ($[S] \\to \\infty$), at which point $[ES] \\to [E_T]$ and the rate is $v = k_2[E_T]$. Therefore, we define:\n$$V_{max} = k_2 [E_T]$$\nSubstituting $V_{max}$ into the rate equation gives the final form of the Michaelis-Menten equation:\n$$v = \\frac{V_{max}[S]}{K_m + [S]}$$\nIn the context of this problem, $v$ is the uptake rate, $[S]$ is the glutamate concentration $[{\\mathrm{Glu}}]$, and $V_{max}$ and $K_m$ are the given parameters.\n\nFirst, we calculate the basal glutamate uptake rate, $v_{\\mathrm{basal}}$, using the provided basal parameters: $V_{max,\\mathrm{basal}} = 150$ pmol s$^{-1}$ mg$^{-1}$, $K_m = 30~\\mu\\mathrm{M}$, and $[{\\mathrm{Glu}}] = 25~\\mu\\mathrm{M}$.\n$$v_{\\mathrm{basal}} = \\frac{V_{max,\\mathrm{basal}} [{\\mathrm{Glu}}]}{K_m + [{\\mathrm{Glu}}]} = \\frac{150 \\times 25}{30 + 25} = \\frac{3750}{55} \\approx 68.18 \\text{ pmol s}^{-1} \\text{mg}^{-1}$$\n\nNext, we address the effect of TNF exposure. TNF causes a fractional reduction of $0.35$ in the number of functional transporters. Since $V_{max}$ is directly proportional to the total transporter concentration ($V_{max} = k_2 [E_T]$), a reduction in $[E_T]$ causes a proportional reduction in $V_{max}$. The new maximal uptake capacity, $V_{max,\\mathrm{TNF}}$, is:\n$$V_{max,\\mathrm{TNF}} = V_{max,\\mathrm{basal}} \\times (1 - 0.35) = 150 \\times 0.65 = 97.5 \\text{ pmol s}^{-1} \\text{mg}^{-1}$$\nThe problem states that $K_m$ and $[{\\mathrm{Glu}}]$ are unchanged. We can now compute the new uptake rate under TNF exposure, $v_{\\mathrm{TNF}}$:\n$$v_{\\mathrm{TNF}} = \\frac{V_{max,\\mathrm{TNF}} [{\\mathrm{Glu}}]}{K_m + [{\\mathrm{Glu}}]}$$\nSubstituting the values:\n$$v_{\\mathrm{TNF}} = \\frac{97.5 \\times 25}{30 + 25} = \\frac{2437.5}{55} \\approx 44.31818... \\text{ pmol s}^{-1} \\text{mg}^{-1}$$\nThe problem requires the final answer to be rounded to four significant figures.\n$$v_{\\mathrm{TNF}} \\approx 44.32 \\text{ pmol s}^{-1} \\text{mg}^{-1}$$\nThis is the final numerical answer.", "answer": "$$\\boxed{44.32}$$", "id": "2876469"}, {"introduction": "Cellular interactions in the brain are not random; they are intricately organized in space. To understand tissue-level function and dysfunction, we must analyze these spatial patterns. This exercise introduces a core task in spatial biology: quantifying the co-localization of specific gene expression programs in different cell types, such as reactive astrocyte C3 expression and activated microglial TREM2 expression [@problem_id:2876503]. You will implement a custom co-localization score from first principles, learning how to combine spatial adjacency information with expression data to test hypotheses about neuroinflammatory cellular crosstalk in a tissue context.", "problem": "You are given a mathematical abstraction of a spatial transcriptomics (ST) experiment measuring messenger ribonucleic acid (mRNA) abundance from tissue domains (spots). Each tissue domain is a mixture of cell types, including astrocytes and microglia. You will compute a co-localization score that quantifies the spatial co-occurrence of astrocyte-associated Complement component $3$ (C3) expression and microglia-associated Triggering Receptor Expressed on Myeloid cells $2$ (TREM2) expression across tissue domains. The score must be derived from first principles using definitions of cell-type mixing, spatial adjacency, and statistical correlation, and implemented as a program.\n\nUse the following definitions as the sole starting point.\n- Cell-type mixed expression: In a tissue domain indexed by $i \\in \\{1,\\dots,n\\}$, the domain-level gene expression for gene $g$ is the sum of contributions from constituent cell types. If $f_{\\mathrm{astro},i} \\in [0,1]$ and $f_{\\mathrm{micro},i} \\in [0,1]$ denote the astrocyte and microglia fractions (with all fractions summing to at most $1$ across all cell types in domain $i$), then an astrocyte-weighted C3 signal can be estimated as $X_i = f_{\\mathrm{astro},i} \\cdot \\mathrm{C3}_i$ and a microglia-weighted TREM2 signal as $Y_i = f_{\\mathrm{micro},i} \\cdot \\mathrm{TREM2}_i$. This follows the well-tested mixture interpretation of ST domain signals as convex combinations of cell-type signals.\n- Spatial adjacency and spatial lag: For two domains $i$ and $j$ with coordinates $(x_i,y_i)$ and $(x_j,y_j)$ in the plane, define the Euclidean distance $d_{ij} = \\sqrt{(x_i - x_j)^2 + (y_i - y_j)^2}$. For a radius parameter $r  0$, define the adjacency weight $w_{ij}$ by $w_{ij} = 1$ if $0  d_{ij} \\le r$ and $w_{ij} = 0$ otherwise, and set $w_{ii} = 0$. Row-normalize to obtain $\\tilde{w}_{ij} = \\frac{w_{ij}}{\\sum_{k=1}^n w_{ik}}$ when $\\sum_{k=1}^n w_{ik}  0$, and $\\tilde{w}_{ij} = 0$ for all $j$ if $\\sum_{k=1}^n w_{ik} = 0$. The spatially lagged microglial field is $L_i = \\sum_{j=1}^n \\tilde{w}_{ij} Y_j$.\n- Correlation-based co-localization: The co-localization score $S$ is defined as the Pearson correlation between the astrocyte-weighted C3 field and the spatially lagged microglial TREM2 field, namely $S = \\frac{\\mathrm{Cov}(X,L)}{\\sigma_X \\sigma_L}$, where $\\mathrm{Cov}(X,L)$ is the covariance between $X$ and $L$, and $\\sigma_X$ and $\\sigma_L$ are the standard deviations of $X$ and $L$, respectively. If $\\sigma_X = 0$ or $\\sigma_L = 0$, define $S = 0$ by convention.\n\nYour task is to implement a program that, for each test case below, computes the co-localization score $S$ strictly according to the above definitions.\n\nTest suite. For each case, you are given the list of coordinates $\\{(x_i,y_i)\\}_{i=1}^n$, arrays $\\{\\mathrm{C3}_i\\}_{i=1}^n$, $\\{\\mathrm{TREM2}_i\\}_{i=1}^n$, fractions $\\{f_{\\mathrm{astro},i}\\}_{i=1}^n$, $\\{f_{\\mathrm{micro},i}\\}_{i=1}^n$, and radius $r$.\n\n- Case $1$ (happy path; positive co-localization):\n  - Coordinates: $\\{(0,0), (1,0), (2,0)\\}$.\n  - $\\mathrm{C3}$: $\\{3,1,3\\}$.\n  - $\\mathrm{TREM2}$: $\\{1,3,1\\}$.\n  - $f_{\\mathrm{astro}}$: $\\{1,1,1\\}$.\n  - $f_{\\mathrm{micro}}$: $\\{1,1,1\\}$.\n  - Radius: $r = 1.1$.\n\n- Case $2$ (anti-localization; negative co-localization):\n  - Coordinates: $\\{(0,0), (1,0), (2,0)\\}$.\n  - $\\mathrm{C3}$: $\\{1,3,1\\}$.\n  - $\\mathrm{TREM2}$: $\\{1,3,1\\}$.\n  - $f_{\\mathrm{astro}}$: $\\{1,1,1\\}$.\n  - $f_{\\mathrm{micro}}$: $\\{1,1,1\\}$.\n  - Radius: $r = 1.1$.\n\n- Case $3$ (no neighbors; boundary with isolated domains):\n  - Coordinates: $\\{(0,0), (10,0)\\}$.\n  - $\\mathrm{C3}$: $\\{2,4\\}$.\n  - $\\mathrm{TREM2}$: $\\{3,1\\}$.\n  - $f_{\\mathrm{astro}}$: $\\{0.5,0.5\\}$.\n  - $f_{\\mathrm{micro}}$: $\\{0.5,0.5\\}$.\n  - Radius: $r = 1.0$.\n\n- Case $4$ (zero variance in astrocyte-weighted C3):\n  - Coordinates: $\\{(0,0), (1,0), (0,1), (1,1)\\}$.\n  - $\\mathrm{C3}$: $\\{2,2,2,2\\}$.\n  - $\\mathrm{TREM2}$: $\\{1,4,2,3\\}$.\n  - $f_{\\mathrm{astro}}$: $\\{1,1,1,1\\}$.\n  - $f_{\\mathrm{micro}}$: $\\{1,1,1,1\\}$.\n  - Radius: $r = 1.1$.\n\nRequirements and output format:\n- Implement the computation exactly as specified by the definitions above.\n- For each case, output the scalar co-localization score $S$ as a floating-point number.\n- Your program should produce a single line of output containing the results for all cases, in order, as a comma-separated list enclosed in square brackets (for example, $[$$s_1$,$s_2$,$s_3$,$s_4$$]$). No units are required and no additional text should be printed.", "solution": "The problem presented is a well-defined computational task in the domain of spatial bioinformatics, requiring the calculation of a co-localization score between two gene expression signals. The problem is scientifically grounded, mathematically precise, and internally consistent. Therefore, it is valid, and a solution can be derived by a systematic application of the provided definitions.\n\nThe objective is to compute the co-localization score, $S$, which quantifies the spatial co-occurrence of astrocyte-associated Complement component $3$ (C3) expression with microglia-associated Triggering Receptor Expressed on Myeloid cells $2$ (TREM2) expression. The score is defined as the Pearson correlation coefficient between an astrocyte-weighted C3 field, denoted by the vector $X$, and a spatially lagged, microglia-weighted TREM2 field, denoted by the vector $L$.\n\nLet us proceed with the derivation step-by-step. The tissue consists of $n$ domains, indexed by $i \\in \\{1, \\dots, n\\}$.\n\nFirst, we compute the cell-type-specific weighted expression signals. The astrocyte-weighted C3 signal for domain $i$ is $X_i$, and the microglia-weighted TREM2 signal is $Y_i$. These are given by:\n$$X_i = f_{\\mathrm{astro},i} \\cdot \\mathrm{C3}_i$$\n$$Y_i = f_{\\mathrm{micro},i} \\cdot \\mathrm{TREM2}_i$$\nThis yields two vectors, $X = \\{X_1, X_2, \\dots, X_n\\}$ and $Y = \\{Y_1, Y_2, \\dots, Y_n\\}$.\n\nSecond, we establish the spatial relationships between domains. We construct an $n \\times n$ adjacency matrix, $W$, based on the Euclidean distance $d_{ij} = \\sqrt{(x_i - x_j)^2 + (y_i - y_j)^2}$ between domain $i$ at $(x_i, y_i)$ and domain $j$ at $(x_j, y_j)$. The elements of $W$, denoted $w_{ij}$, are defined as:\n$$\nw_{ij} =\n\\begin{cases}\n1  \\text{if } 0  d_{ij} \\le r \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nThe diagonal elements $w_{ii}$ are set to $0$.\n\nThird, we row-normalize the adjacency matrix $W$ to create $\\tilde{W}$. Row normalization ensures that the influence of all neighbors on a given domain sums to unity, unless a domain has no neighbors. For each row $i$, the sum of weights is $W_{i, \\text{sum}} = \\sum_{k=1}^n w_{ik}$. The elements $\\tilde{w}_{ij}$ are:\n$$\n\\tilde{w}_{ij} =\n\\begin{cases}\n\\frac{w_{ij}}{W_{i, \\text{sum}}}  \\text{if } W_{i, \\text{sum}}  0 \\\\\n0  \\text{if } W_{i, \\text{sum}} = 0\n\\end{cases}\n$$\n\nFourth, we compute the spatially lagged microglial field, $L$. The value $L_i$ for each domain $i$ is the average of the $Y_j$ values over its neighboring domains, as defined by $\\tilde{W}$:\n$$L_i = \\sum_{j=1}^n \\tilde{w}_{ij} Y_j$$\nThis operation can be expressed as a matrix-vector product $L = \\tilde{W}Y$.\n\nFinally, we compute the co-localization score $S$ as the Pearson correlation coefficient between the vectors $X$ and $L$:\n$$S = \\frac{\\mathrm{Cov}(X,L)}{\\sigma_X \\sigma_L} = \\frac{\\sum_{i=1}^n (X_i - \\bar{X})(L_i - \\bar{L})}{\\sqrt{\\sum_{i=1}^n (X_i - \\bar{X})^2} \\sqrt{\\sum_{i=1}^n (L_i - \\bar{L})^2}}$$\nwhere $\\bar{X}$ and $\\bar{L}$ are the means of $X$ and $L$, respectively. The problem specifies that if either standard deviation $\\sigma_X$ or $\\sigma_L$ is zero, the score $S$ is defined to be $0$.\n\nWe now apply this procedure to each test case.\n\n**Case 1:**\n- Coordinates: $\\{(0,0), (1,0), (2,0)\\}$. $n=3$.\n- $\\mathrm{C3}$: $\\{3,1,3\\}$. $\\mathrm{TREM2}$: $\\{1,3,1\\}$.\n- $f_{\\mathrm{astro}}$: $\\{1,1,1\\}$. $f_{\\mathrm{micro}}$: $\\{1,1,1\\}$.\n- Radius: $r = 1.1$.\n1.  $X = \\{1 \\cdot 3, 1 \\cdot 1, 1 \\cdot 3\\} = \\{3, 1, 3\\}$.\n2.  $Y = \\{1 \\cdot 1, 1 \\cdot 3, 1 \\cdot 1\\} = \\{1, 3, 1\\}$.\n3.  Distances: $d_{12}=1$, $d_{13}=2$, $d_{23}=1$. The adjacency matrix $W$ for $r=1.1$ is $W = \\begin{pmatrix} 0  1  0 \\\\ 1  0  1 \\\\ 0  1  0 \\end{pmatrix}$.\n4.  Row sums of $W$ are $\\{1, 2, 1\\}$. The normalized matrix is $\\tilde{W} = \\begin{pmatrix} 0  1  0 \\\\ 0.5  0  0.5 \\\\ 0  1  0 \\end{pmatrix}$.\n5.  $L = \\tilde{W}Y = \\{1 \\cdot 3, 0.5 \\cdot 1 + 0.5 \\cdot 1, 1 \\cdot 3\\} = \\{3, 1, 3\\}$.\n6.  We must compute $\\mathrm{Corr}(X, L)$ for $X=\\{3,1,3\\}$ and $L=\\{3,1,3\\}$. Since $X$ and $L$ are identical and not constant, their correlation is exactly $1$.\n    $S_1 = 1.0$.\n\n**Case 2:**\n- Coordinates: $\\{(0,0), (1,0), (2,0)\\}$. $n=3$.\n- $\\mathrm{C3}$: $\\{1,3,1\\}$. $\\mathrm{TREM2}$: $\\{1,3,1\\}$.\n- $f_{\\mathrm{astro}}$: $\\{1,1,1\\}$. $f_{\\mathrm{micro}}$: $\\{1,1,1\\}$.\n- Radius: $r = 1.1$.\n1.  $X = \\{1 \\cdot 1, 1 \\cdot 3, 1 \\cdot 1\\} = \\{1, 3, 1\\}$.\n2.  $Y = \\{1 \\cdot 1, 1 \\cdot 3, 1 \\cdot 1\\} = \\{1, 3, 1\\}$.\n3.  The matrix $\\tilde{W}$ is the same as in Case 1: $\\tilde{W} = \\begin{pmatrix} 0  1  0 \\\\ 0.5  0  0.5 \\\\ 0  1  0 \\end{pmatrix}$.\n4.  $L = \\tilde{W}Y = \\{1 \\cdot 3, 0.5 \\cdot 1 + 0.5 \\cdot 1, 1 \\cdot 3\\} = \\{3, 1, 3\\}$.\n5.  We must compute $\\mathrm{Corr}(X, L)$ for $X=\\{1,3,1\\}$ and $L=\\{3,1,3\\}$.\n    - $\\bar{X} = (1+3+1)/3 = 5/3$. $X - \\bar{X} = \\{-2/3, 4/3, -2/3\\}$.\n    - $\\bar{L} = (3+1+3)/3 = 7/3$. $L - \\bar{L} = \\{2/3, -4/3, 2/3\\}$.\n    - Notice that $X - \\bar{X} = -c \\cdot (L - \\bar{L})$ for some positive constant $c$. Specifically, $X - \\bar{X}$ is perfectly anti-correlated with $L - \\bar{L}$. The correlation must be $-1$.\n    $S_2 = -1.0$.\n\n**Case 3:**\n- Coordinates: $\\{(0,0), (10,0)\\}$. $n=2$.\n- $\\mathrm{C3}$: $\\{2,4\\}$. $\\mathrm{TREM2}$: $\\{3,1\\}$.\n- $f_{\\mathrm{astro}}$: $\\{0.5,0.5\\}$. $f_{\\mathrm{micro}}$: $\\{0.5,0.5\\}$.\n- Radius: $r = 1.0$.\n1.  $X = \\{0.5 \\cdot 2, 0.5 \\cdot 4\\} = \\{1.0, 2.0\\}$.\n2.  $Y = \\{0.5 \\cdot 3, 0.5 \\cdot 1\\} = \\{1.5, 0.5\\}$.\n3.  The distance $d_{12}=10$, which is greater than $r=1.0$. Thus, there are no neighbors. $W = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\n4.  The row sums of $W$ are both $0$. According to the definition, $\\tilde{W} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}$.\n5.  $L = \\tilde{W}Y = \\{0, 0\\}$.\n6.  The vector $L$ is constant, so its standard deviation $\\sigma_L$ is $0$. By the given convention, the co-localization score is $0$.\n    $S_3 = 0.0$.\n\n**Case 4:**\n- Coordinates: $\\{(0,0), (1,0), (0,1), (1,1)\\}$. $n=4$.\n- $\\mathrm{C3}$: $\\{2,2,2,2\\}$. $\\mathrm{TREM2}$: $\\{1,4,2,3\\}$.\n- $f_{\\mathrm{astro}}$: $\\{1,1,1,1\\}$. $f_{\\mathrm{micro}}$: $\\{1,1,1,1\\}$.\n- Radius: $r = 1.1$.\n1.  $X = \\{1 \\cdot 2, 1 \\cdot 2, 1 \\cdot 2, 1 \\cdot 2\\} = \\{2, 2, 2, 2\\}$.\n2.  The vector $X$ is constant. Its standard deviation $\\sigma_X$ is $0$.\n3.  According to the provided definition, if $\\sigma_X = 0$, the co-localization score is $0$, regardless of the value of $L$. There is no need to compute $L$.\n    $S_4 = 0.0$.\n\nIn summary, the results for the four cases are $S_1=1.0$, $S_2=-1.0$, $S_3=0.0$, and $S_4=0.0$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.distance import pdist, squareform\n\ndef solve():\n    \"\"\"\n    Solves the co-localization score problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"coords\": np.array([[0,0], [1,0], [2,0]]),\n            \"c3\": np.array([3,1,3]),\n            \"trem2\": np.array([1,3,1]),\n            \"f_astro\": np.array([1,1,1]),\n            \"f_micro\": np.array([1,1,1]),\n            \"r\": 1.1\n        },\n        {\n            \"coords\": np.array([[0,0], [1,0], [2,0]]),\n            \"c3\": np.array([1,3,1]),\n            \"trem2\": np.array([1,3,1]),\n            \"f_astro\": np.array([1,1,1]),\n            \"f_micro\": np.array([1,1,1]),\n            \"r\": 1.1\n        },\n        {\n            \"coords\": np.array([[0,0], [10,0]]),\n            \"c3\": np.array([2,4]),\n            \"trem2\": np.array([3,1]),\n            \"f_astro\": np.array([0.5,0.5]),\n            \"f_micro\": np.array([0.5,0.5]),\n            \"r\": 1.0\n        },\n        {\n            \"coords\": np.array([[0,0], [1,0], [0,1], [1,1]]),\n            \"c3\": np.array([2,2,2,2]),\n            \"trem2\": np.array([1,4,2,3]),\n            \"f_astro\": np.array([1,1,1,1]),\n            \"f_micro\": np.array([1,1,1,1]),\n            \"r\": 1.1\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        score = calculate_colocalization_score(\n            coords=case[\"coords\"],\n            c3_expr=case[\"c3\"],\n            trem2_expr=case[\"trem2\"],\n            f_astro=case[\"f_astro\"],\n            f_micro=case[\"f_micro\"],\n            r=case[\"r\"]\n        )\n        results.append(score)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_colocalization_score(coords, c3_expr, trem2_expr, f_astro, f_micro, r):\n    \"\"\"\n    Computes the co-localization score S according to the problem definition.\n    \n    Args:\n        coords (np.ndarray): N-by-2 array of domain coordinates.\n        c3_expr (np.ndarray): N-element array of C3 expression.\n        trem2_expr (np.ndarray): N-element array of TREM2 expression.\n        f_astro (np.ndarray): N-element array of astrocyte fractions.\n        f_micro (np.ndarray): N-element array of microglia fractions.\n        r (float): Radius for spatial adjacency.\n\n    Returns:\n        float: The co-localization score S.\n    \"\"\"\n    \n    # Step 1: Compute cell-type mixed expression signals\n    X = f_astro * c3_expr\n    Y = f_micro * trem2_expr\n\n    # Check for zero variance in X before proceeding, as per problem definition.\n    # The standard deviation is computed with default ddof=0, which corresponds to\n    # the population standard deviation, consistent with the problem's formulas.\n    if np.std(X) == 0:\n        return 0.0\n\n    # Step 2: Compute spatial adjacency matrix W\n    n = coords.shape[0]\n    if n  2:\n        return 0.0 # Cannot compute spatial lag with less than 2 points\n\n    dist_matrix = squareform(pdist(coords, 'euclidean'))\n    \n    # Adjacency weight w_ij = 1 if 0  d_ij = r, 0 otherwise. w_ii = 0.\n    W = np.zeros((n, n), dtype=float)\n    W[(dist_matrix  0)  (dist_matrix = r)] = 1.0\n\n    # Step 3: Row-normalize W to get W_tilde\n    row_sums = W.sum(axis=1)\n    W_tilde = np.zeros_like(W)\n    \n    # Avoid division by zero for isolated nodes\n    non_zero_rows = row_sums  0\n    W_tilde[non_zero_rows, :] = W[non_zero_rows, :] / row_sums[non_zero_rows, np.newaxis]\n\n    # Step 4: Compute the spatially lagged microglial field L\n    L = W_tilde @ Y\n\n    # Step 5: Compute the co-localization score S (Pearson correlation)\n    # Check for zero variance in L, as per problem definition.\n    if np.std(L) == 0:\n        return 0.0\n        \n    # Correlation coefficient calculation\n    # np.corrcoef returns a matrix, the off-diagonal element is the correlation.\n    corr_matrix = np.corrcoef(X, L)\n    S = corr_matrix[0, 1]\n\n    return round(S, 10) # Round to avoid floating point artifacts in simple cases\n\nsolve()\n```", "id": "2876503"}]}