{"hands_on_practices": [{"introduction": "The co-evolutionary arms race between hosts and pathogens leaves a detectable signature in the genome, offering clues about the selective forces that shape immune systems. A powerful tool for detecting this signature is the ratio of nonsynonymous ($d_N$) to synonymous ($d_S$) substitution rates, which can distinguish the intense pressure of positive selection from the constraints of purifying selection. This exercise [@problem_id:2842372] provides foundational practice in calculating and interpreting the $d_N/d_S$ ratio, using the classic example of the Major Histocompatibility Complex (MHC) to demonstrate how different functional regions of a single gene can be subject to dramatically different evolutionary pressures.", "problem": "Across many vertebrates, the Major Histocompatibility Complex (MHC) peptide-binding region is a focal point of host-pathogen coevolution. Consider an alignment of orthologous coding sequences from two closely related primate species for an MHC class II gene, partitioned into the peptide-binding region (PBR) and the non-peptide-binding remainder (non-PBR). Let $d_N$ denote the number of nonsynonymous substitutions per nonsynonymous site and $d_S$ denote the number of synonymous substitutions per synonymous site. Assume that sequence divergence is sufficiently low that multiple hits are negligible, so that counting observed fixed differences divided by the corresponding site class is an appropriate estimator of $d_N$ and $d_S$. You are given the following for each region:\n- PBR: nonsynonymous sites $L_N = 420$, synonymous sites $L_S = 180$, observed fixed nonsynonymous differences $N = 58$, observed fixed synonymous differences $S = 6$.\n- Non-PBR: nonsynonymous sites $L_N = 2880$, synonymous sites $L_S = 960$, observed fixed nonsynonymous differences $N = 35$, observed fixed synonymous differences $S = 20$.\n\nUsing only core definitions (nonsynonymous versus synonymous, and substitutions per site), compute the region-specific $d_N/d_S$ values, and interpret which selective regimes are most consistent with the results in each region in the context of comparative and evolutionary immunology. For your final reported value, compute the ratio\n$$\nR \\equiv \\frac{(d_N/d_S)_{\\mathrm{PBR}}}{(d_N/d_S)_{\\mathrm{non\\text{-}PBR}}}.\n$$\nRound your final answer for $R$ to three significant figures. Do not include any units in your final reported value.", "solution": "The problem presented is a standard exercise in molecular evolution, requiring the calculation and interpretation of the ratio of nonsynonymous to synonymous substitution rates. It is scientifically grounded, well-posed, and contains all necessary information. Therefore, I will proceed with its solution.\n\nThe core of the problem lies in the analysis of selective pressure on different regions of a gene by comparing the rate of nonsynonymous substitutions ($d_N$) to the rate of synonymous substitutions ($d_S$). The rate $d_S$ is the number of synonymous substitutions ($S$) per synonymous site ($L_S$), and it serves as a baseline estimate of the mutation rate under neutral evolution, as these substitutions do not alter the amino acid sequence and are thus largely invisible to natural selection. The rate $d_N$ is the number of nonsynonymous substitutions ($N$) per nonsynonymous site ($L_N$).\n\nAccording to the problem statement, we are to use the simple estimator where the rate is the count of observed differences divided by the number of sites.\nFor any given region of a gene, these rates are defined as:\n$$\nd_N = \\frac{N}{L_N}\n$$\n$$\nd_S = \\frac{S}{L_S}\n$$\nThe ratio $\\omega = d_N/d_S$ is a classic indicator of the mode of selection acting on a protein-coding sequence. A value of $\\omega = 1$ suggests neutral evolution, where nonsynonymous mutations are fixed at the same rate as synonymous ones. A value of $\\omega  1$ indicates purifying (or negative) selection, where nonsynonymous mutations are deleterious and are removed from the population. A value of $\\omega  1$ is a strong signal of positive (or diversifying) selection, where nonsynonymous mutations are advantageous and are driven to fixation at a higher rate than neutral mutations.\n\nFirst, we will analyze the peptide-binding region (PBR). The provided data for the PBR are:\n- Nonsynonymous sites, $L_{N, \\mathrm{PBR}} = 420$\n- Synonymous sites, $L_{S, \\mathrm{PBR}} = 180$\n- Nonsynonymous differences, $N_{\\mathrm{PBR}} = 58$\n- Synonymous differences, $S_{\\mathrm{PBR}} = 6$\n\nWe compute the rates for the PBR:\n$$\n(d_N)_{\\mathrm{PBR}} = \\frac{N_{\\mathrm{PBR}}}{L_{N, \\mathrm{PBR}}} = \\frac{58}{420}\n$$\n$$\n(d_S)_{\\mathrm{PBR}} = \\frac{S_{\\mathrm{PBR}}}{L_{S, \\mathrm{PBR}}} = \\frac{6}{180} = \\frac{1}{30}\n$$\nNow, we calculate the ratio $\\omega_{\\mathrm{PBR}} = (d_N/d_S)_{\\mathrm{PBR}}$:\n$$\n\\omega_{\\mathrm{PBR}} = \\frac{(d_N)_{\\mathrm{PBR}}}{(d_S)_{\\mathrm{PBR}}} = \\frac{58/420}{1/30} = \\frac{58}{420} \\times 30 = \\frac{58}{14} = \\frac{29}{7}\n$$\nNumerically, $\\omega_{\\mathrm{PBR}} \\approx 4.14$. Since this value is significantly greater than $1$, it is indicative of strong positive selection. This is the expected result for the PBR of an MHC gene. This region is directly involved in binding and presenting peptides from pathogens. Host-pathogen coevolution creates intense selective pressure for the host to recognize a diverse and evolving array of pathogen peptides, which drives the rapid evolution of new amino acid variants in the PBR.\n\nNext, we analyze the non-peptide-binding region (non-PBR). The provided data for this region are:\n- Nonsynonymous sites, $L_{N, \\text{non-PBR}} = 2880$\n- Synonymous sites, $L_{S, \\text{non-PBR}} = 960$\n- Nonsynonymous differences, $N_{\\text{non-PBR}} = 35$\n- Synonymous differences, $S_{\\text{non-PBR}} = 20$\n\nWe compute the rates for the non-PBR:\n$$\n(d_N)_{\\text{non-PBR}} = \\frac{N_{\\text{non-PBR}}}{L_{N, \\text{non-PBR}}} = \\frac{35}{2880}\n$$\n$$\n(d_S)_{\\text{non-PBR}} = \\frac{S_{\\text{non-PBR}}}{L_{S, \\text{non-PBR}}} = \\frac{20}{960} = \\frac{1}{48}\n$$\nNow, we calculate the ratio $\\omega_{\\text{non-PBR}} = (d_N/d_S)_{\\text{non-PBR}}$:\n$$\n\\omega_{\\text{non-PBR}} = \\frac{(d_N)_{\\text{non-PBR}}}{(d_S)_{\\text{non-PBR}}} = \\frac{35/2880}{1/48} = \\frac{35}{2880} \\times 48 = \\frac{35 \\times 48}{2880}\n$$\nRecognizing that $2880 = 60 \\times 48$, the calculation simplifies to:\n$$\n\\omega_{\\text{non-PBR}} = \\frac{35}{60} = \\frac{7}{12}\n$$\nNumerically, $\\omega_{\\text{non-PBR}} \\approx 0.583$. Since this value is less than $1$, it indicates purifying selection. This is also expected. The non-PBR portions of the MHC molecule have critical structural and signaling functions that must be conserved. Most amino acid changes in these regions would likely be deleterious, disrupting the protein's overall structure or its interaction with other components of the immune system (like the T-cell receptor or CD4 co-receptor), and are therefore selected against.\n\nFinally, the problem requires the computation of the ratio $R$, which contrasts the strength of selection in the PBR with that in the non-PBR.\n$$\nR \\equiv \\frac{(d_N/d_S)_{\\mathrm{PBR}}}{(d_N/d_S)_{\\mathrm{non\\text{-}PBR}}} = \\frac{\\omega_{\\mathrm{PBR}}}{\\omega_{\\text{non-PBR}}}\n$$\nSubstituting the exact fractional values we computed:\n$$\nR = \\frac{29/7}{7/12} = \\frac{29}{7} \\times \\frac{12}{7} = \\frac{29 \\times 12}{7 \\times 7} = \\frac{348}{49}\n$$\nTo obtain the final numerical answer, we perform the division and round to three significant figures as instructed.\n$$\nR = \\frac{348}{49} \\approx 7.1020408...\n$$\nRounding to three significant figures gives $7.10$.\nThis large value of $R$ quantitatively demonstrates the dramatic difference in selective pressures acting on the different functional domains of the MHC protein, with the peptide-binding region evolving under strong positive selection at a rate over $7$ times faster (in terms of the $\\omega$ ratio) than the background rate of the functionally constrained non-PBR regions.", "answer": "$$\n\\boxed{7.10}\n$$", "id": "2842372"}, {"introduction": "A central challenge for the adaptive immune system is to generate a diverse T-cell repertoire capable of recognizing foreign threats while simultaneously avoiding catastrophic autoimmunity. Central tolerance, orchestrated in the thymus, relies on stochastic encounters between developing thymocytes and self-antigens, a process whose efficiency can be modeled quantitatively. By deriving a model for autoimmunity risk based on the function of the Autoimmune regulator (Aire) [@problem_id:2842341], this practice develops skills in translating fundamental immunological principles into a predictive mathematical framework, linking molecular expression levels to system-wide outcomes.", "problem": "In vertebrates, central tolerance is enforced in the thymus by deleting thymocytes whose T cell receptor (TCR) binds strongly to self-peptide–major histocompatibility complex (MHC) complexes during negative selection. Autoimmune regulator (Aire) expressed by medullary thymic epithelial cells induces promiscuous expression of tissue-restricted antigens (TRAs), enabling presentation to developing T cells. Consider two closely related mammalian species that are identical in all thymic selection parameters except that Species B expresses Aire at a relative level $A \\in (0,1]$ compared with Species A, which has $A = 1$. Assume the following modeling assumptions grounded in thymic selection principles and widely used stochastic descriptions of antigen presentation and T cell scanning:\n\n1. For a given TRA on a representative antigen-presenting cell (APC), the number of cognate peptide–MHC complexes available to trigger deletion is a Poisson random variable with mean $\\mu(A) = \\mu_{0} A$, where $\\mu_{0}$ is the mean under wild-type Aire ($A=1$).\n2. A developing thymocyte makes $M$ independent serial contacts with distinct APCs during the window in which it can be negatively selected. In any one contact, if at least one cognate peptide–MHC complex for that clone’s self-epitope is present, deletion is triggered with probability $\\sigma \\in (0,1)$ due to signaling variability; otherwise the clone is not deleted in that contact.\n3. In a cohort of $T$ distinct pre-selection thymocyte clones, the fraction $f$ of clones that are specific (and potentially autoreactive) to any particular single TRA epitope is small, and there are $N$ distinct, non-overlapping TRAs whose central tolerance depends predominantly on Aire. You may assume $N f \\ll 1$ so that double-specificity is negligible at this scale and independence approximations for rare events apply across clones and TRAs.\n\nTasks:\na) Starting from these assumptions and the definition of negative selection, derive a closed-form expression for the autoimmunity risk $R(A)$ in Species B, defined as the probability that at least one autoreactive clone specific to any of the $N$ TRAs escapes negative selection, in terms of $A$, $\\mu_{0}$, $M$, $\\sigma$, $T$, $N$, and $f$.\n\nb) Using your derived expression, evaluate $R(A)$ for Species B when $A = \\frac{1}{2}$ with the following empirically plausible parameters that are assumed to be conserved across these species: $\\mu_{0} = 0.02$, $M = 800$, $\\sigma = 0.4$, $T = 10^{6}$, $N = 10^{3}$, and $f = 5 \\times 10^{-9}$. Report the final numerical value of $R\\!\\left(\\tfrac{1}{2}\\right)$ as a unitless decimal rounded to four significant figures.", "solution": "The problem statement is coherent and grounded in established principles of immunology and stochastic modeling. The assumptions are clearly stated and allow for a rigorous derivation. The problem is valid. We proceed to solve it in two parts as requested.\n\na) Derivation of the autoimmunity risk $R(A)$.\n\nThe derivation proceeds by first calculating the probability of a single autoreactive thymocyte escaping negative selection, and then aggregating this risk over the entire relevant T-cell repertoire.\n\nLet us consider a single autoreactive thymocyte clone specific to one of the $N$ tissue-restricted antigens (TRAs).\nAccording to assumption 1, the number of cognate peptide-MHC (pMHC) complexes, $K$, on a single antigen-presenting cell (APC) follows a Poisson distribution with mean $\\mu(A) = \\mu_0 A$. The probability mass function is $P(K=k) = \\frac{\\exp(-\\mu_0 A)(\\mu_0 A)^k}{k!}$.\n\nThe probability that an APC presents zero cognate pMHC complexes is:\n$$ P(K=0) = \\exp(-\\mu_0 A) $$\nThe probability that an APC presents at least one cognate pMHC complex is:\n$$ P(K \\geq 1) = 1 - P(K=0) = 1 - \\exp(-\\mu_0 A) $$\nAccording to assumption 2, deletion of the thymocyte during a single encounter with an APC can only occur if $K \\geq 1$. If $K \\geq 1$, deletion is triggered with probability $\\sigma$. Thus, the thymocyte is *not* deleted in this encounter if either $K=0$ (no signal) or if $K \\geq 1$ and the deletion signal fails (with probability $1-\\sigma$).\n\nThe probability of non-deletion for a thymocyte in a single encounter with an APC, denoted $p_{nd,1}$, is the sum of probabilities of these two mutually exclusive events:\n$$ p_{nd,1} = P(K=0) + P(K \\geq 1) \\times (1-\\sigma) $$\nSubstituting the expressions derived from the Poisson distribution:\n$$ p_{nd,1} = \\exp(-\\mu_0 A) + (1 - \\exp(-\\mu_0 A))(1-\\sigma) $$\n$$ p_{nd,1} = \\exp(-\\mu_0 A) + 1 - \\sigma - \\exp(-\\mu_0 A) + \\sigma \\exp(-\\mu_0 A) $$\n$$ p_{nd,1} = 1 - \\sigma + \\sigma \\exp(-\\mu_0 A) = 1 - \\sigma(1 - \\exp(-\\mu_0 A)) $$\nA thymocyte undergoes $M$ such independent encounters. For the clone to escape negative selection, it must survive all $M$ encounters. The probability of escape for a single autoreactive clone, $P_{\\text{esc,clone}}$, is therefore:\n$$ P_{\\text{esc,clone}} = (p_{nd,1})^M = \\left[ 1 - \\sigma(1 - \\exp(-\\mu_0 A)) \\right]^M $$\nThe autoimmunity risk $R(A)$ is the probability that at least one autoreactive clone escapes negative selection. The total number of pre-selection thymocyte clones is $T$. The fraction specific to a single TRA is $f$. There are $N$ such TRAs. The total number of potentially autoreactive clones across all $N$ TRAs is $N \\times T \\times f$.\nThe escape probability for any single one of these clones is $P_{\\text{esc,clone}}$, which is a small value. The number of such clones, $N T f$, can be large. The number of escaped clones can be modeled by a Poisson distribution, justified by the independence of clones (assumption $Nf \\ll 1$) and the rarity of the escape event.\n\nThe mean (or parameter $\\lambda$) of this Poisson distribution, which represents the expected number of escaped autoreactive clones, is:\n$$ \\lambda_{\\text{total}} = (\\text{Total number of autoreactive clones}) \\times (\\text{Probability of escape per clone}) $$\n$$ \\lambda_{\\text{total}} = (N T f) \\times P_{\\text{esc,clone}} $$\n$$ \\lambda_{\\text{total}} = N T f \\left[ 1 - \\sigma(1 - \\exp(-\\mu_0 A)) \\right]^M $$\nThe risk $R(A)$ is the probability that the number of escaped clones is at least one. For a Poisson-distributed random variable $X$ with mean $\\lambda$, $P(X \\geq 1) = 1 - P(X=0) = 1 - \\exp(-\\lambda)$.\nTherefore, the autoimmunity risk is:\n$$ R(A) = 1 - \\exp(-\\lambda_{\\text{total}}) $$\nSubstituting the expression for $\\lambda_{\\text{total}}$, we obtain the final closed-form expression for the autoimmunity risk:\n$$ R(A) = 1 - \\exp\\left(-N T f \\left[1 - \\sigma\\left(1 - \\exp(-\\mu_0 A)\\right)\\right]^M\\right) $$\n\nb) Evaluation of $R(A)$ for the given parameters.\n\nWe are asked to evaluate $R(A)$ for $A = \\frac{1}{2}$ with the parameters: $\\mu_{0} = 0.02$, $M = 800$, $\\sigma = 0.4$, $T = 10^{6}$, $N = 10^{3}$, and $f = 5 \\times 10^{-9}$.\n\nFirst, we calculate the exponent of the inner exponential term:\n$$ \\mu_0 A = (0.02) \\times \\left(\\frac{1}{2}\\right) = 0.01 $$\nNext, we calculate the probability of non-deletion in a single encounter, $p_{nd,1}$:\n$$ p_{nd,1} = 1 - \\sigma(1 - \\exp(-\\mu_0 A)) = 1 - 0.4(1 - \\exp(-0.01)) $$\nThis can be rewritten as $0.6 + 0.4 \\exp(-0.01)$.\nUsing $\\exp(-0.01) \\approx 0.99004983$:\n$$ p_{nd,1} \\approx 0.6 + 0.4 \\times 0.99004983 = 0.6 + 0.39601993 = 0.99601993 $$\nNow, we calculate the escape probability for a single clone, $P_{\\text{esc,clone}}$:\n$$ P_{\\text{esc,clone}} = (p_{nd,1})^M = (0.99601993)^{800} $$\nTaking the natural logarithm:\n$$ \\ln(P_{\\text{esc,clone}}) = 800 \\ln(0.99601993) \\approx 800 \\times (-0.00398807) \\approx -3.190456 $$\n$$ P_{\\text{esc,clone}} = \\exp(-3.190456) \\approx 0.0411516 $$\nNext, we calculate the mean number of escaped clones, $\\lambda_{\\text{total}}$. First, we find the total number of relevant clones:\n$$ N T f = (10^3) \\times (10^6) \\times (5 \\times 10^{-9}) = 5 $$\nSo, $\\lambda_{\\text{total}} = 5 \\times P_{\\text{esc,clone}}$:\n$$ \\lambda_{\\text{total}} \\approx 5 \\times 0.0411516 = 0.205758 $$\nFinally, we calculate the autoimmunity risk $R(\\frac{1}{2})$:\n$$ R\\!\\left(\\frac{1}{2}\\right) = 1 - \\exp(-\\lambda_{\\text{total}}) \\approx 1 - \\exp(-0.205758) $$\n$$ R\\!\\left(\\frac{1}{2}\\right) \\approx 1 - 0.8140321 = 0.1859679 $$\nRounding the result to four significant figures as requested:\n$$ R\\!\\left(\\frac{1}{2}\\right) \\approx 0.1860 $$\nThis indicates that for an individual of Species B with a $50\\%$ reduction in Aire level, there is an approximate $18.6\\%$ probability of at least one autoreactive T-cell clone escaping central tolerance for the set of $N$ Aire-dependent antigens.", "answer": "$$\\boxed{0.1860}$$", "id": "2842341"}, {"introduction": "The vast diversity of immune receptors is not generated by a single universal mechanism, and distinguishing between these generative processes from sequence data is a key challenge in evolutionary immunology. Different mechanisms, such as templated gene conversion versus the accumulation of independent point mutations, produce distinct statistical patterns in the resulting sequences that can be exploited for inference. This advanced practice [@problem_id:2842385] guides you through the design of a principled statistical test to infer the dominant mechanism of diversification, building critical skills in model-based hypothesis testing and likelihood-ratio analysis using avian immunoglobulin diversification as a case study.", "problem": "Design a program that, given tract-length data from avian Immunoglobulin (Ig) light chain diversification, implements a principled likelihood-ratio test to distinguish templated gene conversion from independent point mutation using tract-length distributions. Base your derivation on the following fundamental and well-tested principles in comparative and evolutionary immunology and probability theory:\n- In birds, templated gene conversion introduces contiguous tracts of mismatches copied from donor segments. The processivity of copying can be modeled as memoryless termination along the Deoxyribonucleic Acid (DNA) sequence.\n- Independent point mutations are approximately site-wise independent events along the sequence at per-site mutation probability $p$ across the aligned region, with contiguity of mismatches arising only by chance adjacency.\n\nFrom these bases, derive mathematically:\n1. Under the point-mutation-only model $\\mathcal{M}_0$ (independent Bernoulli mutations with probability $p$ per site), the probability mass function of the length $L$ of a run of consecutive mutated sites, conditioned on starting a run, as a function of $p$. Use only the independence assumption to obtain the distribution, and express it in terms of $p$.\n2. Under the templated gene conversion model $\\mathcal{M}_1$, assume a memoryless termination mechanism for conversion tracts. Use only the memoryless assumption to derive the probability mass function for tract length $L$ with a parameter $r \\in (0,1)$ that determines the termination probability per position and the corresponding mean tract length.\n3. Given an observed list of tract lengths $\\{ \\ell_i \\}_{i=1}^n$, show how to compute the log-likelihood under $\\mathcal{M}_0$ using $p$ estimated from sequence-wide data as $\\hat p = M/N$, where $M = \\sum_{i=1}^n \\ell_i$ is the total number of mutated positions and $N$ is the total number of aligned positions examined across all sequences in the dataset. Use the tract-length distribution under $\\mathcal{M}_0$ derived in part 1.\n4. Derive the maximum likelihood estimator for $r$ under $\\mathcal{M}_1$ in terms of the sample mean $\\bar L = \\frac{1}{n}\\sum_{i=1}^n \\ell_i$. Then incorporate the biologically grounded, one-sided alternative that templated gene conversion has a mean tract length at least $L_{\\min}$, implemented as a bound $r \\leq 1/L_{\\min}$. Define the constrained maximum likelihood estimate $\\hat r^\\star = \\min\\{ \\hat r,\\, 1/L_{\\min} \\}$, and compute the log-likelihood under $\\mathcal{M}_1$ at $\\hat r^\\star$.\n5. Define the log-likelihood ratio statistic\n$$\n\\Lambda = 2 \\left[ \\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) \\;-\\; \\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) \\right],\n$$\nand use the asymptotic chi-square reference with $1$ degree of freedom to decide whether to favor templated gene conversion over point mutation at significance level $\\alpha = 0.05$. Report a boolean decision for each case: $\\,\\text{True}$ if $\\Lambda \\geq 3.841458820694124$, else $\\,\\text{False}$.\n\nImplementation details to enforce:\n- All logs must be natural logarithms.\n- If any parameter estimate would cause numerical issues (e.g., $\\log 0$), use standard limiting arguments consistent with the derived formulas or clamp parameters into $(\\varepsilon, 1-\\varepsilon)$ for a very small $\\varepsilon$ such that the resulting likelihood is the appropriate continuous limit.\n\nUse the following test suite. For each test case $j$, the input is a pair $(N^{(j)}, \\mathcal{L}^{(j)})$, where $N^{(j)}$ is the total number of aligned positions examined across sequences and $\\mathcal{L}^{(j)}$ is the list of observed tract lengths:\n- Test case 1: $N^{(1)} = 5000$, $\\mathcal{L}^{(1)} = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2]$.\n- Test case 2: $N^{(2)} = 10000$, $\\mathcal{L}^{(2)} = [12,15,9,21,8,17,10,14]$.\n- Test case 3: $N^{(3)} = 100$, $\\mathcal{L}^{(3)} = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]$.\n- Test case 4: $N^{(4)} = 8000$, $\\mathcal{L}^{(4)} = [1,1,3,1,2,1,5,1,1,2,4,1,1]$.\n- Test case 5: $N^{(5)} = 10000$, $\\mathcal{L}^{(5)} = [1]$.\n\nCommon parameters for all tests:\n- Minimal mean tract length for templated conversion: $L_{\\min} = 3$.\n- Significance level: $\\alpha = 0.05$, chi-square cutoff with $1$ degree of freedom: $3.841458820694124$.\n\nYour program should produce a single line of output containing the boolean decisions for the five test cases, as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,False,True]\").", "solution": "The problem statement has been critically evaluated and is deemed valid. It is scientifically grounded in established principles of evolutionary immunology, specifically the mechanisms of antibody diversification in avians. It is mathematically well-posed, providing a clear objective and a complete, self-consistent set of definitions, data, and constraints required for a unique solution. The language is objective and unambiguous. We will therefore proceed with the derivation and solution.\n\nThe task is to construct a likelihood-ratio test to distinguish between two models of somatic mutation: independent point mutations ($\\mathcal{M}_0$) and templated gene conversion ($\\mathcal{M}_1$). This requires deriving the probability distributions for mutation tract lengths under each model, formulating the corresponding likelihood functions, and constructing the test statistic.\n\n**1. Probability Mass Function for Point Mutation Model $\\mathcal{M}_0$**\n\nUnder model $\\mathcal{M}_0$, mutations are independent Bernoulli trials at each site with a success probability $p$. We are asked for the probability mass function (PMF) of the length $L$ of a run of mutated sites, conditioned on a run starting. Let a run of length $L=k$ be an event where $k$ consecutive sites are mutated, and this tract is terminated by a non-mutated site. The start of a run implies we have observed one mutated site. For the run to have length $k$, we must observe $k-1$ additional consecutive mutations, followed by one non-mutation. The probability of this sequence of events, given the independence of sites, is the product of their individual probabilities: $p^{k-1}(1-p)$. This defines a geometric distribution for the run length $k \\in \\{1, 2, \\dots\\}$.\n\nThe PMF for the length $L$ of a run under $\\mathcal{M}_0$ is therefore:\n$$\nP_0(L=k \\mid p) = p^{k-1}(1-p)\n$$\n\n**2. Probability Mass Function for Gene Conversion Model $\\mathcal{M}_1$**\n\nUnder model $\\mathcal{M}_1$, a templated gene conversion tract is formed with a memoryless termination process. Let $r \\in (0,1)$ be the constant probability of terminating the conversion at any given position along the sequence. A tract of length $L=k$ is formed if the process continues for $k-1$ steps and then terminates at the $k$-th step. The probability of continuing (not terminating) at any step is $1-r$. Due to the memoryless property, the probability of observing $k-1$ continuations followed by one termination is the product of a sequence of independent events.\n\nThe PMF for the tract length $L$ under $\\mathcal{M}_1$ is also a geometric distribution:\n$$\nP_1(L=k \\mid r) = (1-r)^{k-1}r\n$$\nThe mean tract length for this distribution is $\\mathbb{E}[L] = 1/r$.\n\n**3. Log-Likelihood for Model $\\mathcal{M}_0$**\n\nGiven a set of $n$ observed independent tract lengths $\\{\\ell_i\\}_{i=1}^n$, the likelihood function under $\\mathcal{M}_0$ is the product of the probabilities of observing each length:\n$$\n\\mathcal{L}_0(p \\mid \\{\\ell_i\\}) = \\prod_{i=1}^n P_0(L=\\ell_i \\mid p) = \\prod_{i=1}^n p^{\\ell_i-1}(1-p)\n$$\nThe log-likelihood, $\\log \\mathcal{L}_0$, is computationally more convenient:\n$$\n\\log \\mathcal{L}_0 = \\sum_{i=1}^n \\log\\left(p^{\\ell_i-1}(1-p)\\right) = \\sum_{i=1}^n \\left( (\\ell_i-1)\\log p + \\log(1-p) \\right)\n$$\nLet $M = \\sum_{i=1}^n \\ell_i$ be the total number of mutated sites. The expression simplifies to:\n$$\n\\log \\mathcal{L}_0 = \\left(\\sum_{i=1}^n (\\ell_i-1)\\right)\\log p + n\\log(1-p) = (M-n)\\log p + n\\log(1-p)\n$$\nWe evaluate this log-likelihood using the provided estimator for $p$, $\\hat p = M/N$, where $N$ is the total number of aligned positions:\n$$\n\\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) = (M-n)\\log\\left(\\frac{M}{N}\\right) + n\\log\\left(1 - \\frac{M}{N}\\right)\n$$\n\n**4. Maximum Likelihood Estimation and Log-Likelihood for Model $\\mathcal{M}_1$**\n\nSimilarly, the log-likelihood for $\\mathcal{M}_1$ is:\n$$\n\\log \\mathcal{L}_1(r \\mid \\{\\ell_i\\}) = (M-n)\\log(1-r) + n\\log r\n$$\nTo find the Maximum Likelihood Estimator (MLE) $\\hat r$, we differentiate with respect to $r$ and set to zero:\n$$\n\\frac{d}{dr}\\log \\mathcal{L}_1 = -\\frac{M-n}{1-r} + \\frac{n}{r} = 0 \\implies n(1-r) = r(M-n) \\implies n = Mr \\implies \\hat r = \\frac{n}{M}\n$$\nIn terms of the sample mean tract length $\\bar L = M/n$, the MLE is $\\hat r = 1/\\bar L$.\n\nThe problem introduces a biologically motivated constraint that the mean tract length must be at least $L_{\\min}$, which implies $1/r \\ge L_{\\min}$, or $r \\le 1/L_{\\min}$. The constrained MLE, $\\hat r^\\star$, is the value in $[0, 1/L_{\\min}]$ that maximizes the likelihood. This is given by:\n$$\n\\hat r^\\star = \\min(\\hat r, 1/L_{\\min}) = \\min(n/M, 1/L_{\\min})\n$$\nThe log-likelihood for $\\mathcal{M}_1$ is then evaluated at $\\hat r^\\star$:\n$$\n\\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) = (M-n)\\log(1-\\hat r^\\star) + n\\log(\\hat r^\\star)\n$$\n\n**5. The Log-Likelihood Ratio Test**\n\nThe log-likelihood ratio statistic $\\Lambda$ is defined to compare the goodness-of-fit of the two models:\n$$\n\\Lambda = 2 \\left[ \\log \\mathcal{L}_1(\\hat r^\\star \\mid \\{\\ell_i\\}) - \\log \\mathcal{L}_0(\\hat p \\mid \\{\\ell_i\\}) \\right]\n$$\nAccording to Wilks' theorem, under the null hypothesis ($\\mathcal{M}_0$), $\\Lambda$ is asymptotically distributed as a chi-square ($\\chi^2$) random variable. Since model $\\mathcal{M}_1$ has one free parameter ($r$) estimated from the data being tested, while $\\mathcal{M}_0$'s parameter $p$ is estimated using external information ($N$), the degrees of freedom is $1$.\n\nThe decision rule is to reject $\\mathcal{M}_0$ in favor of $\\mathcal{M}_1$ if $\\Lambda$ exceeds the critical value for the $\\chi^2_1$ distribution at a significance level of $\\alpha = 0.05$. This critical value is given as $3.841458820694124$. The decision for each test case is $\\text{True}$ if $\\Lambda \\geq 3.841458820694124$ and $\\text{False}$ otherwise. The implementation will compute $\\Lambda$ for each test case using the derived formulas and apply this decision rule.", "answer": "```python\nimport numpy as np\n\ndef _solve_case(N, tract_lengths, L_min, chi_sq_crit):\n    \"\"\"\n    Performs the likelihood-ratio test for a single case.\n\n    Args:\n        N (int): Total number of aligned positions.\n        tract_lengths (list): List of observed tract lengths.\n        L_min (float): Minimum mean tract length for gene conversion.\n        chi_sq_crit (float): Chi-square critical value for the test.\n\n    Returns:\n        bool: True if templated gene conversion is favored, False otherwise.\n    \"\"\"\n    n = len(tract_lengths)\n    \n    # If there are no observed tracts, the null model cannot be rejected.\n    if n == 0:\n        return False\n        \n    M = sum(tract_lengths)\n    \n    # --- Log-Likelihood for Null Model M_0 (Point Mutation) ---\n    # The PMF for tract length L is P(L=k | p) = p^(k-1) * (1-p).\n    # The log-likelihood is log L_0 = (M-n)*log(p) + n*log(1-p).\n    # The parameter p is estimated as p_hat = M/N.\n    \n    p_hat = M / N\n    \n    # Handle edge cases for p_hat to avoid log(0).\n    if p_hat == 0.0:\n        # Occurs if M=0, so n=0. Handled above, but for formal correctness.\n        # log L_0 = 0 in this case.\n        log_L0 = 0.0\n    elif p_hat == 1.0:\n        # P(data | M_0) = 0, so log-likelihood is negative infinity.\n        # This implies the data is impossible under the null model.\n        log_L0 = -np.inf\n    else:\n        log_L0 = (M - n) * np.log(p_hat) + n * np.log(1 - p_hat)\n        \n    # --- Log-Likelihood for Alternative Model M_1 (Gene Conversion) ---\n    # The PMF for tract length L is P(L=k | r) = (1-r)^(k-1) * r.\n    # The log-likelihood is log L_1 = (M-n)*log(1-r) + n*log(r).\n    # The MLE for r is r_hat = n/M = 1/L_bar.\n    \n    r_hat = n / M\n    \n    # Apply the constraint r = 1/L_min to get the constrained MLE r_hat_star.\n    r_hat_star = min(r_hat, 1.0 / L_min)\n    \n    # Given L_min  1 and M = n = 1, r_hat_star will be in (0, 1),\n    # so we do not expect log(0) issues here.\n    log_L1 = (M - n) * np.log(1.0 - r_hat_star) + n * np.log(r_hat_star)\n    \n    # --- Log-Likelihood Ratio Test ---\n    # Lambda = 2 * (log_L1 - log_L0)\n    # The statistic is compared to a chi-square distribution with 1 df.\n    \n    lambda_stat = 2.0 * (log_L1 - log_L0)\n    \n    return lambda_stat >= chi_sq_crit\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the result.\n    \"\"\"\n    # Test cases: (N, list_of_tract_lengths)\n    test_cases = [\n        (5000, [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2]),\n        (10000, [12,15,9,21,8,17,10,14]),\n        (100, [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),\n        (8000, [1,1,3,1,2,1,5,1,1,2,4,1,1]),\n        (10000, [1]),\n    ]\n    \n    # Common parameters from the problem statement.\n    L_min = 3.0\n    alpha = 0.05\n    chi_sq_crit_1df = 3.841458820694124\n    \n    results = []\n    for N, L_list in test_cases:\n        decision = _solve_case(N, L_list, L_min, chi_sq_crit_1df)\n        results.append(decision)\n        \n    # Print the final output in the required format: [res1,res2,...]\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the main function.\nsolve()\n```", "id": "2842385"}]}