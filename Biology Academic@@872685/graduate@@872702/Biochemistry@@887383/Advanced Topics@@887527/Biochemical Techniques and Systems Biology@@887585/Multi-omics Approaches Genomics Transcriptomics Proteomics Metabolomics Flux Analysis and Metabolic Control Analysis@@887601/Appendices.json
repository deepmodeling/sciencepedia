{"hands_on_practices": [{"introduction": "A cornerstone of systems biology is the ability to construct predictive models of cellular processes from first principles. This practice guides you through the process of building a dynamic model of a simple metabolic pathway using the fundamental law of mass conservation and standard enzyme kinetics. By simulating the system's response to a sudden change in substrate availability, you will gain hands-on experience in translating a biological diagram into a set of ordinary differential equations (ODEs) and using them to predict instantaneous metabolic changes [@problem_id:2579659].", "problem": "A cell converts an external substrate $S$ to a final product $P$ via a linear three-step pathway of intracellular metabolites $A$ and $B$, catalyzed by enzymes $E_0$, $E_1$, and $E_2$:\n$$\nS \\xrightleftharpoons[E_0]{} A \\xrightleftharpoons[E_1]{} B \\xrightleftharpoons[E_2]{} P.\n$$\nThe boundary metabolites $S$ and $P$ are chemostatted (their concentrations are controlled by the environment and do not change due to the intracellular reactions). Each step follows a reversible Michaelis–Menten convenience kinetics rate law, a well-tested phenomenological law used in metabolic flux analysis:\n$$\nv \\;=\\; \\frac{V_{f}\\,\\frac{S}{K_{S}} \\;-\\; V_{r}\\,\\frac{P}{K_{P}}}{1 \\;+\\; \\frac{S}{K_{S}} \\;+\\; \\frac{P}{K_{P}}}.\n$$\nHere $S$ and $P$ denote the substrate and product concentrations for the given step, $V_{f}$ and $V_{r}$ are the forward and reverse maximal velocities, and $K_{S}$ and $K_{P}$ are the Michaelis constants for substrate and product, respectively.\n\nTask 1 (model construction): Using mass conservation (rate of change equals sum of inflows minus outflows) and the above rate law, write the ordinary differential equations (ODEs) for $A(t)$ and $B(t)$ for this pathway, with $S$ and $P$ treated as fixed parameters for each time $t$.\n\nTask 2 (initial conditions for a substrate-supply shift): The system has been at a pre-shift steady environment with substrate $S = S_{\\mathrm{old}}$, and at time $t=0$ the environment instantaneously shifts and then holds $S = S_{\\mathrm{new}}$ for $t \\ge 0$. The product concentration is held at $P = P^{*}$ at all times. Measured intracellular concentrations just before the shift are $A(0^{-}) = A^{*}$ and $B(0^{-}) = B^{*}$. Specify appropriate initial conditions at $t=0$ for the ODEs that reflect this shift protocol.\n\nTask 3 (instantaneous response calculation): For the parameter values\n- Step $S \\rightleftharpoons A$ ($E_0$): $V_{0f} = 1.5 \\ \\mathrm{mM\\,min^{-1}}$, $K_{0S} = 0.5 \\ \\mathrm{mM}$, $V_{0r} = 0.5 \\ \\mathrm{mM\\,min^{-1}}$, $K_{0A} = 0.2 \\ \\mathrm{mM}$.\n- Step $A \\rightleftharpoons B$ ($E_1$): $V_{1f} = 2.0 \\ \\mathrm{mM\\,min^{-1}}$, $K_{1A} = 0.3 \\ \\mathrm{mM}$, $V_{1r} = 1.0 \\ \\mathrm{mM\\,min^{-1}}$, $K_{1B} = 0.4 \\ \\mathrm{mM}$.\n- Step $B \\rightleftharpoons P$ ($E_2$): $V_{2f} = 1.8 \\ \\mathrm{mM\\,min^{-1}}$, $K_{2B} = 0.2 \\ \\mathrm{mM}$, $V_{2r} = 0.9 \\ \\mathrm{mM\\,min^{-1}}$, $K_{2P} = 0.5 \\ \\mathrm{mM}$.\n- Boundary concentrations: $S_{\\mathrm{old}} = 0.10 \\ \\mathrm{mM}$, $S_{\\mathrm{new}} = 1.00 \\ \\mathrm{mM}$, $P^{*} = 0.20 \\ \\mathrm{mM}$.\n- Pre-shift intracellular measurements: $A^{*} = 0.15 \\ \\mathrm{mM}$ and $B^{*} = 0.25 \\ \\mathrm{mM}$.\n\nCompute the instantaneous accumulation rate of $B$ at the moment just after the shift, that is, compute $\\left.\\frac{dB}{dt}\\right|_{t=0^{+}}$ using your ODEs with $S = S_{\\mathrm{new}}$, $P = P^{*}$, $A(0) = A^{*}$, and $B(0) = B^{*}$. Express the final result in $\\mathrm{mM\\,min^{-1}}$ and round your answer to four significant figures.", "solution": "The problem statement has been validated and is determined to be a well-posed, scientifically sound problem in the field of biochemical kinetics and metabolic modeling. It contains all necessary information, is free of contradictions, and asks a specific, calculable question based on established principles. We shall proceed with the solution.\n\nThe problem requires a three-part analysis: first, the construction of a mathematical model; second, the determination of initial conditions for a specific scenario; and third, the calculation of an instantaneous rate of change.\n\n**Task 1: Model Construction**\n\nThe system is a linear enzymatic pathway:\n$$\nS \\xrightleftharpoons[E_0]{v_0} A \\xrightleftharpoons[E_1]{v_1} B \\xrightleftharpoons[E_2]{v_2} P\n$$\nThe concentrations of the internal metabolites, $A$ and $B$, change over time based on the principle of mass conservation. The rate of change of a metabolite's concentration is the sum of the rates of all reactions producing it (inflows) minus the sum of the rates of all reactions consuming it (outflows).\n\nFor metabolite $A$, it is produced by reaction $v_0$ and consumed by reaction $v_1$. Its rate of change is therefore:\n$$\n\\frac{d[A]}{dt} = v_0 - v_1\n$$\nFor metabolite $B$, it is produced by reaction $v_1$ and consumed by reaction $v_2$. Its rate of change is:\n$$\n\\frac{d[B]}{dt} = v_1 - v_2\n$$\nThe fluxes $v_0$, $v_1$, and $v_2$ are described by the provided reversible Michaelis–Menten convenience kinetics. Let $[X]$ represent the concentration of species $X$.\n\nThe flux for the first step, $v_0$, catalyzed by enzyme $E_0$ ($S \\rightleftharpoons A$), is:\n$$\nv_0 = \\frac{V_{0f}\\,\\frac{[S]}{K_{0S}} - V_{0r}\\,\\frac{[A]}{K_{0A}}}{1 + \\frac{[S]}{K_{0S}} + \\frac{[A]}{K_{0A}}}\n$$\nThe flux for the second step, $v_1$, catalyzed by enzyme $E_1$ ($A \\rightleftharpoons B$), is:\n$$\nv_1 = \\frac{V_{1f}\\,\\frac{[A]}{K_{1A}} - V_{1r}\\,\\frac{[B]}{K_{1B}}}{1 + \\frac{[A]}{K_{1A}} + \\frac{[B]}{K_{1B}}}\n$$\nThe flux for the third step, $v_2$, catalyzed by enzyme $E_2$ ($B \\rightleftharpoons P$), is:\n$$\nv_2 = \\frac{V_{2f}\\,\\frac{[B]}{K_{2B}} - V_{2r}\\,\\frac{[P]}{K_{2P}}}{1 + \\frac{[B]}{K_{2B}} + \\frac{[P]}{K_{2P}}}\n$$\nSubstituting these expressions into the mass balance equations gives the complete system of ordinary differential equations (ODEs) for $[A](t)$ and $[B](t)$:\n$$\n\\frac{d[A]}{dt} = \\left( \\frac{V_{0f}\\,\\frac{[S]}{K_{0S}} - V_{0r}\\,\\frac{[A]}{K_{0A}}}{1 + \\frac{[S]}{K_{0S}} + \\frac{[A]}{K_{0A}}} \\right) - \\left( \\frac{V_{1f}\\,\\frac{[A]}{K_{1A}} - V_{1r}\\,\\frac{[B]}{K_{1B}}}{1 + \\frac{[A]}{K_{1A}} + \\frac{[B]}{K_{1B}}} \\right)\n$$\n$$\n\\frac{d[B]}{dt} = \\left( \\frac{V_{1f}\\,\\frac{[A]}{K_{1A}} - V_{1r}\\,\\frac{[B]}{K_{1B}}}{1 + \\frac{[A]}{K_{1A}} + \\frac{[B]}{K_{1B}}} \\right) - \\left( \\frac{V_{2f}\\,\\frac{[B]}{K_{2B}} - V_{2r}\\,\\frac{[P]}{K_{2P}}}{1 + \\frac{[B]}{K_{2B}} + \\frac{[P]}{K_{2P}}} \\right)\n$$\n\n**Task 2: Initial Conditions**\n\nThe problem describes an experiment where the external substrate concentration $[S]$ is changed instantaneously at time $t=0$ from $S_{\\mathrm{old}}$ to $S_{\\mathrm{new}}$. The concentrations of the intracellular metabolites, $[A]$ and $[B]$, are state variables of the system. In any physically realistic system, state variables cannot change instantaneously. Therefore, the concentrations of $[A]$ and $[B]$ must be continuous across the time point $t=0$.\n\nThis means the initial conditions for the a posteriori dynamics (for $t \\ge 0$) are the final values from the a priori state (at $t=0^{-}$).\nThe problem provides the measured concentrations just before the shift:\n$$\n[A](0^{-}) = A^{*} = 0.15 \\ \\mathrm{mM}\n$$\n$$\n[B](0^{-}) = B^{*} = 0.25 \\ \\mathrm{mM}\n$$\nBy continuity, the initial conditions for the ODEs at $t=0$ are:\n$$\n[A](0) = [A](0^{+}) = A^{*} = 0.15 \\ \\mathrm{mM}\n$$\n$$\n[B](0) = [B](0^{+}) = B^{*} = 0.25 \\ \\mathrm{mM}\n$$\nFor all times $t \\ge 0$, the external concentrations are held fixed at:\n$$\n[S] = S_{\\mathrm{new}} = 1.00 \\ \\mathrm{mM}\n$$\n$$\n[P] = P^{*} = 0.20 \\ \\mathrm{mM}\n$$\n\n**Task 3: Instantaneous Response Calculation**\n\nWe are asked to compute the instantaneous accumulation rate of metabolite $B$ at the moment just after the shift, which is $\\left.\\frac{d[B]}{dt}\\right|_{t=0^{+}}$. This requires evaluating the ODE for $B$ using the conditions prevalent at $t=0^{+}$: namely, the new external concentrations $[S]=S_{\\mathrm{new}}, [P]=P^{*}$, and the initial internal concentrations $[A](0)=A^{*}, [B](0)=B^{*}$.\n\nThe governing equation is:\n$$\n\\left.\\frac{d[B]}{dt}\\right|_{t=0^{+}} = v_1(0^{+}) - v_2(0^{+})\n$$\nWe must calculate the values of the fluxes $v_1$ and $v_2$ at $t=0^{+}$.\n\nFirst, we compute $v_1(0^{+})$ using $[A] = A^{*} = 0.15 \\ \\mathrm{mM}$ and $[B] = B^{*} = 0.25 \\ \\mathrm{mM}$:\n$$\nv_1(0^{+}) = \\frac{V_{1f}\\,\\frac{A^{*}}{K_{1A}} - V_{1r}\\,\\frac{B^{*}}{K_{1B}}}{1 + \\frac{A^{*}}{K_{1A}} + \\frac{B^{*}}{K_{1B}}}\n$$\nUsing the given parameters for step $1$: $V_{1f} = 2.0$, $K_{1A} = 0.3$, $V_{1r} = 1.0$, $K_{1B} = 0.4$:\n$$\n\\frac{A^{*}}{K_{1A}} = \\frac{0.15}{0.3} = 0.5\n$$\n$$\n\\frac{B^{*}}{K_{1B}} = \\frac{0.25}{0.4} = 0.625\n$$\nSubstituting these into the expression for $v_1$:\n$$\nv_1(0^{+}) = \\frac{(2.0)(0.5) - (1.0)(0.625)}{1 + 0.5 + 0.625} = \\frac{1.0 - 0.625}{2.125} = \\frac{0.375}{2.125}\n$$\n$$\nv_1(0^{+}) \\approx 0.1764705... \\ \\mathrm{mM\\,min^{-1}}\n$$\nNext, we compute $v_2(0^{+})$ using $[B] = B^{*} = 0.25 \\ \\mathrm{mM}$ and $[P] = P^{*} = 0.20 \\ \\mathrm{mM}$:\n$$\nv_2(0^{+}) = \\frac{V_{2f}\\,\\frac{B^{*}}{K_{2B}} - V_{2r}\\,\\frac{P^{*}}{K_{2P}}}{1 + \\frac{B^{*}}{K_{2B}} + \\frac{P^{*}}{K_{2P}}}\n$$\nUsing the given parameters for step $2$: $V_{2f} = 1.8$, $K_{2B} = 0.2$, $V_{2r} = 0.9$, $K_{2P} = 0.5$:\n$$\n\\frac{B^{*}}{K_{2B}} = \\frac{0.25}{0.2} = 1.25\n$$\n$$\n\\frac{P^{*}}{K_{2P}} = \\frac{0.20}{0.5} = 0.4\n$$\nSubstituting these into the expression for $v_2$:\n$$\nv_2(0^{+}) = \\frac{(1.8)(1.25) - (0.9)(0.4)}{1 + 1.25 + 0.4} = \\frac{2.25 - 0.36}{2.65} = \\frac{1.89}{2.65}\n$$\n$$\nv_2(0^{+}) \\approx 0.7132075... \\ \\mathrm{mM\\,min^{-1}}\n$$\nFinally, we calculate the rate of change of $[B]$:\n$$\n\\left.\\frac{d[B]}{dt}\\right|_{t=0^{+}} = v_1(0^{+}) - v_2(0^{+}) \\approx 0.1764705... - 0.7132075...\n$$\n$$\n\\left.\\frac{d[B]}{dt}\\right|_{t=0^{+}} \\approx -0.536737... \\ \\mathrm{mM\\,min^{-1}}\n$$\nThe problem requires the result to be rounded to four significant figures.\n$$\n\\left.\\frac{d[B]}{dt}\\right|_{t=0^{+}} \\approx -0.5367 \\ \\mathrm{mM\\,min^{-1}}\n$$\nThe negative sign indicates that at the moment immediately following the substrate upshift, the net flux through metabolite $B$ is negative, meaning its concentration begins to decrease. This is because the consumption flux $v_2$ is instantaneously larger than the production flux $v_1$.", "answer": "$$\\boxed{-0.5367}$$", "id": "2579659"}, {"introduction": "While metabolite concentrations provide a snapshot of the metabolic state, they do not directly reveal the rate of metabolic activity. To measure these underlying rates, or fluxes, we often employ stable isotope tracers. This exercise demystifies the core principles of $^{13}$C-Metabolic Flux Analysis (MFA) by having you calculate the propagation of an isotopic label through a simplified pathway, accounting for dilution from unlabeled sources. Mastering this logic is key to understanding how experimental mass spectrometry data can be used to quantify the intricate workings of cellular metabolism at steady state [@problem_id:2579693].", "problem": "A linear metabolic pathway $A \\to B \\to C$ carries three-carbon units with no carbon loss and no rearrangement of carbon positions between steps. Cells are supplied with uniformly labeled glucose $[U\\text{-}^{13}C_{6}]$, and the system is allowed to reach isotopic steady state. Assume all metabolite pools are at steady state (total inflow equals total outflow for each metabolite), and that the only isotopic forms entering the pathway from the labeled source are fully labeled three-carbon units ($M+3$). Unlabeled dilution occurs at each node through specified unlabeled inflows.\n\nThe inflows are:\n- Formation of $A$ from two sources: a labeled source derived from $[U\\text{-}^{13}C_{6}]$ glucose at flux $v_{L} = 8$ nmol min$^{-1}$ (producing $A$ as $M+3$) and an unlabeled source at flux $v_{U} = 2$ nmol min$^{-1}$ (producing $A$ as $M+0$).\n- Conversion $A \\to B$ proceeds with flux equal to the total formation of $A$. In addition, $B$ receives an unlabeled inflow $v_{B,u} = 5$ nmol min$^{-1}$.\n- Conversion $B \\to C$ proceeds with flux equal to the total formation of $B$. In addition, $C$ receives an unlabeled inflow $v_{C,u} = 5$ nmol min$^{-1}$.\n\nAssume that no other sources or sinks exist and that isotopic labeling is preserved across $A \\to B \\to C$ transformations. Using conservation of mass and isotopic labeling at isotopic steady state, compute the steady-state fraction of the $M+3$ isotopologue in $C$. Express your answer as a unitless decimal fraction and round to three significant figures.", "solution": "The problem posed is scientifically grounded, well-posed, and objective. It describes a standard isotopic labeling experiment analyzed through mass balance principles, a fundamental technique in metabolic flux analysis. All necessary parameters are provided, and there are no internal contradictions. Therefore, the problem is valid, and we shall proceed with its solution.\n\nThe fundamental principle for solving this problem is the conservation of mass and isotopic labels at steady state. For any given metabolite pool, the total rate of mass inflow must equal the total rate of mass outflow. Similarly, the rate of inflow for a specific isotopologue (in this case, the fully labeled $M+3$ form) must equal its rate of outflow. The fractional abundance of an isotopologue in a pool is defined as the ratio of the inflow flux of that isotopologue to the total inflow flux into the pool.\n\nLet $f_X(M+3)$ represent the mole fraction of the $M+3$ isotopologue in the pool of metabolite $X$, where $X \\in \\{A, B, C\\}$. We are given the fluxes in units of nmol min$^{-1}$, but since we are calculating unitless fractions, we may treat them as dimensionless quantities for the purpose of the ratios.\n\nWe will analyze each metabolite pool sequentially.\n\nFirst, consider metabolite $A$.\nThe pool of $A$ is formed from two sources: a labeled source with flux $v_{L} = 8$, which produces only the $M+3$ isotopologue of $A$, and an unlabeled source with flux $v_{U} = 2$, which produces only the $M+0$ isotopologue.\nThe total flux into pool $A$, denoted $v_{in,A}$, is the sum of these two fluxes:\n$$ v_{in,A} = v_{L} + v_{U} = 8 + 2 = 10 $$\nThe flux of the labeled species ($M+3$) into pool $A$ is precisely $v_{L}$.\nAt isotopic steady state, the fractional abundance of the $M+3$ isotopologue in pool $A$, $f_A(M+3)$, is the ratio of the labeled inflow to the total inflow:\n$$ f_A(M+3) = \\frac{v_{L}}{v_{in,A}} = \\frac{8}{10} = 0.8 $$\nAccording to the problem statement, the flux from $A$ to $B$, denoted $v_{A \\to B}$, is equal to the total formation rate of $A$. Thus, $v_{A \\to B} = v_{in,A} = 10$.\n\nNext, we analyze metabolite $B$.\nThe pool of $B$ is formed from two sources: the conversion from metabolite $A$ with flux $v_{A \\to B} = 10$, and an additional unlabeled inflow $v_{B,u} = 5$.\nThe total flux into pool $B$, denoted $v_{in,B}$, is:\n$$ v_{in,B} = v_{A \\to B} + v_{B,u} = 10 + 5 = 15 $$\nThe inflow of the labeled ($M+3$) species into pool $B$ comes exclusively from metabolite $A$. This flux is the product of the total flux from $A$ and the fractional abundance of $M+3$ in $A$:\n$$ v_{in,B}^{(M+3)} = v_{A \\to B} \\times f_A(M+3) = 10 \\times 0.8 = 8 $$\nThe fractional abundance of the $M+3$ isotopologue in pool $B$, $f_B(M+3)$, is then:\n$$ f_B(M+3) = \\frac{v_{in,B}^{(M+3)}}{v_{in,B}} = \\frac{8}{15} $$\nThe total flux from $B$ to $C$, denoted $v_{B \\to C}$, is equal to the total formation rate of $B$. Thus, $v_{B \\to C} = v_{in,B} = 15$.\n\nFinally, we analyze metabolite $C$.\nThe pool of $C$ is formed from two sources: the conversion from metabolite $B$ with flux $v_{B \\to C} = 15$, and an additional unlabeled inflow $v_{C,u} = 5$.\nThe total flux into pool $C$, denoted $v_{in,C}$, is:\n$$ v_{in,C} = v_{B \\to C} + v_{C,u} = 15 + 5 = 20 $$\nThe inflow of the labeled ($M+3$) species into pool $C$ comes exclusively from metabolite $B$. This flux is the product of the total flux from $B$ and the fractional abundance of $M+3$ in $B$:\n$$ v_{in,C}^{(M+3)} = v_{B \\to C} \\times f_B(M+3) = 15 \\times \\frac{8}{15} = 8 $$\nThe fractional abundance of the $M+3$ isotopologue in pool $C$, $f_C(M+3)$, is the quantity we must compute. It is the ratio of the labeled inflow to the total inflow for pool $C$:\n$$ f_C(M+3) = \\frac{v_{in,C}^{(M+3)}}{v_{in,C}} = \\frac{8}{20} = 0.4 $$\nThe problem requires the answer to be expressed as a decimal fraction rounded to three significant figures. The value $0.4$ expressed to three significant figures is $0.400$.", "answer": "$$ \\boxed{0.400} $$", "id": "2579693"}, {"introduction": "Genome-scale metabolic models (GEMs) represent the culmination of multi-omics integration, using genomic data to define the entire metabolic potential of an organism. While Flux Balance Analysis (FBA) predicts an optimal flux distribution for a given objective, the solution is often not unique. This practice introduces Flux Variability Analysis (FVA), a powerful technique to characterize the full range of achievable fluxes for every reaction while maintaining optimal performance. By implementing FVA, you will learn to explore the flexibility and redundancy inherent in metabolic networks, providing a much richer understanding of cellular physiology than a single optimal solution can offer [@problem_id:2579719].", "problem": "You are given three steady-state metabolic network models defined by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^n$, lower bounds $l \\in \\mathbb{R}^n$, upper bounds $u \\in \\mathbb{R}^n$, and an objective vector $c \\in \\mathbb{R}^n$. The fundamental base is the steady-state assumption and mass conservation, which impose $S v = 0$, together with bound constraints $l \\le v \\le u$ on each reaction flux. The optimization objective is to maximize a linear functional $c^\\top v$ representing biomass production in Flux Balance Analysis (FBA). Flux Variability Analysis (FVA) computes, for each reaction $j$, the minimum and maximum feasible $v_j$ under the condition that the objective remains at its optimal value. You must implement FVA as a sequence of linear programs.\n\nStart from these fundamental definitions and laws:\n- Steady state: $S v = 0$.\n- Flux bounds: $l \\le v \\le u$.\n- Objective: maximize $c^\\top v$ over the feasible region.\n- Flux Variability Analysis: for each reaction index $j$, compute\n  $$ v_j^{\\min} = \\min_{v} \\; e_j^\\top v \\;\\; \\text{subject to} \\;\\; S v = 0, \\; l \\le v \\le u, \\; c^\\top v \\ge Z^\\* - \\delta, $$\n  $$ v_j^{\\max} = \\max_{v} \\; e_j^\\top v \\;\\; \\text{subject to} \\;\\; S v = 0, \\; l \\le v \\le u, \\; c^\\top v \\ge Z^\\* - \\delta, $$\n  where $e_j$ is the $j$-th standard basis vector, $Z^\\*$ is the optimal objective value, and $\\delta$ is a small tolerance to avoid numerical issues. In this problem, use a two-sided band $Z^\\* - \\delta \\le c^\\top v \\le Z^\\* + \\delta$ in all FVA subproblems. Let $\\delta = \\max\\{10^{-9}, 10^{-9}\\cdot \\lvert Z^\\* \\rvert\\}$.\n\nExplain how alternative optima arise in terms of feasible directions $d$ that satisfy $S d = 0$, $c^\\top d = 0$, and maintain feasibility with respect to the bounds.\n\nAll fluxes must be expressed in millimoles per gram dry weight per hour $(\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1})$. Your program must report FVA ranges rounded to six decimal places.\n\nTest suite. For each test case below, you are given the full model. The reaction order is the column order of $S$ and must match $l$, $u$, and $c$.\n\n- Test case $1$ (parallel pathways with alternative optima):\n  - Metabolites (rows): $[S, A, B, \\mathrm{Biomass}]$.\n  - Reactions (columns): $[v_0, v_{1a}, v_{2a}, v_{1b}, v_{2b}, v_{bm}]$.\n  - Stoichiometry $S \\in \\mathbb{R}^{4 \\times 6}$:\n    $$ S = \\begin{bmatrix}\n    1 & -1 & 0 & -1 & 0 & 0 \\\\\n    0 & 1 & -1 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 1 & -1 & 0 \\\\\n    0 & 0 & 1 & 0 & 1 & -1\n    \\end{bmatrix}.$$\n  - Bounds: $l = [0, 0, 0, 0, 0, 0]$, $u = [10, 1000, 1000, 1000, 1000, 1000]$.\n  - Objective: $c = [0, 0, 0, 0, 0, 1]$.\n\n- Test case $2$ (unique optimal flow plus an internal reversible cycle):\n  - Metabolites (rows): $[S, P, \\mathrm{Biomass}, C, D]$.\n  - Reactions (columns): $[v_0, v_1, v_2, v_{bm}, r_3, r_4]$.\n  - Stoichiometry $S \\in \\mathbb{R}^{5 \\times 6}$:\n    $$ S = \\begin{bmatrix}\n    1 & -1 & 0 & 0 & 0 & 0 \\\\\n    0 & 1 & -1 & 0 & 0 & 0 \\\\\n    0 & 0 & 1 & -1 & 0 & 0 \\\\\n    0 & 0 & 0 & 0 & -1 & 1 \\\\\n    0 & 0 & 0 & 0 & 1 & -1\n    \\end{bmatrix}.$$\n  - Bounds: $l = [0, 0, 0, 0, -5, -5]$, $u = [10, 1000, 1000, 1000, 5, 5]$.\n  - Objective: $c = [0, 0, 0, 1, 0, 0]$.\n\n- Test case $3$ (capacity-limited branch with a blocked reaction):\n  - Metabolites (rows): $[S, X, Y, \\mathrm{Biomass}, E, F]$.\n  - Reactions (columns): $[v_0, v_1, v_2, v_3, v_4, v_{bm}, r_{block}]$.\n  - Stoichiometry $S \\in \\mathbb{R}^{6 \\times 7}$:\n    $$ S = \\begin{bmatrix}\n    1 & -1 & 0 & -1 & 0 & 0 & 0 \\\\\n    0 & 1 & -1 & 0 & 0 & 0 & 0 \\\\\n    0 & 0 & 0 & 1 & -1 & 0 & 0 \\\\\n    0 & 0 & 1 & 0 & 1 & -1 & 0 \\\\\n    0 & 0 & 0 & 0 & 0 & 0 & -1 \\\\\n    0 & 0 & 0 & 0 & 0 & 0 & 1\n    \\end{bmatrix}.$$\n  - Bounds: $l = [0, 0, 0, 0, 0, 0, 0]$, $u = [8, 1000, 3, 1000, 1000, 1000, 1000]$.\n  - Objective: $c = [0, 0, 0, 0, 0, 1, 0]$.\n\nAlgorithmic requirements:\n- First compute the optimal objective value $Z^\\* = \\max\\{c^\\top v \\mid S v = 0, l \\le v \\le u\\}$ for each test case.\n- Then, for each reaction index $j$, compute $v_j^{\\min}$ and $v_j^{\\max}$ by solving two linear programs with $S v = 0$, $l \\le v \\le u$, and the band constraint $Z^\\* - \\delta \\le c^\\top v \\le Z^\\* + \\delta$.\n- Use $\\delta = \\max\\{10^{-9}, 10^{-9}\\cdot \\lvert Z^\\* \\rvert\\}$.\n- Report each pair $[v_j^{\\min}, v_j^{\\max}]$ rounded to six decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the $k$-th element is a list of $n_k$ two-element lists $[v_j^{\\min}, v_j^{\\max}]$ for test case $k$, in the exact reaction order specified above. For example, the string should look like $[[[a,b],[c,d]],[[e,f],\\dots],\\dots]$ with all numbers rounded to six decimal places. Units are $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n\nYour program must be self-contained, take no input, and produce exactly one line as specified.", "solution": "The supplied problem is rigorously defined, scientifically sound, and computationally tractable. It is well-posed, providing all necessary matrices, vectors, and constants to perform Flux Balance Analysis (FBA) and Flux Variability Analysis (FVA). The constraints are consistent, and the objectives are clearly specified. The problem is valid and will be solved as stated.\n\nThe core of this problem lies in the application of linear programming to analyze stoichiometric models of metabolic networks under the steady-state assumption. This assumption, formalized by the equation $S v = 0$, dictates that the production rate of each internal metabolite equals its consumption rate, resulting in no net change in metabolite concentrations over time. Here, $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for a network with $m$ metabolites and $n$ reactions, and $v \\in \\mathbb{R}^n$ is the vector of reaction fluxes.\n\nThe set of feasible flux distributions is constrained by the steady-state condition and thermodynamic and physiological limits on reaction rates, expressed as lower and upper bounds, $l \\le v \\le u$. This defines a convex polytope known as the feasible flux space.\n\nFlux Balance Analysis (FBA) seeks to find a point in this feasible space that optimizes a given biological objective. This objective is typically formulated as a linear combination of fluxes, $Z = c^\\top v$, where $c$ is a vector of coefficients. A common objective is the maximization of biomass production, represented by a pseudo-reaction that consumes metabolic precursors in stoichiometrically appropriate ratios. The FBA problem is a linear program (LP):\n$$ Z^\\* = \\max_{v} \\;\\; c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\;\\; l \\le v \\le u $$\n\nIn many biological systems, the optimal solution to the FBA problem is not unique. This phenomenon, known as the existence of alternative optima, arises when the feasible space contains a subspace of solutions that all yield the same maximal objective value, $Z^\\*$. Analytically, alternative optima exist if there is a non-zero direction vector $d \\in \\mathbb{R}^n$ such that for an optimal flux distribution $v^\\*$, the new distribution $v = v^\\* + \\alpha d$ (for some scalar $\\alpha \\neq 0$) is also an optimal solution. This requires three conditions on the direction vector $d$:\n1. $S d = 0$: The direction vector must lie in the null space of the stoichiometric matrix to maintain the steady-state condition. Such vectors represent balanced cycles or alternative pathways within the network.\n2. $c^\\top d = 0$: The direction vector must be orthogonal to the objective vector $c$. This ensures that moving along $d$ does not alter the objective function value.\n3. $l \\le v^\\* + \\alpha d \\le u$: The new flux vector must remain within the specified flux bounds.\n\nFlux Variability Analysis (FVA) is a computational method designed to characterize the full range of alternative optimal solutions. For each reaction $j$, FVA determines the minimum and maximum possible flux $v_j$ across the entire set of solutions that achieve the optimal objective value $Z^\\*$. To account for numerical inaccuracies inherent in floating-point arithmetic, it is practical to allow fluxes that achieve an objective value within a small tolerance $\\delta$ of the true optimum $Z^\\*$. As specified, we will constrain the objective flux to the interval $[Z^\\* - \\delta, Z^\\* + \\delta]$. The tolerance $\\delta$ is defined as $\\delta = \\max\\{10^{-9}, 10^{-9}\\cdot \\lvert Z^\\* \\rvert\\}$.\n\nFor each reaction $j \\in \\{1, \\dots, n\\}$, FVA entails solving two LPs:\n$$ v_j^{\\min} = \\min_{v} \\; e_j^\\top v \\quad \\text{subject to} \\quad S v = 0, \\;\\; l \\le v \\le u, \\;\\; Z^\\* - \\delta \\le c^\\top v \\le Z^\\* + \\delta $$\n$$ v_j^{\\max} = \\max_{v} \\; e_j^\\top v \\quad \\text{subject to} \\quad S v = 0, \\;\\; l \\le v \\le u, \\;\\; Z^\\* - \\delta \\le c^\\top v \\le Z^\\* + \\delta $$\nwhere $e_j$ is the $j$-th standard basis vector (a vector of zeros with a $1$ at position $j$).\n\nThe computational procedure to solve the problem for each test case is as follows:\n1. Solve the FBA problem to find the optimal objective value $Z^\\*$. Maximizing $c^\\top v$ is equivalent to minimizing $(-c)^\\top v$.\n2. Calculate the tolerance $\\delta$.\n3. For each reaction $j=1, \\ldots, n$:\n    a. Solve an LP to find $v_j^{\\min}$. The objective is to minimize $e_j^\\top v$. The constraints are $S v = 0$, $l \\le v \\le u$, and the two-sided band constraint on the original objective, which can be expressed as two linear inequalities: $c^\\top v \\le Z^\\* + \\delta$ and $-c^\\top v \\le -(Z^\\* - \\delta)$.\n    b. Solve a second LP to find $v_j^{\\max}$. The objective is to maximize $e_j^\\top v$, which is equivalent to minimizing $(-e_j)^\\top v$, subject to the same set of constraints as in step 3a.\n4. Collect the pairs $[v_j^{\\min}, v_j^{\\max}]$ for all reactions to form the complete FVA result for the given model.\n\nThis process will be implemented using the `scipy.optimize.linprog` function, which provides a robust solver for linear programming problems. The results for each of the three test cases will be calculated and formatted as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run FVA on them, and print results.\n    \"\"\"\n    # Test case 1: Parallel pathways with alternative optima\n    S1 = np.array([\n        [1, -1, 0, -1, 0, 0],\n        [0, 1, -1, 0, 0, 0],\n        [0, 0, 0, 1, -1, 0],\n        [0, 0, 1, 0, 1, -1]\n    ], dtype=float)\n    l1 = np.array([0, 0, 0, 0, 0, 0], dtype=float)\n    u1 = np.array([10, 1000, 1000, 1000, 1000, 1000], dtype=float)\n    c1 = np.array([0, 0, 0, 0, 0, 1], dtype=float)\n    \n    # Test case 2: Unique optimal flow plus an internal reversible cycle\n    S2 = np.array([\n        [1, -1, 0, 0, 0, 0],\n        [0, 1, -1, 0, 0, 0],\n        [0, 0, 1, -1, 0, 0],\n        [0, 0, 0, 0, -1, 1],\n        [0, 0, 0, 0, 1, -1]\n    ], dtype=float)\n    l2 = np.array([0, 0, 0, 0, -5, -5], dtype=float)\n    u2 = np.array([10, 1000, 1000, 1000, 5, 5], dtype=float)\n    c2 = np.array([0, 0, 0, 1, 0, 0], dtype=float)\n\n    # Test case 3: Capacity-limited branch with a blocked reaction\n    S3 = np.array([\n        [1, -1, 0, -1, 0, 0, 0],\n        [0, 1, -1, 0, 0, 0, 0],\n        [0, 0, 0, 1, -1, 0, 0],\n        [0, 0, 1, 0, 1, -1, 0],\n        [0, 0, 0, 0, 0, 0, -1],\n        [0, 0, 0, 0, 0, 0, 1]\n    ], dtype=float)\n    l3 = np.array([0, 0, 0, 0, 0, 0, 0], dtype=float)\n    u3 = np.array([8, 1000, 3, 1000, 1000, 1000, 1000], dtype=float)\n    c3 = np.array([0, 0, 0, 0, 0, 1, 0], dtype=float)\n    \n    test_cases = [\n        (S1, l1, u1, c1),\n        (S2, l2, u2, c2),\n        (S3, l3, u3, c3)\n    ]\n\n    all_results = []\n    for S, l, u, c in test_cases:\n        fva_result = perform_fva(S, l, u, c)\n        all_results.append(fva_result)\n\n    # Format the final output string\n    formatted_cases = []\n    for case_results in all_results:\n        # Round and format each [min, max] pair\n        formatted_pairs = [f\"[{round(v_min, 6):.6f},{round(v_max, 6):.6f}]\" for v_min, v_max in case_results]\n        formatted_cases.append(f\"[{','.join(formatted_pairs)}]\")\n    \n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\ndef perform_fva(S, l, u, c):\n    \"\"\"\n    Performs Flux Balance Analysis (FBA) followed by Flux Variability Analysis (FVA).\n    Args:\n        S (np.ndarray): Stoichiometric matrix.\n        l (np.ndarray): Lower bounds for fluxes.\n        u (np.ndarray): Upper bounds for fluxes.\n        c (np.ndarray): Objective function vector.\n    Returns:\n        list: A list of [min_flux, max_flux] pairs for each reaction.\n    \"\"\"\n    m, n = S.shape\n    bounds = list(zip(l, u))\n    b_eq = np.zeros(m)\n    \n    # 1. Perform FBA to find the optimal objective value Z*\n    # We maximize c'v, which is equivalent to minimizing -c'v\n    res_fba = linprog(c=-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs-ds')\n    \n    if not res_fba.success:\n        # Return empty/error if initial problem is infeasible\n        return [[None, None]] * n\n    \n    z_opt = -res_fba.fun\n\n    # 2. Perform FVA for each reaction\n    delta = max(1e-9, 1e-9 * abs(z_opt))\n    fva_ranges = []\n    \n    # Define the additional band constraint for FVA: Z* - delta <= c'v <= Z* + delta\n    # This becomes two inequality constraints:\n    # 1. c'v <= Z* + delta\n    # 2. -c'v <= -(Z* - delta)\n    A_ub_fva = np.vstack([c, -c])\n    b_ub_fva = np.array([z_opt + delta, -(z_opt - delta)])\n\n    for j in range(n):\n        # Minimize v_j\n        c_min = np.zeros(n)\n        c_min[j] = 1.0\n        res_min = linprog(c=c_min, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs-ds')\n        v_min = res_min.fun if res_min.success else 0.0\n\n        # Maximize v_j (by minimizing -v_j)\n        c_max = np.zeros(n)\n        c_max[j] = -1.0\n        res_max = linprog(c=c_max, A_ub=A_ub_fva, b_ub=b_ub_fva, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs-ds')\n        v_max = -res_max.fun if res_max.success else 0.0\n        \n        # Handle potential small negative values that should be zero\n        if abs(v_min) < 1e-9: v_min = 0.0\n        if abs(v_max) < 1e-9: v_max = 0.0\n\n        fva_ranges.append([v_min, v_max])\n        \n    return fva_ranges\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "2579719"}]}