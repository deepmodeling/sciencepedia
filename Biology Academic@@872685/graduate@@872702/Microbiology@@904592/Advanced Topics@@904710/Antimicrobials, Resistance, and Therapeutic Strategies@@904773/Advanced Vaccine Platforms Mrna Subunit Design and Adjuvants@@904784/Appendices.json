{"hands_on_practices": [{"introduction": "A foundational advantage of messenger RNA (mRNA) technology is its capacity for in-situ amplification, turning host cells into bioreactors for antigen production. This practice [@problem_id:2469014] provides a framework to quantify this benefit by calculating a theoretical 'dose-sparing factor,' a critical metric that compares the antigen yield from an mRNA dose to that of a traditional subunit protein vaccine. By working through this calculation, you will connect fundamental principles of stoichiometry and kinetics to understand the platform's profound efficiency.", "problem": "A biotechnology team wants to compare the antigen-equivalent output of a single dose of a messenger RNA (mRNA) vaccine to a classical subunit protein vaccine to quantify theoretical dose sparing. Use only foundational principles: the Central Dogma of Molecular Biology (translation produces proteins from mRNA), first-order decay kinetics for mRNA stability, and stoichiometric conversion between mass, moles, and molecules.\n\nConsider a lipid nanoparticle (LNP)-formulated messenger RNA (mRNA) vaccine encoding a single-chain protein antigen. One mRNA dose contains $m_m = 30\\,\\mu\\text{g}$ of a single open reading frame of length $L = 4100$ nucleotides. Assume an average mononucleotide molar mass of $330\\,\\text{g/mol}$ for single-stranded RNA. After intramuscular administration, a fraction $f_u = 0.20$ of the dosed mRNA molecules enter cells, and an independent fraction $f_e = 0.15$ of the cell-internalized mRNA molecules escape to the cytosol to become translation competent. Within the cytosol, each intact mRNA produces fully folded antigen molecules at a constant completion rate $r = 0.030\\,\\text{s}^{-1}$ until it is degraded. Assume first-order mRNA decay in cells with half-life $t_{1/2} = 5\\,\\text{h}$. Each completed translation yields exactly one antigen molecule. Ignore secretion, trafficking, and antigen processing; count every completed protein as one antigen copy.\n\nFor the comparator subunit formulation, a dose contains $m_s = 25\\,\\mu\\text{g}$ of purified antigen with molecular mass $M_A = 120\\,\\text{kDa}$. Assume all administered subunit antigen molecules are counted as antigen copies.\n\nUse Avogadro’s number $N_A = 6.022\\times 10^{23}\\,\\text{mol}^{-1}$. Define the theoretical antigen-equivalent dose-sparing factor $S$ as the ratio of the total number of antigen molecules generated intracellularly by the mRNA dose to the total number of antigen molecules physically administered in the subunit dose, i.e., $S = \\text{(antigen copies from mRNA dose)}\\,/\\,\\text{(antigen molecules in subunit dose)}$.\n\nCompute $S$ as a decimal. Round your answer to three significant figures. Report $S$ as a pure number with no units.", "solution": "The problem requires the computation of a dose-sparing factor, $S$, defined as the ratio of the total number of antigen molecules produced by an mRNA vaccine dose to the number of antigen molecules contained within a subunit vaccine dose. The solution must proceed from first principles.\n\nThe sparing factor $S$ is given by the definition:\n$$S = \\frac{N_{\\text{Ag, mRNA}}}{N_{\\text{Ag, subunit}}}$$\nwhere $N_{\\text{Ag, mRNA}}$ is the total number of antigen molecules produced by the mRNA dose and $N_{\\text{Ag, subunit}}$ is the total number of antigen molecules in the subunit protein dose. We will calculate these two quantities separately.\n\nFirst, we calculate the number of antigen molecules in the subunit vaccine dose, $N_{\\text{Ag, subunit}}$. This is a direct stoichiometric calculation.\nThe given mass of the subunit antigen is $m_s = 25\\,\\mu\\text{g} = 25 \\times 10^{-6}\\,\\text{g}$.\nThe molecular mass of the antigen is given as $M_A = 120\\,\\text{kDa}$. This corresponds to a molar mass of $M_A = 120 \\times 10^3\\,\\text{g/mol}$.\nThe number of moles of antigen, $n_s$, is the mass divided by the molar mass:\n$$n_s = \\frac{m_s}{M_A}$$\nThe number of molecules, $N_{\\text{Ag, subunit}}$, is the number of moles multiplied by Avogadro's number, $N_A = 6.022 \\times 10^{23}\\,\\text{mol}^{-1}$:\n$$N_{\\text{Ag, subunit}} = n_s \\times N_A = \\frac{m_s}{M_A} N_A$$\n\nNext, we calculate the total number of antigen molecules produced by the mRNA dose, $N_{\\text{Ag, mRNA}}$. This is a multi-step process.\n\nStep 1: Determine the initial number of translation-competent mRNA molecules, $N_{m,0}$.\nThe total mass of administered mRNA is $m_m = 30\\,\\mu\\text{g} = 30 \\times 10^{-6}\\,\\text{g}$.\nThe mRNA molecule has a length of $L = 4100$ nucleotides.\nThe average molar mass of a single nucleotide is $M_{nt} = 330\\,\\text{g/mol}$.\nTherefore, the molar mass of the entire mRNA strand, $M_m$, is:\n$$M_m = L \\times M_{nt} = 4100 \\times 330\\,\\text{g/mol} = 1.353 \\times 10^6\\,\\text{g/mol}$$\nThe total number of mRNA molecules in the administered dose, $N_{m, \\text{total}}$, is:\n$$N_{m, \\text{total}} = \\frac{m_m}{M_m} N_A$$\nNot all of these molecules become translation-competent. A fraction $f_u = 0.20$ enters cells, and of those, an independent fraction $f_e = 0.15$ escapes to the cytosol. The initial number of translation-competent mRNA molecules, $N_{m,0}$, is therefore:\n$$N_{m,0} = N_{m, \\text{total}} \\times f_u \\times f_e = \\frac{m_m}{M_m} N_A f_u f_e$$\n\nStep 2: Model the production of antigen over time.\nThe number of translation-competent mRNA molecules, $N_m(t)$, decreases over time due to first-order decay. The equation for this process is:\n$$N_m(t) = N_{m,0} \\exp(-kt)$$\nwhere $k$ is the decay rate constant. The constant $k$ is related to the half-life, $t_{1/2}$, by:\n$$k = \\frac{\\ln(2)}{t_{1/2}}$$\nThe problem states $t_{1/2} = 5\\,\\text{h}$. For consistency with the translation rate unit ($s^{-1}$), we must convert the half-life to seconds:\n$$t_{1/2} = 5\\,\\text{h} \\times \\frac{3600\\,\\text{s}}{1\\,\\text{h}} = 18000\\,\\text{s}$$\nThe rate of antigen production at any time $t$, $\\frac{dN_{\\text{Ag}}}{dt}$, is the product of the number of intact mRNA molecules at that time, $N_m(t)$, and the translation completion rate per molecule, $r = 0.030\\,\\text{s}^{-1}$:\n$$\\frac{dN_{\\text{Ag}}}{dt} = r \\times N_m(t) = r N_{m,0} \\exp(-kt)$$\nTo find the total number of antigen molecules produced, $N_{\\text{Ag, mRNA}}$, we integrate this rate from time $t=0$ until all mRNA has decayed ($t \\to \\infty$):\n$$N_{\\text{Ag, mRNA}} = \\int_{0}^{\\infty} r N_{m,0} \\exp(-kt) dt$$\nSince $r$ and $N_{m,0}$ are constants, we can take them out of the integral:\n$$N_{\\text{Ag, mRNA}} = r N_{m,0} \\int_{0}^{\\infty} \\exp(-kt) dt$$\nThe integral evaluates to:\n$$\\int_{0}^{\\infty} \\exp(-kt) dt = \\left[ -\\frac{1}{k} \\exp(-kt) \\right]_{0}^{\\infty} = 0 - \\left(-\\frac{1}{k}\\right) = \\frac{1}{k}$$\nThus, the total number of antigen molecules is:\n$$N_{\\text{Ag, mRNA}} = \\frac{r N_{m,0}}{k} = N_{m,0} \\frac{r t_{1/2}}{\\ln(2)}$$\nSubstituting the expression for $N_{m,0}$:\n$$N_{\\text{Ag, mRNA}} = \\left( \\frac{m_m}{M_m} N_A f_u f_e \\right) \\frac{r t_{1/2}}{\\ln(2)}$$\n\nFinally, we compute the sparing factor $S$ by taking the ratio of $N_{\\text{Ag, mRNA}}$ to $N_{\\text{Ag, subunit}}$:\n$$S = \\frac{N_{\\text{Ag, mRNA}}}{N_{\\text{Ag, subunit}}} = \\frac{\\left( \\frac{m_m}{M_m} N_A f_u f_e \\right) \\frac{r t_{1/2}}{\\ln(2)}}{\\frac{m_s}{M_A} N_A}$$\nAvogadro's number $N_A$ cancels from the numerator and denominator, simplifying the expression significantly. This is expected, as the final ratio should only depend on the relative masses, efficiencies, and rates.\n$$S = \\frac{\\frac{m_m f_u f_e}{M_m} \\frac{r t_{1/2}}{\\ln(2)}}{\\frac{m_s}{M_A}} = \\frac{m_m}{m_s} \\frac{M_A}{M_m} f_u f_e \\frac{r t_{1/2}}{\\ln(2)}$$\nSubstituting $M_m = L \\times M_{nt}$:\n$$S = \\frac{m_m}{m_s} \\frac{M_A}{L \\times M_{nt}} f_u f_e \\frac{r t_{1/2}}{\\ln(2)}$$\nNow, we substitute the numerical values:\n$m_m = 30 \\times 10^{-6}\\,\\text{g}$\n$m_s = 25 \\times 10^{-6}\\,\\text{g}$\n$M_A = 120 \\times 10^3\\,\\text{g/mol}$\n$L = 4100$\n$M_{nt} = 330\\,\\text{g/mol}$\n$f_u = 0.20$\n$f_e = 0.15$\n$r = 0.030\\,\\text{s}^{-1}$\n$t_{1/2} = 18000\\,\\text{s}$\n\n$$S = \\frac{30 \\times 10^{-6}}{25 \\times 10^{-6}} \\times \\frac{120 \\times 10^3}{4100 \\times 330} \\times (0.20 \\times 0.15) \\times \\frac{0.030 \\times 18000}{\\ln(2)}$$\n$$S = 1.2 \\times \\frac{120000}{1353000} \\times 0.03 \\times \\frac{540}{\\ln(2)}$$\n$$S = 1.2 \\times 0.08869179... \\times 0.03 \\times 779.0531...$$\n$$S \\approx 2.48746$$\nThe problem requires the answer to be rounded to three significant figures.\n$$S \\approx 2.49$$\nThis result quantifies the amplification effect of the mRNA platform. Despite a lower delivery efficiency into the cytosol ($3\\%$), the continuous translation of each mRNA molecule prior to its degradation leads to a greater total yield of antigen compared to the direct administration of the same protein antigen mass.", "answer": "$$\\boxed{2.49}$$", "id": "2469014"}, {"introduction": "The total amount of antigen produced is only part of the story; the dynamic profile of its expression is a key determinant of immunogenicity. This exercise [@problem_id:2469082] guides you through the construction and solution of a two-compartment kinetic model, a cornerstone of pharmacodynamics, to predict the time-course of intracellular antigen levels. By deriving the time-to-peak antigen concentration, you will gain insight into how mRNA stability and protein turnover rates collaboratively shape the duration and intensity of antigen presentation.", "problem": "A lipid nanoparticle-delivered messenger ribonucleic acid (mRNA) vaccine encodes a subunit antigen that is translated in the cytosol and then degraded. Assume the intracellular mRNA amount is $M(t)$ and the intracellular antigen (protein) amount is $P(t)$. Starting from the central dogma of molecular biology (templated translation of mRNA to protein) and first-order kinetics for both mRNA decay and protein decay, construct a minimal two-compartment expression model in which mRNA decays with a first-order rate constant $k_m$, protein is translated from mRNA with a rate constant $k_t$ proportional to $M(t)$, and protein decays with a first-order rate constant $k_p$. Use this model to derive an analytic expression for $P(t)$ with initial conditions $M(0)=M_0$ and $P(0)=0$, assuming $k_m \\neq k_p$. Then, using the derived $P(t)$, determine the time-to-peak antigen amount (the time $t_{\\mathrm{peak}}$ at which $P(t)$ attains its maximum).\n\nFor a realistic mRNA vaccine scenario, use $M_0=2.0\\times 10^5$ molecules per cell, $k_m=0.35\\ \\mathrm{h}^{-1}$, $k_p=0.05\\ \\mathrm{h}^{-1}$, and $k_t=120\\ \\mathrm{h}^{-1}$. Express your final answer as the numerical value of $t_{\\mathrm{peak}}$ in hours. Round your answer to four significant figures.", "solution": "The kinetics of mRNA and protein concentration are described by a system of two coupled ordinary differential equations.\n\nFirst, we establish the equation for the amount of mRNA, $M(t)$. The problem states that mRNA decays with a first-order rate constant $k_m$. This gives the differential equation:\n$$\n\\frac{dM(t)}{dt} = -k_m M(t)\n$$\nThis is a standard exponential decay process. With the initial condition $M(0) = M_0$, the solution is found by separation of variables or by inspection:\n$$\nM(t) = M_0 \\exp(-k_m t)\n$$\nNext, we establish the equation for the amount of protein, $P(t)$. Protein is translated from mRNA at a rate proportional to $M(t)$ with rate constant $k_t$, and it decays with a first-order rate constant $k_p$. The rate of change of $P(t)$ is therefore the rate of production minus the rate of degradation:\n$$\n\\frac{dP(t)}{dt} = k_t M(t) - k_p P(t)\n$$\nSubstitute the expression for $M(t)$ into this equation:\n$$\n\\frac{dP(t)}{dt} = k_t M_0 \\exp(-k_m t) - k_p P(t)\n$$\nThis is a linear first-order ordinary differential equation. We can write it in the standard form $\\frac{dy}{dx} + P(x)y = Q(x)$:\n$$\n\\frac{dP(t)}{dt} + k_p P(t) = k_t M_0 \\exp(-k_m t)\n$$\nTo solve this, we use the method of integrating factors. The integrating factor $I(t)$ is given by:\n$$\nI(t) = \\exp\\left(\\int k_p dt\\right) = \\exp(k_p t)\n$$\nMultiplying the differential equation by $I(t)$ gives:\n$$\n\\exp(k_p t) \\frac{dP(t)}{dt} + k_p \\exp(k_p t) P(t) = k_t M_0 \\exp(-k_m t) \\exp(k_p t)\n$$\nThe left-hand side is the derivative of the product $P(t) I(t)$:\n$$\n\\frac{d}{dt} \\left[ P(t) \\exp(k_p t) \\right] = k_t M_0 \\exp((k_p - k_m)t)\n$$\nWe integrate both sides with respect to time $t$:\n$$\nP(t) \\exp(k_p t) = \\int k_t M_0 \\exp((k_p - k_m)t) dt\n$$\nSince $k_m \\neq k_p$, the term $k_p - k_m$ is non-zero. The integral is:\n$$\nP(t) \\exp(k_p t) = \\frac{k_t M_0}{k_p - k_m} \\exp((k_p - k_m)t) + C\n$$\nwhere $C$ is the constant of integration. To find $P(t)$, we divide by $\\exp(k_p t)$:\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\exp(-k_m t) + C \\exp(-k_p t)\n$$\nWe apply the initial condition $P(0) = 0$ to determine $C$:\n$$\nP(0) = 0 = \\frac{k_t M_0}{k_p - k_m} \\exp(0) + C \\exp(0)\n$$\n$$\n0 = \\frac{k_t M_0}{k_p - k_m} + C\n$$\n$$\nC = -\\frac{k_t M_0}{k_p - k_m}\n$$\nSubstituting $C$ back into the expression for $P(t)$, we obtain the analytic solution:\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\exp(-k_m t) - \\frac{k_t M_0}{k_p - k_m} \\exp(-k_p t)\n$$\n$$\nP(t) = \\frac{k_t M_0}{k_p - k_m} \\left( \\exp(-k_m t) - \\exp(-k_p t) \\right)\n$$\nThis is the required analytical expression for the amount of protein over time.\n\nTo find the time at which the antigen amount is at its maximum, $t_{\\mathrm{peak}}$, we must find the time at which the rate of change of $P(t)$ is zero. That is, we set $\\frac{dP(t)}{dt} = 0$.\nFrom the differential equation for $P(t)$, we have:\n$$\n\\frac{dP(t)}{dt} = k_t M(t) - k_p P(t) = k_t M_0 \\exp(-k_m t) - k_p P(t)\n$$\nSetting $\\frac{dP(t)}{dt}=0$ at $t = t_{\\mathrm{peak}}$:\n$$\nk_t M_0 \\exp(-k_m t_{\\mathrm{peak}}) = k_p P(t_{\\mathrm{peak}})\n$$\nSubstitute the expression for $P(t_{\\mathrm{peak}})$:\n$$\nk_t M_0 \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\left[ \\frac{k_t M_0}{k_p - k_m} \\left( \\exp(-k_m t_{\\mathrm{peak}}) - \\exp(-k_p t_{\\mathrm{peak}}) \\right) \\right]\n$$\nWe can cancel the term $k_t M_0$ (since $k_t>0, M_0>0$):\n$$\n\\exp(-k_m t_{\\mathrm{peak}}) = \\frac{k_p}{k_p - k_m} \\left( \\exp(-k_m t_{\\mathrm{peak}}) - \\exp(-k_p t_{\\mathrm{peak}}) \\right)\n$$\n$$\n(k_p - k_m) \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_m t_{\\mathrm{peak}}) - k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\nk_p \\exp(-k_m t_{\\mathrm{peak}}) - k_m \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_m t_{\\mathrm{peak}}) - k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\n-k_m \\exp(-k_m t_{\\mathrm{peak}}) = -k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\n$$\nk_m \\exp(-k_m t_{\\mathrm{peak}}) = k_p \\exp(-k_p t_{\\mathrm{peak}})\n$$\nNow, we solve for $t_{\\mathrm{peak}}$:\n$$\n\\frac{k_m}{k_p} = \\frac{\\exp(-k_p t_{\\mathrm{peak}})}{\\exp(-k_m t_{\\mathrm{peak}})} = \\exp((-k_p - (-k_m)) t_{\\mathrm{peak}}) = \\exp((k_m - k_p) t_{\\mathrm{peak}})\n$$\nTake the natural logarithm of both sides:\n$$\n\\ln\\left(\\frac{k_m}{k_p}\\right) = (k_m - k_p) t_{\\mathrm{peak}}\n$$\nFinally, we isolate $t_{\\mathrm{peak}}$:\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln\\left(\\frac{k_m}{k_p}\\right)}{k_m - k_p}\n$$\nThis is the symbolic expression for the time-to-peak.\n\nNow, we substitute the given numerical values: $k_m = 0.35 \\ \\mathrm{h}^{-1}$ and $k_p = 0.05 \\ \\mathrm{h}^{-1}$.\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln\\left(\\frac{0.35}{0.05}\\right)}{0.35 - 0.05} \\ \\mathrm{h}\n$$\n$$\nt_{\\mathrm{peak}} = \\frac{\\ln(7)}{0.30} \\ \\mathrm{h}\n$$\nUsing a calculator for the value of $\\ln(7)$:\n$$\n\\ln(7) \\approx 1.9459101\n$$\n$$\nt_{\\mathrm{peak}} \\approx \\frac{1.9459101}{0.30} \\ \\mathrm{h} \\approx 6.486367 \\ \\mathrm{h}\n$$\nRounding the result to four significant figures, as required by the problem statement:\n$$\nt_{\\mathrm{peak}} \\approx 6.486 \\ \\mathrm{h}\n$$\nThe parameters $M_0$ and $k_t$ affect the magnitude of the peak protein amount, $P(t_{\\mathrm{peak}})$, but they do not influence the time at which this peak occurs, $t_{\\mathrm{peak}}$.", "answer": "$$\n\\boxed{6.486}\n$$", "id": "2469082"}, {"introduction": "Ultimately, a successful vaccine must be effective across a genetically diverse human population, a challenge addressed by the field of immunoinformatics. This hands-on programming challenge [@problem_id:2469070] requires you to develop an algorithm for predicting a vaccine's population coverage based on its T-cell epitopes. You will learn to integrate peptide-MHC binding data with Human Leukocyte Antigen (HLA) allele frequencies, applying principles of population genetics to estimate the proportion of individuals capable of responding to the vaccine.", "problem": "You are designing an algorithm to estimate predicted population coverage for epitope-based vaccines in an advanced context involving subunit or messenger ribonucleic acid (mRNA) antigen design. The goal is to quantify the probability that at least one peptide from a specified set is presented by at least one Human Leukocyte Antigen (HLA) locus in a randomly sampled individual from a target population. Your computation must integrate peptide–HLA binding predictions and allele frequency data across loci.\n\nUse only the following foundational bases:\n- The basic axioms of probability, including the law of total probability, independence, and the complement rule.\n- The Hardy–Weinberg Equilibrium (HWE) for genotype probabilities at a locus from allele frequencies.\n- The standard assumption of independence across distinct HLA loci.\n- An independence model in which, within a locus, the two alleles in a diploid genotype contribute independent opportunities for presentation given their per-allele presentation probabilities.\n- For multiple peptides, independence across peptides when computing the probability that none are presented by a given allele.\n\nDefinitions to use:\n- Let the set of loci be $\\mathcal{L}$.\n- For each locus $\\ell \\in \\mathcal{L}$, let the allele set be $\\mathcal{A}_{\\ell}$ with per-allele frequencies $\\{f_{a}\\}_{a \\in \\mathcal{A}_{\\ell}}$ satisfying $\\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} = 1$ and $f_{a} \\ge 0$.\n- Assume HWE for each locus so that the genotype probability for a homozygote $(a/a)$ is $f_{a}^{2}$ and for a heterozygote $(a_{i}/a_{j})$ with $i \\ne j$ is $2 f_{a_{i}} f_{a_{j}}$.\n- Let the peptide set be $S$, and let $b_{p,a} \\in [0,1]$ be the per-allele probability that peptide $p \\in S$ is presented by allele $a$.\n- For each allele $a$, the probability that none of the peptides in $S$ are presented is $q_{a}(S) = \\prod_{p \\in S} (1 - b_{p,a})$.\n- For a diploid genotype $(a_{i}, a_{j})$ at locus $\\ell$, the probability that at least one peptide in $S$ is presented at that locus is $1 - q_{a_{i}}(S)\\,q_{a_{j}}(S)$.\n- The population-averaged locus-level presentation probability is obtained by averaging the genotype-level probability over the HWE genotype distribution at that locus.\n- Assuming independence across loci, the overall population coverage for the set $S$ across all loci is the probability that at least one locus presents at least one peptide in $S$.\n\nYour task is to implement a program that computes the overall coverage for each of the following test cases. You must treat any missing $b_{p,a}$ as $0$. There are $4$ test cases. For each test case, compute the overall population coverage as a float rounded to exactly $6$ decimal places.\n\nTest suite:\n\n- Test case $1$ (multi-locus, multi-peptide, general case):\n  - Loci and allele frequencies:\n    - Locus $\\mathrm{A}$: alleles $\\mathrm{A{*}01{:}01}$ with $f = 0.3$, $\\mathrm{A{*}02{:}01}$ with $f = 0.5$, $\\mathrm{A{*}03{:}01}$ with $f = 0.2$.\n    - Locus $\\mathrm{B}$: alleles $\\mathrm{B{*}07{:}02}$ with $f = 0.6$, $\\mathrm{B{*}08{:}01}$ with $f = 0.4$.\n  - Peptide set $S = \\{p_{1}, p_{2}\\}$ with per-allele binding probabilities $b_{p,a}$:\n    - For locus $\\mathrm{A}$:\n      - $b_{p_{1},\\mathrm{A{*}01{:}01}} = 0.7$, $b_{p_{2},\\mathrm{A{*}01{:}01}} = 0.2$.\n      - $b_{p_{1},\\mathrm{A{*}02{:}01}} = 0.1$, $b_{p_{2},\\mathrm{A{*}02{:}01}} = 0.6$.\n      - $b_{p_{1},\\mathrm{A{*}03{:}01}} = 0.0$, $b_{p_{2},\\mathrm{A{*}03{:}01}} = 0.1$.\n    - For locus $\\mathrm{B}$:\n      - $b_{p_{1},\\mathrm{B{*}07{:}02}} = 0.3$, $b_{p_{2},\\mathrm{B{*}07{:}02}} = 0.4$.\n      - $b_{p_{1},\\mathrm{B{*}08{:}01}} = 0.8$, $b_{p_{2},\\mathrm{B{*}08{:}01}} = 0.2$.\n\n- Test case $2$ (single locus, monomorphic boundary with a zero-frequency allele included):\n  - Locus and allele frequencies:\n    - Locus $\\mathrm{A}$: alleles $\\mathrm{A{*}01{:}01}$ with $f = 1.0$, $\\mathrm{A{*}02{:}01}$ with $f = 0.0$.\n  - Peptide set $S = \\{p_{3}\\}$:\n    - $b_{p_{3},\\mathrm{A{*}01{:}01}} = 0.5$.\n    - $b_{p_{3},\\mathrm{A{*}02{:}01}} = 0.0$.\n\n- Test case $3$ (two loci, one monomorphic locus dominates coverage):\n  - Loci and allele frequencies:\n    - Locus $\\mathrm{A}$: alleles $\\mathrm{A1}$ with $f = 0.5$, $\\mathrm{A2}$ with $f = 0.5$.\n    - Locus $\\mathrm{B}$: allele $\\mathrm{B1}$ with $f = 1.0$.\n  - Peptide set $S = \\{p_{4}, p_{5}\\}$:\n    - $b_{p_{4},\\mathrm{A1}} = 0.0$, $b_{p_{5},\\mathrm{A1}} = 0.0$.\n    - $b_{p_{4},\\mathrm{A2}} = 0.0$, $b_{p_{5},\\mathrm{A2}} = 0.0$.\n    - $b_{p_{4},\\mathrm{B1}} = 0.9$, $b_{p_{5},\\mathrm{B1}} = 0.0$.\n\n- Test case $4$ (rare high-binding allele and moderate binder at another locus):\n  - Loci and allele frequencies:\n    - Locus $\\mathrm{A}$: alleles $\\mathrm{A1}$ with $f = 0.01$, $\\mathrm{A2}$ with $f = 0.99$.\n    - Locus $\\mathrm{B}$: alleles $\\mathrm{B1}$ with $f = 0.5$, $\\mathrm{B2}$ with $f = 0.5$.\n  - Peptide set $S = \\{p_{6}\\}$:\n    - $b_{p_{6},\\mathrm{A1}} = 1.0$, $b_{p_{6},\\mathrm{A2}} = 0.0$, $b_{p_{6},\\mathrm{B1}} = 0.2$, $b_{p_{6},\\mathrm{B2}} = 0.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of test cases $1$ through $4$, for example, $\\big[$$r_{1}$,$r_{2}$,$r_{3}$,$r_{4}$$\\big]$.\n- Each $r_{i}$ must be rounded to exactly $6$ decimal places.", "solution": "The objective is to compute the overall population coverage, $C_{total}$, defined as the probability that a randomly selected individual from a population presents at least one peptide from a given set $S$ on at least one Human Leukocyte Antigen (HLA) locus from a set $\\mathcal{L}$.\n\nThe solution is derived from first principles as follows. The overall coverage $C_{total}$ is the complement of the event that an individual fails to present any peptide from $S$ at any locus in $\\mathcal{L}$. Let $E$ be the event of presentation at any locus, and $E^c$ be the event of failure at all loci. Then, $C_{total} = P(E) = 1 - P(E^c)$.\n\nThe problem specifies that presentation events at distinct HLA loci are statistically independent. Therefore, the probability of failure at all loci is the product of the probabilities of failure at each individual locus. Let $Q_{\\ell}$ be the probability of failure to present any peptide from $S$ at locus $\\ell \\in \\mathcal{L}$. The total probability of failure is:\n$$\nP(E^c) = \\prod_{\\ell \\in \\mathcal{L}} Q_{\\ell}\n$$\nThus, the overall coverage is:\n$$\nC_{total} = 1 - \\prod_{\\ell \\in \\mathcal{L}} Q_{\\ell}\n$$\nThe core of the problem is to determine the population-averaged locus-level failure probability, $Q_{\\ell}$. This is calculated by considering all possible diploid genotypes at locus $\\ell$ and their frequencies, as determined by the Hardy-Weinberg Equilibrium (HWE) principle.\n\nLet $\\mathcal{A}_{\\ell}$ be the set of alleles at locus $\\ell$, with corresponding frequencies $\\{f_{a}\\}_{a \\in \\mathcal{A}_{\\ell}}$. According to HWE, the frequency of a homozygous genotype $(a/a)$ is $f_{a}^{2}$, and the frequency of a heterozygous genotype $(a_i/a_j)$ for $a_i \\neq a_j$ is $2 f_{a_i} f_{a_j}$.\n\nFirst, we define the probability that a single allele $a$ fails to present any peptide from the set $S$. The problem states that the per-allele presentation probability for a peptide $p$ by an allele $a$ is $b_{p,a}$. Assuming independence across peptides, the probability that allele $a$ fails to present peptide $p$ is $(1 - b_{p,a})$. The probability that allele $a$ fails to present *any* peptide from $S$ is given by $q_a(S)$:\n$$\nq_{a}(S) = \\prod_{p \\in S} (1 - b_{p,a})\n$$\nNext, consider an individual with a diploid genotype $(a_i, a_j)$ at locus $\\ell$. The problem assumes that the two alleles contribute independently to presentation. Therefore, the probability that this entire genotype fails to present any peptide from $S$ is the product of the failure probabilities of each constituent allele:\n$$\nP(\\text{failure} \\mid \\text{genotype } (a_i, a_j)) = q_{a_i}(S) \\, q_{a_j}(S)\n$$\nTo find the population-averaged failure probability $Q_{\\ell}$, we sum the genotype-level failure probabilities over all possible genotypes, weighted by their HWE frequencies. This is an application of the law of total probability.\n$$\nQ_{\\ell} = \\sum_{a_i \\in \\mathcal{A}_{\\ell}} \\sum_{a_j \\in \\mathcal{A}_{\\ell}} P(\\text{genotype } (a_i, a_j)) \\cdot q_{a_i}(S) \\, q_{a_j}(S)\n$$\nBy partitioning the sum into homozygous ($i=j$) and heterozygous ($i \\neq j$) terms, we get:\n$$\nQ_{\\ell} = \\sum_{i} f_{a_i}^2 \\cdot q_{a_i}(S)^2 + \\sum_{i < j} 2 f_{a_i} f_{a_j} \\cdot q_{a_i}(S) \\, q_{a_j}(S)\n$$\nThis expression is the expansion of a squared sum:\n$$\nQ_{\\ell} = \\left( \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\, q_{a}(S) \\right)^2\n$$\nLet $\\bar{q}_{\\ell} = \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\, q_{a}(S)$ be the allele-frequency-weighted average of the per-allele failure probabilities at locus $\\ell$. Then, $Q_{\\ell} = (\\bar{q}_{\\ell})^2$. This elegant result implies that the probability of locus-level failure in a diploid organism under HWE is the square of the average haploid (single-allele) failure probability in the population.\n\nCombining these results, the final formula for overall population coverage is:\n$$\nC_{total} = 1 - \\prod_{\\ell \\in \\mathcal{L}} \\left( \\sum_{a \\in \\mathcal{A}_{\\ell}} f_{a} \\prod_{p \\in S} (1 - b_{p,a}) \\right)^2\n$$\nThe computational algorithm proceeds as follows for each test case:\n$1$. For each locus $\\ell$, compute the average per-allele failure probability $\\bar{q}_{\\ell}$.\n    a. For each allele $a \\in \\mathcal{A}_{\\ell}$, calculate its failure probability $q_{a}(S)$ by taking the product of $(1 - b_{p,a})$ over all peptides $p \\in S$. Any missing $b_{p,a}$ is treated as $0$.\n    b. Compute $\\bar{q}_{\\ell}$ by summing $f_{a} \\cdot q_{a}(S)$ over all alleles $a \\in \\mathcal{A}_{\\ell}$.\n$2$. For each locus $\\ell$, calculate the locus-level failure probability $Q_{\\ell} = (\\bar{q}_{\\ell})^2$.\n$3$. Compute the total failure probability $Q_{total}$ by multiplying all $Q_{\\ell}$ values.\n$4$. The final coverage is $C_{total} = 1 - Q_{total}$.\n$5$. The result is then rounded to $6$ decimal places as required.\nThis procedure is implemented for each of the provided test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the predicted population coverage for epitope-based vaccines\n    for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"peptides\": [\"p1\", \"p2\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A*01:01\": 0.3, \"A*02:01\": 0.5, \"A*03:01\": 0.2},\n                    \"bindings\": {\n                        \"p1\": {\"A*01:01\": 0.7, \"A*02:01\": 0.1, \"A*03:01\": 0.0},\n                        \"p2\": {\"A*01:01\": 0.2, \"A*02:01\": 0.6, \"A*03:01\": 0.1},\n                    },\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B*07:02\": 0.6, \"B*08:01\": 0.4},\n                    \"bindings\": {\n                        \"p1\": {\"B*07:02\": 0.3, \"B*08:01\": 0.8},\n                        \"p2\": {\"B*07:02\": 0.4, \"B*08:01\": 0.2},\n                    },\n                },\n            ],\n        },\n        {\n            \"peptides\": [\"p3\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A*01:01\": 1.0, \"A*02:01\": 0.0},\n                    \"bindings\": {\"p3\": {\"A*01:01\": 0.5, \"A*02:01\": 0.0}},\n                }\n            ],\n        },\n        {\n            \"peptides\": [\"p4\", \"p5\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A1\": 0.5, \"A2\": 0.5},\n                    \"bindings\": {\n                        \"p4\": {\"A1\": 0.0, \"A2\": 0.0},\n                        \"p5\": {\"A1\": 0.0, \"A2\": 0.0},\n                    },\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B1\": 1.0},\n                    \"bindings\": {\"p4\": {\"B1\": 0.9}, \"p5\": {\"B1\": 0.0}},\n                },\n            ],\n        },\n        {\n            \"peptides\": [\"p6\"],\n            \"loci\": [\n                {\n                    \"name\": \"A\",\n                    \"alleles\": {\"A1\": 0.01, \"A2\": 0.99},\n                    \"bindings\": {\"p6\": {\"A1\": 1.0, \"A2\": 0.0}},\n                },\n                {\n                    \"name\": \"B\",\n                    \"alleles\": {\"B1\": 0.5, \"B2\": 0.5},\n                    \"bindings\": {\"p6\": {\"B1\": 0.2}}, # Missing b_p6,B2 is treated as 0\n                },\n            ],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        locus_failure_probabilities = []\n        \n        for locus_data in case[\"loci\"]:\n            peptides = case[\"peptides\"]\n            alleles = locus_data[\"alleles\"]\n            bindings = locus_data.get(\"bindings\", {})\n\n            # Calculate the population-averaged per-allele failure probability, q_bar_l\n            avg_allele_failure_prob = 0.0\n            \n            for allele_name, allele_freq in alleles.items():\n                # Calculate the per-allele probability of non-presentation, q_a(S)\n                per_allele_failure_prob = 1.0\n                for peptide in peptides:\n                    binding_prob = bindings.get(peptide, {}).get(allele_name, 0.0)\n                    per_allele_failure_prob *= (1.0 - binding_prob)\n                \n                avg_allele_failure_prob += allele_freq * per_allele_failure_prob\n            \n            # The locus-level failure probability Q_l is (q_bar_l)^2\n            locus_failure_prob = avg_allele_failure_prob ** 2\n            locus_failure_probabilities.append(locus_failure_prob)\n            \n        # Total failure probability is the product of locus-level failure probabilities\n        total_failure_prob = np.prod(locus_failure_probabilities)\n        \n        # Overall coverage is 1 - total failure probability\n        coverage = 1.0 - total_failure_prob\n        results.append(coverage)\n        \n    # Format the output string as required\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2469070"}]}