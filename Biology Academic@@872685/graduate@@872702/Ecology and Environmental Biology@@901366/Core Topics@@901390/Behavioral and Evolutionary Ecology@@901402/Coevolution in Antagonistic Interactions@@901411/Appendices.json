{"hands_on_practices": [{"introduction": "The maintenance of genetic diversity is a central question in coevolution. This exercise explores the matching-alleles model, a classic framework demonstrating how negative frequency-dependent selection can maintain polymorphism in both host and parasite populations. By deriving the equilibrium allele frequencies from first principles, you will gain a hands-on understanding of the 'rare allele advantage' that drives these coevolutionary dynamics. [@problem_id:2476603]", "problem": "Consider a haploid host–parasite system with antagonistic coevolution governed by a matching-alleles interaction. The host has two alleles, denoted by $H_{A}$ and $H_{B}$, with population frequency $p$ for $H_{A}$ and $1-p$ for $H_{B}$. The parasite has two alleles, denoted by $P_{A}$ and $P_{B}$, with population frequency $q$ for $P_{A}$ and $1-q$ for $P_{B}$. Assume very large populations, discrete non-overlapping generations, random mixing, and no mutation or migration.\n\nUnder the matching-alleles architecture, parasite allele $P_{A}$ can infect only host allele $H_{A}$, and parasite allele $P_{B}$ can infect only host allele $H_{B}$. Let each successful infection reduce host fitness by a constant factor $s$ with $0  s  1$, and let each successful infection increase parasite reproductive success by a constant factor $b$ with $b  0$. Assume symmetric direct costs of maintaining the relevant interaction phenotypes: hosts pay a per-capita cost $c_{H} \\ge 0$ that is identical for $H_{A}$ and $H_{B}$, and parasites pay a per-capita cost $c_{P} \\ge 0$ that is identical for $P_{A}$ and $P_{B}$. There are no other fitness effects.\n\nUsing only (i) the definition of expected fitness as baseline fitness plus gains minus losses from interactions, (ii) the standard haploid selection recursion $x' = x W_{x} / \\bar{W}$ where $W_{x}$ is the marginal fitness of type $x$ and $\\bar{W}$ is the mean fitness, and (iii) the assumption that the probability of encounter is proportional to the frequency of the matching antagonist type, derive the internal equilibrium allele frequencies $p^{\\ast}$ and $q^{\\ast}$ at which both the host and the parasite are polymorphic. Express the final answer as a $1 \\times 2$ row matrix $(p^{\\ast}, q^{\\ast})$. Give an exact analytic expression; do not approximate or round.", "solution": "The problem presents a classical scenario of antagonistic coevolution within a haploid host-parasite system governed by a matching-alleles genetic interaction. Before proceeding to a solution, a validation of the problem statement is mandatory.\n\n**Problem Validation**\n\nStep 1: Extract Givens\n- System type: Haploid host-parasite.\n- Host alleles and frequencies: $H_{A}$ with frequency $p$, $H_{B}$ with frequency $1-p$.\n- Parasite alleles and frequencies: $P_{A}$ with frequency $q$, $P_{B}$ with frequency $1-q$.\n- Population assumptions: Very large size, discrete non-overlapping generations, random mixing, no mutation or migration.\n- Interaction rule: $P_{A}$ infects $H_{A}$; $P_{B}$ infects $H_{B}$.\n- Fitness consequences of infection: Host fitness is reduced by a factor $s$, where $0  s  1$. Parasite reproductive success increases by a factor $b$, where $b  0$.\n- Intrinsic costs: A symmetric, per-capita cost $c_{H} \\ge 0$ for all hosts, and a symmetric, per-capita cost $c_{P} \\ge 0$ for all parasites.\n- Required methodology: Use (i) fitness defined as baseline plus gains minus losses, (ii) the haploid selection recursion $x' = x W_{x} / \\bar{W}$, and (iii) encounter probability proportional to antagonist frequency.\n- Objective: Find the internal equilibrium allele frequencies ($p^{\\ast}$, $q^{\\ast}$).\n\nStep 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is based on the matching-alleles model, a fundamental concept in the theory of coevolutionary dynamics and frequency-dependent selection. All parameters and assumptions are standard in theoretical population genetics. The problem is scientifically sound.\n2.  **Well-Posed:** The problem is well-posed. It provides a complete set of rules and parameters necessary to construct the fitness functions and derive the equilibrium conditions. The objective is clear and unambiguous.\n3.  **Objective:** The language is formal and precise, devoid of subjectivity or ambiguity.\n\nThe problem exhibits no flaws from the validation checklist. The formulation is a standard and valid exercise in theoretical biology. The inclusion of symmetric, non-differential costs ($c_{H}$ and $c_{P}$) is a valid modeling choice, often used to test the understanding that such costs do not influence the internal equilibrium frequencies under negative frequency-dependent selection, even though they affect mean population fitness.\n\nStep 3: Verdict and Action\nThe problem is deemed **valid**. A full derivation of the solution will now be provided.\n\n**Derivation of Equilibrium Frequencies**\n\nWe are tasked with finding the internal equilibrium frequencies, $p^{\\ast}$ and $q^{\\ast}$, where $0  p^{\\ast}  1$ and $0  q^{\\ast}  1$. An internal equilibrium exists when the allele frequencies within each population cease to change from one generation to the next. For a haploid system, this occurs when the marginal fitnesses of all segregating alleles within a population are equal.\n\nFirst, we define the marginal fitness for each allele based on the provided rules. Let the baseline fitness for both host and parasite be $1$. Fitness is constructed as \"baseline fitness plus gains minus losses\".\n\n**Host Fitness ($W_{H}$)**\nThe fitness of a host allele is the baseline fitness ($1$) reduced by the symmetric cost $c_H$ and the expected fitness loss due to infection. The probability of infection for a given host type is the frequency of its matching parasite type.\n-   The marginal fitness of the host allele $H_{A}$ is:\n    $$W_{H_{A}} = 1 - c_{H} - s \\cdot q$$\n    Here, $q$ is the frequency of the matching parasite $P_{A}$, and $s$ is the fitness loss upon infection.\n-   The marginal fitness of the host allele $H_{B}$ is:\n    $$W_{H_{B}} = 1 - c_{H} - s \\cdot (1-q)$$\n    Here, $1-q$ is the frequency of the matching parasite $P_{B}$.\n\nFor a stable polymorphic equilibrium in the host population, the fitnesses of the two alleles must be equal: $W_{H_{A}} = W_{H_{B}}$.\n$$1 - c_{H} - s q^{\\ast} = 1 - c_{H} - s(1 - q^{\\ast})$$\nThe terms $1 - c_{H}$ cancel from both sides.\n$$-s q^{\\ast} = -s(1 - q^{\\ast})$$\nGiven that $s  0$, we can divide both sides by $-s$:\n$$q^{\\ast} = 1 - q^{\\ast}$$\n$$2q^{\\ast} = 1$$\n$$q^{\\ast} = \\frac{1}{2}$$\nThis is the parasite allele frequency required to maintain polymorphism in the host population.\n\n**Parasite Fitness ($W_{P}$)**\nThe fitness of a parasite allele is the baseline fitness ($1$) reduced by the symmetric cost $c_P$ and increased by the expected fitness gain from infection. The probability of a successful infection for a given parasite type is the frequency of its matching host type.\n-   The marginal fitness of the parasite allele $P_{A}$ is:\n    $$W_{P_{A}} = 1 - c_{P} + b \\cdot p$$\n    Here, $p$ is the frequency of the matching host $H_{A}$, and $b$ is the fitness gain upon infection.\n-   The marginal fitness of the parasite allele $P_{B}$ is:\n    $$W_{P_{B}} = 1 - c_{P} + b \\cdot (1-p)$$\n    Here, $1-p$ is the frequency of the matching host $H_{B}$.\n\nFor a stable polymorphic equilibrium in the parasite population, the fitnesses of the two alleles must be equal: $W_{P_{A}} = W_{P_{B}}$.\n$$1 - c_{P} + b p^{\\ast} = 1 - c_{P} + b(1 - p^{\\ast})$$\nThe terms $1 - c_{P}$ cancel from both sides.\n$$b p^{\\ast} = b(1 - p^{\\ast})$$\nGiven that $b  0$, we can divide both sides by $b$:\n$$p^{\\ast} = 1 - p^{\\ast}$$\n$$2p^{\\ast} = 1$$\n$$p^{\\ast} = \\frac{1}{2}$$\nThis is the host allele frequency required to maintain polymorphism in the parasite population.\n\nThe internal equilibrium point $(p^{\\ast}, q^{\\ast})$, where both populations maintain polymorphism, is therefore $(\\frac{1}{2}, \\frac{1}{2})$. The symmetric costs $c_{H}$ and $c_{P}$ do not influence the location of this equilibrium point, as they affect the fitness of both alleles within a species equally and thus do not generate differential selection. This dynamic, where the fitness of an allele is inversely proportional to its frequency (negative frequency-dependent selection), robustly drives the system to this central equilibrium point.\nThe final answer is to be expressed as a $1 \\times 2$ row matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2}  \\frac{1}{2}\n\\end{pmatrix}\n}\n$$", "id": "2476603"}, {"introduction": "Why aren't all parasites maximally harmful or completely benign? This question is at the heart of virulence evolution, which is often governed by trade-offs between transmission rate and parasite-induced host mortality. In this problem, you will apply optimization principles to a well-established epidemiological model to derive the evolutionarily stable level of virulence ($ \\alpha^{\\ast} $), providing insight into how natural selection shapes parasite strategies. [@problem_id:2476623]", "problem": "Consider an antagonistic host–parasite interaction in a well-mixed population where a rare mutant parasite strain with virulence (additional host mortality) $ \\alpha $ attempts to invade a resident population at ecological quasi-equilibrium. Assume a susceptible–infected–susceptible (SIS) infection process with constant susceptible host density $ S $ over the invasion timescale of the mutant. Let the baseline host recovery rate be $ \\gamma  0 $, and suppose the parasite’s transmission rate $ \\beta(\\alpha) $ increases with virulence due to a saturating trade-off given by\n$$\n\\beta(\\alpha) \\;=\\; \\beta_{\\max} \\,\\frac{\\alpha}{\\alpha + k},\n$$\nwhere $ \\beta_{\\max}  0 $ is the maximal transmission rate and $ k  0 $ sets the curvature of the trade-off. The invasion fitness of a rare mutant is determined by its basic reproduction number $ R_{0}(\\alpha) $, defined in the SIS framework as\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta(\\alpha)\\, S}{\\gamma + \\alpha},\n$$\nwhich is the expected number of secondary infections caused by a single newly infected host in an otherwise susceptible population.\n\nUnder the standard assumption that, for rare mutants in such systems, evolutionary dynamics favor strategies that locally maximize $ R_{0}(\\alpha) $, derive from first principles the evolutionarily stable strategy (ESS) virulence $ \\alpha^{*} $ that maximizes $ R_{0}(\\alpha) $ for $ \\alpha  0 $. Assume $ S  0 $, $ \\beta_{\\max}  0 $, $ \\gamma  0 $, and $ k  0 $. Provide the closed-form expression for $ \\alpha^{*} $ in terms of parameters, and do not perform any numerical substitutions. Your final answer must be a single analytic expression. No rounding is required and no units are needed.", "solution": "We start from the ecological and epidemiological foundations of the susceptible–infected–susceptible (SIS) model. When a rare mutant parasite strain with virulence $ \\alpha $ appears in a resident population where the density of susceptible hosts is effectively constant at $ S $ over the short invasion timescale, the mutant’s number of infections $ I_{m} $ evolves according to\n$$\n\\frac{d I_{m}}{dt} \\;\\approx\\; \\left[\\beta(\\alpha)\\, S \\;-\\; (\\gamma + \\alpha)\\right] I_{m}.\n$$\nInvasion requires the per capita growth rate of the mutant to be positive, equivalently $ \\beta(\\alpha) S - (\\gamma + \\alpha)  0 $, which is summarized by the basic reproduction number (first principles definition for SIS),\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta(\\alpha)\\, S}{\\gamma + \\alpha}.\n$$\nUnder the assumption of rare-mutation, small-effect adaptive dynamics, an evolutionarily stable strategy (ESS) corresponds to a local maximizer of the invasion fitness proxy $ R_{0}(\\alpha) $ with respect to the trait $ \\alpha $, provided standard regularity conditions hold.\n\nWe are given the saturating trade-off\n$$\n\\beta(\\alpha) \\;=\\; \\beta_{\\max}\\,\\frac{\\alpha}{\\alpha + k},\n$$\nwith $ \\beta_{\\max}  0 $ and $ k  0 $. Substituting into $ R_{0}(\\alpha) $ yields\n$$\nR_{0}(\\alpha) \\;=\\; \\frac{\\beta_{\\max}\\,\\frac{\\alpha}{\\alpha + k}\\, S}{\\gamma + \\alpha}\n\\;=\\; \\beta_{\\max} S \\,\\frac{\\alpha}{(\\alpha + k)(\\gamma + \\alpha)}.\n$$\nBecause $ \\beta_{\\max} S  0 $ is a positive multiplicative constant, maximizing $ R_{0}(\\alpha) $ over $ \\alpha  0 $ is equivalent to maximizing\n$$\nf(\\alpha) \\;=\\; \\frac{\\alpha}{(\\alpha + k)(\\alpha + \\gamma)}\n\\;=\\; \\frac{\\alpha}{\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma}.\n$$\nWe now differentiate $ f(\\alpha) $ with respect to $ \\alpha $ and set the derivative to zero to find critical points. Using the quotient rule with\n$$\ng(\\alpha) \\;=\\; \\alpha,\\qquad h(\\alpha) \\;=\\; (\\alpha + k)(\\alpha + \\gamma) \\;=\\; \\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma,\n$$\nwe have $ g'(\\alpha) = 1 $ and $ h'(\\alpha) = 2\\alpha + (k + \\gamma) $. Then\n$$\nf'(\\alpha) \\;=\\; \\frac{g'(\\alpha)\\,h(\\alpha) - g(\\alpha)\\,h'(\\alpha)}{[h(\\alpha)]^{2}}\n\\;=\\; \\frac{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right] - \\alpha\\left[2\\alpha + (k + \\gamma)\\right]}{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right]^{2}}.\n$$\nSimplifying the numerator,\n$$\n\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right] - \\left[2\\alpha^{2} + \\alpha(k + \\gamma)\\right]\n\\;=\\; -\\alpha^{2} + k\\gamma.\n$$\nTherefore,\n$$\nf'(\\alpha) \\;=\\; \\frac{k\\gamma - \\alpha^{2}}{\\left[\\alpha^{2} + \\alpha(k + \\gamma) + k\\gamma\\right]^{2}}.\n$$\nCritical points satisfy $ f'(\\alpha) = 0 $, which reduces to\n$$\nk\\gamma - \\alpha^{2} \\;=\\; 0 \\quad\\Longrightarrow\\quad \\alpha^{2} \\;=\\; k\\gamma.\n$$\nBecause $ \\alpha  0 $ by definition of virulence and $ k  0 $, $ \\gamma  0 $, the unique biologically relevant critical point is\n$$\n\\alpha^{*} \\;=\\; \\sqrt{k\\gamma}.\n$$\nTo verify that this critical point is a strict local maximizer, note that the denominator of $ f'(\\alpha) $ is strictly positive for all $ \\alpha  0 $, while the sign of $ f'(\\alpha) $ is determined by $ k\\gamma - \\alpha^{2} $. Hence $ f'(\\alpha)  0 $ for $ 0  \\alpha  \\sqrt{k\\gamma} $ and $ f'(\\alpha)  0 $ for $ \\alpha  \\sqrt{k\\gamma} $, demonstrating that $ \\alpha^{*} $ is the unique global maximizer on $ (0,\\infty) $. Equivalently, one can observe the boundary behavior $ \\lim_{\\alpha \\to 0^{+}} f(\\alpha) = 0 $ and $ \\lim_{\\alpha \\to \\infty} f(\\alpha) = 0 $, with a single interior critical point, confirming a unimodal peak at $ \\alpha^{*} $.\n\nFinally, because $ \\beta_{\\max} $ and $ S $ factor out multiplicatively, they do not influence the location of the maximizing $ \\alpha^{*} $. Therefore, the evolutionarily stable virulence that maximizes the basic reproduction number is\n$$\n\\alpha^{*} \\;=\\; \\sqrt{k\\gamma}.\n$$", "answer": "$$\\boxed{\\sqrt{k\\gamma}}$$", "id": "2476623"}, {"introduction": "Coevolutionary dynamics are often not static but represent a continuous arms race, famously described by the Red Queen hypothesis. This hands-on computational exercise requires you to build and simulate a gene-for-gene model to observe these dynamics directly. By implementing a 'time-shift' analysis, you will learn how to quantify a key signature of Red Queen coevolution: the advantage parasites have when infecting hosts from the recent past. [@problem_id:2476589]", "problem": "Construct a minimal, discrete-time, frequency-based, two-species, two-locus antagonistic coevolution model under the following assumptions and derive from first principles all required dynamical equations. One locus resides in the host (resistance) and one in the parasite (infectivity), each haploid with two alleles. Hosts carry alleles $R$ (resistance) or $r$ (susceptible). Parasites carry alleles $V$ (infectivity) or $v$ (avirulence). Infection follows a gene-for-gene rule: $V$ infects both $R$ and $r$, while $v$ infects only $r$. Resistance in hosts carries a fecundity cost $c_H \\in [0,1)$, infectivity in parasites carries a cost $c_P \\in [0,1)$, and successful infection reduces host fecundity by $s \\in (0,1)$. Assume panmixia, infinite population sizes, and non-overlapping generations. Let time be generation-indexed $t \\in \\{0,1,2,\\dots\\}$.\n\nStarting solely from the principles that (i) expected genotype fitness equals baseline fecundity minus any realized costs from resistance or infection, (ii) infection success follows the above infection matrix, and (iii) allele frequencies update according to standard proportional selection $p'(t)=\\dfrac{p(t) w(p(t))}{\\overline{w}(t)}$, derive a deterministic recursion for the allele frequencies of resistance in the host and infectivity in the parasite, denoted $p_H(t)$ and $p_P(t)$ respectively.\n\nDefine host genotype fitnesses at time $t$ as follows. The susceptible host allele $r$ is always fully infectable, so its expected fitness is $w_r(t)=1-s$. The resistant host allele $R$ suffers the resistance cost $c_H$ and is infectable only by $V$, so its expected fitness is $w_R(t)=1-c_H-s\\,p_P(t)$. Define parasite genotype fitnesses from the fraction of the host population each can infect, modulated by the cost of infectivity. Set the baseline parasite reproductive factor to unity without loss of generality. Then $w_V(t)=1-c_P$, because $V$ infects all hosts, and $w_v(t)=1-p_H(t)$, because $v$ infects only the fraction of hosts that are $r$.\n\nUsing these definitions, the allele frequency recursions must be derived as\n$$\np_H(t+1)=\\frac{p_H(t)\\,w_R(t)}{p_H(t)\\,w_R(t)+\\big(1-p_H(t)\\big)w_r(t)},\\qquad\np_P(t+1)=\\frac{p_P(t)\\,w_V(t)}{p_P(t)\\,w_V(t)+\\big(1-p_P(t)\\big)w_v(t)}.\n$$\nNo other model components may be introduced.\n\nDefine a time-shift cross-infection assay as follows. At a focal time $t$, take the contemporary parasite population characterized by $p_P(t)$ and assay it against the host populations from time $t+\\Delta$, where $\\Delta$ can be negative (past), zero (present), or positive (future). The expected fraction of hosts successfully infected in this assay is\n$$\nE(t,\\Delta) \\equiv p_P(t)\\cdot 1 + \\big(1-p_P(t)\\big)\\cdot\\big(1-p_H(t+\\Delta)\\big)\n=1-\\big(1-p_P(t)\\big)\\,p_H(t+\\Delta).\n$$\nDefine the symmetric time-shift advantage at $t$ over lag $k\\in \\mathbb{N}$ as\n$$\nM_k(t) \\equiv E(t,-k)-E(t,+k).\n$$\nA positive value of $M_k(t)$ indicates that parasites taken at time $t$ infect past hosts better than future hosts over a symmetric time window of $k$ generations, which is a standard signature of parasite time-shift advantage.\n\nYour program must:\n- Implement the above dynamical system exactly as specified, starting from initial allele frequencies $p_H(0)$ and $p_P(0)$ within $[0,1]$.\n- Simulate for $T$ generations to produce trajectories $\\{p_H(t)\\}_{t=0}^{T}$ and $\\{p_P(t)\\}_{t=0}^{T}$.\n- For a given symmetric lag $k$ and a burn-in $B$ to remove initial transients, evaluate $M_k(t)$ for all integer $t$ with $t-k\\ge 0$, $t+k\\le T$, and $t\\ge B$, and return the maximum time-shift advantage\n$$\nM_k^{\\max} \\equiv \\max_{t \\in \\{B,\\dots,T\\}} \\left\\{ M_k(t) \\ \\text{with} \\ t-k\\ge 0,\\ t+k\\le T \\right\\}.\n$$\n- Output this single scalar $M_k^{\\max}$ for each parameter set in the test suite below, as a float rounded to six decimal places.\n\nTest suite. Use the following three parameter sets to test different regimes:\n- Case $1$ (frequency-dependent coevolution with costs; expected emergence of a positive time-shift advantage): $s=0.45$, $c_H=0.10$, $c_P=0.25$, $p_H(0)=0.50$, $p_P(0)=0.50$, $T=800$, $B=200$, $k=15$.\n- Case $2$ (boundary with no costs; expected vanishing time-shift advantage): $s=0.45$, $c_H=0.00$, $c_P=0.00$, $p_H(0)=0.50$, $p_P(0)=0.50$, $T=800$, $B=200$, $k=15$.\n- Case $3$ (high host resistance cost, resistance purged; expected vanishing time-shift advantage): $s=0.45$, $c_H=0.40$, $c_P=0.05$, $p_H(0)=0.50$, $p_P(0)=0.50$, $T=800$, $B=200$, $k=15$.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of Cases $1$ through $3$, for example, $\"[x_1,x_2,x_3]\"$, where each $x_i$ is $M_k^{\\max}$ for the corresponding case rounded to six decimal places. No other text should be printed. Angles and physical units do not apply; all quantities are dimensionless. You must not read any input. The program must be complete and runnable as is.", "solution": "The problem statement is scientifically sound, self-contained, and well-posed. It describes a canonical gene-for-gene model of host-parasite coevolution, a fundamental topic in theoretical ecology. All parameters, equations, and objectives are specified with sufficient clarity to permit a unique solution. We proceed with the derivation and solution.\n\nThe core of the problem is to derive the dynamical equations for allele frequencies under selection. We begin from first principles.\n\nLet $p_H(t)$ be the frequency of the resistance allele $R$ in the host population at generation $t$, and $p_P(t)$ be the frequency of the infectivity allele $V$ in the parasite population at generation $t$. The frequencies of the alternative alleles, susceptible $r$ and avirulent $v$, are accordingly $1-p_H(t)$ and $1-p_P(t)$. The populations are assumed to be haploid, panmictic, and of infinite size, with non-overlapping generations.\n\nAllele frequencies change over time due to selection, where the fitness of an allele determines its proportional representation in the subsequent generation. The standard equation for proportional selection in a discrete-time haploid model is:\n$$\np'(t) = \\frac{p(t) w(p(t))}{\\overline{w}(t)}\n$$\nwhere $p(t)$ is the allele frequency at time $t$, $p'(t)$ is the frequency at time $t+1$, $w(p(t))$ is the fitness of the allele, and $\\overline{w}(t)$ is the mean fitness of the population.\n\nWe must first define the fitness of each allele based on the provided biological interactions and costs. Fitness is expressed as a relative fecundity, with a baseline of $1$.\n\n**Host Fitness:**\nThe fitness of a host allele is its baseline fecundity ($1$) minus any realized costs.\n1.  **Susceptible allele ($r$)**: An individual with the $r$ allele is susceptible to infection by both parasite types, $V$ and $v$. The total frequency of parasites is $p_P(t) + (1-p_P(t)) = 1$. Thus, an $r$ host is always infected and suffers a fecundity loss of $s$. There is no cost of resistance. Its fitness is constant:\n    $$\n    w_r(t) = 1 - s\n    $$\n2.  **Resistant allele ($R$)**: An individual with the $R$ allele is resistant to the $v$ parasite but can be infected by the $V$ parasite. The probability of encountering a $V$ parasite is $p_P(t)$. This host also bears a constitutive cost of resistance, $c_H$. Its fitness is reduced by $c_H$ always, and by $s$ only when infected by a $V$ parasite:\n    $$\n    w_R(t) = 1 - c_H - s \\cdot p_P(t)\n    $$\n\nThe mean fitness of the host population, $\\overline{w}_H(t)$, is the weighted average of the allele fitnesses:\n$$\n\\overline{w}_H(t) = p_H(t) w_R(t) + (1-p_H(t)) w_r(t)\n$$\n\nUsing the proportional selection formula, the frequency of the $R$ allele in the next generation, $p_H(t+1)$, is:\n$$\np_H(t+1) = \\frac{p_H(t) w_R(t)}{\\overline{w}_H(t)} = \\frac{p_H(t) [1 - c_H - s \\cdot p_P(t)]}{p_H(t) [1 - c_H - s \\cdot p_P(t)] + (1-p_H(t)) [1 - s]}\n$$\n\n**Parasite Fitness:**\nThe fitness of a parasite allele is proportional to the fraction of the host population it can successfully infect, modulated by any cost of infectivity. The baseline reproductive factor is taken as $1$.\n1.  **Infectivity allele ($V$)**: The $V$ parasite can infect both $R$ and $r$ hosts, which constitute the entire host population (fraction $1$). It bears a cost of infectivity, $c_P$. Its fitness is:\n    $$\n    w_V(t) = 1 - c_P\n    $$\n2.  **Avirulence allele ($v$)**: The $v$ parasite can only infect susceptible $r$ hosts, which occur at frequency $1-p_H(t)$. It bears no cost. Its fitness is proportional to the fraction of available hosts:\n    $$\n    w_v(t) = 1 - p_H(t)\n    $$\n\nThe mean fitness of the parasite population, $\\overline{w}_P(t)$, is the weighted average of its allele fitnesses:\n$$\n\\overline{w}_P(t) = p_P(t) w_V(t) + (1-p_P(t)) w_v(t)\n$$\n\nThe frequency of the $V$ allele in the next generation, $p_P(t+1)$, is:\n$$\np_P(t+1) = \\frac{p_P(t) w_V(t)}{\\overline{w}_P(t)} = \\frac{p_P(t) [1 - c_P]}{p_P(t) [1 - c_P] + (1-p_P(t)) [1 - p_H(t)]}\n$$\nThese derived recursions match those specified in the problem statement.\n\n**Analysis of Time-Shift Advantage:**\nTo quantify coevolutionary dynamics, we use a time-shift cross-infection assay. The expected fraction of hosts infected, $E(t, \\Delta)$, when parasites from time $t$ are assayed against hosts from time $t+\\Delta$, is calculated. A parasite with allele $V$ (frequency $p_P(t)$) infects all hosts (fraction $1$). A parasite with allele $v$ (frequency $1-p_P(t)$) infects only $r$ hosts (fraction $1-p_H(t+\\Delta)$).\n$$\nE(t, \\Delta) = p_P(t) \\cdot 1 + (1-p_P(t)) \\cdot (1-p_H(t+\\Delta)) = 1 - (1-p_P(t)) p_H(t+\\Delta)\n$$\nThe symmetric time-shift advantage at time $t$ for a lag $k$ is defined as the difference in infection success on past hosts ($t-k$) versus future hosts ($t+k$):\n$$\nM_k(t) = E(t, -k) - E(t, +k)\n$$\nSubstituting the expression for $E(t,\\Delta)$:\n$$\nM_k(t) = [1 - (1-p_P(t)) p_H(t-k)] - [1 - (1-p_P(t)) p_H(t+k)]\n$$\nThis expression simplifies to:\n$$\nM_k(t) = (1 - p_P(t)) [p_H(t+k) - p_H(t-k)]\n$$\nA positive $M_k(t)$ indicates that parasites are better adapted to past hosts than to future hosts, a signature of \"Red Queen\" chase dynamics.\n\nThe final task is to calculate the maximum time-shift advantage, $M_k^{\\max}$, over a specified post-transient time window. The algorithm is as follows:\n1.  Initialize allele frequency arrays $p_H$ and $p_P$ of size $T+1$ with the initial conditions $p_H(0)$ and $p_P(0)$.\n2.  Iterate from $t=0$ to $t=T-1$, calculating $p_H(t+1)$ and $p_P(t+1)$ using the derived recursion relations. Store these values.\n3.  After generating the full trajectories, compute $M_k(t)$ for each $t$ in the valid range. The range for $t$ is specified by $t \\in \\{B, \\dots, T\\}$, $t-k \\ge 0$, and $t+k \\le T$. This corresponds to the integer interval $[\\max(B, k), T-k]$.\n4.  The maximum value of $M_k(t)$ over this interval is the desired result, $M_k^{\\max}$.\n\nThis procedure is implemented for each of the three test cases provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(s, c_H, c_P, p_H0, p_P0, T, B, k):\n    \"\"\"\n    Simulates the coevolutionary dynamics and calculates the maximum time-shift advantage.\n\n    Args:\n        s (float): Cost of infection for the host.\n        c_H (float): Cost of resistance for the host.\n        c_P (float): Cost of infectivity for the parasite.\n        p_H0 (float): Initial frequency of host resistance allele R.\n        p_P0 (float): Initial frequency of parasite infectivity allele V.\n        T (int): Total number of generations to simulate.\n        B (int): Burn-in period to exclude from analysis.\n        k (int): Time lag for the cross-infection assay.\n\n    Returns:\n        float: The maximum time-shift advantage, M_k^max.\n    \"\"\"\n    p_H_traj = np.zeros(T + 1)\n    p_P_traj = np.zeros(T + 1)\n\n    p_H_traj[0] = p_H0\n    p_P_traj[0] = p_P0\n\n    for t in range(T):\n        p_H_t = p_H_traj[t]\n        p_P_t = p_P_traj[t]\n\n        # Fitness calculations based on the derived equations\n        # Host fitnesses\n        w_R = 1.0 - c_H - s * p_P_t\n        w_r = 1.0 - s\n        \n        # Parasite fitnesses\n        w_V = 1.0 - c_P\n        w_v = 1.0 - p_H_t\n\n        # Calculate mean fitness for the host population\n        mean_w_H = p_H_t * w_R + (1.0 - p_H_t) * w_r\n        \n        # Calculate mean fitness for the parasite population\n        mean_w_P = p_P_t * w_V + (1.0 - p_P_t) * w_v\n\n        # Update host allele frequency\n        if mean_w_H > 0:\n            p_H_traj[t + 1] = (p_H_t * w_R) / mean_w_H\n        else:\n            # This case should not be reached with the given constraints\n            p_H_traj[t + 1] = p_H_t\n\n        # Update parasite allele frequency\n        if mean_w_P > 0:\n            p_P_traj[t + 1] = (p_P_t * w_V) / mean_w_P\n        else:\n            # This case should not be reached\n            p_P_traj[t + 1] = p_P_t\n            \n        # Clamp frequencies to [0, 1] to handle potential floating point inaccuracies\n        p_H_traj[t + 1] = np.clip(p_H_traj[t + 1], 0.0, 1.0)\n        p_P_traj[t + 1] = np.clip(p_P_traj[t + 1], 0.0, 1.0)\n\n\n    # Calculate the maximum time-shift advantage M_k^max\n    m_k_values = []\n    \n    # The valid time range for t is [max(B, k), T-k]\n    # Given B=200, k=15, T=800, the range is [200, 785]\n    start_t = max(B, k)\n    end_t = T - k\n\n    if start_t > end_t:\n        return 0.0\n\n    for t in range(start_t, end_t + 1):\n        # M_k(t) = (1 - p_P(t)) * (p_H(t+k) - p_H(t-k))\n        p_P_present = p_P_traj[t]\n        p_H_future = p_H_traj[t + k]\n        p_H_past = p_H_traj[t - k]\n        \n        m_k = (1.0 - p_P_present) * (p_H_future - p_H_past)\n        m_k_values.append(m_k)\n\n    if not m_k_values:\n        return 0.0\n        \n    m_k_max = np.max(m_k_values)\n    return m_k_max\n\ndef solve():\n    \"\"\"\n    Runs the simulation for all test cases and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: (s, c_H, c_P, p_H0, p_P0, T, B, k)\n        (0.45, 0.10, 0.25, 0.50, 0.50, 800, 200, 15),\n        # Case 2: No costs\n        (0.45, 0.00, 0.00, 0.50, 0.50, 800, 200, 15),\n        # Case 3: High host resistance cost\n        (0.45, 0.40, 0.05, 0.50, 0.50, 800, 200, 15),\n    ]\n\n    results = []\n    for case in test_cases:\n        s, c_H, c_P, p_H0, p_P0, T, B, k = case\n        m_k_max = run_simulation(s, c_H, c_P, p_H0, p_P0, T, B, k)\n        results.append(f\"{m_k_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2476589"}]}