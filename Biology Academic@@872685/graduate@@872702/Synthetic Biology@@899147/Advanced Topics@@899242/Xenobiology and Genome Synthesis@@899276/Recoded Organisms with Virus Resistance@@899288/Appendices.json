{"hands_on_practices": [{"introduction": "Before embarking on a large-scale genome recoding project, it is crucial to quantify the scope of the endeavor and its potential side effects. This practice provides a foundational exercise in calculating the total number of codon replacements required and predicting the resulting shift in the genome's overall GC content based on codon usage frequencies. Mastering these calculations is a critical first step in evaluating the feasibility and global impact of a proposed recoding strategy. [@problem_id:2768341]", "problem": "A central design in constructing recoded organisms with virus resistance is to eliminate a specified subset of codons from the genome while preserving the encoded proteins. This leverages redundancy in the genetic code: multiple codons can encode the same amino acid or a translation termination signal. Consider a coding genome with a total of $N_{\\mathrm{tot}}$ codons and codon frequencies $f_i$ (fraction of all codons that are codon $i$). Suppose the recoding objective is to eliminate the set $S=\\{\\text{TCG},\\ \\text{TCA},\\ \\text{TAG}\\}$ across all genes by replacing each codon in $S$ with a synonymous alternative according to the mapping $\\text{TCG}\\rightarrow\\text{AGC}$, $\\text{TCA}\\rightarrow\\text{AGT}$, and $\\text{TAG}\\rightarrow\\text{TAA}$. Assume that these replacements preserve amino acid sequence and translation termination, as guaranteed by the standard genetic code.\n\nWork from first principles using the Central Dogma of molecular biology (Deoxyribonucleic Acid (DNA) to Ribonucleic Acid (RNA) to protein), the definition of codon usage frequency, and the definition of guanine-cytosine (GC) content. The GC content of a DNA sequence is the fraction of nucleotides that are either guanine (G) or cytosine (C). Each codon contributes three nucleotides to the coding DNA length and a corresponding number of G or C nucleotides to the GC count.\n\nYou are given:\n- The total number of codons in the coding genome is $N_{\\mathrm{tot}}=1.2\\times 10^{6}$.\n- The codon frequencies for the codons to be eliminated are $f_{\\mathrm{TCG}}=\\frac{1}{20}$, $f_{\\mathrm{TCA}}=\\frac{1}{30}$, and $f_{\\mathrm{TAG}}=\\frac{1}{600}$. The remaining codons collectively have frequency $1-f_{\\mathrm{TCG}}-f_{\\mathrm{TCA}}-f_{\\mathrm{TAG}}$ and are left unchanged by the recoding.\n- Use only the fact that the GC contribution of a codon is the count of its G and C nucleotides. For example, the GC contributions are: $\\text{TCG}\\mapsto 2$, $\\text{AGC}\\mapsto 2$, $\\text{TCA}\\mapsto 1$, $\\text{AGT}\\mapsto 1$, $\\text{TAG}\\mapsto 1$, $\\text{TAA}\\mapsto 0$.\n\nTasks:\n1. Derive from definitions an expression for the total number of required synonymous replacements to eliminate $S$ in terms of $N_{\\mathrm{tot}}$ and $f_i$, and then evaluate it numerically.\n2. Define the fractional GC content change of the coding genome as $f_{\\mathrm{GC}}^{\\mathrm{after}}-f_{\\mathrm{GC}}^{\\mathrm{before}}$, where $f_{\\mathrm{GC}}$ is the GC fraction of all coding nucleotides. Derive a general expression for this change induced by the specified replacements, and then evaluate it numerically for the given data. Express the GC change as a fraction (not a percentage), and give exact values (no rounding).\n\nReport your final answer as a two-component row vector $\\begin{pmatrix}\\text{total replacements}  \\text{GC fraction change}\\end{pmatrix}$.", "solution": "The problem as stated is scientifically grounded, internally consistent, and well-posed. All necessary data and definitions are provided for a unique solution. We will proceed with the derivation as requested.\n\nThe analysis is divided into two parts, corresponding to the two tasks presented in the problem.\n\n**Part 1: Total Number of Synonymous Replacements**\n\nThe problem requires the elimination of all codons belonging to the set $S=\\{\\text{TCG}, \\text{TCA}, \\text{TAG}\\}$. The total number of replacements, which we denote as $N_{\\mathrm{repl}}$, is the sum of the occurrences of each of these three codons in the entire coding genome.\n\nFrom first principles, the frequency of a given codon $i$, denoted $f_i$, is defined as the ratio of the number of occurrences of that codon, $N_i$, to the total number of codons in the genome, $N_{\\mathrm{tot}}$.\n$$f_i = \\frac{N_i}{N_{\\mathrm{tot}}}$$\nTherefore, the number of occurrences of codon $i$ can be expressed as:\n$$N_i = f_i N_{\\mathrm{tot}}$$\nThe total number of replacements is the sum of the counts of each codon in the set $S$:\n$$N_{\\mathrm{repl}} = N_{\\mathrm{TCG}} + N_{\\mathrm{TCA}} + N_{\\mathrm{TAG}}$$\nSubstituting the expression for $N_i$ for each codon, we derive the general expression for the total number of replacements:\n$$N_{\\mathrm{repl}} = (f_{\\mathrm{TCG}} + f_{\\mathrm{TCA}} + f_{\\mathrm{TAG}}) N_{\\mathrm{tot}}$$\nWe are given the following values:\n- Total number of codons: $N_{\\mathrm{tot}} = 1.2 \\times 10^{6}$\n- Codon frequencies: $f_{\\mathrm{TCG}} = \\frac{1}{20}$, $f_{\\mathrm{TCA}} = \\frac{1}{30}$, and $f_{\\mathrm{TAG}} = \\frac{1}{600}$.\n\nFirst, we compute the sum of the frequencies of the codons to be eliminated:\n$$\\sum_{i \\in S} f_i = f_{\\mathrm{TCG}} + f_{\\mathrm{TCA}} + f_{\\mathrm{TAG}} = \\frac{1}{20} + \\frac{1}{30} + \\frac{1}{600}$$\nTo sum these fractions, we find a common denominator, which is $600$:\n$$\\sum_{i \\in S} f_i = \\frac{30}{600} + \\frac{20}{600} + \\frac{1}{600} = \\frac{30+20+1}{600} = \\frac{51}{600}$$\nNow, we calculate the total number of replacements:\n$$N_{\\mathrm{repl}} = \\left(\\frac{51}{600}\\right) \\times (1.2 \\times 10^{6}) = \\frac{51}{6 \\times 10^{2}} \\times (12 \\times 10^{5}) = 51 \\times \\left(\\frac{12}{6}\\right) \\times 10^{5-2} = 51 \\times 2 \\times 10^{3} = 102 \\times 10^{3} = 102000$$\nExpressing this in standard scientific notation as required:\n$$N_{\\mathrm{repl}} = 1.02 \\times 10^{5}$$\n\n**Part 2: Fractional Guanine-Cytosine (GC) Content Change**\n\nThe fractional GC content, $f_{\\mathrm{GC}}$, is defined as the total number of guanine (G) or cytosine (C) nucleotides divided by the total number of nucleotides in the sequence.\n\nA coding genome with $N_{\\mathrm{tot}}$ codons has a total of $3N_{\\mathrm{tot}}$ nucleotides, as each codon consists of $3$ nucleotides. The total count of G and C nucleotides, $N_{\\mathrm{GC}}$, is the sum of the GC contributions from each codon across the genome. Let $\\text{GC}_i$ be the number of G or C nucleotides in codon $i$. The total GC count is:\n$$N_{\\mathrm{GC}} = \\sum_{i} N_i \\times \\text{GC}_i = \\sum_{i} (f_i N_{\\mathrm{tot}}) \\times \\text{GC}_i = N_{\\mathrm{tot}} \\sum_{i} f_i \\text{GC}_i$$\nThe fractional GC content is then:\n$$f_{\\mathrm{GC}} = \\frac{N_{\\mathrm{GC}}}{3N_{\\mathrm{tot}}} = \\frac{N_{\\mathrm{tot}} \\sum_{i} f_i \\text{GC}_i}{3N_{\\mathrm{tot}}} = \\frac{1}{3} \\sum_{i} f_i \\text{GC}_i$$\nThe change in fractional GC content, $\\Delta f_{\\mathrm{GC}}$, is the difference between the content after recoding, $f_{\\mathrm{GC}}^{\\mathrm{after}}$, and before recoding, $f_{\\mathrm{GC}}^{\\mathrm{before}}$.\n$$\\Delta f_{\\mathrm{GC}} = f_{\\mathrm{GC}}^{\\mathrm{after}} - f_{\\mathrm{GC}}^{\\mathrm{before}} = \\frac{1}{3} \\sum_{i} f_i^{\\mathrm{after}} \\text{GC}_i - \\frac{1}{3} \\sum_{i} f_i^{\\mathrm{before}} \\text{GC}_i = \\frac{1}{3} \\sum_{i} (f_i^{\\mathrm{after}} - f_i^{\\mathrm{before}}) \\text{GC}_i$$\nThe recoding process only changes the frequencies of the codons in the set $S$ and their synonymous replacements. Let $i \\in S$ be a codon that is replaced by a synonymous codon $\\text{syn}(i)$. The frequency of codon $i$ becomes zero ($f_i^{\\mathrm{after}} = 0$), and its original frequency ($f_i^{\\mathrm{before}}$) is added to the frequency of its replacement codon $\\text{syn}(i)$. For any codon $j$ not involved in a replacement, $f_j^{\\mathrm{after}} = f_j^{\\mathrm{before}}$.\n\nThe sum can be simplified by considering only codons whose frequencies change:\n$$3\\Delta f_{\\mathrm{GC}} = \\sum_{i \\in S} \\left[ (f_i^{\\mathrm{after}} - f_i^{\\mathrm{before}})\\text{GC}_i + (f_{\\text{syn}(i)}^{\\mathrm{after}} - f_{\\text{syn}(i)}^{\\mathrm{before}})\\text{GC}_{\\text{syn}(i)} \\right]$$\nFor each $i \\in S$, we have:\n- $f_i^{\\mathrm{after}} = 0 \\implies f_i^{\\mathrm{after}} - f_i^{\\mathrm{before}} = -f_i^{\\mathrm{before}}$\n- $f_{\\text{syn}(i)}^{\\mathrm{after}} = f_{\\text{syn}(i)}^{\\mathrm{before}} + f_i^{\\mathrm{before}} \\implies f_{\\text{syn}(i)}^{\\mathrm{after}} - f_{\\text{syn}(i)}^{\\mathrm{before}} = f_i^{\\mathrm{before}}$\nSubstituting these into the equation for a single replacement pair $(i, \\text{syn}(i))$:\n$$(-f_i^{\\mathrm{before}})\\text{GC}_i + (f_i^{\\mathrm{before}})\\text{GC}_{\\text{syn}(i)} = f_i^{\\mathrm{before}} (\\text{GC}_{\\text{syn}(i)} - \\text{GC}_i)$$\nSumming over all replacement rules gives the general expression for the total change:\n$$\\Delta f_{\\mathrm{GC}} = \\frac{1}{3} \\sum_{i \\in S} f_i^{\\mathrm{before}} (\\text{GC}_{\\text{syn}(i)} - \\text{GC}_i)$$\nWe now use the given data:\n- Replacement 1: $\\text{TCG} \\rightarrow \\text{AGC}$\n  - $f_{\\mathrm{TCG}} = \\frac{1}{20}$\n  - $\\text{GC}_{\\mathrm{TCG}} = 2$\n  - $\\text{GC}_{\\mathrm{AGC}} = 2$\n  - Change contribution: $\\frac{1}{20} (2 - 2) = 0$\n- Replacement 2: $\\text{TCA} \\rightarrow \\text{AGT}$\n  - $f_{\\mathrm{TCA}} = \\frac{1}{30}$\n  - $\\text{GC}_{\\mathrm{TCA}} = 1$\n  - $\\text{GC}_{\\mathrm{AGT}} = 1$\n  - Change contribution: $\\frac{1}{30} (1 - 1) = 0$\n- Replacement 3: $\\text{TAG} \\rightarrow \\text{TAA}$\n  - $f_{\\mathrm{TAG}} = \\frac{1}{600}$\n  - $\\text{GC}_{\\mathrm{TAG}} = 1$\n  - $\\text{GC}_{\\mathrm{TAA}} = 0$\n  - Change contribution: $\\frac{1}{600} (0 - 1) = -\\frac{1}{600}$\n\nThe total change is the sum of these contributions, divided by $3$:\n$$\\Delta f_{\\mathrm{GC}} = \\frac{1}{3} \\left( 0 + 0 - \\frac{1}{600} \\right) = \\frac{1}{3} \\left( -\\frac{1}{600} \\right) = -\\frac{1}{1800}$$\nThis is the exact fractional change in GC content.", "answer": "$$\n\\boxed{\\begin{pmatrix} 1.02 \\times 10^{5}  -\\frac{1}{1800} \\end{pmatrix}}\n$$", "id": "2768341"}, {"introduction": "The degeneracy of the genetic code offers flexibility for recoding, but this flexibility is often severely limited by pleiotropy, where a single nucleotide can serve multiple functions. This is particularly common in compact genomes that feature overlapping reading frames. This computational exercise challenges you to translate this complex biological constraint into a concrete algorithm, allowing you to determine precisely which synonymous codon substitutions are permissible without altering the protein product of an overlapping gene. [@problem_id:2768399]", "problem": "You are asked to formalize, compute, and report codon-level synonymous recoding options in a coding sequence that contains an overlapping reading frame on the same strand. The goal is to eliminate a specified target codon without altering the peptide translated from the overlapping frame. Your derivation and program must proceed from fundamental biological principles and produce a mathematically well-defined, testable output.\n\nFundamental base:\n- Central Dogma of Molecular Biology states that Deoxyribonucleic Acid (DNA) is transcribed to Ribonucleic Acid (RNA), and RNA is translated to protein. In this problem, translation is modeled directly from DNA codons to amino acids using the standard genetic code.\n- A codon is a triplet of nucleotides drawn from the alphabet {A, C, G, T}. The standard genetic code defines a function that maps each codon to a single amino acid or to a termination signal.\n- Synonymous codons are codons that map to the same amino acid. Codon degeneracy implies there may exist multiple synonymous codons for a given amino acid.\n- Translation in a reading frame is defined by partitioning a DNA sequence into non-overlapping codons starting at a specified offset. For a DNA sequence string of length $L$, and a frame offset $f \\in \\{0,1,2\\}$, the translated peptide is obtained by reading codons at indices $i = f, f+3, f+6, \\dots$ up to the largest $i$ such that $i+2  L$; each codon is mapped to its corresponding amino acid.\n\nDefinitions:\n- Let $S$ be the DNA sequence string.\n- Let $p_0 \\in \\{0,1,2\\}$ be the primary frame offset.\n- Let $q_0 \\in \\{0,1,2\\}$ be the overlapping frame offset (same-strand alternative reading frame).\n- Let $t$ be the integer index of the first nucleotide of the target codon in the primary frame, with $t \\equiv p_0 \\pmod{3}$ and $0 \\leq t \\leq L-3$.\n- Let $X$ be the banned codon string (length $3$) that must be eliminated at position $t$ in the primary frame.\n- Let $G$ denote the standard genetic code mapping from codons to amino acids (single-letter codes, and possibly the stop symbol).\n\nTask to be derived and implemented:\n- Consider replacing the codon at indices $[t, t+1, t+2]$ in $S$ by another codon $c'$ that is synonymous with the original codon $c = S[t:t+3]$ (that is, $G(c') = G(c)$), and $c' \\neq X$. Only the three nucleotides in this window may be changed; all other positions in $S$ must remain unchanged.\n- Define the translated peptide function in frame $f$ as $T_f(S)$, obtained by applying $G$ to each full codon window starting at offset $f$.\n- A candidate $c'$ is feasible if and only if both of the following hold:\n  1. $T_{p_0}(S') = T_{p_0}(S)$, where $S'$ is $S$ with $S'[t:t+3] = c'$ (this enforces synonymous replacement in the primary frame).\n  2. $T_{q_0}(S') = T_{q_0}(S)$ (this enforces that the overlapping frame peptide is unchanged).\n- The feasible set is the collection of all such $c'$.\n\nEncoding requirement for outputs:\n- To ensure purely numerical outputs, encode each codon $b_1 b_2 b_3$ as an integer in base-$4$ using the mapping $A \\mapsto 0$, $C \\mapsto 1$, $G \\mapsto 2$, $T \\mapsto 3$, and\n  $$ \\mathrm{code}(b_1 b_2 b_3) = 16 \\cdot \\mathrm{code}(b_1) + 4 \\cdot \\mathrm{code}(b_2) + \\mathrm{code}(b_3). $$\n- Your program must, for each test case, output a sorted list (ascending) of the encoded integers corresponding to all feasible $c'$.\n\nAngle units are not applicable. There are no physical units. All reported numerical outputs must be integers, and lists of integers.\n\nInput is embedded in your program. No external input should be read. Use the following test suite:\n\n- Case A (typical overlapping constraint with multiple feasible solutions expected):\n  - $S =$ \"GCCGCCGCTGCCGCCGCC\"\n  - $p_0 = 0$\n  - $q_0 = 1$\n  - $t = 6$\n  - $X =$ \"GCT\"\n\n- Case B (engineered to produce no feasible solution due to uniquely encoded overlapping codons constraining all three positions):\n  - $S =$ \"GCCGCCGCCGATGTGGGCGCCGCC\"\n  - $p_0 = 0$\n  - $q_0 = 2$\n  - $t = 12$\n  - $X =$ \"GTG\"\n\n- Case C (boundary condition where part of the target codon lies outside any complete codon in the overlapping frame):\n  - $S =$ \"GCTGCCGCCGCCGCC\"\n  - $p_0 = 0$\n  - $q_0 = 1$\n  - $t = 0$\n  - $X =$ \"GCT\"\n\n- Case D (overlapping frame identical to primary frame, so all primary synonymous codons are feasible except the banned one):\n  - $S =$ \"GCCTCGGCCGCC\"\n  - $p_0 = 0$\n  - $q_0 = 0$\n  - $t = 3$\n  - $X =$ \"TCG\"\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, the output format must look like:\n\"[ [a,b], [c], [d,e,f], [ ] ]\"\nbut without any spaces. Concretely, your program must print:\n\"[[caseA_list],[caseB_list],[caseC_list],[caseD_list]]\"\nwhere each \"caseX_list\" is a list of encoded integers sorted in ascending order and without spaces.\n\nThe objective is to test your ability to:\n- Derive the feasibility condition from first principles using $T_f$ and the standard genetic code $G$.\n- Design an algorithm that enumerates and filters synonymous codons based on overlapping frame invariance.\n- Implement a robust and testable computation that handles typical, boundary, and infeasible scenarios while producing purely numerical outputs.", "solution": "The problem requires the formalization and computation of a set of feasible synonymous codons that can replace a target codon in a primary reading frame, with the constraint that the peptide sequence of an overlapping reading frame remains unaltered. We begin by establishing the mathematical and biological principles governing the solution.\n\nLet the DNA sequence be a string $S$ of length $L$ over the alphabet $\\{A, C, G, T\\}$. Let $G$ be the function representing the standard genetic code, which maps a $3$-nucleotide codon to an amino acid or a stop signal. The translation of $S$ in a reading frame with offset $f \\in \\{0, 1, 2\\}$ is denoted by $T_f(S)$ and is produced by applying $G$ to the sequence of codons $S[i:i+3]$ for $i = f, f+3, f+6, \\dots$ where $i+2  L$.\n\nThe problem is to find all codons $c'$ that can replace the original codon $c = S[t:t+3]$ at a given starting index $t$ in the primary frame $p_0$. The replacement $c'$ must satisfy two conditions:\n$1$. The peptide from the primary frame $p_0$ is preserved. This is a synonymous mutation, meaning $G(c') = G(c)$. Additionally, the replacement codon $c'$ must not be the specific banned codon $X$, i.e., $c' \\neq X$.\n$2$. The peptide from the overlapping frame $q_0$ is preserved, i.e., $T_{q_0}(S') = T_{q_0}(S)$, where $S'$ is the sequence $S$ after replacing the substring at indices $[t, t+1, t+2]$ with $c'$.\n\nThe overall approach is to first generate a set of candidate codons based on the primary frame constraint and then filter this set using the more complex overlapping frame constraint.\n\nFirst, we address the primary frame constraint. The original codon is $c = S[t:t+3]$, which translates to the amino acid $A_c = G(c)$. Any valid replacement $c'$ must also translate to $A_c$. This defines a set of synonymous codons. From this set, we exclude the banned codon $X$. The resulting set of candidate codons is:\n$$ \\mathcal{C}_{\\text{cand}} = \\{ c' \\mid G(c') = G(c) \\land c' \\neq X \\} $$\nThis set contains all potential solutions that satisfy the first condition.\n\nNext, we address the overlapping frame constraint. A modification made to the three nucleotides at indices $t, t+1, t+2$ can potentially alter the codons in the overlapping frame $q_0$. A codon in frame $q_0$ begins at an index $j$ such that $j \\equiv q_0 \\pmod{3}$. Such a codon, occupying indices $[j, j+1, j+2]$, is affected if its window overlaps with the modification window $[t, t+1, t+2]$. This condition holds if and only if $t-2 \\le j \\le t+2$.\n\nFor each candidate codon $c' \\in \\mathcal{C}_{\\text{cand}}$, we must verify that it does not alter the translation of the overlapping frame. This requires us to check every affected codon in frame $q_0$. Let $c' = n'_0n'_1n'_2$. The new sequence $S'$ is identical to $S$ except that $S'[t]=n'_0$, $S'[t+1]=n'_1$, and $S'[t+2]=n'_2$.\nFor each integer $j$ such that $j \\equiv q_0 \\pmod{3}$ and $t-2 \\le j \\le t+2$, we must check if the amino acid is preserved. We only consider complete codons, those for which $j \\ge 0$ and $j+3 \\le L$. For each such valid $j$, let the original $q_0$-frame codon be $c_{q,j} = S[j:j+3]$ and the new codon be $c'_{q,j}=S'[j:j+3]$. The constraint $T_{q_0}(S') = T_{q_0}(S)$ reduces to the set of local conditions:\n$$ G(c'_{q,j}) = G(c_{q,j}) \\quad \\forall j \\in \\{k \\mid k \\equiv q_0 \\pmod 3 \\land t-2 \\le k \\le t+2 \\land k \\ge 0 \\land k+3 \\le L\\} $$\nThe new codon $c'_{q,j}$ is composed of nucleotides from $c'$ if their indices fall within $[t, t+1, t+2]$, and from the original sequence $S$ otherwise. A candidate $c'$ from $\\mathcal{C}_{\\text{cand}}$ is deemed feasible if and only if it satisfies this condition for all affected complete codons in the $q_0$ frame.\n\nLet us analyze Case B as a concrete example:\n- $S = \\text{\"GCCGCCGCCGATGTGGGCGCCGCC\"}$ ($L=24$)\n- $p_0 = 0$, $q_0 = 2$, $t = 12$, $X = \\text{\"GTG\"}$\nThe original codon in the primary frame is $c = S[12:15] = \\text{\"GTG\"}$, which codes for Valine ($G(\\text{GTG}) = V$). The synonymous codons for Valine are GTT, GTC, GTA, GTG. Since $X=\\text{GTG}$ is banned, the candidate set is $\\mathcal{C}_{\\text{cand}} = \\{\\text{GTT, GTC, GTA}\\}$.\n\nThe modification occurs at indices $12, 13, 14$. The overlapping frame is $q_0=2$. The affected codon start indices $j$ must satisfy $j \\equiv 2 \\pmod{3}$ and $12-2 \\le j \\le 12+2$, so $10 \\le j \\le 14$. The integers in this range that satisfy $j \\equiv 2 \\pmod 3$ are $j=11$ and $j=14$. Both form complete codons.\n\nFor $j=11$: The affected codon is at $[11, 12, 13]$.\n- Original codon: $c_{q,11} = S[11:14] = \\text{\"TGT\"}$, which codes for Cysteine ($G(\\text{TGT})=C$).\n- Let $c' = n'_0 n'_1 n'_2$. The new codon is $c'_{q,11} = S[11]S'[12]S'[13] = \\text{\"T\"}n'_0n'_1$.\n- Constraint: $G(\\text{T}n'_0n'_1)$ must be Cysteine. The codons for Cysteine are TGT and TGC. Therefore, $n'_0n'_1$ must be \"GT\" or \"GC\".\n\nFor $j=14$: The affected codon is at $[14, 15, 16]$.\n- Original codon: $c_{q,14} = S[14:17] = \\text{\"GGC\"}$, which codes for Glycine ($G(\\text{GGC})=G$).\n- The new codon is $c'_{q,14} = S'[14]S[15]S[16] = n'_2\\text{\"GG\"}$.\n- Constraint: $G(n'_2\\text{GG})$ must be Glycine. The codons for Glycine are GGT, GGC, GGA, GGG. All have the form $GGN$. Our new codon has the form $NGG$. The only codons of the form $NGG$ are AGG (Arginine), CGG (Arginine), GGG (Glycine), and TGG (Tryptophan). For the amino acid to be Glycine, $n'_2$ must be 'G'.\n\nCombining constraints for a candidate $c' = n'_0n'_1n'_2$:\n1. $G(n'_0n'_1n'_2)$ is Valine, and $c' \\neq \\text{GTG}$.\n2. $n'_0n'_1$ is \"GT\" or \"GC\".\n3. $n'_2$ is \"G\".\n\nWe test the candidates from $\\mathcal{C}_{\\text{cand}}$:\n- $c'=\\text{GTT}$: $n'_0n'_1 = \\text{GT}$, $n'_2=\\text{T}$. Fails condition $3$.\n- $c'=\\text{GTC}$: $n'_0n'_1 = \\text{GT}$, $n'_2=\\text{C}$. Fails condition $3$.\n- $c'=\\text{GTA}$: $n'_0n'_1 = \\text{GT}$, $n'_2=\\text{A}$. Fails condition $3$.\n\nNone of the candidate codons satisfy all constraints. Therefore, the set of feasible codons is empty, which aligns with the problem's expectation for this test case. The same rigorous, principle-based derivation is applied to all cases to produce the final computational result.", "answer": "```python\ndef solve():\n    \"\"\"\n    Solves the codon recoding problem for a suite of test cases by finding\n    all feasible synonymous codon replacements that do not alter an overlapping\n    reading frame.\n    \"\"\"\n    # The standard genetic code, mapping DNA codons to single-letter amino acid codes.\n    GENETIC_CODE = {\n        'TTT': 'F', 'TTC': 'F', 'TTA': 'L', 'TTG': 'L', 'CTT': 'L', 'CTC': 'L', 'CTA': 'L', 'CTG': 'L',\n        'TCT': 'S', 'TCC': 'S', 'TCA': 'S', 'TCG': 'S', 'AGT': 'S', 'AGC': 'S',\n        'TAT': 'Y', 'TAC': 'Y', 'TAA': '*', 'TAG': '*', 'TGA': '*',\n        'TGT': 'C', 'TGC': 'C', 'TGG': 'W',\n        'CCT': 'P', 'CCC': 'P', 'CCA': 'P', 'CCG': 'P',\n        'CAT': 'H', 'CAC': 'H', 'CAA': 'Q', 'CAG': 'Q',\n        'CGT': 'R', 'CGC': 'R', 'CGA': 'R', 'CGG': 'R', 'AGA': 'R', 'AGG': 'R',\n        'ATT': 'I', 'ATC': 'I', 'ATA': 'I', 'ATG': 'M',\n        'ACT': 'T', 'ACC': 'T', 'ACA': 'T', 'ACG': 'T',\n        'AAT': 'N', 'AAC': 'N', 'AAA': 'K', 'AAG': 'K',\n        'GTT': 'V', 'GTC': 'V', 'GTA': 'V', 'GTG': 'V',\n        'GCT': 'A', 'GCC': 'A', 'GCA': 'A', 'GCG': 'A',\n        'GAT': 'D', 'GAC': 'D', 'GAA': 'E', 'GAG': 'E',\n        'GGT': 'G', 'GGC': 'G', 'GGA': 'G', 'GGG': 'G',\n    }\n\n    BASE_TO_INT = {'A': 0, 'C': 1, 'G': 2, 'T': 3}\n    all_codons = sorted(GENETIC_CODE.keys())\n\n    def encode_codon(codon):\n        \"\"\"Encodes a 3-base codon string into its base-4 integer representation.\"\"\"\n        return 16 * BASE_TO_INT[codon[0]] + 4 * BASE_TO_INT[codon[1]] + BASE_TO_INT[codon[2]]\n\n    test_cases = [\n        {\"S\": \"GCCGCCGCTGCCGCCGCC\", \"p0\": 0, \"q0\": 1, \"t\": 6, \"X\": \"GCT\"},\n        {\"S\": \"GCCGCCGCCGATGTGGGCGCCGCC\", \"p0\": 0, \"q0\": 2, \"t\": 12, \"X\": \"GTG\"},\n        {\"S\": \"GCTGCCGCCGCCGCC\", \"p0\": 0, \"q0\": 1, \"t\": 0, \"X\": \"GCT\"},\n        {\"S\": \"GCCTCGGCCGCC\", \"p0\": 0, \"q0\": 0, \"t\": 3, \"X\": \"TCG\"},\n    ]\n\n    final_results = []\n    for case in test_cases:\n        S, p0, q0, t, X = case[\"S\"], case[\"p0\"], case[\"q0\"], case[\"t\"], case[\"X\"]\n        L = len(S)\n\n        # 1. Determine candidate codons based on primary frame constraint (synonymous and not banned).\n        original_codon = S[t:t+3]\n        target_aa = GENETIC_CODE[original_codon]\n        candidate_codons = [c for c in all_codons if GENETIC_CODE[c] == target_aa and c != X]\n\n        # 2. Filter candidates based on the overlapping frame constraint.\n        feasible_codons = []\n        for c_prime in candidate_codons:\n            is_feasible = True\n            S_prime_list = list(S)\n            S_prime_list[t:t+3] = list(c_prime)\n            S_prime = \"\".join(S_prime_list)\n\n            # Check translation of the entire overlapping frame.\n            # This is simpler and more robust than trying to find only the affected codons.\n            for j in range(q0, L - 2, 3):\n                original_q_codon = S[j:j+3]\n                new_q_codon = S_prime[j:j+3]\n                if GENETIC_CODE.get(original_q_codon) != GENETIC_CODE.get(new_q_codon):\n                    is_feasible = False\n                    break\n            \n            if is_feasible:\n                feasible_codons.append(c_prime)\n\n        # 3. Encode the feasible codons and add the sorted list to the results.\n        encoded_results = sorted([encode_codon(codon) for codon in feasible_codons])\n        final_results.append(encoded_results)\n\n    # 4. Format and print the final output exactly as required.\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, r))}]\" for r in final_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "2768399"}, {"introduction": "Effective genome engineering is fundamentally a design problem that involves navigating complex trade-offs. While eliminating certain codons to confer virus resistance is the primary goal, an optimal strategy must also minimize disruption to other functional elements, such as regulatory motifs, that are encoded in the same DNA sequence. This practice formalizes this challenge as an optimization problem, demonstrating how to select the \"best\" synonymous codons by penalizing changes that might disrupt known functional sites, thereby moving from simple feasibility to robust, multi-objective design. [@problem_id:2768361]", "problem": "You are tasked with formalizing synonymous codon replacement for recoding a protein-coding sequence to eliminate a specified set of disallowed codons while minimizing disruption of rare regulatory elements. The biological basis is the Central Dogma of Molecular Biology, the degeneracy of the genetic code (multiple codons encode the same amino acid), and the observation that changing coding nucleotides can inadvertently alter rare regulatory motifs that overlap the coding region. In recoded organisms engineered for virus resistance, one strategy is to eliminate usage of a host-reassigned or forbidden codon set, provided that the protein sequence is preserved by restricting changes to synonymous substitutions. We will encode this as an Integer Linear Program (ILP) and compute optimal objective values for a small test suite.\n\nFormulate and solve the following Integer Linear Program (ILP). Given a coding sequence of length $N$ codons indexed by $i \\in \\{1,\\dots,N\\}$, each codon occupies nucleotide positions $j \\in \\{3i-2,3i-1,3i\\}$ in the contiguous nucleotide index set $\\{1,\\dots,3N\\}$. Let $c_i$ denote the original codon at position $i$. Let $\\mathcal{B}$ be the set of banned codons that must be eliminated. For each position $i$, let $\\mathcal{S}_i$ be the set of synonyms (all codons encoding the same amino acid as $c_i$). For each regulatory element $e$ in an index set $\\mathcal{E}$, let $P_e \\subseteq \\{1,\\dots,3N\\}$ be the set of nucleotide indices covered by that element and let $w_e \\ge 0$ be its penalty weight. The decision variables are:\n- $x_{i,s} \\in \\{0,1\\}$ for each $i$ and $s \\in \\mathcal{S}_i$, indicating selection of synonym $s$ at codon position $i$.\n- $u_j \\in \\{0,1\\}$ for each nucleotide position $j \\in \\{1,\\dots,3N\\}$, indicating whether nucleotide $j$ changes relative to the original sequence.\n- $y_e \\in \\{0,1\\}$ for each regulatory element $e \\in \\mathcal{E}$, indicating whether any nucleotide in $P_e$ is altered.\n\nLet $d_{i,s,b} \\in \\{0,1\\}$ indicate whether the $b$-th base of codon $s$ at position $i$ differs from the $b$-th base of the original codon $c_i$, for $b \\in \\{1,2,3\\}$. Define the mapping from codon position $i$ and base index $b$ to a nucleotide index $j = 3i-3+b$.\n\nThe ILP is:\n- Objective: minimize\n$$\n\\sum_{e \\in \\mathcal{E}} w_e \\, y_e\n$$\n- Subject to constraints:\n1) Synonym selection at each position:\n$$\n\\sum_{s \\in \\mathcal{S}_i} x_{i,s} = 1 \\quad \\text{for all } i \\in \\{1,\\dots,N\\}.\n$$\n2) Eliminate banned codons:\n$$\nx_{i,s} = 0 \\quad \\text{for all } i \\in \\{1,\\dots,N\\}, \\; s \\in \\mathcal{S}_i \\cap \\mathcal{B}.\n$$\n3) Nucleotide change indicators consistent with chosen synonyms:\n$$\nu_{3i-3+b} = \\sum_{s \\in \\mathcal{S}_i} d_{i,s,b} \\, x_{i,s} \\quad \\text{for all } i \\in \\{1,\\dots,N\\}, \\; b \\in \\{1,2,3\\}.\n$$\n4) Regulatory element penalty triggers if any overlapping nucleotide changes:\n$$\ny_e \\ge u_j \\quad \\text{for all } e \\in \\mathcal{E}, \\; j \\in P_e.\n$$\nAll variables $x_{i,s}$, $u_j$, and $y_e$ are binary.\n\nYou must write a program that, for each test instance below, computes the optimal objective value of the ILP. If the model is infeasible (no choice of synonyms satisfies the banned-codon constraints), output $-1$ for that test case.\n\nSynonym sets are defined by amino acid identity and must preserve the protein sequence. For the test suite, you may assume the following synonym classes:\n- Arginine (Arg): $\\{\\texttt{CGT}, \\texttt{CGC}, \\texttt{CGA}, \\texttt{CGG}, \\texttt{AGA}, \\texttt{AGG}\\}$.\n- Lysine (Lys): $\\{\\texttt{AAA}, \\texttt{AAG}\\}$.\n- Alanine (Ala): $\\{\\texttt{GCT}, \\texttt{GCC}, \\texttt{GCA}, \\texttt{GCG}\\}$.\n\nThe amino acid at each codon position is determined by the original codon $c_i$ and must not change. Nucleotides are specified using the DNA alphabet $\\{\\texttt{A}, \\texttt{C}, \\texttt{G}, \\texttt{T}\\}$.\n\nTest suite (each test case is independent and self-contained):\n- Case $1$:\n  - Original codon list $(c_i)_{i=1}^N$: $(\\texttt{AGA}, \\texttt{GCT}, \\texttt{AAA})$ with $N = 3$.\n  - Banned set $\\mathcal{B} = \\{\\texttt{AGA}, \\texttt{AGG}\\}$.\n  - Regulatory elements $\\mathcal{E}$ with nucleotide index sets and weights:\n    - $e_1$: $P_{e_1} = \\{2,3,4\\}$, $w_{e_1} = 2$.\n    - $e_2$: $P_{e_2} = \\{6,7\\}$, $w_{e_2} = 1$.\n- Case $2$:\n  - Original codon list $(\\texttt{AAA}, \\texttt{AGA}, \\texttt{AAG})$ with $N = 3$.\n  - Banned set $\\mathcal{B} = \\{\\texttt{AGA}\\}$.\n  - Regulatory elements:\n    - $e_1$: $P_{e_1} = \\{4,5,6\\}$, $w_{e_1} = 2$.\n    - $e_2$: $P_{e_2} = \\{1,2,3\\}$, $w_{e_2} = 1$.\n- Case $3$:\n  - Original codon list $(\\texttt{AAA}, \\texttt{AAG})$ with $N = 2$.\n  - Banned set $\\mathcal{B} = \\{\\texttt{AAA}, \\texttt{AAG}\\}$.\n  - Regulatory elements: none (empty $\\mathcal{E}$).\n- Case $4$:\n  - Original codon list $(\\texttt{AGA}, \\texttt{GCT}, \\texttt{AGG}, \\texttt{AAG})$ with $N = 4$.\n  - Banned set $\\mathcal{B} = \\{\\texttt{AGA}, \\texttt{AGG}\\}$.\n  - Regulatory elements:\n    - $e_1$: $P_{e_1} = \\{2,3,4\\}$, $w_{e_1} = 1$.\n    - $e_2$: $P_{e_2} = \\{5,6,7\\}$, $w_{e_2} = 1$.\n    - $e_3$: $P_{e_3} = \\{9\\}$, $w_{e_3} = 2$.\n\nProgram requirements:\n- Your program must construct and solve the ILP for each case. Because the instances are small, you may solve exactly by enumerating all combinations of allowed synonyms that satisfy constraint $2$ and selecting the minimal objective value with respect to the trigger rule in constraints $3$â€“$4$.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be an integer; use $-1$ to denote infeasibility.", "solution": "The problem has been validated and is deemed a well-posed, scientifically-grounded optimization problem based on established principles of synthetic biology. It is complete, consistent, and lacks any of the specified flaws. The problem statement itself provides a formal Integer Linear Program (ILP) formulation. However, as noted in the prompt, the test instances are of sufficiently small combinatorial complexity that a direct and exact solution can be found by enumerating the feasible solution space, rather than resorting to a general-purpose ILP solver. This approach is computationally tractable here and avoids unnecessary implementation overhead.\n\nThe core of the strategy is to, for each codon position $i \\in \\{1, \\dots, N\\}$, determine the set of allowed synonymous codons, which are those that preserve the amino acid encoded by the original codon $c_i$ but are not in the banned set $\\mathcal{B}$. The feasible set of recoded sequences is the Cartesian product of these allowed synonym sets. For each candidate recoded sequence, we calculate the total penalty by identifying the set of nucleotide positions that have changed relative to the original sequence and summing the weights $w_e$ of all regulatory elements $e$ whose position sets $P_e$ are intersected by these changes. The optimal solution is the one that yields the minimum total penalty. If, for any position $i$, the set of allowed synonyms is empty, the problem is infeasible.\n\nThe synonym sets for the relevant amino acids are defined as:\n- Arginine (Arg): $\\{\\texttt{CGT}, \\texttt{CGC}, \\texttt{CGA}, \\texttt{CGG}, \\texttt{AGA}, \\texttt{AGG}\\}$\n- Lysine (Lys): $\\{\\texttt{AAA}, \\texttt{AAG}\\}$\n- Alanine (Ala): $\\{\\texttt{GCT}, \\texttt{GCC}, \\texttt{GCA}, \\texttt{GCG}\\}$\n\nLet us now apply this procedure to each test case.\n\nCase $1$:\n- Original codons $(c_i)_{i=1}^3$: $(\\texttt{AGA}, \\texttt{GCT}, \\texttt{AAA})$. This is a sequence of length $N=3$ codons, encoding (Arg, Ala, Lys).\n- Banned set $\\mathcal{B} = \\{\\texttt{AGA}, \\texttt{AGG}\\}$.\n- Regulatory elements: $e_1$ with $P_{e_1} = \\{2,3,4\\}, w_{e_1} = 2$; $e_2$ with $P_{e_2} = \\{6,7\\}, w_{e_2} = 1$.\n\nAt position $i=1$, the original codon is $\\texttt{AGA}$, which is banned. The allowed Arg synonyms are $\\{\\texttt{CGT}, \\texttt{CGC}, \\texttt{CGA}, \\texttt{CGG}\\}$.\nAt position $i=2$, the original codon is $\\texttt{GCT}$, which is not banned. All Ala synonyms $\\{\\texttt{GCT}, \\texttt{GCC}, \\texttt{GCA}, \\texttt{GCG}\\}$ are allowed.\nAt position $i=3$, the original codon is $\\texttt{AAA}$, which is not banned. All Lys synonyms $\\{\\texttt{AAA}, \\texttt{AAG}\\}$ are allowed.\nThe problem is feasible.\n\nTo minimize the objective $\\sum w_e y_e$, we must minimize nucleotide changes in the regions $P_{e_1}$ and $P_{e_2}$.\n- At position $i=1$, we must change $\\texttt{AGA}$. The replacement from the allowed set that minimizes nucleotide changes is $\\texttt{CGA}$, which differs from $\\texttt{AGA}$ only at the first base of the codon. This corresponds to a change only at nucleotide index $j=1$.\n- At position $i=2$, we can choose the original codon $\\texttt{GCT}$, causing no changes at nucleotide indices $j \\in \\{4,5,6\\}$.\n- At position $i=3$, we can choose the original codon $\\texttt{AAA}$, causing no changes at nucleotide indices $j \\in \\{7,8,9\\}$.\n\nThe optimal recoded sequence is therefore $(\\texttt{CGA}, \\texttt{GCT}, \\texttt{AAA})$. The set of changed nucleotide indices is $\\{1\\}$.\nThe penalty is calculated as follows:\n- Element $e_1$: $P_{e_1} = \\{2,3,4\\}$. The intersection with the changed set $\\{1\\}$ is empty. Thus, $y_1=0$.\n- Element $e_2$: $P_{e_2} = \\{6,7\\}$. The intersection with the changed set $\\{1\\}$ is empty. Thus, $y_2=0$.\nThe total penalty is $w_1 y_1 + w_2 y_2 = 2 \\cdot 0 + 1 \\cdot 0 = 0$.\nThe optimal objective value is $0$.\n\nCase $2$:\n- Original codons $(c_i)_{i=1}^3$: $(\\texttt{AAA}, \\texttt{AGA}, \\texttt{AAG})$. This is a sequence of length $N=3$ codons, encoding (Lys, Arg, Lys).\n- Banned set $\\mathcal{B} = \\{\\texttt{AGA}\\}$.\n- Regulatory elements: $e_1$ with $P_{e_1} = \\{4,5,6\\}, w_{e_1} = 2$; $e_2$ with $P_{e_2} = \\{1,2,3\\}, w_{e_2} = 1$.\n\nThe problem is feasible as non-banned synonyms exist for all positions.\n- Position $i=1$: Original is $\\texttt{AAA}$, not banned. To avoid penalty from $e_2$ ($P_{e_2}=\\{1,2,3\\}$), we choose $\\texttt{AAA}$, inducing no changes.\n- Position $i=2$: Original is $\\texttt{AGA}$, which is banned. We must choose from the allowed Arg synonyms $\\{\\texttt{CGT}, \\texttt{CGC}, \\texttt{CGA}, \\texttt{CGG}, \\texttt{AGG}\\}$. Every one of these substitutions necessitates at least one nucleotide change within the codon at position $2$ (nucleotide indices $\\{4,5,6\\}$). For example, replacing $\\texttt{AGA}$ with $\\texttt{CGA}$ alters index $4$, and replacing with $\\texttt{AGG}$ alters index $6$. Since $P_{e_1} = \\{4,5,6\\}$, any change at this codon position will trigger the penalty for $e_1$. Thus, $y_1=1$ is unavoidable.\n- Position $i=3$: Original is $\\texttt{AAG}$, not banned. We choose $\\texttt{AAG}$ to induce no changes.\n\nA minimal change strategy is to select $(\\texttt{AAA}, \\texttt{AGG}, \\texttt{AAG})$. The only change is at nucleotide index $j=6$ (from $\\texttt{AGA}$ to $\\texttt{AGG}$).\nThe set of changed indices is $\\{6\\}$.\n- Element $e_1$: $P_{e_1}=\\{4,5,6\\}$. Intersection is $\\{6\\}$. $y_1=1$. Penalty contribution is $w_1 = 2$.\n- Element $e_2$: $P_{e_2}=\\{1,2,3\\}$. Intersection is empty. $y_2=0$. Penalty contribution is $0$.\nThe minimum total penalty is $2$.\n\nCase $3$:\n- Original codons $(c_i)_{i=1}^2$: $(\\texttt{AAA}, \\texttt{AAG})$. This is a sequence of length $N=2$ codons, encoding (Lys, Lys).\n- Banned set $\\mathcal{B} = \\{\\texttt{AAA}, \\texttt{AAG}\\}$.\n- Regulatory elements: None ($\\mathcal{E} = \\emptyset$).\n\nAt position $i=1$, the codon is $\\texttt{AAA}$. The amino acid is Lysine, for which the entire synonym set is $\\{\\texttt{AAA}, \\texttt{AAG}\\}$. Both of these codons are in the banned set $\\mathcal{B}$. Therefore, there are no allowed synonyms for this position.\nThe problem is infeasible. The result is $-1$.\n\nCase $4$:\n- Original codons $(c_i)_{i=1}^4$: $(\\texttt{AGA}, \\texttt{GCT}, \\texttt{AGG}, \\texttt{AAG})$. This is a sequence of length $N=4$ codons, encoding (Arg, Ala, Arg, Lys).\n- Banned set $\\mathcal{B} = \\{\\texttt{AGA}, \\texttt{AGG}\\}$.\n- Regulatory elements: $e_1: P_{e_1}=\\{2,3,4\\}, w_{e_1}=1$; $e_2: P_{e_2}=\\{5,6,7\\}, w_{e_2}=1$; $e_3: P_{e_3}=\\{9\\}, w_{e_3}=2$.\n\nThe problem is feasible. Codons at positions $i=1$ and $i=3$ are banned but have allowed Arg synonyms.\n- Position $i=1$ ($\\texttt{AGA}$, banned): To minimize changes impacting $P_{e_1}=\\{2,3,4\\}$, we choose $\\texttt{CGA}$. This changes only nucleotide $j=1$. This choice does not trigger any penalty.\n- Position $i=2$ ($\\texttt{GCT}$, not banned): We choose $\\texttt{GCT}$, inducing no changes.\n- Position $i=3$ ($\\texttt{AGG}$, banned): We must change this codon. The allowed synonyms are $\\{\\texttt{CGT}, \\texttt{CGC}, \\texttt{CGA}, \\texttt{CGG}\\}$. To select the best option, we analyze the changes they induce at nucleotide indices $j \\in \\{7,8,9\\}$ relative to $\\texttt{AGG}$.\n    - vs $\\texttt{CGT}$: changes at $j \\in \\{7,9\\}$.\n    - vs $\\texttt{CGC}$: changes at $j \\in \\{7,9\\}$.\n    - vs $\\texttt{CGA}$: changes at $j \\in \\{7,9\\}$.\n    - vs $\\texttt{CGG}$: change at $j \\in \\{7\\}$.\nChoosing $\\texttt{CGG}$ is optimal as it changes only nucleotide $j=7$. This change falls within $P_{e_2}=\\{5,6,7\\}$, triggering a penalty of $w_2=1$. This penalty is unavoidable, as all allowed synonyms for this position change nucleotide $j=7$. The choice of $\\texttt{CGG}$ avoids a change at $j=9$, thus avoiding the larger penalty $w_3=2$.\n- Position $i=4$ ($\\texttt{AAG}$, not banned): We choose $\\texttt{AAG}$, inducing no changes.\n\nThe optimal strategy results in a recoded sequence like $(\\texttt{CGA}, \\texttt{GCT}, \\texttt{CGG}, \\texttt{AAG})$. The set of changed nucleotide indices is $\\{1, 7\\}$.\n- $e_1$: $P_{e_1}=\\{2,3,4\\}$. Intersection with $\\{1,7\\}$ is empty. $y_1=0$.\n- $e_2$: $P_{e_2}=\\{5,6,7\\}$. Intersection is $\\{7\\}$. $y_2=1$. Penalty contribution is $w_2=1$.\n- $e_3$: $P_{e_3}=\\{9\\}$. Intersection is empty. $y_3=0$.\nThe minimal total penalty is $1$.\n\nFinal summary of results: $[0, 2, -1, 1]$.", "answer": "```python\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the codon replacement problem by enumerating all valid combinations\n    of synonymous codons and calculating the minimum regulatory penalty.\n    \"\"\"\n\n    # Define synonym sets and map codons to their amino acid / synonym group\n    synonym_map = {\n        'Arg': {'CGT', 'CGC', 'CGA', 'CGG', 'AGA', 'AGG'},\n        'Lys': {'AAA', 'AAG'},\n        'Ala': {'GCT', 'GCC', 'GCA', 'GCG'}\n    }\n    codon_to_aa = {codon: aa for aa, codons in synonym_map.items() for codon in codons}\n\n    # Define the test suite from the problem statement\n    test_cases = [\n        {\n            'original_codons': ('AGA', 'GCT', 'AAA'),\n            'banned_codons': {'AGA', 'AGG'},\n            'reg_elements': [\n                {'P': {2, 3, 4}, 'w': 2},\n                {'P': {6, 7}, 'w': 1}\n            ]\n        },\n        {\n            'original_codons': ('AAA', 'AGA', 'AAG'),\n            'banned_codons': {'AGA'},\n            'reg_elements': [\n                {'P': {4, 5, 6}, 'w': 2},\n                {'P': {1, 2, 3}, 'w': 1}\n            ]\n        },\n        {\n            'original_codons': ('AAA', 'AAG'),\n            'banned_codons': {'AAA', 'AAG'},\n            'reg_elements': []\n        },\n        {\n            'original_codons': ('AGA', 'GCT', 'AGG', 'AAG'),\n            'banned_codons': {'AGA', 'AGG'},\n            'reg_elements': [\n                {'P': {2, 3, 4}, 'w': 1},\n                {'P': {5, 6, 7}, 'w': 1},\n                {'P': {9}, 'w': 2}\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        original_codons = case['original_codons']\n        banned_codons = case['banned_codons']\n        reg_elements = case['reg_elements']\n        num_codons = len(original_codons)\n\n        # Step 1: Determine the set of allowed synonyms for each codon position.\n        allowed_synonyms_per_pos = []\n        is_infeasible = False\n        for i in range(num_codons):\n            codon = original_codons[i]\n            if codon not in codon_to_aa:\n                 # This case should not happen with the provided data\n                 is_infeasible = True\n                 break\n\n            aa = codon_to_aa[codon]\n            synonyms = synonym_map[aa]\n            allowed = sorted(list(synonyms - banned_codons)) # Sort for deterministic behavior\n            \n            if not allowed:\n                is_infeasible = True\n                break\n            allowed_synonyms_per_pos.append(allowed)\n        \n        if is_infeasible:\n            results.append(-1)\n            continue\n\n        # Step 2: Enumerate all combinations and find the one with the minimum penalty.\n        min_penalty = float('inf')\n        \n        # Use itertools.product to get the Cartesian product of allowed synonym sets.\n        for new_codon_sequence in itertools.product(*allowed_synonyms_per_pos):\n            # Step 3: For the current combination, find all changed nucleotide indices.\n            changed_indices = set()\n            for i in range(num_codons):\n                original_codon = original_codons[i]\n                new_codon = new_codon_sequence[i]\n                if original_codon != new_codon:\n                    for base_idx in range(3): # base_idx is 0, 1, or 2\n                        if original_codon[base_idx] != new_codon[base_idx]:\n                            # Nucleotide index j = 3*i + base_idx + 1 (1-based)\n                            changed_indices.add(3 * i + base_idx + 1)\n            \n            # Step 4: Calculate the total penalty for this set of changes.\n            current_penalty = 0\n            if reg_elements:\n                for element in reg_elements:\n                    p_e = element['P']\n                    w_e = element['w']\n                    # Check for a non-empty intersection between changed indices and the element's positions.\n                    if not changed_indices.isdisjoint(p_e):\n                        current_penalty += w_e\n            \n            min_penalty = min(min_penalty, current_penalty)\n            # Optimization: if min_penalty reaches 0, no better solution can be found.\n            if min_penalty == 0:\n                break\n        \n        if min_penalty == float('inf'):\n            # This case occurs if there are no reg_elements, so penalty is always 0.\n            results.append(0)\n        else:\n            results.append(min_penalty)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2768361"}]}