{"hands_on_practices": [{"introduction": "The amniotic egg's success as a \"private pond\" for terrestrial development hinges on the shell's ability to manage gas exchange with the environment. This exercise challenges you to build a model from first principles, connecting the microscopic architecture of the shell—its pores and thickness—to its macroscopic physiological performance. By deriving the shell's gas conductance, you will gain a quantitative appreciation for the physical trade-offs that have shaped the evolution of this critical structure. [@problem_id:2572439]", "problem": "In the evolutionary transition to the amniotic egg, the eggshell must simultaneously limit water loss and permit sufficient gas exchange for the embryo. Consider an idealized amniote eggshell modeled as a planar slab of thickness $L$ perforated by straight, non-interacting pores whose mean geometric radius is $r$, with a uniform areal pore density $n$ (pores per unit surface area). Let the mean diffusive path length through the pore be longer than $L$ due to meandering, quantified by a tortuosity factor $\\tau$ defined as the ratio of the mean path length to the shell thickness, so that the effective path length is $\\tau L$ with $\\tau \\geq 1$. Assume the gas of interest has a binary molecular diffusivity in air equal to $D$, constant in space and time.\n\nDefine the whole-shell effective molar conductance $G$ by the linear relation $\\dot{N} = G\\,\\Delta C$, where $\\dot{N}$ is the total molar flux across the entire shell (moles per unit time) and $\\Delta C$ is the difference in molar concentration of the diffusing gas between the inside and outside of the egg. Take the total external shell surface area to be $A_s$, and assume isothermal, steady-state diffusion with no chemical reaction or convection.\n\nUsing only well-tested physical principles appropriate to diffusion in porous media and defensible geometric idealizations of the pores, derive a closed-form expression for $G$ in terms of $n$, $\\tau$, $D$, $r$, $L$, and $A_s$. Clearly state all modeling assumptions you make, including how tortuosity enters the derivation. Express $G$ in the International System of Units (SI), noting that under the definition given, $G$ has units of $\\mathrm{m}^3\\,\\mathrm{s}^{-1}$. Provide your final answer as a single symbolic expression. Do not include any units inside the final boxed answer.", "solution": "The problem as stated is scientifically grounded, self-contained, and well-posed. It is based on the established principles of diffusion in porous media and provides sufficient, consistent information for a formal derivation. We shall proceed with the solution.\n\nThe problem requires the derivation of an expression for the whole-shell effective molar conductance, $G$, for gas diffusion through an amniotic eggshell. The derivation must be based on fundamental physical principles. The governing principle for steady-state molecular diffusion is Fick's first law.\n\nFick's first law states that the molar flux density, $J$ (moles per unit area per unit time), is proportional to the negative of the concentration gradient. In one dimension, this is expressed as:\n$$\nJ = -D \\frac{dC}{dx}\n$$\nwhere $D$ is the molecular diffusivity of the gas and a constant, and $\\frac{dC}{dx}$ is the gradient of the molar concentration $C$.\n\nWe first consider the diffusion through a single, idealized pore. The problem models the pores as cylindrical channels. The system is at steady-state, which implies that the concentration profile along the diffusion path does not change with time. For a one-dimensional diffusion path of length $L_{eff}$ with fixed concentrations at the boundaries, the concentration gradient is constant. The magnitude of this gradient can be approximated as:\n$$\n\\left| \\frac{dC}{dx} \\right| = \\frac{\\Delta C}{L_{eff}}\n$$\nwhere $\\Delta C$ is the magnitude of the concentration difference between the inside and outside of the shell.\n\nThe problem specifies that the mean diffusive path length is not the shell thickness $L$, but an effective path length $L_{eff}$ that accounts for the meandering nature of the pore. This is quantified by the tortuosity factor $\\tau$, defined as the ratio of the mean path length to the shell thickness. Therefore, we have:\n$$\nL_{eff} = \\tau L\n$$\nSubstituting this into the expression for the gradient gives:\n$$\n\\left| \\frac{dC}{dx} \\right| = \\frac{\\Delta C}{\\tau L}\n$$\nThe magnitude of the molar flux density through a pore is then:\n$$\nJ_{pore} = D \\left| \\frac{dC}{dx} \\right| = D \\frac{\\Delta C}{\\tau L}\n$$\nThe total molar flux, or flow rate, through a single pore, $\\dot{N}_{pore}$, is the product of the flux density $J_{pore}$ and the cross-sectional area of the pore, $A_{pore}$. The pores are modeled as having a mean geometric radius $r$, so the cross-sectional area of one pore is:\n$$\nA_{pore} = \\pi r^2\n$$\nThus, the molar flux through one pore is:\n$$\n\\dot{N}_{pore} = J_{pore} \\cdot A_{pore} = \\left(D \\frac{\\Delta C}{\\tau L}\\right) (\\pi r^2)\n$$\nNext, we must determine the total molar flux, $\\dot{N}$, across the entire shell surface. The problem states a uniform areal pore density of $n$ (pores per unit surface area) and a total external shell surface area of $A_s$. The total number of pores, $N_{total}$, is therefore the product of the pore density and the total surface area:\n$$\nN_{total} = n A_s\n$$\nThe problem states that the pores are non-interacting, which allows us to calculate the total flux by simply multiplying the flux per pore by the total number of pores. This is a crucial assumption that neglects the potential overlap of diffusion fields near the pore openings. Under this assumption, the total molar flux is:\n$$\n\\dot{N} = N_{total} \\cdot \\dot{N}_{pore} = (n A_s) \\left(D \\frac{\\Delta C}{\\tau L} \\pi r^2\\right)\n$$\nRearranging the terms for clarity, we have:\n$$\n\\dot{N} = \\left(\\frac{\\pi n D r^2 A_s}{\\tau L}\\right) \\Delta C\n$$\nThe problem defines the whole-shell effective molar conductance, $G$, through the linear relation:\n$$\n\\dot{N} = G \\Delta C\n$$\nBy direct comparison of our derived expression for $\\dot{N}$ with the given definition, we can identify the expression for $G$:\n$$\nG = \\frac{\\pi n D r^2 A_s}{\\tau L}\n$$\nThis expression for $G$ is in terms of the specified parameters: $n$, $\\tau$, $D$, $r$, $L$, and $A_s$.\n\nFinally, as a check of consistency, we verify the physical units of our derived expression for $G$. The SI units of the parameters are:\n- $D$ (diffusivity): $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$\n- $r$ (radius): $\\mathrm{m}$\n- $n$ (areal density): $\\mathrm{m}^{-2}$\n- $A_s$ (area): $\\mathrm{m}^2$\n- $L$ (thickness): $\\mathrm{m}$\n- $\\tau$ (tortuosity): dimensionless\n\nThe units of $G$ are therefore:\n$$\n[G] = \\frac{[\\pi] [n] [D] [r^2] [A_s]}{[\\tau] [L]} = \\frac{(1) (\\mathrm{m}^{-2}) (\\mathrm{m}^2\\,\\mathrm{s}^{-1}) (\\mathrm{m}^2) (\\mathrm{m}^2)}{(1) (\\mathrm{m})} = \\frac{\\mathrm{m}^4\\,\\mathrm{s}^{-1}}{\\mathrm{m}} = \\mathrm{m}^3\\,\\mathrm{s}^{-1}\n$$\nThis result is consistent with the units for $G$ specified in the problem statement, which are derived from its definition $G = \\dot{N} / \\Delta C$, where $\\dot{N}$ is in $\\mathrm{mol}\\,\\mathrm{s}^{-1}$ and $\\Delta C$ is in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$. This confirms the physical and dimensional correctness of our derivation. The derived expression is the required closed-form solution.", "answer": "$$\n\\boxed{\\frac{\\pi n D r^2 A_s}{\\tau L}}\n$$", "id": "2572439"}, {"introduction": "Beyond the biophysics of a single egg, evolutionary success is determined by an organism's reproductive strategy. This problem explores the classic life-history trade-off between the number and size of offspring, a decision constrained by a fixed energy budget. Using a mathematical model of survival, you will determine the optimal clutch size that maximizes lifetime reproductive success, illustrating how evolutionary theory can predict organismal strategies. [@problem_id:2572433]", "problem": "In the context of the evolution of the amniotic egg in terrestrial vertebrates, consider a simplified life-history allocation model that captures the core trade-off between offspring size and number under physically plausible survival constraints. A semelparous female (one breeding episode in her lifetime) has a fixed reproductive energy budget $E>0$ to allocate to a single clutch. If the female produces a clutch of $n>0$ eggs and allocates energy equally, then the energy per egg is $s = E/n$. Assume the following two survival components apply to the clutch:\n\n1. Offspring-level survival to independence increases with egg size due to reduced desiccation and improved gas exchange conferred by the amniotic membranes and shell. This is modeled as $p_{\\mathrm{off}}(s) = \\exp\\!\\left(-\\frac{\\delta}{s}\\right)$, where $\\delta>0$ summarizes the sensitivity of embryonic survival to low provisioning.\n2. Nest-level survival decreases with clutch size because larger clutches are more detectable to predators or more vulnerable to microbial growth. This is modeled as $p_{\\mathrm{nest}}(n) = \\exp(-\\beta n)$, with $\\beta>0$ quantifying the per-egg increase in nest hazard.\n\nAssume independence between these two survival components so that expected lifetime reproductive success (expected number of independent juveniles produced over the female’s life) is\n$$\nL(n) \\;=\\; n \\, p_{\\mathrm{off}}\\!\\left(\\frac{E}{n}\\right) \\, p_{\\mathrm{nest}}(n).\n$$\n\nTreat $n$ as a continuous decision variable (ignore integer constraints). Using only the definitions above and standard calculus, compute the clutch size $n^{\\ast}$ that maximizes $L(n)$ and express your final result as a closed-form analytic expression in terms of $E$, $\\delta$, and $\\beta$. Do not include units in your final expression.", "solution": "The problem statement has been validated and is deemed valid. It presents a standard optimization problem rooted in a well-defined and plausible bioeconomic model of life-history trade-offs. The functions and parameters are clearly defined, and the premises are scientifically sound within the context of theoretical biology. There are no contradictions, ambiguities, or missing information. We may proceed with the solution.\n\nThe objective is to maximize the expected lifetime reproductive success, $L(n)$, of a semelparous female with respect to the clutch size, $n$. The function is given as:\n$$\nL(n) = n \\, p_{\\mathrm{off}}\\!\\left(\\frac{E}{n}\\right) \\, p_{\\mathrm{nest}}(n)\n$$\nThe givens are the reproductive energy budget $E > 0$, the clutch size $n > 0$, the energy per egg $s = E/n$, and the survival probabilities:\n$$\np_{\\mathrm{off}}(s) = \\exp\\left(-\\frac{\\delta}{s}\\right)\n$$\n$$\np_{\\mathrm{nest}}(n) = \\exp(-\\beta n)\n$$\nwhere $\\delta > 0$ and $\\beta > 0$ are constants.\n\nFirst, we substitute the expressions for the survival functions into the equation for $L(n)$. The argument of $p_{\\mathrm{off}}$ is $s = E/n$, so we have:\n$$\np_{\\mathrm{off}}\\!\\left(\\frac{E}{n}\\right) = \\exp\\left(-\\frac{\\delta}{E/n}\\right) = \\exp\\left(-\\frac{\\delta n}{E}\\right)\n$$\nTherefore, the function $L(n)$ becomes:\n$$\nL(n) = n \\exp\\left(-\\frac{\\delta n}{E}\\right) \\exp(-\\beta n)\n$$\nBy the property of exponential functions, $\\exp(a)\\exp(b) = \\exp(a+b)$, we can combine the exponents:\n$$\nL(n) = n \\exp\\left(-\\frac{\\delta n}{E} - \\beta n\\right) = n \\exp\\left(-n \\left(\\frac{\\delta}{E} + \\beta\\right)\\right)\n$$\nTo find the value of $n$ that maximizes $L(n)$, we must find the critical points by setting the derivative of $L(n)$ with respect to $n$ to zero. For functions involving products and exponentials, it is often more straightforward to maximize the natural logarithm of the function, $\\ln(L(n))$. Since the natural logarithm is a strictly monotonic increasing function, the value of $n$ that maximizes $\\ln(L(n))$ will also maximize $L(n)$.\n\nLet us define a new function $f(n) = \\ln(L(n))$:\n$$\nf(n) = \\ln\\left(n \\exp\\left(-n \\left(\\frac{\\delta}{E} + \\beta\\right)\\right)\\right)\n$$\nUsing the property $\\ln(ab) = \\ln(a) + \\ln(b)$, we get:\n$$\nf(n) = \\ln(n) + \\ln\\left(\\exp\\left(-n \\left(\\frac{\\delta}{E} + \\beta\\right)\\right)\\right)\n$$\nUsing the property $\\ln(\\exp(x)) = x$, we simplify $f(n)$ to:\n$$\nf(n) = \\ln(n) - n \\left(\\frac{\\delta}{E} + \\beta\\right)\n$$\nNow, we differentiate $f(n)$ with respect to $n$:\n$$\n\\frac{df}{dn} = \\frac{d}{dn} \\left[ \\ln(n) - n \\left(\\frac{\\delta}{E} + \\beta\\right) \\right] = \\frac{1}{n} - \\left(\\frac{\\delta}{E} + \\beta\\right)\n$$\nWe find the optimal clutch size, $n^*$, by setting this derivative to zero:\n$$\n\\frac{1}{n^*} - \\left(\\frac{\\delta}{E} + \\beta\\right) = 0\n$$\nSolving for $n^*$:\n$$\n\\frac{1}{n^*} = \\frac{\\delta}{E} + \\beta\n$$\nTo combine the terms on the right side, we find a common denominator:\n$$\n\\frac{1}{n^*} = \\frac{\\delta + \\beta E}{E}\n$$\nInverting both sides yields the expression for the optimal clutch size:\n$$\nn^* = \\frac{E}{\\delta + \\beta E}\n$$\nTo confirm that this critical point corresponds to a maximum, we apply the second derivative test. We compute the second derivative of $f(n)$:\n$$\n\\frac{d^2f}{dn^2} = \\frac{d}{dn} \\left[ \\frac{1}{n} - \\left(\\frac{\\delta}{E} + \\beta\\right) \\right] = -\\frac{1}{n^2}\n$$\nSince the domain specifies $n > 0$, it follows that $n^2 > 0$. Thus, $\\frac{d^2f}{dn^2}$ is always negative for all $n$ in the domain of the function. This indicates that $f(n)$ is a strictly concave function, and the critical point we found is indeed a unique global maximum.\n\nThe physical constraints $E > 0$, $\\delta > 0$, and $\\beta > 0$ ensure that the optimal clutch size $n^*$ is positive, as required. The problem is solved.", "answer": "$$\n\\boxed{\\frac{E}{\\delta + \\beta E}}\n$$", "id": "2572433"}, {"introduction": "The evolution of novel structures like the amnion and chorion is rooted in changes to developmental programs. This computational exercise puts you at the cutting edge of evolutionary-developmental biology, using synthetic single-cell gene expression data to reconstruct the lineage pathways of differentiating cells. By implementing an algorithm that combines graph theory and marker gene evidence, you will practice the quantitative methods used to unravel the developmental origins of key evolutionary innovations. [@problem_id:2572391]", "problem": "A key evolutionary innovation of amniotes is the emergence of extraembryonic membranes, including the amnion and chorion. In comparative zoology and botany, and particularly in the study of the evolution of the amniotic egg, single-cell RNA sequencing (scRNA-seq) provides a quantitative snapshot of gene expression states that reflect lineage-specific regulatory programs. This problem asks you to formalize lineage trajectory reconstruction into amnion versus chorion from a small, synthetic scRNA-seq dataset using a graph-based pseudotime and a probabilistic fusion of graph and marker evidence, and to validate predictions with partial fate mapping labels. The problem is fully self-contained and purely mathematical: you will implement the specified computations on given numeric arrays and report prediction accuracies.\n\nAssume the following foundations:\n- According to the Central Dogma of molecular biology, gene expression levels of messenger RNA reflect the activity of gene regulatory programs. Cells differentiate along continuous trajectories in gene expression space.\n- A $k$-nearest neighbor graph approximates the low-dimensional manifold of gene expression states. Shortest-path geodesic distances along this graph approximate developmental distances.\n- Marker genes enriched in a lineage provide statistical evidence of fate bias; a Bayesian fusion of independent evidences can be approximated by summing log-odds.\n\nDefine the following for a given test case:\n- Let there be $C$ cells and $G$ genes, with expression matrix $X \\in \\mathbb{R}^{C \\times G}$.\n- Let $A \\subset \\{0,\\dots,G-1\\}$ be the index set of amnion markers and $B \\subset \\{0,\\dots,G-1\\}$ be the index set of chorion markers.\n- Let $E \\subset \\{0,\\dots,C-1\\} \\times \\{0,\\dots,C-1\\}$ be an undirected, unweighted edge set defining a graph on cells; if $(i,j) \\in E$ then there is an edge of weight $1$ connecting $i$ and $j$.\n- Let $r \\in \\{0,\\dots,C-1\\}$ be the root (progenitor) cell index, $t_A \\in \\{0,\\dots,C-1\\}$ the amnion tip index, and $t_C \\in \\{0,\\dots,C-1\\}$ the chorion tip index.\n- Let $L$ be a partial fate map, a function on a subset of cell indices giving labels $1$ for amnion and $0$ for chorion.\n\nYou must implement the following steps to compute a posterior amnion probability $\\hat{p}_i$ for each cell $i$, and validate on labeled cells:\n1. Build an undirected graph with adjacency from $E$. Compute shortest-path distances $d(r,i)$ from the root $r$ to each cell $i$ using breadth-first search. Define pseudotime $s_i = d(r,i) / \\max_j d(r,j)$ for all $i$ with finite distance. Also compute $d(t_A,i)$ and $d(t_C,i)$ for all $i$.\n2. Define a graph-based branch probability toward amnion using a softmax over negative distances:\n$$\np^{\\mathrm{graph}}_i = \\frac{\\exp(-\\beta\\, d(t_A,i))}{\\exp(-\\beta\\, d(t_A,i)) + \\exp(-\\beta\\, d(t_C,i))},\n$$\nwith $\\beta = 1$.\n3. Standardize each gene across cells by a $z$-score with a small numerical stabilizer $\\varepsilon$:\n$$\n\\mu_g = \\frac{1}{C} \\sum_{i=0}^{C-1} X_{i,g}, \\quad\n\\sigma_g = \\sqrt{\\frac{1}{C} \\sum_{i=0}^{C-1} (X_{i,g} - \\mu_g)^2 + \\varepsilon}, \\quad\nZ_{i,g} = \\frac{X_{i,g} - \\mu_g}{\\sigma_g},\n$$\nwith $\\varepsilon = 10^{-6}$.\n4. Compute amnion and chorion marker scores per cell as averages of standardized expression:\n$$\nm^{A}_i = \\frac{1}{|A|} \\sum_{g \\in A} Z_{i,g}, \\quad\nm^{C}_i = \\frac{1}{|B|} \\sum_{g \\in B} Z_{i,g}.\n$$\n5. Map marker evidence to a probability via a logistic function with slope parameter $\\alpha = 1$:\n$$\np^{\\mathrm{mark}}_i = \\sigma\\big(\\alpha \\,(m^{A}_i - m^{C}_i)\\big) = \\frac{1}{1 + \\exp\\big(-\\alpha \\,(m^{A}_i - m^{C}_i)\\big)}.\n$$\n6. Combine independent evidences by summing log-odds (a product-of-experts approximation) to obtain the posterior amnion probability:\n$$\n\\ell^{\\mathrm{graph}}_i = \\log\\frac{p^{\\mathrm{graph}}_i}{1 - p^{\\mathrm{graph}}_i}, \\quad\n\\ell^{\\mathrm{mark}}_i = \\log\\frac{p^{\\mathrm{mark}}_i}{1 - p^{\\mathrm{mark}}_i}, \\quad\n\\hat{p}_i = \\sigma\\big(\\ell^{\\mathrm{graph}}_i + \\ell^{\\mathrm{mark}}_i\\big).\n$$\n7. Predict amnion if $\\hat{p}_i \\ge 0.5$ and chorion otherwise. Let $\\widehat{y}_i \\in \\{0,1\\}$ be the predicted label. On labeled cells $i \\in \\mathrm{dom}(L)$, compute the accuracy\n$$\n\\mathrm{Acc} = \\frac{1}{|\\mathrm{dom}(L)|} \\sum_{i \\in \\mathrm{dom}(L)} \\mathbb{I}[\\widehat{y}_i = L(i)],\n$$\nwhere $\\mathbb{I}[\\cdot]$ is the indicator function. Report this accuracy as a real number in $[0,1]$.\n\nAll quantities are unitless. Angles are not used. The final result for each test case must be rounded to exactly three decimal places.\n\nTest suite:\n- Case $1$ (happy path):\n  - $C = 7$, $G = 4$.\n  - Expression:\n  $$\n  X^{(1)} =\n  \\begin{bmatrix}\n  2 & 2 & 2 & 2\\\\\n  3 & 3 & 2 & 2\\\\\n  4 & 4 & 1 & 1\\\\\n  5 & 5 & 1 & 1\\\\\n  2 & 2 & 3 & 3\\\\\n  1 & 1 & 4 & 4\\\\\n  1 & 1 & 5 & 5\n  \\end{bmatrix}\n  $$\n  - Markers: $A^{(1)} = [0,1]$, $B^{(1)} = [2,3]$.\n  - Graph edges:\n  $$\n  E^{(1)} = \\{(0,1),(1,2),(2,3),(0,4),(4,5),(5,6)\\}.\n  $$\n  - Root and tips: $r^{(1)} = 0$, $t_A^{(1)} = 3$, $t_C^{(1)} = 6$.\n  - Labeled cells:\n  $$\n  L^{(1)} = \\{3 \\mapsto 1,\\; 6 \\mapsto 0,\\; 2 \\mapsto 1,\\; 5 \\mapsto 0\\}.\n  $$\n- Case $2$ (boundary condition with balanced branches and mixed markers):\n  - $C = 5$, $G = 4$.\n  - Expression:\n  $$\n  X^{(2)} =\n  \\begin{bmatrix}\n  2 & 2 & 2 & 2\\\\\n  3 & 3 & 2 & 2\\\\\n  4 & 3 & 2 & 2\\\\\n  2 & 2 & 3 & 3\\\\\n  2 & 2 & 4 & 3\n  \\end{bmatrix}\n  $$\n  - Markers: $A^{(2)} = [0,1]$, $B^{(2)} = [2,3]$.\n  - Graph edges:\n  $$\n  E^{(2)} = \\{(0,1),(1,2),(0,3),(3,4)\\}.\n  $$\n  - Root and tips: $r^{(2)} = 0$, $t_A^{(2)} = 2$, $t_C^{(2)} = 4$.\n  - Labeled cells:\n  $$\n  L^{(2)} = \\{2 \\mapsto 1,\\; 4 \\mapsto 0\\}.\n  $$\n- Case $3$ (edge case with ambiguous early marker signal but asymmetric branch lengths):\n  - $C = 6$, $G = 4$.\n  - Expression:\n  $$\n  X^{(3)} =\n  \\begin{bmatrix}\n  2 & 2 & 2 & 2\\\\\n  3 & 3 & 3 & 3\\\\\n  5 & 4 & 2 & 2\\\\\n  2 & 2 & 3 & 3\\\\\n  1 & 1 & 4 & 4\\\\\n  1 & 1 & 5 & 5\n  \\end{bmatrix}\n  $$\n  - Markers: $A^{(3)} = [0,1]$, $B^{(3)} = [2,3]$.\n  - Graph edges:\n  $$\n  E^{(3)} = \\{(0,1),(1,2),(0,3),(3,4),(4,5)\\}.\n  $$\n  - Root and tips: $r^{(3)} = 0$, $t_A^{(3)} = 2$, $t_C^{(3)} = 5$.\n  - Labeled cells:\n  $$\n  L^{(3)} = \\{2 \\mapsto 1,\\; 5 \\mapsto 0,\\; 1 \\mapsto 1\\}.\n  $$\n\nYour program must implement the above definitions exactly and use $\\varepsilon = 10^{-6}$, $\\alpha = 1$, and $\\beta = 1$. The required final output format is a single line containing a Python-style list with the accuracies for cases $1$, $2$, and $3$, rounded to three decimal places, as:\n\"[a1,a2,a3]\".", "solution": "The problem statement is critically evaluated and determined to be valid. It is scientifically grounded in established principles of computational biology, well-posed with a clear, deterministic algorithmic structure, and expressed in objective, mathematical language. It is a self-contained computational problem with all necessary data and parameters provided. There are no identifiable flaws such as scientific unsoundness, ambiguity, or contradiction.\n\nThe solution proceeds by implementing the specified multi-step procedure to analyze synthetic single-cell gene expression data. The objective is to reconstruct a bifurcating lineage trajectory, assign cells to either an amnion or chorion fate, and calculate the prediction accuracy against a provided partial truth set.\n\nThe implementation is structured as follows:\n\n1.  **Graph Representation and Distance Calculation**: An undirected graph is constructed from the given edge set $E$ using an adjacency list representation. Shortest-path distances from the root ($r$), amnion tip ($t_A$), and chorion tip ($t_C$) to all other cells are computed. As the graph is unweighted, Breadth-First Search (BFS) is the appropriate algorithm for this task. A BFS implementation utilizing a queue computes the distances $d(r,i)$, $d(t_A,i)$, and $d(t_C,i)$ for each cell $i$.\n\n2.  **Graph-Based Branch Probability**: The distances to the two lineage tips, $t_A$ and $t_C$, are used to define a cell's bias toward the amnion branch. The graph-based probability, $p^{\\mathrm{graph}}_i$, is calculated using the softmax function on the negative distances, with the specified parameter $\\beta=1$:\n    $$\n    p^{\\mathrm{graph}}_i = \\frac{\\exp(-\\beta\\, d(t_A,i))}{\\exp(-\\beta\\, d(t_A,i)) + \\exp(-\\beta\\, d(t_C,i))}\n    $$\n    This value reflects a cell's relative geodesic proximity to the amnion tip versus the chorion tip within the developmental manifold approximated by the graph.\n\n3.  **Gene Expression Standardization**: The raw gene expression matrix $X$ is standardized to account for differences in measurement scale across genes. For each gene $g$, its expression values across all cells $C$ are converted to $Z$-scores. The population mean $\\mu_g$ and population standard deviation $\\sigma_g$ are calculated. A small stabilizer $\\varepsilon = 10^{-6}$ is added to the variance before taking the square root to prevent division by zero for genes with no variation. The standardized expression $Z_{i,g}$ for cell $i$ and gene $g$ is:\n    $$\n    Z_{i,g} = \\frac{X_{i,g} - \\mu_g}{\\sigma_g}\n    $$\n\n4.  **Marker-Based Score and Probability**: Evidence from marker gene expression is quantified. For each cell $i$, an amnion score $m^A_i$ and a chorion score $m^C_i$ are computed by averaging the standardized expression levels of the respective marker genes defined by index sets $A$ and $B$.\n    $$\n    m^{A}_i = \\frac{1}{|A|} \\sum_{g \\in A} Z_{i,g}, \\quad\n    m^{C}_i = \\frac{1}{|B|} \\sum_{g \\in B} Z_{i,g}.\n    $$\n    The difference between these scores, $m^A_i - m^C_i$, represents the net marker evidence for the amnion fate. This score is transformed into a probability, $p^{\\mathrm{mark}}_i$, using the logistic (sigmoid) function $\\sigma(\\cdot)$ with parameter $\\alpha=1$:\n    $$\n    p^{\\mathrm{mark}}_i = \\sigma\\big(\\alpha \\,(m^{A}_i - m^{C}_i)\\big)\n    $$\n\n5.  **Evidence Fusion**: The graph-based evidence and marker-based evidence are assumed to be independent and are fused probabilistically. This is achieved by summing their log-odds (logits), which is equivalent to a product of experts in probability space. The logit transformation for a probability $p$ is $\\ell = \\log(p / (1-p))$. The total log-odds is the sum of the individual log-odds:\n    $$\n    \\ell^{\\mathrm{total}}_i = \\ell^{\\mathrm{graph}}_i + \\ell^{\\mathrm{mark}}_i\n    $$\n    The final posterior probability of a cell belonging to the amnion lineage, $\\hat{p}_i$, is obtained by transforming the total log-odds back to a probability using the sigmoid function:\n    $$\n    \\hat{p}_i = \\sigma(\\ell^{\\mathrm{total}}_i)\n    $$\n    For numerical stability, probabilities are clipped to a small distance from $0$ and $1$ before applying the logit function.\n\n6.  **Prediction and Accuracy Assessment**: A final fate prediction $\\widehat{y}_i$ is made for each cell. If the posterior amnion probability $\\hat{p}_i$ is greater than or equal to $0.5$, the cell is classified as amnion ($\\widehat{y}_i=1$); otherwise, it is classified as chorion ($\\widehat{y}_i=0$). The performance of this classification is evaluated by computing the accuracy on the subset of cells for which true fate labels are provided in the map $L$. The accuracy is the fraction of correctly predicted labels:\n    $$\n    \\mathrm{Acc} = \\frac{1}{|\\mathrm{dom}(L)|} \\sum_{i \\in \\mathrm{dom}(L)} \\mathbb{I}[\\widehat{y}_i = L(i)]\n    $$\n    The final accuracy for each test case is reported, rounded to three decimal places.", "answer": "```python\nimport numpy as np\nfrom collections import deque\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute results.\n    \"\"\"\n    \n    # Case 1 (happy path)\n    X1 = np.array([\n        [2, 2, 2, 2], [3, 3, 2, 2], [4, 4, 1, 1], [5, 5, 1, 1],\n        [2, 2, 3, 3], [1, 1, 4, 4], [1, 1, 5, 5]\n    ], dtype=float)\n    A1, B1 = [0, 1], [2, 3]\n    E1 = {(0, 1), (1, 2), (2, 3), (0, 4), (4, 5), (5, 6)}\n    r1, t_A1, t_C1 = 0, 3, 6\n    L1 = {3: 1, 6: 0, 2: 1, 5: 0}\n    \n    # Case 2 (boundary condition with balanced branches and mixed markers)\n    X2 = np.array([\n        [2, 2, 2, 2], [3, 3, 2, 2], [4, 3, 2, 2],\n        [2, 2, 3, 3], [2, 2, 4, 3]\n    ], dtype=float)\n    A2, B2 = [0, 1], [2, 3]\n    E2 = {(0, 1), (1, 2), (0, 3), (3, 4)}\n    r2, t_A2, t_C2 = 0, 2, 4\n    L2 = {2: 1, 4: 0}\n    \n    # Case 3 (edge case with ambiguous early marker signal but asymmetric branch lengths)\n    X3 = np.array([\n        [2, 2, 2, 2], [3, 3, 3, 3], [5, 4, 2, 2],\n        [2, 2, 3, 3], [1, 1, 4, 4], [1, 1, 5, 5]\n    ], dtype=float)\n    A3, B3 = [0, 1], [2, 3]\n    E3 = {(0, 1), (1, 2), (0, 3), (3, 4), (4, 5)}\n    r3, t_A3, t_C3 = 0, 2, 5\n    L3 = {2: 1, 5: 0, 1: 1}\n\n    test_cases = [\n        (X1, A1, B1, E1, r1, t_A1, t_C1, L1),\n        (X2, A2, B2, E2, r2, t_A2, t_C2, L2),\n        (X3, A3, B3, E3, r3, t_A3, t_C3, L3)\n    ]\n\n    results = []\n    for case in test_cases:\n        accuracy = solve_case(*case)\n        results.append(accuracy)\n\n    # Format the final output string as specified.\n    print(f\"[{','.join([f'{r:.3f}' for r in results])}]\")\n\ndef sigmoid(x):\n    \"\"\"Computes the sigmoid function.\"\"\"\n    return 1 / (1 + np.exp(-x))\n\ndef solve_case(X, A, B, E, r, t_A, t_C, L):\n    \"\"\"\n    Solves a single test case according to the problem description.\n    \"\"\"\n    C, G = X.shape\n\n    # Step 1: Build graph and compute shortest-path distances using BFS\n    adj = {i: [] for i in range(C)}\n    for u, v in E:\n        adj[u].append(v)\n        adj[v].append(u)\n\n    def bfs(start_node):\n        q = deque([(start_node, 0)])\n        dists = {i: float('inf') for i in range(C)}\n        if start_node in dists:\n            dists[start_node] = 0\n        \n        visited = {start_node}\n        while q:\n            u, d = q.popleft()\n            for v in adj.get(u, []):\n                if v not in visited:\n                    visited.add(v)\n                    dists[v] = d + 1\n                    q.append((v, d + 1))\n        return np.array([dists[i] for i in range(C)])\n\n    dist_A = bfs(t_A)\n    dist_C = bfs(t_C)\n    \n    # Step 2: Define graph-based branch probability\n    beta = 1.0\n    exp_neg_dist_A = np.exp(-beta * dist_A)\n    exp_neg_dist_C = np.exp(-beta * dist_C)\n    p_graph = exp_neg_dist_A / (exp_neg_dist_A + exp_neg_dist_C)\n\n    # Step 3: Standardize gene expression (z-score)\n    epsilon = 1e-6\n    mu_g = X.mean(axis=0)\n    # Using np.var is equivalent to np.mean((X - mu_g)**2, axis=0)\n    sigma_g = np.sqrt(np.var(X, axis=0) + epsilon)\n    Z = (X - mu_g) / sigma_g\n\n    # Step 4: Compute marker scores\n    m_A = Z[:, A].mean(axis=1) if len(A) > 0 else np.zeros(C)\n    m_C = Z[:, B].mean(axis=1) if len(B) > 0 else np.zeros(C)\n\n    # Step 5: Map marker evidence to a probability\n    alpha = 1.0\n    p_mark = sigmoid(alpha * (m_A - m_C))\n\n    # Step 6: Combine independent evidences by summing log-odds\n    # Clip for numerical stability if probabilities are close to 0 or 1.\n    p_graph_c = np.clip(p_graph, 1e-15, 1 - 1e-15)\n    p_mark_c = np.clip(p_mark, 1e-15, 1 - 1e-15)\n\n    # logit(p) = log(p/(1-p)) = log(p) - log(1-p)\n    # np.log1p(x) computes log(1+x) accurately for small x.\n    # So, np.log(1-p) is np.log1p(-p).\n    l_graph = np.log(p_graph_c) - np.log1p(-p_graph_c)\n    l_mark = np.log(p_mark_c) - np.log1p(-p_mark_c)\n    \n    p_hat = sigmoid(l_graph + l_mark)\n\n    # Step 7: Predict and compute accuracy\n    predictions = (p_hat >= 0.5).astype(int)\n    \n    labeled_indices = list(L.keys())\n    if not labeled_indices:\n        return 1.0\n\n    true_labels = np.array([L[i] for i in labeled_indices])\n    predicted_labels = predictions[labeled_indices]\n    \n    accuracy = np.mean(predicted_labels == true_labels)\n    \n    return accuracy\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "2572391"}]}