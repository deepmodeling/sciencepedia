{"hands_on_practices": [{"introduction": "We begin our practical exploration with the principle of maximum parsimony, a cornerstone of ancestral state reconstruction that favors the simplest evolutionary scenario. This exercise applies the classic Fitch algorithm to a discrete binary character, a method designed to find the minimum number of evolutionary changes required to explain the observed states at the tips of a phylogeny. By working through this fundamental example, you will develop a hands-on understanding of how to determine possible ancestral states and quantify the parsimony score for a given tree and character distribution.", "problem": "In comparative zoology and botany, ancestral state reconstruction under maximum parsimony seeks to infer ancestral character states that minimize the total number of changes on a phylogeny. Consider a binary character that is unordered, meaning transitions $0 \\leftrightarrow 1$ each have equal cost. You are given a rooted three-taxon tree with topology $((A,B),C)$, where the observed tip states are $A=0$, $B=1$, and $C=1$. Using the parsimony criterion and the Fitch algorithm, determine the set of all possible ancestral state sets at the two internal nodes: the internal node uniting $A$ and $B$ (call this node $v$), and the root uniting $(A,B)$ with $C$ (call this node $r$). Then compute the minimal total number of state changes implied on the tree under this reconstruction. Report as your final answer the minimal total number of changes as a single integer. No rounding is required.", "solution": "The foundational principle is the maximum parsimony criterion: among all assignments of ancestral character states consistent with the observed tip states, choose those that minimize the total number of state changes. For unordered binary characters, transitions $0 \\to 1$ and $1 \\to 0$ each have the same cost, taken as $1$, and there is no directionality bias.\n\nThe Fitch algorithm provides a constructive procedure to compute, for each internal node, a set of possible states that can be assigned without increasing the minimal number of steps, and simultaneously yields the minimal number of changes. The algorithm proceeds in two passes.\n\nUpward pass (postorder) to compute ancestral state sets and count changes:\n- For leaves, assign the observed singleton sets: $S_A=\\{0\\}$, $S_B=\\{1\\}$, $S_C=\\{1\\}$.\n- Consider the internal node $v$ uniting $A$ and $B$. Compute $S_v$ as the intersection of child sets if nonempty; otherwise the union. Here, $S_A \\cap S_B = \\{0\\} \\cap \\{1\\} = \\varnothing$, so the intersection is empty. Therefore, assign $S_v = S_A \\cup S_B = \\{0,1\\}$ and increment the parsimony step count by $1$ due to the empty intersection at this node.\n- Consider the root node $r$ uniting $v$ and $C$. We have $S_v=\\{0,1\\}$ and $S_C=\\{1\\}$. The intersection is $S_v \\cap S_C = \\{0,1\\} \\cap \\{1\\} = \\{1\\}$, which is nonempty. Therefore, assign $S_r=\\{1\\}$ and do not increment the step count at this node.\n\nThe upward pass yields the ancestral state sets $S_v=\\{0,1\\}$ and $S_r=\\{1\\}$. The total minimal number of changes accumulated from empty intersections is $1$.\n\nDownward pass (preorder) to realize one minimal assignment and verify the step count:\n- Choose any state from $S_r$ for the root; here $S_r=\\{1\\}$, so set the root to $1$.\n- For the child $v$ with $S_v=\\{0,1\\}$, choose a state that minimizes change along edge $(r,v)$. Choosing state $1$ at $v$ matches the parent and incurs $0$ changes on $(r,v)$.\n- Propagate to leaves: from $v=1$ to $B=1$ no change on $(v,B)$; from $v=1$ to $A=0$ one change on $(v,A)$.\n\nThis explicit assignment realizes exactly $1$ change, matching the count from the upward pass. By the parsimony principle and the Fitch algorithm, this is the minimal possible number of changes.\n\nTherefore, the ancestral state sets at the internal nodes are $S_v=\\{0,1\\}$ and $S_r=\\{1\\}$, and the minimal total number of changes is $1$.", "answer": "$$\\boxed{1}$$", "id": "2545589"}, {"introduction": "Moving from discrete characters and parsimony, we now turn to the probabilistic reconstruction of continuous traits, such as body size or physiological measurements. This practice explores the Brownian motion model of evolution, where trait change is modeled as a random walk through time. You will apply the principles of maximum likelihood to derive the ancestral state estimate and its associated variance for a continuous character, learning how this framework explicitly incorporates information from branch lengths to infer ancestral values and quantify their uncertainty.", "problem": "Consider a continuous trait evolving under a Brownian motion model on a rooted phylogeny with topology $\\big((A:1, B:1):1, C:2\\big)$. Under Brownian motion, conditional on the parent state, the change along a branch of length $t$ is Gaussian with mean $0$ and variance $\\sigma^{2} t$, and changes on distinct branches are independent. Assume a flat (improper uniform) prior for the root state, so that the joint distribution of all node states is obtained by compounding these Gaussian increments without introducing additional information at the root. The observed tip trait values are $A=2.0$, $B=3.0$, and $C=5.0$, and the diffusion rate is $\\sigma^{2}=1$.\n\nUsing only the stated Brownian motion assumptions and the properties of multivariate Gaussian distributions and conditional independence on trees, derive from first principles the maximum likelihood estimate (equivalently, the posterior mean under the flat root prior) and the associated conditional variance for the ancestral trait at the internal node that is the most recent common ancestor of $A$ and $B$. Express your final answer as exact rational numbers with no rounding and provide both the estimate and the variance together, in that order, as a single row vector. No units are required.", "solution": "Let the nodes be denoted as follows: $A$, $B$, $C$ for the tips, $D$ for the MRCA of $A$ and $B$, and $R$ for the root of the tree. The states at these nodes are $x_A$, $x_B$, $x_C$, $x_D$, and $x_R$. The observed tip data are $x_A=2$, $x_B=3$, and $x_C=5$. The diffusion rate is $\\sigma^2=1$.\n\nThe problem can be solved using the framework of generalized least squares (GLS) for phylogenetic data. The vector of observed tip states, $X = \\begin{pmatrix} x_A & x_B & x_C \\end{pmatrix}^T = \\begin{pmatrix} 2 & 3 & 5 \\end{pmatrix}^T$, follows a multivariate normal distribution. Under a Brownian motion model with a fixed root state $x_R$, the expected value of the tip states is $\\mathbb{E}[X] = x_R \\mathbf{1}$, where $\\mathbf{1}$ is a column vector of ones. The assumption of a flat prior on the root state is equivalent to estimating $x_R$ from the data.\n\nFirst, we must construct the phylogenetic variance-covariance matrix, $V$. The element $V_{ij}$ is the product of the diffusion rate $\\sigma^2$ and the shared path length from the root to the most recent common ancestor of tips $i$ and $j$. Given the tree `((A:1, B:1):1, C:2)`, the root $R$ is at time $0$. The node $D$ is at time $t_{RD}=1$. The tips $A$ and $B$ are at time $1+1=2$, and tip $C$ is at time $2$.\nThe elements of $V$ are:\n$V_{AA} = \\sigma^2 \\times (\\text{time from root to A}) = 1 \\times (t_{RD} + t_{DA}) = 1 \\times (1+1) = 2$.\n$V_{BB} = \\sigma^2 \\times (\\text{time from root to B}) = 1 \\times (t_{RD} + t_{DB}) = 1 \\times (1+1) = 2$.\n$V_{CC} = \\sigma^2 \\times (\\text{time from root to C}) = 1 \\times t_{RC} = 1 \\times 2 = 2$.\n$V_{AB} = \\sigma^2 \\times (\\text{time from root to MRCA}(A,B)) = 1 \\times (\\text{time of node D}) = 1 \\times 1 = 1$.\n$V_{AC} = \\sigma^2 \\times (\\text{time from root to MRCA}(A,C)) = 1 \\times (\\text{time of node R}) = 1 \\times 0 = 0$.\n$V_{BC} = \\sigma^2 \\times (\\text{time from root to MRCA}(B,C)) = 1 \\times (\\text{time of node R}) = 1 \\times 0 = 0$.\n\nThus, the matrix $V$ is:\n$$V = \\begin{pmatrix} 2 & 1 & 0 \\\\ 1 & 2 & 0 \\\\ 0 & 0 & 2 \\end{pmatrix}$$\nNext, we find the inverse, $V^{-1}$. The matrix is block-diagonal.\nThe inverse of the top-left $2 \\times 2$ block $\\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}$ is $\\frac{1}{2 \\cdot 2 - 1 \\cdot 1} \\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix} 2 & -1 \\\\ -1 & 2 \\end{pmatrix}$.\nThe inverse of the bottom-right $1 \\times 1$ block $[2]$ is $[1/2]$.\nSo,\n$$V^{-1} = \\begin{pmatrix} 2/3 & -1/3 & 0 \\\\ -1/3 & 2/3 & 0 \\\\ 0 & 0 & 1/2 \\end{pmatrix}$$\nThe posterior mean of an ancestral state $x_i$ (which is equivalent to the ML estimate), given the tip data $X$, is given by the formula:\n$$\\hat{x}_i = \\hat{x}_R + \\mathbf{c}_i^T V^{-1}(X - \\hat{x}_R \\mathbf{1})$$\nwhere $\\hat{x}_R$ is the GLS estimate of the root state, and $\\mathbf{c}_i$ is the vector of covariances between node $i$ and the tips.\nThe GLS estimate of the root state is:\n$$\\hat{x}_R = \\frac{\\mathbf{1}^T V^{-1} X}{\\mathbf{1}^T V^{-1} \\mathbf{1}}$$\nWe calculate the components:\n$\\mathbf{1}^T V^{-1} = \\begin{pmatrix} 1 & 1 & 1 \\end{pmatrix} \\begin{pmatrix} 2/3 & -1/3 & 0 \\\\ -1/3 & 2/3 & 0 \\\\ 0 & 0 & 1/2 \\end{pmatrix} = \\begin{pmatrix} 1/3 & 1/3 & 1/2 \\end{pmatrix}$.\n$\\mathbf{1}^T V^{-1} \\mathbf{1} = \\begin{pmatrix} 1/3 & 1/3 & 1/2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = 1/3 + 1/3 + 1/2 = 2/3 + 1/2 = 7/6$.\n$\\mathbf{1}^T V^{-1} X = \\begin{pmatrix} 1/3 & 1/3 & 1/2 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 3 \\\\ 5 \\end{pmatrix} = 2/3 + 3/3 + 5/2 = 2/3 + 1 + 5/2 = 4/6 + 6/6 + 15/6 = 25/6$.\nSo, $\\hat{x}_R = \\frac{25/6}{7/6} = 25/7$.\n\nNow, we find the estimate for node $D$, $\\hat{x}_D$. We need the covariance vector $\\mathbf{c}_D$ between node $D$ and the tips $A,B,C$:\n$c_{DA} = \\sigma^2 \\times (\\text{time from root to MRCA}(D,A)=D) = 1 \\times 1 = 1$.\n$c_{DB} = \\sigma^2 \\times (\\text{time from root to MRCA}(D,B)=D) = 1 \\times 1 = 1$.\n$c_{DC} = \\sigma^2 \\times (\\text{time from root to MRCA}(D,C)=R) = 1 \\times 0 = 0$.\nSo, $\\mathbf{c}_D = \\begin{pmatrix} 1 & 1 & 0 \\end{pmatrix}^T$.\n\nWe calculate the term $\\mathbf{c}_D^T V^{-1}$:\n$\\mathbf{c}_D^T V^{-1} = \\begin{pmatrix} 1 & 1 & 0 \\end{pmatrix} \\begin{pmatrix} 2/3 & -1/3 & 0 \\\\ -1/3 & 2/3 & 0 \\\\ 0 & 0 & 1/2 \\end{pmatrix} = \\begin{pmatrix} 1/3 & 1/3 & 0 \\end{pmatrix}$.\nThe correction term is $\\mathbf{c}_D^T V^{-1}(X - \\hat{x}_R \\mathbf{1})$:\n$X - \\hat{x}_R \\mathbf{1} = \\begin{pmatrix} 2 \\\\ 3 \\\\ 5 \\end{pmatrix} - \\frac{25}{7}\\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 14/7 - 25/7 \\\\ 21/7 - 25/7 \\\\ 35/7 - 25/7 \\end{pmatrix} = \\begin{pmatrix} -11/7 \\\\ -4/7 \\\\ 10/7 \\end{pmatrix}$.\n$\\mathbf{c}_D^T V^{-1}(X - \\hat{x}_R \\mathbf{1}) = \\begin{pmatrix} 1/3 & 1/3 & 0 \\end{pmatrix} \\begin{pmatrix} -11/7 \\\\ -4/7 \\\\ 10/7 \\end{pmatrix} = -\\frac{11}{21} - \\frac{4}{21} = -\\frac{15}{21} = -\\frac{5}{7}$.\nFinally, $\\hat{x}_D = \\hat{x}_R + (-\\frac{5}{7}) = 25/7 - 5/7 = 20/7$.\n\nNext, we calculate the conditional variance of the estimate for $x_D$. The formula is:\n$$\\text{Var}(x_D | X) = \\sigma^2 T_D - \\mathbf{c}_D^T V^{-1} \\mathbf{c}_D + \\frac{(1 - \\mathbf{1}^T V^{-1} \\mathbf{c}_D)^2}{\\mathbf{1}^T V^{-1} \\mathbf{1}}$$\nHere, $T_D$ is the time from the root to node $D$, which is $1$. So $\\sigma^2 T_D = 1$.\nWe compute the new terms:\n$\\mathbf{c}_D^T V^{-1} \\mathbf{c}_D = \\begin{pmatrix} 1/3 & 1/3 & 0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} = 1/3 + 1/3 = 2/3$.\n$\\mathbf{1}^T V^{-1} \\mathbf{c}_D = \\begin{pmatrix} 1/3 & 1/3 & 1/2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\end{pmatrix} = 1/3 + 1/3 = 2/3$.\nThe numerator of the last term is $(1 - 2/3)^2 = (1/3)^2 = 1/9$.\nThe denominator is $\\mathbf{1}^T V^{-1} \\mathbf{1} = 7/6$.\nPutting it together:\n$\\text{Var}(x_D | X) = 1 - 2/3 + \\frac{1/9}{7/6} = 1/3 + \\frac{1}{9} \\cdot \\frac{6}{7} = 1/3 + \\frac{2}{21} = \\frac{7}{21} + \\frac{2}{21} = \\frac{9}{21} = \\frac{3}{7}$.\n\nThe maximum likelihood estimate for the state at node $D$ is $20/7$, and its conditional variance is $3/7$.", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{20}{7} & \\frac{3}{7} \\end{pmatrix}}$$", "id": "2545572"}, {"introduction": "Beyond simply estimating ancestral states, phylogenetic comparative methods provide a powerful framework for testing hypotheses about the evolutionary process itself. This final practice introduces the likelihood ratio test (LRT), a fundamental statistical tool for model selection. By comparing the fit of a simple, symmetric model of evolution to a more complex, asymmetric model, you will learn how to formally test for directional trends or biases in trait evolution, a critical skill for making robust evolutionary inferences.", "problem": "A binary trait evolves on a fixed, ultrametric phylogeny under a continuous-time Markov chain with instantaneous rate matrix $Q$ and tip states observed without error. Consider the nested pair of models: a symmetric model $M_{0}$, where $q_{01} = q_{10}$, and an asymmetric model $M_{1}$, where $q_{01} \\neq q_{10}$. Assume the root state frequencies are given by the stationary distribution implied by $Q$, and that likelihoods are computed exactly by summing over all possible ancestral states using Felsensteinâ€™s pruning recursion.\n\nYou are given a rooted phylogeny with five taxa and branch lengths (in arbitrary time units): $((A:0.40,B:0.40):0.20,(C:0.30,(D:0.20,E:0.20):0.10):0.30);$ The observed tip states are $A=0$, $B=1$, $C=0$, $D=1$, $E=1$. Maximum likelihood optimization under $M_{0}$ and $M_{1}$ yields the following maximized log-likelihood values: $\\widehat{\\ell}_{0} = -29.842$ for $M_{0}$ and $\\widehat{\\ell}_{1} = -27.314$ for $M_{1}$. The corresponding maximum likelihood estimates of the rate parameters are $\\widehat{q} = 0.73$ for $M_{0}$, and $(\\widehat{q}_{01}, \\widehat{q}_{10}) = (1.10, 0.42)$ for $M_{1}$.\n\nUsing only fundamental definitions of likelihood for continuous-time Markov processes on trees and standard large-sample likelihood theory for nested models, construct the likelihood ratio test comparing $M_{0}$ versus $M_{1}$. Identify the approximate null distribution of the test statistic under regularity conditions and compute the numerical value of the test statistic $2\\Delta \\ell$. Round your final numerical answer for $2\\Delta \\ell$ to four significant figures.", "solution": "The problem requires the construction of a likelihood ratio test to compare two nested models of trait evolution, the identification of the null distribution of the test statistic, and the calculation of its value.\n\nThe two models under consideration describe the evolution of a binary trait ($0$ or $1$) along a phylogeny as a continuous-time Markov process.\nThe null model, $M_{0}$, is a symmetric model where the rate of changing from state $0$ to state $1$, $q_{01}$, is equal to the rate of changing from state $1$ to state $0$, $q_{10}$. We can define a single rate parameter $q = q_{01} = q_{10}$. The number of free rate parameters for this model is $k_{0} = 1$. The instantaneous rate matrix $Q$ for this model is:\n$$\nQ = \\begin{pmatrix} -q & q \\\\ q & -q \\end{pmatrix}\n$$\n\nThe alternative model, $M_{1}$, is an asymmetric model where the two rates are allowed to differ, i.e., $q_{01} \\neq q_{10}$. This model has two free rate parameters, $q_{01}$ and $q_{10}$. The number of free parameters for this model is $k_{1} = 2$. The instantaneous rate matrix $Q$ for this model is:\n$$\nQ = \\begin{pmatrix} -q_{01} & q_{01} \\\\ q_{10} & -q_{10} \\end{pmatrix}\n$$\n\nModel $M_{0}$ is a special case of model $M_{1}$ where the constraint $q_{01} = q_{10}$ is imposed. Therefore, the models are nested, which is a prerequisite for the application of the likelihood ratio test (LRT).\n\nThe likelihood ratio test statistic, here denoted as $2\\Delta \\ell$, is defined as twice the difference between the maximized log-likelihood of the more complex (alternative) model and the maximized log-likelihood of the simpler (null) model.\nLet $L_{0}$ be the maximum likelihood under model $M_{0}$ and $L_{1}$ be the maximum likelihood under model $M_{1}$. The log-likelihoods are $\\widehat{\\ell}_{0} = \\ln(L_{0})$ and $\\widehat{\\ell}_{1} = \\ln(L_{1})$, respectively. The test statistic is given by:\n$$\n2\\Delta \\ell = 2(\\widehat{\\ell}_{1} - \\widehat{\\ell}_{0}) = 2 \\ln \\left(\\frac{L_{1}}{L_{0}}\\right)\n$$\nSince $M_{1}$ is less constrained than $M_{0}$, it will always fit the data at least as well, meaning $\\widehat{\\ell}_{1} \\ge \\widehat{\\ell}_{0}$, and thus $2\\Delta \\ell \\ge 0$.\n\nAccording to Wilks' theorem, for large sample sizes and under certain regularity conditions (which are generally assumed to hold for such phylogenetic models), the distribution of the LRT statistic under the null hypothesis ($H_{0}: M_{0}$ is the true model) asymptotically approaches a chi-squared ($\\chi^2$) distribution. The degrees of freedom ($df$) of this distribution are equal to the difference in the number of free parameters between the alternative and null models:\n$$\ndf = k_{1} - k_{0}\n$$\nIn this problem, the number of parameters for $M_{1}$ is $k_{1}=2$ (corresponding to $q_{01}$ and $q_{10}$) and for $M_{0}$ is $k_{0}=1$ (corresponding to $q$). Therefore, the degrees of freedom are:\n$$\ndf = 2 - 1 = 1\n$$\nThus, the approximate null distribution of the test statistic $2\\Delta \\ell$ is a chi-squared distribution with $1$ degree of freedom, denoted $\\chi^2_1$.\n\nWe are given the maximized log-likelihood values from the analysis:\n- For the null model $M_{0}$: $\\widehat{\\ell}_{0} = -29.842$\n- For the alternative model $M_{1}$: $\\widehat{\\ell}_{1} = -27.314$\n\nWe can now compute the numerical value of the test statistic $2\\Delta \\ell$:\n$$\n2\\Delta \\ell = 2(\\widehat{\\ell}_{1} - \\widehat{\\ell}_{0}) = 2(-27.314 - (-29.842))\n$$\n$$\n2\\Delta \\ell = 2(-27.314 + 29.842)\n$$\n$$\n2\\Delta \\ell = 2(2.528)\n$$\n$$\n2\\Delta \\ell = 5.056\n$$\nThe problem requires the answer to be rounded to four significant figures. The calculated value $5.056$ already has four significant figures.\nThe provided information regarding the specific phylogeny, branch lengths, tip states, and the maximum likelihood estimates of the rate parameters $(\\widehat{q}=0.73, (\\widehat{q}_{01}, \\widehat{q}_{10}) = (1.10, 0.42))$ is essential for establishing the context and validity of the problem, but only the maximized log-likelihoods are needed for the final calculation.", "answer": "$$\n\\boxed{5.056}\n$$", "id": "2545588"}]}