{"hands_on_practices": [{"introduction": "The successful propagation of the cardiac impulse from one cell to the next is a fundamental requirement for a coordinated heartbeat. This process depends on whether an excited cell can provide sufficient electrical current to bring its downstream neighbor to the threshold for excitation. This exercise introduces the \"conduction safety factor\" as a quantitative measure of this source-load relationship, helping to formalize why conduction can be robust or fail under certain conditions. By deriving and calculating this factor, you will gain a deeper, quantitative understanding of how cellular properties dictate the success or failure of propagation, a critical concept in the genesis of conduction block. [@problem_id:2555267]", "problem": "Consider two identical ventricular myocytes coupled end-to-end by a gap junction (GJ) of conductance $G_{j}$. Cell $1$ experiences an action potential upstroke that instantaneously raises its membrane potential from $-80\\,\\mathrm{mV}$ to $+20\\,\\mathrm{mV}$ and maintains this depolarization for a duration that is long compared to the downstream charging time constant. Cell $2$ is initially at $-80\\,\\mathrm{mV}$. Assume that, over the brief interval relevant to charge transfer to threshold, ionic leak of cell $2$ is negligible compared to the junctional pathway, so that the downstream cell can be modeled as a capacitor of capacitance $C_{m}$ charged by the upstream cell (a Thevenin source) through the gap junctional conductance $G_j$.\n\nDefine the conduction safety factor as the ratio of source current to load requirement, where the source current is the junctional current initially available to drive cell $2$ and the load requirement is the minimum average current that, when applied over the dominant charging time constant of cell $2$, would deliver the threshold charge $Q_{\\mathrm{th}}$ needed for excitation. Starting only from the capacitor relation $I = C \\frac{dV}{dt}$ and Ohm’s law $I = G \\Delta V$, derive an expression for the safety factor in terms of $C_{m}$, $G_{j}$, $Q_{\\mathrm{th}}$, and the initial driving voltage difference $\\Delta V$ between the cells at the moment of upstroke, and then evaluate it numerically for the following parameters:\n- $C_{m} = 120\\,\\mathrm{pF}$,\n- $G_{j} = 20\\,\\mathrm{nS}$,\n- $Q_{\\mathrm{th}} = 2.4\\,\\mathrm{pC}$,\n- $\\Delta V = 100\\,\\mathrm{mV}$.\n\nExpress the safety factor as a dimensionless decimal rounded to three significant figures.", "solution": "The problem statement has been validated and is found to be scientifically grounded, well-posed, objective, and self-contained. It describes a standard, albeit simplified, model of electrical propagation between two cardiac cells, a fundamental topic in cardiac electrophysiology. All necessary parameters and definitions are provided for a unique solution. Therefore, a full solution will be provided.\n\nThe conduction safety factor, which we will denote as $SF$, is defined as the ratio of the source current, $I_{\\mathrm{source}}$, to the load requirement, $I_{\\mathrm{load}}$:\n$$\nSF = \\frac{I_{\\mathrm{source}}}{I_{\\mathrm{load}}}\n$$\n\nFirst, we must determine the expression for the source current, $I_{\\mathrm{source}}$. The problem states that this is the junctional current initially available to drive cell $2$. At the moment of cell $1$'s upstroke (time $t=0$), its potential becomes $V_{1} = +20\\,\\mathrm{mV}$, while cell $2$ is still at its resting potential, $V_{2} = -80\\,\\mathrm{mV}$. The initial driving voltage difference, $\\Delta V$, across the gap junction is thus:\n$$\n\\Delta V = V_{1}(0) - V_{2}(0) = (+20\\,\\mathrm{mV}) - (-80\\,\\mathrm{mV}) = 100\\,\\mathrm{mV}\n$$\nThis value is provided directly in the problem statement. Using Ohm's law, $I = G \\Delta V$, the initial junctional current, which is our source current, is given by:\n$$\nI_{\\mathrm{source}} = G_{j} \\Delta V\n$$\nHere, $G_{j}$ is the conductance of the gap junction.\n\nNext, we must determine the load requirement, $I_{\\mathrm{load}}$. The problem defines this as the minimum average current that delivers the threshold charge, $Q_{\\mathrm{th}}$, over the dominant charging time constant, $\\tau$, of cell $2$. The model simplifies to a circuit where the upstream cell acts as a voltage source, charging the downstream cell's membrane capacitance, $C_{m}$, through the gap junction's resistance, $R_{j} = 1/G_{j}$. The ionic leak of cell $2$ is considered negligible. This is a classic $RC$ circuit, and its time constant $\\tau$ is given by:\n$$\n\\tau = R_{j} C_{m} = \\frac{C_{m}}{G_{j}}\n$$\nThe average current $I_{\\mathrm{load}}$ required to deliver a total charge $Q_{\\mathrm{th}}$ over a time interval $\\tau$ is:\n$$\nI_{\\mathrm{load}} = \\frac{Q_{\\mathrm{th}}}{\\tau}\n$$\nSubstituting the expression for $\\tau$, we find:\n$$\nI_{\\mathrm{load}} = \\frac{Q_{\\mathrm{th}}}{C_{m} / G_{j}} = \\frac{Q_{\\mathrm{th}} G_{j}}{C_{m}}\n$$\n\nNow we can assemble the expression for the safety factor, $SF$, by taking the ratio of $I_{\\mathrm{source}}$ to $I_{\\mathrm{load}}$:\n$$\nSF = \\frac{I_{\\mathrm{source}}}{I_{\\mathrm{load}}} = \\frac{G_{j} \\Delta V}{\\frac{Q_{\\mathrm{th}} G_{j}}{C_{m}}}\n$$\nThe gap junction conductance, $G_{j}$, cancels from the numerator and the denominator, yielding the final expression for the safety factor:\n$$\nSF = \\frac{\\Delta V C_{m}}{Q_{\\mathrm{th}}}\n$$\nThis expression shows that, under the given definition and simplifying assumptions, the safety factor depends on the initial voltage difference, the downstream cell's capacitance, and the threshold charge, but it is independent of the coupling conductance $G_{j}$. Physically, this ratio compares the total charge that would be stored on the capacitor $C_{m}$ if it were charged through the full voltage difference $\\Delta V$ (which is $Q_{\\mathrm{max}} = C_{m} \\Delta V$) to the minimum charge $Q_{\\mathrm{th}}$ required to trigger an action potential.\n\nFinally, we evaluate the safety factor numerically using the provided parameters. It is imperative to use consistent SI units.\nThe given parameters are:\n- $C_{m} = 120\\,\\mathrm{pF} = 120 \\times 10^{-12}\\,\\mathrm{F}$\n- $G_{j} = 20\\,\\mathrm{nS} = 20 \\times 10^{-9}\\,\\mathrm{S}$ (This parameter is not needed for the final calculation)\n- $Q_{\\mathrm{th}} = 2.4\\,\\mathrm{pC} = 2.4 \\times 10^{-12}\\,\\mathrm{C}$\n- $\\Delta V = 100\\,\\mathrm{mV} = 0.1\\,\\mathrm{V}$\n\nSubstituting these values into our derived expression for $SF$:\n$$\nSF = \\frac{(0.1\\,\\mathrm{V}) \\times (120 \\times 10^{-12}\\,\\mathrm{F})}{2.4 \\times 10^{-12}\\,\\mathrm{C}}\n$$\nThe term $V \\times F$ in the numerator has units of Coulombs ($C$), since capacitance is defined as $C=Q/V$. Thus, the expression is dimensionless, as expected.\n$$\nSF = \\frac{0.1 \\times 120 \\times 10^{-12}}{2.4 \\times 10^{-12}} = \\frac{12}{2.4} = 5\n$$\nThe problem requires the answer to be expressed as a dimensionless decimal rounded to three significant figures. An integer result of $5$ is written as $5.00$ to indicate this precision.", "answer": "$$\n\\boxed{5.00}\n$$", "id": "2555267"}, {"introduction": "While conduction failure can cause arrhythmias, so can conduction that persists indefinitely in a pathological circuit, a mechanism known as reentry. For a wave of activation to continuously circulate, the path it travels must be long enough for the tissue at the start of the loop to recover its excitability. This exercise challenges you to calculate this minimal path length—the product of conduction velocity ($CV$) and effective refractory period ($ERP$) known as the cardiac wavelength—which defines the substrate for reentry. You will also investigate how this critical length is modulated by mechanical stretch, providing a tangible link between mechanics and electrical instability. [@problem_id:2555288]", "problem": "A thin, uniform ring of atrial tissue supports propagation of a single activation wavefront constrained to the ring path. Baseline measurements at a pacing rate where recovery is uniform yield a one-dimensional conduction velocity $CV_0 = 0.60$ m/s and an effective refractory period (ERP) $ERP_0 = 0.220$ s. An acute, static circumferential stretch of magnitude $s = 0.08$ (dimensionless strain) is applied. Under small deformations, assume a linear mechano-electric coupling such that conduction velocity and effective refractory period change with strain according to $CV(s) = CV_0 \\left(1 - 0.50\\, s\\right)$ and $ERP(s) = ERP_0 \\left(1 - 1.50\\, s\\right)$. Assume the wavefront speed is spatially uniform along the ring and temporally constant over the time interval of interest, the refractory recovery is homogeneous without restitution or dispersion, and curvature or electrotonic load effects are negligible.\n\nUsing only fundamental definitions of speed and the effective refractory period, determine the minimal ring circumference required to sustain a single-loop anatomical reentry when $s = 0.08$. Express your final answer in millimeters, and round your answer to four significant figures.", "solution": "The problem is well-posed and scientifically sound, resting on fundamental principles of cardiac electrophysiology. It provides sufficient information to determine a unique solution. We shall proceed with a formal derivation.\n\nThe condition for a single-loop anatomical reentry to be sustained is that the path length of the circuit must be long enough for the tissue at the head of the propagating wavefront to have fully recovered from its previous excitation. This means the time it takes for the wave to complete one full circuit, known as the cycle length ($T_{CL}$), must be greater than or equal to the effective refractory period ($ERP$) of the tissue.\n$$\nT_{CL} \\ge ERP\n$$\nThe minimal condition for sustained reentry occurs at the equality, which defines the smallest possible circuit that can support the arrhythmia. The minimal circumference, denoted as $L_{min}$, is the path length for which the cycle length is exactly equal to the refractory period.\n$$\nT_{CL, min} = ERP\n$$\nThe cycle length is related to the circumference $L$ and the conduction velocity $CV$ by the fundamental definition of speed:\n$$\nCV = \\frac{L}{T_{CL}} \\implies T_{CL} = \\frac{L}{CV}\n$$\nSubstituting this into the minimal condition gives:\n$$\n\\frac{L_{min}}{CV} = ERP\n$$\nThis allows us to solve for the minimal circumference required to sustain reentry, which is the product of the conduction velocity and the effective refractory period. This product is often referred to as the wavelength ($\\lambda$) of the cardiac impulse.\n$$\nL_{min} = CV \\times ERP\n$$\nThe problem specifies that the tissue is under an acute, static circumferential stretch of magnitude $s = 0.08$. Therefore, we must use the conduction velocity $CV(s)$ and effective refractory period $ERP(s)$ corresponding to this stretched state. The minimal circumference under stretch, $L_{min}(s)$, is given by:\n$$\nL_{min}(s) = CV(s) \\times ERP(s)\n$$\nWe are given the baseline values and the linear mechano-electric coupling functions:\n-   Baseline conduction velocity: $CV_0 = 0.60 \\, \\text{m/s}$\n-   Baseline effective refractory period: $ERP_0 = 0.220 \\, \\text{s}$\n-   Strain: $s = 0.08$\n-   Strain-dependent conduction velocity: $CV(s) = CV_0 (1 - 0.50 s)$\n-   Strain-dependent effective refractory period: $ERP(s) = ERP_0 (1 - 1.50 s)$\n\nFirst, we calculate the conduction velocity under the specified strain, $CV(s=0.08)$:\n$$\nCV(0.08) = CV_0 (1 - 0.50 \\times 0.08) = 0.60 \\, \\text{m/s} \\times (1 - 0.04)\n$$\n$$\nCV(0.08) = 0.60 \\, \\text{m/s} \\times 0.96 = 0.576 \\, \\text{m/s}\n$$\nNext, we calculate the effective refractory period under the same strain, $ERP(s=0.08)$:\n$$\nERP(0.08) = ERP_0 (1 - 1.50 \\times 0.08) = 0.220 \\, \\text{s} \\times (1 - 0.12)\n$$\n$$\nERP(0.08) = 0.220 \\, \\text{s} \\times 0.88 = 0.1936 \\, \\text{s}\n$$\nNow, we can compute the minimal circumference $L_{min}$ for the stretched ring:\n$$\nL_{min}(0.08) = CV(0.08) \\times ERP(0.08)\n$$\n$$\nL_{min}(0.08) = (0.576 \\, \\text{m/s}) \\times (0.1936 \\, \\text{s}) = 0.1115136 \\, \\text{m}\n$$\nThe problem requires the answer to be expressed in millimeters and rounded to four significant figures. We perform the unit conversion:\n$$\nL_{min}(0.08) = 0.1115136 \\, \\text{m} \\times \\frac{1000 \\, \\text{mm}}{1 \\, \\text{m}} = 111.5136 \\, \\text{mm}\n$$\nRounding this value to four significant figures gives:\n$$\nL_{min}(0.08) \\approx 111.5 \\, \\text{mm}\n$$\nThis is the minimal circumference of the atrial ring, under the specified strain, that can sustain anatomical reentry.", "answer": "$$\\boxed{111.5}$$", "id": "2555288"}, {"introduction": "Cardiac electrical properties are not fixed but change dynamically from beat to beat, a phenomenon governed by restitution. This dynamic behavior can lead to instabilities, such as alternans, where the action potential duration ($APD$) alternates between long and short on consecutive beats. This advanced computational practice guides you through simulating a one-dimensional cardiac fiber to see how these instabilities arise from fundamental restitution properties. By implementing and running the model, you will learn to distinguish between concordant alternans (in-phase) and the more dangerous discordant alternans (out-of-phase), a key step in creating the substrate for wavebreak and fibrillation. [@problem_id:2555240]", "problem": "You are given a pacing protocol at basic cycle length $BCL$ applied at the proximal end of a one-dimensional fiber of $N$ sites with inter-site spacing $\\Delta x$. The activation at site $i=0$ occurs at times $S_n = n \\cdot BCL$ for beats $n = 0,1,2,\\dots$. For each beat $n$ and site $i$, define the activation time $A_{i,n}$, diastolic interval $DI_{i,n}$, and action potential duration $APD_{i,n}$ in milliseconds. The activation propagates distally with a conduction velocity restitution $CV(DI)$, and repolarization follows an action potential duration restitution $f(DI)$. A simplified mechano-electric coupling term scales $APD$ locally by a spatially prescribed, dimensionless profile $m_i$ with coupling gain $k_{\\mathrm{mech}}$.\n\nStarting from the following fundamental base:\n- The activation time at the pacing site is $A_{0,n} = S_n$.\n- The local diastolic interval equals the time between the end of the previous action potential and the present activation: $DI_{i,n} = A_{i,n} - \\left(A_{i,n-1} + APD_{i,n-1}\\right)$.\n- The local action potential duration obeys a monotonic restitution relation $APD_{i,n} = \\left(1 + k_{\\mathrm{mech}} \\, m_i\\right) \\, f(DI_{i,n})$.\n- The activation time satisfies nearest-neighbor propagation with conduction delay $\\delta t_{i-1 \\rightarrow i,n} = 1000 \\cdot \\frac{\\Delta x}{CV\\!\\left(DI_{i-1,n}\\right)}$ in milliseconds (with $\\Delta x$ in centimeters and $CV$ in centimeters per second), so $A_{i,n} = A_{i-1,n} + \\delta t_{i-1 \\rightarrow i,n}$ for $i \\ge 1$.\n\nUse the following restitution functions, with all arguments and outputs in milliseconds except where indicated:\n- Action potential duration restitution:\n$$\nf(DI) = APD_{\\min} + \\left(APD_{\\max} - APD_{\\min}\\right)\\left(1 - e^{-DI/\\tau_{\\mathrm{APD}}}\\right),\n$$\nwith $APD_{\\min} = 120$, $APD_{\\max} = 320$, and $\\tau_{\\mathrm{APD}} = 50$.\n- Conduction velocity restitution:\n$$\nCV(DI) = CV_{\\min} + \\left(CV_{\\max} - CV_{\\min}\\right)\\left(1 - e^{-DI/\\tau_{\\mathrm{CV}}}\\right),\n$$\nwith $CV_{\\min} = 25$ and $CV_{\\max} = 65$ in centimeters per second, and a case-specific $\\tau_{\\mathrm{CV}}$ in milliseconds.\n\nSpace is discretized by $N$ sites with $\\Delta x$ between adjacent sites:\n- Let $N = 80$ and $\\Delta x = 0.02$ (centimeters).\n- The pacing site is $i=0$, and the distal end is $i=N-1$.\n\nInitialization must be done without shortcut formulas by enforcing internal consistency at beat $n=0$:\n- Choose a uniform initial diastolic interval $DI_{\\mathrm{init}} = \\max\\left(50, BCL - 200\\right)$ for all sites.\n- Set $A_{0,0} = 0$. Compute $A_{i,0}$ for $i \\ge 1$ using the conduction delay with $DI_{i-1,0} \\equiv DI_{\\mathrm{init}}$.\n- Compute $APD_{i,-1} = \\left(1 + k_{\\mathrm{mech}} \\, m_i\\right) f\\!\\left(DI_{\\mathrm{init}}\\right)$, and set $A_{i,-1} = A_{i,0} - \\left(DI_{\\mathrm{init}} + APD_{i,-1}\\right)$, which makes $DI_{i,0} = DI_{\\mathrm{init}}$ by construction.\n\nSimulation protocol:\n- Iterate beats $n=0,1,\\dots,n_{\\max}-1$ with $n_{\\max} = 300$.\n- Enforce physiological feasibility by bounding $DI_{i,n}$ below by $DI_{\\min} = 1$ via $DI_{i,n} \\leftarrow \\max\\left(DI_{i,n}, DI_{\\min}\\right)$ before using it in $f(\\cdot)$ or $CV(\\cdot)$.\n- Record $APD_{i,n}$ for each site and beat. At the end, use the last $W = 60$ beats to assess alternans.\n\nDefinition of alternans and its spatial pattern:\n- For each site $i$, define the alternans amplitude over the last $W$ beats as the absolute difference between the mean of even-beat $APD$ values and the mean of odd-beat $APD$ values. Let this be $\\Delta_i$.\n- A site exhibits alternans if $\\Delta_i \\ge \\Theta$, with $\\Theta = 5$ (milliseconds).\n- Determine the alternans phase at site $i$ as the sign of the mean-even minus mean-odd difference over the last $W$ beats. Consider the phase only for sites with $\\Delta_i \\ge \\Theta$.\n- Classification of the global pattern:\n  - If no site exhibits alternans, return $0$ (no alternans).\n  - If at least one site exhibits alternans and all such sites share the same phase, return $1$ (concordant alternans).\n  - If at least one site exhibits alternans and there exist sites with opposite phases, return $2$ (discordant alternans).\n\nMechano-electric coupling profiles $m_i$:\n- \"none\": $m_i = 0$ for all $i$.\n- \"gradient\": $m_i = \\frac{i}{N-1}$ for $i=0,1,\\dots,N-1$.\n- \"uniform\": $m_i = 1$ for all $i$.\n\nPhysical units:\n- All times ($BCL$, $DI$, $APD$, delays) must be in milliseconds.\n- Conduction velocity must be in centimeters per second.\n- Distance $\\Delta x$ must be in centimeters.\n\nImplement a program that carries out the above derivation and simulation and returns the alternans classification code for each test case below. Express your final outputs as integers on a single line as specified in the Final Output Format.\n\nTest suite (each case is a tuple ($BCL, \\tau_{\\mathrm{CV}}, k_{\\mathrm{mech}}, \\text{profile}$)):\n- Case 1: $(500, 100, 0.0, \\text{\"none\"})$.\n- Case 2: $(300, 100, 0.0, \\text{\"none\"})$.\n- Case 3: $(300, 20, 0.15, \\text{\"gradient\"})$.\n- Case 4: $(300, 100, -0.4, \\text{\"uniform\"})$.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, [$r_1,r_2,r_3,r_4$], where $r_k \\in \\{0,1,2\\}$ is the classification for test case $k$ in the order listed above.", "solution": "The problem statement has been critically validated and is deemed to be a well-posed, scientifically grounded, and objective problem in computational cardiac electrophysiology. It describes a discrete map-based model for action potential propagation and repolarization in a one-dimensional cardiac fiber, including restitution properties and mechano-electric coupling. The instructions for simulation, initialization, and analysis are complete and internally consistent. Therefore, a solution will be provided.\n\nThe problem requires the simulation of a system of coupled difference equations that model the electrophysiology of a one-dimensional cardiac fiber. The fiber consists of $N=80$ discrete sites, indexed by $i \\in \\{0, 1, \\dots, N-1\\}$, with a spatial separation of $\\Delta x = 0.02$ cm. The state of the system is described by the activation time $A_{i,n}$ and action potential duration $APD_{i,n}$ for each site $i$ and beat $n$.\n\nThe simulation evolves in discrete time steps corresponding to cardiac beats, indexed by $n=0, 1, \\dots, n_{\\max}-1$, where $n_{\\max}=300$. A periodic stimulus with basic cycle length $BCL$ is applied at the proximal end ($i=0$), defining the boundary condition for activation time:\n$$A_{0,n} = n \\cdot BCL$$\n\nThe activation propagates from site $i-1$ to site $i$ with a conduction delay $\\delta t_{i-1 \\rightarrow i,n}$ that depends on the local diastolic interval $DI_{i-1,n}$. The governing equation for activation time at $i \\ge 1$ is:\n$$A_{i,n} = A_{i-1,n} + \\delta t_{i-1 \\rightarrow i,n} = A_{i-1,n} + 1000 \\cdot \\frac{\\Delta x}{CV(DI_{i-1,n})}$$\nThe factor of $1000$ converts the delay from seconds (cm / (cm/s)) to milliseconds. The conduction velocity restitution function $CV(DI)$ is given by:\n$$CV(DI) = CV_{\\min} + \\left(CV_{\\max} - CV_{\\min}\\right)\\left(1 - e^{-DI/\\tau_{\\mathrm{CV}}}\\right)$$\nwith parameters $CV_{\\min} = 25$ cm/s, $CV_{\\max} = 65$ cm/s, and a case-specific $\\tau_{\\mathrm{CV}}$.\n\nThe local diastolic interval $DI_{i,n}$ is the time elapsed between the end of the previous action potential at site $i$ and the current activation:\n$$DI_{i,n} = A_{i,n} - \\left(A_{i,n-1} + APD_{i,n-1}\\right)$$\n\nThe action potential duration $APD_{i,n}$ is determined by the local diastolic interval $DI_{i,n}$ through the APD restitution function $f(DI)$, scaled by a mechano-electric coupling term:\n$$APD_{i,n} = \\left(1 + k_{\\mathrm{mech}} \\, m_i\\right) \\, f(DI_{i,n})$$\nwhere $k_{\\mathrm{mech}}$ is the coupling gain and $m_i$ is a spatially-defined dimensionless profile. The APD restitution function $f(DI)$ is:\n$$f(DI) = APD_{\\min} + \\left(APD_{\\max} - APD_{\\min}\\right)\\left(1 - e^{-DI/\\tau_{\\mathrm{APD}}}\\right)$$\nwith parameters $APD_{\\min} = 120$ ms, $APD_{\\max} = 320$ ms, and $\\tau_{\\mathrm{APD}} = 50$ ms.\n\nTo ensure physiological plausibility, any computed diastolic interval $DI_{i,n}$ is bounded below by $DI_{\\min} = 1$ ms before being used in the $CV(\\cdot)$ or $f(\\cdot)$ functions: $DI_{i,n} \\leftarrow \\max(DI_{i,n}, DI_{\\min})$.\n\nThe numerical scheme proceeds as follows:\nFirst, a consistent initial state for beats $n=-1$ and $n=0$ is established. An initial diastolic interval $DI_{\\mathrm{init}} = \\max(50, BCL - 200)$ is defined. The activation times for the first beat ($n=0$), denoted $A_{i,0}$, are calculated by setting $A_{0,0}=0$ and propagating the wave with a constant conduction velocity $CV(DI_{\\mathrm{init}})$. Then, the state for the preceding \"virtual\" beat $n=-1$ is constructed to be consistent with this initialization, by setting $APD_{i,-1} = (1 + k_{\\mathrm{mech}} m_i) f(DI_{\\mathrm{init}})$ and $A_{i,-1} = A_{i,0} - (DI_{\\mathrm{init}} + APD_{i,-1})$. This ensures that $DI_{i,0} = DI_{\\mathrm{init}}$ holds by definition.\n\nNext, the simulation iterates for beats $n=0, \\dots, n_{\\max}-1$. For each beat $n$, the following sequence is executed:\n1. An array for the current activation times, $A_{i,n}$, is populated. $A_{0,n}$ is set from the pacing protocol. Then, a spatial loop for $i=1, \\dots, N-1$ computes each subsequent $A_{i,n}$ based on the state of the previous site $i-1$ for beat $n$ and the history of site $i-1$ from beat $n-1$.\n2. Once all activation times $A_{i,n}$ are known for the current beat, a second spatial loop for $i=0, \\dots, N-1$ calculates the diastolic intervals $DI_{i,n}$ and subsequently the action potential durations $APD_{i,n}$.\n3. The computed arrays for $A_{i,n}$ and $APD_{i,n}$ are stored as the history for beat $n$, and they become the \"previous beat\" arrays for the calculation of beat $n+1$.\n\nAfter $n_{\\max}=300$ beats, the last $W=60$ beats of the $APD_{i,n}$ time series are analyzed for alternans. For each site $i$, the alternans amplitude $\\Delta_i$ is calculated as the absolute difference between the mean APD on even-indexed beats and the mean APD on odd-indexed beats within the analysis window. A site $i$ is considered to exhibit alternans if $\\Delta_i \\ge \\Theta$, where the threshold $\\Theta=5$ ms. The phase of alternans is the sign of this difference.\n\nThe global spatial pattern of alternans is classified into one of three categories:\n- 0 (no alternans): No site exhibits alternans.\n- 1 (concordant alternans): At least one site exhibits alternans, and all such sites have the same phase (all are either positive or negative).\n- 2 (discordant alternans): There are at least two sites exhibiting alternans with opposite phases.\n\nThis complete procedure is implemented for each test case to determine the corresponding classification code.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n    # Test suite (BCL, tau_CV, k_mech, profile_name)\n    test_cases = [\n        (500.0, 100.0, 0.0, \"none\"),\n        (300.0, 100.0, 0.0, \"none\"),\n        (300.0, 20.0, 0.15, \"gradient\"),\n        (300.0, 100.0, -0.4, \"uniform\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        bcl, tau_cv, k_mech, profile_name = case\n        result_code = run_case(bcl, tau_cv, k_mech, profile_name)\n        results.append(result_code)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(bcl, tau_cv, k_mech, profile_name):\n    \"\"\"\n    Runs a single simulation case and returns the alternans classification.\n    \"\"\"\n    #\n    # --- Model Parameters ---\n    #\n    N = 80  # Number of sites\n    DX = 0.02  # Inter-site spacing (cm)\n    N_MAX = 300  # Number of beats to simulate\n    DI_MIN = 1.0  # Minimum diastolic interval (ms)\n\n    # APD restitution parameters\n    APD_MIN = 120.0  # ms\n    APD_MAX = 320.0  # ms\n    TAU_APD = 50.0  # ms\n\n    # CV restitution parameters\n    CV_MIN = 25.0  # cm/s\n    CV_MAX = 65.0  # cm/s\n\n    # Alternans analysis parameters\n    W_ANALYZE = 60 # Analysis window width (beats)\n    THETA_ALT = 5.0 # Alternans threshold (ms)\n\n    # Mechano-electric coupling profile\n    if profile_name == \"none\":\n        m_profile = np.zeros(N)\n    elif profile_name == \"gradient\":\n        m_profile = np.linspace(0, 1, N)\n    elif profile_name == \"uniform\":\n        m_profile = np.ones(N)\n    else:\n        raise ValueError(\"Invalid profile name\")\n\n    #\n    # --- Restitution Functions ---\n    #\n    def f_apd(di):\n        return APD_MIN + (APD_MAX - APD_MIN) * (1 - np.exp(-di / TAU_APD))\n\n    def f_cv(di):\n        return CV_MIN + (CV_MAX - CV_MIN) * (1 - np.exp(-di / tau_cv))\n\n    #\n    # --- Simulation ---\n    #\n    apd_history = run_simulation(\n        bcl, k_mech, m_profile, f_apd, f_cv,\n        N, DX, N_MAX, DI_MIN\n    )\n\n    #\n    # --- Analysis ---\n    #\n    return analyze_alternans(apd_history, W_ANALYZE, THETA_ALT, N_MAX)\n\n\ndef run_simulation(bcl, k_mech, m_profile, f_apd, f_cv, N, DX, N_MAX, DI_MIN):\n    \"\"\"\n    Performs the core electrophysiology simulation.\n    \"\"\"\n    apd_history = np.zeros((N_MAX, N))\n\n    # --- Initialization ---\n    di_init = max(50.0, bcl - 200.0)\n\n    # Calculate activation times for the first beat (n=0)\n    a_current = np.zeros(N) # This will hold A_{i,0}\n    a_current[0] = 0.0\n    cv_init = f_cv(di_init)\n    delay_init = 1000.0 * DX / cv_init\n    for i in range(1, N):\n        a_current[i] = a_current[i-1] + delay_init\n\n    # Construct consistent state for the virtual previous beat (n=-1)\n    apd_prev = (1 + k_mech * m_profile) * f_apd(di_init)\n    a_prev = a_current - (di_init + apd_prev)\n\n    # --- Main Simulation Loop ---\n    for n in range(N_MAX):\n        a_current = np.zeros(N)\n        apd_current = np.zeros(N)\n        \n        # Site 0 is paced\n        a_current[0] = n * bcl\n\n        # Spatial loop for activation propagation (beat n)\n        for i in range(1, N):\n            di_propagating = a_current[i-1] - (a_prev[i-1] + apd_prev[i-1])\n            di_propagating = max(di_propagating, DI_MIN)\n            cv = f_cv(di_propagating)\n            delay = 1000.0 * DX / cv\n            a_current[i] = a_current[i-1] + delay\n            \n        # Spatial loop for repolarization (beat n)\n        for i in range(N):\n            di_local = a_current[i] - (a_prev[i] + apd_prev[i])\n            di_local = max(di_local, DI_MIN)\n            apd_current[i] = (1 + k_mech * m_profile[i]) * f_apd(di_local)\n\n        # Store results and update state for next iteration\n        apd_history[n, :] = apd_current\n        a_prev = a_current.copy()\n        apd_prev = apd_current.copy()\n        \n    return apd_history\n\ndef analyze_alternans(apd_history, W, theta, n_max):\n    \"\"\"\n    Analyzes the APD time series for alternans and classifies the pattern.\n    \"\"\"\n    if n_max  W:\n        return 0 # Not enough data to analyze\n\n    apd_window = apd_history[-W:, :]\n    phases = np.zeros(apd_history.shape[1])\n\n    first_beat_index = n_max - W\n    if (first_beat_index % 2) == 0:\n        # Window starts on an even global beat index\n        even_indices = slice(0, W, 2)\n        odd_indices = slice(1, W, 2)\n    else:\n        # Window starts on an odd global beat index\n        even_indices = slice(1, W, 2)\n        odd_indices = slice(0, W, 2)\n\n    for i in range(apd_history.shape[1]):\n        apd_site = apd_window[:, i]\n        mean_even = np.mean(apd_site[even_indices])\n        mean_odd = np.mean(apd_site[odd_indices])\n        \n        diff = mean_even - mean_odd\n        amplitude = abs(diff)\n\n        if amplitude >= theta:\n            phases[i] = np.sign(diff)\n\n    alternans_phases = phases[phases != 0]\n\n    if len(alternans_phases) == 0:\n        return 0  # No alternans\n    \n    if np.all(alternans_phases == alternans_phases[0]):\n        return 1  # Concordant alternans\n    else:\n        return 2  # Discordant alternans\n\nsolve()\n```", "id": "2555240"}]}