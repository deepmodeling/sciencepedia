{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在从基本原理出发，推导电池等效电路模型在阶跃电流输入下的完整电压响应。通过求解描述电路动态的微分方程，您将能够清晰地区分并理解电池电压响应中的三个关键部分：瞬时欧姆压降、暂态极化效应以及由电荷状态（SOC）变化引起的缓慢漂移。这项基本分析是掌握更复杂电池行为和模型的基础。",
            "id": "3912122",
            "problem": "考虑一个锂离子电池的等效电路模型（ECM），该模型由一个依赖于荷电状态（SOC）$x(t)$（无量纲，$x \\in [0,1]$）的开路电压源 $v_{\\mathrm{oc}}(x)$，一个串联欧姆电阻 $R_{s}$，以及一个由电阻 $R_{1}$ 与电容 $C_{1}$ 并联建模的一阶极化支路组成。符号约定为：正电流 $I(t)$ 对应于放电，因此在正电流下，端电压 $V(t)$ 相对于 $v_{\\mathrm{oc}}(x(t))$ 会下降。假设在t<0时电池处于静止状态，此时 $I(t)=0$，极化电压初始为松弛状态，且SOC为 $x(0)=x_{0}$。在 $t=0$ 时，施加一个阶跃放电电流，\n$$\nI(t)=I_{0}\\,\\mathbf{1}_{t\\ge 0},\n$$\n其中 $\\mathbf{1}_{t\\ge 0}$ 表示指示函数。\n\n仅从以下基本关系出发：\n- 集总电路的基尔霍夫电压定律和基尔霍夫电流定律，\n- 电容器的本构关系 $i_{C}(t)=C\\,\\frac{dv_{C}}{dt}$，\n- 标称容量为 $Q$（单位：库仑）的电池的SOC动力学方程 $\\frac{dx}{dt}=-\\frac{I(t)}{Q}$，\n- 开路电压在 $x_{0}$ 附近的一阶线性化表达式，$v_{\\mathrm{oc}}(x)\\approx v_{\\mathrm{oc}}(x_{0})+k\\,(x-x_{0})$，其中 $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$，\n\n在给定假设下，推导 $t\\ge 0$ 时端电压 $V(t)$ 的闭式表达式，忽略迟滞效应和温度依赖性。端电压公式以伏特为单位表示。最终表达式必须是关于 $t$ 和给定参数 $\\{v_{\\mathrm{oc}}(x_{0}),k,x_{0},Q,I_{0},R_{s},R_{1},C_{1}\\}$ 的单一闭式解析函数，并在推导过程中明确引用所有必要的初始条件。无需进行数值代入，也无需四舍五入。请提供 $V(t)$ 的单一解析表达式作为最终答案。",
            "solution": "该问题提供了一套完整且一致的定义、初始条件和物理定律，用以确定由一阶等效电路建模的锂离子电池在阶跃放电电流响应下的端电压。该问题具有科学依据，提法明确且客观。因此，该问题有效，可以推导出解。\n\n等效电路模型由一个开路电压（OCV）源 $v_{\\mathrm{oc}}(x)$、一个串联电阻 $R_{s}$ 和一个由 $R_{1}$ 和 $C_{1}$ 组成的并联RC支路构成。端电压 $V(t)$ 在这些元件的串联组合上测量。从电池流出的总电流用 $I(t)$ 表示。正电流对应于放电。\n\n设 $v_{1}(t)$ 为并联RC支路两端的电压，其极性在放电期间与端电压相反。对电路应用基尔霍夫电压定律（KVL），可得到端电压 $V(t)$ 的表达式：\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\n问题中给出的符号约定（正放电电流下电压下降）证实了电阻元件和极化元件上电压降的负号。\n\n推导过程分为三个部分：\n1.  推导极化电压 $v_{1}(t)$ 的表达式。\n2.  推导荷电状态 $x(t)$ 的表达式，并进而推导OCV $v_{\\mathrm{oc}}(x(t))$ 的表达式。\n3.  结合这些结果，得到端电压 $V(t)$ 的最终表达式。\n\n**1. 极化电压动力学**\n\n流过电池的总电流 $I(t)$ 在RC支路内分为两条路径：流过电阻 $R_{1}$ 的电流，记为 $i_{R1}(t)$，和流过电容 $C_{1}$ 的电流，记为 $i_{C1}(t)$。根据基尔霍夫电流定律（KCL）：\n$$\nI(t) = i_{R1}(t) + i_{C1}(t)\n$$\n两个并联元件两端的电压均为 $v_{1}(t)$。根据电阻的欧姆定律和电容的本构关系：\n$$\ni_{R1}(t) = \\frac{v_{1}(t)}{R_{1}}\n$$\n$$\ni_{C1}(t) = C_{1}\\frac{dv_{1}(t)}{dt}\n$$\n将这些代入KCL方程，得到一个关于 $v_{1}(t)$ 的一阶线性常微分方程（ODE）：\n$$\nI(t) = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\n对于 $t \\ge 0$，施加阶跃电流 $I(t) = I_{0}$。该ODE变为：\n$$\nI_{0} = \\frac{v_{1}(t)}{R_{1}} + C_{1}\\frac{dv_{1}(t)}{dt}\n$$\n整理成标准形式：\n$$\n\\frac{dv_{1}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1}(t) = \\frac{I_{0}}{C_{1}}\n$$\n这是一个非齐次ODE。其解是齐次解 $v_{1,h}(t)$ 和一个特解 $v_{1,p}(t)$ 的和。齐次方程为 $\\frac{dv_{1,h}}{dt} + \\frac{1}{R_{1}C_{1}}v_{1,h} = 0$，其解为 $v_{1,h}(t) = A\\exp(-t/\\tau_{1})$，其中 $\\tau_{1} = R_{1}C_{1}$ 是RC支路的时间常数，A是一个常数。对于一个恒定的输入 $I_{0}$，特解是一个常数，$v_{1,p}(t) = K$。代入ODE，我们得到 $0 + \\frac{K}{R_{1}C_{1}} = \\frac{I_{0}}{C_{1}}$，解得 $K = I_{0}R_{1}$。\n通解为：\n$$\nv_{1}(t) = A\\exp(-t/\\tau_{1}) + I_{0}R_{1}\n$$\n问题陈述极化电压初始为松弛状态，即 $v_{1}(0) = 0$。在 $t=0$ 时应用此初始条件：\n$$\nv_{1}(0) = 0 = A\\exp(0) + I_{0}R_{1} \\implies A = -I_{0}R_{1}\n$$\n因此，对于 $t \\ge 0$，极化电压的表达式为：\n$$\nv_{1}(t) = I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\n\n**2. 荷电状态与开路电压动力学**\n\n荷电状态 $x(t)$ 由以下关系决定：\n$$\n\\frac{dx}{dt} = -\\frac{I(t)}{Q}\n$$\n对于 $t \\ge 0$，且 $I(t)=I_{0}$，此式变为：\n$$\n\\frac{dx}{dt} = -\\frac{I_{0}}{Q}\n$$\n在初始条件 $x(0) = x_{0}$下，对时间从 $0$ 到 $t$ 进行积分：\n$$\n\\int_{x_{0}}^{x(t)} dx' = \\int_{0}^{t} -\\frac{I_{0}}{Q} dt'\n$$\n$$\nx(t) - x_{0} = -\\frac{I_{0}}{Q}t\n$$\n$$\nx(t) = x_{0} - \\frac{I_{0}}{Q}t\n$$\n接下来，我们使用所提供的OCV $v_{\\mathrm{oc}}(x)$ 在初始SOC $x_{0}$ 附近的一阶线性化表达式：\n$$\nv_{\\mathrm{oc}}(x) \\approx v_{\\mathrm{oc}}(x_{0}) + k(x-x_{0})\n$$\n其中 $k=\\left.\\frac{dv_{\\mathrm{oc}}}{dx}\\right|_{x_{0}}$。将 $x(t)$ 的表达式代入此近似式，得到 $t \\ge 0$ 时随时间变化的OCV：\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) + k\\left(\\left(x_{0} - \\frac{I_{0}}{Q}t\\right) - x_{0}\\right)\n$$\n$$\nv_{\\mathrm{oc}}(x(t)) = v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\n$$\n\n**3. 组装端电压表达式**\n\n最后，我们将 $v_{\\mathrm{oc}}(x(t))$ 和 $v_{1}(t)$ 的表达式代回到端电压 $V(t)$ 的KVL方程中。对于 $t \\ge 0$，我们有 $I(t) = I_{0}$。\n$$\nV(t) = v_{\\mathrm{oc}}(x(t)) - I(t)R_{s} - v_{1}(t)\n$$\n$$\nV(t) = \\left(v_{\\mathrm{oc}}(x_{0}) - \\frac{k I_{0}}{Q}t\\right) - I_{0}R_{s} - I_{0}R_{1}\\left(1 - \\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\\right)\n$$\n展开并重新排列各项，得到端电压的最终闭式表达式：\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}R_{s} - I_{0}R_{1} + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right) - \\frac{k I_{0}}{Q}t\n$$\n为了清晰起见，可以将其分组以显示初始电压、线性漂移和指数松弛：\n$$\nV(t) = v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)\n$$\n该表达式表示了 $t \\ge 0$ 时的完整电压响应，包含了初始OCV、瞬时欧姆压降、瞬态极化效应以及因荷电状态变化引起的OCV缓慢变化。",
            "answer": "$$\\boxed{v_{\\mathrm{oc}}(x_{0}) - I_{0}(R_{s} + R_{1}) - \\frac{k I_{0}}{Q}t + I_{0}R_{1}\\exp\\left(-\\frac{t}{R_{1}C_{1}}\\right)}$$"
        },
        {
            "introduction": "现实世界中的电池管理系统（BMS）在离散时间点上运行，因此必须将连续时间的物理模型转换为离散时间的状态空间形式。本练习将指导您完成这一关键的转换过程，推导出通用N阶RC等效电路模型的离散时间矩阵（$A$, $B$, $C$, $D$）。掌握这种转换是为实现卡尔曼滤波器等高级估计算法进行模型准备的核心技能。",
            "id": "3912067",
            "problem": "考虑一个用于自动化电池设计和仿真的可充电电芯的 $N$ 支路戴维南等效电路模型。该模型由一个串联欧姆电阻 $R_{s}$ 和 $N$ 个捕捉极化动力学的并联电阻-电容（$R_{k}$–$C_{k}$）支路组成。输入为端电流 $i(t)$，定义放电时为正。荷电状态 $z(t)$ 定义为可用容量的分数，通过库仑计数法演变，总电荷容量为 $Q$。开路电压 $E(z)$ 是 $z$ 的一个平滑函数。支路电容电压 $v_{k}(t)$ 代表第 $k$ 个电容器上的内部极化电压。端电压满足 $v_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s} i(t)$。\n\n仅从电荷和电阻-电容动力学的基本关系——即每个支路 $k$ 的 $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$、$v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$、Kirchhoff 电流定律 $i(t)=i_{R_{k}}(t)+i_{C_{k}}(t)$，以及库仑计数法 $\\frac{dz}{dt}=-\\frac{i(t)}{Q}$——出发，推导在长度为 $\\Delta t$ 的采样间隔内零阶保持（分段常数）输入下的精确离散时间、线性、时不变状态空间模型，以及关于标称荷电状态 $z_{0}$ 的电压测量的一阶（仿射）小信号线性化。\n\n具体来说：\n- 定义状态向量 $x=[\\,z,\\ v_{1},\\ \\dots,\\ v_{N}\\,]^{\\top}$，输入 $u=i$ 和输出 $y=v_{t}$。\n- 使用斜率为 $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$ 的 $E(z)$ 的一阶泰勒展开，将测量值 $y(t)$ 在 $z_{0}$ 附近线性化。您可以通过对输出重新定心来舍弃由线性化引起的任何常数偏移。\n- 在每个长度为 $\\Delta t$ 的区间上对 $u(t)$ 使用零阶保持，得到精确的采样模型 $x_{k+1}=A\\,x_{k}+B\\,u_{k}$ 和 $y_{k}=C\\,x_{k}+D\\,u_{k}$。\n\n将最终结果表示为矩阵 $(A,B,C,D)$ 的闭式解析表达式，并清楚说明 $A$ 如何依赖于乘积 $R_{k} C_{k}$ 以及 $B$ 如何通过采样操作依赖于 $Q$ 和 $C_{k}$。您的答案必须是使用 LaTeX $\\texttt{pmatrix}$ 环境排列为单行矩阵的四个对象 $(A,B,C,D)$。不需要进行数值计算。如果引入任何近似，必须从所述的物理定律和假设中明确证明其合理性。最终表达式中不需要单位。",
            "solution": "我们从支配电芯等效电路模型的基本物理关系和定义开始。\n\n荷电状态 $z(t)$ 根据库仑计数法演变。根据放电时 $i(t)>0$ 的符号约定，荷电状态的变化率由下式给出\n$$\n\\frac{d z}{d t}=-\\frac{i(t)}{Q}.\n$$\n\n对于每个电阻-电容支路 $k\\in\\{1,\\dots,N\\}$，Kirchhoff 电流定律指出，端电流 $i(t)$ 分为支路电阻电流 $i_{R_{k}}(t)$ 和支路电容电流 $i_{C_{k}}(t)$：\n$$\ni(t)=i_{R_{k}}(t)+i_{C_{k}}(t).\n$$\n该支路的本构关系为 $v_{R_{k}}(t)=R_{k}\\,i_{R_{k}}(t)$ 和 $i_{C_{k}}(t)=C_{k}\\,\\frac{d v_{k}}{dt}$，其中 $v_{k}(t)$ 是第 $k$ 个支路的电容电压。在戴维南模型中，支路电阻和电容的布置使得极化电压 $v_{k}(t)$ 跨接在这两个元件上，因此 $v_{R_{k}}(t)=v_{k}(t)$。将这些代入 Kirchhoff 电流定律得到\n$$\ni(t)=\\frac{v_{k}(t)}{R_{k}}+C_{k}\\,\\frac{d v_{k}}{d t}.\n$$\n整理后得到关于 $v_{k}(t)$ 的一阶线性微分方程：\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{R_{k} C_{k}}\\,v_{k}(t)=\\frac{i(t)}{C_{k}}.\n$$\n定义支路时间常数 $\\tau_{k}=R_{k} C_{k}$ 将有助于解释参数依赖性。\n\n端电压由开路电压、极化网络上的压降和串联电阻上的压降之和给出：\n$$\nv_{t}(t)=E(z(t))-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\n为了获得适用于状态空间表示的线性时不变测量模型，我们使用一阶泰勒展开在标称荷电状态 $z_{0}$ 附近对 $E(z)$ 进行线性化：\n$$\nE(z)\\approx E(z_{0})+\\left.\\frac{dE}{dz}\\right|_{z_{0}}(z-z_{0})=E(z_{0})+\\alpha\\,(z-z_{0}),\n$$\n其中 $\\alpha=\\left.\\frac{dE}{dz}\\right|_{z_{0}}$。这产生了一个仿射测量模型\n$$\nv_{t}(t)\\approx \\big(E(z_{0})-\\alpha z_{0}\\big)+\\alpha z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\n常数偏移 $\\big(E(z_{0})-\\alpha z_{0}\\big)$ 可以通过对输出重新定心来移除。移除此偏移后，线性化的测量值变为\n$$\ny(t)=\\alpha\\,z(t)-\\sum_{k=1}^{N} v_{k}(t)-R_{s}\\,i(t).\n$$\n\n将状态收集到 $x(t)=[\\,z(t),\\ v_{1}(t),\\ \\dots,\\ v_{N}(t)\\,]^{\\top}$ 中，并定义输入 $u(t)=i(t)$ 和输出 $y(t)=v_{t}(t)$，识别出上述线性化形式。连续时间状态方程为\n$$\n\\frac{d}{dt}\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n=\n\\underbrace{\\begin{pmatrix}\n0  0  \\cdots  0\\\\\n0  -\\frac{1}{R_{1} C_{1}}  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  -\\frac{1}{R_{N} C_{N}}\n\\end{pmatrix}}_{A_{c}}\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\n\\underbrace{\\begin{pmatrix}\n-\\frac{1}{Q}\\\\\n\\frac{1}{C_{1}}\\\\\n\\vdots\\\\\n\\frac{1}{C_{N}}\n\\end{pmatrix}}_{B_{c}}\n\\,u(t).\n$$\n线性化的输出方程为\n$$\ny(t)=\\underbrace{\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix}}_{C}\\,\n\\begin{pmatrix}\nz(t)\\\\\nv_{1}(t)\\\\\n\\vdots\\\\\nv_{N}(t)\n\\end{pmatrix}\n+\\underbrace{\\big(-R_{s}\\big)}_{D}\\,u(t).\n$$\n\n我们现在在零阶保持假设下对连续时间模型进行离散化：在每个采样区间 $[k\\Delta t,(k+1)\\Delta t)$ 上，$u(t)$ 保持恒定。对于荷电状态，方程 $\\frac{dz}{dt}=-\\frac{1}{Q}\\,u$ 在区间上 $u$ 为常数时的精确解给出\n$$\nz((k+1)\\Delta t)=z(k\\Delta t)-\\frac{\\Delta t}{Q}\\,u(k\\Delta t).\n$$\n因此，$A$ 中 $z$ 的离散时间系数为 $1$，$B$ 中对应的项为 $-\\frac{\\Delta t}{Q}$。\n\n对于每个第 $k$ 个极化状态 $v_{k}(t)$，我们在区间上求解输入为常数的线性微分方程。方程\n$$\n\\frac{d v_{k}}{d t}+\\frac{1}{\\tau_{k}}\\,v_{k}(t)=\\frac{u}{C_{k}},\\quad \\text{with }u \\text{ constant on }[k\\Delta t,(k+1)\\Delta t),\n$$\n的精确解是\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds.\n$$\n计算积分：\n$$\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t-s}{\\tau_{k}}\\right)\\,ds\n=\n\\int_{0}^{\\Delta t}\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\exp\\!\\left(\\frac{s}{\\tau_{k}}\\right)\\,ds\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,\\tau_{k}\\left[\\exp\\!\\left(\\frac{\\Delta t}{\\tau_{k}}\\right)-1\\right]\n=\n\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right).\n$$\n因此，\n$$\nv_{k}((k+1)\\Delta t)=\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\,v_{k}(k\\Delta t)+\\left(\\frac{u}{C_{k}}\\right)\\tau_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{\\tau_{k}}\\right)\\right)\n=\n\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\,v_{k}(k\\Delta t)+R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)\\,u(k\\Delta t).\n$$\n这明确地表明，$v_{k}$ 的离散时间状态系数是 $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$，展示了 $A$ 对乘积 $R_{k} C_{k}$ 的依赖性；输入系数是 $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$，它通过指数经由 $\\tau_{k}=R_{k} C_{k}$ 依赖于 $C_{k}$。\n\n汇总离散时间模型，我们得到\n$$\nx_{k+1}=A\\,x_{k}+B\\,u_{k},\n\\quad\ny_{k}=C\\,x_{k}+D\\,u_{k},\n$$\n其中\n$$\nA=\n\\begin{pmatrix}\n1  0  \\cdots  0\\\\\n0  \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix},\n$$\n$$\nB=\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix},\n\\quad\nC=\n\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix},\n\\quad\nD=-R_{s}.\n$$\n\n依赖关系是明确的：\n- 对于极化状态，$A$ 的对角线元素通过 $\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)$ 依赖于乘积 $R_{k} C_{k}$。\n- 对于荷电状态分量，$B$ 的元素通过 $-\\frac{\\Delta t}{Q}$ 依赖于 $Q$；对于极化分量，$B$ 的元素通过 $R_{k}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{k} C_{k}}\\right)\\right)$ 依赖于 $C_{k}$（和 $R_{k}$）。\n\n在所述的零阶保持假设以及对 $E(z)$ 在 $z_{0}$ 附近进行线性化并通过重新定心移除常数偏移的条件下，这些表达式是精确的。",
            "answer": "$$\\boxed{\\begin{pmatrix}\n\\begin{pmatrix}\n1  0  \\cdots  0\\\\\n0  \\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)  \\cdots  0\\\\\n\\vdots  \\vdots  \\ddots  \\vdots\\\\\n0  0  \\cdots  \\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\n\\end{pmatrix}\n\n\\begin{pmatrix}\n-\\frac{\\Delta t}{Q}\\\\\nR_{1}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{1} C_{1}}\\right)\\right)\\\\\n\\vdots\\\\\nR_{N}\\left(1-\\exp\\!\\left(-\\frac{\\Delta t}{R_{N} C_{N}}\\right)\\right)\n\\end{pmatrix}\n\n\\begin{pmatrix}\n\\alpha  -1  \\cdots  -1\n\\end{pmatrix}\n\n- R_{s}\n\\end{pmatrix} }$$"
        },
        {
            "introduction": "等效电路模型的一个重要应用是评估电池的能量效率和产热。本练习要求您通过模拟电池在给定电流曲线下的动态行为，来计算总能量损失，并将其分解为欧姆内阻损失和极化损失两部分。这项实践将物理模型与关键的系统性能指标（如效率和热管理）直接联系起来，展示了建模在工程设计中的实际价值。",
            "id": "3912118",
            "problem": "考虑一个可充电电池的等效电路模型（ECM），该模型由一个串联欧姆电阻 $R_{s}$ 和 $K$ 个极化支路组成。每个极化支路 $k \\in \\{1,\\dots,K\\}$ 是一个电阻-电容（RC）网络，由一个电阻 $R_{k}$ 与一个电容 $C_{k}$ 并联组成；支路电压表示为 $v_{k}(t)$。端子电流 $I(t)$ 流经 $R_{s}$ 并进入每个极化支路，其中适用 Kirchhoff 电流定律（KCL）。负载循环由指定时间段内的分段恒定电流曲线 $I(t)$ 描述。\n\n使用的基本定律：\n- Joule 电阻功率定律：对于任意瞬时电流为 $i(t)$、电阻为 $R$ 的电阻器，其瞬时功率耗散为 $p(t) = i(t)^{2} R$，等效地，用电阻器电压 $v(t)$ 表示为 $p(t) = \\dfrac{v(t)^{2}}{R}$。\n- 电容器本构关系：对于任意电压为 $v(t)$、电容为 $C$ 的电容器，其瞬时电流为 $i_{C}(t) = C \\dfrac{dv(t)}{dt}$。\n- Kirchhoff 电流定律（KCL）：进入节点的电流代数和为零。\n\n从这些基本定律和定义出发，推导在 $I(t) = I_{0}$、持续时间为 $\\Delta t$ 的分段恒流段下，每个极化支路电压 $v_{k}(t)$ 的控制动力学，并从第一性原理推导以下部分的能量耗散表达式：\n- 在整个循环中，欧姆电阻 $R_{s}$ 的能量耗散，以及\n- 在整个循环中，极化电阻 $R_{k}$ 的能量耗散，\n通过对适当的瞬时功率表达式进行时间积分。明确地将总能量损失分为欧姆分量和极化分量。\n\n您必须实现一个程序，为下述每个测试用例计算三个量：\n- $E_{\\text{ohmic}}$，单位为 $\\mathrm{J}$（焦耳），\n- $E_{\\text{polarization}}$，单位为 $\\mathrm{J}$（焦耳），\n- $E_{\\text{total}} = E_{\\text{ohmic}} + E_{\\text{polarization}}$，单位为 $\\mathrm{J}$（焦耳）。\n\n所有测试用例的假设：\n- 对于所有 $k$，初始极化支路电压满足 $v_{k}(0) = 0$。\n- 电阻 $R_{s}$ 和 $R_{k}$ 严格为正，单位为 $\\Omega$（欧姆）。\n- 电容 $C_{k}$ 严格为正，单位为 $\\mathrm{F}$（法拉）。\n- 时间持续严格为正，单位为 $\\mathrm{s}$（秒）。\n- 电流单位为 $\\mathrm{A}$（安培），可以为正（放电）、负（充电）或零。\n\n测试套件：\n- 测试用例 $1$：\n  - $R_{s} = 0.015~\\Omega$\n  - 极化支路：$K = 2$，其中 ($R_{1}$, $C_{1}$) = (0.020 $\\Omega$, 3000 F)，($R_{2}$, $C_{2}$) = (0.060 $\\Omega$, 800 F)\n  - 电流段：(120 A, 30 s)，(-80 A, 15 s)，(0 A, 10 s)\n- 测试用例 $2$：\n  - $R_{s} = 0.005~\\Omega$\n  - 极化支路：$K = 1$，其中 ($R_{1}$, $C_{1}$) = (0.030 $\\Omega$, 500 F)\n  - 电流段：(0 A, 20 s)\n- 测试用例 $3$：\n  - $R_{s} = 0.020~\\Omega$\n  - 极化支路：$K = 3$，其中 ($R_{1}$, $C_{1}$) = (0.010 $\\Omega$, 1000 F)，($R_{2}$, $C_{2}$) = (0.030 $\\Omega$, 600 F)，($R_{3}$, $C_{3}$) = (0.050 $\\Omega$, 400 F)\n  - 电流段：(200 A, 0.1 s)，(-200 A, 0.1 s)，(50 A, 0.05 s)\n- 测试用例 $4$：\n  - $R_{s} = 0.010~\\Omega$\n  - 极化支路：$K = 1$，其中 ($R_{1}$, $C_{1}$) = (0.050 $\\Omega$, 2000 F)\n  - 电流段：(-150 A, 40 s)\n\n您的程序必须基于上述原理执行符合物理学的计算，并为每个测试用例生成以 $\\mathrm{J}$（焦耳）为单位的能量值。最终输出格式必须是单行，包含一个用方括号括起来的逗号分隔的结果列表，其中每个结果是一个包含三个浮点数 $[E_{\\text{ohmic}}, E_{\\text{polarization}}, E_{\\text{total}}]$ 的列表，四舍五入到六位小数。例如，生成形如 $[[e_{1,o}, e_{1,p}, e_{1,t}], [e_{2,o}, e_{2,p}, e_{2,t}], \\dots]$ 的输出，其中每个 $e_{\\cdot,\\cdot}$ 是一个以 $\\mathrm{J}$ 为单位、四舍五入到六位小数的十进制数。",
            "solution": "用户提供的问题经评估为**有效**。该问题基于标准电路理论，具有科学依据，内部一致，提法恰当，并包含推导唯一且有意义解所需的所有必要信息。\n\n### 基于原理的解决方案设计\n\n该问题要求推导并实现一个解决方案，用以计算电池等效电路模型（ECM）中的能量损失。该模型由一个串联欧姆电阻 $R_s$ 和 $K$ 个极化支路组成。问题陈述“端子电流 $I(t)$ 流经 $R_s$ 并进入每个极化支路。”这一措辞，结合推导“每个极化支路电压 $v_k(t)$”的动力学要求，意味着 $K$ 个极化支路是串联的。在此配置中，相同的电流 $I(t)$ 流过每个支路，使得每个支路电压 $v_k(t)$ 能根据其特定参数（$R_k, C_k$）独立演化。所有支路上的总极化电压是各个支路电压之和，即 $\\sum_{k=1}^K v_k(t)$。\n\n#### 1. 控制动力学推导\n我们考虑单个极化支路 $k$，它由一个电阻 $R_k$ 和一个电容 $C_k$ 并联组成。流入该支路的总电流为 $I(t)$。根据支路内节点的 Kirchhoff 电流定律（KCL），该电流分为电阻分量 $I_{R_k}(t)$ 和电容分量 $I_{C_k}(t)$：\n$$I(t) = I_{R_k}(t) + I_{C_k}(t)$$\n根据 Ohm 定律，通过电阻的电流为 $I_{R_k}(t) = v_k(t)/R_k$。根据电容器的本构关系，通过电容器的电流为 $I_{C_k}(t) = C_k \\frac{dv_k(t)}{dt}$。将这些代入 KCL 方程，得到支路 $k$ 电压 $v_k(t)$ 的一阶线性常微分方程（ODE）：\n$$I(t) = \\frac{v_k(t)}{R_k} + C_k \\frac{dv_k(t)}{dt}$$\n将此方程重排为标准形式，我们得到：\n$$\\frac{dv_k(t)}{dt} + \\frac{1}{R_k C_k} v_k(t) = \\frac{I(t)}{C_k}$$\n将支路的时间常数定义为 $\\tau_k = R_k C_k$，ODE 变为：\n$$\\frac{dv_k(t)}{dt} + \\frac{1}{\\tau_k} v_k(t) = \\frac{I(t)}{C_k}$$\n问题指定了分段恒定电流曲线。对于一个给定的持续时间为 $\\Delta t$、电流恒定为 $I(t) = I_0$ 的时间段，该 ODE 是一个带有常数强迫项的非齐次方程。通解是齐次解和特解之和。\n特解是稳态电压 $v_{k,ss} = I_0 R_k$。\n通解的形式为 $v_k(t) = A e^{-t/\\tau_k} + I_0 R_k$。\n给定该段开始时（$t=0$）的初始电压 $v_{k,init}$，我们可以求解常数 $A$：\n$v_{k,init} = A e^0 + I_0 R_k \\implies A = v_{k,init} - I_0 R_k$。\n因此，该段内的电压演化为：\n$$v_k(t) = (v_{k,init} - I_0 R_k) e^{-t/\\tau_k} + I_0 R_k$$\n持续时间为 $\\Delta t$ 的段结束时的电压可通过计算 $v_k(\\Delta t)$ 得到：\n$$v_{k,final} = (v_{k,init} - I_0 R_k) e^{-\\Delta t/\\tau_k} + I_0 R_k$$\n这个最终电压作为下一段的初始条件。问题陈述所有支路的 $v_k(0) = 0$。\n\n#### 2. 能量耗散推导\n总能量损失 $E_{\\text{total}}$ 是串联电阻 $R_s$ 中的欧姆损失 $E_{\\text{ohmic}}$ 和所有电阻 $R_k$ 上的极化损失 $E_{\\text{polarization}}$ 之和。\n\n**欧姆能量损失（$E_{\\text{ohmic}}$）**\n串联电阻 $R_s$ 中耗散的瞬时功率由 Joule 定律给出：$p_s(t) = I(t)^2 R_s$。由 $M$ 个段组成的循环中耗散的总能量是功率的时间积分，其中第 $j$ 段的电流为 $I_j$，持续时间为 $\\Delta t_j$：\n$$E_{\\text{ohmic}} = \\int_{cycle} I(t)^2 R_s dt = \\sum_{j=1}^{M} \\int_{t_{j-1}}^{t_j} I_j^2 R_s dt$$\n由于 $I_j$ 在每个段内是恒定的，积分很简单：\n$$E_{\\text{ohmic}} = \\sum_{j=1}^{M} I_j^2 R_s \\Delta t_j$$\n\n**极化能量损失（$E_{\\text{polarization}}$）**\n总极化损失是每个极化电阻 $R_k$ 中耗散的能量之和：$E_{\\text{polarization}} = \\sum_{k=1}^{K} E_{R_k}$。单个电阻 $R_k$ 在整个循环中耗散的能量是其瞬时功率耗散 $p_{R_k}(t) = v_k(t)^2 / R_k$ 的时间积分。\n$$E_{R_k} = \\int_{cycle} \\frac{v_k(t)^2}{R_k} dt = \\sum_{j=1}^{M} \\int_{0}^{\\Delta t_j} \\frac{v_{k,j}(t)^2}{R_k} dt$$\n其中 $v_{k,j}(t)$ 是第 $j$ 段期间支路 $k$ 的电压函数。让我们将单个段（电流为 $I_j$，持续时间为 $\\Delta t_j$，初始电压为 $v_{k,j,init}$）的 $v_k(t)$ 推导表达式代入积分：\n$$E_{R_k, j} = \\frac{1}{R_k} \\int_0^{\\Delta t_j} \\left[ (v_{k,j,init} - I_j R_k) e^{-t/\\tau_k} + I_j R_k \\right]^2 dt$$\n令 $A = v_{k,j,init} - I_j R_k$ 和 $B = I_j R_k$。积分变为：\n$$E_{R_k, j} = \\frac{1}{R_k} \\int_0^{\\Delta t_j} \\left( A^2 e^{-2t/\\tau_k} + 2AB e^{-t/\\tau_k} + B^2 \\right) dt$$\n逐项计算积分可得：\n$$E_{R_k, j} = \\frac{1}{R_k} \\left[ A^2 \\frac{\\tau_k}{2} (1 - e^{-2\\Delta t_j/\\tau_k}) + 2AB\\tau_k (1 - e^{-\\Delta t_j/\\tau_k}) + B^2 \\Delta t_j \\right]$$\n通过对所有支路 $k$ 和所有段 $j$ 的 $E_{R_k,j}$ 求和，可以得到总极化能。\n\n#### 3. 算法实现\n该程序将为给定的测试用例集实现推导出的公式。对于每个测试用例：\n1. 初始化 $E_{\\text{ohmic}} = 0$，$E_{\\text{polarization}} = 0$，以及每个支路的初始电压 $v_{k,init} = 0$。\n2. 对于曲线中的每个电流段 $(I_j, \\Delta t_j)$：\n    a. 计算该段的欧姆能量损失 $\\Delta E_{\\text{ohmic}} = I_j^2 R_s \\Delta t_j$，并将其加到 $E_{\\text{ohmic}}$ 上。\n    b. 对于每个极化支路 $k \\in \\{1,\\dots,K\\}$：\n        i. 使用当前段的参数（$I_j, \\Delta t_j$）和支路的当前状态（$v_{k,init}, R_k, C_k$），使用上面的积分公式计算耗散的能量 $E_{R_k,j}$。将其加到 $E_{\\text{polarization}}$ 上。\n        ii. 使用电压演化方程计算该段结束时支路的电压 $v_{k,final}$。这成为下一段的初始电压：$v_{k,init} \\leftarrow v_{k,final}$。\n3. 处理完所有段后，计算总能量损失 $E_{\\text{total}} = E_{\\text{ohmic}} + E_{\\text{polarization}}$。\n4. 存储当前测试用例的三元组 $[E_{\\text{ohmic}}, E_{\\text{polarization}}, E_{\\text{total}}]$，确保最终值四舍五入到六位小数。\n5. 处理完所有测试用例后，将结果格式化为所需的输出字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the battery ECM energy loss problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"Rs\": 0.015,\n            \"branches\": [(0.020, 3000), (0.060, 800)],\n            \"profile\": [(120, 30), (-80, 15), (0, 10)],\n        },\n        {\n            \"Rs\": 0.005,\n            \"branches\": [(0.030, 500)],\n            \"profile\": [(0, 20)],\n        },\n        {\n            \"Rs\": 0.020,\n            \"branches\": [(0.010, 1000), (0.030, 600), (0.050, 400)],\n            \"profile\": [(200, 0.1), (-200, 0.1), (50, 0.05)],\n        },\n        {\n            \"Rs\": 0.010,\n            \"branches\": [(0.050, 2000)],\n            \"profile\": [(-150, 40)],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        e_ohmic, e_polarization = calculate_energy(\n            case[\"Rs\"], case[\"branches\"], case[\"profile\"]\n        )\n        e_total = e_ohmic + e_polarization\n        results.append([\n            round(e_ohmic, 6),\n            round(e_polarization, 6),\n            round(e_total, 6),\n        ])\n\n    # Format the final output string as specified\n    result_str = \"[\" + \",\".join([str(res) for res in results]) + \"]\"\n    print(result_str.replace(\" \", \"\"))\n\ndef calculate_energy(Rs, branches, profile):\n    \"\"\"\n    Calculates ohmic and polarization energy losses for a single test case.\n\n    Args:\n        Rs (float): Ohmic series resistance in Ohms.\n        branches (list of tuples): List of (Rk, Ck) tuples for each polarization branch.\n        profile (list of tuples): List of (I, dt) tuples for each current segment.\n\n    Returns:\n        tuple: A tuple containing (E_ohmic, E_polarization) in Joules.\n    \"\"\"\n    num_branches = len(branches)\n    v_initials = np.zeros(num_branches)\n    Rk_vals = np.array([b[0] for b in branches])\n    Ck_vals = np.array([b[1] for b in branches])\n    tau_vals = Rk_vals * Ck_vals\n\n    total_e_ohmic = 0.0\n    total_e_polarization = 0.0\n\n    for I_seg, dt_seg in profile:\n        # 1. Ohmic Loss Calculation\n        e_ohmic_seg = (I_seg**2) * Rs * dt_seg\n        total_e_ohmic += e_ohmic_seg\n\n        # 2. Polarization Loss Calculation for each branch\n        v_finals = np.zeros(num_branches)\n        for k in range(num_branches):\n            Rk, Ck, tau_k = Rk_vals[k], Ck_vals[k], tau_vals[k]\n            v_init = v_initials[k]\n            \n            e_pol_seg_k = 0\n            if Rk > 0:\n                # Calculate energy dissipated in Rk during the segment\n                # Using the direct integral of v_k(t)^2 / Rk\n                A = v_init - I_seg * Rk\n                B = I_seg * Rk\n\n                # Handle tau_k -> 0 or dt_seg/tau_k being very large/small for stability\n                # np.exp handles large negative exponents by returning 0.\n                if tau_k > 0:\n                    exp_term1 = np.exp(-dt_seg / tau_k)\n                    exp_term2 = np.exp(-2 * dt_seg / tau_k)\n\n                    term1 = (A**2) * (tau_k / 2.0) * (1.0 - exp_term2)\n                    term2 = 2.0 * A * B * tau_k * (1.0 - exp_term1)\n                    term3 = (B**2) * dt_seg\n                else: # Edge case if tau is zero (capacitor is shorted)\n                    term1 = 0\n                    term2 = 0\n                    term3 = (B**2) * dt_seg\n                \n                e_pol_seg_k = (1.0 / Rk) * (term1 + term2 + term3)\n            \n            total_e_polarization += e_pol_seg_k\n\n            # Calculate final voltage for the branch at the end of the segment\n            if tau_k > 0:\n                exp_term1 = np.exp(-dt_seg / tau_k)\n                A = v_init - I_seg * Rk\n                B = I_seg * Rk\n                v_final = A * exp_term1 + B\n            else: # If tau is zero, voltage jumps instantly to steady state\n                v_final = I_seg * Rk\n                \n            v_finals[k] = v_final\n        \n        v_initials = v_finals\n    \n    return total_e_ohmic, total_e_polarization\n\nsolve()\n```"
        }
    ]
}