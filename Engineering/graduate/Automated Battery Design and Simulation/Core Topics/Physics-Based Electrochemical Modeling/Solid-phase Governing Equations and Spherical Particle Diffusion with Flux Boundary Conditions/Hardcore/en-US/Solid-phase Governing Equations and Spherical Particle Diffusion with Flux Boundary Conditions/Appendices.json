{
    "hands_on_practices": [
        {
            "introduction": "Solving the spherical diffusion equation directly can be mathematically cumbersome due to the radial coordinate system. This exercise introduces a powerful analytical technique, a change of variables, that transforms the governing partial differential equation into the well-known one-dimensional heat equation . Mastering this transformation provides a deeper understanding of the problem's mathematical structure and is a key step towards deriving analytical solutions.",
            "id": "3950538",
            "problem": "Consider a single spherical intercalation particle of radius $R$ within a porous electrode of a lithium-ion battery, modeled under the assumptions of radial symmetry and constant solid-phase diffusion coefficient $D_{s}$. Let $c_{s}(r,t)$ denote the solid-phase lithium concentration as a function of radial position $r \\in [0,R]$ and time $t \\geq 0$. The governing relation is based on conservation of mass and Fick’s laws of diffusion in spherical coordinates. Assume that the particle center is symmetry-preserving and the surface exchanges lithium with the surrounding electrolyte through a prescribed molar interfacial flux $j_{s}(t)$, taken positive in the outward direction (from the solid into the electrolyte). The boundary at $r=R$ is therefore subjected to a flux boundary condition consistent with Fick’s first law.\n\nStarting from the conservation of mass for a radially symmetric diffusing species in a sphere and Fick’s first law for the radial flux, derive a radially symmetric spherical diffusion equation for $c_{s}(r,t)$ and then perform the change of variables $u(r,t) = r \\, c_{s}(r,t)$. Show that this transformation yields a one-dimensional heat equation for $u(r,t)$ in the radial coordinate. Derive, from first principles and without invoking unstated shortcut formulas, the corresponding boundary conditions for $u(r,t)$ at $r=0$ and $r=R$ implied by physical regularity at the center and the flux boundary condition at the surface.\n\nReport, as a single row matrix, the three analytic expressions consisting of:\n- the transformed variable $u(r,t)$ in terms of $c_{s}(r,t)$ and $r$,\n- the value of $u(0,t)$ at the center,\n- the value of $\\frac{\\partial u}{\\partial r}(R,t) - \\frac{1}{R} \\, u(R,t)$ at the surface in terms of $j_{s}(t)$, $R$, and $D_{s}$.\n\nAll quantities are symbolic; no numerical evaluation is required. Express all physical quantities in the International System of Units (SI): length in meters, time in seconds, diffusion coefficient in $\\mathrm{m^{2} \\, s^{-1}}$, concentration in $\\mathrm{mol \\, m^{-3}}$, and flux in $\\mathrm{mol \\, m^{-2} \\, s^{-1}}$. Do not attach units in the final boxed answer. If any numerical evaluation were required, the rounding instruction would specify significant figures; however, no rounding is applicable here.",
            "solution": "The problem requires the derivation of a transformed partial differential equation and its corresponding boundary conditions for lithium diffusion in a spherical particle. The derivation proceeds from first principles as outlined.\n\nFirst, we establish the governing equation for the solid-phase lithium concentration, $c_{s}(r,t)$, within the spherical particle. The conservation of mass for a chemical species in the absence of reactions is given by the continuity equation:\n$$\n\\frac{\\partial c_{s}}{\\partial t} + \\nabla \\cdot \\vec{J}_{s} = 0\n$$\nwhere $\\vec{J}_{s}$ is the molar flux vector of lithium. According to Fick's first law of diffusion, this flux is proportional to the concentration gradient:\n$$\n\\vec{J}_{s} = -D_{s} \\nabla c_{s}\n$$\nHere, $D_{s}$ is the constant solid-phase diffusion coefficient. Substituting Fick's first law into the continuity equation yields Fick's second law of diffusion:\n$$\n\\frac{\\partial c_{s}}{\\partial t} - \\nabla \\cdot (D_{s} \\nabla c_{s}) = 0\n$$\nSince $D_{s}$ is assumed to be constant, it can be moved outside the divergence operator:\n$$\n\\frac{\\partial c_{s}}{\\partial t} = D_{s} \\nabla^2 c_{s}\n$$\nThe problem specifies radial symmetry in a spherical coordinate system. Therefore, the concentration $c_{s}$ is a function only of the radial position $r$ and time $t$, i.e., $c_{s} = c_{s}(r,t)$. The Laplacian operator, $\\nabla^2$, in spherical coordinates simplifies under this assumption to:\n$$\n\\nabla^2 = \\frac{1}{r^2} \\frac{\\partial}{\\partial r} \\left( r^2 \\frac{\\partial}{\\partial r} \\right)\n$$\nSubstituting this into Fick's second law gives the governing partial differential equation for $c_{s}(r,t)$:\n$$\n\\frac{\\partial c_{s}}{\\partial t} = D_{s} \\frac{1}{r^2} \\frac{\\partial}{\\partial r} \\left( r^2 \\frac{\\partial c_{s}}{\\partial r} \\right)\n$$\n\nNext, we perform the change of variables as specified: $u(r,t) = r \\, c_{s}(r,t)$. From this definition, we can write $c_{s}(r,t) = \\frac{u(r,t)}{r}$. We now transform the derivatives of $c_{s}$ into derivatives of $u$. The time derivative is:\n$$\n\\frac{\\partial c_{s}}{\\partial t} = \\frac{\\partial}{\\partial t} \\left( \\frac{u}{r} \\right) = \\frac{1}{r} \\frac{\\partial u}{\\partial t}\n$$\nThe first radial derivative is found using the quotient rule:\n$$\n\\frac{\\partial c_{s}}{\\partial r} = \\frac{\\partial}{\\partial r} \\left( \\frac{u}{r} \\right) = \\frac{r \\frac{\\partial u}{\\partial r} - u \\frac{\\partial r}{\\partial r}}{r^2} = \\frac{1}{r} \\frac{\\partial u}{\\partial r} - \\frac{u}{r^2}\n$$\nNow, we substitute these into the diffusion equation for $c_{s}(r,t)$. The left-hand side becomes $\\frac{1}{r} \\frac{\\partial u}{\\partial t}$. For the right-hand side, we first evaluate the term inside the outer derivative:\n$$\nr^2 \\frac{\\partial c_{s}}{\\partial r} = r^2 \\left( \\frac{1}{r} \\frac{\\partial u}{\\partial r} - \\frac{u}{r^2} \\right) = r \\frac{\\partial u}{\\partial r} - u\n$$\nNow, we take the derivative of this expression with respect to $r$:\n$$\n\\frac{\\partial}{\\partial r} \\left( r^2 \\frac{\\partial c_{s}}{\\partial r} \\right) = \\frac{\\partial}{\\partial r} \\left( r \\frac{\\partial u}{\\partial r} - u \\right) = \\left( 1 \\cdot \\frac{\\partial u}{\\partial r} + r \\frac{\\partial^2 u}{\\partial r^2} \\right) - \\frac{\\partial u}{\\partial r} = r \\frac{\\partial^2 u}{\\partial r^2}\n$$\nSubstituting these transformed expressions back into the governing equation for $c_{s}$:\n$$\n\\frac{1}{r} \\frac{\\partial u}{\\partial t} = D_{s} \\frac{1}{r^2} \\left( r \\frac{\\partial^2 u}{\\partial r^2} \\right)\n$$\nSimplifying the right-hand side gives:\n$$\n\\frac{1}{r} \\frac{\\partial u}{\\partial t} = \\frac{D_{s}}{r} \\frac{\\partial^2 u}{\\partial r^2}\n$$\nMultiplying both sides by $r$ (for $r \\neq 0$) yields the one-dimensional heat equation for $u(r,t)$:\n$$\n\\frac{\\partial u}{\\partial t} = D_{s} \\frac{\\partial^2 u}{\\partial r^2}\n$$\n\nFinally, we derive the boundary conditions for $u(r,t)$ at $r=0$ and $r=R$.\n\nAt the center of the sphere, $r=0$, the principle of \"physical regularity\" requires that the concentration $c_{s}(r,t)$ remains finite. Let $c_{s}(0,t)$ be this finite value. The transformed variable is $u(r,t) = r \\, c_{s}(r,t)$. Taking the limit as $r \\to 0$:\n$$\nu(0,t) = \\lim_{r \\to 0} \\left( r \\, c_{s}(r,t) \\right) = 0 \\cdot c_{s}(0,t) = 0\n$$\nThus, the boundary condition at the center is $u(0,t) = 0$.\n\nAt the surface of the sphere, $r=R$, there is a prescribed molar interfacial flux, $j_s(t)$, which is defined as positive in the outward radial direction. This flux must be consistent with Fick's first law for the radial component of the flux vector, $J_{r}$.\n$$\nJ_{r}(R,t) = j_{s}(t)\n$$\nFrom Fick's Law, $J_{r}(r,t) = -D_{s} \\frac{\\partial c_{s}}{\\partial r}$. At the boundary $r=R$, this gives:\n$$\n-D_{s} \\left.\\frac{\\partial c_{s}}{\\partial r}\\right|_{r=R} = j_{s}(t)\n$$\nWe previously derived the expression for $\\frac{\\partial c_{s}}{\\partial r}$ in terms of $u$:\n$$\n\\frac{\\partial c_{s}}{\\partial r} = \\frac{1}{r} \\frac{\\partial u}{\\partial r} - \\frac{u}{r^2}\n$$\nEvaluating this at $r=R$:\n$$\n\\left.\\frac{\\partial c_{s}}{\\partial r}\\right|_{r=R} = \\frac{1}{R} \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=R} - \\frac{u(R,t)}{R^2}\n$$\nSubstituting this into the flux boundary condition equation:\n$$\n-D_{s} \\left( \\frac{1}{R} \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=R} - \\frac{u(R,t)}{R^2} \\right) = j_{s}(t)\n$$\nTo find the expression required by the problem, we rearrange this equation. First, divide by $-D_{s}$:\n$$\n\\frac{1}{R} \\left.\\frac{\\partial u}{\\partial r}\\right|_{r=R} - \\frac{u(R,t)}{R^2} = -\\frac{j_{s}(t)}{D_{s}}\n$$\nThen, multiply by $R$:\n$$\n\\left.\\frac{\\partial u}{\\partial r}\\right|_{r=R} - \\frac{u(R,t)}{R} = -\\frac{R \\, j_{s}(t)}{D_{s}}\n$$\nThis gives the value of the expression $\\frac{\\partial u}{\\partial r}(R,t) - \\frac{1}{R} u(R,t)$.\n\nThe three required analytic expressions are:\n1. The definition of the transformed variable: $u(r,t) = r \\, c_{s}(r,t)$.\n2. The boundary condition at the center: $u(0,t) = 0$.\n3. The derived expression from the surface boundary condition: $\\frac{\\partial u}{\\partial r}(R,t) - \\frac{1}{R} \\, u(R,t) = -\\frac{R \\, j_{s}(t)}{D_{s}}$.\n\nThese three results are to be reported in a single row matrix.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} r \\, c_{s}(r,t)  0  -\\frac{R \\, j_{s}(t)}{D_{s}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical methods provide crucial insights, simulating realistic battery behavior often requires numerical approaches. This practice transitions from theory to computation by guiding you through the construction of a finite-volume model for spherical diffusion . You will learn to discretize the particle into concentric shells and derive the semi-discrete system of ordinary differential equations, a fundamental skill for developing physics-based battery simulators.",
            "id": "3950513",
            "problem": "You are tasked with deriving and implementing a finite-volume method (FVM) semi-discrete balance for spherical diffusion in the solid phase of a battery active material particle. The governing partial differential equation (PDE) is species conservation with Fickian diffusion in spherical coordinates, written as $$\\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2} \\frac{\\partial}{\\partial r} \\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right),$$ where $c_s$ is the solid-phase concentration in $\\mathrm{mol/m^3}$, $D_s$ is the solid-phase diffusion coefficient in $\\mathrm{m^2/s}$, and $r$ is the radial coordinate in $\\mathrm{m}$. The domain is the sphere of radius $R$. The boundary conditions are center symmetry at $r = 0$ (zero gradient) and a specified surface molar flux at $r = R$ given by $$-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=R} = j_s,$$ where $j_s$ is the outward molar flux in $\\mathrm{mol/(m^2 \\cdot s)}$. Positive $j_s$ indicates net species leaving the particle.\n\nStarting from first principles (species conservation and Fick's law), derive the semi-discrete finite-volume balance for $N$ concentric spherical shells of uniform thickness. The spherical shell faces are located at $$r_{f,j} = j \\frac{R}{N}, \\quad j = 0, 1, \\dots, N,$$ and the cell volumes and face areas must be computed as $$V_i = \\frac{4\\pi}{3} \\left(r_{f,i+1}^3 - r_{f,i}^3\\right), \\quad A_{f,j} = 4\\pi r_{f,j}^2,$$ with $i = 0, 1, \\dots, N-1$. Use a centered difference approximation for the radial gradient at internal faces, i.e., $$\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i+1}} \\approx \\frac{c_{i+1} - c_i}{\\Delta r}, \\quad \\Delta r = \\frac{R}{N}.$$ Implement center symmetry by setting the inner-face flux at $r=0$ to zero, and impose the surface flux boundary condition by using the specified $j_s$ at $r=R$.\n\nYour program must:\n- Construct the semi-discrete operator matrix $\\mathbf{K} \\in \\mathbb{R}^{N \\times N}$ and the source vector $\\mathbf{s} \\in \\mathbb{R}^N$ such that $$\\frac{d\\mathbf{c}}{dt} = \\mathbf{K}\\,\\mathbf{c} + \\mathbf{s},$$ where $\\mathbf{c} = [c_0,\\dots,c_{N-1}]^\\top$ collects the cell-averaged concentrations.\n- For each test case, compute the instantaneous time derivative $\\frac{d\\mathbf{c}}{dt}$ given the initial $\\mathbf{c}$, and also compute the total mass rate of change $$\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$$ in $\\mathrm{mol/s}$. By conservation, the exact continuum value is expected to be $$\\frac{dM}{dt} = -4 \\pi R^2 j_s.$$\n- Return, for each test case, the list $$\\left[\\frac{dM}{dt}, \\left(\\frac{dc_0}{dt}\\right), \\left(\\frac{dc_{N-1}}{dt}\\right)\\right],$$ expressed in International System of Units (SI), where $dM/dt$ is in $\\mathrm{mol/s}$ and the concentration time derivatives are in $\\mathrm{mol/(m^3 \\cdot s)}$.\n\nTest suite:\n- Case A (general case): $N = 3$, $R = 5 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 1 \\times 10^{-14}\\ \\mathrm{m^2/s}$, $j_s = 2.5 \\times 10^{-6}\\ \\mathrm{mol/(m^2 \\cdot s)}$, initial $\\mathbf{c} = [25000,\\ 26000,\\ 27000]\\ \\mathrm{mol/m^3}$.\n- Case B (boundary case $N=1$, zero flux): $N = 1$, $R = 1 \\times 10^{-6}\\ \\mathrm{m}$, $D_s = 5 \\times 10^{-15}\\ \\mathrm{m^2/s}$, $j_s = 0\\ \\mathrm{mol/(m^2 \\cdot s)}$, initial $\\mathbf{c} = [30000]\\ \\mathrm{mol/m^3}$.\n- Case C (edge case with high resolution and uniform initial concentration): $N = 50$, $R = 1 \\times 10^{-5}\\ \\mathrm{m}$, $D_s = 2 \\times 10^{-14}\\ \\mathrm{m^2/s}$, $j_s = 1 \\times 10^{-5}\\ \\mathrm{mol/(m^2 \\cdot s)}$, initial $\\mathbf{c}$ is the constant vector of length $50$ with entries $20000\\ \\mathrm{mol/m^3}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list in the form $[\\frac{dM}{dt}, \\frac{dc_0}{dt}, \\frac{dc_{N-1}}{dt}]$. For example: $$[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3]].$$",
            "solution": "The user has provided a well-posed and scientifically grounded problem statement in the field of computational materials science and battery modeling. The problem asks for the derivation and implementation of a finite-volume method (FVM) for spherical diffusion. I will proceed with the solution.\n\n### **Problem Validation**\n\n**Step 1: Extract Givens**\n- **Governing PDE**: Species conservation for concentration $c_s(\\mathrm{mol/m^3})$ in spherical coordinates.\n$$ \\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2} \\frac{\\partial}{\\partial r} \\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right) $$\n- **Domain**: A sphere of radius $R(\\mathrm{m})$.\n- **Parameters**: $D_s$ is the solid-phase diffusion coefficient ($\\mathrm{m^2/s}$), $r$ is the radial coordinate ($\\mathrm{m}$).\n- **Boundary Conditions**:\n  1. Center symmetry at $r=0$: $\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=0} = 0$.\n  2. Specified surface molar flux at $r=R$: $-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=R} = j_s$, where $j_s$ is the outward molar flux ($\\mathrm{mol/(m^2 \\cdot s)}$).\n- **Discretization**: $N$ concentric spherical shells of uniform thickness $\\Delta r = R/N$.\n- **Face locations**: $r_{f,j} = j \\frac{R}{N}$ for $j = 0, 1, \\dots, N$.\n- **Cell volumes**: $V_i = \\frac{4\\pi}{3} \\left(r_{f,i+1}^3 - r_{f,i}^3\\right)$ for $i = 0, 1, \\dots, N-1$.\n- **Face areas**: $A_{f,j} = 4\\pi r_{f,j}^2$.\n- **Gradient Approximation**: Centered difference, $\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i+1}} \\approx \\frac{c_{i+1} - c_i}{\\Delta r}$.\n- **Task**:\n  1. Derive the semi-discrete system $\\frac{d\\mathbf{c}}{dt} = \\mathbf{K}\\,\\mathbf{c} + \\mathbf{s}$, where $\\mathbf{c} = [c_0,\\dots,c_{N-1}]^\\top$.\n  2. Compute $\\frac{d\\mathbf{c}}{dt}$ for given initial conditions.\n  3. Compute the total mass rate of change $\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$.\n  4. Compare $\\frac{dM}{dt}$ with the analytical expectation $-4 \\pi R^2 j_s$.\n  5. Provide results for three specified test cases.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem describes Fickian diffusion in spherical coordinates, a fundamental and widely used model in physics, chemistry, and engineering, particularly for battery electrode particles. The FVM is a standard, robust numerical method for solving conservation laws. All aspects are firmly based on established scientific and mathematical principles.\n- **Well-Posed**: The problem provides a well-defined PDE with appropriate boundary conditions (one Neumann condition at each boundary, which is suitable for this parabolic PDE). The discretization scheme is clearly specified, leading to a unique system of ordinary differential equations (ODEs). A unique solution for the time derivatives exists.\n- **Objective**: The problem is stated using precise mathematical and physical terminology, free of ambiguity or subjective language.\n- **Completeness and Consistency**: All necessary parameters, equations, and numerical approximations are provided. There are no contradictions. The expectation for $\\frac{dM}{dt}$ serves as a consistency check derived from the divergence theorem, which the discrete system is expected to satisfy.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with deriving the solution and implementing the code.\n\n### **Derivation of the Finite-Volume Discretization**\n\nThe derivation begins with the integral form of the species conservation law over a control volume $V_i$, which corresponds to the $i$-th spherical shell extending from radius $r_{f,i}$ to $r_{f,i+1}$.\n$$ \\frac{d}{dt} \\int_{V_i} c_s \\,dV = \\oint_{\\partial V_i} \\mathbf{J} \\cdot d\\mathbf{A} $$\nHere, $\\mathbf{J}$ is the molar flux vector, given by Fick's first law, $\\mathbf{J} = -D_s \\nabla c_s$. In spherical coordinates with only radial dependence, this simplifies to $\\mathbf{J} = J_r \\hat{\\mathbf{r}}$, where $J_r = -D_s \\frac{\\partial c_s}{\\partial r}$.\n\nAssuming the concentration $c_i$ is uniform within each control volume $V_i$ (i.e., $c_i = \\frac{1}{V_i}\\int_{V_i} c_s dV$), the left-hand side becomes $V_i \\frac{dc_i}{dt}$. The right-hand side is the net flux into the volume. The boundary $\\partial V_i$ consists of an inner sphere at $r_{f,i}$ and an outer sphere at $r_{f,i+1}$. The surface integral becomes the flux through the outer face minus the flux through the inner face.\n$$ \\oint_{\\partial V_i} \\mathbf{J} \\cdot d\\mathbf{A} = A_{f,i} J_r(r_{f,i}) - A_{f,i+1} J_r(r_{f,i+1}) $$\nwhere $A_{f,j} = 4\\pi r_{f,j}^2$ is the surface area of the face at radius $r_{f,j}$. The signs correspond to flux into $V_i$ at $r_{f,i}$ and flux out of $V_i$ at $r_{f,i+1}$. Combining these gives the balance equation for cell $i$:\n$$ V_i \\frac{dc_i}{dt} = A_{f,i} \\left(-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i}}\\right) - A_{f,i+1} \\left(-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i+1}}\\right) $$\nDividing by $V_i$:\n$$ \\frac{dc_i}{dt} = \\frac{D_s}{V_i} \\left[ A_{f,i+1} \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i+1}} - A_{f,i} \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,i}} \\right] $$\nNext, we apply the centered difference approximation for the gradients at the internal faces. The gradient at face $r_{f,j}$ between cell $j-1$ and cell $j$ is approximated as:\n$$ \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,j}} \\approx \\frac{c_j - c_{j-1}}{\\Delta r} \\quad \\text{for } j=1, \\dots, N-1 $$\nwhere $\\Delta r = R/N$ is the distance between cell centers.\n\nWe now formulate the equations for each cell type.\n\n**1. First Cell ($i=0$):**\nThe inner boundary is at $r_{f,0} = 0$. Due to center symmetry, the flux is zero. This is also reflected by $A_{f,0} = 4\\pi(0)^2 = 0$. The outer face is at $r_{f,1}$.\n$$ \\frac{dc_0}{dt} = \\frac{D_s}{V_0} \\left[ A_{f,1} \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,1}} - A_{f,0} \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,0}} \\right] = \\frac{D_s A_{f,1}}{V_0} \\left(\\frac{c_1 - c_0}{\\Delta r}\\right) $$\nRearranging gives the components of the first row of $\\mathbf{K}$:\n$$ \\frac{dc_0}{dt} = \\left(-\\frac{D_s A_{f,1}}{V_0 \\Delta r}\\right) c_0 + \\left(\\frac{D_s A_{f,1}}{V_0 \\Delta r}\\right) c_1 $$\n\n**2. Internal Cells ($0  i  N-1$):**\nFor an internal cell $i$, we apply the gradient approximation at both faces $r_{f,i}$ and $r_{f,i+1}$.\n$$ \\frac{dc_i}{dt} = \\frac{D_s}{V_i} \\left[ A_{f,i+1} \\left(\\frac{c_{i+1} - c_i}{\\Delta r}\\right) - A_{f,i} \\left(\\frac{c_i - c_{i-1}}{\\Delta r}\\right) \\right] $$\nRearranging gives the components of the $i$-th row of the tridiagonal matrix $\\mathbf{K}$:\n$$ \\frac{dc_i}{dt} = \\left(\\frac{D_s A_{f,i}}{V_i \\Delta r}\\right) c_{i-1} - \\left(\\frac{D_s (A_{f,i} + A_{f,i+1})}{V_i \\Delta r}\\right) c_i + \\left(\\frac{D_s A_{f,i+1}}{V_i \\Delta r}\\right) c_{i+1} $$\n\n**3. Last Cell ($i=N-1$):**\nThe inner face is at $r_{f,N-1}$. The outer face is at $r_{f,N}=R$, where the flux condition $-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=R} = j_s$ is applied.\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = A_{f,N-1} \\left(-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,N-1}}\\right) - A_{f,N} \\left(-D_s \\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r_{f,N}}\\right) $$\nSubstituting the gradient approximation for the inner face and the given flux for the outer face:\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = A_{f,N-1} \\left(-D_s \\frac{c_{N-1} - c_{N-2}}{\\Delta r}\\right) - A_{f,N} j_s $$\n$$ V_{N-1} \\frac{dc_{N-1}}{dt} = D_s \\frac{A_{f,N-1}}{\\Delta r} (c_{N-2} - c_{N-1}) - A_{f,N} j_s $$\nDividing by $V_{N-1}$ and separating terms gives the last row of $\\mathbf{K}$ and the source vector $\\mathbf{s}$:\n$$ \\frac{dc_{N-1}}{dt} = \\left(\\frac{D_s A_{f,N-1}}{V_{N-1} \\Delta r}\\right) c_{N-2} - \\left(\\frac{D_s A_{f,N-1}}{V_{N-1} \\Delta r}\\right) c_{N-1} - \\frac{A_{f,N}}{V_{N-1}} j_s $$\nTherefore, the only non-zero element in the source vector $\\mathbf{s}$ is $s_{N-1} = -\\frac{A_{f,N}}{V_{N-1}} j_s$.\n\n**4. Special Case ($N=1$):**\nWhen $N=1$, there is a single control volume from $r=0$ to $r=R$.\n$$ V_0 \\frac{dc_0}{dt} = A_{f,0} J_r(r_{f,0}) - A_{f,1} J_r(r_{f,1}) $$\nThe flux at the center ($r_{f,0}=0$) is zero. The flux density at the surface ($r_{f,1}=R$) is given by $j_s$, so the molar rate leaving is $A_{f,1} j_s$.\n$$ V_0 \\frac{dc_0}{dt} = 0 - A_{f,1} j_s \\implies \\frac{dc_0}{dt} = -\\frac{A_{f,1}}{V_0} j_s $$\nSince $V_0 = \\frac{4\\pi}{3} R^3$ and $A_{f,1} = 4\\pi R^2$, this simplifies to $\\frac{dc_0}{dt} = -\\frac{3}{R}j_s$. In matrix form, for $N=1$, $\\mathbf{K} = [[0]]$ and $\\mathbf{s} = [-\\frac{3j_s}{R}]$.\n\n**5. Total Mass Conservation Check:**\nThe total molar rate of change is $\\frac{dM}{dt} = \\sum_{i=0}^{N-1} V_i \\frac{dc_i}{dt}$.\n$$ \\frac{dM}{dt} = V_0 \\frac{dc_0}{dt} + \\sum_{i=1}^{N-2} V_i \\frac{dc_i}{dt} + V_{N-1} \\frac{dc_{N-1}}{dt} $$\nSubstituting the expressions for $V_i \\frac{dc_i}{dt}$:\n$$ \\frac{dM}{dt} = \\left[D_s \\frac{A_{f,1}}{\\Delta r}(c_1-c_0)\\right] + \\sum_{i=1}^{N-2} \\left[D_s \\frac{A_{f,i}}{\\Delta r}(c_{i-1}-c_i) - D_s \\frac{A_{f,i+1}}{\\Delta r}(c_{i+1}-c_i)\\right] + \\left[D_s \\frac{A_{f,N-1}}{\\Delta r}(c_{N-2}-c_{N-1}) - A_{f,N}j_s\\right] $$\nThis is a telescoping sum. Let $m_j = D_s \\frac{A_{f,j}}{\\Delta r}(c_{j-1}-c_j)$ be the molar rate between cells. The sum is:\n$$ \\frac{dM}{dt} = (-m_1) + \\sum_{i=1}^{N-2} (m_i - m_{i+1}) + (m_{N-1} - A_{f,N}j_s) = -m_1 + (m_1-m_2) + \\dots + (m_{N-2}-m_{N-1}) + m_{N-1} - A_{f,N}j_s $$\nAll internal flux terms cancel out, leaving:\n$$ \\frac{dM}{dt} = -A_{f,N} j_s = -4\\pi R^2 j_s $$\nThis confirms that the discrete scheme is conservative and perfectly captures the total mass change, which is solely dictated by the flux at the outer boundary. The numerical implementation should reproduce this result up to machine precision.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    \"\"\"\n\n    def calculate_derivatives(N, R, Ds, js, c_initial):\n        \"\"\"\n        Calculates the time derivatives of concentrations in a spherical particle\n        using a finite-volume method.\n\n        Args:\n            N (int): Number of concentric shells.\n            R (float): Particle radius in meters.\n            Ds (float): Solid-phase diffusion coefficient in m^2/s.\n            js (float): Molar flux at the surface in mol/(m^2*s).\n            c_initial (list or np.ndarray): Initial concentrations in each shell in mol/m^3.\n\n        Returns:\n            list: A list containing [dM/dt, dc0/dt, dc(N-1)/dt].\n        \"\"\"\n        c_initial = np.array(c_initial, dtype=float)\n        \n        # 1. Calculate geometric properties\n        dr = R / N\n        r_f = np.linspace(0, R, N + 1)\n        A_f = 4.0 * np.pi * r_f**2\n        V = (4.0/3.0) * np.pi * (r_f[1:]**3 - r_f[:-1]**3)\n\n        # 2. Initialize matrix K and vector s\n        K = np.zeros((N, N), dtype=float)\n        s = np.zeros(N, dtype=float)\n\n        # 3. Handle N=1 case separately\n        if N == 1:\n            if V[0] > 1e-30:  # Avoid division by zero\n                s[0] = -A_f[1] / V[0] * js\n            # K remains a zero matrix\n        else:\n            # 4. Populate K and s for N > 1\n            # First cell (i=0)\n            # Factor = D_s * A_f / (V * dr)\n            term0 = Ds * A_f[1] / (V[0] * dr)\n            K[0, 0] = -term0\n            K[0, 1] = term0\n            \n            # Internal cells (i=1 to N-2)\n            for i in range(1, N - 1):\n                term_left = Ds * A_f[i] / (V[i] * dr)\n                term_right = Ds * A_f[i+1] / (V[i] * dr)\n                K[i, i-1] = term_left\n                K[i, i] = -(term_left + term_right)\n                K[i, i+1] = term_right\n            \n            # Last cell (i=N-1)\n            term_last = Ds * A_f[N-1] / (V[N-1] * dr)\n            K[N-1, N-2] = term_last\n            K[N-1, N-1] = -term_last\n            if V[N-1] > 1e-30:\n                s[N-1] = -A_f[N] / V[N-1] * js\n\n        # 5. Calculate concentration time derivatives\n        dcdt = K @ c_initial + s\n\n        # 6. Calculate total mass rate of change\n        dMdt = np.dot(V, dcdt)\n\n        # 7. Extract required results\n        dc0dt = dcdt[0]\n        dcN1dt = dcdt[-1]\n        \n        return [dMdt, dc0dt, dcN1dt]\n\n    test_cases = [\n        # Case A: N=3, R=5e-6, Ds=1e-14, js=2.5e-6, c=[25000, 26000, 27000]\n        (3, 5e-6, 1e-14, 2.5e-6, [25000., 26000., 27000.]),\n        # Case B: N=1, R=1e-6, Ds=5e-15, js=0, c=[30000]\n        (1, 1e-6, 5e-15, 0., [30000.]),\n        # Case C: N=50, R=1e-5, Ds=2e-14, js=1e-5, c=20000 (uniform)\n        (50, 1e-5, 2e-14, 1e-5, [20000.]*50),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = calculate_derivatives(*params)\n        results.append(result)\n\n    # Format the output string precisely as required: [[x1,y1,z1],[x2,y2,z2],...]\n    outer_list_str = []\n    for res in results:\n        inner_list_str = f\"[{res[0]},{res[1]},{res[2]}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "A key challenge in battery simulation is coupling different physical phenomena, and the particle surface is a critical interface where diffusion meets electrochemistry. The lithium flux is not an independent variable but is governed by the Butler-Volmer equation, which depends on the surface concentration. This hands-on exercise delves into the practical problem of approximating this surface concentration in a discrete numerical model and evaluating the impact of different schemes on the accuracy of the calculated flux .",
            "id": "3950493",
            "problem": "Consider a single spherical active material particle of radius $R$ in a lithium-ion battery. The solid-phase concentration $c_s(r,t)$ satisfies Fickian diffusion in spherical coordinates, given by the conservation law and Fick's second law: \n$$\\frac{\\partial c_s}{\\partial t} = \\frac{D_s}{r^2}\\frac{\\partial}{\\partial r}\\left(r^2 \\frac{\\partial c_s}{\\partial r}\\right), \\quad 0 \\le r \\le R,$$\nwith symmetry at the center $r=0$ enforced by $$\\left.\\frac{\\partial c_s}{\\partial r}\\right|_{r=0}=0$$ and a flux boundary condition at the surface $r=R$ enforced by $$\\left.-D_s \\frac{\\partial c_s}{\\partial r}\\right|_{r=R}=J_s.$$\n\nIn automated battery design and simulation, the interfacial molar flux $J_s$ at the surface depends on the Butler–Volmer kinetics through the surface concentration $c_{s,\\mathrm{surf}} = c_s(R,t)$. The current density $j$ (in A/m$^2$) obeys\n$$j = i_0(c_{s,\\mathrm{surf}}, c_e)\\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right],$$\nwhere the exchange current density $i_0(c_{s,\\mathrm{surf}}, c_e)$ is given by\n$$i_0 = k_0 \\, c_e^{\\alpha_e} \\, \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\, \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a}.$$\nThe molar flux is $$J_s = \\frac{j}{F}.$$\nHere, $F$ is the Faraday constant, $R_{\\mathrm{gas}}$ is the universal gas constant, $T$ is temperature, $\\eta$ is overpotential, $k_0$ is a kinetic prefactor, $c_e$ is electrolyte concentration, $c_{s,\\max}$ is the maximum solid concentration, and $\\alpha_a$, $\\alpha_c$, $\\alpha_e$ are charge-transfer coefficients.\n\nIn finite-volume or finite-difference discretizations for spherical particles, the surface concentration $c_{s,\\mathrm{surf}}$ is not directly stored at a node, and must be approximated from near-surface nodes to evaluate the Butler–Volmer relation. Your task is to define and implement numerical procedures to approximate $c_{s,\\mathrm{surf}}$ from the last few near-surface nodes and quantify the impact on the accuracy of $J_s$ evaluation.\n\nAssume a smooth near-surface profile represented locally by a third-order Taylor-like polynomial in the inward distance $x = R - r$,\n$$c_s(r) = c_0 + A x + B x^2 + C x^3,$$\nwhere $c_0 = c_{s,\\mathrm{surf}}$ is the true surface concentration, and $A$, $B$, $C$ are smooth coefficients encoding local gradient and curvature. The near-surface nodes are located at $r_1 = R - h$, $r_2 = R - 2h$, and $r_3 = R - 3h$ for a given grid spacing $h0$, so the corresponding concentrations are $c_1 = c_s(r_1)$, $c_2 = c_s(r_2)$, and $c_3 = c_s(r_3)$.\n\nImplement the following three procedures to approximate $c_{s,\\mathrm{surf}}$ from $\\{c_1,c_2,c_3\\}$:\n- Procedure $P_0$ (nearest-node): $$\\widehat{c}_{s,\\mathrm{surf}}^{(0)} = c_1.$$\n- Procedure $P_1$ (one-sided linear extrapolation using two nodes): $$\\widehat{c}_{s,\\mathrm{surf}}^{(1)} = 2 c_1 - c_2.$$\n- Procedure $P_2$ (quadratic fit to three nodes, extrapolated to $x=0$): determine the quadratic polynomial in $x$ that interpolates $\\{(h,c_1),(2h,c_2),(3h,c_3)\\}$ and evaluate it at $x=0$ to obtain $$\\widehat{c}_{s,\\mathrm{surf}}^{(2)}.$$\n\nFor each procedure, compute the Butler–Volmer current density $j$ and the corresponding molar flux $J_s$ using the approximated $\\widehat{c}_{s,\\mathrm{surf}}$. Quantify its impact by computing the relative error in $J_s$ compared to the true value computed with $c_{s,\\mathrm{surf}}=c_0$:\n$$\\varepsilon = \\frac{\\left|J_s\\left(\\widehat{c}_{s,\\mathrm{surf}}\\right) - J_s\\left(c_0\\right)\\right|}{\\left|J_s\\left(c_0\\right)\\right|}.$$\n\nUse the following test suite of parameter sets, all physically plausible. Unless otherwise stated, constants are shared across the cases: $F = 96485.33212$ C/mol, $R_{\\mathrm{gas}} = 8.314462618$ J/(mol K), $T = 298.15$ K, $\\alpha_a = 0.5$, $\\alpha_c = 0.5$, $\\alpha_e = 0.5$, $k_0 = 2.0$ A m$^{-2}$ (units arranged such that numerical evaluation is self-consistent for this task), $c_{s,\\max} = 3.1\\times 10^4$ mol/m$^3$, and $c_e = 1.0\\times 10^3$ mol/m$^3$.\n\nTest cases (each line is $(R,h,\\eta,c_0,A,B,C)$, with $R$ and $h$ in meters, $\\eta$ in volts, and concentrations in mol/m$^3$; coefficients $A$ in mol m$^{-4}$, $B$ in mol m$^{-5}$, $C$ in mol m$^{-6}$):\n1. $\\left(5.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,5.0\\times 10^{-2},\\,2.5\\times 10^4,\\, -2.0\\times 10^{6},\\, 5.0\\times 10^{12},\\, -2.0\\times 10^{18}\\right)$\n2. $\\left(5.0\\times 10^{-6},\\,1.5\\times 10^{-6},\\,5.0\\times 10^{-2},\\,2.5\\times 10^4,\\, -2.0\\times 10^{6},\\, 5.0\\times 10^{12},\\, -2.0\\times 10^{18}\\right)$\n3. $\\left(5.0\\times 10^{-6},\\,1.0\\times 10^{-6},\\,2.0\\times 10^{-1},\\,0.95\\times 3.1\\times 10^4,\\, -1.0\\times 10^{6},\\, 3.0\\times 10^{12},\\, -1.0\\times 10^{18}\\right)$\n4. $\\left(5.0\\times 10^{-6},\\,5.0\\times 10^{-7},\\,5.0\\times 10^{-2},\\,1.5\\times 10^4,\\, -1.0\\times 10^{5},\\, 0,\\, 0\\right)$\n\nYour program must:\n- For each test case, construct $c_1$, $c_2$, $c_3$ from the polynomial profile with the given $c_0$, $A$, $B$, $C$, $R$, and $h$.\n- Compute $\\widehat{c}_{s,\\mathrm{surf}}^{(0)}$, $\\widehat{c}_{s,\\mathrm{surf}}^{(1)}$, and $\\widehat{c}_{s,\\mathrm{surf}}^{(2)}$.\n- Compute $J_s$ using Butler–Volmer for each approximation and the true $c_0$.\n- Return the relative errors $\\varepsilon^{(0)}$, $\\varepsilon^{(1)}$, and $\\varepsilon^{(2)}$ for the three procedures in the order $P_0$, $P_1$, $P_2$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, one inner list per test case, each inner list ordered as $[\\varepsilon^{(0)}, \\varepsilon^{(1)}, \\varepsilon^{(2)}]$. For example, a valid output for two test cases would look like $[[0.001,0.0001,1.0\\times 10^{-5}],[0.01,0.001,1.0\\times 10^{-4}]]$.\n- The relative errors $\\varepsilon$ are dimensionless; report them as decimal values without any unit.\n\nEnsure scientific realism and derive your design from first principles. The implementation must be general and not hard-code any intermediate formula other than what is required by the definitions given above. The program must be self-contained and require no input. The computations should be numerically well-posed across the specified parameter ranges, and the code must adhere to the runtime environment constraints described elsewhere.",
            "solution": "The problem requires the implementation and evaluation of three numerical procedures for approximating the surface concentration of a spherical active material particle in a lithium-ion battery. The accuracy of these approximations is to be quantified by the relative error they introduce in the calculation of the interfacial molar flux, which is governed by Butler-Volmer kinetics. The solution proceeds through a systematic derivation of the required formulas and an outline of the computational algorithm.\n\nFirst, we analyze the calculation of the molar flux $J_s$ as a function of the solid-phase surface concentration, $c_{s,\\mathrm{surf}}$. The problem provides the Butler-Volmer equation for the current density $j$:\n$$ j = i_0(c_{s,\\mathrm{surf}}, c_e)\\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right] $$\nThe exchange current density, $i_0$, is given by:\n$$ i_0 = k_0 \\, c_e^{\\alpha_e} \\, \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\, \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a} $$\nThe molar flux $J_s$ is related to the current density $j$ by the Faraday constant $F$:\n$$ J_s = \\frac{j}{F} $$\nFor a given test case, the parameters $F$, $R_{\\mathrm{gas}}$, $T$, $\\eta$, $\\alpha_a$, $\\alpha_c$, $\\alpha_e$, $k_0$, $c_e$, and $c_{s,\\max}$ are all constants. Therefore, the flux $J_s$ can be expressed as a function of a single variable, $c_{s,\\mathrm{surf}}$:\n$$ J_s(c_{s,\\mathrm{surf}}) = \\frac{k_0 \\, c_e^{\\alpha_e}}{F} \\left(c_{s,\\max} - c_{s,\\mathrm{surf}}\\right)^{\\alpha_c} \\left(c_{s,\\mathrm{surf}}\\right)^{\\alpha_a} \\left[\\exp\\left(\\frac{\\alpha_a F \\eta}{R_{\\mathrm{gas}} T}\\right) - \\exp\\left(-\\frac{\\alpha_c F \\eta}{R_{\\mathrm{gas}} T}\\right)\\right] $$\nThis function will be used to calculate both the \"true\" flux using the exact surface concentration $c_0$, and the approximate fluxes using the numerically estimated surface concentrations.\n\nNext, we establish the values of the concentration at the near-surface nodes. The problem defines a local concentration profile as a third-order polynomial in the inward radial coordinate $x = R - r$:\n$$ c_s(x) = c_0 + A x + B x^2 + C x^3 $$\nHere, $c_0$ is the true surface concentration $c_{s,\\mathrm{surf}}$, and $A$, $B$, and $C$ are given coefficients. The numerical grid has nodes at $r_1 = R - h$, $r_2 = R - 2h$, and $r_3 = R - 3h$, which correspond to inward distances of $x_1=h$, $x_2=2h$, and $x_3=3h$, respectively. The concentrations at these nodes, denoted $c_1$, $c_2$, and $c_3$, are found by substituting these values of $x$ into the polynomial:\n$$ c_1 = c_s(h) = c_0 + A h + B h^2 + C h^3 $$\n$$ c_2 = c_s(2h) = c_0 + A(2h) + B(2h)^2 + C(2h)^3 = c_0 + 2Ah + 4Bh^2 + 8Ch^3 $$\n$$ c_3 = c_s(3h) = c_0 + A(3h) + B(3h)^2 + C(3h)^3 = c_0 + 3Ah + 9Bh^2 + 27Ch^3 $$\nFor each test case, the parameters $c_0, A, B, C$, and $h$ are provided, allowing for the direct calculation of $c_1$, $c_2$, and $c_3$.\n\nWith the nodal concentrations known, we can implement the three specified procedures to approximate the surface concentration, $\\widehat{c}_{s,\\mathrm{surf}}$. The true value is $c_{s,\\mathrm{surf}} = c_s(x=0) = c_0$.\n\nProcedure $P_0$ (nearest-node approximation): This is the simplest approximation, using the value at the nearest node.\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(0)} = c_1 $$\n\nProcedure $P_1$ (linear extrapolation): This procedure uses a one-sided, two-point formula to extrapolate to the surface. It is equivalent to passing a line through the points $(2h, c_2)$ and $(h, c_1)$ and finding its intercept at $x=0$. The formula is given as:\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(1)} = 2 c_1 - c_2 $$\nThis can be seen as canceling the first-order term in a Taylor expansion around the surface.\n\nProcedure $P_2$ (quadratic extrapolation): This procedure involves fitting a quadratic polynomial $p(x) = \\gamma + \\beta x + \\alpha x^2$ to the three points $(h, c_1)$, $(2h, c_2)$, and $(3h, c_3)$, and evaluating it at $x=0$ to find the approximation $\\widehat{c}_{s,\\mathrm{surf}}^{(2)} = p(0) = \\gamma$. This leads to the following system of linear equations for the coefficients $\\gamma, \\beta, \\alpha$:\n$$ c_1 = \\gamma + \\beta h + \\alpha h^2 $$\n$$ c_2 = \\gamma + \\beta (2h) + \\alpha (2h)^2 $$\n$$ c_3 = \\gamma + \\beta (3h) + \\alpha (3h)^2 $$\nWe only need to solve for $\\gamma$. Using elementary row operations or Cramer's rule, one can derive a direct expression for $\\gamma$ in terms of $c_1$, $c_2$, and $c_3$. A standard result from numerical analysis for a uniform grid gives the solution for the extrapolated value at $x=0$ as a linear combination of the function values:\n$$ \\widehat{c}_{s,\\mathrm{surf}}^{(2)} = 3c_1 - 3c_2 + c_3 $$\nThis formula will be used for computation.\n\nFinally, we quantify the impact of each approximation by computing the relative error, $\\varepsilon$, in the resulting molar flux. For each procedure $k \\in \\{0, 1, 2\\}$, we first compute the approximate flux $J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)})$ and the true flux $J_s(c_0)$. The relative error is then:\n$$ \\varepsilon^{(k)} = \\frac{\\left|J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)}) - J_s(c_0)\\right|}{\\left|J_s(c_0)\\right|} $$\nSince the test cases have non-zero overpotential $\\eta$ and the concentrations are within their physical bounds ($0  c_0  c_{s,\\max}$), the denominator $J_s(c_0)$ will be non-zero, ensuring the relative error is well-defined.\n\nThe algorithm implemented in the final program will follow these steps for each test case:\n1.  Receive the parameters $(R, h, \\eta, c_0, A, B, C)$.\n2.  Calculate the nodal concentrations $c_1, c_2, c_3$ using the polynomial profile.\n3.  Calculate the three surface concentration approximations: $\\widehat{c}_{s,\\mathrm{surf}}^{(0)}$, $\\widehat{c}_{s,\\mathrm{surf}}^{(1)}$, and $\\widehat{c}_{s,\\mathrm{surf}}^{(2)}$.\n4.  Calculate the true molar flux $J_s(c_0)$.\n5.  For each approximation $\\widehat{c}_{s,\\mathrm{surf}}^{(k)}$, calculate the approximate flux $J_s(\\widehat{c}_{s,\\mathrm{surf}}^{(k)})$ and the corresponding relative error $\\varepsilon^{(k)}$.\n6.  Collect the three errors $[\\varepsilon^{(0)}, \\varepsilon^{(1)}, \\varepsilon^{(2)}]$ for the current test case.\n7.  After processing all test cases, format the collected results into a single string as specified in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of evaluating surface concentration approximation errors\n    in a battery particle model.\n    \"\"\"\n    # Define physical and electrochemical constants\n    F = 96485.33212  # Faraday constant in C/mol\n    R_GAS = 8.314462618  # Universal gas constant in J/(mol K)\n    T = 298.15  # Temperature in K\n    ALPHA_A = 0.5  # Anodic charge-transfer coefficient\n    ALPHA_C = 0.5  # Cathodic charge-transfer coefficient\n    ALPHA_E = 0.5  # Electrolyte concentration order\n    K0 = 2.0  # Kinetic prefactor (units consistent with A m^-2)\n    C_S_MAX = 3.1e4  # Maximum solid concentration in mol/m^3\n    C_E = 1.0e3  # Electrolyte concentration in mol/m^3\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (R, h, eta, c0, A, B, C)\n        # R [m], h [m], eta [V], c0 [mol/m^3], A [mol/m^4], B [mol/m^5], C [mol/m^6]\n        (5.0e-6, 5.0e-7, 5.0e-2, 2.5e4, -2.0e6, 5.0e12, -2.0e18),\n        (5.0e-6, 1.5e-6, 5.0e-2, 2.5e4, -2.0e6, 5.0e12, -2.0e18),\n        (5.0e-6, 1.0e-6, 2.0e-1, 0.95 * 3.1e4, -1.0e6, 3.0e12, -1.0e18),\n        (5.0e-6, 5.0e-7, 5.0e-2, 1.5e4, -1.0e5, 0.0, 0.0),\n    ]\n\n    def calculate_Js(c_surf, eta):\n        \"\"\"\n        Calculates the molar flux Js based on surface concentration and overpotential.\n        \n        Args:\n            c_surf (float): The surface concentration in mol/m^3.\n            eta (float): The overpotential in V.\n\n        Returns:\n            float: The molar flux Js in mol/(m^2 s).\n        \"\"\"\n        # Ensure concentration is within physical bounds to avoid math domain errors.\n        # This is a precaution; the given test cases should not violate these bounds.\n        if c_surf = 0 or c_surf >= C_S_MAX:\n             # Use a small epsilon to avoid log(0) or power of negative number issues.\n             c_surf = np.clip(c_surf, 1e-9, C_S_MAX - 1e-9)\n\n        # Exchange current density i0\n        i0 = K0 * (C_E**ALPHA_E) * ((C_S_MAX - c_surf)**ALPHA_C) * (c_surf**ALPHA_A)\n        \n        # Overpotential-dependent term from Butler-Volmer equation\n        exp_arg_base = F / (R_GAS * T)\n        exp_term_a = np.exp(ALPHA_A * exp_arg_base * eta)\n        exp_term_c = np.exp(-ALPHA_C * exp_arg_base * eta)\n        overpotential_term = exp_term_a - exp_term_c\n        \n        # Current density j\n        j = i0 * overpotential_term\n        \n        # Molar flux Js\n        Js = j / F\n        \n        return Js\n\n    all_results = []\n    for R, h, eta, c0, A, B, C in test_cases:\n        # Step 1: Construct concentrations at near-surface nodes c1, c2, c3\n        h_sq = h * h\n        h_cb = h_sq * h\n        c1 = c0 + A * h + B * h_sq + C * h_cb\n        \n        h2, h2_sq, h2_cb = 2*h, (2*h)**2, (2*h)**3\n        c2 = c0 + A * h2 + B * h2_sq + C * h2_cb\n        \n        h3, h3_sq, h3_cb = 3*h, (3*h)**2, (3*h)**3\n        c3 = c0 + A * h3 + B * h3_sq + C * h3_cb\n\n        # Step 2: Compute approximated surface concentrations\n        # P0: Nearest-node\n        c_surf_approx_0 = c1\n        # P1: Linear extrapolation\n        c_surf_approx_1 = 2 * c1 - c2\n        # P2: Quadratic extrapolation\n        c_surf_approx_2 = 3 * c1 - 3 * c2 + c3\n        \n        approximations = [c_surf_approx_0, c_surf_approx_1, c_surf_approx_2]\n        \n        # Step 3: Compute true molar flux\n        Js_true = calculate_Js(c0, eta)\n        \n        case_errors = []\n        for c_surf_approx in approximations:\n            # Step 4: Compute approximate molar flux\n            Js_approx = calculate_Js(c_surf_approx, eta)\n            \n            # Step 5: Compute relative error\n            # Denominator will not be zero for the given test cases.\n            error = np.abs(Js_approx - Js_true) / np.abs(Js_true)\n            case_errors.append(error)\n            \n        all_results.append(case_errors)\n\n    # Final print statement in the exact required format.\n    inner_lists = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(inner_lists)}]\")\n\nsolve()\n```"
        }
    ]
}