{
    "hands_on_practices": [
        {
            "introduction": "The thermodynamic factor, $\\Theta(c)$, is fundamentally linked to the free energy landscape of an electrolyte solution and its stability against composition fluctuations. This practice starts from a foundational free-energy model to derive the thermodynamic factor directly, establishing its connection to non-ideal interactions. By analyzing the model's stability criterion, you will see how $\\Theta(c)$ serves as a direct indicator of whether a concentrated electrolyte is thermodynamically stable or prone to phase separation .",
            "id": "3957442",
            "problem": "In automated battery design and simulation frameworks for concentrated electrolytes, free-energy models are integrated into transport and stability analyses. Consider a homogeneous, isothermal electrolyte at fixed temperature $T$, described by the dimensionless concentration variable $c$, defined by $c \\equiv \\tilde{c}/c_{\\mathrm{ref}}$ so that $\\ln c$ is well-defined. Let the Helmholtz free-energy density per unit volume be modeled by\n$$\nG(c) = R T\\, c \\left[\\ln c + \\alpha\\, c\\right],\n$$\nwhere $R$ is the universal gas constant and $\\alpha$ is a real, dimensionless interaction parameter that captures non-ideal mixing effects. Using only standard thermodynamic definitions for homogeneous mixtures, specifically that the chemical potential is given by $\\mu(c) = \\partial G/\\partial c$ and that the activity $a(c)$ satisfies $\\mu(c) = \\mu^{\\circ} + R T \\ln a(c)$, derive the thermodynamic factor\n$$\n\\Theta(c) \\equiv \\frac{d \\ln a}{d \\ln c}\n$$\nin terms of $c$ and $\\alpha$. Then, determine the concentration at which the system is marginally stable with respect to composition fluctuations, according to the convexity criterion based on the second derivative $\\partial^{2} G/\\partial c^{2}$. Express the final answers as closed-form analytic expressions in terms of $c$ and $\\alpha$. Provide your final result as a row vector containing the two entries $\\Theta(c)$ and the marginal-stability concentration $c^{\\ast}$. No numerical approximation or rounding is required.",
            "solution": "The problem is first subjected to validation.\n\n**Step 1: Extract Givens**\n-   System description: A homogeneous, isothermal electrolyte at a fixed temperature $T$.\n-   Concentration variable: $c \\equiv \\tilde{c}/c_{\\mathrm{ref}}$, dimensionless.\n-   Helmholtz free-energy density per unit volume: $G(c) = R T\\, c \\left[\\ln c + \\alpha\\, c\\right]$, where $R$ is the universal gas constant and $\\alpha$ is a real, dimensionless interaction parameter.\n-   Definition of chemical potential: $\\mu(c) = \\partial G/\\partial c$.\n-   Definition of activity $a(c)$: $\\mu(c) = \\mu^{\\circ} + R T \\ln a(c)$, where $\\mu^{\\circ}$ is the standard chemical potential.\n-   Definition of thermodynamic factor: $\\Theta(c) \\equiv \\frac{d \\ln a}{d \\ln c}$.\n-   Marginal stability criterion: The concentration at which the system is marginally stable is determined by the convexity criterion $\\partial^{2} G/\\partial c^{2} = 0$.\n-   Required outputs: An expression for $\\Theta(c)$ and the marginal-stability concentration $c^{\\ast}$.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Groundedness**: The problem is grounded in the principles of chemical thermodynamics. The form of the free energy, $G(c)$, is a simplified regular solution model (also known as a Bragg-Williams or mean-field model), which is a standard pedagogical and research tool in physical chemistry and materials science for describing non-ideal mixtures. The definitions of chemical potential, activity, and the stability criterion are all standard and fundamental.\n-   **Well-Posedness**: The problem is well-posed. It provides all necessary functional forms and definitions to derive the requested quantities. The tasks are specific and admit a unique mathematical solution through direct application of calculus.\n-   **Objectivity**: The problem is stated in precise, objective, and unambiguous language, free from subjective content.\n-   **Conclusion**: The problem does not violate any of the specified invalidity criteria. It is scientifically sound, self-contained, and formalizable.\n\n**Step 3: Verdict and Action**\n-   **Verdict**: The problem is valid.\n-   **Action**: Proceed with the derivation of the solution.\n\nThe solution is derived in two parts, as requested.\n\nFirst, we derive the thermodynamic factor, $\\Theta(c)$.\nThe starting point is the given Helmholtz free-energy density:\n$$\nG(c) = R T c (\\ln c + \\alpha c) = R T (c \\ln c + \\alpha c^2)\n$$\nThe chemical potential $\\mu(c)$ is defined as the partial derivative of $G$ with respect to $c$:\n$$\n\\mu(c) = \\frac{\\partial G}{\\partial c} = \\frac{\\partial}{\\partial c} \\left[ R T (c \\ln c + \\alpha c^2) \\right]\n$$\nHolding $R$ and $T$ constant and applying the product rule and power rule for differentiation, we get:\n$$\n\\mu(c) = R T \\left[ \\left(1 \\cdot \\ln c + c \\cdot \\frac{1}{c}\\right) + 2 \\alpha c \\right] = R T (\\ln c + 1 + 2 \\alpha c)\n$$\nThe activity $a(c)$ is defined by the relation $\\mu(c) = \\mu^{\\circ} + R T \\ln a(c)$, where $\\mu^{\\circ}$ is the chemical potential in the standard state, a constant. We equate the two expressions for $\\mu(c)$:\n$$\n\\mu^{\\circ} + R T \\ln a(c) = R T (\\ln c + 1 + 2 \\alpha c)\n$$\nSolving for $\\ln a(c)$ yields:\n$$\n\\ln a(c) = \\frac{R T (\\ln c + 1 + 2 \\alpha c) - \\mu^{\\circ}}{R T} = \\ln c + 1 + 2 \\alpha c - \\frac{\\mu^{\\circ}}{R T}\n$$\nThe thermodynamic factor $\\Theta(c)$ is defined as $\\Theta(c) = \\frac{d \\ln a}{d \\ln c}$. To evaluate this derivative, we use the chain rule: $\\frac{d f}{d \\ln c} = c \\frac{d f}{d c}$. Applying this to our expression for $\\ln a(c)$:\n$$\n\\Theta(c) = c \\frac{d}{dc} \\left( \\ln c + 1 + 2 \\alpha c - \\frac{\\mu^{\\circ}}{R T} \\right)\n$$\nThe derivative of the constant terms ($1$ and $\\frac{\\mu^{\\circ}}{RT}$) is zero. The derivative of the remaining terms is:\n$$\n\\frac{d}{dc} (\\ln c + 2 \\alpha c) = \\frac{1}{c} + 2 \\alpha\n$$\nSubstituting this back into the expression for $\\Theta(c)$:\n$$\n\\Theta(c) = c \\left( \\frac{1}{c} + 2 \\alpha \\right) = 1 + 2 \\alpha c\n$$\nThis is the first required expression.\n\nSecond, we determine the marginal-stability concentration, $c^{\\ast}$.\nThe stability of the homogeneous mixture with respect to small composition fluctuations is determined by the sign of the second derivative of the free energy, $\\frac{\\partial^{2} G}{\\partial c^{2}}$. The system is stable if this derivative is positive, unstable if negative, and marginally stable if it is zero. We must therefore find the concentration $c^{\\ast}$ that satisfies the condition:\n$$\n\\left. \\frac{\\partial^{2} G}{\\partial c^{2}} \\right|_{c=c^{\\ast}} = 0\n$$\nWe have already computed the first derivative, $\\frac{\\partial G}{\\partial c} = \\mu(c) = R T (\\ln c + 1 + 2 \\alpha c)$. We now differentiate this expression with respect to $c$:\n$$\n\\frac{\\partial^{2} G}{\\partial c^{2}} = \\frac{\\partial}{\\partial c} \\left[ R T (\\ln c + 1 + 2 \\alpha c) \\right] = R T \\left( \\frac{1}{c} + 2 \\alpha \\right)\n$$\nSetting this expression to zero to find $c^{\\ast}$:\n$$\nR T \\left( \\frac{1}{c^{\\ast}} + 2 \\alpha \\right) = 0\n$$\nSince $R$ is a positive constant and the temperature $T$ is assumed to be positive, the term in the parenthesis must be zero:\n$$\n\\frac{1}{c^{\\ast}} + 2 \\alpha = 0\n$$\nSolving for $c^{\\ast}$ gives:\n$$\n\\frac{1}{c^{\\ast}} = -2 \\alpha \\implies c^{\\ast} = -\\frac{1}{2 \\alpha}\n$$\nThis is the second required expression. For $c^{\\ast}$ to be a physically meaningful positive concentration, the interaction parameter $\\alpha$ must be negative.\n\nThe final result is a row vector containing the two derived quantities, $\\Theta(c)$ and $c^{\\ast}$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 + 2 \\alpha c  -\\frac{1}{2\\alpha}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While the thermodynamic factor is a theoretical concept, its value can be determined from tangible experimental measurements like electromotive force (EMF). This exercise provides a practical guide to processing raw EMF data to compute the thermodynamic factor, emphasizing the use of numerical differentiation on experimental data. Furthermore, it addresses the critical and often overlooked distinction between molality-based and molarity-based thermodynamic factors, a crucial detail for building accurate transport models .",
            "id": "3957469",
            "problem": "You are given electromotive force (EMF) data as a function of the natural logarithm of molality at a fixed temperature for the salt lithium hexafluorophosphate (LiPF$_6$) in the mixed solvent Ethylene Carbonate (EC) and Diethyl Carbonate (DEC). The goal is to compute the thermodynamic factor in the molal concentration scale and to quantify the impact of performing the analysis in the molar concentration scale. The thermodynamic factor is a dimensionless quantity defined by the logarithmic sensitivity of activity to the chosen concentration measure and is central to transport modeling in automated battery design and simulation.\n\nFundamental base:\n- The electrochemical potential of an ionic species is given by the definition of chemical potential, where the activity appears logarithmically in the potential.\n- The Nernst equation relates the measured EMF between two solutions to the ratio of activities.\n- Electroneutrality in binary electrolytes and consistent activity definitions are applied.\n- The molality $m$ (in $\\mathrm{mol/kg}$ solvent) and molarity $c$ (in $\\mathrm{mol/L}$ solution) are distinct concentration scales and are related by solution density and salt molar mass in a scientifically consistent manner.\n\nYour program must:\n1. Start from the above fundamental base to construct an algorithm that, given EMF data $E$ tabulated versus $\\ln m$ at fixed temperature $T$, estimates the thermodynamic factor on the molal scale, denoted $\\Theta_m(m)$, by differentiating the EMF with respect to $\\ln m$ and normalizing by thermodynamic constants.\n2. Convert the result to the molar scale $\\Theta_c(c)$ by applying a mathematically rigorous change of variables between $m$ and $c$ using an explicit, physically plausible density model for EC:DEC with LiPF$_6$.\n3. Use numerically stable differentiation on nonuniform grids and interpolate derivatives to the specified evaluation points.\n\nDefinitions and modeling assumptions for this problem:\n- Let $R$ denote the universal gas constant and $F$ denote Faraday's constant. Let $T$ be the absolute temperature in $\\mathrm{K}$.\n- Let $\\rho(m)$ denote the solution density in $\\mathrm{kg/L}$ modeled as a smooth function of $m$ that is strictly positive over the tested range.\n- Let $M_s$ denote the salt molar mass in $\\mathrm{kg/mol}$.\n- The thermodynamic factor on the molal scale is defined as the dimensionless derivative $\\Theta_m(m)$, obtained from the EMF sensitivity to $\\ln m$ at fixed $T$.\n- The molarity $c$ and molality $m$ are related by\n$$\nc(m) = \\frac{m \\, \\rho(m)}{1 + m M_s},\n$$\nand the change-of-variables factor required to convert derivatives from $\\ln m$ to $\\ln c$ must be derived by differentiating $\\ln c(m)$ with respect to $\\ln m$.\n- You must use the following physically plausible density model for EC:DEC with dissolved LiPF$_6$:\n$$\n\\rho(m) = 1.25 + 0.04 m - 0.002 m^2 \\quad \\text{in } \\mathrm{kg/L},\n$$\nvalid for $m \\in [0.1, 2.0]$. Its derivative with respect to $m$ is\n$$\n\\frac{d\\rho}{dm} = 0.04 - 0.004 m.\n$$\n- Use $M_s = 0.1519 \\, \\mathrm{kg/mol}$ for LiPF$_6$ and $T = 298.15 \\, \\mathrm{K}$.\n- EMF values are in $\\mathrm{V}$ and must be treated consistently with the Nernst relation. All outputs for $\\Theta$ are dimensionless.\n\nTest suite (three cases):\n- Case 1 (near-ideal behavior, happy path): Molality grid $m = [0.1, 0.2, 0.5, 1.0, 1.5]$. EMF data constructed by\n$$\nE(m) = E_0 + \\frac{R T}{F} \\ln m,\n$$\nwith $E_0 = 0.15 \\, \\mathrm{V}$. Evaluate $\\Theta_m$ and $\\Theta_c$ at $m^\\star = 1.0$.\n- Case 2 (moderate nonideality, central region): Molality grid $m = [0.2, 0.5, 1.0, 1.3, 1.6]$. EMF data constructed by\n$$\nE(m) = E_0 + \\frac{R T}{F} \\left(\\ln m + \\ln \\gamma_1(m)\\right), \\quad \\ln \\gamma_1(m) = -\\frac{0.5 \\sqrt{m}}{1 + 0.8 m},\n$$\nwith $E_0 = 0.05 \\, \\mathrm{V}$. Evaluate $\\Theta_m$ and $\\Theta_c$ at $m^\\star = 1.0$.\n- Case 3 (stronger nonideality at higher concentration, edge case): Molality grid $m = [0.5, 1.0, 1.5, 2.0]$. EMF data constructed by\n$$\nE(m) = E_0 + \\frac{R T}{F} \\left(\\ln m + \\ln \\gamma_2(m)\\right), \\quad \\ln \\gamma_2(m) = \\frac{0.2 m}{1 + 0.5 m},\n$$\nwith $E_0 = 0.03 \\, \\mathrm{V}$. Evaluate $\\Theta_m$ and $\\Theta_c$ at $m^\\star = 1.5$.\n\nAlgorithmic requirements:\n- Implement a numerically stable estimation of the derivative $\\frac{dE}{d \\ln m}$ by using finite differences on the given nonuniform grids. To do so, compute the derivative of $E$ with respect to $x = \\ln m$ using central differences where possible and one-sided differences at boundaries. If $m^\\star$ is not exactly a grid point, interpolate the derivative to $m^\\star$ on the $m$ domain.\n- Compute the molal thermodynamic factor by appropriately normalizing the derivative with constants $R$, $T$, and $F$.\n- Compute the molar thermodynamic factor by analytically relating $\\frac{d \\ln a}{d \\ln c}$ to $\\frac{d \\ln a}{d \\ln m}$ via the derivative of $\\ln c(m)$ with respect to $\\ln m$ and applying the chain rule. Explicitly use the provided $\\rho(m)$ and $\\frac{d\\rho}{dm}$.\n\nAnswer specification:\n- For each case, return a pair of floats $[\\Theta_m(m^\\star), \\Theta_c(c(m^\\star))]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to a case and is itself a two-element list. For example, an output with three cases must look like:\n`[[\\theta_m^1,\\theta_c^1],[\\theta_m^2,\\theta_c^2],[\\theta_m^3,\\theta_c^3]]`\n- All $\\Theta$ values must be dimensionless decimal floats. Round each reported float to six decimal places.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and complete. It is based on fundamental principles of thermodynamics and electrochemistry, provides all necessary constants, models, and data, and is formulated with precision. No flaws are identified.\n\nThe solution proceeds in three steps: first, establishing the theoretical relationship between the electromotive force ($E$) and the molal thermodynamic factor ($\\Theta_m$); second, deriving the conversion factor to relate the molal thermodynamic factor ($\\Theta_m$) to the molar thermodynamic factor ($\\Theta_c$); and third, outlining the numerical algorithm to implement these calculations.\n\n**1. Derivation of the Molal Thermodynamic Factor ($\\Theta_m$) from EMF Data**\n\nThe problem concerns a concentration cell where the electromotive force ($E$) is a function of the molality ($m$) of the salt $\\text{LiPF}_6$. The chemical potential of the salt, $\\mu$, determines the cell potential. The activity of the salt, $a$, is related to its molality $m$ and mean molal activity coefficient $\\gamma_\\pm$ by $a = (m \\gamma_\\pm)^\\nu$, where $\\nu$ is the number of ions produced per formula unit of salt. For $\\text{LiPF}_6$, $\\nu=2$.\n\nThe Nernst equation relates the EMF to the activity. The problem provides a simplified form of this relationship for the cell in question:\n$$E(m) = E_0 + \\frac{R T}{F} (\\ln m + \\ln \\gamma(m))$$\nwhere $R$ is the universal gas constant, $T$ is the absolute temperature, $F$ is Faraday's constant, and $\\gamma(m)$ represents the effective activity coefficient for the process being measured. The term $\\ln m + \\ln \\gamma(m)$ is equivalent to $\\ln a_s$, where $a_s$ is the activity of the electroactive species on the molal scale. The prefactor $\\frac{RT}{F}$ suggests a one-electron process, consistent with measuring the activity of a single ion like $\\text{Li}^+$.\n\nThe thermodynamic factor on the molal scale, $\\Theta_m(m)$, is defined as the logarithmic derivative of the salt's activity with respect to molality. While formal definitions involve the mean ionic activity coefficient, the problem's structure implies that $\\Theta_m$ should be derived from the sensitivity of the measured EMF. We define $\\Theta_m$ in a way that is consistent with the provided EMF expression. Let's differentiate $E$ with respect to the natural logarithm of molality, $x = \\ln m$:\n$$\\frac{dE}{d \\ln m} = \\frac{d}{d \\ln m} \\left[ E_0 + \\frac{R T}{F} \\ln a_s \\right] = \\frac{R T}{F} \\frac{d \\ln a_s}{d \\ln m}$$\nThe problem asks to obtain the dimensionless thermodynamic factor, $\\Theta_m(m)$, by normalizing this derivative. This normalization is achieved by multiplying by $\\frac{F}{RT}$:\n$$\\Theta_m(m) = \\frac{F}{RT} \\frac{dE}{d \\ln m}$$\nSubstituting the form of the test case EMFs, where $a_s = m\\gamma(m)$:\n$$\\Theta_m(m) = \\frac{d \\ln(m\\gamma(m))}{d \\ln m} = \\frac{d(\\ln m + \\ln \\gamma(m))}{d \\ln m} = 1 + \\frac{d \\ln \\gamma(m)}{d \\ln m}$$\nThis confirms our approach is consistent with standard definitions. The core of the first computational step is thus to numerically evaluate $\\frac{dE}{d \\ln m}$ and scale it appropriately.\n\n**2. Conversion to the Molar Thermodynamic Factor ($\\Theta_c$)**\n\nThe second task is to convert $\\Theta_m$ to its equivalent on the molar concentration scale, $\\Theta_c$. The molarity $c$ (in $\\mathrm{mol/L}$) and molality $m$ (in $\\mathrm{mol/kg}$) are related via the solution density $\\rho$ (in $\\mathrm{kg/L}$) and the salt molar mass $M_s$ (in $\\mathrm{kg/mol}$):\n$$c(m) = \\frac{m \\, \\rho(m)}{1 + m M_s}$$\nThe fundamental activity $a_s$ is a property of the state of the solution and is independent of the choice of concentration scale. Therefore, the thermodynamic factors, defined as the logarithmic derivative of activity with respect to concentration, are related by the chain rule:\n$$\\Theta_c(c) \\equiv \\frac{d \\ln a_s}{d \\ln c} = \\frac{d \\ln a_s}{d \\ln m} \\cdot \\frac{d \\ln m}{d \\ln c} = \\Theta_m(m) \\left( \\frac{d \\ln c}{d \\ln m} \\right)^{-1}$$\nTo find the conversion factor, we compute the derivative $\\frac{d \\ln c}{d \\ln m}$. It is most convenient to start by taking the logarithm of the expression for $c(m)$:\n$$\\ln c = \\ln m + \\ln \\rho(m) - \\ln(1 + m M_s)$$\nNow, we differentiate with respect to $\\ln m$. Using the relation $d(\\ln m) = \\frac{1}{m} dm$:\n$$\\frac{d \\ln c}{d \\ln m} = m \\frac{d(\\ln c)}{dm} = m \\frac{d}{dm} \\left[ \\ln m + \\ln \\rho(m) - \\ln(1 + m M_s) \\right]$$\n$$ = m \\left[ \\frac{1}{m} + \\frac{1}{\\rho(m)} \\frac{d\\rho}{dm} - \\frac{M_s}{1 + m M_s} \\right] $$\n$$ = 1 + \\frac{m}{\\rho(m)} \\frac{d\\rho}{dm} - \\frac{m M_s}{1 + m M_s} $$\nThis expression provides the required conversion factor using the provided density model $\\rho(m)$ and its derivative $\\frac{d\\rho}{dm}$. The molar thermodynamic factor is then:\n$$\\Theta_c(c(m)) = \\Theta_m(m) \\left( 1 + \\frac{m}{\\rho(m)} \\frac{d\\rho}{dm} - \\frac{m M_s}{1 + m M_s} \\right)^{-1}$$\n\n**3. Numerical Algorithm Design**\n\nThe complete algorithm is as follows:\nFor each test case with a molality grid $\\{m_i\\}$, corresponding EMF data $\\{E_i\\}$, and an evaluation molality $m^\\star$:\n1.  **Prepare Data**: Calculate $x_i = \\ln m_i$ for each grid point. The data points are $(x_i, E_i)$.\n2.  **Numerical Differentiation**: Compute the derivative $\\frac{dE}{d \\ln m}$ at each grid point $m_i$. Let the result be $D_i$.\n    - For interior points ($0  i  N-1$): Use the second-order central difference formula:\n      $$D_i = \\frac{E_{i+1} - E_{i-1}}{x_{i+1} - x_{i-1}}$$\n    - For the first point ($i=0$): Use the first-order forward difference formula:\n      $$D_0 = \\frac{E_1 - E_0}{x_1 - x_0}$$\n    - For the last point ($i=N-1$): Use the first-order backward difference formula:\n      $$D_{N-1} = \\frac{E_{N-1} - E_{N-2}}{x_{N-1} - x_{N-2}}$$\n3.  **Interpolation**: If $m^\\star$ is not a grid point, linearly interpolate the computed derivative values $\\{D_i\\}$ on the molality grid $\\{m_i\\}$ to find the derivative $D^\\star$ at $m^\\star$. If $m^\\star$ is a grid point, the corresponding $D_i$ is used directly.\n4.  **Calculate $\\Theta_m(m^\\star)$**: Apply the normalization derived in Section 1:\n    $$\\Theta_m(m^\\star) = D^\\star \\cdot \\frac{F}{R T}$$\n    using the given constants $T = 298.15 \\, \\mathrm{K}$, $R = 8.314462618 \\, \\mathrm{J/(mol \\cdot K)}$, and $F = 96485.33212 \\, \\mathrm{C/mol}$.\n5.  **Calculate $\\Theta_c(c(m^\\star))$**:\n    a. Evaluate the density $\\rho(m^\\star)$ and its derivative $\\frac{d\\rho}{dm}(m^\\star)$ using the provided models:\n       $$\\rho(m^\\star) = 1.25 + 0.04 m^\\star - 0.002 (m^\\star)^2$$\n       $$\\frac{d\\rho}{dm}(m^\\star) = 0.04 - 0.004 m^\\star$$\n    b. Compute the conversion factor at $m^\\star$ using the formula from Section 2:\n       $$ \\text{factor} = 1 + \\frac{m^\\star}{\\rho(m^\\star)} \\frac{d\\rho}{dm}(m^\\star) - \\frac{m^\\star M_s}{1 + m^\\star M_s} $$\n       where $M_s = 0.1519 \\, \\mathrm{kg/mol}$.\n    c. Compute the molar thermodynamic factor:\n       $$ \\Theta_c(c(m^\\star)) = \\frac{\\Theta_m(m^\\star)}{\\text{factor}} $$\n6.  **Store and Format Output**: Store the pair $[\\Theta_m(m^\\star), \\Theta_c(c(m^\\star))]$, rounded to six decimal places, and repeat for all cases. The final output is a list of these pairs.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the thermodynamic factor in molal and molar scales\n    from EMF data for concentrated electrolytes.\n    \"\"\"\n    # Define physical constants\n    R = 8.314462618  # J/(mol.K)\n    F = 96485.33212   # C/mol\n    T = 298.15         # K\n    M_s = 0.1519       # kg/mol for LiPF6\n\n    # Pre-calculate a constant group\n    RT_F = R * T / F  # Volts\n\n    # --- Model Definitions ---\n    def rho(m):\n        \"\"\"Solution density model in kg/L.\"\"\"\n        return 1.25 + 0.04 * m - 0.002 * m**2\n\n    def d_rho_dm(m):\n        \"\"\"Derivative of the density model w.r.t. molality.\"\"\"\n        return 0.04 - 0.004 * m\n\n    # --- Test Case Definitions ---\n    # Case 1: Ideal behavior\n    def E1(m, E0=0.15):\n        return E0 + RT_F * np.log(m)\n\n    # Case 2: Moderate nonideality\n    def E2(m, E0=0.05):\n        ln_gamma = -0.5 * np.sqrt(m) / (1.0 + 0.8 * m)\n        return E0 + RT_F * (np.log(m) + ln_gamma)\n\n    # Case 3: Stronger nonideality\n    def E3(m, E0=0.03):\n        ln_gamma = 0.2 * m / (1.0 + 0.5 * m)\n        return E0 + RT_F * (np.log(m) + ln_gamma)\n\n    test_cases = [\n        {\n            \"m_grid\": np.array([0.1, 0.2, 0.5, 1.0, 1.5]),\n            \"m_star\": 1.0,\n            \"E_func\": E1\n        },\n        {\n            \"m_grid\": np.array([0.2, 0.5, 1.0, 1.3, 1.6]),\n            \"m_star\": 1.0,\n            \"E_func\": E2\n        },\n        {\n            \"m_grid\": np.array([0.5, 1.0, 1.5, 2.0]),\n            \"m_star\": 1.5,\n            \"E_func\": E3\n        }\n    ]\n\n    # --- Main Calculation Loop ---\n    final_results = []\n    for case in test_cases:\n        m_grid = case[\"m_grid\"]\n        m_star = case[\"m_star\"]\n        E_func = case[\"E_func\"]\n\n        # Step 1: Prepare data\n        x_grid = np.log(m_grid)\n        E_grid = E_func(m_grid)\n\n        # Step 2: Numerical Differentiation of E w.r.t. ln(m)\n        dE_dlnm_grid = np.zeros_like(m_grid)\n        n_points = len(m_grid)\n\n        # First point (forward difference)\n        dE_dlnm_grid[0] = (E_grid[1] - E_grid[0]) / (x_grid[1] - x_grid[0])\n\n        # Last point (backward difference)\n        dE_dlnm_grid[-1] = (E_grid[-1] - E_grid[-2]) / (x_grid[-1] - x_grid[-2])\n\n        # Interior points (central difference)\n        for i in range(1, n_points - 1):\n            dE_dlnm_grid[i] = (E_grid[i+1] - E_grid[i-1]) / (x_grid[i+1] - x_grid[i-1])\n\n        # Step 3: Interpolate for the derivative at m_star\n        dE_dlnm_star = np.interp(m_star, m_grid, dE_dlnm_grid)\n\n        # Step 4: Calculate molal thermodynamic factor\n        theta_m = dE_dlnm_star / RT_F\n\n        # Step 5: Calculate molar thermodynamic factor\n        # Evaluate density and its derivative at m_star\n        rho_star = rho(m_star)\n        d_rho_dm_star = d_rho_dm(m_star)\n\n        # Calculate the conversion factor from ln(m) to ln(c) derivative\n        conversion_factor = (\n            1 + (m_star / rho_star) * d_rho_dm_star - (m_star * M_s) / (1 + m_star * M_s)\n        )\n\n        # Calculate theta_c\n        theta_c = theta_m / conversion_factor\n\n        # Round results\n        result_pair = [round(theta_m, 6), round(theta_c, 6)]\n        final_results.append(result_pair)\n\n    # Format final output string\n    output_str_parts = []\n    for pair in final_results:\n        output_str_parts.append(f\"[{pair[0]},{pair[1]}]\")\n    \n    print(f\"[{','.join(output_str_parts)}]\")\n\n\nsolve()\n```"
        },
        {
            "introduction": "To create robust predictive models for batteries, we need to go beyond simple data interpolation and use physically-grounded equations, such as the Pitzer model, to describe electrolyte behavior. This advanced practice guides you through the process of fitting Pitzer parameters to experimental activity coefficient data using weighted nonlinear regression. Crucially, it demonstrates how to propagate the experimental uncertainty into the final computed thermodynamic factor, allowing you to assess the confidence of your model's predictions .",
            "id": "3957461",
            "problem": "You are tasked to design a program that, for symmetric $1:1$ electrolytes at fixed temperature in water, infers Pitzer interaction parameters from experimental mean activity coefficient data and then propagates parameter uncertainty to the thermodynamic factor. The program must implement a weighted nonlinear regression and perform linear uncertainty propagation.\n\nFundamental base and definitions:\n\n- The mean activity coefficient $\\gamma_{\\pm}(m)$ for a symmetric $1:1$ electrolyte in the Pitzer framework (molality basis) is modeled using the following well-tested representation:\n  $$\\ln \\gamma_{\\pm}(m) = -A_{\\gamma} \\frac{\\sqrt{m}}{1 + b \\sqrt{m}} + 2 m \\left( \\beta^{(0)} + \\beta^{(1)} \\, g(\\alpha \\sqrt{m}) \\right) + 2 m^{2} C_{\\phi},$$\n  where $m$ is molality in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$, $A_{\\gamma}$, $b$, and $\\alpha$ are known constants for water at $T = 298.15\\,\\mathrm{K}$, and $(\\beta^{(0)}, \\beta^{(1)}, C_{\\phi})$ are Pitzer parameters to be regressed from data.\n- The Brønsted function $g(x)$ is defined by:\n  $$g(x) = \\frac{1 - e^{-x}}{x}.$$\n- For a symmetric $1:1$ electrolyte, the ionic strength $I$ equals the molality $m$, so $I = m$.\n- The thermodynamic factor $\\Theta(m)$ is defined by the core thermodynamic relation:\n  $$\\Theta(m) = 1 + m \\, \\frac{d \\ln \\gamma_{\\pm}(m)}{d m},$$\n  where $\\Theta(m)$ is dimensionless.\n\nConstants for water at $T = 298.15\\,\\mathrm{K}$ to be used:\n- $A_{\\gamma} = 1.2$ (dimensionless, natural-logarithm base),\n- $b = 1.2$ in $\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$,\n- $\\alpha = 2.0$ in $\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$.\n\nWeighted nonlinear regression specification:\n- Given experimental pairs $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$ with $i = 1, \\dots, N$ and $\\sigma_i$ denoting the standard uncertainty of $\\gamma_{\\pm,i}$, estimate $(\\beta^{(0)}, \\beta^{(1)}, C_{\\phi})$ by minimizing the weighted sum of squares:\n  $$\\chi^2 = \\sum_{i=1}^{N} \\left( \\frac{\\gamma_{\\pm}^{\\text{model}}(m_i; \\beta^{(0)}, \\beta^{(1)}, C_{\\phi}) - \\gamma_{\\pm,i}}{\\sigma_i} \\right)^2,$$\n  where $\\gamma_{\\pm}^{\\text{model}}(m) = \\exp\\left( \\ln \\gamma_{\\pm}(m) \\right)$.\n- Compute the parameter covariance matrix $\\Sigma$ using the Jacobian of the residuals at the solution and the standard weighted least squares linearization:\n  $$\\Sigma = s^2 \\left( J^{\\top} J \\right)^{-1}, \\quad s^2 = \\frac{\\chi^2}{N - P},$$\n  where $P = 3$ is the number of parameters and $J$ is the Jacobian of the residual vector with respect to the parameters.\n\nUncertainty propagation to $\\Theta(m)$:\n- Using linear error analysis, propagate parameter uncertainty to $\\Theta(m)$ at a specified $m^\\star$ via:\n  $$\\mathrm{Var}\\left[ \\Theta(m^\\star) \\right] = \\mathbf{J}_{\\Theta}(m^\\star) \\, \\Sigma \\, \\mathbf{J}_{\\Theta}(m^\\star)^{\\top},$$\n  where $\\mathbf{J}_{\\Theta}(m^\\star) = \\left[ \\frac{\\partial \\Theta}{\\partial \\beta^{(0)}}, \\frac{\\partial \\Theta}{\\partial \\beta^{(1)}}, \\frac{\\partial \\Theta}{\\partial C_{\\phi}} \\right]_{m = m^\\star}$ is the gradient of $\\Theta$ with respect to the parameters evaluated at the fitted parameter values and $m = m^\\star$. Report the propagated standard uncertainty $u_{\\Theta}(m^\\star) = \\sqrt{\\mathrm{Var}\\left[ \\Theta(m^\\star) \\right]}$.\n\nData and test suite:\n- Case $1$ (happy path): experimental $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$ for a symmetric $1:1$ electrolyte\n  - $m$ in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$: $[0.05, 0.10, 0.50, 1.00, 2.00]$,\n  - $\\gamma_{\\pm}$ (dimensionless): $[0.835, 0.803, 0.780, 0.846, 1.028]$,\n  - $\\sigma$ (dimensionless): $[0.005, 0.005, 0.006, 0.006, 0.010]$,\n  - target $m^{\\star} = 0.20$ in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$.\n- Case $2$ (boundary coverage at higher $m$): experimental $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$\n  - $m$: $[0.05, 0.10, 0.50, 1.00, 2.00]$,\n  - $\\gamma_{\\pm}$: $[0.832, 0.799, 0.776, 0.840, 1.036]$,\n  - $\\sigma$: $[0.005, 0.005, 0.006, 0.006, 0.010]$,\n  - target $m^{\\star} = 1.50$ in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$.\n- Case $3$ (edge case with stronger short-range interactions): experimental $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$\n  - $m$: $[0.05, 0.10, 0.50, 1.00, 2.00]$,\n  - $\\gamma_{\\pm}$: $[0.837, 0.806, 0.789, 0.850, 1.016]$,\n  - $\\sigma$: $[0.005, 0.005, 0.006, 0.006, 0.010]$,\n  - target $m^{\\star} = 0.80$ in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$.\n\nProgram requirements and output:\n- Implement the weighted nonlinear regression and linear uncertainty propagation as specified above.\n- Compute for each case the pair $(\\Theta(m^\\star), u_{\\Theta}(m^\\star))$. Both quantities are dimensionless.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\Theta_1, u_{\\Theta,1}, \\Theta_2, u_{\\Theta,2}, \\Theta_3, u_{\\Theta,3}]$, with each value rounded to six decimal places and no units shown.",
            "solution": "The problem requires the implementation of a numerical procedure to infer Pitzer interaction parameters from experimental mean activity coefficient data for a symmetric $1:1$ electrolyte. Following this regression, the uncertainty in the estimated parameters must be propagated to the thermodynamic factor, a key quantity in electrolyte thermodynamics. The process involves weighted nonlinear least squares for parameter estimation and linear error propagation for the uncertainty analysis.\n\nThe foundation of the model is the Pitzer equation for the natural logarithm of the mean molal activity coefficient, $\\gamma_{\\pm}$, for a symmetric $1:1$ electrolyte at a fixed temperature ($T = 298.15\\,\\mathrm{K}$). The equation is given as:\n$$\n\\ln \\gamma_{\\pm}(m) = -A_{\\gamma} \\frac{\\sqrt{m}}{1 + b \\sqrt{m}} + 2 m \\left( \\beta^{(0)} + \\beta^{(1)} \\, g(\\alpha \\sqrt{m}) \\right) + 2 m^{2} C_{\\phi}\n$$\nHere, $m$ is the molality of the electrolyte in $\\mathrm{mol}\\,\\mathrm{kg}^{-1}$. The parameters $A_{\\gamma} = 1.2$, $b = 1.2\\,\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$, and $\\alpha = 2.0\\,\\mathrm{kg}^{1/2}\\,\\mathrm{mol}^{-1/2}$ are given constants. The function $g(x)$ is the Brønsted function, defined as:\n$$\ng(x) = \\frac{1 - e^{-x}}{x}\n$$\nThe parameters to be determined via regression are the Pitzer interaction coefficients: $\\boldsymbol{p} = [\\beta^{(0)}, \\beta^{(1)}, C_{\\phi}]^{\\top}$.\n\n**1. Weighted Nonlinear Regression**\n\nGiven a set of $N$ experimental data points $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$, where $\\sigma_i$ is the standard uncertainty of the measured activity coefficient $\\gamma_{\\pm,i}$, the parameters $\\boldsymbol{p}$ are estimated by minimizing the weighted sum of squared residuals, $\\chi^2$:\n$$\n\\chi^2(\\boldsymbol{p}) = \\sum_{i=1}^{N} \\left( \\frac{\\gamma_{\\pm}^{\\text{model}}(m_i; \\boldsymbol{p}) - \\gamma_{\\pm,i}}{\\sigma_i} \\right)^2\n$$\nwhere $\\gamma_{\\pm}^{\\text{model}}(m; \\boldsymbol{p}) = \\exp(\\ln \\gamma_{\\pm}(m; \\boldsymbol{p}))$ is the value predicted by the Pitzer model. This is a nonlinear least-squares problem, which can be solved numerically using an iterative algorithm such as the Trust Region Reflective method. Such algorithms typically require the Jacobian of the residual vector with respect to the parameters. The $i$-th component of the residual vector is $r_i(\\boldsymbol{p}) = [\\gamma_{\\pm}^{\\text{model}}(m_i; \\boldsymbol{p}) - \\gamma_{\\pm,i}] / \\sigma_i$.\n\nThe Jacobian matrix $J$ has elements $J_{ij} = \\partial r_i / \\partial p_j$. Using the chain rule:\n$$\n\\frac{\\partial r_i}{\\partial p_j} = \\frac{1}{\\sigma_i} \\frac{\\partial \\gamma_{\\pm}^{\\text{model}}(m_i; \\boldsymbol{p})}{\\partial p_j} = \\frac{1}{\\sigma_i} \\gamma_{\\pm}^{\\text{model}}(m_i; \\boldsymbol{p}) \\frac{\\partial \\ln \\gamma_{\\pm}(m_i; \\boldsymbol{p})}{\\partial p_j}\n$$\nThe partial derivatives of $\\ln \\gamma_{\\pm}$ with respect to the parameters are:\n$$\n\\frac{\\partial \\ln \\gamma_{\\pm}}{\\partial \\beta^{(0)}} = 2m\n$$\n$$\n\\frac{\\partial \\ln \\gamma_{\\pm}}{\\partial \\beta^{(1)}} = 2m \\, g(\\alpha \\sqrt{m})\n$$\n$$\n\\frac{\\partial \\ln \\gamma_{\\pm}}{\\partial C_{\\phi}} = 2m^2\n$$\nThese expressions allow for the analytical construction of the Jacobian matrix required by the optimization algorithm.\n\n**2. Parameter Covariance Matrix**\n\nOnce the optimal parameters $\\hat{\\boldsymbol{p}}$ that minimize $\\chi^2$ are found, their statistical uncertainty is described by the covariance matrix $\\Sigma$. Under the assumption of linearity of the model near the solution, the covariance matrix is estimated as:\n$$\n\\Sigma = s^2 (J^{\\top} J)^{-1}\n$$\nwhere $J$ is the Jacobian evaluated at the optimal parameters $\\hat{\\boldsymbol{p}}$. The quantity $s^2$ is the variance of the fit residuals, often estimated as the reduced chi-squared:\n$$\ns^2 = \\frac{\\chi^2(\\hat{\\boldsymbol{p}})}{N - P}\n$$\nwhere $N$ is the number of data points and $P=3$ is the number of fitted parameters.\n\n**3. Thermodynamic Factor and Uncertainty Propagation**\n\nThe thermodynamic factor $\\Theta(m)$ is a measure of the non-ideality gradient of the solution and is defined as:\n$$\n\\Theta(m) = 1 + m \\frac{d \\ln \\gamma_{\\pm}(m)}{d m}\n$$\nTo compute $\\Theta(m)$, we must first find the derivative of $\\ln \\gamma_{\\pm}(m)$ with respect to molality $m$:\n$$\n\\frac{d \\ln \\gamma_{\\pm}}{d m} = \\frac{d}{dm} \\left( -A_{\\gamma} \\frac{\\sqrt{m}}{1 + b \\sqrt{m}} \\right) + \\frac{d}{dm} \\left( 2 m \\beta^{(0)} \\right) + \\frac{d}{dm} \\left( 2 m \\beta^{(1)} g(\\alpha \\sqrt{m}) \\right) + \\frac{d}{dm} \\left( 2 m^2 C_{\\phi} \\right)\n$$\nEvaluating each derivative term by term gives:\n$$\n\\frac{d \\ln \\gamma_{\\pm}}{d m} = -\\frac{A_{\\gamma}}{2\\sqrt{m}(1 + b \\sqrt{m})^2} + 2\\beta^{(0)} + \\beta^{(1)} \\left( g(\\alpha\\sqrt{m}) + e^{-\\alpha\\sqrt{m}} \\right) + 4m C_{\\phi}\n$$\nSubstituting this into the definition of $\\Theta(m)$ yields the full expression:\n$$\n\\Theta(m; \\boldsymbol{p}) = 1 - \\frac{A_{\\gamma}\\sqrt{m}}{2(1+b\\sqrt{m})^2} + 2m\\beta^{(0)} + m\\beta^{(1)}\\left(g(\\alpha\\sqrt{m}) + e^{-\\alpha\\sqrt{m}}\\right) + 4m^2 C_{\\phi}\n$$\nThe uncertainty in the fitted parameters $\\boldsymbol{p}$ propagates to the calculated value of $\\Theta(m)$. Using first-order Taylor expansion (linear error propagation), the variance of $\\Theta$ at a specific molality $m^\\star$ can be approximated as:\n$$\n\\mathrm{Var}\\left[ \\Theta(m^\\star) \\right] = \\mathbf{J}_{\\Theta}(m^\\star) \\, \\Sigma \\, \\mathbf{J}_{\\Theta}(m^\\star)^{\\top}\n$$\nHere, $\\mathbf{J}_{\\Theta}(m^\\star)$ is the gradient (a row vector) of $\\Theta$ with respect to the parameters, evaluated at $\\hat{\\boldsymbol{p}}$ and $m=m^\\star$:\n$$\n\\mathbf{J}_{\\Theta}(m^\\star) = \\left[ \\frac{\\partial \\Theta}{\\partial \\beta^{(0)}}, \\frac{\\partial \\Theta}{\\partial \\beta^{(1)}}, \\frac{\\partial \\Theta}{\\partial C_{\\phi}} \\right]_{m=m^\\star}\n$$\nThe partial derivatives are:\n$$\n\\frac{\\partial \\Theta}{\\partial \\beta^{(0)}} = 2m\n$$\n$$\n\\frac{\\partial \\Theta}{\\partial \\beta^{(1)}} = m \\left( g(\\alpha\\sqrt{m}) + e^{-\\alpha\\sqrt{m}} \\right)\n$$\n$$\n\\frac{\\partial \\Theta}{\\partial C_{\\phi}} = 4m^2\n$$\nThe standard uncertainty in $\\Theta(m^\\star)$ is then $u_{\\Theta}(m^\\star) = \\sqrt{\\mathrm{Var}\\left[ \\Theta(m^\\star) \\right]}$.\n\n**4. Algorithmic Implementation**\n\nFor each case provided:\n1.  The experimental data $\\{ m_i, \\gamma_{\\pm,i}, \\sigma_i \\}$ and target molality $m^\\star$ are defined.\n2.  A nonlinear least-squares solver (`scipy.optimize.least_squares`) is used to find the optimal parameters $\\hat{\\boldsymbol{p}} = [\\hat{\\beta}^{(0)}, \\hat{\\beta}^{(1)}, \\hat{C}_{\\phi}]$ by minimizing $\\chi^2$. An initial guess of $[0,0,0]$ is used for the parameters. The analytical Jacobian is provided to the solver for accuracy and efficiency.\n3.  The parameter covariance matrix $\\Sigma$ is computed from the Jacobian at the solution and the reduced chi-squared value.\n4.  The value of the thermodynamic factor, $\\Theta(m^\\star)$, is calculated using the fitted parameters $\\hat{\\boldsymbol{p}}$.\n5.  The gradient vector $\\mathbf{J}_{\\Theta}(m^\\star)$ is computed.\n6.  The variance $\\mathrm{Var}[\\Theta(m^\\star)]$ and standard uncertainty $u_{\\Theta}(m^\\star)$ are calculated using the formulas for linear error propagation.\n7.  The pair $(\\Theta(m^\\star), u_{\\Theta}(m^\\star))$ is stored.\n\nThis procedure is repeated for all three test cases, and the final results are formatted as requested.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef solve():\n    \"\"\"\n    Solves the Pitzer parameter regression and uncertainty propagation problem.\n    \"\"\"\n    \n    # Constants for water at T = 298.15 K\n    A_gamma = 1.2  # Dimensionless, natural-logarithm base\n    b = 1.2        # kg^(1/2) mol^(-1/2)\n    alpha = 2.0    # kg^(1/2) mol^(-1/2)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"m_data\": np.array([0.05, 0.10, 0.50, 1.00, 2.00]),\n            \"gamma_data\": np.array([0.835, 0.803, 0.780, 0.846, 1.028]),\n            \"sigma_data\": np.array([0.005, 0.005, 0.006, 0.006, 0.010]),\n            \"m_star\": 0.20\n        },\n        {\n            \"m_data\": np.array([0.05, 0.10, 0.50, 1.00, 2.00]),\n            \"gamma_data\": np.array([0.832, 0.799, 0.776, 0.840, 1.036]),\n            \"sigma_data\": np.array([0.005, 0.005, 0.006, 0.006, 0.010]),\n            \"m_star\": 1.50\n        },\n        {\n            \"m_data\": np.array([0.05, 0.10, 0.50, 1.00, 2.00]),\n            \"gamma_data\": np.array([0.837, 0.806, 0.789, 0.850, 1.016]),\n            \"sigma_data\": np.array([0.005, 0.005, 0.006, 0.006, 0.010]),\n            \"m_star\": 0.80\n        }\n    ]\n\n    results = []\n    \n    # --- Model Functions ---\n\n    def g_func(x):\n        \"\"\"Brønsted function g(x) = (1 - exp(-x))/x.\"\"\"\n        # Note: In this problem, m > 0, so x = alpha * sqrt(m) > 0.\n        # No division by zero will occur.\n        return (1.0 - np.exp(-x)) / x\n\n    def ln_gamma_pm_model(m, params):\n        \"\"\"Pitzer model for ln(gamma_pm).\"\"\"\n        beta0, beta1, Cphi = params\n        sqrt_m = np.sqrt(m)\n        term1 = -A_gamma * sqrt_m / (1.0 + b * sqrt_m)\n        term2 = 2.0 * m * (beta0 + beta1 * g_func(alpha * sqrt_m))\n        term3 = 2.0 * m**2 * Cphi\n        return term1 + term2 + term3\n\n    def gamma_pm_model(m, params):\n        \"\"\"Pitzer model for gamma_pm.\"\"\"\n        return np.exp(ln_gamma_pm_model(m, params))\n\n    def residuals(params, m_data, gamma_data, sigma_data):\n        \"\"\"Weighted residuals for least-squares fitting.\"\"\"\n        model_gamma = gamma_pm_model(m_data, params)\n        return (model_gamma - gamma_data) / sigma_data\n\n    def jacobian_residuals(params, m_data, gamma_data, sigma_data):\n        \"\"\"Jacobian of the residuals w.r.t. parameters.\"\"\"\n        N = len(m_data)\n        P = len(params)\n        J = np.zeros((N, P))\n        \n        model_gamma_vals = gamma_pm_model(m_data, params)\n        \n        # Derivatives of ln(gamma_pm) w.r.t. parameters\n        d_ln_gamma_d_beta0 = 2.0 * m_data\n        d_ln_gamma_d_beta1 = 2.0 * m_data * g_func(alpha * np.sqrt(m_data))\n        d_ln_gamma_d_Cphi = 2.0 * m_data**2\n\n        # Jacobian columns\n        J[:, 0] = (1.0 / sigma_data) * model_gamma_vals * d_ln_gamma_d_beta0\n        J[:, 1] = (1.0 / sigma_data) * model_gamma_vals * d_ln_gamma_d_beta1\n        J[:, 2] = (1.0 / sigma_data) * model_gamma_vals * d_ln_gamma_d_Cphi\n        \n        return J\n\n    def theta_model(m, params):\n        \"\"\"Thermodynamic factor Theta(m).\"\"\"\n        beta0, beta1, Cphi = params\n        sqrt_m = np.sqrt(m)\n        x = alpha * sqrt_m\n\n        term1 = -A_gamma * sqrt_m / (2.0 * (1.0 + b * sqrt_m)**2)\n        term2 = 2.0 * m * beta0\n        term3 = m * beta1 * (g_func(x) + np.exp(-x))\n        term4 = 4.0 * m**2 * Cphi\n\n        return 1.0 + term1 + term2 + term3 + term4\n\n    def grad_theta(m):\n        \"\"\"Gradient of Theta(m) w.r.t. parameters.\"\"\"\n        sqrt_m = np.sqrt(m)\n        x = alpha * sqrt_m\n\n        d_theta_d_beta0 = 2.0 * m\n        d_theta_d_beta1 = m * (g_func(x) + np.exp(-x))\n        d_theta_d_Cphi = 4.0 * m**2\n        \n        return np.array([d_theta_d_beta0, d_theta_d_beta1, d_theta_d_Cphi])\n\n    # --- Main Loop ---\n    for case in test_cases:\n        m_data = case[\"m_data\"]\n        gamma_data = case[\"gamma_data\"]\n        sigma_data = case[\"sigma_data\"]\n        m_star = case[\"m_star\"]\n\n        # 1. Perform weighted nonlinear regression\n        p0 = [0.0, 0.0, 0.0]  # Initial guess for parameters\n        ls_result = least_squares(\n            residuals,\n            p0,\n            jac=jacobian_residuals,\n            args=(m_data, gamma_data, sigma_data),\n            method='trf'\n        )\n        \n        p_fit = ls_result.x\n        \n        # 2. Compute parameter covariance matrix\n        J = ls_result.jac\n        N = len(m_data)\n        P = len(p_fit)\n        \n        # The cost is 0.5 * sum(residual^2). chi2 is sum(residual^2).\n        chi2 = 2.0 * ls_result.cost\n        s_squared = chi2 / (N - P)\n        \n        try:\n            cov_matrix = s_squared * np.linalg.inv(J.T @ J)\n        except np.linalg.LinAlgError:\n            # In case of singularity, use pseudo-inverse\n            cov_matrix = s_squared * np.linalg.pinv(J.T @ J)\n\n        # 3. Compute Theta and its uncertainty\n        theta_val = theta_model(m_star, p_fit)\n        \n        # 4. Propagate uncertainty\n        J_theta = grad_theta(m_star)\n        var_theta = J_theta @ cov_matrix @ J_theta.T\n        u_theta = np.sqrt(var_theta)\n\n        results.extend([theta_val, u_theta])\n        \n    # Final print statement in the exact required format.\n    # Format to six decimal places.\n    print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}