{
    "hands_on_practices": [
        {
            "introduction": "此项实践为定量分析奠定了基础。您将学习如何使用标准的双点标定技术，将断层扫描重建的原始灰度值转换为一个有意义的物理属性——线性衰减系数（linear attenuation coefficient）。这是连接重建图像与所研究材料物理现实之间鸿沟的关键一步。",
            "id": "3891003",
            "problem": "一个实验室X射线计算机断层扫描（XCT）系统重建了锂离子电池电极的三维体积。在固定的管电压下，经过标准的预处理以减轻束流硬化和环状伪影后，该系统的重建算法（滤波反投影，FBP）产生的体素强度与局部线性衰减系数呈线性关系。X射线透射的正向模型由比尔-朗伯定律给出：对于穿过样品的一束射线，其透射强度满足 $I = I_{0} \\exp\\!\\left(-\\int \\mu(\\mathbf{r})\\, ds\\right)$，其中 $I_{0}$ 是入射强度，$\\mu(\\mathbf{r})$ 是与位置相关的线性衰减系数。由于探测器的增益和偏移，重建恢复的衰减场存在一个未知的仿射变换。\n\n使用在相同有效能量下采集的两个均匀区域进行校准：（i）空气，其在工作能量下的衰减可忽略不计，因此可以取为 $\\,\\mu_{\\text{air}} \\approx 0\\,$，以及（ii）一种具有已知衰减系数 $\\,\\mu_{\\text{ref}}\\,$ 的液体参考材料。在校准区域中测得的平均重建灰度值为 $\\,g_{\\text{air}} = 120\\,$ 和 $\\,g_{\\text{ref}} = 1120\\,$。该参考材料在有效束流能量下的已知衰减为 $\\,\\mu_{\\text{ref}} = 19.2\\,\\text{m}^{-1}\\,$。\n\n在重建的阴极子体积中，分割得出各相的平均灰度值：填充电解质的孔隙 $\\,g_{\\text{el}} = 520\\,$，聚合物粘合剂 $\\,g_{\\text{bi}} = 1620\\,$，活性材料 $\\,g_{\\text{am}} = 3120\\,$，以及导电碳 $\\,g_{\\text{c}} = 920\\,$。假设重建的强度与衰减关系是一个在整个感兴趣的动态范围内都通用的未知仿射映射，并且校准数据直接适用（相同的有效能谱、几何结构和重建设置）。\n\n从比尔-朗伯定律和重建的线性关系出发，使用空气和参考材料的校准数据推导从重建灰度值 $\\,g\\,$ 到线性衰减系数 $\\,\\mu(g)\\,$ 的映射关系。然后，计算所列四种电极相的衰减系数。将每个最终值以 $\\text{m}^{-1}$ 为单位表示，并四舍五入到四位有效数字。按 $\\left[\\mu_{\\text{el}},\\, \\mu_{\\text{bi}},\\, \\mu_{\\text{am}},\\, \\mu_{\\text{c}}\\right]$ 的顺序列出这四个相的值。",
            "solution": "首先将对问题进行验证，以确保其科学基础扎实、提法恰当、客观且完整。\n\n### 步骤1：提取已知条件\n问题陈述中明确给出的数据和条件如下：\n- **正向模型（比尔-朗伯定律）：** $I = I_{0} \\exp(-\\int \\mu(\\mathbf{r})\\, ds)$，其中 $I$ 是透射强度，$I_0$ 是入射强度，$\\mu(\\mathbf{r})$ 是与位置相关的线性衰减系数。\n- **重建模型：** 重建的体素灰度值 $g$ 通过一个未知的仿射变换与局部线性衰减系数 $\\mu$ 相关：$\\mu(g) = A \\cdot g + B$。\n- **校准数据点1（空气）：**\n    - 衰减系数：$\\mu_{\\text{air}} \\approx 0 \\, \\text{m}^{-1}$。\n    - 平均灰度值：$g_{\\text{air}} = 120$。\n- **校准数据点2（参考材料）：**\n    - 衰减系数：$\\mu_{\\text{ref}} = 19.2 \\, \\text{m}^{-1}$。\n    - 平均灰度值：$g_{\\text{ref}} = 1120$。\n- **分割相的灰度值：**\n    - 填充电解质的孔隙：$g_{\\text{el}} = 520$。\n    - 聚合物粘合剂：$g_{\\text{bi}} = 1620$。\n    - 活性材料：$g_{\\text{am}} = 3120$。\n    - 导电碳：$g_{\\text{c}} = 920$。\n- **任务：**\n    1. 推导映射关系 $\\mu(g)$。\n    2. 计算四种电极相的衰减系数：$\\mu_{\\text{el}}, \\mu_{\\text{bi}}, \\mu_{\\text{am}}, \\mu_{\\text{c}}$。\n- **输出要求：**\n    1. 数值单位必须是 $\\text{m}^{-1}$。\n    2. 数值必须四舍五入到四位有效数字。\n    3. 最终答案必须是按 $[\\mu_{\\text{el}},\\, \\mu_{\\text{bi}},\\, \\mu_{\\text{am}},\\, \\mu_{\\text{c}}]$ 顺序排列的行矩阵。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **科学基础扎实：** 该问题基于X射线计算机断层扫描（XCT）的基本原理。比尔-朗伯定律是单色X射线衰减的正确物理模型。经过预处理后，滤波反投影重建的强度与线性衰减系数成线性比例的假设，在定量CT中是一个标准且有效的近似，特别是在固定X射线能谱下、有限范围的材料内。所提供的衰减系数和灰度级的数值对于电池电极的XCT扫描是物理上合理的。该问题在科学上是合理的。\n- **提法恰当：** 问题提供了两个不同的校准点 $(\\mu, g)$ 来确定仿射变换（一条直线）的两个参数。这恰好是获得唯一解所需的信息量。任务是将这个已确定的变换应用于新的输入值，这是一个定义明确的数学过程。该问题是提法恰当的。\n- **客观性：** 问题以材料科学和医学成像领域通用的精确技术语言陈述。所有量都已定义，任务明确无歧义。它不包含主观或基于意见的陈述。\n- **完整性和一致性：** 问题是自洽的。解决问题所需的所有必要数据都已提供，并且在给定信息中没有矛盾之处。\n\n### 步骤3：结论与行动\n该问题有效。这是一个标准的两点校准问题，具有科学合理性、提法恰当、客观且内部一致。现在开始推导解答。\n\n### 解答推导\n问题陈述指出，线性衰减系数 $\\mu$ 与重建灰度值 $g$ 之间的关系是一个仿射映射。这可以表示为一个线性方程：\n$$ \\mu(g) = A \\cdot g + B $$\n其中 $A$ 是斜率（缩放因子），$B$ 是截距（偏移量）。我们的目标是使用提供的两个校准点来确定常数 $A$ 和 $B$。\n\n两个校准点是 $(\\mu_{\\text{air}}, g_{\\text{air}})$ 和 $(\\mu_{\\text{ref}}, g_{\\text{ref}})$。我们可以将它们代入仿射方程，形成一个由两个线性方程组成的方程组：\n1. $\\mu_{\\text{air}} = A \\cdot g_{\\text{air}} + B$\n2. $\\mu_{\\text{ref}} = A \\cdot g_{\\text{ref}} + B$\n\n代入给定的数值：\n1. $0 = A \\cdot 120 + B$\n2. $19.2 = A \\cdot 1120 + B$\n\n我们可以解这个方程组求出 $A$ 和 $B$。首先，我们通过方程（2）减去方程（1）来求解斜率 $A$：\n$$ \\mu_{\\text{ref}} - \\mu_{\\text{air}} = (A \\cdot g_{\\text{ref}} + B) - (A \\cdot g_{\\text{air}} + B) $$\n$$ \\mu_{\\text{ref}} - \\mu_{\\text{air}} = A \\cdot (g_{\\text{ref}} - g_{\\text{air}}) $$\n$$ A = \\frac{\\mu_{\\text{ref}} - \\mu_{\\text{air}}}{g_{\\text{ref}} - g_{\\text{air}}} $$\n代入校准点的数值：\n$$ A = \\frac{19.2 - 0}{1120 - 120} = \\frac{19.2}{1000} = 0.0192 $$\n$A$ 的单位是 $\\text{m}^{-1}$ 每灰度单位。\n\n接下来，我们通过重新排列方程（1）来求解截距 $B$：\n$$ B = -A \\cdot g_{\\text{air}} $$\n代入 $A$ 和 $g_{\\text{air}}$ 的值：\n$$ B = -(0.0192) \\cdot 120 = -2.304 $$\n$B$ 的单位是 $\\text{m}^{-1}$。\n\n因此，从灰度值 $g$ 到衰减系数 $\\mu$ 的仿射映射关系为：\n$$ \\mu(g) = 0.0192 \\cdot g - 2.304 $$\n\n现在，我们使用这个映射来计算四种指定电极相的衰减系数。所有结果将以 $\\text{m}^{-1}$ 为单位报告，并四舍五入到四位有效数字。\n\n1.  **填充电解质的孔隙 ($\\mu_{\\text{el}}$):** $g_{\\text{el}} = 520$。\n    $$ \\mu_{\\text{el}} = (0.0192 \\cdot 520) - 2.304 = 9.984 - 2.304 = 7.68 $$\n    四舍五入到四位有效数字得到 $7.680$。\n\n2.  **聚合物粘合剂 ($\\mu_{\\text{bi}}$):** $g_{\\text{bi}} = 1620$。\n    $$ \\mu_{\\text{bi}} = (0.0192 \\cdot 1620) - 2.304 = 31.104 - 2.304 = 28.8 $$\n    四舍五入到四位有效数字得到 $28.80$。\n\n3.  **活性材料 ($\\mu_{\\text{am}}$):** $g_{\\text{am}} = 3120$。\n    $$ \\mu_{\\text{am}} = (0.0192 \\cdot 3120) - 2.304 = 59.904 - 2.304 = 57.6 $$\n    四舍五入到四位有效数字得到 $57.60$。\n\n4.  **导电碳 ($\\mu_{\\text{c}}$):** $g_{\\text{c}} = 920$。\n    $$ \\mu_{\\text{c}} = (0.0192 \\cdot 920) - 2.304 = 17.664 - 2.304 = 15.36 $$\n    这个值已经有四位有效数字。\n\n计算出的四相衰减系数，四舍五入到四位有效数字后为：$\\mu_{\\text{el}} = 7.680\\,\\text{m}^{-1}$，$\\mu_{\\text{bi}} = 28.80\\,\\text{m}^{-1}$，$\\mu_{\\text{am}} = 57.60\\,\\text{m}^{-1}$，以及 $\\mu_{\\text{c}} = 15.36\\,\\text{m}^{-1}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 7.680  28.80  57.60  15.36 \\end{pmatrix}}$$"
        },
        {
            "introduction": "真实世界中的X射线源并非单色的，这会引入非线性效应和伪影，例如“杯状伪影”（cupping artifact）。本练习将深入探讨射束硬化 (beam hardening) 的物理原理，并指导您基于阶梯楔块的标定测量来实现多项式校正。掌握这项技术对于从实验室CT系统中获取准确的定量数据至关重要。",
            "id": "3891025",
            "problem": "给定一个用于重建三维电极微观结构的、有物理基础的X射线断层扫描模型。射线束是多色的，并遵循比尔-朗伯衰减定律。由于能量较低的光子衰减得更强，从而导致从材料厚度到测量线积分的非线性映射，进而产生射线硬化。这种非线性会在均匀校准体模的重建中引入杯状伪影。您的任务是通过拟合已知厚度阶梯楔形块的测量衰减数据，推导出一个多项式射线硬化校正函数，并应用该函数来减轻均匀圆柱体模中的杯状伪影。您必须将该模型和校正方法实现为一个完整的、可运行的程序，并根据下文规定生成单行输出。\n\n基本原理：\n- 单色射线束的比尔-朗伯定律：对于给定的能量 $E$ 和穿过衰减系数为 $\\mu(E)$ 的材料的路径长度 $L$，透射强度为 $I(E;L) = I_{0}(E)\\,\\exp\\!\\left(-\\mu(E)\\,L\\right)$。\n- 对于经过滤波后入射谱为 $S(E)$ 的多色射线束，测量到的强度为 $$I(L) = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\exp\\!\\left(-\\mu(E)\\,L\\right)\\,\\mathrm{d}E,$$ 入射强度为 $$I_{0} = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E.$$\n- 测量的线积分定义为 $$m(L) = -\\ln\\!\\left(\\frac{I(L)}{I_{0}}\\right)。$$\n\n核心定义和建模假设：\n- 材料衰减系数建模为 $$\\mu(E) = \\alpha\\,E^{-3} + \\beta,$$ 该模型包含了光电吸收（与 $E^{-3}$ 成正比）和近似恒定的康普顿散射项。能量 $E$ 的单位是千电子伏特（keV），衰减 $\\mu(E)$ 的单位是反毫米（$\\mathrm{mm}^{-1}$），路径长度 $L$ 的单位是毫米（$\\mathrm{mm}$）。\n- 滤波后的入射谱建模为 $$S(E) = E^{p}\\,\\exp\\!\\left(-\\delta\\,E^{-3}\\,T_{\\mathrm{f}}\\right),$$ 其中 $p$ 是一个参数化源谱形状的非负实指数，$\\delta$ 调节与能量相关的滤波， $T_{\\mathrm{f}}$ 是滤片厚度，单位为毫米（$\\mathrm{mm}$）。此滤波项旨在减少低能成分，以模拟真实的射线硬化缓解效果。\n- 一个次数为 $d$ 的多项式校正函数 $q(m)$ 通过阶梯楔形块的测量数据 $\\{(L_{i},m(L_{i}))\\}$ 进行拟合，以近似逆映射 $L \\approx q(m)$。其系数通过最小二乘法确定，即最小化 $$\\sum_{i} \\left(q\\!\\left(m(L_{i})\\right) - L_{i}\\right)^{2}。$$\n- 一个均匀的圆柱形校准体模半径为 $R$（单位：毫米），其真实的单色参考衰减 $\\mu_{\\mathrm{ref}}$ 在有效能量 $$E_{\\mathrm{eff}} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E\\,S(E)\\,\\mathrm{d}E}{\\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E}$$ 下定义，且 $\\mu_{\\mathrm{ref}} = \\mu(E_{\\mathrm{eff}})$。\n- 对于穿过体模径向位置为 $r$（单位：毫米）的弦，其路径长度为 $$L(r) = 2\\,\\sqrt{R^{2} - r^{2}}。$$ 在忽略射线硬化的朴素重建中，表观衰减可以估计为 $$\\mu_{\\mathrm{naive}}(r) = \\frac{m\\!\\left(L(r)\\right)}{L(r)}。$$ 多项式射线硬化校正将测量的线积分 $m\\!\\left(L(r)\\right)$ 映射为估计的厚度 $L_{\\mathrm{est}}(r) \\approx q\\!\\left(m\\!\\left(L(r)\\right)\\right)$，由此得到校正后的衰减估计值为 $$\\mu_{\\mathrm{corr}}(r) = \\mu_{\\mathrm{ref}}\\,\\frac{L_{\\mathrm{est}}(r)}{L(r)}。$$\n\n杯状伪影度量：\n- 在两个代表性的径向位置，即中心 $r=0$ 和边缘分数 $r = \\rho\\,R$（其中 $0  \\rho  1$），将杯状伪影幅度定义为无量纲的十进制量 $$C_{\\mathrm{before}} = \\frac{\\mu_{\\mathrm{naive}}(\\rho R) - \\mu_{\\mathrm{naive}}(0)}{\\mu_{\\mathrm{ref}}},\\quad C_{\\mathrm{after}} = \\frac{\\mu_{\\mathrm{corr}}(\\rho R) - \\mu_{\\mathrm{corr}}(0)}{\\mu_{\\mathrm{ref}}}。$$ 这些是无量纲比率（答案以十进制小数表示，不带任何百分号）。\n\n需实现的算法：\n- 对于每个测试用例，在 $[E_{\\min},E_{\\max}]$ 上构建一个均匀的能量网格，并使用稳定的求积法（例如，梯形法则）进行数值积分，以获得 $I_{0}$ 和 $I(L)$ 的值。计算楔形块厚度 $\\{L_{i}\\}$ 对应的 $m(L)$，并通过最小二乘法拟合一个将 $m$ 映射到 $L$ 的多项式 $q$。计算 $E_{\\mathrm{eff}}$ 和 $\\mu_{\\mathrm{ref}}$。对于体模，计算 $L(0)$ 和 $L(\\rho R)$，在这两个半径处计算 $\\mu_{\\mathrm{naive}}$ 和 $\\mu_{\\mathrm{corr}}$，最后计算 $C_{\\mathrm{before}}$ 和 $C_{\\mathrm{after}}$。\n\n物理单位：\n- 能量必须以千电子伏特（keV）为单位处理。\n- 路径长度和半径必须以毫米（$\\mathrm{mm}$）为单位处理。\n- 衰减必须以反毫米（$\\mathrm{mm}^{-1}$）为单位处理。\n- 输出的杯状伪影幅度是无量纲的，并且必须以十进制小数表示。\n\n测试套件：\n- 用例1（基线射线硬化）：$E_{\\min} = 20$ $\\mathrm{keV}$，$E_{\\max} = 80$ $\\mathrm{keV}$，$p = 2$，$\\alpha = 80$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$\\beta = 0.015$ $\\mathrm{mm}^{-1}$，$\\delta = 8000$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$T_{\\mathrm{f}} = 1.0$ $\\mathrm{mm}$，$R = 5.0$ $\\mathrm{mm}$，楔形块厚度 $\\{0,1,2,4,8\\}$ $\\mathrm{mm}$，多项式次数 $d=3$，边缘分数 $\\rho=0.9$。\n- 用例2（强滤波，射线硬化减弱）：$E_{\\min} = 20$ $\\mathrm{keV}$，$E_{\\max} = 80$ $\\mathrm{keV}$，$p = 2$，$\\alpha = 80$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$\\beta = 0.015$ $\\mathrm{mm}^{-1}$，$\\delta = 20000$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$T_{\\mathrm{f}} = 2.0$ $\\mathrm{mm}$，$R = 5.0$ $\\mathrm{mm}$，楔形块厚度 $\\{0,1,2,4,8\\}$ $\\mathrm{mm}$，多项式次数 $d=3$，边缘分数 $\\rho=0.9$。\n- 用例3（最少楔形块步数，二次拟合）：$E_{\\min} = 40$ $\\mathrm{keV}$，$E_{\\max} = 80$ $\\mathrm{keV}$，$p = 2$，$\\alpha = 80$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$\\beta = 0.015$ $\\mathrm{mm}^{-1}$，$\\delta = 15000$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$T_{\\mathrm{f}} = 1.5$ $\\mathrm{mm}$，$R = 5.0$ $\\mathrm{mm}$，楔形块厚度 $\\{0,2,8\\}$ $\\mathrm{mm}$，多项式次数 $d=2$，边缘分数 $\\rho=0.9$。\n- 用例4（无滤波，强射线硬化）：$E_{\\min} = 20$ $\\mathrm{keV}$，$E_{\\max} = 80$ $\\mathrm{keV}$，$p = 3$，$\\alpha = 200$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$\\beta = 0.010$ $\\mathrm{mm}^{-1}$，$\\delta = 0$ $\\mathrm{mm}^{-1}\\,\\mathrm{keV}^{3}$，$T_{\\mathrm{f}} = 0.0$ $\\mathrm{mm}$，$R = 5.0$ $\\mathrm{mm}$，楔形块厚度 $\\{0,1,2,3,4,5,6,7,8,9,10\\}$ $\\mathrm{mm}$，多项式次数 $d=4$，边缘分数 $\\rho=0.9$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、逗号分隔的结果列表。每个测试用例贡献一个二元列表 $[C_{\\mathrm{before}},C_{\\mathrm{after}}]$。最终输出必须是这些列表的列表，例如，$$\\big[\\,[c_{1,\\mathrm{before}},c_{1,\\mathrm{after}}],[c_{2,\\mathrm{before}},c_{2,\\mathrm{after}}],\\ldots\\,\\big]。$$",
            "solution": "在尝试给出解决方案之前，用户的问题会经过严格的验证过程。\n\n### 步骤1：提取给定条件\n给定条件从问题陈述中逐字提取。\n\n- **比尔-朗伯定律（单色）**：$I(E;L) = I_{0}(E)\\,\\exp\\!\\left(-\\mu(E)\\,L\\right)$，其中 $E$ 为能量，$L$ 为路径长度，$\\mu(E)$ 为衰减系数，$I_0(E)$ 为入射强度。\n- **比尔-朗伯定律（多色）**：$I(L) = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\exp\\!\\left(-\\mu(E)\\,L\\right)\\,\\mathrm{d}E$，入射强度为 $I_{0} = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E$。此处，$S(E)$ 是入射谱。\n- **测量线积分**：$m(L) = -\\ln\\!\\left(\\frac{I(L)}{I_{0}}\\right)$。\n- **材料衰减系数模型**：$\\mu(E) = \\alpha\\,E^{-3} + \\beta$，其中 $E$ 的单位为 $\\mathrm{keV}$，$\\mu(E)$ 的单位为 $\\mathrm{mm}^{-1}$。\n- **入射谱模型**：$S(E) = E^{p}\\,\\exp\\!\\left(-\\delta\\,E^{-3}\\,T_{\\mathrm{f}}\\right)$，其中 $T_{\\mathrm{f}}$ 是滤片厚度，单位为 $\\mathrm{mm}$。\n- **多项式校正函数**：$L \\approx q(m)$，其中 $q(m)$ 是一个次数为 $d$ 的多项式。其系数通过在一组阶梯楔形块测量数据 $\\{(L_{i},m(L_{i}))\\}$ 上最小化 $\\sum_{i} \\left(q\\!\\left(m(L_{i})\\right) - L_{i}\\right)^{2}$ 来求解。\n- **圆柱体模**：均匀，半径为 $R$ ($\\mathrm{mm}$)。穿过体模径向位置为 $r$ 的路径长度为 $L(r) = 2\\,\\sqrt{R^{2} - r^{2}}$。\n- **有效能量和参考衰减**：$E_{\\mathrm{eff}} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E\\,S(E)\\,\\mathrm{d}E}{\\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E}$ 和 $\\mu_{\\mathrm{ref}} = \\mu(E_{\\mathrm{eff}})$。\n- **朴素衰减**：$\\mu_{\\mathrm{naive}}(r) = \\frac{m\\!\\left(L(r)\\right)}{L(r)}$。\n- **校正后衰减**：$\\mu_{\\mathrm{corr}}(r) = \\mu_{\\mathrm{ref}}\\,\\frac{L_{\\mathrm{est}}(r)}{L(r)}$，其中 $L_{\\mathrm{est}}(r) = q\\!\\left(m\\!\\left(L(r)\\right)\\right)$。\n- **杯状伪影度量**：$C_{\\mathrm{before}} = \\frac{\\mu_{\\mathrm{naive}}(\\rho R) - \\mu_{\\mathrm{naive}}(0)}{\\mu_{\\mathrm{ref}}}$ 和 $C_{\\mathrm{after}} = \\frac{\\mu_{\\mathrm{corr}}(\\rho R) - \\mu_{\\mathrm{corr}}(0)}{\\mu_{\\mathrm{ref}}}$，针对给定的边缘分数 $\\rho$。\n- **算法**：使用求积法进行数值积分，以找到 $I_0$、$I(L)$、$m(L)$ 和 $E_{\\mathrm{eff}}$。通过最小二乘法拟合多项式 $q(m)$。计算体模的衰减和杯状伪影度量。\n- **测试用例1**：$E_{\\min} = 20$，$E_{\\max} = 80$，$p = 2$，$\\alpha = 80$，$\\beta = 0.015$，$\\delta = 8000$，$T_{\\mathrm{f}} = 1.0$，$R = 5.0$，楔形块厚度 $\\{0,1,2,4,8\\}$，$d=3$，$\\rho=0.9$。\n- **测试用例2**：$E_{\\min} = 20$，$E_{\\max} = 80$，$p = 2$，$\\alpha = 80$，$\\beta = 0.015$，$\\delta = 20000$，$T_{\\mathrm{f}} = 2.0$，$R = 5.0$，楔形块厚度 $\\{0,1,2,4,8\\}$，$d=3$，$\\rho=0.9$。\n- **测试用例3**：$E_{\\min} = 40$，$E_{\\max} = 80$，$p = 2$，$\\alpha = 80$，$\\beta = 0.015$，$\\delta = 15000$，$T_{\\mathrm{f}} = 1.5$，$R = 5.0$，楔形块厚度 $\\{0,2,8\\}$，$d=2$，$\\rho=0.9$。\n- **测试用例4**：$E_{\\min} = 20$，$E_{\\max} = 80$，$p = 3$，$\\alpha = 200$，$\\beta = 0.010$，$\\delta = 0$，$T_{\\mathrm{f}} = 0.0$，$R = 5.0$，楔形块厚度 $\\{0,1,2,3,4,5,6,7,8,9,10\\}$，$d=4$，$\\rho=0.9$。\n- **输出格式**：一个由二元列表组成的列表：$\\big[\\,[c_{1,\\mathrm{before}},c_{1,\\mathrm{after}}],[c_{2,\\mathrm{before}},c_{2,\\mathrm{after}}],\\ldots\\,\\big]$。\n\n### 步骤2：使用提取的给定条件进行验证\n根据指定标准对问题进行验证。\n\n- **科学基础**：该问题基于X射线衰减的基本比尔-朗伯定律。能量依赖的衰减系数 $\\mu(E)$ 和多色源谱 $S(E)$ 的模型是对光电吸收、康普顿散射和射线束滤波的物理驱动的近似。射线硬化现象及其导致的杯状伪影是计算机断层扫描中公认的概念。所提出的使用多项式拟合的校正方法是一种标准的实用技术。该问题在科学上是合理的。\n- **适定性**：该问题为每个测试用例提供了一整套方程、参数和清晰的算法流程。其目标是计算特定的数值量。使用最小二乘多项式拟合是一个明确定义的数学过程，对于给定的输入会产生唯一的解。在每种情况下，楔形块测量点的数量都足以满足指定的多项式次数（即，点数 $\\geq$ 次数 $+ 1$）。该问题是适定的。\n- **客观性**：所有定义和任务都以数学精度指定，不含主观或模糊的语言。\n\n该问题没有表现出任何列出的无效缺陷（科学上不合理、非形式化、不完整/矛盾、不切实际、不适定、无聊、无法验证）。\n\n### 步骤3：结论与行动\n问题是**有效的**。将提供解决方案。\n\n### 解决方案推导\n\n该解决方案需要实现一个X射线穿过材料的数值模型，以量化和校正射线硬化伪影。每个测试用例的处理过程如下。\n\n**1. 数值积分框架**\n问题的核心涉及计算形如 $\\int_{E_{\\min}}^{E_{\\max}} f(E)\\,\\mathrm{d}E$ 的积分。由于被积函数的复杂性，这些积分没有封闭形式的解析解。它们必须通过数值方法近似。梯形法是一种稳定且常用的方法。我们建立一个离散的能量网格 $E_j$，以小步长 $\\Delta E$ 覆盖 $[E_{\\min}, E_{\\max}]$ 范围。对于函数 $f(E)$，积分近似为：\n$$ \\int_{E_{\\min}}^{E_{\\max}} f(E)\\,\\mathrm{d}E \\approx \\sum_{j=1}^{N-1} \\frac{f(E_j) + f(E_{j+1})}{2} \\Delta E $$\n其中 $N$ 是能量网格中的点数。一个足够大的 $N$（例如，$N=4096$）将确保结果的准确性。\n\n**2. 物理系统建模**\n实现所提供的物理模型。\n- 能量依赖的衰减系数为：$\\mu(E) = \\alpha\\,E^{-3} + \\beta$。\n- 多色谱为：$S(E) = E^{p}\\,\\exp\\!\\left(-\\delta\\,E^{-3}\\,T_{\\mathrm{f}}\\right)$。在能量接近零时，$E^{-3}$ 会发散；但是，积分范围 $[E_{\\min}, E_{\\max}]$ 中 $E_{\\min}>0$ 避免了此奇点。\n\n使用数值积分框架，我们可以计算给定路径长度 $L$ 的测量强度 $I(L)$：\n$$I(L) = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\exp\\!\\left(-\\left[\\alpha\\,E^{-3} + \\beta\\right]\\,L\\right)\\,\\mathrm{d}E$$\n入射强度 $I_0$ 即为 $L=0$ 时的 $I(L)$：\n$$I_0 = I(0) = \\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E$$\n测量的线积分，代表断层扫描中的原始数据，则为：\n$$m(L) = -\\ln\\!\\left(\\frac{I(L)}{I_{0}}\\right)$$\n由于射线束的多色性，该函数 $m(L)$ 是非线性的，这也是射线硬化伪影的根源。\n\n**3. 通过多项式拟合进行射线硬化校正**\n为了校正非线性，使用具有已知厚度 $\\{L_i\\}$ 的阶梯楔形块进行校准。\n对于每个厚度 $L_i$，使用上述模型计算相应的测量值 $m(L_i)$。这会生成一组数据点 $\\{(m(L_i), L_i)\\}$。\n我们寻求一个次数为 $d$ 的多项式函数 $q(m)$，\n$$q(m) = c_d m^d + c_{d-1} m^{d-1} + \\dots + c_1 m + c_0$$\n该函数能从给定的测量值 $m$ 估算出真实厚度 $L$。系数 $\\{c_j\\}$ 通过解决线性最小二乘问题来确定：\n$$ \\min_{\\{c_j\\}} \\sum_{i} \\left( q(m(L_i)) - L_i \\right)^2 $$\n这是一个标准的程序，在数值库中很容易获得。\n\n**4. 圆柱体模分析**\n在建立了校正函数 $q(m)$ 后，我们分析一个半径为 $R$ 的均匀圆柱体模。\n首先，计算参考衰减 $\\mu_{\\mathrm{ref}}$。这需要射线的有效能量 $E_{\\mathrm{eff}}$：\n$$ E_{\\mathrm{eff}} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E\\,S(E)\\,\\mathrm{d}E}{\\int_{E_{\\min}}^{E_{\\max}} S(E)\\,\\mathrm{d}E} = \\frac{\\int E\\,S(E)\\,\\mathrm{d}E}{I_0} $$\n参考衰减是在此能量下的单色衰减：\n$$ \\mu_{\\mathrm{ref}} = \\mu(E_{\\mathrm{eff}}) = \\alpha\\,E_{\\mathrm{eff}}^{-3} + \\beta $$\n\n接下来，我们在两个径向位置评估体模：中心（$r_1=0$）和边缘（$r_2=\\rho R$）。路径长度为：\n$$ L_1 = L(0) = 2R $$\n$$ L_2 = L(\\rho R) = 2\\sqrt{R^2 - (\\rho R)^2} = 2R\\sqrt{1-\\rho^2} $$\n对于每个路径长度 $L_k$，我们计算相应的测量值 $m_k = m(L_k)$。\n\n**5. 杯状伪影指标计算**\n在校正前后量化杯状伪影。\n- **校正前**：假设线性关系 $\\mu = m/L$ 来计算朴素衰减：\n  $$ \\mu_{\\mathrm{naive}}(r_k) = \\frac{m_k}{L_k} $$\n  校正前的杯状伪影度量是此朴素衰减的归一化差异：\n  $$ C_{\\mathrm{before}} = \\frac{\\mu_{\\mathrm{naive}}(r_2) - \\mu_{\\mathrm{naive}}(r_1)}{\\mu_{\\mathrm{ref}}} $$\n\n- **校正后**：使用多项式函数 $q(m)$ 获得路径长度的校正估计值：\n  $$ L_{\\mathrm{est}}(r_k) = q(m_k) $$\n  然后用参考值对校正后的衰减进行缩放：\n  $$ \\mu_{\\mathrm{corr}}(r_k) = \\mu_{\\mathrm{ref}} \\frac{L_{\\mathrm{est}}(r_k)}{L_k} $$\n  如果校正完美，$L_{\\mathrm{est}}(r_k) \\approx L_k$，因此对所有 $r_k$ 都有 $\\mu_{\\mathrm{corr}}(r_k) \\approx \\mu_{\\mathrm{ref}}$，从而消除了伪影。校正后的杯状伪影度量是：\n  $$ C_{\\mathrm{after}} = \\frac{\\mu_{\\mathrm{corr}}(r_2) - \\mu_{\\mathrm{corr}}(r_1)}{\\mu_{\\mathrm{ref}}} $$\n\n实现将对所提供的每个测试用例执行这整个序列，并将生成的 $[C_{\\mathrm{before}}, C_{\\mathrm{after}}]$ 对整理成最终列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import trapezoid\n\ndef solve():\n    \"\"\"\n    Main function to run the beam hardening simulation for all test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (baseline beam hardening)\n        {'E_min': 20.0, 'E_max': 80.0, 'p': 2.0, 'alpha': 80.0, 'beta': 0.015,\n         'delta': 8000.0, 'T_f': 1.0, 'R': 5.0,\n         'wedge_thicknesses': np.array([0.0, 1.0, 2.0, 4.0, 8.0]),\n         'd': 3, 'rho': 0.9},\n        # Case 2 (heavy filtration, reduced beam hardening)\n        {'E_min': 20.0, 'E_max': 80.0, 'p': 2.0, 'alpha': 80.0, 'beta': 0.015,\n         'delta': 20000.0, 'T_f': 2.0, 'R': 5.0,\n         'wedge_thicknesses': np.array([0.0, 1.0, 2.0, 4.0, 8.0]),\n         'd': 3, 'rho': 0.9},\n        # Case 3 (minimal wedge steps, quadratic fit)\n        {'E_min': 40.0, 'E_max': 80.0, 'p': 2.0, 'alpha': 80.0, 'beta': 0.015,\n         'delta': 15000.0, 'T_f': 1.5, 'R': 5.0,\n         'wedge_thicknesses': np.array([0.0, 2.0, 8.0]),\n         'd': 2, 'rho': 0.9},\n        # Case 4 (no filtration, strong beam hardening)\n        {'E_min': 20.0, 'E_max': 80.0, 'p': 3.0, 'alpha': 200.0, 'beta': 0.010,\n         'delta': 0.0, 'T_f': 0.0, 'R': 5.0,\n         'wedge_thicknesses': np.arange(0.0, 11.0, 1.0),\n         'd': 4, 'rho': 0.9},\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_simulation(**params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join([str(res) for res in results])}]\")\n\ndef run_simulation(E_min, E_max, p, alpha, beta, delta, T_f, R, wedge_thicknesses, d, rho):\n    \"\"\"\n    Performs the full simulation for a single set of parameters.\n    \"\"\"\n    # 1. Numerical Framework and Physical Models\n    num_energy_steps = 4096\n    energies = np.linspace(E_min, E_max, num_energy_steps, dtype=np.float64)\n\n    # Avoid division by zero at E=0, though problem statement ensures E_min > 0.\n    # Add a small epsilon to be safe, which has no effect for E_min > 0.\n    energies_safe = energies + 1e-12\n\n    # Attenuation coefficient mu(E)\n    mu_E = alpha * energies_safe**(-3) + beta\n\n    # Incident spectrum S(E)\n    # Handle the case where delta is zero to avoid multiplying by a large number and then zero.\n    if delta == 0.0 or T_f == 0.0:\n        S_E = energies**p\n    else:\n        S_E = energies**p * np.exp(-delta * energies_safe**(-3) * T_f)\n\n    # 2. Function to compute measured line integral m(L)\n    I0 = trapezoid(S_E, energies)\n    \n    def get_m(L_val):\n        if L_val == 0.0:\n            return 0.0\n        integrand = S_E * np.exp(-mu_E * L_val)\n        I_L = trapezoid(integrand, energies)\n        # Handle potential numerical issue where I_L/I0 > 1\n        ratio = max(1e-300, I_L / I0)\n        return -np.log(ratio)\n\n    # 3. Beam Hardening Correction Function (Polynomial Fitting)\n    m_values = np.array([get_m(L) for L in wedge_thicknesses])\n    \n    # Fit polynomial L = q(m)\n    coeffs = np.polyfit(m_values, wedge_thicknesses, d)\n    q_poly = np.poly1d(coeffs)\n\n    # 4. Analysis of Cylindrical Phantom\n    # Reference attenuation\n    E_eff_numerator = trapezoid(energies * S_E, energies)\n    E_eff = E_eff_numerator / I0\n    mu_ref = alpha * E_eff**(-3) + beta\n\n    # Path lengths at center (r=0) and edge (r=rho*R)\n    L_center = 2 * R\n    L_edge = 2 * np.sqrt(R**2 - (rho * R)**2)\n\n    # Corresponding measurements\n    m_center = get_m(L_center)\n    m_edge = get_m(L_edge)\n\n    # 5. Cupping Metric Calculation\n    # Before correction\n    mu_naive_center = m_center / L_center if L_center > 0 else 0.0\n    mu_naive_edge = m_edge / L_edge if L_edge > 0 else 0.0\n    C_before = (mu_naive_edge - mu_naive_center) / mu_ref\n\n    # After correction\n    L_est_center = q_poly(m_center)\n    L_est_edge = q_poly(m_edge)\n    \n    mu_corr_center = mu_ref * (L_est_center / L_center) if L_center > 0 else mu_ref\n    mu_corr_edge = mu_ref * (L_est_edge / L_edge) if L_edge > 0 else mu_ref\n    C_after = (mu_corr_edge - mu_corr_center) / mu_ref\n\n    return [C_before, C_after]\n\nsolve()\n```"
        },
        {
            "introduction": "在重建和校正图像后，下一步通常是将其分割成不同的材料相，但我们如何信任分割结果呢？此项实践介绍了评估分割性能的两个最重要指标：Dice系数（Dice coefficient）和交并比（Intersection-over-Union, IoU）。您将从第一性原理出发实现这些指标，学习如何对照已知的“金标准”（ground truth）来定量评估分割结果的准确性。",
            "id": "3891013",
            "problem": "对锂离子电池电极进行的X射线微计算机断层扫描三维重建，可生成用于识别材料相的带标记体素阵列。考虑一个由一组整数三元组索引的离散体素晶格，其中每个体素索引的形式为 $(i,j,k)$，且 $i,j,k \\in \\mathbb{Z}$ 受数组边界的约束。每个标记体积都表示为一个带有相标签的整数数组，其中标签 $0$ 表示背景，标签 $1$ 表示活性材料，标签 $2$ 表示孔隙空间。给定同一晶格的真实标签体积和预测标签体积，对于每个类别 $c \\in \\{1,2\\}$，定义集合 $G_c$ 为真实标签等于 $c$ 的索引集合，集合 $P_c$ 为预测标签等于 $c$ 的索引集合。使用集合交集、集合并集和集合基数的基本定义，仅基于 $G_c$ 和 $P_c$ 为每个类别 $c$ 推导分割质量度量 Dice 系数和交并比 (IoU) 的表达式。明确确定并论证在 $G_c$ 和 $P_c$ 均为空集以及 $G_c$ 或 $P_c$ 中只有一个为空集的边缘情况下这些度量的值。\n\n您的程序必须实现这些推导出的表达式，并为以下标记体积测试套件计算这些度量（所有坐标均从零开始，且上界不包含在内）。在每种情况下，预测体积和真实体积都在同一晶格上定义。此任务不需要物理单位。不涉及角度。输出中的任何分数量都必须表示为小数。\n\n- 情况A（一般部分重叠）：体积形状为 $6\\times 6\\times 6$。真实值 $G$ 包括：\n  - 类别 $1$：所有满足 $2 \\le i  5$、$2 \\le j  5$、$2 \\le k  5$ 的 $(i,j,k)$。\n  - 类别 $2$：所有满足 $0 \\le i  2$、$0 \\le j  2$、$0 \\le k  6$ 的 $(i,j,k)$。\n  预测值 $P$ 包括：\n  - 类别 $1$：所有满足 $3 \\le i  6$、$2 \\le j  5$、$2 \\le k  5$ 的 $(i,j,k)$。\n  - 类别 $2$：所有满足 $0 \\le i  2$、$0 \\le j  2$、$0 \\le k  3$ 的 $(i,j,k)$。\n\n- 情况B（完美分割）：体积形状为 $5\\times 5\\times 5$。真实值 $G$ 包括：\n  - 类别 $1$：所有满足 $1 \\le i  4$、$1 \\le j  4$、$1 \\le k  4$ 的 $(i,j,k)$。\n  - 类别 $2$：所有满足 $0 \\le i  1$、$0 \\le j  1$、$0 \\le k  1$ 的 $(i,j,k)$。\n  预测值 $P$ 与 $G$ 相同。\n\n- 情况C（类别错位和类别缺失）：体积形状为 $4\\times 4\\times 4$。真实值 $G$ 包括：\n  - 类别 $1$：所有满足 $0 \\le i  2$、$0 \\le j  4$、$0 \\le k  4$ 的 $(i,j,k)$。\n  - 类别 $2$：无体素。\n  预测值 $P$ 包括：\n  - 类别 $1$：所有满足 $2 \\le i  4$、$0 \\le j  4$、$0 \\le k  4$ 的 $(i,j,k)$。\n  - 类别 $2$：无体素。\n\n您的程序应在每种情况下为类别 $1$ 和类别 $2$ 计算 Dice 系数和 IoU，并遵循以下从第一性原理推导出的边缘情况约定：\n- 如果 $G_c$ 和 $P_c$ 均为空集，则两个度量值必须为 $1$。\n- 如果 $G_c$ 或 $P_c$ 中只有一个为空集，则两个度量值必须为 $0$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每种情况贡献一个包含四个十进制数的列表，顺序为 $[\\text{Dice}_{1},\\text{IoU}_{1},\\text{Dice}_{2},\\text{IoU}_{2}]$。例如，最终输出应类似于 $$[[d_{A1},u_{A1},d_{A2},u_{A2}],[d_{B1},u_{B1},d_{B2},u_{B2}],[d_{C1},u_{C1},d_{C2},u_{C2}]],$$ 其中 $d$ 和 $u$ 分别表示指定情况和类别的 Dice 系数和 IoU。",
            "solution": "该问题是有效的，因为它具有科学依据、定义明确且客观。它基于材料科学中三维图像分析的标准实践，特别是对电池电极微观结构分割质量的评估。所提供的数据和定义是完整、一致的，并允许得出一个唯一的、可验证的解。要求推导和论证分割度量及其边缘情况下的行为是一个标准的、定义明确的学术问题。\n\n解决方案需要推导和实现两种常见的分割度量：Dice系数和交并比（IoU），后者也称为 Jaccard 指数。这些度量用于量化预测分割与真实分割之间的空间重叠度。\n\n设 $c$ 为类别索引，$c \\in \\{1, 2\\}$，分别对应活性材料和孔隙空间。真实体积中属于类别 $c$ 的体素索引集合记为 $G_c$，预测体积中的相应集合记为 $P_c$。这些度量的基本量是这些集合及其交集的基数（即体素数量）。令 $|S|$ 表示集合 $S$ 的基数。关键的基数有：\n- $|G_c|$：类别 $c$ 在真实值中的体素数量。\n- $|P_c|$：类别 $c$ 在预测值中的体素数量。\n- $|G_c \\cap P_c|$：被正确预测为类别 $c$ 的体素数量（交集）。\n\n**交并比（IoU 或 Jaccard 指数）**\nIoU 定义为两个集合交集的大小与并集大小之比。\n$$\n\\text{IoU}_c = \\frac{|G_c \\cap P_c|}{|G_c \\cup P_c|}\n$$\n使用集合基数的容斥原理，并集可以表示为 $|G_c \\cup P_c| = |G_c| + |P_c| - |G_c \\cap P_c|$。将其代入 IoU 定义，得到计算公式：\n$$\n\\text{IoU}_c = \\frac{|G_c \\cap P_c|}{|G_c| + |P_c| - |G_c \\cap P_c|}\n$$\n\n**Dice 系数（Sørensen-Dice 系数）**\nDice 系数定义为交集大小的两倍除以两个集合大小之和。\n$$\n\\text{Dice}_c = \\frac{2 |G_c \\cap P_c|}{|G_c| + |P_c|}\n$$\nDice 系数与 IoU 相关，可表示为 $\\text{Dice} = 2 \\cdot \\text{IoU} / (1 + \\text{IoU})$。两种度量的取值范围均为 $0$（无重叠）到 $1$（完美重叠）。\n\n**边缘情况分析**\n问题的关键部分是确定并论证在其中一个或两个集合为空的边缘情况下度量的值。\n\n1.  **情况1：两个集合均为空 ($G_c = \\emptyset$ 且 $P_c = \\emptyset$)**\n    在此情况下，$|G_c| = 0$，$|P_c| = 0$，因此 $|G_c \\cap P_c| = 0$。将这些值代入公式可得：\n    $$\n    \\text{IoU}_c = \\frac{0}{0 + 0 - 0} = \\frac{0}{0}\n    \\quad \\text{和} \\quad\n    \\text{Dice}_c = \\frac{2 \\cdot 0}{0 + 0} = \\frac{0}{0}\n    $$\n    两个表达式在数学上都是不确定的。然而，在分割的语境下，这种情况表示算法正确地识别出体积中不存在类别 $c$。这对该类别来说是一次“完美”的预测。因此，根据惯例和合理推断，我们为这两种度量赋予最大分值 $1$。这反映了真实值与预测之间的完美一致性（两者都同意没有需要分割的对象）。因此，如果 $|G_c| = 0$ 且 $|P_c| = 0$，则 $\\text{IoU}_c = 1$ 且 $\\text{Dice}_c = 1$。\n\n2.  **情况2：只有一个集合为空 (例如，$G_c \\neq \\emptyset$ 且 $P_c = \\emptyset$)**\n    在这种情况下，$|G_c|  0$ 且 $|P_c| = 0$。交集必定为空，所以 $|G_c \\cap P_c| = 0$。公式变为：\n    $$\n    \\text{IoU}_c = \\frac{0}{|G_c| + 0 - 0} = \\frac{0}{|G_c|} = 0\n    $$\n    $$\n    \\text{Dice}_c = \\frac{2 \\cdot 0}{|G_c| + 0} = \\frac{0}{|G_c|} = 0\n    $$\n    类似地，如果 $G_c = \\emptyset$ 且 $P_c \\neq \\emptyset$，则 $|G_c| = 0$，$|P_c|  0$，且 $|G_c \\cap P_c| = 0$。\n    $$\n    \\text{IoU}_c = \\frac{0}{0 + |P_c| - 0} = \\frac{0}{|P_c|} = 0\n    $$\n    $$\n    \\text{Dice}_c = \\frac{2 \\cdot 0}{0 + |P_c|} = \\frac{0}{|P_c|} = 0\n    $$\n    在这两种子情况下，结果都明确为 $0$。这是合理的，因为预测与真实值之间完全没有重叠，代表了最差的分割结果（完全漏检或完全误报）。因此，如果一个集合为空而另一个不为空，则 $\\text{IoU}_c = 0$ 且 $\\text{Dice}_c = 0$。\n\n这些推导出的表达式和经过论证的边缘情况约定将被实现以解决这些测试用例。由于所有几何区域都是长方体，它们的基数可以直接根据坐标维度计算得出，而无需在内存中实例化完整的体素集。",
            "answer": "```python\nimport numpy as np\nfrom scipy import __version__ as scipy_version  # Not used, but required by some test harnesses.\n\ndef solve():\n    \"\"\"\n    Solves the segmentation metric calculation problem for the given test suite.\n    \"\"\"\n\n    def calculate_volume(ranges):\n        \"\"\"Calculates the volume of a rectangular prism defined by coordinate ranges.\"\"\"\n        if ranges is None:\n            return 0\n        \n        volume = 1\n        for r in ranges:\n            # A range [min, max) has length (max - min)\n            length = r[1] - r[0]\n            if length  0:\n                # Should not happen with well-formed ranges, but as a safeguard.\n                return 0\n            volume *= length\n        return volume\n\n    def calculate_intersection_volume(ranges1, ranges2):\n        \"\"\"Calculates the volume of the intersection of two rectangular prisms.\"\"\"\n        if ranges1 is None or ranges2 is None:\n            return 0\n        \n        intersect_ranges = []\n        for r1, r2 in zip(ranges1, ranges2):\n            intersect_min = max(r1[0], r2[0])\n            intersect_max = min(r1[1], r2[1])\n            if intersect_min >= intersect_max:\n                # The intersection is empty along this dimension.\n                return 0\n            intersect_ranges.append((intersect_min, intersect_max))\n\n        return calculate_volume(tuple(intersect_ranges))\n\n    def compute_metrics(card_G, card_P, card_intersect):\n        \"\"\"Computes Dice and IoU from cardinalities, handling edge cases.\"\"\"\n        # Case 1: Both sets are empty. Perfect prediction of absence.\n        if card_G == 0 and card_P == 0:\n            return 1.0, 1.0\n        \n        # Case 2: Exactly one set is empty. No overlap.\n        # This also covers the case where the sets are non-empty but disjoint (card_intersect == 0).\n        if card_intersect == 0:\n            return 0.0, 0.0\n\n        # General case\n        dice = (2.0 * card_intersect) / (card_G + card_P)\n        iou = card_intersect / (card_G + card_P - card_intersect)\n        \n        return dice, iou\n\n    # Test suite definition\n    # Structure: [ ( (G1_ranges, P1_ranges), (G2_ranges, P2_ranges) ), ... ]\n    # A range is ((i_min, i_max), (j_min, j_max), (k_min, k_max))\n    # None represents an empty set of voxels.\n    test_cases = [\n        # Case A: General partial overlap\n        (\n            (((2, 5), (2, 5), (2, 5)), ((3, 6), (2, 5), (2, 5))), # Class 1\n            (((0, 2), (0, 2), (0, 6)), ((0, 2), (0, 2), (0, 3)))  # Class 2\n        ),\n        # Case B: Perfect segmentation\n        (\n            (((1, 4), (1, 4), (1, 4)), ((1, 4), (1, 4), (1, 4))), # Class 1\n            (((0, 1), (0, 1), (0, 1)), ((0, 1), (0, 1), (0, 1)))  # Class 2\n        ),\n        # Case C: Misaligned class and absent class\n        (\n            (((0, 2), (0, 4), (0, 4)), ((2, 4), (0, 4), (0, 4))), # Class 1\n            (None, None)                                          # Class 2\n        ),\n    ]\n\n    all_results = []\n    for case_data in test_cases:\n        case_results = []\n        # class_data contains (G_ranges, P_ranges)\n        for class_data in case_data:\n            G_ranges, P_ranges = class_data\n            \n            card_G = calculate_volume(G_ranges)\n            card_P = calculate_volume(P_ranges)\n            card_intersect = calculate_intersection_volume(G_ranges, P_ranges)\n            \n            dice, iou = compute_metrics(card_G, card_P, card_intersect)\n            \n            case_results.extend([dice, iou])\n        all_results.append(case_results)\n\n    # Format the output string as per the requirement: [[d,u,d,u],[d,u,d,u],...]\n    case_strings = []\n    for res_list in all_results:\n        # Convert each float in the list to its string representation\n        # and join them with commas.\n        case_strings.append(f\"[{','.join(map(str, res_list))}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}