{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的计算模型之前，理解其背后的物理原理至关重要。量纲分析是一种强大的工具，可以帮助我们识别在不同条件下哪些物理过程占主导地位。本练习将指导您对热-电化学耦合方程进行无量纲化处理 。通过推导无量纲数，您将深入了解热量生成、热传导和电化学反应速率之间的竞争关系，这是为物理信息神经网络（PINN）正确构建和加权损失项的关键一步。",
            "id": "3941092",
            "problem": "伪二维 (P2D) 电池模型的物理信息神经网络 (PINN) 代理模型必须在经过适当缩放的控制方程上进行训练，以确保数值稳定的优化和物理上可解释的残差加权。考虑一个厚度为 $L$ 的单个电极区域，该区域由沿厚度方向坐标 $x$ 上具有热-电化学耦合的一维能量平衡表示。能量方程为\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t),\n$$\n其中 $\\rho$ 是质量密度，$c_{p}$ 是比热容，$k$ 是热导率，$q(x,t)$ 是体积生热率。体积热源来自三种机制：不可逆反应热 $q_{\\mathrm{irr}}$、熵热 $q_{\\mathrm{ent}}$ 和欧姆热 $q_{\\mathrm{ohm}}$，由下式给出\n$$\nq_{\\mathrm{irr}} \\;=\\; \\eta \\, a_{s} \\, j \\, F, \n\\qquad\nq_{\\mathrm{ent}} \\;=\\; T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F,\n\\qquad\nq_{\\mathrm{ohm}} \\;=\\; \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}},\n$$\n其中 $\\eta$ 是反应过电势，$a_{s}$ 是比表面积，$j$ 是摩尔界面通量，$F$ 是法拉第常数，$U$ 是开路电势，$i$ 是沿厚度方向的电流密度，$\\sigma_{\\mathrm{eff}}$ 是结合了电子和离子通道的有效电导率。假设在 $x \\in [0,L]$ 范围内反应是均匀的，因此体积反应电流密度 $a_{s} j F$ 是均匀的，并且施加的面电流密度 $i_{\\mathrm{app}}$ 满足\n$$\n\\int_{0}^{L} a_{s} j F \\, dx \\;=\\; i_{\\mathrm{app}} \\quad \\Rightarrow \\quad a_{s} j F \\;=\\; \\frac{i_{\\mathrm{app}}}{L}.\n$$\n选择一个温度标度 $\\Delta T$ 和一个参考温度 $T_{\\mathrm{ref}}$，并定义热扩散率 $\\alpha = k/(\\rho c_{p})$。令热扩散时间尺度为 $\\tau_{\\mathrm{th}} = L^{2}/\\alpha$。使用能量守恒对热方程进行缩放，并使用法拉第定律和固相锂守恒来定义平均固体浓度发生 $\\mathcal{O}(1)$ 量级变化时的反应时间尺度，推导出以下无量纲群：\n- 一个比较生热与通过传导散热的热源-传导竞争数。\n- 一个比较热扩散时间尺度与电化学反应时间尺度的类佩克莱数。\n\n然后，使用以下参数值：\n- $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$，\n- $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$，\n- $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$，\n- $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，\n- $\\Delta T = 5\\,\\mathrm{K}$，\n- $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$，\n- $\\eta_{0} = 0.06\\,\\mathrm{V}$ (使用此值作为过电势标度)，\n- $\\left(\\frac{\\partial U}{\\partial T}\\right) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$，\n- $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$，\n- $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$，\n- $\\epsilon_{s} = 0.5$，\n- $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$，\n- $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$，\n\n假设在 $T_{\\mathrm{ref}}$ 时熵项有正贡献，并计算这两个无量纲数的数值。将最终数值结果表示为四舍五入到四位有效数字的无量纲值。将这两个值表示为一个包含两个元素的行矩阵。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行评估。\n\n### 第 1 步：提取已知条件\n- **控制方程：** 一维能量平衡方程为\n$$\n\\rho c_{p} \\,\\frac{\\partial T}{\\partial t} \\;=\\; k \\,\\frac{\\partial^{2} T}{\\partial x^{2}} \\;+\\; q(x,t)\n$$\n- **变量和常数：**\n  - $T$: 温度\n  - $t$: 时间\n  - $x$: $[0, L]$ 内的沿厚度方向坐标\n  - $\\rho$: 质量密度\n  - $c_p$: 比热容\n  - $k$: 热导率\n  - $q(x,t)$: 体积生热率\n  - $L$: 电极厚度\n- **热源分量：**\n  - $q = q_{\\mathrm{irr}} + q_{\\mathrm{ent}} + q_{\\mathrm{ohm}}$\n  - $q_{\\mathrm{irr}} = \\eta \\, a_{s} \\, j \\, F$ (不可逆反应热)\n  - $q_{\\mathrm{ent}} = T \\,\\frac{\\partial U}{\\partial T} \\, a_{s} \\, j \\, F$ (熵热)\n  - $q_{\\mathrm{ohm}} = \\frac{i^{2}}{\\sigma_{\\mathrm{eff}}}$ (欧姆热)\n- **分量定义：**\n  - $\\eta$: 反应过电势\n  - $a_s$: 比表面积\n  - $j$: 摩尔界面通量\n  - $F$: 法拉第常数\n  - $U$: 开路电势\n  - $i$: 沿厚度方向的电流密度\n  - $\\sigma_{\\mathrm{eff}}$: 有效电导率\n- **假设和条件：**\n  - 在 $x \\in [0,L]$ 上反应均匀意味着 $a_{s} j F = \\frac{i_{\\mathrm{app}}}{L}$，其中 $i_{\\mathrm{app}}$ 是施加的面电流密度。\n- **缩放参数：**\n  - 温度标度：$\\Delta T$\n  - 参考温度：$T_{\\mathrm{ref}}$\n  - 热扩散率：$\\alpha = k/(\\rho c_{p})$\n  - 热扩散时间尺度：$\\tau_{\\mathrm{th}} = L^{2}/\\alpha$\n- **任务：**\n  1. 推导一个“热源-传导竞争数”。\n  2. 推导一个比较 $\\tau_{\\mathrm{th}}$ 和电化学反应时间尺度的“类佩克莱数”。\n  3. 使用所提供的数据计算这两个数的数值。\n- **数值：**\n  - $L = 1.0 \\times 10^{-4}\\,\\mathrm{m}$\n  - $k = 1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\rho = 1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n  - $c_{p} = 900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n  - $\\Delta T = 5\\,\\mathrm{K}$\n  - $i_{\\mathrm{app}} = 25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}$\n  - $\\eta_{0} = 0.06\\,\\mathrm{V}$ (过电势标度)\n  - $(\\frac{\\partial U}{\\partial T}) = 2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}$\n  - $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$\n  - $\\sigma_{\\mathrm{eff}} = 20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}$\n  - $\\epsilon_{s} = 0.5$ (固相体积分数)\n  - $c_{s,\\max} = 3.1 \\times 10^{4}\\,\\mathrm{mol}\\,\\mathrm{m}^{-3}$ (最大固体浓度)\n  - $F = 96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1}$\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题具有科学依据，借鉴了输运现象（热方程）和电化学（电池建模）的标准原理。生热方程是电池建模领域的标准方程。任务是适定的，要求通过标准的标度分析推导无量纲群，然后进行数值计算。语言客观、精确。所提供的参数对于电池材料和操作条件在物理上是现实的。问题是自洽的，并为其解决提供了所有必要的信息。它没有违反任何指定的无效标准。\n\n### 第 3 步：结论和行动\n问题是有效的。将提供完整的解答。\n\n### 解答推导\n目标是从控制能量平衡方程中推导出两个无量纲数，然后计算它们的值。\n\n#### 热源-传导竞争数 ($\\Pi_1$) 的推导\n我们从对能量方程进行无量纲化开始。让我们定义无量纲温度 $\\theta$、空间坐标 $\\tilde{x}$ 和时间 $\\tilde{t}$：\n$$\n\\theta = \\frac{T - T_{\\mathrm{ref}}}{\\Delta T}, \\qquad \\tilde{x} = \\frac{x}{L}, \\qquad \\tilde{t} = \\frac{t}{\\tau_{\\mathrm{th}}}\n$$\n其中 $\\tau_{\\mathrm{th}} = L^2/\\alpha = L^2 \\rho c_p / k$ 是热扩散时间尺度。偏导数变换如下：\n$$\n\\frac{\\partial T}{\\partial t} = \\frac{\\partial (\\Delta T \\theta + T_{\\mathrm{ref}})}{\\partial \\tilde{t}} \\frac{\\partial \\tilde{t}}{\\partial t} = \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}}\n$$\n$$\n\\frac{\\partial T}{\\partial x} = \\frac{\\Delta T}{L} \\frac{\\partial \\theta}{\\partial \\tilde{x}} \\quad \\Rightarrow \\quad \\frac{\\partial^2 T}{\\partial x^2} = \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2}\n$$\n将这些代入控制方程：\n$$\n\\rho c_{p} \\left( \\frac{\\Delta T}{\\tau_{\\mathrm{th}}} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = k \\left( \\frac{\\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} \\right) + q(x,t)\n$$\n代入 $\\tau_{\\mathrm{th}} = L^2 \\rho c_p / k$：\n$$\n\\rho c_{p} \\left( \\frac{k \\Delta T}{L^2 \\rho c_p} \\frac{\\partial \\theta}{\\partial \\tilde{t}} \\right) = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\n$$\n\\frac{k \\Delta T}{L^2} \\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{k \\Delta T}{L^2} \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + q\n$$\n将整个方程除以传导项系数 $\\frac{k \\Delta T}{L^2}$，得到无量纲形式：\n$$\n\\frac{\\partial \\theta}{\\partial \\tilde{t}} = \\frac{\\partial^2 \\theta}{\\partial \\tilde{x}^2} + \\frac{L^2 q}{k \\Delta T}\n$$\n热源-传导竞争数，我们记为 $\\Pi_1$，是无量纲源项 $\\frac{L^2 q}{k \\Delta T}$ 的特征量级。这个数比较了生热速率与通过传导散热的速率。\n$$\n\\Pi_1 = \\frac{\\text{特征体积生热率}}{\\text{特征体积热传导率}} = \\frac{q_0}{k \\Delta T / L^2} = \\frac{q_0 L^2}{k \\Delta T}\n$$\n我们必须确定特征热源 $q_0$。它是其各分量特征值的总和：$q_0 = q_{0,\\mathrm{irr}} + q_{0,\\mathrm{ent}} + q_{0,\\mathrm{ohm}}$。使用所提供的标度和假设：\n- $q_{0,\\mathrm{irr}} = \\eta_0 (a_s j F) = \\eta_0 \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} (a_s j F) = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L}$\n- $q_{0,\\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}$ (使用 $i_{\\mathrm{app}}$ 作为特征电流密度)\n\n因此，总特征热源是：\n$$\nq_0 = \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}}\n$$\n第一个无量纲数是：\n$$\n\\Pi_1 = \\frac{L^2}{k \\Delta T} \\left[ \\frac{i_{\\mathrm{app}}}{L} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} \\right] = \\frac{L i_{\\mathrm{app}}}{k \\Delta T} \\left( \\eta_0 + T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\right) + \\frac{L^2 i_{\\mathrm{app}}^2}{k \\Delta T \\sigma_{\\mathrm{eff}}}\n$$\n\n#### 类佩克莱数 ($\\Pi_2$) 的推导\n这个数比较了热扩散时间尺度 $\\tau_{\\mathrm{th}}$ 与电化学反应时间尺度 $\\tau_{\\mathrm{rxn}}$。\n热时间尺度由 $\\tau_{\\mathrm{th}} = L^2 / \\alpha = L^2 \\rho c_p / k$ 给出。\n\n电化学反应时间尺度 $\\tau_{\\mathrm{rxn}}$ 是为平均固相锂浓度的 $\\mathcal{O}(1)$ 量级变化而定义的。电极固相中锂的守恒由下式给出：\n$$\n\\epsilon_s \\frac{\\partial c_s}{\\partial t} = -\\nabla \\cdot \\mathbf{J}_s\n$$\n在电极体积上平均时，总存储锂的变化是由于颗粒表面的电化学反应。平均固体浓度 $\\bar{c}_s$ 的变化率与体积反应速率 $a_s j$ 相关：\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - a_s j\n$$\n使用给定条件 $a_s j = i_{\\mathrm{app}}/(LF)$：\n$$\n\\epsilon_s \\frac{d\\bar{c}_s}{dt} = - \\frac{i_{\\mathrm{app}}}{LF}\n$$\n对于特征浓度变化 $\\Delta \\bar{c}_s$ 的时间尺度 $\\tau_{\\mathrm{rxn}}$，可以通过将导数近似为有限差分来找到：\n$$\n\\epsilon_s \\frac{\\Delta \\bar{c}_s}{\\tau_{\\mathrm{rxn}}} \\approx \\frac{i_{\\mathrm{app}}}{LF}\n$$\n对于 $\\mathcal{O}(1)$ 量级的变化，特征浓度变化是最大浓度，即 $\\Delta \\bar{c}_s = c_{s,\\max}$。求解 $\\tau_{\\mathrm{rxn}}$：\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}}\n$$\n这表示电极完全充电或放电的时间。\n类佩克莱数 $\\Pi_2$ 是这两个时间尺度的比值：\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{L^2 \\rho c_p / k}{\\epsilon_s c_{s,\\max} L F / i_{\\mathrm{app}}} = \\frac{i_{\\mathrm{app}} L \\rho c_p}{k \\epsilon_s c_{s,\\max} F}\n$$\n\n### 数值计算\n我们现在将提供的数值代入推导出的 $\\Pi_1$ 和 $\\Pi_2$ 表达式中。\n\n**$\\Pi_1$ 的计算：**\n首先，计算特征源项 $q_0$。\n$$\nq_{0, \\mathrm{irr}} = \\eta_0 \\frac{i_{\\mathrm{app}}}{L} = (0.06\\,\\mathrm{V}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.5 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ent}} = T_{\\mathrm{ref}} \\frac{\\partial U}{\\partial T} \\frac{i_{\\mathrm{app}}}{L} = (298\\,\\mathrm{K})(2.0 \\times 10^{-4}\\,\\mathrm{V}\\,\\mathrm{K}^{-1}) \\frac{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}}{1.0 \\times 10^{-4}\\,\\mathrm{m}} = 1.49 \\times 10^4\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n$$\nq_{0, \\mathrm{ohm}} = \\frac{i_{\\mathrm{app}}^2}{\\sigma_{\\mathrm{eff}}} = \\frac{(25\\,\\mathrm{A}\\,\\mathrm{m}^{-2})^2}{20\\,\\mathrm{S}\\,\\mathrm{m}^{-1}} = \\frac{625}{20}\\,\\mathrm{W}\\,\\mathrm{m}^{-3} = 31.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n总特征热源：\n$$\nq_0 = (1.5 \\times 10^4) + (1.49 \\times 10^4) + 31.25 = 29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3}\n$$\n现在计算 $\\Pi_1$：\n$$\n\\Pi_1 = \\frac{q_0 L^2}{k \\Delta T} = \\frac{(29931.25\\,\\mathrm{W}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})^2}{(1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1})(5\\,\\mathrm{K})} = \\frac{2.993125 \\times 10^{-4}}{7.5} \\approx 3.99083 \\times 10^{-5}\n$$\n四舍五入到四位有效数字，$\\Pi_1 \\approx 3.991 \\times 10^{-5}$。\n\n**$\\Pi_2$ 的计算：**\n首先，计算两个时间尺度。\n热扩散时间尺度：\n$$\n\\tau_{\\mathrm{th}} = \\frac{L^2 \\rho c_p}{k} = \\frac{(1.0 \\times 10^{-4}\\,\\mathrm{m})^2 (1800\\,\\mathrm{kg}\\,\\mathrm{m}^{-3})(900\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1})}{1.5\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{10^{-8} \\times 1.62 \\times 10^6}{1.5}\\,\\mathrm{s} = 0.0108\\,\\mathrm{s}\n$$\n电化学反应时间尺度：\n$$\n\\tau_{\\mathrm{rxn}} = \\frac{\\epsilon_s c_{s,\\max} L F}{i_{\\mathrm{app}}} = \\frac{(0.5)(3.1 \\times 10^4\\,\\mathrm{mol}\\,\\mathrm{m}^{-3})(1.0 \\times 10^{-4}\\,\\mathrm{m})(96485\\,\\mathrm{C}\\,\\mathrm{mol}^{-1})}{25\\,\\mathrm{A}\\,\\mathrm{m}^{-2}} \\approx 5982.07\\,\\mathrm{s}\n$$\n现在计算比值 $\\Pi_2$：\n$$\n\\Pi_2 = \\frac{\\tau_{\\mathrm{th}}}{\\tau_{\\mathrm{rxn}}} = \\frac{0.0108\\,\\mathrm{s}}{5982.07\\,\\mathrm{s}} \\approx 1.8054 \\times 10^{-6}\n$$\n四舍五入到四位有效数字，$\\Pi_2 \\approx 1.805 \\times 10^{-6}$。\n\n这两个无量纲数是 $\\Pi_1 \\approx 3.991 \\times 10^{-5}$ 和 $\\Pi_2 \\approx 1.805 \\times 10^{-6}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3.991 \\times 10^{-5} & 1.805 \\times 10^{-6}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "代理建模的核心任务是构建一个能够准确学习从输入（如电流）到输出（如电压）映射的网络。深度算子网络（DeepONet）是学习此类函数空间之间映射的一种强大架构。本练习  提供了一个构建物理信息 DeepONet 的实践指南。您将实现一个其结构本身就反映了物理原理的网络，将模型分为与参数无关的基函数（主干网络）和依赖于参数的系数（分支网络），这是一种创建可推广代理模型的精密方法。",
            "id": "3941031",
            "problem": "您的任务是设计并实现一个物理信息深度算子网络 (Physics-Informed Deep Operator Network, DeepONet)，该网络用于近似锂离子电池从输入电流 $I(t)$ 到端电压 $V(t)$ 的输入-输出因果算子映射，该映射以参数矢量 $\\theta$ 和温度 $T$ 为条件，并采用一种从多孔电极伪二维 (Porous-Electrode Pseudo Two-Dimensional, P2D) 模型推导出的、简化的、科学上一致的形式。您编写的程序必须是一个完整、可运行的程序，该程序需实例化此 DeepONet 代理模型，在一组测试用例上对其进行评估，并以伏特为单位报告代理模型的量化误差。\n\n从有科学依据的原理开始：\n\n- 离子传输遵循菲克定律 (Fick's law)，其一维形式可写作 $J = -D \\nabla c$，其中 $J$ 是通量，$D$ 是扩散系数，$c$ 是浓度。在多孔电极中，反应动力学由巴特勒-沃尔默 (Butler–Volmer) 关系捕捉，该关系将界面电流密度 $j$ 与过电位 $\\eta$ 联系起来。固相和电解质相中的电荷守恒以及欧姆定律 (Ohm's law) 产生耦合的偏微分方程。在中小幅度的激励下，线性化和均质化可导出一个降阶算子表示，用于描述由开路项、瞬时电阻项和扩散弛豫项组成的电压响应。这启发我们使用一个具有物理动机的核进行卷积，来表示从输入 $I(t)$ 到输出 $V(t)$ 的因果线性时不变映射。\n\n将用于评估的基准真值 (ground-truth) 算子定义为 $I(t)$ 与单指数弛豫核的因果卷积，外加一个欧姆压降和一个开路电压基线：\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau',\n$$\n其中 $U(\\theta,T)$ 是开路电压基线，$R_0(\\theta,T)$ 是瞬时电阻，$A(\\theta,T)$ 是扩散弛豫的幅值，$\\tau(\\theta,T)$ 是特征弛豫时间常数。这些参数的依赖关系必须是关于 $\\theta$ 和 $T$ 的、具有合乎物理意义的函数。对于数值实现，请使用固定的时间离散化，将此积分实现为黎曼和。\n\n构建一个深度算子网络来近似以 $(\\theta, T)$ 为条件的映射 $I(\\cdot) \\mapsto V(\\cdot)$：\n- DeepONet 的输出形式为\n$$\n\\widehat{V}(t) = \\sum_{j=1}^{q} c_j\\big(I(\\cdot), \\theta, T\\big)\\, \\xi_j(t),\n$$\n其中，分支网络 (branch network) 生成系数 $c_j$，这些系数是输入函数 $I(\\cdot)$ 和参数 $(\\theta,T)$ 的泛函；主干网络 (trunk network) 生成与位置相关的基函数 $\\xi_j(t)$。\n\n- 主干网络设计要求：选择一个物理信息的基函数字典，该字典能够张成相关的响应空间，并且独立于 $(\\theta,T)$。包括：\n    1. 一个常数基函数 $\\xi_0(t) = 1$，用于表示 $U(\\theta,T)$。\n    2. 一个恒等插值基，用于在传感器时间点 $\\{s_i\\}$ 使用平滑的局部函数 $\\{\\phi_i(t)\\}_{i=1}^{m}$ 从 $m$ 个传感器样本 $\\{I(s_i)\\}_{i=1}^{m}$ 重构 $I(t)$，使得 $I(t) \\approx \\sum_{i=1}^{m} I(s_i)\\, \\phi_i(t)$。\n    3. 一组 $K$ 个指数弛豫核，使用一个具有时间常数 $\\{\\tau_d^{(k)}\\}_{k=1}^{K}$ 的、与参数无关的字典来近似因果卷积。对于字典中的每个元素和每个传感器，都包含因果基函数\n    $$\n    \\xi_{k,i}(t) = \\begin{cases}\n    \\frac{1}{\\tau_d^{(k)}} \\exp\\!\\big(-(t-s_i)/\\tau_d^{(k)}\\big), & t \\ge s_i,\\\\\n    0, & t  s_i.\n    \\end{cases}\n    $$\n\n- 分支网络设计要求：在系数 $c_j$ 中显式地编码参数依赖性。使用以下编码策略：\n    1. 对于常数基，生成 $c_0 = U(\\theta,T)$。\n    2. 对于欧姆重构，生成系数 $c^{\\text{ohm}}_i = -R_0(\\theta,T) \\, I(s_i)$，使得 $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) \\approx -R_0(\\theta,T) I(t)$。\n    3. 对于扩散核，生成系数\n    $$\n    c^{\\text{diff}}_{k,i} = -A(\\theta,T)\\, w_k(\\theta,T)\\, I(s_i)\\, \\Delta s,\n    $$\n    其中 $\\Delta s$ 是均匀的传感器间距，而 $w_k(\\theta,T)$ 是依赖于 $(\\theta,T)$ 的非负门控权重，并满足 $\\sum_{k=1}^{K} w_k(\\theta,T) = 1$。为了实现 $w_k(\\theta,T)$，使用一种基于真实 $\\tau(\\theta,T)$ 与字典值 $\\tau_d^{(k)}$ 接近程度的软分配方法；例如，定义分数 $r_k(\\theta,T)$，该分数随 $\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$ 的增大而减小，并设置 $w_k(\\theta,T) = \\exp(r_k)/\\sum_j \\exp(r_j)$。这将参数依赖性完全编码在分支网络中，同时保持主干字典固定不变。\n\n数值上实现上述架构：\n\n- 时间离散化：在 $t \\in [0, t_{\\max}]$ 的有限时间范围内选择一个均匀网格 $t_n = n \\Delta t$，$n=0,\\ldots,N$，其中 $t_{\\max} = 10$ (秒)，$\\Delta t = 0.02$ (秒)。\n- 传感器布局：在 $[0,t_{\\max}]$ 上均匀使用 $m = 25$ 个传感器，位置为 $s_i$，间距为 $\\Delta s$；使用高斯局部函数 $\\phi_i(t) = \\exp\\!\\big(-(t-s_i)^2/(2\\sigma^2)\\big)$，其中 $\\sigma = \\Delta s$，并进行归一化使得对所有 $t$ 都有 $\\sum_i \\phi_i(t) = 1$，以形成一个平滑的单位分解。\n- 字典大小：使用 $K = 2$ 个字典元素，其中 $\\tau_d^{(1)} = 1.0$ (秒)，$\\tau_d^{(2)} = 4.0$ (秒)。\n\n对基准真值算子的各组成部分使用符合物理意义的参数化：\n- 设 $T_0 = 298$ (开尔文)，$U_0 = 3.6$ (伏特)，$R_{0,\\text{base}} = 0.01$ (欧姆)，$\\tau_{\\text{base}} = 2.0$ (秒)，$A_{\\text{base}} = 0.02$ (伏特/安培)，以及常数 $\\alpha = 0.10$，$\\beta = 0.001$，$\\delta = 0.20$，$\\eta = 0.50$，$\\zeta = 0.30$ 和 $\\gamma = 300.0$，使得：\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0),\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big),\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T},\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}.\n$$\n\n通过指定输入电流 $I(t)$、参数矢量 $\\theta$ 和温度 $T$ 来定义测试套件：\n\n- 情况 1 (理想情况): $I(t) = 2 \\sin\\big(2\\pi \\cdot 0.5 \\cdot t\\big)$ (安培)，$\\theta = 0.5$ (无量纲)，$T = 298$ (开尔文)。\n- 情况 2 (带阶跃的边界情况): $I(t) = 5 \\cdot H(t - 2)$ (安培)，其中 $H$ 是亥维赛德阶跃函数 (Heaviside step function)，$\\theta = 1.5$ (无量纲)，$T = 318$ (开尔文)。\n- 情况 3 (零输入): $I(t) \\equiv 0$ (安培)，$\\theta = 0.7$ (无量纲)，$T = 290$ (开尔文)。\n- 情况 4 (低温下的窄脉冲边缘情况): $I(t) = 8 \\exp\\!\\big(-(t - 5)^2/(2 \\cdot 0.15^2)\\big)$ (安培)，$\\theta = 0.2$ (无量纲)，$T = 273$ (开尔文)。\n\n程序要求：\n\n- 使用上述参数化和时间步长为 $\\Delta t$ 的因果离散卷积来实现基准真值算子 $V(t)$。\n- 按照规定实现 DeepONet 代理模型 $\\widehat{V}(t)$，包括其主干字典和分支参数编码，以及基于分数 $r_k(\\theta,T) = -\\big|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}\\big|$ 构建的、基于 softmax 的门控权重 $w_k(\\theta,T)$。\n- 对于每个测试用例，计算均方根误差 (root-mean-square error)\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2},\n$$\n以伏特 (Volts) 为单位表示。\n\n最终输出格式：\n\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上面列出的顺序包含四个测试用例的结果 (以伏特为单位)，例如 $[\\mathrm{rmse}_1,\\mathrm{rmse}_2,\\mathrm{rmse}_3,\\mathrm{rmse}_4]$。将每个条目四舍五入到 $6$ 位小数。\n\n此问题不涉及角度单位。必须遵循上面指定的所有物理单位。参数 $\\theta$ 是无量纲的。在整个实现过程中，请确保科学真实性和数值稳定性。程序必须完全自包含，没有任何外部输入。",
            "solution": "用户提供的问题陈述已经过验证，并被确定为 **有效**。它在科学上基于电化学工程的既定原理，在数学上是一致的，并且是适定的 (well-posed)。该问题为构建一个物理信息算子网络代理模型，并参照一个简化的、但物理上合理的锂离子电池基准真值模型对其进行评估，提供了完整而明确的规范。数值参数、函数形式和测试用例都已明确定义，从而可以进行直接且可验证的实现。\n\n解决方案的步骤是首先实现基准真值模型，然后实现指定的深度算子网络 (DeepONet) 代理模型。接着，针对一套测试用例，对两者之间的误差进行量化。\n\n### 基准真值模型实现\n\n基准真值电压响应 $V(t)$ 由以下算子定义：\n$$\nV(t) = U(\\theta,T) - R_0(\\theta,T)\\, I(t) - A(\\theta,T)\\, \\int_{0}^{t} \\frac{1}{\\tau(\\theta,T)} e^{-(t-\\tau')/\\tau(\\theta,T)}\\, I(\\tau')\\, d\\tau'\n$$\n该模型表示三种物理效应的叠加：\n1.  基线开路电压, $U(\\theta,T)$。\n2.  瞬时欧姆压降, $R_0(\\theta,T) I(t)$。\n3.  由扩散弛豫过程产生的动态电压分量，由卷积积分表示。\n\n物理参数 $U$、$R_0$、$A$ 和 $\\tau$ 是无量纲参数 $\\theta$ 和温度 $T$ 的函数。它们指定的依赖关系具有物理动机，例如电阻的阿伦尼乌斯型 (Arrhenius-type) 温度标度关系 $R_0 \\propto \\exp(\\gamma/T)$，以及扩散时间常数的反温度标度关系 $\\tau \\propto 1/T$。这些参数是使用提供的公式针对给定的 $(\\theta, T)$ 对计算的：\n$$\nU(\\theta,T) = U_0 + \\alpha\\, \\theta + \\beta\\, (T - T_0)\n$$\n$$\nR_0(\\theta,T) = R_{0,\\text{base}}\\, \\exp\\!\\big(\\gamma / T\\big)\\, \\big(1 + \\delta\\, \\theta\\big)\n$$\n$$\n\\tau(\\theta,T) = \\tau_{\\text{base}}\\, \\big(1 + \\eta\\, \\theta\\big)\\, \\frac{T_0}{T}\n$$\n$$\nA(\\theta,T) = A_{\\text{base}}\\, \\big(1 + \\zeta\\, \\theta\\big)\\, \\sqrt{\\frac{T_0}{T}}\n$$\n其中所有常数 ($U_0, R_{0,\\text{base}}, \\dots$) 均已给出。\n\n该模型在一个离散时间网格 $t_n = n \\Delta t$（$n \\in \\{0, 1, \\dots, N\\}$）上进行数值实现。卷积积分被计算为离散因果卷积。如果我们定义一个核 $K(t) = \\frac{A(\\theta,T)}{\\tau(\\theta,T)} \\exp(-t/\\tau(\\theta,T))$，那么在时间 $t_n$ 的卷积项是 $(K * I)(t_n) \\Delta t$。这可以使用 `numpy.convolve` 高效计算。那么，在每个时间步 $t_n$ 的最终基准真值电压是：\n$$\nV(t_n) = U(\\theta,T) - R_0(\\theta,T) I(t_n) - A(\\theta,T) \\left( \\left(\\frac{1}{\\tau(\\theta,T)}e^{-t/\\tau(\\theta,T)}\\right) * I(t) \\right)_n \\Delta t\n$$\n\n### 物理信息 DeepONet 代理模型实现\n\nDeepONet 旨在近似以 $(\\theta, T)$ 为条件的算子 $I(\\cdot) \\mapsto V(\\cdot)$。其结构 $\\widehat{V}(t) = \\sum_j c_j \\xi_j(t)$ 将模型分为一个主干网络 (trunk network) 和一个分支网络 (branch network)，主干网络生成与参数无关的基 $\\{\\xi_j(t)\\}$，分支网络计算依赖于输入和参数的系数 $\\{c_j\\}$。\n\n**主干网络：** 基函数 $\\{\\xi_j(t)\\}$ 被设计用于张成可能的电压响应空间。它们是固定的，不依赖于 $(\\theta, T)$。所选的基由三个部分组成：\n1.  **常数基：** $\\xi_0(t) = 1$。此函数提供一个偏置项，该偏置项将由分支网络调制以表示开路电压 $U(\\theta,T)$。\n2.  **输入重构基：** 一组 $m=25$ 个局部高斯函数 $\\{\\phi_i(t)\\}_{i=1}^{m}$，以均匀间隔的传感器位置 $\\{s_i\\}_{i=1}^{m}$ 为中心。通过将每个高斯函数除以它们的和，对这些函数进行归一化以形成单位分解 $\\sum_{i=1}^m \\phi_i(t) = 1$。该基允许网络重构输入电流的平滑表示 $I(t) \\approx \\sum_{i=1}^m I(s_i) \\phi_i(t)$，这对于捕捉欧姆项至关重要。\n3.  **扩散核基：** 一个包含 $K=2$ 个因果指数核 $\\{\\xi_{k,i}(t)\\}_{k,i}$ 的字典，具有固定的时间常数 $\\tau_d^{(1)}$ 和 $\\tau_d^{(2)}$。每个基函数 $\\xi_{k,i}(t) = \\frac{1}{\\tau_d^{(k)}} \\exp(-(t-s_i)/\\tau_d^{(k)})$（当 $t \\ge s_i$ 时，否则为 $0$）表示一个源于传感器位置 $s_i$、特征时间为 $\\tau_d^{(k)}$ 的弛豫响应。对于所有传感器 $i$ 和字典元素 $k$，这些函数的完整集合构成了一个能够近似真实卷积核的基。\n\n**分支网络：** 分支网络计算基函数的系数 $\\{c_j\\}$。在这个问题中，不执行训练；系数被解析地定义为物理参数 $(\\theta, T)$ 和在传感器位置 $s_i$ 采样的输入电流 $I(\\cdot)$ 的函数。\n1.  **常数基的系数：** $c_0 = U(\\theta,T)$，直接将开路电压的物理原理映射到相应的基函数。\n2.  **欧姆项的系数：** $c^{\\text{ohm}}_i = -R_0(\\theta,T) I(s_i)$。当与单位分解基 $\\phi_i(t)$ 结合时，总和 $\\sum_i c^{\\text{ohm}}_i \\phi_i(t) = -R_0(\\theta,T) \\sum_i I(s_i) \\phi_i(t)$ 提供了对真实欧姆压降 $-R_0(\\theta,T) I(t)$ 的平滑近似。\n3.  **扩散项的系数：** $c^{\\text{diff}}_{k,i} = -A(\\theta,T) w_k(\\theta,T) I(s_i) \\Delta s$。这些系数用于缩放指数基函数。项 $I(s_i)\\Delta s$ 近似了卷积积分中的无穷小元 $I(\\tau')d\\tau'$。关键的创新是门控权重 $w_k(\\theta,T)$，它是通过将 softmax 函数应用于分数 $r_k(\\theta,T) = -|\\log \\tau(\\theta,T) - \\log \\tau_d^{(k)}|$ 来计算的。该机制在对数意义上选择与真实物理时间常数 $\\tau(\\theta,T)$ “最接近”的字典核 $\\tau_d^{(k)}$，从而有效地允许固定的主干基适应变化的物理参数。\n\n**代理电压组装：** 最终的代理电压 $\\widehat{V}(t)$ 是通过将所有基函数的贡献（由其相应系数加权）求和来构建的：\n$$\n\\widehat{V}(t_n) = c_0 \\cdot \\xi_0(t_n) + \\sum_{i=1}^{m} c^{\\text{ohm}}_i \\cdot \\phi_{i}(t_n) + \\sum_{k=1}^{K} \\sum_{i=1}^{m} c^{\\text{diff}}_{k,i} \\cdot \\xi_{k,i}(t_n)\n$$\n这个求和是在时间网格上的每个点 $t_n$ 进行数值计算的。\n\n### 评估\n\n对于四个指定的测试用例中的每一个，都使用输入电流分布 $I(t)$、参数 $\\theta$ 和温度 $T$ 来计算整个时间域上的基准真值电压 $V(t_n)$ 和代理电压 $\\widehat{V}(t_n)$。然后，通过均方根误差 (RMSE) 来量化代理模型的准确性：\n$$\n\\text{RMSE} = \\sqrt{\\frac{1}{N+1} \\sum_{n=0}^{N} \\big(\\widehat{V}(t_n) - V(t_n)\\big)^2}\n$$\n程序计算并报告每个情况的 RMSE 值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    # --- GLOBAL PARAMETERS ---\n    # Time discretization\n    t_max = 10.0\n    dt = 0.02\n    N = int(t_max / dt)\n    t_grid = np.linspace(0, t_max, N + 1)\n\n    # Sensor placement\n    m = 25\n    s_locs = np.linspace(0, t_max, m)\n    ds = t_max / (m - 1) if m > 1 else 0\n\n    # DeepONet dictionary parameters\n    tau_d = np.array([1.0, 4.0])\n    K = len(tau_d)\n\n    # Physical constants\n    T0 = 298.0\n    U0 = 3.6\n    R0_base = 0.01\n    tau_base = 2.0\n    A_base = 0.02\n    alpha = 0.10\n    beta = 0.001\n    delta = 0.20\n    eta = 0.50\n    zeta = 0.30\n    gamma = 300.0\n\n    # --- HELPER FUNCTIONS ---\n    def get_physical_params(theta, T):\n        \"\"\"Computes the physical parameters U, R0, tau, A for given theta and T.\"\"\"\n        U = U0 + alpha * theta + beta * (T - T0)\n        R0 = R0_base * np.exp(gamma / T) * (1 + delta * theta)\n        tau = tau_base * (1 + eta * theta) * (T0 / T)\n        A = A_base * (1 + zeta * theta) * np.sqrt(T0 / T)\n        return U, R0, tau, A\n\n    # --- GROUND-TRUTH MODEL ---\n    def calculate_V_true(I_t, theta, T):\n        \"\"\"Computes the ground-truth voltage V(t).\"\"\"\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # Convolution term: A * integral( (1/tau) * exp(-(t-t'))/tau * I(t') dt' )\n        # Implemented as a discrete convolution\n        if tau > 1e-9: # Avoid division by zero\n            kernel = (1 / tau) * np.exp(-t_grid / tau)\n            convolution_integral = np.convolve(I_t, kernel)[:N + 1] * dt\n        else:\n            convolution_integral = np.zeros_like(t_grid)\n        \n        V_true = U - R0 * I_t - A * convolution_integral\n        return V_true\n\n    # --- PHYSICS-INFORMED DEEPONET SURROGATE ---\n    def calculate_V_hat(I_t, theta, T):\n        \"\"\"Computes the DeepONet surrogate voltage V_hat(t).\"\"\"\n        # Sample input current at sensor locations\n        I_s = np.interp(s_locs, t_grid, I_t)\n        \n        # Get physical parameters for branch network\n        U, R0, tau, A = get_physical_params(theta, T)\n        \n        # --- TRUNK NETWORK: Basis Functions ---\n        # 1. Constant basis\n        xi_0 = np.ones_like(t_grid)\n        \n        # 2. Input reconstruction basis (normalized Gaussians)\n        sigma = ds\n        phi_unnormalized = np.exp(-(t_grid[:, np.newaxis] - s_locs)**2 / (2 * sigma**2))\n        phi_sum = np.sum(phi_unnormalized, axis=1, keepdims=True)\n        # Prevent division by zero if sum is numerically zero\n        phi_sum[phi_sum  1e-9] = 1.0\n        phi_normalized = phi_unnormalized / phi_sum  # Shape: (N+1, m)\n\n        # 3. Diffusive kernel basis (causal exponentials)\n        xi_ki = np.zeros((K, m, N + 1))\n        for k in range(K):\n            for i in range(m):\n                mask = t_grid >= s_locs[i]\n                time_diff = t_grid[mask] - s_locs[i]\n                xi_ki[k, i, mask] = (1 / tau_d[k]) * np.exp(-time_diff / tau_d[k])\n                \n        # --- BRANCH NETWORK: Coefficients ---\n        # 1. Coefficient for constant basis\n        c_0 = U\n        \n        # 2. Coefficients for ohmic term\n        c_ohm_i = -R0 * I_s  # Shape: (m,)\n        \n        # 3. Coefficients for diffusive term\n        # Softmax gating weights w_k\n        r_k = -np.abs(np.log(tau) - np.log(tau_d))\n        exp_r_k = np.exp(r_k)\n        w_k = exp_r_k / np.sum(exp_r_k)  # Shape: (K,)\n        # Full coefficients c_diff_k,i\n        c_diff_ki = -A * w_k[:, np.newaxis] * I_s[np.newaxis, :] * ds # Shape: (K, m)\n\n        # --- ASSEMBLE SURROGATE VOLTAGE ---\n        # Term 1: Constant term\n        V_hat = c_0 * xi_0\n        \n        # Term 2: Ohmic term\n        ohmic_term = np.sum(c_ohm_i[np.newaxis, :] * phi_normalized, axis=1)\n        V_hat += ohmic_term\n        \n        # Term 3: Diffusive term\n        # Sum over k and i.\n        diffusive_term = np.sum(c_diff_ki[:, :, np.newaxis] * xi_ki, axis=(0, 1))\n        V_hat += diffusive_term\n        \n        return V_hat\n\n    # --- TEST SUITE ---\n    test_cases = [\n        (lambda t: 2.0 * np.sin(2 * np.pi * 0.5 * t), 0.5, 298.0),\n        (lambda t: 5.0 * (t >= 2.0), 1.5, 318.0),\n        (lambda t: np.zeros_like(t), 0.7, 290.0),\n        (lambda t: 8.0 * np.exp(-(t - 5.0)**2 / (2 * 0.15**2)), 0.2, 273.0),\n    ]\n\n    results = []\n    for i, (I_func, theta, T) in enumerate(test_cases):\n        I_t = I_func(t_grid)\n        \n        # Calculate ground-truth and surrogate voltages\n        V_true = calculate_V_true(I_t, theta, T)\n        V_hat = calculate_V_hat(I_t, theta, T)\n        \n        # Calculate RMSE\n        rmse = np.sqrt(np.mean((V_hat - V_true)**2))\n        results.append(rmse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个真正有用的代理模型不仅要提供准确的预测，还必须可靠地量化其自身的不确定性。对于工程应用而言，了解预测的置信度与预测本身同等重要。在最后的这个练习中，您将学习如何评估模型不确定性估计的质量 。您将通过编程实现一个标准流程，以计算预测区间的经验覆盖率，这是判断模型的置信水平是否经过良好校准和值得信赖的关键指标。",
            "id": "3941070",
            "problem": "一个伪二维 (P2D) 模型的物理信息神经代理模型，具体来说是一个物理信息神经网络 (PINN)，在给定的电流曲线下，生成锂离子电池端电压的时间分辨预测。对于每个离散时间索引 $t$，该代理模型返回一个预测平均电压 $\\mu(t)$ 和一个预测标准差 $\\sigma_{\\text{model}}(t)$，用于量化由模型近似和潜在可变性引起的不确定性。给你提供了同一电池电压的预留实验测量值 $y_{\\text{obs}}(t)$。测量过程带有一个已知的、稳态的测量噪声标准差 $\\sigma_{\\text{meas}}$，单位为伏特。假设以下基本前提：代理模型对电压的潜在预测分布是高斯分布，且独立于高斯测量噪声；观测电压是潜在电压与测量噪声之和。目标是通过在预留的实验数据上计算经验覆盖概率来评估双侧预测区间的校准度。\n\n你的任务是编写一个完整的程序，该程序为每个指定的预留实验和每个指定的名义覆盖水平，构建可观测电压的双侧预测区间，并计算经验覆盖率。经验覆盖率定义为测量电压落在区间内（包括端点）的观测样本所占的比例。所有电压和标准差的单位均为伏特；覆盖率输出为无单位的小数。不涉及角度。将所有最终的覆盖率值表示为小数。\n\n使用以下测试套件。对于每个案例 $i$，给你以下数据：\n- 预测平均值 $\\mu_i = [\\mu_i(1),\\dots,\\mu_i(T_i)]$（单位：伏特），\n- 预测模型标准差 $\\sigma_{\\text{model},i} = [\\sigma_{\\text{model},i}(1),\\dots,\\sigma_{\\text{model},i}(T_i)]$（单位：伏特），\n- 已知测量噪声标准差 $\\sigma_{\\text{meas},i}$（单位：伏特），\n- 观测电压 $y_{\\text{obs},i} = [y_{\\text{obs},i}(1),\\dots,y_{\\text{obs},i}(T_i)]$（单位：伏特），\n- 名义覆盖水平列表 $A = [a_1,a_2,a_3]$（无单位小数）。\n\n根据独立性和高斯假设推断出的组合预测分布，为可观测电压在每个水平 $a_j \\in A$ 上构建双侧区间。然后，计算该区间的经验覆盖率，即观测值 $y_{\\text{obs},i}(t)$ 落在区间内（包括端点）的时间索引 $t \\in \\{1,\\dots,T_i\\}$ 所占的比例。将零宽度区间视为闭区间。\n\n测试套件：\n- 案例 1（良好校准，轻度残差）：\n  - $\\mu_1 = [$ $3.90$, $3.88$, $3.86$, $3.84$, $3.82$, $3.80$ $]$ 伏特\n  - $\\sigma_{\\text{model},1} = [$ $0.01$, $0.01$, $0.01$, $0.01$, $0.01$, $0.01$ $]$ 伏特\n  - $\\sigma_{\\text{meas},1} = $ $0.01$ 伏特\n  - $y_{\\text{obs},1} = [$ $3.905$, $3.870$, $3.872$, $3.836$, $3.820$, $3.820$ $]$ 伏特\n- 案例 2（欠分散预测）：\n  - $\\mu_2 = [$ $3.90$, $3.88$, $3.86$, $3.84$, $3.82$, $3.80$ $]$ 伏特\n  - $\\sigma_{\\text{model},2} = [$ $0.002$, $0.002$, $0.002$, $0.002$, $0.002$, $0.002$ $]$ 伏特\n  - $\\sigma_{\\text{meas},2} = $ $0.005$ 伏特\n  - $y_{\\text{obs},2} = [$ $3.905$, $3.870$, $3.872$, $3.836$, $3.820$, $3.820$ $]$ 伏特\n- 案例 3（边缘案例，某个时间点噪声和离散度均为零）：\n  - $\\mu_3 = [$ $4.00$, $3.95$, $3.90$, $3.85$ $]$ 伏特\n  - $\\sigma_{\\text{model},3} = [$ $0.00$, $0.005$, $0.005$, $0.005$ $]$ 伏特\n  - $\\sigma_{\\text{meas},3} = $ $0.00$ 伏特\n  - $y_{\\text{obs},3} = [$ $4.00$, $3.955$, $3.890$, $3.870$ $]$ 伏特\n\n名义覆盖水平（对所有案例同样适用）：\n- $A = [$ $0.5$, $0.8$, $0.95$ $]$。\n\n你的程序必须为每个案例 $i \\in \\{1,2,3\\}$ 和每个名义水平 $a_j \\in A$ 计算经验覆盖率，结果为 $[0,1]$ 内的小数。最终输出必须是单行文本，包含一个方括号括起来的逗号分隔列表，其中的覆盖率按以下顺序排列：\n$[$ $\\text{cov}(1,a_1)$, $\\text{cov}(1,a_2)$, $\\text{cov}(1,a_3)$, $\\text{cov}(2,a_1)$, $\\text{cov}(2,a_2)$, $\\text{cov}(2,a_3)$, $\\text{cov}(3,a_1)$, $\\text{cov}(3,a_2)$, $\\text{cov}(3,a_3)$ $]$。\n\n使用的假设：\n- 在每个时间点 $t$，代理模型对电压的潜在预测分布是均值为 $\\mu(t)$、标准差为 $\\sigma_{\\text{model}}(t)$ 的高斯分布。\n- 测量噪声是均值为零的高斯噪声，独立于潜在预测分布，其标准差 $\\sigma_{\\text{meas}}$ 已知。\n\n所有电压和标准差都必须视为以伏特为单位；所有输出的覆盖率必须是无单位的小数。最终程序必须精确生成一行符合指定格式的输出，其中包含 $9$ 个小数。",
            "solution": "我们从高斯随机变量和独立性的基本定义开始。设给定时间索引的潜在端电压为一个高斯随机变量 $X$，其均值为 $\\mu$，标准差为 $\\sigma_{\\text{model}}$，这代表了物理信息神经代理模型的预测分布。设测量噪声为一个独立的、均值为 $0$、标准差为 $\\sigma_{\\text{meas}}$ 的高斯随机变量 $N$。观测端电压为 $Y = X + N$。\n\n根据高斯随机变量的性质，独立高斯随机变量之和仍为高斯分布，其均值等于各均值之和，方差等于各方差之和。因此，\n$$\nY \\sim \\mathcal{N}\\left(\\mu,\\; \\sigma_{\\text{total}}^{2}\\right), \\quad \\text{其中} \\quad \\sigma_{\\text{total}} = \\sqrt{\\sigma_{\\text{model}}^{2} + \\sigma_{\\text{meas}}^{2}}.\n$$\n对于一个高斯分布，包含其名义概率质量 $a \\in (0,1)$ 的双侧中心区间是通过选择一个阈值 $z$ 来构建的，使得\n$$\n\\mathbb{P}\\left(|Z| \\le z\\right) = a, \\quad \\text{其中} \\quad Z \\sim \\mathcal{N}(0,1).\n$$\n等价地，$z = \\Phi^{-1}\\left(\\frac{1+a}{2}\\right)$，其中 $\\Phi$ 是标准正态分布的累积分布函数。因此，在名义质量 $a$ 下，$Y$ 的双侧区间为\n$$\n\\left[\\mu - z \\,\\sigma_{\\text{total}},\\; \\mu + z \\,\\sigma_{\\text{total}}\\right].\n$$\n为了进行经验覆盖率估计，给定时间索引 $t \\in \\{1,\\dots,T\\}$、预测均值 $\\mu(t)$、预测模型标准差 $\\sigma_{\\text{model}}(t)$、已知测量噪声标准差 $\\sigma_{\\text{meas}}$ 和观测电压 $y_{\\text{obs}}(t)$，我们计算\n$$\n\\sigma_{\\text{total}}(t) = \\sqrt{\\sigma_{\\text{model}}(t)^{2} + \\sigma_{\\text{meas}}^{2}},\n$$\n并将每个 $t$ 的区间定义为\n$$\nI_a(t) = \\left[\\mu(t) - z_a\\, \\sigma_{\\text{total}}(t),\\; \\mu(t) + z_a\\, \\sigma_{\\text{total}}(t)\\right], \\quad z_a = \\Phi^{-1}\\!\\left(\\frac{1+a}{2}\\right).\n$$\n然后我们计算经验覆盖率如下：\n$$\n\\text{cov}(a) = \\frac{1}{T}\\sum_{t=1}^{T} \\mathbf{1}\\!\\left\\{ y_{\\text{obs}}(t) \\in I_a(t) \\right\\},\n$$\n区间成员关系包含端点。在 $\\sigma_{\\text{total}}(t) = 0$ 的边缘案例中，区间退化为单点 $[\\mu(t),\\mu(t)]$，只有当 $y_{\\text{obs}}(t) = \\mu(t)$ 精确相等时才算作被覆盖。\n\n我们将此过程应用于指定的测试套件，其中 $A = [$ $0.5$, $0.8$, $0.95$ $]$。\n\n案例 1：\n- $\\mu_1 = [$ $3.90$, $3.88$, $3.86$, $3.84$, $3.82$, $3.80$ $]$,\n- $\\sigma_{\\text{model},1}(t) = $ $0.01$ 对所有 $t$,\n- $\\sigma_{\\text{meas},1} = $ $0.01$,\n- $y_{\\text{obs},1} = [$ $3.905$, $3.870$, $3.872$, $3.836$, $3.820$, $3.820$ $]$.\n对所有 $t$ 计算 $\\sigma_{\\text{total},1}(t) = \\sqrt{(0.01)^{2} + (0.01)^{2}} = \\sqrt{0.0002} \\approx 0.0141421356$。对于 $a = 0.5$，$z_{0.5} \\approx 0.6744897502$，给出半宽 $w_{0.5} \\approx 0.009545$。残差 $y_{\\text{obs},1} - \\mu_1$ 为 [$0.005$, $-0.010$, $0.012$, $-0.004$, $0.000$, $0.020$]，得出覆盖计数为 $6$ 个中的 $3$ 个，所以 $\\text{cov}(1,0.5) = 0.5$。对于 $a = 0.8$，$z_{0.8} \\approx 1.2815515655$ 给出 $w_{0.8} \\approx 0.018128$，有 $6$ 个中的 $5$ 个被覆盖，所以 $\\text{cov}(1,0.8) \\approx 0.8333333333333334$。对于 $a = 0.95$，$z_{0.95} \\approx 1.9599639845$ 给出 $w_{0.95} \\approx 0.027712$，有 $6$ 个中的 $6$ 个被覆盖，所以 $\\text{cov}(1,0.95) = 1.0$。\n\n案例 2：\n- $\\mu_2 = [$ $3.90$, $3.88$, $3.86$, $3.84$, $3.82$, $3.80$ $]$,\n- $\\sigma_{\\text{model},2}(t) = $ $0.002$,\n- $\\sigma_{\\text{meas},2} = $ $0.005$,\n- $y_{\\text{obs},2} = [$ $3.905$, $3.870$, $3.872$, $3.836$, $3.820$, $3.820$ $]$.\n计算 $\\sigma_{\\text{total},2}(t) = \\sqrt{(0.002)^{2} + (0.005)^{2}} = \\sqrt{0.000029} \\approx 0.0053851648$。对于 $a = 0.5$，$w_{0.5} \\approx 0.003632$，覆盖 $6$ 个中的 $1$ 个，所以 $\\text{cov}(2,0.5) \\approx 0.16666666666666666$。对于 $a = 0.8$，$w_{0.8} \\approx 0.006908$，覆盖 $6$ 个中的 $3$ 个，所以 $\\text{cov}(2,0.8) = 0.5$。对于 $a = 0.95$，$w_{0.95} \\approx 0.010547$，覆盖 $6$ 个中的 $4$ 个，所以 $\\text{cov}(2,0.95) \\approx 0.6666666666666666$。\n\n案例 3：\n- $\\mu_3 = [$ $4.00$, $3.95$, $3.90$, $3.85$ $]$,\n- $\\sigma_{\\text{model},3} = [$ $0.00$, $0.005$, $0.005$, $0.005$ $]$,\n- $\\sigma_{\\text{meas},3} = $ $0.00$,\n- $y_{\\text{obs},3} = [$ $4.00$, $3.955$, $3.890$, $3.870$ $]$.\n计算 $\\sigma_{\\text{total},3} = [$ $0.00$, $0.005$, $0.005$, $0.005$ $]$。对于 $a = 0.5$，宽度为 [$0.000$, $0.003372$, $0.003372$, $0.003372$]，覆盖 $4$ 个中的 $1$ 个，所以 $\\text{cov}(3,0.5) = 0.25$。对于 $a = 0.8$，宽度为 [$0.000$, $0.006408$, $0.006408$, $0.006408$]，覆盖 $4$ 个中的 $2$ 个，所以 $\\text{cov}(3,0.8) = 0.5$。对于 $a = 0.95$，宽度为 [$0.000$, $0.009800$, $0.009800$, $0.009800$]，覆盖 $4$ 个中的 $2$ 个，所以 $\\text{cov}(3,0.95) = 0.5$。\n\n因此，程序应输出包含以下内容的单行文本，并严格遵循该顺序：\n$[$ $0.5$, $0.8333333333333334$, $1.0$, $0.16666666666666666$, $0.5$, $0.6666666666666666$, $0.25$, $0.5$, $0.5$ $]$\n算法步骤如下：\n- 对于每个案例，根据 $\\sigma_{\\text{model}}(t)$ 和 $\\sigma_{\\text{meas}}$ 计算 $\\sigma_{\\text{total}}(t)$。\n- 对于每个名义值 $a$，计算 $z_a = \\Phi^{-1}\\!\\left(\\frac{1+a}{2}\\right)$。\n- 构建区间 $\\left[\\mu(t) - z_a \\sigma_{\\text{total}}(t), \\mu(t) + z_a \\sigma_{\\text{total}}(t)\\right]$。\n- 计算 $y_{\\text{obs}}(t)$ 被包含的次数，然后除以 $T$ 得到经验覆盖率。\n- 按指定顺序汇总结果，并以单行列表形式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef empirical_coverage(mu, sigma_model, sigma_meas, y_obs, levels):\n    mu = np.asarray(mu, dtype=float)\n    sigma_model = np.asarray(sigma_model, dtype=float)\n    y_obs = np.asarray(y_obs, dtype=float)\n    # Total predictive std for observable under Gaussian + independence\n    sigma_total = np.sqrt(sigma_model**2 + float(sigma_meas)**2)\n    results = []\n    for a in levels:\n        z = norm.ppf((1.0 + float(a)) / 2.0)\n        half_width = z * sigma_total\n        lower = mu - half_width\n        upper = mu + half_width\n        # Inclusive interval membership\n        covered = (y_obs >= lower)  (y_obs = upper)\n        cov = covered.mean() if covered.size > 0 else float('nan')\n        results.append(cov)\n    return results\n\ndef solve():\n    # Test suite as specified in the problem statement\n    levels = [0.5, 0.8, 0.95]\n\n    # Case 1\n    mu1 = [3.90, 3.88, 3.86, 3.84, 3.82, 3.80]\n    sigma_model_1 = [0.01, 0.01, 0.01, 0.01, 0.01, 0.01]\n    sigma_meas_1 = 0.01\n    y_obs_1 = [3.905, 3.870, 3.872, 3.836, 3.820, 3.820]\n\n    # Case 2\n    mu2 = [3.90, 3.88, 3.86, 3.84, 3.82, 3.80]\n    sigma_model_2 = [0.002, 0.002, 0.002, 0.002, 0.002, 0.002]\n    sigma_meas_2 = 0.005\n    y_obs_2 = [3.905, 3.870, 3.872, 3.836, 3.820, 3.820]\n\n    # Case 3\n    mu3 = [4.00, 3.95, 3.90, 3.85]\n    sigma_model_3 = [0.00, 0.005, 0.005, 0.005]\n    sigma_meas_3 = 0.00\n    y_obs_3 = [4.00, 3.955, 3.890, 3.870]\n\n    # Compute coverages\n    cov1 = empirical_coverage(mu1, sigma_model_1, sigma_meas_1, y_obs_1, levels)\n    cov2 = empirical_coverage(mu2, sigma_model_2, sigma_meas_2, y_obs_2, levels)\n    cov3 = empirical_coverage(mu3, sigma_model_3, sigma_meas_3, y_obs_3, levels)\n\n    results = cov1 + cov2 + cov3\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}