{
    "hands_on_practices": [
        {
            "introduction": "在校准模型参数后，评估这些参数估计的不确定性至关重要。本练习将介绍拉普拉斯近似法，这是一种将似然函数曲率（通过费雪信息矩阵衡量）与参数的后验协方差联系起来的基本工具。通过完成这个练习，你将学会如何为一个简化的电池模型推导和计算后验不确定性，为参数估计提供实用的“误差棒”。",
            "id": "3895848",
            "problem": "您的任务是，在无量纲归一化下，推导并实现一种包含固体电解质界面膜（SEI）效应的简化锂离子电池单粒子模型（SPM）的费雪信息计算。无量纲端电压残差的测量模型由一个确定性预测与加性高斯噪声组合而成。确定性预测包括欧姆压降、电荷转移效应、扩散限制输运以及SEI膜电阻增长的贡献。由于所有量都已通过适当的参考标度进行了归一化，因此它们都是无量纲的，计算中任何地方都不应使用物理单位。\n\n考虑一个恒流实验，其无量纲电流为 $I$，观测时间为 $\\{t_i\\}_{i=1}^N$。无量纲的预测端电压模型为\n$$\nV_i(\\theta) = U_0 - I \\left( R_{\\mathrm{ohm}} + R_{\\mathrm{ct},0} + \\frac{\\gamma}{D_s} + R_{f,0} + k_{\\mathrm{SEI}} \\sqrt{t_i} \\right),\n$$\n其中 $U_0$、$R_{\\mathrm{ohm}}$、$R_{\\mathrm{ct},0}$ 和 $\\gamma$ 是已知的正常数，未知参数的向量为\n$$\n\\theta = \\begin{bmatrix} k_{\\mathrm{SEI}} \\\\ R_{f,0} \\\\ D_s \\end{bmatrix},\n$$\n其中，$k_{\\mathrm{SEI}}$ 是SEI生长系数，$R_{f,0}$ 是初始SEI膜电阻项，$D_s$ 是无量纲固相扩散系数。观测值满足\n$$\ny_i = V_i(\\theta) + \\varepsilon_i,\n$$\n其中噪声 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$ 是独立同分布的，噪声水平 $\\sigma  0$ 已知。\n\n从独立观测值的高斯似然出发，并根据费雪信息的定义（即对数似然函数关于 $\\theta$ 的负海森矩阵的期望），推导在标称参数值 $\\theta_0$ 处的费雪信息矩阵表达式，并为给定模型计算该矩阵。然后，在高斯先验 $\\theta \\sim \\mathcal{N}(\\theta_0, \\Sigma_{\\mathrm{prior}})$（其中对角协方差矩阵 $\\Sigma_{\\mathrm{prior}}$ 已知）的条件下，推导后验协方差的拉普拉斯近似：\n$$\n\\Sigma_{\\mathrm{post}} \\approx \\left( \\Sigma_{\\mathrm{prior}}^{-1} + \\mathcal{I}(\\theta_0) \\right)^{-1},\n$$\n其中 $\\mathcal{I}(\\theta_0)$ 是在 $\\theta_0$ 处的费雪信息矩阵。实现一个程序，为每个测试用例计算 $\\Sigma_{\\mathrm{post}}$ 的对角线元素。\n\n您的推导必须从独立高斯噪声的对数似然开始，然后计算模型预测关于 $\\theta$ 的梯度，构建雅可比矩阵 $J(\\theta_0)$（其 $(i,j)$ 项是在 $\\theta_0$ 处计算的 $\\partial V_i(\\theta)/\\partial \\theta_j$），并利用它来评估费雪信息。不得在未从这些基础进行推导的情况下引用任何结果。所有计算和输出都必须是无量纲形式。\n\n使用以下测试套件。每个测试用例都指定了已知常数、实验设计、标称参数 $\\theta_0$ 和先验协方差。对于每种情况，计算后验协方差近似，并将其对角线元素作为包含三个浮点数的列表输出，顺序对应于 $[k_{\\mathrm{SEI}}, R_{f,0}, D_s]$：\n\n- 测试用例1（一般情况，中等信息量）：\n  - 已知常数：$U_0 = 3.8$, $R_{\\mathrm{ohm}} = 0.02$, $R_{\\mathrm{ct},0} = 0.05$, $\\gamma = 0.2$。\n  - 实验：$I = 1.0$，时间 $t = [0.01, 0.1, 1.0, 3.0, 10.0]$，噪声 $\\sigma = 0.005$。\n  - 标称参数：$\\theta_0 = [1\\times 10^{-3},\\; 0.1,\\; 0.5]$。\n  - 先验协方差（对角）：$\\Sigma_{\\mathrm{prior}} = \\mathrm{diag}([1\\times 10^{-4},\\; 1\\times 10^{-2},\\; 1\\times 10^{-1}])$。\n\n- 测试用例2（边界时间包含 $t=0$，低噪声）：\n  - 已知常数：$U_0 = 3.8$, $R_{\\mathrm{ohm}} = 0.02$, $R_{\\mathrm{ct},0} = 0.05$, $\\gamma = 0.2$。\n  - 实验：$I = 2.0$，时间 $t = [0.0, 0.1, 0.4, 1.6, 6.4]$，噪声 $\\sigma = 0.001$。\n  - 标称参数：$\\theta_0 = [5\\times 10^{-4},\\; 0.05,\\; 0.3]$。\n  - 先验协方差（对角）：$\\Sigma_{\\mathrm{prior}} = \\mathrm{diag}([1\\times 10^{-5},\\; 5\\times 10^{-3},\\; 5\\times 10^{-2}])$。\n\n- 测试用例3（边缘情况，零电流导致信息退化）：\n  - 已知常数：$U_0 = 3.8$, $R_{\\mathrm{ohm}} = 0.02$, $R_{\\mathrm{ct},0} = 0.05$, $\\gamma = 0.2$。\n  - 实验：$I = 0.0$，时间 $t = [0.1, 1.0, 10.0]$，噪声 $\\sigma = 0.01$。\n  - 标称参数：$\\theta_0 = [1\\times 10^{-3},\\; 0.1,\\; 0.5]$。\n  - 先验协方差（对角）：$\\Sigma_{\\mathrm{prior}} = \\mathrm{diag}([1\\times 10^{-4},\\; 1\\times 10^{-2},\\; 1\\times 10^{-1}])$。\n\n- 测试用例4（高噪声，弱信息量）：\n  - 已知常数：$U_0 = 3.8$, $R_{\\mathrm{ohm}} = 0.02$, $R_{\\mathrm{ct},0} = 0.05$, $\\gamma = 0.2$。\n  - 实验：$I = 1.0$，时间 $t = [0.1, 0.2, 0.4]$，噪声 $\\sigma = 0.1$。\n  - 标称参数：$\\theta_0 = [1\\times 10^{-3},\\; 0.1,\\; 1.0]$。\n  - 先验协方差（对角）：$\\Sigma_{\\mathrm{prior}} = \\mathrm{diag}([1\\times 10^{-3},\\; 1\\times 10^{-1},\\; 1])$。\n\n您的程序应生成单行输出，其中包含一个由列表组成的列表，用方括号括起并以逗号分隔，例如 “[[v11,v12,v13],[v21,v22,v23],...]”，其中每个内部列表按 $[k_{\\mathrm{SEI}}, R_{f,0}, D_s]$ 的顺序包含相应测试用例的 $\\Sigma_{\\mathrm{post}}$ 的三个对角线元素。所有输出都必须是无量纲浮点数。",
            "solution": "用户提供了一个有效的问题陈述。任务是为一个简化的电池退化模型的参数推导并计算后验协方差的拉普拉斯近似。推导将从基本原理出发，始于测量模型的对数似然。\n\n### 1. 费雪信息矩阵的推导\n\n问题设定了一个测量模型，其中每个观测值 $y_i$ 是确定性模型预测 $V_i(\\theta)$ 和随机噪声项 $\\varepsilon_i$ 的和。噪声项被假定为遵循高斯分布的独立同分布，即 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma^2)$，其方差 $\\sigma^2$ 已知。待推断的参数向量为 $\\theta = [k_{\\mathrm{SEI}}, R_{f,0}, D_s]^T$。\n\n给定参数 $\\theta$ 时，单个观测值 $y_i$ 的概率密度函数（PDF）为：\n$$\np(y_i|\\theta) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_i - V_i(\\theta))^2}{2\\sigma^2}\\right)\n$$\n对于一组 $N$ 个独立观测值 $Y = \\{y_1, \\dots, y_N\\}$，联合似然 $L(\\theta|Y)$ 是各个PDF的乘积。处理对数似然 $\\ell(\\theta|Y) = \\log L(\\theta|Y)$ 更为方便：\n$$\n\\ell(\\theta|Y) = \\sum_{i=1}^{N} \\log p(y_i|\\theta) = \\sum_{i=1}^{N} \\left[ -\\frac{1}{2}\\log(2\\pi\\sigma^2) - \\frac{(y_i - V_i(\\theta))^2}{2\\sigma^2} \\right]\n$$\n$$\n\\ell(\\theta|Y) = -\\frac{N}{2}\\log(2\\pi\\sigma^2) - \\frac{1}{2\\sigma^2}\\sum_{i=1}^{N} (y_i - V_i(\\theta))^2\n$$\n费雪信息矩阵（FIM），记为 $\\mathcal{I}(\\theta)$，定义为对数似然函数关于参数 $\\theta$ 的海森矩阵的负期望值。FIM的第 $(j,k)$ 个元素是：\n$$\n\\mathcal{I}_{jk}(\\theta) = -\\mathbb{E}\\left[\\frac{\\partial^2 \\ell(\\theta|Y)}{\\partial \\theta_j \\partial \\theta_k}\\right]\n$$\n其中参数 $\\theta_j$ 是向量 $\\theta$ 的第 $j$ 个元素。\n\n首先，我们求对数似然的梯度（得分函数）：\n$$\n\\frac{\\partial \\ell}{\\partial \\theta_j} = \\frac{\\partial}{\\partial \\theta_j} \\left( -\\frac{1}{2\\sigma^2}\\sum_{i=1}^{N} (y_i - V_i(\\theta))^2 \\right) = \\frac{1}{\\sigma^2}\\sum_{i=1}^{N} (y_i - V_i(\\theta)) \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j}\n$$\n接下来，我们通过对 $\\theta_k$ 微分来计算海森矩阵：\n$$\n\\frac{\\partial^2 \\ell}{\\partial \\theta_j \\partial \\theta_k} = \\frac{1}{\\sigma^2}\\sum_{i=1}^{N} \\frac{\\partial}{\\partial \\theta_k} \\left( (y_i - V_i(\\theta)) \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j} \\right)\n$$\n$$\n\\frac{\\partial^2 \\ell}{\\partial \\theta_j \\partial \\theta_k} = \\frac{1}{\\sigma^2}\\sum_{i=1}^{N} \\left[ -\\frac{\\partial V_i(\\theta)}{\\partial \\theta_k} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j} + (y_i - V_i(\\theta)) \\frac{\\partial^2 V_i(\\theta)}{\\partial \\theta_j \\partial \\theta_k} \\right]\n$$\n对数据分布取期望 $\\mathbb{E}[\\cdot]$，我们利用 $\\mathbb{E}[y_i] = V_i(\\theta)$ 这一事实，这意味着 $\\mathbb{E}[y_i - V_i(\\theta)] = 0$。这简化了海森矩阵的期望：\n$$\n\\mathbb{E}\\left[\\frac{\\partial^2 \\ell}{\\partial \\theta_j \\partial \\theta_k}\\right] = -\\frac{1}{\\sigma^2}\\sum_{i=1}^{N} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_k}\n$$\n应用FIM的定义，我们得到：\n$$\n\\mathcal{I}_{jk}(\\theta) = - \\left( -\\frac{1}{\\sigma^2}\\sum_{i=1}^{N} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_k} \\right) = \\frac{1}{\\sigma^2}\\sum_{i=1}^{N} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j} \\frac{\\partial V_i(\\theta)}{\\partial \\theta_k}\n$$\n这个表达式可以方便地写成矩阵形式。设 $J(\\theta)$ 是一个 $N \\times 3$ 的雅可比矩阵，其中元素 $J_{ij}(\\theta) = \\frac{\\partial V_i(\\theta)}{\\partial \\theta_j}$。那么费雪信息矩阵为：\n$$\n\\mathcal{I}(\\theta) = \\frac{1}{\\sigma^2} J(\\theta)^T J(\\theta)\n$$\n\n### 2. 模型的雅可比矩阵\n\n电压模型由下式给出：\n$$\nV_i(\\theta) = U_0 - I \\left( R_{\\mathrm{ohm}} + R_{\\mathrm{ct},0} + \\frac{\\gamma}{D_s} + R_{f,0} + k_{\\mathrm{SEI}} \\sqrt{t_i} \\right)\n$$\n参数向量为 $\\theta = [\\theta_1, \\theta_2, \\theta_3]^T = [k_{\\mathrm{SEI}}, R_{f,0}, D_s]^T$。我们计算 $V_i$ 对每个参数的偏导数：\n$$\n\\frac{\\partial V_i}{\\partial \\theta_1} = \\frac{\\partial V_i}{\\partial k_{\\mathrm{SEI}}} = -I \\sqrt{t_i}\n$$\n$$\n\\frac{\\partial V_i}{\\partial \\theta_2} = \\frac{\\partial V_i}{\\partial R_{f,0}} = -I\n$$\n$$\n\\frac{\\partial V_i}{\\partial \\theta_3} = \\frac{\\partial V_i}{\\partial D_s} = -I \\frac{\\partial}{\\partial D_s}\\left(\\frac{\\gamma}{D_s}\\right) = -I \\left(-\\frac{\\gamma}{D_s^2}\\right) = \\frac{I \\gamma}{D_s^2}\n$$\n雅可比矩阵 $J(\\theta)$ 的第 $i$ 行是 $V_i(\\theta)$ 梯度的转置，即 $\\nabla_\\theta V_i(\\theta)^T$：\n$$\nJ(\\theta)_{i,:} = \\left[ -I \\sqrt{t_i}, \\quad -I, \\quad \\frac{I \\gamma}{D_s^2} \\right]\n$$\n\n### 3. 后验协方差近似\n\n问题要求使用拉普拉斯近似来计算后验协方差，给定高斯先验 $\\theta \\sim \\mathcal{N}(\\theta_0, \\Sigma_{\\mathrm{prior}})$。根据贝叶斯定理，后验分布与似然和先验的乘积成正比：$p(\\theta|Y) \\propto L(Y|\\theta)p(\\theta)$。拉普拉斯近似将后验分布近似为一个以以后验众数为中心的高斯分布，其协方差矩阵是在该众数点评估的对数后验负海森矩阵的逆矩阵。\n\n对数后验为 $\\log p(\\theta|Y) = \\ell(\\theta|Y) + \\log p(\\theta) + \\text{const.}$。对数后验的负海森矩阵是：\n$$\n-\\frac{\\partial^2 \\log p(\\theta|Y)}{\\partial\\theta\\partial\\theta^T} = -\\frac{\\partial^2 \\ell(\\theta|Y)}{\\partial\\theta\\partial\\theta^T} - \\frac{\\partial^2 \\log p(\\theta)}{\\partial\\theta\\partial\\theta^T}\n$$\n对于高斯先验，其对数的二阶导数是常数：$-\\frac{\\partial^2 \\log p(\\theta)}{\\partial\\theta\\partial\\theta^T} = \\Sigma_{\\mathrm{prior}}^{-1}$。用先验均值 $\\theta_0$ 近似后验众数，并取期望，可得到后验精度矩阵：\n$$\n\\Sigma_{\\mathrm{post}}^{-1} \\approx \\mathbb{E}\\left[-\\left.\\frac{\\partial^2 \\ell}{\\partial\\theta\\partial\\theta^T}\\right|_{\\theta_0}\\right] + \\Sigma_{\\mathrm{prior}}^{-1} = \\mathcal{I}(\\theta_0) + \\Sigma_{\\mathrm{prior}}^{-1}\n$$\n因此，后验协方差矩阵为：\n$$\n\\Sigma_{\\mathrm{post}} \\approx \\left( \\mathcal{I}(\\theta_0) + \\Sigma_{\\mathrm{prior}}^{-1} \\right)^{-1}\n$$\n\n### 4. 计算步骤\n\n对于每个测试用例，算法如下：\n1.  初始化已知常数和实验设计参数：$\\gamma$、$I$、$\\{t_i\\}$、$\\sigma$、$\\theta_0 = [k_{\\mathrm{SEI},0}, R_{f,0,0}, D_{s,0}]^T$ 以及 $\\Sigma_{\\mathrm{prior}}$ 的对角线元素。\n2.  通过在 $\\theta_0$ 和每个时间点 $t_i$ 处计算推导出的偏导数，构建 $N \\times 3$ 的雅可比矩阵 $J(\\theta_0)$。\n3.  计算费雪信息矩阵 $\\mathcal{I}(\\theta_0) = \\frac{1}{\\sigma^2} J(\\theta_0)^T J(\\theta_0)$。\n4.  构建先验精度矩阵 $\\Sigma_{\\mathrm{prior}}^{-1}$，这是一个对角矩阵，其对角线元素是给定的 $\\Sigma_{\\mathrm{prior}}$ 对角线元素的倒数。\n5.  计算后验精度矩阵 $M = \\mathcal{I}(\\theta_0) + \\Sigma_{\\mathrm{prior}}^{-1}$。\n6.  对 $M$ 求逆以获得后验协方差近似：$\\Sigma_{\\mathrm{post}} = M^{-1}$。\n7.  提取 $\\Sigma_{\\mathrm{post}}$ 的对角线元素，这些元素对应于 $k_{\\mathrm{SEI}}$、$R_{f,0}$ 和 $D_s$ 的后验方差。\n该过程在提供的Python代码中直接实现。当 $I=0$ 时会出现一个特殊情况，此时雅可比矩阵为零矩阵，导致 $\\mathcal{I}(\\theta_0) = 0$。在这种情况下，后验协方差 $\\Sigma_{\\mathrm{post}}$ 与先验协方差 $\\Sigma_{\\mathrm{prior}}$ 相同，这反映了零电流实验没有为模型参数提供任何新信息。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the diagonal of the Laplace-approximated posterior covariance matrix\n    for parameters of a simplified battery model for several test cases.\n    \"\"\"\n    test_cases = [\n        # Test Case 1\n        {\n            \"constants\": {\"gamma\": 0.2},\n            \"experiment\": {\"I\": 1.0, \"t\": [0.01, 0.1, 1.0, 3.0, 10.0], \"sigma\": 0.005},\n            \"theta0\": [1e-3, 0.1, 0.5],\n            \"prior_cov_diag\": [1e-4, 1e-2, 1e-1],\n        },\n        # Test Case 2\n        {\n            \"constants\": {\"gamma\": 0.2},\n            \"experiment\": {\"I\": 2.0, \"t\": [0.0, 0.1, 0.4, 1.6, 6.4], \"sigma\": 0.001},\n            \"theta0\": [5e-4, 0.05, 0.3],\n            \"prior_cov_diag\": [1e-5, 5e-3, 5e-2],\n        },\n        # Test Case 3\n        {\n            \"constants\": {\"gamma\": 0.2},\n            \"experiment\": {\"I\": 0.0, \"t\": [0.1, 1.0, 10.0], \"sigma\": 0.01},\n            \"theta0\": [1e-3, 0.1, 0.5],\n            \"prior_cov_diag\": [1e-4, 1e-2, 1e-1],\n        },\n        # Test Case 4\n        {\n            \"constants\": {\"gamma\": 0.2},\n            \"experiment\": {\"I\": 1.0, \"t\": [0.1, 0.2, 0.4], \"sigma\": 0.1},\n            \"theta0\": [1e-3, 0.1, 1.0],\n            \"prior_cov_diag\": [1e-3, 1e-1, 1.0],\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current test case\n        gamma = case[\"constants\"][\"gamma\"]\n        I = case[\"experiment\"][\"I\"]\n        t = np.array(case[\"experiment\"][\"t\"], dtype=float)\n        sigma = case[\"experiment\"][\"sigma\"]\n        k_sei0, r_f0_0, d_s0 = case[\"theta0\"]\n        prior_cov_diag = np.array(case[\"prior_cov_diag\"], dtype=float)\n\n        # Number of observation times\n        N = len(t)\n\n        # 1. Construct the Jacobian matrix J(theta_0)\n        # J is an N x 3 matrix where J_ij = dV_i / d(theta_j)\n        # theta = [k_sei, r_f0, d_s]\n        \n        # Column 1: Derivatives with respect to k_sei\n        # dV/dk_sei = -I * sqrt(t_i)\n        col1 = -I * np.sqrt(t)\n\n        # Column 2: Derivatives with respect to r_f0\n        # dV/dr_f0 = -I\n        col2 = -I * np.ones(N)\n\n        # Column 3: Derivatives with respect to d_s\n        # dV/d_ds = I * gamma / d_s^2\n        col3 = (I * gamma / (d_s0**2)) * np.ones(N)\n\n        # Assemble the N x 3 Jacobian matrix\n        J = np.vstack([col1, col2, col3]).T\n\n        # 2. Compute the Fisher Information Matrix I(theta_0)\n        # I = (1/sigma^2) * J^T @ J\n        fisher_info = (1 / sigma**2) * (J.T @ J)\n\n        # 3. Construct the prior precision matrix (inverse of prior covariance)\n        # Since Sigma_prior is diagonal, its inverse is also diagonal\n        prior_precision = np.diag(1.0 / prior_cov_diag)\n\n        # 4. Compute the posterior precision matrix\n        # M = Sigma_prior^-1 + I(theta_0)\n        M = prior_precision + fisher_info\n\n        # 5. Invert M to get the posterior covariance matrix Sigma_post\n        try:\n            post_cov = np.linalg.inv(M)\n        except np.linalg.LinAlgError:\n            # This case should not be reached with a proper prior\n            post_cov = np.full((3, 3), np.nan)\n\n        # 6. Extract the diagonal entries of Sigma_post\n        diag_post_cov = np.diagonal(post_cov).tolist()\n        results.append(diag_post_cov)\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在现实世界的电池寿命测试中，实验常常在所有样本都失效前结束，这导致了所谓的“删失”数据。直接忽略这些删失数据会严重偏离真实的参数估计。本练习将演示在生存分析中如何正确构建似然函数，以同时处理已失效和被删失的观测数据，从而实现对失效速率的无偏估计。",
            "id": "3895926",
            "problem": "一个自动化电池循环平台被用于在锂离子电池设计工作流程中，校准一种激进快充策略下析锂的随机失效时间。假设在该策略下，每个电池的失效时间 $T$ 是独立的，并服从一个具有恒定风险率参数 $\\lambda$ 的指数分布，其概率密度函数为 $f(t \\mid \\lambda)$，生存函数为 $S(t \\mid \\lambda)$。在生存分析中，当测试在一个预定的删失时间 $t_{c}$ 停止，而电池在该时间点尚未失效时，就会发生右删失；一个右删失观测值对似然的贡献是在 $t_{c}$ 时的生存概率。\n\n该平台运行 $8$ 个并行测试。五个电池在 $t = \\{120, 350, 600, 700, 760\\}$ 小时失效，而三个电池在停止时间 $t_{c} = 800$ 小时仍未失效（在 $t_{c}$ 右删失）。您的目标是使用形状参数为 $\\alpha$、率参数为 $\\beta$ 的伽马先验对 $\\lambda$ 进行贝叶斯校准，其中伽马密度为 $p(\\lambda \\mid \\alpha, \\beta) \\propto \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda)$。假设 $\\alpha = 2$ 且 $\\beta = 500$（率参数的单位为小时）。\n\n从指数模型的基本定义——即 $f(t \\mid \\lambda) = \\lambda \\exp(-\\lambda t)$ 和 $S(t \\mid \\lambda) = \\exp(-\\lambda t)$——以及右删失规则（即混合了失效和删失观测值的似然是失效观测值密度的乘积与删失观测值生存概率的乘积）出发，推导 $\\lambda$ 的后验分布，并求出 $\\lambda$ 的最大后验 (MAP; Maximum A Posteriori) 估计。请将您的 MAP 估计的最终答案以 $\\mathrm{h}^{-1}$ 为单位表示，并四舍五入到四位有效数字。您的最终答案必须是一个实数。",
            "solution": "目标是给定一组失效时间和右删失数据，为指数失效时间模型的风险率参数 $\\lambda$ 找到最大后验 (MAP) 估计。这将通过贝叶斯校准来实现。\n\n首先，我们必须为观测数据构建似然函数。数据包含在时间 $t_i$ 发生的 $k=5$ 次失效和在删失时间 $t_c$ 的 $m=3$ 个右删失观测值。测试的电池总数为 $N=k+m=8$。\n失效时间集为 $T_{fail} = \\{120, 350, 600, 700, 760\\}$ 小时。\n删失时间为 $t_c = 800$ 小时。\n\n失效时间 $T$ 由指数分布建模，其概率密度函数 (PDF) 为 $f(t \\mid \\lambda) = \\lambda \\exp(-\\lambda t)$，生存函数为 $S(t \\mid \\lambda) = \\exp(-\\lambda t)$。\n\n对于 $k=5$ 个失效的电池中的每一个，其对似然的贡献是其失效时间 $t_i$ 处的概率密度函数 (PDF) 的值。\n对于在测试停止时间 $t_c$ 仍未失效的 $m=3$ 个电池中的每一个，其观测值是右删失的。其对似然的贡献是存活超过 $t_c$ 的概率，这由生存函数 $S(t_c \\mid \\lambda)$ 给出。\n\n假设失效事件是独立的，总似然函数 $L(\\lambda \\mid \\text{data})$ 是各个贡献的乘积：\n$$L(\\lambda \\mid \\text{data}) = \\left( \\prod_{i=1}^{k} f(t_i \\mid \\lambda) \\right) \\times \\left( S(t_c \\mid \\lambda) \\right)^m$$\n将给定的 PDF 和生存函数的表达式代入：\n$$L(\\lambda \\mid \\text{data}) = \\left( \\prod_{i=1}^{5} \\lambda \\exp(-\\lambda t_i) \\right) \\times \\left( \\exp(-\\lambda t_c) \\right)^3$$\n这可以简化为：\n$$L(\\lambda \\mid \\text{data}) = \\lambda^5 \\left( \\prod_{i=1}^{5} \\exp(-\\lambda t_i) \\right) \\times \\exp(-3 \\lambda t_c)$$\n$$L(\\lambda \\mid \\text{data}) = \\lambda^5 \\exp\\left(-\\lambda \\sum_{i=1}^{5} t_i\\right) \\exp(-3 \\lambda t_c)$$\n$$L(\\lambda \\mid \\text{data}) = \\lambda^5 \\exp\\left(-\\lambda \\left( \\sum_{i=1}^{5} t_i + 3 t_c \\right) \\right)$$\n我们来计算观察到的总时间。失效时间的总和是：\n$$\\sum_{i=1}^{5} t_i = 120 + 350 + 600 + 700 + 760 = 2530 \\text{ 小时}$$\n删失观测值贡献的总时间是：\n$$3 t_c = 3 \\times 800 = 2400 \\text{ 小时}$$\n令 $T_{\\text{total}} = \\sum_{i=1}^{5} t_i + 3 t_c = 2530 + 2400 = 4930$ 小时。\n现在，似然函数可以写成：\n$$L(\\lambda \\mid \\text{data}) = \\lambda^5 \\exp(-4930 \\lambda)$$\n\n接下来，我们定义 $\\lambda$ 的先验分布。问题指定了一个伽马先验 $p(\\lambda \\mid \\alpha, \\beta)$，其形状参数为 $\\alpha=2$，率参数为 $\\beta=500$ 小时。先验的概率密度正比于：\n$$p(\\lambda) \\propto \\lambda^{\\alpha - 1} \\exp(-\\beta \\lambda) = \\lambda^{2-1} \\exp(-500 \\lambda) = \\lambda^{1} \\exp(-500 \\lambda)$$\n\n根据贝叶斯定理，$\\lambda$ 的后验分布 $p(\\lambda \\mid \\text{data})$ 正比于似然函数与先验分布的乘积：\n$$p(\\lambda \\mid \\text{data}) \\propto L(\\lambda \\mid \\text{data}) \\times p(\\lambda)$$\n$$p(\\lambda \\mid \\text{data}) \\propto \\left( \\lambda^5 \\exp(-4930 \\lambda) \\right) \\times \\left( \\lambda^{1} \\exp(-500 \\lambda) \\right)$$\n合并各项：\n$$p(\\lambda \\mid \\text{data}) \\propto \\lambda^{5+1} \\exp(-(4930+500)\\lambda)$$\n$$p(\\lambda \\mid \\text{data}) \\propto \\lambda^6 \\exp(-5430 \\lambda)$$\n这是伽马分布的核。后验分布是一个伽马分布，$p(\\lambda \\mid \\text{data}) \\sim \\text{Gamma}(\\alpha', \\beta')$，其密度正比于 $\\lambda^{\\alpha' - 1} \\exp(-\\beta' \\lambda)$。\n\n通过将推导出的后验形式与通用的伽马核进行比较，我们可以确定后验参数 $\\alpha'$ 和 $\\beta'$：\n$$\\alpha' - 1 = 6 \\implies \\alpha' = 7$$\n$$\\beta' = 5430 \\text{ 小时}$$\n因此，后验分布是 $\\text{Gamma}(7, 5430)$。这是符合预期的，因为伽马分布是指数分布率参数的共轭先验。\n\n$\\lambda$ 的 MAP 估计，记作 $\\lambda_{\\text{MAP}}$，是后验分布的众数。对于 $\\alpha'  1$ 的伽马分布 $\\text{Gamma}(\\alpha', \\beta')$，其众数由以下公式给出：\n$$\\text{Mode} = \\frac{\\alpha' - 1}{\\beta'}$$\n在我们的例子中，$\\alpha' = 7$，满足条件 $\\alpha'  1$。因此，MAP 估计为：\n$$\\lambda_{\\text{MAP}} = \\frac{7 - 1}{5430} = \\frac{6}{5430}$$\n现在，我们计算其数值：\n$$\\lambda_{\\text{MAP}} = \\frac{6}{5430} \\approx 0.001104972375... \\text{ h}^{-1}$$\n问题要求答案四舍五入到四位有效数字。\n$$\\lambda_{\\text{MAP}} \\approx 0.001105 \\text{ h}^{-1}$$\n\n风险率参数 $\\lambda$ 的 MAP 估计为 $0.001105$ $\\mathrm{h}^{-1}$。",
            "answer": "$$\\boxed{0.001105}$$"
        },
        {
            "introduction": "最强大的模型是那些能够融合物理知识的模型。本练习将展示如何通过重参数化，将一条基本的物理定律——锂守恒定律——直接构建到模型结构中。这种方法不仅能确保模型的预测在物理上是一致的，还能得到更鲁棒和更具可解释性的参数估计，从而将模型从纯粹的曲线拟合提升为基于物理的建模。",
            "id": "3895852",
            "problem": "考虑一个自动化电池设计与仿真任务，其中主要的降解路径是固体电解质界面（SEI）的生长。令时间索引 $i$ 时的可循环锂库存为 $L_{i}$（单位：摩尔），SEI厚度为 $s_{i}$（单位：米），总锂库存为 $L_{0}$（单位：摩尔）。假设在整个操作过程中锂是守恒的，因此对于每个 $i$，\n$$\nL_{i} + \\alpha s_{i} = L_{0},\n$$\n其中 $\\alpha$（单位：摩尔/米）是一个已知的化学计量转换因子，它将SEI厚度与捕获在SEI中的锂的摩尔数联系起来。时间索引 $i$ 时的可观测量是测得的不可逆容量损失 $y_{i}$（单位：库仑），其模型为\n$$\ny_{i} = \\beta \\left(L_{0} - L_{i}\\right) + \\varepsilon_{i},\n$$\n其中 $\\beta$（单位：库仑/摩尔）是一个已知的比例常数，而 $\\varepsilon_{i} \\sim \\mathcal{N}\\!\\left(0,\\sigma^{2}\\right)$ 是具有已知方差 $\\sigma^{2}$ 的独立同分布的高斯测量误差。SEI厚度遵循常用的扩散限制生长现象学，\n$$\ns_{i} = s_{0} + k \\sqrt{t_{i}},\n$$\n其中 $t_{i}$（单位：秒）是时间，$s_{0}$（单位：米）是初始SEI厚度，$k$（单位：米/平方根秒）是SEI生长速率参数。对未知数设置独立的高斯先验，\n$$\nk \\sim \\mathcal{N}\\!\\left(\\mu_{k},\\sigma_{k}^{2}\\right), \\quad s_{0} \\sim \\mathcal{N}\\!\\left(\\mu_{s},\\sigma_{s}^{2}\\right),\n$$\n其中超参数 $\\mu_{k}$、$\\sigma_{k}^{2}$、$\\mu_{s}$ 和 $\\sigma_{s}^{2}$ 是已知的。\n\n使用锂守恒作为硬约束，通过一个连接 $L_{i}$ 和 $s_{i}$ 的状态变量重参数化来编码该约束，并通过此重参数化推导参数的受约束贝叶斯后验。然后，从守恒的第一性原理和贝叶斯法则出发，根据数据 $\\{(t_{i},y_{i})\\}_{i=1}^{n}$ 和已知常数 $\\alpha$、$\\beta$、$\\sigma^{2}$、$\\mu_{k}$、$\\sigma_{k}^{2}$、$\\mu_{s}$ 和 $\\sigma_{s}^{2}$，推导 $k$ 的后验均值的闭式解析表达式。您的最终答案必须是 $k$ 的后验均值的单个闭式表达式，并且必须纯粹以符号形式表示，不进行数值计算。在您的最终表达式中不要包含物理单位。",
            "solution": "此问题需要进行验证。\n\n**步骤1：提取已知条件**\n- 状态变量：$L_{i}$（可循环锂库存，摩尔），$s_{i}$（SEI厚度，米），$L_{0}$（总锂库存，摩尔）。\n- 时间数据：$t_{i}$（秒），$i=1, \\dots, n$。\n- 观测数据：$y_{i}$（不可逆容量损失，库仑），$i=1, \\dots, n$。\n- 未知参数：$k$（SEI生长速率，m/s$^{1/2}$），$s_{0}$（初始SEI厚度，米）。\n- 已知常数：$\\alpha$（摩尔/米），$\\beta$（库仑/摩尔），$\\sigma^{2}$（测量误差方差）。\n- 已知超参数：$\\mu_{k}$、$\\sigma_{k}^{2}$、$\\mu_{s}$、$\\sigma_{s}^{2}$。\n- 锂守恒约束：$L_{i} + \\alpha s_{i} = L_{0}$。\n- 观测模型：$y_{i} = \\beta (L_{0} - L_{i}) + \\varepsilon_{i}$，其中 $\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma^{2})$ 独立同分布。\n- SEI生长模型：$s_{i} = s_{0} + k \\sqrt{t_{i}}$。\n- 先验分布：$k \\sim \\mathcal{N}(\\mu_{k}, \\sigma_{k}^{2})$ 和 $s_{0} \\sim \\mathcal{N}(\\mu_{s}, \\sigma_{s}^{2})$，其中 $k$ 和 $s_0$ 相互独立。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，借鉴了电化学的既定原理（物质守恒、扩散限制SEI生长等现象学降解模型）和标准统计方法（贝叶斯推断）。该问题是适定的，因为线性模型与高斯先验和高斯噪声的结合会产生具有唯一解析解的后验分布。语言客观，所有变量和常数都定义清晰。该问题是自洽的，没有内部矛盾。它不违反任何无效标准。\n\n**步骤3：结论与行动**\n该问题被判定为**有效**。将推导完整解。\n\n**$k$的后验均值推导**\n\n推导过程首先使用指定的重参数化构建似然函数，然后应用贝叶斯法则和给定的先验来找到参数的后验分布。该问题是贝叶斯线性回归的标准案例。\n\n1.  **模型重参数化**\n    锂守恒以硬约束形式给出：$L_{i} + \\alpha s_{i} = L_{0}$。这可以重新排列以表示可循环锂的损失为 $L_{0} - L_{i} = \\alpha s_{i}$。\n    将此代入 $y_i$ 的观测模型：\n    $$\n    y_{i} = \\beta (\\alpha s_{i}) + \\varepsilon_{i} = \\alpha \\beta s_{i} + \\varepsilon_{i}\n    $$\n    接下来，我们将SEI生长模型 $s_{i} = s_{0} + k \\sqrt{t_{i}}$ 代入 $y_i$ 的方程：\n    $$\n    y_{i} = \\alpha \\beta (s_{0} + k \\sqrt{t_{i}}) + \\varepsilon_{i}\n    $$\n    该方程将可观测量 $y_i$ 与未知参数 $s_0$ 和 $k$ 联系起来。由于 $\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma^{2})$，给定参数时单个观测 $y_i$ 的似然为：\n    $$\n    y_{i} | s_0, k \\sim \\mathcal{N}\\left(\\alpha \\beta (s_{0} + k \\sqrt{t_{i}}), \\sigma^{2}\\right)\n    $$\n\n2.  **贝叶斯线性回归公式**\n    该模型可以表示为线性回归。令参数向量为 $\\theta = \\begin{pmatrix} s_0 \\\\ k \\end{pmatrix}$。第 $i$ 个观测的模型可以写成：\n    $$\n    y_i = \\begin{pmatrix} \\alpha\\beta  \\alpha\\beta\\sqrt{t_i} \\end{pmatrix} \\begin{pmatrix} s_0 \\\\ k \\end{pmatrix} + \\varepsilon_i\n    $$\n    对于包含 $n$ 个观测的完整数据集，我们可以将其写成矩阵形式 $Y = X\\theta + \\epsilon$，其中：\n    -   $Y = \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_n \\end{pmatrix}$ 是观测向量。\n    -   $X = \\begin{pmatrix} \\alpha\\beta  \\alpha\\beta\\sqrt{t_1} \\\\ \\vdots  \\vdots \\\\ \\alpha\\beta  \\alpha\\beta\\sqrt{t_n} \\end{pmatrix} = \\alpha\\beta \\begin{pmatrix} 1  \\sqrt{t_1} \\\\ \\vdots  \\vdots \\\\ 1  \\sqrt{t_n} \\end{pmatrix}$ 是设计矩阵。\n    -   $\\epsilon = \\begin{pmatrix} \\varepsilon_1 \\\\ \\vdots \\\\ \\varepsilon_n \\end{pmatrix}$ 是误差向量，其中 $\\epsilon \\sim \\mathcal{N}(0, \\sigma^2 I_n)$，$I_n$ 是 $n \\times n$ 单位矩阵。\n\n3.  **先验和后验分布**\n    $s_0$ 和 $k$ 上的独立高斯先验可以写成 $\\theta$ 上的多元高斯先验：\n    $$\n    \\theta \\sim \\mathcal{N}(\\mu_{\\theta}, \\Sigma_{\\theta})\n    $$\n    其中先验均值向量是 $\\mu_{\\theta} = \\begin{pmatrix} \\mu_s \\\\ \\mu_k \\end{pmatrix}$，先验协方差矩阵是 $\\Sigma_{\\theta} = \\begin{pmatrix} \\sigma_s^2  0 \\\\ 0  \\sigma_k^2 \\end{pmatrix}$。\n\n    给定 $\\theta$ 时数据 $Y$ 的似然为 $p(Y|\\theta) \\propto \\exp\\left(-\\frac{1}{2\\sigma^2}(Y-X\\theta)^T(Y-X\\theta)\\right)$。先验为 $p(\\theta) \\propto \\exp\\left(-\\frac{1}{2}(\\theta-\\mu_{\\theta})^T\\Sigma_{\\theta}^{-1}(\\theta-\\mu_{\\theta})\\right)$。\n    由于高斯先验和高斯似然的共轭性，后验分布 $p(\\theta|Y)$ 也是一个多元高斯分布，$p(\\theta|Y) \\sim \\mathcal{N}(\\mu_{\\text{post}}, \\Sigma_{\\text{post}})$。后验均值和协方差由以下公式给出：\n    $$\n    \\Sigma_{\\text{post}}^{-1} = \\Sigma_{\\theta}^{-1} + \\frac{1}{\\sigma^2} X^T X\n    $$\n    $$\n    \\mu_{\\text{post}} = \\Sigma_{\\text{post}} \\left( \\Sigma_{\\theta}^{-1} \\mu_{\\theta} + \\frac{1}{\\sigma^2} X^T Y \\right)\n    $$\n    我们的目标是找到 $\\mu_{\\text{post}}$ 的第二个分量，即 $k$ 的后验均值。\n\n4.  **矩阵和向量分量的计算**\n    首先，我们计算所需的分量：\n    -   先验精度矩阵：$\\Sigma_{\\theta}^{-1} = \\begin{pmatrix} 1/\\sigma_s^2  0 \\\\ 0  1/\\sigma_k^2 \\end{pmatrix}$。\n    -   $X^T X = (\\alpha\\beta)^2 \\begin{pmatrix} 1  \\dots  1 \\\\ \\sqrt{t_1}  \\dots  \\sqrt{t_n} \\end{pmatrix} \\begin{pmatrix} 1  \\sqrt{t_1} \\\\ \\vdots  \\vdots \\\\ 1  \\sqrt{t_n} \\end{pmatrix} = (\\alpha\\beta)^2 \\begin{pmatrix} n  \\sum_{i=1}^n \\sqrt{t_i} \\\\ \\sum_{i=1}^n \\sqrt{t_i}  \\sum_{i=1}^n t_i \\end{pmatrix}$。\n    -   $X^T Y = \\alpha\\beta \\begin{pmatrix} 1  \\dots  1 \\\\ \\sqrt{t_1}  \\dots  \\sqrt{t_n} \\end{pmatrix} \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_n \\end{pmatrix} = \\alpha\\beta \\begin{pmatrix} \\sum_{i=1}^n y_i \\\\ \\sum_{i=1}^n y_i\\sqrt{t_i} \\end{pmatrix}$。\n    -   $\\Sigma_{\\theta}^{-1} \\mu_{\\theta} = \\begin{pmatrix} \\mu_s / \\sigma_s^2 \\\\ \\mu_k / \\sigma_k^2 \\end{pmatrix}$。\n\n5.  **后验均值的推导**\n    后验精度矩阵 $\\Sigma_{\\text{post}}^{-1}$ 是一个 $2 \\times 2$ 矩阵：\n    $$\n    \\Sigma_{\\text{post}}^{-1} = \\begin{pmatrix} \\frac{1}{\\sigma_s^2}  0 \\\\ 0  \\frac{1}{\\sigma_k^2} \\end{pmatrix} + \\frac{(\\alpha\\beta)^2}{\\sigma^2} \\begin{pmatrix} n  \\sum_{i=1}^n \\sqrt{t_i} \\\\ \\sum_{i=1}^n \\sqrt{t_i}  \\sum_{i=1}^n t_i \\end{pmatrix} = \\begin{pmatrix} A  C \\\\ C  B \\end{pmatrix}\n    $$\n    其中\n    $A = \\frac{1}{\\sigma_s^2} + \\frac{n(\\alpha\\beta)^2}{\\sigma^2}$\n    $B = \\frac{1}{\\sigma_k^2} + \\frac{(\\alpha\\beta)^2}{\\sigma^2} \\sum_{i=1}^n t_i$\n    $C = \\frac{(\\alpha\\beta)^2}{\\sigma^2} \\sum_{i=1}^n \\sqrt{t_i}$\n\n    后验协方差是该矩阵的逆：\n    $$\n    \\Sigma_{\\text{post}} = (\\Sigma_{\\text{post}}^{-1})^{-1} = \\frac{1}{AB-C^2} \\begin{pmatrix} B  -C \\\\ -C  A \\end{pmatrix}\n    $$\n    后验均值表达式中括号内的项是：\n    $$\n    V = \\Sigma_{\\theta}^{-1} \\mu_{\\theta} + \\frac{1}{\\sigma^2} X^T Y = \\begin{pmatrix} \\frac{\\mu_s}{\\sigma_s^2} + \\frac{\\alpha\\beta}{\\sigma^2} \\sum_{i=1}^n y_i \\\\ \\frac{\\mu_k}{\\sigma_k^2} + \\frac{\\alpha\\beta}{\\sigma^2} \\sum_{i=1}^n y_i\\sqrt{t_i} \\end{pmatrix} = \\begin{pmatrix} V_s \\\\ V_k \\end{pmatrix}\n    $$\n    后验均值向量为 $\\mu_{\\text{post}} = \\Sigma_{\\text{post}} V$：\n    $$\n    \\mu_{\\text{post}} = \\frac{1}{AB-C^2} \\begin{pmatrix} B V_s - C V_k \\\\ -C V_s + A V_k \\end{pmatrix}\n    $$\n    我们寻求第二个分量，$E[k|\\text{data}] = (\\mu_{\\text{post}})_2$：\n    $$\n    E[k|\\text{data}] = \\frac{A V_k - C V_s}{AB-C^2}\n    $$\n    将分子中的 $A, C, V_k, V_s$ 和分母中的 $A, B, C$ 的表达式代入：\n    分子：\n    $$\n    N = \\left(\\frac{1}{\\sigma_s^2} + \\frac{n(\\alpha\\beta)^2}{\\sigma^2}\\right)\\left(\\frac{\\mu_k}{\\sigma_k^2} + \\frac{\\alpha\\beta}{\\sigma^2}\\sum_{i=1}^n y_i\\sqrt{t_i}\\right) - \\left(\\frac{(\\alpha\\beta)^2}{\\sigma^2}\\sum_{i=1}^n\\sqrt{t_i}\\right)\\left(\\frac{\\mu_s}{\\sigma_s^2} + \\frac{\\alpha\\beta}{\\sigma^2}\\sum_{i=1}^n y_i\\right)\n    $$\n    分母：\n    $$\n    D = \\left(\\frac{1}{\\sigma_s^2} + \\frac{n(\\alpha\\beta)^2}{\\sigma^2}\\right)\\left(\\frac{1}{\\sigma_k^2} + \\frac{(\\alpha\\beta)^2}{\\sigma^2}\\sum_{i=1}^n t_i\\right) - \\left(\\frac{(\\alpha\\beta)^2}{\\sigma^2}\\sum_{i=1}^n\\sqrt{t_i}\\right)^2\n    $$\n    最终答案是比率 $N/D$。这就是所要求的闭式表达式。",
            "answer": "$$\n\\boxed{\n\\frac{\n\\left(\\frac{1}{\\sigma_{s}^{2}} + \\frac{n \\alpha^{2} \\beta^{2}}{\\sigma^{2}}\\right) \\left(\\frac{\\mu_{k}}{\\sigma_{k}^{2}} + \\frac{\\alpha \\beta}{\\sigma^{2}} \\sum_{i=1}^{n} y_{i} \\sqrt{t_{i}}\\right) - \\left(\\frac{\\alpha^{2} \\beta^{2}}{\\sigma^{2}} \\sum_{i=1}^{n} \\sqrt{t_{i}}\\right) \\left(\\frac{\\mu_{s}}{\\sigma_{s}^{2}} + \\frac{\\alpha \\beta}{\\sigma^{2}} \\sum_{i=1}^{n} y_{i}\\right)\n}{\n\\left(\\frac{1}{\\sigma_{s}^{2}} + \\frac{n \\alpha^{2} \\beta^{2}}{\\sigma^{2}}\\right) \\left(\\frac{1}{\\sigma_{k}^{2}} + \\frac{\\alpha^{2} \\beta^{2}}{\\sigma^{2}} \\sum_{i=1}^{n} t_{i}\\right) - \\left(\\frac{\\alpha^{2} \\beta^{2}}{\\sigma^{2}} \\sum_{i=1}^{n} \\sqrt{t_{i}}\\right)^{2}\n}\n}\n$$"
        }
    ]
}