{
    "hands_on_practices": [
        {
            "introduction": "卡尔曼滤波器是线性系统状态估计的基石。为了真正掌握其工作原理，亲手完成一个完整的预测-校正周期至关重要。本练习  将引导您对一个典型的电池模型执行单步卡尔曼滤波计算，从预测状态到更新协方差，从而具体地理解滤波器如何融合测量信息来修正其对系统状态的估计。",
            "id": "3922746",
            "problem": "考虑一个锂离子电池，在恒流采样区间内，其可由一个一阶电阻-电容 (1-RC) 戴维南等效电路近似。其内部RC极化电压和荷电状态 (SoC) 通过一个线性高斯状态空间系统在离散时间内建模。设状态为 $x_{k} = \\begin{pmatrix} v_{\\mathrm{rc},k} \\\\ z_{k} \\end{pmatrix}$，其中 $v_{\\mathrm{rc},k}$ 是RC支路电压，$z_{k}$ 是SoC（表示为0到1之间的小数）。电流输入为 $u_{k}$（放电为正），测量的端电压为 $y_{k}$。离散时间动态和测量由以下公式给出\n$$\nx_{k+1} = A_{d}\\,x_{k} + B_{d}\\,u_{k} + w_{k}, \\quad w_{k} \\sim \\mathcal{N}(0, Q_{d}),\n$$\n$$\ny_{k} = V_{0} + C_{d}\\,x_{k} + D_{d}\\,u_{k} + \\eta_{k}, \\quad \\eta_{k} \\sim \\mathcal{N}(0, R),\n$$\n其中矩阵和标量已知\n$$\nA_{d} = \\begin{pmatrix} 0.951229  0 \\\\ 0  1 \\end{pmatrix}, \\quad B_{d} = \\begin{pmatrix} -0.0004877 \\\\ -5.5556 \\times 10^{-5} \\end{pmatrix}, \\quad C_{d} = \\begin{pmatrix} -1  0.2 \\end{pmatrix}, \\quad D_{d} = -0.02,\n$$\n$$\nQ_{d} = \\begin{pmatrix} 1.0 \\times 10^{-5}  0 \\\\ 0  1.0 \\times 10^{-6} \\end{pmatrix}, \\quad R = 1.0 \\times 10^{-4}, \\quad V_{0} = 3.7.\n$$\n假设在时间 $k=0$ 时的先验状态估计和协方差为\n$$\nx_{0|0} = \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix}, \\quad P_{0|0} = \\begin{pmatrix} 2.0 \\times 10^{-3}  0 \\\\ 0  4.0 \\times 10^{-4} \\end{pmatrix}.\n$$\n给定以下电流输入和测量端电压序列：\n$$\nu_{1} = 2.0, \\quad y_{1} = 3.760; \\quad u_{2} = 1.5, \\quad y_{2} = 3.770; \\quad u_{3} = 0.0, \\quad y_{3} = 3.780.\n$$\n从离散时间线性高斯状态空间模型和最小方差线性估计器的基本定义出发，使用数据对 $(u_{1}, y_{1})$ 在 $k=1$ 时执行一次完整的卡尔曼滤波器 (KF) 迭代，计算：\n- 预测状态 $x_{1|0}$，\n- 新息 $v_{1}$，\n- 新息协方差 $S_{1}$，\n- 卡尔曼增益 $K_{1}$，\n- 更新状态 $x_{1|1}$，\n- 以及更新协方差 $P_{1|1}$（协方差更新使用 Joseph 稳定形式）。\n\n报告电压单位为 $\\mathrm{V}$，SoC为无单位分数，协方差使用适当的平方单位；新息及其协方差与电压通道有关。将最终数值四舍五入到四位有效数字。将最终答案表示为包含以下各项的单行矩阵（按顺序）：\n$$\n\\big( v_{\\mathrm{rc},1|0}, \\, z_{1|0}, \\, v_{1}, \\, S_{1}, \\, K_{1}^{(1)}, \\, K_{1}^{(2)}, \\, v_{\\mathrm{rc},1|1}, \\, z_{1|1}, \\, P_{1|1}^{(1,1)}, \\, P_{1|1}^{(1,2)}, \\, P_{1|1}^{(2,1)}, \\, P_{1|1}^{(2,2)} \\big).\n$$\n最终答案的方框内不要包含单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它具有科学依据，问题提法得当，客观，并包含执行一次离散时间卡尔曼滤波器迭代所需的所有信息。该模型是电池电气行为的标准线性高斯状态空间表示，所要求的任务是一个成熟算法的直接应用。\n\n卡尔曼滤波器是一种递归算法，它为线性高斯系统提供最优（在最小均方误差意义上）的状态估计。它以一个两步循环的方式运行：预测（或时间更新）步骤和校正（或测量更新）步骤。\n\n设在时间步 $k-1$ 的状态估计为 $x_{k-1|k-1}$，其相关的误差协方差为 $P_{k-1|k-1}$。系统由以下公式描述：\n$$x_{k} = A_{d}\\,x_{k-1} + B_{d}\\,u_{k-1} + w_{k-1}, \\quad w_{k-1} \\sim \\mathcal{N}(0, Q_{d})$$\n$$y_{k} = H_{d}\\,x_{k} + E_{d}\\,u_{k} + v_{k}, \\quad v_{k} \\sim \\mathcal{N}(0, R)$$\n对于此问题，测量方程给出为 $y_{k} = V_{0} + C_{d}\\,x_{k} + D_{d}\\,u_{k} + \\eta_{k}$。为了使其与标准形式对齐，我们可以定义一个修正的测量值 $y'_{k} = y_{k} - V_{0} - D_{d}u_{k}$。测量方程则变为 $y'_{k} = C_{d}x_{k} + \\eta_{k}$。新息将根据原始形式计算。\n\n在时间 $k=0$ 时的初始条件已提供：\n$$x_{0|0} = \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix}, \\quad P_{0|0} = \\begin{pmatrix} 2.0 \\times 10^{-3}  0 \\\\ 0  4.0 \\times 10^{-4} \\end{pmatrix}$$\n任务是使用输入 $u_{1} = 2.0$ 和测量值 $y_{1} = 3.760$ 对 $k=1$ 执行一次完整的迭代。\n\n**步骤1：预测（时间更新）**\n\n预测步骤在融合 $k=1$ 时的测量值之前，将状态和协方差从 $k=0$ 投影到 $k=1$。\n\n预测状态均值 $x_{1|0}$ 计算如下：\n$$x_{1|0} = A_{d}\\,x_{0|0} + B_{d}\\,u_{1}$$\n$$x_{1|0} = \\begin{pmatrix} 0.951229  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0.050 \\\\ 0.800 \\end{pmatrix} + \\begin{pmatrix} -0.0004877 \\\\ -5.5556 \\times 10^{-5} \\end{pmatrix} (2.0)$$\n$$x_{1|0} = \\begin{pmatrix} 0.04756145 \\\\ 0.800 \\end{pmatrix} + \\begin{pmatrix} -0.0009754 \\\\ -0.000111112 \\end{pmatrix} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix}$$\n因此，$v_{\\mathrm{rc},1|0} \\approx 0.046586$ 且 $z_{1|0} \\approx 0.79989$。\n\n预测误差协方差 $P_{1|0}$ 计算如下：\n$$P_{1|0} = A_{d}\\,P_{0|0}\\,A_{d}^T + Q_{d}$$\n$$P_{1|0} = \\begin{pmatrix} 0.951229  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0.002  0 \\\\ 0  0.0004 \\end{pmatrix} \\begin{pmatrix} 0.951229  0 \\\\ 0  1 \\end{pmatrix}^T + \\begin{pmatrix} 1.0 \\times 10^{-5}  0 \\\\ 0  1.0 \\times 10^{-6} \\end{pmatrix}$$\n$$P_{1|0} = \\begin{pmatrix} (0.951229)^2(0.002)  0 \\\\ 0  (1)^2(0.0004) \\end{pmatrix} + \\begin{pmatrix} 0.00001  0 \\\\ 0  0.000001 \\end{pmatrix}$$\n$$P_{1|0} = \\begin{pmatrix} 0.00180967  0 \\\\ 0  0.0004 \\end{pmatrix} + \\begin{pmatrix} 0.00001  0 \\\\ 0  0.000001 \\end{pmatrix} = \\begin{pmatrix} 0.00181967  0 \\\\ 0  0.000401 \\end{pmatrix}$$\n\n**步骤2：校正（测量更新）**\n\n校正步骤使用测量值 $y_{1}$ 来修正预测的状态和协方差。\n\n新息，或称测量残差，$v_{1}$ 是实际测量值与预测测量值之间的差值：\n$$v_{1} = y_{1} - \\hat{y}_{1|0} = y_{1} - (V_{0} + C_{d}\\,x_{1|0} + D_{d}\\,u_{1})$$\n$$v_{1} = 3.760 - \\left( 3.7 + \\begin{pmatrix} -1  0.2 \\end{pmatrix} \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + (-0.02)(2.0) \\right)$$\n$$v_{1} = 3.760 - (3.7 - 0.04658605 + 0.15997778 - 0.04) = 3.760 - 3.77339173 = -0.01339173$$\n\n新息协方差 $S_{1}$ 计算如下：\n$$S_{1} = C_{d}\\,P_{1|0}\\,C_{d}^T + R$$\n$$S_{1} = \\begin{pmatrix} -1  0.2 \\end{pmatrix} \\begin{pmatrix} 0.00181967  0 \\\\ 0  0.000401 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 0.2 \\end{pmatrix} + 1.0 \\times 10^{-4}$$\n$$S_{1} = ((-1)^2(0.00181967) + (0.2)^2(0.000401)) + 0.0001$$\n$$S_{1} = (0.00181967 + 0.00001604) + 0.0001 = 0.00183571 + 0.0001 = 0.00193571$$\n\n最优卡尔曼增益 $K_{1}$ 为：\n$$K_{1} = P_{1|0}\\,C_{d}^T\\,S_{1}^{-1}$$\n$$P_{1|0}\\,C_{d}^T = \\begin{pmatrix} 0.00181967  0 \\\\ 0  0.000401 \\end{pmatrix} \\begin{pmatrix} -1 \\\\ 0.2 \\end{pmatrix} = \\begin{pmatrix} -0.00181967 \\\\ 0.0000802 \\end{pmatrix}$$\n$$K_{1} = \\begin{pmatrix} -0.00181967 \\\\ 0.0000802 \\end{pmatrix} (0.00193571)^{-1} = \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix}$$\n因此，$K_{1}^{(1)} \\approx -0.94005$ 且 $K_{1}^{(2)} \\approx 0.041432$。\n\n更新后的状态估计 $x_{1|1}$ 为：\n$$x_{1|1} = x_{1|0} + K_{1}\\,v_{1}$$\n$$x_{1|1} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix} (-0.01339173)$$\n$$x_{1|1} = \\begin{pmatrix} 0.04658605 \\\\ 0.79988889 \\end{pmatrix} + \\begin{pmatrix} 0.0125889 \\\\ -0.0005548 \\end{pmatrix} = \\begin{pmatrix} 0.059175 \\\\ 0.799334 \\end{pmatrix}$$\n因此，$v_{\\mathrm{rc},1|1} \\approx 0.059175$ 且 $z_{1|1} \\approx 0.79933$。\n\n更新后的误差协方差 $P_{1|1}$ 按要求使用 Joseph 稳定形式计算，该形式保证了对称性和正半定性：\n$$P_{1|1} = (I - K_{1}\\,C_{d})\\,P_{1|0}\\,(I - K_{1}\\,C_{d})^T + K_{1}\\,R\\,K_{1}^T$$\n第一项计算：\n$$I - K_{1}\\,C_{d} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix}\\begin{pmatrix} -1  0.2 \\end{pmatrix} = \\begin{pmatrix} 1-0.940053  0.1880106 \\\\ 0.0414320  1-0.0082864 \\end{pmatrix} = \\begin{pmatrix} 0.059947  0.1880106 \\\\ 0.0414320  0.9917136 \\end{pmatrix}$$\n设 $M = I-K_1 C_d$。第一项是 $M P_{1|0} M^T$：\n$$ M P_{1|0} M^T \\approx \\begin{pmatrix} 2.0713 \\times 10^{-5}  7.9287 \\times 10^{-5} \\\\ 7.9287 \\times 10^{-5}  3.9751 \\times 10^{-4} \\end{pmatrix}$$\n第二项计算，$K_{1}\\,R\\,K_{1}^T$：\n$$K_{1}\\,R\\,K_{1}^T = \\begin{pmatrix} -0.940053 \\\\ 0.0414320 \\end{pmatrix} (1.0 \\times 10^{-4}) \\begin{pmatrix} -0.940053  0.0414320 \\end{pmatrix}$$\n$$K_{1}\\,R\\,K_{1}^T \\approx \\begin{pmatrix} 8.8370 \\times 10^{-5}  -3.8943 \\times 10^{-6} \\\\ -3.8943 \\times 10^{-6}  1.7166 \\times 10^{-7} \\end{pmatrix}$$\n将两项相加：\n$$P_{1|1} = \\begin{pmatrix} 2.0713 \\times 10^{-5} + 8.8370 \\times 10^{-5}  7.9287 \\times 10^{-5} - 3.8943 \\times 10^{-6} \\\\ 7.9287 \\times 10^{-5} - 3.8943 \\times 10^{-6}  3.9751 \\times 10^{-4} + 1.7166 \\times 10^{-7} \\end{pmatrix}$$\n$$P_{1|1} = \\begin{pmatrix} 1.09083 \\times 10^{-4}  7.5393 \\times 10^{-5} \\\\ 7.5393 \\times 10^{-5}  3.9768 \\times 10^{-4} \\end{pmatrix}$$\n\n将最终结果四舍五入到四位有效数字：\n$v_{\\mathrm{rc},1|0} \\approx 0.04659$\n$z_{1|0} \\approx 0.7999$\n$v_{1} \\approx -0.01339$\n$S_{1} \\approx 0.001936$\n$K_{1}^{(1)} \\approx -0.9401$\n$K_{1}^{(2)} \\approx 0.04143$\n$v_{\\mathrm{rc},1|1} \\approx 0.05917$\n$z_{1|1} \\approx 0.7993$\n$P_{1|1}^{(1,1)} \\approx 1.091 \\times 10^{-4}$\n$P_{1|1}^{(1,2)} \\approx 7.539 \\times 10^{-5}$\n$P_{1|1}^{(2,1)} \\approx 7.539 \\times 10^{-5}$\n$P_{1|1}^{(2,2)} \\approx 3.977 \\times 10^{-4}$\n\n这些值被格式化为最终答案所需的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.04659  0.7999  -0.01339  0.001936  -0.9401  0.04143  0.05917  0.7993  0.0001091  0.00007539  0.00007539  0.0003977\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "对于非线性系统，粒子滤波器提供了一种强大的估计方法，其核心思想是用一组带权重的样本（粒子）来表示状态的概率分布。本练习  聚焦于粒子滤波器算法中最关键的环节：如何根据新的测量值更新粒子权重，以及如何使用有效样本量（ESS）这一指标来判断是否需要通过重采样来解决粒子退化问题。",
            "id": "3922794",
            "problem": "考虑一个用于自动化电池设计和仿真流程中锂离子电池的基于粒子的贝叶斯状态估计器。该估计器使用粒子滤波器（PF）来跟踪电池的内部状态，并应用一个非线性的端电压测量模型。假设在时间 $k$ 的电压测量值由 $y_{k} = h(x_{k}) + v_{k}$ 建模，其中 $h(\\cdot)$ 是电池状态 $x_{k}$ 的一个非线性函数，而 $v_{k}$ 是标准差为 $\\sigma_{v}$ 的零均值高斯测量噪声。在接收到 $y_{k}$ 之前，该粒子滤波器持有 $N=5$ 个传播后的粒子 $\\{x_{k}^{(i)}\\}_{i=1}^{5}$，它们的先验权重相等，为 $w_{k-1}^{(i)} = \\frac{1}{5}$，并且在模型 $h(\\cdot)$ 下，它们预测的端电压由下式给出\n$$\n\\hat{v}_{k}^{(1)} = 3.95,\\quad \\hat{v}_{k}^{(2)} = 3.90,\\quad \\hat{v}_{k}^{(3)} = 4.00,\\quad \\hat{v}_{k}^{(4)} = 3.96,\\quad \\hat{v}_{k}^{(5)} = 3.88,\n$$\n单位为伏特。假设新的测量值为 $y_{k} = 3.95$ 伏特，测量噪声的标准差为 $\\sigma_{v} = 0.01$ 伏特。重采样阈值设置为 $\\tau = 0.5 N$。\n\n从贝叶斯推断的基本原理和 $v_{k}$ 的高斯似然定义出发，执行测量更新，以获得归一化的后验重要性权重 $\\{w_{k}^{(i)}\\}_{i=1}^{5}$。然后，从有效样本量作为重要性采样中权重退化度量的核心定义出发，推导用于计算有效样本量的表达式，并根据给定数据对其进行数值计算。\n\n通过将有效样本量与阈值 $\\tau$ 进行比较，判断是否应触发重采样。将有效样本量四舍五入到四位有效数字。将最终答案表示为一个行矩阵，其中包含两个条目：四舍五入后的有效样本量和一个二元重采样决策指示符 $I$，如果触发重采样，则 $I = 1$，否则 $I = 0$。最终答案中无需包含物理单位。",
            "solution": "该问题要求进行两部分的计算：首先，基于新的测量值更新粒子权重；其次，计算有效样本量以决定是否进行重采样。\n\n### **第1部分：粒子权重的测量更新**\n\n粒子滤波器测量更新步骤的核心植根于贝叶斯推断。后验信念与先验信念乘以测量似然成正比。对于每个粒子，这可转化为更新其权重：\n$$\nw_{k}^{(i)} \\propto w_{k-1}^{(i)} \\cdot p(y_k | x_k^{(i)})\n$$\n在这里，$w_{k-1}^{(i)}$ 是先验权重（来自前一时间步或初始化），而 $p(y_k | x_k^{(i)})$ 是在给定粒子 $i$ 的状态 $x_k^{(i)}$ 的条件下，观测到测量值 $y_k$ 的似然。\n\n问题指出先验权重是均匀的：$w_{k-1}^{(i)} = \\frac{1}{N} = \\frac{1}{5}$。测量模型是 $y_{k} = h(x_{k}) + v_{k}$，其中 $v_{k} \\sim \\mathcal{N}(0, \\sigma_v^2)$。这意味着似然函数 $p(y_k | x_k^{(i)})$ 是一个均值为 $\\mu = h(x_k^{(i)})$、方差为 $\\sigma_v^2$ 的高斯分布的概率密度函数（PDF），在 $y_k$ 处取值。\n$$\np(y_k | x_k^{(i)}) = \\frac{1}{\\sqrt{2\\pi\\sigma_v^2}} \\exp\\left(-\\frac{(y_k - h(x_k^{(i)}))^2}{2\\sigma_v^2}\\right)\n$$\n预测的测量值由 $\\hat{v}_k^{(i)} = h(x_k^{(i)})$ 给出。由于所有粒子的先验权重都是常数，因此未归一化的后验权重 $\\tilde{w}_k^{(i)}$ 与似然成正比。常数项 $\\frac{1}{\\sqrt{2\\pi\\sigma_v^2}}$ 可以在归一化过程中被约去，因此可以省略。\n$$\n\\tilde{w}_k^{(i)} = \\exp\\left(-\\frac{(y_k - \\hat{v}_k^{(i)})^2}{2\\sigma_v^2}\\right)\n$$\n我们已知 $y_k = 3.95$ 和 $\\sigma_v = 0.01$，所以 $\\sigma_v^2 = (0.01)^2 = 0.0001$。我们首先为每个粒子 $i=1, \\dots, 5$ 计算残差平方 $(y_k - \\hat{v}_k^{(i)})^2$：\n*   $i=1$: $(3.95 - 3.95)^2 = 0^2 = 0$\n*   $i=2$: $(3.95 - 3.90)^2 = 0.05^2 = 0.0025$\n*   $i=3$: $(3.95 - 4.00)^2 = (-0.05)^2 = 0.0025$\n*   $i=4$: $(3.95 - 3.96)^2 = (-0.01)^2 = 0.0001$\n*   $i=5$: $(3.95 - 3.88)^2 = 0.07^2 = 0.0049$\n\n现在，我们使用指数项 $-\\frac{\\text{残差}^2}{2\\sigma_v^2} = -\\frac{\\text{残差}^2}{2(0.0001)} = -\\frac{\\text{残差}^2}{0.0002}$ 来计算未归一化的权重 $\\tilde{w}_k^{(i)}$。\n*   $\\tilde{w}_k^{(1)} = \\exp\\left(-\\frac{0}{0.0002}\\right) = \\exp(0) = 1$\n*   $\\tilde{w}_k^{(2)} = \\exp\\left(-\\frac{0.0025}{0.0002}\\right) = \\exp(-12.5)$\n*   $\\tilde{w}_k^{(3)} = \\exp\\left(-\\frac{0.0025}{0.0002}\\right) = \\exp(-12.5)$\n*   $\\tilde{w}_k^{(4)} = \\exp\\left(-\\frac{0.0001}{0.0002}\\right) = \\exp(-0.5)$\n*   $\\tilde{w}_k^{(5)} = \\exp\\left(-\\frac{0.0049}{0.0002}\\right) = \\exp(-24.5)$\n\n为了获得归一化的后验权重 $w_k^{(i)}$，我们将未归一化的权重求和，然后将每个未归一化的权重除以该总和：\n$$\nw_k^{(i)} = \\frac{\\tilde{w}_k^{(i)}}{\\sum_{j=1}^N \\tilde{w}_k^{(j)}}\n$$\n总和为 $S_w = \\sum_{j=1}^5 \\tilde{w}_k^{(j)} = 1 + 2\\exp(-12.5) + \\exp(-0.5) + \\exp(-24.5)$。\n\n### **第2部分：有效样本量和重采样决策**\n\n有效样本量 $N_{\\text{eff}}$ 量化了粒子权重的退化程度。一个完全健康的粒子集具有均匀的权重，即 $w^{(i)} = 1/N$，而一个完全退化的粒子集则有一个粒子的权重为 $w^{(j)}=1$，所有其他粒子的权重为 $0$。其核心思想是定义一个度量来捕捉这种退化。一个常用且有原则的选择是归一化权重的平方和，即 $\\sum (w^{(i)})^2$。\n\n对于一个包含 $M$ 个粒子的“理想”样本，其权重均匀分布，即 $w^{(i)} = 1/M$，其权重平方和为 $\\sum_{i=1}^M (1/M)^2 = M \\cdot (1/M^2) = 1/M$。我们通过将当前粒子集的权重平方和与一个大小为 $N_{\\text{eff}}$ 的理想集的权重平方和相等，来定义有效样本量 $N_{\\text{eff}}$：\n$$\n\\frac{1}{N_{\\text{eff}}} = \\sum_{i=1}^{N} (w_k^{(i)})^2\n$$\n这就得出了计算有效样本量的标准公式：\n$$\nN_{\\text{eff}} = \\frac{1}{\\sum_{i=1}^{N} (w_k^{(i)})^2}\n$$\n$N_{\\text{eff}}$ 的值范围从 $1$（完全退化）到 $N$（无退化，所有权重相等）。\n\n为了计算 $N_{\\text{eff}}$，我们首先计算权重的平方和。使用归一化的权重 $w_k^{(i)} = \\tilde{w}_k^{(i)}/S_w$：\n$$\n\\sum_{i=1}^N (w_k^{(i)})^2 = \\sum_{i=1}^N \\left(\\frac{\\tilde{w}_k^{(i)}}{S_w}\\right)^2 = \\frac{1}{S_w^2} \\sum_{i=1}^N (\\tilde{w}_k^{(i)})^2\n$$\n因此，$N_{\\text{eff}}$ 的表达式可以用未归一化的权重来写：\n$$\nN_{\\text{eff}} = \\frac{S_w^2}{\\sum_{i=1}^N (\\tilde{w}_k^{(i)})^2} = \\frac{\\left(\\sum_i \\tilde{w}_k^{(i)}\\right)^2}{\\sum_i (\\tilde{w}_k^{(i)})^2}\n$$\n我们来计算这两个和：\n$S_w = \\sum_{i=1}^5 \\tilde{w}_k^{(i)} = 1 + 2\\exp(-12.5) + \\exp(-0.5) + \\exp(-24.5)$\n$\\sum_{i=1}^5 (\\tilde{w}_k^{(i)})^2 = 1^2 + (\\exp(-12.5))^2 + (\\exp(-12.5))^2 + (\\exp(-0.5))^2 + (\\exp(-24.5))^2 = 1 + 2\\exp(-25) + \\exp(-1) + \\exp(-49)$\n\n使用数值计算：\n$S_w \\approx 1 + 2(3.720076 \\times 10^{-6}) + 0.60653066 + 1.68955 \\times 10^{-11} \\approx 1.60653810$\n$\\sum (\\tilde{w}_k^{(i)})^2 \\approx 1 + 2(1.3839 \\times 10^{-11}) + 0.36787944 + 2.8546 \\times 10^{-22} \\approx 1.36787944$\n$N_{\\text{eff}} = \\frac{(1.60653810)^2}{1.36787944} \\approx \\frac{2.5809653}{1.36787944} \\approx 1.886835$\n\n四舍五入到四位有效数字，我们得到 $N_{\\text{eff}} = 1.887$。\n\n最后，我们必须决定是否进行重采样。重采样阈值为 $\\tau = 0.5 N = 0.5 \\times 5 = 2.5$。如果 $N_{\\text{eff}}  \\tau$，则触发重采样。\n我们比较计算出的值：$1.887  2.5$。条件满足。\n因此，触发重采样，重采样指示符为 $I=1$。\n\n最终答案包括四舍五入后的有效样本量和重采样指示符。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.887  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "一个设计精良的滤波器也无法估计测量数据中不可见的状态。这种“可见性”在控制理论中被称为可观测性，是评估状态估计算法可靠性的前提。本练习  探讨了电池SOC估计中的一个经典难题——在开路电压（OCV）曲线平坦区域的可观测性问题，通过分析线性化系统的可观测性矩阵，您将学会一种诊断估计器何时可能失效的系统性方法。",
            "id": "3922787",
            "problem": "一个单体锂离子电池使用带有一个电阻-电容 (RC) 对的离散时间等效电路模型进行建模，以用于状态估计。状态向量为 $x_k = [\\, z_k \\;\\; v_k \\,]^{\\top}$，其中 $z_k$ 是荷电状态 (SOC)，$v_k$ 是 RC 过电势。已知输入为施加的电流 $u_k = I_k$（放电时为正）。采样周期为 $\\Delta t  0$。动力学和测量方程如下：\n$$\n\\begin{aligned}\nz_{k+1} = z_k - \\frac{\\Delta t}{Q} \\, I_k, \\\\\nv_{k+1} = a \\, v_k + b \\, I_k, \\\\\ny_k = V_{oc}(z_k) - v_k - R_0 I_k + \\nu_k,\n\\end{aligned}\n$$\n其中 $Q0$ 是容量，$R_00$ 是欧姆内阻，$a = \\exp\\!\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$（其中 $R_10$ 且 $C_10$），以及 $b = R_1 \\left(1-a\\right)$。输出使用开路电压 (OCV) 映射 $V_{oc}(z)$，$\\nu_k$ 是零均值测量噪声。这可以写成 $y_k = V_{oc}(z_k) + h(x_k) + \\nu_k$ 的形式，其中 $h(x_k) = -v_k - R_0 I_k$。考虑非线性系统在固定工作点 $(x^{\\star}, u^{\\star})$ 附近的局部弱可观测性，在该点 OCV 斜率 $\\gamma := \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$ 很小，即 OCV 曲线局部平坦。\n\n仅使用第一性原理（即通过一阶泰勒展开进行线性化，以及基于线性化可观测性矩阵的离散时间非线性系统局部弱可观测性的秩条件），执行以下操作：\n\n- 推导给定模型的状态雅可比矩阵 $A_k := \\left.\\frac{\\partial f}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})}$ 和测量雅可比矩阵 $C_k := \\left.\\frac{\\partial g}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})}$。\n- 构建在 $(x^{\\star}, u^{\\star})$ 处的局部 $2 \\times 2$ 可观测性矩阵 $\\mathcal{O}_k := \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$。\n- 计算行列式 $\\det(\\mathcal{O}_k)$ 的闭式解，并用 $\\gamma$、$\\Delta t$、$R_1$ 和 $C_1$ 表示。\n\n根据该行列式，阐述当 $\\gamma$ 接近零时（平坦的 OCV 区域），在 $(x^{\\star}, u^{\\star})$ 处的局部弱可观测性条件，并根据你的推导简要论证。以伏特 (V) 为单位表示最终的行列式。最终答案必须是 $\\det(\\mathcal{O}_k)$ 的单一闭式解析表达式。",
            "solution": "用户提供了一个需要验证并在有效时求解的问题陈述。\n\n### 步骤 1：问题验证\n\n第一步是提取给定信息并验证问题的完整性。\n\n**提取的已知条件：**\n- **状态向量：** $x_k = [\\, z_k \\;\\; v_k \\,]^{\\top}$。\n- **状态变量：** $z_k$ 是荷电状态 (SOC, 无单位)，$v_k$ 是 RC 过电势 (伏特)。\n- **输入：** $u_k = I_k$，施加的电流。\n- **采样周期：** $\\Delta t  0$。\n- **状态动力学：**\n  $z_{k+1} = z_k - \\frac{\\Delta t}{Q} \\, I_k$\n  $v_{k+1} = a \\, v_k + b \\, I_k$\n  这可以写成 $x_{k+1} = f(x_k, u_k) = \\begin{bmatrix} z_k - \\frac{\\Delta t}{Q} I_k \\\\ a v_k + b I_k \\end{bmatrix}$。\n- **测量模型：**\n  $y_k = V_{oc}(z_k) - v_k - R_0 I_k + \\nu_k$\n  这可以写成 $y_k = g(x_k, u_k) + \\nu_k$，其中 $g(x_k, u_k) = V_{oc}(z_k) - v_k - R_0 I_k$。\n- **参数：**\n  - $Q  0$ (容量)\n  - $R_0  0$ (欧姆内阻)\n  - $R_1  0$, $C_1  0$ (RC 对参数)\n  - $a = \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$\n  - $b = R_1 (1-a)$\n- **噪声：** $\\nu_k$ 是零均值测量噪声。\n- **工作点：** 一个固定点 $(x^{\\star}, u^{\\star})$，其中 $x^{\\star}=[z^{\\star}, v^{\\star}]^{\\top}$ 且 $u^{\\star}=I^{\\star}$。\n- **OCV 斜率：** $\\gamma := \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$。\n- **任务：** 推导状态雅可比矩阵 $A_k$、测量雅可比矩阵 $C_k$，构建可观测性矩阵 $\\mathcal{O}_k = \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$，并计算其行列式 $\\det(\\mathcal{O}_k)$。然后，分析局部弱可观测性的条件。\n\n**验证结论：**\n该问题具有科学依据，提法明确且客观。它描述了一个标准的锂离子电池等效电路模型，并要求进行标准的局部可观测性分析。该模型是电池管理系统中广泛使用的简化模型。所使用的术语、方程和要求的任务在控制理论及其在电化学系统中的应用中都是标准的。所有必要的信息都已提供，并且没有内部矛盾。该问题被判定为 **有效**。\n\n### 步骤 2：推导与求解\n\n我们继续解决已验证的问题。分析是通过在指定工作点 $(x^{\\star}, u^{\\star})$ 附近对非线性系统进行线性化来执行的。\n\n首先，我们定义非线性状态转移函数 $f(x_k, u_k)$ 和测量函数 $g(x_k, u_k)$：\n$$\nf(x_k, u_k) = \\begin{bmatrix} f_1(x_k, u_k) \\\\ f_2(x_k, u_k) \\end{bmatrix} = \\begin{bmatrix} z_k - \\frac{\\Delta t}{Q} I_k \\\\ a v_k + b I_k \\end{bmatrix}\n$$\n$$\ng(x_k, u_k) = V_{oc}(z_k) - v_k - R_0 I_k\n$$\n状态向量为 $x_k = \\begin{bmatrix} z_k \\\\ v_k \\end{bmatrix}$。\n\n**状态雅可比矩阵 $A_k$ 的推导**\n\n状态雅可比矩阵 $A_k$ 是状态函数 $f$ 对状态向量 $x$ 的偏导数，并在工作点 $(x^{\\star}, u^{\\star})$ 处求值。\n$$\nA_k = \\left.\\frac{\\partial f}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})} = \\left. \\begin{bmatrix} \\frac{\\partial f_1}{\\partial z_k}  \\frac{\\partial f_1}{\\partial v_k} \\\\ \\frac{\\partial f_2}{\\partial z_k}  \\frac{\\partial f_2}{\\partial v_k} \\end{bmatrix} \\right|_{(x^{\\star}, u^{\\star})}\n$$\n我们计算各个偏导数：\n- $\\frac{\\partial f_1}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( z_k - \\frac{\\Delta t}{Q} I_k \\right) = 1$\n- $\\frac{\\partial f_1}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( z_k - \\frac{\\Delta t}{Q} I_k \\right) = 0$\n- $\\frac{\\partial f_2}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( a v_k + b I_k \\right) = 0$\n- $\\frac{\\partial f_2}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( a v_k + b I_k \\right) = a$\n\n得到的雅可比矩阵 $A_k$ 是一个常数，不依赖于工作点：\n$$\nA_k = \\begin{bmatrix} 1  0 \\\\ 0  a \\end{bmatrix}\n$$\n\n**测量雅可比矩阵 $C_k$ 的推导**\n\n测量雅可比矩阵 $C_k$ 是测量函数 $g$ 对状态向量 $x$ 的偏导数，并在工作点 $(x^{\\star}, u^{\\star})$ 处求值。\n$$\nC_k = \\left.\\frac{\\partial g}{\\partial x}\\right|_{(x^{\\star}, u^{\\star})} = \\left. \\begin{bmatrix} \\frac{\\partial g}{\\partial z_k}  \\frac{\\partial g}{\\partial v_k} \\end{bmatrix} \\right|_{(x^{\\star}, u^{\\star})}\n$$\n我们计算各个偏导数：\n- $\\frac{\\partial g}{\\partial z_k} = \\frac{\\partial}{\\partial z_k} \\left( V_{oc}(z_k) - v_k - R_0 I_k \\right) = \\frac{d V_{oc}}{dz_k}$\n- $\\frac{\\partial g}{\\partial v_k} = \\frac{\\partial}{\\partial v_k} \\left( V_{oc}(z_k) - v_k - R_0 I_k \\right) = -1$\n\n在工作点 $x^{\\star} = [z^{\\star}, v^{\\star}]^{\\top}$ 处对这些偏导数求值，并使用给定定义 $\\gamma = \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$，我们得到：\n$$\nC_k = \\begin{bmatrix} \\gamma  -1 \\end{bmatrix}\n$$\n\n**可观测性矩阵 $\\mathcal{O}_k$ 的构建**\n\n这个 2 状态系统的局部可观测性矩阵由 $\\mathcal{O}_k = \\begin{bmatrix} C_k \\\\ C_k A_k \\end{bmatrix}$ 给出。\n我们首先计算乘积 $C_k A_k$：\n$$\nC_k A_k = \\begin{bmatrix} \\gamma  -1 \\end{bmatrix} \\begin{bmatrix} 1  0 \\\\ 0  a \\end{bmatrix} = \\begin{bmatrix} (\\gamma)(1) + (-1)(0)  (\\gamma)(0) + (-1)(a) \\end{bmatrix} = \\begin{bmatrix} \\gamma  -a \\end{bmatrix}\n$$\n现在，我们组装可观测性矩阵 $\\mathcal{O}_k$：\n$$\n\\mathcal{O}_k = \\begin{bmatrix} \\gamma  -1 \\\\ \\gamma  -a \\end{bmatrix}\n$$\n\n**行列式 $\\det(\\mathcal{O}_k)$ 的计算**\n\n这个 $2 \\times 2$ 可观测性矩阵的行列式为：\n$$\n\\det(\\mathcal{O}_k) = (\\gamma)(-a) - (-1)(\\gamma) = -\\gamma a + \\gamma = \\gamma(1 - a)\n$$\n问题要求结果用 $\\gamma$、$\\Delta t$、$R_1$ 和 $C_1$ 来表示。我们代入 $a$ 的表达式：\n$$\n\\det(\\mathcal{O}_k) = \\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)\n$$\n$\\gamma$ 的单位是伏特（因为 $V_{oc}$ 的单位是伏特，而 $z$ 是无单位的）。项 $(1-a)$ 是无单位的。因此，行列式的单位是伏特 (V)，符合要求。\n\n**局部弱可观测性的条件**\n\n如果一个离散时间非线性系统在其线性化可观测性矩阵 $\\mathcal{O}_k$ 满秩的情况下，它在某个工作点附近是局部弱可观测的。对于我们的 $2 \\times 2$ 矩阵 $\\mathcal{O}_k$，这个条件等价于其行列式不为零：\n$$\n\\det(\\mathcal{O}_k) \\neq 0\n$$\n$$\n\\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right) \\neq 0\n$$\n这个条件要求两个因子都不为零：\n1.  因为 $\\Delta t  0$，$R_1  0$ 且 $C_1  0$，指数 $-\\frac{\\Delta t}{R_1 C_1}$ 严格为负。这意味着 $\\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right)$ 是一个严格小于 1 的正数。因此，项 $\\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)$ 总是严格大于 0。\n2.  因此，可观测性条件简化为 $\\gamma \\neq 0$。\n\n当 OCV 曲线局部平坦时，$\\gamma = \\left.\\frac{d V_{oc}}{dz}\\right|_{z^{\\star}}$ 接近于零。当 $\\gamma \\rightarrow 0$ 时，我们有 $\\det(\\mathcal{O}_k) \\rightarrow 0$。行列式为零意味着可观测性矩阵是奇异的（秩亏的）。接近于零的行列式表明该矩阵是病态的，并且系统可观测性差。这意味着少量的噪声就可能使得在实际中无法区分 SOC $z_k$ 和过电势 $v_k$ 对输出电压 $y_k$ 的影响。状态估计，特别是 SOC 的估计，将变得不可靠。从物理意义上说，如果开路电压不随荷电状态变化，就无法从电压测量中估计荷电状态，从而使 SOC 状态不可观测。",
            "answer": "$$\n\\boxed{\\gamma \\left( 1 - \\exp\\left(-\\frac{\\Delta t}{R_1 C_1}\\right) \\right)}\n$$"
        }
    ]
}