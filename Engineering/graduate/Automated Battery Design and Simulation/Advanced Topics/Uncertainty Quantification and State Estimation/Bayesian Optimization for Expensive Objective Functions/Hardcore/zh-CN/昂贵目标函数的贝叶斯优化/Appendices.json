{
    "hands_on_practices": [
        {
            "introduction": "贝叶斯优化的核心是使用代理模型来表示我们对昂贵目标函数的认知。本练习将深入探讨该模型的核心机制：如何根据新的、含噪声的实验数据来更新我们的认知（即后验分布）。通过处理一个正态-正态共轭模型 ()，您将对高斯过程如何融合证据以减少不确定性并改进其预测获得基本理解。",
            "id": "3896095",
            "problem": "在自动化电池设计与仿真中，候选设计点 $x$ 的循环寿命通过运行昂贵的充放电实验进行评估，这些实验会产生带噪声的重复测量结果。为了在实验噪声下指导贝叶斯优化，考虑单个设计点 $x$，其潜在循环寿命 $f(x)$ 被建模为高斯过程（GP），在固定的 $x$ 点，这会引出一个正态先验 $f(x) \\sim \\mathcal{N}(m_{0}, \\sigma_{f}^{2})$。每次重复测量值被建模为 $y_{i} = f(x) + \\varepsilon_{i}$，其中 $\\varepsilon_{i}$ 独立同分布于 $\\mathcal{N}(0, \\sigma_{n}^{2})$。该设置对应于已知噪声方差的正态似然和正态先验。\n\n假设一个物理信息代理模型在 $x$ 点提供了先验均值 $m_{0} = 950$ 次循环和先验方差 $\\sigma_{f}^{2} = 1000$ 次循环$^{2}$。一项计量学研究估计观测噪声方差为 $\\sigma_{n}^{2} = 1000$ 次循环$^{2}$。然后，您在 $x$ 点进行了 $n=3$ 次重复实验，获得了观测到的循环寿命 $y_{1} = 972$ 次循环，$y_{2} = 961$ 次循环，以及 $y_{3} = 986$ 次循环。\n\n仅使用贝叶斯定理和正态-正态共轭模型的基本定义，完成以下任务：\n\n1. 推导在同一设计点 $x$ 处未来一个带噪声的测量值 $y_{*}$ 的后验预测分布，即基于三个观测到的重复测量结果以及给定的先验和噪声参数，计算在 $x$ 处的后验预测均值和方差。\n\n2. 确定在同一设计点 $x$ 处需要进行的额外重复实验的建议次数 $k$，以使潜函数 $f(x)$ 的后验方差相对于 $n=3$ 次重复实验后的当前值减半。将 $k$ 视为实现此减半目标的最小非负整数。\n\n将后验预测均值（单位：次循环）和后验预测方差（单位：次循环$^{2}$）均四舍五入至四位有效数字。将 $k$ 报告为整数。以单行矩阵的形式提供您的最终答案，矩阵中三个条目的顺序如下：后验预测均值、后验预测方差和 $k$。",
            "solution": "首先对问题进行验证，以确保其科学合理、定义明确且客观。\n\n### 步骤 1：提取给定信息\n-   潜循环寿命 $f(x)$ 的先验分布：$f(x) \\sim \\mathcal{N}(m_{0}, \\sigma_{f}^{2})$。\n-   先验均值：$m_{0} = 950$ 次循环。\n-   先验方差：$\\sigma_{f}^{2} = 1000$ 次循环$^{2}$。\n-   重复测量的似然模型：$y_{i} = f(x) + \\varepsilon_{i}$。\n-   观测噪声分布：$\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma_{n}^{2})$。\n-   观测噪声方差：$\\sigma_{n}^{2} = 1000$ 次循环$^{2}$。\n-   观测到的重复测量次数：$n=3$。\n-   观测数据：$y_{1} = 972$, $y_{2} = 961$, $y_{3} = 986$。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题具有科学依据，采用了标准且被广泛接受的用于推断的正态-正态共轭模型贝叶斯框架，这是高斯过程回归的基础。其背景——使用昂贵的仿真进行自动化电池设计——是贝叶斯优化的一个现实应用。该问题定义明确，提供了唯一确定所需量的所有必要参数和数据。语言客观、精确。没有矛盾、信息缺失或伪科学的主张。提供的数据对于电池循环寿命在物理上是合理的。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\n---\n\n根据题目要求，解答分为两个部分。\n\n### 第 1 部分：后验预测分布\n\n目标是求出未来一个带噪声的测量值 $y_{*}$ 的后验预测分布 $p(y_{*} | D)$，其中 $D = \\{y_1, y_2, y_3\\}$。这需要首先求出给定数据 $D$ 的情况下，潜循环寿命 $f(x)$ 的后验分布 $p(f(x)|D)$。\n\n**1. $f(x)$ 的后验分布**\n\n根据贝叶斯定理，后验分布正比于先验分布与似然函数的乘积：\n$$ p(f(x)|D) \\propto p(D|f(x)) \\, p(f(x)) $$\n先验分布为正态分布：\n$$ p(f(x)) = \\mathcal{N}(f(x) | m_0, \\sigma_f^2) \\propto \\exp\\left(-\\frac{1}{2}\\frac{(f(x) - m_0)^2}{\\sigma_f^2}\\right) $$\n$n$ 个独立同分布观测值 $y_i \\sim \\mathcal{N}(f(x), \\sigma_n^2)$ 的似然函数是：\n$$ p(D|f(x)) = \\prod_{i=1}^n \\mathcal{N}(y_i | f(x), \\sigma_n^2) \\propto \\exp\\left(-\\frac{1}{2\\sigma_n^2} \\sum_{i=1}^n (y_i - f(x))^2\\right) $$\n指数中的求和项可以围绕样本均值 $\\bar{y} = \\frac{1}{n} \\sum_{i=1}^n y_i$ 进行整理：\n$$ \\sum_{i=1}^n (y_i - f(x))^2 = \\sum_{i=1}^n (y_i - \\bar{y} + \\bar{y} - f(x))^2 = \\sum_{i=1}^n(y_i - \\bar{y})^2 + n(\\bar{y} - f(x))^2 $$\n$\\sum_{i=1}^n(y_i - \\bar{y})^2$ 项不依赖于 $f(x)$，可以被吸收到归一化常数中。因此，有效似然可以用充分统计量 $\\bar{y}$ 表示：\n$$ p(D|f(x)) \\propto \\exp\\left(-\\frac{n}{2\\sigma_n^2}(\\bar{y} - f(x))^2\\right) $$\n这表明样本均值的似然为 $p(\\bar{y}|f(x)) = \\mathcal{N}(\\bar{y} | f(x), \\sigma_n^2/n)$。\n\n结合先验和似然，后验分布 $p(f(x)|D)$ 的指数部分在相差一个加性常数的情况下为：\n$$ -\\frac{1}{2}\\left( \\frac{(f(x) - m_0)^2}{\\sigma_f^2} + \\frac{(f(x) - \\bar{y})^2}{\\sigma_n^2/n} \\right) $$\n展开平方项并合并关于 $f(x)^2$ 和 $f(x)$ 的项：\n$$ -\\frac{1}{2}\\left( f(x)^2\\left(\\frac{1}{\\sigma_f^2} + \\frac{n}{\\sigma_n^2}\\right) - 2f(x)\\left(\\frac{m_0}{\\sigma_f^2} + \\frac{n\\bar{y}}{\\sigma_n^2}\\right) + \\text{const} \\right) $$\n这是 $f(x)$ 的正态分布 $\\mathcal{N}(f(x)|m_n, \\sigma_{f,n}^2)$ 的指数部分，其中后验逆方差（精度）$\\frac{1}{\\sigma_{f,n}^2}$ 和后验均值 $m_n$ 可以通过配方法确定：\n$$ \\frac{1}{\\sigma_{f,n}^2} = \\frac{1}{\\sigma_f^2} + \\frac{n}{\\sigma_n^2} $$\n$$ m_n = \\sigma_{f,n}^2 \\left( \\frac{m_0}{\\sigma_f^2} + \\frac{n\\bar{y}}{\\sigma_n^2} \\right) $$\n首先，我们从数据中计算样本均值 $\\bar{y}$：\n$$ \\bar{y} = \\frac{y_1 + y_2 + y_3}{n} = \\frac{972 + 961 + 986}{3} = \\frac{2919}{3} = 973 $$\n现在，我们代入给定值：$m_0=950$, $\\sigma_f^2=1000$, $\\sigma_n^2=1000$, $n=3$, $\\bar{y}=973$。\n后验方差 $\\sigma_{f,n}^2$ 为：\n$$ \\frac{1}{\\sigma_{f,n}^2} = \\frac{1}{1000} + \\frac{3}{1000} = \\frac{4}{1000} = \\frac{1}{250} \\implies \\sigma_{f,n}^2 = 250 $$\n后验均值 $m_n$ 为：\n$$ m_n = 250 \\left( \\frac{950}{1000} + \\frac{3 \\times 973}{1000} \\right) = \\frac{250}{1000} (950 + 2919) = \\frac{1}{4}(3869) = 967.25 $$\n因此，潜函数的后验分布为 $f(x)|D \\sim \\mathcal{N}(967.25, 250)$。\n\n**2. $y_{*}$ 的后验预测分布**\n\n后验预测分布是给定历史数据 $D$ 的情况下，未来观测值 $y_{*}$ 的分布。它是通过对 $f(x)$ 的后验分布进行 $y_{*}$ 的似然函数的边缘化得到的：\n$$ p(y_{*}|D) = \\int p(y_{*}|f(x)) \\, p(f(x)|D) \\, df(x) $$\n我们有 $y_{*} = f(x) + \\varepsilon_{*}$，其中 $f(x) \\sim \\mathcal{N}(m_n, \\sigma_{f,n}^2)$ 且 $\\varepsilon_{*} \\sim \\mathcal{N}(0, \\sigma_n^2)$。由于 $y_{*}$ 是两个独立正态分布随机变量的和，它本身也服从正态分布。\n后验预测分布的均值是：\n$$ E[y_{*}|D] = E[f(x) + \\varepsilon_{*}|D] = E[f(x)|D] + E[\\varepsilon_{*}] = m_n + 0 = m_n $$\n后验预测分布的方差是：\n$$ \\text{Var}(y_{*}|D) = \\text{Var}(f(x) + \\varepsilon_{*}|D) = \\text{Var}(f(x)|D) + \\text{Var}(\\varepsilon_{*}) = \\sigma_{f,n}^2 + \\sigma_n^2 $$\n代入计算出的值和给定值：\n$$ E[y_{*}|D] = 967.25 $$\n$$ \\text{Var}(y_{*}|D) = 250 + 1000 = 1250 $$\n按要求四舍五入到四位有效数字：\n-   后验预测均值：$967.3$ 次循环。\n-   后验预测方差：$1250$ 次循环$^{2}$。\n\n### 第 2 部分：所需的额外重复实验次数\n\n任务是找到所需的最小非负整数 $k$（额外重复实验次数），以使潜函数 $f(x)$ 的后验方差减半。\n\n当前 $n=3$ 次重复实验的后验方差为 $\\sigma_{f,3}^2 = 250$。\n目标后验方差为 $\\sigma_{f, \\text{target}}^2 = \\frac{1}{2} \\sigma_{f,3}^2 = \\frac{1}{2}(250) = 125$。\n\n设 $N$ 为总重复实验次数。经过 $N$ 次重复实验后的后验方差 $\\sigma_{f,N}^2$ 由以下公式给出：\n$$ \\frac{1}{\\sigma_{f,N}^2} = \\frac{1}{\\sigma_f^2} + \\frac{N}{\\sigma_n^2} $$\n代入已知的方差值：\n$$ \\frac{1}{\\sigma_{f,N}^2} = \\frac{1}{1000} + \\frac{N}{1000} = \\frac{1+N}{1000} $$\n这给出了后验方差作为 $N$ 的函数：\n$$ \\sigma_{f,N}^2 = \\frac{1000}{1+N} $$\n我们需要找到最小的整数 $N$，使得后验方差小于或等于目标方差 $125$。\n$$ \\sigma_{f,N}^2 \\le 125 $$\n$$ \\frac{1000}{1+N} \\le 125 $$\n$$ 1000 \\le 125(1+N) $$\n$$ \\frac{1000}{125} \\le 1+N $$\n$$ 8 \\le 1+N $$\n$$ N \\ge 7 $$\n所需的最小总重复实验次数为 $N=7$。\n由于我们已经进行了 $n=3$ 次重复实验，因此额外重复实验的次数 $k$ 为：\n$$ k = N - n = 7 - 3 = 4 $$\n所需的最小非负整数额外重复实验次数为 $k=4$。\n\n最终答案是一个包含后验预测均值、后验预测方差和 $k$ 的行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n967.3  & 1250 & 4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在更新代理模型后，下一步是决定下一个采样点，这由“采集函数”指导，它在探索未知区域和利用已知最优区域之间做出权衡。本练习将让您亲手计算并比较两种基础采集函数：改进概率 ($PI$) 和上置信界 ($UCB$) ()。通过观察它们如何对候选点进行不同排序，您将直观地理解贝叶斯优化中探索与利用之间的平衡。",
            "id": "3896133",
            "problem": "一个实验室通过优化一个无量纲的性能目标，来自动化选择用于锂离子电池配方的电解质盐。该性能目标结合了模拟的离子电导率和电化学稳定性，并被归一化到区间 $[0,1]$。该性能由一个高斯过程 (GP) 代理模型建模；对于输入为 $x$ 的任意候选盐，未知目标 $f(x)$ 的 GP 后验预测分布是均值为 $\\mu(x)$、方差为 $\\sigma^{2}(x)$ 的高斯分布。目标是最大化 $f(x)$。\n\n给定三种候选盐 $\\{S_{1},S_{2},S_{3}\\}$，其 GP 后验摘要是根据在其他设计点进行的一组昂贵的多物理场仿真计算得出的。迄今为止观测到的最佳目标值为 $f^{*}=0.95$。使用改进裕度 $\\xi=0.01$。上置信界 (UCB) 探索参数为 $\\beta=4$。对于这三种候选盐，GP 后验预测均值和方差如下：\n- $S_{1}$: $\\mu_{1}=0.955$, $\\sigma_{1}^{2}=1.0\\times 10^{-4}$,\n- $S_{2}$: $\\mu_{2}=0.85$, $\\sigma_{2}^{2}=1.44\\times 10^{-2}$,\n- $S_{3}$: $\\mu_{3}=0.95$, $\\sigma_{3}^{2}=4.0\\times 10^{-4}$。\n\n使用以下基本依据：\n- GP 预测模型意味着，对于固定的 $x$ 和数据集 $\\mathcal{D}$，有 $f(x)\\mid\\mathcal{D}\\sim\\mathcal{N}(\\mu(x),\\sigma^{2}(x))$。\n- 在 $x$ 处的改进概率 (PI) 采集函数（用于最大化）是指在预测分布下，改进随机变量 $I(x)=\\max\\{0, f(x)-(f^{*}+\\xi)\\}$ 严格为正的概率。\n- 在 $x$ 处的上置信界 (UCB) 采集函数（用于最大化）是 $\\mu(x)+\\sqrt{\\beta}\\,\\sigma(x)$，该表达式源于亚高斯过程的集中不等式。\n\n任务：\n1) 从第一性原理出发，根据 $I(x)$ 的定义和高斯预测模型，推导每个候选盐 $S_{i}$ 的改进概率的解析表达式（用 $\\mu_{i}$、$\\sigma_{i}$、$f^{*}$ 和 $\\xi$ 表示）。对 $S_{1}$、$S_{2}$ 和 $S_{3}$ 的结果表达式进行数值计算。\n2) 使用上置信界的定义，计算每个 $S_{i}$ 的 UCB 值并进行数值评估。\n3) 分别根据 PI 和 UCB 的采集值，将三种候选盐从高到低排序。如果采集值完全相等，则优先选择预测均值 $\\mu_{i}$ 较大的候选盐来打破平局。说明每个采集函数会选择哪个候选盐。\n4) 令 $i_{\\mathrm{PI}}\\in\\{1,2,3\\}$ 和 $i_{\\mathrm{UCB}}\\in\\{1,2,3\\}$ 分别表示在上述平局打破规则下，由 PI 和 UCB 选择的候选盐的索引。报告单个整数 $i_{\\mathrm{UCB}}-i_{\\mathrm{PI}}$ 作为你的最终答案。不包含单位。\n\n所有计算都是无量纲的。在需要中间数值时，你可以将标准正态概率近似到至少四位有效数字，但最终报告的整数 $i_{\\mathrm{UCB}}-i_{\\mathrm{PI}}$ 必须是精确的（对于整数，不需要舍入说明）。",
            "solution": "经评估，该问题是有效的，因为它科学地基于贝叶斯优化的原理，问题设定良好并提供了所有必要信息，并且以客观、正式的语言表述。我们开始解答。\n\n解答分为四个部分，对应问题陈述中指定的四个任务。\n\n**1) 改进概率 (PI) 的推导与计算**\n\n改进概率 $\\mathrm{PI}(x)$ 定义为改进随机变量 $I(x) = \\max\\{0, f(x)-(f^{*}+\\xi)\\}$ 严格为正的概率。\n条件 $I(x) > 0$ 等价于条件 $f(x) - (f^{*} + \\xi) > 0$，即 $f(x) > f^{*} + \\xi$。\n\n问题指出，目标函数 $f(x)$ 的 GP 后验预测分布是高斯分布：$f(x) \\sim \\mathcal{N}(\\mu(x), \\sigma^2(x))$。\n为了计算概率，我们对随机变量 $f(x)$ 进行标准化。令 $Z$ 为标准正态随机变量，$Z \\sim \\mathcal{N}(0,1)$。那么我们可以写成 $f(x) = \\mu(x) + \\sigma(x)Z$。\n\n不等式 $f(x) > f^{*} + \\xi$ 变为：\n$$ \\mu(x) + \\sigma(x)Z > f^{*} + \\xi $$\n整理关于 $Z$ 的不等式，我们得到：\n$$ \\sigma(x)Z > f^{*} + \\xi - \\mu(x) $$\n$$ Z > \\frac{f^{*} + \\xi - \\mu(x)}{\\sigma(x)} $$\n因此，概率为：\n$$ \\mathrm{PI}(x) = P\\left(Z > \\frac{f^{*} + \\xi - \\mu(x)}{\\sigma(x)}\\right) $$\n令 $\\Phi(\\cdot)$ 表示标准正态分布的累积分布函数 (CDF)。概率 $P(Z > z)$ 可以写成 $1 - \\Phi(z)$，或者等价地写成 $\\Phi(-z)$。因此，改进概率的解析表达式为：\n$$ \\mathrm{PI}(x) = \\Phi\\left(\\frac{\\mu(x) - f^{*} - \\xi}{\\sigma(x)}\\right) $$\n现在，我们使用给定值 $f^{*} = 0.95$ 和 $\\xi = 0.01$ 对三种候选盐计算该表达式。改进阈值为 $f^{*} + \\xi = 0.96$。\n\n对于候选盐 $S_{1}$：\n$\\mu_{1} = 0.955$ 且 $\\sigma_{1}^{2} = 1.0 \\times 10^{-4}$，所以 $\\sigma_{1} = \\sqrt{1.0 \\times 10^{-4}} = 0.01$。\nCDF 的参数为：\n$$ z_1 = \\frac{\\mu_{1} - (f^{*} + \\xi)}{\\sigma_{1}} = \\frac{0.955 - 0.96}{0.01} = \\frac{-0.005}{0.01} = -0.5 $$\n所以，$\\mathrm{PI}_{1} = \\Phi(-0.5) \\approx 0.3085$。\n\n对于候选盐 $S_{2}$：\n$\\mu_{2} = 0.85$ 且 $\\sigma_{2}^{2} = 1.44 \\times 10^{-2}$，所以 $\\sigma_{2} = \\sqrt{1.44 \\times 10^{-2}} = 0.12$。\nCDF 的参数为：\n$$ z_2 = \\frac{\\mu_{2} - (f^{*} + \\xi)}{\\sigma_{2}} = \\frac{0.85 - 0.96}{0.12} = \\frac{-0.11}{0.12} \\approx -0.9167 $$\n所以，$\\mathrm{PI}_{2} = \\Phi(-0.9167) \\approx 0.1797$。\n\n对于候选盐 $S_{3}$：\n$\\mu_{3} = 0.95$ 且 $\\sigma_{3}^{2} = 4.0 \\times 10^{-4}$，所以 $\\sigma_{3} = \\sqrt{4.0 \\times 10^{-4}} = 0.02$。\nCDF 的参数为：\n$$ z_3 = \\frac{\\mu_{3} - (f^{*} + \\xi)}{\\sigma_{3}} = \\frac{0.95 - 0.96}{0.02} = \\frac{-0.01}{0.02} = -0.5 $$\n所以，$\\mathrm{PI}_{3} = \\Phi(-0.5) \\approx 0.3085$。\n\n**2) 上置信界 (UCB) 的计算**\n\n上置信界定义为 $\\mathrm{UCB}(x) = \\mu(x) + \\sqrt{\\beta}\\sigma(x)$。\n给定探索参数 $\\beta = 4$，我们有 $\\sqrt{\\beta} = \\sqrt{4} = 2$。我们计算每个候选盐的 UCB 值。\n\n对于候选盐 $S_{1}$：\n$\\mu_{1} = 0.955$ 且 $\\sigma_{1} = 0.01$。\n$$ \\mathrm{UCB}_{1} = 0.955 + 2 \\times 0.01 = 0.955 + 0.02 = 0.975 $$\n\n对于候选盐 $S_{2}$：\n$\\mu_{2} = 0.85$ 且 $\\sigma_{2} = 0.12$。\n$$ \\mathrm{UCB}_{2} = 0.85 + 2 \\times 0.12 = 0.85 + 0.24 = 1.09 $$\n\n对于候选盐 $S_{3}$：\n$\\mu_{3} = 0.95$ 且 $\\sigma_{3} = 0.02$。\n$$ \\mathrm{UCB}_{3} = 0.95 + 2 \\times 0.02 = 0.95 + 0.04 = 0.99 $$\n\n**3) 候选盐的排序与选择**\n\n我们根据 PI 和 UCB 值，将候选盐从高到低排序。\n\n按 PI 排序：\n计算出的 PI 值为 $\\mathrm{PI}_{1} \\approx 0.3085$，$\\mathrm{PI}_{2} \\approx 0.1797$ 和 $\\mathrm{PI}_{3} \\approx 0.3085$。\n我们观察到 $\\mathrm{PI}_{1} = \\mathrm{PI}_{3} > \\mathrm{PI}_{2}$。$S_{1}$ 和 $S_{3}$ 之间存在完全平局。\n平局打破规则规定，优先选择预测均值 $\\mu_{i}$ 较大的候选盐。\n比较 $S_{1}$ 和 $S_{3}$：$\\mu_{1} = 0.955$ 且 $\\mu_{3} = 0.95$。因为 $\\mu_{1} > \\mu_{3}$，所以候选盐 $S_{1}$ 的排名高于 $S_{3}$。\n最终的 PI 排名是 $S_{1} > S_{3} > S_{2}$。\nPI 采集函数选择的候选盐是 $S_{1}$。因此，$i_{\\mathrm{PI}} = 1$。\n\n按 UCB 排序：\n计算出的 UCB 值为 $\\mathrm{UCB}_{1} = 0.975$，$\\mathrm{UCB}_{2} = 1.09$ 和 $\\mathrm{UCB}_{3} = 0.99$。\n比较这些值，我们得到 $1.09 > 0.99 > 0.975$。\nUCB 排名是 $S_{2} > S_{3} > S_{1}$。\nUCB 采集函数选择的候选盐是 $S_{2}$。因此，$i_{\\mathrm{UCB}} = 2$。\n\n**4) 最终计算**\n\n问题要求计算整数值 $i_{\\mathrm{UCB}} - i_{\\mathrm{PI}}$。\n我们得到 $i_{\\mathrm{PI}} = 1$ 和 $i_{\\mathrm{UCB}} = 2$。\n因此，最终结果是：\n$$ i_{\\mathrm{UCB}} - i_{\\mathrm{PI}} = 2 - 1 = 1 $$\n这就是要报告的最终整数。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "选定采集函数后，我们必须在设计空间中找到使其最大化的点，以确定下一个实验位置。对于连续域，这通常需要数值优化方法。本练习将引导您使用基于梯度的方法来优化期望改进 ($EI$) 采集函数 ()，通过推导并计算 $EI$ 的梯度，您将理解如何精确定位下一个查询点，从而将抽象的采集函数概念转化为具体的算法步骤。",
            "id": "3896098",
            "problem": "一个自动化电池设计团队正在使用贝叶斯优化来调整两个归一化的设计变量 $\\mathbf{x} = (x_{1}, x_{2})$，这两个变量在经过仿射缩放到 $[0,1]^{2}$ 后，分别代表阴极孔隙率和涂层厚度。每次昂贵的多物理场仿真都会返回一个标量目标 $f(\\mathbf{x})$（待最小化），该目标综合了放电过电位和制造成本。一个高斯过程（GP）代理模型被拟合到收集到的数据上，对于任意 $\\mathbf{x}$ 处的潜在响应 $Y(\\mathbf{x})$，该模型产生一个高斯后验预测分布 $Y(\\mathbf{x}) \\sim \\mathcal{N}(\\mu(\\mathbf{x}), \\sigma(\\mathbf{x})^{2})$。期望提升采集函数 $\\mathrm{EI}(\\mathbf{x})$ 由提升量 $I(\\mathbf{x}) = \\max\\{f_{\\min} - Y(\\mathbf{x}), 0\\}$ 定义，其中 $f_{\\min}$ 是迄今为止观测到的最佳目标值，且 $\\mathrm{EI}(\\mathbf{x}) = \\mathbb{E}[I(\\mathbf{x})]$。仅从这些基本定义、正态分布的性质以及标准微分法则出发，推导梯度 $\\nabla \\mathrm{EI}(\\mathbf{x})$ 的显式表达式，用 $\\mu(\\mathbf{x})$、$\\sigma(\\mathbf{x})$、$\\nabla \\mu(\\mathbf{x})$ 和 $\\nabla \\sigma(\\mathbf{x})$ 表示。\n\n然后，在当前候选点 $\\mathbf{x}^{(0)} = (x_{1}^{(0)}, x_{2}^{(0)}) = (0.42, 0.73)$ 处，代理模型提供以下局部量：$\\mu(\\mathbf{x}^{(0)}) = 2.1$，$\\sigma(\\mathbf{x}^{(0)}) = 0.5$，$\\nabla \\mu(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.8 \\\\ -0.02\\end{pmatrix}$，以及 $\\nabla \\sigma(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.1 \\\\ 0.005\\end{pmatrix}$。当前观测到的最佳（最小）目标值是 $f_{\\min} = 1.8$。数值计算梯度 $\\nabla \\mathrm{EI}(\\mathbf{x}^{(0)})$，并使用步长 $\\eta = 0.15$ 在 $\\mathrm{EI}$ 上执行一步梯度上升，以获得 $\\mathbf{x}^{(1)} = \\mathbf{x}^{(0)} + \\eta \\nabla \\mathrm{EI}(\\mathbf{x}^{(0)})$。\n\n仅报告更新后的设计向量 $\\mathbf{x}^{(1)}$，以行向量形式表示。将你的答案四舍五入到 $4$ 位有效数字。由于归一化，设计变量是无量纲的；不要报告任何物理单位。",
            "solution": "用户希望我解决一个关于贝叶斯优化的问题。\n\n我的计划如下：\n1.  **验证问题**：我将执行强制性验证检查。\n2.  **解决问题**：\n    *   推导期望提升（EI）采集函数的梯度解析表达式。\n    *   使用推导出的表达式和提供的数值计算指定点的梯度。\n    *   执行单步梯度上升以找到更新后的设计向量。\n    *   按要求格式化最终答案。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n*   设计变量：$\\mathbf{x} = (x_{1}, x_{2}) \\in [0,1]^{2}$。\n*   待最小化的目标函数：$f(\\mathbf{x})$。\n*   代理模型后验：$Y(\\mathbf{x}) \\sim \\mathcal{N}(\\mu(\\mathbf{x}), \\sigma(\\mathbf{x})^{2})$。\n*   提升函数：$I(\\mathbf{x}) = \\max\\{f_{\\min} - Y(\\mathbf{x}), 0\\}$，其中 $f_{\\min}$ 是观测到的最佳目标。\n*   采集函数：$\\mathrm{EI}(\\mathbf{x}) = \\mathbb{E}[I(\\mathbf{x})]$。\n*   任务1：用 $\\mu(\\mathbf{x})$、$\\sigma(\\mathbf{x})$、$\\nabla \\mu(\\mathbf{x})$ 和 $\\nabla \\sigma(\\mathbf{x})$ 推导 $\\nabla \\mathrm{EI}(\\mathbf{x})$。\n*   任务2：计算 $\\mathbf{x}^{(1)} = \\mathbf{x}^{(0)} + \\eta \\nabla \\mathrm{EI}(\\mathbf{x}^{(0)})$。\n*   当前候选点：$\\mathbf{x}^{(0)} = (0.42, 0.73)$。\n*   $\\mathbf{x}^{(0)}$ 处的代理模型量：\n    *   $\\mu(\\mathbf{x}^{(0)}) = 2.1$\n    *   $\\sigma(\\mathbf{x}^{(0)}) = 0.5$\n    *   $\\nabla \\mu(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.8 \\\\ -0.02\\end{pmatrix}$\n    *   $\\nabla \\sigma(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.1 \\\\ 0.005\\end{pmatrix}$\n*   观测到的最佳目标：$f_{\\min} = 1.8$。\n*   步长：$\\eta = 0.15$。\n*   最终答案要求：以行向量形式报告 $\\mathbf{x}^{(1)}$，四舍五入到 $4$ 位有效数字。\n\n**第2步：使用提取的已知条件进行验证**\n\n*   **科学依据**：该问题基于贝叶斯优化、高斯过程和多元微积分的成熟原理。这些是机器学习和应用数学中的标准课题。\n*   **良态问题**：该问题提供了推导所需梯度和计算更新设计向量的所有必要定义、函数和数值。任务定义明确，可导向唯一解。\n*   **客观性**：该问题使用精确的数学语言和客观的数值数据进行陈述。没有主观或模糊的术语。\n*   该问题不存在任何列出的缺陷（例如，科学上不健全、不完整、矛盾等）。它是其领域内一个标准的、可解的问题。\n\n**第3步：结论与行动**\n\n问题是**有效的**。现在开始求解过程。\n\n### 推导与求解\n\n第一步是推导期望提升 $\\mathrm{EI}(\\mathbf{x})$ 的显式表达式，然后求其梯度 $\\nabla \\mathrm{EI}(\\mathbf{x})$。\n\n**1. $\\mathrm{EI}(\\mathbf{x})$ 的表达式**\n\n期望提升定义为提升函数 $I(\\mathbf{x}) = \\max\\{f_{\\min} - Y(\\mathbf{x}), 0\\}$ 的期望，其中 $Y(\\mathbf{x})$ 服从高斯分布 $Y(\\mathbf{x}) \\sim \\mathcal{N}(\\mu(\\mathbf{x}), \\sigma(\\mathbf{x})^{2})$。$Y(\\mathbf{x})$ 的概率密度函数（PDF）是 $p(y|\\mu(\\mathbf{x}),\\sigma(\\mathbf{x})) = \\frac{1}{\\sigma(\\mathbf{x})\\sqrt{2\\pi}} \\exp\\left(-\\frac{(y-\\mu(\\mathbf{x}))^2}{2\\sigma(\\mathbf{x})^2}\\right)$。\n\n期望是关于潜在响应 $y$ 所有可能值的积分：\n$$\n\\mathrm{EI}(\\mathbf{x}) = \\mathbb{E}[I(\\mathbf{x})] = \\int_{-\\infty}^{\\infty} \\max\\{f_{\\min} - y, 0\\} p(y|\\mu(\\mathbf{x}),\\sigma(\\mathbf{x})) dy\n$$\n$\\max\\{f_{\\min} - y, 0\\}$ 项仅在 $y  f_{\\min}$ 时非零。因此，积分范围可以限制为：\n$$\n\\mathrm{EI}(\\mathbf{x}) = \\int_{-\\infty}^{f_{\\min}} (f_{\\min} - y) \\frac{1}{\\sigma(\\mathbf{x})\\sqrt{2\\pi}} \\exp\\left(-\\frac{(y-\\mu(\\mathbf{x}))^2}{2\\sigma(\\mathbf{x})^2}\\right) dy\n$$\n为简化积分，我们进行变量替换，转换到标准正态分布。令 $z = \\frac{y-\\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}$。则 $y = \\mu(\\mathbf{x}) + z\\sigma(\\mathbf{x})$ 且 $dy = \\sigma(\\mathbf{x})dz$。当 $y=f_{\\min}$ 时，积分上限变为 $z_{up} = \\frac{f_{\\min}-\\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}$。我们把这个标准化提升量记为 $Z(\\mathbf{x}) = \\frac{f_{\\min}-\\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}$。积分变换为：\n$$\n\\mathrm{EI}(\\mathbf{x}) = \\int_{-\\infty}^{Z(\\mathbf{x})} (f_{\\min} - (\\mu(\\mathbf{x}) + z\\sigma(\\mathbf{x}))) \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z^2}{2}\\right) dz\n$$\n令 $\\phi(z)$ 为标准正态分布的PDF（概率密度函数），$\\Phi(z)$ 为CDF（累积分布函数）。\n$$\n\\mathrm{EI}(\\mathbf{x}) = \\int_{-\\infty}^{Z(\\mathbf{x})} (f_{\\min} - \\mu(\\mathbf{x})) \\phi(z) dz - \\sigma(\\mathbf{x}) \\int_{-\\infty}^{Z(\\mathbf{x})} z \\phi(z) dz\n$$\n第一项计算结果为：\n$$\n(f_{\\min} - \\mu(\\mathbf{x})) \\int_{-\\infty}^{Z(\\mathbf{x})} \\phi(z) dz = (f_{\\min} - \\mu(\\mathbf{x})) \\Phi(Z(\\mathbf{x}))\n$$\n对于第二项，我们使用 $\\frac{d\\phi(z)}{dz} = -z\\phi(z)$ 这一事实：\n$$\n\\int_{-\\infty}^{Z(\\mathbf{x})} z \\phi(z) dz = \\int_{-\\infty}^{Z(\\mathbf{x})} -\\frac{d\\phi(z)}{dz} dz = [-\\phi(z)]_{-\\infty}^{Z(\\mathbf{x})} = -\\phi(Z(\\mathbf{x})) - (-\\phi(-\\infty)) = -\\phi(Z(\\mathbf{x}))\n$$\n因为 $\\phi(-\\infty) = 0$。\n将这些结果代回，我们得到期望提升的标准表达式：\n$$\n\\mathrm{EI}(\\mathbf{x}) = (f_{\\min} - \\mu(\\mathbf{x})) \\Phi(Z(\\mathbf{x})) - \\sigma(\\mathbf{x})(-\\phi(Z(\\mathbf{x})))\n$$\n$$\n\\mathrm{EI}(\\mathbf{x}) = (f_{\\min} - \\mu(\\mathbf{x})) \\Phi\\left(\\frac{f_{\\min}-\\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}\\right) + \\sigma(\\mathbf{x}) \\phi\\left(\\frac{f_{\\min}-\\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}\\right)\n$$\n如果 $\\sigma(\\mathbf{x})=0$，提升量是确定性的。如果 $\\mu(\\mathbf{x}) \\ge f_{min}$，$I(\\mathbf{x})=0$。如果 $\\mu(\\mathbf{x})  f_{min}$，$I(\\mathbf{x}) = f_{min} - \\mu(\\mathbf{x})$。该公式正确处理了 $\\sigma(\\mathbf{x})\\to 0^+$ 的情况。如果 $f_{\\min} > \\mu(\\mathbf{x})$，$Z \\to \\infty$，$\\Phi(Z)\\to 1$，$\\phi(Z) \\to 0$，所以 $\\mathrm{EI}(\\mathbf{x}) \\to f_{\\min} - \\mu(\\mathbf{x})$。如果 $f_{\\min}  \\mu(\\mathbf{x})$，$Z \\to -\\infty$，$\\Phi(Z)\\to 0$，$\\phi(Z)\\to 0$，所以 $\\mathrm{EI}(\\mathbf{x}) \\to 0$。\n\n**2. $\\mathrm{EI}(\\mathbf{x})$ 的梯度**\n\n为了求梯度 $\\nabla \\mathrm{EI}(\\mathbf{x})$，我们使用链式法则和乘积法则对 $\\mathbf{x}$ 求导。令 $Z=Z(\\mathbf{x})$、$\\mu=\\mu(\\mathbf{x})$ 和 $\\sigma=\\sigma(\\mathbf{x})$。\n$$\n\\nabla \\mathrm{EI} = \\nabla[(f_{\\min} - \\mu) \\Phi(Z)] + \\nabla[\\sigma \\phi(Z)]\n$$\n对两项应用乘积法则：\n$$\n\\nabla \\mathrm{EI} = [\\nabla(f_{\\min} - \\mu)]\\Phi(Z) + (f_{\\min} - \\mu)[\\nabla\\Phi(Z)] + [\\nabla\\sigma]\\phi(Z) + \\sigma[\\nabla\\phi(Z)]\n$$\n使用链式法则，$\\nabla\\Phi(Z) = \\frac{d\\Phi(Z)}{dZ}\\nabla Z = \\phi(Z)\\nabla Z$ 且 $\\nabla\\phi(Z) = \\frac{d\\phi(Z)}{dZ}\\nabla Z = -Z\\phi(Z)\\nabla Z$。将它们代入：\n$$\n\\nabla \\mathrm{EI} = -\\nabla\\mu \\, \\Phi(Z) + (f_{\\min} - \\mu) \\phi(Z)\\nabla Z + \\nabla\\sigma \\, \\phi(Z) - \\sigma Z \\phi(Z)\\nabla Z\n$$\n合并同类项：\n$$\n\\nabla \\mathrm{EI} = -\\nabla\\mu \\, \\Phi(Z) + \\nabla\\sigma \\, \\phi(Z) + [(f_{\\min} - \\mu) - \\sigma Z] \\phi(Z)\\nabla Z\n$$\n根据定义，$Z = \\frac{f_{\\min} - \\mu}{\\sigma}$，这意味着 $f_{\\min} - \\mu = \\sigma Z$。因此，方括号中的项正好为零：$[(f_{\\min} - \\mu) - \\sigma Z] = [\\sigma Z - \\sigma Z] = 0$。这极大地简化了梯度的表达式：\n$$\n\\nabla \\mathrm{EI}(\\mathbf{x}) = -\\nabla\\mu(\\mathbf{x}) \\Phi\\left(\\frac{f_{\\min} - \\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}\\right) + \\nabla\\sigma(\\mathbf{x}) \\phi\\left(\\frac{f_{\\min} - \\mu(\\mathbf{x})}{\\sigma(\\mathbf{x})}\\right)\n$$\n这就是所要求的期望提升梯度的解析表达式。\n\n**3. 数值计算**\n\n现在，我们将此公式应用于给定的数值数据。\n给定值：\n$f_{\\min} = 1.8$，$\\mu(\\mathbf{x}^{(0)}) = 2.1$，$\\sigma(\\mathbf{x}^{(0)}) = 0.5$。\n$\\nabla \\mu(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.8 \\\\ -0.02\\end{pmatrix}$，$\\nabla \\sigma(\\mathbf{x}^{(0)}) = \\begin{pmatrix}0.1 \\\\ 0.005\\end{pmatrix}$。\n\n首先，计算 $\\mathbf{x}^{(0)}$ 处的标准化提升量 $Z$：\n$$\nZ(\\mathbf{x}^{(0)}) = \\frac{f_{\\min} - \\mu(\\mathbf{x}^{(0)})}{\\sigma(\\mathbf{x}^{(0)})} = \\frac{1.8 - 2.1}{0.5} = \\frac{-0.3}{0.5} = -0.6\n$$\n接下来，我们需要标准正态PDF $\\phi(z)$和CDF $\\Phi(z)$在 $z = -0.6$ 处的值：\n$$\n\\phi(-0.6) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{(-0.6)^2}{2}\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-0.18) \\approx 0.3332246\n$$\n$$\n\\Phi(-0.6) = \\int_{-\\infty}^{-0.6} \\phi(z)dz \\approx 0.2742531\n$$\n现在，将这些值代入梯度公式：\n$$\n\\nabla \\mathrm{EI}(\\mathbf{x}^{(0)}) = -\\begin{pmatrix}0.8 \\\\ -0.02\\end{pmatrix} (0.2742531) + \\begin{pmatrix}0.1 \\\\ 0.005\\end{pmatrix} (0.3332246)\n$$\n$$\n\\nabla \\mathrm{EI}(\\mathbf{x}^{(0)}) = \\begin{pmatrix} -0.8 \\times 0.2742531 + 0.1 \\times 0.3332246 \\\\ -(-0.02) \\times 0.2742531 + 0.005 \\times 0.3332246 \\end{pmatrix}\n$$\n$$\n\\nabla \\mathrm{EI}(\\mathbf{x}^{(0)}) = \\begin{pmatrix} -0.21940248 + 0.03332246 \\\\ 0.005485062 + 0.001666123 \\end{pmatrix} = \\begin{pmatrix} -0.18608002 \\\\ 0.007151185 \\end{pmatrix}\n$$\n\n**4. 梯度上升步骤**\n\n最后，使用步长 $\\eta = 0.15$ 执行一步梯度上升以得到 $\\mathbf{x}^{(1)}$：\n$$\n\\mathbf{x}^{(1)} = \\mathbf{x}^{(0)} + \\eta \\nabla \\mathrm{EI}(\\mathbf{x}^{(0)})\n$$\n设计向量 $\\mathbf{x}$ 是一个行向量，所以我们按分量进行更新。\n$$\n\\begin{pmatrix} x_{1}^{(1)} \\\\ x_{2}^{(1)} \\end{pmatrix} = \\begin{pmatrix} 0.42 \\\\ 0.73 \\end{pmatrix} + 0.15 \\begin{pmatrix} -0.18608002 \\\\ 0.007151185 \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} x_{1}^{(1)} \\\\ x_{2}^{(1)} \\end{pmatrix} = \\begin{pmatrix} 0.42 + (0.15 \\times -0.18608002) \\\\ 0.73 + (0.15 \\times 0.007151185) \\end{pmatrix}\n$$\n$$\n\\begin{pmatrix} x_{1}^{(1)} \\\\ x_{2}^{(1)} \\end{pmatrix} = \\begin{pmatrix} 0.42 - 0.027912003 \\\\ 0.73 + 0.00107267775 \\end{pmatrix} = \\begin{pmatrix} 0.392087997 \\\\ 0.73107267775 \\end{pmatrix}\n$$\n问题要求将答案四舍五入到 $4$ 位有效数字。\n$x_1^{(1)} \\approx 0.3921$\n$x_2^{(1)} \\approx 0.7311$\n\n更新后的设计向量是 $\\mathbf{x}^{(1)} = (0.3921, 0.7311)$。\n注意：问题指出搜索空间为 $[0,1]^2$。更新后的点 $(0.3921, 0.7311)$ 在此域内，因此不需要投影或裁剪。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.3921  0.7311 \\end{pmatrix} } $$"
        }
    ]
}