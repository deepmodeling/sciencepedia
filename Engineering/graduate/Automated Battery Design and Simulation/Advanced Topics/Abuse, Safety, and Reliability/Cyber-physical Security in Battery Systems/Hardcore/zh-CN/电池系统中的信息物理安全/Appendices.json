{
    "hands_on_practices": [
        {
            "introduction": "构建安全可靠的电池系统的第一道防线是设计上的冗余。本练习将这一基本原则量化，通过一个思想实验来探讨如何在最坏的情况下，通过增加冗余传感器来确保关键的安全性（例如防止热失控）。通过计算所需的最小传感器数量，您将掌握在面对确定数量的对抗性攻击时，如何设计具有容错能力的监测系统。",
            "id": "3903121",
            "problem": "一个锂离子电池组装有 $n$ 个冗余温度传感器，用于早期检测热失控。电池管理系统 (BMS) 使用一个警报规则，即任何传感器报告超温情况时，都会触发紧急停机。在实际存在超温情况时，每个未受损的传感器独立地以概率 $\\beta \\in (0,1)$ 未能报告该情况（也就是说，每个传感器的假阴性率为 $\\beta$）。为了模拟信息物理对抗，假设最多有 $f$ 个传感器可能被攻击者控制，并且这些传感器总是抑制警报（最坏情况下的对抗行为）。假设在存在真实超温情况的条件下，未受损传感器之间的漏报是条件独立的。\n\n设计最小的整数 $n$，使得即使在存在最多 $f$ 个受损传感器的情况下，当超温情况发生时，BMS 触发警报的概率（检测概率）至少为 $1-\\beta$。将您的最终答案表示为 $n$ 关于 $f$ 和 $\\beta$ 的封闭形式表达式。无需取整。陈述最终表达式时无需单位。",
            "solution": "首先根据指定标准验证问题陈述。\n\n### 步骤 1：提取已知条件\n- 冗余温度传感器总数：$n$。\n- 可被攻击者控制的传感器最大数量：$f$。\n- 一个未受损传感器在真实超温情况下未能报告的概率（假阴性率）：$\\beta$。\n- 假阴性率的取值范围是 $\\beta \\in (0,1)$。\n- 假设受损传感器总是抑制警报（即，它们总是不报告超温情况）。\n- 在真实超温条件下，（未受损）传感器的故障是条件独立的。\n- 只要有任何一个传感器报告超温情况，电池管理系统 (BMS) 就会触发警报。\n- 要求的最低检测概率：当存在超温情况时，BMS 触发警报的概率必须至少为 $1-\\beta$。\n\n### 步骤 2：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n- **科学依据**：该问题基于概率论和可靠性工程的标准原理，并应用于电池系统信息物理安全中一个现实且关键的应用。该模型虽然简化（例如，最坏情况下的攻击者，条件独立性），但是一个用于系统设计和分析的合法形式化模型。它不违反任何科学定律。\n- **适定性**：该问题要求找到满足特定概率约束的最小整数 $n$。所有变量和条件都已明确定义，从而可以得出一个可解的不等式。预期存在唯一的最小整数解。\n- **客观性**：语言精确，使用标准技术术语。没有歧义、主观性或观点。\n- **完整性和一致性**：问题提供了构建数学解所需的所有信息（$n$、$f$、$\\beta$、警报逻辑、对抗模型和性能要求）。没有内部矛盾。为了使解有意义，隐含条件是 $n$ 必须是整数且 $n \\ge f$，这与物理设置一致。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。将推导解决方案。\n\n### 解题推导\n设 $A$ 为 BMS 触发警报的事件，设 $O$ 为真实超温情况发生的事件。问题要求检测的条件概率 $P(A|O)$ 满足不等式：\n$$P(A|O) \\geq 1-\\beta$$\n\n警报在*任何*传感器报告高温时触发。计算其互补事件 $A^c$ 的概率会更容易，该事件指*没有*传感器触发警报（即所有传感器都未能报告超温情况）。检测概率可以表示为：\n$$P(A|O) = 1 - P(A^c|O)$$\n\n将此代入要求中可得：\n$$1 - P(A^c|O) \\geq 1-\\beta$$\n$$ -P(A^c|O) \\geq -\\beta$$\n两边乘以 $-1$ 会使不等号反向：\n$$P(A^c|O) \\leq \\beta$$\n这意味着整个系统失效（在实际超温事件中没有触发警报）的概率不得大于 $\\beta$。\n\n问题指定了一个最坏情况的对抗模型，其中最多有 $f$ 个传感器可能被攻击者控制。被控制的传感器总是无法报告警报。为了最大化系统失效概率 $P(A^c|O)$，攻击者将控制允许的最大数量的传感器，即 $f$ 个。因此，我们必须设计系统以满足即使在这种最坏情况下的安全要求。\n\n在这种最坏情况下，我们有：\n- $f$ 个受损的传感器。\n- $n-f$ 个未受损的传感器。\n\n为了使事件 $A^c$ 发生，所有 $n$ 个传感器都必须未能报告超温。\n- 根据定义，一个受损传感器未能报告的概率是 $1$。\n- 根据定义，一个未受损传感器未能报告的概率是 $\\beta$。\n\n考虑到未受损传感器之间故障的条件独立性，*所有* $n-f$ 个传感器都未能报告的概率是它们各自故障概率的乘积，即 $\\beta^{n-f}$。$f$ 个受损传感器未能报告的概率是 $1^f = 1$。\n\n因此，在最坏情况下，系统总失效率为：\n$$P(A^c|O) = (\\text{Prob. all compromised fail}) \\times (\\text{Prob. all uncompromised fail})$$\n$$P(A^c|O) = (1)^f \\times (\\beta)^{n-f} = \\beta^{n-f}$$\n\n现在，我们将此表达式代入我们推导出的要求中：\n$$\\beta^{n-f} \\leq \\beta$$\n这可以写成：\n$$\\beta^{n-f} \\leq \\beta^1$$\n\n为了解出指数 $n-f$，我们考虑底数 $\\beta$ 的性质。问题陈述中说明 $\\beta \\in (0,1)$。对于此区间内的底数，对数函数 $\\log_{\\beta}(x)$ 是一个严格递减的函数。将此对数函数应用于不等式两边需要反转不等号：\n$$\\log_{\\beta}(\\beta^{n-f}) \\geq \\log_{\\beta}(\\beta^1)$$\n$$n-f \\geq 1$$\n$$n \\geq f+1$$\n\n问题要求满足此条件的最小整数 $n$。满足 $n \\geq f+1$ 的最小整数是 $n = f+1$。这个结果是必要的，以确保系统在最坏情况下至少有一个功能正常的传感器，其个体故障概率 $\\beta$ 将满足系统级的故障容忍度 $\\beta$。任何更大的 $n$ 值都将提供额外的冗余，并使故障概率低于 $\\beta$。",
            "answer": "$$\\boxed{f+1}$$"
        },
        {
            "introduction": "仅仅依靠硬件冗余并不足以保证动态控制系统的安全，攻击者同样可以利用控制算法中的漏洞。本练习通过一个具体的仿真任务，让您亲手揭示一个“幼稚”的模型预测控制器（MPC）在面对看似微小的传感器数据篡改攻击时，如何导致灾难性的热安全违规。您将通过编写代码来复现这一安全漏洞，并实施一种修正设计，从而深刻理解在控制回路中依赖可信信息源（如指令信号而非测量信号）对于构建网络物理安全性的重要性。",
            "id": "3903073",
            "problem": "考虑一个电池模块的单集总热模型，该模块受到充电电流的作用，其动态特性源于能量守恒和牛顿冷却定律。热能平衡模型如下。令 $T(t)$ 表示整体温度（单位：开尔文），$I(t)$ 表示充电电流（单位：安培），$R$ 表示等效内阻（单位：欧姆），$h$ 表示有效传热系数（单位：瓦特/开尔文），$C_{\\mathrm{th}}$ 表示集总热容（单位：焦耳/开尔文），以及 $T_{\\mathrm{amb}}$ 表示环境温度（单位：开尔文）。连续时间能量平衡方程为\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = I(t)^2 R - h \\left( T(t) - T_{\\mathrm{amb}} \\right).\n$$\n假设采用时间步长为 $dt$ 秒的前向欧拉时间离散化，则离散时间更新方程为\n$$\nT_{k+1} = T_k + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_k^2 R - h \\left( T_k - T_{\\mathrm{amb}} \\right) \\right),\n$$\n其中 $T_k$ 是离散时间索引 $k$ 处的温度，$I_k$ 是施加的电流（单位：安培）。\n\n一次传感器攻击引入了带偏置的电流测量值。测量电流的模型为\n$$\nI_m = I + b,\n$$\n其中 $I$ 是真实电流，$b$ 是一个偏置（单位：安培），在整个时域内为常数，当 $b  0$ 时，代表一次目标性的低报攻击。\n\n假设一个朴素模型预测控制（MPC）方案，该方案在 $N$ 步的有限时域内选择一个恒定充电电流 $I$，以在满足估计的热安全约束（即预测温度保持在安全上限 $T_{\\max}$ 开尔文以下）的前提下最大化电流。该朴素方案依赖于标称测量值，通过在预测模型中用 $I_m$ 替代 $I$，隐式地假设 $b=0$。也就是说，对于候选的恒定电流 $I$，它使用 $I_m = I + b$ 而不是真实的 $I$ 来预测温度，并接受能使预测温度保持在约束内的最大候选值。\n\n构造一个反例，证明在电流测量中存在一个微小但有针对性的负偏置 $b$ 的情况下，即使预测的温度看起来是安全的，这种朴素的MPC也可能违反真实的热约束。然后，实现一个修正的设计，通过在预测中不再依赖 $I_m$ 并针对偏置大小强制执行鲁棒的约束收紧来消除这种违规，具体方法是用指令电流 $I$ 而不是测量电流 $I_m$ 来评估热约束。修正后的控制器必须选择这样一个最大的恒定电流 $I$，其使用真实指令输入预测的温度在整个时域内都保持在 $T_{\\max}$ 以下。\n\n您的程序必须：\n- 实现离散时间热模型，并模拟在恒定电流 $I$ 下 $N$ 个步长内的温度轨迹。\n- 实现朴素控制器，该控制器通过在模型中使用 $I_m = \\max(I+b,0)$ 进行预测来选择 $I$。\n- 实现修正控制器，该控制器通过在模型中使用真实的指令电流 $I$ 进行预测来选择 $I$。\n- 对于下方的每个测试用例，报告朴素控制器和修正控制器在时域内的最大真实温度，均以开尔文为单位，四舍五入到两位小数。同时报告每个控制器下真实温度相对于 $T_{\\max}$ 的约束违反布尔指标。\n\n所有角度（如果涉及）都必须以弧度为单位，但本题不涉及角度。所有物理单位均采用国际单位制（SI）。最终输出格式必须是单行文本，包含所有测试用例的结果，形式为一个逗号分隔的列表，并用方括号括起来，其中每个测试用例的结果是一个列表，格式为\n$$\n[\\text{max\\_T\\_naive},\\, \\text{max\\_T\\_corrected},\\, \\text{naive\\_violated},\\, \\text{corrected\\_violated}],\n$$\n其中温度以开尔文为单位，布尔值表示是否违反约束。\n\n测试套件参数集：\n- 情况 A（正常情况，无偏置）：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = 0\\,\\mathrm{A}$。\n- 情况 B（反例，目标性小偏置）：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -1.0\\,\\mathrm{A}$。\n- 情况 C（接近阈值的边界偏置）：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -0.5\\,\\mathrm{A}$。\n- 情况 D（高热质量和高散热的边缘情况）：$C_{\\mathrm{th}} = 2000\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 4.0\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_0 = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，$dt = 1\\,\\mathrm{s}$，$N = 1200$，$I_{\\max} = 50\\,\\mathrm{A}$，网格步长 $\\Delta I = 0.5\\,\\mathrm{A}$，$b = -1.0\\,\\mathrm{A}$。\n\n实现说明：\n- 控制器从网格 $\\{0, \\Delta I, 2\\Delta I, \\ldots, I_{\\max}\\}$ 中选择最大的恒定电流 $I$，其预测的温度序列永远不会超过 $T_{\\max}$。朴素预测在加热项中使用 $I_m = \\max(I+b,0)$，而修正预测在加热项中使用指令电流 $I$。\n- 真实的温度演变总是使用指令电流 $I$ 进行模拟（假设执行器未受损），并将最大真实温度与 $T_{\\max}$ 进行比较以计算是否违反约束的布尔值。\n- 以开尔文表示最大温度，四舍五入到两位小数。布尔值必须是精确的逻辑值。\n\n您的程序应生成单行输出，其中包含所有测试用例的结果，格式为方括号括起来的逗号分隔列表，并按 A、B、C、D 的确切顺序排列。例如，输出应类似于\n$$\n[[300.00,300.00,\\text{False},\\text{False}],[\\dots],[\\dots],[\\dots]]\n$$\n但使用每个情况的实际数值。",
            "solution": "该问题要求对一种朴素和一种修正的模型预测控制（MPC）策略在管理电池热状态方面进行关键比较。问题的核心是展示一个安全漏洞，即传感器测量中的一个微小、恶意的偏置如何导致朴素控制器违反安全约束，并实现一个能缓解此漏洞的鲁棒控制器。\n\n物理系统是一个由单集总热模型描述的电池模块。能量平衡由以下微分方程给出：\n$$\nC_{\\mathrm{th}} \\frac{dT}{dt} = I(t)^2 R - h \\left( T(t) - T_{\\mathrm{amb}} \\right)\n$$\n其中 $T(t)$ 是温度，$I(t)$ 是电流，$C_{\\mathrm{th}}$ 是热容，$R$ 是内阻，$h$ 是传热系数，$T_{\\mathrm{amb}}$ 是环境温度。\n\n使用时间步长为 $dt$ 的前向欧拉离散化，离散时间温度更新规则为：\n$$\nT_{k+1} = T_k + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_k^2 R - h \\left( T_k - T_{\\mathrm{amb}} \\right) \\right)\n$$\n这个方程构成了模拟和预测的基础。\n\n一次传感器攻击为电流测量引入了偏置 $b$，使得测量电流 $I_m$ 与真实电流 $I$ 的关系为 $I_m = I + b$。对于低报攻击，$b  0$。\n\n任务是实现并评估两种控制策略。\n\n1.  **温度轨迹模拟：**\n    创建一个核心函数来模拟 $N$ 个步长内的温度演变。该函数接受一个恒定的加热电流 $I_{heat}$（代表焦耳热项 $I^2R$ 中使用的电流）和系统参数，并迭代应用离散时间更新规则来计算温度轨迹 $T_0, T_1, \\dots, T_N$。然后记录该轨迹上的最高温度。这个函数功能多样，既可用于预测未来温度，也可用于模拟真实系统响应。\n\n2.  **朴素控制器逻辑：**\n    朴素控制器旨在从离散网格 $\\{\\Delta I, 2\\Delta I, \\dots, I_{\\max}\\}$ 中选择它认为安全的最大可能恒定充电电流 $I$。它的判断基于一个被传感器攻击所破坏的预测模型。它用测量电流 $I_m = \\max(I+b, 0)$ 替代其内部预测模型中的真实电流。具体来说，对于每个候选电流 $I$，它在加热项中使用 $I_m$ 来预测温度轨迹：\n    $$\n    T_{k+1, \\text{pred}} = T_{k, \\text{pred}} + \\frac{dt}{C_{\\mathrm{th}}}\\left( I_m^2 R - h \\left( T_{k, \\text{pred}} - T_{\\mathrm{amb}} \\right) \\right)\n    $$\n    它检查最大预测温度 $\\max(T_{\\text{pred}})$ 是否保持在安全上限 $T_{\\max}$ 以下。控制器选择满足此条件的最大候选电流 $I$。其缺陷在于它信任带有偏置的测量值来进行关键安全决策。当 $b  0$ 时，$I_m  I$，导致控制器低估了产热量 $I^2 R$，从而可能选择一个实际上不安全的电流。\n\n3.  **修正控制器逻辑：**\n    修正的，或称鲁棒的控制器，纠正了朴素控制器的缺陷。它明白传感器测量可能不可靠，不应用于预测其自身行为的后果。相反，它直接在其预测模型中使用指令（执行）电流 $I$。对于每个候选电流 $I$，它使用 $I$ 本身来预测温度：\n    $$\n    T_{k+1, \\text{pred}} = T_{k, \\text{pred}} + \\frac{dt}{C_{\\mathrm{th}}}\\left( I^2 R - h \\left( T_{k, \\text{pred}} - T_{\\mathrm{amb}} \\right) \\right)\n    $$\n    这个预测准确地反映了施加电流 $I$ 的物理后果。控制器从网格中选择最大的候选电流 $I$，其预测的温度轨迹不超过 $T_{\\max}$。这种设计对传感器测量偏置具有鲁棒性，因为预测回路是基于指令信号闭合的，而不是被破坏的传感器信号。\n\n4.  **评估与反例（情况 B）：**\n    对于每个测试用例，我们首先确定朴素控制器（$I_{\\text{naive}}$）和修正控制器（$I_{\\text{corrected}}$）选择的电流。然后，我们模拟**真实**物理系统对这些电流中每一个的响应。真实响应总是由实际的指令电流 $I$ 决定，而不是 $I_m$。\n    \n    让我们分析测试用例 B：$C_{\\mathrm{th}} = 600\\,\\mathrm{J/K}$，$R = 0.02\\,\\Omega$，$h = 1.5\\,\\mathrm{W/K}$，$T_{\\mathrm{amb}} = 298\\,\\mathrm{K}$，$T_{\\max} = 313\\,\\mathrm{K}$，以及一个偏置 $b = -1.0\\,\\mathrm{A}$。\n    - **修正控制器**：它寻找最大的 $I$，使得真实温度（其趋近于稳态温度 $T_{ss} = I^2 R/h + T_{\\mathrm{amb}}$）保持在 $T_{\\max} = 313\\,\\mathrm{K}$ 以下。条件 $I^2 (0.02)/(1.5) + 298 \\le 313$ 意味着 $I \\le \\sqrt{15 \\times 1.5 / 0.02} = \\sqrt{1125} \\approx 33.54\\,\\mathrm{A}$。在步长为 $\\Delta I = 0.5\\,\\mathrm{A}$ 的网格上，最大的电流是 $I_{\\text{corrected}} = 33.5\\,\\mathrm{A}$。此电流下的真实最高温度接近 $312.96\\,\\mathrm{K}$，是安全的。\n    - **朴素控制器**：它使用 $I_m = I - 1.0$ 来预测安全性。它寻找使预测安全的最大的 $I$。预测的稳态温度是 $(I-1.0)^2 R/h + T_{\\mathrm{amb}} \\le 313\\,\\mathrm{K}$，这意味着 $I-1.0 \\le 33.54\\,\\mathrm{A}$，或 $I \\le 34.54\\,\\mathrm{A}$。控制器会选择满足此条件的最大网格电流，$I_{\\text{naive}} = 34.5\\,\\mathrm{A}$。它*相信*这是安全的，因为它的预测使用的是 $33.5\\,\\mathrm{A}$ 的有效电流。\n    - **真实结果**：系统实际上承受的电流是 $I = 34.5\\,\\mathrm{A}$。真实的稳态温度是 $(34.5)^2 (0.02)/(1.5) + 298 \\approx 313.87\\,\\mathrm{K}$。由于 $N=1200$ 步的时间范围足够长（是热时间常数 $\\tau = C_{th}/h = 400\\,\\mathrm{s}$ 的三倍），温度将超过 $313\\,\\mathrm{K}$ 的限制。这展示了失败：朴素控制器被传感器偏置所欺骗，施加了一个违反安全约束的电流。\n\n最终的程序为所有指定的测试用例实现了这一逻辑，报告了两种控制器下达到的最大真实温度以及相应的约束违反状态。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case A (happy path, no bias)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, 0.0),\n        # Case B (counterexample, targeted small bias)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, -1.0),\n        # Case C (boundary bias near threshold)\n        (600, 0.02, 1.5, 298, 298, 313, 1, 1200, 50, 0.5, -0.5),\n        # Case D (edge case with high thermal mass and cooling)\n        (2000, 0.02, 4.0, 298, 298, 313, 1, 1200, 50, 0.5, -1.0),\n    ]\n\n    def simulate_temperature(I_heat, C_th, R, h, T_amb, T0, dt, N):\n        \"\"\"\n        Simulates the battery temperature over N steps for a constant heating current.\n        \"\"\"\n        T_trajectory = np.zeros(N + 1)\n        T_trajectory[0] = T0\n        T_k = T0\n        for k in range(N):\n            dT_dt = (I_heat**2 * R - h * (T_k - T_amb)) / C_th\n            T_k = T_k + dt * dT_dt\n            T_trajectory[k+1] = T_k\n        return T_trajectory\n\n    def find_current(params, use_naive_prediction):\n        \"\"\"\n        Finds the largest safe current based on the specified prediction model.\n        \"\"\"\n        C_th, R, h, T_amb, T0, T_max, dt, N, I_max, delta_I, b = params\n        \n        candidate_currents = np.arange(I_max, -delta_I, -delta_I)\n        chosen_I = 0.0\n\n        for I_cand in candidate_currents:\n            if use_naive_prediction:\n                I_pred = max(I_cand + b, 0.0)\n            else:\n                I_pred = I_cand\n            \n            predicted_trajectory = simulate_temperature(I_pred, C_th, R, h, T_amb, T0, dt, N)\n            \n            if np.max(predicted_trajectory) = T_max:\n                chosen_I = I_cand\n                break\n        return chosen_I\n\n    results = []\n    for params in test_cases:\n        C_th, R, h, T_amb, T0, T_max, dt, N, I_max, delta_I, b = params\n\n        # 1. Determine current chosen by naive controller\n        I_naive = find_current(params, use_naive_prediction=True)\n        \n        # 2. Determine current chosen by corrected controller\n        I_corrected = find_current(params, use_naive_prediction=False)\n\n        # 3. Simulate TRUE temperature evolution for naive controller's choice\n        true_T_trajectory_naive = simulate_temperature(I_naive, C_th, R, h, T_amb, T0, dt, N)\n        max_T_naive = np.max(true_T_trajectory_naive)\n        naive_violated = max_T_naive > T_max\n\n        # 4. Simulate TRUE temperature evolution for corrected controller's choice\n        true_T_trajectory_corrected = simulate_temperature(I_corrected, C_th, R, h, T_amb, T0, dt, N)\n        max_T_corrected = np.max(true_T_trajectory_corrected)\n        corrected_violated = max_T_corrected > T_max\n\n        results.append(\n            f\"[{max_T_naive:.2f},{max_T_corrected:.2f},{naive_violated},{corrected_violated}]\"\n        )\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在上一节的仿真练习中，我们直观地看到了修正控制器设计的重要性。现在，我们将这一概念提升到严谨的数学层面。本练习要求您运用鲁棒控制理论，推导出一种系统性的方法来保证模型预测控制（MPC）在面对有界限的执行器攻击和模型不确定性时，其安全性约束（如电压和温度）仍然能够被严格满足。通过推导所需的“约束收紧”量，您将学习如何将安全保证从特定场景的修正转化为一个可量化、可证明的通用设计原则，这是设计高可靠性自主系统的核心技能。",
            "id": "3903132",
            "problem": "考虑一个锂离子电池单元的线性化离散时间信息物理模型，该模型围绕一个固定的工作点，用于一个标称开环模型预测控制（MPC）规划器。标称预测模型为\n$$\n\\hat{x}_{k+1} = A \\hat{x}_{k} + B u_{k},\n$$\n其中 $\\hat{x}_{k} \\in \\mathbb{R}^{n}$ 是预测状态，$u_{k} \\in \\mathbb{R}$ 是规划的执行器指令（电流设定点），$A \\in \\mathbb{R}^{n \\times n}$ 和 $B \\in \\mathbb{R}^{n \\times 1}$ 是通过第一性原理线性化和系统辨识获得的已知系统矩阵。受到有界执行器攻击和有界模型不确定性影响的实际闭环系统演化如下\n$$\nx_{k+1} = A x_{k} + B\\left(u_{k} + a_{k}\\right) + w_{k},\n$$\n其中 $x_{k} \\in \\mathbb{R}^{n}$ 是实际状态，$a_{k} \\in \\mathbb{R}$ 是执行器攻击信号，$w_{k} \\in \\mathbb{R}^{n}$ 是一个附加的集总不确定性，用于解释采样间隔内的模型失配和未建模扰动。假设以下先验已知的界限：\n$$\n|a_{k}| \\le \\bar{a}, \\quad \\|w_{k}\\|_{2} \\le \\bar{w}, \\quad \\text{for all } k \\in \\{0,1,\\dots,N-1\\},\n$$\n其中 $\\bar{a} \\ge 0$ 和 $\\bar{w} \\ge 0$ 是给定的常数，且 $\\|\\cdot\\|_{2}$ 表示向量的欧几里得范数和矩阵的诱导$2$-范数。初始条件匹配，$\\hat{x}_{0} = x_{0}$。\n\n我们关注的输出是电芯端电压和核心温度，\n$$\nV_{\\text{cell},k} = c_{V}^{\\top} x_{k}, \\quad T_{k} = c_{T}^{\\top} x_{k},\n$$\n其中 $c_{V}, c_{T} \\in \\mathbb{R}^{n}$ 从线性化和热-电化学耦合中已知。记 $C \\in \\mathbb{R}^{2 \\times n}$ 的行为 $c_{V}^{\\top}$ 和 $c_{T}^{\\top}$，并定义分量式输出约束\n$$\nV_{\\text{cell},k} \\le V_{\\max}, \\quad T_{k} \\le T_{\\max}, \\quad \\text{for all } k \\in \\{1,\\dots,N\\}.\n$$\n\n为了在长度为 $N \\in \\mathbb{N}$ 的时域内，在所有容许的攻击和不确定性序列下鲁棒地强制执行这些约束，标称MPC规划器对预测输出应用一个分量式约束收紧 $\\delta = [\\delta_{V} \\ \\delta_{T}]^{\\top} \\in \\mathbb{R}^{2}_{\\ge 0}$，以使预测满足\n$$\nc_{V}^{\\top} \\hat{x}_{k} \\le V_{\\max} - \\delta_{V}, \\quad c_{T}^{\\top} \\hat{x}_{k} \\le T_{\\max} - \\delta_{T}, \\quad \\text{for all } k \\in \\{1,\\dots,N\\}.\n$$\n根据构造，这种收紧必须保证对于所有 $k \\in \\{1,\\dots,N\\}$ 以及所有容许的序列 $\\{a_{k}\\}$ 和 $\\{w_{k}\\}$，实际输出满足 $V_{\\text{cell},k} \\le V_{\\max}$ 和 $T_{k} \\le T_{\\max}$。\n\n仅从上述定义、欧几里得范数和诱导$2$-范数的性质（三角不等式和次可乘性）以及线性时不变状态转移出发，推导确保在整个时域内鲁棒满足输出约束的最小分量式收紧 $\\delta$。使用诱导$2$-范数，将你的最终答案表示为一个由 $A$、$B$、$c_{V}$、$c_{T}$、$\\bar{a}$、$\\bar{w}$ 和 $N$ 组成的单一闭式解析行向量。无需进行数值评估。将收紧的最终表达式以行矩阵 $\\begin{pmatrix}\\delta_{V}  \\delta_{T}\\end{pmatrix}$ 的形式给出。无需四舍五入，最终表达式中不应包含单位。",
            "solution": "该问题要求推导最小分量式约束收紧 $\\delta = [\\delta_{V} \\ \\delta_{T}]^{\\top}$，以使标称模型预测控制（MPC）规划器能够确保电池系统在执行器攻击和模型不确定性下鲁棒地满足输出约束。\n\n让我们将状态估计误差定义为 $e_{k} = x_{k} - \\hat{x}_{k}$，其中 $x_{k}$ 是实际状态，$\\hat{x}_{k}$ 是预测状态。初始条件为 $x_{0} = \\hat{x}_{0}$，这意味着 $e_{0} = 0$。\n\n误差的动态特性可以通过从实际系统模型中减去标称模型来找到：\n$$\nx_{k+1} - \\hat{x}_{k+1} = \\left(A x_{k} + B(u_{k} + a_{k}) + w_{k}\\right) - \\left(A \\hat{x}_{k} + B u_{k}\\right)\n$$\n$$\ne_{k+1} = A(x_{k} - \\hat{x}_{k}) + B a_{k} + w_{k}\n$$\n$$\ne_{k+1} = A e_{k} + B a_{k} + w_{k}\n$$\n这是一个关于误差 $e_k$ 的线性时不变递推关系。我们可以从初始条件 $e_{0} = 0$ 开始展开这个递推关系：\n$$\ne_{1} = A e_{0} + B a_{0} + w_{0} = B a_{0} + w_{0}\n$$\n$$\ne_{2} = A e_{1} + B a_{1} + w_{1} = A(B a_{0} + w_{0}) + B a_{1} + w_{1} = A B a_{0} + A w_{0} + B a_{1} + w_{1}\n$$\n通过归纳法，在任意时间步 $k \\ge 1$ 时 $e_{k}$ 的通解由下式给出：\n$$\ne_{k} = A^{k} e_{0} + \\sum_{j=0}^{k-1} A^{k-1-j} \\left( B a_{j} + w_{j} \\right)\n$$\n由于 $e_{0}=0$，这简化为：\n$$\ne_{k} = \\sum_{j=0}^{k-1} A^{k-1-j} (B a_{j} + w_{j})\n$$\n\n实际输出为 $y_k = C x_k$，其中 $C$ 的行是 $c_V^\\top$ 和 $c_T^\\top$。分量式约束为 $c_V^\\top x_k \\le V_{\\max}$ 和 $c_T^\\top x_k \\le T_{\\max}$。让我们考虑一个通用输出约束 $c_i^\\top x_k \\le Y_{\\max}$，其中 $i \\in \\{V, T\\}$。\nMPC规划器强制执行收紧后的约束 $c_i^\\top \\hat{x}_k \\le Y_{\\max} - \\delta_i$。\n为了保证鲁棒满足，实际输出必须在所有容许的攻击 $\\{a_k\\}$ 和不确定性 $\\{w_k\\}$ 下满足原始约束。我们可以用预测和误差来表示实际输出：\n$$\nc_i^\\top x_k = c_i^\\top (\\hat{x}_k + e_k) = c_i^\\top \\hat{x}_k + c_i^\\top e_k\n$$\n代入规划器强制执行的收紧后约束：\n$$\nc_i^\\top x_k \\le (Y_{\\max} - \\delta_i) + c_i^\\top e_k\n$$\n为确保 $c_i^\\top x_k \\le Y_{\\max}$ 总是被满足，我们必须有：\n$$\n(Y_{\\max} - \\delta_i) + c_i^\\top e_k \\le Y_{\\max} \\quad \\implies \\quad c_i^\\top e_k \\le \\delta_i\n$$\n这个不等式必须对所有 $k \\in \\{1,\\dots,N\\}$ 和所有容许的攻击序列 $\\{a_j\\}_{j=0}^{k-1}$ 和不确定性序列 $\\{w_j\\}_{j=0}^{k-1}$ 都成立。因此，收紧量 $\\delta_i$ 必须大于或等于在整个时域和所有可能的扰动下 $c_i^\\top e_k$ 的最大可能值。最小的收紧量是满足该条件的最紧边界：\n$$\n\\delta_i = \\max_{k \\in \\{1,\\dots,N\\}} \\left( \\sup_{\\{a_j\\}, \\{w_j\\}} c_i^\\top e_k \\right)\n$$\n其中上确界是针对所有满足 $|a_j| \\le \\bar{a}$ 和 $\\|w_j\\|_2 \\le \\bar{w}$ 的序列。\n\n让我们计算固定 $k$ 时 $c_i^\\top e_k$ 的上确界。代入 $e_k$ 的表达式：\n$$\nc_i^\\top e_k = c_i^\\top \\left( \\sum_{j=0}^{k-1} \\left( A^{k-1-j} B a_j + A^{k-1-j} w_j \\right) \\right) = \\sum_{j=0}^{k-1} \\left( c_i^\\top A^{k-1-j} B a_j + c_i^\\top A^{k-1-j} w_j \\right)\n$$\n由于在每个时间步 $j$，$a_j$ 和 $w_j$ 的选择是独立的，和的上确界是每一项上确界的和：\n$$\n\\sup_{\\{a_j\\},\\{w_j\\}} c_i^\\top e_k = \\sum_{j=0}^{k-1} \\left( \\sup_{|a_j| \\le \\bar{a}} (c_i^\\top A^{k-1-j} B a_j) + \\sup_{\\|w_j\\|_2 \\le \\bar{w}} (c_i^\\top A^{k-1-j} w_j) \\right)\n$$\n对于第一项，$c_i^\\top A^{k-1-j} B$ 是一个标量。表达式 $s \\cdot a_j$ 在 $|a_j| \\le \\bar{a}$ 的约束下，当 $a_j$ 取其最大幅值且与 $s$ 同号时被最大化，其上确界为 $|s| \\bar{a}$。因此：\n$$\n\\sup_{|a_j| \\le \\bar{a}} (c_i^\\top A^{k-1-j} B a_j) = |c_i^\\top A^{k-1-j} B| \\bar{a}\n$$\n对于第二项，设行向量为 $v_j^\\top = c_i^\\top A^{k-1-j}$。我们想求 $\\sup_{\\|w_j\\|_2 \\le \\bar{w}} v_j^\\top w_j$。根据柯西-施瓦茨不等式，$v_j^\\top w_j \\le \\|v_j\\|_2 \\|w_j\\|_2$。当 $w_j$ 与 $v_j$ 对齐时达到最大值，即 $w_j = \\bar{w} \\frac{v_j}{\\|v_j\\|_2}$。上确界为 $\\|v_j\\|_2 \\bar{w}$。向量 $v_j$ 是 $v_j^\\top$ 的转置，所以 $v_j = (A^{k-1-j})^\\top c_i$。因此：\n$$\n\\sup_{\\|w_j\\|_2 \\le \\bar{w}} (c_i^\\top A^{k-1-j} w_j) = \\|(A^{k-1-j})^\\top c_i\\|_2 \\bar{w}\n$$\n结合这些结果，输出 $i$ 在时间 $k$ 的最坏情况偏差为：\n$$\nd_{i,k} \\triangleq \\sup_{\\{a_j\\},\\{w_j\\}} c_i^\\top e_k = \\sum_{j=0}^{k-1} \\left( |c_i^\\top A^{k-1-j} B| \\bar{a} + \\|(A^{k-1-j})^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n为了简化表达式，让我们将求和索引更改为 $m = k-1-j$。当 $j$ 从 $0$ 到 $k-1$ 时，$m$ 从 $k-1$ 到 $0$。\n$$\nd_{i,k} = \\sum_{m=0}^{k-1} \\left( |c_i^\\top A^m B| \\bar{a} + \\|(A^m)^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n最小收紧量 $\\delta_i$ 必须对所有 $k \\in \\{1,\\dots,N\\}$ 有效，所以 $\\delta_i = \\max_{k \\in \\{1,\\dots,N\\}} d_{i,k}$。\n求和中的项是非负的，因为 $\\bar{a} \\ge 0$，$\\bar{w} \\ge 0$，绝对值是非负的，范数也是非负的。因此，$d_{i,k}$ 是一个关于 $k$ 的单调非减函数：\n$$\nd_{i, k+1} = d_{i,k} + \\left( |c_i^\\top A^k B| \\bar{a} + \\|(A^k)^\\top c_i\\|_2 \\bar{w} \\right) \\ge d_{i,k}\n$$\n$d_{i,k}$ 在时域 $\\{1,\\dots,N\\}$ 上的最大值必然出现在最后一步，即 $k=N$。\n$$\n\\delta_i = d_{i,N} = \\sum_{m=0}^{N-1} \\left( |c_i^\\top A^m B| \\bar{a} + \\|(A^m)^\\top c_i\\|_2 \\bar{w} \\right)\n$$\n将此通用公式应用于电压（$i=V$）和温度（$i=T$）约束，我们得到：\n$$\n\\delta_V = \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_V^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_V\\|_2 \\right)\n$$\n$$\n\\delta_T = \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_T^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_T\\|_2 \\right)\n$$\n最终答案要求以行矩阵 $\\begin{pmatrix} \\delta_V  \\delta_T \\end{pmatrix}$ 的形式给出。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_V^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_V\\|_2 \\right)  \\sum_{m=0}^{N-1} \\left( \\bar{a} |c_T^\\top A^m B| + \\bar{w} \\|(A^m)^\\top c_T\\|_2 \\right) \\end{pmatrix}}\n$$"
        }
    ]
}