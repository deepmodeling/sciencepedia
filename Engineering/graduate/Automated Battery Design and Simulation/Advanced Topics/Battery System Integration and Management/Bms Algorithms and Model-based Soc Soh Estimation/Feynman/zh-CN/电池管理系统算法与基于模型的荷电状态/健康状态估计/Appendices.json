{
    "hands_on_practices": [
        {
            "introduction": "电池等物理系统本质上由连续时间的微分方程描述。然而，电池管理系统（BMS）是一个在离散时间步长上运行的数字系统。本练习旨在弥合这一差距，通过对电池模型的核心组件执行精确离散化，确保数字模型能够完美地再现采样点之间的连续物理过程 ()。这是任何高保真度基于模型的算法都必须掌握的关键第一步。",
            "id": "3896581",
            "problem": "考虑用于电池管理系统（BMS）中荷电状态（SOC）和健康状态（SOH）估计的等效电路模型（ECM）的单个极化支路。极化电压状态表示为 $v_{p}(t)$，支路电阻和电容分别为 $R_{p} > 0$ 和 $C_{p} > 0$，施加的电流为 $i(t)$，符号约定为正的 $i(t)$ 对应于放电。极化电压的连续时间动态由以下线性时不变常微分方程给出\n$$\n\\frac{d}{dt} v_{p}(t) = -\\frac{1}{R_{p} C_{p}}\\, v_{p}(t) + \\frac{1}{C_{p}}\\, i(t).\n$$\n设采样周期为 $T_{s} > 0$，并为整数 $k \\geq 0$ 定义采样时刻 $t_{k} = k T_{s}$。假设在每个采样区间内对输入电流采用零阶保持（ZOH），即对于所有 $t \\in [t_{k}, t_{k+1})$，有 $i(t) = i_{k}$。仅使用线性时不变系统的基本性质和矩阵指数，推导在零阶保持假设下将 $v_{p,k} \\triangleq v_{p}(t_{k})$ 和 $i_{k}$ 映射到 $v_{p,k+1} \\triangleq v_{p}(t_{k+1})$ 的精确离散时间状态转移。将您的最终结果表示为包含 $v_{p,k}$、$i_{k}$、$R_{p}$、$C_{p}$ 和 $T_{s}$ 的单一闭式解析表达式。无需进行数值评估。最终表达式中不要包含物理单位。最终答案必须是单一表达式。",
            "solution": "推导给定连续时间系统的精确离散时间状态转移这一问题被确定是有效的。该问题在科学上基于电路理论和线性时不变（LTI）系统原理，问题设定良好，信息充分，可得出唯一解，并以客观、正式的语言表述。因此，我们可以进行推导。\n\n极化电压 $v_{p}(t)$ 的连续时间动态由以下线性常微分方程（ODE）给出：\n$$\n\\frac{d}{dt} v_{p}(t) = -\\frac{1}{R_{p} C_{p}}\\, v_{p}(t) + \\frac{1}{C_{p}}\\, i(t)\n$$\n这是一个标量LTI状态空间模型，形式为 $\\frac{d}{dt}x(t) = Ax(t) + Bu(t)$，其中状态为 $x(t) = v_{p}(t)$，输入为 $u(t) = i(t)$，系统矩阵为标量：\n$$\nA = -\\frac{1}{R_{p} C_{p}}\n$$\n$$\nB = \\frac{1}{C_{p}}\n$$\n问题要求找到在时刻 $t_{k+1}$ 的状态与时刻 $t_k$ 的状态之间的关系，其中 $t_{k+1} = t_k + T_s$。在时间区间 $[t_k, t_{k+1}]$ 上，LTI系统的一般解由常数变易法公式给出，该公式利用了矩阵指数（在此情况下为标量指数）：\n$$\nx(t_{k+1}) = e^{A(t_{k+1} - t_k)} x(t_k) + \\int_{t_k}^{t_{k+1}} e^{A(t_{k+1} - \\tau)} B u(\\tau) \\,d\\tau\n$$\n代入问题特定的变量和定义 $x(t_k) = v_{p,k}$、$u(\\tau) = i(\\tau)$ 和 $t_{k+1} - t_k = T_s$，我们得到：\n$$\nv_{p,k+1} = e^{A T_s} v_{p,k} + \\int_{t_k}^{t_{k+1}} e^{A(t_{k+1} - \\tau)} B i(\\tau) \\,d\\tau\n$$\n问题指定了对输入电流采用零阶保持（ZOH），这意味着电流 $i(t)$ 在采样区间内是恒定的，即对于所有 $t \\in [t_{k}, t_{k+1})$，有 $i(t) = i_k$。由于 $B$ 和 $i_k$ 在积分区间内是常数，它们可以移到积分号外：\n$$\nv_{p,k+1} = e^{A T_s} v_{p,k} + \\left( \\int_{t_k}^{t_{k+1}} e^{A(t_{k+1} - \\tau)} \\,d\\tau \\right) B i_k\n$$\n为了计算该积分，我们进行变量替换。令 $s = t_{k+1} - \\tau$。那么，$ds = -d\\tau$。积分上下限从 $\\tau = t_k$ 变为 $s = t_{k+1} - t_k = T_s$，从 $\\tau = t_{k+1}$ 变为 $s = t_{k+1} - t_{k+1} = 0$。该积分变为：\n$$\n\\int_{t_k}^{t_{k+1}} e^{A(t_{k+1} - \\tau)} \\,d\\tau = \\int_{T_s}^{0} e^{As} (-ds) = \\int_{0}^{T_s} e^{As} \\,ds\n$$\n对于可逆的标量或矩阵 $A$，指数函数的积分为 $\\int e^{As} ds = A^{-1}e^{As}$。由于 $R_p > 0$ 且 $C_p > 0$，我们的标量 $A = -1/(R_p C_p)$ 非零，因此是可逆的。于是，我们可以计算该定积分：\n$$\n\\int_{0}^{T_s} e^{As} \\,ds = \\left[ A^{-1} e^{As} \\right]_{0}^{T_s} = A^{-1} (e^{A T_s} - e^{A \\cdot 0}) = A^{-1} (e^{A T_s} - 1)\n$$\n将此结果代回到 $v_{p,k+1}$ 的表达式中：\n$$\nv_{p,k+1} = e^{A T_s} v_{p,k} + A^{-1} (e^{A T_s} - 1) B i_k\n$$\n这是在零阶保持下单输入LTI系统精确离散化的一般形式。我们现在代入 $A$、$B$ 和 $A^{-1}$ 的具体表达式：\n$$\nA = -\\frac{1}{R_{p} C_{p}}\n$$\n$$\nB = \\frac{1}{C_{p}}\n$$\n$$\nA^{-1} = -R_{p} C_{p}\n$$\n乘以 $v_{p,k}$ 的项是：\n$$\ne^{A T_s} = \\exp\\left(-\\frac{T_s}{R_p C_p}\\right)\n$$\n乘以 $i_k$ 的项是：\n$$\nA^{-1} (e^{A T_s} - 1) B = (-R_p C_p) \\left( \\exp\\left(-\\frac{T_s}{R_p C_p}\\right) - 1 \\right) \\left( \\frac{1}{C_p} \\right)\n$$\n简化该系数可得：\n$$\n-R_p \\left( \\exp\\left(-\\frac{T_s}{R_p C_p}\\right) - 1 \\right) = R_p \\left( 1 - \\exp\\left(-\\frac{T_s}{R_p C_p}\\right) \\right)\n$$\n综合这些结果，我们得到离散时间状态转移的最终闭式解析表达式：\n$$\nv_{p,k+1} = \\exp\\left(-\\frac{T_s}{R_p C_p}\\right) v_{p,k} + R_p \\left( 1 - \\exp\\left(-\\frac{T_s}{R_p C_p}\\right) \\right) i_k\n$$\n该表达式精确地将时间步 $k$ 的状态 $v_{p,k}$ 和输入 $i_k$ 映射到时间步 $k+1$ 的状态 $v_{p,k+1}$。",
            "answer": "$$\n\\boxed{\\exp\\left(-\\frac{T_{s}}{R_{p} C_{p}}\\right) v_{p,k} + R_{p} \\left( 1 - \\exp\\left(-\\frac{T_{s}}{R_{p} C_{p}}\\right) \\right) i_{k}}\n$$"
        },
        {
            "introduction": "一旦建立了离散时间模型，我们就可以用它来估计电池的内部状态。扩展卡尔曼滤波器（EKF）是实现此目的的强大工具，但它要求对系统的测量模型进行线性化。本练习专注于推导*测量雅可比矩阵* ()，这是告诉EKF内部状态（如SOC、温度和退化参数）的变化如何影响传感器测量（如电压）的关键一步。",
            "id": "3896602",
            "problem": "考虑一个电池管理系统（BMS）中的锂离子电池，该系统采用扩展卡尔曼滤波器（EKF）进行基于模型的荷电状态（SOC）和健康状态（SOH）估计。该电池由一个一阶戴维南等效电路模型与一个集总热模型耦合描述。状态向量定义为 $$\\mathbf{x} = \\begin{pmatrix} z  v_{p}  T_{c}  T_{s}  R_{0}  b_{i} \\end{pmatrix}^{\\top},$$ 其中 $z$ 是荷电状态（$0 \\le z \\le 1$），$v_{p}$ 是电阻-电容（RC）网络上的极化电压，$T_{c}$ 是核心温度，$T_{s}$ 是表面温度，$R_{0}$ 是代表SOH相关参数的欧姆内阻，$b_{i}$ 是电流传感器偏差。EKF的输入是测量电流 $$u = i_{m},$$ 其中真实电流通过以下关系与测量电流相关联：$$i = i_{m} - b_{i}.$$ 端电压由下式给出 $$V = \\mathrm{OCV}(z, T_{c}) - R_{0}\\,i - v_{p},$$ 其中 $\\mathrm{OCV}(z, T_{c})$ 表示作为 $z$ 和 $T_{c}$ 函数的开路电压（OCV），并假设对每个参数都是可微的。多传感器测量向量结合了电压、由电流推算的SOC和两个温度，表示为 $$\\mathbf{y} = \\begin{pmatrix} V_{m} \\\\ T_{c,m} \\\\ T_{s,m} \\\\ z_{cc,m} \\end{pmatrix},$$ 具有以下测量关系：\n- 端电压传感器：$$V_{m} = \\mathrm{OCV}(z, T_{c}) - R_{0}\\,(u - b_{i}) - v_{p} + n_{v},$$ \n- 核心温度传感器：$$T_{c,m} = T_{c} + n_{Tc},$$ \n- 表面温度传感器：$$T_{s,m} = T_{s} + n_{Ts},$$ \n- 库仑计SOC传感器：$$z_{cc,m} = z + n_{z},$$ 其中 $n_{v}$、$n_{Tc}$、$n_{Ts}$ 和 $n_{z}$ 是零均值测量噪声。额定容量 $Q_{n}$ 和库仑效率 $\\eta$ 是已知的常数，用于从 $i_{m}$ 生成 $z_{cc,m}$ 的独立库仑计数过程中，但除了通过 $z_{cc,m}$ 之外，它们不显式地进入测量函数。\n\n从上述基于物理的模型和定义出发，构建EKF测量函数 $$\\mathbf{h}(\\mathbf{x}, u) = \\begin{pmatrix} h_{1}(\\mathbf{x},u) \\\\ h_{2}(\\mathbf{x},u) \\\\ h_{3}(\\mathbf{x},u) \\\\ h_{4}(\\mathbf{x},u) \\end{pmatrix}$$，该函数将状态映射到期望的测量值，并推导测量雅可比矩阵 $$\\mathbf{H}(\\mathbf{x},u) = \\frac{\\partial \\mathbf{h}}{\\partial \\mathbf{x}}.$$ 请用一个单一的封闭形式解析矩阵表示您的最终答案，该矩阵以 $z$、$T_{c}$、$v_{p}$、$R_{0}$、$b_{i}$、$u$ 以及 $\\mathrm{OCV}$ 对其参数的符号偏导数表示。不要为 $\\mathrm{OCV}(z,T_{c})$ 假设任何特定的参数形式。最终答案必须是单一的解析表达式。不需要四舍五入。最终表达式不需要单位。",
            "solution": "扩展卡尔曼滤波器（EKF）的测量模型通过函数 $\\mathbf{h}(\\mathbf{x},u)$ 将状态向量与测量的期望值关联起来，其中测量雅可比矩阵 $\\mathbf{H}(\\mathbf{x},u)$ 定义为 $\\mathbf{h}$ 相对于状态 $\\mathbf{x}$ 的偏导数矩阵。我们从给定的基本定义开始。\n\n该系统在电气域采用戴维南等效电路模型。端电压 $V$ 满足 \n$$V = \\mathrm{OCV}(z,T_{c}) - R_{0}\\,i - v_{p},$$ \n这是基于基尔霍夫电压定律应用于OCV源、欧姆内阻 $R_{0}$ 和由极化电压 $v_{p}$ 表示的RC极化支路的串联连接。真实电流 $i$ 通过传感器偏差状态 $b_{i}$ 与测量电流 $i_{m}$ 相关联：\n$$i = i_{m} - b_{i} = u - b_{i},$$\n其中 $u$ 被选为测量电流输入。\n\n热域由集总温度 $T_{c}$ 和 $T_{s}$ 表示，它们由各自的传感器直接测量。多传感器融合还利用了由库仑计数产生的辅助SOC测量。库仑计数通过SOC作为归一化电荷的基本定义来积分测量电流以估计SOC：\n$$\\frac{d z}{d t} = -\\frac{\\eta}{Q_{n}}\\, i,$$\n其中 $Q_{n}$ 是额定容量，$\\eta$ 是库仑效率。一个外部过程（在EKF测量函数之外）对此进行积分以产生 $z_{cc,m}$，我们将其视为受噪声污染的 $z$ 的直接测量。因此，在EKF测量方程中，$z_{cc,m}$ 映射到 $z$。\n\n因此，测量函数的组成部分是：\n- 端电压测量模型（为确定性映射排除显式噪声）：\n$$h_{1}(\\mathbf{x},u) = \\mathrm{OCV}(z, T_{c}) - R_{0}\\,(u - b_{i}) - v_{p}.$$\n- 核心温度测量模型：\n$$h_{2}(\\mathbf{x},u) = T_{c}.$$\n- 表面温度测量模型：\n$$h_{3}(\\mathbf{x},u) = T_{s}.$$\n- 库仑计SOC测量模型：\n$$h_{4}(\\mathbf{x},u) = z.$$\n\n我们现在推导测量雅可比矩阵 $\\mathbf{H}(\\mathbf{x},u) = \\frac{\\partial \\mathbf{h}}{\\partial \\mathbf{x}}$。状态向量是 $\\mathbf{x} = \\begin{pmatrix} z  v_{p}  T_{c}  T_{s}  R_{0}  b_{i} \\end{pmatrix}^{\\top}$，因此我们计算每个 $h_{i}$ 相对于每个状态分量的偏导数。\n\n对于 $h_{1}(\\mathbf{x},u)$：\n- $\\frac{\\partial h_{1}}{\\partial z} = \\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial z}$，根据应用于 $\\mathrm{OCV}$ 的链式法则。\n- $\\frac{\\partial h_{1}}{\\partial v_{p}} = -1$，因为 $h_{1}$ 线性地包含 $-v_{p}$。\n- $\\frac{\\partial h_{1}}{\\partial T_{c}} = \\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial T_{c}}$，根据链式法则。\n- $\\frac{\\partial h_{1}}{\\partial T_{s}} = 0$，因为 $h_{1}$ 不依赖于 $T_{s}$。\n- $\\frac{\\partial h_{1}}{\\partial R_{0}} = -(u - b_{i})$，因为 $h_{1}$ 线性地包含 $-R_{0}(u - b_{i})$。\n- $\\frac{\\partial h_{1}}{\\partial b_{i}} = R_{0}$，因为 $\\frac{\\partial}{\\partial b_{i}}[-R_{0}(u - b_{i})] = R_{0}$。\n\n对于 $h_{2}(\\mathbf{x},u) = T_{c}$：\n- $\\frac{\\partial h_{2}}{\\partial z} = 0$，$\\frac{\\partial h_{2}}{\\partial v_{p}} = 0$，$\\frac{\\partial h_{2}}{\\partial T_{c}} = 1$，$\\frac{\\partial h_{2}}{\\partial T_{s}} = 0$，$\\frac{\\partial h_{2}}{\\partial R_{0}} = 0$，$\\frac{\\partial h_{2}}{\\partial b_{i}} = 0$。\n\n对于 $h_{3}(\\mathbf{x},u) = T_{s}$：\n- $\\frac{\\partial h_{3}}{\\partial z} = 0$，$\\frac{\\partial h_{3}}{\\partial v_{p}} = 0$，$\\frac{\\partial h_{3}}{\\partial T_{c}} = 0$，$\\frac{\\partial h_{3}}{\\partial T_{s}} = 1$，$\\frac{\\partial h_{3}}{\\partial R_{0}} = 0$，$\\frac{\\partial h_{3}}{\\partial b_{i}} = 0$。\n\n对于 $h_{4}(\\mathbf{x},u) = z$：\n- $\\frac{\\partial h_{4}}{\\partial z} = 1$，$\\frac{\\partial h_{4}}{\\partial v_{p}} = 0$，$\\frac{\\partial h_{4}}{\\partial T_{c}} = 0$，$\\frac{\\partial h_{4}}{\\partial T_{s}} = 0$，$\\frac{\\partial h_{4}}{\\partial R_{0}} = 0$，$\\frac{\\partial h_{4}}{\\partial b_{i}} = 0$。\n\n将这些偏导数收集到雅可比矩阵中，测量顺序为 $(V_{m}, T_{c,m}, T_{s,m}, z_{cc,m})$，状态顺序为 $(z, v_{p}, T_{c}, T_{s}, R_{0}, b_{i})$，我们得到：\n$$\n\\mathbf{H}(\\mathbf{x},u) \n= \n\\begin{pmatrix}\n\\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial z}  -1  \\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial T_{c}}  0  -(u - b_{i})  R_{0} \\\\\n0  0  1  0  0  0 \\\\\n0  0  0  1  0  0 \\\\\n1  0  0  0  0  0\n\\end{pmatrix}.\n$$\n\n这个 $\\mathbf{H}(\\mathbf{x},u)$ 就是在给定模型假设下，用于电压、由电流推算的SOC和温度测量的多传感器融合所需的EKF测量雅可比矩阵。它以封闭形式表示，包含 $\\mathrm{OCV}$ 的符号偏导数，不假设 $\\mathrm{OCV}$ 的任何特定参数化形式，并且与基于物理的测量定义一致。",
            "answer": "$$\\boxed{\n\\begin{pmatrix}\n\\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial z}  -1  \\frac{\\partial\\, \\mathrm{OCV}(z,T_{c})}{\\partial T_{c}}  0  -(u - b_{i})  R_{0} \\\\\n0  0  1  0  0  0 \\\\\n0  0  0  1  0  0 \\\\\n1  0  0  0  0  0\n\\end{pmatrix}\n}$$"
        },
        {
            "introduction": "构建模型和估算器并非终点；我们必须验证我们的模型是否准确地捕捉了电池的动态特性。这可以通过分析*残差*（模型预测电压与实际测量电压之差）来完成。本编程练习将实现一个统计检验（Ljung-Box检验），以检查残差是否为“白噪声”()，白噪声是模型拟合良好的标志。如果残差不是白噪声，则意味着我们的模型遗漏了某些底层物理原理，而残差本身就为模型的改进提供了线索。",
            "id": "3896580",
            "problem": "电池管理系统 (BMS) 依赖于基于模型的电荷状态 (SOC) 和健康状态 (SOH) 估计，这需要验证拟合模型的残差是否具有白性和序列独立性。考虑一个等效电路模型 (ECM)，其具有一个从混合脉冲功率特性 (HPPC) 电流-电压数据中辨识出的单个戴维南支路。该 ECM 使用线性的开路电压图和一个电阻-电容极化支路。验证任务是使用从第一性原理推导出的 Portmanteau 假设检验来评估残差的白性和独立性。\n\n假设一个单体电池 ECM 包含以下元件。在采样间隔为 $\\Delta t$ 的离散时间索引 $k$ 处，端电压 $U(t)$ 满足\n$$U[k] = U_{\\mathrm{oc}}(z[k]) - R_0 I[k] - v_{\\mathrm{rc}}[k],$$\n其中 $I[k]$ 是电流（放电为正），$R_0$ 是欧姆内阻，$v_{\\mathrm{rc}}[k]$ 是极化支路电压，$U_{\\mathrm{oc}}(z)$ 是作为 SOC $z$ 的函数的开路电压图。SOC 服从库仑计数，\n$$z[k] = z[k-1] - \\frac{I[k-1]\\Delta t}{Q \\cdot 3600},$$\n其中 $Q$ 是以安培小时为单位的标称容量。极化支路服从一阶动态特性，\n$$v_{\\mathrm{rc}}[k] = a \\, v_{\\mathrm{rc}}[k-1] + b \\, I[k-1],$$\n对于常数 $a$ 和 $b$，它们依赖于电阻-电容支路和 $\\Delta t$。开路电压图是线性的，\n$$U_{\\mathrm{oc}}(z) = U_{\\min} + k_{\\mathrm{oc}} z.$$\n残差序列 $r[k]$ 定义为\n$$r[k] = U_{\\mathrm{meas}}[k] - U[k],$$\n其中 $U_{\\mathrm{meas}}[k]$ 是测量的端电压。\n\n为验证残差 $r[k]$ 的白性和序列独立性，设计并实现一个基于样本自相关函数和 Portmanteau 统计量的渐近分布结果的统计检验。该假设检验应在给定的显著性水平下，决定是否拒绝残差为白性、序列独立的零假设。您必须从样本均值和样本自相关的定义出发推导该检验，并使用已知的渐近分布来计算 $p$-值。\n\n使用以下科学上真实且自洽的参数化、单位和信号。所有物理量均以国际单位制 (SI) 表示，除非另有说明，并且不使用角度。\n\n- 采样间隔：$\\Delta t = 1\\,\\mathrm{s}$。\n- 仿真长度：$N = 1200$ 个样本。\n- 标称容量：$Q = 2.5\\,\\mathrm{Ah}$。\n- 欧姆内阻：$R_0 = 0.01\\,\\Omega$。\n- 极化电阻：$R_1 = 0.015\\,\\Omega$。\n- 极化时间常数：$\\tau_1 = 100\\,\\mathrm{s}$。\n- 开路电压参数：$U_{\\min} = 3.6\\,\\mathrm{V}$，$k_{\\mathrm{oc}} = 0.4\\,\\mathrm{V}$ 每单位 SOC。\n- 初始 SOC：$z[0] = 0.8$（无量纲）。\n- 戴维南支路系数满足 $a = \\exp\\!\\left(-\\frac{\\Delta t}{\\tau_1}\\right)$ 和 $b = R_1 \\left(1 - a\\right)$。\n\n构建一个类似 HPPC 的电流剖面 $I[k]$，包含静置段和脉冲：\n- 以 $60$ 个样本的静置 $I[k] = 0\\,\\mathrm{A}$ 开始，\n- 然后施加一个 $10$ 个样本的放电脉冲，电流为 $I[k] = 5\\,\\mathrm{A}$，\n- 接着是 $60$ 个样本的静置，\n- 然后是一个 $10$ 个样本的充电脉冲，电流为 $I[k] = -3\\,\\mathrm{A}$，\n- 重复此模式直至达到 $N$ 个样本；根据需要截断最后一个段。\n\n基于此，为三个测试案例定义测量电压序列：\n- 案例 A（理想辨识）：$U_{\\mathrm{meas}}[k] = U[k]$。残差完全为零。\n- 案例 B（有色残差）：$U_{\\mathrm{meas}}[k] = U[k] + A_{\\sin} \\sin\\!\\left(2\\pi f k \\Delta t\\right)$，其中 $A_{\\sin} = 0.03\\,\\mathrm{V}$ 且 $f = 0.02\\,\\mathrm{Hz}$。\n- 案例 C（白残差）：$U_{\\mathrm{meas}}[k] = U[k] + \\epsilon[k]$，其中 $\\epsilon[k]$ 是一个独立同分布的高斯序列，均值为零，标准差为 $\\sigma = 0.01\\,\\mathrm{V}$。为保证可复现性，使用固定的随机种子。\n\n您的程序必须：\n- 使用指定的参数和电流剖面模拟 ECM，\n- 计算每个案例的残差 $r[k]$，\n- 使用最大滞后 $h = 20$，实现一个序列独立性的 Ljung-Box 检验，\n- 在显著性水平 $\\alpha = 0.05$ 下评估残差为白性、序列独立的零假设，\n- 对于方差可忽略的残差序列，将其视为白噪声（返回 p 值为 1）。\n\n您的测试套件是上述描述的三个案例 A、B 和 C。对于每个案例，您的程序必须生成一个布尔值，指示在给定的 $\\alpha$ 水平下是否不拒绝零假设（即，残差是否被接受为白性和序列独立）。最终输出必须是单行，包含一个逗号分隔的 Python 列表，其中有三个布尔值，并用方括号括起，顺序为 $[\\text{案例 A}, \\text{案例 B}, \\text{案例 C}]$（例如，`[True,False,True]`）。不得打印任何其他文本。",
            "solution": "该问题要求设计并实现一个统计检验，以验证电池等效电路模型 (ECM) 残差的白性和序列独立性。这是系统辨识中的一项基本任务，旨在确保模型已捕捉所有系统性动态，且剩余误差是不可预测的噪声。解决方案包括三个阶段：模拟 ECM，从第一性原理定义和推导统计检验，以及将该检验应用于指定的案例。\n\n首先，我们建立电池单元的数学模型。问题提供了一个一阶戴维南 ECM。在离散时间索引 $k$ 处，系统的状态由电荷状态 (SOC) $z[k]$ 和极化电压 $v_{\\mathrm{rc}}[k]$ 描述。状态更新方程由下式给出：\n$$z[k] = z[k-1] - \\frac{I[k-1]\\Delta t}{Q \\cdot 3600}$$\n$$v_{\\mathrm{rc}}[k] = a \\, v_{\\mathrm{rc}}[k-1] + b \\, I[k-1]$$\n此处，$I[k]$ 是在时间 $k$ 施加的电流，$\\Delta t$ 是采样间隔，$Q$ 是标称容量。系数 $a$ 和 $b$ 从极化支路的物理参数导出：$a = \\exp(-\\Delta t / \\tau_1)$ 和 $b = R_1 (1 - a)$，其中 $\\tau_1$ 是极化时间常数，$R_1$ 是极化电阻。SOC 更新方程代表库仑计数，而极化电压方程描述了一阶离散时间响应。\n\n模型的输出，即端电压 $U[k]$，是当前状态和当前输入的代数函数：\n$$U[k] = U_{\\mathrm{oc}}(z[k]) - R_0 I[k] - v_{\\mathrm{rc}}[k]$$\n其中 $R_0$ 是欧姆内阻，$U_{\\mathrm{oc}}(z[k])$ 是开路电压 (OCV)，建模为 SOC 的线性函数：\n$$U_{\\mathrm{oc}}(z) = U_{\\min} + k_{\\mathrm{oc}} z$$\n为了模拟该模型，我们首先为所有时间步 $k \\in [0, N-1]$（其中 $N=1200$）生成指定的混合脉冲功率特性 (HPPC) 电流剖面 $I[k]$。然后，从初始条件 $z[0]=0.8$ 和 $v_{\\mathrm{rc}}[0]=0$（假设电池从静置状态开始）出发，我们迭代计算状态 $z[k]$ 和 $v_{\\mathrm{rc}}[k]$ 以及相应的模型电压 $U[k]$，其中 $k=1, \\dots, N-1$。\n\n问题的核心是验证模型残差 $r[k] = U_{\\mathrm{meas}}[k] - U[k]$，其中 $U_{\\mathrm{meas}}[k]$ 是测量的电压。目标是检验零假设 $H_0$，即残差序列 $r[k]$ 是一个白噪声过程。白噪声过程是一个均值为零、方差恒定的不相关随机变量序列。如果 $H_0$ 成立，则认为模型是充分的。\n\n为了检验序列相关性，我们使用基于样本自相关函数 (ACF) 的 Portmanteau 检验。首先，我们计算残差的样本均值：\n$$\\bar{r} = \\frac{1}{N} \\sum_{k=1}^{N} r[k]$$\n接下来，我们计算滞后为 $j$ 的样本自协方差 $\\hat{\\gamma}_j$ 和相应的样本自相关 $\\hat{\\rho}_j$：\n$$\\hat{\\gamma}_j = \\frac{1}{N} \\sum_{k=j+1}^{N} (r[k] - \\bar{r})(r[k-j] - \\bar{r})$$\n$$\\hat{\\rho}_j = \\frac{\\hat{\\gamma}_j}{\\hat{\\gamma}_0}$$\n其中 $\\hat{\\gamma}_0$ 是残差的样本方差（由 $N$ 归一化）。\n\nLjung-Box 检验提供了一个统计量 $Q_{\\mathrm{LB}}$，它汇总了直到最大滞后 $h$ 的自相关性：\n$$Q_{\\mathrm{LB}} = N(N+2) \\sum_{j=1}^{h} \\frac{\\hat{\\rho}_j^2}{N-j}$$\n在零假设 $H_0$ 下，$Q_{\\mathrm{LB}}$ 统计量渐近服从自由度为 $h$ 的卡方 ($\\chi^2$) 分布。对于此问题，最大滞后指定为 $h=20$。\n\n统计决策通过计算 $p$-值来做出，$p$-值是在假设 $H_0$ 为真的情况下，观测到至少与计算出的检验统计量一样大的值的概率：\n$$p\\text{-value} = P(\\chi^2(h) > Q_{\\mathrm{LB}})$$\n我们将此 $p$-值与预定义的显著性水平 $\\alpha=0.05$ 进行比较。如果 $p$-值小于 $\\alpha$，我们拒绝零假设，结论是残差存在序列相关性（即非白噪声）。如果 $p$-值大于或等于 $\\alpha$，我们不拒绝零假设，接受残差为白性且序列独立。\n\n该程序应用于三个案例：\n1.  **案例 A（理想）：** 残差对于所有 $k$ 均为 $r[k] = 0$。方差为零。根据问题对可忽略方差序列的规定，这些残差被视为白噪声。这对应于 $p$-值为 $1$，因此不拒绝零假设。\n2.  **案例 B（有色残差）：** 残差是一个确定性的正弦信号，$r[k] = A_{\\sin} \\sin(2\\pi f k \\Delta t)$。这样的信号具有高度的自相关性。我们预期样本自相关 $\\hat{\\rho}_j$ 会很大，导致一个大的 $Q_{\\mathrm{LB}}$ 统计量和一个非常小的 $p$-值 ($p  \\alpha$)，从而拒绝 $H_0$。\n3.  **案例 C（白残差）：** 残差是一个均值为零的独立同分布高斯序列。这是白噪声的典型例子。Ljung-Box 检验就是为此场景设计的，我们预期它不会拒绝零假设（即 $p \\geq \\alpha$）。\n\n最终的程序实现了这整个工作流程：它模拟模型，为三个案例中的每一个生成残差，计算 Ljung-Box 统计量和相应的 $p$-值，并为每个案例返回一个布尔值，指示是否不拒绝零假设。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import chi2\n\ndef portmanteau_test(residuals: np.ndarray, h: int, alpha: float) - bool:\n    \"\"\"\n    Performs a Ljung-Box portmanteau test for whiteness of a residual series.\n\n    Args:\n        residuals: The sequence of residuals to test.\n        h: The maximum lag for the test.\n        alpha: The significance level.\n\n    Returns:\n        True if the null hypothesis (residuals are white noise) is not rejected,\n        False otherwise.\n    \"\"\"\n    N = len(residuals)\n\n    # Per instruction: for negligible variance, treat as white.\n    if np.std(residuals)  1e-9:\n        # p-value is effectively 1, so null hypothesis is not rejected.\n        return True\n\n    r_bar = np.mean(residuals)\n    # Sample variance (autocovariance at lag 0)\n    gamma_0 = np.sum((residuals - r_bar)**2) / N\n    \n    # This case should be covered by the std check, but for robustness:\n    if gamma_0 == 0:\n        return True\n\n    rho_sq = np.zeros(h)\n    for j in range(1, h + 1):\n        # Sample autocovariance at lag j\n        gamma_j = np.sum((residuals[j:] - r_bar) * (residuals[:-j] - r_bar)) / N\n        rho_j = gamma_j / gamma_0\n        rho_sq[j - 1] = rho_j**2\n\n    # Ljung-Box statistic\n    denominators = N - np.arange(1, h + 1)\n    Q_LB = N * (N + 2) * np.sum(rho_sq / denominators)\n    \n    # Degrees of freedom for the chi-squared distribution is h\n    dof = h\n    \n    # The p-value is the probability of observing a value = Q_LB\n    # from a chi-squared distribution with 'dof' degrees of freedom.\n    # We use the survival function (1 - CDF).\n    p_value = chi2.sf(Q_LB, dof)\n    \n    # Do not reject the null hypothesis if p_value is = alpha\n    return p_value = alpha\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and hypothesis tests.\n    \"\"\"\n    # Model parameters\n    dt = 1.0  # s\n    N = 1200 # samples\n    Q = 2.5   # Ah\n    R0 = 0.01 # Ohm\n    R1 = 0.015 # Ohm\n    tau1 = 100.0 # s\n    U_min = 3.6  # V\n    k_oc = 0.4   # V/SOC\n    z0 = 0.8  # dimensionless\n\n    # Test parameters\n    h = 20    # max lag for portmanteau test\n    alpha = 0.05 # significance level\n\n    # Derived model parameters\n    a = np.exp(-dt / tau1)\n    b = R1 * (1.0 - a)\n\n    # Generate HPPC-like current profile\n    I = np.zeros(N)\n    pattern = np.concatenate([\n        np.zeros(60),          # Rest\n        np.full(10, 5.0),      # Discharge pulse\n        np.zeros(60),          # Rest\n        np.full(10, -3.0)      # Charge pulse\n    ])\n    len_pattern = len(pattern)\n    num_repeats = N // len_pattern\n    I[:num_repeats * len_pattern] = np.tile(pattern, num_repeats)\n    remaining_len = N % len_pattern\n    if remaining_len  0:\n        I[num_repeats * len_pattern:] = pattern[:remaining_len]\n\n    # Simulate the base ECM to get the model voltage U[k]\n    z = np.zeros(N)\n    v_rc = np.zeros(N)\n    U_model = np.zeros(N)\n    \n    # Initial conditions\n    z[0] = z0\n    v_rc[0] = 0.0  # Assume starting from a rested state\n    U_oc_k = U_min + k_oc * z[0]\n    U_model[0] = U_oc_k - R0 * I[0] - v_rc[0]\n\n    for k in range(1, N):\n        # State updates (depend on k-1)\n        z[k] = z[k-1] - (I[k-1] * dt) / (Q * 3600.0)\n        v_rc[k] = a * v_rc[k-1] + b * I[k-1]\n        \n        # Output equation (depends on state at k and input at k)\n        U_oc_k = U_min + k_oc * z[k]\n        U_model[k] = U_oc_k - R0 * I[k] - v_rc[k]\n\n    # --- Test Cases ---\n    \n    # Case A: Ideal identification (zero residuals)\n    residuals_A = U_model - U_model # Exactly zero\n\n    # Case B: Colored residual (sinusoidal error)\n    t = np.arange(N) * dt\n    A_sin = 0.03 # V\n    f_sin = 0.02 # Hz\n    sin_error = A_sin * np.sin(2 * np.pi * f_sin * t)\n    U_meas_B = U_model + sin_error\n    residuals_B = U_meas_B - U_model\n\n    # Case C: White residual (Gaussian noise)\n    rng = np.random.default_rng(seed=42) # Fixed seed for reproducibility\n    sigma_noise = 0.01 # V\n    white_error = rng.normal(loc=0.0, scale=sigma_noise, size=N)\n    U_meas_C = U_model + white_error\n    residuals_C = U_meas_C - U_model\n\n    test_cases_residuals = [residuals_A, residuals_B, residuals_C]\n    \n    results = []\n    for r in test_cases_residuals:\n        # returns True if null hypothesis is NOT rejected (i.e., accepted as white)\n        is_white = portmanteau_test(r, h, alpha)\n        results.append(is_white)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}