{
    "hands_on_practices": [
        {
            "introduction": "A foundational step in analyzing a battery module's thermal management is to establish a control volume and apply the first law of thermodynamics. This practice guides you through deriving the steady-state temperature of a module using a simplified lumped-capacitance model, a common starting point in system-level analysis. Critically, it also requires you to justify this simplification by calculating the Biot number ($Bi$), a crucial skill for assessing the validity of modeling assumptions .",
            "id": "3930496",
            "problem": "A prismatic lithium-ion battery module is designed with a symmetric parallel busbar interconnect topology such that the direct current distribution across cells is approximately uniform during operation. Under a discharge condition, the total resistive heat generation in the module is uniform in space and equal to a constant total rate $\\dot{Q}$. The module exchanges heat by convection only through its two large faces exposed to a cooling air stream; all other faces are well insulated by design. Assume the lumped-capacitance approximation is potentially applicable and that the system has reached steady state.\n\nStarting from the First Law of Thermodynamics for a control mass and the definition of the Biot number (Bi), derive an expression for the steady-state average module temperature under uniform heat generation and convective cooling on two faces, and evaluate whether the lumped-capacitance approximation is justified for this module. Use the following data:\n- Module length $a = 0.50\\,\\mathrm{m}$, width $b = 0.30\\,\\mathrm{m}$, and thickness $t = 0.050\\,\\mathrm{m}$.\n- Total uniform internal heat generation rate $\\dot{Q} = 200\\,\\mathrm{W}$.\n- Convective heat transfer coefficient on each of the two large faces $h = 35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1}$, with ambient air temperature $T_{\\infty} = 298\\,\\mathrm{K}$.\n- Effective through-thickness thermal conductivity of the module $k = 10\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$.\n\nDefine the total convective area as the sum of the areas of the two large faces. The characteristic length for the Biot number should be taken as the ratio of the module volume to the total convective area. Clearly state the expression you derive for the steady-state average module temperature and compute its numerical value. Then compute the Biot number and comment on the validity of the lumped-capacitance assumption.\n\nExpress the final average module temperature in Kelvin and round your answer to four significant figures. Do not include units in your final numerical answer.",
            "solution": "The first step is to validate the problem statement.\n\n**Step 1: Extract Givens**\n- Module length: $a = 0.50\\,\\mathrm{m}$\n- Module width: $b = 0.30\\,\\mathrm{m}$\n- Module thickness: $t = 0.050\\,\\mathrm{m}$\n- Total uniform internal heat generation rate: $\\dot{Q} = 200\\,\\mathrm{W}$\n- Convective heat transfer coefficient on each of the two large faces: $h = 35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1}$\n- Ambient air temperature: $T_{\\infty} = 298\\,\\mathrm{K}$\n- Effective through-thickness thermal conductivity: $k = 10\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n- Cooling mechanism: Convection on two large faces.\n- Other faces: Adiabatic (well insulated).\n- System state: Steady state.\n- Definition of total convective area: Sum of the areas of the two large faces.\n- Definition of characteristic length for Biot number: The ratio of the module volume to the total convective area.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is based on the First Law of Thermodynamics and fundamental principles of heat transfer (conduction and convection), which are well-established scientific laws. The numerical values provided for dimensions, thermal properties, and heat rates are physically plausible for a lithium-ion battery module.\n- **Well-Posed**: The problem is clearly stated and provides all necessary data and definitions to derive the answers. The request is unambiguous, leading to a unique solution.\n- **Objective**: The problem is expressed in objective, technical language, free from any subjective or opinion-based statements.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, self-contained, and well-posed. It is therefore deemed **valid**. We may proceed with the solution.\n\nThe solution process consists of three parts: (1) deriving the expression for the steady-state average module temperature, (2) calculating the numerical value of this temperature, and (3) calculating the Biot number to assess the validity of the lumped-capacitance approximation.\n\n**Part 1: Derivation of the Steady-State Average Module Temperature**\nWe start with the First Law of Thermodynamics for a control mass (the battery module). The general energy balance equation is:\n$$ \\dot{E}_{\\text{in}} - \\dot{E}_{\\text{out}} + \\dot{E}_{\\text{gen}} = \\frac{dE_{\\text{st}}}{dt} $$\nwhere $\\dot{E}_{\\text{in}}$ is the rate of energy entering the system, $\\dot{E}_{\\text{out}}$ is the rate of energy leaving the system, $\\dot{E}_{\\text{gen}}$ is the rate of energy generation within the system, and $\\frac{dE_{\\text{st}}}{dt}$ is the rate of change of stored energy in the system.\n\nAccording to the problem statement, the system is at steady state, which implies that the stored energy is constant. Therefore:\n$$ \\frac{dE_{\\text{st}}}{dt} = 0 $$\nThe problem describes no external energy input, so $\\dot{E}_{\\text{in}} = 0$. The internal heat generation is given as a total rate $\\dot{Q}$, so $\\dot{E}_{\\text{gen}} = \\dot{Q}$. The energy output is due to convection from the two large faces of the module, so $\\dot{E}_{\\text{out}} = \\dot{q}_{\\text{conv}}$. The energy balance equation simplifies to:\n$$ \\dot{Q} = \\dot{q}_{\\text{conv}} $$\nThe rate of convective heat transfer is given by Newton's Law of Cooling:\n$$ \\dot{q}_{\\text{conv}} = h A_c (T_{\\text{mod}} - T_{\\infty}) $$\nwhere $h$ is the convective heat transfer coefficient, $A_c$ is the total convective surface area, $T_{\\text{mod}}$ is the average module temperature (assuming it's uniform, consistent with the lumped capacitance concept being tested), and $T_{\\infty}$ is the ambient fluid temperature.\n\nThe module is cooled on its two large faces. The area of one large face is $a \\times b$. The total convective area $A_c$ is the sum of the areas of these two faces:\n$$ A_c = 2ab $$\nSubstituting this into the expression for $\\dot{q}_{\\text{conv}}$ gives:\n$$ \\dot{q}_{\\text{conv}} = h (2ab) (T_{\\text{mod}} - T_{\\infty}) $$\nNow, we equate the heat generation rate with the heat removal rate:\n$$ \\dot{Q} = 2hab (T_{\\text{mod}} - T_{\\infty}) $$\nWe can now rearrange this equation to solve for the steady-state average module temperature, $T_{\\text{mod}}$:\n$$ T_{\\text{mod}} - T_{\\infty} = \\frac{\\dot{Q}}{2hab} $$\n$$ T_{\\text{mod}} = T_{\\infty} + \\frac{\\dot{Q}}{2hab} $$\nThis is the derived expression for the steady-state average module temperature.\n\n**Part 2: Numerical Calculation of Temperature**\nWe substitute the given numerical values into the derived expression:\n- $T_{\\infty} = 298\\,\\mathrm{K}$\n- $\\dot{Q} = 200\\,\\mathrm{W}$\n- $h = 35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1}$\n- $a = 0.50\\,\\mathrm{m}$\n- $b = 0.30\\,\\mathrm{m}$\n\n$$ T_{\\text{mod}} = 298\\,\\mathrm{K} + \\frac{200\\,\\mathrm{W}}{2(35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1})(0.50\\,\\mathrm{m})(0.30\\,\\mathrm{m})} $$\nFirst, calculate the denominator:\n$$ 2 \\times 35 \\times 0.50 \\times 0.30 = 70 \\times 0.15 = 10.5\\,\\mathrm{W}\\,\\mathrm{K}^{-1} $$\nNow, calculate the temperature rise:\n$$ \\Delta T = \\frac{200\\,\\mathrm{W}}{10.5\\,\\mathrm{W}\\,\\mathrm{K}^{-1}} \\approx 19.0476\\,\\mathrm{K} $$\nFinally, calculate the module temperature:\n$$ T_{\\text{mod}} = 298\\,\\mathrm{K} + 19.0476\\,\\mathrm{K} = 317.0476\\,\\mathrm{K} $$\nRounding to four significant figures as requested, the steady-state average module temperature is $317.0\\,\\mathrm{K}$.\n\n**Part 3: Biot Number and Validity of the Lumped-Capacitance Approximation**\nThe Biot number (Bi) is a dimensionless quantity that compares the internal resistance to heat conduction within a solid to the external resistance to heat convection at the surface. It is defined as:\n$$ \\text{Bi} = \\frac{h L_c}{k} $$\nwhere $L_c$ is the characteristic length and $k$ is the thermal conductivity of the solid.\n\nThe problem specifies that the characteristic length $L_c$ is the ratio of the module volume $V$ to the total convective area $A_c$.\nThe volume of the module is:\n$$ V = a \\times b \\times t $$\nThe total convective area is:\n$$ A_c = 2ab $$\nSo, the characteristic length is:\n$$ L_c = \\frac{V}{A_c} = \\frac{abt}{2ab} = \\frac{t}{2} $$\nUsing the given thickness $t = 0.050\\,\\mathrm{m}$:\n$$ L_c = \\frac{0.050\\,\\mathrm{m}}{2} = 0.025\\,\\mathrm{m} $$\nNow we can calculate the Biot number using the given values for $h$, $L_c$, and $k$:\n- $h = 35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1}$\n- $L_c = 0.025\\,\\mathrm{m}$\n- $k = 10\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}$\n\n$$ \\text{Bi} = \\frac{(35\\,\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{K}^{-1})(0.025\\,\\mathrm{m})}{10\\,\\mathrm{W}\\,\\mathrm{m}^{-1}\\,\\mathrm{K}^{-1}} = \\frac{0.875}{10} = 0.0875 $$\nThe lumped-capacitance approximation assumes that the temperature within the object is spatially uniform at any instant. This assumption is generally considered valid if the Biot number is small, typically $\\text{Bi} < 0.1$.\nIn this case, $\\text{Bi} = 0.0875$, which is less than $0.1$. Therefore, the internal conductive resistance is significantly smaller than the external convective resistance, meaning that heat conducts through the module much more easily than it is removed from the surface. As a result, temperature gradients within the module are small, and the lumped-capacitance approximation is justified for this analysis.",
            "answer": "$$\\boxed{317.0}$$"
        },
        {
            "introduction": "The interconnect topology within a module directly influences its electrical performance by creating non-uniform current paths. This exercise demonstrates this principle by modeling the module as a DC circuit with multiple parallel strings, incorporating busbar, interconnect, and contact resistances. By calculating the current distribution and its perturbation due to a change in a single contact resistance, you will gain a quantitative understanding of how physical design choices impact electrical balance and, consequently, thermal load distribution .",
            "id": "3930497",
            "problem": "A prismatic lithium-ion battery module is represented by two parallel strings connected to common positive and negative busbars. Each string consists of a series stack of cells, tab contacts, and branch-specific interconnect segments. The busbars themselves have a shared resistance before the split to the two strings. In automated battery design and simulation, module-level electrical–thermal coupling requires that interconnect topology, including contact resistances, be incorporated into the electrical network from first principles and that electrical losses be mapped into thermal sources. Assume an isothermal condition at $T=298\\,\\mathrm{K}$ for the purpose of the electrical calculation.\n\nStarting from Ohm’s law ($V=IR$), Kirchhoff’s Voltage Law (KVL), and Kirchhoff’s Current Law (KCL), model the two-string network as follows:\n- A constant bus voltage $V=36\\,\\mathrm{V}$ is applied across the module.\n- The positive busbar has a shared segment resistance $R_{p,s}=0.040\\,\\mathrm{\\Omega}$ before splitting to two branch segments with resistances $r_{p,a}=0.030\\,\\mathrm{\\Omega}$ and $r_{p,b}=0.020\\,\\mathrm{\\Omega}$, feeding strings $a$ and $b$, respectively.\n- The negative busbar has a shared segment resistance $R_{n,s}=0.040\\,\\mathrm{\\Omega}$ before splitting to two branch segments with resistances $r_{n,a}=0.030\\,\\mathrm{\\Omega}$ and $r_{n,b}=0.020\\,\\mathrm{\\Omega}$, returning from strings $a$ and $b$, respectively.\n- String $a$ has an aggregated series internal resistance $R_{\\text{cell},a}=1.44\\,\\mathrm{\\Omega}$ and tab contact resistances $R_{c+,a}=0.020\\,\\mathrm{\\Omega}$ and $R_{c-,a}=0.020\\,\\mathrm{\\Omega}$.\n- String $b$ has an aggregated series internal resistance $R_{\\text{cell},b}=1.36\\,\\mathrm{\\Omega}$ and tab contact resistances $R_{c+,b}=0.015\\,\\mathrm{\\Omega}$ and $R_{c-,b}=0.015\\,\\mathrm{\\Omega}$.\n\nTreat the shared busbar segments as carrying the total module current, and the branch-specific segments, contacts, and internal resistances as series elements in each branch. Derive the expressions for the branch currents $I_a$ and $I_b$ using KCL and KVL under these assumptions. Then, suppose the positive tab contact resistance of string $a$ doubles due to a change in clamping pressure, so that $R_{c+,a}$ becomes $2\\times 0.020\\,\\mathrm{\\Omega}$. Compute the new branch currents for strings $a$ and $b$ with this doubled contact resistance.\n\nExpress the final currents in Ampere ($\\mathrm{A}$), and round your numerical results to $4$ significant figures. Your final answer must contain only the two currents in a single row matrix.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information to derive a unique solution. It is a standard DC circuit analysis problem based on fundamental electrical principles.\n\nThe battery module can be modeled as an electrical circuit. A constant voltage source $V$ is applied across the module. This voltage drives a total current $I$ through a shared resistance $R_s$. The current then splits into two parallel branches, string $a$ and string $b$, with currents $I_a$ and $I_b$ respectively. Each branch contains a series of resistive elements.\n\nFirst, we define the total resistance of each component group based on the provided data.\nThe shared resistance, $R_s$, is the sum of the positive and negative shared busbar segments:\n$$R_s = R_{p,s} + R_{n,s}$$\nThe total resistance of string $a$, denoted $R_a$, is the sum of its branch-specific interconnects, tab contacts, and internal cell resistance:\n$$R_a = r_{p,a} + R_{c+,a} + R_{\\text{cell},a} + R_{c-,a} + r_{n,a}$$\nSimilarly, the total resistance of string $b$, denoted $R_b$, is:\n$$R_b = r_{p,b} + R_{c+,b} + R_{\\text{cell},b} + R_{c-,b} + r_{n,b}$$\n\nAccording to Kirchhoff's Current Law (KCL), the total current $I$ entering the parallel junction must equal the sum of the currents leaving it:\n$$I = I_a + I_b$$\n\nAccording to Kirchhoff's Voltage Law (KVL), the sum of voltage drops around any closed loop must equal the total voltage supplied. We can write two KVL equations for the loops involving each branch:\nFor the loop through branch $a$:\n$$V = I R_s + I_a R_a$$\nFor the loop through branch $b$:\n$$V = I R_s + I_b R_b$$\n\nFrom these two KVL equations, it is clear that the voltage drop across the parallel portion of the circuit is the same for both branches:\n$$I_a R_a = I_b R_b$$\nThis relationship allows us to express one branch current in terms of the other. For instance:\n$$I_b = I_a \\frac{R_a}{R_b}$$\n\nTo derive an expression for $I_a$, we substitute $I = I_a + I_b$ and the expression for $I_b$ into the KVL equation for the loop through branch $a$:\n$$V = (I_a + I_b) R_s + I_a R_a$$\n$$V = \\left(I_a + I_a \\frac{R_a}{R_b}\\right) R_s + I_a R_a$$\nFactoring out $I_a$:\n$$V = I_a \\left[ \\left(1 + \\frac{R_a}{R_b}\\right) R_s + R_a \\right]$$\n$$V = I_a \\left[ \\frac{R_b + R_a}{R_b} R_s + R_a \\right]$$\n$$V = I_a \\left[ \\frac{(R_a + R_b)R_s + R_a R_b}{R_b} \\right]$$\nSolving for $I_a$:\n$$I_a = V \\frac{R_b}{R_a R_b + (R_a + R_b)R_s}$$\nBy symmetry, we can find the expression for $I_b$ by swapping the 'a' and 'b' subscripts:\n$$I_b = V \\frac{R_a}{R_b R_a + (R_b + R_a)R_s}$$\n\nThe problem requires us to compute the new branch currents after the positive tab contact resistance of string $a$ doubles. Let us denote the original resistance as $R_{c+,a}$ and the new resistance as $R'_{c+,a}$.\n$$R'_{c+,a} = 2 \\times R_{c+,a}$$\nThis change affects the total resistance of branch $a$, resulting in a new value $R'_a$. The resistance of branch $b$, $R_b$, remains unchanged.\n$$R'_a = r_{p,a} + R'_{c+,a} + R_{\\text{cell},a} + R_{c-,a} + r_{n,a}$$\nThe new currents, $I'_a$ and $I'_b$, are then given by:\n$$I'_a = V \\frac{R_b}{R'_a R_b + (R'_a + R_b)R_s}$$\n$$I'_b = V \\frac{R'_a}{R'_a R_b + (R'_a + R_b)R_s}$$\n\nNow we substitute the given numerical values. All resistances are in Ohms ($\\mathrm{\\Omega}$).\n$V = 36\\,\\mathrm{V}$\n$R_{p,s} = 0.040\\,\\mathrm{\\Omega}$, $R_{n,s} = 0.040\\,\\mathrm{\\Omega}$\n$r_{p,a} = 0.030\\,\\mathrm{\\Omega}$, $r_{n,a} = 0.030\\,\\mathrm{\\Omega}$\n$r_{p,b} = 0.020\\,\\mathrm{\\Omega}$, $r_{n,b} = 0.020\\,\\mathrm{\\Omega}$\n$R_{\\text{cell},a} = 1.44\\,\\mathrm{\\Omega}$, $R_{c-,a} = 0.020\\,\\mathrm{\\Omega}$\n$R_{\\text{cell},b} = 1.36\\,\\mathrm{\\Omega}$, $R_{c+,b} = 0.015\\,\\mathrm{\\Omega}$, $R_{c-,b} = 0.015\\,\\mathrm{\\Omega}$\nThe original value of the positive tab contact resistance for string $a$ is $R_{c+,a} = 0.020\\,\\mathrm{\\Omega}$. This value doubles, so the new resistance is:\n$$R'_{c+,a} = 2 \\times 0.020\\,\\mathrm{\\Omega} = 0.040\\,\\mathrm{\\Omega}$$\nFirst, we calculate the values of $R_s$, $R_b$, and the new $R'_a$:\n$$R_s = R_{p,s} + R_{n,s} = 0.040 + 0.040 = 0.080\\,\\mathrm{\\Omega}$$\n$$R_b = r_{p,b} + R_{c+,b} + R_{\\text{cell},b} + R_{c-,b} + r_{n,b} = 0.020 + 0.015 + 1.36 + 0.015 + 0.020 = 1.43\\,\\mathrm{\\Omega}$$\n$$R'_a = r_{p,a} + R'_{c+,a} + R_{\\text{cell},a} + R_{c-,a} + r_{n,a} = 0.030 + 0.040 + 1.44 + 0.020 + 0.030 = 1.56\\,\\mathrm{\\Omega}$$\n\nNext, we calculate the common denominator for the current expressions, $D = R'_a R_b + (R'_a + R_b)R_s$:\n$$D = (1.56)(1.43) + (1.56 + 1.43)(0.080)$$\n$$D = 2.2308 + (2.99)(0.080)$$\n$$D = 2.2308 + 0.2392 = 2.47$$\nNow we can compute the new currents $I'_a$ and $I'_b$:\n$$I'_a = V \\frac{R_b}{D} = 36 \\times \\frac{1.43}{2.47} = \\frac{51.48}{2.47} \\approx 20.842105... \\,\\mathrm{A}$$\n$$I'_b = V \\frac{R'_a}{D} = 36 \\times \\frac{1.56}{2.47} = \\frac{56.16}{2.47} \\approx 22.736842... \\,\\mathrm{A}$$\n\nThe problem requires rounding the final numerical results to $4$ significant figures.\n$$I'_a \\approx 20.84\\,\\mathrm{A}$$\n$$I'_b \\approx 22.74\\,\\mathrm{A}$$\nThese are the new branch currents for strings $a$ and $b$ after the change in contact resistance.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n20.84 & 22.74\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The most challenging and realistic aspects of battery module design arise from the dynamic coupling between electrical and thermal domains. This practice advances to a fully coupled system model, where you will formulate and numerically solve a set of ordinary differential equations (ODEs) representing the transient behavior of parallel cells. This exercise captures the essential feedback loop where temperature-dependent resistance affects current sharing and Joule heating, providing insight into the mechanisms that can lead to thermal instability .",
            "id": "3930548",
            "problem": "Consider a battery module composed of $M$ parallel electrochemical cells whose interconnect topology is modeled as series resistive links between each cell and the common bus. Each cell branch $i$ has an internal ohmic resistance that depends on its temperature, denoted $R_{\\text{cell},i}\\!\\left(T_i\\right)$, and a series interconnect resistance $R_{\\text{int},i}$. The branch also has a small lumped electrical inductance $L_i$ capturing fast dynamics of the current under a bus voltage step. The bus voltage is prescribed as a known function $V_{\\text{bus}}\\!\\left(t\\right)$, and each cell has an open-circuit voltage $E_i$ assumed constant over the time horizon of interest. Thermal dynamics are represented by a lumped capacity $C_{\\text{th},i}$ per cell, with convective heat transfer to ambient modeled by a conductance $H_i$ to ambient temperature $T_{\\text{amb}}$, and conductive coupling to neighboring cells captured by a symmetric thermal conductance matrix $K_{ij}$ over an undirected interconnect topology graph.\n\nStarting strictly from fundamental laws and core definitions, derive and implement the coupled Ordinary Differential Equations (ODEs) governing the transient current $I_i\\!\\left(t\\right)$ and temperature $T_i\\!\\left(t\\right)$ for $i=1,\\dots,M$. Use the following fundamental bases:\n\n- Ohm’s law and Kirchhoff’s Voltage Law (KVL): For branch $i$, the instantaneous voltage drop across inductance and resistances equals the applied bus-to-cell voltage difference, enforcing $L_i\\,\\dfrac{d I_i}{dt}$ plus resistive drops.\n- Joule heating: The electrical power dissipated in the internal cell resistance equals $I_i^2\\,R_{\\text{cell},i}\\!\\left(T_i\\right)$.\n- Lumped thermal energy balance: The rate of change of thermal energy of cell $i$ equals net heat generation minus heat loss to ambient plus conduction exchange with neighbors.\n- Temperature-dependent resistance model: $R_{\\text{cell},i}\\!\\left(T_i\\right)$ follows a linear temperature coefficient with respect to a reference temperature.\n\nYou must first formulate the coupled ODEs in terms of $I_i\\!\\left(t\\right)$ and $T_i\\!\\left(t\\right)$ using these bases and the specified model choices. Then implement a program that integrates these ODEs numerically for a provided test suite. Use the following explicit functional forms and modeling choices:\n\n- Electrical dynamics per branch $i$: KVL with the bus voltage gives\n$$\nL_i\\,\\frac{d I_i}{dt} \\;=\\; V_{\\text{bus}}\\!\\left(t\\right) - E_i \\;-\\; \\bigl(R_{\\text{cell},i}\\!\\left(T_i\\right) + R_{\\text{int},i}\\bigr)\\,I_i.\n$$\n- Temperature-dependent internal resistance:\n$$\nR_{\\text{cell},i}\\!\\left(T_i\\right) \\;=\\; R_{0,i}\\,\\bigl(1 + \\alpha_i\\,(T_i - T_{\\text{ref}})\\bigr).\n$$\n- Thermal dynamics per cell $i$:\n$$\nC_{\\text{th},i}\\,\\frac{d T_i}{dt} \\;=\\; I_i^2\\,R_{\\text{cell},i}\\!\\left(T_i\\right) \\;-\\; H_i\\,(T_i - T_{\\text{amb}}) \\;+\\; \\sum_{j=1}^{M} K_{ij}\\,(T_j - T_i),\n$$\nwith $K_{ii} = 0$ and $K_{ij} = K_{ji}$.\n\nInitial conditions for all test cases are\n$$\nI_i(0) = 0 \\text{ A},\\quad T_i(0) = T_{\\text{amb}} \\text{ K}.\n$$\n\nYour program must integrate these ODEs on a finite time horizon and compute a scalar metric per test case quantifying transient current sharing under electrical–thermal coupling. Define the current imbalance ratio at final time $t_{\\text{end}}$ as\n$$\nS \\;=\\; \\frac{\\max_{i} I_i(t_{\\text{end}})}{\\min_{i} I_i(t_{\\text{end}})},\n$$\nexpressed as a unitless decimal. To ensure coverage, use the following test suite of parameter values representing different interconnect topologies and coupling strengths. In all cases, set $M = 3$ and a constant bus voltage step $V_{\\text{bus}}\\!\\left(t\\right) = V_{\\text{step}}$:\n\n- Test Case $1$ (general case with mismatched interconnects and moderate thermal coupling):\n    - $V_{\\text{step}} = 4.10 \\text{ V}$, $E_i = 4.00 \\text{ V}$ for all $i$.\n    - $L_i = 5.0\\times 10^{-6} \\text{ H}$ for all $i$.\n    - $R_{0,i} = 3.0\\times 10^{-3} \\text{ }\\Omega$ for all $i$, $\\alpha_i = 2.0\\times 10^{-3} \\text{ K}^{-1}$ for all $i$, $T_{\\text{ref}} = 298.15 \\text{ K}$.\n    - $R_{\\text{int}} = [5.0\\times 10^{-4},\\,1.0\\times 10^{-3},\\,1.5\\times 10^{-3}] \\text{ }\\Omega$.\n    - $C_{\\text{th},i} = 150.0 \\text{ J/K}$ for all $i$, $H_i = 4.0 \\text{ W/K}$ for all $i$, $T_{\\text{amb}} = 298.15 \\text{ K}$.\n    - Thermal conductance matrix nonzero only for neighbors in a line topology: $K_{12} = K_{21} = 0.8 \\text{ W/K}$, $K_{23} = K_{32} = 0.8 \\text{ W/K}$, and $K_{13} = K_{31} = 0$.\n    - Final time $t_{\\text{end}} = 10.0 \\text{ s}$.\n- Test Case $2$ (boundary case with identical interconnects and no temperature coefficient):\n    - $V_{\\text{step}} = 4.10 \\text{ V}$, $E_i = 4.00 \\text{ V}$ for all $i$.\n    - $L_i = 5.0\\times 10^{-6} \\text{ H}$ for all $i$.\n    - $R_{0,i} = 3.0\\times 10^{-3} \\text{ }\\Omega$ for all $i$, $\\alpha_i = 0.0 \\text{ K}^{-1}$ for all $i$, $T_{\\text{ref}} = 298.15 \\text{ K}$.\n    - $R_{\\text{int}} = [1.0\\times 10^{-3},\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-3}] \\text{ }\\Omega$.\n    - $C_{\\text{th},i} = 150.0 \\text{ J/K}$ for all $i$, $H_i = 4.0 \\text{ W/K}$ for all $i$, $T_{\\text{amb}} = 298.15 \\text{ K}$.\n    - Thermal conductance matrix all zeros: $K_{ij} = 0$ for all $i,j$.\n    - Final time $t_{\\text{end}} = 10.0 \\text{ s}$.\n- Test Case $3$ (edge case with high temperature coefficient and weaker cooling):\n    - $V_{\\text{step}} = 4.10 \\text{ V}$, $E_i = 4.00 \\text{ V}$ for all $i$.\n    - $L_i = 5.0\\times 10^{-6} \\text{ H}$ for all $i$.\n    - $R_{0,i} = 3.0\\times 10^{-3} \\text{ }\\Omega$ for all $i$, $\\alpha_i = 1.0\\times 10^{-2} \\text{ K}^{-1}$ for all $i$, $T_{\\text{ref}} = 298.15 \\text{ K}$.\n    - $R_{\\text{int}} = [5.0\\times 10^{-4},\\,1.0\\times 10^{-3},\\,1.5\\times 10^{-3}] \\text{ }\\Omega$.\n    - $C_{\\text{th},i} = 150.0 \\text{ J/K}$ for all $i$, $H_i = 2.0 \\text{ W/K}$ for all $i$, $T_{\\text{amb}} = 298.15 \\text{ K}$.\n    - Thermal conductance matrix nonzero only for neighbors: $K_{12} = K_{21} = 0.4 \\text{ W/K}$, $K_{23} = K_{32} = 0.4 \\text{ W/K}$, and $K_{13} = K_{31} = 0$.\n    - Final time $t_{\\text{end}} = 10.0 \\text{ s}$.\n- Test Case $4$ (strong thermal coupling and weaker convection):\n    - $V_{\\text{step}} = 4.10 \\text{ V}$, $E_i = 4.00 \\text{ V}$ for all $i$.\n    - $L_i = 5.0\\times 10^{-6} \\text{ H}$ for all $i$.\n    - $R_{0,i} = 3.0\\times 10^{-3} \\text{ }\\Omega$ for all $i$, $\\alpha_i = 2.0\\times 10^{-3} \\text{ K}^{-1}$ for all $i$, $T_{\\text{ref}} = 298.15 \\text{ K}$.\n    - $R_{\\text{int}} = [5.0\\times 10^{-4},\\,1.0\\times 10^{-3},\\,1.5\\times 10^{-3}] \\text{ }\\Omega$.\n    - $C_{\\text{th},i} = 150.0 \\text{ J/K}$ for all $i$, $H_i = 1.5 \\text{ W/K}$ for all $i$, $T_{\\text{amb}} = 298.15 \\text{ K}$.\n    - Thermal conductance matrix nonzero only for neighbors: $K_{12} = K_{21} = 3.0 \\text{ W/K}$, $K_{23} = K_{32} = 3.0 \\text{ W/K}$, and $K_{13} = K_{31} = 0$.\n    - Final time $t_{\\text{end}} = 15.0 \\text{ s}$.\n\nYour program must produce the current imbalance ratio $S$ for each test case, rounded to six decimal places, and output a single line containing a comma-separated list of these values enclosed in square brackets, for example, $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$. No other text should be printed. The ratio $S$ is unitless and must be expressed as a decimal number. Angles are not involved in this problem. The numerical integration should be done using a robust method suitable for potentially stiff ODEs. The resulting list entries must be floats. Ensure scientific realism by adhering to the given parameter values and by correctly implementing the coupling terms between electrical and thermal states via $R_{\\text{cell},i}\\!\\left(T_i\\right)$ and $K_{ij}$.",
            "solution": "The problem statement has been meticulously reviewed and is determined to be **valid**. It is scientifically grounded in the principles of electrical circuit theory and heat transfer, mathematically well-posed as an initial value problem for a system of ordinary differential equations (ODEs), and provides a complete and consistent set of parameters and conditions.\n\nThe task is to model the coupled electrical and thermal transient behavior of a battery module with `$M=3$` parallel cells. The state of the system at any time `$t$` can be described by a state vector `$y(t)$` of size `$2M = 6$`. This vector concatenates the currents `$I_i(t)$` and temperatures `$T_i(t)$` for each cell `$i=1, 2, 3$`.\n$$\ny(t) = [I_1(t), I_2(t), I_3(t), T_1(t), T_2(t), T_3(t)]^T\n$$\nThe evolution of this state vector is governed by a system of first-order ODEs, `$\\frac{dy}{dt} = f(t, y)$`. We will formulate the function `$f(t, y)$` based on the provided physical laws and model equations.\n\n**1. Formulation of the Coupled ODE System**\n\nThe system consists of `$M=3$` electrical equations and `$M=3$` thermal equations.\n\n**Electrical Dynamics:**\nFor each branch `$i$`, Kirchhoff's Voltage Law (KVL) is applied. The voltage drop across the inductor (`$L_i \\frac{dI_i}{dt}$`) plus the voltage drop across the total series resistance must equal the net voltage applied to the branch, which is the bus voltage `$V_{\\text{bus}}(t)$` minus the cell's open-circuit voltage `$E_i$`. The total resistance is the sum of the temperature-dependent internal resistance `$R_{\\text{cell},i}(T_i)$` and the fixed interconnect resistance `$R_{\\text{int},i}$`. This yields the equation provided in the problem:\n$$\nL_i \\frac{dI_i}{dt} = V_{\\text{bus}}(t) - E_i - \\left(R_{\\text{cell},i}(T_i) + R_{\\text{int},i}\\right) I_i\n$$\nThe temperature-dependent resistance is given by a linear model:\n$$\nR_{\\text{cell},i}(T_i) = R_{0,i} \\left(1 + \\alpha_i (T_i - T_{\\text{ref}})\\right)\n$$\nSubstituting this into the KVL equation and isolating the derivative `$\\frac{dI_i}{dt}$`, we obtain the first `$M=3$` components of our ODE system:\n$$\n\\frac{dI_i}{dt} = \\frac{1}{L_i} \\left[ V_{\\text{bus}}(t) - E_i - \\left( R_{0,i} (1 + \\alpha_i (T_i - T_{\\text{ref}})) + R_{\\text{int},i} \\right) I_i \\right] \\quad \\text{for } i=1, 2, 3.\n$$\n\n**Thermal Dynamics:**\nFor each cell `$i$`, the thermal dynamics are governed by the principle of energy conservation. The rate of change of thermal energy, `$C_{\\text{th},i} \\frac{dT_i}{dt}$`, is equal to the net rate of heat addition. This net rate includes three terms:\n1.  **Joule Heating (Generation):** Heat is generated internally due to the current `$I_i$` flowing through the internal resistance `$R_{\\text{cell},i}(T_i)$`. The power dissipated as heat is `$P_{\\text{gen},i} = I_i^2 R_{\\text{cell},i}(T_i)$`.\n2.  **Convective Cooling (Loss):** Heat is lost to the surroundings. This is modeled as convective heat transfer with conductance `$H_i$` to an ambient at temperature `$T_{\\text{amb}}$`. The heat loss rate is `$P_{\\text{loss},i} = H_i (T_i - T_{\\text{amb}})$`.\n3.  **Conductive Exchange (Transfer):** Heat is exchanged with neighboring cells `$j$` through conductive pathways, modeled by a thermal conductance matrix `$K_{ij}$`. The net heat flow rate into cell `$i$` from all neighbors is `$P_{\\text{cond},i} = \\sum_{j=1}^{M} K_{ij} (T_j - T_i)$`.\n\nCombining these terms gives the energy balance equation:\n$$\nC_{\\text{th},i} \\frac{dT_i}{dt} = I_i^2 R_{\\text{cell},i}(T_i) - H_i (T_i - T_{\\text{amb}}) + \\sum_{j=1}^{M} K_{ij} (T_j - T_i)\n$$\nIsolating the derivative `$\\frac{dT_i}{dt}$` gives the final `$M=3$` components of our ODE system:\n$$\n\\frac{dT_i}{dt} = \\frac{1}{C_{\\text{th},i}} \\left[ I_i^2 R_{0,i} (1 + \\alpha_i (T_i - T_{\\text{ref}})) - H_i (T_i - T_{\\text{amb}}) + \\sum_{j=1}^{M} K_{ij} (T_j - T_i) \\right] \\quad \\text{for } i=1, 2, 3.\n$$\n\n**2. Numerical Integration**\n\nThe complete system comprises `$6$` coupled, first-order, nonlinear ODEs. The problem states initial conditions `$I_i(0) = 0 \\text{ A}$` and `$T_i(0) = T_{\\text{amb}}$`. The characteristic time scales of the electrical dynamics (on the order of `$L/R \\approx 10^{-3} \\text{ s}$`) and thermal dynamics (on the order of `$C_{th}/H \\approx 40 \\text{ s}$`) are vastly different. This disparity indicates the system is numerically stiff. Therefore, a numerical solver suitable for stiff ODEs must be used to ensure a stable and efficient solution. The `Radau` or `BDF` methods, available in `scipy.integrate.solve_ivp`, are appropriate choices. We will use `Radau`.\n\nThe integration will be performed over the time interval `$[0, t_{\\text{end}}]$` for each test case.\n\n**3. Metric Calculation**\n\nUpon solving the ODE system, we obtain the state vector `$y(t_{\\text{end}})$` at the specified final time `$t_{\\text{end}}$`. From this vector, we extract the final currents for each cell, `$I_i(t_{\\text{end}})$`. The current imbalance ratio `$S$` is then calculated as the ratio of the maximum final current to the minimum final current among the cells:\n$$\nS = \\frac{\\max_{i} I_i(t_{\\text{end}})}{\\min_{i} I_i(t_{\\text{end}})}\n$$\nThis procedure is repeated for each of the four test cases provided, and the resulting values of `$S$` are reported. The implementation will be encapsulated in a Python script using the `numpy` library for vectorized calculations and `scipy.integrate.solve_ivp` for the numerical integration.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the coupled electro-thermal ODEs for a battery module\n    and calculates the current imbalance ratio for several test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1: General case\n        {\n            \"V_step\": 4.10, \"E\": 4.00,\n            \"L\": 5.0e-6,\n            \"R0\": 3.0e-3, \"alpha\": 2.0e-3, \"T_ref\": 298.15,\n            \"R_int\": np.array([5.0e-4, 1.0e-3, 1.5e-3]),\n            \"C_th\": 150.0, \"H\": 4.0, \"T_amb\": 298.15,\n            \"K\": np.array([[0, 0.8, 0], [0.8, 0, 0.8], [0, 0.8, 0]]),\n            \"t_end\": 10.0\n        },\n        # Test Case 2: Identical interconnects, no temperature coefficient\n        {\n            \"V_step\": 4.10, \"E\": 4.00,\n            \"L\": 5.0e-6,\n            \"R0\": 3.0e-3, \"alpha\": 0.0, \"T_ref\": 298.15,\n            \"R_int\": np.array([1.0e-3, 1.0e-3, 1.0e-3]),\n            \"C_th\": 150.0, \"H\": 4.0, \"T_amb\": 298.15,\n            \"K\": np.zeros((3, 3)),\n            \"t_end\": 10.0\n        },\n        # Test Case 3: High temperature coefficient, weaker cooling\n        {\n            \"V_step\": 4.10, \"E\": 4.00,\n            \"L\": 5.0e-6,\n            \"R0\": 3.0e-3, \"alpha\": 1.0e-2, \"T_ref\": 298.15,\n            \"R_int\": np.array([5.0e-4, 1.0e-3, 1.5e-3]),\n            \"C_th\": 150.0, \"H\": 2.0, \"T_amb\": 298.15,\n            \"K\": np.array([[0, 0.4, 0], [0.4, 0, 0.4], [0, 0.4, 0]]),\n            \"t_end\": 10.0\n        },\n        # Test Case 4: Strong thermal coupling, weaker convection\n        {\n            \"V_step\": 4.10, \"E\": 4.00,\n            \"L\": 5.0e-6,\n            \"R0\": 3.0e-3, \"alpha\": 2.0e-3, \"T_ref\": 298.15,\n            \"R_int\": np.array([5.0e-4, 1.0e-3, 1.5e-3]),\n            \"C_th\": 150.0, \"H\": 1.5, \"T_amb\": 298.15,\n            \"K\": np.array([[0, 3.0, 0], [3.0, 0, 3.0], [0, 3.0, 0]]),\n            \"t_end\": 15.0\n        }\n    ]\n\n    results = []\n    \n    M = 3 # Number of cells\n\n    for case in test_cases:\n        # Unpack parameters\n        V_step = case[\"V_step\"]\n        # Convert scalar parameters to numpy arrays for vectorization\n        E = np.full(M, case[\"E\"])\n        L = np.full(M, case[\"L\"])\n        R0 = np.full(M, case[\"R0\"])\n        alpha = np.full(M, case[\"alpha\"])\n        T_ref = case[\"T_ref\"]\n        R_int = case[\"R_int\"]\n        C_th = np.full(M, case[\"C_th\"])\n        H = np.full(M, case[\"H\"])\n        T_amb = case[\"T_amb\"]\n        K = case[\"K\"]\n        t_end = case[\"t_end\"]\n        \n        # Pre-calculate for efficiency inside the ODE function\n        K_row_sum = np.sum(K, axis=1)\n\n        def ode_system(t, y):\n            \"\"\"\n            Defines the system of 2M coupled ODEs.\n            y = [I_1, ..., I_M, T_1, ..., T_M]\n            \"\"\"\n            I = y[0:M]\n            T = y[M:2*M]\n\n            # Electrical dynamics\n            R_cell = R0 * (1 + alpha * (T - T_ref))\n            dI_dt = (1 / L) * (V_step - E - (R_cell + R_int) * I)\n\n            # Thermal dynamics\n            joule_heating = I**2 * R_cell\n            convection_loss = H * (T - T_amb)\n            # Net conductive heat flow into each cell\n            conduction_exchange = K @ T - T * K_row_sum\n            \n            dT_dt = (1 / C_th) * (joule_heating - convection_loss + conduction_exchange)\n\n            return np.concatenate((dI_dt, dT_dt))\n\n        # Initial conditions: I_i(0)=0, T_i(0)=T_amb\n        y0 = np.zeros(2 * M)\n        y0[M:2*M] = T_amb\n\n        # Time span for integration\n        t_span = (0, t_end)\n        \n        # Solve the ODE system using a method for stiff problems\n        sol = solve_ivp(ode_system, t_span, y0, method='Radau', rtol=1e-6, atol=1e-9)\n        \n        # Extract currents at the final time\n        final_currents = sol.y[0:M, -1]\n        \n        # Calculate imbalance ratio S\n        # Handle potential division by zero, although not expected here\n        min_I = np.min(final_currents)\n        if min_I > 0:\n            S = np.max(final_currents) / min_I\n        else:\n            S = np.inf # Should not happen in these test cases\n        \n        results.append(f\"{S:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}