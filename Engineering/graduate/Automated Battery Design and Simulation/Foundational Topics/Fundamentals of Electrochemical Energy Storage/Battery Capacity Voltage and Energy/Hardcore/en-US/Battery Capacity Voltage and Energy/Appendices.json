{
    "hands_on_practices": [
        {
            "introduction": "Battery systems in applications from electric vehicles to grid storage are constructed by connecting numerous individual cells in series and parallel. This exercise grounds your understanding in first principles, tasking you with deriving how the total pack capacity in ampere-hours ($Ah$) scales based on the arrangement of cells. By starting from fundamental laws, you will clarify the distinct roles that parallel and series connections play in determining the pack's overall capacity and energy.",
            "id": "3894042",
            "problem": "An automated battery pack design tool composes a pack by arranging identical electrochemical cells into $N_{s}$ series groups, each group consisting of $N_{p}$ cells connected in parallel. Each individual cell has a usable capacity $Q_{c}$ measured in ampere-hours (Ah) over its defined usable state-of-charge window. The tool schedules a discharge from a uniform initial state of charge across all cells until the first cell reaches its lower usable limit. Assume ideal matching and control: identical open-circuit voltage versus state of charge characteristics for all cells, identical internal resistances, equal initial state of charge across all cells, perfect balancing that enforces equal current sharing among cells within each parallel group at all times, and no rate-induced capacity loss within the operating current range. Let the state of charge be defined as a dimensionless quantity $s \\in [0,1]$ over the usable window so that a complete traversal from $s=1$ to $s=0$ in a single cell delivers $Q_{c}$ in ampere-hours.\n\nStarting only from conservation of charge, the definition of capacity as time-integrated current, and Kirchhoff’s laws in series-parallel networks, derive an expression for the total pack capacity $Q_{\\text{pack}}$ in ampere-hours, defined as the time integral of the pack terminal current over the discharge from $s=1$ to $s=0$ of the cells, under the ideal conditions above. Your derivation should make clear how the series and parallel interconnections propagate currents and states of charge. Then, briefly explain how series connection affects capacity units and energy scaling at the pack level without altering the requested final expression.\n\nExpress your final answer as a single closed-form analytic expression in terms of $N_{s}$, $N_{p}$, and $Q_{c}$ only. Express the final capacity in ampere-hours (Ah). No numerical evaluation or rounding is required.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded, well-posed, and objective, providing a clear set of idealizations to allow for a first-principles derivation. All necessary information is provided, and there are no internal contradictions.\n\nThe derivation proceeds from the fundamental principles of charge conservation and circuit theory as stipulated.\n\nLet $I_{\\text{pack}}(t)$ be the current drawn from the terminals of the entire battery pack at time $t$. The total capacity of the pack, $Q_{\\text{pack}}$, measured in ampere-hours, is defined as the time integral of this current over the full discharge period, from time $t=0$ to $t=T$.\n$$Q_{\\text{pack}} = \\int_{0}^{T} I_{\\text{pack}}(t) \\,dt$$\nThe discharge period $T$ is the time required for the cells' state of charge, $s$, to go from $s=1$ (fully charged) to $s=0$ (fully discharged).\n\nThe pack is composed of $N_{s}$ groups connected in series. By Kirchhoff's Current Law for a series circuit, the current flowing through each element in the series chain is identical to the total current flowing out of the chain. Therefore, the current passing through each of the $N_s$ parallel groups, which we denote as $I_{\\text{group}}(t)$, is equal to the pack terminal current.\n$$I_{\\text{pack}}(t) = I_{\\text{group}}(t) \\quad \\text{for all } s \\in [1, N_s]$$\n\nEach of these series groups consists of $N_{p}$ individual cells connected in parallel. By Kirchhoff's Current Law for a parallel circuit, the total current entering or leaving the parallel combination is the sum of the currents in each parallel branch.\n$$I_{\\text{group}}(t) = \\sum_{j=1}^{N_{p}} I_{c,j}(t)$$\nwhere $I_{c,j}(t)$ is the current flowing through the $j$-th cell within that group.\n\nA critical assumption provided is that perfect balancing enforces equal current sharing among cells within each parallel group at all times. This is a direct consequence of the ideal assumptions of identical open-circuit voltage characteristics and identical internal resistances for all cells. When connected in parallel, cells must share the same terminal voltage. For identical cells, this condition can only be met if they carry identical currents. Therefore, for any given parallel group, the current through each of its $N_p$ cells is the same. Let us denote this individual cell current as $I_c(t)$.\n$$I_{c,1}(t) = I_{c,2}(t) = \\dots = I_{c,N_{p}}(t) \\equiv I_c(t)$$\nSubstituting this into the equation for the group current yields:\n$$I_{\\text{group}}(t) = \\sum_{j=1}^{N_{p}} I_c(t) = N_{p} I_c(t)$$\n\nCombining the relationships for series and parallel connections, we can express the individual cell current $I_c(t)$ in terms of the total pack current $I_{\\text{pack}}(t)$:\n$$I_{\\text{pack}}(t) = I_{\\text{group}}(t) = N_{p} I_c(t)$$\n$$I_c(t) = \\frac{I_{\\text{pack}}(t)}{N_{p}}$$\nThis relationship holds for every cell in the entire pack, as all parallel groups are identical and carry the same current $I_{\\text{pack}}(t)$. Consequently, the state of charge, which depends on the time-integrated current removed from a cell, will be identical for every cell in the pack at all times, given they start from the same initial state.\n\nThe problem defines the capacity of a single cell, $Q_{c}$, as the total charge in ampere-hours delivered when its state of charge traverses from $s=1$ to $s=0$. This is expressed by integrating the individual cell current $I_c(t)$ over the discharge time $T$.\n$$Q_{c} = \\int_{0}^{T} I_c(t) \\,dt$$\n\nWe can now find the pack capacity $Q_{\\text{pack}}$ by substituting our derived expression for $I_c(t)$ into the equation for $Q_c$:\n$$Q_{c} = \\int_{0}^{T} \\frac{I_{\\text{pack}}(t)}{N_{p}} \\,dt$$\nSince $N_{p}$ is a constant representing the number of cells, it can be factored out of the integral:\n$$Q_{c} = \\frac{1}{N_{p}} \\int_{0}^{T} I_{\\text{pack}}(t) \\,dt$$\nThe integral on the right side is, by definition, the pack capacity $Q_{\\text{pack}}$.\n$$Q_{c} = \\frac{1}{N_{p}} Q_{\\text{pack}}$$\nSolving for $Q_{\\text{pack}}$, we arrive at the expression for the total capacity of the battery pack:\n$$Q_{\\text{pack}} = N_{p} Q_{c}$$\nThe number of series groups, $N_{s}$, does not appear in the expression for capacity in ampere-hours. This is because connecting elements in series forces them to carry the same current, and capacity in ampere-hours is a measure of the total charge that can be passed, which is limited by the capacity of a single link in the series chain (in this case, one parallel group).\n\nAs requested, we briefly explain the effect of the series connection. While connecting groups in series does not increase the pack's ampere-hour capacity, it does increase the pack's terminal voltage. By Kirchhoff's Voltage Law, the total voltage across the pack, $V_{\\text{pack}}$, is the sum of the voltages of the individual groups connected in series. Since all groups are identical and carry the same current, their voltages will be identical ($V_{\\text{group}}$).\n$$V_{\\text{pack}} = N_{s} V_{\\text{group}}$$\nSince the cells within a group are in parallel, their voltage is the same as the group voltage, $V_{\\text{group}} = V_{c}$, where $V_c$ is the voltage of a single cell. Thus, $V_{\\text{pack}} = N_{s} V_{c}$.\nThe total energy, $E_{\\text{pack}}$, stored in the pack is approximately the product of its capacity and its nominal voltage.\n$$E_{\\text{pack}} \\approx Q_{\\text{pack}} V_{\\text{pack}} = (N_{p} Q_{c}) (N_{s} V_{c}) = (N_{s} N_{p}) (Q_{c} V_{c}) = (N_{s} N_{p}) E_{c}$$\nHere, $E_c$ is the energy of a single cell. The total energy scales with the total number of cells, $N_{s}N_{p}$, as expected from the principle of conservation of energy. The series connection ($N_s$) multiplies the voltage, and the parallel connection ($N_p$) multiplies the ampere-hour capacity, with their product determining the total energy in watt-hours.",
            "answer": "$$\n\\boxed{N_{p} Q_{c}}\n$$"
        },
        {
            "introduction": "While State of Charge (SoC) is a convenient measure of the remaining charge in a battery, it is the State of Energy (SoE) that truly dictates performance and range. This practice challenges the common simplification that $\\text{SoE} \\approx \\text{SoC}$ by having you analyze a cell with a non-flat voltage profile. By deriving the relationship between these two state variables from first principles, you will quantify the maximum error this assumption can introduce, highlighting a crucial consideration for accurate battery state estimation.",
            "id": "3894091",
            "problem": "A single electrochemical cell is discharged at constant current in an automated simulation environment. The open-circuit voltage is well-approximated by two quasi-flat plateaus due to two dominant phase transformations. For the first fraction $\\alpha$ of total charge capacity, the cell voltage remains near a higher plateau $V_{a}$, and for the remaining fraction $1-\\alpha$, the cell voltage remains near a lower plateau $V_{b}$. Assume negligible polarization so the terminal voltage equals the plateau voltage in each region during discharge. Let the State of Charge (SoC) be the fraction $s \\in [0,1]$ of total charge removed, and let the State of Energy (SoE) be the fraction of total electrical energy delivered up to SoC $s$, normalized by the total energy deliverable over a full discharge.\n\nStarting from first principles—charge conservation, the definition of electrical energy as the time integral of power, and the relation between delivered energy and the integral of voltage with respect to discharged charge—derive an expression for the difference $\\Delta(s) = \\text{SoE}(s) - \\text{SoC}(s)$ for this two-plateau cell. Then, for the specific case where $\\alpha = 0.4$, $V_{a} = 3.7\\,\\text{V}$, and $V_{b} = 3.2\\,\\text{V}$, determine the maximum absolute value of $\\Delta(s)$ over $s \\in [0,1]$, which quantifies the error incurred if the approximation $\\text{SoE} \\approx \\text{SoC}$ is assumed.\n\nExpress the final error as a dimensionless decimal. Round your answer to four significant figures.",
            "solution": "The problem is scientifically grounded, well-posed, and objective, making it valid for solution.\n\nLet $Q_{total}$ be the total charge capacity of the cell. The State of Charge, SoC, denoted by $s$, is the fraction of total charge removed. Thus, the charge removed, $q$, is related to $s$ by $q = s \\cdot Q_{total}$, where $s \\in [0,1]$.\n\nThe terminal voltage $V$ is given as a piecewise-constant function of the charge removed. It can be expressed as a function of the SoC, $s$:\n$$ V(s) = \\begin{cases} V_{a}  \\text{for } 0 \\le s \\le \\alpha \\\\ V_{b}  \\text{for } \\alpha  s \\le 1 \\end{cases} $$\nwhere $\\alpha$ is the fraction of capacity discharged at voltage $V_a$.\n\nThe total electrical energy $E_{total}$ delivered over a full discharge cycle ($s=0$ to $s=1$) is the integral of the voltage with respect to the charge removed, from $q=0$ to $q=Q_{total}$:\n$$ E_{total} = \\int_{0}^{Q_{total}} V(q) \\, dq $$\nWe can change the variable of integration to $s$ using $dq = Q_{total} \\, ds$:\n$$ E_{total} = \\int_{0}^{1} V(s) \\cdot Q_{total} \\, ds = Q_{total} \\left( \\int_{0}^{\\alpha} V_a \\, ds + \\int_{\\alpha}^{1} V_b \\, ds \\right) $$\n$$ E_{total} = Q_{total} \\left( V_a [s]_{0}^{\\alpha} + V_b [s]_{\\alpha}^{1} \\right) = Q_{total} (\\alpha V_a + (1-\\alpha)V_b) $$\nLet's define the average discharge voltage as $\\bar{V} = \\alpha V_a + (1-\\alpha)V_b$, so $E_{total} = \\bar{V} Q_{total}$.\n\nThe energy delivered up to an SoC of $s$, denoted $E(s)$, is given by:\n$$ E(s) = \\int_{0}^{s \\cdot Q_{total}} V(q') \\, dq' = Q_{total} \\int_{0}^{s} V(s') \\, ds' $$\nThis must be evaluated piecewise.\n\nFor $0 \\le s \\le \\alpha$:\n$$ E(s) = Q_{total} \\int_{0}^{s} V_a \\, ds' = Q_{total} V_a s $$\n\nFor $\\alpha  s \\le 1$:\n$$ E(s) = Q_{total} \\left( \\int_{0}^{\\alpha} V_a \\, ds' + \\int_{\\alpha}^{s} V_b \\, ds' \\right) = Q_{total} \\left( V_a \\alpha + V_b (s-\\alpha) \\right) $$\n\nThe State of Energy, SoE$(s)$, is the fraction of total energy delivered:\n$$ \\text{SoE}(s) = \\frac{E(s)}{E_{total}} = \\frac{E(s)}{Q_{total} \\bar{V}} $$\n\nFor $0 \\le s \\le \\alpha$:\n$$ \\text{SoE}(s) = \\frac{Q_{total} V_a s}{Q_{total} \\bar{V}} = \\frac{V_a}{\\bar{V}} s $$\n\nFor $\\alpha  s \\le 1$:\n$$ \\text{SoE}(s) = \\frac{Q_{total} (V_a \\alpha + V_b (s-\\alpha))}{Q_{total} \\bar{V}} = \\frac{\\alpha(V_a - V_b) + s V_b}{\\bar{V}} $$\n\nThe problem asks for the difference $\\Delta(s) = \\text{SoE}(s) - \\text{SoC}(s)$. Since $\\text{SoC}(s) = s$, we have:\n\nFor $0 \\le s \\le \\alpha$:\n$$ \\Delta(s) = \\frac{V_a}{\\bar{V}} s - s = s \\left( \\frac{V_a - \\bar{V}}{\\bar{V}} \\right) $$\nSubstituting $\\bar{V} = \\alpha V_a + (1-\\alpha) V_b$:\n$$ V_a - \\bar{V} = V_a - (\\alpha V_a + (1-\\alpha)V_b) = (1-\\alpha)V_a - (1-\\alpha)V_b = (1-\\alpha)(V_a - V_b) $$\nSo,\n$$ \\Delta(s) = s \\frac{(1-\\alpha)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\n\nFor $\\alpha  s \\le 1$:\n$$ \\Delta(s) = \\frac{\\alpha(V_a - V_b) + s V_b}{\\bar{V}} - s = \\frac{\\alpha(V_a - V_b) + s V_b - s \\bar{V}}{\\bar{V}} $$\nSubstituting for $s \\bar{V}$:\n$$ s \\bar{V} = s(\\alpha V_a + (1-\\alpha)V_b) = s \\alpha V_a + s V_b - s \\alpha V_b $$\nThe numerator becomes:\n$$ \\alpha(V_a - V_b) + s V_b - (s \\alpha V_a + s V_b - s \\alpha V_b) = \\alpha V_a - \\alpha V_b - s \\alpha V_a + s \\alpha V_b = \\alpha(V_a - V_b) (1-s) $$\nSo,\n$$ \\Delta(s) = \\frac{\\alpha(1-s)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\n\nIn summary, the expression for $\\Delta(s)$ is:\n$$ \\Delta(s) = \\frac{V_a - V_b}{\\alpha V_a + (1-\\alpha)V_b} \\times \\begin{cases} s(1-\\alpha)  \\text{for } 0 \\le s \\le \\alpha \\\\ \\alpha(1-s)  \\text{for } \\alpha  s \\le 1 \\end{cases} $$\nSince $V_a  V_b$, the prefactor is positive. The term inside the case is also non-negative for $s \\in [0,1]$. Thus, $\\Delta(s) \\ge 0$, and maximizing $|\\Delta(s)|$ is equivalent to maximizing $\\Delta(s)$.\nThe function $\\Delta(s)$ consists of two linear segments. For $s \\in [0, \\alpha]$, it increases linearly. For $s \\in [\\alpha, 1]$, it decreases linearly. The maximum value must therefore occur at the junction, $s=\\alpha$.\n$$ \\Delta_{max} = \\Delta(\\alpha) = \\frac{\\alpha(1-\\alpha)(V_a - V_b)}{\\alpha V_a + (1-\\alpha)V_b} $$\nNow, we substitute the specific values given: $\\alpha = 0.4$, $V_a = 3.7\\,\\text{V}$, and $V_b = 3.2\\,\\text{V}$.\n$$ \\Delta_{max} = \\frac{0.4(1-0.4)(3.7 - 3.2)}{0.4(3.7) + (1-0.4)(3.2)} $$\n$$ \\Delta_{max} = \\frac{0.4(0.6)(0.5)}{0.4(3.7) + 0.6(3.2)} $$\n$$ \\Delta_{max} = \\frac{0.12}{1.48 + 1.92} $$\n$$ \\Delta_{max} = \\frac{0.12}{3.40} $$\n$$ \\Delta_{max} = \\frac{12}{340} = \\frac{3}{85} \\approx 0.0352941176... $$\nRounding to four significant figures, we get $0.03529$.\nThis value represents the maximum absolute difference between the State of Energy and the State of Charge for the given cell model.",
            "answer": "$$\n\\boxed{0.03529}\n$$"
        },
        {
            "introduction": "Translating theoretical models into practical algorithms is a core task in automated battery simulation and management. This exercise moves from analytical derivation to computational implementation, asking you to construct an algorithm that tracks a battery's State of Energy (SoE) from a series of measurements. You will implement a path-dependent energy calculation that correctly handles the hysteresis between charge and discharge cycles, providing a hands-on experience in developing the logic at the heart of a modern Battery Management System.",
            "id": "3894029",
            "problem": "You are given a stored piecewise-linear map of battery terminal voltage as a function of charge for both charging and discharging major loops, and time-ordered measurement sequences of State of Charge (SoC) and voltage. Construct an algorithm that computes the State of Energy (SoE) as a dimensionless fraction of the maximum stored energy. The algorithm must be based on the following principles and definitions and must handle direction reversals (hysteresis loops) purely as path-dependent energy integrals.\n\nFundamental definitions and laws:\n- Let $Q$ denote charge in ampere-hours, and let $Q_{\\mathrm{nom}}$ denote nominal capacity in ampere-hours. Define State of Charge (SoC) as $s = Q/Q_{\\mathrm{nom}}$, so $s \\in [0,1]$.\n- Let $V(Q)$ denote terminal voltage as a function of charge. The differential energy change satisfies $dE = V(Q)\\,dQ$. Energy $E$ is measured in watt-hours.\n- For charging and discharging, the stored map provides two bounding curves $V_{\\mathrm{ch}}(Q)$ and $V_{\\mathrm{dis}}(Q)$, respectively, each given piecewise linearly over the SoC domain $s \\in [0,1]$.\n- Define maximum stored energy $E_{\\max}$ as the energy obtained by charging from $s=0$ to $s=1$ along the charging major loop, i.e., $$E_{\\max} = \\int_{0}^{Q_{\\mathrm{nom}}} V_{\\mathrm{ch}}(Q)\\,dQ = Q_{\\mathrm{nom}} \\int_{0}^{1} V_{\\mathrm{ch}}(s)\\,ds.$$\n- Define State of Energy (SoE) at a state with energy $E$ as $$\\mathrm{SoE} = \\frac{E}{E_{\\max}},$$ which is dimensionless and must be output as a decimal fraction.\n\nAlgorithmic requirements:\n- Given a sequence of time-ordered measurement pairs $\\{(s_i, V_i)\\}_{i=0}^{N}$ with $s_i \\in [0,1]$, infer the direction on each interval $[s_i,s_{i+1}]$ from $\\Delta s = s_{i+1}-s_i$. If $\\Delta s  0$, treat as charging and integrate along $V_{\\mathrm{ch}}(s)$; if $\\Delta s  0$, treat as discharging and integrate along $V_{\\mathrm{dis}}(s)$; if $\\Delta s = 0$, energy change is zero. This realizes hysteresis as path dependence: switching curves on reversals creates minor loops consistent with the stored major loops.\n- Use piecewise-linear interpolation over the given breakpoints $\\{s_k\\}$ to evaluate $V_{\\mathrm{ch}}(s)$ and $V_{\\mathrm{dis}}(s)$ and to compute exact trapezoidal areas for $\\int V(s)\\,ds$ over any interval $[s_i,s_{i+1}]$.\n- Initialize energy $E_0$ at the initial SoC $s_0$ by integrating from $0$ to $s_0$ along the charging curve: $$E_0 = Q_{\\mathrm{nom}} \\int_{0}^{s_0} V_{\\mathrm{ch}}(s)\\,ds.$$ This convention sets $E=0$ at empty ($s=0$) and $E=E_{\\max}$ at full ($s=1$).\n- When $\\Delta s = 0$, you may use the measured voltage to determine the current branch proximity (closer to $V_{\\mathrm{ch}}$ or $V_{\\mathrm{dis}}$) for memory, but the energy change remains zero because $dQ=0$; subsequent segments still use the sign of $\\Delta s$ to select the curve.\n- Express the final SoE values as decimal fractions (no unit) for each test case. Energy is internally computed in watt-hours; voltage in volts; charge in ampere-hours. No angle units appear.\n\nStored map:\n- Breakpoints in SoC: $$[0.0,\\,0.1,\\,0.3,\\,0.6,\\,0.85,\\,1.0].$$\n- Discharge curve voltages $V_{\\mathrm{dis}}(s)$ in volts at the breakpoints: $$[3.00,\\,3.30,\\,3.60,\\,3.75,\\,3.95,\\,4.10].$$\n- Charge curve voltages $V_{\\mathrm{ch}}(s)$ in volts at the breakpoints: $$[3.05,\\,3.35,\\,3.65,\\,3.80,\\,4.00,\\,4.15].$$\n- Nominal capacity: $$Q_{\\mathrm{nom}} = 2.5\\ \\mathrm{A\\cdot h}.$$\n\nNumerical integration directive:\n- Over any interval $[a,b] \\subset [0,1]$, compute $$\\int_a^b V(s)\\,ds$$ by subdividing $[a,b]$ at the stored breakpoints and summing trapezoidal areas $$\\frac{V(s_{\\ell})+V(s_{r})}{2}\\,(s_{r}-s_{\\ell}).$$ Multiply by $Q_{\\mathrm{nom}}$ to convert to watt-hours.\n\nTest suite:\n- Case 1 (happy path charging): sequence of $(s,V)$ is $$[(0.0,\\,3.05),\\ (0.5,\\,3.75)].$$\n- Case 2 (major loop discharge from full): sequence of $(s,V)$ is $$[(1.0,\\,4.10),\\ (0.2,\\,3.45)].$$\n- Case 3 (minor loop with reversal): sequence of $(s,V)$ is $$[(0.0,\\,3.05),\\ (0.6,\\,3.80),\\ (0.4,\\,3.65),\\ (0.8,\\,3.96)].$$\n- Case 4 (zero-step hold, voltage drift): sequence of $(s,V)$ is $$[(0.5,\\,3.75),\\ (0.5,\\,3.70)].$$\n- Case 5 (small reversals): sequence of $(s,V)$ is $$[(0.3,\\,3.65),\\ (0.32,\\,3.66),\\ (0.31,\\,3.605),\\ (0.33,\\,3.665)].$$\n\nYour program should compute the final $\\mathrm{SoE}$ for each of the five cases as described, rounding each to six decimal places. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"). Because $\\mathrm{SoE}$ is dimensionless, express the values as decimal fractions with six decimal places, and do not append any unit.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of electrochemistry and battery modeling, well-posed with a clear and complete set of definitions, data, and algorithmic requirements, and objective in its formulation. All necessary information is provided for the derivation and implementation of a unique, verifiable solution.\n\nThe task is to compute the State of Energy (SoE) for a battery, given a sequence of State of Charge (SoC) measurements. The SoE is defined as the ratio of the current energy stored, $E$, to the maximum possible stored energy, $E_{\\max}$. The calculation relies on path-dependent energy integration, accounting for hysteresis between charging and discharging.\n\nThe solution is constructed in the following steps:\n\n1.  **Representation of Voltage Curves**:\n    The problem provides two piecewise-linear functions, $V_{\\mathrm{ch}}(s)$ and $V_{\\mathrm{dis}}(s)$, representing the battery's terminal voltage during charging and discharging, respectively, as a function of SoC, $s$. These functions are defined by their values at a given set of breakpoints $s_k \\in [0, 1]$. For any SoC, $s$, the voltage can be determined by linear interpolation between the two nearest breakpoints. A function, which we can call `get_voltage(s, V_curve)`, can be defined to perform this interpolation. For example, if $s \\in [s_k, s_{k+1}]$, the voltage $V(s)$ is given by:\n    $$V(s) = V(s_k) + \\frac{V(s_{k+1}) - V(s_k)}{s_{k+1} - s_k} (s - s_k)$$\n\n2.  **General Energy Integral Formulation**:\n    The fundamental relation for energy change is $dE = V(Q) dQ$. In terms of SoC, $s = Q/Q_{\\mathrm{nom}}$, this becomes $dQ = Q_{\\mathrm{nom}} ds$, so $dE = Q_{\\mathrm{nom}} V(s) ds$. The energy change over a finite interval of SoC, $[a,b]$, is the integral:\n    $$\\Delta E = Q_{\\mathrm{nom}} \\int_{a}^{b} V(s)\\,ds$$\n    Since $V(s)$ is piecewise-linear, this integral can be computed exactly using the trapezoidal rule. The interval $[a,b]$ is subdivided by any of the predefined breakpoints $\\{s_k\\}$ that lie within it. For each subinterval $[s_{\\ell}, s_{r}]$, the integral is the area of a trapezoid:\n    $$\\int_{s_{\\ell}}^{s_{r}} V(s)\\,ds = \\frac{V(s_{\\ell}) + V(s_{r})}{2} (s_{r} - s_{\\ell})$$\n    The total integral is the sum of these areas over all subintervals. We will implement a function, `integrate_voltage(s_start, s_end, V_curve)`, to perform this calculation. This function correctly handles the sign of the integral based on the limits of integration; i.e., $\\int_a^b = -\\int_b^a$.\n\n3.  **Calculation of Maximum Energy ($E_{\\max}$)**:\n    As per the definition, $E_{\\max}$ is the energy stored when charging from $s=0$ to $s=1$ along the charge curve, $V_{\\mathrm{ch}}(s)$.\n    $$E_{\\max} = Q_{\\mathrm{nom}} \\int_{0}^{1} V_{\\mathrm{ch}}(s)\\,ds$$\n    This value is a constant for the given battery model and will serve as the denominator in all SoE calculations. Using the provided data:\n    -   $Q_{\\mathrm{nom}} = 2.5\\ \\mathrm{A\\cdot h}$\n    -   SoC breakpoints $s_k = [0.0, 0.1, 0.3, 0.6, 0.85, 1.0]$\n    -   Charge voltages $V_{\\mathrm{ch}}(s_k) = [3.05, 3.35, 3.65, 3.80, 4.00, 4.15]\\ \\mathrm{V}$\n    The integral $\\int_{0}^{1} V_{\\mathrm{ch}}(s)\\,ds$ is computed by summing the trapezoidal areas over the intervals defined by the breakpoints. This integral yields $3.72375\\ \\mathrm{V}$, so $E_{\\max} = 2.5 \\times 3.72375 = 9.309375\\ \\mathrm{W\\cdot h}$.\n\n4.  **Path-Dependent Energy Calculation Algorithm**:\n    For each test case, we are given a time-ordered sequence of SoC measurements, $\\{(s_i, V_i)\\}_{i=0}^{N}$. The energy $E_N$ at the final state $s_N$ is calculated iteratively.\n    -   **Initialization**: The initial energy $E_0$ corresponding to the initial state $s_0$ is calculated by convention as the energy required to charge from $s=0$ to $s=0$ along the charging curve:\n        $$E_0 = Q_{\\mathrm{nom}} \\int_{0}^{s_0} V_{\\mathrm{ch}}(s)\\,ds$$\n    -   **Iteration**: The energy is updated for each step in the sequence from $i=0$ to $N-1$. The energy at step $i+1$ is $E_{i+1} = E_i + \\Delta E_i$. The energy change $\\Delta E_i$ is determined by the change in SoC, $\\Delta s = s_{i+1} - s_i$:\n        -   If $\\Delta s  0$ (charging), the energy change is integrated along the charging curve:\n            $$\\Delta E_i = Q_{\\mathrm{nom}} \\int_{s_i}^{s_{i+1}} V_{\\mathrm{ch}}(s)\\,ds$$\n        -   If $\\Delta s  0$ (discharging), the energy change is integrated along the discharging curve. The integral will be negative as the upper limit is less than the lower limit:\n            $$\\Delta E_i = Q_{\\mathrm{nom}} \\int_{s_i}^{s_{i+1}} V_{\\mathrm{dis}}(s)\\,ds$$\n        -   If $\\Delta s = 0$, the energy change is zero: $\\Delta E_i = 0$. The measured voltages $V_i$ are not used in the energy calculation, per the problem's explicit algorithmic rules.\n\n5.  **Final State of Energy (SoE) Calculation**:\n    After iterating through the entire sequence of SoC measurements, the final energy $E_N$ is obtained. The final SoE is then computed as:\n    $$\\mathrm{SoE} = \\frac{E_N}{E_{\\max}}$$\n    This procedure is applied to each test case to find the corresponding final SoE, which is then rounded to six decimal places.\n\nThis systematic, principle-based approach ensures that the calculation adheres strictly to the physical definitions and algorithmic constraints laid out in the problem statement.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the battery State of Energy (SoE) problem for a given set of test cases.\n    \"\"\"\n    # Stored map data from the problem statement.\n    SOC_BREAKPOINTS = np.array([0.0, 0.1, 0.3, 0.6, 0.85, 1.0])\n    V_DIS = np.array([3.00, 3.30, 3.60, 3.75, 3.95, 4.10])\n    V_CH = np.array([3.05, 3.35, 3.65, 3.80, 4.00, 4.15])\n    Q_NOM = 2.5  # Ampere-hours\n\n    # Test suite from the problem statement. Only SoC values are needed for calculation.\n    test_cases = [\n        [s for s, v in [(0.0, 3.05), (0.5, 3.75)]],\n        [s for s, v in [(1.0, 4.10), (0.2, 3.45)]],\n        [s for s, v in [(0.0, 3.05), (0.6, 3.80), (0.4, 3.65), (0.8, 3.96)]],\n        [s for s, v in [(0.5, 3.75), (0.5, 3.70)]],\n        [s for s, v in [(0.3, 3.65), (0.32, 3.66), (0.31, 3.605), (0.33, 3.665)]],\n    ]\n\n    def integrate_voltage(s_start, s_end, v_curve):\n        \"\"\"\n        Computes the integral of a piecewise-linear voltage curve from s_start to s_end.\n        The integral is computed exactly using the trapezoidal rule over segments\n        defined by the global SOC_BREAKPOINTS.\n        \"\"\"\n        if s_start == s_end:\n            return 0.0\n\n        # Ensure s1  s2 for easier logic, handle direction at the end.\n        s1, s2 = min(s_start, s_end), max(s_start, s_end)\n\n        # Collect all points for integration: start, end, and internal breakpoints.\n        points = [s1]\n        for bp in SOC_BREAKPOINTS:\n            if s1  bp  s2:\n                points.append(bp)\n        points.append(s2)\n        \n        # Ensure unique sorted points.\n        points = sorted(list(set(points)))\n\n        # Interpolate voltages at these points using the provided curve.\n        voltages = np.interp(points, SOC_BREAKPOINTS, v_curve)\n\n        # Compute the integral using the trapezoidal rule.\n        integral_val = np.trapz(voltages, x=points)\n        \n        # Adjust sign based on the original integration direction.\n        if s_end  s_start:\n            return -integral_val\n        else:\n            return integral_val\n\n    # 1. Calculate maximum stored energy (E_max)\n    integral_e_max = integrate_voltage(0.0, 1.0, V_CH)\n    E_max = Q_NOM * integral_e_max\n\n    results = []\n    for soc_sequence in test_cases:\n        # 2. Calculate initial energy E_0 based on the first SoC point s_0\n        s0 = soc_sequence[0]\n        current_energy = Q_NOM * integrate_voltage(0.0, s0, V_CH)\n\n        # 3. Iteratively update energy based on the path\n        for i in range(len(soc_sequence) - 1):\n            s_i = soc_sequence[i]\n            s_i_plus_1 = soc_sequence[i+1]\n            \n            delta_s = s_i_plus_1 - s_i\n            delta_e = 0.0\n\n            if delta_s  0:  # Charging\n                delta_e = Q_NOM * integrate_voltage(s_i, s_i_plus_1, V_CH)\n            elif delta_s  0:  # Discharging\n                delta_e = Q_NOM * integrate_voltage(s_i, s_i_plus_1, V_DIS)\n            # if delta_s is 0, delta_e remains 0.\n\n            current_energy += delta_e\n        \n        # 4. Calculate final State of Energy (SoE)\n        final_soe = current_energy / E_max if E_max != 0 else 0.0\n        results.append(round(final_soe, 6))\n\n    # Final print statement in the exact required format.\n    # Format to string with 6 decimal places, handling potential trailing zeros.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}