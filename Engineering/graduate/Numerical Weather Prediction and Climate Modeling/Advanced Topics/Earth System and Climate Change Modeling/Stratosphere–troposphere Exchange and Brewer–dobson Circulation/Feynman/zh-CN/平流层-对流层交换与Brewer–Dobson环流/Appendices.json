{
    "hands_on_practices": [
        {
            "introduction": "波-流相互作用是驱动布鲁尔-多布森环流的引擎。向上传播的重力波输送动量，并在其破碎的地方将动量沉积下来，从而加速平均气流。这项练习旨在巩固波属性与大尺度环流之间的理论联系，通过计算动量通量及由此产生的加速度，您将对这一基本驱动机制获得定量的理解 ()。",
            "id": "4095869",
            "problem": "考虑一个在西风急流的赤道至副热带一侧、稳定层结大气中向上传播的小振幅二维内重力波包。使用Boussinesq近似和线性动力学对流动进行建模，并忽略行星旋转。设纬向和垂直速度扰动分别用$u'(x,z,t)$和$w'(x,z,t)$表示，并假设一个单色平面波结构$w'(x,z,t) = \\Re\\{\\hat{w}\\exp[i(k x + m z - \\omega t)]\\}$，其中波数$k$和$m$以及频率$\\omega$均为实值。雷诺平均算子$\\overline{(\\cdot)}$是对多个波周期进行的时间或相位平均。与波相关的水平（纬向）动量的垂直通量为$\\rho\\,\\overline{u'w'}$，其中$\\rho$是环境密度。在转换欧拉平均（TEM）公式下，由波与平均流相互作用引起的纬向平均纬向风趋势项为$-(1/\\rho)\\,\\partial\\big(\\rho\\,\\overline{u'w'}\\big)/\\partial z$。\n\n从线性化的Boussinesq方程和质量连续性方程出发，推导一个用复振幅$\\hat{w}$以及波数$k$和$m$表示$\\overline{u'w'}$的表达式，然后使用以下科学上合理的参数，计算在急流核心层下边缘处产生的垂直通量$\\rho\\,\\overline{u'w'}$：\n- 水平波数 $k = 1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1}$，\n- 垂直波数 $m = -1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}$，\n- 垂直速度振幅 $|\\hat{w}| = 5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$，\n- 层下边缘的密度 $\\rho_{\\mathrm{b}} = 1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$。\n\n假设波在急流核心层内遇到一个临界层并被完全吸收，因此该层上边缘的垂直通量为零，且该层厚度为$\\Delta z = 5.0 \\times 10^{3}\\ \\mathrm{m}$。使用TEM平均流强迫，通过将垂直导数近似为有限差分，并使用层平均密度$\\rho_{\\mathrm{avg}} = 1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$，计算穿过该层的相应纬向平均纬向加速度。将垂直动量通量和纬向平均加速度均四舍五入至三位有效数字。通量以帕斯卡（Pascals）为单位表示，加速度以$\\mathrm{m}\\,\\mathrm{s}^{-2}$为单位表示。您的最终答案必须是一个计算结果，并报告所要求的两个量。",
            "solution": "该问题陈述被评估为有效。其科学基础是大气流体动力学原理，特别是内重力波理论及其与平均流的相互作用。该问题是适定的，提供了所有必要的参数和明确的目标。语言客观，参数物理上合理。任务是基于基本方程推导和计算物理量，这是一个标准且可验证的过程。\n\n我们首先推导水平动量的垂直通量（通常称为雷诺应力分量$\\overline{u'w'}$）的表达式。问题陈述要求使用线性化的Boussinesq方程，并忽略旋转。关联速度分量$u'$和$w'$的最直接途径是通过不可压缩流体的质量连续性方程（Boussinesq近似的一个核心组成部分）：\n$$\n\\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0\n$$\n速度扰动以单色平面波的形式给出。我们可以将$u'$和$w'$都写成复数形式，并理解物理量是其实部：\n$$\nu'(x,z,t) = \\Re\\{\\hat{u}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n$$\nw'(x,z,t) = \\Re\\{\\hat{w}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n此处，$\\hat{u}$和$\\hat{w}$分别是纬向和垂直速度的复振幅。将这些形式代入连续性方程需要求导：\n$$\n\\frac{\\partial u'}{\\partial x} = \\Re\\{i k \\hat{u}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n$$\n\\frac{\\partial w'}{\\partial z} = \\Re\\{i m \\hat{w}\\exp[i(k x + m z - \\omega t)]\\}\n$$\n将它们相加得到：\n$$\n\\Re\\{i(k\\hat{u} + m\\hat{w})\\exp[i(k x + m z - \\omega t)]\\} = 0\n$$\n为使该方程对所有$x$、$z$和$t$成立，乘以指数的复数项必须为零。这提供了复振幅之间的关系：\n$$\nk\\hat{u} + m\\hat{w} = 0 \\implies \\hat{u} = -\\frac{m}{k}\\hat{w}\n$$\n接下来，我们计算时间平均乘积$\\overline{u'w'}$。对于两个一般的振荡量$A(t) = \\Re\\{\\hat{A}\\exp(-i\\omega t)\\}$和$B(t) = \\Re\\{\\hat{B}\\exp(-i\\omega t)\\}$，在一个或多个周期上的时间平均由$\\overline{A B} = \\frac{1}{2}\\Re\\{\\hat{A}\\hat{B}^*\\}$给出，其中$\\hat{B}^*$是$\\hat{B}$的复共轭。在我们的情况中，包含空间依赖性的完整复振幅是$\\hat{u}\\exp[i(kx+mz)]$和$\\hat{w}\\exp[i(kx+mz)]$。时间平均与空间坐标无关，因此我们有：\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{ \\left( \\hat{u}\\exp[i(kx+mz)] \\right) \\left( \\hat{w}\\exp[i(kx+mz)] \\right)^* \\}\n$$\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{ \\hat{u}\\exp[i(kx+mz)] \\hat{w}^*\\exp[-i(kx+mz)] \\} = \\frac{1}{2}\\Re\\{\\hat{u}\\hat{w}^*\\}\n$$\n现在，我们代入从连续性方程推导出的$\\hat{u}$的关系式：\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\left\\{\\left(-\\frac{m}{k}\\hat{w}\\right)\\hat{w}^*\\right\\} = \\frac{1}{2}\\Re\\left\\{-\\frac{m}{k}(\\hat{w}\\hat{w}^*)\\right\\}\n$$\n由于$\\hat{w}\\hat{w}^* = |\\hat{w}|^2$，且波数$k$和$m$是实数，实部算子内部的表达式完全是实数。因此，我们得到了第一个所要求的表达式：\n$$\n\\overline{u'w'} = -\\frac{m}{2k}|\\hat{w}|^2\n$$\n水平动量的垂直通量为$F_m = \\rho\\,\\overline{u'w'}$。题目要求我们计算其在急流核心层下边缘的值，我们用下标$b$表示。\n$$\nF_{m,b} = \\rho_b \\left( -\\frac{m}{2k}|\\hat{w}|^2 \\right)\n$$\n我们代入给定的数值：\n- 水平波数 $k = 1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1}$\n- 垂直波数 $m = -1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}$\n- 垂直速度振幅 $|\\hat{w}| = 5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 层下边缘的密度 $\\rho_b = 1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n\n首先，我们计算括号中的项：\n$$\n-\\frac{m}{2k}|\\hat{w}|^2 = -\\frac{-1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1}}{2(1.0 \\times 10^{-5}\\ \\mathrm{m}^{-1})} (5.0 \\times 10^{-2}\\ \\mathrm{m}\\,\\mathrm{s}^{-1})^2\n$$\n$$\n= \\frac{1.0 \\times 10^{-3}}{2.0 \\times 10^{-5}} (2.5 \\times 10^{-3}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = (50) \\times (2.5 \\times 10^{-3}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = 1.25 \\times 10^{-1}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}\n$$\n现在，我们计算通量：\n$$\nF_{m,b} = (1.8 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}) \\times (1.25 \\times 10^{-1}\\ \\mathrm{m}^2\\,\\mathrm{s}^{-2}) = 2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}\n$$\n单位$\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}$等价于帕斯卡（$\\mathrm{Pa}$），正如题目所要求的。四舍五入到三位有效数字，通量为$2.25 \\times 10^{-2}\\ \\mathrm{Pa}$。\n\n最后，我们计算穿过该层的纬向平均纬向加速度。强迫项由转换欧拉平均（TEM）表达式给出：\n$$\na = -\\frac{1}{\\rho}\\frac{\\partial(\\rho\\,\\overline{u'w'})}{\\partial z}\n$$\n我们使用厚度为$\\Delta z$的层上的有限差分来近似这个值，并使用层平均密度$\\rho_{\\mathrm{avg}}$：\n$$\na \\approx -\\frac{1}{\\rho_{\\mathrm{avg}}} \\frac{\\Delta(\\rho\\,\\overline{u'w'})}{\\Delta z} = -\\frac{1}{\\rho_{\\mathrm{avg}}} \\frac{(\\rho\\,\\overline{u'w'})_{\\text{top}} - (\\rho\\,\\overline{u'w'})_{\\text{bottom}}}{\\Delta z}\n$$\n问题陈述指出波在该层内被完全吸收，这意味着层顶的动量通量为零：$(\\rho\\,\\overline{u'w'})_{\\text{top}} = 0$。层底的通量是我们刚刚计算出的值$F_{m,b}$。\n给定的参数是：\n- $(\\rho\\,\\overline{u'w'})_{\\text{bottom}} = 2.25 \\times 10^{-2}\\ \\mathrm{Pa}$\n- $\\rho_{\\mathrm{avg}} = 1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $\\Delta z = 5.0 \\times 10^{3}\\ \\mathrm{m}$\n\n将这些值代入加速度的近似公式中：\n$$\na \\approx -\\frac{1}{1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}} \\frac{0 - (2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2})}{5.0 \\times 10^{3}\\ \\mathrm{m}}\n$$\n$$\na \\approx \\frac{2.25 \\times 10^{-2}\\ \\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}}{(1.5 \\times 10^{-1}\\ \\mathrm{kg}\\,\\mathrm{m}^{-3}) \\times (5.0 \\times 10^{3}\\ \\mathrm{m})}\n$$\n$$\na \\approx \\frac{2.25 \\times 10^{-2}}{7.5 \\times 10^{2}} \\frac{\\mathrm{kg}\\,\\mathrm{m}^{-1}\\,\\mathrm{s}^{-2}}{\\mathrm{kg}\\,\\mathrm{m}^{-2}} = 0.3 \\times 10^{-4}\\ \\mathrm{m}\\,\\mathrm{s}^{-2} = 3.0 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-2}\n$$\n四舍五入到三位有效数字，加速度为$3.00 \\times 10^{-5}\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 2.25 \\times 10^{-2}  3.00 \\times 10^{-5} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "平流层-对流层交换 (Stratosphere-Troposphere Exchange, STE) 关键取决于作为输送屏障的对流层顶的位置。然而，对流层顶并非一个简单的表面，可以通过多种方式定义，例如基于热力学递减率或位涡。本练习 () 将揭示诊断性定义的选取会如何显著改变关于输送通量的科学结论。通过实施并比较不同的对流层顶定义，您将学会批判性地评估大气诊断中的不确定性来源。",
            "id": "4095866",
            "problem": "考虑一个由 $N_x$ 个独立气柱组成的高度理想化的纬向带，每个气柱都在 $N_z$ 个固定的几何高度层上进行离散化。目的是诊断一种类臭氧被动示踪剂，穿过由不同定义和阈值诊断出的对流层顶的瞬时向下平流层-对流层交换 (STE) 通量，并量化其对位涡 (PV) 阈值和温度垂直递减率标准的敏感性。该诊断必须从基本原理和核心定义开始，所有计算都必须以国际单位制 (SI) 单位表示。最终程序必须为固定的测试套件生成结果。\n\n本问题的基本依据如下。\n\n- 示踪剂穿过一个物质面的瞬时垂直质量通量，根据连续性方程和输运方程定义为空气密度、垂直速度和示踪剂质量混合比乘积的面积分。对于一个在几何高度 $z = z_{\\mathrm{tp}}(x)$ 处由水平面近似并在离散层上诊断的界面，区域积分的向下示踪剂通量可近似为：\n$$\n\\mathcal{F}_{\\downarrow} \\approx \\sum_{i=1}^{N_x} \\rho_i(z_{\\mathrm{tp}, i}) \\, \\max\\left(-w_i(z_{\\mathrm{tp}, i}), 0\\right) \\, \\chi_i(z_{\\mathrm{tp}, i}) \\, \\Delta A_i,\n$$\n其中 $\\rho$ 是空气密度，单位为 $\\mathrm{kg\\, m^{-3}}$；$w$ 是垂直速度，单位为 $\\mathrm{m\\, s^{-1}}$（向上为正）；$\\chi$ 是示踪剂质量混合比，单位为 $\\mathrm{kg\\, kg^{-1}}$；$\\Delta A_i$ 是气柱面积，单位为 $\\mathrm{m^2}$。量 $\\mathcal{F}_{\\downarrow}$ 的单位是 $\\mathrm{kg\\, s^{-1}}$。\n\n- 几何对流层顶通过三种方式进行诊断，每种方式都会得出一个指数 $k_{\\mathrm{tp}, i}$，对应于高度为 $z_{k_{\\mathrm{tp}, i}}$ 的离散模式层。\n\n  1. 基于 PV 的定义：给定一个以位涡单位 (PVU) 表示的 PV 阈值 $q_t$，其中 $1\\,\\mathrm{PVU} = 10^{-6}\\,\\mathrm{K\\, m^2\\, kg^{-1}\\, s^{-1}}$，找到随高度增加的第一个层指数 $k$，使得 $q_i(k) \\ge q_t$ 并且 $k = 0$ 或 $q_i(k-1)  q_t$。如果不存在这样的穿越点，则将 $k_{\\mathrm{tp}, i}$ 赋为最高层的指数。\n\n  2. 温度垂直递减率定义：将相邻层之间的离散递减率定义为\n  $$\n  \\Gamma_i(k) = -\\frac{T_i(k+1) - T_i(k)}{z_{k+1} - z_k} \\times 10^{3},\n  $$\n  单位为 $\\mathrm{K\\, km^{-1}}$，对于 $k \\in \\{0,\\dots,N_z-2\\}$。给定一个阈值 $\\gamma_t$（单位为 $\\mathrm{K\\, km^{-1}}$），找到第一个满足 $\\Gamma_i(k) \\le \\gamma_t$ 的 $k$，并设置 $k_{\\mathrm{tp}, i} = k + 1$。如果不存在这样的指数，则将 $k_{\\mathrm{tp}, i}$ 赋为最高层的指数。\n\n  3. 混合定义：在基于 PV 和基于温度的指数都可用时计算它们，并选择高度更高的那一个，即 $z_{k_{\\mathrm{tp}, i}}$ 更大的那一个。如果只有一个可用，则使用它；如果两个都未找到，则赋为最高层的指数。\n\n合成区域和场定义如下。\n\n- 气柱数量为 $N_x = 4$。垂直层数为 $N_z = 10$。层高为\n$$\nz_k = 6000 + 1000\\,k \\quad \\text{for } k \\in \\{0,1,\\dots,9\\},\n$$\n单位为米。\n\n- 每个气柱 $i \\in \\{0,1,2,3\\}$ 有一个依赖于气柱的对流层顶高度\n$$\nz_{\\mathrm{tp}, i}^{\\star} = 10000 + 500\\,(i - 1.5),\n$$\n单位为米。\n\n- 开尔文温度 $T_i(k)$ 是由 $z_{\\mathrm{tp}, i}^{\\star}$ 以下的对流层递减率和之上的弱平流层顶递减率构建的：\n  - 定义 $z_0 = 6000\\,\\mathrm{m}$ 处的基础温度为 $T_{0,i} = 245 - 2\\,i$，单位为开尔文。\n  - 对于 $z_k \\le z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_k - 6000}{1000}.\n  $$\n  - 对于 $z_k  z_{\\mathrm{tp}, i}^{\\star}$，令\n  $$\n  T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_{\\mathrm{tp}, i}^{\\star} - 6000}{1000} - 1.0 \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000}.\n  $$\n\n- 以 PVU 为单位的位涡 $q_i(k)$ 定义为\n$$\nq_i(k) = \\left(0.5 + 0.15\\,k + 0.1\\,i\\right) + \\Delta q_i(k), \\quad \\Delta q_i(k) = \\begin{cases}\n0,  z_k  z_{\\mathrm{tp}, i}^{\\star},\\\\\n2.0,  z_k \\ge z_{\\mathrm{tp}, i}^{\\star}.\n\\end{cases}\n$$\n\n- 以 $\\mathrm{m\\, s^{-1}}$ 为单位的垂直速度 $w_i(k)$ 由下式指定\n$$\nw_i(k) = 0.02 \\,\\sin\\!\\left(\\frac{\\pi}{4} \\left(\\frac{z_k}{1000} - 6 + 0.5\\,i\\right)\\right) - 0.005.\n$$\n\n- 以 $\\mathrm{kg\\, kg^{-1}}$ 为单位的示踪剂质量混合比 $\\chi_i(k)$ 随高度增加，并在对流层顶有一个小阶跃：\n  - 对于 $z_k \\le z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  \\chi_i(k) = 4\\times 10^{-6} + 0.5\\times 10^{-6} \\times \\frac{z_k - 6000}{1000}.\n  $$\n  - 对于 $z_k  z_{\\mathrm{tp}, i}^{\\star}$，\n  $$\n  \\chi_i(k) = \\left[4\\times 10^{-6} + 0.5\\times 10^{-6} \\times \\frac{z_{\\mathrm{tp}, i}^{\\star} - 6000}{1000}\\right] + 3\\times 10^{-6} + 0.3\\times 10^{-6} \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000}.\n  $$\n\n- 以 $\\mathrm{kg\\, m^{-3}}$ 为单位的空气密度 $\\rho_i(k)$ 随高度呈指数变化，并带有一个依赖于气柱的前置因子：\n  - 定义在 $z = 6000\\,\\mathrm{m}$ 处的密度为 $\\rho_{6,i} = 0.66 \\times \\left(1 + 0.03\\,(i - 1.5)\\right)$。\n  - 设标高为 $H = 7000\\,\\mathrm{m}$，对于任意 $z_k$，\n  $$\n  \\rho_i(k) = \\rho_{6,i}\\,\\exp\\!\\left(-\\frac{z_k - 6000}{H}\\right).\n  $$\n\n- 每个气柱代表相等的面积 $\\Delta A_i = \\Delta A = 10^{10}\\,\\mathrm{m^2}$。\n\n使用这些定义，实现一个算法，对于给定的诊断类型和阈值，确定每个气柱中的对流层顶层 $k_{\\mathrm{tp}, i}$，评估 $\\rho_i(k_{\\mathrm{tp}, i})$、$w_i(k_{\\mathrm{tp}, i})$ 和 $\\chi_i(k_{\\mathrm{tp}, i})$ 的值，并按规定计算总的向下示踪剂通量 $\\mathcal{F}_{\\downarrow}$（单位为 $\\mathrm{kg\\, s^{-1}}$）。如果如上定义的 PV 穿越点或温度标准未被满足，则对该方法使用最高层作为对流层顶；对于混合方法，在可用方法中选择海拔最高的，如果两种方法均未得出对流层顶层，则退回到最高层。\n\n测试套件和输出要求：\n\n- 你的程序的输入是固定的，由以下 8 个测试用例列表给出，每个用例是一个三元组 $(\\text{def}, q_t, \\gamma_t)$：\n  - 用例 1：基于 PV, $(\\text{\"PV\"}, 2.0, 2.0)$,\n  - 用例 2：基于 PV, $(\\text{\"PV\"}, 3.5, 2.0)$,\n  - 用例 3：基于温度, $(\\text{\"TH\"}, 2.0, 2.0)$,\n  - 用例 4：基于温度, $(\\text{\"TH\"}, 2.0, 1.5)$,\n  - 用例 5：混合, $(\\text{\"HYB\"}, 2.0, 2.0)$,\n  - 用例 6：混合, $(\\text{\"HYB\"}, 3.5, 1.5)$,\n  - 用例 7：基于 PV 的高阈值边缘情况, $(\\text{\"PV\"}, 6.0, 2.0)$,\n  - 用例 8：基于温度的严格标准边缘情况, $(\\text{\"TH\"}, 2.0, 0.5)$。\n\n- 对每个用例，计算 $\\mathcal{F}_{\\downarrow}$（单位为 $\\mathrm{kg\\, s^{-1}}$），四舍五入到 6 位小数。\n\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，结果顺序与测试套件相同（例如，$[\\text{result}_1,\\text{result}_2,\\dots,\\text{result}_8]$）。不允许有其他输出。\n\n本问题不使用角度，也没有百分比。所有输出必须按规定以 $\\mathrm{kg\\, s^{-1}}$ 为单位报告，并四舍五入到六位小数。",
            "solution": "该问题要求计算被动示踪剂穿过一个诊断出的对流层顶的瞬时向下平流层-对流层交换 (STE) 通量。计算在一个合成的、理想化的二维区域上进行。解决方案包括三个主要阶段：首先，构建离散的大气状态变量；其次，根据三种不同的定义诊断对流层顶高度；第三，通过对每个大气气柱的贡献求和来计算总的向下通量。\n\n首先，我们建立计算域和离散化。该域由 $N_x = 4$ 个独立的垂直气柱组成，索引为 $i \\in \\{0, 1, 2, 3\\}$。每个气柱被离散化为 $N_z = 10$ 个垂直层，索引为 $k \\in \\{0, 1, \\dots, 9\\}$。每个层 $z_k$ 的几何高度由公式 $z_k = 6000 + 1000k$ 给出，其中 $z_k$ 的单位是米。与每个气柱相关的面积是一个常数，$\\Delta A = 10^{10}\\,\\mathrm{m^2}$。\n\n接下来，我们为每个气柱 $i$ 和层 $k$ 生成所需的物理场。这些场是温度 $T_i(k)$、位涡 $q_i(k)$、垂直速度 $w_i(k)$、示踪剂质量混合比 $\\chi_i(k)$ 和空气密度 $\\rho_i(k)$。这些定义是基于一个依赖于气柱的参考对流层顶高度 $z_{\\mathrm{tp}, i}^{\\star} = 10000 + 500(i - 1.5)\\,\\mathrm{m}$ 进行参数化的。\n\n温度场 $T_i(k)$ 是分段定义的。在 $z_0 = 6000\\,\\mathrm{m}$ 的基础温度设置为 $T_{0,i} = 245 - 2i\\,\\mathrm{K}$。在 $z_{\\mathrm{tp}, i}^{\\star}$ 以下，温度遵循一个恒定的 $6.5\\,\\mathrm{K\\,km^{-1}}$ 的递减率：\n$$ T_i(k) = T_{0,i} - 6.5 \\times \\frac{z_k - 6000}{1000} \\quad \\text{for } z_k \\le z_{\\mathrm{tp}, i}^{\\star}. $$\n在 $z_{\\mathrm{tp}, i}^{\\star}$ 以上，大气更稳定，递减率为 $-1.0\\,\\mathrm{K\\,km^{-1}}$（即温度以 $1.0\\,\\mathrm{K\\,km^{-1}}$ 的速率递减）：\n$$ T_i(k) = T(z_{\\mathrm{tp}, i}^{\\star}) - 1.0 \\times \\frac{z_k - z_{\\mathrm{tp}, i}^{\\star}}{1000} \\quad \\text{for } z_k  z_{\\mathrm{tp}, i}^{\\star}, $$\n其中 $T(z_{\\mathrm{tp}, i}^{\\star})$ 是在参考对流层顶高度处的温度，使用对流层廓线计算。\n\n位涡 $q_i(k)$（单位为位涡单位 PVU）由一个随层指数 $k$ 线性增加并随气柱指数 $i$ 变化的背景廓线，加上在参考对流层顶高度 $z_{\\mathrm{tp}, i}^{\\star}$ 及以上的一个 $2.0\\,\\mathrm{PVU}$ 的急剧增加构成：\n$$ q_i(k) = (0.5 + 0.15k + 0.1i) + \\Delta q_i(k), \\quad \\text{where } \\Delta q_i(k) = \\begin{cases} 0,  z_k  z_{\\mathrm{tp}, i}^{\\star} \\\\ 2.0,  z_k \\ge z_{\\mathrm{tp}, i}^{\\star} \\end{cases}. $$\n\n垂直速度 $w_i(k)$（单位为 $\\mathrm{m\\,s^{-1}}$）由一个关于高度和气柱指数的正弦函数，加上一个恒定的向下偏移量给出：\n$$ w_i(k) = 0.02 \\sin\\left(\\frac{\\pi}{4} \\left(\\frac{z_k}{1000} - 6 + 0.5i\\right)\\right) - 0.005. $$\n\n示踪剂质量混合比 $\\chi_i(k)$（单位为 $\\mathrm{kg\\,kg^{-1}}$）是分段定义的，在 $z_{\\mathrm{tp}, i}^{\\star}$ 上下有不同的梯度，并在过渡处包含一个 $3 \\times 10^{-6}\\,\\mathrm{kg\\,kg^{-1}}$ 的阶跃增长，以模拟平流层示踪剂。\n\n空气密度 $\\rho_i(k)$（单位为 $\\mathrm{kg\\,m^{-3}}$）随高度呈指数衰减（等温大气近似），具有指定的标高 $H = 7000\\,\\mathrm{m}$ 和在基础高度 $z_0=6000\\,\\mathrm{m}$ 处依赖于气柱的参考密度 $\\rho_{6,i} = 0.66(1 + 0.03(i-1.5))\\,\\mathrm{kg\\,m^{-3}}$：\n$$ \\rho_i(k) = \\rho_{6,i} \\exp\\left(-\\frac{z_k - 6000}{H}\\right). $$\n\n在物理场定义之后，算法的核心是根据三种方法之一为每个气柱 $i$ 诊断对流层顶的层指数 $k_{\\mathrm{tp}, i}$。\n\n1.  基于 PV 的定义：对于给定的 PV 阈值 $q_t$，我们搜索最低的层指数 $k \\in \\{0, \\dots, N_z-1\\}$，使得 $q_i(k) \\ge q_t$ 并且 $k=0$ 或 $q_i(k-1)  q_t$。如果找不到这样的层，则将对流层顶赋给最高的模式层，即 $k_{\\mathrm{tp}, i} = N_z - 1$。\n\n2.  温度垂直递减率定义：首先，我们使用公式 $\\Gamma_i(k) = -\\frac{T_i(k+1) - T_i(k)}{z_{k+1} - z_k} \\times 1000$ 计算相邻层之间的递减率 $\\Gamma_i(k)$（单位为 $\\mathrm{K\\,km^{-1}}$），其中 $k \\in \\{0, \\dots, N_z-2\\}$。由于 $z_{k+1} - z_k = 1000\\,\\mathrm{m}$，这可以简化为 $\\Gamma_i(k) = -(T_i(k+1) - T_i(k))$。对于给定的阈值 $\\gamma_t$，我们找到满足 $\\Gamma_i(k) \\le \\gamma_t$ 的最低指数 $k$。然后将对流层顶层设置为 $k_{\\mathrm{tp}, i} = k + 1$。如果这个条件从未满足，我们再次默认使用最高层，即 $k_{\\mathrm{tp}, i} = N_z - 1$。\n\n3.  混合定义：此方法综合了 PV 定义和温度定义。我们首先尝试使用两种方法寻找对流层顶。设这两个指数为 $k_{\\mathrm{pv}}$ 和 $k_{\\mathrm{th}}$，我们跟踪每一个是通过真正的阈值穿越找到的，还是通过默认设置为最高层找到的。\n    - 如果两种方法都得到一个有效的穿越点，我们选择对应于更高几何高度的那一个，即更大的层指数。\n    - 如果只有一种方法得到有效的穿越点，我们使用其结果指数。\n    - 如果两种方法都未找到穿越点，我们使用默认的最高层指数 $N_z - 1$。\n\n最后，对于每个测试用例，我们计算总的向下示踪剂通量 $\\mathcal{F}_{\\downarrow}$。对于给定的对流层顶定义及其相关阈值，我们遍历每个气柱 $i=0, \\dots, N_x-1$：a. 确定对流层顶层指数 $k_{\\mathrm{tp}, i}$。b. 在该层检索密度 $\\rho_i(k_{\\mathrm{tp}, i})$、垂直速度 $w_i(k_{\\mathrm{tp}, i})$ 和示踪剂混合比 $\\chi_i(k_{\\mathrm{tp}, i})$ 的值。c. 计算来自该气柱的向下通量贡献。这仅在向下运动（$w_i  0$）时非零。贡献值为 $\\rho_i(k_{\\mathrm{tp}, i}) \\times \\max(-w_i(k_{\\mathrm{tp}, i}), 0) \\times \\chi_i(k_{\\mathrm{tp}, i}) \\times \\Delta A$。d. 将所有气柱的这些贡献相加，以获得总通量 $\\mathcal{F}_{\\downarrow}$（单位为 $\\mathrm{kg\\,s^{-1}}$）。\n\n每个测试用例的最终结果按照规定四舍五入到 6 位小数。整体算法通过在网格上预先计算所有物理场，然后对测试套件中的每个用例应用诊断程序来实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes stratosphere-troposphere exchange flux for a suite of test cases.\n    \"\"\"\n    # 1. Define domain and constants\n    Nx = 4\n    Nz = 10\n    i_indices = np.arange(Nx)\n    k_indices = np.arange(Nz)\n    \n    z_k = 6000.0 + 1000.0 * k_indices  # meters\n    DeltaA = 1.0e10  # m^2\n    H = 7000.0  # meters\n\n    # 2. Generate the physical fields\n    \n    # Pre-allocate arrays\n    T = np.zeros((Nx, Nz))\n    q = np.zeros((Nx, Nz))\n    w = np.zeros((Nx, Nz))\n    chi = np.zeros((Nx, Nz))\n    rho = np.zeros((Nx, Nz))\n    \n    z_tp_star = 10000.0 + 500.0 * (i_indices - 1.5)\n    \n    # Base temperature at z=6000m\n    T0_i = 245.0 - 2.0 * i_indices\n    \n    # Base density at z=6000m\n    rho6_i = 0.66 * (1.0 + 0.03 * (i_indices - 1.5))\n    \n    for i in i_indices:\n        # Temperature\n        T_at_ztp_star = T0_i[i] - 6.5 * (z_tp_star[i] - 6000.0) / 1000.0\n        chi_at_ztp_star = 4e-6 + 0.5e-6 * (z_tp_star[i] - 6000.0) / 1000.0\n        \n        for k in k_indices:\n            zk = z_k[k]\n            \n            # Temperature T\n            if zk = z_tp_star[i]:\n                T[i, k] = T0_i[i] - 6.5 * (zk - 6000.0) / 1000.0\n            else:\n                T[i, k] = T_at_ztp_star - 1.0 * (zk - z_tp_star[i]) / 1000.0\n            \n            # Potential Vorticity q\n            delta_q = 2.0 if zk >= z_tp_star[i] else 0.0\n            q[i, k] = (0.5 + 0.15 * k + 0.1 * i) + delta_q\n            \n            # Vertical Velocity w\n            w[i, k] = 0.02 * np.sin(np.pi / 4.0 * (zk / 1000.0 - 6.0 + 0.5 * i)) - 0.005\n            \n            # Tracer mixing ratio chi\n            if zk = z_tp_star[i]:\n                chi[i, k] = 4e-6 + 0.5e-6 * (zk - 6000.0) / 1000.0\n            else:\n                chi[i, k] = chi_at_ztp_star + 3e-6 + 0.3e-6 * (zk - z_tp_star[i]) / 1000.0\n            \n            # Density rho\n            rho[i, k] = rho6_i[i] * np.exp(-(zk - 6000.0) / H)\n\n    # 3. Implement Tropopause Finders\n    \n    def find_pv_tropopause(i, q_t):\n        for k in k_indices:\n            is_crossing = q[i, k] >= q_t\n            if k == 0:\n                if is_crossing:\n                    return k, True # Found at lowest level\n            else:\n                if is_crossing and q[i, k-1]  q_t:\n                    return k, True # Found crossing\n        return Nz - 1, False # Not found, default to top\n\n    def find_thermal_tropopause(i, gamma_t):\n        # Lapse rate Gamma is defined for k in {0, ..., Nz-2}\n        for k in range(Nz - 1):\n            # z_{k+1} - z_k = 1000, so factor of 1000 cancels\n            gamma_k = -(T[i, k+1] - T[i, k])\n            if gamma_k = gamma_t:\n                return k + 1, True # Tropopause is at level k+1\n        return Nz - 1, False # Not found, default to top\n        \n    def find_hybrid_tropopause(i, q_t, gamma_t):\n        k_pv, found_pv = find_pv_tropopause(i, q_t)\n        k_th, found_th = find_thermal_tropopause(i, q_t)\n        \n        if found_pv and found_th:\n            # Both found, pick higher altitude\n            return k_pv if z_k[k_pv] >= z_k[k_th] else k_th\n        elif found_pv:\n            return k_pv\n        elif found_th:\n            return k_th\n        else:\n            # Neither found, default to top\n            return Nz - 1\n\n    # 4. Process test suite and calculate fluxes\n\n    test_cases = [\n        (\"PV\", 2.0, 2.0),\n        (\"PV\", 3.5, 2.0),\n        (\"TH\", 2.0, 2.0),\n        (\"TH\", 2.0, 1.5),\n        (\"HYB\", 2.0, 2.0),\n        (\"HYB\", 3.5, 1.5),\n        (\"PV\", 6.0, 2.0),\n        (\"TH\", 2.0, 0.5),\n    ]\n\n    results = []\n    \n    for case_def, q_t, gamma_t in test_cases:\n        total_flux = 0.0\n        for i in i_indices:\n            if case_def == \"PV\":\n                k_tp, _ = find_pv_tropopause(i, q_t)\n            elif case_def == \"TH\":\n                k_tp, _ = find_thermal_tropopause(i, gamma_t)\n            elif case_def == \"HYB\":\n                k_tp = find_hybrid_tropopause(i, q_t, gamma_t)\n            \n            # Retrieve values at tropopause level\n            rho_tp = rho[i, k_tp]\n            w_tp = w[i, k_tp]\n            chi_tp = chi[i, k_tp]\n            \n            # Calculate downward flux contribution\n            downward_mass_flux_per_area = rho_tp * max(-w_tp, 0)\n            flux_contribution = downward_mass_flux_per_area * chi_tp * DeltaA\n            total_flux += flux_contribution\n            \n        results.append(round(total_flux, 6))\n\n    # 5. Final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "气候模型通过数值求解平流方程来模拟臭氧等示踪剂的输送。这些模拟的准确性和稳定性在很大程度上取决于所使用的数值方案及其参数，如网格间距和时间步长。这项练习 () 提供了关于 Courant-Friedrichs-Lewy (CFL) 条件的实践经验，这是数值模拟中的一个基本概念。您不仅将评估一个常用平流方案的稳定性，还将评估其准确性，从而揭示可能影响模拟物理真实性的数值扩散这一隐藏挑战。",
            "id": "4095886",
            "problem": "一个全球化学-气候模型被用于模拟由 Brewer-Dobson 环流和平流层-对流层交换引起的臭氧输送。考虑在每个坐标方向上由一维线性平流方程控制的示踪物平流，其采用显式上游有限体积离散格式，并用前向欧拉法进行时间推进。在低平流层的一个中纬度纬圈上，取典型纬向风速 $u = 40 \\,\\text{m s}^{-1}$，水平网格间距 $\\Delta x = 100 \\,\\text{km}$，以及时间步长 $\\Delta t = 1800 \\,\\text{s}$。对于穿越热带对流层顶的垂直输送，取典型剩余平均垂直速度 $w = 1.5 \\times 10^{-3} \\,\\text{m s}^{-1}$，垂直网格间距 $\\Delta z = 1.5 \\,\\text{km}$，以及相同的时间步长 $\\Delta t = 1800 \\,\\text{s}$。\n\n从平流方程和控制体积离散出发，使用傅里叶（冯·诺依曼）稳定性分析，计算在这些条件下水平和垂直示踪物平流的 Courant–Friedrichs–Lewy (CFL) 库朗数，并确定显式上游平流在每个方向上是否稳定。然后，基于修正方程的观点，通过将该方案所隐含的领头阶数值扩散与物理上合理的低平流层混合率进行比较，评估预期的精度范围。\n\n将每个库朗数四舍五入到三位有效数字。在最终答案中，将库朗数表示为无单位的无量纲数。",
            "solution": "该问题要求分析化学-气候模型中用于示踪物平流的显式上游有限体积方案的稳定性和准确性。根据所提供的参数，对水平（纬向）和垂直输送分别进行分析。\n\n对于浓度为 $\\phi$ 的非反应性示踪物，在恒定速度 $c$ 下的一维纯平流，其控制方程为线性平流方程：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\frac{\\partial \\phi}{\\partial x} = 0\n$$\n\n我们使用有限体积法，在间距为 $\\Delta x$ 的均匀网格上对该方程进行离散。对于以 $x_i$ 为中心的网格单元 $i$，其网格平均浓度的变化率由网格界面上的通量决定：\n$$\n\\frac{d\\phi_i}{dt}\\Delta x + (c\\phi)_{i+1/2} - (c\\phi)_{i-1/2} = 0\n$$\n这里，$\\phi_i$ 是网格单元 $i$ 中的平均浓度，$(c\\phi)_{i\\pm1/2}$ 分别是右侧和左侧网格界面上的通量。\n\n指定的方案是时间上采用前向欧拉法，空间通量采用显式上游格式。时间导数的前向欧拉离散为 $\\frac{d\\phi_i}{dt} \\approx \\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t}$。上游格式规定，网格界面处的 $\\phi$ 值取自上风向的网格单元。对于正速度（$c  0$），这意味着 $(c\\phi)_{i+1/2} = c\\phi_i^n$ 和 $(c\\phi)_{i-1/2} = c\\phi_{i-1}^n$。将这些代入有限体积方程得到：\n$$\n\\frac{\\phi_i^{n+1} - \\phi_i^n}{\\Delta t} \\Delta x + c\\phi_i^n - c\\phi_{i-1}^n = 0\n$$\n整理得到新时间步的 $\\phi_i^{n+1}$：\n$$\n\\phi_i^{n+1} = \\phi_i^n - \\frac{c \\Delta t}{\\Delta x} (\\phi_i^n - \\phi_{i-1}^n)\n$$\n我们定义无量纲的 Courant–Friedrichs–Lewy (CFL) 数，或库朗数，为 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$。更新方程变为：\n$$\n\\phi_i^{n+1} = (1 - \\sigma)\\phi_i^n + \\sigma\\phi_{i-1}^n\n$$\n对此方案进行的傅里叶（冯·诺依曼）稳定性分析表明，当且仅当库朗数 $\\sigma$ 满足条件 $0 \\le \\sigma \\le 1$ 时，该方案是数值稳定的。\n\n现在我们将此框架应用于所提供的两种情况。\n\n**1. 水平（纬向）平流**\n\n给定参数为：\n- 纬向风速：$u = 40 \\,\\text{m s}^{-1}$\n- 水平网格间距：$\\Delta x = 100 \\,\\text{km} = 1 \\times 10^5 \\,\\text{m}$\n- 时间步长：$\\Delta t = 1800 \\,\\text{s}$\n\n水平平流的库朗数 $\\sigma_x$ 为：\n$$\n\\sigma_x = \\frac{u \\Delta t}{\\Delta x} = \\frac{(40 \\,\\text{m s}^{-1}) \\times (1800 \\,\\text{s})}{1 \\times 10^5 \\,\\text{m}} = \\frac{72000}{100000} = 0.72\n$$\n四舍五入到三位有效数字，得到 $\\sigma_x = 0.720$。\n由于 $0 \\le 0.720 \\le 1$，稳定性条件得到满足。因此，在这些条件下，用于水平平流的显式上游方案是**稳定**的。\n\n**2. 垂直平流**\n\n给定参数为：\n- 剩余平均垂直速度：$w = 1.5 \\times 10^{-3} \\,\\text{m s}^{-1}$\n- 垂直网格间距：$\\Delta z = 1.5 \\,\\text{km} = 1.5 \\times 10^3 \\,\\text{m}$\n- 时间步长：$\\Delta t = 1800 \\,\\text{s}$\n\n垂直平流的库朗数 $\\sigma_z$ 为：\n$$\n\\sigma_z = \\frac{w \\Delta t}{\\Delta z} = \\frac{(1.5 \\times 10^{-3} \\,\\text{m s}^{-1}) \\times (1800 \\,\\text{s})}{1.5 \\times 10^3 \\,\\text{m}} = \\frac{2.7}{1500} = 0.0018\n$$\n四舍五入到三位有效数字，得到 $\\sigma_z = 0.00180$。\n由于 $0 \\le 0.00180 \\le 1$，稳定性条件得到满足。用于垂直平流的显式上游方案也是**稳定**的。\n\n**3. 通过修正方程进行精度评估**\n\n虽然该方案在两个方向上都是稳定的，但必须对其精度进行评估。众所周知，前向欧拉-上游方案只有一阶精度，并且会引入显著的数值扩散。这可以通过修正方程的观点来量化，它揭示了数值方案实际求解的偏微分方程。对于此方案，修正方程为：\n$$\n\\frac{\\partial \\phi}{\\partial t} + c \\frac{\\partial \\phi}{\\partial x} = K_{num} \\frac{\\partial^2 \\phi}{\\partial x^2} + \\dots (\\text{高阶项})\n$$\n领头阶误差项具有物理扩散项的形式，其中 $K_{num}$ 是数值扩散系数。其值由下式给出：\n$$\nK_{num} = \\frac{c \\Delta x}{2}(1 - \\sigma)\n$$\n这种数值扩散是离散化的产物，如果其量级与所模拟的物理混合过程相当或更大，就会破坏模拟结果。\n\n**水平精度：**\n水平平流的数值扩散系数为：\n$$\nK_{num, x} = \\frac{u \\Delta x}{2}(1 - \\sigma_x) = \\frac{(40 \\,\\text{m s}^{-1})(1 \\times 10^5 \\,\\text{m})}{2}(1 - 0.720) = (2 \\times 10^6 \\,\\text{m}^2 \\text{s}^{-1})(0.28) = 5.6 \\times 10^5 \\,\\text{m}^2 \\text{s}^{-1}\n$$\n在低平流层，由破碎的行星波引起的大尺度准水平混合是一个关键的物理过程，其特征是有效水平涡动扩散系数的量级约为 $K_{yy} \\approx 10^5 - 10^6 \\,\\text{m}^2 \\text{s}^{-1}$。计算出的数值扩散系数 $K_{num, x} = 5.6 \\times 10^5 \\,\\text{m}^2 \\text{s}^{-1}$ 正好落在这个范围内。这意味着由数值方案产生的人为扩散与它本应解析的物理过程具有相同的量级。因此，模拟的水平输送将被数值误差所主导，这代表了一个**精度很差的范围**。\n\n**垂直精度：**\n垂直平流的数值扩散系数为：\n$$\nK_{num, z} = \\frac{w \\Delta z}{2}(1 - \\sigma_z) = \\frac{(1.5 \\times 10^{-3} \\,\\text{m s}^{-1})(1.5 \\times 10^3 \\,\\text{m})}{2}(1 - 0.00180) \\approx \\frac{2.25 \\,\\text{m}^2 \\text{s}^{-1}}{2}(0.9982) \\approx 1.12 \\,\\text{m}^2 \\text{s}^{-1}\n$$\n低平流层是十分稳定分层的，物理垂直混合很弱。垂直涡动扩散系数 $K_{zz}$ 的合理值通常在 $0.1 - 1.0 \\,\\text{m}^2 \\text{s}^{-1}$ 的范围内。计算出的数值扩散系数 $K_{num, z} \\approx 1.12 \\,\\text{m}^2 \\text{s}^{-1}$ 处于合理物理值的上限，甚至超过了它。这一点尤其成问题，因为 Brewer-Dobson 环流中的垂直输送很慢，而维持像臭氧这类示踪物跨对流层顶的陡峭垂直梯度至关重要。巨大的数值扩散会人为地平滑这些梯度，从根本上错误地表征了平流层-对流层交换的物理过程。这构成了一个**精度极差的范围**。请注意，极小的库朗数（$\\sigma_z \\ll 1$）导致了最大的数值扩散，这是该方案用于慢速平流过程的一个经典缺陷。\n\n总而言之，尽管对于给定的参数，该方案是数值稳定的，但其固有的数值扩散在水平和垂直方向上都非常大，以至于使得研究低平流层输送的模拟在科学上是不准确的。现代气候模型采用更高阶、扩散性更小的平流方案来缓解这一关键问题。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.720  0.00180 \\end{pmatrix}}\n$$"
        }
    ]
}