{
    "hands_on_practices": [
        {
            "introduction": "The ice-albedo feedback is one of the most intuitive and significant positive feedbacks in the Earth's climate system. This exercise provides a hands-on opportunity to quantify this effect by building a simplified, zonally aggregated energy balance model from first principles. By translating a physical process—the retreat of snow and ice with rising temperatures—into a mathematical expression for the surface albedo feedback parameter, $\\lambda_{\\alpha}$, you will gain fundamental insight into how specific components of the climate system contribute to overall climate sensitivity . This practice bridges the gap between conceptual understanding and quantitative analysis.",
            "id": "4022287",
            "problem": "Consider a zonally aggregated energy-balance view of the climate system focusing on top-of-atmosphere (TOA) shortwave radiative processes that involve the cryosphere. The objective is to quantify the surface albedo feedback associated with snow and ice coverage changes under warming. Begin from the conservation of energy applied to the planetary radiation budget and the definition of planetary albedo, and treat all quantities as annual-mean values. Use the following modeling assumptions and definitions as the foundational base for your derivation and algorithmic formulation:\n\n1. The TOA net shortwave flux absorbed by the Earth system in a zone is $R_{\\mathrm{SW}} = S \\left(1 - \\alpha_{\\mathrm{p}}\\right)$, where $S$ is the incident shortwave radiation at TOA and $\\alpha_{\\mathrm{p}}$ is the planetary albedo.\n\n2. Partition the planetary albedo into a component due to clouds and atmosphere that is independent of surface properties and a component due to surface reflection that reaches TOA. Only the surface-reflected component is temperature dependent via cryospheric changes. For the surface-reflected component, model the atmospheric pathway using a single effective clear-sky shortwave transmissivity $t \\in [0,1]$ and a cloud fraction $c \\in [0,1]$ that occludes surface reflection in proportion to $(1-c)$. Ignore multiple scattering and any temperature dependence in $t$ and $c$.\n\n3. Represent the surface albedo as a mixture of ice/snow and background (ocean/land without seasonal snow) contributions. Let the surface albedo be $a_{\\mathrm{s}} = a_{\\mathrm{w}} + f \\left(a_{\\mathrm{i}} - a_{\\mathrm{w}}\\right)$, where $a_{\\mathrm{i}} \\in [0,1]$ is the ice/snow albedo, $a_{\\mathrm{w}} \\in [0,1]$ is the background albedo, and $f \\in [0,1]$ is the fractional cryosphere coverage in the zone.\n\n4. Model the fractional cryosphere coverage $f$ as a logistic function of the near-surface air temperature $T$ with respect to a melt threshold $T_0$: $f(T) = \\dfrac{1}{1 + \\exp\\left(\\beta \\left(T - T_0\\right)\\right)}$, where $\\beta > 0$ is a slope parameter that controls the sharpness of the transition. This functional form captures the smooth retreat of snow/ice with warming and is widely used in simple climate models.\n\n5. Define the surface albedo feedback parameter $\\lambda_{\\alpha}$ in the usual climate feedback framework as the negative of the sensitivity of the net TOA flux to temperature: $\\lambda_{\\alpha} = -\\dfrac{\\partial R}{\\partial T}$, and in this problem focus solely on the shortwave contribution due to the temperature dependence of $a_{\\mathrm{s}}$.\n\nYour task is to:\n- Derive, from the above base, an expression for the zonal contribution to $\\dfrac{\\partial R_{\\mathrm{SW}}}{\\partial T}$ as a function of $S$, $t$, $c$, $a_{\\mathrm{i}}$, $a_{\\mathrm{w}}$, $T$, $T_0$, and $\\beta$.\n- Aggregate a set of zones via area weights $w$ that sum to $1$ to obtain a multi-zone value of $\\lambda_{\\alpha}$ expressed in $\\mathrm{W \\, m^{-2} \\, K^{-1}}$.\n- Implement a program that computes $\\lambda_{\\alpha}$ for each of the test cases below and produces the results as specified.\n\nAngles do not appear in this problem. All outputs must be expressed in $\\mathrm{W \\, m^{-2} \\, K^{-1}}$ as decimal floats rounded to six decimal places.\n\nTest Suite:\nEach test case consists of arrays of equal length $N$ for the zone parameters $S$, $t$, $c$, $T$, $T_0$, $\\beta$, $a_{\\mathrm{i}}$, $a_{\\mathrm{w}}$, with area weights $w$ such that $\\sum_{j=1}^{N} w_j = 1$. Compute a single aggregate $\\lambda_{\\alpha}$ per test case via the area-weighted sum of zonal contributions.\n\n- Test Case 1 (three-zone, cryosphere present in high latitudes, negligible in tropics):\n  - $S = [260, 340, 420]$ in $\\mathrm{W \\, m^{-2}}$\n  - $t = [0.70, 0.78, 0.80]$\n  - $c = [0.55, 0.50, 0.60]$\n  - $T = [271, 285, 299]$ in $\\mathrm{K}$\n  - $T_0 = [273, 275, 273]$ in $\\mathrm{K}$\n  - $\\beta = [0.25, 0.08, 0.50]$ in $\\mathrm{K^{-1}}$\n  - $a_{\\mathrm{i}} = [0.65, 0.50, 0.40]$\n  - $a_{\\mathrm{w}} = [0.15, 0.20, 0.06]$\n  - $w = [0.06, 0.34, 0.60]$\n\n- Test Case 2 (same as Test Case 1 but no albedo contrast, i.e., no cryosphere optical effect):\n  - $S = [260, 340, 420]$ in $\\mathrm{W \\, m^{-2}}$\n  - $t = [0.70, 0.78, 0.80]$\n  - $c = [0.55, 0.50, 0.60]$\n  - $T = [271, 285, 299]$ in $\\mathrm{K}$\n  - $T_0 = [273, 275, 273]$ in $\\mathrm{K}$\n  - $\\beta = [0.25, 0.08, 0.50]$ in $\\mathrm{K^{-1}}$\n  - $a_{\\mathrm{i}} = [0.15, 0.20, 0.06]$\n  - $a_{\\mathrm{w}} = [0.15, 0.20, 0.06]$\n  - $w = [0.06, 0.34, 0.60]$\n\n- Test Case 3 (two-zone, very cloudy polar zone suppresses kernel, clear midlatitudes near threshold dominate):\n  - $S = [240, 320]$ in $\\mathrm{W \\, m^{-2}}$\n  - $t = [0.65, 0.85]$\n  - $c = [0.90, 0.20]$\n  - $T = [268, 278]$ in $\\mathrm{K}$\n  - $T_0 = [273, 275]$ in $\\mathrm{K}$\n  - $\\beta = [0.40, 0.20]$ in $\\mathrm{K^{-1}}$\n  - $a_{\\mathrm{i}} = [0.70, 0.55]$\n  - $a_{\\mathrm{w}} = [0.20, 0.18]$\n  - $w = [0.08, 0.92]$\n\n- Test Case 4 (single-zone boundary with zero transmissivity, null kernel):\n  - $S = [340]$ in $\\mathrm{W \\, m^{-2}}$\n  - $t = [0.00]$\n  - $c = [0.50]$\n  - $T = [270]$ in $\\mathrm{K}$\n  - $T_0 = [273]$ in $\\mathrm{K}$\n  - $\\beta = [0.30]$ in $\\mathrm{K^{-1}}$\n  - $a_{\\mathrm{i}} = [0.70]$\n  - $a_{\\mathrm{w}} = [0.10]$\n  - $w = [1.00]$\n\nProgram Output Specification:\nYour program should produce a single line of output containing the aggregate results for the four test cases as a comma-separated list enclosed in square brackets, for example $[x_1,x_2,x_3,x_4]$, where each $x_i$ is the computed $\\lambda_{\\alpha}$ in $\\mathrm{W \\, m^{-2} \\, K^{-1}}$ rounded to six decimal places with standard rounding rules.",
            "solution": "The user-provided problem is assessed to be valid as it is scientifically grounded in the principles of climate energy balance, is mathematically well-posed, and uses objective, formal language. It presents a standard, albeit simplified, problem in climate feedback analysis that can be solved through direct derivation and computation.\n\nThe objective is to derive an expression for the surface albedo feedback parameter, $\\lambda_{\\alpha}$, and compute its value for several test cases. The feedback parameter is defined as $\\lambda_{\\alpha} = -\\dfrac{\\partial R}{\\partial T}$, where we focus on the shortwave radiation component, $R_{\\mathrm{SW}}$, and its dependence on temperature $T$ through surface albedo changes.\n\nThe derivation proceeds as follows.\n\n1.  **Formulate the Planetary Albedo, $\\alpha_{\\mathrm{p}}$**:\n    The problem asks to partition the planetary albedo, $\\alpha_{\\mathrm{p}}$, into two parts: a component independent of the surface, and a component due to surface reflection that reaches the top of the atmosphere (TOA). Let's model the fluxes. The total shortwave radiation reflected to space is $S \\alpha_{\\mathrm{p}}$. This is the sum of radiation reflected by the atmosphere and clouds, and radiation reflected from the surface that successfully travels back up to space.\n    Let $\\alpha_{\\mathrm{atm+cld}}$ be the albedo component from the atmosphere and clouds that is independent of surface properties.\n    The surface-reflected component is modulated by the atmosphere. Solar radiation must first pass down through the atmosphere, reflect, and then pass back up. The problem provides an effective clear-sky transmissivity $t$ and a cloud fraction $c$. Surface reflection is occluded by clouds, so it is only relevant for the clear-sky portion of the zone, which has a fractional area of $(1-c)$.\n    In this clear-sky fraction, radiation is transmitted downwards, reflects off the surface with albedo $a_{\\mathrm{s}}$, and is transmitted upwards. The two-way transmissivity for flux is $t^2$.\n    Thus, the portion of planetary albedo contributed by surface reflection is $(1-c) t^2 a_{\\mathrm{s}}$.\n    The total planetary albedo is the sum of the atmospheric/cloud contribution and the surface contribution:\n    $$ \\alpha_{\\mathrm{p}} = \\alpha_{\\mathrm{atm+cld}} + (1-c) t^2 a_{\\mathrm{s}} $$\n    Here, $\\alpha_{\\mathrm{atm+cld}}$, $c$, and $t$ are assumed to be independent of the near-surface air temperature $T$. The temperature dependence enters through the surface albedo, $a_{\\mathrm{s}}$.\n\n2.  **Formulate the Net Shortwave Flux, $R_{\\mathrm{SW}}$**:\n    The net shortwave flux absorbed by the system is given by definition $1$:\n    $$ R_{\\mathrm{SW}} = S (1 - \\alpha_{\\mathrm{p}}) $$\n    Substituting our expression for $\\alpha_{\\mathrm{p}}$:\n    $$ R_{\\mathrm{SW}} = S \\left(1 - \\left[\\alpha_{\\mathrm{atm+cld}} + (1-c) t^2 a_{\\mathrm{s}}\\right]\\right) = S(1 - \\alpha_{\\mathrm{atm+cld}}) - S(1-c)t^2 a_{\\mathrm{s}} $$\n\n3.  **Differentiate $R_{\\mathrm{SW}}$ with respect to Temperature $T$**:\n    We need to find $\\dfrac{\\partial R_{\\mathrm{SW}}}{\\partial T}$. All parameters except $a_{\\mathrm{s}}$ are treated as constants with respect to $T$.\n    $$ \\frac{\\partial R_{\\mathrm{SW}}}{\\partial T} = \\frac{\\partial}{\\partial T} \\left[ S(1 - \\alpha_{\\mathrm{atm+cld}}) - S(1-c)t^2 a_{\\mathrm{s}}(T) \\right] $$\n    $$ \\frac{\\partial R_{\\mathrm{SW}}}{\\partial T} = -S(1-c)t^2 \\frac{\\partial a_{\\mathrm{s}}}{\\partial T} $$\n\n4.  **Differentiate Surface Albedo $a_{\\mathrm{s}}$ with respect to Temperature $T$**:\n    The surface albedo $a_{\\mathrm{s}}$ is given by definition $3$ as a linear mix based on cryosphere fraction $f$:\n    $$ a_{\\mathrm{s}} = a_{\\mathrm{w}} + f(T) (a_{\\mathrm{i}} - a_{\\mathrm{w}}) $$\n    The parameters $a_{\\mathrm{w}}$ and $a_{\\mathrm{i}}$ (background and ice albedos) are constant. Differentiating with respect to $T$ gives:\n    $$ \\frac{\\partial a_{\\mathrm{s}}}{\\partial T} = (a_{\\mathrm{i}} - a_{\\mathrm{w}}) \\frac{\\partial f}{\\partial T} $$\n\n5.  **Differentiate Cryosphere Fraction $f$ with respect to Temperature $T$**:\n    The cryosphere fraction $f$ is modeled as a logistic function of $T$, as per definition $4$:\n    $$ f(T) = \\frac{1}{1 + \\exp\\left(\\beta (T - T_0)\\right)} $$\n    To find the derivative $\\dfrac{\\partial f}{\\partial T}$, we use the chain rule. Let $u = \\beta(T-T_0)$, so $f(u) = (1+e^u)^{-1}$.\n    $$ \\frac{\\partial f}{\\partial T} = \\frac{df}{du} \\frac{du}{dT} $$\n    The derivatives are:\n    $$ \\frac{du}{dT} = \\beta $$\n    $$ \\frac{df}{du} = -(1+e^u)^{-2} e^u = -\\frac{1}{1+e^u} \\cdot \\frac{e^u}{1+e^u} $$\n    We can express this in terms of $f$. We know $f = \\dfrac{1}{1+e^u}$.\n    Also, $1-f = 1 - \\dfrac{1}{1+e^u} = \\dfrac{1+e^u-1}{1+e^u} = \\dfrac{e^u}{1+e^u}$.\n    Substituting these back into the expression for $\\dfrac{df}{du}$:\n    $$ \\frac{df}{du} = -f(1-f) $$\n    Therefore, the derivative with respect to temperature is:\n    $$ \\frac{\\partial f}{\\partial T} = -\\beta f(1-f) $$\n\n6.  **Assemble the Expression for $\\dfrac{\\partial R_{\\mathrm{SW}}}{\\partial T}$**:\n    We substitute the results from steps $4$ and $5$ back into the expression from step $3$.\n    $$ \\frac{\\partial a_{\\mathrm{s}}}{\\partial T} = -(a_{\\mathrm{i}} - a_{\\mathrm{w}}) \\beta f(1-f) $$\n    $$ \\frac{\\partial R_{\\mathrm{SW}}}{\\partial T} = -S(1-c)t^2 \\left[ -(a_{\\mathrm{i}} - a_{\\mathrm{w}}) \\beta f(1-f) \\right] $$\n    $$ \\frac{\\partial R_{\\mathrm{SW}}}{\\partial T} = S t^2 (1-c) \\beta (a_{\\mathrm{i}} - a_{\\mathrm{w}}) f(1-f) $$\n    This expression represents the change in net TOA shortwave radiation for a unit change in surface temperature for a single zone. A positive value indicates that as temperature increases, more shortwave radiation is absorbed, which is characteristic of a positive feedback.\n\n7.  **Calculate the Aggregate Feedback Parameter $\\lambda_{\\alpha}$**:\n    The feedback parameter is defined as $\\lambda_{\\alpha} = -\\dfrac{\\partial R_{\\mathrm{SW}}}{\\partial T}$. For a single zone $j$, this gives:\n    $$ \\lambda_{\\alpha,j} = -S_j t_j^2 (1-c_j) \\beta_j (a_{\\mathrm{i},j} - a_{\\mathrm{w},j}) f_j(1-f_j) $$\n    where $f_j = \\left(1 + \\exp\\left(\\beta_j (T_j - T_{0,j})\\right)\\right)^{-1}$.\n    The globally- or multi-zonally-aggregated feedback parameter is the area-weighted sum of the zonal contributions:\n    $$ \\lambda_{\\alpha} = \\sum_{j=1}^{N} w_j \\lambda_{\\alpha,j} $$\n    Substituting the expression for $\\lambda_{\\alpha,j}$:\n    $$ \\lambda_{\\alpha} = - \\sum_{j=1}^{N} w_j S_j t_j^2 (1-c_j) \\beta_j (a_{\\mathrm{i},j} - a_{\\mathrm{w},j}) f_j(1-f_j) $$\n    This is the final expression to be implemented. The units are determined by the units of $S$ ($\\mathrm{W \\, m^{-2}}$) and $\\beta$ ($\\mathrm{K^{-1}}$), resulting in $\\mathrm{W \\, m^{-2} \\, K^{-1}}$, as required. This formula will be used to compute the results for the given test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the aggregate surface albedo feedback parameter for multiple test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case 1\n        (\n            np.array([260., 340., 420.]),       # S\n            np.array([0.70, 0.78, 0.80]),       # t\n            np.array([0.55, 0.50, 0.60]),       # c\n            np.array([271., 285., 299.]),       # T\n            np.array([273., 275., 273.]),       # T0\n            np.array([0.25, 0.08, 0.50]),       # beta\n            np.array([0.65, 0.50, 0.40]),       # a_i\n            np.array([0.15, 0.20, 0.06]),       # a_w\n            np.array([0.06, 0.34, 0.60]),       # w\n        ),\n        # Test Case 2\n        (\n            np.array([260., 340., 420.]),       # S\n            np.array([0.70, 0.78, 0.80]),       # t\n            np.array([0.55, 0.50, 0.60]),       # c\n            np.array([271., 285., 299.]),       # T\n            np.array([273., 275., 273.]),       # T0\n            np.array([0.25, 0.08, 0.50]),       # beta\n            np.array([0.15, 0.20, 0.06]),       # a_i (same as a_w)\n            np.array([0.15, 0.20, 0.06]),       # a_w\n            np.array([0.06, 0.34, 0.60]),       # w\n        ),\n        # Test Case 3\n        (\n            np.array([240., 320.]),             # S\n            np.array([0.65, 0.85]),             # t\n            np.array([0.90, 0.20]),             # c\n            np.array([268., 278.]),             # T\n            np.array([273., 275.]),             # T0\n            np.array([0.40, 0.20]),             # beta\n            np.array([0.70, 0.55]),             # a_i\n            np.array([0.20, 0.18]),             # a_w\n            np.array([0.08, 0.92]),             # w\n        ),\n        # Test Case 4\n        (\n            np.array([340.]),                   # S\n            np.array([0.00]),                   # t\n            np.array([0.50]),                   # c\n            np.array([270.]),                   # T\n            np.array([273.]),                   # T0\n            np.array([0.30]),                   # beta\n            np.array([0.70]),                   # a_i\n            np.array([0.10]),                   # a_w\n            np.array([1.00]),                   # w\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        S, t, c, T, T0, beta, a_i, a_w, w = case\n\n        # Calculate fractional cryosphere coverage f for each zone\n        # f = 1 / (1 + exp(beta * (T - T0)))\n        f = 1.0 / (1.0 + np.exp(beta * (T - T0)))\n\n        # The derivative df/dT can be expressed as -beta * f * (1-f)\n        # The full expression for the zonal feedback is:\n        # lambda_alpha_j = -S_j * t_j^2 * (1-c_j) * beta_j * (a_i_j - a_w_j) * f_j * (1-f_j)\n        \n        # Calculate the zonal feedback values using vectorized operations\n        lambda_alpha_zonal = -S * t**2 * (1 - c) * beta * (a_i - a_w) * f * (1 - f)\n\n        # Calculate the aggregate feedback by taking the area-weighted sum\n        lambda_alpha_total = np.sum(w * lambda_alpha_zonal)\n\n        results.append(f\"{lambda_alpha_total:.6f}\")\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The water vapor and lapse-rate feedbacks are the strongest and most robustly understood feedbacks shaping Earth's climate response. This exercise introduces the powerful radiative kernel methodology, a cornerstone of modern climate feedback analysis. You will use this technique to dissect the net radiative effect of atmospheric warming, decomposing it into contributions from temperature changes (the lapse-rate feedback) and the thermodynamically coupled increase in water vapor (the water vapor feedback) . This practice is essential for understanding how the vertical structure of atmospheric changes dictates the magnitude of climate feedbacks.",
            "id": "4022293",
            "problem": "Consider a vertically discretized atmospheric column used in numerical weather prediction and climate modeling. The goal is to quantify the coupling between water vapor and lapse-rate feedbacks using a linearized radiative kernel framework at the Top of Atmosphere (TOA). Starting from a physically grounded base, use the following principles:\n\n- The net TOA radiative perturbation $dR$ due to small changes in the atmospheric state can be linearized as a sum of contributions from temperature and water vapor:\n$$\ndR \\approx \\sum_{i=1}^{N} K_T(i) \\, dT(i) \\;+\\; \\sum_{i=1}^{N} K_q(i) \\, dq(i)\n$$,\nwhere $K_T(i)$ has units $\\mathrm{W\\,m^{-2}\\,K^{-1}}$, $K_q(i)$ has units $\\mathrm{W\\,m^{-2}\\,(kg/kg)^{-1}}$, $dT(i)$ is the temperature change at level $i$ in $\\mathrm{K}$, and $dq(i)$ is the specific humidity change at level $i$ in $\\mathrm{kg/kg}$. The integer $N$ is the number of vertical levels.\n\n- Under fixed relative humidity, the Clausius–Clapeyron relation links the fractional change of saturation specific humidity $q_s$ to temperature via\n$$\n\\frac{d \\ln q_s}{dT} \\approx \\frac{L_v}{R_v \\, T^2}\n$$,\nwhere $L_v$ is the latent heat of vaporization in $\\mathrm{J\\,kg^{-1}}$, $R_v$ is the gas constant for water vapor in $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$, and $T$ is absolute temperature in $\\mathrm{K}$. With relative humidity held fixed, a small temperature change $dT(i)$ at level $i$ produces\n$$\ndq(i) \\approx q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, dT(i)\n$$,\nwhere $q(i)$ is the background specific humidity at level $i$.\n\n- A lapse-rate mediated coupling is represented by a level-dependent factor $\\gamma(i)$ such that the temperature change at level $i$ is linked to the surface temperature change $dT_s$ by\n$$\ndT(i) = \\gamma(i) \\, dT_s\n$$,\nwhere $\\gamma(i)$ is dimensionless and $dT_s$ is in $\\mathrm{K}$.\n\n- The effective climate feedback parameter is defined as\n$$\n\\lambda_{\\mathrm{eff}} = \\frac{dR}{dT_s}\n$$,\nwith units $\\mathrm{W\\,m^{-2}\\,K^{-1}}$. Positive $\\lambda_{\\mathrm{eff}}$ indicates a stabilizing response, while negative $\\lambda_{\\mathrm{eff}}$ indicates a destabilizing response under the adopted sign convention.\n\nYour task is to implement a program that computes $\\lambda_{\\mathrm{eff}}$ for a set of scientifically plausible test cases using the prescribed constants and vertical profiles. Assume $dT_s = 1.0 \\, \\mathrm{K}$ so that $\\lambda_{\\mathrm{eff}} = dR$ numerically. Use $L_v = 2{,}500{,}000 \\, \\mathrm{J\\,kg^{-1}}$ and $R_v = 461 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$. All temperature values are in $\\mathrm{K}$ and specific humidity values are in $\\mathrm{kg/kg}$.\n\nImplement the following test suite (each case provides arrays of length $N=6$ levels, ordered from near-surface to upper troposphere):\n\n- Case A (Tropics with strong upper-level warming coupling):\n    - $T = [300.0, 294.0, 285.0, 270.0, 250.0, 220.0]$\n    - $q = [0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]$\n    - $K_T = [-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]$\n    - $K_q = [540.0, 450.0, 420.0, 360.0, 300.0, 240.0]$\n    - $\\gamma = [1.00, 1.20, 1.30, 1.50, 1.60, 1.70]$\n\n- Case B (Polar, colder and drier with uniform warming profile):\n    - $T = [270.0, 264.0, 255.0, 240.0, 220.0, 205.0]$\n    - $q = [0.0040, 0.0030, 0.0020, 0.0010, 0.0005, 0.0002]$\n    - $K_T = [-0.30, -0.25, -0.25, -0.30, -0.40, -0.50]$\n    - $K_q = [300.0, 240.0, 210.0, 180.0, 150.0, 120.0]$\n    - $\\gamma = [1.00, 1.00, 1.00, 1.00, 1.00, 1.00]$\n\n- Case C (Dry atmosphere limit, identical to Case A but with zero water vapor kernel):\n    - $T = [300.0, 294.0, 285.0, 270.0, 250.0, 220.0]$\n    - $q = [0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]$\n    - $K_T = [-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]$\n    - $K_q = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]$\n    - $\\gamma = [1.00, 1.20, 1.30, 1.50, 1.60, 1.70]$\n\n- Case D (Weak lapse-rate coupling, uniform warming with tropical humidity and kernels):\n    - $T = [300.0, 294.0, 285.0, 270.0, 250.0, 220.0]$\n    - $q = [0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]$\n    - $K_T = [-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]$\n    - $K_q = [540.0, 450.0, 420.0, 360.0, 300.0, 240.0]$\n    - $\\gamma = [1.00, 1.00, 1.00, 1.00, 1.00, 1.00]$\n\nAlgorithmic requirements:\n\n- For each case, compute $dT(i) = \\gamma(i) \\, dT_s$ with $dT_s = 1.0$.\n- Compute $dq(i) = q(i) \\, \\dfrac{L_v}{R_v \\, T(i)^2} \\, dT(i)$.\n- Compute $dR = \\sum_{i=1}^{N} K_T(i) \\, dT(i) \\;+\\; \\sum_{i=1}^{N} K_q(i) \\, dq(i)$.\n- Return $\\lambda_{\\mathrm{eff}} = dR$ in $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nRequired output:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,result_3,result_4]$).\n- Express each $\\lambda_{\\mathrm{eff}}$ value as a float rounded to four decimal places, in units of $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nDesign considerations and coverage:\n\n- The test suite spans a general tropical case with strong upper-level coupling (Case A), a colder and drier polar case with uniform warming (Case B), an edge-case dry limit with no water vapor kernel (Case C), and a weak lapse-rate coupling case where $\\gamma(i)$ is uniform (Case D).\n- All inputs are scientifically plausible and self-consistent, and the procedure is universally applicable within the linearized kernel methodology for climate feedback analysis.",
            "solution": "The problem statement is scientifically sound, well-posed, and provides all necessary information to compute a unique solution. It is a standard exercise in climate feedback analysis using the established radiative kernel methodology. The provided test cases are physically plausible representations of different atmospheric conditions. No invalidating flaws are identified.\n\nThe objective is to compute the effective climate feedback parameter, $\\lambda_{\\mathrm{eff}}$, which quantifies the net Top of Atmosphere (TOA) radiative response to a surface temperature perturbation. The calculation is based on a linearized model that separates the total radiative perturbation, $dR$, into contributions from temperature changes and specific humidity changes throughout a discretized atmospheric column.\n\nThe fundamental equation provided is:\n$$\ndR \\approx \\sum_{i=1}^{N} K_T(i) \\, dT(i) \\;+\\; \\sum_{i=1}^{N} K_q(i) \\, dq(i)\n$$\nHere, $N$ is the number of vertical levels, $K_T(i)$ and $K_q(i)$ are the temperature and water vapor radiative kernels at level $i$, and $dT(i)$ and $dq(i)$ are the respective changes in temperature and specific humidity at that level.\n\nThe changes $dT(i)$ and $dq(i)$ are not independent. They are coupled to the surface temperature change, $dT_s$. The temperature change at level $i$ is related to $dT_s$ through a lapse-rate coupling factor, $\\gamma(i)$:\n$$\ndT(i) = \\gamma(i) \\, dT_s\n$$\nThe change in specific humidity, $dq(i)$, is governed by the Clausius–Clapeyron relation, under the assumption that relative humidity remains constant. This assumption links the humidity change to the local temperature change, $dT(i)$:\n$$\ndq(i) \\approx q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, dT(i)\n$$\nwhere $T(i)$ and $q(i)$ are the background temperature and specific humidity at level $i$, $L_v$ is the latent heat of vaporization ($2,500,000 \\, \\mathrm{J\\,kg^{-1}}$), and $R_v$ is the gas constant for water vapor ($461 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$).\n\nBy substituting the expression for $dT(i)$ into the equation for $dq(i)$, we can express the humidity change directly in terms of the surface temperature change:\n$$\ndq(i) \\approx q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, \\left(\\gamma(i) \\, dT_s\\right)\n$$\n\nNow, we substitute the expressions for both $dT(i)$ and $dq(i)$ back into the primary equation for $dR$:\n$$\ndR \\approx \\sum_{i=1}^{N} K_T(i) \\left(\\gamma(i) \\, dT_s\\right) \\;+\\; \\sum_{i=1}^{N} K_q(i) \\left(q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, \\gamma(i) \\, dT_s\\right)\n$$\nThe effective climate feedback parameter is defined as $\\lambda_{\\mathrm{eff}} = \\frac{dR}{dT_s}$. Dividing the expression for $dR$ by $dT_s$ yields the final formula for $\\lambda_{\\mathrm{eff}}$:\n$$\n\\lambda_{\\mathrm{eff}} = \\frac{dR}{dT_s} \\approx \\sum_{i=1}^{N} \\left[ K_T(i) \\, \\gamma(i) \\;+\\; K_q(i) \\, q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, \\gamma(i) \\right]\n$$\nThis can be rearranged for computational clarity:\n$$\n\\lambda_{\\mathrm{eff}} \\approx \\sum_{i=1}^{N} \\gamma(i) \\left[ K_T(i) \\;+\\; K_q(i) \\, q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\right]\n$$\nThe problem specifies using $dT_s = 1.0 \\, \\mathrm{K}$, which simplifies the calculation such that $\\lambda_{\\mathrm{eff}}$ is numerically equal to $dR$. The algorithmic procedure is a direct implementation of this calculation.\n\nFor each test case and each level $i$ from $1$ to $N=6$:\n1.  Calculate the temperature change: $dT(i) = \\gamma(i) \\cdot (1.0 \\, \\mathrm{K})$.\n2.  Calculate the specific humidity change: $dq(i) = q(i) \\, \\frac{L_v}{R_v \\, T(i)^2} \\, dT(i)$.\n3.  Calculate the total radiative perturbation by summing the contributions from all levels: $dR = \\sum_{i=1}^{N} \\left[ K_T(i) \\, dT(i) + K_q(i) \\, dq(i) \\right]$.\n4.  The result is $\\lambda_{\\mathrm{eff}} = dR$, with units of $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nThis procedure will be applied to the four provided test cases using array-based computations for efficiency. The results will be rounded to four decimal places as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the effective climate feedback parameter lambda_eff for a set of\n    test cases using a linearized radiative kernel framework.\n    \"\"\"\n    \n    # Define physical constants\n    L_v = 2_500_000.0  # Latent heat of vaporization in J/kg\n    R_v = 461.0        # Gas constant for water vapor in J/(kg*K)\n    dT_s = 1.0         # Surface temperature change in K\n\n    # Define the test suite\n    test_cases = {\n        'A': {\n            'T': np.array([300.0, 294.0, 285.0, 270.0, 250.0, 220.0]),\n            'q': np.array([0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]),\n            'K_T': np.array([-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]),\n            'K_q': np.array([540.0, 450.0, 420.0, 360.0, 300.0, 240.0]),\n            'gamma': np.array([1.00, 1.20, 1.30, 1.50, 1.60, 1.70])\n        },\n        'B': {\n            'T': np.array([270.0, 264.0, 255.0, 240.0, 220.0, 205.0]),\n            'q': np.array([0.0040, 0.0030, 0.0020, 0.0010, 0.0005, 0.0002]),\n            'K_T': np.array([-0.30, -0.25, -0.25, -0.30, -0.40, -0.50]),\n            'K_q': np.array([300.0, 240.0, 210.0, 180.0, 150.0, 120.0]),\n            'gamma': np.array([1.00, 1.00, 1.00, 1.00, 1.00, 1.00])\n        },\n        'C': {\n            'T': np.array([300.0, 294.0, 285.0, 270.0, 250.0, 220.0]),\n            'q': np.array([0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]),\n            'K_T': np.array([-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]),\n            'K_q': np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0]),\n            'gamma': np.array([1.00, 1.20, 1.30, 1.50, 1.60, 1.70])\n        },\n        'D': {\n            'T': np.array([300.0, 294.0, 285.0, 270.0, 250.0, 220.0]),\n            'q': np.array([0.0180, 0.0120, 0.0070, 0.0030, 0.0010, 0.0003]),\n            'K_T': np.array([-0.35, -0.25, -0.30, -0.40, -0.50, -0.60]),\n            'K_q': np.array([540.0, 450.0, 420.0, 360.0, 300.0, 240.0]),\n            'gamma': np.array([1.00, 1.00, 1.00, 1.00, 1.00, 1.00])\n        }\n    }\n    \n    results = []\n    # Process test cases in specified order: A, B, C, D\n    for case_id in sorted(test_cases.keys()):\n        case_data = test_cases[case_id]\n        \n        # Extract data for the current case\n        T = case_data['T']\n        q = case_data['q']\n        K_T = case_data['K_T']\n        K_q = case_data['K_q']\n        gamma = case_data['gamma']\n        \n        # Step 1: Compute the temperature change at each level i\n        # dT(i) = gamma(i) * dT_s\n        dT = gamma * dT_s\n        \n        # Step 2: Compute the specific humidity change at each level i\n        # dq(i) = q(i) * (L_v / (R_v * T(i)^2)) * dT(i)\n        clausius_clapeyron_factor = L_v / (R_v * T**2)\n        dq = q * clausius_clapeyron_factor * dT\n        \n        # Step 3: Compute the total radiative perturbation dR\n        # dR = sum( K_T(i)*dT(i) ) + sum( K_q(i)*dq(i) )\n        dR_T = np.sum(K_T * dT)\n        dR_q = np.sum(K_q * dq)\n        dR = dR_T + dR_q\n        \n        # Step 4: The effective feedback parameter lambda_eff is dR since dT_s = 1.0\n        lambda_eff = dR\n        \n        results.append(lambda_eff)\n        \n    # Format the final output as a comma-separated list of floats\n    # rounded to four decimal places, enclosed in square brackets.\n    print(f\"[{','.join([f'{r:.4f}' for r in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Cloud feedbacks remain the largest source of uncertainty in projections of future climate change, as clouds have competing effects on the planet's energy budget. This exercise applies the radiative kernel method to the complex problem of diagnosing cloud feedbacks, building upon the techniques used in the previous practice. You will calculate the net change in the top-of-atmosphere (TOA) energy balance resulting from changes in clouds, explicitly accounting for their separate longwave (warming) and shortwave (cooling) radiative effects . This provides a practical, quantitative framework for evaluating one of the most critical aspects of climate model performance.",
            "id": "4022297",
            "problem": "You are tasked with implementing a diagnostic calculation of cloud feedback using a kernel-based linearization grounded in the top-of-atmosphere energy balance. Begin from the conservation of energy at the Top-of-Atmosphere (TOA), which states that net downward radiative flux adjusts toward balance with imposed radiative forcing and the system’s thermodynamic response. Define the Cloud Radiative Effect (CRE) as the difference between all-sky and clear-sky TOA net flux. For small perturbations to cloud fraction, invoke a first-order Taylor expansion of TOA net flux in the cloud variable to connect infinitesimal changes in cloud fraction to changes in TOA flux via radiative sensitivities (kernels). Treat the global mean as an area-weighted average over a discrete grid. Define the cloud feedback parameter as the linear sensitivity of the cloud-induced TOA flux change with respect to surface temperature change, and compute it as the ratio of the diagnosed global flux change to a prescribed surface temperature change. Use net downward-positive flux sign convention. Express all fluxes in watts per square meter and surface temperature changes in kelvin, and report the cloud feedback parameter in watts per square meter per kelvin.\n\nYou must implement the following diagnostic in code:\n- The CRE perturbation associated with cloud changes is diagnosed using provided longwave and shortwave radiative kernel values per grid cell, multiplied by the cloud fraction change per grid cell, combined additively for longwave and shortwave contributions, and area-weighted to yield the global mean TOA flux change due to clouds.\n- The cloud feedback parameter is the global mean CRE perturbation divided by the given surface temperature change.\n\nYour program must compute the cloud feedback parameter for each of the test cases below and produce one final line of output containing the results as a comma-separated list enclosed in square brackets (for example, \"[result_1,result_2,result_3]\"), where each $r_i$ is a float in watts per square meter per kelvin. The calculations must use the provided inputs exactly, and the output values must be rounded to six decimal places.\n\nTest Suite:\n- Case $1$ (general case, mixed-sign cloud changes):\n  - Grid has $6$ cells with equal area weights $w_i = \\tfrac{1}{6}$ for $i \\in \\{1,2,3,4,5,6\\}$.\n  - Longwave kernels per unit cloud fraction: $[\\,1.2,\\,0.8,\\,1.0,\\,1.1,\\,0.9,\\,0.7\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Shortwave kernels per unit cloud fraction: $[\\,-3.0,\\,-2.5,\\,-2.8,\\,-3.2,\\,-2.9,\\,-2.6\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Cloud fraction changes: $[\\,0.02,\\,0.01,\\,-0.01,\\,0.00,\\,0.03,\\,-0.02\\,]$ (dimensionless).\n  - Surface temperature change: $\\Delta T_s = 2.0$ in $\\mathrm{K}$.\n  - Required output unit: $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n- Case $2$ (boundary case, zero cloud change):\n  - Grid has $3$ cells with equal area weights $w_i = \\tfrac{1}{3}$ for $i \\in \\{1,2,3\\}$.\n  - Longwave kernels per unit cloud fraction: $[\\,1.0,\\,1.5,\\,0.5\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Shortwave kernels per unit cloud fraction: $[\\,-2.0,\\,-1.0,\\,-3.0\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Cloud fraction changes: $[\\,0.0,\\,0.0,\\,0.0\\,]$ (dimensionless).\n  - Surface temperature change: $\\Delta T_s = 3.0$ in $\\mathrm{K}$.\n  - Required output unit: $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n- Case $3$ (edge case, small temperature change, uniform positive cloud increase over four cells):\n  - Grid has $4$ cells with equal area weights $w_i = \\tfrac{1}{4}$ for $i \\in \\{1,2,3,4\\}$.\n  - Longwave kernels per unit cloud fraction: $[\\,2.0,\\,1.8,\\,2.2,\\,2.1\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Shortwave kernels per unit cloud fraction: $[\\,-1.0,\\,-1.2,\\,-0.8,\\,-1.1\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n  - Cloud fraction changes: $[\\,0.05,\\,0.05,\\,0.05,\\,0.05\\,]$ (dimensionless).\n  - Surface temperature change: $\\Delta T_s = 0.1$ in $\\mathrm{K}$.\n  - Required output unit: $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[1.234567,-0.123456,0.500000]\".\n- Each entry must be a float representing the cloud feedback parameter for the corresponding test case in units of $\\mathrm{W\\,m^{-2}\\,K^{-1}}$, rounded to six decimal places.",
            "solution": "The user's request is to provide a solution to a problem in climate feedback analysis.\n\n### Step 1: Extract Givens\n- **Conceptual Framework**: The problem is based on the top-of-atmosphere (TOA) energy balance. The Cloud Radiative Effect (CRE) is the difference between all-sky and clear-sky TOA net flux. A first-order Taylor expansion approximates the change in TOA flux due to small changes in cloud fraction. Radiative sensitivities (kernels) link cloud fraction changes to TOA flux changes. The global mean is an area-weighted average. The sign convention is net downward-positive flux.\n- **Task**: Implement a diagnostic to calculate the cloud feedback parameter.\n- **Calculation Steps**:\n    1.  The CRE perturbation, $\\Delta R_c$, is diagnosed for each grid cell $i$ by summing the longwave (LW) and shortwave (SW) contributions: $\\Delta R_{c,i} = (K_{LW,i} + K_{SW,i}) \\Delta c_i$, where $K$ are the kernels and $\\Delta c_i$ is the cloud fraction change.\n    2.  The global mean CRE perturbation, $\\langle\\Delta R_c\\rangle$, is the area-weighted average of the per-cell values.\n    3.  The cloud feedback parameter, $\\lambda_c$, is the ratio of the global mean CRE perturbation to the prescribed surface temperature change, $\\Delta T_s$: $\\lambda_c = \\langle\\Delta R_c\\rangle / \\Delta T_s$.\n- **Units**: Fluxes are in $\\mathrm{W\\,m^{-2}}$, temperature change is in $\\mathrm{K}$, and the feedback parameter is in $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n- **Test Case 1**:\n    - Grid cells: $N=6$, with equal area weights $w_i = 1/6$.\n    - Longwave kernels ($K_{LW}$): $[\\,1.2,\\,0.8,\\,1.0,\\,1.1,\\,0.9,\\,0.7\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Shortwave kernels ($K_{SW}$): $[\\,-3.0,\\,-2.5,\\,-2.8,\\,-3.2,\\,-2.9,\\,-2.6\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Cloud fraction changes ($\\Delta c$): $[\\,0.02,\\,0.01,\\,-0.01,\\,0.00,\\,0.03,\\,-0.02\\,]$ (dimensionless).\n    - Surface temperature change ($\\Delta T_s$): $2.0$ $\\mathrm{K}$.\n- **Test Case 2**:\n    - Grid cells: $N=3$, with equal area weights $w_i = 1/3$.\n    - Longwave kernels ($K_{LW}$): $[\\,1.0,\\,1.5,\\,0.5\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Shortwave kernels ($K_{SW}$): $[\\,-2.0,\\,-1.0,\\,-3.0\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Cloud fraction changes ($\\Delta c$): $[\\,0.0,\\,0.0,\\,0.0\\,]$ (dimensionless).\n    - Surface temperature change ($\\Delta T_s$): $3.0$ $\\mathrm{K}$.\n- **Test Case 3**:\n    - Grid cells: $N=4$, with equal area weights $w_i = 1/4$.\n    - Longwave kernels ($K_{LW}$): $[\\,2.0,\\,1.8,\\,2.2,\\,2.1\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Shortwave kernels ($K_{SW}$): $[\\,-1.0,\\,-1.2,\\,-0.8,\\,-1.1\\,]$ in $\\mathrm{W\\,m^{-2}}$.\n    - Cloud fraction changes ($\\Delta c$): $[\\,0.05,\\,0.05,\\,0.05,\\,0.05\\,]$ (dimensionless).\n    - Surface temperature change ($\\Delta T_s$): $0.1$ $\\mathrm{K}$.\n- **Output Requirement**: A single line with a comma-separated list of results for each test case, enclosed in square brackets. Each result must be a float rounded to six decimal places.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem describes the radiative kernel method, a standard and widely used technique in climate science for diagnosing and comparing climate feedbacks from general circulation models. The underlying principles (TOA energy balance, linearization, CRE) are fundamental to atmospheric physics and climate dynamics. The provided numerical values for kernels, cloud changes, and temperature changes are physically plausible within the context of climate model simulations. The problem is scientifically sound.\n- **Well-Posed**: The problem provides a clear, unambiguous definition of the quantity to be calculated (the cloud feedback parameter, $\\lambda_c$) and a precise algorithm. All necessary inputs (kernels, cloud changes, area weights, temperature change) are given for each test case. The calculation is deterministic and yields a unique, stable, and meaningful solution for each case. The problem is well-posed.\n- **Objective**: The problem is stated in objective, technical language. The task is a formal mathematical computation based on physical principles, free from subjectivity or opinion.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. It is scientifically grounded, well-posed, objective, and self-contained. The solution process may proceed.\n\n### Solution\nThe problem requires the calculation of the cloud feedback parameter, $\\lambda_c$, using the radiative kernel method. The methodology is grounded in a linearization of the Top-of-Atmosphere (TOA) energy balance.\n\nLet $R$ be the net downward radiative flux at the TOA. A change in climate state leads to a perturbation $\\Delta R$. The component of this perturbation caused by a change in cloud fraction, $\\Delta c$, is denoted as $\\Delta R_c$. For a sufficiently small change $\\Delta c$, we can use a first-order Taylor expansion to approximate $\\Delta R_c$:\n$$\n\\Delta R_c \\approx \\frac{\\partial R}{\\partial c} \\Delta c\n$$\nThe term $\\frac{\\partial R}{\\partial c}$ is the radiative kernel, $K$, which represents the sensitivity of the TOA net flux to a unit change in cloud fraction. The problem provides separate kernels for the longwave ($K_{LW}$) and shortwave ($K_{SW}$) components of the radiation budget. The total effect is the sum of these contributions.\n\nThe calculation is performed on a discrete grid of $N$ cells. For each grid cell $i$, the change in TOA flux due to the local cloud fraction change $\\Delta c_i$ is given by:\n$$\n\\Delta R_{c,i} = (K_{LW,i} + K_{SW,i}) \\Delta c_i\n$$\nwhere $K_{LW,i}$ and $K_{SW,i}$ are the longwave and shortwave kernels for cell $i$, respectively.\n\nThe global mean TOA flux perturbation due to clouds, $\\langle \\Delta R_c \\rangle$, is the area-weighted average of the local flux perturbations over all $N$ grid cells. Given the area weight $w_i$ for each cell, where $\\sum_{i=1}^{N} w_i = 1$, the global mean is:\n$$\n\\langle \\Delta R_c \\rangle = \\sum_{i=1}^{N} w_i \\Delta R_{c,i}\n$$\n\nFinally, the cloud feedback parameter, $\\lambda_c$, is defined as the sensitivity of this global mean flux perturbation to the global mean surface temperature change, $\\Delta T_s$. It is computed as the ratio:\n$$\n\\lambda_c = \\frac{\\langle \\Delta R_c \\rangle}{\\Delta T_s}\n$$\nSubstituting the previous expressions, the complete formula for the cloud feedback parameter is:\n$$\n\\lambda_c = \\frac{\\sum_{i=1}^{N} w_i (K_{LW,i} + K_{SW,i}) \\Delta c_i}{\\Delta T_s}\n$$\n\nWe apply this formula to each test case.\n\n**Case 1 Calculation:**\n- $N = 6$, $w_i = \\frac{1}{6}$ for all $i$.\n- $K_{LW} = [\\,1.2,\\,0.8,\\,1.0,\\,1.1,\\,0.9,\\,0.7\\,]$ $\\mathrm{W\\,m^{-2}}$\n- $K_{SW} = [\\, -3.0,\\, -2.5,\\, -2.8,\\, -3.2,\\, -2.9,\\, -2.6\\,]$ $\\mathrm{W\\,m^{-2}}$\n- $\\Delta c = [\\,0.02,\\,0.01,\\,-0.01,\\,0.00,\\,0.03,\\,-0.02\\,]$\n- $\\Delta T_s = 2.0$ $\\mathrm{K}$\n\n1.  Calculate the total kernel for each cell, $K_{tot,i} = K_{LW,i} + K_{SW,i}$:\n    $K_{tot} = [\\,1.2-3.0,\\, 0.8-2.5,\\, 1.0-2.8,\\, 1.1-3.2,\\, 0.9-2.9,\\, 0.7-2.6\\,]$\n    $K_{tot} = [\\, -1.8,\\, -1.7,\\, -1.8,\\, -2.1,\\, -2.0,\\, -1.9\\,]$ $\\mathrm{W\\,m^{-2}}$\n\n2.  Calculate the local flux perturbation for each cell, $\\Delta R_{c,i} = K_{tot,i} \\Delta c_i$:\n    $\\Delta R_{c,1} = -1.8 \\times 0.02 = -0.036$ $\\mathrm{W\\,m^{-2}}$\n    $\\Delta R_{c,2} = -1.7 \\times 0.01 = -0.017$ $\\mathrm{W\\,m^{-2}}$\n    $\\Delta R_{c,3} = -1.8 \\times -0.01 = +0.018$ $\\mathrm{W\\,m^{-2}}$\n    $\\Delta R_{c,4} = -2.1 \\times 0.00 = 0.000$ $\\mathrm{W\\,m^{-2}}$\n    $\\Delta R_{c,5} = -2.0 \\times 0.03 = -0.060$ $\\mathrm{W\\,m^{-2}}$\n    $\\Delta R_{c,6} = -1.9 \\times -0.02 = +0.038$ $\\mathrm{W\\,m^{-2}}$\n\n3.  Calculate the global mean flux perturbation, $\\langle \\Delta R_c \\rangle = \\frac{1}{6} \\sum_{i=1}^{6} \\Delta R_{c,i}$:\n    $\\sum \\Delta R_{c,i} = -0.036 - 0.017 + 0.018 + 0.000 - 0.060 + 0.038 = -0.057$ $\\mathrm{W\\,m^{-2}}$\n    $\\langle \\Delta R_c \\rangle = \\frac{-0.057}{6} = -0.0095$ $\\mathrm{W\\,m^{-2}}$\n\n4.  Calculate the cloud feedback parameter, $\\lambda_c = \\frac{\\langle \\Delta R_c \\rangle}{\\Delta T_s}$:\n    $\\lambda_c = \\frac{-0.0095}{2.0} = -0.00475$ $\\mathrm{W\\,m^{-2}\\,K^{-1}}$\n\n**Case 2 Calculation:**\n- $\\Delta c_i = 0.0$ for all cells.\n- Any change in cloud fraction of $0$ results in a flux perturbation of $\\Delta R_{c,i} = 0$. Consequently, the global mean $\\langle \\Delta R_c \\rangle = 0$.\n- With $\\Delta T_s = 3.0$ $\\mathrm{K}$, the feedback parameter is $\\lambda_c = \\frac{0.0}{3.0} = 0.0$ $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\n**Case 3 Calculation:**\n- $N=4$, $w_i = \\frac{1}{4}$, $\\Delta c_i = 0.05$, $\\Delta T_s = 0.1$ $\\mathrm{K}$.\n- $K_{LW} = [\\,2.0,\\,1.8,\\,2.2,\\,2.1\\,]$, $K_{SW} = [\\, -1.0,\\, -1.2,\\, -0.8,\\, -1.1\\,]$.\n1.  $K_{tot} = [\\,1.0,\\,0.6,\\,1.4,\\,1.0\\,]$ $\\mathrm{W\\,m^{-2}}$.\n2.  Since $\\Delta c_i$ is constant, we can average the kernels first:\n    $\\langle K_{tot} \\rangle = \\frac{1}{4}(1.0 + 0.6 + 1.4 + 1.0) = \\frac{4.0}{4} = 1.0$ $\\mathrm{W\\,m^{-2}}$.\n    Then $\\langle \\Delta R_c \\rangle = \\langle K_{tot} \\rangle \\times \\Delta c = 1.0 \\times 0.05 = 0.05$ $\\mathrm{W\\,m^{-2}}$.\n3.  $\\lambda_c = \\frac{\\langle \\Delta R_c \\rangle}{\\Delta T_s} = \\frac{0.05}{0.1} = 0.5$ $\\mathrm{W\\,m^{-2}\\,K^{-1}}$.\n\nThe results for the three test cases, rounded to six decimal places, are $-0.004750$, $0.000000$, and $0.500000$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the cloud feedback parameter for a series of test cases\n    using the radiative kernel method.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (general case, mixed-sign cloud changes):\n        {\n            \"lw_kernels\": [1.2, 0.8, 1.0, 1.1, 0.9, 0.7],\n            \"sw_kernels\": [-3.0, -2.5, -2.8, -3.2, -2.9, -2.6],\n            \"cloud_changes\": [0.02, 0.01, -0.01, 0.00, 0.03, -0.02],\n            \"n_cells\": 6,\n            \"delta_ts\": 2.0\n        },\n        # Case 2 (boundary case, zero cloud change):\n        {\n            \"lw_kernels\": [1.0, 1.5, 0.5],\n            \"sw_kernels\": [-2.0, -1.0, -3.0],\n            \"cloud_changes\": [0.0, 0.0, 0.0],\n            \"n_cells\": 3,\n            \"delta_ts\": 3.0\n        },\n        # Case 3 (edge case, small temperature change, uniform positive cloud increase):\n        {\n            \"lw_kernels\": [2.0, 1.8, 2.2, 2.1],\n            \"sw_kernels\": [-1.0, -1.2, -0.8, -1.1],\n            \"cloud_changes\": [0.05, 0.05, 0.05, 0.05],\n            \"n_cells\": 4,\n            \"delta_ts\": 0.1\n        }\n    ]\n\n    def calculate_cloud_feedback(lw_k, sw_k, dc, n, dt_s):\n        \"\"\"\n        Calculates the cloud feedback parameter based on provided data.\n\n        Args:\n            lw_k (list): Longwave radiative kernels per grid cell.\n            sw_k (list): Shortwave radiative kernels per grid cell.\n            dc (list): Cloud fraction changes per grid cell.\n            n (int): Number of grid cells.\n            dt_s (float): Surface temperature change.\n\n        Returns:\n            float: The calculated cloud feedback parameter.\n        \"\"\"\n        # Convert lists to NumPy arrays for efficient vectorized calculations.\n        lw_kernels = np.array(lw_k)\n        sw_kernels = np.array(sw_k)\n        cloud_changes = np.array(dc)\n        \n        # Grid cells have equal area weights.\n        weights = np.full(n, 1.0 / n)\n        \n        # 1. Calculate the total radiative kernel per grid cell by summing LW and SW parts.\n        total_kernels = lw_kernels + sw_kernels\n        \n        # 2. Calculate the TOA flux change per grid cell (CRE perturbation).\n        flux_change_per_cell = total_kernels * cloud_changes\n        \n        # 3. Calculate the global mean TOA flux change by area-weighted averaging.\n        global_mean_flux_change = np.sum(weights * flux_change_per_cell)\n        \n        # 4. Calculate the cloud feedback parameter. A check for dt_s=0 is prudent,\n        # but not required by the problem's test cases.\n        if dt_s == 0:\n            # According to the problem definition, this would be an undefined case.\n            # However, all provided delta_ts values are non-zero.\n            return np.nan \n            \n        cloud_feedback_parameter = global_mean_flux_change / dt_s\n        \n        return cloud_feedback_parameter\n\n    results = []\n    for case in test_cases:\n        lambda_c = calculate_cloud_feedback(\n            lw_k=case[\"lw_kernels\"],\n            sw_k=case[\"sw_kernels\"],\n            dc=case[\"cloud_changes\"],\n            n=case[\"n_cells\"],\n            dt_s=case[\"delta_ts\"]\n        )\n        # Format the result to six decimal places as a string.\n        results.append(f\"{lambda_c:.6f}\")\n\n    # Print the final output in the required format: \"[r1,r2,r3]\"\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}