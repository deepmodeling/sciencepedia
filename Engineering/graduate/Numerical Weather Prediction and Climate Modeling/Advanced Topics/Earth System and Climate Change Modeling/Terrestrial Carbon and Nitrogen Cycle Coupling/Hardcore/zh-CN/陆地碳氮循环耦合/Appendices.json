{
    "hands_on_practices": [
        {
            "introduction": "陆地生物地球化学模型的核心是质量守恒和化学计量耦合的基本原理。这个练习将这些抽象概念具体化，通过一个简化的土壤系统模型，让您亲手实践如何构建和求解碳氮循环的稳态。通过计算微生物和矿物库的稳态大小，您将掌握将过程描述转化为数学方程并求解的核心技能，这是理解和开发更复杂地球系统模型的基础。",
            "id": "4099193",
            "problem": "一个与大气数值天气预报（NWP）系统和地球系统模型耦合的陆地表面生物地球化学模块，使用质量守恒和一级动力学来表征植物凋落物和矿物氮的微生物处理过程。考虑一个具有以下库和通量的土壤柱：\n\n- 微生物生物量碳 $M_C$ 和微生物生物量氮 $M_N$，受限于一个给定的微生物碳氮比（C:N） $R_m$，使得在任何时候都有 $M_N = M_C / R_m$。\n- 矿物（无机）氮 $N_{\\mathrm{min}}$，其淋溶过程表现为一级损失。\n\n植物凋落物以恒定的碳输入速率 $I_C$ 和凋落物碳氮比（C:N） $R_\\ell$ 提供碳，因此凋落物氮输入速率为 $I_N = I_C / R_\\ell$。微生物以碳同化效率 $y_C$ 同化一部分凋落物输入的碳，产生同化通量 $A_C = y_C I_C$，剩余的凋落物碳立即作为二氧化碳被呼吸消耗。微生物生物量以一级速率常数 $k_M$ 进行周转，将其氮含量释放到矿物氮库中。微生物生物量的合成需要与碳成比例的氮，其比例为微生物碳氮比 $R_m$；微生物首先利用与同化的凋落物碳一同供给的氮来满足这一需求，如有必要，再通过吸收矿物氮来满足。矿物氮也通过大气沉降以恒定速率 $D_N$ 供给，并以一级速率常数 $k_L$ 通过淋溶从土壤柱中损失。\n\n假设系统已达到稳态。使用质量守恒和化学计量耦合的基本原理，根据以下科学上现实的参数值，计算稳态库的大小 $M_C$、$M_N$ 和 $N_{\\mathrm{min}}$：\n- $I_C = 400$ g C m$^{-2}$ yr$^{-1}$，\n- $R_\\ell = 40$，\n- $y_C = 0.30$，\n- $k_M = 4$ yr$^{-1}$，\n- $R_m = 8$，\n- $D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$，\n- $k_L = 4$ yr$^{-1}$。\n\n此外，通过明确指出相关通量，验证您计算出的稳态解满足碳的质量平衡（输入等于输出）和氮的质量平衡（净外部输入等于净外部输出）。\n\n将每个库的大小四舍五入到四位有效数字。$M_C$ 的单位为 g C m$^{-2}$，$M_N$ 和 $N_{\\mathrm{min}}$ 的单位为 g N m$^{-2}$。",
            "solution": "该问题被评估为有效，因为它科学地基于生物地球化学模型的既定原则，其设定良好，具有一套完整且一致的参数，并以客观、正式的语言表述。因此，我们可以着手求解。\n\n解法源于三个状态变量（库）中每一个的质量守恒原理：微生物生物量碳（$M_C$）、微生物生物量氮（$M_N$）和矿物氮（$N_{\\mathrm{min}}$）。系统被假设处于稳态，这意味着对于每个库，所有输入通量之和等于所有输出通量之和。\n\n首先，我们建立描述微生物碳库 $M_C$ 变化率的常微分方程：\n$$\n\\frac{dM_C}{dt} = (\\text{输入}) - (\\text{输出})\n$$\n微生物碳的唯一输入是来自植物凋落物的碳同化。凋落物碳输入速率为 $I_C$，微生物同化的比例是碳同化效率 $y_C$。因此，碳同化通量为 $A_C = y_C I_C$。微生物碳库的输出是由于生物量周转（死亡和呼吸），这被建模为一个一级过程，速率常数为 $k_M$。因此周转通量为 $k_M M_C$。$M_C$ 的质量平衡方程是：\n$$\n\\frac{dM_C}{dt} = y_C I_C - k_M M_C\n$$\n在稳态下，$\\frac{dM_C}{dt} = 0$。求解稳态微生物碳库大小，记为 $M_C^*$：\n$$\ny_C I_C - k_M M_C^* = 0 \\implies M_C^* = \\frac{y_C I_C}{k_M}\n$$\n接下来，我们确定稳态微生物氮库 $M_N^*$。问题陈述了一个严格的化学计量约束：$M_N = M_C / R_m$，其中 $R_m$ 是微生物的碳氮比。这个关系必须在任何时候都成立，包括在稳态时。\n$$\nM_N^* = \\frac{M_C^*}{R_m} = \\frac{1}{R_m} \\left( \\frac{y_C I_C}{k_M} \\right) = \\frac{y_C I_C}{k_M R_m}\n$$\n最后，我们建立矿物氮库 $N_{\\mathrm{min}}$ 的质量平衡方程。\n$$\n\\frac{dN_{\\mathrm{min}}}{dt} = (\\text{输入}) - (\\text{输出})\n$$\n矿物氮库的输入包括：\n$1$. 大气沉降，以恒定速率 $D_N$ 给出。\n$2$. 微生物周转产生的矿化。微生物碳周转通量为 $k_M M_C^*$。该生物量中的氮含量被释放到矿物库中，因此该通量为 $(k_M M_C^*) / R_m = k_M M_N^*$。\n$3$. 凋落物处理过程中的净矿化或固持。微生物需要 $(y_C I_C) / R_m$ 的氮通量来支持其碳同化。凋落物本身提供的氮通量为 $I_N = I_C / R_\\ell$。凋落物提供的氮与生长所需的氮之间的平衡决定了是向矿物库净释放氮（矿化）还是从矿物库净吸收氮（固持）。这个净通量 $F_{N, \\text{process}}$ 为：\n$$\nF_{N, \\text{process}} = (\\text{凋落物中供应的氮}) - (\\text{生长所需的氮}) = \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m}\n$$\n如果 $F_{N, \\text{process}} > 0$，这是 $N_{\\mathrm{min}}$ 的净输入。如果 $F_{N, \\text{process}}  0$，其绝对值代表从 $N_{\\mathrm{min}}$ 的净输出（吸收）。\n\n矿物氮库的输出包括：\n$1$. 淋溶，一个一级损失过程，速率常数为 $k_L$，产生的通量为 $k_L N_{\\mathrm{min}}$。\n$2$. 固持，如果需要的话。如上所述，当 $F_{N, \\text{process}}  0$ 时发生。吸收通量则为 $U_{\\text{immob}} = -F_{N, \\text{process}} = \\frac{y_C I_C}{R_m} - \\frac{I_C}{R_\\ell}$。\n\n合并 $N_{\\mathrm{min}}$ 库的所有通量：\n$$\n\\frac{dN_{\\mathrm{min}}}{dt} = D_N + k_M M_N^* + \\left( \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} \\right) - k_L N_{\\mathrm{min}}\n$$\n这里假设括号中的项代表净通量。如果它为负，它会正确地从输入中减去。在稳态下，$\\frac{dN_{\\mathrm{min}}}{dt} = 0$，并代入 $M_N^* = \\frac{y_C I_C}{k_M R_m}$：\n$$\n0 = D_N + k_M \\left( \\frac{y_C I_C}{k_M R_m} \\right) + \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} - k_L N_{\\mathrm{min}}^*\n$$\n简化表达式后发现，与微生物氮需求和周转产生的氮矿化相关的项相互抵消：\n$$\n0 = D_N + \\frac{y_C I_C}{R_m} + \\frac{I_C}{R_\\ell} - \\frac{y_C I_C}{R_m} - k_L N_{\\mathrm{min}}^*\n$$\n$$\n0 = D_N + \\frac{I_C}{R_\\ell} - k_L N_{\\mathrm{min}}^*\n$$\n这个简化的方程代表了整个土壤系统（微生物库和矿物库的总和）在稳态下的氮平衡：总外部输入（$D_N + I_C/R_\\ell$）必须等于总外部输出（$k_L N_{\\mathrm{min}}^*$）。求解稳态矿物氮库 $N_{\\mathrm{min}}^*$：\n$$\nN_{\\mathrm{min}}^* = \\frac{D_N + I_C/R_\\ell}{k_L}\n$$\n现在，我们代入给定的参数值来计算数值结果。\n给定值：\n$I_C = 400$ g C m$^{-2}$ yr$^{-1}$\n$R_\\ell = 40$\n$y_C = 0.30$\n$k_M = 4$ yr$^{-1}$\n$R_m = 8$\n$D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$\n$k_L = 4$ yr$^{-1}$\n\n$M_C^*$ 的计算：\n$$\nM_C^* = \\frac{y_C I_C}{k_M} = \\frac{0.30 \\times 400 \\text{ g C m}^{-2} \\text{ yr}^{-1}}{4 \\text{ yr}^{-1}} = \\frac{120}{4} \\text{ g C m}^{-2} = 30 \\text{ g C m}^{-2}\n$$\n四舍五入到四位有效数字，$M_C^* = 30.00$ g C m$^{-2}$。\n\n$M_N^*$ 的计算：\n$$\nM_N^* = \\frac{M_C^*}{R_m} = \\frac{30 \\text{ g C m}^{-2}}{8} = 3.75 \\text{ g N m}^{-2}\n$$\n四舍五入到四位有效数字，$M_N^* = 3.750$ g N m$^{-2}$。\n\n$N_{\\mathrm{min}}^*$ 的计算：\n$$\nN_{\\mathrm{min}}^* = \\frac{D_N + I_C/R_\\ell}{k_L} = \\frac{1.0 \\text{ g N m}^{-2} \\text{ yr}^{-1} + (400 / 40) \\text{ g N m}^{-2} \\text{ yr}^{-1}}{4 \\text{ yr}^{-1}} = \\frac{1.0 + 10}{4} \\text{ g N m}^{-2} = \\frac{11}{4} \\text{ g N m}^{-2} = 2.75 \\text{ g N m}^{-2}\n$$\n四舍五入到四位有效数字，$N_{\\mathrm{min}}^* = 2.750$ g N m$^{-2}$。\n\n最后，我们验证稳态下的碳和氮的质量平衡。\n\n碳质量平衡验证：\n- 总碳输入通量 = $I_C = 400$ g C m$^{-2}$ yr$^{-1}$。\n- 总碳输出通量 = 凋落物处理产生的呼吸 + 微生物周转产生的呼吸。\n  - 凋落物处理产生的呼吸 = $(1 - y_C) I_C = (1 - 0.30) \\times 400 = 0.70 \\times 400 = 280$ g C m$^{-2}$ yr$^{-1}$。\n  - 微生物周转产生的呼吸 = $k_M M_C^* = 4 \\text{ yr}^{-1} \\times 30 \\text{ g C m}^{-2} = 120$ g C m$^{-2}$ yr$^{-1}$。\n- 总碳输出 = $280 + 120 = 400$ g C m$^{-2}$ yr$^{-1}$。\n总输入（$400$）等于总输出（$400$），因此碳循环是平衡的。\n\n氮质量平衡验证：\n- 总外部氮输入通量 = 凋落物氮输入 + 大气沉降。\n  - 凋落物氮输入 = $I_N = I_C / R_\\ell = 400 / 40 = 10$ g N m$^{-2}$ yr$^{-1}$。\n  - 大气沉降 = $D_N = 1.0$ g N m$^{-2}$ yr$^{-1}$。\n- 总外部氮输入 = $10 + 1.0 = 11.0$ g N m$^{-2}$ yr$^{-1}$。\n- 总外部氮输出通量 = 淋溶损失。\n  - 淋溶损失 = $k_L N_{\\mathrm{min}}^* = 4 \\text{ yr}^{-1} \\times 2.750 \\text{ g N m}^{-2} = 11.0$ g N m$^{-2}$ yr$^{-1}$。\n总外部输入（$11.0$）等于总外部输出（$11.0$），因此氮循环是平衡的。该解法内部一致，并满足守恒定律。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 30.00  3.750  2.750 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论上的质量守恒在模型的数值实现中可能因为离散化和逼近而出现微小偏差。验证数值方案是否精确地保持质量守恒，是模型开发中至关重要的一步。这个动手实践引导您从理论分析走向计算验证，通过对一个动态碳氮循环模型进行数值积分，并计算质量平衡残差，您将学会如何诊断和量化模型的数值守恒性能，这是确保气候和天气预报模型长期稳定性和物理真实性的关键实践。",
            "id": "4099145",
            "problem": "要求您在一个常用于数值天气预报和气候模拟的简化耦合陆地生物地球化学模型中，验证碳和氮的质量守恒。该模型追踪土壤有机质和植物生物量中的碳和氮，以及一个矿物氮库，其中的分解、矿化、植物吸收、死亡和淋溶等过程是化学计量耦合的。您必须通过对控制性常微分方程（ODE）进行数值积分，并独立地对模型规定的外部源和汇进行数值积分，来计算在指定时间间隔内的质量平衡残差。您的程序必须为每个测试用例返回一个非负浮点数，该浮点数等于碳和氮中最大的绝对残差，单位为千克/平方米，形式为单行列表。\n\n基本原理：每种元素的质量守恒定律指出，被追踪的库中总质量的时间变化率等于外部源的总和减去外部汇的总和。对于任何元素，其在被追踪库中的总质量为 $M(t)$，外部源速率为 $S_{\\text{in}}(t)$，外部汇速率为 $S_{\\text{out}}(t)$，在时间间隔 $[0,T]$ 上的积分形式为\n$$\nM(T) - M(0) = \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt.\n$$\n质量平衡残差定义为\n$$\n\\mathcal{R} = \\left(M(T) - M(0)\\right) - \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt,\n$$\n对于一个正确且一致的模型，在精确计算中该值应为 $0$；非零值的出现仅源于数值近似。\n\n模型结构和单位：\n- 状态变量（单位均为千克/平方米）：土壤有机碳 $C_s$，土壤有机氮 $N_s$，矿物氮 $N_m$，植物碳 $C_p$，植物氮 $N_p$。\n- 时间 $t$ 单位为天。\n- 每个测试用例的参数在下面指定，单位一致。\n\n过程：\n- 分解和矿化：土壤有机质以速率 $k_d$ (每天)进行一级衰减，按其当前量从土壤有机库中移除碳和氮。从 $C_s$ 损失的碳以二氧化碳形式排放（外部汇）。从 $N_s$ 损失的氮进入 $N_m$（内部转移）。\n- 植物对矿物氮的吸收：采用米氏方程形式，最大速率为 $V_{\\max}$ (千克氮/平方米/天)，半饱和常数为 $K$ (千克氮/平方米)，\n$$\nU_N(N_m) = V_{\\max}\\,\\frac{N_m}{K + N_m}.\n$$\n吸收过程将氮从 $N_m$ 转移到 $N_p$（内部转移），而来自大气的光合固碳以恒定的植物碳氮比 $y_p$ (千克碳/千克氮)与氮吸收成化学计量比例，为植物生长提供碳。这种光合输入是一个速率为 $y_p\\,U_N$ 的外部碳源。\n- 植物死亡：以速率 $m$ (每天)进行的一级损失将植物碳和氮转移回土壤有机库（内部转移）。\n- 矿物氮淋溶：以速率 $\\ell$ (每天)进行的一级损失将 $N_m$ 从系统中移除（外部汇）。\n- 凋落物输入：常数外部输入 $L_C$ (千克碳/平方米/天)到 $C_s$，以及 $L_N$ (千克氮/平方米/天)到 $N_s$。\n- 大气氮沉降：常数外部输入 $D_N$ (千克氮/平方米/天)到 $N_m$。\n\n控制性常微分方程：\n$$\n\\frac{dC_s}{dt} = L_C + m\\,C_p - k_d\\,C_s,\n\\quad\n\\frac{dN_s}{dt} = L_N + m\\,N_p - k_d\\,N_s,\n$$\n$$\n\\frac{dN_m}{dt} = k_d\\,N_s - U_N(N_m) - \\ell\\,N_m + D_N,\n\\quad\n\\frac{dC_p}{dt} = y_p\\,U_N(N_m) - m\\,C_p,\n\\quad\n\\frac{dN_p}{dt} = U_N(N_m) - m\\,N_p.\n$$\n\n残差的质量核算：\n- 追踪的总碳量为 $C_{\\text{tot}}(t) = C_s(t) + C_p(t)$。\n- 追踪的总氮量为 $N_{\\text{tot}}(t) = N_s(t) + N_m(t) + N_p(t)$。\n- 外部碳源 $S^{C}_{\\text{in}}(t) = L_C + y_p\\,U_N(N_m(t))$。\n- 外部碳汇 $S^{C}_{\\text{out}}(t) = k_d\\,C_s(t)$。\n- 外部氮源 $S^{N}_{\\text{in}}(t) = L_N + D_N$。\n- 外部氮汇 $S^{N}_{\\text{out}}(t) = \\ell\\,N_m(t)$。\n\n您的任务：\n- 对于下方的每个测试用例，在区间 $[0,T]$ 上对常微分方程进行积分，并使用上述积分定义以及指定的外部源汇速率，计算碳和氮的质量平衡残差。对源汇项的时间积分使用一致的数值积分方法。为每个测试用例返回一个非负浮点数，该浮点数等于碳残差和氮残差的绝对值中的最大值：\n$$\nr = \\max\\left(\\left|\\mathcal{R}_C\\right|,\\left|\\mathcal{R}_N\\right|\\right).\n$$\n- 将每个输出 $r$ 表示为以千克/平方米为单位的浮点数。\n\n数值细节和要求：\n- 所有物理单位中，质量为千克/平方米，时间为天。\n- 本问题不使用角度。\n- 程序必须对常微分方程进行数值求解。您可以选择任何适当的稳定方法，但请确保使用严格的容差，以确保残差仅反映数值误差。\n- 对常微分方程求解和外部源汇项的数值积分使用相同的时间离散点，以避免混叠误差。\n- 最终的程序输出必须是单行，包含一个Python风格的列表，其中每个测试用例对应一个浮点数，按所列顺序排列，输出文本中不含单位。这些浮点数代表千克/平方米。\n\n测试套件：\n- 案例 A (一般情况)：\n  - $T = 1.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$, $N_s(0) = 0.5$, $N_m(0) = 0.1$, $C_p(0) = 2.0$, $N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$, $V_{\\max} = 0.2$, $K = 0.05$, $m = 0.01$, $\\ell = 0.05$, $y_p = 25.0$, $L_C = 0.05$, $L_N = 0.0025$, $D_N = 0.0$。\n- 案例 B (无矿化)：\n  - $T = 1.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$, $N_s(0) = 0.5$, $N_m(0) = 0.1$, $C_p(0) = 2.0$, $N_p(0) = 0.08$。\n  - 参数：$k_d = 0.0$, $V_{\\max} = 0.2$, $K = 0.05$, $m = 0.01$, $\\ell = 0.05$, $y_p = 25.0$, $L_C = 0.05$, $L_N = 0.0025$, $D_N = 0.0$。\n- 案例 C (无吸收)：\n  - $T = 2.0$ 天。\n  - 初始条件：$C_s(0) = 10.0$, $N_s(0) = 0.5$, $N_m(0) = 0.1$, $C_p(0) = 2.0$, $N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$, $V_{\\max} = 0.0$, $K = 0.05$, $m = 0.01$, $\\ell = 0.05$, $y_p = 25.0$, $L_C = 0.05$, $L_N = 0.0025$, $D_N = 0.0$。\n- 案例 D (强淋溶伴随沉降)：\n  - $T = 0.5$ 天。\n  - 初始条件：$C_s(0) = 10.0$, $N_s(0) = 0.5$, $N_m(0) = 0.1$, $C_p(0) = 2.0$, $N_p(0) = 0.08$。\n  - 参数：$k_d = 0.02$, $V_{\\max} = 0.2$, $K = 0.05$, $m = 0.01$, $\\ell = 1.0$, $y_p = 25.0$, $L_C = 0.05$, $L_N = 0.0025$, $D_N = 0.01$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为[案例 A, 案例 B, 案例 C, 案例 D]。例如：'[x_A,x_B,x_C,x_D]'。\n- 每个条目必须是一个浮点数，代表该案例下以千克/平方米为单位的最大绝对质量平衡残差。",
            "solution": "用户提供了一个定义明确的计算生物地球化学问题，要求验证一个耦合常微分方程（ODE）系统的质量守恒。该问题在科学上是合理的，数学上是一致的，并且在计算上是可行的。所有必需的数据和定义都已提供。因此，该问题被视为有效，并将构建一个解决方案。\n\n问题的核心是计算在指定时间间隔 $[0, T]$ 内碳（$C$）和氮（$N$）的质量平衡残差。对于一个总追踪质量为 $M(t)$ 的元素，其残差由以下公式给出：\n$$\n\\mathcal{R} = \\left(M(T) - M(0)\\right) - \\int_{0}^{T} \\left(S_{\\text{in}}(t) - S_{\\text{out}}(t)\\right)\\, dt\n$$\n从解析上讲，由于质量守恒原理（这反映在控制性常微分方程的结构中），这个残差为零。然而，在数值上，由于常微分方程积分和通量项求积中的近似误差，会产生一个小的非零残差。任务就是计算这个数值残差。\n\n解决方案将按以下步骤实现：\n1.  **定义常微分方程组**：将创建一个函数来表示状态变量（土壤有机碳 $C_s$、土壤有机氮 $N_s$、矿物氮 $N_m$、植物碳 $C_p$ 和植物氮 $N_p$）的五个耦合常微分方程组。设状态向量为 $\\mathbf{y}(t) = [C_s(t), N_s(t), N_m(t), C_p(t), N_p(t)]^T$。该函数将计算时间导数 $\\frac{d\\mathbf{y}}{dt} = f(t, \\mathbf{y}, \\mathbf{p})$，其中 $\\mathbf{p}$ 是模型参数的向量。\n\n2.  **常微分方程的数值积分**：将使用高精度求解器对常微分方程组进行数值求解。`scipy.integrate.solve_ivp` 函数非常适合此目的。我们将采用一个变步长求解器（如默认的 `RK45`，一种 Dormand-Prince 方法），并设置非常严格的相对和绝对误差容差（例如 $10^{-13}$），以最小化常微分方程求解器带来的误差。问题要求通量的求积使用与常微分方程求解相同的时间步长。因此，将指示 `solve_ivp` 在区间 $[0, T]$ 上的一个精细、均匀的时间点网格 $t_i$ 上输出解。将使用一个每天至少有 $10000$ 个点的高密度网格，以确保后续通量数值积分的准确性。\n\n3.  **质量变化的计算**：追踪的总碳质量为 $C_{\\text{tot}}(t) = C_s(t) + C_p(t)$，总氮质量为 $N_{\\text{tot}}(t) = N_s(t) + N_m(t) + N_p(t)$。\n    - 初始质量 $C_{\\text{tot}}(0)$ 和 $N_{\\text{tot}}(0)$ 直接根据给定的初始条件计算。\n    - 最终质量 $C_{\\text{tot}}(T)$ 和 $N_{\\text{tot}}(T)$ 从常微分方程在最终时间步 $T$ 的数值解中获取。\n    - 然后，每个元素的总质量变化为 $\\Delta M = M(T) - M(0)$。\n\n4.  **通量的数值积分**：外部源和汇项是状态变量的函数，这些状态变量在每个时间点 $t_i$ 的值已从常微分方程的解中得知。\n    - 碳的净外部通量为 $S^C_{\\text{net}}(t) = S^C_{\\text{in}}(t) - S^C_{\\text{out}}(t) = (L_C + y_p\\,U_N(N_m(t))) - k_d\\,C_s(t)$。\n    - 氮的净外部通量为 $S^N_{\\text{net}}(t) = S^N_{\\text{in}}(t) - S^N_{\\text{out}}(t) = (L_N + D_N) - \\ell\\,N_m(t)$。\n    - 我们将在每个时间点 $t_i$ 计算这些净通量表达式，以生成通量值数组。\n    - 这些通量的时间积分 $\\int_0^T S_{\\text{net}}(t) dt$ 将使用梯形法则进行数值计算，如 `numpy.trapz` 中所实现的。鉴于数据点间距精细，此方法是合适的。\n\n5.  **残差计算**：在计算出质量变化（$\\Delta M$）和积分后的净通量（$\\int S_{\\text{net}} dt$）后，通过求两者之差即可得到碳（$\\mathcal{R}_C$）和氮（$\\mathcal{R}_N$）的残差。\n\n6.  **最终结果**：对于每个测试用例，最终报告的值是两个残差绝对值中的最大值：$r = \\max(|\\mathcal{R}_C|, |\\mathcal{R}_N|)$。此过程将对问题陈述中提供的所有四个测试用例重复进行。结果将被汇总到一个列表中，并以指定格式打印。最终结果的单位将是千克/平方米（kg/m²），与状态变量的单位一致。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the biogeochemistry mass-balance problem for all test cases.\n    \"\"\"\n\n    def model_odes(t, y, params):\n        \"\"\"\n        Defines the system of ordinary differential equations for the model.\n        \n        Args:\n            t (float): Current time (not used in this autonomous system, but required by solver).\n            y (np.ndarray): Array of state variables [Cs, Ns, Nm, Cp, Np].\n            params (dict): Dictionary of model parameters.\n        \n        Returns:\n            np.ndarray: Array of the derivatives of the state variables.\n        \"\"\"\n        Cs, Ns, Nm, Cp, Np = y\n        \n        # Unpack parameters\n        kd = params['kd']\n        Vmax = params['Vmax']\n        K = params['K']\n        m = params['m']\n        l_rate = params['l']\n        yp = params['yp']\n        LC = params['LC']\n        LN = params['LN']\n        DN = params['DN']\n\n        # Ensure non-negativity of state variables for physical realism\n        Cs = max(0, Cs)\n        Ns = max(0, Ns)\n        Nm = max(0, Nm)\n        Cp = max(0, Cp)\n        Np = max(0, Np)\n\n        # Process rates\n        U_N = Vmax * Nm / (K + Nm)\n        \n        # Derivatives\n        dCs_dt = LC + m * Cp - kd * Cs\n        dNs_dt = LN + m * Np - kd * Ns\n        dNm_dt = kd * Ns - U_N - l_rate * Nm + DN\n        dCp_dt = yp * U_N - m * Cp\n        dNp_dt = U_N - m * Np\n        \n        return np.array([dCs_dt, dNs_dt, dNm_dt, dCp_dt, dNp_dt])\n\n    def calculate_residual(case):\n        \"\"\"\n        Calculates the maximum absolute mass-balance residual for a single test case.\n        \n        Args:\n            case (dict): A dictionary containing all parameters and initial conditions for the case.\n            \n        Returns:\n            float: The maximum absolute residual between carbon and nitrogen.\n        \"\"\"\n        y0 = case['initial_conditions']\n        params = case['parameters']\n        T = case['T']\n\n        # Set up a fine time grid for integration and quadrature\n        # Use a high number of points to ensure accurate quadrature\n        num_points = int(20000 * T) + 2\n        t_eval = np.linspace(0, T, num_points)\n\n        # Solve the ODE system with tight tolerances\n        sol = solve_ivp(\n            model_odes, \n            [0, T], \n            y0, \n            args=(params,), \n            t_eval=t_eval, \n            rtol=1e-13, \n            atol=1e-13,\n            method='RK45'\n        )\n        \n        if not sol.success:\n            raise RuntimeError(f\"ODE solver failed for case.\")\n\n        # Extract solution trajectories\n        solution_y = sol.y\n        solution_t = sol.t\n        Cs_t, Ns_t, Nm_t, Cp_t, Np_t = solution_y\n\n        # 1. Calculate change in total mass from initial to final state\n        # Initial mass\n        C_tot_0 = y0[0] + y0[3] # Cs(0) + Cp(0)\n        N_tot_0 = y0[1] + y0[2] + y0[4] # Ns(0) + Nm(0) + Np(0)\n        \n        # Final mass\n        C_tot_T = solution_y[0, -1] + solution_y[3, -1] # Cs(T) + Cp(T)\n        N_tot_T = solution_y[1, -1] + solution_y[2, -1] + solution_y[4, -1] # Ns(T) + Nm(T) + Np(T)\n\n        delta_C_tot = C_tot_T - C_tot_0\n        delta_N_tot = N_tot_T - N_tot_0\n\n        # 2. Integrate net external fluxes over the time interval\n        # Unpack parameters needed for flux calculation\n        kd, Vmax, K, l_rate, yp, LC, LN, DN = [params[k] for k in \n            ('kd', 'Vmax', 'K', 'l', 'yp', 'LC', 'LN', 'DN')]\n\n        # Calculate flux rates at each time step\n        U_N_t = Vmax * Nm_t / (K + Nm_t)\n        \n        # Net Carbon Flux: S_in - S_out = (L_C + y_p*U_N) - (k_d*C_s)\n        net_flux_C_t = (LC + yp * U_N_t) - (kd * Cs_t)\n        \n        # Net Nitrogen Flux: S_in - S_out = (L_N + D_N) - (l*N_m)\n        net_flux_N_t = (LN + DN) - (l_rate * Nm_t)\n\n        # Integrate fluxes using the trapezoidal rule\n        integral_net_flux_C = np.trapz(net_flux_C_t, x=solution_t)\n        integral_net_flux_N = np.trapz(net_flux_N_t, x=solution_t)\n        \n        # 3. Calculate residuals\n        residual_C = delta_C_tot - integral_net_flux_C\n        residual_N = delta_N_tot - integral_net_flux_N\n        \n        # 4. Return the maximum absolute residual\n        return max(abs(residual_C), abs(residual_N))\n\n    # Test suite definition\n    test_cases = [\n        { # Case A\n            'T': 1.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case B\n            'T': 1.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.0, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case C\n            'T': 2.0,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.0, 'K': 0.05, 'm': 0.01, 'l': 0.05, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.0}\n        },\n        { # Case D\n            'T': 0.5,\n            'initial_conditions': np.array([10.0, 0.5, 0.1, 2.0, 0.08]),\n            'parameters': {'kd': 0.02, 'Vmax': 0.2, 'K': 0.05, 'm': 0.01, 'l': 1.0, 'yp': 25.0, 'LC': 0.05, 'LN': 0.0025, 'DN': 0.01}\n        }\n    ]\n\n    results = []\n    for case_data in test_cases:\n        result = calculate_residual(case_data)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在构建和验证模型之后，一个更深层次的问题是：模型预测的不确定性主要来源于哪些过程或参数？基于方差的敏感性分析（如Sobol方法）是定量回答这个问题的强大工具。在此练习中，您将为一个简化的生态系统生产力模型推导其一阶Sobol敏感性指数。这个过程不仅能加深您对模型非线性相互作用的理解，还能让您掌握如何评估和排序不同不确定性来源对模型整体行为的贡献，这是模型分析和改进的关键一步。",
            "id": "4099185",
            "problem": "考虑一个适用于数值天气预报和气候模拟的、在固定气候强迫下陆地生态系统碳平衡的简单且有科学依据的表示方法。假设生态系统净产量 (NEP) 由碳质量平衡关系定义，即生态系统净产量等于净初级生产力减去异养呼吸，其中气候保持恒定，因此异养呼吸被视为一个恒定基线。具体而言，设生态系统净产量建模为\n$$\nf(D,F,L) \\equiv \\alpha\\,L\\,(D+F) - R,\n$$\n其中 $D$ 是氮沉降，$F$ 是生物固氮，$L$ 是一个综合叶氮参数，用于衡量净初级生产力的氮限制程度，$\\alpha$ 是一个由化学计量和固定气候强迫决定的固定碳氮转换因子，而 $R$ 是固定气候强迫下的基线异养呼吸。变量 $D$、$F$ 和 $L$ 是独立的随机输入，反映了固定气候强迫下氮循环驱动因子和叶氮性状的不确定性。设 $D$、$F$ 和 $L$ 的概率分布具有有限的一阶矩和二阶矩，其均值和方差表示为\n$$\nm_D=\\mathbb{E}[D],\\quad v_D=\\operatorname{Var}(D),\\quad m_F=\\mathbb{E}[F],\\quad v_F=\\operatorname{Var}(F),\\quad m_L=\\mathbb{E}[L],\\quad v_L=\\operatorname{Var}(L),\n$$\n并假设 $\\alpha$ 和 $R$ 是确定性常数。\n\n使用基于方差的 Sobol 敏感性分析框架，推导生态系统净产量 $f(D,F,L)$ 相对于三个独立输入 $D$、$F$ 和 $L$ 的一阶 Sobol 敏感性指数。对于输入 $X$，其一阶 Sobol 指数 $S_X$ 定义为\n$$\nS_X=\\frac{\\operatorname{Var}\\big(\\mathbb{E}[f\\,|\\,X]\\big)}{\\operatorname{Var}(f)}.\n$$\n将三个一阶指数 $S_D$、$S_F$ 和 $S_L$ 表示为用 $\\alpha$、$m_D$、$v_D$、$m_F$、$v_F$、$m_L$ 和 $v_L$ 表示的闭式解析表达式。将您的最终结果表述为三个无量纲数。无需四舍五入。以单行矩阵的形式，按 $S_D$、$S_F$、$S_L$ 的顺序提供您的最终答案。",
            "solution": "问题陈述已经过验证，被认为是合理的。它具有科学依据，提法恰当，客观，并包含了获得唯一解所需的所有必要信息。因此，我们可以进行推导。\n\n目标是为生态系统净产量模型 $f(D,F,L) = \\alpha L (D+F) - R$ 推导一阶 Sobol 敏感性指数 $S_D$、$S_F$ 和 $S_L$。输入 $D$、$F$ 和 $L$ 是独立随机变量。\n\n输入 $X$ 的一阶 Sobol 指数定义为：\n$$\nS_X = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid X]\\big)}{\\operatorname{Var}(f)}\n$$\n计算需要两个主要部分：作为分母的输出总方差 $\\operatorname{Var}(f)$，以及构成每个输入 $X \\in \\{D, F, L\\}$ 分子的部分方差 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid X]\\big)$。\n\n首先，我们计算总方差 $\\operatorname{Var}(f)$。\n$$\n\\operatorname{Var}(f) = \\operatorname{Var}\\big(\\alpha L(D+F) - R\\big)\n$$\n由于 $R$ 是一个确定性常数，其方差为 $0$，对 $f$ 的方差没有贡献。使用性质 $\\operatorname{Var}(aX+b) = a^2\\operatorname{Var}(X)$，我们有：\n$$\n\\operatorname{Var}(f) = \\operatorname{Var}\\big(\\alpha L(D+F)\\big) = \\alpha^2 \\operatorname{Var}\\big(L(D+F)\\big)\n$$\n要计算 $\\operatorname{Var}\\big(L(D+F)\\big)$，我们可以使用全方差公式或定义 $\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2$。一个更直接的计算两个独立随机变量（比如 $X_1$ 和 $X_2$）乘积方差的公式是 $\\operatorname{Var}(X_1 X_2) = \\operatorname{Var}(X_1)\\operatorname{Var}(X_2) + \\operatorname{Var}(X_1)(\\mathbb{E}[X_2])^2 + \\operatorname{Var}(X_2)(\\mathbb{E}[X_1])^2$。\n我们定义两个中间随机变量：$X_1 = L$ 和 $X_2 = D+F$。由于 $L$ 与 $D$ 和 $F$ 都独立，因此 $X_1$ 和 $X_2$ 是独立的。\n$X_1$ 和 $X_2$ 所需的矩是：\n$$\n\\mathbb{E}[X_1] = \\mathbb{E}[L] = m_L\n$$\n$$\n\\operatorname{Var}(X_1) = \\operatorname{Var}(L) = v_L\n$$\n$$\n\\mathbb{E}[X_2] = \\mathbb{E}[D+F] = \\mathbb{E}[D] + \\mathbb{E}[F] = m_D + m_F\n$$\n由于 $D$ 和 $F$ 是独立的，它们的和的方差等于它们方差的和：\n$$\n\\operatorname{Var}(X_2) = \\operatorname{Var}(D+F) = \\operatorname{Var}(D) + \\operatorname{Var}(F) = v_D + v_F\n$$\n现在，将这些代入乘积 $X_1 X_2 = L(D+F)$ 的方差公式中：\n$$\n\\operatorname{Var}\\big(L(D+F)\\big) = v_L (v_D+v_F) + v_L (m_D+m_F)^2 + (v_D+v_F) m_L^2\n$$\n通过提出公因子 $v_L$ 和 $m_L^2$ 来重新整理各项：\n$$\n\\operatorname{Var}\\big(L(D+F)\\big) = v_L \\big((v_D+v_F) + (m_D+m_F)^2\\big) + m_L^2 (v_D+v_F)\n$$\n因此，$f$ 的总方差是：\n$$\n\\operatorname{Var}(f) = \\alpha^2 \\Big[ v_L \\big(v_D+v_F + (m_D+m_F)^2\\big) + m_L^2 (v_D+v_F) \\Big]\n$$\n该表达式构成了所有三个 Sobol 指数的分母。\n\n接下来，我们计算分子，从 $S_D$ 开始。这需要计算 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big)$。\n首先，求条件期望 $\\mathbb{E}[f \\mid D]$：\n$$\n\\mathbb{E}[f \\mid D] = \\mathbb{E}[\\alpha L(D+F) - R \\mid D]\n$$\n利用期望的线性性质，并在条件期望中将作为 $D$ 的函数的项视为常数：\n$$\n\\mathbb{E}[f \\mid D] = \\alpha \\mathbb{E}[L(D+F) \\mid D] - \\mathbb{E}[R \\mid D]\n$$\n由于 $L$ 和 $F$ 与 $D$ 独立，$\\mathbb{E}[L \\mid D] = \\mathbb{E}[L] = m_L$ 且 $\\mathbb{E}[F \\mid D] = \\mathbb{E}[F] = m_F$。常数 $R$ 也与 $D$ 独立。\n$$\n\\mathbb{E}[f \\mid D] = \\alpha \\big( \\mathbb{E}[LD \\mid D] + \\mathbb{E}[LF \\mid D] \\big) - R = \\alpha \\big( D \\mathbb{E}[L \\mid D] + \\mathbb{E}[L \\mid D]\\mathbb{E}[F \\mid D] \\big) - R\n$$\n$$\n\\mathbb{E}[f \\mid D] = \\alpha (D m_L + m_L m_F) - R = \\alpha m_L (D+m_F) - R\n$$\n现在，我们对该表达式关于 $D$ 的随机性取方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big) = \\operatorname{Var}\\big(\\alpha m_L (D+m_F) - R\\big)\n$$\n项 $\\alpha m_L m_F$ 和 $R$ 是常数，因此它们不影响方差。\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big) = \\operatorname{Var}(\\alpha m_L D) = (\\alpha m_L)^2 \\operatorname{Var}(D) = \\alpha^2 m_L^2 v_D\n$$\n\n现在，我们计算 $S_F$ 的分子，即 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big)$。其过程与 $D$ 的情况对称。\n$$\n\\mathbb{E}[f \\mid F] = \\mathbb{E}[\\alpha L(D+F) - R \\mid F] = \\alpha \\mathbb{E}[L(D+F) \\mid F] - R\n$$\n$$\n\\mathbb{E}[f \\mid F] = \\alpha \\big( \\mathbb{E}[LD \\mid F] + \\mathbb{E}[LF \\mid F] \\big) - R = \\alpha \\big( \\mathbb{E}[L]\\mathbb{E}[D] + F \\mathbb{E}[L] \\big) - R\n$$\n$$\n\\mathbb{E}[f \\mid F] = \\alpha(m_L m_D + F m_L) - R = \\alpha m_L (m_D+F) - R\n$$\n对该表达式关于 $F$ 的随机性取方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big) = \\operatorname{Var}\\big(\\alpha m_L (m_D+F) - R\\big) = \\operatorname{Var}(\\alpha m_L F) = (\\alpha m_L)^2 \\operatorname{Var}(F) = \\alpha^2 m_L^2 v_F\n$$\n\n最后，我们计算 $S_L$ 的分子，即 $\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big)$。\n$$\n\\mathbb{E}[f \\mid L] = \\mathbb{E}[\\alpha L(D+F) - R \\mid L]\n$$\n在期望中将 $L$ 视为常数：\n$$\n\\mathbb{E}[f \\mid L] = \\alpha L \\mathbb{E}[D+F \\mid L] - R\n$$\n由于 $D$ 和 $F$ 与 $L$ 独立，$\\mathbb{E}[D+F \\mid L] = \\mathbb{E}[D+F] = m_D+m_F$。\n$$\n\\mathbb{E}[f \\mid L] = \\alpha L (m_D+m_F) - R\n$$\n对该表达式关于 $L$ 的随机性取方差：\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big) = \\operatorname{Var}\\big(\\alpha (m_D+m_F) L - R\\big) = \\operatorname{Var}\\big(\\alpha (m_D+m_F) L\\big)\n$$\n$$\n\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big) = (\\alpha (m_D+m_F))^2 \\operatorname{Var}(L) = \\alpha^2 (m_D+m_F)^2 v_L\n$$\n\n现在我们通过构建比率来组合 Sobol 指数。设 $V_{tot} = v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)$。\n$$\nS_D = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid D]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 m_L^2 v_D}{\\alpha^2 V_{tot}} = \\frac{m_L^2 v_D}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n$$\nS_F = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid F]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 m_L^2 v_F}{\\alpha^2 V_{tot}} = \\frac{m_L^2 v_F}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n$$\nS_L = \\frac{\\operatorname{Var}\\big(\\mathbb{E}[f \\mid L]\\big)}{\\operatorname{Var}(f)} = \\frac{\\alpha^2 (m_D+m_F)^2 v_L}{\\alpha^2 V_{tot}} = \\frac{(m_D+m_F)^2 v_L}{v_L (v_D+v_F + (m_D+m_F)^2) + m_L^2 (v_D+v_F)}\n$$\n这些是三个一阶 Sobol 指数的最终闭式解析表达式。正如预期，它们是无量纲量。问题陈述中提到的“无量纲数”被解释为要求这些符号表达式，因为没有提供参数的数值。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{m_L^2 v_D}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)}  \\frac{m_L^2 v_F}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)}  \\frac{(m_D + m_F)^2 v_L}{v_L(v_D + v_F + (m_D + m_F)^2) + m_L^2(v_D + v_F)} \\end{pmatrix}}\n$$"
        }
    ]
}