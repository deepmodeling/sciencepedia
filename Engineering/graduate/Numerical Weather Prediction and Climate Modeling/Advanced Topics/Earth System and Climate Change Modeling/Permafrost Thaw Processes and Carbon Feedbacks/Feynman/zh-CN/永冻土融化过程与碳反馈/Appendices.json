{
    "hands_on_practices": [
        {
            "introduction": "要量化永久冻土的融化，一个关键指标是活动层厚度（Active Layer Thickness, ALT）。这项实践提供了一个动手操作的机会，让您可以实现气候模型中从模拟的土壤温度剖面诊断ALT的标准算法。通过这项练习，您将锻炼分析模型输出以及将物理定义应用于离散数据的核心技能 。",
            "id": "4074459",
            "problem": "考虑一个在数值天气预报和气候模拟框架下的一维土壤柱。该土柱的热力学状态由温度场 $T(z,t)$ 描述，其中 $z$ 是从地表开始正向朝下测量的深度，而 $t$ 是时间。活动层厚度 (Active Layer Thickness, ALT) 是季节性融化土壤的最大深度，对于永久冻土，其定义为暖季期间融化锋面所能达到的最深位置。假设遵循以下科学基础：连续介质中的能量守恒以及在融化温度发生的相变，要求融化锋面的位置在融化和冻结土壤之间的界面上满足 $T(z,t) = T_{\\mathrm{m}}$；活动层下方的多年冻土在暖季期间保持在融化温度以下。在具有有限深度节点的离散化土壤柱中，融化锋面是根据 $T(z,t)$ 的模型输出推断出来的，而无需直接追踪潜热。\n\n本问题中活动层厚度 (ALT) 的定义：对于规定索引集 $\\mathcal{W}$ 中的每个暖季时间 $t$，将时间 $t$ 的连续融化深度定义为最大深度 $z^{\\ast}(t)$，使得对于所有深度 $z' \\in [0,z^{\\ast}(t)]$，都有 $T(z',t) \\ge T_{\\mathrm{m}}$，并附加要求在该时间 $T(0,t) \\ge T_{\\mathrm{m}}$。那么，季节性活动层厚度为 $\\mathrm{ALT} = \\max_{t \\in \\mathcal{W}} z^{\\ast}(t)$。如果在时间 $t$，离散网格中存在一个深度区间 $[z_i, z_{i+1}]$，其中 $T(z_i,t) \\ge T_{\\mathrm{m}}$ 且 $T(z_{i+1},t)  T_{\\mathrm{m}}$，则根据局部温度剖面，通过在 $z$ 方向上的一致单调插值来推断该区间内的融化锋面。如果对于给定的 $t$，有 $T(0,t)  T_{\\mathrm{m}}$，那么根据连续性要求，$z^{\\ast}(t) = 0$。如果在时间 $t$，网格中的所有深度都满足 $T(z,t) \\ge T_{\\mathrm{m}}$，则 $z^{\\ast}(t)$ 等于最大网格深度。\n\n您的任务：实现一个程序，使用上述连续融化深度准则以及当融化锋面位于深度节点之间时采用适当的插值方法，为每个提供的测试用例计算 $\\mathrm{ALT}$。所有 $\\mathrm{ALT}$ 值以米为单位表示，并四舍五入到四位小数。本问题不涉及角度。温度单位是开尔文，深度单位是米。时间以离散索引给出。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[$\\mathrm{ALT}_1,\\mathrm{ALT}_2,\\dots$]”），其中每个条目是一个浮点数，代表相应测试用例的 $\\mathrm{ALT}$ 值（单位为米），并四舍五入到四位小数。\n\n测试套件：\n\n测试用例 $1$ （一般暖季融化过程；“理想路径”）：\n- 深度网格 $z = [0.0, 0.25, 0.5, 0.75, 1.0]\\,\\mathrm{m}$。\n- 暖季时间索引 $\\mathcal{W} = \\{0,1,2,3,4,5\\}$。\n- 融化温度 $T_{\\mathrm{m}} = 273.15\\,\\mathrm{K}$。\n- 每个时间的温度 $T(z,t)$：\n  - $t=0$: $[274.0, 272.5, 271.5, 270.5, 269.5]\\,\\mathrm{K}$。\n  - $t=1$: $[275.0, 274.0, 272.8, 271.0, 270.0]\\,\\mathrm{K}$。\n  - $t=2$: $[276.0, 275.0, 274.0, 272.5, 271.0]\\,\\mathrm{K}$。\n  - $t=3$: $[277.0, 276.0, 275.0, 273.5, 272.0]\\,\\mathrm{K}$。\n  - $t=4$: $[276.5, 275.5, 274.5, 273.2, 272.2]\\,\\mathrm{K}$。\n  - $t=5$: $[275.0, 274.0, 273.7, 273.0, 272.5]\\,\\mathrm{K}$。\n\n测试用例 $2$ （无地表融化；与地表不连续的深层增温）：\n- 深度网格 $z = [0.0, 0.5, 1.0]\\,\\mathrm{m}$。\n- 暖季时间索引 $\\mathcal{W} = \\{0,1,2\\}$。\n- 融化温度 $T_{\\mathrm{m}} = 273.15\\,\\mathrm{K}$。\n- 温度：\n  - $t=0$: $[272.0, 274.0, 274.5]\\,\\mathrm{K}$。\n  - $t=1$: $[272.5, 273.5, 274.5]\\,\\mathrm{K}$。\n  - $t=2$: $[272.8, 274.2, 274.8]\\,\\mathrm{K}$。\n\n测试用例 $3$ （阈值相等及某个时刻的全柱融化）：\n- 深度网格 $z = [0.0, 0.5, 1.0]\\,\\mathrm{m}$。\n- 暖季时间索引 $\\mathcal{W} = \\{0,1,2\\}$。\n- 融化温度 $T_{\\mathrm{m}} = 273.15\\,\\mathrm{K}$。\n- 温度：\n  - $t=0$: $[273.15, 273.15, 272.0]\\,\\mathrm{K}$。\n  - $t=1$: $[273.15, 273.20, 273.15]\\,\\mathrm{K}$。\n  - $t=2$: $[273.10, 273.18, 273.16]\\,\\mathrm{K}$。\n\n测试用例 $4$ （中层冷障阻碍了与更深融化层的连续性）：\n- 深度网格 $z = [0.0, 0.4, 0.8, 1.2]\\,\\mathrm{m}$。\n- 暖季时间索引 $\\mathcal{W} = \\{0,1,2,3\\}$。\n- 融化温度 $T_{\\mathrm{m}} = 273.15\\,\\mathrm{K}$。\n- 温度：\n  - $t=0$: $[274.0, 273.8, 272.7, 274.0]\\,\\mathrm{K}$。\n  - $t=1$: $[275.0, 274.2, 272.9, 273.5]\\,\\mathrm{K}$。\n  - $t=2$: $[274.5, 273.5, 273.0, 272.8]\\,\\mathrm{K}$。\n  - $t=3$: $[273.8, 273.4, 272.6, 272.5]\\,\\mathrm{K}$。\n\n测试用例 $5$ （冰点降低；较低的有效阈值）：\n- 深度网格 $z = [0.0, 0.3, 0.6, 0.9, 1.2]\\,\\mathrm{m}$。\n- 暖季时间索引 $\\mathcal{W} = \\{0,1,2,3\\}$。\n- 融化温度 $T_{\\mathrm{m}} = 272.5\\,\\mathrm{K}$。\n- 温度：\n  - $t=0$: $[273.0, 272.7, 272.3, 271.9, 271.5]\\,\\mathrm{K}$。\n  - $t=1$: $[273.2, 272.9, 272.6, 272.2, 271.8]\\,\\mathrm{K}$。\n  - $t=2$: $[273.1, 273.0, 272.8, 272.4, 272.0]\\,\\mathrm{K}$。\n  - $t=3$: $[272.9, 272.8, 272.7, 272.5, 272.3]\\,\\mathrm{K}$。\n\n实现要求：\n- 对于每个测试用例，在指定的暖季索引集 $\\mathcal{W}$ 上评估 $z^{\\ast}(t)$，并将 $\\mathrm{ALT}$ 报告为 $t \\in \\mathcal{W}$ 上 $z^{\\ast}(t)$ 的最大值。\n- 当融化锋面严格位于温度跨越 $T_{\\mathrm{m}}$ 的两个连续深度节点之间时，使用深度方向的单调插值。\n- 按测试用例 $1$ 到 $5$ 的顺序，以单行浮点数列表的形式返回结果，单位为米，四舍五入到四位小数。",
            "solution": "该问题已经过验证，被认为是科学上合理的、适定的、客观且自洽的。所提供的定义和数据是充分且一致的，足以推导出唯一的、有意义的解。其物理背景基于气候模拟中使用的热力学和永久冻土地球物理学的标准原理。该任务是将这些原理直接应用于离散数据。\n\n目标是为五个不同的测试用例计算季节性活动层厚度，记为 $\\mathrm{ALT}$。$\\mathrm{ALT}$ 定义为在指定的暖季时间索引集 $\\mathcal{W}$ 上出现的最大连续融化深度 $z^{\\ast}(t)$。\n$$\n\\mathrm{ALT} = \\max_{t \\in \\mathcal{W}} z^{\\ast}(t)\n$$\n问题的核心是，在特定时间 $t$ 为给定的一维温度剖面 $T(z,t)$ 确定连续融化深度 $z^{\\ast}(t)$。温度剖面是在离散的深度节点 $z_i$（其中 $i=0, 1, \\dots, N$）上提供的。深度 $z$ 是从地表开始正向朝下测量的，因此 $z_0=0$。\n\n计算单个时间步的 $z^{\\ast}(t)$ 的算法如下：\n\n1.  **检查地表条件**：定义要求融化层与地表连续。因此，我们首先检查地表温度 $T(z_0, t) = T(0, t)$。如果 $T(0, t)  T_{\\mathrm{m}}$（其中 $T_{\\mathrm{m}}$ 是融化温度），则地表是冻结的。根据连续性要求，融化深度为零，而不管更深层的温度如何。因此，$z^{\\ast}(t) = 0$。\n\n2.  **遍历深度节点**：如果 $T(0, t) \\ge T_{\\mathrm{m}}$，我们继续寻找连续融化层的最大深度。我们从上到下遍历深度节点 $z_i$（其中 $i = 1, 2, \\dots, N$）。我们搜索温度降到融点以下的第一个深度索引 $i$，即 $T(z_i, t)  T_{\\mathrm{m}}$。\n\n3.  **确定融化深度**：\n    a. **节点间的融化锋面**：如果找到这样的索引 $i$，这表示土壤已融化（或处于融点）至深度 $z_{i-1}$，因为对于所有 $j  i$，都有 $T(z_j, t) \\ge T_{\\mathrm{m}}$。融化锋面（即 $T(z,t) = T_{\\mathrm{m}}$ 的位置）位于区间 $[z_{i-1}, z_i]$ 内。问题指定使用“一致的单调插值”来找到确切位置。线性插值是标准且合适的选择。给定两个点 $(z_{i-1}, T(z_{i-1}, t))$ 和 $(z_i, T(z_i, t))$，我们找到线性插值温度等于 $T_{\\mathrm{m}}$ 时的深度 $z^{\\ast}(t)$。连接这两点的直线方程为：\n    $$\n    \\frac{z - z_{i-1}}{z_i - z_{i-1}} = \\frac{T_{\\mathrm{m}} - T(z_{i-1}, t)}{T(z_i, t) - T(z_{i-1}, t)}\n    $$\n    求解 $z$（我们将其视为 $z^{\\ast}(t)$），可得：\n    $$\n    z^{\\ast}(t) = z_{i-1} + (z_i - z_{i-1}) \\frac{T_{\\mathrm{m}} - T(z_{i-1}, t)}{T(z_i, t) - T(z_{i-1}, t)}\n    $$\n    其中的一个特例是，如果 $T(z_{i-1}, t) = T_{\\mathrm{m}}$，此时公式正确地简化为 $z^{\\ast}(t) = z_{i-1}$。\n\n    b. **全柱融化**：如果循环完成而没有找到任何深度 $z_i$ 使得 $T(z_i, t)  T_{\\mathrm{m}}$，这意味着网格中所有节点的温度都满足 $T(z_i, t) \\ge T_{\\mathrm{m}}$。在这种情况下，整个模拟的土壤柱都已融化。因此，连续融化深度 $z^{\\ast}(t)$ 等于网格的最大深度 $z_N$。\n\n通过对 $\\mathcal{W}$ 中的每个时间 $t$ 应用此过程，我们得到一组季节性融化深度 $\\{z^{\\ast}(t)\\}$。给定测试用例的最终 $\\mathrm{ALT}$ 是该集合中的最大值。对所提供的五个测试用例中的每一个都重复此整个过程。每个用例的最终结果均四舍五入到四位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Active Layer Thickness (ALT) for a series of test cases based on 1D soil temperature profiles.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"z\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"Tm\": 273.15,\n            \"T_profiles\": [\n                [274.0, 272.5, 271.5, 270.5, 269.5],\n                [275.0, 274.0, 272.8, 271.0, 270.0],\n                [276.0, 275.0, 274.0, 272.5, 271.0],\n                [277.0, 276.0, 275.0, 273.5, 272.0],\n                [276.5, 275.5, 274.5, 273.2, 272.2],\n                [275.0, 274.0, 273.7, 273.0, 272.5],\n            ],\n        },\n        {\n            \"z\": [0.0, 0.5, 1.0],\n            \"Tm\": 273.15,\n            \"T_profiles\": [\n                [272.0, 274.0, 274.5],\n                [272.5, 273.5, 274.5],\n                [272.8, 274.2, 274.8],\n            ],\n        },\n        {\n            \"z\": [0.0, 0.5, 1.0],\n            \"Tm\": 273.15,\n            \"T_profiles\": [\n                [273.15, 273.15, 272.0],\n                [273.15, 273.20, 273.15],\n                [273.10, 273.18, 273.16],\n            ],\n        },\n        {\n            \"z\": [0.0, 0.4, 0.8, 1.2],\n            \"Tm\": 273.15,\n            \"T_profiles\": [\n                [274.0, 273.8, 272.7, 274.0],\n                [275.0, 274.2, 272.9, 273.5],\n                [274.5, 273.5, 273.0, 272.8],\n                [273.8, 273.4, 272.6, 272.5],\n            ],\n        },\n        {\n            \"z\": [0.0, 0.3, 0.6, 0.9, 1.2],\n            \"Tm\": 272.5,\n            \"T_profiles\": [\n                [273.0, 272.7, 272.3, 271.9, 271.5],\n                [273.2, 272.9, 272.6, 272.2, 271.8],\n                [273.1, 273.0, 272.8, 272.4, 272.0],\n                [272.9, 272.8, 272.7, 272.5, 272.3],\n            ],\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        depth_grid = np.array(case[\"z\"])\n        Tm = case[\"Tm\"]\n        T_profiles = case[\"T_profiles\"]\n        \n        max_thaw_depth_for_case = 0.0\n\n        for t_profile in T_profiles:\n            T = np.array(t_profile)\n            \n            # Check for surface thaw. If surface is frozen, contiguous thaw depth is 0.\n            if T[0]  Tm:\n                thaw_depth_t = 0.0\n            else:\n                # Find the first depth where temperature is below Tm\n                frozen_indices = np.where(T  Tm)[0]\n                \n                if len(frozen_indices) == 0:\n                    # Entire column is thawed or at melting point\n                    thaw_depth_t = depth_grid[-1]\n                else:\n                    # Thaw front is between nodes\n                    first_frozen_idx = frozen_indices[0]\n                    \n                    # This check is needed for the case where the first node T[0] is = Tm,\n                    # but the second node T[1] is already  Tm.\n                    if first_frozen_idx == 0:\n                        # This should not happen due to the T[0]  Tm check above, but as a safeguard.\n                        thaw_depth_t = 0.0\n                    else:\n                        prev_idx = first_frozen_idx - 1\n                        z_prev = depth_grid[prev_idx]\n                        T_prev = T[prev_idx]\n                        \n                        z_curr = depth_grid[first_frozen_idx]\n                        T_curr = T[first_frozen_idx]\n\n                        # Handle the case where T_prev == T_curr, to avoid division by zero.\n                        # If T_prev is = Tm and T_curr is  Tm, they cannot be equal.\n                        # However, if T_prev == Tm, the thaw front is exactly at z_prev.\n                        if T_prev == Tm:\n                             thaw_depth_t = z_prev\n                        # The case T_curr == Tm is not possible here as T_curr  Tm.\n                        else:\n                            # Linear interpolation to find the depth where T = Tm\n                            thaw_depth_t = z_prev + (z_curr - z_prev) * (Tm - T_prev) / (T_curr - T_prev)\n\n            if thaw_depth_t  max_thaw_depth_for_case:\n                max_thaw_depth_for_case = thaw_depth_t\n        \n        results.append(round(max_thaw_depth_for_case, 4))\n\n    # Format output as a single-line string\n    print(f\"[\" + \",\".join([f\"{r:.4f}\" for r in results]) + \"]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在诊断出融化之后，下一步是量化其对全球气候的影响。本练习将指导您使用一个简化的气候模型，将永久冻土的碳排放与全球平均温度变化联系起来。这个过程阐明了辐射强迫和气候系统脉冲响应等关键概念，这些是理解和建模碳-气候反馈的核心 。",
            "id": "4074432",
            "problem": "在一个数值气候模型框架内，考虑一个程式化的冻土融化碳释放与气候系统之间的耦合关系。假设大气二氧化碳浓度 $C(t)$ 在一个预设的综合人为加冻土排放路径下演变，使得\n$$C(t)=C_{0}\\exp(r t),$$\n其中 $t$ 以年为单位，$C_{0}$ 是工业化前的浓度，$r$ 是一个有效的浓度增长率，它整合了人为排放和冻土融化产生的净碳反馈。取 $C_{0}=280\\,\\text{ppm}$ 且 $r=r_{\\text{anth}}+r_{\\text{pf}}$，其中 $r_{\\text{anth}}=4.0\\times 10^{-3}\\,\\text{yr}^{-1}$，$r_{\\text{pf}}=1.0\\times 10^{-3}\\,\\text{yr}^{-1}$。\n\n使用广为接受的对数形式二氧化碳辐射强迫关系，其系数为 $\\alpha$，使得二氧化碳辐射强迫为\n$$\\Delta F_{\\text{CO}_{2}}(t)=\\alpha \\ln\\!\\big(C(t)/C_{0}\\big),$$\n其中 $\\alpha=5.35\\,\\text{W}\\,\\text{m}^{-2}$。\n\n使用具有两个时间尺度的气候系统线性脉冲响应函数（IRF）表示，将时变辐射强迫转换为全球平均地表气温响应。具体来说，假设温度IRF为\n$$H(t)=\\sum_{i=1}^{2}\\frac{\\beta_{i}}{\\tau_{i}}\\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right),\\quad t\\ge 0,$$\n其中对单位强迫的阶跃响应为 $\\Phi(t)=\\sum_{i=1}^{2}\\beta_{i}\\big(1-\\exp(-t/\\tau_{i})\\big)$，参数为 $\\beta_{1}=0.5\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$、$\\beta_{2}=0.3\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$、$\\tau_{1}=4\\,\\text{yr}$ 和 $\\tau_{2}=200\\,\\text{yr}$。全球平均温度变化由因果卷积给出\n$$\\Delta T(t)=\\int_{0}^{t}H(t-s)\\,\\Delta F_{\\text{CO}_{2}}(s)\\,\\mathrm{d}s.$$\n\n计算此路径和模型所蕴含的全球平均温度变化 $\\Delta T(100\\,\\text{yr})$。将您的答案四舍五入到四位有效数字。用开尔文（K）表示温度变化。",
            "solution": "首先验证该问题，以确保其具有科学依据、适定且客观。\n\n### 步骤1：提取已知条件\n已知信息如下：\n- 大气二氧化碳浓度：$C(t)=C_{0}\\exp(r t)$，其中 $t$ 以年为单位。\n- 工业化前浓度：$C_{0}=280\\,\\text{ppm}$。\n- 有效浓度增长率：$r=r_{\\text{anth}}+r_{\\text{pf}}$。\n- 人为增长率分量：$r_{\\text{anth}}=4.0\\times 10^{-3}\\,\\text{yr}^{-1}$。\n- 冻土增长率分量：$r_{\\text{pf}}=1.0\\times 10^{-3}\\,\\text{yr}^{-1}$。\n- 二氧化碳辐射强迫：$\\Delta F_{\\text{CO}_{2}}(t)=\\alpha \\ln\\!\\big(C(t)/C_{0}\\big)$。\n- 辐射强迫系数：$\\alpha=5.35\\,\\text{W}\\,\\text{m}^{-2}$。\n- 温度脉冲响应函数（IRF）：$H(t)=\\sum_{i=1}^{2}\\frac{\\beta_{i}}{\\tau_{i}}\\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right)$，对于 $t\\ge 0$。\n- IRF参数：\n  - $\\beta_{1}=0.5\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$，$\\tau_{1}=4\\,\\text{yr}$。\n  - $\\beta_{2}=0.3\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$，$\\tau_{2}=200\\,\\text{yr}$。\n- 全球平均温度变化：$\\Delta T(t)=\\int_{0}^{t}H(t-s)\\,\\Delta F_{\\text{CO}_{2}}(s)\\,\\mathrm{d}s$。\n- 目标是计算 $\\Delta T(100\\,\\text{yr})$ 并将结果四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是气候模型中的一个程式化但标准的练习。\n- **科学依据：**该模型使用了公认的概念：CO2浓度的指数增长（一种简化，但对建模有效）、对数辐射强迫，以及用于模拟温度变化的线性脉冲响应函数。这些是简化气候模型中的基石技术。参数值在此类模型的合理范围内。该问题正确地指出了一个关键的气候反馈回路（冻土融化）。\n- **适定性：**所有必需的函数、参数和初始条件均已提供。任务是计算一个特定量 $\\Delta T(100\\,\\text{yr})$，其唯一解可以从给定的卷积分中导出。\n- **客观性：**该问题使用精确的数学和物理术语陈述，没有歧义或主观论断。\n\n### 步骤3：结论与行动\n问题有效。我们开始求解。\n\n首先，我们确定总有效浓度增长率 $r$：\n$$r = r_{\\text{anth}} + r_{\\text{pf}} = 4.0\\times 10^{-3}\\,\\text{yr}^{-1} + 1.0\\times 10^{-3}\\,\\text{yr}^{-1} = 5.0\\times 10^{-3}\\,\\text{yr}^{-1}.$$\n接下来，我们推导辐射强迫 $\\Delta F_{\\text{CO}_{2}}(t)$ 作为时间函数的显式形式。我们将 $C(t)$ 的表达式代入强迫方程：\n$$\\Delta F_{\\text{CO}_{2}}(t)=\\alpha \\ln\\!\\left(\\frac{C_{0}\\exp(r t)}{C_{0}}\\right) = \\alpha \\ln(\\exp(r t)) = \\alpha r t.$$\n辐射强迫是时间的线性函数，通常称为斜坡强迫。\n\n现在，我们必须使用卷积分计算全球平均温度变化 $\\Delta T(t)$：\n$$\\Delta T(t) = \\int_{0}^{t} H(t-s) \\Delta F_{\\text{CO}_{2}}(s)\\,\\mathrm{d}s.$$\n代入 $H(t-s)$ 和 $\\Delta F_{\\text{CO}_{2}}(s)$ 的表达式：\n$$\\Delta T(t) = \\int_{0}^{t} \\left( \\sum_{i=1}^{2}\\frac{\\beta_{i}}{\\tau_{i}}\\exp\\!\\left(-\\frac{t-s}{\\tau_{i}}\\right) \\right) (\\alpha r s)\\,\\mathrm{d}s.$$\n我们可以交换求和与积分的顺序：\n$$\\Delta T(t) = \\alpha r \\sum_{i=1}^{2} \\frac{\\beta_{i}}{\\tau_{i}} \\int_{0}^{t} s \\exp\\!\\left(-\\frac{t-s}{\\tau_{i}}\\right)\\,\\mathrm{d}s.$$\n我们来计算单个分量 $i$ 的积分。我们可以将仅依赖于 $t$ 的项提取出来：\n$$I_{i}(t) = \\int_{0}^{t} s \\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right)\\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\,\\mathrm{d}s = \\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right) \\int_{0}^{t} s \\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\,\\mathrm{d}s.$$\n我们使用分部积分法 $\\int u\\,\\mathrm{d}v = uv - \\int v\\,\\mathrm{d}u$ 求解该积分。令 $u=s$ 且 $\\mathrm{d}v = \\exp(s/\\tau_{i})\\,\\mathrm{d}s$。则 $\\mathrm{d}u = \\mathrm{d}s$ 且 $v = \\tau_{i}\\exp(s/\\tau_{i})$。\n\\begin{align*} \\int_{0}^{t} s \\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\,\\mathrm{d}s = \\left[s \\tau_{i} \\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\right]_{0}^{t} - \\int_{0}^{t} \\tau_{i} \\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\,\\mathrm{d}s \\\\ = \\left(t \\tau_{i} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) - 0\\right) - \\left[\\tau_{i}^{2} \\exp\\!\\left(\\frac{s}{\\tau_{i}}\\right)\\right]_{0}^{t} \\\\ = t \\tau_{i} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) - \\left(\\tau_{i}^{2} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) - \\tau_{i}^{2} \\exp(0)\\right) \\\\ = t \\tau_{i} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) - \\tau_{i}^{2} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) + \\tau_{i}^{2}.\\end{align*}\n将此结果代回 $I_{i}(t)$ 的表达式中：\n$$I_{i}(t) = \\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right) \\left( t \\tau_{i} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) - \\tau_{i}^{2} \\exp\\!\\left(\\frac{t}{\\tau_{i}}\\right) + \\tau_{i}^{2} \\right) = t\\tau_{i} - \\tau_{i}^{2} + \\tau_{i}^{2}\\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right).$$\n这可以因式分解为 $I_i(t) = \\tau_i \\left( t - \\tau_i \\left(1 - \\exp\\left(-\\frac{t}{\\tau_i}\\right)\\right) \\right)$。\n\n现在，我们整合 $\\Delta T(t)$ 的完整表达式：\n$$\\Delta T(t) = \\alpha r \\sum_{i=1}^{2} \\frac{\\beta_{i}}{\\tau_{i}} I_{i}(t) = \\alpha r \\sum_{i=1}^{2} \\frac{\\beta_{i}}{\\tau_{i}} \\left( t\\tau_{i} - \\tau_{i}^{2} + \\tau_{i}^{2}\\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right) \\right).$$\n通过消去 $\\tau_i$ 来简化：\n$$\\Delta T(t) = \\alpha r \\sum_{i=1}^{2} \\beta_{i} \\left( t - \\tau_{i} + \\tau_{i}\\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right) \\right) = \\alpha r \\sum_{i=1}^{2} \\beta_{i} \\left[t - \\tau_{i}\\left(1 - \\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right)\\right)\\right].$$\n题目要求我们计算 $t = 100\\,\\text{yr}$ 时的 $\\Delta T(t)$。让我们代入数值。\n$r = 5.0\\times 10^{-3}\\,\\text{yr}^{-1}$\n$\\alpha = 5.35\\,\\text{W}\\,\\text{m}^{-2}$\n$t=100\\,\\text{yr}$\n第1项 ($i=1$)：$\\beta_{1}=0.5\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$，$\\tau_{1}=4\\,\\text{yr}$。\n第2项 ($i=2$)：$\\beta_{2}=0.3\\,\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})$，$\\tau_{2}=200\\,\\text{yr}$。\n\n我们先计算表达式内的和。令 $S = \\sum_{i=1}^{2} \\beta_{i} \\left[t - \\tau_{i}\\left(1 - \\exp\\!\\left(-\\frac{t}{\\tau_{i}}\\right)\\right)\\right]$。\n$$S_1 = \\beta_{1} \\left[t - \\tau_{1}\\left(1 - \\exp\\!\\left(-\\frac{t}{\\tau_{1}}\\right)\\right)\\right] = 0.5 \\left[100 - 4\\left(1 - \\exp\\!\\left(-\\frac{100}{4}\\right)\\right)\\right] = 0.5 \\left[100 - 4\\left(1 - \\exp(-25)\\right)\\right].$$\n$$S_2 = \\beta_{2} \\left[t - \\tau_{2}\\left(1 - \\exp\\!\\left(-\\frac{t}{\\tau_{2}}\\right)\\right)\\right] = 0.3 \\left[100 - 200\\left(1 - \\exp\\!\\left(-\\frac{100}{200}\\right)\\right)\\right] = 0.3 \\left[100 - 200\\left(1 - \\exp(-0.5)\\right)\\right].$$\n现在计算数值：\n项 $\\exp(-25)$ 非常小，$\\exp(-25) \\approx 1.3888 \\times 10^{-11}$。因此，$1 - \\exp(-25) \\approx 1$。\n$$S_1 \\approx 0.5 [100 - 4(1)] = 0.5 \\times 96 = 48.$$\n对于第二项，$\\exp(-0.5) \\approx 0.60653066$。\n$$S_2 = 0.3 [100 - 200(1 - 0.60653066)] = 0.3 [100 - 200(0.39346934)] = 0.3 [100 - 78.693868] = 0.3[21.306132] \\approx 6.3918396.$$\n总和 $S = S_1 + S_2 \\approx 48 + 6.3918396 = 54.3918396$。\n$S$ 的单位是 $\\text{K}\\,(\\text{W}^{-1}\\,\\text{m}^{2})\\,\\text{yr}$。\n\n最后，我们计算 $\\Delta T(100\\,\\text{yr})$：\n$$\\Delta T(100\\,\\text{yr}) = \\alpha r S = (5.35\\,\\text{W}\\,\\text{m}^{-2}) \\times (5.0\\times 10^{-3}\\,\\text{yr}^{-1}) \\times S.$$\n$$\\alpha r = 0.02675\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{yr}^{-1}.$$\n$$\\Delta T(100\\,\\text{yr}) = 0.02675 \\times 54.3918396 \\approx 1.4552019\\,\\text{K}.$$\n题目要求答案四舍五入到四位有效数字。\n$$\\Delta T(100\\,\\text{yr}) \\approx 1.455\\,\\text{K}.$$\n\n最后检查单位：\n$$[\\Delta T] = [\\alpha] \\times [r] \\times [\\beta] \\times [\\tau] = (\\text{W}\\,\\text{m}^{-2}) \\times (\\text{yr}^{-1}) \\times (\\text{K}\\,\\text{W}^{-1}\\,\\text{m}^{2}) \\times (\\text{yr}) = \\text{K}.$$\n单位一致。",
            "answer": "$$\\boxed{1.455}$$"
        },
        {
            "introduction": "我们永久冻土模型的准确性取决于它们在多大程度上能代表真实世界。这项高级练习介绍了一种强大的技术——变分数据同化，用以将卫星观测数据与模型状态相融合。通过这项实践，您将学习如何约束和改进模型中的土壤温度剖面，而这正是精确计算永久冻土融化及其反馈的基础 。",
            "id": "4074452",
            "problem": "您的任务是为与永久冻土融化过程及随之而来的碳反馈相关的垂直土壤温度剖面，在数值天气预报和气候模拟的背景下，制定并实施一个线性观测算子和一个三维变分（3D-Var）数据同化方案。目标是将卫星陆地表面温度（LST）和测量的雪深同化到模型的土壤温度状态中。\n\n状态定义：设控制向量为离散的土壤温度剖面 $x \\in \\mathbb{R}^n$，其分量为在深度 $z_i$（单位：米）处的 $x_i = T(z_i)$。在本问题中，使用 $n = 3$，深度为 $z = [z_1, z_2, z_3] = [0.05, 0.20, 1.00]$ 米。所有温度必须以开尔文表示。\n\n观测算子：卫星LST感知的是一个有效表层温度，该温度受近地表土壤温度、气温以及雪的隔热效应影响。从一维垂直热传导的 Fourier 定律开始，该定律指出传导通量 $q$ 满足 $q = -k \\,\\partial T/\\partial z$（在土壤或雪中），并且在稳态下，串联电阻相加。为了获得与此物理学一致的、以观测为中心的线性参数化，定义如下：\n- 一个用于土壤对地表影响的指数深度加权：对于一个表层深度尺度 $\\lambda$（单位：米），定义未归一化权重 $\\tilde{\\alpha}_i = \\exp(-z_i/\\lambda)$ 和归一化权重 $\\alpha_i = \\tilde{\\alpha}_i / \\sum_{j=1}^n \\tilde{\\alpha}_j$。\n- 一个基于雪深 $h$（单位：米）的雪解耦因子 $\\sigma(h) = \\exp(-h/h_s)$，其中 $h_s$（单位：米）是一个雪绝热尺度。\n\n基于以上定义，将状态 $x$ 映射到模拟的LST（单位：开尔文）的线性观测算子 $H(x; h, T_{\\mathrm{air}})$ 定义为\n$$\nH(x; h, T_{\\mathrm{air}}) = \\sigma(h)\\sum_{i=1}^{n}\\alpha_i T(z_i) + \\left(1 - \\sigma(h)\\right) T_{\\mathrm{air}},\n$$\n其中 $T_{\\mathrm{air}}$（单位：开尔文）是来自数值天气预报强迫的近地表气温。该参数化捕捉了以下特征：当雪深 $h \\to 0$ 时，表层温度主要由浅层土壤决定；而当雪很厚 $h \\to \\infty$ 时，表层温度接近气温。\n\n背景和观测误差模型：假设高斯背景先验 $x \\sim \\mathcal{N}(x_b, B)$ 和高斯观测误差 $y \\sim \\mathcal{N}(H(x; h, T_{\\mathrm{air}}), R)$，其中 $R = r$ 为标量（单位：$\\mathrm{K}^2$）。背景误差协方差 $B$（单位：$\\mathrm{K}^2$）由具有e-折叠长度 $L_b$（单位：米）和方差 $s_b^2$ 的平稳高斯相关指定：\n$$\nB_{ij} = s_b^2 \\exp\\!\\left(-\\frac{|z_i - z_j|}{L_b}\\right).\n$$\n\n变分目标：给定单个LST观测值 $y$（单位：开尔文）、雪深 $h$（单位：米）和气温 $T_{\\mathrm{air}}$（单位：开尔文），定义二次代价函数\n$$\nJ(x) = \\tfrac{1}{2}(x - x_b)^\\top B^{-1}(x - x_b) + \\tfrac{1}{2}\\left[y - H(x; h, T_{\\mathrm{air}})\\right]^\\top R^{-1}\\left[y - H(x; h, T_{\\mathrm{air}})\\right].\n$$\n分析场 $x_a$ 是 $J(x)$ 的最小化子。\n\n您的推导和实现所需的基本依据：\n- Fourier 定律 $q = -k \\,\\partial T/\\partial z$ 和串联热阻的概念为深度加权和雪解耦衰减提供了理论依据。\n- 高斯误差模型以及在线性观测映射下 3D-Var 目标 $J(x)$ 的定义。\n\n您的任务：\n1. 使用上述定义，当 $H(x; h, T_{\\mathrm{air}})$ 是 $x$ 的线性函数加上一个已知偏移项时，推导 $J(x)$ 的最小化子 $x_a$ 的线性代数形式。清晰说明如何从 $\\alpha_i$、$\\sigma(h)$ 和 $T_{\\mathrm{air}}$ 构建有效观测算子行向量和偏移项。\n2. 实现一个程序，为下面的每个测试用例计算 $x_a$，并返回最浅土壤节点处的分析温度 $T_a(z_1)$（单位为开尔文）。所有结果必须四舍五入到三位小数。\n3. 对所有用例使用以下固定参数：$\\lambda = 0.10$ 米， $h_s = 0.20$ 米，以及深度 $z = [0.05, 0.20, 1.00]$ 米。\n4. 测试套件。对于每个用例，所有温度单位为开尔文，深度单位为米，方差单位为开尔文平方：\n   - 用例 1（理想路径，中等雪量）：$h = 0.20$, $T_{\\mathrm{air}} = 265.0$, $y = 268.0$, $x_b = [270.0, 268.0, 265.0]$, $s_b^2 = 4.0$, $L_b = 0.30$, $r = 1.0$。\n   - 用例 2（无雪边界）：$h = 0.00$, $T_{\\mathrm{air}} = 290.0$, $y = 289.0$, $x_b = [285.0, 283.0, 280.0]$, $s_b^2 = 1.0$, $L_b = 0.10$, $r = 0.25$。\n   - 用例 3（厚雪边缘情况）：$h = 1.00$, $T_{\\mathrm{air}} = 255.0$, $y = 255.5$, $x_b = [260.0, 258.0, 256.0]$, $s_b^2 = 9.0$, $L_b = 0.50$, $r = 1.0$。\n   - 用例 4（高观测误差）：$h = 0.05$, $T_{\\mathrm{air}} = 273.0$, $y = 274.0$, $x_b = [272.0, 271.0, 270.0]$, $s_b^2 = 4.0$, $L_b = 0.20$, $r = 9.0$。\n   - 用例 5（薄活动层，强约束）：$h = 0.00$, $T_{\\mathrm{air}} = 276.0$, $y = 275.0$, $x_b = [274.0, 272.0, 268.0]$, $s_b^2 = 2.0$, $L_b = 0.30$, $r = 0.50$。\n\n实现要求：\n- 您的程序必须完全按照规定构建 $\\alpha_i$ 和 $\\sigma(h)$，使用给定的 $s_b^2$ 和 $L_b$ 构建 $B$，并为每个用例计算 3D-Var 分析场 $x_a$。\n- 角度单位不适用。\n- 最终输出格式：您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4,result5]\"）。每个结果必须是 $T_a(z_1)$，单位为开尔文，四舍五入到三位小数。",
            "solution": "该问题已经过验证，被确定为具有科学依据、适定且自洽。该公式代表了地球物理数据同化中的一个标准问题，特别是三维变分（3D-Var）分析，并应用于一个简化但有物理动机的土壤热力学模型。所有必需的参数和定义均已提供，不存在矛盾或模糊之处。\n\n解决方案分为两部分：首先，推导分析状态的解析解；其次，描述其数值实现的算法。\n\n### 分析状态的推导\n\n目标是找到最小化3D-Var代价函数 $J(x)$ 的分析状态向量 $x_a$。代价函数定义为：\n$$\nJ(x) = \\tfrac{1}{2}(x - x_b)^\\top B^{-1}(x - x_b) + \\tfrac{1}{2}\\left[y - H(x; h, T_{\\mathrm{air}})\\right]^\\top R^{-1}\\left[y - H(x; h, T_{\\mathrm{air}})\\right]\n$$\n其中 $x \\in \\mathbb{R}^n$ 是土壤温度的状态向量，$x_b$ 是背景状态，$B$ 是背景误差协方差矩阵，$y$ 是标量LST观测值，$R$ 是标量观测误差方差 $r$，$H(x; h, T_{\\mathrm{air}})$ 是观测算子。\n\n首先，我们线性化观测算子。问题中将其定义为：\n$$\nH(x; h, T_{\\mathrm{air}}) = \\sigma(h)\\sum_{i=1}^{n}\\alpha_i x_i + \\left(1 - \\sigma(h)\\right) T_{\\mathrm{air}}\n$$\n其中 $x_i = T(z_i)$。这可以表示为线性代数形式：\n$$\nH(x) = \\mathbf{H}x + d\n$$\n这里，$\\mathbf{H}$ 是一个 $1 \\times n$ 的行向量，$d$ 是一个标量偏移。通过检视，我们确定这些分量：\n- 有效观测算子行向量 $\\mathbf{H}$ 由下式给出：\n$$\n\\mathbf{H} = \\sigma(h) \\begin{bmatrix} \\alpha_1  \\alpha_2  \\dots  \\alpha_n \\end{bmatrix}\n$$\n- 标量偏移项 $d$ 由下式给出：\n$$\nd = \\left(1 - \\sigma(h)\\right) T_{\\mathrm{air}}\n$$\n\n有了这种线性形式，代价函数 $J(x)$ 成为 $x$ 的二次函数。为了找到其最小值，我们计算 $J(x)$ 关于 $x$ 的梯度并将其设为零。使用向量微积分的标准法则 $(\\nabla_x (u^\\top A u) = 2Au$ 对于对称矩阵 $A$ 和 $\\nabla_x(c^\\top x) = c)$，梯度 $\\nabla_x J(x)$ 为：\n$$\n\\nabla_x J(x) = B^{-1}(x - x_b) - \\mathbf{H}^\\top R^{-1}(y - (\\mathbf{H}x + d)) = 0\n$$\n由于 $y$ 和 $R=r$ 是标量，这简化为：\n$$\nB^{-1}(x - x_b) - \\frac{1}{r}\\mathbf{H}^\\top(y - \\mathbf{H}x - d) = 0\n$$\n为了求解 $x$（即最小值处的分析状态 $x_a$），我们重新排列各项：\n$$\nB^{-1}x_a - B^{-1}x_b - \\frac{1}{r}\\mathbf{H}^\\top(y-d) + \\frac{1}{r}\\mathbf{H}^\\top\\mathbf{H}x_a = 0\n$$\n$$\n\\left(B^{-1} + \\frac{1}{r}\\mathbf{H}^\\top\\mathbf{H}\\right)x_a = B^{-1}x_b + \\frac{1}{r}\\mathbf{H}^\\top(y-d)\n$$\n因此，分析状态为：\n$$\nx_a = \\left(B^{-1} + \\mathbf{H}^\\top R^{-1}\\mathbf{H}\\right)^{-1} \\left(B^{-1}x_b + \\mathbf{H}^\\top R^{-1}(y-d)\\right)\n$$\n虽然这种形式是正确的，但它需要对 $n \\times n$ 矩阵 $\\left(B^{-1} + \\mathbf{H}^\\top R^{-1}\\mathbf{H}\\right)$ 求逆，这在计算上可能开销巨大且数值上不稳定。一个更实用的公式是增益形式。使用 Woodbury 矩阵恒等式，解可以表示为：\n$$\nx_a = x_b + \\mathbf{K}(y - H(x_b))\n$$\n$$\nx_a = x_b + \\mathbf{K}(y - (\\mathbf{H}x_b + d))\n$$\n其中 $\\mathbf{K}$ 是分析增益矩阵（在此情况下是一个向量），定义为：\n$$\n\\mathbf{K} = B\\mathbf{H}^\\top (\\mathbf{H}B\\mathbf{H}^\\top + R)^{-1}\n$$\n项 $y - H(x_b)$ 是新息，表示观测值与投影到观测空间中的背景状态之间的差异。由于 $y$ 是一个标量，$\\mathbf{H}$ 是一个行向量，所以项 $\\mathbf{H}B\\mathbf{H}^\\top + R$ 是一个标量，使其求逆变得微不足道。对于标量观测误差方差 $R=r$，增益向量 $\\mathbf{K}$ 为：\n$$\n\\mathbf{K} = \\frac{B\\mathbf{H}^\\top}{\\mathbf{H}B\\mathbf{H}^\\top + r}\n$$\n这种形式避免了大型矩阵求逆，是实现的基础。\n\n### 算法\n为每个测试用例计算分析状态 $x_a$ 的步骤如下：\n1.  **初始化常量**：定义固定参数：土壤深度 $z = [0.05, 0.20, 1.00]$、表层深度尺度 $\\lambda = 0.10$ 和雪绝热尺度 $h_s = 0.20$。\n2.  **遍历测试用例**：对每个用例，获取参数：雪深 $h$、气温 $T_{\\mathrm{air}}$、LST观测值 $y$、背景状态 $x_b$、背景方差 $s_b^2$、背景相关长度 $L_b$ 和观测误差方差 $r$。\n3.  **构建背景误差协方差 $B$**：$n \\times n$ 矩阵 $B$ 的元素 $B_{ij}$ 使用提供的公式计算：\n    $$\n    B_{ij} = s_b^2 \\exp\\!\\left(-\\frac{|z_i - z_j|}{L_b}\\right)\n    $$\n4.  **构建观测算子分量**：\n    a.  计算归一化深度权重 $\\alpha_i$：\n        $$\n        \\tilde{\\alpha}_i = \\exp(-z_i/\\lambda); \\quad \\alpha_i = \\frac{\\tilde{\\alpha}_i}{\\sum_{j=1}^n \\tilde{\\alpha}_j}\n        $$\n    b.  计算雪解耦因子 $\\sigma(h)$：\n        $$\n        \\sigma(h) = \\exp(-h/h_s)\n        $$\n    c.  形成有效观测算子行向量 $\\mathbf{H} = \\sigma(h) \\alpha^\\top$ 和偏移量 $d = (1 - \\sigma(h)) T_{\\mathrm{air}}$。\n5.  **计算分析增益 $\\mathbf{K}$**：\n    a.  计算标量项 $\\mathbf{H}B\\mathbf{H}^\\top$。\n    b.  计算增益向量 $\\mathbf{K} = (B\\mathbf{H}^\\top) / (\\mathbf{H}B\\mathbf{H}^\\top + r)$。\n6.  **计算新息**：计算标量新息 $i = y - (\\mathbf{H}x_b + d)$。\n7.  **计算分析状态 $x_a$**：使用增益和新息更新背景状态：\n    $$\n    x_a = x_b + \\mathbf{K} i\n    $$\n8.  **提取并存储结果**：所需的结果是分析向量的第一个分量 $T_a(z_1) = (x_a)_1$。该值四舍五入到三位小数。\n9.  **格式化输出**：处理完所有用例后，将结果格式化为由方括号括起来的单个逗号分隔字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 3D-Var data assimilation problem for soil temperature profiles.\n    \"\"\"\n\n    # Fixed parameters from the problem statement\n    z = np.array([0.05, 0.20, 1.00])  # Soil depths in meters\n    lambda_scale = 0.10  # Skin-depth scale in meters\n    h_s = 0.20  # Snow-insulation scale in meters\n    \n    # Test suite from the problem statement\n    test_cases = [\n        # (h, T_air, y, x_b, s_b^2, L_b, r)\n        (0.20, 265.0, 268.0, [270.0, 268.0, 265.0], 4.0, 0.30, 1.0),\n        (0.00, 290.0, 289.0, [285.0, 283.0, 280.0], 1.0, 0.10, 0.25),\n        (1.00, 255.0, 255.5, [260.0, 258.0, 256.0], 9.0, 0.50, 1.0),\n        (0.05, 273.0, 274.0, [272.0, 271.0, 270.0], 4.0, 0.20, 9.0),\n        (0.00, 276.0, 275.0, [274.0, 272.0, 268.0], 2.0, 0.30, 0.50),\n    ]\n\n    results = []\n    \n    # Pre-calculate depth weights alpha, as they only depend on z and lambda\n    tilde_alpha = np.exp(-z / lambda_scale)\n    alpha = tilde_alpha / np.sum(tilde_alpha)\n\n    for case in test_cases:\n        h, T_air, y, xb_list, s_b2, L_b, r = case\n        xb = np.array(xb_list)\n        \n        # 1. Construct Background Error Covariance Matrix B\n        # |z_i - z_j| matrix using broadcasting\n        z_diff_matrix = np.abs(z[:, np.newaxis] - z)\n        B = s_b2 * np.exp(-z_diff_matrix / L_b)\n        \n        # 2. Construct Observation Operator (H_vec, d)\n        sigma_h = np.exp(-h / h_s)\n        H_vec = sigma_h * alpha\n        d = (1 - sigma_h) * T_air\n\n        # 3. Compute the Kalman Gain K\n        # Transpose H_vec to a column vector for matrix multiplication\n        H_vec_T = H_vec.reshape(-1, 1)\n        \n        # Denominator of the gain formula (a scalar)\n        # H_vec @ B @ H_vec_T is equivalent to H_vec @ (B @ H_vec_T)\n        HBH_T = H_vec @ B @ H_vec_T.flatten() # Ensure scalar\n        \n        # Numerator of the gain formula (a column vector)\n        BH_T = B @ H_vec_T\n        \n        # Kalman gain vector\n        K = BH_T / (HBH_T + r)\n\n        # 4. Calculate the innovation\n        # H(xb) = H_vec . xb + d\n        H_of_xb = H_vec @ xb + d\n        innovation = y - H_of_xb\n        \n        # 5. Compute the analysis state xa\n        # K is a (3,1) column vector, must flatten to add to (3,) xb\n        xa = xb + K.flatten() * innovation\n        \n        # 6. Store the result for the shallowest node\n        # Round to three decimal places as required\n        results.append(round(xa[0], 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}