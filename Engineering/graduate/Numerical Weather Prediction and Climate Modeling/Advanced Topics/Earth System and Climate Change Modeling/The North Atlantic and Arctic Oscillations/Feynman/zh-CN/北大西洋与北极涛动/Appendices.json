{
    "hands_on_practices": [
        {
            "introduction": "虽然我们通常将北大西洋涛动（NAO）简化为一个偶极子，但从复杂的大气数据中客观地识别其状态需要严谨的定量方法。本实践引导你使用一种强大的机器学习技术——K-均值聚类，来从环流异常场中自动发现主导模态或“环流模态”。通过构建一个考虑了地球曲率影响的加权聚类方案，你将能够以物理上一致的方式，从合成数据中识别出NAO的正负位相 。",
            "id": "4101930",
            "problem": "您的任务是制定并实施一个基于数学原理的聚类程序，以根据 $500$ 百帕 (hPa) 的位势高度异常来客观地定义北大西洋涛动 (NAO) 的模态。此任务的背景是数值天气预报和气候模拟，重点关注北大西洋和北极涛动。您必须从纯粹的数学公式出发，不依赖外部数据集。相反，您将操作一个合成数据集，该数据集旨在模拟与 NAO 概念结构一致的异常，并且您的程序必须是完全自洽的。\n\n从以下基本要素开始：异常的定义、欧几里得距离及其加权变体，以及 $K$-均值聚类的属性。具体来说，假设在一个代表北大西洋区域的 $p$ 个网格点上，存在一个 $500$ hPa 的位势高度异常场（单位：米），其纬度为 $\\phi_i$（单位：度），权重为 $w_i = \\cos(\\phi_i \\times \\pi/180)$，该权重近似于球体上中纬度带的面积加权。您将使用这些权重来定义一个适用于地理加权聚类的、具有物理意义的内积和方差。\n\n请按如下方式定义合成数据集和聚类框架：\n\n1.  设有 $p=8$ 个网格点，其纬度由列表 $[30, 35, 40, 45, 55, 60, 65, 70]$（单位：北纬度）给出。前 $4$ 个点代表一个亚热带地区（类似于 Azores 区域），后 $4$ 个点代表一个副极地地区（类似于 Iceland 区域）。\n2.  定义一个参考 NAO 偶极子向量 $r \\in \\mathbb{R}^p$，其中对于 $i = 1,\\dots,4$，有 $r_i = +1$；对于 $i = 5,\\dots,8$，有 $r_i = -1$。这是一个典型模态，其符号用于区分 NAO 正位相 (NAO$^+$) 和 NAO 负位相 (NAO$^-$) 模态。\n3.  构建一个包含 $n$ 个样本的每日异常合成数据集 $Z' \\in \\mathbb{R}^{n \\times p}$（单位：米），方法是从平均模态 $\\mu^+ = A \\cdot r$ 中抽取一半样本，从 $\\mu^- = -A \\cdot r$ 中抽取另一半样本，每个样本在每个网格点上都受到均值为零、标准差为 $\\sigma$（单位：米）的独立同分布高斯噪声的扰动。参数 $A$ 和 $\\sigma$ 在每个测试用例中有所不同。\n4.  使用 $K=2$ 的 $K$-均值聚类，通过最小化加权欧几里得距离的平方和来将样本划分为两种模态。其中，一个向量 $x \\in \\mathbb{R}^p$ 的加权平方范数定义为 $$\\|x\\|_w^2 = \\sum_{i=1}^{p} w_i x_i^2.$$ 您必须通过转换特征 $x_i \\mapsto \\sqrt{w_i}\\,x_i$ 来实现这一点，从而使得在转换空间中的标准欧几里得 $K$-均值对应于原始空间中的加权 $K$-均值。使用有原则的初始化方法（例如 $K$-means++），并在转换空间中计算簇质心；然后将质心映射回原始物理单位（米）。\n5.  使用每个质心 $c$ 在参考模态 $r$ 上的加权投影来标记这两种模态为 NAO$^+$ 和 NAO$^-$，该投影定义为 $$P(c,r) = \\sum_{i=1}^{p} w_i\\,c_i\\,r_i.$$ 投影较大的质心为 NAO$^+$；另一个为 NAO$^-$。\n6.  计算总加权惯量 $$T = \\sum_{j=1}^{n} \\|x_j - \\bar{x}\\|_w^2,$$ 其中 $\\bar{x}$ 是所有样本的加权平均值（等同于转换空间中的平均值映射回来），以及簇内加权惯量 $$W = \\sum_{j=1}^{n} \\|x_j - c_{a(j)}\\|_w^2,$$ 其中 $a(j)$ 表示样本 $j$ 的簇分配。报告聚类解释的方差分数 $$E = 1 - \\frac{W}{T}.$$ 在 $T = 0$ 的退化情况下，定义 $E = 0$。\n\n您必须实现一个完整的、可运行的程序，该程序能够生成合成数据集，执行加权 $K$-均值聚类，以米为单位计算模态质心，通过加权投影标记 NAO$^+$ 和 NAO$^-$，并计算解释的方差分数 $E$。\n\n单位和输出要求：\n\n-   所有异常和质心必须以米（m）为单位。解释的方差分数 $E$ 是无量纲的。\n-   纬度的角度单位是度；您必须仅在计算 $w_i$ 所需的三角函数内部将其转换为弧度。\n-   对于每个测试用例，您的程序必须输出一对值：\n    -   解释的方差分数 $E$，作为一个浮点数，四舍五入到三位小数。\n    -   一个布尔值，指示 NAO$^+$ 质心在 $r$ 上的投影是否严格为正，且 NAO$^-$ 质心在 $r$ 上的投影是否严格为负。\n-   将所有测试用例的结果汇总到一行中，打印成一个用方括号括起来的逗号分隔列表，顺序与测试用例的顺序一致：对于每个测试用例，首先输出浮点数 $E$，然后是布尔值。例如：$[E_1, bool_1, E_2, bool_2, E_3, bool_3]$。\n\n测试套件：\n\n所有用例均使用 $n = 100$ 个样本和上面给出的固定纬度列表。对于每个用例，设置随机数生成器种子以确保可复现性。\n\n-   用例 A（典型 NAO 信号）：$A = 50$ 米，$\\sigma = 10$ 米，种子 $= 42$。\n-   用例 B（无噪声边界）：$A = 80$ 米，$\\sigma = 0$ 米，种子 $= 123$。\n-   用例 C（退化的近零信号）：$A = 0$ 米，$\\sigma = 5$ 米，种子 $= 7$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如：$[0.853, True, 1.000, True, 0.000, False]$）。浮点数必须四舍五入到三位小数，布尔值必须是 `True` 或 `False`。",
            "solution": "该任务旨在通过聚类来识别北大西洋涛动 (NAO) 的模态，其方式尊重地理加权和异常场的物理特性。我们遵循一个基于经过充分检验的定义和方法的、有原则的设计。\n\n基本定义：\n\n-   $500$ 百帕 (hPa) 的位势高度异常，记为 $Z'$，是与气候平均值的偏差。我们将 $p$ 个网格点上的 $Z'$ 建模为 $\\mathbb{R}^p$ 中的一个向量，其条目单位为米。\n-   为了考虑空间采样和在球体上表示的异质性，我们定义面积权重 $w_i = \\cos(\\phi_i)$，其中 $\\phi_i$ 是以弧度为单位的纬度。这个标准近似承认了纬度 $\\phi$ 处的纬向带长度与 $\\cos(\\phi)$ 成正比。使用度作为输入纬度 $\\phi_i^\\circ$，我们通过 $\\phi_i = \\phi_i^\\circ \\times \\pi/180$ 进行转换。\n-   一个具有物理意义的方差由 $\\mathbb{R}^p$ 上的加权内积构建，给定为 $$\\langle x, y \\rangle_w = \\sum_{i=1}^{p} w_i x_i y_i,$$ 这导出了加权范数 $$\\|x\\|_w^2 = \\langle x, x \\rangle_w = \\sum_{i=1}^{p} w_i x_i^2.$$\n\n聚类目标及通过特征缩放实现的等价性：\n\n对于 $K=2$ 的 $K$-均值聚类旨在最小化簇内距离平方和。在加权设置中，目标函数为\n$$J = \\sum_{j=1}^{n} \\min_{k \\in \\{1,2\\}} \\|x_j - c_k\\|_w^2,$$\n其中 $x_j \\in \\mathbb{R}^p$ 是第 $j$ 个样本，而 $c_k \\in \\mathbb{R}^p$ 是簇 $k$ 的质心。通过将特征缩放 $\\sqrt{w_i}$，可以直接最小化加权目标：\n定义缩放后的数据 $\\tilde{x}_j$ 为\n$$\\tilde{x}_{j,i} = \\sqrt{w_i} \\, x_{j,i}, \\quad i=1,\\dots,p.$$\n在缩放空间中，标准欧几里得范数满足\n$$\\|\\tilde{x}_j - \\tilde{c}_k\\|_2^2 = \\sum_{i=1}^{p} (\\sqrt{w_i}(x_{j,i} - c_{k,i}))^2 = \\sum_{i=1}^{p} w_i (x_{j,i} - c_{k,i})^2 = \\|x_j - c_k\\|_w^2.$$\n因此，在 $\\tilde{x}_j$ 上运行标准欧几里得 $K$-均值，可以最小化在 $x_j$ 上的具有物理意义的加权目标函数。在缩放空间中计算的质心满足\n$$\\tilde{c}_k = \\frac{1}{n_k} \\sum_{j \\in \\mathcal{C}_k} \\tilde{x}_j,$$\n并将其映射回原始物理单位，得到\n$$c_{k,i} = \\frac{\\tilde{c}_{k,i}}{\\sqrt{w_i}}, \\quad i = 1,\\dots,p,$$\n确保 $c_k$ 在原始坐标中最小化加权目标。\n\n方差分解与解释分数：\n\n定义缩放空间中的全局均值\n$$\\tilde{m} = \\frac{1}{n} \\sum_{j=1}^{n} \\tilde{x}_j.$$\n总惯量为\n$$T = \\sum_{j=1}^{n} \\|\\tilde{x}_j - \\tilde{m}\\|_2^2 = \\sum_{j=1}^{n} \\|x_j - m\\|_w^2,$$\n其中 $m$ 是映射回原始空间的均值，$m_i = \\tilde{m}_i / \\sqrt{w_i}$。簇内惯量为\n$$W = \\sum_{j=1}^{n} \\min_{k \\in \\{1,2\\}} \\|\\tilde{x}_j - \\tilde{c}_k\\|_2^2.$$\n聚类解释的方差分数则为\n$$E = 1 - \\frac{W}{T},$$\n约定当 $T=0$ 时（总方差为零的退化情况），$E=0$。\n\n通过具有物理动机的投影进行模态标记：\n\n北大西洋涛动 (NAO) 本质上是亚热带和副极地北大西洋区域之间位势高度异常的偶极子模态。我们构建一个典型参考向量 $r \\in \\mathbb{R}^p$，其中对于亚热带指数 $i=1,\\dots,4$，有 $r_i = +1$；对于副极地指数 $i=5,\\dots,8$，有 $r_i = -1$。为客观地标记模态，我们计算加权投影\n$$P(c,r) = \\langle c, r \\rangle_w = \\sum_{i=1}^{p} w_i \\, c_i \\, r_i.$$\n投影较大的质心被标记为 NAO$^+$；另一个被标记为 NAO$^-$。正确性检查包括验证 $P(c^+,r) > 0$ 和 $P(c^-,r)  0$。\n\n整合上述原理的算法步骤：\n\n1.  构建以度为单位的纬度数组，并为 $i=1,\\dots,8$ 计算权重 $w_i = \\cos(\\phi_i \\times \\pi/180)$。计算 $\\sqrt{w_i}$ 用于特征缩放。\n2.  对于每个测试用例，生成合成异常：\n    -   设置 $n=100$，振幅 $A$（米），噪声标准差 $\\sigma$（米）。\n    -   定义均值 $\\mu^+ = A \\cdot r$ 和 $\\mu^- = -A \\cdot r$。\n    -   抽取 $n/2$ 个样本作为 $\\mu^+$ 加上每个网格点的独立高斯噪声 $\\mathcal{N}(0,\\sigma^2)$；对 $\\mu^-$ 也进行类似操作。\n3.  通过 $\\sqrt{w_i}$ 进行特征缩放以形成 $\\tilde{x}_j$。使用 $K=2$ 的 $K$-均值和 $K$-means++ 初始化运行：\n    -   使用固定的种子从数据中随机选择第一个中心。\n    -   以与到第一个中心的平方距离成正比的概率选择第二个中心（在缩放空间中）。\n    -   迭代 Lloyd 算法：将点分配到缩放空间中最近的中心，将中心更新为缩放空间中的算术平均值，直到收敛或达到最大迭代阈值。通过从最远点重新初始化来处理空簇。\n4.  通过除以 $\\sqrt{w_i}$ 将缩放后的质心映射回原始单位。计算缩放空间中的全局均值和总惯量 $T$，计算簇内惯量 $W$，然后计算 $E = 1 - W/T$，如果 $T=0$ 则 $E=0$。\n5.  通过计算每个质心 $k$ 的 $P(c_k,r)$ 来标记模态，并将投影较大的质心识别为 NAO$^+$。通过 $P(c^+,r) > 0$ 和 $P(c^-,r)  0$ 检查正确性。\n6.  对于每个测试用例，输出一个四舍五入到三位小数的浮点数 $E$ 和一个用于正确性检查的布尔值。将所有测试用例的结果汇总到一行打印的单个列表中。\n\n测试套件的基本原理：\n\n-   用例 A 中 $A=50$ 米和 $\\sigma=10$ 米，代表一个具有实际噪声的、定义明确的 NAO 信号；聚类应能解释相当大比例的方差，并且标记应正确。\n-   用例 B 中 $A=80$ 米和 $\\sigma=0$ 米，是无噪声的；聚类应能解释几乎所有的方差，并且标记应正确。\n-   用例 C 中 $A=0$ 米和 $\\sigma=5$ 米，是退化的；没有平均信号，因此聚类解释的方差近似为零，并且由于投影接近于零，标记很可能会失败。\n\n这些用例探测了典型行为、一个边界条件和一个边缘场景，从而验证了算法的鲁棒性和物理可解释性。\n\n最终程序将实现所有计算，并生成格式为 $[E_1, bool_1, E_2, bool_2, E_3, bool_3]$ 的单行输出，其中浮点数四舍五入到三位小数，布尔值采用标准 Python 格式。",
            "answer": "```python\nimport numpy as np\n\ndef kmeans_weighted(data_scaled, k=2, rng=None, max_iter=200, tol=1e-10):\n    \"\"\"\n    Run standard Euclidean K-means on scaled data (feature scaling encodes weights).\n    Returns centers in scaled space, assignments, within-cluster inertia W, total inertia T.\n    \"\"\"\n    n, p = data_scaled.shape\n    if rng is None:\n        rng = np.random.default_rng(0)\n\n    # K-means++ initialization\n    centers = np.empty((k, p), dtype=float)\n    # Choose first center uniformly at random\n    idx0 = rng.integers(0, n)\n    centers[0] = data_scaled[idx0]\n    # Choose subsequent centers with probability proportional to squared distance to nearest existing center\n    for c in range(1, k):\n        # Compute squared distances to nearest existing center\n        d2 = np.min(((data_scaled[:, None, :] - centers[None, :c, :]) ** 2).sum(axis=2), axis=1)\n        # Handle degenerate case where all distances are zero\n        if d2.sum()  1e-15:\n            # Pick a random point\n            idx = rng.integers(0, n)\n            centers[c] = data_scaled[idx]\n        else:\n            probs = d2 / d2.sum()\n            idx = rng.choice(n, p=probs)\n            centers[c] = data_scaled[idx]\n\n    # Lloyd's iterations\n    assignments = np.zeros(n, dtype=int)\n    for it in range(max_iter):\n        # Assign to nearest center\n        d2_to_centers = ((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2)\n        new_assignments = np.argmin(d2_to_centers, axis=1)\n\n        # Check for convergence\n        if np.array_equal(assignments, new_assignments):\n            break\n        assignments = new_assignments\n\n        # Update centers\n        for c in range(k):\n            members = data_scaled[assignments == c]\n            if members.shape[0] == 0:\n                # Reinitialize empty cluster to the farthest point from current centers\n                d2 = np.min(((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2), axis=1)\n                idx = np.argmax(d2)\n                centers[c] = data_scaled[idx]\n            else:\n                centers[c] = members.mean(axis=0)\n\n    # Compute total inertia T and within-cluster inertia W in scaled space\n    mean_scaled = data_scaled.mean(axis=0)\n    T = ((data_scaled - mean_scaled) ** 2).sum()\n    # Recompute distances to final centers and assignments\n    d2_to_centers = ((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2)\n    final_assignments = np.argmin(d2_to_centers, axis=1)\n    W = d2_to_centers[np.arange(n), final_assignments].sum()\n\n    return centers, final_assignments, W, T, mean_scaled\n\ndef generate_synthetic(n, p, A, sigma, rng):\n    \"\"\"\n    Generate synthetic anomalies with half samples from +A*r and half from -A*r plus Gaussian noise.\n    \"\"\"\n    # Reference dipole vector r: +1 for first half (subtropics), -1 for second half (subpolar)\n    r = np.concatenate([np.ones(p // 2), -np.ones(p - p // 2)])\n    mu_plus = A * r\n    mu_minus = -A * r\n    half = n // 2\n\n    noise_plus = rng.normal(0.0, sigma, size=(half, p))\n    noise_minus = rng.normal(0.0, sigma, size=(n - half, p))\n\n    data = np.vstack([mu_plus + noise_plus, mu_minus + noise_minus])\n    return data, r\n\ndef solve():\n    # Fixed latitude list in degrees (first 4 subtropics, last 4 subpolar)\n    lat_deg = np.array([30.0, 35.0, 40.0, 45.0, 55.0, 60.0, 65.0, 70.0])\n    lat_rad = lat_deg * np.pi / 180.0\n    w = np.cos(lat_rad)  # area weights\n    sqrt_w = np.sqrt(w)\n\n    # Define the test cases: (A in m, sigma in m, seed)\n    test_cases = [\n        (50.0, 10.0, 42),   # Case A: typical NAO signal\n        (80.0, 0.0, 123),   # Case B: noiseless boundary\n        (0.0, 5.0, 7),      # Case C: degenerate near-null signal\n    ]\n    n = 100\n    p = 8\n\n    results = []\n    for A, sigma, seed in test_cases:\n        rng = np.random.default_rng(seed)\n        data, r = generate_synthetic(n, p, A, sigma, rng)\n\n        # Scale features by sqrt(w) for weighted K-means\n        data_scaled = data * sqrt_w\n\n        # Run K-means in scaled space\n        centers_scaled, assignments, W, T, mean_scaled = kmeans_weighted(data_scaled, k=2, rng=rng)\n\n        # Map centroids back to original units (meters)\n        centers = centers_scaled / sqrt_w\n\n        # Compute explained variance E\n        E = 0.0 if T  1e-15 else (1.0 - W / T)\n\n        # Label regimes using weighted projection onto r\n        # Weighted projection P(c, r) = sum_i w_i * c_i * r_i\n        projections = np.array([np.sum(w * centers[k] * r) for k in range(2)])\n        # NAO+ is centroid with larger projection\n        plus_idx = int(np.argmax(projections))\n        minus_idx = 1 - plus_idx\n        p_plus = projections[plus_idx]\n        p_minus = projections[minus_idx]\n        labeling_correct = (p_plus > 0.0) and (p_minus  0.0)\n\n        # Append results: E rounded to three decimals, and labeling correctness\n        results.append(round(E, 3))\n        results.append(labeling_correct)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "识别出NAO的模态之后，下一步是探究其驱动机制。本练习将带你深入遥相关的物理核心，即定常Rossby波的传播理论。通过计算和分析一个关键诊断量——定常波折射率指数，你将学习如何识别引导波能量从太平洋等遥远源地传播至北大西洋的“波导”，从而为理解影响NAO变化的遥相关过程提供一个动力学框架 。",
            "id": "4101917",
            "problem": "您需要推导并实现一种基于正压准地转（QG）位涡梯度的静止 Rossby 波传播诊断方法，并将其应用于北太平洋-北大西洋区域的一个合成的十二月-一月-二月（DJF）背景流场。目标是计算静止波的折射指数平方 $n^2$，并检测是否存在一个连续的波导将北太平洋源区与北大西洋目标区连接起来。这是一个遥相关路径（将太平洋强迫与北大西洋涛动（NAO）响应联系起来）存在的必要条件。\n\n从一个具有缓慢变化的平均流的 $\\beta$ 平面上的正压准地转（QG）框架开始。使用具有纬向波数 $k$ 和经向波数 $l$ 的正压 QG Rossby 波的基本频散关系：\n$$\n\\omega \\;=\\; U k \\;-\\; \\frac{\\beta k}{k^2 + l^2},\n$$\n其中 $\\omega$ 是内禀频率，$U(y,\\lambda)$ 是背景纬向风，$\\beta$ 是科里奥利参数的经向梯度。对于相对于地面静止的波，设 $\\omega = 0$。使用由下式定义的正压经向位涡梯度 $q_y$：\n$$\nq_y \\;=\\; \\beta \\;-\\; \\frac{\\partial^2 U}{\\partial y^2}.\n$$\n推导静止波折射指数的平方（即经向波数的平方）为：\n$$\nn^2(y,\\lambda) \\;=\\; l^2(y,\\lambda) \\;=\\; \\frac{q_y(y,\\lambda)}{U(y,\\lambda)} \\;-\\; k^2,\n$$\n该式在 $U0$ 和尺度分离的假设下有效。当 $n^20$ 和 $U0$ 时，该折射指数指示了允许静止波传播的局部区域。\n\n您将使用以下物理上一致的常数和单位：\n- 地球自转速率 $\\Omega = 7.2921159 \\times 10^{-5}\\ \\mathrm{s^{-1}}$。\n- 地球半径 $a = 6.371 \\times 10^{6}\\ \\mathrm{m}$。\n- 科里奥利参数为 $f = 2 \\Omega \\sin \\phi$，在纬度 $\\phi$ 处的经向梯度为 $\\beta(\\phi) = \\frac{2 \\Omega \\cos \\phi}{a}$。\n- 球面上的纬向波数 $s$（整数）通过 $k = \\dfrac{s}{a \\cos \\phi_{\\mathrm{ref}}}$ 映射到局地 $\\beta$ 平面上的纬向波数 $k$，其中 $\\phi_{\\mathrm{ref}}$ 是一个固定的参考纬度。使用 $\\phi_{\\mathrm{ref}} = 45^\\circ$。\n- 在问题定义中，角度以度为单位指定，但在数值计算中必须转换为弧度。\n- 纬向风 $U$ 的单位是 $\\mathrm{m\\,s^{-1}}$，经向坐标 $y$ 的单位是 $\\mathrm{m}$，波数 $k$ 和 $n$ 的单位是 $\\mathrm{m^{-1}}$，折射指数平方 $n^2$ 的单位是 $\\mathrm{m^{-2}}$。\n\n在一个经纬度网格上，通过叠加一个随经度变化的太平洋急流、一个随经度变化的大西洋急流以及一个宽广的纬向对称的中纬度西风带，来构造一个合成的 DJF 气候态背景纬向风 $U(\\phi,\\lambda)$，所有风均为西风（正值）：\n- 区域：\n  - 纬度 $\\phi$ 从 $20^\\circ\\ \\mathrm{N}$ 到 $80^\\circ\\ \\mathrm{N}$（含边界），网格间距为 $\\Delta \\phi = 1^\\circ$。\n  - 经度 $\\lambda$ 从 $120^\\circ\\ \\mathrm{E}$ 到 $300^\\circ\\ \\mathrm{E}$（含边界），网格间距为 $\\Delta \\lambda = 1^\\circ$。\n- 背景中纬度带：\n  $$\n  U_{\\mathrm{b}}(\\phi) \\;=\\; U_{\\mathrm{b0}} \\exp\\!\\left( -\\frac{(\\phi - \\phi_{\\mathrm{b}})^2}{2 \\sigma_{\\mathrm{b}}^2} \\right),\n  $$\n  其中 $U_{\\mathrm{b0}} = 12\\ \\mathrm{m\\,s^{-1}}$，$\\phi_{\\mathrm{b}} = 40^\\circ$，$\\sigma_{\\mathrm{b}} = 12^\\circ$。\n- 太平洋急流（在经纬度上均局部化）：\n  $$\n  U_{\\mathrm{P}}(\\phi,\\lambda) \\;=\\; U_{\\mathrm{P0}} \\exp\\!\\left( -\\frac{(\\phi - \\phi_{\\mathrm{P}})^2}{2 \\sigma_{\\phi,\\mathrm{P}}^2} - \\frac{(\\lambda - \\lambda_{\\mathrm{P}})^2}{2 \\sigma_{\\lambda,\\mathrm{P}}^2} \\right),\n  $$\n  其中 $U_{\\mathrm{P0}} = 30\\ \\mathrm{m\\,s^{-1}}$，$\\phi_{\\mathrm{P}} = 38^\\circ$，$\\lambda_{\\mathrm{P}} = 170^\\circ\\ \\mathrm{E}$，$\\sigma_{\\phi,\\mathrm{P}} = 6^\\circ$，$\\sigma_{\\lambda,\\mathrm{P}} = 35^\\circ$。\n- 大西洋急流（在经纬度上均局部化）：\n  $$\n  U_{\\mathrm{A}}(\\phi,\\lambda) \\;=\\; U_{\\mathrm{A0}} \\exp\\!\\left( -\\frac{(\\phi - \\phi_{\\mathrm{A}})^2}{2 \\sigma_{\\phi,\\mathrm{A}}^2} - \\frac{(\\lambda - \\lambda_{\\mathrm{A}})^2}{2 \\sigma_{\\lambda,\\mathrm{A}}^2} \\right),\n  $$\n  其中 $U_{\\mathrm{A0}} = 28\\ \\mathrm{m\\,s^{-1}}$，$\\phi_{\\mathrm{A}} = 45^\\circ$，$\\lambda_{\\mathrm{A}} = 285^\\circ\\ \\mathrm{E}$，$\\sigma_{\\phi,\\mathrm{A}} = 7^\\circ$，$\\sigma_{\\lambda,\\mathrm{A}} = 30^\\circ$。\n\n将总风定义为\n$$\nU(\\phi,\\lambda) \\;=\\; U_{\\mathrm{b}}(\\phi) + U_{\\mathrm{P}}(\\phi,\\lambda) + U_{\\mathrm{A}}(\\phi,\\lambda).\n$$\n\n按如下方式计算 $q_y(\\phi,\\lambda)$ 和 $n^2(\\phi,\\lambda)$：\n- 在所有内部计算中，将 $\\phi$ 和 $\\lambda$ 从度转换为弧度。\n- 在每个纬度上计算 $\\beta(\\phi) = \\dfrac{2 \\Omega \\cos \\phi}{a}$。\n- 将经向坐标 $y$ 处理为 $y = a \\phi$，因此均匀的 $\\Delta \\phi$ 对应于均匀的 $\\Delta y = a\\,\\Delta \\phi$。\n- 使用经向上的二阶精度有限差分格式计算二阶经向导数 $\\dfrac{\\partial^2 U}{\\partial y^2}$：\n  - 内部点： \n    $$\n    \\left.\\frac{\\partial^2 U}{\\partial y^2}\\right|_{i} \\approx \\frac{U_{i+1} - 2 U_i + U_{i-1}}{\\Delta y^2}.\n    $$\n  - 在经向边界上，使用单侧二阶近似：\n    $$\n    \\left.\\frac{\\partial^2 U}{\\partial y^2}\\right|_{0} \\approx \\frac{2 U_0 - 5 U_1 + 4 U_2 - U_3}{\\Delta y^2}, \\quad\n    \\left.\\frac{\\partial^2 U}{\\partial y^2}\\right|_{N-1} \\approx \\frac{2 U_{N-1} - 5 U_{N-2} + 4 U_{N-3} - U_{N-4}}{\\Delta y^2}.\n    $$\n- 构成 \n  $$\n  q_y(\\phi,\\lambda) \\;=\\; \\beta(\\phi) \\;-\\; \\frac{\\partial^2 U}{\\partial y^2}.\n  $$\n- 对于给定的纬向波数 $s$，计算 \n  $$\n  k \\;=\\; \\frac{s}{a \\cos \\phi_{\\mathrm{ref}}},\n  $$\n  其中 $\\phi_{\\mathrm{ref}} = 45^\\circ$，然后计算\n  $$\n  n^2(\\phi,\\lambda) \\;=\\; \\frac{q_y(\\phi,\\lambda)}{U(\\phi,\\lambda)} \\;-\\; k^2,\n  $$\n  通过逻辑条件 $U0$ 和 $n^20$ 来定义允许传播的点。\n\n为检测潜在的遥相关路径，定义：\n- 一个北太平洋源区 $S$ 为 \n  $$\n  150^\\circ\\ \\mathrm{E} \\le \\lambda \\le 210^\\circ\\ \\mathrm{E}, \\quad 30^\\circ\\ \\mathrm{N} \\le \\phi \\le 50^\\circ\\ \\mathrm{N}.\n  $$\n- 一个北大西洋目标区 $T$ 为 \n  $$\n  270^\\circ\\ \\mathrm{E} \\le \\lambda \\le 300^\\circ\\ \\mathrm{E}, \\quad 30^\\circ\\ \\mathrm{N} \\le \\phi \\le 55^\\circ\\ \\mathrm{N}.\n  $$\n\n构建一个二元掩码\n$$\n\\mathcal{M}(\\phi,\\lambda) = \\begin{cases}\n1,  U(\\phi,\\lambda)  0 \\ \\text{and}\\ n^2(\\phi,\\lambda)  0,\\\\\n0,  \\text{otherwise.}\n\\end{cases}\n$$\n在经纬度网格上使用 4-邻域连通性，判断是否存在至少一条由 $\\mathcal{M}=1$ 的网格点组成的连通路径，该路径从 $S$ 开始并到达 $T$。连通性是离散网格上的纯几何概念（经度上无周期性回绕）。\n\n测试套件和要求的输出：\n- 使用以下四个对应于纬向波数 $s$ 的测试用例：\n  - 测试 1：$s = 2$。\n  - 测试 2：$s = 3$。\n  - 测试 3：$s = 5$。\n  - 测试 4：$s = 8$。\n- 对于每个测试用例，返回一个布尔值，指示路径是否存在（$\\mathrm{True}$ 或 $\\mathrm{False}$）。\n- 最终输出格式：您的程序应生成单行输出，其中包含用逗号分隔并用方括号括起来的结果，例如 $[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{False}]$。\n\n物理和数值单位：\n- 所有速度单位必须为 $\\mathrm{m\\,s^{-1}}$。\n- 所有距离单位必须为 $\\mathrm{m}$。\n- 问题陈述中提供的所有角度单位均为度，但在内部计算中必须将其转换为弧度。\n- 折射指数平方 $n^2$ 的计算单位必须为 $\\mathrm{m^{-2}}$。\n- 最终的布尔值是无单位的。\n\n您的任务：\n- 从所述的 QG 基础推导用于 $n^2$ 的表达式。\n- 在指定的网格和合成流场上实现计算。\n- 使用掩码 $\\mathcal{M}$ 实现从 $S$ 到 $T$ 的连通性测试。\n- 为四个指定的 $s$ 值生成包含四个布尔值的单行最终输出。",
            "solution": "用户提供的问题经评估有效。它在科学上基于地球物理流体动力学的既定原理，在数学上是适定的，并为数值求解提供了一套完整而明确的指令。\n\n### 折射指数的推导\n\n主要任务是推导静止 Rossby 波折射指数平方 $n^2$ 的表达式。我们从 $\\beta$ 平面上的准地转（QG）动力学原理开始。\n\n问题陈述了正压 QG Rossby 波的基本频散关系为：\n$$\n\\omega \\;=\\; U k \\;-\\; \\frac{\\beta k}{k^2 + l^2}\n$$\n这里，$\\omega$ 是内禀频率，$U$ 是背景纬向风，$k$ 和 $l$ 分别是纬向和经向波数，$\\beta$ 是行星涡度梯度。\n\n此形式对于均匀的纬向流 $U$ 有效。然而，问题指定了一个随经向变化的背景流 $U(y, \\lambda)$。在具有经向切变的流中，背景位涡（PV）梯度不仅仅是 $\\beta$，而是被平均流的相对涡度曲率所修正。正压 QG-PV 的经向梯度 $q_y$ 定义为：\n$$\nq_y \\;=\\; \\beta \\;-\\; \\frac{\\partial^2 U}{\\partial y^2}\n$$\n对于在此类非均匀流上传播的波，通过用 $q_y$ 替换 $\\beta$ 来推广标准频散关系。这是正压 QG-PV 守恒方程线性化的结果。推广后的频散关系是：\n$$\n\\omega \\;=\\; U k \\;-\\; \\frac{q_y k}{k^2 + l^2}\n$$\n问题要求我们找到相对于地面静止的波的条件。这对应于将波的地面频率设为零。遵循问题陈述的约定，我们对上述关系施加 $\\omega = 0$。虽然这是一种常见的简写，但更正式的理解是，波相对于地面的相速度为零的条件，对于纬向流 $U$ 来说，这意味着内禀相速度 $\\omega/k$ 必须等于 $-U$。两种方法都会得到相同的代数结果。\n\n设 $\\omega = 0$：\n$$\n0 \\;=\\; U k \\;-\\; \\frac{q_y k}{k^2 + l^2}\n$$\n假设在纬向具有波状结构（$k \\neq 0$），我们可以将方程两边除以 $k$：\n$$\n0 \\;=\\; U \\;-\\; \\frac{q_y}{k^2 + l^2}\n$$\n这个方程可以重新排列。我们假设背景流为西风（$U > 0$），这是静止 Rossby 波传播的必要条件。当 $U > 0$ 时，我们有：\n$$\nU(k^2 + l^2) = q_y \\implies k^2 + l^2 = \\frac{q_y}{U}\n$$\n这个基本结果被称为静止波传播的 Charney-Drazin 准则。它将静止波的总波数与背景状态联系起来。问题将折射指数的平方 $n^2$ 定义为等同于经向波数的平方 $l^2$。因此，我们可以解出 $l^2$：\n$$\nl^2 = \\frac{q_y}{U} - k^2\n$$\n通过认定 $n^2(y, \\lambda) = l^2(y, \\lambda)$，我们得到了需要实现的表达式，它取决于背景流的局部性质：\n$$\nn^2(y,\\lambda) \\;=\\; \\frac{q_y(y,\\lambda)}{U(y,\\lambda)} \\;-\\; k^2\n$$\n为了使波能够经向传播，其经向波数 $l$ 必须是实数，这意味着 $l^2  0$。因此，允许静止波传播的区域是那些同时满足 $U  0$ 和 $n^2  0$ 的区域。这些区域可以形成“波导”，将波活动从一个地理区域引导到另一个地理区域。\n\n### 数值实现策略\n\n数值解将通过以下步骤实现：\n1.  **网格和常数设置**：首先，我们定义物理常数（$\\Omega$, $a$）并构建数值网格。根据指定的区域和分辨率创建纬度（$\\phi$）和经度（$\\lambda$）数组。将它们转换为弧度以进行计算。从这些数组生成一个二维网格（meshgrid）以方便向量化计算。\n\n2.  **背景流场构建**：通过对其三个分量求和来计算合成的纬向风场 $U(\\phi, \\lambda)$：纬向对称带 $U_{\\mathrm{b}}(\\phi)$、太平洋急流 $U_{\\mathrm{P}}(\\phi, \\lambda)$ 和大西洋急流 $U_{\\mathrm{A}}(\\phi, \\lambda)$。每个分量都使用所提供的高斯函数和参数在二维网格上计算。\n\n3.  **位涡梯度计算**：我们计算经向 QG-PV 梯度 $q_y$。这需要两项：\n    -   在网格的每个纬度上计算行星涡度梯度 $\\beta(\\phi) = \\frac{2 \\Omega \\cos \\phi}{a}$。\n    -   使用指定的二阶精度有限差分格式计算纬向风的二阶经向导数 $\\frac{\\partial^2 U}{\\partial y^2}$。关系式 $y = a\\phi$ 给出了经向网格间距为 $\\Delta y = a \\Delta\\phi$。沿二维风场 $U$ 的纬度轴，对内部点和南北边界分别应用不同的差分格式。\n    -   最后，在网格上计算 $q_y = \\beta - \\frac{\\partial^2 U}{\\partial y^2}$。\n\n4.  **折射指数和波导掩码**：对四个指定的纬向波数 $s \\in \\{2, 3, 5, 8\\}$ 中的每一个进行计算。在对这些值的循环中：\n    -   计算局地纬向波数 $k = \\frac{s}{a \\cos \\phi_{\\mathrm{ref}}}$，其中 $\\phi_{\\mathrm{ref}} = 45^\\circ$。\n    -   在整个网格上计算折射指数平方 $n^2 = \\frac{q_y}{U} - k^2$。\n    -   创建一个二元掩码 $\\mathcal{M}$，如果网格单元同时满足 $U0$ 和 $n^20$，则标记为允许传播（$\\mathcal{M}=1$），否则标记为不允许传播（$\\mathcal{M}=0$）。\n\n5.  **连通性分析**：为确定是否存在遥相关路径，我们在二元掩码 $\\mathcal{M}$ 上进行搜索。\n    -   将源区 $S$ 和目标区 $T$ 映射到它们对应的网格索引。\n    -   采用广度优先搜索（BFS）算法。搜索从源区 $S$ 内所有允许传播的网格点开始初始化。\n    -   BFS 使用 4-邻域连通性（上、下、左、右）系统地探索相邻的允许传播的单元，无经度回绕。\n    -   如果搜索到达目标区 $T$ 内的任何单元，则确认存在连续的波导路径，该波数 $s$ 的结果为 `True`。\n    -   如果搜索完成但未到达目标区，则不存在这样的路径，结果为 `False`。\n\n6.  **输出生成**：收集四个测试用例中每个连通性分析的布尔结果，并将其格式化为所需的单行字符串输出。",
            "answer": "```python\nimport numpy as np\nimport collections\n\ndef solve():\n    \"\"\"\n    Derives and implements a diagnostic for stationary Rossby wave propagation.\n    \"\"\"\n    # Physical and numerical constants\n    OMEGA = 7.2921159e-5  # Earth's rotation rate in rad/s\n    A = 6.371e6          # Earth's radius in m\n    PHI_REF_DEG = 45.0   # Reference latitude for k calculation in degrees\n    \n    # Grid definition\n    phi_deg = np.arange(20.0, 80.1, 1.0)  # Latitude grid in degrees\n    lam_deg = np.arange(120.0, 300.1, 1.0) # Longitude grid in degrees\n    n_phi, n_lam = len(phi_deg), len(lam_deg)\n    \n    phi_rad = np.deg2rad(phi_deg)\n    lam_rad = np.deg2rad(lam_deg)\n    \n    # Create 2D meshgrids for vectorized calculations\n    lam_grid_deg, phi_grid_deg = np.meshgrid(lam_deg, phi_deg)\n\n    # 1. Compute background wind field U(phi, lambda)\n    # Background midlatitude belt U_b\n    U_b0, phi_b, sigma_b = 12.0, 40.0, 12.0\n    U_b = U_b0 * np.exp(-((phi_grid_deg - phi_b)**2) / (2 * sigma_b**2))\n    \n    # Pacific jet U_P\n    U_P0, phi_P, lam_P, sigma_phi_P, sigma_lam_P = 30.0, 38.0, 170.0, 6.0, 35.0\n    U_P = U_P0 * np.exp(-((phi_grid_deg - phi_P)**2) / (2 * sigma_phi_P**2) -\n                         ((lam_grid_deg - lam_P)**2) / (2 * sigma_lam_P**2))\n    \n    # Atlantic jet U_A\n    U_A0, phi_A, lam_A, sigma_phi_A, sigma_lam_A = 28.0, 45.0, 285.0, 7.0, 30.0\n    U_A = U_A0 * np.exp(-((phi_grid_deg - phi_A)**2) / (2 * sigma_phi_A**2) -\n                         ((lam_grid_deg - lam_A)**2) / (2 * sigma_lam_A**2))\n    \n    # Total zonal wind U\n    U = U_b + U_P + U_A\n    \n    # 2. Compute meridional PV gradient q_y\n    # Planetary vorticity gradient beta\n    beta = (2 * OMEGA * np.cos(phi_rad)) / A\n    beta_grid = np.tile(beta[:, np.newaxis], (1, n_lam)) # Reshape to 2D grid\n\n    # Second meridional derivative d^2U/dy^2\n    dphi_rad = np.deg2rad(1.0)\n    dy = A * dphi_rad\n    d2U_dy2 = np.zeros_like(U)\n    \n    # Interior points\n    d2U_dy2[1:-1, :] = (U[2:, :] - 2 * U[1:-1, :] + U[:-2, :]) / (dy**2)\n    \n    # Southern boundary (i=0)\n    d2U_dy2[0, :] = (2*U[0,:] - 5*U[1,:] + 4*U[2,:] - U[3,:]) / (dy**2)\n\n    # Northern boundary (i=N-1)\n    N = n_phi\n    d2U_dy2[N-1, :] = (2*U[N-1,:] - 5*U[N-2,:] + 4*U[N-3,:] - U[N-4,:]) / (dy**2)\n    \n    # Total q_y\n    q_y = beta_grid - d2U_dy2\n    \n    # 3. Define source/target regions and connectivity check function\n    # Source region S: 150E = lam = 210E, 30N = phi = 50N\n    i_min_S = 10 # 30 - 20\n    i_max_S = 30 # 50 - 20\n    j_min_S = 30 # 150 - 120\n    j_max_S = 90 # 210 - 120\n    \n    # Target region T: 270E = lam = 300E, 30N = phi = 55N\n    i_min_T = 10 # 30 - 20\n    i_max_T = 35 # 55 - 20\n    j_min_T = 150# 270 - 120\n    j_max_T = 180# 300 - 120\n\n    def check_connectivity(mask):\n        \"\"\"Performs a BFS to find a path from source S to target T.\"\"\"\n        visited = np.full(mask.shape, False, dtype=bool)\n        queue = collections.deque()\n\n        # Initialize queue with all source points that are in the waveguide\n        for i in range(i_min_S, i_max_S + 1):\n            for j in range(j_min_S, j_max_S + 1):\n                if mask[i, j]:\n                    queue.append((i, j))\n                    visited[i, j] = True\n        \n        while queue:\n            i, j = queue.popleft()\n            \n            # Check if current point is in the target region\n            if i_min_T = i = i_max_T and j_min_T = j = j_max_T:\n                return True # Path found\n\n            # Explore 4 neighbors\n            for di, dj in [(0, 1), (0, -1), (1, 0), (-1, 0)]:\n                ni, nj = i + di, j + dj\n                \n                # Check for bounds, if in waveguide, and if not visited\n                if (0 = ni  n_phi and 0 = nj  n_lam and\n                        mask[ni, nj] and not visited[ni, nj]):\n                    visited[ni, nj] = True\n                    queue.append((ni, nj))\n        \n        return False # No path found\n\n    # 4. Loop through test cases\n    test_cases = [2, 3, 5, 8]\n    results = []\n    \n    for s in test_cases:\n        # Zonal wavenumber k\n        k = s / (A * np.cos(np.deg2rad(PHI_REF_DEG)))\n        \n        # Refractive index squared n^2\n        # Avoid division by zero, although U is positive by construction\n        n2 = np.divide(q_y, U, out=np.full_like(U, -np.inf), where=U!=0) - k**2\n        \n        # Binary mask for waveguide\n        mask = (U > 0)  (n2 > 0)\n        \n        # Check for pathway\n        path_exists = check_connectivity(mask)\n        results.append(path_exists)\n        \n    # Final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "从物理机制的理解转向数值预报中的实际应用，本实践聚焦于数据同化这一核心环节。无论是天气预报还是气候分析，都需要不断地利用观测来修正模式结果。这个练习将通过一个简化的贝叶斯分析框架，向你展示如何将一个NAO指数的观测值与模式的背景预测相融合，从而生成一个更优的分析状态，这正是现代数据同化系统的基石 。",
            "id": "4101919",
            "problem": "一个用于北大西洋涛动 (NAO) 指数的气候数据同化系统，在一个数值天气预报 (NWP) 模型中嵌入了一个一维线性高斯分析步骤。状态变量是 NAO 指数，记为 $x$，单一观测值是由标准化海平面气压偶极子构建的 NAO 指数替代指标，记为 $y$。观测算子是一个已知的线性敏感度 $H \\in \\mathbb{R}$，因此观测模型为 $y = H x + \\epsilon$，其中观测误差 $\\epsilon$ 是均值为零、方差为 $R$ 的高斯分布。$x$ 的背景（先验）分布是均值为 $x^b$、方差为 $B$ 的高斯分布，其中 $B0$ 且 $R0$。\n\n从贝叶斯线性高斯框架（在线性情况下等同于最佳线性无偏估计）出发，推导 NAO 指数的最优标量分析增量。该增量定义为后验（分析）均值与先验均值之差，即 $\\delta I \\equiv x^a - x^b$，并用新息 $(y - H x^b)$ 以及背景和观测误差方差表示。在推导中明确指出标量增益 $K$。\n\n然后，使用以下具体的、科学上合理的值对该增量进行数值计算：\n- $x^b = 0.5$ (无量纲 NAO 指数),\n- $y = 1.2$ (无量纲),\n- $H = 0.8$,\n- $B = 1.0$ (无量纲平方),\n- $R = 0.25$ (无量纲平方)。\n\n报告增量 $\\delta I$ 的数值（一个无量纲的纯数），并将您的答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 第 1 步：提取已知条件\n- 状态变量：NAO 指数, $x$。\n- 观测值：NAO 指数的替代指标, $y$。\n- $x$ 的背景（先验）分布：均值为 $x^b$、方差为 $B$ 的高斯分布。$p(x) = \\mathcal{N}(x; x^b, B)$。\n- 观测模型：$y = H x + \\epsilon$。\n- 观测算子：已知的线性敏感度 $H \\in \\mathbb{R}$。\n- 观测误差 $\\epsilon$：均值为零、方差为 $R$ 的高斯分布。$\\epsilon \\sim \\mathcal{N}(0, R)$。\n- 约束条件：$B0$, $R0$。\n- 分析增量的定义：$\\delta I \\equiv x^a - x^b$，其中 $x^a$ 是后验（分析）均值。\n- 任务 1：用新息 $(y - H x^b)$ 及误差方差 $B$ 和 $R$ 推导 $\\delta I$，并明确指出增益 $K$。\n- 任务 2：对 $\\delta I$ 进行数值计算。\n- 数值：\n    - $x^b = 0.5$\n    - $y = 1.2$\n    - $H = 0.8$\n    - $B = 1.0$\n    - $R = 0.25$\n- 精度要求：将数值答案四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一维贝叶斯数据同化，这是数值天气预报和气候建模中的一项基础且广泛使用的技术（具体来说，它是卡尔曼滤波更新或三维变分分析的标量形式）。NAO 指数是一个真实且重要的气候模式。在许多业务系统中，使用线性观测算子和高斯误差统计是标准的、有效的简化假设。所提供的数值对于一个标准化的气候指数是物理上合理的。该问题基于统计估计和大气科学的既定原则。\n- **适定性**：该问题是适定的。对于一个线性高斯模型，存在唯一的后验均值和方差的解析解。问题提供了计算分析增量的单一、唯一数值所需的所有信息（$x^b, y, H, B, R$）。\n- **客观性**：问题以精确、客观的数学和科学语言陈述。它不包含主观或基于观点的陈述。\n- **完整性与一致性**：问题是自洽且内部一致的。所有必需的变量和参数都已定义，没有给出矛盾的信息。约束条件 $B0$ 和 $R0$ 确保了概率分布的良好定义。\n\n### 第 3 步：结论与行动\n问题被判定为**有效**。它在科学上是合理的、适定的、客观的和完整的。我将继续进行完整解答。\n\n问题要求在贝叶斯线性高斯框架内推导最优标量分析增量。根据贝叶斯定理，给定观测值 $y$ 的状态 $x$ 的后验概率分布（记为 $p(x|y)$）与似然函数和先验分布的乘积成正比：\n$$p(x|y) \\propto p(y|x) p(x)$$\n状态 $x$ 的先验分布是均值为 $x^b$、方差为 $B$ 的高斯分布：\n$$p(x) = \\frac{1}{\\sqrt{2\\pi B}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x^b)^2}{B}\\right)$$\n观测模型为 $y = Hx + \\epsilon$，其中观测误差 $\\epsilon$ 来自均值为零、方差为 $R$ 的高斯分布，即 $\\epsilon \\sim \\mathcal{N}(0, R)$。这意味着在给定状态 $x$ 的情况下观测到 $y$ 的似然函数也是高斯分布，其均值为 $Hx$，方差为 $R$：\n$$p(y|x) = \\frac{1}{\\sqrt{2\\pi R}} \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right)$$\n结合这些，后验分布为：\n$$p(x|y) \\propto \\exp\\left(-\\frac{1}{2} \\frac{(x - x^b)^2}{B}\\right) \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right) = \\exp\\left(-\\frac{1}{2}\\left[\\frac{(x - x^b)^2}{B} + \\frac{(y - Hx)^2}{R}\\right]\\right)$$\n对于高斯后验分布，其均值（分析状态 $x^a$）对应于众数，即最大化后验概率的 $x$ 值。最大化 $p(x|y)$ 等价于最小化其对数的负值。我们将代价函数 $J(x)$ 定义为指数部分自变量的负二倍：\n$$J(x) = \\frac{(x - x^b)^2}{B} + \\frac{(y - Hx)^2}{R}$$\n为了找到 $J(x)$ 的最小值，我们对 $x$ 求导并令其为零。满足此条件的 $x$ 值即为分析均值 $x^a$。\n$$\\frac{dJ}{dx} = \\frac{2(x - x^b)}{B} + \\frac{2(y - Hx)(-H)}{R} = 0$$\n设 $x = x^a$ 并化简：\n$$\\frac{x^a - x^b}{B} - \\frac{H(y - Hx^a)}{R} = 0$$\n$$\\frac{x^a - x^b}{B} = \\frac{Hy - H^2x^a}{R}$$\n现在，我们求解 $x^a$：\n$$R(x^a - x^b) = B(Hy - H^2x^a)$$\n$$Rx^a - Rx^b = BHy - BH^2x^a$$\n$$Rx^a + BH^2x^a = Rx^b + BHy$$\n$$x^a(R + BH^2) = Rx^b + BHy$$\n$$x^a = \\frac{Rx^b + BHy}{R + BH^2}$$\n问题要求的是分析增量 $\\delta I = x^a - x^b$。我们可以变换 $x^a$ 的表达式以得到所需的形式，该形式包含新息项 $(y - Hx^b)$。\n$$x^a = x^b + (x^a - x^b)$$\n$$\\delta I = x^a - x^b = \\frac{Rx^b + BHy}{R + BH^2} - x^b$$\n$$\\delta I = \\frac{Rx^b + BHy - x^b(R + BH^2)}{R + BH^2}$$\n$$\\delta I = \\frac{Rx^b + BHy - Rx^b - BH^2x^b}{R + BH^2}$$\n$$\\delta I = \\frac{BHy - BH^2x^b}{R + BH^2}$$\n在分子中提取公因式，得到增量的最终形式：\n$$\\delta I = \\left(\\frac{BH}{R + BH^2}\\right) (y - Hx^b)$$\n这个表达式用新息 $(y - Hx^b)$ 和一个系数项来定义分析增量 $\\delta I$。这个系数就是最优标量增益，我们将其确定为 $K$：\n$$K = \\frac{BH}{R + BH^2}$$\n因此，分析增量为 $\\delta I = K(y - Hx^b)$，分析更新方程为 $x^a = x^b + K(y - Hx^b)$。\n\n现在，我们用给定的数值对该表达式进行数值计算：\n- $x^b = 0.5$\n- $y = 1.2$\n- $H = 0.8$\n- $B = 1.0$\n- $R = 0.25$\n\n首先，计算新息项 $(y - Hx^b)$：\n$$y - Hx^b = 1.2 - (0.8)(0.5) = 1.2 - 0.4 = 0.8$$\n接下来，计算标量增益 $K$：\n$$K = \\frac{BH}{R + BH^2} = \\frac{(1.0)(0.8)}{0.25 + (1.0)(0.8)^2} = \\frac{0.8}{0.25 + 0.64} = \\frac{0.8}{0.89}$$\n最后，计算分析增量 $\\delta I$：\n$$\\delta I = K(y - Hx^b) = \\left(\\frac{0.8}{0.89}\\right)(0.8) = \\frac{0.64}{0.89}$$\n$$\\delta I \\approx 0.71910112359...$$\n四舍五入到四位有效数字，增量的数值为 $0.7191$。",
            "answer": "$$\\boxed{0.7191}$$"
        }
    ]
}