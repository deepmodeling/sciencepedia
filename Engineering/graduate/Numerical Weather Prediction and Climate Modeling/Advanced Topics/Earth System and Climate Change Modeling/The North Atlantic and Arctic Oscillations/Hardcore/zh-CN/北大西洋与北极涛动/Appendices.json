{
    "hands_on_practices": [
        {
            "introduction": "传统上，北大西洋涛动(NAO)是通过一个简单的压力差指数来定义的。然而，一个更全面的视角需要我们审视其完整的空间形态，而本练习将介绍一种客观的、数据驱动的方法来实现这一目标。通过将强大的K-均值聚类算法应用于位势高度异常场，我们可以自动识别出如NAO正负位相这样主要的大气环流模态。这项实践旨在培养将机器学习方法应用于气候数据分析的技能，理解在处理地理数据时进行面积加权的重要性，并最终帮助你阐释气候变率指数背后丰富的空间物理意义。",
            "id": "4101930",
            "problem": "您的任务是制定并实现一个基于数学原理的聚类程序，以从 $500$ 百帕 (hPa) 的位势高度异常客观地定义北大西洋涛动 (NAO) 的模态。其背景涉及数值天气预报和气候建模，重点关注北大西洋涛动和北极涛动。您必须从纯粹的数学公式出发，不依赖外部数据集。相反，您将操作一个合成数据集，该数据集旨在模拟与 NAO 概念结构一致的异常，并且您的程序必须是完全自包含的。\n\n从以下基本要素开始：异常的定义、欧几里得距离及其加权变体，以及 $K$-均值聚类的性质。具体来说，假设在一个代表北大西洋区域的 $p$ 个网格点上，存在一个 $500$ hPa 的位势高度异常场（单位为米），其纬度为 $\\phi_i$（单位为度），权重为 $w_i = \\cos(\\phi_i \\times \\pi/180)$，该权重近似于球体上中纬度带的面积加权。您将使用这些权重来定义一个适用于地理加权聚类的、具有物理意义的内积和方差。\n\n按如下方式定义合成数据集和聚类框架：\n\n1. 设有 $p=8$ 个网格点，其纬度由列表 $[\\;30,35,40,45,55,60,65,70\\;]$（北纬）给出。前 $4$ 个点代表亚热带区域（类似于亚速尔地区），后 $4$ 个点代表副极地地区（类似于冰岛地区）。\n2. 定义一个参考 NAO 偶极子向量 $r \\in \\mathbb{R}^p$，其中对于 $i = 1,\\dots,4$，$r_i = +1$；对于 $i = 5,\\dots,8$，$r_i = -1$。这是一个标准模式，其符号用于区分 NAO 正模态 (NAO$^+$) 和 NAO 负模态 (NAO$^-$)。\n3. 构建一个包含 $n$ 个每日异常样本的合成数据集 $Z' \\in \\mathbb{R}^{n \\times p}$（单位为米）。方法是从均值模式 $\\mu^+ = A \\cdot r$ 中抽取一半样本，从 $\\mu^- = -A \\cdot r$ 中抽取另一半样本，每个样本在每个网格点上都受到均值为零、标准差为 $\\sigma$（单位为米）的独立同分布高斯噪声的扰动。参数 $A$ 和 $\\sigma$ 因测试用例而异。\n4. 使用 $K=2$ 的 $K$-均值聚类，通过最小化加权欧几里得距离的平方和，将样本划分为两个模态。其中，向量 $x \\in \\mathbb{R}^p$ 的加权平方范数定义为 $$\\|x\\|_w^2 = \\sum_{i=1}^{p} w_i x_i^2.$$ 您必须通过变换特征 $x_i \\mapsto \\sqrt{w_i}\\,x_i$ 来实现这一点，使得变换后空间中的标准欧几里得 $K$-均值对应于原始空间中的加权 $K$-均值。使用有原则的初始化方法（如 $K$-means++），并在变换后的空间中计算聚类中心；然后将聚类中心映射回原始物理单位（米）。\n5. 使用每个聚类中心 $c$ 在参考模式 $r$ 上的加权投影来标记这两个模态为 NAO$^+$ 和 NAO$^-$，该投影定义为 $$P(c,r) = \\sum_{i=1}^{p} w_i\\,c_i\\,r_i.$$ 投影值较大的聚类中心为 NAO$^+$；另一个为 NAO$^-$。\n6. 计算总加权惯量 $$T = \\sum_{j=1}^{n} \\|x_j - \\bar{x}\\|_w^2,$$ 其中 $\\bar{x}$ 是所有样本的加权均值（等同于变换后空间中的均值映射回来），以及簇内加权惯量 $$W = \\sum_{j=1}^{n} \\|x_j - c_{a(j)}\\|_w^2,$$ 其中 $a(j)$ 表示样本 $j$ 的聚类分配。报告聚类所解释的方差分数 $$E = 1 - \\frac{W}{T}.$$ 在退化情况 $T = 0$下，定义 $E = 0$。\n\n您必须实现一个完整的、可运行的程序，该程序能够生成合成数据集，执行加权 $K$-均值聚类，以米为单位计算模态中心，通过其加权投影标记 NAO$^+$ 和 NAO$^-$，并计算解释的方差分数 $E$。\n\n单位和输出要求：\n\n- 所有异常和聚类中心必须以米 (m) 为单位。解释的方差分数 $E$ 是无量纲的。\n- 纬度的角度单位是度；您必须仅在计算 $w_i$ 所需的三角函数内部将其转换为弧度。\n- 您的程序必须为每个测试用例输出一对值，包括：\n  - 解释的方差分数 $E$，为浮点数，四舍五入到三位小数，\n  - 一个布尔值，指示 NAO$^+$ 中心的 $r$ 投影是否严格为正，且 NAO$^-$ 中心的 $r$ 投影是否严格为负。\n- 将所有测试用例的结果汇总到单行打印输出中，形式为用方括号括起来的逗号分隔列表，并按测试用例的顺序排列：对于每个测试用例，首先输出浮点数 $E$，然后是布尔值。例如：$[\\;E_1,\\mathrm{bool}_1,E_2,\\mathrm{bool}_2,E_3,\\mathrm{bool}_3\\;]$。\n\n测试套件：\n\n所有用例均使用 $n = 100$ 个样本和上面给出的固定纬度列表。为确保可复现性，为每个用例设置随机数生成器种子。\n\n- 用例 A（典型 NAO 信号）：$A = 50$ 米，$\\sigma = 10$ 米，种子 $= 42$。\n- 用例 B（无噪声边界）：$A = 80$ 米，$\\sigma = 0$ 米，种子 $= 123$。\n- 用例 C（退化的近零信号）：$A = 0$ 米，$\\sigma = 5$ 米，种子 $= 7$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，$[\\;0.853,\\mathrm{True},1.000,\\mathrm{True},0.000,\\mathrm{False}\\;]$）。浮点数必须四舍五入到三位小数，布尔值必须是 $\\mathrm{True}$ 或 $\\mathrm{False}$。",
            "solution": "此任务旨在通过聚类方法识别北大西洋涛动 (NAO) 模态，该方法需尊重地理加权和异常场的物理特性。我们遵循一种基于原则的设计，该设计植根于经过充分检验的定义和方法。\n\n基本定义：\n\n- $500$ 百帕 (hPa) 的位势高度异常，记为 $Z'$，是与气候平均值的偏差。我们将 $p$ 个网格点上的 $Z'$ 建模为 $\\mathbb{R}^p$ 中的一个向量，其条目单位为米。\n- 为考虑空间采样的异质性以及在球面上的表示，我们定义面积权重 $w_i = \\cos(\\phi_i)$，其中 $\\phi_i$ 是以弧度为单位的纬度。这一标准近似承认了纬度 $\\phi$ 处的纬向带长度与 $\\cos(\\phi)$ 成正比。对于以度为单位的输入纬度 $\\phi_i^\\circ$，我们通过 $\\phi_i = \\phi_i^\\circ \\times \\pi/180$ 进行转换。\n- 一个具有物理意义的方差是基于 $\\mathbb{R}^p$ 上的加权内积构建的，该内积为 $$\\langle x, y \\rangle_w = \\sum_{i=1}^{p} w_i x_i y_i,$$ 它导出加权范数 $$\\|x\\|_w^2 = \\langle x, x \\rangle_w = \\sum_{i=1}^{p} w_i x_i^2.$$\n\n聚类目标及通过特征缩放实现的等价性：\n\n对于 $K=2$ 的 $K$-均值聚类旨在最小化簇内距离平方和。在加权设置中，目标函数为\n$$J = \\sum_{j=1}^{n} \\min_{k \\in \\{1,2\\}} \\|x_j - c_k\\|_w^2,$$\n其中 $x_j \\in \\mathbb{R}^p$ 是第 $j$ 个样本，$c_k \\in \\mathbb{R}^p$ 是聚类 $k$ 的中心。加权目标的直接最小化可以通过将特征按 $\\sqrt{w_i}$ 进行缩放来实现：\n定义缩放后的数据 $\\tilde{x}_j$ 为\n$$\\tilde{x}_{j,i} = \\sqrt{w_i} \\, x_{j,i}, \\quad i=1,\\dots,p.$$\n在缩放空间中，标准欧几里得范数满足\n$$\\|\\tilde{x}_j - \\tilde{c}_k\\|_2^2 = \\sum_{i=1}^{p} (\\sqrt{w_i}(x_{j,i} - c_{k,i}))^2 = \\sum_{i=1}^{p} w_i (x_{j,i} - c_{k,i})^2 = \\|x_j - c_k\\|_w^2.$$\n因此，对 $\\tilde{x}_j$ 运行标准欧几里得 $K$-均值，即最小化了 $x_j$ 上具有物理意义的加权目标。在缩放空间中计算的聚类中心满足\n$$\\tilde{c}_k = \\frac{1}{n_k} \\sum_{j \\in \\mathcal{C}_k} \\tilde{x}_j,$$\n映射回原始物理单位得到\n$$c_{k,i} = \\frac{\\tilde{c}_{k,i}}{\\sqrt{w_i}}, \\quad i = 1,\\dots,p,$$\n确保 $c_k$ 在原始坐标系中最小化加权目标。\n\n方差分解与解释分数：\n\n定义缩放空间中的全局均值\n$$\\tilde{m} = \\frac{1}{n} \\sum_{j=1}^{n} \\tilde{x}_j.$$\n总惯量为\n$$T = \\sum_{j=1}^{n} \\|\\tilde{x}_j - \\tilde{m}\\|_2^2 = \\sum_{j=1}^{n} \\|x_j - m\\|_w^2,$$\n其中 $m$ 是映射回原始空间的均值，$m_i = \\tilde{m}_i / \\sqrt{w_i}$。簇内惯量为\n$$W = \\sum_{j=1}^{n} \\min_{k \\in \\{1,2\\}} \\|\\tilde{x}_j - \\tilde{c}_k\\|_2^2.$$\n聚类解释的方差分数为\n$$E = 1 - \\frac{W}{T},$$\n约定当 $T=0$ 时（总方差消失的退化情况），$E=0$。\n\n通过具有物理动机的投影进行模态标记：\n\n北大西洋涛动 (NAO) 本质上是亚热带和副极地北大西洋地区之间位势高度异常的偶极子模式。我们构建一个标准参考向量 $r \\in \\mathbb{R}^p$，其中对于亚热带指数 $i=1,\\dots,4$，$r_i = +1$；对于副极地指数 $i=5,\\dots,8$，$r_i = -1$。为了客观地标记模态，我们计算加权投影\n$$P(c,r) = \\langle c, r \\rangle_w = \\sum_{i=1}^{p} w_i \\, c_i \\, r_i.$$\n投影值较大的聚类中心被标记为 NAO$^+$；另一个被标记为 NAO$^-$。正确性检查包括验证 $P(c^+,r) > 0$ 和 $P(c^-,r)  0$。\n\n整合各项原则的算法步骤：\n\n1. 构建以度为单位的纬度数组，并为 $i=1,\\dots,8$ 计算权重 $w_i = \\cos(\\phi_i \\times \\pi/180)$。计算 $\\sqrt{w_i}$ 用于特征缩放。\n2. 对于每个测试用例，生成合成异常：\n   - 设置 $n=100$，振幅 $A$（米），噪声标准差 $\\sigma$（米）。\n   - 定义均值 $\\mu^+ = A \\cdot r$ 和 $\\mu^- = -A \\cdot r$。\n   - 抽取 $n/2$ 个样本为 $\\mu^+$ 加上每个网格点的独立高斯噪声 $\\mathcal{N}(0,\\sigma^2)$；对 $\\mu^-$ 也进行类似操作。\n3. 通过 $\\sqrt{w_i}$ 缩放特征以形成 $\\tilde{x}_j$。使用 $K$-means++ 初始化运行 $K=2$ 的 $K$-均值聚类：\n   - 使用固定的种子从数据中随机选择第一个中心。\n   - 以与到第一个中心的缩放空间中距离平方成正比的概率选择第二个中心。\n   - 迭代 Lloyd 算法：将点分配到缩放空间中最近的中心，将中心更新为缩放空间中的算术平均值，直到收敛或达到最大迭代阈值。通过从最远点重新初始化来处理空簇。\n4. 通过除以 $\\sqrt{w_i}$ 将缩放后的聚类中心映射回原始单位。计算缩放空间中的全局均值和总惯量 $T$，计算簇内惯量 $W$，然后计算 $E = 1 - W/T$，若 $T=0$ 则 $E=0$。\n5. 通过计算每个聚类中心 $k$ 的 $P(c_k,r)$ 来标记模态，并将投影值较大的聚类中心识别为 NAO$^+$。通过 $P(c^+,r) > 0$ 和 $P(c^-,r)  0$ 检查正确性。\n6. 对于每个测试用例，输出一个四舍五入到三位小数的浮点数 $E$ 和一个用于正确性检查的布尔值。将所有测试用例的结果汇总到一个单行打印的列表中。\n\n测试套件原理：\n\n- 用例 A，$A=50$ 米，$\\sigma=10$ 米，代表一个具有现实噪声的明确 NAO 信号；聚类应能解释相当大比例的方差，且标记应正确。\n- 用例 B，$A=80$ 米，$\\sigma=0$ 米，是无噪声的情况；聚类应能解释几乎所有方差，且标记应正确。\n- 用例 C，$A=0$ 米，$\\sigma=5$ 米，是退化情况；没有平均信号，因此聚类解释的方差近似为零，标记可能因投影接近零而失败。\n\n这些用例探测了典型行为、边界条件和边缘情景，验证了算法的鲁棒性和物理可解释性。\n\n最终程序将实现所有计算，并生成形如 $[\\;E_1,\\mathrm{bool}_1,E_2,\\mathrm{bool}_2,E_3,\\mathrm{bool}_3\\;]$ 的单行输出，其中浮点数四舍五入到三位小数，布尔值采用标准 Python 格式。",
            "answer": "```python\nimport numpy as np\n\ndef kmeans_weighted(data_scaled, k=2, rng=None, max_iter=200, tol=1e-10):\n    \"\"\"\n    Run standard Euclidean K-means on scaled data (feature scaling encodes weights).\n    Returns centers in scaled space, assignments, within-cluster inertia W, total inertia T.\n    \"\"\"\n    n, p = data_scaled.shape\n    if rng is None:\n        rng = np.random.default_rng(0)\n\n    # K-means++ initialization\n    centers = np.empty((k, p), dtype=float)\n    # Choose first center uniformly at random\n    idx0 = rng.integers(0, n)\n    centers[0] = data_scaled[idx0]\n    # Choose subsequent centers with probability proportional to squared distance to nearest existing center\n    for c in range(1, k):\n        # Compute squared distances to nearest existing center\n        d2 = np.min(((data_scaled[:, None, :] - centers[None, :c, :]) ** 2).sum(axis=2), axis=1)\n        # Handle degenerate case where all distances are zero\n        if np.all(d2 = 1e-15):\n            # Pick a random point\n            idx = rng.integers(0, n)\n            centers[c] = data_scaled[idx]\n        else:\n            probs = d2 / d2.sum()\n            idx = rng.choice(n, p=probs)\n            centers[c] = data_scaled[idx]\n\n    # Lloyd's iterations\n    assignments = np.zeros(n, dtype=int)\n    for it in range(max_iter):\n        # Assign to nearest center\n        d2_to_centers = ((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2)\n        new_assignments = np.argmin(d2_to_centers, axis=1)\n\n        # Check for convergence\n        if np.array_equal(assignments, new_assignments):\n            break\n        assignments = new_assignments\n\n        # Update centers\n        for c in range(k):\n            members = data_scaled[assignments == c]\n            if members.shape[0] == 0:\n                # Reinitialize empty cluster to the farthest point from current centers\n                d2 = np.min(((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2), axis=1)\n                idx = np.argmax(d2)\n                centers[c] = data_scaled[idx]\n            else:\n                centers[c] = members.mean(axis=0)\n\n    # Compute total inertia T and within-cluster inertia W in scaled space\n    mean_scaled = data_scaled.mean(axis=0)\n    T = ((data_scaled - mean_scaled) ** 2).sum()\n    # Recompute distances to final centers and assignments\n    d2_to_centers = ((data_scaled[:, None, :] - centers[None, :, :]) ** 2).sum(axis=2)\n    final_assignments = np.argmin(d2_to_centers, axis=1)\n    W = d2_to_centers[np.arange(n), final_assignments].sum()\n\n    return centers, final_assignments, W, T, mean_scaled\n\ndef generate_synthetic(n, p, A, sigma, rng):\n    \"\"\"\n    Generate synthetic anomalies with half samples from +A*r and half from -A*r plus Gaussian noise.\n    \"\"\"\n    # Reference dipole vector r: +1 for first half (subtropics), -1 for second half (subpolar)\n    r = np.concatenate([np.ones(p // 2), -np.ones(p - p // 2)])\n    mu_plus = A * r\n    mu_minus = -A * r\n    half = n // 2\n\n    noise_plus = rng.normal(0.0, sigma, size=(half, p))\n    noise_minus = rng.normal(0.0, sigma, size=(n - half, p))\n\n    data = np.vstack([mu_plus + noise_plus, mu_minus + noise_minus])\n    return data, r\n\ndef solve():\n    # Fixed latitude list in degrees (first 4 subtropics, last 4 subpolar)\n    lat_deg = np.array([30.0, 35.0, 40.0, 45.0, 55.0, 60.0, 65.0, 70.0])\n    lat_rad = lat_deg * np.pi / 180.0\n    w = np.cos(lat_rad)  # area weights\n    sqrt_w = np.sqrt(w)\n\n    # Define the test cases: (A in m, sigma in m, seed)\n    test_cases = [\n        (50.0, 10.0, 42),   # Case A: typical NAO signal\n        (80.0, 0.0, 123),   # Case B: noiseless boundary\n        (0.0, 5.0, 7),      # Case C: degenerate near-null signal\n    ]\n    n = 100\n    p = 8\n\n    results = []\n    for A, sigma, seed in test_cases:\n        rng = np.random.default_rng(seed)\n        data, r = generate_synthetic(n, p, A, sigma, rng)\n\n        # Scale features by sqrt(w) for weighted K-means\n        data_scaled = data * sqrt_w\n\n        # Run K-means in scaled space\n        centers_scaled, assignments, W, T, mean_scaled = kmeans_weighted(data_scaled, k=2, rng=rng)\n\n        # Map centroids back to original units (meters)\n        centers = centers_scaled / sqrt_w\n\n        # Compute explained variance E\n        E = 0.0 if T = 1e-15 else (1.0 - W / T)\n\n        # Label regimes using weighted projection onto r\n        # Weighted projection P(c, r) = sum_i w_i * c_i * r_i\n        projections = np.array([np.sum(w * centers[k] * r) for k in range(2)])\n        # NAO+ is centroid with larger projection\n        plus_idx = int(np.argmax(projections))\n        minus_idx = 1 - plus_idx\n        p_plus = projections[plus_idx]\n        p_minus = projections[minus_idx]\n        labeling_correct = (p_plus  0.0) and (p_minus  0.0)\n\n        # Append results: E rounded to three decimals, and labeling correctness\n        results.append(round(E, 3))\n        results.append(labeling_correct)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "当我们识别出NAO的模态并能用一个指数来追踪它后，一个对于预报至关重要的问题便是：它的可预报性有多强？本练习将使用一个简化但功能强大的模型来探讨NAO可预报性的基本极限。通过分析一阶自回归($AR(1)$)过程框架下的预报误差增长，我们可以定义一个理论上的可预报性期限——即预报技巧优于气候平均水平的时间范围。这项实践让你对可预报性理论有一个具体且可解析的理解，揭示了预报技巧如何随时间衰减，以及这种衰减如何依赖于系统内在的动力学特性，这是所有天气和气候预报的基石。",
            "id": "4101970",
            "problem": "考虑北大西洋涛动（NAO）指数的每日异常，该异常被建模为时间步长为一天的平稳一阶自回归（AR(1)）过程。设状态为 $x_t$，并假设其根据随机差分方程 $x_{t+1} = \\phi x_t + \\eta_t$ 演化，其中 $\\eta_t$ 是一个均值为零、序列不相关的创新项，其方差为 $\\sigma_{\\eta}^{2}$，且独立于 $x_t$。假设预报模型是完美的且无偏的，并且初始分析误差 $e_0 = x_0 - \\hat{x}_0$ 是均值为零的，独立于未来的创新项，其方差为 $\\mathcal{P}_0 = \\mathbb{E}[e_0^{2}]$。平稳 NAO 指数的气候方差定义为在平稳状态下的 $\\sigma_{x}^{2} = \\mathbb{E}[x_t^{2}]$。\n\n从这些定义和 AR(1) 模型的统计特性出发，推导 $k$ 步预报误差方差 $\\,\\mathcal{P}_k\\,$ 作为 $\\,\\phi\\,$, $\\,\\sigma_{\\eta}^{2}\\,$ 和 $\\,\\mathcal{P}_0\\,$ 的函数表达式，并推导平稳气候方差 $\\,\\sigma_{x}^{2}\\,$。然后，将可预报性时限 $\\,k^{\\star}\\,$ 定义为使预报误差方差等于气候方差的最小正整数 $k$，即 $\\mathcal{P}_k = \\sigma_{x}^{2}$。对于一个在日常时间尺度上序列依赖性可以忽略不计的每日 NAO 指数，假设 $\\,\\phi = 0\\,$ 并确定 $\\,k^{\\star}\\,$。用天数表示你对 $\\,k^{\\star}\\,$ 的最终答案。",
            "solution": "在进行求解之前，对问题陈述的有效性进行严格评估。\n\n### 第 1 步：提取已知条件\n- **过程模型**：北大西洋涛动（NAO）指数的每日异常 $x_t$ 被建模为平稳一阶自回归（AR(1)）过程。\n- **时间步长**：$1$ 天。\n- **状态演化方程**：$x_{t+1} = \\phi x_t + \\eta_t$。\n- **创新项**：$\\eta_t$ 是一个均值为零（$\\mathbb{E}[\\eta_t] = 0$）、序列不相关的创新项，其方差为 $\\sigma_{\\eta}^{2}$。它独立于状态 $x_t$。\n- **预报模型**：假设是完美的且无偏的。\n- **初始条件**：初始分析误差为 $e_0 = x_0 - \\hat{x}_0$，其均值为零（$\\mathbb{E}[e_0] = 0$），方差为 $\\mathcal{P}_0 = \\mathbb{E}[e_0^{2}]$。$e_0$ 独立于 $t \\ge 0$ 的未来创新项 $\\eta_t$。\n- **气候方差**：在平稳状态下，$\\sigma_{x}^{2} = \\mathbb{E}[x_t^{2}]$。\n- **预报误差方差**：$\\mathcal{P}_k$ 是 $k$ 步预报误差的方差。\n- **可预报性时限**：$k^{\\star}$ 被定义为使 $\\mathcal{P}_k = \\sigma_{x}^{2}$ 成立的最小正整数 $k$。\n- **特定条件**：对于最终计算，假设 $\\phi = 0$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题基础扎实。使用 AR(1) 过程对气候指数进行建模是气候科学中时间序列分析的一项标准和基础技术。预报误差方差、气候方差和可预报性时限等概念是天气和气候系统可预报性理论的核心。\n- **适定性**：该问题是适定的。它提供了推导所需量所需的所有必要定义和统计特性。目标陈述清晰，并能导出一个唯一的解。\n- **客观性**：该问题以精确、客观的数学语言陈述，不含任何主观或非科学的主张。\n\n该问题没有表现出任何无效性缺陷。它在科学上是合理的，形式上是明确的，并且内部是一致的。\n\n### 第 3 步：结论与行动\n该问题是有效的。我现在将进行推导和求解。\n\n该解答需要三个主要推导：平稳气候方差 $\\sigma_{x}^{2}$ 的表达式， $k$ 步预报误差方差 $\\mathcal{P}_k$ 的表达式，以及在特定条件 $\\phi = 0$ 下计算可预报性时限 $k^{\\star}$。\n\n**1. 气候方差 $\\sigma_{x}^{2}$ 的推导**\n\n过程 $x_t$ 假定是平稳的。在平稳状态下，统计矩是时不变的。具体来说，对于所有 $t$，均值 $\\mathbb{E}[x_t]$ 和方差 $\\mathbb{E}[x_t^2] - (\\mathbb{E}[x_t])^2$ 是恒定的。\n我们首先求过程的均值。对状态演化方程取期望：\n$$ \\mathbb{E}[x_{t+1}] = \\mathbb{E}[\\phi x_t + \\eta_t] = \\phi \\mathbb{E}[x_t] + \\mathbb{E}[\\eta_t] $$\n已知 $\\mathbb{E}[\\eta_t] = 0$，并且由于平稳性，$\\mathbb{E}[x_{t+1}] = \\mathbb{E}[x_t] = \\mu_x$：\n$$ \\mu_x = \\phi \\mu_x + 0 \\implies (1-\\phi)\\mu_x = 0 $$\n对于一个非平凡的平稳 AR(1) 过程，必须有 $|\\phi|  1$，这意味着 $1-\\phi \\neq 0$。因此，过程的均值必须为零：$\\mu_x = 0$。\n\n现在，我们计算方差 $\\sigma_x^2 = \\mathbb{E}[x_t^2]$（因为均值为零）。我们对状态演化方程的平方取期望：\n$$ \\mathbb{E}[x_{t+1}^2] = \\mathbb{E}[(\\phi x_t + \\eta_t)^2] = \\mathbb{E}[\\phi^2 x_t^2 + 2\\phi x_t \\eta_t + \\eta_t^2] $$\n利用期望的线性性质：\n$$ \\mathbb{E}[x_{t+1}^2] = \\phi^2 \\mathbb{E}[x_t^2] + 2\\phi \\mathbb{E}[x_t \\eta_t] + \\mathbb{E}[\\eta_t^2] $$\n由于平稳性，$\\mathbb{E}[x_{t+1}^2] = \\mathbb{E}[x_t^2] = \\sigma_x^2$。我们已知 $\\mathbb{E}[\\eta_t^2] = \\sigma_{\\eta}^2$。创新项 $\\eta_t$ 独立于状态 $x_t$，而 $x_t$ 由过去的创新项 $\\{\\eta_{t-1}, \\eta_{t-2}, ...\\}$ 决定。因此，$\\mathbb{E}[x_t \\eta_t] = \\mathbb{E}[x_t]\\mathbb{E}[\\eta_t] = 0 \\times 0 = 0$。\n将这些代回方程中：\n$$ \\sigma_x^2 = \\phi^2 \\sigma_x^2 + 0 + \\sigma_{\\eta}^2 $$\n求解 $\\sigma_x^2$：\n$$ \\sigma_x^2(1 - \\phi^2) = \\sigma_{\\eta}^2 \\implies \\sigma_x^2 = \\frac{\\sigma_{\\eta}^2}{1 - \\phi^2} $$\n\n**2. 预报误差方差 $\\mathcal{P}_k$ 的推导**\n\n$k$ 时间步的预报误差为 $e_k = x_k - \\hat{x}_k$。预报模型是完美的，意味着它使用与真实系统相同的动力学。基于时间 $t$ 的分析对时间 $t+1$ 的预报是 $\\hat{x}_{t+1} = \\phi \\hat{x}_t$，因为未来的创新项 $\\eta_t$ 是未知的。\n误差根据以下方式演化：\n$$ e_{t+1} = x_{t+1} - \\hat{x}_{t+1} = (\\phi x_t + \\eta_t) - (\\phi \\hat{x}_t) = \\phi (x_t - \\hat{x}_t) + \\eta_t = \\phi e_t + \\eta_t $$\n我们可以递归地展开这个关系，用初始误差 $e_0$ 和创新项序列来表示 $k$ 步预报误差 $e_k$。一个 $k$ 步的预报是从时间 $t=0$ 开始的。\n$$ e_1 = \\phi e_0 + \\eta_0 $$\n$$ e_2 = \\phi e_1 + \\eta_1 = \\phi(\\phi e_0 + \\eta_0) + \\eta_1 = \\phi^2 e_0 + \\phi \\eta_0 + \\eta_1 $$\n通过归纳法， $k$ 步后的误差为：\n$$ e_k = \\phi^k e_0 + \\sum_{j=0}^{k-1} \\phi^{k-1-j} \\eta_j $$\n$k$ 步预报误差方差是 $\\mathcal{P}_k = \\mathbb{E}[e_k^2]$。\n$$ \\mathcal{P}_k = \\mathbb{E}\\left[ \\left(\\phi^k e_0 + \\sum_{j=0}^{k-1} \\phi^{k-1-j} \\eta_j\\right)^2 \\right] $$\n$$ \\mathcal{P}_k = \\mathbb{E}\\left[ \\phi^{2k} e_0^2 + 2\\phi^k e_0 \\sum_{j=0}^{k-1} \\phi^{k-1-j} \\eta_j + \\left(\\sum_{j=0}^{k-1} \\phi^{k-1-j} \\eta_j\\right)^2 \\right] $$\n我们使用期望的线性性质分析每一项：\n- 第 1 项：$\\mathbb{E}[\\phi^{2k} e_0^2] = \\phi^{2k} \\mathbb{E}[e_0^2] = \\phi^{2k} \\mathcal{P}_0$。\n- 第 2 项：交叉项。初始误差 $e_0$ 独立于所有 $j\\ge0$ 的未来创新项 $\\eta_j$。由于 $\\mathbb{E}[\\eta_j] = 0$，交叉项的期望为零：$\\mathbb{E}[e_0 \\eta_j] = \\mathbb{E}[e_0]\\mathbb{E}[\\eta_j] = 0 \\times 0 = 0$。\n- 第 3 项：创新项之和的方差。创新项 $\\eta_j$ 是序列不相关的，所以 $\\mathbb{E}[\\eta_i \\eta_j] = \\sigma_{\\eta}^2 \\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克 δ 函数。\n$$ \\mathbb{E}\\left[ \\left(\\sum_{j=0}^{k-1} \\phi^{k-1-j} \\eta_j\\right)^2 \\right] = \\sum_{i=0}^{k-1} \\sum_{j=0}^{k-1} \\phi^{k-1-i} \\phi^{k-1-j} \\mathbb{E}[\\eta_i \\eta_j] = \\sum_{j=0}^{k-1} (\\phi^{k-1-j})^2 \\sigma_{\\eta}^2 $$\n这是一个几何级数：$\\sigma_{\\eta}^2 \\sum_{j=0}^{k-1} (\\phi^2)^{k-1-j}$。令 $m = k-1-j$。当 $j$ 从 $0$ 变为 $k-1$ 时，$m$ 从 $k-1$ 变为 $0$。\n$$ \\sigma_{\\eta}^2 \\sum_{m=0}^{k-1} (\\phi^2)^m = \\sigma_{\\eta}^2 \\frac{1 - (\\phi^2)^k}{1 - \\phi^2} = \\sigma_{\\eta}^2 \\frac{1 - \\phi^{2k}}{1 - \\phi^2} $$\n合并各项，预报误差方差为：\n$$ \\mathcal{P}_k = \\phi^{2k} \\mathcal{P}_0 + \\sigma_{\\eta}^2 \\frac{1 - \\phi^{2k}}{1 - \\phi^2} $$\n\n**3. 在 $\\phi=0$ 条件下确定可预报性时限 $k^{\\star}$**\n\n问题要求在序列依赖性可以忽略不计的特定情况下（即 $\\phi=0$）找到可预报性时限 $k^{\\star}$。\n首先，我们将 $\\phi=0$ 代入气候方差 $\\sigma_x^2$ 的表达式中：\n$$ \\sigma_x^2 = \\frac{\\sigma_{\\eta}^2}{1 - 0^2} = \\sigma_{\\eta}^2 $$\n这是合乎逻辑的：如果过程没有记忆性，其方差就是每一步随机强迫的方差。\n\n接下来，我们计算 $\\phi=0$ 时的预报误差方差 $\\mathcal{P}_k$。对于任何正整数 $k \\ge 1$：\n$$ \\mathcal{P}_k = 0^{2k} \\mathcal{P}_0 + \\sigma_{\\eta}^2 \\frac{1 - 0^{2k}}{1 - 0^2} = 0 \\cdot \\mathcal{P}_0 + \\sigma_{\\eta}^2 \\frac{1 - 0}{1} = \\sigma_{\\eta}^2 $$\n所以，对于 $\\phi=0$，预报误差方差 $\\mathcal{P}_k$ 对所有 $k \\ge 1$ 都等于 $\\sigma_{\\eta}^2$。\n\n可预报性时限 $k^{\\star}$ 定义为使 $\\mathcal{P}_k = \\sigma_x^2$ 成立的最小正整数 $k$。使用我们在 $\\phi=0$ 情况下的结果：\n$$ \\mathcal{P}_k = \\sigma_{\\eta}^2 $$\n$$ \\sigma_x^2 = \\sigma_{\\eta}^2 $$\n条件 $\\mathcal{P}_k = \\sigma_x^2$ 变为 $\\sigma_{\\eta}^2 = \\sigma_{\\eta}^2$。这个等式对任何 $k \\ge 1$ 都成立。问题要求的是使此式成立的*最小正整数* $k$。最小的正整数是 $1$。\n\n因此，可预报性时限是 $k^{\\star} = 1$。这意味着对于一个没有逐日记忆的过程，任何超过一天的预报都不比气候学平均更好。预报技巧在一个时间步长（即一天）后就消失了。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在业务化预报中，核心任务之一是生成对当前大气状态尽可能最准确的描述，这需要将不完美的模式预报与稀疏且带有噪声的观测资料相融合。本练习便针对NAO指数模拟了这一核心过程。贝叶斯数据同化为此提供了一个严谨的数学框架，用于最优地结合先验知识（模式预报）和新的证据（观测），最终生成的“后验”或“分析”状态，其准确性会优于任何单一来源。这项实践让你能够亲手操作数据同化的基本方程（通常称为卡尔曼更新），从而深入理解在现代数值天气预报和再分析系统中，模式与观测是如何被综合利用的。",
            "id": "4101919",
            "problem": "一个用于北大西洋涛动 (NAO) 指数的气候数据同化系统，在一个数值天气预报 (NWP) 模型中嵌入了一个一维线性高斯分析步。状态变量是 NAO 指数，记为 $x$；单一观测值是由标准化海平面气压偶极子构建的 NAO 指数代理变量，记为 $y$。观测算子是一个已知的线性灵敏度 $H \\in \\mathbb{R}$，使得观测模型为 $y = H x + \\epsilon$，其中观测误差 $\\epsilon$ 是均值为零、方差为 $R$ 的高斯分布。$x$ 的背景（先验）分布是均值为 $x^b$、方差为 $B$ 的高斯分布，其中 $B0$ 且 $R0$。\n\n从贝叶斯线性高斯框架（在线性情况下等价于最佳线性无偏估计）出发，推导 NAO 指数的最优标量分析增量，该增量定义为后验（分析）均值与先验均值之差，即 $\\delta I \\equiv x^a - x^b$。请用新息 $(y - H x^b)$以及背景和观测的误差方差来表示该增量。在您的推导过程中明确指出标量增益 $K$。\n\n然后，使用以下科学上合理的特定值对该增量进行数值计算：\n- $x^b = 0.5$ (无量纲 NAO 指数),\n- $y = 1.2$ (无量纲),\n- $H = 0.8$,\n- $B = 1.0$ (无量纲的平方),\n- $R = 0.25$ (无量纲的平方).\n\n将增量 $\\delta I$ 的数值以纯数（无量纲）形式报告，并将您的答案四舍五入到四位有效数字。",
            "solution": "首先对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- 状态变量：NAO 指数，$x$。\n- 观测值：NAO 指数代理变量，$y$。\n- $x$ 的背景（先验）分布：均值为 $x^b$、方差为 $B$ 的高斯分布。$p(x) = \\mathcal{N}(x; x^b, B)$。\n- 观测模型：$y = H x + \\epsilon$。\n- 观测算子：一个已知的线性灵敏度 $H \\in \\mathbb{R}$。\n- 观测误差 $\\epsilon$：均值为零、方差为 $R$ 的高斯分布。$\\epsilon \\sim \\mathcal{N}(0, R)$。\n- 约束条件：$B0$, $R0$。\n- 分析增量的定义：$\\delta I \\equiv x^a - x^b$，其中 $x^a$ 是后验（分析）均值。\n- 任务1：用新息 $(y - H x^b)$ 和误差方差 $B$、$R$ 表示 $\\delta I$，并明确指出增益 $K$。\n- 任务2：对 $\\delta I$ 进行数值计算。\n- 数值：\n    - $x^b = 0.5$\n    - $y = 1.2$\n    - $H = 0.8$\n    - $B = 1.0$\n    - $R = 0.25$\n- 精度要求：将数值答案四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一维贝叶斯数据同化，这是数值天气预报和气候模拟中的一项基础且广泛使用的技术（具体来说，是卡尔曼滤波更新或三维变分分析的标量形式）。NAO 指数是一个真实且重要的气候模式。使用线性观测算子和高斯误差统计是许多业务系统中标准且有效的简化假设。所提供的数值对于一个标准化气候指数而言在物理上是合理的。该问题基于统计估计和大气科学的既定原则。\n- **适定性**：该问题是适定的。对于给定的线性高斯模型，存在后验均值和方差的唯一解析解。问题提供了计算分析增量的单一、唯一数值所需的所有信息（$x^b, y, H, B, R$）。\n- **客观性**：该问题以精确、客观的数学和科学语言陈述。它不包含主观或基于观点的陈述。\n- **完整性与一致性**：该问题是自成体系且内部一致的。所有需要的变量和参数都已定义，没有给出矛盾的信息。约束条件 $B0$ 和 $R0$ 确保了概率分布是良定义的。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。它在科学上是合理的、适定的、客观的且完整的。我将继续提供完整解答。\n\n问题要求在贝叶斯线性高斯框架内推导最优标量分析增量。根据贝叶斯定理，给定观测值 $y$ 的状态 $x$ 的后验概率分布（记为 $p(x|y)$）与似然函数和先验分布的乘积成正比：\n$$p(x|y) \\propto p(y|x) p(x)$$\n状态 $x$ 的先验分布是均值为 $x^b$、方差为 $B$ 的高斯分布：\n$$p(x) = \\frac{1}{\\sqrt{2\\pi B}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x^b)^2}{B}\\right)$$\n观测模型为 $y = Hx + \\epsilon$，其中观测误差 $\\epsilon$ 服从均值为零、方差为 $R$ 的高斯分布，即 $\\epsilon \\sim \\mathcal{N}(0, R)$。这意味着在给定状态 $x$ 的情况下观测到 $y$ 的似然函数也是一个高斯分布，其均值为 $Hx$，方差为 $R$：\n$$p(y|x) = \\frac{1}{\\sqrt{2\\pi R}} \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right)$$\n结合以上两点，后验分布为：\n$$p(x|y) \\propto \\exp\\left(-\\frac{1}{2} \\frac{(x - x^b)^2}{B}\\right) \\exp\\left(-\\frac{1}{2} \\frac{(y - Hx)^2}{R}\\right) = \\exp\\left(-\\frac{1}{2}\\left[\\frac{(x - x^b)^2}{B} + \\frac{(y - Hx)^2}{R}\\right]\\right)$$\n对于高斯后验分布，其均值（分析状态 $x^a$）对应于其众数，即最大化后验概率的 $x$ 值。最大化 $p(x|y)$ 等价于最小化其对数的负值。我们将代价函数 $J(x)$ 定义为指数部分参数的负二倍：\n$$J(x) = \\frac{(x - x^b)^2}{B} + \\frac{(y - Hx)^2}{R}$$\n为了找到 $J(x)$ 的最小值，我们对其求关于 $x$ 的导数，并令其为零。满足此条件的 $x$ 值即为分析均值 $x^a$。\n$$\\frac{dJ}{dx} = \\frac{2(x - x^b)}{B} + \\frac{2(y - Hx)(-H)}{R} = 0$$\n令 $x = x^a$ 并化简：\n$$\\frac{x^a - x^b}{B} - \\frac{H(y - Hx^a)}{R} = 0$$\n$$\\frac{x^a - x^b}{B} = \\frac{Hy - H^2x^a}{R}$$\n现在，我们求解 $x^a$：\n$$R(x^a - x^b) = B(Hy - H^2x^a)$$\n$$Rx^a - Rx^b = BHy - BH^2x^a$$\n$$Rx^a + BH^2x^a = Rx^b + BHy$$\n$$x^a(R + BH^2) = Rx^b + BHy$$\n$$x^a = \\frac{Rx^b + BHy}{R + BH^2}$$\n问题要求的是分析增量 $\\delta I = x^a - x^b$。我们可以对 $x^a$ 的表达式进行变换，以得到包含新息项 $(y - Hx^b)$ 的所需形式。\n$$x^a = x^b + (x^a - x^b)$$\n$$\\delta I = x^a - x^b = \\frac{Rx^b + BHy}{R + BH^2} - x^b$$\n$$\\delta I = \\frac{Rx^b + BHy - x^b(R + BH^2)}{R + BH^2}$$\n$$\\delta I = \\frac{Rx^b + BHy - Rx^b - BH^2x^b}{R + BH^2}$$\n$$\\delta I = \\frac{BHy - BH^2x^b}{R + BH^2}$$\n在分子中提取公因式，得到增量的最终形式：\n$$\\delta I = \\left(\\frac{BH}{R + BH^2}\\right) (y - Hx^b)$$\n此表达式用新息 $(y - Hx^b)$ 和一个系数项定义了分析增量 $\\delta I$。该系数就是最优标量增益，我们将其确定为 $K$：\n$$K = \\frac{BH}{R + BH^2}$$\n因此，分析增量为 $\\delta I = K(y - Hx^b)$，分析更新方程为 $x^a = x^b + K(y - Hx^b)$。\n\n现在，我们用给定的数值对该表达式进行数值计算：\n- $x^b = 0.5$\n- $y = 1.2$\n- $H = 0.8$\n- $B = 1.0$\n- $R = 0.25$\n\n首先，计算新息项 $(y - Hx^b)$：\n$$y - Hx^b = 1.2 - (0.8)(0.5) = 1.2 - 0.4 = 0.8$$\n接下来，计算标量增益 $K$：\n$$K = \\frac{BH}{R + BH^2} = \\frac{(1.0)(0.8)}{0.25 + (1.0)(0.8)^2} = \\frac{0.8}{0.25 + 0.64} = \\frac{0.8}{0.89}$$\n最后，计算分析增量 $\\delta I$：\n$$\\delta I = K(y - Hx^b) = \\left(\\frac{0.8}{0.89}\\right)(0.8) = \\frac{0.64}{0.89}$$\n$$\\delta I \\approx 0.71910112359...$$\n四舍五入到四位有效数字，增量的数值为 $0.7191$。",
            "answer": "$$\\boxed{0.7191}$$"
        }
    ]
}