{
    "hands_on_practices": [
        {
            "introduction": "临界慢化是系统接近临界点时的一个核心特征，表现为系统从扰动中恢复的速度变慢。这个练习将理论与实践相结合，让你通过一个关键的预警信号——滞后-1自相关系数（$\\rho_1$）的增加，来量化计算系统物理恢复时间（$\\tau$）的变化 。通过这个计算，你将具体地理解自相关性增强如何直接反映系统稳定性的减弱。",
            "id": "4033204",
            "problem": "在数值天气预报 (NWP) 和气候模拟中，一个接近稳定平衡的气候子系统可以局部地用带随机强迫的线性弛豫动力学来近似，这在连续时间内被建模为Ornstein–Uhlenbeck (OU) 过程。在此近似下，e-折恢复时间 $\\tau$ 表征了扰动衰减回平衡状态的速率。对于以离散时间间隔 $\\Delta t$ 采样的时间序列，其采样序列相应的滞后一阶自相关系数 $\\rho_1$ 与连续时间衰减通过恒等式 $\\rho_1 = \\exp(-\\Delta t/\\tau)$ 相关联，这意味着 $\\tau = -\\Delta t/\\ln \\rho_1$。在针对临界转变的预警信号分析中，$\\rho_1$ 的增加表示临界慢化和 $\\tau$ 的增长。\n\n考虑一个日分辨率的气候指数时间序列（$\\Delta t = 1$ 天），由于缓慢的外部强迫，其估计的滞后一阶自相关系数 $\\rho_1(t)$ 随时间近似线性增加：$\\rho_1(t) \\approx \\rho_{1,0} + s t$，其中 $t$ 的单位是年，$\\rho_{1,0} = 0.95$，趋势 $s = 0.004\\,\\text{year}^{-1}$ 在 $T = 10$ 年内持续均匀。假设在整个区间内 $0  \\rho_1(t)  1$，这与一阶平穩自回归 (AR(1)) 模型一致。\n\n使用关系式 $\\tau = -\\Delta t/\\ln \\rho_1$，计算在 $T = 10$ 年内e-折恢复时间的预期变化 $\\Delta \\tau = \\tau(T) - \\tau(0)$。请用天数表示你的最终答案，并四舍五入到四位有效数字。",
            "solution": "对问题陈述进行验证。\n\n第一步：提取已知条件\n- e-折恢复时间 $τ$、滞后一阶自相关系数 $ρ_1$ 和采样间隔 $Δt$ 之间的关系由 $ρ_1 = \\exp(-\\Delta t/\\tau)$ 给出，这意味着 $τ = -\\Delta t/\\ln ρ_1$。\n- 时间序列是日分辨率的，所以采样间隔为 $Δt = 1$ 天。\n- 滞后一阶自相关系数 $ρ_1$ 根据线性模型 $ρ_1(t) \\approx ρ_{1,0} + s t$ 随时间 $t$（单位为年）变化。\n- $t=0$ 时的初始自相关为 $ρ_{1,0} = 0.95$。\n- 自相关的趋势为 $s = 0.004\\,\\text{year}^{-1}$。\n- 需要计算变化的总时长为 $T = 10$ 年。\n- 提供了一个假设：在分析期间 $0  ρ_1(t)  1$。\n- 目标是计算e-折恢复时间的变化量 $Δτ = τ(T) - τ(0)$，并以天为单位表示结果，四舍五入到四位有效数字。\n\n第二步：使用提取的已知条件进行验证\n- **科学依据**：该问题基于已确立的临界转变预警信号理论，特别是临界慢化概念。Ornstein-Uhlenbeck过程是随机强迫线性系统的典型模型，其连续时间衰减率与离散时间自相关之间的关系是标准且正确的。应用于气候模拟是恰当且现实的。\n- **适定性**：该问题提供了所有必要的参数和一个明确的目标。可以通过直接计算确定唯一解。\n- **客观性**：问题陈述使用了精确、定量和无偏见的语言。\n- **完整性与一致性**：问题是自洽的。单位是一致的：$ρ_1(t)$ 是无量纲的，因为 $ρ_{1,0}$ 是无量纲的，并且乘积 $st$ 的单位是 $(\\text{year}^{-1}) \\times (\\text{year})$，也是无量纲的。$τ$ 的公式将产生一个以 $Δt$ 的单位（天）为单位的结果，这与最终答案的要求相符。检查了假设 $0  ρ_1(t)  1$：在 $t=0$ 时，$ρ_1(0) = 0.95$；在 $t=T=10$ 时，$ρ_1(10) = 0.95 + 0.004 \\times 10 = 0.99$。由于 $ρ_1(t)$ 是 $t$ 的线性函数，它在 $[0, 10]$ 的所有 $t$ 值上都保持在区间 $(0, 1)$ 内。\n- **其他缺陷**：该问题并非不切实际、不适定、微不足道或无法验证。\n\n第三步：结论与行动\n问题有效。将推導解答。\n\ne-折恢复时间 $τ$ 作为滞后一阶自相关系数 $ρ_1$ 的函数给出：\n$$ \\tau(\\rho_1) = -\\frac{\\Delta t}{\\ln \\rho_1} $$\n滞后一阶自相关系数 $ρ_1$ 本身是时间 $t$ 的函数：\n$$ \\rho_1(t) = \\rho_{1,0} + s t $$\n因此，恢复时间 $τ$作为时间 $t$ 的函数可以写成：\n$$ \\tau(t) = -\\frac{\\Delta t}{\\ln(\\rho_{1,0} + s t)} $$\n目标是计算从 $t=0$ 到 $t=T$ 的区间内恢复时间的变化量 $Δτ$。\n$$ \\Delta\\tau = \\tau(T) - \\tau(0) $$\n\n首先，我们计算初始时间 $t=0$ 时的恢复时间。\n$t=0$ 时的自相关是：\n$$ \\rho_1(0) = \\rho_{1,0} + s(0) = \\rho_{1,0} = 0.95 $$\n相应的恢复时间是：\n$$ \\tau(0) = -\\frac{\\Delta t}{\\ln(\\rho_1(0))} = -\\frac{\\Delta t}{\\ln(0.95)} $$\n\n接下来，我们计算最终时间 $t=T=10$ 年时的恢复时间。\n$t=10$ 时的自相关是：\n$$ \\rho_1(10) = \\rho_{1,0} + sT = 0.95 + (0.004 \\,\\text{year}^{-1})(10 \\,\\text{years}) = 0.95 + 0.04 = 0.99 $$\n相应的恢复时间是：\n$$ \\tau(10) = -\\frac{\\Delta t}{\\ln(\\rho_1(10))} = -\\frac{\\Delta t}{\\ln(0.99)} $$\n\n现在，我们计算变化量 $Δτ$：\n$$ \\Delta\\tau = \\tau(10) - \\tau(0) = \\left(-\\frac{\\Delta t}{\\ln(0.99)}\\right) - \\left(-\\frac{\\Delta t}{\\ln(0.95)}\\right) $$\n$$ \\Delta\\tau = \\Delta t \\left( \\frac{1}{\\ln(0.95)} - \\frac{1}{\\ln(0.99)} \\right) $$\n已知采样间隔为 $Δt = 1$ 天。代入此值：\n$$ \\Delta\\tau = (1 \\text{ day}) \\left( \\frac{1}{\\ln(0.95)} - \\frac{1}{\\ln(0.99)} \\right) $$\n为了获得数值，我们使用参数的自然对数：\n$$ \\ln(0.95) \\approx -0.05129329438 $$\n$$ \\ln(0.99) \\approx -0.01005033585 $$\n让我们先计算各个恢复时间，因为这说明了“慢化”的物理意义。\n$$ \\tau(0) = -\\frac{1}{\\ln(0.95)} \\approx -\\frac{1}{-0.05129329} \\approx 19.49576 \\text{ days} $$\n$$ \\tau(10) = -\\frac{1}{\\ln(0.99)} \\approx -\\frac{1}{-0.01005034} \\approx 99.49916 \\text{ days} $$\n变化量 $Δτ$ 是这两个值之间的差：\n$$ \\Delta\\tau = \\tau(10) - \\tau(0) \\approx 99.49916 - 19.49576 \\approx 80.0034 \\text{ days} $$\n问题要求最终答案四舍五入到四位有效数字。数值 $80.0034$ 的有效数字超过四位。前四位是 $8$、$0$、$0$ 和 $0$。第五位是 $3$，小于 $5$，因此我们向下取整。\n$$ \\Delta\\tau \\approx 80.00 \\text{ days} $$\n在 $10$ 年期间，e-折恢复时间的预期变化为 $80.00$ 天。",
            "answer": "$$\n\\boxed{80.00}\n$$"
        },
        {
            "introduction": "在分析气候等真实世界系统时，一个核心挑战是如何区分内部动力学变化与外部强迫引起的长期趋势。这个练习揭示了一个常见的陷阱：一个简单的线性趋势可能会在统计上模仿临界慢化的信号，导致错误的预警 。通过推导这种趋势引起的偏差，你将深刻理解在进行预警信号分析前，进行去趋势化处理为何是至关重要的一步。",
            "id": "4033195",
            "problem": "考虑一个用于数值天气预报和气候模拟的强迫气候时间序列，其中可观测量（例如全球平均地表温度异常）是一个确定性强迫响应和内部变率之和。设可观测量建模为 $y_{t} = \\mu_{0} + \\beta t + x_{t}$，其中 $t = 1, 2, \\dots, N$，$\\mu_{0}$ 是一个常数，$\\beta$ 是由外部强迫引起的恒定线性趋势，而 $x_{t}$ 是一个零均值平稳一阶自回归过程 $\\mathrm{AR}(1)$，满足 $x_{t} = \\phi x_{t-1} + \\varepsilon_{t}$，其中 $|\\phi|  1$，$\\varepsilon_{t}$ 是方差为 $\\sigma_{\\varepsilon}^{2}$ 的独立同分布高斯噪声。将 $x_{t}$ 的平稳方差记为 $\\sigma_{x}^{2}$。\n\n针对临界转换的早期预警信号 (EWS) 通常监测滞后1阶自相关（此处记为 $\\rho_{1}$）的变化。在实际操作中，$\\rho_{1}$ 的一个常用估计量是通过移除均值但未去趋势的序列计算得出的：\n$$\n\\hat{\\rho}_{1} \\equiv \\frac{\\sum_{t=2}^{N} \\left(y_{t} - \\bar{y}\\right)\\left(y_{t-1} - \\bar{y}\\right)}{\\sum_{t=1}^{N} \\left(y_{t} - \\bar{y}\\right)^{2}},\n$$\n其中 $\\bar{y} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} y_{t}$ 是样本均值。假设 $x_{t}$ 独立于确定性趋势分量，且 $N \\geq 4$。\n\n从上述定义以及 $\\mathrm{AR}(1)$ 过程和确定性序列时间平均的标准性质出发，推导当线性趋势被忽略时 $\\hat{\\rho}_{1}$ 的大样本期望偏差的闭式解析表达式，该偏差定义为 $\\mathrm{Bias} \\equiv \\mathbb{E}[\\hat{\\rho}_{1}] - \\phi$，并用 $N$、$\\beta$、$\\phi$ 和 $\\sigma_{x}^{2}$ 表示。在推导中，使用领头阶大 N 近似 $\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} \\left(x_{t} - \\bar{x}\\right)^{2}\\right] \\approx N \\sigma_{x}^{2}$ 和 $\\mathbb{E}\\!\\left[\\sum_{t=2}^{N} \\left(x_{t} - \\bar{x}\\right)\\left(x_{t-1} - \\bar{x}\\right)\\right] \\approx (N-1)\\phi \\sigma_{x}^{2}$，其中 $\\bar{x} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} x_{t}$。此外，对线性确定性分量使用精确的闭式求和。\n\n基于你的推导，简要解释为什么在强迫气候系统中，去趋势对于 EWS 检测是至关重要的。将最终偏差表示为单个闭式解析表达式。最终答案无需四舍五入，也无需单位。",
            "solution": "可观测量为 $y_{t} = m_{t} + x_{t}$，其中确定性均值为 $m_{t} \\equiv \\mu_{0} + \\beta t$，随机变率为 $x_{t}$。滞后1阶自相关的估计量为\n$$\n\\hat{\\rho}_{1} = \\frac{\\sum_{t=2}^{N} \\left[(m_{t}-\\bar{m}) + (x_{t}-\\bar{x})\\right]\\left[(m_{t-1}-\\bar{m}) + (x_{t-1}-\\bar{x})\\right]}{\\sum_{t=1}^{N} \\left[(m_{t}-\\bar{m}) + (x_{t}-\\bar{x})\\right]^{2}},\n$$\n其中 $\\bar{m} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} m_{t}$ 且 $\\bar{x} \\equiv \\frac{1}{N}\\sum_{t=1}^{N} x_{t}$。由于 $m_{t}$ 是确定性的且独立于 $x_{t}$，对随机分量求期望会消除形如 $(m_{t}-\\bar{m})(x_{t-1}-\\bar{x})$ 和 $(x_{t}-\\bar{x})(m_{t-1}-\\bar{m})$ 的交叉项，得到\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (y_{t}-\\bar{y})(y_{t-1}-\\bar{y})\\right] = \\sum_{t=2}^{N} (m_{t}-\\bar{m})(m_{t-1}-\\bar{m}) + \\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (x_{t}-\\bar{x})(x_{t-1}-\\bar{x})\\right],\n$$\n和\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (y_{t}-\\bar{y})^{2}\\right] = \\sum_{t=1}^{N} (m_{t}-\\bar{m})^{2} + \\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (x_{t}-\\bar{x})^{2}\\right].\n$$\n\n我们精确计算确定性求和。线性序列 $m_{t} = \\mu_{0} + \\beta t$ 的样本均值为 $\\bar{m} = \\mu_{0} + \\beta \\frac{N+1}{2}$。定义中心化确定性序列\n$$\nd_{t} \\equiv m_{t} - \\bar{m} = \\beta\\left(t - \\frac{N+1}{2}\\right).\n$$\n则\n$$\n\\sum_{t=1}^{N} d_{t}^{2} = \\beta^{2} \\sum_{t=1}^{N} \\left(t - \\frac{N+1}{2}\\right)^{2} = \\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12},\n$$\n这是整数 $1,\\dots,N$ 离均差平方和的一个标准结果。\n\n对于滞后1阶确定性协方差和，注意\n$$\nd_{t}\\,d_{t-1} = \\beta^{2}\\left(t-\\frac{N+1}{2}\\right)\\left[(t-1)-\\frac{N+1}{2}\\right] = \\beta^{2}\\left[\\left(t-\\frac{N+1}{2}\\right)^{2} - \\left(t-\\frac{N+1}{2}\\right)\\right].\n$$\n因此，\n\\begin{align*}\n\\sum_{t=2}^{N} d_{t}\\,d_{t-1}\n= \\beta^{2}\\left[\\sum_{t=2}^{N} \\left(t-\\frac{N+1}{2}\\right)^{2} - \\sum_{t=2}^{N} \\left(t-\\frac{N+1}{2}\\right)\\right] \\\\\n= \\beta^{2}\\left[\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right)^{2} - \\left(1-\\frac{N+1}{2}\\right)^{2} - \\left(\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right) - \\left(1-\\frac{N+1}{2}\\right)\\right)\\right].\n\\end{align*}\n由于 $\\sum_{t=1}^{N} \\left(t-\\frac{N+1}{2}\\right) = 0$，第二个括号简化为 $+\\left(1-\\frac{N+1}{2}\\right)$。使用 $\\left(1-\\frac{N+1}{2}\\right) = -\\frac{N-1}{2}$ 和 $\\left(1-\\frac{N+1}{2}\\right)^{2} = \\frac{(N-1)^{2}}{4}$，我们得到\n\\begin{align*}\n\\sum_{t=2}^{N} d_{t}\\,d_{t-1}\n= \\beta^{2}\\left[\\frac{N\\left(N^{2}-1\\right)}{12} - \\frac{(N-1)^{2}}{4} - \\frac{N-1}{2}\\right] \\\\\n= \\beta^{2}\\left[\\frac{N\\left(N^{2}-1\\right)}{12} - \\frac{N^{2}-1}{4}\\right] \\\\\n= \\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12}.\n\\end{align*}\n\n接下来，我们对随机和使用大N期望。对于滞后1阶自相关为 $\\phi$、平稳方差为 $\\sigma_{x}^{2}$ 的 $\\mathrm{AR}(1)$ 过程，领头阶近似为\n$$\n\\mathbb{E}\\!\\left[\\sum_{t=1}^{N} (x_{t}-\\bar{x})^{2}\\right] \\approx N\\,\\sigma_{x}^{2}, \\qquad \\mathbb{E}\\!\\left[\\sum_{t=2}^{N} (x_{t}-\\bar{x})(x_{t-1}-\\bar{x})\\right] \\approx (N-1)\\,\\phi\\,\\sigma_{x}^{2}.\n$$\n\n结合确定性和随机性贡献，$\\hat{\\rho}_{1}$ 的期望分子和分母分别为\n\\begin{align*}\n\\mathbb{E}[\\text{num}] = \\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}, \\\\\n\\mathbb{E}[\\text{den}] = \\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}.\n\\end{align*}\n因此，\n$$\n\\mathbb{E}[\\hat{\\rho}_{1}] \\approx \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}}.\n$$\n相对于真实滞后1阶自相关 $\\phi$ 的偏差为\n\\begin{align*}\n\\mathrm{Bias} \\equiv \\mathbb{E}[\\hat{\\rho}_{1}] - \\phi\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}} - \\phi \\\\\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)(N-3)}{12} - \\phi\\,\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + (N-1)\\,\\phi\\,\\sigma_{x}^{2} - \\phi\\,N\\,\\sigma_{x}^{2}}{\\beta^{2}\\,\\frac{N\\left(N^{2}-1\\right)}{12} + N\\,\\sigma_{x}^{2}} \\\\\n= \\frac{\\beta^{2}\\,\\frac{(N^{2}-1)}{12}\\left[(N-3) - \\phi N\\right] - \\phi\\,\\sigma_{x}^{2}}{N\\left(\\beta^{2}\\,\\frac{(N^{2}-1)}{12} + \\sigma_{x}^{2}\\right)}.\n\\end{align*}\n\n这个表达式清楚地说明了为什么在强迫气候系统中，去趋势对于早期预警信号检测是至关重要的。随着 $|\\beta|$ 增加或 $N$ 增大，确定性趋势对分子和分母都有很强的贡献。在确定性趋势主导方差的极限情况下（即 $\\beta^{2}\\,\\frac{(N^{2}-1)}{12} \\gg \\sigma_{x}^{2}$），期望估计量趋近于确定性比率 $\\frac{(N-3)}{N}$，对于大 $N$ 来说，这个值接近 $1$，即使真实的 $\\phi$ 值不大，也会错误地发出临界慢化的信号。去趋势移除了确定性贡献，恢复了仅由内部变率引起的 $\\rho_{1}$ 的无偏估计，并防止了由外部强迫而非接近动力学临界转换所驱动的虚假 EWS 检测。",
            "answer": "$$\\boxed{\\frac{\\beta^{2}\\,\\frac{(N^{2}-1)}{12}\\left[(N-3) - \\phi N\\right] - \\phi\\,\\sigma_{x}^{2}}{N\\left(\\beta^{2}\\,\\frac{(N^{2}-1)}{12} + \\sigma_{x}^{2}\\right)}}$$"
        },
        {
            "introduction": "仅仅观察到自相关性的上升趋势是不够的，我们还必须检验其统计显著性，以避免将随机波动误判为预警信号。这个练习将带你从理论走向计算统计实践，指导你使用代理数据（surrogate data）构建一个稳健的假设检验框架 。掌握此方法能有效控制误报率，是确保预警信号分析可靠性的关键技能。",
            "id": "4033207",
            "problem": "您的任务是实现一个数值实验，以量化在平稳有色噪声的原假设下，检测滞后-1自相关中递增趋势的假阳性率。滞后-1自相关是气候建模和数值天气预报中常用的预警信号。检测过程必须使用通过相位随机化生成的代理数据，为趋势统计量构建一个非参数零分布。\n\n请基于以下经过充分检验的定义和事实开展工作：\n- 一个平稳的一阶自回归过程 (AR($1$)) 由 $x_t = \\phi x_{t-1} + \\epsilon_t$ 给出，其中 $|\\phi|  1$ 确保了平稳性，而 $\\epsilon_t$ 是均值为零的独立同分布高斯新息。\n- 离散傅里叶变换将一个实值序列分解为振幅和相位。在保持振幅和强制厄米对称性的同时随机化相位，可以产生一个具有相同功率谱但相位随机化的实值代理序列，这是在平稳过程原假设下生成代理数据的标准方法。\n- 在大小为 $w$ 的窗口中，样本滞后-1自相关定义为 $r_1 = \\frac{\\sum_{i=1}^{w-1} (x_i - \\bar{x})(x_{i+1} - \\bar{x})}{\\sum_{i=1}^{w} (x_i - \\bar{x})^2}$，其中 $\\bar{x}$ 是该窗口内的样本均值。\n- 两个等长序列之间的肯德尔等级相关系数 (Kendall $\\tau$) 用于衡量单调关联的强度，其定义基于一致对和不一致对计数之差，并归一化到 $[-1,1]$ 区间内。\n\n对于每个测试用例，您的程序必须执行以下操作：\n$1.$ 生成 $R$ 个独立的平稳 AR($1$) 过程的实现，其长度为 $N$，参数为 $\\phi$，高斯新息的方差为单位方差。在分析前，将每个实现标准化，使其均值为零，方差为单位方差。\n$2.$ 对于每个实现，使用长度为 $w$ 的窗口，以固定步长 $\\Delta$（表示为“step”）前进，计算一个滚动窗口滞后-1自相关序列。假设有 $M$ 个窗口，并设 $a_j$ 表示在第 $j$ 个窗口中计算的滞后-1自相关，其中 $j = 1, 2, \\dots, M$。计算索引序列 $\\{1, 2, \\dots, M\\}$ 与序列 $\\{a_j\\}_{j=1}^M$ 之间的 Kendall $\\tau$，记为 $\\tau_{\\mathrm{obs}}$。\n$3.$ 对于同一个实现，通过相位随机化生成 $S$ 个代理序列：\n- 使用实数到复数变换计算实值离散傅里叶变换，保留振幅谱，为所有正频率从 $[0, 2\\pi)$ 上均匀抽取独立的相位，将零频率和奈奎斯特分量（如果存在）的相位设置为零，然后进行逆变换以获得一个实值代理序列。将每个代理序列标准化，使其均值为零，方差为单位方差。\n- 对于每个代理序列，以与原始序列相同的方式计算滚动窗口滞后-1自相关序列及其 Kendall $\\tau$，得到 $\\{\\tau_s^{(k)}\\}_{k=1}^S$。\n$4.$ 通过将 $\\tau_{\\mathrm{obs}}$ 与代理分布 $\\{\\tau_s^{(k)}\\}_{k=1}^S$ 的经验 $(1 - \\alpha)$ 分位数进行比较，执行单侧检验以判断是否存在递增趋势。如果 $\\tau_{\\mathrm{obs}}$ 严格大于此分位数，则判断为一次检测。\n$5.$ 计算假阳性率，即被判断为检测的实现占总实现数 $R$ 的比例，该比例估计了原假设下出现虚假检测的概率。将结果报告为一个在 $[0,1]$ 区间内的实数。\n\n不涉及角度单位。没有需要报告的物理单位。所有概率必须以小数形式表示。\n\n测试套件：\n对于以下每组参数集 $(\\phi, N, w, \\Delta, R, S, \\alpha)$，按上述规定计算假阳性率。使用固定的随机种子以确保结果是可复现的。\n- 案例 $1$：$(0, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $2$：$(0.5, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $3$：$(0.9, 512, 64, 4, 30, 100, 0.1)$。\n- 案例 $4$：$(0.5, 256, 128, 16, 20, 80, 0.05)$。\n\n实现约束：\n- 在计算滚动自相关之前，对每个时间序列（原始序列和代理序列）进行标准化。\n- 如果由于退化（例如，常数序列）导致 Kendall $\\tau$ 未定义，则为了检验目的，将其视为零。\n- 对所有随机数生成，使用固定的随机种子 $2025$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用逗号分隔的浮点数列表，这些浮点数四舍五入到三位小数并用方括号括起来，分别对应案例 1 到案例 4（例如，“[$0.103,0.087,0.112,0.054$]”）。",
            "solution": "用户提供了一个科学上合理且定义明确的问题。要求是实现一个数值实验，以估计一种统计检验的假阳性率。该检验用于检测滞后-1自相关中的递增趋势，这是一种临界转变的常见预警信号。检验在平稳过程（具体为一阶自回归(AR($1$))模型）的原假设下进行。该方法涉及通过相位随机化生成代理数据，以构建一个非参数零分布。\n\n该问题是有效的，因为它基于时间序列分析和统计假设检验的标准原理，提供了一套完整且明确的指令和参数，并且在计算上是可行的。所有术语都有清晰的定义，整个过程逻辑上是一致的。\n\n解决方案将通过系统地实现所述步骤来构建。\n\n**1. 生成原假设数据**\n\n原假设是观测到的时间序列是一个平稳线性随机过程的实现。我们对 $R$ 个实现中的每一个都使用一个平稳的一阶自回归 (AR($1$)) 过程来对此进行建模。AR($1$) 过程由以下方程定义：\n$$x_t = \\phi x_{t-1} + \\epsilon_t$$\n其中 $t$ 是时间索引，$\\phi$ 是自回归系数（对于平稳性要求 $|\\phi|  1$），$\\epsilon_t$ 是从标准正态分布 $\\mathcal{N}(0, 1)$ 中抽取的独立同分布 (i.i.d.) 随机变量序列。对于每个长度为 $N$ 的实现，我们生成时间序列，然后将其标准化，使其均值为 $0$，标准差为 $1$。标准化是关键一步，以确保后续的统计量不受原始实现任意均值或方差的影响。\n\n**2. 计算观测趋势统计量 $\\tau_{\\mathrm{obs}}$**\n\n对于每个标准化的实现，我们分析其滞后-1自相关的趋势。这是通过滚动窗口方法完成的。\n首先，我们在时间序列上滑动一个固定大小为 $w$ 的窗口，步长为 $\\Delta$。窗口数量 $M$ 由 $M = \\lfloor (N - w) / \\Delta \\rfloor + 1$ 给出。\n在每个窗口 $j = 1, \\dots, M$ 中，我们计算样本滞后-1自相关 $a_j$。根据规定，公式为：\n$$r_1 = \\frac{\\sum_{i=1}^{w-1} (x_i - \\bar{x})(x_{i+1} - \\bar{x})}{\\sum_{i=1}^{w} (x_i - \\bar{x})^2}$$\n其中 $\\bar{x}$ 是该特定窗口内数据点的均值。此计算产生一个新的自相关值时间序列 $\\{a_j\\}_{j=1}^M$。\n\n接着，我们量化这个自相关序列 $\\{a_j\\}$ 中的单调趋势。我们使用肯德尔等级相关系数 $\\tau$，它衡量窗口索引 $\\{1, 2, \\dots, M\\}$ 与对应的自相关值 $\\{a_j\\}_{j=1}^M$ 之间的序数关联。正的 $\\tau$ 表示递增趋势。这个值就是我们观测到的检验统计量 $\\tau_{\\mathrm{obs}}$。如果自相关序列是常数，导致退化情况，$\\tau$ 则被视为 $0$。\n\n**3. 生成代理零分布**\n\n为了评估 $\\tau_{\\mathrm{obs}}$ 的统计显著性，我们将其与在原假设下预期的 $\\tau$ 值分布进行比较。这个零分布是使用代理数据根据经验生成的。对于 $R$ 个原始实现中的每一个，我们生成 $S$ 个代理时间序列。\n\n代理序列是使用相位随机化技术创建的。该方法保留了原始序列的功率谱（从而也保留了自相关结构），同时通过在频域中随机化相位信息来破坏任何非线性或非平稳特征。过程如下：\na. 对标准化的时间序列进行实数到复数的离散傅里叶变换 (DFT)。这将产生一组复系数，每个系数都带有振幅和相位。\nb. 振幅保持不变。\nc. 从 $[0, 2\\pi)$ 上的均匀分布中独立抽取新的相位。\nd. 为确保逆变换得到的序列是实值，将零频率（直流）分量的相位设置为 $0$。如果序列长度 $N$ 是偶数，奈奎斯特频率的相位也设置为 $0$。\ne. 根据原始振幅和一组新的随机相位构建新的复傅里叶系数。\nf. 对这些新系数应用逆 DFT，以获得一个实值代理序列。\ng. 然后将得到的 $S$ 个代理序列中的每一个都标准化，使其均值为零，方差为单位方差。\n\n对于每个代理序列，我们重复步骤 2 的过程：计算滚动窗口滞后-1自相关序列及其 Kendall $\\tau$ 统计量，记为 $\\tau_s^{(k)}$，其中 $k=1, \\dots, S$。\n\n**4. 假设检验**\n\n代理统计量的集合 $\\{\\tau_s^{(k)}\\}_{k=1}^S$ 为趋势统计量构成了一个经验零分布。我们执行单侧假设检验，以确定观测到的趋势 $\\tau_{\\mathrm{obs}}$ 是否显著为正。我们从代理分布中找到临界值，即其 $(1-\\alpha)$ 分位数，其中 $\\alpha$ 是期望的显著性水平。如果 $\\tau_{\\mathrm{obs}}$ 严格大于此临界值，则判定为一次检测（即拒绝原假设）。\n\n**5. 假阳性率计算**\n\n对 $R$ 个独立的 AR($1$) 过程的实现重复整个过程（步骤 1 到 4）。由于根据构造，所有这些实现都来自平稳的零模型，因此任何被判定的检测都是假阳性（第一类错误）。假阳性率 (FPR) 估计为检测总数除以总实现数 $R$。\n$$\\text{FPR} = \\frac{\\text{检测次数}}{R}$$\n理论上，这个值应接近所选的显著性水平 $\\alpha$。该算法将为每个给定的参数集计算此 FPR。为保证可复现性，所有随机数生成都将从一个固定的种子初始化。",
            "answer": "```python\nimport numpy as np\nimport scipy.stats\nimport scipy.fft\n\ndef solve():\n    \"\"\"\n    Main function to run the numerical experiment for all test cases.\n    \"\"\"\n\n    def generate_ar1(phi, N, rng):\n        \"\"\"\n        Generates a single realization of a stationary AR(1) process.\n        x_t = phi * x_{t-1} + epsilon_t\n        \"\"\"\n        epsilon = rng.normal(loc=0.0, scale=1.0, size=N)\n        x = np.zeros(N)\n        # No burn-in specified, start with x[0] = epsilon[0]\n        x[0] = epsilon[0]\n        for t in range(1, N):\n            x[t] = phi * x[t - 1] + epsilon[t]\n        return x\n\n    def standardize(series):\n        \"\"\"\n        Standardizes a time series to have zero mean and unit variance.\n        \"\"\"\n        s_std = np.std(series)\n        if s_std == 0:\n            # For a constant series, return a zero series.\n            return series - np.mean(series)\n        return (series - np.mean(series)) / s_std\n\n    def rolling_autocorr(series, w, delta):\n        \"\"\"\n        Computes rolling-window lag-1 autocorrelation based on the problem's formula.\n        \"\"\"\n        N = len(series)\n        autocorrs = []\n        # Iterate over the starting index of each window\n        for i in range(0, N - w + 1, delta):\n            window = series[i : i + w]\n            \n            # Use specified formula for lag-1 autocorrelation\n            mean_w = np.mean(window)\n            var_w = np.sum((window - mean_w)**2)\n\n            if var_w == 0:\n                autocorrs.append(0.0)\n                continue\n\n            # Numerator: sum_{i=1 to w-1} (x_i - x_bar)(x_{i+1} - x_bar)\n            x_lagged = window[:-1]\n            x_shifted = window[1:]\n            numerator = np.sum((x_lagged - mean_w) * (x_shifted - mean_w))\n            \n            autocorrs.append(numerator / var_w)\n            \n        return np.array(autocorrs)\n\n    def calculate_tau(series, w, delta):\n        \"\"\"\n        Calculates Kendall's tau for the trend in a rolling autocorrelation sequence.\n        \"\"\"\n        autocorrs = rolling_autocorr(series, w, delta)\n        M = len(autocorrs)\n        \n        # Tau is not well-defined for fewer than 2 points.\n        if M  2:\n            return 0.0\n        \n        # Calculate Kendall's tau against the window index sequence.\n        tau, _ = scipy.stats.kendalltau(np.arange(M), autocorrs)\n        \n        # Per problem spec, treat degenerate cases (which result in NaN) as zero.\n        if np.isnan(tau):\n            return 0.0\n        \n        return tau\n\n    def generate_surrogate(series, rng):\n        \"\"\"\n        Generates a surrogate time series using phase randomization.\n        \"\"\"\n        N = len(series)\n        \n        # 1. Compute DFT\n        fft_coeffs = scipy.fft.rfft(series)\n        amplitudes = np.abs(fft_coeffs)\n        \n        # 2. Randomize phases\n        num_freqs = len(fft_coeffs)\n        random_phases = rng.uniform(0, 2 * np.pi, size=num_freqs)\n        \n        # 3. Enforce real-valued constraints\n        # DC component (f=0) must have phase 0\n        random_phases[0] = 0\n        # Nyquist frequency (if N is even) must have phase 0\n        if N % 2 == 0:\n            random_phases[-1] = 0\n            \n        # 4. Create new complex coefficients\n        new_fft_coeffs = amplitudes * np.exp(1j * random_phases)\n        \n        # 5. Inverse DFT to get real-valued surrogate\n        surrogate = scipy.fft.irfft(new_fft_coeffs, n=N)\n        \n        return surrogate\n\n    # Per problem spec, use a fixed seed for all random number generation.\n    rng = np.random.default_rng(2025)\n\n    test_cases = [\n        # (phi, N, w, delta, R, S, alpha)\n        (0.0, 512, 64, 4, 30, 100, 0.1),\n        (0.5, 512, 64, 4, 30, 100, 0.1),\n        (0.9, 512, 64, 4, 30, 100, 0.1),\n        (0.5, 256, 128, 16, 20, 80, 0.05),\n    ]\n\n    final_results = []\n\n    for phi, N, w, delta, R, S, alpha in test_cases:\n        detection_count = 0\n        for _ in range(R):\n            # 1. Generate and standardize the original time series\n            original_series = generate_ar1(phi, N, rng)\n            std_original_series = standardize(original_series)\n\n            # 2. Compute the observed trend statistic\n            tau_obs = calculate_tau(std_original_series, w, delta)\n\n            # 3. Generate surrogate distribution of tau\n            tau_surrogates = np.empty(S)\n            for k in range(S):\n                surrogate_series = generate_surrogate(std_original_series, rng)\n                std_surrogate = standardize(surrogate_series)\n                tau_surrogates[k] = calculate_tau(std_surrogate, w, delta)\n\n            # 4. Perform the one-sided hypothesis test\n            # np.quantile interpolation='higher' is equivalent to the (1-alpha) empirical quantile\n            critical_value = np.quantile(tau_surrogates, 1 - alpha, interpolation='higher')\n            if tau_obs  critical_value:\n                detection_count += 1\n        \n        # 5. Compute the false positive rate\n        fpr = detection_count / R\n        final_results.append(fpr)\n\n    # Format the final output as specified.\n    print(f\"[{','.join(f'{r:.3f}' for r in final_results)}]\")\n\nsolve()\n```"
        }
    ]
}