{
    "hands_on_practices": [
        {
            "introduction": "概率性事件归因中最核心的度量之一是风险比（Risk Ratio, $RR$）。它量化了在当前气候（事实世界）中极端事件发生的概率相对于一个没有人类影响的气候（反事实世界）的变化。本练习提供了一个基础的实践机会，让您直接从假设的大样本气候模式输出数据中计算$RR$及其不确定性，这是所有归因研究中的一项核心任务。",
            "id": "4041785",
            "problem": "一个全球耦合大气环流模型（GCM）被用于对一个热浪阈值进行大样本事件归因分析。该阈值定义为日最高温度超过一个由长期控制模拟校准的高分位数。生成了两组仅包含大气模式的模拟，它们具有不同的外部强迫，但模型物理过程相同，样本量相当：一个是有当今强迫的“事实”世界，另一个是近似工业化前强迫的“反事实”世界。令 $N_1$ 和 $N_0$ 分别表示在事实和反事实情景下，汇集所有集合成员和相关季节的独立日样本总数，令 $n_1$ 和 $n_0$ 表示相应的超过阈值的次数。假设在每个世界中，超阈值事件是具有恒定概率的独立伯努利试验。\n\n在一次具体分析中，模型在事实世界中产生了 $N_1 = 50{,}000$ 个日样本，其中有 $n_1 = 2{,}100$ 次超阈值；在反事实世界中产生了 $N_0 = 50{,}000$ 个日样本，其中有 $n_0 = 200$ 次超阈值。\n\n仅使用核心定义和二项式抽样的大样本性质，完成以下任务：\n\n- 将事件的风险比（RR）定义为事实世界中的超阈值概率与反事实世界中的超阈值概率之比，并根据给定的计数计算其最大似然估计。\n- 从二项模型和样本比例的大样本高斯近似出发，推导估计风险比的自然对数的渐近标准误，然后使用给定的计数进行数值计算。\n\n将估计的风险比及其自然对数的渐近标准误均四舍五入至四位有效数字。报告无量纲量（不要将任何结果表示为百分比）。",
            "solution": "该问题具有科学依据，陈述清晰，并包含获得唯一解所需的所有信息。我们可以着手进行分析。\n\n设 $p_1$ 为事实世界中日最高温度超阈值的真实概率， $p_0$ 为反事实世界中超阈值的真实概率。问题陈述，在每个世界中，超阈值事件的发生被建模为独立的伯努利试验。\n因此，事实世界中总共 $N_1$ 个样本里的超阈值次数 $n_1$ 是一个服从二项分布的随机变量的实现，即 $n_1 \\sim \\text{Bin}(N_1, p_1)$。\n同样，反事实世界中的超阈值次数 $n_0$ 服从 $n_0 \\sim \\text{Bin}(N_0, p_0)$。\n\n二项分布的概率参数 $p$ 的最大似然估计（MLE）是样本比例 $\\hat{p} = \\frac{n}{N}$。\n因此，$p_1$ 和 $p_0$ 的最大似然估计为：\n$$ \\hat{p}_1 = \\frac{n_1}{N_1} $$\n$$ \\hat{p}_0 = \\frac{n_0}{N_0} $$\n\n第一个任务是定义风险比（$RR$）并计算其最大似然估计。\n$RR$ 定义为事实世界中的超阈值概率与反事实世界中的超阈值概率之比：\n$$ RR = \\frac{p_1}{p_0} $$\n\n根据最大似然估计的不变性，参数函数的最大似然估计等于将该函数应用于参数的最大似然估计。因此，风险比的最大似然估计，记为 $\\widehat{RR}$，是：\n$$ \\widehat{RR} = \\frac{\\hat{p}_1}{\\hat{p}_0} = \\frac{n_1/N_1}{n_0/N_0} $$\n\n使用所提供的数据，$N_1 = 50,000$，$n_1 = 2,100$，$N_0 = 50,000$，以及 $n_0 = 200$：\n$$ \\hat{p}_1 = \\frac{2,100}{50,000} = 0.042 $$\n$$ \\hat{p}_0 = \\frac{200}{50,000} = 0.004 $$\n$$ \\widehat{RR} = \\frac{0.042}{0.004} = 10.5 $$\n四舍五入到四位有效数字，我们得到 $\\widehat{RR} = 10.50$。\n\n第二个任务是推导估计风险比的自然对数的渐近标准误，$\\text{SE}(\\ln(\\widehat{RR}))$。\n设 $g(p_1, p_0) = \\ln(RR) = \\ln(\\frac{p_1}{p_0}) = \\ln(p_1) - \\ln(p_0)$。我们感兴趣的是 $g(\\hat{p}_1, \\hat{p}_0) = \\ln(\\widehat{RR})$ 的标准误。\n\n根据中心极限定理，对于大样本，样本比例 $\\hat{p}_1$ 和 $\\hat{p}_0$ 的分布近似为高斯分布：\n$$ \\hat{p}_1 \\approx \\mathcal{N}\\left(p_1, \\frac{p_1(1-p_1)}{N_1}\\right) $$\n$$ \\hat{p}_0 \\approx \\mathcal{N}\\left(p_0, \\frac{p_0(1-p_0)}{N_0}\\right) $$\n方差为 $\\text{Var}(\\hat{p}_1) = \\frac{p_1(1-p_1)}{N_1}$ 和 $\\text{Var}(\\hat{p}_0) = \\frac{p_0(1-p_0)}{N_0}$。由于事实和反事实模拟是独立的，所以 $\\text{Cov}(\\hat{p}_1, \\hat{p}_0) = 0$。\n\n我们使用多元Delta方法来求 $\\ln(\\widehat{RR})$ 的渐近方差。对于两个独立估计量 $\\hat{\\theta}_1, \\hat{\\theta}_2$ 的函数 $g(\\hat{\\theta}_1, \\hat{\\theta}_2)$，其方差近似为：\n$$ \\text{Var}(g(\\hat{\\theta}_1, \\hat{\\theta}_2)) \\approx \\left(\\frac{\\partial g}{\\partial \\theta_1}\\right)^2 \\text{Var}(\\hat{\\theta}_1) + \\left(\\frac{\\partial g}{\\partial \\theta_2}\\right)^2 \\text{Var}(\\hat{\\theta}_2) $$\n其中偏导数在真实参数值 $(\\theta_1, \\theta_2)$ 处求值。\n\n在我们的例子中，$\\theta_1 = p_1$，$\\theta_2 = p_0$，且 $g(p_1, p_0) = \\ln(p_1) - \\ln(p_0)$。偏导数为：\n$$ \\frac{\\partial g}{\\partial p_1} = \\frac{1}{p_1} $$\n$$ \\frac{\\partial g}{\\partial p_0} = -\\frac{1}{p_0} $$\n\n将这些代入Delta方法公式：\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\left(\\frac{1}{p_1}\\right)^2 \\text{Var}(\\hat{p}_1) + \\left(-\\frac{1}{p_0}\\right)^2 \\text{Var}(\\hat{p}_0) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1}{p_1^2} \\left( \\frac{p_1(1-p_1)}{N_1} \\right) + \\frac{1}{p_0^2} \\left( \\frac{p_0(1-p_0)}{N_0} \\right) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1-p_1}{p_1 N_1} + \\frac{1-p_0}{p_0 N_0} $$\n这是渐近方差。为了获得估计方差，我们用最大似然估计 $\\hat{p}_1$ 和 $\\hat{p}_0$ 代替真实参数 $p_1$ 和 $p_0$：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1-\\hat{p}_1}{\\hat{p}_1 N_1} + \\frac{1-\\hat{p}_0}{\\hat{p}_0 N_0} $$\n代入 $\\hat{p}_1 = n_1/N_1$ 和 $\\hat{p}_0 = n_0/N_0$：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1 - n_1/N_1}{ (n_1/N_1) N_1} + \\frac{1 - n_0/N_0}{ (n_0/N_0) N_0} = \\frac{(N_1 - n_1)/N_1}{n_1} + \\frac{(N_0 - n_0)/N_0}{n_0} $$\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{N_1 - n_1}{n_1 N_1} + \\frac{N_0 - n_0}{n_0 N_0} $$\n这个表达式可以改写为：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\left(\\frac{1}{n_1} - \\frac{1}{N_1}\\right) + \\left(\\frac{1}{n_0} - \\frac{1}{N_0}\\right) $$\n渐近标准误是这个估计方差的平方根：\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{n_1} - \\frac{1}{N_1} + \\frac{1}{n_0} - \\frac{1}{N_0}} $$\n\n现在，我们用给定的计数进行数值计算：\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} - \\frac{1}{50,000} + \\frac{1}{200} - \\frac{1}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} + \\frac{1}{200} - \\frac{2}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.000476190... + 0.005 - 0.00004} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.005436190...} \\approx 0.07373052... $$\n四舍五入到四位有效数字，我们得到 $\\text{SE}(\\ln(\\widehat{RR})) = 0.07373$。\n\n所要求的两个量是估计的风险比 $\\widehat{RR}$，以及其对数的渐近标准误 $\\text{SE}(\\ln(\\widehat{RR}))$。\n- 估计的风险比：$10.50$\n- 对数风险比的渐近标准误：$0.07373$",
            "answer": "$$\\boxed{\\begin{pmatrix} 10.50  0.07373 \\end{pmatrix}}$$"
        },
        {
            "introduction": "仅仅计算度量指标是不够的，理解气候变化如何从数学上改变极端事件的统计特性至关重要。本练习利用广义极值（Generalized Extreme Value, GEV）分布，要求您从解析上推导平均温度的简单变化（作为全球变暖的代理）如何转化为重现期的改变。这项实践将为您提供对归因信号背后理论基础的更深层次理解。",
            "id": "4041693",
            "problem": "考虑一个气候变量（例如，年最大日降水量）的年度分块最大值序列 $\\{X_{1}, X_{2}, \\dots, X_{n}\\}$，其被建模为来自广义极值（GEV）分布的独立同分布样本，该分布具有位置参数 $\\mu$、尺度参数 $\\sigma>0$ 和形状参数 $\\xi \\neq 0$。对于一个值 $x$，GEV 的累积分布函数由下式给出\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n其定义域为满足 $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$ 的 $x$ 值。设 $z$ 为基准重现水平，使得在基准气候下，一年的超越概率为 $P(X > z) = \\frac{1}{T_{b}}$，其中 $T_{b} > 1$ 是以年为单位的基准重现期。\n\n假设在可归因于系统性强迫的受扰动气候状态下，位置参数偏移为 $\\mu' = \\mu + \\Delta\\mu$，而 $\\sigma$ 和 $\\xi$ 保持不变。假设各年份之间保持独立，并且阈值 $z$ 固定在其基准值上。仅使用期望值的定义和 GEV 累积分布函数，推导以下各项的精确表达式：\n- 在受扰动气候下，未来 $n$ 年内超越 $z$ 的期望次数，以及\n- 在受扰动气候下，与阈值 $z$ 相关的受扰动重现期 $T'$（以年为单位）。\n\n将您的最终答案表示为关于 $n$、$T_{b}$、$\\sigma$、$\\xi$ 和 $\\Delta\\mu$ 的单个闭式表达式。您必须陈述并使用有效性所需的任何定义域条件（例如，GEV 支撑集的正值约束），但您的最终方框答案不得包含这些条件。不需要进行数值近似或四舍五入，最终的方框表达式中不应包含任何物理单位。",
            "solution": "广义极值（GEV）分布描述了分块最大值，其累积分布函数为\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n定义在 $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$ 的支撑集上。对于一个固定的阈值 $z$，在参数 $(\\mu, \\sigma, \\xi)$ 下的年超越概率是\n$$\np(\\mu) \\equiv P(X > z) \\;=\\; 1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n同样有定义域限制 $1 + \\xi\\,\\frac{z-\\mu}{\\sigma} > 0$。\n\n根据重现期的定义，基准条件 $P(X > z) = 1/T_{b}$ 意味着\n$$\n1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; \\frac{1}{T_{b}}\n\\;\\;\\Longrightarrow\\;\\;\nG(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\frac{1}{T_{b}}.\n$$\n使用 GEV 累积分布函数，我们有\n$$\n\\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\n\\;=\\;\n1 - \\frac{1}{T_{b}}.\n$$\n两边取自然对数，得到\n$$\n-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right),\n$$\n所以\n$$\n\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right).\n$$\n定义一个正量（对于 $T_{b} > 1$）\n$$\nA \\;\\equiv\\; -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right) \\;>\\; 0.\n$$\n那么\n$$\n1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi},\n$$\n因此\n$$\nz - \\mu\n\\;=\\;\n\\frac{\\sigma}{\\xi}\\,\\Big(A^{-\\xi} - 1\\Big).\n$$\n\n在位置参数为 $\\mu' = \\mu + \\Delta\\mu$（而 $\\sigma$ 和 $\\xi$ 不变）的受扰动气候下，对于同一阈值 $z$ 的年超越概率变为\n$$\np' \\;\\equiv\\; P(X > z \\,|\\, \\mu') \\;=\\; 1 - G\\big(z; \\mu + \\Delta\\mu, \\sigma, \\xi\\big)\n\\;=\\;\n1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n其受扰动的支撑集条件为\n$$\n1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma} \\;>\\; 0.\n$$\n使用上面求得的 $z - \\mu$ 的表达式，\n$$\n1 + \\xi\\,\\frac{z - (\\mu + \\Delta\\mu)}{\\sigma}\n\\;=\\;\n1 + \\xi\\,\\frac{(z-\\mu) - \\Delta\\mu}{\\sigma}\n\\;=\\;\n\\left(1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right) - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}.\n$$\n因此，\n$$\np' \\;=\\; 1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n当 $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ 时有效（以保持受扰动的阈值在 GEV 支撑集内）。\n\n根据期望的线性和独立性，在受扰动气候下 $n$ 个独立年份中的期望超越次数为\n$$\nE' \\;=\\; n\\,p' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}.\n$$\n\n阈值 $z$ 的受扰动重现期 $T'$ 定义为年超越概率的倒数，\n$$\nT' \\;=\\; \\frac{1}{p'}\n\\;=\\;\n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1}.\n$$\n\n总结一下，当 $A = -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)$ 时，精确表达式为\n$$\nE' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\},\n\\qquad\nT' \\;=\\; \\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1},\n$$\n受定义域条件 $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ 的约束，该条件确保阈值 $z$ 在受扰动气候下位于支撑集内。这些公式明确地将位置参数的偏移 $\\Delta\\mu$ 与 GEV 框架下 $n$ 年内的期望超越次数和相应的重现期的变化联系起来。",
            "answer": "$$\\boxed{\\begin{pmatrix}\nn\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right] \n\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right]^{-1}\n\\end{pmatrix}}$$"
        },
        {
            "introduction": "真实的归因研究通常涉及更复杂的模型，例如超阈值峰值（Peaks-Over-Threshold, POT）方法。这项综合性练习旨在挑战您从理论走向应用，在一个POT框架内推导极端事件的概率，然后通过编程实现该模型以分析各种情景。这套技能对于开展实际研究至关重要。",
            "id": "4041726",
            "problem": "考虑一个用于数值天气预报和气候模型中极端事件归因的区域日降水量随机表示。令日降水量表示为一个序列 $\\{R(t)\\}_{t=1,2,\\dots}$，单位为毫米/天 ($\\mathrm{mm/day}$)。定义一个持续时间窗口为 $D$ 天、阈值为 $u$ ($\\mathrm{mm/day}$) 的极端降水事件为事件 $E=\\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)>u\\}$。令 $P_1$ 为当前（事实）气候下事件 $E$ 的概率，令 $P_0$ 为没有人为强迫的反事实气候下事件 $E$ 的概率。定义相对风险 (RR) 为 $RR = P_1 / P_0$。\n\n使用基于极值理论的超阈值峰值 (POT) 模型。假设超过选定基础阈值 $u_0$ ($\\mathrm{mm/day}$) 的事件根据一个均匀泊松过程发生，其速率为每天 $\\lambda_{u_0}$，并且在 $R>u_0$ 的条件下，超出量 $Y=R-u_0$ 服从广义帕累托分布 (GPD)，其在阈值 $u_0$ 处的形状参数为 $\\xi$，尺度参数为 $\\sigma$。为两种气候建模：事实世界，参数为 $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)})$；反事实世界，参数为 $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)})$。假设每日的超阈值事件是独立的，并且 $u\\ge u_0$。\n\n从上述核心定义以及关于泊松过程和广义帕累托分布的成熟理论出发，推导在 POT 框架下 $P_1$、$P_0$ 和 $RR$ 作为 $(D,u,u_0,\\lambda_{u_0},\\xi,\\sigma)$ 的函数的表达式，并在一个程序中实现这些表达式。该程序必须为下面列出的每个测试用例计算 $P_1$、$P_0$ 和 $RR$。如果 $P_0=0$ 且 $P_1>0$，则定义 $RR$ 为 $+\\infty$。如果 $P_0=0$ 且 $P_1=0$，则定义 $RR$ 为非数值 ($\\mathrm{NaN}$)。所有概率必须表示为小数（无单位），阈值单位为 $\\mathrm{mm/day}$，持续时间单位为天。程序在打印时必须将所有浮点输出四舍五入到 $6$ 位小数。\n\n使用以下随 $D$ 和 $u$ 变化的科学一致性测试套件来探究敏感性：\n\n- 测试用例 1 (理想情况，中等窗口和阈值，反事实中为指数尾):\n  - $u_0 = 20\\,\\mathrm{mm/day}$，\n  - 事实参数 $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.25\\,\\mathrm{day}^{-1}, 0.10, 15\\,\\mathrm{mm})$，\n  - 反事实参数 $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.20\\,\\mathrm{day}^{-1}, 0.00, 12\\,\\mathrm{mm})$，\n  - 窗口 $D=5$ 天，\n  - 阈值 $u=50\\,\\mathrm{mm/day}$。\n\n- 测试用例 2 (更大窗口，非常高的阈值):\n  - 与测试用例 1 中相同的 $u_0$ 和参数集，\n  - 窗口 $D=10$ 天，\n  - 阈值 $u=100\\,\\mathrm{mm/day}$。\n\n- 测试用例 3 (短窗口，较低阈值):\n  - 与测试用例 1 中相同的 $u_0$ 和参数集，\n  - 窗口 $D=1$ 天，\n  - 阈值 $u=30\\,\\mathrm{mm/day}$。\n\n- 测试用例 4 (边界情况 $D=0$ 天):\n  - 与测试用例 1 中相同的 $u_0$ 和参数集，\n  - 窗口 $D=0$ 天，\n  - 阈值 $u=60\\,\\mathrm{mm/day}$。\n\n- 测试用例 5 (反事实尾部存在有限右端点，中等阈值):\n  - $u_0 = 20\\,\\mathrm{mm/day}$，\n  - 事实参数 $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.30\\,\\mathrm{day}^{-1}, 0.05, 18\\,\\mathrm{mm})$，\n  - 反事实参数 $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.22\\,\\mathrm{day}^{-1}, -0.10, 25\\,\\mathrm{mm})$，\n  - 窗口 $D=7$ 天，\n  - 阈值 $u=110\\,\\mathrm{mm/day}$。\n\n- 测试用例 6 (有限端点导致反事实概率为零):\n  - $u_0 = 20\\,\\mathrm{mm/day}$，\n  - 事实参数 $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)}) = (0.30\\,\\mathrm{day}^{-1}, 0.05, 18\\,\\mathrm{mm})$，\n  - 反事实参数 $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)}) = (0.22\\,\\mathrm{day}^{-1}, -0.10, 25\\,\\mathrm{mm})$，\n  - 窗口 $D=14$ 天，\n  - 阈值 $u=280\\,\\mathrm{mm/day}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例的结果本身也是一个用方括号括起来的逗号分隔三元组，顺序为 $[P_1,P_0,RR]$。例如，整体格式必须类似于 $[[p_{1,1},p_{0,1},rr_1],[p_{1,2},p_{0,2},rr_2],\\dots]$，不含空格。所有打印的数值条目必须四舍五入到 $6$ 位小数，特殊值在适用时必须打印为 $\\mathrm{inf}$ 或 $\\mathrm{nan}$。",
            "solution": "该问题要求在超阈值峰值 (POT) 框架下推导并实现极端事件概率及其相对风险的公式，这是极值理论 (EVT) 中的一种标准方法。\n\n### 步骤 1：问题验证\n\n问题陈述提供了一个基于统计气候学的、科学上合理且适定的场景。\n\n**提取的已知条件：**\n-   **模型：** 用于日降水量 $R(t)$ 的超阈值峰值 (POT) 模型。\n-   **基础阈值：** $u_0$ ($\\mathrm{mm/day}$)。\n-   **超阈值事件的到达：** 超过 $u_0$ 的事件遵循一个均匀泊松过程，速率为 $\\lambda_{u_0}$ ($\\mathrm{day}^{-1}$)。\n-   **超阈值量级：** 超出量 $Y=R-u_0$ (对于 $R>u_0$) 服从广义帕累托分布 (GPD)，其形状参数为 $\\xi$，尺度参数为 $\\sigma$ ($\\mathrm{mm}$)。\n-   **气候：**\n    -   事实气候：参数 $(\\lambda_{u_0}^{(1)}, \\xi^{(1)}, \\sigma^{(1)})$。\n    -   反事实气候：参数 $(\\lambda_{u_0}^{(0)}, \\xi^{(0)}, \\sigma^{(0)})$。\n-   **极端事件：** $E=\\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)>u\\}$，持续时间为 $D$ (天)，阈值为 $u$ ($\\mathrm{mm/day}$)，且 $u \\ge u_0$。\n-   **概率：** $P_1 = P(E)$ 在事实气候中，$P_0 = P(E)$ 在反事实气候中。\n-   **相对风险：** $RR = P_1 / P_0$。\n    -   如果 $P_0=0$ 且 $P_1>0$，则 $RR = +\\infty$。\n    -   如果 $P_0=0$ 且 $P_1=0$，则 $RR = \\mathrm{NaN}$。\n-   **假设：** 每日超阈值事件的发生是独立的。\n-   **测试数据：** 提供了六个不同的测试用例，包含所有必要的参数。\n\n**验证结论：**\n该问题是有效的。它在科学上基于 EVT，这是现代气候科学中分析极端事件的基石。定义精确，设置完整且内部一致，参数在物理上是合理的。该问题要求基于泊松过程和 GPD 的性质进行标准推导，这是一项虽然不简单但定义明确的任务。\n\n### 步骤 2：概率和相对风险的推导\n\nPOT 模型的核心是，超过高阈值 $u_0$ 的事件以泊松点过程的形式发生。这些超阈值事件的速率为每天 $\\lambda_{u_0}$ 个事件。在事件发生的前提下，超过 $u_0$ 的量级服从 GPD。\n\n我们首先为一组通用参数 $(D, u, u_0, \\lambda_{u_0}, \\xi, \\sigma)$ 推导事件 $E$ 的概率 $P$。事件 $E$ 是指在 $D$ 天内的最大降水量超过阈值 $u$。\n\n1.  **泊松过程的稀疏化：** 超过基础阈值 $u_0$ 的速率是 $\\lambda_{u_0}$。我们感兴趣的是超过更高阈值 $u$ 的事件。根据泊松过程的稀疏化特性，如果某种类型的事件以速率 $\\lambda_A$ 到达，并且每个事件独立地具有某个特征的概率为 $p$，那么具有该特征的事件也构成一个泊松过程，其稀疏化后的速率为 $\\lambda_B = p \\lambda_A$。\n\n    在我们的情况下，初始事件是超过 $u_0$ 的事件。我们感兴趣的特征是降水量也超过 $u$。因此，概率 $p$ 为 $P(R > u | R > u_0)$。超过 $u$ 的事件速率，记为 $\\lambda_u$，因此是：\n    $$ \\lambda_u = \\lambda_{u_0} \\cdot P(R > u | R > u_0) $$\n\n2.  **GPD 生存函数：** 概率 $P(R > u | R > u_0)$ 是超出量 $Y = R - u_0$ 大于 $u - u_0$ 的概率。这由 GPD 的生存函数 $S_{GPD}(y)$ 在 $y = u - u_0$ 处的值给出。\n\n    对于超出量 $y = u - u_0 \\ge 0$，GPD 生存函数为：\n    $$ S_{GPD}(y; \\xi, \\sigma) = P(Y > y) = \\begin{cases} \\left(1 + \\frac{\\xi y}{\\sigma}\\right)^{-1/\\xi}  \\text{if } \\xi \\neq 0 \\\\ \\exp\\left(-\\frac{y}{\\sigma}\\right)  \\text{if } \\xi = 0 \\end{cases} $$\n    这在分布的支撑集上有效。对于 $\\xi  0$，GPD 有一个有限的上端点 $y_{max} = -\\sigma/\\xi$。如果 $y \\ge y_{max}$，则超出的概率为 $0$。对于 $\\xi \\ge 0$，支撑集是无界的。\n\n3.  **高阈值超阈事件的速率：** 结合以上，速率 $\\lambda_u$ 变为：\n    对于 $\\xi \\neq 0$:\n    $$ \\lambda_u = \\lambda_{u_0} \\left(1 + \\frac{\\xi (u-u_0)}{\\sigma}\\right)^{-1/\\xi} \\quad \\text{provided } 1 + \\frac{\\xi(u-u_0)}{\\sigma}  0 $$\n    对于 $\\xi = 0$:\n    $$ \\lambda_u = \\lambda_{u_0} \\exp\\left(-\\frac{u-u_0}{\\sigma}\\right) $$\n    如果 $\\xi  0$ 且 $u-u_0 \\ge -\\sigma/\\xi$，则 $\\lambda_u = 0$。\n\n4.  **极端事件的概率：** 事件 $E = \\{\\max_{t\\in\\{1,2,\\dots,D\\}} R(t)u\\}$ 等价于在 $D$ 天的窗口内至少发生一次超过阈值 $u$ 的事件。令 $N_D(u)$ 为 $D$ 天内此类超阈值事件的数量。由于这些事件遵循速率为 $\\lambda_u$ 的均匀泊松过程，$N_D(u)$ 服从均值为 $D \\lambda_u$ 的泊松分布。\n\n    事件 $E$ 的概率是 $P(N_D(u)  0)$。计算其补集更简单：\n    $$ P(E) = 1 - P(N_D(u)=0) $$\n    根据泊松概率质量函数 $P(k) = \\frac{\\mu^k e^{-\\mu}}{k!}$，其中 $\\mu = D \\lambda_u$：\n    $$ P(N_D(u)=0) = \\frac{(D\\lambda_u)^0 e^{-D\\lambda_u}}{0!} = e^{-D\\lambda_u} $$\n    因此，极端事件的概率是：\n    $$ P(E) = 1 - e^{-D\\lambda_u} $$\n\n5.  **最终公式：** 现在我们可以通过代入各自的参数集来写出 $P_1$（事实）和 $P_0$（反事实）的表达式。令 $\\lambda_u^{(i)}$ 为在气候 $i \\in \\{0, 1\\}$ 中超过阈值 $u$ 的速率。\n    $$ P_i = 1 - \\exp(-D \\lambda_u^{(i)}) $$\n    其中 $\\lambda_u^{(i)}$ 是使用参数 $(\\lambda_{u_0}^{(i)}, \\xi^{(i)}, \\sigma^{(i)})$ 计算的。\n\n    然后相对风险 $RR$ 计算为 $RR = P_1 / P_0$，并按规定处理 $P_0=0$ 的特殊情况。对于 $D=0$ 的情况，泊松过程的均值 $D\\lambda_u$ 为 $0$，导致两种气候下的 $P_i = 1 - e^0 = 0$。根据问题定义，这将导致 $RR = \\mathrm{NaN}$。\n\n推导到此完成。下一步是在程序中实现这一逻辑。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the extreme event attribution problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test case 1\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 5,\n            \"u\": 50.0,\n        },\n        # Test case 2\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 10,\n            \"u\": 100.0,\n        },\n        # Test case 3\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 1,\n            \"u\": 30.0,\n        },\n        # Test case 4\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.25, \"xi\": 0.10, \"sigma\": 15.0},\n            \"counterfactual\": {\"lam_u0\": 0.20, \"xi\": 0.00, \"sigma\": 12.0},\n            \"D\": 0,\n            \"u\": 60.0,\n        },\n        # Test case 5\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.30, \"xi\": 0.05, \"sigma\": 18.0},\n            \"counterfactual\": {\"lam_u0\": 0.22, \"xi\": -0.10, \"sigma\": 25.0},\n            \"D\": 7,\n            \"u\": 110.0,\n        },\n        # Test case 6\n        {\n            \"u0\": 20.0,\n            \"factual\": {\"lam_u0\": 0.30, \"xi\": 0.05, \"sigma\": 18.0},\n            \"counterfactual\": {\"lam_u0\": 0.22, \"xi\": -0.10, \"sigma\": 25.0},\n            \"D\": 14,\n            \"u\": 280.0,\n        },\n    ]\n\n    def calculate_event_prob(D, u, u0, lam_u0, xi, sigma):\n        \"\"\"\n        Calculates the probability of an extreme event E = {max(R(t)) > u} over D days.\n        \"\"\"\n        if D == 0:\n            return 0.0\n\n        y = u - u0\n        \n        # The POT model is for y >= 0 (since u >= u0)\n        if y  0:\n            return 0.0\n\n        # Handle GPD upper bound for xi  0\n        if xi  0:\n            upper_endpoint_excess = -sigma / xi\n            if y >= upper_endpoint_excess:\n                return 0.0 # Probability of exceeding the upper bound is zero.\n\n        # Calculate the rate of exceedances lambda_u\n        if xi == 0.0:\n            # Exponential case\n            lambda_u = lam_u0 * np.exp(-y / sigma)\n        else:\n            # General case\n            base = 1.0 + xi * y / sigma\n            # The base check should not be necessary due to the endpoint check above,\n            # but it is a good safeguard against floating point inaccuracies.\n            if base = 0:\n                return 0.0\n            lambda_u = lam_u0 * (base ** (-1.0 / xi))\n        \n        # Calculate event probability from the Poisson process\n        prob_no_event = np.exp(-D * lambda_u)\n        prob_event = 1.0 - prob_no_event\n        \n        return prob_event\n\n    def format_num(n):\n        \"\"\"Formats a number, handling inf and nan correctly.\"\"\"\n        if np.isinf(n):\n            return \"inf\"\n        if np.isnan(n):\n            return \"nan\"\n        return f\"{n:.6f}\"\n\n    results = []\n    for case in test_cases:\n        p1 = calculate_event_prob(case[\"D\"], case[\"u\"], case[\"u0\"], **case[\"factual\"])\n        p0 = calculate_event_prob(case[\"D\"], case[\"u\"], case[\"u0\"], **case[\"counterfactual\"])\n\n        if p0 == 0.0:\n            if p1 > 0.0:\n                rr = np.inf\n            else: # p1 must also be 0 in cases like D=0\n                rr = np.nan\n        else:\n            rr = p1 / p0\n        \n        results.append(f\"[{format_num(p1)},{format_num(p0)},{format_num(rr)}]\")\n    \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}