{
    "hands_on_practices": [
        {
            "introduction": "在使用任何评分规则之前，理解其基本属性至关重要。本练习  旨在建立对布莱尔分数 (Brier score) 核心特性的直观理解。通过分析一个假设的“完美预言机”，我们首先确立一个理论基准，即理想情况下的最佳分数。然后，通过引入一个观测误差模型，我们学习如何量化不完美验证数据的影响，这是现实地解释预报性能的关键一步。",
            "id": "4079336",
            "problem": "考虑一个在数值天气预报和气候建模中的二元事件验证设定，其中事件指示变量记为 $y \\in \\{0,1\\}$，预报发出一个概率 $p \\in [0,1]$。对于单个二元预报-观测对，布里尔分数 (Brier score) 定义为 $S(p,y) = (p - y)^{2}$。假设存在一个能够获知真实事件的确定性预言机 (deterministic oracle)，它在任何情况下都发出 $p = y$ 的预报。\n\n现在考虑两种验证情景：\n- 完美验证：评估使用真实的指示变量 $y$。\n- 观测误差：验证使用一个受损的指示变量 $\\tilde{y}$，使得在给定 $y$ 的条件下，观测到的 $\\tilde{y}$ 等于 $y$ 的概率为 $1 - \\epsilon$，等于 $1 - y$ 的概率为 $\\epsilon$，其中 $0 \\leq \\epsilon \\leq 1$。假设错误分类与预报以及 $y$ 的数据生成机制无关。\n\n在这些假设下，从第一性原理出发，推导确定性预言机 $p=y$ 在每种情景下的期望布里尔分数。在观测误差情景中，期望必须是关于由真实 $y$ 和 $\\tilde{y}$ 的误差过程所导出的联合分布来计算的，并且最终答案必须纯粹表示为 $\\epsilon$ 的函数（即，它不能依赖于 $y$ 的分布）。\n\n将最终答案以一个包含以下两个元素的行矩阵形式给出：\n- 完美验证下的期望布里尔分数，以及\n- 上述观测误差模型下的期望布里尔分数。\n\n不需要数值近似。如果选择简化，请将任何最终表达式以精确的符号形式表示。最终答案必须是无单位的且精确表达。",
            "solution": "问题要求计算一个确定性预言机在两种不同验证情景下的期望布里尔分数：一种是完美观测，另一种是受损观测。我们将分别处理每种情景。\n\n对于单个预报-观测对，布里尔分数由 $S(p,y) = (p - y)^{2}$ 给出，其中 $p \\in [0,1]$ 是预报概率，$y \\in \\{0,1\\}$ 是二元事件指示变量。\n确定性预言机被定义为对真实事件有完美认知，因此发出预报 $p = y$。\n\n**情景1：完美验证**\n在这种情景下，评估使用真实的事件指示变量 $y$。预言机的预报是 $p = y$。我们将其代入布里尔分数的定义中：\n$$\nS(p,y) = S(y,y) = (y - y)^{2}\n$$\n对于事件的任何实现，无论是 $y=0$ 还是 $y=1$，分数都是：\n$$\nS(y,y) = (0)^{2} = 0\n$$\n由于对于事件 $y$ 的每一个可能结果，分数都恒等于 $0$，因此其期望值也为 $0$。令 $E[\\cdot]$ 表示关于 $y$ 的分布的期望算子。\n$$\nE[S(p,y)] = E[(y-y)^{2}] = E[0] = 0\n$$\n因此，在完美验证下，完美预言机的期望布里尔分数为 $0$。这个结果与事件 $y$ 的潜在气候学概率无关。\n\n**情景2：观测误差**\n在这种情景下，评估使用一个受损的事件指示变量 $\\tilde{y}$。预言机的预报仍然基于真实事件，所以 $p=y$。布里尔分数现在计算为 $S(p, \\tilde{y}) = (p - \\tilde{y})^{2}$。代入 $p=y$，分数变为：\n$$\nS(y, \\tilde{y}) = (y - \\tilde{y})^{2}\n$$\n我们需要计算这个分数的期望值 $E[(y - \\tilde{y})^{2}]$，其中期望是关于真实事件 $y$ 和受损观测 $\\tilde{y}$ 的联合分布来计算的。我们可以使用全期望定律，以真实事件 $y$ 为条件来计算：\n$$\nE[(y - \\tilde{y})^{2}] = E_{y} \\left[ E_{\\tilde{y}|y} \\left[ (y - \\tilde{y})^{2} | y \\right] \\right]\n$$\n我们首先计算内部的期望，即在真实事件 $y$ 的一个特定实现下的条件期望分数。受损观测 $\\tilde{y}$ 的分布是在给定 $y$ 的条件下的：\n$P(\\tilde{y} = y | y) = 1 - \\epsilon$\n$P(\\tilde{y} = 1 - y | y) = \\epsilon$\n\n项 $(y - \\tilde{y})^{2}$ 可以根据 $\\tilde{y}$ 的值取两个可能的值：\n1. 如果 $\\tilde{y} = y$（无误差），则 $(y - \\tilde{y})^{2} = (y-y)^{2} = 0$。这以概率 $1 - \\epsilon$ 发生。\n2. 如果 $\\tilde{y} = 1 - y$（有误差），则 $(y - \\tilde{y})^{2} = (y - (1-y))^{2} = (2y - 1)^{2}$。这以概率 $\\epsilon$ 发生。\n\n因此，内部的条件期望是：\n$$\nE_{\\tilde{y}|y} \\left[ (y - \\tilde{y})^{2} | y \\right] = 0 \\cdot P(\\tilde{y}=y|y) + (2y - 1)^{2} \\cdot P(\\tilde{y}=1-y|y)\n$$\n$$\nE_{\\tilde{y}|y} \\left[ (y - \\tilde{y})^{2} | y \\right] = 0 \\cdot (1-\\epsilon) + (2y - 1)^{2} \\cdot \\epsilon = (2y - 1)^{2} \\epsilon\n$$\n现在，我们必须计算关于真实事件 $y$ 分布的外部期望：\n$$\nE[(y - \\tilde{y})^{2}] = E_{y} \\left[ (2y - 1)^{2} \\epsilon \\right]\n$$\n由于 $\\epsilon$ 是一个常数，我们可以将其从期望中提出：\n$$\nE[(y - \\tilde{y})^{2}] = \\epsilon \\cdot E_{y} \\left[ (2y - 1)^{2} \\right]\n$$\n随机变量 $y$ 只能取值于 $\\{0, 1\\}$。我们来为每种情况计算项 $(2y-1)^{2}$ 的值：\n- 如果 $y=1$，则 $(2(1)-1)^{2} = (1)^{2} = 1$。\n- 如果 $y=0$，则 $(2(0)-1)^{2} = (-1)^{2} = 1$。\n在真实事件 $y$ 的两种可能状态下，量 $(2y-1)^{2}$ 都恒等于 $1$。因此，它的期望也为 $1$，而与 $y$ 的概率分布无关（即，与 $P(y=1)$ 无关）：\n$$\nE_{y} \\left[ (2y - 1)^{2} \\right] = 1\n$$\n将此结果代回我们总期望分数的表达式中：\n$$\nE[(y - \\tilde{y})^{2}] = \\epsilon \\cdot 1 = \\epsilon\n$$\n在指定的观测误差模型下，完美预言机的期望布里尔分数为 $\\epsilon$。根据问题陈述的要求，这个结果只依赖于误差概率 $\\epsilon$，而不依赖于事件 $y$ 的气候学特征。\n\n总结一下，所要求的两个值是：\n1. 完美验证下的期望布里尔分数：$0$。\n2. 观测误差下的期望布里尔分数：$\\epsilon$。\n\n这些值以一个包含两个元素的行矩阵形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\epsilon\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "现代数值天气预报通常以集合预报的形式发布，而连续分级概率评分 (CRPS) 是评估温度等连续变量预报质量的核心工具。然而，直接根据其积分定义计算 CRPS 是不切实际的。此练习  旨在弥合 CRPS 理论定义与其实际应用于集合预报之间的鸿沟，您将推导出一个优雅且高效的代数公式——这是业务化预报检验中的标准工具，它将一个棘手的积分问题转化为一个基于排序的快速计算。",
            "id": "4079332",
            "problem": "一个数值天气预报系统发布了针对单个地点的每日 $2$ 米气温（开尔文）的等权重集合预报，该预报包含 $m$ 个集合成员 $\\{x_{i}\\}_{i=1}^{m}$ 和一个验证观测值 $y$。任务是使用连续分级概率评分（CRPS）来评估此概率预报的质量。CRPS 对于一个预报累积分布函数 $F$ 和观测值 $y$ 由以下积分定义：\n$$\n\\mathrm{CRPS}(F,y) = \\int_{-\\infty}^{\\infty} \\left(F(z) - \\mathbb{1}\\{z \\ge y\\}\\right)^{2} \\, dz,\n$$\n其中 $\\mathbb{1}\\{\\cdot\\}$ 表示指示函数。对于一个等权重集合，预报累积分布函数是经验分布：\n$$\nF(z) = \\frac{1}{m} \\sum_{i=1}^{m} \\mathbb{1}\\{x_{i} \\le z\\}.\n$$\n仅从这些定义出发，推导出一个关于 $\\mathrm{CRPS}(F,y)$ 的闭式代数表达式，该表达式用已排序的集合 $\\{x_{(i)}\\}_{i=1}^{m}$、观测值 $y$ 以及可在排序后计算的累积和来表示。你的表达式必须清楚地说明如何通过对 $\\{x_{i}\\}$ 进行排序并使用累积和来评估所需的量，从而实现一个计算复杂度为 $\\mathcal{O}(m \\log m)$ 的算法。\n\n然后，将你推导的表达式应用于以下以未排序顺序给出的集合（开尔文）和观测值（开尔文）：\n$$\n\\{x_{i}\\}_{i=1}^{8} = \\{300, 295, 303, 289, 298, 301, 296, 292\\}, \\quad y = 297.\n$$\n计算以开尔文为单位的 CRPS，并将你的最终数值答案四舍五入到四位有效数字。以开尔文表示最终分数。作为背景，请注意，其他概率评分规则，如布莱尔分数（Brier Score, BS）和受试者工作特征（ROC）曲线，针对的是预报质量的不同方面，但本问题侧重于 CRPS。",
            "solution": "该问题要求为等权重集合预报的连续分级概率评分（CRPS）推导出一个代数表达式，并应用于给定的数据集。\n\nCRPS有一个等价的、更便于计算的定义，它基于预测分布中随机抽取的样本：\n$$\n\\mathrm{CRPS}(F,y) = \\mathbb{E}_{F}[|X - y|] - \\frac{1}{2}\\mathbb{E}_{F}[|X - X'|]\n$$\n其中 $X$ 和 $X'$ 是从预测分布 $F$ 中独立抽取的两个随机变量。对于由 $m$ 个等权重集合成员 $\\{x_i\\}_{i=1}^m$ 定义的经验分布函数 $F$，期望值可以被替换为样本均值。\n\n第一项是集合成员与观测值之间平均绝对误差（MAE）：\n$$\n\\mathbb{E}_{F}[|X - y|] = \\frac{1}{m} \\sum_{i=1}^{m} |x_i - y|\n$$\n这一项衡量了预报的准确度。\n\n第二项是集合成员之间平均绝对差的一半，衡量了预报分布的离散度或锐度：\n$$\n\\frac{1}{2}\\mathbb{E}_{F}[|X - X'|] = \\frac{1}{2} \\left( \\frac{1}{m^2} \\sum_{i=1}^{m} \\sum_{j=1}^{m} |x_i - x_j| \\right)\n$$\n直接计算这个双重求和的复杂度是 $\\mathcal{O}(m^2)$。为了实现 $\\mathcal{O}(m \\log m)$ 的复杂度（主要由排序驱动），我们必须简化这个求和。首先，将集合成员按非降序排序，得到 $x_{(1)} \\le x_{(2)} \\le \\dots \\le x_{(m)}$。然后，我们可以重写绝对值的双重求和。考虑到对称性以及 $|x_{(i)} - x_{(j)}| = x_{(i)} - x_{(j)}$ 当 $i > j$ 时：\n$$\n\\sum_{i=1}^{m} \\sum_{j=1}^{m} |x_{(i)} - x_{(j)}| = 2 \\sum_{i=2}^{m} \\sum_{j=1}^{i-1} (x_{(i)} - x_{(j)})\n$$\n现在我们分析内层求和。对于一个固定的 $i$：\n$$\n\\sum_{j=1}^{i-1} (x_{(i)} - x_{(j)}) = (i-1)x_{(i)} - \\sum_{j=1}^{i-1} x_{(j)}\n$$\n这个表达式可以通过一次遍历已排序的集合并维护一个累积和来高效计算。一个更简洁的方法是考虑每个 $x_{(k)}$ 在总和 $\\sum_{i>j} (x_{(i)} - x_{(j)})$ 中的系数。$x_{(k)}$ 作为 $x_{(i)}$ （当 $i=k$）出现时，它被加了 $k-1$ 次；作为 $x_{(j)}$ （当 $j=k$）出现时，它被减了 $m-k$ 次。因此，$x_{(k)}$ 的总系数是 $(k-1) - (m-k) = 2k - m - 1$。\n所以，双重求和可以简化为：\n$$\n\\sum_{i=1}^{m} \\sum_{j=1}^{m} |x_i - x_j| = 2 \\sum_{k=1}^{m} (2k - m - 1) x_{(k)}\n$$\n将所有部分组合在一起，我们得到CRPS的高效计算公式：\n$$\n\\mathrm{CRPS}(F_m, y) = \\frac{1}{m}\\sum_{i=1}^m |x_i - y| - \\frac{1}{m^2}\\sum_{k=1}^m (2k - m - 1) x_{(k)}\n$$\n这个公式的计算首先需要 $\\mathcal{O}(m \\log m)$ 时间进行排序，然后两个求和项都可以在 $\\mathcal{O}(m)$ 时间内完成。\n\n**应用到具体数据：**\n\n给定的集合为 $\\{x_{i}\\} = \\{300, 295, 303, 289, 298, 301, 296, 292\\}$，观测值为 $y = 297$。集合大小 $m = 8$。\n\n1.  **排序集合：**\n    $x_{(1)}=289, x_{(2)}=292, x_{(3)}=295, x_{(4)}=296, x_{(5)}=298, x_{(6)}=300, x_{(7)}=301, x_{(8)}=303$。\n\n2.  **计算第一项（准确度项）：**\n    $$\n    \\frac{1}{8} \\sum_{i=1}^{8} |x_i - 297| = \\frac{1}{8} (|300-297| + |295-297| + |303-297| + |289-297| + |298-297| + |301-297| + |296-297| + |292-297|)\n    $$\n    $$\n    = \\frac{1}{8} (3 + 2 + 6 + 8 + 1 + 4 + 1 + 5) = \\frac{30}{8} = 3.75\n    $$\n\n3.  **计算第二项（离散度项的简化部分）：**\n    我们需要计算 $\\frac{1}{m^2}\\sum_{k=1}^m (2k - m - 1) x_{(k)} = \\frac{1}{64}\\sum_{k=1}^8 (2k - 9) x_{(k)}$。\n    系数 $(2k - 9)$ 分别为：$-7, -5, -3, -1, 1, 3, 5, 7$。\n    求和为：\n    \\begin{align*}\n    (-7 \\times 289) + (-5 \\times 292) + (-3 \\times 295) + (-1 \\times 296) + (1 \\times 298) + (3 \\times 300) + (5 \\times 301) + (7 \\times 303) \\\\\n    = -2023 - 1460 - 885 - 296 + 298 + 900 + 1505 + 2121 \\\\\n    = 4824 - 4664 = 160\n    \\end{align*}\n    完整的离散度项是 $\\frac{1}{2m^2} \\sum_{i,j}|x_i-x_j| = \\frac{1}{m^2} \\sum_{k=1}^m (2k-m-1)x_{(k)} = \\frac{160}{64} = 2.5$。\n\n4.  **最终CRPS计算：**\n    $$\n    \\mathrm{CRPS} = (\\text{准确度项}) - (\\text{离散度项}) = 3.75 - 2.5 = 1.25\n    $$\n    四舍五入到四位有效数字，结果是 $1.250$ 开尔文。",
            "answer": "$$\\boxed{1.250}$$"
        },
        {
            "introduction": "评分规则不仅用于评估预报，更可以用来改进预报。本练习  将带您进入预报研发的前沿领域，在这里，预报检验与模型训练融为一体。通过将像布莱尔分数这样的“恰当”评分规则视为一个可微的目标函数，您将应用微积分和优化理论，为校准一个概率模型推导出二阶优化算法所需的关键要素，从而将一个检验指标转化为一个强大的预报改进工具。",
            "id": "4079349",
            "problem": "在数值天气预报（NWP）中，使用概率分类器来预测二元事件的发生（例如，某地的24小时累积降水量是否超过一个固定阈值）。对于一个大小为 $N$ 的数据集，令 $\\{(x_{i}, y_{i})\\}_{i=1}^{N}$ 表示特征向量 $x_{i} \\in \\mathbb{R}^{d}$（源自数值天气预报模式的输出）和二元结果 $y_{i} \\in \\{0,1\\}$。该模型输出一个参数化概率预报 $p_{\\theta}(x_{i}) \\in (0,1)$，其中 $\\theta \\in \\mathbb{R}^{d}$，并且 $p_{\\theta}(\\cdot)$ 关于 $\\theta$ 是二次连续可微的。\n\n定义样本平均Brier分数\n$$\nJ(\\theta) \\equiv \\frac{1}{N} \\sum_{i=1}^{N} \\big(p_{\\theta}(x_{i}) - y_{i}\\big)^{2}.\n$$\n\n从概率评分规则和微积分（链式法则和乘法法则）的核心定义出发，并且不借助任何预先推导的梯度或Hessian恒等式：\n\n1) 推导梯度 $\\nabla_{\\theta} J(\\theta)$ 和Hessian矩阵 $\\nabla_{\\theta}^{2} J(\\theta)$，用 $\\nabla_{\\theta} p_{\\theta}(x_{i})$ 和 $\\nabla_{\\theta}^{2} p_{\\theta}(x_{i})$ 表示。\n\n2) 将您的结果特化到逻辑斯蒂校准模型 $p_{\\theta}(x) = \\sigma(\\theta^{\\top} x)$，其中 $\\sigma(u) = \\frac{1}{1 + \\exp(-u)}$，并用 $\\{x_{i}, y_{i}\\}$ 和 $\\theta$ 明确表示 $\\nabla_{\\theta} J(\\theta)$ 和 $\\nabla_{\\theta}^{2} J(\\theta)$。\n\n3) 提出一个适用于校准的二阶优化方案，该方案基于使用Tikhonov正则化参数 $\\gamma  0$ 的阻尼牛顿步，并用您推导出的梯度和Hessian矩阵写出单次迭代更新公式 $\\theta_{t+1}$。\n\n将您的最终答案表示为单个闭式解析表达式，使用行矩阵将梯度、Hessian矩阵和阻尼牛顿更新的表达式收集到一行中。不需要进行数值计算。不包含任何单位。不需要进行四舍五入。",
            "solution": "目标函数是样本平均Brier分数，由下式给出\n$$\nJ(\\theta) = \\frac{1}{N} \\sum_{i=1}^{N} \\left( p_{\\theta}(x_i) - y_i \\right)^2\n$$\n为简化符号，令 $p_i(\\theta) = p_{\\theta}(x_i)$。目标函数是各个损失项的总和，$J(\\theta) = \\frac{1}{N} \\sum_{i=1}^{N} L_i(\\theta)$，其中 $L_i(\\theta) = (p_i(\\theta) - y_i)^2$。由于微分算子的线性性质，我们可以通过对每项的贡献求和来计算梯度和Hessian矩阵。\n\n**1) 通用梯度和Hessian矩阵**\n\n首先，我们计算梯度向量 $\\nabla_{\\theta} J(\\theta)$。梯度的第 $k$ 个分量是关于 $\\theta_k$ 的偏导数：\n$$\n\\frac{\\partial J(\\theta)}{\\partial \\theta_k} = \\frac{1}{N} \\sum_{i=1}^{N} \\frac{\\partial}{\\partial \\theta_k} \\left( p_i(\\theta) - y_i \\right)^2\n$$\n应用链式法则得到：\n$$\n\\frac{\\partial J(\\theta)}{\\partial \\theta_k} = \\frac{1}{N} \\sum_{i=1}^{N} 2 \\left( p_i(\\theta) - y_i \\right) \\frac{\\partial p_i(\\theta)}{\\partial \\theta_k}\n$$\n将这些分量组合成一个向量，得到梯度：\n$$\n\\nabla_{\\theta} J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} \\left( p_i(\\theta) - y_i \\right) \\nabla_{\\theta} p_i(\\theta)\n$$\n\n接下来，我们计算Hessian矩阵 $\\nabla_{\\theta}^2 J(\\theta)$。Hessian矩阵第 $j$ 行第 $k$ 列的元素是二阶偏导数 $\\frac{\\partial^2 J(\\theta)}{\\partial \\theta_j \\partial \\theta_k}$。我们将关于 $\\frac{\\partial J(\\theta)}{\\partial \\theta_k}$ 的表达式对 $\\theta_j$ 求导：\n$$\n\\frac{\\partial^2 J(\\theta)}{\\partial \\theta_j \\partial \\theta_k} = \\frac{\\partial}{\\partial \\theta_j} \\left[ \\frac{2}{N} \\sum_{i=1}^{N} \\left( p_i(\\theta) - y_i \\right) \\frac{\\partial p_i(\\theta)}{\\partial \\theta_k} \\right]\n$$\n对求和号内的各项应用乘法法则：\n$$\n\\frac{\\partial}{\\partial \\theta_j} \\left[ \\left( p_i(\\theta) - y_i \\right) \\frac{\\partial p_i(\\theta)}{\\partial \\theta_k} \\right] = \\left( \\frac{\\partial p_i(\\theta)}{\\partial \\theta_j} \\right) \\left( \\frac{\\partial p_i(\\theta)}{\\partial \\theta_k} \\right) + \\left( p_i(\\theta) - y_i \\right) \\left( \\frac{\\partial^2 p_i(\\theta)}{\\partial \\theta_j \\partial \\theta_k} \\right)\n$$\n在矩阵表示法中，第一项 $\\frac{\\partial p_i(\\theta)}{\\partial \\theta_j} \\frac{\\partial p_i(\\theta)}{\\partial \\theta_k}$ 对应于外积 $(\\nabla_{\\theta} p_i(\\theta))(\\nabla_{\\theta} p_i(\\theta))^{\\top}$ 的第 $(j,k)$ 个元素。第二项是矩阵 $( p_i(\\theta) - y_i ) \\nabla_{\\theta}^2 p_i(\\theta)$ 的第 $(j,k)$ 个元素。对所有数据点求和并乘以常数因子，Hessian矩阵为：\n$$\n\\nabla_{\\theta}^2 J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} \\left[ (\\nabla_{\\theta} p_i(\\theta)) (\\nabla_{\\theta} p_i(\\theta))^{\\top} + (p_i(\\theta) - y_i) \\nabla_{\\theta}^2 p_i(\\theta) \\right]\n$$\n\n**2) 对逻辑斯蒂模型的特化**\n\n对于这部分，我们特化到 $p_i(\\theta) = p_{\\theta}(x_i) = \\sigma(\\theta^{\\top} x_i)$，其中 $\\sigma(u) = (1 + \\exp(-u))^{-1}$。令 $u_i(\\theta) = \\theta^{\\top} x_i$。首先，我们需要sigmoid函数 $\\sigma(u)$ 的导数：\n$$\n\\sigma'(u) = \\frac{d\\sigma}{du} = \\frac{\\exp(-u)}{(1+\\exp(-u))^2} = \\frac{1}{1+\\exp(-u)} \\frac{\\exp(-u)}{1+\\exp(-u)} = \\sigma(u)(1-\\sigma(u))\n$$\n以及二阶导数：\n$$\n\\sigma''(u) = \\frac{d}{du} \\left( \\sigma(u) - \\sigma(u)^2 \\right) = \\sigma'(u) - 2\\sigma(u)\\sigma'(u) = \\sigma'(u)(1-2\\sigma(u)) = \\sigma(u)(1-\\sigma(u))(1-2\\sigma(u))\n$$\n现在我们使用多元链式法则求出 $p_i(\\theta)$ 关于 $\\theta$ 的导数。注意，由于 $u_i$ 在 $\\theta$ 中是线性的，因此 $\\nabla_{\\theta} u_i(\\theta) = x_i$ 且 $\\nabla_{\\theta}^2 u_i(\\theta) = \\mathbf{0}$（零矩阵）。\n$$\n\\nabla_{\\theta} p_i(\\theta) = \\sigma'(u_i) \\nabla_{\\theta} u_i(\\theta) = \\sigma(u_i)(1-\\sigma(u_i)) x_i = p_i(\\theta)(1 - p_i(\\theta)) x_i\n$$\n对于 $p_i(\\theta)$ 的Hessian矩阵：\n$$\n\\nabla_{\\theta}^2 p_i(\\theta) = \\nabla_{\\theta} \\left( \\sigma'(u_i) x_i^{\\top} \\right)^{\\top} = \\nabla_{\\theta} \\left( \\sigma'(u_i) x_i \\right) = x_i (\\nabla_{\\theta} \\sigma'(u_i))^{\\top} = x_i \\left( \\sigma''(u_i) (\\nabla_{\\theta} u_i)^{\\top} \\right) = \\sigma''(u_i) x_i x_i^{\\top}\n$$\n代入 $\\sigma''(u_i)$ 的表达式：\n$$\n\\nabla_{\\theta}^2 p_i(\\theta) = p_i(\\theta)(1-p_i(\\theta))(1-2p_i(\\theta)) x_i x_i^{\\top}\n$$\n现在，我们将这些特化的导数代入 $J(\\theta)$ 的通用梯度和Hessian矩阵表达式中。为清晰起见，我们用 $p_{i,\\theta}$ 表示 $p_{\\theta}(x_i) = \\sigma(\\theta^{\\top}x_i)$。\n\n梯度变为：\n$$\n\\nabla_{\\theta} J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} (p_{i,\\theta} - y_i) \\left( p_{i,\\theta}(1 - p_{i,\\theta}) x_i \\right) = \\frac{2}{N} \\sum_{i=1}^{N} (p_{i,\\theta} - y_i) p_{i,\\theta}(1 - p_{i,\\theta}) x_i\n$$\nHessian矩阵变为：\n\\begin{align*}\n\\nabla_{\\theta}^2 J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} \\left[ \\left( p_{i,\\theta}(1 - p_{i,\\theta}) x_i \\right) \\left( p_{i,\\theta}(1 - p_{i,\\theta}) x_i \\right)^{\\top} + (p_{i,\\theta} - y_i) \\left( p_{i,\\theta}(1 - p_{i,\\theta})(1 - 2p_{i,\\theta}) x_i x_i^{\\top} \\right) \\right] \\\\\n= \\frac{2}{N} \\sum_{i=1}^{N} \\left[ (p_{i,\\theta}(1 - p_{i,\\theta}))^2 + (p_{i,\\theta} - y_i) p_{i,\\theta}(1 - p_{i,\\theta})(1 - 2p_{i,\\theta}) \\right] x_i x_i^{\\top}\n\\end{align*}\n\n**3) 阻尼牛顿优化方案**\n\n目标是找到最小化 $J(\\theta)$ 的 $\\theta$。二阶优化方法，即牛顿法，使用更新规则 $\\theta_{t+1} = \\theta_t - (\\nabla_{\\theta}^2 J(\\theta_t))^{-1} \\nabla_{\\theta} J(\\theta_t)$。为了确保Hessian矩阵是正定且可逆的，并控制步长，我们采用Tikhonov正则化。这涉及将单位矩阵的正倍数 $\\gamma I$（其中 $\\gamma  0$）加到Hessian矩阵上。这也称为Levenberg-Marquardt类型的方法。更新步长 $\\Delta\\theta_t = \\theta_{t+1} - \\theta_t$ 通过求解以下线性系统找到：\n$$\n(\\nabla_{\\theta}^2 J(\\theta_t) + \\gamma I) \\Delta\\theta_t = - \\nabla_{\\theta} J(\\theta_t)\n$$\n求解 $\\Delta\\theta_t$ 并更新 $\\theta_t$ 得到单次迭代更新公式：\n$$\n\\theta_{t+1} = \\theta_t - \\left(\\nabla_{\\theta}^2 J(\\theta_t) + \\gamma I\\right)^{-1} \\nabla_{\\theta} J(\\theta_t)\n$$\n该公式使用前面部分推导出的、在当前迭代点 $\\theta_t$ 处求值的梯度和Hessian矩阵。\n\n根据要求，针对逻辑斯蒂情况特化的三个部分的最终结果汇总如下。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\nabla_{\\theta} J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} (p_{i,\\theta} - y_i) p_{i,\\theta}(1-p_{i,\\theta}) x_i   \\nabla_{\\theta}^2 J(\\theta) = \\frac{2}{N} \\sum_{i=1}^{N} \\left[ (p_{i,\\theta}(1 - p_{i,\\theta}))^2 + (p_{i,\\theta} - y_i) p_{i,\\theta}(1 - p_{i,\\theta})(1 - 2p_{i,\\theta}) \\right] x_i x_i^{\\top}   \\theta_{t+1} = \\theta_t - \\left(\\nabla_{\\theta}^2 J(\\theta_t) + \\gamma I\\right)^{-1} \\nabla_{\\theta} J(\\theta_t)\n\\end{pmatrix}\n}\n$$"
        }
    ]
}