{
    "hands_on_practices": [
        {
            "introduction": "在集合资料同化中，我们使用一个有限大小的集合来估计高维状态空间的背景误差协方差。当集合成员数 $N$ 远小于状态向量的维度 $n$ 时，这种估计不可避免地会产生采样误差，导致样本协方差矩阵是秩亏的，并包含虚假的远距离相关。这个练习通过一个精心设计的简单例子，清晰地揭示了采样误差的严重后果：它可能导致集合在某个方向上的方差为零，从而在分析更新步骤中完全忽略该方向上的观测信息。通过这个计算，你将亲身体会到为何协方差膨胀和局地化是集合卡尔曼滤波器不可或缺的组成部分。",
            "id": "4036305",
            "problem": "考虑一个在数值天气预报和气候模拟中的线性高斯数据同化设定，其状态向量 $x \\in \\mathbb{R}^{3}$ 代表了沿一条样带上邻近格点的三个粗粒度、无量纲的预报变量。一个包含 $N=2$ 个成员的集合被用来表示背景平均态 $m^{b} \\in \\mathbb{R}^{3}$ 的先验不确定性。设集合成员为\n$$\nx^{(1)} = m^{b} + \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\end{pmatrix}, \\qquad\nx^{(2)} = m^{b} + \\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}.\n$$\n一个单一的标量观测针对第三个分量，其观测算子为 $H = \\begin{pmatrix} 0 & 0 & 1 \\end{pmatrix}$，观测值为 $y \\in \\mathbb{R}$，观测误差方差为 $R = 0.25$。假设新息为 $d = y - H m^{b} = 1$。在分析之前，对集合异常应用因子为 $\\gamma = 1.5$ 的乘性膨胀。然后通过与局地化矩阵 $L \\in \\mathbb{R}^{3 \\times 3}$（其中 $L$ 是单位矩阵）进行舒尔积来实现协方差局地化。\n\n从标准的线性高斯假设出发，背景集合样本协方差 $P^{e}$ 由集合异常和归一化二阶矩估计定义，而分析平均增量由卡尔曼增益决定的线性更新给出。仅使用这些基本原理，完成以下操作：\n\n1.  构建异常矩阵 $A \\in \\mathbb{R}^{3 \\times 2}$ 并显式计算给定 $N=2$ 和 $n=3$ 配置下的集合样本协方差 $P^{e}$。\n2.  应用乘性膨胀从 $P^{e}$ 得到膨胀后的先验协方差 $P^{f}$，然后应用所述的局地化得到 $P^{\\text{loc}}$。\n3.  使用线性高斯分析法则，计算通过同化具有新息 $d$ 的单一观测所产生的分析平均增量向量 $\\Delta m^{a}$。\n\n将分析平均增量的第一个分量，即标量 $\\Delta m^{a}_{1}$，作为最终答案报告。将最终答案表示为一个无量纲实数。无需四舍五入。",
            "solution": "将通过以下步骤解决该问题：构建先验集合协方差矩阵，应用膨胀和局地化，然后使用线性高斯数据同化理论中的卡尔曼增益公式计算分析平均增量。\n\n**步骤 1：构建异常矩阵和集合样本协方差**\n\n状态向量位于 $\\mathbb{R}^{3}$，集合有 $N=2$ 个成员。集合成员以其与背景平均态 $m^{b}$ 的偏差形式给出：\n$$\nx^{(1)} = m^{b} + \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\end{pmatrix}, \\qquad\nx^{(2)} = m^{b} + \\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n集合平均为 $\\bar{x} = \\frac{1}{N} \\sum_{i=1}^{N} x^{(i)}$。对于 $N=2$，这等于：\n$$\n\\bar{x} = \\frac{1}{2} \\left[ \\left( m^{b} + \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\end{pmatrix} \\right) + \\left( m^{b} + \\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix} \\right) \\right] = \\frac{1}{2} \\left[ 2m^b + \\begin{pmatrix} 2-2 \\\\ -1+1 \\\\ 0+0 \\end{pmatrix} \\right] = m^b\n$$\n因此，背景平均态 $m^{b}$ 就是集合平均。集合异常（与平均值的偏差）为：\n$$\nx'^{(1)} = x^{(1)} - \\bar{x} = \\begin{pmatrix} 2 \\\\ -1 \\\\ 0 \\end{pmatrix}, \\qquad\nx'^{(2)} = x^{(2)} - \\bar{x} = \\begin{pmatrix} -2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n异常矩阵 $A \\in \\mathbb{R}^{3 \\times 2}$ 由这些列向量构成：\n$$\nA = \\begin{pmatrix} 2 & -2 \\\\ -1 & 1 \\\\ 0 & 0 \\end{pmatrix}\n$$\n集合样本协方差矩阵 $P^{e}$ 由归一化二阶矩估计定义：\n$$\nP^{e} = \\frac{1}{N-1} A A^T\n$$\n当 $N=2$ 时，归一化因子为 $\\frac{1}{2-1} = 1$。因此：\n$$\nP^{e} = A A^T = \\begin{pmatrix} 2 & -2 \\\\ -1 & 1 \\\\ 0 & 0 \\end{pmatrix} \\begin{pmatrix} 2 & -1 & 0 \\\\ -2 & 1 & 0 \\end{pmatrix}\n$$\n$$\nP^{e} = \\begin{pmatrix} (2)(2)+(-2)(-2) & (2)(-1)+(-2)(1) & (2)(0)+(-2)(0) \\\\ (-1)(2)+(1)(-2) & (-1)(-1)+(1)(1) & (-1)(0)+(1)(0) \\\\ (0)(2)+(0)(-2) & (0)(-1)+(0)(1) & (0)(0)+(0)(0) \\end{pmatrix}\n$$\n$$\nP^{e} = \\begin{pmatrix} 4+4 & -2-2 & 0 \\\\ -2-2 & 1+1 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 8 & -4 & 0 \\\\ -4 & 2 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n\n**步骤 2：应用乘性膨胀和协方差局地化**\n\n对集合异常应用因子为 $\\gamma=1.5$ 的乘性膨胀。这等价于将协方差矩阵按 $\\gamma^2$ 比例缩放。膨胀后的先验协方差 $P^{f}$ 为：\n$$\nP^{f} = \\gamma^2 P^{e} = (1.5)^2 P^{e} = 2.25 P^{e}\n$$\n$$\nP^{f} = 2.25 \\begin{pmatrix} 8 & -4 & 0 \\\\ -4 & 2 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 18 & -9 & 0 \\\\ -9 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n接下来，通过与局地化矩阵 $L$（即单位矩阵 $I$）进行舒尔（逐元素）积来实现协方差局地化。\n$$\nP^{\\text{loc}} = L \\circ P^{f} = I \\circ P^{f}\n$$\n$$\nP^{\\text{loc}} = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\circ \\begin{pmatrix} 18 & -9 & 0 \\\\ -9 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n$$\nP^{\\text{loc}} = \\begin{pmatrix} 1 \\times 18 & 0 \\times (-9) & 0 \\times 0 \\\\ 0 \\times (-9) & 1 \\times 4.5 & 0 \\times 0 \\\\ 0 \\times 0 & 0 \\times 0 & 1 \\times 0 \\end{pmatrix} = \\begin{pmatrix} 18 & 0 & 0 \\\\ 0 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\n这个矩阵 $P^{\\text{loc}}$ 是用于分析更新的最终先验误差协方差。我们将其表示为 $P_{b} = P^{\\text{loc}}$。\n\n**步骤 3：计算分析平均增量**\n\n分析平均更新由 $m^{a} = m^{b} + K(y - H m^{b})$ 给出，其中 $K$ 是卡尔曼增益，$d = y - Hm^{b}$ 是新息。分析平均增量是 $\\Delta m^{a} = m^{a} - m^{b} = K d$。\n卡尔曼增益定义为：\n$$\nK = P_{b} H^T (H P_{b} H^T + R)^{-1}\n$$\n给定的量是：\n- 观测算子：$H = \\begin{pmatrix} 0 & 0 & 1 \\end{pmatrix}$\n- 观测误差方差：$R = 0.25$\n- 新息：$d = 1$\n- 先验误差协方差：$P_{b} = P^{\\text{loc}} = \\begin{pmatrix} 18 & 0 & 0 \\\\ 0 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix}$\n\n我们计算卡尔曼增益所需的各项：\n$$\nP_{b} H^T = \\begin{pmatrix} 18 & 0 & 0 \\\\ 0 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 18(0) + 0(0) + 0(1) \\\\ 0(0) + 4.5(0) + 0(1) \\\\ 0(0) + 0(0) + 0(1) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n卡尔曼增益表达式的分子是零向量。这是因为先验集合对于第三个状态分量（也是唯一被观测的分量）的离散度为零（因此协方差也为零）。\n逆中的项是观测空间中的先验方差加上观测误差方差：\n$$\nH P_{b} H^T = \\begin{pmatrix} 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 18 & 0 & 0 \\\\ 0 & 4.5 & 0 \\\\ 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = 0\n$$\n$$\nH P_{b} H^T + R = 0 + 0.25 = 0.25\n$$\n其逆为 $(0.25)^{-1} = 4$。\n现在，我们可以计算卡尔曼增益 $K$：\n$$\nK = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} (4) = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n分析平均增量向量 $\\Delta m^{a}$ 为：\n$$\n\\Delta m^{a} = K d = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} (1) = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n问题要求该向量的第一个分量 $\\Delta m^{a}_{1}$。\n$$\n\\Delta m^{a}_{1} = 0\n$$\n更新为零，因为先验模式状态在观测变量上没有不确定性，这意味着同化系统在更新状态时赋予新观测的权重为零。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "认识到采样误差的问题后，下一个关键步骤是应用协方差膨胀和局地化等校正技术。然而，这些技术的有效性高度依赖于其关键参数（例如膨胀因子 $\\lambda$ 或局地化半径 $L$）的精确整定。本练习将引导你推导一套强大的诊断工具——Desroziers诊断法。这些诊断关系揭示了在最优配置下，观测与背景场和分析场之差（即“离差”）的统计量应满足的理论恒等式。掌握这些关系不仅能加深你对卡尔曼滤波框架的理解，更重要的是，它为你提供了一种通过比较实际数据与理论期望来客观调整滤波器参数的实用方法。",
            "id": "4036278",
            "problem": "考虑一个在数值天气预报和气候再分析中常见的线性高斯数据同化设定。令真实状态表示为 $x^{t} \\in \\mathbb{R}^{n}$，背景（先验）状态表示为 $x^{b} \\in \\mathbb{R}^{n}$，分析（后验）状态表示为 $x^{a} \\in \\mathbb{R}^{n}$。观测为 $y \\in \\mathbb{R}^{m}$，其线性观测算子为 $H \\in \\mathbb{R}^{m \\times n}$，因此有 $y = H x^{t} + \\epsilon^{o}$。假设误差是无偏、零均值的高斯误差，其协方差分别为 $\\operatorname{cov}(\\epsilon^{o}) = R \\in \\mathbb{R}^{m \\times m}$ 和 $\\operatorname{cov}(\\epsilon^{b}) = P^{b} \\in \\mathbb{R}^{n \\times n}$，并假设 $\\epsilon^{o}$ 和 $\\epsilon^{b}$ 是独立的。在观测空间中定义离差\n$$\nd^{o} := y - H x^{t}, \\quad d^{b} := y - H x^{b}, \\quad d^{a} := y - H x^{a}.\n$$\n令分析由线性卡尔曼更新 $x^{a} = x^{b} + K (y - H x^{b})$ 定义，其中增益为 $K \\in \\mathbb{R}^{n \\times m}$，并定义分析误差协方差为 $P^{a} := \\operatorname{cov}(x^{a} - x^{t})$。\n\na) 从这些定义和线性高斯假设出发，推导 $\\mathbb{E}[d^{o}]$, $\\mathbb{E}[d^{o} (d^{b})^{\\top}]$, 和 $\\mathbb{E}[d^{o} (d^{a})^{\\top}]$ 关于 $R$, $H$ 和 $P^{a}$ 的显式表达式。\n\nb) 在集合卡尔曼滤波器（EnKF）中，背景协方差通常通过舒尔（逐元素）积 $P^{b}_{\\text{loc}} = C(L) \\circ P^{b}_{\\text{ens}}$ 进行局地化，其中 $P^{b}_{\\text{ens}}$ 是原始集合背景协方差，$C(L)$ 是由一个长度尺度为 $L$ 的局地化函数决定的相关矩阵，$\\circ$ 表示逐元素乘法。解释如何利用 (a) 部分得到的关系，在观测空间中定义一个依赖于 $L$ 的诊断目标，并通过减少离差的经验交叉统计量与其理论目标之间的不匹配来指导 $L$ 的调整。\n\nc) 考虑一个标量（$n = m = 1$）实例，用于协同调整乘性膨胀与局地化，这里重点关注膨胀。令 $H = 1$，原始集合背景方差为 $p^{b}_{\\text{ens}} = 1.0$，观测误差方差为 $r = 0.5$。在分析前对背景方差应用标量乘性膨胀 $\\lambda > 0$，使得 $p^{b} = \\lambda \\, p^{b}_{\\text{ens}}$。假设从一长串分析循环中计算出的 $\\mathbb{E}[d^{o} d^{a}]$ 的经验估计值为 $s = 0.35$。在线性高斯卡尔曼假设下，求出 $\\lambda$ 的值，使得 (a) 部分的诊断恒等式在期望意义上对 $\\mathbb{E}[d^{o} d^{a}]$ 成立。将最终答案四舍五入到四位有效数字。将最终答案表示为一个无量纲数。",
            "solution": "首先验证问题以确保其科学上合理、适定且完整。该问题陈述是线性高斯数据同化领域的标准表述，使用了状态、误差和卡尔曼更新的规范定义。所有术语都得到了精确定义，并且假设（线性模型、高斯误差）也已明确说明。该问题在科学上是合理的且自洽的，每个部分都从已建立的框架中逻辑地导出。(a) 部分要求进行标准推导，(b) 部分要求解释一种著名的诊断技术，(c) 部分提出了一个适定的代数问题。该问题被认为是有效的。\n\na) 下面推导离差统计量期望值的表达式。我们假设标准的线性高斯框架、零均值误差，以及卡尔曼增益 $K$ 是最优的，这在此背景下是隐含的。\n\n首先，我们用基本误差量来表示离差。观测误差是 $\\epsilon^{o}$，背景误差是 $\\epsilon^{b} = x^{b} - x^{t}$。\n离差 $d^{o}$（观测减去真实值）是：\n$$\nd^{o} = y - H x^{t} = (H x^{t} + \\epsilon^{o}) - H x^{t} = \\epsilon^{o}\n$$\n离差 $d^{b}$（观测减去背景），也称为新息，是：\n$$\nd^{b} = y - H x^{b} = (H x^{t} + \\epsilon^{o}) - H x^{b} = H(x^{t} - x^{b}) + \\epsilon^{o} = -H \\epsilon^{b} + \\epsilon^{o}\n$$\n离差 $d^{a}$（观测减去分析），或称分析残差，是：\n$$\nd^{a} = y - H x^{a} = H(x^{t} - x^{a}) + \\epsilon^{o} = -H \\epsilon^{a} + \\epsilon^{o}\n$$\n其中 $\\epsilon^{a} = x^{a} - x^{t}$ 是分析误差。\n\n现在，我们计算所要求的期望值。\n\n1.  **$\\mathbb{E}[d^{o}]$**:\n    观测离差的期望值就是观测误差的期望值。\n    $$\n    \\mathbb{E}[d^{o}] = \\mathbb{E}[\\epsilon^{o}]\n    $$\n    根据问题的假设，观测误差是零均值的。\n    $$\n    \\mathbb{E}[d^{o}] = 0\n    $$\n\n2.  **$\\mathbb{E}[d^{o} (d^{b})^{\\top}]$**:\n    我们代入 $d^{o}$ 和 $d^{b}$ 的表达式：\n    $$\n    \\mathbb{E}[d^{o} (d^{b})^{\\top}] = \\mathbb{E}[\\epsilon^{o} (-H \\epsilon^{b} + \\epsilon^{o})^{\\top}] = \\mathbb{E}[\\epsilon^{o} (-(\\epsilon^{b})^{\\top} H^{\\top} + (\\epsilon^{o})^{\\top})]\n    $$\n    利用期望的线性性：\n    $$\n    = -\\mathbb{E}[\\epsilon^{o} (\\epsilon^{b})^{\\top}] H^{\\top} + \\mathbb{E}[\\epsilon^{o} (\\epsilon^{o})^{\\top}]\n    $$\n    问题陈述指出观测误差 $\\epsilon^{o}$ 和背景误差 $\\epsilon^{b}$ 是独立的。因为它们也是零均值的，所以它们的互协方差为零：$\\mathbb{E}[\\epsilon^{o} (\\epsilon^{b})^{\\top}] = \\mathbb{E}[\\epsilon^{o}] \\mathbb{E}[(\\epsilon^{b})^{\\top}] = 0$。根据定义，观测误差的协方差为 $\\operatorname{cov}(\\epsilon^{o}) = \\mathbb{E}[\\epsilon^{o} (\\epsilon^{o})^{\\top}] = R$。\n    因此：\n    $$\n    \\mathbb{E}[d^{o} (d^{b})^{\\top}] = -0 \\cdot H^{\\top} + R = R\n    $$\n\n3.  **$\\mathbb{E}[d^{o} (d^{a})^{\\top}]$**:\n    我们代入 $d^{o}$ 和 $d^{a}$ 的表达式：\n    $$\n    \\mathbb{E}[d^{o} (d^{a})^{\\top}] = \\mathbb{E}[\\epsilon^{o} (-H \\epsilon^{a} + \\epsilon^{o})^{\\top}] = \\mathbb{E}[\\epsilon^{o} (-(\\epsilon^{a})^{\\top} H^{\\top} + (\\epsilon^{o})^{\\top})]\n    $$\n    $$\n    = -\\mathbb{E}[\\epsilon^{o} (\\epsilon^{a})^{\\top}] H^{\\top} + \\mathbb{E}[\\epsilon^{o} (\\epsilon^{o})^{\\top}] = R - \\mathbb{E}[\\epsilon^{o} (\\epsilon^{a})^{\\top}] H^{\\top}\n    $$\n    为了计算这个值，我们需要观测误差 $\\epsilon^{o}$ 和分析误差 $\\epsilon^{a}$ 之间的互协方差。分析误差由下式给出：\n    $$\n    \\epsilon^{a} = x^{a} - x^{t} = x^{b} + K(y - Hx^{b}) - x^{t} = (x^{b}-x^{t}) + K(-H\\epsilon^{b} + \\epsilon^{o}) = (I - KH)\\epsilon^{b} + K\\epsilon^{o}\n    $$\n    现在，我们计算 $\\mathbb{E}[\\epsilon^{o} (\\epsilon^{a})^{\\top}]$：\n    $$\n    \\mathbb{E}[\\epsilon^{o} (\\epsilon^{a})^{\\top}] = \\mathbb{E}[\\epsilon^{o} ((I - KH)\\epsilon^{b} + K\\epsilon^{o})^{\\top}] = \\mathbb{E}[\\epsilon^{o} ((\\epsilon^{b})^{\\top}(I-KH)^{\\top} + (\\epsilon^{o})^{\\top}K^{\\top})]\n    $$\n    $$\n    = \\mathbb{E}[\\epsilon^{o}(\\epsilon^{b})^{\\top}](I-KH)^{\\top} + \\mathbb{E}[\\epsilon^{o}(\\epsilon^{o})^{\\top}]K^{\\top}\n    $$\n    由于独立性，第一项为零，第二项涉及 $R$。\n    $$\n    \\mathbb{E}[\\epsilon^{o} (\\epsilon^{a})^{\\top}] = R K^{\\top}\n    $$\n    将此结果代回 $\\mathbb{E}[d^{o} (d^{a})^{\\top}]$ 的表达式中：\n    $$\n    \\mathbb{E}[d^{o} (d^{a})^{\\top}] = R - (R K^{\\top}) H^{\\top} = R - R K^{\\top} H^{\\top}\n    $$\n    为了用 $P^{a}$ 表示，我们使用最优卡尔曼增益的标准恒等式 $K = P^{a} H^{\\top} R^{-1}$。这假设 $R$ 是可逆的。\n    $$\n    K^{\\top} = (P^{a} H^{\\top} R^{-1})^{\\top} = (R^{-1})^{\\top} (H^{\\top})^{\\top} (P^{a})^{\\top} = R^{-1} H P^{a}\n    $$\n    因为 $R$ 和 $P^{a}$ 是对称协方差矩阵。将此代入我们的表达式：\n    $$\n    \\mathbb{E}[d^{o} (d^{a})^{\\top}] = R - R(R^{-1} H P^{a}) H^{\\top} = R - R R^{-1} H P^{a} H^{\\top} = R - H P^{a} H^{\\top}\n    $$\n    推导出的表达式为：$\\mathbb{E}[d^{o}] = 0$, $\\mathbb{E}[d^{o} (d^{b})^{\\top}] = R$, 和 $\\mathbb{E}[d^{o} (d^{a})^{\\top}] = R - H P^{a} H^{\\top}$。\n\nb) (a) 部分推导的关系是理论恒等式，只有当同化系统中使用的协方差矩阵（即 $P^{b}$ 和 $R$）准确地表示真实误差统计时，这些恒等式才成立。在像集合卡尔曼滤波器（EnKF）这样的实际应用中，$P^b$ 是一个估计值 $P^b_{ens}$，已知其存在采样误差。通过应用局地化 $P^{b}_{\\text{loc}} = C(L) \\circ P^{b}_{\\text{ens}}$ 可以缓解这些误差，其中 $L$ 是局地化长度尺度。分析的质量在很大程度上取决于对 $L$ 的恰当选择。\n\n(a) 部分的理论恒等式提供了一个强大的诊断框架，通常称为 Desroziers 诊断法，用于调整像 $L$ 这样的参数。其核心思想是将从一长串数据同化循环中计算出的经验统计量与它们的理论对应值进行比较，而理论值是滤波器内部参数的函数。\n\n例如，考虑恒等式 $\\mathbb{E}[d^{o} (d^{b})^{\\top}] = R$。令 $\\langle \\cdot \\rangle$ 表示对多个同化循环的平均。可以计算经验统计量 $\\langle d^{o} (d^{b})^{\\top} \\rangle$ 并将其与滤波器中使用的矩阵 $R$ 进行比较。不匹配表明 $R$ 被误设了。请注意，计算 $d^o$ 需要知道真实状态 $x^t$，因此这种调整通常在受控环境下进行，例如在“真实值”已知的观测系统模拟实验（OSSE）中。\n\n类似地，恒等式 $\\mathbb{E}[d^{o} (d^{a})^{\\top}] = R - H P^{a} H^{\\top}$ 也可以使用。卡尔曼滤波器方程产生一个理论分析误差协方差 $P^{a}_{model}$，它依赖于 $P^{b}_{\\text{loc}}$，因此也依赖于 $L$。具体来说，$P^{a}_{model}(L) = (I - K(L)H)P^{b}_{\\text{loc}}(L)$，其中增益 $K(L)$ 也依赖于 $L$。诊断目标是找到 $L$，使得经验观测到的统计量与滤波器的内部模型一致。\n可以定义一个目标函数 $J(L)$ 来量化这种不匹配，例如，使用矩阵范数：\n$$\nJ(L) = \\left\\| \\langle d^{o} (d^{a})^{\\top} \\rangle - \\left( R - H P^{a}_{model}(L) H^{\\top} \\right) \\right\\|^{2}\n$$\n然后通过找到使该目标函数最小化的值来调整局地化长度尺度 $L$，从而确保局地化协方差模型的统计量与观测到的新息和残差统计量尽可能一致。其他相关的恒等式，例如关于新息协方差的 $\\mathbb{E}[d^b (d^b)^\\top] = HP^bH^\\top+R$，也广泛用于协同调整膨胀和局地化。\n\nc) 对于这个标量、单观测问题，我们有 $n=1, m=1, H=1$。变量变成了标量：$p^b, r, p^a, k$。问题陈述 $p^{b}_{\\text{ens}}=1.0$, $r=0.5$，膨胀后的背景方差是 $p^b = \\lambda \\, p^{b}_{\\text{ens}} = \\lambda$。我们已知经验估计值 $s = \\langle d^o d^a \\rangle = 0.35$。\n\n从 (a) 部分可知，相关的理论恒等式是 $\\mathbb{E}[d^{o} d^{a}] = r - H p^{a} H^{\\top}$，在这个标量情况下为：\n$$\n\\mathbb{E}[d^{o} d^{a}] = r - p^{a}\n$$\nDesroziers 诊断法将观测到的统计量与其理论期望值等同起来。因此，我们设 $s = r - p^a$。\n$$\n0.35 = 0.5 - p^{a} \\implies p^{a} = 0.5 - 0.35 = 0.15\n$$\n这意味着必须选择膨胀因子 $\\lambda$，使得由卡尔曼滤波器方程产生的理论分析误差方差为 $0.15$。\n\n分析方差 $p^a$ 的标量卡尔曼滤波器方程是：\n卡尔曼增益 $k$ 是：\n$$\nk = p^b (p^b + r)^{-1}\n$$\n分析方差 $p^a$ 是：\n$$\np^a = (1-k)p^b = \\left(1 - \\frac{p^b}{p^b+r}\\right) p^b = \\left(\\frac{p^b+r-p^b}{p^b+r}\\right) p^b = \\frac{r p^b}{p^b+r}\n$$\n我们将 $p^a = 0.15$, $r=0.5$ 和 $p^b = \\lambda$ 代入此方程求解 $\\lambda$：\n$$\n0.15 = \\frac{0.5 \\lambda}{\\lambda + 0.5}\n$$\n我们现在求解这个关于 $\\lambda$ 的代数方程：\n$$\n0.15 (\\lambda + 0.5) = 0.5 \\lambda\n$$\n$$\n0.15 \\lambda + 0.075 = 0.5 \\lambda\n$$\n$$\n0.075 = 0.5 \\lambda - 0.15 \\lambda\n$$\n$$\n0.075 = 0.35 \\lambda\n$$\n$$\n\\lambda = \\frac{0.075}{0.35} = \\frac{75}{350} = \\frac{15}{70} = \\frac{3}{14}\n$$\n将分数转换为小数得到：\n$$\n\\lambda \\approx 0.2142857...\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\lambda \\approx 0.2143\n$$",
            "answer": "$$\\boxed{0.2143}$$"
        },
        {
            "introduction": "在应用并整定了膨胀和局地化方案之后，我们如何评估最终得到的集合预报的质量？一个完美的集合预报系统应该具有统计可靠性，即观测值与任何一个集合成员在统计上是无法区分的。秩分布直方图（Rank Histogram）是检验这一特性的核心工具。这个练习将要求你从第一性原理出发，推导一个完美集合的秩分布所应遵循的理论形态。理解这个基准分布（即均匀分布）对于解读实际应用中出现的U形或圆顶形等非均匀秩分布至关重要，它能帮助你准确诊断出集合预报存在的离散度不足或系统性偏差等问题。",
            "id": "4036312",
            "problem": "考虑一个用于数值天气预报的数据同化系统，该系统使用集合卡尔曼滤波 (EnKF)，并应用协方差局地化和乘性膨胀来控制抽样误差和离散度不足。在给定的检验时间，一个集合预报由 $N$ 个成员（表示为 $\\{X_{1}, X_{2}, \\dots, X_{N}\\}$）和一个独立的观测值 $Y$ 组成。通过对集合值进行排序，并计算观测值落在 $N+1$ 个区间中的哪一个来构建等级直方图：低于 $X_{(1)}$，在 $X_{(k)}$ 和 $X_{(k+1)}$ 之间（其中 $k=1,\\dots,N-1$），或高于 $X_{(N)}$。这里，$X_{(1)} \\leq X_{(2)} \\leq \\dots \\leq X_{(N)}$ 表示集合的次序统计量。在完美可靠性的条件下，集合成员和观测值是从同一个连续预报分布中进行的可交换抽样，因此集合离散度和均值与实现的观测值 $Y$ 在统计上是一致的。从第一性原理以及关于次序统计量和概率积分变换 (PIT) 的公认事实出发，推导在完美可靠性条件下等级直方图的期望形状：具体来说，推导观测值 $Y$ 落在第 $k$ 个等级区间的期望概率 $P_{k}$ (其中 $k=0,1,\\dots,N$) 的解析表达式，该表达式应仅为 $N$ 的闭式函数。你的最终答案必须是单个闭式表达式。不需要单位。不要对答案进行四舍五入。",
            "solution": "该问题被验证为具有科学依据、提法恰当、客观且自洽。它是集合天气预报和统计检验领域的一个标准理论问题。推导解决方案所需的所有必要条件均已提供。\n\n该问题要求计算一个观测值 $Y$ 落入由 $N$ 个成员组成的集合预报的第 $k$ 个等级区间的期望概率 $P_k$。等级的索引从 $k=0$ 到 $k=N$，对应 $N+1$ 个可能的区间。基本假设是集合是“完美可靠的”，这意味着集合成员 $\\{X_1, X_2, \\dots, X_N\\}$ 和观测值 $Y$ 是从同一个连续预报分布中进行的可交换抽样。对于连续分布，这等价于声明一组 $N+1$ 个随机变量 $\\{X_1, \\dots, X_N, Y\\}$ 是独立同分布 (i.i.d.) 的。\n\n设这些随机变量的共同、连续且严格单调递增的累积分布函数 (CDF) 为 $F(x) = P(X \\le x)$。\n\n首先，我们必须形式化等级区间的定义。问题文本将 $N+1$ 个区间描述为：“低于 $X_{(1)}$”、“在 $X_{(k)}$ 和 $X_{(k+1)}$ 之间（其中 $k=1,\\dots,N-1$）”和“高于 $X_{(N)}$”。这里，$X_{(j)}$ 是集合的第 $j$ 个次序统计量，满足 $X_{(1)} \\le X_{(2)} \\le \\dots \\le X_{(N)}$。由于母体分布是连续的，任何两次抽样值相等的概率为 $0$，因此我们可以使用严格不等式 $X_{(1)} < X_{(2)} < \\dots < X_{(N)}$。\n\n对于 $k \\in \\{0, 1, \\dots, N\\}$，事件“$Y$ 落在第 $k$ 个等级区间”对应于小于 $Y$ 的集合成员的数量。让我们验证这种映射关系：\n- 如果 $Y$ 落在“低于 $X_{(1)}$”的区间，则 $Y < X_{(1)}$。这意味着 $Y$ 小于所有 $N$ 个集合成员。小于 $Y$ 的集合成员数量为 $0$。这对应于等级 $k=0$。\n- 如果 $Y$ 落在“$X_{(j)}$ 和 $X_{(j+1)}$ 之间”（其中 $j \\in \\{1, \\dots, N-1\\}$），则 $X_{(j)} < Y < X_{(j+1)}$。这意味着恰好有 $j$ 个集合成员小于 $Y$。这对应于等级 $k=j$。\n- 如果 $Y$ 落在“高于 $X_{(N)}$”的区间，则 $Y > X_{(N)}$。这意味着 $Y$ 大于所有 $N$ 个集合成员。小于 $Y$ 的集合成员数量为 $N$。这对应于等级 $k=N$。\n\n这就建立了一个清晰明确的联系：$P_k$ 是集合成员 $\\{X_i\\}$ 中恰好有 $k$ 个小于观测值 $Y$ 的概率。\n\n为了推导这个概率，我们使用问题陈述中建议的概率积分变换 (PIT)。PIT 指出，如果一个随机变量 $Z$ 具有连续的累积分布函数 $F_Z(z)$，那么随机变量 $U = F_Z(Z)$ 在区间 $[0, 1]$ 上服从均匀分布。\n我们将此变换应用于所有 $N+1$ 个独立同分布的随机变量：\n- 令 $U_i = F(X_i)$，其中 $i = 1, \\dots, N$。\n- 令 $V = F(Y)$。\n由此产生的 $N+1$ 个随机变量集合 $\\{U_1, \\dots, U_N, V\\}$ 是从均匀分布 Uniform$(0,1)$ 中抽取的独立同分布样本。\n\n由于 $F$ 是一个严格递增函数，它保持了顺序。也就是说，$X_i < Y$ 当且仅当 $F(X_i) < F(Y)$，这等价于 $U_i < V$。因此，寻找恰好有 $k$ 个 $X_i$ 小于 $Y$ 的概率的问题，等同于寻找恰好有 $k$ 个 $U_i$ 小于 $V$ 的概率。\n\n我们来计算这个概率 $P_k = P(\\text{集合 } \\{U_i\\}_{i=1}^N \\text{ 中恰好有 } k \\text{ 个成员小于 } V)$。我们可以通过对 $V$ 的值进行条件化，并使用全概率定律。$V$ 的概率密度函数 (PDF) 为 $f_V(v) = 1$（当 $v \\in (0, 1)$ 时）否则为 $0$。\n$$P_k = \\int_0^1 P(\\text{exactly } k \\text{ of } \\{U_i\\} < v \\mid V=v) f_V(v) \\, dv$$\n\n对于一个固定的值 $V=v$，每个 $U_i$ 都是从 $U(0,1)$ 中独立抽取的。事件 $U_i < v$ 是一个伯努利试验，其成功概率为 $p = P(U_i < v) = v$。我们进行 $N$ 次这样的独立试验。成功次数（即小于 $v$ 的 $U_i$ 的数量）服从二项分布 $B(N, p=v)$。恰好有 $k$ 次成功的概率由二项分布的概率质量函数给出：\n$$P(\\text{exactly } k \\text{ of } \\{U_i\\} < v) = \\binom{N}{k} v^k (1-v)^{N-k}$$\n\n将此代入我们计算 $P_k$ 的积分中：\n$$P_k = \\int_0^1 \\binom{N}{k} v^k (1-v)^{N-k} \\cdot 1 \\, dv$$\n我们可以将二项式系数提到积分外面，因为它不依赖于 $v$：\n$$P_k = \\binom{N}{k} \\int_0^1 v^k (1-v)^{N-k} \\, dv$$\n\n该积分是与贝塔函数相关的标准形式，贝塔函数定义为 $B(x, y) = \\int_0^1 t^{x-1} (1-t)^{y-1} \\, dt$。我们的积分对应于 $B(k+1, N-k+1)$。\n贝塔函数可以用伽马函数 $\\Gamma(z)$ 表示为 $B(x, y) = \\frac{\\Gamma(x)\\Gamma(y)}{\\Gamma(x+y)}$。对于整数参数 $n$，$\\Gamma(n) = (n-1)!$。\n因此，我们可以计算该积分：\n$$\\int_0^1 v^k (1-v)^{N-k} \\, dv = B(k+1, N-k+1) = \\frac{\\Gamma(k+1)\\Gamma(N-k+1)}{\\Gamma((k+1)+(N-k+1))} = \\frac{\\Gamma(k+1)\\Gamma(N-k+1)}{\\Gamma(N+2)}$$\n使用伽马函数的阶乘关系：\n$$B(k+1, N-k+1) = \\frac{k!(N-k)!}{(N+1)!}$$\n\n现在我们将这个结果代回到 $P_k$ 的表达式中：\n$$P_k = \\binom{N}{k} \\frac{k!(N-k)!}{(N+1)!}$$\n二项式系数的定义为 $\\binom{N}{k} = \\frac{N!}{k!(N-k)!}$。代入这个定义：\n$$P_k = \\left( \\frac{N!}{k!(N-k)!} \\right) \\left( \\frac{k!(N-k)!}{(N+1)!} \\right)$$\n$k!$ 和 $(N-k)!$ 项相互抵消：\n$$P_k = \\frac{N!}{(N+1)!}$$\n由于 $(N+1)! = (N+1) \\times N!$，我们得到最终的简化结果：\n$$P_k = \\frac{N!}{(N+1) N!} = \\frac{1}{N+1}$$\n\n这个结果与等级 $k$ 无关。这意味着对于一个完美可靠的集合，观测值 $Y$ 落入 $N+1$ 个等级区间中任意一个的可能性是相等的。因此，等级直方图的期望形状是均匀的，或称“平坦的”。对于任何给定的区间 $k \\in \\{0, 1, \\dots, N\\}$，其概率仅是集合大小 $N$ 的函数。",
            "answer": "$$\\boxed{\\frac{1}{N+1}}$$"
        }
    ]
}