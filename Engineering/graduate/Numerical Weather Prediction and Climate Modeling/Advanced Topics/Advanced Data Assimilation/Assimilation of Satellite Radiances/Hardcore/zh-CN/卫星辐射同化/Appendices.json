{
    "hands_on_practices": [
        {
            "introduction": "观测误差协方差矩阵 $R$ 是决定观测在资料同化中所占权重的关键。在实践中，$R$ 并非一个固定的参数，而是会根据具体的观测场景动态变化。本练习  将引导您深入了解 $R$ 的构成，通过一个基于物理的场景（例如云量），将总观测误差分解为仪器噪声、前向模式误差和代表性误差等部分。理解并正确地为 $R$ 建模，是实现卫星资料有效同化的基础。",
            "id": "4012550",
            "problem": "考虑在数值天气预报（NWP）和红外卫星辐射率的气候数据同化背景下，对一个层平均大气温度状态 $x$（单位为 $\\mathrm{K}$）进行一维分析。在有云的非均匀场景上，同一颗卫星提供了两个通道的亮度温度（BT）观测值 $y_{1}$ 和 $y_{2}$（单位均为 $\\mathrm{K}$）。观测算子在背景态附近进行线性化，因此小的扰动满足 $y' \\approx H x'$，其中 $H = [h_{1}, h_{2}]$ 包含亮度温度相对于层平均温度 $x$ 的线性化雅可比矩阵 $h_{1}$ 和 $h_{2}$。在此场景下，观测误差被建模为零均值、高斯分布，并且通道间相互不相关，其观测误差协方差为 $\\mathbf{R} = \\mathrm{diag}(R_{11}, R_{22})$。每个通道的误差方差是三个有物理基础的贡献之和：仪器噪声、正演模型误差以及由亚像元足迹场景非均匀性引起的代表性误差。\n\n使用以下科学上合理的场景特征和仪器属性：\n- $x$ 的背景误差方差：$\\sigma_{b}^{2} = 4.0 \\,\\mathrm{K}^{2}$。\n- 线性化雅可比矩阵：$h_{1} = 0.7$, $h_{2} = 0.4$。\n- 仪器噪声（噪声等效温差）：$\\sigma_{\\mathrm{instr},1} = 0.12 \\,\\mathrm{K}$, $\\sigma_{\\mathrm{instr},2} = 0.18 \\,\\mathrm{K}$。\n- 正演模型误差标准差（假设在此场景下通道无关但不相关）：$\\sigma_{\\mathrm{fm}} = 0.07 \\,\\mathrm{K}$。\n- 云量：$f_{c} = 0.25$，亚像元足迹温度变率：$\\sigma_{\\mathrm{sub}} = 2.0 \\,\\mathrm{K}$。\n- 通道层敏感性因子（目标层在通道权重函数中的权重分数）：$w_{1} = 0.8$, $w_{2} = 0.6$。\n- 每个通道的代表性误差模型为 $\\sigma_{\\mathrm{repr},i} = w_{i}\\,\\sigma_{\\mathrm{sub}}\\,\\sqrt{f_{c}}$。\n\n任务：\n1. 使用上述定义，根据 $R_{ii} = \\sigma_{\\mathrm{instr},i}^{2} + \\sigma_{\\mathrm{fm}}^{2} + \\sigma_{\\mathrm{repr},i}^{2}$ 计算 $R_{11}$ 和 $R_{22}$。\n2. 在线性高斯假设下，对于一个标量控制变量 $x$ 和两个观测值，导出标量分析误差方差 $P^{a}$（用背景误差方差和观测误差协方差表示），然后计算其在此场景下的数值。\n3. 将最终答案四舍五入至四位有效数字。以 $\\mathrm{K}^{2}$ 为单位表示最终的分析误差方差。",
            "solution": "问题陈述已经过验证，被认为是科学可靠、提法恰当、客观且自洽的。所提供的数据和模型与数值天气预报的卫星数据同化领域的既定原则一致。因此，我们可以着手求解。\n\n该问题需要分三步解决：首先，计算两个卫星通道的观测误差方差；其次，推导并计算单个大气温度状态变量的分析误差方差；第三，将最终结果四舍五入到指定的精度。\n\n首先，我们计算观测误差协方差矩阵 $\\mathbf{R}$ 的对角元素 $R_{11}$ 和 $R_{22}$。问题陈述指出，给定通道 $i$ 的总观测误差方差（记为 $R_{ii}$）是三个独立误差源的方差之和：仪器噪声、正演模型误差和代表性误差。其公式为：\n$$R_{ii} = \\sigma_{\\mathrm{instr},i}^{2} + \\sigma_{\\mathrm{fm}}^{2} + \\sigma_{\\mathrm{repr},i}^{2}$$\n仪器噪声（$\\sigma_{\\mathrm{instr},i}$）和正演模型误差（$\\sigma_{\\mathrm{fm}}$）的标准差已给出。我们必须首先使用给定的模型计算每个通道的代表性误差标准差 $\\sigma_{\\mathrm{repr},i}$：\n$$\\sigma_{\\mathrm{repr},i} = w_{i}\\,\\sigma_{\\mathrm{sub}}\\,\\sqrt{f_{c}}$$\n给定的参数为：云量 $f_{c} = 0.25$，亚像元足迹温度变率 $\\sigma_{\\mathrm{sub}} = 2.0 \\, \\mathrm{K}$，以及通道层敏感性因子 $w_{1} = 0.8$ 和 $w_{2} = 0.6$。\n\n对于通道 1：\n$$\\sigma_{\\mathrm{repr},1} = w_{1}\\,\\sigma_{\\mathrm{sub}}\\,\\sqrt{f_{c}} = (0.8)(2.0)\\sqrt{0.25} = (0.8)(2.0)(0.5) = 0.8 \\, \\mathrm{K}$$\n对于通道 2：\n$$\\sigma_{\\mathrm{repr},2} = w_{2}\\,\\sigma_{\\mathrm{sub}}\\,\\sqrt{f_{c}} = (0.6)(2.0)\\sqrt{0.25} = (0.6)(2.0)(0.5) = 0.6 \\, \\mathrm{K}$$\n现在，我们可以使用给定的仪器噪声标准差（$\\sigma_{\\mathrm{instr},1} = 0.12 \\, \\mathrm{K}$，$\\sigma_{\\mathrm{instr},2} = 0.18 \\, \\mathrm{K}$）和正演模型误差标准差（$\\sigma_{\\mathrm{fm}} = 0.07 \\, \\mathrm{K}$）来计算 $R_{11}$ 和 $R_{22}$。\n\n对于通道 1：\n$$R_{11} = \\sigma_{\\mathrm{instr},1}^{2} + \\sigma_{\\mathrm{fm}}^{2} + \\sigma_{\\mathrm{repr},1}^{2} = (0.12)^{2} + (0.07)^{2} + (0.8)^{2}$$\n$$R_{11} = 0.0144 + 0.0049 + 0.64 = 0.6593 \\, \\mathrm{K}^{2}$$\n对于通道 2：\n$$R_{22} = \\sigma_{\\mathrm{instr},2}^{2} + \\sigma_{\\mathrm{fm}}^{2} + \\sigma_{\\mathrm{repr},2}^{2} = (0.18)^{2} + (0.07)^{2} + (0.6)^{2}$$\n$$R_{22} = 0.0324 + 0.0049 + 0.36 = 0.3973 \\, \\mathrm{K}^{2}$$\n\n其次，我们推导标量分析误差方差 $P^{a}$ 的表达式并计算其值。在线性高斯估计中，分析误差协方差矩阵 $\\mathbf{P}^{a}$ 的逆矩阵的通用公式为：\n$$(\\mathbf{P}^{a})^{-1} = (\\mathbf{P}^{b})^{-1} + \\mathbf{H}^{T} \\mathbf{R}^{-1} \\mathbf{H}$$\n在本问题中，状态变量 $x$ 是一个标量，因此其背景误差协方差 $\\mathbf{P}^{b}$ 是标量方差 $P^{b} = \\sigma_{b}^{2}$，其分析误差协方差 $\\mathbf{P}^{a}$ 是标量方差 $P^{a}$。观测向量有两个分量，因此雅可比矩阵 $\\mathbf{H}$（表示两个观测值对单个状态变量的敏感度）是一个 $2 \\times 1$ 的列向量：\n$$\\mathbf{H} = \\begin{pmatrix} h_{1} \\\\ h_{2} \\end{pmatrix}$$\n由于误差不相关，观测误差协方差矩阵 $\\mathbf{R}$ 是一个 $2 \\times 2$ 的对角矩阵：\n$$\\mathbf{R} = \\begin{pmatrix} R_{11}  0 \\\\ 0  R_{22} \\end{pmatrix}$$\n其逆矩阵为：\n$$\\mathbf{R}^{-1} = \\begin{pmatrix} \\frac{1}{R_{11}}  0 \\\\ 0  \\frac{1}{R_{22}} \\end{pmatrix}$$\n我们现在计算 $\\mathbf{H}^{T} \\mathbf{R}^{-1} \\mathbf{H}$ 这一项：\n$$\\mathbf{H}^{T} \\mathbf{R}^{-1} \\mathbf{H} = \\begin{pmatrix} h_{1}  h_{2} \\end{pmatrix} \\begin{pmatrix} \\frac{1}{R_{11}}  0 \\\\ 0  \\frac{1}{R_{22}} \\end{pmatrix} \\begin{pmatrix} h_{1} \\\\ h_{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{h_{1}}{R_{11}}  \\frac{h_{2}}{R_{22}} \\end{pmatrix} \\begin{pmatrix} h_{1} \\\\ h_{2} \\end{pmatrix} = \\frac{h_{1}^{2}}{R_{11}} + \\frac{h_{2}^{2}}{R_{22}}$$\n如预期，该项是一个标量。将其代入分析误差公式的标量形式：\n$$\\frac{1}{P^{a}} = \\frac{1}{P^{b}} + \\frac{h_{1}^{2}}{R_{11}} + \\frac{h_{2}^{2}}{R_{22}}$$\n使用 $P^{b} = \\sigma_{b}^{2}$， $P^{a}$ 的表达式为：\n$$P^{a} = \\left( \\frac{1}{\\sigma_{b}^{2}} + \\frac{h_{1}^{2}}{R_{11}} + \\frac{h_{2}^{2}}{R_{22}} \\right)^{-1}$$\n我们现在代入数值：$\\sigma_{b}^{2} = 4.0 \\, \\mathrm{K}^{2}$，$h_{1} = 0.7$，$h_{2} = 0.4$，以及之前计算出的 $R_{11}$ 和 $R_{22}$ 的值。\n\n首先，计算和中的各项（这些项代表信息含量，或精度，单位为 $\\mathrm{K}^{-2}$）：\n$$\\frac{1}{\\sigma_{b}^{2}} = \\frac{1}{4.0} = 0.25 \\, \\mathrm{K}^{-2}$$\n$$\\frac{h_{1}^{2}}{R_{11}} = \\frac{(0.7)^{2}}{0.6593} = \\frac{0.49}{0.6593} \\approx 0.7432125 \\, \\mathrm{K}^{-2}$$\n$$\\frac{h_{2}^{2}}{R_{22}} = \\frac{(0.4)^{2}}{0.3973} = \\frac{0.16}{0.3973} \\approx 0.4027183 \\, \\mathrm{K}^{-2}$$\n分析误差方差的倒数是这些精度的总和：\n$$\\frac{1}{P^{a}} = 0.25 + 0.7432125... + 0.4027183... = 1.3959308... \\, \\mathrm{K}^{-2}$$\n分析误差方差是该总和的倒数：\n$$P^{a} = \\frac{1}{1.3959308...} \\approx 0.7163683 \\, \\mathrm{K}^{2}$$\n\n第三，问题要求将最终答案四舍五入至四位有效数字。\n$$P^{a} \\approx 0.7164 \\, \\mathrm{K}^{2}$$\n这个最终值代表了在将背景信息与两个卫星观测值进行最优组合后，大气温度估计的预期平方误差。正如预期的那样，$P^{a}  \\sigma_{b}^{2}$，这表明观测值减少了状态估计的不确定性。",
            "answer": "$$ \\boxed{0.7164} $$"
        },
        {
            "introduction": "在理解了像 $R$ 这样的关键输入之后，我们可以开始探索资料同化系统的核心机制。本练习  通过一个简化的低维设置，展示了变分同化的核心计算过程。您将亲手计算分析增量和分析残差，直观地看到背景信息、观测及其误差特性是如何结合起来，从而生成一个最优的分析场。",
            "id": "4012633",
            "problem": "在数值天气预报（NWP）的线性化变分资料同化设置中，考虑将单个经过偏差订正的卫星辐射通道同化到二维控制空间中。控制向量 $\\mathbf{x}$ 代表两个归一化、无量纲的控制变量。背景误差协方差矩阵 $\\mathbf{B}$、观测误差协方差 $\\mathbf{R}$（对于单个通道是一个标量）以及线性化观测算子雅可比矩阵（通常称为权重函数或雅可比矩阵）$\\mathbf{K}$ 指定如下：\n$$\n\\mathbf{B} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}, \n\\qquad \n\\mathbf{R} = 2,\n\\qquad \n\\mathbf{K} = \\begin{pmatrix} 1  2 \\end{pmatrix}.\n$$\n令新息（观测值减去背景场对应的模式等价值）为标量\n$$\nd = y - H(\\mathbf{x_b}) = 3.\n$$\n假设在具有无偏误差的标准线性高斯设置下，分析场是通过最小化包含背景项和观测项的二次贝叶斯代价函数得到的，并且前向算子在背景场附近的线性化得出 $H(\\mathbf{x_b} + \\delta \\mathbf{x}) \\approx H(\\mathbf{x_b}) + \\mathbf{K}\\,\\delta \\mathbf{x}$。\n\n从这些基础出发，推导分析增量 $\\delta \\mathbf{x}$ 和分析残差 $r_a = y - H(\\mathbf{x_a})$ 的闭式表达式，其中 $\\mathbf{x_a} = \\mathbf{x_b} + \\delta \\mathbf{x}$。然后，根据指定的 $\\mathbf{B}$、$\\mathbf{R}$、$\\mathbf{K}$ 和 $d$ 计算它们的数值。\n\n所有变量在构造上都是无量纲的；不需要物理单位。请以单行矩阵的形式提供最终数值答案，其中依次包含 $\\delta \\mathbf{x}$ 的两个分量和残差 $r_a$。无需四舍五入；请给出精确值。",
            "solution": "该问题是有效的，因为它代表了变分资料同化中的一个标准的、适定的问题，所有必要的组成部分都得到了一致的定义。\n\n分析场是通过最小化二次代价函数 $J$ 来确定的，该函数衡量了分析状态与背景状态和观测值之间的失配程度，并由它们各自的误差协方差进行加权。控制变量是分析增量 $\\delta \\mathbf{x} = \\mathbf{x_a} - \\mathbf{x_b}$，其中 $\\mathbf{x_a}$ 是分析状态，$\\mathbf{x_b}$ 是背景状态。代价函数 $J(\\delta \\mathbf{x})$ 由下式给出：\n$$\nJ(\\delta \\mathbf{x}) = \\frac{1}{2} (\\delta \\mathbf{x})^T \\mathbf{B}^{-1} \\delta \\mathbf{x} + \\frac{1}{2} (y - H(\\mathbf{x_b} + \\delta \\mathbf{x}))^T \\mathbf{R}^{-1} (y - H(\\mathbf{x_b} + \\delta \\mathbf{x}))\n$$\n在线性假设下，观测算子 $H$ 可以在背景状态 $\\mathbf{x_b}$ 附近近似为 $H(\\mathbf{x_b} + \\delta \\mathbf{x}) \\approx H(\\mathbf{x_b}) + \\mathbf{K}\\delta \\mathbf{x}$，其中 $\\mathbf{K}$ 是在 $\\mathbf{x_b}$ 处求值的 $H$ 的雅可比矩阵。代价函数的第二项涉及观测值 $y$ 与分析场的模式等价值之差，可写为：\n$$\ny - H(\\mathbf{x_a}) \\approx y - (H(\\mathbf{x_b}) + \\mathbf{K}\\delta \\mathbf{x}) = (y - H(\\mathbf{x_b})) - \\mathbf{K}\\delta \\mathbf{x} = d - \\mathbf{K}\\delta \\mathbf{x}\n$$\n这里，$d = y - H(\\mathbf{x_b})$ 是新息向量（在本例中是标量）。代价函数变为：\n$$\nJ(\\delta \\mathbf{x}) = \\frac{1}{2} (\\delta \\mathbf{x})^T \\mathbf{B}^{-1} \\delta \\mathbf{x} + \\frac{1}{2} (d - \\mathbf{K}\\delta \\mathbf{x})^T \\mathbf{R}^{-1} (d - \\mathbf{K}\\delta \\mathbf{x})\n$$\n由于观测值是单个标量值，$\\mathbf{R}$、$d$ 和 $\\mathbf{K}\\delta\\mathbf{x}$ 也都是标量。第二项中的转置可以省略。\n$$\nJ(\\delta \\mathbf{x}) = \\frac{1}{2} (\\delta \\mathbf{x})^T \\mathbf{B}^{-1} \\delta \\mathbf{x} + \\frac{1}{2} \\mathbf{R}^{-1} (d - \\mathbf{K}\\delta \\mathbf{x})^{2}\n$$\n为了找到最小化 $J$ 的分析增量 $\\delta \\mathbf{x}$，我们计算 $J$ 相对于 $\\delta \\mathbf{x}$ 的梯度并将其设为零：\n$$\n\\nabla_{\\delta\\mathbf{x}} J(\\delta \\mathbf{x}) = \\mathbf{B}^{-1} \\delta \\mathbf{x} - \\mathbf{K}^T \\mathbf{R}^{-1} (d - \\mathbf{K}\\delta \\mathbf{x}) = \\mathbf{0}\n$$\n重新整理各项以求解 $\\delta \\mathbf{x}$：\n$$\n\\mathbf{B}^{-1} \\delta \\mathbf{x} + \\mathbf{K}^T \\mathbf{R}^{-1} \\mathbf{K}\\delta \\mathbf{x} = \\mathbf{K}^T \\mathbf{R}^{-1} d\n$$\n$$\n(\\mathbf{B}^{-1} + \\mathbf{K}^T \\mathbf{R}^{-1} \\mathbf{K}) \\delta \\mathbf{x} = \\mathbf{K}^T \\mathbf{R}^{-1} d\n$$\n这导出了增量的分析空间解：\n$$\n\\delta \\mathbf{x} = (\\mathbf{B}^{-1} + \\mathbf{K}^T \\mathbf{R}^{-1} \\mathbf{K})^{-1} \\mathbf{K}^T \\mathbf{R}^{-1} d\n$$\n通过应用 Sherman-Morrison-Woodbury 公式，可以得到一个等价且通常在计算上更方便的形式，即观测空间解。这给出：\n$$\n\\delta \\mathbf{x} = \\mathbf{B} \\mathbf{K}^T (\\mathbf{R} + \\mathbf{K} \\mathbf{B} \\mathbf{K}^T)^{-1} d\n$$\n这种形式在这里特别有利，因为它需要对标量 $\\mathbf{R} + \\mathbf{K} \\mathbf{B} \\mathbf{K}^T$ 求逆，而不是对 $2 \\times 2$ 矩阵 $(\\mathbf{B}^{-1} + \\mathbf{K}^T \\mathbf{R}^{-1} \\mathbf{K})$ 求逆。\n\n我们现在代入给定的值：\n$$\n\\mathbf{B} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}, \\quad \\mathbf{R} = 2, \\quad \\mathbf{K} = \\begin{pmatrix} 1  2 \\end{pmatrix}, \\quad d = 3.\n$$\n首先，我们计算项 $\\mathbf{K} \\mathbf{B} \\mathbf{K}^T$：\n$$\n\\mathbf{K}^T = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}\n$$\n$$\n\\mathbf{K} \\mathbf{B} = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} (1)(2) + (2)(0)  (1)(0) + (2)(1) \\end{pmatrix} = \\begin{pmatrix} 2  2 \\end{pmatrix}\n$$\n$$\n\\mathbf{K} \\mathbf{B} \\mathbf{K}^T = \\begin{pmatrix} 2  2 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = (2)(1) + (2)(2) = 2 + 4 = 6\n$$\n接下来，我们计算需要求逆的标量：\n$$\n\\mathbf{R} + \\mathbf{K} \\mathbf{B} \\mathbf{K}^T = 2 + 6 = 8\n$$\n其逆就是 $(\\mathbf{R} + \\mathbf{K} \\mathbf{B} \\mathbf{K}^T)^{-1} = 8^{-1} = \\frac{1}{8}$。\n我们还需要项 $\\mathbf{B} \\mathbf{K}^T$：\n$$\n\\mathbf{B} \\mathbf{K}^T = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} (2)(1) + (0)(2) \\\\ (0)(1) + (1)(2) \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix}\n$$\n现在我们组合出 $\\delta \\mathbf{x}$ 的表达式：\n$$\n\\delta \\mathbf{x} = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix} \\left(\\frac{1}{8}\\right) (3) = \\frac{3}{8} \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} \\frac{6}{8} \\\\ \\frac{6}{8} \\end{pmatrix} = \\begin{pmatrix} \\frac{3}{4} \\\\ \\frac{3}{4} \\end{pmatrix}\n$$\n所以分析增量的分量是 $\\delta x_1 = \\frac{3}{4}$ 和 $\\delta x_2 = \\frac{3}{4}$。\n\n接下来，我们推导并计算分析残差 $r_a$。分析残差定义为观测值减去在分析状态下的模式等价值，$r_a = y - H(\\mathbf{x_a})$。\n使用在 $\\mathbf{x_b}$ 附近的线性近似：\n$$\nr_a = y - H(\\mathbf{x_b} + \\delta\\mathbf{x}) \\approx y - (H(\\mathbf{x_b}) + \\mathbf{K}\\delta\\mathbf{x})\n$$\n$$\nr_a = (y - H(\\mathbf{x_b})) - \\mathbf{K}\\delta\\mathbf{x} = d - \\mathbf{K}\\delta\\mathbf{x}\n$$\n使用计算出的 $\\delta \\mathbf{x}$ 的值：\n$$\nr_a = 3 - \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} \\frac{3}{4} \\\\ \\frac{3}{4} \\end{pmatrix} = 3 - \\left( (1)\\left(\\frac{3}{4}\\right) + (2)\\left(\\frac{3}{4}\\right) \\right)\n$$\n$$\nr_a = 3 - \\left( \\frac{3}{4} + \\frac{6}{4} \\right) = 3 - \\frac{9}{4} = \\frac{12}{4} - \\frac{9}{4} = \\frac{3}{4}\n$$\n分析残差是 $r_a = \\frac{3}{4}$。\n\n最终答案要求将 $\\delta \\mathbf{x}$ 的两个分量和残差 $r_a$ 放在一个单行矩阵中。这些值是 $\\delta x_1 = \\frac{3}{4}$、$\\delta x_2 = \\frac{3}{4}$ 和 $r_a = \\frac{3}{4}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3}{4}  \\frac{3}{4}  \\frac{3}{4} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "资料同化是一个不断循环的系统，其性能需要持续的监控和评估。本练习  介绍了一项至关重要的实践：使用“观测减背景”（O-B）统计量来诊断系统性能。通过分析O-B样本，您可以学习如何识别系统偏差，并评估预设的误差统计（$R$ 和 $B$）是否合理，最终提出对偏差订正和观测误差方差的调整建议，从而形成一个完整的反馈和优化闭环。",
            "id": "4012568",
            "problem": "考虑在数值天气预报中卫星辐射率的同化，重点关注观测减背景（O-B）诊断。设观测到的亮温用 $y$ 表示，背景场用 $x_b$ 表示，线性化的观测算子用 $H$ 表示。在线性性和加性噪声的标准假设下，观测模型为 $y = H x + \\varepsilon_o$，背景场模型为 $x_b = x + \\varepsilon_b$，其中 $\\varepsilon_o$ 和 $\\varepsilon_b$ 是零均值的随机误差。O-B 残差定义为差值 $d \\equiv y - H x_b$，可以写成 $d = \\varepsilon_o - H \\varepsilon_b$。观测误差协方差为 $R$，映射到观测空间的背景误差协方差为 $S = H B H^\\top$，其中 $B$ 是模式空间中的背景误差协方差。\n\n给定几个通道的月度 O-B 样本（每个通道对应一个独特的光谱测量）。对于每个通道，还给定了先验观测误差方差（该通道的 $R$ 的对角元素）和观测空间中相应的背景误差方差 $S$。你的任务是：\n- 对于每个通道，计算 O-B 残差的样本均值（偏差）和无偏样本标准差。将偏差和标准差以开尔文（K）为单位表示，并四舍五入到三位小数。\n- 评估样本方差是否与先验观测误差方差和观测空间中背景误差方差之和一致。具体来说，如果样本方差与 $R + S$ 之间的绝对差值不超过 $R + S$ 的一个容差分数 $t$，则声明为一致。使用 $t = 0.1$（一个小数，而不是百分比）。\n- 为同化提出调整建议：\n  - 应用于观测亮温的偏差订正偏移量，其值等于估计偏差的负值（以使订正后的 O-B 均值更接近于零）。将此偏移量以开尔文（K）为单位表示，并四舍五入到三位小数。\n  - 基于矩估计法原理，使用样本方差和 $S$ 更新观测误差方差 $R_{\\text{new}}$。使用规则 $R_{\\text{new}} = \\max(r_{\\min}, \\text{sample\\_variance} - S)$ 以确保非负性并避免退化值。取 $r_{\\min} = 0.01$（单位为 $\\mathrm{K}^2$），并将 $R_{\\text{new}}$ 四舍五入到三位小数。\n\n使用以下测试套件。对于每个测试用例，给定多个通道；对于每个通道，提供了 O-B 样本、先验 $R$（方差，单位为 $\\mathrm{K}^2$）和 $S$（方差，单位为 $\\mathrm{K}^2$）。所有 O-B 值均以开尔文（K）为单位。\n\n测试用例 1：\n- 通道 1：O-B 样本 $\\{0.4, 1.1, -0.2, 0.6, 0.5, -0.1, 0.9, -0.3, 1.3, 0.2, -0.4, 0.7, 0.8, -0.5, 1.0, 0.3, -0.2, 0.6, 0.4, 1.2\\}$，$R = 0.5$，$S = 0.5$。\n- 通道 2：O-B 样本 $\\{-0.6, 0.7, 0.1, -0.4, 0.5, 0.2, -0.3, 0.4, -0.2, 0.3, 0.0, 0.5, -0.5, 0.6, -0.1, 0.2, -0.4, 0.3, -0.2, 0.4\\}$，$R = 0.8$，$S = 0.4$。\n- 通道 3：O-B 样本 $\\{-1.5, 1.6, 0.9, -1.2, 1.3, -0.8, 1.1, -1.0, 1.4, -0.7, 1.0, -1.1, 1.5, -0.9, 1.2, -1.3, 1.4, -0.6, 0.8, -1.4\\}$，$R = 0.4$，$S = 0.3$。\n\n测试用例 2：\n- 通道 1：O-B 样本 $\\{0.1, 0.0, -0.1, 0.2, -0.2, 0.3, -0.3, 0.1, 0.0, -0.1, 0.2, -0.2, 0.3, -0.3, 0.1, 0.0, -0.1, 0.2, -0.2, 0.3\\}$，$R = 0.05$，$S = 0.4$。\n- 通道 2：O-B 样本 $\\{2.0, 2.3, 1.7, 2.1, 1.9, 2.2, 2.4, 1.8, 2.0, 2.1, 1.9, 2.2, 2.3, 1.7, 2.1, 1.8, 2.0, 2.3, 1.9, 2.2\\}$，$R = 0.6$，$S = 0.5$。\n- 通道 3：O-B 样本 $\\{0.3, -0.2, 0.1\\}$，$R = 0.3$，$S = 0.4$。\n\n测试用例 3：\n- 通道 1：O-B 样本 $\\{-1.1, 1.2, -0.9, 1.0, -1.2, 1.3, -1.0, 1.1, -1.1, 1.0, -0.9, 1.2, -1.0, 1.1, -1.2, 1.3, -1.0, 1.1, -1.1, 1.0\\}$，$R = 0.7$，$S = 0.5$。\n- 通道 2：O-B 样本 $\\{-1.0, 1.1, -0.8, 0.9, -1.1, 1.2, -0.9, 1.0, -1.0, 0.9, -0.8, 1.1, -0.9, 1.0, -1.1, 1.2, -0.9, 1.0, -1.0, 0.9\\}$，$R = 0.3$，$S = 0.7$。\n\n你必须实现一个完整、可运行的程序，该程序：\n- 使用提供的测试套件值作为硬编码输入。\n- 对于每个测试用例中的每个通道，计算偏差、无偏样本标准差、一致性布尔值（容差 $t=0.1$）、建议的偏差订正偏移量（单位为开尔文）以及建议的更新后观测误差方差 $R_{\\text{new}}$（单位为 $\\mathrm{K}^2$，其中 $r_{\\min} = 0.01$）。\n- 生成单行输出，其中包含所有测试用例的结果，格式为嵌套的、用方括号括起来的逗号分隔列表。外层列表对应于测试用例；每个内层列表对应于该测试用例的通道；每个通道的结果是一个包含五个元素的列表，顺序如下：$[\\text{bias\\_K}, \\text{std\\_K}, \\text{consistent}, R_{\\text{new\\_K2}}, \\text{bias\\_correction\\_K}]$，其中数值条目四舍五入到三位小数。\n\n所有偏差和标准差必须以开尔文（K）表示。所有方差必须以 $\\mathrm{K}^2$ 表示。将所有数值输出四舍五入到三位小数。",
            "solution": "该问题已经过验证，被认为是合理的。这是一个定义明确、有科学依据的统计诊断练习，是数值天气预报中卫星数据同化领域的常规实践。我们将继续提供一个正式的解决方案。\n\n问题的核心在于分析观测减背景（O-B）残差，用 $d$ 表示。对于给定的观测，O-B残差定义为观测值 $y$ 与模式预测值 $H x_b$ 之间的差值，其中 $H$ 是（线性化的）观测算子，$x_b$ 是背景场（一种短期预报）。这些量的模型是：\n$$y = H x + \\varepsilon_o$$\n$$x_b = x + \\varepsilon_b$$\n其中 $x$ 是大气的真实状态，$\\varepsilon_o$ 和 $\\varepsilon_b$ 分别是观测误差和背景误差。这些误差被假定为零均值的随机变量，即 $\\mathbb{E}[\\varepsilon_o] = 0$ 和 $\\mathbb{E}[\\varepsilon_b] = 0$。\n\n根据这些定义，O-B 残差可以表示为误差的函数：\n$$d \\equiv y - H x_b = (H x + \\varepsilon_o) - H(x + \\varepsilon_b) = \\varepsilon_o - H \\varepsilon_b$$\n\n在观测误差和背景误差不相关的标准假设下，可以推导出 O-B 残差的期望均值和方差。\n\n期望均值（或真实偏差）为：\n$$\\mathbb{E}[d] = \\mathbb{E}[\\varepsilon_o - H \\varepsilon_b] = \\mathbb{E}[\\varepsilon_o] - H\\mathbb{E}[\\varepsilon_b] = 0 - H \\cdot 0 = 0$$\n样本均值与 $0$ 的任何系统性偏差都表明观测或模式背景中存在偏差。\n\n期望方差为：\n$$\\text{Var}(d) = \\text{Var}(\\varepsilon_o - H \\varepsilon_b)$$\n假设 $\\varepsilon_o$ 和 $H\\varepsilon_b$ 不相关，则差的方差是它们方差的和：\n$$\\text{Var}(d) = \\text{Var}(\\varepsilon_o) + \\text{Var}(H \\varepsilon_b)$$\n观测误差的方差 $\\text{Var}(\\varepsilon_o)$ 是观测误差协方差矩阵 $R$ 的一个对角元素。问题为每个通道提供了这个值。投影到观测空间的背景误差方差 $\\text{Var}(H \\varepsilon_b)$ 是矩阵 $S = HBH^\\top$ 的一个对角元素，其中 $B$ 是背景误差协方差矩阵。问题也提供了这个值 $S$。因此，单个通道的 O-B 残差的总期望方差为：\n$$\\text{Var}(d) = R + S$$\n\n有了这个理论基础，我们可以为每个通道，在给定一组 $n$ 个 O-B 样本 $\\{d_1, d_2, \\dots, d_n\\}$ 的情况下，概述计算步骤。\n\n1.  **偏差和无偏样本标准差**：\n    样本均值，作为偏差的估计，计算如下：\n    $$\\text{bias} = \\bar{d} = \\frac{1}{n} \\sum_{i=1}^{n} d_i$$\n    计算无偏样本方差以估计总体的真实方差：\n    $$s^2 = \\frac{1}{n-1} \\sum_{i=1}^{n} (d_i - \\bar{d})^2$$\n    所要求的无偏样本标准差是该值的平方根，$s = \\sqrt{s^2}$。在实现中，这通过使用自由度 `ddof=1` 来实现。结果以开尔文（K）表示。\n\n2.  **一致性评估**：\n    此步骤验证观测到的统计量是否与先验误差假设一致。将样本方差 $s^2$ 与期望方差 $R+S$ 进行比较。如果绝对差在期望方差的指定容差分数 $t$ 内，则声明为一致：\n    $$|s^2 - (R+S)| \\leq t \\cdot (R+S)$$\n    其中容差 $t$ 给定为 $0.1$。\n\n3.  **建议的偏差订正**：\n    如果检测到非零偏差 $\\bar{d}$，则应将其从观测中移除，以确保它们相对于模式是无偏的。订正应用于观测值 $y$，因此订正后的残差为 $(y - \\bar{d}) - Hx_b = d - \\bar{d}$。因此，应用于观测的适当订正偏移量为 $-\\bar{d}$。这就是我们要计算的值。\n\n4.  **更新的观测误差方差（$R_{\\text{new}}$）**：\n    总样本方差 $s^2$ 是真实总方差 $R+S$ 的一个估计。这表明，可以通过从观测到的总方差中减去（假定已知的）背景贡献 $S$ 来导出观测误差方差的更新估计 $R_{\\text{new}}$。这是矩估计法的一个应用，通常称为 Desroziers 诊断：\n    $$R_{\\text{new}} = s^2 - S$$\n    为确保所得方差具有物理意义（即非负），并防止小样本引起的不稳定性，强制执行一个最小值 $r_{\\min}$：\n    $$R_{\\text{new}} = \\max(r_{\\min}, s^2 - S)$$\n    问题指定 $r_{\\min} = 0.01 \\, \\mathrm{K}^2$。结果以 $\\mathrm{K}^2$ 表示。\n\n所有数值结果均按要求四舍五入到三位小数。实现将根据这些原则处理测试套件中的每个通道。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Processes a suite of test cases for O-B diagnostics in satellite data assimilation.\n    \"\"\"\n    test_cases = [\n        # Test Case 1\n        [\n            {'samples': [0.4, 1.1, -0.2, 0.6, 0.5, -0.1, 0.9, -0.3, 1.3, 0.2, -0.4, 0.7, 0.8, -0.5, 1.0, 0.3, -0.2, 0.6, 0.4, 1.2], 'R': 0.5, 'S': 0.5},\n            {'samples': [-0.6, 0.7, 0.1, -0.4, 0.5, 0.2, -0.3, 0.4, -0.2, 0.3, 0.0, 0.5, -0.5, 0.6, -0.1, 0.2, -0.4, 0.3, -0.2, 0.4], 'R': 0.8, 'S': 0.4},\n            {'samples': [-1.5, 1.6, 0.9, -1.2, 1.3, -0.8, 1.1, -1.0, 1.4, -0.7, 1.0, -1.1, 1.5, -0.9, 1.2, -1.3, 1.4, -0.6, 0.8, -1.4], 'R': 0.4, 'S': 0.3}\n        ],\n        # Test Case 2\n        [\n            {'samples': [0.1, 0.0, -0.1, 0.2, -0.2, 0.3, -0.3, 0.1, 0.0, -0.1, 0.2, -0.2, 0.3, -0.3, 0.1, 0.0, -0.1, 0.2, -0.2, 0.3], 'R': 0.05, 'S': 0.4},\n            {'samples': [2.0, 2.3, 1.7, 2.1, 1.9, 2.2, 2.4, 1.8, 2.0, 2.1, 1.9, 2.2, 2.3, 1.7, 2.1, 1.8, 2.0, 2.3, 1.9, 2.2], 'R': 0.6, 'S': 0.5},\n            {'samples': [0.3, -0.2, 0.1], 'R': 0.3, 'S': 0.4}\n        ],\n        # Test Case 3\n        [\n            {'samples': [-1.1, 1.2, -0.9, 1.0, -1.2, 1.3, -1.0, 1.1, -1.1, 1.0, -0.9, 1.2, -1.0, 1.1, -1.2, 1.3, -1.0, 1.1, -1.1, 1.0], 'R': 0.7, 'S': 0.5},\n            {'samples': [-1.0, 1.1, -0.8, 0.9, -1.1, 1.2, -0.9, 1.0, -1.0, 0.9, -0.8, 1.1, -0.9, 1.0, -1.1, 1.2, -0.9, 1.0, -1.0, 0.9], 'R': 0.3, 'S': 0.7}\n        ]\n    ]\n\n    t = 0.1  # Tolerance for consistency check\n    r_min = 0.01  # Minimum updated observation error variance\n\n    all_results = []\n    for test_case in test_cases:\n        case_results = []\n        for channel_data in test_case:\n            samples = np.array(channel_data['samples'])\n            R = channel_data['R']\n            S = channel_data['S']\n\n            # Ensure we can calculate unbiased variance (n > 1)\n            n_samples = len(samples)\n            if n_samples = 1:\n                # This case is not in the problem data, but good practice to handle.\n                # The result would be undefined. Here we skip.\n                continue\n\n            # 1. Compute bias and unbiased sample standard deviation.\n            bias_K = np.mean(samples)\n            # Use ddof=1 for unbiased sample standard deviation.\n            std_K = np.std(samples, ddof=1)\n            \n            # 2. Assess consistency.\n            # Unbiased sample variance is the square of the unbiased standard deviation.\n            sample_variance = std_K**2\n            prior_total_variance = R + S\n            is_consistent = abs(sample_variance - prior_total_variance) = t * prior_total_variance\n            \n            # 3. Propose bias correction offset.\n            bias_correction_K = -bias_K\n            \n            # 4. Propose updated observation error variance.\n            R_new_K2 = max(r_min, sample_variance - S)\n\n            # Store the five result items for the channel.\n            case_results.append([\n                bias_K,\n                std_K,\n                is_consistent,\n                R_new_K2,\n                bias_correction_K,\n            ])\n        all_results.append(case_results)\n\n    # Format the final output string as a nested list.\n    test_case_strings = []\n    for test_case_result in all_results:\n        channel_strings = []\n        for channel_result in test_case_result:\n            # Format each numerical value to 3 decimal places.\n            # Boolean is converted to string 'True' or 'False'.\n            items = [\n                f\"{channel_result[0]:.3f}\",\n                f\"{channel_result[1]:.3f}\",\n                str(channel_result[2]),\n                f\"{channel_result[3]:.3f}\",\n                f\"{channel_result[4]:.3f}\",\n            ]\n            channel_strings.append(f\"[{','.join(items)}]\")\n        test_case_strings.append(f\"[{','.join(channel_strings)}]\")\n    \n    final_output = f\"[{','.join(test_case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}