{
    "hands_on_practices": [
        {
            "introduction": "在集合数据同化中，一个基础但至关重要的步骤是确保集合扰动（即每个成员与集合平均的偏差）的中心化。本练习旨在阐明这一概念，通过推导一个能将任意集合矩阵转换为中心化扰动矩阵的算子。理解并应用此过程对于维持滤波器的数学一致性至关重要，因为它能确保分析步骤中均值和扰动的更新是正交且无污染的。",
            "id": "4038090",
            "problem": "考虑在数值天气预报和气候模拟中，使用集合平方根滤波（EnSRF）的一个基于集合的数据同化步骤。设在维度为 $n$ 的状态空间中有 $m$ 个集合成员，它们作为预报集合矩阵 $E^{f} \\in \\mathbb{R}^{n \\times m}$ 的列。预报集合平均定义为 $\\,\\bar{x}^{f} = \\frac{1}{m} E^{f} \\mathbf{1}\\,$，其中 $\\mathbf{1} \\in \\mathbb{R}^{m}$ 表示全1列向量。预报扰动定义为 $\\,X^{f} = E^{f} - \\bar{x}^{f} \\mathbf{1}^{\\top}\\,$。样本预报协方差为 $\\,P^{f} = \\frac{1}{m-1} X^{f} (X^{f})^{\\top}\\,$。给定观测算子和增益，通过对集合平均进行有效的 Kalman 更新，得到分析平均增量 $\\,\\delta \\bar{x}^{a} \\in \\mathbb{R}^{n}\\,$，并将其均匀地应用于所有集合成员，产生一个临时平均更新后的集合 $\\,\\widetilde{E}^{a} = E^{f} + \\delta \\bar{x}^{a} \\mathbf{1}^{\\top}\\,$。随后，将一个集合空间平方根变换 $\\,T \\in \\mathbb{R}^{m \\times m}\\,$ 应用于扰动以调整分析离散度，从而得到分析扰动 $\\,X^{a} = \\widetilde{E}^{a} T - \\big(\\frac{1}{m} \\widetilde{E}^{a} T \\mathbf{1}\\big) \\mathbf{1}^{\\top}\\,$。\n\n从上述集合平均和扰动的基本定义，以及在 $\\mathbb{R}^{m}$ 中到与 $\\mathbf{1}$ 正交的子空间上的正交投影概念出发，推导一个单一的右乘算子 $\\,C_{m} \\in \\mathbb{R}^{m \\times m}\\,$。当此算子应用于任何集合矩阵 $E \\in \\mathbb{R}^{n \\times m}$ 时，会产生满足 $\\,X \\mathbf{1} = \\mathbf{0}\\,$ 的中心化扰动 $\\,X = E C_{m}\\,$。你的推导必须证明 $C_{m}$ 所需的属性，以确保向 $E$ 添加一个均匀平均增量 $\\,\\delta \\bar{x} \\mathbf{1}^{\\top}\\,$ 不会污染扰动，并解释为什么这种中心化对于在 EnSRF 中维持 $\\,X^{a} \\mathbf{1} = \\mathbf{0}\\,$ 至关重要。\n\n以 $m$ 和 $\\mathbf{1}$ 的闭式解析表达式形式提供 $\\,C_{m}\\,$ 的最终答案。无需进行数值计算。最终答案必须是单一的符号表达式。",
            "solution": "该问题要求推导一个右乘算子 $C_m \\in \\mathbb{R}^{m \\times m}$，该算子将集合矩阵 $E \\in \\mathbb{R}^{n \\times m}$ 变换为其对应的中心化扰动矩阵 $X \\in \\mathbb{R}^{n \\times m}$。推导从所提供的基本定义开始。\n\n设集合矩阵为 $E$，其列是 $m$ 个集合成员。集合平均 $\\bar{x} \\in \\mathbb{R}^{n}$ 是这些成员的平均值。\n$$\n\\bar{x} = \\frac{1}{m} \\sum_{i=1}^{m} x_i = \\frac{1}{m} E \\mathbf{1}\n$$\n其中 $\\mathbf{1} \\in \\mathbb{R}^{m}$ 是一个全1列向量。\n\n扰动矩阵 $X$ 定义为从集合矩阵的每个成员中减去平均值。这可以写作：\n$$\nX = E - \\bar{x} \\mathbf{1}^{\\top}\n$$\n项 $\\bar{x} \\mathbf{1}^{\\top}$ 表示一个大小为 $n \\times m$ 的矩阵，其中每一列都是平均向量 $\\bar{x}$。\n\n为了推导算子 $C_m$ 使得 $X = E C_m$ 成立，我们将平均值 $\\bar{x}$ 的表达式代入扰动 $X$ 的定义中：\n$$\nX = E - \\left(\\frac{1}{m} E \\mathbf{1}\\right) \\mathbf{1}^{\\top}\n$$\n使用矩阵乘法的结合律，第二项可以改写为：\n$$\nX = E - E \\left(\\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n现在我们可以在左边提取集合矩阵 $E$ 的公因子。为此，我们将第一项表示为 $E$ 乘以 $m \\times m$ 的单位矩阵 $I$：\n$$\nX = E I - E \\left(\\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n提取 $E$ 的公因子得到：\n$$\nX = E \\left(I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}\\right)\n$$\n通过将此表达式与期望的形式 $X = E C_m$ 进行比较，我们可以确定中心化算子 $C_m$ 为：\n$$\nC_m = I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}\n$$\n问题要求所得的扰动 $X$ 满足条件 $X \\mathbf{1} = \\mathbf{0}$。我们可以通过将我们得到的 $X$ 的表达式右乘 $\\mathbf{1}$ 来验证此属性：\n$$\nX \\mathbf{1} = (E C_m) \\mathbf{1} = E (C_m \\mathbf{1})\n$$\n让我们计算乘积 $C_m \\mathbf{1}$：\n$$\nC_m \\mathbf{1} = \\left(I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}\\right) \\mathbf{1} = I \\mathbf{1} - \\frac{1}{m} \\mathbf{1} (\\mathbf{1}^{\\top} \\mathbf{1})\n$$\n乘积 $\\mathbf{1}^{\\top} \\mathbf{1}$ 是全1向量与自身的点积，即 $m$ 个 1 的和，所以 $\\mathbf{1}^{\\top} \\mathbf{1} = m$。代入此结果：\n$$\nC_m \\mathbf{1} = \\mathbf{1} - \\frac{1}{m} \\mathbf{1} (m) = \\mathbf{1} - \\mathbf{1} = \\mathbf{0}\n$$\n其中 $\\mathbf{0}$ 是 $\\mathbb{R}^{m}$ 中的零向量。因此，$X \\mathbf{1} = E \\mathbf{0} = \\mathbf{0}$（$\\mathbb{R}^{n}$ 中的零向量），这证实了扰动矩阵 $X$ 的列和为零，符合中心化扰动的要求。\n\n算子 $C_m$ 是一个正交投影矩阵。它将 $\\mathbb{R}^{m}$ 中的向量投影到与向量 $\\mathbf{1}$ 正交的子空间上。这个子空间是其分量之和为零的向量构成的子空间。\n\n接下来，我们必须证明为什么向集合 $E$ 添加一个均匀平均增量 $\\delta \\bar{x} \\mathbf{1}^{\\top}$ 不会污染使用 $C_m$ 计算出的扰动。设新的集合为 $E' = E + \\delta \\bar{x} \\mathbf{1}^{\\top}$。新的扰动矩阵 $X'$ 是：\n$$\nX' = E' C_m = (E + \\delta \\bar{x} \\mathbf{1}^{\\top}) C_m = E C_m + (\\delta \\bar{x} \\mathbf{1}^{\\top}) C_m\n$$\n第一项 $E C_m$ 是原始的扰动矩阵 $X$。第二项可以改写为：\n$$\n(\\delta \\bar{x} \\mathbf{1}^{\\top}) C_m = \\delta \\bar{x} (\\mathbf{1}^{\\top} C_m)\n$$\n项 $\\mathbf{1}^{\\top} C_m$ 是 $C_m^{\\top} \\mathbf{1}$ 的转置。矩阵 $C_m$ 是对称的，因为 $(I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top})^{\\top} = I^{\\top} - \\frac{1}{m} (\\mathbf{1}^{\\top})^{\\top} \\mathbf{1}^{\\top} = I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top} = C_m$。因此，$C_m^{\\top} = C_m$。所以，$\\mathbf{1}^{\\top} C_m = (C_m \\mathbf{1})^{\\top}$。如前所示，$C_m \\mathbf{1} = \\mathbf{0}$。因此，$\\mathbf{1}^{\\top} C_m = \\mathbf{0}^{\\top}$。\n污染项为 $\\delta \\bar{x} (\\mathbf{0}^{\\top}) = \\mathbf{0}$（$n \\times m$ 的零矩阵）。这证明了 $X' = X + \\mathbf{0} = X$。扰动对于集合的任何均匀平移都是不变的，这是中心化算子 $C_m$ 将向量投影到与均匀平移方向（向量 $\\mathbf{1}$）正交的子空间上的直接结果。\n\n最后，我们解释为什么在 EnSRF 的背景下，这种中心化对于维持 $X^a \\mathbf{1} = \\mathbf{0}$ 是至关重要的。数据同化更新在概念上分为平均值的更新和扰动（离散度）的更新。分析集合 $E^a$ 由更新后的分析平均 $\\bar{x}^a$ 和更新后的分析扰动 $X^a$ 重构而成：\n$$\nE^a = \\bar{x}^a \\mathbf{1}^{\\top} + X^a\n$$\n这个新形成的集合 $E^a$ 的平均值计算如下：\n$$\n\\text{mean}(E^a) = \\frac{1}{m} E^a \\mathbf{1} = \\frac{1}{m} (\\bar{x}^a \\mathbf{1}^{\\top} + X^a) \\mathbf{1}\n$$\n$$\n\\text{mean}(E^a) = \\frac{1}{m} \\bar{x}^a (\\mathbf{1}^{\\top} \\mathbf{1}) + \\frac{1}{m} X^a \\mathbf{1} = \\frac{1}{m} \\bar{x}^a (m) + \\frac{1}{m} X^a \\mathbf{1} = \\bar{x}^a + \\frac{1}{m} X^a \\mathbf{1}\n$$\n为了使分析集合的平均值等于计算出的分析平均值 $\\bar{x}^a$，数学上必须要求第二项为零：$\\frac{1}{m} X^a \\mathbf{1} = \\mathbf{0}$，这需要 $X^a \\mathbf{1} = \\mathbf{0}$。这个条件意味着分析扰动必须是中心化的。问题中给出的分析扰动定义 $X^{a} = \\widetilde{E}^{a} T - \\big(\\frac{1}{m} \\widetilde{E}^{a} T \\mathbf{1}\\big) \\mathbf{1}^{\\top}$，正是将此中心化原理应用于变换后的集合 $\\widetilde{E}^{a} T$。使用算子 $C_m$，这可以简洁地写成 $X^a = (\\widetilde{E}^{a} T) C_m$。此操作强制执行了中心化条件，这对于滤波的一致性是根本性的，确保最终集合的统计量（平均值和离散度）与同化算法所规定的完全一致。",
            "answer": "$$\n\\boxed{I - \\frac{1}{m} \\mathbf{1} \\mathbf{1}^{\\top}}\n$$"
        },
        {
            "introduction": "集合变换卡尔曼滤波（ETKF）的核心在于其高效的分析更新机制，该机制在由集合成员构成的低维子空间中进行。本练习通过一个具体的小规模算例，引导你逐步计算分析均值的权重向量和分析扰动的变换矩阵。通过这个动手实践，你将深入理解ETKF如何利用集合信息来确定性地更新集合，从而近似贝叶斯后验分布。",
            "id": "4038057",
            "problem": "考虑一个线性的、高斯的数据同化设置，用于一个包含 $N_e = 4$ 个成员的预报集合，并应用集合平方根滤波器 (EnSRF) 或集合变换卡尔曼滤波器 (ETKF)。设观测算子是线性的，观测误差是零均值高斯分布，其协方差为 $R \\in \\mathbb{R}^{m \\times m}$，观测空间中的预报集合异常由矩阵 $Y \\in \\mathbb{R}^{m \\times N_e}$ 表示，该矩阵满足 $Y \\mathbf{1} = \\mathbf{0}$（跨集合成员总和为零）。对于一个 $m = 2$ 的小例子，假设\n$$\nR = I_2, \\quad\nY = \n\\begin{pmatrix}\n2  -1  -1  0 \\\\\n0  2  -2  0\n\\end{pmatrix}, \\quad\nd = \n\\begin{pmatrix}\n3 \\\\\n0\n\\end{pmatrix},\n$$\n其中 $d$ 是新息向量。定义白化投影集合异常 \n$$\n\\tilde{Y} \\equiv R^{-1/2} Y \\left(N_e - 1\\right)^{-1/2}.\n$$\n从线性高斯贝叶斯更新和预报误差协方差的集合表示出发，推导集合空间分析均值权重向量 $w^a \\in \\mathbb{R}^{N_e}$ 和一个集合空间对称变换 $W^a \\in \\mathbb{R}^{N_e \\times N_e}$，该变换将预报异常映射到分析异常，且与平方根滤波原理一致。计算 $\\tilde{Y}$、$w^a$，并通过其谱来刻画 $W^a$。用 $N_e$ 和 $m$ 解释形成 $\\tilde{Y}$、计算 $w^a$ 和构建 $W^a$ 的计算复杂度（忽略状态维数，并假设矩阵-向量乘法是主要成本）。最后，为所提供的数值示例计算 $W^a$ 的行列式，并将您的最终答案表示为无舍入的精确值。",
            "solution": "首先验证问题，以确保其科学上合理、适定且客观。\n\n### 步骤1：提取已知条件\n-   **系统类型**：线性高斯数据同化。\n-   **滤波器类型**：集合平方根滤波器 (EnSRF) 或集合变换卡尔曼滤波器 (ETKF)。\n-   **集合大小**：$N_e = 4$。\n-   **观测维数**：$m = 2$。\n-   **观测误差协方差**：$R = I_2 = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}$。\n-   **观测空间中的预报集合异常**：$Y = \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix}$。此矩阵必须满足 $Y \\mathbf{1} = \\mathbf{0}$。\n-   **新息向量**：$d = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$。\n-   **定义**：白化投影集合异常 $\\tilde{Y} \\equiv R^{-1/2} Y (N_e - 1)^{-1/2}$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题陈述具有科学依据，植根于集合卡尔曼滤波的标准理论，这是一种广泛应用于数值天气预报和其他地球物理科学中的技术。所提供的方程和定义，例如卡尔曼增益和ETKF更新的方程和定义，都是标准的。该问题是适定的，为获得唯一解提供了所有必要的数据（$N_e$、$m$、$R$、$Y$、$d$）。语言客观而精确。对给定约束 $Y \\mathbf{1} = \\mathbf{0}$ 的检验确认了其有效性：\n$$\nY \\mathbf{1} = \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 2 - 1 - 1 + 0 \\\\ 0 + 2 - 2 + 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} = \\mathbf{0}.\n$$\n该问题没有科学上的不合理性、模糊性和矛盾之处。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将提供完整的解答。\n\n### 解答\n集合变换卡尔曼滤波器 (ETKF) 的分析步骤将预报集合均值 $\\bar{x}^f$ 和预报异常 $A^f$ 更新为分析均值 $\\bar{x}^a$ 和分析异常 $A^a$。更新由以下公式给出：\n$$\n\\bar{x}^a = \\bar{x}^f + A^f w^a\n$$\n$$\nA^a = A^f W^a\n$$\n其中 $w^a$ 是分析均值权重向量，$W^a$ 是对称变换矩阵。它们在维度为 $N_e$ 的集合空间中定义。\n\n**1. 推导与初始计算**\n\n首先，我们定义并计算白化投影异常 $\\tilde{Y}$。\n给定 $R = I_2$，其平方根逆 $R^{-1/2}$ 也是 $I_2$。对于 $N_e = 4$，我们有 $(N_e - 1)^{-1/2} = 1/\\sqrt{3}$。\n$$\n\\tilde{Y} = R^{-1/2} Y (N_e - 1)^{-1/2} = I_2 \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\frac{1}{\\sqrt{3}} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix}\n$$\nETKF 的核心是 $N_e \\times N_e$ 矩阵 $C = \\tilde{Y}^T \\tilde{Y}$。\n$$\nC = \\tilde{Y}^T \\tilde{Y} = \\left( \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  0 \\\\ -1  2 \\\\ -1  -2 \\\\ 0  0 \\end{pmatrix} \\right) \\left( \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  -1  -1  0 \\\\ 0  2  -2  0 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix}\n$$\n\n**2. 分析均值权重向量 ($w^a$)**\n\n分析均值权重向量 $w^a$ 由标准卡尔曼增益公式推导得出，并在集合空间中表示为：\n$$\nw^a = \\frac{1}{\\sqrt{N_e - 1}} (I_{N_e} + \\tilde{Y}^T \\tilde{Y})^{-1} \\tilde{Y}^T \\tilde{d}\n$$\n其中 $\\tilde{d} = R^{-1/2} d$。\n首先，我们计算所需的各项：\n$\\tilde{d} = I_2 d = \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix}$。\n$$\n\\tilde{Y}^T \\tilde{d} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 2  0 \\\\ -1  2 \\\\ -1  -2 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 0 \\end{pmatrix} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 6 \\\\ -3 \\\\ -3 \\\\ 0 \\end{pmatrix} = \\sqrt{3} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix}\n$$\n接下来，我们计算 $(I_{N_e} + C)^{-1}$。\n$$\nI_{N_e} + C = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix} + \\frac{1}{3} \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix}\n$$\n设 $3 \\times 3$ 子矩阵为 $B = \\begin{pmatrix} 7  -2  -2 \\\\ -2  8  -3 \\\\ -2  -3  8 \\end{pmatrix}$。其行列式为 $\\det(B) = 7(64-9) + 2(-16-6) - 2(6+16) = 7(55) - 2(22) - 2(22) = 385 - 88 = 297$。\n其逆矩阵为 $(I_{N_e} + C)^{-1} = 3 \\begin{pmatrix} B^{-1}  \\mathbf{0} \\\\ \\mathbf{0}^T  1/3 \\end{pmatrix}$。\n我们求得 $B^{-1} = \\frac{1}{297} \\begin{pmatrix} 55  22  22 \\\\ 22  52  25 \\\\ 22  25  52 \\end{pmatrix}$。\n因此，$(I_{N_e} + C)^{-1} = \\frac{3}{297} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix} = \\frac{1}{99} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix}$。\n现在我们计算 $w^a$：\n$$\nw^a = \\frac{1}{\\sqrt{3}} \\left( \\frac{1}{99} \\begin{pmatrix} 55  22  22  0 \\\\ 22  52  25  0 \\\\ 22  25  52  0 \\\\ 0  0  0  99 \\end{pmatrix} \\right) \\left( \\sqrt{3} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\\\ 0 \\end{pmatrix} \\right)\n= \\frac{1}{99} \\begin{pmatrix} 55(2) + 22(-1) + 22(-1) \\\\ 22(2) + 52(-1) + 25(-1) \\\\ 22(2) + 25(-1) + 52(-1) \\\\ 0 \\end{pmatrix}\n$$\n$$\nw^a = \\frac{1}{99} \\begin{pmatrix} 110 - 22 - 22 \\\\ 44 - 52 - 25 \\\\ 44 - 25 - 52 \\\\ 0 \\end{pmatrix} = \\frac{1}{99} \\begin{pmatrix} 66 \\\\ -33 \\\\ -33 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2/3 \\\\ -1/3 \\\\ -1/3 \\\\ 0 \\end{pmatrix}\n$$\n\n**3. 异常变换矩阵 ($W^a$)**\n\n对称变换矩阵 $W^a$ 是集合空间中分析误差协方差的矩阵平方根：\n$$\nW^a = \\left[ (I_{N_e} + \\tilde{Y}^T \\tilde{Y})^{-1} \\right]^{1/2} = \\left[ (I_{N_e} + C)^{-1} \\right]^{1/2}\n$$\n为了通过谱来刻画 $W^a$，我们求出 $C$ 的特征值，记为 $\\lambda_i$。那么 $W^a$ 的特征值将是 $(1+\\lambda_i)^{-1/2}$。\n$C$ 的特征值是 $3C = \\begin{pmatrix} 4  -2  -2  0 \\\\ -2  5  -3  0 \\\\ -2  -3  5  0 \\\\ 0  0  0  0 \\end{pmatrix}$ 的特征值的 $1/3$ 倍。\n一个特征值显然是 $0$。其他的来自左上角的 $3 \\times 3$ 分块，记为 $M$。$M$ 的特征多项式是 $\\det(M-\\lambda I) = -\\lambda(\\lambda-6)(\\lambda-8)$。$M$ 的特征值是 $\\{0, 6, 8\\}$。\n因此，$3C$ 的特征值是 $\\{8, 6, 0, 0\\}$。\n$C$ 的特征值是 $\\lambda_i = \\{8/3, 2, 0, 0\\}$。\n因此，$W^a$ 的谱是：\n$$\n\\left\\{ (1+8/3)^{-1/2}, (1+2)^{-1/2}, (1+0)^{-1/2}, (1+0)^{-1/2} \\right\\} = \\left\\{ (11/3)^{-1/2}, (3)^{-1/2}, 1, 1 \\right\\} = \\left\\{ \\sqrt{\\frac{3}{11}}, \\frac{1}{\\sqrt{3}}, 1, 1 \\right\\}\n$$\n\n**4. 计算复杂度**\n\n-   **形成 $\\tilde{Y}$**：对于一个通用的 $m \\times m$ 矩阵 $R$，计算 $R^{-1/2}$ 的成本是 $O(m^3)$。矩阵乘积 $R^{-1/2}Y$ 的成本是 $O(m^2 N_e)$。总复杂度是 $O(m^3 + m^2 N_e)$。如果 $R$ 是对角矩阵，这会简化为 $O(m^2 N_e)$。\n-   **计算 $w^a$**：主要步骤是：\n    1.  形成 $C = \\tilde{Y}^T \\tilde{Y}$：一个 $N_e \\times m$ 矩阵乘以一个 $m \\times N_e$ 矩阵，成本为 $O(N_e^2 m)$。\n    2.  对 $(I_{N_e} + C)$ 求逆：一个 $N_e \\times N_e$ 矩阵，成本为 $O(N_e^3)$。\n    3.  矩阵-向量乘积：成本为 $O(N_e m)$ 和 $O(N_e^2)$。\n    主要成本是 $O(N_e^2 m + N_e^3)$。由于通常 $N_e \\ll m$，这通常被引述为 $O(N_e^2 m)$。\n-   **构建 $W^a$**：这需要对 $N_e \\times N_e$ 矩阵 $(I_{N_e} + C)$ 进行特征分解，成本为 $O(N_e^3)$。\n    1.  形成 $C$：$O(N_e^2 m)$。\n    2.  特征分解：$O(N_e^3)$。\n    3.  从其特征分量重构 $W^a$：$O(N_e^3)$。\n    总的主要成本同样是 $O(N_e^2 m + N_e^3)$。\n\n**5. $W^a$ 的行列式**\n\n一个矩阵的行列式是其特征值的乘积。使用上面计算的 $W^a$ 的谱：\n$$\n\\det(W^a) = 1 \\times 1 \\times \\frac{1}{\\sqrt{3}} \\times \\sqrt{\\frac{3}{11}} = \\frac{1}{\\sqrt{3}} \\frac{\\sqrt{3}}{\\sqrt{11}} = \\frac{1}{\\sqrt{11}}\n$$\n或者，我们可以使用性质 $\\det(A^{1/2}) = \\sqrt{\\det(A)}$ 和 $\\det(A^{-1}) = (\\det(A))^{-1}$：\n$$\n\\det(W^a) = \\sqrt{\\det((I+C)^{-1})} = \\sqrt{(\\det(I+C))^{-1}} = (\\det(I+C))^{-1/2}\n$$\n我们计算 $\\det(I+C)$：\n$$\n\\det(I+C) = \\det\\left( \\frac{1}{3} \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix} \\right) = \\left(\\frac{1}{3}\\right)^4 \\det \\begin{pmatrix} 7  -2  -2  0 \\\\ -2  8  -3  0 \\\\ -2  -3  8  0 \\\\ 0  0  0  3 \\end{pmatrix}\n$$\n分块矩阵的行列式是 $3 \\times \\det(B) = 3 \\times 297$。\n$$\n\\det(I+C) = \\frac{1}{81} \\times (3 \\times 297) = \\frac{297}{27} = 11\n$$\n因此，$\\det(W^a) = (11)^{-1/2} = \\frac{1}{\\sqrt{11}}$。结果是一致的。\n最终答案要求为精确值。\n$$\n\\det(W^a) = \\frac{1}{\\sqrt{11}}\n$$",
            "answer": "$$\n\\boxed{\\frac{1}{\\sqrt{11}}}\n$$"
        },
        {
            "introduction": "理论与实践的结合是检验算法正确性的黄金标准。本练习将带领你完成一个完整的集合平方根滤波分析步骤，从给定的预报集合出发，生成分析集合，并最终验证其统计特性。通过证明分析集合的样本均值和样本协方差精确匹配卡尔曼滤波方程推导出的理论值，你将亲手确认该方法的内在一致性和准确性。",
            "id": "4038070",
            "problem": "考虑一个用于数值天气预报模型的二维状态空间中的单次线性高斯数据同化步骤。使用集合平方根滤波器（ESRF），集合大小为 $N_e = 3$。预报集合的样本均值为 $\\bar{x}^f \\in \\mathbb{R}^2$，缩放异常矩阵为 $A^f \\in \\mathbb{R}^{2 \\times 3}$，其定义使得预报协方差满足 $P^f = A^f (A^f)^{\\top}$。观测采用线性观测算子 $H \\in \\mathbb{R}^{2 \\times 2}$ 和观测误差协方差 $R \\in \\mathbb{R}^{2 \\times 2}$，观测向量为 $y \\in \\mathbb{R}^2$。\n\n给定以下具体的、科学上合理的配置：\n- 状态维度 $m = 2$ 且集合大小 $N_e = 3$。\n- 预报均值 $\\bar{x}^f = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix}$。\n- 缩放的预报异常\n$$\nA^f = \\begin{pmatrix}\n\\sqrt{\\frac{2}{3}}  -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{6}} \\\\\n0  \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}}\n\\end{pmatrix},\n$$\n其构造为列均值为零且协方差是各向同性的。\n- 观测算子 $H = I_2$（$2 \\times 2$ 单位矩阵）。\n- 观测误差协方差 $R = 2 I_2$。\n- 观测向量 $y = \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix}$。\n\n从线性高斯估计的第一性原理（卡尔曼滤波器的贝叶斯推导）和集合样本统计的定义出发，完成以下任务：\n1. 推导并计算卡尔曼增益 $K$、分析均值 $\\bar{x}^a$ 和分析协方差 $P^a$。\n2. 在集合空间中推导并计算一个对称平方根集合变换矩阵 $T \\in \\mathbb{R}^{3 \\times 3}$，使得分析的缩放异常满足 $A^a = A^f T$ 和 $A^a (A^a)^{\\top} = P^a$。在推导步骤中，仅使用由 $H$、$R$ 和 $P^f$ 所暗示的各向同性性质。\n3. 使用规范的平方根重构规则，从分析均值和缩放异常中构造分析集合成员，并计算它们的样本均值和样本协方差。\n4. 定义验证指标\n$$\nJ \\;=\\; \\left\\| \\bar{x}_{\\text{sample}}^a - \\bar{x}^a \\right\\|_2^2 \\;+\\; \\left\\| P_{\\text{sample}}^a - P^a \\right\\|_F^2,\n$$\n其中 $\\|\\cdot\\|_2$ 是欧几里得范数，$\\|\\cdot\\|_F$ 是弗罗贝尼乌斯范数。精确计算 $J$。不需要四舍五入。最终答案必须是 $J$ 的单个数值，没有单位。",
            "solution": "该问题被评估为具有科学依据、问题明确且客观。所有必要的数据和定义均已提供，且没有内部矛盾。该问题设置是数据同化领域一个标准的、尽管是简化的例子，适合进行严格的求解。因此我们可以继续。\n\n根据问题陈述的要求，解答分为四个部分呈现。\n\n### 第1部分：卡尔曼增益、分析均值和分析协方差\n\n分析步骤的基础是从线性高斯贝叶斯推断中导出的一套标准卡尔曼滤波更新方程。分析均值 $\\bar{x}^a$ 和分析协方差 $P^a$ 由以下公式给出：\n$$ \\bar{x}^a = \\bar{x}^f + K(y - H\\bar{x}^f) $$\n$$ P^a = (I - KH)P^f $$\n其中卡尔曼增益 $K$ 定义为：\n$$ K = P^f H^{\\top} (H P^f H^{\\top} + R)^{-1} $$\n\n首先，我们从给定的缩放异常矩阵 $A^f$ 计算预报协方差矩阵 $P^f$。问题将该关系定义为 $P^f = A^f (A^f)^{\\top}$。\n$$ P^f = \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{6}} \\\\ 0  \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}} \\end{pmatrix} \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  0 \\\\ -\\frac{1}{\\sqrt{6}}  \\frac{1}{\\sqrt{2}} \\\\ -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{2}} \\end{pmatrix} $$\n$$ P^f = \\begin{pmatrix} \\left(\\frac{2}{3}\\right) + \\left(\\frac{1}{6}\\right) + \\left(\\frac{1}{6}\\right)  0 - \\frac{1}{\\sqrt{12}} + \\frac{1}{\\sqrt{12}} \\\\ 0 - \\frac{1}{\\sqrt{12}} + \\frac{1}{\\sqrt{12}}  0 + \\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right) \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3}+\\frac{1}{3}  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = I_2 $$\n预报协方差是 $2 \\times 2$ 单位矩阵，证实了所述的各向同性。\n\n接下来，我们计算卡尔曼增益 $K$。给定 $H=I_2$ 和 $R=2I_2$。\n项 $H P^f H^{\\top} + R$ 变为：\n$$ H P^f H^{\\top} + R = I_2 I_2 I_2^{\\top} + 2I_2 = I_2 + 2I_2 = 3I_2 $$\n其逆矩阵为 $(3I_2)^{-1} = \\frac{1}{3}I_2$。\n现在，我们计算 $K$：\n$$ K = (P^f H^{\\top}) (H P^f H^{\\top} + R)^{-1} = (I_2 I_2^{\\top}) \\left(\\frac{1}{3}I_2\\right) = I_2 \\left(\\frac{1}{3}I_2\\right) = \\frac{1}{3}I_2 $$\n\n使用计算出的增益 $K$，我们求出分析均值 $\\bar{x}^a$。给定 $\\bar{x}^f = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix}$ 和 $y = \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix}$。\n$$ \\bar{x}^a = \\bar{x}^f + K(y - H\\bar{x}^f) = \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix} + \\frac{1}{3}I_2 \\left( \\begin{pmatrix}3 \\\\ -1 \\end{pmatrix} - I_2 \\begin{pmatrix}0 \\\\ 0 \\end{pmatrix} \\right) = \\frac{1}{3}\\begin{pmatrix}3 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} $$\n\n最后，我们计算分析协方差 $P^a$：\n$$ P^a = (I - KH)P^f = \\left(I_2 - \\left(\\frac{1}{3}I_2\\right)I_2\\right)I_2 = \\left(I_2 - \\frac{1}{3}I_2\\right)I_2 = \\frac{2}{3}I_2 $$\n分析协方差为 $P^a = \\begin{pmatrix} \\frac{2}{3}  0 \\\\ 0  \\frac{2}{3} \\end{pmatrix}$。\n\n### 第2部分：集合变换矩阵\n\n我们需要找到一个对称矩阵 $T \\in \\mathbb{R}^{3 \\times 3}$，使得分析的缩放异常 $A^a = A^f T$ 满足 $A^a (A^a)^{\\top} = P^a$。\n问题指定使用系统的各向同性。鉴于 $P^f$、$H$ 和 $R$ 都是各向同性的（与单位矩阵成比例），从预报空间到分析空间的变换也是各向同性的。这表明异常变换的最简单形式是简单的缩放。因此，我们假设一个形式为 $T = c I_{N_e}$ 的变换矩阵，其中 $c$ 是一个标量且 $N_e = 3$。这种 $T$ 的选择是对称的。\n\n将 $A^a = c A^f$ 代入协方差方程：\n$$ P^a = A^a (A^a)^{\\top} = (c A^f)(c A^f)^{\\top} = c^2 A^f (A^f)^{\\top} = c^2 P^f $$\n从第1部分可知，$P^a = \\frac{2}{3}I_2$ 且 $P^f=I_2$。\n$$ \\frac{2}{3}I_2 = c^2 I_2 $$\n这意味着 $c^2 = \\frac{2}{3}$。对于正定变换，我们选择正根 $c = \\sqrt{\\frac{2}{3}}$。\n因此，一个有效的对称变换矩阵是：\n$$ T = \\sqrt{\\frac{2}{3}} I_3 = \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  0  0 \\\\ 0  \\sqrt{\\frac{2}{3}}  0 \\\\ 0  0  \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n值得注意的是，集合平方根滤波器的标准 $T$ 公式为 $T_{\\text{std}} = (I + (HA^f)^\\top R^{-1} (HA^f))^{-1/2}$。对于中心化异常（如此处 $A^f$ 的列和为零），有 $A^f J = 0$，其中 $J$ 是全一矩阵。在这种情况下，$A^f T_{\\text{std}} = A^f (\\sqrt{\\frac{2}{3}} I_3)$。这证实了我们基于各向同性选择的 $T$ 能够为分析异常带来正确的物理结果。\n\n### 第3部分：分析集合成员和样本统计\n\n分析的缩放异常为 $A^a=A^f T = \\sqrt{\\frac{2}{3}}A^f$：\n$$ A^a = \\sqrt{\\frac{2}{3}} \\begin{pmatrix} \\sqrt{\\frac{2}{3}}  -\\frac{1}{\\sqrt{6}}  -\\frac{1}{\\sqrt{6}} \\\\ 0  \\frac{1}{\\sqrt{2}}  -\\frac{1}{\\sqrt{2}} \\end{pmatrix} = \\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  -\\frac{1}{3} \\\\ 0  \\frac{1}{\\sqrt{3}}  -\\frac{1}{\\sqrt{3}} \\end{pmatrix} $$\n集合成员的规范重构规则需要未缩放的异常矩阵 $X'^a$，其列是与均值的偏差。关系为 $X'^a = \\sqrt{N_e - 1} A^a$。这里 $N_e=3$。\n$$ X'^a = \\sqrt{2} A^a = \\sqrt{2} \\begin{pmatrix} \\frac{2}{3}  -\\frac{1}{3}  -\\frac{1}{3} \\\\ 0  \\frac{1}{\\sqrt{3}}  -\\frac{1}{\\sqrt{3}} \\end{pmatrix} = \\begin{pmatrix} \\frac{2\\sqrt{2}}{3}  -\\frac{\\sqrt{2}}{3}  -\\frac{\\sqrt{2}}{3} \\\\ 0  \\sqrt{\\frac{2}{3}}  -\\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n分析集合成员 $x_i^a$ 的构造方式为 $x_i^a = \\bar{x}^a + X'_{a,i}$，其中 $X'_{a,i}$ 是 $X'^a$ 的第 $i$ 列。\n$$ x_1^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} \\frac{2\\sqrt{2}}{3} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 + \\frac{2\\sqrt{2}}{3} \\\\ -\\frac{1}{3} \\end{pmatrix} $$\n$$ x_2^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} -\\frac{\\sqrt{2}}{3} \\\\ \\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{\\sqrt{2}}{3} \\\\ -\\frac{1}{3} + \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n$$ x_3^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix} + \\begin{pmatrix} -\\frac{\\sqrt{2}}{3} \\\\ -\\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 1 - \\frac{\\sqrt{2}}{3} \\\\ -\\frac{1}{3} - \\sqrt{\\frac{2}{3}} \\end{pmatrix} $$\n现在，我们计算样本均值 $\\bar{x}_{\\text{sample}}^a = \\frac{1}{3}(x_1^a + x_2^a + x_3^a)$：\n$$ \\bar{x}_{\\text{sample}}^a = \\frac{1}{3} \\left( 3\\bar{x}^a + (X'_{a,1} + X'_{a,2} + X'_{a,3}) \\right) = \\bar{x}^a + \\frac{1}{3} X'^a \\begin{pmatrix}1\\\\1\\\\1\\end{pmatrix} $$\n$X'^a$ 的列和为 $\\begin{pmatrix} \\frac{2\\sqrt{2}}{3}-\\frac{\\sqrt{2}}{3}-\\frac{\\sqrt{2}}{3} \\\\ 0+\\sqrt{\\frac{2}{3}}-\\sqrt{\\frac{2}{3}} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。这是有保证的，因为 $A^f$ 中的初始异常是中心化的。\n因此，$\\bar{x}_{\\text{sample}}^a = \\bar{x}^a = \\begin{pmatrix}1 \\\\ -\\frac{1}{3} \\end{pmatrix}$。\n\n接下来，我们计算样本协方差 $P_{\\text{sample}}^a = \\frac{1}{N_e-1} X'^a (X'^a)^{\\top}$：\n$$ P_{\\text{sample}}^a = \\frac{1}{2} (\\sqrt{2}A^a) (\\sqrt{2}A^a)^{\\top} = \\frac{1}{2}(2)A^a(A^a)^{\\top} = A^a(A^a)^{\\top} $$\n根据分析步骤的定义，我们要求 $A^a(A^a)^{\\top} = P^a$。\n因此，$P_{\\text{sample}}^a = P^a = \\frac{2}{3}I_2$。\n\n### 第4部分：验证指标\n\n验证指标定义为 $ J = \\left\\| \\bar{x}_{\\text{sample}}^a - \\bar{x}^a \\right\\|_2^2 + \\left\\| P_{\\text{sample}}^a - P^a \\right\\|_F^2 $。\n从第3部分，我们已经严格证明：\n1. $\\bar{x}_{\\text{sample}}^a = \\bar{x}^a$，这意味着 $\\bar{x}_{\\text{sample}}^a - \\bar{x}^a = \\mathbf{0}$。\n2. $P_{\\text{sample}}^a = P^a$，这意味着 $P_{\\text{sample}}^a - P^a = \\mathbf{0}$。\n\n将这些结果代入 $J$ 的定义中：\n$$ J = \\left\\| \\mathbf{0} \\right\\|_2^2 + \\left\\| \\mathbf{0} \\right\\|_F^2 $$\n零向量的欧几里得范数为 $0$，零矩阵的弗罗贝尼乌斯范数为 $0$。\n$$ J = 0^2 + 0^2 = 0 $$\n验证指标 $J$ 的精确值为 $0$。这个结果证实了，当正确应用时，集合平方根滤波器方法所产生的分析集合的样本一阶矩和二阶矩与从卡尔曼滤波方程推导出的理论矩完全匹配。",
            "answer": "$$\\boxed{0}$$"
        }
    ]
}