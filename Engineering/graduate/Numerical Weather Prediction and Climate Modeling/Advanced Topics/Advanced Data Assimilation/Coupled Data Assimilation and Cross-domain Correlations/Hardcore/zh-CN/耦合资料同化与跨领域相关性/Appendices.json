{
    "hands_on_practices": [
        {
            "introduction": "本练习通过一个具体的、分步的计算，揭示了耦合资料同化的核心机制。通过处理一个简化的双变量系统，您将清楚地看到一个领域（大气）的观测如何直接改进另一个领域（海洋）的状态估计。该实践是理解跨域相关性（由背景误差协方差矩阵的非对角元素表示）如何实现地球系统各分量之间信息传递的基础。",
            "id": "4028471",
            "problem": "考虑一个用于数值天气预报和气候模拟数据同化的耦合大气-海洋状态，其状态向量为 $\\mathbf{x} = \\begin{pmatrix} x_{a} \\\\ x_{o} \\end{pmatrix}$，表示在同一水平位置上的大气标量变量 $x_{a}$ 和海洋标量变量 $x_{o}$。假设在一个线性高斯框架下，该框架与经典卡尔曼滤波器 (KF) 和集合卡尔曼滤波器 (EnKF) 在线性观测算子和高斯误差的条件下是一致的。背景（先验）均值为 $\\mathbf{x}_{b} = \\begin{pmatrix} x_{a,b} \\\\ x_{o,b} \\end{pmatrix}$，背景误差协方差为\n$$\n\\mathbf{B} \\;=\\; \\begin{pmatrix}\n\\sigma_{a}^{2} & \\mathcal{C}_{ao} \\\\\n\\mathcal{C}_{ao} & \\sigma_{o}^{2}\n\\end{pmatrix},\n$$\n其中 $\\sigma_{a}^{2} > 0$，$\\sigma_{o}^{2} > 0$，且跨域协方差 $\\mathcal{C}_{ao} \\neq 0$ 为非零。现有单一的大气观测值 $y_{a}$，其线性观测算子为 $\\mathbf{H} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}$，观测误差方差为 $r_{a} > 0$，因此标量新息为 $d = y_{a} - x_{a,b}$。\n\n为确保科学上真实的耦合增量，通过舒尔（哈达玛）积应用协方差局地化，$\\mathbf{B}_{\\mathrm{loc}} = \\mathbf{B} \\circ \\mathbf{L}$，其中对称局地化矩阵为\n$$\n\\mathbf{L} \\;=\\; \\begin{pmatrix}\n1 & \\rho_{ao} \\\\\n\\rho_{ao} & 1\n\\end{pmatrix},\n$$\n其中 $0 \\le \\rho_{ao} \\le 1$ 是为大气-海洋耦合指定的跨域局地化系数。局地化卡尔曼增益 $\\mathbf{K}_{\\mathrm{loc}}$ 作用于标量新息 $d$ 以产生分析增量 $\\delta \\mathbf{x} = \\mathbf{K}_{\\mathrm{loc}}\\, d$。\n\n设物理上一致的参数值为\n$$\n\\sigma_{a}^{2} = 4,\\quad \\sigma_{o}^{2} = 9,\\quad \\mathcal{C}_{ao} = 3,\\quad r_{a} = 1,\\quad \\rho_{ao} = \\frac{1}{2},\\quad d = 2.\n$$\n\n从第一性原理出发，推导此单观测、双变量耦合系统的局地化卡尔曼增益向量 $\\mathbf{K}_{\\mathrm{loc}}$，推导过程需始于线性高斯最小方差分析框架，并显式地通过 $\\mathbf{B}_{\\mathrm{loc}}$ 引入局地化。然后，计算海洋分析增量 $\\delta x_{o}$，并解析地证明非零的 $\\mathcal{C}_{ao}$ 是如何通过 $\\rho_{ao}\\,\\mathcal{C}_{ao}$ 对 $\\delta x_{o}$ 产生贡献的。\n\n将最终数值答案四舍五入至三位有效数字。以开尔文（Kelvin）为单位表示该增量。",
            "solution": "### 推导\n\n在线性高斯框架中，分析增量 $\\delta \\mathbf{x}$ 由局地化卡尔曼增益 $\\mathbf{K}_{\\mathrm{loc}}$ 和新息 $d$ 给出，即 $\\delta \\mathbf{x} = \\mathbf{K}_{\\mathrm{loc}} d$。局地化卡尔曼增益的公式为：\n$$\n\\mathbf{K}_{\\mathrm{loc}} = \\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}} (\\mathbf{H} \\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}} + \\mathbf{R})^{-1}\n$$\n其中 $\\mathbf{B}_{\\mathrm{loc}}$ 是局地化的背景误差协方差。\n\n首先，我们通过背景协方差 $\\mathbf{B}$ 和局地化矩阵 $\\mathbf{L}$ 的舒尔积（逐元素相乘）构建 $\\mathbf{B}_{\\mathrm{loc}}$：\n$$\n\\mathbf{B}_{\\mathrm{loc}} = \\mathbf{B} \\circ \\mathbf{L} = \\begin{pmatrix} \\sigma_{a}^{2} & \\mathcal{C}_{ao} \\\\ \\mathcal{C}_{ao} & \\sigma_{o}^{2} \\end{pmatrix} \\circ \\begin{pmatrix} 1 & \\rho_{ao} \\\\ \\rho_{ao} & 1 \\end{pmatrix} = \\begin{pmatrix} \\sigma_{a}^{2} & \\rho_{ao}\\mathcal{C}_{ao} \\\\ \\rho_{ao}\\mathcal{C}_{ao} & \\sigma_{o}^{2} \\end{pmatrix}\n$$\n\n接下来，我们计算增益公式中的各项。给定观测算子 $\\mathbf{H} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}$ 及其转置 $\\mathbf{H}^{\\mathrm{T}} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，以及标量观测误差方差 $\\mathbf{R} = r_a$。\n\n计算乘积 $\\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}}$：\n$$\n\\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}} = \\begin{pmatrix} \\sigma_{a}^{2} & \\rho_{ao}\\mathcal{C}_{ao} \\\\ \\rho_{ao}\\mathcal{C}_{ao} & \\sigma_{o}^{2} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\sigma_{a}^{2} \\\\ \\rho_{ao}\\mathcal{C}_{ao} \\end{pmatrix}\n$$\n\n计算新息方差项 $\\mathbf{H} \\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}} + r_{a}$：\n$$\n\\mathbf{H} \\mathbf{B}_{\\mathrm{loc}} \\mathbf{H}^{\\mathrm{T}} = \\begin{pmatrix} 1 & 0 \\end{pmatrix} \\begin{pmatrix} \\sigma_{a}^{2} \\\\ \\rho_{ao}\\mathcal{C}_{ao} \\end{pmatrix} = \\sigma_{a}^{2}\n$$\n总新息方差为 $\\sigma_{a}^{2} + r_{a}$。\n\n组合以上各项，得到局地化卡尔曼增益向量 $\\mathbf{K}_{\\mathrm{loc}}$：\n$$\n\\mathbf{K}_{\\mathrm{loc}} = \\begin{pmatrix} \\sigma_{a}^{2} \\\\ \\rho_{ao}\\mathcal{C}_{ao} \\end{pmatrix} \\frac{1}{\\sigma_{a}^{2} + r_{a}} = \\begin{pmatrix} \\frac{\\sigma_{a}^{2}}{\\sigma_{a}^{2} + r_{a}} \\\\ \\frac{\\rho_{ao}\\mathcal{C}_{ao}}{\\sigma_{a}^{2} + r_{a}} \\end{pmatrix}\n$$\n\n分析增量向量为 $\\delta \\mathbf{x} = \\mathbf{K}_{\\mathrm{loc}} d$：\n$$\n\\delta \\mathbf{x} = \\begin{pmatrix} \\delta x_{a} \\\\ \\delta x_{o} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\sigma_{a}^{2}}{\\sigma_{a}^{2} + r_{a}} d \\\\ \\frac{\\rho_{ao}\\mathcal{C}_{ao}}{\\sigma_{a}^{2} + r_{a}} d \\end{pmatrix}\n$$\n因此，海洋分析增量 $\\delta x_{o}$ 的解析表达式为：\n$$\n\\delta x_{o} = \\frac{\\rho_{ao}\\mathcal{C}_{ao}}{\\sigma_{a}^{2} + r_{a}} d\n$$\n此表达式清楚地表明，只要背景跨域协方差 $\\mathcal{C}_{ao}$ 和局地化系数 $\\rho_{ao}$ 均不为零，大气观测（通过新息 $d$）就会对海洋状态产生非零的更新。\n\n### 计算\n\n最后，代入给定的数值：$\\sigma_{a}^{2} = 4$，$\\mathcal{C}_{ao} = 3$， $r_{a} = 1$，$\\rho_{ao} = \\frac{1}{2}$，且 $d = 2$。\n$$\n\\delta x_{o} = \\frac{(\\frac{1}{2})(3)}{4 + 1} \\times 2 = \\frac{1.5}{5} \\times 2 = 0.3 \\times 2 = 0.6\n$$\n题目要求答案四舍五入至三位有效数字，即 $0.600$。以开尔文为单位，海洋分析增量为 $0.600$ K。",
            "answer": "$$\n\\boxed{0.600}\n$$"
        },
        {
            "introduction": "从理想化的卡尔曼滤波器转向广泛应用的集合卡尔曼滤波器（EnKF），会引入采样误差等实际挑战。本题要求您从概念上分析“膨胀”（inflation）这一关键技术，它被用以维持集合离散度并防止滤波器发散。理解乘法膨胀与加法膨胀对跨域协方差的不同影响，对于设计稳定有效的耦合资料同化系统至关重要，这需要在物理一致性与数值稳定性之间取得平衡。",
            "id": "4028473",
            "problem": "考虑一个用于线性高斯耦合系统的耦合集合卡尔曼滤波（EnKF; Ensemble Kalman Filter），其大气-海洋状态向量为 $x=\\begin{bmatrix} x_{a} \\\\ x_{o} \\end{bmatrix}$，其中 $x_{a}\\in\\mathbb{R}^{n_{a}}$ 且 $x_{o}\\in\\mathbb{R}^{n_{o}}$。设有 $m$ 个集合成员，其异常矩阵为 $A=\\begin{bmatrix} A_{a} \\\\ A_{o} \\end{bmatrix}\\in\\mathbb{R}^{(n_{a}+n_{o})\\times m}$，该矩阵的列是与集合平均值的偏差。样本背景协方差为 $P=\\frac{1}{m-1}AA^{\\top}$，其分块为 $P_{aa}=\\frac{1}{m-1}A_{a}A_{a}^{\\top}$，$P_{oo}=\\frac{1}{m-1}A_{o}A_{o}^{\\top}$，以及跨域协方差 $P_{ao}=\\frac{1}{m-1}A_{a}A_{o}^{\\top}$（且 $P_{oa}=P_{ao}^{\\top}$）。假设观测算子只测量大气变量，$y=H_{a}x_{a}+\\epsilon$，其中 $H_{a}\\in\\mathbb{R}^{p\\times n_{a}}$，观测误差 $\\epsilon\\sim\\mathcal{N}(0,R)$，$R\\in\\mathbb{R}^{p\\times p}$ 为正定矩阵。EnKF分析使用卡尔曼增益 $K=P H^{\\top}(H P H^{\\top}+R)^{-1}$，其中 $H=\\begin{bmatrix} H_{a} & 0 \\end{bmatrix}$，因此大气到海洋的增益分块为 $K_{oa}=P_{oa}H_{a}^{\\top}\\left(H_{a}P_{aa}H_{a}^{\\top}+R\\right)^{-1}$。\n\n考虑两种标准的膨胀策略。乘性膨胀通过一个标量因子 $\\gamma>1$ 统一地重新缩放异常，即 $A\\leftarrow \\gamma A$。加性膨胀为每个集合成员添加独立的零均值高斯扰动，$x^{(i)}\\leftarrow x^{(i)}+\\eta^{(i)}$，其中 $\\eta^{(i)}\\sim\\mathcal{N}(0,Q_{\\text{add}})$ 且 $Q_{\\text{add}}=\\begin{bmatrix} Q_{a} & Q_{ao} \\\\ Q_{oa} & Q_{o} \\end{bmatrix}$ 是用户指定的。假设 $m$ 的大小适中，因此采样误差可能导致虚假的远程和跨域相关。\n\n根据上述基本定义，推断乘性膨胀和加性膨胀如何差异性地影响跨域协方差的大小以及耦合滤波器的稳定性。此处，我们所说的稳定性是指避免由离散度不足引起的发散并限制虚假跨域更新的放大的趋势。\n\n选择所有正确的陈述。\n\nA. 在对大气和海洋异常都应用因子为 $\\gamma>1$ 的均匀乘性膨胀下，样本跨域协方差 $P_{ao}$ 按 $\\gamma^{2}P_{ao}$ 比例缩放，而大气和海洋变量之间的相关系数保持不变。对于仅有大气观测的情况，海洋分析增益 $K_{oa}$ 的量值相对于无膨胀时（对于固定的 $R$）增加，这有助于减轻离散度不足，但也可能放大虚假的跨域更新。\n\nB. 如果使用独立的分块对角矩阵 $Q_{\\text{add}}=\\operatorname{diag}(Q_{a},Q_{o})$ 实施加性膨胀，那么期望的跨域协方差 $\\mathbb{E}[P_{ao}]$ 将增加一个与 $Q_{a}Q_{o}$ 成比例的项，且跨域相关系数会增加；这通常会通过过分加权跨域更新来破坏滤波器的稳定性。\n\nC. 使用独立的分块对角矩阵 $Q_{\\text{add}}=\\operatorname{diag}(Q_{a},Q_{o})$ 进行加性膨胀时，期望的跨域协方差 $\\mathbb{E}[P_{ao}]$ 保持不变，域内方差增加，因此跨域相关系数减小。对于仅有大气观测的情况，海洋增益 $K_{oa}$ 的量值相对于无膨胀时减小，这可以减少虚假的跨域增量，但可能减慢物理耦合的启动（spin-up）过程。\n\nD. 仅对快变的大气应用乘性膨胀（对 $A_{a}$ 应用因子 $\\gamma_{a}>1$），且仅对慢变的海洋应用加性独立膨胀（对 $x_{o}$ 应用分块对角的 $Q_{o}$），倾向于在期望上减小 $P_{ao}$ 的量值，从而通过减弱跨域更新来提高稳定性。\n\nE. 如果加性膨胀噪声被指定为具有非零的跨域分块 $Q_{ao}\\neq 0$，那么 $\\mathbb{E}[P_{ao}]$ 会增加 $Q_{ao}$，从而直接印刻所施加的耦合结构。当模型对物理耦合的表征不足时，这可以提高稳定性，但如果 $Q_{ao}$ 指定不当，则存在不稳定的风险，因为它会系统性地偏置跨域更新。",
            "solution": "为了确定正确的陈述，我们分别分析乘性膨胀和加性膨胀对耦合系统的背景误差协方差 $P$、相关系数 $\\rho$ 以及大气-海洋增益 $K_{oa}$ 的影响。\n\n**乘性膨胀分析**\n\n在均匀乘性膨胀下，异常矩阵 $A$ 被替换为 $A' = \\gamma A$（其中 $\\gamma > 1$）。新的背景协方差 $P'$ 变为：\n$$ P' = \\frac{1}{m-1}A'(A')^{\\top} = \\frac{1}{m-1}(\\gamma A)(\\gamma A)^{\\top} = \\gamma^2 \\frac{1}{m-1}AA^{\\top} = \\gamma^2 P $$\n这意味着协方差矩阵的每个分块都被 $\\gamma^2$ 缩放：$P'_{aa} = \\gamma^2 P_{aa}$，$P'_{oo} = \\gamma^2 P_{oo}$，以及 $P'_{ao} = \\gamma^2 P_{ao}$。\n新的相关系数 $\\rho'_{ij}$ 为：\n$$ \\rho'_{ij} = \\frac{(P'_{ao})_{ij}}{\\sqrt{(P'_{aa})_{ii}(P'_{oo})_{jj}}} = \\frac{\\gamma^2 (P_{ao})_{ij}}{\\sqrt{\\gamma^2 (P_{aa})_{ii} \\cdot \\gamma^2 (P_{oo})_{jj}}} = \\frac{\\gamma^2 (P_{ao})_{ij}}{\\gamma^2 \\sqrt{(P_{aa})_{ii}(P_{oo})_{jj}}} = \\rho_{ij} $$\n因此，均匀乘性膨胀不改变相关系数。新的海洋增益分块 $K'_{oa}$ 为：\n$$ K'_{oa} = P'_{oa}H_{a}^{\\top}\\left(H_{a}P'_{aa}H_{a}^{\\top}+R\\right)^{-1} = \\gamma^2 P_{oa}H_{a}^{\\top}\\left(\\gamma^2 H_{a}P_{aa}H_{a}^{\\top}+R\\right)^{-1} $$\n由于 $\\gamma > 1$，与原始增益 $K_{oa}$ 相比，新增益 $K'_{oa}$ 的量值增加。这会产生更大的分析增量，有助于对抗集合离散度不足，但同时也有放大虚假跨域相关的风险。因此，**陈述A是正确的。**\n\n**加性膨胀分析**\n\n在加性膨胀下，新的样本协方差矩阵 $P'$ 关于随机扰动 $\\eta$ 的期望为 $\\mathbb{E}[P'] = P + Q_{\\text{add}}$。其分块形式为：\n$\\mathbb{E}[P'_{aa}] = P_{aa} + Q_{a}$，$\\mathbb{E}[P'_{oo}] = P_{oo} + Q_{o}$，$\\mathbb{E}[P'_{ao}] = P_{ao} + Q_{ao}$。\n\n**分析各个选项：**\n\n*   **B.** 如果加性膨胀使用分块对角矩阵 $Q_{\\text{add}}=\\operatorname{diag}(Q_{a},Q_{o})$，则 $Q_{ao}=0$。因此，$\\mathbb{E}[P'_{ao}] = P_{ao} + 0 = P_{ao}$，即期望的跨域协方差保持不变，而不是增加。该陈述不正确。\n\n*   **C.** 使用分块对角矩阵 $Q_{\\text{add}}=\\operatorname{diag}(Q_{a},Q_{o})$ 时，如上所述，$\\mathbb{E}[P'_{ao}]$ 保持不变。然而，域内方差 $P_{aa}$ 和 $P_{oo}$ 在期望上增加（$\\mathbb{E}[P'_{aa}] > P_{aa}$，$\\mathbb{E}[P'_{oo}] > P_{oo}$）。因此，跨域相关系数的期望量值（其分子不变，分母增大）会减小。新的海洋增益 $K'_{oa}$ 的分母中的项 $H_{a}P'_{aa}H_{a}^{\\top}$ 在期望上增加，导致整个增益的量值减小。这会削弱跨域更新，既能减少虚假更新，也可能减弱物理耦合信号的传递。因此，**陈述C是正确的。**\n\n*   **D.** 对于混合膨胀方案，大气异常变为 $\\gamma_a A_a$，海洋异常变为包含加性噪声的新异常。跨域协方差的期望为 $\\mathbb{E}[P''_{ao}] = \\gamma_a P_{ao}$。由于 $\\gamma_a > 1$，跨域协方差的期望量值*增加*，而不是减小。因此，该陈述不正确。\n\n*   **E.** 如果加性噪声协方差 $Q_{\\text{add}}$ 包含非零的跨域分块 $Q_{ao}$，那么期望的跨域协方差变为 $\\mathbb{E}[P'_{ao}] = P_{ao} + Q_{ao}$。这直接将用户定义的协方差结构 $Q_{ao}$ “植入”到集合中。如果模型的物理耦合不足（导致 $P_{ao}$ 偏小），一个精心选择的 $Q_{ao}$ 可以对此进行补偿，从而改善分析。反之，一个不合适的 $Q_{ao}$ 会系统性地引入错误的跨域更新，可能导致滤波器不稳定。因此，**陈述E是正确的。**",
            "answer": "$$\\boxed{ACE}$$"
        },
        {
            "introduction": "我们如何严格地证明耦合资料同化的价值？本实践将指导您设计一个数值实验，以分离并量化由另一领域（大气）的观测给一个领域（海洋）带来的技巧改进。通过推导和实施方差减小的度量标准，您将连接理论与实践，学习一种用于验证耦合资料同化系统性能的基本方法。",
            "id": "4028482",
            "problem": "在一个简化的耦合资料同化设置中，设计并实现一个验证性实验，通过开关（toggling）跨域协方差并计算差异度量，来隔离和量化大气观测对海洋分析质量的贡献。\n\n考虑一个线性的、瞬时的、双分量状态向量 $x = [x_{\\mathrm{a}}, x_{\\mathrm{o}}]^{\\top}$，它代表一个大气标量 $x_{\\mathrm{a}}$ 和一个海洋标量 $x_{\\mathrm{o}}$。假设一个高斯背景（先验）分布 $x \\sim \\mathcal{N}(\\mu_{\\mathrm{b}}, B)$，其背景协方差矩阵为\n$$\nB = \\begin{bmatrix}\nB_{\\mathrm{aa}} & B_{\\mathrm{ao}} \\\\\nB_{\\mathrm{oa}} & B_{\\mathrm{oo}}\n\\end{bmatrix}, \\quad B_{\\mathrm{oa}} = B_{\\mathrm{ao}},\n$$\n其中 $B_{\\mathrm{aa}}$ 和 $B_{\\mathrm{oo}}$ 分别是大气和海洋的背景方差，而 $B_{\\mathrm{ao}}$ 是捕捉跨域相关的跨域协方差。将跨域协方差参数化为 $B_{\\mathrm{ao}} = \\rho \\sqrt{B_{\\mathrm{aa}} B_{\\mathrm{oo}}}$，其中相关系数 $\\rho \\in (-1, 1)$。\n\n假设存在一个单一的大气观测 $y$，其线性观测算子为 $H = [1, 0]$，观测误差模型为 $y = H x + \\varepsilon$，其中 $\\varepsilon \\sim \\mathcal{N}(0, R)$，$R$ 是观测误差方差。在线性高斯假设下，Kalman 分析（后验）协方差由下式给出\n$$\nP_{\\mathrm{a}} = (I - K H) B, \\quad K = B H^{\\top} (H B H^{\\top} + R)^{-1},\n$$\n其中 $I$ 是单位矩阵，$K$ 是 Kalman 增益。\n\n您的任务是编写一个程序，针对每个测试用例，计算两个标量度量，以在只同化大气观测时，隔离跨域协方差对海洋分析质量的影响：\n\n1. 完全由跨域耦合引起的海洋分析方差的绝对减小量，定义为\n$$\n\\Delta_{\\mathrm{var}} = P_{\\mathrm{oo}}^{\\mathrm{decoupled}} - P_{\\mathrm{oo}}^{\\mathrm{coupled}},\n$$\n其中，$P_{\\mathrm{oo}}^{\\mathrm{coupled}}$ 是当 $B_{\\mathrm{ao}}$ 设置为参数化的非零值时的分析协方差的海洋分量，而 $P_{\\mathrm{oo}}^{\\mathrm{decoupled}}$ 是在保持 $B_{\\mathrm{aa}}$、$B_{\\mathrm{oo}}$ 和 $R$ 不变的情况下，关闭（设置为 $0$）跨域协方差时的海洋分量。\n\n2. 由耦合引起的海洋分析方差的相对减小量（无量纲分数），定义为\n$$\n\\delta_{\\mathrm{rel}} = \\frac{\\Delta_{\\mathrm{var}}}{B_{\\mathrm{oo}}}.\n$$\n\n您的推导和算法应基于线性高斯估计和 Kalman 滤波器协方差更新的基本原理，即上述定义以及对于联合高斯变量，条件作用会沿着观测方向按协方差比例减小方差这一事实。\n\n使用指定的参数值实现以下测试套件：\n- 测试用例 1：$B_{\\mathrm{aa}} = 1.0$, $B_{\\mathrm{oo}} = 1.0$, $\\rho = 0.5$, $R = 0.25$。\n- 测试用例 2：$B_{\\mathrm{aa}} = 1.0$, $B_{\\mathrm{oo}} = 1.0$, $\\rho = 0.0$, $R = 0.25$。\n- 测试用例 3：$B_{\\mathrm{aa}} = 1.0$, $B_{\\mathrm{oo}} = 2.0$, $\\rho = 0.7$, $R = 1000000.0$。\n- 测试用例 4：$B_{\\mathrm{aa}} = 4.0$, $B_{\\mathrm{oo}} = 0.25$, $\\rho = 0.9$, $R = 0.01$。\n- 测试用例 5：$B_{\\mathrm{aa}} = 0.01$, $B_{\\mathrm{oo}} = 1.0$, $\\rho = 0.8$, $R = 1.0$。\n- 测试用例 6：$B_{\\mathrm{aa}} = 2.0$, $B_{\\mathrm{oo}} = 3.0$, $\\rho = -0.7$, $R = 0.5$。\n\n对每个测试用例，计算并报告浮点数对 $[\\Delta_{\\mathrm{var}}, \\delta_{\\mathrm{rel}}]$。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，$[ [\\Delta_{\\mathrm{var}}^{(1)}, \\delta_{\\mathrm{rel}}^{(1)}], [\\Delta_{\\mathrm{var}}^{(2)}, \\delta_{\\mathrm{rel}}^{(2)}], \\dots ]$）。无需物理单位，因为所有量都是任意但一致单位下的方差和无量纲比率。不涉及角度。不要将任何量表示为百分比；将 $\\delta_{\\mathrm{rel}}$ 表示为小数。",
            "solution": "为了量化跨域协方差对海洋分析质量的影响，我们首先需要推导出海洋分析方差的解析表达式。根据高斯条件分布的性质，在给定大气观测的情况下，海洋状态的后验（分析）方差为：\n$$\nP_{\\mathrm{oo}}^{\\mathrm{analysis}} = B_{\\mathrm{oo}} - \\frac{B_{\\mathrm{oa}} B_{\\mathrm{ao}}}{B_{\\mathrm{aa}} + R}\n$$\n由于 $B_{\\mathrm{oa}} = B_{\\mathrm{ao}}$，该表达式可简化为：\n$$\nP_{\\mathrm{oo}}^{\\mathrm{analysis}} = B_{\\mathrm{oo}} - \\frac{B_{\\mathrm{ao}}^2}{B_{\\mathrm{aa}} + R}\n$$\n这个公式是推导所有度量的基础。\n\n**1. 推导海洋分析方差**\n\n对于**耦合**情况，我们使用参数化的跨域协方差 $B_{\\mathrm{ao}} = \\rho \\sqrt{B_{\\mathrm{aa}} B_{\\mathrm{oo}}}$。其平方为 $B_{\\mathrm{ao}}^2 = \\rho^2 B_{\\mathrm{aa}} B_{\\mathrm{oo}}$。代入上述公式，得到耦合的海洋分析方差：\n$$\nP_{\\mathrm{oo}}^{\\mathrm{coupled}} = B_{\\mathrm{oo}} - \\frac{\\rho^2 B_{\\mathrm{aa}} B_{\\mathrm{oo}}}{B_{\\mathrm{aa}} + R}\n$$\n对于**非耦合**情况，我们关闭跨域协方差，即设置 $\\rho = 0$，这意味着 $B_{\\mathrm{ao}} = 0$。得到的海洋分析方差为：\n$$\nP_{\\mathrm{oo}}^{\\mathrm{decoupled}} = B_{\\mathrm{oo}} - \\frac{0^2}{B_{\\mathrm{aa}} + R} = B_{\\mathrm{oo}}\n$$\n这个结果是符合直觉的：如果背景场中的大气和海洋不相关，那么对大气的观测不会更新海洋状态，其方差保持为背景值。\n\n**2. 推导所需度量**\n\n现在我们可以计算所需的两个度量。\n\n*   **绝对方差减小量** $\\Delta_{\\mathrm{var}}$：\n    $$\n    \\Delta_{\\mathrm{var}} = P_{\\mathrm{oo}}^{\\mathrm{decoupled}} - P_{\\mathrm{oo}}^{\\mathrm{coupled}} = B_{\\mathrm{oo}} - \\left(B_{\\mathrm{oo}} - \\frac{\\rho^2 B_{\\mathrm{aa}} B_{\\mathrm{oo}}}{B_{\\mathrm{aa}} + R}\\right)\n    $$\n    $$\n    \\Delta_{\\mathrm{var}} = \\frac{\\rho^2 B_{\\mathrm{aa}} B_{\\mathrm{oo}}}{B_{\\mathrm{aa}} + R}\n    $$\n    该值量化了由于大气观测的信息通过跨域相关性 $\\rho$ 传递而导致的海洋不确定性（方差）的减少量。\n\n*   **相对方差减小量** $\\delta_{\\mathrm{rel}}$：\n    $$\n    \\delta_{\\mathrm{rel}} = \\frac{\\Delta_{\\mathrm{var}}}{B_{\\mathrm{oo}}} = \\frac{1}{B_{\\mathrm{oo}}} \\left(\\frac{\\rho^2 B_{\\mathrm{aa}} B_{\\mathrm{oo}}}{B_{\\mathrm{aa}} + R}\\right)\n    $$\n    $$\n    \\delta_{\\mathrm{rel}} = \\frac{\\rho^2 B_{\\mathrm{aa}}}{B_{\\mathrm{aa}} + R}\n    $$\n    这个无量纲度量表示海洋方差的减小比例。值得注意的是，该比例等于被观测的大气变量本身方差减小的比例 $\\frac{B_{aa}}{B_{aa}+R}$ 与相关系数平方 $\\rho^2$ 的乘积。\n\n**3. 算法实现**\n\n算法将直接应用这两个推导出的公式到每个测试用例中，计算并输出结果。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes metrics for a coupled data assimilation experiment.\n\n    For each test case, the function calculates the absolute and relative \n    reduction in ocean analysis variance due to cross-domain correlations \n    when assimilating only atmospheric observations.\n    \"\"\"\n\n    test_cases = [\n        # (B_aa, B_oo, rho, R)\n        (1.0, 1.0, 0.5, 0.25),\n        (1.0, 1.0, 0.0, 0.25),\n        (1.0, 2.0, 0.7, 1000000.0),\n        (4.0, 0.25, 0.9, 0.01),\n        (0.01, 1.0, 0.8, 1.0),\n        (2.0, 3.0, -0.7, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        B_aa, B_oo, rho, R = case\n\n        # Derived formula for the absolute reduction in ocean analysis variance\n        # delta_var = (rho^2 * B_aa * B_oo) / (B_aa + R)\n        delta_var = (rho**2 * B_aa * B_oo) / (B_aa + R)\n\n        # Derived formula for the relative reduction in ocean analysis variance\n        # delta_rel = delta_var / B_oo  or  (rho^2 * B_aa) / (B_aa + R)\n        if B_oo == 0:\n            # Handle the case where B_oo is zero, though not in test cases.\n            # In this scenario, variance is already zero, so relative reduction is ill-defined.\n            # We can define it as 0 as there's no variance to reduce.\n            delta_rel = 0.0\n        else:\n            delta_rel = delta_var / B_oo\n\n        results.append([delta_var, delta_rel])\n\n    # Format the final output string exactly as required.\n    # e.g., [[val1, val2], [val3, val4], ...]\n    # The map(str, ...) correctly converts each inner list to its string representation.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}