{
    "hands_on_practices": [
        {
            "introduction": "集合卡尔曼滤波器的一个核心挑战是有限集合大小导致的虚假远距离相关。协方差局地化通过逐元素乘以一个距离衰减函数来抑制这些虚假相关，是解决此问题的关键技术。本练习将引导你推导局地化的卡尔曼增益，并定量分析它如何在一个一维网格上重塑分析增量，从而加深对局地化如何精确地将观测信息约束在物理相关尺度内的理解。",
            "id": "4036640",
            "problem": "考虑一个用于数值天气预报的一维离散化状态，其网格点由 $i \\in \\{1,2,3,4,5\\}$ 索引，位于位置 $x_i = i - 3$，因此物理位置为 $x_1=-2$、$x_2=-1$、$x_3=0$、$x_4=1$ 和 $x_5=2$。设先验（预报）状态由集合卡尔曼滤波（EnKF）的大集合极限表示，因此预报误差协方差可以由一个参数化的、均匀的、各向同性的核 $P^{f}$ 精确给出，其元素为\n$$\nP^{f}_{ij} = \\sigma^{2} \\exp\\!\\left(-\\frac{|x_i - x_j|}{a}\\right),\n$$\n其中 $\\sigma^{2}>0$ 是先验方差尺度，而 $a>0$ 是相关长度尺度。设观测值通过一个已知算子 $H$ 与状态呈线性关系，并受到协方差为 $R$ 的零均值高斯噪声的污染。贝叶斯线性分析寻求最小化均方分析误差的最佳线性估计量，其集合卡尔曼滤波对应方法则采用协方差局地化来减少采样误差和虚假的远程相关性。协方差局地化是通过将预报协方差与一个锥化矩阵 $C$ 进行逐元素（舒尔）乘积来实现的，该矩阵的元素由一个正定的、紧支撑或快速衰减的距离相关函数给出。具体来说，将局地化预报协方差 $\\tilde{P}^{f}$ 定义为\n$$\n\\tilde{P}^{f} = C \\circ P^{f},\n$$\n其中 $\\circ$ 表示逐元素乘法，在本问题中，$C$ 被取为一个高斯锥化函数，其元素为\n$$\nC_{ij} = \\exp\\!\\left(-\\left(\\frac{|x_i - x_j|}{\\ell}\\right)^{2}\\right),\n$$\n其中局地化长度尺度 $\\ell>0$。假设一个单一的标量观测，测量中心网格点的状态，因此 $H$ 选择 $x_3=0$ 处的分量。先验方差尺度为 $\\sigma^{2}=1$，相关长度为 $a=1$，局地化长度为 $\\ell=\\frac{3}{2}$，观测误差方差为 $R=\\frac{1}{3}$。给定的标量新息为 $d = y - H x^{f} = \\frac{1}{2}$。\n\n任务：\n- 仅从贝叶斯线性估计量的定义和线性分析更新的均方最优性出发，并使用上述舒尔积的局地化方法，推导局地化分析增益关于 $\\tilde{P}^{f}$、$H$ 和 $R$ 的表达式。\n- 使用您推导的表达式，分析协方差局地化如何影响这个一维网格上分析增量的空间结构，然后计算网格点 $x_2=-1$ 处的分析增量，作为一个单一的封闭形式解析表达式。以精确形式表达最终答案；不要进行四舍五入或数值近似。最终表达式中不需要物理单位。",
            "solution": "该问题被评估为有效，因为它科学地基于数据同化原理，数学上是良态的，提供了所有必要信息，并以客观、正式的语言陈述。我们开始解答。\n\n该问题要求完成两项主要任务：首先，推导局地化卡尔曼增益的表达式；其次，计算特定网格点上的分析增量。\n\n**第1部分：局地化分析增益的推导**\n\n最优线性估计量，即分析状态 $x^a$，是使用观测值 $y$ 对预报状态 $x^f$ 进行的线性更新。它由下式给出：\n$$x^a = x^f + K(y - Hx^f)$$\n其中 $K$ 是分析增益矩阵。项 $d = y - Hx^f$ 是新息。选择增益 $K$ 是为了最小化均方分析误差，即分析误差协方差矩阵 $P^a = \\mathbb{E}[(x^a - x_{true})(x^a - x_{true})^T]$ 的迹。\n\n分析误差 $e^a = x^a - x_{true}$ 可以用预报误差 $e^f = x^f - x_{true}$ 和观测误差 $v$ 来表示，其中 $y = Hx_{true} + v$。\n$$e^a = (x^f + K(y - Hx^f)) - x_{true}$$\n$$e^a = (x^f - x_{true}) + K(Hx_{true} + v - Hx^f)$$\n$$e^a = e^f - K(H(x^f - x_{true}) - v) = e^f - K(He^f - v)$$\n$$e^a = (I - KH)e^f + Kv$$\n分析误差协方差 $P^a$ 则为：\n$$P^a = \\mathbb{E}[((I - KH)e^f + Kv)((I - KH)e^f + Kv)^T]$$\n假设预报误差和观测误差不相关，即 $\\mathbb{E}[e^f v^T] = 0$，表达式得以简化。设 $P^f = \\mathbb{E}[e^f(e^f)^T]$ 为预报误差协方差，$R = \\mathbb{E}[vv^T]$ 为观测误差协方差。\n$$P^a = (I - KH)\\mathbb{E}[e^f(e^f)^T](I - KH)^T + K\\mathbb{E}[vv^T]K^T$$\n$$P^a = (I - KH)P^f(I - KH)^T + KRK^T$$\n为了找到最小化均方误差 $\\text{tr}(P^a)$ 的最优增益 $K$，我们将 $\\text{tr}(P^a)$ 对 $K$ 求导并令结果为零。\n$$\\frac{\\partial}{\\partial K} \\text{tr}(P^a) = \\frac{\\partial}{\\partial K} \\text{tr}\\left(P^f - KHP^f - P^fH^TK^T + KHP^fH^TK^T + KRK^T\\right) = 0$$\n使用标准的矩阵求导恒等式，以及 $P^f$ 和 $R$ 是对称矩阵的事实，可得：\n$$-2P^fH^T + 2K(HP^fH^T + R) = 0$$\n求解 $K$，我们得到标准的卡尔曼增益公式：\n$$K = P^fH^T(HP^fH^T + R)^{-1}$$\n问题陈述应用了协方差局地化。这意味着预报误差协方差 $P^f$ 被局地化预报误差协方差 $\\tilde{P}^f = C \\circ P^f$ 所取代，其中 $\\circ$ 是舒尔（逐元素）乘积。因此，我们将局地化分析增益记为 $\\tilde{K}$，通过将 $\\tilde{P}^f$ 代入增益公式得到：\n$$\\tilde{K} = \\tilde{P}^f H^T (H \\tilde{P}^f H^T + R)^{-1}$$\n这就是推导出的局地化分析增益的表达式。\n\n**第2部分：分析增量的分析与计算**\n\n分析增量 $\\delta x^a$ 是应用于预报状态的修正量：\n$$\\delta x^a = x^a - x^f = \\tilde{K}d$$\n其中 $d$ 是给定的标量新息 $d = \\frac{1}{2}$。\n\n状态向量是 5 维的，对应于 $i \\in \\{1, 2, 3, 4, 5\\}$ 的网格点 $x_i$。观测是在中心网格点 $x_3=0$ 处的单个标量测量。这意味着观测算子 $H$ 是一个 $1 \\times 5$ 的行向量：\n$$H = \\begin{pmatrix} 0 & 0 & 1 & 0 & 0 \\end{pmatrix}$$\n因此，$H^T$ 是一个 $5 \\times 1$ 的列向量，它选择其右乘矩阵的第三列。项 $H \\tilde{P}^f H^T$ 变为标量元素 $\\tilde{P}^f_{33}$。项 $\\tilde{P}^f H^T$ 变为 $\\tilde{P}^f$ 的第三列。增益 $\\tilde{K}$ 是一个 $5 \\times 1$ 的列向量：\n$$\\tilde{K} = \\frac{1}{\\tilde{P}^f_{33} + R} \\begin{pmatrix} \\tilde{P}^f_{13} \\\\ \\tilde{P}^f_{23} \\\\ \\tilde{P}^f_{33} \\\\ \\tilde{P}^f_{43} \\\\ \\tilde{P}^f_{53} \\end{pmatrix}$$\n分析增量向量为 $\\delta x^a = \\tilde{K}d$。在网格点 $x_i$ 处的增量分量是 $(\\delta x^a)_i = \\tilde{K}_i d$。\n\n局地化的作用是调节分析增量。若没有局地化，网格点 $i$ 处的增量将与点 $i$ 和点 $3$ 之间的预报误差协方差成正比，即 $P^f_{i3}$。经过局地化后，增量与 $\\tilde{P}^f_{i3} = C_{i3}P^f_{i3}$ 成正比。锥化函数 $C_{ij} = \\exp\\left(-\\left(\\frac{|x_i - x_j|}{\\ell}\\right)^{2}\\right)$（高斯函数）随距离的衰减速度远快于原始协方差函数 $P^f_{ij} = \\exp\\left(-\\frac{|x_i - x_j|}{a}\\right)$（指数函数）。这抑制了观测值对远离观测位置的网格点的影响，这在物理上是合理的，并有助于滤除基于集合的协方差估计中存在的虚假远程相关性。\n\n我们被要求计算在网格点 $x_2 = -1$ 处的分析增量，即向量 $\\delta x^a$ 的第二个分量：\n$$(\\delta x^a)_2 = \\tilde{K}_2 d = \\frac{\\tilde{P}^f_{23}}{\\tilde{P}^f_{33} + R} d$$\n我们现在必须计算 $\\tilde{P}^f_{23}$ 和 $\\tilde{P}^f_{33}$ 的值。网格点位置为 $x_1=-2$, $x_2=-1$, $x_3=0$, $x_4=1$, $x_5=2$。参数为 $\\sigma^2=1$, $a=1$, $\\ell=\\frac{3}{2}$, $R=\\frac{1}{3}$ 和 $d=\\frac{1}{2}$。\n\n局地化协方差元素为 $\\tilde{P}^f_{ij} = P^f_{ij} C_{ij}$。\n预报协方差元素为 $P^f_{ij} = \\sigma^2 \\exp\\left(-\\frac{|x_i-x_j|}{a}\\right) = 1 \\cdot \\exp(-|x_i-x_j|)$。\n锥化矩阵元素为 $C_{ij} = \\exp\\left(-\\left(\\frac{|x_i-x_j|}{\\ell}\\right)^2\\right) = \\exp\\left(-\\left(\\frac{|x_i-x_j|}{3/2}\\right)^2\\right) = \\exp\\left(-\\frac{4(x_i-x_j)^2}{9}\\right)$。\n\n首先，我们计算 $\\tilde{P}^f_{33}$：\n距离为 $|x_3 - x_3| = 0$。\n$P^f_{33} = \\exp(-0) = 1$。\n$C_{33} = \\exp(0) = 1$。\n$\\tilde{P}^f_{33} = P^f_{33} C_{33} = 1 \\times 1 = 1$。\n\n接下来，我们计算 $\\tilde{P}^f_{23}$：\n距离为 $|x_2 - x_3| = |-1 - 0| = 1$。\n$P^f_{23} = \\exp(-1)$。\n$C_{23} = \\exp\\left(-\\frac{4(1)^2}{9}\\right) = \\exp\\left(-\\frac{4}{9}\\right)$。\n$\\tilde{P}^f_{23} = P^f_{23} C_{23} = \\exp(-1) \\exp\\left(-\\frac{4}{9}\\right) = \\exp\\left(-1 - \\frac{4}{9}\\right) = \\exp\\left(-\\frac{13}{9}\\right)$。\n\n现在，我们将这些值代入 $(\\delta x^a)_2$ 的表达式中：\n$$(\\delta x^a)_2 = \\frac{\\exp\\left(-\\frac{13}{9}\\right)}{1 + \\frac{1}{3}} \\times \\frac{1}{2}$$\n$$(\\delta x^a)_2 = \\frac{\\exp\\left(-\\frac{13}{9}\\right)}{\\frac{4}{3}} \\times \\frac{1}{2}$$\n$$(\\delta x^a)_2 = \\frac{3}{4}\\exp\\left(-\\frac{13}{9}\\right) \\times \\frac{1}{2}$$\n$$(\\delta x^a)_2 = \\frac{3}{8}\\exp\\left(-\\frac{13}{9}\\right)$$\n这就是在 $x_2=-1$ 处分析增量的最终封闭形式表达式。",
            "answer": "$$\\boxed{\\frac{3}{8}\\exp\\left(-\\frac{13}{9}\\right)}$$"
        },
        {
            "introduction": "除了虚假相关，由于模型误差和采样不足，集合卡尔曼滤波器还普遍存在背景误差协方差估计偏低的问题，这可能导致滤波器发散。协方差膨胀通过按比例增加集合离差来弥补这一缺陷，是确保滤波器性能稳定的重要手段。此练习将指导你基于新息统计量，运用最大似然估计方法推导出一个标量膨胀因子的估计器，这为你提供了一种自适应调整滤波器的实用工具。",
            "id": "4036703",
            "problem": "考虑一个一维观测流，它在数值天气预报系统中的一个固定格点上被集合卡尔曼滤波 (EnKF) 同化。设线性观测算子为 $H=1$，并假设在每个同化周期，背景（先验）集合预报的观测异常具有已知的方差 $s>0$。观测误差是零均值高斯分布，其方差为已知的 $r>0$，且在各个周期之间独立，并与背景误差无关。一个标量乘性膨胀因子 $\\lambda>0$ 被应用于背景误差协方差，使得观测空间中的先验方差变为 $\\lambda s$。\n\n在 $k=1,\\dots,N$ 个同化周期，定义新息为 $v_k=y_k - H x_k^{f}$，其中 $y_k$ 是观测值，$x_k^{f}$ 是映射到观测空间的背景预报。在所述假设下，$v_k$ 是独立的，服从均值为 $0$、方差为 $\\lambda s + r$ 的高斯分布。\n\n仅使用关于高斯概率密度和新息独立性的基本事实，基于样本 $\\{v_k\\}_{k=1}^{N}$ 推导标量膨胀因子 $\\lambda$ 的最大似然估计 (MLE)。你的最终答案必须是关于 $N$、$s$、$r$ 和 $\\sum_{k=1}^{N} v_k^{2}$ 的单个闭式解析表达式。如果你施加物理约束 $\\lambda \\ge 0$，请将其明确地包含在你的表达式中。无需进行数值计算。",
            "solution": "用户希望推导标量膨胀参数 $\\lambda$ 的最大似然估计 (MLE)。\n\n### 第1步：问题验证\n\n问题陈述提供了以下已知条件：\n- 一个由集合卡尔曼滤波 (EnKF) 同化的一维观测流。\n- 线性观测算子 $H=1$。\n- 背景集合预报的观测异常方差为 $s$，且 $s>0$。\n- 观测误差是零均值高斯分布，其方差为 $r$，且 $r>0$。\n- 误差在各个同化周期之间独立，并与背景误差无关。\n- 一个标量乘性膨胀因子 $\\lambda > 0$ 被应用于背景误差协方差。\n- 观测空间中的先验方差为 $\\lambda s$。\n- 一系列 $N$ 个新息 $\\{v_k\\}_{k=1}^{N}$，其中 $v_k = y_k - H x_k^{f}$。\n- 新息 $v_k$ 是独立同分布 (i.i.d.) 的高斯随机变量，其均值为 $0$，方差为 $\\lambda s + r$。\n- 目标是基于样本 $\\{v_k\\}_{k=1}^{N}$，在物理约束 $\\lambda \\ge 0$ 的条件下，找到 $\\lambda$ 的最大似然估计 (MLE)。最终表达式应以 $N$、$s$、$r$ 和平方新息之和 $\\sum_{k=1}^{N} v_k^{2}$ 的形式给出。\n\n该问题是一个标准的、适定的统计估计问题，其基础是数据同化和集合卡尔曼滤波的既定理论。所有必要的信息都已提供，假设是内部一致的，术语是精确和客观的。因此，该问题在科学上是有效的。\n\n### 第2步：最大似然估计的推导\n\n解是使用最大似然法推导出来的。核心思想是找到参数 $\\lambda$ 的值，使得观测到给定新息样本 $\\{v_k\\}_{k=1}^{N}$ 的概率最大。\n\n问题陈述指出，每个新息 $v_k$ 都来自均值为 $\\mu=0$、方差为 $\\sigma^2 = \\lambda s + r$ 的高斯分布。单个新息 $v_k$ 的概率密度函数 (PDF) 为：\n$$\nf(v_k | \\lambda) = \\frac{1}{\\sqrt{2\\pi(\\lambda s + r)}} \\exp\\left(-\\frac{v_k^2}{2(\\lambda s + r)}\\right)\n$$\n由于新息 $\\{v_k\\}_{k=1}^{N}$ 是独立的，整个样本的联合概率密度函数是个体概率密度函数的乘积。这个联合概率密度函数，当被看作是参数 $\\lambda$ 的函数时，就是似然函数 $L(\\lambda)$。\n$$\nL(\\lambda) = \\prod_{k=1}^{N} f(v_k | \\lambda) = \\prod_{k=1}^{N} \\frac{1}{\\sqrt{2\\pi(\\lambda s + r)}} \\exp\\left(-\\frac{v_k^2}{2(\\lambda s + r)}\\right)\n$$\n这可以简化为：\n$$\nL(\\lambda) = \\left(2\\pi(\\lambda s + r)\\right)^{-\\frac{N}{2}} \\exp\\left(-\\frac{1}{2(\\lambda s + r)} \\sum_{k=1}^{N} v_k^2\\right)\n$$\n最大化似然函数 $L(\\lambda)$ 等同于最大化其自然对数，即对数似然函数 $\\ell(\\lambda) = \\ln(L(\\lambda))$，后者在数学上更易于处理。\n$$\n\\ell(\\lambda) = \\ln\\left[\\left(2\\pi(\\lambda s + r)\\right)^{-\\frac{N}{2}}\\right] + \\ln\\left[\\exp\\left(-\\frac{\\sum_{k=1}^{N} v_k^2}{2(\\lambda s + r)}\\right)\\right]\n$$\n$$\n\\ell(\\lambda) = -\\frac{N}{2} \\ln(2\\pi) - \\frac{N}{2} \\ln(\\lambda s + r) - \\frac{\\sum_{k=1}^{N} v_k^2}{2(\\lambda s + r)}\n$$\n为了找到使 $\\ell(\\lambda)$ 最大化的 $\\lambda$ 值，我们首先通过对 $\\ell(\\lambda)$ 关于 $\\lambda$ 求导并令其为零来找到临界点。\n$$\n\\frac{d\\ell}{d\\lambda} = \\frac{d}{d\\lambda}\\left[-\\frac{N}{2} \\ln(2\\pi) - \\frac{N}{2} \\ln(\\lambda s + r) - \\frac{\\sum_{k=1}^{N} v_k^2}{2(\\lambda s + r)}\\right]\n$$\n第一项的导数为 $0$。对第二项和第三项应用链式法则得到：\n$$\n\\frac{d\\ell}{d\\lambda} = 0 - \\frac{N}{2} \\cdot \\frac{1}{\\lambda s + r} \\cdot s - \\frac{\\sum_{k=1}^{N} v_k^2}{2} \\cdot (-1) \\cdot (\\lambda s + r)^{-2} \\cdot s\n$$\n$$\n\\frac{d\\ell}{d\\lambda} = -\\frac{Ns}{2(\\lambda s + r)} + \\frac{s \\sum_{k=1}^{N} v_k^2}{2(\\lambda s + r)^2}\n$$\n将导数设为零以找到无约束估计量，我们将其记为 $\\hat{\\lambda}_{\\text{unc}}$：\n$$\n-\\frac{Ns}{2(\\hat{\\lambda}_{\\text{unc}} s + r)} + \\frac{s \\sum_{k=1}^{N} v_k^2}{2(\\hat{\\lambda}_{\\text{unc}} s + r)^2} = 0\n$$\n因为 $s>0$ 且方差 $\\lambda s + r > 0$，我们可以简化该方程：\n$$\n\\frac{s \\sum_{k=1}^{N} v_k^2}{2(\\hat{\\lambda}_{\\text{unc}} s + r)^2} = \\frac{Ns}{2(\\hat{\\lambda}_{\\text{unc}} s + r)}\n$$\n两边同乘以 $2(\\hat{\\lambda}_{\\text{unc}} s + r)^2$ 并除以 $s$ 得到：\n$$\n\\sum_{k=1}^{N} v_k^2 = N(\\hat{\\lambda}_{\\text{unc}} s + r)\n$$\n这个结果直观地表明，最大似然估计将新息的理论方差等同于它们的样本方差 $\\frac{1}{N}\\sum_{k=1}^{N}v_k^2$。现在，我们求解 $\\hat{\\lambda}_{\\text{unc}}$：\n$$\n\\hat{\\lambda}_{\\text{unc}} s = \\frac{1}{N}\\sum_{k=1}^{N} v_k^2 - r\n$$\n$$\n\\hat{\\lambda}_{\\text{unc}} = \\frac{1}{s}\\left(\\frac{1}{N}\\sum_{k=1}^{N} v_k^2 - r\\right)\n$$\n问题施加了物理约束 $\\lambda \\ge 0$。如果新息的样本方差 $\\frac{1}{N}\\sum v_k^2$ 小于观测误差方差 $r$，则推导出的无约束估计量 $\\hat{\\lambda}_{\\text{unc}}$ 可能为负。负的膨胀因子在物理上是无意义的。因此，我们必须在约束域 $\\lambda \\in [0, \\infty)$ 上最大化对数似然函数。\n\n有约束的最大似然估计 $\\hat{\\lambda}_{\\text{MLE}}$ 由以下方式给出：\n1. 如果 $\\hat{\\lambda}_{\\text{unc}} \\ge 0$，则无约束最大值位于有效域内，因此 $\\hat{\\lambda}_{\\text{MLE}} = \\hat{\\lambda}_{\\text{unc}}$。\n2. 如果 $\\hat{\\lambda}_{\\text{unc}}  0$，则无约束最大值位于有效域之外。我们考察在 $\\lambda \\ge 0$ 时导数 $\\frac{d\\ell}{d\\lambda}$ 的情况。如果 $\\hat{\\lambda}_{\\text{unc}}  0$，这意味着 $\\frac{1}{N}\\sum v_k^2  r$，或 $\\sum v_k^2 - Nr  0$。在边界 $\\lambda=0$ 处的导数为 $\\frac{d\\ell}{d\\lambda}\\big|_{\\lambda=0} = -\\frac{Ns}{2r} + \\frac{s \\sum v_k^2}{2r^2} = \\frac{s}{2r^2}(-Nr + \\sum v_k^2)$，在此条件下为负。进一步检查 $\\ell(\\lambda)$ 的二阶导数可以确认它是一个全局凹函数，这意味着如果导数在 $\\lambda=0$ 处为负，那么对于所有 $\\lambda > 0$ 它都将保持为负。因此，$\\ell(\\lambda)$ 在整个域 $[0, \\infty)$ 上是一个递减函数。最大值因此必须出现在边界处，即 $\\hat{\\lambda}_{\\text{MLE}} = 0$。\n\n结合这两种情况，$\\lambda$ 的有约束最大似然估计是 $0$ 和无约束估计量中的最大值。\n$$\n\\hat{\\lambda}_{\\text{MLE}} = \\max\\left\\{0, \\frac{1}{s}\\left(\\frac{1}{N}\\sum_{k=1}^{N} v_k^2 - r\\right)\\right\\}\n$$\n该表达式是所要求的闭式形式，并满足问题的所有条件。",
            "answer": "$$\n\\boxed{\\max\\left\\{0, \\frac{1}{s} \\left( \\frac{1}{N} \\sum_{k=1}^{N} v_k^{2} - r \\right)\\right\\}}\n$$"
        },
        {
            "introduction": "一个表现良好的资料同化系统不仅依赖于准确的背景误差统计，还需要精确的观测误差协方差矩阵 $R$。Desroziers 方法提供了一种强大的事后诊断工具，利用新息（innovation）和分析残差（analysis residual）之间的统计关系来估计观测误差方差。通过这个练习，你将推导该方法背后的理论关系，并将其应用于一组集合数据，从而掌握一种评估和调整观测误差规范的有效技术。",
            "id": "4036643",
            "problem": "考虑一个利用集合卡尔曼滤波（EnKF）同化到数值天气预报系统中的单一近地面气温观测。假设存在一个局部线性观测算子 $H$，它将观测位置的状态温度映射到观测温度。在本问题中，取 $H=1$（即对状态变量的直接观测，无缩放）。设观测可由 $y = H x^{t} + e$ 建模，其中 $x^{t}$ 是真实状态， $e$ 是观测误差。设背景（先验）状态为 $x^{b} = x^{t} + \\eta$，其中 $\\eta$ 是背景误差。定义新息 $d = y - H x^{b}$ 和分析残差 $r = y - H x^{a}$，其中 $x^{a}$ 是由 EnKF 更新产生的分析状态。\n\n使用 Desroziers 方法，可以从新息和残差的集合中估计观测误差方差。现提供在单个观测位置的 $N=8$ 个新息和残差值（单位为 $\\mathrm{K}$）的集合对：\n$(d_{1}, r_{1}) = (0.8, 0.6)$，$(d_{2}, r_{2}) = (-0.6, -0.5)$，$(d_{3}, r_{3}) = (1.2, 0.8)$，$(d_{4}, r_{4}) = (-0.4, -0.3)$，$(d_{5}, r_{5}) = (0.5, 0.4)$，$(d_{6}, r_{6}) = (-1.0, -0.7)$，$(d_{7}, r_{7}) = (0.9, 0.7)$，$(d_{8}, r_{8}) = (-0.7, -0.6)$。\n\n从卡尔曼滤波和 EnKF 分析更新的线性高斯基础出发，推导一个关系式，该关系式为从新息和分析残差估计观测误差方差的 Desroziers 估计量提供理论依据。然后，使用给定的集合数据计算该估计量，并给出此观测的观测误差方差的最终数值估计。您的最终估计值应以 $\\mathrm{K}^{2}$ 为单位，并将答案四舍五入至四位有效数字。\n\n此外，请清晰地陈述在 EnKF 设置下，该估计量保持一致性所需的假设，包括关于线性度、无偏性、独立性的条件以及卡尔曼增益的作用。\n\n您的最终数值答案必须是一个实数。",
            "solution": "目标是推导用于估计观测误差方差的 Desroziers 关系式，并将其应用于给定的集合数据。该问题涉及单个标量观测，这可将矩阵表示法简化为标量代数。\n\n首先，我们将推导新息 $d$、分析残差 $r$ 和观测误差方差 $R$ 之间的理论关系。分析残差 $r$ 定义为观测值 $y$ 与作用在分析状态 $x^a$ 上的观测算子 $H$ 的乘积之差：\n$$r = y - H x^{a}$$\n分析状态 $x^a$ 是通过卡尔曼更新方程从背景状态 $x^b$ 获得的：\n$$x^{a} = x^{b} + K(y - Hx^{b})$$\n此处，$K$ 是卡尔曼增益，项 $(y - Hx^{b})$ 是新息 $d$。代入新息的定义，分析更新方程变为：\n$$x^{a} = x^{b} + Kd$$\n现在，将 $x^a$ 的这个表达式代入残差 $r$ 的定义中：\n$$r = y - H(x^{b} + Kd) = (y - Hx^{b}) - HKd$$\n认识到 $(y - Hx^{b}) = d$，我们发现残差和新息之间存在一个直接关系：\n$$r = d - HKd = (1 - HK)d$$\n对于给定的问题，这个关系成立，因为我们考虑的是单个观测位置且 $H=1$，所以所有量都是标量。\n\nDesroziers 方法通过计算新息和残差的乘积的期望 $E[dr]$ 来估计观测误差方差 $R$。使用上面推导的关系：\n$$E[dr] = E[d(1 - HK)d] = E[(1-HK)d^2]$$\n假设卡尔曼增益 $K$ 是最优的，因而是确定性的（即，由真实的误差协方差计算得出，而非集合估计值），我们可以写出：\n$$E[dr] = (1 - HK)E[d^2]$$\n项 $E[d^2]$ 是新息的方差。我们可以用其基本误差来表示新息 $d$。给定观测模型 $y = Hx^t + e$（其中 $x^t$ 是真实状态，$e$ 是观测误差）和背景模型 $x^b = x^t + \\eta$（其中 $\\eta$ 是背景误差），新息为：\n$$d = y - Hx^b = (Hx^t + e) - H(x^t + \\eta) = e - H\\eta$$\n假设观测误差 $e$ 和背景误差 $\\eta$ 不相关且均值为零，新息的方差为：\n$$E[d^2] = E[(e - H\\eta)^2] = E[e^2 - 2He\\eta + H^2\\eta^2] = E[e^2] - 2HE[e\\eta] + H^2E[\\eta^2]$$\n$$E[d^2] = R + H^2P_{bb}$$\n其中 $R = E[e^2]$ 是观测误差方差，$P_{bb} = E[\\eta^2]$ 是状态变量的背景误差方差。\n\n对于这个标量问题，最优卡尔曼增益由下式给出：\n$$K = \\frac{P_{bb}H}{H^2P_{bb} + R}$$\n将 $E[d^2]$ 和 $K$ 的表达式代入 $E[dr]$ 的方程中：\n$$E[dr] = \\left(1 - H \\left(\\frac{P_{bb}H}{H^2P_{bb} + R}\\right)\\right) (R + H^2P_{bb})$$\n$$E[dr] = \\left(1 - \\frac{H^2P_{bb}}{H^2P_{bb} + R}\\right) (R + H^2P_{bb})$$\n$$E[dr] = \\left(\\frac{H^2P_{bb} + R - H^2P_{bb}}{H^2P_{bb} + R}\\right) (R + H^2P_{bb})$$\n$$E[dr] = \\left(\\frac{R}{H^2P_{bb} + R}\\right) (R + H^2P_{bb})$$\n$$E[dr] = R$$\n这个推导证实了新息和分析残差乘积的期望等于观测误差方差。在本问题中，$H=1$，这简化了代数运算，但不会改变结果。\n\n为使此关系成立，关键的假设如下：\n1.  **线性性**：观测算子 $H$ 必须是线性的。\n2.  **无偏性**：背景误差 $(\\eta)$ 和观测误差 $(e)$ 都必须是无偏的（即均值为零）。\n3.  **误差不相关**：背景误差 $(\\eta)$ 和观测误差 $(e)$ 必须相互不相关。\n4.  **增益最优性**：在分析更新中使用的卡尔曼增益 $K$ 必须是最优增益。在 EnKF 的背景下，基于集合的增益 $K_{ens}$ 是真实最优增益的一个统计估计。只有当 $K_{ens}$ 是 $K$ 的一个良好近似时，Desroziers 估计量才是一致的，这意味着基于集合的误差协方差是准确的，并且集合大小足够大以最小化抽样误差。\n\n为了从给定的 $N=8$ 对集合中计算观测误差方差的估计值 $\\hat{R}$，我们用样本均值来近似期望：\n$$\\hat{R} = \\frac{1}{N} \\sum_{i=1}^{N} d_i r_i$$\n给定的数据点是：\n$(d_{1}, r_{1}) = (0.8, 0.6)$，$(d_{2}, r_{2}) = (-0.6, -0.5)$，$(d_{3}, r_{3}) = (1.2, 0.8)$，$(d_{4}, r_{4}) = (-0.4, -0.3)$，$(d_{5}, r_{5}) = (0.5, 0.4)$，$(d_{6}, r_{6}) = (-1.0, -0.7)$，$(d_{7}, r_{7}) = (0.9, 0.7)$，$(d_{8}, r_{8}) = (-0.7, -0.6)$。\n\n我们为每一对计算乘积 $d_i r_i$：\n$d_{1}r_{1} = (0.8)(0.6) = 0.48$\n$d_{2}r_{2} = (-0.6)(-0.5) = 0.30$\n$d_{3}r_{3} = (1.2)(0.8) = 0.96$\n$d_{4}r_{4} = (-0.4)(-0.3) = 0.12$\n$d_{5}r_{5} = (0.5)(0.4) = 0.20$\n$d_{6}r_{6} = (-1.0)(-0.7) = 0.70$\n$d_{7}r_{7} = (0.9)(0.7) = 0.63$\n$d_{8}r_{8} = (-0.7)(-0.6) = 0.42$\n\n接下来，我们将这些乘积相加：\n$$\\sum_{i=1}^{8} d_i r_i = 0.48 + 0.30 + 0.96 + 0.12 + 0.20 + 0.70 + 0.63 + 0.42 = 3.81$$\n这个和的单位是 $\\mathrm{K}^{2}$。\n\n最后，我们通过除以集合成员数 $N=8$ 来计算估计值 $\\hat{R}$：\n$$\\hat{R} = \\frac{3.81}{8} = 0.47625$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$\\hat{R} \\approx 0.4763$$\n单位是 $\\mathrm{K}^{2}$。",
            "answer": "$$\\boxed{0.4763}$$"
        }
    ]
}