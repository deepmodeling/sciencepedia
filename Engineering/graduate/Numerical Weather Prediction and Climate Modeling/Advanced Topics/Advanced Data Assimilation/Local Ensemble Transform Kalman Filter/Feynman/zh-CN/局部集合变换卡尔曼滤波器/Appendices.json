{
    "hands_on_practices": [
        {
            "introduction": "集合卡尔曼滤波方法通过有限的样本来估计背景误差协方差。本练习将通过一个简单的理想化模型，揭示当集合样本数有限时，系统如何在物理上不相关的变量间产生虚假的“伪相关”，从而阐明协方差局域化在集合资料同化中的至关重要性。通过这个练习，您将亲手计算出这种由采样误差引起的伪相关，并理解为何必须对其进行处理 。",
            "id": "4060583",
            "problem": "在数值天气预报和气候模拟中，局部集合变换卡尔曼滤波器 (LETKF) 依赖于从一个有限系集估计的协方差结构来更新状态。考虑一个代表三个不同空间位置的玩具三变量模型状态，其中变量 $x_1$ 和 $x_2$ 相邻，而 $x_3$ 与两者都相距较远。假设由于 $x_1$ 和 $x_3$ 之间距离较远，它们之间的真实背景协方差可以忽略不计，但该协方差是从一个大小为 $m=3$ 的有限系集中估计得到的。\n\n给定三个系集成员的状态向量，\n$$\n\\mathbf{x}^{(1)} = \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix}, \\quad\n\\mathbf{x}^{(2)} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 2 \\end{pmatrix}, \\quad\n\\mathbf{x}^{(3)} = \\begin{pmatrix} 3 \\\\ 2 \\\\ -1 \\end{pmatrix},\n$$\n其中每个条目都是无量纲的。\n\n从核心定义出发：\n- 系集平均值为 $\\bar{\\mathbf{x}} = \\frac{1}{m} \\sum_{k=1}^{m} \\mathbf{x}^{(k)}$。\n- 系集扰动为 $\\mathbf{a}^{(k)} = \\mathbf{x}^{(k)} - \\bar{\\mathbf{x}}$。\n- 无偏样本协方差为 $\\mathbf{C} = \\frac{1}{m-1} \\sum_{k=1}^{m} \\mathbf{a}^{(k)} \\mathbf{a}^{(k)\\top}$。\n\n执行以下操作：\n1. 计算当 $k=1,2,3$ 时的系集平均值 $\\bar{\\mathbf{x}}$ 和扰动 $\\mathbf{a}^{(k)}$。\n2. 使用无偏估计量计算 $3 \\times 3$ 的样本协方差矩阵 $\\mathbf{C}$。\n3. 确定 $\\mathbf{C}$ 的秩，并从第一性原理出发，就 $m=3$ 个系集成员所施加的结构来论证你的结论。\n4. 使用 $\\mathbf{C}$ 计算 $x_1$ 和 $x_3$ 之间的样本相关系数，其定义为 $r_{13} = \\frac{C_{13}}{\\sqrt{C_{11} C_{33}}}$，并简要解释为什么在 LETKF 的背景下，这里的非零值会构成虚假的远程相关，以及局域化在概念上是如何解决这个问题的（不需要具体的局域化锥化函数公式）。\n\n将最终答案表示为一个单行矩阵，其中按行主序包含 $\\mathbf{C}$ 的九个条目，其后是作为第十个条目的 $\\mathbf{C}$ 的秩。不需要四舍五入。所有量均为无量纲。",
            "solution": "用户在局部集合变换卡尔曼滤波器 (LETKF) 的背景下提供了一个问题，并要求基于一组给定的系集状态向量进行几项计算和概念性解释。该问题定义明确，科学上合理，并且提供了所有必要的数据和定义。\n\n给定的系集大小为 $m=3$。状态向量是三维的，因此状态维度为 $n=3$。系集成员为：\n$$\n\\mathbf{x}^{(1)} = \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix}, \\quad\n\\mathbf{x}^{(2)} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 2 \\end{pmatrix}, \\quad\n\\mathbf{x}^{(3)} = \\begin{pmatrix} 3 \\\\ 2 \\\\ -1 \\end{pmatrix}\n$$\n\n**1. 计算系集平均值和扰动**\n\n系集平均值 $\\bar{\\mathbf{x}}$ 定义为 $\\bar{\\mathbf{x}} = \\frac{1}{m} \\sum_{k=1}^{m} \\mathbf{x}^{(k)}$。当 $m=3$ 时，我们有：\n$$\n\\bar{\\mathbf{x}} = \\frac{1}{3} \\left( \\mathbf{x}^{(1)} + \\mathbf{x}^{(2)} + \\mathbf{x}^{(3)} \\right) = \\frac{1}{3} \\left( \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\\\ 2 \\end{pmatrix} + \\begin{pmatrix} 3 \\\\ 2 \\\\ -1 \\end{pmatrix} \\right) = \\frac{1}{3} \\begin{pmatrix} 2+1+3 \\\\ 1+0+2 \\\\ -1+2-1 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 6 \\\\ 3 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n系集扰动 $\\mathbf{a}^{(k)}$ 定义为 $\\mathbf{a}^{(k)} = \\mathbf{x}^{(k)} - \\bar{\\mathbf{x}}$。\n对于 $k=1$：\n$$\n\\mathbf{a}^{(1)} = \\mathbf{x}^{(1)} - \\bar{\\mathbf{x}} = \\begin{pmatrix} 2 \\\\ 1 \\\\ -1 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix}\n$$\n对于 $k=2$：\n$$\n\\mathbf{a}^{(2)} = \\mathbf{x}^{(2)} - \\bar{\\mathbf{x}} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 2 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix}\n$$\n对于 $k=3$：\n$$\n\\mathbf{a}^{(3)} = \\mathbf{x}^{(3)} - \\bar{\\mathbf{x}} = \\begin{pmatrix} 3 \\\\ 2 \\\\ -1 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix}\n$$\n作为一致性检查，扰动之和必须为零向量：\n$$\n\\sum_{k=1}^{3} \\mathbf{a}^{(k)} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix} + \\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0-1+1 \\\\ 0-1+1 \\\\ -1+2-1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n检查通过。\n\n**2. 计算样本协方差矩阵**\n\n无偏样本协方差矩阵 $\\mathbf{C}$ 由 $\\mathbf{C} = \\frac{1}{m-1} \\sum_{k=1}^{m} \\mathbf{a}^{(k)} \\mathbf{a}^{(k)\\top}$ 给出。一个等价的公式使用扰动矩阵 $\\mathbf{A} = \\begin{bmatrix} \\mathbf{a}^{(1)}  \\mathbf{a}^{(2)}  \\dots  \\mathbf{a}^{(m)} \\end{bmatrix}$，对于该矩阵 $\\mathbf{C} = \\frac{1}{m-1} \\mathbf{A} \\mathbf{A}^\\top$。当 $m=3$ 时，前置因子为 $\\frac{1}{2}$。\n扰动矩阵 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = \\begin{pmatrix} 0  -1  1 \\\\ 0  -1  1 \\\\ -1  2  -1 \\end{pmatrix}\n$$\n现在我们计算乘积 $\\mathbf{A} \\mathbf{A}^\\top$：\n$$\n\\mathbf{A} \\mathbf{A}^\\top = \\begin{pmatrix} 0  -1  1 \\\\ 0  -1  1 \\\\ -1  2  -1 \\end{pmatrix} \\begin{pmatrix} 0  0  -1 \\\\ -1  -1  2 \\\\ 1  1  -1 \\end{pmatrix}\n$$\n$$\n\\mathbf{A} \\mathbf{A}^\\top = \\begin{pmatrix} (0)(0)+(-1)(-1)+(1)(1)  (0)(0)+(-1)(-1)+(1)(1)  (0)(-1)+(-1)(2)+(1)(-1) \\\\ (0)(0)+(-1)(-1)+(1)(1)  (0)(0)+(-1)(-1)+(1)(1)  (0)(-1)+(-1)(2)+(1)(-1) \\\\ (-1)(0)+(2)(-1)+(-1)(1)  (-1)(0)+(2)(-1)+(-1)(1)  (-1)(-1)+(2)(2)+(-1)(-1) \\end{pmatrix}\n$$\n$$\n\\mathbf{A} \\mathbf{A}^\\top = \\begin{pmatrix} 2  2  -3 \\\\ 2  2  -3 \\\\ -3  -3  6 \\end{pmatrix}\n$$\n最后，我们乘以 $\\frac{1}{m-1} = \\frac{1}{2}$ 得到 $\\mathbf{C}$：\n$$\n\\mathbf{C} = \\frac{1}{2} \\begin{pmatrix} 2  2  -3 \\\\ 2  2  -3 \\\\ -3  -3  6 \\end{pmatrix} = \\begin{pmatrix} 1  1  -\\frac{3}{2} \\\\ 1  1  -\\frac{3}{2} \\\\ -\\frac{3}{2}  -\\frac{3}{2}  3 \\end{pmatrix}\n$$\n\n**3. 协方差矩阵的秩**\n\n样本协方差矩阵 $\\mathbf{C}$ 的秩由线性无关的扰动向量的数量决定。矩阵 $\\mathbf{C}$ 是从 $n \\times m$ 的扰动矩阵 $\\mathbf{A}$ 计算得出的，其中状态维度 $n=3$，系集大小 $m=3$。\n从第一性原理可知，$\\mathbf{A}$ 的列（即扰动向量 $\\mathbf{a}^{(k)}$）之和为零向量。这意味着这些列是线性相关的，因此 $\\mathbf{A}$ 的秩至多为 $m-1$。在本例中，$\\text{rank}(\\mathbf{A}) \\le 3-1 = 2$。\n线性代数中的一个基本结论指出，对于任意实矩阵 $\\mathbf{M}$，$\\text{rank}(\\mathbf{M}\\mathbf{M}^\\top) = \\text{rank}(\\mathbf{M})$。由于 $\\mathbf{C}$ 是 $\\mathbf{A}\\mathbf{A}^\\top$ 的标量倍，我们有 $\\text{rank}(\\mathbf{C}) = \\text{rank}(\\mathbf{A}\\mathbf{A}^\\top) = \\text{rank}(\\mathbf{A})$。\n因此，我们得出结论 $\\text{rank}(\\mathbf{C}) \\le m-1 = 2$。\n为确定秩是否恰好为 $2$，我们检查是否存在至少两个线性无关的扰动向量。我们来考察 $\\mathbf{a}^{(1)}$ 和 $\\mathbf{a}^{(2)}$：\n$$\n\\mathbf{a}^{(1)} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix}, \\quad \\mathbf{a}^{(2)} = \\begin{pmatrix} -1 \\\\ -1 \\\\ 2 \\end{pmatrix}\n$$\n这两个向量不成标量倍数关系，因此它们是线性无关的。这意味着 $\\mathbf{A}$ 的列空间维度为 $2$。因此，$\\text{rank}(\\mathbf{A}) = 2$。\n因此，样本协方差矩阵 $\\mathbf{C}$ 的秩为 $2$。\n这也可以通过检查 $\\mathbf{C}$ 本身看出来。前两行完全相同，所以秩小于 $3$。第三行 $(-\\frac{3}{2}, -\\frac{3}{2}, 3)$ 不是第一行 $(1, 1, -\\frac{3}{2})$ 的标量倍。由于我们有两行线性无关，所以秩为 $2$。\n\n**4. 虚假相关与局域化**\n\n$x_1$ 和 $x_3$ 之间的样本相关系数定义为 $r_{13} = \\frac{C_{13}}{\\sqrt{C_{11} C_{33}}}$。使用计算出的矩阵 $\\mathbf{C}$ 中的条目：\n- $C_{11} = 1$\n- $C_{33} = 3$\n- $C_{13} = -\\frac{3}{2}$\n$$\nr_{13} = \\frac{-\\frac{3}{2}}{\\sqrt{(1)(3)}} = \\frac{-\\frac{3}{2}}{\\sqrt{3}} = -\\frac{3}{2\\sqrt{3}} = -\\frac{3\\sqrt{3}}{2 \\cdot 3} = -\\frac{\\sqrt{3}}{2}\n$$\n计算出的相关系数为 $r_{13} \\approx -0.866$。这是一个强的负相关。\n\n**解释：** 问题陈述变量 $x_1$ 和 $x_3$ 代表相距较远的位置，它们真实的背景协方差可以忽略不计。我们计算出的大非零相关 $r_{13} = -\\frac{\\sqrt{3}}{2}$ 是由于从过小的系集（$m=3$）估计协方差结构而产生的伪影。这被称为**虚假相关**或抽样误差。在卡尔曼滤波更新中使用这个样本协方差矩阵 $\\mathbf{C}$ 会错误地导致位置 $3$ 的观测强烈影响位置 $1$ 的状态估计，这在物理上是不现实的。\n\n**局域化**是在系集卡尔曼滤波中用于纠正此问题的技术。其工作原理是根据物理距离对样本协方差进行锥化处理。一个局域化函数（通过逐元素相乘的方式）被应用于样本协方差矩阵。对于位于同一位置的变量，该函数的值为 $1$，并随着变量间距离的增加而衰减至 $0$。对于相距遥远的变量 $x_1$ 和 $x_3$，局域化因子将接近于零，从而在修正后的矩阵中有效地将虚假的协方差 $C_{13}$ 强制归零。这可以防止在资料同化更新过程中的非物理远程影响，并确保得到物理上合理的分析结果。\n\n总之，已按要求计算出必要的量。最终答案要求按行主序排列 $\\mathbf{C}$ 的元素，其后是其秩。\n$\\mathbf{C}$ 的元素为： $C_{11}=1$, $C_{12}=1$, $C_{13}=-\\frac{3}{2}$, $C_{21}=1$, $C_{22}=1$, $C_{23}=-\\frac{3}{2}$, $C_{31}=-\\frac{3}{2}$, $C_{32}=-\\frac{3}{2}$, $C_{33}=3$。\n秩为 $2$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1  1  -\\frac{3}{2}  1  1  -\\frac{3}{2}  -\\frac{3}{2}  -\\frac{3}{2}  3  2 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "为了解决上一练习中探讨的伪相关问题，LETKF 采用局域化方案，即限制观测的影响在格点周围的局部区域。在此练习中，您将推导并应用一种常用的局域化“锥化”函数，该函数能够平滑地削减远处观测的影响，从而将 LETKF 中的“局域化”（Local）概念具体化 。这个实践将帮助您掌握如何从数学上构建一个平滑的截断函数，并将其应用于实际的观测数据筛选。",
            "id": "4060590",
            "problem": "在数值天气预报和气候建模的数据同化中，局部集合变换卡尔曼滤波器（LETKF）将观测的影响限制在每个模型格点周围的地理局部邻域内，并通过一个锥形函数（taper）应用协方差局域化，该函数在有限的截止距离处平滑地将观测影响减小到零。考虑位于原点的一个二维水平格点，其坐标为 $(0,0)$，单位为公里。一组六个观测站相对于该格点位于以下笛卡尔坐标（单位为公里）处：\n$(30,40)$、$(15,20)$、$(3,4)$、$(35,0)$、$(0,0)$、$(60,0)$。\n设局域化半径为 $r=50$ 公里。\n\n采用以下基本设定：\n- 从格点到位于 $(x,y)$ 的观测站的水平距离 $d$ 由欧几里得范数 $d=\\sqrt{x^2+y^2}$ 给出。\n- 局域化锥形权重 $w(d)$ 是无量纲的，仅取决于距离 $d$，并且必须满足适用于LETKF中协方差局域化的平滑性和边界约束：$w(0)=1$、$w(r)=0$ 以及 $w'(0)=0$、$w'(r)=0$，对于所有 $d \\ge r$，$w(d)=0$。\n- 在与这些约束一致的函数中，使用在 $[0,r]$ 上二阶连续可微且具有紧支撑的最简单的三角函数形式。\n\n任务：\n- 确定哪些观测包含在局域分析域中，该域定义为满足 $d \\le r$ 的观测。\n- 根据所述约束推导出相应的锥形函数 $w(d)$，并按上面列出的顺序计算每个站点的权重。对于任何 $d > r$ 的观测，将其权重设置为 $0$。\n\n将最终答案表示为按给定测站顺序排列的六个权重的单行向量，四舍五入到五位有效数字。权重是无量纲数。",
            "solution": "评价认为，该问题陈述具有科学依据、问题适定、客观且完整。它描述了数据同化中的一个标准流程，特别是在局部集合变换卡尔曼滤波器（LETKF）背景下应用协方差局域化锥形函数。所提供的数据和约束条件足以且一致地推导出唯一解。因此，该问题是有效的。\n\n任务是确定一组六个观测站相对于原点 $(0,0)$ 处格点的局域化锥形权重。这需要两个主要步骤：首先，根据给定的约束条件推导出锥形权重函数 $w(d)$ 的解析形式；其次，在计算每个观测点到原点的距离 $d$ 后，将此函数应用于每个观测点。\n\n首先，我们推导锥形函数 $w(d)$。问题规定 $w(d)$ 必须是在区间 $[0, r]$（其中 $r$ 是局域化半径）上定义的、二阶连续可微的最简单三角函数形式，并且满足以下四个边界条件：\n1. $w(0) = 1$ （在格点处权重为1）\n2. $w(r) = 0$ （在截止半径处权重为0）\n3. $w'(0) = 0$ （为保证平滑性，在格点处斜率为0）\n4. $w'(r) = 0$ （为保证平滑性，在截止半径处斜率为0）\n\n函数还被定义为对于所有 $d \\ge r$ 都有 $w(d) = 0$。对三角函数形式的要求表明函数涉及正弦和/或余弦。一个简单的候选形式是 $w(d) = A\\cos(kd) + B\\sin(kd) + C$。\n\n让我们应用边界条件。条件 $w'(0) = 0$ 是一个强约束。其导数为 $w'(d) = -Ak\\sin(kd) + Bk\\cos(kd)$。在 $d=0$ 处，我们有 $w'(0) = Bk\\cos(0) = Bk$。要使其为零，要么 $B=0$，要么 $k=0$。如果 $k=0$，函数为常数，无法满足其他条件。因此，我们必须有 $B=0$。这将我们的候选函数简化为 $w(d) = A\\cos(kd) + C$，这是一个偶函数，与预期的关于原点的对称性一致。\n\n现在我们将剩下的三个条件应用于 $w(d) = A\\cos(kd) + C$：\n- $w(0) = 1 \\implies A\\cos(0) + C = A + C = 1$。\n- $w'(r) = 0 \\implies -Ak\\sin(kr) = 0$。对于非平凡解，由于 $A \\ne 0$ 且 $k \\ne 0$，我们必须有 $\\sin(kr) = 0$。这意味着 $kr = n\\pi$，其中 $n$ 是某个整数。对于最简单的非常数函数，我们选择 $n=1$，这给出 $k = \\frac{\\pi}{r}$。\n- $w(r) = 0 \\implies A\\cos(kr) + C = 0$。代入 $k=\\frac{\\pi}{r}$，我们得到 $A\\cos(\\pi) + C = -A + C = 0$。\n\n我们现在有一个关于 $A$ 和 $C$ 的二元一次方程组：\n$$ A + C = 1 $$\n$$ -A + C = 0 \\implies A = C $$\n将 $A=C$ 代入第一个方程得到 $2A=1$，因此 $A = \\frac{1}{2}$ 且 $C = \\frac{1}{2}$。\n\n对于 $d \\in [0, r]$，得到的局域化函数是：\n$$ w(d) = \\frac{1}{2}\\cos\\left(\\frac{\\pi d}{r}\\right) + \\frac{1}{2} = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{\\pi d}{r}\\right)\\right) $$\n这个函数是升余弦窗或汉宁窗的一种形式。它在区间 $[0, r]$ 上是无限可微的，因此在其支撑域上满足“二阶连续可微”的要求。它是局域化锥形函数的标准且简单的选择。\n\n给定局域化半径 $r=50$ 公里，具体的锥形函数是：\n$$ w(d) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{\\pi d}{50}\\right)\\right) \\quad \\text{for } 0 \\le d \\le 50 $$\n且对于 $d > 50$，有 $w(d)=0$。\n\n接下来，我们计算六个观测站各自的距离 $d$ 和对应的权重 $w(d)$。\n\n1. 位于 $(30, 40)$ 的观测站 1：\n$d_1 = \\sqrt{30^2 + 40^2} = \\sqrt{900 + 1600} = \\sqrt{2500} = 50$ 公里。\n由于 $d_1 = r = 50$，该观测位于局域分析域的边缘。根据边界条件 $w(r)=0$，权重为 $w_1 = w(50) = 0$。\n$w_1 = 0.00000$。\n\n2. 位于 $(15, 20)$ 的观测站 2：\n$d_2 = \\sqrt{15^2 + 20^2} = \\sqrt{225 + 400} = \\sqrt{625} = 25$ 公里。\n由于 $d_2 \\le r$，该观测被包括在内。\n$w_2 = w(25) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{25\\pi}{50}\\right)\\right) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{\\pi}{2}\\right)\\right) = \\frac{1}{2}(1+0) = 0.5$。\n$w_2 = 0.50000$。\n\n3. 位于 $(3, 4)$ 的观测站 3：\n$d_3 = \\sqrt{3^2 + 4^2} = \\sqrt{9 + 16} = \\sqrt{25} = 5$ 公里。\n由于 $d_3 \\le r$，该观测被包括在内。\n$w_3 = w(5) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{5\\pi}{50}\\right)\\right) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{\\pi}{10}\\right)\\right)$。\n数值计算，$\\cos(\\frac{\\pi}{10}) \\approx 0.9510565163$。\n$w_3 \\approx \\frac{1}{2}(1 + 0.9510565163) = 0.975528258$。\n四舍五入到五位有效数字，$w_3 = 0.97553$。\n\n4. 位于 $(35, 0)$ 的观测站 4：\n$d_4 = \\sqrt{35^2 + 0^2} = 35$ 公里。\n由于 $d_4 \\le r$，该观测被包括在内。\n$w_4 = w(35) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{35\\pi}{50}\\right)\\right) = \\frac{1}{2}\\left(1 + \\cos\\left(\\frac{7\\pi}{10}\\right)\\right)$。\n数值计算，$\\cos(\\frac{7\\pi}{10}) \\approx -0.5877852523$。\n$w_4 \\approx \\frac{1}{2}(1 - 0.5877852523) = 0.20610737385$。\n四舍五入到五位有效数字，$w_4 = 0.20611$。\n\n5. 位于 $(0, 0)$ 的观测站 5：\n$d_5 = \\sqrt{0^2 + 0^2} = 0$ 公里。\n该观测位于格点本身。\n根据边界条件，$w_5 = w(0) = 1$。\n$w_5 = 1.0000$。\n\n6. 位于 $(60, 0)$ 的观测站 6：\n$d_6 = \\sqrt{60^2 + 0^2} = 60$ 公里。\n由于 $d_6 > r$，该观测位于局域分析域之外。\n根据问题定义，对于 $d > 50$ 有 $w(d)=0$。\n$w_6 = 0.00000$。\n\n最终答案是按指定顺序排列的这六个权重的行向量。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 0.00000  0.50000  0.97553  0.20611  1.0000  0.00000 \\end{pmatrix} } $$"
        },
        {
            "introduction": "在局域化方案下，分析更新在每个独立的局部区域内进行，这正是 LETKF 算法的核心优势所在。本练习将深入探讨 LETKF 更新步骤的数学核心——“集合变换”（Ensemble Transform）。您将在低维的集合子空间中计算分析更新，从而体会该方法如何高效地求解分析问题 ，并验证其保持集合距平中心化和秩的关键性质。",
            "id": "4060622",
            "problem": "考虑在数值天气预报 (NWP) 中的一个局部分析体积，其中应用了系综变换卡尔曼滤波器 (ETKF)。系综变换卡尔曼滤波器 (ETKF) 使用系综预报异常在系综子空间中表达卡尔曼分析更新，并构建一个线性变换，将预报异常映射到分析异常，同时确保更新后的系综协方差与卡尔曼分析误差协方差一致。系综异常必须具有零列均值，并且该变换必须保持此属性。观测误差协方差假设为对称正定，观测算子在预报均值的邻域内是线性的。\n\n给定一个小的、完全指定的数值示例：\n\n- 状态维数为 $n=2$，系综大小为 $N=3$，预报系综异常按因子 $1/\\sqrt{N-1}$ 进行缩放，使得样本协方差等于 $X'^{f} (X'^{f})^{\\top}$。异常为\n$$\nX'^{f} \\;=\\; \\frac{1}{\\sqrt{2}}\n\\begin{pmatrix}\n2  -1  -1 \\\\\n0  1  -1\n\\end{pmatrix}.\n$$\n- 观测算子是提取第一个状态分量的线性映射 $H : \\mathbb{R}^{2} \\to \\mathbb{R}$，即 $H = \\begin{pmatrix} 1 & 0 \\end{pmatrix}$。因此，相应的预报观测异常为\n$$\nY'^{f} \\;=\\; H X'^{f} \\;=\\; \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 2  -1  -1 \\end{pmatrix}.\n$$\n- 观测误差协方差为 $R = 1$（标量），新息为 $d = 1.2$（标量）。\n\n任务：\n\n1. 从观测空间中的标准卡尔曼滤波目标和预报误差协方差的系综表示出发，推导系综空间中的 ETKF 分析权重 $w^{a}$，并计算给定 $X'^{f}$、$Y'^{f}$、$R$ 和 $d$ 下其明确的数值。在推导权重时，通过将系综空间分解为均值方向及其正交补，来遵守异常的零列均值约束。\n\n2. 在系综空间中构建 ETKF 异常变换矩阵 $T$，该矩阵将 $X'^{f}$ 映射到分析异常 $X'^{a} = X'^{f} T$。使用一个分离了均值方向向量及其正交补的标准正交基。应用 $T$ 以获得 $X'^{a}$ 并验证以下两个属性：\n   - $X'^{a}$ 的列和为零，即 $X'^{a} \\mathbf{1} = \\mathbf{0}$，其中 $\\mathbf{1} = (1,1,1)^{\\top}$，\n   - 秩得以保持，即 $\\mathrm{rank}(X'^{a}) = \\mathrm{rank}(X'^{f})$。\n\n3. 根据你在任务2中的构造，计算 ETKF 异常变换矩阵 $T$ 的行列式。将此行列式作为你的最终答案。将行列式表示为精确值（无需四舍五入）。最终答案必须是单个实数值。\n\n你的工作必须是自洽的，并从基本的卡尔曼滤波原理（增益最小化后验均方误差）和系综协方差表示（来自缩放异常的样本协方差）开始，无需预先假设任何专门的 ETKF 公式。",
            "solution": "该问题要求从第一性原理出发，对系综变换卡尔曼滤波器 (ETKF) 中的关键量进行推导和计算。我们已知缩放后的预报系综异常 $X'^{f}$、观测算子 $H$、观测误差协方差 $R$ 和新息 $d$。\n\n状态维数为 $n=2$，系综大小为 $N=3$。缩放后的预报异常由下式给出\n$$\nX'^{f} \\;=\\; \\frac{1}{\\sqrt{N-1}}\n\\begin{pmatrix}\n2  -1  -1 \\\\\n0  1  -1\n\\end{pmatrix}\n\\;=\\; \\frac{1}{\\sqrt{2}}\n\\begin{pmatrix}\n2  -1  -1 \\\\\n0  1  -1\n\\end{pmatrix}.\n$$\n系综预报误差协方差矩阵由样本协方差 $P^f = X'^{f} (X'^{f})^{\\top}$ 近似。观测算子为 $H = \\begin{pmatrix} 1  0 \\end{pmatrix}$。预报观测异常为 $Y'^{f} = H X'^{f}$，观测误差协方差为 $R=1$。新息为 $d=1.2$。\n\n### 任务1：分析权重 $w^a$ 的推导与计算\n\n对均值状态的标准卡尔曼滤波器分析更新为\n$$\n\\bar{x}^a = \\bar{x}^f + K d,\n$$\n其中 $d = y^o - H\\bar{x}^f$ 是新息，$K$ 是卡尔曼增益。卡尔曼增益被定义为最小化分析误差方差，并由下式给出\n$$\nK = P^f H^{\\top} (H P^f H^{\\top} + R)^{-1}.\n$$\n将预报误差协方差的系综估计 $P^f = X'^{f} (X'^{f})^{\\top}$ 代入，我们可以用系综异常来表示增益。\n项 $P^f H^{\\top}$ 变为：\n$$\nP^f H^{\\top} = X'^{f} (X'^{f})^{\\top} H^{\\top} = X'^{f} (H X'^{f})^{\\top} = X'^{f} (Y'^{f})^{\\top}.\n$$\n项 $H P^f H^{\\top}$ 变为：\n$$\nH P^f H^{\\top} = H (X'^{f} (X'^{f})^{\\top}) H^{\\top} = (H X'^{f})(H X'^{f})^{\\top} = Y'^{f} (Y'^{f})^{\\top}.\n$$\n因此，系综子空间中的卡尔曼增益为\n$$\nK = X'^{f} (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1}.\n$$\n系综均值的更新 $\\Delta\\bar{x} = \\bar{x}^a - \\bar{x}^f = K d$ 则为\n$$\n\\Delta\\bar{x} = X'^{f} \\left[ (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} d \\right].\n$$\nETKF 框架将此更新表示为预报异常列的线性组合，$\\Delta\\bar{x} = X'^{f} w^a$，其中 $w^a$ 是系综空间中的分析权重向量。通过比较 $\\Delta\\bar{x}$ 的两个表达式，我们确定分析权重为\n$$\nw^a = (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} d.\n$$\n现在，我们计算给定数据的数值。\n预报观测异常为\n$$\nY'^{f} = H X'^{f} = \\begin{pmatrix} 1  0 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2  -1  -1 \\\\ 0  1  -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2  -1  -1 \\end{pmatrix}.\n$$\n项 $Y'^{f} (Y'^{f})^{\\top}$ 在本例中是一个标量，因为只有一个观测：\n$$\nY'^{f} (Y'^{f})^{\\top} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2  -1  -1 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\frac{1}{2} (2^2 + (-1)^2 + (-1)^2) = \\frac{1}{2}(4+1+1) = 3.\n$$\n给定 $R=1$ 和 $d=1.2$，逆项为 $(Y'^{f} (Y'^{f})^{\\top} + R)^{-1} = (3 + 1)^{-1} = \\frac{1}{4}$。\n预报观测异常的转置是 $(Y'^{f})^{\\top} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\end{pmatrix}$。\n将这些值代入 $w^a$ 的表达式中：\n$$\nw^a = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\end{pmatrix} \\left(\\frac{1}{4}\\right) (1.2) = \\frac{0.3}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 0.6 \\\\ -0.3 \\\\ -0.3 \\end{pmatrix}.\n$$\n\n### 任务2：异常变换矩阵 $T$ 的构造\n\n分析误差协方差矩阵 $P^a$ 由卡尔曼更新公式给出\n$$\nP^a = (I - KH)P^f.\n$$\n代入 $K$ 和 $P^f$ 的系综表达式：\n$$\nP^a = P^f - K H P^f = X'^{f} (X'^{f})^{\\top} - \\left( X'^{f} (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} \\right) H \\left( X'^{f} (X'^{f})^{\\top} \\right).\n$$\n使用 $Y'^{f} = H X'^{f}$，上式简化为\n$$\nP^a = X'^{f} (X'^{f})^{\\top} - X'^{f} (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} Y'^{f} (X'^{f})^{\\top}.\n$$\n提出公因子 $X'^{f}$ 和 $(X'^{f})^{\\top}$：\n$$\nP^a = X'^{f} \\left[ I_N - (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} Y'^{f} \\right] (X'^{f})^{\\top}.\n$$\n其中 $I_N$ 是 $N \\times N$ 的单位矩阵。\nETKF 将分析异常定义为预报异常的线性变换，$X'^{a} = X'^{f} T$。那么分析协方差为 $P^a = X'^{a}(X'^{a})^{\\top} = X'^{f} T T^{\\top} (X'^{f})^{\\top}$。将此与上面 $P^a$ 的表达式进行比较，我们确定\n$$\nT T^{\\top} = I_N - (Y'^{f})^{\\top} (Y'^{f} (Y'^{f})^{\\top} + R)^{-1} Y'^{f}.\n$$\nETKF 选择 $T$ 为该矩阵的对称平方根，$T = (T T^{\\top})^{1/2}$。为了找到这个平方根，我们对 $T T^{\\top}$ 进行谱分解。令 $C = T T^{\\top}$。\n$$\nC = I_3 - (Y'^{f})^{\\top} (3+1)^{-1} Y'^{f} = I_3 - \\frac{1}{4} (Y'^{f})^{\\top} Y'^{f}.\n$$\n$$\n(Y'^{f})^{\\top} Y'^{f} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ -1 \\\\ -1 \\end{pmatrix} \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2  -1  -1 \\end{pmatrix} = \\frac{1}{2} \\begin{pmatrix} 4  -2  -2 \\\\ -2  1  1 \\\\ -2  1  1 \\end{pmatrix}.\n$$\n所以，$C = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} - \\frac{1}{8} \\begin{pmatrix} 4  -2  -2 \\\\ -2  1  1 \\\\ -2  1  1 \\end{pmatrix} = \\begin{pmatrix} 1-1/2  1/4  1/4 \\\\ 1/4  1-1/8  -1/8 \\\\ 1/4  -1/8  1-1/8 \\end{pmatrix} = \\begin{pmatrix} 1/2  1/4  1/4 \\\\ 1/4  7/8  -1/8 \\\\ 1/4  -1/8  7/8 \\end{pmatrix}$。\n\n为了求 $T = C^{1/2}$，我们求 $C$ 的特征值和特征向量。矩阵 $(Y'^{f})^{\\top} Y'^{f}$ 的秩为1。其非零特征值对应于特征向量 $(Y'^{f})^{\\top}$。该特征值为 $Y'^{f}(Y'^{f})^{\\top} = 3$。另外两个特征值为0。特征值0对应的特征向量张成了 $Y'^{f}$ 的零空间，即满足 $Y'^f v = 0$ 的向量 $v$。其中一个这样的向量是均值方向向量 $\\mathbf{1} = (1,1,1)^{\\top}$，因为异常和为零。另一个同时正交于 $(Y'^{f})^{\\top} \\propto (2,-1,-1)^{\\top}$ 和 $\\mathbf{1}$ 的向量是 $(0,1,-1)^{\\top}$。\n\n$C = I_3 - \\frac{1}{4} (Y'^{f})^{\\top} Y'^{f}$ 的特征值为 $1 - \\frac{1}{4}\\lambda$，其中 $\\lambda$ 是 $(Y'^{f})^{\\top} Y'^{f}$ 的特征值。\n- 特征向量 $\\propto (2,-1,-1)^{\\top}$：特征值为 $1 - \\frac{1}{4}(3) = 1/4$。\n- 特征向量 $\\propto (1,1,1)^{\\top}$：特征值为 $1 - \\frac{1}{4}(0) = 1$。\n- 特征向量 $\\propto (0,1,-1)^{\\top}$：特征值为 $1 - \\frac{1}{4}(0) = 1$。\n\n标准正交特征向量为：\n$u_1 = \\frac{1}{\\sqrt{6}}(2,-1,-1)^{\\top}$ (特征值 $\\lambda_1 = 1/4$),\n$u_2 = \\frac{1}{\\sqrt{3}}(1,1,1)^{\\top}$ (特征值 $\\lambda_2 = 1$),\n$u_3 = \\frac{1}{\\sqrt{2}}(0,1,-1)^{\\top}$ (特征值 $\\lambda_3 = 1$)。\n令 $V$ 是由这些特征向量组成的矩阵：$V = \\begin{pmatrix} 2/\\sqrt{6}  1/\\sqrt{3}  0 \\\\ -1/\\sqrt{6}  1/\\sqrt{3}  1/\\sqrt{2} \\\\ -1/\\sqrt{6}  1/\\sqrt{3}  -1/\\sqrt{2} \\end{pmatrix}$。\n$C$ 的特征值对角矩阵是 $\\Lambda_C = \\mathrm{diag}(1/4, 1, 1)$。\n矩阵 $T$ 具有相同的特征向量，但其特征值是 $\\Lambda_C$ 中元素的平方根。\n$\\Lambda_T = \\mathrm{diag}(\\sqrt{1/4}, \\sqrt{1}, \\sqrt{1}) = \\mathrm{diag}(1/2, 1, 1)$.\n$T = V \\Lambda_T V^{\\top}$.\n$V\\Lambda_T = \\begin{pmatrix} 1/\\sqrt{6}  1/\\sqrt{3}  0 \\\\ -1/(2\\sqrt{6})  1/\\sqrt{3}  1/\\sqrt{2} \\\\ -1/(2\\sqrt{6})  1/\\sqrt{3}  -1/\\sqrt{2} \\end{pmatrix}$.\n$T = (V\\Lambda_T) V^\\top = \\begin{pmatrix} 1/\\sqrt{6}  1/\\sqrt{3}  0 \\\\ -1/(2\\sqrt{6})  1/\\sqrt{3}  1/\\sqrt{2} \\\\ -1/(2\\sqrt{6})  1/\\sqrt{3}  -1/\\sqrt{2} \\end{pmatrix} \\begin{pmatrix} 2/\\sqrt{6}  -1/\\sqrt{6}  -1/\\sqrt{6} \\\\ 1/\\sqrt{3}  1/\\sqrt{3}  1/\\sqrt{3} \\\\ 0  1/\\sqrt{2}  -1/\\sqrt{2} \\end{pmatrix}$.\n$T_{11} = \\frac{2}{6} + \\frac{1}{3} = \\frac{1}{3}+\\frac{1}{3} = \\frac{2}{3}$.\n$T_{12} = -\\frac{1}{6} + \\frac{1}{3} = \\frac{1}{6}$. $T_{13} = -\\frac{1}{6} + \\frac{1}{3} = \\frac{1}{6}$.\n$T_{21} = -\\frac{2}{12} + \\frac{1}{3} = -\\frac{1}{6}+\\frac{1}{3} = \\frac{1}{6}$.\n$T_{22} = \\frac{1}{12} + \\frac{1}{3} + \\frac{1}{2} = \\frac{1+4+6}{12} = \\frac{11}{12}$.\n$T_{23} = \\frac{1}{12} + \\frac{1}{3} - \\frac{1}{2} = \\frac{1+4-6}{12} = -\\frac{1}{12}$.\n由于 $T$ 是对称的，所以 $T_{ij}=T_{ji}$。\n$T = \\begin{pmatrix} 2/3  1/6  1/6 \\\\ 1/6  11/12  -1/12 \\\\ 1/6  -1/12  11/12 \\end{pmatrix}$。\n\n现在，计算 $X'^{a} = X'^{f} T$：\n$$\nX'^{a} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2  -1  -1 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} 2/3  1/6  1/6 \\\\ 1/6  11/12  -1/12 \\\\ 1/6  -1/12  11/12 \\end{pmatrix}.\n$$\n乘积的第一行为 $(\\frac{4}{3}-\\frac{1}{6}-\\frac{1}{6}, \\frac{2}{6}-\\frac{11}{12}+\\frac{1}{12}, \\frac{2}{6}+\\frac{1}{12}-\\frac{11}{12}) = (\\frac{4}{3}-\\frac{1}{3}, \\frac{4-11+1}{12}, \\frac{4+1-11}{12}) = (1, -1/2, -1/2)$。\n第二行为 $(0+\\frac{1}{6}-\\frac{1}{6}, 0+\\frac{11}{12}+\\frac{1}{12}, 0-\\frac{1}{12}-\\frac{11}{12}) = (0, 1, -1)$。\n所以，$X'^{a} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  -1/2  -1/2 \\\\ 0  1  -1 \\end{pmatrix}$。\n\n属性验证：\n1. 零列和：$X'^{a}\\mathbf{1} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1 - 1/2 - 1/2 \\\\ 0 + 1 - 1 \\end{pmatrix} = \\mathbf{0}$。此属性成立。\n2. 秩保持：矩阵乘积的秩 $\\mathrm{rank}(AB)$ 小于或等于 $\\mathrm{rank}(A)$ 和 $\\mathrm{rank}(B)$ 的最小值。如果变换矩阵 $T$ 是满秩的，则秩得以保持。$T$ 的特征值为 $1/2$、1 和 1。由于没有一个为零，$T$ 是可逆的并且是满秩（秩为3）。因此，$\\mathrm{rank}(X'^{a}) = \\mathrm{rank}(X'^{f}T) = \\mathrm{rank}(X'^{f})$。矩阵 $X'^{f}$ 有两个线性无关的行，所以其秩为2。矩阵 $X'^{a}$ 也显然有两个线性无关的行，所以其秩也为2。秩得以保持。\n\n### 任务3：变换矩阵 $T$ 的行列式\n\n矩阵的行列式是其特征值的乘积。我们在任务2的构造过程中已经找到了变换矩阵 $T$ 的特征值。$T$ 的特征值是 $C=TT^\\top$ 的特征值的平方根。$C$ 的特征值被确定为 $1/4$、1 和 1。\n因此，$T$ 的特征值为 $\\sqrt{1/4} = 1/2$、$\\sqrt{1} = 1$ 和 $\\sqrt{1} = 1$。\n$T$ 的行列式是这些特征值的乘积：\n$$\n\\det(T) = \\frac{1}{2} \\times 1 \\times 1 = \\frac{1}{2}.\n$$\n这可以通过对前面推导出的矩阵 $T$ 进行直接计算来验证：\n$\\det(T) = \\det \\begin{pmatrix} 2/3  1/6  1/6 \\\\ 1/6  11/12  -1/12 \\\\ 1/6  -1/12  11/12 \\end{pmatrix} = \\frac{2}{3}(\\frac{121}{144}-\\frac{1}{144}) - \\frac{1}{6}(\\frac{11}{72}+\\frac{1}{72}) + \\frac{1}{6}(-\\frac{1}{72}-\\frac{11}{72}) = \\frac{2}{3}(\\frac{120}{144}) - \\frac{1}{6}(\\frac{12}{72}) + \\frac{1}{6}(-\\frac{12}{72}) = \\frac{2}{3}(\\frac{5}{6}) - \\frac{1}{6}(\\frac{1}{6}) - \\frac{1}{6}(\\frac{1}{6}) = \\frac{10}{18} - \\frac{1}{36} - \\frac{1}{36} = \\frac{20-1-1}{36} = \\frac{18}{36} = \\frac{1}{2}$。\n计算出的行列式是 $1/2$。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        }
    ]
}