{
    "hands_on_practices": [
        {
            "introduction": "任何负碳技术都必须遵循热力学定律。本练习  旨在从第一性原理出发，推导直接空气捕获（DAC）所需的理论最小功，为评估所有现实世界中的技术提供一个关键基准。通过这个练习，我们可以量化地理解从大气中分离稀薄的二氧化碳气体所面临的根本性能源挑战。",
            "id": "4021072",
            "problem": "在数值天气预报（NWP）和气候模型中，二氧化碳去除（CDR）策略必须根据能量约束进行评估。考虑在空气被视为大气条件下理想气体混合物的极限情况下，从空气中等温、等压、可逆地分离二氧化碳。从混合熵的统计力学起源和理想气体化学势的热力学定义出发，推导分离每摩尔二氧化碳所需的最小可逆功的表达式，记为 $W_{\\min}(x,T,P)$。该过程将空气中摩尔分数为 $x$ 的二氧化碳分离出来，形成在相同温度 $T$ 和压力 $P$ 下的纯二氧化碳产物流，以及一个二氧化碳贫化的空气流。假设理想行为，并忽略除了在恒定压力 $P$ 下混合和解混相关的压力-体积功之外的其他功。\n\n使用基本原理，即分离所需的可逆功等于解混过程吉布斯自由能的增加量，以及理想气体化学势关系 $\\mu_{i}(T,p_{i})=\\mu_{i}^{0}(T)+R T \\ln\\!\\big(p_{i}/p^{0}\\big)$，其中 $p_{i}$ 是组分 $i$ 的分压，$R$ 是通用气体常数，$p^{0}$ 是一个在计算差值时会抵消的参考压力。\n\n然后，对于二氧化碳浓度 $C_{\\mathrm{atm}}=x=4.20\\times 10^{-4}$（即百万分之420体积份数）的大气，在温度 $T=298$ 开尔文和压力 $P=1$ 巴的条件下，使用 $R=8.314$ $\\mathrm{J\\,mol^{-1}\\,K^{-1}}$，数值计算您推导出的 $W_{\\min}$。作为背景参考，一个典型的直接空气捕获（DAC）过程在可比的环境条件下，每分离一摩尔二氧化碳可能消耗的实际比能量为 $E_{\\mathrm{practical}}=3.00\\times 10^{2} \\, \\mathrm{kJ\\,mol^{-1}}$。\n\n将您的最终答案表示为单一比率 $E_{\\mathrm{practical}}/W_{\\min}$，作为一个无量纲的十进制数。将您的最终答案四舍五入到三位有效数字。",
            "solution": "问题要求计算从理想气体混合物（空气）中分离一摩尔二氧化碳（$\\mathrm{CO}_2$），并使其在相同温度 $T$ 和总压力 $P$ 下成为纯净产物所需的最小可逆功。这个最小功 $W_{\\min}$ 对应于这个可逆、等温、等压过程的吉布斯自由能变化量 $\\Delta G$。这个过程可以被概念化为从一个非常大的空气库中提取一摩尔 $\\mathrm{CO}_2$，以至于剩余空气的组成实际上保持不变。\n\n将一摩尔物质 $i$ 从初始状态（在混合物中）转移到最终状态（作为纯物质）的吉布斯自由能变化由其在这两个状态之间的化学势 $\\mu_i$ 的差值给出。\n\n$W_{\\min} = \\Delta G = G_{\\text{final}} - G_{\\text{initial}} = \\mu_{\\text{CO}_2, \\text{pure}} - \\mu_{\\text{CO}_2, \\text{mix}}$\n\n此处，$\\mu_{\\text{CO}_2, \\text{pure}}$ 是在温度 $T$ 和压力 $P$ 下一摩尔纯 $\\mathrm{CO}_2$ 的化学势，而 $\\mu_{\\text{CO}_2, \\text{mix}}$ 是在温度 $T$ 和总压力 $P$ 下空气混合物中 $\\mathrm{CO}_2$ 的化学势。\n\n问题给出了理想气体组分 $i$ 在温度 $T$ 和分压 $p_i$ 下的化学势表达式：\n$$\\mu_{i}(T, p_{i}) = \\mu_{i}^{0}(T) + RT \\ln\\left(\\frac{p_{i}}{p^{0}}\\right)$$\n其中 $\\mu_{i}^{0}(T)$ 是在参考压力 $p^{0}$ 下的标准化学势，$R$ 是通用气体常数。\n\n在初始状态，空气是在总压力 $P$ 下的理想混合物。根据 Dalton 定律，摩尔分数为 $x$ 的 $\\mathrm{CO}_2$ 的分压为：$p_{\\text{CO}_2} = xP$。\n因此，混合物中 $\\mathrm{CO}_2$ 的化学势为：\n$$\\mu_{\\text{CO}_2, \\text{mix}} = \\mu_{\\text{CO}_2}^{0}(T) + RT \\ln\\left(\\frac{xP}{p^{0}}\\right)$$\n\n在最终状态，我们有一摩尔在温度 $T$ 和压力 $P$ 下的纯 $\\mathrm{CO}_2$。其分压就是总压力 $P$。\n纯 $\\mathrm{CO}_2$ 的化学势为：\n$$\\mu_{\\text{CO}_2, \\text{pure}} = \\mu_{\\text{CO}_2}^{0}(T) + RT \\ln\\left(\\frac{P}{p^{0}}\\right)$$\n\n现在，我们可以通过将这些表达式代入我们的 $\\Delta G$ 方程来计算每摩尔的最小功 $W_{\\min}$：\n$$W_{\\min} = \\left[ \\mu_{\\text{CO}_2}^{0}(T) + RT \\ln\\left(\\frac{P}{p^{0}}\\right) \\right] - \\left[ \\mu_{\\text{CO}_2}^{0}(T) + RT \\ln\\left(\\frac{xP}{p^{0}}\\right) \\right]$$\n标准化学势项 $\\mu_{\\text{CO}_2}^{0}(T)$ 相互抵消：\n$$W_{\\min} = RT \\ln\\left(\\frac{P}{p^{0}}\\right) - RT \\ln\\left(\\frac{xP}{p^{0}}\\right)$$\n使用对数性质 $\\ln(a) - \\ln(b) = \\ln(a/b)$，我们得到：\n$$W_{\\min} = RT \\ln\\left( \\frac{P/p^{0}}{xP/p^{0}} \\right) = RT \\ln\\left(\\frac{1}{x}\\right)$$\n这也可以写成：\n$$W_{\\min} = -RT \\ln(x)$$\n这个表达式给出了在摩尔分数为 $x$ 时，从空气中分离一摩尔 $\\mathrm{CO}_2$ 所需的理论最小功。\n\n接下来，我们使用所提供的数据对这个表达式进行数值计算：\n$\\mathrm{CO}_2$ 的摩尔分数：$x = 4.20 \\times 10^{-4}$\n温度：$T = 298 \\, \\mathrm{K}$\n通用气体常数：$R = 8.314 \\, \\mathrm{J\\,mol^{-1}\\,K^{-1}}$\n\n将这些值代入推导出的 $W_{\\min}$ 方程：\n$$W_{\\min} = - (8.314 \\, \\mathrm{J\\,mol^{-1}\\,K^{-1}}) \\times (298 \\, \\mathrm{K}) \\times \\ln(4.20 \\times 10^{-4})$$\n首先，我们计算各项：\n$$R \\times T = 8.314 \\times 298 = 2477.572 \\, \\mathrm{J\\,mol^{-1}}$$\n$$\\ln(4.20 \\times 10^{-4}) \\approx -7.77536$$\n现在，我们计算 $W_{\\min}$：\n$$W_{\\min} = - (2477.572 \\, \\mathrm{J\\,mol^{-1}}) \\times (-7.77536) \\approx 19264.44 \\, \\mathrm{J\\,mol^{-1}}$$\n为了便于与实际能量进行比较，我们将其转换为 $\\mathrm{kJ\\,mol^{-1}}$：\n$$W_{\\min} \\approx 19.26444 \\, \\mathrm{kJ\\,mol^{-1}}$$\n\n问题提供了代表性的直接空气捕获（DAC）过程的实际比能量：\n$$E_{\\mathrm{practical}} = 3.00 \\times 10^{2} \\, \\mathrm{kJ\\,mol^{-1}} = 300 \\, \\mathrm{kJ\\,mol^{-1}}$$\n\n最后的任务是计算无量纲比率 $E_{\\mathrm{practical}}/W_{\\min}$：\n$$\\frac{E_{\\mathrm{practical}}}{W_{\\min}} = \\frac{300 \\, \\mathrm{kJ\\,mol^{-1}}}{19.26444 \\, \\mathrm{kJ\\,mol^{-1}}} \\approx 15.5724$$\n\n问题要求最终答案四舍五入到三位有效数字。输入值 $x$、$T$ 和 $E_{\\mathrm{practical}}$ 均给出三位有效数字，这限制了我们结果的精度。\n将比率 $15.5724$ 四舍五入到三位有效数字得到 $15.6$。\n该比率代表了实际过程的热力学效率低下，表明在理想条件下，其实际消耗的能量大约是热力学定律要求的该分离过程理论最小能量的 $15.6$ 倍。",
            "answer": "$$\\boxed{15.6}$$"
        },
        {
            "introduction": "二氧化碳捕获之后，安全地长期封存是至关重要的一步。本练习  通过一个简化的模型来模拟地质封存库的动态过程，同时考虑了碳的注入和潜在的泄漏。通过求解这个过程的控制微分方程，我们将能更好地理解封存持久性的概念，并计算出封存库在平衡状态下所能容纳的最大碳量，这对评估CDR策略的长期有效性至关重要。",
            "id": "4021082",
            "problem": "在一个数值天气预报（NWP）和气候模拟框架的地球系统分量中，一项二氧化碳移除（CDR）技术将碳注入一个长期的地质储库。设储存的碳量为 $S(t)$，单位为 $\\mathrm{GtC}$，外部规定的注入速率为 $I(t)$，单位为 $\\mathrm{GtC}\\,\\mathrm{yr}^{-1}$。假设储存的泄漏可以很好地用一个一阶过程来描述，其速率常数为 $\\ell$，单位为 $\\mathrm{yr}^{-1}$，表示单位时间内泄漏的碳占储存总量的比例。从质量守恒出发，推导以 $I(t)$ 和 $\\ell$ 表示的 $S(t)$ 的控制微分方程。然后，对于在所有 $t \\ge 0$ 时恒定注入 $I(t)=I_{0}$ 且初始条件为 $S(0)=0$ 的情况，求解 $S(t)$ 的闭式解。假设 $t$ 的单位为年（$\\mathrm{yr}$）。将 $S(t)$ 的最终结果以单一闭式解析表达式的形式给出。不要计算任何数值，也不要在最终表达式中附加单位。",
            "solution": "该问题被验证为具有科学依据、提法恰当、客观且完整。已提供建立和求解控制微分方程所需的所有信息。\n\n推导从地质储库中储存的碳的质量守恒原理开始。储存的碳的变化率 $\\frac{dS(t)}{dt}$ 等于碳的注入速率减去碳的泄漏速率。\n\n注入速率由外部规定的函数 $I(t)$ 给出。\n\n泄漏被描述为一个一阶过程。这意味着泄漏速率与当前储存的碳量 $S(t)$ 成正比。比例常数是泄漏速率常数 $\\ell$。因此，泄漏速率为 $\\ell S(t)$。\n\n综合这些项，质量平衡方程为：\n$$\n\\frac{dS(t)}{dt} = \\text{Rate of Injection} - \\text{Rate of Leakage}\n$$\n代入给定的表达式，我们得到 $S(t)$ 的控制微分方程：\n$$\n\\frac{dS(t)}{dt} = I(t) - \\ell S(t)\n$$\n这是一个一阶线性常微分方程。\n\n问题接着指定了一个特例：从时间 $t=0$ 开始，注入速率恒为 $I(t) = I_{0}$，且初始时储库中没有碳，这对应于初始条件 $S(0) = 0$。对于 $t \\ge 0$，微分方程变为：\n$$\n\\frac{dS(t)}{dt} = I_{0} - \\ell S(t)\n$$\n这个方程可以重写为一阶线性常微分方程（ODE）的标准形式：\n$$\n\\frac{dS(t)}{dt} + \\ell S(t) = I_{0}\n$$\n为了解这个方程，我们使用积分因子法，积分因子为 $\\mu(t)$。积分因子由下式给出：\n$$\n\\mu(t) = \\exp\\left(\\int \\ell \\, dt\\right) = \\exp(\\ell t)\n$$\n将整个微分方程乘以 $\\mu(t)$：\n$$\n\\exp(\\ell t) \\frac{dS(t)}{dt} + \\ell \\exp(\\ell t) S(t) = I_{0} \\exp(\\ell t)\n$$\n根据微分的乘法法则，该方程的左边是乘积 $S(t)\\mu(t)$ 的导数：\n$$\n\\frac{d}{dt}\\left[ S(t) \\exp(\\ell t) \\right] = I_{0} \\exp(\\ell t)\n$$\n为了求得 $S(t)$，我们对等式两边关于时间 $t$ 进行积分：\n$$\n\\int \\frac{d}{dt}\\left[ S(t) \\exp(\\ell t) \\right] dt = \\int I_{0} \\exp(\\ell t) dt\n$$\n$$\nS(t) \\exp(\\ell t) = I_{0} \\int \\exp(\\ell t) dt\n$$\n对右边进行积分得到：\n$$\nS(t) \\exp(\\ell t) = \\frac{I_{0}}{\\ell} \\exp(\\ell t) + C\n$$\n其中 $C$ 是积分常数。\n\n为了求得 $S(t)$ 的显式解，我们两边除以 $\\exp(\\ell t)$：\n$$\nS(t) = \\frac{I_{0}}{\\ell} + C \\exp(-\\ell t)\n$$\n这是该微分方程的通解。现在我们应用初始条件 $S(0) = 0$ 来确定常数 $C$ 的值。\n$$\nS(0) = \\frac{I_{0}}{\\ell} + C \\exp(-\\ell \\cdot 0) = \\frac{I_{0}}{\\ell} + C \\exp(0) = \\frac{I_{0}}{\\ell} + C\n$$\n令其等于 $0$：\n$$\n0 = \\frac{I_{0}}{\\ell} + C \\implies C = -\\frac{I_{0}}{\\ell}\n$$\n将 $C$ 的值代回通解，得到 $S(t)$ 的特解：\n$$\nS(t) = \\frac{I_{0}}{\\ell} - \\frac{I_{0}}{\\ell} \\exp(-\\ell t)\n$$\n提出公因子 $\\frac{I_{0}}{\\ell}$，我们得到储存的碳量随时间变化的最终闭式表达式：\n$$\nS(t) = \\frac{I_{0}}{\\ell} \\left(1 - \\exp(-\\ell t)\\right)\n$$\n该表达式表明，储存的碳量从 $0$ 开始增加，并随着 $t \\to \\infty$ 渐近地接近稳态值 $\\frac{I_{0}}{\\ell}$。当泄漏速率 $\\ell S$ 等于恒定的注入速率 $I_{0}$ 时，达到稳态。",
            "answer": "$$\n\\boxed{\\frac{I_{0}}{\\ell} \\left(1 - \\exp(-\\ell t)\\right)}\n$$"
        },
        {
            "introduction": "对于任何可信的CDR策略而言，监测、报告和核查（MRV）都不可或缺。本实践练习  介绍了一种核心计算技术——贝叶斯反演，用以从大气观测数据中推断CDR项目实际移除的二氧化碳量。通过这个动手实践，我们将学习气候建模者和数据科学家如何利用实际数据来量化CDR的性能并减少其不确定性。",
            "id": "4021102",
            "problem": "考虑一个假设的直接空气捕获（DAC）集群，它由一个状态向量 $\\mathbf{x} \\in \\mathbb{R}^n$ 中收集的 $n$ 个未知的稳态清除通量表示，单位为百万吨二氧化碳/年 (Mt CO$_2$ yr$^{-1}$)。在 $m$ 个传感器处收集二氧化碳浓度异常的合成大气观测数据，并汇编成 $\\mathbf{y} \\in \\mathbb{R}^m$，单位为百万分之几 (ppm)。从通量到观测的正向映射是线性的，$\\mathbf{y} = \\mathbf{H}\\mathbf{x} + \\mathbf{e}$，其中 $\\mathbf{H} \\in \\mathbb{R}^{m \\times n}$ 是观测算子（单位为 ppm / (Mt CO$_2$ yr$^{-1}$)），而 $\\mathbf{e}$ 是观测误差。假设一个高斯先验 $\\mathbf{x} \\sim \\mathcal{N}(\\mathbf{x}_b, \\mathbf{B})$，其中先验均值为 $\\mathbf{x}_b \\in \\mathbb{R}^n$ (Mt CO$_2$ yr$^{-1}$)，先验协方差为 $\\mathbf{B} \\in \\mathbb{R}^{n \\times n}$ (Mt CO$_2$ yr$^{-2}$)。假设误差模型是高斯的，$\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R})$，其中 $\\mathbf{R} \\in \\mathbb{R}^{m \\times m}$ 是观测误差协方差 (ppm$^2$)。\n\n从 Bayes 定理和线性高斯模型假设出发，推导在给定 $\\mathbf{y}$ 的情况下 $\\mathbf{x}$ 的后验均值 $\\mathbf{x}_a$ 和后验协方差 $\\mathbf{A}$ 的表达式。实现一个数值稳定的算法，使用不显式求逆矩阵的标准线性代数运算来计算 $\\mathbf{x}_a$ 和边际后验标准差 $\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$。\n\n下面的测试套件指定了四个科学上合理的场景，所有场景均包含 $n = 3$ 个通量和 $m = 4$ 个传感器。在每个场景中，先验协方差 $\\mathbf{B}$ 由下三角矩阵 $\\mathbf{L}$ 通过 $\\mathbf{B} = \\mathbf{L}\\mathbf{L}^\\top$ 构建，以保证对称性和正定性。合成观测数据是使用一个固定的“真实”通量向量 $\\mathbf{x}_{\\text{true}}$ 和一个固定的观测误差实现 $\\boldsymbol{\\epsilon}$ 生成的，即 $\\mathbf{y} = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}$。\n\n对所有场景使用以下通用参数：\n- 通量数量：$n = 3$。\n- 传感器数量：$m = 4$。\n- 先验均值：$\\mathbf{x}_b = [\\,0.6,\\,0.5,\\,0.7\\,]$ Mt CO$_2$ yr$^{-1}$。\n- 真实通量：$\\mathbf{x}_{\\text{true}} = [\\,0.8,\\,0.4,\\,0.9\\,]$ Mt CO$_2$ yr$^{-1}$。\n- 观测算子：\n$$\n\\mathbf{H} =\n\\begin{bmatrix}\n0.9  0.1  0.0 \\\\\n0.2  0.6  0.1 \\\\\n0.1  0.2  0.8 \\\\\n0.5  0.3  0.2\n\\end{bmatrix}\n\\quad \\text{(ppm / (Mt CO$_2$ yr$^{-1}$))}.\n$$\n- 先验协方差因子：\n$$\n\\mathbf{L} =\n\\begin{bmatrix}\n0.25  0.00  0.00 \\\\\n0.05  0.20  0.00 \\\\\n0.00  0.04  0.30\n\\end{bmatrix},\n\\quad \\mathbf{B} = \\mathbf{L}\\mathbf{L}^\\top\n\\quad \\text{(Mt CO$_2$ yr$^{-2}$)}.\n$$\n\n定义四个场景如下：\n\n1. 场景1（中等噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_1 = \\mathrm{diag}\\left(\\,0.04,\\,0.03,\\,0.05,\\,0.02\\,\\right)\n   \\quad \\text{(ppm$^2$)}.\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_1 = [\\,0.02,\\,-0.01,\\,0.03,\\,-0.02\\,] \\quad \\text{(ppm)}.\n   $$\n   - 观测：\n   $$\n   \\mathbf{y}_1 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_1.\n   $$\n\n2. 场景2（高噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_2 = \\mathrm{diag}\\left(\\,0.4,\\,0.3,\\,0.5,\\,0.2\\,\\right)\n   \\quad \\text{(ppm$^2$)}.\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_2 = [\\,0.2,\\,-0.1,\\,0.15,\\,-0.05\\,] \\quad \\text{(ppm)}.\n   $$\n   - 观测：\n   $$\n   \\mathbf{y}_2 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_2.\n   $$\n\n3. 场景3（低噪声，对角 $\\mathbf{R}$）：\n   - 观测协方差：\n   $$\n   \\mathbf{R}_3 = \\mathrm{diag}\\left(\\,0.0025,\\,0.0025,\\,0.0025,\\,0.0025\\,\\right)\n   \\quad \\text{(ppm$^2$)}.\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_3 = [\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,] \\quad \\text{(ppm)}.\n   $$\n   - 观测：\n   $$\n   \\mathbf{y}_3 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_3.\n   $$\n\n4. 场景4（相关误差，非对角 $\\mathbf{R}$）：\n   - 标准差：\n   $$\n   \\mathbf{s} = [\\,0.15,\\,0.10,\\,0.20,\\,0.12\\,] \\quad \\text{(ppm)}.\n   $$\n   - 相关矩阵：\n   $$\n   \\mathbf{C} =\n   \\begin{bmatrix}\n   1  0.3  0.1  0.0 \\\\\n   0.3  1  0.25  0.1 \\\\\n   0.1  0.25  1  0.2 \\\\\n   0.0  0.1  0.2  1\n   \\end{bmatrix}.\n   $$\n   - 观测协方差：\n   $$\n   \\mathbf{R}_4 = \\mathrm{diag}(\\mathbf{s})\\,\\mathbf{C}\\,\\mathrm{diag}(\\mathbf{s})\n   \\quad \\text{(ppm$^2$)}.\n   $$\n   - 误差实现：\n   $$\n   \\boldsymbol{\\epsilon}_4 = [\\,0.05,\\,-0.02,\\,0.00,\\,0.01\\,] \\quad \\text{(ppm)}.\n   $$\n   - 观测：\n   $$\n   \\mathbf{y}_4 = \\mathbf{H}\\mathbf{x}_{\\text{true}} + \\boldsymbol{\\epsilon}_4.\n   $$\n\n要求：\n- 在指定的线性高斯假设下，从第一性原理出发，使用 Bayes 定理推导后验均值 $\\mathbf{x}_a$ 和后验协方差 $\\mathbf{A}$。\n- 实现一个算法，该算法不显式求逆任何矩阵，即可计算 $\\mathbf{x}_a$ 和 $\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$。对对称正定系统使用数值稳定的求解方法（例如，Cholesky 分解）。\n- 对于每个场景，返回后验均值和边际后验标准差，单位为 Mt CO$_2$ yr$^{-1}$。\n- 所有返回的通量值和不确定性均以 Mt CO$_2$ yr$^{-1}$ 表示，并四舍五入到六位小数。\n\n最终输出格式：\n- 你的程序应生成一行输出，其中包含一个逗号分隔的列表，用方括号括起来，不含空格。每个场景的结果必须是一对列表：第一个列表是后验均值向量 $\\mathbf{x}_a$，第二个列表是后验标准差向量 $\\boldsymbol{\\sigma}_a$。例如，单个场景的结果应形如 $[[x_1,x_2,x_3],[s_1,s_2,s_3]]$，其中每个数字都保留六位小数。最终输出按顺序将所有四个场景聚合为一个列表：$[[[x_1,x_2,x_3],[s_1,s_2,s_3]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]],[[\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot]]]$。\n\n测试套件和答案规范：\n- 程序必须计算上述四个场景的结果。\n- 输出必须是包含上述聚合列表的单行。\n- 输出中的每个数字必须是四舍五入到六位小数的浮点数。",
            "solution": "该问题要求推导并实现一种贝叶斯线性反演方法，用于从合成大气观测数据中估计二氧化碳清除通量。\n\n### 1. 理论推导\n\n问题在于求给定观测向量 $\\mathbf{y} \\in \\mathbb{R}^m$ 时状态向量 $\\mathbf{x} \\in \\mathbb{R}^n$ 的后验概率分布，记作 $p(\\mathbf{x}|\\mathbf{y})$。Bayes 定理表述为：\n$$\np(\\mathbf{x}|\\mathbf{y}) = \\frac{p(\\mathbf{y}|\\mathbf{x}) p(\\mathbf{x})}{p(\\mathbf{y})} \\propto p(\\mathbf{y}|\\mathbf{x}) p(\\mathbf{x})\n$$\n其中 $p(\\mathbf{y}|\\mathbf{x})$ 是似然， $p(\\mathbf{x})$ 是先验，$p(\\mathbf{y})$ 是归一化常数（证据）。\n\n该问题定义了一个线性高斯模型。通量向量 $\\mathbf{x}$ 的先验分布是一个多元高斯分布：\n$$\np(\\mathbf{x}) = \\mathcal{N}(\\mathbf{x}_b, \\mathbf{B}) \\propto \\exp\\left(-\\frac{1}{2}(\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b)\\right)\n$$\n其中 $\\mathbf{x}_b$ 是先验均值，$\\mathbf{B}$ 是先验协方差矩阵。\n\n将状态 $\\mathbf{x}$ 与观测 $\\mathbf{y}$ 相关联的正向模型是线性的：\n$$\n\\mathbf{y} = \\mathbf{H}\\mathbf{x} + \\mathbf{e}\n$$\n观测误差 $\\mathbf{e}$ 被假定为一个零均值高斯随机变量，$\\mathbf{e} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{R})$，其中 $\\mathbf{R}$ 是观测误差协方差矩阵。这意味着在给定状态 $\\mathbf{x}$ 的情况下观测到 $\\mathbf{y}$ 的似然也是一个多元高斯分布：\n$$\np(\\mathbf{y}|\\mathbf{x}) = \\mathcal{N}(\\mathbf{H}\\mathbf{x}, \\mathbf{R}) \\propto \\exp\\left(-\\frac{1}{2}(\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x})\\right)\n$$\n将似然和先验代入 Bayes 定理，后验分布为：\n$$\np(\\mathbf{x}|\\mathbf{y}) \\propto \\exp\\left(-\\frac{1}{2}\\left[ (\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b) + (\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x}) \\right]\\right)\n$$\n指数中的表达式是 $\\mathbf{x}$ 的二次函数，这意味着后验分布也是一个高斯分布，$p(\\mathbf{x}|\\mathbf{y}) = \\mathcal{N}(\\mathbf{x}_a, \\mathbf{A})$。后验均值 $\\mathbf{x}_a$ 对应于使后验概率最大化的 $\\mathbf{x}$ 值，这等同于最小化负对数后验，通常称为成本函数 $J(\\mathbf{x})$：\n$$\nJ(\\mathbf{x}) = \\frac{1}{2}(\\mathbf{x} - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x} - \\mathbf{x}_b) + \\frac{1}{2}(\\mathbf{y} - \\mathbf{H}\\mathbf{x})^\\top \\mathbf{R}^{-1} (\\mathbf{y} - \\mathbf{H}\\mathbf{x})\n$$\n为求最小值，我们将 $J(\\mathbf{x})$ 对 $\\mathbf{x}$ 的梯度设为零：\n$$\n\\nabla_{\\mathbf{x}} J(\\mathbf{x}) = \\mathbf{B}^{-1}(\\mathbf{x} - \\mathbf{x}_b) - \\mathbf{H}^\\top \\mathbf{R}^{-1}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}) = \\mathbf{0}\n$$\n重新整理各项以求解 $\\mathbf{x}$，得到后验均值 $\\mathbf{x}_a$：\n$$\n\\mathbf{B}^{-1}\\mathbf{x}_a - \\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H}\\mathbf{x}_a - \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y} = \\mathbf{0}\n$$\n$$\n(\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})\\mathbf{x}_a = \\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y}\n$$\n项 $(\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})$ 是后验协方差矩阵的逆，也称为成本函数的 Hessian 矩阵。因此，后验协方差 $\\mathbf{A}$ 为：\n$$\n\\mathbf{A} = (\\mathbf{B}^{-1} + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{H})^{-1}\n$$\n后验均值为：\n$$\n\\mathbf{x}_a = \\mathbf{A}(\\mathbf{B}^{-1}\\mathbf{x}_b + \\mathbf{H}^\\top \\mathbf{R}^{-1}\\mathbf{y})\n$$\n这些表达式需要显式地进行矩阵求逆（$\\mathbf{B}^{-1}$、$\\mathbf{R}^{-1}$ 和 Hessian 矩阵），这在数值上可能不稳定。\n\n### 2. 数值稳定的算法设计\n\n为避免显式求逆，我们可以重构这些表达式。使用 Woodbury 矩阵恒等式，后验协方差 $\\mathbf{A}$ 可以重写为：\n$$\n\\mathbf{A} = \\mathbf{B} - \\mathbf{B}\\mathbf{H}^\\top (\\mathbf{R} + \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top)^{-1} \\mathbf{H}\\mathbf{B}\n$$\n这种形式仍然涉及求逆，但求逆的是一个更小的 $m \\times m$ 矩阵 $(\\mathbf{R} + \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top)$，而不是 $n \\times n$ 的 Hessian 矩阵。当 $m \\ll n$ 时，这尤其有利。更重要的是，这导出了卡尔曼增益（Kalman gain）的公式。\n\n我们定义增益矩阵 $\\mathbf{K}$ 为：\n$$\n\\mathbf{K} = \\mathbf{B}\\mathbf{H}^\\top (\\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R})^{-1}\n$$\n后验均值 $\\mathbf{x}_a$ 随后可以表示为对先验均值的更新：\n$$\n\\mathbf{x}_a = \\mathbf{x}_b + \\mathbf{K}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}_b)\n$$\n后验协方差 $\\mathbf{A}$ 可以简化为：\n$$\n\\mathbf{A} = (\\mathbf{I} - \\mathbf{K}\\mathbf{H})\\mathbf{B}\n$$\n其中 $\\mathbf{I}$ 是 $n \\times n$ 的单位矩阵。这个公式在数据同化和滤波理论中是标准的。\n\n增益矩阵 $\\mathbf{K}$ 的计算涉及项 $(\\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R})^{-1}$。我们定义新息协方差矩阵 $\\mathbf{S} = \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R}$。增益矩阵变为 $\\mathbf{K} = \\mathbf{B}\\mathbf{H}^\\top\\mathbf{S}^{-1}$。与其对 $\\mathbf{S}$ 求逆，我们可以求解一个线性方程组。为了求 $\\mathbf{K}$，我们求解：\n$$\n\\mathbf{K}\\mathbf{S} = \\mathbf{B}\\mathbf{H}^\\top \\implies \\mathbf{S}^\\top \\mathbf{K}^\\top = (\\mathbf{B}\\mathbf{H}^\\top)^\\top\n$$\n由于 $\\mathbf{B}$ 和 $\\mathbf{R}$ 是对称正定（SPD）的，$\\mathbf{S}$ 也是对称正定的，因此 $\\mathbf{S}^\\top = \\mathbf{S}$。求解 $\\mathbf{K}^\\top$ 的方程组是：\n$$\n\\mathbf{S} \\mathbf{K}^\\top = \\mathbf{H}\\mathbf{B}\n$$\n这是一个形式为 $\\mathbf{A}_{\\text{sys}}\\mathbf{X}_{\\text{sys}}=\\mathbf{B}_{\\text{sys}}$ 的标准线性矩阵方程，其中 $\\mathbf{A}_{\\text{sys}}=\\mathbf{S}$，$\\mathbf{X}_{\\text{sys}}=\\mathbf{K}^\\top$，且 $\\mathbf{B}_{\\text{sys}}=\\mathbf{H}\\mathbf{B}$。由于 $\\mathbf{S}$ 是对称正定的，这个系统可以使用 Cholesky 分解法高效且稳定地求解。\n\n由此产生的算法流程如下：\n1.  给定一个场景的输入（$\\mathbf{x}_b, \\mathbf{B}, \\mathbf{H}, \\mathbf{y}, \\mathbf{R}$）。\n2.  计算新息协方差矩阵：$\\mathbf{S} = \\mathbf{H}\\mathbf{B}\\mathbf{H}^\\top + \\mathbf{R}$。\n3.  对 $\\mathbf{S}$ 进行 Cholesky 分解 $\\mathbf{S} = \\mathbf{C}\\mathbf{C}^\\top$，其中 $\\mathbf{C}$ 是一个下三角矩阵。\n4.  使用 Cholesky 因子 $\\mathbf{C}$（例如，通过 `cho_solve`）求解系统 $\\mathbf{S}\\mathbf{K}^\\top = \\mathbf{H}\\mathbf{B}$ 以得到 $\\mathbf{K}^\\top$，这涉及前向和后向代换。然后求得 $\\mathbf{K}$。\n5.  计算后验均值：$\\mathbf{x}_a = \\mathbf{x}_b + \\mathbf{K}(\\mathbf{y} - \\mathbf{H}\\mathbf{x}_b)$。\n6.  计算后验协方差：$\\mathbf{A} = (\\mathbf{I} - \\mathbf{K}\\mathbf{H})\\mathbf{B}$。\n7.  提取边际后验标准差：$\\boldsymbol{\\sigma}_a = \\sqrt{\\mathrm{diag}(\\mathbf{A})}$。在开方前，通过取对角线元素与零的最大值来处理由浮点误差引起的潜在的微小负对角线项。\n\n该算法在不进行任何显式矩阵求逆的情况下计算所需量，满足了问题的要求。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import cholesky, cho_solve\n\ndef solve():\n    \"\"\"\n    Computes the posterior mean and standard deviation for four scenarios\n    of a Bayesian linear inversion problem for CO2 flux estimation.\n    \"\"\"\n    # Common parameters for all scenarios\n    n = 3\n    x_b = np.array([0.6, 0.5, 0.7])  # Prior mean (Mt CO2/yr)\n    x_true = np.array([0.8, 0.4, 0.9])  # True flux (Mt CO2/yr)\n    H = np.array([\n        [0.9, 0.1, 0.0],\n        [0.2, 0.6, 0.1],\n        [0.1, 0.2, 0.8],\n        [0.5, 0.3, 0.2]\n    ])  # Observation operator (ppm / (Mt CO2/yr))\n\n    L_B = np.array([\n        [0.25, 0.00, 0.00],\n        [0.05, 0.20, 0.00],\n        [0.00, 0.04, 0.30]\n    ])\n    B = L_B @ L_B.T  # Prior covariance ((Mt CO2/yr)^2)\n\n    # Scenarios definition\n    scenarios = [\n        {\n            \"R\": np.diag([0.04, 0.03, 0.05, 0.02]),\n            \"epsilon\": np.array([0.02, -0.01, 0.03, -0.02])\n        },\n        {\n            \"R\": np.diag([0.4, 0.3, 0.5, 0.2]),\n            \"epsilon\": np.array([0.2, -0.1, 0.15, -0.05])\n        },\n        {\n            \"R\": np.diag([0.0025, 0.0025, 0.0025, 0.0025]),\n            \"epsilon\": np.array([0.0, 0.0, 0.0, 0.0])\n        },\n        {\n            \"s_R\": np.array([0.15, 0.10, 0.20, 0.12]),\n            \"C_R\": np.array([\n                [1.0, 0.3, 0.1, 0.0],\n                [0.3, 1.0, 0.25, 0.1],\n                [0.1, 0.25, 1.0, 0.2],\n                [0.0, 0.1, 0.2, 1.0]\n            ]),\n            \"epsilon\": np.array([0.05, -0.02, 0.00, 0.01]),\n            \"is_correlated\": True\n        }\n    ]\n\n    results = []\n\n    # Pre-compute fixed components for efficiency\n    H_x_true = H @ x_true\n    H_x_b = H @ x_b\n    H_B = H @ B\n    HBH_T = H_B @ H.T\n    I_n = np.identity(n)\n\n    for i, scen in enumerate(scenarios):\n        if scen.get(\"is_correlated\"):\n            R = np.diag(scen[\"s_R\"]) @ scen[\"C_R\"] @ np.diag(scen[\"s_R\"])\n        else:\n            R = scen[\"R\"]\n        \n        epsilon = scen[\"epsilon\"]\n        y = H_x_true + epsilon\n\n        # 1. Innovation covariance\n        S = HBH_T + R\n\n        # 2. Solve for Kalman Gain K without explicit inversion\n        # System to solve: S * K.T = H * B\n        # Since S is symmetric positive definite, use Cholesky factorization\n        try:\n            C = cholesky(S, lower=True)\n            K_T = cho_solve((C, True), H_B)\n            K = K_T.T\n        except np.linalg.LinAlgError:\n            # Fallback to standard solver if Cholesky fails, though unlikely here\n            K_T = np.linalg.solve(S, H_B)\n            K = K_T.T\n\n        # 3. Compute posterior mean (analysis)\n        innovation = y - H_x_b\n        x_a = x_b + K @ innovation\n\n        # 4. Compute posterior covariance\n        A = (I_n - K @ H) @ B\n\n        # 5. Extract marginal posterior standard deviations\n        # Use np.maximum to prevent sqrt of small negative numbers from floating point error\n        sigma_a = np.sqrt(np.maximum(0, np.diag(A)))\n\n        # 6. Format and store results\n        xa_str = f\"[{','.join([f'{val:.6f}' for val in x_a])}]\"\n        sigma_a_str = f\"[{','.join([f'{val:.6f}' for val in sigma_a])}]\"\n        results.append(f\"[{xa_str},{sigma_a_str}]\")\n\n    # Print a single line with all results\n    print(f\"[[{','.join(results)}]]\")\n\nsolve()\n```"
        }
    ]
}