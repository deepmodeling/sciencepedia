{
    "hands_on_practices": [
        {
            "introduction": "A core challenge in designing an efficient Adaptive Mesh Refinement (AMR) strategy is determining the necessary level of refinement to capture specific physical phenomena. This exercise provides a foundational link between a crucial physical scale in atmospheric dynamics—the Rossby deformation radius, $L_d$—and the discrete parameters of an AMR grid hierarchy. By working through this problem, you will derive a formula to calculate the minimum number of refinement levels needed to adequately resolve balanced mesoscale motions, a critical aspect of weather and climate modeling . This practice moves beyond arbitrary refinement, grounding numerical choices in physical requirements.",
            "id": "4009014",
            "problem": "In a horizontally adaptive mesh refinement strategy for a primitive-equation atmosphere model used in numerical weather prediction and climate modeling, the base horizontal grid spacing is $\\Delta x_0$. Each refinement level is applied isotropically with a constant refinement ratio $r$, where $r>1$ is a fixed number that reduces the grid spacing by a factor of $r$ at each level. The finest-grid spacing after $L$ refinement levels is therefore denoted $\\Delta x_{\\min}$.\n\nTo adequately represent balanced mesoscale dynamics, the mesh must resolve the Rossby deformation radius, which for a continuously stratified fluid is approximated here as $L_d = N H / f$, where $N>0$ is the buoyancy frequency, $H>0$ is a representative vertical scale of stratification, and $f>0$ is the Coriolis parameter. The resolution criterion is that the deformation radius be resolved by at least $n$ points on the finest mesh, with $n \\ge 1$, meaning that $L_d / \\Delta x_{\\min} \\ge n$.\n\nAssuming $\\Delta x_0>0$, $r>1$, $N>0$, $H>0$, $f>0$, and $n \\ge 1$, and that the number of refinement levels $L$ must be a nonnegative integer, derive from first principles the minimum number of refinement levels required to satisfy the resolution criterion. Express your final answer as a single closed-form analytical expression in terms of $N$, $H$, $f$, $\\Delta x_0$, $r$, and $n$. Do not include units in your final expression. If your result involves any rounding to an integer number of levels, express this using an appropriate mathematical function rather than specifying a numerical rounding rule.",
            "solution": "We begin from the definition of the Rossby deformation radius for a continuously stratified fluid, approximated as $L_d = N H / f$, where $N>0$ is the buoyancy frequency, $H>0$ is a vertical scale, and $f>0$ is the Coriolis parameter. The adaptive mesh refinement strategy with a geometric refinement ratio $r>1$ implies that after $L$ levels of refinement, the finest-grid spacing is\n$$\n\\Delta x_{\\min} = \\frac{\\Delta x_0}{r^{L}}.\n$$\nThe resolution requirement that the deformation radius be resolved by at least $n$ grid intervals on the finest mesh is\n$$\n\\frac{L_d}{\\Delta x_{\\min}} \\ge n.\n$$\nSubstituting $\\Delta x_{\\min} = \\Delta x_0 / r^{L}$ gives\n$$\n\\frac{L_d}{\\Delta x_0 / r^{L}} \\ge n \\quad \\Longrightarrow \\quad \\frac{L_d r^{L}}{\\Delta x_0} \\ge n.\n$$\nRearranging,\n$$\nr^{L} \\ge \\frac{n \\,\\Delta x_0}{L_d}.\n$$\nBecause $r>1$, the function $L \\mapsto r^{L}$ is strictly increasing. Taking the natural logarithm on both sides preserves the inequality direction and yields\n$$\nL \\,\\ln(r) \\ge \\ln\\!\\left(\\frac{n \\,\\Delta x_0}{L_d}\\right).\n$$\nDividing by $\\ln(r)>0$ gives\n$$\nL \\ge \\frac{\\ln\\!\\left(\\frac{n \\,\\Delta x_0}{L_d}\\right)}{\\ln(r)}.\n$$\nUsing $L_d = N H / f$, we obtain\n$$\n\\frac{n \\,\\Delta x_0}{L_d} = \\frac{n \\,\\Delta x_0}{N H / f} = \\frac{n \\, f \\,\\Delta x_0}{N H},\n$$\nso the inequality becomes\n$$\nL \\ge \\frac{\\ln\\!\\left(\\frac{n \\, f \\,\\Delta x_0}{N H}\\right)}{\\ln(r)}.\n$$\nSince $L$ must be a nonnegative integer number of refinement levels, the minimal $L$ that satisfies the inequality is the least integer greater than or equal to the right-hand side, but not less than $0$. This is expressed using the ceiling function $\\lceil \\cdot \\rceil$ and the maximum with $0$:\n$$\nL_{\\min} = \\max\\!\\left(0, \\left\\lceil \\frac{\\ln\\!\\left(\\frac{n \\, f \\,\\Delta x_0}{N H}\\right)}{\\ln(r)} \\right\\rceil \\right).\n$$\nThis expression ensures that if the base mesh already satisfies the criterion, i.e., if $n \\, f \\,\\Delta x_0 /(N H) \\le 1$, then $L_{\\min}=0$; otherwise, it returns the smallest integer number of refinement levels required.",
            "answer": "$$\\boxed{\\max\\!\\left(0,\\left\\lceil \\dfrac{\\ln\\!\\left(\\dfrac{n f \\Delta x_{0}}{N H}\\right)}{\\ln(r)} \\right\\rceil\\right)}$$"
        },
        {
            "introduction": "The principle of conservation is paramount in numerical simulations, ensuring that physical quantities like mass and energy are not artificially created or destroyed. This practice illuminates the critical role of flux correction, or \"refluxing,\" in maintaining conservation within an AMR framework. By analyzing a hypothetical scenario where refluxing is omitted, you will quantify the resulting mass conservation error and see how it accumulates over time . This exercise provides a rigorous, first-principles justification for why refluxing is an indispensable component of any conservative AMR algorithm for hyperbolic systems.",
            "id": "4008986",
            "problem": "Consider a one-dimensional two-level Adaptive Mesh Refinement (AMR) hierarchy with a single coarse–fine interface of face area $A$ and impermeable outer boundaries. Let $q(x,t)$ be a conserved scalar density satisfying the conservation law $\\partial q / \\partial t + \\partial F(q) / \\partial x = 0$. The hierarchy is advanced in time using the Finite Volume Method (FVM). The coarse level uses a time step $\\Delta t_{c}$, and the fine level subcycles with $r$ fine steps per coarse step, $\\Delta t_{f} = \\Delta t_{c} / r$. Denote by $F_{c}$ the coarse-level numerical flux through the coarse–fine interface over one coarse step, and by $\\bar{F}_{f}$ the fine-level numerical flux averaged over the same coarse time interval, defined by $\\bar{F}_{f} = \\frac{1}{\\Delta t_{c}} \\sum_{k=1}^{r} F_{f}^{(k)} \\Delta t_{f}$, where $F_{f}^{(k)}$ is the fine flux on substep $k$. In this test, suppose the coarse flux differs from the fine-level average by a constant offset per coarse step,\n$$\nF_{c} = \\bar{F}_{f} + \\delta,\n$$\nwhere $\\delta$ is independent of time step index. Assume no refluxing is applied; that is, the coarse update is not corrected by fine fluxes.\n\nLet $M_{0}$ denote the initial total mass summed over all cells at all levels, and let $M(n)$ denote the total mass after $n$ coarse steps of AMR advance without refluxing. Define the dimensionless cumulative mass error after $n$ coarse steps by\n$$\n\\epsilon(n) = \\frac{M(n) - M_{0}}{M_{0}}.\n$$\n\nStarting from conservation and the FVM flux-balance principle, derive an exact closed-form expression for $\\epsilon(n)$ in terms of $n$, $\\delta$, $A$, $\\Delta t_{c}$, and $M_{0}$ under the assumptions above. Your final answer must be a single analytic expression. Do not substitute numerical values. Do not include units in your final boxed expression. If you introduce any angles, express them in radians. Since the answer is purely symbolic, no rounding is required.",
            "solution": "According to the Finite Volume Method, the change in total mass $M$ in the domain is determined by the net flux through the external boundaries. Since the outer boundaries are impermeable, the total mass would be conserved in a perfectly conservative scheme. However, without refluxing, there is a mass conservation error at the coarse–fine interface.\n\nLet's quantify the mass error generated in a single coarse time step $\\Delta t_c$. The mass leaving the coarse domain at the interface (face area $A$) is $\\Delta M_{\\text{coarse, out}} = F_c A \\Delta t_c$. The mass entering the fine domain over the same time interval is the sum of mass transfers over $r$ fine substeps: $\\Delta M_{\\text{fine, in}} = \\sum_{k=1}^{r} F_f^{(k)} A \\Delta t_f$.\n\nThe net change in total system mass per coarse step, $\\Delta M_{\\text{step}}$, is the difference between what enters the fine grid and what leaves the coarse grid:\n$$\n\\Delta M_{\\text{step}} = \\Delta M_{\\text{fine, in}} - \\Delta M_{\\text{coarse, out}} = A \\sum_{k=1}^{r} F_f^{(k)} \\Delta t_f - F_c A \\Delta t_c\n$$\nUsing the definition of the time-averaged fine flux, $\\bar{F}_{f} = \\frac{1}{\\Delta t_{c}} \\sum_{k=1}^{r} F_{f}^{(k)} \\Delta t_{f}$, we can rewrite the sum as $\\sum_{k=1}^{r} F_{f}^{(k)} \\Delta t_{f} = \\bar{F}_f \\Delta t_c$. Substituting this gives:\n$$\n\\Delta M_{\\text{step}} = A \\bar{F}_f \\Delta t_c - F_c A \\Delta t_c = A \\Delta t_c (\\bar{F}_f - F_c)\n$$\nWe are given the flux mismatch relation $F_c = \\bar{F}_f + \\delta$, which means $\\bar{F}_f - F_c = -\\delta$. Therefore, the mass error per step is:\n$$\n\\Delta M_{\\text{step}} = A \\Delta t_c (-\\delta) = -\\delta A \\Delta t_c\n$$\nSince $\\delta$ is constant, this error accumulates linearly over time. After $n$ coarse steps, the total change in mass is:\n$$\nM(n) - M_0 = n \\cdot \\Delta M_{\\text{step}} = -n \\delta A \\Delta t_c\n$$\nThe dimensionless cumulative mass error $\\epsilon(n)$ is defined as $\\frac{M(n) - M_0}{M_0}$. Substituting our expression for the total mass change gives the final result:\n$$\n\\epsilon(n) = \\frac{-n \\delta A \\Delta t_c}{M_0}\n$$",
            "answer": "$$\\boxed{-\\frac{n \\delta A \\Delta t_{c}}{M_{0}}}$$"
        },
        {
            "introduction": "Implementing AMR with subcycling in time, where finer grids take smaller time steps than coarser grids, introduces significant algorithmic complexity. This practice focuses on the precise temporal choreography of a multi-level AMR simulation, requiring you to map out the sequence of operations for a three-level system. You will determine the exact moments for synchronization, data transfer between levels (prolongation and restriction), and flux correction (refluxing) . Mastering this temporal logic is essential for understanding the inner workings of high-performance AMR codes and for debugging issues related to inter-level communication.",
            "id": "4009024",
            "problem": "Consider a block-structured Adaptive Mesh Refinement (AMR) hierarchy for a finite-volume discretization of a hyperbolic conservation law, with levels $\\ell=0,1,2$. Assume subcycling in time with a constant refinement ratio $r=2$ between successive levels, and let the base (coarsest) time step be $\\Delta t_0$. The discretization is conservative and uses face fluxes integrated over each time step on each level. The stability requirement given by the Courant–Friedrichs–Lewy (CFL) condition enforces that the time step on a refined level is reduced sufficiently relative to coarser levels, and that each refined level performs $r$ substeps within the time interval of one parent-level step. All levels start at absolute time $t=0$, and the integration advances until the absolute time $t=3\\,\\Delta t_0$.\n\nYou are to reason from the above base and the discrete conservation structure to determine the temporal coordination of subcycling across the three levels. Specifically:\n- Compute the complete, ordered sequences of synchronization times within $[0,3\\,\\Delta t_0]$ during which level $\\ell=2$ is synchronized with level $\\ell=1$, level $\\ell=1$ is synchronized with level $\\ell=0$, and all three levels $\\ell=0,1,2$ are simultaneously synchronized.\n- Identify, by listing the corresponding absolute times within $[0,3\\,\\Delta t_0]$, when refluxing must occur. Refluxing is the flux correction operation applied at coarse–fine interfaces to enforce discrete conservation after the fine levels have completed enough substeps to reach the coarse level time.\n- Identify, by listing the corresponding absolute times within $[0,3\\,\\Delta t_0]$, when restriction (averaging-down of fine-level cell averages onto the next coarser level) must occur from level $\\ell=2$ to level $\\ell=1$ and from level $\\ell=1$ to level $\\ell=0$.\n- Identify, by listing the corresponding absolute times within $[0,3\\,\\Delta t_0]$, when prolongation (interpolation of coarse-level states into fine-level ghost cells to initialize and fill boundary data before fine-level advances) must occur for level $\\ell=1$ and for level $\\ell=2$, interpreted as the start times of each fine-level substep within $[0,3\\,\\Delta t_0]$.\n\nExpress all times symbolically in terms of $\\Delta t_0$. Provide your final answer as a single row matrix whose entries, in order, are the sets of times for:\n1. Level $\\ell=2$ synchronized with level $\\ell=1$,\n2. Level $\\ell=1$ synchronized with level $\\ell=0$,\n3. All levels $\\ell=0,1,2$ synchronized,\n4. Refluxing events,\n5. Restriction events from level $\\ell=2$ to level $\\ell=1$,\n6. Restriction events from level $\\ell=1$ to level $\\ell=0$,\n7. Prolongation events for level $\\ell=1$,\n8. Prolongation events for level $\\ell=2$.\n\nNo rounding is required. Express the final answer as exact symbolic sets in terms of $\\Delta t_0$ without units.",
            "solution": "We analyze the temporal coordination of the three-level AMR hierarchy ($\\ell=0, 1, 2$) with a refinement ratio $r=2$ and a base time step $\\Delta t_0$. The time step for each level is:\n- Level $\\ell=0$: $\\Delta t_0$\n- Level $\\ell=1$: $\\Delta t_1 = \\Delta t_0 / r = \\Delta t_0 / 2$\n- Level $\\ell=2$: $\\Delta t_2 = \\Delta t_1 / r = \\Delta t_0 / 4$\n\nThe simulation runs from $t=0$ to $t=3\\Delta t_0$. We determine the times for each required operation.\n\n**1. Synchronization Times (Level $\\ell=2$ with Level $\\ell=1$):**\nLevel $\\ell=2$ synchronizes with its parent $\\ell=1$ at the end of each $\\ell=1$ time step. These times are integer multiples of $\\Delta t_1 = \\Delta t_0/2$ within the interval $[0, 3\\Delta t_0]$.\nThe times are: $\\{0, \\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\}$.\n\n**2. Synchronization Times (Level $\\ell=1$ with Level $\\ell=0$):**\nLevel $\\ell=1$ synchronizes with its parent $\\ell=0$ at the end of each $\\ell=0$ time step. These times are integer multiples of $\\Delta t_0$ within the interval $[0, 3\\Delta t_0]$.\nThe times are: $\\{0, \\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\}$.\n\n**3. Synchronization Times (All Levels):**\nAll levels are synchronized when the synchronization times for both pairs of levels coincide. This is the intersection of the two sets above.\nThe times are: $\\{0, \\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\}$.\n\n**4. Refluxing Events:**\nRefluxing occurs at a coarse-fine interface after the fine level has completed its subcycles to reach the coarse level's time (for $t > 0$).\n- L2/L1 interface: Occurs at the end of each $\\ell=1$ step. Times are $\\{\\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\}$.\n- L1/L0 interface: Occurs at the end of each $\\ell=0$ step. Times are $\\{\\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\}$.\nThe problem asks for the set of all refluxing events, which is the union of these two sets.\nThe times are: $\\{\\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\}$.\n\n**5. Restriction Events (Level $\\ell=2 \\to \\ell=1$):**\nRestriction from a fine level to a coarse level occurs at synchronization points (for $t > 0$). For $\\ell=2 \\to \\ell=1$, this happens at the end of each $\\ell=1$ time step.\nThe times are: $\\{\\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\}$.\n\n**6. Restriction Events (Level $\\ell=1 \\to \\ell=0$):**\nFor $\\ell=1 \\to \\ell=0$, this happens at the end of each $\\ell=0$ time step (for $t > 0$).\nThe times are: $\\{\\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\}$.\n\n**7. Prolongation Events (for Level $\\ell=1$):**\nProlongation provides boundary data for a fine level at the beginning of each of its time steps. Level $\\ell=1$ advances in steps starting at times $k \\cdot \\Delta t_1 = k \\cdot (\\Delta t_0/2)$ for $k=0, 1, \\dots, 5$.\nThe times are: $\\{0, \\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0\\}$.\n\n**8. Prolongation Events (for Level $\\ell=2$):**\nLevel $\\ell=2$ advances in steps starting at times $k \\cdot \\Delta t_2 = k \\cdot (\\Delta t_0/4)$ for $k=0, 1, \\dots, 11$.\nThe times are: $\\{0, \\frac{1}{4}\\Delta t_0, \\frac{1}{2}\\Delta t_0, \\frac{3}{4}\\Delta t_0, \\Delta t_0, \\frac{5}{4}\\Delta t_0, \\frac{3}{2}\\Delta t_0, \\frac{7}{4}\\Delta t_0, 2\\Delta t_0, \\frac{9}{4}\\Delta t_0, \\frac{5}{2}\\Delta t_0, \\frac{11}{4}\\Delta t_0\\}$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\{0, \\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\} & \\{0, \\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\} & \\{0, \\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\} & \\{\\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\} & \\{\\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0, 3\\Delta t_0\\} & \\{\\Delta t_0, 2\\Delta t_0, 3\\Delta t_0\\} & \\{0, \\frac{1}{2}\\Delta t_0, \\Delta t_0, \\frac{3}{2}\\Delta t_0, 2\\Delta t_0, \\frac{5}{2}\\Delta t_0\\} & \\{0, \\frac{1}{4}\\Delta t_0, \\frac{1}{2}\\Delta t_0, \\frac{3}{4}\\Delta t_0, \\Delta t_0, \\frac{5}{4}\\Delta t_0, \\frac{3}{2}\\Delta t_0, \\frac{7}{4}\\Delta t_0, 2\\Delta t_0, \\frac{9}{4}\\Delta t_0, \\frac{5}{2}\\Delta t_0, \\frac{11}{4}\\Delta t_0\\} \\end{pmatrix}}$$"
        }
    ]
}