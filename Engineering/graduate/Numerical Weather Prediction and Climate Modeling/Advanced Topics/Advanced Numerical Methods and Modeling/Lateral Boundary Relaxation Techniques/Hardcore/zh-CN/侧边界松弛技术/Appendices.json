{
    "hands_on_practices": [
        {
            "introduction": "在实施任何边界松弛方案之前，我们必须首先理解*哪些*信息需要被控制。本练习将引导你深入分析欧拉方程的特征线，这是一个基础工具，用于确定哪些物理信号正在进入我们的模式区域，因而需要边界条件。通过计算给定流场下的入流特征变量数量 ，你将掌握在数值天气预报（NWP）模式中应用侧边界条件的理论基础。",
            "id": "4059587",
            "problem": "考虑理想气体的三维可压缩欧拉方程，该方程已在密度为$\\rho_{0}$、压力为$p_{0}$、速度为$\\mathbf{U}_{0}$的空间均匀平均态附近进行了线性化。声速为$c$，它通过$c^{2}=\\gamma p_{0}/\\rho_{0}$与热力学状态相关联，其中比热容比$\\gamma>1$。您正在为数值天气预报（NWP）建立一个有限区域模式，并且您将仅对进入该区域的特征变量施加侧边界松弛。\n\n关注一个垂直侧边界$\\Gamma$，它是一个单位外法向量为$\\mathbf{n}=(-1,0,0)$的平面（一个西边界）。均匀平均风为$\\mathbf{U}_{0}=(15,0,0)$ m s$^{-1}$，声速为$c=340$ m s$^{-1}$。使用线性双曲系统的第一性原理和特征分析，确定在$\\Gamma$处有多少个传入的特征变量，因此必须由侧边界方案指定或松弛。同时，用文字说明这些传入变量对应于哪些特征族。请给出您的最终答案，形式为一个整数（无单位）。不要四舍五入。",
            "solution": "该问题要求分析三维线性化可压缩欧拉方程在数值模式区域特定侧边界上的边界条件。必须指定的边界条件的数量等于对应于传播到计算域内的波的特征变量的数量。这通过分析系统在边界法线方向上的特征速度（特征值）的符号来确定。\n\n该方程组是三维可压缩欧拉方程，在以速度$\\mathbf{U}_{0}$、密度$\\rho_{0}$和压力$p_{0}$为特征的均匀平均态附近进行了线性化。声速为$c$。该系统中有五个方程，分别对应质量守恒、三个动量分量守恒和能量守恒。因此，对于任何给定的传播方向，都有五个特征变量和五个相关的特征速度。\n\n所讨论的边界$\\Gamma$是一个单位外法向量为$\\mathbf{n}=(-1,0,0)$的平面。这对应于标准笛卡尔坐标系$(x,y,z)$中的一个西边界。计算域位于此边界的东侧，即$x$增加的区域。因此，指向计算域*内部*的方向是$x$轴的正方向。如果一个特征波沿$x$轴正方向传播，则认为它在该边界是“传入”的。在$x$方向上传播的特征波的传播速度由欧拉方程的通量雅可比矩阵$\\mathbf{A}_x$在平均态下求得的特征值给出。\n\n对于三维欧拉方程，在平均态速度为$\\mathbf{U}_{0} = (U_0, V_0, W_0)$的情况下，沿$x$方向传播的波的特征速度由以下特征值集合给出：\n$$\n\\lambda_x \\in \\{U_0, U_0, U_0, U_0 - c, U_0 + c\\}\n$$\n这里，$U_0$是平均风在$x$方向上的分量，$c$是声速。特征值$U_0$的重数为三。\n\n问题提供了以下数值：\n- 平均风向量：$\\mathbf{U}_{0} = (15, 0, 0)$ m s$^{-1}$。这给出了平均速度的$x$分量为$U_0 = 15$ m s$^{-1}$。\n- 声速：$c = 340$ m s$^{-1}$。\n\n我们现在可以将这些值代入特征速度的表达式中：\n1.  三个特征值等于平流速度$U_0$：\n    $$ \\lambda_{1,2,3} = U_0 = 15 \\, \\text{m s}^{-1} $$\n2.  一个特征值对应于逆着流向传播的声波：\n    $$ \\lambda_4 = U_0 - c = 15 - 340 = -325 \\, \\text{m s}^{-1} $$\n3.  一个特征值对应于顺着流向传播的声波：\n    $$ \\lambda_5 = U_0 + c = 15 + 340 = 355 \\, \\text{m s}^{-1} $$\n\n传入特征变量的数量等于这些特征速度中为正值的数量，因为正速度表示沿$x$轴正方向传播，即进入计算域。让我们检查这些速度的符号：\n-   $\\lambda_{1,2,3} = 15 > 0$。这三个特征是传入的。\n-   $\\lambda_4 = -325 < 0$。这个特征是传出的。\n-   $\\lambda_5 = 355 > 0$。这个特征是传入的。\n\n通过计算正特征值的数量，我们发现有$3 + 1 = 4$个传入特征。因此，在这个西边界上必须指定$4$个边界条件。\n\n该问题还要求识别这些传入变量对应的特征族。\n-   速度为$\\lambda = U_0$的三个特征是平流模态。它们对应于平均流对熵和两个切向速度分量（$v'$和$w'$）的平流。由于$U_0 > 0$，平均流正在进入计算域，并携带这些信息。这些族是一个熵波和两个剪切波。\n-   速度为$\\lambda = U_0+c$的特征是一个声学模态（声波）。其正速度表示它传播进入计算域。\n-   速度为$\\lambda = U_0-c$的特征也是一个声学模态。其负速度表示它传播出计算域。\n\n总而言之，必须在边界上指定的四个传入特征对应于熵波、两个剪切波（切向速度分量）和两个声波中的一个。\n因此，传入特征的数量是$4$。",
            "answer": "$$\n\\boxed{4}\n$$"
        },
        {
            "introduction": "在我们的方程中加入一个松弛项会影响整个模式的数值稳定性。本练习将指导你完成冯·诺依曼稳定性分析，这是一项用于分析误差在数值格式中如何传播的核心技术。通过分析一个简化的平流-松弛方程 ，你将确定松弛系数的稳定范围，从而确保你的模式不会产生不切实际的爆炸性解。",
            "id": "4059554",
            "problem": "考虑一个带均匀侧边界松弛（海绵）项的一维线性输运方程，这是一个常用于表示区域数值天气预报（NWP）和区域气候模拟中侧边界松弛效应的简单模型：\n$$u_{t} + c\\,u_{x} = -\\alpha\\,u,$$\n其中 $u(x,t)$ 是一个标量预报变量，$c$ 是一个恒定的平流速度，$\\alpha \\ge 0$ 是一个恒定的松弛（nudging）系数。目标是评估一种在实践中常用的标准显式格式的冯·诺依曼（傅里叶）稳定性。在均匀网格 $x_{j} = j\\,\\Delta x$ 和时间层 $t^{n} = n\\,\\Delta t$ 上对该方程进行离散化，时间上采用前向欧拉法，空间上对平流项采用一阶迎风格式，松弛项采用显式离散：\n- 对于 $c > 0$ 的情况，使用如下更新格式\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}.$$\n- 对于 $c < 0$ 的情况，迎风格式的模板类似地反向。\n\n假设区域是无限或周期性的，以便应用傅里叶模态分析，并定义库朗数\n$$\\nu \\equiv \\frac{|c|\\,\\Delta t}{\\Delta x}.$$\n进行冯·诺依曼稳定性分析，并在在一阶迎风格式的标准平流稳定性条件 $0 \\le \\nu \\le 1$ 下，确定保证所有波数都稳定（任何离散傅里叶模态均不被放大）的无量纲松弛强度 $\\alpha\\,\\Delta t$ 的上确界，作为 $\\nu$ 的函数。请用一个关于 $\\nu$ 的闭式解析表达式来表示最终答案。无需四舍五入，最终表达式中不应包含任何单位。",
            "solution": "所述问题具有科学依据，是适定的、客观的，并包含足够的信息以获得唯一解。这是偏微分方程数值方法稳定性分析中的一个标准练习。因此，我们可以着手求解。\n\n该问题要求对带松弛项的一维线性输运方程的离散格式进行冯·诺依曼稳定性分析。控制偏微分方程为：\n$$u_{t} + c\\,u_{x} = -\\alpha\\,u$$\n其中 $u(x,t)$ 是预报变量，$c$ 是恒定平流速度，$\\alpha \\ge 0$ 是恒定松弛系数。\n\n我们首先分析平流速度 $c > 0$ 的情况。指定的离散格式为时间上采用前向欧拉法，空间上采用一阶迎风格式：\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j}^{n} - u_{j-1}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}$$\n这里，$u_{j}^{n}$ 是对 $u(j\\Delta x, n\\Delta t)$ 的近似。我们可以重新整理该方程来求解 $u_{j}^{n+1}$：\n$$u_{j}^{n+1} = u_{j}^{n} - c\\frac{\\Delta t}{\\Delta x}(u_{j}^{n} - u_{j-1}^{n}) - \\alpha\\Delta t\\,u_{j}^{n}$$\n合并包含 $u_{j}^{n}$ 和 $u_{j-1}^{n}$ 的项：\n$$u_{j}^{n+1} = \\left(1 - c\\frac{\\Delta t}{\\Delta x} - \\alpha\\Delta t\\right)u_{j}^{n} + \\left(c\\frac{\\Delta t}{\\Delta x}\\right)u_{j-1}^{n}$$\n问题中定义了库朗数 $\\nu \\equiv \\frac{|c|\\,\\Delta t}{\\Delta x}$。由于我们考虑的是 $c > 0$ 的情况，所以 $|c|=c$，因此 $\\nu = \\frac{c\\,\\Delta t}{\\Delta x}$。代入 $\\nu$ 和我们记为 $A = \\alpha\\Delta t$ 的无量纲松弛强度，方程变为：\n$$u_{j}^{n+1} = (1 - \\nu - A)u_{j}^{n} + \\nu u_{j-1}^{n}$$\n\n为了进行冯·诺依曼稳定性分析，我们考虑解的单个傅里叶模态，其形式为 $u_{j}^{n} = \\hat{u}^{n}(k)e^{i k x_j}$，其中 $k$ 是波数，$i = \\sqrt{-1}$，$x_j = j\\Delta x$。将此假设代入离散方程：\n$$\\hat{u}^{n+1}e^{i k j \\Delta x} = (1 - \\nu - A)\\hat{u}^{n}e^{i k j \\Delta x} + \\nu \\hat{u}^{n}e^{i k (j-1) \\Delta x}$$\n放大因子 $G(k)$ 定义为连续时间步长上傅里叶振幅之比，$G(k) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}}$。为了求得它，我们将整个方程除以 $\\hat{u}^{n}e^{i k j \\Delta x}$：\n$$G(k) = (1 - \\nu - A) + \\nu e^{-i k \\Delta x}$$\n令无量纲波数为 $\\theta = k\\Delta x$。放大因子作为 $\\theta$ 的函数为：\n$$G(\\theta) = (1 - \\nu - A) + \\nu (\\cos\\theta - i\\sin\\theta)$$\n$$G(\\theta) = (1 - \\nu - A + \\nu\\cos\\theta) - i(\\nu\\sin\\theta)$$\n为使数值格式稳定，对于任何可能的波数，放大因子的模都不能超过1，即对所有 $\\theta \\in [-\\pi, \\pi]$，$|G(\\theta)| \\le 1$。\n\n$G(\\theta)$ 的表达式在复平面上描述了一个圆。圆心位于实值点 $z_c = 1 - \\nu - A$，半径为 $R = \\nu$。为使格式稳定，整个圆必须位于以原点为中心的单位圆内部或其边界上。如果圆心位置的模与半径之和小于或等于1，则满足此条件：\n$$|z_c| + R \\le 1$$\n代入 $z_c$ 和 $R$ 的表达式：\n$$|1 - \\nu - A| + \\nu \\le 1$$\n由于 $\\nu \\ge 0$，我们可以将其整理为：\n$$|1 - \\nu - A| \\le 1 - \\nu$$\n问题指定了标准平流稳定性条件 $0 \\le \\nu \\le 1$ 成立。这确保了右侧的 $1-\\nu$ 是非负的。因此，我们可以将绝对值不等式解为：\n$$-(1 - \\nu) \\le 1 - \\nu - A \\le 1 - \\nu$$\n这为 $A = \\alpha\\Delta t$ 提供了两个独立的条件：\n1. 右侧不等式：$1 - \\nu - A \\le 1 - \\nu \\implies -A \\le 0 \\implies A \\ge 0$。这与给定条件 $\\alpha \\ge 0$ 一致。\n2. 左侧不等式：$-(1 - \\nu) \\le 1 - \\nu - A \\implies -1 + \\nu \\le 1 - \\nu - A \\implies A \\le 1 - \\nu + 1 - \\nu \\implies A \\le 2 - 2\\nu$。\n\n结合这两个条件，稳定性条件为 $0 \\le \\alpha\\Delta t \\le 2(1-\\nu)$。\n\n现在，我们考虑 $c < 0$ 的情况。迎风方向相反，因此空间导数使用点 $j$ 和 $j+1$ 进行近似：\n$$\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} + c\\,\\frac{u_{j+1}^{n} - u_{j}^{n}}{\\Delta x} = -\\alpha\\,u_{j}^{n}$$\n重新整理以求解 $u_{j}^{n+1}$：\n$$u_{j}^{n+1} = \\left(1 + c\\frac{\\Delta t}{\\Delta x} - \\alpha\\Delta t\\right)u_{j}^{n} - \\left(c\\frac{\\Delta t}{\\Delta x}\\right)u_{j+1}^{n}$$\n在这种情况下， $|c|=-c$，所以库朗数 $\\nu = \\frac{-c\\Delta t}{\\Delta x}$，这意味着 $c\\frac{\\Delta t}{\\Delta x} = -\\nu$。将此代入方程得到：\n$$u_{j}^{n+1} = (1 - \\nu - A)u_{j}^{n} + \\nu u_{j+1}^{n}$$\n应用相同的傅里叶模态 $u_{j}^{n} = \\hat{u}^{n}e^{i k j \\Delta x}$：\n$$\\hat{u}^{n+1}e^{i k j \\Delta x} = (1 - \\nu - A)\\hat{u}^{n}e^{i k j \\Delta x} + \\nu \\hat{u}^{n}e^{i k (j+1) \\Delta x}$$\n除以 $\\hat{u}^{n}e^{i k j \\Delta x}$ 得到放大因子：\n$$G(k) = (1 - \\nu - A) + \\nu e^{i k \\Delta x}$$\n该放大因子是为 $c > 0$ 情况推导出的放大因子的复共轭。由于复数的模等于其共轭的模，因此对于 $c > 0$ 和 $c < 0$ 的情况，$|G(\\theta)|$ 是相同的。因此，稳定性分析完全相同，得出相同的条件：\n$$0 \\le \\alpha\\Delta t \\le 2(1-\\nu)$$\n只要 $0 \\le \\nu \\le 1$，此条件就能保证对所有波数的稳定性。问题要求保证稳定性的无量纲松弛强度 $\\alpha\\Delta t$ 的上确界。这对应于所推导不等式的上界。\n\n因此，$\\alpha\\Delta t$ 的上确界是 $2(1-\\nu)$。",
            "answer": "$$\\boxed{2(1-\\nu)}$$"
        },
        {
            "introduction": "理论最终必须转化为实践。这最后一个练习将挑战你为一个模式边界上的速度场，实现一个符合实际的、依赖于流场的松弛方案。你将利用入流的概念，选择性地只阻尼进入区域的速度分量，这项技术对于最小化虚假反射至关重要。这个编程问题  将理论原则与它们在计算模型中的实际应用联系起来。",
            "id": "4059614",
            "problem": "在数值天气预报 (NWP) 和气候模拟的背景下，给定一个二维侧边界。在每个离散的边界段上，存在一个以米/秒 ($\\mathrm{m/s}$) 为单位的预报水平速度矢量 $\\mathbf{v} = (u, v)$，以及一个相应的、在几何上表征边界方向的外向单位法向量 $\\hat{\\mathbf{n}}$。目标是实现一个科学上一致且与流场相关的松弛步骤，该步骤仅阻尼 $\\mathbf{v}$ 的流入法向分量，而流出分量不受影响。该松弛步骤必须符合以下基本依据和约束：\n\n- 从线性平流的角度和标准的边界-法向分解出发。仅根据法向分量 $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$ 的符号，使用点积来区分流入与流出。流入对应于 $v_n < 0$（通量从外部指向区域内部），流出对应于 $v_n \\ge 0$。\n- 将 $\\mathbf{v}$ 分解为相对于 $\\hat{\\mathbf{n}}$ 的法向和切向分量，并设计一个松弛机制，该机制仅作用于流入的法向速度分量，而不阻尼切向分量。\n- 松弛必须与流场相关：阻尼强度必须随入流法向速率的大小而增加，并与一个以米为单位的、具有物理意义的松弛长度尺度 $L_{\\mathrm{relax}}$ 和一个以秒为单位的时间步长 $\\Delta t$ 成比例。通过设计松弛方案来确保数值稳定性，使其不能在单一步骤内反转 $v_n$ 的符号。\n- 该实现必须被设计为单个显式时间步更新。结果必须是在物理上和数值上都合理的、位于边界段上的更新后速度 $\\mathbf{v}^{\\mathrm{new}}$，单位为 $\\mathrm{m/s}$。\n\n你的程序必须实现上述逻辑，不使用任何外部输入，并且必须评估以下测试套件。在每种情况下，将 $\\hat{\\mathbf{n}}$ 视为外向单位法向量（即，如有必要则进行归一化），将 $\\mathbf{v}$ 视为以 $\\mathrm{m/s}$ 为单位的边界速度，$\\Delta t$ 以秒为单位， $L_{\\mathrm{relax}}$ 以米为单位。对于每种情况，计算经过一个松弛步骤后更新的速度 $\\mathbf{v}^{\\mathrm{new}}$，以 $\\mathrm{m/s}$ 表示，并将每个分量四舍五入到六位小数。\n\n测试套件：\n\n- 情况 A (正常路径流入): $\\hat{\\mathbf{n}} = (1, 0)$，$\\mathbf{v} = (-10, 3)$，$\\Delta t = 30$ 秒， $L_{\\mathrm{relax}} = 10000$ 米。\n- 情况 B (纯流出，应保持不变): $\\hat{\\mathbf{n}} = (1, 0)$，$\\mathbf{v} = (5, -2)$，$\\Delta t = 30$ 秒， $L_{\\mathrm{relax}} = 10000$ 米。\n- 情况 C (纯切向流，法向分量为零): $\\hat{\\mathbf{n}} = (0, 1)$，$\\mathbf{v} = (3, 0)$，$\\Delta t = 60$ 秒， $L_{\\mathrm{relax}} = 12000$ 米。\n- 情况 D (强流入，饱和边界情况): $\\hat{\\mathbf{n}} = (0, 1)$，$\\mathbf{v} = (0, -50)$，$\\Delta t = 300$ 秒， $L_{\\mathrm{relax}} = 15000$ 米。\n- 情况 E (对角边界法线与斜向流入): $\\hat{\\mathbf{n}} = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$，$\\mathbf{v} = (-10, -10)$，$\\Delta t = 60$ 秒， $L_{\\mathrm{relax}} = 8000$ 米。\n\n最终输出格式规范：\n\n- 你的程序应生成单行输出，该输出是一个用方括号括起来的逗号分隔列表，其中每个元素是针对一个测试用例的更新后速度矢量，表示为一个包含两个浮点数的双元素列表，浮点数四舍五入到六位小数，单位为 $\\mathrm{m/s}$。例如：$[[u_1^{\\mathrm{new}},v_1^{\\mathrm{new}}],[u_2^{\\mathrm{new}},v_2^{\\mathrm{new}}],\\dots]$。\n\n不应使用用户输入或外部文件；所有数据必须完全按照上述规定在程序中硬编码。",
            "solution": "问题陈述是有效的。它在科学上基于流体动力学和数值模拟的原理，特别是关于有限区域模型中的侧边界条件。该问题是适定的，提供了推导唯一且稳定解所需的所有物理和数值约束。其语言是客观的，参数也符合物理现实。因此，我们可以着手推导和实现解决方案。\n\n核心任务是为一个位于二维侧边界上的速度矢量 $\\mathbf{v}$ 设计一个与流场相关的松弛步骤，该边界由一个外向单位法向量 $\\hat{\\mathbf{n}}$ 表征。松弛必须仅阻尼流动的流入分量。\n\n首先，我们将速度矢量 $\\mathbf{v}$ 分解为其相对于边界的法向和切向分量。标量法向速度 $v_n$ 是 $\\mathbf{v}$ 在 $\\hat{\\mathbf{n}}$ 上的投影：\n$$v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$$\n$v_n$ 的符号决定了相对于模型区域的流动方向。根据问题规范，流入对应于 $v_n < 0$，而流出或纯切向流对应于 $v_n \\ge 0$。松弛仅适用于流入情况。\n\n速度矢量 $\\mathbf{v}$ 可以写成其法向和切向矢量分量的和：\n$$ \\mathbf{v} = \\mathbf{v}_n + \\mathbf{v}_t $$\n其中法向速度矢量为 $\\mathbf{v}_n = v_n \\hat{\\mathbf{n}}$，切向速度矢量为 $\\mathbf{v}_t = \\mathbf{v} - \\mathbf{v}_n$。问题指出，松弛不能影响切向分量，因此更新后的切向速度 $\\mathbf{v}_t^{\\mathrm{new}}$ 与原始值相等，即 $\\mathbf{v}_t^{\\mathrm{new}} = \\mathbf{v}_t$。整个更新作用于法向分量 $\\mathbf{v}_n$。\n\n对于流入 ($v_n < 0$)，我们设计一个显式松弛方案，将法向速度驱动至目标值 $0$。对于一个量 $\\phi$，在一个时间步长 $\\Delta t$ 内，使用松弛系数 $K$ 向目标值 $\\phi_{\\text{target}}$ 进行松弛的标准显式更新是：\n$$ \\frac{\\phi^{\\mathrm{new}} - \\phi}{\\Delta t} = -K (\\phi - \\phi_{\\text{target}}) $$\n在我们的情况下，这个量是法向速度标量，即 $\\phi = v_n$，目标值为 $v_{n, \\text{target}} = 0$。$v_n$ 的更新法则变为：\n$$ \\frac{v_n^{\\mathrm{new}} - v_n}{\\Delta t} = -K v_n \\quad \\implies \\quad v_n^{\\mathrm{new}} = (1 - K \\Delta t) v_n $$\n问题要求阻尼强度与流场相关，随入流法向速率的大小 $|v_n|$ 增加，并与松弛长度尺度 $L_{\\mathrm{relax}}$ 成比例。一个基于平流的、物理上一致的 $K$ 的形式是 $K \\propto |v_n| / L_{\\mathrm{relax}}$。我们设定：\n$$ K = \\frac{|v_n|}{L_{\\mathrm{relax}}} $$\n由于这仅在 $v_n < 0$ 时适用，我们有 $|v_n| = -v_n$，所以：\n$$ K = \\frac{-v_n}{L_{\\mathrm{relax}}} $$\n将此代入更新法则得到：\n$$ v_n^{\\mathrm{new}} = \\left(1 - \\left(\\frac{-v_n}{L_{\\mathrm{relax}}}\\right) \\Delta t\\right) v_n $$\n让我们定义一个无量纲阻尼因子 $\\alpha$：\n$$ \\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}} $$\n更新法则简化为 $v_n^{\\mathrm{new}} = (1 - \\alpha) v_n$。由于 $v_n < 0$、$\\Delta t > 0$ 和 $L_{\\mathrm{relax}} > 0$，因子 $\\alpha$ 是正的，这确保了更新项 $-\\alpha v_n$ 与 $v_n$ 的符号相反，从而阻尼其大小。\n\n一个关键的约束是数值稳定性：松弛不能反转 $v_n$ 的符号。对于初始的 $v_n < 0$，我们必须确保 $v_n^{\\mathrm{new}} \\le 0$。这意味着：\n$$ (1 - \\alpha) v_n \\le 0 $$\n由于 $v_n < 0$，我们用它来除，并反转不等号，得到 $1 - \\alpha \\ge 0$，即 $\\alpha \\le 1$。这是一个类似 CFL 的条件。为了保证稳定性，我们必须将阻尼因子的上限设为 $1$。因此，有效阻尼因子 $\\alpha_{\\mathrm{eff}}$ 为：\n$$ \\alpha_{\\mathrm{eff}} = \\min\\left(1, \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}\\right) $$\n标量法向速度的最终更新为 $v_n^{\\mathrm{new}} = (1 - \\alpha_{\\mathrm{eff}}) v_n$。\n\n更新后的速度矢量 $\\mathbf{v}^{\\mathrm{new}}$ 是新的法向分量和未改变的切向分量的和：\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}_n^{\\mathrm{new}} + \\mathbf{v}_t = \\big( (1 - \\alpha_{\\mathrm{eff}}) v_n \\big) \\hat{\\mathbf{n}} + (\\mathbf{v} - v_n \\hat{\\mathbf{n}}) $$\n$$ \\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - v_n \\hat{\\mathbf{n}} + (1 - \\alpha_{\\mathrm{eff}}) v_n \\hat{\\mathbf{n}} = \\mathbf{v} - \\alpha_{\\mathrm{eff}} v_n \\hat{\\mathbf{n}} $$\n这个紧凑的公式代表了最终的算法。\n\n完整的流程如下：\n1.  计算 $v_n = \\mathbf{v} \\cdot \\hat{\\mathbf{n}}$。\n2.  如果 $v_n \\ge 0$，流动是流出或切向的。不执行更新：$\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v}$。\n3.  如果 $v_n < 0$，流动是流入的。\n    a.  计算阻尼因子 $\\alpha = \\frac{-v_n \\Delta t}{L_{\\mathrm{relax}}}$。\n    b.  应用稳定性上限：$\\alpha_{\\mathrm{eff}} = \\min(1, \\alpha)$。\n    c.  计算更新后的速度：$\\mathbf{v}^{\\mathrm{new}} = \\mathbf{v} - (\\alpha_{\\mathrm{eff}} v_n) \\hat{\\mathbf{n}}$。\n\n将此算法应用于每个测试用例以计算最终结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and evaluates a flow-dependent lateral boundary relaxation scheme for NWP models.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_hat_tuple, v_tuple, delta_t, L_relax)\n    test_cases = [\n        # Case A (happy path inflow)\n        {'n_hat': (1.0, 0.0), 'v': (-10.0, 3.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case B (pure outflow, should be unchanged)\n        {'n_hat': (1.0, 0.0), 'v': (5.0, -2.0), 'dt': 30.0, 'L_relax': 10000.0},\n        # Case C (pure tangential flow, neutral normal component)\n        {'n_hat': (0.0, 1.0), 'v': (3.0, 0.0), 'dt': 60.0, 'L_relax': 12000.0},\n        # Case D (strong inflow, saturation edge case)\n        {'n_hat': (0.0, 1.0), 'v': (0.0, -50.0), 'dt': 300.0, 'L_relax': 15000.0},\n        # Case E (diagonal boundary normal with oblique inflow)\n        {'n_hat': (1/np.sqrt(2), 1/np.sqrt(2)), 'v': (-10.0, -10.0), 'dt': 60.0, 'L_relax': 8000.0}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters and convert to numpy arrays for vector operations\n        n_hat = np.array(case['n_hat'], dtype=float)\n        v = np.array(case['v'], dtype=float)\n        dt = case['dt']\n        L_relax = case['L_relax']\n\n        # Step 1: Decompose velocity by calculating the scalar normal component.\n        # v_n is the projection of v onto the outward normal n_hat.\n        v_n = np.dot(v, n_hat)\n\n        # Step 2: Apply relaxation based on flow direction.\n        # The relaxation is applied only for v_n  0 (incoming flow).\n        if v_n = 0:\n            # For outgoing or tangential flow (v_n >= 0), the velocity is unchanged.\n            v_new = v\n        else:\n            # For incoming flow (v_n  0), calculate the damping.\n            \n            # Step 3a: Calculate the non-dimensional damping factor 'alpha'.\n            # It's proportional to the incoming speed |-v_n| and time step dt,\n            # and inversely proportional to the relaxation length scale L_relax.\n            alpha = (-v_n * dt) / L_relax\n\n            # Step 3b: Enforce numerical stability.\n            # The factor is capped at 1.0 to prevent the flow from reversing direction\n            # in a single time step (a CFL-like condition).\n            alpha_eff = min(1.0, alpha)\n\n            # Step 3c: Compute the updated velocity vector.\n            # The change is applied only along the normal direction.\n            # v_new = v - (alpha_eff * v_n) * n_hat\n            update_term = - (alpha_eff * v_n) * n_hat\n            v_new = v + update_term\n\n        # Round each component of the final velocity to six decimal places as required.\n        v_new_rounded = np.round(v_new, 6).tolist()\n        results.append(v_new_rounded)\n\n    # Final print statement in the exact required format.\n    # The format is a string representation of a list of lists.\n    # Using map(str, ...) on the list of lists achieves the desired output format,\n    # including the required spacing.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}