{
    "hands_on_practices": [
        {
            "introduction": "To design numerical schemes that conserve energy and enstrophy, one must first have a firm grasp of these quantities in their original, continuous form. This exercise provides a foundational workout by asking you to compute the total kinetic energy and enstrophy for a simple, analytical flow field on a periodic domain. By working through the fundamental definitions from first principles, you will solidify your understanding of these crucial invariants before tackling the complexities of their discrete counterparts .",
            "id": "4036083",
            "problem": "Consider two-dimensional, incompressible flow on the periodic square domain $\\mathcal{D} = [0, 2\\pi] \\times [0, 2\\pi]$ with periodic boundary conditions in both $x$ and $y$. Let the flow be represented by a streamfunction $\\psi(x,y)$ such that the velocity field $\\mathbf{u}(x,y) = (u(x,y), v(x,y))$ is given by $u(x,y) = -\\frac{\\partial \\psi}{\\partial y}(x,y)$ and $v(x,y) = \\frac{\\partial \\psi}{\\partial x}(x,y)$. Assume the streamfunction is\n$$\n\\psi(x,y) = A \\cos(k x)\\cos(\\ell y),\n$$\nwhere $A>0$ is a constant amplitude and $k,\\ell \\in \\mathbb{N}$ are positive integers. \n\nUsing only the fundamental definitions of kinetic energy and enstrophy for two-dimensional incompressible flow, compute the kinetic energy $E$ and the enstrophy $Z$ of this flow over $\\mathcal{D}$. The kinetic energy is defined by\n$$\nE = \\frac{1}{2} \\int_{\\mathcal{D}} \\left( u(x,y)^{2} + v(x,y)^{2} \\right) \\, \\mathrm{d}x\\,\\mathrm{d}y,\n$$\nand the vorticity $\\zeta$ is defined by\n$$\n\\zeta(x,y) = \\frac{\\partial v}{\\partial x}(x,y) - \\frac{\\partial u}{\\partial y}(x,y),\n$$\nwith enstrophy\n$$\nZ = \\frac{1}{2} \\int_{\\mathcal{D}} \\zeta(x,y)^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y.\n$$\n\nExpress your final results for $E$ and $Z$ as exact analytic expressions in terms of $A$, $k$, $\\ell$, and $\\pi$. Do not provide any numerical approximations. Your final answer must contain both $E$ and $Z$ together.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of fluid dynamics, is well-posed with all necessary definitions and constraints, and is expressed in objective, mathematical language. It is a standard calculation in the study of two-dimensional turbulence and geophysical fluid dynamics.\n\nThe task is to compute the total kinetic energy $E$ and the total enstrophy $Z$ for a flow defined by a given streamfunction $\\psi(x,y)$ on a periodic square domain $\\mathcal{D} = [0, 2\\pi] \\times [0, 2\\pi]$.\n\nThe streamfunction is given as\n$$\n\\psi(x,y) = A \\cos(k x)\\cos(\\ell y)\n$$\nwhere $A > 0$ and $k, \\ell \\in \\mathbb{N}$ are positive integers.\n\nFirst, we calculate the components of the velocity field $\\mathbf{u}(x,y) = (u(x,y), v(x,y))$ using their definitions in terms of the streamfunction.\nThe $x$-component of the velocity is\n$$\nu(x,y) = -\\frac{\\partial \\psi}{\\partial y}(x,y) = -\\frac{\\partial}{\\partial y} \\left( A \\cos(k x)\\cos(\\ell y) \\right) = -A \\cos(k x) (-\\ell \\sin(\\ell y)) = A\\ell \\cos(k x)\\sin(\\ell y).\n$$\nThe $y$-component of the velocity is\n$$\nv(x,y) = \\frac{\\partial \\psi}{\\partial x}(x,y) = \\frac{\\partial}{\\partial x} \\left( A \\cos(k x)\\cos(\\ell y) \\right) = A (-k \\sin(k x)) \\cos(\\ell y) = -Ak \\sin(k x)\\cos(\\ell y).\n$$\n\nNext, we compute the kinetic energy $E$, which is defined as\n$$\nE = \\frac{1}{2} \\int_{\\mathcal{D}} \\left( u(x,y)^{2} + v(x,y)^{2} \\right) \\, \\mathrm{d}x\\,\\mathrm{d}y.\n$$\nThe integrand, representing twice the kinetic energy density, is\n$$\nu^{2} + v^{2} = (A\\ell \\cos(k x)\\sin(\\ell y))^{2} + (-Ak \\sin(k x)\\cos(\\ell y))^{2}\n$$\n$$\nu^{2} + v^{2} = A^{2}\\ell^{2} \\cos^{2}(k x)\\sin^{2}(\\ell y) + A^{2}k^{2} \\sin^{2}(k x)\\cos^{2}(\\ell y).\n$$\nNow we integrate this expression over the domain $\\mathcal{D} = [0, 2\\pi] \\times [0, 2\\pi]$:\n$$\nE = \\frac{A^{2}}{2} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\left( \\ell^{2} \\cos^{2}(k x)\\sin^{2}(\\ell y) + k^{2} \\sin^{2}(k x)\\cos^{2}(\\ell y) \\right) \\, \\mathrm{d}x\\,\\mathrm{d}y.\n$$\nDue to the separability of the functions of $x$ and $y$, we can write this as a sum of products of integrals:\n$$\nE = \\frac{A^{2}}{2} \\left( \\ell^{2} \\left(\\int_{0}^{2\\pi} \\cos^{2}(k x) \\, \\mathrm{d}x\\right) \\left(\\int_{0}^{2\\pi} \\sin^{2}(\\ell y) \\, \\mathrm{d}y\\right) + k^{2} \\left(\\int_{0}^{2\\pi} \\sin^{2}(k x) \\, \\mathrm{d}x\\right) \\left(\\int_{0}^{2\\pi} \\cos^{2}(\\ell y) \\, \\mathrm{d}y\\right) \\right).\n$$\nWe use the standard definite integrals over a full period. For any non-zero integer $m$,\n$$\n\\int_{0}^{2\\pi} \\cos^{2}(mx) \\, \\mathrm{d}x = \\int_{0}^{2\\pi} \\frac{1 + \\cos(2mx)}{2} \\, \\mathrm{d}x = \\left[ \\frac{x}{2} + \\frac{\\sin(2mx)}{4m} \\right]_{0}^{2\\pi} = \\frac{2\\pi}{2} = \\pi.\n$$\n$$\n\\int_{0}^{2\\pi} \\sin^{2}(mx) \\, \\mathrm{d}x = \\int_{0}^{2\\pi} \\frac{1 - \\cos(2mx)}{2} \\, \\mathrm{d}x = \\left[ \\frac{x}{2} - \\frac{\\sin(2mx)}{4m} \\right]_{0}^{2\\pi} = \\frac{2\\pi}{2} = \\pi.\n$$\nSince $k$ and $\\ell$ are positive integers, these results apply. Substituting these values back into the expression for $E$:\n$$\nE = \\frac{A^{2}}{2} \\left( \\ell^{2} (\\pi)(\\pi) + k^{2} (\\pi)(\\pi) \\right) = \\frac{A^{2}\\pi^{2}}{2} (k^{2} + \\ell^{2}).\n$$\n\nNext, we compute the enstrophy $Z$. First, we must find the vorticity, $\\zeta$, defined as\n$$\n\\zeta(x,y) = \\frac{\\partial v}{\\partial x}(x,y) - \\frac{\\partial u}{\\partial y}(x,y).\n$$\nLet's compute the required partial derivatives:\n$$\n\\frac{\\partial v}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( -Ak \\sin(k x)\\cos(\\ell y) \\right) = -Ak^{2} \\cos(k x)\\cos(\\ell y).\n$$\n$$\n\\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial y} \\left( A\\ell \\cos(k x)\\sin(\\ell y) \\right) = A\\ell^{2} \\cos(k x)\\cos(\\ell y).\n$$\nSubstituting these into the definition of vorticity:\n$$\n\\zeta(x,y) = -Ak^{2} \\cos(k x)\\cos(\\ell y) - A\\ell^{2} \\cos(k x)\\cos(\\ell y) = -A(k^{2} + \\ell^{2}) \\cos(k x)\\cos(\\ell y).\n$$\nNotice that $\\zeta = \\nabla^{2}\\psi$. This is a general result for two-dimensional incompressible flow.\n\nThe enstrophy $Z$ is defined as\n$$\nZ = \\frac{1}{2} \\int_{\\mathcal{D}} \\zeta(x,y)^{2} \\, \\mathrm{d}x\\,\\mathrm{d}y.\n$$\nWe square the expression for vorticity:\n$$\n\\zeta^{2} = \\left( -A(k^{2} + \\ell^{2}) \\cos(k x)\\cos(\\ell y) \\right)^{2} = A^{2}(k^{2} + \\ell^{2})^{2} \\cos^{2}(k x)\\cos^{2}(\\ell y).\n$$\nNow we integrate this over the domain $\\mathcal{D}$:\n$$\nZ = \\frac{1}{2} \\int_{0}^{2\\pi} \\int_{0}^{2\\pi} A^{2}(k^{2} + \\ell^{2})^{2} \\cos^{2}(k x)\\cos^{2}(\\ell y) \\, \\mathrm{d}x\\,\\mathrm{d}y.\n$$\nWe can factor out the constants and separate the integrals:\n$$\nZ = \\frac{A^{2}(k^{2} + \\ell^{2})^{2}}{2} \\left( \\int_{0}^{2\\pi} \\cos^{2}(k x) \\, \\mathrm{d}x \\right) \\left( \\int_{0}^{2\\pi} \\cos^{2}(\\ell y) \\, \\mathrm{d}y \\right).\n$$\nUsing the integral result $\\int_{0}^{2\\pi} \\cos^{2}(mx) \\, \\mathrm{d}x = \\pi$ for non-zero integer $m$:\n$$\nZ = \\frac{A^{2}(k^{2} + \\ell^{2})^{2}}{2} (\\pi)(\\pi) = \\frac{A^{2}\\pi^{2}(k^{2} + \\ell^{2})^{2}}{2}.\n$$\n\nThe final expressions for the kinetic energy $E$ and enstrophy $Z$ are:\n$$\nE = \\frac{A^{2}\\pi^{2}(k^{2} + \\ell^{2})}{2}\n$$\n$$\nZ = \\frac{A^{2}\\pi^{2}(k^{2} + \\ell^{2})^{2}}{2}\n$$\nThese results are presented jointly as the final answer.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{A^{2} \\pi^{2} (k^{2} + \\ell^{2})}{2} & \\frac{A^{2} \\pi^{2} (k^{2} + \\ell^{2})^{2}}{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Translating continuous conservation laws to a discrete grid is a central challenge in numerical modeling. The Arakawa C-grid is a celebrated design that facilitates this by staggering variables in space. This practice offers a concrete, hands-on calculation on a C-grid, where you will derive a discrete summation-by-parts identity—the numerical analogue of the product rule—and see how it directly links the pressure gradient work to energy changes, revealing the mechanism for conservation .",
            "id": "4036086",
            "problem": "Consider an inviscid, compressible flow on a two-dimensional, uniform Arakawa C-grid under periodic boundary conditions in both directions. The domain consists of $N_x = 2$ cells in the $x$-direction and $N_y = 2$ cells in the $y$-direction, with nondimensional grid spacings $\\Delta x = 1$ and $\\Delta y = 1$. The Arakawa C-grid staggering places the $x$-velocity at east–west cell faces, the $y$-velocity at north–south cell faces, and the pressure at cell centers. Denote $x$-velocity components by $u_{i+1/2,j}$, $y$-velocity components by $v_{i,j+1/2}$, and pressure by $p_{i,j}$, where $i \\in \\{1,2\\}$ and $j \\in \\{1,2\\}$, with periodic indexing.\n\nThe discrete divergence at cell centers is defined by\n$$\n(\\delta_x u)_{i,j} = \\frac{u_{i+1/2,j} - u_{i-1/2,j}}{\\Delta x}, \\qquad\n(\\delta_y v)_{i,j} = \\frac{v_{i,j+1/2} - v_{i,j-1/2}}{\\Delta y}, \\qquad\n(\\nabla_h \\cdot \\mathbf{u})_{i,j} = (\\delta_x u)_{i,j} + (\\delta_y v)_{i,j},\n$$\nwith periodic indexing (for example, $u_{1-1/2,j} = u_{2+1/2,j}$ and $v_{i,1-1/2} = v_{i,2+1/2}$). The discrete pressure gradients at faces are defined by centered differences\n$$\n(\\delta_x p)_{i+1/2,j} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\qquad\n(\\delta_y p)_{i,j+1/2} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}.\n$$\n\nYou are given the following nondimensional fields:\n- Cell-centered pressure:\n$$\np_{1,1} = 2, \\quad p_{2,1} = 1, \\quad p_{1,2} = 0, \\quad p_{2,2} = 3.\n$$\n- Face-centered $x$-velocity:\n$$\nu_{1+1/2,1} = 1, \\quad u_{2+1/2,1} = -1, \\quad u_{1+1/2,2} = 0, \\quad u_{2+1/2,2} = 2.\n$$\n- Face-centered $y$-velocity:\n$$\nv_{1,1+1/2} = \\frac{1}{2}, \\quad v_{2,1+1/2} = -\\frac{3}{2}, \\quad v_{1,2+1/2} = 1, \\quad v_{2,2+1/2} = -\\frac{1}{2}.\n$$\n\nTasks:\n- First, compute the discrete divergence $(\\nabla_h \\cdot \\mathbf{u})_{i,j}$ in each of the four cells.\n- Then, starting from the continuous product rule identity for inviscid pressure work,\n$$\n\\mathbf{u} \\cdot \\left(-\\nabla p\\right) = -\\nabla \\cdot \\left(p \\,\\mathbf{u}\\right) + p \\,\\nabla \\cdot \\mathbf{u},\n$$\nderive the corresponding discrete summation-by-parts relation on this C-grid with periodic boundaries that links the domain-summed face-centered pressure work to a cell-centered sum involving $p_{i,j}$ and $(\\nabla_h \\cdot \\mathbf{u})_{i,j}$.\n- Finally, using your discrete relation and the given fields, evaluate the domain-integrated kinetic energy tendency due solely to the pressure gradient term. Use nondimensional units and provide the exact value (no rounding). Your final answer must be a single real number.",
            "solution": "The user wants me to solve a problem on an Arakawa C-grid.\n\n### Step 1: Extract Givens\n- **Domain:** A two-dimensional grid with $N_x = 2$ cells in the $x$-direction and $N_y = 2$ cells in the $y$-direction.\n- **Grid Spacing:** Nondimensional grid spacings are $\\Delta x = 1$ and $\\Delta y = 1$.\n- **Grid Structure:** Arakawa C-grid with $x$-velocity $u$ at east–west faces, $y$-velocity $v$ at north–south faces, and pressure $p$ at cell centers.\n- **Indexing:** Cell indices are $i \\in \\{1,2\\}$ and $j \\in \\{1,2\\}$. Periodic indexing is used.\n- **Discrete Operators:**\n  - Divergence at cell $(i,j)$: $(\\nabla_h \\cdot \\mathbf{u})_{i,j} = \\frac{u_{i+1/2,j} - u_{i-1/2,j}}{\\Delta x} + \\frac{v_{i,j+1/2} - v_{i,j-1/2}}{\\Delta y}$.\n  - Pressure gradient at faces: $(\\delta_x p)_{i+1/2,j} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}$, $(\\delta_y p)_{i,j+1/2} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}$.\n- **Boundary Conditions:** Periodic, with explicit rules $u_{1-1/2,j} = u_{2+1/2,j}$ and $v_{i,1-1/2} = v_{i,2+1/2}$. This implies $u_{1/2,j} = u_{5/2,j}$ and $v_{i,1/2} = v_{i,5/2}$.\n- **Given Fields:**\n  - Pressure: $p_{1,1} = 2$, $p_{2,1} = 1$, $p_{1,2} = 0$, $p_{2,2} = 3$.\n  - $x$-velocity: $u_{3/2,1} = 1$, $u_{5/2,1} = -1$, $u_{3/2,2} = 0$, $u_{5/2,2} = 2$.\n  - $y$-velocity: $v_{1,3/2} = \\frac{1}{2}$, $v_{2,3/2} = -\\frac{3}{2}$, $v_{1,5/2} = 1$, $v_{2,5/2} = -\\frac{1}{2}$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the field of numerical fluid dynamics and computational physics, specifically concerning discretizations used in weather and climate models. The Arakawa C-grid and the concept of summation-by-parts are standard and fundamental topics. The problem is well-posed, with all necessary data and definitions provided to compute a unique answer. The language is objective and precise. The data is self-consistent and the problem structure is logical. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Part 1: Compute the discrete divergence\nWe compute the discrete divergence $(\\nabla_h \\cdot \\mathbf{u})_{i,j}$ for each of the four cells $(i,j) \\in \\{ (1,1), (2,1), (1,2), (2,2) \\}$. Since $\\Delta x = 1$ and $\\Delta y = 1$, the formula simplifies to $(\\nabla_h \\cdot \\mathbf{u})_{i,j} = (u_{i+1/2,j} - u_{i-1/2,j}) + (v_{i,j+1/2} - v_{i,j-1/2})$. We must use the periodic boundary conditions to find the values of $u$ and $v$ at the boundaries of the $2 \\times 2$ domain.\n\nThe periodic boundary conditions are:\nFor $u$: $u_{1/2,j} = u_{2+1/2,j} = u_{5/2,j}$ and $u_{1+1/2,j} = u_{3/2,j}$. A value at index $i+1/2$ wraps from $i=2$ to $i=1$.\n- $u_{1/2,1} = u_{5/2,1} = -1$\n- $u_{1/2,2} = u_{5/2,2} = 2$\n\nFor $v$: $v_{i,1/2} = v_{i,2+1/2} = v_{i,5/2}$ and $v_{i,1+1/2} = v_{i,3/2}$. A value at index $j+1/2$ wraps from $j=2$ to $j=1$.\n- $v_{1,1/2} = v_{1,5/2} = 1$\n- $v_{2,1/2} = v_{2,5/2} = -\\frac{1}{2}$\n\nNow we compute the divergence for each cell:\n- **Cell (1,1):**\n$$ (\\nabla_h \\cdot \\mathbf{u})_{1,1} = (u_{3/2,1} - u_{1/2,1}) + (v_{1,3/2} - v_{1,1/2}) = (1 - (-1)) + (\\frac{1}{2} - 1) = 2 - \\frac{1}{2} = \\frac{3}{2} $$\n- **Cell (2,1):**\n$$ (\\nabla_h \\cdot \\mathbf{u})_{2,1} = (u_{5/2,1} - u_{3/2,1}) + (v_{2,3/2} - v_{2,1/2}) = (-1 - 1) + (-\\frac{3}{2} - (-\\frac{1}{2})) = -2 - 1 = -3 $$\n- **Cell (1,2):**\n$$ (\\nabla_h \\cdot \\mathbf{u})_{1,2} = (u_{3/2,2} - u_{1/2,2}) + (v_{1,5/2} - v_{1,3/2}) = (0 - 2) + (1 - \\frac{1}{2}) = -2 + \\frac{1}{2} = -\\frac{3}{2} $$\n- **Cell (2,2):**\n$$ (\\nabla_h \\cdot \\mathbf{u})_{2,2} = (u_{5/2,2} - u_{3/2,2}) + (v_{2,5/2} - v_{2,3/2}) = (2 - 0) + (-\\frac{1}{2} - (-\\frac{3}{2})) = 2 + 1 = 3 $$\n\nAs a verification, the sum of divergences over a periodic domain should be zero: $\\frac{3}{2} - 3 - \\frac{3}{2} + 3 = 0$. This holds true.\n\n### Part 2: Derive the discrete summation-by-parts relation\nThe domain-integrated kinetic energy tendency due to the pressure gradient is given by the integral of $\\mathbf{u} \\cdot (-\\nabla p)$ over the domain area $A$. The discrete analogue, which we denote as $W$, is a sum over all velocity points of the velocity component multiplied by the corresponding pressure force component, weighted by the cell area $\\Delta A = \\Delta x \\Delta y$. On the C-grid, the pressure gradient components are naturally co-located with the velocity components.\n$$ W = \\sum_{j=1}^{N_y} \\sum_{i=1}^{N_x} \\left[ u_{i+1/2,j} (-(\\delta_x p)_{i+1/2,j}) + v_{i,j+1/2} (-(\\delta_y p)_{i,j+1/2}) \\right] \\Delta x \\Delta y $$\nSubstituting the definitions for the discrete gradients:\n$$ W = - \\sum_{j=1}^{N_y} \\sum_{i=1}^{N_x} \\left[ u_{i+1/2,j} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x} + v_{i,j+1/2} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y} \\right] \\Delta x \\Delta y $$\n$$ W = - \\sum_{j=1}^{N_y} \\sum_{i=1}^{N_x} \\left[ u_{i+1/2,j} (p_{i+1,j} - p_{i,j}) \\Delta y + v_{i,j+1/2} (p_{i,j+1} - p_{i,j}) \\Delta x \\right] $$\nWe can split the sum into four parts:\n$$ W = - \\sum_{j,i} u_{i+1/2,j} p_{i+1,j} \\Delta y + \\sum_{j,i} u_{i+1/2,j} p_{i,j} \\Delta y - \\sum_{j,i} v_{i,j+1/2} p_{i,j+1} \\Delta x + \\sum_{j,i} v_{i,j+1/2} p_{i,j} \\Delta x $$\nNow, we perform summation by parts by re-indexing the sums. For the first term, let $i' = i+1$. Since the sums are over a periodic domain, summing over $i'$ from $2$ to $N_x+1$ is equivalent to summing over $i$ from $1$ to $N_x$. The sum becomes $-\\sum_{j,i'} u_{i'-1/2,j} p_{i',j} \\Delta y$, which we can write as $-\\sum_{j,i} u_{i-1/2,j} p_{i,j} \\Delta y$. Similarly, for the third term, let $j' = j+1$, which yields $-\\sum_{j,i} v_{i,j-1/2} p_{i,j} \\Delta x$.\nSubstituting these back, we can collect terms with the common factor $p_{i,j}$:\n$$ W = \\sum_{j,i} p_{i,j} \\left[ u_{i+1/2,j} \\Delta y - u_{i-1/2,j} \\Delta y + v_{i,j+1/2} \\Delta x - v_{i,j-1/2} \\Delta x \\right] $$\nFactoring out $\\Delta x \\Delta y$:\n$$ W = \\sum_{j,i} p_{i,j} \\left[ \\frac{u_{i+1/2,j} - u_{i-1/2,j}}{\\Delta x} + \\frac{v_{i,j+1/2} - v_{i,j-1/2}}{\\Delta y} \\right] \\Delta x \\Delta y $$\nThe term in the brackets is the definition of the discrete divergence $(\\nabla_h \\cdot \\mathbf{u})_{i,j}$. Therefore, we arrive at the desired relation:\n$$ W = \\sum_{j=1}^{N_y} \\sum_{i=1}^{N_x} p_{i,j} (\\nabla_h \\cdot \\mathbf{u})_{i,j} \\Delta x \\Delta y $$\nThis identity shows that the sum of pressure work over velocity points is exactly equal to the sum of $p$ times divergence over cell centers. This is a discrete analogue of the identity $\\int_A \\mathbf{u} \\cdot (-\\nabla p) dA = \\int_A p (\\nabla \\cdot \\mathbf{u}) dA$ for periodic domains.\n\n### Part 3: Evaluate the domain-integrated kinetic energy tendency\nUsing the derived relation and the values computed in Part 1, we can evaluate the total pressure work $W$.\nWith $\\Delta x=1$ and $\\Delta y=1$, the expression is:\n$$ W = \\sum_{j=1}^{2} \\sum_{i=1}^{2} p_{i,j} (\\nabla_h \\cdot \\mathbf{u})_{i,j} $$\nWe sum the product of pressure and divergence for each of the four cells:\n- Contribution from cell (1,1): $p_{1,1} (\\nabla_h \\cdot \\mathbf{u})_{1,1} = 2 \\times \\frac{3}{2} = 3$\n- Contribution from cell (2,1): $p_{2,1} (\\nabla_h \\cdot \\mathbf{u})_{2,1} = 1 \\times (-3) = -3$\n- Contribution from cell (1,2): $p_{1,2} (\\nabla_h \\cdot \\mathbf{u})_{1,2} = 0 \\times (-\\frac{3}{2}) = 0$\n- Contribution from cell (2,2): $p_{2,2} (\\nabla_h \\cdot \\mathbf{u})_{2,2} = 3 \\times 3 = 9$\n\nThe total domain-integrated kinetic energy tendency is the sum of these contributions:\n$$ W = 3 + (-3) + 0 + 9 = 9 $$\nThe final result is in nondimensional units.",
            "answer": "$$\n\\boxed{9}\n$$"
        },
        {
            "introduction": "While ideal schemes conserve energy perfectly, subtle choices in discretization can lead to schemes that spuriously generate or dissipate energy, corrupting long-term simulations. This exercise demonstrates what happens when the discrete operators are not constructed as a compatible adjoint pair. By deriving the exact mathematical term responsible for this non-physical energy change, you will gain a deeper appreciation for the algebraic constraints that underpin robust, energy-conserving models .",
            "id": "4036089",
            "problem": "Consider a one-dimensional periodic domain of length $L$ discretized into $N$ uniform cells with cell centers indexed by $i \\in \\{1,2,\\dots,N\\}$ and cell faces indexed by $i+\\tfrac{1}{2} \\in \\{ \\tfrac{3}{2}, \\tfrac{5}{2}, \\dots, N+\\tfrac{1}{2}, \\tfrac{1}{2} \\}$, with spacing $\\Delta x = L/N$. Let the velocity $u_{i+\\tfrac{1}{2}}(t)$ be defined at faces and the pressure $p_i(t)$ at cell centers. Assume periodic boundary conditions so that indices wrap modulo $N$ (e.g., $p_{0} \\equiv p_{N}$ and $p_{N+1} \\equiv p_{1}$). Consider the linear acoustics subsystem of the compressible flow equations as used in Numerical Weather Prediction (NWP) and climate model dynamical cores, written in semi-discrete form:\n$$\n\\frac{d u_{i+\\tfrac{1}{2}}}{d t} \\;=\\; -\\frac{1}{\\rho}\\,\\big(G p\\big)_{i+\\tfrac{1}{2}}, \n\\qquad\n\\frac{d p_i}{d t} \\;=\\; -\\rho c^{2}\\,\\big(D u\\big)_i,\n$$\nwhere $\\rho$ is a constant reference density and $c$ is a constant sound speed. The discrete divergence operator $D$ is defined by\n$$\n\\big(D u\\big)_i \\;=\\; \\frac{u_{i+\\tfrac{1}{2}} - u_{i-\\tfrac{1}{2}}}{\\Delta x},\n$$\nand the pressure gradient operator $G$ is taken to be a non-adjoint modification of the standard energy-conserving choice. Specifically, define the energy-conserving (adjoint-compatible) pressure gradient operator $G_c$ by\n$$\n\\big(G_c p\\big)_{i+\\tfrac{1}{2}} \\;=\\; \\frac{p_{i+1} - p_{i}}{\\Delta x},\n$$\nand define a non-adjoint pressure gradient operator $G_{\\mathrm{na}}$ by\n$$\n\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \\;=\\; \\big(G_c p\\big)_{i+\\tfrac{1}{2}} \\;+\\; \\eta\\,\\frac{p_{i+1} - 2 p_i + p_{i-1}}{\\Delta x},\n$$\nwhere $\\eta$ is a dimensionless coefficient measuring the departure from adjointness. Consider the discrete total acoustic energy\n$$\nE(t) \\;=\\; \\frac{\\Delta x}{2}\\,\\sum_{i=1}^{N}\\left[ \\rho\\,u_{i+\\tfrac{1}{2}}^{2}(t) \\;+\\; \\frac{1}{\\rho c^{2}}\\,p_{i}^{2}(t) \\right].\n$$\nStarting from these definitions and the semi-discrete equations, derive the exact expression for the instantaneous rate of change of the discrete energy, $\\frac{dE}{dt}$, induced solely by the non-adjoint part of the pressure gradient, i.e., the contribution that vanishes when $\\eta = 0$. Your derivation must begin from the given semi-discrete equations and the energy definition, use only algebraic identities valid on the periodic grid, and clearly identify the term that represents spurious energy production or loss. Express your final answer as a single closed-form analytic expression in terms of $\\eta$, $\\Delta x$, and the discrete fields $u_{i+\\tfrac{1}{2}}$ and $p_i$. No rounding is required. In addition, briefly explain the source of spurious energy in terms of the violation of the discrete adjoint relationship between $D$ and $G$ with respect to the energy inner product.",
            "solution": "The problem statement is deemed valid as it is scientifically grounded in the principles of numerical fluid dynamics, is well-posed, objective, and internally consistent. We can proceed with the derivation.\n\nThe total discrete acoustic energy $E(t)$ is given by:\n$$\nE(t) \\;=\\; \\frac{\\Delta x}{2}\\,\\sum_{i=1}^{N}\\left[ \\rho\\,u_{i+\\tfrac{1}{2}}^{2}(t) \\;+\\; \\frac{1}{\\rho c^{2}}\\,p_{i}^{2}(t) \\right]\n$$\nTo find the instantaneous rate of change of energy, $\\frac{dE}{dt}$, we differentiate $E(t)$ with respect to time $t$. Using the chain rule, we obtain:\n$$\n\\frac{dE}{dt} \\;=\\; \\frac{\\Delta x}{2}\\,\\sum_{i=1}^{N}\\left[ \\rho \\cdot 2 u_{i+\\tfrac{1}{2}} \\frac{d u_{i+\\tfrac{1}{2}}}{d t} \\;+\\; \\frac{1}{\\rho c^{2}} \\cdot 2 p_{i} \\frac{d p_{i}}{d t} \\right] \\\\\n\\frac{dE}{dt} \\;=\\; \\Delta x\\,\\sum_{i=1}^{N}\\left[ \\rho\\,u_{i+\\tfrac{1}{2}}\\frac{d u_{i+\\tfrac{1}{2}}}{d t} \\;+\\; \\frac{1}{\\rho c^{2}}\\,p_{i}\\frac{d p_{i}}{d t} \\right]\n$$\nNext, we substitute the given semi-discrete equations into this expression. The equations are:\n$$\n\\frac{d u_{i+\\tfrac{1}{2}}}{d t} \\;=\\; -\\frac{1}{\\rho}\\,\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \n\\qquad \\text{and} \\qquad\n\\frac{d p_i}{d t} \\;=\\; -\\rho c^{2}\\,\\big(D u\\big)_i\n$$\nHere, $G_{\\mathrm{na}}$ is the specified non-adjoint pressure gradient operator. Substituting these derivatives gives:\n$$\n\\frac{dE}{dt} \\;=\\; \\Delta x\\,\\sum_{i=1}^{N}\\left[ \\rho\\,u_{i+\\tfrac{1}{2}}\\left(-\\frac{1}{\\rho}\\,\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}}\\right) \\;+\\; \\frac{1}{\\rho c^{2}}\\,p_{i}\\left(-\\rho c^{2}\\,\\big(D u\\big)_i\\right) \\right]\n$$\nSimplifying the expression yields:\n$$\n\\frac{dE}{dt} \\;=\\; -\\Delta x\\,\\sum_{i=1}^{N}\\left[ u_{i+\\tfrac{1}{2}}\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \\;+\\; p_{i}\\big(D u\\big)_i \\right]\n$$\nTo proceed, we analyze the second term in the sum, $\\sum_{i=1}^{N} p_{i}\\big(D u\\big)_i$, using the technique of summation by parts on the periodic grid. We substitute the definition of the divergence operator $D$:\n$$\n\\sum_{i=1}^{N} p_{i}\\big(D u\\big)_i \\;=\\; \\sum_{i=1}^{N} p_{i} \\frac{u_{i+\\tfrac{1}{2}} - u_{i-\\tfrac{1}{2}}}{\\Delta x} \\;=\\; \\frac{1}{\\Delta x} \\left( \\sum_{i=1}^{N} p_{i} u_{i+\\tfrac{1}{2}} - \\sum_{i=1}^{N} p_{i} u_{i-\\tfrac{1}{2}} \\right)\n$$\nWe perform a change of index in the second sum. Let $j=i-1$, so $i=j+1$. As $i$ runs from $1$ to $N$, $j$ runs from $0$ to $N-1$.\n$$\n\\sum_{i=1}^{N} p_{i} u_{i-\\tfrac{1}{2}} \\;=\\; \\sum_{j=0}^{N-1} p_{j+1} u_{j+\\tfrac{1}{2}}\n$$\nDue to the periodic boundary conditions, the indices are taken modulo $N$. This allows us to shift the summation range from $\\{0, \\dots, N-1\\}$ to $\\{1, \\dots, N\\}$, identifying index $0$ with $N$. Hence, we can relabel the dummy index $j$ back to $i$:\n$$\n\\sum_{j=0}^{N-1} p_{j+1} u_{j+\\tfrac{1}{2}} \\;=\\; \\sum_{i=1}^{N} p_{i+1} u_{i+\\tfrac{1}{2}}\n$$\nSubstituting this back into the expression for the divergence sum:\n$$\n\\sum_{i=1}^{N} p_{i}\\big(D u\\big)_i \\;=\\; \\frac{1}{\\Delta x} \\left( \\sum_{i=1}^{N} p_{i} u_{i+\\tfrac{1}{2}} - \\sum_{i=1}^{N} p_{i+1} u_{i+\\tfrac{1}{2}} \\right) \\;=\\; -\\sum_{i=1}^{N} \\frac{p_{i+1} - p_i}{\\Delta x} u_{i+\\tfrac{1}{2}}\n$$\nRecognizing the definition of the energy-conserving gradient operator, $\\big(G_c p\\big)_{i+\\tfrac{1}{2}} = \\frac{p_{i+1} - p_{i}}{\\Delta x}$, we have:\n$$\n\\sum_{i=1}^{N} p_{i}\\big(D u\\big)_i \\;=\\; -\\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}} \\big(G_c p\\big)_{i+\\tfrac{1}{2}}\n$$\nThis identity reveals the discrete adjoint relationship between $D$ and $G_c$: in terms of discrete inner products, $\\langle p, Du \\rangle = -\\langle G_c p, u \\rangle$.\n\nNow, we substitute this result back into our expression for $\\frac{dE}{dt}$:\n$$\n\\frac{dE}{dt} \\;=\\; -\\Delta x \\left( \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}}\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} - \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}}\\big(G_c p\\big)_{i+\\tfrac{1}{2}} \\right)\n$$\n$$\n\\frac{dE}{dt} \\;=\\; \\Delta x \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}} \\left( \\big(G_c p\\big)_{i+\\tfrac{1}{2}} - \\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \\right)\n$$\nThis expression shows that the rate of energy change is zero if and only if $G_{\\mathrm{na}} = G_c$. The spurious energy generation is due entirely to the deviation of $G_{\\mathrm{na}}$ from the energy-conserving operator $G_c$.\n\nThe problem defines the non-adjoint operator as:\n$$\n\\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \\;=\\; \\big(G_c p\\big)_{i+\\tfrac{1}{2}} \\;+\\; \\eta\\,\\frac{p_{i+1} - 2 p_i + p_{i-1}}{\\Delta x}\n$$\nThe difference term is therefore:\n$$\n\\big(G_c p\\big)_{i+\\tfrac{1}{2}} - \\big(G_{\\mathrm{na}} p\\big)_{i+\\tfrac{1}{2}} \\;=\\; -\\eta\\,\\frac{p_{i+1} - 2 p_i + p_{i-1}}{\\Delta x}\n$$\nSubstituting this into the equation for $\\frac{dE}{dt}$:\n$$\n\\frac{dE}{dt} \\;=\\; \\Delta x \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}} \\left( -\\eta\\,\\frac{p_{i+1} - 2 p_i + p_{i-1}}{\\Delta x} \\right)\n$$\nThe term $\\Delta x$ cancels, yielding the final expression for the spurious rate of energy change:\n$$\n\\frac{dE}{dt} \\;=\\; - \\eta \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}} \\left( p_{i+1} - 2 p_i + p_{i-1} \\right)\n$$\nThis quantity has units of power (energy per time).\n\nThe source of the spurious energy change is the violation of the discrete adjoint property. A discrete system conserves a quadratic quantity like energy if its operators satisfy a specific symmetry (or anti-symmetry) relationship. For this system, energy conservation requires that the pressure gradient operator $G$ be the negative adjoint of the divergence operator $D$, i.e., $G = -D^*$, with respect to the energy inner product. The operator $G_c$ satisfies this condition, so $\\big(G_c, D\\big)$ forms an energy-conserving pair.\nThe modified operator $G_{\\mathrm{na}}$ is defined as $G_{\\mathrm{na}} = G_c + \\eta \\Delta G$, where $(\\Delta G p)_{i+\\tfrac{1}{2}} = (p_{i+1} - 2p_i + p_{i-1})/\\Delta x$. The additional term $\\eta \\Delta G$ does not satisfy the adjoint property. Specifically, it relates a computation at cell-center $i$ to a force at face $i+\\tfrac{1}{2}$, breaking the symmetry required for summation by parts to lead to cancellation. This \"non-adjoint\" term acts as a source or sink of energy, representing unphysical work done on the system, with its magnitude determined by the coefficient $\\eta$ and the correlation between the velocity field and the curvature of the pressure field.",
            "answer": "$$\\boxed{- \\eta \\sum_{i=1}^{N} u_{i+\\tfrac{1}{2}} \\left( p_{i+1} - 2 p_i + p_{i-1} \\right)}$$"
        }
    ]
}