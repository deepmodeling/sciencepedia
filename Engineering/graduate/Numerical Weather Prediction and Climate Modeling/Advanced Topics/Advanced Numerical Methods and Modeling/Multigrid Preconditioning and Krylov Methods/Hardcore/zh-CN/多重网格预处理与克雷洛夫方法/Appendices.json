{
    "hands_on_practices": [
        {
            "introduction": "在开发迭代求解器时，一个基本问题是：需要多少次迭代才能达到期望的精度？本练习通过一个在数值天气预报（NWP）中常见的典型场景，直接解决了这个问题。通过使用给定的收敛因子，您将学习如何估算多重网格V循环达到目标残差缩减所需的最小迭代次数，这是评估和预测求解器性能的一项核心技能 。",
            "id": "4068391",
            "problem": "在数值天气预报（NWP）中使用的旋转浅水方程的半隐式离散化中，由快引力波项的偏心处理产生的椭圆亥姆霍兹算子是对称正定（SPD）的。预条件共轭梯度（PCG）方法在每次外迭代中使用单个几何多重网格V循环作为右预条件子。考虑应用于线性系统残差的V循环的独立收缩。设双网格收敛因子（定义为每个V循环后连续残差范数的渐近比率）在红黑高斯-赛德尔平滑器和标准粗化下，于具有中纬度配置典型中等各向异性的经纬度网格上测得为 $\\rho = 0.12$。\n\n从残差 $r_k$ 的定义和线性定常过程的收敛因子出发，确定最小整数 $k$，使得经过 $k$ 次V循环后的残差范数满足 $\\|r_k\\| \\le 10^{-8}\\,\\|r_0\\|$。通过显式计算达到的缩减因子 $\\rho^{k}$ 来验证您的估计。以数对 $\\big(k,\\ \\rho^{k}\\big)$ 的形式报告您的答案，其中 $\\rho^{k}$ 四舍五入到 $3$ 位有效数字。无需单位。",
            "solution": "本题要求确定一个定常迭代过程达到指定的残差范数缩减所需的最小迭代次数，用整数 $k$ 表示。所讨论的迭代过程是多重网格V循环，其独立收敛行为由给定的收敛因子来表征。\n\n设 $r_i$ 为应用 $i$ 次V循环后的残差向量，$r_0$ 为初始残差。题目给出了渐近收敛因子 $\\rho$，定义为连续残差向量范数的比率。对于一个线性定常迭代方法，此关系表示为：\n$$ \\frac{\\|r_i\\|}{\\|r_{i-1}\\|} \\approx \\rho $$\n通过重复应用此关系，我们可以用初始残差范数 $\\|r_0\\|$ 来表示 $k$ 次循环后的残差范数 $\\|r_k\\|$：\n$$ \\|r_k\\| \\approx \\rho^k \\|r_0\\| $$\n为了进行此分析，我们将此近似视为等式，这是基于渐近因子估算迭代次数的标准做法。\n\n题目指定了残差缩减的目标：\n$$ \\|r_k\\| \\le 10^{-8} \\|r_0\\| $$\n将 $\\|r_k\\|$ 的表达式代入此不等式，并除以 $\\|r_0\\| > 0$：\n$$ \\rho^k \\le 10^{-8} $$\n给定的收敛因子为 $\\rho = 0.12$。不等式变为：\n$$ (0.12)^k \\le 10^{-8} $$\n为求解 $k$，我们对两边取自然对数。由于 $\\ln(x)$ 是一个严格递增函数，不等号的方向保持不变：\n$$ k \\ln(0.12) \\le -8 \\ln(10) $$\n为了分离出 $k$，我们必须除以 $\\ln(0.12)$。由于 $0.12  1$，其对数 $\\ln(0.12)$ 是一个负数，因此除以它需要反转不等号的方向：\n$$ k \\ge \\frac{-8 \\ln(10)}{\\ln(0.12)} $$\n使用对数的数值，$\\ln(10) \\approx 2.302585$ 和 $\\ln(0.12) \\approx -2.120264$：\n$$ k \\ge \\frac{-8 \\times 2.302585}{-2.120264} \\approx \\frac{18.42068}{2.120264} \\approx 8.6879 $$\n由于 $k$ 必须大于或等于 $8.6879$，满足此条件的最小整数是 $k=9$。\n\n第二个任务是通过计算当 $k=9$ 时达到的缩减因子 $\\rho^k$ 来验证此结果，并将其四舍五入到 $3$ 位有效数字。\n$$ \\rho^k = (0.12)^9 \\approx 5.159780352 \\times 10^{-9} $$\n将此值四舍五入到 $3$ 位有效数字，我们得到 $5.16 \\times 10^{-9}$。这个值确实小于 $10^{-8}$，证实了 $k=9$ 是足够的。对于 $k=8$，缩减量为 $\\rho^8 = (0.12)^8 \\approx 4.2998 \\times 10^{-8}$，大于 $10^{-8}$，这证实了 $k=9$ 是最小的。\n\n因此，V循环的最小次数是 $k=9$，相应的残差范数缩减因子约为 $5.16 \\times 10^{-9}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 9  5.16 \\times 10^{-9} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "多重网格方法的效率在很大程度上取决于其平滑器的性能，而平滑器的效果又对问题的具体性质高度敏感。当模型中存在强各向异性（例如，垂直与水平方向的耦合强度差异巨大）时，简单的逐点平滑器可能会失效。本练习利用局部傅里叶分析（LFA）这一强大工具，深入探究并量化了逐点高斯-赛德尔（Gauss-Seidel）平滑器和更稳健的逐线松弛法在处理各向异性问题时的性能差异 。",
            "id": "4068351",
            "problem": "考虑在静力数值天气预报的半隐式时间步进中出现的各向异性离散椭圆算子，该算子在均匀二维网格上建模为\n$$\nA u_{i,j} \\;=\\; \\frac{c_x}{h^{2}}\\left(-u_{i-1,j} + 2u_{i,j} - u_{i+1,j}\\right) \\;+\\; \\frac{c_z}{h^{2}}\\left(-u_{i,j-1} + 2u_{i,j} - u_{i,j+1}\\right),\n$$\n其中水平 ($x$) 和垂直 ($z$) 方向均为周期性边界条件，网格间距为 $h$，水平耦合系数 $c_x$ 和垂直耦合系数 $c_z$ 均为正值。令各向异性比为 $a = c_z/c_x  0$。假设采用双网格方法，该方法包含一次前平滑和一次后平滑扫描，以及一个消除低频分量的精确粗网格校正。傅里叶频率变量是以弧度为单位的角度。\n\n使用针对周期性网格的局部傅里叶分析 (LFA)，定义：\n- 对于采用字典序的逐点前向高斯-赛德尔平滑，其中块下（过去）邻居是西向和南向耦合，块上（未来）邻居是东向和北向耦合，单次扫描误差传播符号 $S_{\\mathrm{GS}}(\\theta_x,\\theta_z)$ 满足 $A = L + U$（其中 $L$ 包含完整的对角线），并且在傅里叶域中 $S_{\\mathrm{GS}} = -L^{-1}U$。\n- 对于实现为块雅可比方法的垂直线松弛，其中每列中整个垂直三对角耦合都被精确求逆（块对角 $D_{\\mathrm{line}}$ 包含完整的垂直耦合以及来自水平方向的逐点对角贡献），单次扫描误差传播符号为 $S_{\\mathrm{line}}(\\theta_x,\\theta_z) = I - D_{\\mathrm{line}}^{-1}A$，因此符号的模由水平非对角贡献相对于块对角的大小决定。\n\n从离散算子和这些定义出发，针对强垂直各向异性下的一个代表性最坏情况高频误差进行 LFA，即傅里叶模式 $\\theta_x = 0$ 和 $\\theta_z = \\pi$。推导以下各项的闭式表达式：\n1. 对于逐点高斯-赛德尔平滑，采用一次前平滑和一次后平滑扫描所得到的双网格收敛因子 $\\rho_{\\mathrm{GS}}(a)$，近似为在选定高频模式下单次扫描平滑符号的模的平方。\n2. 在相同近似下，垂直线松弛对应的双网格收敛因子 $\\rho_{\\mathrm{line}}(a)$。\n3. 定义为从逐点高斯-赛德尔平滑切换到线松弛时双网格收敛因子之比的改进因子，$I(a) = \\rho_{\\mathrm{GS}}(a)/\\rho_{\\mathrm{line}}(a)$。\n\n将最终答案表示为单个解析表达式，或包含三个用 $a$ 表示的解析表达式的单行矩阵。不需要单位。不要对答案进行四舍五入。",
            "solution": "本分析基于算子对单个傅里叶模式 $u_{i,j} = \\exp(i (i\\theta_x + j\\theta_z))$ 的作用。算子对该模式的作用是乘以其傅里叶符号（特征值）。\n\n首先，我们求离散算子 $A$ 的傅里叶符号 $\\hat{A}(\\theta_x, \\theta_z)$。\n$$\n\\hat{A}(\\theta_x, \\theta_z) = \\frac{c_x}{h^2} (2 - 2\\cos(\\theta_x)) + \\frac{c_z}{h^2} (2 - 2\\cos(\\theta_z)) = \\frac{4c_x}{h^2}\\sin^2(\\frac{\\theta_x}{2}) + \\frac{4c_z}{h^2}\\sin^2(\\frac{\\theta_z}{2})\n$$\n\n**1. 逐点高斯-赛德尔 (GS) 因子 $\\rho_{\\mathrm{GS}}(a)$**\n\n对于字典序，算子 $A$ 被分裂为 $A = L+U$。GS 误差传播算子的符号是 $\\hat{S}_{\\mathrm{GS}} = -\\hat{L}^{-1}\\hat{U}$。其符号为：\n$$\n\\hat{S}_{\\mathrm{GS}}(\\theta_x, \\theta_z) = \\frac{c_x e^{i\\theta_x} + c_z e^{i\\theta_z}}{2(c_x+c_z) - c_x e^{-i\\theta_x} - c_z e^{-i\\theta_z}}\n$$\n代入 $c_z = a c_x$ 并化简：\n$$\n\\hat{S}_{\\mathrm{GS}}(\\theta_x, \\theta_z) = \\frac{e^{i\\theta_x} + a e^{i\\theta_z}}{2(1+a) - e^{-i\\theta_x} - a e^{-i\\theta_z}}\n$$\n在指定模式 $(\\theta_x, \\theta_z) = (0, \\pi)$ 处计算该符号。使用 $e^{i0}=1$ 和 $e^{\\pm i\\pi}=-1$：\n$$\n\\hat{S}_{\\mathrm{GS}}(0, \\pi) = \\frac{1 + a(-1)}{2+2a - 1 - a(-1)} = \\frac{1-a}{1+3a}\n$$\n双网格收敛因子近似为此值的模的平方：\n$$\n\\rho_{\\mathrm{GS}}(a) = |\\hat{S}_{\\mathrm{GS}}(0, \\pi)|^2 = \\left(\\frac{1-a}{1+3a}\\right)^2\n$$\n\n**2. 垂直线松弛因子 $\\rho_{\\mathrm{line}}(a)$**\n\n在线松弛中，算子 $A$ 被分裂为 $A = D_{\\mathrm{line}} + R$。误差传播符号为 $\\hat{S}_{\\mathrm{line}} = I - \\hat{D}_{\\mathrm{line}}^{-1}\\hat{A} = (\\hat{D}_{\\mathrm{line}} - \\hat{A}) / \\hat{D}_{\\mathrm{line}}$。我们得到：\n$$\n\\hat{S}_{\\mathrm{line}}(\\theta_x, \\theta_z) = \\frac{2c_x \\cos(\\theta_x)}{4c_z\\sin^2(\\frac{\\theta_z}{2}) + 2c_x} = \\frac{\\cos(\\theta_x)}{1 + 2a\\sin^2(\\frac{\\theta_z}{2})}\n$$\n在 $(\\theta_x, \\theta_z) = (0, \\pi)$ 处求值，其中 $\\cos(0)=1$ 且 $\\sin(\\pi/2)=1$：\n$$\n\\hat{S}_{\\mathrm{line}}(0, \\pi) = \\frac{1}{1 + 2a(1)^2} = \\frac{1}{1+2a}\n$$\n相应的双网格收敛因子是：\n$$\n\\rho_{\\mathrm{line}}(a) = |\\hat{S}_{\\mathrm{line}}(0, \\pi)|^2 = \\left(\\frac{1}{1+2a}\\right)^2\n$$\n\n**3. 改进因子 $I(a)$**\n\n改进因子是比率 $I(a) = \\rho_{\\mathrm{GS}}(a)/\\rho_{\\mathrm{line}}(a)$：\n$$\nI(a) = \\frac{\\left(\\frac{1-a}{1+3a}\\right)^2}{\\left(\\frac{1}{1+2a}\\right)^2} = \\left( \\frac{(1-a)(1+2a)}{1+3a} \\right)^2\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\left(\\frac{1-a}{1+3a}\\right)^2  \\left(\\frac{1}{1+2a}\\right)^2  \\left(\\frac{(1-a)(1+2a)}{1+3a}\\right)^2\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在现代高性能计算环境中，算法的选择不仅要考虑其数值收敛性，还必须兼顾其并行潜力。一个在数值上稍差但在并行计算上扩展性更好的算法，可能在实践中是更优的选择。本练习完美地揭示了这一核心权衡，通过比较经典的字典序（lexicographic）高斯-赛德尔平滑和并行友好的红黑（red-black）排序，您将同时从数值收敛（通过LFA）和并行加速（通过阿姆达尔定律）两个角度分析其影响 。",
            "id": "4068346",
            "problem": "考虑在数值天气预报和气候建模中使用的正压原始方程模型中出现的半隐式压力修正。在一个均匀的经纬度网格上，每个时间步必须求解的椭圆子问题可以沿单条水平线理想化为具有三点模板的离散一维泊松算子。设离散算子在无限均匀网格上定义为 $A u_i = -u_{i-1} + 2 u_i - u_{i+1}$，并考虑使用高斯-赛德尔 (GS) 方法进行迭代平滑，作为 Krylov 求解器（如预条件共轭梯度法，Preconditioned Conjugate Gradient, PCG）的多重网格预条件子的一部分。\n\n你需要分析红黑着色对并行高斯-赛德尔方法的影响，并以两种方式量化其相对于字典序的性能：\n\n1. 平滑因子变化：在无限网格上使用局部傅里叶分析，推导单次前向字典序高斯-赛德尔扫描作用于傅里叶模式 $e_i = \\exp(\\mathrm{i} \\theta i)$ 时的误差放大因子，并确定字典序平滑因子 $\\mu_{\\mathrm{lex}}$ 为高频集 $\\Theta_{\\mathrm{hf}} = [\\pi/2,\\pi]$ 上放大因子幅值的最大值。然后，分析双色红黑高斯-赛德尔扫描并确定其在相同高频集上的平滑因子 $\\mu_{\\mathrm{RB}}$。最后，计算平滑性能的变化，定义为比率 $\\mu_{\\mathrm{RB}} / \\mu_{\\mathrm{lex}}$，并将此比率表示为一个精确的封闭形式表达式。\n\n2. 并行加速比：使用 Amdahl 定律对在 $P=64$ 个相同处理单元上的并行执行进行建模。假设由于波前依赖性，字典序下可并行化的工作比例为 $\\phi_{\\mathrm{lex}} = 0.70$，而在红黑着色下为 $\\phi_{\\mathrm{RB}} = 0.97$（剩余部分用于同步和通信开销）。设相对于纯串行基线的并行时间因子为 $t_{\\mathrm{lex}}(P) = (1 - \\phi_{\\mathrm{lex}}) + \\phi_{\\mathrm{lex}}/P$ 和 $t_{\\mathrm{RB}}(P) = (1 - \\phi_{\\mathrm{RB}}) + \\phi_{\\mathrm{RB}}/P$。计算红黑高斯-赛德尔相对于字典序的预期加速比，定义为 $S = t_{\\mathrm{lex}}(P) / t_{\\mathrm{RB}}(P)$。\n\n将加速比 $S$ 四舍五入到四位有效数字，并以纯数字形式表示。将平滑因子变化 $\\mu_{\\mathrm{RB}} / \\mu_{\\mathrm{lex}}$ 表示为精确表达式。你的最终答案必须以一个二元行矩阵 $\\begin{pmatrix} S  \\mu_{\\mathrm{RB}}/\\mu_{\\mathrm{lex}} \\end{pmatrix}$ 的形式给出。",
            "solution": "本解答分为两部分：平滑因子分析和并行加速比计算。\n\n**第1部分：平滑因子分析**\n\n我们分析一次迭代中傅里叶模式 $e_i = \\exp(\\mathrm{i} \\theta i)$ 的放大因子 $g(\\theta)$。\n\n**A. 字典序高斯-赛德尔 (GS) 平滑**\n\n对于前向字典序扫描，误差更新满足 $2 e_i^{k+1} - e_{i-1}^{k+1} - e_{i+1}^{k} = 0$。代入傅里叶模式并求解放大因子 $g_{\\mathrm{lex}}(\\theta)$，我们得到：\n$$\ng_{\\mathrm{lex}}(\\theta) = \\frac{\\exp(\\mathrm{i} \\theta)}{2 - \\exp(-\\mathrm{i} \\theta)}\n$$\n其幅值为：\n$$\n|g_{\\mathrm{lex}}(\\theta)| = \\frac{1}{\\sqrt{5 - 4\\cos(\\theta)}}\n$$\n平滑因子 $\\mu_{\\mathrm{lex}}$ 是此幅值在高频范围 $\\Theta_{\\mathrm{hf}} = [\\pi/2, \\pi]$ 上的最大值。该最大值在 $\\theta = \\pi/2$ 处取得：\n$$\n\\mu_{\\mathrm{lex}} = |g_{\\mathrm{lex}}(\\pi/2)| = \\frac{1}{\\sqrt{5 - 4\\cos(\\pi/2)}} = \\frac{1}{\\sqrt{5}}\n$$\n\n**B. 红黑高斯-赛德尔 (GS) 平滑**\n\n对于红黑排序，误差放大因子为 $g_{\\mathrm{RB}}(\\theta) = \\cos^2(\\theta)$。平滑因子 $\\mu_{\\mathrm{RB}}$ 是其幅值在 $\\Theta_{\\mathrm{hf}} = [\\pi/2, \\pi]$ 上的最大值。该最大值在 $\\theta = \\pi$ 处取得：\n$$\n\\mu_{\\mathrm{RB}} = \\max_{\\theta \\in [\\pi/2, \\pi]} |\\cos^2(\\theta)| = \\cos^2(\\pi) = (-1)^2 = 1\n$$\n\n**C. 平滑因子的变化**\n\n平滑性能的变化是比率 $\\mu_{\\mathrm{RB}} / \\mu_{\\mathrm{lex}}$：\n$$\n\\frac{\\mu_{\\mathrm{RB}}}{\\mu_{\\mathrm{lex}}} = \\frac{1}{1/\\sqrt{5}} = \\sqrt{5}\n$$\n\n**第2部分：并行加速比分析**\n\n我们使用给定的阿姆达尔定律公式进行计算。已知 $P = 64$，$\\phi_{\\mathrm{lex}} = 0.70$，$\\phi_{\\mathrm{RB}} = 0.97$。\n\n字典序方法的并行时间因子是：\n$$\nt_{\\mathrm{lex}}(64) = (1 - 0.70) + \\frac{0.70}{64} = 0.30 + 0.0109375 = 0.3109375\n$$\n红黑方法的并行时间因子是：\n$$\nt_{\\mathrm{RB}}(64) = (1 - 0.97) + \\frac{0.97}{64} = 0.03 + 0.01515625 = 0.04515625\n$$\n红黑相对于字典序的预期加速比 $S$ 是：\n$$\nS = \\frac{t_{\\mathrm{lex}}(64)}{t_{\\mathrm{RB}}(64)} = \\frac{0.3109375}{0.04515625} \\approx 6.8860759...\n$$\n四舍五入到四位有效数字，我们得到 $S \\approx 6.886$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 6.886  \\sqrt{5} \\end{pmatrix}}$$"
        }
    ]
}