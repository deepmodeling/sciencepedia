{
    "hands_on_practices": [
        {
            "introduction": "热力学图上的等值线形状并非随意绘制，而是由基本物理定律决定的。本练习将从第一性原理出发，直接从克劳修斯-克拉佩龙（Clausius-Clapeyron）关系推导一个关键量——饱和混合比的温度敏感性 。这项实践有助于我们理解湿空气中水分含量随温度变化的速率，这是湿热力学和对流预报的基石。",
            "id": "4104671",
            "problem": "考虑一个在数值天气预报（NWP）和热力学图分析框架下描述的饱和气块。饱和混合比 $w_s$ 定义为饱和状态下气块中水汽质量与干空气质量之比，是决定热力学图上等值线几何形状以及对流指数敏感性的关键量。从相平衡的 Clausius–Clapeyron 关系和理想气体定律（IGL）出发，推导饱和混合比的对数形式的定压温度敏感度的解析表达式，$S(T,p) = \\left( \\partial \\ln w_s / \\partial T \\right)_p$，该表达式仅用 $T$、$p$ 和基本常数表示。假设以下科学上标准的理想化条件：水汽和干空气表现为理想气体，比汽化潜热 $L_v$ 在所关心的温度范围内与温度无关，液态水的比容与水汽的比容相比可以忽略不计，干空气和水汽的气体常数分别为 $R_d$ 和 $R_v$。使用水的三相点处平面液面上的参考饱和水汽压，$e_{s,0} = 611.65\\,\\mathrm{Pa}$（在 $T_0 = 273.15\\,\\mathrm{K}$ 时）。然后，使用 $L_v = 2.5 \\times 10^{6}\\,\\mathrm{J\\,kg^{-1}}$，$R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 和 $R_d = 287.06\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，计算在 $T = 300\\,\\mathrm{K}$ 和 $p = 9.0 \\times 10^{4}\\,\\mathrm{Pa}$ 时的敏感度。将您的最终答案四舍五入到四位有效数字。以每开尔文为单位表示最终的敏感度。",
            "solution": "该问题要求推导和评估饱和混合比的对数形式的定压温度敏感度，定义为 $S(T,p) = \\left( \\partial \\ln w_s / \\partial T \\right)_p$。推导必须从第一性原理开始，即理想气体定律（IGL）和 Clausius-Clapeyron 关系，并在一组指定的标准理想化条件下进行。\n\n首先，我们建立饱和混合比 $w_s$ 的表达式。根据定义，$w_s$ 是给定体积 $V$ 的气块内水汽质量 $m_v$ 与干空气质量 $m_d$ 之比。\n$$w_s = \\frac{m_v}{m_d}$$\n将理想气体定律应用于每个组分，其中 $p_d$ 是干空气的分压，$e_s$ 是饱和水汽压，我们得到：\n$$p_d V = m_d R_d T$$\n$$e_s V = m_v R_v T$$\n此处，$R_d$ 和 $R_v$ 分别是干空气和水汽的比气体常数，$T$ 是温度。总压 $p$ 是分压之和，$p = p_d + e_s$。\n通过取这两个理想气体定律方程的比值，我们可以用压力来表示 $w_s$：\n$$\\frac{m_v}{m_d} = \\frac{e_s V / (R_v T)}{p_d V / (R_d T)} = \\frac{R_d}{R_v} \\frac{e_s}{p_d}$$\n令 $\\epsilon = R_d / R_v$ 为气体常数之比。代入 $p_d = p - e_s$，我们得到饱和混合比的标准表达式：\n$$w_s = \\epsilon \\frac{e_s}{p - e_s}$$\n注意 $e_s$ 仅是温度 $T$ 的函数，而 $p$ 是一个独立的状态变量。\n\n接下来，我们使用 Clausius-Clapeyron 关系来处理 $e_s$ 对温度的依赖性。对于液态水和水汽之间的相变，在液相比容远小于汽相比容（$\\nu_v \\gg \\nu_l$）且水汽表现为理想气体（$\\nu_v = R_v T / e_s$）的假设下，该关系式形式如下：\n$$\\frac{de_s}{dT} = \\frac{L_v}{T(\\nu_v - \\nu_l)} \\approx \\frac{L_v}{T\\nu_v} = \\frac{L_v e_s}{R_v T^2}$$\n其中 $L_v$ 是比汽化潜热，假定为常数。整理后得到一个关键的微分关系：\n$$\\frac{1}{e_s} \\frac{de_s}{dT} = \\frac{L_v}{R_v T^2}$$\n该方程可以从参考状态 $(T_0, e_{s,0})$ 积分到状态 $(T, e_s)$，以找到 $e_s(T)$ 的显式函数形式：\n$$e_s(T) = e_{s,0} \\exp\\left[ \\frac{L_v}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{T} \\right) \\right]$$\n\n现在我们可以推导敏感度 $S(T,p)$ 的表达式。我们首先对 $w_s$ 的表达式取自然对数：\n$$\\ln w_s = \\ln\\left(\\epsilon \\frac{e_s}{p - e_s}\\right) = \\ln(\\epsilon) + \\ln(e_s) - \\ln(p - e_s)$$\n然后，我们在保持 $p$ 恒定的情况下，对该表达式关于 $T$求导：\n$$S(T,p) = \\left( \\frac{\\partial \\ln w_s}{\\partial T} \\right)_p = \\frac{\\partial}{\\partial T} \\left[ \\ln(\\epsilon) + \\ln(e_s) - \\ln(p - e_s) \\right]_p$$\n由于 $\\epsilon$ 是一个常数，其导数为零。对其他项使用链式法则，我们得到：\n$$S(T,p) = \\frac{1}{e_s}\\frac{de_s}{dT} - \\frac{1}{p - e_s} \\frac{\\partial}{\\partial T}(p - e_s)_p$$\n因为 $p$ 保持不变，其对 $T$ 的偏导数为零。$e_s(T)$ 的导数是全导数。\n$$S(T,p) = \\frac{1}{e_s}\\frac{de_s}{dT} - \\frac{1}{p - e_s} \\left(-\\frac{de_s}{dT}\\right) = \\left( \\frac{1}{e_s} + \\frac{1}{p-e_s} \\right) \\frac{de_s}{dT}$$\n合并括号中的项得到：\n$$S(T,p) = \\left( \\frac{p-e_s+e_s}{e_s(p-e_s)} \\right) \\frac{de_s}{dT} = \\frac{p}{e_s(p-e_s)}\\frac{de_s}{dT}$$\n现在我们代入由 Clausius-Clapeyron 关系式得到的导数 $\\frac{de_s}{dT} = e_s \\frac{L_v}{R_v T^2}$：\n$$S(T,p) = \\frac{p}{e_s(p-e_s)} \\left( e_s \\frac{L_v}{R_v T^2} \\right)$$\n$e_s$ 项被消去，从而得到敏感度的简化解析表达式：\n$$S(T,p) = \\frac{p}{p - e_s(T)} \\frac{L_v}{R_v T^2}$$\n此表达式依赖于 $T$、$p$ 和饱和水汽压 $e_s(T)$，而 $e_s(T)$ 本身是如前所推导的 $T$ 和基本常数的函数。\n\n问题的第二部分是使用给定的参数评估此敏感度：$T = 300\\,\\mathrm{K}$，$p = 9.0 \\times 10^{4}\\,\\mathrm{Pa}$，$L_v = 2.5 \\times 10^{6}\\,\\mathrm{J\\,kg^{-1}}$，$R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$e_{s,0} = 611.65\\,\\mathrm{Pa}$ 以及 $T_0 = 273.15\\,\\mathrm{K}$。\n\n首先，我们必须计算在 $T = 300\\,\\mathrm{K}$ 时的饱和水汽压 $e_s$：\n$$e_s(300\\,\\mathrm{K}) = e_{s,0} \\exp\\left[ \\frac{L_v}{R_v} \\left( \\frac{1}{T_0} - \\frac{1}{300\\,\\mathrm{K}} \\right) \\right]$$\n$$e_s(300\\,\\mathrm{K}) = 611.65\\,\\mathrm{Pa} \\times \\exp\\left[ \\frac{2.5 \\times 10^6\\,\\mathrm{J\\,kg^{-1}}}{461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}} \\left( \\frac{1}{273.15\\,\\mathrm{K}} - \\frac{1}{300\\,\\mathrm{K}} \\right) \\right]$$\n$$e_s(300\\,\\mathrm{K}) \\approx 611.65\\,\\mathrm{Pa} \\times \\exp\\left[ 5417.118\\,\\mathrm{K} \\left( 0.00366094\\,\\mathrm{K^{-1}} - 0.00333333\\,\\mathrm{K^{-1}} \\right) \\right]$$\n$$e_s(300\\,\\mathrm{K}) \\approx 611.65\\,\\mathrm{Pa} \\times \\exp(1.77496) \\approx 3608.55\\,\\mathrm{Pa}$$\n\n现在，将 $e_s$ 的这个值和其他给定参数代入 $S(T,p)$ 的表达式中：\n$$S(300\\,\\mathrm{K}, 9.0 \\times 10^4\\,\\mathrm{Pa}) = \\frac{9.0 \\times 10^4\\,\\mathrm{Pa}}{9.0 \\times 10^4\\,\\mathrm{Pa} - 3608.55\\,\\mathrm{Pa}} \\times \\frac{2.5 \\times 10^6\\,\\mathrm{J\\,kg^{-1}}}{461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}} \\times (300\\,\\mathrm{K})^2}$$\n$$S = \\frac{90000}{86391.45} \\times \\frac{2.5 \\times 10^6}{461.5 \\times 90000\\,\\mathrm{K}}$$\n$$S \\approx (1.04177) \\times (0.0601902\\,\\mathrm{K^{-1}})$$\n$$S \\approx 0.06270316\\,\\mathrm{K^{-1}}$$\n将结果四舍五入到四位有效数字，我们得到 $S \\approx 0.06270\\,\\mathrm{K^{-1}}$。",
            "answer": "$$\\boxed{0.06270}$$"
        },
        {
            "introduction": "本练习将理论与实践相结合，从单个点的属性分析转向对整个大气柱的诊断。您将编写一个程序，使用高度计方程从气压数据计算几何高度 。更重要的是，本练习引入了布伦特-维萨拉（Brunt–Väisälä）频率，这是一个比许多经验性对流指数更为严谨的静力稳定度度量，对于理解大气波动和对流的触发至关重要。",
            "id": "4104675",
            "problem": "您将推导并实现一个程序，该程序使用静力平衡关系和测高关系来计算离散大气柱的几何高度和一个对流稳定性诊断量，并通过 Brunt–Väisälä 频率将公式与对流指数联系起来。推导必须从基本定律和经过充分检验的公式开始，并且实现必须与这些原则保持一致。\n\n给定一组测试用例，每个测试用例包含压力、温度和水汽混合比的垂直廓线。您的任务是：\n\n- 从第一性原理出发，推导用于从压力和虚温计算几何层厚度的表达式，不使用任何预先提供的“快捷”公式。\n- 推导作为对流稳定性度量的 Brunt–Väisälä 频率平方的定义和离散近似，并使用静力平衡关系将压力坐标转换为高度坐标。\n- 实现一个程序，为每个测试用例计算以下量：\n  1. 第一个和最后一个气压层之间的总几何厚度，单位为米。\n  2. 柱平均虚温，单位为开尔文，通过对整个气柱的测高关系进行代数反演得到。\n  3. 对流不稳定层的数量，定义为 Brunt–Väisälä 频率平方为负的层。\n\n在国际单位制（SI）中使用以下物理常数：干空气比气体常数 $R_d = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，定压比热 $c_p = 1004\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，重力加速度 $g = 9.80665\\ \\mathrm{m\\,s^{-2}}$，以及参考压力 $p_{\\mathrm{ref}} = 100000\\ \\mathrm{Pa}$。使用虚温的近似公式 $T_v = T\\,(1 + 0.61\\,r)$，其中 $T$ 是以开尔文为单位的温度，$r$ 是以 $\\mathrm{kg\\,kg^{-1}}$ 为单位的水汽混合比。通过 $\\theta = T\\,(p_{\\mathrm{ref}}/p)^{\\kappa}$ 定义位温，其中 $\\kappa = R_d/c_p$。\n\n对于每个测试用例，您将收到压力 $p_i$（帕斯卡）、温度 $T_i$（开尔文）和混合比 $r_i$（$\\mathrm{kg\\,kg^{-1}}$）的数组，这些数组从地面到高层排列，压力严格递减。您必须：\n\n- 将第一个（地面）层级的几何高度设置为 $z_0 = 0\\ \\mathrm{m}$。\n- 使用以层平均虚温计算的测高积分来计算层厚度。累加以获得所有层级的高度 $z_i$。\n- 计算每个层级的位温。\n- 使用基于层差分的一致离散近似计算每层的 Brunt–Väisälä 频率平方。\n- 将 Brunt–Väisälä 频率平方为负的层计数为对流不稳定层。\n\n以 $\\mathrm{m}$ 为单位表示最终的几何厚度，以 $\\mathrm{K}$ 为单位表示柱平均虚温。角度不会出现。如果您在内部计算百分比，则必须以小数或分数形式输出，但此处不要求输出百分比。\n\n提供以下四个测试用例：\n\n- 测试用例 A（典型的中纬度对流层片段）：\n  - 气压层 $[\\,100000,\\ 90000,\\ 80000,\\ 70000,\\ 60000,\\ 50000\\,]$，单位 $\\mathrm{Pa}$。\n  - 温度廓线 $[\\,290,\\ 284,\\ 278,\\ 272,\\ 266,\\ 260\\,]$，单位 $\\mathrm{K}$。\n  - 混合比廓线 $[\\,0.012,\\ 0.010,\\ 0.008,\\ 0.006,\\ 0.004,\\ 0.002\\,]$，单位 $\\mathrm{kg\\,kg^{-1}}$。\n\n- 测试用例 B（等温、弱湿润气柱）：\n  - 气压层 $[\\,100000,\\ 90000,\\ 80000,\\ 70000,\\ 60000,\\ 50000\\,]$，单位 $\\mathrm{Pa}$。\n  - 温度廓线 $[\\,280,\\ 280,\\ 280,\\ 280,\\ 280,\\ 280\\,]$，单位 $\\mathrm{K}$。\n  - 混合比廓线 $[\\,0.004,\\ 0.004,\\ 0.004,\\ 0.004,\\ 0.004,\\ 0.004\\,]$，单位 $\\mathrm{kg\\,kg^{-1}}$。\n\n- 测试用例 C（位温恒定的干绝热气柱）：\n  - 气压层 $[\\,100000,\\ 90000,\\ 80000,\\ 70000,\\ 60000,\\ 50000\\,]$，单位 $\\mathrm{Pa}$。\n  - 位温恒定为 $[\\,300,\\ 300,\\ 300,\\ 300,\\ 300,\\ 300\\,]$，单位 $\\mathrm{K}$；使用 $\\theta = T\\,(p_{\\mathrm{ref}}/p)^{\\kappa}$（其中 $\\kappa = R_d/c_p$）计算相应的温度廓线，并取所有层级的 $r = 0$。\n\n- 测试用例 D（指示对流不稳定的低层超绝热层）：\n  - 气压层 $[\\,100000,\\ 90000,\\ 80000,\\ 70000,\\ 60000,\\ 50000\\,]$，单位 $\\mathrm{Pa}$。\n  - 温度廓线 $[\\,305,\\ 294,\\ 286,\\ 278,\\ 270,\\ 262\\,]$，单位 $\\mathrm{K}$。\n  - 混合比廓线 $[\\,0.014,\\ 0.012,\\ 0.010,\\ 0.006,\\ 0.003,\\ 0.001\\,]$，单位 $\\mathrm{kg\\,kg^{-1}}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果以三元素列表 $[\\,\\Delta z,\\ T_{v,\\mathrm{avg}},\\ n_{\\mathrm{unstable}}\\,]$ 的形式报告，其中 $\\Delta z$ 是总几何厚度（$\\mathrm{m}$），$T_{v,\\mathrm{avg}}$ 是柱平均虚温（$\\mathrm{K}$），$n_{\\mathrm{unstable}}$ 是不稳定层的整数计数。例如，总输出应如下所示：$[[\\ldots],[\\ldots],[\\ldots],[\\ldots]]$，列表中无空格。\n\n您的实现必须是一个完整的、可运行的程序，如最终答案部分所规定。",
            "solution": "该问题是有效的，因为它在科学上基于已建立的大气热力学原理，问题设定良好，有足够的数据和明确的目标，并以精确、客观的语言表达。所有常数和控制方程都是该领域的标准。所提供的测试用例在物理上是合理的，用于在不同条件下测试推导出的算法。该问题是可形式化的，需要进行重要的推导和实现，使其成为一项实质性的任务。\n\n解决方案分为两部分进行：首先，从第一性原理推导必要的物理和数学关系；其次，描述实现这些关系的数值算法。\n\n### 物理关系的推导\n\n**1. 几何层厚度（测高公式）**\n\n大气中压力和高度之间的关系由静力平衡方程决定，该方程平衡了静止流体微团上的垂直气压梯度力和重力：\n$$\n\\frac{dp}{dz} = -\\rho g\n$$\n其中 $p$ 是压力，$z$ 是几何高度，$\\rho$ 是空气密度，$g$ 是重力加速度。\n\n湿空气的密度可以用理想气体定律表示，并使用虚温 $T_v$ 进行修正以考虑湿空气相对于干空气更低的平均分子量：\n$$\np = \\rho R_d T_v\n$$\n其中 $R_d$ 是干空气的比气体常数。问题提供了虚温的近似公式 $T_v = T(1 + 0.61r)$，其中 $T$ 是空气温度，$r$ 是水汽混合比。\n\n求解密度 $\\rho = p / (R_d T_v)$ 并代入静力平衡方程得到：\n$$\n\\frac{dp}{dz} = -\\frac{p g}{R_d T_v}\n$$\n这是一个关联压力和高度的微分方程。为求得一个层的厚度，我们可以分离变量并积分：\n$$\ndz = -\\frac{R_d T_v}{g} \\frac{dp}{p}\n$$\n在两个气压层 $p_1$（低层）和 $p_2$（高层）之间积分此方程，对应高度 $z_1$ 和 $z_2$，得到层厚度 $\\Delta z = z_2 - z_1$：\n$$\n\\int_{z_1}^{z_2} dz = \\Delta z = -\\frac{R_d}{g} \\int_{p_1}^{p_2} \\frac{T_v}{p} dp = \\frac{R_d}{g} \\int_{p_2}^{p_1} \\frac{T_v}{p} dp\n$$\n为计算此积分，我们假设虚温在层内随 $\\ln(p)$ 线性变化，这使我们可以用其层平均值 $\\bar{T}_v$ 来代替 $T_v$。问题指定使用层边界处虚温的算术平均值：\n$$\n\\bar{T}_v = \\frac{T_{v,1} + T_{v,2}}{2}\n$$\n使用此近似，积分变为：\n$$\n\\Delta z = \\frac{R_d \\bar{T}_v}{g} \\int_{p_2}^{p_1} \\frac{dp}{p} = \\frac{R_d \\bar{T}_v}{g} [\\ln(p)]_{p_2}^{p_1}\n$$\n这得到了用于计算层厚度的测高公式：\n$$\n\\Delta z = \\frac{R_d \\bar{T}_v}{g} \\ln\\left(\\frac{p_1}{p_2}\\right)\n$$\n此方程将用于计算大气廓线中每个离散层的厚度。总几何厚度是这些单个层厚度的总和。\n\n**2. 柱平均虚温**\n\n测高公式可以应用于从地表（层级 $0$）到顶部（层级 $N-1$）的整个大气柱。总几何厚度 $\\Delta z_{\\text{total}} = z_{N-1} - z_0$ 通过单一的柱平均虚温 $T_{v,\\text{avg}}$ 关联如下：\n$$\n\\Delta z_{\\text{total}} = \\frac{R_d T_{v,\\text{avg}}}{g} \\ln\\left(\\frac{p_0}{p_{N-1}}\\right)\n$$\n问题要求通过对此关系进行代数反演来计算此 $T_{v,\\text{avg}}$。求解 $T_{v,\\text{avg}}$ 得到：\n$$\nT_{v,\\text{avg}} = \\frac{g \\, \\Delta z_{\\text{total}}}{R_d \\ln(p_0/p_{N-1})}\n$$\n其中 $\\Delta z_{\\text{total}}$ 首先通过对使用上一节方法计算的单个层厚度求和来计算。\n\n**3. Brunt–Väisälä 频率与对流稳定性**\n\nBrunt–Väisälä 频率 $N$ 量化了流体柱的静力稳定性。其平方 $N^2$ 表示垂直位移的流体微团单位位移所受的恢复加速度。考虑一个向上绝热位移微小距离 $\\delta z$ 的微团。微团上单位质量的净浮力近似为 $g(\\rho_e - \\rho_p)/\\rho_p$，其中下标 $e$ 和 $p$ 分别表示环境和微团。这可以用虚位温 $\\theta_v$ 来表示，它是指如果一个气块中的所有水分都凝结并移除，且潜热加热了该气块，则该气块所具有的位温。对于绝热位移，微团的 $\\theta_v$ 是守恒的。在高度 $z + \\delta z$ 处的环境 $\\theta_v$ 近似为 $\\theta_{v,e}(z) + (d\\theta_{v,e}/dz) \\delta z$。浮力导致了微团垂直位移的运动方程：\n$$\n\\frac{d^2(\\delta z)}{dt^2} = -\\left(\\frac{g}{\\theta_{v,e}} \\frac{d\\theta_{v,e}}{dz}\\right) \\delta z\n$$\n这是简谐运动的方程，其中角频率的平方是括号中的项。因此，我们将 Brunt–Väisälä 频率的平方定义为：\n$$\nN^2 = \\frac{g}{\\theta_v} \\frac{d\\theta_v}{dz}\n$$\n虚位温 $\\theta_v$ 由 $\\theta_v = T_v (p_{\\text{ref}}/p)^{\\kappa} = \\theta(1+0.61r)$ 给出，其中 $\\theta = T(p_{\\text{ref}}/p)^{\\kappa}$ 是位温，$\\kappa = R_d/c_p$。\n- 如果 $N^2 > 0$，$(d\\theta_v/dz > 0)$，位移的微团会受到一个恢复力，导致振荡。大气是静力稳定的。\n- 如果 $N^2 = 0$，$(d\\theta_v/dz = 0)$，位移的微团没有受到净力。大气是中性稳定的。\n- 如果 $N^2  0$，$(d\\theta_v/dz  0)$，位移的微团会受到一个使其进一步偏离原始位置的力。大气是对流不稳定的。\n\n对于离散的大气廓线，我们使用有限差分来近似计算层级 $i$（低层）和 $i+1$（高层）之间层的 $N^2$。导数 $d\\theta_v/dz$ 近似为 $\\Delta\\theta_v/\\Delta z = (\\theta_{v,i+1} - \\theta_{v,i})/(z_{i+1} - z_i)$，而 $\\theta_v$ 由层平均值 $\\bar{\\theta}_v = (\\theta_{v,i} + \\theta_{v,i+1})/2$ 近似。\n$$\nN^2_i \\approx \\frac{g}{\\bar{\\theta}_{v,i}} \\frac{\\Delta\\theta_{v,i}}{\\Delta z_i} = \\frac{2g}{\\theta_{v,i} + \\theta_{v,i+1}} \\frac{\\theta_{v,i+1} - \\theta_{v,i}}{z_{i+1} - z_i}\n$$\n由于 $g$、$\\bar{\\theta}_v$（以开尔文为单位）和 $\\Delta z$ 总是正的，所以 $N^2_i$ 的符号仅由 $\\theta_{v,i+1} - \\theta_{v,i}$ 的符号决定。因此，当且仅当一个层的虚位温随高度减小时，该层是对流不稳定的：\n$$\n\\text{不稳定层条件: } \\theta_{v,i+1}  \\theta_{v,i}\n$$\n\n### 数值实现算法\n\n每个测试用例的总体算法如下：\n1.  定义物理常数：$R_d = 287$，$c_p = 1004$，$g = 9.80665$，$p_{\\text{ref}} = 100000$。计算 $\\kappa = R_d/c_p$。\n2.  对每个测试用例，获取压力 $p_i$、温度 $T_i$ 和混合比 $r_i$ 的输入数组。对于用例 C，首先使用 $T_i = \\theta_i (p_i/p_{\\text{ref}})^{\\kappa}$ 从给定的恒定位温计算温度廓线。\n3.  计算每个层级 $i$ 的虚温 $T_{v,i} = T_i(1 + 0.61r_i)$。\n4.  初始化一个高度数组，其中 $z_0 = 0$。\n5.  从 $i = 0$ 到倒数第二个层级遍历大气层：\n    a. 计算层平均虚温 $\\bar{T}_{v,i} = (T_{v,i} + T_{v,i+1})/2$。\n    b. 计算层厚度 $\\Delta z_i = \\frac{R_d \\bar{T}_{v,i}}{g} \\ln(p_i/p_{i+1})$。\n    c. 计算下一层级的高度 $z_{i+1} = z_i + \\Delta z_i$ 并存储它。\n6.  总几何厚度 $\\Delta z_{\\text{total}}$ 是最终计算出的高度 $z_{N-1}$。\n7.  计算柱平均虚温 $T_{v,\\text{avg}} = \\frac{g \\, \\Delta z_{\\text{total}}}{R_d \\ln(p_0/p_{N-1})}$。\n8.  计算所有层级的位温 $\\theta_i = T_i (p_{\\text{ref}}/p_i)^{\\kappa}$，然后计算虚位温 $\\theta_{v,i} = \\theta_i(1+0.61r_i)$。\n9.  初始化不稳定层计数器 $n_{\\text{unstable}} = 0$。\n10. 再次遍历各层。对于每层 $i$，检查是否 $\\theta_{v,i+1}  \\theta_{v,i}$。如果为真，则增加 $n_{\\text{unstable}}$。\n11. 将计算出的三个值 $[\\Delta z_{\\text{total}}, T_{v,\\text{avg}}, n_{\\text{unstable}}]$ 组合为该测试用例的结果。\n12. 处理完所有测试用例后，将收集的结果格式化为指定的字符串格式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements methods to compute atmospheric column diagnostics.\n    \"\"\"\n    # Physical Constants in SI units\n    R_d = 287.0  # J kg^-1 K^-1\n    c_p = 1004.0 # J kg^-1 K^-1\n    g = 9.80665 # m s^-2\n    p_ref = 100000.0 # Pa\n    kappa = R_d / c_p\n\n    # Test cases data\n    test_cases_data = [\n        {\n            \"id\": \"A\",\n            \"p\": np.array([100000, 90000, 80000, 70000, 60000, 50000]), # Pa\n            \"T\": np.array([290, 284, 278, 272, 266, 260]), # K\n            \"r\": np.array([0.012, 0.010, 0.008, 0.006, 0.004, 0.002]) # kg/kg\n        },\n        {\n            \"id\": \"B\",\n            \"p\": np.array([100000, 90000, 80000, 70000, 60000, 50000]), # Pa\n            \"T\": np.array([280, 280, 280, 280, 280, 280]), # K\n            \"r\": np.array([0.004, 0.004, 0.004, 0.004, 0.004, 0.004]) # kg/kg\n        },\n        {\n            \"id\": \"C\",\n            \"p\": np.array([100000, 90000, 80000, 70000, 60000, 50000]), # Pa\n            \"theta_const\": 300.0, # K\n            \"r\": np.zeros(6) # kg/kg\n        },\n        {\n            \"id\": \"D\",\n            \"p\": np.array([100000, 90000, 80000, 70000, 60000, 50000]), # Pa\n            \"T\": np.array([305, 294, 286, 278, 270, 262]), # K\n            \"r\": np.array([0.014, 0.012, 0.010, 0.006, 0.003, 0.001]) # kg/kg\n        }\n    ]\n\n    def calculate_profile_diagnostics(p, T, r):\n        \"\"\"\n        Computes total thickness, average virtual temperature, and unstable layer count.\n        \n        Args:\n            p (np.array): Pressure levels [Pa].\n            T (np.array): Temperature levels [K].\n            r (np.array): Mixing ratio levels [kg/kg].\n\n        Returns:\n            tuple: (total_thickness, avg_virtual_temp, unstable_layers_count)\n        \"\"\"\n        # 1. Calculate virtual temperature at each level\n        Tv = T * (1 + 0.61 * r)\n        \n        # 2. Compute geometric heights and total thickness\n        heights = np.zeros_like(p, dtype=float)\n        heights[0] = 0.0\n        \n        for i in range(len(p) - 1):\n            p_i, p_i_plus_1 = p[i], p[i+1]\n            Tv_i, Tv_i_plus_1 = Tv[i], Tv[i+1]\n            \n            # Layer-mean virtual temperature\n            Tv_bar = (Tv_i + Tv_i_plus_1) / 2.0\n            \n            # Hypsometric equation for layer thickness\n            delta_z = (R_d * Tv_bar / g) * np.log(p_i / p_i_plus_1)\n            \n            heights[i+1] = heights[i] + delta_z\n            \n        total_thickness = heights[-1]\n        \n        # 3. Compute column-average virtual temperature\n        p0, p_final = p[0], p[-1]\n        avg_virtual_temp = (g * total_thickness) / (R_d * np.log(p0 / p_final))\n        \n        # 4. Compute virtual potential temperature and count unstable layers\n        theta = T * (p_ref / p)**kappa\n        theta_v = theta * (1 + 0.61 * r)\n        \n        unstable_layers_count = 0\n        for i in range(len(p) - 1):\n            if theta_v[i+1]  theta_v[i]:\n                unstable_layers_count += 1\n        \n        return total_thickness, avg_virtual_temp, unstable_layers_count\n\n    results = []\n    for case in test_cases_data:\n        p = case[\"p\"]\n        r = case[\"r\"]\n        \n        if \"theta_const\" in case:\n            # For Case C, calculate T from constant theta\n            T = case[\"theta_const\"] * (p / p_ref)**kappa\n        else:\n            T = case[\"T\"]\n            \n        dz, Tv_avg, n_unstable = calculate_profile_diagnostics(p, T, r)\n        results.append([dz, Tv_avg, n_unstable])\n\n    # Format the final output string exactly as required\n    output_parts = [f\"[{res[0]},{res[1]},{res[2]}]\" for res in results]\n    final_string = f\"[{','.join(output_parts)}]\"\n    print(final_string)\n\nsolve()\n```"
        },
        {
            "introduction": "本练习深入探讨了在有云存在时浮力计算这一高级但至关重要的主题。这项实践明确区分了虚温（仅考虑水汽影响）和密度温度（额外考虑液态水和冰的拖曳效应）。准确计算浮力对于数值天气预报模型模拟对流活动至关重要，而这个编码练习将让您直接体验这些现代气象学中的核心概念。",
            "id": "4104684",
            "problem": "考虑一个包含干空气、水汽、液态水和冰的湿空气块。设 $p$ 为气块压力（单位为 $\\mathrm{Pa}$），$T$ 为气块温度（单位为 $\\mathrm{K}$），$r_v$ 为水汽混合比（单位质量干空气中的水汽质量，单位为 $\\mathrm{kg/kg}$），$r_l$ 为液态水混合比（单位为 $\\mathrm{kg/kg}$），$r_i$ 为冰混合比（单位为 $\\mathrm{kg/kg}$）。设 $R_d$ 为干空气的比气体常数（单位为 $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$），$R_v$ 为水汽的比气体常数（单位为 $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$）。定义 $\\varepsilon = R_d / R_v$。取重力加速度 $g$（单位为 $\\mathrm{m\\,s^{-2}}$）。\n\n基本原理：\n- 对于气体组分，其理想气体定律 (IGL) 为 $p_x = \\rho_x R_x T$，其中 $p_x$ 是分压，$\\rho_x$ 是密度，$R_x$ 是组分 $x$ 的比气体常数。\n- Dalton 分压定律指出 $p = p_d + p_v$，其中下标 $d$ 和 $v$ 分别表示干空气和水汽。\n- 混合比的定义为 $r_x = m_x / m_d$，其中 $m_x$ 是组分 $x$ 的质量，$m_d$ 是气块中干空气的质量。\n- 虚温是指，在相同压力下，纯干空气达到与湿润气体混合物的气相密度相同时所具有的温度。\n- 密度温度是指，在相同压力下，纯干空气达到与真实气块的总密度（包括液态水和冰的凝结物负载）相同时所具有的温度。\n\n任务：\n1. 仅从上述基本原理出发，推导气块虚温 $T_v$ 和密度温度 $T_{\\rho}$ 关于 $T$、$r_v$、$r_l$、$r_i$ 和 $\\varepsilon$ 的精确表达式。您的推导必须有理有据，不得引用任何简便公式。\n2. 使用关于 $r_v = 0$、$r_l = 0$ 和 $r_i = 0$ 的一阶泰勒展开，求得 $T_{\\rho}$ 对混合比的主导阶线性近似。\n3. 对于一个由压力 $p$（与气块相同）、温度 $T_{\\mathrm{env}}$（单位为 K）和水汽混合比 $r_{v,\\mathrm{env}}$（单位为 kg/kg）表征的环境状态，使用相同的物理原理计算环境虚温 $T_{v,\\mathrm{env}}$。假设环境中的凝结物可忽略不计，即 $r_{l,\\mathrm{env}} = r_{i,\\mathrm{env}} = 0$。\n4. 使用密度温度近似法计算气块的浮力加速度 $B$，其定义为\n$$\nB = g \\frac{T_{\\rho} - T_{v,\\mathrm{env}}}{T_{v,\\mathrm{env}}},\n$$\n单位为 $\\mathrm{m\\,s^{-2}}$。\n5. 对于下面指定的每个测试用例，计算：\n   - 精确虚温 $T_v$（单位：K）。\n   - 精确密度温度 $T_{\\rho}$（单位：K）。\n   - 精确 $T_{\\rho}$ 与其在步骤 2 中得到的一阶线性近似之间的绝对差值（单位：K）。\n   - 浮力加速度 $B$（单位：$\\mathrm{m\\,s^{-2}}$）。\n   将所有四个输出结果四舍五入至六位小数。\n\n使用的常数：\n- $R_d = 287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，\n- $R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，\n- $g = 9.80665\\,\\mathrm{m\\,s^{-2}}$。\n\n测试组（每组参数为 $(p, T, r_v, r_l, r_i, T_{\\mathrm{env}}, r_{v,\\mathrm{env}})$）：\n- 用例 1（一般湿润，薄云）： $(100000, 300, 0.015, 0.001, 0.000, 300, 0.010)$。\n- 用例 2（干燥边界）： $(85000, 290, 0.000, 0.000, 0.000, 290, 0.000)$。\n- 用例 3（潮湿伴有混合相态云）： $(95000, 303, 0.025, 0.002, 0.001, 300, 0.020)$。\n- 用例 4（重凝结物，冷气块）： $(90000, 275, 0.010, 0.012, 0.005, 278, 0.008)$。\n- 用例 5（暖气块，潮湿环境）： $(100000, 310, 0.008, 0.000, 0.000, 305, 0.020)$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表。每个测试用例的结果应是一个包含四个浮点数的列表，顺序为 $[T_v, T_{\\rho}, \\Delta, B]$，其中 $\\Delta$ 是精确 $T_{\\rho}$ 与其线性近似之间的绝对差值。例如，总体格式必须是\n$$\n\\big[ [T_{v,1}, T_{\\rho,1}, \\Delta_1, B_1], [T_{v,2}, T_{\\rho,2}, \\Delta_2, B_2], \\dots \\big].\n$$\n所有温度单位必须是 $\\mathrm{K}$，$B$ 的单位必须是 $\\mathrm{m\\,s^{-2}}$，每个值都四舍五入到六位小数。",
            "solution": "该问题要求推导湿空气块的虚温和密度温度的表达式，对密度温度进行线性化，并计算浮力。然后必须为一系列测试用例计算这些量。推导过程将从所提供的基本原理出发。\n\n设气块总压力为 $p$，温度为 $T$，水汽混合比为 $r_v$，液态水混合比为 $r_l$，冰混合比为 $r_i$。干空气和水汽的比气体常数分别为 $R_d$ 和 $R_v$，且 $\\varepsilon = R_d/R_v$。重力加速度为 $g$。\n\n**1. 虚温 ($T_v$) 的推导**\n\n虚温 $T_v$ 定义为：在相同压力 $p$ 下，一个纯干空气气块要达到与湿空气气相部分相同的密度时所需具有的温度。\n\n湿气块气相的密度 $\\rho_{\\text{gas}}$ 是干空气密度 $\\rho_d$ 和水汽密度 $\\rho_v$ 的和：\n$$\n\\rho_{\\text{gas}} = \\rho_d + \\rho_v\n$$\n根据混合比的定义，$r_v = m_v/m_d$，其中 $m_v$ 和 $m_d$ 是给定体积 $V$ 中水汽和干空气的质量。因此，$\\rho_v = m_v/V$ 且 $\\rho_d = m_d/V$，这意味着 $r_v = \\rho_v/\\rho_d$。所以，$\\rho_{\\text{gas}} = \\rho_d(1+r_v)$。\n\n根据 Dalton 定律，总压力 $p$ 是干空气分压 ($p_d$) 和水汽分压 ($p_v$) 的和：$p = p_d + p_v$。\n使用理想气体定律 (IGL)，有 $p_d = \\rho_d R_d T$ 和 $p_v = \\rho_v R_v T$。我们可以用分压来表示混合比：\n$$\nr_v = \\frac{\\rho_v}{\\rho_d} = \\frac{p_v / (R_v T)}{p_d / (R_d T)} = \\frac{p_v}{p_d} \\frac{R_d}{R_v} = \\varepsilon \\frac{p_v}{p_d}\n$$\n由此可得 $p_v = p_d \\frac{r_v}{\\varepsilon}$。将其代入 Dalton 定律：\n$$\np = p_d + p_d \\frac{r_v}{\\varepsilon} = p_d \\left(1 + \\frac{r_v}{\\varepsilon}\\right)\n$$\n这使我们能够用总压力 $p$ 来表示 $p_d$：\n$$\np_d = \\frac{p}{1 + r_v/\\varepsilon}\n$$\n现在，我们使用 IGL 和上述关于 $p_d$ 的关系来表示 $\\rho_d$：\n$$\n\\rho_d = \\frac{p_d}{R_d T} = \\frac{p}{R_d T (1 + r_v/\\varepsilon)}\n$$\n那么总的气体密度为：\n$$\n\\rho_{\\text{gas}} = \\rho_d(1+r_v) = \\frac{p(1+r_v)}{R_d T (1 + r_v/\\varepsilon)}\n$$\n根据定义，一个温度为 $T_v$、压力为 $p$ 的干空气气块的密度为 $\\rho_{\\text{dry}} = p / (R_d T_v)$。令其与 $\\rho_{\\text{gas}}$ 相等：\n$$\n\\frac{p}{R_d T_v} = \\frac{p(1+r_v)}{R_d T (1 + r_v/\\varepsilon)}\n$$\n解出 $T_v$ 即可得到虚温的精确表达式：\n$$\nT_v = T \\frac{1 + r_v/\\varepsilon}{1 + r_v}\n$$\n\n**2. 密度温度 ($T_{\\rho}$) 的推导**\n\n密度温度 $T_{\\rho}$ 定义为：在相同压力 $p$ 下，一个纯干空气气块要达到与真实气块（包括气相和凝结相）的总密度相同时所需具有的温度。\n\n气块中的总质量为 $m_{\\text{total}} = m_d + m_v + m_l + m_i$。气块的体积 $V$ 由其气体组分决定，因为凝结水的体积可以忽略不计。总密度为：\n$$\n\\rho_{\\text{total}} = \\frac{m_{\\text{total}}}{V} = \\frac{m_d(1 + r_v + r_l + r_i)}{V}\n$$\n对干空气使用 IGL，有 $V = m_d R_d T / p_d$。将此代入密度表达式中：\n$$\n\\rho_{\\text{total}} = \\frac{m_d(1 + r_v + r_l + r_i)}{m_d R_d T / p_d} = \\frac{p_d (1 + r_v + r_l + r_i)}{R_d T}\n$$\n使用我们的表达式 $p_d = p / (1 + r_v/\\varepsilon)$：\n$$\n\\rho_{\\text{total}} = \\frac{p}{1 + r_v/\\varepsilon} \\frac{1 + r_v + r_l + r_i}{R_d T} = \\frac{p}{R_d T} \\frac{1 + r_v + r_l + r_i}{1 + r_v/\\varepsilon}\n$$\n根据定义，一个温度为 $T_{\\rho}$、压力为 $p$ 的干空气气块的密度为 $\\rho_{\\text{dry}} = p / (R_d T_{\\rho})$。令其与 $\\rho_{\\text{total}}$ 相等：\n$$\n\\frac{p}{R_d T_{\\rho}} = \\frac{p}{R_d T} \\frac{1 + r_v + r_l + r_i}{1 + r_v/\\varepsilon}\n$$\n解出 $T_{\\rho}$ 即可得到密度温度的精确表达式：\n$$\nT_{\\rho} = T \\frac{1 + r_v/\\varepsilon}{1 + r_v + r_l + r_i}\n$$\n\n**3. 密度温度的线性近似**\n\n我们对 $T_{\\rho}(r_v, r_l, r_i)$ 在点 $(r_v, r_l, r_i) = (0, 0, 0)$ 附近进行一阶多元泰勒展开。\n$$\nT_{\\rho, \\text{linear}} \\approx T_{\\rho}(0,0,0) + r_v \\frac{\\partial T_{\\rho}}{\\partial r_v}\\bigg|_{(0,0,0)} + r_l \\frac{\\partial T_{\\rho}}{\\partial r_l}\\bigg|_{(0,0,0)} + r_i \\frac{\\partial T_{\\rho}}{\\partial r_i}\\bigg|_{(0,0,0)}\n$$\n首先，计算 $T_{\\rho}$ 在 $(0,0,0)$ 处的值：\n$$\nT_{\\rho}(0,0,0) = T \\frac{1 + 0/\\varepsilon}{1 + 0 + 0 + 0} = T\n$$\n接下来，计算偏导数：\n$$\n\\frac{\\partial T_{\\rho}}{\\partial r_v} = T \\frac{\\partial}{\\partial r_v} \\left( \\frac{1+r_v/\\varepsilon}{1 + r_v + r_l + r_i} \\right) = T \\frac{(1/\\varepsilon)(1 + r_v + r_l + r_i) - (1+r_v/\\varepsilon)(1)}{(1 + r_v + r_l + r_i)^2}\n$$\n在 $(0,0,0)$ 处求值： $\\frac{\\partial T_{\\rho}}{\\partial r_v}\\bigg|_{(0,0,0)} = T \\frac{1/\\varepsilon - 1}{1^2} = T(1/\\varepsilon - 1)$。\n$$\n\\frac{\\partial T_{\\rho}}{\\partial r_l} = T (1+r_v/\\varepsilon) \\frac{\\partial}{\\partial r_l} \\left( (1 + r_v + r_l + r_i)^{-1} \\right) = T (1+r_v/\\varepsilon) \\frac{-1}{(1 + r_v + r_l + r_i)^2}\n$$\n在 $(0,0,0)$ 处求值： $\\frac{\\partial T_{\\rho}}{\\partial r_l}\\bigg|_{(0,0,0)} = T(1) \\frac{-1}{1^2} = -T$。\n根据对称性，$\\frac{\\partial T_{\\rho}}{\\partial r_i}\\bigg|_{(0,0,0)} = -T$。\n\n合并这些项，可得到线性近似表达式：\n$$\nT_{\\rho, \\text{linear}} = T + r_v T(1/\\varepsilon - 1) - r_l T - r_i T = T(1 + r_v(1/\\varepsilon - 1) - r_l - r_i)\n$$\n\n**4. 环境虚温 ($T_{v,\\mathrm{env}}$) 和浮力 ($B$)**\n\n环境虚温 $T_{v,\\mathrm{env}}$ 的计算公式与气块的 $T_v$ 相同，但使用的是不同的状态：温度 $T_{\\mathrm{env}}$，水汽混合比 $r_{v,\\mathrm{env}}$，以及可忽略的凝结物（$r_{l,\\mathrm{env}}=0, r_{i,\\mathrm{env}}=0$）。\n$$\nT_{v,\\mathrm{env}} = T_{\\mathrm{env}} \\frac{1 + r_{v,\\mathrm{env}}/\\varepsilon}{1 + r_{v,\\mathrm{env}}}\n$$\n浮力加速度 $B$ 由以下公式给出：\n$$\nB = g \\frac{T_{\\rho} - T_{v,\\mathrm{env}}}{T_{v,\\mathrm{env}}}\n$$\n这里，我们使用气块的精确密度温度 $T_{\\rho}$。\n\n**计算总结**\n对于每个测试用例，将计算并报告以下四个量，保留六位小数：\n1.  精确的气块虚温：$T_v = T \\frac{1 + r_v/\\varepsilon}{1 + r_v}$\n2.  精确的气块密度温度：$T_{\\rho} = T \\frac{1 + r_v/\\varepsilon}{1 + r_v + r_l + r_i}$\n3.  与线性近似的绝对差值：$\\Delta = |T_{\\rho} - T(1 + r_v(1/\\varepsilon - 1) - r_l - r_i)|$\n4.  浮力加速度：$B = g \\frac{T_{\\rho} - T_{v,\\mathrm{env}}}{T_{v,\\mathrm{env}}}$，其中 $T_{v,\\mathrm{env}} = T_{\\mathrm{env}} \\frac{1 + r_{v,\\mathrm{env}}/\\varepsilon}{1 + r_{v,\\mathrm{env}}}$。\n\n所用常数为 $R_d = 287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，以及 $g = 9.80665\\,\\mathrm{m\\,s^{-2}}$。由此可得 $\\varepsilon = R_d / R_v \\approx 0.62200433$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the atmospheric thermodynamics problem for a series of test cases.\n    It calculates parcel virtual and density temperatures, compares the exact\n    density temperature to its linearized approximation, and computes the\n    parcel's buoyancy acceleration.\n    \"\"\"\n    \n    # Define constants\n    R_d = 287.05  # J kg^-1 K^-1\n    R_v = 461.5   # J kg^-1 K^-1\n    g = 9.80665   # m s^-2\n    \n    # Epsilon, the ratio of gas constants\n    epsilon = R_d / R_v\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (p, T, r_v, r_l, r_i, T_env, r_v_env)\n    test_cases = [\n        (100000, 300, 0.015, 0.001, 0.000, 300, 0.010),\n        (85000, 290, 0.000, 0.000, 0.000, 290, 0.000),\n        (95000, 303, 0.025, 0.002, 0.001, 300, 0.020),\n        (90000, 275, 0.010, 0.012, 0.005, 278, 0.008),\n        (100000, 310, 0.008, 0.000, 0.000, 305, 0.020),\n    ]\n\n    # This function encapsulates the physics calculations for a single case.\n    def calculate_properties(case, epsilon_val, g_val):\n        \"\"\"\n        Computes the required thermodynamic properties for a single parcel and environment state.\n        \n        Args:\n            case (tuple): A tuple containing the state variables \n                          (p, T, r_v, r_l, r_i, T_env, r_v_env).\n            epsilon_val (float): The ratio R_d / R_v.\n            g_val (float): Gravitational acceleration.\n\n        Returns:\n            tuple: A tuple of four floats (T_v_exact, T_rho_exact, delta, B).\n        \"\"\"\n        # Unpack the case tuple\n        p, T, r_v, r_l, r_i, T_env, r_v_env = case\n        \n        # 1. Exact virtual temperature (Tv)\n        T_v_exact = T * (1.0 + r_v / epsilon_val) / (1.0 + r_v)\n        \n        # 2. Exact density temperature (T_rho)\n        total_mixing_ratio_parcel = r_v + r_l + r_i\n        T_rho_exact = T * (1.0 + r_v / epsilon_val) / (1.0 + total_mixing_ratio_parcel)\n        \n        # 3. Linearized T_rho and the absolute difference (delta)\n        T_rho_linear = T * (1.0 + r_v * (1.0 / epsilon_val - 1.0) - r_l - r_i)\n        delta = abs(T_rho_exact - T_rho_linear)\n        \n        # 4. Buoyancy acceleration (B)\n        # First, compute environment virtual temperature\n        T_v_env = T_env * (1.0 + r_v_env / epsilon_val) / (1.0 + r_v_env)\n        # Then, compute buoyancy\n        B = g_val * (T_rho_exact - T_v_env) / T_v_env\n        \n        return T_v_exact, T_rho_exact, delta, B\n\n    results_as_strings = []\n    for case in test_cases:\n        # Perform calculations for the current case\n        calcs = calculate_properties(case, epsilon, g)\n        \n        # Format the results to 6 decimal places and create a string sublist\n        # e.g., \"[302.694248,302.395760,0.038901,0.019238]\"\n        formatted_sublist = (\n            f\"[{calcs[0]:.6f},\"\n            f\"{calcs[1]:.6f},\"\n            f\"{calcs[2]:.6f},\"\n            f\"{calcs[3]:.6f}]\"\n        )\n        results_as_strings.append(formatted_sublist)\n\n    # Final print statement in the exact required format: [[...],[...],...]\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        }
    ]
}