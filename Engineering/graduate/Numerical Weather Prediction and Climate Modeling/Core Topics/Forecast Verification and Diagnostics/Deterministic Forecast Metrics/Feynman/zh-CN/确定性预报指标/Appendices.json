{
    "hands_on_practices": [
        {
            "introduction": "预报误差并非铁板一块。要深入诊断模式性能，第一步就是将其分解为可校正的系统性偏差和不可预测的随机分量。本练习  将指导你推导著名的均方误差分解公式，即 $\\mathrm{RMSE}^2 = b^2 + \\sigma_\\eta^2$，并动手实现一个从样本数据中分离这两种误差类型的程序。",
            "id": "4030916",
            "problem": "考虑一个确定性预报系统，该系统生成一个物理量的标量时间序列预报 $f_t$，以及在时间 $t=1,\\dots,T$ 的相应验证观测值 $o_t$。将预报误差定义为 $e_t = f_t - o_t$。假设误差的范式分解为 $e_t = b + \\eta_t$，其中 $E[\\eta_t] = 0$，$b$ 是系统性分量（偏差），$\\eta_t$ 是零均值随机分量。从第一性原理出发，从偏差、均方根误差以及相对于气候态的距平的核心定义开始：\n- 偏差定义为期望误差，$b = E[e_t]$。\n- 均方根误差定义为期望平方误差的平方根，$\\mathrm{RMSE} = \\sqrt{E[e_t^2]}$。\n- 给定一个气候态时间序列 $c_t$，对于一个序列 $x_t$（例如，$x_t \\in \\{f_t,o_t\\}$），将距平定义为 $a_t^{(x)} = x_t - c_t$。距平相关系数定义为在 $t=1,\\dots,T$ 范围内，预报距平和观测距平之间的皮尔逊相关系数。\n\n任务 A（推导）：严格从上述定义和 $e_t = b + \\eta_t$（其中 $E[\\eta_t]=0$）出发，推导出一个分解式，用 $b$ 和随机分量 $\\eta_t$ 的一个度量来表示 $\\mathrm{RMSE}^2$。解释为什么当距平是相对于一个固定的气候态计算时，距平相关系数对加性常数偏差不敏感。\n\n任务 B（估计与计算）：设计一个估计程序，仅使用有限样本 $\\{(f_t,o_t,c_t)\\}_{t=1}^{T}$ 将系统性偏差与随机误差分离。您的估计必须基于以下原则：\n- 通过误差的样本均值估计 $b$。\n- 通过从每个误差中移除估计的偏差来估计随机分量 $\\eta_t$。\n- 使用与 $\\mathrm{RMSE}$ 定义相同的归一化方法，通过估计的随机分量的均方根来量化随机分量，以便进行直接的分解检验。\n- 计算预报距平和观测距平之间的皮尔逊相关系数作为距平相关系数。如果任一距平序列的样本方差为零，则将距平相关系数定义为 $0$。\n\n任务 C（实现）：实现一个程序，对每个提供的测试用例，计算：\n1. 估计的偏差 $\\hat{b}$，单位为开尔文（K）。\n2. 估计的随机误差均方根 $\\widehat{\\sigma_\\eta}$，单位为开尔文（K），其中 $\\widehat{\\sigma_\\eta}$ 定义为去偏误差平方的样本均值的平方根。\n3. 估计的均方根误差 $\\widehat{\\mathrm{RMSE}}$，单位为开尔文（K）。\n4. 距平相关系数 $\\widehat{\\mathrm{AC}}$（无量纲），计算为 $a_t^{(f)}$ 和 $a_t^{(o)}$ 之间的皮尔逊相关系数。\n5. 一个布尔值，当且仅当 $|\\widehat{\\mathrm{RMSE}}^2 - (\\hat{b}^2 + \\widehat{\\sigma_\\eta}^2)| \\le \\tau$ 时为真，其中 $\\tau$ 是一个为考虑浮点运算而设的固定容差。\n\n物理单位：所有与温度相关的量必须解释为开尔文（K）。不涉及角度。不涉及百分比；所有输出均以浮点数或布尔值的形式数值化表示，不带百分号。\n\n使用以下测试用例集，每个用例指定了 $t=1,\\dots,T$ 的 $(f_t,o_t,c_t)$：\n- 用例 1（$T=6$；系统性偏差伴随随机扰动）：\n  - 观测值 $o_t$：$(\\; $289.0$, $291.5$, $294.2$, $296.8$, $299.1$, $300.3$ \\;)$\n  - 预报值 $f_t$：$(\\; $290.3$, $293.1$, $295.1$, $298.6$, $300.6$, $302.2$ \\;)$\n  - 气候态 $c_t$：$(\\; $288.5$, $291.0$, $293.5$, $296.0$, $298.5$, $300.0$ \\;)$\n- 用例 2（$T=6$；仅随机误差，偏差接近零）：\n  - 观测值 $o_t$：$(\\; $280.0$, $282.0$, $284.0$, $286.0$, $288.0$, $290.0$ \\;)$\n  - 预报值 $f_t$：$(\\; $280.0$, $281.5$, $284.5$, $285.0$, $289.0$, $290.0$ \\;)$\n  - 气候态 $c_t$：$(\\; $279.0$, $281.0$, $283.0$, $285.0$, $287.0$, $289.0$ \\;)$\n- 用例 3（$T=6$；完美预报）：\n  - 观测值 $o_t$：$(\\; $295.0$, $296.0$, $297.0$, $298.0$, $299.0$, $300.0$ \\;)$\n  - 预报值 $f_t$：$(\\; $295.0$, $296.0$, $297.0$, $298.0$, $299.0$, $300.0$ \\;)$\n  - 气候态 $c_t$：$(\\; $294.5$, $295.5$, $296.5$, $297.5$, $298.5$, $299.5$ \\;)$\n- 用例 4（$T=6$；预报等于气候态，距平值为零）：\n  - 观测值 $o_t$：$(\\; $285.0$, $287.0$, $290.0$, $292.0$, $289.0$, $286.0$ \\;)$\n  - 预报值 $f_t$：$(\\; $286.0$, $287.0$, $288.0$, $289.0$, $290.0$, $291.0$ \\;)$\n  - 气候态 $c_t$：$(\\; $286.0$, $287.0$, $288.0$, $289.0$, $290.0$, $291.0$ \\;)$\n\n答案规格：\n- 分解检验使用 $\\tau = 10^{-10}$。\n- 对于每个用例，生成一个形式为 $[\\hat{b}, \\widehat{\\sigma_\\eta}, \\widehat{\\mathrm{RMSE}}, \\widehat{\\mathrm{AC}}, \\text{check}]$ 的列表，其中前四项是浮点数，第五项是布尔值。\n- 您的程序应生成单行输出，其中包含结果，形式为方括号括起来的逗号分隔列表，每个用例表示为一个内部的方括号列表，顺序与上述用例相同（例如，$[[\\dots],[\\dots],[\\dots],[\\dots]]$）。不应打印任何其他文本。",
            "solution": "该问题陈述是确定性预报检验中的一个有效练习。它在科学上基于统计学和大气科学的原理，定义清晰，数据充分，问题阐述良好且表述客观。提供了一个唯一且有意义的解决方案所需的所有必要组成部分。我们将按要求进行推导和计算。\n\n分析分为两部分，对应于问题中概述的任务。\n\n### 任务 A：理论推导\n\n本节处理从第一性原理出发的所需推导。\n\n**1. 均方误差的分解**\n\n我们被要求推导均方根误差的平方 $\\mathrm{RMSE}^2$ 的分解式，用偏差 $b$ 和随机误差分量 $\\eta_t$ 来表示。\n\n提供的核心定义是：\n- 预报误差：$e_t = f_t - o_t$\n- 误差分解：$e_t = b + \\eta_t$，其中 $b$ 是一个常数系统性偏差，$\\eta_t$ 是一个随机分量，其期望值 $E[\\eta_t] = 0$。\n- 偏差：$b = E[e_t]$\n- 均方根误差：$\\mathrm{RMSE} = \\sqrt{E[e_t^2]}$\n\n从 $\\mathrm{RMSE}$ 的定义可知，$\\mathrm{RMSE}^2 = E[e_t^2]$。我们将误差分解 $e_t = b + \\eta_t$ 代入此表达式：\n$$\n\\mathrm{RMSE}^2 = E[(b + \\eta_t)^2]\n$$\n在期望算子内展开平方项得到：\n$$\n\\mathrm{RMSE}^2 = E[b^2 + 2b\\eta_t + \\eta_t^2]\n$$\n根据期望算子的线性性质，我们可以分离各项：\n$$\n\\mathrm{RMSE}^2 = E[b^2] + E[2b\\eta_t] + E[\\eta_t^2]\n$$\n我们逐项分析：\n- 由于 $b$ 是一个常数（系统性偏差），其期望值是其自身，所以 $E[b^2] = b^2$。\n- 对于交叉项，我们可以提出常数 $2b$：$E[2b\\eta_t] = 2b E[\\eta_t]$。根据定义，随机分量 $\\eta_t$ 的均值为零，$E[\\eta_t] = 0$。因此，该项为 $2b \\cdot 0 = 0$。\n- 最后一项是 $E[\\eta_t^2]$。这是零均值随机误差分量的均方值。根据定义，此量即为 $\\eta_t$ 的方差，记作 $\\sigma_\\eta^2$。即 $\\sigma_\\eta^2 = \\mathrm{Var}(\\eta_t) = E[(\\eta_t - E[\\eta_t])^2] = E[(\\eta_t - 0)^2] = E[\\eta_t^2]$。\n\n将这些结果代回方程，我们得到分解式：\n$$\n\\mathrm{RMSE}^2 = b^2 + \\sigma_\\eta^2\n$$\n这个基本结果表明，均方误差是偏差平方与随机误差方差之和。因此，随机分量 $\\eta_t$ 的度量是其方差 $\\sigma_\\eta^2$。\n\n**2. 距平相关对加性偏差的不敏感性**\n\n我们必须解释为什么距平相关系数（$\\mathrm{AC}$）对预报中的加性常数偏差不敏感。\n\n设原始预报为 $f_t$。预报距平为 $a_t^{(f)} = f_t - c_t$，其中 $c_t$ 是气候态。\n现在，考虑一个有偏预报 $f'_t$，它相对于原始预报有一个常数加性偏差 $\\delta$：\n$$\nf'_t = f_t + \\delta\n$$\n新的预报距平 $a_t^{(f')}$ 为：\n$$\na_t^{(f')} = f'_t - c_t = (f_t + \\delta) - c_t = (f_t - c_t) + \\delta = a_t^{(f)} + \\delta\n$$\n观测距平 $a_t^{(o)} = o_t - c_t$ 不受影响。\n\n距平相关系数定义为预报距平和观测距平之间的皮尔逊相关系数。两个变量 $X$ 和 $Y$ 的皮尔逊相关系数定义为：\n$$\n\\rho_{X,Y} = \\frac{\\mathrm{Cov}(X,Y)}{\\sigma_X \\sigma_Y}\n$$\n其中 $\\mathrm{Cov}(X,Y)$ 是 $X$ 和 $Y$ 的协方差，$\\sigma_X$ 和 $\\sigma_Y$ 是它们各自的标准差。\n\n皮尔逊相关系数的一个关键特性是它在变量各自进行线性变换下的不变性。具体来说，对于常数 $k_1, m_1, k_2, m_2$ 且 $k_1 k_2 > 0$，有 $\\rho(k_1 X + m_1, k_2 Y + m_2) = \\rho(X, Y)$。这里，我们将 $a_t^{(f)}$ 变换为 $a_t^{(f')} = a_t^{(f)} + \\delta$，这是一个简单的平移（$k_1=1$，$m_1=\\delta$）。\n\n让我们从协方差和方差的定义来证明这一点：\n- **协方差：**\n  $$\n  \\mathrm{Cov}(a_t^{(f')}, a_t^{(o)}) = \\mathrm{Cov}(a_t^{(f)} + \\delta, a_t^{(o)}) = \\mathrm{Cov}(a_t^{(f)}, a_t^{(o)}) \n  $$\n  这是因为给一个变量加上一个常数不会改变它与另一个变量的协方差，因为协方差是基于与均值的偏差计算的，而均值本身也被平移了相同的常数。\n- **方差：**\n  $$\n  \\mathrm{Var}(a_t^{(f')}) = \\mathrm{Var}(a_t^{(f)} + \\delta) = \\mathrm{Var}(a_t^{(f)})\n  $$\n  这是因为方差是离散程度的度量，它对于数据的常数平移是不变的。标准差作为方差的平方根，同样保持不变：$\\sigma_{a^{(f')}} = \\sigma_{a^{(f)}}$。\n\n因此，新的距平相关系数为：\n$$\n\\mathrm{AC'} = \\rho(a_t^{(f')}, a_t^{(o)}) = \\frac{\\mathrm{Cov}(a_t^{(f')}, a_t^{(o)})}{\\sigma_{a^{(f')}} \\sigma_{a^{(o)}}} = \\frac{\\mathrm{Cov}(a_t^{(f)}, a_t^{(o)})}{\\sigma_{a^{(f)}} \\sigma_{a^{(o)}}} = \\rho(a_t^{(f)}, a_t^{(o)}) = \\mathrm{AC}\n$$\n因此，距平相关系数对预报中的常数加性偏差不敏感。\n\n### 任务 B 和 C：估计程序与实现\n\n该问题要求设计并实现一个程序，从有限样本 $\\{(f_t, o_t, c_t)\\}_{t=1}^{T}$ 中估计定义的度量指标。\n\n**1. 估计公式**\n\n总体期望 $E[\\cdot]$ 被长度为 $T$ 的时间序列上的样本均值所替代。\n\n- 首先为每个时间步 $t$ 计算预报误差序列：$e_t = f_t - o_t$。\n- **偏差估计 ($\\hat{b}$):** 偏差 $b = E[e_t]$ 通过误差的样本均值来估计：\n  $$ \\hat{b} = \\frac{1}{T} \\sum_{t=1}^{T} e_t $$\n- **估计的随机误差 ($\\hat{\\eta}_t$):** 每个时间步的随机误差分量通过从总误差中减去估计的偏差来估计：\n  $$ \\hat{\\eta}_t = e_t - \\hat{b} $$\n- **随机误差均方根估计 ($\\widehat{\\sigma_\\eta}$):** 随机分量的均方根 $\\sigma_\\eta = \\sqrt{E[\\eta_t^2]}$，通过取估计的随机误差平方的样本均值的平方根来估计：\n  $$ \\widehat{\\sigma_\\eta} = \\sqrt{\\frac{1}{T} \\sum_{t=1}^{T} \\hat{\\eta}_t^2} $$\n- **RMSE 估计 ($\\widehat{\\mathrm{RMSE}}$):** $\\mathrm{RMSE} = \\sqrt{E[e_t^2]}$ 通过误差平方的样本均值的平方根来估计：\n  $$ \\widehat{\\mathrm{RMSE}} = \\sqrt{\\frac{1}{T} \\sum_{t=1}^{T} e_t^2} $$\n- **分解检验：** 理论恒等式 $\\mathrm{RMSE}^2 = b^2 + \\sigma_\\eta^2$ 对这些特定的估计量有一个直接的模拟：$\\widehat{\\mathrm{RMSE}}^2 = \\hat{b}^2 + \\widehat{\\sigma_\\eta}^2$。这是一个代数恒等式，对于所定义的估计量，在浮点精度范围内是精确成立的。通过测试 $|\\widehat{\\mathrm{RMSE}}^2 - (\\hat{b}^2 + \\widehat{\\sigma_\\eta}^2)| \\le \\tau$（对于给定的容差 $\\tau = 10^{-10}$）来进行检验。\n- **距平相关估计 ($\\widehat{\\mathrm{AC}}$):**\n  1. 计算距平序列：$a_t^{(f)} = f_t - c_t$ 和 $a_t^{(o)} = o_t - c_t$。\n  2. 计算 $\\{a_t^{(f)}\\}_{t=1}^T$ 和 $\\{a_t^{(o)}\\}_{t=1}^T$ 之间的样本皮尔逊相关系数。设 $\\overline{a^{(f)}}$ 和 $\\overline{a^{(o)}}$ 为距平序列的样本均值。\n     $$ \\widehat{\\mathrm{AC}} = \\frac{\\sum_{t=1}^{T} (a_t^{(f)} - \\overline{a^{(f)}}) (a_t^{(o)} - \\overline{a^{(o)}})}{\\sqrt{\\sum_{t=1}^{T} (a_t^{(f)} - \\overline{a^{(f)}})^2 \\sum_{t=1}^{T} (a_t^{(o)} - \\overline{a^{(o)}})^2}} $$\n  3. 根据问题规定，如果任一距平序列的样本方差为零（即分母为零），则 $\\widehat{\\mathrm{AC}}$ 定义为 $0$。\n\n**2. 实现方法**\n实现将通过使用 `numpy` 库进行高效的向量化计算，应用这些估计公式来处理每个测试用例。一个函数将封装单个用例的逻辑，主脚本将遍历提供的测试用例，格式化结果，并根据指定的输出格式打印它们。",
            "answer": "```python\nimport numpy as np\n\ndef compute_metrics(f_ts, o_ts, c_ts, tolerance=1e-10):\n    \"\"\"\n    Computes forecast verification metrics for a given set of time series.\n\n    Args:\n        f_ts (list or np.ndarray): Time series of forecasts.\n        o_ts (list or np.ndarray): Time series of observations.\n        c_ts (list or np.ndarray): Time series of climatology.\n        tolerance (float): Tolerance for the decomposition check.\n\n    Returns:\n        list: A list containing [b_hat, sigma_eta_hat, rmse_hat, ac_hat, check].\n    \"\"\"\n    # Convert inputs to numpy arrays for vectorized operations\n    f = np.array(f_ts, dtype=float)\n    o = np.array(o_ts, dtype=float)\n    c = np.array(c_ts, dtype=float)\n\n    # 1. Compute error series\n    e = f - o\n\n    # 2. Estimate bias (b_hat)\n    b_hat = np.mean(e)\n\n    # 3. Estimate random error component (eta_hat)\n    eta_hat = e - b_hat\n\n    # 4. Estimate RMS of the random component (sigma_eta_hat)\n    # The problem defines this using the same normalization as RMSE\n    s_eta_sq = np.mean(np.square(eta_hat))\n    sigma_eta_hat = np.sqrt(s_eta_sq)\n\n    # 5. Estimate RMSE (rmse_hat)\n    rmse_sq = np.mean(np.square(e))\n    rmse_hat = np.sqrt(rmse_sq)\n\n    # 6. Perform decomposition check\n    # The identity rmse_hat^2 = b_hat^2 + sigma_eta_hat^2 is algebraic for these estimators.\n    # The check verifies this holds within floating-point tolerance.\n    check = abs(rmse_sq - (b_hat**2 + s_eta_sq)) = tolerance\n\n    # 7. Compute Anomaly Correlation (ac_hat)\n    a_f = f - c\n    a_o = o - c\n\n    # Check for zero variance as specified\n    if np.var(a_f) == 0 or np.var(a_o) == 0:\n        ac_hat = 0.0\n    else:\n        # np.corrcoef returns a correlation matrix. The value is at [0, 1] or [1, 0].\n        ac_hat = np.corrcoef(a_f, a_o)[0, 1]\n    \n    return [b_hat, sigma_eta_hat, rmse_hat, ac_hat, bool(check)]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"o_t\": [289.0, 291.5, 294.2, 296.8, 299.1, 300.3],\n            \"f_t\": [290.3, 293.1, 295.1, 298.6, 300.6, 302.2],\n            \"c_t\": [288.5, 291.0, 293.5, 296.0, 298.5, 300.0]\n        },\n        {\n            \"o_t\": [280.0, 282.0, 284.0, 286.0, 288.0, 290.0],\n            \"f_t\": [280.0, 281.5, 284.5, 285.0, 289.0, 290.0],\n            \"c_t\": [279.0, 281.0, 283.0, 285.0, 287.0, 289.0]\n        },\n        {\n            \"o_t\": [295.0, 296.0, 297.0, 298.0, 299.0, 300.0],\n            \"f_t\": [295.0, 296.0, 297.0, 298.0, 299.0, 300.0],\n            \"c_t\": [294.5, 295.5, 296.5, 297.5, 298.5, 299.5]\n        },\n        {\n            \"o_t\": [285.0, 287.0, 290.0, 292.0, 289.0, 286.0],\n            \"f_t\": [286.0, 287.0, 288.0, 289.0, 290.0, 291.0],\n            \"c_t\": [286.0, 287.0, 288.0, 289.0, 290.0, 291.0]\n        }\n    ]\n\n    results_as_strings = []\n    \n    def format_result(res_list):\n        \"\"\"Formats a single result list into the required string format.\"\"\"\n        # Convert floats to strings, and the boolean to lowercase string 'true'/'false'\n        str_items = [f\"{x:.15g}\" for x in res_list[:-1]]\n        str_items.append(str(res_list[-1]).lower())\n        return f\"[{','.join(str_items)}]\"\n\n    for case in test_cases:\n        result = compute_metrics(case[\"f_t\"], case[\"o_t\"], case[\"c_t\"])\n        results_as_strings.append(format_result(result))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了误差指标的基础上，我们现在来探讨它们的敏感性。不同的指标对孤立的大误差反应不同，这对我们如何解读预报性能，尤其是在极端事件期间，具有重要意义。本练习  运用渐近分析，量化地揭示了均方根误差（RMSE）因其对误差的平方处理，如何比平均绝对误差（MAE）更严厉地惩罚异常值，这是选择检验指标时的一个关键考量。",
            "id": "4030890",
            "problem": "考虑对一个 $20 \\times 20$ 点的矩形区域网格上的每日 $500$ hPa 位势高度进行的确定性预报，因此检验样本数为 $n = 400$。设这 $n$ 个样本处的确定性预报误差为 $\\{e_i\\}_{i=1}^{n}$，其中 $e_i$ 是样本 $i$ 处预报与检验分析之间的差值。均方根误差 (RMSE) 和平均绝对误差 (MAE) 由以下基本聚合定义给出\n$$\\text{RMSE} = \\left(\\frac{1}{n}\\sum_{i=1}^{n} e_i^2\\right)^{1/2}, \\quad \\text{MAE} = \\frac{1}{n}\\sum_{i=1}^{n} |e_i|.$$\n假设在索引 $k$ 处通过单样本扰动引入一个极端异常值，将 $e_k$ 替换为 $e_k + D$，其中 $D$ 是一个标量扰动，其幅值远大于所有现有误差，即 $|D| \\gg \\max_i |e_i|$。用 $\\text{RMSE}'$ 和 $\\text{MAE}'$ 表示从修改后的集合 $\\{e_1,\\dots,e_k + D,\\dots,e_n\\}$ 计算出的扰动后的度量。\n\n从上述定义出发，并且不借助任何预先推导的灵敏度公式，推导当 $|D| \\to \\infty$ 时，由该单样本扰动产生的变化量 $\\Delta_{\\text{RMSE}} = \\text{RMSE}' - \\text{RMSE}$ 和 $\\Delta_{\\text{MAE}} = \\text{MAE}' - \\text{MAE}}$ 的领头阶渐近表达式。然后，使用这些渐近表达式，确定渐近比率\n$$\\rho = \\lim_{|D| \\to \\infty} \\frac{\\Delta_{\\text{RMSE}}}{\\Delta_{\\text{MAE}}}$$\n并用 $n$ 表示。最后，计算当 $n = 400$ 时此比率的值。将最终答案以单个数字形式给出。无需四舍五入。",
            "solution": "该问题是适定的、有科学依据且自洽的。在数值天气预报检验的背景下，这是一个有效的应用数学问题。\n\n设初始预报误差集为 $\\{e_i\\}_{i=1}^{n}$。样本数给定为 $n = 20 \\times 20 = 400$。均方根误差 (RMSE) 和平均绝对误差 (MAE) 定义如下：\n$$ \\text{RMSE} = \\left(\\frac{1}{n}\\sum_{i=1}^{n} e_i^2\\right)^{1/2} $$\n$$ \\text{MAE} = \\frac{1}{n}\\sum_{i=1}^{n} |e_i| $$\n\n在索引 $k$ 处引入一个单样本扰动，使得新的误差为 $e_k' = e_k + D$。所有其他误差保持不变，即对于 $i \\neq k$ 有 $e_i' = e_i$。扰动的幅值很大，即 $|D| \\gg \\max_i |e_i|$。扰动后的度量表示为 $\\text{RMSE}'$ 和 $\\text{MAE}'$。我们需要找到当 $|D| \\to \\infty$ 时，变化量 $\\Delta_{\\text{RMSE}} = \\text{RMSE}' - \\text{RMSE}$ 和 $\\Delta_{\\text{MAE}} = \\text{MAE}' - \\text{MAE}}$ 的领头阶渐近表达式。\n\n首先，我们分析 RMSE 的变化量 $\\Delta_{\\text{RMSE}}$。\n原始的平方和为 $S_2 = \\sum_{i=1}^{n} e_i^2 = n (\\text{RMSE})^2$。\n新的平方和 $S_2'$ 为：\n$$ S_2' = \\sum_{i \\neq k} e_i^2 + (e_k+D)^2 = \\left(\\sum_{i=1}^{n} e_i^2 - e_k^2\\right) + (e_k^2 + 2e_k D + D^2) $$\n$$ S_2' = \\sum_{i=1}^{n} e_i^2 + 2e_k D + D^2 = S_2 + 2e_k D + D^2 $$\n扰动后的 RMSE 为：\n$$ \\text{RMSE}' = \\left(\\frac{S_2'}{n}\\right)^{1/2} = \\left(\\frac{S_2 + 2e_k D + D^2}{n}\\right)^{1/2} $$\n为了找到 $|D|$ 很大时的渐近行为，我们提出因子 $D^2$：\n$$ \\text{RMSE}' = \\left(\\frac{D^2}{n} \\left(1 + \\frac{2e_k}{D} + \\frac{S_2}{D^2}\\right)\\right)^{1/2} = \\frac{|D|}{\\sqrt{n}} \\left(1 + \\frac{2e_k}{D} + \\frac{S_2}{D^2}\\right)^{1/2} $$\n我们对小的 $x$ 使用二项式展开 $(1+x)^{1/2} \\approx 1 + \\frac{1}{2}x$。这里，$x = \\frac{2e_k}{D} + \\frac{S_2}{D^2}$，当 $|D| \\to \\infty$ 时，它趋近于 $0$。\n$$ \\text{RMSE}' \\approx \\frac{|D|}{\\sqrt{n}} \\left(1 + \\frac{1}{2} \\left(\\frac{2e_k}{D} + \\frac{S_2}{D^2}\\right)\\right) = \\frac{|D|}{\\sqrt{n}} \\left(1 + \\frac{e_k}{D} + O\\left(\\frac{1}{D^2}\\right)\\right) $$\n$$ \\text{RMSE}' \\approx \\frac{|D|}{\\sqrt{n}} + \\frac{e_k |D|}{D\\sqrt{n}} = \\frac{|D|}{\\sqrt{n}} + \\frac{e_k \\text{sgn}(D)}{\\sqrt{n}} $$\nRMSE 的变化量为 $\\Delta_{\\text{RMSE}} = \\text{RMSE}' - \\text{RMSE}$。渐近地，\n$$ \\Delta_{\\text{RMSE}} \\approx \\frac{|D|}{\\sqrt{n}} + \\frac{e_k \\text{sgn}(D)}{\\sqrt{n}} - \\text{RMSE} $$\n领头阶项是随 $|D|$ 增长的项。因此，变化量的领头阶渐近表达式为：\n$$ \\Delta_{\\text{RMSE}} \\sim \\frac{|D|}{\\sqrt{n}} \\quad \\text{as } |D| \\to \\infty $$\n\n接下来，我们分析 MAE 的变化量 $\\Delta_{\\text{MAE}}$。\n原始的绝对值之和为 $S_1 = \\sum_{i=1}^{n} |e_i| = n \\cdot \\text{MAE}$。\n新的绝对值之和 $S_1'$ 为：\n$$ S_1' = \\sum_{i \\neq k} |e_i| + |e_k+D| = \\left(\\sum_{i=1}^{n} |e_i| - |e_k|\\right) + |e_k+D| = S_1 - |e_k| + |e_k+D| $$\n扰动后的 MAE 为：\n$$ \\text{MAE}' = \\frac{S_1'}{n} = \\frac{S_1 - |e_k| + |e_k+D|}{n} $$\nMAE 的变化量为：\n$$ \\Delta_{\\text{MAE}} = \\text{MAE}' - \\text{MAE} = \\frac{S_1 - |e_k| + |e_k+D|}{n} - \\frac{S_1}{n} = \\frac{|e_k+D| - |e_k|}{n} $$\n对于 $|D| \\to \\infty$ 时的渐近行为，我们分析 $|e_k+D|$ 项。由于 $|D| \\gg |e_k|$，因此 $e_k+D$ 的符号与 $D$ 的符号相同。所以，$\\text{sgn}(e_k+D) = \\text{sgn}(D)$。\n$$ |e_k+D| = (e_k+D)\\text{sgn}(e_k+D) = (e_k+D)\\text{sgn}(D) = e_k\\text{sgn}(D) + D\\text{sgn}(D) = e_k\\text{sgn}(D) + |D| $$\n将此代入 $\\Delta_{\\text{MAE}}$ 的表达式中：\n$$ \\Delta_{\\text{MAE}} = \\frac{1}{n} \\left( |D| + e_k\\text{sgn}(D) - |e_k| \\right) $$\n领头阶项是随 $|D|$ 增长的项。因此，变化量的领头阶渐近表达式为：\n$$ \\Delta_{\\text{MAE}} \\sim \\frac{|D|}{n} \\quad \\text{as } |D| \\to \\infty $$\n\n现在，我们确定渐近比率 $\\rho$。\n$$ \\rho = \\lim_{|D| \\to \\infty} \\frac{\\Delta_{\\text{RMSE}}}{\\Delta_{\\text{MAE}}} $$\n使用上面推导的领头阶渐近表达式：\n$$ \\rho = \\lim_{|D| \\to \\infty} \\frac{|D|/\\sqrt{n}}{|D|/n} = \\frac{1/\\sqrt{n}}{1/n} = \\frac{n}{\\sqrt{n}} = \\sqrt{n} $$\n这个结果可以通过对变化量的完整表达式取极限来证实：\n$$ \\rho = \\lim_{|D| \\to \\infty} \\frac{\\left(\\frac{S_2 + 2e_k D + D^2}{n}\\right)^{1/2} - \\text{RMSE}}{\\frac{|e_k+D| - |e_k|}{n}} $$\n分子和分母同除以 $|D|$：\n$$ \\rho = \\lim_{|D| \\to \\infty} \\frac{\\frac{1}{|D|}\\left(\\frac{|D|}{\\sqrt{n}}\\left(1 + \\frac{2e_k}{D} + \\frac{S_2}{D^2}\\right)^{1/2} - \\text{RMSE}\\right)}{\\frac{1}{|D|}\\left(\\frac{|D| + e_k\\text{sgn}(D) - |e_k|}{n}\\right)} $$\n$$ \\rho = \\lim_{|D| \\to \\infty} \\frac{\\frac{1}{\\sqrt{n}}\\left(1 + \\frac{2e_k}{D} + \\frac{S_2}{D^2}\\right)^{1/2} - \\frac{\\text{RMSE}}{|D|}}{\\frac{1}{n}\\left(1 + \\frac{e_k\\text{sgn}(D)}{|D|} - \\frac{|e_k|}{|D|}\\right)} $$\n当 $|D| \\to \\infty$ 时，像 $1/D$ 和 $1/|D|$ 这样的项趋于 $0$。\n$$ \\rho = \\frac{\\frac{1}{\\sqrt{n}}(1)^{1/2} - 0}{\\frac{1}{n}(1 + 0 - 0)} = \\frac{1/\\sqrt{n}}{1/n} = \\sqrt{n} $$\n问题指明检验样本数为 $n = 400$。\n将该值代入 $\\rho$ 的表达式：\n$$ \\rho = \\sqrt{400} = 20 $$",
            "answer": "$$\\boxed{20}$$"
        },
        {
            "introduction": "在识别并理解了不同的误差分量之后，下一个合乎逻辑的步骤就是进行校正。消除系统性偏差通常是改进预报最简单有效的方法。在本练习  中，你将通过数学推导证明，为了最小化均方根误差（RMSE），最佳的加性校正量恰好就是预报的平均误差，即偏差。这揭示了检验指标与预报改进策略之间的直接联系。",
            "id": "4030885",
            "problem": "考虑对一个确定性数值天气预报进行单变量检验，该预报包含一个固定区域内某个标量大气变量（例如，日区域平均2米温度）的 $n$ 个预报-观测对 $\\{(f_i,o_i)\\}_{i=1}^{n}$。定义常数加性订正预报族 $f_i^{*}(c) = f_i - c$，其中 $c \\in \\mathbb{R}$ 是一个统一地应用于所有预报实例的常数。令订正预報的誤差为 $e_i(c) = f_i^{*}(c) - o_i$，样本偏差为 $B(c) = \\frac{1}{n}\\sum_{i=1}^{n} e_i(c)$，均方根误差 (RMSE) 为 $R(c) = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n} e_i(c)^{2}}$。假设仅存在加性偏差，即误差的中心二阶矩 $\\frac{1}{n}\\sum_{i=1}^{n}\\left(e_i(c) - B(c)\\right)^{2}$ 不依赖于 $c$。将未订正的误差记为 $e_i = f_i - o_i$，样本均值记为 $\\bar{f} = \\frac{1}{n}\\sum_{i=1}^{n} f_i$ 和 $\\bar{o} = \\frac{1}{n}\\sum_{i=1}^{n} o_i$。\n\n仅使用以上定义和基于样本矩分解的标准代数操作，完成以下任务：\n- 推导 $B(c)$ 作为 $c$ 和未订正偏差 $B(0)$ 的函数，并计算 $\\frac{dB}{dc}$。\n- 将 $R(c)^{2}$ 表示为一个将依赖于 $B(c)$ 的项与一个不依赖于 $c$ 的非负项分开的形式，并利用此形式确定在所述假设下使 $R(c)$ 最小化的值 $c^{*}$。\n- 最后，仅用 $\\bar{f}$ 和 $\\bar{o}$ 表示 $c^{*}$。\n\n请以 $\\bar{f}$ 和 $\\bar{o}$ 表示 $c^{*}$ 的单一闭式符号表达式作为你的最终答案。不需要数值近似，最终表达式也不需要单位。最终答案中不要包含任何中间步骤。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、适定且客观。\n\n**步骤1：提取已知条件**\n- 预报-观测对： $\\{(f_i, o_i)\\}_{i=1}^{n}$\n- 订正预报： $f_i^{*}(c) = f_i - c$，其中 $c \\in \\mathbb{R}$\n- 订正误差： $e_i(c) = f_i^{*}(c) - o_i$\n- 样本偏差： $B(c) = \\frac{1}{n}\\sum_{i=1}^{n} e_i(c)$\n- 均方根误差 (RMSE)： $R(c) = \\sqrt{\\frac{1}{n}\\sum_{i=1}^{n} e_i(c)^{2}}$\n- 假设：误差的中心二阶矩 $\\frac{1}{n}\\sum_{i=1}^{n}\\left(e_i(c) - B(c)\\right)^{2}$ 不依赖于 $c$。\n- 未订正误差： $e_i = f_i - o_i$\n- 样本均值： $\\bar{f} = \\frac{1}{n}\\sum_{i=1}^{n} f_i$ 和 $\\bar{o} = \\frac{1}{n}\\sum_{i=1}^{n} o_i$\n\n**步骤2：使用提取的已知条件进行验证**\n该问题是确定性预报统计检验中的一个标准练习，具体涉及偏差订正和均方误差 (MSE) 的分解。所提供的定义在气象学和气候科学中是标准的。关于误差的中心二阶矩独立于订正因子 $c$ 的假设不仅仅是一个任意条件，而是这些定义的直接结果，这确保了问题的内部一致性。我们来验证这一点：\n$e_i(c) = (f_i - c) - o_i = (f_i - o_i) - c = e_i - c$。\n$B(c) = \\frac{1}{n}\\sum_{i=1}^{n} e_i(c) = \\frac{1}{n}\\sum_{i=1}^{n} (e_i - c) = \\left(\\frac{1}{n}\\sum_{i=1}^{n} e_i\\right) - c = B(0) - c$。\n然后，$e_i(c) - B(c) = (e_i - c) - (B(0) - c) = e_i - B(0)$。\n项 $e_i - B(0)$ 独立于 $c$。因此，其样本方差 $\\frac{1}{n}\\sum_{i=1}^{n}\\left(e_i(c) - B(c)\\right)^{2} = \\frac{1}{n}\\sum_{i=1}^{n}\\left(e_i - B(0)\\right)^{2}$ 也独立于 $c$。因此，该问题是自洽的、适定的，并具有科学依据。\n\n**步骤3：结论与行动**\n问题有效。将推导一个完整的解。\n\n**推导过程**\n\n第一个任务是推导订正偏差 $B(c)$ 及其关于 $c$ 的导数的表达式。\n使用 $B(c)$ 的定义：\n$$B(c) = \\frac{1}{n}\\sum_{i=1}^{n} e_i(c)$$\n代入订正误差的定义 $e_i(c) = f_i^{*}(c) - o_i = (f_i - c) - o_i$：\n$$B(c) = \\frac{1}{n}\\sum_{i=1}^{n} (f_i - c - o_i) = \\frac{1}{n}\\sum_{i=1}^{n} ((f_i - o_i) - c)$$\n项 $(f_i - o_i)$ 是未订正误差 $e_i$。未订正偏差为 $B(0) = \\frac{1}{n}\\sum_{i=1}^{n} (f_i - o_i)$。我们可以将求和分开：\n$$B(c) = \\frac{1}{n}\\sum_{i=1}^{n} (f_i - o_i) - \\frac{1}{n}\\sum_{i=1}^{n} c$$\n第一项是 $B(0)$。第二项是 $\\frac{1}{n}(nc) = c$。因此，我们得到：\n$$B(c) = B(0) - c$$\n这就将 $B(c)$ 表示为常数 $c$ 和未订正偏差 $B(0)$ 的函数。\n$B(c)$ 关于 $c$ 的导数是：\n$$\\frac{dB}{dc} = \\frac{d}{dc}(B(0) - c) = -1$$\n因为 $B(0)$ 相对于 $c$ 是一个常数。\n\n第二个任务是将均方根误差的平方 $R(c)^2$ 表示为一种分离偏差贡献的形式。$R(c)^2$ 是订正预报的均方误差 (MSE)。\n$$R(c)^2 = \\frac{1}{n}\\sum_{i=1}^{n} e_i(c)^2$$\n我们使用样本 $\\{x_i\\}$（其均值为 $\\bar{x}$）的二阶矩的标准恒等式，即 $\\frac{1}{n}\\sum x_i^2 = \\bar{x}^2 + \\frac{1}{n}\\sum (x_i - \\bar{x})^2$。在我们的例子中，变量是 $e_i(c)$，其样本均值是 $B(c)$。应用此恒等式：\n$$R(c)^2 = \\left(\\frac{1}{n}\\sum_{i=1}^{n} e_i(c)\\right)^2 + \\frac{1}{n}\\sum_{i=1}^{n} \\left(e_i(c) - B(c)\\right)^2$$\n$$R(c)^2 = B(c)^2 + \\frac{1}{n}\\sum_{i=1}^{n} \\left(e_i(c) - B(c)\\right)^2$$\n这就是所要求的分解。第一项 $B(c)^2$ 依赖于 $c$。第二项是误差的中心二阶矩，在验证步骤中已证明其不依赖于 $c$。我们将这个非负常数项记为 $V_e = \\frac{1}{n}\\sum_{i=1}^{n} \\left(e_i - B(0)\\right)^2$。\n因此，$R(c)^2 = B(c)^2 + V_e$。\n\n第三个任务是找到使 $R(c)$ 最小化的值 $c = c^*$。由于 $R(c)$ 是非负的，最小化 $R(c)$ 等价于最小化 $R(c)^2$。我们需要找到表达式的最小值：\n$$R(c)^2 = (B(0) - c)^2 + V_e$$\n项 $V_e$ 相对于 $c$ 是常数。因此，最小化 $R(c)^2$ 等价于最小化项 $(B(0) - c)^2$。由于这是一个实数的平方，其最小值为 $0$，当平方内的项为零时达到。最小值在 $c^*$ 值处取得，使得：\n$$B(0) - c^* = 0$$\n这得出了最优订正值：\n$$c^* = B(0)$$\n这个结果表明，当加性订正值 $c$ 被选择为等于原始未订正预报的平均偏差时，均方误差（MSE）（以及均方根误差RMSE）达到最小，从而使得订正后的预报是无偏的。\n\n最后一个任务是用样本均值 $\\bar{f}$ 和 $\\bar{o}$ 来表示 $c^*$。\n我们有 $c^* = B(0)$。根据定义，未订正偏差是：\n$$B(0) = \\frac{1}{n}\\sum_{i=1}^{n} (f_i - o_i)$$\n利用求和的分配律：\n$$B(0) = \\frac{1}{n}\\sum_{i=1}^{n} f_i - \\frac{1}{n}\\sum_{i=1}^{n} o_i$$\n根据样本均值 $\\bar{f}$ 和 $\\bar{o}$ 的定义，这变为：\n$$B(0) = \\bar{f} - \\bar{o}$$\n因此，使均方根误差最小化的 $c$ 的值为：\n$$c^* = \\bar{f} - \\bar{o}$$",
            "answer": "$$\\boxed{\\bar{f} - \\bar{o}}$$"
        }
    ]
}