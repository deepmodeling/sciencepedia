{
    "hands_on_practices": [
        {
            "introduction": "在构建或选择一个大气模型之前，首要步骤是理解目标现象的主导物理过程。尺度分析是一种强有力的工具，它通过对控制方程进行无量纲化，帮助我们识别决定流动状态的关键参数。本练习  将引导你计算罗斯贝数（Rossby number）、弗劳德数（Froude number）和马赫数（Mach number），并基于这些数值，为特定的中尺度天气情景论证为何应采用非静力、声波过滤（sound-proof）的模式。",
            "id": "3898947",
            "problem": "考虑一个位于中纬度的干燥、稳定分层的大气层，其深度为 $H$，水平尺度为 $L$。该大气层的特征水平风速为 $U$，Coriolis 参数为 $f$，Brunt–Väisälä 频率为 $N$，声速为 $c$。从旋转、可压缩的 Navier–Stokes 方程和 Brunt–Väisälä 频率的定义出发，进行第一性原理的标度分析，以识别和定义三个量化旋转、分层和可压缩性相对重要性的无量纲群。使用这些无量纲群，为参数集 $U=15\\,\\mathrm{m\\,s^{-1}}$，$L=20\\,\\mathrm{km}$，$H=5\\,\\mathrm{km}$，$f=10^{-4}\\,\\mathrm{s^{-1}}$，$N=0.01\\,\\mathrm{s^{-1}}$ 和 $c=320\\,\\mathrm{m\\,s^{-1}}$ 计算它们的值。将每个无量纲值四舍五入至三位有效数字。根据您计算出的量级，论证保留非静力动力学是否必要，以及无声波（sound-proof）公式（例如，滞弹性或伪不可压缩模型）是否适用于此流态。您的最终答案必须只包含这三个无量纲值，按旋转、分层、可压缩性的顺序排列，并表示为单个行向量。无量纲值没有单位；请勿在最终答案中包含任何单位。",
            "solution": "该问题陈述已经过验证，被确定为地球物理流体动力学中一个适定、有科学依据的问题。所有必要的参数均已提供，其数值对于中尺度大气现象是物理上现实的。\n\n任务是对大气运动的控制方程进行标度分析，以推导出表征流态的三个关键无量纲参数。这些参数量化了旋转、分层和可压缩性的相对重要性。\n\n旋转、可压缩流体的基本方程是 Navier-Stokes 方程。出于标度分析的目的，我们可以考虑应用于干燥大气的无粘性形式（Euler 方程）。相关方程包括动量方程、连续性方程和热力学方程。\n\n设流动的特征尺度为：\n- 水平速度：$U$\n- 垂直速度：$W$\n- 水平长度：$L$\n- 垂直长度：$H$\n- 时间：$T \\sim L/U$（平流时间尺度）\n- 相对于静力平衡基态的压力扰动：$P$\n- 相对于基态的密度扰动：$R$\n\n分析过程是通过对控制方程进行无量纲化并检验各项的比值来进行的。\n\n**1. 旋转：Rossby 数 ($Ro$)**\n\n水平动量方程为：\n$$ \\frac{D\\mathbf{u}_h}{Dt} = -f \\mathbf{k} \\times \\mathbf{u}_h - \\frac{1}{\\rho}\\nabla_h p $$\n此处，$\\mathbf{u}_h$ 是水平速度矢量，$f$ 是 Coriolis 参数，$\\mathbf{k}$ 是垂直单位矢量，$\\rho$ 是密度，$p$ 是压力。物质导数为 $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。\n\n控制大尺度水平动力学的两个主要项是惯性加速度（平流）和 Coriolis 力。\n- 惯性加速度的尺度：$|\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h| \\sim \\frac{U^2}{L}$\n- Coriolis 力的尺度：$|f \\mathbf{k} \\times \\mathbf{u}_h| \\sim fU$\n\n惯性项与 Coriolis 项之比定义了 Rossby 数，$Ro$：\n$$ Ro = \\frac{\\text{惯性力}}{\\text{Coriolis 力}} \\sim \\frac{U^2/L}{fU} = \\frac{U}{fL} $$\nRossby 数用于量化旋转的重要性。当 $Ro \\ll 1$ 时，流动处于地转平衡状态，并由旋转主导。当 $Ro \\gtrsim 1$ 时，惯性效应显著，流动是非地转的。\n\n**2. 分层：内 Froude 数 ($Fr$)**\n\n分层指的是流体的垂直密度梯度，它会产生浮力。Brunt-Väisälä 频率 $N$ 是在稳定分层中流体质块垂直振荡的自然频率。其平方定义为 $N^2 = \\frac{g}{\\theta_0} \\frac{d\\theta_0}{dz}$，其中 $g$ 是重力加速度，$\\theta_0$ 是背景位温。\n\n内 Froude 数 $Fr$ 比较了流动的动能与克服稳定分层所需的势能。它可以看作是特征流速 $U$ 与长内重力波的特征速度 $c_g \\sim NH$ 之比。\n$$ Fr = \\frac{U}{NH} $$\n当 $Fr \\ll 1$ 时，流动没有足够的动能来抵抗强分层作垂直运动，因此被限制在准水平方向上运动。当 $Fr \\gtrsim 1$ 时，流动可以克服浮力屏障，并可能发生显著的垂直运动。\n\n**3. 可压缩性：Mach 数 ($Ma$)**\n\n可压缩性效应与流体密度响应压力变化而发生的变化有关。这些效应与声波的传播紧密相关。量化可压缩性重要性的参数是 Mach 数 $Ma$，定义为特征流速 $U$ 与声速 $c$ 之比。\n$$ Ma = \\frac{U}{c} $$\n该推导源于完整的连续性方程 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} + \\nabla \\cdot \\mathbf{u} = 0$，其中 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt}$ 可以通过声速与压力变化相关联，即 $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} = \\frac{1}{\\rho c^2}\\frac{Dp}{Dt}$。标度分析表明，这个可压缩性项与散度项 $\\nabla \\cdot \\mathbf{u}$ 的比值量级为 $Ma^2 = (U/c)^2$。当 $Ma \\ll 1$ 时，由压力变化引起的密度变化在动力学上可以忽略不计，流动可以近似为声学不可压缩的（例如，使用滞弹性模型）。\n\n**无量纲值的计算**\n\n给定的参数值为：\n- $U = 15\\,\\mathrm{m\\,s^{-1}}$\n- $L = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n- $H = 5\\,\\mathrm{km} = 5 \\times 10^3\\,\\mathrm{m}$\n- $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n- $N = 0.01\\,\\mathrm{s^{-1}}$\n- $c = 320\\,\\mathrm{m\\,s^{-1}}$\n\n三个无量纲群的计算如下：\n\n- **Rossby 数 ($Ro$)：**\n$$ Ro = \\frac{U}{fL} = \\frac{15}{ (10^{-4}) \\times (2 \\times 10^4) } = \\frac{15}{2} = 7.5 $$\n四舍五入至三位有效数字，$Ro = 7.50$。\n\n- **内 Froude 数 ($Fr$)：**\n$$ Fr = \\frac{U}{NH} = \\frac{15}{ (0.01) \\times (5 \\times 10^3) } = \\frac{15}{50} = 0.3 $$\n四舍五入至三位有效数字，$Fr = 0.300$。\n\n- **Mach 数 ($Ma$)：**\n$$ Ma = \\frac{U}{c} = \\frac{15}{320} = 0.046875 $$\n四舍五入至三位有效数字，$Ma = 0.0469$。\n\n**模型选择的论证**\n\n基于计算出的值：\n\n- **非静力动力学：** 当垂直加速度与垂直压力梯度和浮力相比可以忽略不计时，静力近似有效。评估这一点的一个常用标准是几何长宽比 $\\delta = H/L$。对于给定的参数，$\\delta = \\frac{5\\,\\mathrm{km}}{20\\,\\mathrm{km}} = 0.25$。由于 $\\delta$ 并不远小于1，预计垂直加速度将是显著的。另一个指标是静止内重力波的水平波长，$\\lambda_x = 2\\pi U/N = 2\\pi (15)/(0.01) \\approx 9425\\,\\mathrm{m} = 9.4\\,\\mathrm{km}$。这个自然响应波长与给定的水平尺度 $L=20\\,\\mathrm{km}$ 处于同一量级，这表明所产生的流动结构的长宽比不会很小，从而违反了静力假设。因此，**保留非静力动力学是必要的**。\n\n- **无声波（Sound-proof）公式：** Mach 数为 $Ma \\approx 0.0469$。由于 $Ma \\ll 1$ （通常标准是 $Ma  0.3$），该流动完全处于低 Mach 数流态。这意味着对于我们关心的现象，声波在动力学上不重要，并且其传播速度远快于平流过程。使用完全可压缩模型在计算上是不可行的，因为时间步长会受到声波的 Courant-Friedrichs-Lewy (CFL) 条件的严格限制。一个无声波模型，如滞弹性或伪不可压缩公式，会滤除这些声学模态，同时保留与惯性、旋转和浮力相关的基本动力学。因此，对于此流态，**采用无声波公式是合适的**并且非常有利。\n\n最终答案由三个计算出的无量纲值组成。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.50  0.300  0.0469\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "即使物理方程是正确的，其数值实现也可能引入严重的误差。一个经典的例子是在地形追随坐标系下计算跨越陡峭地形的水平气压梯度力（PGF）。本练习  揭示了一个朴素的离散格式如何在静止大气中产生虚假的加速度，并介绍了“守恒均衡”（well-balanced）格式的概念，该格式能够精确地消除这一数值误差，确保模型在复杂地形上的可靠性。",
            "id": "4068851",
            "problem": "考虑一个在陡峭地形上处于静止流体静力平衡状态的二维、干、可压缩、非静力大气。静止状态满足静力平衡 $ \\frac{\\partial p}{\\partial z} = - \\rho g $，其中 $p$ 是压强，$\\rho$ 是密度，$z$ 是几何高度，$g$ 是重力加速度。地形高度由 $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $ 给出，其中 $z_{0}$、振幅 $A$ 和水平波长 $L$ 是常数。垂直坐标是地形追随sigma坐标 $ \\sigma \\in [0,1] $，其映射关系为\n$$\nz(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H,\n$$\n其中 $H$ 是一个恒定的模式顶高度。在 sigma 坐标模式中，对水平气压梯度力的一个朴素实现是，水平气压梯度在固定的 $ \\sigma $（而不是固定的几何高度 $z$）上进行离散化，因此，在静力平衡的静止状态下，残余的水平加速度变为 $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $。\n\n从上述静力平衡和 sigma 坐标映射出发，推导 $ a_{\\text{naive}} $ 的闭式表达式，用 $ g $、$ \\sigma $ 和地形坡度 $ \\frac{d z_{s}}{d x} $ 表示。然后，对于参数值 $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $、$ H = 12{,}000 \\ \\mathrm{m} $、$ z_{0} = 1{,}500 \\ \\mathrm{m} $、$ A = 1{,}000 \\ \\mathrm{m} $、$ L = 30{,}000 \\ \\mathrm{m} $，计算在 $ x = 0 $ 和 $ \\sigma = 0.25 $ 处的 $ a_{\\text{naive}} $。最后，根据第一性原理，解释一个强制在固定几何高度 $z$ 上计算水平气压梯度（或等效地，添加适当的度量修正）的良好平衡修正是如何减少静力平衡静止状态下的残余加速度的。\n\n将您对 $ a_{\\text{naive}} $ 的数值结果四舍五入到四位有效数字。用 $ \\mathrm{m\\,s^{-2}} $ 单位表示最终的加速度。您的最终答案必须是一个实数。",
            "solution": "该问题要求推导和评估在地形追随坐标系中，当气压梯度力被朴素计算时产生的一个虚假水平加速度。它还要求解释在一个良好平衡的数值格式中如何校正这个误差。\n\n首先，我们验证问题的有效性。该设置是数值大气模拟中的一个经典教科书案例，特别是关于 sigma 坐标系中的气压梯度力误差。所有提供的物理原理、方程和参数都是标准的、一致的且科学合理的。该问题是良定的，并包含唯一解所需的所有必要信息。因此，该问题是有效的。\n\n核心任务是推导朴素水平加速度的表达式，其定义为 $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $。项 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ 表示在保持 sigma 坐标 $\\sigma$ 不变的情况下，压强 $p$ 对水平坐标 $x$ 的偏导数。\n\n为了将其与物理量联系起来，我们必须将导数从 $ (x, \\sigma) $ 坐标系转换到物理 $ (x, z) $ 坐标系。物理上，压强 $p$ 是 $x$ 和 $z$ 的函数，即 $ p(x, z) $。在 sigma 坐标系中，垂直坐标 $z$ 本身是 $x$ 和 $\\sigma$ 的函数，所以我们有 $ p(x, z(x, \\sigma)) $。使用多元函数的链式法则，我们可以将 $p$ 在 $\\sigma$ 恒定时对 $x$ 的偏导数表示为：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} + \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n问题指出大气处于静止的静力平衡状态。在这种状态下，在恒定的几何高度 ($z$) 面上，压强没有水平变化。压强场仅取决于垂直坐标，$ p = p(z) $。这意味着真正的水平气压梯度为零：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = 0\n$$\n垂直气压梯度由静力平衡方程给出：\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g\n$$\n我们需要的最后一项是恒定 $\\sigma$ 曲面的斜率，即 $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} $。我们通过对给定的坐标变换 $ z(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H $ 在保持 $\\sigma$ 恒定的情况下对 $x$ 求导来找到它：\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H \\right]\n$$\n由于 $\\sigma$ 和 $H$ 相对于此微分是常数，我们得到：\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n现在我们将这三个分量代回链式法则表达式中：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = 0 + (-\\rho g) \\left( (1 - \\sigma) \\frac{d z_{s}}{d x} \\right) = - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n最后，我们将这个结果代入 $ a_{\\text{naive}} $ 的定义中：\n$$\na_{\\text{naive}} = - \\frac{1}{\\rho} \\left[ - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x} \\right] = g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\n这就是所要求的虚假加速度的闭式表达式。\n\n接下来，我们根据给定的参数在 $ x = 0 $ 和 $ \\sigma = 0.25 $ 处计算这个表达式的值。地形高度为 $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $。首先，我们计算地形坡度 $ \\frac{d z_{s}}{d x} $：\n$$\n\\frac{d z_{s}}{d x} = \\frac{d}{dx} \\left[ z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) \\right] = A \\cos\\!\\left(\\frac{2\\pi}{L} x\\right) \\cdot \\frac{2\\pi}{L}\n$$\n计算在 $ x = 0 $ 处的坡度：\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi A}{L} \\cos(0) = \\frac{2\\pi A}{L}\n$$\n现在我们代入给定的数值：$ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $，$ A = 1{,}000 \\ \\mathrm{m} $，和 $ L = 30{,}000 \\ \\mathrm{m} $：\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi (1000)}{30000} = \\frac{2\\pi}{30} = \\frac{\\pi}{15}\n$$\n这是一个无量纲量（坡度）。现在我们可以在 $ \\sigma = 0.25 $ 处计算 $ a_{\\text{naive}} $：\n$$\na_{\\text{naive}} = g (1 - \\sigma) \\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = (9.81) \\cdot (1 - 0.25) \\cdot \\left(\\frac{\\pi}{15}\\right)\n$$\n$$\na_{\\text{naive}} = (9.81) \\cdot (0.75) \\cdot \\left(\\frac{\\pi}{15}\\right) = (9.81) \\cdot \\frac{3}{4} \\cdot \\frac{\\pi}{15} = \\frac{9.81 \\pi}{20}\n$$\n计算数值：\n$$\na_{\\text{naive}} \\approx 1.54096119 \\dots \\ \\mathrm{m\\,s^{-2}}\n$$\n四舍五入到四位有效数字得到 $ 1.541 \\ \\mathrm{m\\,s^{-2}} $。\n\n最后，我们解释一个良好平衡的修正是如何校正这个虚假加速度的。\n误差的根本来源是，朴素计算 $ - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ 并不代表真正的水平气压梯度力。真正的水平加速度由 $ a_x = - \\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $ 给出。在静止的静力平衡状态下，$ a_x = 0 $。朴素计算产生非零结果是因为恒定 $\\sigma$ 曲面不是水平的，而是跟随地形。在倾斜的地形上沿着恒定的 $\\sigma$ 曲面移动会涉及几何高度 $z$ 的变化，这在静力平衡大气中意味着压强的变化。朴素的公式将这种压强变化误解为水平气压梯度。\n\n一个良好平衡的格式被设计用来正确地计算真正的水平气压梯度，即 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $。从我们的链式法则展开式中，我们可以重新排列来求解这一项：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n因此，良好平衡的水平加速度是：\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = - \\frac{1}{\\rho} \\left( \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} \\right)\n$$\n将静力平衡关系 $ \\frac{\\partial p}{\\partial z} = - \\rho g $ 代入校正项得到：\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\n这个修正后的公式包含两项：$\\sigma$ 曲面上的朴素气压梯度和一个解释该曲面斜率的度量校正项。对于静止状态，我们之前推导出 $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = -\\rho g (1-\\sigma)\\frac{dz_s}{dx} $ 和 $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1-\\sigma)\\frac{dz_s}{dx} $。将这些代入良好平衡的公式中得到：\n$$\na_x = - \\frac{1}{\\rho} \\left( -\\rho g (1-\\sigma)\\frac{dz_s}{dx} \\right) - g \\left( (1-\\sigma)\\frac{dz_s}{dx} \\right)\n$$\n$$\na_x = g (1-\\sigma)\\frac{dz_s}{dx} - g (1-\\sigma)\\frac{dz_s}{dx} = 0\n$$\n因此，良好平衡的格式正确地计算出静止状态的加速度为零，因为两个大的、相反的项完全抵消了。一个良好平衡的数值模式的本质是以一种一致的方式对这两项进行离散化，以保持这种抵消特性，从而防止在地形上产生虚假流动。",
            "answer": "$$\\boxed{1.541}$$"
        },
        {
            "introduction": "开发数值模型后，必须验证其是否正确地求解了控制方程。这通常通过一系列具有已知精确解或公认基准解的标准测试来完成。本练习  提供了一个典型的模型验证框架，它使用一个简化的上升热泡场景来系统地评估平流方案的收敛阶，这是检验任何非静力模型核心算法准确性的关键步骤。",
            "id": "4068897",
            "problem": "考虑一个由矩形 $\\Omega = [0,L_x]\\times[0,L_z]$ 表示的二维干空气域，其具有周期性的水平和垂直边界。在用于数值天气预报（NWP）的非静力大气模型中，上升暖泡测试用于评估模型在指定动力学条件下输送和演变局地位温扰动的能力。为了分离并评估标量输运的离散化精度，使用一个人为构造的测试，其中扰动由一个恒定的、无辐散的速度场进行平流。这种方法将输运算子与浮力引起的加速度分离开来，同时为验证目的保留了科学真实性。\n\n从给定速度下的位温输运的标量守恒定律出发：\n$$\n\\frac{\\partial \\theta}{\\partial t} + u\\frac{\\partial \\theta}{\\partial x} + w\\frac{\\partial \\theta}{\\partial z} = 0,\n$$\n其中 $\\theta$ 是位温，$u$ 是水平速度，$w$ 是垂直速度。假设初始条件是一个叠加在恒定背景上的暖高斯泡：\n$$\n\\theta(x,z,0) = \\theta_b + A\\exp\\left(-\\frac{(x-x_0)^2 + (z-z_0)^2}{2R^2}\\right),\n$$\n其中 $\\theta_b$ 是背景位温，$A$ 是泡的振幅，$(x_0,z_0)$ 是泡的中心，$R$ 是泡的半径。在指定的恒定速度下，时刻 $t$ 的精确解是其平移形式\n$$\n\\theta_{\\text{exact}}(x,z,t) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x,t)-x_0\\big)^2 + \\big(\\tilde{z}(z,t)-z_0\\big)^2}{2R^2}\\right),\n$$\n其中的周期性位移为 $\\tilde{x}(x,t) = (x - ut)\\bmod L_x$ 和 $\\tilde{z}(z,t) = (z - wt)\\bmod L_z$。\n\n使用 MacCormack 预报-校正方法（对于光滑解，在空间和时间上具有二阶精度），在具有 $N_x$ 个 $x$ 方向格点和 $N_z$ 个 $z$ 方向格点的均匀网格上对标量输运进行离散化。令 $\\Delta x = L_x/N_x$，$\\Delta z = L_z/N_z$，并选择满足 Courant–Friedrichs–Lewy (CFL) 条件的时间步长 $\\Delta t$：\n$$\n\\Delta t = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right),\n$$\n并进行调整以确保精确达到最终时刻。在周期性网格上，MacCormack 格式通过以下方式将 $\\theta^n$ 推进到 $\\theta^{n+1}$：\n预报步：\n$$\n\\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right),\n$$\n校正步：\n$$\n\\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right],\n$$\n其中指数进行周期性处理（例如，当 $i=N_x-1$ 时，$i+1$ 映射为 $0$，在 $z$ 方向上类似）。\n\n为了在最终时刻 $T$ 进行比较，定义在 $\\Omega$ 上空间平均的积分范数作为具有科学意义的误差范数，以使所有范数的单位均为开尔文：\n- 归一化的 $L^1$ 范数：\n$$\n\\|e\\|_{L^1} = \\frac{1}{L_x L_z} \\int_\\Omega |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)| \\, dx\\, dz.\n$$\n- 归一化的 $L^2$ 范数：\n$$\n\\|e\\|_{L^2} = \\sqrt{\\frac{1}{L_x L_z} \\int_\\Omega \\left(\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)\\right)^2 \\, dx\\, dz }.\n$$\n- $L^\\infty$ 范数：\n$$\n\\|e\\|_{L^\\infty} = \\max_{(x,z)\\in\\Omega} |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)|.\n$$\n使用 $\\Delta x\\Delta z$ 作为网格单元面积，在离散网格上通过黎曼和来近似这些积分。\n\n使用在连续网格间距 $h_k = \\max(\\Delta x_k,\\Delta z_k)$ 下的归一化 $L^2$ 误差，计算观测到的精度阶 $p$：\n$$\np_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}.\n$$\n\n使用以下科学上一致的参数（单位采用国际单位制，即 SI）：\n- 区域尺寸：$L_x = 1000\\,\\mathrm{m}$，$L_z = 1000\\,\\mathrm{m}$。\n- 恒定速度：$u = 5\\,\\mathrm{m/s}$，$w = 2\\,\\mathrm{m/s}$。\n- 泡参数：背景 $\\theta_b = 300\\,\\mathrm{K}$，振幅 $A = 1\\,\\mathrm{K}$，半径 $R = 100\\,\\mathrm{m}$，中心 $(x_0,z_0)=(200\\,\\mathrm{m},200\\,\\mathrm{m})$。\n- 最终时间：$T = 100\\,\\mathrm{s}$。\n- Courant–Friedrichs–Lewy (CFL) 数：$\\mathrm{CFL}=0.4$ (无量纲)。\n- 网格 (测试集)：案例1使用 $(N_x,N_z)=(32,32)$，案例2使用 $(64,64)$，案例3使用 $(128,128)$，案例4使用 $(256,256)$。\n\n任务：\n1. 为上述标量输运问题实现带周期性边界的 MacCormack 格式。\n2. 对于测试集中的每个网格，计算在时刻 $T$ 时数值解与精确解之间的归一化 $L^1$、归一化 $L^2$ 和 $L^\\infty$ 误差范数。\n3. 使用归一化的 $L^2$ 误差，计算在连续网格分辨率 $(32\\to64)$、$(64\\to128)$ 和 $(128\\to256)$ 之间的观测精度阶 $p$。\n\n答案规格：\n- 所有误差范数以开尔文表示，并四舍五入到六位小数。\n- 观测精度阶 $p$ 以无量纲浮点数表示，并四舍五入到六位小数。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$$\n[\\|e\\|_{L^2}(32), \\|e\\|_{L^2}(64), \\|e\\|_{L^2}(128), \\|e\\|_{L^2}(256), p_{32\\to64}, p_{64\\to128}, p_{128\\to256}]\n$$\n其中每个 $\\|e\\|_{L^2}(N)$ 是 $N_x=N_z=N$ 网格的归一化 $L^2$ 误差。所有误差单位为 $\\mathrm{K}$，所有 $p$ 值均为无量纲，且均四舍五入到六位小数。",
            "solution": "该问题被评估为科学上合理、适定、客观且自洽的。它描述了标量平流方程的一个标准数值验证测试，这是计算流体动力学和数值天气预报中的一个基本问题。所有参数、方程和数值方法都得到了清晰且正确的定义。该问题是有效的。\n\n解题过程如下：\n首先，我们根据问题陈述确定物理和数值参数。\n区域为 $\\Omega = [0,L_x]\\times[0,L_z]$，其中 $L_x = 1000\\,\\mathrm{m}$ 且 $L_z = 1000\\,\\mathrm{m}$。\n恒定速度场为 $(u, w) = (5\\,\\mathrm{m/s}, 2\\,\\mathrm{m/s})$。\n初始位温扰动是一个高斯泡，定义如下：\n- 背景位温 $\\theta_b = 300\\,\\mathrm{K}$\n- 振幅 $A = 1\\,\\mathrm{K}$\n- 半径 $R = 100\\,\\mathrm{m}$\n- 初始中心 $(x_0, z_0) = (200\\,\\mathrm{m}, 200\\,\\mathrm{m})$\n\n模拟运行至最终时刻 $T = 100\\,\\mathrm{s}$。数值格式使用由 Courant–Friedrichs–Lewy (CFL) 数 $\\mathrm{CFL}=0.4$ 确定的时间步长 $\\Delta t$ 向前推进。\n\n对于每个具有网格分辨率 $(N_x, N_z)$ 的测试用例，我们执行以下步骤：\n\n1.  **网格和时间步长离散化**：\n    定义一个在 x 方向上有 $N_x$ 个格点、在 z 方向上有 $N_z$ 个格点的均匀网格。网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta z = L_z/N_z$。格点坐标为 $(x_i, z_j) = (i\\Delta x, j\\Delta z)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_z-1\\}$。\n    时间步长 $\\Delta t$ 必须满足 CFL 条件并确保模拟精确达到最终时刻 $T$。首先，计算一个临时时间步长：\n    $$\n    \\Delta t_{\\text{CFL}} = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right)\n    $$\n    然后，时间步数 $N_t$ 计算为满足 $N_t \\Delta t_{\\text{CFL}} \\ge T$ 的最小整数：\n    $$\n    N_t = \\left\\lceil \\frac{T}{\\Delta t_{\\text{CFL}}} \\right\\rceil\n    $$\n    随后，用于模拟的最终时间步长被调整为：\n    $$\n    \\Delta t = \\frac{T}{N_t}\n    $$\n\n2.  **初始条件**：\n    连续的初始条件被离散化到网格上，得到初始场 $\\theta^0_{i,j}$：\n    $$\n    \\theta^0_{i,j} = \\theta(x_i, z_j, 0) = \\theta_b + A\\exp\\left(-\\frac{(x_i-x_0)^2 + (z_j-z_0)^2}{2R^2}\\right)\n    $$\n\n3.  **使用 MacCormack 格式进行时间积分**：\n    解在 $N_t$ 个步长内从时间 $t=0$ 推进到 $t=T$。在每个时间步 $n$，从 $\\theta^n$ 到 $\\theta^{n+1}$，应用两步 MacCormack 方法。考虑到使用了周期性边界条件，有限差分所需的空间位移可以通过对数据数组进行循环滚动操作来高效实现。\n\n    **预报步**：此步骤对空间导数使用向前差分。\n    $$\n    \\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right)\n    $$\n    指数按周期性处理，例如，对于 $i=N_x-1$，$i+1$ 变为 $0$。\n\n    **校正步**：此步骤对预报场 $\\hat{\\theta}$ 使用向后差分。\n    $$\n    \\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right]\n    $$\n    同样，指数也按周期性处理。这个两步过程在最终时刻 $T$ 得到数值解 $\\theta^{N_t}_{i,j}$。\n\n4.  **精确解计算**：\n    在最终时刻 $T$，每个网格点 $(x_i, z_j)$ 上的精确解使用提供的公式计算，该公式考虑了周期性包裹：\n    $$\n    \\theta_{\\text{exact}}(x_i,z_j,T) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x_i,T)-x_0\\big)^2 + \\big(\\tilde{z}(z_j,T)-z_0\\big)^2}{2R^2}\\right)\n    $$\n    其中 $\\tilde{x}(x_i,T) = (x_i - uT)\\bmod L_x$ 且 $\\tilde{z}(z_j,T) = (z_j - wT)\\bmod L_z$。\n\n5.  **误差范数计算**：\n    误差场是数值解与精确解之差：$e_{i,j} = \\theta^{N_t}_{i,j} - \\theta_{\\text{exact}}(x_i,z_j,T)$。指定的范数由离散求和来近似。\n    - 归一化的 $L^1$ 范数：\n    $$\n    \\|e\\|_{L^1} \\approx \\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} |e_{i,j}|\n    $$\n    - 归一化的 $L^2$ 范数：\n    $$\n    \\|e\\|_{L^2} \\approx \\sqrt{\\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} e_{i,j}^2}\n    $$\n    - $L^\\infty$ 范数：\n    $$\n    \\|e\\|_{L^\\infty} \\approx \\max_{i,j} |e_{i,j}|\n    $$\n\n6.  **观测精度阶的计算**：\n    在计算出对应于特征网格间距 $h_k$ 和 $h_{k+1}$ 的两个连续网格分辨率下的归一化 $L^2$ 误差 $\\|e\\|_{L^2}(h_k)$ 后，观测到的精度阶 $p$ 计算如下：\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}\n    $$\n    由于网格在每个维度上都加密了 2 倍，即 $N_{k+1}=2N_k$，这意味着 $h_{k+1}=h_k/2$。分母简化为 $\\ln(h_k/h_{k+1}) = \\ln(2)$。\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k) / \\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(2)}\n    $$\n\n对测试集中的每个网格分辨率：$(32,32)$、$(64,64)$、$(128,128)$ 和 $(256,256)$，重复此过程。最终输出将包括计算出的四个 $\\|e\\|_{L^2}$ 范数和三个由此得到的观测精度阶 $p$。鉴于 MacCormack 格式对于光滑解是二阶精度的，计算出的 $p$ 值预期将接近 2。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    def run_simulation(N):\n        \"\"\"\n        Runs a single simulation for a given grid resolution N x N.\n\n        Args:\n            N (int): The number of grid points in each dimension (Nx and Nz).\n\n        Returns:\n            tuple: A tuple containing the L1, L2, and L-infinity error norms.\n        \"\"\"\n        # Scientific parameters (SI units)\n        Lx = 1000.0  # m\n        Lz = 1000.0  # m\n        u = 5.0      # m/s\n        w = 2.0      # m/s\n        theta_b = 300.0  # K\n        A = 1.0      # K\n        R = 100.0    # m\n        x0 = 200.0   # m\n        z0 = 200.0   # m\n        T = 100.0    # s\n        CFL = 0.4    # dimensionless\n\n        # Grid and time step discretization\n        Nx, Nz = N, N\n        dx, dz = Lx / Nx, Lz / Nz\n        \n        # Grid coordinates\n        # Using np.arange for grid points [0, L-dx]\n        x = np.arange(Nx) * dx\n        z = np.arange(Nz) * dz\n        # meshgrid with 'xy' indexing (default) creates arrays of shape (Nz, Nx)\n        # xx[j, i] = x[i], zz[j, i] = z[j]\n        xx, zz = np.meshgrid(x, z)\n\n        # Time step calculation\n        if u == 0 and w == 0:\n             # aribtrary time step if velocity is zero, though problem states non-zero\n             dt_cfl = 1.0\n        else:\n            dt_cfl_x = dx / abs(u) if abs(u)  0 else float('inf')\n            dt_cfl_z = dz / abs(w) if abs(w)  0 else float('inf')\n            dt_cfl = CFL * min(dt_cfl_x, dt_cfl_z)\n        \n        num_steps = int(np.ceil(T / dt_cfl))\n        dt = T / num_steps\n\n        # Initial condition\n        theta = theta_b + A * np.exp(-((xx - x0)**2 + (zz - z0)**2) / (2 * R**2))\n\n        # Time integration loop\n        for _ in range(num_steps):\n            theta_n = theta.copy()\n            \n            # Predictor step (forward differences)\n            # axis=1 for x-dir (columns), axis=0 for z-dir (rows)\n            dtheta_dx_fwd = (np.roll(theta_n, -1, axis=1) - theta_n) / dx\n            dtheta_dz_fwd = (np.roll(theta_n, -1, axis=0) - theta_n) / dz\n            hat_theta = theta_n - dt * (u * dtheta_dx_fwd + w * dtheta_dz_fwd)\n\n            # Corrector step (backward differences on hat_theta)\n            dhat_theta_dx_bwd = (hat_theta - np.roll(hat_theta, 1, axis=1)) / dx\n            dhat_theta_dz_bwd = (hat_theta - np.roll(hat_theta, 1, axis=0)) / dz\n            theta = 0.5 * (theta_n + hat_theta - dt * (u * dhat_theta_dx_bwd + w * dhat_theta_dz_bwd))\n\n        # Compute exact solution at time T\n        x_shifted = (xx - u * T) % Lx\n        z_shifted = (zz - w * T) % Lz\n        theta_exact = theta_b + A * np.exp(-((x_shifted - x0)**2 + (z_shifted - z0)**2) / (2 * R**2))\n\n        # Calculate error field and norms\n        error = theta - theta_exact\n        \n        # Normalized L1 norm\n        l1_norm = np.mean(np.abs(error))\n        # Normalized L2 norm\n        l2_norm = np.sqrt(np.mean(error**2))\n        # L-infinity norm\n        linf_norm = np.max(np.abs(error))\n\n        return l1_norm, l2_norm, linf_norm\n\n    # Define the test cases from the problem statement.\n    test_cases_N = [32, 64, 128, 256]\n\n    l2_errors = []\n    for N_val in test_cases_N:\n        _, l2, _ = run_simulation(N_val)\n        l2_errors.append(l2)\n\n    # Compute observed order of accuracy p\n    orders_of_accuracy = []\n    for i in range(len(l2_errors) - 1):\n        # p = log(E_k / E_{k+1}) / log(h_k / h_{k+1})\n        # h_k / h_{k+1} = (L/N_k) / (L/N_{k+1}) = N_{k+1} / N_k = 2\n        p = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders_of_accuracy.append(p)\n\n    # Assemble final result list as per problem specification\n    final_results = l2_errors + orders_of_accuracy\n\n    # Format and print the final output\n    formatted_results = [f\"{val:.6f}\" for val in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}