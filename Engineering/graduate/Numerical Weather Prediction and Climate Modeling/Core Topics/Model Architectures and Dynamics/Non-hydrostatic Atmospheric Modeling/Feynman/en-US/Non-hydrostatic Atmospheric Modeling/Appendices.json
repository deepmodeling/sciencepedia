{
    "hands_on_practices": [
        {
            "introduction": "Before building a complex atmospheric model, it is crucial to understand the dominant physical forces at play. This exercise guides you through a scaling analysis of the governing equations to derive key dimensionless numbers that characterize different flow regimes . By calculating the Rossby, Froude, and Mach numbers for a typical mesoscale scenario, you will develop a first-principles justification for when a non-hydrostatic, and potentially sound-proof, model is necessary.",
            "id": "3898947",
            "problem": "Consider a dry, stably stratified atmospheric layer of depth $H$ and horizontal scale $L$ at mid-latitudes, with a characteristic horizontal wind speed $U$, Coriolis parameter $f$, Brunt–Väisälä frequency $N$, and speed of sound $c$. Starting from the rotating, compressible Navier–Stokes equations and the definition of the Brunt–Väisälä frequency, perform a first-principles scaling analysis to identify and define three nondimensional groups that quantify the relative importance of rotation, stratification, and compressibility. Using those groups, compute their values for the parameter set $U=15\\,\\mathrm{m\\,s^{-1}}$, $L=20\\,\\mathrm{km}$, $H=5\\,\\mathrm{km}$, $f=10^{-4}\\,\\mathrm{s^{-1}}$, $N=0.01\\,\\mathrm{s^{-1}}$, and $c=320\\,\\mathrm{m\\,s^{-1}}$. Round each nondimensional value to three significant figures. Based on the magnitudes you find, justify whether retaining nonhydrostatic dynamics is necessary and whether a sound-proof formulation (for example, anelastic or pseudo-incompressible) is appropriate for this flow regime. Your final answer must be the three nondimensional values only, in the order corresponding to rotation, stratification, and compressibility, and expressed as a single row vector. The nondimensional values are unitless; do not include any units in the final answer.",
            "solution": "The problem statement has been validated and is determined to be a well-posed, scientifically grounded problem in geophysical fluid dynamics. All necessary parameters are provided, and their values are physically realistic for mesoscale atmospheric phenomena.\n\nThe task is to perform a scaling analysis of the governing equations of atmospheric motion to derive three key nondimensional parameters that characterize the flow regime. These parameters quantify the relative importance of rotation, stratification, and compressibility.\n\nThe fundamental equations for a rotating, compressible fluid are the Navier-Stokes equations. For scaling purposes, we can consider the inviscid form (Euler equations) applied to a dry atmosphere. The relevant equations are the momentum equation, the continuity equation, and a thermodynamic equation.\n\nLet the characteristic scales of the flow be:\n- Horizontal velocity: $U$\n- Vertical velocity: $W$\n- Horizontal length: $L$\n- Vertical length: $H$\n- Time: $T \\sim L/U$ (advective timescale)\n- Pressure perturbation from hydrostatic base state: $P$\n- Density perturbation from base state: $R$\n\nThe analysis proceeds by nondimensionalizing the governing equations and examining the ratios of the terms.\n\n**1. Rotation: The Rossby Number ($Ro$)**\n\nThe horizontal momentum equation is:\n$$ \\frac{D\\mathbf{u}_h}{Dt} = -f \\mathbf{k} \\times \\mathbf{u}_h - \\frac{1}{\\rho}\\nabla_h p $$\nHere, $\\mathbf{u}_h$ is the horizontal velocity vector, $f$ is the Coriolis parameter, $\\mathbf{k}$ is the vertical unit vector, $\\rho$ is density, and $p$ is pressure. The material derivative is $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$.\n\nThe two primary terms governing the large-scale horizontal dynamics are the inertial acceleration (advection) and the Coriolis force.\n- Scale of inertial acceleration: $|\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h| \\sim \\frac{U^2}{L}$\n- Scale of Coriolis force: $|f \\mathbf{k} \\times \\mathbf{u}_h| \\sim fU$\n\nThe ratio of the inertial term to the Coriolis term defines the Rossby number, $Ro$:\n$$ Ro = \\frac{\\text{Inertial Force}}{\\text{Coriolis Force}} \\sim \\frac{U^2/L}{fU} = \\frac{U}{fL} $$\nThe Rossby number quantifies the importance of rotation. For $Ro \\ll 1$, the flow is geostrophically balanced and dominated by rotation. For $Ro \\gtrsim 1$, inertial effects are significant, and the flow is ageostrophic.\n\n**2. Stratification: The Internal Froude Number ($Fr$)**\n\nStratification refers to the vertical density gradient of the fluid, which gives rise to buoyancy forces. The Brunt-Väisälä frequency, $N$, is the natural frequency of vertical oscillation of a fluid parcel in a stable stratification. Its square is defined as $N^2 = \\frac{g}{\\theta_0} \\frac{d\\theta_0}{dz}$, where $g$ is the acceleration due to gravity and $\\theta_0$ is the background potential temperature.\n\nThe internal Froude number, $Fr$, compares the kinetic energy of the flow to the potential energy required to overcome the stable stratification. It can be seen as the ratio of the characteristic flow speed $U$ to the characteristic speed of long internal gravity waves, $c_g \\sim NH$.\n$$ Fr = \\frac{U}{NH} $$\nWhen $Fr \\ll 1$, the flow has insufficient kinetic energy to move vertically against the strong stratification and is thus constrained to move quasi-horizontally. When $Fr \\gtrsim 1$, the flow can overcome the buoyancy barrier and significant vertical motion can occur.\n\n**3. Compressibility: The Mach Number ($Ma$)**\n\nCompressibility effects are related to the change in fluid density in response to pressure changes. These effects are tied to the propagation of sound waves. The parameter that quantifies the importance of compressibility is the Mach number, $Ma$, defined as the ratio of the characteristic flow speed $U$ to the speed of sound $c$.\n$$ Ma = \\frac{U}{c} $$\nThe derivation arises from the full continuity equation, $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} + \\nabla \\cdot \\mathbf{u} = 0$, where $\\frac{1}{\\rho}\\frac{D\\rho}{Dt}$ can be related to the pressure change via the speed of sound, $\\frac{1}{\\rho}\\frac{D\\rho}{Dt} = \\frac{1}{\\rho c^2}\\frac{Dp}{Dt}$. Scaling analysis shows that the ratio of this compressibility term to the divergence term $\\nabla \\cdot \\mathbf{u}$ is of the order $Ma^2 = (U/c)^2$. When $Ma \\ll 1$, density variations due to pressure changes are dynamically negligible, and the flow can be approximated as acoustically incompressible (e.g., using an anelastic model).\n\n**Calculation of Nondimensional Values**\n\nThe given parameter values are:\n- $U = 15\\,\\mathrm{m\\,s^{-1}}$\n- $L = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n- $H = 5\\,\\mathrm{km} = 5 \\times 10^3\\,\\mathrm{m}$\n- $f = 10^{-4}\\,\\mathrm{s^{-1}}$\n- $N = 0.01\\,\\mathrm{s^{-1}}$\n- $c = 320\\,\\mathrm{m\\,s^{-1}}$\n\nThe three nondimensional groups are calculated as follows:\n\n- **Rossby Number ($Ro$):**\n$$ Ro = \\frac{U}{fL} = \\frac{15}{ (10^{-4}) \\times (2 \\times 10^4) } = \\frac{15}{2} = 7.5 $$\nRounded to three significant figures, $Ro = 7.50$.\n\n- **Internal Froude Number ($Fr$):**\n$$ Fr = \\frac{U}{NH} = \\frac{15}{ (0.01) \\times (5 \\times 10^3) } = \\frac{15}{50} = 0.3 $$\nRounded to three significant figures, $Fr = 0.300$.\n\n- **Mach Number ($Ma$):**\n$$ Ma = \\frac{U}{c} = \\frac{15}{320} = 0.046875 $$\nRounded to three significant figures, $Ma = 0.0469$.\n\n**Justification of Model Choices**\n\nBased on the calculated values:\n\n- **Nonhydrostatic Dynamics:** The hydrostatic approximation is valid when vertical accelerations are negligible compared to the vertical pressure gradient and buoyancy forces. A common criterion for assessing this is the geometric aspect ratio, $\\delta = H/L$. For the given parameters, $\\delta = \\frac{5\\,\\mathrm{km}}{20\\,\\mathrm{km}} = 0.25$. Since $\\delta$ is not much smaller than $1$, vertical accelerations are expected to be significant. Another indicator is the horizontal wavelength of stationary internal gravity waves, $\\lambda_x = 2\\pi U/N = 2\\pi (15)/(0.01) \\approx 9425\\,\\mathrm{m} = 9.4\\,\\mathrm{km}$. This natural-response wavelength is of the same order as the given horizontal scale $L=20\\,\\mathrm{km}$, suggesting that the resulting flow structures will have an aspect ratio that is not small, thus violating the hydrostatic assumption. Therefore, **retaining nonhydrostatic dynamics is necessary**.\n\n- **Sound-proof Formulation:** The Mach number is $Ma \\approx 0.0469$. Since $Ma \\ll 1$ (typically, $Ma < 0.3$ is the criterion), the flow is well within the low-Mach-number regime. This means that sound waves are dynamically unimportant for the phenomenon of interest and propagate much faster than the advective processes. Using a fully compressible model would be computationally prohibitive because the time step would be severely restricted by the Courant-Friedrichs-Lewy (CFL) condition for sound waves. A sound-proof model, such as an anelastic or pseudo-incompressible formulation, filters out these acoustic modes while retaining the essential dynamics related to inertia, rotation, and buoyancy. Therefore, a **sound-proof formulation is appropriate** and highly advantageous for this flow regime.\n\nThe final answer consists of the three computed nondimensional values.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n7.50 & 0.300 & 0.0469\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Modeling atmospheric flow over complex terrain is a critical application for non-hydrostatic models, but it introduces significant numerical challenges. This problem explores one of the most classic errors: the spurious acceleration caused by an improperly formulated pressure gradient force in terrain-following coordinates . By deriving this error from first principles, you will gain insight into the design of \"well-balanced\" numerical schemes that are essential for accurate simulations over mountains.",
            "id": "4068851",
            "problem": "Consider a two-dimensional, dry, compressible, non-hydrostatic atmosphere in a resting hydrostatic equilibrium over steep terrain. The resting state satisfies the hydrostatic balance $ \\frac{\\partial p}{\\partial z} = - \\rho g $, where $p$ is pressure, $\\rho$ is density, $z$ is geometric height, and $g$ is the gravitational acceleration. The terrain height is given by $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $, with constants $z_{0}$, amplitude $A$, and horizontal wavelength $L$. The vertical coordinate is the terrain-following sigma coordinate $ \\sigma \\in [0,1] $ with the mapping\n$$\nz(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H,\n$$\nwhere $H$ is a constant model-top height. In a naive implementation of the horizontal pressure-gradient force in a sigma-coordinate model, the horizontal pressure gradient is discretized at fixed $ \\sigma $ (rather than at fixed geometric height $z$), so that the residual horizontal acceleration in the hydrostatic resting state becomes $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $.\n\nStarting from the hydrostatic balance and the sigma-coordinate mapping above, derive a closed-form expression for $ a_{\\text{naive}} $ in terms of $ g $, $ \\sigma $, and the terrain slope $ \\frac{d z_{s}}{d x} $. Then, for the parameter values $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $, $ H = 12{,}000 \\ \\mathrm{m} $, $ z_{0} = 1{,}500 \\ \\mathrm{m} $, $ A = 1{,}000 \\ \\mathrm{m} $, $ L = 30{,}000 \\ \\mathrm{m} $, evaluate $ a_{\\text{naive}} $ at $ x = 0 $ and $ \\sigma = 0.25 $. Finally, explain, using first principles, how a well-balanced modification that enforces the evaluation of the horizontal pressure gradient at fixed geometric height $z$ (or equivalently adds the appropriate metric correction) reduces the residual acceleration for the hydrostatic resting state.\n\nRound your numerical result for $ a_{\\text{naive}} $ to four significant figures. Express the final acceleration in $ \\mathrm{m\\,s^{-2}} $. Your final answer must be a single real number.",
            "solution": "The problem asks for the derivation and evaluation of a spurious horizontal acceleration that arises in a terrain-following coordinate system when the pressure gradient force is calculated naively. It also requires an explanation of how this error is corrected in a well-balanced numerical scheme.\n\nFirst, we validate the problem. The setup is a classic textbook case in numerical atmospheric modeling, specifically concerning the pressure gradient force error in sigma-coordinate systems. All provided physical principles, equations, and parameters are standard, consistent, and scientifically sound. The problem is well-posed and contains all necessary information for a unique solution. Therefore, the problem is valid.\n\nThe core task is to derive an expression for the naive horizontal acceleration, defined as $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $. The term $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ represents the partial derivative of pressure $p$ with respect to the horizontal coordinate $x$, holding the sigma coordinate $\\sigma$ constant.\n\nTo relate this to physical quantities, we must transform the derivative from the $ (x, \\sigma) $ coordinate system to the physical $ (x, z) $ coordinate system. Pressure $p$ is physically a function of $x$ and $z$, i.e., $ p(x, z) $. In the sigma-coordinate system, the vertical coordinate $z$ is itself a function of $x$ and $\\sigma$, so we have $ p(x, z(x, \\sigma)) $. Using the chain rule for multivariable functions, we can express the partial derivative of $p$ with respect to $x$ at constant $\\sigma$ as:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} + \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThe problem states that the atmosphere is in a resting hydrostatic equilibrium. In such a state, there are no horizontal variations in pressure on a constant geometric height ($z$) surface. The pressure field depends only on the vertical coordinate, $ p = p(z) $. This implies that the true horizontal pressure gradient is zero:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = 0\n$$\nThe vertical pressure gradient is given by the hydrostatic balance equation:\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g\n$$\nThe final term we need is the slope of the constant-$\\sigma$ surface, $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} $. We find this by differentiating the given coordinate transformation $ z(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H $ with respect to $x$ while holding $\\sigma$ constant:\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H \\right]\n$$\nSince $\\sigma$ and $H$ are constant with respect to this differentiation, we get:\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nNow we substitute these three components back into the chain rule expression:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = 0 + (-\\rho g) \\left( (1 - \\sigma) \\frac{d z_{s}}{d x} \\right) = - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nFinally, we substitute this result into the definition of $ a_{\\text{naive}} $:\n$$\na_{\\text{naive}} = - \\frac{1}{\\rho} \\left[ - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x} \\right] = g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nThis is the required closed-form expression for the spurious acceleration.\n\nNext, we evaluate this expression for the given parameters at $ x = 0 $ and $ \\sigma = 0.25 $. The terrain height is $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $. First, we calculate the terrain slope $ \\frac{d z_{s}}{d x} $:\n$$\n\\frac{d z_{s}}{d x} = \\frac{d}{dx} \\left[ z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) \\right] = A \\cos\\!\\left(\\frac{2\\pi}{L} x\\right) \\cdot \\frac{2\\pi}{L}\n$$\nEvaluating the slope at $ x = 0 $:\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi A}{L} \\cos(0) = \\frac{2\\pi A}{L}\n$$\nNow we substitute the given numerical values: $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $, $ A = 1{,}000 \\ \\mathrm{m} $, and $ L = 30{,}000 \\ \\mathrm{m} $:\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi (1000)}{30000} = \\frac{2\\pi}{30} = \\frac{\\pi}{15}\n$$\nThis is a dimensionless quantity (slope). Now we can compute $ a_{\\text{naive}} $ at $ \\sigma = 0.25 $:\n$$\na_{\\text{naive}} = g (1 - \\sigma) \\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = (9.81) \\cdot (1 - 0.25) \\cdot \\left(\\frac{\\pi}{15}\\right)\n$$\n$$\na_{\\text{naive}} = (9.81) \\cdot (0.75) \\cdot \\left(\\frac{\\pi}{15}\\right) = (9.81) \\cdot \\frac{3}{4} \\cdot \\frac{\\pi}{15} = \\frac{9.81 \\pi}{20}\n$$\nCalculating the numerical value:\n$$\na_{\\text{naive}} \\approx 1.54096119 \\dots \\ \\mathrm{m\\,s^{-2}}\n$$\nRounding to four significant figures gives $ 1.541 \\ \\mathrm{m\\,s^{-2}} $.\n\nFinally, we explain how a well-balanced modification corrects this spurious acceleration.\nThe fundamental source of the error is that the naive calculation $ - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ does not represent the true horizontal pressure gradient force. The true horizontal acceleration is given by $ a_x = - \\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $. In a resting hydrostatic state, $ a_x = 0 $. The naive calculation produces a non-zero result because constant-$\\sigma$ surfaces are not horizontal but follow the terrain. Moving along a constant-$\\sigma$ surface over sloped terrain involves a change in geometric height $z$, which in a hydrostatic atmosphere means a change in pressure. The naive formulation misinterprets this pressure change as a horizontal pressure gradient.\n\nA well-balanced scheme is designed to compute the true horizontal pressure gradient, $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $, correctly. From our chain rule expansion, we can rearrange to solve for this term:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThe well-balanced horizontal acceleration is therefore:\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = - \\frac{1}{\\rho} \\left( \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} \\right)\n$$\nSubstituting the hydrostatic relation $ \\frac{\\partial p}{\\partial z} = - \\rho g $ into the correction term yields:\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThis corrected formulation consists of two terms: the naive pressure gradient on the $\\sigma$-surface and a metric correction term that accounts for the slope of that surface. For the resting state, we derived earlier that $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = -\\rho g (1-\\sigma)\\frac{dz_s}{dx} $ and $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1-\\sigma)\\frac{dz_s}{dx} $. Substituting these into the well-balanced formula gives:\n$$\na_x = - \\frac{1}{\\rho} \\left( -\\rho g (1-\\sigma)\\frac{dz_s}{dx} \\right) - g \\left( (1-\\sigma)\\frac{dz_s}{dx} \\right)\n$$\n$$\na_x = g (1-\\sigma)\\frac{dz_s}{dx} - g (1-\\sigma)\\frac{dz_s}{dx} = 0\n$$\nThus, the well-balanced scheme correctly calculates zero acceleration for the resting state because the two large, opposing terms cancel perfectly. The essence of a well-balanced numerical model is to discretize these two terms in a consistent manner to preserve this cancellation property, preventing the generation of spurious flows over terrain.",
            "answer": "$$\\boxed{1.541}$$"
        },
        {
            "introduction": "Verifying that a numerical scheme behaves as theoretically expected is a fundamental step in model development. This hands-on coding practice uses a manufactured solution—the passive advection of a scalar bubble—to test the accuracy of a numerical transport scheme . By implementing the scheme and systematically measuring its error against the known exact solution at different grid resolutions, you will learn how to compute convergence rates, an essential skill for validating and debugging numerical models.",
            "id": "4068897",
            "problem": "Consider a two-dimensional dry atmosphere domain represented by the rectangle $\\Omega = [0,L_x]\\times[0,L_z]$ with periodic lateral and vertical boundaries. In non-hydrostatic atmospheric modeling for Numerical Weather Prediction (NWP), the rising warm bubble test evaluates how well a model transports and evolves a localized potential temperature perturbation under prescribed dynamics. To isolate and assess discretization accuracy of scalar transport, use a manufactured test in which the perturbation is advected by a constant, divergence-free velocity field. This isolates the transport operator from buoyancy-induced accelerations while retaining scientific realism for verification purposes.\n\nStart from the scalar conservation law for potential temperature transport under given velocity:\n$$\n\\frac{\\partial \\theta}{\\partial t} + u\\frac{\\partial \\theta}{\\partial x} + w\\frac{\\partial \\theta}{\\partial z} = 0,\n$$\nwhere $\\theta$ is the potential temperature, $u$ is the horizontal velocity, and $w$ is the vertical velocity. Assume the initial condition is a warm Gaussian bubble superposed on a constant background:\n$$\n\\theta(x,z,0) = \\theta_b + A\\exp\\left(-\\frac{(x-x_0)^2 + (z-z_0)^2}{2R^2}\\right),\n$$\nwhere $\\theta_b$ is the background potential temperature, $A$ is the bubble amplitude, $(x_0,z_0)$ is the bubble center, and $R$ is the bubble radius. Under the prescribed constant velocities, the exact solution at time $t$ is the translation\n$$\n\\theta_{\\text{exact}}(x,z,t) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x,t)-x_0\\big)^2 + \\big(\\tilde{z}(z,t)-z_0\\big)^2}{2R^2}\\right),\n$$\nwith periodic shifts $\\tilde{x}(x,t) = (x - ut)\\bmod L_x$ and $\\tilde{z}(z,t) = (z - wt)\\bmod L_z$.\n\nDiscretize the scalar transport on a uniform grid with $N_x$ points in $x$ and $N_z$ points in $z$, using the MacCormack predictor-corrector method (second order in space and time for smooth solutions). Let $\\Delta x = L_x/N_x$, $\\Delta z = L_z/N_z$, and choose a time step $\\Delta t$ satisfying a Courant–Friedrichs–Lewy (CFL) condition:\n$$\n\\Delta t = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right),\n$$\nwith adjustments so that the final time is reached exactly. The MacCormack scheme on a periodic grid advances $\\theta^n$ to $\\theta^{n+1}$ via:\nPredictor:\n$$\n\\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right),\n$$\nCorrector:\n$$\n\\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right],\n$$\nwhere indices are wrapped periodically (i.e., $i+1$ maps to $0$ when $i=N_x-1$ and similarly in $z$).\n\nDefine scientifically meaningful error norms for a final comparison at time $T$ by spatially averaged integral norms over $\\Omega$ so that all have units of Kelvin:\n- The normalized $L^1$ norm:\n$$\n\\|e\\|_{L^1} = \\frac{1}{L_x L_z} \\int_\\Omega |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)| \\, dx\\, dz.\n$$\n- The normalized $L^2$ norm:\n$$\n\\|e\\|_{L^2} = \\sqrt{\\frac{1}{L_x L_z} \\int_\\Omega \\left(\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)\\right)^2 \\, dx\\, dz }.\n$$\n- The $L^\\infty$ norm:\n$$\n\\|e\\|_{L^\\infty} = \\max_{(x,z)\\in\\Omega} |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)|.\n$$\nApproximate these integrals by Riemann sums on the discrete grid using $\\Delta x\\Delta z$ as the cell area.\n\nCompute the observed order of accuracy $p$ using the normalized $L^2$ error at successive grid spacings $h_k = \\max(\\Delta x_k,\\Delta z_k)$:\n$$\np_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}.\n$$\n\nUse the following scientifically consistent parameters (units in the International System of Units; SI):\n- Domain sizes: $L_x = 1000\\,\\mathrm{m}$, $L_z = 1000\\,\\mathrm{m}$.\n- Constant velocities: $u = 5\\,\\mathrm{m/s}$, $w = 2\\,\\mathrm{m/s}$.\n- Bubble parameters: background $\\theta_b = 300\\,\\mathrm{K}$, amplitude $A = 1\\,\\mathrm{K}$, radius $R = 100\\,\\mathrm{m}$, center $(x_0,z_0)=(200\\,\\mathrm{m},200\\,\\mathrm{m})$.\n- Final time: $T = 100\\,\\mathrm{s}$.\n- Courant–Friedrichs–Lewy (CFL) number: $\\mathrm{CFL}=0.4$ (dimensionless).\n- Grids (test suite): case $1$ uses $(N_x,N_z)=(32,32)$, case $2$ uses $(64,64)$, case $3$ uses $(128,128)$, case $4$ uses $(256,256)$.\n\nTasks:\n1. Implement the MacCormack scheme with periodic boundaries for the scalar transport problem described above.\n2. For each grid in the test suite, compute the normalized $L^1$, normalized $L^2$, and $L^\\infty$ error norms between the numerical and exact solutions at time $T$.\n3. Using the normalized $L^2$ errors, compute the observed order of accuracy $p$ between successive grid resolutions $(32\\to64)$, $(64\\to128)$, and $(128\\to256)$.\n\nAnswer specifications:\n- Express all error norms in Kelvin, rounded to six decimal places.\n- Express observed orders of accuracy $p$ as dimensionless floats, rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order:\n$$\n[\\|e\\|_{L^2}(32), \\|e\\|_{L^2}(64), \\|e\\|_{L^2}(128), \\|e\\|_{L^2}(256), p_{32\\to64}, p_{64\\to128}, p_{128\\to256}]\n$$\nwhere each $\\|e\\|_{L^2}(N)$ is the normalized $L^2$ error for the grid with $N_x=N_z=N$. All errors are in $\\mathrm{K}$ and all $p$ values are dimensionless, each rounded to six decimal places.",
            "solution": "The problem is evaluated as scientifically sound, well-posed, objective, and self-contained. It describes a standard numerical verification test for a scalar advection equation, a fundamental problem in computational fluid dynamics and numerical weather prediction. All parameters, equations, and numerical methods are clearly and correctly defined. The problem is valid.\n\nThe solution proceeds as follows:\nFirst, we establish the physical and numerical parameters as specified in the problem statement.\nThe domain is $\\Omega = [0,L_x]\\times[0,L_z]$ with $L_x = 1000\\,\\mathrm{m}$ and $L_z = 1000\\,\\mathrm{m}$.\nThe constant velocity field is $(u, w) = (5\\,\\mathrm{m/s}, 2\\,\\mathrm{m/s})$.\nThe initial potential temperature perturbation is a Gaussian bubble defined by:\n- Background potential temperature $\\theta_b = 300\\,\\mathrm{K}$\n- Amplitude $A = 1\\,\\mathrm{K}$\n- Radius $R = 100\\,\\mathrm{m}$\n- Initial center $(x_0, z_0) = (200\\,\\mathrm{m}, 200\\,\\mathrm{m})$\n\nThe simulation runs until a final time $T = 100\\,\\mathrm{s}$. The numerical scheme is advanced using a time step $\\Delta t$ determined by a Courant–Friedrichs–Lewy (CFL) number of $\\mathrm{CFL}=0.4$.\n\nFor each test case with grid resolution $(N_x, N_z)$, we perform the following steps:\n\n1.  **Grid and Time Step Discretization**:\n    A uniform staggered grid is defined with $N_x$ points in the x-direction and $N_z$ points in the z-direction. The grid spacings are $\\Delta x = L_x/N_x$ and $\\Delta z = L_z/N_z$. The grid points are $(x_i, z_j) = (i\\Delta x, j\\Delta z)$ for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_z-1\\}$.\n    The time step $\\Delta t$ must satisfy the CFL condition and ensure the simulation reaches the final time $T$ exactly. First, a provisional time step is calculated:\n    $$\n    \\Delta t_{\\text{CFL}} = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right)\n    $$\n    The number of time steps, $N_t$, is then calculated as the smallest integer such that $N_t \\Delta t_{\\text{CFL}} \\ge T$:\n    $$\n    N_t = \\left\\lceil \\frac{T}{\\Delta t_{\\text{CFL}}} \\right\\rceil\n    $$\n    The final time step used for the simulation is then adjusted to be:\n    $$\n    \\Delta t = \\frac{T}{N_t}\n    $$\n\n2.  **Initial Condition**:\n    The continuous initial condition is discretized onto the grid, yielding the initial field $\\theta^0_{i,j}$:\n    $$\n    \\theta^0_{i,j} = \\theta(x_i, z_j, 0) = \\theta_b + A\\exp\\left(-\\frac{(x_i-x_0)^2 + (z_j-z_0)^2}{2R^2}\\right)\n    $$\n\n3.  **Time Integration with MacCormack Scheme**:\n    The solution is advanced from time $t=0$ to $t=T$ over $N_t$ steps. At each step $n$, from $\\theta^n$ to $\\theta^{n+1}$, the two-step MacCormack method is applied. Given the use of periodic boundary conditions, the spatial shifts required for finite differences can be efficiently implemented using a circular roll operation on the data arrays.\n\n    **Predictor step**: This step uses forward differences for the spatial derivatives.\n    $$\n    \\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right)\n    $$\n    The indices are handled periodically, e.g., for $i=N_x-1$, $i+1$ becomes $0$.\n\n    **Corrector step**: This step uses backward differences on the predicted field $\\hat{\\theta}$.\n    $$\n    \\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right]\n    $$\n    Again, indices are treated periodically. This two-step process yields the numerical solution $\\theta^{N_t}_{i,j}$ at the final time $T$.\n\n4.  **Exact Solution Calculation**:\n    At the final time $T$, the exact solution at each grid point $(x_i, z_j)$ is calculated using the provided formula, which accounts for periodic wrapping:\n    $$\n    \\theta_{\\text{exact}}(x_i,z_j,T) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x_i,T)-x_0\\big)^2 + \\big(\\tilde{z}(z_j,T)-z_0\\big)^2}{2R^2}\\right)\n    $$\n    where $\\tilde{x}(x_i,T) = (x_i - uT)\\bmod L_x$ and $\\tilde{z}(z_j,T) = (z_j - wT)\\bmod L_z$.\n\n5.  **Error Norm Calculation**:\n    The error field is the difference between the numerical and exact solutions: $e_{i,j} = \\theta^{N_t}_{i,j} - \\theta_{\\text{exact}}(x_i,z_j,T)$. The specified norms are approximated by discrete sums.\n    - Normalized $L^1$ norm:\n    $$\n    \\|e\\|_{L^1} \\approx \\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} |e_{i,j}|\n    $$\n    - Normalized $L^2$ norm:\n    $$\n    \\|e\\|_{L^2} \\approx \\sqrt{\\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} e_{i,j}^2}\n    $$\n    - $L^\\infty$ norm:\n    $$\n    \\|e\\|_{L^\\infty} \\approx \\max_{i,j} |e_{i,j}|\n    $$\n\n6.  **Observed Order of Accuracy**:\n    After computing the normalized $L^2$ error, $\\|e\\|_{L^2}(h_k)$, for two successive grid resolutions corresponding to characteristic grid spacings $h_k$ and $h_{k+1}$, the observed order of accuracy $p$ is calculated as:\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}\n    $$\n    Since the grid is refined by a factor of $2$ in each dimension, $N_{k+1}=2N_k$, which implies $h_{k+1}=h_k/2$. The denominator simplifies to $\\ln(h_k/h_{k+1}) = \\ln(2)$.\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k) / \\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(2)}\n    $$\n\nThis procedure is repeated for each grid resolution in the test suite: $(32,32)$, $(64,64)$, $(128,128)$, and $(256,256)$. The final output will consist of the four calculated $\\|e\\|_{L^2}$ norms and the three resulting observed orders of accuracy $p$. Given that the MacCormack scheme is second-order accurate for smooth solutions, the calculated values of $p$ are expected to be close to $2$.",
            "answer": "[0.007626,0.001886,0.000470,0.000117,2.015243,2.003923,2.000989]"
        }
    ]
}