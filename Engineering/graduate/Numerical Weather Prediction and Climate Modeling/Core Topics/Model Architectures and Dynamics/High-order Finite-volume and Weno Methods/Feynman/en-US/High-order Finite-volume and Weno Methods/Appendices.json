{
    "hands_on_practices": [
        {
            "introduction": "Before tackling the evolution of fluid dynamics, it is essential to master the fundamental spatial operation of transferring data between computational grids. This exercise focuses on the core principles of conservative remapping, a critical task in model coupling and data assimilation, where a scalar quantity must be transferred from a source grid to a target grid without altering its global integral. By employing a high-order reconstruction of the data and integrating it over grid cell overlaps, you will rigorously prove the conservation properties that are definitional to the finite-volume method. ",
            "id": "4051136",
            "problem": "Consider a one-dimensional periodic domain of length $L$ that supports an advected scalar tracer field $u(x)$ used in numerical weather prediction and climate modeling. Two uniform finite-volume grids are defined on the domain:\n\n- A source grid with $N$ cells of width $\\Delta x = L/N$, cell centers $x_i = (i+\\frac{1}{2})\\Delta x$, and cell edges $x_{i-\\frac{1}{2}} = i\\Delta x$, $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$, for $i = 0, 1, \\dots, N-1$. The corresponding source cell average is\n$$\n\\bar{u}_i = \\frac{1}{\\Delta x}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}}u(x)\\,dx.\n$$\n\n- A target grid with $M$ cells of width $\\Delta x' = L/M$, cell edges $y_{j-\\frac{1}{2}} = j\\Delta x' + \\delta$ and $y_{j+\\frac{1}{2}} = (j+1)\\Delta x' + \\delta$ (with periodic identification modulo $L$), for $j = 0, 1, \\dots, M-1$. The target cell average is\n$$\n\\bar{u}'_j = \\frac{1}{\\Delta x'}\\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}}u(x)\\,dx.\n$$\nHere $\\delta \\in [0,\\Delta x')$ is a fixed offset defining the relative alignment between the two grids.\n\nYour tasks are:\n\n$1.$ Construct a conservative remapping that maps $\\bar{u}_i$ on the source grid to $\\bar{u}'_j$ on the target grid. To do so, define for each source cell $I_i = [x_{i-\\frac{1}{2}},x_{i+\\frac{1}{2}}]$ a cellwise reconstruction $p_i(x)$ that is at least second-order accurate in smooth regions and non-oscillatory, using the principle of Weighted Essentially Non-Oscillatory (WENO) reconstruction. The remapped target average should be computed by exact integration of $p_i(x)$ over the overlap $I_i \\cap I'_j$, where $I'_j = [y_{j-\\frac{1}{2}},y_{j+\\frac{1}{2}}]$ denotes the target cell. Write $\\bar{u}'_j$ explicitly in terms of $\\bar{u}_i$, $\\Delta x$, $\\Delta x'$, the overlap geometry, and the reconstruction $p_i(x)$.\n\n$2.$ Starting from the finite-volume definition of cell averages and the fundamental conservation principle that the global integral of $u(x)$ must be preserved by any conservative remapping, derive conditions under which the global integral\n$$\n\\int_0^L u(x)\\,dx\n$$\ncomputed from the target-grid averages $\\bar{u}'_j$ is exactly equal to that computed from the source-grid averages $\\bar{u}_i$. Your derivation must begin from first principles: the finite-volume definition of cell averages, the exact integral of the reconstruction over each source cell, and the measure-theoretic partition of each source cell into overlaps with the target cells. Clearly state and justify any assumptions (such as periodic boundary conditions and exact quadrature for the chosen reconstruction).\n\n$3.$ Express the exact preserved global integral after remapping as a single closed-form analytic expression in terms of the source-grid cell averages $\\bar{u}_i$ and the source-grid cell width $\\Delta x$. No numerical values are provided; you must not perform any numerical substitution. No rounding is required. No physical units are required in your final expression.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It describes a standard and non-trivial task in numerical methods for physics-based modeling, specifically conservative remapping between different grids. The definitions and constraints are consistent and sufficient to derive a solution. Therefore, the problem is valid. We proceed with the solution, addressing each task in order.\n\nThe domain is a one-dimensional periodic interval of length $L$. The source grid consists of $N$ cells $I_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ of uniform width $\\Delta x = L/N$ for $i = 0, 1, \\dots, N-1$. The source cell averages are denoted by $\\bar{u}_i$. The target grid consists of $M$ cells $I'_j = [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$ of uniform width $\\Delta x' = L/M$ for $j = 0, 1, \\dots, M-1$, with a relative offset $\\delta$.\n\n1. Construction of the Conservative Remapping\n\nThe goal of conservative remapping is to compute the target cell averages $\\bar{u}'_j$ from the source cell averages $\\bar{u}_i$ while preserving the total quantity of the scalar field $u(x)$. The process involves two steps: reconstruction and integration.\n\nFirst, for each source cell $I_i$, we construct a polynomial approximation $p_i(x)$ of the true field $u(x)$ within that cell. This reconstruction $p_i(x)$ is built using the known source cell averages $\\{\\bar{u}_k\\}$ from a stencil of cells surrounding cell $I_i$. The problem specifies that this reconstruction must be at least second-order accurate and non-oscillatory, consistent with the Weighted Essentially Non-Oscillatory (WENO) methodology. A fundamental property of any such finite-volume reconstruction is that it must preserve the cell average in its own cell, meaning:\n$$\n\\frac{1}{\\Delta x} \\int_{I_i} p_i(x) \\,dx = \\bar{u}_i\n$$\nThe global reconstruction is a piecewise polynomial function $p(x)$ defined as $p(x) = p_i(x)$ for $x \\in I_i$.\n\nSecond, the target cell average $\\bar{u}'_j$ is obtained by integrating this piecewise reconstruction $p(x)$ over the target cell $I'_j = [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$ and dividing by the target cell width $\\Delta x'$.\n$$\n\\bar{u}'_j = \\frac{1}{\\Delta x'} \\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}} p(x) \\,dx\n$$\nSince $p(x)$ is defined piecewise on the source cells $I_i$, the integral over $I'_j$ must be broken down into a sum of integrals over the overlap regions between the target cell $I'_j$ and the various source cells $I_i$. Let the overlap between source cell $i$ and target cell $j$ be denoted by $O_{ij} = I_i \\cap I'_j$. The integral becomes:\n$$\n\\int_{I'_j} p(x) \\,dx = \\sum_{i=0}^{N-1} \\int_{I_i \\cap I'_j} p(x) \\,dx = \\sum_{i=0}^{N-1} \\int_{O_{ij}} p_i(x) \\,dx\n$$\nIn the last step, within the overlap interval $O_{ij}$, the global reconstruction $p(x)$ is identical to the local reconstruction $p_i(x)$. The summation is implicitly taken over all source cells $i$ for which the overlap $O_{ij}$ has a non-zero measure. The geometry of the overlap is given by $O_{ij} = [\\max(x_{i-\\frac{1}{2}}, y_{j-\\frac{1}{2}}), \\min(x_{i+\\frac{1}{2}}, y_{j+\\frac{1}{2}})]$.\n\nSubstituting this back into the formula for $\\bar{u}'_j$, we obtain the explicit expression for the remapped target average:\n$$\n\\bar{u}'_j = \\frac{1}{\\Delta x'} \\sum_{i=0}^{N-1} \\int_{\\max(x_{i-\\frac{1}{2}}, y_{j-\\frac{1}{2}})}^{\\min(x_{i+\\frac{1}{2}}, y_{j+\\frac{1}{2}})} p_i(x) \\,dx\n$$\nThis formula expresses $\\bar{u}'_j$ in terms of the source cell averages $\\bar{u}_i$ (which are used to construct $p_i(x)$), the grid parameters $\\Delta x$ and $\\Delta x'$ (which define the cell boundaries), the overlap geometry (defined by the integral limits), and the reconstruction polynomial $p_i(x)$ itself.\n\n2. Derivation of the Global Conservation Condition\n\nThe fundamental principle of conservation requires that the total amount of the scalar $u(x)$ over the entire domain is preserved during the remapping process. We must show that the global integral computed from the target-grid averages is exactly equal to that computed from the source-grid averages.\n\nThe global integral computed from the source-grid data is:\n$$\nU_S = \\sum_{i=0}^{N-1} \\bar{u}_i \\Delta x\n$$\nBy definition of the cell average, $\\bar{u}_i \\Delta x = \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x) \\,dx$. Therefore,\n$$\nU_S = \\sum_{i=0}^{N-1} \\int_{I_i} u(x) \\,dx = \\int_0^L u(x) \\,dx\n$$\nThis represents the exact total quantity on the domain.\n\nThe global integral computed from the target-grid data after remapping is:\n$$\nU_T = \\sum_{j=0}^{M-1} \\bar{u}'_j \\Delta x'\n$$\nTo verify conservation, we must show that $U_T = U_S$. We begin by substituting the expression for $\\bar{u}'_j$ derived in the first task:\n$$\nU_T = \\sum_{j=0}^{M-1} \\Delta x' \\left( \\frac{1}{\\Delta x'} \\sum_{i=0}^{N-1} \\int_{O_{ij}} p_i(x) \\,dx \\right) = \\sum_{j=0}^{M-1} \\sum_{i=0}^{N-1} \\int_{O_{ij}} p_i(x) \\,dx\n$$\nSince the sums are over finite sets of indices, we can legally exchange the order of summation:\n$$\nU_T = \\sum_{i=0}^{N-1} \\sum_{j=0}^{M-1} \\int_{O_{ij}} p_i(x) \\,dx\n$$\nNow, consider the inner summation over the target cell index $j$ for a fixed source cell $i$: $\\sum_{j=0}^{M-1} \\int_{O_{ij}} p_i(x) \\,dx$. The collection of target cells $\\{I'_j\\}_{j=0}^{M-1}$ forms a partition of the entire periodic domain $[0, L]$. Therefore, the collection of overlap intervals $\\{O_{ij}\\}_{j=0}^{M-1} = \\{I_i \\cap I'_j\\}_{j=0}^{M-1}$ constitutes a partition of the source cell $I_i$. Due to the additivity of the integral, the sum of integrals over the subintervals is equal to the integral over the entire interval:\n$$\n\\sum_{j=0}^{M-1} \\int_{O_{ij}} p_i(x) \\,dx = \\int_{\\bigcup_{j=0}^{M-1} O_{ij}} p_i(x) \\,dx = \\int_{I_i} p_i(x) \\,dx\n$$\nSubstituting this result back into the expression for $U_T$:\n$$\nU_T = \\sum_{i=0}^{N-1} \\int_{I_i} p_i(x) \\,dx\n$$\nThe condition for exact global conservation is $U_T = U_S$, which now becomes:\n$$\n\\sum_{i=0}^{N-1} \\int_{I_i} p_i(x) \\,dx = \\sum_{i=0}^{N-1} \\bar{u}_i \\Delta x\n$$\nThis equality is guaranteed to hold if each term in the sum is equal, which means for each source cell $i$:\n$$\n\\int_{I_i} p_i(x) \\,dx = \\bar{u}_i \\Delta x \\quad \\iff \\quad \\frac{1}{\\Delta x} \\int_{I_i} p_i(x) \\,dx = \\bar{u}_i\n$$\nThis is precisely the conservation property of the reconstruction polynomial $p_i(x)$, which states that the average of the reconstruction over a cell must equal the original cell average. This is a definitional requirement for any reconstruction used in a finite-volume scheme, including WENO methods.\n\nTherefore, the conditions for the global integral to be exactly preserved are:\n1.  The reconstruction $p_i(x)$ for each source cell $I_i$ must be conservative, i.e., its integral mean over $I_i$ must be equal to $\\bar{u}_i$. This is a standard property of finite-volume reconstructions.\n2.  The integrals of the reconstruction polynomials $p_i(x)$ over the overlap regions $O_{ij}$ must be computed exactly. Since WENO reconstructions yield polynomials, this is analytically feasible and is considered an \"exact quadrature\" as mentioned in the problem.\n3.  The grids must form a valid partition of the domain, which is given by the problem definition.\n\nUnder these conditions, which are standard for conservative remapping schemes, the global integral is exactly preserved by construction.\n\n3. Expression for the Preserved Global Integral\n\nFrom the derivation in the second task, we established that if the remapping is conservative, the global integral computed on the target grid, $U_T = \\sum_{j=0}^{M-1} \\bar{u}'_j \\Delta x'$, is exactly equal to the global integral computed on the source grid, $U_S = \\sum_{i=0}^{N-1} \\bar{u}_i \\Delta x$.\n\nThe problem asks for the exact preserved global integral after remapping, expressed as a single closed-form analytic expression in terms of the source-grid cell averages $\\bar{u}_i$ and the source-grid cell width $\\Delta x$. This is precisely the quantity $U_S$. Therefore, the preserved global integral is given by the sum of the scalar quantities in each source cell.",
            "answer": "$$\n\\boxed{\\sum_{i=0}^{N-1} \\bar{u}_i \\Delta x}\n$$"
        },
        {
            "introduction": "Having explored spatial conservation, we now turn to the dynamic evolution of compressible flows governed by the Euler equations. The heart of any modern high-order finite-volume method is the numerical flux, which approximates the solution to the Riemann problem at each cell interface. This practice challenges you to derive and implement two foundational approximate Riemann solvers, the Harten-Lax-van Leer (HLL) and the more refined Harten-Lax-van Leer Contact (HLLC) schemes, and to quantitatively assess their ability to resolve critical wave structures like shocks and contact discontinuities. ",
            "id": "4051161",
            "problem": "Consider one-dimensional compressible atmospheric flow governed by the conservation form of the Euler equations (neglecting viscosity and Coriolis force) with an ideal-gas closure and a gravitational source that is handled separately from the intercell flux. Let the conserved vector be $U = [\\rho, \\rho u, E]^\\top$, where $\\rho$ is mass density in $\\mathrm{kg/m^3}$, $u$ is velocity in $\\mathrm{m/s}$, and $E$ is total energy density in $\\mathrm{J/m^3}$. Let the flux be $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]^\\top$ with pressure $p$ related to the conserved variables by $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$ under an ideal-gas equation of state with ratio of specific heats $\\gamma$. In high-order finite-volume methods with Weighted Essentially Non-Oscillatory (WENO) reconstruction, the reconstructed left and right states at a cell interface define a local Riemann problem whose numerical flux determines the interface contribution. Two widely used approximate Riemann solvers are the Harten-Lax-van Leer (HLL) and the Harten-Lax-van Leer Contact (HLLC) fluxes.\n\nYour task is to derive the HLL and HLLC intercell numerical fluxes starting from the Rankine–Hugoniot jump conditions and the self-similar structure of solutions to the Riemann problem for the Euler equations, and then to implement both fluxes. The derivation must begin from the conservation form of the Euler equations and use wave-speed estimates that are consistent with physically admissible states. You must then quantify their ability to resolve contact discontinuities and shocks in stratified atmospheric configurations by comparing each solver’s predicted interface mass flux against the interface mass flux from the exact Riemann solution at the self-similar coordinate $x/t = 0$.\n\nUse the following definitions and constraints:\n- The base equations are the compressible Euler equations for an ideal gas with gravitational force, but the gravitational source term is treated by a separate operator splitting and does not enter the intercell flux derivation. Thus, for the flux derivation and comparisons, only the homogeneous Euler equations are used.\n- The ratio of specific heats is constant and given by $\\gamma = 1.4$.\n- The speed of sound is $a = \\sqrt{\\gamma p / \\rho}$.\n\nStarting from these fundamentals, derive:\n- The Harten-Lax-van Leer (HLL) flux by assuming two waves with speeds $S_L$ and $S_R$ bounding a single constant intermediate state, enforcing the Rankine–Hugoniot jump conditions across each wave, and solving for the intercell flux $F_{\\mathrm{HLL}}$.\n- The Harten-Lax-van Leer Contact (HLLC) flux by extending the HLL structure to include the contact wave with speed $S_M$ and enforcing consistent pressure and normal velocity across the contact to obtain the intermediate “star” states and flux $F_{\\mathrm{HLLC}}$.\n\nThen implement a program that:\n1. For each test case, constructs left and right primitive states $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$ in International System of Units (SI) and converts them to conserved variables.\n2. Computes the HLL flux and the HLLC flux at the interface using Davis-type signal-speed estimates $S_L = \\min(u_L - a_L, u_R - a_R)$ and $S_R = \\max(u_L + a_L, u_R + a_R)$, where $a_L$ and $a_R$ are the speeds of sound for the left and right states.\n3. Computes the exact Riemann solution for the Euler equations at $x/t = 0$ using the ideal-gas law and the standard shock/rarefaction relations to obtain the intermediate pressure $p^\\star$, velocity $u^\\star$, and left/right star densities $\\rho_L^\\star$ and $\\rho_R^\\star$. Take the exact interface mass flux to be $f_{\\mathrm{exact}} = \\rho^\\star u^\\star$ with $\\rho^\\star = \\rho_L^\\star$ if $u^\\star > 0$ and $\\rho^\\star = \\rho_R^\\star$ if $u^\\star  0$. If $u^\\star = 0$, take $\\rho^\\star = (\\rho_L^\\star + \\rho_R^\\star)/2$.\n4. For each solver (HLL and HLLC), reports the absolute error in interface mass flux (first component of the flux vector) compared to the exact interface mass flux, namely $|f_{\\mathrm{solver}} - f_{\\mathrm{exact}}|$.\n\nUse the following test suite of three atmospheric Riemann problems designed to probe contact and shock resolution under variable stratification. All inputs are in SI units:\n- Case $1$ (advected contact in a stratified atmosphere): $\\rho_L = 1.2$, $u_L = 50.0$, $p_L = 100000.0$; $\\rho_R = 0.6$, $u_R = 50.0$, $p_R = 100000.0$.\n- Case $2$ (classical shock tube with strong shock): $\\rho_L = 1.0$, $u_L = 0.0$, $p_L = 100000.0$; $\\rho_R = 0.125$, $u_R = 0.0$, $p_R = 10000.0$.\n- Case $3$ (sea-level to upper-atmosphere rarefaction): $\\rho_L = 1.0$, $u_L = 0.0$, $p_L = 100000.0$; $\\rho_R = 0.02$, $u_R = 0.0$, $p_R = 2000.0$.\n\nFor this problem, velocity must be in $\\mathrm{m/s}$, density in $\\mathrm{kg/m^3}$, and pressure in $\\mathrm{Pa}$. The program must compute the absolute error in interface mass flux for both HLL and HLLC for each case. The final program output must be a single line containing a flat list of six floating-point numbers corresponding to:\n$[e_{\\mathrm{HLL},1}, e_{\\mathrm{HLLC},1}, e_{\\mathrm{HLL},2}, e_{\\mathrm{HLLC},2}, e_{\\mathrm{HLL},3}, e_{\\mathrm{HLLC},3}]$,\nwhere $e_{\\mathrm{HLL},i}$ and $e_{\\mathrm{HLLC},i}$ are the absolute mass-flux errors for case $i$ computed as described above. Express the floating-point numbers in standard decimal notation. The program must be entirely self-contained, take no input, and produce exactly one line as specified.",
            "solution": "The problem requires the derivation and implementation of the Harten-Lax-van Leer (HLL) and Harten-Lax-van Leer Contact (HLLC) approximate Riemann solvers for the one-dimensional compressible Euler equations. Subsequently, these solvers are to be evaluated against an exact Riemann solver for three specific test cases by comparing the computed interface mass flux.\n\nThe one-dimensional Euler equations in conservation form are given by:\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\nwhere $U$ is the vector of conserved variables and $F(U)$ is the flux vector:\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad F(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{pmatrix}\n$$\nHere, $\\rho$ is the mass density, $u$ is the velocity, and $E$ is the total energy density. The system is closed with the ideal gas equation of state, which relates pressure $p$ to the conserved variables:\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\nwhere $\\gamma$ is the ratio of specific heats, given as $\\gamma = 1.4$.\n\nThe numerical solution of these equations via a finite-volume method involves computing the numerical flux $F_{i+1/2}$ at the interface between two cells, $i$ and $i+1$. This is accomplished by solving a Riemann problem with initial states $U_L = U_i$ and $U_R = U_{i+1}$.\n\n**1. Harten-Lax-van Leer (HLL) Flux Derivation**\n\nThe HLL solver is based on a two-wave approximation of the Riemann problem solution. It assumes that the initial states $U_L$ and $U_R$ are separated by a central, constant state $U_{HLL}$, bounded by the fastest left-going wave with speed $S_L$ and the fastest right-going wave with speed $S_R$.\n\nApplying the integral form of the conservation law, $\\oint (U dx - F dt) = 0$, over a control volume in the $x-t$ plane defined by the lines $x=S_L t$, $x=S_R t$, $t=0$, and $t=T$, we get:\n$$\n\\int_{S_L T}^{S_R T} U(x,T) dx - \\int_{-\\infty}^{\\infty} U(x,0) dx_{relevant} = \\int_0^T (F(U_L) - F(U_R)) dt\n$$\nConsidering the piecewise constant initial condition and the assumed constant state $U_{HLL}$ between the waves, the equation for a time interval $\\Delta t$ becomes:\n$$\n(S_R \\Delta t - S_L \\Delta t) U_{HLL} - (S_R \\Delta t U_R - S_L \\Delta t U_L) = (F_L - F_R) \\Delta t\n$$\nSolving for the intermediate state $U_{HLL}$ yields:\n$$\nU_{HLL} = \\frac{S_R U_R - S_L U_L - (F_R - F_L)}{S_R - S_L}\n$$\nThe HLL numerical flux $F_{HLL}$ at the interface ($x/t=0$) is determined by the state prevalent at that location. The Rankine-Hugoniot conditions must be satisfied across the waves $S_L$ and $S_R$. The flux across a line of slope $1/S$ is $F - SU$. To ensure consistency, the interface flux must be such that it satisfies the jump conditions. This leads to a single expression for the HLL flux, which can be derived by considering the case $S_L \\le 0 \\le S_R$, where the interface resides within the averaged state region. The flux $F_{HLL}$ must satisfy $F_{HLL} - F_L = S_L (U_{HLL} - U_L)$ and $F_{HLL} - F_R = S_R (U_{HLL} - U_R)$. Solving either for $F_{HLL}$ and substituting the expression for $U_{HLL}$ gives:\n$$\nF_{HLL} = \\frac{S_R F_L - S_L F_R + S_L S_R (U_R - U_L)}{S_R - S_L}\n$$\nThis formula correctly reduces to $F_L$ if $S_L > 0$ and $F_R$ if $S_R  0$, thereby covering all cases. The wave speeds $S_L$ and $S_R$ are estimated using the Davis formulation:\n$$\nS_L = \\min(u_L - a_L, u_R - a_R), \\quad S_R = \\max(u_L + a_L, u_R + a_R)\n$$\nwhere $a_K = \\sqrt{\\gamma p_K / \\rho_K}$ for $K \\in \\{L, R\\}$.\n\n**2. Harten-Lax-van Leer Contact (HLLC) Flux Derivation**\n\nThe HLLC solver refines the HLL model by reintroducing the contact discontinuity, which HLL averages out. The wave structure is assumed to be composed of three waves: a leftmost wave ($S_L$), a contact wave ($S_M$), and a rightmost wave ($S_R$). This partitions the solution into four constant states: $U_L$, $U_L^*$, $U_R^*$, and $U_R$.\n\nAcross the contact wave, pressure and velocity are continuous: $p_L^* = p_R^* = p^*$ and $u_L^* = u_R^* = u^* = S_M$. The star states $U_K^*$ ($K \\in \\{L, R\\}$) are related to the outer states $U_K$ by the jump conditions across $S_L$ and $S_R$.\n$$\nF_K^* - F_K = S_K(U_K^* - U_K) \\implies S_K U_K^* - F_K^* = S_K U_K - F_K\n$$\nWriting this equation in components and using $u^* = S_M$ allows us to solve for the properties of the star states. The density in the star region is found to be:\n$$\n\\rho_K^* = \\rho_K \\frac{S_K - u_K}{S_K - S_M}\n$$\nThe pressure in the star region $p^*$ is derived from the momentum equation jump condition, which gives two expressions that must be equal:\n$$\np^* = p_L + \\rho_L(u_L - S_L)(u_L - S_M) = p_R + \\rho_R(u_R - S_R)(u_R - S_M)\n$$\nThis equality is solved for the contact wave speed $S_M$:\n$$\nS_M = \\frac{p_R - p_L + \\rho_L u_L(S_L - u_L) - \\rho_R u_R(S_R - u_R)}{\\rho_L(S_L - u_L) - \\rho_R(S_R - u_R)}\n$$\nWith $S_M$ known, $p^*$ can be calculated, and the star state densities $\\rho_L^*$ and $\\rho_R^*$ are determined. The star state energy densities are $E_K^* = \\frac{p^*}{\\gamma-1} + \\frac{1}{2}\\rho_K^*(S_M)^2$. This fully defines the states $U_L^*$ and $U_R^*$.\n\nThe HLLC flux at the interface is then selected based on its position relative to the waves:\n$$\nF_{HLLC} =\n\\begin{cases}\n    F_L  \\text{if } S_L > 0 \\\\\n    F_L^* = F_L + S_L(U_L^* - U_L)  \\text{if } S_L \\le 0  S_M \\\\\n    F_R^* = F_R + S_R(U_R^* - U_R)  \\text{if } S_M \\le 0 \\le S_R \\\\\n    F_R  \\text{if } S_R  0\n\\end{cases}\n$$\n\n**3. Exact Riemann Solver**\n\nThe exact solution of the Riemann problem for the Euler equations is used as the reference. Its structure is similar to the HLLC model, but the outer waves can be either shocks or smooth rarefaction fans. The core of the method is to find the pressure $p^*$ and velocity $u^*$ in the star region. These are found by solving the nonlinear algebraic equation $g(p) = 0$, where:\n$$\ng(p) = f_L(p) + f_R(p) + u_L - u_R\n$$\nThe functions $f_K(p)$ depend on whether the wave is a shock ($p > p_K$) or a rarefaction ($p \\le p_K$):\n- Shock: $f_K(p) = (p - p_K) \\sqrt{\\frac{A_K}{p + B_K}}$ with $A_K = \\frac{2}{(\\gamma+1)\\rho_K}$ and $B_K = \\frac{\\gamma-1}{\\gamma+1}p_K$.\n- Rarefaction: $f_K(p) = \\frac{2 a_K}{\\gamma - 1} \\left[ \\left(\\frac{p}{p_K}\\right)^{\\frac{\\gamma-1}{2\\gamma}} - 1 \\right]$.\n\nThis equation is solved for $p^*$ using a numerical root-finding algorithm. Once $p^*$ is found, $u^*$ is calculated as $u^* = \\frac{1}{2}(u_L + u_R) + \\frac{1}{2}(f_R(p^*) - f_L(p^*))$. The state at the interface $x/t=0$ is determined by the sign of $u^*$:\n- If $u^* > 0$, the state is $U_L^*$.\n- If $u^*  0$, the state is $U_R^*$.\n- If $u^* = 0$, the contact discontinuity is stationary at the interface.\n\nThe densities $\\rho_L^*$ and $\\rho_R^*$ are calculated based on $p^*$ and the wave type (isentropic relations for rarefactions, Rankine-Hugoniot relations for shocks). The exact interface mass flux is $f_{\\mathrm{exact}} = \\rho^* u^*$, where $\\rho^* = \\rho_L^*$ if $u^* > 0$ and $\\rho^* = \\rho_R^*$ if $u^*  0$. If $u^*=0$, the mass flux is $0$.\n\n**4. Implementation and Comparison**\n\nThe program implements these three solvers (HLL, HLLC, Exact) for the provided test cases. For each case, it computes the mass flux component of $F_{HLL}$, $F_{HLLC}$, and the exact flux $f_{\\mathrm{exact}}$. The absolute error $|f_{\\mathrm{solver}} - f_{\\mathrm{exact}}|$ is then calculated for both HLL and HLLC solvers. The test cases are designed to highlight the different capabilities of the solvers: Case 1 is an isolated contact discontinuity, for which HLLC should be exact while HLL is diffusive. Case 2 is a classic shock tube problem, testing shock and contact resolution. Case 3 involves two rarefaction waves, testing behavior in situations with large pressure and density gradients but no shocks.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It computes the HLL and HLLC flux errors against an exact Riemann solver.\n    \"\"\"\n    gamma = 1.4\n\n    test_cases = [\n        # Case 1: Advected contact\n        # rho_L, u_L, p_L, rho_R, u_R, p_R\n        (1.2, 50.0, 100000.0, 0.6, 50.0, 100000.0),\n        # Case 2: Sod shock tube\n        (1.0, 0.0, 100000.0, 0.125, 0.0, 10000.0),\n        # Case 3: Two-rarefaction problem\n        (1.0, 0.0, 100000.0, 0.02, 0.0, 2000.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        e_hll, e_hllc = compute_flux_errors(case, gamma)\n        results.extend([e_hll, e_hllc])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef prim_to_cons(rho, u, p, gamma):\n    \"\"\"Converts primitive variables to conserved variables.\"\"\"\n    E = p / (gamma - 1.0) + 0.5 * rho * u**2\n    return np.array([rho, rho * u, E])\n\ndef get_flux(rho, u, p, E):\n    \"\"\"Computes the flux vector from primitive and conserved variables.\"\"\"\n    return np.array([rho * u, rho * u**2 + p, u * (E + p)])\n\ndef compute_flux_errors(case, gamma):\n    \"\"\"\n    Computes absolute mass flux errors for HLL and HLLC solvers for a single case.\n    \"\"\"\n    rho_L, u_L, p_L, rho_R, u_R, p_R = case\n\n    # --- Exact Solver ---\n    exact_mass_flux = calc_exact_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma)\n\n    # --- Approximate Solvers ---\n    # Derived quantities and initial state vectors\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n    \n    U_L = prim_to_cons(rho_L, u_L, p_L, gamma)\n    U_R = prim_to_cons(rho_R, u_R, p_R, gamma)\n    \n    F_L = get_flux(rho_L, u_L, p_L, U_L[2])\n    F_R = get_flux(rho_R, u_R, p_R, U_R[2])\n\n    # Davis wave speed estimates\n    S_L = min(u_L - a_L, u_R - a_R)\n    S_R = max(u_L + a_L, u_R + a_R)\n    \n    # --- HLL Flux ---\n    if S_L > 0:\n        F_HLL = F_L\n    elif S_R  0:\n        F_HLL = F_R\n    else:\n        F_HLL = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n    hll_mass_flux = F_HLL[0]\n\n    # --- HLLC Flux ---\n    # Calculate contact wave speed S_M\n    num = p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R)\n    den = rho_L * (S_L - u_L) - rho_R * (S_R - u_R)\n    S_M = num / den\n\n    if S_L > 0:\n        F_HLLC = F_L\n    elif S_R  0:\n        F_HLLC = F_R\n    else:\n        if S_M >= 0:\n            p_star = p_L + rho_L * (u_L - S_L) * (u_L - S_M)\n            rho_star_L = rho_L * (S_L - u_L) / (S_L - S_M)\n            E_star_L = p_star / (gamma - 1.0) + 0.5 * rho_star_L * S_M**2\n            U_star_L = np.array([rho_star_L, rho_star_L * S_M, E_star_L])\n            F_HLLC = F_L + S_L * (U_star_L - U_L)\n        else: # S_M  0\n            p_star = p_R + rho_R * (u_R - S_R) * (u_R - S_M)\n            rho_star_R = rho_R * (S_R - u_R) / (S_R - S_M)\n            E_star_R = p_star / (gamma - 1.0) + 0.5 * rho_star_R * S_M**2\n            U_star_R = np.array([rho_star_R, rho_star_R * S_M, E_star_R])\n            F_HLLC = F_R + S_R * (U_star_R - U_R)\n    hllc_mass_flux = F_HLLC[0]\n\n    # Calculate absolute errors\n    e_hll = abs(hll_mass_flux - exact_mass_flux)\n    e_hllc = abs(hllc_mass_flux - exact_mass_flux)\n\n    return e_hll, e_hllc\n\ndef calc_exact_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma):\n    \"\"\"\n    Computes the exact mass flux at the interface x/t=0 for the Euler equations.\n    \"\"\"\n    \n    def pressure_func(p_star, rho_K, p_K, a_K):\n        \"\"\"Pressure function for a single state (left or right).\"\"\"\n        if p_star > p_K:  # Shock\n            A_K = 2.0 / ((gamma + 1.0) * rho_K)\n            B_K = p_K * (gamma - 1.0) / (gamma + 1.0)\n            return (p_star - p_K) * np.sqrt(A_K / (p_star + B_K))\n        else:  # Rarefaction\n            return (2.0 * a_K / (gamma - 1.0)) * ((p_star / p_K)**((gamma - 1.0) / (2.0 * gamma)) - 1.0)\n\n    def root_func(p_star):\n        \"\"\"Function whose root is the star pressure.\"\"\"\n        a_L = np.sqrt(gamma * p_L / rho_L)\n        a_R = np.sqrt(gamma * p_R / rho_R)\n        f_L = pressure_func(p_star, rho_L, p_L, a_L)\n        f_R = pressure_func(p_star, rho_R, p_R, a_R)\n        return f_L + f_R + u_L - u_R\n\n    # Solve for p_star using a bracketing root-finder\n    p_min = 1e-6\n    p_max = max(p_L, p_R) * 10 if max(p_L, p_R) > 1 else max(p_L,p_R)*100\n    if root_func(p_min)*root_func(p_max) > 0: # find better bracket\n         p_max = p_max*100\n         \n    p_star = brentq(root_func, p_min, p_max)\n    \n    # Calculate u_star\n    a_L = np.sqrt(gamma * p_L / rho_L)\n    a_R = np.sqrt(gamma * p_R / rho_R)\n    f_L = pressure_func(p_star, rho_L, p_L, a_L)\n    f_R = pressure_func(p_star, rho_R, p_R, a_R)\n    u_star = 0.5 * (u_L + u_R) + 0.5 * (f_R - f_L)\n\n    if u_star == 0.0:\n        return 0.0\n\n    if u_star > 0.0:\n        # State at interface is from left state\n        if p_star > p_L:  # Shock\n            rho_star = rho_L * ((p_star / p_L + (gamma - 1.0) / (gamma + 1.0)) /\n                                (((gamma - 1.0) / (gamma + 1.0)) * (p_star / p_L) + 1.0))\n        else:  # Rarefaction\n            rho_star = rho_L * (p_star / p_L)**(1.0 / gamma)\n    else:  # u_star  0.0\n        # State at interface is from right state\n        if p_star > p_R:  # Shock\n            rho_star = rho_R * ((p_star / p_R + (gamma - 1.0) / (gamma + 1.0)) /\n                                (((gamma - 1.0) / (gamma + 1.0)) * (p_star / p_R) + 1.0))\n        else:  # Rarefaction\n            rho_star = rho_R * (p_star / p_R)**(1.0 / gamma)\n            \n    return rho_star * u_star\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "High-order accuracy does not automatically guarantee a scheme's suitability for simulating large-scale geophysical phenomena, where delicate physical balances must be preserved. This practice delves into the crucial concept of geostrophic balance and investigates how the inherent discretization error of a high-order scheme can excite spurious, unbalanced gravity waves. Using the powerful tool of modified wavenumber analysis, you will derive a quantitative criterion that links the scheme's leading-order error to the generation of numerical noise, a vital consideration for developing robust numerical weather prediction and climate models. ",
            "id": "4051143",
            "problem": "Consider the one-dimensional rotating shallow-water equations on an $f$-plane, linearized about a state of rest with mean depth $H$:\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x}, \\quad \\frac{\\partial v}{\\partial t} + f u = 0, \\quad \\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0,\n$$\nwhere $u$ and $v$ are the velocity components in the $x$ and $y$ directions, respectively, $\\eta$ is the free-surface displacement, $f$ is the Coriolis parameter, and $g$ is the gravitational acceleration. Let $c = \\sqrt{g H}$ denote the external gravity wave speed. The continuous geostrophic balance for a stationary solution satisfies $u = 0$ and $- f v = - g \\frac{\\partial \\eta}{\\partial x}$.\n\nA high-order finite-volume scheme with Weighted Essentially Non-Oscillatory (WENO) reconstruction of formal order $q \\geq 3$ is used to approximate fluxes. In smooth regions, the semi-discrete spatial derivative operator acting on a Fourier mode with wavenumber $k$ can be characterized by a modified wavenumber expansion\n$$\n\\widehat{D}(k) = i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) + \\mathcal{O}\\!\\left( (k \\Delta x)^{q+2} \\right),\n$$\nwhere $\\Delta x$ is the grid spacing and $\\beta_{q}$ is a real scheme-dependent constant determined by the linearized reconstruction and flux discretization. Assume time integration preserves the leading-order spatial balance error (for example, by using a third-order Strong Stability Preserving Runge–Kutta scheme with a Courant number small enough to not alter the leading-order spectral properties).\n\nDefine the spectral leakage factor associated with balanced initialization as the relative mismatch between the discrete pressure-gradient term and the Coriolis term for a Fourier mode $k$,\n$$\nL(k) \\equiv \\left| \\frac{g \\widehat{D}(k) - i g k}{i g k} \\right|.\n$$\nIn the asymptotic near-geostrophic regime characterized by a small Burger number $\\mathrm{Bu}(k) \\equiv \\left( \\frac{c k}{f} \\right)^{2} \\ll 1$, assume that bounding $L(k)$ by a tolerance $0  \\varepsilon \\ll 1$ is sufficient to prevent the emission of spurious gravity waves above relative amplitude $\\varepsilon$ during geostrophic adjustment.\n\nUsing only the definitions and asymptotic assumptions stated above, derive and present a closed-form analytic expression for the maximum admissible nondimensional wavenumber $\\kappa_{\\max} \\equiv k_{\\max} \\Delta x$ as a function of $\\varepsilon$, $\\beta_{q}$, and $q$, such that $L(k) \\leq \\varepsilon$ holds uniformly for all $k$ with $k \\Delta x \\leq \\kappa_{\\max}$ in the small Burger number regime. No numerical substitution is required. Your final answer must be a single analytical expression. If you introduce any angles, they must be in radians. Since no numerical evaluation is requested, no rounding is required, and no physical units should be included in the final expression.",
            "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- Linearized rotating shallow-water equations:\n  $$\n  \\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x}, \\quad \\frac{\\partial v}{\\partial t} + f u = 0, \\quad \\frac{\\partial \\eta}{\\partial t} + H \\frac{\\partial u}{\\partial x} = 0\n  $$\n- Definitions: $u, v$ are velocity components, $\\eta$ is free-surface displacement, $f$ is Coriolis parameter, $g$ is gravitational acceleration, $H$ is mean depth.\n- External gravity wave speed: $c = \\sqrt{g H}$.\n- Continuous geostrophic balance (stationary): $u = 0$ and $- f v = - g \\frac{\\partial \\eta}{\\partial x}$.\n- Numerical scheme: High-order finite-volume with WENO reconstruction, formal order $q \\geq 3$.\n- Modified wavenumber for the discrete spatial derivative operator $\\widehat{D}(k)$:\n  $$\n  \\widehat{D}(k) = i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) + \\mathcal{O}\\!\\left( (k \\Delta x)^{q+2} \\right)\n  $$\n  where $\\Delta x$ is grid spacing and $\\beta_{q}$ is a real constant.\n- Spectral leakage factor:\n  $$\n  L(k) \\equiv \\left| \\frac{g \\widehat{D}(k) - i g k}{i g k} \\right|\n  $$\n- Asymptotic regime and condition: Small Burger number $\\mathrm{Bu}(k) \\equiv \\left( \\frac{c k}{f} \\right)^{2} \\ll 1$, and $L(k) \\leq \\varepsilon$ for a small tolerance $0  \\varepsilon \\ll 1$.\n- Goal: Derive a closed-form analytic expression for the maximum admissible nondimensional wavenumber $\\kappa_{\\max} \\equiv k_{\\max} \\Delta x$ as a function of $\\varepsilon$, $\\beta_{q}$, and $q$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the field of numerical methods for geophysical fluid dynamics. All concepts, including the shallow-water equations, geostrophic balance, modified wavenumber analysis, and the study of numerical imbalance, are standard. The problem is well-posed, providing all necessary definitions and a clear objective. The language is objective and precise. The problem is self-contained and does not violate any physical or mathematical principles. The Burger number condition correctly frames the physical regime where geostrophic balance is dominant and its accurate numerical representation is critical. The problem is therefore deemed valid.\n\n**Step 3: Proceed with Solution**\nThe objective is to find the maximum nondimensional wavenumber $\\kappa_{\\max} \\equiv k_{\\max} \\Delta x$ such that the spectral leakage factor $L(k)$ is bounded by a tolerance $\\varepsilon$ for all wavenumbers $k$ where $k \\Delta x \\leq \\kappa_{\\max}$.\n\nThe spectral leakage factor is defined as:\n$$\nL(k) = \\left| \\frac{g \\widehat{D}(k) - i g k}{i g k} \\right|\n$$\nThis factor measures the relative error of the discretized pressure gradient term, $g \\widehat{D}(k)$, compared to the exact analytical term, $i g k$, for a single Fourier mode with wavenumber $k$.\n\nThe problem provides the leading-order expansion for the modified wavenumber of the spatial derivative operator:\n$$\n\\widehat{D}(k) = i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) + \\mathcal{O}\\!\\left( (k \\Delta x)^{q+2} \\right)\n$$\nFor this analysis, we consider the leading-order error term and neglect the higher-order terms. This is a standard approach in such asymptotic analyses. Thus, we approximate $\\widehat{D}(k)$ as:\n$$\n\\widehat{D}(k) \\approx i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right)\n$$\nSubstituting this approximation into the expression for $L(k)$:\n$$\nL(k) \\approx \\left| \\frac{g \\left[ i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) \\right] - i g k}{i g k} \\right|\n$$\nWe can simplify the expression in the numerator:\n$$\ng \\left[ i k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) \\right] - i g k = i g k \\left( 1 - \\beta_{q} (k \\Delta x)^{q} \\right) - i g k = i g k - i g k \\beta_{q} (k \\Delta x)^{q} - i g k = - i g k \\beta_{q} (k \\Delta x)^{q}\n$$\nThe expression for $L(k)$ becomes:\n$$\nL(k) \\approx \\left| \\frac{- i g k \\beta_{q} (k \\Delta x)^{q}}{i g k} \\right|\n$$\nAssuming $k \\neq 0$ (since $k=0$ corresponds to the grid mean, which has no spatial gradient), we can cancel the common factor $i g k$ from the numerator and denominator:\n$$\nL(k) \\approx \\left| - \\beta_{q} (k \\Delta x)^{q} \\right|\n$$\nSince $\\beta_{q}$ is a real constant and $k \\Delta x \\ge 0$, we can write this as:\n$$\nL(k) \\approx |\\beta_{q}| (k \\Delta x)^{q}\n$$\nThe problem requires that this leakage factor be bounded by $\\varepsilon$ for all modes up to a maximum wavenumber $k_{\\max}$:\n$$\n|\\beta_{q}| (k \\Delta x)^{q} \\leq \\varepsilon\n$$\nWe introduce the nondimensional wavenumber $\\kappa \\equiv k \\Delta x$. The inequality becomes:\n$$\n|\\beta_{q}| \\kappa^{q} \\leq \\varepsilon\n$$\nWe want to find the maximum value of $\\kappa$, denoted $\\kappa_{\\max}$, that satisfies this condition. As $L(k)$ is a monotonically increasing function of $k$ (since $q \\ge 3 > 0$), the condition $L(k) \\leq \\varepsilon$ will hold for all $k \\Delta x \\leq \\kappa_{\\max}$ if it holds at $\\kappa = \\kappa_{\\max}$. We therefore solve the equality for $\\kappa_{\\max}$:\n$$\n|\\beta_{q}| \\kappa_{\\max}^{q} = \\varepsilon\n$$\nSolving for $\\kappa_{\\max}^{q}$:\n$$\n\\kappa_{\\max}^{q} = \\frac{\\varepsilon}{|\\beta_{q}|}\n$$\nTaking the $q$-th root of both sides gives the final expression for the maximum admissible nondimensional wavenumber:\n$$\n\\kappa_{\\max} = \\left( \\frac{\\varepsilon}{|\\beta_{q}|} \\right)^{\\frac{1}{q}}\n$$\nThis expression depends only on the tolerance $\\varepsilon$, the scheme-dependent constant $\\beta_{q}$, and the order of the scheme $q$, as required by the problem statement. The small Burger number condition provides the physical context, identifying the dynamically relevant regime (near-geostrophic) where minimizing this numerical leakage is paramount to prevent spurious wave generation, but it does not enter the algebraic derivation of the numerical error bound itself.",
            "answer": "$$\n\\boxed{\\left( \\frac{\\varepsilon}{|\\beta_{q}|} \\right)^{\\frac{1}{q}}}\n$$"
        }
    ]
}