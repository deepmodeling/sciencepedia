{
    "hands_on_practices": [
        {
            "introduction": "在数值模型中，将抽象的垂直坐标与关键的物理量（如位势）联系起来是一项基本功。本练习将引导你从第一性原理出发，在一个特定的混合坐标系下推导出位势差的表达式，为你分析更复杂的动力学行为奠定数学基础。通过这个练习，你将掌握在地形追随坐标系下处理静力平衡方程的核心技巧。",
            "id": "4089053",
            "problem": "考虑一个数值天气预报（NWP）模型中的单一垂直大气柱，该模型使用混合sigma-压力垂直坐标 $\\eta$。静力平衡、位势 $\\Phi$ 的定义以及理想气体定律构成了该问题的基础。假设大气是静力的，重力加速度 $g$ 不随高度变化，且空气表现为理想气体，因此比容 $\\alpha$ 满足 $\\alpha = R T / p$，其中 $R$ 是干空气的比气体常数，$T$ 是绝对温度，$p$ 是气压。\n\n混合sigma-压力映射通过一个给定的廓线 $p(\\eta)$ 将气压定义为垂直坐标 $\\eta$ 的函数。在此大气柱中，气压廓线被选为一种特殊的混合形式 $p(\\eta) = p_{s} \\exp(-\\beta \\eta)$，这对应于通用混合形式 $p(\\eta) = A(\\eta) + B(\\eta) p_{s}$ 中的 $A(\\eta) = 0$ 和 $B(\\eta) = \\exp(-\\beta \\eta)$。这里 $p_{s} > 0$ 是气柱的地面气压，$\\beta > 0$ 是一个控制气压随 $\\eta$ 衰减速率的常数。温度廓线被指定为 $T(\\eta) = T_{0} + T_{1} \\eta$，其中 $T_{0} > 0$ 和 $T_{1}$ 是常数。\n\n从第一性原理（静力平衡、位势的定义和理想气体定律）出发，推导在两个混合层 $\\eta_{1}$ 和 $\\eta_{2}$ 之间的位势差 $\\Phi(\\eta_{2}) - \\Phi(\\eta_{1})$ 的闭式解析表达式，该表达式用 $R$、$\\beta$、$T_{0}$、$T_{1}$、$\\eta_{1}$ 和 $\\eta_{2}$ 表示。\n\n最终答案以焦耳每千克（J kg$^{-1}$）表示，并提供一个单一的闭式解析表达式。不代入任何数值。不要简化为数值。不需要四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、提法明确且客观，提供了基于大气科学基本原理推导唯一解所需的所有信息。\n\n推导从静力平衡方程开始，该方程将气压 $p$ 的变化与几何高度 $z$ 的变化联系起来。在静止流体中，气压梯度与重力相平衡：\n$$\n\\frac{dp}{dz} = -\\rho g\n$$\n其中 $\\rho$ 是空气密度，$g$ 是重力加速度，假定为常数。\n\n位势 $\\Phi$ 定义为将单位质量从海平面提升到某一高度 $z$ 所需克服重力做的功。其微分形式为：\n$$\nd\\Phi = g \\, dz\n$$\n结合这两个方程，我们可以将位势的微分与气压的微分联系起来。根据位势的定义，我们有 $dz = \\frac{d\\Phi}{g}$。将其代入静力平衡方程得到：\n$$\n\\frac{dp}{d\\Phi/g} = -\\rho g \\implies \\frac{dp}{d\\Phi} = -\\rho\n$$\n问题陈述空气应被视为理想气体。对于比容 $\\alpha = 1/\\rho$ 的理想气体定律为：\n$$\np\\alpha = RT\n$$\n其中 $R$ 是干空气的比气体常数，$T$ 是绝对温度。因此，$\\rho = \\frac{p}{RT}$。将其代入我们关于位势的气压梯度表达式中得到：\n$$\n\\frac{dp}{d\\Phi} = -\\frac{p}{RT}\n$$\n重新整理该方程，得到位势、温度和气压之间的一个基本微分关系：\n$$\nd\\Phi = -RT \\frac{dp}{p}\n$$\n目标是求出由混合垂直坐标 $\\eta$ 定义的两个层级之间的位势差 $\\Phi(\\eta_2) - \\Phi(\\eta_1)$。为此，我们对 $d\\Phi$ 进行积分。然而，右侧的变量 $T$ 和 $p$ 是作为 $\\eta$ 的函数给出的。因此，最方便的做法是将积分变量从 $p$ 或 $\\Phi$ 更改为 $\\eta$。\n\n使用链式法则，我们可以将位势相对于坐标 $\\eta$ 的导数表示为：\n$$\n\\frac{d\\Phi}{d\\eta} = \\frac{d\\Phi}{dp} \\frac{dp}{d\\eta}\n$$\n从关系式 $d\\Phi = -RT \\frac{dp}{p}$，我们可以确定 $\\frac{d\\Phi}{dp} = -\\frac{RT}{p}$。\n\n接下来，我们计算 $\\frac{dp}{d\\eta}$ 这一项。气压廓线由下式给出：\n$$\np(\\eta) = p_{s} \\exp(-\\beta \\eta)\n$$\n将 $p$ 对 $\\eta$ 求导得到：\n$$\n\\frac{dp}{d\\eta} = p_{s} \\cdot \\exp(-\\beta \\eta) \\cdot (-\\beta) = -\\beta \\left( p_{s} \\exp(-\\beta \\eta) \\right) = -\\beta p(\\eta)\n$$\n将这些导数代回 $\\frac{d\\Phi}{d\\eta}$ 的链式法则表达式中：\n$$\n\\frac{d\\Phi}{d\\eta} = \\left( -\\frac{RT}{p} \\right) (-\\beta p) = R\\beta T\n$$\n由于 $R$ 和 $\\beta$ 都是常数，位势相对于 $\\eta$ 坐标的变化率与温度 $T$ 成正比。\n\n为求位势差 $\\Phi(\\eta_2) - \\Phi(\\eta_1)$，我们将 $\\frac{d\\Phi}{d\\eta}$ 从 $\\eta_1$ 到 $\\eta_2$ 对 $\\eta$ 进行积分：\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = \\int_{\\eta_1}^{\\eta_2} \\frac{d\\Phi}{d\\eta} d\\eta = \\int_{\\eta_1}^{\\eta_2} R\\beta T(\\eta) d\\eta\n$$\n问题指定温度廓线是 $\\eta$ 的线性函数：\n$$\nT(\\eta) = T_{0} + T_{1}\\eta\n$$\n将其代入积分中：\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\int_{\\eta_1}^{\\eta_2} (T_{0} + T_{1}\\eta) d\\eta\n$$\n现在我们可以进行积分计算：\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left[ T_{0}\\eta + \\frac{1}{2}T_{1}\\eta^2 \\right]_{\\eta_1}^{\\eta_2}\n$$\n在积分上下限 $\\eta_2$ 和 $\\eta_1$ 处对表达式求值：\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left( \\left( T_{0}\\eta_2 + \\frac{1}{2}T_{1}\\eta_2^2 \\right) - \\left( T_{0}\\eta_1 + \\frac{1}{2}T_{1}\\eta_1^2 \\right) \\right)\n$$\n最后，我们整理各项，得到位势差的闭式解析表达式：\n$$\n\\Phi(\\eta_2) - \\Phi(\\eta_1) = R\\beta \\left( T_{0}(\\eta_2 - \\eta_1) + \\frac{1}{2}T_{1}(\\eta_2^2 - \\eta_1^2) \\right)\n$$\n该表达式的单位是 $[J \\cdot kg^{-1} \\cdot K^{-1}] \\cdot [无量纲] \\cdot ([K] \\cdot [无量纲] + [K] \\cdot [无量纲]^2) = [J \\cdot kg^{-1}]$，这正是位势的正确单位。",
            "answer": "$$\n\\boxed{R \\beta \\left( T_{0}(\\eta_{2} - \\eta_{1}) + \\frac{1}{2} T_{1}(\\eta_{2}^{2} - \\eta_{1}^{2}) \\right)}\n$$"
        },
        {
            "introduction": "掌握了坐标系下的基本物理关系后，我们来检验最简单的地形追随坐标——纯sigma坐标系的一个关键缺陷。本练习将通过一个数值实验，揭示并量化在静止大气中、坡地地形上产生的“水平气压梯度力误差”。这个虚假的加速度误差是推动更复杂坐标系发展的核心原因之一。",
            "id": "4089051",
            "problem": "考虑一个用于数值天气预报 (NWP) 和气候模拟的干燥、等温大气，它占据一个二维域，其中水平坐标为 $x$，几何高度为 $z$。设大气处于静力平衡状态，并遵循理想气体定律。静力平衡关系为 $\\,\\frac{\\partial p}{\\partial z}=-\\rho g\\,$，理想气体定律为 $\\,p=\\rho R T\\,$，其中 $p$ 是压强，$\\rho$ 是密度， $g$ 是重力加速度， $R$ 是干空气的比气体常数， $T$ 是绝对温度。假设大气为等温大气，温度恒为 $T=T_0$，并且在 $z=0$ 处有参考压强 $p_{\\mathrm{ref}}$。\n\n地形高度由 $z_s(x)=s\\,x$ 给出，其中 $s$ 是恒定的坡度参数，地表压强是静力平衡值 $p_s(x)=p_{\\mathrm{ref}}\\exp\\!\\left(-\\frac{z_s(x)}{H}\\right)$，其中 $H=\\frac{R T_0}{g}$ 是密度尺度高度。定义地形追随 sigma 坐标为 $\\,\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}\\,$，其中 $p_{\\mathrm{top}}$ 是模式顶部的恒定压强。对于任何固定的 $\\sigma$，在水平均温和静力平衡的假设下，静力平衡状态由 $\\,p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\big(p_s(x)-p_{\\mathrm{top}}\\big)\\,$ 和 $\\,\\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}\\,$ 定义。\n\n基于这些基础，完成以下任务：\n\n- 从第一性原理出发，通过显式应用静力平衡和理想气体定律，推导在恒定几何高度 $z$ 上的水平气压梯度力 (PGF) 的连续表达式，并解释为什么对于倾斜地形上的指定等温静力平衡状态，该力为零（即，当真实的 $p$ 仅依赖于 $z$ 时，对于所有 $x$，都有 $\\,\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0\\,$）。\n- 通过计算沿等 $\\sigma$ 面的 $\\,\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}\\,$ 的中心有限差分近似，构建水平 PGF 的离散近似。使用一个长度为 $L$ 的周期性 $x$ 域，其中包含 $N_x$ 个等距格点和 $N_\\sigma$ 个等距 sigma 层，这些层位于层中位置 $\\,\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}\\,$，其中 $k\\in\\{0,1,\\dots,N_\\sigma-1\\}$。对每个 $\\sigma_k$ 上的水平导数使用带周期性边界条件的中心有限差分。将由此产生的虚假水平加速度量化为 $\\,a(x,\\sigma_k)=-\\frac{1}{\\rho(x,\\sigma_k)}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\,$，以 $\\mathrm{m/s^2}$ 为单位表示。\n- 通过报告二维网格上的最大绝对值 $\\,\\max_{x,k}\\left|a(x,\\sigma_k)\\right|\\,$（以 $\\mathrm{m/s^2}$ 为单位）来汇总离散的虚假加速度。\n\n您的程序必须实现上述离散构造，并为以下测试套件生成数值结果，每个情况由 $[L,s,N_x,N_\\sigma]$ 定义，固定常数为 $\\,g=9.81\\,\\mathrm{m/s^2}\\,$, $\\,R=287\\,\\mathrm{J/(kg\\cdot K)}\\,$, $\\,T_0=300\\,\\mathrm{K}\\,$, $\\,p_{\\mathrm{ref}}=100000\\,\\mathrm{Pa}\\,$ 和 $\\,p_{\\mathrm{top}}=20000\\,\\mathrm{Pa}$:\n\n- 情况 1: $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=30]$。\n- 情况 2 (边界条件检查): $[L=100000\\,\\mathrm{m},\\,s=0,\\,N_x=128,\\,N_\\sigma=30]$。\n- 情况 3 (粗垂直分辨率): $[L=100000\\,\\mathrm{m},\\,s=0.01,\\,N_x=128,\\,N_\\sigma=3]$。\n- 情况 4 (更陡的坡度): $[L=100000\\,\\mathrm{m},\\,s=0.05,\\,N_x=128,\\,N_\\sigma=30]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[a_1,a_2,a_3,a_4]$），其中 $a_i$ 是情况 $i$ 的最大绝对虚假加速度，以 $\\mathrm{m/s^2}$ 为单位，表示为浮点数。本问题不涉及角度。本问题不涉及百分比；直接报告浮点数值。所有量必须使用给定的国际单位制（SI）单位进行计算，最终输出必须以 $\\mathrm{m/s^2}$ 为单位。",
            "solution": "我们从静力平衡和理想气体定律开始，这是数值天气预报 (NWP) 和气候模拟中使用的干空气热力学的基石。静力平衡方程为\n$$\n\\frac{\\partial p}{\\partial z}=-\\rho g,\n$$\n理想气体定律为\n$$\np=\\rho R T.\n$$\n在等温假设 $T=T_0$ 下，我们可以结合这两个方程来推导经典的指数气压廓线。将 $\\rho=\\frac{p}{R T_0}$ 代入静力平衡方程得到\n$$\n\\frac{\\partial p}{\\partial z}=-\\frac{p}{R T_0}\\,g=-\\frac{p}{H},\n$$\n其中 $H=\\frac{R T_0}{g}$ 是密度尺度高度。用边界条件 $p(0)=p_{\\mathrm{ref}}$ 求解这个常微分方程，得到\n$$\np(z)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{z}{H}\\right).\n$$\n对于倾斜的下边界 $z_s(x)=s\\,x$，地表压强通过在地形高度处求值获得：\n$$\np_s(x)=p\\big(z_s(x)\\big)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x}{H}\\right).\n$$\n\n定义地形追随 sigma 坐标为\n$$\n\\sigma(x,z)=\\frac{p(x,z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}.\n$$\n对于静力、等温大气，可以在 sigma 面上构建一个静力状态：\n$$\np(x,\\sigma)=p_{\\mathrm{top}}+\\sigma\\left(p_s(x)-p_{\\mathrm{top}}\\right),\\qquad \\rho(x,\\sigma)=\\frac{p(x,\\sigma)}{R T_0}.\n$$\n在这种构造中，几何高度 $z$ 中的连续大气状态在固定的 $z$ 上是水平均匀的，因为 $p(z)$ 仅依赖于 $z$；因此，在恒定几何高度上的真实水平气压梯度为零：\n$$\n\\left.\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x}\\right|_{z}=0.\n$$\n为了形式上证明这一点，应用链式法则。将 $p$ 视为 $(x,\\sigma)$ 的函数，其中 $\\sigma=\\sigma(x,z)$。在恒定 $z$ 处的导数可以写为\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}+\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}.\n$$\n第一项是沿等 $\\sigma$ 面的导数，\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x},\n$$\n因为 $p(x,\\sigma)=p_{\\mathrm{top}}+\\sigma(p_s(x)-p_{\\mathrm{top}})$ 意味着 $\\frac{\\partial p}{\\partial x}\\big|_{\\sigma}=\\sigma \\frac{\\partial p_s}{\\partial x}$。在固定 $x$ 处对 $\\sigma$ 的导数是\n$$\n\\left.\\frac{\\partial p}{\\partial \\sigma}\\right|_{x}=p_s(x)-p_{\\mathrm{top}}.\n$$\n我们从 $\\sigma(x,z)$ 的定义出发，在保持 $z$ 固定的情况下计算 $\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}$。观察到 $p(x,z)=p(z)$（不依赖于 $x$）意味着在连续解析场中 $\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=0$，但写出链式法则有助于识别各项的相消。在固定 $z$ 处对 $\\sigma(x,z)=\\frac{p(z)-p_{\\mathrm{top}}}{p_s(x)-p_{\\mathrm{top}}}$ 求导，得到\n$$\n\\left.\\frac{\\partial \\sigma}{\\partial x}\\right|_{z}=-\\frac{p(z)-p_{\\mathrm{top}}}{\\left(p_s(x)-p_{\\mathrm{top}}\\right)^2}\\,\\frac{\\partial p_s}{\\partial x}=-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}.\n$$\n组合这些项，\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z}=\\sigma \\frac{\\partial p_s}{\\partial x} + \\left(p_s(x)-p_{\\mathrm{top}}\\right)\\left(-\\frac{\\sigma}{p_s(x)-p_{\\mathrm{top}}}\\,\\frac{\\partial p_s}{\\partial x}\\right)=0.\n$$\n因此，在连续的情况下，度规项与沿 $\\sigma$ 的导数项精确相消，导致等温静力平衡大气在恒定 $z$ 高度上的水平 PGF 为零，这与坡度 $s$ 无关。\n\n在一个离散的地形追随 sigma 坐标模式中，如果沿等 $\\sigma$ 面使用中心有限差分来近似水平气压梯度，并忽略度规相消项，就会出现虚假加速度。我们如下构造离散近似：\n\n- 将 $x\\in[0,L)$ 离散化为 $N_x$ 个格点 $x_i=i\\,\\Delta x$，其中 $\\Delta x=L/N_x$，使用周期性边界条件。\n- 用 $N_\\sigma$ 个层中层级 $\\sigma_k=\\frac{k+\\tfrac{1}{2}}{N_\\sigma}$（其中 $k=0,1,\\dots,N_\\sigma-1$）离散化 sigma。\n- 计算 $p_s(x_i)=p_{\\mathrm{ref}}\\exp\\left(-\\frac{s\\,x_i}{H}\\right)$，其中 $H=\\frac{R T_0}{g}$。\n- 计算 $p(x_i,\\sigma_k)=p_{\\mathrm{top}}+\\sigma_k\\left(p_s(x_i)-p_{\\mathrm{top}}\\right)$ 和 $\\rho(x_i,\\sigma_k)=\\frac{p(x_i,\\sigma_k)}{R T_0}$。\n- 通过带周期性边界的中心有限差分来近似恒定 $\\sigma_k$ 上的水平导数：\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}\\approx \\frac{p(x_{i+1},\\sigma_k)-p(x_{i-1},\\sigma_k)}{2\\Delta x},\n$$\n其中指数对 $N_x$ 取模以实现周期性。\n- 将离散的虚假加速度（仅由使用沿 $\\sigma$ 的有限差分近似并忽略度规项引起）定义为\n$$\na(x_i,\\sigma_k)=-\\frac{1}{\\rho(x_i,\\sigma_k)}\\,\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}\\bigg|_{x_i}.\n$$\n\n由于解析状态下恒定 $z$ 处的真实连续 PGF 为零，因此通过上述离散近似计算出的任何非零 $a(x_i,\\sigma_k)$ 都直接量化了地形追随面上的离散化所引入的虚假水平加速度。\n\n我们必须为每个测试用例报告一个标量：在所有离散点上的最大绝对虚假加速度，\n$$\nA_{\\max}=\\max_{0\\le i\\le N_x-1}\\max_{0\\le k\\le N_\\sigma-1}\\left|a(x_i,\\sigma_k)\\right|,\n$$\n单位为 $\\mathrm{m/s^2}$。\n\n算法步骤：\n\n- 对于每个测试用例，计算 $H=\\frac{R T_0}{g}$，构建 $x_i$、$p_s(x_i)$、$\\sigma_k$、$p(x_i,\\sigma_k)$ 和 $\\rho(x_i,\\sigma_k)$。\n- 在每个 $(i,k)$ 点使用周期性边界计算 $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma_k}$ 的中心有限差分近似。\n- 计算 $a(x_i,\\sigma_k)$，然后计算 $A_{\\max}$ 作为所有格点上的最大绝对值。\n- 输出指定四种情况的结果列表 $[A_{\\max}^{(1)},A_{\\max}^{(2)},A_{\\max}^{(3)},A_{\\max}^{(4)}]$，单位为 $\\mathrm{m/s^2}$。\n\n合理性检查和预期行为：\n\n- 对于 $s=0$，我们有 $p_s(x)=p_{\\mathrm{ref}}$ 对所有 $x$ 成立，因此在每个 $\\sigma$ 层上 $p(x,\\sigma)$ 在 $x$ 方向上是恒定的，我们的有限差分导数将精确为零，因此 $A_{\\max}=0$（在浮点舍入误差范围内）。\n- 随着 $s$ 增大，$p_s(x)$ 随 $x$ 的变化更强，沿 $\\sigma$ 面的 $p(x,\\sigma)$ 的中心差分将产生更大的量值，虚假加速度大致与 $s$ 成正比，并受 $\\sigma$ 和压强随 $x$ 变化的影响。\n- 改变 $N_\\sigma$ 会改变采样的 $\\sigma$ 值；由于 $|a|$ 随 $\\sigma$ 增大（越接近地表）和 $p_s$ 增大而增大，粗垂直分辨率可能会根据采样的 $\\sigma$ 层级略微改变报告的最大值，但基本的虚假加速度依然存在。\n\n所有计算均使用指定的 $\\mathrm{SI}$ 常数和单位，加速度以 $\\mathrm{m/s^2}$ 报告。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_spurious_acceleration(L, s, Nx, Nz, g=9.81, R=287.0, T0=300.0, p_ref=100000.0, p_top=20000.0):\n    \"\"\"\n    Compute the maximum absolute spurious horizontal acceleration (in m/s^2)\n    arising from a naive discrete horizontal pressure gradient along constant-sigma\n    surfaces for an isothermal hydrostatic atmosphere over sloping terrain.\n    \"\"\"\n    # Scale height\n    H = R * T0 / g\n\n    # Grid\n    dx = L / Nx\n    x = np.arange(Nx) * dx  # periodic grid\n\n    # Terrain and surface pressure\n    z_s = s * x\n    p_s = p_ref * np.exp(-z_s / H)\n\n    # Sigma levels (mid-layer)\n    k = np.arange(Nz)\n    sigma = (k + 0.5) / Nz  # shape (Nz,)\n\n    # Build pressure field p(x_i, sigma_k) and density rho\n    # p(x, sigma) = p_top + sigma * (p_s(x) - p_top)\n    # We broadcast: x axis length Nx, sigma axis length Nz\n    p = p_top + np.outer(p_s - p_top, sigma)  # shape (Nx, Nz)\n    rho = p / (R * T0)\n\n    # Centered finite difference in x with periodic boundary conditions for each sigma level\n    # dp/dx at constant sigma\n    # We'll compute for all k simultaneously using roll\n    p_plus = np.roll(p, -1, axis=0)  # i+1\n    p_minus = np.roll(p, 1, axis=0)  # i-1\n    dpdx = (p_plus - p_minus) / (2.0 * dx)\n\n    # Spurious acceleration: a = -(1/rho) * dpdx\n    a = -(1.0 / rho) * dpdx\n\n    # Maximum absolute value over all i,k\n    A_max = np.max(np.abs(a))\n    return A_max\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], s [dimensionless slope], Nx, Nz)\n    test_cases = [\n        (100000.0, 0.01, 128, 30),  # Case 1\n        (100000.0, 0.0, 128, 30),   # Case 2 (boundary: zero slope)\n        (100000.0, 0.01, 128, 3),   # Case 3 (coarse vertical resolution)\n        (100000.0, 0.05, 128, 30),  # Case 4 (steeper slope)\n    ]\n\n    results = []\n    for case in test_cases:\n        L, s, Nx, Nz = case\n        A_max = compute_spurious_acceleration(L, s, Nx, Nz)\n        # Format to a reasonable precision\n        results.append(f\"{A_max:.10e}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在上一个练习中，我们量化了纯sigma坐标系中的气压梯度力误差。现在，我们将目光转向解决方案：混合sigma-气压坐标。本练习将直接对比纯sigma坐标系与混合坐标系的性能，通过计算模型在山脉上空产生的虚假加速度的减少程度，你将亲手验证混合坐标设计的有效性。",
            "id": "4089087",
            "problem": "在数值天气预报(NWP)和气候模拟的背景下，考虑一个位于二维山脊上方的理想化、静力、干燥的静止大气。设水平坐标为 $x$ (单位：米)，垂直坐标为地形跟随变量 $\\eta \\in [0,1]$，其中 $\\eta = 0$ 对应模式层顶，$\\eta = 1$ 对应地表。地表高程由函数 $h(x)$ (单位：米)指定。假设温度 $T$ (单位：开尔文)水平均匀且为等温，重力加速度 $g$ (单位：米/秒平方)为常数，干空气气体常数 $R_d$ (单位：焦耳/千克·开尔文)为常数。参考海平面气压为 $p_0$ (单位：帕斯卡)，模式层顶气压为 $p_{\\mathrm{top}}$ (单位：帕斯卡)。定义标高 $H = R_d T / g$ (单位：米)。\n\n在静力平衡和理想气体定律下，地表气压随高程的变化如下\n$$\np_s(x) = p_0 \\exp\\!\\left(-\\frac{h(x)}{H}\\right).\n$$\n定义高斯山脊剖面\n$$\nh(x) = h_0 \\exp\\!\\left(-\\left(\\frac{x}{w}\\right)^2\\right),\n$$\n其中 $h_0$ (单位：米)是山峰高度，$w$ (单位：米)是控制山脊陡峭程度的半宽参数。\n\n考虑两种垂直坐标的构建方案：\n\n1. 纯sigma坐标：\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right).\n$$\n\n2. 混合sigma-气压坐标：\n$$\np_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta)\\, p_s(x),\n$$\n采用以下选择，可以在过渡层 $\\eta_c \\in (0,1)$ 上方产生等距的气压层：\n- 对于 $0 \\le \\eta \\le \\eta_c$,\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right),\n$$\n这将在 $p_{\\mathrm{top}}$ 和一个指定的过渡气压 $p_c$ (单位：帕斯卡)之间产生线性间隔的气压层。\n- 对于 $\\eta_c \\le \\eta \\le 1$,\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}.\n$$\n这种构造确保了在 $\\eta_c$ 处的连续性，满足 $p(\\eta_c)=p_c$，并强制 $p(1)=p_s(x)$ 和 $p(0)=p_{\\mathrm{top}}$。\n\n设在给定气压下的位势(单位：平方米/秒平方)由等温大气的静力关系定义：\n$$\n\\Phi(x,\\eta) = g\\, z(x,\\eta) = R_d\\, T \\ln\\!\\left(\\frac{p_0}{p(x,\\eta)}\\right),\n$$\n其中 $p(x,\\eta)$ 是 $p_{\\sigma}(x,\\eta)$ 或 $p_{\\mathrm{hyb}}(x,\\eta)$，$z(x,\\eta)$ 是该气压层的几何高度。\n\n假设在常数 $\\eta$ 面上，使用间距为 $\\Delta x$ (单位：米)的均匀网格上的二阶中心差分，对水平气压梯度项进行朴素的离散评估：\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2\\, \\Delta x},\n$$\n其结果是一个加速度(单位：米/秒平方)。在物理上正确的、水平均匀的静止等温大气中，真实的水平加速度应为 $0$；通过这种朴素的地形跟随离散化计算出的任何非零 $a_i(\\eta)$ 都是地形引起的气压梯度误差。\n\n对于给定的坐标系，定义在所有内部水平格点 $i$ 和所有离散垂直层次 $\\eta_k$ 上的均方根(RMS)地形诱导加速度误差为\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}}\\, N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2},\n$$\n其中 $N_{\\mathrm{lev}}$ 是垂直层数，$\\mathcal{I}$ 表示内部水平索引的集合（不包括中心差分所需的边界点），$N_{\\mathrm{int}} = |\\mathcal{I}|$ 是内部点的数量。设 $E_{\\sigma}$ 表示用 $p_{\\sigma}$ 计算的此RMS误差，$E_{\\mathrm{hyb}}$ 表示用 $p_{\\mathrm{hyb}}$ 计算的RMS误差。\n\n您的任务是计算由于选择混合sigma-气压坐标而导致的地形诱导气压梯度误差的减少量，该减少量由无量纲比率量化：\n$$\n\\mathcal{R} = \\frac{E_{\\mathrm{hyb}}}{E_{\\sigma}}.\n$$\n当 $E_{\\sigma}$ 在数值上为零时，如果 $E_{\\mathrm{hyb}}$ 在数值上同样为零，则设 $\\mathcal{R} = 0$；否则将 $\\mathcal{R}$ 设置为一个大的标记值（例如 $10^9$）以指示病态情况。\n\n实现一个完整的程序，该程序：\n- 在 $x \\in [-L, L]$ 上构建一个一维水平网格，其间距均匀为 $\\Delta x$，共有 $N_x = 2L/\\Delta x + 1$ 个点，其中 $L$ 是固定的域半长度（单位：米）。\n- 在 $\\eta \\in [0,1]$ 中构建 $N_{\\mathrm{lev}}$ 个均匀间隔的垂直层次，包括端点。\n- 计算 $p_s(x)$、$p_{\\sigma}(x,\\eta)$、$p_{\\mathrm{hyb}}(x,\\eta)$ 以及相应的 $\\Phi(x,\\eta)$ 场。\n- 使用中心差分计算内部点的 $a_i(\\eta)$。\n- 计算 $E_{\\sigma}$、$E_{\\mathrm{hyb}}$ 和比率 $\\mathcal{R}$。\n\n在您的计算中使用以下固定的物理参数：\n- $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$，\n- $g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$，\n- $T = 280\\ \\mathrm{K}$，\n- $p_0 = 101325\\ \\mathrm{Pa}$，\n- 过渡气压 $p_c = 70000\\ \\mathrm{Pa}$，\n- 域半长度 $L = 200000\\ \\mathrm{m}$，\n- 垂直层数 $N_{\\mathrm{lev}} = 30$。\n\n设计一个包含六个参数集的测试套件，每个参数集由 $(h_0, w, \\Delta x, \\eta_c, p_{\\mathrm{top}})$ 指定：\n1. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ 正常路径下的中等山脉和标准过渡。\n2. $(0,\\ 20000,\\ 2000,\\ 0.7,\\ 10000)$ 平坦地形边界情况（预计误差基本为零）。\n3. $(2500,\\ 10000,\\ 1000,\\ 0.7,\\ 10000)$ 陡峭狭窄的山脊。\n4. $(1500,\\ 20000,\\ 2000,\\ 0.95,\\ 10000)$ 过渡层非常接近地表（高层主要基于气压）。\n5. $(1500,\\ 20000,\\ 2000,\\ 0.15,\\ 10000)$ 过渡层接近顶层（大部分类似sigma坐标）。\n6. $(1500,\\ 20000,\\ 2000,\\ 0.7,\\ 30000)$ 更高的模式层顶气压。\n\n对于所有计算，加速度以 $\\mathrm{m}\\,\\mathrm{s}^{-2}$ 表示。您的程序最终所需的输出是一行，其中包含测试套件的六个 $\\mathcal{R}$ 值，格式为方括号括起来的逗号分隔列表，例如，“[r1,r2,r3,r4,r5,r6]”。每个 $r_j$ 都必须是浮点数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[result1,result2,result3,result4,result5,result6]”）。",
            "solution": "该问题经确认为科学上合理、定义明确、客观且自洽。所有必要的方程、参数和数值步骤均已提供，以计算出唯一、可验证的解。其潜在的物理和数值概念是大气模拟中的标准内容。因此，我们可以着手求解。\n\n目标是量化从纯sigma ($\\sigma$)坐标系过渡到混合sigma-气压坐标系时，数值气压梯度力(PGF)误差的减小程度。这个误差是地形跟随坐标模式中一个众所周知的人为产物，源于在PGF计算中对两个巨大且几乎相互抵消的项进行有限差分近似。一个物理上正确的静止、静力平衡大气的模型应产生零水平加速度，因此任何计算出的非零加速度都是数值误差。我们将计算混合系统的均方根(RMS)加速度误差与纯sigma系统的均方根加速度误差之比，即 $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$。\n\n对于每个给定的测试用例，求解方法包括以下顺序步骤：\n\n首先，我们建立物理和数值环境。基本物理常数给定为 $R_d = 287\\ \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ (干空气气体常数)，$g = 9.81\\ \\mathrm{m}\\,\\mathrm{s}^{-2}$ (重力加速度)，$T = 280\\ \\mathrm{K}$ (等温温度)，以及 $p_0 = 101325\\ \\mathrm{Pa}$ (参考海平面气压)。根据这些，我们计算大气标高 $H = R_d T / g$。数值域是一个跨越水平坐标 $x$ 和垂直坐标 $\\eta$ 的二维网格。$x$ 的水平网格定义在域 $[-L, L]$ 上，其中 $L = 200000\\ \\mathrm{m}$，使用均匀间距 $\\Delta x$，该间距因测试用例而异。水平格点数为 $N_x = 2L/\\Delta x + 1$。$\\eta$ 的垂直网格由 $N_{\\mathrm{lev}} = 30$ 个从 $\\eta=0$ (模式层顶)到 $\\eta=1$ (地表)均匀分布的层级组成，包含端点。\n\n其次，我们定义地表地形及相应的地表气压。山脊通过高斯剖面 $h(x) = h_0 \\exp(-(x/w)^2)$ 建模，其中 $h_0$ 和 $w$ 是特定于测试用例的参数。在静力和等温大气的假设下，地表气压 $p_s(x)$ 计算为 $p_s(x) = p_0 \\exp(-h(x)/H)$。此计算产生一个一维数组，其包含了对应于水平网格上每个点的地表气压值。\n\n第三，我们为两种坐标系构建完整的二维气压场 $p(x, \\eta)$。这些场由维度为 $(N_{\\mathrm{lev}}, N_x)$ 的数组表示。\n对于纯sigma坐标系，每个格点的气压由地表和模式层顶之间的气压线性插值给出：\n$$\np_{\\sigma}(x,\\eta) = p_{\\mathrm{top}} + \\eta \\left(p_s(x) - p_{\\mathrm{top}}\\right)\n$$\n对于混合sigma-气压坐标系，气压定义为 $p_{\\mathrm{hyb}}(x,\\eta) = A(\\eta) + B(\\eta) p_s(x)$。系数 $A(\\eta)$ 和 $B(\\eta)$ 是分段定义的，以在高空从纯气压坐标系平滑过渡到近地表的的地形跟随坐标系。过渡发生在层级 $\\eta_c$ 和气压 $p_c=70000\\ \\mathrm{Pa}$ 处。\n对于过渡层以上的层次($0 \\le \\eta \\le \\eta_c$)，坐标是纯粹基于气压的：\n$$\nB(\\eta)=0, \\quad A(\\eta) = p_{\\mathrm{top}} + \\frac{\\eta}{\\eta_c} \\left(p_c - p_{\\mathrm{top}}\\right)\n$$\n对于过渡层以下的层次($\\eta_c  \\eta \\le 1$)，坐标是混合的：\n$$\nB(\\eta) = \\frac{\\eta - \\eta_c}{1 - \\eta_c}, \\quad A(\\eta) = p_{\\mathrm{top}} + \\left(p_c - p_{\\mathrm{top}}\\right) - p_c \\frac{\\eta - \\eta_c}{1 - \\eta_c}\n$$\n这些公式在 $(x, \\eta)$ 网格上产生了两个不同的气压场，$p_{\\sigma}$ 和 $p_{\\mathrm{hyb}}$。\n\n第四，我们计算位势场 $\\Phi(x, \\eta)$。对于等温大气，位势通过从海平面积分的测高公式与气压相关，得到：\n$$\n\\Phi(x,\\eta) = R_d T \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right) = H g \\ln\\left(\\frac{p_0}{p(x,\\eta)}\\right)\n$$\n对两个气压场都执行此计算，产生 $\\Phi_{\\sigma}(x, \\eta)$ 和 $\\Phi_{\\mathrm{hyb}}(x, \\eta)$。\n\n第五，我们计算由地形引起的水平加速度误差。此误差 $a_i(\\eta)$ 在每个垂直层级 $\\eta_k$ 和每个内部水平格点 $i$ 上，使用恒定 $\\eta$ 面上水平位势梯度的二阶中心有限差分近似来计算：\n$$\na_i(\\eta) = -\\frac{\\Phi_{i+1}(\\eta) - \\Phi_{i-1}(\\eta)}{2 \\Delta x}\n$$\n此操作应用于两个位势场 $\\Phi_{\\sigma}$ 和 $\\Phi_{\\mathrm{hyb}}$，产生定义在域内部的两个误差场 $a_{\\sigma}$ 和 $a_{\\mathrm{hyb}}$。\n\n最后，我们对每个系统的总误差进行量化和比较。均方根(RMS)误差在所有内部水平点和所有垂直层级上计算：\n$$\nE = \\sqrt{\\frac{1}{N_{\\mathrm{lev}} N_{\\mathrm{int}}} \\sum_{k=1}^{N_{\\mathrm{lev}}} \\sum_{i \\in \\mathcal{I}} \\left(a_i(\\eta_k)\\right)^2}\n$$\n其中 $N_{\\mathrm{int}} = N_x - 2$ 是内部水平点的数量。这会产生RMS误差 $E_{\\sigma}$ 和 $E_{\\mathrm{hyb}}$。最终的度量是它们的比率 $\\mathcal{R} = E_{\\mathrm{hyb}} / E_{\\sigma}$。对于平坦地形($h_0=0$)的特殊情况进行了处理，此时两个误差预计在数值上都为零；在这种情况下，$\\mathcal{R}$ 设置为 $0$。如果 $E_{\\sigma}$ 在数值上为零但 $E_{\\mathrm{hyb}}$ 不为零，则将 $\\mathcal{R}$ 设置为一个大的标记值($10^9$)，尽管这种情况预计不会发生。对问题陈述中指定的六个测试用例中的每一个都重复此完整过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_r(params):\n    \"\"\"\n    Calculates the ratio of terrain-induced pressure-gradient errors for a single test case.\n    \"\"\"\n    h0, w, delta_x, eta_c, p_top = params\n\n    # Fixed physical parameters\n    R_d = 287.0\n    g = 9.81\n    T = 280.0\n    p0 = 101325.0\n    pc = 70000.0\n    L = 200000.0\n    N_lev = 30\n\n    # Scale height\n    H = R_d * T / g\n\n    # Numerical grids\n    Nx = int(2 * L / delta_x) + 1\n    x = np.linspace(-L, L, Nx)\n    eta = np.linspace(0, 1, N_lev)\n\n    # Surface fields\n    h = h0 * np.exp(-(x / w)**2)\n    ps = p0 * np.exp(-h / H)\n\n    # Reshape for broadcasting\n    eta_col = eta.reshape(-1, 1)\n    ps_row = ps.reshape(1, -1)\n\n    # --- Pure Sigma Coordinate Calculation ---\n    p_sigma = p_top + eta_col * (ps_row - p_top)\n    \n    # --- Hybrid Sigma-Pressure Coordinate Calculation ---\n    A = np.zeros(N_lev)\n    B = np.zeros(N_lev)\n\n    # Region 1: 0 = eta = eta_c\n    mask_lower = eta = eta_c\n    B[mask_lower] = 0.0\n    A[mask_lower] = p_top + (eta[mask_lower] / eta_c) * (pc - p_top)\n\n    # Region 2: eta_c  eta = 1\n    mask_upper = eta > eta_c\n    if np.any(mask_upper):\n        term = (eta[mask_upper] - eta_c) / (1 - eta_c)\n        B[mask_upper] = term\n        A[mask_upper] = p_top + (pc - p_top) - pc * term\n\n    A_col = A.reshape(-1, 1)\n    B_col = B.reshape(-1, 1)\n    p_hyb = A_col + B_col * ps_row\n    \n    # --- Geopotential Field Calculation ---\n    # Note: Using np.log(p0) - np.log(p) is more stable than np.log(p0/p)\n    # but the problem statement implies the latter. Given inputs are safe.\n    phi_sigma = H * g * np.log(p0 / p_sigma)\n    phi_hyb = H * g * np.log(p0 / p_hyb)\n\n    # --- Acceleration Error Calculation ---\n    # Central difference on interior points\n    a_sigma = -(phi_sigma[:, 2:] - phi_sigma[:, :-2]) / (2 * delta_x)\n    a_hyb = -(phi_hyb[:, 2:] - phi_hyb[:, :-2]) / (2 * delta_x)\n\n    # --- RMS Error Calculation ---\n    E_sigma = np.sqrt(np.mean(a_sigma**2))\n    E_hyb = np.sqrt(np.mean(a_hyb**2))\n\n    # --- Ratio Calculation with special case handling ---\n    zero_tol = 1e-15\n    if E_sigma  zero_tol:\n        if E_hyb  zero_tol:\n            return 0.0\n        else:\n            return 1e9\n    else:\n        return E_hyb / E_sigma\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h0, w, delta_x, eta_c, p_top)\n        (1500, 20000, 2000, 0.7, 10000),  # 1. Happy-path moderate mountain\n        (0, 20000, 2000, 0.7, 10000),     # 2. Flat terrain boundary case\n        (2500, 10000, 1000, 0.7, 10000),  # 3. Steep and narrow ridge\n        (1500, 20000, 2000, 0.95, 10000), # 4. Transition very close to surface\n        (1500, 20000, 2000, 0.15, 10000), # 5. Transition close to top\n        (1500, 20000, 2000, 0.7, 30000),  # 6. Higher model top pressure\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_r(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}