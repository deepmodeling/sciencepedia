{
    "hands_on_practices": [
        {
            "introduction": "在对运动方程进行离散化之前，我们必须首先掌握其背后的热力学原理。本练习旨在巩固理想气体的基本关系——状态方程和内能定义，它们是任何可压缩模型热力学闭包的基石。通过这个练习，你将计算一个控制单元内的基本热力学量，并揭示它们之间的一个重要无量纲关系。",
            "id": "4046732",
            "problem": "在用于数值天气预报 (NWP) 的完全可压缩欧拉方程的守恒型有限体积离散化中，考虑给定时间步长的单个控制体积。网格平均密度为 $\\rho = 1.2\\ \\mathrm{kg\\,m^{-3}}$，网格平均温度为 $T = 290\\ \\mathrm{K}$。流体被建模为理想气体，其比气体常数为 $R = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，比热比为 $\\gamma = 1.4$。仅使用理想气体的基本关系，即理想气体状态方程和理想气体内能密度的定义，按以下步骤进行：\n\n1. 从第一性原理出发，写出连接压力、密度、温度和比气体常数的理想气体关系式。用它来计算网格平均压力 $p$。\n2. 使用连接定容比热和比热比的理想气体热力学恒等式，用 $R$ 和 $\\gamma$ 表示定容比热 $c_v$。然后根据其涉及 $\\rho$、$c_v$ 和 $T$ 的基本定义，确定控制体积中的内能密度 $e$。\n3. 证明对于理想气体，比值 $e/p$ 仅依赖于 $\\gamma$，并对给定的 $\\gamma$ 值进行数值计算。\n\n最终答案请提供无量纲比值 $e/p$ 的单一数值。将最终数值表示为精确小数，无需四舍五入。",
            "solution": "问题陈述已经过严格审查，并被认定是有效的。它在科学上基于理想气体的热力学原理，问题提法得当，数据充分且一致，表述客观。现在我将按照指定的步骤给出一个完整的解答。\n\n给定的参数如下：\n- 网格平均密度: $\\rho = 1.2\\ \\mathrm{kg\\,m^{-3}}$\n- 网格平均温度: $T = 290\\ \\mathrm{K}$\n- 比气体常数: $R = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n- 比热比: $\\gamma = 1.4$\n\n流体被视为理想气体。\n\n**步骤1：计算压力 ($p$)**\n\n从第一性原理出发，理想气体状态方程通过比气体常数 ($R$) 将压力 ($p$)、密度 ($\\rho$) 和温度 ($T$) 联系起来。该方程为：\n$$p = \\rho R T$$\n代入给定的数值：\n$$p = (1.2\\ \\mathrm{kg\\,m^{-3}}) \\times (287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}) \\times (290\\ \\mathrm{K})$$\n这些值的乘积给出了网格平均压力：\n$$p = 99912\\ \\mathrm{J\\,m^{-3}} = 99912\\ \\mathrm{Pa}$$\n\n**步骤2：计算内能密度 ($e$)**\n\n首先，我们确定定容比热 $c_v$。对于量热完全理想气体，定压比热 ($c_p$) 和定容比热 ($c_v$) 通过迈耶关系式与比气体常数 ($R$) 相关联：\n$$c_p - c_v = R$$\n比热比 $\\gamma$ 定义为：\n$$\\gamma = \\frac{c_p}{c_v}$$\n根据这个定义，我们可以将 $c_p$ 表示为 $c_p = \\gamma c_v$。将其代入迈耶关系式得到：\n$$\\gamma c_v - c_v = R$$\n提取公因子 $c_v$：\n$$c_v(\\gamma - 1) = R$$\n求解 $c_v$，我们得到所需表达式：\n$$c_v = \\frac{R}{\\gamma - 1}$$\n现在，我们确定内能密度 $e$。对于理想气体，比内能（单位质量的内能）$u$ 由 $u = c_v T$ 给出。内能密度 $e$ 是单位体积的内能，通过将比内能乘以密度得到：\n$$e = \\rho u = \\rho c_v T$$\n代入我们推导出的 $c_v$ 表达式：\n$$e = \\rho \\left( \\frac{R}{\\gamma - 1} \\right) T$$\n首先使用给定的数值计算 $c_v$：\n$$c_v = \\frac{287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}}{1.4 - 1} = \\frac{287}{0.4}\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}} = 717.5\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$$\n现在，我们可以计算内能密度 $e$：\n$$e = (1.2\\ \\mathrm{kg\\,m^{-3}}) \\times (717.5\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}) \\times (290\\ \\mathrm{K})$$\n$$e = 249690\\ \\mathrm{J\\,m^{-3}}$$\n\n**步骤3：推导和计算比值 $e/p$**\n\n问题要求证明比值 $e/p$ 仅依赖于 $\\gamma$。我们使用前面步骤中推导出的 $p$ 和 $e$ 的符号表达式：\n$$p = \\rho R T$$\n$$e = \\frac{\\rho R T}{\\gamma - 1}$$\n现在，我们计算这两个量的比值：\n$$\\frac{e}{p} = \\frac{\\left( \\frac{\\rho R T}{\\gamma - 1} \\right)}{\\rho R T}$$\n项 $\\rho$、$R$ 和 $T$ 同时出现在分子和分母中，并且由于 $\\rho \\neq 0$、$R \\neq 0$ 和 $T \\neq 0$，我们可以将它们消去：\n$$\\frac{e}{p} = \\frac{1}{\\gamma - 1}$$\n这个结果证实了对于理想气体，内能密度与压力的比值仅是比热比 $\\gamma$ 的函数。\n\n最后，我们使用给定的 $\\gamma = 1.4$ 值来数值计算这个比值：\n$$\\frac{e}{p} = \\frac{1}{1.4 - 1} = \\frac{1}{0.4}$$\n最终的数值是一个精确小数：\n$$\\frac{e}{p} = 2.5$$\n作为一致性检验，我们也可以使用我们计算出的 $p$ 和 $e$ 的数值来计算该比值：\n$$\\frac{e}{p} = \\frac{249690\\ \\mathrm{J\\,m^{-3}}}{99912\\ \\mathrm{J\\,m^{-3}}} = 2.5$$\n结果是一致的。该无量纲比值为 $2.5$。",
            "answer": "$$\\boxed{2.5}$$"
        },
        {
            "introduction": "守恒离散化的核心在于将守恒定律的积分形式应用于网格单元。本练习提供了一个具体的例子，演示了如何根据跨越边界的质量通量来计算单元平均密度的变化。这直接阐明了有限体积法的核心思想：单元内守恒量的变化完全由边界通量决定。",
            "id": "4046725",
            "problem": "考虑欧拉系统的完全可压缩连续性方程，\n$$\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\boldsymbol{u}) = 0,$$\n及其通过在矩形单元上积分并应用散度定理得到的控制体形式。在一个维度为 $\\Delta x \\times \\Delta y$、平面外方向深度为单位长度的二维矩形单元上使用有限体积法（FVM），在每个面上采用向外的单位法线约定，并令 $u_{n,f}$ 表示在面 $f$ 上的面法向速度分量（当指向外部时为正）。假设在某一瞬间，单元平均密度 $\\overline{\\rho}$ 和所有面法向速度在其各自的面上是空间均匀的。推导 $\\partial_t \\overline{\\rho}$ 关于向外面法向质量通量的半离散演化方程，然后根据以下数据进行计算：\n- 单元尺寸：$\\Delta x = 1000\\ \\mathrm{m}$ 和 $\\Delta y = 500\\ \\mathrm{m}$。\n- 单元平均密度：$\\overline{\\rho} = 1.2\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。\n- 东、西、北、南面上的向外面法向速度分别为：$u_{n,E} = +10\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,W} = -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,N} = +2\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,S} = -4\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n这里，东/西面和北/南面的面面积分别为 $A_E = A_W = \\Delta y$ 和 $A_N = A_S = \\Delta x$。首先计算此刻穿过单元边界的净向外质量通量，然后计算由此产生的单元平均密度瞬时变化率 $\\partial_t \\overline{\\rho}$。将您对 $\\partial_t \\overline{\\rho}$ 的最终答案四舍五入到四位有效数字，并以 $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$ 为单位表示。",
            "solution": "该问题陈述科学上合理、自洽且适定。它基于质量守恒基本原理及其使用有限体积法的标准数值处理方法。所有必要数据均已提供，且没有矛盾之处。\n\n起点是微分形式的连续性方程：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\boldsymbol{u}) = 0\n$$\n其中 $\\rho$ 是流体密度，$\\boldsymbol{u}$ 是速度矢量。对于有限体积法，该方程在一个控制体积 $V$ 上积分，在本例中是一个二维矩形单元，其体积为 $V = \\Delta x \\Delta y \\cdot 1$。\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\,dV + \\int_V \\nabla \\cdot (\\rho \\boldsymbol{u}) \\,dV = 0\n$$\n对第二项应用散度定理，将散度的体积分转换为通量在体积 $V$ 边界 $S$ 上的面积分：\n$$\n\\int_V \\nabla \\cdot (\\rho \\boldsymbol{u}) \\,dV = \\oint_S (\\rho \\boldsymbol{u}) \\cdot \\boldsymbol{n} \\,dS\n$$\n其中 $\\boldsymbol{n}$ 是表面 $S$ 上指向外部的单位法向量。\n\n单元平均密度 $\\overline{\\rho}$ 定义为单元内的总质量除以单元体积：\n$$\n\\overline{\\rho} = \\frac{1}{V} \\int_V \\rho \\,dV\n$$\n假设控制体积 $V$ 不随时间变化，时间导数可以移到积分符号外面：\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\,dV = \\frac{d}{dt} \\int_V \\rho \\,dV = \\frac{d}{dt} (\\overline{\\rho} V) = V \\frac{d\\overline{\\rho}}{dt}\n$$\n将这些结果代回到积分形式的连续性方程中，得到控制体积的精确守恒律：\n$$\nV \\frac{d\\overline{\\rho}}{dt} + \\oint_S (\\rho \\boldsymbol{u}) \\cdot \\boldsymbol{n} \\,dS = 0\n$$\n该方程表明，体积内质量的变化率等于进入该体积的净质量通量。\n\n通过对矩形单元的四个面（东（$E$）、西（$W$）、北（$N$）和南（$S$））上的通量求和，来离散化面积分。\n$$\n\\oint_S (\\rho \\boldsymbol{u}) \\cdot \\boldsymbol{n} \\,dS = \\sum_{f \\in \\{E,W,N,S\\}} \\int_{A_f} (\\rho \\boldsymbol{u}) \\cdot \\boldsymbol{n}_f \\,dS_f\n$$\n问题将 $u_{n,f} = \\boldsymbol{u} \\cdot \\boldsymbol{n}_f$ 定义为面 $f$ 上的向外法向速度，并假设其在该面上是均匀的。因此，通过面 $f$ 的通量为 $\\int_{A_f} \\rho u_{n,f} \\,dS_f = u_{n,f} \\int_{A_f} \\rho \\,dS_f$。一个简单的一阶近似是使用单元平均密度 $\\overline{\\rho}$作为面上的密度。据此，通过面 $f$ 的通量近似为 $\\overline{\\rho} u_{n,f} A_f$，其中 $A_f$ 是面的面积。\n\n单元平均密度的半离散方程变为：\n$$\nV \\frac{\\partial \\overline{\\rho}}{\\partial t} \\approx - \\sum_{f \\in \\{E,W,N,S\\}} \\overline{\\rho} u_{n,f} A_f\n$$\n$$\n\\frac{\\partial \\overline{\\rho}}{\\partial t} \\approx -\\frac{\\overline{\\rho}}{V} \\sum_{f \\in \\{E,W,N,S\\}} u_{n,f} A_f\n$$\n项 $\\Phi_{net} = \\overline{\\rho} \\sum u_{n,f} A_f$ 是净向外质量通量。\n\n我们有以下给定数据：\n- 单元尺寸：$\\Delta x = 1000\\ \\mathrm{m}$ 和 $\\Delta y = 500\\ \\mathrm{m}$。\n- 单元平均密度：$\\overline{\\rho} = 1.2\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$。\n- 向外面法向速度：$u_{n,E} = +10\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,W} = -5\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,N} = +2\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，$u_{n,S} = -4\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n面面积和单元体积（对于单位深度）为：\n- $A_E = A_W = \\Delta y \\times 1 = 500\\ \\mathrm{m}^2$。\n- $A_N = A_S = \\Delta x \\times 1 = 1000\\ \\mathrm{m}^2$。\n- $V = \\Delta x \\times \\Delta y \\times 1 = 1000\\ \\mathrm{m} \\times 500\\ \\mathrm{m} = 5 \\times 10^5\\ \\mathrm{m}^3$。\n\n首先，我们计算净向外质量通量 $\\Phi_{net}$：\n$$\n\\Phi_{net} = \\overline{\\rho} (u_{n,E}A_E + u_{n,W}A_W + u_{n,N}A_N + u_{n,S}A_S)\n$$\n代入数值：\n$$\n\\Phi_{net} = (1.2\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}) [(10\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(500\\ \\mathrm{m}^2) + (-5\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(500\\ \\mathrm{m}^2) + (2\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(1000\\ \\mathrm{m}^2) + (-4\\ \\mathrm{m}\\ \\mathrm{s}^{-1})(1000\\ \\mathrm{m}^2)]\n$$\n$$\n\\Phi_{net} = 1.2 \\times [5000 - 2500 + 2000 - 4000] \\ \\mathrm{kg}\\ \\mathrm{s}^{-1}\n$$\n$$\n\\Phi_{net} = 1.2 \\times [500] \\ \\mathrm{kg}\\ \\mathrm{s}^{-1} = 600\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}\n$$\n净向外质量通量为 $600\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$。\n\n接下来，我们计算单元平均密度的瞬时变化率 $\\partial_t \\overline{\\rho}$：\n$$\n\\frac{\\partial \\overline{\\rho}}{\\partial t} = -\\frac{\\Phi_{net}}{V}\n$$\n$$\n\\frac{\\partial \\overline{\\rho}}{\\partial t} = -\\frac{600\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}}{5 \\times 10^5\\ \\mathrm{m}^3} = -0.0012\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}\n$$\n问题要求将此答案四舍五入到四位有效数字。精确答案是 $-0.0012$。用四位有效数字表示，即为 $-0.001200$。用标准科学记数法表示，即为 $-1.200 \\times 10^{-3}$。",
            "answer": "$$\n\\boxed{-1.200 \\times 10^{-3}}\n$$"
        },
        {
            "introduction": "在真实场景中（例如在复杂地形上）应用守恒格式会引入一些微小但影响显著的误差。这项高级练习要求你实现并比较两种计算压力梯度力的方法。它将揭示一个朴素的离散化方法如何在地形上产生虚假的加速度，以及一个“精确平衡”的格式如何能够缓解这个大气模型中的关键问题。",
            "id": "4046693",
            "problem": "考虑一个二维、干燥、完全可压缩的大气，它在一个底边界高程随水平位置变化的地形上处于静力平衡状态。流体处于静止状态，静力平衡由基本定律 $dp/dz = - \\rho g$ 给出，其中 $p$ 是压力（单位：$\\mathrm{Pa}$），$\\rho$ 是密度（单位：$\\mathrm{kg\\,m^{-3}}$），$z$ 是几何高度（单位：$\\mathrm{m}$），$g$ 是重力加速度（单位：$\\mathrm{m\\,s^{-2}}$）。假设为等温理想气体，其温度 $T$ 和气体常数 $R$ 恒定，因此 $p(z) = p_0 \\exp(-z/H)$ 且 $\\rho(z) = \\rho_0 \\exp(-z/H)$，其中 $H = RT/g$ 是压力标高，$p_0$ 是海平面压力，$\\rho_0 = p_0/(RT)$ 是海平面密度。水平域在 $x$ 方向上是周期的，长度为 $L_x$。\n\n设地形跟随垂直坐标定义为 $\\sigma \\in [0,1]$，其到几何高度的映射关系为\n$$\nz(x,\\sigma) = z_b(x) + \\sigma \\left( z_\\mathrm{top} - z_b(x) \\right),\n$$\n其中 $z_b(x)$ 是底边界高程，$z_\\mathrm{top}$ 是恒定的顶部高度。底部由余弦山丘给出\n$$\nz_b(x) = A \\cos\\!\\left( \\frac{2\\pi x}{L_x} \\right),\n$$\n其振幅为 $A$（单位：$\\mathrm{m}$）。计算网格由 $N_x$ 个均匀分布的水平点 $x_i = i \\Delta x$（$i \\in \\{0,\\dots,N_x-1\\}$，$\\Delta x = L_x/N_x$）和 $N_z$ 个均匀分布的 $\\sigma$ 整层 $\\sigma_j = (j + 1/2)/N_z$（$j \\in \\{0,\\dots,N_z-1\\}$）组成。\n\n通过在网格点上采样 $p$ 和 $\\rho$ 来定义离散静力基态：$p_{i,j} = p\\!\\left( z(x_i,\\sigma_j) \\right)$ 和 $\\rho_{i,j} = \\rho\\!\\left( z(x_i,\\sigma_j) \\right)$。考虑由气压梯度力（PGF）引起的离散水平加速度，在物理坐标系中为 $a_x = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}$。\n\n您的任务是，对于以下每个测试用例，计算两种不同离散格式在整个网格上的最大范数残差加速度 $R$（单位：$\\mathrm{m\\,s^{-2}}$）：\n\n1. 一种朴素的、非良态平衡的格式，它使用中心有限差分在恒定 $\\sigma$ 上近似 PGF，\n$$\na_{x,\\mathrm{naive}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x},\n$$\n其中 $i$ 方向采用周期性索引。残差 $R_\\mathrm{naive}$ 定义为\n$$\nR_\\mathrm{naive} = \\max_{i,j} \\left| a_{x,\\mathrm{naive}}(i,j) \\right|.\n$$\n\n2. 一种良态平衡的、高度插值的格式，它在恒定几何高度上近似 PGF。对于每个 $(i,j)$，令 $z_{i,j} = z(x_i,\\sigma_j)$。根据 $i-1$ 和 $i+1$ 列的采样点对 $\\{(z_{k}, p_{k})\\}$，构建这些列中 $p$ 作为 $z$ 函数的廓线的线性插值。在目标高度 $z_{i,j}$ 处评估这些插值，以获得 $p_{i-1 \\rightarrow i}(z_{i,j})$ 和 $p_{i+1 \\rightarrow i}(z_{i,j})$，即通过在 $z$ 方向上的线性插值将 $i-1$ 和 $i+1$ 列中的压力映射到高度 $z_{i,j}$。当 $z_{i,j}$ 位于相邻列的采样范围之外时，允许线性外插。然后定义\n$$\na_{x,\\mathrm{wb}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1 \\rightarrow i}(z_{i,j}) - p_{i-1 \\rightarrow i}(z_{i,j})}{2\\Delta x},\n$$\n和\n$$\nR_\\mathrm{wb} = \\max_{i,j} \\left| a_{x,\\mathrm{wb}}(i,j) \\right|.\n$$\n\n对于每个测试用例，计算误差缩减因子\n$$\n\\mathcal{Q} = \n\\begin{cases}\nR_\\mathrm{naive} / R_\\mathrm{wb},  \\text{if } R_\\mathrm{wb} > 0,\\\\\n1.0,  \\text{if } R_\\mathrm{wb} = 0,\n\\end{cases}\n$$\n它是一个无量纲浮点数。\n\n所有物理常数和参数必须使用国际单位制（SI 单位）。使用 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$，$R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$T = 280\\,\\mathrm{K}$，$p_0 = 10^5\\,\\mathrm{Pa}$。顶部高度为 $z_\\mathrm{top} = 12000\\,\\mathrm{m}$。以下测试套件指定了四个用例的其余参数：\n- 用例 1（平坦地形基线）：$L_x = 100000\\,\\mathrm{m}$，$N_x = 64$，$N_z = 40$，$A = 0\\,\\mathrm{m}$。\n- 用例 2（中等坡度）：$L_x = 100000\\,\\mathrm{m}$，$N_x = 64$，$N_z = 40$，$A = 1000\\,\\mathrm{m}$。\n- 用例 3（更陡峭的地形，更粗的垂直网格）：$L_x = 50000\\,\\mathrm{m}$，$N_x = 64$，$N_z = 20$，$A = 2000\\,\\mathrm{m}$。\n- 用例 4（更陡峭的地形，更细的垂直网格）：$L_x = 50000\\,\\mathrm{m}$，$N_x = 64$，$N_z = 80$，$A = 2000\\,\\mathrm{m}$。\n\n您的程序必须为每个用例计算三元组 $(R_\\mathrm{naive}, R_\\mathrm{wb}, \\mathcal{Q})$（其中 $R_\\mathrm{naive}$ 和 $R_\\mathrm{wb}$ 的单位为 $\\mathrm{m\\,s^{-2}}$，$\\mathcal{Q}$ 无量纲），然后打印一行，其中包含所有十二个结果，格式为用方括号括起来的、以逗号分隔的浮点数列表，结果按用例排序，且在每个用例中按 $(R_\\mathrm{naive}, R_\\mathrm{wb}, \\mathcal{Q})$ 的顺序排列。每个浮点数必须四舍五入到六位有效数字。例如，输出格式必须是\n$[r_{1,\\mathrm{naive}},r_{1,\\mathrm{wb}},q_1,r_{2,\\mathrm{naive}},r_{2,\\mathrm{wb}},q_2,r_{3,\\mathrm{naive}},r_{3,\\mathrm{wb}},q_3,r_{4,\\mathrm{naive}},r_{4,\\mathrm{wb}},q_4]$,\n其中每个 $r$ 的单位为 $\\mathrm{m\\,s^{-2}}$，每个 $q$ 无量纲，且均为十进制浮点数。",
            "solution": "这个问题的核心挑战是量化在地形跟随坐标系中计算水平气压梯度力 (PGF) 时产生的数值误差，并证明良态平衡离散化格式相对于朴素格式的优越精度。物理情景是一个处于完美静力平衡的静止大气，在这种情况下，真实的水平加速度完全为零。因此，任何由数值格式计算出的非零加速度都纯粹是离散化误差的结果。\n\n$x$ 方向上的连续水平 PGF 由下式给出\n$$\na_x = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}\n$$\n在一个静止的静力平衡大气中，压力 $p$ 仅仅是几何高度 $z$ 的函数，即 $p = p(z)$。因此，在恒定高度 $z$ 上，压力相对于水平坐标 $x$ 的偏导数为零：\n$$\n\\left( \\frac{\\partial p}{\\partial x} \\right)_z = 0\n$$\n这意味着真实的水平加速度 $a_x$ 在任何地方都恒等于零。因此，该问题要求计算由数值方法产生的虚假加速度。\n\n首先，我们建立计算域和物理状态。物理常数为重力加速度 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$、干空气比气体常数 $R = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$、恒定温度 $T = 280\\,\\mathrm{K}$ 和海平面压力 $p_0 = 10^5\\,\\mathrm{Pa}$。由此，我们推导出压力标高 $H = RT/g$ 和海平面密度 $\\rho_0 = p_0/(RT)$。静力压力和密度廓线由以下指数函数给出：\n$$\np(z) = p_0 \\exp(-z/H)\n$$\n$$\n\\rho(z) = \\rho_0 \\exp(-z/H)\n$$\n计算网格定义在一个长度为 $L_x$ 的水平域和一个延伸至高度 $z_\\mathrm{top} = 12000\\,\\mathrm{m}$ 的垂直域上。水平网格有 $N_x$ 个点 $x_i = i \\Delta x$（$i \\in \\{0, \\dots, N_x-1\\}$），其中 $\\Delta x = L_x/N_x$。垂直方向使用地形跟随坐标 $\\sigma \\in [0,1]$ 进行离散化，有 $N_z$ 个层，位于 $\\sigma_j = (j + 0.5)/N_z$（$j \\in \\{0, \\dots, N_z-1\\}$）。每个网格点 $(i,j)$ 处的几何高度 $z$ 由以下映射确定：\n$$\nz(x_i, \\sigma_j) = z_b(x_i) + \\sigma_j (z_\\mathrm{top} - z_b(x_i))\n$$\n其中地形高度 $z_b(x)$ 由一个振幅为 $A$ 的余弦山丘给出：\n$$\nz_b(x_i) = A \\cos\\left( \\frac{2\\pi x_i}{L_x} \\right)\n$$\n使用这个 $z_{i,j}$ 值的网格，我们对连续的压力和密度场进行采样，以获得离散基态数组 $p_{i,j} = p(z_{i,j})$ 和 $\\rho_{i,j} = \\rho(z_{i,j})$。\n\n任务的核心是计算两种不同 PGF 格式的最大残差加速度。\n\n1.  **朴素的、非良态平衡的格式**\n    该方法在恒定的 $\\sigma$ 层上近似气压梯度。偏导数 $(\\partial p / \\partial x)$ 使用沿恒定 $j$ 网格线的中心有限差分进行近似：\n    $$\n    a_{x,\\mathrm{naive}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\n    $$\n    水平索引 $i+1$ 和 $i-1$ 采用周期性处理。当地形不平坦时 ($A > 0$)，恒定 $\\sigma_j$ 的表面不是恒定几何高度 $z$ 的表面。因此，$z_{i+1,j} \\neq z_{i-1,j}$，导致 $p_{i+1,j} \\neq p_{i-1,j}$。这会导致一个非零的、虚假的 PGF，这是地形跟随模型中一个众所周知的误差源。残差是这个虚假加速度在整个网格上的最大绝对值：$R_\\mathrm{naive} = \\max_{i,j} |a_{x,\\mathrm{naive}}(i,j)|$。\n\n2.  **良态平衡的、高度插值的格式**\n    这种方法被设计成“良态平衡的”，意味着它可以精确或高精度地平衡 PGF 和重力项，以维持静止状态。它在恒定几何高度面上正确地近似 PGF，即 $(\\partial p / \\partial x)_z$。为在网格点 $(i,j)$ 实现这一点，我们必须估算相邻列 $i-1$ 和 $i+1$ 中与点 $(i,j)$ 相同几何高度（即 $z_{i,j} = z(x_i, \\sigma_j)$）处的压力。\n    步骤如下：\n    -   对于每个网格点 $(i,j)$，确定目标高度 $z_{i,j}$。\n    -   在相邻的列 $i-1$ 和 $i+1$ 中（采用周期性索引），我们有压力相对于高度的离散垂直廓线，即点对集合 $\\{ (z_{i-1,k}, p_{i-1,k}) \\}_{k=0}^{N_z-1}$ 和 $\\{ (z_{i+1,k}, p_{i+1,k}) \\}_{k=0}^{N_z-1}$。\n    -   我们为每个相邻列构建压力作为高度函数的线性插值。由于目标高度 $z_{i,j}$ 可能位于相邻列的高度范围之外（例如，高山旁边的深谷中的一个点），因此按规定允许线性外插。为此，我们使用 SciPy 的 `interp1d` 函数，并设置 `fill_value='extrapolate'`。\n    -   我们在目标高度 $z_{i,j}$ 处评估这两个插值，以获得水平映射的压力 $p_{i-1 \\rightarrow i}(z_{i,j})$ 和 $p_{i+1 \\rightarrow i}(z_{i,j})$。\n    -   良态平衡的 PGF 随之计算如下：\n    $$\n    a_{x,\\mathrm{wb}}(i,j) = -\\frac{1}{\\rho_{i,j}} \\cdot \\frac{p_{i+1 \\rightarrow i}(z_{i,j}) - p_{i-1 \\rightarrow i}(z_{i,j})}{2\\Delta x}\n    $$\n    该格式的残差误差 $R_\\mathrm{wb} = \\max_{i,j} |a_{x,\\mathrm{wb}}(i,j)|$ 源于对指数压力廓线进行线性插值的不准确性。预计该误差将远小于朴素格式的误差。\n\n最后，对于每个测试用例，我们计算误差缩减因子 $\\mathcal{Q}$：\n$$\n\\mathcal{Q} = \n\\begin{cases}\nR_\\mathrm{naive} / R_\\mathrm{wb},  \\text{if } R_\\mathrm{wb} > 0,\\\\\n1.0,  \\text{if } R_\\mathrm{wb} = 0,\n\\end{cases}\n$$\n该因子量化了使用良态平衡格式所带来的改进。对四个指定的测试用例实施整个过程，并将结果格式化为六位有效数字。",
            "answer": "```python\nimport numpy as np\nfrom scipy.interpolate import interp1d\n\ndef solve():\n    \"\"\"\n    Computes the residual pressure gradient force accelerations for naive and\n    well-balanced schemes in a terrain-following coordinate system.\n    \"\"\"\n\n    # Physical constants (SI units)\n    g = 9.81  # m/s^2\n    R_gas = 287.0  # J/(kg*K)\n    T = 280.0  # K\n    p0 = 1.0e5  # Pa\n    z_top = 12000.0  # m\n\n    # Derived constants\n    H = R_gas * T / g  # Pressure scale height\n    rho0 = p0 / (R_gas * T)  # Sea-level density\n\n    # Analytical hydrostatic profiles\n    def p_func(z):\n        return p0 * np.exp(-z / H)\n\n    def rho_func(z):\n        return rho0 * np.exp(-z / H)\n\n    # Test case parameters\n    test_cases = [\n        # (Lx, Nx, Nz, A)\n        (100000.0, 64, 40, 0.0),    # Case 1: Flat terrain\n        (100000.0, 64, 40, 1000.0), # Case 2: Moderate slope\n        (50000.0, 64, 20, 2000.0),  # Case 3: Steeper, coarser grid\n        (50000.0, 64, 80, 2000.0),  # Case 4: Steeper, finer grid\n    ]\n\n    all_results = []\n    \n    for Lx, Nx, Nz, A in test_cases:\n        # 1. Setup Grids\n        dx = Lx / Nx\n        x_i = np.arange(Nx) * dx\n        sigma_j = (np.arange(Nz) + 0.5) / Nz\n\n        # 2. Compute Geometric Heights z(x, sigma)\n        zb_i = A * np.cos(2 * np.pi * x_i / Lx)\n        # Reshape for broadcasting: zb_i (Nx,1), sigma_j (1,Nz)\n        z_grid = zb_i[:, np.newaxis] + sigma_j[np.newaxis, :] * (z_top - zb_i[:, np.newaxis])\n\n        # 3. Sample Hydrostatic State on the Grid\n        p_grid = p_func(z_grid)\n        rho_grid = rho_func(z_grid)\n\n        # 4. Compute Naive PGF Residual (R_naive)\n        p_i_plus_1 = np.roll(p_grid, -1, axis=0)\n        p_i_minus_1 = np.roll(p_grid, 1, axis=0)\n        \n        a_naive = - (1.0 / rho_grid) * (p_i_plus_1 - p_i_minus_1) / (2.0 * dx)\n        R_naive = np.max(np.abs(a_naive))\n\n        # 5. Compute Well-Balanced PGF Residual (R_wb)\n        a_wb = np.zeros_like(p_grid)\n        for i in range(Nx):\n            i_prev = (i - 1 + Nx) % Nx\n            i_next = (i + 1) % Nx\n            \n            # Get neighbor column profiles (z and p)\n            # z-profiles are guaranteed to be monotonic, so sorting is not needed.\n            z_prev_col = z_grid[i_prev, :]\n            p_prev_col = p_grid[i_prev, :]\n            z_next_col = z_grid[i_next, :]\n            p_next_col = p_grid[i_next, :]\n\n            # Create linear interpolators with linear extrapolation\n            interp_prev = interp1d(z_prev_col, p_prev_col, kind='linear', fill_value='extrapolate', assume_sorted=True)\n            interp_next = interp1d(z_next_col, p_next_col, kind='linear', fill_value='extrapolate', assume_sorted=True)\n            \n            for j in range(Nz):\n                z_target = z_grid[i, j]\n                \n                # Interpolate neighbor pressures to target height\n                p_interp_prev = interp_prev(z_target)\n                p_interp_next = interp_next(z_target)\n                \n                a_wb[i, j] = - (1.0 / rho_grid[i, j]) * (p_interp_next - p_interp_prev) / (2.0 * dx)\n\n        R_wb = np.max(np.abs(a_wb))\n\n        # 6. Compute Error Reduction Factor (Q)\n        if R_wb > 0:\n            Q = R_naive / R_wb\n        else:\n            Q = 1.0\n\n        all_results.extend([R_naive, R_wb, Q])\n\n    # 7. Format and print output\n    # Format each float to 6 significant digits as a string\n    formatted_results = [f\"{v:.6g}\" for v in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}