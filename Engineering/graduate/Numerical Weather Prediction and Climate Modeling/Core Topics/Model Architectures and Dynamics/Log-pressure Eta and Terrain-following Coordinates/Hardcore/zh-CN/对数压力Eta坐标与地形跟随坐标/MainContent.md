## 引言
在[数值天气预报](@entry_id:191656)与气候模拟领域，对大气垂直结构的精确刻画是决定模型成败的关键因素。选择一个合适的[垂直坐标系](@entry_id:1133787)，不仅是一项数学上的权衡，更直接影响着模型对物理过程的描述能力和数值计算的稳定性。然而，地球表面复杂多变的地形给简单的坐标系（如几何高度或纯压强坐标）带来了巨大的挑战，迫使科学家们发展出更为精巧的解决方案。本文旨在系统性地梳理和剖析这些方案，特别是围绕对数-压强Eta与地形追随坐标的设计哲学与实践应用。

在接下来的内容中，读者将踏上一段从理论到实践的旅程。第一章“原理与机制”将深入剖析压强坐标、地形追随坐标（Sigma坐标）及现代[混合坐标](@entry_id:1126228)（[Eta坐标](@entry_id:1124664)）的数学构造与物理内涵，揭示它们各自的优势与内在的数值挑战。第二章“应用与交叉学科联系”将探讨这些坐标系在实际模型中的应用，如边界条件处理、梯度计算误差修正，并展示其与气候模拟、海洋学等领域的交叉联系。最后，在“动手实践”部分，我们将通过具体的计算问题，巩固对坐标变换和离散化方案的理解，将理论知识转化为可操作的技能。

## 原理与机制

在[数值天气预报](@entry_id:191656)（NWP）和气候模型中，对大气垂直结构的精确描述至关重要。继引言部分概述了垂直坐标选择的重要性之后，本章将深入探讨几种关键[垂直坐标系](@entry_id:1133787)统的基本原理、数学构造及其在实际应用中的机制与挑战。我们将从压强坐标系的基础优势出发，逐步过渡到为解决复杂地形问题而设计的地形追随坐标系，并最终阐释旨在兼顾两方面优势的现代[混合坐标系](@entry_id:1126230)。

### 作为垂直坐标的压强：[静力平衡](@entry_id:163498)的简化

在构建大气模型时，一个核心的简化是**[静力平衡](@entry_id:163498)假设**（hydrostatic balance assumption），它描述了重力与垂直压强[梯度力](@entry_id:166847)之间的平衡。该假设在天气尺度和气候尺度的大多数运动中都具有高度的准确性。[静力平衡](@entry_id:163498)方程通常写作：

$$
\frac{\partial p}{\partial z} = -\rho g
$$

其中，$p$ 是压强，$z$ 是几何高度，$\rho$ 是空气密度，$g$ 是[重力加速度](@entry_id:173411)。

这个简单的关系为我们提供了一个强有力的工具。考虑任意两个压强面 $p_1$ 和 $p_2$ 之间单位面积气柱的质量 $m$。通过对密度进行积分得到：

$$
m = \int_{z_1}^{z_2} \rho \, dz
$$

利用[静力平衡](@entry_id:163498)关系 $dz = -dp/(\rho g)$，我们可以将积分变量从高度 $z$ 变换为压强 $p$：

$$
m = \int_{p_1}^{p_2} \rho \left(-\frac{dp}{\rho g}\right) = -\frac{1}{g} \int_{p_1}^{p_2} dp = \frac{p_1 - p_2}{g}
$$

这一结果揭示了一个深刻的性质：在[静力平衡](@entry_id:163498)大气中，任意两个压强面之间的空气质量仅由这两个面的压强差决定。这使得压强成为一种天然的“质量坐标”。

将压强作为垂直坐标，而不是几何高度，为[原始方程](@entry_id:1130162)组的简化带来了巨大好处。其中最显著的简化体现在质量守恒（或连续性）方程中。在几何高度坐标系 $(x, y, z)$ 中，[连续性方程](@entry_id:195013)包含密度 $\rho$ 的时间倾向项和[通量散度](@entry_id:1125154)项。然而，当变换到压强坐标系 $(x, y, p)$ 后，对于静力大气，[连续性方程](@entry_id:195013)可以简化为一种异常简洁的形式：

$$
\left(\frac{\partial u}{\partial x}\right)_p + \left(\frac{\partial v}{\partial y}\right)_p + \frac{\partial \omega}{\partial p} = 0
$$

其中 $u$ 和 $v$ 是水平风速，$\omega = Dp/Dt$ 是压强坐标系中的“垂直”速度。请注意，密度 $\rho$ 在此方程中完全消失了。这使得密度不再是一个需要预报的独立变量，而可以根据压强和温度通过[理想气体状态方程](@entry_id:137803)诊断得出。这一简化是早期静力[原始方程模型](@entry_id:1130163)普遍采用压强坐标系的关键动机之一。

### 对数-压强坐标的几何解释

虽然压强坐标在数学上非常便利，但它与我们对“高度”的直观感受相去甚远。为了构建一种更像高度的坐标，同时保留压强坐标的优点，**对数-压强坐标**（log-pressure coordinate）应运而生。一种常见的定义是：

$$
l = \ln\left(\frac{p_0}{p}\right)
$$

其中 $p_0$ 是一个常数参考压强，通常取为平均海平面气压（如 $1000 \, \mathrm{hPa}$）。在这个坐标系中，$l$ 随着高度的增加而增加，这与几何高度 $z$ 的行为一致。

对数-压强坐标的一个核心优势在于它与几何高度 $z$ 的关系。我们可以从[静力平衡](@entry_id:163498)方程和[理想气体状态方程](@entry_id:137803) $p = \rho R T$ 出发推导这一关系。首先，结合这两个方程消去密度 $\rho$：

$$
\frac{\partial p}{\partial z} = -\frac{p g}{R T}
$$

其中 $R$ 是气体常数，$T$ 是温度。为了找到 $z$ 和 $l$ 之间的关系，我们利用[链式法则](@entry_id:190743)：

$$
\frac{\partial z}{\partial l} = \frac{\partial z}{\partial p} \frac{\partial p}{\partial l}
$$

从静力关系中，我们得到 $\frac{\partial z}{\partial p} = -\frac{R T}{g p}$。从对数-压强坐标的定义 $l = \ln(p_0) - \ln(p)$，我们得到 $\frac{dl}{dp} = -\frac{1}{p}$，因此 $\frac{dp}{dl} = -p$。代入[链式法则](@entry_id:190743)，我们得到一个极为简洁和重要的关系式：

$$
\frac{\partial z}{\partial l} = \left(-\frac{R T}{g p}\right)(-p) = \frac{R T}{g}
$$

这个方程被称为**测高方程**（hypsometric equation）在对数-压强坐标下的微分形式。它表明，对数-压强坐标的变化率与几何高度的变化率成正比，比例因子是 $\frac{R T}{g}$。

特别地，如果考虑一个**[等温大气](@entry_id:203207)层**（isothermal layer），即温度 $T$ 为常数，则上式变为 $\partial z = H \partial l$，其中 $H = RT/g$ 是**[标高](@entry_id:263754)**（scale height）。积分该式可得 $z - z_{\text{ref}} = H(l - l_{\text{ref}})$。这表明，在[等温大气](@entry_id:203207)中，几何高度 $z$ 和对数-压强坐标 $l$ 之间存在线性关系。这意味着，在 $l$ 坐标中等间距的垂直层次对应于在 $z$ 坐标中等间距的几何厚度。由于中层大气（平流层和中间层）的温度廓线变化相对平缓，这一特性使得对数-压强坐标在专注于这些区域的模型中尤为适用。

我们可以利用这个关系来计算任意两个压强面之间的几何厚度 $\Delta z$。通过对 $dz$ 进行积分，我们得到：

$$
\Delta z = z_2 - z_1 = \int_{l_1}^{l_2} \frac{R T(l)}{g} dl
$$

例如，给定一个随 $l$ 变化的温度廓线 $T(l)$，如 $T(l) = T_{0} - \lambda l + \mu l^{2}$，我们可以通[过积分](@entry_id:753033)计算出 $p_1=800 \, \mathrm{hPa}$ 和 $p_2=400 \, \mathrm{hPa}$ 之间的厚度。首先计算对应的 $l_1 = \ln(1000/800)$ 和 $l_2 = \ln(1000/400)$，然后代入积分表达式即可求得精确的几何厚度，这在实际[模型诊断](@entry_id:136895)和分析中是一项常规计算。

### 地形追随坐标：Sigma ($\sigma$) 坐标系统

尽管压强坐标系在数学上很优雅，但它和纯几何高度坐标系一样，面临着如何处理地表边界的难题。地球表面并非一个等压面，其压强 $p_s(x,y,t)$ 随地点和时间而变化。这意味着模型的下边界（即地形）会穿插切割等压坐标面，造成复杂的下边界条件。

为了解决这个问题，[气象学](@entry_id:264031)家 Phillips 于1957年提出了**地形追随坐标**（terrain-following coordinate）的概念，其中最经典的是 **sigma ($\sigma$) 坐标**。其定义如下：

$$
\sigma = \frac{p - p_t}{p_s - p_t}
$$

其中 $p_s(x,y,t)$ 是随地形变化的地面气压，$p_t$ 是模型顶部的固定气压（通常为一个很小的值，如 $0 \, \mathrm{Pa}$ 或 $1 \, \mathrm{hPa}$）。

从定义可以看出，$\sigma$ 坐标具有两个关键属性：
1.  在模型顶部，无论身在何处，$p = p_t$，因此 $\sigma = 0$。
2.  在地球表面，无论地形高低，$p = p_s$，因此 $\sigma = 1$。

这样一来，模型的下边界（地球表面）和上边界就都变成了坐标面（$\sigma=1$ 和 $\sigma=0$）。这极大地简化了边界条件的处理，是地形追随坐标系最核心的优势。

我们可以推导在 $\sigma$ 坐标下，几何高度 $z$ 是如何表达的。以一个[等温大气](@entry_id:203207)为例，我们已经知道几何高度与压强的关系是 $z(p) = -\frac{RT}{g} \ln(\frac{p}{p_0})$，其中 $p_0$ 是海平面气压。从 $\sigma$ 的定义中反解出 $p = p_t + \sigma(p_s - p_t)$，并将其代入，即可得到从模型坐标 $(x, \sigma)$ 到物理空间高度 $z$ 的映射关系：

$$
z(x,\sigma) = -\frac{R T}{g} \ln\left(\frac{p_t + \sigma(p_s(x) - p_t)}{p_0}\right)
$$

这个表达式清楚地显示，在给定的 $\sigma$ 层上，几何高度 $z$ 会随着水平位置 $x$ 的变化而变化，因为它依赖于 $p_s(x)$，从而实现了坐标面对地形的追随。

### Sigma 坐标的固有挑战：压强[梯度力](@entry_id:166847)误差

虽然 $\sigma$ 坐标完美地解决了下边界问题，但它引入了一个新的、非常棘手的数值问题，即**压强[梯度力](@entry_id:166847)（PGF）计算误差**。

在几何高度 $z$ 坐标中，水平压强[梯度力](@entry_id:166847)就是等高面上的压强梯度，表达式为 $-\frac{1}{\rho}\nabla_z p$ 或 $-\nabla_z \phi$（其中 $\phi$ 是位势）。这个计算是直接且准确的。

然而，在 $\sigma$ 坐标系中，计算必须在倾斜的 $\sigma$ 面上进行。将 PGF 项从 $z$ 坐标变换到 $\sigma$ 坐标后，它分裂为两个项：

$$
-\nabla_z \phi = -\nabla_\sigma \phi - R T \nabla_\sigma (\ln p_s)
$$

这里的 $\nabla_\sigma$ 表示在常数 $\sigma$ 面上的梯度算子。在平坦地区，$p_s$ 是常数，第二项为零，没有问题。但在陡峭的山区，$p_s$ 随水平位置剧烈变化，导致 $\sigma$ 面也变得非常倾斜。此时，上式右边的两项（位势在 $\sigma$ 面上的梯度和与地面气压梯度相关的项）都会变得非常大，且符号相反。PGF 本身是这两个巨大数值之间的一个微小差值。在离散化的数值模型中，由于[截断误差](@entry_id:140949)的存在，计算这个微小的差值会产生巨大的相对误差。这种误差被称为“虚假”的压强[梯度力](@entry_id:166847)，它可能导致模式产生不符合物理规律的流动，尤其是在山脉上空。

一个常见的误解是，认为 $\sigma$ 坐标通过将计算放在 $\sigma$ 面上来“消除”PGF误差。恰恰相反，$\sigma$ 坐标的倾斜特性是产生这种数值计算困难的根源。$\sigma$ 面并非等压面（除非 $p_s$ 在水平方向上是均匀的），在非等压面上计算 PGF 的内在困难导致了这一问题的产生。

### 现代混合坐标：Eta ($\eta$) 坐标

为了减轻 $\sigma$ 坐标在高层大气中引起的 PGF 误差，同时保留其在近地面层处理地形的优势，研究人员发展出了**混合坐标**（hybrid coordinate）。其中一种广泛使用的形式是 **eta ($\eta$) 坐标**，其压强 $p$ 定义为：

$$
p(\eta) = A(\eta) + B(\eta) p_s
$$

其中，$A(\eta)$ 和 $B(\eta)$ 是预先设定的、只依赖于垂直坐标 $\eta$ 的函数。$\eta$ 通常从模型顶部的约 0 变化到地表的 1。

[混合坐标](@entry_id:1126228)的设计哲学是一种权衡和过渡：
-   **近地面层** (如 $\eta \to 1$)：设计 $A(\eta) \to 0$ 且 $B(\eta) \to 1$。此时 $p(\eta) \approx p_s$，坐标面的行为接近纯粹的 $\sigma$ 坐标，能够很好地贴合地形。
-   **高层大气** (如 $\eta \to 0$)：设计 $B(\eta) \to 0$。此时 $p(\eta) \approx A(\eta)$。由于 $A(\eta)$ 仅是 $\eta$ 的函数，等 $\eta$ 面就近似等于等压面。

通过这种方式，$\eta$ 坐标实现了从近地面的地形追随特性平滑地过渡到高空的纯压强特性。高空的坐标面变得越来越平坦，从而显著减小了 PGF 计算中两个大项的数值，极大地缓解了[截断误差](@entry_id:140949)问题。

为了确保模型顶部是一个固定的压强面 $p_t$，必须对 $A$ 和 $B$ 函数施加特定的边界条件。设模型顶部的坐标为 $\eta_t$，我们要求在这一层上的压强恒为 $p_t$，即 $p(\eta_t) = p_t$。代入定义式：

$$
A(\eta_t) + B(\eta_t) p_s = p_t
$$

由于此等式必须对所有可能的地面气压 $p_s$ 都成立，唯一的可能是 $p_s$ 的系数为零，即 $B(\eta_t) = 0$。将此条件代回，立即得到 $A(\eta_t) = p_t$。因此，确保固定模型顶的充要条件是 $A(\eta_t) = p_t$ 和 $B(\eta_t) = 0$。

### [坐标变换](@entry_id:172727)的几何意义：度量项与[雅可比行列式](@entry_id:137120)

将大气控制方程从物理的 $(x,y,z)$ [坐标系转换](@entry_id:263003)到模型的 $(x,y,\eta)$ 坐标系，需要引入一系列被称为**度量项**（metric terms）的几何因子。这些因子描述了新坐标系的局部拉伸、收缩和倾斜。

其中最基本也是最重要的度量项是[坐标变换](@entry_id:172727)的**雅可比行列式**（Jacobian determinant）：

$$
J = \det\left(\frac{\partial(x,y,z)}{\partial(x,y,\eta)}\right) = \frac{\partial z}{\partial \eta}
$$

在这个变换中，雅可比行列式简化为几何高度 $z$ 对模型垂直坐标 $\eta$ 的偏导数。它的物理意义非常直观：它代表了单位模型坐标间隔 $\Delta \eta=1$ 对应的物理空间中的几何厚度 $\Delta z$。也就是说，$J$ 衡量了模型垂直层次的厚度。

我们可以从第一性原理推导出这个雅可比行列式的表达式。通过一系列基于[静力平衡](@entry_id:163498)和[理想气体定律的推导](@entry_id:263157)，可以得到：

$$
J = \frac{\partial z}{\partial \eta} = -\frac{R T(\eta)}{g} \frac{A'(\eta) p_r + B'(\eta) p_s(x,y)}{A(\eta) p_r + B(\eta) p_s(x,y)}
$$

其中 $A' = dA/d\eta$，$B' = dB/d\eta$，$p_r$ 是一个常数参考压强（在某些混合坐标定义中使用）。这个表达式深刻地揭示了模型层次厚度的物理内涵。它表明，一个模型层的几何厚度不仅取决于当地的温度 $T$（更暖的层次更厚），还与水平位置（通过 $p_s(x,y)$）以及[混合坐标系](@entry_id:1126230)统自身的设计（通过 $A, B$ 及其导数）紧密相关。在地形上方（$p_s$ 较小），模型层会被垂直拉伸，而在海平面上（$p_s$ 较大），模型层会被压缩。这个雅可比项是进行坐标变换和正确计算各种物理量通量的基础，它将抽象的坐标定义与模型的具体物理网格结构联系在了一起。