{
    "hands_on_practices": [
        {
            "introduction": "大气环流的一个显著特征是中高纬度对流层顶附近强劲的西风急流。本练习将探讨驱动这一现象的基本动力学原理——热成风关系。通过从静力平衡和地转平衡出发进行推导，您将亲手计算出南北向的温度梯度如何决定了纬向风在垂直方向上的变化，从而量化理论预测的急流强度。",
            "id": "4013716",
            "problem": "一个大气环流模型（GCM）在满足大尺度平衡假设的条件下，根据解析的温度场诊断出纬向风的垂直切变。考虑一个位于旋转球体上纬度为 $\\phi$ 的中纬度气柱，在所关注的对流层内，经向温度梯度 $\\partial T/\\partial y$ 随高度近似均匀。仅从静力平衡、等压面上的地转平衡和理想气体定律出发，推导一个关于地转纬向风相对于对数压力的垂直导数 $\\partial u_g/\\partial \\ln p$ 的表达式，该表达式应使用经向温度梯度 $\\partial T/\\partial y$、科里奥利参数 $f$ 和干空气比气体常数 $R$ 来表示。然后，在假设层内 $\\partial T/\\partial y$ 不随气压变化的条件下，将此表达式在对流层低层 $p_{\\ell}$ 和对流层高层 $p_u$ 之间进行积分，以根据已知的 $u_g(p_{\\ell})$ 求得 $u_g(p_u)$。\n\n使用以下代表中纬度冬季状态的科学上合理的参数：\n- 纬度 $\\phi = 45^{\\circ}$；在计算三角函数时，将 $\\phi$ 视为角度并转换为弧度。\n- 地球自转角速度 $\\Omega = 7.292\\,1159 \\times 10^{-5}\\,\\mathrm{s}^{-1}$ 和科里奥利参数 $f = 2 \\Omega \\sin \\phi$。\n- 干空气比气体常数 $R = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$。\n- 经向温度梯度 $\\partial T/\\partial y = -6.0\\,\\mathrm{K}$ 每 $1000\\,\\mathrm{km}$，假设在层内不随气压变化（转换为 $\\mathrm{K}\\,\\mathrm{m}^{-1}$）。\n- 低层 $p_{\\ell} = 850\\,\\mathrm{hPa}$，地转纬向风 $u_g(p_{\\ell}) = 8.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$（以东风为正）。\n- 高层 $p_u = 200\\,\\mathrm{hPa}$，观测到的纬向风 $U_{\\mathrm{obs}}(p_u) = 38.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n计算有符号的差异\n$$\\delta \\equiv u_{\\mathrm{TW}}(p_u) - U_{\\mathrm{obs}}(p_u),$$\n其中 $u_{\\mathrm{TW}}(p_u)$ 是通过对您推导的表达式进行垂直积分得到的 $p_u$ 处的热力学预测地转纬向风。将最终差异 $\\delta$ 以米每秒为单位表示，并将答案四舍五入到三位有效数字。",
            "solution": "该问题是有效的，因为它科学地基于大气动力学的基本原理，问题设定良好，数据充分且一致，并以客观、正式的语言表述。它代表了热成风关系的一个标准应用，而热成风关系是动力气象学的基石。\n\n任务是推导地转纬向风垂直切变的表达式，通过对其积分来预测高层风速，并将此预测值与观测值进行比较。推导过程从三个基本原理开始：\n\n1.  **地转平衡**，适用于等压面上的纬向风（$u_g$）：\n    $$u_g = -\\frac{1}{f} \\left(\\frac{\\partial \\Phi}{\\partial y}\\right)_p$$\n    其中 $\\Phi$ 是位势， $f$ 是科里奥利参数，下标 $p$ 表示导数是在恒定气压下求得的。\n\n2.  **静力平衡**，在气压坐标系中：\n    $$\\frac{\\partial \\Phi}{\\partial p} = -\\frac{1}{\\rho}$$\n    其中 $p$ 是气压，$\\rho$ 是空气密度。\n\n3.  **干空气的理想气体定律**：\n    $$p = \\rho R T \\implies \\frac{1}{\\rho} = \\frac{RT}{p}$$\n    其中 $R$ 是干空气的比气体常数， $T$ 是温度。\n\n我们的目标是找到 $\\partial u_g/\\partial \\ln p$ 的表达式。我们首先对地转风方程求关于气压 $p$ 的偏导数：\n$$\\frac{\\partial u_g}{\\partial p} = \\frac{\\partial}{\\partial p} \\left[ -\\frac{1}{f} \\left(\\frac{\\partial \\Phi}{\\partial y}\\right)_p \\right]$$\n由于科里奥利参数 $f$ 仅是纬度（$y$）的函数而不是气压的函数，并且假设位势场足够平滑，我们可以交换偏导数的顺序：\n$$\\frac{\\partial u_g}{\\partial p} = -\\frac{1}{f} \\frac{\\partial}{\\partial y} \\left( \\frac{\\partial \\Phi}{\\partial p} \\right)_p$$\n接下来，我们将静力平衡方程代入此表达式：\n$$\\frac{\\partial u_g}{\\partial p} = -\\frac{1}{f} \\frac{\\partial}{\\partial y} \\left( -\\frac{1}{\\rho} \\right)_p = \\frac{1}{f} \\frac{\\partial}{\\partial y} \\left( \\frac{1}{\\rho} \\right)_p$$\n现在，我们使用理想气体定律将密度 $\\rho$ 替换为温度 $T$ 和气压 $p$：\n$$\\frac{\\partial u_g}{\\partial p} = \\frac{1}{f} \\frac{\\partial}{\\partial y} \\left( \\frac{RT}{p} \\right)_p$$\n由于对 $y$ 的导数是在恒定气压 $p$ 下求得的，且 $R$ 是一个常数，我们可以写成：\n$$\\frac{\\partial u_g}{\\partial p} = \\frac{R}{fp} \\left(\\frac{\\partial T}{\\partial y}\\right)_p$$\n问题要求的是关于对数气压 $\\ln p$ 的导数。我们使用链式法则：$\\partial u_g/\\partial \\ln p = (\\partial u_g/\\partial p) (\\partial p/\\partial \\ln p)$。由于 $d(\\ln p) = (1/p) dp$，我们有 $\\partial p/\\partial \\ln p = p$。因此：\n$$\\frac{\\partial u_g}{\\partial \\ln p} = \\left( \\frac{R}{fp} \\left(\\frac{\\partial T}{\\partial y}\\right)_p \\right) \\cdot p$$\n$$\\frac{\\partial u_g}{\\partial \\ln p} = \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p$$\n这就是对数气压坐标系中的热成风方程，它用水平温度梯度来表达地转风的垂直切变。\n\n问题的第二部分要求将此表达式从低气压层 $p_{\\ell}$ 积分到高气压层 $p_u$，假设经向温度梯度 $\\partial T/\\partial y$ 随高度（因此也随气压）保持不变。由于 $R$ 和 $f$ 也随气压保持不变，所以整个右侧都是常数。\n$$\\int_{u_g(p_{\\ell})}^{u_g(p_u)} d u_g = \\int_{\\ln p_{\\ell}}^{\\ln p_u} \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p d(\\ln p)$$\n$$u_g(p_u) - u_g(p_{\\ell}) = \\left[ \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p \\right] \\left( \\ln(p_u) - \\ln(p_{\\ell}) \\right)$$\n$$u_g(p_u) - u_g(p_{\\ell}) = \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p \\ln\\left(\\frac{p_u}{p_{\\ell}}\\right)$$\n因此，高层的热力学预测纬向风，我们记为 $u_{\\mathrm{TW}}(p_u)$，为：\n$$u_{\\mathrm{TW}}(p_u) = u_g(p_{\\ell}) + \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p \\ln\\left(\\frac{p_u}{p_{\\ell}}\\right)$$\n\n最后，我们计算差异 $\\delta$ 的数值。\n给定的参数如下：\n- 纬度：$\\phi = 45^{\\circ} = \\frac{\\pi}{4}$ 弧度\n- 地球自转角速度：$\\Omega = 7.2921159 \\times 10^{-5}\\,\\mathrm{s}^{-1}$\n- 干空气比气体常数：$R = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- 经向温度梯度：$\\partial T/\\partial y = -6.0\\,\\mathrm{K} / (1000\\,\\mathrm{km}) = -6.0 \\times 10^{-6}\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$\n- 低层气压：$p_{\\ell} = 850\\,\\mathrm{hPa}$\n- 低层风速：$u_g(p_{\\ell}) = 8.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 高层气压：$p_u = 200\\,\\mathrm{hPa}$\n- 高层观测风速：$U_{\\mathrm{obs}}(p_u) = 38.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n\n首先，我们计算科里奥利参数 $f$：\n$$f = 2 \\Omega \\sin\\phi = 2 \\times (7.2921159 \\times 10^{-5}\\,\\mathrm{s}^{-1}) \\times \\sin(45^{\\circ}) \\approx 1.03125 \\times 10^{-4}\\,\\mathrm{s}^{-1}$$\n接下来，我们计算热成风的贡献，即两个层级之间的风速变化：\n$$\\Delta u_g = u_{\\mathrm{TW}}(p_u) - u_g(p_{\\ell}) = \\frac{R}{f} \\left(\\frac{\\partial T}{\\partial y}\\right)_p \\ln\\left(\\frac{p_u}{p_{\\ell}}\\right)$$\n$$\\Delta u_g \\approx \\frac{287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}}{1.03125 \\times 10^{-4}\\,\\mathrm{s}^{-1}} \\times (-6.0 \\times 10^{-6}\\,\\mathrm{K}\\,\\mathrm{m}^{-1}) \\times \\ln\\left(\\frac{200}{850}\\right)$$\n项 $\\ln(200/850) = \\ln(4/17) \\approx -1.44692$。\n$$\\Delta u_g \\approx (2.78278 \\times 10^6\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}\\,\\mathrm{K}^{-1}) \\times (-6.0 \\times 10^{-6}\\,\\mathrm{K}\\,\\mathrm{m}^{-1}) \\times (-1.44692)$$\n$$\\Delta u_g \\approx (-16.6967\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) \\times (-1.44692) \\approx 24.159\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n预测的高层风速为：\n$$u_{\\mathrm{TW}}(p_u) = u_g(p_{\\ell}) + \\Delta u_g \\approx 8.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1} + 24.159\\,\\mathrm{m}\\,\\mathrm{s}^{-1} = 32.159\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n有符号的差异 $\\delta$ 是预测风速与观测风速之差：\n$$\\delta = u_{\\mathrm{TW}}(p_u) - U_{\\mathrm{obs}}(p_u) \\approx 32.159\\,\\mathrm{m}\\,\\mathrm{s}^{-1} - 38.0\\,\\mathrm{m}\\,\\mathrm{s}^{-1} = -5.841\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n将结果四舍五入到三位有效数字，我们得到：\n$$\\delta \\approx -5.84\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$",
            "answer": "$$\\boxed{-5.84}$$"
        },
        {
            "introduction": "大气环流模型不仅要能模拟大尺度平衡流动，还必须精确地描述驱动天气系统和垂直能量输送的对流过程。本练习将带您探究对流的根本驱动力之一：湿空气的浮力效应。您将基于理想气体定律，推导并计算水汽如何使空气包裹变轻，从而在与干燥环境的对比中产生向上的浮力加速度。",
            "id": "4013689",
            "problem": "一个大气环流模型（AGCM）的网格柱中，有一个近地面气块，其特征为温度 $T=300\\ \\mathrm{K}$，压强 $p=950\\ \\mathrm{hPa}$，以及比湿 $q_v=0.015$（水汽的无量纲质量分数）。假设没有凝结水（$q_l=0$），并将周围的参考环境视为具有相同的 $T$ 和 $p$ 但完全干燥（即 $q_v=0$）。以应用于理想气体混合物的理想气体定律为基本出发点，并使用干空气的比气体常数 $R_d=287.0\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$ 和水汽的比气体常数 $R_v=461.5\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$。重力加速度为 $g=9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$。\n\n从第一性原理出发，推导湿空气密度 $\\rho$ 关于 $p$、$T$、$q_v$、$R_d$ 和 $R_v$ 的表达式，并计算在给定条件下气块的湿空气密度和环境的干空气密度。然后，通过计算浮力加速度来量化水汽的浮力效应：\n$$B = g\\,\\frac{\\rho_{\\mathrm{env}} - \\rho_{\\mathrm{parcel}}}{\\rho_{\\mathrm{env}}},$$\n其中 $\\rho_{\\mathrm{env}}$ 是在给定 $p$ 和 $T$ 下的干空气密度，而 $\\rho_{\\mathrm{parcel}}$ 是在给定 $p$、$T$ 和 $q_v$ 下的湿空气密度。\n\n以 $\\mathrm{m}\\ \\mathrm{s}^{-2}$ 为单位表示 $B$ 的最终数值答案，并将您的答案四舍五入到四位有效数字。在所有计算中，将 $p$ 转换为 $\\mathrm{Pa}$。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、表述清晰、内部一致且客观的。这是一个大气热力学中的标准问题。因此，我将提供完整的解题过程。\n\n第一步是根据第一性原理，即应用于理想气体混合物的理想气体定律，推导湿空气气块的密度 $\\rho$ 的表达式。湿空气被视为干空气和水汽的混合物。\n\n根据道尔顿分压定律，总压强 $p$ 是其组成气体分压的总和。对于湿空气，即：\n$$p = p_d + e$$\n其中 $p_d$ 是干空气的分压，$e$ 是水汽的分压。\n\n理想气体定律可以分别应用于每个组分：\n$$p_d = \\rho_d R_d T$$\n$$e = \\rho_v R_v T$$\n其中 $\\rho_d$ 和 $\\rho_v$ 分别是干空气和水汽的密度，$R_d$ 是干空气的比气体常数，$R_v$ 是水汽的比气体常数，$T$ 是混合物的温度。\n\n湿空气气块的总密度 $\\rho$ 是各组分密度之和：\n$$\\rho = \\rho_d + \\rho_v$$\n比湿 $q_v$ 定义为单位质量湿空气中水汽的质量。用密度表示为 $q_v = \\rho_v / \\rho$。类似地，干空气的质量分数是 $q_d = \\rho_d / \\rho$。因此有 $q_d + q_v = 1$，或 $q_d = 1 - q_v$。\n根据这些定义，我们可以用总密度 $\\rho$ 来表示各组分密度：\n$$\\rho_v = q_v \\rho$$\n$$\\rho_d = (1 - q_v) \\rho$$\n将这些表达式代入分压方程中：\n$$p_d = (1 - q_v) \\rho R_d T$$\n$$e = q_v \\rho R_v T$$\n现在，将它们相加得到总压强 $p$：\n$$p = p_d + e = (1 - q_v) \\rho R_d T + q_v \\rho R_v T$$\n我们可以提出公因子 $\\rho$ 和 $T$：\n$$p = \\rho T [(1 - q_v) R_d + q_v R_v]$$\n这个方程可以重新整理，解出湿空气密度 $\\rho$：\n$$\\rho = \\frac{p}{T [(1 - q_v) R_d + q_v R_v]}$$\n这就是所求的用给定变量表示的湿空气密度表达式。方括号中的项可以解释为湿空气混合物的比气体常数，$R_m = (1 - q_v) R_d + q_v R_v$。因此，湿空气的理想气体定律可以写成 $p = \\rho R_m T$。\n\n接下来，我们计算所需的量。压强必须转换为国际单位制（帕斯卡）：\n$p = 950\\ \\mathrm{hPa} = 950 \\times 100\\ \\mathrm{Pa} = 95000\\ \\mathrm{Pa}$。\n其他给定值为：\n$T = 300\\ \\mathrm{K}$\n$g = 9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$\n$R_d = 287.0\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n$R_v = 461.5\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n\n对于干燥环境，比湿 $q_v = 0$。密度公式简化为干空气的理想气体定律：\n$$\\rho_{\\mathrm{env}} = \\frac{p}{R_d T} = \\frac{95000\\ \\mathrm{Pa}}{(287.0\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1})(300\\ \\mathrm{K})} = \\frac{95000}{86100}\\ \\mathrm{kg}\\ \\mathrm{m}^{-3} \\approx 1.103368\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$$\n对于湿空气气块，比湿 $q_v = 0.015$。我们首先计算湿空气气块的比气体常数 $R_m$：\n$$R_m = (1 - 0.015)(287.0\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) + (0.015)(461.5\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1})$$\n$$R_m = (0.985)(287.0) + (0.015)(461.5)\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$$\n$$R_m = 282.695 + 6.9225\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1} = 289.6175\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$$\n现在我们可以计算湿气块的密度：\n$$\\rho_{\\mathrm{parcel}} = \\frac{p}{R_m T} = \\frac{95000\\ \\mathrm{Pa}}{(289.6175\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1})(300\\ \\mathrm{K})} = \\frac{95000}{86885.25}\\ \\mathrm{kg}\\ \\mathrm{m}^{-3} \\approx 1.093392\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$$\n正如预期的那样，在相同的温度和压强下，湿空气的密度小于干空气。\n\n最后，我们计算浮力加速度 $B$：\n$$B = g\\,\\frac{\\rho_{\\mathrm{env}} - \\rho_{\\mathrm{parcel}}}{\\rho_{\\mathrm{env}}}$$\n通过代入密度的表达式，可以简化分数项：\n$$\\frac{\\rho_{\\mathrm{env}} - \\rho_{\\mathrm{parcel}}}{\\rho_{\\mathrm{env}}} = 1 - \\frac{\\rho_{\\mathrm{parcel}}}{\\rho_{\\mathrm{env}}} = 1 - \\frac{p/(R_m T)}{p/(R_d T)} = 1 - \\frac{R_d}{R_m} = \\frac{R_m - R_d}{R_m}$$\n我们有 $R_m = 289.6175\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$ 和 $R_d = 287.0\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$。\n$$R_m - R_d = 289.6175 - 287.0 = 2.6175\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$$\n用代数方法验证这个差值是很有用的：$R_m - R_d = [(1-q_v)R_d + q_v R_v] - R_d = q_v(R_v - R_d)$。使用给定值：$0.015 \\times (461.5 - 287.0) = 0.015 \\times 174.5 = 2.6175$。数值匹配，证实了我们对 $R_m$ 的计算是正确的。\n\n现在，我们计算 $B$：\n$$B = g \\frac{R_m - R_d}{R_m} = (9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2}) \\left( \\frac{2.6175}{289.6175} \\right)$$\n$$B \\approx (9.81\\ \\mathrm{m}\\ \\mathrm{s}^{-2})(0.009037748) \\approx 0.0886603\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$$\n将结果四舍五入到四位有效数字，得到 $0.08866\\ \\mathrm{m}\\ \\mathrm{s}^{-2}$。",
            "answer": "$$\\boxed{0.08866}$$"
        },
        {
            "introduction": "为了在球体上精确求解流体动力学方程，许多全球气候模型都采用了谱方法作为其动力核心。本练习将引导您通过编程实践，掌握一种与谱方法紧密相关的关键技术——亥姆霍兹分解。您将学习如何使用傅里叶变换将风场分解为其旋转分量（涡旋）和辐散分量，这不仅是理解全球环流结构的重要分析工具，也是现代AGCM数值引擎的基石。",
            "id": "4013652",
            "problem": "给定一个二维矩形双周期域，其东向坐标为 $x \\in [0,L_x)$，北向坐标为 $y \\in [0,L_y)$。该域在 $N_x \\times N_y$ 网格上均匀离散化，网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$。在此域上，考虑水平风矢量场 $\\mathbf{v}=(u,v)$，其中 $u$ 和 $v$ 的单位为 $\\mathrm{m/s}$。您的任务是使用快速傅里叶变换（FFT）实现谱 Helmholtz 分解，以计算相对涡度 $\\zeta$ 和散度 $D$，反演求解流函数 $\\psi$（单位 $\\mathrm{m^2/s}$）和速度势 $\\chi$（单位 $\\mathrm{m^2/s}$），然后重构风场以验证分解的准确性。\n\n平面上二维矢量场 $\\mathbf{v}=(u,v)$ 的基本定义如下：\n- 相对涡度：$\\zeta = \\partial v/\\partial x - \\partial u/\\partial y$。\n- 散度：$D = \\partial u/\\partial x + \\partial v/\\partial y$。\n- Helmholtz 分解：$\\mathbf{v} = \\hat{\\mathbf{k}} \\times \\nabla \\psi + \\nabla \\chi$，因此 $u = -\\partial \\psi/\\partial y + \\partial \\chi/\\partial x$ 且 $v = \\partial \\psi/\\partial x + \\partial \\chi/\\partial y$。\n\n在周期域上，应用谱方法并使用傅里叶变换。您必须利用导数的傅里叶变换性质以及由上述定义产生的周期性泊松方程，在谱空间中求解 $\\psi$ 和 $\\chi$，并强制 $\\psi$ 和 $\\chi$ 的空间平均值为零（即，零波数分量设为零）。验证过程必须通过从诊断出的 $\\psi$ 和 $\\chi$ 重构 $u$ 和 $v$，并与去除空间平均后的原始风场进行比较来完成（因为在环面上进行的 Helmholtz 分解不包括谐波平均流模态）。所有三角函数的参数均以弧度为单位。所有物理量必须使用国际单位制（SI 单位）处理，并且所需的误差度量必须以 $\\mathrm{m/s}$ 为单位报告。\n\n实现以下测试套件，其中每个案例都规定了解析流函数 $\\psi(x,y)$ 和速度势 $\\chi(x,y)$。您必须根据 $u = -\\partial \\psi/\\partial y + \\partial \\chi/\\partial x$ 和 $v = \\partial \\psi/\\partial x + \\partial \\chi/\\partial y$ 从 $\\psi$ 和 $\\chi$ 构建风场。然后，对每个案例，执行谱诊断和重构，并计算矢量风异常的均方根 (RMS) 重构误差：\n$$E = \\sqrt{\\left\\langle \\left( u_{\\mathrm{rec}} - u' \\right)^2 + \\left( v_{\\mathrm{rec}} - v' \\right)^2 \\right\\rangle},$$\n其中 $u' = u - \\langle u \\rangle$，$v' = v - \\langle v \\rangle$，$\\langle \\cdot \\rangle$ 是域上的空间平均，$u_{\\mathrm{rec}}, v_{\\mathrm{rec}}$ 是从诊断出的 $\\psi$ 和 $\\chi$ 重构的。将 $E$ 以 $\\mathrm{m/s}$ 表示。\n\n域和网格：\n- $L_x = 1.0\\times 10^7\\ \\mathrm{m}$，$L_y = 8.0\\times 10^6\\ \\mathrm{m}$。\n- $N_x = 128$，$N_y = 128$。\n- 三角函数中的角度以弧度为单位；例如，$\\cos\\!\\left(2\\pi n x/L_x\\right)$ 中的 $x$ 单位为 $\\mathrm{m}$，$n$ 为无量纲。\n\n使用整数 $n$ 和 $m$（分别表示在 $x$ 和 $y$ 方向上跨越域的完整周期数）以及振幅 $A_\\psi$ 和 $A_\\chi$（单位为 $\\mathrm{m^2/s}$）定义以下四个案例。对每个案例，定义\n$$\\psi(x,y) = A_\\psi \\cos\\!\\left(\\frac{2\\pi n_\\psi x}{L_x}\\right)\\cos\\!\\left(\\frac{2\\pi m_\\psi y}{L_y}\\right),$$\n$$\\chi(x,y) = A_\\chi \\sin\\!\\left(\\frac{2\\pi n_\\chi x}{L_x}\\right)\\cos\\!\\left(\\frac{2\\pi m_\\chi y}{L_y}\\right).$$\n然后使用上述定义从 $\\psi$ 和 $\\chi$ 构建 $u$ 和 $v$。在案例 4 中，从 $\\psi$ 和 $\\chi$ 构建 $u$ 和 $v$ 后，再向其添加一个均匀平均风 $(u_{\\mathrm{mean}}, v_{\\mathrm{mean}})$。\n\n- 案例 1（复合低波数）：\n  - $A_\\psi = 1.0\\times 10^7$, $n_\\psi = 2$, $m_\\psi = 3$。\n  - $A_\\chi = 0.5\\times 10^7$, $n_\\chi = 1$, $m_\\chi = 2$。\n  - $u_{\\mathrm{mean}} = 0$, $v_{\\mathrm{mean}} = 0$。\n\n- 案例 2（纯旋转流）：\n  - $A_\\psi = 0.8\\times 10^7$, $n_\\psi = 4$, $m_\\psi = 5$。\n  - $A_\\chi = 0$, $n_\\chi$ 和 $m_\\chi$ 未使用。\n  - $u_{\\mathrm{mean}} = 0$, $v_{\\mathrm{mean}} = 0$。\n\n- 案例 3（纯辐散流）：\n  - $A_\\psi = 0$, $n_\\psi$ 和 $m_\\psi$ 未使用。\n  - $A_\\chi = 1.2\\times 10^7$, $n_\\chi = 6$, $m_\\chi = 7$。\n  - $u_{\\mathrm{mean}} = 0$, $v_{\\mathrm{mean}} = 0$。\n\n- 案例 4（含平均流的复合流）：\n  - $A_\\psi = 0.6\\times 10^7$, $n_\\psi = 8$, $m_\\psi = 9$。\n  - $A_\\chi = 0.6\\times 10^7$, $n_\\chi = 9$, $m_\\chi = 8$。\n  - $u_{\\mathrm{mean}} = 5.0$, $v_{\\mathrm{mean}} = -3.0$。\n\n算法要求：\n- 使用傅里叶变换以谱方法计算空间导数。如果 $\\hat{f}(k_x,k_y)$ 是 $f(x,y)$ 的傅里叶变换，则 $\\widehat{\\partial f/\\partial x} = i k_x \\hat{f}$ 和 $\\widehat{\\partial f/\\partial y} = i k_y \\hat{f}$，其中 $k_x$ 和 $k_y$ 是以弧度/米为单位的纬向和经向波数；在给定网格间距 $\\Delta x$ 和 $\\Delta y$ 的情况下，这些波数通过 $k = 2\\pi \\,\\mathrm{fftfreq}$ 与离散傅里叶频率相关联。\n- 从 $u$ 和 $v$ 谱方法诊断 $\\zeta$ 和 $D$。\n- 在谱空间中，通过除以 $-k^2$（其中 $k^2 = k_x^2 + k_y^2$）来反演求解 $\\psi$ 和 $\\chi$ 的泊松方程；将零波数分量设为零以强制 $\\psi$ 和 $\\chi$ 的空间平均值为零。\n- 使用上面给出的 Helmholtz 形式，从诊断出的 $\\psi$ 和 $\\chi$ 谱方法重构 $u_{\\mathrm{rec}}$ 和 $v_{\\mathrm{rec}}$。\n- 对每个案例，使用异常风（$u'$ 和 $v'$）计算以 $\\mathrm{m/s}$ 为单位的 RMS 重构误差 $E$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按案例 1 到 4 的顺序列出每个案例的一个浮点数结果，例如：'[0.00123,0.00098,0.00077,0.00456]'。每个浮点数必须是相应案例的 RMS 误差 $E$，单位为 $\\mathrm{m/s}$。程序必须是自包含的，不接受任何输入，并精确打印一行。",
            "solution": "该问题在科学和数学上是适定的。它描述了计算地球物理流体动力学中用于验证谱 Helmholtz 分解代码的标准程序。所有必需的物理量、数学定义、域参数和数值程序都已提供，并与既定原则一致。问题指定了一种“人造解方法”，即使用解析解生成输入数据，并将数值方法的输出与此已知解进行比较以量化误差。这是一种用于代码验证的稳健且标准的技术。\n\n解决方案通过实现指定的算法来推进。核心步骤包括网格生成、波数计算、解析场构建、谱分解和重构以及误差计算。\n\n**1. 预备工作：网格和波数**\n\n物理域是一个由 $x \\in [0, L_x)$ 和 $y \\in [0, L_y)$ 定义的双周期矩形，其中 $L_x = 1.0\\times 10^7$ 米，$L_y = 8.0\\times 10^6$ 米。该域在大小为 $N_x \\times N_y$ 的均匀网格上离散化，其中 $N_x = 128$，$N_y = 128$。网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta y = L_y/N_y$。为评估解析场，构建了物理坐标 $(x_{ij}, y_{ij})$ 的二维网格。\n\n对于谱方法，我们需要相应的波数。纬向和经向波数 $k_x$ 和 $k_y$ 由离散傅里叶变换频率给出。对于长度为 $L$、有 $N$ 个点、网格间距为 $\\Delta = L/N$ 的域，波数为 $k = 2\\pi f$，其中 $f$ 是空间频率。这些频率可以使用 `fftfreq(N, d)` 获得，该函数提供以“周期/单位距离”为单位的频率。因此，波数矢量为 $k_x = 2\\pi \\cdot \\mathrm{fftfreq}(N_x, \\Delta x)$ 和 $k_y = 2\\pi \\cdot \\mathrm{fftfreq}(N_y, \\Delta y)$。然后将它们构造成二维数组，以便在谱域中进行逐元素操作。\n\n**2. 解析风场构建**\n\n对每个测试案例，都构建一个解析风场 $(u, v)$。问题将流函数 $\\psi(x,y)$ 和速度势 $\\chi(x,y)$ 定义为：\n$$ \\psi(x,y) = A_\\psi \\cos\\left(\\frac{2\\pi n_\\psi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m_\\psi y}{L_y}\\right) $$\n$$ \\chi(x,y) = A_\\chi \\sin\\left(\\frac{2\\pi n_\\chi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m_\\chi y}{L_y}\\right) $$\n风分量 $u$ 和 $v$ 是使用 Helmholtz 分解定义从这些势推导出来的，$u = -\\partial \\psi/\\partial y + \\partial \\chi/\\partial x$ 和 $v = \\partial \\psi/\\partial x + \\partial \\chi/\\partial y$。计算解析导数并在物理网格上求值：\n$$ u(x,y) = A_\\psi \\left(\\frac{2\\pi m_\\psi}{L_y}\\right) \\cos\\left(\\frac{2\\pi n_\\psi x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m_\\psi y}{L_y}\\right) + A_\\chi \\left(\\frac{2\\pi n_\\chi}{L_x}\\right) \\cos\\left(\\frac{2\\pi n_\\chi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m_\\chi y}{L_y}\\right) $$\n$$ v(x,y) = -A_psi \\left(\\frac{2\\pi n_\\psi}{L_x}\\right) \\sin\\left(\\frac{2\\pi n_\\psi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi m_\\psi y}{L_y}\\right) - A_\\chi \\left(\\frac{2\\pi m_\\chi}{L_y}\\right) \\sin\\left(\\frac{2\\pi n_\\chi x}{L_x}\\right)\\sin\\left(\\frac{2\\pi m_\\chi y}{L_y}\\right) $$\n对于案例 4，将一个均匀平均风 $(u_{\\mathrm{mean}}, v_{\\mathrm{mean}})$ 添加到这些场中。\n\n**3. 谱诊断和反演**\n\n算法的核心在谱域中执行。首先，对输入风场 $u(x,y)$ 和 $v(x,y)$ 应用二维快速傅里叶变换 (FFT)，以获得它们的谱表示 $\\hat{u}(k_x, k_y)$ 和 $\\hat{v}(k_x, k_y)$。\n\n接下来，计算相对涡度 $\\zeta$ 和散度 $D$ 的谱表示。利用偏导数 $\\partial f / \\partial x$ 的傅里叶变换是 $i k_x \\hat{f}$ 的性质，我们得到：\n$$ \\hat{\\zeta} = i k_x \\hat{v} - i k_y \\hat{u} $$\n$$ \\hat{D} = i k_x \\hat{u} + i k_y \\hat{v} $$\n\nHelmholtz 分解引出两个将势与涡度和散度联系起来的泊松方程：$\\nabla^2 \\psi = \\zeta$ 和 $\\nabla^2 \\chi = D$。在谱域中，拉普拉斯算子 $\\nabla^2$ 变为乘以 $-(k_x^2+k_y^2) = -k^2$。因此，我们可以通过代数除法求解 $\\hat{\\psi}$ 和 $\\hat{\\chi}$：\n$$ \\hat{\\psi} = \\frac{\\hat{\\zeta}}{-k^2} $$\n$$ \\hat{\\chi} = \\frac{\\hat{D}}{-k^2} $$\n对于零波数模式（$k_x = k_y = 0$），存在一个奇异点，此时 $k^2 = 0$。问题指定将 $\\psi$ 和 $\\chi$ 的零波数分量设为零，这强制使这些势的空间平均值为零。这是通过创建一个谱逆拉普拉斯算子 $-1/k^2$ 来实现的，其中零波数处的值设为 $0$。\n\n**4. 风场重构与验证**\n\n利用诊断出的谱势 $\\hat{\\psi}$ 和 $\\hat{\\chi}$，同样在谱域中重构风场：\n$$ \\hat{u}_{\\mathrm{rec}} = -i k_y \\hat{\\psi} + i k_x \\hat{\\chi} $$\n$$ \\hat{v}_{\\mathrm{rec}} = i k_x \\hat{\\psi} + i k_y \\hat{\\chi} $$\n通过对 $\\hat{u}_{\\mathrm{rec}}$ 和 $\\hat{v}_{\\mathrm{rec}}$ 应用二维逆 FFT，可以获得重构的物理空间风场 $u_{\\mathrm{rec}}(x,y)$ 和 $v_{\\mathrm{rec}}(x,y)$。结果是实值场（在机器精度范围内）。\n\n最后，通过计算均方根 (RMS) 误差来验证过程的准确性。在周期域上，具有零平均势的 Helmholtz 分解只能表示异常场（即去除了其空间平均值的场）。因此，必须在重构风场（$u_{\\mathrm{rec}}, v_{\\mathrm{rec}}$，根据构造其平均值为零）和原始风场的异常（$u' = u - \\langle u \\rangle, v' = v - \\langle v \\rangle$）之间进行比较。误差度量为：\n$$ E = \\sqrt{\\left\\langle \\left( u_{\\mathrm{rec}} - u' \\right)^2 + \\left( v_{\\mathrm{rec}} - v' \\right)^2 \\right\\rangle} $$\n其中 $\\langle \\cdot \\rangle$ 表示在域上的空间平均。对每个测试案例计算此误差 $E$。由于输入场由网格可以完美解析的正弦波组成，并且谱方法对于这些函数是精确的，因此预期误差应在机器浮点精度的量级。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a spectral Helmholtz decomposition to diagnose and reconstruct\n    a 2D wind field on a doubly periodic domain, and verifies the accuracy.\n    \"\"\"\n    \n    # 1. Define global parameters and test cases\n    Lx = 1.0e7  # Domain size in x (m)\n    Ly = 8.0e6  # Domain size in y (m)\n    Nx = 128    # Number of grid points in x\n    Ny = 128    # Number of grid points in y\n\n    test_cases = [\n        # Case 1: Composite low wavenumbers\n        {'A_psi': 1.0e7, 'n_psi': 2, 'm_psi': 3, 'A_chi': 0.5e7, 'n_chi': 1, 'm_chi': 2, 'u_mean': 0.0, 'v_mean': 0.0},\n        # Case 2: Purely rotational\n        {'A_psi': 0.8e7, 'n_psi': 4, 'm_psi': 5, 'A_chi': 0.0,   'n_chi': 0, 'm_chi': 0, 'u_mean': 0.0, 'v_mean': 0.0},\n        # Case 3: Purely divergent\n        {'A_psi': 0.0,   'n_psi': 0, 'm_psi': 0, 'A_chi': 1.2e7, 'n_chi': 6, 'm_chi': 7, 'u_mean': 0.0, 'v_mean': 0.0},\n        # Case 4: Composite with mean flow\n        {'A_psi': 0.6e7, 'n_psi': 8, 'm_psi': 9, 'A_chi': 0.6e7, 'n_chi': 9, 'm_chi': 8, 'u_mean': 5.0, 'v_mean': -3.0}\n    ]\n\n    results = []\n\n    # 2. Set up grid and wavenumbers (common for all cases)\n    dx = Lx / Nx\n    dy = Ly / Ny\n    \n    x = np.arange(Nx) * dx\n    y = np.arange(Ny) * dy\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    kx_vec = 2 * np.pi * np.fft.fftfreq(Nx, dx)\n    ky_vec = 2 * np.pi * np.fft.fftfreq(Ny, dy)\n    kx, ky = np.meshgrid(kx_vec, ky_vec, indexing='ij')\n\n    # Spectral inverse Laplacian, handling the k=0 singularity\n    k_sq = kx**2 + ky**2\n    inv_lap = np.zeros_like(k_sq)\n    non_zero_k = k_sq != 0\n    inv_lap[non_zero_k] = -1.0 / k_sq[non_zero_k]\n\n    for case in test_cases:\n        # 3. Construct analytic wind field u, v for the current case\n        A_psi = case['A_psi']\n        n_psi = case['n_psi']\n        m_psi = case['m_psi']\n        A_chi = case['A_chi']\n        n_chi = case['n_chi']\n        m_chi = case['m_chi']\n        u_mean = case['u_mean']\n        v_mean = case['v_mean']\n\n        # Wavenumbers for analytic functions\n        k_x_psi = 2 * np.pi * n_psi / Lx if Lx != 0 else 0\n        k_y_psi = 2 * np.pi * m_psi / Ly if Ly != 0 else 0\n        k_x_chi = 2 * np.pi * n_chi / Lx if Lx != 0 else 0\n        k_y_chi = 2 * np.pi * m_chi / Ly if Ly != 0 else 0\n\n        # Calculate u and v from analytic derivatives of psi and chi\n        u_rot = A_psi * k_y_psi * np.cos(k_x_psi * xx) * np.sin(k_y_psi * yy) if A_psi != 0 else 0\n        u_div = A_chi * k_x_chi * np.cos(k_x_chi * xx) * np.cos(k_y_chi * yy) if A_chi != 0 else 0\n        \n        v_rot = -A_psi * k_x_psi * np.sin(k_x_psi * xx) * np.cos(k_y_psi * yy) if A_psi != 0 else 0\n        v_div = -A_chi * k_y_chi * np.sin(k_x_chi * xx) * np.sin(k_y_chi * yy) if A_chi != 0 else 0\n        \n        u = u_rot + u_div + u_mean\n        v = v_rot + v_div + v_mean\n\n        # 4. Perform spectral decomposition and reconstruction\n        u_hat = np.fft.fft2(u)\n        v_hat = np.fft.fft2(v)\n\n        # Diagnose vorticity (zeta) and divergence (D) in spectral space\n        zeta_hat = 1j * kx * v_hat - 1j * ky * u_hat\n        D_hat    = 1j * kx * u_hat + 1j * ky * v_hat\n\n        # Invert for psi and chi in spectral space using the inverse Laplacian\n        psi_hat_diag = zeta_hat * inv_lap\n        chi_hat_diag = D_hat * inv_lap\n\n        # Reconstruct u and v in spectral space from diagnosed potentials\n        u_rec_hat = -1j * ky * psi_hat_diag + 1j * kx * chi_hat_diag\n        v_rec_hat =  1j * kx * psi_hat_diag + 1j * ky * chi_hat_diag\n\n        # Inverse FFT to get reconstructed fields in physical space\n        u_rec = np.fft.ifft2(u_rec_hat).real\n        v_rec = np.fft.ifft2(v_rec_hat).real\n\n        # 5. Compute verification error\n        # The reconstructed wind has zero mean, so compare to the anomaly of the original wind\n        u_prime = u - np.mean(u)\n        v_prime = v - np.mean(v)\n\n        # RMS error of the vector wind anomaly\n        err_sq = np.mean((u_rec - u_prime)**2 + (v_rec - v_prime)**2)\n        error = np.sqrt(err_sq)\n        \n        results.append(error)\n\n    # 6. Print final result in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}