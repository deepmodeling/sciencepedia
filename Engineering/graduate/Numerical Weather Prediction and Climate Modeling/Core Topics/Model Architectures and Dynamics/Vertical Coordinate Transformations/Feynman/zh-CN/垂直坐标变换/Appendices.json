{
    "hands_on_practices": [
        {
            "introduction": "当我们使用地形追随坐标系时，水平导数是沿着弯曲的坐标面计算的。为了将其与恒定高度面上的导数联系起来，链式法则引入了新的“度量项”。本练习  将引导你分析推导一个关键的度量项 $\\frac{\\partial z}{\\partial x}|_{\\sigma}$，即坐标面的斜率，并找出其在何处达到最大值。这有助于你直观地理解地形陡峭度如何影响变换后坐标系中的控制方程，并为理解气压梯度力误差的来源打下基础。",
            "id": "4109517",
            "problem": "在数值天气预报和气候模拟中，常使用一种地形追随垂直坐标来减轻复杂地形上的气压梯度误差。考虑一个由水平坐标 $x$ 和地形追随垂直坐标 $\\sigma$ 构成的二维域，其定义映射为 $z(x,\\sigma) = h(x) + \\sigma \\left(H - h(x)\\right)$，其中 $z$ 是几何高度，$H$ 是一个恒定的域顶部高度，$h(x)$ 是底部地形。设底部地形为一个由 $h(x) = h_0 \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)$ 给出的平滑、局地化的高斯山脊，其中 $h_0 > 0$ 是山脊振幅，$L > 0$ 是半宽尺度。假设 $H > h_0$，使得该映射是单调的，并且 $\\sigma \\in [0,1]$，其中 $\\sigma = 0$ 对应地表，$\\sigma = 1$ 对应顶部。在静力原始方程组(HPE)的变换中，将地形追随面上的水平梯度与几何高度梯度联系起来的水平度量耦合项，涉及到雅可比因子 $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$。\n\n从链式法则和所提供的映射出发，推导度量系数 $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$ 关于 $x$、$\\sigma$、$h_0$ 和 $L$ 的显式闭式表达式。然后，确定在 $x \\in \\mathbb{R}$ 和 $\\sigma \\in [0,1]$ 范围内，量级 $\\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$ 在何处的 $x$ 和 $\\sigma$ 值达到其全局最大值，并以闭式形式给出相应的最大值。你的最终答案必须是一个单一的复合解析表达式，其中包含：\n- $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$ 的表达式，\n- 全局最大值出现处的 $x$ 位置，\n- 全局最大值出现处的 $\\sigma$ 位置，\n- 全局最大值量级 $\\max_{x,\\sigma} \\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$。\n\n不需要数值近似；请精确表达你的最终结果。如果你做出任何辅助假设，请使用基本定律或经过充分检验的公式和事实（例如多元函数的链式法则和指数函数的标准微分法则）来清晰地陈述并证明它们。",
            "solution": "### 第1步：提取已知条件\n- **垂直坐标映射：** $z(x,\\sigma) = h(x) + \\sigma \\left(H - h(x)\\right)$\n- **定义域：** $x \\in \\mathbb{R}$，$\\sigma \\in [0,1]$\n- **底部地形：** $h(x) = h_0 \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)$\n- **常数：** $H$, $h_0 > 0$, $L > 0$\n- **条件：** $H > h_0$\n- **目标量：** 度量系数 $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$\n- **任务：**\n    1.  推导 $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$ 的显式闭式表达式。\n    2.  找出量级 $\\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$ 达到其全局最大值时的 $x$ 和 $\\sigma$ 的值。\n    3.  以闭式形式提供此全局最大值的量级。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，是适定且客观的。它描述了大气和海洋模拟中使用的标准地形追随 $\\sigma$ 坐标变换。该任务是一个定义明确的数学问题，涉及对给定函数的微分和优化。所有必要的信息都已提供，没有矛盾、歧义或伪科学主张。\n\n### 第3步：结论与行动\n\n问题要求一个包含四部分的答案：度量系数 $\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$ 的表达式，其量级最大化时的坐标 $(x, \\sigma)$，以及该最大量级的值。\n\n**第1部分：度量系数的表达式**\n\n垂直坐标变换由 $z(x,\\sigma) = h(x) + \\sigma \\left(H - h(x)\\right)$ 给出。我们可以通过提出 $h(x)$ 来重写它：\n$$ z(x,\\sigma) = (1-\\sigma)h(x) + \\sigma H $$\n度量系数是 $z$ 对 $x$ 的偏导数，同时保持 $\\sigma$ 不变。使用求和法则和常数倍数法则进行微分：\n$$ \\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ (1-\\sigma)h(x) + \\sigma H \\right] $$\n由于对于此偏导数，$\\sigma$ 和 $H$ 被视为常数，我们有：\n$$ \\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = (1-\\sigma)\\frac{dh}{dx} + 0 = (1-\\sigma)\\frac{dh}{dx} $$\n接下来，我们必须求地形函数 $h(x) = h_0 \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)$ 的导数。使用链式法则：\n$$ \\frac{dh}{dx} = h_0 \\cdot \\frac{d}{dx} \\left[ \\exp\\left(-\\frac{x^2}{L^2}\\right) \\right] $$\n$$ \\frac{dh}{dx} = h_0 \\cdot \\exp\\left(-\\frac{x^2}{L^2}\\right) \\cdot \\frac{d}{dx}\\left(-\\frac{x^2}{L^2}\\right) $$\n$$ \\frac{dh}{dx} = h_0 \\cdot \\exp\\left(-\\frac{x^2}{L^2}\\right) \\cdot \\left(-\\frac{2x}{L^2}\\right) = -\\frac{2h_0 x}{L^2} \\exp\\left(-\\frac{x^2}{L^2}\\right) $$\n将 $\\frac{dh}{dx}$ 的这个表达式代回到度量系数的方程中：\n$$ \\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = (1-\\sigma) \\left( -\\frac{2h_0 x}{L^2} \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right) \\right) $$\n$$ \\frac{\\partial z}{\\partial x}\\bigg|_{\\sigma} = -(1-\\sigma) \\frac{2h_0 x}{L^2} \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right) $$\n这是第一个所需的表达式。\n\n**第2部分：量级的最大化**\n\n我们需要在定义域 $x \\in \\mathbb{R}$ 和 $\\sigma \\in [0,1]$ 上找到该系数的量级 $F(x, \\sigma) = \\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right|$ 的全局最大值。\n$$ F(x, \\sigma) = \\left| -(1-\\sigma) \\frac{2h_0 x}{L^2} \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right) \\right| $$\n由于 $h_0 > 0$，$L > 0$，且 $\\sigma \\in [0,1]$ 意味着 $(1-\\sigma) \\ge 0$，我们可以简化绝对值：\n$$ F(x, \\sigma) = (1-\\sigma) \\frac{2h_0}{L^2} |x| \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right) $$\n函数 $F(x, \\sigma)$ 是一个关于 $\\sigma$ 的函数和一个关于 $x$ 的函数的乘积。由于两者都是非负的，我们可以独立地将它们最大化。\n$$ F(x, \\sigma) = G(\\sigma) \\cdot K(x) $$\n其中 $G(\\sigma) = 1-\\sigma$ 且 $K(x) = \\frac{2h_0}{L^2} |x| \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)$。\n\n**关于 $\\sigma$ 的最大化**：\n函数 $G(\\sigma) = 1-\\sigma$ 在区间 $\\sigma \\in [0,1]$ 上是一个线性递减函数。其最大值出现在区间的左端点，即 $\\sigma = 0$。在这一点上，$\\max G(\\sigma) = G(0) = 1$。\n因此，度量系数的最大量级出现在地表，即 $\\sigma=0$。\n\n**关于 $x$ 的最大化**：\n我们需要最大化 $K(x) = \\frac{2h_0}{L^2} |x| \\exp\\left(-\\frac{x^2}{L^2}\\right)$。由于 $K(x)$ 是 $x$ 的偶函数，我们可以针对 $x \\ge 0$ 进行分析，此时 $|x|=x$，而在 $-x$ 处的结果将是相同的。让我们找到 $f(x) = x \\exp(-\\frac{x^2}{L^2})$ 在 $x \\ge 0$ 时的最大值。常数乘法因子 $\\frac{2h_0}{L^2}$ 不影响最大值的位置。\n我们通过将一阶导数设为零来找到临界点：\n$$ \\frac{df}{dx} = \\frac{d}{dx}\\left[x \\exp\\left(-\\frac{x^2}{L^2}\\right)\\right] = 1 \\cdot \\exp\\left(-\\frac{x^2}{L^2}\\right) + x \\cdot \\exp\\left(-\\frac{x^2}{L^2}\\right) \\cdot \\left(-\\frac{2x}{L^2}\\right) $$\n$$ \\frac{df}{dx} = \\left(1 - \\frac{2x^2}{L^2}\\right) \\exp\\left(-\\frac{x^2}{L^2}\\right) $$\n设 $\\frac{df}{dx} = 0$，并且知道指数项总是正的，我们需要：\n$$ 1 - \\frac{2x^2}{L^2} = 0 \\implies x^2 = \\frac{L^2}{2} \\implies x = \\frac{L}{\\sqrt{2}} \\quad (\\text{因为 } x \\ge 0) $$\n这是一个局部最大值，因为一阶导数在 $0  x  L/\\sqrt{2}$ 时为正，在 $x  L/\\sqrt{2}$ 时为负。由于 $f(0)=0$ 且当 $x \\to \\infty$ 时 $f(x) \\to 0$，这个局部最大值是 $x \\ge 0$ 时的全局最大值。\n由于 $K(x)$ 的偶对称性，全局最大值出现在 $x = \\pm \\frac{L}{\\sqrt{2}}$。\n因此，$F(x, \\sigma)$ 的全局最大值出现在 $\\sigma = 0$ 和 $x = \\pm \\frac{L}{\\sqrt{2}}$。\n\n**第3部分：最大量级的值**\n\n最后，我们通过将这些坐标代入 $F(x, \\sigma)$ 的表达式来计算最大值：\n$$ \\max_{x,\\sigma} \\left|\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}\\right| = F\\left(\\pm \\frac{L}{\\sqrt{2}}, 0\\right) $$\n$$ = (1-0) \\frac{2h_0}{L^2} \\left|\\pm\\frac{L}{\\sqrt{2}}\\right| \\exp\\left(-\\frac{(\\pm L/\\sqrt{2})^2}{L^2}\\right) $$\n$$ = (1) \\frac{2h_0}{L^2} \\frac{L}{\\sqrt{2}} \\exp\\left(-\\frac{L^2/2}{L^2}\\right) $$\n$$ = \\frac{2h_0 L}{\\sqrt{2} L^2} \\exp\\left(-\\frac{1}{2}\\right) = \\frac{\\sqrt{2} h_0}{L} \\exp\\left(-\\frac{1}{2}\\right) $$\n这是度量系数的全局最大量级。\n\n四个所需的结果是：\n1.  **$\\frac{\\partial z}{\\partial x}\\big|_{\\sigma}$ 的表达式：** $-(1-\\sigma) \\frac{2h_0 x}{L^2} \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)$\n2.  **最大值处的 $x$ 位置：** $\\pm \\frac{L}{\\sqrt{2}}$\n3.  **最大值处的 $\\sigma$ 位置：** $0$\n4.  **最大量级：** $\\frac{\\sqrt{2} h_0}{L} \\exp\\left(-\\frac{1}{2}\\right)$\n\n这些将被编译成一个单一的复合答案。",
            "answer": "$$ \\boxed{\\begin{pmatrix} -(1-\\sigma) \\frac{2 h_0 x}{L^2} \\exp\\left(-\\left(\\frac{x}{L}\\right)^{2}\\right)  \\pm \\frac{L}{\\sqrt{2}}  0  \\frac{h_0\\sqrt{2}}{L}\\exp\\left(-\\frac{1}{2}\\right) \\end{pmatrix}} $$"
        },
        {
            "introduction": "为了缓解纯西格玛坐标系带来的问题，现代模式采用了混合西格玛-气压坐标系，这种坐标系在近地面是地形追随的，在高空则平滑地过渡到纯气压坐标。这些坐标系通过系数（$A$ 和 $B$）来定义，它们根据地表气压决定了每个模式层上的气压。静力平衡关系使我们能够将每层的气压厚度与其质量联系起来。本练习  将让你亲手计算一个现代大气模式的垂直结构，通过为一组给定的混合系数计算层结界面气压和层质量，你将对模式网格的构建方式以及大气质量如何在离散层中分布建立起一个具体的认识。",
            "id": "4109536",
            "problem": "一个静力原始方程大气模式采用了一种混合 sigma-压力垂直坐标，该坐标在半层上通过映射 $p(\\eta)=A(\\eta)+B(\\eta)\\,p_{s}$ 定义，其中 $p$ 是气压，$A(\\eta)$ 的单位是气压，$B(\\eta)$ 是无量纲的，$p_{s}$ 是地表气压。考虑一个气柱，其地表气压 $p_{s}=950$ hPa，固定顶层气压 $p_{t}=100$ hPa。有 $N=4$ 个模式层，由从上到下索引为 $\\eta_{1/2},\\eta_{3/2},\\eta_{5/2},\\eta_{7/2},\\eta_{9/2}$ 的 5 个半层界面界定。这些界面上的混合系数指定如下：\n- $A_{1/2}=10000$ Pa, $B_{1/2}=0$,\n- $A_{3/2}=8000$ Pa, $B_{3/2}=0.1$,\n- $A_{5/2}=5000$ Pa, $B_{5/2}=0.3$,\n- $A_{7/2}=2000$ Pa, $B_{7/2}=0.6$,\n- $A_{9/2}=0$ Pa, $B_{9/2}=1$.\n\n假设重力加速度 $g$ 不随高度变化，等于 $g=9.80665 \\text{ m s}^{-2}$。使用静力学关系和混合坐标映射来：\n\n1. 计算 $j\\in\\{0,1,2,3,4\\}$ 时界面气压 $p_{j+1/2}=A_{j+1/2}+B_{j+1/2}\\,p_{s}$（单位：帕斯卡）。\n2. 计算 $k\\in\\{1,2,3,4\\}$ 时各层的气压厚度 $\\Delta p_{k}=p_{k+1/2}-p_{k-1/2}$（单位：帕斯卡）。\n3. 从第一性原理推导，然后计算每层单位面积的质量 $m_{k}$（单位：$\\text{kg m}^{-2}$）。\n4. 明确验证 $\\sum_{k=1}^{4}\\Delta p_{k}=p_{s}-p_{t}$。\n\n最后，报告总气柱单位面积质量 $M=\\sum_{k=1}^{4}m_{k}$，以 $\\text{kg m}^{-2}$ 为单位，并四舍五入到四位有效数字。你最终报告的值必须是一个数字。",
            "solution": "解答过程遵循问题陈述中列出的四个任务，最终计算出总气柱单位面积质量。在计算中，所有气压都将转换为国际单位制单位帕斯卡（$Pa$）。\n\n给定的地表气压为 $p_{s} = 950 \\text{ hPa}$，相当于 $p_{s} = 95000 \\text{ Pa}$。模式顶层气压为 $p_{t} = 100 \\text{ hPa}$，即 $p_{t} = 10000 \\text{ Pa}$。重力加速度为 $g = 9.80665 \\text{ m s}^{-2}$。\n\n**1. 界面气压**\n\n每个半层界面的气压 $p_{j+1/2}$ 使用给定的混合坐标公式计算：\n$$\np_{j+1/2} = A_{j+1/2} + B_{j+1/2} \\, p_{s}\n$$\n索引为 $j \\in \\{0, 1, 2, 3, 4\\}$，对应于指定的五个界面。\n\n对于 $j=0$（界面 $1/2$）：\n$p_{1/2} = A_{1/2} + B_{1/2} \\, p_{s} = 10000 \\text{ Pa} + (0)(95000 \\text{ Pa}) = 10000 \\text{ Pa}$。这正确地匹配了模式顶层气压 $p_{t}$。\n\n对于 $j=1$（界面 $3/2$）：\n$p_{3/2} = A_{3/2} + B_{3/2} \\, p_{s} = 8000 \\text{ Pa} + (0.1)(95000 \\text{ Pa}) = 8000 \\text{ Pa} + 9500 \\text{ Pa} = 17500 \\text{ Pa}$。\n\n对于 $j=2$（界面 $5/2$）：\n$p_{5/2} = A_{5/2} + B_{5/2} \\, p_{s} = 5000 \\text{ Pa} + (0.3)(95000 \\text{ Pa}) = 5000 \\text{ Pa} + 28500 \\text{ Pa} = 33500 \\text{ Pa}$。\n\n对于 $j=3$（界面 $7/2$）：\n$p_{7/2} = A_{7/2} + B_{7/2} \\, p_{s} = 2000 \\text{ Pa} + (0.6)(95000 \\text{ Pa}) = 2000 \\text{ Pa} + 57000 \\text{ Pa} = 59000 \\text{ Pa}$。\n\n对于 $j=4$（界面 $9/2$）：\n$p_{9/2} = A_{9/2} + B_{9/2} \\, p_{s} = 0 \\text{ Pa} + (1)(95000 \\text{ Pa}) = 95000 \\text{ Pa}$。这正确地匹配了地表气压 $p_{s}$。\n\n**2. 层的气压厚度**\n\n每个模式层 $k$ 的气压厚度由 $\\Delta p_{k} = p_{k+1/2} - p_{k-1/2}$ 给出，其中 $k \\in \\{1, 2, 3, 4\\}$。\n\n对于层 $k=1$：\n$\\Delta p_{1} = p_{3/2} - p_{1/2} = 17500 \\text{ Pa} - 10000 \\text{ Pa} = 7500 \\text{ Pa}$。\n\n对于层 $k=2$：\n$\\Delta p_{2} = p_{5/2} - p_{3/2} = 33500 \\text{ Pa} - 17500 \\text{ Pa} = 16000 \\text{ Pa}$。\n\n对于层 $k=3$：\n$\\Delta p_{3} = p_{7/2} - p_{5/2} = 59000 \\text{ Pa} - 33500 \\text{ Pa} = 25500 \\text{ Pa}$。\n\n对于层 $k=4$：\n$\\Delta p_{4} = p_{9/2} - p_{7/2} = 95000 \\text{ Pa} - 59000 \\text{ Pa} = 36000 \\text{ Pa}$。\n\n**3. 层的单位面积质量**\n\n每层单位面积的质量 $m_k$ 是从静力学关系推导出来的。静力学方程通过局部空气密度 $\\rho$ 和重力加速度 $g$ 将气压变化 $dp$ 与几何高度变化 $dz$ 联系起来。在使用 $z$ 向上增加的坐标系中，该关系为：\n$$\ndp = -\\rho g \\, dz\n$$\n一个气层的单位面积质量是通过在该层的垂直范围内对密度进行积分得到的。考虑一个在高度 $z_{top}$ 和 $z_{bottom}$ 之间（其中 $z_{top}  z_{bottom}$）的气层，对应气压为 $p_{top}$ 和 $p_{bottom}$（其中 $p_{top}  p_{bottom}$）。其单位面积质量 $m$ 为：\n$$\nm = \\int_{z_{bottom}}^{z_{top}} \\rho(z) \\, dz\n$$\n从静力学方程，我们可以写出 $\\rho \\, dz = -\\frac{1}{g} \\, dp$。将其代入积分，得到：\n$$\nm = \\int_{p_{bottom}}^{p_{top}} -\\frac{1}{g} \\, dp = \\frac{1}{g} \\int_{p_{top}}^{p_{bottom}} dp\n$$\n由于假设 $g$ 是常数，我们可以积分得到：\n$$\nm = \\frac{p_{bottom} - p_{top}}{g} = \\frac{\\Delta p}{g}\n$$\n其中 $\\Delta p$ 是该层的气压厚度。\n\n使用这个结果，我们计算每层 $k$ 的单位面积质量：\n$m_{1} = \\frac{\\Delta p_{1}}{g} = \\frac{7500}{9.80665} \\text{ kg m}^{-2}$。\n$m_{2} = \\frac{\\Delta p_{2}}{g} = \\frac{16000}{9.80665} \\text{ kg m}^{-2}$。\n$m_{3} = \\frac{\\Delta p_{3}}{g} = \\frac{25500}{9.80665} \\text{ kg m}^{-2}$。\n$m_{4} = \\frac{\\Delta p_{4}}{g} = \\frac{36000}{9.80665} \\text{ kg m}^{-2}$。\n\n**4. 总气压厚度验证**\n\n问题要求验证 $\\sum_{k=1}^{4}\\Delta p_{k}=p_{s}-p_{t}$。\n从解析上看，这是一个伸缩求和：\n$$\n\\sum_{k=1}^{4}\\Delta p_{k} = (p_{3/2} - p_{1/2}) + (p_{5/2} - p_{3/2}) + (p_{7/2} - p_{5/2}) + (p_{9/2} - p_{7/2})\n$$\n$$\n= -p_{1/2} + (p_{3/2} - p_{3/2}) + (p_{5/2} - p_{5/2}) + (p_{7/2} - p_{7/2}) + p_{9/2} = p_{9/2} - p_{1/2}\n$$\n如前所述，$p_{9/2} = p_{s}$ 且 $p_{1/2} = p_{t}$。因此，恒等式 $\\sum_{k=1}^{4}\\Delta p_{k} = p_{s} - p_{t}$ 得到了解析验证。\n\n在数值上，使用计算出的值：\n$\\sum_{k=1}^{4}\\Delta p_{k} = 7500 + 16000 + 25500 + 36000 = 85000 \\text{ Pa}$。\n且 $p_{s} - p_{t} = 95000 \\text{ Pa} - 10000 \\text{ Pa} = 85000 \\text{ Pa}$。\n数值验证成功。\n\n**最终计算：总气柱单位面积质量**\n\n总气柱单位面积质量 $M$ 是各层质量之和：\n$$\nM = \\sum_{k=1}^{4} m_{k} = \\sum_{k=1}^{4} \\frac{\\Delta p_{k}}{g} = \\frac{1}{g} \\sum_{k=1}^{4} \\Delta p_{k}\n$$\n使用上一步验证的和：\n$$\nM = \\frac{p_{s} - p_{t}}{g}\n$$\n代入给定值：\n$$\nM = \\frac{95000 \\text{ Pa} - 10000 \\text{ Pa}}{9.80665 \\text{ m s}^{-2}} = \\frac{85000}{9.80665} \\text{ kg m}^{-2} \\approx 8667.5594 \\text{ kg m}^{-2}\n$$\n按照要求将此结果四舍五入到四位有效数字：\n前四位有效数字是 $8$、$6$、$6$、$7$。第五位数字是 $5$，因此我们将第四位数字向上取整。\n$M \\approx 8668 \\text{ kg m}^{-2}$。",
            "answer": "$$\\boxed{8668}$$"
        },
        {
            "introduction": "在地形追随坐标系中，水平气压梯度力（PGF）被分解为两个大的项，在静止大气中，这两项在解析上应精确抵消。然而，数值离散格式（如有限差分）在计算这两项时会引入微小的误差，这种不完美的抵消导致了一个净“虚假”力，即气压梯度力误差。本计算练习  直接展示了这一关键的数值挑战。你将编写代码来量化一个正弦地形上的虚假加速度，将度量项的解析概念与其在实践中产生的数值问题联系起来，并探究地形陡峭度和网格分辨率对其大小的影响。",
            "id": "4109526",
            "problem": "考虑一个在数值天气预报（NWP）和气候模拟背景下，处于静力平衡状态的二维干大气，并使用一种地形追随的高度垂直坐标变换。设物理垂直坐标为 $z$，变换后的坐标为 $\\eta \\in [0,1]$。地形高度由一个空间变化函数 $h(x)$ 给出，变换后坐标与物理垂直坐标之间的映射定义为\n$$\nz(x,\\eta) = h(x) + \\eta\\left(H_{\\text{top}} - h(x)\\right) = \\eta H_{\\text{top}} + (1-\\eta) h(x),\n$$\n其中 $H_{\\text{top}}$ 是恒定的模式顶层高度。假设虚温 $T_v$ 均匀，因此静力平衡等温大气满足静力平衡和理想气体定律，\n$$\n\\frac{\\partial p}{\\partial z} = -\\rho g, \\quad \\rho = \\frac{p}{R_d T_v},\n$$\n$p(z) = p_0 \\exp\\left(-\\frac{z}{H}\\right)$，标高 $H = \\frac{R_d T_v}{g}$，其中 $p_0$ 是 $z=0$ 处的参考气压，$g$ 是重力加速度，$R_d$ 是干空气气体常数。在连续方程中，对于水平均匀的等温大气，地形追随公式确保了 $x$ 方向动量方程中水平气压梯度项与相应度规项的精确抵消：\n$$\n-\\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} + g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta} = 0.\n$$\n然而，当使用中心差分进行离散化时，这种抵消是不完全的，并会产生伪水平加速度。\n\n您的任务是，对于正弦地形和均匀虚温 $T_v$，量化在等$\\eta$面上对$\\nabla_h p$使用中心差分计算时，由于不完全的气压梯度抵消所产生的伪水平加速度。假设如下：\n\n- 区域在$x$方向上周期为$L$。\n- 地形高度为 $h(x) = h_0 \\sin\\left(\\frac{2\\pi x}{L}\\right)$。\n- $x$ 网格有 $N$ 个均匀间隔的点，具有周期性边界条件，间距为 $\\Delta x = \\frac{L}{N}$，位置为 $x_i = i \\Delta x$，其中 $i = 0,1,\\dots,N-1$。\n- 使用中心差分来近似计算在等$\\eta$面上的水平导数：\n$$\nD_x f_i = \\frac{f_{i+1} - f_{i-1}}{2\\Delta x},\n$$\n采用周期性索引，即 $f_{-1} \\equiv f_{N-1}$ 且 $f_N \\equiv f_0$。\n- 在给定$\\eta$面上，网格点$i$处的伪水平加速度定义为\n$$\na_i = -\\frac{1}{\\rho_i} D_x p_i + g \\, D_x z_i,\n$$\n其中 $p_i = p\\big(z(x_i,\\eta)\\big)$，$\\rho_i = \\frac{p_i}{R_d T_v}$，以及 $z_i = z(x_i,\\eta)$。\n\n您必须计算所有$i$中伪加速度的最大绝对值：\n$$\na_{\\max} = \\max_{i} |a_i|.\n$$\n\n使用以下常数和单位：\n- $g = 9.80665 \\text{ m s}^{-2}$，\n- $R_d = 287 \\text{ J kg}^{-1} \\text{ K}^{-1}$，\n- $p_0 = 10^5$ Pa，\n- $H_{\\text{top}} = 20000$ m。\n所有输出必须以 $\\text{m s}^{-2}$ 为单位，表示为具有六位有效数字的科学记数法浮点数。\n\n构建一个程序，为以下每个测试用例计算 $a_{\\max}$：\n\n1. 正常情况：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$。\n2. 边界情况（平坦地形）：$h_0 = 0$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$。\n3. 更陡峭地形情况：$h_0 = 1000$ m, $L = 10000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$。\n4. 近地表层：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.1$, $N = 201$。\n5. 近顶层：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.9$, $N = 201$。\n6. 粗网格分辨率情况：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 21$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,...]”），每个结果是对应测试用例的 $a_{\\max}$，格式为具有六位有效数字的科学记数法。所有数值的单位都必须是 $\\text{m s}^{-2}$。",
            "solution": "该问题要求量化在地形追随坐标系中，由于水平气压梯度项的数值离散化而产生的伪水平加速度。这是数值天气预报中的一个经典问题，其中气压梯度力（PGF）被表示为两个大项，它们在解析上必须相互抵消，但在离散框架下抵消得并不完全。\n\n物理垂直坐标 $z$ 通过以下映射转换为地形追随坐标 $\\eta \\in [0,1]$：\n$$z(x,\\eta) = \\eta H_{\\text{top}} + (1-\\eta) h(x)$$\n其中 $h(x)$ 是地形高度，$H_{\\text{top}}$ 是模式顶边界的恒定高度。\n\n假设大气是干的、等温的，具有均匀的虚温 $T_v$，并处于静力平衡状态。在给定高度 $z$ 处的气压由以下公式给出：\n$$p(z) = p_0 \\exp\\left(-\\frac{z}{H}\\right)$$\n其中 $p_0$ 是 $z=0$ 处的参考气压，$H$ 是大气标高，定义为：\n$$H = \\frac{R_d T_v}{g}$$\n在这里，$R_d$ 是干空气的气体常数，$g$ 是重力加速度。密度 $\\rho$ 通过理想气体定律与气压和温度相关联，$\\rho = p / (R_d T_v)$。\n\n从解析上看，对于静止大气，等$\\eta$面上的水平气压梯度力与坐标变换产生的度规项完全平衡：\n$$-\\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} + g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta} = 0$$\n这是因为，根据链式法则，$\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} = \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta}$。给定静力平衡关系 $\\frac{\\partial p}{\\partial z} = -\\rho g$，我们有 $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} = -\\rho g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta}$，这保证了抵消。\n\n然而，当离散化后，这种抵消不再精确。该问题要求我们使用中心有限差分格式计算每个网格点 $x_i$ 在等$\\eta$面上的伪水平加速度 $a_i$，用于水平导数：\n$$a_i = -\\frac{1}{\\rho_i} D_x p_i + g \\, D_x z_i$$\n其中 $D_x f_i = \\frac{f_{i+1} - f_{i-1}}{2\\Delta x}$ 是具有周期性边界条件的中心差分算子。值 $p_i$、$\\rho_i$ 和 $z_i$ 是在指定的$\\eta$面上于网格点 $x_i$ 处计算的。目标是找到最大绝对伪加速度，$a_{\\max} = \\max_{i} |a_i|$。\n\n数值误差的来源可以阐明。离散气压梯度项为 $D_x p_i = \\frac{p_{i+1} - p_{i-1}}{2\\Delta x}$。根据中值定理，在 $z_{i-1}$ 和 $z_{i+1}$ 之间存在某个 $\\tilde{z}$，使得 $p_{i+1} - p_{i-1} = p'(\\tilde{z})(z_{i+1} - z_{i-1})$。由于 $p'(z) = \\frac{dp}{dz} = -\\rho(z) g$，我们可以写出 $D_x p_i = -\\rho(\\tilde{z}) g \\frac{z_{i+1} - z_{i-1}}{2\\Delta x} = -\\rho(\\tilde{z}) g D_x z_i$。\n将此代入 $a_i$ 的表达式中：\n$$a_i = -\\frac{1}{\\rho_i} \\left( -\\rho(\\tilde{z}) g D_x z_i \\right) + g D_x z_i = g \\left( \\frac{\\rho(\\tilde{z})}{\\rho_i} - 1 \\right) D_x z_i$$\n伪加速度 $a_i$ 不为零，是因为中间点 $\\rho(\\tilde{z})$ 的密度与网格点本身 $\\rho_i = \\rho(z_i)$ 的密度不同，这是由于密度对高度 $z$ 的非线性（指数）依赖性造成的。这种差异是有限差分近似截断误差的直接结果。\n\n为每个测试用例找到 $a_{\\max}$ 的计算步骤如下：\n\n$1$. 定义物理常数：$g = 9.80665 \\, \\text{m s}^{-2}$，$R_d = 287 \\, \\text{J kg}^{-1} \\text{K}^{-1}$，$p_0 = 10^5 \\, \\text{Pa}$，以及 $H_{\\text{top}} = 20000 \\, \\text{m}$。\n$2$. 对每个测试用例，检索参数：地形振幅 $h_0$、区域长度 $L$、虚温 $T_v$、垂直层级 $\\eta$ 和网格点数 $N$。\n$3$. 计算派生常数和网格参数：\n   - 标高：$H = \\frac{R_d T_v}{g}$。\n   - 网格间距：$\\Delta x = \\frac{L}{N}$。\n$4$. 构建水平网格：一个包含 $N$ 个点 $x_i = i \\Delta x$ 的数组，其中 $i_c = 0, 1, \\dots, N-1$。\n$5$. 计算每个网格点的地形高度：$h_i = h(x_i) = h_0 \\sin\\left(\\frac{2\\pi x_i}{L}\\right)$。\n$6$. 计算每个网格点上 $\\eta$ 表面的物理高度 $z_i$：$z_i = \\eta H_{\\text{top}} + (1-\\eta) h_i$。\n$7$. 计算每个网格点的气压 $p_i$ 和密度 $\\rho_i$：\n   - $p_i = p_0 \\exp\\left(-\\frac{z_i}{H}\\right)$。\n   - $\\rho_i = \\frac{p_i}{R_d T_v}$。\n$8$. 将周期性中心差分算子 $D_x$ 应用于 $z_i$ 和 $p_i$ 数组，以获得离散梯度 $D_x z_i$ 和 $D_x p_i$。这可以通过使用数组移位（例如 `numpy.roll`）来高效完成。\n   - $D_x z_i = \\frac{z_{i+1} - z_{i-1}}{2\\Delta x}$。\n   - $D_x p_i = \\frac{p_{i+1} - p_{i-1}}{2\\Delta x}$。\n$9$. 使用公式 $a_i = - \\frac{1}{\\rho_i} D_x p_i + g D_x z_i$ 计算每个网格点的伪加速度 $a_i$。\n$10$. 确定所得加速度数组的最大绝对值 $a_{\\max} = \\max_{i} |a_i|$。这是该测试用例的最终结果。\n\n对于 $h_0 = 0$ 的特殊情况，地形是平坦的，$h(x) = 0$。因此，$z(x,\\eta) = \\eta H_{\\text{top}}$ 对所有 $x$ 都是常数。这意味着 $z_i$ 是一个常数数组，$p_i$ 和 $\\rho_i$ 也是。因此，离散导数 $D_x z_i$ 和 $D_x p_i$ 精确为零，导致所有 $i$ 的 $a_i = 0$，且 $a_{\\max} = 0$。这为实现提供了一个有用的验证检查。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum spurious horizontal acceleration due to pressure\n    gradient errors in a terrain-following coordinate system.\n    \"\"\"\n\n    # Define constants\n    G = 9.80665  # m s^-2\n    R_D = 287.0    # J kg^-1 K^-1\n    P0 = 1.0e5   # Pa\n    H_TOP = 20000.0  # m\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h0, L, Tv, eta, N)\n        (1000.0, 50000.0, 300.0, 0.5, 201), # Case 1: Happy path\n        (0.0, 50000.0, 300.0, 0.5, 201),    # Case 2: Boundary (flat terrain)\n        (1000.0, 10000.0, 300.0, 0.5, 201), # Case 3: Steeper terrain\n        (1000.0, 50000.0, 300.0, 0.1, 201), # Case 4: Near-surface level\n        (1000.0, 50000.0, 300.0, 0.9, 201), # Case 5: Near-top level\n        (1000.0, 50000.0, 300.0, 0.5, 21),  # Case 6: Coarse-grid resolution\n    ]\n\n    results = []\n    for case in test_cases:\n        h0, L, Tv, eta, N = case\n\n        # Handle the trivial flat terrain case analytically to avoid potential\n        # floating point noise.\n        if h0 == 0.0:\n            results.append(\"{:.6e}\".format(0.0))\n            continue\n\n        # 1. Calculate derived constants and grid parameters\n        H_scale = (R_D * Tv) / G\n        dx = L / N\n\n        # 2. Construct the horizontal grid\n        x_grid = np.arange(N) * dx\n\n        # 3. Compute terrain and physical height\n        h_grid = h0 * np.sin(2.0 * np.pi * x_grid / L)\n        z_grid = eta * H_TOP + (1.0 - eta) * h_grid\n\n        # 4. Compute pressure and density\n        p_grid = P0 * np.exp(-z_grid / H_scale)\n        rho_grid = p_grid / (R_D * Tv)\n\n        # 5. Compute discrete derivatives using centered differences\n        # np.roll provides periodic boundary handling\n        # D_x f_i = (f_{i+1} - f_{i-1}) / (2 * dx)\n        dz_dx = (np.roll(z_grid, -1) - np.roll(z_grid, 1)) / (2.0 * dx)\n        dp_dx = (np.roll(p_grid, -1) - np.roll(p_grid, 1)) / (2.0 * dx)\n\n        # 6. Calculate the spurious acceleration at each grid point\n        # a_i = - (1/rho_i) * D_x(p)_i + g * D_x(z)_i\n        spurious_accel = -(1.0 / rho_grid) * dp_dx + G * dz_dx\n\n        # 7. Find the maximum absolute value\n        a_max = np.max(np.abs(spurious_accel))\n\n        # 8. Format and store the result\n        results.append(\"{:.6e}\".format(a_max))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}