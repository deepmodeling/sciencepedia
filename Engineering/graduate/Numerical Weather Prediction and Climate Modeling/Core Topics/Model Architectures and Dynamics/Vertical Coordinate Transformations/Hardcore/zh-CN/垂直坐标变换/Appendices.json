{
    "hands_on_practices": [
        {
            "introduction": "在对大气进行建模之前，我们必须首先定义求解方程的网格。本练习将带您熟悉广泛应用的混合sigma-压力坐标系，通过计算模式层的压力和质量，具体地理解模式垂直结构的离散化方式。",
            "id": "4109536",
            "problem": "一个静力原始方程大气模式采用sigma-气压混合垂直坐标，该坐标在半层上通过映射 $p(\\eta)=A(\\eta)+B(\\eta)\\,p_{s}$ 定义，其中 $p$ 是气压，$A(\\eta)$ 的单位是气压，$B(\\eta)$ 是无量纲的，$p_{s}$ 是地面气压。考虑一个气柱，其地面气压 $p_{s}=950$ hPa，顶层气压固定为 $p_{t}=100$ hPa。该模式有 $N=4$ 个层，由5个半层界面界定，从上到下索引为 $\\eta_{1/2},\\eta_{3/2},\\eta_{5/2},\\eta_{7/2},\\eta_{9/2}$。这些界面上的混合坐标系数指定如下：\n- $A_{1/2}=10000$ Pa, $B_{1/2}=0$,\n- $A_{3/2}=8000$ Pa, $B_{3/2}=0.1$,\n- $A_{5/2}=5000$ Pa, $B_{5/2}=0.3$,\n- $A_{7/2}=2000$ Pa, $B_{7/2}=0.6$,\n- $A_{9/2}=0$ Pa, $B_{9/2}=1$.\n\n假设重力加速度 $g$ 不随高度变化，等于 $g=9.80665$ m s$^{-2}$。使用静力学关系和混合坐标映射来：\n\n1. 对于 $j\\in\\{0,1,2,3,4\\}$，计算界面气压 $p_{j+1/2}=A_{j+1/2}+B_{j+1/2}\\,p_{s}$，单位为帕斯卡。\n2. 对于 $k\\in\\{1,2,3,4\\}$，计算层的气压厚度 $\\Delta p_{k}=p_{k+1/2}-p_{k-1/2}$，单位为帕斯卡。\n3. 从第一性原理推导，然后计算每层的单位面积质量 $m_{k}$，单位为 kg m$^{-2}$。\n4. 明确验证 $\\sum_{k=1}^{4}\\Delta p_{k}=p_{s}-p_{t}$。\n\n最后，报告总气柱单位面积质量 $M=\\sum_{k=1}^{4}m_{k}$，以 kg m$^{-2}$ 为单位表示，并四舍五入到四位有效数字。你最终报告的值必须是一个单一的数字。",
            "solution": "所述问题具有科学依据，提法恰当且客观。它描述了一种大气模式中使用的标准sigma-气压混合垂直坐标系。所有的定义、数据和约束都是自洽且一致的。所要求的计算基于基本原理，特别是静力平衡。因此，该问题是有效的，可以构建一个完整的解。\n\n求解过程遵循问题陈述中列出的四个任务，最终计算出总气柱单位面积质量。所有气压在计算中都将转换为国际单位制（SI）中的帕斯卡（Pa）。\n\n地面气压为 $p_{s} = 950 \\text{ hPa}$，相当于 $p_{s} = 95000 \\text{ Pa}$。模式顶层气压为 $p_{t} = 100 \\text{ hPa}$，即 $p_{t} = 10000 \\text{ Pa}$。重力加速度为 $g = 9.80665 \\text{ m s}^{-2}$。\n\n**1. 界面气压**\n\n每个半层界面的气压 $p_{j+1/2}$ 使用给定的混合坐标公式计算：\n$$\np_{j+1/2} = A_{j+1/2} + B_{j+1/2} \\, p_{s}\n$$\n索引为 $j \\in \\{0, 1, 2, 3, 4\\}$，对应于指定的五个界面。\n\n对于 $j=0$ (界面 $1/2$)：\n$p_{1/2} = A_{1/2} + B_{1/2} \\, p_{s} = 10000 \\text{ Pa} + (0)(95000 \\text{ Pa}) = 10000 \\text{ Pa}$。这与模式顶层气压 $p_{t}$ 正确匹配。\n\n对于 $j=1$ (界面 $3/2$)：\n$p_{3/2} = A_{3/2} + B_{3/2} \\, p_{s} = 8000 \\text{ Pa} + (0.1)(95000 \\text{ Pa}) = 8000 \\text{ Pa} + 9500 \\text{ Pa} = 17500 \\text{ Pa}$。\n\n对于 $j=2$ (界面 $5/2$)：\n$p_{5/2} = A_{5/2} + B_{5/2} \\, p_{s} = 5000 \\text{ Pa} + (0.3)(95000 \\text{ Pa}) = 5000 \\text{ Pa} + 28500 \\text{ Pa} = 33500 \\text{ Pa}$。\n\n对于 $j=3$ (界面 $7/2$)：\n$p_{7/2} = A_{7/2} + B_{7/2} \\, p_{s} = 2000 \\text{ Pa} + (0.6)(95000 \\text{ Pa}) = 2000 \\text{ Pa} + 57000 \\text{ Pa} = 59000 \\text{ Pa}$。\n\n对于 $j=4$ (界面 $9/2$)：\n$p_{9/2} = A_{9/2} + B_{9/2} \\, p_{s} = 0 \\text{ Pa} + (1)(95000 \\text{ Pa}) = 95000 \\text{ Pa}$。这与地面气压 $p_{s}$ 正确匹配。\n\n**2. 层的气压厚度**\n\n每个模式层 $k$ 的气压厚度由 $\\Delta p_{k} = p_{k+1/2} - p_{k-1/2}$ 给出，其中 $k \\in \\{1, 2, 3, 4\\}$。\n\n对于层 $k=1$：\n$\\Delta p_{1} = p_{3/2} - p_{1/2} = 17500 \\text{ Pa} - 10000 \\text{ Pa} = 7500 \\text{ Pa}$。\n\n对于层 $k=2$：\n$\\Delta p_{2} = p_{5/2} - p_{3/2} = 33500 \\text{ Pa} - 17500 \\text{ Pa} = 16000 \\text{ Pa}$。\n\n对于层 $k=3$：\n$\\Delta p_{3} = p_{7/2} - p_{5/2} = 59000 \\text{ Pa} - 33500 \\text{ Pa} = 25500 \\text{ Pa}$。\n\n对于层 $k=4$：\n$\\Delta p_{4} = p_{9/2} - p_{7/2} = 95000 \\text{ Pa} - 59000 \\text{ Pa} = 36000 \\text{ Pa}$。\n\n**3. 层的单位面积质量**\n\n每层的单位面积质量 $m_k$ 是从静力学关系推导出来的。静力学方程通过局部空气密度 $\\rho$ 和重力加速度 $g$ 将气压变化 $dp$ 与几何高度变化 $dz$ 联系起来。使用 $z$ 向上增加的坐标系，该关系为：\n$$\ndp = -\\rho g \\, dz\n$$\n空气层的单位面积质量是通过在该层的垂直范围内对密度进行积分得到的。考虑一个位于高度 $z_{top}$ 和 $z_{bottom}$ 之间（其中 $z_{top} > z_{bottom}$），对应气压为 $p_{top}$ 和 $p_{bottom}$ （其中 $p_{top}  p_{bottom}$）的层。其单位面积质量 $m$ 为：\n$$\nm = \\int_{z_{bottom}}^{z_{top}} \\rho(z) \\, dz\n$$\n根据静力学方程，我们可以写出 $\\rho \\, dz = -\\frac{1}{g} \\, dp$。将其代入积分，得到：\n$$\nm = \\int_{p_{bottom}}^{p_{top}} -\\frac{1}{g} \\, dp = \\frac{1}{g} \\int_{p_{top}}^{p_{bottom}} dp\n$$\n由于假设 $g$ 为常数，我们可以积分得到：\n$$\nm = \\frac{p_{bottom} - p_{top}}{g} = \\frac{\\Delta p}{g}\n$$\n其中 $\\Delta p$ 是该层的气压厚度。\n\n利用这个结果，我们计算每层 $k$ 的单位面积质量：\n$m_{1} = \\frac{\\Delta p_{1}}{g} = \\frac{7500}{9.80665} \\text{ kg m}^{-2}$。\n$m_{2} = \\frac{\\Delta p_{2}}{g} = \\frac{16000}{9.80665} \\text{ kg m}^{-2}$。\n$m_{3} = \\frac{\\Delta p_{3}}{g} = \\frac{25500}{9.80665} \\text{ kg m}^{-2}$。\n$m_{4} = \\frac{\\Delta p_{4}}{g} = \\frac{36000}{9.80665} \\text{ kg m}^{-2}$。\n\n**4. 总气压厚度验证**\n\n问题要求验证 $\\sum_{k=1}^{4}\\Delta p_{k}=p_{s}-p_{t}$。\n解析上，这是一个伸缩求和：\n$$\n\\sum_{k=1}^{4}\\Delta p_{k} = (p_{3/2} - p_{1/2}) + (p_{5/2} - p_{3/2}) + (p_{7/2} - p_{5/2}) + (p_{9/2} - p_{7/2})\n$$\n$$\n= -p_{1/2} + (p_{3/2} - p_{3/2}) + (p_{5/2} - p_{5/2}) + (p_{7/2} - p_{7/2}) + p_{9/2} = p_{9/2} - p_{1/2}\n$$\n如前所述，$p_{9/2} = p_{s}$ 且 $p_{1/2} = p_{t}$。因此，恒等式 $\\sum_{k=1}^{4}\\Delta p_{k} = p_{s} - p_{t}$ 得到了解析验证。\n\n数值上，使用计算出的值：\n$\\sum_{k=1}^{4}\\Delta p_{k} = 7500 + 16000 + 25500 + 36000 = 85000 \\text{ Pa}$。\n且 $p_{s} - p_{t} = 95000 \\text{ Pa} - 10000 \\text{ Pa} = 85000 \\text{ Pa}$。\n数值验证成功。\n\n**最终计算：总气柱单位面积质量**\n\n总气柱单位面积质量 $M$ 是各层质量之和：\n$$\nM = \\sum_{k=1}^{4} m_{k} = \\sum_{k=1}^{4} \\frac{\\Delta p_{k}}{g} = \\frac{1}{g} \\sum_{k=1}^{4} \\Delta p_{k}\n$$\n使用上一步验证的和：\n$$\nM = \\frac{p_{s} - p_{t}}{g}\n$$\n代入给定值：\n$$\nM = \\frac{95000 \\text{ Pa} - 10000 \\text{ Pa}}{9.80665 \\text{ m s}^{-2}} = \\frac{85000}{9.80665} \\text{ kg m}^{-2} \\approx 8667.5594 \\text{ kg m}^{-2}\n$$\n按要求将此结果四舍五入到四位有效数字：\n前四位有效数字是 $8$、$6$、$6$、$7$。第五位是 $5$，因此我们将第四位向上取整。\n$M \\approx 8668 \\text{ kg m}^{-2}$。",
            "answer": "$$\\boxed{8668}$$"
        },
        {
            "introduction": "数值模式必须守恒像质量这样的基本物理量。在之前练习的基础上，我们将引入时变的地面气压来计算层质量的变化趋势。该练习将展示混合坐标的构造如何确保整层大气柱的质量守恒，这对于气候模拟的长期稳定性至关重要。",
            "id": "4109492",
            "problem": "考虑在数值天气预报（NWP）和气候模型中使用的静力平衡大气，其混合压力-sigma垂直坐标定义为 $$p(\\eta,t) = A(\\eta) + B(\\eta)\\,p_{s}(t),$$ 其中 $\\eta \\in [0,1]$ 是地形跟随坐标，$p(\\eta,t)$ 是 $\\eta$ 层上的气压，$p_{s}(t)$ 是随时间变化的地面气压，$A(\\eta)$ 和 $B(\\eta)$ 是指定的光滑函数，满足 $A(0)=p_{t}$、$B(0)=0$、$A(1)=0$、$B(1)=1$。模式顶气压 $p_{t}$ 是一个常数。假设静力平衡，并根据静力平衡和标准连续介质力学，定义两个界面 $\\eta_{a}$（上）和 $\\eta_{b}$（下）之间的单位面积层质量。\n\n给定具体的混合坐标定义 $$A(\\eta) = p_{t}(1-\\eta), \\quad B(\\eta) = \\eta,$$ 及 $$p_{t} = 2.5 \\times 10^{4}\\ \\mathrm{Pa}, \\quad p_{s}(t) = p_{s0} + \\alpha\\,t,$$ 其中 $p_{s0}$ 是一个恒定的参考地面气压，$\\alpha$ 是一个单位为 $\\mathrm{Pa\\,s^{-1}}$ 的常数。重力加速度 $g$ 被视为一个常数。考虑一个离散为三层、由四个 $\\eta$ 界面分隔的气柱：$$\\eta_{0} = 0.0,\\quad \\eta_{1} = 0.4,\\quad \\eta_{2} = 0.8,\\quad \\eta_{3} = 1.0.$$\n\n仅从静力平衡、其所蕴含的单位面积质量定义以及给定的混合坐标映射 $p(\\eta,t)$ 出发：\n- 推导由 $\\eta_{a}$ 和 $\\eta_{b}$ 界定的层的单位面积质量的时间倾向的通用表达式，用 $A(\\eta)$、$B(\\eta)$、$p_{s}(t)$ 和 $g$ 表示。\n- 使用指定的 $A(\\eta)$ 和 $B(\\eta)$ 以及界面 $\\eta_{0},\\eta_{1},\\eta_{2},\\eta_{3}$，计算这三层中每一层的单位面积质量的时间倾向。\n- 通过将各层的时间倾向相加得到总气柱质量倾向，并将其与地面气压倾向联系起来，以验证气柱质量守恒。\n\n用千克每平方米每秒表示最终的气柱质量倾向。提供最终答案，形式为仅含 $\\alpha$ 和 $g$ 的单个闭式解析表达式。不要代入常数的数值。无需四舍五入。",
            "solution": "首先验证问题，以确保其科学上合理、适定且客观。\n\n### 步骤1：提取已知条件\n- 混合压力-sigma坐标：$p(\\eta,t) = A(\\eta) + B(\\eta)\\,p_{s}(t)$\n- 垂直坐标：$\\eta \\in [0,1]$\n- $\\eta$ 层上的气压：$p(\\eta,t)$\n- 地面气压：$p_{s}(t)$\n- 坐标函数：$A(\\eta)$, $B(\\eta)$\n- 边界条件：$A(0)=p_{t}$、$B(0)=0$、$A(1)=0$、$B(1)=1$\n- 模式顶气压：$p_{t}$（常数）\n- 假设：静力平衡\n- 定义：$\\eta_{a}$ 和 $\\eta_{b}$ 界面之间的单位面积层质量\n- 特定函数：$A(\\eta) = p_{t}(1-\\eta)$, $B(\\eta) = \\eta$\n- 模式顶气压值：$p_{t} = 2.5 \\times 10^{4}\\ \\mathrm{Pa}$\n- 地面气压演变：$p_{s}(t) = p_{s0} + \\alpha\\,t$\n- 常数：$p_{s0}$，$\\alpha$（单位为 $\\mathrm{Pa\\,s^{-1}}$）和 $g$\n- 离散化界面：$\\eta_{0} = 0.0$，$\\eta_{1} = 0.4$，$\\eta_{2} = 0.8$，$\\eta_{3} = 1.0$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，植根于大气动力学的标准原理，特别是在数值模型中混合坐标和静力平衡的使用。该问题是适定的，提供了进行所要求的推导所需的所有必要定义、函数和边界条件。语言客观且技术性强。给定的特定函数 $A(\\eta) = p_{t}(1-\\eta)$ 和 $B(\\eta) = \\eta$ 满足所述的边界条件：$A(0) = p_{t}(1-0) = p_t$、$B(0)=0$、$A(1) = p_{t}(1-1) = 0$ 和 $B(1)=1$。整个设定是自洽且内部一致的。\n\n### 步骤3：结论与行动\n问题有效。将构建详细的解答。\n\n### 解答推导\n\n我们从静力平衡方程开始，该方程将压力的微分变化 $dp$ 与静止流体中位势高度的微分变化 $dz$ 联系起来：\n$$dp = -\\rho g dz$$\n其中 $\\rho$ 是流体密度，$g$ 是重力加速度，假设为常数。厚度为 $dz$ 的微分层的单位面积质量为 $dM_{A} = \\rho dz$。从静力平衡方程，我们可以将其表示为：\n$$dM_{A} = -\\frac{dp}{g}$$\n位于上层气压 $p_{a}$ 和下层气压 $p_{b}$ 之间的有限大气层的单位面积质量 $M_{layer}$，可以通过对该表达式积分得到。注意，随着高度增加，气压降低，因此 $p_{a}  p_{b}$。\n$$M_{layer} = \\int_{p_{a}}^{p_{b}} \\left(-\\frac{dp}{g}\\right) = -\\frac{1}{g} [p]_{p_{a}}^{p_{b}} = \\frac{p_{b} - p_{a}}{g}$$\n这个基本结果将大气层的质量与其两端的压力差联系起来。\n\n在给定的混合坐标系中，气压层是垂直坐标 $\\eta$ 和时间 $t$ 的函数。一个层由上界面 $\\eta_{a}$ 和下界面 $\\eta_{b}$ 界定，其对应的气压为 $p(\\eta_{a}, t)$ 和 $p(\\eta_{b}, t)$。该层的单位面积质量为：\n$$M_{layer}(t) = \\frac{p(\\eta_{b}, t) - p(\\eta_{a}, t)}{g}$$\n\n**第1部分：层质量倾向的通用表达式**\n为了求出单位面积层质量的时间倾向，我们对 $M_{layer}(t)$ 求全时间导数。由于 $g$ 是常数，且界面 $\\eta_{a}$ 和 $\\eta_{b}$ 在坐标系中是固定的，导数仅作用于气压函数：\n$$\\frac{dM_{layer}}{dt} = \\frac{d}{dt} \\left( \\frac{p(\\eta_{b}, t) - p(\\eta_{a}, t)}{g} \\right) = \\frac{1}{g} \\left( \\frac{\\partial p(\\eta_{b}, t)}{\\partial t} - \\frac{\\partial p(\\eta_{a}, t)}{\\partial t} \\right)$$\n气压定义为 $p(\\eta,t) = A(\\eta) + B(\\eta)\\,p_{s}(t)$。我们计算其关于时间 $t$ 的偏导数。函数 $A(\\eta)$ 和 $B(\\eta)$ 仅依赖于坐标 $\\eta$，因此相对于时间是常数。\n$$\\frac{\\partial p(\\eta, t)}{\\partial t} = \\frac{\\partial}{\\partial t} [A(\\eta) + B(\\eta)\\,p_{s}(t)] = B(\\eta) \\frac{dp_{s}(t)}{dt}$$\n将此代入质量倾向方程，得到通用表达式：\n$$\\frac{dM_{layer}}{dt} = \\frac{1}{g} \\left( B(\\eta_{b}) \\frac{dp_{s}}{dt} - B(\\eta_{a}) \\frac{dp_s}{dt} \\right) = \\frac{1}{g} [B(\\eta_{b}) - B(\\eta_{a})] \\frac{dp_s}{dt}$$\n已知 $p_{s}(t) = p_{s0} + \\alpha t$，我们得到 $\\frac{dp_s}{dt} = \\alpha$。因此，介于 $\\eta_a$ 和 $\\eta_b$ 之间的层的单位面积质量的时间倾向的通用表达式为：\n$$\\frac{dM_{layer}}{dt} = \\frac{\\alpha}{g} [B(\\eta_{b}) - B(\\eta_{a})]$$\n\n**第2部分：特定层倾向的计算**\n我们使用特定函数 $B(\\eta) = \\eta$ 和给定的界面值来计算这三层中每一层的质量倾向。\n\n第1层：由 $\\eta_{a} = \\eta_{0} = 0.0$ 和 $\\eta_{b} = \\eta_{1} = 0.4$ 界定。\n$$\\frac{dM_{1}}{dt} = \\frac{\\alpha}{g} [B(\\eta_{1}) - B(\\eta_{0})] = \\frac{\\alpha}{g} [\\eta_{1} - \\eta_{0}] = \\frac{\\alpha}{g} [0.4 - 0.0] = 0.4 \\frac{\\alpha}{g}$$\n\n第2层：由 $\\eta_{a} = \\eta_{1} = 0.4$ 和 $\\eta_{b} = \\eta_{2} = 0.8$ 界定。\n$$\\frac{dM_{2}}{dt} = \\frac{\\alpha}{g} [B(\\eta_{2}) - B(\\eta_{1})] = \\frac{\\alpha}{g} [\\eta_{2} - \\eta_{1}] = \\frac{\\alpha}{g} [0.8 - 0.4] = 0.4 \\frac{\\alpha}{g}$$\n\n第3层：由 $\\eta_{a} = \\eta_{2} = 0.8$ 和 $\\eta_{b} = \\eta_{3} = 1.0$ 界定。\n$$\\frac{dM_{3}}{dt} = \\frac{\\alpha}{g} [B(\\eta_{3}) - B(\\eta_{2})] = \\frac{\\alpha}{g} [\\eta_{3} - \\eta_{2}] = \\frac{\\alpha}{g} [1.0 - 0.8] = 0.2 \\frac{\\alpha}{g}$$\n\n**第3部分：气柱质量守恒验证**\n为了验证质量守恒，我们将各层的倾向相加以求得总气柱质量倾向。\n$$\\frac{dM_{total}}{dt} = \\frac{dM_{1}}{dt} + \\frac{dM_{2}}{dt} + \\frac{dM_{3}}{dt} = 0.4 \\frac{\\alpha}{g} + 0.4 \\frac{\\alpha}{g} + 0.2 \\frac{\\alpha}{g} = (0.4 + 0.4 + 0.2) \\frac{\\alpha}{g} = 1.0 \\frac{\\alpha}{g} = \\frac{\\alpha}{g}$$\n现在，我们独立推导总气柱质量倾向，并证明它等于这个和。整个大气柱从模式顶（$\\eta=0$）延伸到地表（$\\eta=1$）。因此，总的单位面积质量 $M_{total}$ 为：\n$$M_{total}(t) = \\frac{p(\\eta=1, t) - p(\\eta=0, t)}{g}$$\n使用 $A(\\eta)$ 和 $B(\\eta)$ 的边界条件：\n$p(\\eta=1, t) = A(1) + B(1)p_{s}(t) = (0) + (1)p_{s}(t) = p_{s}(t)$\n$p(\\eta=0, t) = A(0) + B(0)p_{s}(t) = p_{t} + (0)p_{s}(t) = p_{t}$\n所以，总气柱质量为：\n$$M_{total}(t) = \\frac{p_{s}(t) - p_{t}}{g}$$\n总气柱质量的时间倾向是：\n$$\\frac{dM_{total}}{dt} = \\frac{d}{dt} \\left( \\frac{p_{s}(t) - p_{t}}{g} \\right)$$\n由于 $p_{t}$ 和 $g$ 是常数：\n$$\\frac{dM_{total}}{dt} = \\frac{1}{g} \\frac{dp_{s}}{dt}$$\n这个结果表明，大气柱总质量的变化完全由地表气压的变化决定，这是气柱质量守恒的一种表述。\n当 $\\frac{dp_s}{dt} = \\alpha$ 时，我们得到：\n$$\\frac{dM_{total}}{dt} = \\frac{\\alpha}{g}$$\n该表达式与通过将各层倾向相加得到的表达式相同。这证实了该公式是质量守恒的。\n\n所要求的最终答案是总气柱质量倾向，表示为仅含 $\\alpha$ 和 $g$ 的闭式解析表达式。这就是上面推导出的表达式。\n$\\alpha$ 的单位是 $\\mathrm{Pa\\,s^{-1}}$ 或 $\\mathrm{N\\,m^{-2}\\,s^{-1}}$，也就是 $\\mathrm{kg\\,m^{-1}\\,s^{-3}}$。$g$ 的单位是 $\\mathrm{m\\,s^{-2}}$。因此，$\\frac{\\alpha}{g}$ 的单位是 $\\frac{\\mathrm{kg\\,m^{-1}\\,s^{-3}}}{\\mathrm{m\\,s^{-2}}} = \\mathrm{kg\\,m^{-2}\\,s^{-1}}$，这正是单位面积质量每秒所需的单位。\n最终表达式为 $\\frac{\\alpha}{g}$。",
            "answer": "$$ \\boxed{\\frac{\\alpha}{g}} $$"
        },
        {
            "introduction": "使用地形追随坐标系的一大挑战是如何精确计算水平气压梯度力（PGF）。在本编程练习中，您将研究离散化误差如何在复杂地形上产生虚假的加速度。通过亲手量化这种“PGF误差”，您将更深刻地理解大气建模中的数值难题，以及发展高级数值方案的必要性。",
            "id": "4109526",
            "problem": "在数值天气预报（NWP）和气候模拟的背景下，考虑一个处于静力平衡状态的二维干空气大气，并使用一种基于地形追随高度的垂直坐标变换。设物理垂直坐标为 $z$，变换后的坐标为 $\\eta \\in [0,1]$。地形高度由一个随空间变化的函数 $h(x)$ 给出，变换后的垂直坐标与物理垂直坐标之间的映射定义为\n$$\nz(x,\\eta) = h(x) + \\eta\\left(H_{\\text{top}} - h(x)\\right) = \\eta H_{\\text{top}} + (1-\\eta) h(x),\n$$\n其中 $H_{\\text{top}}$ 是恒定的模式顶高。假设虚温 $T_v$ 均匀，因此静力平衡的等温大气满足静力平衡方程和理想气体定律，\n$$\n\\frac{\\partial p}{\\partial z} = -\\rho g, \\quad \\rho = \\frac{p}{R_d T_v},\n$$\n其中 $p(z) = p_0 \\exp\\left(-\\frac{z}{H}\\right)$，标高 $H = \\frac{R_d T_v}{g}$，$p_0$ 是 $z=0$ 处的参考气压，$g$ 是重力加速度，$R_d$ 是干空气气体常数。在连续方程中，对于水平均匀的等温大气，地形追随坐标系公式确保了x方向动量方程中的水平气压梯度项与相应的度规项能够精确抵消：\n$$\n-\\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} + g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta} = 0.\n$$\n然而，当使用中心差分进行离散化时，这种抵消是不完美的，会产生一个虚假的水平加速度。\n\n您的任务是，对于正弦地形和均匀虚温 $T_v$ 的情况，量化在等$\\eta$面上对 $\\nabla_h p$ 使用x方向中心差分时，由不完全的气压梯度抵消所产生的虚假水平加速度。假设如下：\n\n- 区域在 $x$ 方向上是周期性的，长度为 $L$。\n- 地形高度为 $h(x) = h_0 \\sin\\left(\\frac{2\\pi x}{L}\\right)$。\n- $x$ 网格有 $N$ 个均匀间隔的点，具有周期性边界条件，点的位置为 $x_i = i \\Delta x$（$i = 0,1,\\dots,N-1$），间距为 $\\Delta x = \\frac{L}{N}$。\n- 使用中心差分来近似恒定 $\\eta$ 上的水平导数：\n$$\nD_x f_i = \\frac{f_{i+1} - f_{i-1}}{2\\Delta x},\n$$\n采用周期性索引，即 $f_{-1} \\equiv f_{N-1}$ 且 $f_N \\equiv f_0$。\n- 在给定的 $\\eta$ 面上，网格点 $i$ 处的虚假水平加速度定义为\n$$\na_i = -\\frac{1}{\\rho_i} D_x p_i + g \\, D_x z_i,\n$$\n其中 $p_i = p\\big(z(x_i,\\eta)\\big)$，$\\rho_i = \\frac{p_i}{R_d T_v}$，以及 $z_i = z(x_i,\\eta)$。\n\n您必须计算所有 $i$ 点上虚假加速度的最大绝对值：\n$$\na_{\\max} = \\max_{i} |a_i|.\n$$\n\n使用以下常数和单位：\n- $g = 9.80665$ m s$^{-2}$,\n- $R_d = 287$ J kg$^{-1}$ K$^{-1}$,\n- $p_0 = 10^5$ Pa,\n- $H_{\\text{top}} = 20000$ m.\n所有输出必须以米每平方秒（m s$^{-2}$）为单位，并以包含六位有效数字的科学记数法浮点数表示。\n\n编写一个程序，为以下每个测试用例计算 $a_{\\max}$：\n\n1. 正常路径情况：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$.\n2. 边界情况（平坦地形）：$h_0 = 0$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$.\n3. 更陡峭的地形情况：$h_0 = 1000$ m, $L = 10000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 201$.\n4. 近地表层：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.1$, $N = 201$.\n5. 近顶层：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.9$, $N = 201$.\n6. 粗网格分辨率情况：$h_0 = 1000$ m, $L = 50000$ m, $T_v = 300$ K, $\\eta = 0.5$, $N = 21$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,...]”）。列表中的每个结果是对应测试用例的 $a_{\\max}$，格式为具有六位有效数字的科学记数法。所有数值的单位都必须是 m s$^{-2}$。",
            "solution": "该问题要求量化在地形追随坐标系中，由于水平气压梯度项的数值离散化而产生的虚假水平加速度。这是数值天气预报中的一个经典问题，其中气压梯度力（PGF）表示为两个大项，它们在解析上必须相互抵消，但在离散框架中抵消得不完美。\n\n物理垂直坐标 $z$ 通过以下映射转换为地形追随坐标 $\\eta \\in [0,1]$：\n$$z(x,\\eta) = \\eta H_{\\text{top}} + (1-\\eta) h(x)$$\n其中 $h(x)$ 是地形高度，$H_{\\text{top}}$ 是模式顶界的恒定高度。\n\n假设大气是干燥的、等温的，具有均匀的虚温 $T_v$，并且处于静力平衡状态。在给定高度 $z$ 处的气压由下式给出：\n$$p(z) = p_0 \\exp\\left(-\\frac{z}{H}\\right)$$\n其中 $p_0$ 是 $z=0$ 处的参考气压，$H$ 是大气标高，定义为：\n$$H = \\frac{R_d T_v}{g}$$\n此处，$R_d$ 是干空气的气体常数，$g$ 是重力加速度。密度 $\\rho$ 通过理想气体定律与气压和温度相关联，即 $\\rho = p / (R_d T_v)$。\n\n解析上，对于静止大气，等$\\eta$面上的水平气压梯度力被坐标变换产生的度规项精确平衡：\n$$-\\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} + g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta} = 0$$\n这是因为，根据链式法则，$\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} = \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta}$。给定静力学关系 $\\frac{\\partial p}{\\partial z} = -\\rho g$，我们有 $\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\eta} = -\\rho g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\eta}$，这保证了抵消。\n\n然而，当离散化后，这种抵消就不再精确。问题要求我们使用中心有限差分格式计算水平导数，从而计算出在等$\\eta$面上每个网格点 $x_i$ 处的虚假水平加速度 $a_i$：\n$$a_i = -\\frac{1}{\\rho_i} D_x p_i + g \\, D_x z_i$$\n其中 $D_x f_i = \\frac{f_{i+1} - f_{i-1}}{2\\Delta x}$ 是带有周期性边界条件的中心差分算子。值 $p_i$、$\\rho_i$ 和 $z_i$ 是在指定的 $\\eta$ 面上的网格点 $x_i$ 处计算的。目标是找到最大的绝对虚假加速度，$a_{\\max} = \\max_{i} |a_i|$。\n\n数值误差的来源可以阐明如下。离散气压梯度项为 $D_x p_i = \\frac{p_{i+1} - p_{i-1}}{2\\Delta x}$。根据中值定理，在 $z_{i-1}$ 和 $z_{i+1}$ 之间存在某个 $\\tilde{z}$，使得 $p_{i+1} - p_{i-1} = p'(\\tilde{z})(z_{i+1} - z_{i-1})$。由于 $p'(z) = \\frac{dp}{dz} = -\\rho(z) g$，我们可以写成 $D_x p_i = -\\rho(\\tilde{z}) g \\frac{z_{i+1} - z_{i-1}}{2\\Delta x} = -\\rho(\\tilde{z}) g D_x z_i$。\n将此代入 $a_i$ 的表达式中：\n$$a_i = -\\frac{1}{\\rho_i} \\left( -\\rho(\\tilde{z}) g D_x z_i \\right) + g D_x z_i = g \\left( \\frac{\\rho(\\tilde{z})}{\\rho_i} - 1 \\right) D_x z_i$$\n虚假加速度 $a_i$ 不为零，是因为中间点 $\\tilde{z}$ 处的密度 $\\rho(\\tilde{z})$ 与网格点本身的密度 $\\rho_i = \\rho(z_i)$ 不相同，这是由于密度对高度 $z$ 的非线性（指数）依赖关系所致。这种差异是有限差分近似的截断误差的直接后果。\n\n为每个测试用例找到 $a_{\\max}$ 的计算步骤如下：\n\n$1$. 定义物理常数：$g = 9.80665 \\, \\text{m s}^{-2}$，$R_d = 287 \\, \\text{J kg}^{-1} \\text{K}^{-1}$，$p_0 = 10^5 \\, \\text{Pa}$，以及 $H_{\\text{top}} = 20000 \\, \\text{m}$。\n$2$. 对于每个测试用例，获取参数：地形振幅 $h_0$、区域长度 $L$、虚温 $T_v$、垂直层次 $\\eta$ 和网格点数 $N$。\n$3$. 计算派生常数和网格参数：\n   - 标高：$H = \\frac{R_d T_v}{g}$。\n   - 网格间距：$\\Delta x = \\frac{L}{N}$。\n$4$. 构建水平网格：一个包含 $N$ 个点 $x_i = i \\Delta x$（$i_c = 0, 1, \\dots, N-1$）的数组。\n$5$. 计算每个网格点的地形高度：$h_i = h(x_i) = h_0 \\sin\\left(\\frac{2\\pi x_i}{L}\\right)$。\n$6$. 计算每个网格点上 $\\eta$ 面的物理高度 $z_i$：$z_i = \\eta H_{\\text{top}} + (1-\\eta) h_i$。\n$7$. 计算每个网格点的气压 $p_i$ 和密度 $\\rho_i$：\n   - $p_i = p_0 \\exp\\left(-\\frac{z_i}{H}\\right)$。\n   - $\\rho_i = \\frac{p_i}{R_d T_v}$。\n$8$. 将周期性中心差分算子 $D_x$ 应用于 $z_i$ 和 $p_i$ 数组，以获得离散梯度 $D_x z_i$ 和 $D_x p_i$。使用数组移位（例如 `numpy.roll`）可以高效地完成此操作。\n   - $D_x z_i = \\frac{z_{i+1} - z_{i-1}}{2\\Delta x}$。\n   - $D_x p_i = \\frac{p_{i+1} - p_{i-1}}{2\\Delta x}$。\n$9$. 使用公式 $a_i = - \\frac{1}{\\rho_i} D_x p_i + g D_x z_i$ 计算每个网格点的虚假加速度 $a_i$。\n$10$. 确定结果加速度数组的最大绝对值 $a_{\\max} = \\max_{i} |a_i|$。这是该测试用例的最终结果。\n\n对于 $h_0 = 0$ 的特殊情况，地形是平坦的，$h(x) = 0$。因此，$z(x,\\eta) = \\eta H_{\\text{top}}$ 对所有 $x$ 都是常数。这意味着 $z_i$ 是一个常数数组，$p_i$ 和 $\\rho_i$ 也是。因此，离散导数 $D_x z_i$ 和 $D_x p_i$ 精确为零，导致所有 $i$ 的 $a_i = 0$，且 $a_{\\max} = 0$。这为实现提供了一个有用的验证性检查。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum spurious horizontal acceleration due to pressure\n    gradient errors in a terrain-following coordinate system.\n    \"\"\"\n\n    # Define constants\n    G = 9.80665  # m s^-2\n    R_D = 287.0    # J kg^-1 K^-1\n    P0 = 1.0e5   # Pa\n    H_TOP = 20000.0  # m\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h0, L, Tv, eta, N)\n        (1000.0, 50000.0, 300.0, 0.5, 201), # Case 1: Happy path\n        (0.0, 50000.0, 300.0, 0.5, 201),    # Case 2: Boundary (flat terrain)\n        (1000.0, 10000.0, 300.0, 0.5, 201), # Case 3: Steeper terrain\n        (1000.0, 50000.0, 300.0, 0.1, 201), # Case 4: Near-surface level\n        (1000.0, 50000.0, 300.0, 0.9, 201), # Case 5: Near-top level\n        (1000.0, 50000.0, 300.0, 0.5, 21),  # Case 6: Coarse-grid resolution\n    ]\n\n    results = []\n    for case in test_cases:\n        h0, L, Tv, eta, N = case\n\n        # Handle the trivial flat terrain case analytically to avoid potential\n        # floating point noise.\n        if h0 == 0.0:\n            results.append(\"{:.6e}\".format(0.0))\n            continue\n\n        # 1. Calculate derived constants and grid parameters\n        H_scale = (R_D * Tv) / G\n        dx = L / N\n\n        # 2. Construct the horizontal grid\n        x_grid = np.arange(N) * dx\n\n        # 3. Compute terrain and physical height\n        h_grid = h0 * np.sin(2.0 * np.pi * x_grid / L)\n        z_grid = eta * H_TOP + (1.0 - eta) * h_grid\n\n        # 4. Compute pressure and density\n        p_grid = P0 * np.exp(-z_grid / H_scale)\n        rho_grid = p_grid / (R_D * Tv)\n\n        # 5. Compute discrete derivatives using centered differences\n        # np.roll provides periodic boundary handling\n        # D_x f_i = (f_{i+1} - f_{i-1}) / (2 * dx)\n        dz_dx = (np.roll(z_grid, -1) - np.roll(z_grid, 1)) / (2.0 * dx)\n        dp_dx = (np.roll(p_grid, -1) - np.roll(p_grid, 1)) / (2.0 * dx)\n\n        # 6. Calculate the spurious acceleration at each grid point\n        # a_i = - (1/rho_i) * D_x(p)_i + g * D_x(z)_i\n        spurious_accel = -(1.0 / rho_grid) * dp_dx + G * dz_dx\n\n        # 7. Find the maximum absolute value\n        a_max = np.max(np.abs(spurious_accel))\n\n        # 8. Format and store the result\n        results.append(\"{:.6e}\".format(a_max))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}