## 引言
[垂直坐标系](@entry_id:1133787)是构建[数值天气预报](@entry_id:191656)（NWP）和气候模型的基石。尽管大气运动由一套普适的物理方程组所支配，但这些方程在不同坐标参照系下的数学形式却截然不同。这一选择并非纯粹的学术探讨，它直接决定了模型如何处理地球表面复杂的山脉地形，如何刻画大气的稳定层结，并最终影响到模拟的准确性、[计算效率](@entry_id:270255)和长期稳定性。然而，最直观的物理高度坐标在面对真实世界的复杂性时显得力不从心，这催生了气压坐标、[等熵坐标](@entry_id:1126753)以及地形追随坐标等一系列高级坐标系统的发展，但每种方案都伴随着独特的权衡与数值挑战。

本文旨在系统性地梳理垂直坐标变换的理论与实践，引导读者理解其在现代[地球系统模拟](@entry_id:203226)中的核心地位。通过本文，您将学习到：

*   **原理与机制**：我们将首先深入探讨广义垂直坐标变换的数学基础，剖析主流坐标系（如气压坐标、地形追随坐标）的内在优势，并揭示由此产生的关键数值问题，如气压[梯度力](@entry_id:166847)误差。
*   **应用与跨学科联系**：接着，我们将视野扩展到实际应用，考察这些原理如何在大气与海洋模型的设计、物理变量的诊断、以及与数据同化等前沿领域的交叉中发挥作用。
*   **动手实践**：最后，一系列编程练习将帮助您将理论知识转化为实践技能，通过亲手计算和分析来巩固对坐标系设计和[数值误差](@entry_id:635587)的理解。

现在，让我们从坐标变换最核心的数学原理出发，深入探索其精髓。

## 原理与机制

在[数值天气预报](@entry_id:191656)和气候模型中，对大气运动进行数学描述的控制方程组是理论基础。然而，这些方程在不同坐标系下的具体形式却大相径庭。选择合适的[垂直坐标系](@entry_id:1133787)，不仅能简化方程、提高[计算效率](@entry_id:270255)，还能有效处理复杂地形等棘手问题。本章将深入探讨垂直[坐标变换](@entry_id:172727)的基本原理，阐述不同坐标系的特点与适用性，并剖析由此引发的关键数值问题及其处理机制。

### 广义垂直坐标与控制方程的变换

从根本上说，任何在垂直方向上单调变化的标量都可以作为垂直坐标。尽管物理高度 $z$ 是最直观的选择，但出于种种考虑，模型开发者引入了气压 $p$、位温 $\theta$ 和[地形跟随坐标](@entry_id:1132950) $\sigma$ 等多种替代方案 。当我们将垂直坐标从物理高度 $z$ 变换为一个[广义坐标](@entry_id:156576) $\eta = \eta(x, y, z, t)$ 时，控制方程中的微分算子也必须进行相应的转换。

#### 水平梯度的变换

一个核心问题是如何处理水平梯度。在 $z$ 坐标系中，水平梯度 $\nabla_z$ 是在等高面上计算的。然而，在新的 $\eta$ 坐标系中，我们计算的是在等 $\eta$ 面上的梯度 $\nabla_\eta$。由于等 $\eta$ 面可能倾斜（即 $z$ 在等 $\eta$ 面上随水平位置变化），这两个梯度通常不相等。

设 $q(x,y,z,t)$ 是一个标量场，其在 $\eta$ 坐标系下的表达为 $Q(x,y,\eta,t)$。根据定义，在时空中的同一个点，这两个函数的值相等，即 $q(x,y,z,t) = Q(x,y,\eta(x,y,z,t),t)$。利用[多元函数](@entry_id:145643)求导的[链式法则](@entry_id:190743)，我们可以推导出在 $z$ 坐标系中计算的水平梯度 $(\nabla_h q)_z$ 与在 $\eta$ 坐标系中计算的水平梯度 $(\nabla_h Q)_\eta$ 之间的关系 ：

$$ (\nabla_h q)_z = (\nabla_h Q)_\eta + \frac{\partial Q}{\partial \eta} (\nabla_h \eta)_z $$

这个关系式至关重要。它表明，从一个坐标系到另一个坐标系的梯度变换，会产生一个与新坐标面坡度 $(\nabla_h \eta)_z$ 和场量自身垂直梯度 $\partial Q / \partial \eta$ 相关的“修正项”或“度规项”。这一项正是理解[地形跟随坐标](@entry_id:1132950)中气压[梯度力](@entry_id:166847)误差的数学基础。

#### 质量[连续性方程](@entry_id:195013)的变换

[质量守恒](@entry_id:204015)是流体运动的基本定律。在 $z$ 坐标系中，其[微分形式](@entry_id:146747)（即连续性方程）为：

$$ \frac{\partial \rho}{\partial t} + \frac{\partial (\rho u)}{\partial x} + \frac{\partial (\rho v)}{\partial y} + \frac{\partial (\rho w)}{\partial z} = 0 $$

其中 $\rho$ 是密度，$(u, v, w)$ 是三维速度分量。当我们将此方程变换到广义的 $(x, y, \eta)$ 坐标系时，方程的形式会发生改变。变换的关键在于坐标变换的雅可比行列式 $J = \partial z / \partial \eta$。这个量描述了新旧垂直坐标之间的局部拉伸关系。

变换后的连续性方程具有一个普适的通量形式 ：

$$ \frac{\partial (\rho J)}{\partial t} + \frac{\partial (\rho J u)}{\partial x} + \frac{\partial (\rho J v)}{\partial y} + \frac{\partial (\rho J \dot{\eta})}{\partial \eta} = 0 $$

此处，$\dot{\eta} = D\eta/Dt$ 是流体质点穿越等 $\eta$ 面的速度，即 $\eta$ 坐标系中的“垂直速度”。这个方程的核心是一个被称为 **伪密度** 或 **层质量** 的量，$\rho J$。它代表了单位水平面积、单位 $\eta$ 坐标厚度内的空气质量。在[静力平衡](@entry_id:163498)大气中（$\partial p / \partial z = -\rho g$），这个量可以被极大地简化：

$$ \rho J = \rho \frac{\partial z}{\partial \eta} = \rho \left( \frac{\partial p / \partial \eta}{\partial p / \partial z} \right) = \rho \left( \frac{\partial p / \partial \eta}{-\rho g} \right) = -\frac{1}{g}\frac{\partial p}{\partial \eta} $$

这个关系揭示了一个深刻的联系：一个坐标层内的质量与该层上下边界的气压差成正比。这一特性使得在所谓的“质量基”坐标（如气压坐标或由气压构造的[地形跟随坐标](@entry_id:1132950)）中，质量的计算变得异常简洁。

### 常用[垂直坐标系](@entry_id:1133787)评述

基于上述普适的变换原理，我们现在可以逐一审视几种主流[垂直坐标系](@entry_id:1133787)的特性和优势。

#### 高度坐标 ($z$坐标)

这是最自然的坐标系，其坐标面 $z=\text{const}$ 是水平的几何平面。在 $z$ 坐标系中，雅可比 $J = \partial z/\partial z = 1$，$\eta$ 坐标的垂直速度就是物理垂直速度 $w$。因此，连续性方程保持其原始形式，所有通量项中都明确包含密度 $\rho$ 。虽然直观，但在处理大尺度[静力平衡](@entry_id:163498)流动和复杂地形时，它并非最优选择。

#### 气压坐标 ($p$坐标)

气压 $p$ 是一个随高度单调递减的标量，因此可以作为垂直坐标。选择 $p$ 作为垂直坐标，极大地简化了原始方程组，使其成为大尺度动力学研究和业务预报的经典框架 。

其主要优势体现在以下几个方面：

1.  **水平气压[梯度力](@entry_id:166847) (PGF) 的简化**：在 $z$ 坐标系中，PGF 项是 $-\frac{1}{\rho}\nabla_z p$，其中包含了三个变量 ($\rho, p$)。而在 $p$ 坐标系中，通过坐标变换，该项优雅地变成了 $-\nabla_p \Phi$，其中 $\Phi = gz$ 是位势高度。PGF 的计算仅与[位势高度](@entry_id:269053)一个变量的水平梯度有关，形式大为简化。

2.  **质量连续性方程的简化**：这是 $p$ 坐标最显著的优点。将 $\eta=p$ 代入伪密度的表达式，我们得到 $\rho J = - \frac{1}{g}\frac{\partial p}{\partial p} = -1/g$。这是一个常数（假设 $g$ 不变）。因此，[连续性方程](@entry_id:195013) $\nabla_p \cdot \mathbf{u} + \partial \omega/\partial p = 0$ 中不再显式含有密度 $\rho$ 。这意味着在[静力平衡](@entry_id:163498)框架下，水平风的辐散/辐合与气压坐标垂直速度 $\omega = Dp/Dt$ 的垂直变化直接平衡。这种简化源于[静力平衡](@entry_id:163498)关系保证了任意两个等压面之间的空气质量仅取决于这两个等压面的气压差，而与局地密度或温度无关 。

3.  **物质导数的变换**：在 $p$ 坐标系中，物质导数中的垂直平流项 $w(\partial/\partial z)$ 被替换为 $\omega(\partial/\partial p)$，形式上保持了平流的结构 。

同时，[静力平衡](@entry_id:163498)方程本身也变换为 $\partial \Phi / \partial p = -1/\rho = -\alpha$，其中 $\alpha$ 是比容。这个关系式是 $p$ 坐标系中进行[热力学](@entry_id:172368)和动力学推导的基础 。

#### [等熵坐标](@entry_id:1126753) ($\theta$坐标)

在稳定层结的大气中（$\partial \theta / \partial z > 0$），位温 $\theta$ 随高度单调增加，因而也可作为垂直坐标 。以 $\theta$ 为垂直坐标的核心优势在于它与热力学第一定律的深刻联系。

根据[热力学](@entry_id:172368)方程，物质导数 $D\theta/Dt$ 正比于非绝热加热率 $Q$。具体来说，$\omega_\theta = D\theta/Dt = Q/(c_p \pi)$，其中 $\pi$ 是艾克纳函数 。这意味着在[绝热过程](@entry_id:138150) ($Q=0$) 中，空气质块的位温保持不变，即 $D\theta/Dt = 0$。因此，等熵面成为物质面，空气无法穿越。这为追踪物质运动和涡度动力学提供了极大的便利。两个等熵面之间的空气质量在绝热、无侧向通量的条件下是守恒的 。

在 $\theta$ 坐标系中，[连续性方程](@entry_id:195013)可以写作 ：

$$ \frac{\partial m_\theta}{\partial t} + \nabla_\theta \cdot (m_\theta \mathbf{v}_h) + \frac{\partial (m_\theta \omega_\theta)}{\partial \theta} = 0 $$

这里的伪密度 $m_\theta = \rho (\partial z / \partial \theta)$ 代表单位水平面积、单位 $\theta$ 厚度内的质量。方程的最后一项表示穿越等熵面的质量通量，这个通量仅在有非绝热加热或冷却时（$Q \neq 0$）才存在。因此，非绝热过程在 $\theta$ 坐标系中被直观地解释为一种“垂直运动”。

#### [地形跟随坐标](@entry_id:1132950) ($\sigma$坐标及其推广)

$z$ 坐标、 $p$ 坐标和 $\theta$ 坐标的坐标面都会与地表相交，这给处理下边界条件带来了困难。为了解决这个问题，Phillips (1957) 提出了[地形跟随坐标](@entry_id:1132950)，其最基本的形式是 $\sigma = p/p_s$，其中 $p_s$ 是地表气压。

在这个定义下，地表（$p=p_s$）永远对应于 $\sigma=1$ 这个坐标面，而模式顶（假设为 $p=0$）则对应 $\sigma=0$。由于在任意给定水平位置，$\partial \sigma / \partial z = (1/p_s)(\partial p/\partial z) = -\rho g/p_s  0$，所以 $\sigma$ 坐标随高度是严格单调递减的（或可以通过定义使其单调递增），保证了坐标的唯一性和层次的清晰性 。

现代模型中，常常采用更广义的混合（hybrid）[地形跟随坐标](@entry_id:1132950)，其一般形式可以写为 $p = A(\eta) + B(\eta)p_s$，其中 $\eta$ 是广义垂直坐标。通过精心设计函数 $A(\eta)$ 和 $B(\eta)$，可以使坐标面在低层跟随地形，而在高层逐渐过渡到平坦的等压面。这样做既能处理好地形，又能减小高层因坐标面倾斜带来的计算误差 。

### 数值实现中的关键问题

尽管广义[垂直坐标系](@entry_id:1133787)带来了诸多便利，但它们也在数值计算层面引入了新的挑战。

#### 气压[梯度力](@entry_id:166847)计算误差

在[地形跟随坐标](@entry_id:1132950)（如 $\sigma$ 坐标）中，一个长期存在且至关重要的问题是 **气压[梯度力](@entry_id:166847) (PGF) 的计算误差**。这个问题的根源在于，真实的水平气压[梯度力](@entry_id:166847)是作用在水平面（等 $z$ 面）上的，而在模型中我们计算的是沿倾斜的坐标面（等 $\sigma$ 面）的梯度。

根据梯度变换法则，在 $\sigma$ 坐标系中，水平气压[梯度力](@entry_id:166847)项（PGF）可以展开为两个大项的相减 ：

$$ -\frac{1}{\rho}\nabla_z p = \underbrace{\left( -\frac{1}{\rho}\nabla_\sigma p \right)}_{\text{A项}} - \underbrace{\left( g \nabla_\sigma z \right)}_{\text{B项}} $$

其中，A 项是沿倾斜坐标面计算的 PGF，B 项是重力位势沿倾斜坐标面的投影（一个度规项）。问题在于，在有地形的区域，尤其是在山脉上空，A 项和 B 项本身都是非常大的量，且符号相反。理论上，它们的和应该等于一个较小的、物理上真实的水平 PGF。但在离散的数值模型中，由于对不同变量（$p$, $\rho$, $z$）的差分格式存在[截断误差](@entry_id:140949)，这两个大项的相减无法做到精确抵消。这个微小的、未被抵消的残余部分，就是虚假的 PGF 误差。它可能比真实的 PGF 大得多，从而在静止大气中产生虚假的环流，严重破坏模拟结果的准确性 。

#### 下边界条件

正确施加下边界条件是保证模型物理真实性的前提。地球表面是一个不可穿透的物质面，这意味着紧贴地表的流体[质点](@entry_id:186768)必须随地表一起运动，不能有法向的质量通量穿过。这一物理原则在不同坐标系下有不同的数学表达 。

*   在 **高度坐标 ($z$坐标)** 中，地表为 $z=h(x,y)$。运动学条件要求流体的垂直速度必须匹配其在地表上的爬坡/下坡运动，即 $w = \mathbf{v}_h \cdot \nabla h$。

*   在 **气压坐标 ($p$坐标)** 中，下边界是 $p=p_s(x,y,t)$。此处的运动学条件转化为 $\omega = Dp_s/Dt$，即质点的气压变化率必须等于地表气压的变化率。

*   在 **[地形跟随坐标](@entry_id:1132950)** (如 $\sigma=p/p_s$ 或更广义的 $s=s(p, p_s)$) 中，通过设计，下边界本身就是一个坐标面（例如 $\sigma=1$ 或 $s=s_s$）。因此，运动学条件被极大地简化为该坐标系中的“垂直速度”为零，即 $\dot{\sigma}=0$ 或 $\dot{s}=0$。这正是引入[地形跟随坐标](@entry_id:1132950)的主要动机之一 。

#### 守恒的垂直重映

在[模型诊断](@entry_id:136895)、资料同化或不同[模型耦合](@entry_id:1128028)时，经常需要在不同[垂直坐标系](@entry_id:1133787)之间传递和插值物理场量（如水汽、化学示踪物等）。这个过程必须保证物理量的守恒性，特别是总质量的守恒。

一个垂直重映（或插值）方案被称为 **守恒的**，前提是它能保证整层大气柱中某个示踪物的总质量在插值前后保持不变。在[静力平衡](@entry_id:163498)大气中，单位水平面积内示踪物总质量 $M_q$ ([质量分数](@entry_id:161575)为 $q$) 等于 ：

$$ M_q = \int_{z_s}^{z_t} q \rho \, \mathrm{d}z = \frac{1}{g} \int_{p_t}^{p_s} q(p) \, \mathrm{d}p $$

因此，要实现质量守恒，插值方案必须保证积分 $\int q \, \mathrm{d}p$ 的值不变。简单的 **点对点插值**，例如[线性插值](@entry_id:137092)，通常不满足这个要求，因为它没有考虑每个格层所代表的质量权重。

一个 **[守恒重映](@entry_id:1122917)** 方案则必须考虑质量权重。例如，当将数据从源网格层插值到目标网格层时，目标层的平均值应该是与之重叠的各源网格层值的加权平均，权重正比于重叠部分的质量（或气压厚度 $\Delta p$）。

让我们通过一个例子来阐明。假设源网格有两层：$[400, 700]\,\mathrm{hPa}$，$\bar{q}_A=0.004$；$[700, 1000]\,\mathrm{hPa}$，$\bar{q}_B=0.006$。我们要将[数据插值](@entry_id:142568)到一个目标层：$[600, 1000]\,\mathrm{hPa}$。
目标层 $[600, 1000]\,\mathrm{hPa}$ 与源层 A 重叠的部分是 $[600, 700]\,\mathrm{hPa}$（厚度 $100\,\mathrm{hPa}$），与源层 B 重叠的部分是 $[700, 1000]\,\mathrm{hPa}$（厚度 $300\,\mathrm{hPa}$）。
[守恒插值](@entry_id:747711)得到的目标层平均值为：
$$ \bar{q}_{\text{target}} = \frac{\bar{q}_A \times (100\,\mathrm{hPa}) + \bar{q}_B \times (300\,\mathrm{hPa})}{100\,\mathrm{hPa} + 300\,\mathrm{hPa}} = \frac{0.004 \times 100 + 0.006 \times 300}{400} = 0.0055 $$
这种方法通过精确计算每个重叠部分的贡献，确保了总积分量 $\sum \bar{q}_i \Delta p_i$ 的守恒。而非守恒的插值方法则会引入或损失示踪物总质量，导致长期积分中出现严重偏差 。