## 引言
在数值天气预报和气候模拟等需要长期积分的领域，确保质量、动量和能量等基本物理量的守恒是[模型稳定性](@entry_id:636221)和物理真实性的基石。然而，许多传统的数值离散方法难以在离散层面严格满足这些守恒定律，从而导致模拟结果出现系统性偏差或崩溃。[有限体积法](@entry_id:141374)（Finite Volume Method, FVM）正是为解决这一根本性问题而设计的强大数值框架，其核心思想是直接从物理守恒定律的积分形式出发。

本文旨在系统性地介绍[有限体积法](@entry_id:141374)及其在[通量形式守恒](@entry_id:1125137)问题中的应用。

*   在“**原理与机制**”一章中，我们将深入剖析FVM如何从积分守恒定律出发，构建出保证[离散守恒](@entry_id:1123819)的数值格式。
*   随后，在“**应用与跨学科联系**”一章中，我们将展示这些原理如何应用于复杂的地球物理流体动力学问题，并探讨其与[多物理场耦合](@entry_id:171389)、前沿机器学习等领域的联系。
*   最后，通过“**动手实践**”环节，读者将有机会运用所学知识解决具体的概念和诊断问题，从而巩固对FVM核心思想的理解。

## 原理与机制

在[数值天气预报](@entry_id:191656)（NWP）和气候模型中，对质量、动量和能量等物理量的精确守恒是确保[长期模拟稳定性](@entry_id:1127447)和物理真实性的基石。[有限体积法](@entry_id:141374)（Finite Volume Method, FVM）是一种强大的数值技术，其核心设计理念正是为了在离散层面严格满足这些积分守恒定律。本章将深入探讨[有限体积法](@entry_id:141374)的基本原理与核心机制，阐明其如何从最基本的守恒定律出发，构建出既精确又稳健的数值格式。

### [有限体积法](@entry_id:141374)的基石：积分守恒定律

与直接在网格点上用差分近似导数的有限差分法不同，[有限体积法](@entry_id:141374)的出发点是守恒定律的积分形式。考虑一个由通量形式的[偏微分](@entry_id:194612)方程（PDE）描述的标量[守恒量](@entry_id:161475) $q(\mathbf{x}, t)$（例如，单位体积的污染物质量）：

$$
\frac{\partial q}{\partial t} + \nabla \cdot \mathbf{F}(q) = S(\mathbf{x}, t)
$$

其中 $\mathbf{F}$ 是物理通量矢量，$S$ 是单位体积的源汇项。这个微分形式的方程在物理上意味着 $q$ 的[局部变化率](@entry_id:264961)由通量的散度和局地源汇项决定。

[有限体积法](@entry_id:141374)的核心思想是要求该守恒定律在计算域内任意一个有限大小的、固定的控制体积（或称“单元”）$V_i$ 上积分成立。我们将上述方程在 $V_i$ 上进行体积积分：

$$
\int_{V_i} \left( \frac{\partial q}{\partial t} + \nabla \cdot \mathbf{F} \right) dV = \int_{V_i} S \, dV
$$

由于控制体积 $V_i$ 是固定的，我们可以将时间导数与空间积分交换次序。对于通量散度项，我们应用高斯散度定理，它将一个矢量场在体内的散度的体积分，转化为该矢量场穿过该体积边界的通量的[面积分](@entry_id:275394)  。这样，我们得到：

$$
\frac{d}{dt} \int_{V_i} q \, dV + \oint_{\partial V_i} \mathbf{F} \cdot \mathbf{n} \, dA = \int_{V_i} S \, dV
$$

其中 $\partial V_i$ 是控制体积 $V_i$ 的边界，$\mathbf{n}$ 是指向边界外部的[单位法向量](@entry_id:178851)。这个[积分方程](@entry_id:138643)是精确的，它揭示了一个深刻的物理原理：控制体积内[守恒量](@entry_id:161475) $q$ 的总量随时间的变化率，完全由穿过其边界的净通量和内部的源汇总量决定。这便是[有限体积法](@entry_id:141374)的物理和数学基石。

### 从积分到代数：半离散有限体积格式

为了将上述[积分方程](@entry_id:138643)转化为可计算的[代数方程](@entry_id:272665)，我们需要引入离散化。首先，我们定义控制体积 $V_i$ 内 $q$ 的**单元平均值** $\bar{q}_i(t)$：

$$
\bar{q}_{i}(t) = \frac{1}{|V_i|} \int_{V_{i}} q(\mathbf{x},t)\, dV
$$

其中 $|V_i|$ 是单元 $V_i$ 的体积。[有限体积法](@entry_id:141374)追踪和演化的正是这个单元平均值，而非某个特定点的数值。于是，积分[守恒方程](@entry_id:1122898)的左边第一项可以写成 $|V_i| \frac{d\bar{q}_i}{dt}$。

接下来，我们将边界上的[面积分](@entry_id:275394) $\oint_{\partial V_i} \mathbf{F} \cdot \mathbf{n} \, dA$ 离散化。控制体积的边界 $\partial V_i$ 由若干个“面”（face）组成，我们记为 $\mathcal{F}(i)$。面积分可以分解为对每个面的通量之和。对于通过面 $f$ 的精确通量，我们用一个**数值通量** $\Phi_f$ 来近似，它代表了穿过整个面 $f$ 的 $q$ 的总量。因此，我们有：

$$
\oint_{\partial V_i} \mathbf{F} \cdot \mathbf{n} \, dA \approx \sum_{f \in \mathcal{F}(i)} \Phi_{f}
$$

这里，$\Phi_f$ 被定义为指向单元外部的通量。同样，源汇项也用其单元平均值 $\bar{S}_{i} = \frac{1}{|V_i|}\int_{V_i} S \, dV$ 来近似。

将这些离散化定义代入积分守恒方程，并除以单元体积 $|V_i|$，我们便得到了单元 $i$ 中[守恒量](@entry_id:161475)平均值的**半离散（semi-discrete）有限体积[更新方程](@entry_id:264802)** ：

$$
\frac{d\bar{q}_{i}}{dt} = -\frac{1}{|V_i|} \sum_{f \in \mathcal{F}(i)} \Phi_f + \bar{S}_{i}
$$

以一个三维结构化网格为例，单元 $(i,j,k)$ 由位于 $(i\pm \tfrac{1}{2},j,k)$, $(i,j\pm \tfrac{1}{2},k)$ 和 $(i,j,k\pm \tfrac{1}{2})$ 的六个面所包围。其半离散[更新方程](@entry_id:264802)可以更具体地写为 ：

$$
\frac{d\bar{q}_{i,j,k}}{dt} = -\frac{1}{|V_{i,j,k}|}\Big(\Phi_{i+\frac{1}{2},j,k} - \Phi_{i-\frac{1}{2},j,k} + \Phi_{i,j+\frac{1}{2},k} - \Phi_{i,j-\frac{1}{2},k} + \Phi_{i,j,k+\frac{1}{2}} - \Phi_{i,j,k-\frac{1}{2}}\Big) + \bar{S}_{i,j,k}
$$

这里的通量被定义为沿坐标轴正方向为正。例如，$\Phi_{i+\frac{1}{2},j,k}$ 是通过右侧面的通量，而 $\Phi_{i-\frac{1}{2},j,k}$ 是通过左侧面的通量。这种“通量差分”的形式是[有限体积法](@entry_id:141374)的典型特征。

### [离散守恒](@entry_id:1123819)的奥秘：通量的伸缩求和

[有限体积法](@entry_id:141374)的真正威力在于其保证[离散守恒](@entry_id:1123819)的能力。让我们考察一个没有源汇项（$S=0$）且具有周期性或封闭边界（边界通量为零）的系统。物理上，系统内 $q$ 的总量 $M(t) = \int_{\Omega} q \, dV$ 应该是恒定的。[有限体积法](@entry_id:141374)是否能在离散层面复现这一特性？

答案是肯定的，其关键在于**[数值通量](@entry_id:145174)的一致性**。考虑一个位于单元 $i$ 和单元 $j$ 之间的内部面 $f$。从单元 $i$ 的角度看，通过面 $f$ 的向外通量为 $\Phi_f$；而从单元 $j$ 的角度看，由于其法向量方向相反，通过同一个面 $f$ 的向外通量应为 $-\Phi_f$。一个守恒的有限体积格式必须保证在计算中，对于任意一个内部面，一个单元流出的通量精确地等于相邻单元流入的通量  。

现在，我们将所有单元的半离散方程加起来，以考察离散总量 $M_h(t) = \sum_i |V_i| \bar{q}_i(t)$ 的变化率：

$$
\frac{d M_h}{dt} = \sum_i |V_i| \frac{d\bar{q}_i}{dt} = \sum_i \left( - \sum_{f \in \mathcal{F}(i)} \Phi_f \right)
$$

在这个对所有单元和所有面的总和中，每一个内部面 $f$ 都恰好出现两次：一次作为单元 $i$ 的出通量，一次作为相邻单元 $j$ 的出通量。由于它们大小相等、符号相反，它们对总和的贡献恰好抵消为零。这种现象被称为**伸缩求和（telescoping sum）**。

因此，所有内部通量都相互抵消，最终只剩下穿过整个计算域 $\Omega$ 外部边界的通量。于是，我们得到：

$$
\frac{d M_h}{dt} = - \sum_{f \in \partial \Omega} \Phi_{f}
$$

这个结果精确地模拟了连续情况下的全局守恒定律 。对于周期性或[封闭边界条件](@entry_id:1122502)，右侧为零，这意味着 $\frac{d M_h}{dt}=0$。离散总量 $M_h$ 在时间上是精确守恒的（在[机器精度](@entry_id:756332)内）。

这一性质是[有限体积法](@entry_id:141374)[空间离散化](@entry_id:172158)与生俱来的，它不依赖于网格的具体几何形状（无论是[正交网格](@entry_id:1129213)还是复杂的[曲线坐标](@entry_id:178535)网格），也不依赖于所使用的[时间积分](@entry_id:267413)方案的阶数 。如果在气候模型的长期积分中观察到某个[守恒量](@entry_id:161475)（如总质量或总能量）出现了系统性的漂移，这通常预示着数值格式的实现存在错误，例如对两个相邻单元计算了不一致的界面通量，从而破坏了通量的伸缩抵消特性  。

### 守恒形式 vs. 平流形式：方程选择的重要性

[有限体积法](@entry_id:141374)的守恒特性依赖于待解方程本身具有**守恒形式**或**[通量形式](@entry_id:273811)**，即 $\partial_t q + \nabla \cdot \mathbf{F} = S$。然而，许多物理方程可以通过数学恒等式写成其他等价形式。

以[可压缩流体](@entry_id:164617)中的标量输送为例，其[守恒形式](@entry_id:1122899)为 ：

$$
\frac{\partial q}{\partial t} + \nabla \cdot (\mathbf{u} q) = S
$$

其中 $q$ 是单位体积的[标量密度](@entry_id:161438)，$\mathbf{u}$ 是流体速度。利用矢量恒等式 $\nabla \cdot (\mathbf{u} q) = q (\nabla \cdot \mathbf{u}) + \mathbf{u} \cdot \nabla q$，并结合[物质导数](@entry_id:262900)的定义 $\frac{D}{Dt} = \frac{\partial}{\partial t} + \mathbf{u} \cdot \nabla$，我们可以推导出其等价的**平流形式**（或[非守恒形式](@entry_id:1128837)）：

$$
\frac{Dq}{Dt} = S - q(\nabla \cdot \mathbf{u})
$$

平流形式描述了跟随流体微团运动时 $q$ 的变化，其中 $-q(\nabla \cdot \mathbf{u})$ 一项表示由于流体膨胀或压缩导致的体积密度变化。

虽然在连续介质层面这两个方程是等价的，但在离散层面它们有着天壤之别。[有限体积法](@entry_id:141374)通过[离散[守](@entry_id:1123819)恒形式](@entry_id:1122899)，利用[通量散度](@entry_id:1125154)的结构来保证守恒性。而平流形式不具备“散度”结构，对其各项分别进行离散通常无法保证守恒。因此，在需要严格确保守恒性的有限体积模型中（尤其是用于长期气候模拟），必须选择并[离散守恒](@entry_id:1123819)形式的控制方程。平流形式则更适用于其他数值方法，如半拉格朗日法，该方法正是沿着流体质点的运动轨迹（特征线）进行积分 。

### 定义[数值通量](@entry_id:145174)：从[Godunov方法](@entry_id:749952)到高分辨率格式

到目前为止，我们尚未解决一个核心问题：如何计算界面上的[数值通量](@entry_id:145174) $\Phi_f$？由于我们只有单元平均值，界面上的值是未知的。

#### 一阶迎风格式：[Riemann问题](@entry_id:171440)的解

最基本且最具启发性的方法是**[Godunov方法](@entry_id:749952)**。它将每个单元界面处的状态不连续视为一个局部的**[黎曼问题](@entry_id:171440)（Riemann problem）**，并通过求解这个黎曼问题来确定界面上的状态，进而计算通量。

考虑最简单的一维线性[平流方程](@entry_id:144869) $q_t + (aq)_x = 0$，其中 $a$ 为常数速度 。在界面 $x_{i+1/2}$ 处，左侧状态为 $q_i^n$，右侧状态为 $q_{i+1}^n$。这个方程的解是沿着特征线 $x - at = \text{const}$ 传播的。
-   如果 $a > 0$，信息从左向右传播，界面上的状态由左侧的 $q_i^n$ 决定。
-   如果 $a  0$，信息从右向左传播，界面上的状态由右侧的 $q_{i+1}^n$ 决定。

因此，界面上的状态总是由“上游”或“迎风”方向的单元决定。这便引出了**[一阶迎风格式](@entry_id:749417)（first-order upwind scheme）** 的数值通量：

$$
F_{i+1/2} = a \cdot q_{i+1/2}^{\text{up}} = \begin{cases} a q_i^n  \text{if } a > 0 \\ a q_{i+1}^n  \text{if } a  0 \end{cases}
$$

这个分段定义的通量可以用一个更紧凑的表达式来表示 ：

$$
F_{i+1/2} = \frac{1}{2} a (q_i^n + q_{i+1}^n) - \frac{1}{2} |a| (q_{i+1}^n - q_i^n)
$$

第一项是[中心通量](@entry_id:747204)，第二项是与速度方向相关的[数值耗散](@entry_id:168584)项。正是这一项赋予了格式稳定性。

#### 格式的[误差分析](@entry_id:142477)：[数值耗散](@entry_id:168584)与数值频散

通过**修正方程分析（modified-equation analysis）**，我们可以洞察数值格式引入的误差的物理特性 。
-   一个简单的**[中心通量](@entry_id:747204)**，$F_{i+1/2} = a(q_i+q_{i+1})/2$，其[截断误差](@entry_id:140949)的[主导项](@entry_id:167418)是三阶导数项。这种误差会导致不同波长的波以不同的速度传播，产生非物理的振荡，称为**数值频散（numerical dispersion）**。
-   而**[迎风通量](@entry_id:143931)**的[截断误差](@entry_id:140949)[主导项](@entry_id:167418)是二阶导数项，形如 $D_{\text{num}} q_{xx}$。这相当于在原方程中增加了一个人工的扩散项，会使解中的尖锐梯度变得平滑，称为**[数值耗散](@entry_id:168584)（numerical dissipation）**。对于采用前向欧拉[时间积分](@entry_id:267413)的[一阶迎风格式](@entry_id:749417)，其数值扩散系数为 ：

    $$
    D_{\text{num}} = \frac{a \Delta x}{2} - \frac{a^2 \Delta t}{2} = \frac{a \Delta x}{2} (1 - C)
    $$

    其中 $C = a \Delta t / \Delta x$ 是库朗数（Courant number）。这个耗散项保证了格式在库朗数满足 $|C| \le 1$ 时的稳定性 。

#### [高分辨率格式](@entry_id:171070)：MUSCL方法与[斜率限制器](@entry_id:638003)

一阶迎风格式虽然稳定，但其强烈的[数值耗散](@entry_id:168584)在实际应用中往往是不可接受的。为了达到更高的精度，**MUSCL（Monotone Upstream-centered Schemes for Conservation Laws）** 方法被提出来 。其核心思想是在每个单元内进行更高阶的**数据重构**。例如，我们可以假设每个单元内的分布是线性的，而不再是常数。

一个线性重构的形式为 $q(x) = \bar{q}_i + \frac{\Delta q_i}{\Delta x}(x - x_i)$。其中，斜率 $\Delta q_i$ 的选取至关重要。如果直接使用中心差分等无限制的斜率，可能会在不连续处产生新的、非物理的极大或极小值（过冲和下冲）。为了避免这种情况，必须使用**[斜率限制器](@entry_id:638003)（slope limiter）**。

例如，**minmod限制器** 通过比较前向和后向的差值来确定一个既能保持[二阶精度](@entry_id:137876)又不会产生新[极值](@entry_id:145933)的斜率：

$$
\Delta q_i = \text{minmod}(\bar{q}_{i+1} - \bar{q}_i, \bar{q}_i - \bar{q}_{i-1})
$$

在得到限制后的斜率后，我们可以在单元的左右边界外插得到界面左右两侧的状态值 $(q_L, q_R)$。例如，在界面 $x_{i+1/2}$ 处，左侧的状态值为 $q_L = \bar{q}_i + \frac{1}{2}\Delta q_i$。然后，将[迎风](@entry_id:756372)思想应用于这些重构出的界面状态，即可得到一个二阶精度的[数值通量](@entry_id:145174)，例如 $F_{i+1/2} = a q_L$（当 $a>0$ 时）。这类结合了[高阶重构](@entry_id:750332)和[斜率限制器](@entry_id:638003)的格式被称为**高分辨率格式**，它们能够在光滑区域达到高精度，同时在间断附近保持稳定、无振荡的特性 。

### 在复杂系统中的应用：守恒变量与可压缩流

前面讨论的原理可以直接推广到NWP和气候模型中描述[可压缩流](@entry_id:747589)动的方程组。

首先，我们必须区分**守恒变量**和**[原始变量](@entry_id:753733)** 。守恒变量是那些直接出现在守恒定律积分形式中的量，通常是单位体积的密度，如质量密度 $\rho$、[动量密度](@entry_id:271360) $\rho\mathbf{u}$ 和总能量密度 $\rho E$。而[原始变量](@entry_id:753733)是更直观的物理量，如速度 $\mathbf{u}$、压强 $p$ 和温度 $T$。

为了保证[离散守恒](@entry_id:1123819)，[有限体积法](@entry_id:141374)必须演化[守恒变量](@entry_id:747720)。以动量方程为例，其守恒形式为：

$$
\frac{\partial (\rho \mathbf{u})}{\partial t} + \nabla \cdot (\rho \mathbf{u} \otimes \mathbf{u} + p\mathbf{I}) = \text{源汇项}
$$

而其非守恒的**矢量不变形式（vector-invariant form）** 则演化速度 $\mathbf{u}$，其平流项被分解为涡度项和动能梯度项 。只有对守恒形式的动量方程应用[有限体积法](@entry_id:141374)，才能通过通量的伸缩求和来保证动量的[离散守恒](@entry_id:1123819)。直接离散矢量不变形式通常无法保证动量守恒，尽管它可能在能量或涡度守恒方面有特定优势。

当方程的系数本身不连续时，这一原则更显重要。例如，在密度 $\rho(x)$ 有跳变的介质中输送示踪剂，其[守恒方程](@entry_id:1122898)为 $\frac{\partial (\rho \phi)}{\partial t} + \frac{\partial (u \rho \phi)}{\partial x} = 0$。这里的[守恒量](@entry_id:161475)是 $q = \rho\phi$。一个正确的迎风格式必须直接对[守恒量](@entry_id:161475) $q$ 进行[迎风](@entry_id:756372)操作，即通量为 $F = u \cdot q^{\text{up}}$，而不是对 $\rho$ 和 $\phi$ 分别进行某种平均或[迎风](@entry_id:756372)后再相乘 。这再次强调了[有限体积法](@entry_id:141374)的核心：识别并直接[离散守恒](@entry_id:1123819)通量。

综上所述，[有限体积法](@entry_id:141374)通过坚守积分守恒定律，并巧妙地设计数值通量以实现内部抵消，为复杂流体动力学系统的长期、稳健模拟提供了坚实的理论基础。从最简单的迎风格式到复杂的高分辨率格式，其设计哲学始终围绕着如何在离散世界中最好地复现物理守恒律这一核心目标。