{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of any robust numerical model is its adherence to fundamental physical principles, chief among them the conservation of mass. This exercise challenges you to prove this principle from first principles for a closed global atmosphere, using the continuous form of the conservation law. By analyzing the boundary conditions, you will demonstrate why the total mass within the domain must remain constant, setting a crucial benchmark for the numerical schemes that follow. ",
            "id": "4043035",
            "problem": "Consider a global dry atmosphere represented as a thin spherical shell surrounding a planet of radius $a$, with vertical coordinate $z \\in [0, H]$ measured upward from the surface, longitude $\\lambda \\in [0, 2\\pi)$ (periodic), and latitude $\\phi \\in [-\\pi/2, \\pi/2]$. Let the dry-air density be $\\rho(\\lambda, \\phi, z, t)$ and the velocity be $\\mathbf{u}(\\lambda, \\phi, z, t) = (u, v, w)$ in the eastward, northward, and vertical directions, respectively. The top ($z=H$) and bottom ($z=0$) boundaries are impermeable, meaning $w = 0$ at $z=0$ and $z=H$. There are no internal sources or sinks of dry-air mass.\n\nYou discretize the domain using the Finite Volume Method (FVM) on a logically rectangular grid in $(\\lambda, \\phi, z)$ with cell indices $(i, j, k)$ and spacings $\\Delta \\lambda_i$, $\\Delta \\phi_j$, and $\\Delta z_k$. In the thin-shell approximation, the volume of cell $(i, j, k)$ is $V_{i,j,k} = a^{2} \\cos\\phi_j \\,\\Delta \\lambda_i \\,\\Delta \\phi_j \\,\\Delta z_k$. Denote the outward face-normal, face-integrated dry-air mass fluxes by\n- $F^{\\lambda}_{i+1/2, j, k}(t) = \\int_{A^{\\lambda}_{i+1/2, j, k}} \\rho u \\, dA$ across the longitudinal face at $\\lambda_{i+1/2}$ with area $A^{\\lambda}_{i+1/2, j, k} = a \\,\\Delta \\phi_j \\,\\Delta z_k$,\n- $F^{\\phi}_{i, j+1/2, k}(t) = \\int_{A^{\\phi}_{i, j+1/2, k}} \\rho v \\, dA$ across the latitudinal face at $\\phi_{j+1/2}$ with area $A^{\\phi}_{i, j+1/2, k} = a \\cos\\phi_{j+1/2} \\,\\Delta \\lambda_i \\,\\Delta z_k$,\n- $F^{z}_{i, j, k+1/2}(t) = \\int_{A^{z}_{i, j, k+1/2}} \\rho w \\, dA$ across the horizontal face at $z_{k+1/2}$ with area $A^{z}_{i, j, k+1/2} = a^{2} \\cos\\phi_j \\,\\Delta \\lambda_i \\,\\Delta \\phi_j$.\n\nThe local dry-air mass conservation law in flux form is the fundamental starting point:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot \\left(\\rho \\mathbf{u}\\right) = 0.\n$$\n\nDefine the globally integrated, time-accumulated dry-air mass flux through the external boundary of the spherical shell over one time step $\\Delta t = t^{n+1} - t^{n}$ by\n$$\nI \\equiv \\int_{t^n}^{t^{n+1}} \\oint_{\\partial \\Omega} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS \\, dt,\n$$\nwhere $\\partial \\Omega$ is the physical boundary of the domain and $\\mathbf{n}$ is the outward unit normal.\n\nStarting from the local flux-form conservation law and using only the stated geometric and boundary assumptions (periodic longitude, impermeable top and bottom), compute the value of $I$. Your answer must be a single number or a single closed-form analytic expression. No rounding is required and no units should be reported in the final boxed answer.",
            "solution": "The problem asks for the value of the quantity $I$, defined as the globally integrated, time-accumulated dry-air mass flux through the external boundary of the domain:\n$$\nI \\equiv \\int_{t^n}^{t^{n+1}} \\oint_{\\partial \\Omega} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS \\, dt\n$$\nThe inner integral, $\\oint_{\\partial \\Omega} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS$, represents the net rate of mass transport out of the entire atmospheric domain $\\Omega$ at a given instant in time. The vector $\\rho \\mathbf{u}$ is the mass flux vector.\n\nThe domain $\\Omega$ is a spherical shell defined by the coordinate ranges: longitude $\\lambda \\in [0, 2\\pi)$, latitude $\\phi \\in [-\\pi/2, \\pi/2]$, and vertical coordinate $z \\in [0, H]$. The physical boundary of this domain, $\\partial \\Omega$, consists of surfaces where the domain is not continuous or periodic.\n\nLet's identify these boundary surfaces:\n1.  **Longitudinal boundaries:** The problem states that the domain is periodic in longitude $\\lambda$. This means the surfaces at $\\lambda=0$ and $\\lambda=2\\pi$ are identified. For any flow leaving the domain at $\\lambda=2\\pi$, an identical flow enters at $\\lambda=0$. Thus, there is no net flux contribution from these boundaries; they are not part of the external boundary $\\partial \\Omega$.\n2.  **Latitudinal boundaries:** The domain extends from the south pole ($\\phi = -\\pi/2$) to the north pole ($\\phi = \\pi/2$). The poles are points (or lines in the $(\\lambda, \\phi, z)$ space), not surfaces. The area of any latitudinal face shrinks to zero as $\\phi \\to \\pm \\pi/2$. Therefore, there are no physical boundaries at the poles and no mass flux across them.\n3.  **Vertical boundaries:** The domain is bounded below by the planet's surface at $z=0$ and above by the top of the atmosphere at $z=H$. These are physical, non-periodic boundaries.\n\nTherefore, the external boundary $\\partial \\Omega$ consists of two distinct surfaces: the bottom surface $S_{bottom}$ at $z=0$ and the top surface $S_{top}$ at $z=H$. The surface integral can be split into two parts:\n$$\n\\oint_{\\partial \\Omega} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS = \\int_{S_{top}} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS + \\int_{S_{bottom}} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS\n$$\nWe now analyze the integrand $\\rho\\,\\mathbf{u} \\cdot \\mathbf{n}$ on each of these surfaces.\n\n-   **At the top surface ($S_{top}$, where $z=H$):** The outward unit normal vector $\\mathbf{n}$ points in the positive vertical direction. The velocity vector is $\\mathbf{u} = (u, v, w)$. The dot product $\\mathbf{u} \\cdot \\mathbf{n}$ isolates the component of velocity normal to the surface, which is the vertical velocity $w$. The problem states that the top boundary is impermeable, with the condition $w = 0$ at $z=H$. Therefore, on this surface, the normal mass flux is $\\rho (\\mathbf{u} \\cdot \\mathbf{n}) = \\rho w = \\rho(0) = 0$. The integral over this surface is consequently zero:\n    $$\n    \\int_{S_{top}} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS = \\int_{S_{top}} \\rho w \\, dS = 0\n    $$\n\n-   **At the bottom surface ($S_{bottom}$, where $z=0$):** The outward unit normal vector $\\mathbf{n}$ points away from the domain, which means it points in the negative vertical direction. The dot product is $\\mathbf{u} \\cdot \\mathbf{n} = -w$. The problem states that the bottom boundary is also impermeable, with the condition $w = 0$ at $z=0$. Therefore, on this surface, the normal mass flux is $\\rho (\\mathbf{u} \\cdot \\mathbf{n}) = -\\rho w = -\\rho(0) = 0$. The integral over this surface is also zero:\n    $$\n    \\int_{S_{bottom}} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS = \\int_{S_{bottom}} (-\\rho w) \\, dS = 0\n    $$\nSince the flux is zero across all parts of the external boundary $\\partial \\Omega$, the total net mass flux out of the domain is zero at all times:\n$$\n\\oint_{\\partial \\Omega} \\rho \\,\\mathbf{u} \\cdot \\mathbf{n} \\, dS = 0 + 0 = 0 \\quad \\text{for all } t \\in [t^n, t^{n+1}]\n$$\nThis is a direct consequence of the \"no-flux\" or \"impermeable\" boundary conditions, which physically signifies a closed system with respect to mass exchange with its surroundings.\n\nThe problem asks for the value of $I$, which is the time integral of this net flux. Since the integrand is identically zero, the integral is also zero:\n$$\nI = \\int_{t^n}^{t^{n+1}} (0) \\, dt = 0\n$$\nThe local conservation law, $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0$, and the Divergence Theorem confirm this result. Integrating the conservation law over the entire domain $\\Omega$ gives:\n$$\n\\int_{\\Omega} \\frac{\\partial \\rho}{\\partial t} \\, dV + \\int_{\\Omega} \\nabla \\cdot (\\rho \\mathbf{u}) \\, dV = 0\n$$\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\rho \\, dV + \\oint_{\\partial \\Omega} \\rho \\mathbf{u} \\cdot \\mathbf{n} \\, dS = 0\n$$\nThis equation states that the rate of change of total mass in the domain, $\\frac{dM}{dt}$, is equal to the negative of the net mass flux out of the boundary. Since we have shown the boundary flux integral to be zero, it implies $\\frac{dM}{dt} = 0$. The total mass is conserved. The problem asks for the total mass that has crossed the boundary over a time interval, which must be zero. The detailed information regarding the finite volume discretization is consistent with this conclusion but not required for its derivation.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "While an ideal model conserves mass perfectly, numerical discretizations can introduce subtle errors, leading to a \"mass drift\" over time. This practice provides a hands-on method for developing a global mass budget diagnostic, a critical tool for model validation. By comparing the computed change in a tracer's mass to the known sources and sinks, you will learn how to quantify conservation errors and assess the integrity of a finite volume scheme. ",
            "id": "4042959",
            "problem": "Consider a global atmospheric tracer transported and transformed using the Finite Volume Method (FVM). Let the prognostic variable be the tracer mass density $q$ with units $\\mathrm{kg\\,m^{-3}}$, governed by the flux-form conservation law $\\frac{\\partial q}{\\partial t} + \\nabla \\cdot \\boldsymbol{F} = S$, where $\\boldsymbol{F}$ is the advective flux of $q$ and $S$ is the source-minus-sink per unit volume with units $\\mathrm{kg\\,m^{-3}\\,s^{-1}}$. The global domain is closed (no exchange across the external boundary). The model discretizes the global domain into $N$ control volumes (cells) $V_i$ with volumes $|V_i|$. Denote the cell-mean mass density at the beginning and end of a single time step by $\\bar{q}_i^{n}$ and $\\bar{q}_i^{n+1}$, respectively, and define $\\Delta \\bar{q}_i = \\bar{q}_i^{n+1} - \\bar{q}_i^{n}$. The source-minus-sink term is implemented through a volume-integrated rate for each cell, such that $\\int_{t}^{t+\\Delta t} \\bar{S}_i \\, dt$ has units of $\\mathrm{kg}$ and represents the cell’s time-integrated net production over the step.\n\nStarting from the flux-form conservation law and using control-volume integration, derive a global mass budget over one time step that compares the total change in tracer mass to the time-integrated, volume-integrated sources. Use this to construct a diagnostic for global mass drift over one time step, $\\Delta M$, which should vanish for a perfectly conservative discretization on a closed domain. Then, for the following five-cell global mesh, compute $\\Delta M$ using the provided data. Interpret a nonzero value as a numerical inconsistency arising from flux mismatch or time stepping.\n\nThe mesh and data are:\n- $|V_1| = 9.5 \\times 10^{16}\\ \\mathrm{m^{3}}$, $|V_2| = 1.3 \\times 10^{17}\\ \\mathrm{m^{3}}$, $|V_3| = 8.0 \\times 10^{16}\\ \\mathrm{m^{3}}$, $|V_4| = 1.1 \\times 10^{17}\\ \\mathrm{m^{3}}$, $|V_5| = 9.0 \\times 10^{16}\\ \\mathrm{m^{3}}$.\n- $\\bar{q}_1^{n} = 7.50 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$, $\\bar{q}_1^{n+1} = 7.55 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$; $\\bar{q}_2^{n} = 6.80 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$, $\\bar{q}_2^{n+1} = 6.78 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$; $\\bar{q}_3^{n} = 8.10 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$, $\\bar{q}_3^{n+1} = 8.11 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$; $\\bar{q}_4^{n} = 7.20 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$, $\\bar{q}_4^{n+1} = 7.19 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$; $\\bar{q}_5^{n} = 6.90 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$, $\\bar{q}_5^{n+1} = 6.91 \\times 10^{-3}\\ \\mathrm{kg\\,m^{-3}}$.\n- $\\int_{t}^{t+\\Delta t} \\bar{S}_1 \\, dt = 2.50 \\times 10^{12}\\ \\mathrm{kg}$, $\\int_{t}^{t+\\Delta t} \\bar{S}_2 \\, dt = 1.00 \\times 10^{11}\\ \\mathrm{kg}$, $\\int_{t}^{t+\\Delta t} \\bar{S}_3 \\, dt = 5.00 \\times 10^{10}\\ \\mathrm{kg}$, $\\int_{t}^{t+\\Delta t} \\bar{S}_4 \\, dt = 6.00 \\times 10^{10}\\ \\mathrm{kg}$, $\\int_{t}^{t+\\Delta t} \\bar{S}_5 \\, dt = 3.00 \\times 10^{10}\\ \\mathrm{kg}$.\n\nCompute the diagnostic $\\Delta M$ for this time step and express your final answer in $\\mathrm{kg}$. Round your answer to three significant figures.",
            "solution": "The derivation of the global mass budget begins with the governing flux-form conservation law for the tracer mass density $q$:\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot \\boldsymbol{F} = S\n$$\nHere, $q$ has units of $\\mathrm{kg\\,m^{-3}}$, $\\boldsymbol{F}$ is the advective flux vector, and $S$ is the source-minus-sink term per unit volume in $\\mathrm{kg\\,m^{-3}\\,s^{-1}}$.\n\nFor a Finite Volume Method (FVM) discretization, we integrate this partial differential equation over an arbitrary control volume $V_i$ within the domain:\n$$\n\\int_{V_i} \\frac{\\partial q}{\\partial t} \\, dV + \\int_{V_i} \\nabla \\cdot \\boldsymbol{F} \\, dV = \\int_{V_i} S \\, dV\n$$\nApplying the Leibniz integral rule to the first term (assuming a fixed control volume) and the divergence theorem to the second term, we transform the volume integrals:\n$$\n\\frac{d}{dt} \\int_{V_i} q \\, dV + \\oint_{\\partial V_i} \\boldsymbol{F} \\cdot d\\boldsymbol{A} = \\int_{V_i} S \\, dV\n$$\nwhere $\\partial V_i$ is the boundary surface of the control volume $V_i$ and $d\\boldsymbol{A}$ is the outward-pointing normal surface element.\n\nLet us define the total mass in cell $i$ as $M_i(t) = \\int_{V_i} q \\, dV$ and the volume-integrated source rate as $\\mathcal{S}_i(t) = \\int_{V_i} S \\, dV$. The equation for a single cell becomes:\n$$\n\\frac{dM_i}{dt} + \\oint_{\\partial V_i} \\boldsymbol{F} \\cdot d\\boldsymbol{A} = \\mathcal{S}_i(t)\n$$\nNext, we integrate this equation over a single time step from $t = t^n$ to $t = t^{n+1}$, with duration $\\Delta t = t^{n+1} - t^n$:\n$$\n\\int_{t^n}^{t^{n+1}} \\frac{dM_i}{dt} \\, dt + \\int_{t^n}^{t^{n+1}} \\left( \\oint_{\\partial V_i} \\boldsymbol{F} \\cdot d\\boldsymbol{A} \\right) dt = \\int_{t^n}^{t^{n+1}} \\mathcal{S}_i(t) \\, dt\n$$\nThe first term evaluates to the change in mass within cell $i$ over the time step: $M_i(t^{n+1}) - M_i(t^n)$. Let us denote the time-integrated net flux out of cell $i$ as $\\mathcal{F}_{i, \\Delta t}$ and the time-integrated source term as $\\mathcal{S}_{i, \\Delta t}$. The equation is:\n$$\nM_i^{n+1} - M_i^n + \\mathcal{F}_{i, \\Delta t} = \\mathcal{S}_{i, \\Delta t}\n$$\nTo obtain the global mass budget, we sum this equation over all $N$ control volumes in the domain:\n$$\n\\sum_{i=1}^{N} (M_i^{n+1} - M_i^n) + \\sum_{i=1}^{N} \\mathcal{F}_{i, \\Delta t} = \\sum_{i=1}^{N} \\mathcal{S}_{i, \\Delta t}\n$$\nThe first term represents the change in the total global mass, $\\Delta M_{total} = M_{total}^{n+1} - M_{total}^n$. The second term is the sum of all time-integrated fluxes across all cell boundaries. In a finite volume discretization, for any internal face shared between two adjacent cells, say $j$ and $k$, the flux leaving cell $j$ is identical in magnitude but opposite in sign to the flux entering cell $k$. Consequently, when summed over the entire domain, all internal fluxes cancel out perfectly. The sum reduces to the total flux across the external boundary of the global domain. Since the problem states the global domain is closed, this external flux is zero. Therefore, for a perfectly conservative numerical scheme, we must have:\n$$\n\\sum_{i=1}^{N} \\mathcal{F}_{i, \\Delta t} = 0\n$$\nThe ideal global mass budget is thus:\n$$\n\\Delta M_{total} = \\sum_{i=1}^{N} (M_i^{n+1} - M_i^n) = \\sum_{i=1}^{N} \\mathcal{S}_{i, \\Delta t}\n$$\nThis equation states that the total change in tracer mass must equal the total mass added by sources minus the total mass removed by sinks.\n\nA diagnostic for the global mass drift, $\\Delta M$, can be constructed by comparing the numerically computed change in total mass to the total integrated source. Any discrepancy arises from numerical errors in the transport scheme (e.g., inconsistent flux calculations at interfaces or non-conservative time integration). We define $\\Delta M$ as the difference:\n$$\n\\Delta M = \\left( \\sum_{i=1}^{N} M_i^{n+1} - \\sum_{i=1}^{N} M_i^n \\right) - \\sum_{i=1}^{N} \\mathcal{S}_{i, \\Delta t}\n$$\nUsing the provided cell-mean densities $\\bar{q}_i$ and cell volumes $|V_i|$, the mass in cell $i$ is approximated as $M_i = \\bar{q}_i |V_i|$. The term $\\mathcal{S}_{i, \\Delta t}$ corresponds to the given quantity $\\int_{t}^{t+\\Delta t} \\bar{S}_i \\, dt$. Thus, the diagnostic is:\n$$\n\\Delta M = \\sum_{i=1}^{N} (\\bar{q}_i^{n+1} - \\bar{q}_i^{n}) |V_i| - \\sum_{i=1}^{N} \\int_{t}^{t+\\Delta t} \\bar{S}_i \\, dt\n$$\nWe now compute $\\Delta M$ for the given $5$-cell mesh. First, we compute the total change in mass, $\\Delta M_{computed} = \\sum_{i=1}^{5} (\\bar{q}_i^{n+1} - \\bar{q}_i^{n}) |V_i|$:\n\\begin{itemize}\n    \\item Cell $1$: $\\Delta M_1 = (7.55 \\times 10^{-3} - 7.50 \\times 10^{-3}) \\, \\mathrm{kg\\,m^{-3}} \\times (9.5 \\times 10^{16} \\, \\mathrm{m^3}) = 4.75 \\times 10^{12} \\, \\mathrm{kg}$\n    \\item Cell $2$: $\\Delta M_2 = (6.78 \\times 10^{-3} - 6.80 \\times 10^{-3}) \\, \\mathrm{kg\\,m^{-3}} \\times (1.3 \\times 10^{17} \\, \\mathrm{m^3}) = -2.6 \\times 10^{12} \\, \\mathrm{kg}$\n    \\item Cell $3$: $\\Delta M_3 = (8.11 \\times 10^{-3} - 8.10 \\times 10^{-3}) \\, \\mathrm{kg\\,m^{-3}} \\times (8.0 \\times 10^{16} \\, \\mathrm{m^3}) = 0.8 \\times 10^{12} \\, \\mathrm{kg}$\n    \\item Cell $4$: $\\Delta M_4 = (7.19 \\times 10^{-3} - 7.20 \\times 10^{-3}) \\, \\mathrm{kg\\,m^{-3}} \\times (1.1 \\times 10^{17} \\, \\mathrm{m^3}) = -1.1 \\times 10^{12} \\, \\mathrm{kg}$\n    \\item Cell $5$: $\\Delta M_5 = (6.91 \\times 10^{-3} - 6.90 \\times 10^{-3}) \\, \\mathrm{kg\\,m^{-3}} \\times (9.0 \\times 10^{16} \\, \\mathrm{m^3}) = 0.9 \\times 10^{12} \\, \\mathrm{kg}$\n\\end{itemize}\nThe total computed change in mass is:\n$$\n\\Delta M_{computed} = (4.75 - 2.6 + 0.8 - 1.1 + 0.9) \\times 10^{12} \\, \\mathrm{kg} = 2.75 \\times 10^{12} \\, \\mathrm{kg}\n$$\nNext, we compute the total integrated source, $\\mathcal{S}_{total} = \\sum_{i=1}^{5} \\int_{t}^{t+\\Delta t} \\bar{S}_i \\, dt$:\n$$\n\\mathcal{S}_{total} = (2.50 \\times 10^{12} + 1.00 \\times 10^{11} + 5.00 \\times 10^{10} + 6.00 \\times 10^{10} + 3.00 \\times 10^{10}) \\, \\mathrm{kg}\n$$\n$$\n\\mathcal{S}_{total} = (2.50 + 0.100 + 0.050 + 0.060 + 0.030) \\times 10^{12} \\, \\mathrm{kg} = 2.74 \\times 10^{12} \\, \\mathrm{kg}\n$$\nFinally, the global mass drift $\\Delta M$ is the difference between these two quantities:\n$$\n\\Delta M = \\Delta M_{computed} - \\mathcal{S}_{total} = 2.75 \\times 10^{12} \\, \\mathrm{kg} - 2.74 \\times 10^{12} \\, \\mathrm{kg} = 0.01 \\times 10^{12} \\, \\mathrm{kg}\n$$\n$$\n\\Delta M = 1 \\times 10^{10} \\, \\mathrm{kg}\n$$\nThe problem requires the answer to be rounded to three significant figures. A non-zero value for $\\Delta M$ indicates that the numerical implementation is not perfectly conservative, resulting in a spurious creation of mass over the time step.\n\n$$\n\\Delta M = 1.00 \\times 10^{10} \\, \\mathrm{kg}\n$$",
            "answer": "$$\n\\boxed{1.00 \\times 10^{10}}\n$$"
        },
        {
            "introduction": "A conservative numerical scheme is of little use if it is unstable and produces nonsensical results. This exercise guides you through the derivation of the Courant-Friedrichs-Lewy (CFL) condition, a fundamental stability constraint for explicit time-stepping schemes. You will see how the stability of the solution depends on a crucial relationship between the time step, grid spacing, and the speed at which information propagates through the domain. ",
            "id": "4042968",
            "problem": "Consider the linear advection of a passive tracer field governed by the conservation law in flux form,\n$$\\frac{\\partial q}{\\partial t} + \\nabla \\cdot \\left( \\boldsymbol{U}\\, q \\right) = 0,$$\nwhere $q$ is the cell-averaged tracer mixing ratio and $\\boldsymbol{U} = (u, v, w)$ is a prescribed, time-independent velocity field. Assume an explicit first-order upwind finite volume discretization on a Cartesian grid. Time integration is by forward Euler, and fluxes are evaluated using upwind states based on the sign of the face-normal velocity component. The Courant–Friedrichs–Lewy (CFL) condition is the constraint that guarantees stability and nonnegativity of the update by ensuring that the new cell average is a convex combination of existing cell averages.\n\nTask A (one-dimensional derivation): Specialize to one spatial dimension with constant advection speed $a$ and spatially varying cell widths $\\Delta x_i$. Starting from the integral conservation law over a control volume and using the explicit upwind flux, derive the necessary stability constraint on the time step $\\Delta t$ that ensures the update is a convex combination of neighboring cell averages and thus preserves positivity and $L^1$ stability. Express the constraint in terms of $|a|$, $\\Delta x_i$, and a domain-wide condition.\n\nTask B (multi-dimensional generalization): For the three-dimensional case with uniform spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, and constant velocity components $u$, $v$, and $w$, derive the explicit CFL constraint on $\\Delta t$ imposed by the unsplit finite volume update with first-order upwind fluxes. Your derivation should start from the finite volume flux balance over a single cell and impose the convexity (all weights nonnegative and summing to one) of the update.\n\nTask C (numerical evaluation): Using your derived constraints, compute the maximum permissible $\\Delta t$ for the following two configurations:\n\n- One-dimensional configuration: four cells with widths $\\Delta x_1 = 20 \\text{ km}$, $\\Delta x_2 = 12 \\text{ km}$, $\\Delta x_3 = 8 \\text{ km}$, $\\Delta x_4 = 16 \\text{ km}$, with constant advection speed $a = +35 \\text{ m s}^{-1}$. Report the domain-wide maximum stable $\\Delta t$ in seconds based on the strictest cell.\n\n- Three-dimensional configuration: uniform spacings $\\Delta x = 12 \\text{ km}$, $\\Delta y = 15 \\text{ km}$, $\\Delta z = 500 \\text{ m}$ and constant velocities $u = 25 \\text{ m s}^{-1}$, $v = 15 \\text{ m s}^{-1}$, $w = 0.50 \\text{ m s}^{-1}$. Report the maximum stable $\\Delta t$ in seconds implied by your three-dimensional CFL condition.\n\nRound your two numerical answers to four significant figures and express them in seconds. Provide your final numerical answers in the order (one-dimensional $\\Delta t_{\\max}$, three-dimensional $\\Delta t_{\\max}$).",
            "solution": "### Solution\n\n#### Task A: One-Dimensional Derivation\nWe begin with the one-dimensional conservation law:\n$$ \\frac{\\partial q}{\\partial t} + \\frac{\\partial (a q)}{\\partial x} = 0 $$\nTo obtain the finite volume discretization, we integrate this equation over a control volume (cell $i$) from its left face $x_{i-1/2}$ to its right face $x_{i+1/2}$, with cell width $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$.\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial q}{\\partial t} dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (aq)}{\\partial x} dx = 0 $$\nDefining the cell-average quantity as $q_i(t) = \\frac{1}{\\Delta x_i} \\int_{x_{i-1/2}}^{x_{i+1/2}} q(x, t) dx$ and applying the fundamental theorem of calculus, we get:\n$$ \\frac{d(\\Delta x_i q_i)}{dt} + (aq)_{i+1/2} - (aq)_{i-1/2} = 0 $$\nSince the grid is static, $\\Delta x_i$ is constant in time. Let $F = aq$ be the flux.\n$$ \\Delta x_i \\frac{dq_i}{dt} + F_{i+1/2} - F_{i-1/2} = 0 $$\nDiscretizing in time with the forward Euler method (superscript $n$ denotes the time level $t_n$):\n$$ \\Delta x_i \\frac{q_i^{n+1} - q_i^n}{\\Delta t} + F_{i+1/2}^n - F_{i-1/2}^n = 0 $$\nRearranging for the updated value $q_i^{n+1}$:\n$$ q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x_i} \\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) $$\nThe first-order upwind scheme sets the flux at a cell face based on the value in the \"upwind\" cell, determined by the sign of the velocity $a$.\nCase 1: $a > 0$. The flow is from left to right. The upwind values at faces $i-1/2$ and $i+1/2$ are $q_{i-1}^n$ and $q_i^n$ respectively.\n$$ F_{i-1/2}^n = a q_{i-1}^n, \\quad F_{i+1/2}^n = a q_i^n $$\nSubstituting into the update equation:\n$$ q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x_i} \\left(a q_i^n - a q_{i-1}^n\\right) = \\left(1 - \\frac{a \\Delta t}{\\Delta x_i}\\right) q_i^n + \\frac{a \\Delta t}{\\Delta x_i} q_{i-1}^n $$\nCase 2: $a  0$. The flow is from right to left. The upwind values at faces $i-1/2$ and $i+1/2$ are $q_i^n$ and $q_{i+1}^n$ respectively.\n$$ F_{i-1/2}^n = a q_i^n, \\quad F_{i+1/2}^n = a q_{i+1}^n $$\nSubstituting into the update equation:\n$$ q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x_i} \\left(a q_{i+1}^n - a q_i^n\\right) = \\left(1 + \\frac{a \\Delta t}{\\Delta x_i}\\right) q_i^n - \\frac{a \\Delta t}{\\Delta x_i} q_{i+1}^n $$\nUsing $|a| = -a$ for this case, the equation becomes:\n$$ q_i^{n+1} = \\left(1 - \\frac{|a| \\Delta t}{\\Delta x_i}\\right) q_i^n + \\frac{|a| \\Delta t}{\\Delta x_i} q_{i+1}^n $$\nIn both cases, $q_i^{n+1}$ is a linear combination of $q_i^n$ and its upwind neighbor. For this to be a convex combination, the coefficients must be non-negative and sum to $1$. The sum of the coefficients is always $1$. The non-negativity constraint requires that all coefficients are greater than or equal to $0$. The coefficient of the upwind neighbor, $\\frac{|a|\\Delta t}{\\Delta x_i}$, is always non-negative. The constraint thus falls on the coefficient of $q_i^n$:\n$$ 1 - \\frac{|a| \\Delta t}{\\Delta x_i} \\ge 0 \\implies \\frac{|a| \\Delta t}{\\Delta x_i} \\le 1 $$\nThis gives the stability constraint for cell $i$:\n$$ \\Delta t \\le \\frac{\\Delta x_i}{|a|} $$\nFor stability across the entire domain, the time step $\\Delta t$ must satisfy this condition for all cells. This means it must be limited by the most restrictive case, i.e., the cell with the smallest $\\Delta x_i$.\n$$ \\Delta t \\le \\min_i \\left( \\frac{\\Delta x_i}{|a|} \\right) = \\frac{\\min_i(\\Delta x_i)}{|a|} $$\n\n#### Task B: Three-Dimensional Generalization\nThe three-dimensional conservation law is $\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0$. Integrating over a cell volume $V_{ijk} = \\Delta x \\Delta y \\Delta z$ and applying the divergence theorem gives:\n$$ \\frac{d(V_{ijk} q_{ijk})}{d t} + \\oiint_{\\partial V_{ijk}} (\\boldsymbol{U}q) \\cdot \\boldsymbol{n} \\, dS = 0 $$\nwhere $q_{ijk}$ is the cell average. With a static grid, this becomes:\n$$ V_{ijk} \\frac{dq_{ijk}}{dt} + \\sum_{\\text{faces}} \\int_{\\text{face}} (\\boldsymbol{U}q) \\cdot \\boldsymbol{n} \\, dS = 0 $$\nAfter discretizing the flux integral over the six faces of the cell and applying forward Euler time stepping, we have:\n$$ q_{ijk}^{n+1} = q_{ijk}^n - \\frac{\\Delta t}{V_{ijk}} \\left[ (F_x)_{i+1/2} - (F_x)_{i-1/2} + (F_y)_{j+1/2} - (F_y)_{j-1/2} + (F_z)_{k+1/2} - (F_z)_{k-1/2} \\right]^n $$\nwhere $F_x, F_y, F_z$ are the total fluxes through faces normal to the $x, y, z$ axes. For example, $(F_x)_{i+1/2} = (uq)_{i+1/2} \\Delta y \\Delta z$. After substituting $V_{ijk} = \\Delta x \\Delta y \\Delta z$ and simplifying, the update becomes:\n$$ q_{ijk}^{n+1} = q_{ijk}^n - \\frac{\\Delta t}{\\Delta x} \\left[ (uq)_{i+1/2} - (uq)_{i-1/2} \\right]^n - \\frac{\\Delta t}{\\Delta y} \\left[ (vq)_{j+1/2} - (vq)_{j-1/2} \\right]^n - \\frac{\\Delta t}{\\Delta z} \\left[ (wq)_{k+1/2} - (wq)_{k-1/2} \\right]^n $$\nUsing the first-order upwind scheme, each flux term $(uq)_{i+1/2}$, $(vq)_{j+1/2}$, etc., is determined by the state in the upwind cell. For example, if $u > 0$, $(uq)_{i+1/2} = u q_{ijk}^n$ and $(uq)_{i-1/2} = u q_{i-1,j,k}^n$. Taking the general case, we can write the fluxes using positive and negative parts of the velocity, e.g., $u = u^+ + u^-$ where $u^+ = \\max(u, 0)$ and $u^- = \\min(u,0)$. The net flux difference across the cell in the x-direction is:\n$$ \\Delta t \\left( \\frac{u^+ (q_{ijk}^n - q_{i-1,j,k}^n)}{\\Delta x} + \\frac{u^- (q_{i+1,j,k}^n - q_{ijk}^n)}{\\Delta x} \\right) $$\nwhich upon recalling $|u|=u^{+}-u^{-}$, simplifies the update contributions. When collecting all terms for $q_{ijk}^{n+1}$:\n$$ q_{ijk}^{n+1} = q_{ijk}^n - \\frac{\\Delta t}{\\Delta x} \\left( |u|q_{ijk}^n - u^+ q_{i-1,j,k}^n - u^- q_{i+1,j,k}^n \\right) - \\dots (\\text{for y and z}) $$\nThe logic is identical for all three dimensions. Collecting the coefficients of $q_{ijk}^n$ from all directions gives:\n$$ q_{ijk}^{n+1} = \\left(1 - \\frac{|u|\\Delta t}{\\Delta x} - \\frac{|v|\\Delta t}{\\Delta y} - \\frac{|w|\\Delta t}{\\Delta z}\\right) q_{ijk}^n + (\\dots)q_{\\text{neighbors}}^n $$\nThe sum of coefficients is again $1$. For a convex combination, the coefficient of $q_{ijk}^n$ must be non-negative:\n$$ 1 - \\frac{|u|\\Delta t}{\\Delta x} - \\frac{|v|\\Delta t}{\\Delta y} - \\frac{|w|\\Delta t}{\\Delta z} \\ge 0 $$\nRearranging for $\\Delta t$ gives the CFL stability constraint:\n$$ \\Delta t \\left( \\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{|w|}{\\Delta z} \\right) \\le 1 $$\n$$ \\Delta t \\le \\frac{1}{\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{|w|}{\\Delta z}} $$\n\n#### Task C: Numerical Evaluation\nUnits are converted to SI (meters and seconds) for consistency.\n\n- **One-dimensional configuration**:\nThe givens are:\n$\\Delta x_1 = 20 \\text{ km} = 20000 \\text{ m}$\n$\\Delta x_2 = 12 \\text{ km} = 12000 \\text{ m}$\n$\\Delta x_3 = 8 \\text{ km} = 8000 \\text{ m}$\n$\\Delta x_4 = 16 \\text{ km} = 16000 \\text{ m}$\n$a = +35 \\text{ m s}^{-1}$, so $|a| = 35 \\text{ m s}^{-1}$.\nThe minimum cell width is $\\min_i(\\Delta x_i) = 8000 \\text{ m}$.\nUsing the formula from Task A, the maximum permissible time step is:\n$$ \\Delta t_{\\max} = \\frac{\\min_i(\\Delta x_i)}{|a|} = \\frac{8000 \\text{ m}}{35 \\text{ m s}^{-1}} = \\frac{1600}{7} \\text{ s} \\approx 228.5714 \\text{ s} $$\nRounding to four significant figures, $\\Delta t_{\\max} = 228.6 \\text{ s}$.\n\n- **Three-dimensional configuration**:\nThe givens are:\n$\\Delta x = 12 \\text{ km} = 12000 \\text{ m}$\n$\\Delta y = 15 \\text{ km} = 15000 \\text{ m}$\n$\\Delta z = 500 \\text{ m}$\n$u = 25 \\text{ m s}^{-1}$, so $|u| = 25 \\text{ m s}^{-1}$.\n$v = 15 \\text{ m s}^{-1}$, so $|v| = 15 \\text{ m s}^{-1}$.\n$w = 0.50 \\text{ m s}^{-1}$, so $|w| = 0.50 \\text{ m s}^{-1}$.\nUsing the formula from Task B, the maximum permissible time step is:\n$$ \\Delta t_{\\max} = \\frac{1}{\\frac{|u|}{\\Delta x} + \\frac{|v|}{\\Delta y} + \\frac{|w|}{\\Delta z}} $$\nWe calculate the terms in the denominator:\n$$ \\frac{|u|}{\\Delta x} = \\frac{25}{12000} \\text{ s}^{-1} = \\frac{1}{480} \\text{ s}^{-1} $$\n$$ \\frac{|v|}{\\Delta y} = \\frac{15}{15000} \\text{ s}^{-1} = \\frac{1}{1000} \\text{ s}^{-1} $$\n$$ \\frac{|w|}{\\Delta z} = \\frac{0.50}{500} \\text{ s}^{-1} = \\frac{1}{1000} \\text{ s}^{-1} $$\nThe sum is:\n$$ \\frac{1}{480} + \\frac{1}{1000} + \\frac{1}{1000} = \\frac{1}{480} + \\frac{2}{1000} = \\frac{1}{480} + \\frac{1}{500} = \\frac{500+480}{480 \\times 500} = \\frac{980}{240000} = \\frac{49}{120000} \\text{ s}^{-1} $$\nTherefore, the maximum time step is:\n$$ \\Delta t_{\\max} = \\frac{1}{49/120000} = \\frac{120000}{49} \\text{ s} \\approx 2448.979 \\text{ s} $$\nRounding to four significant figures, $\\Delta t_{\\max} = 2449 \\text{ s}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 228.6  2449 \\end{pmatrix}}\n$$"
        }
    ]
}