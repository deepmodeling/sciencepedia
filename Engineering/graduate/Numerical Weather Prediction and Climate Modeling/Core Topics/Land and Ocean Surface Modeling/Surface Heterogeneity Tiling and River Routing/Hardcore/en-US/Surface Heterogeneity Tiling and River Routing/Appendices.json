{
    "hands_on_practices": [
        {
            "introduction": "Climate and weather models must represent diverse landscapes within a single grid cell. This practice introduces the 'tiling' method, a core technique for capturing such sub-grid heterogeneity. You will model how different land surface types ('tiles') respond to rainfall, generate runoff through the saturation-excess mechanism, and contribute to the total streamflow at the grid cell outlet . This exercise provides a complete, albeit simplified, picture of the journey from precipitation to river discharge, linking runoff generation and routing.",
            "id": "4098472",
            "problem": "Consider a heterogeneous land surface represented by $N$ tiles, each modeled by a single-bucket water balance. For tile $i \\in \\{1,\\dots,N\\}$, the bucket storage $S_i(t)$ (in millimeters of water) evolves under constant precipitation forcing $P$ (in millimeters per hour) and constant tile-specific evaporation $E_i$ (in millimeters per hour) according to the continuity equation\n$$\n\\frac{dS_i}{dt} = P - E_i - Q_i(S_i),\n$$\nwhere $Q_i(S_i)$ (in millimeters per hour) is the runoff generation term. Each tile has a finite storage capacity $S_i^{\\max}$ (in millimeters) and an initial storage $S_{i0}$ (in millimeters) satisfying $0 \\le S_{i0} \\le S_i^{\\max}$. Under constant forcing, assume saturation-excess runoff: prior to saturation, there is no runoff, and once saturated, additional inputs leave as runoff while storage is held at capacity, i.e.,\n- if $S_i(t)  S_i^{\\max}$, then $Q_i(S_i(t)) = 0$,\n- if $S_i(t) = S_i^{\\max}$ and $P  E_i$, then $Q_i(S_i(t)) = P - E_i$ so that $\\frac{dS_i}{dt} = 0$ and $S_i(t)$ remains equal to $S_i^{\\max}$ after onset.\n\nLet $a_i$ denote the fractional area of tile $i$, with $\\sum_{i=1}^N a_i = 1$. The catchment outlet is represented by a single Linear Reservoir (LR) with residence time $\\tau_r$ (in hours) that routes the area-weighted sum of tile runoff. Let $R(t)$ (in millimeters) denote the reservoir storage. The LR dynamics and discharge $D(t)$ (in millimeters per hour) are given by\n$$\n\\frac{dR}{dt} = \\sum_{i=1}^N a_i \\, Q_i(t) - \\frac{R}{\\tau_r}, \\quad D(t) = \\frac{R(t)}{\\tau_r},\n$$\nwith $R(0) = 0$.\n\nTask:\n1. For each tile $i$, derive and compute the onset time of Saturation-Excess Runoff (SER), $t_i^{\\text{sat}}$ (in hours), defined as the earliest $t \\ge 0$ such that $S_i(t) = S_i^{\\max}$. If $P - E_i \\le 0$ and $S_{i0}  S_i^{\\max}$, SER never occurs; return $-1.0$ for $t_i^{\\text{sat}}$ in that case. If $S_{i0} = S_i^{\\max}$, set $t_i^{\\text{sat}} = 0$.\n2. Using the above LR routing, compute the outlet discharge at a given final time $T_{\\text{end}}$ (in hours), namely $D(T_{\\text{end}})$ (in millimeters per hour), assuming runoff inputs are zero until the corresponding $t_i^{\\text{sat}}$ and equal to $P - E_i$ thereafter (only for tiles with $P - E_i  0$).\n\nAll answers must be expressed in hours for times and millimeters per hour for fluxes, rounded in the program’s default floating-point precision (no explicit rounding required).\n\nYour program must implement the exact specification below and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list containing the SER onset times for each tile followed by the outlet discharge at $T_{\\text{end}}$, i.e.,\n$[ [t_1^{\\text{sat}}, \\dots, t_N^{\\text{sat}}, D(T_{\\text{end}})], \\dots ]$.\n\nUse the following test suite of three cases, designed to probe different behaviors:\n\n- Case A (heterogeneous tiles; one saturates within horizon):\n  - $N = 2$, $P = 5$ millimeters per hour,\n  - $E_1 = 1$ millimeters per hour, $E_2 = 2$ millimeters per hour,\n  - $S_1^{\\max} = 100$ millimeters, $S_2^{\\max} = 80$ millimeters,\n  - $S_{10} = 20$ millimeters, $S_{20} = 70$ millimeters,\n  - $a_1 = 0.6$, $a_2 = 0.4$,\n  - $\\tau_r = 2$ hours, $T_{\\text{end}} = 10$ hours.\n\n- Case B (no saturation under net-negative input):\n  - $N = 2$, $P = 1$ millimeters per hour,\n  - $E_1 = 1.5$ millimeters per hour, $E_2 = 2.0$ millimeters per hour,\n  - $S_1^{\\max} = 80$ millimeters, $S_2^{\\max} = 90$ millimeters,\n  - $S_{10} = 10$ millimeters, $S_{20} = 20$ millimeters,\n  - $a_1 = 0.5$, $a_2 = 0.5$,\n  - $\\tau_r = 1$ hours, $T_{\\text{end}} = 5$ hours.\n\n- Case C (one tile initially saturated; another saturates later):\n  - $N = 2$, $P = 6$ millimeters per hour,\n  - $E_1 = 1$ millimeters per hour, $E_2 = 4$ millimeters per hour,\n  - $S_1^{\\max} = 50$ millimeters, $S_2^{\\max} = 40$ millimeters,\n  - $S_{10} = 50$ millimeters, $S_{20} = 30$ millimeters,\n  - $a_1 = 0.5$, $a_2 = 0.5$,\n  - $\\tau_r = 3$ hours, $T_{\\text{end}} = 12$ hours.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[[\\dots],[\\dots],[\\dots]]$) following the exact format:\n$[[t_1^{\\text{sat}},\\dots,t_N^{\\text{sat}},D(T_{\\text{end}})], [\\dots], [\\dots]]$.",
            "solution": "The user-provided problem has been validated and is determined to be a well-posed, scientifically grounded problem in catchment hydrology. All necessary parameters and initial conditions are provided, and the model components—a tiled bucket model for soil moisture and a linear reservoir for routing—are standard in the field. The problem is free of contradictions, ambiguities, and factual errors.\n\n### Part 1: Onset Time of Saturation-Excess Runoff ($t_i^{\\text{sat}}$)\n\nFor each tile $i$, the water storage $S_i(t)$ evolves according to the continuity equation:\n$$\n\\frac{dS_i}{dt} = P - E_i - Q_i(S_i)\n$$\nwhere $P$ is precipitation rate, $E_i$ is evaporation rate, and $Q_i(S_i)$ is runoff. The problem specifies a saturation-excess runoff mechanism, where runoff $Q_i(S_i) = 0$ as long as the tile storage $S_i(t)$ is below its capacity $S_i^{\\max}$.\n\nUnder this condition ($S_i(t)  S_i^{\\max}$), the differential equation simplifies to:\n$$\n\\frac{dS_i}{dt} = P - E_i\n$$\nLet the constant net water input to tile $i$ be $I_i = P - E_i$. Since $I_i$ is constant, we can integrate this first-order ordinary differential equation with respect to time from $t=0$ to $t$:\n$$\n\\int_{S_{i0}}^{S_i(t)} dS' = \\int_{0}^{t} I_i d\\tau\n$$\nThis yields the evolution of storage before saturation:\n$$\nS_i(t) - S_{i0} = I_i t \\implies S_i(t) = S_{i0} + (P - E_i)t\n$$\nThe onset time of saturation-excess runoff, $t_i^{\\text{sat}}$, is defined as the time when $S_i(t)$ first reaches $S_i^{\\max}$. Setting $S_i(t_i^{\\text{sat}}) = S_i^{\\max}$:\n$$\nS_i^{\\max} = S_{i0} + (P - E_i) t_i^{\\text{sat}}\n$$\nSolving for $t_i^{\\text{sat}}$ gives:\n$$\nt_i^{\\text{sat}} = \\frac{S_i^{\\max} - S_{i0}}{P - E_i}\n$$\nThis formula is valid under specific conditions:\n1.  If the net input $P - E_i  0$, the storage will increase, and saturation will eventually occur. The formula above applies directly.\n2.  If the tile is initially saturated, $S_{i0} = S_i^{\\max}$, the numerator is $0$, so $t_i^{\\text{sat}} = 0$, as stipulated.\n3.  If the net input $P - E_i \\le 0$ and the tile is not initially saturated ($S_{i0}  S_i^{\\max}$), the storage will not increase. Saturation will never be reached. In this case, $t_i^{\\text{sat}}$ is set to $-1.0$.\n\n### Part 2: Outlet Discharge at Final Time ($D(T_{\\text{end}})$)\n\nThe outlet discharge $D(t)$ is determined by the storage $R(t)$ in a linear reservoir, where $D(t) = R(t)/\\tau_r$. The reservoir storage evolves according to:\n$$\n\\frac{dR}{dt} = Q_{\\text{in}}(t) - \\frac{R(t)}{\\tau_r}\n$$\nwith initial condition $R(0) = 0$. The total inflow $Q_{\\text{in}}(t)$ is the area-weighted sum of runoff from all tiles:\n$$\nQ_{\\text{in}}(t) = \\sum_{i=1}^N a_i Q_i(t)\n$$\nwhere $Q_i(t)$ for each tile is a step function:\n$$\nQ_i(t) = \\begin{cases} 0  \\text{if } t  t_i^{\\text{sat}} \\text{ or } P - E_i \\le 0 \\\\ P - E_i  \\text{if } t \\ge t_i^{\\text{sat}} \\text{ and } P - E_i  0 \\end{cases}\n$$\nConsequently, the total inflow $Q_{\\text{in}}(t)$ is a piecewise constant function. The value of $Q_{\\text{in}}(t)$ changes only at the saturation onset times $t_i^{\\text{sat}}$.\n\nLet us define a set of event times $\\{t_k\\}$ as the sorted, unique, positive saturation times that occur before $T_{\\text{end}}$. Appending $0$ and $T_{\\text{end}}$ to this set, we get an ordered sequence of time points $0 = \\theta_0  \\theta_1  \\dots  \\theta_M = T_{\\text{end}}$. In any interval $[\\theta_j, \\theta_{j+1})$, the inflow $Q_{\\text{in}}(t)$ is constant, say $Q_j$. Within this interval, we solve the linear ODE:\n$$\n\\frac{dR}{dt} + \\frac{1}{\\tau_r} R = Q_j, \\quad \\text{for } t \\in [\\theta_j, \\theta_{j+1})\n$$\nThe analytical solution for $R(t)$ given the storage $R(\\theta_j)$ at the start of the interval is:\n$$\nR(t) = \\left(R(\\theta_j) - Q_j \\tau_r\\right) e^{-(t-\\theta_j)/\\tau_r} + Q_j \\tau_r\n$$\nThe value of $Q_j$ is $\\sum_{i} a_i(P-E_i)$ for all tiles $i$ that have already saturated by time $\\theta_j$ (i.e., $t_i^{\\text{sat}} \\le \\theta_j$ and $P-E_i  0$).\n\nThe computational algorithm is as follows:\n1.  Calculate $t_i^{\\text{sat}}$ for all tiles $i=1, \\dots, N$.\n2.  Construct a sequence of time points by taking the set $\\{0, T_{\\text{end}}\\} \\cup \\{t_i^{\\text{sat}} \\mid 0  t_i^{\\text{sat}}  T_{\\text{end}}\\}$ and sorting them.\n3.  Initialize reservoir storage $R = 0$ at $t=0$.\n4.  Iterate through the time intervals defined by the sorted time points. For each interval from $t_{\\text{start}}$ to $t_{\\text{end}}$:\n    a. Determine the constant total inflow $Q_{\\text{in}} = \\sum_{i | t_i^{\\text{sat}} \\le t_{\\text{start}}, P-E_i0} a_i(P-E_i)$.\n    b. Update the reservoir storage to the end of the interval using the analytical solution: $R(t_{\\text{end}}) = (R(t_{\\text{start}}) - Q_{\\text{in}}\\tau_r) e^{-(t_{\\text{end}}-t_{\\text{start}})/\\tau_r} + Q_{\\text{in}}\\tau_r$.\n5.  After processing the final interval ending at $T_{\\text{end}}$, the resulting storage is $R(T_{\\text{end}})$.\n6.  The final discharge is $D(T_{\\text{end}}) = R(T_{\\text{end}}) / \\tau_r$. This method yields a precise solution without numerical integration.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the hydrology problem for the given test cases.\n    \"\"\"\n\n    def solve_case(params):\n        \"\"\"\n        Solves a single test case of the land surface hydrology problem.\n\n        Args:\n            params (tuple): A tuple containing all parameters for the case:\n                (N, P, E, S_max, S0, a, tau_r, T_end)\n\n        Returns:\n            list: A list containing the SER onset times for each tile followed\n                  by the outlet discharge at T_end, i.e.,\n                  [t_1^sat, ..., t_N^sat, D(T_end)].\n        \"\"\"\n        N, P, E, S_max, S0, a, tau_r, T_end = params\n\n        # Task 1: Compute the onset time of Saturation-Excess Runoff (SER), t_i^sat\n        t_sats = []\n        for i in range(N):\n            if S0[i] = S_max[i]:\n                t_sat = 0.0\n            elif P - E[i] = 0:\n                t_sat = -1.0\n            else:\n                t_sat = (S_max[i] - S0[i]) / (P - E[i])\n            t_sats.append(t_sat)\n\n        # Task 2: Compute the outlet discharge D(T_end)\n        \n        # Define event times: 0, T_end, and all positive saturation times less than T_end.\n        # These are the points in time where the inflow Q_in to the reservoir changes.\n        event_times = {0.0, T_end}\n        for t_sat in t_sats:\n            if 0  t_sat  T_end:\n                event_times.add(t_sat)\n        \n        sorted_times = sorted(list(event_times))\n        \n        # Propagate reservoir storage through piecewise constant inflow intervals\n        R = 0.0  # Initial reservoir storage R(0) = 0\n        for i in range(len(sorted_times) - 1):\n            t_start = sorted_times[i]\n            t_end = sorted_times[i+1]\n            dt = t_end - t_start\n            \n            # Calculate total inflow Q_in for the interval [t_start, t_end)\n            # Q_in is constant over this interval.\n            Q_in = 0.0\n            for j in range(N):\n                net_input = P - E[j]\n                # A tile contributes runoff if it's saturated (t_sat = 0), has\n                # positive net input, and its saturation time is before or at t_start.\n                if t_sats[j] = 0 and net_input  0 and t_sats[j] = t_start:\n                    Q_in += a[j] * net_input\n            \n            # Apply the analytical solution for the linear reservoir ODE\n            if tau_r  0:\n                # R(t_end) = (R(t_start) - Q_in * tau_r) * exp(-dt / tau_r) + Q_in * tau_r\n                R_ss = Q_in * tau_r  # Steady-state storage for the constant inflow\n                R = R_ss + (R - R_ss) * np.exp(-dt / tau_r)\n            else: # Fallback for tau_r = 0 (instantaneous response)\n                R = 0 # Not physically meaningful in this context, but avoids errors.\n        \n        # Final discharge D(T_end) = R(T_end) / tau_r\n        D_Tend = R / tau_r if tau_r  0 else 0.0\n        \n        # Assemble the results for this case\n        result = t_sats + [D_Tend]\n        return result\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (heterogeneous tiles; one saturates within horizon)\n        (\n            2, 5.0, [1.0, 2.0], [100.0, 80.0], [20.0, 70.0], [0.6, 0.4], 2.0, 10.0\n        ),\n        # Case B (no saturation under net-negative input)\n        (\n            2, 1.0, [1.5, 2.0], [80.0, 90.0], [10.0, 20.0], [0.5, 0.5], 1.0, 5.0\n        ),\n        # Case C (one tile initially saturated; another saturates later)\n        (\n            2, 6.0, [1.0, 4.0], [50.0, 40.0], [50.0, 30.0], [0.5, 0.5], 3.0, 12.0\n        ),\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(solve_case(case))\n    \n    # Format the output string precisely as required: [[...],[...],[...]]\n    # No spaces within the inner or outer lists.\n    outer_list_str = []\n    for res_list in results:\n        # Using a general format specifier 'g' to handle floats cleanly.\n        inner_list_str = f\"[{','.join(f'{val:.15g}' for val in res_list)}]\"\n        outer_list_str.append(inner_list_str)\n    \n    final_output = f\"[{','.join(outer_list_str)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "After generating runoff, models must route it through river networks, a process often approximated by the linear advection equation. This exercise moves from the physical concept of routing to its numerical implementation, a critical step where artifacts can arise. By analyzing a first-order upwind scheme, you will derive its 'modified equation' to reveal and quantify the inherent numerical diffusion . This analysis is fundamental to understanding why simulated flood waves in models often appear more spread out and attenuated than in reality.",
            "id": "4098418",
            "problem": "A river routing module in a Numerical Weather Prediction (NWP) and climate model represents sub-grid land surface heterogeneity using tiles. Consider a single headwater grid cell comprised of two land-surface tiles with contrasting infiltration characteristics that together produce an aggregated surface runoff pulse at the start of a storm. This aggregated runoff is routed through a one-dimensional reach of length $L$ discretized into $N$ uniform cells of size $\\Delta x = L/N$. The routing uses a first-order upwind explicit scheme with a uniform kinematic wave speed $u$ and time step $\\Delta t$, acting on the discharge $q(x,t)$, where $q$ obeys one-dimensional mass conservation in the kinematic limit.\n\nAssume the scheme is applied to the linear advection of discharge in the channel:\n- The governing continuum equation is the one-dimensional linear advection equation, justified by mass conservation and a constant celerity approximation: $\\partial q / \\partial t + u\\, \\partial q / \\partial x = 0$.\n- The numerical scheme is first-order upwind on a uniform grid.\n\nTasks:\n1. Starting from the continuum equation and the first-order upwind discretization, perform a modified equation (Taylor series) analysis to obtain the leading-order equivalent diffusion coefficient $D_{\\mathrm{eq}}$ that characterizes the numerical diffusion of the scheme. Express $D_{\\mathrm{eq}}$ in terms of $u$, $\\Delta x$, and the Courant number $\\lambda$, where $\\lambda = u \\Delta t / \\Delta x$.\n2. Now take $L = 10~\\mathrm{km}$, $\\Delta x = 1~\\mathrm{km}$, $u = 2~\\mathrm{m\\,s^{-1}}$, and $\\Delta t = 300~\\mathrm{s}$. At time $t=0$, the headwater cell ($x=0$) receives an instantaneous aggregated inflow pulse from the tiles modeled as a one-step discharge of amplitude $Q_{0} = 100~\\mathrm{m^{3}\\,s^{-1}}$ applied for exactly one model time step and then zero thereafter. Treat the routing through the $N = L/\\Delta x$ cells as repeated application of the first-order upwind update and derive the discrete impulse response at the downstream outlet cell as a function of model step $n$.\n3. Using your discrete impulse response, determine the peak discharge at the outlet (i.e., the maximum over $n$ of the outlet discharge sequence) and compute its numerical value with the given parameters. Round your final answer to four significant figures. Express the final discharge in $\\mathrm{m^{3}\\,s^{-1}}$.",
            "solution": "The problem is evaluated as valid. It is scientifically grounded in the principles of fluid dynamics and numerical methods, specifically the kinematic wave approximation for river routing and its numerical solution. The problem is well-posed, with all necessary parameters and conditions provided for a unique solution. The language is objective and the parameters are physically realistic.\n\n### Part 1: Modified Equation Analysis\n\nThe task is to find the equivalent diffusion coefficient for the first-order upwind scheme applied to the linear advection equation.\nThe governing continuum equation is given as:\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = 0\n$$\nwhere $q$ is the discharge, $u$ is a constant wave speed, $t$ is time, and $x$ is the spatial coordinate. We assume $u  0$.\n\nThe one-dimensional grid is uniform with spacing $\\Delta x$, and the time step is $\\Delta t$. The discharge at grid node $j$ and time step $n$ is denoted by $q_j^n = q(j\\Delta x, n\\Delta t)$. The first-order upwind explicit scheme for $u0$ is:\n$$\n\\frac{q_j^{n+1} - q_j^n}{\\Delta t} + u \\frac{q_j^n - q_{j-1}^n}{\\Delta x} = 0\n$$\nRearranging and introducing the Courant number $\\lambda = \\frac{u \\Delta t}{\\Delta x}$, the scheme can be written as:\n$$\nq_j^{n+1} = q_j^n - \\lambda (q_j^n - q_{j-1}^n) = (1-\\lambda)q_j^n + \\lambda q_{j-1}^n\n$$\nTo perform the modified equation analysis, we expand each term in the discrete equation as a Taylor series around the point $(x_j, t_n)$. Let $q$ and its derivatives at $(x_j, t_n)$ be denoted by $q$, $q_t$, $q_x$, $q_{tt}$, $q_{xx}$, etc.\n$$\nq_j^{n+1} = q(x_j, t_n + \\Delta t) = q + \\Delta t q_t + \\frac{\\Delta t^2}{2} q_{tt} + \\mathcal{O}(\\Delta t^3)\n$$\n$$\nq_j^n = q(x_j, t_n) = q\n$$\n$$\nq_{j-1}^n = q(x_j - \\Delta x, t_n) = q - \\Delta x q_x + \\frac{\\Delta x^2}{2} q_{xx} - \\frac{\\Delta x^3}{6} q_{xxx} + \\mathcal{O}(\\Delta x^4)\n$$\nSubstituting these expansions into the rearranged scheme $q_j^{n+1} = (1-\\lambda)q_j^n + \\lambda q_{j-1}^n$:\n$$\nq + \\Delta t q_t + \\frac{\\Delta t^2}{2} q_{tt} + \\dots = (1-\\lambda)q + \\lambda \\left( q - \\Delta x q_x + \\frac{\\Delta x^2}{2} q_{xx} - \\dots \\right)\n$$\n$$\nq + \\Delta t q_t + \\frac{\\Delta t^2}{2} q_{tt} + \\dots = q - \\lambda \\Delta x q_x + \\lambda \\frac{\\Delta x^2}{2} q_{xx} - \\dots\n$$\nCanceling $q$ from both sides and substituting $\\lambda \\Delta x = u \\Delta t$:\n$$\n\\Delta t q_t + \\frac{\\Delta t^2}{2} q_{tt} + \\dots = -u \\Delta t q_x + \\frac{u \\Delta t \\Delta x}{2} q_{xx} - \\dots\n$$\nDividing by $\\Delta t$:\n$$\nq_t + \\frac{\\Delta t}{2} q_{tt} + \\dots = -u q_x + \\frac{u \\Delta x}{2} q_{xx} - \\dots\n$$\nRearranging gives the modified equation:\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 q}{\\partial x^2} - \\frac{\\Delta t}{2} \\frac{\\partial^2 q}{\\partial t^2} + \\text{H.O.T.}\n$$\nThe right-hand side represents the truncation error. The leading-order error terms are of second order. To find the equivalent diffusion coefficient, we must express all leading-order error terms as spatial derivatives. From the original PDE, $q_t = -u q_x$. Differentiating with respect to $t$ gives $q_{tt} = \\frac{\\partial}{\\partial t}(-u q_x) = -u \\frac{\\partial}{\\partial x}(q_t) = -u \\frac{\\partial}{\\partial x}(-u q_x) = u^2 q_{xx}$. Substituting this into the modified equation:\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 q}{\\partial x^2} - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 q}{\\partial x^2} \\right) + \\text{H.O.T.}\n$$\n$$\n\\frac{\\partial q}{\\partial t} + u \\frac{\\partial q}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 q}{\\partial x^2} + \\text{H.O.T.}\n$$\nThis equation is in the form of an advection-diffusion equation, where the coefficient of the second spatial derivative is the equivalent diffusion coefficient, $D_{\\mathrm{eq}}$.\n$$\nD_{\\mathrm{eq}} = \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right)\n$$\nExpressed in terms of $u$, $\\Delta x$, and $\\lambda$:\n$$\nD_{\\mathrm{eq}} = \\frac{u \\Delta x}{2} (1 - \\lambda)\n$$\n\n### Part 2: Discrete Impulse Response\n\nThe problem describes an input pulse at the upstream boundary ($j=0$) of $Q_0 = 100~\\mathrm{m^{3}\\,s^{-1}}$ for one time step ($n=0$) and zero thereafter. The river is initially quiescent. This can be stated as:\n- Initial condition: $q_j^0 = 0$ for $j \\geq 1$.\n- Boundary condition: $q_0^0 = Q_0$, and $q_0^n = 0$ for $n \\geq 1$.\n\nThe evolution of discharge $q_j^n$ is governed by the recurrence relation: $q_j^{n+1} = (1-\\lambda)q_j^n + \\lambda q_{j-1}^n$. We seek the solution at the outlet of the $N$-th cell, which is the node $j=N$. The number of cells is $N = L/\\Delta x = 10~\\mathrm{km} / 1~\\mathrm{km} = 10$.\n\nLet's trace the propagation of the impulse. This is a classic discrete convolution problem whose solution is given by the negative binomial distribution. A particle of discharge has a \"probability\" $\\lambda$ of moving to the next cell and $1-\\lambda$ of staying in the current cell in each time step. To reach cell $N$ exactly at time step $n$, a parcel of discharge must undergo exactly $N$ movements to the right (from cell $0$ to $1$, $1$ to $2$, ..., $N-1$ to $N$) and $n-N$ \"stay\" events. The input pulse $Q_0$ is only for the first time step at $j=0$.\n\nThe response at node $j$ at time $n$, $q_j^n$, due to the impulse $q_0^0=Q_0$ can be shown (e.g., via generating functions) to be:\n$$\nq_j^n = Q_0 \\binom{n-1}{j-1} \\lambda^j (1-\\lambda)^{n-j} \\quad \\text{for } n \\ge j \\ge 1\n$$\nFor $nj$, $q_j^n=0$ as it is physically impossible for the pulse to travel $j$ cells in fewer than $j$ time steps (since $\\lambda \\le 1$). The binomial coefficient $\\binom{n-1}{j-1}$ is zero for $nj$.\n\nThe discrete impulse response at the downstream outlet cell ($j=N=10$) is therefore:\n$$\nq_{10}^n = Q_0 \\binom{n-1}{9} \\lambda^{10} (1-\\lambda)^{n-10} \\quad \\text{for } n \\ge 10\n$$\n\n### Part 3: Peak Discharge Calculation\n\nWe need to find the maximum value of $q_{10}^n$ with respect to the time step $n$. Let $f(n) = q_{10}^n$. To find the maximum, we can analyze the ratio $f(n+1)/f(n)$:\n$$\n\\frac{f(n+1)}{f(n)} = \\frac{Q_0 \\binom{n}{9} \\lambda^{10} (1-\\lambda)^{n+1-10}}{Q_0 \\binom{n-1}{9} \\lambda^{10} (1-\\lambda)^{n-10}} = \\frac{\\binom{n}{9}}{\\binom{n-1}{9}} (1-\\lambda)\n$$\nThe ratio of binomial coefficients is $\\frac{\\binom{n}{k}}{\\binom{n-1}{k}} = \\frac{n! / (k!(n-k)!)}{(n-1)! / (k!(n-1-k)!)} = \\frac{n}{n-k}$. With $k=9$:\n$$\n\\frac{f(n+1)}{f(n)} = \\frac{n}{n-9} (1-\\lambda)\n$$\nThe peak occurs when this ratio is close to $1$. Let's set the ratio to $1$:\n$$\n\\frac{n}{n-9} (1-\\lambda) = 1 \\implies n(1-\\lambda) = n-9 \\implies n - n\\lambda = n-9 \\implies n\\lambda = 9 \\implies n = \\frac{9}{\\lambda}\n$$\nNow, we compute the numerical values of the parameters:\n$L = 10~\\mathrm{km} = 10000~\\mathrm{m}$\n$\\Delta x = 1~\\mathrm{km} = 1000~\\mathrm{m}$\n$N = \\frac{L}{\\Delta x} = 10$\n$u = 2~\\mathrm{m\\,s^{-1}}$\n$\\Delta t = 300~\\mathrm{s}$\n$Q_0 = 100~\\mathrm{m^3\\,s^{-1}}$\nThe Courant number is $\\lambda = \\frac{u \\Delta t}{\\Delta x} = \\frac{(2~\\mathrm{m\\,s^{-1}})(300~\\mathrm{s})}{1000~\\mathrm{m}} = \\frac{600}{1000} = 0.6$. The condition for stability of the explicit scheme, $0  \\lambda \\leq 1$, is satisfied.\n\nThe time step $n_{\\text{peak}}$ at which the peak occurs is approximately:\n$$\nn_{\\text{peak}} = \\frac{9}{\\lambda} = \\frac{9}{0.6} = 15\n$$\nSince $n_{\\text{peak}}=15$ is an integer, the ratio $\\frac{f(16)}{f(15)} = \\frac{15}{15-9}(1-0.6) = \\frac{15}{6}(0.4) = 2.5 \\times 0.4 = 1$. This means $f(16) = f(15)$, so the peak discharge occurs at both $n=15$ and $n=16$. We can calculate the value at either time step. Let's use $n=15$.\nThe peak discharge $q_{\\text{peak}}$ is $q_{10}^{15}$:\n$$\nq_{\\text{peak}} = Q_0 \\binom{15-1}{10-1} \\lambda^{10} (1-\\lambda)^{15-10} = 100 \\binom{14}{9} (0.6)^{10} (0.4)^5\n$$\nFirst, calculate the binomial coefficient:\n$$\n\\binom{14}{9} = \\frac{14!}{9! (14-9)!} = \\frac{14!}{9! 5!} = \\frac{14 \\times 13 \\times 12 \\times 11 \\times 10}{5 \\times 4 \\times 3 \\times 2 \\times 1} = 14 \\times 13 \\times 11 = 2002\n$$\nNext, calculate the powers:\n$$\n(0.6)^{10} \\approx 0.0060466176\n$$\n$$\n(0.4)^5 = 0.01024\n$$\nNow, combine the terms to find the peak discharge:\n$$\nq_{\\text{peak}} = 100 \\times 2002 \\times (0.6)^{10} \\times (0.4)^5\n$$\n$$\nq_{\\text{peak}} \\approx 100 \\times 2002 \\times 0.0060466176 \\times 0.01024 \\approx 12.39534~\\mathrm{m^3\\,s^{-1}}\n$$\nRounding the result to four significant figures gives $12.40~\\mathrm{m^3\\,s^{-1}}$.\nThe first part of the problem asked for an expression for $D_{\\mathrm{eq}}$. The second and third for the impulse response and peak discharge. The final answer required is the numerical value of the peak discharge.\nThe peak discharge is $q_{\\text{peak}} = 12.39534...$. Rounded to four significant figures, this is $12.40$.",
            "answer": "$$\n\\boxed{12.40}\n$$"
        },
        {
            "introduction": "Modern Earth system models are complex assemblies of distinct components, such as land surface and river routing modules, which may not be perfectly consistent. This practice addresses a crucial and practical challenge: ensuring water mass conservation when model components have mismatched representations of the landscape, such as the extent of lakes and wetlands . By diagnosing the water imbalance and implementing a physically-based correction, you will engage in the type of rigorous accounting required to build trustworthy climate projections.",
            "id": "4098458",
            "problem": "A single grid cell in a global Numerical Weather Prediction (NWP) and climate modeling system uses a surface heterogeneity tiling scheme in the land model and a separate river routing model. The land model divides the surface into two tiles: a vegetated land tile and a lake-wetland tile. Within the land surface model, the lake-wetland tile fraction is $f_{L}^{\\mathrm{land}} = 0.30$ of the grid cell, and the vegetated tile fraction is $f_{V} = 0.70$. The river routing model uses its own water mask with a connected lake-reservoir fraction $f_{L}^{\\mathrm{route}} = 0.20$. The difference $f_{L}^{\\mathrm{land}} - f_{L}^{\\mathrm{route}}$ represents lakes and wetlands recognized by the land model but not represented in the routing network.\n\nConsider a one-month period of length $T = 30$ days. Over the vegetated tile, monthly mean precipitation, evaporation, and change in terrestrial water storage are $P_{V} = 110\\ \\mathrm{mm}$, $E_{V} = 70\\ \\mathrm{mm}$, and $\\Delta S_{V} = +5\\ \\mathrm{mm}$, respectively. Over the lake-wetland tile, the corresponding values are $P_{L} = 90\\ \\mathrm{mm}$, $E_{L} = 85\\ \\mathrm{mm}$, and $\\Delta S_{L} = +1\\ \\mathrm{mm}$. Assume the land model passes to the routing model, for each tile, the residual of the monthly mass balance as a lateral outflow (runoff plus drainage for the vegetated tile, and net lake outflow for the lake-wetland tile), consistent with the water continuity equation $dS/dt = P - E - Q_{\\mathrm{out}}$ integrated over the month. Assume water density is $\\rho_{w} = 1000\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$ and neglect any changes in routing model storage over the month.\n\nThe atmosphere-land system’s gridcell water balance demands that the gridcell-integrated discharge exported by the routing model equals the gridcell-mean lateral outflow computed by the land model. However, due to the mask mismatch, the coupler only transmits lake outflow over the routing model’s lake-reservoir fraction $f_{L}^{\\mathrm{route}}$, discarding the lake outflow produced over the non-overlapping lake-wetland area $f_{L}^{\\mathrm{land}} - f_{L}^{\\mathrm{route}}$. Vegetated runoff is fully transmitted.\n\nStarting from the fundamental water mass conservation principle and the described mask overlay, derive the gridcell-mean mass non-closure over the month caused by the mask mismatch. Then, propose a minimal, physically consistent sink-source correction method that restores exact gridcell water conservation by adding a constant-in-time gridcell-mean source term $S$ to the routing model over the month. Your proposal should be justified from first principles, and the magnitude of $S$ should be computed so that its monthly time integral exactly compensates the diagnosed mass non-closure. Express $S$ in $\\mathrm{kg}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1}$ and round your answer to four significant figures.",
            "solution": "The problem requires us to quantify the water mass non-closure in a climate model grid cell due to a mismatch between the land surface model's and the river routing model's representations of surface water bodies, and then to devise a correction scheme. The analysis is based on the fundamental principle of mass conservation, specifically the water balance equation.\n\nFirst, we determine the lateral outflow from each of the two land surface tiles (vegetated and lake-wetland) over the one-month period. The water balance for a given tile, integrated over the time period $T$, is given by:\n$$ \\Delta S = P - E - Q_{\\mathrm{out}} $$\nwhere $\\Delta S$ is the change in water storage, $P$ is precipitation, $E$ is evaporation, and $Q_{\\mathrm{out}}$ is the total lateral outflow (e.g., runoff, drainage, or lake outflow). All quantities are expressed as depths (in $\\mathrm{mm}$) over the tile area for the total period of $T = 30$ days. Rearranging for the lateral outflow gives:\n$$ Q_{\\mathrm{out}} = P - E - \\Delta S $$\n\nFor the vegetated tile ($V$), with $P_{V} = 110\\ \\mathrm{mm}$, $E_{V} = 70\\ \\mathrm{mm}$, and $\\Delta S_{V} = 5\\ \\mathrm{mm}$, the lateral outflow is:\n$$ Q_{\\mathrm{out}, V} = P_{V} - E_{V} - \\Delta S_{V} = 110\\ \\mathrm{mm} - 70\\ \\mathrm{mm} - 5\\ \\mathrm{mm} = 35\\ \\mathrm{mm} $$\n\nFor the lake-wetland tile ($L$), with $P_{L} = 90\\ \\mathrm{mm}$, $E_{L} = 85\\ \\mathrm{mm}$, and $\\Delta S_{L} = 1\\ \\mathrm{mm}$, the lateral outflow is:\n$$ Q_{\\mathrm{out}, L} = P_{L} - E_{L} - \\Delta S_{L} = 90\\ \\mathrm{mm} - 85\\ \\mathrm{mm} - 1\\ \\mathrm{mm} = 4\\ \\mathrm{mm} $$\n\nNext, we calculate the total gridcell-mean lateral outflow generated by the land model, $Q_{\\mathrm{gen}}$. This is the area-weighted average of the outflows from each tile, using the land model's tile fractions, $f_{V} = 0.70$ and $f_{L}^{\\mathrm{land}} = 0.30$.\n$$ Q_{\\mathrm{gen}} = f_{V} Q_{\\mathrm{out}, V} + f_{L}^{\\mathrm{land}} Q_{\\mathrm{out}, L} $$\n$$ Q_{\\mathrm{gen}} = (0.70)(35\\ \\mathrm{mm}) + (0.30)(4\\ \\mathrm{mm}) = 24.5\\ \\mathrm{mm} + 1.2\\ \\mathrm{mm} = 25.7\\ \\mathrm{mm} $$\nThis value represents the total water volume per unit grid cell area that should be transferred to the river routing model to ensure water conservation for the atmosphere-land system.\n\nHowever, due to the mask mismatch, the coupler transmits a different amount of water. Vegetated runoff is fully transmitted, but lake outflow is only transmitted over the river routing model's lake fraction, $f_{L}^{\\mathrm{route}} = 0.20$. The gridcell-mean outflow actually received by the routing model, $Q_{\\mathrm{rec}}$, is:\n$$ Q_{\\mathrm{rec}} = f_{V} Q_{\\mathrm{out}, V} + f_{L}^{\\mathrm{route}} Q_{\\mathrm{out}, L} $$\n$$ Q_{\\mathrm{rec}} = (0.70)(35\\ \\mathrm{mm}) + (0.20)(4\\ \\mathrm{mm}) = 24.5\\ \\mathrm{mm} + 0.8\\ \\mathrm{mm} = 25.3\\ \\mathrm{mm} $$\n\nThe gridcell-mean water loss, expressed as a depth $\\Delta H_{\\mathrm{loss}}$, is the difference between the water generated by the land model and the water received by the routing model:\n$$ \\Delta H_{\\mathrm{loss}} = Q_{\\mathrm{gen}} - Q_{\\mathrm{rec}} = 25.7\\ \\mathrm{mm} - 25.3\\ \\mathrm{mm} = 0.4\\ \\mathrm{mm} $$\nThis loss is due to the lake outflow produced over the non-overlapping portion of the lake-wetland tile, whose fractional area is $f_{L}^{\\mathrm{land}} - f_{L}^{\\mathrm{route}}$. We can verify this:\n$$ \\Delta H_{\\mathrm{loss}} = (f_{L}^{\\mathrm{land}} - f_{L}^{\\mathrm{route}}) Q_{\\mathrm{out}, L} = (0.30 - 0.20)(4\\ \\mathrm{mm}) = (0.10)(4\\ \\mathrm{mm}) = 0.4\\ \\mathrm{mm} $$\nThe gridcell-mean mass non-closure, $\\Delta m_{\\mathrm{loss}}$, is this depth of water multiplied by the density of water, $\\rho_{w} = 1000\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$. We must convert the depth to meters: $\\Delta H_{\\mathrm{loss}} = 0.4\\ \\mathrm{mm} = 0.4 \\times 10^{-3}\\ \\mathrm{m}$.\n$$ \\Delta m_{\\mathrm{loss}} = \\rho_{w} \\Delta H_{\\mathrm{loss}} = (1000\\ \\mathrm{kg}\\ \\mathrm{m}^{-3})(0.4 \\times 10^{-3}\\ \\mathrm{m}) = 0.4\\ \\mathrm{kg}\\ \\mathrm{m}^{-2} $$\nThis is the total mass of water lost per unit area of the grid cell over the $T = 30$-day period.\n\nTo restore water balance, we propose a correction that re-introduces this lost mass into the routing model. A minimal, physically consistent method is to add a source term, $S$, that is constant in time and uniform over the grid cell, whose integral over the month exactly equals the lost mass. Let the grid cell have area $A$. The total mass added is $S \\cdot A \\cdot T$. This must equal the total mass lost, which is $\\Delta m_{\\mathrm{loss}} \\cdot A$.\n$$ S \\cdot A \\cdot T = \\Delta m_{\\mathrm{loss}} \\cdot A $$\nSolving for $S$, the area $A$ cancels:\n$$ S = \\frac{\\Delta m_{\\mathrm{loss}}}{T} $$\nWe must express the time period $T$ in seconds to obtain the desired units of $\\mathrm{kg}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1}$.\n$$ T = 30\\ \\mathrm{days} \\times 24\\ \\frac{\\mathrm{hours}}{\\mathrm{day}} \\times 3600\\ \\frac{\\mathrm{s}}{\\mathrm{hour}} = 2,592,000\\ \\mathrm{s} $$\nNow, we compute the magnitude of the source term $S$:\n$$ S = \\frac{0.4\\ \\mathrm{kg}\\ \\mathrm{m}^{-2}}{2,592,000\\ \\mathrm{s}} \\approx 1.54320987... \\times 10^{-7}\\ \\mathrm{kg}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1} $$\nRounding this result to four significant figures gives:\n$$ S \\approx 1.543 \\times 10^{-7}\\ \\mathrm{kg}\\ \\mathrm{m}^{-2}\\ \\mathrm{s}^{-1} $$\nThis source term, when added to the routing model, ensures that the total water mass entering the routing model over the month equals the total lateral outflow generated by the land model, thereby closing the gridcell water budget.",
            "answer": "$$\n\\boxed{1.543 \\times 10^{-7}}\n$$"
        }
    ]
}