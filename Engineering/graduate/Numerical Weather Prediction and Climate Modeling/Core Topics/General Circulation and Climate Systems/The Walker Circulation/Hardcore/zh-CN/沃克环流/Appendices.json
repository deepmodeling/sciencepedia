{
    "hands_on_practices": [
        {
            "introduction": "沃克环流的根本驱动力是横跨赤道太平洋的海面温度（SST）梯度。维持这一梯度的关键过程是东太平洋由风驱动的深层冷水上涌。本练习提供了一个实用的“信封背面”计算，旨在量化这种上涌的冷却效应，让您能够将其量级与来自大气的表面加热直接比较，从而理解其在该区域气候系统中的主导作用。",
            "id": "4103999",
            "problem": "在赤道太平洋沃克环流中，表层东风驱动东部海盆的海洋上涌，通过较冷次表层水的垂直平流冷却混合层。从不可压缩、Boussinesq近似的海洋的位温守恒方程出发，确定仅由垂直平流贡献的局地欧拉温度倾向。然后，对于一个具有向上垂直速度 $w$ 和垂直温度梯度 $\\partial_{z} T$（其中 $z$ 向上为正）的东赤道太平洋混合层，评估该倾向的大小和符号。最后，通过将冷却率转换为板块混合层热收支中的等效表面热通量并形成比率，量化这种由垂直平流引起的冷却与典型的净表面热通量的比较。\n\n假设和数据：\n- 使用不可压缩Boussinesq近似，其中 $z$ 向上为正，$w0$ 表示上涌。\n- 忽略水平平流、湍流和分子扩散，以及内部源/汇，但除了一个仅通过混合层热收支起作用的规定的净表面热通量。\n- 海水密度为 $\\rho = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$，比热容为 $c_{p} = 3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$。\n- 混合层深度为 $H = 30\\ \\mathrm{m}$。\n- 上涌速度为 $w = 2 \\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$，垂直温度梯度为 $\\partial_{z} T = 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1}$。\n- 为与表面强迫进行比较，取净表面热通量的代表性大小为 $\\lvert Q_{\\mathrm{net}}\\rvert = 60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}$（向下为正）。\n\n任务：\n1. 根据所述假设，从温度守恒方程出发，用 $w$ 和 $\\partial_{z} T$ 写出仅由垂直平流引起的局地温度倾向的表达式，包括其符号约定。\n2. 使用给定的 $w$ 和 $\\partial_{z} T$，计算该倾向的数值，单位为 $\\mathrm{K}\\ \\mathrm{s}^{-1}$。\n3. 将此温度倾向转换为等效的表面热通量大小 $F_{\\mathrm{eq}}$（单位为 $\\mathrm{W}\\ \\mathrm{m}^{-2}$），该热通量将在深度为 $H$ 的板块模型中产生相同的混合层温度倾向。\n4. 形成等效通量大小与代表性净表面热通量大小的无量纲比率 $R = \\lvert F_{\\mathrm{eq}}\\rvert/\\lvert Q_{\\mathrm{net}}\\rvert$，并以纯数形式报告 $R$。\n\n将最终比率 $R$ 四舍五入至三位有效数字。将最终答案表示为无单位的纯数。",
            "solution": "该问题被验证为具有科学依据、问题明确、客观且自洽。所提供的数据和假设在赤道海洋学的背景下是物理上现实的。因此，我们可以着手求解。\n\n问题要求对东赤道太平洋混合层中由垂直平流引起的冷却和表面热通量进行定量比较。我们将按顺序完成这四个任务。\n\n**任务1：由垂直平流引起的局地温度倾向的表达式**\n\n我们从不可压缩流体中的温度 $T$ 守恒方程开始。温度的欧拉（局地）时间变化率由下式给出：\n$$ \\frac{\\partial T}{\\partial t} = - \\mathbf{u} \\cdot \\nabla T + \\nabla \\cdot (\\kappa \\nabla T) + S $$\n其中 $\\mathbf{u}$ 是速度矢量，$\\nabla T$ 是温度梯度，$\\kappa$ 是热扩散率，$S$ 代表任何内部热源或热汇。在笛卡尔坐标系 $(x, y, z)$ 中，此方程为：\n$$ \\frac{\\partial T}{\\partial t} = - \\left( u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} + w \\frac{\\partial T}{\\partial z} \\right) + \\text{diffusion} + \\text{sources/sinks} $$\n问题要求我们应用几个简化假设：\n1.  忽略水平平流：$u \\frac{\\partial T}{\\partial x} = 0$ 和 $v \\frac{\\partial T}{\\partial y} = 0$。\n2.  忽略湍流和分子扩散：项 $\\nabla \\cdot (\\kappa \\nabla T)$ 为零。\n3.  忽略内部源或汇：$S = 0$。\n\n应用这些简化，温度守恒方程简化为：\n$$ \\frac{\\partial T}{\\partial t} = - w \\frac{\\partial T}{\\partial z} $$\n该方程表明，局地温度的时间倾向完全由温度的垂直平流平衡。右侧的项 $-w \\frac{\\partial T}{\\partial z}$ 是仅由垂直平流贡献的局地温度倾向。坐标系指定 $z$ 向上为正，因此向上的速度（上涌）对应于 $w  0$。给定的垂直温度梯度 $\\partial_{z} T$ 为正，表示温度随高度 $z$ 增加。因此，上涌从下方输送较冷的水，导致负的温度倾向（冷却），这与预期相符。\n\n由垂直平流引起的局地温度倾向的表达式为 $\\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = -w \\frac{\\partial T}{\\partial z}$。\n\n**任务2：温度倾向的数值**\n\n给定以下数值：\n- 上涌速度：$w = 2 \\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$\n- 垂直温度梯度：$\\partial_{z} T = 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1}$\n\n将这些值代入任务1中导出的表达式：\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - \\left( 2 \\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1} \\right) \\left( 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1} \\right) $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - (2 \\times 0.05) \\times 10^{-5}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - 0.1 \\times 10^{-5}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = -1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\n温度倾向的数值为 $-1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1}$。负号证实了垂直平流导致冷却。\n\n**任务3：等效表面热通量**\n\n我们现在将此温度倾向转换为板块混合层模型的等效表面热通量 $F_{\\mathrm{eq}}$。对于一个水平面积为 $A$、深度为 $H$ 的海水柱，其总热含量为 $Q_{H} = m c_{p} T = (\\rho A H) c_{p} T$，其中 $\\rho$ 是密度，$c_{p}$ 是比热容。由表面热通量 $F$（单位为 $\\mathrm{W}\\ \\mathrm{m}^{-2}$）引起的热含量变化率为 $\\frac{dQ_{H}}{dt} = F A$。我们也可以用温度倾向来表示这个变化率：\n$$ \\frac{dQ_{H}}{dt} = \\frac{d}{dt} (\\rho A H c_{p} T) = \\rho c_{p} A H \\frac{dT}{dt} $$\n将两个表达式相等并除以面积 $A$，得到热通量和温度倾向之间的关系：\n$$ F = \\rho c_{p} H \\frac{dT}{dt} $$\n我们使用此公式来找到能够产生在任务2中计算出的温度倾向的等效热通量 $F_{\\mathrm{eq}}$。\n$$ F_{\\mathrm{eq}} = \\rho c_{p} H \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} $$\n给定以下常数：\n- 海水密度：$\\rho = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$\n- 比热容：$c_{p} = 3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n- 混合层深度：$H = 30\\ \\mathrm{m}$\n\n将这些值连同任务2中的倾向代入：\n$$ F_{\\mathrm{eq}} = (1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}) \\times (3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) \\times (30\\ \\mathrm{m}) \\times (-1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1}) $$\n$$ F_{\\mathrm{eq}} = (1025 \\times 3985 \\times 30) \\times (-1 \\times 10^{-6})\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n$$ F_{\\mathrm{eq}} = 122538750 \\times (-1 \\times 10^{-6})\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n$$ F_{\\mathrm{eq}} = -122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n负号表示热量流出海洋，与冷却一致。问题要求这个等效通量的大小。\n$$ \\lvert F_{\\mathrm{eq}}\\rvert = 122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n\n**任务4：无量纲比率**\n\n最后，我们计算等效平流热通量的大小与代表性净表面热通量大小 $\\lvert Q_{\\mathrm{net}}\\rvert = 60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}$ 的无量纲比率 $R$。\n$$ R = \\frac{\\lvert F_{\\mathrm{eq}}\\rvert}{\\lvert Q_{\\mathrm{net}}\\rvert} $$\n$$ R = \\frac{122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2}}{60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}} $$\n$$ R = 2.0423125 $$\n问题要求将最终答案四舍五入到三位有效数字。\n$$ R \\approx 2.04 $$\n这个结果表明，该区域垂直平流的冷却效应在量级上大约是典型地表净加热的两倍。这凸显了上涌在维持赤道冷舌中的主导作用。",
            "answer": "$$\\boxed{2.04}$$"
        },
        {
            "introduction": "一旦海温梯度建立，大气便会以大尺度翻转环流——即沃克环流——作为响应。为了将这一环流可视化并进行量化，科学家们常使用纬向质量流函数 $\\Psi$。本练习将指导您完成从基本风场数据中数值推导流函数的过程，这是一项气候诊断中的核心技能，它能将矢量风场转化为对质量输送的清晰描绘。",
            "id": "4104032",
            "problem": "给定代表与 Walker 环流相关的赤道纬向通道上的纬向风 $u(x,p)$ 和垂直气压速度 $\\omega(x,p)$ 的网格场。从气压坐标系中的连续性方程和一个在二维纬向-垂直 $(x,p)$ 平面上的适当流函数定义出发，推导并实现一个数值方法来诊断纬向质量流函数 $\\Psi(x,p)$，并用它来识别 Walker 环流的上升支和下降支及其峰值大小。\n\n其基本依据是气压坐标系中的连续性方程，对于水平风分量 $u$ 和 $v$ 以及垂直气压速度 $\\omega$，该方程表述为\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial \\omega}{\\partial p} = 0.\n$$\n假设一个在狭窄纬度带上平均的纬向-垂直二维切片，使得 $\\partial v/\\partial y \\approx 0$，并假设存在一个满足以下条件的流函数 $\\Psi(x,p)$\n$$\nu = \\frac{\\partial \\Psi}{\\partial p}, \\quad \\omega = -\\frac{\\partial \\Psi}{\\partial x}.\n$$\n这些关系在 $(x,p)$ 平面上恒等地满足连续性方程。在模式顶气压 $p_0$ 处施加具有物理动机的边界条件 $\\Psi(x,p_0)=0$ 以固定规范自由度。您的诊断算法必须通过将 $u$ 从 $p_0$ 到 $p$ 进行垂直积分来计算 $\\Psi(x,p)$，然后从 $\\Psi$ 诊断出 $\\omega$ 为 $\\omega = -\\partial \\Psi/\\partial x$。\n\n单位：\n- $u$ 必须以米/秒 ($\\mathrm{m\\,s^{-1}}$) 为单位。\n- $\\omega$ 必须以帕斯卡/秒 ($\\mathrm{Pa\\,s^{-1}}$) 为单位。\n- $p$ 必须以帕斯卡 ($\\mathrm{Pa}$) 为单位。\n- $x$ 必须以米 ($\\mathrm{m}$) 为单位。\n不使用角度。\n\n您的程序必须：\n1. 使用沿 $p$ 维的二阶精度梯形法则实现 $\\Psi(x,p)$ 的垂直积分，并固定 $\\Psi(x,p_0)=0$。\n2. 使用内部的中心有限差分和沿 $x$ 边界的单边差分计算诊断的垂直速度 $\\hat{\\omega}(x,p) = -\\partial \\Psi/\\partial x$。\n3. 从 $\\hat{\\omega}$ 中识别上升（向上运动）支和下降（向下运动）支，即 $\\hat{\\omega}  0$（上升）和 $\\hat{\\omega} > 0$（下降）的区域。\n4. 计算上升和下降运动的峰值大小（以正浮点数表示）：\n   - 上升峰值大小为全域内的 $\\max\\{-\\hat{\\omega}(x,p)\\}$，以 $\\mathrm{Pa\\,s^{-1}}$ 表示。\n   - 下降峰值大小为全域内的 $\\max\\{\\hat{\\omega}(x,p)\\}$，以 $\\mathrm{Pa\\,s^{-1}}$ 表示。\n5. 为提供数据一致性的信息，还需计算所提供的 $\\omega$ 和诊断出的 $\\hat{\\omega}$ 之间的均方根 (RMS) 不匹配度 $\\Delta_{\\mathrm{rms}}$：\n$$\n\\Delta_{\\mathrm{rms}} = \\left( \\frac{1}{N_x N_p} \\sum_{i=1}^{N_x} \\sum_{j=1}^{N_p} \\left[ \\omega(x_i,p_j) - \\hat{\\omega}(x_i,p_j) \\right]^2 \\right)^{1/2},\n$$\n以 $\\mathrm{Pa\\,s^{-1}}$ 表示。\n\n测试套件：\n对以下三个科学上合理且自洽的测试案例实施该方法。在所有案例中，对 $x$ 和 $p$ 使用均匀网格，对 $p$ 的积分使用梯形法则，对 $x$ 使用二阶有限差分。\n\n- 案例 A（与连续性方程一致的典型单体 Walker 环流）：\n  - 区域和网格：$N_x = 64$，$N_p = 30$，$L = 1.6\\times 10^7\\,\\mathrm{m}$，$p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$，$p_1 = 1.0\\times 10^5\\,\\mathrm{Pa}$。\n  - 坐标：$x_i$ 从 $0$ 到 $L$ 线性间隔，$p_j$ 从 $p_0$ 到 $p_1$ 线性间隔。\n  - 真实流函数：$\\Psi^{\\mathrm{true}}(x,p) = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0)$，其中 $A = 0.05\\,\\mathrm{m\\,s^{-1}}$。\n  - 数据：$u(x,p) = \\frac{\\partial \\Psi^{\\mathrm{true}}}{\\partial p} = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)$；$\\omega(x,p) = -\\frac{\\partial \\Psi^{\\mathrm{true}}}{\\partial x} = -A \\frac{2\\pi}{L} \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0)$。\n\n- 案例 B（无环流：均匀纬向风和零垂直运动，与连续性方程一致）：\n  - 区域和网格：$N_x = 32$，$N_p = 20$，$L = 1.0\\times 10^7\\,\\mathrm{m}$，$p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$，$p_1 = 1.0\\times 10^5\\,\\mathrm{Pa}$。\n  - 数据：$u(x,p) = U_0$，其中 $U_0 = 10\\,\\mathrm{m\\,s^{-1}}$；$\\omega(x,p) = 0\\,\\mathrm{Pa\\,s^{-1}}$。\n\n- 案例 C（具有弱纬向和垂直变率的不一致场）：\n  - 区域和网格：$N_x = 48$，$N_p = 24$，$L = 1.2\\times 10^7\\,\\mathrm{m}$，$p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$，$p_1 = 9.0\\times 10^4\\,\\mathrm{Pa}$。\n  - 坐标：$x_i$ 从 $0$ 到 $L$ 线性间隔，$p_j$ 从 $p_0$ 到 $p_1$ 线性间隔。\n  - 纬向风：$u(x,p) = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right) + B \\cos\\!\\left(\\pi \\frac{p - p_0}{p_1 - p_0}\\right)$，其中 $A = 0.03\\,\\mathrm{m\\,s^{-1}}$，$B = 2.0\\times 10^{-3}\\,\\mathrm{m\\,s^{-1}}$。\n  - 垂直速度：$\\omega(x,p) = -A \\frac{2\\pi}{L} \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0) + \\delta \\sin\\!\\left(\\frac{4\\pi x}{L}\\right) + \\eta \\sin\\!\\left(3\\pi \\frac{p - p_0}{p_1 - p_0}\\right)$，其中 $\\delta = 5.0\\times 10^{-4}\\,\\mathrm{Pa\\,s^{-1}}$ 且 $\\eta = 3.0\\times 10^{-4}\\,\\mathrm{Pa\\,s^{-1}}$。\n\n答案规格：\n- 对于每个测试案例，计算并返回一个包含三个浮点数的列表 $[\\text{up\\_peak}, \\text{down\\_peak}, \\Delta_{\\mathrm{rms}}]$，其中 $\\text{up\\_peak}$ 和 $\\text{down\\_peak}$ 是以 $\\mathrm{Pa\\,s^{-1}}$ 表示的上升和下降峰值大小，$\\Delta_{\\mathrm{rms}}$ 是以 $\\mathrm{Pa\\,s^{-1}}$ 表示的不匹配度。\n- 您的程序应生成单行输出，其中包含结果，格式为方括号括起来的逗号分隔列表，每个测试案例一个列表，格式完全如下：\n$$\n[\\,[\\text{up}_A,\\text{down}_A,\\Delta_A],\\,[\\text{up}_B,\\text{down}_B,\\Delta_B],\\,[\\text{up}_C,\\text{down}_C,\\Delta_C]\\,]\n$$\n所有值都应为标准十进制浮点数。所有量值均以 $\\mathrm{Pa\\,s^{-1}}$ 表示。",
            "solution": "我们从气压坐标系连续性方程开始，\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial \\omega}{\\partial p} = 0,\n$$\n该方程在静力平衡以及大气动力学中从高度到气压作为垂直坐标的标准转换下成立。对于一个在 $\\partial v/\\partial y \\approx 0$ 的狭窄纬度带上平均的纬向-垂直 $(x,p)$ 切片，该方程简化为\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial \\omega}{\\partial p} = 0.\n$$\n一种恒等满足此简化连续性方程的经典方法是引入一个流函数 $\\Psi(x,p)$，使得\n$$\nu = \\frac{\\partial \\Psi}{\\partial p}, \\qquad \\omega = -\\frac{\\partial \\Psi}{\\partial x}.\n$$\n确实，\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial \\omega}{\\partial p} = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\Psi}{\\partial p}\\right) + \\frac{\\partial}{\\partial p}\\left(-\\frac{\\partial \\Psi}{\\partial x}\\right) = \\frac{\\partial^2 \\Psi}{\\partial x \\,\\partial p} - \\frac{\\partial^2 \\Psi}{\\partial p \\,\\partial x} = 0,\n$$\n根据在足够光滑的条件下混合偏导数相等的定理。流函数的确定有一个可加常数的任意性；在物理上，我们通过施加边界条件来固定这个规范\n$$\n\\Psi(x,p_0) = 0,\n$$\n其中 $p_0$ 是顶层气压（区域内气压的最小值）。这个选择是自然的：它确保质量输送是相对于顶层边界来测量的。\n\n给定均匀网格 $x_i$ 和 $p_j$ 上的离散数据 $u(x_i,p_j)$，我们可以通过对 $u$ 从 $p_0$ 进行垂直积分来确定 $\\Psi$：\n$$\n\\Psi(x_i,p_j) = \\int_{p_0}^{p_j} u(x_i,p') \\,\\mathrm{d}p'.\n$$\n在数值上，这个积分使用沿气压维度的二阶精度梯形法则进行近似。定义网格间距 $\\Delta x$ 和 $\\Delta p_j = p_j - p_{j-1}$，我们设置\n$$\n\\Psi(x_i,p_0) = 0, \\quad \\Psi(x_i,p_j) = \\Psi(x_i,p_{j-1}) + \\frac{1}{2}\\left[ u(x_i,p_{j-1}) + u(x_i,p_j) \\right]\\,(p_j - p_{j-1}).\n$$\n一旦 $\\Psi$ 已知，垂直速度就可从 $\\Psi$ 诊断出来，即\n$$\n\\hat{\\omega}(x_i,p_j) = -\\frac{\\partial \\Psi}{\\partial x}\\bigg|_{(x_i,p_j)}.\n$$\n在均匀网格上，我们用内部的二阶中心差分来近似这个导数，\n$$\n\\hat{\\omega}(x_i,p_j) \\approx -\\frac{\\Psi(x_{i+1},p_j) - \\Psi(x_{i-1},p_j)}{2\\,\\Delta x},\n$$\n以及在边界处使用一阶单边差分，\n$$\n\\hat{\\omega}(x_0,p_j) \\approx -\\frac{\\Psi(x_1,p_j) - \\Psi(x_0,p_j)}{\\Delta x}, \\quad \\hat{\\omega}(x_{N_x-1},p_j) \\approx -\\frac{\\Psi(x_{N_x-1},p_j) - \\Psi(x_{N_x-2},p_j)}{\\Delta x}.\n$$\n\n上升和下降支由 $\\hat{\\omega}$ 的符号定义。在气压坐标系中，负的 $\\omega$ 表示向上运动（上升），而正的 $\\omega$ 表示向下运动（下降）。峰值大小计算如下\n$$\n\\text{up\\_peak} = \\max_{i,j} \\left( -\\hat{\\omega}(x_i,p_j) \\right) \\quad \\text{with } \\hat{\\omega}(x_i,p_j)  0,\n$$\n$$\n\\text{down\\_peak} = \\max_{i,j} \\left( \\hat{\\omega}(x_i,p_j) \\right) \\quad \\text{with } \\hat{\\omega}(x_i,p_j) > 0.\n$$\n如果没有上升（或下降）点存在，则相应的峰值设为零。\n\n为了评估与所提供的 $\\omega$ 的一致性，我们计算均方根不匹配度\n$$\n\\Delta_{\\mathrm{rms}} = \\left( \\frac{1}{N_x N_p} \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_p-1} \\left[ \\omega(x_i,p_j) - \\hat{\\omega}(x_i,p_j) \\right]^2 \\right)^{1/2}.\n$$\n\n算法设计：\n- 输入：网格 $x_i$（以米为单位的均匀网格）、$p_j$（以帕斯卡为单位的均匀网格），以及数据数组 $u(x_i,p_j)$ 和 $\\omega(x_i,p_j)$，单位分别为 $\\mathrm{m\\,s^{-1}}$ 和 $\\mathrm{Pa\\,s^{-1}}$。\n- 步骤 1：对所有 $i$ 初始化 $\\Psi(x_i,p_0) = 0$。\n- 步骤 2：对每个 $i$，沿 $p$ 使用梯形法则积分以获得 $j=1,\\dots,N_p-1$ 时的 $\\Psi(x_i,p_j)$。\n- 步骤 3：沿 $x$ 对 $\\Psi$ 微分，使用域内中心差分和边界单边差分得到 $\\hat{\\omega}(x_i,p_j)$。\n- 步骤 4：从 $\\hat{\\omega}$ 计算 $\\text{up\\_peak}$ 和 $\\text{down\\_peak}$。\n- 步骤 5：计算与所提供的 $\\omega$ 之间的 $\\Delta_{\\mathrm{rms}}$。\n- 输出：对每个测试案例，返回列表 $[\\text{up\\_peak}, \\text{down\\_peak}, \\Delta_{\\mathrm{rms}}]$，其量值单位为 $\\mathrm{Pa\\,s^{-1}}$。\n\n对于测试套件，案例 A 的数据是根据一个已知的解析流函数 $\\Psi^{\\mathrm{true}}$ 构建的，因此诊断出的 $\\hat{\\omega}$ 会非常接近所提供的 $\\omega$，从而得到很小的 $\\Delta_{\\mathrm{rms}}$。案例 B 没有纬向变化，因此 $\\Psi$ 与 $x$ 无关，且 $\\hat{\\omega} \\equiv 0$，从而得到零峰值和零不匹配度。案例 C 在 $u$ 和 $\\omega$ 中包含了额外的纬向和垂直结构，这破坏了完美的一致性；诊断出的 $\\hat{\\omega}$ 将不会与所提供的 $\\omega$ 精确匹配，并且 $\\Delta_{\\mathrm{rms}}$ 将不为零，而峰值则反映了由 $u$ 中依赖于 $x$ 的部分驱动的主要翻转运动。\n\n该方法基于基本的连续性方程，并利用流函数来强制 $(x,p)$ 平面上的质量守恒。所选择的数值方法（梯形积分和二阶差分）在均匀网格上提供了足够的精度和稳定性，并广泛用于数值天气预报和气候模拟实践中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef integrate_streamfunction_trapezoid(u, p):\n    \"\"\"\n    Compute Psi(x,p) from u(x,p) by vertical integration using the trapezoidal rule.\n    Psi(x, p_top) is set to 0 for all x.\n    u: array shape (Nx, Np), units m/s\n    p: array shape (Np,), units Pa\n    Returns Psi with shape (Nx, Np), units Pa*m/s\n    \"\"\"\n    Nx, Np = u.shape\n    Psi = np.zeros((Nx, Np), dtype=float)\n    # Integrate along p for each x\n    for i in range(Nx):\n        # Psi[i,0] = 0 by boundary condition\n        for j in range(1, Np):\n            dp = p[j] - p[j-1]\n            Psi[i, j] = Psi[i, j-1] + 0.5 * (u[i, j-1] + u[i, j]) * dp\n    return Psi\n\ndef diagnose_omega_from_psi(Psi, x):\n    \"\"\"\n    Compute omega_hat(x,p) = -dPsi/dx using finite differences.\n    Psi: array shape (Nx, Np), units Pa*m/s\n    x: array shape (Nx,), units m\n    Returns omega_hat with shape (Nx, Np), units Pa/s\n    \"\"\"\n    Nx, Np = Psi.shape\n    omega_hat = np.zeros_like(Psi)\n    dx = x[1] - x[0]\n    # Boundaries: one-sided differences\n    omega_hat[0, :] = -(Psi[1, :] - Psi[0, :]) / dx\n    omega_hat[-1, :] = -(Psi[-1, :] - Psi[-2, :]) / dx\n    # Interior: centered differences\n    for i in range(1, Nx-1):\n        omega_hat[i, :] = -(Psi[i+1, :] - Psi[i-1, :]) / (2.0 * dx)\n    return omega_hat\n\ndef compute_peaks(omega_hat):\n    \"\"\"\n    Compute ascending and descending peak magnitudes from omega_hat.\n    Ascending: omega_hat  0, peak is max(-omega_hat).\n    Descending: omega_hat > 0, peak is max(omega_hat).\n    Returns (up_peak, down_peak) as floats in Pa/s.\n    \"\"\"\n    # Ascending peak\n    neg_mask = omega_hat  0.0\n    if np.any(neg_mask):\n        up_peak = float(np.max(-omega_hat[neg_mask]))\n    else:\n        up_peak = 0.0\n    # Descending peak\n    pos_mask = omega_hat > 0.0\n    if np.any(pos_mask):\n        down_peak = float(np.max(omega_hat[pos_mask]))\n    else:\n        down_peak = 0.0\n    return up_peak, down_peak\n\ndef rms_mismatch(omega, omega_hat):\n    \"\"\"\n    Compute RMS mismatch between provided omega and diagnosed omega_hat.\n    Both arrays shape (Nx, Np), units Pa/s.\n    \"\"\"\n    diff = omega - omega_hat\n    return float(np.sqrt(np.mean(diff**2)))\n\ndef case_A():\n    # Canonical single-cell Walker circulation\n    Nx = 64\n    Np = 30\n    L = 1.6e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 1.0e5  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n    A = 0.05  # m/s\n\n    # Construct u and omega from true streamfunction\n    # u(x,p) = A * sin(2pi x / L)\n    u = (A * np.sin(2.0 * np.pi * x / L))[:, None] * np.ones((1, Np))\n    # omega(x,p) = -A * (2pi/L) * cos(2pi x / L) * (p - p_top)\n    omega = (-A * (2.0 * np.pi / L) * np.cos(2.0 * np.pi * x / L))[:, None] * (p - p_top)[None, :]\n\n    # Diagnose\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef case_B():\n    # No circulation: constant u, zero omega\n    Nx = 32\n    Np = 20\n    L = 1.0e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 1.0e5  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n    U0 = 10.0  # m/s\n    u = U0 * np.ones((Nx, Np))\n    omega = np.zeros((Nx, Np))\n\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef case_C():\n    # Inconsistent fields with weak zonal and vertical variability\n    Nx = 48\n    Np = 24\n    L = 1.2e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 9.0e4  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n\n    A = 0.03  # m/s\n    B = 2.0e-3  # m/s\n    delta = 5.0e-4  # Pa/s\n    eta = 3.0e-4  # Pa/s\n\n    # u(x,p) = A sin(2pi x/L) + B cos(pi (p-p0)/(p1-p0))\n    u = (A * np.sin(2.0 * np.pi * x / L))[:, None] * np.ones((1, Np)) + \\\n        B * np.cos(np.pi * (p - p_top) / (p_bot - p_top))[None, :]\n\n    # omega(x,p) = -A * (2pi/L) * cos(2pi x/L) * (p - p0) + delta sin(4pi x/L) + eta sin(3pi (p-p0)/(p1-p0))\n    omega = (-A * (2.0 * np.pi / L) * np.cos(2.0 * np.pi * x / L))[:, None] * (p - p_top)[None, :] + \\\n            (delta * np.sin(4.0 * np.pi * x / L))[:, None] * np.ones((1, Np)) + \\\n            eta * np.sin(3.0 * np.pi * (p - p_top) / (p_bot - p_top))[None, :]\n\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef solve():\n    test_cases_results = []\n    test_cases_results.append(case_A())\n    test_cases_results.append(case_B())\n    test_cases_results.append(case_C())\n    # Final print statement in the exact required format.\n    # Single line: list of lists, each [up_peak, down_peak, delta_rms]\n    print(f\"[{','.join(map(str, test_cases_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "气候模式是理解和预测沃克环流的重要工具，但它们并非完美无缺。建模者的一个关键任务是诊断和理解模式误差（或称“偏差”）的来源。这项高级练习引入了一个正式的框架，用于将模式中沃克环流的偏差归因于底层海温强迫的误差，或是模式自身物理参数化的缺陷，这反映了主要建模中心的核心诊断工作流程。",
            "id": "4104031",
            "problem": "给定在一个小型二维网格上的模拟场和观测场，该网格代表一个用于诊断沃克环流的理想化赤道太平洋剖面。从基本定律出发，考虑静力平衡（$\\partial p / \\partial z = - \\rho g$）、质量连续性（$\\nabla \\cdot \\vec{v} + \\partial \\omega / \\partial p = 0$）和对流准平衡（其中非绝热加热迅速调整以维持近中性稳定度）意味着垂直气压速度 $\\omega$（单位为 $\\mathrm{Pa\\,s^{-1}}$）响应于由海表温度 $T_s$（单位为 $\\mathrm{K}$）梯度驱动的热力强迫和水平辐合。使用这些原理来定义一个诊断上一致的沃克环流指数和一个误差归因框架。\n\n定义：\n- 设网格形状为 $N_\\phi \\times N_\\lambda$，其中有 $N_\\phi = 3$ 个纬度行和 $N_\\lambda = 6$ 个经度列。赤道带是索引为 $1$ 的行。西太平洋区域是列的集合 $\\{0,1,2\\}$，东太平洋区域是列的集合 $\\{3,4,5\\}$。\n- 沃克环流指数（WCI）定义为\n$$\n\\mathrm{WCI} = \\overline{\\max(-\\omega,0)}_{\\text{west, eq}} - \\overline{\\max(\\omega,0)}_{\\text{east, eq}},\n$$\n其中 $\\overline{\\cdot}_{\\text{west, eq}}$ 和 $\\overline{\\cdot}_{\\text{east, eq}}$ 表示在赤道带内指定区域的算术平均值。$\\mathrm{WCI}$ 的单位是 $\\mathrm{Pa\\,s^{-1}}$。\n- 纬向海表温度差异定义为\n$$\n\\Delta T_s = \\overline{T_s}_{\\text{west, eq}} - \\overline{T_s}_{\\text{east, eq}},\n$$\n单位为 $\\mathrm{K}$。\n\n误差归因框架：\n- 设 $s$ 是一个敏感度，用于在对流准平衡下将海表温度偏差转换为垂直运动偏差，取一个物理上合理的常数 $s = 0.02$ $\\mathrm{Pa\\,s^{-1}\\,K^{-1}}$。\n- 定义赤道海表温度偏差场\n$$\nb_T(i) = T_{s,\\text{sim}}(i) - T_{s,\\text{obs}}(i),\n$$\n对于每个赤道网格点 $i$，以及预测的垂直运动偏差场\n$$\nb_\\omega^{\\text{pred}}(i) = - s \\, b_T(i),\n$$\n这反映了较暖的海表温度倾向于促进上升运动（更负的 $\\omega$）。\n- 定义在赤道网格点上实现的垂直运动误差场\n$$\nb_\\omega^{\\text{real}}(i) = \\omega_{\\text{sim}}(i) - \\omega_{\\text{obs}}(i).\n$$\n- 计算 $b_\\omega^{\\text{pred}}$ 和 $b_\\omega^{\\text{real}}$ 之间的皮尔逊相关系数，\n$$\nr = \\frac{\\sum_i \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)\\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)}{\\sqrt{\\sum_i \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)^2}\\sqrt{\\sum_i \\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)^2}},\n$$\n约定如果分母中的任一标准差为零，则设 $r = 0$。\n- 计算振幅比\n$$\n\\rho = \\frac{\\sigma\\left(b_\\omega^{\\text{real}}\\right)}{\\sigma\\left(b_\\omega^{\\text{pred}}\\right)},\n$$\n其中 $\\sigma(\\cdot)$ 表示总体标准差，如果 $\\sigma\\left(b_\\omega^{\\text{pred}}\\right) = 0$，则定义 $\\rho = +\\infty$。\n- 设分类阈值为 $r_0 = 0.6$，振幅边界为 $[\\rho_{\\min}, \\rho_{\\max}] = [0.5, 2.0]$。\n- 当且仅当以下所有条件都成立时，将误差归因于平均态海表温度偏差：$r \\ge r_0$、$\\rho_{\\min} \\le \\rho \\le \\rho_{\\max}$，以及 $\\operatorname{sign}\\left(\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}\\right) = \\operatorname{sign}\\left(\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}\\right)$。否则，将误差归因于参数化。使用整数代码 $1$ 表示平均态海表温度偏差，使用 $0$ 表示参数化。\n\n您的程序必须为每个测试用例计算：\n- $\\mathrm{WCI}$ 偏差 $\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}$，单位为 $\\mathrm{Pa\\,s^{-1}}$，四舍五入到三位小数。\n- $\\Delta T_s$ 偏差 $\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}$，单位为 $\\mathrm{K}$，四舍五入到三位小数。\n- 归因代码，以整数形式表示。\n\n测试套件（每个用例在 $3 \\times 6$ 网格上提供 $(\\omega_{\\text{obs}}, \\omega_{\\text{sim}}, T_{s,\\text{obs}}, T_{s,\\text{sim}})$；赤道带以外的值可视为 $0$ 并且不在诊断中使用）：\n1. 用例 A（与海表温度偏差大体一致）：\n   - 赤道 $\\omega_{\\text{obs}}$ 西部：$[-0.060, -0.050, -0.040]$，东部：$[0.030, 0.020, 0.020]$。\n   - 赤道 $\\omega_{\\text{sim}}$ 西部：$[-0.040, -0.030, -0.030]$，东部：$[0.020, 0.015, 0.015]$。\n   - 赤道 $T_{s,\\text{obs}}$ 西部：$[302.0, 302.0, 301.5]$，东部：$[299.0, 299.5, 299.0]$。\n   - 赤道 $T_{s,\\text{sim}}$ 西部：$[301.0, 301.0, 300.5]$，东部：$[300.0, 300.0, 300.0]$。\n2. 用例 B（没有海表温度偏差但存在垂直运动误差，表明存在参数化问题）：\n   - 赤道 $\\omega_{\\text{obs}}$ 西部：$[-0.050, -0.050, -0.050]$，东部：$[0.020, 0.020, 0.020]$。\n   - 赤道 $\\omega_{\\text{sim}}$ 西部：$[-0.080, -0.080, -0.080]$，东部：$[0.040, 0.040, 0.040]$。\n   - 赤道 $T_{s,\\text{obs}}$ 西部：$[301.5, 301.5, 301.5]$，东部：$[299.5, 299.5, 299.5]$。\n   - 赤道 $T_{s,\\text{sim}}$ 西部：$[301.5, 301.5, 301.5]$，东部：$[299.5, 299.5, 299.5]$。\n3. 用例 C（均匀的海表温度偏移保留了梯度，但垂直响应过强，表明存在参数化问题）：\n   - 赤道 $\\omega_{\\text{obs}}$ 西部：$[-0.050, -0.050, -0.050]$，东部：$[0.025, 0.025, 0.025]$。\n   - 赤道 $\\omega_{\\text{sim}}$ 西部：$[-0.100, -0.100, -0.100]$，东部：$[0.050, 0.050, 0.050]$。\n   - 赤道 $T_{s,\\text{obs}}$ 西部：$[301.0, 301.0, 301.0]$，东部：$[299.0, 299.0, 299.0]$。\n   - 赤道 $T_{s,\\text{sim}}$ 西部：$[302.0, 302.0, 302.0]$，东部：$[300.0, 300.0, 300.0]$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含三个用例的结果，格式为用方括号括起来的逗号分隔的列表的列表，其中每个内部列表包含三个值 $[\\mathrm{WCI\\_bias}, \\Delta T_{s,\\text{bias}}, \\text{code}]$。例如，输出格式为\n$$\n[\\,[w_1, d_1, c_1],\\,[w_2, d_2, c_2],\\,[w_3, d_3, c_3]\\,],\n$$\n其中 $w_i$ 和 $d_i$ 四舍五入到三位小数，$w_i$ 的单位是 $\\mathrm{Pa\\,s^{-1}}$，$d_i$ 的单位是 $\\mathrm{K}$，$c_i$ 是一个整数。",
            "solution": "该问题被评估为有效。它在科学上以热带大气动力学原理为基础，定义明确，提供了所有必要的定义和数据，并且其表述客观。任务是基于一套明确定义的数学和逻辑规则，实现一个沃克环流的诊断和误差归因框架。\n\n解决方案通过系统地将所提供的定义应用于每个测试用例来执行。对于每个以观测场和模拟场 $(\\omega_{\\text{obs}}, \\omega_{\\text{sim}}, T_{s,\\text{obs}}, T_{s,\\text{sim}})$ 为特征的用例，我们将计算沃克环流指数（WCI）偏差、纬向海表温度差异（$\\Delta T_s$）偏差和一个归因代码。\n\n首先，我们定义函数来计算任何给定赤道场的 WCI 和 $\\Delta T_s$。网格由 $N_\\lambda=6$ 个经度点组成，西部区域包括索引 $\\{0, 1, 2\\}$，东部区域包括索引 $\\{3, 4, 5\\}$。\n\n沃克环流指数 $\\mathrm{WCI}$ 定义为：\n$$\n\\mathrm{WCI} = \\overline{\\max(-\\omega,0)}_{\\text{west, eq}} - \\overline{\\max(\\omega,0)}_{\\text{east, eq}}\n$$\n该指数量化了环流的强度。项 $\\overline{\\max(-\\omega,0)}_{\\text{west, eq}}$ 捕捉了西部区域的平均上升运动（按照惯例，$\\omega  0$），因为当 $\\omega$ 为负时 $\\max(-\\omega, 0)$ 为正，否则为零。项 $\\overline{\\max(\\omega,0)}_{\\text{east, eq}}$ 捕捉了东部区域的平均下沉运动（$\\omega > 0$）。对于给定的赤道场 $\\omega$ 的计算如下：\n$$\n\\mathrm{WCI}(\\omega) = \\frac{1}{3} \\sum_{i=0}^{2} \\max(-\\omega(i), 0) - \\frac{1}{3} \\sum_{i=3}^{5} \\max(\\omega(i), 0)\n$$\n我们对 $\\omega_{\\text{obs}}$ 和 $\\omega_{\\text{sim}}$ 都进行此计算，以找到 $\\mathrm{WCI}_{\\text{obs}}$ 和 $\\mathrm{WCI}_{\\text{sim}}$。然后 WCI 偏差为 $\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}$。\n\n纬向海表温度差异 $\\Delta T_s$ 定义为：\n$$\n\\Delta T_s = \\overline{T_s}_{\\text{west, eq}} - \\overline{T_s}_{\\text{east, eq}}\n$$\n这代表驱动环流的温度梯度。对于给定的场 $T_s$ 的计算如下：\n$$\n\\Delta T_s(T_s) = \\left(\\frac{1}{3} \\sum_{i=0}^{2} T_s(i)\\right) - \\left(\\frac{1}{3} \\sum_{i=3}^{5} T_s(i)\\right)\n$$\n我们对 $T_{s,\\text{obs}}$ 和 $T_{s,\\text{sim}}$ 都进行此计算，以找到 $\\Delta T_{s,\\text{obs}}$ 和 $\\Delta T_{s,\\text{sim}}$。$\\Delta T_s$ 偏差为 $\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}$。\n\n其次，我们实现误差归因框架。这需要在 $N_\\lambda=6$ 个赤道网格点上计算三个中间场：\n1.  海表温度偏差场：$b_T(i) = T_{s,\\text{sim}}(i) - T_{s,\\text{obs}}(i)$\n2.  预测的垂直运动偏差场，基于对 SST 偏差的线性响应，敏感度为 $s=0.02\\,\\mathrm{Pa\\,s^{-1}\\,K^{-1}}$：$b_\\omega^{\\text{pred}}(i) = - s \\, b_T(i)$\n3.  实现的（实际的）垂直运动误差场：$b_\\omega^{\\text{real}}(i) = \\omega_{\\text{sim}}(i) - \\omega_{\\text{obs}}(i)$\n\n有了这些场，我们计算两个诊断统计量：\n- 预测偏差 $b_\\omega^{\\text{pred}}$ 和实现偏差 $b_\\omega^{\\text{real}}$ 之间的皮尔逊相关系数 $r$。如果任一场的标准差为零，则 $r$ 定义为 $0$。公式为：\n$$\nr = \\frac{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)\\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)}{\\sqrt{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)^2}\\sqrt{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)^2}}\n$$\n- 振幅比 $\\rho$，定义为两个场的总体标准差之比。如果预测偏差的标准差为零，则 $\\rho$ 定义为 $+\\infty$。\n$$\n\\rho = \\frac{\\sigma\\left(b_\\omega^{\\text{real}}\\right)}{\\sigma\\left(b_\\omega^{\\text{pred}}\\right)}\n$$\n\n最后，我们确定归因代码。当且仅当以下所有三个条件都满足时，误差归因于平均态 SST 偏差（代码 $1$）：\n1.  相关性足够高：$r \\ge r_0$，其中 $r_0 = 0.6$。\n2.  实现误差的振幅与预测误差的振幅相当：$\\rho_{\\min} \\le \\rho \\le \\rho_{\\max}$，其中 $[\\rho_{\\min}, \\rho_{\\max}] = [0.5, 2.0]$。\n3.  WCI 偏差的符号与 $\\Delta T_s$ 偏差的符号一致：$\\operatorname{sign}(\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}) = \\operatorname{sign}(\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}})$。我们使用标准的符号函数，其中 $\\operatorname{sign}(0)=0$。\n\n如果所有三个条件都为真，则归因代码为 $1$；否则为 $0$。\n\n程序将对提供的三个测试用例中的每一个执行这整个过程，将最终的偏差值四舍五入到三位小数，并将结果组装成指定的列表的列表格式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Walker circulation error attribution problem for the given test cases.\n    \"\"\"\n    \n    # Define constants and thresholds from the problem statement.\n    s = 0.02  # Pa s^-1 K^-1\n    r_0 = 0.6\n    rho_min, rho_max = 0.5, 2.0\n\n    # Test suite data\n    test_cases = [\n        # Case A\n        {\n            \"omega_obs\": np.array([-0.060, -0.050, -0.040, 0.030, 0.020, 0.020]),\n            \"omega_sim\": np.array([-0.040, -0.030, -0.030, 0.020, 0.015, 0.015]),\n            \"Ts_obs\": np.array([302.0, 302.0, 301.5, 299.0, 299.5, 299.0]),\n            \"Ts_sim\": np.array([301.0, 301.0, 300.5, 300.0, 300.0, 300.0]),\n        },\n        # Case B\n        {\n            \"omega_obs\": np.array([-0.050, -0.050, -0.050, 0.020, 0.020, 0.020]),\n            \"omega_sim\": np.array([-0.080, -0.080, -0.080, 0.040, 0.040, 0.040]),\n            \"Ts_obs\": np.array([301.5, 301.5, 301.5, 299.5, 299.5, 299.5]),\n            \"Ts_sim\": np.array([301.5, 301.5, 301.5, 299.5, 299.5, 299.5]),\n        },\n        # Case C\n        {\n            \"omega_obs\": np.array([-0.050, -0.050, -0.050, 0.025, 0.025, 0.025]),\n            \"omega_sim\": np.array([-0.100, -0.100, -0.100, 0.050, 0.050, 0.050]),\n            \"Ts_obs\": np.array([301.0, 301.0, 301.0, 299.0, 299.0, 299.0]),\n            \"Ts_sim\": np.array([302.0, 302.0, 302.0, 300.0, 300.0, 300.0]),\n        }\n    ]\n\n    def calc_wci(omega_eq):\n        \"\"\"Calculates the Walker Circulation Index (WCI).\"\"\"\n        omega_west = omega_eq[0:3]\n        omega_east = omega_eq[3:6]\n        ascent_term = np.mean(np.maximum(-omega_west, 0))\n        descent_term = np.mean(np.maximum(omega_east, 0))\n        return ascent_term - descent_term\n\n    def calc_delta_ts(ts_eq):\n        \"\"\"Calculates the zonal sea surface temperature contrast.\"\"\"\n        ts_west = ts_eq[0:3]\n        ts_east = ts_eq[3:6]\n        return np.mean(ts_west) - np.mean(ts_east)\n\n    results = []\n    for case in test_cases:\n        # 1. Compute WCI and Delta_Ts biases\n        wci_obs = calc_wci(case[\"omega_obs\"])\n        wci_sim = calc_wci(case[\"omega_sim\"])\n        wci_bias = wci_sim - wci_obs\n\n        dts_obs = calc_delta_ts(case[\"Ts_obs\"])\n        dts_sim = calc_delta_ts(case[\"Ts_sim\"])\n        dts_bias = dts_sim - dts_obs\n\n        # 2. Compute bias fields for attribution\n        b_T = case[\"Ts_sim\"] - case[\"Ts_obs\"]\n        b_omega_pred = -s * b_T\n        b_omega_real = case[\"omega_sim\"] - case[\"omega_obs\"]\n\n        # 3. Compute r and rho\n        std_pred = np.std(b_omega_pred)\n        std_real = np.std(b_omega_real)\n\n        # Pearson correlation r\n        if std_pred == 0 or std_real == 0:\n            r = 0.0\n        else:\n            # Using np.corrcoef is equivalent to the formula\n            r = np.corrcoef(b_omega_pred, b_omega_real)[0, 1]\n\n        # Amplitude ratio rho\n        if std_pred == 0:\n            rho = np.inf\n        else:\n            rho = std_real / std_pred\n\n        # 4. Determine attribution code\n        cond1 = r >= r_0\n        cond2 = rho_min = rho = rho_max\n        cond3 = np.sign(wci_bias) == np.sign(dts_bias)\n\n        if cond1 and cond2 and cond3:\n            attribution_code = 1\n        else:\n            attribution_code = 0\n            \n        results.append([\n            round(wci_bias, 3),\n            round(dts_bias, 3),\n            attribution_code\n        ])\n\n    # Format the final output string as a list of lists.\n    # Using f-strings within a list comprehension for precise formatting.\n    inner_results_str = [f\"[{w}, {d}, {c}]\" for w, d, c in results]\n    final_output_str = f\"[{','.join(inner_results_str)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}