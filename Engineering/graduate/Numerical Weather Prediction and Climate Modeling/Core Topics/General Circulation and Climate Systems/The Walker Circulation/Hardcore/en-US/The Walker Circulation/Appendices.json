{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the Walker circulation, we must first appreciate the physical processes that sustain it. A crucial element is the oceanic cold tongue in the eastern Pacific, maintained by the upwelling of cold water from the depths. This hands-on calculation  invites you to perform a \"back-of-the-envelope\" analysis to quantify the cooling effect of this upwelling and compare its magnitude to the heating from the sun and atmosphere, providing a visceral understanding of the ocean's role in driving this global atmospheric phenomenon.",
            "id": "4103999",
            "problem": "In the equatorial Pacific Walker circulation, surface easterlies drive oceanic upwelling in the eastern basin, cooling the mixed layer by vertical advection of colder subsurface water. Starting from the conservation of potential temperature for an incompressible, Boussinesq ocean, identify the local Eulerian temperature tendency contributed by vertical advection alone. Then, for an eastern equatorial Pacific mixed layer with an upward vertical velocity of $w$ and a vertical temperature gradient $\\partial_{z} T$ (with $z$ positive upward), evaluate the magnitude and sign of this tendency. Finally, quantify how this vertical-advection-induced cooling compares to a typical net surface heat flux by converting the cooling rate to an equivalent surface heat flux in a slab mixed-layer heat budget and forming a ratio.\n\nAssumptions and data:\n- Use the incompressible Boussinesq approximation, with $z$ positive upward and $w0$ denoting upwelling.\n- Neglect horizontal advection, turbulent and molecular diffusion, and internal sources/sinks except for a prescribed net surface heat flux that acts only through the mixed-layer heat budget.\n- Seawater density is $\\rho = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$ and specific heat capacity is $c_{p} = 3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$.\n- The mixed-layer depth is $H = 30\\ \\mathrm{m}$.\n- The upwelling velocity is $w = 2\\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$ and the vertical temperature gradient is $\\partial_{z} T = 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1}$.\n- To compare with surface forcing, take a representative magnitude of the net surface heat flux as $|Q_{\\mathrm{net}}| = 60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}$ (downward positive).\n\nTasks:\n1. From the temperature conservation equation under the stated assumptions, write the expression for the local temperature tendency due to vertical advection alone in terms of $w$ and $\\partial_{z} T$, including its sign convention.\n2. Using the provided $w$ and $\\partial_{z} T$, compute the numerical value of this tendency in $\\mathrm{K}\\ \\mathrm{s}^{-1}$.\n3. Convert this temperature tendency to an equivalent surface heat flux magnitude $F_{\\mathrm{eq}}$ in $\\mathrm{W}\\ \\mathrm{m}^{-2}$ that would produce the same mixed-layer temperature tendency in a slab model of depth $H$.\n4. Form the dimensionless ratio $R$ of the equivalent flux magnitude to the representative net surface heat flux magnitude, $R = |F_{\\mathrm{eq}}|/|Q_{\\mathrm{net}}|$, and report $R$ as a pure number.\n\nRound your final ratio $R$ to three significant figures. Express the final answer as a pure number with no units.",
            "solution": "The problem is validated as scientifically grounded, well-posed, objective, and self-contained. The provided data and assumptions are physically realistic for the context of equatorial oceanography. We can therefore proceed with the solution.\n\nThe problem asks for a quantitative comparison between cooling due to vertical advection and surface heat flux in the eastern equatorial Pacific mixed layer. We will address the four tasks sequentially.\n\n**Task 1: Expression for the Local Temperature Tendency due to Vertical Advection**\n\nWe begin with the conservation equation for temperature $T$ in an incompressible fluid. The Eulerian (local) time rate of change of temperature is given by:\n$$ \\frac{\\partial T}{\\partial t} = - \\mathbf{u} \\cdot \\nabla T + \\nabla \\cdot (\\kappa \\nabla T) + S $$\nwhere $\\mathbf{u}$ is the velocity vector, $\\nabla T$ is the temperature gradient, $\\kappa$ is the thermal diffusivity, and $S$ represents any internal sources or sinks of heat. In Cartesian coordinates $(x, y, z)$, this is:\n$$ \\frac{\\partial T}{\\partial t} = - \\left( u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} + w \\frac{\\partial T}{\\partial z} \\right) + \\text{diffusion} + \\text{sources/sinks} $$\nThe problem requires us to apply several simplifying assumptions:\n1.  Neglect horizontal advection: $u \\frac{\\partial T}{\\partial x} = 0$ and $v \\frac{\\partial T}{\\partial y} = 0$.\n2.  Neglect turbulent and molecular diffusion: The term $\\nabla \\cdot (\\kappa \\nabla T)$ is zero.\n3.  Neglect internal sources or sinks: $S = 0$.\n\nApplying these simplifications, the temperature conservation equation reduces to:\n$$ \\frac{\\partial T}{\\partial t} = - w \\frac{\\partial T}{\\partial z} $$\nThis equation states that the local time tendency of temperature is solely balanced by the vertical advection of temperature. The term on the right-hand side, $-w \\frac{\\partial T}{\\partial z}$, is the local temperature tendency contributed by vertical advection alone. The coordinate system specifies $z$ as positive upward, so an upward velocity (upwelling) corresponds to $w > 0$. The provided vertical temperature gradient, $\\partial_{z} T$, is positive, indicating that temperature increases with height $z$. Thus, upwelling transports colder water from below, leading to a negative temperature tendency (cooling), as expected.\n\nThe expression for the local temperature tendency due to vertical advection is $(\\frac{\\partial T}{\\partial t})_{\\text{v-adv}} = -w \\frac{\\partial T}{\\partial z}$.\n\n**Task 2: Numerical Value of the Temperature Tendency**\n\nWe are given the following values:\n- Upwelling velocity: $w = 2 \\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$\n- Vertical temperature gradient: $\\partial_{z} T = 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1}$\n\nSubstituting these values into the expression derived in Task 1:\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - \\left( 2 \\times 10^{-5}\\ \\mathrm{m}\\ \\mathrm{s}^{-1} \\right) \\left( 0.05\\ \\mathrm{K}\\ \\mathrm{m}^{-1} \\right) $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - (2 \\times 0.05) \\times 10^{-5}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = - 0.1 \\times 10^{-5}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\n$$ \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} = -1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1} $$\nThe numerical value of the temperature tendency is $-1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1}$. The negative sign confirms that vertical advection causes cooling.\n\n**Task 3: Equivalent Surface Heat Flux**\n\nWe now convert this temperature tendency into an equivalent surface heat flux, $F_{\\mathrm{eq}}$, for a slab mixed-layer model. For a column of seawater with horizontal area $A$ and depth $H$, the total heat content is $Q_{H} = m c_{p} T = (\\rho A H) c_{p} T$, where $\\rho$ is the density and $c_{p}$ is the specific heat capacity. The rate of change of heat content due to a surface heat flux $F$ (in $\\mathrm{W}\\ \\mathrm{m}^{-2}$) is $\\frac{dQ_{H}}{dt} = F A$. We can also express this rate of change in terms of the temperature tendency:\n$$ \\frac{dQ_{H}}{dt} = \\frac{d}{dt} (\\rho A H c_{p} T) = \\rho c_{p} A H \\frac{dT}{dt} $$\nEquating the two expressions and dividing by area $A$ gives the relationship between heat flux and temperature tendency:\n$$ F = \\rho c_{p} H \\frac{dT}{dt} $$\nWe use this formula to find the equivalent heat flux $F_{\\mathrm{eq}}$ that would produce the temperature tendency calculated in Task 2.\n$$ F_{\\mathrm{eq}} = \\rho c_{p} H \\left(\\frac{\\partial T}{\\partial t}\\right)_{\\text{v-adv}} $$\nWe are given the following constants:\n- Seawater density: $\\rho = 1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$\n- Specific heat capacity: $c_{p} = 3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}$\n- Mixed-layer depth: $H = 30\\ \\mathrm{m}$\n\nSubstituting these values along with the tendency from Task 2:\n$$ F_{\\mathrm{eq}} = (1025\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}) \\times (3985\\ \\mathrm{J}\\ \\mathrm{kg}^{-1}\\ \\mathrm{K}^{-1}) \\times (30\\ \\mathrm{m}) \\times (-1 \\times 10^{-6}\\ \\mathrm{K}\\ \\mathrm{s}^{-1}) $$\n$$ F_{\\mathrm{eq}} = (1025 \\times 3985 \\times 30) \\times (-1 \\times 10^{-6})\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n$$ F_{\\mathrm{eq}} = 122538750 \\times (-1 \\times 10^{-6})\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n$$ F_{\\mathrm{eq}} = -122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\nThe negative sign indicates a heat flux out of the ocean, consistent with cooling. The problem asks for the magnitude of this equivalent flux.\n$$ |F_{\\mathrm{eq}}| = 122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2} $$\n\n**Task 4: Dimensionless Ratio**\n\nFinally, we compute the dimensionless ratio $R$ of the magnitude of the equivalent advective heat flux to the magnitude of the representative net surface heat flux, $|Q_{\\mathrm{net}}| = 60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}$.\n$$ R = \\frac{|F_{\\mathrm{eq}}|}{|Q_{\\mathrm{net}}|} $$\n$$ R = \\frac{122.53875\\ \\mathrm{W}\\ \\mathrm{m}^{-2}}{60\\ \\mathrm{W}\\ \\mathrm{m}^{-2}} $$\n$$ R = 2.0423125 $$\nThe problem requires rounding the final answer to three significant figures.\n$$ R \\approx 2.04 $$\nThis result indicates that the cooling effect of vertical advection in this region is approximately twice as large in magnitude as the typical net heating from the surface. This highlights the dominant role of upwelling in maintaining the equatorial cold tongue.",
            "answer": "$$\\boxed{2.04}$$"
        },
        {
            "introduction": "While we can measure individual components like wind and vertical motion, visualizing the entire Walker circulation as a coherent overturning cell requires a more sophisticated tool. The zonal mass streamfunction, $\\Psi(x,p)$, is a powerful diagnostic that combines velocity data into a visual representation of mass flow. This coding exercise  will guide you through the process of numerically constructing this streamfunction from raw model data, a fundamental skill for analyzing circulation patterns in atmospheric and oceanic models.",
            "id": "4104032",
            "problem": "You are given gridded fields representing the zonal wind $u(x,p)$ and the vertical pressure velocity $\\omega(x,p)$ over an equatorial zonal channel relevant to the Walker circulation. Starting from the continuity equation in pressure coordinates and an appropriate streamfunction definition on a two-dimensional zonal-vertical $(x,p)$ plane, derive and implement a numerical method to diagnose the zonal mass streamfunction $\\Psi(x,p)$ and use it to identify ascending and descending branches of the Walker circulation together with their peak magnitudes.\n\nThe fundamental base is the continuity equation in pressure coordinates, which for horizontal wind components $u$ and $v$ and vertical pressure velocity $\\omega$ states\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial \\omega}{\\partial p} = 0.\n$$\nAssume a zonal-vertical two-dimensional slice averaged over a narrow latitude band such that $\\partial v/\\partial y \\approx 0$, and postulate the existence of a streamfunction $\\Psi(x,p)$ satisfying\n$$\nu = \\frac{\\partial \\Psi}{\\partial p}, \\quad \\omega = -\\frac{\\partial \\Psi}{\\partial x}.\n$$\nThese relations identically satisfy the continuity equation in the $(x,p)$ plane. Impose the physically motivated boundary condition $\\Psi(x,p_0)=0$ at the model top pressure $p_0$ to fix the gauge freedom. Your diagnostic algorithm must compute $\\Psi(x,p)$ by vertically integrating $u$ from $p_0$ to $p$, and then diagnose $\\omega$ from $\\Psi$ as $\\omega = -\\partial \\Psi/\\partial x$.\n\nUnits:\n- $u$ must be treated in meters per second ($\\mathrm{m\\,s^{-1}}$).\n- $\\omega$ must be treated in pascals per second ($\\mathrm{Pa\\,s^{-1}}$).\n- $p$ must be treated in pascals ($\\mathrm{Pa}$).\n- $x$ must be treated in meters ($\\mathrm{m}$).\nAngles are not used.\n\nYour program must:\n1. Implement the vertical integration for $\\Psi(x,p)$ using a second-order accurate trapezoidal rule along the $p$ dimension, anchoring $\\Psi(x,p_0)=0$.\n2. Compute the diagnosed vertical velocity $\\hat{\\omega}(x,p) = -\\partial \\Psi/\\partial x$ using centered finite differences in the interior and one-sided differences at the boundaries along $x$.\n3. Identify ascending (upward motion) and descending (downward motion) branches from $\\hat{\\omega}$ as regions where $\\hat{\\omega}  0$ (ascending) and $\\hat{\\omega}  0$ (descending).\n4. Compute the peak magnitudes of ascending and descending motion as positive floats:\n   - The ascending peak magnitude is $\\max\\{-\\hat{\\omega}(x,p)\\}$ over the domain, expressed in $\\mathrm{Pa\\,s^{-1}}$.\n   - The descending peak magnitude is $\\max\\{\\hat{\\omega}(x,p)\\}$ over the domain, expressed in $\\mathrm{Pa\\,s^{-1}}$.\n5. For informational coverage of data consistency, also compute the root-mean-square (RMS) mismatch $\\Delta_{\\mathrm{rms}}$ between the provided $\\omega$ and the diagnosed $\\hat{\\omega}$:\n$$\n\\Delta_{\\mathrm{rms}} = \\left( \\frac{1}{N_x N_p} \\sum_{i=1}^{N_x} \\sum_{j=1}^{N_p} \\left[ \\omega(x_i,p_j) - \\hat{\\omega}(x_i,p_j) \\right]^2 \\right)^{1/2},\n$$\nexpressed in $\\mathrm{Pa\\,s^{-1}}$.\n\nTest Suite:\nImplement the method for the following three scientifically plausible and self-consistent test cases. In all cases, use uniform grids in $x$ and $p$, the trapezoidal rule for the $p$-integration, and second-order finite differences in $x$.\n\n- Case A (Canonical single-cell Walker circulation consistent with continuity):\n  - Domain and grid: $N_x = 64$, $N_p = 30$, $L = 1.6\\times 10^7\\,\\mathrm{m}$, $p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$, $p_1 = 1.0\\times 10^5\\,\\mathrm{Pa}$.\n  - Coordinates: $x_i$ linearly spaced from $0$ to $L$, $p_j$ linearly spaced from $p_0$ to $p_1$.\n  - True streamfunction: $\\Psi^{\\mathrm{true}}(x,p) = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0)$ with $A = 0.05\\,\\mathrm{m\\,s^{-1}}$.\n  - Data: $u(x,p) = \\frac{\\partial \\Psi^{\\mathrm{true}}}{\\partial p} = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right)$; $\\omega(x,p) = -\\frac{\\partial \\Psi^{\\mathrm{true}}}{\\partial x} = -A \\frac{2\\pi}{L} \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0)$.\n\n- Case B (No circulation: uniform zonal wind and zero vertical motion, consistent with continuity):\n  - Domain and grid: $N_x = 32$, $N_p = 20$, $L = 1.0\\times 10^7\\,\\mathrm{m}$, $p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$, $p_1 = 1.0\\times 10^5\\,\\mathrm{Pa}$.\n  - Data: $u(x,p) = U_0$ with $U_0 = 10\\,\\mathrm{m\\,s^{-1}}$; $\\omega(x,p) = 0\\,\\mathrm{Pa\\,s^{-1}}$.\n\n- Case C (Inconsistent fields with weak zonal and vertical variability):\n  - Domain and grid: $N_x = 48$, $N_p = 24$, $L = 1.2\\times 10^7\\,\\mathrm{m}$, $p_0 = 1.0\\times 10^4\\,\\mathrm{Pa}$, $p_1 = 9.0\\times 10^4\\,\\mathrm{Pa}$.\n  - Coordinates: $x_i$ linearly spaced from $0$ to $L$, $p_j$ linearly spaced from $p_0$ to $p_1$.\n  - Zonal wind: $u(x,p) = A \\sin\\!\\left(\\frac{2\\pi x}{L}\\right) + B \\cos\\!\\left(\\pi \\frac{p - p_0}{p_1 - p_0}\\right)$ with $A = 0.03\\,\\mathrm{m\\,s^{-1}}$, $B = 2.0\\times 10^{-3}\\,\\mathrm{m\\,s^{-1}}$.\n  - Vertical velocity: $\\omega(x,p) = -A \\frac{2\\pi}{L} \\cos\\!\\left(\\frac{2\\pi x}{L}\\right)\\,(p - p_0) + \\delta \\sin\\!\\left(\\frac{4\\pi x}{L}\\right) + \\eta \\sin\\!\\left(3\\pi \\frac{p - p_0}{p_1 - p_0}\\right)$ with $\\delta = 5.0\\times 10^{-4}\\,\\mathrm{Pa\\,s^{-1}}$ and $\\eta = 3.0\\times 10^{-4}\\,\\mathrm{Pa\\,s^{-1}}$.\n\nAnswer specification:\n- For each test case, compute and return a list of three floats $[\\text{up\\_peak}, \\text{down\\_peak}, \\Delta_{\\mathrm{rms}}]$, where $\\text{up\\_peak}$ and $\\text{down\\_peak}$ are the ascending and descending peak magnitudes expressed in $\\mathrm{Pa\\,s^{-1}}$, and $\\Delta_{\\mathrm{rms}}$ is the mismatch in $\\mathrm{Pa\\,s^{-1}}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one list per test case, in the exact format:\n$$\n[\\,[\\text{up}_A,\\text{down}_A,\\Delta_A],\\,[\\text{up}_B,\\text{down}_B,\\Delta_B],\\,[\\text{up}_C,\\text{down}_C,\\Delta_C]\\,]\n$$\nAll values should be standard decimal floats. Express all magnitudes in $\\mathrm{Pa\\,s^{-1}}$.",
            "solution": "We begin from the pressure-coordinate continuity equation,\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial \\omega}{\\partial p} = 0,\n$$\nwhich holds under hydrostatic balance and the standard transformation from height to pressure as the vertical coordinate in atmospheric dynamics. For a zonal-vertical $(x,p)$ slice averaged over a narrow latitude band where $\\partial v/\\partial y \\approx 0$, the equation reduces to\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial \\omega}{\\partial p} = 0.\n$$\nA classical way to identically satisfy this reduced continuity equation is to introduce a streamfunction $\\Psi(x,p)$ such that\n$$\nu = \\frac{\\partial \\Psi}{\\partial p}, \\qquad \\omega = -\\frac{\\partial \\Psi}{\\partial x}.\n$$\nIndeed,\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial \\omega}{\\partial p} = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\Psi}{\\partial p}\\right) + \\frac{\\partial}{\\partial p}\\left(-\\frac{\\partial \\Psi}{\\partial x}\\right) = \\frac{\\partial^2 \\Psi}{\\partial x \\,\\partial p} - \\frac{\\partial^2 \\Psi}{\\partial p \\,\\partial x} = 0,\n$$\nby the equality of mixed partial derivatives under sufficient smoothness. The streamfunction is determined up to an additive constant; physically, we fix this gauge by imposing the boundary condition\n$$\n\\Psi(x,p_0) = 0,\n$$\nwhere $p_0$ is the top pressure (lowest value of pressure in the domain). This choice is natural: it ensures that the mass transport is measured relative to the top boundary.\n\nGiven discrete data $u(x_i,p_j)$ on uniform grids $x_i$ and $p_j$, we can determine $\\Psi$ by vertical integration of $u$ from $p_0$:\n$$\n\\Psi(x_i,p_j) = \\int_{p_0}^{p_j} u(x_i,p') \\,\\mathrm{d}p'.\n$$\nNumerically, this integral is approximated with a second-order accurate trapezoidal rule along the pressure dimension. Defining grid spacings $\\Delta x$ and $\\Delta p_j = p_j - p_{j-1}$, we set\n$$\n\\Psi(x_i,p_0) = 0, \\quad \\Psi(x_i,p_j) = \\Psi(x_i,p_{j-1}) + \\frac{1}{2}\\left[ u(x_i,p_{j-1}) + u(x_i,p_j) \\right]\\,(p_j - p_{j-1}).\n$$\nOnce $\\Psi$ is known, the vertical velocity is diagnosed from $\\Psi$ as\n$$\n\\hat{\\omega}(x_i,p_j) = -\\frac{\\partial \\Psi}{\\partial x}\\bigg|_{(x_i,p_j)}.\n$$\nOn a uniform grid, we approximate this derivative with second-order centered differences in the interior,\n$$\n\\hat{\\omega}(x_i,p_j) \\approx -\\frac{\\Psi(x_{i+1},p_j) - \\Psi(x_{i-1},p_j)}{2\\,\\Delta x},\n$$\nand one-sided first-order differences at the boundaries,\n$$\n\\hat{\\omega}(x_0,p_j) \\approx -\\frac{\\Psi(x_1,p_j) - \\Psi(x_0,p_j)}{\\Delta x}, \\quad \\hat{\\omega}(x_{N_x-1},p_j) \\approx -\\frac{\\Psi(x_{N_x-1},p_j) - \\Psi(x_{N_x-2},p_j)}{\\Delta x}.\n$$\n\nAscending and descending branches are defined by the sign of $\\hat{\\omega}$. In pressure coordinates, negative $\\omega$ indicates upward motion (ascending), while positive $\\omega$ indicates downward motion (descending). The peak magnitudes are computed as\n$$\n\\text{up\\_peak} = \\max_{i,j} \\left( -\\hat{\\omega}(x_i,p_j) \\right) \\quad \\text{with } \\hat{\\omega}(x_i,p_j)  0,\n$$\n$$\n\\text{down\\_peak} = \\max_{i,j} \\left( \\hat{\\omega}(x_i,p_j) \\right) \\quad \\text{with } \\hat{\\omega}(x_i,p_j)  0.\n$$\nIf no ascending (or descending) points exist, the corresponding peak is set to zero.\n\nTo assess consistency with the provided $\\omega$, we compute the root-mean-square mismatch\n$$\n\\Delta_{\\mathrm{rms}} = \\left( \\frac{1}{N_x N_p} \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_p-1} \\left[ \\omega(x_i,p_j) - \\hat{\\omega}(x_i,p_j) \\right]^2 \\right)^{1/2}.\n$$\n\nAlgorithmic design:\n- Inputs: grids $x_i$ (uniform in meters), $p_j$ (uniform in pascals), and data arrays $u(x_i,p_j)$ and $\\omega(x_i,p_j)$ in units $\\mathrm{m\\,s^{-1}}$ and $\\mathrm{Pa\\,s^{-1}}$ respectively.\n- Step 1: Initialize $\\Psi(x_i,p_0) = 0$ for all $i$.\n- Step 2: For each $i$, integrate along $p$ using the trapezoidal rule to obtain $\\Psi(x_i,p_j)$ for $j=1,\\dots,N_p-1$.\n- Step 3: Differentiate $\\Psi$ along $x$ to get $\\hat{\\omega}(x_i,p_j)$ using centered differences inside the domain and one-sided differences at boundaries.\n- Step 4: Compute $\\text{up\\_peak}$ and $\\text{down\\_peak}$ from $\\hat{\\omega}$.\n- Step 5: Compute $\\Delta_{\\mathrm{rms}}$ against the provided $\\omega$.\n- Outputs: For each test case, return the list $[\\text{up\\_peak}, \\text{down\\_peak}, \\Delta_{\\mathrm{rms}}]$ with magnitudes in $\\mathrm{Pa\\,s^{-1}}$.\n\nFor the test suite, Case Aâ€™s data are constructed from a known analytical streamfunction $\\Psi^{\\mathrm{true}}$ so that the diagnosed $\\hat{\\omega}$ closely reproduces the provided $\\omega$, yielding small $\\Delta_{\\mathrm{rms}}$. Case B has no zonal variation so $\\Psi$ is independent of $x$ and $\\hat{\\omega} \\equiv 0$, giving zero peaks and zero mismatch. Case C includes additional zonal and vertical structures in $u$ and $\\omega$ that break perfect consistency; the diagnosed $\\hat{\\omega}$ will not match the provided $\\omega$ exactly, and $\\Delta_{\\mathrm{rms}}$ will be nonzero, while the peaks reflect the dominant overturning driven by the $x$-dependent part of $u$.\n\nThis approach is grounded in the fundamental continuity equation and leverages the streamfunction to enforce mass conservation in the $(x,p)$ plane. The numerical choices (trapezoidal integration and second-order differences) provide adequate accuracy and stability on uniform grids and are widely used in numerical weather prediction and climate modeling practice.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef integrate_streamfunction_trapezoid(u, p):\n    \"\"\"\n    Compute Psi(x,p) from u(x,p) by vertical integration using the trapezoidal rule.\n    Psi(x, p_top) is set to 0 for all x.\n    u: array shape (Nx, Np), units m/s\n    p: array shape (Np,), units Pa\n    Returns Psi with shape (Nx, Np), units Pa*m/s\n    \"\"\"\n    Nx, Np = u.shape\n    Psi = np.zeros((Nx, Np), dtype=float)\n    # Integrate along p for each x\n    for i in range(Nx):\n        # Psi[i,0] = 0 by boundary condition\n        for j in range(1, Np):\n            dp = p[j] - p[j-1]\n            Psi[i, j] = Psi[i, j-1] + 0.5 * (u[i, j-1] + u[i, j]) * dp\n    return Psi\n\ndef diagnose_omega_from_psi(Psi, x):\n    \"\"\"\n    Compute omega_hat(x,p) = -dPsi/dx using finite differences.\n    Psi: array shape (Nx, Np), units Pa*m/s\n    x: array shape (Nx,), units m\n    Returns omega_hat with shape (Nx, Np), units Pa/s\n    \"\"\"\n    Nx, Np = Psi.shape\n    omega_hat = np.zeros_like(Psi)\n    dx = x[1] - x[0]\n    # Boundaries: one-sided differences\n    omega_hat[0, :] = -(Psi[1, :] - Psi[0, :]) / dx\n    omega_hat[-1, :] = -(Psi[-1, :] - Psi[-2, :]) / dx\n    # Interior: centered differences\n    for i in range(1, Nx-1):\n        omega_hat[i, :] = -(Psi[i+1, :] - Psi[i-1, :]) / (2.0 * dx)\n    return omega_hat\n\ndef compute_peaks(omega_hat):\n    \"\"\"\n    Compute ascending and descending peak magnitudes from omega_hat.\n    Ascending: omega_hat  0, peak is max(-omega_hat).\n    Descending: omega_hat  0, peak is max(omega_hat).\n    Returns (up_peak, down_peak) as floats in Pa/s.\n    \"\"\"\n    # Ascending peak\n    neg_mask = omega_hat  0.0\n    if np.any(neg_mask):\n        up_peak = float(np.max(-omega_hat[neg_mask]))\n    else:\n        up_peak = 0.0\n    # Descending peak\n    pos_mask = omega_hat  0.0\n    if np.any(pos_mask):\n        down_peak = float(np.max(omega_hat[pos_mask]))\n    else:\n        down_peak = 0.0\n    return up_peak, down_peak\n\ndef rms_mismatch(omega, omega_hat):\n    \"\"\"\n    Compute RMS mismatch between provided omega and diagnosed omega_hat.\n    Both arrays shape (Nx, Np), units Pa/s.\n    \"\"\"\n    diff = omega - omega_hat\n    return float(np.sqrt(np.mean(diff**2)))\n\ndef case_A():\n    # Canonical single-cell Walker circulation\n    Nx = 64\n    Np = 30\n    L = 1.6e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 1.0e5  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n    A = 0.05  # m/s\n\n    # Construct u and omega from true streamfunction\n    # u(x,p) = A * sin(2pi x / L)\n    u = (A * np.sin(2.0 * np.pi * x / L))[:, None] * np.ones((1, Np))\n    # omega(x,p) = -A * (2pi/L) * cos(2pi x / L) * (p - p_top)\n    omega = (-A * (2.0 * np.pi / L) * np.cos(2.0 * np.pi * x / L))[:, None] * (p - p_top)[None, :]\n\n    # Diagnose\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef case_B():\n    # No circulation: constant u, zero omega\n    Nx = 32\n    Np = 20\n    L = 1.0e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 1.0e5  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n    U0 = 10.0  # m/s\n    u = U0 * np.ones((Nx, Np))\n    omega = np.zeros((Nx, Np))\n\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef case_C():\n    # Inconsistent fields with weak zonal and vertical variability\n    Nx = 48\n    Np = 24\n    L = 1.2e7  # m\n    p_top = 1.0e4  # Pa\n    p_bot = 9.0e4  # Pa\n    x = np.linspace(0.0, L, Nx)\n    p = np.linspace(p_top, p_bot, Np)\n\n    A = 0.03  # m/s\n    B = 2.0e-3  # m/s\n    delta = 5.0e-4  # Pa/s\n    eta = 3.0e-4  # Pa/s\n\n    # u(x,p) = A sin(2pi x/L) + B cos(pi (p-p0)/(p1-p0))\n    u = (A * np.sin(2.0 * np.pi * x / L))[:, None] * np.ones((1, Np)) + \\\n        B * np.cos(np.pi * (p - p_top) / (p_bot - p_top))[None, :]\n\n    # omega(x,p) = -A * (2pi/L) * cos(2pi x/L) * (p - p0) + delta sin(4pi x/L) + eta sin(3pi (p-p0)/(p1-p0))\n    omega = (-A * (2.0 * np.pi / L) * np.cos(2.0 * np.pi * x / L))[:, None] * (p - p_top)[None, :] + \\\n            (delta * np.sin(4.0 * np.pi * x / L))[:, None] * np.ones((1, Np)) + \\\n            eta * np.sin(3.0 * np.pi * (p - p_top) / (p_bot - p_top))[None, :]\n\n    Psi = integrate_streamfunction_trapezoid(u, p)\n    omega_hat = diagnose_omega_from_psi(Psi, x)\n    up_peak, down_peak = compute_peaks(omega_hat)\n    delta_rms = rms_mismatch(omega, omega_hat)\n    return [up_peak, down_peak, delta_rms]\n\ndef solve():\n    test_cases_results = []\n    test_cases_results.append(case_A())\n    test_cases_results.append(case_B())\n    test_cases_results.append(case_C())\n    # Final print statement in the exact required format.\n    # Single line: list of lists, each [up_peak, down_peak, delta_rms]\n    print(f\"[{','.join(map(str, test_cases_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Climate models are our primary tools for understanding and predicting the Earth's climate, but they are not perfect. A common task for climate scientists is to diagnose why a model's simulation of a phenomenon like the Walker circulation differs from observations. This practice  provides a hands-on framework for model evaluation, challenging you to use diagnostic indices and statistical analysis to attribute errors in a simulated Walker circulation to either incorrect ocean temperatures or flaws in the atmospheric model's physics, a process central to modern climate model development.",
            "id": "4104031",
            "problem": "You are given simulated and observed fields on a small two-dimensional grid representing an idealized equatorial Pacific cross section used to diagnose the Walker circulation. Starting from fundamental laws, consider that hydrostatic balance ($\\partial p / \\partial z = - \\rho g$), mass continuity ($\\nabla \\cdot \\vec{v} + \\partial \\omega / \\partial p = 0$), and convective quasi-equilibrium (where diabatic heating adjusts rapidly to maintain near-neutral stability) imply that vertical pressure velocity $\\omega$ (in $\\mathrm{Pa\\,s^{-1}}$) responds to thermal forcing and horizontal convergence driven by sea surface temperature $T_s$ (in $\\mathrm{K}$) gradients. Use these principles to define a diagnostically consistent index for the Walker circulation and an attribution framework for errors.\n\nDefinitions:\n- Let the grid have shape $N_\\phi \\times N_\\lambda$ with $N_\\phi = 3$ latitudinal rows and $N_\\lambda = 6$ longitudinal columns. The equatorial band is the row with index $1$. The western Pacific region is the set of columns $\\{0,1,2\\}$, and the eastern Pacific region is the set of columns $\\{3,4,5\\}$.\n- The Walker Circulation Index (WCI) is defined as\n$$\n\\mathrm{WCI} = \\overline{\\max(-\\omega,0)}_{\\text{west, eq}} - \\overline{\\max(\\omega,0)}_{\\text{east, eq}},\n$$\nwhere $\\overline{\\cdot}_{\\text{west, eq}}$ and $\\overline{\\cdot}_{\\text{east, eq}}$ denote the arithmetic mean over the specified region within the equatorial band. The unit of $\\mathrm{WCI}$ is $\\mathrm{Pa\\,s^{-1}}$.\n- The zonal sea surface temperature contrast is defined as\n$$\n\\Delta T_s = \\overline{T_s}_{\\text{west, eq}} - \\overline{T_s}_{\\text{east, eq}},\n$$\nwith unit $\\mathrm{K}$.\n\nError attribution framework:\n- Let $s$ be a sensitivity converting sea surface temperature bias to vertical motion bias under convective quasi-equilibrium, taken as the physically plausible constant $s = 0.02$ $\\mathrm{Pa\\,s^{-1}\\,K^{-1}}$.\n- Define the equatorial sea surface temperature bias field\n$$\nb_T(i) = T_{s,\\text{sim}}(i) - T_{s,\\text{obs}}(i),\n$$\nfor each equatorial grid point $i$, and the predicted vertical motion bias field\n$$\nb_\\omega^{\\text{pred}}(i) = - s \\, b_T(i),\n$$\nreflecting that warmer sea surface temperature tends to promote ascent (more negative $\\omega$).\n- Define the realized vertical motion error field at equatorial grid points\n$$\nb_\\omega^{\\text{real}}(i) = \\omega_{\\text{sim}}(i) - \\omega_{\\text{obs}}(i).\n$$\n- Compute the Pearson correlation coefficient between $b_\\omega^{\\text{pred}}$ and $b_\\omega^{\\text{real}}$,\n$$\nr = \\frac{\\sum_i \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)\\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)}{\\sqrt{\\sum_i \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)^2}\\sqrt{\\sum_i \\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)^2}},\n$$\nwith the convention that if either standard deviation in the denominator is zero, set $r = 0$.\n- Compute the amplitude ratio\n$$\n\\rho = \\frac{\\sigma\\left(b_\\omega^{\\text{real}}\\right)}{\\sigma\\left(b_\\omega^{\\text{pred}}\\right)},\n$$\nwhere $\\sigma(\\cdot)$ denotes the population standard deviation, and if $\\sigma\\left(b_\\omega^{\\text{pred}}\\right) = 0$ define $\\rho = +\\infty$.\n- Let the classification thresholds be $r_0 = 0.6$ and amplitude bounds $[\\rho_{\\min}, \\rho_{\\max}] = [0.5, 2.0]$.\n- Attribute the error to mean-state sea surface temperature bias if and only if all the following hold: $r \\ge r_0$, $\\rho_{\\min} \\le \\rho \\le \\rho_{\\max}$, and $\\operatorname{sign}\\left(\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}\\right) = \\operatorname{sign}\\left(\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}\\right)$. Otherwise, attribute the error to parameterization. Use the integer code $1$ for mean-state sea surface temperature bias and $0$ for parameterization.\n\nYour program must, for each test case, compute:\n- The $\\mathrm{WCI}$ bias $\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}$ expressed in $\\mathrm{Pa\\,s^{-1}}$, rounded to three decimal places.\n- The $\\Delta T_s$ bias $\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}$ expressed in $\\mathrm{K}$, rounded to three decimal places.\n- The attribution code as an integer.\n\nTest suite (each case provides $(\\omega_{\\text{obs}}, \\omega_{\\text{sim}}, T_{s,\\text{obs}}, T_{s,\\text{sim}})$ on a $3 \\times 6$ grid; values outside the equatorial band may be taken as $0$ and are not used in diagnostics):\n1. Case A (general consistency with sea surface temperature bias):\n   - Equatorial $\\omega_{\\text{obs}}$ west: $[-0.060, -0.050, -0.040]$, east: $[0.030, 0.020, 0.020]$.\n   - Equatorial $\\omega_{\\text{sim}}$ west: $[-0.040, -0.030, -0.030]$, east: $[0.020, 0.015, 0.015]$.\n   - Equatorial $T_{s,\\text{obs}}$ west: $[302.0, 302.0, 301.5]$, east: $[299.0, 299.5, 299.0]$.\n   - Equatorial $T_{s,\\text{sim}}$ west: $[301.0, 301.0, 300.5]$, east: $[300.0, 300.0, 300.0]$.\n2. Case B (no sea surface temperature bias but vertical motion error, indicative of parameterization issues):\n   - Equatorial $\\omega_{\\text{obs}}$ west: $[-0.050, -0.050, -0.050]$, east: $[0.020, 0.020, 0.020]$.\n   - Equatorial $\\omega_{\\text{sim}}$ west: $[-0.080, -0.080, -0.080]$, east: $[0.040, 0.040, 0.040]$.\n   - Equatorial $T_{s,\\text{obs}}$ west: $[301.5, 301.5, 301.5]$, east: $[299.5, 299.5, 299.5]$.\n   - Equatorial $T_{s,\\text{sim}}$ west: $[301.5, 301.5, 301.5]$, east: $[299.5, 299.5, 299.5]$.\n3. Case C (uniform sea surface temperature offset preserving gradient but overly strong vertical response, indicative of parameterization issues):\n   - Equatorial $\\omega_{\\text{obs}}$ west: $[-0.050, -0.050, -0.050]$, east: $[0.025, 0.025, 0.025]$.\n   - Equatorial $\\omega_{\\text{sim}}$ west: $[-0.100, -0.100, -0.100]$, east: $[0.050, 0.050, 0.050]$.\n   - Equatorial $T_{s,\\text{obs}}$ west: $[301.0, 301.0, 301.0]$, east: $[299.0, 299.0, 299.0]$.\n   - Equatorial $T_{s,\\text{sim}}$ west: $[302.0, 302.0, 302.0]$, east: $[300.0, 300.0, 300.0]$.\n\nFinal output format:\nYour program should produce a single line of output containing the results for the three cases as a comma-separated list of lists enclosed in square brackets, where each inner list contains the three values $[\\mathrm{WCI\\_bias}, \\Delta T_{s,\\text{bias}}, \\text{code}]$. For example, output in the format\n$$\n[\\,[w_1, d_1, c_1],\\,[w_2, d_2, c_2],\\,[w_3, d_3, c_3]\\,],\n$$\nwith $w_i$ and $d_i$ rounded to three decimal places, $w_i$ in $\\mathrm{Pa\\,s^{-1}}$ and $d_i$ in $\\mathrm{K}$, and $c_i$ an integer.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of tropical atmospheric dynamics, well-posed with all necessary definitions and data, and objective in its formulation. The task is to implement a diagnostic and error attribution framework for the Walker circulation based on a set of clearly defined mathematical and logical rules.\n\nThe solution proceeds by systematically applying the provided definitions to each test case. For each case, characterized by observed and simulated fields $(\\omega_{\\text{obs}}, \\omega_{\\text{sim}}, T_{s,\\text{obs}}, T_{s,\\text{sim}})$, we will compute the Walker Circulation Index (WCI) bias, the zonal sea surface temperature contrast ($\\Delta T_s$) bias, and an attribution code.\n\nFirst, we define functions to calculate the WCI and $\\Delta T_s$ for any given equatorial field. The grid consists of $N_\\lambda=6$ longitudinal points, with the western region comprising indices $\\{0, 1, 2\\}$ and the eastern region indices $\\{3, 4, 5\\}$.\n\nThe Walker Circulation Index, $\\mathrm{WCI}$, is defined as:\n$$\n\\mathrm{WCI} = \\overline{\\max(-\\omega,0)}_{\\text{west, eq}} - \\overline{\\max(\\omega,0)}_{\\text{east, eq}}\n$$\nThis index quantifies the strength of the circulation. The term $\\overline{\\max(-\\omega,0)}_{\\text{west, eq}}$ captures the mean ascent (by convention, $\\omega  0$) in the western region, as $\\max(-\\omega, 0)$ is positive for negative $\\omega$ and zero otherwise. The term $\\overline{\\max(\\omega,0)}_{\\text{east, eq}}$ captures the mean descent ($\\omega  0$) in the eastern region. The calculation for a given equatorial field $\\omega$ is:\n$$\n\\mathrm{WCI}(\\omega) = \\frac{1}{3} \\sum_{i=0}^{2} \\max(-\\omega(i), 0) - \\frac{1}{3} \\sum_{i=3}^{5} \\max(\\omega(i), 0)\n$$\nWe compute this for both $\\omega_{\\text{obs}}$ and $\\omega_{\\text{sim}}$ to find $\\mathrm{WCI}_{\\text{obs}}$ and $\\mathrm{WCI}_{\\text{sim}}$. The WCI bias is then $\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}$.\n\nThe zonal sea surface temperature contrast, $\\Delta T_s$, is defined as:\n$$\n\\Delta T_s = \\overline{T_s}_{\\text{west, eq}} - \\overline{T_s}_{\\text{east, eq}}\n$$\nThis represents the temperature gradient driving the circulation. The calculation for a given field $T_s$ is:\n$$\n\\Delta T_s(T_s) = \\left(\\frac{1}{3} \\sum_{i=0}^{2} T_s(i)\\right) - \\left(\\frac{1}{3} \\sum_{i=3}^{5} T_s(i)\\right)\n$$\nWe compute this for both $T_{s,\\text{obs}}$ and $T_{s,\\text{sim}}$ to find $\\Delta T_{s,\\text{obs}}$ and $\\Delta T_{s,\\text{sim}}$. The $\\Delta T_s$ bias is $\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}}$.\n\nSecond, we implement the error attribution framework. This requires calculating three intermediate fields at the $N_\\lambda=6$ equatorial grid points:\n1.  The sea surface temperature bias field: $b_T(i) = T_{s,\\text{sim}}(i) - T_{s,\\text{obs}}(i)$\n2.  The predicted vertical motion bias field, based on a linear response to SST bias with sensitivity $s=0.02\\,\\mathrm{Pa\\,s^{-1}\\,K^{-1}}$: $b_\\omega^{\\text{pred}}(i) = - s \\, b_T(i)$\n3.  The realized (actual) vertical motion error field: $b_\\omega^{\\text{real}}(i) = \\omega_{\\text{sim}}(i) - \\omega_{\\text{obs}}(i)$\n\nWith these fields, we compute two diagnostic statistics:\n- The Pearson correlation coefficient, $r$, between the predicted bias $b_\\omega^{\\text{pred}}$ and the realized bias $b_\\omega^{\\text{real}}$. If the standard deviation of either field is zero, $r$ is defined as $0$. The formula is:\n$$\nr = \\frac{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)\\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)}{\\sqrt{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{pred}}(i) - \\overline{b_\\omega^{\\text{pred}}}\\right)^2}\\sqrt{\\sum_{i=0}^{5} \\left(b_\\omega^{\\text{real}}(i) - \\overline{b_\\omega^{\\text{real}}}\\right)^2}}\n$$\n- The amplitude ratio, $\\rho$, defined as the ratio of the population standard deviations of the two fields. If the standard deviation of the predicted bias is zero, $\\rho$ is defined as $+\\infty$.\n$$\n\\rho = \\frac{\\sigma\\left(b_\\omega^{\\text{real}}\\right)}{\\sigma\\left(b_\\omega^{\\text{pred}}\\right)}\n$$\n\nFinally, we determine the attribution code. The error is attributed to mean-state SST bias (code $1$) if and only if all of the following three conditions are met:\n1.  The correlation is sufficiently high: $r \\ge r_0$, where $r_0 = 0.6$.\n2.  The amplitude of the realized error is comparable to the predicted error: $\\rho_{\\min} \\le \\rho \\le \\rho_{\\max}$, where $[\\rho_{\\min}, \\rho_{\\max}] = [0.5, 2.0]$.\n3.  The sign of the WCI bias is consistent with the sign of the $\\Delta T_s$ bias: $\\operatorname{sign}(\\mathrm{WCI}_{\\text{sim}} - \\mathrm{WCI}_{\\text{obs}}) = \\operatorname{sign}(\\Delta T_{s,\\text{sim}} - \\Delta T_{s,\\text{obs}})$. We use the standard sign function where $\\operatorname{sign}(0)=0$.\n\nIf all three conditions are true, the attribution code is $1$; otherwise, it is $0$.\n\nThe program will execute this entire procedure for each of the three test cases provided, rounding the final bias values to three decimal places and assembling the results into the specified list-of-lists format.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Walker circulation error attribution problem for the given test cases.\n    \"\"\"\n    \n    # Define constants and thresholds from the problem statement.\n    s = 0.02  # Pa s^-1 K^-1\n    r_0 = 0.6\n    rho_min, rho_max = 0.5, 2.0\n\n    # Test suite data\n    test_cases = [\n        # Case A\n        {\n            \"omega_obs\": np.array([-0.060, -0.050, -0.040, 0.030, 0.020, 0.020]),\n            \"omega_sim\": np.array([-0.040, -0.030, -0.030, 0.020, 0.015, 0.015]),\n            \"Ts_obs\": np.array([302.0, 302.0, 301.5, 299.0, 299.5, 299.0]),\n            \"Ts_sim\": np.array([301.0, 301.0, 300.5, 300.0, 300.0, 300.0]),\n        },\n        # Case B\n        {\n            \"omega_obs\": np.array([-0.050, -0.050, -0.050, 0.020, 0.020, 0.020]),\n            \"omega_sim\": np.array([-0.080, -0.080, -0.080, 0.040, 0.040, 0.040]),\n            \"Ts_obs\": np.array([301.5, 301.5, 301.5, 299.5, 299.5, 299.5]),\n            \"Ts_sim\": np.array([301.5, 301.5, 301.5, 299.5, 299.5, 299.5]),\n        },\n        # Case C\n        {\n            \"omega_obs\": np.array([-0.050, -0.050, -0.050, 0.025, 0.025, 0.025]),\n            \"omega_sim\": np.array([-0.100, -0.100, -0.100, 0.050, 0.050, 0.050]),\n            \"Ts_obs\": np.array([301.0, 301.0, 301.0, 299.0, 299.0, 299.0]),\n            \"Ts_sim\": np.array([302.0, 302.0, 302.0, 300.0, 300.0, 300.0]),\n        }\n    ]\n\n    def calc_wci(omega_eq):\n        \"\"\"Calculates the Walker Circulation Index (WCI).\"\"\"\n        omega_west = omega_eq[0:3]\n        omega_east = omega_eq[3:6]\n        ascent_term = np.mean(np.maximum(-omega_west, 0))\n        descent_term = np.mean(np.maximum(omega_east, 0))\n        return ascent_term - descent_term\n\n    def calc_delta_ts(ts_eq):\n        \"\"\"Calculates the zonal sea surface temperature contrast.\"\"\"\n        ts_west = ts_eq[0:3]\n        ts_east = ts_eq[3:6]\n        return np.mean(ts_west) - np.mean(ts_east)\n\n    results = []\n    for case in test_cases:\n        # 1. Compute WCI and Delta_Ts biases\n        wci_obs = calc_wci(case[\"omega_obs\"])\n        wci_sim = calc_wci(case[\"omega_sim\"])\n        wci_bias = wci_sim - wci_obs\n\n        dts_obs = calc_delta_ts(case[\"Ts_obs\"])\n        dts_sim = calc_delta_ts(case[\"Ts_sim\"])\n        dts_bias = dts_sim - dts_obs\n\n        # 2. Compute bias fields for attribution\n        b_T = case[\"Ts_sim\"] - case[\"Ts_obs\"]\n        b_omega_pred = -s * b_T\n        b_omega_real = case[\"omega_sim\"] - case[\"omega_obs\"]\n\n        # 3. Compute r and rho\n        std_pred = np.std(b_omega_pred)\n        std_real = np.std(b_omega_real)\n\n        # Pearson correlation r\n        if std_pred == 0 or std_real == 0:\n            r = 0.0\n        else:\n            # Using np.corrcoef is equivalent to the formula\n            r = np.corrcoef(b_omega_pred, b_omega_real)[0, 1]\n\n        # Amplitude ratio rho\n        if std_pred == 0:\n            rho = np.inf\n        else:\n            rho = std_real / std_pred\n\n        # 4. Determine attribution code\n        cond1 = r = r_0\n        cond2 = rho_min = rho = rho_max\n        cond3 = np.sign(wci_bias) == np.sign(dts_bias)\n\n        if cond1 and cond2 and cond3:\n            attribution_code = 1\n        else:\n            attribution_code = 0\n            \n        results.append([\n            round(wci_bias, 3),\n            round(dts_bias, 3),\n            attribution_code\n        ])\n\n    # Format the final output string as a list of lists.\n    # Using f-strings within a list comprehension for precise formatting.\n    inner_results_str = [f\"[{w}, {d}, {c}]\" for w, d, c in results]\n    final_output_str = f\"[{','.join(inner_results_str)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}