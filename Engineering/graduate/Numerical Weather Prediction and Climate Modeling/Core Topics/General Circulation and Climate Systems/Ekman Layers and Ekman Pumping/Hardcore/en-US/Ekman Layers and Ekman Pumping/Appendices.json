{
    "hands_on_practices": [
        {
            "introduction": "Understanding any boundary layer begins with defining its physical scale. This foundational exercise guides you through the derivation of the Ekman layer's characteristic e-folding thickness, $\\delta_E$, starting from the balance between Coriolis and frictional forces . By quantifying this thickness with typical oceanic parameters, you will gain a concrete appreciation for the vertical extent over which wind-driven momentum directly influences the upper ocean.",
            "id": "4035105",
            "problem": "Consider a steady, horizontally homogeneous, unstratified ocean surface boundary layer on an $f$-plane, modeled as a semi-infinite Boussinesq fluid occupying $z \\le 0$ with the free surface at $z=0$ and $z$ increasing upward. Assume a constant kinematic eddy viscosity $\\nu$ and neglect nonlinear advection. Let the flow be measured relative to the geostrophic interior so that the horizontal pressure gradient is balanced by the interior geostrophic flow and does not appear explicitly in the boundary layer equations. The steady horizontal momentum balance in the rotating frame is then between the vertical diffusion of momentum and the Coriolis acceleration. Starting from these principles and the corresponding one-dimensional ordinary differential equations for the horizontal velocities, derive the characteristic e-folding thickness $\\delta_{E}$ that governs the decay of the Ekman spiral with depth. Then, for $\\nu = 0.05\\,\\mathrm{m^2\\,s^{-1}}$ and $f = 10^{-4}\\,\\mathrm{s^{-1}}$, compute the numerical value of $\\delta_{E}$. Round your answer to four significant figures and express it in meters. Briefly interpret the magnitude of the resulting thickness in the context of the ocean surface boundary layer in large-scale climate models and numerical weather prediction.",
            "solution": "The starting point is the Boussinesq momentum equations in a rotating frame under the assumptions of steady state, horizontal homogeneity, constant kinematic viscosity, and negligible nonlinear advection. After subtracting the interior geostrophic flow so that the large-scale horizontal pressure gradient is removed from the boundary layer equations, the steady horizontal momentum equations reduce to a balance between Coriolis acceleration and vertical diffusion of momentum:\n$$\n-f v = \\nu \\frac{d^{2} u}{d z^{2}}, \\qquad f u = \\nu \\frac{d^{2} v}{d z^{2}},\n$$\nwhere $u$ and $v$ are the horizontal velocity components, $f$ is the Coriolis parameter, and $\\nu$ is the kinematic eddy viscosity. We take $z \\le 0$ with $z=0$ at the surface and $z \\to -\\infty$ in the interior, and require that the boundary layer velocities vanish as $z \\to -\\infty$ relative to the geostrophic interior.\n\nIntroduce the complex velocity\n$$\nU(z) \\equiv u(z) + i v(z).\n$$\nMultiplying the first equation by $1$ and the second by $i$ and adding yields a single complex ordinary differential equation:\n$$\n\\nu \\frac{d^{2} U}{d z^{2}} + i f\\, U = 0.\n$$\nSeek normal-mode solutions of the form\n$$\nU(z) = U_{0} \\exp(m z),\n$$\nwhere $m$ is a complex vertical wavenumber to be determined. Substitution gives the characteristic equation\n$$\n\\nu m^{2} + i f = 0 \\quad \\Rightarrow \\quad m^{2} = -\\,\\frac{i f}{\\nu}.\n$$\nFor $f0$ (Northern Hemisphere), write $-i = \\exp(-i \\pi/2)$ and take the principal square root to obtain\n$$\nm = \\left(\\frac{f}{\\nu}\\right)^{1/2} \\exp\\!\\left(-\\,i \\frac{\\pi}{4}\\right) = \\left(\\frac{f}{\\nu}\\right)^{1/2} \\frac{1 - i}{\\sqrt{2}} = \\frac{1 - i}{\\delta_{E}},\n$$\nwhere we have defined the characteristic e-folding thickness $\\delta_{E}$ as the inverse of the real part of $m$. From the expression for $m$,\n$$\n\\delta_{E} = \\sqrt{\\frac{2 \\nu}{|f|}}.\n$$\nThis is the canonical Ekman layer thickness, representing both the e-folding decay scale of the velocity magnitude and the vertical wavelength scale of the spiral.\n\nNow evaluate $\\delta_{E}$ for the given parameters $\\nu = 0.05\\,\\mathrm{m^{2}\\,s^{-1}}$ and $f = 10^{-4}\\,\\mathrm{s^{-1}}$:\n$$\n\\delta_{E} = \\sqrt{\\frac{2 \\times 0.05}{10^{-4}}} = \\sqrt{\\frac{0.10}{10^{-4}}} = \\sqrt{10^{3}} = 10 \\sqrt{10} \\approx 31.6227766\\ldots\n$$\nRounded to four significant figures and expressed in meters, this is $31.62\\,\\mathrm{m}$.\n\nInterpretation: The value $\\delta_{E} \\approx 3.16 \\times 10^{1}\\,\\mathrm{m}$ is a physically plausible thickness scale for the oceanic surface Ekman layer under moderate eddy viscosity and midlatitude rotation. In large-scale climate models and numerical weather prediction, this scale indicates that wind-driven shear and Coriolis effects confine the primary ageostrophic transport to the top few tens of meters. The e-folding thickness is smaller than the full mixed-layer depth when stratification is weakly stabilizing or wind stress is strong, and larger effective viscosities or weaker rotation increase $\\delta_{E}$. This thickness sets the depth over which the Ekman transport is realized and from whose divergence Ekman pumping into the ocean interior is induced.",
            "answer": "$$\\boxed{31.62}$$"
        },
        {
            "introduction": "Beyond its vertical structure, the most crucial role of the Ekman layer is to mediate momentum from the wind to the ocean, driving large-scale horizontal transport. This practice demonstrates a cornerstone of geophysical fluid dynamics: deriving the total mass transport within the Ekman layer, which is directed 90 degrees from the wind stress . A key insight you will uncover is that this transport is independent of the often poorly-known turbulent viscosity, making it a robust and powerful concept in oceanography.",
            "id": "4035112",
            "problem": "In the ocean component of a coupled climate model used for Numerical Weather Prediction (NWP) and climate simulations, the surface boundary layer is often represented by a steady, horizontally homogeneous, Boussinesq flow on an $f$-plane with a constant turbulent (eddy) viscosity. Consider an idealized, infinitely deep ocean with no bottom frictional influence on the surface boundary layer. A spatially uniform wind imposes a constant surface wind stress vector of magnitude $|\\boldsymbol{\\tau}|$ at $z=0$ (with $z$ positive upward and the ocean occupying $z \\le 0$). Assume that, sufficiently deep below the surface boundary layer, the turbulent shear stresses vanish and the ageostrophic velocity tends to zero. \n\nStart from the Reynolds-averaged, steady horizontal momentum equations in a rotating frame under the Boussinesq approximation with constant eddy viscosity, and use depth-integration to obtain a closed-form expression for the magnitude of the depth-integrated Ekman transport per unit width, $|{\\boldsymbol{U}}_{E}|$, in terms of the physical parameters $|\\boldsymbol{\\tau}|$, $\\rho$, and $f$. Then, evaluate your expression for $|\\boldsymbol{\\tau}| = 0.1\\,\\mathrm{N\\,m^{-2}}$, $\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$, and $f = 10^{-4}\\,\\mathrm{s^{-1}}$. \n\nExpress the final result as a single real number in $\\mathrm{m^{2}\\,s^{-1}}$ per unit width and round your answer to $3$ significant figures. Clearly state only the magnitude asked for; no directional information is required.",
            "solution": "The problem asks for the magnitude of the depth-integrated Ekman transport, $|{\\boldsymbol{U}}_{E}|$, derived from first principles.\n\nWe begin with the Reynolds-averaged, steady-state, horizontally homogeneous horizontal momentum equations for a Boussinesq fluid on an f-plane with constant eddy viscosity, $K_m$:\n$$ -fv = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + K_m \\frac{\\partial^2 u}{\\partial z^2} $$\n$$ fu = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} + K_m \\frac{\\partial^2 v}{\\partial z^2} $$\nwhere $(u, v)$ are the horizontal velocity components, $f$ is the Coriolis parameter, $\\rho$ is the constant density, and $p$ is the pressure. The ocean occupies $z \\le 0$ with the surface at $z=0$.\n\nThe total horizontal velocity $\\boldsymbol{u} = (u,v)$ is decomposed into a geostrophic component $\\boldsymbol{u}_g = (u_g, v_g)$ and an ageostrophic (Ekman) component $\\boldsymbol{u}_a = (u_a, v_a)$. The geostrophic flow is defined by the balance between the Coriolis force and the pressure gradient force:\n$$ -fv_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} $$\n$$ fu_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} $$\nSubtracting the geostrophic balance from the full momentum equations yields the equations for the ageostrophic velocity components. Since the geostrophic flow $\\boldsymbol{u}_g$ is independent of depth $z$ for a horizontally homogeneous flow, its vertical derivatives are zero. The equations for the ageostrophic part become:\n$$ -fv_a = K_m \\frac{\\partial^2 u_a}{\\partial z^2} $$\n$$ fu_a = K_m \\frac{\\partial^2 v_a}{\\partial z^2} $$\nThe depth-integrated Ekman transport per unit width, $\\boldsymbol{U}_E$, is defined by the components:\n$$ U_E = \\int_{-\\infty}^{0} u_a(z) \\, dz $$\n$$ V_E = \\int_{-\\infty}^{0} v_a(z) \\, dz $$\nTo find $U_E$ and $V_E$, we integrate the ageostrophic momentum equations over the entire depth of the ocean, from $z = -\\infty$ to $z=0$:\n$$ -f \\int_{-\\infty}^{0} v_a \\, dz = \\int_{-\\infty}^{0} K_m \\frac{\\partial^2 u_a}{\\partial z^2} \\, dz \\implies -f V_E = K_m \\left[ \\frac{\\partial u_a}{\\partial z} \\right]_{-\\infty}^{0} $$\n$$ f \\int_{-\\infty}^{0} u_a \\, dz = \\int_{-\\infty}^{0} K_m \\frac{\\partial^2 v_a}{\\partial z^2} \\, dz \\implies f U_E = K_m \\left[ \\frac{\\partial v_a}{\\partial z} \\right]_{-\\infty}^{0} $$\nNow we apply the boundary conditions. At the surface ($z=0$), the turbulent stress in the ocean balances the applied wind stress $\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$:\n$$ \\left. \\rho K_m \\frac{\\partial u}{\\partial z} \\right|_{z=0} = \\tau_x \\quad \\text{and} \\quad \\left. \\rho K_m \\frac{\\partial v}{\\partial z} \\right|_{z=0} = \\tau_y $$\nSince $\\partial u_g/\\partial z = 0$ and $\\partial v_g/\\partial z = 0$, this applies directly to the ageostrophic components:\n$$ \\left. \\frac{\\partial u_a}{\\partial z} \\right|_{z=0} = \\frac{\\tau_x}{\\rho K_m} \\quad \\text{and} \\quad \\left. \\frac{\\partial v_a}{\\partial z} \\right|_{z=0} = \\frac{\\tau_y}{\\rho K_m} $$\nDeep below the surface ($z \\to -\\infty$), the problem states that turbulent shear stresses vanish, which implies:\n$$ \\left. \\frac{\\partial u_a}{\\partial z} \\right|_{z \\to -\\infty} = 0 \\quad \\text{and} \\quad \\left. \\frac{\\partial v_a}{\\partial z} \\right|_{z \\to -\\infty} = 0 $$\nSubstituting these boundary conditions into the integrated equations gives:\n$$ -f V_E = K_m \\left( \\frac{\\tau_x}{\\rho K_m} - 0 \\right) = \\frac{\\tau_x}{\\rho} \\implies V_E = -\\frac{\\tau_x}{\\rho f} $$\n$$ f U_E = K_m \\left( \\frac{\\tau_y}{\\rho K_m} - 0 \\right) = \\frac{\\tau_y}{\\rho} \\implies U_E = \\frac{\\tau_y}{\\rho f} $$\nThe Ekman transport vector is therefore $\\boldsymbol{U}_E = (U_E, V_E) = \\left(\\frac{\\tau_y}{\\rho f}, -\\frac{\\tau_x}{\\rho f}\\right)$. Notably, the result is independent of the eddy viscosity $K_m$.\n\nThe magnitude of the depth-integrated Ekman transport, $|{\\boldsymbol{U}}_{E}|$, is:\n$$ |{\\boldsymbol{U}}_{E}| = \\sqrt{U_E^2 + V_E^2} = \\sqrt{\\left(\\frac{\\tau_y}{\\rho f}\\right)^2 + \\left(-\\frac{\\tau_x}{\\rho f}\\right)^2} = \\sqrt{\\frac{\\tau_x^2 + \\tau_y^2}{(\\rho f)^2}} $$\nSince the magnitude of the wind stress is $|\\boldsymbol{\\tau}| = \\sqrt{\\tau_x^2 + \\tau_y^2}$, we obtain the final closed-form expression:\n$$ |{\\boldsymbol{U}}_{E}| = \\frac{|\\boldsymbol{\\tau}|}{\\rho |f|} $$\nGiven that $f > 0$ for this problem, we have $|f| = f$.\n\nNow we evaluate this expression using the provided values:\n$|\\boldsymbol{\\tau}| = 0.1\\,\\mathrm{N\\,m^{-2}}$\n$\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$\n$f = 10^{-4}\\,\\mathrm{s^{-1}}$\n$$ |{\\boldsymbol{U}}_{E}| = \\frac{0.1}{1025 \\times 10^{-4}} = \\frac{0.1}{0.1025} \\approx 0.975609756\\,\\mathrm{m^2\\,s^{-1}} $$\nRounding the result to 3 significant figures gives:\n$$ |{\\boldsymbol{U}}_{E}| \\approx 0.976\\,\\mathrm{m^2\\,s^{-1}} $$",
            "answer": "$$\n\\boxed{0.976}\n$$"
        },
        {
            "introduction": "The true power of Ekman theory becomes apparent when considering spatially varying winds, which drive the large-scale ocean gyres through Ekman pumping. This capstone exercise moves from theory to application, challenging you to compute the vertical velocity at the base of the Ekman layer by numerically calculating the curl of a gridded wind stress field . By implementing finite-difference schemes and propagating uncertainties, you will engage with the practical methods used by oceanographers and climate scientists to diagnose vertical motion from satellite data.",
            "id": "4035064",
            "problem": "You are given a task to compute the vertical velocity associated with Ekman pumping on a uniform horizontal grid from a gridded wind stress field and to propagate uncertainties from wind stress retrievals into uncertainties of the resulting vertical velocities. Your derivation and implementation must start from the steady, Boussinesq, small-Rossby-number horizontal momentum balance with the Coriolis acceleration and the vertical divergence of turbulent stress, and from mass continuity. You must not assume any shortcut formulas; instead, construct the discrete operator mapping wind stress to Ekman pumping velocity using finite differences on a uniform grid. The numerical method must respect the following constraints:\n- The grid is uniform in $x$ and $y$ with spacings $\\Delta x$ and $\\Delta y$ and node indices $i \\in \\{0,\\dots,n_x-1\\}$ and $j \\in \\{0,\\dots,n_y-1\\}$, located at $x_i = i\\,\\Delta x$ and $y_j = j\\,\\Delta y$.\n- Use second-order accurate centered differences for interior nodes to approximate $\\partial/\\partial x$ and $\\partial/\\partial y$, and second-order accurate one-sided differences at the boundaries using the three-point stencils\n  - At the western boundary $i=0$: $\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i=0} \\approx \\dfrac{-3\\phi_{0,j} + 4\\phi_{1,j} - \\phi_{2,j}}{2\\Delta x}$.\n  - At the eastern boundary $i=n_x-1$: $\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i=n_x-1} \\approx \\dfrac{3\\phi_{n_x-1,j} - 4\\phi_{n_x-2,j} + \\phi_{n_x-3,j}}{2\\Delta x}$.\n  - At the southern boundary $j=0$: $\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{j=0} \\approx \\dfrac{-3\\phi_{i,0} + 4\\phi_{i,1} - \\phi_{i,2}}{2\\Delta y}$.\n  - At the northern boundary $j=n_y-1$: $\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{j=n_y-1} \\approx \\dfrac{3\\phi_{i,n_y-1} - 4\\phi_{i,n_y-2} + \\phi_{i,n_y-3}}{2\\Delta y}$.\n  - For interior nodes, use $\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i,j} \\approx \\dfrac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}$ and $\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{i,j} \\approx \\dfrac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}$.\n- Assume surface vertical velocity is zero so that the vertical velocity at the base of the Ekman layer is the divergence of the integrated Ekman transport, and that the interior flow is nondivergent under geostrophic balance. Assume constant density and a constant Coriolis parameter within each test case.\n\nUncertainty propagation requirements:\n- Each grid node $i,j$ is associated with a one-standard-deviation uncertainty $\\sigma_{\\tau_x}(i,j)$ and $\\sigma_{\\tau_y}(i,j)$ in the zonal and meridional wind stress components $\\tau_x(i,j)$ and $\\tau_y(i,j)$, respectively, both expressed in $\\mathrm{N\\,m^{-2}}$.\n- Treat all wind stress retrieval errors as mutually uncorrelated across components and across grid points. Under this independence assumption and linearization of the mapping from $\\boldsymbol{\\tau}$ to $w_E$, propagate uncertainties through the discrete derivative stencils by summing the squared stencil coefficients times the local variances.\n- Use the same finite-difference stencils for uncertainty propagation as for the derivatives of the mean fields.\n\nCompute for each test case:\n- The domain-mean Ekman pumping velocity $\\overline{w_E}$ in $\\mathrm{m\\,s^{-1}}$.\n- The domain root-mean-square of Ekman pumping velocity $\\mathrm{RMS}(w_E) = \\sqrt{\\langle w_E^2\\rangle}$ in $\\mathrm{m\\,s^{-1}}$.\n- The domain-mean of the one-standard-deviation uncertainty field $\\overline{\\sigma_{w_E}}$ in $\\mathrm{m\\,s^{-1}}$.\n- The domain root-mean-square of the one-standard-deviation uncertainty field $\\mathrm{RMS}(\\sigma_{w_E}) = \\sqrt{\\langle \\sigma_{w_E}^2\\rangle}$ in $\\mathrm{m\\,s^{-1}}$.\n\nAll outputs must be expressed in International System of Units (SI). Report all velocities in $\\mathrm{m\\,s^{-1}}$. Do not report percentages.\n\nTest suite:\nYou must implement your program to compute the requested quantities for the following three cases. In all cases, use $\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$.\n\n- Case A (sinusoidal stresses, mid-latitude, uniform uncertainties):\n  - Grid: $n_x = 64$, $n_y = 64$, $\\Delta x = 25{,}000\\,\\mathrm{m}$, $\\Delta y = 25{,}000\\,\\mathrm{m}$.\n  - Coriolis parameter: $f = 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$.\n  - Define $L_x = n_x \\Delta x$, $L_y = n_y \\Delta y$, $k_x = \\dfrac{2\\pi}{L_x}$, $k_y = \\dfrac{2\\pi}{L_y}$, and $\\tau_0 = 0.2\\,\\mathrm{N\\,m^{-2}}$.\n  - Wind stress fields: $\\tau_x(i,j) = \\tau_0 \\cos(k_x x_i)\\cos(k_y y_j)$ and $\\tau_y(i,j) = \\tau_0 \\sin(k_x x_i)\\sin(k_y y_j)$.\n  - Uncertainties: $\\sigma_{\\tau_x}(i,j) = 0.02\\,\\mathrm{N\\,m^{-2}}$ and $\\sigma_{\\tau_y}(i,j) = 0.02\\,\\mathrm{N\\,m^{-2}}$ for all $i,j$.\n\n- Case B (uniform stresses, Southern Hemisphere, uniform uncertainties; tests sign and boundary stencils):\n  - Grid: $n_x = 7$, $n_y = 9$, $\\Delta x = 50{,}000\\,\\mathrm{m}$, $\\Delta y = 40{,}000\\,\\mathrm{m}$.\n  - Coriolis parameter: $f = -8.0\\times 10^{-5}\\,\\mathrm{s^{-1}}$.\n  - Wind stress fields: $\\tau_x(i,j) = 0.2\\,\\mathrm{N\\,m^{-2}}$, $\\tau_y(i,j) = -0.1\\,\\mathrm{N\\,m^{-2}}$ for all $i,j$.\n  - Uncertainties: $\\sigma_{\\tau_x}(i,j) = 0.03\\,\\mathrm{N\\,m^{-2}}$, $\\sigma_{\\tau_y}(i,j) = 0.03\\,\\mathrm{N\\,m^{-2}}$ for all $i,j$.\n\n- Case C (crossing jets, near-equatorial $f$, spatially varying uncertainties):\n  - Grid: $n_x = 11$, $n_y = 11$, $\\Delta x = 30{,}000\\,\\mathrm{m}$, $\\Delta y = 40{,}000\\,\\mathrm{m}$.\n  - Coriolis parameter: $f = 1.2\\times 10^{-5}\\,\\mathrm{s^{-1}}$.\n  - Define centers $x_0 = \\dfrac{(n_x-1)\\Delta x}{2}$, $y_0 = \\dfrac{(n_y-1)\\Delta y}{2}$, scales $s_x = 3\\Delta x$, $s_y = 2\\Delta y$, amplitudes $A = 0.3\\,\\mathrm{N\\,m^{-2}}$, $B = -0.15\\,\\mathrm{N\\,m^{-2}}$.\n  - Wind stress fields: $\\tau_x(i,j) = A \\exp\\!\\left(-\\dfrac{(y_j - y_0)^2}{2 s_y^2}\\right)$ and $\\tau_y(i,j) = B \\exp\\!\\left(-\\dfrac{(x_i - x_0)^2}{2 s_x^2}\\right)$.\n  - Uncertainties: Let $L_x = n_x \\Delta x$, $L_y = n_y \\Delta y$. Set $\\sigma_{\\tau_x}(i,j) = 0.02 + 0.01 \\sin\\!\\left(\\dfrac{2\\pi x_i}{L_x}\\right)\\cos\\!\\left(\\dfrac{2\\pi y_j}{L_y}\\right)$ and $\\sigma_{\\tau_y}(i,j) = 0.025 + 0.005 \\cos\\!\\left(\\dfrac{2\\pi x_i}{L_x}\\right)\\sin\\!\\left(\\dfrac{2\\pi y_j}{L_y}\\right)$, both in $\\mathrm{N\\,m^{-2}}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list of sublists, each sublist containing four floating-point numbers in the order $[\\overline{w_E}, \\mathrm{RMS}(w_E), \\overline{\\sigma_{w_E}}, \\mathrm{RMS}(\\sigma_{w_E})]$, all in $\\mathrm{m\\,s^{-1}}$.\n- The single line must be exactly of the form\n  \"[[caseA_mean,caseA_rms,caseA_mean_sigma,caseA_rms_sigma],[caseB_mean,caseB_rms,caseB_mean_sigma,caseB_rms_sigma],[caseC_mean,caseC_rms,caseC_mean_sigma,caseC_rms_sigma]]\"\nwith no additional text before or after.",
            "solution": "The user's request is a valid and well-posed scientific problem. All necessary data, physical constants, and boundary conditions are provided, and the problem is grounded in the established principles of geophysical fluid dynamics.\n\n### 1. Theoretical Derivation\n\nThe derivation of the Ekman pumping velocity, $w_E$, begins with the steady-state, Boussinesq, small-Rossby-number horizontal momentum equations in a rotating reference frame. The balance is between the Coriolis force and the vertical divergence of turbulent stress:\n$$\n-f v = \\frac{1}{\\rho} \\frac{\\partial \\tau_x}{\\partial z} \\\\\nf u = \\frac{1}{\\rho} \\frac{\\partial \\tau_y}{\\partial z}\n$$\nHere, $u$ and $v$ are the horizontal velocity components in the $x$ and $y$ directions, respectively. The Coriolis parameter is $f$, the water density is $\\rho$ (assumed constant), and $\\tau_x$ and $\\tau_y$ are the horizontal components of the turbulent stress vector.\n\nWe integrate these equations vertically through the depth of the surface Ekman layer, from its base at $z = -H_E$ (where turbulent stress is assumed to vanish) to the sea surface at $z=0$. At the surface, the stress is equal to the wind stress, $\\boldsymbol{\\tau}^s = (\\tau_x^s, \\tau_y^s)$.\n$$\n\\int_{-H_E}^{0} -f v \\, dz = \\frac{1}{\\rho} \\int_{-H_E}^{0} \\frac{\\partial \\tau_x}{\\partial z} dz = \\frac{1}{\\rho} \\left[ \\tau_x(0) - \\tau_x(-H_E) \\right] = \\frac{\\tau_x^s}{\\rho} \\\\\n\\int_{-H_E}^{0} f u \\, dz = \\frac{1}{\\rho} \\int_{-H_E}^{0} \\frac{\\partial \\tau_y}{\\partial z} dz = \\frac{1}{\\rho} \\left[ \\tau_y(0) - \\tau_y(-H_E) \\right] = \\frac{\\tau_y^s}{\\rho}\n$$\nThe vertically integrated horizontal velocities define the Ekman transport components, $U_E = \\int_{-H_E}^{0} u \\, dz$ and $V_E = \\int_{-H_E}^{0} v \\, dz$. With a constant Coriolis parameter $f$, the integrated momentum equations yield the Ekman transports:\n$$\n-f V_E = \\frac{\\tau_x^s}{\\rho} \\implies V_E = -\\frac{\\tau_x^s}{\\rho f} \\\\\nf U_E = \\frac{\\tau_y^s}{\\rho} \\implies U_E = \\frac{\\tau_y^s}{\\rho f}\n$$\nNext, we use the principle of mass continuity for an incompressible fluid:\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0\n$$\nIntegrating this equation vertically across the Ekman layer gives:\n$$\n\\int_{-H_E}^{0} \\left( \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} \\right) dz + \\int_{-H_E}^{0} \\frac{\\partial w}{\\partial z} dz = 0\n$$\nInterchanging integration and differentiation for the horizontal divergence term, we get:\n$$\n\\frac{\\partial}{\\partial x} \\left( \\int_{-H_E}^{0} u \\, dz \\right) + \\frac{\\partial}{\\partial y} \\left( \\int_{-H_E}^{0} v \\, dz \\right) + \\left[ w(z=0) - w(z=-H_E) \\right] = 0\n$$\nThis simplifies to the divergence of the Ekman transport:\n$$\n\\frac{\\partial U_E}{\\partial x} + \\frac{\\partial V_E}{\\partial y} + w(0) - w(-H_E) = 0\n$$\nThe problem states that the vertical velocity at the sea surface is zero, $w(0) = 0$. The vertical velocity at the base of the Ekman layer, $w_E \\equiv w(-H_E)$, is the Ekman pumping velocity. Therefore:\n$$\nw_E = \\frac{\\partial U_E}{\\partial x} + \\frac{\\partial V_E}{\\partial y}\n$$\nSubstituting the expressions for $U_E$ and $V_E$ in terms of the wind stress components (dropping the superscript $s$ for simplicity):\n$$\nw_E = \\frac{\\partial}{\\partial x}\\left(\\frac{\\tau_y}{\\rho f}\\right) + \\frac{\\partial}{\\partial y}\\left(-\\frac{\\tau_x}{\\rho f}\\right)\n$$\nSince $\\rho$ and $f$ are constant within each case, they can be factored out:\n$$\nw_E = \\frac{1}{\\rho f} \\left( \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y} \\right)\n$$\nThis final equation states that the Ekman pumping velocity is proportional to the curl of the wind stress.\n\n### 2. Numerical Discretization\n\nThe continuous formula for $w_E$ is discretized on a uniform grid with spacings $\\Delta x$ and $\\Delta y$. The partial derivatives are approximated using the finite difference stencils specified in the problem. Let $\\tau_x(i,j)$ and $\\tau_y(i,j)$ be the stress components at grid node $(i,j)$. The Ekman velocity $w_E(i,j)$ is:\n$$\nw_E(i,j) = \\frac{1}{\\rho f} \\left( \\left.\\frac{\\partial \\tau_y}{\\partial x}\\right|_{i,j} - \\left.\\frac{\\partial \\tau_x}{\\partial y}\\right|_{i,j} \\right)\n$$\nThe derivatives are computed using second-order centered differences for interior points ($1 \\le i \\le n_x-2$, $1 \\le j \\le n_y-2$) and second-order one-sided differences at the boundaries ($i \\in \\{0, n_x-1\\}$ or $j \\in \\{0, n_y-1\\}$). For example, the term $\\left.\\frac{\\partial \\tau_y}{\\partial x}\\right|_{i,j}$ is computed as:\n- For $1 \\le i \\le n_x-2$: $\\dfrac{\\tau_y(i+1,j) - \\tau_y(i-1,j)}{2\\Delta x}$\n- For $i=0$: $\\dfrac{-3\\tau_y(0,j) + 4\\tau_y(1,j) - \\tau_y(2,j)}{2\\Delta x}$\n- For $i=n_x-1$: $\\dfrac{3\\tau_y(n_x-1,j) - 4\\tau_y(n_x-2,j) + \\tau_y(n_x-3,j)}{2\\Delta x}$\n\nAnalogous stencils are used for $\\left.\\frac{\\partial \\tau_x}{\\partial y}\\right|_{i,j}$. At corner points, the appropriate one-sided stencils for each direction are combined.\n\n### 3. Uncertainty Propagation\n\nThe calculation of $w_E(i,j)$ is a linear operation on the wind stress fields $\\boldsymbol{\\tau}_x$ and $\\boldsymbol{\\tau}_y$. We can write it as:\n$$\nw_E(i,j) = \\sum_{k,l} C_{ijkl} \\tau_y(k,l) - \\sum_{k,l} D_{ijkl} \\tau_x(k,l)\n$$\nwhere the coefficients $C$ and $D$ are derived from the finite difference stencils and the factor $1/(\\rho f)$. For example, for an interior point $(i,j)$, the only non-zero coefficients for the $\\tau_y$ term are $C_{ij,i+1,j} = \\frac{1}{\\rho f \\cdot 2\\Delta x}$ and $C_{ij,i-1,j} = -\\frac{1}{\\rho f \\cdot 2\\Delta x}$.\n\nThe problem states that the wind stress uncertainties are uncorrelated across components and grid points. For a linear combination of independent random variables, $Y = \\sum a_k X_k$, the variance is $\\sigma_Y^2 = \\sum a_k^2 \\sigma_{X_k}^2$. Applying this to our formula for $w_E(i,j)$, its variance $\\sigma_{w_E}^2(i,j)$ is:\n$$\n\\sigma_{w_E}^2(i,j) = \\sum_{k,l} \\left( \\frac{\\partial w_E(i,j)}{\\partial \\tau_y(k,l)} \\right)^2 \\sigma_{\\tau_y}^2(k,l) + \\sum_{k,l} \\left( \\frac{\\partial w_E(i,j)}{\\partial \\tau_x(k,l)} \\right)^2 \\sigma_{\\tau_x}^2(k,l)\n$$\nThe partial derivatives are simply the coefficients, so:\n$$\n\\sigma_{w_E}^2(i,j) = \\sum_{k,l} C_{ijkl}^2 \\sigma_{\\tau_y}^2(k,l) + \\sum_{k,l} D_{ijkl}^2 \\sigma_{\\tau_x}^2(k,l)\n$$\nThis is equivalent to summing the squared stencil coefficients for each derivative, multiplied by the local variance of the input field, and then summing the contributions from the $\\tau_x$ and $\\tau_y$ terms. For an interior point $(i,j)$:\n$$\n\\sigma_{w_E}^2(i,j) = \\frac{1}{(\\rho f)^2} \\left[ \\frac{\\sigma_{\\tau_y}^2(i-1,j) + \\sigma_{\\tau_y}^2(i+1,j)}{(2\\Delta x)^2} + \\frac{\\sigma_{\\tau_x}^2(i,j-1) + \\sigma_{\\tau_x}^2(i,j+1)}{(2\\Delta y)^2} \\right]\n$$\nThe required one-standard-deviation uncertainty is $\\sigma_{w_E}(i,j) = \\sqrt{\\sigma_{w_E}^2(i,j)}$.\n\n### 4. Implementation Algorithm\n\nThe numerical solution is implemented by first defining vectorized functions to compute the spatial derivatives and the corresponding variance propagation for an entire grid at once.\n$1$. `gradient_x(phi, dx)`: Computes $\\partial\\phi/\\partial x$ using slicin_g to apply interior and boundary stencils.\n$2$. `gradient_y(phi, dy)`: Computes $\\partial\\phi/\\partial y$ similarly.\n$3$. `variance_prop_dx(sigma_sq, dx)`: Computes the variance term resulting from the $\\partial/\\partial x$ operation, i.e., $\\sum c^2 \\sigma^2$.\n$4$. `variance_prop_dy(sigma_sq, dy)`: Computes the variance term for the $\\partial/\\partial y$ operation.\n\nFor each test case:\n$1$. The grid parameters ($n_x, n_y, \\Delta x, \\Delta y$), physical constants ($\\rho, f$), and wind stress field definitions are used to generate the 2D arrays for $\\tau_x, \\tau_y, \\sigma_{\\tau_x}, \\sigma_{\\tau_y}$.\n$2$. The Ekman pumping field $w_E$ is calculated as `(gradient_x(tau_y, dx) - gradient_y(tau_x, dy)) / (rho * f)`.\n$3$. The input variance fields $\\sigma_{\\tau_x}^2$ and $\\sigma_{\\tau_y}^2$ are computed.\n$4$. The variance of the Ekman pumping, $\\sigma_{w_E}^2$, is calculated as `(variance_prop_dx(sigma_tau_y**2, dx) + variance_prop_dy(sigma_tau_x**2, dy)) / (rho * f)**2`.\n$5$. The standard deviation field is $\\sigma_{w_E} = \\sqrt{\\sigma_{w_E}^2}$.\n$6$. The four required statistics are computed over the entire grid: domain-mean of $w_E$, $\\mathrm{RMS}$ of $w_E$, domain-mean of $\\sigma_{w_E}$, and $\\mathrm{RMS}$ of $\\sigma_{w_E}$.\n$7$. The results for all three cases are collected and formatted into the required single-line string output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Ekman pumping problem for all test cases.\n    \"\"\"\n\n    def gradient_x(phi, dx):\n        \"\"\"Computes d/dx of a 2D field phi using specified finite differences.\"\"\"\n        ny, nx = phi.shape\n        dphi_dx = np.zeros_like(phi)\n\n        # Interior points (second-order centered)\n        if nx > 2:\n            dphi_dx[:, 1:-1] = (phi[:, 2:] - phi[:, :-2]) / (2.0 * dx)\n        \n        # Boundary i=0 (western, second-order forward)\n        if nx > 2:\n            dphi_dx[:, 0] = (-3.0 * phi[:, 0] + 4.0 * phi[:, 1] - phi[:, 2]) / (2.0 * dx)\n\n        # Boundary i=nx-1 (eastern, second-order backward)\n        if nx > 2:\n            dphi_dx[:, -1] = (3.0 * phi[:, -1] - 4.0 * phi[:, -2] + phi[:, -3]) / (2.0 * dx)\n        \n        return dphi_dx\n\n    def gradient_y(phi, dy):\n        \"\"\"Computes d/dy of a 2D field phi using specified finite differences.\"\"\"\n        ny, nx = phi.shape\n        dphi_dy = np.zeros_like(phi)\n\n        # Interior points (second-order centered)\n        if ny > 2:\n            dphi_dy[1:-1, :] = (phi[2:, :] - phi[:-2, :]) / (2.0 * dy)\n            \n        # Boundary j=0 (southern, second-order forward)\n        if ny > 2:\n            dphi_dy[0, :] = (-3.0 * phi[0, :] + 4.0 * phi[1, :] - phi[2, :]) / (2.0 * dy)\n\n        # Boundary j=ny-1 (northern, second-order backward)\n        if ny > 2:\n            dphi_dy[-1, :] = (3.0 * phi[-1, :] - 4.0 * phi[-2, :] + phi[-3, :]) / (2.0 * dy)\n        \n        return dphi_dy\n\n    def variance_prop_dx(sigma_sq, dx):\n        \"\"\"Propagates variance through the d/dx operator.\"\"\"\n        ny, nx = sigma_sq.shape\n        var_contrib = np.zeros_like(sigma_sq)\n        \n        # Interior points\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, 1:-1] = c_sq * (sigma_sq[:, 2:] + sigma_sq[:, :-2])\n\n        # Western boundary\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, 0] = c_sq * ((-3.0)**2 * sigma_sq[:, 0] + (4.0)**2 * sigma_sq[:, 1] + (-1.0)**2 * sigma_sq[:, 2])\n\n        # Eastern boundary\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, -1] = c_sq * ((3.0)**2 * sigma_sq[:, -1] + (-4.0)**2 * sigma_sq[:, -2] + (1.0)**2 * sigma_sq[:, -3])\n            \n        return var_contrib\n\n    def variance_prop_dy(sigma_sq, dy):\n        \"\"\"Propagates variance through the d/dy operator.\"\"\"\n        ny, nx = sigma_sq.shape\n        var_contrib = np.zeros_like(sigma_sq)\n\n        # Interior points\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[1:-1, :] = c_sq * (sigma_sq[2:, :] + sigma_sq[:-2, :])\n        \n        # Southern boundary\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[0, :] = c_sq * ((-3.0)**2 * sigma_sq[0, :] + (4.0)**2 * sigma_sq[1, :] + (-1.0)**2 * sigma_sq[2, :])\n        \n        # Northern boundary\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[-1, :] = c_sq * ((3.0)**2 * sigma_sq[-1, :] + (-4.0)**2 * sigma_sq[-2, :] + (1.0)**2 * sigma_sq[-3, :])\n            \n        return var_contrib\n        \n    def calculate_case(params):\n        \"\"\"Computes all required quantities for a single test case.\"\"\"\n        nx, ny = params['nx'], params['ny']\n        dx, dy = params['dx'], params['dy']\n        f = params['f']\n        rho = 1025.0\n\n        # Create grid coordinates\n        x = np.arange(nx) * dx\n        y = np.arange(ny) * dy\n        xx, yy = np.meshgrid(x, y, indexing='ij')\n        \n        # Transpose to match (ny, nx) indexing for phi[j,i]\n        xx = xx.T \n        yy = yy.T\n\n        # Generate stress and uncertainty fields based on case type\n        if params['id'] == 'A':\n            Lx, Ly = nx * dx, ny * dy\n            kx, ky = 2.0 * np.pi / Lx, 2.0 * np.pi / Ly\n            tau0 = 0.2\n            tau_x = tau0 * np.cos(kx * xx) * np.cos(ky * yy)\n            tau_y = tau0 * np.sin(kx * xx) * np.sin(ky * yy)\n            sigma_tau_x = np.full((ny, nx), 0.02)\n            sigma_tau_y = np.full((ny, nx), 0.02)\n        elif params['id'] == 'B':\n            tau_x = np.full((ny, nx), 0.2)\n            tau_y = np.full((ny, nx), -0.1)\n            sigma_tau_x = np.full((ny, nx), 0.03)\n            sigma_tau_y = np.full((ny, nx), 0.03)\n        elif params['id'] == 'C':\n            x0, y0 = (nx - 1) * dx / 2.0, (ny - 1) * dy / 2.0\n            sx, sy = 3.0 * dx, 2.0 * dy\n            A, B = 0.3, -0.15\n            tau_x = A * np.exp(-((yy - y0)**2) / (2.0 * sy**2))\n            tau_y = B * np.exp(-((xx - x0)**2) / (2.0 * sx**2))\n            \n            Lx, Ly = nx * dx, ny * dy\n            sigma_tau_x = 0.02 + 0.01 * np.sin(2*np.pi * xx / Lx) * np.cos(2*np.pi * yy / Ly)\n            sigma_tau_y = 0.025 + 0.005 * np.cos(2*np.pi * xx / Lx) * np.sin(2*np.pi * yy / Ly)\n\n        # Calculate Ekman pumping velocity\n        dtauy_dx = gradient_x(tau_y, dx)\n        dtaux_dy = gradient_y(tau_x, dy)\n        w_E = (dtauy_dx - dtaux_dy) / (rho * f)\n\n        # Propagate uncertainties\n        sigma_tau_x_sq = sigma_tau_x**2\n        sigma_tau_y_sq = sigma_tau_y**2\n        var_from_tau_y = variance_prop_dx(sigma_tau_y_sq, dx)\n        var_from_tau_x = variance_prop_dy(sigma_tau_x_sq, dy)\n        sigma_w_E_sq = (var_from_tau_y + var_from_tau_x) / (rho * f)**2\n        sigma_w_E = np.sqrt(sigma_w_E_sq)\n\n        # Compute statistics\n        mean_w_E = np.mean(w_E)\n        rms_w_E = np.sqrt(np.mean(w_E**2))\n        mean_sigma_w_E = np.mean(sigma_w_E)\n        rms_sigma_w_E = np.sqrt(np.mean(sigma_w_E**2))\n\n        return [mean_w_E, rms_w_E, mean_sigma_w_E, rms_sigma_w_E]\n\n    test_cases = [\n        {'id': 'A', 'nx': 64, 'ny': 64, 'dx': 25000.0, 'dy': 25000.0, 'f': 1.0e-4},\n        {'id': 'B', 'nx': 7, 'ny': 9, 'dx': 50000.0, 'dy': 40000.0, 'f': -8.0e-5},\n        {'id': 'C', 'nx': 11, 'ny': 11, 'dx': 30000.0, 'dy': 40000.0, 'f': 1.2e-5}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result_list = calculate_case(case)\n        all_results.append(result_list)\n    \n    formatted_results = []\n    for res_list in all_results:\n        # Format list to string '[v1,v2,v3,v4]' without spaces\n        inner_str = f\"[{res_list[0]},{res_list[1]},{res_list[2]},{res_list[3]}]\"\n        formatted_results.append(inner_str)\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}