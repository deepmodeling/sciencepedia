{
    "hands_on_practices": [
        {
            "introduction": "在深入分析埃克曼层内部的动力学之前，理解其物理尺度至关重要。本练习将引导您推导经典的e-折叠深度 $\\delta_E$，它代表了摩擦力与科里奥利力相平衡的层厚。通过这个练习，您将掌握如何从基本动量方程出发，确定行星边界层这一关键特征的具体尺度。",
            "id": "4035105",
            "problem": "考虑一个位于 $f$ 平面上的稳态、水平均匀、无分层的海洋表面边界层，该边界层被模拟为一个占据 $z \\le 0$ 的半无限 Boussinesq 流体，其自由表面位于 $z=0$，且 $z$ 轴向上为正。假设运动涡粘性系数 $\\nu$ 为常数，并忽略非线性平流。设流动是相对于地转内部测量的，因此水平气压梯度由内部地转流平衡，并且不显式出现在边界层方程中。在这种情况下，旋转坐标系中的稳态水平动量平衡表现为动量的垂直扩散与科里奥利加速度之间的平衡。从这些原理以及相应的水平速度一维常微分方程出发，推导控制埃克曼螺线随深度衰减的特征 e-折厚度 $\\delta_{E}$。然后，对于给定的 $\\nu = 0.05\\,\\mathrm{m^2\\,s^{-1}}$ 和 $f = 10^{-4}\\,\\mathrm{s^{-1}}$，计算 $\\delta_{E}$ 的数值。将您的答案四舍五入到四位有效数字，并以米为单位表示。结合大尺度气候模型和数值天气预报中的海洋表面边界层背景，简要解释所得厚度的量级。",
            "solution": "出发点是在稳态、水平均匀、运动涡粘性系数恒定和非线性平流可忽略的假设下，旋转坐标系中的 Boussinesq 动量方程。通过减去内部地转流，从而将大尺度水平气压梯度从边界层方程中移除，稳态水平动量方程可简化为科里奥利加速度与动量垂直扩散之间的平衡：\n$$\n-f v = \\nu \\frac{d^{2} u}{d z^{2}}, \\qquad f u = \\nu \\frac{d^{2} v}{d z^{2}},\n$$\n其中 $u$ 和 $v$ 是水平速度分量，$f$ 是科里奥利参数，$\\nu$ 是运动涡粘性系数。我们取 $z \\le 0$，其中 $z=0$ 为表面，$z \\to -\\infty$ 为内部，并要求相对于地转内部，边界层速度在 $z \\to -\\infty$ 时消失。\n\n引入复速度\n$$\nU(z) \\equiv u(z) + i v(z).\n$$\n将第一个方程乘以 $1$，第二个方程乘以 $i$，然后相加，得到一个单一的复常微分方程：\n$$\n\\nu \\frac{d^{2} U}{d z^{2}} - i f\\, U = 0.\n$$\n寻求形如\n$$\nU(z) = U_{0} \\exp(m z),\n$$\n的简正模解，其中 $m$ 是一个待定的复垂直波数。代入后得到特征方程\n$$\n\\nu m^{2} - i f = 0 \\quad \\Rightarrow \\quad m^{2} = \\frac{i f}{\\nu}.\n$$\n对于 $f0$（北半球），将 $i$ 写成 $\\exp(i \\pi/2)$ 并取主平方根，可得\n$$\nm = \\left(\\frac{f}{\\nu}\\right)^{1/2} \\exp\\!\\left(i \\frac{\\pi}{4}\\right) = \\left(\\frac{f}{\\nu}\\right)^{1/2} \\frac{1 + i}{\\sqrt{2}} = \\frac{1 + i}{\\delta_{E}},\n$$\n其中我们已将特征 e-折厚度 $\\delta_{E}$ 定义为 $m$ 的实部的倒数。根据 $m$ 的表达式，\n$$\n\\delta_{E} = \\sqrt{\\frac{2 \\nu}{|f|}}.\n$$\n这是典型的埃克曼层厚度，既代表速度大小的 e-折衰减尺度，也代表螺线的垂直波长尺度。\n\n现在，使用给定的参数 $\\nu = 0.05\\,\\mathrm{m^{2}\\,s^{-1}}$ 和 $f = 10^{-4}\\,\\mathrm{s^{-1}}$ 计算 $\\delta_{E}$：\n$$\n\\delta_{E} = \\sqrt{\\frac{2 \\times 0.05}{10^{-4}}} = \\sqrt{\\frac{0.10}{10^{-4}}} = \\sqrt{10^{3}} = 10 \\sqrt{10} \\approx 31.6227766\\ldots\n$$\n四舍五入到四位有效数字并以米为单位表示，结果为 $31.62\\,\\mathrm{m}$。\n\n解释：$\\delta_{E} \\approx 31.62\\,\\mathrm{m}$ 这个值，对于中等涡粘性和中纬度旋转条件下的海洋表面埃克曼层来说，是一个物理上合理的厚度尺度。在大尺度气候模型和数值天气预报中，这个尺度表明风生切变和科里奥利效应将主要的非地转输送限制在海洋顶部的几十米内。当层结是弱稳定或风应力较强时，e-折厚度小于整个混合层的深度；而较大的有效粘性或较弱的旋转会使 $\\delta_{E}$ 增加。该厚度设定了埃克曼输送得以实现的深度，其辐散会诱发进入海洋内部的埃克曼抽吸。",
            "answer": "$$\\boxed{31.62}$$"
        },
        {
            "introduction": "在确定了埃克曼层的厚度之后，下一步是研究其积分效应，即层内的总水平输送。本练习将引导您推导经典的埃克曼输送公式，这是大尺度海洋环流理论的基石。通过对动量方程进行深度积分，您会发现一个深刻的结论：总输送量与未知的涡粘性系数无关，并且其方向垂直于风应力。",
            "id": "4035112",
            "problem": "在用于数值天气预报（NWP）和气候模拟的耦合气候模型的海洋部分中，表面边界层通常用一个$f$平面上具有恒定湍流（涡）黏度的稳定、水平均匀的Boussinesq流来表示。考虑一个理想化的、无限深的海洋，其底部摩擦对表面边界层没有影响。在$z=0$处，空间均匀的风施加了一个大小为$|\\boldsymbol{\\tau}|$的恒定表面风应力矢量（其中$z$向上为正，海洋占据$z \\le 0$）。假设在表面边界层下方足够深处，湍流切应力消失，非地转速度趋于零。\n\n从旋转坐标系中Boussinesq近似下具有恒定涡黏度的雷诺平均、稳定水平动量方程出发，通过深度积分得到单位宽度上深度积分的埃克曼输送量$|{\\boldsymbol{U}}_{E}|$的封闭形式表达式，用物理参数$|\\boldsymbol{\\tau}|$, $\\rho$, 和 $f$表示。然后，代入$|\\boldsymbol{\\tau}| = 0.1\\,\\mathrm{N\\,m^{-2}}$, $\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$ 和 $f = 10^{-4}\\,\\mathrm{s^{-1}}$计算表达式的值。\n\n将最终结果表示为一个单位宽度上的实数，单位为$\\mathrm{m^{2}\\,s^{-1}}$，并将答案四舍五入到$3$位有效数字。只要求明确说明所求的大小；不需要方向信息。",
            "solution": "该问题已经过验证，科学上合理、适定且客观。这是地球物理流体动力学中关于埃克曼层的标准问题。\n\n在旋转坐标系中，Boussinesq近似下具有恒定运动涡黏度$\\nu$的稳态、水平均匀的雷诺平均水平动量方程由下式给出：\n$$ -fv = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + \\frac{\\partial \\tau_{xz}}{\\partial z} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} + \\nu \\frac{\\partial^2 u}{\\partial z^2} $$\n$$ fu = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} + \\frac{\\partial \\tau_{yz}}{\\partial z} = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} + \\nu \\frac{\\partial^2 v}{\\partial z^2} $$\n其中$(u, v)$是水平速度分量，$f$是科里奥利参数，$\\rho$是恒定密度，$p$是压力，$(\\tau_{xz}, \\tau_{yz})$是湍流切应力分量。\n\n总水平速度$\\boldsymbol{u} = (u,v)$被分解为地转分量$\\boldsymbol{u}_g = (u_g, v_g)$和非地转（埃克曼）分量$\\boldsymbol{u}_a = (u_a, v_a)$。地转流由科里奥利力与压力梯度力之间的平衡定义：\n$$ -fv_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} $$\n$$ fu_g = -\\frac{1}{\\rho}\\frac{\\partial p}{\\partial y} $$\n将分解式$\\boldsymbol{u} = \\boldsymbol{u}_g + \\boldsymbol{u}_a$代入动量方程，并利用地转平衡的定义，我们得到非地转速度分量的方程。由于地转流$\\boldsymbol{u}_g$不依赖于深度$z$（这是水平均匀性和适用于内部流动的泰勒-普劳德曼定理的结果），其对$z$的导数为零。方程变为：\n$$ -fv_a = \\nu \\frac{\\partial^2 u_a}{\\partial z^2} $$\n$$ fu_a = \\nu \\frac{\\partial^2 v_a}{\\partial z^2} $$\n这些方程描述了埃克曼层的动力学。问题要求解单位宽度上深度积分的埃克曼输送量$\\boldsymbol{U}_E$的大小。该矢量的分量定义为：\n$$ U_E = \\int_{-\\infty}^{0} u_a(z) \\, dz $$\n$$ V_E = \\int_{-\\infty}^{0} v_a(z) \\, dz $$\n为了求得$U_E$和$V_E$，我们将非地转动量方程在整个海洋深度上进行积分，从$z = -\\infty$到$z=0$：\n$$ -f \\int_{-\\infty}^{0} v_a \\, dz = \\int_{-\\infty}^{0} \\nu \\frac{\\partial^2 u_a}{\\partial z^2} \\, dz \\implies -f V_E = \\nu \\left[ \\frac{\\partial u_a}{\\partial z} \\right]_{-\\infty}^{0} $$\n$$ f \\int_{-\\infty}^{0} u_a \\, dz = \\int_{-\\infty}^{0} \\nu \\frac{\\partial^2 v_a}{\\partial z^2} \\, dz \\implies f U_E = \\nu \\left[ \\frac{\\partial v_a}{\\partial z} \\right]_{-\\infty}^{0} $$\n接下来，我们应用边界条件。\n在表面（$z=0$），海洋中的湍流应力与施加的风应力$\\boldsymbol{\\tau} = (\\tau_x, \\tau_y)$相平衡：\n$$ \\left. \\rho \\nu \\frac{\\partial u}{\\partial z} \\right|_{z=0} = \\tau_x \\quad \\text{和} \\quad \\left. \\rho \\nu \\frac{\\partial v}{\\partial z} \\right|_{z=0} = \\tau_y $$\n由于$\\partial u_g/\\partial z = 0$和$\\partial v_g/\\partial z = 0$，这些变为：\n$$ \\left. \\frac{\\partial u_a}{\\partial z} \\right|_{z=0} = \\frac{\\tau_x}{\\rho \\nu} \\quad \\text{和} \\quad \\left. \\frac{\\partial v_a}{\\partial z} \\right|_{z=0} = \\frac{\\tau_y}{\\rho \\nu} $$\n在表面下方深处（$z \\to -\\infty$），问题陈述湍流切应力消失。这意味着：\n$$ \\left. \\frac{\\partial u_a}{\\partial z} \\right|_{z \\to -\\infty} = 0 \\quad \\text{和} \\quad \\left. \\frac{\\partial v_a}{\\partial z} \\right|_{z \\to -\\infty} = 0 $$\n将这些边界条件代入积分后的方程：\n$$ -f V_E = \\nu \\left( \\frac{\\tau_x}{\\rho \\nu} - 0 \\right) = \\frac{\\tau_x}{\\rho} \\implies V_E = -\\frac{\\tau_x}{\\rho f} $$\n$$ f U_E = \\nu \\left( \\frac{\\tau_y}{\\rho \\nu} - 0 \\right) = \\frac{\\tau_y}{\\rho} \\implies U_E = \\frac{\\tau_y}{\\rho f} $$\n因此，埃克曼输送矢量为$\\boldsymbol{U}_E = (U_E, V_E) = \\left(\\frac{\\tau_y}{\\rho f}, -\\frac{\\tau_x}{\\rho f}\\right)$。这表明，在北半球（$f0$），输送方向位于风应力方向右侧$90^{\\circ}$。运动涡黏度$\\nu$已经方便地被消掉了。\n\n深度积分的埃克曼输送量$|{\\boldsymbol{U}}_{E}|$的大小为：\n$$ |{\\boldsymbol{U}}_{E}| = \\sqrt{U_E^2 + V_E^2} = \\sqrt{\\left(\\frac{\\tau_y}{\\rho f}\\right)^2 + \\left(-\\frac{\\tau_x}{\\rho f}\\right)^2} = \\sqrt{\\frac{\\tau_x^2 + \\tau_y^2}{(\\rho f)^2}} $$\n认识到风应力的大小为$|\\boldsymbol{\\tau}| = \\sqrt{\\tau_x^2 + \\tau_y^2}$，我们得到封闭形式的表达式：\n$$ |{\\boldsymbol{U}}_{E}| = \\frac{|\\boldsymbol{\\tau}|}{\\rho |f|} $$\n给定$f > 0$，我们有$|f| = f$。\n$$ |{\\boldsymbol{U}}_{E}| = \\frac{|\\boldsymbol{\\tau}|}{\\rho f} $$\n现在我们使用给定的值计算这个表达式：\n$|\\boldsymbol{\\tau}| = 0.1\\,\\mathrm{N\\,m^{-2}}$\n$\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$\n$f = 10^{-4}\\,\\mathrm{s^{-1}}$\n\n$$ |{\\boldsymbol{U}}_{E}| = \\frac{0.1}{1025 \\times 10^{-4}} = \\frac{0.1}{0.1025} \\approx 0.975609756\\,\\mathrm{m^2\\,s^{-1}} $$\n将结果四舍五入到$3$位有效数字，我们得到：\n$$ |{\\boldsymbol{U}}_{E}| \\approx 0.976\\,\\mathrm{m^2\\,s^{-1}} $$",
            "answer": "$$\n\\boxed{0.976}\n$$"
        },
        {
            "introduction": "最后的这项练习将理论与实际应用联系起来，这是现代气候科学与数值天气预报中的一项关键技能。您将利用有限差分方法，根据网格化的风应力数据计算由埃克曼输送的辐合辐散引起的垂向速度，即埃克曼抽吸。这个练习不仅能让您掌握风应力旋度如何驱动上升流与下降流，还将训练您处理和分析真实世界地球物理数据的数值方法，并对不确定性传播进行量化。",
            "id": "4035064",
            "problem": "给定您的任务是，从一个网格化的风应力场计算均匀水平网格上与埃克曼抽吸相关的垂直速度，并将风应力反演的不确定性传播到最终垂直速度的不确定性中。您的推导和实现必须从稳态、Boussinesq、小罗斯贝数的水平动量平衡（包括科里奥利加速度和湍流应力的垂直散度）以及质量连续性方程开始。您不得假定任何简化公式；相反，您必须使用均匀网格上的有限差分法构建从风应力到埃克曼抽吸速度的离散算子。数值方法必须遵守以下约束：\n- 网格在 $x$ 和 $y$ 方向上是均匀的，间距分别为 $\\Delta x$ 和 $\\Delta y$，节点索引为 $i \\in \\{0,\\dots,n_x-1\\}$ 和 $j \\in \\{0,\\dots,n_y-1\\}$，位于 $x_i = i\\,\\Delta x$ 和 $y_j = j\\,\\Delta y$。\n- 对内部节点使用二阶精度中心差分来近似 $\\partial/\\partial x$ 和 $\\partial/\\partial y$，在边界处使用三点格式的二阶精度单边差分：\n  - 在西部边界 $i=0$ 处：$\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i=0} \\approx \\dfrac{-3\\phi_{0,j} + 4\\phi_{1,j} - \\phi_{2,j}}{2\\Delta x}$。\n  - 在东部边界 $i=n_x-1$ 处：$\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i=n_x-1} \\approx \\dfrac{3\\phi_{n_x-1,j} - 4\\phi_{n_x-2,j} + \\phi_{n_x-3,j}}{2\\Delta x}$。\n  - 在南部边界 $j=0$ 处：$\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{j=0} \\approx \\dfrac{-3\\phi_{i,0} + 4\\phi_{i,1} - \\phi_{i,2}}{2\\Delta y}$。\n  - 在北部边界 $j=n_y-1$ 处：$\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{j=n_y-1} \\approx \\dfrac{3\\phi_{i,n_y-1} - 4\\phi_{i,n_y-2} + \\phi_{i,n_y-3}}{2\\Delta y}$。\n  - 对于内部节点，使用 $\\left.\\dfrac{\\partial \\phi}{\\partial x}\\right|_{i,j} \\approx \\dfrac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}$ 和 $\\left.\\dfrac{\\partial \\phi}{\\partial y}\\right|_{i,j} \\approx \\dfrac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}$。\n- 假设表面垂直速度为零，因此埃克曼层底部的垂直速度是积分埃克曼输送的散度，并且在地转平衡下，内部流是无辐散的。假设在每个测试案例中密度和科里奥利参数都是恒定的。\n\n不确定性传播要求：\n- 每个网格节点 $i,j$ 都与纬向和经向风应力分量 $\\tau_x(i,j)$ 和 $\\tau_y(i,j)$ 的一倍标准差不确定度 $\\sigma_{\\tau_x}(i,j)$ 和 $\\sigma_{\\tau_y}(i,j)$ 相关联，两者都以 $\\mathrm{N\\,m^{-2}}$ 表示。\n- 将所有风应力反演误差视为在分量之间和网格点之间相互不相关。在此独立性假设和从 $\\boldsymbol{\\tau}$到 $w_E$ 的映射线性化的前提下，通过将格式系数的平方乘以局部方差后求和，来传播通过离散导数格式的不确定性。\n- 使用与平均场导数相同的有限差分格式进行不确定性传播。\n\n为每个测试案例计算：\n- 区域平均埃克曼抽吸速度 $\\overline{w_E}$，单位为 $\\mathrm{m\\,s^{-1}}$。\n- 区域埃克曼抽吸速度的均方根 $\\mathrm{RMS}(w_E) = \\sqrt{\\langle w_E^2\\rangle}$，单位为 $\\mathrm{m\\,s^{-1}}$。\n- 一倍标准差不确定度场的区域平均值 $\\overline{\\sigma_{w_E}}$，单位为 $\\mathrm{m\\,s^{-1}}$。\n- 一倍标准差不确定度场的区域均方根 $\\mathrm{RMS}(\\sigma_{w_E}) = \\sqrt{\\langle \\sigma_{w_E}^2\\rangle}$，单位为 $\\mathrm{m\\,s^{-1}}$。\n\n所有输出必须使用国际单位制（SI）表示。所有速度均以 $\\mathrm{m\\,s^{-1}}$ 报告。不要报告百分比。\n\n测试套件：\n您必须实现您的程序，为以下三种情况计算所需的量。在所有情况下，使用 $\\rho = 1025\\,\\mathrm{kg\\,m^{-3}}$。\n\n- 案例A（正弦应力，中纬度，均匀不确定性）：\n  - 网格：$n_x = 64$，$n_y = 64$，$\\Delta x = 25{,}000\\,\\mathrm{m}$，$\\Delta y = 25{,}000\\,\\mathrm{m}$。\n  - 科里奥利参数：$f = 1.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$。\n  - 定义 $L_x = n_x \\Delta x$，$L_y = n_y \\Delta y$，$k_x = \\dfrac{2\\pi}{L_x}$，$k_y = \\dfrac{2\\pi}{L_y}$，以及 $\\tau_0 = 0.2\\,\\mathrm{N\\,m^{-2}}$。\n  - 风应力场：$\\tau_x(i,j) = \\tau_0 \\cos(k_x x_i)\\cos(k_y y_j)$ 和 $\\tau_y(i,j) = \\tau_0 \\sin(k_x x_i)\\sin(k_y y_j)$。\n  - 不确定性：对于所有 $i,j$，$\\sigma_{\\tau_x}(i,j) = 0.02\\,\\mathrm{N\\,m^{-2}}$ 和 $\\sigma_{\\tau_y}(i,j) = 0.02\\,\\mathrm{N\\,m^{-2}}$。\n\n- 案例B（均匀应力，南半球，均匀不确定性；测试符号和边界格式）：\n  - 网格：$n_x = 7$，$n_y = 9$，$\\Delta x = 50{,}000\\,\\mathrm{m}$，$\\Delta y = 40{,}000\\,\\mathrm{m}$。\n  - 科里奥利参数：$f = -8.0\\times 10^{-5}\\,\\mathrm{s^{-1}}$。\n  - 风应力场：对于所有 $i,j$，$\\tau_x(i,j) = 0.2\\,\\mathrm{N\\,m^{-2}}$，$\\tau_y(i,j) = -0.1\\,\\mathrm{N\\,m^{-2}}$。\n  - 不确定性：对于所有 $i,j$，$\\sigma_{\\tau_x}(i,j) = 0.03\\,\\mathrm{N\\,m^{-2}}$，$\\sigma_{\\tau_y}(i,j) = 0.03\\,\\mathrm{N\\,m^{-2}}$。\n\n- 案例C（交叉射流，近赤道 $f$，空间变化的不确定性）：\n  - 网格：$n_x = 11$，$n_y = 11$，$\\Delta x = 30{,}000\\,\\mathrm{m}$，$\\Delta y = 40{,}000\\,\\mathrm{m}$。\n  - 科里奥利参数：$f = 1.2\\times 10^{-5}\\,\\mathrm{s^{-1}}$。\n  - 定义中心 $x_0 = \\dfrac{(n_x-1)\\Delta x}{2}$，$y_0 = \\dfrac{(n_y-1)\\Delta y}{2}$，尺度 $s_x = 3\\Delta x$，$s_y = 2\\Delta y$，振幅 $A = 0.3\\,\\mathrm{N\\,m^{-2}}$，$B = -0.15\\,\\mathrm{N\\,m^{-2}}$。\n  - 风应力场：$\\tau_x(i,j) = A \\exp\\!\\left(-\\dfrac{(y_j - y_0)^2}{2 s_y^2}\\right)$ 和 $\\tau_y(i,j) = B \\exp\\!\\left(-\\dfrac{(x_i - x_0)^2}{2 s_x^2}\\right)$。\n  - 不确定性：设 $L_x = n_x \\Delta x$，$L_y = n_y \\Delta y$。设置 $\\sigma_{\\tau_x}(i,j) = 0.02 + 0.01 \\sin\\!\\left(\\dfrac{2\\pi x_i}{L_x}\\right)\\cos\\!\\left(\\dfrac{2\\pi y_j}{L_y}\\right)$ 和 $\\sigma_{\\tau_y}(i,j) = 0.025 + 0.005 \\cos\\!\\left(\\dfrac{2\\pi x_i}{L_x}\\right)\\sin\\!\\left(\\dfrac{2\\pi y_j}{L_y}\\right)$，两者单位均为 $\\mathrm{N\\,m^{-2}}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含三个案例的结果，形式为一个逗号分隔的子列表列表，每个子列表包含四个浮点数，顺序为 $[\\overline{w_E}, \\mathrm{RMS}(w_E), \\overline{\\sigma_{w_E}}, \\mathrm{RMS}(\\sigma_{w_E})]$，所有数值的单位均为 $\\mathrm{m\\,s^{-1}}$。\n- 该单行输出必须严格遵循以下格式：\n  \"[[caseA_mean,caseA_rms,caseA_mean_sigma,caseA_rms_sigma],[caseB_mean,caseB_rms,caseB_mean_sigma,caseB_rms_sigma],[caseC_mean,caseC_rms,caseC_mean_sigma,caseC_rms_sigma]]\"\n前后不得有任何附加文本。",
            "solution": "用户的请求是一个有效且定义良好的科学问题。所有必要的数据、物理常数和边界条件都已提供，并且问题基于地球物理流体动力学的既定原理。\n\n### 1. 理论推导\n\n埃克曼抽吸速度 $w_E$ 的推导始于旋转参考系中的稳态、Boussinesq、小罗斯贝数水平动量方程。平衡关系存在于科里奥利力与湍流应力的垂直散度之间：\n$$\n-f v = \\frac{1}{\\rho} \\frac{\\partial \\tau_x}{\\partial z} \\\\\nf u = \\frac{1}{\\rho} \\frac{\\partial \\tau_y}{\\partial z}\n$$\n这里，$u$ 和 $v$ 分别是 $x$ 和 $y$ 方向上的水平速度分量。科里奥利参数是 $f$，水的密度是 $\\rho$（假定为常数），$\\tau_x$ 和 $\\tau_y$ 是湍流应力矢量的水平分量。\n\n我们将这些方程从表面埃克曼层的底部 $z = -H_E$（假定湍流应力在此处消失）到海面 $z=0$ 进行垂直积分。在海面，应力等于风应力，$\\boldsymbol{\\tau}^s = (\\tau_x^s, \\tau_y^s)$。\n$$\n\\int_{-H_E}^{0} -f v \\, dz = \\frac{1}{\\rho} \\int_{-H_E}^{0} \\frac{\\partial \\tau_x}{\\partial z} dz = \\frac{1}{\\rho} \\left[ \\tau_x(0) - \\tau_x(-H_E) \\right] = \\frac{\\tau_x^s}{\\rho} \\\\\n\\int_{-H_E}^{0} f u \\, dz = \\frac{1}{\\rho} \\int_{-H_E}^{0} \\frac{\\partial \\tau_y}{\\partial z} dz = \\frac{1}{\\rho} \\left[ \\tau_y(0) - \\tau_y(-H_E) \\right] = \\frac{\\tau_y^s}{\\rho}\n$$\n垂直积分的水平速度定义了埃克曼输送分量，$U_E = \\int_{-H_E}^{0} u \\, dz$ 和 $V_E = \\int_{-H_E}^{0} v \\, dz$。对于恒定的科里奥利参数 $f$，积分后的动量方程得出埃克曼输送：\n$$\n-f V_E = \\frac{\\tau_x^s}{\\rho} \\implies V_E = -\\frac{\\tau_x^s}{\\rho f} \\\\\nf U_E = \\frac{\\tau_y^s}{\\rho} \\implies U_E = \\frac{\\tau_y^s}{\\rho f}\n$$\n接下来，我们使用不可压缩流体的质量连续性原理：\n$$\n\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} + \\frac{\\partial w}{\\partial z} = 0\n$$\n将此方程在埃克曼层上进行垂直积分得到：\n$$\n\\int_{-H_E}^{0} \\left( \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} \\right) dz + \\int_{-H_E}^{0} \\frac{\\partial w}{\\partial z} dz = 0\n$$\n交换水平散度项的积分和微分顺序，我们得到：\n$$\n\\frac{\\partial}{\\partial x} \\left( \\int_{-H_E}^{0} u \\, dz \\right) + \\frac{\\partial}{\\partial y} \\left( \\int_{-H_E}^{0} v \\, dz \\right) + \\left[ w(z=0) - w(z=-H_E) \\right] = 0\n$$\n这简化为埃克曼输送的散度：\n$$\n\\frac{\\partial U_E}{\\partial x} + \\frac{\\partial V_E}{\\partial y} + w(0) - w(-H_E) = 0\n$$\n问题规定海面的垂直速度为零，$w(0) = 0$。埃克曼层底部的垂直速度，$w_E \\equiv w(-H_E)$，即为埃克曼抽吸速度。因此：\n$$\nw_E = \\frac{\\partial U_E}{\\partial x} + \\frac{\\partial V_E}{\\partial y}\n$$\n用风应力分量（为简化起见，省略上标 $s$）表示 $U_E$ 和 $V_E$：\n$$\nw_E = \\frac{\\partial}{\\partial x}\\left(\\frac{\\tau_y}{\\rho f}\\right) + \\frac{\\partial}{\\partial y}\\left(-\\frac{\\tau_x}{\\rho f}\\right)\n$$\n由于在每个案例中 $\\rho$ 和 $f$ 都是常数，它们可以被提出来：\n$$\nw_E = \\frac{1}{\\rho f} \\left( \\frac{\\partial \\tau_y}{\\partial x} - \\frac{\\partial \\tau_x}{\\partial y} \\right)\n$$\n这个最终方程表明，埃克曼抽吸速度与风应力的旋度成正比。\n\n### 2. 数值离散化\n\n$w_E$ 的连续公式在一个间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀网格上进行离散化。偏导数使用问题中指定的有限差分格式来近似。设 $\\tau_x(i,j)$ 和 $\\tau_y(i,j)$ 为网格节点 $(i,j)$ 处的应力分量。埃克曼速度 $w_E(i,j)$ 为：\n$$\nw_E(i,j) = \\frac{1}{\\rho f} \\left( \\left.\\frac{\\partial \\tau_y}{\\partial x}\\right|_{i,j} - \\left.\\frac{\\partial \\tau_x}{\\partial y}\\right|_{i,j} \\right)\n$$\n导数使用二阶中心差分计算内部点（$1 \\le i \\le n_x-2$，$1 \\le j \\le n_y-2$），并使用二阶单边差分计算边界点（$i \\in \\{0, n_x-1\\}$ 或 $j \\in \\{0, n_y-1\\}$）。例如，项 $\\left.\\frac{\\partial \\tau_y}{\\partial x}\\right|_{i,j}$ 的计算方式如下：\n- 对于 $1 \\le i \\le n_x-2$：$\\dfrac{\\tau_y(i+1,j) - \\tau_y(i-1,j)}{2\\Delta x}$\n- 对于 $i=0$：$\\dfrac{-3\\tau_y(0,j) + 4\\tau_y(1,j) - \\tau_y(2,j)}{2\\Delta x}$\n- 对于 $i=n_x-1$：$\\dfrac{3\\tau_y(n_x-1,j) - 4\\tau_y(n_x-2,j) + \\tau_y(n_x-3,j)}{2\\Delta x}$\n\n对于 $\\left.\\frac{\\partial \\tau_x}{\\partial y}\\right|_{i,j}$ 使用类似的格式。在角点处，组合使用每个方向上相应的单边格式。\n\n### 3. 不确定性传播\n\n$w_E(i,j)$ 的计算是关于风应力场 $\\boldsymbol{\\tau}_x$ 和 $\\boldsymbol{\\tau}_y$ 的一个线性运算。我们可以写成：\n$$\nw_E(i,j) = \\sum_{k,l} C_{ijkl} \\tau_y(k,l) - \\sum_{k,l} D_{ijkl} \\tau_x(k,l)\n$$\n其中系数 $C$ 和 $D$ 源自有限差分格式和因子 $1/(\\rho f)$。例如，对于一个内部点 $(i,j)$，$\\tau_y$ 项的非零系数仅有 $C_{ij,i+1,j} = \\frac{1}{\\rho f \\cdot 2\\Delta x}$ 和 $C_{ij,i-1,j} = -\\frac{1}{\\rho f \\cdot 2\\Delta x}$。\n\n问题规定风应力的不确定性在分量间和网格点间是不相关的。对于独立随机变量的线性组合 $Y = \\sum a_k X_k$，其方差为 $\\sigma_Y^2 = \\sum a_k^2 \\sigma_{X_k}^2$。将此应用于我们的 $w_E(i,j)$ 公式，其方差 $\\sigma_{w_E}^2(i,j)$ 为：\n$$\n\\sigma_{w_E}^2(i,j) = \\sum_{k,l} \\left( \\frac{\\partial w_E(i,j)}{\\partial \\tau_y(k,l)} \\right)^2 \\sigma_{\\tau_y}^2(k,l) + \\sum_{k,l} \\left( \\frac{\\partial w_E(i,j)}{\\partial \\tau_x(k,l)} \\right)^2 \\sigma_{\\tau_x}^2(k,l)\n$$\n偏导数就是系数，所以：\n$$\n\\sigma_{w_E}^2(i,j) = \\sum_{k,l} C_{ijkl}^2 \\sigma_{\\tau_y}^2(k,l) + \\sum_{k,l} D_{ijkl}^2 \\sigma_{\\tau_x}^2(k,l)\n$$\n这等同于将每个导数的格式系数的平方乘以输入场的局部方差后求和，然后再将来自 $\\tau_x$ 和 $\\tau_y$ 项的贡献相加。对于一个内部点 $(i,j)$：\n$$\n\\sigma_{w_E}^2(i,j) = \\frac{1}{(\\rho f)^2} \\left[ \\frac{\\sigma_{\\tau_y}^2(i-1,j) + \\sigma_{\\tau_y}^2(i+1,j)}{(2\\Delta x)^2} + \\frac{\\sigma_{\\tau_x}^2(i,j-1) + \\sigma_{\\tau_x}^2(i,j+1)}{(2\\Delta y)^2} \\right]\n$$\n所需的一倍标准差不确定度是 $\\sigma_{w_E}(i,j) = \\sqrt{\\sigma_{w_E}^2(i,j)}$。\n\n### 4. 实现算法\n\n数值解是通过首先定义矢量化函数来实现的，这些函数用于一次性计算整个网格的空间导数和相应的方差传播。\n1. `gradient_x(phi, dx)`：使用切片来应用内部和边界格式，计算 $\\partial\\phi/\\partial x$。\n2. `gradient_y(phi, dy)`：类似地计算 $\\partial\\phi/\\partial y$。\n3. `variance_prop_dx(sigma_sq, dx)`：计算由 $\\partial/\\partial x$ 运算产生的方差项，即 $\\sum c^2 \\sigma^2$。\n4. `variance_prop_dy(sigma_sq, dy)`：计算 $\\partial/\\partial y$ 运算的方差项。\n\n对于每个测试案例：\n1. 使用网格参数（$n_x, n_y, \\Delta x, \\Delta y$）、物理常数（$\\rho, f$）和风应力场定义来生成 $\\tau_x, \\tau_y, \\sigma_{\\tau_x}, \\sigma_{\\tau_y}$ 的二维数组。\n2. 埃克曼抽吸场 $w_E$ 计算为 `(gradient_x(tau_y, dx) - gradient_y(tau_x, dy)) / (rho * f)`。\n3. 计算输入方差场 $\\sigma_{\\tau_x}^2$ 和 $\\sigma_{\\tau_y}^2$。\n4. 埃克曼抽吸的方差 $\\sigma_{w_E}^2$ 计算为 `(variance_prop_dx(sigma_tau_y**2, dx) + variance_prop_dy(sigma_tau_x**2, dy)) / (rho * f)**2`。\n5. 标准差场为 $\\sigma_{w_E} = \\sqrt{\\sigma_{w_E}^2}$。\n6. 在整个网格上计算四个所需的统计量：$w_E$ 的区域平均值， $w_E$ 的 $\\mathrm{RMS}$ 值，$ \\sigma_{w_E}$ 的区域平均值，以及 $\\sigma_{w_E}$ 的 $\\mathrm{RMS}$ 值。\n7. 收集所有三个案例的结果，并将其格式化为所需的单行字符串输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Ekman pumping problem for all test cases.\n    \"\"\"\n\n    def gradient_x(phi, dx):\n        \"\"\"Computes d/dx of a 2D field phi using specified finite differences.\"\"\"\n        ny, nx = phi.shape\n        dphi_dx = np.zeros_like(phi)\n\n        # Interior points (second-order centered)\n        if nx > 2:\n            dphi_dx[:, 1:-1] = (phi[:, 2:] - phi[:, :-2]) / (2.0 * dx)\n        \n        # Boundary i=0 (western, second-order forward)\n        if nx > 2:\n            dphi_dx[:, 0] = (-3.0 * phi[:, 0] + 4.0 * phi[:, 1] - phi[:, 2]) / (2.0 * dx)\n\n        # Boundary i=nx-1 (eastern, second-order backward)\n        if nx > 2:\n            dphi_dx[:, -1] = (3.0 * phi[:, -1] - 4.0 * phi[:, -2] + phi[:, -3]) / (2.0 * dx)\n        \n        return dphi_dx\n\n    def gradient_y(phi, dy):\n        \"\"\"Computes d/dy of a 2D field phi using specified finite differences.\"\"\"\n        ny, nx = phi.shape\n        dphi_dy = np.zeros_like(phi)\n\n        # Interior points (second-order centered)\n        if ny > 2:\n            dphi_dy[1:-1, :] = (phi[2:, :] - phi[:-2, :]) / (2.0 * dy)\n            \n        # Boundary j=0 (southern, second-order forward)\n        if ny > 2:\n            dphi_dy[0, :] = (-3.0 * phi[0, :] + 4.0 * phi[1, :] - phi[2, :]) / (2.0 * dy)\n\n        # Boundary j=ny-1 (northern, second-order backward)\n        if ny > 2:\n            dphi_dy[-1, :] = (3.0 * phi[-1, :] - 4.0 * phi[-2, :] + phi[-3, :]) / (2.0 * dy)\n        \n        return dphi_dy\n\n    def variance_prop_dx(sigma_sq, dx):\n        \"\"\"Propagates variance through the d/dx operator.\"\"\"\n        ny, nx = sigma_sq.shape\n        var_contrib = np.zeros_like(sigma_sq)\n        \n        # Interior points\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, 1:-1] = c_sq * (sigma_sq[:, 2:] + sigma_sq[:, :-2])\n\n        # Western boundary\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, 0] = c_sq * ((-3.0)**2 * sigma_sq[:, 0] + (4.0)**2 * sigma_sq[:, 1] + (-1.0)**2 * sigma_sq[:, 2])\n\n        # Eastern boundary\n        if nx > 2:\n            c_sq = 1.0 / (2.0 * dx)**2\n            var_contrib[:, -1] = c_sq * ((3.0)**2 * sigma_sq[:, -1] + (-4.0)**2 * sigma_sq[:, -2] + (1.0)**2 * sigma_sq[:, -3])\n            \n        return var_contrib\n\n    def variance_prop_dy(sigma_sq, dy):\n        \"\"\"Propagates variance through the d/dy operator.\"\"\"\n        ny, nx = sigma_sq.shape\n        var_contrib = np.zeros_like(sigma_sq)\n\n        # Interior points\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[1:-1, :] = c_sq * (sigma_sq[2:, :] + sigma_sq[:-2, :])\n        \n        # Southern boundary\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[0, :] = c_sq * ((-3.0)**2 * sigma_sq[0, :] + (4.0)**2 * sigma_sq[1, :] + (-1.0)**2 * sigma_sq[2, :])\n        \n        # Northern boundary\n        if ny > 2:\n            c_sq = 1.0 / (2.0 * dy)**2\n            var_contrib[-1, :] = c_sq * ((3.0)**2 * sigma_sq[-1, :] + (-4.0)**2 * sigma_sq[-2, :] + (1.0)**2 * sigma_sq[-3, :])\n            \n        return var_contrib\n        \n    def calculate_case(params):\n        \"\"\"Computes all required quantities for a single test case.\"\"\"\n        nx, ny = params['nx'], params['ny']\n        dx, dy = params['dx'], params['dy']\n        f = params['f']\n        rho = 1025.0\n\n        # Create grid coordinates\n        x = np.arange(nx) * dx\n        y = np.arange(ny) * dy\n        xx, yy = np.meshgrid(x, y, indexing='ij')\n        \n        # Transpose to match (ny, nx) indexing for phi[j,i]\n        xx = xx.T \n        yy = yy.T\n\n        # Generate stress and uncertainty fields based on case type\n        if params['id'] == 'A':\n            Lx, Ly = nx * dx, ny * dy\n            kx, ky = 2.0 * np.pi / Lx, 2.0 * np.pi / Ly\n            tau0 = 0.2\n            tau_x = tau0 * np.cos(kx * xx) * np.cos(ky * yy)\n            tau_y = tau0 * np.sin(kx * xx) * np.sin(ky * yy)\n            sigma_tau_x = np.full((ny, nx), 0.02)\n            sigma_tau_y = np.full((ny, nx), 0.02)\n        elif params['id'] == 'B':\n            tau_x = np.full((ny, nx), 0.2)\n            tau_y = np.full((ny, nx), -0.1)\n            sigma_tau_x = np.full((ny, nx), 0.03)\n            sigma_tau_y = np.full((ny, nx), 0.03)\n        elif params['id'] == 'C':\n            x0, y0 = (nx - 1) * dx / 2.0, (ny - 1) * dy / 2.0\n            sx, sy = 3.0 * dx, 2.0 * dy\n            A, B = 0.3, -0.15\n            tau_x = A * np.exp(-((yy - y0)**2) / (2.0 * sy**2))\n            tau_y = B * np.exp(-((xx - x0)**2) / (2.0 * sx**2))\n            \n            Lx, Ly = nx * dx, ny * dy\n            sigma_tau_x = 0.02 + 0.01 * np.sin(2*np.pi * xx / Lx) * np.cos(2*np.pi * yy / Ly)\n            sigma_tau_y = 0.025 + 0.005 * np.cos(2*np.pi * xx / Lx) * np.sin(2*np.pi * yy / Ly)\n\n        # Calculate Ekman pumping velocity\n        dtauy_dx = gradient_x(tau_y, dx)\n        dtaux_dy = gradient_y(tau_x, dy)\n        w_E = (dtauy_dx - dtaux_dy) / (rho * f)\n\n        # Propagate uncertainties\n        sigma_tau_x_sq = sigma_tau_x**2\n        sigma_tau_y_sq = sigma_tau_y**2\n        var_from_tau_y = variance_prop_dx(sigma_tau_y_sq, dx)\n        var_from_tau_x = variance_prop_dy(sigma_tau_x_sq, dy)\n        sigma_w_E_sq = (var_from_tau_y + var_from_tau_x) / (rho * f)**2\n        sigma_w_E = np.sqrt(sigma_w_E_sq)\n\n        # Compute statistics\n        mean_w_E = np.mean(w_E)\n        rms_w_E = np.sqrt(np.mean(w_E**2))\n        mean_sigma_w_E = np.mean(sigma_w_E)\n        rms_sigma_w_E = np.sqrt(np.mean(sigma_w_E**2))\n\n        return [mean_w_E, rms_w_E, mean_sigma_w_E, rms_sigma_w_E]\n\n    test_cases = [\n        {'id': 'A', 'nx': 64, 'ny': 64, 'dx': 25000.0, 'dy': 25000.0, 'f': 1.0e-4},\n        {'id': 'B', 'nx': 7, 'ny': 9, 'dx': 50000.0, 'dy': 40000.0, 'f': -8.0e-5},\n        {'id': 'C', 'nx': 11, 'ny': 11, 'dx': 30000.0, 'dy': 40000.0, 'f': 1.2e-5}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result_list = calculate_case(case)\n        all_results.append(result_list)\n    \n    formatted_results = []\n    for res_list in all_results:\n        # Format list to string '[v1,v2,v3,v4]' without spaces\n        inner_str = f\"[{res_list[0]},{res_list[1]},{res_list[2]},{res_list[3]}]\"\n        formatted_results.append(inner_str)\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}