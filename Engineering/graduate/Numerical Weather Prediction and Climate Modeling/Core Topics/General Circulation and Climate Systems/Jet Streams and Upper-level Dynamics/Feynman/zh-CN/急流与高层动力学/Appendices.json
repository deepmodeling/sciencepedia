{
    "hands_on_practices": [
        {
            "introduction": "中纬度急流的主要驱动力是赤道与两极之间的经向温度梯度。本练习  将通过热成风关系，将这种基本的热力结构与风的垂直切变联系起来，从而让我们能够从第一性原理出发估算急流的强度。这是理解对流层高层为何存在强风带的基石。",
            "id": "4056209",
            "problem": "考虑一个位于纬度 $\\phi = 30^{\\circ} \\mathrm{N}$、气压介于 $p_{1} = 700\\,\\mathrm{hPa}$ 和 $p_{2} = 200\\,\\mathrm{hPa}$ 之间的 $f$ 平面上、处于准水平平衡状态的纬向对称副热带对流层。假设该层内存在一个均匀的经向温度梯度 $\\partial T / \\partial y = -5\\,\\mathrm{K}/1000\\,\\mathrm{km}$，该梯度不随气压变化，且温度向极地递减（负的经向梯度）。流动处于地转平衡状态，且大气是静力的、干燥的、无粘性的。将科里奥利参数 $f$ 在该层和纬度圈上视为常数，其值为 $f = 7.3 \\times 10^{-5}\\,\\mathrm{s}^{-1}$，并使用干空气比气体常数 $R_{d} = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$。在此纬度上，取 $700\\,\\mathrm{hPa}$ 处的纬向地转风为向东 $10\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$。\n\n从气压坐标系中的静力平衡和地转平衡这两个基本平衡关系出发，并且不使用任何预先给出的简化关系，推导一个用 $R_{d}$、$f$、$\\partial T/\\partial y$、$p_{1}$ 和 $p_{2}$ 表示的、$p_{1}$ 和 $p_{2}$ 之间纬向地转风的层内积分垂直切变表达式。用此表达式计算 $700\\,\\mathrm{hPa}$ 和 $200\\,\\mathrm{hPa}$ 之间纬向风的变化，并估计 $\\phi = 30^{\\circ} \\mathrm{N}$ 处 $200\\,\\mathrm{hPa}$ 的副热带急流核心速度。\n\n最终答案以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位，并四舍五入到四位有效数字。仅报告估计的 $200\\,\\mathrm{hPa}$ 急流核心速度作为最终答案。",
            "solution": "我们从适用于大尺度对流层高层流动的两个基本平衡关系开始：地转平衡和静力平衡，两者均在气压坐标系中表示。设 $\\Phi$ 表示位势，$\\mathbf{v}_{g}$ 表示地转风，$u_{g}$ 表示其纬向分量。\n\n气压坐标系中的地转平衡可以写成\n$$\nf\\,\\hat{\\mathbf{k}} \\times \\mathbf{v}_{g} = \\nabla_{p} \\Phi,\n$$\n对于纬向分量，这意味着\n$$\nu_{g} = -\\frac{1}{f}\\,\\frac{\\partial \\Phi}{\\partial y}.\n$$\n气压坐标系中的静力平衡是\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\alpha,\n$$\n其中 $\\alpha$ 是比容。对于干理想气体，$\\alpha = \\frac{R_{d} T}{p}$，因此\n$$\n\\frac{\\partial \\Phi}{\\partial p} = -\\frac{R_{d} T}{p}.\n$$\n\n为了得到气压坐标系中纬向地转风的垂直切变，将 $u_{g}$ 对 $p$ 求导，同时保持 $(x,y)$ 固定：\n$$\n\\frac{\\partial u_{g}}{\\partial p} = -\\frac{1}{f}\\,\\frac{\\partial}{\\partial p}\\left(\\frac{\\partial \\Phi}{\\partial y}\\right).\n$$\n假设函数足够光滑以交换微分顺序，\n$$\n\\frac{\\partial u_{g}}{\\partial p} = -\\frac{1}{f}\\,\\frac{\\partial}{\\partial y}\\left(\\frac{\\partial \\Phi}{\\partial p}\\right) = -\\frac{1}{f}\\,\\frac{\\partial}{\\partial y}\\left(-\\frac{R_{d} T}{p}\\right) = \\frac{R_{d}}{f\\,p}\\,\\frac{\\partial T}{\\partial y}.\n$$\n\n沿着同一纬度圈，将此切变从 $p_{1} = 700\\,\\mathrm{hPa}$ 积分到 $p_{2} = 200\\,\\mathrm{hPa}$，并假设经向温度梯度在该层内不随气压变化：\n$$\nu_{g}(p_{2}) - u_{g}(p_{1}) = \\int_{p_{1}}^{p_{2}} \\frac{R_{d}}{f\\,p}\\,\\frac{\\partial T}{\\partial y}\\,dp = \\frac{R_{d}}{f}\\,\\frac{\\partial T}{\\partial y}\\int_{p_{1}}^{p_{2}} \\frac{1}{p}\\,dp = \\frac{R_{d}}{f}\\,\\frac{\\partial T}{\\partial y}\\,\\ln\\!\\left(\\frac{p_{2}}{p_{1}}\\right).\n$$\n\n现在我们使用给定的数值来计算这个表达式。将经向温度梯度转换为国际单位制：\n$$\n\\frac{\\partial T}{\\partial y} = -5\\,\\mathrm{K}/1000\\,\\mathrm{km} = -5 \\times 10^{-6}\\,\\mathrm{K}\\,\\mathrm{m}^{-1}.\n$$\n使用 $R_{d} = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$ 和 $f = 7.3 \\times 10^{-5}\\,\\mathrm{s}^{-1}$。气压比为\n$$\n\\frac{p_{2}}{p_{1}} = \\frac{200\\,\\mathrm{hPa}}{700\\,\\mathrm{hPa}} = \\frac{200}{700},\n$$\n所以\n$$\n\\ln\\!\\left(\\frac{p_{2}}{p_{1}}\\right) = \\ln\\!\\left(\\frac{200}{700}\\right) = \\ln(2) - \\ln(7) \\approx 0.6931471806 - 1.9459101491 \\approx -1.2527629685.\n$$\n\n计算层内积分切变 $\\Delta u \\equiv u_{g}(p_{2}) - u_{g}(p_{1})$：\n$$\n\\Delta u = \\frac{R_{d}}{f}\\,\\frac{\\partial T}{\\partial y}\\,\\ln\\!\\left(\\frac{p_{2}}{p_{1}}\\right) = \\left(\\frac{287}{7.3 \\times 10^{-5}}\\right)\\left(-5 \\times 10^{-6}\\right)\\left(-1.2527629685\\right).\n$$\n首先计算因子 $\\frac{R_{d}}{f}$：\n$$\n\\frac{R_{d}}{f} = \\frac{287}{7.3 \\times 10^{-5}} \\approx 3.93150685 \\times 10^{6}.\n$$\n乘以温度梯度：\n$$\n\\left(\\frac{R_{d}}{f}\\right)\\left(\\frac{\\partial T}{\\partial y}\\right) \\approx \\left(3.93150685 \\times 10^{6}\\right)\\left(-5 \\times 10^{-6}\\right) \\approx -19.6575343.\n$$\n最后乘以对数因子：\n$$\n\\Delta u \\approx \\left(-19.6575343\\right)\\left(-1.2527629685\\right) \\approx 24.6262309.\n$$\n\n在北半球，负的经向温度梯度导致纬向风随着气压降低而正向（向东）增加，这与高空的副热带急流相符。已知 $700\\,\\mathrm{hPa}$ 处的纬向地转风为 $u_{g}(p_{1}) = 10\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$（向东），则 $200\\,\\mathrm{hPa}$ 的急流核心速度为\n$$\nu_{g}(p_{2}) = u_{g}(p_{1}) + \\Delta u \\approx 10 + 24.6262309 \\approx 34.6262309\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$\n四舍五入到四位有效数字，并以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位表示，估计的 $200\\,\\mathrm{hPa}$ 副热带急流核心速度为\n$$\n34.63\\,\\mathrm{m}\\,\\mathrm{s}^{-1}.\n$$",
            "answer": "$$\\boxed{34.63}$$"
        },
        {
            "introduction": "平直的纬向急流只是一种理想化的状态。真实的急流会蜿蜒并形成波动，这些波动是天气系统的种子。本练习  探讨了正压不稳定性的概念，揭示了急流自身的水平风切变如何成为一种不稳定的来源，导致罗斯贝波的增长和纬向气流的崩溃。",
            "id": "4056214",
            "problem": "考虑在地球的常纬度近似（即所谓的β平面）上的一个中纬度流，其中科里奥利参数的经向梯度是一个正常数 $\\beta > 0$。假设存在一个正压、纬向对称的急流，其经向廓线为 $U(y) = U_0 \\exp\\!\\big(-y^2/L^2\\big)$，对所有 $y \\in \\mathbb{R}$ 均有效，其中 $U_0$ 是急流峰值速度，$L$ 是描述急流经向宽度的水平长度尺度。\n\n从正压准地转（QG）框架出发，利用 QG 位涡的定义 $q = \\nabla^2 \\psi + f$（其中 $f = f_0 + \\beta y$）以及纬向风和流函数之间的地转关系 $U(y) = -\\partial \\psi/\\partial y$，推导以背景位涡的经向梯度表示的正压不稳定的必要条件。然后将此条件应用于给定的急流廓线，以确定最小急流振幅 $U_0^{\\mathrm{crit}}$，使得该必要条件在区域内的某处被临界满足。\n\n请将 $U_0^{\\mathrm{crit}}$ 的最终答案表示为一个以米/秒为单位的闭式解析表达式。无需进行数值四舍五入。在你的推导中，简要说明超过此阈值对高层气流中罗斯贝波增长可能性的影响。",
            "solution": "本问题要求在准地转（QG）框架内推导正压不稳定的必要条件，并将其应用于特定的纬向急流廓线以求出临界急流振幅。\n\n首先，我们建立正压不稳定的必要条件，即瑞利-郭氏判据（Rayleigh-Kuo criterion）。正压准地转动力学的控制方程是 QG 位涡（PV）$q$ 沿着地转流的守恒：\n$$\n\\frac{Dq}{Dt} = \\frac{\\partial q}{\\partial t} + u_g \\frac{\\partial q}{\\partial x} + v_g \\frac{\\partial q}{\\partial y} = 0\n$$\nQG 位涡定义为 $q = \\nabla^2 \\psi + f$，其中 $\\psi$ 是地转流函数，$f$ 是科里奥利参数。在β平面上，$f = f_0 + \\beta y$，其中 $f_0$ 和 $\\beta$ 是常数。\n\n我们考虑一个由纯纬向流 $U(y)$ 组成的基本态，该流与流函数 $\\Psi(y)$ 处于地转平衡状态，使得 $U(y) = -\\frac{d\\Psi}{dy}$。那么背景位涡 $Q(y)$ 为：\n$$\nQ(y) = \\nabla^2 \\Psi(y) + f = \\frac{d^2\\Psi}{dy^2} + f_0 + \\beta y\n$$\n利用地转关系，我们可以用纬向流表示流函数的二阶导数：$\\frac{d^2\\Psi}{dy^2} = -\\frac{dU}{dy}$。将其代入 $Q(y)$ 的表达式中，得到：\n$$\nQ(y) = -\\frac{dU}{dy} + f_0 + \\beta y\n$$\n这个基本态的稳定性由背景位涡的经向梯度 $\\frac{dQ}{dy}$ 决定：\n$$\n\\frac{dQ}{dy} = \\frac{d}{dy}\\left(-\\frac{dU}{dy} + f_0 + \\beta y\\right) = \\beta - \\frac{d^2U}{dy^2}\n$$\n瑞利-郭氏定理（Rayleigh-Kuo theorem）指出，纬向流 $U(y)$ 发生正压不稳定的一个必要（但不充分）条件是，背景位涡的经向梯度 $\\frac{dQ}{dy}$ 必须在区域内的某处变号。由于对于一个在经向受限的急流，当 $|y| \\to \\infty$ 时，$U$ 及其导数必须趋于零，因此当 $|y| \\to \\infty$ 时，我们有 $\\frac{dQ}{dy} \\to \\beta$。给定 $\\beta > 0$，要使 $\\frac{dQ}{dy}$ 变号，它必须在至少一个 $y$ 值处变为负值。因此，不稳定的必要条件是存在某个 $y$ 使得：\n$$\n\\frac{dQ}{dy} = \\beta - \\frac{d^2U}{dy^2}  0 \\quad \\implies \\quad \\frac{d^2U}{dy^2} > \\beta\n$$\n\n接下来，我们将此条件应用于给定的急流廓线 $U(y) = U_0 \\exp\\left(-\\frac{y^2}{L^2}\\right)$。我们需要计算它关于 $y$ 的二阶导数：\n一阶导数为：\n$$\n\\frac{dU}{dy} = U_0 \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left(-\\frac{2y}{L^2}\\right) = -\\frac{2U_0 y}{L^2} \\exp\\left(-\\frac{y^2}{L^2}\\right)\n$$\n使用乘法法则求得二阶导数：\n$$\n\\frac{d^2U}{dy^2} = -\\frac{2U_0}{L^2} \\frac{d}{dy} \\left[y \\exp\\left(-\\frac{y^2}{L^2}\\right)\\right] = -\\frac{2U_0}{L^2} \\left[\\exp\\left(-\\frac{y^2}{L^2}\\right) + y \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left(-\\frac{2y}{L^2}\\right)\\right]\n$$\n$$\n\\frac{d^2U}{dy^2} = -\\frac{2U_0}{L^2} \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left(1 - \\frac{2y^2}{L^2}\\right) = \\frac{2U_0}{L^2} \\left(\\frac{2y^2}{L^2} - 1\\right) \\exp\\left(-\\frac{y^2}{L^2}\\right)\n$$\n不稳定的条件是 $\\frac{d^2U}{dy^2}$ 的最大值必须超过 $\\beta$。问题要求的是临界振幅 $U_0^{\\mathrm{crit}}$，在该振幅下条件被临界满足。这发生在 $\\frac{d^2U}{dy^2}$ 的最大值恰好等于 $\\beta$ 时：\n$$\n\\max_y \\left(\\frac{d^2U}{dy^2}\\right) = \\beta\n$$\n为了求 $\\frac{d^2U}{dy^2}$ 的最大值，我们将其导数（即 $U$ 的三阶导数）设为零。令 $F(y) = \\frac{d^2U}{dy^2}$。\n$$\n\\frac{dF}{dy} = \\frac{d^3U}{dy^3} = \\frac{2U_0}{L^2} \\frac{d}{dy}\\left[\\left(\\frac{2y^2}{L^2} - 1\\right) \\exp\\left(-\\frac{y^2}{L^2}\\right)\\right]\n$$\n$$\n\\frac{d^3U}{dy^3} = \\frac{2U_0}{L^2} \\left[ \\left(\\frac{4y}{L^2}\\right) \\exp\\left(-\\frac{y^2}{L^2}\\right) + \\left(\\frac{2y^2}{L^2} - 1\\right) \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left(-\\frac{2y}{L^2}\\right) \\right]\n$$\n$$\n\\frac{d^3U}{dy^3} = \\frac{4U_0 y}{L^4} \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left[ 2 - \\left(\\frac{2y^2}{L^2} - 1\\right) \\right] = \\frac{4U_0 y}{L^4} \\exp\\left(-\\frac{y^2}{L^2}\\right) \\left(3 - \\frac{2y^2}{L^2}\\right)\n$$\n令 $\\frac{d^3U}{dy^3} = 0$，得到驻点位于 $y=0$ 以及满足 $3 - \\frac{2y^2}{L^2} = 0$ 的 $y$ 值处。这给出 $y^2 = \\frac{3}{2}L^2$。\n我们计算 $\\frac{d^2U}{dy^2}$ 在这些点的值：\n在 $y=0$ 处：$\\frac{d^2U}{dy^2}\\Big|_{y=0} = \\frac{2U_0}{L^2} (-1) \\exp(0) = -\\frac{2U_0}{L^2}$。这是一个局部极小值。\n在 $y^2 = \\frac{3}{2}L^2$ 处：\n$$\n\\frac{d^2U}{dy^2}\\Big|_{y^2=\\frac{3}{2}L^2} = \\frac{2U_0}{L^2} \\left(\\frac{2}{L^2}\\left(\\frac{3}{2}L^2\\right) - 1\\right) \\exp\\left(-\\frac{3}{2}\\right) = \\frac{2U_0}{L^2} (3-1) \\exp\\left(-\\frac{3}{2}\\right) = \\frac{4U_0}{L^2} \\exp\\left(-\\frac{3}{2}\\right)\n$$\n这个正值是 $\\frac{d^2U}{dy^2}$ 的最大值。\n现在我们将这个最大值设为等于 $\\beta$，以求得临界急流振幅 $U_0^{\\mathrm{crit}}$：\n$$\n\\frac{4U_0^{\\mathrm{crit}}}{L^2} \\exp\\left(-\\frac{3}{2}\\right) = \\beta\n$$\n解出 $U_0^{\\mathrm{crit}}$ 可得：\n$$\nU_0^{\\mathrm{crit}} = \\frac{\\beta L^2}{4} \\exp\\left(\\frac{3}{2}\\right)\n$$\n单位是一致的：$\\beta$ 的单位是 $\\text{m}^{-1}\\text{s}^{-1}$，$L^2$ 的单位是 $\\text{m}^2$，所以 $U_0^{\\mathrm{crit}}$ 的单位是 $\\text{m s}^{-1}$。\n\n当急流振幅 $U_0$ 超过这个临界阈值 $U_0^{\\mathrm{crit}}$ 时，正压不稳定的必要条件就得到了满足。这意味着背景流可以支持罗斯贝波扰动的指数增长。这些增长的波从平均纬向急流中提取动能，导致纬向流分解为弯曲和涡旋，这是地球急流动力学中的一个基本过程。",
            "answer": "$$\n\\boxed{\\frac{\\beta L^2}{4} \\exp\\left(\\frac{3}{2}\\right)}\n$$"
        },
        {
            "introduction": "在急流上增长的波动和涡旋不仅仅是被动特征；它们主动地输送动量和热量，从而反过来塑造急流本身。这个高级练习  介绍了伊莱亚森-帕姆（EP）通量，这是一种强大的诊断工具，用于量化这种波流相互作用。通过计算EP通量散度，我们可以精确地确定涡旋在何处以及如何加速或减速平均纬向气流，从而揭示急流的维持机制。",
            "id": "4056177",
            "problem": "给定纬度-气压网格上的带状平均涡动协方差场，要求您在准地转转换欧拉平均 (TEM) 框架下计算 Eliassen-Palm (EP) 通量，然后识别出波动驱动带状风的区域。在纬度-气压网格上完全使用球坐标进行计算。其控制基础是球体上的准地转 TEM 公式。令 $a$ 表示地球半径，$\\Omega$ 表示地球自转速率，$\\phi$ 表示纬度，$p$ 表示气压，$\\overline{u}$ 表示带状平均纬向风，$\\overline{\\theta}$ 表示带状平均位温，$u'$ 表示纬向风涡动，$v'$ 表示经向风涡动，$\\theta'$ 表示位温涡动。科里奥利参数为 $f(\\phi) = 2 \\Omega \\sin\\phi$。\n\n从球体上的准地转转换欧拉平均动量方程和 Eliassen-Palm 通量 (EP 通量) 的定义出发，对带状平均纬向风的涡动强迫由 EP 通量的负散度给出。在气压坐标系下的准地转近似中，带状平均系统的 EP 通量分量为\n$$F_{\\phi}(\\phi,p) = a \\cos\\phi \\left( - \\overline{u'v'}(\\phi,p) \\right),$$\n$$F_{p}(\\phi,p) = a \\cos\\phi \\left( \\frac{ f(\\phi) \\, \\overline{v'\\theta'}(\\phi,p) }{ \\frac{\\partial \\overline{\\theta}(\\phi,p)}{\\partial p} } \\right),$$\n涡动对纬向风的加速度为\n$$A(\\phi,p) = - \\frac{1}{a \\cos\\phi} \\left( \\frac{\\partial}{\\partial \\phi} \\left[ F_{\\phi}(\\phi,p) \\cos\\phi \\right] + \\frac{\\partial F_{p}(\\phi,p)}{\\partial p} \\right).$$\n$f(\\phi)$ 中的角度以及关于 $\\phi$ 的导数必须以弧度为单位进行计算。导数 $\\frac{\\partial \\overline{\\theta}}{\\partial p}$ 是关于气压的，并且必须在每个纬度上进行计算。\n\n要求：\n- 使用 $a = 6.371 \\times 10^6$ 米和 $\\Omega = 7.2921 \\times 10^{-5}$ 每秒。\n- 纬度以度为单位提供；在用于三角函数或纬度导数计算前，需将其转换为弧度。任何关于纬度的导数的角度单位都是弧度。\n- 气压以帕斯卡 (Pascals) 为单位提供。\n- $\\overline{\\theta}$ 的单位是开尔文 (Kelvin)，$\\overline{u'v'}$ 的单位是平方米每平方秒 ($\\mathrm{m^2/s^2}$)，$\\overline{v'\\theta'}$ 的单位是开尔文·米每秒 ($\\mathrm{K \\cdot m/s}$)。\n- 使用有限差分计算所有偏导数：\n  - 对于固定纬度上的 $\\frac{\\partial \\overline{\\theta}}{\\partial p}$，对内部气压点使用中心差分，对顶部/底部边界使用单边前向/后向差分。\n  - 对于固定气压上的 $\\frac{\\partial}{\\partial \\phi}\\left[ F_{\\phi} \\cos\\phi \\right]$，对内部纬度使用中心差分，对边界使用单边前向/后向差分；纬度差值必须以弧度为单位。\n  - 对于固定纬度上的 $\\frac{\\partial F_p}{\\partial p}$，对内部气压使用中心差分，对边界使用单边前向/后向差分。\n- 按上述方法计算 $A(\\phi,p)$，然后乘以 $86400$ 将其转换为以天为单位的数值，以米/秒/天 ($\\mathrm{m/s/day}$) 表示。\n- 将 $A(\\phi,p)  0$ 的网格点识别为波动驱动区域。同时，计算每个纬度上的垂直平均加速度：\n  $$\\overline{A}_{\\mathrm{vert}}(\\phi) = \\frac{1}{N_p} \\sum_{j=1}^{N_p} A(\\phi,p_j),$$\n  其中 $N_p$ 是气压层数，求和是对该纬度上所有给定的气压层进行的。\n\n对于下方的每个测试用例，计算：\n1. $\\overline{A}_{\\mathrm{vert}}(\\phi)$ 达到最大值时的纬度 $\\phi^\\star$ (以度为单位)。如果多个纬度上的值相同，则选择升序排列中的第一个。\n2. 整个网格上 $A(\\phi,p)$ 的最大正值，单位为 $\\mathrm{m/s/day}$；如果没有正值，则返回 $0.0$。\n3. $A(\\phi,p)  0$ 的网格点所占的比例，表示为 $0$ 到 $1$ 之间的小数。\n\n将加速度量以 $\\mathrm{m/s/day}$ 为单位表示，四舍五入到三位小数。将纬度 $\\phi^\\star$ 以度为单位表示，四舍五入到一位小数。将 $A(\\phi,p)$ 为正的比例四舍五入到三位小数。\n\n测试套件：\n- 测试用例 1 (类中纬度风暴轴涡旋)：\n  - 纬度 (度)：$[15.0, 30.0, 45.0]$。\n  - 气压 (帕斯卡)：$[70000.0, 50000.0, 30000.0]$。\n  - 带状平均位温 $\\overline{\\theta}(\\phi,p)$ (开尔文)，以纬度-气压数组表示：\n    - 在 $\\phi = 15.0^\\circ$ 处：$[330.0, 340.0, 350.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[332.0, 342.0, 352.0]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[334.0, 344.0, 354.0]$。\n  - 涡动动量通量 $\\overline{u'v'}(\\phi,p)$ ($\\mathrm{m^2/s^2}$):\n    - 在 $\\phi = 15.0^\\circ$ 处：$[-10.0, -20.0, -10.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[-30.0, -60.0, -40.0]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[-50.0, -80.0, -60.0]$。\n  - 涡动经向热通量 $\\overline{v'\\theta'}(\\phi,p)$ ($\\mathrm{K \\cdot m/s}$):\n    - 在 $\\phi = 15.0^\\circ$ 处：$[0.2, 0.5, 0.4]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[1.0, 2.0, 1.5]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[1.5, 2.5, 2.0]$。\n- 测试用例 2 (包含 $f$ 值较小的赤道纬度)：\n  - 纬度 (度)：$[0.0, 15.0, 30.0]$。\n  - 气压 (帕斯卡)：$[70000.0, 50000.0, 30000.0]$。\n  - 带状平均位温 $\\overline{\\theta}(\\phi,p)$ (开尔文):\n    - 在 $\\phi = 0.0^\\circ$ 处：$[328.0, 338.0, 348.0]$。\n    - 在 $\\phi = 15.0^\\circ$ 处：$[330.0, 340.0, 350.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[334.0, 344.0, 354.0]$。\n  - 涡动动量通量 $\\overline{u'v'}(\\phi,p)$ ($\\mathrm{m^2/s^2}$):\n    - 在 $\\phi = 0.0^\\circ$ 处：$[-5.0, -10.0, -5.0]$。\n    - 在 $\\phi = 15.0^\\circ$ 处：$[-20.0, -30.0, -25.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[-40.0, -70.0, -50.0]$。\n  - 涡动经向热通量 $\\overline{v'\\theta'}(\\phi,p)$ ($\\mathrm{K \\cdot m/s}$):\n    - 在 $\\phi = 0.0^\\circ$ 处：$[0.3, 0.4, 0.3]$。\n    - 在 $\\phi = 15.0^\\circ$ 处：$[0.8, 1.5, 1.2]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[1.2, 2.2, 1.8]$。\n- 测试用例 3 (强层结减小垂直 EP 通量)：\n  - 纬度 (度)：$[15.0, 30.0, 45.0]$。\n  - 气压 (帕斯卡)：$[70000.0, 50000.0, 30000.0]$。\n  - 带状平均位温 $\\overline{\\theta}(\\phi,p)$ (开尔文):\n    - 在 $\\phi = 15.0^\\circ$ 处：$[330.0, 350.0, 370.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[332.0, 352.0, 372.0]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[334.0, 354.0, 374.0]$。\n  - 涡动动量通量 $\\overline{u'v'}(\\phi,p)$ ($\\mathrm{m^2/s^2}$):\n    - 在 $\\phi = 15.0^\\circ$ 处：$[-10.0, -20.0, -10.0]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[-30.0, -60.0, -40.0]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[-50.0, -80.0, -60.0]$。\n  - 涡动经向热通量 $\\overline{v'\\theta'}(\\phi,p)$ ($\\mathrm{K \\cdot m/s}$):\n    - 在 $\\phi = 15.0^\\circ$ 处：$[0.2, 0.5, 0.4]$。\n    - 在 $\\phi = 30.0^\\circ$ 处：$[1.0, 2.0, 1.5]$。\n    - 在 $\\phi = 45.0^\\circ$ 处：$[1.5, 2.5, 2.0]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表应按以下顺序包含 $9$ 个值：\n  - 测试用例 1：$\\phi^\\star$ (度，一位小数)，$\\max\\{A(\\phi,p) \\, \\text{单位为 m/s/day}\\}$ (三位小数)，A 为正的比例 (三位小数)。\n  - 测试用例 2：按相同顺序排列的三个相同值。\n  - 测试用例 3：按相同顺序排列的三个相同值。\n- 示例结构 (使用占位符值)：$\\left[\\phi^\\star_1, A_{\\max,1}, f_{+,1}, \\phi^\\star_2, A_{\\max,2}, f_{+,2}, \\phi^\\star_3, A_{\\max,3}, f_{+,3}\\right]$。\n\n确保所有计算具有科学真实性和内部一致性。不允许使用外部输入；所有数据必须如上所述嵌入程序中。",
            "solution": "用户提供了一个大气动力学领域内定义明确的问题。任务是使用转换欧拉平均 (TEM) 框架和 Eliassen-Palm (EP) 通量诊断来计算涡动引起的带状平均风加速度。该问题有科学依据，内部一致，并要求实现标准数值方法。我将根据所提供的方程和数据，逐步进行求解。\n\n总体步骤如下：\n1.  为每个测试用例定义物理常数和输入数据。\n2.  对每个测试用例的网格，计算必要的初步量：以弧度为单位的纬度 ($\\phi_{\\mathrm{rad}}$)、科里奥利参数 ($f$) 和纬度的余弦值 ($\\cos\\phi$)。\n3.  在每个网格点上计算静力稳定度参数 $\\frac{\\partial \\overline{\\theta}}{\\partial p}$。这需要计算关于气压 ($p$) 的数值导数。\n4.  使用提供的公式计算 EP 通量矢量 $\\mathbf{F}$ 的纬向 ($F_{\\phi}$) 和垂直 ($F_{p}$) 分量。\n5.  计算 EP 通量的散度 $\\nabla \\cdot \\mathbf{F}$。这涉及两个项：$\\frac{\\partial}{\\partial \\phi} \\left[ F_{\\phi} \\cos\\phi \\right]$ 和 $\\frac{\\partial F_{p}}{\\partial p}$。这些项需要分别计算关于纬度 ($\\phi$，以弧度为单位) 和气压 ($p$) 的数值导数。\n6.  使用提供的公式计算纬向风加速度 $A(\\phi,p)$，并将其单位从 $\\mathrm{m/s^2}$ 转换为 $\\mathrm{m/s/day}$。\n7.  从得到的加速度网格 $A(\\phi,p)$ 中，为每个测试用例计算三个所需的指标：\n    a. 垂直平均加速度 $\\overline{A}_{\\mathrm{vert}}(\\phi)$ 最大时的纬度 $\\phi^\\star$。\n    b. 整个网格上 $A(\\phi,p)$ 的最大正值。\n    c. $A(\\phi,p)  0$ 的网格点所占的比例。\n\n所有偏导数将按照规定使用有限差分计算：内部网格点使用中心差分，边界点使用单边 (前向或后向) 差分。\n\n让我们为一个任意网格详细说明数学步骤。\n\n**常数和坐标**\n- 地球半径：$a = 6.371 \\times 10^6 \\, \\mathrm{m}$\n- 地球自转速率：$\\Omega = 7.2921 \\times 10^{-5} \\, \\mathrm{s^{-1}}$\n- 纬度 $\\phi$ 以度为单位给出，在计算时转换为弧度：$\\phi_{\\mathrm{rad}} = \\phi_{\\mathrm{deg}} \\times \\frac{\\pi}{180}$。\n- 气压 $p$ 的单位是帕斯卡。\n\n**第 1 步：中间场**\n- 为每个纬度计算科里奥利参数：$f(\\phi) = 2 \\Omega \\sin(\\phi_{\\mathrm{rad}})$。\n- 在每个网格点 $(\\phi_i, p_j)$ 上的静力稳定度参数是沿等纬度线计算的带状平均位温 $\\overline{\\theta}$ 对气压 $p$ 的偏导数。在气压网格 $p_0, p_1, ..., p_{N_p-1}$ 上使用有限差分：\n  - 在顶部边界 ($j=0$)：$\\left(\\frac{\\partial \\overline{\\theta}}{\\partial p}\\right)_{i,0} = \\frac{\\overline{\\theta}_{i,1} - \\overline{\\theta}_{i,0}}{p_1 - p_0}$\n  - 在内部层 ($0  j  N_p-1$)：$\\left(\\frac{\\partial \\overline{\\theta}}{\\partial p}\\right)_{i,j} = \\frac{\\overline{\\theta}_{i,j+1} - \\overline{\\theta}_{i,j-1}}{p_{j+1} - p_{j-1}}$\n  - 在底部边界 ($j=N_p-1$)：$\\left(\\frac{\\partial \\overline{\\theta}}{\\partial p}\\right)_{i,N_p-1} = \\frac{\\overline{\\theta}_{i,N_p-1} - \\overline{\\theta}_{i,N_p-2}}{p_{N_p-1} - p_{N_p-2}}$\n\n**第 2 步：Eliassen-Palm 通量分量**\n在每个网格点 $(\\phi_i, p_j)$ 上计算 EP 通量分量：\n- 纬向分量：$F_{\\phi}(\\phi_i, p_j) = a \\cos(\\phi_i) \\left( - \\overline{u'v'}(\\phi_i, p_j) \\right)$\n- 垂直分量：$F_{p}(\\phi_i, p_j) = a \\cos(\\phi_i) \\left( \\frac{ f(\\phi_i) \\, \\overline{v'\\theta'}(\\phi_i, p_j) }{ \\left(\\frac{\\partial \\overline{\\theta}}{\\partial p}\\right)_{i,j} } \\right)$。注意，对于静力稳定大气，$\\frac{\\partial\\overline{\\theta}}{\\partial p}$ 为负值，这在物理上是现实的。\n\n**第 3 步：EP 通量散度**\n加速度 $A(\\phi,p)$ 与 EP 通量的散度成正比。我们分别计算散度的两个项。\n- **纬向散度项：** 首先，我们构造量 $G(\\phi, p) = F_{\\phi}(\\phi, p) \\cos\\phi$。然后，我们使用沿等压线的有限差分，在每个网格点上计算其关于纬度 (以弧度为单位) 的偏导数 $\\frac{\\partial G}{\\partial \\phi}$。\n- **垂直散度项：** 我们使用沿等纬线的有限差分，在每个网格点上计算垂直 EP 通量分量关于气压的偏导数 $\\frac{\\partial F_p}{\\partial p}$。\n\n**第 4 步：纬向风加速度**\n然后根据其定义计算涡动引起的加速度：\n$$\nA(\\phi,p) = - \\frac{1}{a \\cos\\phi} \\left( \\frac{\\partial G}{\\partial \\phi} + \\frac{\\partial F_{p}}{\\partial p} \\right)\n$$\n结果的单位是 $\\mathrm{m/s^2}$。我们通过乘以 $86400 \\, \\mathrm{s/day}$ 将其转换为 $\\mathrm{m/s/day}$。\n\n**第 5 步：最终指标**\n对于每个测试用例，从 $A(\\phi,p)$ 网格 (单位为 $\\mathrm{m/s/day}$) 中导出最终的三个指标：\n1.  **$\\phi^\\star$**：我们计算每个纬度上 A 的垂直平均值，$\\overline{A}_{\\mathrm{vert}}(\\phi_i) = \\frac{1}{N_p} \\sum_{j=0}^{N_p-1} A(\\phi_i, p_j)$。然后我们找到该平均值最大的纬度 $\\phi_i$。\n2.  **$\\max(A)$**：我们找到整个 $A(\\phi,p)$ 网格中的最大值。如果该最大值为负，则结果为 $0.0$。\n3.  **$f_+$**：我们计算 $A(\\phi,p) > 0$ 的网格点数，然后除以总网格点数 ($N_\\phi \\times N_p$) 。\n\n对提供的三个测试用例中的每一个都实施了这些步骤。```python\nimport numpy as np\n\n# Physical constants\na = 6.371e6  # Earth's radius in meters\nOmega = 7.2921e-5  # Earth's rotation rate in rad/s\n\ndef solve_case(case_data):\n    \"\"\"\n    Processes a single test case to compute the required atmospheric dynamics metrics.\n    \n    This function implements the calculation of the Eliassen-Palm (EP) flux and its\n    divergence to find the eddy forcing on the zonal-mean wind.\n    \"\"\"\n    lats_deg = np.array(case_data['lats'])\n    pressures = np.array(case_data['p'])\n    theta_bar = np.array(case_data['theta_bar'])\n    uv_bar = np.array(case_data['uv_bar'])\n    vt_bar = np.array(case_data['vt_bar'])\n\n    n_phi, n_p = theta_bar.shape\n    \n    def deriv1d(y, x):\n        \"\"\"\n        Computes the 1D finite difference derivative of y with respect to x.\n        Uses centered differences for interior points and one-sided for boundaries.\n        \"\"\"\n        res = np.zeros_like(y, dtype=float)\n        if len(y)  2:\n            return res\n        \n        # Forward difference at the start (j=0 or i=0)\n        res[0] = (y[1] - y[0]) / (x[1] - x[0])\n        # Backward difference at the end (j=N-1 or i=N-1)\n        res[-1] = (y[-1] - y[-2]) / (x[-1] - x[-2])\n        # Centered difference for interior points\n        if len(y) > 2:\n            res[1:-1] = (y[2:] - y[:-2]) / (x[2:] - x[:-2])\n        \n        return res\n\n    # --- Step 1: Preliminary calculations ---\n    lats_rad = np.deg2rad(lats_deg)\n    cos_phi = np.cos(lats_rad)\n    f = 2 * Omega * np.sin(lats_rad)\n    \n    # --- Step 2: Static stability term d(theta_bar)/dp ---\n    # axis=1 performs the derivative along the pressure dimension for each latitude.\n    dtheta_dp = np.apply_along_axis(deriv1d, 1, theta_bar, x=pressures)\n\n    # --- Step 3: EP Flux components F_phi and F_p ---\n    # F_phi = a * cos(phi) * (-uv_bar)\n    F_phi = a * cos_phi[:, np.newaxis] * (-uv_bar)\n    \n    # F_p = a * cos(phi) * (f * v'theta' / (d(theta_bar)/dp))\n    numerator_Fp = f[:, np.newaxis] * vt_bar\n    # Use np.divide for safe division, although dtheta_dp is not expected to be zero.\n    F_p = a * cos_phi[:, np.newaxis] * np.divide(numerator_Fp, dtheta_dp, where=dtheta_dp!=0)\n\n    # --- Step 4: EP Flux divergence terms ---\n    # First term: d/d_phi [F_phi * cos(phi)]\n    term_to_diff_phi = F_phi * cos_phi[:, np.newaxis]\n    # axis=0 performs derivative along the latitude dimension for each pressure level.\n    div_term_phi = np.apply_along_axis(deriv1d, 0, term_to_diff_phi, x=lats_rad)\n    \n    # Second term: dF_p/dp\n    # axis=1 for pressure derivative.\n    div_term_p = np.apply_along_axis(deriv1d, 1, F_p, x=pressures)\n    \n    # --- Step 5: Eddy acceleration A ---\n    divergence = div_term_phi + div_term_p\n    \n    cos_phi_2d = cos_phi[:, np.newaxis]\n    A = -np.divide(1.0, a * cos_phi_2d, where=cos_phi_2d!=0) * divergence\n    \n    # Convert from m/s^2 to m/s/day\n    A_daily = A * 86400.0\n\n    # --- Step 6: Compute final metrics ---\n    # 1. Latitude of maximum vertical-mean acceleration (phi_star)\n    # np.argmax handles the tie-breaking rule (first occurrence)\n    A_vert_avg = np.mean(A_daily, axis=1)\n    idx_max = np.argmax(A_vert_avg)\n    phi_star = lats_deg[idx_max]\n    \n    # 2. Maximum positive acceleration on the grid\n    max_A = np.max(A_daily)\n    if max_A  0:\n        max_A = 0.0\n    \n    # 3. Fraction of grid points with positive acceleration\n    positive_count = np.sum(A_daily > 0)\n    total_points = n_phi * n_p\n    fraction_positive = positive_count / total_points if total_points > 0 else 0.0\n    \n    return phi_star, max_A, fraction_positive\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    test_cases = [\n        {\n            \"lats\": [15.0, 30.0, 45.0],\n            \"p\": [70000.0, 50000.0, 30000.0],\n            \"theta_bar\": np.array([[330.0, 340.0, 350.0], [332.0, 342.0, 352.0], [334.0, 344.0, 354.0]]),\n            \"uv_bar\": np.array([[-10.0, -20.0, -10.0], [-30.0, -60.0, -40.0], [-50.0, -80.0, -60.0]]),\n            \"vt_bar\": np.array([[0.2, 0.5, 0.4], [1.0, 2.0, 1.5], [1.5, 2.5, 2.0]]),\n        },\n        {\n            \"lats\": [0.0, 15.0, 30.0],\n            \"p\": [70000.0, 50000.0, 30000.0],\n            \"theta_bar\": np.array([[328.0, 338.0, 348.0], [330.0, 340.0, 350.0], [334.0, 344.0, 354.0]]),\n            \"uv_bar\": np.array([[-5.0, -10.0, -5.0], [-20.0, -30.0, -25.0], [-40.0, -70.0, -50.0]]),\n            \"vt_bar\": np.array([[0.3, 0.4, 0.3], [0.8, 1.5, 1.2], [1.2, 2.2, 1.8]]),\n        },\n        {\n            \"lats\": [15.0, 30.0, 45.0],\n            \"p\": [70000.0, 50000.0, 30000.0],\n            \"theta_bar\": np.array([[330.0, 350.0, 370.0], [332.0, 352.0, 372.0], [334.0, 354.0, 374.0]]),\n            \"uv_bar\": np.array([[-10.0, -20.0, -10.0], [-30.0, -60.0, -40.0], [-50.0, -80.0, -60.0]]),\n            \"vt_bar\": np.array([[0.2, 0.5, 0.4], [1.0, 2.0, 1.5], [1.5, 2.5, 2.0]]),\n        }\n    ]\n\n    all_results_str = []\n    for case in test_cases:\n        phi_star, max_A, frac_pos = solve_case(case)\n        all_results_str.append(f\"{phi_star:.1f}\")\n        all_results_str.append(f\"{max_A:.3f}\")\n        all_results_str.append(f\"{frac_pos:.3f}\")\n\n    print(f\"[{','.join(all_results_str)}]\")\n\nsolve()\n```",
            "answer": "[45.0,5.719,0.556,30.0,6.012,0.556,45.0,2.860,0.556]"
        }
    ]
}