{
    "hands_on_practices": [
        {
            "introduction": "Omega方程将大尺度大气强迫与垂直运动联系起来，但这种联系的效率受到大气静力稳定度的制约。本练习旨在深入探讨此关系的核心，通过从基本的热力学定律出发，直接推导作为静力稳定度主要度量指标的布伦特-瓦萨拉频率（$N^2$）。完成此练习将使你从第一性原理层面理解大气的垂直结构如何控制其对动力强迫的响应。",
            "id": "4102178",
            "problem": "考虑一个在天气尺度上水平均匀的干燥、静力、理想气体大气，其中准地转 (QG) 近似适用于诊断垂直运动。布伦特-维萨拉频率 (BVF) 的平方 $N^2$ 是静力稳定度的典型度量，它在 QG $\\omega$方程中控制着天气尺度强迫转化为垂直运动的效率。仅从以下基本原理出发：\n- 静力平衡：$\\frac{\\partial p}{\\partial z}=-\\rho g$，\n- 理想气体定律：$p=\\rho R T$，\n- 位温定义：$\\theta=T\\left(\\frac{p_{0}}{p}\\right)^{\\kappa}$，其中 $\\kappa=\\frac{R}{c_{p}}$，\n\n推导一个用 $p$、$T$、$\\frac{\\partial T}{\\partial p}$、$g$、$R$ 和 $c_{p}$ 表示的 $N^2$ 表达式，且不使用任何预先指定的“快捷”静力稳定度公式。然后，在以下对流层中层状态下对 $N^2$ 进行数值计算：\n- 压强 $p=600\\ \\text{hPa}$，\n- 温度 $T=255\\ \\text{K}$，\n- 温度对压强的导数 $\\frac{\\partial T}{\\partial p}=0.08\\ \\text{K}\\ \\text{hPa}^{-1}$，\n- 重力加速度 $g=9.81\\ \\text{m}\\ \\text{s}^{-2}$，\n- 干空气气体常数 $R=287\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}$，\n- 定压比热 $c_{p}=1004\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}$。\n\n将 $N^2$ 的最终答案以 $\\text{s}^{-2}$ 为单位表示，并四舍五入到三位有效数字。",
            "solution": "该问题有效，因为它具有科学依据、提法恰当、客观，并包含了获得唯一解所需的所有信息。所提供的背景和方程是大气热力学和动力学的基础。我们将着手进行推导和计算。\n\n布伦特-维萨拉频率的平方 $N^2$ 是流体中静力稳定度的典型度量。对于干燥大气，它基于位温 $\\theta$ 的垂直梯度定义为：\n$$\nN^2 = \\frac{g}{\\theta} \\frac{\\partial \\theta}{\\partial z}\n$$\n其中 $g$ 是重力加速度，$z$ 是垂直坐标。该问题要求将此表达式改写为用气压坐标变量表示。\n\n首先，我们使用链式法则将垂直偏导数 $\\frac{\\partial}{\\partial z}$ 转换为关于压强 $p$ 的偏导数：\n$$\n\\frac{\\partial \\theta}{\\partial z} = \\frac{\\partial \\theta}{\\partial p} \\frac{\\partial p}{\\partial z}\n$$\n项 $\\frac{\\partial p}{\\partial z}$ 由静力平衡方程给出：\n$$\n\\frac{\\partial p}{\\partial z} = -\\rho g\n$$\n其中 $\\rho$ 是空气密度。使用理想气体定律 $p = \\rho R T$，我们可以将密度表示为 $\\rho = \\frac{p}{RT}$。将此代入静力平衡方程，得到：\n$$\n\\frac{\\partial p}{\\partial z} = -\\frac{p g}{R T}\n$$\n现在，我们将其代回到 $\\frac{\\partial \\theta}{\\partial z}$ 的链式法则表达式中：\n$$\n\\frac{\\partial \\theta}{\\partial z} = \\frac{\\partial \\theta}{\\partial p} \\left( -\\frac{p g}{R T} \\right)\n$$\n将此结果代入 $N^2$ 的定义中：\n$$\nN^2 = \\frac{g}{\\theta} \\left[ \\frac{\\partial \\theta}{\\partial p} \\left( -\\frac{p g}{R T} \\right) \\right] = -\\frac{g^2 p}{R T \\theta} \\frac{\\partial \\theta}{\\partial p}\n$$\n接下来，我们必须找到 $\\frac{\\partial \\theta}{\\partial p}$ 的表达式。我们从位温 $\\theta$ 的定义开始：\n$$\n\\theta = T \\left(\\frac{p_0}{p}\\right)^{\\kappa}\n$$\n其中 $\\kappa = \\frac{R}{c_p}$。为了求出关于 $p$ 的导数，首先对该表达式取自然对数会很方便：\n$$\n\\ln \\theta = \\ln T + \\kappa (\\ln p_0 - \\ln p)\n$$\n现在，我们将整个方程对 $p$ 求导，并将 $T$ 视为 $p$ 的函数：\n$$\n\\frac{1}{\\theta} \\frac{\\partial \\theta}{\\partial p} = \\frac{1}{T} \\frac{\\partial T}{\\partial p} - \\frac{\\kappa}{p}\n$$\n乘以 $\\theta$，我们得到 $\\frac{\\partial \\theta}{\\partial p}$ 的表达式：\n$$\n\\frac{\\partial \\theta}{\\partial p} = \\theta \\left( \\frac{1}{T} \\frac{\\partial T}{\\partial p} - \\frac{\\kappa}{p} \\right)\n$$\n现在，我们将 $\\frac{\\partial \\theta}{\\partial p}$ 的这个表达式代入我们的 $N^2$ 方程中：\n$$\nN^2 = -\\frac{g^2 p}{R T \\theta} \\left[ \\theta \\left( \\frac{1}{T} \\frac{\\partial T}{\\partial p} - \\frac{\\kappa}{p} \\right) \\right]\n$$\n$\\theta$ 项相互抵消，显著简化了表达式：\n$$\nN^2 = -\\frac{g^2 p}{R T} \\left( \\frac{1}{T} \\frac{\\partial T}{\\partial p} - \\frac{\\kappa}{p} \\right)\n$$\n将前面的因子分配进去，我们得到：\n$$\nN^2 = -\\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p} + \\frac{g^2 p \\kappa}{R T p} = \\frac{g^2 \\kappa}{R T} - \\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p}\n$$\n最后，代入定义 $\\kappa = \\frac{R}{c_p}$：\n$$\nN^2 = \\frac{g^2 \\left(\\frac{R}{c_p}\\right)}{R T} - \\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p}\n$$\n气体常数 $R$ 在第一项中被消掉，从而得到用所需变量表示的 $N^2$ 的最终推导表达式：\n$$\nN^2 = \\frac{g^2}{c_p T} - \\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p}\n$$\n现在，我们对此表达式进行数值计算。给定值为：\n-   $p = 600\\ \\text{hPa} = 600 \\times 10^2\\ \\text{Pa} = 6 \\times 10^4\\ \\text{Pa}$\n-   $T = 255\\ \\text{K}$\n-   $\\frac{\\partial T}{\\partial p} = 0.08\\ \\text{K}\\ \\text{hPa}^{-1} = \\frac{0.08\\ \\text{K}}{100\\ \\text{Pa}} = 8 \\times 10^{-4}\\ \\text{K}\\ \\text{Pa}^{-1}$\n-   $g = 9.81\\ \\text{m}\\ \\text{s}^{-2}$\n-   $R = 287\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}$\n-   $c_p = 1004\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}$\n\n我们分别计算这两个项。\n\n第一项：\n$$\n\\frac{g^2}{c_p T} = \\frac{(9.81\\ \\text{m}\\ \\text{s}^{-2})^2}{(1004\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}) (255\\ \\text{K})} = \\frac{96.2361\\ \\text{m}^2\\ \\text{s}^{-4}}{256020\\ \\text{J}\\ \\text{kg}^{-1}} \\approx 3.75897 \\times 10^{-4}\\ \\text{s}^{-2}\n$$\n第二项：\n$$\n\\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p} = \\frac{(9.81\\ \\text{m}\\ \\text{s}^{-2})^2 (6 \\times 10^4\\ \\text{Pa})}{(287\\ \\text{J}\\ \\text{kg}^{-1}\\ \\text{K}^{-1}) (255\\ \\text{K})^2} (8 \\times 10^{-4}\\ \\text{K}\\ \\text{Pa}^{-1})\n$$\n$$\n\\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p} = \\frac{96.2361 \\times 6 \\times 10^4}{287 \\times 65025} \\times (8 \\times 10^{-4})\\ \\text{s}^{-2}\n$$\n$$\n\\frac{g^2 p}{R T^2} \\frac{\\partial T}{\\partial p} = \\frac{5774166}{18662175} \\times (8 \\times 10^{-4})\\ \\text{s}^{-2} \\approx 0.309400 \\times (8 \\times 10^{-4})\\ \\text{s}^{-2} \\approx 2.47520 \\times 10^{-4}\\ \\text{s}^{-2}\n$$\n组合这两项来求 $N^2$：\n$$\nN^2 \\approx (3.75897 \\times 10^{-4} - 2.47520 \\times 10^{-4})\\ \\text{s}^{-2} = 1.28377 \\times 10^{-4}\\ \\text{s}^{-2}\n$$\n问题要求将答案四舍五入到三位有效数字。\n$$\nN^2 \\approx 1.28 \\times 10^{-4}\\ \\text{s}^{-2}\n$$\n$N^2$ 为正值表明大气在此高度是静力稳定的，这与所给定的温度直减率小于干绝热直减率的情况相符。",
            "answer": "$$ \\boxed{1.28 \\times 10^{-4}} $$"
        },
        {
            "introduction": "准地转Omega方程是一个强大的诊断工具，但其有效性仅限于特定的大气尺度和流动状态。本练习将通过对原始方程组进行严格的尺度分析，挑战你探索这些适用边界。通过识别控制准地转近似的关键无量纲参数，你将培养出判断何时何地应用Omega诊断在物理上是合理的批判性思维。",
            "id": "4102158",
            "problem": "一个中纬度天气尺度扰动由静力、旋转、Boussinesq原始方程在$f$平面上建模，其中布伦特-维萨拉频率$N$和科里奥利参数$f_0$为常数。该流动的特征水平长度尺度为$L$，垂直尺度为$H$，水平风速为$U$。你将通过对控制方程进行无量纲化，并识别出为使准地转$\\omega$框架成立而必须同时满足的小参数，来评估准地转（QG）近似在垂直运动诊断中的有效性极限。\n\n从满足静力平衡和不可压缩连续性约束的旋转Boussinesq原始方程出发，使用尺度$L$、$H$、$U$以及平流时间尺度$T=L/U$进行尺度分析。推导三个独立的、无量纲的“QG控制”参数，它们分别衡量：(i) 水平非地转加速度相对于科里奥利力的量级，(ii) 非静力垂直加速度相对于静力平衡的量级，以及 (iii) 由地转-静力-热成风一致性所隐含的等熵面坡度的微小程度。清楚地说明每个参数是如何从控制方程的无量纲化中产生的。\n\n假设当这三个控制参数中的每一个都不超过一个给定的容差$\\alpha$时，QG垂直运动方程被认为是可接受的。对于一个天气尺度系统，其参数为$L=1.5\\times 10^{6}\\ \\mathrm{m}$，$H=9.0\\times 10^{3}\\ \\mathrm{m}$，$N=1.0\\times 10^{-2}\\ \\mathrm{s}^{-1}$，$f_0=1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$，容差$\\alpha=0.08$，确定最大水平风速$U_{\\max}$，使得所有三个控制参数同时小于或等于$\\alpha$。将你的答案四舍五入到三位有效数字，并以$\\mathrm{m}\\ \\mathrm{s}^{-1}$为单位表示。",
            "solution": "经评估，此问题有效。其科学基础是地球物理流体动力学原理，特别是通过对原始方程进行尺度分析来推导准地转（QG）近似。该问题是适定的，有充分且一致的信息来确定最大允许风速$U_{\\max}$的唯一解。所使用的语言是客观和精确的。因此，我们可以继续进行求解。\n\n目标是推导三个控制QG近似有效性的无量纲参数，然后用它们来为给定的天气尺度系统找到最大水平风速$U_{\\max}$。\n\n首先，我们从$f$平面上的旋转、Boussinesq原始方程开始。相关方程是水平动量方程、垂直动量方程和热力学能量方程。我们使用给定的尺度：水平长度$L$、垂直高度$H$、水平速度$U$和平流时间$T=L/U$。\n\n控制方程为：\n1. 水平动量方程：$\\frac{D \\mathbf{u}_h}{Dt} + f_0 \\mathbf{k} \\times \\mathbf{u}_h = -\\frac{1}{\\rho_0} \\nabla_h p'$\n2. 垂直动量方程：$\\frac{Dw}{Dt} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} + b$\n3. 连续性方程（不可压缩）：$\\nabla_h \\cdot \\mathbf{u}_h + \\frac{\\partial w}{\\partial z} = 0$\n4. 热力学方程（用浮力$b$表示）：$\\frac{Db}{Dt} + N^2 w = 0$\n\n这里，$\\mathbf{u}_h = (u,v)$是水平速度矢量，$w$是垂直速度，$p'$是相对于静力平衡背景态的压力扰动，$b = -g\\rho'/\\rho_0$是浮力，$f_0$是常数科里奥利参数，$N$是常数布伦特-维萨拉频率，$\\rho_0$是常数参考密度。物质导数为$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u}_h \\cdot \\nabla_h + w \\frac{\\partial}{\\partial z}$。\n\n我们通过引入无量纲变量（用撇号表示）来进行尺度分析：\n$t = (L/U)t'$, $(x,y) = L(x',y')$, $z=Hz'$, $(u,v) = U(u',v')$。\n从连续性方程，我们推导出垂直速度的尺度$W$：\n$\\frac{U}{L} \\sim \\frac{W}{H} \\implies W = U\\frac{H}{L}$。所以，$w = (UH/L)w'$。\n对于QG系统，地转平衡和静力平衡占主导地位。我们用它来寻找压力$P'$和浮力$B$的尺度。\n地转平衡（来自方程1）：$f_0 U \\sim \\frac{P'}{\\rho_0 L} \\implies P' = \\rho_0 f_0 U L$。所以，$p' = (\\rho_0 f_0 U L)p'_{*}$。\n热成风平衡意味着地转平衡和静力平衡之间的一致性。热成风关系是$f_0 \\frac{\\partial u_g}{\\partial z} = \\frac{\\partial b}{\\partial y}$。对其进行尺度分析得到：\n$f_0 \\frac{U}{H} \\sim \\frac{B}{L} \\implies B = \\frac{f_0 U L}{H}$。所以，$b = (f_0 U L / H) b'$。\n\n现在我们对这些方程进行无量纲化，以找到控制参数。\n\n**(i) 水平非地转加速度相对于科里奥利力**\n我们分析水平动量方程：\n$$ \\underbrace{\\frac{D \\mathbf{u}_h}{Dt}}_{\\text{加速度}} + \\underbrace{f_0 \\mathbf{k} \\times \\mathbf{u}_h}_{\\text{科里奥利力}} = \\underbrace{-\\frac{1}{\\rho_0} \\nabla_h p'}_{\\text{气压梯度力}} $$\n加速度项的尺度是$\\frac{U}{T} = \\frac{U^2}{L}$。科里奥利力项的尺度是$f_0 U$。加速度与科里奥利力的比值是：\n$$ \\frac{U^2/L}{f_0 U} = \\frac{U}{f_0 L} $$\n这是罗斯贝数，$Ro$。为使QG近似有效，科里奥利力与气压梯度力之间的地转平衡必须占主导地位，这意味着加速度必须相对较小。这要求$Ro \\ll 1$。\n第一个参数是$P_1 = Ro = \\frac{U}{f_0 L}$。\n\n**(ii) 非静力垂直加速度相对于静力平衡**\n我们分析垂直动量方程。静力平衡是垂直气压梯度力与浮力之间的平衡。非静力效应来自垂直加速度项$\\frac{Dw}{Dt}$。\n$$ \\underbrace{\\frac{Dw}{Dt}}_{\\text{垂直加速度}} = \\underbrace{-\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} + b}_{\\text{静力平衡项}} $$\n垂直加速度的尺度是$\\frac{W}{T} = \\frac{(UH/L)}{(L/U)} = \\frac{U^2 H}{L^2}$。\n参与静力平衡的各项，即垂直气压梯度和浮力，其尺度分别为$\\frac{P'}{\\rho_0 H}$和$B$。使用我们推导出的尺度$P'=\\rho_0 f_0 U L$和$B=f_0 U L / H$，我们看到这两项的尺度都为$f_0 U L/H$。\n衡量垂直加速度相对于静力平衡各项量级的参数是它们尺度的比值：\n$$ \\frac{U^2 H / L^2}{f_0 U L / H} = \\frac{U H^2}{f_0 L^3} $$\n这可以写成$Ro (H/L)^2$。为使静力近似有效，此参数必须很小。\n第二个参数是$P_2 = \\frac{U H^2}{f_0 L^3}$。\n\n**(iii) 等熵面坡度的微小程度**\n等熵面（在此模型中为位温或浮力恒定）的坡度由$S_{\\theta} = |\\nabla_h \\theta / (\\partial\\theta/\\partial z)| \\sim |\\nabla_h b / (\\partial b/\\partial z)|$给出。\n使用$N^2 = \\frac{1}{\\rho_0}\\frac{d(g\\rho_{ref})}{dz}$和$b = -g\\rho'/\\rho_0$的定义，参考态有$N^2 = \\partial b_{ref}/\\partial z$。所以浮力面的坡度为$S_b \\sim \\frac{| \\nabla_h b' |}{N^2}$。\n坡度的尺度是$\\frac{B/L}{N^2}$。\n为了地转-静力-热成风的一致性，我们使用从热成风平衡推导出的浮力尺度：$B = f_0 U L / H$。\n将此代入坡度尺度的表达式中得到：\n$$ S_b \\sim \\frac{(f_0 U L / H)}{L N^2} = \\frac{f_0 U}{H N^2} $$\nQG近似假设等熵面近乎水平，所以这个坡度必须很小。\n第三个参数是$P_3 = \\frac{f_0 U}{H N^2}$。\n\n三个无量纲QG控制参数是：\n$$ P_1 = \\frac{U}{f_0 L} \\quad , \\quad P_2 = \\frac{U H^2}{f_0 L^3} \\quad , \\quad P_3 = \\frac{f_0 U}{H N^2} $$\n\n现在，对于给定的天气尺度系统，我们必须找到最大风速$U_{\\max}$，使得所有三个参数都小于或等于容差$\\alpha=0.08$。\n1. $P_1 \\le \\alpha \\implies \\frac{U}{f_0 L} \\le \\alpha \\implies U \\le \\alpha f_0 L$\n2. $P_2 \\le \\alpha \\implies \\frac{U H^2}{f_0 L^3} \\le \\alpha \\implies U \\le \\alpha \\frac{f_0 L^3}{H^2}$\n3. $P_3 \\le \\alpha \\implies \\frac{f_0 U}{H N^2} \\le \\alpha \\implies U \\le \\alpha \\frac{H N^2}{f_0}$\n\n为满足所有三个条件，$U$必须小于或等于这三个上界中的最小值。\n$U_{\\max} = \\min\\left(\\alpha f_0 L, \\alpha \\frac{f_0 L^3}{H^2}, \\alpha \\frac{H N^2}{f_0}\\right)$。\n\n我们代入给定的数值：\n$L=1.5\\times 10^{6}\\ \\mathrm{m}$, $H=9.0\\times 10^{3}\\ \\mathrm{m}$, $N=1.0\\times 10^{-2}\\ \\mathrm{s}^{-1}$, $f_0=1.0\\times 10^{-4}\\ \\mathrm{s}^{-1}$, $\\alpha=0.08$。\n\n我们来计算$U$的三个上界：\n$U_1 = \\alpha f_0 L = (0.08)(1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1})(1.5 \\times 10^{6}\\ \\mathrm{m}) = 0.08 \\times 150\\ \\mathrm{m}\\ \\mathrm{s}^{-1} = 12\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n$U_2 = \\alpha \\frac{f_0 L^3}{H^2} = (0.08) \\frac{(1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1})(1.5 \\times 10^{6}\\ \\mathrm{m})^3}{(9.0 \\times 10^{3}\\ \\mathrm{m})^2} = (0.08) \\frac{10^{-4} \\times 3.375 \\times 10^{18}}{81 \\times 10^6}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$\n$U_2 = (0.08) \\frac{3.375 \\times 10^{14}}{8.1 \\times 10^7}\\ \\mathrm{m}\\ \\mathrm{s}^{-1} = (0.08)(4.166... \\times 10^5)\\ \\mathrm{m}\\ \\mathrm{s}^{-1} \\approx 3.33 \\times 10^4\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n$U_3 = \\alpha \\frac{H N^2}{f_0} = (0.08) \\frac{(9.0 \\times 10^{3}\\ \\mathrm{m})(1.0 \\times 10^{-2}\\ \\mathrm{s}^{-1})^2}{1.0 \\times 10^{-4}\\ \\mathrm{s}^{-1}} = (0.08) \\frac{9.0 \\times 10^3 \\times 1.0 \\times 10^{-4}}{1.0 \\times 10^{-4}}\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$\n$U_3 = (0.08)(9.0 \\times 10^3)\\ \\mathrm{m}\\ \\mathrm{s}^{-1} = 720\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n我们现在求这三个值的最小值：\n$U_{\\max} = \\min(12, 33333..., 720)\\ \\mathrm{m}\\ \\mathrm{s}^{-1} = 12\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。\n\n对于这个天气尺度系统，为使QG近似成立，对风速最严格的约束是罗斯贝数判据。问题要求答案四舍五入到三位有效数字。\n\n$U_{\\max} = 12.0\\ \\mathrm{m}\\ \\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{12.0}\n$$"
        },
        {
            "introduction": "从理论走向应用是掌握大气诊断学的关键一步。这个动手编程练习将指导你实现一个用于求解准地转Omega方程的光谱法求解器，让你能够从给定的质量场和温度场数据中计算出垂直运动场。这项实践弥合了抽象方程与其实际应用于数值天气预报之间的鸿沟，提供了诊断编程方面的实用技能。",
            "id": "4102157",
            "problem": "本题要求您基于准地转框架，推导并实现一个天气尺度垂直运动的诊断工具，然后为一组受控的合成流场计算由此产生的垂直运动场。其目标是展示数值天气预报中使用的基本平衡关系与从已知水平场获得垂直运动的数值稳定反演过程之间的联系。\n\n从适用于气压坐标系中准地转动力学的基本定律和定义出发，使用以下基础公式，不要引入任何快捷公式：\n- 垂直气压梯度与重力之间的静力平衡：$\\partial \\phi / \\partial p = - \\alpha$，其中 $\\phi$ 是位势，$\\alpha$ 是与理想气体定律相关的比容。\n- 中纬度地区科里奥利参数 $f_0$ 为常数时的地转平衡：$f_0 \\,\\mathbf{k} \\times \\mathbf{u}_g = - \\nabla \\phi$，这意味着在小罗斯贝数假设下，存在一个地转流函数 $\\psi$，使得 $\\mathbf{u}_g = (u_g,v_g) = \\left( -\\partial \\psi / \\partial y, \\, \\partial \\psi / \\partial x \\right)$。\n- 气压坐标系中的绝热热力学能量方程以及与准地转尺度分析相符的质量连续性约束。\n- 准地转尺度分析的假设：天气尺度、小罗斯贝数、弱非地转性以及缓慢变化的层结。\n\n在水平周期性区域和单一主导垂直模态的假设下，证明天气尺度的垂直运动在水平面上满足一个椭圆型偏微分方程。然后，在一个均匀的二维网格上实现谱反演，以获得垂直运动场。\n\n实现细节和测试套件：\n- 区域：一个边长为 $L_x = L_y$（单位：米）的方形水平区域，由一个 $N_x \\times N_y$ 点的均匀网格离散化，在 $x$ 和 $y$ 方向均采用周期性边界条件。\n- 单一气压层 $p$ 上的合成场：\n  - 地转流函数 $\\psi(x,y)$ 和温度 $T(x,y)$ 被指定为波数 $k_x$ 和 $k_y$（单位：弧度/米）的空间变化三角函数。角度必须以弧度处理。\n  - 使用地转关系从 $\\psi(x,y)$ 计算水平风分量。\n- 物理常数：科里奥利参数 $f_0$（单位：s$^{-1}$）和干空气气体常数 $R$（单位：J kg$^{-1}$ K$^{-1}$）。\n- 静力稳定度参数：假设层内静力稳定度参数 $\\sigma$ 为正常数。\n- 垂直结构假设：模拟一个在气压厚度 $\\Delta p$ 上的单一垂直模态，模态数为整数 $m \\ge 1$，并通过一个由此模态和层厚度导出的常数分离参数来表示垂直运动的垂直曲率。\n\n需要实现的数值步骤：\n- 使用提供的振幅和波数，在网格上构建 $\\psi(x,y)$ 和 $T(x,y)$。\n- 计算地转风和所有必需的水平导数。\n- 构建由准地转框架和指定假设所蕴含的适当的天气尺度强迫项，该项表示为一个由地转风梯度和温度梯度构成的矢量的水平散度，并由适当的常数和环境气压 $p$ 进行缩放。\n- 在谱空间中反演得到的椭圆算子，以获得网格上的垂直运动场，并强制执行周期性边界条件。\n\n您的程序必须处理以下三个测试用例，每个用例由 $(L_x, L_y, N_x, N_y, f_0, R, p, \\sigma, \\Delta p, m, \\Psi_0, T_0, k_x, k_y)$ 指定，并产生所要求的输出。所有正弦和余弦函数均使用弧度。地转流函数和温度场为：\n$$\n\\psi(x,y) = \\Psi_0 \\cos(k_x x) \\cos(k_y y), \\quad T(x,y) = T_0 \\sin(k_x x) \\sin(k_y y),\n$$\n其中 $x \\in [0,L_x)$ 且 $y \\in [0,L_y)$。\n\n测试套件参数集：\n1. 用例A（一般理想情况）：$(L_x=10^6\\,\\text{m}, L_y=10^6\\,\\text{m}, N_x=64, N_y=64, f_0=10^{-4}\\,\\text{s}^{-1}, R=287\\,\\text{J}\\,\\text{kg}^{-1}\\,\\text{K}^{-1}, p=8.0\\times 10^4\\,\\text{Pa}, \\sigma=1.0\\times 10^{-6}, \\Delta p=2.0\\times 10^4\\,\\text{Pa}, m=1, \\Psi_0=10^6\\,\\text{m}^2\\,\\text{s}^{-1}, T_0=10\\,\\text{K}, k_x=2\\pi/L_x, k_y=2\\pi/L_y)$。\n2. 用例B（更强的斜压性和更高的垂直模态）：$(L_x=10^6\\,\\text{m}, L_y=10^6\\,\\text{m}, N_x=64, N_y=64, f_0=10^{-4}\\,\\text{s}^{-1}, R=287\\,\\text{J}\\,\\text{kg}^{-1}\\,\\text{K}^{-1}, p=7.0\\times 10^4\\,\\text{Pa}, \\sigma=1.0\\times 10^{-6}, \\Delta p=1.5\\times 10^4\\,\\text{Pa}, m=2, \\Psi_0=10^6\\,\\text{m}^2\\,\\text{s}^{-1}, T_0=20\\,\\text{K}, k_x=2\\pi/L_x, k_y=3\\cdot 2\\pi/L_y)$。\n3. 用例C（热力强迫消失的边缘情况）：$(L_x=10^6\\,\\text{m}, L_y=10^6\\,\\text{m}, N_x=64, N_y=64, f_0=10^{-4}\\,\\text{s}^{-1}, R=287\\,\\text{J}\\,\\text{kg}^{-1}\\,\\text{K}^{-1}, p=8.0\\times 10^4\\,\\text{Pa}, \\sigma=1.0\\times 10^{-6}, \\Delta p=2.0\\times 10^4\\,\\text{Pa}, m=1, \\Psi_0=10^6\\,\\text{m}^2\\,\\text{s}^{-1}, T_0=0\\,\\text{K}, k_x=2\\pi/L_x, k_y=2\\pi/L_y)$。\n\n对于每个用例，计算网格上的垂直运动场，并报告两个可在各用例间直接比较的诊断量：\n- 气压坐标系中垂直运动（omega）的区域平均值，以 $\\text{Pa}\\,\\text{s}^{-1}$ 为单位。\n- 垂直运动的均方根，以 $\\text{Pa}\\,\\text{s}^{-1}$ 为单位。\n\n您的程序应生成单行输出，其中包含六个结果，格式为逗号分隔的列表并用方括号括起，顺序如下：$\\left[\\overline{\\omega}_A, \\omega_{\\mathrm{rms},A}, \\overline{\\omega}_B, \\omega_{\\mathrm{rms},B}, \\overline{\\omega}_C, \\omega_{\\mathrm{rms},C}\\right]$，其中下标表示测试用例。所有量均以 $\\text{Pa}\\,\\text{s}^{-1}$ 表示，不含额外文本。三角函数中使用的角度必须是弧度。必须通过在傅里叶空间中使用谱导数和反演来强制执行两个水平方向的周期性边界条件。",
            "solution": "该问题要求在准地转（QG）框架内，推导并数值实现一个用于天气尺度垂直运动 $\\omega$ 的诊断工具。推导从基本原理开始，最终得到一个可解的椭圆型偏微分方程，然后使用谱方法在周期性区域上对其进行反演。\n\n### 步骤1：准地转Omega方程的推导\n\n我们从气压坐标系 $(x, y, p)$ 下的准地转理论基础方程开始。该系统由地转平衡、静力平衡、质量连续性和热力学能量方程所决定。\n\n地转风 $\\mathbf{u}_g = (u_g, v_g)$ 由科里奥利力与气压梯度力之间的平衡定义：\n$$f_0 \\,\\mathbf{k} \\times \\mathbf{u}_g = - \\nabla \\phi$$\n其中 $f_0$ 是常数科里奥利参数，$\\mathbf{k}$ 是垂直单位向量，$\\nabla$ 是水平梯度算子，$\\phi$ 是位势。这允许定义地转流函数 $\\psi = \\phi/f_0$，从而 $u_g = -\\frac{\\partial \\psi}{\\partial y}$ 且 $v_g = \\frac{\\partial \\psi}{\\partial x}$。\n\n准地转涡度方程表达了准地转位涡在地转流中的守恒：\n$$ \\left( \\frac{\\partial}{\\partial t} + \\mathbf{u}_g \\cdot \\nabla \\right) (\\zeta_g + f) = f_0 \\frac{\\partial \\omega}{\\partial p} $$\n此处，$\\zeta_g = \\nabla^2 \\psi$ 是地转相对涡度，$f$ 是科里奥利参数（在左侧近似为 $f_0$，但其随纬度的变化 $\\beta = df/dy$ 在行星涡度平流中被保留），$\\omega = Dp/Dt$ 是气压坐标系中的垂直运动。对于指定的常数 $f=f_0$，方程简化为：\n$$ \\frac{\\partial \\zeta_g}{\\partial t} + \\mathbf{u}_g \\cdot \\nabla \\zeta_g = f_0 \\frac{\\partial \\omega}{\\partial p} $$\n\n准地转尺度下的绝热热力学能量方程为：\n$$ \\left( \\frac{\\partial}{\\partial t} + \\mathbf{u}_g \\cdot \\nabla \\right) \\left( \\frac{\\partial \\phi}{\\partial p} \\right) + \\sigma \\omega = 0 $$\n其中 $\\sigma$ 是静力稳定度参数，假定为常数。项 $\\frac{\\partial \\phi}{\\partial p}$ 通过静力关系 $\\frac{\\partial \\phi}{\\partial p} = -\\alpha = -\\frac{RT}{p}$ 与温度 $T$ 相关，其中 $R$ 是干空气气体常数。\n\n我们的目标是找到一个仅依赖于质量场瞬时状态（即 $\\phi$ 或 $\\psi$）的 $\\omega$ 的诊断方程。完整的准地转omega方程是：\n$$ (\\sigma \\nabla^2 + f_0^2 \\frac{\\partial^2}{\\partial p^2})\\omega = -2 \\nabla \\cdot \\mathbf{Q} $$\n其中Q矢量 $\\mathbf{Q}=(Q_1, Q_2)$ 定义为：\n$$ \\mathbf{Q} = -\\frac{R}{p} \\left( \\frac{\\partial \\mathbf{u}_g}{\\partial x} \\cdot \\nabla T, \\frac{\\partial \\mathbf{u}_g}{\\partial y} \\cdot \\nabla T \\right) $$\n此形式概括了地转流作用于温度场对垂直运动的强迫作用。具体来说：\n$$ Q_1 = -\\frac{R}{p} \\left( \\frac{\\partial u_g}{\\partial x} \\frac{\\partial T}{\\partial x} + \\frac{\\partial v_g}{\\partial x} \\frac{\\partial T}{\\partial y} \\right) = -\\frac{R}{p} \\left( -\\frac{\\partial^2\\psi}{\\partial x \\partial y}\\frac{\\partial T}{\\partial x} + \\frac{\\partial^2\\psi}{\\partial x^2}\\frac{\\partial T}{\\partial y} \\right) $$\n$$ Q_2 = -\\frac{R}{p} \\left( \\frac{\\partial u_g}{\\partial y} \\frac{\\partial T}{\\partial x} + \\frac{\\partial v_g}{\\partial y} \\frac{\\partial T}{\\partial y} \\right) = -\\frac{R}{p} \\left( -\\frac{\\partial^2\\psi}{\\partial y^2}\\frac{\\partial T}{\\partial x} + \\frac{\\partial^2\\psi}{\\partial y \\partial x}\\frac{\\partial T}{\\partial y} \\right) $$\n\n### 步骤2：针对单一垂直模态的简化\n\n问题陈述我们应模拟一个单一主导垂直模态。这允许使用分离变量法，$\\omega(x,y,p) = \\Omega(x,y) P(p)$。垂直曲率项 $\\frac{\\partial^2 \\omega}{\\partial p^2}$ 变为 $\\Omega(x,y) \\frac{d^2 P}{dp^2}$。对于一个厚度为 $\\Delta p$ 且模态数为 $m$ 的有限层，我们假设 $P(p)$ 具有在层边界处消失的正弦结构。这意味着 $\\frac{d^2 P}{dp^2} = -\\lambda_v P$，其中垂直分离常数是 $\\lambda_v = \\left(\\frac{m\\pi}{\\Delta p}\\right)^2$。\n\n将此代入omega方程并除以 $P(p)$，我们得到了一个关于垂直运动水平结构 $\\Omega(x,y)$ 的二维椭圆型偏微分方程：\n$$ \\sigma \\nabla^2 \\Omega - f_0^2 \\left(\\frac{m\\pi}{\\Delta p}\\right)^2 \\Omega = -2 \\nabla \\cdot \\mathbf{Q} $$\n整理后得到一个标准的亥姆霍兹方程：\n$$ \\left( \\nabla^2 - \\lambda_h^2 \\right) \\Omega(x,y) = \\frac{-2 \\nabla \\cdot \\mathbf{Q}(x,y)}{\\sigma} $$\n其中 $\\lambda_h^2 = \\frac{f_0^2}{\\sigma} \\left(\\frac{m\\pi}{\\Delta p}\\right)^2$。项 $\\lambda_h^{-1}$ 是指定垂直模态的罗斯贝变形半径。\n\n### 步骤3：在周期性区域上的谱反演\n\n这个亥姆霍兹方程将在一个双周期区域上求解。这非常适合使用快速傅里叶变换（FFT）的谱方法。\n令 $\\hat{\\Omega}(k_x, k_y)$ 为 $\\Omega(x,y)$ 的二维离散傅里叶变换，$\\hat{F}(k_x,k_y)$ 为强迫项 $F(x,y) = \\frac{-2 \\nabla \\cdot \\mathbf{Q}}{\\sigma}$ 的变换。\n拉普拉斯算子的傅里叶变换是 $\\mathcal{F}\\{\\nabla^2 \\Omega\\} = -(k_x^2 + k_y^2) \\hat{\\Omega}$。因此，亥姆霍兹方程在谱空间中变成一个代数方程：\n$$ \\left[ -(k_x^2 + k_y^2) - \\lambda_h^2 \\right] \\hat{\\Omega}(k_x, k_y) = \\hat{F}(k_x,k_y) $$\n变换后的垂直运动场的解为：\n$$ \\hat{\\Omega}(k_x, k_y) = - \\frac{\\hat{F}(k_x, k_y)}{k_x^2 + k_y^2 + \\lambda_h^2} $$\n对于 $m \\ge 1$，分母始终非零，确保了唯一解的存在。然后通过应用二维逆FFT来恢复实空间解 $\\Omega(x,y)$。\n\n### 步骤4：数值步骤\n\n对每个测试用例，实现遵循以下步骤：\n1.  **网格设置**：在区域 $[0, L_x) \\times [0, L_y)$ 上构建一个大小为 $N_x \\times N_y$ 的均匀笛卡尔网格。同时计算相应的网格波数 $(k_{x,grid}, k_{y,grid})$。\n2.  **场构建**：使用给定的解析表达式在网格上计算合成地转流函数 $\\psi(x,y)$ 和温度 $T(x,y)$ 场：\n    $$ \\psi(x,y) = \\Psi_0 \\cos(k_x x) \\cos(k_y y), \\quad T(x,y) = T_0 \\sin(k_x x) \\sin(k_y y) $$\n3.  **谱微分**：在谱空间中计算所有必需的水平导数（$\\psi_{xx}, \\psi_{yy}, \\psi_{xy}, T_x, T_y$）。对于场 $g(x,y)$，其导数 $\\frac{\\partial g}{\\partial x}$ 通过 $\\mathcal{F}^{-1}\\{ i k_x \\mathcal{F}\\{g\\} \\}$ 求得。\n4.  **强迫项计算**：使用计算出的导数在网格上计算Q矢量的分量 $Q_1$ 和 $Q_2$。然后，再次使用谱微分计算散度 $\\nabla \\cdot \\mathbf{Q}$。亥姆霍兹方程的最终强迫项为 $F(x,y) = \\frac{-2}{\\sigma}(\\frac{\\partial Q_1}{\\partial x} + \\frac{\\partial Q_2}{\\partial y})$。\n5.  **谱反演**：将强迫项 $F(x,y)$ 变换到谱空间。使用上面导出的代数关系计算变换后的解 $\\hat{\\Omega}$。\n6.  **解的恢复**：对 $\\hat{\\Omega}(k_x, k_y)$ 应用二维逆FFT，得到实空间垂直运动场 $\\Omega(x,y)$。\n7.  **诊断量计算**：计算所得垂直运动场的区域平均值 $\\overline{\\omega}$ 和均方根 $\\omega_{rms}$。由于周期性边界条件和散度算子的性质，强迫项的区域平均值必须为零，这意味着垂直运动的区域平均值 $\\overline{\\omega}$ 也必须为零。数值结果应反映这一点。\n\n此过程将应用于提供的三个测试用例中的每一个，从而产生六个最终的诊断值。",
            "answer": "[1.07765103e-19,1.20524419e-01,1.07166164e-18,7.48152509e-01,0.00000000e+00,0.00000000e+00]"
        }
    ]
}