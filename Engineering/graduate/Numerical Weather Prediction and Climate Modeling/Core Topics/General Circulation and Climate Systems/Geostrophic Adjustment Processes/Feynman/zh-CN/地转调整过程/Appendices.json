{
    "hands_on_practices": [
        {
            "introduction": "要理解地转适应过程，首先需要确定控制该过程的关键物理尺度。本练习将引导你计算海洋中重力波的传播速度和罗斯贝形变半径，这两个量分别决定了适应过程的速度和空间范围。通过这个基础计算，你将对地球物理流体中旋转和分层效应的相互作用有一个定量的认识。",
            "id": "4048417",
            "problem": "考虑一个$f$平面上连续层化、静力、Boussinesq海洋中的中纬度地转调整情景。一个局地浮力异常激发了垂直模态，这些模态作为长重力波传播，并随后调整为平衡流。在垂直模态分解中，每个模态的行为都像一个具有等效深度$h_n$和相速度$c_n$的浅水层。设环境的特征为Brunt–Väisälä频率$N=10^{-3}\\,\\mathrm{s^{-1}}$，总深度$H=4000\\,\\mathrm{m}$，并假设第一斜压模的等效深度为$h_1=50\\,\\mathrm{m}$。你需要：\n1. 从线性化的静力Boussinesq方程组和垂直本征模公式出发，推导用$h_1$和重力加速度$g$表示的模态1长波相速度$c_1$的表达式。\n2. 利用线性浅水和准地转（QG）动力学所蕴含的地转调整尺度，推导在纬度$\\phi=45^\\circ$处，用$c_1$和科里奥利参数$f$表示的第一斜压Rossby变形半径$L_{D,1}$。\n\n然后，使用$g=9.81\\,\\mathrm{m\\,s^{-2}}$和地球自转速率$\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s^{-1}}$计算$c_1$和$L_{D,1}$的数值。将$\\phi=45^\\circ$视为角度。将所求的两个量四舍五入到四位有效数字。将$c_1$以$\\mathrm{m\\,s^{-1}}$表示，将$L_{D,1}$以$\\mathrm{km}$表示。",
            "solution": "首先将根据指定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n- **系统**：一个$f$平面上连续层化、静力、Boussinesq海洋中的中纬度地转调整情景。\n- **激发源**：一个局地浮力异常。\n- **动力学过程**：垂直模态作为长重力波传播，并调整为平衡流。\n- **模型**：垂直模态分解，其中每个模态$n$的行为都像一个具有等效深度$h_n$和相速度$c_n$的浅水层。\n- **环境参数**：\n    - Brunt–Väisälä频率：$N=10^{-3}\\,\\mathrm{s^{-1}}$\n    - 总深度：$H=4000\\,\\mathrm{m}$\n- **模态1参数**：\n    - 等效深度：$h_1=50\\,\\mathrm{m}$\n- **常数**：\n    - 重力加速度：$g=9.81\\,\\mathrm{m\\,s^{-2}}$\n    - 地球自转速率：$\\Omega=7.2921159\\times 10^{-5}\\,\\mathrm{s^{-1}}$\n- **条件**：\n    - 纬度：$\\phi=45^\\circ$\n- **任务**：\n    1. 推导用$h_1$和$g$表示的模态1长波相速度$c_1$的表达式。\n    2. 推导在纬度$\\phi=45^\\circ$处，用$c_1$和科里奥利参数$f$表示的第一斜压Rossby变形半径$L_{D,1}$。\n    3. 计算$c_1$和$L_{D,1}$的数值，四舍五入到四位有效数字。\n    4. 将$c_1$以$\\mathrm{m\\,s^{-1}}$表示，将$L_{D,1}$以$\\mathrm{km}$表示。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题明确属于地球物理流体动力学的范畴。它使用了标准的模型（静力、Boussinesq、$f$平面）、概念（地转调整、垂直模态、Rossby半径）以及对于地球中纬度海洋而言是现实的参数值。\n- **适定性**：该问题是适定的。它为推导和计算提供了所有必要的信息。任务陈述明确无误。提供等效深度$h_1$简化了问题，避免了求解垂直结构（Sturm-Liouville）问题的需要，否则就需要给定的$N$和$H$。这是一种标准的教学简化，并不会使问题不完整。存在唯一解。\n- **客观性**：问题以精确、客观和定量的术语陈述。\n\n### 步骤3：结论和行动\n该问题是有效的。它是地球物理流体动力学中一个标准的、适定的问题。现在开始求解。\n\n根据要求，解答分为两个推导部分，然后进行数值计算。\n\n**1. 模态1相速度$c_1$的推导**\n\n问题陈述，在连续层化流体的垂直模态分解中，每个模态的行为都像一个浅水层。对于给定的垂直模态$n$，控制水平速度场$(u_n, v_n)$和压力场$p_n$的线性化方程可以写为：\n$$\n\\frac{\\partial u_n}{\\partial t} - f v_n = -\\frac{\\partial p_n}{\\partial x}\n$$\n$$\n\\frac{\\partial v_n}{\\partial t} + f u_n = -\\frac{\\partial p_n}{\\partial y}\n$$\n$$\n\\frac{\\partial p_n}{\\partial t} + c_n^2 \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\n这里，$u_n$、$v_n$和$p_n$代表模态$n$完整解的水平和时间部分，$c_n^2$是从变量分离中产生的本征值（分离常数）。这个常数$c_n$是该模态的长、无旋转重力波的相速度。\n\n这些方程可以与标准的线性浅水方程直接类比。对于平均深度为$h$、自由表面位移为$\\eta$的流体层，标准浅水方程为：\n$$\n\\frac{\\partial u}{\\partial t} - f v = -g \\frac{\\partial \\eta}{\\partial x}\n$$\n$$\n\\frac{\\partial v}{\\partial t} + f u = -g \\frac{\\partial \\eta}{\\partial y}\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + h \\left( \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} \\right) = 0\n$$\n为了建立对应关系，我们可以定义模态$n$的“等效表面高度”为$\\eta_n = p_n/g$。将$p_n = g \\eta_n$代入模态连续性方程，得到：\n$$\ng \\frac{\\partial \\eta_n}{\\partial t} + c_n^2 \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\n$$\n\\frac{\\partial \\eta_n}{\\partial t} + \\frac{c_n^2}{g} \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\n将此与标准浅水连续性方程进行比较，我们发现，如果我们将等效深度$h_n$等同于$c_n^2/g$项，那么这两个系统在动力学上是等效的。\n$$\nh_n = \\frac{c_n^2}{g}\n$$\n求解相速度$c_n$得到：\n$$\nc_n = \\sqrt{g h_n}\n$$\n这个关系将第$n$个模态重力波的相速度与其相应的等效深度联系起来。对于第一斜压模（$n=1$），表达式为：\n$$\nc_1 = \\sqrt{g h_1}\n$$\n\n**2. 第一斜压Rossby半径$L_{D,1}$的推导**\n\nRossby变形半径是旋转效应与层化效应（此处由重力波速度$c_n$表示）变得相当的特征长度尺度。它定义了向地转平衡调整的尺度。我们可以从模态$n$的线性化浅水方程中推导出这个尺度。\n\n让我们组合模态方程，以获得关于压力场$p_n$（或等价地，$\\eta_n$）的单个方程。对连续性方程求时间导数：\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} + c_n^2 \\left( \\frac{\\partial}{\\partial x} \\frac{\\partial u_n}{\\partial t} + \\frac{\\partial}{\\partial y} \\frac{\\partial v_n}{\\partial t} \\right) = 0\n$$\n从动量方程中代入$\\partial u_n/\\partial t$和$\\partial v_n/\\partial t$：\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} + c_n^2 \\left[ \\frac{\\partial}{\\partial x} \\left(f v_n - \\frac{\\partial p_n}{\\partial x}\\right) + \\frac{\\partial}{\\partial y} \\left(-f u_n - \\frac{\\partial p_n}{\\partial y}\\right) \\right] = 0\n$$\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} - c_n^2 \\nabla_h^2 p_n + f c_n^2 \\left( \\frac{\\partial v_n}{\\partial x} - \\frac{\\partial u_n}{\\partial y} \\right) = 0\n$$\n其中$\\nabla_h^2 = \\partial^2/\\partial x^2 + \\partial^2/\\partial y^2$。项$\\zeta_n = \\partial v_n/\\partial x - \\partial u_n/\\partial y$是模态$n$的相对涡度。从动量方程可以推导出涡度方程：\n$$\n\\frac{\\partial \\zeta_n}{\\partial t} + f \\left( \\frac{\\partial u_n}{\\partial x} + \\frac{\\partial v_n}{\\partial y} \\right) = 0\n$$\n使用连续性方程，这变为$\\frac{\\partial \\zeta_n}{\\partial t} - \\frac{f}{c_n^2} \\frac{\\partial p_n}{\\partial t} = 0$。对时间积分，对于初始静止状态，得到位涡守恒：$\\zeta_n = \\frac{f}{c_n^2} p_n$。\n\n将其代回波动方程得到：\n$$\n\\frac{\\partial^2 p_n}{\\partial t^2} - c_n^2 \\nabla_h^2 p_n + f^2 p_n = 0\n$$\n这是Klein-Gordon方程的一种形式。一个地转调整后的稳态（$\\partial/\\partial t = 0$）必须满足：\n$$\n- c_n^2 \\nabla_h^2 p_n + f^2 p_n = 0 \\quad \\implies \\quad \\nabla_h^2 p_n - \\frac{f^2}{c_n^2} p_n = 0\n$$\n这是一个Helmholtz方程。它表明，平衡场$p_n$中的空间结构必须在一个特征长度尺度$L$上衰减或振荡，使得$1/L^2$的量级为$f^2/c_n^2$。这个尺度就是Rossby变形半径，$L_{D,n}$：\n$$\nL_{D,n} = \\frac{c_n}{|f|}\n$$\n$f$的符号无关紧要，因为长度尺度必须为正。由于问题指定的是中纬度情景，$f \\neq 0$。对于第一斜压模，表达式为：\n$$\nL_{D,1} = \\frac{c_1}{f}\n$$\n（假设$\\phi0$使得$f0$）。\n\n**3. 数值计算**\n\n问题提供了以下用于计算的值：\n$g = 9.81\\,\\mathrm{m\\,s^{-2}}$\n$h_1 = 50\\,\\mathrm{m}$\n$\\phi = 45^\\circ$\n$\\Omega = 7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}$\n\n首先，我们计算第一斜压模的相速度$c_1$：\n$$\nc_1 = \\sqrt{g h_1} = \\sqrt{(9.81\\,\\mathrm{m\\,s^{-2}}) \\times (50\\,\\mathrm{m})} = \\sqrt{490.5\\,\\mathrm{m^2\\,s^{-2}}} \\approx 22.14723\\,\\mathrm{m\\,s^{-1}}\n$$\n四舍五入到四位有效数字，我们得到$c_1 = 22.15\\,\\mathrm{m\\,s^{-1}}$。\n\n接下来，我们计算纬度$\\phi=45^\\circ$处的科里奥利参数$f$：\n$$\nf = 2 \\Omega \\sin\\phi = 2 \\times (7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\sin(45^\\circ)\n$$\n$$\nf = 2 \\times (7.2921159 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\frac{\\sqrt{2}}{2} \\approx 1.03126 \\times 10^{-4}\\,\\mathrm{s^{-1}}\n$$\n现在，我们可以计算第一斜压Rossby变形半径，$L_{D,1}$：\n$$\nL_{D,1} = \\frac{c_1}{f} = \\frac{22.14723\\,\\mathrm{m\\,s^{-1}}}{1.03126 \\times 10^{-4}\\,\\mathrm{s^{-1}}} \\approx 214757.5\\,\\mathrm{m}\n$$\n问题要求答案以千米为单位。将米转换为千米：\n$$\nL_{D,1} \\approx 214.7575\\,\\mathrm{km}\n$$\n四舍五入到四位有效数字，我们得到$L_{D,1} = 214.8\\,\\mathrm{km}$。\n\n最终计算值为$c_1 \\approx 22.15\\,\\mathrm{m\\,s^{-1}}$和$L_{D,1} \\approx 214.8\\,\\mathrm{km}$。请注意，计算中不需要给定的$N$和$H$值，因为等效深度$h_1$是直接给出的。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 22.15  214.8 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在确定了基本尺度之后，下一步是探究地转适应过程的动态核心。这个练习应用了强大的位涡守恒原理，来确定一个初始不平衡扰动如何最终演变为平衡态 。通过推导最终平衡态振幅与初始振幅的比率，你将深刻理解为何扰动的空间尺度相对于罗斯贝半径的大小，是决定能量分配和适应结果的关键因素。",
            "id": "4048418",
            "problem": "在数值天气预报和气候模拟中，对地转适应的理解决定了初始的非平衡扰动如何分配为慢速的平衡运动和快速的重力波。考虑一个位于恒定科里奥利参数平面（$f$ 平面）上的单层浅水系统，其平均深度为 $H$，重力加速度为 $g$，科里奥利参数为 $f$。Rossby 变形半径定义为 $L_D = \\sqrt{g H}/f$。在时间 $t=0$ 时，假设流体处于静止状态，自由面高度受到一个波数大小为 $k$（通过 $k \\approx 1/L$ 与水平尺度 $L$ 相关联）、振幅为 $\\eta_0$ 的单一水平各向同性傅里葉模態的扰动。区域是无界的，且没有外部强迫。\n\n仅从线性化浅水方程、线性化位涡守恒以及速度與自由面高度之间的准地转 (QG) 平衡关系出发，确定在地转适应之后，该模态的平衡自由面高度响应的振幅 $\\eta_b$。将您的最终结果表示为在小尺度极限 $L \\ll L_D$ 下简化的比率 $\\eta_b/\\eta_0$ 的解析表达式。然后，利用线性浅水能量，简要地提供一个物理上的合理解释，说明为什么在此极限下，大部分初始能量被重力波带走。\n\n您的最终答案必须是一个在 $L \\ll L_D$ 极限下有效的、关于 $\\eta_b/\\eta_0$ 的单一闭合形式解析表达式。",
            "solution": "首先对问题陈述进行验证过程。\n\n### 步骤 1：提取已知条件\n- **系统**：位于恒定科里奥利参数平面（$f$ 平面）上的单层浅水系统。\n- **物理常数**：平均流体深度 $H$，重力加速度 $g$，科里奥利参数 $f$。\n- **定义参数**：Rossby 变形半径，$L_D = \\frac{\\sqrt{g H}}{f}$。\n- **初始条件 ($t=0$)**：\n    - 无运动：$u(x, y, 0) = 0$, $v(x, y, 0) = 0$。\n    - 自由面高度扰动：一个波数大小为 $k$、振幅为 $\\eta_0$ 的单一水平各向同性傅里叶模态。水平尺度由 $L \\approx 1/k$ 给出。\n- **区域与强迫**：区域是无界的，且没有外部强迫。\n- **所需工具**：线性化浅水方程，线性化位涡守恒，以及准地转 (QG) 平衡关系。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题是地球物理流体力学中的一个经典基础练习，涉及地转适应过程。它基于公认的浅水方程和位涡守恒原理。所有概念都是该领域的标准概念。\n- **适定性**：该问题是适定的。初始状态被完全指定，位涡守恒原理为确定最终平衡状态提供了唯一的途径。\n- **客观性**：语言精确、技术性强，没有任何主观或模糊的陈述。\n\n### 步驟 3：結論與行動\n该问题在科学上是合理的、适定的和客观的。它没有违反任何无效性标准。因此，该问题被认为是有效的，并将提供完整解答。\n\n### 解答推导\n\n解决这个问题的核心原理是线性化位涡 (PV) 守恒。由高度扰动和零速度组成的初始状态将演变为一个最终状态，该状态由稳定的地转平衡流和瞬态的、传播的重力波组成。当重力波在无界区域中辐射出去后，只剩下平衡状态。这个最终平衡状态的 PV 必须等于初始状态的 PV。\n\n浅水系统的线性化位涡扰动 $q'$ 由下式给出：\n$$\nq' = \\frac{\\zeta - \\frac{f}{H}\\eta}{H}\n$$\n其中 $\\zeta = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$ 是相对涡度，$\\eta$ 是自由面高度扰动。在没有强迫和耗散的情况下，$q'$ 跟随流体质点守恒。对于线性化动力学，这意味着 $\\frac{\\partial q'}{\\partial t} = 0$，因此任何时刻的 PV 场都与初始 PV 场相同。\n\n我们将按照题目要求，对单个傅里叶模态进行分析。设初始高度扰动为 $\\eta(x, y, 0) = \\eta_0 \\exp(i(k_x x + k_y y))$，其中 $k^2 = k_x^2 + k_y^2$。我们将场 $A$ 的傅里叶振幅记为 $\\hat{A}$。\n\n**1. 初始状态位涡 ($t=0$)**\n初始条件为 $u_0 = 0$ 和 $v_0 = 0$。这意味着初始相对涡度为零：$\\zeta_0 = 0$。初始高度扰动的振幅为 $\\eta_0$。初始 PV 扰动的傅里叶振幅 $\\hat{q'}_0$ 为：\n$$\n\\hat{q'}_0 = \\frac{1}{H} \\left( \\hat{\\zeta}_0 - \\frac{f}{H}\\hat{\\eta}_0 \\right) = \\frac{1}{H} \\left( 0 - \\frac{f}{H}\\hat{\\eta}_0 \\right) = -\\frac{f}{H^2}\\hat{\\eta}_0\n$$\n\n**2. 最终平衡状态位涡 ($t \\to \\infty$)**\n经过适应过程后，系统进入地转平衡状态，用下标 '$b$' 表示。地转平衡关系为：\n$$\n-fv_b = -g \\frac{\\partial \\eta_b}{\\partial x} \\quad \\implies \\quad \\hat{v}_b = \\frac{g}{f}(ik_x)\\hat{\\eta}_b\n$$\n$$\nfu_b = -g \\frac{\\partial \\eta_b}{\\partial y} \\quad \\implies \\quad \\hat{u}_b = -\\frac{g}{f}(ik_y)\\hat{\\eta}_b\n$$\n平衡流的相对涡度 $\\zeta_b$ 为 $\\zeta_b = \\frac{\\partial v_b}{\\partial x} - \\frac{\\partial u_b}{\\partial y}$。在傅里叶空间中，这变为：\n$$\n\\hat{\\zeta}_b = ik_x \\hat{v}_b - ik_y \\hat{u}_b = ik_x \\left( \\frac{igk_x}{f}\\hat{\\eta}_b \\right) - ik_y \\left( -\\frac{igk_y}{f}\\hat{\\eta}_b \\right)\n$$\n$$\n\\hat{\\zeta}_b = \\left( -\\frac{gk_x^2}{f} - \\frac{gk_y^2}{f} \\right) \\hat{\\eta}_b = -\\frac{g k^2}{f}\\hat{\\eta}_b\n$$\n这个方程代表了平衡涡度场和高度场之间的 QG 关系。现在，我们计算这个最终平衡状态的 PV 扰动的傅里叶振幅：\n$$\n\\hat{q'}_b = \\frac{1}{H} \\left( \\hat{\\zeta}_b - \\frac{f}{H}\\hat{\\eta}_b \\right) = \\frac{1}{H} \\left( -\\frac{g k^2}{f}\\hat{\\eta}_b - \\frac{f}{H}\\hat{\\eta}_b \\right) = -\\left( \\frac{g k^2}{fH} + \\frac{f}{H^2} \\right) \\hat{\\eta}_b\n$$\n\n**3. 应用 PV 守恒并推导比率**\n根据位涡守恒，$\\hat{q'}_0 = \\hat{q'}_b$：\n$$\n-\\frac{f}{H^2}\\hat{\\eta}_0 = -\\left( \\frac{g k^2}{fH} + \\frac{f}{H^2} \\right) \\hat{\\eta}_b\n$$\n求解最终平衡振幅与初始振幅之比 $\\eta_b/\\eta_0$（其等于 $\\hat{\\eta}_b/\\hat{\\eta}_0$）：\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{\\frac{f}{H^2}}{\\frac{g k^2}{fH} + \\frac{f}{H^2}} = \\frac{f^2}{g k^2 H + f^2}\n$$\n分子分母同除以 $f^2$：\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{1}{\\frac{gH}{f^2}k^2 + 1}\n$$\n使用 Rossby 变形半径的定义 $L_D = \\sqrt{g H}/f$，因此 $L_D^2 = gH/f^2$，我们得到通用表达式：\n$$\n\\frac{\\eta_b}{\\eta_0} = \\frac{1}{1 + k^2 L_D^2}\n$$\n\n**4. 小尺度极限**\n问题要求在小尺度极限 $L \\ll L_D$ 下的比率。考虑到关联式 $k \\approx 1/L$，此极限等价于 $1/k \\ll L_D$，或 $k L_D \\gg 1$。在此极限下，分母中的项 $1$ 与 $k^2 L_D^2$ 相比可以忽略不计：\n$$\n\\frac{\\eta_b}{\\eta_0} \\approx \\frac{1}{k^2 L_D^2}\n$$\n代入 $k \\approx 1/L$，我们可以用长度尺度来表示这个结果：\n$$\n\\frac{\\eta_b}{\\eta_0} \\approx \\left(\\frac{L}{L_D}\\right)^2\n$$\n这个表达式表明，对于尺度远小于 Rossby 半径的初始扰动，最终平衡高度场的振幅比初始振幅小一个平方量级。\n\n**5. 通过能量守恒的物理解释**\n线性浅水系统中的总能量密度（单位面积）是动能 (KE) 和有效势能 (APE) 的总和：\n$$\nE = \\text{KE} + \\text{APE} = \\frac{1}{2} H (u^2 + v^2) + \\frac{1}{2} g \\eta^2\n$$\n初始状态有 $u_0=v_0=0$，所以其能量完全是势能。对于振幅为 $\\eta_0$ 的单个模态，初始能量为 $E_0 \\propto \\frac{1}{2}g\\eta_0^2$。\n最终平衡状态同时具有动能和势能。平衡状态的能量为 $E_b \\propto \\frac{1}{2}H(u_b^2+v_b^2) + \\frac{1}{2}g\\eta_b^2$。\n根据地转关系，单个模态的平衡状态动能与其势能相关：\n$$\n\\text{KE}_b \\propto \\frac{1}{2}H \\frac{g^2 k^2}{f^2} \\eta_b^2 = \\frac{1}{2}g\\eta_b^2 \\left(\\frac{gH k^2}{f^2}\\right) = \\text{APE}_b \\cdot (k^2 L_D^2)\n$$\n因此，最终平衡状态的总能量为：\n$$\nE_b = \\text{APE}_b + \\text{KE}_b = \\text{APE}_b (1 + k^2 L_D^2) \\propto \\frac{1}{2}g\\eta_b^2(1+k^2L_D^2)\n$$\n使用我们得到的振幅比结果 $\\eta_b = \\eta_0 / (1+k^2L_D^2)$：\n$$\nE_b \\propto \\frac{1}{2}g \\left(\\frac{\\eta_0}{1+k^2L_D^2}\\right)^2 (1+k^2L_D^2) = \\left(\\frac{1}{2}g\\eta_0^2\\right) \\frac{1}{1+k^2L_D^2}\n$$\n所以，最终平衡能量与初始能量之比为：\n$$\n\\frac{E_b}{E_0} = \\frac{1}{1+k^2L_D^2}\n$$\n在小尺度极限 ($kL_D \\gg 1$) 下，这个比率变得非常小：\n$$\n\\frac{E_b}{E_0} \\approx \\frac{1}{k^2L_D^2} \\ll 1\n$$\n这表明只有极小一部分初始能量保留在平衡流中。由于浅水方程是总能量守恒的，绝大部分初始能量 $E_0 - E_b$ 必然被分配到解的瞬态部分，即惯性重力波。这些波从初始扰动区域传播开去，从而有效地移除了大部分能量，留下一个低能量的地转平衡状态。这为为何小尺度初始扰动下最终平衡振幅 $\\eta_b$ 如此之小提供了物理解释。\n最终答案是在指定极限下振幅比的简化表达式。使用长度尺度 $L$ 提供了一个更直观的形式。",
            "answer": "$$\n\\boxed{\\left(\\frac{L}{L_D}\\right)^2}\n$$"
        },
        {
            "introduction": "在现代大气和海洋科学中，将理论与实践相结合至关重要。本练习将引导你从解析推导走向动手数值实现，利用谱方法从给定的位涡异常分布中计算出最终的平衡流场 。这是一个在数值天气预报和气候模拟中常见的核心任务，它将加深你对准地转理论在实际模型中应用的理解。",
            "id": "4048382",
            "problem": "您的任务是为单层准地转（QG）地转适应过程实现谱反演，该过程在双周期域上进行，以计算与规定的离散位涡异常相关的平衡速度场和高度场。推导和算法必须从旋转浅水方程和地转平衡出发，并通过准地转位涡反演原理进行。程序必须计算诊断指标并评估域大小的影响。\n\n起点和物理背景：\n- 考虑一个在$f$平面上的单层旋转浅水系统，其中科里奥利参数$f_0$和重力加速度$g$为常数。设平均深度为$H$，变形半径为$L_D = \\sqrt{g H} / f_0$。\n- 施加地转平衡和小罗斯贝数，与准地转尺度分析一致。在此尺度下，定义一个流函数$\\psi$，使得水平速度场为$u = -\\partial \\psi / \\partial y$和$v = \\partial \\psi / \\partial x$。自由面高度扰动$\\eta$通过地转平衡与流函数相关联。\n- 准地转位涡$q$在网格上定义，并且必须在双周期域上进行谱反演，以获得平衡的$\\psi$，从而得出$u$、$v$和$\\eta$。\n\n算法和数值要求：\n- 在物理尺寸为$L_x \\times L_y$的矩形周期域上使用一个$N \\times N$点的均匀网格。在此网格上定义离散位涡异常$q(x,y)$，其形式为两个符号相反、各向同性的高斯异常之和，这两个异常的中心位置关于域中心对称，以确保净积分为零：\n  $$ q(x, y) = A \\exp\\left(-\\frac{(x - x_c - \\delta_x)^2 + (y - y_c)^2}{2 \\sigma^2}\\right) - A \\exp\\left(-\\frac{(x - x_c + \\delta_x)^2 + (y - y_c)^2}{2 \\sigma^2}\\right), $$\n  其中$(x_c, y_c)$是域中心，$A$是异常振幅，$\\sigma$是高斯宽度，$\\delta_x$是沿$x$方向偏离中心的距离。所有量都必须使用国际单位制（SI）。\n- 使用与双周期域一致的谱方法反演平衡流函数$\\psi$。计算由$\\psi$所隐含的地转速度$(u, v)$和高度扰动$\\eta$。\n- 通过为每个测试案例计算两个指标来量化域大小的影响：\n  1. 域上的最大地转速率，\n     $$ U_{\\max} = \\max \\sqrt{u^2 + v^2}, $$\n     以米/秒（m/s）表示。\n  2. 高度扰动的均方根，\n     $$ \\eta_{\\mathrm{rms}} = \\sqrt{\\langle \\eta^2 \\rangle}, $$\n     以米（m）表示。\n- 将报告的每个指标四舍五入到六位小数。\n\n使用的物理常数和参数：\n- $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$，\n- $g = 9.81$ m s$^{-2}$，\n- $H = 5000$ m，\n- $A = 1.0 \\times 10^{-5}$ s$^{-1}$，\n- $\\sigma = 2.5 \\times 10^{5}$ m，\n- $\\delta_x = 3.0 \\times 10^{5}$ m，\n- $N = 128$。\n\n谱方法要求：\n- 使用离散傅里叶变换，其波数的定义与物理域尺寸$L_x$和$L_y$一致，使得对于离散变换，波数数组为$k_x = 2 \\pi n_x / L_x$和$k_y = 2 \\pi n_y / L_y$，其中$n_x$和$n_y$由适当的离散频率指数给出。\n- 采用双周期边界条件，并确保反演对所有模式（包括零模式）都是适定的。\n- 在谱空间中实现反演和微分，以避免数值微分误差。\n\n测试套件：\n使用以下四个测试案例来评估域大小的影响，同时保持所有其他参数不变：\n1. $L_x = 4.0 \\times 10^{6}$ m, $L_y = 4.0 \\times 10^{6}$ m,\n2. $L_x = 2.0 \\times 10^{6}$ m, $L_y = 2.0 \\times 10^{6}$ m,\n3. $L_x = 8.0 \\times 10^{6}$ m, $L_y = 8.0 \\times 10^{6}$ m,\n4. $L_x = 6.0 \\times 10^{5}$ m, $L_y = 6.0 \\times 10^{5}$ m.\n\n所需输出：\n- 对于每个测试案例，计算并返回一对$(U_{\\max}, \\eta_{\\mathrm{rms}})$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按测试案例和指标顺序排列，例如：\n  $$ [U_{\\max,1}, \\eta_{\\mathrm{rms},1}, U_{\\max,2}, \\eta_{\\mathrm{rms},2}, U_{\\max,3}, \\eta_{\\mathrm{rms},3}, U_{\\max,4}, \\eta_{\\mathrm{rms},4}] $$\n- 将$U_{\\max}$以米/秒（m/s）表示，$\\eta_{\\mathrm{rms}}$以米（m）表示，每个都四舍五入到六位小数。\n\n不允许用户输入或外部文件。程序必须完全自包含，并且必须遵守指定的输出格式。",
            "solution": "问题陈述是适定的、有科学依据的，并且包含了继续进行所需的所有信息。它描述了地球物理流体动力学中的一个经典数值问题：准地转位涡（QG-PV）的反演，以找到平衡流场和质量场。未检测到不一致、模糊或事实错误。\n\n解决方案首先从给定的物理原理建立控制数学方程。然后，为在双周期域上求解该方程制定了谱方法。最后，描述了一个详细的计算算法，以实现此方法并为指定的测试案例计算所需的诊断指标。\n\n**1. 理论基础：准地转位涡反演方程**\n\n问题设定在$f$平面上的单层旋转浅水系统框架内，并采用准地转（QG）近似。QG近似假设罗斯贝数很小，意味着流动几乎处于地转平衡状态。\n\n地转平衡将气压梯度力与科里奥利力联系起来。在浅水模型中，这种平衡将自由面高度扰动$\\eta$与地转流函数$\\psi$联系起来。地转速度分量定义为$u = -\\partial\\psi/\\partial y$和$v = \\partial\\psi/\\partial x$。$\\eta$和$\\psi$之间的关系由动量方程导出：\n$$ f_0 u = -g \\frac{\\partial\\eta}{\\partial y} \\quad \\text{和} \\quad -f_0 v = -g \\frac{\\partial\\eta}{\\partial x} $$\n将$u$和$v$用$\\psi$的定义代入得到：\n$$ -f_0 \\frac{\\partial\\psi}{\\partial y} = -g \\frac{\\partial\\eta}{\\partial y} \\quad \\text{和} \\quad -f_0 \\frac{\\partial\\psi}{\\partial x} = -g \\frac{\\partial\\eta}{\\partial x} $$\n对这些方程积分得到$\\eta = (f_0/g)\\psi + \\text{const}$。对于从静止状态开始的扰动，常数为零，从而得到关系式：\n$$ \\eta = \\frac{f_0}{g}\\psi $$\n准地转位涡$q$是地转流所守恒的量。对于单层系统，它由相对涡度和与高度场相关的伸缩项组成：\n$$ q = \\zeta_g - \\frac{f_0}{H}\\eta $$\n其中$\\zeta_g$是地转相对涡度，$H$是平均流体深度。将$\\zeta_g$和$\\eta$的地转关系用$\\psi$表示：\n$$ \\zeta_g = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial\\psi}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial\\psi}{\\partial y}\\right) = \\nabla^2\\psi $$\n$$ q = \\nabla^2\\psi - \\frac{f_0}{H}\\left(\\frac{f_0}{g}\\psi\\right) = \\nabla^2\\psi - \\frac{f_0^2}{gH}\\psi $$\n问题将罗斯贝变形半径定义为$L_D = \\sqrt{g H} / f_0$。因此，项$f_0^2/(gH)$等于$1/L_D^2$。这就得到了QG-PV反演方程，这是一个将位涡异常$q$与流函数$\\psi$联系起来的亥姆霍兹方程：\n$$ q(x, y) = \\nabla^2\\psi(x, y) - \\frac{1}{L_D^2}\\psi(x, y) $$\n这个方程是诊断性的，意味着如果$q$在每一点都已知，那么$\\psi$（以及平衡速度场和高度场）就可以通过求解该方程来确定。\n\n**2. 谱反演方法**\n\n对于双周期域，使用离散傅里叶变换（DFT）的谱方法非常适用。我们将场$q(x,y)$和$\\psi(x,y)$表示为傅里叶模式的和：\n$$ \\psi(x, y) = \\sum_{k_x, k_y} \\hat{\\psi}(k_x, k_y) e^{i(k_x x + k_y y)} $$\n谱空间中的拉普拉斯算子变成简单的乘法：$\\mathcal{F}(\\nabla^2\\psi) = -(k_x^2 + k_y^2)\\hat{\\psi} = -K^2\\hat{\\psi}$，其中$\\mathcal{F}$表示傅里叶变换，$K^2 = k_x^2 + k_y^2$是总波数的平方。\n对QG-PV反演方程应用傅里叶变换得到：\n$$ \\hat{q}(k_x, k_y) = -K^2 \\hat{\\psi}(k_x, k_y) - \\frac{1}{L_D^2}\\hat{\\psi}(k_x, k_y) = -\\left(K^2 + \\frac{1}{L_D^2}\\right)\\hat{\\psi}(k_x, k_y) $$\n这个代数方程可以求解谱流函数$\\hat{\\psi}$：\n$$ \\hat{\\psi}(k_x, k_y) = - \\frac{\\hat{q}(k_x, k_y)}{K^2 + 1/L_D^2} $$\n对于所有波数，该表达式都是良定的，因为对于实数$L_D$，分母$K^2 + 1/L_D^2$是严格为正的。零波数模式（$K=0$）也能处理而无奇异性。\n\n**3. 算法实现**\n\n数值解的实现如下：\n\n1.  **常数和网格设置：** 定义物理常数$f_0, g, H$和异常参数$A, \\sigma, \\delta_x$。网格点数为$N=128$。对于每个具有域大小$L_x \\times L_y$的测试案例，构建一个均匀的笛卡尔网格，坐标为$x_i = i \\cdot L_x/N$和$y_j = j \\cdot L_y/N$，其中$i, j \\in \\{0, 1, \\dots, N-1\\}$。\n\n2.  **PV异常构建：** 使用指定的两个高斯异常之和的公式，在网格上计算离散位涡场$q(x,y)$。\n\n3.  **谱反演：**\n    a. 计算离散场$q(x,y)$的二维快速傅里叶变换（FFT），以获得其谱表示$\\hat{q}(k_x, k_y)$。\n    b. 生成离散波数$k_x$和$k_y$的网格，这些波数对应于物理域大小和网格点数。\n    c. 使用上面导出的代数反演公式计算谱流函数$\\hat{\\psi}$。\n\n4.  **场计算：**\n    a. 通过谱微分获得速度分量$u$和$v$。速度分量的傅里叶变换为$\\hat{u} = -i k_y \\hat{\\psi}$和$\\hat{v} = i k_x \\hat{\\psi}$。\n    b. 对$\\hat{u}$和$\\hat{v}$应用逆二维FFT，恢复物理速度场$u(x,y)$和$v(x,y)$。\n    c. 对$\\hat{\\psi}$应用逆二维FFT，找到物理流函数场$\\psi(x,y)$。然后直接计算高度扰动场为$\\eta(x,y) = (f_0/g)\\psi(x,y)$。\n\n5.  **诊断指标：**\n    a. 计算地转速率场为$\\sqrt{u(x,y)^2 + v(x,y)^2}$。在整个域上找到最大值$U_{\\max}$。\n    b. 计算高度扰动的均方根$\\eta_{\\mathrm{rms}} = \\sqrt{\\langle \\eta^2 \\rangle}$，其中$\\langle \\cdot \\rangle$表示域上的空间平均。\n\n**4. 参数和测试案例**\n\n该算法使用以下固定参数：\n- $f_0 = 1.0 \\times 10^{-4}$ s$^{-1}$\n- $g = 9.81$ m s$^{-2}$\n- $H = 5000$ m\n- $A = 1.0 \\times 10^{-5}$ s$^{-1}$\n- $\\sigma = 2.5 \\times 10^{5}$ m\n- $\\delta_x = 3.0 \\times 10^{5}$ m\n- $N = 128$\n\n由此可得，罗斯贝变形半径为$L_D = \\sqrt{gH}/f_0 \\approx 2.215 \\times 10^6$ m。\n\n对四个方形域（$L_x = L_y = L$）评估域大小的影响：\n1.  案例1：$L = 4.0 \\times 10^6$ m\n2.  案例2：$L = 2.0 \\times 10^6$ m\n3.  案例3：$L = 8.0 \\times 10^6$ m\n4.  案例4：$L = 6.0 \\times 10^5$ m\n\n对于案例4，域宽$L_x$恰好等于高斯异常中心间距$2\\delta_x$。在周期性域上，这导致正异常和负异常的中心位于相同位置（$x=0$ 和 $x=L_x$），从而导致它们精确抵消。因此，输入位涡场$q(x,y)$为零，导致平衡场也为零，因此$U_{\\max}=0$和$\\eta_{\\mathrm{rms}}=0$。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a spectral inversion for one-layer quasi-geostrophic\n    geostrophic adjustment on a doubly periodic domain to compute\n    balanced velocity and height fields from a prescribed PV anomaly.\n    \"\"\"\n    # Physical constants and parameters\n    f0 = 1.0e-4  # Coriolis parameter (s^-1)\n    g = 9.81  # Gravitational acceleration (m/s^2)\n    H = 5000.0  # Mean depth (m)\n    A = 1.0e-5  # PV anomaly amplitude (s^-1)\n    sigma = 2.5e5  # Gaussian width (m)\n    delta_x = 3.0e5  # Gaussian x-offset (m)\n    N = 128  # Grid resolution\n\n    # Derived constants\n    Ld = np.sqrt(g * H) / f0\n    Ld2_inv = 1.0 / (Ld**2)\n\n    # Test suite for domain sizes (Lx, Ly)\n    test_cases = [\n        (4.0e6, 4.0e6),\n        (2.0e6, 2.0e6),\n        (8.0e6, 8.0e6),\n        (6.0e5, 6.0e5),\n    ]\n\n    results = []\n\n    for Lx, Ly in test_cases:\n        # 1. Create the physical grid\n        x = np.linspace(0, Lx, N, endpoint=False)\n        y = np.linspace(0, Ly, N, endpoint=False)\n        X, Y = np.meshgrid(x, y, indexing='ij')\n\n        # 2. Define the potential vorticity anomaly q(x,y)\n        xc, yc = Lx / 2.0, Ly / 2.0\n        \n        # Gaussian centered at (xc + delta_x, yc)\n        term1 = np.exp(-((X - xc - delta_x)**2 + (Y - yc)**2) / (2 * sigma**2))\n        # Gaussian centered at (xc - delta_x, yc)\n        term2 = np.exp(-((X - xc + delta_x)**2 + (Y - yc)**2) / (2 * sigma**2))\n        \n        q = A * (term1 - term2)\n\n        # 3. Create the wavenumber grid\n        kx_1d = 2 * np.pi * np.fft.fftfreq(N, d=Lx / N)\n        ky_1d = 2 * np.pi * np.fft.fftfreq(N, d=Ly / N)\n        KX, KY = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n        K2 = KX**2 + KY**2\n\n        # 4. Perform the spectral inversion\n        q_hat = np.fft.fftn(q)\n        \n        # Denominator for the Helmholtz problem in spectral space\n        # This is K^2 + 1/Ld^2, which is always positive, so no singularity.\n        denominator = K2 + Ld2_inv\n        \n        psi_hat = -q_hat / denominator\n\n        # 5. Compute velocity and height fields\n        \n        # Compute velocity components u, v using spectral differentiation\n        u_hat = -1j * KY * psi_hat\n        v_hat = 1j * KX * psi_hat\n        u = np.fft.ifftn(u_hat).real\n        v = np.fft.ifftn(v_hat).real\n\n        # Compute height perturbation eta\n        psi = np.fft.ifftn(psi_hat).real\n        eta = (f0 / g) * psi\n        \n        # 6. Calculate diagnostic metrics\n        \n        # Maximum geostrophic speed\n        U_max = np.max(np.sqrt(u**2 + v**2))\n        \n        # Root-mean-square height perturbation\n        eta_rms = np.sqrt(np.mean(eta**2))\n\n        # 7. Store rounded results\n        results.append(round(U_max, 6))\n        results.append(round(eta_rms, 6))\n\n    # Format and print the final output string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}