{
    "hands_on_practices": [
        {
            "introduction": "一个好的近似方法应当在简化条件下回归到精确的理论。本练习 () 旨在验证双流和 delta-Eddington 方法的可靠性，通过证明它们在光学薄层这一极限情况下，能够再现从基本辐射传输方程 (RTE) 推导出的正确一阶行为。这项实践将帮助你建立对这些近似方法物理基础的信心。",
            "id": "4106751",
            "problem": "考虑一个均匀的、平面平行的、单色光学厚度很小（$\\Delta\\tau \\ll 1$）的大气层，其下方为一个完全吸收的下边界（黑体表面）。该介质不发射辐射，也不发生折射。散射是各向同性的，单次散射反照率为 $\\omega_{0} \\in [0,1]$。一束通量为 $F_{0}$ 的准直光束从上边界垂直入射到该层。定义半球反射率 $R$ 为从上边界出射的向上半球通量与 $F_{0}$之比，定义半球透射率 $T$ 为从下边界出射的向下半球通量与 $F_{0}$之比。假设该大气层是水平均匀和稳态的，并忽略除入射光束外的任何其他源。\n\n从具有各向同性散射和垂直入射准直光束的相应边界条件的平面平行单色辐射传输方程（RTE）出发，推导在单次散射近似下，由精确RTE解得出的 $R$ 和 $T$ 关于 $\\Delta\\tau$ 的一阶展开式。然后，在各向同性散射（非对称因子 $g=0$）条件下，分析采用 Eddington 闭合的双流近似和 Delta-Eddington 近似（前向峰截断 Eddington）。证明在 $\\Delta\\tau$ 的一阶近似下，双流近似和 Delta-Eddington 近似的预测结果与精确 RTE 的单次散射结果一致。\n\n将你的最终答案表示为由展开式 $R = R_{1}\\,\\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^{2})$ 和 $T = 1 + T_{1}\\,\\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^{2})$ 定义的主阶系数有序对 $(R_{1}, T_{1})$。提供以 $\\omega_{0}$ 表示的精确表达式。无需四舍五入。$R$ 和 $T$ 是无量纲的。",
            "solution": "该问题要求基于三种不同的理论框架推导和比较一个薄的、各向同性散射层的半球反射率 $R$ 和透射率 $T$：精确辐射传输方程（RTE）的单次散射近似、双流 Eddington 近似和 Delta-Eddington 近似。目标是求出 $R$ 和 $T$ 关于小光学厚度 $\\Delta\\tau$ 的一阶展开系数，并证明这三种方法在此阶次上得出相同的结果。展开式定义为 $R = R_{1}\\,\\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^{2})$ 和 $T = 1 + T_{1}\\,\\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^{2})$。\n\n设光学深度 $\\tau$ 为垂直坐标，大气层顶部为 $\\tau=0$，下边界为 $\\tau=\\Delta\\tau$。辐射方向由 $\\mu = \\cos\\theta$ 指定，其中 $\\theta$ 是天顶角。一束通量为 $F_0$ 的准直光束垂直入射，因此其方向由 $\\mu_0=1$ 表征。\n\n**1. 单次散射近似**\n\n漫射辐射亮度 $I_d(\\tau, \\mu)$ 的平面平行辐射传输方程（RTE）由下式给出\n$$\n\\mu \\frac{dI_d(\\tau, \\mu)}{d\\tau} = -I_d(\\tau, \\mu) + J_d(\\tau, \\mu)\n$$\n其中 $J_d$ 是漫射辐射的源函数。在单次散射近似中，我们仅考虑直接、未衰减光束的散射作为漫射光的源。垂直入射时，深度 $\\tau$ 处的直接光束为 $F_0 e^{-\\tau}$。此光束的各向同性散射的源函数为\n$$\nJ_{ss}(\\tau) = \\frac{\\omega_0}{4\\pi} \\times (\\text{scattering cross section per unit volume}) \\times (\\text{incident solar radiance}) = \\frac{\\omega_0 F_0}{4\\pi} e^{-\\tau}\n$$\n这假设入射通量 $F_0$ 由辐射场 $F_0 \\delta(\\mu-1)\\delta(\\phi)$ 表示。\n\nRTE 的形式解取决于方向。\n\n*   **向上漫射辐射亮度 ($R$)**\n    对于向上传播的辐射亮度（$\\mu  0$），我们将 RTE 从点 $\\tau$ 积分到下边界 $\\Delta\\tau$ 处，该处的边界条件是黑体表面没有向上的漫射辐射亮度，即 $I_d(\\Delta\\tau, \\mu) = 0$。解为：\n    $$\n    I_d(\\tau, \\mu) = \\int_{\\tau}^{\\Delta\\tau} \\frac{J_{ss}(t)}{|\\mu|} e^{-(t-\\tau)/|\\mu|} dt\n    $$\n    在大气层顶部（$\\tau=0$），向上的辐射亮度为（使用 $\\mu'=-\\mu  0$）：\n    $$\n    I_d(0, -\\mu') = \\frac{1}{\\mu'} \\int_{0}^{\\Delta\\tau} J_{ss}(t) e^{-t/\\mu'} dt = \\frac{\\omega_0 F_0}{4\\pi\\mu'} \\int_{0}^{\\Delta\\tau} e^{-t} e^{-t/\\mu'} dt = \\frac{\\omega_0 F_0}{4\\pi\\mu'} \\int_{0}^{\\Delta\\tau} e^{-t(1+1/\\mu')} dt\n    $$\n    $$\n    I_d(0, -\\mu') = \\frac{\\omega_0 F_0}{4\\pi\\mu'} \\left[ -\\frac{e^{-t(1+1/\\mu')}}{1+1/\\mu'} \\right]_{0}^{\\Delta\\tau} = \\frac{\\omega_0 F_0}{4\\pi(\\mu'+1)} \\left( 1 - e^{-\\Delta\\tau(1+1/\\mu')} \\right)\n    $$\n    对于光学薄层，其中 $\\Delta\\tau \\ll 1$，我们可以展开指数函数：$e^{-x} \\approx 1-x$。\n    $$\n    I_d(0, -\\mu') \\approx \\frac{\\omega_0 F_0}{4\\pi(\\mu'+1)} \\left( 1 - \\left[1 - \\Delta\\tau\\left(1+\\frac{1}{\\mu'}\\right)\\right] \\right) = \\frac{\\omega_0 F_0}{4\\pi(\\mu'+1)} \\Delta\\tau \\left(\\frac{\\mu'+1}{\\mu'}\\right) = \\frac{\\omega_0 F_0 \\Delta\\tau}{4\\pi\\mu'}\n    $$\n    半球反射率 $R$ 是在 $\\tau=0$ 处的向上通量与 $F_0$ 之比：\n    $$\n    R = \\frac{1}{F_0} \\int_0^{2\\pi} \\int_{-1}^0 I_d(0, \\mu) |\\mu| d\\mu d\\phi = \\frac{2\\pi}{F_0} \\int_0^1 I_d(0, -\\mu') \\mu' d\\mu' = \\frac{2\\pi}{F_0} \\int_0^1 \\left( \\frac{\\omega_0 F_0 \\Delta\\tau}{4\\pi\\mu'} \\right) \\mu' d\\mu' = \\frac{\\omega_0 \\Delta\\tau}{2} \\int_0^1 d\\mu' = \\frac{1}{2}\\omega_0\\Delta\\tau\n    $$\n    与 $R = R_1 \\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^2)$ 比较，我们得到 $R_1 = \\frac{1}{2}\\omega_0$。\n\n*   **向下漫射辐射亮度 ($T$)**\n    对于向下传播的辐射亮度（$\\mu > 0$），我们从上边界 $\\tau=0$ 开始积分，该处的边界条件是没有入射的漫射辐射亮度，$I_d(0, \\mu) = 0$。RTE 的解是：\n    $$\n    I_d(\\tau, \\mu) = \\int_0^\\tau \\frac{J_{ss}(t)}{\\mu} e^{-(\\tau-t)/\\mu} dt\n    $$\n    我们需在下边界 $\\tau = \\Delta\\tau$ 处计算此值：\n    $$\n    I_d(\\Delta\\tau, \\mu) = \\frac{1}{\\mu} \\int_0^{\\Delta\\tau} J_{ss}(t) e^{-(\\Delta\\tau-t)/\\mu} dt = \\frac{\\omega_0 F_0}{4\\pi\\mu} e^{-\\Delta\\tau/\\mu} \\int_0^{\\Delta\\tau} e^{-t(1-1/\\mu)} dt\n    $$\n    对于 $\\Delta\\tau \\ll 1$，我们可以在积分内近似 $e^{-x} \\approx 1$（$t \\in [0, \\Delta\\tau]$）。\n    $$\n    I_d(\\Delta\\tau, \\mu) \\approx \\frac{\\omega_0 F_0}{4\\pi\\mu} \\int_0^{\\Delta\\tau} dt = \\frac{\\omega_0 F_0 \\Delta\\tau}{4\\pi\\mu}\n    $$\n    在底部的向下漫射通量是：\n    $$\n    F_{\\downarrow, d}(\\Delta\\tau) = \\int_0^{2\\pi} \\int_0^1 I_d(\\Delta\\tau, \\mu) \\mu d\\mu d\\phi\n    $$\n    $$\n    F_{\\downarrow, d}(\\Delta\\tau) \\approx 2\\pi \\int_0^1 \\left( \\frac{\\omega_0 F_0 \\Delta\\tau}{4\\pi\\mu} \\right) \\mu d\\mu = \\frac{\\omega_0 F_0 \\Delta\\tau}{2} \\int_0^1 d\\mu = \\frac{1}{2}\\omega_0 F_0 \\Delta\\tau\n    $$\n    总透射率 $T$ 包括衰减的直接光束和透射的漫射通量：\n    $$\n    T = \\frac{F_0 e^{-\\Delta\\tau} + F_{\\downarrow, d}(\\Delta\\tau)}{F_0} = e^{-\\Delta\\tau} + \\frac{F_{\\downarrow, d}(\\Delta\\tau)}{F_0}\n    $$\n    在 $\\Delta\\tau$ 中展开到一阶：\n    $$\n    T \\approx (1 - \\Delta\\tau) + \\frac{\\frac{1}{2}\\omega_0 F_0 \\Delta\\tau}{F_0} = 1 - \\Delta\\tau + \\frac{1}{2}\\omega_0 \\Delta\\tau = 1 + (\\frac{1}{2}\\omega_0 - 1)\\Delta\\tau\n    $$\n    与 $T = 1 + T_1 \\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^2)$ 比较，我们得到 $T_1 = \\frac{1}{2}\\omega_0 - 1$。\n    因此，从单次散射近似得到，$(R_1, T_1) = (\\frac{1}{2}\\omega_0, \\frac{1}{2}\\omega_0-1)$。\n\n**2. 双流 Eddington 近似**\n\nEddington 近似将 RTE 简化为一个关于向上（$F^\\uparrow$）和向下（$F^\\downarrow$）半球通量的两个常微分方程组。对于各向同性散射（$g=0$）和垂直入射光束（$\\mu_0=1$），标准的双流方程（例如，根据 Meador and Weaver, 1980）为：\n$$\n\\frac{dF^\\uparrow}{d\\tau} = 2(1-\\omega_0) F^\\uparrow - 2\\omega_0 F^\\downarrow - \\frac{1}{2}\\omega_0 F_0 e^{-\\tau}\n$$\n$$\n\\frac{dF^\\downarrow}{d\\tau} = -2\\omega_0 F^\\uparrow + 2(1-\\omega_0) F^\\downarrow + \\frac{1}{2}\\omega_0 F_0 e^{-\\tau}\n$$\n边界条件是顶部没有向下的漫射通量（$F^\\downarrow(0)=0$），以及底部黑体表面没有向上的通量（$F^\\uparrow(\\Delta\\tau)=0$）。\n对于光学薄层 $\\Delta\\tau \\ll 1$，我们可以将通量近似为 $\\tau$ 的线性函数。首先，我们计算在 $\\tau=0$ 处的导数：\n$$\n\\left.\\frac{dF^\\uparrow}{d\\tau}\\right|_{\\tau=0} = 2(1-\\omega_0) F^\\uparrow(0) - 2\\omega_0 F^\\downarrow(0) - \\frac{1}{2}\\omega_0 F_0 = 2(1-\\omega_0) F^\\uparrow(0) - \\frac{1}{2}\\omega_0 F_0\n$$\n$$\n\\left.\\frac{dF^\\downarrow}{d\\tau}\\right|_{\\tau=0} = -2\\omega_0 F^\\uparrow(0) + 2(1-\\omega_0) F^\\downarrow(0) + \\frac{1}{2}\\omega_0 F_0 = -2\\omega_0 F^\\uparrow(0) + \\frac{1}{2}\\omega_0 F_0\n$$\n在一阶近似下，我们近似在 $\\Delta\\tau$ 处的通量：\n$$\nF^\\uparrow(\\Delta\\tau) \\approx F^\\uparrow(0) + \\Delta\\tau \\left.\\frac{dF^\\uparrow}{d\\tau}\\right|_{\\tau=0}\n$$\n$$\nF^\\downarrow(\\Delta\\tau) \\approx F^\\downarrow(0) + \\Delta\\tau \\left.\\frac{dF^\\downarrow}{d\\tau}\\right|_{\\tau=0}\n$$\n使用边界条件 $F^\\uparrow(\\Delta\\tau)=0$：\n$$\n0 \\approx F^\\uparrow(0) + \\Delta\\tau \\left( 2(1-\\omega_0) F^\\uparrow(0) - \\frac{1}{2}\\omega_0 F_0 \\right)\n$$\n根据定义，反射率是 $R = F^\\uparrow(0)/F_0$。代入此式：\n$$\n0 \\approx R F_0 + \\Delta\\tau \\left( 2(1-\\omega_0) R F_0 - \\frac{1}{2}\\omega_0 F_0 \\right)\n$$\n$$\nR (1 + 2(1-\\omega_0)\\Delta\\tau) \\approx \\frac{1}{2}\\omega_0\\Delta\\tau\n$$\n求解 $R$ 并仅保留 $\\Delta\\tau$ 的一阶项：\n$$\nR \\approx \\frac{\\frac{1}{2}\\omega_0\\Delta\\tau}{1 + 2(1-\\omega_0)\\Delta\\tau} \\approx \\frac{1}{2}\\omega_0\\Delta\\tau \\left( 1 - 2(1-\\omega_0)\\Delta\\tau + \\dots \\right) = \\frac{1}{2}\\omega_0\\Delta\\tau + \\mathcal{O}((\\Delta\\tau)^2)\n$$\n这得出 $R_1 = \\frac{1}{2}\\omega_0$。\n对于透射率，我们求出底部的漫射分量：\n$$\nF^\\downarrow(\\Delta\\tau) \\approx \\Delta\\tau \\left.\\frac{dF^\\downarrow}{d\\tau}\\right|_{\\tau=0} = \\Delta\\tau \\left( -2\\omega_0 (R F_0) + \\frac{1}{2}\\omega_0 F_0 \\right)\n$$\n代入一阶表达式 $R \\approx \\frac{1}{2}\\omega_0\\Delta\\tau$：\n$$\nF^\\downarrow(\\Delta\\tau) \\approx \\Delta\\tau \\left( -2\\omega_0 (\\frac{1}{2}\\omega_0\\Delta\\tau) F_0 + \\frac{1}{2}\\omega_0 F_0 \\right) = F_0 \\left( \\frac{1}{2}\\omega_0\\Delta\\tau - \\omega_0^2(\\Delta\\tau)^2 \\right)\n$$\n总透射率是 $T = (F_0 e^{-\\Delta\\tau} + F^\\downarrow(\\Delta\\tau))/F_0$。到一阶：\n$$\nT \\approx (1-\\Delta\\tau) + \\frac{1}{F_0} \\left( \\frac{1}{2}\\omega_0 F_0 \\Delta\\tau \\right) = 1 + (\\frac{1}{2}\\omega_0 - 1)\\Delta\\tau\n$$\n这得出 $T_1 = \\frac{1}{2}\\omega_0-1$。Eddington 近似得出 $(R_1, T_1) = (\\frac{1}{2}\\omega_0, \\frac{1}{2}\\omega_0-1)$，这与单次散射的结果相同。\n\n**3. Delta-Eddington 近似**\n\nDelta-Eddington 近似是为强前向峰值散射设计的，其特征是非对称因子 $g  0$。它变换介质的光学特性，以解释高度前向散射的辐射，这些辐射的行为就好像它们未经相互作用而透射一样。变换关系是：\n$$\n\\tau' = (1-\\omega_0 f)\\tau\n$$\n$$\n\\omega_0' = \\frac{\\omega_0(1-f)}{1-\\omega_0 f}\n$$\n$$\ng' = \\frac{g-f}{1-f}\n$$\n这里，$f$ 是散射到前向峰值部分的分数，通常近似为 $f=g^2$。然后在变换后的系统 $(\\tau', \\omega_0', g')$ 中解决辐射传输问题。\n本问题指定了各向同性散射，其非对称因子 $g=0$。因此，前向峰值分数为 $f = g^2 = 0$。将 $f=0$ 代入变换方程得到：\n$$\n\\tau' = (1-\\omega_0 \\cdot 0)\\tau = \\tau\n$$\n$$\n\\omega_0' = \\frac{\\omega_0(1-0)}{1-\\omega_0 \\cdot 0} = \\omega_0\n$$\n$$\ng' = \\frac{g-0}{1-0} = g = 0\n$$\n该变换是恒等映射。因此，对于各向同性散射（$g=0$），Delta-Eddington 近似完全等同于标准的 Eddington 近似。因此，它必须产生完全相同的结果。\n\n**结论**\n\n所有三种方法——精确RTE的单次散射近似、双流 Eddington 近似和用于各向同性散射的 Delta-Eddington 近似——对于光学薄层中的反射率和透射率，都产生相同的一阶展开式。系数为：\n$$\nR_1 = \\frac{1}{2}\\omega_0\n$$\n$$\nT_1 = \\frac{1}{2}\\omega_0 - 1\n$$\n这种一致性表明，对于单次散射占主导地位的光学薄介质，双流近似正确地捕捉了辐射传输的主阶物理过程。",
            "answer": "$$\\boxed{\\left( \\frac{1}{2}\\omega_0, \\frac{1}{2}\\omega_0 - 1 \\right)}$$"
        },
        {
            "introduction": "delta-Eddington 近似是一种处理强前向散射相函数的巧妙技术。本练习 () 将深入该方法的数学机制，要求你推导层顶反射率和透射率，并探究 delta-Eddington 重新标度变换带来的影响。其结果揭示了一个非直观的不变性，从而加深你对该变换工作原理的理解。",
            "id": "4106811",
            "problem": "一个总光学厚度为 $\\tau$ 的平面平行、均匀、不发射短波层位于一个黑体表面之上。该层的特征是单次散射反照率 $w_0$ 和散射不对称因子 $g$。该层的顶部被单位半各向同性的漫射下行通量所照射（因此反射率 $R$ 和透射率 $T$ 可以被解释为与光照振幅无关的比率）。在双流 Eddington（一阶球谐）闭合中进行计算，其中比辐射强度近似为 $I(\\tau,\\mu) \\approx a(\\tau) + b(\\tau)\\mu$，并将漫射上行和下行通量分别定义为 $F^{+}(\\tau)$ 和 $F^{-}(\\tau)$。\n\n1) 从平面平行辐射传输方程及其零阶和一阶角矩出发，使用 Eddington 闭合推导一个关于标量（零阶矩）通量的二阶齐次常微分方程，该方程具有指数解，其衰减率 $\\xi$ 仅依赖于 $(w_0,g)$。针对黑色下表面和顶部半各向同性漫射入射施加适当的边界条件，以获得层漫射反射率 $R(\\tau,w_0,g)$ 和透射率 $T(\\tau,w_0,g)$ 的闭合形式表达式，该表达式用衰减率 $\\xi$ 和半无限（渐近）漫射反射率 $r_{\\infty}(w_0,g)$ 表示。\n\n2) 考虑常规的 delta-Eddington 重新标度，该方法从相函数中移除一个权重为 $f$ 的前向 delta 峰，并对介质进行重新归一化。使用标准选择 $f = g^2$ 和相应的重新标度的光学参数 $(\\tau',w_0',g')$：\n$$\n\\tau' = \\left(1 - w_0 f\\right)\\tau,\\qquad\nw_0' = \\frac{(1-f)w_0}{1 - w_0 f},\\qquad\ng' = \\frac{g - f}{1 - f}.\n$$\n使用您在第 (1) 部分得到的表达式，确定 $R_{\\delta} \\equiv R(\\tau',w_0',g')$ 和 $T_{\\delta} \\equiv T(\\tau',w_0',g')$，并将它们与 $R(\\tau,w_0,g)$ 和 $T(\\tau,w_0,g)$ 进行比较。\n\n3) 对 $w_0 = 0.999$, $g = 0.85$, $\\tau = 10$ 的情况评估结果。计算使用和不使用 delta-Eddington 重新标度两种情况下 $R$ 和 $T$ 的数值，并量化差异 $R_{\\delta} - R$ 和 $T_{\\delta} - T$。\n\n您最终报告的量必须是单个数字 $\\Delta R \\equiv R_{\\delta} - R$。如果该值可以精确表示，请报告精确值；否则，请四舍五入到四位有效数字。最终报告的数字中不要包含单位。",
            "solution": "该问题要求使用双流 Eddington 近似，在有和没有 delta-Eddington 重新标度的情况下，推导和数值评估均匀大气层的漫射反射率和透射率。最终目标是计算反射率的差异 $\\Delta R = R_{\\delta} - R$。\n\n### 第 1 部分：用于反射率和透射率的 Eddington 近似\n\n对于不发射、吸收和散射的介质，平面平行辐射传输方程 (RTE) 为：\n$$ \\mu \\frac{dI(\\tau, \\mu)}{d\\tau} = I(\\tau, \\mu) - \\frac{w_0}{2} \\int_{-1}^{1} p(\\mu, \\mu') I(\\tau, \\mu') d\\mu' $$\n其中 $I(\\tau, \\mu)$ 是在光学深度 $\\tau$、方向 $\\mu = \\cos\\theta$ 处的辐射率，$w_0$ 是单次散射反照率，$p(\\mu, \\mu')$ 是散射相函数。相函数展开为勒让德多项式，其一阶项由不对称因子 $g$ 表征：$p(\\mu, \\mu') \\approx 1 + 3g\\mu\\mu'$。\n\n我们对 RTE 取矩。零阶和一阶矩方程为：\n$$ \\frac{dH(\\tau)}{d\\tau} = (1-w_0) J(\\tau) $$\n$$ \\frac{dK(\\tau)}{d\\tau} = (1-w_0 g) H(\\tau) $$\n这里，$J(\\tau) = \\frac{1}{2}\\int_{-1}^{1} I(\\tau, \\mu)d\\mu$ 是平均强度，$H(\\tau) = \\frac{1}{2}\\int_{-1}^{1} \\mu I(\\tau, \\mu)d\\mu$ 是通量相关矩，$K(\\tau) = \\frac{1}{2}\\int_{-1}^{1} \\mu^2 I(\\tau, \\mu)d\\mu$ 是辐射率场的二阶矩。\n\nEddington 近似假设辐射率场在 $\\mu$ 上是线性的：\n$$ I(\\tau, \\mu) \\approx a(\\tau) + b(\\tau)\\mu $$\n这导出了闭合关系 $K(\\tau) = \\frac{1}{3} J(\\tau)$。将此代入一阶矩方程得到：\n$$ \\frac{1}{3} \\frac{dJ(\\tau)}{d\\tau} = (1-w_0 g) H(\\tau) $$\n我们现在有一个由两个耦合的一阶常微分方程组成的系统。对第二个方程关于 $\\tau$ 求导，并代入第一个方程，得到一个关于平均强度 $J(\\tau)$ 的二阶齐次常微分方程：\n$$ \\frac{d^2J(\\tau)}{d\\tau^2} = 3(1-w_0 g) \\frac{dH(\\tau)}{d\\tau} = 3(1-w_0 g)(1-w_0)J(\\tau) $$\n这可以写成：\n$$ \\frac{d^2J(\\tau)}{d\\tau^2} - \\xi^2 J(\\tau) = 0 $$\n其中衰减率 $\\xi$ 由下式给出：\n$$ \\xi = \\sqrt{3(1-w_0)(1-w_0 g)} $$\n$J(\\tau)$ 的通解是 $J(\\tau) = C_1 e^{\\xi\\tau} + C_2 e^{-\\xi\\tau}$。通量矩则为 $H(\\tau) = \\frac{1}{3(1-w_0 g)}\\frac{dJ}{d\\tau} = \\frac{\\xi}{3(1-w_0 g)}(C_1 e^{\\xi\\tau} - C_2 e^{-\\xi\\tau})$。\n\n漫射上行 ($F^+$) 和下行 ($F^-$) 通量通过 $F^{\\pm}(\\tau) = \\pi(J(\\tau) \\pm 2H(\\tau))$ 与矩相关。代入 $J$ 和 $H$ 的解：\n$$ F^{\\pm}(\\tau) = \\pi \\left[ C_1 e^{\\xi\\tau} \\left(1 \\pm \\frac{2\\xi}{3(1-w_0 g)}\\right) + C_2 e^{-\\xi\\tau} \\left(1 \\mp \\frac{2\\xi}{3(1-w_0 g)}\\right) \\right] $$\n令 $u = 1 + \\frac{2\\xi}{3(1-w_0 g)}$ 和 $v = 1 - \\frac{2\\xi}{3(1-w_0 g)}$。那么 $F^+(\\tau) = \\pi(C_1 u e^{\\xi\\tau} + C_2 v e^{-\\xi\\tau})$ 且 $F^-(\\tau) = \\pi(C_1 v e^{\\xi\\tau} + C_2 u e^{-\\xi\\tau})$。\n\n边界条件是：\n1. 在层顶（$\\tau=0$）有单位半各向同性漫射下行通量：$F^-(0) = 1$。\n2. 在总光学厚度 $\\tau$ 处的黑色下表面：$F^+(\\tau) = 0$。\n\n应用边界条件：\n1. $F^-(0) = \\pi(C_1 v + C_2 u) = 1$\n2. $F^+(\\tau) = \\pi(C_1 u e^{\\xi\\tau} + C_2 v e^{-\\xi\\tau}) = 0 \\implies C_1 = -C_2 \\frac{v}{u} e^{-2\\xi\\tau}$\n\n解出 $C_1$ 和 $C_2$ 得到：\n$C_2(\\pi u - \\frac{\\pi v^2}{u}e^{-2\\xi\\tau}) = 1 \\implies C_2 = \\frac{u}{\\pi(u^2-v^2e^{-2\\xi\\tau})}$。\n$C_1 = -\\frac{v e^{-2\\xi\\tau}}{\\pi(u^2-v^2e^{-2\\xi\\tau})}$。\n\n层漫射反射率是 $R = F^+(0)/F^-(0) = F^+(0) = \\pi(C_1 u + C_2 v)$。\n$$ R = \\frac{-\\pi u v e^{-2\\xi\\tau} + \\pi u v}{\\pi(u^2-v^2e^{-2\\xi\\tau})} = \\frac{uv(1-e^{-2\\xi\\tau})}{u^2-v^2e^{-2\\xi\\tau}} $$\n半无限层（$\\tau \\to \\infty$）的反射率是 $r_{\\infty} = \\lim_{\\tau\\to\\infty} R = \\frac{uv}{u^2} = \\frac{v}{u}$。\n用 $r_{\\infty}$ 表示，反射率为：\n$$ R(\\tau, w_0, g) = \\frac{r_{\\infty}(1-e^{-2\\xi\\tau})}{1 - r_{\\infty}^2 e^{-2\\xi\\tau}} $$\n层漫射透射率是 $T = F^-(\\tau)/F^-(0) = F^-(\\tau) = \\pi(C_1 v e^{\\xi\\tau} + C_2 u e^{-\\xi\\tau})$。\n$$ T = \\frac{\\pi(-v^2 e^{-\\xi\\tau} + u^2 e^{-\\xi\\tau})}{\\pi(u^2-v^2e^{-2\\xi\\tau})} = \\frac{(u^2-v^2)e^{-\\xi\\tau}}{u^2(1 - (v/u)^2 e^{-2\\xi\\tau})} = \\frac{(1-r_{\\infty}^2)e^{-\\xi\\tau}}{1 - r_{\\infty}^2 e^{-2\\xi\\tau}} $$\n半无限反射率 $r_{\\infty}$ 可以显式地写为：\n$$ r_{\\infty}(w_0,g) = \\frac{v}{u} = \\frac{1 - \\frac{2\\xi}{3(1-w_0 g)}}{1 + \\frac{2\\xi}{3(1-w_0 g)}} = \\frac{1 - \\frac{2}{\\sqrt{3}}\\sqrt{\\frac{1-w_0}{1-w_0 g}}}{1 + \\frac{2}{\\sqrt{3}}\\sqrt{\\frac{1-w_0}{1-w_0 g}}} $$\n\n### 第 2 部分：Delta-Eddington 重新标度\n\ndelta-Eddington 近似分离了相函数的前向峰。选择 $f=g^2$，重新标度的参数 $(\\tau', w_0', g')$ 为：\n$$ \\tau' = (1 - w_0 g^2)\\tau $$\n$$ w_0' = \\frac{(1-g^2)w_0}{1 - w_0 g^2} $$\n$$ g' = \\frac{g - g^2}{1 - g^2} = \\frac{g(1-g)}{(1-g)(1+g)} = \\frac{g}{1+g} $$\n我们现在分析关键量 $\\xi$ 和 $r_{\\infty}$ 如何变换。令变换后的量为 $\\xi'$ 和 $r'_{\\infty}$。\n项 $(1-w_0')$ 变为：\n$$ 1-w_0' = 1 - \\frac{(1-g^2)w_0}{1 - w_0 g^2} = \\frac{1-w_0g^2 - w_0 + w_0g^2}{1-w_0g^2} = \\frac{1-w_0}{1-w_0g^2} $$\n项 $(1-w_0'g')$ 变为：\n$$ 1-w_0'g' = 1 - \\left(\\frac{(1-g^2)w_0}{1-w_0g^2}\\right)\\left(\\frac{g}{1+g}\\right) = 1 - \\frac{w_0g(1-g)}{1-w_0g^2} = \\frac{1-w_0g^2 - w_0g + w_0g^2}{1-w_0g^2} = \\frac{1-w_0g}{1-w_0g^2} $$\n决定 $r'_{\\infty}$ 的比率是：\n$$ \\frac{1-w_0'}{1-w_0'g'} = \\frac{(1-w_0)/(1-w_0g^2)}{(1-w_0g)/(1-w_0g^2)} = \\frac{1-w_0}{1-w_0g} $$\n这个比率与未标度的版本相同。因此，半无限反射率在此变换下是不变的：$r'_{\\infty} = r_{\\infty}$。\n\n变换后的衰减率 $\\xi'$ 是：\n$$ \\xi'^2 = 3(1-w_0')(1-w_0'g') = 3\\left(\\frac{1-w_0}{1-w_0g^2}\\right)\\left(\\frac{1-w_0g}{1-w_0g^2}\\right) = \\frac{3(1-w_0)(1-w_0g)}{(1-w_0g^2)^2} = \\frac{\\xi^2}{(1-w_0g^2)^2} $$\n所以，$\\xi' = \\frac{\\xi}{1-w_0g^2}$。\n$R$ 和 $T$ 公式中指数函数的宗量是乘积 $\\xi\\tau$。变换后的乘积是：\n$$ \\xi'\\tau' = \\left(\\frac{\\xi}{1-w_0g^2}\\right) \\left((1-w_0g^2)\\tau\\right) = \\xi\\tau $$\n这个乘积也是不变的。\n\n在 delta-Eddington 近似中的反射率 $R_{\\delta}$ 和透射率 $T_{\\delta}$ 可以通过将带撇的量代入第 1 部分的公式得到。\n$$ R_{\\delta} = R(\\tau', w_0', g') = \\frac{r'_{\\infty}(1-e^{-2\\xi'\\tau'})}{1 - r_{\\infty}'^2 e^{-2\\xi'\\tau'}} $$\n因为 $r'_{\\infty} = r_{\\infty}$ 且 $\\xi'\\tau' = \\xi\\tau$，我们有：\n$$ R_{\\delta} = \\frac{r_{\\infty}(1-e^{-2\\xi\\tau})}{1 - r_{\\infty}^2 e^{-2\\xi\\tau}} = R(\\tau, w_0, g) $$\n对于透射率也类似：\n$$ T_{\\delta} = T(\\tau', w_0', g') = \\frac{(1-r_{\\infty}'^2)e^{-\\xi'\\tau'}}{1 - r_{\\infty}'^2 e^{-2\\xi'\\tau'}} = \\frac{(1-r_{\\infty}^2)e^{-\\xi\\tau}}{1 - r_{\\infty}^2 e^{-2\\xi\\tau}} = T(\\tau, w_0, g) $$\n因此，对于在黑色表面上的层上的漫射入射，使用 $f=g^2$ 的 delta-Eddington 变换时，Eddington 近似的反射率和透射率是不变的。这意味着差异 $R_{\\delta}-R$ 和 $T_{\\delta}-T$ 解析上为零。\n\n### 第 3 部分：数值评估\n\n给定 $w_0 = 0.999$, $g = 0.85$, 且 $\\tau = 10$。\n\n正如第 2 部分解析地显示的，$R_{\\delta} = R$ 和 $T_{\\delta} = T$。因此，差异为零：\n$$ R_{\\delta} - R = 0 $$\n$$ T_{\\delta} - T = 0 $$\n最终要求的量是 $\\Delta R = R_{\\delta} - R$。基于此推导，精确值为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "将理论转化为代码需要特别关注数值稳定性和物理一致性。最后的这项实践 () 是一个编程练习，聚焦于任何辐射传输模型都至关重要的一个方面：检验能量守恒。你将设计并实现一个诊断工具，用于检查计算出的反射率、透射率和吸收率之和是否为 1，这是任何有效模型实现都必须通过的基本检验。",
            "id": "4106759",
            "problem": "您的任务是为一个采用 delta-Eddington 近似的双流法建模的单层、平面平行、均匀大气层实施能量闭合诊断。在此类模型中，层积分反射率 $R$、透射率 $T$ 和吸收率 $A$ 是单位归一化的入射漫射辐照度的分数。根据封闭控制体积的能量守恒定律，入射能量必须等于被该层反射、透射和吸收的能量之和。您的程序应实现一个稳健的数值程序，从该守恒原理出发，构建一个能量闭合残差，并用它来诊断给定的三元组 $\\{R,T,A\\}$ 在数值上是否一致。\n\n推导的基本依据：应用于平面平行层的辐射通量的能量守恒定律和纯吸收的 Beer-Lambert 定律。具体来说，如果层顶入射漫射辐照度被归一化为 1，则出射的向上漫射分数为 $R$，从底部出射的向下漫射分数为 $T$，层内汇为 $A$。模型应强制要求入射能量与出射能量加层内汇之间的净差为零。对于光学厚度为 $\\tau$ 且无散射的纯吸收情况，Beer-Lambert 定律意味着 $T=\\exp(-\\tau)$ 和 $R=0$，同时 $A=1-\\exp(-\\tau)$，这是独立于双流闭合的对数值一致性的严格检验。对于 delta-Eddington 标度变换，当单次散射反照率 $\\omega_0$ 等于 $0$ 时，该标度变换不改变层的厚度，使得 Beer-Lambert 测试成为一个有效的基准。\n\n您的任务是：\n- 从守恒原理推导出一个标量残差 $e$，用于量化任何给定 $\\{R,T,A\\}$ 的数值不一致性的大小。当守恒约束被精确满足时，残差必须为零；当违背时，残差必须为正。您的残差必须是无量纲的。\n- 使用绝对容差 $\\varepsilon_{\\mathrm{abs}}$ 和相对容差 $\\varepsilon_{\\mathrm{rel}}$ 实现一个稳健的通过/失败规则。通过条件应要求残差 $e$ 小于或等于 $\\max\\{\\varepsilon_{\\mathrm{abs}},\\varepsilon_{\\mathrm{rel}}\\}$。此外，由于 $R$、$T$ 和 $A$ 是分数，它们各自必须在绝对界限 $\\varepsilon_{\\mathrm{abs}}$ 内位于闭区间 $[0,1]$ 中。\n- 设计一个诊断代码，将失败的案例分类为以下互斥条件之一，按首次适用的条件选择：负分量（$R$、$T$、$A$ 中任意一个小于 $-\\varepsilon_{\\mathrm{abs}}$），分量超过一（$R$、$T$、$A$ 中任意一个大于 $1+\\varepsilon_{\\mathrm{abs}}$），或能量闭合违例超出容差（残差 $e$ 超过容差，而所有分量都在允许区间内）。\n- 实现一个额外的内部诊断，提出一种通过调整单个分量来强制实现守恒的最小修正策略。您可以选择任何有原则的策略；例如，通过带符号的残差调整 $A$，使修正后的和恰好为一。此诊断无需打印，但必须计算。\n\n所有量 $R$、$T$ 和 $A$ 都必须视为无量纲分数。残差 $e$ 必须是无量纲的。使用 $\\varepsilon_{\\mathrm{abs}}=10^{-12}$ 和 $\\varepsilon_{\\mathrm{rel}}=10^{-9}$。\n\n测试套件。您的程序必须评估以下八个案例。对于前三个案例，使用无散射的纯吸收物理（Beer-Lambert 定律）来构建 $R$、$T$、$A$，这与单次散射反照率为零时的 delta-Eddington 标度变换一致：\n- 案例 1（正常路径，中等光学厚度）：光学厚度 $\\tau=0.2$。设置 $R=0$，$T=\\exp(-\\tau)$，$A=1-\\exp(-\\tau)$。\n- 案例 2（边界情况，零厚度）：光学厚度 $\\tau=0$。设置 $R=0$，$T=\\exp(-\\tau)$，$A=1-\\exp(-\\tau)$。\n- 案例 3（近乎完全衰减，大光学厚度）：光学厚度 $\\tau=30$。设置 $R=0$，$T=\\exp(-\\tau)$，$A=1-\\exp(-\\tau)$。\n对于其余五个案例，直接测试代数和范围的稳健性：\n- 案例 4（舍入级别的一致性）：$R=0.3333333333333$，$T=0.3333333333333$，$A=0.3333333333333$。\n- 案例 5（明显的闭合违例，但分量在范围内）：$R=0.45$，$T=0.52$，$A=0.06$。\n- 案例 6（尽管和精确，但存在负分量）：$R=0.6$，$T=0.5$，$A=-0.1$。\n- 案例 7（分量超过一，有负值补偿）：$R=1.0000001$，$T=0.0$，$A=-10^{-7}$。\n- 案例 8（灾难性抵消压力测试）：$R=5\\times 10^{-17}$，$T=1-5\\times 10^{-17}$，$A=0$。\n\n最终输出格式。您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个案例 $i$（按所列顺序），连续输出三个值：\n- 残差 $e_i$（浮点数），\n- 通过/失败指示符（整数，$1$ 表示通过，$0$ 表示失败），\n- 诊断代码（从集合 $\\{0,1,2,3\\}$ 中选择的整数，其中 $0$ 表示通过，$2$ 表示负分量，$3$ 表示分量超过一，$1$ 表示能量闭合违例超出容差）。\n因此，输出列表将包含对应于 $8$ 个案例的 $24$ 个数字。所有量都是无量纲的。您的程序必须完全自包含，且不得读取任何输入。",
            "solution": "### 解决方案推导与实施策略\n\n该问题要求设计并实现一个诊断程序，以验证辐射传输计算的数值一致性。解决方案按照指定的物理原理和数值标准分步进行。\n\n**1. 能量闭合残差的推导**\n该诊断的基石是能量守恒原理。对于一个受单位归一化入射漫射辐照度照射的被动、平面平行大气层，反射的能量分数 ($R$)、透射的分数 ($T$) 和吸收的分数 ($A$) 之和必须等于入射能量。这提供了精确的守恒定律：\n$$\nR + T + A = 1\n$$\n在数值实现中，计算出的量，记为 $\\{R_{\\text{num}}, T_{\\text{num}}, A_{\\text{num}}\\}$，可能因浮点运算、模型物理中的近似或实现错误而偏离这个精确关系。为了量化这种偏差，我们定义一个有符号的差异 $\\delta$：\n$$\n\\delta = R_{\\text{num}} + T_{\\text{num}} + A_{\\text{num}} - 1\n$$\n问题要求一个非负、无量纲的标量残差 $e$。衡量差异大小最自然和直接的方法是其绝对值：\n$$\ne = |\\delta| = |R_{\\text{num}} + T_{\\text{num}} + A_{\\text{num}} - 1|\n$$\n这个定义满足所有要求：$e \\ge 0$，$e=0$ 当且仅当守恒被完美满足，并且由于 $R, T, A,$ 和 $1$ 都是无量纲量，它也是无量纲的。\n\n**2. 诊断逻辑和通过/失败标准**\n诊断程序涉及对每个输入三元组 $\\{R, T, A\\}$ 应用的一系列检查。\n\n**物理合理性检查：** 量 $R, T,$ 和 $A$ 代表能量分数，因此在物理上被限制在区间 $[0, 1]$ 内。然而，数值结果可能略有偏差。问题指定了一个容差带，允许值在 $[-\\varepsilon_{\\mathrm{abs}}, 1 + \\varepsilon_{\\mathrm{abs}}]$ 范围内。如果一个值违反了这些界限，它就超出了物理上合理的范围。\n- 检查负分量是：是否存在任何 $v \\in \\{R, T, A\\}$ 使得 $v  -\\varepsilon_{\\mathrm{abs}}$？\n- 检查分量超过一是：是否存在任何 $v \\in \\{R, T, A\\}$ 使得 $v > 1 + \\varepsilon_{\\mathrm{abs}}$？\n\n**能量闭合检查：** 能量收支必须在指定的容差内闭合。误差阈值 $T_{\\text{err}}$ 定义为：\n$$\nT_{\\text{err}} = \\max\\{\\varepsilon_{\\mathrm{abs}}, \\varepsilon_{\\mathrm{rel}}\\} = \\max\\{10^{-12}, 10^{-9}\\} = 10^{-9}\n$$\n- 检查能量闭合违例是：残差 $e > T_{\\text{err}}$ 吗？\n\n**分级分类：** 问题规定了这些检查的特定顺序，以确保诊断代码的互斥性。对于每个案例：\n1.  初始化状态为“通过”（通过/失败指示符 $pf=1$，诊断代码 $dc=0$）。\n2.  检查负分量：如果 $R  -\\varepsilon_{\\mathrm{abs}}$ 或 $T  -\\varepsilon_{\\mathrm{abs}}$ 或 $A  -\\varepsilon_{\\mathrm{abs}}$，则案例失败。设置 $pf=0$ 和 $dc=2$。\n3.  如果第一次检查通过，检查分量是否超过一：如果 $R > 1+\\varepsilon_{\\mathrm{abs}}$ 或 $T > 1+\\varepsilon_{\\mathrm{abs}}$ 或 $A > 1+\\varepsilon_{\\mathrm{abs}}$，则案例失败。设置 $pf=0$ 和 $dc=3$。\n4.  如果前两次检查通过，检查能量闭合：如果 $e > \\max\\{\\varepsilon_{\\mathrm{abs}}, \\varepsilon_{\\mathrm{rel}}\\}$，则案例失败。设置 $pf=0$ 和 $dc=1$。\n5.  如果所有检查都通过，则保留初始的“通过”状态（$pf=1, dc=0$）。\n\n**3. 内部修正诊断**\n作为一项额外的内部任务，需要一个最小修正策略。一种有原则的方法是调整单个属性以强制实现守恒，将其视为闭合能量收支的分量。修改吸收率 $A$ 是一个常见的选择。给定一个三元组 $\\{R, T, A\\}$，修正后的吸收率 $A'$ 被计算出来以使总和恰好为一：\n$$\nR + T + A' = 1 \\implies A' = 1 - R - T\n$$\n这个修正量 $A' - A = (1-R-T) - A = -(R+T+A-1) = -\\delta$ 直接补偿了能量不平衡。这个计算将作为完整实现的一部分对每个案例进行，但结果不包含在最终输出中。\n\n**4. 测试用例的实施**\n该算法将应用于八个提供的测试案例。\n- **案例 1-3：** 这些案例是根据 Beer-Lambert 定律构建的，反映了纯吸收的物理情景。对于给定的光学厚度 $\\tau$，三元组是 $\\{R, T, A\\} = \\{0, \\exp(-\\tau), 1-\\exp(-\\tau)\\}$。根据构造，$R+T+A = 0 + \\exp(-\\tau) + (1-\\exp(-\\tau)) = 1$。残差 $e$ 预计为零，受浮点精度影响。\n- **案例 4-8：** 这些案例直接提供 $\\{R, T, A\\}$ 的数值，以测试诊断逻辑在特定数值条件下的表现，如舍入误差、明显违例、非物理分量值和潜在的浮点抵消问题。\n\n最终程序将为每个案例计算 $(e, pf, dc)$，并按要求将它们格式化为单个逗号分隔的字符串。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs an energy-closure diagnostic on a set of radiative transfer\n    properties (Reflectance, Transmittance, Absorption) based on a\n    hierarchical set of numerical and physical consistency checks.\n    \"\"\"\n\n    # Define tolerances as per the problem statement.\n    eps_abs = 1.0e-12\n    eps_rel = 1.0e-9\n\n    # Define the test cases. Cases 1-3 are derived from Beer-Lambert law for\n    # pure absorption, consistent with delta-Eddington for omega_0 = 0.\n    # Cases 4-8 are direct numerical inputs.\n    test_cases = [\n        # Case 1: Happy path, moderate optical depth\n        (lambda tau=0.2: (0.0, np.exp(-tau), 1.0 - np.exp(-tau)))(),\n        # Case 2: Boundary case, zero thickness\n        (lambda tau=0.0: (0.0, np.exp(-tau), 1.0 - np.exp(-tau)))(),\n        # Case 3: Near-total attenuation, large optical depth\n        (lambda tau=30.0: (0.0, np.exp(-tau), 1.0 - np.exp(-tau)))(),\n        # Case 4: Rounding-level consistency\n        (0.3333333333333, 0.3333333333333, 0.3333333333333),\n        # Case 5: Clear closure violation, but components within range\n        (0.45, 0.52, 0.06),\n        # Case 6: Negative component despite exact sum\n        (0.6, 0.5, -0.1),\n        # Case 7: Component above unity with compensating negative\n        (1.0000001, 0.0, -1.0e-7),\n        # Case 8: Catastrophic-cancellation stress test\n        (5.0e-17, 1.0 - 5.0e-17, 0.0),\n    ]\n\n    results = []\n    \n    # The tolerance for the energy closure check.\n    closure_tolerance = max(eps_abs, eps_rel)\n\n    for R, T, A in test_cases:\n        # Task 1: Derive the scalar residual 'e'\n        sum_val = R + T + A\n        residual = abs(sum_val - 1.0)\n\n        # Task 4: Internal diagnostic for minimal correction (not printed)\n        # We adjust A to enforce conservation.\n        # A_corrected = 1.0 - R - T\n        # or equivalently:\n        # A_corrected = A - (sum_val - 1.0)\n\n        # Task 2  3: Implement pass/fail rule and diagnostic codes\n        # The logic is hierarchical as specified.\n        # Default to a passing case.\n        pass_fail = 1  # 1 for pass, 0 for fail\n        diag_code = 0  # 0: pass\n\n        # Check 1: Negative component\n        if R  -eps_abs or T  -eps_abs or A  -eps_abs:\n            pass_fail = 0\n            diag_code = 2  # negative component\n        # Check 2: Component exceeding unity\n        elif R > 1.0 + eps_abs or T > 1.0 + eps_abs or A > 1.0 + eps_abs:\n            pass_fail = 0\n            diag_code = 3  # component exceeds unity\n        # Check 3: Energy-closure violation\n        elif residual > closure_tolerance:\n            pass_fail = 0\n            diag_code = 1  # energy-closure violation\n        \n        # Append the three required values for this case\n        results.extend([residual, pass_fail, diag_code])\n\n    # Final print statement in the exact required format.\n    # The map to str ensures all numbers are converted to their string\n    # representation for joining.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}