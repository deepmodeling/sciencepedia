{
    "hands_on_practices": [
        {
            "introduction": "在数值模型中实现任何参数化方案时，首要的考虑是其数值稳定性和物理现实性。本练习将指导您推导Betts-Miller方案中的一个基本数值约束。通过分析一个简化的前向欧拉时间步进法，您将确定为保证方案稳定且不会产生如负湿度等非物理结果，时间步长所需满足的条件，这是任何实际建模工作中的关键第一步 。",
            "id": "4016571",
            "problem": "考虑一个正经历对流调整的单层大气模型，该调整遵循 Betts–Miller 系列方案。在此方案中，预报温度 $T$ 和比湿 $q$ 在一个弛豫时间尺度 $\\tau$ 内向指定的参考廓线 $T^{\\ast}$ 和 $q^{\\ast}$ 弛豫。在连续时间内，假设弛豫定律为\n$$\\frac{dT}{dt}=-\\frac{1}{\\tau}\\left(T-T^{\\ast}\\right), \\qquad \\frac{dq}{dt}=-\\frac{1}{\\tau}\\left(q-q^{\\ast}\\right).$$\n使用前向欧拉（FE）法取一个长度为 $\\Delta t$ 的时间步。您将分析由此产生的离散更新，以推导确保数值稳定性和物理正定性的约束条件。\n\n从上述弛豫定律出发，并使用前向欧拉时间步进法，推导在时间层 $n+1$ 时 $T$ 和 $q$ 的 FE 更新表达式，用时间层 $n$ 的值、参考值 $T^{\\ast}$、$q^{\\ast}$ 以及无量纲比率 $c=\\Delta t/\\tau$ 来表示。然后，从第一性原理出发：\n- 推导关于 $c$ 的条件，以保证线性稳定性，即对于 $T$ 和 $q$，在 FE 步之后，与参考值的偏差的量级不会增长。\n- 在已知 $T^{n}0$，$q^{n}\\ge 0$ 以及物理上允许的参考值 $T^{\\ast}0$，$q^{\\ast}\\ge 0$ 的情况下，推导关于 $c$ 的条件，以保证更新后的 $T^{n+1}$ 和 $q^{n+1}$ 的正定性。用 $c$ 和参考偏差 $\\Delta T^{\\ast}=T^{\\ast}-T^{n}$ 与 $\\Delta q^{\\ast}=q^{\\ast}-q^{n}$ 来表示正定性约束。\n\n最后，对以下物理上现实的单层状态和参考值评估这些约束条件：\n- $T^{n}=300\\,\\mathrm{K}$，$T^{\\ast}=296\\,\\mathrm{K}$，\n- $q^{n}=8\\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$，$q^{\\ast}=1\\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$。\n\n报告无量纲比率 $c=\\Delta t/\\tau$ 的最大允许值，该值需同时满足本案例中推导出的稳定性和正定性约束。将您的最终答案表示为一个精确数字（无需四舍五入）。最终答案必须以纯数字形式提供，不带单位。",
            "solution": "首先根据指定标准验证问题。\n\n**第一步：提取已知条件**\n-   连续弛豫定律：$\\frac{dT}{dt}=-\\frac{1}{\\tau}\\left(T-T^{\\ast}\\right)$ 和 $\\frac{dq}{dt}=-\\frac{1}{\\tau}\\left(q-q^{\\ast}\\right)$。\n-   预报变量：温度 $T$，比湿 $q$。\n-   参考廓线：$T^{\\ast}$，$q^{\\ast}$。\n-   弛豫时间尺度：$\\tau$。\n-   时间积分：前向欧拉（FE）法，时间步长 $\\Delta t$。\n-   无量纲比率：$c=\\Delta t/\\tau$。\n-   初始条件：$T^{n}0$，$q^{n}\\ge 0$。\n-   参考廓线条件：$T^{\\ast}0$，$q^{\\ast}\\ge 0$。\n-   参考偏差：$\\Delta T^{\\ast}=T^{\\ast}-T^{n}$，$\\Delta q^{\\ast}=q^{\\ast}-q^{n}$。\n-   用于评估的数值：\n    -   $T^{n}=300\\,\\mathrm{K}$\n    -   $T^{\\ast}=296\\,\\mathrm{K}$\n    -   $q^{n}=8\\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$\n    -   $q^{\\ast}=1\\times 10^{-4}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}$\n\n**第二步：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题描述了 Betts-Miller 对流调整方案的简化版本，这是气象学中的一个标准参数化方案。使用前向欧拉时间步进法及其稳定性和正定性属性的分析是地球物理流体动力学数值分析中的经典主题。该模型是合理的。\n-   **适定性：** 问题陈述清晰，提供了所有必要信息，并要求推导具体、明确的量和约束条件。存在唯一解。\n-   **客观性：** 语言正式、精确，无主观成分。\n\n**第三步：结论与行动**\n该问题有效，因为它具有科学合理性、适定性和客观性。没有矛盾、缺失数据或含糊不清之处。我现在将着手解答。\n\n解答过程分为四个部分：推导前向欧拉更新、推导线性稳定性约束、推导正定性约束，以及将这些约束应用于给定的数值案例以找到 $c$ 的最大允许值。\n\n**1. 推导前向欧拉（FE）更新**\nFE 方法将时间层 $n$ 的时间导数 $\\frac{dy}{dt}$ 近似为 $\\frac{y^{n+1}-y^n}{\\Delta t}$。对于一个通用常微分方程 $\\frac{dy}{dt}=f(y)$，FE 更新为 $y^{n+1} = y^n + \\Delta t f(y^n)$。\n\n将此应用于温度弛豫定律 $\\frac{dT}{dt}=-\\frac{1}{\\tau}\\left(T-T^{\\ast}\\right)$:\n$$ T^{n+1} = T^n + \\Delta t \\left[ -\\frac{1}{\\tau} (T^n - T^{\\ast}) \\right] $$\n使用无量纲比率 $c = \\frac{\\Delta t}{\\tau}$ 的定义：\n$$ T^{n+1} = T^n - c(T^n - T^{\\ast}) $$\n$$ T^{n+1} = (1-c)T^n + cT^{\\ast} $$\n这是温度的 FE 更新。以此类推，比湿 $q$ 的更新为：\n$$ q^{n+1} = (1-c)q^n + cq^{\\ast} $$\n\n**2. 推导线性稳定性约束**\n线性稳定性分析研究偏离平衡解（即 $T=T^{\\ast}$ 和 $q=q^{\\ast}$）的扰动的演变。设 $\\delta T = T - T^{\\ast}$ 和 $\\delta q = q - q^{\\ast}$ 为偏离此平衡的偏差。偏差的控制方程为：\n$$ \\frac{d(\\delta T)}{dt} = -\\frac{1}{\\tau}\\delta T \\quad \\text{和} \\quad \\frac{d(\\delta q)}{dt} = -\\frac{1}{\\tau}\\delta q $$\n将 FE 方法应用于温度的偏差方程，得到：\n$$ \\delta T^{n+1} = \\delta T^n + \\Delta t \\left( -\\frac{1}{\\tau}\\delta T^n \\right) = \\delta T^n - c \\delta T^n = (1-c)\\delta T^n $$\n项 $A = 1-c$ 是放大因子。为使数值方案稳定，偏差的量级不能随时间步增长，即 $|\\delta T^{n+1}| \\le |\\delta T^n|$。这要求放大因子的绝对值不大于 1：\n$$ |A| \\le 1 \\implies |1-c| \\le 1 $$\n这个不等式等价于两个条件：\n$$ -1 \\le 1-c \\quad \\text{和} \\quad 1-c \\le 1 $$\n第一个条件意味着 $c \\le 2$。第二个条件意味着 $c \\ge 0$。由于 $\\tau$ 和 $\\Delta t$ 都是正的物理时间尺度，$c = \\Delta t/\\tau$ 内在地是非负的。因此，线性稳定性条件简化为：\n$$ c \\le 2 $$\n$q$ 的分析完全相同，并得出相同的约束。\n\n**3. 推导正定性约束**\n物理量如绝对温度 $T$ 和比湿 $q$ 必须保持非负。我们要求 $T^{n+1}0$ 和 $q^{n+1}\\ge 0$。\n\n对于温度，我们使用更新方案，并用参考偏差 $\\Delta T^{\\ast} = T^{\\ast} - T^n$ 重写：\n$$ T^{n+1} = T^n - c(T^n - T^{\\ast}) = T^n + c(T^{\\ast} - T^n) = T^n + c\\Delta T^{\\ast} $$\n正定性条件是 $T^n + c\\Delta T^{\\ast}  0$。\n如果 $\\Delta T^{\\ast} \\ge 0$（即 $T^{\\ast} \\ge T^n$），系统正在增温或处于平衡状态。由于 $T^n0$ 且 $c \\ge 0$，项 $c\\Delta T^{\\ast}$ 是非负的，因此 $T^{n+1}  T^n  0$ 自动满足。\n如果 $\\Delta T^{\\ast}  0$（即 $T^{\\ast}  T^n$），系统正在冷却。不等式为 $c\\Delta T^{\\ast} > -T^n$。由于 $\\Delta T^{\\ast}$ 是负数，用它相除会反转不等号：\n$$ c  \\frac{-T^n}{\\Delta T^{\\ast}} = \\frac{T^n}{-\\Delta T^{\\ast}} = \\frac{T^n}{T^n - T^{\\ast}} $$\n\n对于比湿，更新为 $q^{n+1} = q^n + c\\Delta q^{\\ast}$，其中 $\\Delta q^{\\ast} = q^{\\ast} - q^n$。正定性条件是 $q^n + c\\Delta q^{\\ast} \\ge 0$。\n如果 $\\Delta q^{\\ast} \\ge 0$（即 $q^{\\ast} \\ge q^n$），系统正在增湿或处于平衡状态。由于 $q^n \\ge 0$ 且 $c \\ge 0$，总和自动为非负。\n如果 $\\Delta q^{\\ast}  0$（即 $q^{\\ast}  q^n$），系统正在变干。不等式为 $c\\Delta q^{\\ast} \\ge -q^n$。用负的 $\\Delta q^{\\ast}$ 相除得到：\n$$ c \\le \\frac{-q^n}{\\Delta q^{\\ast}} = \\frac{q^n}{-\\Delta q^{\\ast}} = \\frac{q^n}{q^n - q^{\\ast}} $$\n\n**4. 应用于数值案例**\n给定的参数值为：\n-   $T^{n}=300$\n-   $T^{\\ast}=296$\n-   $q^{n}=8\\times 10^{-4}$\n-   $q^{\\ast}=1\\times 10^{-4}$\n\n我们现在评估对 $c$ 的约束。\n\n-   **稳定性约束：** 根据推导，这总是 $c \\le 2$。\n\n-   **温度正定性约束：**\n    首先，我们计算 $\\Delta T^{\\ast} = T^{\\ast} - T^n = 296 - 300 = -4$。\n    由于 $\\Delta T^{\\ast}  0$，对 $c$ 的正定性约束是激活的：\n    $$ c  \\frac{T^n}{T^n - T^{\\ast}} = \\frac{300}{300 - 296} = \\frac{300}{4} = 75 $$\n\n-   **比湿正定性约束：**\n    首先，我们计算 $\\Delta q^{\\ast} = q^{\\ast} - q^n = 1\\times 10^{-4} - 8\\times 10^{-4} = -7\\times 10^{-4}$。\n    由于 $\\Delta q^{\\ast}  0$，对 $c$ 的正定性约束是激活的：\n    $$ c \\le \\frac{q^n}{q^n - q^{\\ast}} = \\frac{8\\times 10^{-4}}{8\\times 10^{-4} - 1\\times 10^{-4}} = \\frac{8\\times 10^{-4}}{7\\times 10^{-4}} = \\frac{8}{7} $$\n\n**结论：c 的最大允许值**\n为确保稳定性和正定性，$c$ 必须同时满足所有三个推导出的约束条件：\n1.  $c \\le 2$ (稳定性)\n2.  $c  75$ (温度正定性)\n3.  $c \\le \\frac{8}{7}$ (比湿正定性)\n\n我们必须找到满足 $c \\le 2$，$c  75$ 和 $c \\le \\frac{8}{7}$ 的最大 $c$ 值。\n比较这些界限：$2 = \\frac{14}{7}$。因此，$\\frac{8}{7}$ 是这三个条件中最严格的上限。\n$$ \\min\\left(2, 75, \\frac{8}{7}\\right) = \\frac{8}{7} $$\n条件是 $c \\le \\frac{8}{7}$。$c$ 的最大允许值是这个集合中的最大值，即 $\\frac{8}{7}$。",
            "answer": "$$\\boxed{\\frac{8}{7}}$$"
        },
        {
            "introduction": "参数化方案不仅仅是数学上的便捷处理，它们必须旨在表征真实的物理过程。本练习将理论与物理直觉联系起来，揭示了Betts-Miller方案的核心思想。您将分析性地证明，将大气廓线“松弛”到一个中性的参考状态，在数学上等价于一个消耗对流有效位能（CAPE）的闭合方案，从而阐明该方案如何模拟对流调整的物理本质 。",
            "id": "4016626",
            "problem": "考虑一个遵循 Betts-Miller 系列方案的单柱对流调整，其中环境温度 $T_{e}(z)$ 和比湿 $q_{e}(z)$ 在一个时间尺度 $\\tau$ 上向预设的对流中性参考廓线 $T_{r}(z)$ 和 $q_{r}(z)$ 松弛。在一个模式时间步长 $\\Delta t$ 内的松弛过程表示为：\n$$\nT_{e}^{\\text{new}}(z) \\;=\\; T_{e}^{\\text{old}}(z) \\;+\\; \\frac{\\Delta t}{\\tau}\\,\\bigl(T_{r}(z) - T_{e}^{\\text{old}}(z)\\bigr), \\qquad\nq_{e}^{\\text{new}}(z) \\;=\\; q_{e}^{\\text{old}}(z) \\;+\\; \\frac{\\Delta t}{\\tau}\\,\\bigl(q_{r}(z) - q_{e}^{\\text{old}}(z)\\bigr).\n$$\n假设满足静力平衡和理想气体定律，并使用虚温公式 $T_{v} = T \\bigl(1 + \\epsilon\\, q\\bigr)$，其中 $\\epsilon$ 是一个正常数，概括了小液态水近似下的水汽效应。假设为计算对流有效位能 (CAPE) 而从抬升凝结高度 (LCL) 处的环境状态抬升的气块按常规方式定义，且浮力由下式给出：\n$$\nB(z) \\;=\\; g\\,\\frac{T_{vp}(z) - T_{ve}(z)}{T_{ve}(z)},\n$$\n其中 $g$ 是重力加速度，$T_{vp}(z)$ 是气块虚温，$T_{ve}(z)$ 是环境虚温。设 CAPE 为：\n$$\nC \\;=\\; \\int_{z_{\\text{LFC}}}^{z_{\\text{EL}}} B(z)\\,dz,\n$$\n其中自由对流高度 (LFC) 和平衡高度 (EL) 按标准方式定义。假设参考廓线 $T_{r}(z)$ 和 $q_{r}(z)$ 的构造使得参考气块是中性浮力的，即参考状态的 CAPE 为零，并且对于与参考状态的微小偏离，$B(z)$ 通过 $T_{ve}$ 线性依赖于 $T_{e}$ 和 $q_{e}$ 相对于 $T_{r}$ 和 $q_{r}$ 的偏离。\n\n从这些假设和定义出发，并将 $\\Delta t$ 内的松弛效应视为环境偏离向参考状态的线性收缩，推导出一个时间步长后更新的 CAPE 的解析表达式，用初始 CAPE $C_{0}$、时间步长 $\\Delta t$ 和松弛时间尺度 $\\tau$ 表示。然后，通过显式欧拉离散化，将此离散更新与形式为 $\\frac{dC}{dt} = -\\frac{1}{\\tau_{c}}\\,C$ 的连续对流有效位能 (CAPE) 移除闭合项联系起来，并用 $\\tau$ 表示闭合时间尺度 $\\tau_{c}$。\n\n将最终的 CAPE 以焦耳/千克 (J kg$^{-1}$) 表示，时间尺度以秒 (s) 表示。以单个解析表达式提供最终答案，或者如果要求两个量，则以一个 $1\\times 2$ 行矩阵的形式提供，其中第一个元素为更新后的 CAPE 表达式，第二个元素为闭合时间尺度。无需四舍五入。",
            "solution": "设环境的初始状态由 $T_{e}^{\\text{old}}(z)$ 和 $q_{e}^{\\text{old}}(z)$ 表示。初始对流有效位能 (CAPE) 为 $C_{0}$。问题指定了环境廓线在一个时间步长 $\\Delta t$ 内向参考廓线 $T_{r}(z)$ 和 $q_{r}(z)$ 的松弛过程。我们首先分析环境状态与参考状态的偏离如何演变。\n\n设变量 $\\phi$ 与其参考值 $\\phi_r$ 的偏离为 $\\delta\\phi = \\phi - \\phi_r$。给定的温度和比湿松弛方程为：\n$$T_{e}^{\\text{new}}(z) \\;=\\; T_{e}^{\\text{old}}(z) \\;+\\; \\frac{\\Delta t}{\\tau}\\,\\bigl(T_{r}(z) - T_{e}^{\\text{old}}(z)\\bigr)$$\n$$q_{e}^{\\text{new}}(z) \\;=\\; q_{e}^{\\text{old}}(z) \\;+\\; \\frac{\\Delta t}{\\tau}\\,\\bigl(q_{r}(z) - q_{e}^{\\text{old}}(z)\\bigr)$$\n从第一个方程两边减去 $T_{r}(z)$，我们得到温度偏离 $\\delta T_e(z) = T_e(z) - T_r(z)$ 的演变：\n$$\\delta T_e^{\\text{new}}(z) = \\delta T_e^{\\text{old}}(z) - \\frac{\\Delta t}{\\tau} \\delta T_e^{\\text{old}}(z) = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) \\delta T_e^{\\text{old}}(z)$$\n类似地，对比湿偏离 $\\delta q_e(z) = q_e(z) - q_r(z)$：\n$$\\delta q_e^{\\text{new}}(z) = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) \\delta q_e^{\\text{old}}(z)$$\n这证实了问题陈述中松弛过程作为环境偏离的线性收缩的说法。\n\n接下来，我们分析对浮力 $B(z)$ 的影响。问题假设，对于微小偏离，$B(z)$ 通过环境虚温 $T_{ve}$ 线性依赖于 $T_e$ 和 $q_e$ 的偏离。参考状态被假设为具有零 CAPE 并且是中性浮力的，这意味着参考气块具有与参考环境相同的虚温，$T_{vp,r}(z) = T_{ve,r}(z)$，导致浮力为零，$B_r(z) = 0$。\n\n环境虚温为 $T_{ve}(z) = T_e(z)(1 + \\epsilon q_e(z))$。我们在参考状态 $(T_r, q_r)$ 附近对此进行线性化：\n$$T_{ve}(z) = (T_r + \\delta T_e)(1 + \\epsilon(q_r + \\delta q_e)) \\approx T_r(1 + \\epsilon q_r) + \\delta T_e(1 + \\epsilon q_r) + T_r \\epsilon \\delta q_e$$\n其中像 $\\delta T_e \\delta q_e$ 这样的高阶项被忽略。参考状态的虚温为 $T_{ve,r} = T_r(1 + \\epsilon q_r)$。因此，环境虚温的偏离为：\n$$\\delta T_{ve}(z) = T_{ve}(z) - T_{ve,r}(z) \\approx (1 + \\epsilon q_r) \\delta T_e(z) + T_r \\epsilon \\delta q_e(z)$$\n由于 $\\delta T_e$ 和 $\\delta q_e$ 在一个时间步长后被因子 $(1 - \\frac{\\Delta t}{\\tau})$ 缩放，它们的线性组合 $\\delta T_{ve}$ 也必定被同一个因子缩放：\n$$\\delta T_{ve}^{\\text{new}}(z) = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) \\delta T_{ve}^{\\text{old}}(z)$$\n现在我们对浮力 $B(z) = g\\frac{T_{vp} - T_{ve}}{T_{ve}}$ 在中性浮力的参考状态附近进行线性化。问题中的措辞“通过 $T_{ve}$”以及对可行解的需求意味着，浮力的主要变化来自于 $T_{ve}$ 的变化，而气块的虚温廓线 $T_{vp}(z)$ 可以近似为与其参考状态相比保持不变，即 $T_{vp}(z) \\approx T_{vp,r}(z)$。由于参考状态是中性浮力的，$T_{vp,r}(z) = T_{ve,r}(z)$。\n$$B(z) \\approx g\\,\\frac{T_{ve,r}(z) - T_{ve}(z)}{T_{ve}(z)} = g\\,\\frac{-\\delta T_{ve}(z)}{T_{ve,r}(z) + \\delta T_{ve}(z)}$$\n对于微小偏离，$|\\delta T_{ve}| \\ll T_{ve,r}$，所以我们可以用 $T_{ve,r}(z)$ 来近似分母，从而得到：\n$$B(z) \\approx -g\\,\\frac{\\delta T_{ve}(z)}{T_{ve,r}(z)}$$\n该表达式在 $\\delta T_{ve}$ 上是线性的，与问题的假设一致。将此应用于时间步长前后的状态：\n$$B^{\\text{old}}(z) \\approx -g\\,\\frac{\\delta T_{ve}^{\\text{old}}(z)}{T_{ve,r}(z)}, \\qquad B^{\\text{new}}(z) \\approx -g\\,\\frac{\\delta T_{ve}^{\\text{new}}(z)}{T_{ve,r}(z)}$$\n代入 $\\delta T_{ve}^{\\text{new}}$ 的关系，我们得到新旧浮力廓线之间的关系：\n$$B^{\\text{new}}(z) \\approx -g\\,\\frac{(1 - \\Delta t/\\tau) \\delta T_{ve}^{\\text{old}}(z)}{T_{ve,r}(z)} = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) B^{\\text{old}}(z)$$\nCAPE 是浮力从自由对流高度 ($z_{\\text{LFC}}$) 到平衡高度 ($z_{\\text{EL}}$) 的积分。这些高度被定义为浮力廓线的过零点。由于 $B^{\\text{new}}(z)$ 只是 $B^{\\text{old}}(z)$ 的一个缩放版本，其过零点不会改变。因此，积分限保持不变。\n更新后的 CAPE，$C^{\\text{new}}$，为：\n$$C^{\\text{new}} = \\int_{z_{\\text{LFC}}}^{z_{\\text{EL}}} B^{\\text{new}}(z)\\,dz = \\int_{z_{\\text{LFC}}}^{z_{\\text{EL}}} \\left(1 - \\frac{\\Delta t}{\\tau}\\right) B^{\\text{old}}(z)\\,dz$$\n由于缩放因子 $(1 - \\frac{\\Delta t}{\\tau})$ 与高度 z 无关，可以将其从积分中提出：\n$$C^{\\text{new}} = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) \\int_{z_{\\text{LFC}}}^{z_{\\text{EL}}} B^{\\text{old}}(z)\\,dz$$\n该积分是初始 CAPE $C_0$ 的定义。因此，一个时间步长后更新的 CAPE 是：\n$$C^{\\text{new}} = \\left(1 - \\frac{\\Delta t}{\\tau}\\right) C_0$$\n\n对于问题的第二部分，我们必须将此离散更新与连续 CAPE 移除闭合项 $\\frac{dC}{dt} = -\\frac{1}{\\tau_{c}}C$ 联系起来。我们被要求对这个常微分方程使用显式（前向）欧拉离散化。显式欧拉方案将导数近似为 $\\frac{dC}{dt} \\approx \\frac{C(t+\\Delta t) - C(t)}{\\Delta t}$。\n将此代入连续方程：\n$$\\frac{C^{\\text{new}} - C_0}{\\Delta t} = -\\frac{1}{\\tau_c} C_0$$\n求解 $C^{\\text{new}}$：\n$$C^{\\text{new}} = C_0 - \\frac{\\Delta t}{\\tau_c} C_0 = \\left(1 - \\frac{\\Delta t}{\\tau_c}\\right) C_0$$\n现在我们将从 Betts-Miller 方案推导出的 $C^{\\text{new}}$ 表达式与从欧拉离散化得到的表达式相等：\n$$\\left(1 - \\frac{\\Delta t}{\\tau}\\right) C_0 = \\left(1 - \\frac{\\Delta t}{\\tau_c}\\right) C_0$$\n为使此等式对任何非零初始 CAPE $C_0$ 都成立，系数必须相等：\n$$1 - \\frac{\\Delta t}{\\tau} = 1 - \\frac{\\Delta t}{\\tau_c}$$\n这简化为 $\\frac{\\Delta t}{\\tau} = \\frac{\\Delta t}{\\tau_c}$，直接意味着闭合时间尺度 $\\tau_c$ 与松弛时间尺度 $\\tau$ 相同。\n$$\\tau_c = \\tau$$\n\n所要求的两个量是更新后的 CAPE 的表达式和闭合时间尺度 $\\tau_c$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\left(1 - \\frac{\\Delta t}{\\tau}\\right) C_{0}  \\tau\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论和基本的数值分析是至关重要的，但稳健的模式代码必须能够严格执行物理定律。本练习是构建一个可靠模型组件的实践步骤，要求您设计并实现一个“限制器”。这个限制器将确保在使用Betts-Miller方案调整后，湿度场始终保持在物理上允许的范围内（即大于零且小于饱和值），这是气候和天气建模中一项常见且至关重要的任务 。",
            "id": "4016635",
            "problem": "您的任务是在数值天气预报和气候模拟中，为 Betts–Miller 系列方案中的对流湿度调整设计并实现一个数学上一致的限制器。其目标是确保调整步骤的应用不会在任何模式层产生超饱和或负湿度。您的实现必须基于第一性原理和经过充分检验的物理公式。\n\n使用以下背景和要求：\n\n- Betts–Miller 对流调整在一个时间步长 $\\Delta t$ 内，根据一个比湿的预报源项，将比湿 $q$ 在一个弛豫时间尺度 $\\tau$ 上向参考廓线 $q_{\\mathrm{ref}}$ 进行弛豫调整：\n  $$ \\frac{dq}{dt} = \\frac{q_{\\mathrm{ref}} - q}{\\tau}. $$\n  如果没有任何限制器，在一个时间步长上的向前更新将得到\n  $$ q_{\\mathrm{raw}} = q + \\Delta t \\frac{q_{\\mathrm{ref}} - q}{\\tau}. $$\n\n- 每个模式层上比湿的物理允许集合为\n  $$ 0 \\le q \\le q_s(T,p), $$\n  其中 $q_s(T,p)$ 是在温度 $T$ 和气压 $p$ 下相对于液态水的饱和比湿。您必须使用关于饱和水汽压的克劳修斯–克拉佩龙关系和基于理想气体的比湿定义来计算 $q_s(T,p)$。请使用以下经过充分检验并被广泛接受的公式和常数：\n  - 液态水上的饱和水汽压：\n    $$ e_s(T) = e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right), $$\n    其中 $e_0 = 611.2\\,\\mathrm{Pa}$，$L_v = 2.5\\times 10^6\\,\\mathrm{J\\,kg^{-1}}$，$R_v = 461\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，以及 $T_0 = 273.15\\,\\mathrm{K}$。\n  - 饱和比湿：\n    $$ q_s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - \\left(1 - \\varepsilon\\right)\\, e_s(T)}, \\qquad \\varepsilon = \\frac{R_d}{R_v}, $$\n    其中 $R_d = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n\n- 您的限制器必须作用于对流增量，使得最终更新的比湿 $q_{\\mathrm{new}}$ 在每个层级上都满足 $0 \\le q_{\\mathrm{new}} \\le q_s(T,p)$。该限制器必须被表达并实现为一个数学上明确定义的操作，它能保持更新的单调性并避免引入人为振荡。\n\n- 从预报源项和物理允许集出发，基于第一性原理设计限制器。推导出受限更新必须满足的条件，并构建一个鲁棒的算法来强制执行这些条件。\n\n- 单位和数值约束：\n  - 温度 $T$ 的单位必须是 $\\mathrm{K}$。\n  - 气压 $p$ 的单位必须是 $\\mathrm{Pa}$。\n  - 比湿 $q$ 和 $q_{\\mathrm{ref}}$ 的单位必须是 $\\mathrm{kg\\,kg^{-1}}$。\n  - 时间尺度 $\\tau$ 和时间步长 $\\Delta t$ 的单位必须是 $\\mathrm{s}$。\n  - 最终答案必须以 $\\mathrm{kg\\,kg^{-1}}$ 为单位报告。\n\n在一个程序中实现您的算法，用以处理以下包含六个独立的单层案例的测试套件。每个案例都是一个元组 $(T, p, q, q_{\\mathrm{ref}}, \\tau, \\Delta t)$，单位如上所述：\n\n- 案例 1：$(300, 90000, 0.012, 0.014, 1800, 600)$\n- 案例 2：$(300, 90000, 0.0249, 0.030, 900, 900)$\n- 案例 3：$(300, 90000, 0.0010, 0.0000, 600, 1200)$\n- 案例 4：$(290, 100000, 0.0100, 0.0100, 600, 600)$\n- 案例 5：$(300, 90000, 0.0260, 0.0240, 6000, 600)$\n- 案例 6：$(270, 80000, 0.0040, 0.0060, 600, 600)$\n\n对于每个案例，使用上述公式计算 $q_s(T,p)$，在 $\\Delta t$ 上应用 Betts–Miller 对流弛豫，并强制执行您的限制器，以使返回的 $q_{\\mathrm{new}}$ 满足允许的界限。程序应生成单行输出，其中包含一个方括号内的逗号分隔列表形式的结果，每个值都四舍五入到六位小数，并以 $\\mathrm{kg\\,kg^{-1}}$ 为单位表示，例如：\n$$ [q_{\\mathrm{new},1}, q_{\\mathrm{new},2}, q_{\\mathrm{new},3}, q_{\\mathrm{new},4}, q_{\\mathrm{new},5}, q_{\\mathrm{new},6}] $$\n其中 $q_{\\mathrm{new},i}$ 对应于案例 $i$。",
            "solution": "问题陈述已经过验证，并被认为是合理的。它在科学上基于大气热力学和数值方法的原理，是适定的，并提供了一套完整且一致的数据和约束。因此，我们可以着手进行解决方案的推导和实现。\n\n任务的核心是为 Betts-Miller 式对流弛豫方案中比湿 $q$ 的预报更新设计一个限制器。该方案以时间尺度 $\\tau$ 将 $q$ 向参考廓线 $q_{\\mathrm{ref}}$ 进行弛豫。湿度源项的控制微分方程为：\n$$ \\frac{dq}{dt} = \\frac{q_{\\mathrm{ref}} - q}{\\tau} $$\n在时长为 $\\Delta t$ 的时间步长上进行简单的向前时间（显式欧拉）离散化，得到原始的、未受限制的更新：\n$$ q_{\\mathrm{raw}} = q + \\Delta t \\left( \\frac{q_{\\mathrm{ref}} - q}{\\tau} \\right) $$\n其中 $q$ 是时间步开始时的比湿。\n\n基本的物理约束是，新的比湿 $q_{\\mathrm{new}}$ 必须位于允许的物理范围内。该范围的下界为零（没有负质量），上界为局部温度 $T$ 和气压 $p$ 下的饱和比湿 $q_s(T,p)$。因此，我们必须强制执行：\n$$ 0 \\le q_{\\mathrm{new}} \\le q_s(T,p) $$\n一个朴素的方法是计算 $q_{\\mathrm{raw}}$，然后将其裁剪到 $[0, q_s(T,p)]$ 范围内。然而，正如题目所建议的，一种更鲁棒且物理上一致的方法是在时间积分步骤之前限制源项（或倾向项）本身。这确保了所应用的变动是在时间步长 $\\Delta t$ 内物理上允许的。\n\n设源项或倾向项为 $S = dq/dt$。更新方程为 $q_{\\mathrm{new}} = q + S \\Delta t$。为满足 $q_{\\mathrm{new}}$ 的物理边界，倾向项 $S$ 必须满足：\n$$ 0 \\le q + S \\Delta t \\le q_s(T,p) $$\n这个不等式可以分解为关于 $S$ 的两个条件：\n$1$. 下界：$q + S \\Delta t \\ge 0 \\implies S \\Delta t \\ge -q \\implies S \\ge -\\frac{q}{\\Delta t}$。\n$2$. 上界：$q + S \\Delta t \\le q_s \\implies S \\Delta t \\le q_s - q \\implies S \\le \\frac{q_s - q}{\\Delta t}$。\n\n这两个条件定义了一个物理上允许的倾向项区间 $[S_{\\mathrm{min}}, S_{\\mathrm{max}}]$，其中：\n$$ S_{\\mathrm{min}} = -\\frac{q}{\\Delta t} $$\n$$ S_{\\mathrm{max}} = \\frac{q_s(T,p) - q}{\\Delta t} $$\n由 Betts-Miller 弛豫决定的原始倾向项是：\n$$ S_{\\mathrm{raw}} = \\frac{q_{\\mathrm{ref}} - q}{\\tau} $$\n限制器的功能是将此原始倾向项投影到允许区间 $[S_{\\mathrm{min}}, S_{\\mathrm{max}}]$ 上。因此，受限倾向项 $S_{\\mathrm{lim}}$ 由下式给出：\n$$ S_{\\mathrm{lim}} = \\max(S_{\\mathrm{min}}, \\min(S_{\\mathrm{raw}}, S_{\\mathrm{max}})) $$\n此操作确保如果 $S_{\\mathrm{raw}}$ 已经处于物理边界内，则保持不变。如果它在边界之外，则调整到最近的有效值（$S_{\\min}$ 或 $S_{\\max}$）。该方法在严格执行物理约束的同时，尽可能地保留调整的方向（增湿或变干）。\n\n然后使用这个受限的倾向项计算最终更新的比湿：\n$$ q_{\\mathrm{new}} = q + \\Delta t S_{\\mathrm{lim}} $$\n根据构造，这个 $q_{\\mathrm{new}}$ 保证在 $[0, q_s(T,p)]$ 的范围内。如果限制器在上边界被激活，$S_{\\mathrm{lim}} = S_{\\mathrm{max}}$，则 $q_{\\mathrm{new}} = q + \\Delta t \\frac{q_s - q}{\\Delta t} = q_s$。如果在下边界被激活，$S_{\\mathrm{lim}} = S_{\\mathrm{min}}$，则 $q_{\\mathrm{new}} = q + \\Delta t \\frac{-q}{\\Delta t} = 0$。\n\n饱和比湿 $q_s(T,p)$ 是使用提供的标准公式计算的。首先，从克劳修斯–克拉佩龙关系计算饱和水汽压 $e_s(T)$：\n$$ e_s(T) = e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0} - \\frac{1}{T}\\right)\\right) $$\n其中常数 $e_0 = 611.2\\,\\mathrm{Pa}$，$L_v = 2.5\\times 10^6\\,\\mathrm{J\\,kg^{-1}}$，$R_v = 461\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$，以及 $T_0 = 273.15\\,\\mathrm{K}$。\n然后，使用基于分压的定义来求得 $q_s(T,p)$：\n$$ q_s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - \\left(1 - \\varepsilon\\right)\\, e_s(T)} $$\n其中 $\\varepsilon = R_d/R_v$，以及 $R_d = 287\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n\n每个测试案例的算法如下：\n$1$. 给定 $(T, p, q, q_{\\mathrm{ref}}, \\tau, \\Delta t)$，首先计算常数 $\\varepsilon$，$S_{\\mathrm{raw}}$，$e_s(T)$ 和 $q_s(T,p)$。请注意，在数值模式状态中，初始条件可能出现 $q > q_s(T,p)$ 或 $q  0$ 的情况，一个鲁棒的方案必须能够通过将变量强制返回到物理范围内来处理这种情况。\n$2$. 计算最小和最大允许倾向项，$S_{\\mathrm{min}}$ 和 $S_{\\mathrm{max}}$。\n$3$. 通过将 $S_{\\mathrm{raw}}$ 投影到 $[S_{\\mathrm{min}}, S_{\\mathrm{max}}]$ 上来计算受限倾向项 $S_{\\mathrm{lim}}$。\n$4$. 计算最终的、物理上一致的比湿，$q_{\\mathrm{new}} = q + \\Delta t S_{\\mathrm{lim}}$。\n将此过程应用于指定的六个测试案例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the limited specific humidity adjustment for a suite of test cases.\n    \"\"\"\n\n    # Define physical and atmospheric constants\n    E0 = 611.2  # Saturation vapor pressure at T0, in Pa\n    LV = 2.5e6  # Latent heat of vaporization, in J/kg\n    RV = 461.0  # Gas constant for water vapor, in J/(kg K)\n    RD = 287.0  # Gas constant for dry air, in J/(kg K)\n    T0 = 273.15 # Reference temperature for e_s formula, in K\n    EPSILON = RD / RV\n\n    # Define the test cases from the problem statement.\n    # Each tuple is (T, p, q, q_ref, tau, dt)\n    # T in K, p in Pa, q/q_ref in kg/kg, tau/dt in s\n    test_cases = [\n        (300.0, 90000.0, 0.012, 0.014, 1800.0, 600.0),\n        (300.0, 90000.0, 0.0249, 0.030, 900.0, 900.0),\n        (300.0, 90000.0, 0.0010, 0.0000, 600.0, 1200.0),\n        (290.0, 100000.0, 0.0100, 0.0100, 600.0, 600.0),\n        (300.0, 90000.0, 0.0260, 0.0240, 6000.0, 600.0),\n        (270.0, 80000.0, 0.0040, 0.0060, 600.0, 600.0),\n    ]\n\n    def calculate_q_new(T, p, q, q_ref, tau, dt):\n        \"\"\"\n        Calculates the new specific humidity after a limited convective adjustment.\n        \"\"\"\n        # Step 1: Calculate saturation specific humidity q_s (upper physical bound)\n        # Saturation vapor pressure using Clausius-Clapeyron\n        e_s = E0 * np.exp((LV / RV) * (1/T0 - 1/T))\n\n        # Saturation specific humidity\n        # Check for non-physical pressure condition, though not expected with given data\n        denominator = p - (1 - EPSILON) * e_s\n        if denominator = 0:\n            # Under extreme low pressure/high temp, this could be non-positive.\n            # In such a case, the atmosphere can hold infinite moisture, q_s -> inf.\n            # We set a very large number as an effective upper bound.\n            q_s = 1.0 \n        else:\n            q_s = (EPSILON * e_s) / denominator\n\n        # Step 2: Define and limit the tendency\n        \n        # The tendency must be limited to keep q_new in [0, q_s].\n        # q_new = q + S * dt must be >= 0 => S >= -q / dt\n        # q_new = q + S * dt must be = q_s => S = (q_s - q) / dt\n        \n        # Handle dt=0 case to avoid division by zero\n        if dt == 0:\n            return q\n            \n        s_min = -q / dt\n        s_max = (q_s - q) / dt\n        \n        # Handle tau=0 case, implies instantaneous relaxation\n        if tau == 0:\n            s_raw = np.inf if q_ref > q else -np.inf if q_ref  q else 0\n        else:\n            s_raw = (q_ref - q) / tau\n            \n        # Project s_raw onto the valid interval [s_min, s_max]\n        s_lim = max(s_min, min(s_raw, s_max))\n        \n        # Step 3: Calculate the new specific humidity\n        q_new = q + dt * s_lim\n        \n        return q_new\n\n    results = []\n    for case in test_cases:\n        T, p, q, q_ref, tau, dt = case\n        result = calculate_q_new(T, p, q, q_ref, tau, dt)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}