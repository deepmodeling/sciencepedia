{
    "hands_on_practices": [
        {
            "introduction": "This first exercise goes back to basics by connecting the abstract concept of Turbulent Kinetic Energy (TKE) to its measurable components. Starting from the fundamental definition of TKE as the kinetic energy associated with velocity fluctuations, you will use idealized yet representative profiles of velocity variances to construct the vertical TKE profile in the atmospheric surface layer. This practice reinforces the physical meaning of TKE and introduces the important concept of scaling with friction velocity, $u_*$, a cornerstone of boundary layer meteorology.",
            "id": "4106464",
            "problem": "In numerical weather prediction and climate modeling, parameterizations of the atmospheric surface layer often assume horizontally homogeneous, stationary, neutrally stratified flow, in which the turbulent kinetic energy budget equilibrates locally. Consider such a surface layer over a rough surface with roughness length $z_0$, and friction velocity $u_*$ defined by the surface shear stress. You are given idealized, empirically motivated vertical profiles for the streamwise, spanwise, and vertical velocity variances in terms of $z$:\n$$\\overline{u'u'}(z) \\;=\\; a_u\\,u_*^2\\,\\frac{z/\\lambda}{1+z/\\lambda}, \\qquad \\overline{v'v'}(z) \\;=\\; a_v\\,u_*^2\\,\\frac{z/\\lambda}{1+z/\\lambda}, \\qquad \\overline{w'w'}(z) \\;=\\; a_w\\,u_*^2\\,\\frac{z/\\lambda}{1+z/\\lambda},$$\nwhere $a_u$, $a_v$, and $a_w$ are positive constants, and $\\lambda$ is a surface-layer transition length scale proportional to $z_0$. Assume neutral stratification and horizontal homogeneity throughout. Let $a_u=2.40$, $a_v=1.90$, $a_w=1.25$, $z_0=0.03\\,\\mathrm{m}$, and $\\lambda=30\\,z_0$.\n\nStarting only from the fundamental definition of turbulent kinetic energy per unit mass and the given variance profiles, derive an explicit expression for the vertical profile $k(z)$ and construct the dimensionless ratio $F(z) = k(z)/u_*^2$. Then, define the inertial-sublayer scaling coefficient $C_k$ as the asymptotic limit $C_k = \\lim_{z/\\lambda \\to \\infty} F(z)$, which characterizes near-surface scaling with the friction velocity $u_*$. Compute $C_k$ numerically from the given constants.\n\nRound your final value of $C_k$ to four significant figures. Express the final coefficient as a pure number (dimensionless).",
            "solution": "The solution requires deriving the turbulent kinetic energy (TKE) profile $k(z)$, its dimensionless form $F(z)$, and the asymptotic scaling coefficient $C_k$ from the given velocity variance profiles.\n\n**Step 1: Derive the TKE profile, $k(z)$**\n\nThe turbulent kinetic energy per unit mass, $k$, is defined as half the sum of the velocity variances (the trace of the Reynolds stress tensor):\n$$ k(z) = \\frac{1}{2} \\left( \\overline{u'u'}(z) + \\overline{v'v'}(z) + \\overline{w'w'}(z) \\right) $$\nWe substitute the given empirical profiles for the variances into this definition:\n$$ k(z) = \\frac{1}{2} \\left( a_u u_*^2 \\frac{z/\\lambda}{1+z/\\lambda} + a_v u_*^2 \\frac{z/\\lambda}{1+z/\\lambda} + a_w u_*^2 \\frac{z/\\lambda}{1+z/\\lambda} \\right) $$\nFactoring out the common terms $u_*^2$ and $\\frac{z/\\lambda}{1+z/\\lambda}$ gives the explicit expression for the TKE profile:\n$$ k(z) = \\frac{1}{2} (a_u + a_v + a_w) u_*^2 \\frac{z/\\lambda}{1+z/\\lambda} $$\n\n**Step 2: Construct the dimensionless ratio, $F(z)$**\n\nThe problem asks for the dimensionless ratio $F(z) = k(z)/u_*^2$. Using the expression for $k(z)$ derived above, we divide by $u_*^2$:\n$$ F(z) = \\frac{k(z)}{u_*^2} = \\frac{1}{u_*^2} \\left[ \\frac{1}{2} (a_u + a_v + a_w) u_*^2 \\frac{z/\\lambda}{1+z/\\lambda} \\right] $$\nThe $u_*^2$ term cancels, yielding the dimensionless profile:\n$$ F(z) = \\frac{1}{2} (a_u + a_v + a_w) \\frac{z/\\lambda}{1+z/\\lambda} $$\n\n**Step 3: Compute the inertial-sublayer scaling coefficient, $C_k$**\n\nThe scaling coefficient $C_k$ is the asymptotic limit of $F(z)$ as height $z$ becomes much larger than the length scale $\\lambda$ (i.e., $z/\\lambda \\to \\infty$):\n$$ C_k = \\lim_{z/\\lambda \\to \\infty} F(z) = \\lim_{z/\\lambda \\to \\infty} \\left[ \\frac{1}{2} (a_u + a_v + a_w) \\frac{z/\\lambda}{1+z/\\lambda} \\right] $$\nSince the term with the constants is not dependent on the limit, we can pull it out:\n$$ C_k = \\frac{1}{2} (a_u + a_v + a_w) \\lim_{z/\\lambda \\to \\infty} \\left( \\frac{z/\\lambda}{1+z/\\lambda} \\right) $$\nThe limit of the fractional term is 1:\n$$ \\lim_{x \\to \\infty} \\frac{x}{1+x} = \\lim_{x \\to \\infty} \\frac{1}{(1/x)+1} = \\frac{1}{0+1} = 1 $$\nTherefore, the asymptotic coefficient is:\n$$ C_k = \\frac{1}{2} (a_u + a_v + a_w) $$\n\n**Step 4: Numerical Calculation**\n\nFinally, we substitute the given numerical values for the constants $a_u = 2.40$, $a_v = 1.90$, and $a_w = 1.25$:\n$$ C_k = \\frac{1}{2} (2.40 + 1.90 + 1.25) $$\n$$ C_k = \\frac{1}{2} (5.55) $$\n$$ C_k = 2.775 $$\nThis value already has four significant figures, as requested. The other length scale parameters ($z_0$ and $\\lambda$) are not needed for this calculation, as they pertain to the shape of the profile at lower altitudes, not its asymptotic value.",
            "answer": "$$\\boxed{2.775}$$"
        },
        {
            "introduction": "The TKE budget equation contains several terms, such as transport and dissipation, that are not explicitly resolved in many models and must be parameterized. This practice focuses on one such crucial term: the vertical transport of TKE. By implementing a common \"down-gradient\" parameterization, where turbulence acts to diffuse TKE from regions of high to low concentration, you will calculate this term's contribution to the local energy budget and gain insight into the mechanics of turbulence closure models. ",
            "id": "4106453",
            "problem": "Consider a horizontally homogeneous, neutrally stratified atmospheric boundary layer governed by the Reynolds-Averaged Navier–Stokes (RANS) equations under the Boussinesq approximation. The turbulent kinetic energy (TKE) is defined as $k = \\frac{1}{2}\\langle u_i' u_i' \\rangle$, where $\\langle \\cdot \\rangle$ denotes an ensemble average and $u_i'$ are the velocity fluctuations. In one dimension (vertical only), the local TKE budget contains a vertical transport term represented by the divergence of the TKE flux, denoted $\\partial F_k / \\partial z$. You are provided an observed, smooth fit to the TKE profile\n$$\nk(z) = k_0 \\exp\\!\\left(-\\frac{z}{H}\\right),\n$$\nwith $k_0 = 0.5\\,\\mathrm{m}^2\\,\\mathrm{s}^{-2}$ and $H = 150\\,\\mathrm{m}$, valid for $z \\in [0, 500]\\,\\mathrm{m}$. To close the transport, adopt a down-gradient model for the TKE flux,\n$$\nF_k = -K_k(z)\\,\\frac{\\partial k}{\\partial z},\n$$\nwith an eddy diffusivity for TKE given by a mixing-length formulation\n$$\nK_k(z) = c_k\\,\\kappa\\,z\\,\\sqrt{k(z)},\n$$\nwhere $c_k = 0.25$ is a dimensionless constant, and $\\kappa = 0.4$ is the von Kármán constant. Using these inputs and starting from first principles appropriate to the RANS TKE budget, derive an expression for the contribution of vertical transport to the local TKE tendency, namely $-\\partial F_k/\\partial z$, and evaluate it at the height $z_* = 60\\,\\mathrm{m}$. Report the final numerical value of $-\\partial F_k/\\partial z$ at $z_*$ in $\\mathrm{m}^2\\,\\mathrm{s}^{-3}$, rounded to three significant figures.",
            "solution": "The contribution of vertical transport to the local TKE tendency is given by the negative divergence of the TKE flux, $-\\frac{\\partial F_k}{\\partial z}$. The problem provides a down-gradient model for the flux, $F_k = -K_k(z)\\,\\frac{\\partial k}{\\partial z}$. Therefore, the term we need to compute is:\n$$-\\frac{\\partial F_k}{\\partial z} = -\\frac{\\partial}{\\partial z}\\left(-K_k(z)\\,\\frac{\\partial k}{\\partial z}\\right) = \\frac{\\partial}{\\partial z}\\left(K_k(z)\\,\\frac{\\partial k}{\\partial z}\\right)$$\nThe derivation proceeds in a series of steps.\n\n**Step 1: Calculate the vertical gradient of TKE, $\\frac{\\partial k}{\\partial z}$**\nUsing the provided profile $k(z) = k_0 \\exp(-z/H)$:\n$$\\frac{\\partial k}{\\partial z} = \\frac{d}{dz}\\left(k_0 \\exp\\left(-\\frac{z}{H}\\right)\\right) = k_0 \\left(-\\frac{1}{H}\\right) \\exp\\left(-\\frac{z}{H}\\right) = -\\frac{k_0}{H} \\exp\\left(-\\frac{z}{H}\\right)$$\n\n**Step 2: Formulate the eddy diffusivity, $K_k(z)$**\nUsing the given mixing-length formulation and substituting the TKE profile:\n$$K_k(z) = c_k\\,\\kappa\\,z\\,\\sqrt{k(z)} = c_k\\,\\kappa\\,z\\,\\sqrt{k_0 \\exp\\left(-\\frac{z}{H}\\right)} = c_k\\,\\kappa\\,z\\,\\sqrt{k_0} \\exp\\left(-\\frac{z}{2H}\\right)$$\n\n**Step 3: Combine terms to form the flux product**\nWe now form the product inside the main derivative, which is proportional to the TKE flux:\n$$K_k(z)\\,\\frac{\\partial k}{\\partial z} = \\left(c_k\\,\\kappa\\,z\\,\\sqrt{k_0} \\exp\\left(-\\frac{z}{2H}\\right)\\right) \\left(-\\frac{k_0}{H} \\exp\\left(-\\frac{z}{H}\\right)\\right)$$\n$$K_k(z)\\,\\frac{\\partial k}{\\partial z} = -\\frac{c_k\\,\\kappa\\,k_0^{3/2}}{H}\\,z\\,\\exp\\left(-\\frac{3z}{2H}\\right)$$\n\n**Step 4: Differentiate to find the TKE tendency due to transport**\nWe differentiate the expression from Step 3 with respect to $z$ using the product rule:\n$$-\\frac{\\partial F_k}{\\partial z} = \\frac{\\partial}{\\partial z}\\left[-\\frac{c_k\\,\\kappa\\,k_0^{3/2}}{H}\\,z\\,\\exp\\left(-\\frac{3z}{2H}\\right)\\right]$$\n$$-\\frac{\\partial F_k}{\\partial z} = -\\frac{c_k\\,\\kappa\\,k_0^{3/2}}{H} \\left[ (1) \\cdot \\exp\\left(-\\frac{3z}{2H}\\right) + z \\cdot \\left(-\\frac{3}{2H}\\right) \\exp\\left(-\\frac{3z}{2H}\\right) \\right]$$\nFactoring out the common exponential term gives the final analytical expression:\n$$-\\frac{\\partial F_k}{\\partial z} = -\\frac{c_k\\,\\kappa\\,k_0^{3/2}}{H} \\left(1 - \\frac{3z}{2H}\\right) \\exp\\left(-\\frac{3z}{2H}\\right)$$\n\n**Step 5: Evaluate the expression numerically**\nWe evaluate this expression at $z_* = 60\\,\\mathrm{m}$ with the given constants: $k_0 = 0.5\\,\\mathrm{m^2\\,s^{-2}}$, $H = 150\\,\\mathrm{m}$, $c_k = 0.25$, and $\\kappa = 0.4$.\n- Product of closure constants: $c_k\\,\\kappa = 0.25 \\times 0.4 = 0.1$.\n- TKE term: $k_0^{3/2} = (0.5)^{1.5} \\approx 0.353553\\,\\mathrm{m^3\\,s^{-3}}$.\n- The term in parenthesis: $1 - \\frac{3z_*}{2H} = 1 - \\frac{3 \\times 60}{2 \\times 150} = 1 - \\frac{180}{300} = 1 - 0.6 = 0.4$.\n- The exponential term: $\\exp\\left(-\\frac{3z_*}{2H}\\right) = \\exp(-0.6) \\approx 0.548812$.\n\nSubstituting these values into the expression:\n$$-\\frac{\\partial F_k}{\\partial z}\\bigg|_{z=z_*} = -\\frac{0.1 \\cdot 0.353553}{150} \\cdot (0.4) \\cdot 0.548812$$\n$$-\\frac{\\partial F_k}{\\partial z}\\bigg|_{z=z_*} \\approx -(2.35702 \\times 10^{-4}) \\cdot (0.219525)$$\n$$-\\frac{\\partial F_k}{\\partial z}\\bigg|_{z=z_*} \\approx -5.1746 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-3}}$$\nRounding to three significant figures gives the final result.",
            "answer": "$$\\boxed{-5.17 \\times 10^{-5}}$$"
        },
        {
            "introduction": "A critical step in model development and analysis is verifying that simulated physics adheres to fundamental conservation laws, a concept known as budget closure. This exercise puts you in the role of a model diagnostician, tasked with verifying the TKE budget using synthetic data from a Large-Eddy Simulation (LES). By writing a routine to compute the residual between the TKE tendency and the sum of all source and sink terms, you will learn how to quantify model consistency and identify imbalances that may point to numerical errors or missing physics. ",
            "id": "4106454",
            "problem": "You are given synthetic outputs from a Large-Eddy Simulation (LES) of a turbulent atmospheric flow for the Turbulent Kinetic Energy (TKE) budget terms at grid points in a small domain. Turbulent Kinetic Energy (TKE) is defined as $k = \\tfrac{1}{2} \\overline{u_i' u_i'}$, where $u_i'$ are velocity fluctuations and the overbar denotes suitable averaging. In the filtered incompressible momentum equations used in Numerical Weather Prediction (NWP) and climate modeling, the TKE budget is a local balance between the temporal tendency and the sum of physically interpretable source and sink terms. You must check, for each provided test case, both the local budget closure and the domain-integrated budget closure. The check must be implemented purely as a mathematical verification of balance: at each grid cell, compute the residual $r$ as the left-hand-side tendency minus the sum of all provided right-hand-side terms. Then quantify whether the residual is acceptably small locally and in a domain-integrated sense.\n\nDefinitions and units:\n- All budget terms are per unit mass and have units of $\\text{m}^2\\,\\text{s}^{-3}$.\n- The local residual at grid cell $(i,j)$ is $r_{ij} = T_{k,ij} - \\left(S_{ij} + B_{ij} + C_{p,ij} + D_{ij} + T_{t,ij} - \\epsilon_{ij}\\right)$, where $T_{k}$ is the TKE tendency, $S$ is shear production, $B$ is buoyancy production, $C_p$ is the pressure correlation term, $D$ is viscous diffusion, $T_t$ is turbulent transport, and $\\epsilon$ is dissipation.\n- The local check uses the maximum absolute residual over the grid, $\\max_{i,j} |r_{ij}|$, compared against a specified local tolerance.\n- The integrated check uses the volume-weighted average absolute residual, $\\left(\\sum_{i,j} |r_{ij}| V_{ij}\\right) / \\left(\\sum_{i,j} V_{ij}\\right)$, compared against a specified integrated tolerance, where $V_{ij}$ is the grid cell volume in $\\text{m}^3$.\n\nYou must implement the following for each test case:\n1. Compute the residual array $r_{ij}$.\n2. Compute the maximum absolute residual $\\max_{i,j} |r_{ij}|$ (in $\\text{m}^2\\,\\text{s}^{-3}$).\n3. Compute the volume-weighted average absolute residual $(\\sum_{i,j} |r_{ij}| V_{ij}) / (\\sum_{i,j} V_{ij})$ (in $\\text{m}^2\\,\\text{s}^{-3}$).\n4. Determine two boolean flags:\n   - $b_{\\text{local}}$ is $\\text{True}$ if $\\max_{i,j} |r_{ij}| \\le \\tau_{\\text{local}}$ and $\\text{False}$ otherwise.\n   - $b_{\\text{int}}$ is $\\text{True}$ if the volume-weighted average absolute residual $\\le \\tau_{\\text{int}}$ and $\\text{False}$ otherwise.\nHere $\\tau_{\\text{local}}$ and $\\tau_{\\text{int}}$ are the prescribed tolerances per test.\n\nPhysical units requirement:\n- Express the two residual magnitudes in $\\text{m}^2\\,\\text{s}^{-3}$.\n- Booleans are unitless.\n\nTest suite parameters:\n- Three $2\\times 2$ test cases. Each includes arrays for $S$, $B$, $C_p$, $D$, $T_t$, $\\epsilon$, $T_k$, and $V$ (volumes). Tolerances are specified as $\\tau_{\\text{local}} = 10^{-6}\\ \\text{m}^2\\,\\text{s}^{-3}$ and $\\tau_{\\text{int}} = 5 \\times 10^{-7}\\ \\text{m}^2\\,\\text{s}^{-3}$.\n\nTest Case 1 (near-perfect local and integrated balance):\n$$ V = \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}\\ \\text{m}^3 $$\n$$ S = \\begin{bmatrix} 0.5  0.4 \\\\ 0.3  0.2 \\end{bmatrix}, B = \\begin{bmatrix} 0.1  -0.05 \\\\ 0.0  0.02 \\end{bmatrix}, C_p = \\begin{bmatrix} -0.06  0.03 \\\\ 0.01  -0.02 \\end{bmatrix}, D = \\begin{bmatrix} 0.02  0.01 \\\\ 0.03  0.00 \\end{bmatrix}, T_t = \\begin{bmatrix} -0.03  0.00 \\\\ 0.02  -0.01 \\end{bmatrix}, \\epsilon = \\begin{bmatrix} 0.40  0.35 \\\\ 0.30  0.20 \\end{bmatrix} $$\n$$ T_k = \\begin{bmatrix} 0.1300002  0.0400001 \\\\ 0.0599999  -0.0099997 \\end{bmatrix} $$\n\nTest Case 2 (systematic bias indicative of numerical error):\n$$ V = \\begin{bmatrix} 1  1 \\\\ 1  1 \\end{bmatrix}\\ \\text{m}^3 $$\n- $S$, $B$, $C_p$, $D$, $T_t$, $\\epsilon$ identical to Test Case $1$.\n$$ T_k = \\begin{bmatrix} 0.135  0.045 \\\\ 0.065  -0.005 \\end{bmatrix} $$\n\nTest Case 3 (heterogeneous volumes; integrated tolerance stricter than local):\n$$ V = \\begin{bmatrix} 1  1 \\\\ 10  10 \\end{bmatrix}\\ \\text{m}^3 $$\n- $S$, $B$, $C_p$, $D$, $T_t$, $\\epsilon$ identical to Test Case $1$.\n$$ T_k = \\begin{bmatrix} 0.1300001  0.0400001 \\\\ 0.0600006  -0.0099994 \\end{bmatrix} $$\n\nAlgorithmic requirements:\n- Implement the residual computation and checks as specified, without reading input from the user and without external files.\n- Use the provided arrays exactly.\n- For each test case, produce a result list of the form $[\\text{local\\_max}, \\text{integrated\\_avg}, b_{\\text{local}}, b_{\\text{int}}]$ where $\\text{local\\_max}$ and $\\text{integrated\\_avg}$ are floats in $\\text{m}^2\\,\\text{s}^{-3}$ and the booleans are unitless.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element corresponds to a test case and is itself a list $[\\text{local\\_max}, \\text{integrated\\_avg}, b_{\\text{local}}, b_{\\text{int}}]$. For example: $[[x_1,y_1,\\text{True},\\text{False}],[x_2,y_2,\\text{True},\\text{True}],[x_3,y_3,\\text{False},\\text{False}]]$.",
            "solution": "This problem assesses the numerical closure of the Turbulent Kinetic Energy (TKE) budget from synthetic simulation data. In a numerically perfect simulation, the TKE tendency term ($T_k$) should be exactly balanced by the sum of all modeled source and sink terms. An imbalance points to numerical errors or unrepresented physics. We quantify this imbalance by computing a residual, $r$, for each grid cell:\n$$\nr_{ij} = T_{k,ij} - \\left( S_{ij} + B_{ij} + C_{p,ij} + D_{ij} + T_{t,ij} - \\epsilon_{ij} \\right)\n$$\nWe then evaluate two metrics: the maximum absolute residual across the grid, and the volume-weighted average absolute residual. These are compared against tolerances to check for local and integrated budget closure.\n\nThe procedure is as follows for each test case:\n1.  **Calculate the total source/sink term:** Sum all right-hand-side (RHS) term arrays: $RHS = S + B + C_p + D + T_t - \\epsilon$.\n2.  **Compute the residual array:** Subtract the RHS array from the TKE tendency array: $r = T_k - RHS$.\n3.  **Calculate the metrics:**\n    *   Maximum absolute residual: $\\max_{i,j} |r_{ij}|$.\n    *   Volume-weighted average absolute residual: $(\\sum |r_{ij}| V_{ij}) / (\\sum V_{ij})$.\n4.  **Compare with tolerances:**\n    *   $b_{\\text{local}}$ is `True` if the maximum absolute residual is less than or equal to $\\tau_{\\text{local}} = 10^{-6}$.\n    *   $b_{\\text{int}}$ is `True` if the volume-weighted average is less than or equal to $\\tau_{\\text{int}} = 5 \\times 10^{-7}$.\n\nThis procedure is applied to all three test cases using the provided data to generate the final result.",
            "answer": "[[3.0e-7, 1.75e-7, True, True], [0.005, 0.005, False, False], [6.0e-7, 5.545454545454545e-7, True, False]]"
        }
    ]
}