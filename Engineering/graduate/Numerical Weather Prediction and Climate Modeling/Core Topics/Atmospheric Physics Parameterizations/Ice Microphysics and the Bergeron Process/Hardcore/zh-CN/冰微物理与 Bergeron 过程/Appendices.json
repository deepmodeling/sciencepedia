{
    "hands_on_practices": [
        {
            "introduction": "贝格龙过程的核心在于，在冰点以下的温度，$T \\lt 273.15\\,\\mathrm{K}$，冰上的饱和水汽压 $e_s^i$ 低于过冷水上的饱和水汽压 $e_s^w$。要深入理解并量化这一过程的效率，我们不仅要知道这个差异的存在，还必须分析它对温度的敏感性。这个练习将指导你从克劳修斯-克拉佩龙方程这一热力学第一性原理出发，推导并计算这一关键热力学驱动力的温度敏感性，从而加深对贝格龙过程物理本质的理解 。",
            "id": "4053787",
            "problem": "在混合相云中，当温度 $T  273\\,\\mathrm{K}$ 时，冰面饱和水汽压 $e_s^i(T)$ 低于过冷水面饱和水汽压 $e_s^w(T)$，这导致了贝吉龙过程的发生，该过程驱动水汽向冰晶上净凝华，并使液滴蒸发。将比值 $e_s^i/e_s^w$ 的温度敏感性视为该过程的一个控制性热力学因子。使用克劳修斯-克拉佩龙微分形式 $d\\ln e_s/dT = L/(R_v T^2)$（其中 $L$ 是相应的潜热，$R_v$ 是水汽的气体常数），从第一性原理出发，推导敏感性 $S(T) \\equiv d\\ln\\!\\left(e_s^i/e_s^w\\right)/dT$，并使用常数 $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$、蒸发潜热 $L_w = 2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$ 和升华潜热 $L_i = 2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$，在 $T=263\\,\\mathrm{K}$ 时对其进行求值。在求值点附近，将 $L_w$ 和 $L_i$ 视为与温度无关。然后，结合贝吉龙过程在数值天气预报和气候模式中的热力学驱动作用，简要解释 $S(T)$ 的符号和量级。\n\n将您最终的 $S(T)$ 数值答案四舍五入至四位有效数字。最终的敏感性以 $\\mathrm{K}^{-1}$ 为单位表示。",
            "solution": "### 问题验证\n该问题在科学上是合理的，基于大气热力学的基本原理，特别是克劳修斯-克拉佩龙关系及其在云物理中的应用。问题定义清晰，提供了推导和计算所需的所有信息和常数，可以得出一个唯一的解。前提条件、常数值和任务都是物理上现实且一致的。问题判定为**有效**，展开完整求解。\n\n### 敏感性 $S(T)$ 的推导\n敏感性 $S(T)$ 定义为：\n$$S(T) \\equiv \\frac{d}{dT}\\left[\\ln\\left(\\frac{e_s^i}{e_s^w}\\right)\\right]$$\n利用自然对数的性质，我们可以将表达式重写为两个对数之差：\n$$S(T) = \\frac{d}{dT}\\left[\\ln(e_s^i) - \\ln(e_s^w)\\right]$$\n对温度 $T$ 求导：\n$$S(T) = \\frac{d\\ln(e_s^i)}{dT} - \\frac{d\\ln(e_s^w)}{dT}$$\n问题给出了克劳修斯-克拉佩龙关系式的形式 $d\\ln e_s/dT = L/(R_v T^2)$。我们将此关系式应用于每一项。\n\n对于冰面饱和水汽压 $e_s^i$，相关的相变是升华（固态到汽态）。因此，相应的潜热是升华潜热 $L_i$。\n$$\\frac{d\\ln(e_s^i)}{dT} = \\frac{L_i}{R_v T^2}$$\n对于液态水面饱和水汽压 $e_s^w$，相关的相变是蒸发（液态到汽态）。相应的潜热是蒸发潜热 $L_w$。\n$$\\frac{d\\ln(e_s^w)}{dT} = \\frac{L_w}{R_v T^2}$$\n将这些表达式代回 $S(T)$ 的方程中：\n$$S(T) = \\frac{L_i}{R_v T^2} - \\frac{L_w}{R_v T^2}$$\n提取公因式，我们得到敏感性的最终解析表达式：\n$$S(T) = \\frac{L_i - L_w}{R_v T^2}$$\n项 $L_i - L_w$ 代表熔化潜热 $L_f$，即在给定温度下升华和蒸发之间的能量差。\n\n### 在 $T = 263\\,\\mathrm{K}$ 下的数值计算\n现在我们将给定的数值代入推导出的 $S(T)$ 表达式中。\n- $L_i = 2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$\n- $L_w = 2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$\n- $R_v = 461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n- $T = 263\\,\\mathrm{K}$\n\n$$S(263\\,\\mathrm{K}) = \\frac{(2.835 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}) - (2.50 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1})}{(461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}) \\times (263\\,\\mathrm{K})^2}$$\n$$S(263\\,\\mathrm{K}) = \\frac{0.335 \\times 10^6\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}}{461\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1} \\times 69169\\,\\mathrm{K}^2}$$\n$$S(263\\,\\mathrm{K}) = \\frac{335000}{31886909}\\,\\mathrm{K}^{-1}$$\n$$S(263\\,\\mathrm{K}) \\approx 0.01050591\\,\\mathrm{K}^{-1}$$\n按要求将结果四舍五入至四位有效数字：\n$$S(263\\,\\mathrm{K}) \\approx 1.051 \\times 10^{-2}\\,\\mathrm{K}^{-1}$$\n\n### 符号和量级的解释\n推导出的敏感性 $S(T) = (L_i - L_w)/(R_v T^2)$ 具有明确的物理意义。\n\n**符号：** $S(T)$ 的符号由分子 $L_i - L_w = L_f$ 决定。由于升华 ($L_i$) 总比蒸发 ($L_w$) 需要更多的能量（因为它包含了固态到液态相变所需的能量），所以 $L_i > L_w$，分子为正。分母 $R_v T^2$ 也始终为正。因此，$S(T)$ 在所有温度下都为正。$S(T) = d\\ln(e_s^i/e_s^w)/dT$ 为正号表明比值 $e_s^i/e_s^w$ 随温度升高而增大。这在物理上是一致的：对于 $T  273\\,\\mathrm{K}$，该比值小于1，随着 $T$ 升向 $273\\,\\mathrm{K}$，该比值从下方趋近于1。一个向极限值递增的函数其导数为正。贝吉龙过程由相对于冰面的过饱和度驱动，该过饱和度与 $e_s^w/e_s^i - 1$ 成正比。$S(T) > 0$ 等价于 $d\\ln(e_s^w/e_s^i)/dT  0$，这意味着随着温度在冰点以下进一步降低，驱动该过程的过饱和度会变得更强。\n\n**量级：** $S(263\\,\\mathrm{K}) \\approx 1.051 \\times 10^{-2}\\,\\mathrm{K}^{-1}$ 的量级，量化了在 $-10^\\circ\\mathrm{C}$ 附近贝吉龙过程热力学强迫的温度敏感性。该值意味着饱和水汽压的对数比值每随温度变化一开尔文，其变化量约为 $1.051\\%$。在数值天气预报（NWP）和气候模式中，这种敏感性是一个关键参数。它决定了在混合相云中，冰晶以过冷水滴为代价的增长速率（冰化）对微小温度波动的响应速度。温度 $263\\,\\mathrm{K}$ 接近绝对差值 $e_s^w - e_s^i$ 达到最大的范围，此时贝吉龙过程效率最高。在模式的微物理方案中准确地表示这种敏感性，对于正确模拟云相态分配、降水形成以及云辐射特性至关重要，而所有这些对于准确的天气预报和气候预测都是必不可少的。",
            "answer": "$$\n\\boxed{1.051 \\times 10^{-2}}\n$$"
        },
        {
            "introduction": "在真实的混合相云中，贝格龙过程并非孤立存在，它需要与其他微物理过程竞争。冰晶除了通过水汽凝华增长外，还能通过收集过冷水滴来增长，这一过程称为“淞化” (riming)。理解在特定条件下哪种过程占主导，对于准确预测云的生命周期和降水类型至关重要。本练习要求你运用简化的标准物理模型，分别对贝格龙过程和淞化过程的液态水消耗率进行建模，并定量比较它们的相对重要性 。",
            "id": "4053809",
            "problem": "考虑一个温度为 $T = 263\\,\\mathrm{K}$ 的混合均匀的浅层云，其中冰上的水汽凝华（Bergeron-Findeisen 过程）和碰冻过程共同消耗液态水。假设云中有半径为 $r_i = 1.0 \\times 10^{-4}\\,\\mathrm{m}$、终末下落速度为 $V_i = 0.5\\,\\mathrm{m\\,s^{-1}}$ 的单分散球形冰晶，且通风效应可忽略不计（通风因子等于 $1$）。环境空气密度为 $\\rho_{\\mathrm{air}} = 1.2\\,\\mathrm{kg\\,m^{-3}}$，水汽在空气中的扩散系数为 $D_v = 2.1 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-1}}$，在 $T = 263\\,\\mathrm{K}$ 时冰面饱和水汽密度为 $\\rho_{v,i}^{*} = 2.145 \\times 10^{-3}\\,\\mathrm{kg\\,m^{-3}}$。设液态水质量混合比为 $q_l = 2.0 \\times 10^{-4}$，碰冻收集效率为 $E_c = 0.7$，冰面过饱和度为 $S_i = 0.01$。\n\n从基本输运原理出发，将单个球形冰晶上的 Bergeron-Findeisen 凝华过程建模为扩散限制过程，其质量增长率 $\\dot{m}_d$ 与几何传导项和过量水汽质量密度的乘积成正比；并将单个球形冰晶上的碰冻过程建模为具有碰撞效率的液态质量的几何扫出过程。具体来说，使用：\n- 用于球形汇的菲克扩散定律和小过饱和度线性化，将凝华率与 $D_v$、$r_i$ 和 $\\rho_{v,i}^{*} S_i$ 联系起来。\n- 用于碰冻的几何收集，将质量吸积率与 $E_c$、$\\pi r_i^2$、$V_i$ 和单位体积的环境液态水质量 $\\rho_{\\mathrm{air}} q_l$ 联系起来。\n\n假设单位云体积内包含 $N_i$ 个冰晶，但请注意 $N_i$ 会在所求的分数中被约去。推导由碰冻过程完成的总液态水消耗分数\n$$\nf_{\\mathrm{rime}} = \\frac{R_{\\mathrm{rime}}}{R_{\\mathrm{rime}} + R_{\\mathrm{Bergeron}}},\n$$\n的表达式，其中 $R_{\\mathrm{rime}}$ 和 $R_{\\mathrm{Bergeron}}$ 分别是由碰冻和 Bergeron-Findeisen 过程引起的液态水体积消耗率，然后使用给定参数计算其数值。将最终答案表示为一个四舍五入到四位有效数字的小数。不允许使用百分号。",
            "solution": "### 问题验证\n该问题在科学上是合理的，它要求比较两种已确立的云微物理过程：通过凝华的贝吉龙过程和通过碰冻的淞化过程。所使用的模型（扩散限制增长和几何扫出）是标准的简化模型。所有必要的参数和常数都已提供，并且其数值在大气科学的背景下是现实的。该问题定义明确，可以得出一个唯一的数值解。问题判定为**有效**，展开完整求解。\n\n### 步骤1：为贝吉龙过程建模\n根据菲克扩散定律，单个球形冰晶通过水汽凝华的质量增长率（$\\dot{m}_{\\mathrm{Bergeron}}$）可以表示为：\n$$\n\\dot{m}_{\\mathrm{Bergeron}} = 4 \\pi r_i D_v (\\rho_{v,\\infty} - \\rho_{v,i}^{*})\n$$\n其中 $r_i$ 是冰晶半径，$D_v$ 是水汽扩散系数，$\\rho_{v,\\infty}$ 是环境水汽密度，$\\rho_{v,i}^{*}$ 是冰面饱和水汽密度。\n环境相对于冰的过饱和度 $S_i$ 定义为 $S_i = (\\rho_{v,\\infty} - \\rho_{v,i}^{*}) / \\rho_{v,i}^{*}$。因此，过量水汽密度为 $\\rho_{v,\\infty} - \\rho_{v,i}^{*} = \\rho_{v,i}^{*} S_i$。\n代入后，单个冰晶的凝华增长率为：\n$$\n\\dot{m}_{\\mathrm{Bergeron}} = 4 \\pi r_i D_v \\rho_{v,i}^{*} S_i\n$$\n在贝吉龙过程中，冰晶增长消耗的水汽由过冷水滴蒸发来补充。因此，冰晶的质量增长率等于液态水的消耗率。对于单位体积内含有 $N_i$ 个冰晶的云，总的液态水消耗率为：\n$$\nR_{\\mathrm{Bergeron}} = N_i \\cdot \\dot{m}_{\\mathrm{Bergeron}} = N_i (4 \\pi r_i D_v \\rho_{v,i}^{*} S_i)\n$$\n\n### 步骤2：为淞化过程建模\n淞化过程是冰晶下落时收集过冷水滴。单个冰晶的质量增长率（$\\dot{m}_{\\mathrm{rime}}$）可以通过几何扫出模型估算：\n$$\n\\dot{m}_{\\mathrm{rime}} = E_c \\cdot (\\pi r_i^2) \\cdot V_i \\cdot \\rho_l\n$$\n其中 $E_c$ 是收集效率，$\\pi r_i^2$ 是冰晶的扫出截面积，$V_i$ 是其下落末速度，$\\rho_l$ 是云中液态水的质量密度（单位体积空气中的液态水质量）。\n液态水质量密度可以由液态水质量混合比 $q_l$ 和空气密度 $\\rho_{\\mathrm{air}}$ 计算得出：$\\rho_l = \\rho_{\\mathrm{air}} q_l$。\n因此，单个冰晶的淞化增长率为：\n$$\n\\dot{m}_{\\mathrm{rime}} = E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l\n$$\n这个过程直接消耗液态水。对于单位体积的云，总的液态水消耗率为：\n$$\nR_{\\mathrm{rime}} = N_i \\cdot \\dot{m}_{\\mathrm{rime}} = N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l)\n$$\n\n### 步骤3：计算淞化过程所占的分数\n所求的分数 $f_{\\mathrm{rime}}$ 定义为：\n$$\nf_{\\mathrm{rime}} = \\frac{R_{\\mathrm{rime}}}{R_{\\mathrm{rime}} + R_{\\mathrm{Bergeron}}}\n$$\n代入表达式：\n$$\nf_{\\mathrm{rime}} = \\frac{N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l)}{N_i (E_c \\pi r_i^2 V_i \\rho_{\\mathrm{air}} q_l) + N_i (4 \\pi r_i D_v \\rho_{v,i}^{*} S_i)}\n$$\n约去公因式 $N_i \\pi r_i$，我们得到：\n$$\nf_{\\mathrm{rime}} = \\frac{E_c r_i V_i \\rho_{\\mathrm{air}} q_l}{E_c r_i V_i \\rho_{\\mathrm{air}} q_l + 4 D_v \\rho_{v,i}^{*} S_i}\n$$\n\n### 步骤4：代入数值进行计算\n给定的参数为：\n- $E_c = 0.7$\n- $r_i = 1.0 \\times 10^{-4}\\,\\mathrm{m}$\n- $V_i = 0.5\\,\\mathrm{m\\,s^{-1}}$\n- $\\rho_{\\mathrm{air}} = 1.2\\,\\mathrm{kg\\,m^{-3}}$\n- $q_l = 2.0 \\times 10^{-4}$\n- $D_v = 2.1 \\times 10^{-5}\\,\\mathrm{m^2\\,s^{-1}}$\n- $\\rho_{v,i}^{*} = 2.145 \\times 10^{-3}\\,\\mathrm{kg\\,m^{-3}}$\n- $S_i = 0.01$\n\n我们分别计算分子项和分母中的第二项：\n- 分子（淞化项）：\n  $T_1 = E_c r_i V_i \\rho_{\\mathrm{air}} q_l = (0.7) \\times (1.0 \\times 10^{-4}) \\times (0.5) \\times (1.2) \\times (2.0 \\times 10^{-4}) = 8.4 \\times 10^{-9}$\n- 分母中的第二项（贝吉龙项）：\n  $T_2 = 4 D_v \\rho_{v,i}^{*} S_i = 4 \\times (2.1 \\times 10^{-5}) \\times (2.145 \\times 10^{-3}) \\times (0.01) \\approx 1.8018 \\times 10^{-9}$\n\n代入分数表达式：\n$$\nf_{\\mathrm{rime}} = \\frac{T_1}{T_1 + T_2} = \\frac{8.4 \\times 10^{-9}}{8.4 \\times 10^{-9} + 1.8018 \\times 10^{-9}} = \\frac{8.4}{10.2018} \\approx 0.823385\n$$\n按要求四舍五入到四位有效数字，得到 $0.8234$。",
            "answer": "$$ \\boxed{0.8234} $$"
        },
        {
            "introduction": "为了将复杂的微物理原理整合到天气和气候模式中，我们需要设计和实现稳健的数值算法。“饱和度调整” (saturation adjustment) 是这类算法的核心模块，其功能是在遵守质量和能量守恒定律的前提下，使一个不稳定气块达到热力学平衡。这个富有挑战性的编程实践将引导你从零开始构建一个饱和度调整方案，你将亲手实现处理暖云、冰云和混合相云的不同逻辑，特别是将贝格龙-芬德森过程编码为液态水向冰相的转化，这是数值模式开发者必备的一项关键技能 。",
            "id": "4053803",
            "problem": "设计并实现一个适用于混合相云微物理的饱和度调整算法，该算法需与数值天气预报（NWP）和气候模型一致，守恒总水物质质量，通过潜热更新温度，同时强制所有物质种类为非负值。算法必须考虑水面和冰面的饱和水汽压差异，以表示 Bergeron-Findeisen 过程。输入和输出必须以指定的单位表示，最终结果必须以精确定义的格式返回。\n\n给定一个定压湿空气块，其预报变量为温度 $T$（单位 $\\mathrm{K}$）、气压 $p$（单位 $\\mathrm{Pa}$）、水汽混合比 $q_v$（单位 $\\mathrm{kg}/\\mathrm{kg}$）、云水混合比 $q_c$（单位 $\\mathrm{kg}/\\mathrm{kg}$）和云冰混合比 $q_i$（单位 $\\mathrm{kg}/\\mathrm{kg}$），在以下物理上真实的约束和定义下执行饱和度調整：\n\n- 通过经过充分测试的水和冰的饱和水汽压公式来使用 Clausius-Clapeyron 关系。设液态水上的饱和水汽压为 $e_s^w(T)$，冰上的饱和水汽压为 $e_s^i(T)$。使用以下经验公式（Buck 型，适用于大气范围）：\n  - $$e_s^w(T) = 611.21 \\exp\\left(\\frac{17.502\\,(T - 273.15)}{T - 32.19}\\right) \\quad \\mathrm{Pa},$$\n  - $$e_s^i(T) = 611.21 \\exp\\left(\\frac{22.46\\,(T - 273.15)}{T - 0.55}\\right) \\quad \\mathrm{Pa}.$$\n  这些形式近似于 Clausius-Clapeyron 关系，并广泛用于大气科学中计算水和冰上的饱和水汽压。\n- 通过标准公式将饱和水汽压转换为饱和混合比 $q_v^s$：\n  $$q_v^s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - e_s(T)}, \\quad \\varepsilon = \\frac{R_d}{R_v} = 0.622,$$\n  其中 $R_d$ 和 $R_v$ 分别是干空气和水汽的气体常数。\n- 潜热（在本任务中为保证数值稳定性，视为与温度无关的常数）：蒸发潜热 $L_v = 2.5\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$，熔化潜热 $L_f = 3.34\\times 10^5 \\,\\mathrm{J}/\\mathrm{kg}$，升华潜热 $L_s = L_v + L_f = 2.834\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$。\n- 定压比热：干空气 $c_{p,d} = 1004 \\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$，水汽 $c_{p,v} = 1859 \\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$，液态水 $c_{p,l} = 4181 \\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$，冰 $c_{p,i} = 2106 \\,\\mathrm{J}/(\\mathrm{kg}\\,\\mathrm{K})$。混合物的热容量可以近似为\n  $$c_p = c_{p,d}\\,(1 - q_t) + c_{p,v}\\,q_v + c_{p,l}\\,q_c + c_{p,i}\\,q_i,$$\n  其中 $q_t = q_v + q_c + q_i$ 是总水物质混合比。\n- 守恒要求：\n  - 总水物质混合比 $q_t$ 必须守恒：$$q_v^{\\mathrm{final}} + q_c^{\\mathrm{final}} + q_i^{\\mathrm{final}} = q_t.$$\n  - 温度的更新必须与相变过程中的潜热释放或消耗保持一致，假设是绝热、定压调整。对于一个使 $q_v$ 减少 $\\Delta q$ 并使相应凝结物增加 $\\Delta q$ 的增量 $\\Delta q$，温度变化量为 $\\Delta T = \\alpha \\,\\Delta q$，其中 $\\alpha = L/c_p$，$L$ 是适用于该相变过程的潜热。对于汽-液相变使用 $L_v$，对于汽-冰相变使用 $L_s$。\n  - 所有物质种类必须保持非负：$$q_v^{\\mathrm{final}} \\ge 0, \\quad q_c^{\\mathrm{final}} \\ge 0, \\quad q_i^{\\mathrm{final}} \\ge 0.$$\n- 相态选择和 Bergeron-Findeisen 表示法：\n  - 如果 $T \\ge 273.15\\,\\mathrm{K}$ 或 $q_i = 0$，则相对于液态水进行饱和度调整：仅通过 $q_c$ 的凝结或蒸发，使 $q_v$ 趋向于使用 $e_s^w(T)$ 计算的 $q_v^s(T,p)$。\n  - 如果 $T  273.15\\,\\mathrm{K}$ 且 $q_i > 0$ 且 $q_c = 0$，则相对于冰进行饱和度调整：仅通过 $q_i$ 的凝华或升华，使 $q_v$ 趋向于使用 $e_s^i(T)$ 计算的 $q_v^s(T,p)$。\n  - 如果 $T  273.15\\,\\mathrm{K}$ 且 $q_c > 0$ 和 $q_i > 0$ 都成立，则通过以下方式表示 Bergeron-Findeisen 过程：\n    - 将所有液态水 $q_c$ 蒸发为水汽（消耗 $L_v$ 并降温），然后\n    - 使用 $q_i$ 通过凝华或升华将 $q_v$ 调整至冰饱和（释放或消耗 $L_s$ 并升温或降温）。\n    - 这会产生一个通过气相从液态到冰态的净转移，每单位质量从液态转移到冰态的净潜热加热约等于 $L_f$，并且在低于冰点的混合相平衡中，通常 $q_c^{\\mathrm{final}} = 0$。\n\n数值调整必须解决由潜热引起的 $q_v^s(T,p)$ 和 $T$ 之间的耦合非线性问题。在每个情景中，对增量 $\\Delta q$ 使用稳健的一维求根策略（例如，二分法），并受限于可用凝结物的边界条件，以确保没有任何物质种类变为负值。如果可用的凝结物不足以达到饱和，则执行在不违反非负性前提下允许的最大相变，然后停止。\n\n你的程序必须对以下测试套件应用上述调整。所有输入使用 $T$ 单位为 $\\mathrm{K}$，$p$ 单位为 $\\mathrm{Pa}$，$q$ 单位为 $\\mathrm{kg}/\\mathrm{kg}$。对于每个案例，将最终状态输出为列表 $[T^{\\mathrm{final}}, q_v^{\\mathrm{final}}, q_c^{\\mathrm{final}}, q_i^{\\mathrm{final}}]$：\n\n- 案例 1（暖云，可能凝结）：$T = 285.0$, $p = 80000.0$, $q_v = 0.0120$, $q_c = 0.0010$, $q_i = 0.0000$。\n- 案例 2（冷云，纯冰）：$T = 258.0$, $p = 70000.0$, $q_v = 0.0015$, $q_c = 0.0000$, $q_i = 0.0005$。\n- 案例 3（混合相，Bergeron-Findeisen 过程活跃）：$T = 268.0$, $p = 90000.0$, $q_v = 0.0025$, $q_c = 0.0008$, $q_i = 0.0003$。\n- 案例 4（欠饱和，无可用凝结物）：$T = 270.0$, $p = 85000.0$, $q_v = 0.0005$, $q_c = 0.0000$, $q_i = 0.0000$。\n- 案例 5（接近冰点，少量冰，混合相）：$T = 271.0$, $p = 95000.0$, $q_v = 0.0040$, $q_c = 0.0020$, $q_i = 0.00001$。\n\n最终输出格式：你的程序應生成单行输出，其中包含结果，格式为一个由方括号括起来的逗号分隔列表，其中每个案例的结果本身是一个包含四个相同单位浮点数的逗号分隔列表，例如：$$\\texttt{[[T1,qv1,qc1,qi1],[T2,qv2,qc2,qi2],...]}.$$",
            "solution": "该问题要求为定压 $p$ 下的湿空气块设计并实现一个饱和度调整算法。这是用于数值天气预报（NWP）和气候模拟的大气模型中的一个基础组件。该算法必须将由温度 $T$ 和水汽（$q_v$）、云水（$q_c$）、云冰（$q_i$）混合比定义的初始状态更新至最终平衡状态。此过程必须守恒总水物质质量并符合热力学一致性，考虑相变过程中的潜热释放/吸收。问题的核心在于温度和饱和水汽压之间的非线性耦合，这需要数值求解。\n\n该算法必须根据空气块的温度和成分，将其正确地划分到三种不同的物理情景之一，并应用适当的调整逻辑。一个关键特性是对混合相云中 Bergeron-Findeisen 過程的表示，该过程源于过冷液态水和冰上饱和水汽压的差异。\n\n控制物理原理和方程如下：\n\n1.  **饱和水汽压**：凝结相上的平衡水汽压是温度的强函数。我们使用提供的经验公式，这些是 Clausius-Clapeyron 方程的常用近似。\n    -   在液态水上：$e_s^w(T) = 611.21 \\exp\\left(\\frac{17.502\\,(T - 273.15)}{T - 32.19}\\right)$\n    -   在冰上：$e_s^i(T) = 611.21 \\exp\\left(\\frac{22.46\\,(T - 273.15)}{T - 0.55}\\right)$\n\n2.  **饱和混合比**：饱和水汽压 $e_s$ 使用给定公式转换为饱和混合比 $q_v^s$，其中 $\\varepsilon = R_d/R_v \\approx 0.622$ 是干空气和水汽的气体常数之比。\n    $$q_v^s(T,p) = \\frac{\\varepsilon\\, e_s(T)}{p - e_s(T)}$$\n\n3.  **守恒定律**：该调整是一个定压下的等焓过程，有两个主要守恒量。\n    -   **总水物质质量**：总水物质混合比 $q_t = q_v + q_c + q_i$ 是守恒的。如果一定量的水汽 $\\Delta q$ 发生凝结，最终状态 $(T', q_v', q_c', q_i')$ 与初始状态 $(T, q_v, q_c, q_i)$ 的关系为 $q_v' = q_v - \\Delta q$ 以及 $q_c$ 或 $q_i$ 的相应增加。\n    -   **焓**：温度的变化通过潜热与相变耦合。对于水汽混合比的变化量 $\\Delta q$，温度变化为 $\\Delta T = (L/c_p) \\Delta q$，其中 $L$ 是相应的潜热（$L_v$ 用于凝结/蒸发，$L_s$ 用于凝华/升华），$c_p$ 是湿空气混合物的比热容。热容量使用初始成分近似计算：\n        $$c_p = c_{p,d}\\,(1 - q_t) + c_{p,v}\\,q_v + c_{p,l}\\,q_c + c_{p,i}\\,q_i$$\n        指定的常数为 $L_v = 2.5\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$，$L_s = 2.834\\times 10^6 \\,\\mathrm{J}/\\mathrm{kg}$，以及各种比热。\n\n**数值解策略**\n\n调整的目标是找到一个最终状态 $(T', q_v')$，使得 $q_v'$ 等于新温度下的饱和混合比，即 $q_v' = q_v^s(T', p)$。设 $\\Delta q_{cond}$ 为转化为凝结物的水汽量（因此，对于凝结/凝华，$\\Delta q_{cond} > 0$；对于蒸发/升华，$\\Delta q_{cond}  0$）。最终状态变量为：\n-   $T' = T + \\frac{L}{c_p} \\Delta q_{cond}$\n-   $q_v' = q_v - \\Delta q_{cond}$\n\n将这些代入平衡条件，得到关于 $\\Delta q_{cond}$ 的非线性方程：\n$$f(\\Delta q_{cond}) = (q_v - \\Delta q_{cond}) - q_v^s\\left(T + \\frac{L}{c_p} \\Delta q_{cond}, p\\right) = 0$$\n\n这个单变量方程可以使用像二分法这样的求根算法进行稳健求解。$\\Delta q_{cond}$ 的搜索区间受到物质质量非负性的约束。\n-   对于凝结/凝华（$q_v > q_v^s(T,p)$），质量来源是水汽，所以 $\\Delta q_{cond}$ 的界限是 $[0, q_v]$。\n-   对于蒸发/升华（$q_v  q_v^s(T,p)$），质量来源是可用的凝结物（$q_c$ 或 $q_i$），所以 $\\Delta q_{cond}$ 的界限是 $[-q_{condensate}, 0]$。如果蒸发所有可用的凝结物仍不足以达到饱和，则调整过程仅耗尽凝结物。\n\n**特定情景的算法设计**\n\n算法的核心是基于空气块状态的调度。\n\n1.  **情景 A：液/汽调整**（如果 $T \\ge 273.15\\,\\mathrm{K}$ 或 $q_i = 0$）\n    -   平衡是相对于液态水。我们使用 $e_s^w(T)$ 进行饱和度计算，并使用 $L=L_v$ 作为潜热。\n    -   相变发生在 $q_v$ 和 $q_c$ 之间。我们求解 $\\Delta q_c \\equiv \\Delta q_{cond}$。\n    -   二分法求解器找到使函数 $f(\\Delta q_c) = (q_v - \\Delta q_c) - q_v^s(T + \\frac{L_v}{c_p}\\Delta q_c, p, e_s^w)$ 为零的 $\\Delta q_c$。\n    -   如果过饱和，$\\Delta q_c$ 的搜索范围是 $[0, q_v]$；如果欠饱和，则是 $[-q_c, 0]$。如果 $q_c=0$ 且空气块欠饱和，则不发生变化。\n\n2.  **情景 B：冰/汽调整**（如果 $T  273.15\\,\\mathrm{K}$，$q_c = 0$ 且 $q_i > 0$）\n    -   平衡是相对于冰。我们使用 $e_s^i(T)$ 和 $L=L_s$。\n    -   相变发生在 $q_v$ 和 $q_i$ 之间。我们求解 $\\Delta q_i \\equiv \\Delta q_{cond}$。\n    -   二分法求解器找到使 $f(\\Delta q_i) = (q_v - \\Delta q_i) - q_v^s(T + \\frac{L_s}{c_p}\\Delta q_i, p, e_s^i)$ 为零的 $\\Delta q_i$。\n    -   如果相对于冰过饱和，$\\Delta q_i$ 的搜索范围是 $[0, q_v]$；如果欠饱和，则是 $[-q_i, 0]$。\n\n3.  **情景 C：混合相（Bergeron-Findeisen）调整**（如果 $T  273.15\\,\\mathrm{K}$，$q_c > 0$ 且 $q_i > 0$）\n    这种情景通过一个两步过程来处理，以模拟质量从液态到冰态的转移，其驱动力是在同一冰点以下温度下，$q_v^s(\\text{水}) > q_v^s(\\text{冰})$ 这一事实。\n    -   **步骤 1：蒸发所有液态水。**\n        -   初始液态水 $q_c$ 被完全蒸发。\n        -   由于蒸发潜热，温度更新为：$T_{int} = T - \\frac{L_v}{c_{p,init}} q_c$。\n        -   水汽混合比更新为：$q_{v,int} = q_v + q_c$。\n        -   状态变为 $(T_{int}, q_{v,int}, 0, q_i)$。\n    -   **步骤 2：调整至冰饱和。**\n        -   从中间状态开始，我们现在有一个只含有水汽和冰的空气块。这与情景 B 相同。\n        -   我们根据中间状态计算新的热容量 $c_{p,int}$。\n        -   我们使用 $L_s$ 作为潜热，求解使空气块达到相对于冰饱和所需的冰量变化 $\\Delta q_i$。可用于凝华的总水汽量为 $q_{v,int}$。\n        -   最终状态由中间状态和得到的 $\\Delta q_i$ 计算得出。最终的云水混合比 $q_c'$ 将为 $0$。\n\n这种结构化的、基于物理的方法确保了算法的稳健性，守恒质量和能量，并正确地模拟了关键的微物理过程，包括混合相云中至关重要的 Bergeron-Findeisen 机制。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import bisect\n\ndef solve():\n    \"\"\"\n    Main function to run the saturation adjustment for all test cases.\n    \"\"\"\n    \n    # --- Physical Constants ---\n    L_V = 2.5e6        # Latent heat of vaporization [J/kg]\n    L_F = 3.34e5       # Latent heat of fusion [J/kg]\n    L_S = L_V + L_F    # Latent heat of sublimation [J/kg]\n    CP_D = 1004.0      # Specific heat of dry air [J/kg/K]\n    CP_V = 1859.0      # Specific heat of water vapor [J/kg/K]\n    CP_L = 4181.0      # Specific heat of liquid water [J/kg/K]\n    CP_I = 2106.0      # Specific heat of ice [J/kg/K]\n    EPSILON = 0.622    # Ratio of gas constants Rd/Rv\n    T_FREEZE = 273.15  # Freezing point of water [K]\n\n    # --- Saturation Vapor Pressure Formulations (Buck-type) ---\n    def es_water(T):\n        \"\"\"Saturation vapor pressure over liquid water [Pa]. T in [K].\"\"\"\n        T_c = T - T_FREEZE\n        return 611.21 * np.exp((17.502 * T_c) / (T - 32.19))\n\n    def es_ice(T):\n        \"\"\"Saturation vapor pressure over ice [Pa]. T in [K].\"\"\"\n        T_c = T - T_FREEZE\n        return 611.21 * np.exp((22.46 * T_c) / (T - 0.55))\n\n    # --- Saturation Mixing Ratio ---\n    def qvs(T, p, es_func):\n        \"\"\"Saturation mixing ratio [kg/kg].\"\"\"\n        es = es_func(T)\n        # Prevent division by a non-positive number if es >= p\n        if es >= p:\n            return np.inf\n        return (EPSILON * es) / (p - es)\n\n    # --- Mixture Specific Heat Capacity ---\n    def cp_mixture(qv, qc, qi):\n        \"\"\"Specific heat capacity of the moist air mixture [J/kg/K].\"\"\"\n        qt = qv + qc + qi\n        return CP_D * (1.0 - qt) + CP_V * qv + CP_L * qc + CP_I * qi\n\n    def saturation_adjustment(T_in, p, qv_in, qc_in, qi_in):\n        \"\"\"\n        Performs saturation adjustment on a parcel of air.\n        \n        Returns:\n            A list [T_final, qv_final, qc_final, qi_final].\n        \"\"\"\n        T, qv, qc, qi = float(T_in), float(qv_in), float(qc_in), float(qi_in)\n\n        # --- Regime 1: Liquid/Vapor Adjustment (Warm cloud or no ice) ---\n        if T >= T_FREEZE or (qi == 0 and qc >= 0):\n            cp = cp_mixture(qv, qc, qi)\n            qvs_current = qvs(T, p, es_water)\n\n            if qv > qvs_current:  # Supersaturated -> Condensation\n                bounds = (0, qv)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_V / cp * delta_q, p, es_water)\n            elif qv  qvs_current and qc > 0:  # Subsaturated -> Evaporation\n                bounds = (-qc, 0)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_V / cp * delta_q, p, es_water)\n            else: # Saturated or subsaturated with no liquid water\n                return [T, qv, qc, qi]\n\n            # Check if root is bracketed\n            try:\n                fa, fb = f(bounds[0]), f(bounds[1])\n                if fa * fb > 0: # Root not bracketed, perform max change\n                    delta_q_c = bounds[0] if qv  qvs_current else bounds[1]\n                else:\n                    delta_q_c = bisect(f, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError: # e.g., if es >= p\n                return [T, qv, qc, qi]\n            \n            T_final = T + L_V / cp * delta_q_c\n            qv_final = qv - delta_q_c\n            qc_final = qc + delta_q_c\n            qi_final = qi # Unchanged\n            \n            return [T_final, qv_final, qc_final, qi_final]\n        \n        # --- Regime 2: Ice/Vapor Adjustment (Cold cloud, no liquid) ---\n        elif T  T_FREEZE and qc == 0 and qi > 0:\n            cp = cp_mixture(qv, qc, qi)\n            qvs_current = qvs(T, p, es_ice)\n\n            if qv > qvs_current: # Supersaturated w.r.t ice -> Deposition\n                bounds = (0, qv)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_S / cp * delta_q, p, es_ice)\n            elif qv  qvs_current: # Subsaturated w.r.t ice -> Sublimation\n                bounds = (-qi, 0)\n                def f(delta_q):\n                    return (qv - delta_q) - qvs(T + L_S / cp * delta_q, p, es_ice)\n            else: # Saturated or subsaturated with no ice (should not happen due to qi > 0)\n                return [T, qv, qc, qi]\n\n            try:\n                fa, fb = f(bounds[0]), f(bounds[1])\n                if fa * fb > 0:\n                    delta_q_i = bounds[0] if qv  qvs_current else bounds[1]\n                else:\n                    delta_q_i = bisect(f, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError:\n                return [T, qv, qc, qi]\n\n            T_final = T + L_S / cp * delta_q_i\n            qv_final = qv - delta_q_i\n            qc_final = qc # Unchanged\n            qi_final = qi + delta_q_i\n            \n            return [T_final, qv_final, qc_final, qi_final]\n\n        # --- Regime 3: Mixed-Phase (Bergeron-Findeisen) ---\n        elif T  T_FREEZE and qc > 0 and qi > 0:\n            # Step A: Evaporate all liquid water\n            cp_init = cp_mixture(qv, qc, qi)\n            T_int = T - (L_V / cp_init) * qc\n            qv_int = qv + qc\n            qc_int = 0.0\n            qi_int = qi\n\n            # Step B: Adjust to ice saturation from the intermediate state\n            cp_int_mix = cp_mixture(qv_int, qc_int, qi_int)\n            qvs_int_ice = qvs(T_int, p, es_ice)\n\n            if qv_int > qvs_int_ice: # Expected case: deposition\n                bounds = (0, qv_int)\n                def f_bf(delta_q):\n                    return (qv_int - delta_q) - qvs(T_int + L_S / cp_int_mix * delta_q, p, es_ice)\n            elif qv_int  qvs_int_ice: # Sublimation from remaining ice\n                bounds = (-qi_int, 0)\n                def f_bf(delta_q):\n                    return (qv_int - delta_q) - qvs(T_int + L_S / cp_int_mix * delta_q, p, es_ice)\n            else:\n                return [T_int, qv_int, qc_int, qi_int]\n\n            try:\n                fa, fb = f_bf(bounds[0]), f_bf(bounds[1])\n                if fa * fb > 0:\n                    delta_q_i = bounds[0] if qv_int  qvs_int_ice else bounds[1]\n                else:\n                    delta_q_i = bisect(f_bf, bounds[0], bounds[1], xtol=1e-12)\n            except ValueError:\n                return [T_int, qv_int, qc_int, qi_int]\n\n            T_final = T_int + L_S / cp_int_mix * delta_q_i\n            qv_final = qv_int - delta_q_i\n            qc_final = qc_int # Remains 0\n            qi_final = qi_int + delta_q_i\n            \n            return [T_final, qv_final, qc_final, qi_final]\n        \n        # --- Undefined or stable case (e.g., subsaturated with no condensate) ---\n        else:\n            return [T, qv, qc, qi]\n\n\n    test_cases = [\n        # T (K), p (Pa), qv (kg/kg), qc (kg/kg), qi (kg/kg)\n        (285.0, 80000.0, 0.0120, 0.0010, 0.0000), # Case 1\n        (258.0, 70000.0, 0.0015, 0.0000, 0.0005), # Case 2\n        (268.0, 90000.0, 0.0025, 0.0008, 0.0003), # Case 3\n        (270.0, 85000.0, 0.0005, 0.0000, 0.0000), # Case 4\n        (271.0, 95000.0, 0.0040, 0.0020, 0.00001), # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        final_state = saturation_adjustment(*case)\n        # Ensure non-negativity from floating point errors\n        final_state_non_neg = [max(0.0, x) for x in final_state]\n        results.append(final_state_non_neg)\n\n    # Format the output exactly as required\n    formatted_results = [f\"[{s[0]},{s[1]},{s[2]},{s[3]}]\" for s in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}