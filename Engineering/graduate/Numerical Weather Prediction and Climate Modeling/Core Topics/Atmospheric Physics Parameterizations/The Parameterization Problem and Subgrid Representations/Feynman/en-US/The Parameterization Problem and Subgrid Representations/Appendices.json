{
    "hands_on_practices": [
        {
            "introduction": "Parameterizing subgrid-scale turbulence is a foundational challenge in fluid dynamics modeling. One of the earliest and most intuitive approaches is the eddy-viscosity closure, exemplified by the Smagorinsky model used in Large Eddy Simulation (LES). This exercise provides a direct, quantitative look at this concept by asking you to compute the eddy viscosity for a typical atmospheric scenario . By comparing this value to the molecular viscosity of air, you will gain a crucial physical intuition for why turbulent transport overwhelmingly dominates molecular diffusion and why its parameterization is so critical.",
            "id": "4102407",
            "problem": "In numerical weather prediction and climate modeling, unresolved turbulent motions at scales smaller than the computational grid are represented through subgrid-scale parameterizations. A common approach is an eddy-viscosity closure that scales the subgrid turbulent transport with the resolved strain-rate magnitude. One widely used, well-tested formulation is the Smagorinsky model for Large Eddy Simulation (LES), which prescribes the kinematic eddy viscosity as $\\nu_t = (C_s \\Delta)^2 |S|$, where $C_s$ is a dimensionless model coefficient, $\\Delta$ is the filter width taken to be the grid spacing, and $|S|$ is the magnitude of the resolved strain-rate tensor.\n\nConsider an atmosphere model with horizontal grid spacing $\\Delta = 1\\,\\mathrm{km}$, a Smagorinsky coefficient $C_s = 0.17$, and a resolved shear magnitude $|S| = 10^{-2}\\,\\mathrm{s}^{-1}$. Using the Smagorinsky formulation, compute the kinematic eddy viscosity $\\nu_t$ and express your final result in $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$. Round your answer to four significant figures. Then, based on first principles and physically established scales for molecular transport, briefly comment on whether the computed $\\nu_t$ is plausible relative to the molecular kinematic viscosity of air.",
            "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of computational fluid dynamics and atmospheric science, specifically Large Eddy Simulation (LES) and turbulence modeling. The problem is well-posed, providing all necessary information—the Smagorinsky model equation, the model coefficient, the grid spacing, and the strain-rate magnitude—to compute a unique value for the eddy viscosity. The provided values are physically realistic for mesoscale atmospheric modeling. The dimensional consistency is sound. The problem is objective and free of ambiguity.\n\nThe problem asks for the computation of the kinematic eddy viscosity, $\\nu_t$, using the Smagorinsky model formulation:\n$$\n\\nu_t = (C_s \\Delta)^2 |S|\n$$\nThe provided parameters are:\n- The Smagorinsky coefficient, $C_s = 0.17$ (dimensionless).\n- The filter width, represented by the horizontal grid spacing, $\\Delta = 1\\,\\mathrm{km}$.\n- The magnitude of the resolved strain-rate tensor, $|S| = 10^{-2}\\,\\mathrm{s}^{-1}$.\n\nThe final result for $\\nu_t$ is required in units of $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$. Therefore, the grid spacing $\\Delta$ must first be converted from kilometers to meters.\n$$\n\\Delta = 1\\,\\mathrm{km} = 1000\\,\\mathrm{m}\n$$\nNow, we substitute the given values into the Smagorinsky equation:\n$$\n\\nu_t = (0.17 \\times 1000\\,\\mathrm{m})^2 \\times (10^{-2}\\,\\mathrm{s}^{-1})\n$$\nFirst, calculate the term inside the parenthesis, which represents the mixing length, $l_s = C_s \\Delta$:\n$$\nl_s = 0.17 \\times 1000\\,\\mathrm{m} = 170\\,\\mathrm{m}\n$$\nNext, square this value:\n$$\n(l_s)^2 = (170\\,\\mathrm{m})^2 = 28900\\,\\mathrm{m}^2\n$$\nFinally, multiply by the strain-rate magnitude $|S|$:\n$$\n\\nu_t = 28900\\,\\mathrm{m}^2 \\times 10^{-2}\\,\\mathrm{s}^{-1} = 289\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}\n$$\nThe problem requires the answer to be rounded to four significant figures. The calculated value $289$ has three significant figures. To express this with four significant figures, we write it as $289.0$.\n$$\n\\nu_t = 289.0\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}\n$$\n\nThe second part of the problem asks for a comment on whether this value is plausible relative to the molecular kinematic viscosity of air, $\\nu_{\\text{air}}$. The molecular kinematic viscosity of air at standard temperature and pressure is approximately $\\nu_{\\text{air}} \\approx 1.5 \\times 10^{-5}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$.\n\nTo compare the two, we can examine their ratio:\n$$\n\\frac{\\nu_t}{\\nu_{\\text{air}}} = \\frac{289.0\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}}{1.5 \\times 10^{-5}\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}} \\approx 1.93 \\times 10^7\n$$\nThe computed eddy viscosity, $\\nu_t$, is more than seven orders of magnitude larger than the molecular kinematic viscosity, $\\nu_{\\text{air}}$. This result is not only plausible but physically necessary and expected. The concept of an \"eddy viscosity\" arises because turbulent eddies are far more effective at transporting momentum (and other quantities like heat and moisture) than molecular diffusion. The molecular viscosity, $\\nu_{\\text{air}}$, is an intrinsic fluid property related to momentum transfer via molecular collisions. In contrast, the eddy viscosity, $\\nu_t$, is a property of the flow itself, not the fluid. It parameterizes the net effect of turbulent motions at scales smaller than the model grid can resolve. The fundamental premise of turbulence modeling in geophysical flows is that turbulent transport dominates molecular transport. The large value of $\\nu_t$ confirms that the unresolved turbulent eddies provide the dominant mechanism for momentum diffusion at the subgrid scale, validating the use of the parameterization. A value of $\\nu_t$ on the order of $10^2\\,\\mathrm{m}^2\\,\\mathrm{s}^{-1}$ is a very typical and realistic magnitude for atmospheric turbulence at a grid resolution of $\\Delta = 1\\,\\mathrm{km}$.",
            "answer": "$$\n\\boxed{289.0}\n$$"
        },
        {
            "introduction": "Atmospheric models are coupled to the Earth's surface, which is rarely uniform over the area of a typical grid cell. To account for this subgrid heterogeneity, models often use a \"tiling\" or \"mosaic\" parameterization, where the grid cell is divided into different surface types. This practice walks you through the process of calculating grid-averaged surface fluxes from individual tile fluxes, a fundamental technique in land-surface modeling . Furthermore, by checking the closure of the surface energy budget, you will engage with a critical diagnostic for model fidelity and conservation.",
            "id": "4102396",
            "problem": "A single atmospheric model grid cell in a land–atmosphere coupling scheme uses a subgrid tiling representation to parameterize unresolved heterogeneity. The grid cell is partitioned into $N=5$ land-surface tiles with fractional areas $\\{a_{i}\\}_{i=1}^{5}$ that satisfy $\\sum_{i=1}^{5} a_{i} = 1$. For each tile $i$, the tile-mean sensible heat flux $H_{i}$ and latent heat flux $LE_{i}$ are provided by the land-surface parameterization. The model uses the following sign conventions: upward turbulent fluxes ($H$, $LE$) are positive upward, the ground heat flux $G$ is positive downward, and the net radiation at the surface $R_{n}$ is positive downward. The surface energy balance for the grid-mean surface follows conservation of energy, namely that at the grid scale the net radiation should balance the sum of the turbulent and conductive fluxes (neglecting any explicit storage term), i.e., $R_{n} = H + LE + G$.\n\nUse the following physically plausible data for a midday summertime situation:\n- Tile fractions and tile turbulent fluxes:\n  - Water: $a_{1}=0.12$, $H_{1}=20\\,\\mathrm{W\\,m^{-2}}$, $LE_{1}=350\\,\\mathrm{W\\,m^{-2}}$.\n  - Short grass: $a_{2}=0.35$, $H_{2}=180\\,\\mathrm{W\\,m^{-2}}$, $LE_{2}=220\\,\\mathrm{W\\,m^{-2}}$.\n  - Forest: $a_{3}=0.28$, $H_{3}=120\\,\\mathrm{W\\,m^{-2}}$, $LE_{3}=300\\,\\mathrm{W\\,m^{-2}}$.\n  - Bare soil: $a_{4}=0.15$, $H_{4}=250\\,\\mathrm{W\\,m^{-2}}$, $LE_{4}=80\\,\\mathrm{W\\,m^{-2}}$.\n  - Urban: $a_{5}=0.10$, $H_{5}=300\\,\\mathrm{W\\,m^{-2}}$, $LE_{5}=40\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell radiative flux components at the surface:\n  - Downward shortwave: $S_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$.\n  - Upward shortwave: $S_{\\uparrow} = 200\\,\\mathrm{W\\,m^{-2}}$.\n  - Downward longwave: $L_{\\downarrow} = 380\\,\\mathrm{W\\,m^{-2}}$.\n  - Upward longwave: $L_{\\uparrow} = 570\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell ground heat flux (conductive into the ground): $G = 24.0\\,\\mathrm{W\\,m^{-2}}$.\n\nTasks:\n1. Starting from the definition of a spatial average as an area integral divided by total area and the subgrid tiling representation, compute the grid-cell mean sensible heat flux $H$ and latent heat flux $LE$ by area-weighting over the tiles.\n2. Using the radiative components, compute the net radiation $R_{n}$ at the surface.\n3. Using the conservation relation $R_{n} = H + LE + G$ at the grid scale, compute the residual energy imbalance\n$$\n\\mathcal{E} = R_{n} - \\left( H + LE + G \\right).\n$$\nInterpret the sign of $\\mathcal{E}$ in terms of energy conservation at the surface.\n\nProvide as your final answer only the value of $\\mathcal{E}$. Express the final answer in $\\mathrm{W\\,m^{-2}}$, and round your answer to four significant figures.",
            "solution": "The problem will first be validated against the specified criteria before a solution is attempted.\n\n### Step 1: Extract Givens\nThe data, variables, definitions, and conditions provided in the problem statement are as follows:\n- Number of land-surface tiles: $N=5$.\n- Tile fractional areas: $\\{a_{i}\\}_{i=1}^{5}$, satisfying $\\sum_{i=1}^{5} a_{i} = 1$.\n- Tile-mean sensible heat flux: $H_{i}$.\n- Tile-mean latent heat flux: $LE_{i}$.\n- Sign conventions:\n  - Upward turbulent fluxes ($H$, $LE$) are positive upward.\n  - Ground heat flux $G$ is positive downward.\n  - Net radiation $R_{n}$ is positive downward.\n- Grid-scale surface energy balance equation: $R_{n} = H + LE + G$ (neglecting explicit storage).\n- Tile 1 (Water): $a_{1}=0.12$, $H_{1}=20\\,\\mathrm{W\\,m^{-2}}$, $LE_{1}=350\\,\\mathrm{W\\,m^{-2}}$.\n- Tile 2 (Short grass): $a_{2}=0.35$, $H_{2}=180\\,\\mathrm{W\\,m^{-2}}$, $LE_{2}=220\\,\\mathrm{W\\,m^{-2}}$.\n- Tile 3 (Forest): $a_{3}=0.28$, $H_{3}=120\\,\\mathrm{W\\,m^{-2}}$, $LE_{3}=300\\,\\mathrm{W\\,m^{-2}}$.\n- Tile 4 (Bare soil): $a_{4}=0.15$, $H_{4}=250\\,\\mathrm{W\\,m^{-2}}$, $LE_{4}=80\\,\\mathrm{W\\,m^{-2}}$.\n- Tile 5 (Urban): $a_{5}=0.10$, $H_{5}=300\\,\\mathrm{W\\,m^{-2}}$, $LE_{5}=40\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell downward shortwave radiation: $S_{\\downarrow} = 800\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell upward shortwave radiation: $S_{\\uparrow} = 200\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell downward longwave radiation: $L_{\\downarrow} = 380\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell upward longwave radiation: $L_{\\uparrow} = 570\\,\\mathrm{W\\,m^{-2}}$.\n- Grid-cell ground heat flux: $G = 24.0\\,\\mathrm{W\\,m^{-2}}$.\n- Definition of residual energy imbalance: $\\mathcal{E} = R_{n} - \\left( H + LE + G \\right)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria:\n- **Scientifically Grounded**: The problem describes the subgrid tiling (or mosaic) parameterization scheme and the surface energy balance, which are standard and fundamental concepts in atmospheric science, particularly in land-surface modeling for numerical weather prediction and climate models. All principles and equations are scientifically sound.\n- **Well-Posed**: The problem is well-posed. It provides all necessary data and clear, sequential tasks that lead to a unique solution. The sum of the fractional areas is $a_1+a_2+a_3+a_4+a_5 = 0.12+0.35+0.28+0.15+0.10 = 1.00$, which is consistent with the constraint $\\sum a_i = 1$. The data values are physically plausible for the described scenario.\n- **Objective**: The problem is stated in precise, quantitative, and unbiased language.\n\nThe problem does not exhibit any of the flaws listed:\n1. It is scientifically sound.\n2. It is a formalizable problem directly relevant to the stated topic.\n3. The setup is complete and consistent.\n4. The conditions and data are physically realistic.\n5. The structure ensures a unique solution.\n6. The problem is a standard application of principles, not trivial or tautological.\n7. The result is mathematically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution\nThe problem requires the calculation of the grid-cell energy imbalance, $\\mathcal{E}$, based on a subgrid tiling representation of the land surface. The solution proceeds in three steps as outlined in the problem statement.\n\n**1. Compute the grid-cell mean sensible heat flux ($H$) and latent heat flux ($LE$).**\n\nThe grid-cell mean of a flux is the area-weighted average of the fluxes from the individual subgrid tiles. For a generic flux quantity $X$, the grid-mean value, which we denote as $X$ for simplicity, is given by the summation over the $N$ tiles:\n$$\nX = \\sum_{i=1}^{N} a_{i} X_{i}\n$$\nwhere $a_{i}$ is the fractional area of tile $i$ and $X_{i}$ is the mean flux for that tile.\n\nUsing the provided data for the sensible heat flux $H$:\n$$\nH = \\sum_{i=1}^{5} a_{i} H_{i} = a_{1}H_{1} + a_{2}H_{2} + a_{3}H_{3} + a_{4}H_{4} + a_{5}H_{5}\n$$\nSubstituting the numerical values:\n$$\nH = (0.12)(20) + (0.35)(180) + (0.28)(120) + (0.15)(250) + (0.10)(300)\n$$\n$$\nH = 2.4 + 63.0 + 33.6 + 37.5 + 30.0 = 166.5\\,\\mathrm{W\\,m^{-2}}\n$$\n\nSimilarly, for the latent heat flux $LE$:\n$$\nLE = \\sum_{i=1}^{5} a_{i} LE_{i} = a_{1}LE_{1} + a_{2}LE_{2} + a_{3}LE_{3} + a_{4}LE_{4} + a_{5}LE_{5}\n$$\nSubstituting the numerical values:\n$$\nLE = (0.12)(350) + (0.35)(220) + (0.28)(300) + (0.15)(80) + (0.10)(40)\n$$\n$$\nLE = 42.0 + 77.0 + 84.0 + 12.0 + 4.0 = 219.0\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**2. Compute the net radiation $R_{n}$ at the surface.**\n\nThe net radiation $R_{n}$ is the sum of the net shortwave and net longwave radiation fluxes. The convention is that downward fluxes are positive contributions to the surface energy budget and upward fluxes are negative contributions. Given the problem states $R_n$ is positive downward, we can write:\n$$\nR_{n} = (S_{\\downarrow} - S_{\\uparrow}) + (L_{\\downarrow} - L_{\\uparrow})\n$$\nwhere $S_{\\downarrow}$ and $L_{\\downarrow}$ are the downward shortwave and longwave components, and $S_{\\uparrow}$ and $L_{\\uparrow}$ are the upward components.\nSubstituting the given grid-cell radiative flux components:\n$$\nR_{n} = (800\\,\\mathrm{W\\,m^{-2}} - 200\\,\\mathrm{W\\,m^{-2}}) + (380\\,\\mathrm{W\\,m^{-2}} - 570\\,\\mathrm{W\\,m^{-2}})\n$$\n$$\nR_{n} = 600\\,\\mathrm{W\\,m^{-2}} - 190\\,\\mathrm{W\\,m^{-2}} = 410\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**3. Compute the residual energy imbalance $\\mathcal{E}$ and interpret its sign.**\n\nThe problem defines the residual energy imbalance as $\\mathcal{E} = R_{n} - \\left( H + LE + G \\right)$. The surface energy balance equation, $R_{n} = H + LE + G$, represents the conservation of energy, where $R_{n}$ is the net energy input to the surface from radiation, and $H$, $LE$, and $G$ are the energy outputs from the surface via turbulent transport to the atmosphere and conduction to the ground. The sign conventions given ($R_n$ and $G$ positive downward; $H$ and $LE$ positive upward) are consistent with this physical interpretation. A non-zero $\\mathcal{E}$ indicates that the parameterized fluxes do not perfectly close the energy budget.\n\nUsing the values computed in the previous steps and the given value for $G$:\n$$\nH = 166.5\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nLE = 219.0\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nR_{n} = 410\\,\\mathrm{W\\,m^{-2}}\n$$\n$$\nG = 24.0\\,\\mathrm{W\\,m^{-2}}\n$$\nWe compute the sum of the outgoing fluxes:\n$$\nH + LE + G = 166.5 + 219.0 + 24.0 = 409.5\\,\\mathrm{W\\,m^{-2}}\n$$\nNow, we calculate the residual $\\mathcal{E}$:\n$$\n\\mathcal{E} = R_{n} - (H + LE + G) = 410 - 409.5 = 0.5\\,\\mathrm{W\\,m^{-2}}\n$$\nThe problem requests the answer rounded to four significant figures.\n$$\n\\mathcal{E} = 0.5000\\,\\mathrm{W\\,m^{-2}}\n$$\n\n**Interpretation of the sign:**\nThe residual $\\mathcal{E}$ is positive. This means that the energy input to the surface ($R_{n}$) is greater than the sum of the energy outputs from the surface ($H + LE + G$).\n$$\nR_{n} > H + LE + G\n$$\nThis positive imbalance indicates a net surplus of energy at the surface. In a physical system, this excess energy would contribute to the warming of the surface itself, a process represented by an explicit storage term that was neglected in the provided idealized energy balance equation. The non-zero residual $\\mathcal{E}$ is a common issue in numerical models, often referred to as the \"energy non-closure\" problem.",
            "answer": "$$\n\\boxed{0.5000}\n$$"
        },
        {
            "introduction": "Moist convection, from individual cumulus clouds to large thunderstorm systems, occurs at scales that are unresolved by global climate and weather models, making it one of the most critical processes to parameterize. This practice guides you through building a simple one-dimensional entraining plume model, which forms the conceptual basis for many modern convection schemes . By implementing the numerical integration and saturation adjustment logic, you will gain first-hand experience in the computational mechanics of a physical parameterization, bridging the gap between theoretical equations and a working model.",
            "id": "4102434",
            "problem": "A vertically ascending, entraining moist plume is represented as a bulk updraft whose thermodynamic state evolves with height due to mixing with the environment. Consider an updraft initialized at $z=0$ with temperature $T_0$ (in $\\mathrm{K}$) and total water specific humidity $q_{t0}$ (in $\\mathrm{kg/kg}$). The environment is prescribed by a temperature profile $T_e(z)$ (in $\\mathrm{K}$), a pressure profile $p(z)$ (in $\\mathrm{Pa}$), and an environmental total water specific humidity $q_{te}(z)$ (in $\\mathrm{kg/kg}$). Mixing is parameterized by an entrainment rate per unit height $\\epsilon(z)$ (in $\\mathrm{m^{-1}}$), which follows $\\epsilon(z)=\\epsilon_0 \\exp(-z/H)$, where $\\epsilon_0$ (in $\\mathrm{m^{-1}}$) and $H$ (in $\\mathrm{m}$) are given constants.\n\nThe plume state is described using moist static energy $m(z)$ (in $\\mathrm{J/kg}$) and total water specific humidity $q_t(z)$ (in $\\mathrm{kg/kg}$). Moist static energy is defined by $m(z)=c_p T(z)+g z + L_v q_v(z)$, where $c_p$ is the specific heat of dry air at constant pressure (in $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$), $g$ is gravitational acceleration (in $\\mathrm{m\\,s^{-2}}$), $L_v$ is the latent heat of vaporization (in $\\mathrm{J/kg}$), and $q_v(z)$ is the water vapor specific humidity (in $\\mathrm{kg/kg}$). The plume is assumed to undergo saturation adjustment at each level: if $q_t(z)\\le q_{\\mathrm{sat}}(T(z),p(z))$ then the plume is unsaturated with $q_v(z)=q_t(z)$ and liquid water $q_\\ell(z)=0$; otherwise, the plume is saturated with $q_v(z)=q_{\\mathrm{sat}}(T(z),p(z))$ and $q_\\ell(z)=q_t(z)-q_v(z)$.\n\nUnder the entrainment hypothesis, the bulk evolution equations for the plume are\n$$\n\\frac{d m}{dz}=\\epsilon(z)\\left[m_e(z)-m(z)\\right], \\qquad \\frac{d q_t}{dz}=\\epsilon(z)\\left[q_{te}(z)-q_t(z)\\right],\n$$\nwhere the environmental moist static energy $m_e(z)$ uses $q_{ve}(z)=\\min\\left(q_{te}(z),\\,q_{\\mathrm{sat}}(T_e(z),p(z))\\right)$ in $m_e(z)=c_p T_e(z)+g z + L_v q_{ve}(z)$.\n\nThe pressure profile is approximated by a hypsometric exponential form $p(z)=p_0 \\exp(-z/H_p)$, where $p_0$ is the surface pressure (in $\\mathrm{Pa}$) and $H_p$ is a prescribed pressure scale height (in $\\mathrm{m}$). The environmental temperature profile is $T_e(z)=T_{e0}-\\Gamma z$, where $\\Gamma$ is a constant lapse rate (in $\\mathrm{K\\,m^{-1}}$), and the environmental total water is $q_{te}(z)=\\mathrm{RH}_e \\, q_{\\mathrm{sat}}(T_e(z),p(z))$, where $\\mathrm{RH}_e$ is the environmental relative humidity (a dimensionless fraction in $[0,1]$). The saturation specific humidity $q_{\\mathrm{sat}}(T,p)$ is defined from the saturation vapor pressure $e_s(T)$ by Clausius–Clapeyron:\n$$\ne_s(T)=e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0^{\\mathrm{ref}}}-\\frac{1}{T}\\right)\\right), \\qquad q_{\\mathrm{sat}}(T,p)=\\frac{\\epsilon_{\\mathrm{mv}}\\, e_s(T)}{p-\\left(1-\\epsilon_{\\mathrm{mv}}\\right) e_s(T)},\n$$\nwhere $e_0$ is a reference saturation vapor pressure at $T_0^{\\mathrm{ref}}$ (in $\\mathrm{Pa}$ and $\\mathrm{K}$, respectively), $R_v$ is the gas constant for water vapor (in $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$), and $\\epsilon_{\\mathrm{mv}}=R_d/R_v$ with $R_d$ the gas constant for dry air (in $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$).\n\nInitialization at $z=0$ is as follows. The updraft total water $q_{t0}$ is set by an updraft relative humidity $\\mathrm{RH}_u$ as $q_{t0}=\\min\\left(\\mathrm{RH}_u \\, q_{\\mathrm{sat}}(T_0,p_0),\\, q_{\\mathrm{sat}}(T_0,p_0)\\right)$ (in $\\mathrm{kg/kg}$), and the initial moist static energy is $m(0)=c_p T_0 + L_v q_v(0)$ with $q_v(0)=\\min\\left(q_{t0}, q_{\\mathrm{sat}}(T_0,p_0)\\right)$.\n\nDefine cloud base height $z_b$ (in $\\mathrm{m}$) as the first height at which the plume develops liquid water $q_\\ell(z)>0$. Define cloud top height $z_t$ (in $\\mathrm{m}$) as the first height above $z_b$ at which $q_\\ell(z)$ returns to zero due to entrainment dilution, i.e., $q_t(z)\\le q_{\\mathrm{sat}}(T(z),p(z))$. The cloud depth is $D=z_t-z_b$ (in $\\mathrm{m}$). If the plume never becomes saturated, set $D=0$. If the plume becomes saturated but $q_\\ell(z)>0$ persists up to the domain top $z_{\\max}$, set $D=z_{\\max}-z_b$.\n\nStarting from the fundamental definitions and equations above, derive an algorithm to compute the plume evolution with height using explicit vertical discretization with uniform step $\\Delta z$ (in $\\mathrm{m}$), implementing saturation adjustment at each level by solving for the temperature $T(z)$ consistent with $m(z)=c_p T(z)+g z + L_v q_v(z)$ and the saturation constraint. In the saturated case, this requires solving the scalar nonlinear equation\n$$\nf(T;z)=c_p T + L_v q_{\\mathrm{sat}}(T,p(z)) + g z - m(z)=0\n$$\nfor $T$ at each height. Use a robust bracketing-based root-finding method to solve $f(T;z)=0$ over a physically reasonable temperature interval.\n\nExpress all physical quantities in the specified units above. The final required output is the cloud depth $D$ (in $\\mathrm{m}$) for each test case, rounded to the nearest meter and returned as an integer.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest Suite. Use the following five test cases, each specified by $(\\epsilon_0, H, T_0, \\mathrm{RH}_u, \\mathrm{RH}_e, \\Gamma, z_{\\max})$:\n1. $(1.0\\times 10^{-4} \\ \\mathrm{m}^{-1}, 1500 \\ \\mathrm{m}, 301 \\ \\mathrm{K}, 0.95, 0.70, 6.5\\times 10^{-3} \\ \\mathrm{K\\,m^{-1}}, 5000 \\ \\mathrm{m})$\n2. $(2.0\\times 10^{-5} \\ \\mathrm{m}^{-1}, 2000 \\ \\mathrm{m}, 303 \\ \\mathrm{K}, 0.95, 0.60, 6.0\\times 10^{-3} \\ \\mathrm{K\\,m^{-1}}, 6000 \\ \\mathrm{m})$\n3. $(5.0\\times 10^{-4} \\ \\mathrm{m}^{-1}, 800 \\ \\mathrm{m}, 300.5 \\ \\mathrm{K}, 0.90, 0.70, 6.5\\times 10^{-3} \\ \\mathrm{K\\,m^{-1}}, 3000 \\ \\mathrm{m})$\n4. $(1.0\\times 10^{-4} \\ \\mathrm{m}^{-1}, 1500 \\ \\mathrm{m}, 300 \\ \\mathrm{K}, 0.80, 0.30, 7.0\\times 10^{-3} \\ \\mathrm{K\\,m^{-1}}, 4000 \\ \\mathrm{m})$\n5. $(1.0\\times 10^{-5} \\ \\mathrm{m}^{-1}, 3000 \\ \\mathrm{m}, 302 \\ \\mathrm{K}, 0.98, 0.90, 5.0\\times 10^{-3} \\ \\mathrm{K\\,m^{-1}}, 6000 \\ \\mathrm{m})$\n\nUse a uniform vertical step $\\Delta z=20\\ \\mathrm{m}$, a surface pressure $p_0=101325\\ \\mathrm{Pa}$, and a pressure scale height $H_p=8000\\ \\mathrm{m}$. The constants are $c_p=1004 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $g=9.81 \\ \\mathrm{m\\,s^{-2}}$, $L_v=2.5\\times 10^{6} \\ \\mathrm{J/kg}$, $R_d=287 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $R_v=461 \\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $e_0=611.2\\ \\mathrm{Pa}$, and $T_0^{\\mathrm{ref}}=273.15\\ \\mathrm{K}$ for the Clausius–Clapeyron relation. Angles are not used in this problem. Percentages such as relative humidity must be supplied and interpreted as dimensionless fractions in $[0,1]$.",
            "solution": "The solution involves numerically integrating a set of ordinary differential equations (ODEs) for a one-dimensional entraining plume model. The plume's state is described by its moist static energy, $m(z)$, and total water specific humidity, $q_t(z)$, as a function of height $z$. We use an explicit forward Euler method with a vertical step of $\\Delta z = 20\\ \\mathrm{m}$.\n\nFirst, we define all physical constants and helper functions based on the problem statement.\nThe constants are: $c_p=1004\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $g=9.81\\ \\mathrm{m\\,s^{-2}}$, $L_v=2.5\\times 10^{6}\\ \\mathrm{J/kg}$, $R_d=287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $R_v=461\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$, $e_0=611.2\\ \\mathrm{Pa}$, and $T_0^{\\mathrm{ref}}=273.15\\ \\mathrm{K}$. From these we derive $\\epsilon_{\\mathrm{mv}}=R_d/R_v$.\nThe atmospheric profiles and physical relations are:\nPressure: $p(z)=p_0 \\exp(-z/H_p)$ with $p_0=101325\\ \\mathrm{Pa}$ and $H_p=8000\\ \\mathrm{m}$.\nSaturation vapor pressure: $e_s(T)=e_0 \\exp\\left(\\frac{L_v}{R_v}\\left(\\frac{1}{T_0^{\\mathrm{ref}}}-\\frac{1}{T}\\right)\\right)$.\nSaturation specific humidity: $q_{\\mathrm{sat}}(T,p)=\\frac{\\epsilon_{\\mathrm{mv}}\\, e_s(T)}{p-\\left(1-\\epsilon_{\\mathrm{mv}}\\right) e_s(T)}$.\nEntrainment rate: $\\epsilon(z)=\\epsilon_0 \\exp(-z/H)$.\nEnvironmental temperature: $T_e(z)=T_0-\\Gamma z$. It is assumed that the environmental temperature at the surface, $T_{e0}$, is equal to the initial plume temperature $T_0$.\nEnvironmental total water: $q_{te}(z)=\\mathrm{RH}_e \\, q_{\\mathrm{sat}}(T_e(z),p(z))$.\nEnvironmental moist static energy: $m_e(z)=c_p T_e(z)+g z + L_v q_{te}(z)$, since for $\\mathrm{RH}_e \\le 1$, the environmental water vapor $q_{ve}(z)$ is equal to $q_{te}(z)$.\n\nThe algorithm proceeds as follows for each test case:\n\n1.  **Initialization at $z=0$**:\n    The plume starts at $z=0$ with temperature $T_0$ and surface pressure $p_0=p(0)$.\n    The saturation specific humidity at the surface is calculated: $q_{\\mathrm{sat},0} = q_{\\mathrm{sat}}(T_0, p_0)$.\n    The initial total water specific humidity is set by the updraft relative humidity $\\mathrm{RH}_u$: $q_t(0) = \\mathrm{RH}_u \\cdot q_{\\mathrm{sat},0}$. The initial liquid water content $q_\\ell(0)=0$ and the water vapor specific humidity is $q_v(0) = q_t(0)$.\n    The initial moist static energy is $m(0) = c_p T_0 + L_v q_v(0)$. The $gz$ term is zero.\n\n2.  **Vertical Integration and Saturation Adjustment**:\n    We iterate from $z=0$ to $z_{\\max}$ in steps of $\\Delta z$. Let the state at height $z_{i-1}$ be $(m_{i-1}, q_{t,i-1})$. The state at the next level, $z_i=z_{i-1}+\\Delta z$, is found in two stages.\n\n    a. **Explicit Integration**: We first update the conserved variables $m$ and $q_t$ using the forward Euler method on the governing ODEs:\n    $$m_i = m_{i-1} + \\Delta z \\cdot \\epsilon(z_{i-1})\\left[m_e(z_{i-1}) - m_{i-1}\\right]$$\n    $$q_{t,i} = q_{t,i-1} + \\Delta z \\cdot \\epsilon(z_{i-1})\\left[q_{te}(z_{i-1}) - q_{t,i-1}\\right]$$\n    where the environmental properties and entrainment rate are evaluated at the previous height $z_{i-1}$.\n\n    b. **Saturation Adjustment**: With the new values $m_i$ and $q_{t,i}$ at height $z_i$, we diagnose the plume's thermodynamic state ($T_i, q_{v,i}, q_{\\ell,i}$).\n    First, we test if the plume is unsaturated. If it were, all total water would be vapor ($q_{v,i} = q_{t,i}$), and the temperature $T_i^{\\text{unsat}}$ would be given by the definition of moist static energy: $T_i^{\\text{unsat}} = (m_i - g z_i - L_v q_{t,i}) / c_p$.\n    We then check the consistency of this assumption by calculating the saturation specific humidity at this hypothetical temperature, $q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$.\n    - If $q_{t,i} \\le q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$, the unsaturated assumption is correct. The state is $T_i = T_i^{\\text{unsat}}$, $q_{v,i} = q_{t,i}$, and $q_{\\ell,i} = 0$.\n    - If $q_{t,i} > q_{\\mathrm{sat}}(T_i^{\\text{unsat}}, p_i)$, the parcel is supersaturated at $T_i^{\\text{unsat}}$ and must condense water to reach equilibrium. It is therefore saturated. We must find the new equilibrium temperature $T_i$ by solving the nonlinear scalar equation that equates the two expressions for MSE:\n    $$f(T_i; z_i) = c_p T_i + L_v q_{\\mathrm{sat}}(T_i, p_i) + g z_i - m_i = 0$$\n    This equation is solved numerically for $T_i$ using a robust root-finding algorithm (Brent's method) within a physically plausible temperature range (e.g., $[150\\ \\mathrm{K}, 350\\ \\mathrm{K}]$).\n    Once the saturated temperature $T_i$ is found, the water vapor is given by the saturation value, $q_{v,i} = q_{\\mathrm{sat}}(T_i, p_i)$, and the liquid water content is the remainder, $q_{\\ell,i} = q_{t,i} - q_{v,i}$.\n\n3.  **Cloud Boundary Detection**:\n    During the vertical integration, we monitor the liquid water content $q_\\ell(z)$.\n    - The **cloud base** $z_b$ is defined as the first height $z_i > 0$ at which $q_{\\ell,i}$ becomes positive (greater than a small numerical tolerance).\n    - The **cloud top** $z_t$ is defined as the first height $z_i > z_b$ at which $q_{\\ell,i}$ returns to zero.\n\n4.  **Cloud Depth Calculation**:\n    After the integration over the full vertical domain is complete, the cloud depth $D$ is calculated as follows:\n    - If no cloud base was found ($q_\\ell(z)$ was always zero), then $D=0$.\n    - If a cloud base $z_b$ was found but a cloud top $z_t$ was not found before reaching $z_{\\max}$ (i.e., $q_\\ell(z_{\\max}) > 0$), then $D=z_{\\max}-z_b$.\n    - If both a cloud base $z_b$ and a cloud top $z_t$ were found, then $D=z_t-z_b$.\n    The final value of $D$ is rounded to the nearest integer. This process is repeated for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves for the cloud depth of a moist entraining plume for several test cases.\n    \"\"\"\n\n    # --- Physical Constants ---\n    CP = 1004.0      # J/(kg K), specific heat of dry air at constant pressure\n    G = 9.81         # m/s^2, gravitational acceleration\n    LV = 2.5e6       # J/kg, latent heat of vaporization\n    RD = 287.0       # J/(kg K), gas constant for dry air\n    RV = 461.0       # J/(kg K), gas constant for water vapor\n    EPS_MV = RD / RV # Ratio of gas constants\n    E0 = 611.2       # Pa, reference saturation vapor pressure\n    T0_REF = 273.15  # K, reference temperature for Clausius-Clapeyron\n\n    # --- Model Parameters ---\n    P0 = 101325.0    # Pa, surface pressure\n    HP = 8000.0      # m, pressure scale height\n    DZ = 20.0        # m, vertical step size\n\n    # --- Test Cases ---\n    # (epsilon_0 [m-1], H [m], T_0 [K], RH_u, RH_e, Gamma [K/m], z_max [m])\n    test_cases = [\n        (1.0e-4, 1500, 301, 0.95, 0.70, 6.5e-3, 5000),\n        (2.0e-5, 2000, 303, 0.95, 0.60, 6.0e-3, 6000),\n        (5.0e-4, 800, 300.5, 0.90, 0.70, 6.5e-3, 3000),\n        (1.0e-4, 1500, 300, 0.80, 0.30, 7.0e-3, 4000),\n        (1.0e-5, 3000, 302, 0.98, 0.90, 5.0e-3, 6000),\n    ]\n\n    # --- Helper Functions ---\n    def pressure(z):\n        return P0 * np.exp(-z / HP)\n\n    def saturation_vapor_pressure(T):\n        return E0 * np.exp((LV / RV) * (1 / T0_REF - 1 / T))\n\n    def saturation_specific_humidity(T, p):\n        es = saturation_vapor_pressure(T)\n        denom = p - (1 - EPS_MV) * es\n        if denom <= 0:\n            return np.inf\n        return (EPS_MV * es) / denom\n\n    def entrainment_rate(z, epsilon_0, H):\n        return epsilon_0 * np.exp(-z / H)\n\n    def environmental_temperature(z, T0_env, Gamma):\n        return T0_env - Gamma * z\n\n    def environmental_total_water(z, T0_env, Gamma, RH_e):\n        Te_z = environmental_temperature(z, T0_env, Gamma)\n        p_z = pressure(z)\n        q_sat_e = saturation_specific_humidity(Te_z, p_z)\n        return RH_e * q_sat_e\n\n    def environmental_mse(z, T0_env, Gamma, RH_e):\n        Te_z = environmental_temperature(z, T0_env, Gamma)\n        qte_z = environmental_total_water(z, T0_env, Gamma, RH_e)\n        return CP * Te_z + G * z + LV * qte_z\n\n    def sat_adj_func(T, z, p_z, m_z):\n        q_sat = saturation_specific_humidity(T, p_z)\n        return CP * T + LV * q_sat + G * z - m_z\n\n    def solve_plume_evolution(params):\n        epsilon_0, H, T0, RH_u, RH_e, Gamma, z_max = params\n        \n        z_levels = np.arange(0, z_max + DZ, DZ)\n        num_levels = len(z_levels)\n        \n        m = np.zeros(num_levels)\n        qt = np.zeros(num_levels)\n        ql = np.zeros(num_levels)\n        \n        # Initialization at z = 0\n        z0 = 0.0\n        p0_val = pressure(z0)\n        q_sat_0 = saturation_specific_humidity(T0, p0_val)\n        qt[0] = RH_u * q_sat_0\n        qv0 = qt[0]\n        ql[0] = 0.0\n        m[0] = CP * T0 + LV * qv0\n        \n        z_b, z_t = 0.0, 0.0\n        cloud_base_found = False\n        ql_threshold = 1e-12\n\n        for i in range(1, num_levels):\n            z_prev, z_curr = z_levels[i-1], z_levels[i]\n            \n            # Use T0 as environmental surface temperature\n            me_prev = environmental_mse(z_prev, T0, Gamma, RH_e)\n            qte_prev = environmental_total_water(z_prev, T0, Gamma, RH_e)\n            eps_prev = entrainment_rate(z_prev, epsilon_0, H)\n            \n            # Forward Euler step\n            m[i] = m[i-1] + DZ * eps_prev * (me_prev - m[i-1])\n            qt[i] = qt[i-1] + DZ * eps_prev * (qte_prev - qt[i-1])\n            \n            p_curr = pressure(z_curr)\n            \n            # Assume unsaturated\n            T_unsat = (m[i] - G * z_curr - LV * qt[i]) / CP\n            q_sat_at_T_unsat = saturation_specific_humidity(T_unsat, p_curr)\n            \n            if qt[i] <= q_sat_at_T_unsat:\n                ql[i] = 0.0\n            else: # Saturated\n                T_low, T_high = 150.0, 350.0\n                try:\n                    T_sat = optimize.brentq(sat_adj_func, T_low, T_high, args=(z_curr, p_curr, m[i]))\n                    qv_sat = saturation_specific_humidity(T_sat, p_curr)\n                    ql[i] = max(0, qt[i] - qv_sat)\n                except ValueError:\n                    ql[i] = 0.0\n\n            if not cloud_base_found and ql[i] > ql_threshold:\n                z_b = z_curr\n                cloud_base_found = True\n            \n            if cloud_base_found and ql[i] <= ql_threshold and z_t == 0.0:\n                z_t = z_curr\n        \n        if not cloud_base_found:\n            D = 0.0\n        elif z_t == 0.0:\n            D = z_max - z_b\n        else:\n            D = z_t - z_b\n            \n        return int(round(D))\n\n    results = []\n    for params in test_cases:\n        depth = solve_plume_evolution(params)\n        results.append(depth)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}