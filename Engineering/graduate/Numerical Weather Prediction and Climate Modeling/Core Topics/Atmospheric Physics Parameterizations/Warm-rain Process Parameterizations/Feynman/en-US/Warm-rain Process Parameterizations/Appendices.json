{
    "hands_on_practices": [
        {
            "introduction": "This exercise serves as a foundational entry point into the mechanics of warm-rain parameterization. By applying the classic Kessler scheme, you will compute the instantaneous rates of rain formation through autoconversion and accretion, as well as rain loss through evaporation. This practice is crucial for understanding not only the mass budget of cloud and rain water but also the direct thermodynamic consequences of these phase changes, linking microphysics to the larger-scale energy budget of the atmosphere. ",
            "id": "3906208",
            "problem": "A single grid cell of a warm-cloud microphysics module uses a Kessler-type warm rain parameterization to represent phase changes of water. The prognostic variables are the cloud liquid water mixing ratio $q_{c}$, the rainwater mixing ratio $q_{r}$, and the water vapor mixing ratio $q_{v}$, all in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}$. Autoconversion of cloud liquid to rain and accretion of cloud liquid by falling rain are modeled as source tendencies for $q_{r}$ (and equal sinks for $q_{c}$) using well-tested Kessler forms:\n- Autoconversion: $P_{\\mathrm{auto}} = c_{\\mathrm{auto}} \\,\\max\\!\\left(q_{c} - q_{c,0},\\, 0\\right)$,\n- Accretion: $P_{\\mathrm{accr}} = c_{\\mathrm{accr}} \\, q_{c} \\, q_{r}$,\nwhere $c_{\\mathrm{auto}}$ and $c_{\\mathrm{accr}}$ are rate coefficients in $\\mathrm{s}^{-1}$, and $q_{c,0}$ is the autoconversion threshold.\n\nEvaporation of rain increases $q_{v}$ and decreases $q_{r}$ at the rate\n$$E = c_{\\mathrm{evap}} \\left(1 - \\mathcal{H}\\right) q_{r},$$\nwhere $c_{\\mathrm{evap}}$ is a rate coefficient in $\\mathrm{s}^{-1}$ and $\\mathcal{H}$ is the Relative Humidity (RH) expressed as a fraction. Assume no simultaneous condensation into cloud liquid, and neglect sedimentation and turbulent transport over the instant considered.\n\nStarting from conservation of water substance and the first law of thermodynamics for a moist parcel, the specific temperature tendency due to latent heating from phase change between vapor and liquid is\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(\\dot{q}_{\\mathrm{cond}} - \\dot{q}_{\\mathrm{evap}}\\right),$$\nwhere $L_{v}$ is the latent heat of vaporization and $c_{p}$ is the specific heat capacity of air at constant pressure. Under the stated assumptions, $\\dot{q}_{\\mathrm{cond}} = 0$ and $\\dot{q}_{\\mathrm{evap}} = E$.\n\nGiven the following instantaneous state and parameters:\n- $q_{c} = 1.8 \\times 10^{-3}$,\n- $q_{r} = 4.0 \\times 10^{-4}$,\n- $q_{c,0} = 1.0 \\times 10^{-3}$,\n- $\\mathcal{H} = 0.85$,\n- $c_{\\mathrm{auto}} = 1.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}$,\n- $c_{\\mathrm{accr}} = 2.2 \\times 10^{-3} \\, \\mathrm{s}^{-1}$,\n- $c_{\\mathrm{evap}} = 4.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}$,\n- $L_{v} = 2.5 \\times 10^{6} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}$,\n- $c_{p} = 1.004 \\times 10^{3} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$,\n\nperform the following:\n1. Compute $P_{\\mathrm{auto}}$ and $P_{\\mathrm{accr}}$ as instantaneous source tendencies for $q_{r}$ in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$.\n2. Compute $E$ in $\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$.\n3. Using the thermodynamic relation above, quantify the instantaneous grid-mean latent heating (temperature tendency) $\\left(\\mathrm{d}T/\\mathrm{d}t\\right)_{\\mathrm{lat}}$ arising from rain formation (autoconversion and accretion) and rain evaporation. State clearly how each process contributes, and report the net value.\n\nExpress the final answer as a single number in $\\mathrm{K}\\,\\mathrm{s}^{-1}$, rounded to four significant figures.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded in the principles of cloud microphysics and thermodynamics as commonly parameterized in atmospheric models. It is well-posed, with all necessary data and equations provided for a unique solution. The language is objective and the data are physically consistent.\n\nThe problem requires the calculation of instantaneous rates of microphysical processes in a single grid cell and the consequent latent heating rate. The steps are as follows:\n\n1.  Compute the rate of autoconversion of cloud liquid to rain, $P_{\\mathrm{auto}}$.\n2.  Compute the rate of accretion of cloud liquid by rain, $P_{\\mathrm{accr}}$.\n3.  Compute the rate of evaporation of rain, $E$.\n4.  Compute the net latent heating rate, $(\\mathrm{d}T/\\mathrm{d}t)_{\\mathrm{lat}}$, by accounting for the thermodynamic effects of these phase changes.\n\nThe given parameters are:\n-   Cloud liquid water mixing ratio: $q_{c} = 1.8 \\times 10^{-3}$\n-   Rainwater mixing ratio: $q_{r} = 4.0 \\times 10^{-4}$\n-   Autoconversion threshold: $q_{c,0} = 1.0 \\times 10^{-3}$\n-   Relative Humidity: $\\mathcal{H} = 0.85$\n-   Autoconversion rate coefficient: $c_{\\mathrm{auto}} = 1.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}$\n-   Accretion rate coefficient: $c_{\\mathrm{accr}} = 2.2 \\times 10^{-3} \\, \\mathrm{s}^{-1}$\n-   Evaporation rate coefficient: $c_{\\mathrm{evap}} = 4.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}$\n-   Latent heat of vaporization: $L_{v} = 2.5 \\times 10^{6} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}$\n-   Specific heat capacity of air: $c_{p} = 1.004 \\times 10^{3} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$\n\nFirst, we compute the autoconversion rate, $P_{\\mathrm{auto}}$. The formula is:\n$$P_{\\mathrm{auto}} = c_{\\mathrm{auto}} \\,\\max\\!\\left(q_{c} - q_{c,0},\\, 0\\right)$$\nSubstituting the given values:\n$$q_{c} - q_{c,0} = (1.8 \\times 10^{-3}) - (1.0 \\times 10^{-3}) = 0.8 \\times 10^{-3}$$\nSince this value is positive, the maximum is $0.8 \\times 10^{-3}$.\n$$P_{\\mathrm{auto}} = (1.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}) \\times (0.8 \\times 10^{-3}) = 8.0 \\times 10^{-7} \\, \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\nSecond, we compute the accretion rate, $P_{\\mathrm{accr}}$. The formula is:\n$$P_{\\mathrm{accr}} = c_{\\mathrm{accr}} \\, q_{c} \\, q_{r}$$\nSubstituting the given values:\n$$P_{\\mathrm{accr}} = (2.2 \\times 10^{-3} \\, \\mathrm{s}^{-1}) \\times (1.8 \\times 10^{-3}) \\times (4.0 \\times 10^{-4})$$\n$$P_{\\mathrm{accr}} = (2.2 \\times 1.8 \\times 4.0) \\times 10^{(-3-3-4)} = 15.84 \\times 10^{-10} = 1.584 \\times 10^{-9} \\, \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\nThird, we compute the evaporation rate of rain, $E$. The formula is:\n$$E = c_{\\mathrm{evap}} \\left(1 - \\mathcal{H}\\right) q_{r}$$\nSubstituting the given values:\n$$E = (4.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}) \\times (1 - 0.85) \\times (4.0 \\times 10^{-4})$$\n$$E = (4.0 \\times 10^{-3} \\, \\mathrm{s}^{-1}) \\times (0.15) \\times (4.0 \\times 10^{-4})$$\n$$E = (4.0 \\times 0.15 \\times 4.0) \\times 10^{(-3-4)} = 2.4 \\times 10^{-7} \\, \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1}$$\n\nFinally, we compute the instantaneous temperature tendency due to latent heating, $(\\mathrm{d}T/\\mathrm{d}t)_{\\mathrm{lat}}$. The governing equation is:\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(\\dot{q}_{\\mathrm{cond}} - \\dot{q}_{\\mathrm{evap}}\\right)$$\nThis equation relates the temperature change to the net mass transfer rate between the vapor and liquid phases.\n-   $\\dot{q}_{\\mathrm{cond}}$ is the rate of condensation (vapor to liquid), which releases latent heat and causes warming.\n-   $\\dot{q}_{\\mathrm{evap}}$ is the rate of evaporation (liquid to vapor), which consumes latent heat and causes cooling.\n\nWe must assess how each microphysical process contributes to these terms.\n-   Autoconversion ($P_{\\mathrm{auto}}$) and accretion ($P_{\\mathrm{accr}}$) represent the conversion of cloud water (liquid) to rainwater (liquid). Since there is no change of phase between vapor and liquid, these processes do not contribute to latent heating. Thus, they have no effect on $\\dot{q}_{\\mathrm{cond}}$ or $\\dot{q}_{\\mathrm{evap}}$.\n-   Evaporation of rain ($E$) represents the phase change from liquid (rain) to vapor. This process directly corresponds to the evaporation term, so $\\dot{q}_{\\mathrm{evap}} = E$.\n-   The problem states to assume no simultaneous condensation into cloud liquid, which means $\\dot{q}_{\\mathrm{cond}} = 0$.\n\nTherefore, the equation for the temperature tendency simplifies to:\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = \\frac{L_{v}}{c_{p}}\\left(0 - E\\right) = -\\frac{L_{v}}{c_{p}} E$$\nThe negative sign indicates that evaporation leads to a decrease in temperature (latent cooling).\n\nSubstituting the values for $L_{v}$, $c_{p}$, and our calculated value for $E$:\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = -\\frac{2.5 \\times 10^{6} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}}{1.004 \\times 10^{3} \\, \\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}} \\times (2.4 \\times 10^{-7} \\, \\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-1})$$\nFirst, calculate the ratio of the physical constants:\n$$\\frac{L_{v}}{c_{p}} = \\frac{2.5 \\times 10^{6}}{1.004 \\times 10^{3}} \\approx 2490.04 \\, \\mathrm{K}$$\nNow, multiply by $-E$:\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} \\approx -(2490.04 \\, \\mathrm{K}) \\times (2.4 \\times 10^{-7} \\, \\mathrm{s}^{-1})$$\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} \\approx -597.609... \\times 10^{-6} \\, \\mathrm{K}\\,\\mathrm{s}^{-1} = -5.97609... \\times 10^{-4} \\, \\mathrm{K}\\,\\mathrm{s}^{-1}$$\nThe problem asks for the answer rounded to four significant figures.\n$$\\left(\\frac{\\mathrm{d}T}{\\mathrm{d}t}\\right)_{\\mathrm{lat}} = -5.976 \\times 10^{-4} \\, \\mathrm{K}\\,\\mathrm{s}^{-1}$$\nThis net result is a cooling tendency, caused entirely by the evaporation of rain under the specified subsaturated conditions. The processes of rain formation (autoconversion and accretion) do not contribute to latent heating in this formulation.",
            "answer": "$$\\boxed{-5.976 \\times 10^{-4}}$$"
        },
        {
            "introduction": "Building on the concept of process rates, this problem explores the implementation logic within a more sophisticated double-moment microphysics scheme. You will derive the source terms for both mass mixing ratio ($q_x$) and number concentration ($N_x$) for cloud and rain, based on fundamental conservation laws and assumptions about the drop size distribution. This practice is essential for understanding how parameterizations maintain physical consistency and manage the evolution of the full particle distribution, a core challenge in modern atmospheric modeling. ",
            "id": "4111348",
            "problem": "Consider a warm-rain double-moment microphysics parameterization embedded in a numerical weather prediction framework. Two hydrometeor categories are predicted: cloud droplets and rain drops. Let the prognosed moments be the mass mixing ratios $q_{c}$ and $q_{r}$ (mass of liquid water per unit mass of moist air), and the number concentrations $N_{c}$ and $N_{r}$ (number of particles per unit mass of moist air). Each category is represented by a Drop Size Distribution (DSD) in particle mass $m$ with a gamma shape constrained by a prescribed shape parameter: for cloud droplets,\n$$\nn_{c}(m) \\;=\\; \\frac{N_{c}}{\\Gamma(k_{c})\\, m_{*c}^{k_{c}}}\\, m^{k_{c}-1}\\, \\exp\\!\\left(-\\frac{m}{m_{*c}}\\right),\n$$\nand for rain drops,\n$$\nn_{r}(m) \\;=\\; \\frac{N_{r}}{\\Gamma(k_{r})\\, m_{*r}^{k_{r}}}\\, m^{k_{r}-1}\\, \\exp\\!\\left(-\\frac{m}{m_{*r}}\\right),\n$$\nwhere $k_{c}>0$ and $k_{r}>0$ are the prescribed (fixed) shape parameters, $\\Gamma(\\cdot)$ is the gamma function, and $m_{*c}$ and $m_{*r}$ are scale parameters. The $0$th and $1$st moments of $n_{c}(m)$ and $n_{r}(m)$ give $N_{x}$ and $q_{x}$ for $x\\in\\{c,r\\}$, implying the mean particle masses\n$$\n\\bar{m}_{c} \\;=\\; \\frac{q_{c}}{N_{c}} \\;=\\; k_{c}\\, m_{*c}, \\qquad\n\\bar{m}_{r} \\;=\\; \\frac{q_{r}}{N_{r}} \\;=\\; k_{r}\\, m_{*r}.\n$$\n\nCloud-to-rain conversion occurs via two processes:\n- Autoconversion, arising from binary cloud–cloud collisions that form drops exceeding a rain threshold mass $m_{t}$.\n- Accretion, arising from rain–cloud collisions that transfer cloud water mass to rain.\n\nLet the autoconversion mass transfer rate from cloud to rain be denoted by $A(q_{c},N_{c})$ and the accretion mass transfer rate by $C(q_{c},q_{r},N_{r})$. These rates can be formally derived from the Kinetic Collection Equation (KCE) by integrating appropriate collision kernels over $n_{c}(m)$ and $n_{r}(m)$; their explicit forms are not required here, but they satisfy $A\\ge 0$ and $C\\ge 0$ and have dimensions of $q$ per unit time.\n\nStarting from conservation of liquid water mass and the gamma-DSD moment structure, derive analytic expressions for the source terms (tendencies) due to autoconversion and accretion for the vector of prognosed moments $(q_{c},N_{c},q_{r},N_{r})$, under the following physically consistent constraints:\n1. Liquid water mass is conserved between categories: autoconversion and accretion remove mass from cloud and add it to rain.\n2. The prescribed shape parameters $k_{c}$ and $k_{r}$ remain constant in time. This constraint requires that the implied changes in $(q_{x},N_{x})$ for each category are consistent with the gamma-DSD moment relations, i.e., changes reflect spectrally uniform removal or injection in the sense of the current DSD.\n3. Autoconversion reduces cloud number in proportion to the removed cloud mass relative to $\\bar{m}_{c}$, and injects rain number in proportion to the added rain mass relative to $\\bar{m}_{r}$. Accretion reduces cloud number in proportion to removed cloud mass relative to $\\bar{m}_{c}$, and increases rain mass without changing rain number (i.e., accretion grows existing rain drops without creating new ones).\n\nExpress your final answer as a single closed-form symbolic row vector of the four source terms $(S_{q_{c}},S_{N_{c}},S_{q_{r}},S_{N_{r}})$ in terms of $A$, $C$, $q_{c}$, $N_{c}$, $q_{r}$, and $N_{r}$. No numerical evaluation is required. Do not include units in your final boxed expression.",
            "solution": "The user wants to find the source terms for the prognostic variables in a warm-rain microphysics parameterization.\n\nThe problem is **valid** because it is scientifically grounded in established principles of cloud microphysics, well-posed with a clear objective and sufficient constraints, and stated objectively using standard terminology. The derivation is a straightforward application of the provided rules.\n\nThe vector of prognosed moments is $(q_{c},N_{c},q_{r},N_{r})$. We are tasked with finding the vector of source terms, or tendencies, due to the microphysical processes of autoconversion and accretion. Let this vector be $(S_{q_{c}}, S_{N_{c}}, S_{q_{r}}, S_{N_{r}})$, where each term represents the time rate of change of the corresponding variable. The total source term for each variable is the sum of the contributions from autoconversion (rate $A$) and accretion (rate $C$). We will analyze each process based on the given constraints.\n\nFirst, let's address the mass mixing ratio tendencies, $S_{q_{c}}$ and $S_{q_{r}}$. Constraint 1 states that liquid water mass is conserved and that autoconversion and accretion transfer mass from the cloud category to the rain category.\nThe rate of mass transfer from cloud to rain due to autoconversion is given as $A$.\nThe rate of mass transfer from cloud to rain due to accretion is given as $C$.\nTherefore, the total rate of mass loss from the cloud category is the sum of these two rates.\n$$\nS_{q_{c}} = -A - C = -(A+C)\n$$\nBy mass conservation, this same amount of mass must be gained by the rain category.\n$$\nS_{q_{r}} = A + C\n$$\nA quick check confirms mass conservation: $S_{q_{c}} + S_{q_{r}} = -(A+C) + (A+C) = 0$.\n\nNext, we address the number concentration tendencies, $S_{N_{c}}$ and $S_{N_{r}}$. These are determined by Constraint 3, which specifies how the number of particles changes for each process. We consider each process separately.\n\nFor autoconversion:\n- Constraint 3 states: \"Autoconversion reduces cloud number in proportion to the removed cloud mass relative to $\\bar{m}_{c}$\". The mass of cloud water removed by autoconversion is $A$. The mean mass of a cloud droplet is $\\bar{m}_{c} = q_{c}/N_{c}$. Therefore, the rate of change of cloud number concentration due to autoconversion is:\n$$\nS_{N_{c}}^{\\text{auto}} = -\\frac{A}{\\bar{m}_{c}} = -\\frac{A}{q_{c}/N_{c}} = -A\\frac{N_{c}}{q_{c}}\n$$\n- Constraint 3 also states: Autoconversion \"injects rain number in proportion to the added rain mass relative to $\\bar{m}_{r}$\". The mass added to the rain category is $A$. The mean mass of a raindrop is $\\bar{m}_{r} = q_{r}/N_{r}$. Thus, the rate of creation of new raindrops due to autoconversion is:\n$$\nS_{N_{r}}^{\\text{auto}} = +\\frac{A}{\\bar{m}_{r}} = +\\frac{A}{q_{r}/N_{r}} = +A\\frac{N_{r}}{q_{r}}\n$$\nThis modeling choice implies that autoconversion adds new raindrops that have the same average mass as the pre-existing rain population, which ensures the mean mass $\\bar{m}_{r}$ is unchanged by autoconversion alone.\n\nFor accretion:\n- Constraint 3 states: \"Accretion reduces cloud number in proportion to removed cloud mass relative to $\\bar{m}_{c}$\". The mass of cloud water removed by accretion is $C$. This is analogous to the effect of autoconversion on cloud number. The rate of change of cloud number concentration due to accretion is:\n$$\nS_{N_{c}}^{\\text{accr}} = -\\frac{C}{\\bar{m}_{c}} = -\\frac{C}{q_{c}/N_{c}} = -C\\frac{N_{c}}{q_{c}}\n$$\n- Constraint 3 also states: Accretion \"increases rain mass without changing rain number\". This is an explicit statement that accretion grows existing raindrops without creating new ones.\n$$\nS_{N_{r}}^{\\text{accr}} = 0\n$$\n\nNow, we sum the contributions from both processes to find the total tendencies for the number concentrations.\nThe total tendency for cloud number concentration, $S_{N_{c}}$, is the sum of the autoconversion and accretion parts:\n$$\nS_{N_{c}} = S_{N_{c}}^{\\text{auto}} + S_{N_{c}}^{\\text{accr}} = -A\\frac{N_{c}}{q_{c}} - C\\frac{N_{c}}{q_{c}} = -(A+C)\\frac{N_{c}}{q_{c}}\n$$\nThe total tendency for rain number concentration, $S_{N_{r}}$, is the sum of the autoconversion and accretion parts:\n$$\nS_{N_{r}} = S_{N_{r}}^{\\text{auto}} + S_{N_{r}}^{\\text{accr}} = A\\frac{N_{r}}{q_{r}} + 0 = A\\frac{N_{r}}{q_{r}}\n$$\n\nFinally, we assemble the four derived source terms into a single row vector as requested.\nThe vector of source terms $(S_{q_{c}}, S_{N_{c}}, S_{q_{r}}, S_{N_{r}})$ is:\n$S_{q_{c}} = -(A+C)$\n$S_{N_{c}} = -(A+C)\\frac{N_{c}}{q_{c}}$\n$S_{q_{r}} = A+C$\n$S_{N_{r}} = A\\frac{N_{r}}{q_{r}}$\n\nThe resulting vector is $\\left( -(A+C), -(A+C)\\frac{N_{c}}{q_{c}}, A+C, A\\frac{N_{r}}{q_{r}} \\right)$. These expressions are physically consistent with the provided constraints. For instance, the mean cloud droplet mass $\\bar{m}_{c}=q_{c}/N_{c}$ remains constant under these transformations, as $\\frac{d\\bar{m}_{c}}{dt} \\propto \\frac{S_{q_{c}}}{q_{c}} - \\frac{S_{N_{c}}}{N_{c}} = \\frac{-(A+C)}{q_{c}} - \\frac{-(A+C)}{q_{c}} = 0$. This aligns with Constraint 2. Conversely, the mean raindrop mass $\\bar{m}_{r}=q_{r}/N_{r}$ increases due to accretion, as $\\frac{d\\bar{m}_{r}}{dt} \\propto \\frac{S_{q_{r}}}{q_{r}} - \\frac{S_{N_{r}}}{N_{r}} = \\frac{A+C}{q_{r}} - \\frac{A}{q_{r}} = \\frac{C}{q_{r}} > 0$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix} -(A+C) & -(A+C)\\frac{N_{c}}{q_{c}} & A+C & A\\frac{N_{r}}{q_{r}} \\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "This advanced practice addresses a central issue in atmospheric modeling: structural uncertainty in parameterizations. You will implement and compare three distinct warm-rain schemes (Kessler, Khairoutdinov-Kogan, and Seifert-Beheng) within a controlled testbed, learning how to isolate structural differences from simple parameter tuning. By quantifying the divergence in their process-level behavior, you will gain practical insight into why different models produce different results and how to critically evaluate the microphysical assumptions underlying them. ",
            "id": "4111354",
            "problem": "You are to implement a zero-dimensional warm-rain microphysics testbed that compares the structural behavior of three warm-rain parameterizations—Kessler, Khairoutdinov–Kogan 2000 (hereafter abbreviated only after first mention), and Seifert–Beheng—under identical environmental and thermodynamic conditions. The goal is to evaluate structural uncertainty by isolating process-level differences in autoconversion and accretion rather than differences attributable to parameter tuning. Your program must produce a single line of output containing a list of floats, one per test case, each float being a composite structural-difference metric defined below. All results must be in units of $\\mathrm{s^{-1}}$ where applicable, and all input mixing ratios must be in $\\mathrm{kg\\,kg^{-1}}$.\n\nStart from the following fundamental base and well-tested facts:\n- Mass conservation for mixing ratios implies that, in a closed warm-rain box with cloud water mixing ratio $q_c$ and rain water mixing ratio $q_r$, the process-level tendencies due to autoconversion, accretion, and evaporation satisfy\n$$\n\\frac{dq_c}{dt} = -\\left(P_{\\mathrm{aut}} + P_{\\mathrm{accr}}\\right),\\quad\n\\frac{dq_r}{dt} = +\\left(P_{\\mathrm{aut}} + P_{\\mathrm{accr}}\\right) - P_{\\mathrm{evap}},\n$$\nwhere $P_{\\mathrm{aut}}$, $P_{\\mathrm{accr}}$, and $P_{\\mathrm{evap}}$ have units of $\\mathrm{s^{-1}}$ when applied to the dimensionless mixing ratios $q_c$ and $q_r$ (which are in $\\mathrm{kg\\,kg^{-1}}$).\n- Collision–coalescence increases rainwater mass via autoconversion (a cloud-only process) and accretion (collection of cloud by rain), and evaporation removes rainwater in subsaturated air proportional to a saturation deficit factor.\n- Cloud droplet number concentration $N_c$ and rain number concentration $N_r$ (both in $\\mathrm{m^{-3}}$) encode microphysical structure; in double-moment schemes, mass transfer rates depend on characteristic sizes inferred from $q_c$, $q_r$, $N_c$, and $N_r$.\n\nImplement three parameterizations with the following mathematically explicit process-rate formulas. All symbols and constants must be used exactly as provided.\n\nCommon environmental and physical constants (used where indicated):\n- Air density: $\\rho_a = 1.2\\,\\mathrm{kg\\,m^{-3}}$.\n- Liquid water density: $\\rho_w = 1000\\,\\mathrm{kg\\,m^{-3}}$.\n- Reference cloud droplet number: $N_{\\mathrm{ref}} = 1.0\\times 10^{8}\\,\\mathrm{m^{-3}}$.\n- Common evaporation coefficient: $E_0 = 2.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$ (shared across all schemes to isolate collection-process structural differences).\n- Evaporation rate:\n$$\nP_{\\mathrm{evap}} = E_0\\, q_r \\,\\max\\left(1 - \\mathrm{RH},\\, 0\\right),\n$$\nwhere $\\mathrm{RH}$ is relative humidity as a fraction in $[0,1]$.\n\nKessler scheme (single-moment):\n- Threshold autoconversion:\n$$\nP_{\\mathrm{aut}}^{\\mathrm{Kes}} = A_{\\mathrm{Kes}} \\,\\max\\left(q_c - q_{0},\\, 0\\right),\n$$\nwith $A_{\\mathrm{Kes}} = 1.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$, $q_{0} = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,kg^{-1}}$.\n- Accretion:\n$$\nP_{\\mathrm{accr}}^{\\mathrm{Kes}} = B_{\\mathrm{Kes}}\\, q_c\\, q_r,\n$$\nwith $B_{\\mathrm{Kes}} = 1.6\\,\\mathrm{s^{-1}}$.\n\nKhairoutdinov–Kogan 2000 (single-moment in $q_c$ and $q_r$ with explicit $N_c$ dependence in autoconversion):\n- Autoconversion (power-law with $N_c$):\n$$\nP_{\\mathrm{aut}}^{\\mathrm{KK}} = A_{\\mathrm{KK}}\\, q_c^{p}\\,\\left(\\frac{N_c}{N_{\\mathrm{ref}}}\\right)^{-r},\n$$\nwith $A_{\\mathrm{KK}} = 5.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$, $p = 2.2$, $r = 0.5$.\n- Accretion (nonlinear in $q_r$):\n$$\nP_{\\mathrm{accr}}^{\\mathrm{KK}} = B_{\\mathrm{KK}}\\, q_c\\, q_r^{\\delta},\n$$\nwith $B_{\\mathrm{KK}} = 2.2\\,\\mathrm{s^{-1}}$, $\\delta = 0.875$.\n\nSeifert–Beheng (double-moment for rain; structural dependence through characteristic sizes):\n- Cloud effective radius (diagnosed from $q_c$ and $N_c$):\n$$\nr_{\\mathrm{eff},c} = \\left(\\frac{3\\, \\rho_a\\, q_c}{4\\pi\\, \\rho_w\\, N_c}\\right)^{1/3} \\, \\mathrm{m}.\n$$\n- Rain mass-weighted mean diameter (diagnosed from $q_r$ and $N_r$):\n$$\nD_m = \\left(\\frac{6\\, \\rho_a\\, q_r}{\\pi\\, \\rho_w\\, N_r}\\right)^{1/3} \\, \\mathrm{m}.\n$$\n- Autoconversion (size-modulated quadratic in $q_c$):\n$$\nP_{\\mathrm{aut}}^{\\mathrm{SB}} = A_{\\mathrm{SB}}\\, q_c^{2}\\, \\left(\\frac{r_{\\mathrm{eff},c}}{r_0}\\right)^{s},\\quad A_{\\mathrm{SB}} = 8.0\\times 10^{-4} \\, \\mathrm{s^{-1}},\\ r_0 = 10\\times 10^{-6} \\, \\mathrm{m},\\ s = 0.5.\n$$\n- Accretion (size-modulated near-linear in $q_r$):\n$$\nP_{\\mathrm{accr}}^{\\mathrm{SB}} = B_{\\mathrm{SB}}\\, q_c\\, q_r^{\\eta}\\, \\left(\\frac{D_m}{D_0}\\right)^{\\beta},\\quad B_{\\mathrm{SB}} = 1.8 \\, \\mathrm{s^{-1}},\\ \\eta = 0.95,\\ D_0 = 1.0\\times 10^{-3} \\, \\mathrm{m},\\ \\beta = 0.5.\n$$\n\nAmplitude alignment to isolate structural differences:\n- For a designated reference test case (specified below), compute the unscaled total rain mass production (source) for each scheme,\n$$\nR^{X}_{\\mathrm{ref}} = P_{\\mathrm{aut}}^{X} + P_{\\mathrm{accr}}^{X},\\quad X\\in\\{\\mathrm{Kes},\\mathrm{KK},\\mathrm{SB}\\}.\n$$\n- Define the common target production at the reference case as\n$$\n\\overline{R}_{\\mathrm{ref}} = \\frac{1}{3}\\left(R^{\\mathrm{Kes}}_{\\mathrm{ref}} + R^{\\mathrm{KK}}_{\\mathrm{ref}} + R^{\\mathrm{SB}}_{\\mathrm{ref}}\\right).\n$$\n- Compute a scalar amplitude factor for each scheme:\n$$\ns_X = \\frac{\\overline{R}_{\\mathrm{ref}}}{R^{X}_{\\mathrm{ref}}}.\n$$\n- For every test case (including the reference), scale only the autoconversion and accretion of each scheme by its $s_X$:\n$$\n\\widetilde{P}_{\\mathrm{aut}}^{X} = s_X\\, P_{\\mathrm{aut}}^{X},\\quad \\widetilde{P}_{\\mathrm{accr}}^{X} = s_X\\, P_{\\mathrm{accr}}^{X},\n$$\nand keep $P_{\\mathrm{evap}}$ identical across schemes (using $E_0$ above). This isolates structural (shape) differences rather than simple amplitude tuning.\n\nDefine, for each scheme $X$ and test case, the following diagnostics:\n- Total scaled production:\n$$\n\\widetilde{R}^{X} = \\widetilde{P}_{\\mathrm{aut}}^{X} + \\widetilde{P}_{\\mathrm{accr}}^{X}.\n$$\n- Normalized production split vector (composition),\n$$\n\\mathbf{c}^{X} =\n\\begin{cases}\n\\left[\\dfrac{\\widetilde{P}_{\\mathrm{aut}}^{X}}{\\widetilde{R}^{X}},\\ \\dfrac{\\widetilde{P}_{\\mathrm{accr}}^{X}}{\\widetilde{R}^{X}}\\right], & \\widetilde{R}^{X} > 0,\\\n$$8pt]\n[0,0], & \\widetilde{R}^{X} = 0.\n\\end{cases}\n$$\n- Evaporation fraction relative to production (evaporation-limited response),\n$$\ne^{X} = \\frac{P_{\\mathrm{evap}}}{\\widetilde{R}^{X} + \\varepsilon},\\quad \\varepsilon = 10^{-30}.\n$$\n\nFor each test case, compute pairwise structural distances between schemes $X$ and $Y$:\n- Composition distance:\n$$\nd_1(X,Y) = \\left\\|\\mathbf{c}^{X} - \\mathbf{c}^{Y}\\right\\|_2.\n$$\n- Evaporation-fraction distance:\n$$\nd_2(X,Y) = \\left|e^{X} - e^{Y}\\right|.\n$$\n- Relative production shape distance:\n$$\nd_3(X,Y) = \\left|\\log_{10}\\left(\\frac{\\widetilde{R}^{X} + \\varepsilon}{\\widetilde{R}^{Y} + \\varepsilon}\\right)\\right|.\n$$\n- Composite pair metric:\n$$\nm_{\\mathrm{pair}}(X,Y) = \\frac{d_1(X,Y) + d_2(X,Y) + d_3(X,Y)}{3}.\n$$\nDefine the test-case structural uncertainty metric as the average over the three pairs:\n$$\nM_{\\mathrm{case}} = \\frac{1}{3}\\left[m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{KK}) + m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{SB}) + m_{\\mathrm{pair}}(\\mathrm{KK},\\mathrm{SB})\\right].\n$$\n\nTest suite (five physically plausible box states). Each test case is a tuple $\\left(q_c, q_r, \\mathrm{RH}, N_c, N_r\\right)$ where $q_c$ and $q_r$ are in $\\mathrm{kg\\,kg^{-1}}$, $\\mathrm{RH}$ is a unitless fraction in $[0,1]$, and $N_c, N_r$ are in $\\mathrm{m^{-3}}$:\n- Case $1$ (sub-threshold cloud, no rain): $\\left(2.0\\times 10^{-4},\\ 0.0,\\ 0.90,\\ 1.0\\times 10^{8},\\ 5.0\\times 10^{5}\\right)$.\n- Case $2$ (moderate cloud, incipient rain): $\\left(8.0\\times 10^{-4},\\ 1.0\\times 10^{-5},\\ 0.80,\\ 1.5\\times 10^{8},\\ 1.0\\times 10^{6}\\right)$.\n- Case $3$ (reference for amplitude alignment): $\\left(1.5\\times 10^{-3},\\ 5.0\\times 10^{-4},\\ 0.85,\\ 1.0\\times 10^{8},\\ 5.0\\times 10^{5}\\right)$.\n- Case $4$ (rain-dominated): $\\left(2.0\\times 10^{-4},\\ 1.5\\times 10^{-3},\\ 0.70,\\ 8.0\\times 10^{7},\\ 2.0\\times 10^{5}\\right)$.\n- Case $5$ (near-saturated, weak evaporation): $\\left(1.0\\times 10^{-3},\\ 2.0\\times 10^{-4},\\ 0.98,\\ 1.0\\times 10^{8},\\ 1.0\\times 10^{6}\\right)$.\n\nImplementation requirements:\n- Compute $P_{\\mathrm{aut}}$, $P_{\\mathrm{accr}}$, and $P_{\\mathrm{evap}}$ exactly as above for each scheme and test case.\n- Use Case $3$ exclusively to compute the amplitude factors $s_{\\mathrm{Kes}}$, $s_{\\mathrm{KK}}$, $s_{\\mathrm{SB}}$, then apply these to scale autoconversion and accretion for all five cases.\n- For each case, compute $M_{\\mathrm{case}}$ as defined.\n- The final output must be a single line containing a Python-style list of five floats $\\left[M_1,M_2,M_3,M_4,M_5\\right]$, in this order, each rounded to six decimal places.\n- Angles are not involved; no angle units are required.\n- All computations must be done with the units provided; no unit conversions beyond what is shown are needed.\n\nYour program must be self-contained, must not read any input, and must not access external resources. It should produce exactly one line of output in the format described (e.g., $\\left[\\mathrm{result1},\\mathrm{result2},\\mathrm{result3},\\mathrm{result4},\\mathrm{result5}\\right]$).",
            "solution": "The problem requires the implementation of a zero-dimensional box model to compare three different warm-rain parameterization schemes: Kessler, Khairoutdinov–Kogan 2000 (KK), and Seifert–Beheng (SB). The objective is to quantify the structural uncertainty among these schemes by analyzing their process-level behavior under a standardized set of conditions. The solution is structured into three main phases: (1) implementing the physical process rates for each scheme, (2) normalizing the schemes' production amplitudes based on a reference case to isolate structural differences, and (3) computing a composite metric of structural dissimilarity for a suite of test cases.\n\nFirst, we define the fundamental physical constants and model parameters as specified. These include environmental constants like air density $\\rho_a = 1.2\\,\\mathrm{kg\\,m^{-3}}$ and liquid water density $\\rho_w = 1000\\,\\mathrm{kg\\,m^{-3}}$, and process-specific parameters for each scheme.\n\nThe core of the model consists of functions representing the microphysical process rates. For each scheme $X \\in \\{\\mathrm{Kes},\\mathrm{KK},\\mathrm{SB}\\}$, we implement the autoconversion rate, $P_{\\mathrm{aut}}^{X}$, and the accretion rate, $P_{\\mathrm{accr}}^{X}$. These rates determine the transfer of mass from cloud water ($q_c$) to rain water ($q_r$). A single, common evaporation formulation, $P_{\\mathrm{evap}}$, is applied to all schemes to ensure that differences arise solely from the rain formation processes (autoconversion and accretion).\n\nThe Kessler scheme is a single-moment bulk parameterization characterized by a threshold-based autoconversion and linear accretion:\n$$\nP_{\\mathrm{aut}}^{\\mathrm{Kes}} = A_{\\mathrm{Kes}} \\,\\max\\left(q_c - q_{0},\\, 0\\right)\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{Kes}} = B_{\\mathrm{Kes}}\\, q_c\\, q_r\n$$\nwith constants $A_{\\mathrm{Kes}} = 1.0\\times 10^{-3}\\,\\mathrm{s^{-1}}$, $q_{0} = 5.0\\times 10^{-4}\\,\\mathrm{kg\\,kg^{-1}}$, and $B_{\\mathrm{Kes}} = 1.6\\,\\mathrm{s^{-1}}$.\n\nThe Khairoutdinov–Kogan scheme introduces a dependency on the cloud droplet number concentration, $N_c$, into the autoconversion rate, representing an important structural difference from Kessler. The rates are given by power laws:\n$$\nP_{\\mathrm{aut}}^{\\mathrm{KK}} = A_{\\mathrm{KK}}\\, q_c^{p}\\,\\left(\\frac{N_c}{N_{\\mathrm{ref}}}\\right)^{-r}\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{KK}} = B_{\\mathrm{KK}}\\, q_c\\, q_r^{\\delta}\n$$\nwith parameters $A_{\\mathrm{KK}} = 5.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$, $p = 2.2$, $r = 0.5$, $N_{\\mathrm{ref}} = 1.0\\times 10^{8}\\,\\mathrm{m^{-3}}$, $B_{\\mathrm{KK}} = 2.2\\,\\mathrm{s^{-1}}$, and $\\delta = 0.875$.\n\nThe Seifert–Beheng scheme is a more complex, two-moment scheme for rain, where the process rates depend not only on mass mixing ratios but also on characteristic particle sizes, which are diagnosed from both mass and number concentrations ($q_c, N_c, q_r, N_r$).\nFirst, the cloud effective radius $r_{\\mathrm{eff},c}$ and rain mass-weighted mean diameter $D_m$ are diagnosed:\n$$\nr_{\\mathrm{eff},c} = \\left(\\frac{3\\, \\rho_a\\, q_c}{4\\pi\\, \\rho_w\\, N_c}\\right)^{1/3}\n$$\n$$\nD_m = \\left(\\frac{6\\, \\rho_a\\, q_r}{\\pi\\, \\rho_w\\, N_r}\\right)^{1/3}\n$$\nThese sizes modulate the process rates:\n$$\nP_{\\mathrm{aut}}^{\\mathrm{SB}} = A_{\\mathrm{SB}}\\, q_c^{2}\\, \\left(\\frac{r_{\\mathrm{eff},c}}{r_0}\\right)^{s}\n$$\n$$\nP_{\\mathrm{accr}}^{\\mathrm{SB}} = B_{\\mathrm{SB}}\\, q_c\\, q_r^{\\eta}\\, \\left(\\frac{D_m}{D_0}\\right)^{\\beta}\n$$\nwith a set of parameters including $A_{\\mathrm{SB}} = 8.0\\times 10^{-4}\\,\\mathrm{s^{-1}}$, $r_0 = 10\\times 10^{-6}\\,\\mathrm{m}$, and $s=0.5$ for autoconversion, and $B_{\\mathrm{SB}} = 1.8\\,\\mathrm{s^{-1}}$, $\\eta=0.95$, $D_0=1.0\\times 10^{-3}\\,\\mathrm{m}$, and $\\beta=0.5$ for accretion. If $q_r=0$ or $N_r=0$, $D_m$ is zero, and since $\\eta>0$, $P_{\\mathrm{accr}}^{\\mathrm{SB}}$ correctly evaluates to zero.\n\nA critical step is the amplitude alignment. To compare the *structure* of the schemes rather than their baseline magnitudes (which can be tuned), we normalize them. Using the specified reference case (Case 3), we calculate the unscaled total rain production $R^{X}_{\\mathrm{ref}} = P_{\\mathrm{aut}}^{X} + P_{\\mathrm{accr}}^{X}$ for each scheme. The target production rate is their average, $\\overline{R}_{\\mathrm{ref}}$. From this, we derive a unique scaling factor for each scheme, $s_X = \\overline{R}_{\\mathrm{ref}} / R^{X}_{\\mathrm{ref}}$. These factors are then applied to the autoconversion and accretion rates for all test cases:\n$$\n\\widetilde{P}_{\\mathrm{aut}}^{X} = s_X\\, P_{\\mathrm{aut}}^{X}, \\quad \\widetilde{P}_{\\mathrm{accr}}^{X} = s_X\\, P_{\\mathrm{accr}}^{X}\n$$\nThis ensures that at the reference point, all schemes produce rain at the same total rate, $\\widetilde{R}^X = \\overline{R}_{\\mathrm{ref}}$. Any deviation from this equality in other test cases is due to structural differences in their formulation.\n\nWith the scaled rates, we compute a set of diagnostics for each scheme $X$ and test case. These diagnostics are designed to probe different aspects of scheme structure:\n1.  The normalized production split vector, $\\mathbf{c}^{X} = \\left[\\widetilde{P}_{\\mathrm{aut}}^{X}/\\widetilde{R}^{X}, \\widetilde{P}_{\\mathrm{accr}}^{X}/\\widetilde{R}^{X}\\right]$ (for $\\widetilde{R}^{X}>0$), captures the partitioning of mass flux between autoconversion and accretion.\n2.  The evaporation fraction, $e^{X} = P_{\\mathrm{evap}}/(\\widetilde{R}^{X} + \\varepsilon)$, quantifies the balance between rain production and evaporation, where a small constant $\\varepsilon = 10^{-30}$ ensures numerical stability.\n3.  The total scaled production itself, $\\widetilde{R}^{X}$, reveals how the overall production response deviates from the reference case as a function of the input state variables.\n\nFinally, we quantify the structural difference between any two schemes, $X$ and $Y$, using a composite metric. This metric is built from three pairwise distances:\n-   $d_1(X,Y) = \\left\\|\\mathbf{c}^{X} - \\mathbf{c}^{Y}\\right\\|_2$, the Euclidean distance between their composition vectors.\n-   $d_2(X,Y) = \\left|e^{X} - e^{Y}\\right|$, the difference in their evaporation-limited response.\n-   $d_3(X,Y) = \\left|\\log_{10}\\left((\\widetilde{R}^{X} + \\varepsilon)/(\\widetilde{R}^{Y} + \\varepsilon)\\right)\\right|$, the logarithmic ratio of their total production rates, which captures differences in the shape of their response functions.\n\nThe composite pair metric is the average of these three distances: $m_{\\mathrm{pair}}(X,Y) = (d_1+d_2+d_3)/3$. The final structural uncertainty metric for a given test case, $M_{\\mathrm{case}}$, is the average of the three possible pairwise metrics: $m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{KK})$, $m_{\\mathrm{pair}}(\\mathrm{Kes},\\mathrm{SB})$, and $m_{\\mathrm{pair}}(\\mathrm{KK},\\mathrm{SB})$. This process is repeated for all five test cases, yielding a list of five values for $M_{\\mathrm{case}}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a zero-dimensional warm-rain microphysics testbed to compare\n    Kessler, Khairoutdinov-Kogan 2000, and Seifert-Beheng parameterizations.\n    \"\"\"\n\n    # ----------------------------------------------------------------------\n    # 1. Define Constants and Parameters\n    # ----------------------------------------------------------------------\n\n    # Common environmental and physical constants\n    RHO_A = 1.2         # Air density (kg/m^3)\n    RHO_W = 1000.0      # Liquid water density (kg/m^3)\n    N_REF = 1.0e8       # Reference cloud droplet number (m^-3)\n    E0 = 2.0e-3         # Common evaporation coefficient (s^-1)\n    EPSILON = 1.0e-30   # Small number for numerical stability\n\n    # Kessler scheme parameters\n    A_KES = 1.0e-3      # s^-1\n    Q0_KES = 5.0e-4     # kg/kg\n    B_KES = 1.6         # s^-1\n\n    # Khairoutdinov-Kogan 2000 (KK) parameters\n    A_KK = 5.0e-4       # s^-1\n    P_KK = 2.2\n    R_KK = 0.5\n    B_KK = 2.2          # s^-1\n    DELTA_KK = 0.875\n\n    # Seifert-Beheng (SB) parameters\n    A_SB = 8.0e-4       # s^-1\n    R0_SB = 10.0e-6     # m\n    S_SB = 0.5\n    B_SB = 1.8          # s^-1\n    ETA_SB = 0.95\n    D0_SB = 1.0e-3      # m\n    BETA_SB = 0.5\n\n    # ----------------------------------------------------------------------\n    # 2. Define Process Rate Functions\n    # ----------------------------------------------------------------------\n\n    def p_evap(qr, rh):\n        return E0 * qr * max(1.0 - rh, 0.0)\n\n    # Kessler\n    def p_aut_kes(qc):\n        return A_KES * max(qc - Q0_KES, 0.0)\n\n    def p_accr_kes(qc, qr):\n        return B_KES * qc * qr\n\n    # Khairoutdinov-Kogan\n    def p_aut_kk(qc, nc):\n        if qc <= 0 or nc <= 0: return 0.0\n        return A_KK * (qc**P_KK) * ((nc / N_REF)**(-R_KK))\n\n    def p_accr_kk(qc, qr):\n        if qc <= 0 or qr <= 0: return 0.0\n        return B_KK * qc * (qr**DELTA_KK)\n\n    # Seifert-Beheng\n    def r_eff_c_sb(qc, nc):\n        if qc <= 0 or nc <= 0: return 0.0\n        return np.cbrt((3.0 * RHO_A * qc) / (4.0 * np.pi * RHO_W * nc))\n\n    def d_m_sb(qr, nr):\n        if qr <= 0 or nr <= 0: return 0.0\n        return np.cbrt((6.0 * RHO_A * qr) / (np.pi * RHO_W * nr))\n\n    def p_aut_sb(qc, nc):\n        if qc <= 0: return 0.0\n        reff_c = r_eff_c_sb(qc, nc)\n        return A_SB * (qc**2) * ((reff_c / R0_SB)**S_SB)\n\n    def p_accr_sb(qc, qr, nr):\n        if qc <= 0 or qr <= 0: return 0.0\n        dm = d_m_sb(qr, nr)\n        return B_SB * qc * (qr**ETA_SB) * ((dm / D0_SB)**BETA_SB)\n\n    # ----------------------------------------------------------------------\n    # 3. Define Test Cases\n    # ----------------------------------------------------------------------\n    # (qc, qr, RH, Nc, Nr)\n    test_cases = [\n        (2.0e-4, 0.0,    0.90, 1.0e8, 5.0e5), # Case 1\n        (8.0e-4, 1.0e-5, 0.80, 1.5e8, 1.0e6), # Case 2\n        (1.5e-3, 5.0e-4, 0.85, 1.0e8, 5.0e5), # Case 3 (Reference)\n        (2.0e-4, 1.5e-3, 0.70, 8.0e7, 2.0e5), # Case 4\n        (1.0e-3, 2.0e-4, 0.98, 1.0e8, 1.0e6), # Case 5\n    ]\n    ref_case = test_cases[2]\n\n    # ----------------------------------------------------------------------\n    # 4. Amplitude Alignment\n    # ----------------------------------------------------------------------\n    qc_ref, qr_ref, _, nc_ref, nr_ref = ref_case\n\n    # Kessler\n    R_kes_ref = p_aut_kes(qc_ref) + p_accr_kes(qc_ref, qr_ref)\n    # Khairoutdinov-Kogan\n    R_kk_ref = p_aut_kk(qc_ref, nc_ref) + p_accr_kk(qc_ref, qr_ref)\n    # Seifert-Beheng\n    R_sb_ref = p_aut_sb(qc_ref, nc_ref) + p_accr_sb(qc_ref, qr_ref, nr_ref)\n\n    R_bar_ref = (R_kes_ref + R_kk_ref + R_sb_ref) / 3.0\n\n    s_kes = R_bar_ref / R_kes_ref if R_kes_ref > 0 else 1.0\n    s_kk = R_bar_ref / R_kk_ref if R_kk_ref > 0 else 1.0\n    s_sb = R_bar_ref / R_sb_ref if R_sb_ref > 0 else 1.0\n\n    # ----------------------------------------------------------------------\n    # 5. Main Calculation Loop\n    # ----------------------------------------------------------------------\n    M_cases_results = []\n    \n    scheme_funcs = {\n        'Kes': {'aut': p_aut_kes, 'accr': p_accr_kes, 's': s_kes},\n        'KK':  {'aut': p_aut_kk,  'accr': p_accr_kk,  's': s_kk},\n        'SB':  {'aut': p_aut_sb,  'accr': p_accr_sb,  's': s_sb},\n    }\n    \n    for case in test_cases:\n        qc, qr, rh, nc, nr = case\n        \n        # Calculate diagnostics for each scheme\n        diags = {}\n        for name, funcs in scheme_funcs.items():\n            \n            # Pass only required arguments\n            aut_args = {'qc': qc, 'nc': nc}\n            accr_args = {'qc': qc, 'qr': qr, 'nr': nr}\n            \n            p_aut_unscaled = funcs['aut'](**{k: v for k, v in aut_args.items() if k in funcs['aut'].__code__.co_varnames})\n            p_accr_unscaled = funcs['accr'](**{k: v for k, v in accr_args.items() if k in funcs['accr'].__code__.co_varnames})\n            \n            p_aut_scaled = funcs['s'] * p_aut_unscaled\n            p_accr_scaled = funcs['s'] * p_accr_unscaled\n            \n            R_scaled = p_aut_scaled + p_accr_scaled\n            \n            if R_scaled > 0:\n                c_vec = np.array([p_aut_scaled / R_scaled, p_accr_scaled / R_scaled])\n            else:\n                c_vec = np.array([0.0, 0.0])\n\n            evap_rate = p_evap(qr, rh)\n            e_frac = evap_rate / (R_scaled + EPSILON)\n            \n            diags[name] = {'R': R_scaled, 'c': c_vec, 'e': e_frac}\n\n        # Calculate pairwise metrics\n        pairs = [('Kes', 'KK'), ('Kes', 'SB'), ('KK', 'SB')]\n        m_pair_values = []\n        for X, Y in pairs:\n            # d1: Composition distance\n            d1 = np.linalg.norm(diags[X]['c'] - diags[Y]['c'])\n            # d2: Evaporation-fraction distance\n            d2 = abs(diags[X]['e'] - diags[Y]['e'])\n            # d3: Relative production shape distance\n            d3 = abs(np.log10((diags[X]['R'] + EPSILON) / (diags[Y]['R'] + EPSILON)))\n            \n            m_pair = (d1 + d2 + d3) / 3.0\n            m_pair_values.append(m_pair)\n            \n        # Calculate final case metric\n        M_case = np.mean(m_pair_values)\n        M_cases_results.append(M_case)\n\n    # ----------------------------------------------------------------------\n    # 6. Final Output\n    # ----------------------------------------------------------------------\n    formatted_results = [f\"{r:.6f}\" for r in M_cases_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nsolve()\n```"
        }
    ]
}