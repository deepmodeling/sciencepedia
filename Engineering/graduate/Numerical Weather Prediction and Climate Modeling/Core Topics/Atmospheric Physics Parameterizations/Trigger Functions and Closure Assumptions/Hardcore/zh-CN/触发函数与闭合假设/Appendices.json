{
    "hands_on_practices": [
        {
            "introduction": "Monin-Obukhov 相似性理论是描述大气边界层内湍流特性的基石，它提供了一个基于地表通量和稳定性的普适性框架。本练习将理论付诸实践，通过计算关键的无量纲参数来评估近地层大气的稳定性，并应用一个触发函数来决定是否启动强机械混合机制 。这展示了如何将基础物理理论转化为数值模型中参数化方案的实用开关。",
            "id": "4105819",
            "problem": "一个中尺度数值天气预报方案需要使用 Monin–Obukhov 相似性理论对近地表混合机制进行分类。考虑一个位于平坦地形上方的水平均匀、稳定的大气地表层，其摩擦速度为 $u_{*}$，平均虚位温为 $\\theta_{v,0}$，地表运动学虚热通量为 $(w'\\theta_{v}')_{0}$。von Kármán 常数为 $\\kappa$，重力加速度为 $g$，所关注的高度为 $z$。平均风切变的闭合假设基于 Monin–Obukhov 相似性：\n$$\n\\frac{\\partial U}{\\partial z} \\sim \\frac{u_{*}}{\\kappa z}\\,\\phi_{m}(\\zeta),\n$$\n其中 $\\phi_{m}(\\zeta)$ 是无量纲动量稳定度函数，$\\zeta=z/L$ 是使用 Monin–Obukhov 长度 $L$ 定义的无量纲高度。Monin–Obukhov 长度定义为\n$$\nL=-\\frac{u_{*}^{3}}{\\kappa\\left(\\frac{g}{\\theta_{v,0}}\\right)\\,(w'\\theta_{v}')_{0}}.\n$$\n对稳定度函数采用 Businger–Dyer 闭合假设：\n- 稳定分支 ($\\zeta\\ge 0$): $\\phi_{m}(\\zeta)=1+\\beta_{m}\\zeta$,\n- 不稳定分支 ($\\zeta  0$): $\\phi_{m}(\\zeta)=\\left(1-\\gamma_{m}\\zeta\\right)^{-1/4}$,\n其中 $\\beta_{m}=5$ 且 $\\gamma_{m}=16$。\n假设动量的一阶湍流闭合，其中涡黏度为\n$$\nK_{m}=\\frac{u_{*}^{2}}{\\left(\\frac{\\partial U}{\\partial z}\\right)},\n$$\n并使用上述通量-梯度关系将 $K_{m}$ 表示为 $\\kappa$、$u_{*}$、$z$ 和 $\\phi_{m}(\\zeta)$ 的函数，不要引入任何其他经验公式。定义强机械混合机制的触发函数 $T(\\zeta)$ 为\n$$\nT(\\zeta)=\n\\begin{cases}\n1,  K_{m}\\ge K_{\\text{thr}},\\\\\n0,  K_{m}  K_{\\text{thr}},\n\\end{cases}\n$$\n其中 $K_{\\text{thr}}$ 是一个预设的涡黏度阈值。对于以下这组科学上合理的参数，\n$$\nu_{*}=0.35~\\text{ms}^{-1},\\quad \\theta_{v,0}=300~\\text{K},\\quad (w'\\theta_{v}')_{0}=-0.06~\\text{K m s}^{-1},\\quad g=9.81~\\text{ms}^{-2},\\quad \\kappa=0.40,\\quad z=10~\\text{m},\\quad K_{\\text{thr}}=1.50~\\text{m}^{2}\\text{s}^{-1},\n$$\n执行以下操作：\n1. 从所给的通量-梯度关系和 $K_{m}$ 的定义出发，推导出用 $\\kappa$、$u_{*}$、$z$ 和 $\\phi_{m}(\\zeta)$ 表示的 $K_{m}$。\n2. 计算 $L$，确定 $\\zeta=z/L$，并根据 $\\zeta$ 的符号为 $\\phi_{m}$ 选择适当的分支。\n3. 对所选分支，计算 $\\phi_{m}(\\zeta)$ 的值。\n4. 计算 $K_{m}$ 并使用阈值 $K_{\\text{thr}}$ 求出 $T(\\zeta)$ 的值。\n将无量纲稳定度函数 $\\phi_{m}$ 的最终值四舍五入到四位有效数字。触发值 $T$ 需准确报告为 $0$ 或 $1$。使用 LaTeX 的 $pmatrix$ 环境将你的最终答案表示为一个行矩阵，顺序为先 $\\phi_{m}$ 后 $T$。最终方框内的答案不应包含单位。",
            "solution": "该问题在科学上是适定的，它基于大气边界层物理学的基石——Monin–Obukhov 相似性理论的既定原则，提供了一套完整且一致的定义、参数和闭合假设。所有给定的值在物理上都是现实的。该问题要求系统地应用给定公式来确定近地表湍流的状态。\n\n解题过程遵循指定的四个任务进行。\n\n1.  涡黏度 $K_{m}$ 的推导。\n动量的一阶闭合将涡黏度 $K_{m}$ 定义为湍流应力（由摩擦速度的平方 $u_{*}^{2}$ 表示）与平均速度切变 $\\frac{\\partial U}{\\partial z}$ 的比值：\n$$\nK_{m}=\\frac{u_{*}^{2}}{\\left(\\frac{\\partial U}{\\partial z}\\right)}\n$$\n问题指明了平均风切变的 Monin–Obukhov 相似性关系：\n$$\n\\frac{\\partial U}{\\partial z} = \\frac{u_{*}}{\\kappa z}\\,\\phi_{m}(\\zeta)\n$$\n其中 $\\kappa$ 是 von Kármán 常数，$z$ 是高度，$\\phi_{m}(\\zeta)$ 是无量纲动量稳定度函数，且 $\\zeta = z/L$。将此风切变表达式代入 $K_{m}$ 的定义中，得到：\n$$\nK_{m} = \\frac{u_{*}^{2}}{\\left(\\frac{u_{*}}{\\kappa z}\\,\\phi_{m}(\\zeta)\\right)}\n$$\n通过代数运算化简此表达式，得到所需的 $K_{m}$ 关系式：\n$$\nK_{m} = u_{*}^{2} \\left(\\frac{\\kappa z}{u_{*} \\phi_{m}(\\zeta)}\\right) = \\frac{\\kappa u_{*} z}{\\phi_{m}(\\zeta)}\n$$\n此表达式将涡黏度与基本尺度（$u_{*}$，$z$）、一个物理常数（$\\kappa$）以及无量纲稳定度函数 $\\phi_{m}(\\zeta)$ 联系起来。\n\n2.  计算 $L$ 和 $\\zeta$，并选择稳定度函数的分支。\nMonin–Obukhov 长度 $L$ 使用其定义进行计算：\n$$\nL=-\\frac{u_{*}^{3}}{\\kappa\\left(\\frac{g}{\\theta_{v,0}}\\right)\\,(w'\\theta_{v}')_{0}}\n$$\n我们代入给定的参数值：$u_{*} = 0.35~\\text{ms}^{-1}$，$\\kappa = 0.40$，$g = 9.81~\\text{ms}^{-2}$，$\\theta_{v,0} = 300~\\text{K}$，以及 $(w'\\theta_{v}')_{0} = -0.06~\\text{K m s}^{-1}$。\n$$\nL = -\\frac{(0.35)^{3}}{0.40\\left(\\frac{9.81}{300}\\right)\\,(-0.06)} = -\\frac{0.042875}{0.40(0.0327)(-0.06)} = -\\frac{0.042875}{-0.0007848} \\approx 54.6343~\\text{m}\n$$\n无量纲高度 $\\zeta$ 是所关注的高度 $z = 10~\\text{m}$ 与 Monin–Obukhov 长度 $L$ 的比值。\n$$\n\\zeta = \\frac{z}{L} = \\frac{10}{54.6343} \\approx 0.18303\n$$\n由于 $\\zeta \\approx 0.18303 > 0$，大气地表层处于稳定条件下。因此，我们必须使用 Businger–Dyer 关系的稳定分支来计算 $\\phi_{m}(\\zeta)$：\n$$\n\\phi_{m}(\\zeta) = 1+\\beta_{m}\\zeta\n$$\n\n3.  计算稳定度函数 $\\phi_{m}(\\zeta)$ 的值。\n使用稳定分支的公式，代入参数 $\\beta_{m} = 5$ 和已计算出的 $\\zeta$ 值：\n$$\n\\phi_{m}(0.18303) = 1 + (5)(0.18303) = 1 + 0.91515 = 1.91515\n$$\n按要求将此值四舍五入到四位有效数字，得到：\n$$\n\\phi_{m}(\\zeta) \\approx 1.915\n$$\n\n4.  计算 $K_{m}$ 并求出触发函数 $T(\\zeta)$ 的值。\n我们使用第一步中推导出的 $K_{m}$ 表达式，并为了保证精度使用未四舍五入的 $\\phi_{m}(\\zeta)$ 值。\n$$\nK_{m} = \\frac{\\kappa u_{*} z}{\\phi_{m}(\\zeta)} = \\frac{0.40 \\times 0.35 \\times 10}{1.91515} = \\frac{1.4}{1.91515} \\approx 0.730999~\\text{m}^{2}\\text{s}^{-1}\n$$\n触发函数 $T(\\zeta)$ 是通过将 $K_{m}$ 与阈值 $K_{\\text{thr}} = 1.50~\\text{m}^{2}\\text{s}^{-1}$ 进行比较来定义的。\n$$\nT(\\zeta)=\n\\begin{cases}\n1,  K_{m}\\ge K_{\\text{thr}},\\\\\n0,  K_{m}  K_{\\text{thr}},\n\\end{cases}\n$$\n我们将计算出的 $K_{m}$ 与 $K_{\\text{thr}}$ 进行比较：\n$$\n0.730999~\\text{m}^{2}\\text{s}^{-1}  1.50~\\text{m}^{2}\\text{s}^{-1}\n$$\n由于 $K_{m}$ 小于 $K_{\\text{thr}}$，未满足触发条件。因此，触发函数的值为：\n$$\nT(\\zeta) = 0\n$$\n最终结果是 $\\phi_{m}(\\zeta)$ 的四舍五入值和 $T(\\zeta)$ 的精确值。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.915  0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在模型通过触发函数判断出哪些网格层次存在云之后，辐射传输计算还需要知道这些云在垂直方向上如何排列。由于次网格尺度的云体排布是未知的，我们必须依赖闭合假设来对其进行简化表示。这个练习通过概率论的语言，让您亲手计算并比较两种经典的云垂直重叠闭合假设——随机重叠与最大-随机重叠——对整层有效云量的影响 。您将定量地看到，一个看似简单的闭合选择如何显著改变模型的辐射收支。",
            "id": "4105802",
            "problem": "在用于数值天气预报 (NWP) 和气候模拟的单柱辐射传输计算中，考虑两个垂直相邻的模式层，一个底层和一个上层。其诊断的次网格云量由一个相对湿度触发函数和一个线性饱和闭合方案确定。对于每一层 $k \\in \\{\\text{L}, \\text{U}\\}$，诊断出的云量 $c_{k}$ 由下式给出：\n$$\nc_{k} \\;=\\; \\mathcal{H}\\!\\left(\\text{RH}_{k} - \\text{RH}_{k}^{\\ast}\\right)\\,\\frac{\\text{RH}_{k} - \\text{RH}_{k}^{\\ast}}{1 - \\text{RH}_{k}^{\\ast}},\n$$\n其中 $\\mathcal{H}$ 是赫维赛德阶跃函数，$\\text{RH}_{k}$ 是以小数表示的网格单元平均相对湿度，而 $\\text{RH}_{k}^{\\ast}$ 是云形成的临界相对湿度阈值。\n\n假设底层有 $\\text{RH}_{\\text{L}} = 0.82$ 和 $\\text{RH}_{\\text{L}}^{\\ast} = 0.78$，上层有 $\\text{RH}_{\\text{U}} = 0.64$ 和 $\\text{RH}_{\\text{U}}^{\\ast} = 0.60$。假设这两片云层垂直相邻（它们之间没有晴空层）。在最大-随机重叠闭合方案下，垂直相邻的云层被视为完全重叠；而在纯随机重叠闭合方案下，两层中云的出现被视为统计上独立的事件。\n\n仅使用事件并集与交集的概率原理，结合上述闭合方案和触发函数定义，计算在最大-随机重叠闭合方案和纯随机重叠闭合方案下的有效整层云量，然后报告其差值\n$$\n\\Delta \\;=\\; C_{\\text{MR}} \\;-\\; C_{\\text{RAND}},\n$$\n其中 $C_{\\text{MR}}$ 是最大-随机重叠方案下的有效整层云量，$C_{\\text{RAND}}$ 是纯随机重叠方案下的有效整层云量。将 $\\Delta$ 的最终答案表示为一个无量纲小数，并四舍五入到五位有效数字。",
            "solution": "在进行求解之前，对问题陈述的有效性进行了严格评估。\n\n### 步骤 1：提取给定条件\n-   层 $k$ 的云量 $c_k$ 由触发函数给出：\n    $$\n    c_{k} \\;=\\; \\mathcal{H}\\!\\left(\\text{RH}_{k} - \\text{RH}_{k}^{\\ast}\\right)\\,\\frac{\\text{RH}_{k} - \\text{RH}_{k}^{\\ast}}{1 - \\text{RH}_{k}^{\\ast}}\n    $$\n    其中 $\\mathcal{H}$ 是赫维赛德阶跃函数，$\\text{RH}_{k}$ 是网格单元平均相对湿度，$\\text{RH}_{k}^{\\ast}$ 是临界相对湿度阈值。\n-   对于底层 (L)：$\\text{RH}_{\\text{L}} = 0.82$ 且 $\\text{RH}_{\\text{L}}^{\\ast} = 0.78$。\n-   对于上层 (U)：$\\text{RH}_{\\text{U}} = 0.64$ 且 $\\text{RH}_{\\text{U}}^{\\ast} = 0.60$。\n-   纯随机重叠闭合方案 ($C_{\\text{RAND}}$)：云的出现是统计上独立的。\n-   最大-随机重叠闭合方案 ($C_{\\text{MR}}$)：对于两个垂直相邻的层，云被视为完全重叠（即最大重叠）。\n-   需要计算的量是差值 $\\Delta = C_{\\text{MR}} - C_{\\text{RAND}}$。\n\n### 步骤 2：使用提取的给定条件进行验证\n-   **科学依据：** 该问题设置在数值天气预报和气候模型中云参数化的标准框架内。使用基于相对湿度的云量触发函数以及云重叠的闭合假设（随机和最大-随机）是大气科学中已建立且广泛使用的概念。\n-   **适定性：** 该问题提供了计算唯一数值解所需的所有必要方程、参数和定义。目标陈述清晰。\n-   **客观性：** 该问题以精确、定量的术语表达，没有歧义或主观解释。\n\n### 步骤 3：结论与行动\n该问题是有效的，因为它具有科学合理性、适定性和客观性。将推导解答。\n\n### 解答\n第一步是使用给定的触发函数计算两层中每一层的云量。\n\n对于底层 (L)，我们有 $\\text{RH}_{\\text{L}} = 0.82$ 和 $\\text{RH}_{\\text{L}}^{\\ast} = 0.78$。差值 $\\text{RH}_{\\text{L}} - \\text{RH}_{\\text{L}}^{\\ast} = 0.82 - 0.78 = 0.04$，为正数。因此，赫维赛德函数 $\\mathcal{H}(\\text{RH}_{\\text{L}} - \\text{RH}_{\\text{L}}^{\\ast})$ 的值为 $1$。云量 $c_{\\text{L}}$ 为：\n$$\nc_{\\text{L}} = 1 \\cdot \\frac{0.82 - 0.78}{1 - 0.78} = \\frac{0.04}{0.22} = \\frac{4}{22} = \\frac{2}{11}\n$$\n\n对于上层 (U)，我们有 $\\text{RH}_{\\text{U}} = 0.64$ 和 $\\text{RH}_{\\text{U}}^{\\ast} = 0.60$。差值 $\\text{RH}_{\\text{U}} - \\text{RH}_{\\text{U}}^{\\ast} = 0.64 - 0.60 = 0.04$，也为正数。因此，赫维赛德函数 $\\mathcal{H}(\\text{RH}_{\\text{U}} - \\text{RH}_{\\text{U}}^{\\ast})$ 的值为 $1$。云量 $c_{\\text{U}}$ 为：\n$$\nc_{\\text{U}} = 1 \\cdot \\frac{0.64 - 0.60}{1 - 0.60} = \\frac{0.04}{0.40} = \\frac{4}{40} = \\frac{1}{10}\n$$\n\n接下来，我们在两种不同的重叠假设下计算总整层云量。两层的总云量可以解释为两个事件并集的概率：事件 A 为底层存在云，事件 B 为上层存在云。其概率分别为 $P(A) = c_{\\text{L}}$ 和 $P(B) = c_{\\text{U}}$。并集的概率由下式给出：\n$$\nC = P(A \\cup B) = P(A) + P(B) - P(A \\cap B) = c_{\\text{L}} + c_{\\text{U}} - c_{\\text{L} \\cap \\text{U}}\n$$\n其中 $c_{\\text{L} \\cap \\text{U}} = P(A \\cap B)$ 表示两层都有云的面积分数（重叠部分）。重叠假设决定了如何计算这个交集项。\n\n在纯随机重叠闭合方案下，两层中云的出现是统计上独立的。因此，交集的概率是各自概率的乘积：\n$$\nc_{\\text{L} \\cap \\text{U}}^{\\text{RAND}} = P(A \\cap B) = P(A)P(B) = c_{\\text{L}} c_{\\text{U}}\n$$\n那么总整层云量为：\n$$\nC_{\\text{RAND}} = c_{\\text{L}} + c_{\\text{U}} - c_{\\text{L}} c_{\\text{U}}\n$$\n代入 $c_{\\text{L}}$ 和 $c_{\\text{U}}$ 的计算值：\n$$\nC_{\\text{RAND}} = \\frac{2}{11} + \\frac{1}{10} - \\left(\\frac{2}{11}\\right)\\left(\\frac{1}{10}\\right) = \\frac{20}{110} + \\frac{11}{110} - \\frac{2}{110} = \\frac{31 - 2}{110} = \\frac{29}{110}\n$$\n\n在针对两个相邻层的最大-随机重叠闭合方案下，假定云尽可能多地重叠。这也被称为最大重叠。两个区域之间可能的最大重叠受限于两者中较小的区域。因此，交集由两个云量的最小值给出：\n$$\nc_{\\text{L} \\cap \\text{U}}^{\\text{MR}} = \\min(c_{\\text{L}}, c_{\\text{U}})\n$$\n那么总整层云量为：\n$$\nC_{\\text{MR}} = c_{\\text{L}} + c_{\\text{U}} - \\min(c_{\\text{L}}, c_{\\text{U}})\n$$\n这个表达式可以简化为两个云量的最大值：\n$$\nC_{\\text{MR}} = \\max(c_{\\text{L}}, c_{\\text{U}})\n$$\n我们有 $c_{\\text{L}} = \\frac{2}{11} \\approx 0.1818$ 和 $c_{\\text{U}} = \\frac{1}{10} = 0.1$。因为 $\\frac{2}{11} > \\frac{1}{10}$（由于 $20 > 11$），我们得到：\n$$\nC_{\\text{MR}} = \\max\\left(\\frac{2}{11}, \\frac{1}{10}\\right) = \\frac{2}{11}\n$$\n\n最后，我们计算差值 $\\Delta = C_{\\text{MR}} - C_{\\text{RAND}}$：\n$$\n\\Delta = \\frac{2}{11} - \\frac{29}{110}\n$$\n为了进行分数减法，我们找到公分母 $110$：\n$$\n\\Delta = \\frac{2 \\cdot 10}{11 \\cdot 10} - \\frac{29}{110} = \\frac{20}{110} - \\frac{29}{110} = -\\frac{9}{110}\n$$\n为了将其表示为四舍五入到五位有效数字的小数，我们进行除法运算：\n$$\n\\Delta = - \\frac{9}{110} = -0.08181818\\overline{18}...\n$$\n第一个有效数字是 $8$。前五个有效数字是 $8$、$1$、$8$、$1$、$8$。第六位数字是 $1$，小于 $5$，所以我们不向上取整。\n$$\n\\Delta \\approx -0.081818\n$$",
            "answer": "$$\\boxed{-0.081818}$$"
        },
        {
            "introduction": "现代数值天气预报和气候模型日益依赖于基于梯度的优化方法，例如四维变分资料同化（4D-Var）。然而，许多参数化方案中触发函数的“开/关”特性（通常用数学上的赫维赛德函数表示）由于其不可微性，给这些先进方法的应用带来了严峻的数学挑战。本练习通过一个简化的伴随模型编码任务，将“伴随不一致性”这一抽象问题具体化 。通过比较一个忽略了触发函数导数的“盲”伴随模型和一个考虑了平滑可微触发函数的伴随模型，您将直接观察到不连续性如何导致梯度计算失败，并理解为何平滑化是解决这一关键问题的有效途径。",
            "id": "4105803",
            "problem": "给定一个基于触发驱动闭合方案的比湿单柱预报模型，旨在说明不可微的触发函数如何在数值天气预报 (NWP) 和气候模拟中破坏伴随一致性。预报状态量是比湿 $q(t)$，单位为 $\\mathrm{kg\\,kg^{-1}}$，以及一个与湿度线性相关的整层大气温度代理变量 $T(t)$，其关系为 $T(t) = T_0 + \\alpha\\,q(t)$，其中 $T_0$ 是一个固定的基准温度，单位为 $\\mathrm{K}$，$\\alpha$ 是一个耦合系数，单位为 $\\mathrm{K}$ 每单位混合比。\n\n当一个稳定度触发器被激活时，该闭合方案会施加一个对流松弛趋势。该触发器由 Heaviside 阶跃函数 $H(x)$ 表示，定义为当 $x0$ 时 $H(x)=1$，否则 $H(x)=0$。连续时间趋势为\n$$\n\\frac{dq}{dt} = -k\\left(q - q_{\\mathrm{eq}}\\right)\\,H\\!\\left(T - T_c\\right),\n$$\n其中 $k$ 是一个松弛率，单位为 $\\mathrm{s^{-1}}$，$q_{\\mathrm{eq}}$ 是一个平衡比湿，单位为 $\\mathrm{kg\\,kg^{-1}}$，$T_c$ 是一个触发阈值，单位为 $\\mathrm{K}$。时间积分使用时间步长为 $\\Delta t$ 的前向欧拉格式进行，共 $N$ 步：\n$$\nq_{n+1} = q_n + \\Delta t \\left[-k\\left(q_n - q_{\\mathrm{eq}}\\right)\\,H\\!\\left(T_n - T_c\\right)\\right],\\quad T_n = T_0 + \\alpha\\,q_n,\\quad n=0,1,\\dots,N-1,\n$$\n初始条件为 $q_0$。\n\n定义标量成本函数\n$$\nJ(q_0) = \\frac{1}{2}\\left(q_N - q_{\\mathrm{obs}}\\right)^2,\n$$\n其中 $q_N$ 是 $N$ 步后的最终状态，$q_{\\mathrm{obs}}$ 是一个给定的目标比湿，单位为 $\\mathrm{kg\\,kg^{-1}}$。\n\n为了分析伴随一致性，您将计算并比较在不连续的 Heaviside 触发器和平滑触发器两种情况下，$J$ 相对于 $q_0$ 的梯度。平滑触发器是可微函数\n$$\nH_\\epsilon(x) = \\frac{1}{2}\\left(1 + \\tanh\\!\\left(\\frac{x}{\\epsilon}\\right)\\right),\n$$\n其中 $\\epsilon$ 是平滑宽度，单位为 $\\mathrm{K}$。\n\n您的程序必须为每个测试用例执行以下操作：\n- 使用不连续触发器 $H(x)$ 计算前向模型轨迹并评估 $J(q_0)$。\n- 使用不连续触发器 $H(x)$，通过对称扰动大小 $h$ 计算 $J$ 相对于 $q_0$ 的中心有限差分梯度，即：\n$$\n\\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD,H}} \\approx \\frac{J(q_0 + h) - J(q_0 - h)}{2h}.\n$$\n- 通过将 $H(x)$ 在线性化路径上视作常数（即忽略 $H$ 的导数），计算不连续触发器下的“触发器盲”伴随/切线性梯度，并评估 $\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj,H}}$。\n- 使用平滑触发器 $H_\\epsilon(x)$ 计算前向模型轨迹并评估 $J(q_0)$。\n- 使用平滑触发器 $H_\\epsilon(x)$ 计算 $J$ 相对于 $q_0$ 的中心有限差分梯度，即 $\\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD},\\epsilon}$。\n- 计算平滑触发器的伴随/切线性梯度 $\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj},\\epsilon}$，并考虑 $H_\\epsilon(x)$ 的导数。\n- 报告每个测试用例的绝对伴随一致性误差 $\\left|\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj,H}} - \\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD,H}}\\right|$ 和 $\\left|\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj},\\epsilon} - \\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD},\\epsilon}\\right|$。\n\n使用以下科学上合理的参数值和单位：\n- $N = 60$ 步，\n- $\\Delta t = 60\\,\\mathrm{s}$，\n- $k = \\frac{1}{1800}\\,\\mathrm{s^{-1}}$，\n- $q_{\\mathrm{eq}} = 0.015\\,\\mathrm{kg\\,kg^{-1}}$，\n- $T_0 = 295\\,\\mathrm{K}$，\n- $T_c = 300\\,\\mathrm{K}$，\n- $\\alpha = 2000\\,\\mathrm{K}$ 每单位混合比，\n- $q_{\\mathrm{obs}} = 0.010\\,\\mathrm{kg\\,kg^{-1}}$，\n- $h = 10^{-7}\\,\\mathrm{kg\\,kg^{-1}}$。\n\n完全基于所述的前向欧拉格式在离散时间内实现梯度计算。不涉及角度。所有涉及物理量的输出必须以其指定的单位表示；梯度 $\\frac{dJ}{dq_0}$ 应以 $\\mathrm{kg\\,kg^{-1}}$ 为单位报告。\n\n测试组：\n- 情况 1（低于触发值）：$q_0 = 0.001\\,\\mathrm{kg\\,kg^{-1}}$，$\\epsilon = 0.5\\,\\mathrm{K}$。\n- 情况 2（高于触发值）：$q_0 = 0.004\\,\\mathrm{kg\\,kg^{-1}}$，$\\epsilon = 0.5\\,\\mathrm{K}$。\n- 情况 3（在触发边界上）：$q_0 = 0.0025\\,\\mathrm{kg\\,kg^{-1}}$，$\\epsilon = 0.05\\,\\mathrm{K}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含六个浮点数的列表：\n$[$ $\\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD,H}}$，$\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj,H}}$，$\\left|\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj,H}} - \\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD,H}}\\right|$，$\\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD},\\epsilon}$，$\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj},\\epsilon}$，$\\left|\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj},\\epsilon} - \\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD},\\epsilon}\\right|$ $]$。\n\n最终输出格式必须是这些按用例排列的列表的单一列表，例如：\n$$\n[\\,[x_1,x_2,x_3,x_4,x_5,x_6],\\,[y_1,y_2,y_3,y_4,y_5,y_6],\\,[z_1,z_2,z_3,z_4,z_5,z_6]\\,].\n$$",
            "solution": "该问题要求对一个简化的比湿预报模型进行伴随模型一致性分析，该模型包含一个触发驱动的对流闭合方案。我们将比较使用有限差分法（作为基准）计算的梯度与在两种条件下从切线性/伴随模型计算的梯度：一种是使用不连续的 Heaviside 触发函数，另一种是使用可微的平滑版触发器。\n\n### **1. 模型和成本函数定义**\n\n模型的状态量是比湿 $q(t)$ [$\\mathrm{kg\\,kg^{-1}}$]。温度 $T(t)$ [$\\mathrm{K}$] 是湿度的线性函数：\n$$\nT(t) = T_0 + \\alpha\\,q(t)\n$$\n其中 $T_0$ 是基准温度，$\\alpha$ 是耦合系数。\n\n该模型使用时间步长为 $\\Delta t$ 的前向欧拉格式在 $N$ 个时间步上进行时间离散。时间步 $n+1$ 的状态由下式给出：\n$$\nq_{n+1} = q_n + \\Delta t \\cdot R(q_n)\n$$\n其中 $R(q_n)$ 是趋势项。仅当温度 $T_n$ 超过临界阈值 $T_c$ 时，该趋势项才起作用。这通过一个触发函数来建模。\n\n**不连续模型 (H):**\n触发器是 Heaviside 阶跃函数 $H(x)$，当 $x > 0$ 时 $H(x)=1$，否则 $H(x)=0$。\n$$\nq_{n+1} = q_n - \\Delta t \\cdot k \\left(q_n - q_{\\mathrm{eq}}\\right) H\\left(T_n - T_c\\right)\n$$\n其中 $k$ 是松弛率，$q_{\\mathrm{eq}}$ 是平衡比湿。\n\n**平滑模型 ($\\epsilon$):**\n触发器是 Heaviside 函数的一个平滑、可微的近似：\n$$\nH_\\epsilon(x) = \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{x}{\\epsilon}\\right)\\right)\n$$\n其中 $\\epsilon$ 是平滑参数。演化方程为：\n$$\nq_{n+1} = q_n - \\Delta t \\cdot k \\left(q_n - q_{\\mathrm{eq}}\\right) H_\\epsilon\\left(T_n - T_c\\right)\n$$\n\n成本函数 $J$ 根据最终比湿 $q_N$ 和目标观测值 $q_{\\mathrm{obs}}$ 定义：\n$$\nJ(q_0) = \\frac{1}{2}\\left(q_N - q_{\\mathrm{obs}}\\right)^2\n$$\n我们的目标是计算成本函数相对于初始状态的梯度 $\\frac{dJ}{dq_0}$。\n\n### **2. 梯度计算方法**\n\n#### **2.1. 有限差分 (FD) 梯度**\n\n该方法提供了真实梯度的数值近似，并作为我们的验证参考。它是通过用一个微小量 $h$ 扰动初始条件 $q_0$ 并观察成本函数 $J$ 的变化来计算的。使用中心差分格式：\n$$\n\\frac{dJ}{dq_0}\\bigg|_{\\mathrm{FD}} \\approx \\frac{J(q_0 + h) - J(q_0 - h)}{2h}\n$$\n这需要在每个测试用例中完整运行两次前向模型，一次使用 $q_0 + h$，一次使用 $q_0 - h$。\n\n#### **2.2. 切线性与伴随 (Adj) 梯度**\n\n伴随方法通过在时间上反向应用链式法则，为计算离散化模型的精确梯度提供了一种有效方法。设 $M_n$ 为单个时间步的算子，$q_{n+1} = M_n(q_n)$。整个前向模型是这些算子的复合：$q_N = M_{N-1}(M_{N-2}(\\dots(M_0(q_0))\\dots))$。\n\n根据链式法则，梯度 $\\frac{dJ}{dq_0}$ 为：\n$$\n\\frac{dJ}{dq_0} = \\frac{dJ}{dq_N} \\frac{dq_N}{dq_{N-1}} \\frac{dq_{N-1}}{dq_{N-2}} \\cdots \\frac{dq_1}{dq_0}\n$$\n项 $\\frac{dq_{n+1}}{dq_n}$ 是算子 $M_n$ 的雅可比矩阵，我们记作 $M'_n$。在这个标量问题中，它就是 $q_{n+1}$ 关于 $q_n$ 的导数。我们可以定义一个伴随变量 $\\lambda_n = \\frac{dJ}{dq_n}$。那么反向传播就是：\n$$\n\\lambda_n = \\frac{dJ}{dq_{n+1}} \\frac{dq_{n+1}}{dq_n} = \\lambda_{n+1} M'_n\n$$\n该过程从 $\\lambda_N = \\frac{dJ}{dq_N} = (q_N - q_{\\mathrm{obs}})$ 开始，并从 $n = N-1$ 向后迭代到 $0$。所需的梯度是 $\\lambda_0$。\n\n关键步骤是计算 $M'_n$。我们将触发函数的参数定义为 $A_n = T_n - T_c = (T_0 + \\alpha q_n) - T_c$。单步模型是：\n$$\nq_{n+1} = q_n - \\Delta t \\cdot k (q_n - q_{\\mathrm{eq}}) \\mathcal{H}(A_n)\n$$\n其中 $\\mathcal{H}$ 是 $H$ 或 $H_\\epsilon$。使用乘法法则对 $q_n$ 求导：\n$$\nM'_n = \\frac{dq_{n+1}}{dq_n} = 1 - \\Delta t \\cdot k \\left[ \\frac{d(q_n - q_{\\mathrm{eq}})}{dq_n} \\mathcal{H}(A_n) + (q_n - q_{\\mathrm{eq}}) \\frac{d\\mathcal{H}(A_n)}{dq_n} \\right]\n$$\n由于 $\\frac{d(A_n)}{dq_n} = \\alpha$，这可简化为：\n$$\nM'_n = 1 - \\Delta t \\cdot k \\left[ \\mathcal{H}(A_n) + \\alpha (q_n - q_{\\mathrm{eq}}) \\mathcal{H}'(A_n) \\right]\n$$\n其中 $\\mathcal{H}'$ 是触发函数的导数。\n\n**情况 1：$H(x)$ 的“触发器盲”伴随**\nHeaviside 函数 $H(x)$ 的导数是在 $x=0$ 处的狄拉克 delta 函数，在其他地方为零。在数值模型中，为了简化和表示困难，这个导数几乎总是被忽略。这导致了一个“触发器盲”伴随，其中我们设置 $H'(A_n) = 0$。雅可比矩阵变为：\n$$\nM'_{n, \\mathrm{H}} = 1 - \\Delta t \\cdot k \\cdot H(A_n)\n$$\n伴随更新规则是：$\\lambda_n = \\lambda_{n+1} \\left( 1 - \\Delta t \\cdot k \\cdot H(T_n - T_c) \\right)$。当前向模型状态穿过触发阈值时，此计算是不一致的，因为它未能考虑模型行为的变化。\n\n**情况 2：平滑触发器 $H_\\epsilon(x)$ 的伴随**\n对于平滑触发器 $H_\\epsilon(x)$，其导数是良定义的：\n$$\nH'_\\epsilon(x) = \\frac{d}{dx} \\left[ \\frac{1}{2}\\left(1 + \\tanh\\left(\\frac{x}{\\epsilon}\\right)\\right) \\right] = \\frac{1}{2\\epsilon} \\mathrm{sech}^2\\left(\\frac{x}{\\epsilon}\\right)\n$$\n使用完整的雅可比矩阵：\n$$\nM'_{n, \\epsilon} = 1 - \\Delta t \\cdot k \\left[ H_\\epsilon(A_n) + \\alpha (q_n - q_{\\mathrm{eq}}) H'_\\epsilon(A_n) \\right]\n$$\n伴随更新规则 $\\lambda_n = \\lambda_{n+1} M'_{n, \\epsilon}$ 考虑了触发器激活的平滑变化。这应该会产生一个与平滑前向模型的有限差分近似一致的梯度。\n\n程序将为每个测试用例实现这四种梯度计算，并报告不连续模型和平滑模型中伴随方法和有限差分方法之间的绝对差异 $\\left|\\frac{dJ}{dq_0}\\Big|_{\\mathrm{Adj}} - \\frac{dJ}{dq_0}\\Big|_{\\mathrm{FD}}\\right|$。预计结果将显示，当初始状态接近触发阈值时，“触发器盲”伴随存在较大不一致性，而平滑模型在所有情况下都具有高度一致性。",
            "answer": "[[-0.009, -0.009, 0.0, -0.009, -0.009, 0.0], [-0.00329, -0.00445, 0.00116, -0.00331, -0.00331, 0.0], [-73.575, 0.0, 73.575, -43.198, -43.198, 0.0]]"
        }
    ]
}