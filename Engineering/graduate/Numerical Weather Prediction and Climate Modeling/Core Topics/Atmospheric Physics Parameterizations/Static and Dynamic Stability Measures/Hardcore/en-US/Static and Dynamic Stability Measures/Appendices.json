{
    "hands_on_practices": [
        {
            "introduction": "Understanding atmospheric stability begins with interpreting basic measurements. This practice guides you through a fundamental process in meteorology: converting raw sounding data—pressure ($p$) and temperature ($T$)—into a vertical profile of static stability. By applying the hypsometric equation and the concept of potential temperature ($\\theta$), you will programmatically assess whether atmospheric layers are stable, neutral, or unstable, a critical first step in forecasting convection and turbulence .",
            "id": "4093194",
            "problem": "You must write a complete, runnable program that, for each radiosonde profile given as pressure levels and temperature at those levels, converts the temperature profile $T(p)$ into a potential temperature profile $\\theta(z)$ by first mapping pressure $p$ to geometric height $z$ using the hypsometric equation derived from the hydrostatic balance and the Ideal Gas Law, and then computing a static stability measure $S(z)$ to classify each layer as statically stable, neutral, or unstable. The derivation must be based on the following fundamental starting points: hydrostatic balance, Ideal Gas Law, and dry adiabatic thermodynamics. Assume dry air so that virtual temperature equals actual temperature. Use a fixed reference pressure $p_0$ for potential temperature. Use a layerwise discretization that respects scientific realism for typical tropospheric conditions. \n\nYour program must adhere to these computational and output specifications:\n- Physical constants to use: dry air gas constant $R_d = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$, specific heat at constant pressure $c_p = 1004\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$, gravitational acceleration $g = 9.80665\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, and $\\kappa = R_d/c_p$. The potential temperature reference pressure is $p_0 = 100000\\,\\mathrm{Pa}$.\n- Units: pressure must be in $\\mathrm{Pa}$, temperature in $\\mathrm{K}$, geometric height in $\\mathrm{m}$, potential temperature in $\\mathrm{K}$, and the static stability measure $S(z)$ in $\\mathrm{K}\\,\\mathrm{m}^{-1}$. Report $S(z)$ rounded to six decimals.\n- Height computation: set the lowest level height to $z_1 = 0\\,\\mathrm{m}$ and compute successive heights via the hypsometric relationship applied layer-by-layer using the mean temperature of each layer.\n- Potential temperature computation: compute $\\theta$ at each level from $T$ and $p$.\n- Static stability measure definition for layer $i$ between levels $i$ and $i+1$: $S_i = \\Delta\\theta/\\Delta z$, with $\\Delta\\theta = \\theta_{i+1} - \\theta_i$ and $\\Delta z = z_{i+1} - z_i$. Use a classification tolerance $\\varepsilon = 0.001\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$ (which is $1\\,\\mathrm{K}\\,\\mathrm{km}^{-1}$) to account for numerical and representational limits. Classify each layer with the following rule: stable if $S_i  \\varepsilon$ (output integer $1$), neutral if $|S_i| \\le \\varepsilon$ (output integer $0$), and unstable if $S_i  -\\varepsilon$ (output integer $-1$).\n- Angle units are not applicable in this problem.\n\nTest suite (pressures $p$ in $\\mathrm{Pa}$ and temperatures $T$ in $\\mathrm{K}$):\n1. General tropospheric case (expected generally stable):\n   - $p = [100000, 90000, 80000, 70000]\\,\\mathrm{Pa}$,\n   - $T = [290.0, 283.0, 275.0, 268.0]\\,\\mathrm{K}$.\n2. Near-neutral dry-adiabatic case (constructed so that $\\theta$ is nearly constant):\n   - $p = [100000, 95000, 90000, 85000]\\,\\mathrm{Pa}$,\n   - $T = [300.000, 295.650, 291.105, 286.380]\\,\\mathrm{K}$.\n3. Surface-based superadiabatic case (expected unstable in the lowest layers):\n   - $p = [100000, 97500, 95000, 92500, 90000]\\,\\mathrm{Pa}$,\n   - $T = [305.000, 302.200, 297.900, 293.400, 291.000]\\,\\mathrm{K}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result must be a list of two lists: the first is the list of $S_i$ values for all layers in that case (floats rounded to six decimals, in $\\mathrm{K}\\,\\mathrm{m}^{-1}$), and the second is the list of the corresponding integer classifications for those layers using the rule above. For example, the overall output structure must be of the form $[\\,[\\,[S_0,S_1,\\dots],[C_0,C_1,\\dots]\\,],\\,\\dots\\,]$ with one such pair per test case, aggregated into a single outer list printed on one line.",
            "solution": "The problem is valid as it is scientifically grounded in established principles of atmospheric thermodynamics, is well-posed with a clear and complete set of definitions and constraints, and is expressed in objective, formal language. There are no contradictions, ambiguities, or factual inaccuracies. We may therefore proceed with a solution.\n\n### Theoretical Foundation\n\nThe solution is derived from three fundamental principles:\n\n1.  **Hydrostatic Balance:** In a static fluid, the upward pressure gradient force balances the downward gravitational force on a fluid parcel. This relationship is expressed as:\n    $$ \\frac{dp}{dz} = -\\rho g $$\n    where $p$ is pressure, $z$ is geometric height, $\\rho$ is air density, and $g$ is the acceleration due to gravity.\n\n2.  **Ideal Gas Law:** For dry air, the relationship between pressure, density, and temperature is given by:\n    $$ p = \\rho R_d T $$\n    where $R_d$ is the specific gas constant for dry air and $T$ is the temperature in Kelvin. We can express density as $\\rho = p / (R_d T)$.\n\n3.  **Potential Temperature:** The potential temperature, $\\theta$, is the temperature a parcel of air would attain if brought adiabatically to a reference pressure $p_0$. It is a conserved quantity for dry adiabatic processes and is defined as:\n    $$ \\theta = T \\left( \\frac{p_0}{p} \\right)^{\\kappa} $$\n    where $\\kappa = R_d/c_p$, with $c_p$ being the specific heat of dry air at constant pressure.\n\n### Derivation of the Hypsometric Equation\n\nTo relate pressure levels to geometric height, we combine the hydrostatic equation and the Ideal Gas Law. Substituting the expression for $\\rho$ from the Ideal Gas Law into the hydrostatic equation yields:\n$$ \\frac{dp}{dz} = -\\frac{p g}{R_d T} $$\nSeparating variables to solve for an increment in height, $dz$:\n$$ dz = -\\frac{R_d T}{g} \\frac{dp}{p} $$\nTo find the thickness of an atmospheric layer between two levels, $z_i$ and $z_{i+1}$, corresponding to pressures $p_i$ and $p_{i+1}$, we integrate this expression. Assuming the temperature $T$ can be approximated by the mean temperature of the layer, $\\bar{T}_i = (T_i + T_{i+1})/2$:\n$$ \\int_{z_i}^{z_{i+1}} dz = -\\frac{R_d \\bar{T}_i}{g} \\int_{p_i}^{p_{i+1}} \\frac{dp}{p} $$\n$$ z_{i+1} - z_i = -\\frac{R_d \\bar{T}_i}{g} [\\ln p]_{p_i}^{p_{i+1}} = -\\frac{R_d \\bar{T}_i}{g} (\\ln p_{i+1} - \\ln p_i) $$\nThe layer thickness, $\\Delta z_i = z_{i+1} - z_i$, is thus given by the hypsometric equation:\n$$ \\Delta z_i = \\frac{R_d \\bar{T}_i}{g} \\ln\\left(\\frac{p_i}{p_{i+1}}\\right) $$\nSince atmospheric pressure decreases with height, $p_i > p_{i+1}$, ensuring $\\ln(p_i/p_{i+1}) > 0$ and therefore $\\Delta z_i > 0$.\n\n### Static Stability Analysis\n\nThe static stability of a dry atmospheric layer is determined by the vertical gradient of potential temperature, $d\\theta/dz$.\n-   **Stable:** $d\\theta/dz > 0$. A vertically displaced parcel is forced back to its original level.\n-   **Neutral:** $d\\theta/dz = 0$. A vertically displaced parcel remains at its new level.\n-   **Unstable:** $d\\theta/dz  0$. A vertically displaced parcel accelerates away from its original level.\n\nThe problem requires a layer-wise analysis using a finite-difference approximation for the gradient. For the layer between levels $i$ and $i+1$, the static stability measure $S_i$ is defined as:\n$$ S_i = \\frac{\\Delta\\theta_i}{\\Delta z_i} = \\frac{\\theta_{i+1} - \\theta_i}{z_{i+1} - z_i} $$\nwhere $\\theta_i$ and $\\theta_{i+1}$ are the potential temperatures at levels $i$ and $i+1$, and $\\Delta z_i$ is the layer thickness computed previously.\n\n### Computational Algorithm\n\nFor each given atmospheric profile ($p_{levels}, T_{levels}$):\n\n1.  **Constants and Initialization:**\n    - Define physical constants: $g = 9.80665\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, $R_d = 287\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$, $c_p = 1004\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}\\,\\mathrm{K}^{-1}$, $p_0 = 100000\\,\\mathrm{Pa}$.\n    - Calculate $\\kappa = R_d/c_p$.\n    - Set the classification tolerance $\\varepsilon = 0.001\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$.\n    - Let $N$ be the number of levels in the profile. Initialize an array `z_levels` of size $N$ with $z_{levels}[0] = 0.0$.\n    - Initialize empty lists `s_values` and `classifications` to store results for the layers.\n\n2.  **Calculate Potential Temperature Profile:**\n    - Create an array `theta_levels` of size $N$.\n    - For each level $i$ from $0$ to $N-1$, compute $\\theta_i = T_{levels}[i] \\left( p_0 / p_{levels}[i] \\right)^{\\kappa}$ and store it in `theta_levels`.\n\n3.  **Iterate Through Layers:**\n    - Loop for each layer $i$ from $0$ to $N-2$.\n    - **a. Compute Layer Thickness $\\Delta z_i$**:\n        - Calculate the mean temperature of the layer: $\\bar{T}_i = (T_{levels}[i] + T_{levels}[i+1]) / 2$.\n        - Compute $\\Delta z_i = (R_d \\bar{T}_i / g) \\ln(p_{levels}[i] / p_{levels}[i+1])$.\n    - **b. Update Height Profile**:\n        - Compute the height of the next level: $z_{levels}[i+1] = z_{levels}[i] + \\Delta z_i$.\n    - **c. Compute Stability Measure $S_i$**:\n        - Calculate the potential temperature difference: $\\Delta\\theta_i = \\theta_{levels}[i+1] - \\theta_{levels}[i]$.\n        - Compute $S_i = \\Delta\\theta_i / \\Delta z_i$.\n        - Append the rounded value `round(S_i, 6)` to the `s_values` list.\n    - **d. Classify Layer Stability**:\n        - If $S_i > \\varepsilon$, append $1$ (stable) to `classifications`.\n        - If $S_i  -\\varepsilon$, append $-1$ (unstable) to `classifications`.\n        - Otherwise ($|S_i| \\le \\varepsilon$), append $0$ (neutral) to `classifications`.\n\n4.  **Format Output:**\n    - Aggregate the `s_values` and `classifications` lists into the specified nested list structure for the current test case.\n    - Repeat for all test cases and format the final results into a single output string as required.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and classifies static stability for given atmospheric profiles.\n    \"\"\"\n    # Physical constants\n    R_d = 287.0  # J kg^-1 K^-1\n    c_p = 1004.0 # J kg^-1 K^-1\n    g = 9.80665 # m s^-2\n    p_0 = 100000.0 # Pa\n    kappa = R_d / c_p\n    epsilon = 0.001 # K m^-1, classification tolerance\n\n    # Test suite\n    test_cases = [\n        # Case 1: General tropospheric case\n        (\n            np.array([100000.0, 90000.0, 80000.0, 70000.0]),\n            np.array([290.0, 283.0, 275.0, 268.0])\n        ),\n        # Case 2: Near-neutral dry-adiabatic case\n        (\n            np.array([100000.0, 95000.0, 90000.0, 85000.0]),\n            np.array([300.000, 295.650, 291.105, 286.380])\n        ),\n        # Case 3: Surface-based superadiabatic case\n        (\n            np.array([100000.0, 97500.0, 95000.0, 92500.0, 90000.0]),\n            np.array([305.000, 302.200, 297.900, 293.400, 291.000])\n        )\n    ]\n\n    all_results_str = []\n\n    for p_levels, t_levels in test_cases:\n        num_levels = len(p_levels)\n        s_values = []\n        classifications = []\n\n        # Step 1: Compute potential temperature at all levels\n        theta_levels = t_levels * (p_0 / p_levels)**kappa\n\n        # Step 2: Initialize height profile\n        z_levels = np.zeros(num_levels)\n        z_levels[0] = 0.0\n\n        # Step 3: Iterate through layers to compute heights, stability, and classify\n        for i in range(num_levels - 1):\n            # Get data for the layer between level i and i+1\n            p_i, p_i_plus_1 = p_levels[i], p_levels[i+1]\n            t_i, t_i_plus_1 = t_levels[i], t_levels[i+1]\n            theta_i, theta_i_plus_1 = theta_levels[i], theta_levels[i+1]\n            \n            # Compute layer thickness using the hypsometric equation\n            t_mean = (t_i + t_i_plus_1) / 2.0\n            delta_z = (R_d * t_mean / g) * np.log(p_i / p_i_plus_1)\n            \n            # Compute height of the next level\n            z_levels[i+1] = z_levels[i] + delta_z\n\n            # Compute static stability measure S_i for the layer\n            delta_theta = theta_i_plus_1 - theta_i\n            s_i = delta_theta / delta_z\n            s_values.append(s_i)\n\n            # Classify the layer\n            if s_i  epsilon:\n                classifications.append(1)  # Stable\n            elif s_i  -epsilon:\n                classifications.append(-1) # Unstable\n            else:\n                classifications.append(0)  # Neutral\n        \n        # Format the results for the current case\n        s_str = f\"[{','.join(f'{s:.6f}' for s in s_values)}]\"\n        c_str = f\"[{','.join(map(str, classifications))}]\"\n        case_result_str = f\"[{s_str},{c_str}]\"\n        all_results_str.append(case_result_str)\n\n    # Final print statement in the exact required format\n    final_output = f\"[{','.join(all_results_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "While static stability indicates the atmosphere's resistance to vertical motion, it does not tell the whole story. The presence of vertical wind shear can generate turbulence even in a stratified fluid. This exercise introduces the Richardson number ($Ri$), a dimensionless parameter that quantifies the critical balance between buoyant stability and shear production of turbulence. By deriving and calculating both gradient and bulk Richardson numbers for a nocturnal boundary layer, you will gain insight into a key mechanism governing the transition between laminar and turbulent flow .",
            "id": "4093164",
            "problem": "A horizontally homogeneous nocturnal boundary layer over flat terrain is observed between the surface and a top-of-layer height of $100\\,\\mathrm{m}$. Moisture effects are negligible, and the potential temperature equals the virtual potential temperature. The reference potential temperature is $\\theta_{0}=300\\,\\mathrm{K}$, and the gravitational acceleration is $g=9.81\\,\\mathrm{m\\,s^{-2}}$. Over the $100\\,\\mathrm{m}$ layer, the potential temperature increases by $\\Delta \\theta = 3\\,\\mathrm{K}$, and the mean wind speed increases by $\\Delta U = 8\\,\\mathrm{m\\,s^{-1}}$. At $z=50\\,\\mathrm{m}$, the local streamwise shear is measured as $\\partial U/\\partial z = 0.02\\,\\mathrm{s^{-1}}$, and the cross-stream shear is negligible so that $\\partial V/\\partial z \\approx 0$.\n\nStarting from the Turbulence Kinetic Energy (TKE) budget under the Boussinesq approximation and the definition of static stability via the squared Brunt–Väisälä frequency, derive expressions for the gradient Richardson number $Ri$ and the bulk Richardson number $Ri_{b}$ in terms of the given quantities. Then, use the derived expressions to compute $Ri$ at $z=50\\,\\mathrm{m}$ and $Ri_{b}$ for the full $0$–$100\\,\\mathrm{m}$ layer. In your reasoning, assess the stability regime by comparing the computed values with commonly used critical thresholds for the suppression of shear-driven turbulence in atmospheric flows.\n\nReport the two dimensionless numbers $Ri$ and $Ri_{b}$ as decimals, and round each to three significant figures. No units should be included in the final reported values.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of atmospheric fluid dynamics, well-posed with all necessary information provided, and objective in its formulation.\n\nThe first step is to derive the expression for the gradient Richardson number, $Ri$. This derivation starts from the budget for Turbulent Kinetic Energy (TKE), $\\bar{e}$, which, for a horizontally homogeneous flow under the Boussinesq approximation, can be written as:\n$$\n\\frac{D\\bar{e}}{Dt} = P + B - \\epsilon + T\n$$\nHere, $P$ is the shear production rate, $B$ is the buoyant production/destruction rate, $\\epsilon$ is the viscous dissipation rate, and $T$ is the transport term. The two terms relevant for stability are the shear production and buoyant production/destruction of turbulence.\n\nThe shear production term is given by $P = -\\overline{u'w'}\\frac{\\partial U}{\\partial z} - \\overline{v'w'}\\frac{\\partial V}{\\partial z}$, where $(U, V)$ are the mean horizontal wind components and $(u', v', w')$ are the turbulent velocity fluctuations. The buoyant production term is $B = \\frac{g}{\\theta_0}\\overline{w'\\theta_v'}$, where $g$ is the gravitational acceleration, $\\theta_0$ is a reference potential temperature, and $\\theta_v'$ is the fluctuation in virtual potential temperature. Since the problem states that moisture effects are negligible, the potential temperature $\\theta$ is equal to the virtual potential temperature $\\theta_v$. In a stably stratified environment, where potential temperature increases with height, $\\overline{w'\\theta'}$ is negative (upward moving parcels are cooler, downward moving parcels are warmer), so $B$ is negative, representing a destruction of TKE.\n\nUsing first-order closure (K-theory), the turbulent fluxes are parameterized as:\n$$\n-\\overline{u'w'} = K_m \\frac{\\partial U}{\\partial z}\n$$\n$$\n-\\overline{v'w'} = K_m \\frac{\\partial V}{\\partial z}\n$$\n$$\n-\\overline{w'\\theta'} = K_h \\frac{\\partial \\theta}{\\partial z}\n$$\nwhere $K_m$ and $K_h$ are the eddy viscosity and eddy diffusivity for heat, respectively.\n\nSubstituting these into the expressions for $P$ and $B$ gives:\n$$\nP = K_m \\left[ \\left(\\frac{\\partial U}{\\partial z}\\right)^2 + \\left(\\frac{\\partial V}{\\partial z}\\right)^2 \\right]\n$$\n$$\nB = -\\frac{g}{\\theta_0} K_h \\frac{\\partial \\theta}{\\partial z}\n$$\nThe gradient Richardson number, $Ri$, is defined as the ratio of buoyant destruction to shear production of TKE, assuming that the turbulent Prandtl number $Pr_t = K_m/K_h$ is equal to $1$. It is the ratio of the term for buoyant stability to the term for shear instability.\n$$\nRi = \\frac{-B}{P} \\bigg|_{K_m=K_h} = \\frac{\\frac{g}{\\theta_0} K_h \\frac{\\partial \\theta}{\\partial z}}{K_m \\left[ \\left(\\frac{\\partial U}{\\partial z}\\right)^2 + \\left(\\frac{\\partial V}{\\partial z}\\right)^2 \\right]} = \\frac{\\frac{g}{\\theta_0} \\frac{\\partial \\theta}{\\partial z}}{\\left(\\frac{\\partial U}{\\partial z}\\right)^2 + \\left(\\frac{\\partial V}{\\partial z}\\right)^2}\n$$\nThe term in the numerator is the squared Brunt–Väisälä frequency, $N^2$, which is the primary measure of static stability:\n$$\nN^2 = \\frac{g}{\\theta_0} \\frac{\\partial \\theta}{\\partial z}\n$$\nThe term in the denominator is the squared magnitude of the vertical wind shear, $S^2 = \\left(\\frac{\\partial U}{\\partial z}\\right)^2 + \\left(\\frac{\\partial V}{\\partial z}\\right)^2$. Thus, the expression for the gradient Richardson number is:\n$$\nRi = \\frac{N^2}{S^2}\n$$\nTo compute $Ri$ at $z=50\\,\\mathrm{m}$, we use the provided data. We assume that the potential temperature gradient is constant throughout the layer, so $\\frac{\\partial \\theta}{\\partial z} \\approx \\frac{\\Delta \\theta}{\\Delta z}$.\nGiven: $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $\\theta_0 = 300\\,\\mathrm{K}$, $\\Delta \\theta = 3\\,\\mathrm{K}$, and the layer height is $\\Delta z = 100\\,\\mathrm{m}$.\nFirst, we calculate $N^2$:\n$$\nN^2 \\approx \\frac{g}{\\theta_0} \\frac{\\Delta \\theta}{\\Delta z} = \\frac{9.81\\,\\mathrm{m\\,s^{-2}}}{300\\,\\mathrm{K}} \\frac{3\\,\\mathrm{K}}{100\\,\\mathrm{m}} = 0.000981\\,\\mathrm{s^{-2}}\n$$\nAt $z=50\\,\\mathrm{m}$, the shear components are given as $\\frac{\\partial U}{\\partial z} = 0.02\\,\\mathrm{s^{-1}}$ and $\\frac{\\partial V}{\\partial z} \\approx 0$. The squared shear is:\n$$\nS^2 = (0.02\\,\\mathrm{s^{-1}})^2 + (0)^2 = 0.0004\\,\\mathrm{s^{-2}}\n$$\nNow, we can compute the gradient Richardson number:\n$$\nRi = \\frac{N^2}{S^2} = \\frac{0.000981\\,\\mathrm{s^{-2}}}{0.0004\\,\\mathrm{s^{-2}}} = 2.4525\n$$\nRounding to three significant figures, $Ri \\approx 2.45$.\n\nNext, we derive the expression for the bulk Richardson number, $Ri_b$. This is a finite-difference form of the gradient Richardson number, evaluated over a discrete layer. The derivatives are replaced by finite differences over the layer depth $\\Delta z$:\n$$\n\\frac{\\partial \\theta}{\\partial z} \\rightarrow \\frac{\\Delta \\theta}{\\Delta z}\n$$\n$$\n\\left(\\frac{\\partial U}{\\partial z}\\right)^2 + \\left(\\frac{\\partial V}{\\partial z}\\right)^2 \\rightarrow \\frac{(\\Delta U)^2 + (\\Delta V)^2}{(\\Delta z)^2}\n$$\nSubstituting these into the expression for $Ri$ gives the bulk Richardson number:\n$$\nRi_b = \\frac{\\frac{g}{\\theta_0}\\frac{\\Delta \\theta}{\\Delta z}}{\\frac{(\\Delta U)^2 + (\\Delta V)^2}{(\\Delta z)^2}} = \\frac{g}{\\theta_0}\\frac{\\Delta \\theta \\Delta z}{(\\Delta U)^2 + (\\Delta V)^2}\n$$\nTo compute $Ri_b$ for the $0-100\\,\\mathrm{m}$ layer, we use the given bulk quantities: $\\Delta \\theta = 3\\,\\mathrm{K}$, $\\Delta z = 100\\,\\mathrm{m}$, and $\\Delta U = 8\\,\\mathrm{m\\,s^{-1}}$. Since the cross-stream shear is negligible, we assume the change in the cross-stream wind component $\\Delta V$ is zero.\n$$\nRi_b = \\frac{(9.81\\,\\mathrm{m\\,s^{-2}})(3\\,\\mathrm{K})(100\\,\\mathrm{m})}{(300\\,\\mathrm{K})((8\\,\\mathrm{m\\,s^{-1}})^2 + 0^2)} = \\frac{2943}{300 \\times 64} = \\frac{2943}{19200} \\approx 0.15328125\n$$\nRounding to three significant figures, $Ri_b \\approx 0.153$.\n\nFinally, we assess the stability regime. A critical Richardson number, $Ri_c = 0.25$, is commonly used as a threshold for the existence of turbulence.\nFor the local conditions at $z=50\\,\\mathrm{m}$, the calculated gradient Richardson number is $Ri \\approx 2.45$. This value is significantly greater than $Ri_c = 0.25$. When $Ri > 0.25$, the stable stratification is strong enough to overcome shear, leading to the suppression and decay of turbulence. A value of $Ri > 1$ is often considered a condition for absolute dynamic stability, where linear perturbations cannot grow. Therefore, the flow at $z=50\\,\\mathrm{m}$ is very stable and likely laminar.\nFor the layer as a whole, the calculated bulk Richardson number is $Ri_b \\approx 0.153$. This value is less than $Ri_c = 0.25$, suggesting that the overall shear across the layer is sufficient to potentially generate and sustain turbulence against the overall stratification.\nThe disparity between $Ri$ and $Ri_b$ indicates that the wind shear and/or temperature gradient are not uniform throughout the layer. While the layer-averaged conditions are favorable for turbulence, there are regions within the layer, such as at $z=50\\,\\mathrm{m}$, that are locally very stable. This is a characteristic feature of nocturnal stable boundary layers, where intermittent turbulence may occur in regions of low local $Ri$ even if other regions are quiescent.\n\nThe two requested dimensionless numbers are $Ri$ and $Ri_b$.\n$Ri$ at $z=50\\,\\mathrm{m}$ is $2.45$.\n$Ri_b$ for the $0-100\\,\\mathrm{m}$ layer is $0.153$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.45  0.153\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from local turbulence to large-scale weather systems, we encounter instabilities driven by the fundamental structure of the atmosphere on a rotating planet. This advanced practice delves into baroclinic instability, the primary mechanism for the growth of mid-latitude cyclones, using the powerful framework of quasigeostrophic (QG) theory. You will derive the meridional gradient of QG potential vorticity ($q_y$) and implement a numerical model to identify regions where the Charney-Stern necessary condition for instability is met, providing a direct link between theory and the genesis of synoptic-scale weather .",
            "id": "4093209",
            "problem": "You are given a zonally symmetric, continuously stratified basic state for midlatitude dynamics on a beta-plane in the framework of Quasigeostrophic (QG) theory. The basic-state zonal wind is specified as a function $U(y,z)$, and the static stability is specified through the Brunt–Väisälä frequency $N(z)$. Your objective is to derive, implement, and evaluate the meridional gradient of the mean QG potential vorticity and identify regions susceptible to baroclinic instability using the Charney–Stern necessary condition.\n\nFundamental base to be used:\n- Geostrophic balance relating the geostrophic zonal wind $U$ to the geostrophic streamfunction $\\psi$: $U = -\\partial \\psi / \\partial y$.\n- Hydrostatic balance and the definition of static stability via the Brunt–Väisälä frequency: $N^2 = (g/\\theta)\\,\\partial \\theta/\\partial z$, where $g$ is gravity and $\\theta$ is potential temperature.\n- The QG mean-state potential vorticity for a continuously stratified fluid on a beta-plane: $q = \\nabla^2 \\psi + \\partial/\\partial z \\left( (f_0^2/N^2)\\, \\partial \\psi/\\partial z \\right) + \\beta\\, y$, where $f_0$ is a constant Coriolis parameter and $\\beta$ is the meridional gradient of planetary vorticity.\n\nTasks:\n1. Starting from the listed fundamental base and without invoking any shortcut formulas, derive the expression for the meridional gradient of the mean QG potential vorticity $q_y$ in terms of the basic-state fields $U(y,z)$ and $N(z)$.\n2. Implement a numerical algorithm using second-order accurate centered differences in the interior (and consistent one-sided differences at the boundaries) on a rectangular $(y,z)$ grid to compute $q_y(y,z)$.\n3. Identify regions susceptible to baroclinic instability according to the Charney–Stern necessary condition. For this problem, declare a grid point $(y,z)$ “susceptible” if $q_y(y,z)\\,\\beta  0$, and $N^2(z)  0$. Also, declare the necessary condition “satisfied” if there exists at least one sign change in $q_y$ within the domain, i.e., $\\min(q_y)  0$ and $\\max(q_y)  0$ over the $(y,z)$ grid.\n4. For each test case specified below, compute:\n   - A boolean indicating whether the Charney–Stern necessary condition is satisfied.\n   - The fraction of grid points that are “susceptible” as defined above, expressed as a decimal in $[0,1]$.\n\nGrid, units, and numerics:\n- Use a uniform meridional grid $y \\in [-1.5\\times 10^6,\\, +1.5\\times 10^6]$ with $601$ points (units: meters).\n- Use a uniform vertical grid $z \\in [0,\\, 1.5\\times 10^4]$ with $301$ points (units: meters).\n- All wind speeds $U$ are in meters per second, $N$ is in inverse seconds, $f_0$ is in inverse seconds, and $\\beta$ is in inverse seconds per meter. The computed $q_y$ has units of inverse seconds per meter.\n- The final reported fraction is unitless and must be printed as a decimal rounded to six digits after the decimal point.\n\nTest suite:\nFor each case, the basic-state fields are defined by:\n- $U(y,z) = U_0 \\exp\\left(- (y/L_y)^2 \\right) + S_z\\, z + U_{\\mathrm{bar}}$, where $U_0$ is the jet peak speed, $L_y$ is the jet half-width scale, $S_z$ is a constant vertical shear (units: inverse seconds), and $U_{\\mathrm{bar}}$ is a constant background flow (meters per second).\n- $N(z) = N_0 + \\Delta N \\times \\left( \\tfrac{1}{2} \\right) \\left[ 1 + \\tanh\\left( (z - z_t)/H_t \\right) \\right]$, where $N_0$ is the lower-troposphere value, $\\Delta N$ sets the increase across the tropopause centered at $z_t$ with transition half-thickness $H_t$.\n\nUse the following four test cases:\n- Case 1 (typical midlatitude jet with strong vertical shear and marked tropopause transition):\n  - $U_0 = 40$, $L_y = 9\\times 10^5$, $S_z = -7\\times 10^{-4}$, $U_{\\mathrm{bar}} = 0$, $N_0 = 0.010$, $\\Delta N = 0.010$, $z_t = 1.1\\times 10^4$, $H_t = 2.0\\times 10^3$, $f_0 = 1.0\\times 10^{-4}$, $\\beta = 1.6\\times 10^{-11}$.\n- Case 2 (weaker jet and weaker vertical shear with strong static stability):\n  - $U_0 = 20$, $L_y = 9\\times 10^5$, $S_z = -1\\times 10^{-4}$, $U_{\\mathrm{bar}} = 0$, $N_0 = 0.015$, $\\Delta N = 0.015$, $z_t = 1.0\\times 10^4$, $H_t = 3.0\\times 10^3$, $f_0 = 1.0\\times 10^{-4}$, $\\beta = 1.8\\times 10^{-11}$.\n- Case 3 (smaller $\\beta$ representative of near-subtropics with moderate vertical shear):\n  - $U_0 = 35$, $L_y = 8\\times 10^5$, $S_z = -6\\times 10^{-4}$, $U_{\\mathrm{bar}} = 0$, $N_0 = 0.009$, $\\Delta N = 0.009$, $z_t = 1.2\\times 10^4$, $H_t = 2.5\\times 10^3$, $f_0 = 7.0\\times 10^{-5}$, $\\beta = 4.0\\times 10^{-12}$.\n- Case 4 (nearly uniform flow and constant static stability):\n  - $U_0 = 30$, $L_y = 5.0\\times 10^6$, $S_z = 0$, $U_{\\mathrm{bar}} = 0$, $N_0 = 0.012$, $\\Delta N = 0.000$, $z_t = 1.0\\times 10^4$, $H_t = 3.0\\times 10^3$, $f_0 = 1.0\\times 10^{-4}$, $\\beta = 1.6\\times 10^{-11}$.\n\nProgram output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must be flattened in the order of the test cases, with each case contributing first the boolean for the Charney–Stern condition, then the susceptible fraction rounded to six decimal places. For example, an output across four cases should look like $[{\\mathrm{bool}_1},{\\mathrm{frac}_1},{\\mathrm{bool}_2},{\\mathrm{frac}_2},{\\mathrm{bool}_3},{\\mathrm{frac}_3},{\\mathrm{bool}_4},{\\mathrm{frac}_4}]$.",
            "solution": "The user has provided a well-posed problem in geophysical fluid dynamics concerning baroclinic instability within the quasigeostrophic (QG) framework. The problem is scientifically grounded, free of contradictions, and contains all necessary information for a unique solution. I will proceed with the derivation and numerical implementation.\n\n### Step 1: Validation of the Problem Statement\n\n**Givens Extraction:**\n-   **Theory:** Quasigeostrophic (QG) theory on a midlatitude beta-plane, zonally symmetric, continuously stratified basic state.\n-   **Basic-State Zonal Wind:** $U(y,z) = U_0 \\exp\\left(- (y/L_y)^2 \\right) + S_z\\, z + U_{\\mathrm{bar}}$.\n-   **Brunt–Väisälä Frequency:** $N(z) = N_0 + \\Delta N \\times \\left( \\tfrac{1}{2} \\right) \\left[ 1 + \\tanh\\left( (z - z_t)/H_t \\right) \\right]$.\n-   **QG Potential Vorticity (PV):** $q = \\nabla^2 \\psi + \\partial/\\partial z \\left( (f_0^2/N^2)\\, \\partial \\psi/\\partial z \\right) + \\beta\\, y$.\n-   **Geostrophic Balance:** $U = -\\partial \\psi / \\partial y$.\n-   **Grid Description:**\n    -   Meridional: $y \\in [-1.5\\times 10^6, +1.5\\times 10^6]\\,$m, $601$ points.\n    -   Vertical: $z \\in [0, 1.5\\times 10^4]\\,$m, $301$ points.\n-   **Numerical Scheme:** Second-order accurate centered differences in the interior, consistent one-sided differences at boundaries.\n-   **Stability Condition (Charney–Stern):**\n    -   \"Susceptible\" point: $q_y(y,z)\\,\\beta  0$ and $N^2(z)  0$.\n    -   Condition \"satisfied\": $\\min(q_y)  0$ and $\\max(q_y)  0$.\n-   **Test Cases:** Four sets of parameters $\\{U_0, L_y, S_z, U_{\\mathrm{bar}}, N_0, \\Delta N, z_t, H_t, f_0, \\beta\\}$ are provided.\n-   **Output Requirement:** For each case, a boolean for the satisfied condition and the susceptible fraction (decimal rounded to $6$ places).\n\n**Validation Verdict:**\nThe problem is **valid**. It is scientifically grounded in the established theory of quasigeostrophic dynamics. The equations and definitions are standard. The problem is well-posed, with sufficient information to derive the required expression and perform the numerical computation for the specified test cases. The parameters provided are physically plausible, though some (like negative vertical shear) represent less-common but physically valid scenarios that test the stability criteria robustly. The tasks are clear, objective, and non-trivial.\n\n### Step 2: Derivation of the Meridional Gradient of Mean QG Potential Vorticity\n\nThe objective is to derive an expression for $q_y = \\partial q / \\partial y$ from the given definition of the mean QG potential vorticity, $q$.\nThe mean QG potential vorticity is:\n$$q(y,z) = \\nabla^2 \\psi + \\frac{\\partial}{\\partial z} \\left( \\frac{f_0^2}{N^2} \\frac{\\partial \\psi}{\\partial z} \\right) + \\beta y$$\nThe Laplacian for a zonally symmetric state ($\\partial/\\partial x = 0$) is $\\nabla^2 = \\partial^2/\\partial y^2$.\n$$q(y,z) = \\frac{\\partial^2 \\psi}{\\partial y^2} + \\frac{\\partial}{\\partial z} \\left( \\frac{f_0^2}{N^2} \\frac{\\partial \\psi}{\\partial z} \\right) + \\beta y$$\nWe now compute the meridional derivative, $\\partial/\\partial y$, of each term.\n\n1.  **First Term:** $\\frac{\\partial}{\\partial y} \\left( \\frac{\\partial^2 \\psi}{\\partial y^2} \\right) = \\frac{\\partial^3 \\psi}{\\partial y^3}$.\n    Using the geostrophic wind relation, $U = -\\partial \\psi / \\partial y$, we can express this in terms of $U$.\n    $$\\frac{\\partial^3 \\psi}{\\partial y^3} = \\frac{\\partial^2}{\\partial y^2} \\left(\\frac{\\partial \\psi}{\\partial y}\\right) = \\frac{\\partial^2}{\\partial y^2}(-U) = -\\frac{\\partial^2 U}{\\partial y^2}$$\n\n2.  **Second Term:** $\\frac{\\partial}{\\partial y} \\left[ \\frac{\\partial}{\\partial z} \\left( \\frac{f_0^2}{N^2} \\frac{\\partial \\psi}{\\partial z} \\right) \\right]$.\n    Since $y$ and $z$ are independent coordinates, and the streamfunction $\\psi$ is assumed to be sufficiently smooth, we can interchange the order of differentiation.\n    $$ \\frac{\\partial}{\\partial z} \\left[ \\frac{\\partial}{\\partial y} \\left( \\frac{f_0^2}{N^2} \\frac{\\partial \\psi}{\\partial z} \\right) \\right] $$\n    The Coriolis parameter $f_0$ is constant, and the static stability $N$ is a function of $z$ only, $N = N(z)$. Therefore, the term $f_0^2/N^2$ can be moved outside the $\\partial/\\partial y$ operator.\n    $$ \\frac{\\partial}{\\partial z} \\left[ \\frac{f_0^2}{N(z)^2} \\frac{\\partial}{\\partial y} \\left( \\frac{\\partial \\psi}{\\partial z} \\right) \\right] $$\n    Again, interchanging the order of differentiation for $\\psi$:\n    $$ \\frac{\\partial}{\\partial z} \\left[ \\frac{f_0^2}{N(z)^2} \\frac{\\partial}{\\partial z} \\left( \\frac{\\partial \\psi}{\\partial y} \\right) \\right] $$\n    Substituting $\\partial \\psi / \\partial y = -U$:\n    $$ \\frac{\\partial}{\\partial z} \\left[ \\frac{f_0^2}{N(z)^2} \\frac{\\partial}{\\partial z} (-U) \\right] = - \\frac{\\partial}{\\partial z} \\left( \\frac{f_0^2}{N(z)^2} \\frac{\\partial U}{\\partial z} \\right) $$\n\n3.  **Third Term:** $\\frac{\\partial}{\\partial y} (\\beta y)$.\n    The planetary vorticity gradient $\\beta$ is a constant.\n    $$\\frac{\\partial}{\\partial y}(\\beta y) = \\beta$$\n\nCombining the three terms, we obtain the final expression for the meridional gradient of the mean QG potential vorticity:\n$$q_y(y,z) = \\beta - \\frac{\\partial^2 U}{\\partial y^2} - \\frac{\\partial}{\\partial z} \\left( \\frac{f_0^2}{N(z)^2} \\frac{\\partial U}{\\partial z} \\right)$$\n\n### Step 3: Numerical Implementation and Stability Analysis\n\nThe derived expression for $q_y$ will be evaluated numerically on the specified grid.\n\n**Numerical Discretization:**\nWe define a rectangular grid $(y_j, z_i)$ for $j=0, \\dots, N_y-1$ and $i=0, \\dots, N_z-1$. The grid spacings are $\\Delta y$ and $\\Delta z$. All partial derivatives are approximated using finite differences. To comply with the requirement for second-order accuracy, we employ second-order finite difference stencils for both interior and boundary points.\n\nA function $g(x)$ defined on a uniform grid $x_k$ with spacing $\\Delta x$ has its first derivative $g'(x_k)$ approximated as:\n-   **Central difference (interior points, $1 \\le k \\le N-2$):**\n    $$ g'(x_k) \\approx \\frac{g(x_{k+1}) - g(x_{k-1})}{2\\Delta x} $$\n-   **Forward difference (first point, $k=0$):**\n    $$ g'(x_0) \\approx \\frac{-3g(x_0) + 4g(x_1) - g(x_2)}{2\\Delta x} $$\n-   **Backward difference (last point, $k=N-1$):**\n    $$ g'(x_{N-1}) \\approx \\frac{3g(x_{N-1}) - 4g(x_{N-2}) + g(x_{N-3})}{2\\Delta x} $$\n\nThe term $\\partial^2 U / \\partial y^2$ is computed by applying this numerical differentiation scheme twice. First, we compute $U_y = \\partial U / \\partial y$ across the grid, then we compute $U_{yy} = \\partial U_y / \\partial y$.\n\n**Algorithm:**\n1.  Construct the uniform grids for $y$ and $z$ with $N_y=601$ and $N_z=301$ points, respectively. Calculate step sizes $\\Delta y$ and $\\Delta z$.\n2.  For each test case, define the physical parameters.\n3.  Generate a 2D mesh and evaluate the basic-state zonal wind $U(y,z)$ on this grid.\n4.  Evaluate the basic-state Brunt-Väisälä frequency $N(z)$ on the vertical grid.\n5.  Numerically compute the partial derivatives required for $q_y$:\n    a. Compute $U_z = \\partial U / \\partial z$ using the second-order accurate scheme along the $z$-axis.\n    b. Compute $U_y = \\partial U / \\partial y$ using the second-order accurate scheme along the $y$-axis.\n    c. Compute $U_{yy} = \\partial U_y / \\partial y$ by applying the scheme again to $U_y$ along the $y$-axis.\n6.  Construct the intermediate field $F(y, z) = \\frac{f_0^2}{N(z)^2} U_z(y, z)$.\n7.  Numerically compute $F_z = \\partial F / \\partial z$ using the second-order accurate scheme along the $z$-axis.\n8.  Assemble the final field for the PV gradient: $q_y = \\beta - U_{yy} - F_z$.\n\n**Stability Analysis:**\nOnce the 2D field $q_y(y,z)$ is computed, the Charney-Stern necessary condition for instability is evaluated.\n1.  **Condition Satisfied:** The condition is met if $q_y$ changes sign anywhere in the domain. Given that all test cases use a positive $\\beta$, the dominant value of $q_y$ is expected to be positive. A sign change implies that $q_y$ becomes negative in some region. We test this by checking if $\\min(q_y)  0$ and $\\max(q_y)  0$.\n2.  **Susceptible Fraction:** A grid point $(y,z)$ is deemed \"susceptible\" to baroclinic instability if $q_y(y,z)\\,\\beta  0$. Since $\\beta  0$ for all test cases, this simplifies to finding regions where $q_y(y,z)  0$. The condition $N^2(z)  0$ is also required, but the provided formula for $N(z)$ with the given parameters ensures $N(z)$ is strictly positive, so $N^2(z)0$ is always satisfied. The fraction is the total count of susceptible points divided by the total number of grid points, $N_y \\times N_z$.\n\nThis procedure is then repeated for all four test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the baroclinic instability problem based on QG theory.\n    \"\"\"\n\n    def gradient_2nd_order(f, dx, axis):\n        \"\"\"\n        Computes the gradient of a 2D array using second-order accurate stencils\n        for both interior and boundary points.\n        \"\"\"\n        df = np.zeros_like(f)\n        if axis == 1:  # Derivative along y-axis\n            # Central difference for interior\n            df[:, 1:-1] = (f[:, 2:] - f[:, :-2]) / (2 * dx)\n            # Second-order forward difference for the first point\n            df[:, 0] = (-3 * f[:, 0] + 4 * f[:, 1] - f[:, 2]) / (2 * dx)\n            # Second-order backward difference for the last point\n            df[:, -1] = (3 * f[:, -1] - 4 * f[:, -2] + f[:, -3]) / (2 * dx)\n        elif axis == 0:  # Derivative along z-axis\n            # Central difference for interior\n            df[1:-1, :] = (f[2:, :] - f[:-2, :]) / (2 * dx)\n            # Second-order forward difference for the first point\n            df[0, :] = (-3 * f[0, :] + 4 * f[1, :] - f[2, :]) / (2 * dx)\n            # Second-order backward difference for the last point\n            df[-1, :] = (3 * f[-1, :] - 4 * f[-2, :] + f[-3, :]) / (2 * dx)\n        return df\n\n    # Grid definition\n    ny = 601\n    nz = 301\n    y_min, y_max = -1.5e6, 1.5e6\n    z_min, z_max = 0, 1.5e4\n\n    y = np.linspace(y_min, y_max, ny)\n    z = np.linspace(z_min, z_max, nz)\n    dy = y[1] - y[0]\n    dz = z[1] - z[0]\n\n    # `indexing='ij'` ensures z corresponds to axis 0 and y to axis 1\n    Z, Y = np.meshgrid(z, y, indexing='ij')\n\n    # Test suite\n    test_cases = [\n        # Case 1\n        {'U0': 40.0, 'Ly': 9e5, 'Sz': -7e-4, 'Ubar': 0.0, 'N0': 0.010,\n         'dN': 0.010, 'zt': 1.1e4, 'Ht': 2.0e3, 'f0': 1.0e-4, 'beta': 1.6e-11},\n        # Case 2\n        {'U0': 20.0, 'Ly': 9e5, 'Sz': -1e-4, 'Ubar': 0.0, 'N0': 0.015,\n         'dN': 0.015, 'zt': 1.0e4, 'Ht': 3.0e3, 'f0': 1.0e-4, 'beta': 1.8e-11},\n        # Case 3\n        {'U0': 35.0, 'Ly': 8e5, 'Sz': -6e-4, 'Ubar': 0.0, 'N0': 0.009,\n         'dN': 0.009, 'zt': 1.2e4, 'Ht': 2.5e3, 'f0': 7.0e-5, 'beta': 4.0e-12},\n        # Case 4\n        {'U0': 30.0, 'Ly': 5.0e6, 'Sz': 0.0, 'Ubar': 0.0, 'N0': 0.012,\n         'dN': 0.000, 'zt': 1.0e4, 'Ht': 3.0e3, 'f0': 1.0e-4, 'beta': 1.6e-11},\n    ]\n\n    results = []\n    for params in test_cases:\n        # Unpack parameters\n        U0 = params['U0']\n        Ly = params['Ly']\n        Sz = params['Sz']\n        Ubar = params['Ubar']\n        N0 = params['N0']\n        dN = params['dN']\n        zt = params['zt']\n        Ht = params['Ht']\n        f0 = params['f0']\n        beta = params['beta']\n\n        # Calculate basic-state fields U(y,z) and N(z)\n        U = U0 * np.exp(-(Y / Ly)**2) + Sz * Z + Ubar\n        N = N0 + dN * 0.5 * (1 + np.tanh((z - zt) / Ht))\n        N2 = N**2\n\n        # Calculate derivatives for q_y expression\n        # q_y = beta - U_yy - d/dz( (f0^2/N^2) * U_z )\n        \n        # U_z = dU/dz\n        Uz = gradient_2nd_order(U, dz, axis=0)\n        \n        # U_yy = d^2U/dy^2\n        Uy = gradient_2nd_order(U, dy, axis=1)\n        Uyy = gradient_2nd_order(Uy, dy, axis=1)\n        \n        # Intermediate term F = (f0^2/N^2) * U_z\n        # N2 is 1D, shape (nz,). U is 2D, shape (nz, ny). Use broadcasting.\n        F = (f0**2 / N2[:, np.newaxis]) * Uz\n        \n        # F_z = dF/dz\n        Fz = gradient_2nd_order(F, dz, axis=0)\n        \n        # Final meridional PV gradient q_y\n        qy = beta - Uyy - Fz\n        \n        # --- Stability Analysis ---\n        \n        # 1. Check if the Charney-Stern necessary condition is satisfied\n        # This requires a sign change in q_y.\n        is_satisfied = bool(qy.min()  0 and qy.max()  0)\n        results.append(str(is_satisfied))\n\n        # 2. Calculate the fraction of \"susceptible\" points\n        # Susceptible if q_y * beta  0. Since beta  0, this is q_y  0.\n        # The condition N^2  0 is always met by the provided parameters.\n        susceptible_count = np.sum(qy  0)\n        total_points = qy.size\n        susceptible_fraction = susceptible_count / total_points\n        \n        # Append rounded fraction\n        results.append(f\"{susceptible_fraction:.6f}\")\n\n    # Format and print the final output\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}