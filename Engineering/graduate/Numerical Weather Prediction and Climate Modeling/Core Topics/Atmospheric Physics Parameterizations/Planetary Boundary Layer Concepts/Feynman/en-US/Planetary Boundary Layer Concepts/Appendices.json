{
    "hands_on_practices": [
        {
            "introduction": "This exercise provides hands-on practice with the cornerstone of surface-layer physics, Monin-Obukhov Similarity Theory (MOST). You will take turbulent flux data, akin to measurements from an eddy-covariance tower, and compute the fundamental scaling parameters that govern the structure of the near-surface atmosphere. This practice is crucial for connecting observable fluxes to theoretical predictions of wind and temperature gradients, a foundational skill for both model evaluation and data interpretation .",
            "id": "4075668",
            "problem": "A horizontally homogeneous, stationary daytime surface layer over flat terrain is observed with an eddy-covariance system at height $z=\\;10\\,\\mathrm{m}$. The measured turbulent surface stress magnitude is $\\tau=\\;0.30\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$, the air density is $\\rho=\\;1.20\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, the kinematic sensible heat flux is $w'\\theta'=\\;0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, and the kinematic moisture flux (in terms of specific humidity $q$) is $w'q'=\\;1.0\\times 10^{-5}\\,\\mathrm{kg}\\,\\mathrm{kg}^{-1}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$. The mean potential temperature and specific humidity at the measurement height are $\\bar{\\theta}=\\;300\\,\\mathrm{K}$ and $\\bar{q}=\\;0.010$, respectively. Take the von Kármán constant $\\kappa=\\;0.40$ and gravitational acceleration $g=\\;9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$. Assume dry air with negligible liquid water, and approximate the virtual potential temperature and its kinematic flux by $\\bar{\\theta}_{v}\\approx \\bar{\\theta}\\left(1+0.61\\,\\bar{q}\\right)$ and $w'\\theta_{v}'\\approx w'\\theta'+0.61\\,\\bar{\\theta}\\,w'q'$. \n\nUsing Monin–Obukhov Similarity Theory (MOST), proceed from first principles to:\n- compute the friction velocity $u_{*}$ from $\\tau=\\rho\\,u_{*}^{2}$,\n- compute the temperature and moisture scales $\\theta_{*}$ and $q_{*}$ from the measured kinematic fluxes,\n- derive the Obukhov length $L$ from the definition involving $u_{*}$ and $w'\\theta_{v}'$, and\n- use the flux–gradient relation to predict the local potential temperature gradient at height $z=\\;5\\,\\mathrm{m}$.\n\nFor the stability functions, adopt the well-tested Businger–Dyer forms: for unstable stratification, $\\phi_{h}(\\zeta)=\\left(1-16\\,\\zeta\\right)^{-1/2}$, and for stable stratification, $\\phi_{h}(\\zeta)=1+5\\,\\zeta$, where $\\zeta=z/L$. \n\nReport only the predicted local potential temperature gradient $\\mathrm{d}\\theta/\\mathrm{d}z$ at $z=\\;5\\,\\mathrm{m}$. Round your answer to three significant figures. Express the final gradient in $\\mathrm{K}\\,\\mathrm{m}^{-1}$.",
            "solution": "The problem statement is validated as scientifically grounded, well-posed, objective, and self-contained. It presents a standard application of Monin-Obukhov Similarity Theory (MOST) using realistic physical parameters and established empirical formulations. All necessary data and definitions for a unique solution are provided. Therefore, I will proceed with the solution.\n\nThe problem requires the calculation of the local potential temperature gradient, $\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z}$, at a height of $z=5\\,\\mathrm{m}$ in a daytime atmospheric surface layer. The solution involves several steps, starting from the given measurements at $z=10\\,\\mathrm{m}$. Within the surface layer, the turbulent fluxes and MOST scaling parameters ($u_{*}$, $\\theta_{*}$, $L$) are assumed to be constant with height.\n\nFirst, the friction velocity, $u_{*}$, is computed from the turbulent surface stress magnitude, $\\tau$, and the air density, $\\rho$, using the definition $\\tau = \\rho u_{*}^{2}$.\n$$u_{*} = \\sqrt{\\frac{\\tau}{\\rho}}$$\nSubstituting the given values, $\\tau = 0.30\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$ and $\\rho = 1.20\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$:\n$$u_{*} = \\sqrt{\\frac{0.30}{1.20}} \\,\\mathrm{m}\\,\\mathrm{s}^{-1} = \\sqrt{0.25} \\,\\mathrm{m}\\,\\mathrm{s}^{-1} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\n\nSecond, the characteristic temperature scale, $\\theta_{*}$, and moisture scale, $q_{*}$, are determined from their relationship with the kinematic fluxes. The flux of a scalar is related to its characteristic scale and the friction velocity by $(w's')_s = -u_{*} s_{*}$, where $s$ is the scalar and the subscript $s$ denotes a surface value. Assuming the measured fluxes at $z=10\\,\\mathrm{m}$ represent the surface fluxes:\n$$\\theta_{*} = -\\frac{w'\\theta'}{u_{*}}$$\n$$q_{*} = -\\frac{w'q'}{u_{*}}$$\nUsing the measured kinematic sensible heat flux $w'\\theta' = 0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ and the computed $u_{*} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$:\n$$\\theta_{*} = -\\frac{0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = -0.24\\,\\mathrm{K}$$\nUsing the measured kinematic moisture flux $w'q' = 1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$:\n$$q_{*} = -\\frac{1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = -2.0 \\times 10^{-5}$$\n\nThird, we derive the Obukhov length, $L$, which characterizes the stability of the surface layer. Its definition is:\n$$L = - \\frac{u_{*}^3}{\\kappa \\frac{g}{\\bar{\\theta}_v} w'\\theta_{v}'}$$\nTo use this formula, we first need to compute the kinematic virtual potential temperature flux, $w'\\theta_{v}'$, and a reference virtual potential temperature, $\\bar{\\theta}_v$. The problem provides the approximation $w'\\theta_{v}' \\approx w'\\theta' + 0.61\\,\\bar{\\theta}\\,w'q'$.\nUsing $\\bar{\\theta}=300\\,\\mathrm{K}$, $w'\\theta' = 0.12\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, and $w'q' = 1.0 \\times 10^{-5}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$:\n$$w'\\theta_{v}' \\approx 0.12 + 0.61 \\times 300 \\times (1.0 \\times 10^{-5}) = 0.12 + 0.00183 = 0.12183\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$$\nThe positive sign of $w'\\theta_{v}'$ indicates buoyant production of turbulence, characteristic of an unstable (convective) layer.\nThe reference virtual potential temperature $\\bar{\\theta}_v$ is approximated by $\\bar{\\theta}_{v} \\approx \\bar{\\theta}(1+0.61\\,\\bar{q})$. Using $\\bar{\\theta}=300\\,\\mathrm{K}$ and $\\bar{q}=0.010$:\n$$\\bar{\\theta}_{v} \\approx 300(1 + 0.61 \\times 0.010) = 300(1.0061) = 301.83\\,\\mathrm{K}$$\nNow, we can compute $L$ using $u_{*} = 0.50\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $\\kappa=0.40$, and $g=9.81\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$:\n$$L = - \\frac{(0.50)^3}{0.40 \\times \\frac{9.81}{301.83} \\times 0.12183} = - \\frac{0.125}{0.40 \\times (0.03250\\,\\mathrm{K}^{-1}) \\times 0.12183\\,\\mathrm{K}\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} \\approx -78.92\\,\\mathrm{m}$$\nThe negative value of $L$ confirms the stratification is unstable.\n\nFourth, we use the flux-gradient relation for potential temperature to find the local gradient at the specified height $z=5\\,\\mathrm{m}$. The relation is given by:\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} = \\frac{\\theta_{*}}{\\kappa z} \\phi_{h}(\\zeta)$$\nwhere $\\phi_h$ is the dimensionless stability function for heat and $\\zeta = z/L$ is the stability parameter. At $z=5\\,\\mathrm{m}$:\n$$\\zeta = \\frac{5\\,\\mathrm{m}}{-78.92\\,\\mathrm{m}} \\approx -0.06335$$\nSince $\\zeta  0$, we use the Businger-Dyer form for unstable conditions: $\\phi_{h}(\\zeta) = (1 - 16\\zeta)^{-1/2}$.\n$$\\phi_{h}(-0.06335) = (1 - 16 \\times (-0.06335))^{-1/2} = (1 + 1.0136)^{-1/2} = (2.0136)^{-1/2} \\approx 0.7047$$\nFinally, we substitute all the calculated values into the gradient equation:\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} = \\frac{-0.24\\,\\mathrm{K}}{0.40 \\times 5\\,\\mathrm{m}} \\times 0.7047 = \\frac{-0.24\\,\\mathrm{K}}{2.0\\,\\mathrm{m}} \\times 0.7047 = -0.12\\,\\mathrm{K}\\,\\mathrm{m}^{-1} \\times 0.7047$$\n$$\\frac{\\mathrm{d}\\theta}{\\mathrm{d}z} \\approx -0.08456\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$$\nRounding the result to three significant figures, we get $-0.0846\\,\\mathrm{K}\\,\\mathrm{m}^{-1}$.",
            "answer": "$$\\boxed{-0.0846}$$"
        },
        {
            "introduction": "Building on surface layer analysis, we now address the critical task of diagnosing turbulence throughout a vertical atmospheric profile. This computational practice introduces the gradient Richardson number ($Ri_g$), a dimensionless parameter that quantifies the local balance between turbulence generation by wind shear and its suppression by stable stratification. By implementing a program to calculate $Ri_g$ from profile data, you will replicate a core function of modern turbulence closure schemes and see how different critical values ($Ri_{cr}$) are used in practice to determine where mixing occurs .",
            "id": "4075654",
            "problem": "You are given observed vertical profiles of height $z$ (in $\\mathrm{m}$), potential temperature $\\theta$ (in $\\mathrm{K}$), and horizontal wind components $u$ and $v$ (in $\\mathrm{m/s}$) in the atmospheric planetary boundary layer, and asked to derive, implement, and apply a decision rule grounded in first principles from the turbulent kinetic energy budget to ascertain whether turbulence is sustained or suppressed. Use the Boussinesq approximation and work in dry air. Begin from the definition of turbulent kinetic energy, interpret the competing roles of shear production and buoyancy production or destruction, and connect the ratio of stratification to shear to a dimensionless quantity that discriminates between sustained or suppressed turbulence when compared to a closure-dependent critical value. Implement a numerically robust method to evaluate this quantity on discrete profiles.\n\nYour program must use the following fundamental base without invoking shortcut formulas:\n- Under the Boussinesq approximation, buoyancy is proportional to temperature deviations normalized by a representative reference temperature.\n- The turbulent kinetic energy budget contains shear production and buoyancy production or destruction terms; near-local equilibrium the relative magnitude of these terms controls whether turbulence is sustained by shear against the stabilizing effect of stratification.\n- The Brunt–Väisälä frequency squared quantifies stratification in terms of vertical gradients of potential temperature in dry air.\n\nYou must:\n- Derive an expression for a dimensionless ratio of stratification to shear using the above base, and state clearly the conditions under which turbulence is sustained or suppressed relative to a closure-dependent critical value.\n- Discretize the vertical gradients using midpoint-based one-sided differences between adjacent levels. Specifically, for every pair of consecutive levels $(z_k,\\theta_k,u_k,v_k)$ and $(z_{k+1},\\theta_{k+1},u_{k+1},v_{k+1})$, evaluate the ratio at the midpoint $z_{k+1/2}$. Use the difference quotients $(\\theta_{k+1}-\\theta_k)/(z_{k+1}-z_k)$, $(u_{k+1}-u_k)/(z_{k+1}-z_k)$, and $(v_{k+1}-v_k)/(z_{k+1}-z_k)$, and use a midpoint reference potential temperature $\\theta_0=\\frac{1}{2}(\\theta_k+\\theta_{k+1})$.\n- Use gravitational acceleration $g=9.80665\\,\\mathrm{m/s^2}$.\n- Treat extremely small shear magnitude numerically robustly by adding a minimal positive regularization to the squared shear before division that does not alter the classification in the zero-shear limit.\n- Classify each midpoint as \"sustained\" if the derived ratio is negative or less than the closure-specific critical value, otherwise \"suppressed.\"\n- Work in the specified physical units and report the final numerical results as unitless floats and booleans.\n\nTest suite:\n- Case A (moderately stable nocturnal boundary layer):\n  - $z=\\{2,10,20,50,100\\}\\,\\mathrm{m}$,\n  - $\\theta=\\{290,291.5,293,296,300\\}\\,\\mathrm{K}$,\n  - $u=\\{2,3,4,6,8\\}\\,\\mathrm{m/s}$,\n  - $v=\\{0.5,0.8,1.0,1.2,1.5\\}\\,\\mathrm{m/s}$.\n- Case B (convective mid-day boundary layer):\n  - $z=\\{2,20,50,100,200\\}\\,\\mathrm{m}$,\n  - $\\theta=\\{310,308,306,304,302\\}\\,\\mathrm{K}$,\n  - $u=\\{3,4,5,6,7\\}\\,\\mathrm{m/s}$,\n  - $v=\\{0.5,0.6,0.7,0.8,0.9\\}\\,\\mathrm{m/s}$.\n- Case C (calm, stably stratified fog):\n  - $z=\\{2,5,10,20,40\\}\\,\\mathrm{m}$,\n  - $\\theta=\\{288,289,290,292,295\\}\\,\\mathrm{K}$,\n  - $u=\\{0.1,0.1,0.1,0.1,0.1\\}\\,\\mathrm{m/s}$,\n  - $v=\\{0,0,0,0,0\\}\\,\\mathrm{m/s}$.\n- Case D (strong low-level jet shear):\n  - $z=\\{10,50,100,200,400\\}\\,\\mathrm{m}$,\n  - $\\theta=\\{300,301,302,304,306\\}\\,\\mathrm{K}$,\n  - $u=\\{2,8,15,20,25\\}\\,\\mathrm{m/s}$,\n  - $v=\\{0.0,0.5,1.0,1.5,2.0\\}\\,\\mathrm{m/s}$.\n\nCritical values to use for classification, representing typical choices in different turbulence closures:\n- Mellor–Yamada–Nakanishi–Niino level $2.5$ (MYNN): $Ri_{cr}=\\{0.25\\}$,\n- Eddy–Diffusivity Mass–Flux (EDMF): $Ri_{cr}=\\{0.20\\}$,\n- K–Profile Parameterization (KPP): $Ri_{cr}=\\{0.30\\}$.\n\nFor each test case, compute the dimensionless ratio at each midpoint, round each float to six decimal places, and produce classification booleans for each of the three listed critical values. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The result for each test case must be a list of the form $[\\text{Ri\\_list},\\ \\text{MYNN\\_booleans},\\ \\text{EDMF\\_booleans},\\ \\text{KPP\\_booleans}]$ where $\\text{Ri\\_list}$ is a list of floats and each subsequent item is a list of booleans, all in the order of midpoints from lowest to highest.",
            "solution": "The problem requires the derivation and implementation of a decision rule to determine if turbulence in the planetary boundary layer is sustained or suppressed, based on vertical profiles of atmospheric data. This rule must be derived from the first principles of the turbulent kinetic energy (TKE) budget.\n\nThe state of turbulence is governed by the TKE budget equation. For horizontally homogeneous mean flow and under the Boussinesq approximation, a simplified form of the TKE budget equation is:\n$$\n\\frac{\\partial e}{\\partial t} = -\\overline{u'w'} \\frac{\\partial \\bar{u}}{\\partial z} - \\overline{v'w'} \\frac{\\partial \\bar{v}}{\\partial z} + \\frac{g}{\\theta_{ref}} \\overline{w'\\theta'} - \\epsilon'\n$$\nHere, $e$ is the turbulent kinetic energy per unit mass, $\\bar{u}$ and $\\bar{v}$ are the mean horizontal wind components, $z$ is the vertical coordinate, $u'$ and $v'$ are turbulent velocity fluctuations, $w'$ is the vertical velocity fluctuation, and $\\theta'$ is the potential temperature fluctuation. The term $g$ is the acceleration due to gravity, and $\\theta_{ref}$ is a reference potential temperature. The terms on the right-hand side represent the key processes:\n1.  **Shear Production ($SP$)**: $SP = -\\overline{u'w'} \\frac{\\partial \\bar{u}}{\\partial z} - \\overline{v'w'} \\frac{\\partial \\bar{v}}{\\partial z}$. This term represents the generation of TKE from the mean wind shear. It is almost always a source of TKE.\n2.  **Buoyancy Production/Destruction ($BP$)**: $BP = \\frac{g}{\\theta_{ref}} \\overline{w'\\theta'}$. This term represents the conversion of TKE to or from potential energy. In unstable stratification ($\\overline{w'\\theta'}  0$), warmer air parcels rise and cooler parcels sink, generating TKE. In stable stratification ($\\overline{w'\\theta'}  0$), this term acts as a sink, destroying TKE by working against the stable density gradient.\n3.  **Other Terms ($\\epsilon'$)**: This represents the sum of the dissipation rate of TKE and the divergence of turbulent transport terms.\n\nTo create a practical criterion, we must relate the turbulent flux terms (e.g., $\\overline{u'w'}$) to the mean-flow variables. We employ the first-order closure or K-theory, which parameterizes these fluxes using an eddy-diffusivity-viscosity analogy:\n$$\n\\overline{u'w'} = -K_m \\frac{\\partial \\bar{u}}{\\partial z}\n$$\n$$\n\\overline{v'w'} = -K_m \\frac{\\partial \\bar{v}}{\\partial z}\n$$\n$$\n\\overline{w'\\theta'} = -K_h \\frac{\\partial \\bar{\\theta}}{\\partial z}\n$$\nwhere $K_m$ is the eddy viscosity for momentum and $K_h$ is the eddy diffusivity for heat. Both $K_m$ and $K_h$ are positive definite.\n\nSubstituting these parameterizations into the production terms yields:\n$$\nSP = K_m \\left( \\left(\\frac{\\partial \\bar{u}}{\\partial z}\\right)^2 + \\left(\\frac{\\partial \\bar{v}}{\\partial z}\\right)^2 \\right) = K_m S^2\n$$\nwhere $S^2 = \\left(\\frac{\\partial \\bar{u}}{\\partial z}\\right)^2 + \\left(\\frac{\\partial \\bar{v}}{\\partial z}\\right)^2$ is the square of the magnitude of the vertical wind shear.\n$$\nBP = -\\frac{g}{\\theta_{ref}} K_h \\frac{\\partial \\bar{\\theta}}{\\partial z}\n$$\nThe competition between shear production and buoyant destruction governs the maintenance of turbulence in a stable environment. A dimensionless ratio comparing the buoyant destruction to the shear production provides a useful criterion. This ratio is the flux Richardson number, $R_f$:\n$$\nR_f = \\frac{-BP}{SP} = \\frac{\\frac{g}{\\theta_{ref}} K_h \\frac{\\partial \\bar{\\theta}}{\\partial z}}{K_m S^2} = \\frac{K_h}{K_m} \\frac{\\frac{g}{\\theta_{ref}} \\frac{\\partial \\bar{\\theta}}{\\partial z}}{S^2}\n$$\nThe ratio of eddy diffusivities, $K_m/K_h$, is the turbulent Prandtl number, $Pr_t$. The expression can be rewritten by defining the **gradient Richardson number, $Ri$**, which does not depend on the unknown eddy diffusivities:\n$$\nRi = \\frac{\\frac{g}{\\theta_{ref}} \\frac{\\partial \\bar{\\theta}}{\\partial z}}{\\left(\\frac{\\partial \\bar{u}}{\\partial z}\\right)^2 + \\left(\\frac{\\partial \\bar{v}}{\\partial z}\\right)^2} = \\frac{N^2}{S^2}\n$$\nwhere $N^2 = \\frac{g}{\\theta_{ref}} \\frac{\\partial \\bar{\\theta}}{\\partial z}$ is the square of the Brunt–Väisälä frequency, a measure of static stability.\n\nThe physical interpretation of $Ri$ is as follows:\n-   If $Ri  0$ ($\\frac{\\partial \\bar{\\theta}}{\\partial z}  0$), the layer is statically unstable. Buoyancy is a source of TKE, and turbulence is actively generated and sustained.\n-   If $Ri  0$ ($\\frac{\\partial \\bar{\\theta}}{\\partial z}  0$), the layer is statically stable. Buoyancy is a sink for TKE. Turbulence can be sustained only if the shear production $S^2$ is sufficiently large to overcome this buoyant destruction.\n-   Turbulence is expected to decay or be suppressed if $Ri$ exceeds a certain critical value, $Ri_{cr}$. Thus, the condition for sustained turbulence is $Ri  Ri_{cr}$. The value of $Ri_{cr}$ is closure-dependent, reflecting different theoretical and empirical assumptions about turbulence dynamics. The problem specifies three such values: $0.25$ (MYNN), $0.20$ (EDMF), and $0.30$ (KPP).\n\nTo implement this criterion numerically, we must discretize the gradients using the provided vertical profiles. For each pair of adjacent levels, indexed by $k$ and $k+1$, we evaluate $Ri$ at the midpoint $z_{k+1/2}$. The problem specifies a finite difference scheme:\n-   The vertical gradients are approximated as:\n    $$ \\frac{\\partial \\theta}{\\partial z} \\approx \\frac{\\theta_{k+1} - \\theta_k}{z_{k+1} - z_k}, \\quad \\frac{\\partial u}{\\partial z} \\approx \\frac{u_{k+1} - u_k}{z_{k+1} - z_k}, \\quad \\frac{\\partial v}{\\partial z} \\approx \\frac{v_{k+1} - v_k}{z_{k+1} - z_k} $$\n-   The reference potential temperature at the midpoint is:\n    $$ \\theta_0 = \\frac{1}{2}(\\theta_k + \\theta_{k+1}) $$\n-   The squared vertical wind shear is thus:\n    $$ S^2_{k+1/2} = \\left(\\frac{u_{k+1} - u_k}{z_{k+1} - z_k}\\right)^2 + \\left(\\frac{v_{k+1} - v_k}{z_{k+1} - z_k}\\right)^2 $$\n-   The squared Brunt–Väisälä frequency is:\n    $$ N^2_{k+1/2} = \\frac{g}{\\frac{1}{2}(\\theta_k + \\theta_{k+1})} \\frac{\\theta_{k+1} - \\theta_k}{z_{k+1} - z_k} $$\n-   The discrete gradient Richardson number is:\n    $$ Ri_{k+1/2} = \\frac{N^2_{k+1/2}}{S^2_{k+1/2} + \\epsilon} $$\n    A small positive regularization term, $\\epsilon$ (e.g., $10^{-12}$), is added to the denominator to prevent division by zero in cases of zero shear, which correctly results in a very large positive $Ri$ for stable stratification, leading to a \"suppressed\" classification.\n\nFor each midpoint, we calculate $Ri$ and then classify the turbulence regime. For a given critical value $Ri_{cr}$, the rule is:\n-   Turbulence is \"sustained\" if $Ri  Ri_{cr}$.\n-   Turbulence is \"suppressed\" if $Ri \\ge Ri_{cr}$.\nThis logic will be applied for each of the three given critical values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and applies a decision rule based on the gradient Richardson number\n    to determine if turbulence is sustained or suppressed in the planetary boundary layer.\n    \"\"\"\n\n    # Gravitational acceleration in m/s^2\n    g = 9.80665\n\n    # Test suite of vertical profiles\n    test_cases = [\n        # Case A: Moderately stable nocturnal boundary layer\n        {\n            \"z\": [2, 10, 20, 50, 100],\n            \"theta\": [290, 291.5, 293, 296, 300],\n            \"u\": [2, 3, 4, 6, 8],\n            \"v\": [0.5, 0.8, 1.0, 1.2, 1.5]\n        },\n        # Case B: Convective mid-day boundary layer\n        {\n            \"z\": [2, 20, 50, 100, 200],\n            \"theta\": [310, 308, 306, 304, 302],\n            \"u\": [3, 4, 5, 6, 7],\n            \"v\": [0.5, 0.6, 0.7, 0.8, 0.9]\n        },\n        # Case C: Calm, stably stratified fog\n        {\n            \"z\": [2, 5, 10, 20, 40],\n            \"theta\": [288, 289, 290, 292, 295],\n            \"u\": [0.1, 0.1, 0.1, 0.1, 0.1],\n            \"v\": [0, 0, 0, 0, 0]\n        },\n        # Case D: Strong low-level jet shear\n        {\n            \"z\": [10, 50, 100, 200, 400],\n            \"theta\": [300, 301, 302, 304, 306],\n            \"u\": [2, 8, 15, 20, 25],\n            \"v\": [0.0, 0.5, 1.0, 1.5, 2.0]\n        }\n    ]\n\n    # Closure-specific critical Richardson numbers\n    critical_values = {\n        \"MYNN\": 0.25,\n        \"EDMF\": 0.20,\n        \"KPP\": 0.30\n    }\n\n    def process_case(case_data):\n        \"\"\"\n        Calculates the gradient Richardson number and classifications for a single case.\n        \n        Args:\n            case_data (dict): A dictionary containing 'z', 'theta', 'u', and 'v' lists.\n            \n        Returns:\n            list: A list containing [Ri_list, MYNN_booleans, EDMF_booleans, KPP_booleans].\n        \"\"\"\n        z = np.array(case_data[\"z\"], dtype=float)\n        theta = np.array(case_data[\"theta\"], dtype=float)\n        u = np.array(case_data[\"u\"], dtype=float)\n        v = np.array(case_data[\"v\"], dtype=float)\n\n        # Calculate differences between adjacent levels using np.diff\n        dz = np.diff(z)\n        dtheta = np.diff(theta)\n        du = np.diff(u)\n        dv = np.diff(v)\n        \n        # Calculate midpoint reference potential temperature\n        theta_0 = (theta[:-1] + theta[1:]) / 2.0\n\n        # Calculate vertical gradients\n        dtheta_dz = dtheta / dz\n        du_dz = du / dz\n        dv_dz = dv / dz\n\n        # Calculate Brunt-Väisälä frequency squared (N^2)\n        N2 = (g / theta_0) * dtheta_dz\n\n        # Calculate squared vertical wind shear (S^2)\n        S2 = du_dz**2 + dv_dz**2\n\n        # A small positive regularization to prevent division by zero\n        epsilon = 1e-12\n\n        # Calculate the gradient Richardson number (Ri)\n        Ri = N2 / (S2 + epsilon)\n        \n        # Round Ri values to six decimal places\n        ri_list = [round(r, 6) for r in Ri]\n\n        results_for_case = [ri_list]\n\n        # Perform classification for each critical value\n        for ricr in critical_values.values():\n            sustained_bools = (Ri  ricr).tolist()\n            results_for_case.append(sustained_bools)\n            \n        return results_for_case\n\n    # Process all test cases\n    all_results = []\n    for case in test_cases:\n        result = process_case(case)\n        # The string representation of a list is used for formatting\n        all_results.append(str(result))\n\n    # Print the final output in the exact required format\n    # Join the string-formatted lists with a comma\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A crucial parameter in any atmospheric model is the height of the planetary boundary layer ($h$), which determines the volume for mixing of heat, momentum, and pollutants. This exercise demonstrates a widely used method for diagnosing the height of the stable boundary layer (SBL) using the bulk Richardson number ($Ri_b$). Unlike the local gradient Richardson number, $Ri_b$ provides an integral measure of stability from the surface to a given height, and by finding the level where it exceeds a critical threshold, you will implement a robust algorithm central to operational weather forecasting and climate modeling .",
            "id": "4075671",
            "problem": "You are given vertical profiles of height, virtual potential temperature, and horizontal wind for stably stratified conditions. The task is to determine the planetary boundary layer height by identifying the lowest model level where the bulk Richardson number meets or exceeds a specified critical threshold. Your program must implement the method in a way that is justified from fundamental principles, not by using a pre-supplied shortcut formula.\n\nBegin from the following base definitions and well-tested facts:\n- Planetary Boundary Layer (PBL) is the lowest part of the atmosphere directly influenced by the surface on time scales of about an hour or less, and in stable conditions its depth is limited by buoyancy suppression of turbulence.\n- Virtual Potential Temperature (VPT), denoted by $\\theta_v$, is a buoyancy-relevant thermodynamic variable; at the surface denote $\\theta_{v,0} = \\theta_v(z=0)$.\n- Gravitational acceleration is $g$, expressed in $\\mathrm{m\\,s^{-2}}$.\n- Buoyancy $b(z)$ over height $z$ relative to the surface is defined by $b(z) = g\\,(\\theta_v(z) - \\theta_{v,0})/\\theta_{v,0}$.\n- The horizontal wind vector is $\\mathbf{U}(z) = (u(z), v(z))$, and the surface wind is $\\mathbf{U}_0 = (u(0), v(0))$; the magnitude of the wind difference over height $z$ is $U_\\Delta(z) = \\|\\mathbf{U}(z) - \\mathbf{U}_0\\| = \\sqrt{(u(z) - u(0))^2 + (v(z) - v(0))^2}$.\n\nUse dimensional analysis and first-principles reasoning to construct a dimensionless ratio that characterizes the competition between stabilizing buoyancy and destabilizing shear over the layer from the surface to height $z$. Denote this bulk Richardson number by $Ri_b(z)$ and use it to diagnose the PBL height $h$ in stable conditions as the lowest level $z$ where $Ri_b(z) \\ge Ri_{cr}$, with $Ri_{cr}$ the specified Critical Bulk Richardson Number (CBRN). If $U_\\Delta(z) = 0$ and $(\\theta_v(z) - \\theta_{v,0})  0$, interpret $Ri_b(z)$ as $+\\infty$ for the purpose of the threshold test; if both $(\\theta_v(z) - \\theta_{v,0}) = 0$ and $U_\\Delta(z) = 0$, treat $Ri_b(z)$ as $0$. If no level satisfies $Ri_b(z) \\ge Ri_{cr}$ within the provided profile, return $-1.0$.\n\nScientific realism requirements:\n- Work in the International System of Units (SI): height in $\\mathrm{m}$, wind components in $\\mathrm{m\\,s^{-1}}$, gravitational acceleration $g$ in $\\mathrm{m\\,s^{-2}}$, and virtual potential temperature in $\\mathrm{K}$.\n- Express the final planetary boundary layer height $h$ for each test case in $\\mathrm{m}$ as a float rounded to one decimal.\n\nAlgorithmic requirements:\n- For each level $z_k$ above the surface ($k \\ge 1$), compute $Ri_b(z_k)$ from the definitions and determine if $Ri_b(z_k) \\ge Ri_{cr}$; the required $h$ is the smallest $z_k$ that satisfies the threshold.\n- Use $\\theta_{v,0} = \\theta_v(z=0)$ for the surface virtual potential temperature and $\\mathbf{U}_0$ for the surface wind.\n- Your program must be self-contained and produce the outputs in the format specified below.\n\nTest suite (four cases):\n- Case $1$ (typical stable layer with threshold reached near the top):\n  - $z = [0, 50, 100, 150, 200, 250, 300]\\,\\mathrm{m}$\n  - $\\theta_v = [295.0, 295.05, 295.1, 295.2, 295.5, 296.0, 297.0]\\,\\mathrm{K}$\n  - $u = [2.0, 4.0, 6.0, 7.0, 7.5, 8.0, 8.2]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 1.0, 2.0, 2.5, 2.8, 3.0, 3.1]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- Case $2$ (edge case with zero shear aloft leading to immediate threshold):\n  - $z = [0, 50, 100, 200]\\,\\mathrm{m}$\n  - $\\theta_v = [292.0, 292.1, 292.2, 292.6]\\,\\mathrm{K}$\n  - $u = [3.0, 3.0, 3.0, 3.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [1.0, 1.0, 1.0, 1.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- Case $3$ (strong shear and weak stratification; threshold not reached):\n  - $z = [0, 100, 200, 300, 400]\\,\\mathrm{m}$\n  - $\\theta_v = [290.0, 290.05, 290.1, 290.2, 290.4]\\,\\mathrm{K}$\n  - $u = [3.0, 8.0, 12.0, 15.0, 20.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 2.0, 4.0, 6.0, 8.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n- Case $4$ (constructed to hit the threshold exactly at a mid-level):\n  - $z = [0, 50, 100, 150, 200]\\,\\mathrm{m}$\n  - $\\theta_v = [300.0, 300.015, 300.03, 300.051, 300.08]\\,\\mathrm{K}$\n  - $u = [5.0, 5.6, 6.0, 6.0, 6.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $v = [0.0, 0.0, 0.0, 0.0, 0.0]\\,\\mathrm{m\\,s^{-1}}$\n  - $g = 9.81\\,\\mathrm{m\\,s^{-2}}$, $Ri_{cr} = 0.25$\n\nFinal output format:\n- Your program should produce a single line of output containing the four computed planetary boundary layer heights as a comma-separated list enclosed in square brackets, for example, $[h_1,h_2,h_3,h_4]$, where each $h_i$ is in $\\mathrm{m}$ and rounded to one decimal. No additional text should be printed.",
            "solution": "The problem as stated is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. It is based on established principles of atmospheric boundary layer physics. Therefore, the problem is deemed valid. We may proceed with a reasoned solution.\n\nThe objective is to determine the height of the stable planetary boundary layer, denoted as $h$. The method specified is to identify the lowest vertical level $z$ at which a dimensionless stability parameter, the bulk Richardson number $Ri_b(z)$, meets or exceeds a critical value $Ri_{cr}$. This approach is rooted in the fundamental physics of fluid dynamics, specifically the competition between buoyancy and mechanical shear in generating or suppressing turbulence.\n\nFirst, we must derive the expression for the bulk Richardson number, $Ri_b(z)$, from first principles, as requested. The Richardson number represents the ratio of buoyant suppression of turbulence to the mechanical generation of turbulence by wind shear.\n\n1.  **Buoyant Suppression of Turbulence**: In a stably stratified fluid, a fluid parcel displaced vertically will be acted upon by a restoring buoyancy force. This effect damps turbulent eddies and inhibits vertical mixing. The work required to lift a parcel against this restoring force over a height $z$ consumes turbulent kinetic energy (TKE). A measure of the potential energy gained by the layer, or the TKE consumed by buoyancy, is proportional to the product of the layer depth $z$ and the buoyancy at that height, $b(z)$. The problem defines buoyancy relative to the surface as:\n    $$\n    b(z) = g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}\n    $$\n    Here, $g$ is the gravitational acceleration in $\\mathrm{m\\,s^{-2}}$, $\\theta_v(z)$ is the virtual potential temperature in $\\mathrm{K}$ at height $z$, and $\\theta_{v,0}$ is the surface value. The term representing buoyant suppression over the layer of depth $z$ is dimensionally an energy per unit mass, which is proportional to $z \\cdot b(z)$. This term has units of $(\\mathrm{m/s})^2$.\n    $$\n    \\text{Buoyant Suppression Term} \\propto z \\cdot g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}\n    $$\n\n2.  **Shear Generation of Turbulence**: Wind shear, the change in wind velocity with height, is the primary source of mechanical production of TKE. For a bulk layer from the surface (height $z=0$) to a height $z$, the relevant velocity scale for shear is the magnitude of the vector difference between the wind at height $z$ and the surface wind. Let the horizontal wind vector be $\\mathbf{U}(z) = (u(z), v(z))$. The surface wind is $\\mathbf{U}_0 = (u(0), v(0))$. The magnitude of the wind difference is:\n    $$\n    U_\\Delta(z) = \\|\\mathbf{U}(z) - \\mathbf{U}_0\\| = \\sqrt{(u(z) - u(0))^2 + (v(z) - v(0))^2}\n    $$\n    The rate of TKE production by shear is proportional to the square of this velocity difference, $U_\\Delta(z)^2$. This term also represents an energy per unit mass and has units of $(\\mathrm{m/s})^2$.\n\n3.  **Constructing the Bulk Richardson Number**: The dimensionless bulk Richardson number, $Ri_b(z)$, is the ratio of the buoyant suppression term to the shear generation term:\n    $$\n    Ri_b(z) = \\frac{z \\cdot g \\frac{\\theta_v(z) - \\theta_{v,0}}{\\theta_{v,0}}}{U_\\Delta(z)^2} = \\frac{g \\cdot z \\cdot (\\theta_v(z) - \\theta_{v,0})}{\\theta_{v,0} \\cdot \\left( (u(z) - u(0))^2 + (v(z) - v(0))^2 \\right)}\n    $$\n    The units are $(\\mathrm{m} \\cdot \\mathrm{m\\,s^{-2}} \\cdot \\mathrm{K}) / (\\mathrm{K} \\cdot (\\mathrm{m\\,s^{-1}})^2) = (\\mathrm{m^2\\,s^{-2}}) / (\\mathrm{m^2\\,s^{-2}})$, which is dimensionless as required. When $Ri_b(z)$ is small, shear dominates and turbulence is likely to be sustained. When $Ri_b(z)$ is large, buoyancy dominates and turbulence is suppressed. The critical value, $Ri_{cr}$, represents the threshold at which turbulence is expected to cease. The stable PBL height, $h$, is thus the height of the turbulent layer, identified as the lowest level where $Ri_b(z) \\ge Ri_{cr}$.\n\nThe algorithmic procedure to find $h$ is as follows:\n\n1.  For each test case, obtain the discrete vertical profiles of height $z_k$, virtual potential temperature $\\theta_{v,k}$, and wind components $u_k$ and $v_k$. The index $k=0$ corresponds to the surface.\n2.  Identify the surface values: $\\theta_{v,0} = \\theta_{v,k=0}$, $u_0 = u_{k=0}$, and $v_0 = v_{k=0}$.\n3.  Initialize the PBL height as not found, for instance, by setting $h = -1.0$.\n4.  Iterate through the atmospheric levels above the surface, for $k = 1, 2, 3, \\ldots$ up to the highest available level. For each level $z_k$:\n    a.  Calculate the numerator term related to buoyancy: $N = g \\cdot z_k \\cdot (\\theta_{v,k} - \\theta_{v,0})$.\n    b.  Calculate the denominator term related to shear: $D = \\theta_{v,0} \\cdot \\left( (u_k - u_0)^2 + (v_k - v_0)^2 \\right)$. Note that the squared wind difference is $U_\\Delta(z_k)^2$.\n    c.  Evaluate the special conditions as prescribed:\n        i.  If $U_\\Delta(z_k)^2 = 0$: If the buoyancy term $(\\theta_{v,k} - \\theta_{v,0})$ is positive, then $Ri_b(z_k)$ is treated as infinite. As $\\infty \\ge Ri_{cr}$, the condition is met. If $(\\theta_{v,k} - \\theta_{v,0})$ is zero, $Ri_b(z_k)$ is treated as $0$, and the condition is not met (assuming $Ri_{cr}  0$).\n        ii. Otherwise, if $U_\\Delta(z_k)^2 \\ne 0$, compute $Ri_b(z_k) = N / D$.\n    d.  Check if $Ri_b(z_k) \\ge Ri_{cr}$.\n    e.  If the condition is met, the PBL height is $h = z_k$. Since we are looking for the *lowest* such level, we terminate the search for this test case and record the result.\n5.  If the loop completes without finding any level that satisfies the condition, the result for the test case remains $h = -1.0$.\n6.  The final results for all test cases are collected and presented in the required format. This procedure will be implemented for the given test suites.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the Planetary Boundary Layer (PBL) height for stable conditions\n    based on the bulk Richardson number method.\n    \"\"\"\n\n    # Test suite (four cases)\n    test_cases = [\n        {\n            \"z\": np.array([0, 50, 100, 150, 200, 250, 300]),  # m\n            \"theta_v\": np.array([295.0, 295.05, 295.1, 295.2, 295.5, 296.0, 297.0]),  # K\n            \"u\": np.array([2.0, 4.0, 6.0, 7.0, 7.5, 8.0, 8.2]),  # m/s\n            \"v\": np.array([0.0, 1.0, 2.0, 2.5, 2.8, 3.0, 3.1]),  # m/s\n            \"g\": 9.81,  # m/s^2\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 50, 100, 200]),\n            \"theta_v\": np.array([292.0, 292.1, 292.2, 292.6]),\n            \"u\": np.array([3.0, 3.0, 3.0, 3.0]),\n            \"v\": np.array([1.0, 1.0, 1.0, 1.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 100, 200, 300, 400]),\n            \"theta_v\": np.array([290.0, 290.05, 290.1, 290.2, 290.4]),\n            \"u\": np.array([3.0, 8.0, 12.0, 15.0, 20.0]),\n            \"v\": np.array([0.0, 2.0, 4.0, 6.0, 8.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        },\n        {\n            \"z\": np.array([0, 50, 100, 150, 200]),\n            \"theta_v\": np.array([300.0, 300.015, 300.03, 300.051, 300.08]),\n            \"u\": np.array([5.0, 5.6, 6.0, 6.0, 6.0]),\n            \"v\": np.array([0.0, 0.0, 0.0, 0.0, 0.0]),\n            \"g\": 9.81,\n            \"Ri_cr\": 0.25\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        heights = case[\"z\"]\n        theta_v_profile = case[\"theta_v\"]\n        u_profile = case[\"u\"]\n        v_profile = case[\"v\"]\n        g = case[\"g\"]\n        Ri_cr = case[\"Ri_cr\"]\n\n        # Extract surface values (at index 0)\n        theta_v_0 = theta_v_profile[0]\n        u_0 = u_profile[0]\n        v_0 = v_profile[0]\n\n        pbl_height = -1.0 # Default if threshold is not met\n\n        # Iterate over levels above the surface (k >= 1)\n        for k in range(1, len(heights)):\n            z_k = heights[k]\n            theta_v_k = theta_v_profile[k]\n            u_k = u_profile[k]\n            v_k = v_profile[k]\n\n            # Calculate difference in virtual potential temperature\n            delta_theta_v = theta_v_k - theta_v_0\n            \n            # Calculate squared magnitude of wind difference (shear term)\n            u_delta_sq = (u_k - u_0)**2 + (v_k - v_0)**2\n\n            Ri_b = 0.0\n            \n            # Handle special cases based on the problem description\n            if u_delta_sq == 0:\n                # If shear is zero, but stratification is positive, Ri_b is infinite.\n                if delta_theta_v > 0:\n                    Ri_b = float('inf')\n                # If shear is zero and stratification is also zero, Ri_b is zero.\n                else:\n                    Ri_b = 0.0\n            else:\n                # Standard calculation for the bulk Richardson number\n                # Ri_b = (g * z * delta_theta_v) / (theta_v_0 * U_delta^2)\n                numerator = g * z_k * delta_theta_v\n                denominator = theta_v_0 * u_delta_sq\n                Ri_b = numerator / denominator\n\n            # Check if the critical threshold is met or exceeded\n            if Ri_b >= Ri_cr:\n                pbl_height = z_k\n                break # Found the lowest level, so exit the loop\n\n        results.append(pbl_height)\n\n    # Format the results for the final print statement\n    formatted_results = [f\"{r:.1f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}