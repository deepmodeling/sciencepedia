{
    "hands_on_practices": [
        {
            "introduction": "The theoretical link between gravity wave momentum flux and mean-flow acceleration is a cornerstone of atmospheric dynamics. This exercise provides a concrete application of this principle, where drag arises from the vertical divergence of momentum flux as waves break and deposit their momentum. By working through a carefully specified scenario, you will calculate the direct impact of orographic drag on a key atmospheric feature—the subtropical jet—and develop an intuition for the magnitude of this crucial effect. ",
            "id": "4056240",
            "problem": "Consider a dry, hydrostatic, stably stratified atmosphere in which the zonal-mean subtropical jet resides near $200\\,\\mathrm{hPa}$, corresponding to geometric height $z=12\\,\\mathrm{km}$. Assume the anelastic density profile is given by $\\rho(z)=\\rho_{s}\\exp\\!\\big(-z/H\\big)$ with $\\rho_{s}=1.2\\,\\mathrm{kg\\,m^{-3}}$ and scale height $H=7.5\\,\\mathrm{km}$. An idealized, zonally symmetric mountain range in the subtropics launches a spectrum of stationary orographic gravity waves at source level $z_{0}=2\\,\\mathrm{km}$. The vertical flux of zonal momentum (i.e., the vertical component of the Eliassen–Palm flux for two-dimensional hydrostatic gravity waves), defined as $F(z)\\equiv \\rho(z)\\,\\overline{u'w'}(z)$ where overbars denote averages and primes denote perturbations, is negative at launch because it opposes the mean westerly flow. The source spectrum consists of two non-overlapping bands:\n- Band $\\mathcal{A}$ carries a fraction $0.60$ of the total source flux and deposits its momentum uniformly with height over the layer $z\\in[10\\,\\mathrm{km},\\,14\\,\\mathrm{km}]$ due to wave saturation and breaking.\n- Band $\\mathcal{B}$ carries the remaining fraction $0.40$ and deposits uniformly over $z\\in[16\\,\\mathrm{km},\\,22\\,\\mathrm{km}]$.\n\nAt the source level $z_{0}$, the spectrum-integrated vertical flux of zonal momentum is $F(z_{0})=-M_{\\mathrm{tot}}$, with $M_{\\mathrm{tot}}=0.05\\,\\mathrm{N\\,m^{-2}}$. Above the source and outside the deposition layers, propagation is lossless so that $F(z)$ is constant with height. Within each deposition layer, $F(z)$ increases linearly (becomes less negative) as momentum is irreversibly transferred to the mean flow.\n\nStarting from the Reynolds-averaged zonal momentum equation under anelastic mass continuity, and neglecting meridional flux divergences and advection by the mean flow over the time scale of interest, derive the relationship between the zonal-mean acceleration and the vertical divergence of the vertical flux of zonal momentum. Then, using the specified spectrum and deposition layers, construct $F(z)$ piecewise and compute the instantaneous zonal-mean tendency of the zonal wind at $z=12\\,\\mathrm{km}$ (the jet core level). Express your final result in $\\mathrm{m\\,s^{-1}\\,day^{-1}}$ and round your answer to three significant figures.",
            "solution": "The problem is first validated against the established criteria.\n\n### Step 1: Extract Givens\n- Atmosphere: dry, hydrostatic, stably stratified.\n- Jet location: near $200\\,\\mathrm{hPa}$, corresponding to $z=12\\,\\mathrm{km}$.\n- Anelastic density profile: $\\rho(z)=\\rho_{s}\\exp(-z/H)$.\n- Surface density: $\\rho_{s}=1.2\\,\\mathrm{kg\\,m^{-3}}$.\n- Scale height: $H=7.5\\,\\mathrm{km}$.\n- Wave source: zonally symmetric mountain range.\n- Wave type: stationary orographic gravity waves.\n- Source level: $z_{0}=2\\,\\mathrm{km}$.\n- Vertical flux of zonal momentum: $F(z)\\equiv \\rho(z)\\,\\overline{u'w'}(z)$.\n- Spectrum-integrated source flux: $F(z_{0})=-M_{\\mathrm{tot}}$, with $M_{\\mathrm{tot}}=0.05\\,\\mathrm{N\\,m^{-2}}$.\n- Source spectrum Band $\\mathcal{A}$: fraction $0.60$ of total source flux, deposits momentum uniformly over $z\\in[10\\,\\mathrm{km},\\,14\\,\\mathrm{km}]$.\n- Source spectrum Band $\\mathcal{B}$: fraction $0.40$ of total source flux, deposits momentum uniformly over $z\\in[16\\,\\mathrm{km},\\,22\\,\\mathrm{km}]$.\n- Propagation outside deposition layers is lossless ($F(z)$ is constant).\n- Deposition within layers implies $F(z)$ increases linearly with height.\n- Simplifications for momentum equation: neglect meridional flux divergences and advection by the mean flow.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is firmly rooted in the principles of atmospheric dynamics, specifically the theory of gravity wave generation, propagation, and momentum deposition (wave drag). The use of the anelastic approximation, Reynolds averaging, and the Eliassen-Palm flux concept are standard in this field. The given physical parameters ($\\rho_s, H, M_{\\mathrm{tot}}$) are realistic for Earth's atmosphere.\n- **Well-Posed:** The problem is well-defined. It provides all necessary data and a clear set of physical assumptions to derive a unique solution. The piecewise definition of the momentum flux profile $F(z)$ is unambiguous. The final objective, calculating the wind tendency at a specific altitude, is a direct consequence of the setup.\n- **Objective:** The problem is stated in precise, quantitative, and unbiased scientific language. There are no subjective elements.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A solution will be provided.\n\n### Derivation of the Governing Equation\nThe problem requires starting from the Reynolds-averaged zonal momentum equation. In a fluid described by anelastic mass continuity, $\\nabla \\cdot (\\rho \\vec{v}) = 0$, the zonal momentum equation can be written in flux form. After zonal and temporal averaging (denoted by an overbar), the equation is:\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} + \\bar{\\vec{v}} \\cdot \\nabla \\bar{u} + \\frac{1}{\\rho}\\nabla \\cdot (\\rho \\overline{\\vec{v}'u'}) - f\\bar{v} = 0\n$$\nwhere $\\bar{u}$ is the zonal-mean zonal wind, $\\bar{\\vec{v}}$ is the mean velocity vector, $\\rho \\overline{\\vec{v}'u'}$ is the eddy momentum flux vector, and $f$ is the Coriolis parameter. The problem states to neglect \"advection by the mean flow\" ($\\bar{\\vec{v}} \\cdot \\nabla \\bar{u}$) and \"meridional flux divergences\". For a zonally symmetric mean state, the divergence of the eddy momentum flux vector expands to:\n$$\n\\frac{1}{\\rho}\\nabla \\cdot (\\rho \\overline{\\vec{v}'u'}) = \\frac{1}{\\rho}\\frac{\\partial}{\\partial y}(\\rho \\overline{v'u'}) + \\frac{1}{\\rho}\\frac{\\partial}{\\partial z}(\\rho \\overline{w'u'})\n$$\nNeglecting the meridional flux divergence term, $\\frac{1}{\\rho}\\frac{\\partial}{\\partial y}(\\rho \\overline{v'u'})$, and other terms related to the mean meridional circulation (which are implicitly bundled with the neglected advection), the zonal momentum tendency is driven solely by the vertical divergence of the vertical flux of zonal momentum:\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(z)}\\frac{\\partial}{\\partial z}(\\rho(z) \\overline{u'w'})\n$$\nThe vertical flux of zonal momentum is defined as $F(z) \\equiv \\rho(z)\\overline{u'w'}(z)$. Since the problem setup implies $F$ is a function of height $z$ only, the partial derivative becomes a total derivative. The governing equation is therefore:\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(z)}\\frac{dF}{dz}\n$$\nThis relationship shows that the mean-flow acceleration at a given level is determined by the local density and the vertical gradient of the wave momentum flux. A positive (upward) gradient, $dF/dz > 0$, corresponds to a flux convergence (as the flux becomes less negative) and results in a negative acceleration, i.e., a drag on the mean flow.\n\n### Construction of the Momentum Flux Profile $F(z)$\nThe total momentum flux at the source level $z_0 = 2\\,\\mathrm{km}$ is $F(z_0) = -M_{\\mathrm{tot}} = -0.05\\,\\mathrm{N\\,m^{-2}}$. We construct $F(z)$ piecewise.\n\n1.  **Region $z_0 \\le z  10\\,\\mathrm{km}$**: Propagation is lossless.\n    $F(z) = F(z_0) = -0.05\\,\\mathrm{N\\,m^{-2}}$.\n\n2.  **Region $10\\,\\mathrm{km} \\le z \\le 14\\,\\mathrm{km}$**: Band $\\mathcal{A}$ deposits its momentum. The flux from this band is $0.60 \\times F(z_0) = -0.03\\,\\mathrm{N\\,m^{-2}}$. This amount of negative flux is removed from the total and transferred to the mean flow. Thus, the total flux $F(z)$ increases by $0.03\\,\\mathrm{N\\,m^{-2}}$ across this layer.\n    - Flux at the bottom of the layer: $F(10\\,\\mathrm{km}) = -0.05\\,\\mathrm{N\\,m^{-2}}$.\n    - Flux at the top of the layer: $F(14\\,\\mathrm{km}) = F(10\\,\\mathrm{km}) + 0.03\\,\\mathrm{N\\,m^{-2}} = -0.02\\,\\mathrm{N\\,m^{-2}}$.\n    Since deposition is uniform, $dF/dz$ is constant in this layer:\n    $$\n    \\frac{dF}{dz} = \\frac{F(14\\,\\mathrm{km}) - F(10\\,\\mathrm{km})}{14\\,\\mathrm{km} - 10\\,\\mathrm{km}} = \\frac{-0.02 - (-0.05)}{14000 - 10000}\\,\\frac{\\mathrm{N\\,m^{-2}}}{\\mathrm{m}} = \\frac{0.03}{4000}\\,\\mathrm{N\\,m^{-3}} = 7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}\n    $$\n    This is the flux divergence relevant for the jet core altitude.\n\n3.  **Region $14\\,\\mathrm{km}  z  16\\,\\mathrm{km}$**: Propagation is lossless.\n    $F(z) = F(14\\,\\mathrm{km}) = -0.02\\,\\mathrm{N\\,m^{-2}}$.\n\n4.  **Region $16\\,\\mathrm{km} \\le z \\le 22\\,\\mathrm{km}$**: Band $\\mathcal{B}$ deposits the remaining momentum. The remaining flux is $-0.02\\,\\mathrm{N\\,m^{-2}}$, which is fully dissipated.\n    - Flux at the top of the layer: $F(22\\,\\mathrm{km})=0$.\n    - The flux gradient is $\\frac{dF}{dz} = \\frac{0 - (-0.02)}{22000 - 16000} = \\frac{0.02}{6000}\\,\\mathrm{N\\,m^{-3}}$.\n\n5.  **Region $z > 22\\,\\mathrm{km}$**: All momentum has been deposited. $F(z) = 0$.\n\n### Calculation of Zonal Wind Tendency at $z = 12\\,\\mathrm{km}$\nThe jet core is at $z_{jet} = 12\\,\\mathrm{km}$, which falls within the first deposition layer ($10\\,\\mathrm{km} \\le 12\\,\\mathrm{km} \\le 14\\,\\mathrm{km}$).\n\nFirst, we calculate the air density $\\rho(z)$ at this altitude using the provided anelastic profile $\\rho(z) = \\rho_s \\exp(-z/H)$:\n$$\n\\rho(12\\,\\mathrm{km}) = (1.2\\,\\mathrm{kg\\,m^{-3}}) \\exp\\left(-\\frac{12\\,\\mathrm{km}}{7.5\\,\\mathrm{km}}\\right) = 1.2 \\exp(-1.6)\\,\\mathrm{kg\\,m^{-3}}\n$$\n\nNext, we use the constant value of $dF/dz$ calculated for this layer:\n$$\n\\frac{dF}{dz} = 7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}\n$$\n\nNow, we compute the zonal wind tendency using the derived governing equation:\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{1}{\\rho(12\\,\\mathrm{km})} \\frac{dF}{dz} = -\\frac{7.5 \\times 10^{-6}\\,\\mathrm{N\\,m^{-3}}}{1.2 \\exp(-1.6)\\,\\mathrm{kg\\,m^{-3}}}\n$$\nThe units are $\\mathrm{N\\,m^{-3} / (kg\\,m^{-3})} = (\\mathrm{kg\\,m\\,s^{-2}})\\mathrm{m^{-3} / (kg\\,m^{-3})} = \\mathrm{m\\,s^{-2}}$, which is an acceleration, as expected.\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} = -\\frac{7.5 \\times 10^{-6}}{1.2} \\exp(1.6)\\,\\mathrm{m\\,s^{-2}} = -6.25 \\times 10^{-6} \\exp(1.6)\\,\\mathrm{m\\,s^{-2}}\n$$\nNumerically, $\\exp(1.6) \\approx 4.95303$.\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx -6.25 \\times 10^{-6} \\times 4.95303\\,\\mathrm{m\\,s^{-2}} \\approx -3.0956 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}\n$$\nThe problem asks for the result in units of $\\mathrm{m\\,s^{-1}\\,day^{-1}}$. We convert the units by multiplying by the number of seconds in a day: $1\\,\\mathrm{day} = 24 \\times 60 \\times 60 = 86400\\,\\mathrm{s}$.\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx (-3.0956 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}) \\times (86400\\,\\mathrm{s\\,day^{-1}})\n$$\n$$\n\\frac{\\partial \\bar{u}}{\\partial t} \\approx -2.6746\\,\\mathrm{m\\,s^{-1}\\,day^{-1}}\n$$\nRounding to three significant figures, the instantaneous zonal-mean tendency of the zonal wind at the jet core is $-2.67\\,\\mathrm{m\\,s^{-1}\\,day^{-1}}$. The negative sign correctly indicates a deceleration or drag on the westerly flow.",
            "answer": "$$\\boxed{-2.67}$$"
        },
        {
            "introduction": "In numerical models, the effects of subgrid-scale orography must be parameterized by capturing the essential physics of wave generation, propagation, and dissipation. This practice guides you through building such a parameterization from first principles, starting from the Boussinesq equations. You will implement the core logic for wave propagation, reflection at turning levels, absorption at critical levels, and breaking due to saturation, gaining a deep, practical understanding of how orographic drag schemes function within large-scale models. ",
            "id": "3904213",
            "problem": "Consider the parameterization of orographic drag in a vertically varying atmosphere under the linear Boussinesq approximation for two-dimensional stationary mountain waves. You are given a stratification profile $N(z)$, a background wind profile $U(z)$ aligned with the horizontal wavenumber vector, and a discrete set of terrain spectral components characterized by horizontal wavenumber $k$ and terrain amplitude $h_0$. From the fundamental base comprising (i) the Boussinesq continuity and momentum equations, (ii) the internal gravity wave dispersion relation for two-dimensional stationary waves, and (iii) the conservation of wave action in slowly varying media, derive the expressions necessary to compute the vertical wavenumber $m(z)$, the vertical flux of horizontal momentum (also called Eliassen-Palm flux) and the saturation criterion. Using those expressions, implement an algorithm to vertically propagate each spectral component from the lower boundary upward through a discrete grid until wave breaking (saturation) or a critical level is encountered, and compute the resulting vertical distribution of momentum deposition.\n\nThe algorithmic requirements are as follows:\n\n- Start from fundamental laws and core definitions to derive the governing relations needed for vertical propagation of stationary internal gravity waves forced by orography. Do not use pre-packaged or shortcut formulas that are not derived from the fundamental base.\n- Assume a constant reference density $\\rho_0$ and use the two-dimensional, non-rotating, hydrostatic-consistent limit of the Boussinesq framework appropriate for mountain waves.\n- Implement vertical propagation on a uniform grid $z_i$ from $z=0$ to $z=10{,}000$ meters at $1{,}000$ meters spacing. At each level, determine whether the internal gravity wave is able to propagate ($m^2(z_i)  0$), whether it encounters a turning level ($m^2(z_i) \\le 0$), whether it saturates according to a physically motivated nonlinearity threshold, or whether it encounters a critical level (defined when the intrinsic phase speed vanishes due to $|U(z_i)|$ crossing below a small threshold).\n- For each spectral component with parameters $k$ and $h_0$, initialize the upward vertical flux of horizontal momentum at the lower boundary using the appropriate relations derived from the fundamental base. Under the assumption of adiabatic propagation in the absence of breaking or critical levels, this flux is conserved with height. When saturation occurs (based on a derived nonlinearity parameter reaching unity), or a critical level is encountered (based on a threshold for $|U(z)|$), or a turning level is reached ($m^2(z) \\le 0$), deposit the remaining upward flux locally at that level. Sum the momentum deposition contributions from all spectral components to obtain the net vertical profile.\n- Express all momentum deposition values in units of Newtons per square meter ($\\mathrm{N}\\,\\mathrm{m}^{-2}$). For the final program output, round every reported float to six decimal places.\n\nUse the following constants and test suite. All mathematical entities (symbols, variables, functions, and numbers) are to be treated consistently with their physical meaning:\n\n- Reference density: $\\rho_0 = 1.0 \\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$.\n- Critical-level threshold: $U_{\\mathrm{crit}} = 0.5 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nVertical grid:\n- Levels at $z_i = 0, 1000, 2000, \\dots, 10000$ meters.\n\nTest Suite (three cases), each defined by $N(z)$, $U(z)$ and a set of discrete spectral components $\\{(k,h_0)\\}$:\n\n- Case A (monotonic shear leading to possible saturation):\n  - Stratification: $N(z) = 0.01 \\,\\mathrm{s}^{-1}$ for all $z$.\n  - Wind: $U(z) = 10 + 1.2 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - Spectral components: $(k_1,h_{0,1}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (8\\times 10^{-4}\\,\\mathrm{m}^{-1}, 100\\,\\mathrm{m})$.\n\n- Case B (critical level due to wind reversal with height):\n  - Stratification: $N(z) = 0.01 \\,\\mathrm{s}^{-1}$ for all $z$.\n  - Wind: $U(z) = 12 - 3 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - Spectral components: $(k_1,h_{0,1}) = (4\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (6\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$.\n\n- Case C (decreasing stratification leading to a turning level):\n  - Stratification: $N(z) = 0.014 - 0.0008 \\times (z/1000) \\,\\mathrm{s}^{-1}$.\n  - Wind: $U(z) = 15 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ for all $z$.\n  - Spectral components: $(k_1,h_{0,1}) = (7\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 180\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (9\\times 10^{-4}\\,\\mathrm{m}^{-1}, 80\\,\\mathrm{m})$.\n\nNumerical and physical handling guidelines:\n- The vertical wavenumber $m(z)$ must be determined from the dispersion relation appropriate for two-dimensional stationary internal gravity waves in a Boussinesq fluid with horizontally aligned mean flow.\n- The polarization relations must be used to relate the vertical velocity amplitude to horizontal velocity perturbations and compute the vertical flux of horizontal momentum.\n- Use the conservation of wave action to infer how amplitudes evolve with $z$ in the absence of breaking or critical levels, enabling the calculation of the nonlinearity parameter and its saturation threshold.\n- Upon saturation, encountering a critical level, or reaching a turning level, deposit the remaining upward flux at the current level and stop the propagation of that spectral component.\n\nFinal Output Specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of $11$ floats representing the net momentum deposition at each of the $11$ vertical levels $z_i$ (from $z=0$ to $z=10{,}000$ meters), in $\\mathrm{N}\\,\\mathrm{m}^{-2}$, rounded to six decimal places. For example: \"[[x_0,x_1,...,x_{10}],[y_0,y_1,...,y_{10}],[z_0,z_1,...,z_{10}]]\".",
            "solution": "The problem requires the derivation of a model for orographic gravity wave drag and its implementation. The derivation will proceed from the fundamental equations of fluid dynamics under the specified approximations.\n\n**1. Fundamental Equations and Linearization**\n\nWe begin with the two-dimensional, steady-state, non-rotating, inviscid Boussinesq equations for a stratified fluid, linearized about a background state with horizontal velocity $U(z)$ and density profile $\\bar{\\rho}(z)$. The perturbation quantities are velocity components $(u', w')$, pressure $p'$, and density $\\rho'$. The reference density is a constant $\\rho_0$.\n\nThe linearized momentum equations are:\n$$ U \\frac{\\partial u'}{\\partial x} + w' \\frac{dU}{dz} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial x} \\quad (1) $$\n$$ U \\frac{\\partial w'}{\\partial x} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} - \\frac{\\rho' g}{\\rho_0} \\quad (2) $$\nThe continuity equation is:\n$$ \\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0 \\quad (3) $$\nThe thermodynamic equation, representing conservation of density for a fluid parcel, is:\n$$ U \\frac{\\partial \\rho'}{\\partial x} + w' \\frac{d\\bar{\\rho}}{dz} = 0 \\quad (4) $$\nWe define the Brunt-Väisälä frequency $N$ by $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$. Using this, equation $(4)$ becomes:\n$$ U \\frac{\\partial}{\\partial x} \\left(-\\frac{\\rho' g}{\\rho_0}\\right) - w' N^2 = 0 \\quad (5) $$\n\n**2. Derivation of the Taylor-Goldstein Equation**\n\nWe seek wave-like solutions of the form $\\psi'(x,z) = \\Re\\{\\hat{\\psi}(z) e^{ikx}\\}$ for any perturbation variable $\\psi'$, where $k$ is the horizontal wavenumber. Substituting this form into the linearized equations yields a system of ordinary differential equations (ODEs) for the complex amplitudes $\\hat{u}(z), \\hat{w}(z), \\hat{p}(z), \\hat{\\rho}(z)$:\n$$ ikU\\hat{u} + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\quad (6) $$\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0}\\frac{d\\hat{p}}{dz} - \\frac{\\hat{\\rho}g}{\\rho_0} \\quad (7) $$\n$$ ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0 \\quad (8) $$\n$$ ikU\\left(-\\frac{\\hat{\\rho}g}{\\rho_0}\\right) - \\hat{w} N^2 = 0 \\quad (9) $$\n\nFrom $(8)$, we express $\\hat{u}$ in terms of $\\hat{w}$: $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$.\nFrom $(9)$, we express the buoyancy term in terms of $\\hat{w}$: $-\\frac{\\hat{\\rho}g}{\\rho_0} = \\frac{N^2}{ikU}\\hat{w}$.\n\nSubstitute $\\hat{u}$ into $(6)$ to solve for $\\hat{p}$:\n$$ ikU\\left(\\frac{i}{k}\\frac{d\\hat{w}}{dz}\\right) + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\implies \\hat{p} = \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) $$\nNow, differentiate $\\hat{p}$ with respect to $z$ and substitute it, along with the expression for buoyancy, into $(7)$:\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0} \\frac{d}{dz} \\left[ \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) \\right] + \\frac{N^2}{ikU}\\hat{w} $$\nAfter expanding the derivative and rearranging terms, we obtain the Taylor-Goldstein equation:\n$$ \\frac{d^2\\hat{w}}{dz^2} + \\left( \\frac{N^2}{U^2} - k^2 - \\frac{U_{zz}}{U} \\right) \\hat{w} = 0 $$\nwhere $U_{zz} = d^2U/dz^2$.\n\n**3. Vertical Wavenumber, $m(z)$**\n\nThe problem specifies analysis for a \"slowly varying media\", which corresponds to the WKB approximation. In this limit, the term involving the curvature of the wind profile, $U_{zz}/U$, is negligible compared to the other terms. The governing equation simplifies to:\n$$ \\frac{d^2\\hat{w}}{dz^2} + m^2(z)\\hat{w} = 0 $$\nThis is the equation for a harmonic oscillator with a spatially varying frequency. The local vertical wavenumber, $m(z)$, is defined by:\n$$ m^2(z) = \\frac{N(z)^2}{U(z)^2} - k^2 $$\nFor a wave to propagate vertically, its solution must be oscillatory in $z$, which requires $m^2(z) > 0$. If $m^2(z) \\le 0$, the solution is evanescent, and the wave cannot propagate. This condition, $m^2(z) \\le 0$, defines a **turning level**.\n\n**4. Vertical Flux of Horizontal Momentum**\n\nThe vertical flux of horizontal momentum per unit area is given by $F_m = \\rho_0 \\overline{u'w'}$, where the overbar denotes a horizontal average over one wavelength. We introduce the vertical parcel displacement $\\eta'(x, z)$. For small displacements, the vertical velocity is the total derivative of the displacement: $w' = \\frac{D\\eta'}{Dt} = (\\frac{\\partial}{\\partial t} + U\\frac{\\partial}{\\partial x})\\eta'$. For stationary waves ($\\partial/\\partial t = 0$), this simplifies to $w' = U\\frac{\\partial \\eta'}{\\partial x}$. For a single Fourier mode $\\eta'(x,z) = \\Re\\{\\hat{\\eta}(z) e^{ikx}\\}$, we have $\\hat{w}(z) = ikU(z)\\hat{\\eta}(z)$.\n\nThe kinematic boundary condition at the surface ($z=0$) forces the flow to follow the terrain $h(x)$. Thus, $\\eta'(x,0) = h(x)$. For a spectral component $h(x) = h_0 \\cos(kx)$, the complex amplitude of the displacement at the surface is $\\hat{\\eta}(0) = h_0$.\n\nTo find the momentum flux, we need to relate $u'$ and $\\eta'$. Combining the continuity equation $(3)$ and the relation between $w'$ and $\\eta'$:\n$$ \\frac{\\partial u'}{\\partial x} = -\\frac{\\partial w'}{\\partial z} = -\\frac{\\partial}{\\partial z}\\left(U\\frac{\\partial \\eta'}{\\partial x}\\right) = -U\\frac{\\partial^2 \\eta'}{\\partial x \\partial z} - \\frac{dU}{dz}\\frac{\\partial \\eta'}{\\partial x} $$\nIntegrating with respect to $x$ gives $u' = -U\\frac{\\partial \\eta'}{\\partial z} - \\frac{dU}{dz}\\eta'$. For upward energy propagation, the vertical structure of $\\eta'$ is proportional to $e^{imz}$. Under the WKB approximation ($\\partial_z \\gg \\frac{1}{U}\\frac{dU}{dz}$ etc.), we have $\\frac{\\partial \\eta'}{\\partial z} \\approx im\\eta'$, leading to $\\hat{u} \\approx -imU\\hat{\\eta}$.\n\nThe momentum flux is then:\n$F_m = \\frac{1}{2}\\rho_0 \\Re\\{\\hat{u}\\hat{w}^*\\}$. With $\\hat{u} \\approx -imU\\hat{\\eta}$ and $\\hat{w}^* = (ikU\\hat{\\eta})^* = -ikU\\hat{\\eta}^*$, this becomes\n$F_m = \\frac{1}{2}\\rho_0 \\Re\\{(-imU\\hat{\\eta})(-ikU\\hat{\\eta}^*)\\} = \\frac{1}{2}\\rho_0 \\Re\\{i^2(-1)mkU^2 |\\hat{\\eta}|^2\\} = \\frac{1}{2}\\rho_0 \\Re\\{mkU^2 |\\hat{\\eta}|^2\\}$. This should be negative. The correct physical relation for upward propagating waves with momentum flux opposing the mean flow yields:\n$$ F_m(z) = -\\frac{1}{2} \\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2 $$\nThe negative sign indicates a downward flux of horizontal momentum, which corresponds to a drag on the surface. For an upward propagating wave launched from the ground, the magnitude of this flux at the surface ($z=0$), denoted $J_0$, is:\n$$ J_0 = |F_m(0)| = \\frac{1}{2}\\rho_0 m_0 k U_0^2 h_0^2 $$\nwhere $U_0 = U(0)$, $N_0 = N(0)$, and $m_0 = \\sqrt{N_0^2/U_0^2 - k^2}$.\nFor a steady, non-dissipating wave, the vertical flux of horizontal momentum is conserved with height, i.e., $F_m(z) = F_m(0)$. Therefore, the magnitude $J(z) = J_0$ remains constant until the wave encounters a critical level, turning level, or breaks.\n\n**5. Saturation Criterion**\n\nWave breaking (saturation) occurs when the wave amplitude becomes too large, leading to convective instability. This happens when the total potential temperature gradient $\\partial\\theta/\\partial z$ becomes non-positive. This is equivalent to the condition $\\partial b/\\partial z \\le 0$ on the buoyancy $b = \\bar{b}(z)+b'(x,z)$. The onset criterion is $\\partial b'/\\partial z \\ge N^2$.\n\nFrom the thermodynamic equation $(5)$, we found $b' = -N^2\\eta'$. The saturation criterion is therefore:\n$$ \\frac{\\partial}{\\partial z}(-N^2 \\eta') \\ge N^2 \\implies -N^2 \\frac{\\partial \\eta'}{\\partial z} \\ge N^2 \\implies \\frac{\\partial \\eta'}{\\partial z} \\le -1 $$\nThe amplitude of the vertical gradient of displacement is $|\\frac{\\partial \\eta'}{\\partial z}| \\approx |im\\eta'| = m|\\hat{\\eta}|$. Thus, saturation occurs when the nonlinearity parameter $S(z) = m(z)|\\hat{\\eta}(z)|$ reaches a value of order unity. We set the threshold at $S(z) \\ge 1$.\n\nTo evaluate $S(z)$, we find $|\\hat{\\eta}(z)|$ from the conservation of momentum flux magnitude: $J_0 = \\frac{1}{2}\\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2$.\n$$ |\\hat{\\eta}(z)|^2 = \\frac{2 J_0}{\\rho_0 k m(z) U(z)^2} $$\nSubstituting this into the expression for $S(z)$:\n$$ S(z) = m(z) \\sqrt{\\frac{2 J_0}{\\rho_0 k m(z) U(z)^2}} = \\sqrt{\\frac{2 J_0 m(z)}{\\rho_0 k U(z)^2}} $$\nThe wave is considered to break at level $z_i$ if $S(z_i) \\ge 1$.\n\n**6. Algorithmic Procedure**\n\nThe algorithm for computing the vertical profile of momentum deposition is as follows.\nFor each atmospheric profile case:\n1. Initialize a total deposition array, $D[z_i]$, to zeros for all grid levels $z_i$.\n2. For each spectral component $(k, h_0)$:\n   a. Calculate background state $U_0=U(0)$, $N_0=N(0)$.\n   b. Calculate the surface vertical wavenumber squared: $m_0^2 = N_0^2/U_0^2 - k^2$.\n   c. If $m_0^2 \\le 0$, the wave is evanescent at the source. The momentum flux $J_0$ is zero. Proceed to the next component.\n   d. Otherwise, calculate the magnitude of the upward momentum flux at the surface: $J_0 = \\frac{1}{2}\\rho_0 m_0 k U_0^2 h_0^2$.\n   e. Propagate this flux vertically. Iterate from level $i=1$ to the top level ($z_i = 1000, 2000, ..., 10000$ m).\n      i. At level $z_i$, calculate $U_i=U(z_i)$ and $N_i=N(z_i)$.\n      ii. **Critical Level Check:** If $|U_i|  U_{\\mathrm{crit}}$, the wave is absorbed. Add $J_0$ to the deposition at this level, $D[z_i] += J_0$, and terminate propagation for this component (break the vertical loop).\n      iii. **Turning Level Check:** Calculate $m_i^2 = N_i^2/U_i^2 - k^2$. If $m_i^2 \\le 0$, the wave is reflected/trapped. The upward flux is terminated. Add $J_0$ to $D[z_i]$ and break the loop.\n      iv. **Saturation Check:** If the wave is still propagating, calculate the saturation parameter $S_i^2 = \\frac{2 J_0 m_i}{\\rho_0 k U_i^2}$, where $m_i=\\sqrt{m_i^2}$. If $S_i^2 \\ge 1$, the wave breaks. Add $J_0$ to $D[z_i]$ and break the loop.\n   f. If the loop completes without breaking, the wave's momentum flux escapes the top of the model domain and is not deposited.\n3. The final array $D$ represents the total momentum deposition profile for the case.\nThis procedure is repeated for all test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes orographic gravity wave drag deposition profiles for given atmospheric conditions.\n    \"\"\"\n    # Define constants\n    rho_0 = 1.0  # kg/m^3\n    U_crit = 0.5  # m/s\n\n    # Define vertical grid\n    z_levels = np.linspace(0, 10000, 11)  # 0, 1000, ..., 10000 meters\n\n    # Define Test Suite\n    test_suite = {\n        \"A\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 10.0 + 1.2 * (z / 1000.0),\n            \"components\": [\n                (5e-4, 200.0),\n                (3e-4, 150.0),\n                (8e-4, 100.0),\n            ]\n        },\n        \"B\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 12.0 - 3.0 * (z / 1000.0),\n            \"components\": [\n                (4e-4, 150.0),\n                (6e-4, 120.0),\n                (3e-4, 200.0),\n            ]\n        },\n        \"C\": {\n            \"N_func\": lambda z: 0.014 - 0.0008 * (z / 1000.0),\n            \"U_func\": lambda z: 15.0,\n            \"components\": [\n                (7e-4, 120.0),\n                (5e-4, 180.0),\n                (9e-4, 80.0),\n            ]\n        }\n    }\n\n    all_results = []\n\n    for case_id in [\"A\", \"B\", \"C\"]:\n        case_data = test_suite[case_id]\n        N_func = case_data[\"N_func\"]\n        U_func = case_data[\"U_func\"]\n        components = case_data[\"components\"]\n\n        total_deposition = np.zeros(len(z_levels))\n\n        for k, h0 in components:\n            # 1. Initialization at the lower boundary (z=0)\n            z0 = z_levels[0]\n            U0 = U_func(z0)\n            N0 = N_func(z0)\n            \n            # Ensure U0 is not at a critical level for flux calculation\n            if abs(U0)  1e-9:\n                continue # No wave launched\n\n            m_squared_0 = (N0**2 / U0**2) - k**2\n\n            # Check if the wave is propagating at the surface\n            if m_squared_0 = 0:\n                # Evanescent wave, no upward flux\n                continue\n\n            m0 = np.sqrt(m_squared_0)\n            \n            # Calculate magnitude of momentum flux at the surface\n            J0 = 0.5 * rho_0 * k * m0 * (U0 * h0)**2\n            \n            # 2. Vertical Propagation\n            flux_deposited = False\n            for i in range(1, len(z_levels)):\n                zi = z_levels[i]\n                Ui = U_func(zi)\n                Ni = N_func(zi)\n                \n                # Check for critical level\n                if abs(Ui)  U_crit:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n\n                m_squared_i = (Ni**2 / Ui**2) - k**2\n\n                # Check for turning level\n                if m_squared_i = 0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n                \n                mi = np.sqrt(m_squared_i)\n\n                # Check for saturation (wave breaking)\n                # Saturation criterion S^2 >= 1, where S^2 = (2 * J0 * m_i) / (rho_0 * k * U_i^2)\n                saturation_param_sq = (2.0 * J0 * mi) / (rho_0 * k * Ui**2)\n                if saturation_param_sq >= 1.0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n            \n            # The problem implies that if a wave reaches the top without breaking,\n            # its momentum is not deposited in the specified domain.\n            \n        # Format results for the current case\n        case_results_rounded = [round(val, 6) for val in total_deposition]\n        all_results.append(case_results_rounded)\n    \n    # Format the final output string as specified\n    formatted_case_results = []\n    for res_list in all_results:\n        formatted_list = f\"[{','.join(f'{x:.6f}' for x in res_list)}]\"\n        formatted_case_results.append(formatted_list)\n    \n    final_output_string = f\"[{','.join(formatted_case_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "Once a parameterization is implemented, it is essential to verify its correctness and diagnose its impact on the resolved flow. This practice introduces two powerful diagnostic techniques for analyzing drag within a model column by focusing on the fundamental principle of momentum conservation. You will compute the column-averaged drag first from the net momentum flux across the column boundaries, and then as a residual of the resolved momentum budget, demonstrating the consistency required for a robust model implementation. ",
            "id": "4073087",
            "problem": "You will design and implement a diagnostic to infer column-mean orographic and gravity wave drag accelerations from a vertical column of atmospheric data, using two independent principles: a flux-divergence method based on the vertical flux of horizontal momentum and a residual method based on the zonal momentum budget. The objectives are to show how the drag is related to fundamental conservation laws and to produce numerically consistent estimates. The setting is a one-dimensional vertical column over orography, suitable for Numerical Weather Prediction (NWP) and climate models, with specified profiles of height, density, momentum flux, and resolved tendency terms. Your program must compute a mass-weighted, column-mean drag acceleration for each test case using both diagnostics and verify their consistency.\n\nBase the derivation on the following universally applicable physical and mathematical principles:\n- The Reynolds-averaged, height-coordinate zonal momentum equation for a rotating, stratified atmosphere, vertically hydrostatic, states that the evolution of the resolved mean zonal wind $u$ involves advection, the Coriolis force, the horizontal pressure-gradient force, vertical diffusion of momentum, and unresolved (subgrid) drag processes such as gravity wave drag, which appear as a body-force acceleration per unit mass.\n- The vertical flux of zonal momentum is $F(z) \\equiv \\rho(z)\\,\\overline{u'(z) w'(z)}$, where $\\rho$ is density, $\\overline{\\cdot}$ is an average, and $(u',w')$ are turbulent or wave perturbations. The body force per unit mass associated with vertical flux divergence is $a(z) = -\\rho(z)^{-1}\\,\\partial F/\\partial z$.\n- The column-mass-weighted mean of any quantity $q(z)$ over $z \\in [z_{\\mathrm{bot}}, z_{\\mathrm{top}}]$ is \n$$\\bar{q} = \\dfrac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,q(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\n- Using the product rule and the fundamental theorem of calculus, the mass-weighted mean drag acceleration diagnosed from vertical flux divergence reduces to \n$$\\bar{a}_{\\mathrm{flux}} = \\dfrac{F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\nindependent of vertical structure inside the column.\n- The mass-weighted mean unresolved drag acceleration can also be diagnosed as the residual of the zonal momentum budget per unit mass: $a_{\\mathrm{res}}(z) \\equiv \\partial u/\\partial t - A - C - P - V$, where $A$ is the advection term, $C$ is the Coriolis term, $P$ is the horizontal pressure-gradient term, and $V$ is the vertical diffusion term. The column mass-weighted mean is \n$$\\bar{a}_{\\mathrm{res}} = \\dfrac{\\int \\rho\\,a_{\\mathrm{res}}\\,dz}{\\int \\rho\\,dz}$$\n\nYour program must:\n- For each test case, compute the mass column $\\int \\rho\\,dz$ using the trapezoidal rule on the provided height grid.\n- Compute the column-mean drag acceleration from the flux method, $\\bar{a}_{\\mathrm{flux}}$, using only the top and bottom values of $F$ and the mass column as above.\n- Compute the column-mean drag acceleration from the residual method, $\\bar{a}_{\\mathrm{res}}$, by first computing $a_{\\mathrm{res}}(z)$ at each level from the provided tendency terms, then integrating $\\rho\\,a_{\\mathrm{res}}$ with the trapezoidal rule and dividing by the mass column.\n- Return the two accelerations and a boolean indicating whether the absolute difference $|\\bar{a}_{\\mathrm{flux}} - \\bar{a}_{\\mathrm{res}}|$ is less than or equal to a tolerance of $\\varepsilon = 10^{-12}$.\n\nPhysical units and numerical requirements:\n- Heights $z$ are in meters ($\\mathrm{m}$), density $\\rho$ in kilograms per cubic meter ($\\mathrm{kg}\\,\\mathrm{m}^{-3}$), momentum flux $F$ in pascals ($\\mathrm{Pa}$), and accelerations in meters per second squared ($\\mathrm{m}\\,\\mathrm{s}^{-2}$).\n- Express all reported accelerations in $\\mathrm{m}\\,\\mathrm{s}^{-2}$, rounded to $9$ decimal places.\n\nTest suite:\nFor each test case, arrays are given at levels $z_k$, $k=0,\\dots,N$, inclusive of top and bottom. Use the arrays exactly as provided.\n\n- Test case $1$ (happy path: decreasing flux with height):\n  - Heights $z$ in $\\mathrm{m}$: [$0$, $2000$, $5000$, $10000$].\n  - Density $\\rho$ in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$: [$1.2$, $1.0$, $0.7$, $0.4$].\n  - Zonal momentum flux $F$ in $\\mathrm{Pa}$: [$0.05$, $0.03$, $0.01$, $0.00$].\n  - Zonal momentum budget terms in $\\mathrm{m}\\,\\mathrm{s}^{-2}$ at the same levels:\n    - $\\partial u/\\partial t$: [$6.666666666666667\\times 10^{-6}$, $6.666666666666667\\times 10^{-6}$, $6.666666666666667\\times 10^{-6}$, $6.666666666666667\\times 10^{-6}$].\n    - $A$: [$0$, $0$, $0$, $0$], $C$: [$0$, $0$, $0$, $0$], $P$: [$0$, $0$, $0$, $0$], $V$: [$0$, $0$, $0$, $0$].\n\n- Test case $2$ (boundary condition: zero net flux and zero residual):\n  - Heights $z$ in $\\mathrm{m}$: [$0$, $1000$, $3000$, $7000$].\n  - Density $\\rho$ in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$: [$1.1$, $1.0$, $0.8$, $0.5$].\n  - Zonal momentum flux $F$ in $\\mathrm{Pa}$: [$0.02$, $0.02$, $0.02$, $0.02$].\n  - Zonal momentum budget terms in $\\mathrm{m}\\,\\mathrm{s}^{-2}$:\n    - $\\partial u/\\partial t$: [$0$, $0$, $0$, $0$].\n    - $A$: [$0$, $0$, $0$, $0$], $C$: [$0$, $0$, $0$, $0$], $P$: [$0$, $0$, $0$, $0$], $V$: [$0$, $0$, $0$, $0$].\n\n- Test case $3$ (edge case: opposing signs and variable density):\n  - Heights $z$ in $\\mathrm{m}$: [$0$, $1000$, $3000$, $6000$, $9000$, $12000$].\n  - Density $\\rho$ in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$: [$1.2$, $1.1$, $0.9$, $0.7$, $0.5$, $0.35$].\n  - Zonal momentum flux $F$ in $\\mathrm{Pa}$: [$-0.01$, $-0.005$, $0.0$, $0.015$, $0.025$, $0.03$].\n  - Zonal momentum budget terms in $\\mathrm{m}\\,\\mathrm{s}^{-2}$:\n    - $\\partial u/\\partial t$: [$-4.637681159420289\\times 10^{-6}$, $-4.637681159420289\\times 10^{-6}$, $-4.637681159420289\\times 10^{-6}$, $-4.637681159420289\\times 10^{-6}$, $-4.637681159420289\\times 10^{-6}$, $-4.637681159420289\\times 10^{-6}$].\n    - $A$: [$0$, $0$, $0$, $0$, $0$, $0$], $C$: [$0$, $0$, $0$, $0$, $0$, $0$], $P$: [$0$, $0$, $0$, $0$, $0$, $0$], $V$: [$0$, $0$, $0$, $0$, $0$, $0$].\n\nFinal output format:\n- Your program should produce a single line of output containing a comma-separated list of results for the three test cases, enclosed in square brackets. Each test case result must itself be a list with three elements: the flux-diagnosed column-mean acceleration $\\bar{a}_{\\mathrm{flux}}$ in $\\mathrm{m}\\,\\mathrm{s}^{-2}$ rounded to $9$ decimal places, the residual-diagnosed column-mean acceleration $\\bar{a}_{\\mathrm{res}}$ in $\\mathrm{m}\\,\\mathrm{s}^{-2}$ rounded to $9$ decimal places, and a boolean indicating whether the absolute difference is less than or equal to $\\varepsilon = 10^{-12}$. For example, the output format is [[a1_flux,a1_resid,ok1],[a2_flux,a2_resid,ok2],[a3_flux,a3_resid,ok3]] with no additional text.",
            "solution": "The problem requires the design of a diagnostic procedure to compute the column-mean subgrid-scale (SGS) drag acceleration in an atmospheric column. This is a common task in the evaluation of numerical weather prediction (NWP) and climate models, where processes like orographic drag and gravity wave drag occur at scales smaller than the model grid and must be parameterized. We are asked to implement two independent methods based on fundamental physical principles and verify their consistency. The first method uses the vertical divergence of the momentum flux, while the second diagnoses the drag as the residual in the zonal momentum budget.\n\nThe physical setting is a one-dimensional vertical column, where atmospheric properties are functions of height $z$ only. The analysis is based on the Reynolds-averaged zonal momentum equation.\n\n**Method 1: Flux-Divergence Diagnostic**\n\nThis method directly calculates the effect of the vertical transport of momentum by unresolved waves and turbulence. The vertical flux of zonal momentum is given as $F(z) = \\rho(z)\\,\\overline{u'(z) w'(z)}$, where $\\rho$ is the air density and $u'$, $w'$ are perturbations to the zonal and vertical velocities, respectively. The divergence of this flux acts as a body force on the mean flow. The acceleration (force per unit mass) at a given height $z$ is:\n$$a(z) = -\\frac{1}{\\rho(z)} \\frac{\\partial F(z)}{\\partial z}$$\nWe are interested in the mass-weighted mean acceleration over the entire atmospheric column, from a bottom height $z_{\\mathrm{bot}}$ to a top height $z_{\\mathrm{top}}$. The mass-weighted mean of any quantity $q(z)$ is defined as:\n$$\\bar{q} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,q(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\nApplying this definition to the drag acceleration $a(z)$, we get the mean flux-divergence acceleration, $\\bar{a}_{\\mathrm{flux}}$:\n$$\\bar{a}_{\\mathrm{flux}} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z) \\left( -\\frac{1}{\\rho(z)} \\frac{\\partial F}{\\partial z} \\right) dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{-\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\frac{\\partial F}{\\partial z} dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz}$$\nBy the Fundamental Theorem of Calculus, the integral of the derivative $\\partial F/\\partial z$ simplifies to the difference in $F$ at the boundaries of the integration domain:\n$$\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\frac{\\partial F}{\\partial z} dz = F(z_{\\mathrm{top}}) - F(z_{\\mathrm{bot}})$$\nSubstituting this back into the expression for $\\bar{a}_{\\mathrm{flux}}$ yields the final, elegant formula:\n$$\\bar{a}_{\\mathrm{flux}} = \\frac{-(F(z_{\\mathrm{top}}) - F(z_{\\mathrm{bot}}))}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})}{M}$$\nwhere $M = \\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz$ is the total mass of the atmospheric column per unit horizontal area.\n\nNumerically, this calculation is straightforward. The numerator, $F(z_{\\mathrm{bot}}) - F(z_{\\mathrm{top}})$, is obtained from the first and last elements of the provided momentum flux array $F$. The denominator, the column mass $M$, is computed by applying the trapezoidal rule to the provided height $z$ and density $\\rho$ arrays.\n\n**Method 2: Momentum Budget Residual Diagnostic**\n\nThis method relies on the principle of conservation of momentum. The time rate of change of the resolved zonal momentum, $\\partial u/\\partial t$, is balanced by the sum of all resolved forcing terms and the unresolved (SGS) drag acceleration, which we can denote as $a(z)$. The zonal momentum equation can be written as:\n$$\\frac{\\partial u}{\\partial t} = A + C + P + V + a(z)$$\nwhere $A$ is advection, $C$ is the Coriolis force, $P$ is the horizontal pressure-gradient force, and $V$ is vertical diffusion. By rearranging the equation, we can diagnose this drag as the residual of the momentum budget, which we call $a_{\\mathrm{res}}(z)$:\n$$a_{\\mathrm{res}}(z) = \\frac{\\partial u}{\\partial t}(z) - A(z) - C(z) - P(z) - V(z)$$\nTo find the column-mean drag, we compute the mass-weighted average of $a_{\\mathrm{res}}(z)$:\n$$\\bar{a}_{\\mathrm{res}} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,a_{\\mathrm{res}}(z)\\,dz}{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,dz} = \\frac{\\int_{z_{\\mathrm{bot}}}^{z_{\\mathrm{top}}} \\rho(z)\\,a_{\\mathrm{res}}(z)\\,dz}{M}$$\nThe column mass $M$ in the denominator is identical to that calculated for the flux-divergence method.\n\nThe numerical implementation involves two steps. First, we compute the profile of the residual acceleration, $a_{\\mathrm{res}}(z_k)$, at each vertical level $k$ by element-wise subtraction of the given forcing-term arrays from the tendency array $\\partial u/\\partial t$. Second, we compute the numerator of the expression for $\\bar{a}_{\\mathrm{res}}$ by applying the trapezoidal rule to the product of the density array $\\rho$ and the newly computed residual acceleration array $a_{\\mathrm{res}}$. The result is then divided by the previously computed column mass $M$.\n\n**Consistency Verification**\n\nThe two methods, yielding $\\bar{a}_{\\mathrm{flux}}$ and $\\bar{a}_{\\mathrm{res}}$, are derived from the same underlying momentum conservation principle. Therefore, if the provided data is physically consistent and the numerical methods are implemented correctly, the two diagnostics must yield the same result. The problem statement provides test cases specifically constructed to be consistent. The verification step, $|\\bar{a}_{\\mathrm{flux}} - \\bar{a}_{\\mathrm{res}}| \\le \\varepsilon$ with a small tolerance $\\varepsilon = 10^{-12}$, serves as a crucial check on the correctness of the implementation. The small non-zero tolerance accounts for potential floating-point representation differences between the two computational paths.\n\nThe implementation will utilize the `numpy` library for efficient array operations and its `trapz` function for accurate trapezoidal integration. For each test case, the program will calculate both $\\bar{a}_{\\mathrm{flux}}$ and $\\bar{a}_{\\mathrm{res}}$ and perform the consistency check, before formatting the results to the specified precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes column-mean orographic and gravity wave drag accelerations\n    from atmospheric data using two independent methods and verifies\n    their consistency.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"z\": np.array([0, 2000, 5000, 10000], dtype=float),\n            \"rho\": np.array([1.2, 1.0, 0.7, 0.4], dtype=float),\n            \"F\": np.array([0.05, 0.03, 0.01, 0.00], dtype=float),\n            \"du_dt\": np.array([6.666666666666667e-6] * 4, dtype=float),\n            \"A\": np.array([0.0] * 4, dtype=float), \n            \"C\": np.array([0.0] * 4, dtype=float), \n            \"P\": np.array([0.0] * 4, dtype=float), \n            \"V\": np.array([0.0] * 4, dtype=float)\n        },\n        {\n            \"z\": np.array([0, 1000, 3000, 7000], dtype=float),\n            \"rho\": np.array([1.1, 1.0, 0.8, 0.5], dtype=float),\n            \"F\": np.array([0.02, 0.02, 0.02, 0.02], dtype=float),\n            \"du_dt\": np.array([0.0] * 4, dtype=float),\n            \"A\": np.array([0.0] * 4, dtype=float), \n            \"C\": np.array([0.0] * 4, dtype=float), \n            \"P\": np.array([0.0] * 4, dtype=float), \n            \"V\": np.array([0.0] * 4, dtype=float)\n        },\n        {\n            \"z\": np.array([0, 1000, 3000, 6000, 9000, 12000], dtype=float),\n            \"rho\": np.array([1.2, 1.1, 0.9, 0.7, 0.5, 0.35], dtype=float),\n            \"F\": np.array([-0.01, -0.005, 0.0, 0.015, 0.025, 0.03], dtype=float),\n            \"du_dt\": np.array([-4.637681159420289e-6] * 6, dtype=float),\n            \"A\": np.array([0.0] * 6, dtype=float), \n            \"C\": np.array([0.0] * 6, dtype=float), \n            \"P\": np.array([0.0] * 6, dtype=float), \n            \"V\": np.array([0.0] * 6, dtype=float)\n        },\n    ]\n\n    results = []\n    tolerance = 1e-12\n\n    for case in test_cases:\n        z, rho, F = case[\"z\"], case[\"rho\"], case[\"F\"]\n        du_dt, A, C, P, V = case[\"du_dt\"], case[\"A\"], case[\"C\"], case[\"P\"], case[\"V\"]\n\n        # Calculate total column mass M using the trapezoidal rule.\n        # M = integral(rho * dz)\n        column_mass = np.trapz(rho, z)\n        \n        # Method 1: Flux-Divergence Diagnostic\n        # a_flux = (F_bot - F_top) / M\n        F_bot = F[0]\n        F_top = F[-1]\n        a_flux = (F_bot - F_top) / column_mass\n        \n        # Method 2: Momentum Budget Residual Diagnostic\n        # a_res(z) = du/dt - A - C - P - V\n        # a_res_mean = integral(rho * a_res(z) * dz) / M\n        a_res_profile = du_dt - A - C - P - V\n        \n        # Numerator is the integrated total force on the column\n        total_residual_force = np.trapz(rho * a_res_profile, z)\n        a_res = total_residual_force / column_mass\n        \n        # Consistency Check\n        is_consistent = np.abs(a_flux - a_res) = tolerance\n        \n        # Store results for final formatting\n        results.append([a_flux, a_res, is_consistent])\n\n    # Final print statement in the exact required format.\n    # Format accelerations to 9 decimal places and boolean as True/False.\n    result_strings = []\n    for res_list in results:\n        # Format numbers to 9 decimal places, and boolean to standard string\n        str_list = [\n            f\"{res_list[0]:.9f}\",\n            f\"{res_list[1]:.9f}\",\n            str(res_list[2])\n        ]\n        result_strings.append(f\"[{','.join(str_list)}]\")\n        \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}