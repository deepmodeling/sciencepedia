{
    "hands_on_practices": [
        {
            "introduction": "在质量通量方案中，一个核心的物理约束是质量守恒，它要求强烈的局地对流上升气流必须由周围环境中大范围的、缓慢的下沉运动来补偿。这个练习将引导你从非弹性连续性方程出发，推导出这一基本关系，并量化在给定对流羽流活动情况下的环境补偿下沉速度 。理解这一补偿机制对于正确模拟对流与大尺度环流的相互作用至关重要。",
            "id": "4062680",
            "problem": "在用于数值天气预报的非弹性大气模式的水平均匀网格列中，某一固定高度的次网格对流场被划分为三个不相交的子域：上升气流羽、下沉气流羽及其环境。设相应的水平面积分数分别为 $a_u$、$a_d$ 和 $a_e$，其中 $a_e = 1 - a_u - a_d$。假设该模式使用非弹性近似，并具有水平周期性区域和不可渗透的上下边界，因此区域平均垂直质量通量受到边界条件的约束。\n\n在高度 $z = 2\\ \\mathrm{km}$ 处，假设诊断出以下数据：\n- 上升气流面积分数 $a_u = 0.02$，\n- 下沉气流面积分数 $a_d = 0.01$，\n- 上升气流平均垂直速度 $w_u = 5.0\\ \\mathrm{m\\,s^{-1}}$（向上为正），\n- 下沉气流平均垂直速度 $w_d = -2.0\\ \\mathrm{m\\,s^{-1}}$（向下为负），\n- 环境气压 $p = 800\\ \\mathrm{hPa}$，\n- 环境温度 $T = 290\\ \\mathrm{K}$。\n\n将空气视为理想气体，其干空气比气体常数为 $R_d = 287\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$。从非弹性连续性方程 $\\nabla \\cdot (\\rho \\boldsymbol{v}) = 0$ 以及对三个子域进行水平平均的定义出发，推导在给定高度上联系这三个子域的面积分数加权垂直质量通量的约束条件。然后，利用此约束条件以及关于 $a_e$ 的恒等式，计算 $z=2\\ \\mathrm{km}$ 处的环境平均垂直速度 $\\overline{w}_e$。\n\n将 $\\overline{w}_e$ 的最终答案以 $\\mathrm{m\\,s^{-1}}$ 为单位表示，并将结果四舍五入到四位有效数字。",
            "solution": "该问题要求推导次网格尺度对流方案中垂直速度的约束条件，并随后计算环境垂直速度 $\\overline{w}_e$。推导从非弹性连续性方程开始，并应用了特定边界条件下的水平平均原理。\n\n### 步骤 1：推导平均垂直质量通量约束条件\n\n所给定的控制方程是非弹性连续性方程：\n$$ \\nabla \\cdot (\\rho \\boldsymbol{v}) = 0 $$\n在笛卡尔坐标系中，其中 $\\boldsymbol{v} = (u, v, w)$，该方程为：\n$$ \\frac{\\partial (\\rho u)}{\\partial x} + \\frac{\\partial (\\rho v)}{\\partial y} + \\frac{\\partial (\\rho w)}{\\partial z} = 0 $$\n我们对整个网格列面积 $A$ 进行水平平均，记为 $\\langle \\cdot \\rangle$。平均算子定义为 $\\langle f \\rangle = \\frac{1}{A} \\iint_A f(x, y) \\,dx\\,dy$。\n对连续性方程进行平均得到：\n$$ \\left\\langle \\frac{\\partial (\\rho u)}{\\partial x} + \\frac{\\partial (\\rho v)}{\\partial y} \\right\\rangle + \\left\\langle \\frac{\\partial (\\rho w)}{\\partial z} \\right\\rangle = 0 $$\n第一项是水平质量通量散度 $\\nabla_h \\cdot (\\rho \\boldsymbol{v}_h)$ 的水平平均。对于问题中说明的水平周期性区域，水平散度的平均值为零。这可以用二维散度定理来证明，即区域相对两侧的边界积分相互抵消。\n因此，平均后的方程简化为：\n$$ \\left\\langle \\frac{\\partial (\\rho w)}{\\partial z} \\right\\rangle = 0 $$\n由于平均区域在水平方向上是固定的，平均算子和垂直偏导数可以交换次序：\n$$ \\frac{\\partial}{\\partial z} \\langle \\rho w \\rangle = 0 $$\n这个结果意味着区域平均垂直质量通量 $\\langle \\rho w \\rangle$ 不随高度 $z$ 变化。\n\n问题指明了不可渗透的上下边界。在这些边界处（例如，在 $z=0$ 和 $z=z_{top}$），对于所有 $(x, y)$，垂直速度 $w$ 都必须为零。因此，这些边界处的平均垂直质量通量也为零：\n$$ \\langle \\rho w \\rangle \\big|_{z=0, z_{top}} = \\langle \\rho \\cdot 0 \\rangle = 0 $$\n由于 $\\langle \\rho w \\rangle$ 随高度恒定，因此它在所有高度上都必须为零。所以，我们得到了在任意高度 $z$ 对整个网格列的基本约束：\n$$ \\langle \\rho w \\rangle = 0 $$\n\n### 步骤 2：应用非弹性近似和子域划分\n\n非弹性近似的一个关键特征，尤其是在本文所使用的背景下，是连续性方程中的密度 $\\rho$ 由一个仅依赖于高度且水平均匀的参考态密度 $\\rho_0(z)$ 来表示。问题陈述中使用的 $\\rho$ 应被解释为这个参考密度，即 $\\rho = \\rho_0(z)$。这是一个标准公式，它通过动量和热力学方程（此处未使用）中的密度扰动来保留浮力效应，同时滤除声波。\n\n当 $\\rho = \\rho_0(z)$ 时，密度在任何水平面上都是常数。因此，可以将其从水平平均中提取出来：\n$$ \\langle \\rho_0(z) w \\rangle = \\rho_0(z) \\langle w \\rangle = 0 $$\n由于 $\\rho_0(z)$ 非零，这导致了对垂直体积通量的一个简化但强有力的约束：区域平均垂直速度在所有高度上都必须为零。\n$$ \\langle w \\rangle = 0 $$\n问题陈述，水平网格列被划分为三个子域：上升气流（$u$）、下沉气流（$d$）和环境（$e$）。任何量的水平平均都可以表示为各个子域上的平均值与其各自面积分数（$a_u, a_d, a_e$）加权的和。将此分解应用于垂直速度 $w$：\n$$ \\langle w \\rangle = a_u \\overline{w}_u + a_d \\overline{w}_d + a_e \\overline{w}_e $$\n其中 $\\overline{w}_u$、$\\overline{w}_d$ 和 $\\overline{w}_e$ 分别是上升气流、下沉气流和环境子域内的平均垂直速度。\n\n结合最后两个方程，得到联系三个子域垂直速度的约束条件的最终形式：\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d + a_e \\overline{w}_e = 0 $$\n该方程表示网格列内垂直体积通量的守恒，这是给定边界条件下非弹性连续性方程的直接推论。环境气压 $p$、温度 $T$ 和气体常数 $R_d$ 在此计算中并不需要，因为密度项 $\\rho_0(z)$ 已被提出并消去。\n\n### 步骤 3：计算环境垂直速度\n\n我们的任务是计算 $\\overline{w}_e$。我们可以重新排列约束方程以求解 $\\overline{w}_e$：\n$$ a_e \\overline{w}_e = - (a_u \\overline{w}_u + a_d \\overline{w}_d) $$\n$$ \\overline{w}_e = - \\frac{a_u \\overline{w}_u + a_d \\overline{w}_d}{a_e} $$\n我们还给出了面积分数的恒等式：\n$$ a_e = 1 - a_u - a_d $$\n给定的数值为：\n- 上升气流面积分数 $a_u = 0.02$\n- 下沉气流面积分数 $a_d = 0.01$\n- 上升气流平均垂直速度 $\\overline{w}_u = 5.0\\ \\mathrm{m\\,s^{-1}}$\n- 下沉气流平均垂直速度 $\\overline{w}_d = -2.0\\ \\mathrm{m\\,s^{-1}}$\n\n首先，我们计算环境面积分数 $a_e$：\n$$ a_e = 1 - 0.02 - 0.01 = 0.97 $$\n接下来，我们计算分子项，即来自气流羽的净垂直速度贡献：\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d = (0.02)(5.0\\ \\mathrm{m\\,s^{-1}}) + (0.01)(-2.0\\ \\mathrm{m\\,s^{-1}}) $$\n$$ a_u \\overline{w}_u + a_d \\overline{w}_d = 0.10\\ \\mathrm{m\\,s^{-1}} - 0.02\\ \\mathrm{m\\,s^{-1}} = 0.08\\ \\mathrm{m\\,s^{-1}} $$\n最后，我们将这些值代入 $\\overline{w}_e$ 的表达式中：\n$$ \\overline{w}_e = - \\frac{0.08\\ \\mathrm{m\\,s^{-1}}}{0.97} $$\n$$ \\overline{w}_e \\approx -0.0824742268\\ \\mathrm{m\\,s^{-1}} $$\n问题要求将结果四舍五入到四位有效数字。\n$$ \\overline{w}_e \\approx -0.08247\\ \\mathrm{m\\,s^{-1}} $$\n这个结果表明，在环境中存在一个微弱的大尺度下沉运动，这在物理上是必要的，用以补偿对流羽内部强烈的局地垂直运动，从而确保整个网格列的净垂直输送为零。",
            "answer": "$$ \\boxed{-0.08247} $$"
        },
        {
            "introduction": "在建立了质量平衡的约束之后，参数化方案的核心挑战便是决定对流的强度，这通常由云底质量通量来表征。这个问题，即“闭合问题”，至今仍是模式发展的活跃领域。本练习将通过比较两种经典的闭合假设来让你深入了解此问题：一种基于大尺度水汽收支平衡（Tiedtke类型闭合），另一种则基于对流有效位能（CAPE）所代表的浮力能 。",
            "id": "4062682",
            "problem": "一个数值天气预报模式中的海洋热带网格框表现出有组织的深对流。您的任务是使用植根于质量通量对流方案和夹卷羽流模型中的两种不同闭合概念来预测云底质量通量，然后对它们进行比较。\n\n假设以下环境和羽流属性，这些属性对于对流边界层都具有代表性且物理上合理：\n\n- 云底气压 $p_b = 9.0 \\times 10^{4} \\, \\mathrm{Pa}$，温度 $T_b = 2.99 \\times 10^{2} \\, \\mathrm{K}$，以及比湿 $q_b = 1.4 \\times 10^{-2}$。\n- 大尺度、整层积分的天气尺度水汽辐合 $\\mathcal{C}_q = 1.20 \\times 10^{-4} \\, \\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$。\n- 云顶（砧状云）出流比湿 $q_d = 1.0 \\times 10^{-3}$。\n- 降水效率 $\\varepsilon = 0.70$（凝结水中形成降水的部分）。\n- 入流羽流的边界层湿静力能 $h_b = 3.53 \\times 10^{5} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1}$ 和云底的环境湿静力能 $h_{e,b} = 3.47 \\times 10^{5} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1}$。\n- 从自由对流高度到中性浮力高度的深度 $\\Delta z = 3.50 \\times 10^{3} \\, \\mathrm{m}$，以及云底上升气流面积分数 $\\sigma_b = 4.0 \\times 10^{-3}$。\n- 从浮力功到上升气流动能的能量转换效率 $\\eta = 0.15$。\n- 干空气气体常数 $R_d = 2.87 \\times 10^{2} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，定压比热 $c_p = 1.004 \\times 10^{3} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，重力加速度 $g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2}$。\n\n使用以下基于物理的基础：\n\n1. 统计稳态下的整层水汽收支将对流凝结率与大尺度天气尺度水汽辐合联系起来。\n2. 对流有效位能 (CAPE)，定义为气块浮力的垂直积分，衡量可用于加速上升气流的浮力功，从而能够通过能量转换估算云底上升气流速度的动能。\n3. 虚温 $T_v$ 通过 $T_v = T_b \\left(1 + 0.61 \\, q_b \\right)$ 来解释湿空气密度效应，云底密度为 $\\rho_b = p_b / (R_d \\, T_v)$。\n\n假设羽流从云底近似湿绝热上升，使得气块湿静力能 $h_b$ 在达到饱和前近似守恒，并且云底的初始气块浮力与相对于环境的湿静力能过量成正比。为简便起见，假设浮力在 $\\Delta z$ 深度上线性减小至零。\n\n任务：\n\n- 根据整层水汽收支，推导并计算由Tiedtke型水汽辐合闭合方案预测的云底质量通量，答案以 $\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$ 为单位表示。\n- 根据CAPE定义和能量转换，推导并计算一个基于CAPE的云底质量通量估算值，答案以 $\\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$ 为单位表示。\n- 最后，将Tiedtke型质量通量与基于CAPE的质量通量之比报告为一个无量纲数。将您的最终比率四舍五入至三位有效数字。",
            "solution": "该问题要求计算并比较从两种不同的对流参数化闭合假设（水汽辐合闭合和基于CAPE的闭合）得出的云底质量通量。\n\n首先，我们处理Tiedtke型水汽辐合闭合方案。该闭合方案基于大气柱的稳态水汽收支。在此框架中，给定的大尺度水汽辐合 $\\mathcal{C}_q = 1.20 \\times 10^{-4} \\, \\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$ 由降水率 $P$ 平衡。\n$$P = \\mathcal{C}_q$$\n降水率通过降水效率 $\\varepsilon = 0.70$ 与对流系统内的总凝结率 $C$ 相关。\n$$P = \\varepsilon C$$\n通过结合这两个方程，我们可以用已知的大尺度水汽辐合来表示总凝结率：\n$$C = \\frac{\\mathcal{C}_q}{\\varepsilon}$$\n在一个简单的羽流模型中，总凝结量是对流上升气流处理过的空气中去除的水汽量。这可以表示为云底质量通量（我们将其表示为 $M_{b, \\text{Tiedtke}}$）与进入云底的空气（$q_b = 1.4 \\times 10^{-2}$）和从云顶出流的空气（$q_d = 1.0 \\times 10^{-3}$）之间的比湿变化量的乘积。\n$$C = M_{b, \\text{Tiedtke}} (q_b - q_d)$$\n通过令 $C$ 的两个表达式相等，我们可以推导出云底质量通量的公式：\n$$\\frac{\\mathcal{C}_q}{\\varepsilon} = M_{b, \\text{Tiedtke}} (q_b - q_d)$$\n$$M_{b, \\text{Tiedtke}} = \\frac{\\mathcal{C}_q}{\\varepsilon (q_b - q_d)}$$\n代入所提供的数值：\n$$M_{b, \\text{Tiedtke}} = \\frac{1.20 \\times 10^{-4}}{0.70 \\times (1.4 \\times 10^{-2} - 1.0 \\times 10^{-3})} = \\frac{1.20 \\times 10^{-4}}{0.70 \\times 0.013} = \\frac{1.20 \\times 10^{-4}}{0.0091} \\approx 0.013187 \\, \\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$$\n\n其次，我们确定基于CAPE的云底质量通量估算值，记为 $M_{b, \\text{CAPE}}$。网格平均质量通量的定义由云内密度 $\\rho_b$、上升气流面积分数 $\\sigma_b$ 和上升气流垂直速度 $w_b$ 的乘积给出，所有这些都在云底进行评估。\n$$M_{b, \\text{CAPE}} = \\rho_b \\sigma_b w_b$$\n我们必须首先计算密度 $\\rho_b$ 和上升气流速度 $w_b$。密度是使用湿空气的理想气体定律确定的，这需要虚温 $T_v$。给定 $p_b = 9.0 \\times 10^{4} \\, \\mathrm{Pa}$，$T_b = 2.99 \\times 10^{2} \\, \\mathrm{K}$，和 $q_b = 1.4 \\times 10^{-2}$：\n$$T_v = T_b (1 + 0.61 q_b) = (2.99 \\times 10^{2}) \\times (1 + 0.61 \\times 1.4 \\times 10^{-2}) = 299 \\times 1.00854 = 301.55346 \\, \\mathrm{K}$$\n使用干空气气体常数 $R_d = 2.87 \\times 10^{2} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$，密度为：\n$$\\rho_b = \\frac{p_b}{R_d T_v} = \\frac{9.0 \\times 10^4}{2.87 \\times 10^2 \\times 301.55346} \\approx 1.0399 \\, \\mathrm{kg} \\, \\mathrm{m}^{-3}$$\n上升气流速度 $w_b$ 是从羽流的动能推导出来的，该动能被假定为对流有效位能 (CAPE) 的一部分，比例为 $\\eta = 0.15$。\n$$\\frac{1}{2} w_b^2 = \\eta \\, \\mathrm{CAPE}$$\nCAPE本身是气块浮力 $B(z)$ 的垂直积分。问题指明，浮力在对流深度 $\\Delta z = 3.50 \\times 10^{3} \\, \\mathrm{m}$ 上从其云底值 $B_b$ 线性减小到零。这意味着 $\\mathrm{CAPE} = \\frac{1}{2} B_b \\Delta z$。云底的浮力被认为与羽流（$h_b = 3.53 \\times 10^{5} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1}$）相对于其环境（$h_{e,b} = 3.47 \\times 10^{5} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1}$）的过剩湿静力能成正比，使用以下近似式：\n$$B_b \\approx \\frac{g}{c_p T_v} (h_b - h_{e,b})$$\n在 $g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2}$ 和 $c_p = 1.004 \\times 10^{3} \\, \\mathrm{J} \\, \\mathrm{kg}^{-1} \\, \\mathrm{K}^{-1}$ 的条件下：\n$$B_b \\approx \\frac{9.81}{1.004 \\times 10^3 \\times 301.55346} (3.53 \\times 10^5 - 3.47 \\times 10^5) = \\frac{9.81 \\times 6000}{302760} \\approx 0.19451 \\, \\mathrm{m} \\, \\mathrm{s}^{-2}$$\n我们现在通过代入CAPE的表达式来求上升气流速度 $w_b$：\n$$w_b = \\sqrt{2 \\eta \\, \\mathrm{CAPE}} = \\sqrt{2 \\eta \\left(\\frac{1}{2} B_b \\Delta z\\right)} = \\sqrt{\\eta B_b \\Delta z}$$\n$$w_b = \\sqrt{0.15 \\times 0.19451 \\times 3.50 \\times 10^3} \\approx \\sqrt{102.12} \\approx 10.105 \\, \\mathrm{m} \\, \\mathrm{s}^{-1}$$\n最后，我们组合各分量，使用 $\\sigma_b = 4.0 \\times 10^{-3}$ 来计算基于CAPE的质量通量：\n$$M_{b, \\text{CAPE}} = \\rho_b \\sigma_b w_b \\approx 1.0399 \\times (4.0 \\times 10^{-3}) \\times 10.105 \\approx 0.042035 \\, \\mathrm{kg} \\, \\mathrm{m}^{-2} \\, \\mathrm{s}^{-1}$$\n\n最后的任务是计算Tiedtke型质量通量与基于CAPE的质量通量之比。\n$$\\text{Ratio} = \\frac{M_{b, \\text{Tiedtke}}}{M_{b, \\text{CAPE}}} \\approx \\frac{0.013187}{0.042035} \\approx 0.3137$$\n根据题目要求，将此结果四舍五入至三位有效数字：\n$$\\text{Ratio} \\approx 0.314$$",
            "answer": "$$\\boxed{0.314}$$"
        },
        {
            "introduction": "当我们通过闭合假设确定了对流羽流的质量通量廓线后，最后一步就是计算它如何改变模式中的大气状态。这个实践练习将指导你实现一个核心算法，用于计算由对流羽流的垂直输送和夹出过程所引起的温度和湿度倾向 。这是将参数化方案的物理概念转化为模式预报变量具体变化的实践关键。",
            "id": "4062651",
            "problem": "给定一个离散为多层的一维大气柱，适用于数值天气预报（NWP）。每一层代表环境，并且存在一个具有已知上升气流温度和上升气流比湿廓线的单一上升气流羽流。该羽流的特征在于其向上的质量通量和夹出率，后者作为环境标量的局地源。您的任务是从第一性原理（在控制体积内使用质量和标量守恒）推导出一个离散算法，用于计算由对流输送和夹出引起的环境温度和比湿倾向，然后实现该算法，为提供的测试集计算倾向。\n\n使用的基本原理：\n- 控制体积中的标量守恒：对于任何标量 $\\chi$，在厚度为 $\\Delta z$ 的层中，$\\rho \\chi$ 的变化率等于穿过其界面的净通量加上层内的任何源项。这里 $\\rho$ 是空气密度。\n- 对流输送由一个参数化的垂直通量 $F_{\\chi}$ 表示，该通量基于质量通量羽流，使用上升气流羽流属性与环境之间的差异构建。\n- 夹出在每一层内作为环境标量的局地源，其大小与夹出率和羽流质量通量的乘积成正比。\n\n应用的定义和建模选择：\n- 设层指数为 $k \\in \\{0,1,\\dots,N-1\\}$，层厚度为 $\\Delta z_k$，密度为 $\\rho_k$，环境温度为 $T_{e,k}$，比湿为 $q_{e,k}$。\n- 上升气流羽流的层中心值为 $T_{u,k}$ 和 $q_{u,k}$，以及层中心质量通量 $M_k$。\n- 层中心的夹出率为 $\\delta_k$，单位为 $\\mathrm{m}^{-1}$。\n- 层界面处标量的对流输送通量模型为 $F_{\\chi} = M \\left(\\chi_u - \\chi_e\\right)$，在界面上进行评估。\n- 对于任何变量 $\\psi_k$，从层中心到界面的映射应通过层 $k$ 和 $k+1$ 之间界面的算术平均值计算：$\\psi_{k+1/2} = \\frac{1}{2}\\left(\\psi_k + \\psi_{k+1}\\right)$。\n- 边界条件：底部边界（$k=-\\frac{1}{2}$）的 $F_{\\chi}$ 必须设为 $0$，顶部边界（$k=N-\\frac{1}{2}$）的 $F_{\\chi}$ 必须设为 $0$。\n- 层内标量 $\\chi$ 的夹出源模型为 $S_{\\chi,k} = \\delta_k M_k \\left(\\chi_{u,k} - \\chi_{e,k}\\right)$。\n\n根据上述原理，基于净界面通量和层内夹出源，推导对流引起的温度和比湿的环境倾向的离散表达式。实现推导出的算法，为以下测试集计算倾向。温度倾向以 $\\mathrm{K/s}$ 表示，比湿倾向以 $\\mathrm{s}^{-1}$ 表示，并将每个倾向值四舍五入到六位小数。\n\n测试集：\n- 案例 A（理想情况，四层）：\n  - $N = 4$\n  - $\\Delta z = [1000, 1000, 1000, 1000]$ 米\n  - $\\rho = [1.2, 1.1, 1.0, 0.9]$ 千克/立方米\n  - $T_e = [300.0, 296.0, 292.0, 288.0]$ 开尔文\n  - $T_u = [302.0, 298.0, 294.0, 290.0]$ 开尔文\n  - $q_e = [0.016, 0.012, 0.009, 0.005]$ 千克/千克\n  - $q_u = [0.018, 0.014, 0.010, 0.006]$ 千克/千克\n  - $M = [0.30, 0.25, 0.20, 0.10]$ 千克/平方米/秒\n  - $\\delta = [0.0010, 0.0015, 0.0020, 0.0025]$ /米\n- 案例 B（零通量边界情况，三层）：\n  - $N = 3$\n  - $\\Delta z = [800, 1200, 1500]$ 米\n  - $\\rho = [1.22, 1.05, 0.85]$ 千克/立方米\n  - $T_e = [298.0, 295.0, 285.0]$ 开尔文\n  - $T_u = [298.0, 295.0, 285.0]$ 开尔文\n  - $q_e = [0.017, 0.012, 0.004]$ 千克/千克\n  - $q_u = [0.017, 0.012, 0.004]$ 千克/千克\n  - $M = [0.0, 0.0, 0.0]$ 千克/平方米/秒\n  - $\\delta = [0.0010, 0.0020, 0.0030]$ /米\n- 案例 C（混合符号差异和可变层数，五层）：\n  - $N = 5$\n  - $\\Delta z = [500, 700, 1000, 1200, 1500]$ 米\n  - $\\rho = [1.25, 1.18, 1.05, 0.95, 0.80]$ 千克/立方米\n  - $T_e = [299.0, 297.0, 294.0, 290.0, 285.0]$ 开尔文\n  - $T_u = [300.0, 297.5, 293.5, 289.0, 284.0]$ 开尔文\n  - $q_e = [0.0165, 0.0135, 0.0090, 0.0060, 0.0030]$ 千克/千克\n  - $q_u = [0.0175, 0.0140, 0.0085, 0.0050, 0.0025]$ 千克/千克\n  - $M = [0.20, 0.22, 0.18, 0.12, 0.05]$ 千克/平方米/秒\n  - $\\delta = [0.0008, 0.0012, 0.0020, 0.0030, 0.0040]$ /米\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。\n- 对于每个案例，输出一个嵌套列表，其中包含两个列表：分层的温度倾向（单位 $\\mathrm{K/s}$）和分层的比湿倾向（单位 $\\mathrm{s}^{-1}$），两者均四舍五入到六位小数。\n- 因此，最终输出应采用以下形式：\n  - $\\left[[[T\\_A],[q\\_A]],[[T\\_B],[q\\_B]],[[T\\_C],[q\\_C]]\\right]$\n  其中 $[T\\_A]$ 表示案例 A 的温度倾向列表，$[q\\_A]$ 表示案例 A 的比湿倾向列表，案例 B 和 C 同理。",
            "solution": "## 问题验证\n\n### 步骤 1：提取已知条件\n\n问题为离散为 $N$ 层（索引为 $k \\in \\{0, 1, \\dots, N-1\\}$）的一维大气柱提供了以下定义、参数和条件。\n\n**物理量和廓线：**\n- 层厚度：$\\Delta z_k$ [米]\n- 空气密度：$\\rho_k$ [千克/米$^3$]\n- 环境温度：$T_{e,k}$ [开尔文]\n- 环境比湿：$q_{e,k}$ [千克/千克]\n- 上升气流羽流温度：$T_{u,k}$ [开尔文]\n- 上升气流羽流比湿：$q_{u,k}$ [千克/千克]\n- 上升气流羽流质量通量（层中心）：$M_k$ [千克/(米$^2 \\cdot$ 秒)]\n- 夹出率（层中心）：$\\delta_k$ [米$^{-1}$]\n\n**建模原理和定义：**\n1.  **标量守恒：** 对于一个标量 $\\chi$，厚度为 $\\Delta z$ 的层中 $\\rho \\chi$ 的变化率是跨界面的净通量和层内源项的总和。\n2.  **对流通量：** 层界面处标量 $\\chi$ 的通量模型为 $F_{\\chi} = M (\\chi_u - \\chi_e)$。\n3.  **夹出源：** 层 $k$ 内标量 $\\chi$ 的源项为 $S_{\\chi,k} = \\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})$。\n4.  **界面插值：** 在层 $k$ 和 $k+1$ 之间的界面（记为 $k+1/2$）上的变量 $\\psi_k$ 是算术平均值：$\\psi_{k+1/2} = \\frac{1}{2}(\\psi_k + \\psi_{k+1})$。\n5.  **边界条件：**\n    - 底部边界（$k=-1/2$）的通量：$F_{\\chi, -1/2} = 0$。\n    - 顶部边界（$k=N-1/2$）的通量：$F_{\\chi, N-1/2} = 0$。\n\n**测试集数据：**\n- **案例 A ($N=4$):**\n  - $\\Delta z = [1000, 1000, 1000, 1000]$ 米\n  - $\\rho = [1.2, 1.1, 1.0, 0.9]$ 千克/米$^3$\n  - $T_e = [300.0, 296.0, 292.0, 288.0]$ 开尔文\n  - $T_u = [302.0, 298.0, 294.0, 290.0]$ 开尔文\n  - $q_e = [0.016, 0.012, 0.009, 0.005]$ 千克/千克\n  - $q_u = [0.018, 0.014, 0.010, 0.006]$ 千克/千克\n  - $M = [0.30, 0.25, 0.20, 0.10]$ 千克/(米$^2 \\cdot$ 秒)\n  - $\\delta = [0.0010, 0.0015, 0.0020, 0.0025]$ 米$^{-1}$\n- **案例 B ($N=3$):**\n  - $\\Delta z = [800, 1200, 1500]$ 米\n  - $\\rho = [1.22, 1.05, 0.85]$ 千克/米$^3$\n  - $T_e = [298.0, 295.0, 285.0]$ 开尔文\n  - $T_u = [298.0, 295.0, 285.0]$ 开尔文\n  - $q_e = [0.017, 0.012, 0.004]$ 千克/千克\n  - $q_u = [0.017, 0.012, 0.004]$ 千克/千克\n  - $M = [0.0, 0.0, 0.0]$ 千克/(米$^2 \\cdot$ 秒)\n  - $\\delta = [0.0010, 0.0020, 0.0030]$ 米$^{-1}$\n- **案例 C ($N=5$):**\n  - $\\Delta z = [500, 700, 1000, 1200, 1500]$ 米\n  - $\\rho = [1.25, 1.18, 1.05, 0.95, 0.80]$ 千克/米$^3$\n  - $T_e = [299.0, 297.0, 294.0, 290.0, 285.0]$ 开尔文\n  - $T_u = [300.0, 297.5, 293.5, 289.0, 284.0]$ 开尔文\n  - $q_e = [0.0165, 0.0135, 0.0090, 0.0060, 0.0030]$ 千克/千克\n  - $q_u = [0.0175, 0.0140, 0.0085, 0.0050, 0.0025]$ 千克/千克\n  - $M = [0.20, 0.22, 0.18, 0.12, 0.05]$ 千克/(米$^2 \\cdot$ 秒)\n  - $\\delta = [0.0008, 0.0012, 0.0020, 0.0030, 0.0040]$ 米$^{-1}$\n\n### 步骤 2：使用提取的已知条件进行验证\n\n根据验证标准对问题进行评估：\n- **科学性：** 该问题描述了次网格尺度对流的质量通量参数化，这是现代数值天气预报和气候模型的标准和基本组成部分。该公式基于质量守恒和一个通用标量守恒，这是一个核心物理原理。虽然直接使用温度 $T$ 作为输送标量是一种简化（通常使用位温或静力能等守恒热力学变量），但这是一种常见的教学选择，不构成根本性的科学缺陷。\n- **适定性：** 该问题是适定的。它提供了所有必要的输入数据（$\\Delta z_k, \\rho_k, T_{e,k}, T_{u,k}, q_{e,k}, q_{u,k}, M_k, \\delta_k$），定义了所有需要的模型（通量、源、插值），指定了边界条件，并要求一个唯一可确定的输出（倾向）。\n- **客观性：** 问题以精确的数学语言陈述，没有主观或模棱两可的术语。\n- **其他缺陷：** 问题是自洽的、一致的，并且没有表现出任何列出的缺陷，如非形式化、不完整、矛盾或微不足道。\n\n### 步骤 3：结论与行动\n\n问题陈述是 **有效的**。将提供完整的解决方案。\n\n## 离散算法的推导\n\n推导从第 $k$ 层环境中通用标量 $\\chi_e$ 的基本守恒定律开始。\n\n1.  **层的守恒定律：**\n    问题指出，层内标量属性 $\\rho \\chi$ 的总量随时间的变化率等于进入该层的净通量加上任何层内源。对于厚度为 $\\Delta z_k$ 且单位水平面积的层 $k$，环境标量的总量为 $\\rho_k \\chi_{e,k} \\Delta z_k$。因此，守恒定律为：\n    $$ \\frac{\\partial}{\\partial t} \\left( \\rho_k \\chi_{e,k} \\Delta z_k \\right) = F_{\\chi, k-1/2} - F_{\\chi, k+1/2} + S_{\\chi,k}^{\\text{total}} $$\n    其中 $F_{\\chi, k-1/2}$ 和 $F_{\\chi, k+1/2}$ 分别是层 $k$ 的底部和顶部界面的通量。问题给出的源项 $S_{\\chi,k} = \\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})$ 的单位是 $\\mathrm{kg} \\cdot \\mathrm{m}^{-3} \\cdot \\mathrm{s}^{-1} \\cdot (\\chi \\text{的单位})$，这是一个单位体积的源。层内的总源（单位面积）是 $S_{\\chi,k}^{\\text{total}} = S_{\\chi,k} \\Delta z_k$。\n    假设在倾向计算中 $\\rho_k$ 和 $\\Delta z_k$ 相对于时间是恒定的，我们可以写出：\n    $$ \\rho_k \\Delta z_k \\frac{\\partial \\chi_{e,k}}{\\partial t} = F_{\\chi, k-1/2} - F_{\\chi, k+1/2} + S_{\\chi,k} \\Delta z_k $$\n    求解倾向 $\\frac{\\partial \\chi_{e,k}}{\\partial t}$，得到主方程：\n    $$ \\frac{\\partial \\chi_{e,k}}{\\partial t} = \\frac{1}{\\rho_k \\Delta z_k} \\left( F_{\\chi, k-1/2} - F_{\\chi, k+1/2} \\right) + \\frac{S_{\\chi,k}}{\\rho_k} $$\n\n2.  **界面通量的离散化：**\n    界面处的通量由 $F_{\\chi} = M (\\chi_u - \\chi_e)$ 给出。为了在层 $k$ 和 $k+1$ 之间的界面 $k+1/2$ 处评估此值，我们对所有变量使用指定的算术平均值：\n    $$ M_{k+1/2} = \\frac{1}{2}(M_k + M_{k+1}) $$\n    $$ \\chi_{u, k+1/2} = \\frac{1}{2}(\\chi_{u,k} + \\chi_{u,k+1}) $$\n    $$ \\chi_{e, k+1/2} = \\frac{1}{2}(\\chi_{e,k} + \\chi_{e,k+1}) $$\n    将这些代入通量方程得到：\n    $$ F_{\\chi, k+1/2} = \\left(\\frac{M_k + M_{k+1}}{2}\\right) \\left[ \\left(\\frac{\\chi_{u,k} + \\chi_{u,k+1}}{2}\\right) - \\left(\\frac{\\chi_{e,k} + \\chi_{e,k+1}}{2}\\right) \\right] $$\n    $$ F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) \\left( (\\chi_{u,k} - \\chi_{e,k}) + (\\chi_{u,k+1} - \\chi_{e,k+1}) \\right) $$\n    让我们将层内的差异定义为 $\\Delta\\chi_k = \\chi_{u,k} - \\chi_{e,k}$。界面通量变为：\n    $$ F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) (\\Delta\\chi_k + \\Delta\\chi_{k+1}) $$\n    该公式对内部界面有效，即对于 $k = 0, 1, \\dots, N-2$。\n\n3.  **最终离散倾向方程：**\n    我们将通量 $F_\\chi$ 和源 $S_\\chi$ 的表达式代入主倾向方程。\n    源项的贡献是：\n    $$ \\frac{S_{\\chi,k}}{\\rho_k} = \\frac{\\delta_k M_k (\\chi_{u,k} - \\chi_{e,k})}{\\rho_k} = \\frac{\\delta_k M_k}{\\rho_k} \\Delta\\chi_k $$\n    层 $k$ 中倾向的最终离散算法，记为 $(\\frac{\\partial \\chi_e}{\\partial t})_k$，是：\n    $$ \\left(\\frac{\\partial \\chi_e}{\\partial t}\\right)_k = \\frac{F_{\\chi, k-1/2} - F_{\\chi, k+1/2}}{\\rho_k \\Delta z_k} + \\frac{\\delta_k M_k}{\\rho_k} \\Delta\\chi_k $$\n    其中：\n    - 对于内部层 $k \\in \\{1, \\dots, N-2\\}$：\n        $F_{\\chi, k-1/2} = \\frac{1}{4} (M_{k-1} + M_k) (\\Delta\\chi_{k-1} + \\Delta\\chi_k)$\n        $F_{\\chi, k+1/2} = \\frac{1}{4} (M_k + M_{k+1}) (\\Delta\\chi_k + \\Delta\\chi_{k+1})$\n    - 对于底层 $k=0$：\n        $F_{\\chi, -1/2} = 0$ (根据边界条件)\n        $F_{\\chi, 1/2} = \\frac{1}{4} (M_0 + M_1) (\\Delta\\chi_0 + \\Delta\\chi_1)$\n    - 对于顶层 $k=N-1$：\n        $F_{\\chi, N-3/2} = \\frac{1}{4} (M_{N-2} + M_{N-1}) (\\Delta\\chi_{N-2} + \\Delta\\chi_{N-1})$\n        $F_{\\chi, N-1/2} = 0$ (根据边界条件)\n\n这个完整的算法独立地应用于温度（$T$）和比湿（$q$），以计算它们各自在大气柱每一层中的环境倾向。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all given test cases.\n    It defines the test cases, computes the tendencies for each,\n    and prints the formatted results.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 4,\n            \"delta_z\": np.array([1000.0, 1000.0, 1000.0, 1000.0]),\n            \"rho\": np.array([1.2, 1.1, 1.0, 0.9]),\n            \"T_e\": np.array([300.0, 296.0, 292.0, 288.0]),\n            \"T_u\": np.array([302.0, 298.0, 294.0, 290.0]),\n            \"q_e\": np.array([0.016, 0.012, 0.009, 0.005]),\n            \"q_u\": np.array([0.018, 0.014, 0.010, 0.006]),\n            \"M\": np.array([0.30, 0.25, 0.20, 0.10]),\n            \"delta\": np.array([0.0010, 0.0015, 0.0020, 0.0025]),\n        },\n        {\n            \"N\": 3,\n            \"delta_z\": np.array([800.0, 1200.0, 1500.0]),\n            \"rho\": np.array([1.22, 1.05, 0.85]),\n            \"T_e\": np.array([298.0, 295.0, 285.0]),\n            \"T_u\": np.array([298.0, 295.0, 285.0]),\n            \"q_e\": np.array([0.017, 0.012, 0.004]),\n            \"q_u\": np.array([0.017, 0.012, 0.004]),\n            \"M\": np.array([0.0, 0.0, 0.0]),\n            \"delta\": np.array([0.0010, 0.0020, 0.0030]),\n        },\n        {\n            \"N\": 5,\n            \"delta_z\": np.array([500.0, 700.0, 1000.0, 1200.0, 1500.0]),\n            \"rho\": np.array([1.25, 1.18, 1.05, 0.95, 0.80]),\n            \"T_e\": np.array([299.0, 297.0, 294.0, 290.0, 285.0]),\n            \"T_u\": np.array([300.0, 297.5, 293.5, 289.0, 284.0]),\n            \"q_e\": np.array([0.0165, 0.0135, 0.0090, 0.0060, 0.0030]),\n            \"q_u\": np.array([0.0175, 0.0140, 0.0085, 0.0050, 0.0025]),\n            \"M\": np.array([0.20, 0.22, 0.18, 0.12, 0.05]),\n            \"delta\": np.array([0.0008, 0.0012, 0.0020, 0.0030, 0.0040]),\n        }\n    ]\n\n    def calculate_tendencies(N, delta_z, rho, M, delta, chi_e, chi_u):\n        \"\"\"\n        Computes environmental tendencies for a generic scalar chi.\n\n        Args:\n            N (int): Number of layers.\n            delta_z (np.array): Layer thicknesses.\n            rho (np.array): Layer densities.\n            M (np.array): Mass flux at layer centers.\n            delta (np.array): Detrainment rates at layer centers.\n            chi_e (np.array): Environmental scalar at layer centers.\n            chi_u (np.array): Updraft scalar at layer centers.\n\n        Returns:\n            np.array: Scalar tendencies for each layer.\n        \"\"\"\n        # Calculate the difference between updraft and environment scalar\n        delta_chi = chi_u - chi_e\n\n        # Initialize fluxes at interfaces. Size N+1 for N layers.\n        # fluxes[k] corresponds to interface k-1/2.\n        # fluxes[0] is bottom boundary, fluxes[N] is top boundary.\n        fluxes = np.zeros(N + 1)\n\n        # Calculate fluxes at internal interfaces (k+1/2 for k=0 to N-2)\n        # These are stored in fluxes[1] through fluxes[N-1]\n        for k in range(N - 1):\n            # Interface k+1/2 is between layers k and k+1\n            fluxes[k + 1] = 0.25 * (M[k] + M[k + 1]) * (delta_chi[k] + delta_chi[k + 1])\n\n        # Initialize tendencies for each layer\n        tendencies = np.zeros(N)\n\n        for k in range(N):\n            # Flux divergence term: (flux_in - flux_out) / (rho * dz)\n            # flux_in is at k-1/2 (fluxes[k]), flux_out is at k+1/2 (fluxes[k+1])\n            flux_divergence_term = (fluxes[k] - fluxes[k + 1]) / (rho[k] * delta_z[k])\n\n            # Source term from detrainment: S_chi / rho\n            source_term = (delta[k] * M[k] / rho[k]) * delta_chi[k]\n\n            tendencies[k] = flux_divergence_term + source_term\n\n        return tendencies\n\n    # Store results for all cases\n    final_results_str_list = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        \n        # Calculate temperature tendencies\n        T_tendencies = calculate_tendencies(\n            N, case[\"delta_z\"], case[\"rho\"], case[\"M\"], case[\"delta\"],\n            case[\"T_e\"], case[\"T_u\"]\n        )\n\n        # Calculate specific humidity tendencies\n        q_tendencies = calculate_tendencies(\n            N, case[\"delta_z\"], case[\"rho\"], case[\"M\"], case[\"delta\"],\n            case[\"q_e\"], case[\"q_u\"]\n        )\n        \n        # Format results to strings with 6 decimal places\n        T_tend_str = [f'{t:.6f}' for t in T_tendencies]\n        q_tend_str = [f'{q:.6f}' for q in q_tendencies]\n\n        # Format lists into the required string format\n        T_list_str = f\"[{','.join(T_tend_str)}]\"\n        q_list_str = f\"[{','.join(q_tend_str)}]\"\n\n        # Combine into the case-specific string format [[T_list],[q_list]]\n        case_str = f\"[{T_list_str},{q_list_str}]\"\n        final_results_str_list.append(case_str)\n\n    # Join all case strings into the final output format\n    final_output = f\"[{','.join(final_results_str_list)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}