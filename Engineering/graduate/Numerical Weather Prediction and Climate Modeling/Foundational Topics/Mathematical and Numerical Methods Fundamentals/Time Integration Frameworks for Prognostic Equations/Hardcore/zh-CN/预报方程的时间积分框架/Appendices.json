{
    "hands_on_practices": [
        {
            "introduction": "在数值天气预报中，时间积分方案的稳定性是首要考虑的因素。本练习将通过一个基础但至关重要的计算，帮助你掌握Courant–Friedrichs–Lewy (CFL) 条件的应用 。你将亲自计算并比较平流过程和声波传播对显式时间步长的限制，从而深刻理解大气模型中常见的“刚性”（stiffness）问题，即不同速度的波动对计算效率构成的挑战。",
            "id": "4105163",
            "problem": "考虑一个用于数值天气预报的可压缩动力核心的一维切片，其预报方程在一个间距为 $\\Delta x$ 的均匀网格上离散化。该模型对平流和声波传播均采用完全显式格式进行时间积分。稳定性的基本依据是，双曲型偏微分方程的显式离散化必须遵守 Courant–Friedrichs–Lewy (CFL) 条件。该条件约束了由 $\\nu = \\frac{v\\,\\Delta t}{\\Delta x}$ 定义的无量纲 Courant 数 $\\nu$（其中 $v$ 是相应的特征信号速度），为保证线性稳定性，必须满足 $\\nu \\leq 1$。\n\n从以下方程出发：\n- 线性平流方程 $\\partial_t \\phi + U\\,\\partial_x \\phi = 0$，其特征速度为 $|U|$，以及\n- 可压缩欧拉方程的线性化声学子系统，其特征声速为 $c_s$，\n\n分别推导由平流 CFL 条件和声学 CFL 条件施加的最大显式时间步长约束，然后通过取两者中更严格的一个来确定同时满足两个约束的单一最大时间步长。使用以下科学上合理的参数：网格间距 $\\Delta x = 10\\,\\text{km}$，风速 $U = 20\\,\\text{m s}^{-1}$，以及声速 $c_s = 320\\,\\text{m s}^{-1}$。将最终数值答案以秒为单位表示，并四舍五入到四位有效数字。在你的推理中，解释在这些条件下哪种模式（平流或声学）是限制性的。",
            "solution": "该问题要求确定用于一维可压缩动力核心的完全显式数值格式的最大稳定时间步长。此类用于双曲型偏微分方程的格式的稳定性由 Courant–Friedrichs–Lewy (CFL) 条件决定。\n\nCFL 条件使用无量纲 Courant 数 $\\nu$ 来表示，定义为：\n$$ \\nu = \\frac{v \\, \\Delta t}{\\Delta x} $$\n其中 $v$ 是相关波动现象的特征速度，$\\Delta t$ 是时间步长，$\\Delta x$ 是网格间距。对于许多显式格式的线性稳定性，该条件要求 $\\nu \\leq 1$。这个不等式可以重新整理，以确定时间步长的上限：\n$$ \\Delta t \\leq \\frac{\\Delta x}{v} $$\n因此，对于特征速度为 $v$ 的过程，最大允许时间步长 $\\Delta t_{max}$ 为：\n$$ \\Delta t_{max} = \\frac{\\Delta x}{v} $$\n所描述的系统涉及两个不同的物理过程：平流和声波传播。我们必须为每个过程评估 CFL 约束，以确定总体的稳定性限制。\n\n提供的参数如下：\n- 网格间距：$\\Delta x = 10\\,\\text{km}$\n- 风速：$U = 20\\,\\text{m s}^{-1}$\n- 声速：$c_s = 320\\,\\text{m s}^{-1}$\n\n为了量纲一致性，所有量都必须使用国际单位制（SI units）。将网格间距从千米转换为米：\n$$ \\Delta x = 10\\,\\text{km} = 10 \\times 10^3\\,\\text{m} = 10^4\\,\\text{m} $$\n\n现在我们分别为每种模式推导时间步长约束。\n\n1.  **平流时间步长约束：**\n    线性平流方程 $\\partial_t \\phi + U\\,\\partial_x \\phi = 0$ 控制着背景风的输送。该过程的特征速度是风速的大小，即 $v_{adv} = |U|$。平流的 CFL 条件是：\n    $$ \\nu_{adv} = \\frac{|U| \\, \\Delta t}{\\Delta x} \\leq 1 $$\n    这对平流过程施加了一个最大时间步长 $\\Delta t_{adv}$：\n    $$ \\Delta t \\leq \\frac{\\Delta x}{|U|} \\implies \\Delta t_{adv} = \\frac{\\Delta x}{|U|} $$\n    代入给定的数值：\n    $$ \\Delta t_{adv} = \\frac{10^4\\,\\text{m}}{|20\\,\\text{m s}^{-1}|} = \\frac{10000}{20}\\,\\text{s} = 500\\,\\text{s} $$\n\n2.  **声学时间步长约束：**\n    线性化声学子系统控制着声波的传播。该过程的特征速度是声速，即 $v_{ac} = c_s$。声波的 CFL 条件是：\n    $$ \\nu_{ac} = \\frac{c_s \\, \\Delta t}{\\Delta x} \\leq 1 $$\n    这对声学过程施加了一个最大时间步长 $\\Delta t_{ac}$：\n    $$ \\Delta t \\leq \\frac{\\Delta x}{c_s} \\implies \\Delta t_{ac} = \\frac{\\Delta x}{c_s} $$\n    代入给定的数值：\n    $$ \\Delta t_{ac} = \\frac{10^4\\,\\text{m}}{320\\,\\text{m s}^{-1}} = \\frac{10000}{320}\\,\\text{s} = \\frac{1000}{32}\\,\\text{s} = 31.25\\,\\text{s} $$\n\n3.  **复合稳定性约束：**\n    一个完全显式积分格式必须对所有模拟的物理过程都保持稳定。因此，时间步长 $\\Delta t$ 必须同时满足平流和声学约束。这意味着 $\\Delta t$ 必须小于或等于各个最大允许时间步长中的最小值：\n    $$ \\Delta t \\leq \\min(\\Delta t_{adv}, \\Delta t_{ac}) $$\n    确保整个系统稳定性的单一最大时间步长 $\\Delta t_{max}$ 是两个值中更严格（即更小）的那个：\n    $$ \\Delta t_{max} = \\min(500\\,\\text{s}, 31.25\\,\\text{s}) $$\n    因此，总的最大稳定时间步长为：\n    $$ \\Delta t_{max} = 31.25\\,\\text{s} $$\n    问题要求答案四舍五入到四位有效数字。计算值 $31.25$ 是一个有四位有效数字的精确结果，这符合该要求。\n\n**解释：**\n比较两个约束条件 $\\Delta t_{adv} = 500\\,\\text{s}$ 和 $\\Delta t_{ac} = 31.25\\,\\text{s}$，可以发现 $\\Delta t_{ac}$ 远小于 $\\Delta t_{adv}$。这表明**声学模式是显式格式稳定性的限制因素**。声波的高传播速度 ($c_s = 320\\,\\text{m s}^{-1}$) 迫使我们使用非常小的时间步长，而具有气象学意义的平流过程 ($U = 20\\,\\text{m s}^{-1}$) 本可以允许一个大得多的时间步长。这种差异是大气模拟中的一个经典挑战，它推动了计算效率更高的时间积分方法的发展，例如分裂显式（split-explicit）或半隐式（semi-implicit）格式，这些方法对快、慢模式进行不同处理。",
            "answer": "$$\n\\boxed{31.25}\n$$"
        },
        {
            "introduction": "为了克服快波对显式格式稳定性的严格限制，数值模型常采用隐式或半隐式方案。本练习将带你分析经典的Crank-Nicolson格式，这是一个对线性问题无条件稳定的方法 。通过推导其放大因子并分析其相位误差，你将学会评估数值格式不仅是否稳定，还能多精确地模拟波的传播速度，这是衡量积分方案性能的关键指标。",
            "id": "4105191",
            "problem": "在数值天气预报（Numerical Weather Prediction, NWP）和气候模拟中，预报方程支持振荡简正模（例如惯性重力波），其单个水平傅里叶分量可以由一个复振幅表示，该复振幅满足形式为 $\\frac{dy}{dt}=\\lambda y$ 的线性常微分方程（Ordinary Differential Equation, ODE）。考虑一个具有纯振荡频率的此类单模，使得 $\\lambda=i\\omega$ 且实数 $\\omega>0$，并令 $\\Delta t>0$ 表示一个固定的时间步长。定义无量纲步长 $z=\\lambda \\Delta t$ 和 $\\Omega=\\omega \\Delta t$，从而有 $z=i\\Omega$。\n\n从积分形式 $y^{n+1}-y^{n}=\\int_{t_n}^{t_{n+1}} f(y(t))\\,dt$（其中 $f(y)=\\lambda y$）出发，通过对右侧应用梯形法则，构建 Crank-Nicolson (CN) 单步时间积分方法。对于线性检验方程 $\\frac{dy}{dt}=\\lambda y$，推导相应的线性放大因子 $R(z)$（由 $y^{n+1}=R(z)\\,y^{n}$ 定义），使其成为 $z$ 的函数。然后，专门针对振荡情况 $z=i\\Omega$，定义数值相位 $\\theta(\\Omega)=\\arg\\big(R(i\\Omega)\\big)$，其中角度以弧度为单位。利用在 $\\Omega$ 较小时有效的级数展开，求得相位误差 $\\varepsilon(\\Omega)=\\theta(\\Omega)-\\Omega$ 表示为 $\\Omega$ 的幂级数，直到并包括 $\\Omega^{5}$ 阶项。\n\n请以 $\\varepsilon(\\Omega)$ 在 $\\mathcal{O}(\\Omega^{5})$ 处截断的单个闭式表达式的形式提供最终结果，角度以弧度为单位。无需进行数值四舍五入。",
            "solution": "问题陈述经评估有效。这是一个在应用于地球物理流体动力学的数值分析领域中的标准、适定问题，没有任何科学、逻辑或形式上的缺陷。\n\n求解过程如下。给定预报方程 $\\frac{dy}{dt} = \\lambda y$，对于纯振荡模，该方程变为 $\\frac{dy}{dt} = i\\omega y$，其中 $\\omega > 0$ 是一个实常数。任务是分析该方程的 Crank-Nicolson 时间积分格式。\n\n首先，我们构建 Crank-Nicolson 格式。我们从方程在一个时间步长 $\\Delta t$（从 $t_n$ 到 $t_{n+1} = t_n + \\Delta t$）内的积分形式开始：\n$$y(t_{n+1}) - y(t_n) = \\int_{t_n}^{t_{n+1}} \\lambda y(t) \\, dt$$\n使用记号 $y^k = y(t_k)$，这变为：\n$$y^{n+1} - y^{n} = \\int_{t_n}^{t_{n+1}} \\lambda y(t) \\, dt$$\nCrank-Nicolson 方法是通过对右侧的积分应用梯形法则推导出来的。梯形法则将积分近似为：\n$$\\int_{a}^{b} g(t) \\, dt \\approx \\frac{b-a}{2} [g(a) + g(b)]$$\n将此应用于我们的问题，其中 $g(t) = \\lambda y(t)$，$a = t_n$，$b = t_{n+1}$，我们得到离散格式：\n$$y^{n+1} - y^{n} = \\frac{t_{n+1} - t_n}{2} [\\lambda y(t_n) + \\lambda y(t_{n+1})]$$\n$$y^{n+1} - y^{n} = \\frac{\\Delta t}{2} (\\lambda y^n + \\lambda y^{n+1})$$\n为了推导放大因子 $R(z)$，我们引入无量纲步长 $z = \\lambda \\Delta t$。该格式可以重写为：\n$$y^{n+1} - y^{n} = \\frac{z}{2} (y^n + y^{n+1})$$\n我们现在重新整理方程，以求解 $y^{n+1}$ 作为 $y^n$ 的函数：\n$$y^{n+1} \\left(1 - \\frac{z}{2}\\right) = y^n \\left(1 + \\frac{z}{2}\\right)$$\n$$y^{n+1} = \\left(\\frac{1 + z/2}{1 - z/2}\\right) y^n$$\n根据定义 $y^{n+1} = R(z) y^n$，Crank-Nicolson 格式的线性放大因子为：\n$$R(z) = \\frac{1 + z/2}{1 - z/2}$$\n对于指定的纯振荡情况，我们有 $\\lambda = i\\omega$，这使得无量纲步长 $z = i\\omega \\Delta t = i\\Omega$，其中 $\\Omega = \\omega \\Delta t > 0$。将 $z = i\\Omega$ 代入 $R(z)$ 的表达式中：\n$$R(i\\Omega) = \\frac{1 + i\\Omega/2}{1 - i\\Omega/2}$$\n数值相位 $\\theta(\\Omega)$ 是这个复数的辐角。利用复数 $w$ 的性质 $\\arg(w/\\bar{w}) = 2\\arg(w)$，或者通过计算 $\\arg(1+i\\Omega/2) - \\arg(1-i\\Omega/2)$，我们发现：\n$$\\theta(\\Omega) = \\arg(R(i\\Omega)) = \\arg(1 + i\\Omega/2) - \\arg(1 - i\\Omega/2)$$\n复数 $x+iy$ 的辐角是 $\\arctan(y/x)$。因此：\n$$\\arg(1 + i\\Omega/2) = \\arctan\\left(\\frac{\\Omega/2}{1}\\right) = \\arctan\\left(\\frac{\\Omega}{2}\\right)$$\n$$\\arg(1 - i\\Omega/2) = \\arctan\\left(\\frac{-\\Omega/2}{1}\\right) = -\\arctan\\left(\\frac{\\Omega}{2}\\right)$$\n将这些结合起来，得到数值相位：\n$$\\theta(\\Omega) = \\arctan\\left(\\frac{\\Omega}{2}\\right) - \\left(-\\arctan\\left(\\frac{\\Omega}{2}\\right)\\right) = 2 \\arctan\\left(\\frac{\\Omega}{2}\\right)$$\n方程 $\\frac{dy}{dt} = i\\omega y$ 的精确解是 $y(t) = y(0) \\exp(i\\omega t)$。在一个时间步长 $\\Delta t$ 内，精确解的相位前进 $\\omega \\Delta t = \\Omega$。相位误差 $\\varepsilon(\\Omega)$ 是数值相位与精确相位之差：\n$$\\varepsilon(\\Omega) = \\theta(\\Omega) - \\Omega = 2 \\arctan\\left(\\frac{\\Omega}{2}\\right) - \\Omega$$\n为了求出 $\\varepsilon(\\Omega)$ 直到 $\\Omega^5$ 阶的幂级数，我们使用反正切函数的麦克劳林级数：\n$$\\arctan(x) = x - \\frac{x^3}{3} + \\frac{x^5}{5} - \\mathcal{O}(x^7)$$\n我们将 $x = \\Omega/2$ 代入此级数：\n$$\\arctan\\left(\\frac{\\Omega}{2}\\right) = \\left(\\frac{\\Omega}{2}\\right) - \\frac{1}{3}\\left(\\frac{\\Omega}{2}\\right)^3 + \\frac{1}{5}\\left(\\frac{\\Omega}{2}\\right)^5 - \\mathcal{O}(\\Omega^7)$$\n$$\\arctan\\left(\\frac{\\Omega}{2}\\right) = \\frac{\\Omega}{2} - \\frac{\\Omega^3}{24} + \\frac{\\Omega^5}{160} - \\mathcal{O}(\\Omega^7)$$\n现在将此展开式代回相位误差 $\\varepsilon(\\Omega)$ 的表达式中：\n$$\\varepsilon(\\Omega) = 2 \\left( \\frac{\\Omega}{2} - \\frac{\\Omega^3}{24} + \\frac{\\Omega^5}{160} - \\mathcal{O}(\\Omega^7) \\right) - \\Omega$$\n分配因子 2：\n$$\\varepsilon(\\Omega) = \\left( \\Omega - \\frac{\\Omega^3}{12} + \\frac{\\Omega^5}{80} - \\mathcal{O}(\\Omega^7) \\right) - \\Omega$$\n最后，减去 $\\Omega$ 得到相位误差展开式：\n$$\\varepsilon(\\Omega) = -\\frac{\\Omega^3}{12} + \\frac{\\Omega^5}{80} - \\mathcal{O}(\\Omega^7)$$\n将此级数截断至包括 $\\Omega^5$ 阶项，得到所需的表达式。",
            "answer": "$$\\boxed{-\\frac{\\Omega^{3}}{12} + \\frac{\\Omega^{5}}{80}}$$"
        },
        {
            "introduction": "一个优秀的数值方案不仅要稳定和准确，还应尽可能地保持原始物理方程的内在性质，例如解的单调性或正定性。本练习将向你介绍一个更高级的概念：强稳定保持（Strong Stability Preserving, SSP）方法，这类方法在模拟存在激波或陡峭梯度的现象时至关重要 。你将通过分析一个三阶Runge-Kutta格式，学习如何确定其SSP系数，并理解这如何保证数值解在特定条件下能维持其物理上的合理性。",
            "id": "4105231",
            "problem": "考虑数值天气预报中出现的半离散初值问题 $u^{\\prime}(t)=\\mathcal{L}(u(t))$，其中 $u$ 汇集了预报变量（例如，速度分量、位温），而 $\\mathcal{L}$ 是控制偏微分方程的空间离散化。假设存在一个凸泛函（例如，范数或半范数）$\\|\\cdot\\|$ ，使得前向欧拉法在时间步长限制 $0 \\le \\Delta t \\le \\Delta t_{\\mathrm{FE}}$ 下是压缩的，即对于所有状态 $v$，\n$$\n\\|v+\\Delta t\\,\\mathcal{L}(v)\\|\\le \\|v\\| \\quad \\text{当} \\quad 0 \\le \\Delta t \\le \\Delta t_{\\mathrm{FE}} \\text{时}。\n$$\n如果对于任何如上所述的前向欧拉压缩的半离散算子 $\\mathcal{L}$，一个显式强稳定保持 (SSP) 龙格-库塔 (RK) 方法在时间步长限制 $0 \\le \\Delta t \\le C\\,\\Delta t_{\\mathrm{FE}}$ 下保持相同的压缩性质，则称该方法具有 SSP 系数 $C>0$。\n\n考虑由以下阶段更新定义的三阶三步 Shu–Osher 龙格-库塔方法 (RK$(3,3)$)：\n$$\nu^{(1)}=u^{n}+\\Delta t\\,\\mathcal{L}(u^{n}), \\qquad\nu^{(2)}=\\tfrac{3}{4}u^{n}+\\tfrac{1}{4}\\bigl(u^{(1)}+\\Delta t\\,\\mathcal{L}(u^{(1)})\\bigr), \\qquad\nu^{n+1}=\\tfrac{1}{3}u^{n}+\\tfrac{2}{3}\\bigl(u^{(2)}+\\Delta t\\,\\mathcal{L}(u^{(2)})\\bigr).\n$$\n\n仅使用前向欧拉压缩条件以及 SSP 系数的定义（即该方法可以写成步长为 $\\Delta t/C$ 的前向欧拉步的凸组合的最大 $C$ 值），确定 Shu–Osher RK$(3,3)$ 方法的 SSP 系数 $C$。然后解释得到的关于 $\\Delta t$ 的约束，该约束保证了对于任何前向欧拉压缩的 $\\mathcal{L}$，单调性得以保持。给出 $C$ 的精确值（不进行四舍五入），并仅报告 $C$ 的值作为最终答案（无单位）。",
            "solution": "我们从前向欧拉(FE)压缩条件开始：存在一个时间步长 $\\Delta t_{\\mathrm{FE}} > 0$，使得对于任何状态 $v$ 和任何满足 $0 \\le h \\le \\Delta t_{\\mathrm{FE}}$ 的步长 $h$，都有 $\\|v + h\\,\\mathcal{L}(v)\\| \\le \\|v\\|$。\n一个具有SSP系数 $C$ 的RK方法，当以步长 $\\Delta t$（满足 $0 \\le \\Delta t \\le C\\,\\Delta t_{\\mathrm{FE}}$）应用时，能保证 $\\|u^{n+1}\\| \\le \\|u^n\\|$。这通常通过将该RK方法表示为一系列前向欧拉步和凸组合来实现。\n让我们分析给定的Shu–Osher RK$(3,3)$方法：\n1. **第一阶段:** $u^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n)$。\n这是一个步长为 $\\Delta t$ 的前向欧拉步。为了使其满足压缩性质，即 $\\|u^{(1)}\\| \\le \\|u^n\\|$，我们必须要求 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n\n2. **第二阶段:** $u^{(2)} = \\frac{3}{4}u^n + \\frac{1}{4}\\bigl(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\bigr)$。\n这个阶段是 $u^n$ 和一个从 $u^{(1)}$ 开始的步长为 $\\Delta t$ 的前向欧拉步的凸组合。为了保证压缩性，我们需要步长 $\\Delta t$ 满足 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。如果满足这个条件，那么 $\\|u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\| \\le \\|u^{(1)}\\|$。由于第一阶段的压缩性，我们已经有 $\\|u^{(1)}\\| \\le \\|u^n\\|$。因此，利用范数的凸性，我们得到：\n$\\|u^{(2)}\\| \\le \\frac{3}{4}\\|u^n\\| + \\frac{1}{4}\\|u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\| \\le \\frac{3}{4}\\|u^n\\| + \\frac{1}{4}\\|u^{(1)}\\| \\le \\frac{3}{4}\\|u^n\\| + \\frac{1}{4}\\|u^n\\| = \\|u^n\\|$。\n\n3. **第三阶段 (最终步):** $u^{n+1} = \\frac{1}{3}u^n + \\frac{2}{3}\\bigl(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\bigr)$。\n这同样是一个凸组合，这次是 $u^n$ 和一个从 $u^{(2)}$ 开始的步长为 $\\Delta t$ 的前向欧拉步。同样，为了保证压缩性，我们需要 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。如果满足，那么 $\\|u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\| \\le \\|u^{(2)}\\|$。从第二阶段我们知道 $\\|u^{(2)}\\| \\le \\|u^n\\|$。因此：\n$\\|u^{n+1}\\| \\le \\frac{1}{3}\\|u^n\\| + \\frac{2}{3}\\|u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\| \\le \\frac{1}{3}\\|u^n\\| + \\frac{2}{3}\\|u^{(2)}\\| \\le \\frac{1}{3}\\|u^n\\| + \\frac{2}{3}\\|u^n\\| = \\|u^n\\|$。\n\n在整个过程中，为了确保每一步的压缩性质都成立，对时间步长 $\\Delta t$ 的唯一要求是 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$。\n根据SSP系数的定义，RK方法的时间步长限制为 $\\Delta t \\le C\\,\\Delta t_{\\mathrm{FE}}$。通过将我们的推导结果 $\\Delta t \\le \\Delta t_{\\mathrm{FE}}$ 与此定义进行比较，我们得出 SSP 系数 $C=1$。\n这个约束 $\\Delta t \\le 1 \\cdot \\Delta t_{\\mathrm{FE}}$ 保证了对于任何在前向欧拉法下保持单调性（或其它凸泛函不增）的算子 $\\mathcal{L}$，这个三阶RK方法在相同的最大时间步长下也能保持该性质。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}