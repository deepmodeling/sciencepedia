{
    "hands_on_practices": [
        {
            "introduction": "在气候科学中，守恒律的一个主要应用是构建和分析大尺度能量和质量收支。本练习将引导你构建一个整层大气湿静力能 (MSE) 积分收支，这是理解热带气候动力学以及地表能量通量与降水之间关系的关键工具。通过这个过程，你将实践如何将基本的守恒原理应用于简化的物理模型，以揭示气候系统中的核心相互作用。",
            "id": "4025459",
            "problem": "考虑一个水平方向上均匀的热带大气柱，其水平面积为单位面积，从地表延伸至大气层顶。设湿静力能（MSE）定义为 $h = c_{p} T + g z + L_{v} q$，其中 $c_{p}$ 是空气的定压比热， $T$ 是温度， $g$ 是重力加速度， $z$ 是高度， $L_{v}$ 是蒸发潜热， $q$ 是比湿。假设静力平衡，并且大气柱处于统计稳态，因此在所考虑的平均时间尺度上，柱积分量的储存可以忽略不计。进一步假设，机械耗散可以忽略，MSE 和水汽的水平平流可以忽略，并且柱内凝结物的净累积可以忽略。\n\n给定以下规定的和观测到的通量，其符号约定为进入大气的通量为正：\n- 地表潜热通量（蒸发）：$F_{L} = 130\\ \\mathrm{W\\, m^{-2}}$，\n- 地表感热通量：$F_{H} = 15\\ \\mathrm{W\\, m^{-2}}$，\n- 大气柱积分的净辐射加热（短波加长波）：$R = -95\\ \\mathrm{W\\, m^{-2}}$。\n\n使用干静力能和水物质守恒来推导柱积分的 MSE 收支方程，并由此得到垂直积分的 MSE 输出（即垂直积分的 MSE 通量的水平辐散）与降水之间的稳态关系。然后，根据所述假设，利用稳态水汽平衡，用规定的地表潜热通量表示降水率，并计算其数值。\n\n在进行数值计算时，使用 $L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J\\ kg^{-1}}$ 以及 $1\\ \\mathrm{mm\\, day^{-1}}$ 的降水对应于 $1\\ \\mathrm{kg\\, m^{-2}\\, day^{-1}}$ 这一事实。将最终的降水率以 $\\mathrm{mm\\, day^{-1}}$ 为单位表示，并将答案四舍五入到三位有效数字。",
            "solution": "该问题要求在一个热带大气柱的一系列简化假设下，推导柱积分的湿静力能（MSE）收支方程，并随后计算降水率。\n\n首先，我们定义相关的物理量及其守恒方程。单位质量的湿静力能由 $h = c_{p} T + g z + L_{v} q$ 给出。这可以表示为干静力能（DSE）$s = c_{p} T + g z$ 和潜能 $L_{v} q$ 的和。因此，$h = s + L_{v} q$。\n\n我们将对单位水平面积的柱内的一个通用量 $\\phi$ 使用垂直积分的守恒方程。在统计稳态的假设下，储存项消失，守恒定律的形式为：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H \\phi \\, dz = \\int_{0}^{\\infty} S_{\\phi} \\, dz + F_{\\text{surf}}(\\phi) - F_{\\text{top}}(\\phi)\n$$\n其中 $\\rho$ 是空气密度， $\\mathbf{v}_H$ 是水平速度矢量， $\\nabla_H \\cdot$ 是水平辐散算子， $S_{\\phi}$ 代表 $\\phi$ 的体积源和汇， $F_{\\text{surf}}$ 和 $F_{\\text{top}}$ 分别是地表和大气层顶的 $\\phi$ 通量。左边的项代表垂直积分量 $\\phi$ 的水平输出（通量辐散）。\n\n我们首先考虑干静力能守恒，$\\phi = s$。DSE 的源和汇是辐射加热/冷却和凝结释放的潜热。地表通量是感热通量。因此，垂直积分的稳态 DSE 收支方程为：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H s \\, dz = R + F_H + L_v P_{rate}\n$$\n这里，$R$ 是柱积分的净辐射加热率， $F_H$ 是地表感热通量， $L_v P_{rate}$ 是柱积分的潜热加热率。我们已经假设，由于凝结物的净累积可以忽略，所有凝结的水都以降水 $P_{rate}$ 的形式落下。\n\n接下来，我们考虑水物质守恒，$\\phi = q$。源是地表蒸发，汇是降水。稳态的垂直积分水汽收支方程为：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H q \\, dz = E - P_{rate}\n$$\n其中 $E$ 是地表蒸发率。地表潜热通量由 $F_L = L_v E$ 给出。\n\n现在，我们推导柱积分的 MSE 收支方程。MSE 输出是 DSE 输出和潜能输出的和：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H h \\, dz = \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H s \\, dz + L_v \\left( \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H q \\, dz \\right)\n$$\n代入 DSE 和水汽收支方程的表达式：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H h \\, dz = (R + F_H + L_v P_{rate}) + L_v(E - P_{rate})\n$$\n涉及降水的项 $L_v P_{rate}$ 相互抵消：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H h \\, dz = R + F_H + L_v E\n$$\n代入 $F_L = L_v E$，我们得到柱积分 MSE 收支方程的最终形式：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H h \\, dz = R + F_H + F_L\n$$\n这个方程表明，在统计稳态下，MSE 的水平输出必须与来自辐射和地表通量的净能量输入相平衡。\n\n问题接着要求 MSE 输出和降水之间的关系。上面推导的 MSE 收支方程不包含降水。然而，可以通过不代入 DSE 输出来建立一个关系。从 DSE 收支方程，我们有 $L_v P_{rate} = \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H s \\, dz - R - F_H$。这将降水与 DSE 输出联系起来。为了将其与 MSE 输出联系起来，我们注意到 $D_{MSE} = \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H h \\, dz = \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H s \\, dz + L_v \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H q \\, dz$。因此，一般关系是：\n$$\nD_{MSE} = (R + F_H + L_v P_{rate}) + L_v \\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H q \\, dz\n$$\n\n为了进行降水的数值计算，我们必须评估水汽输出项。问题陈述中假设“水汽的水平平流可以忽略”。在一个水平均匀的柱中，真正的平流项 $\\mathbf{v}_H \\cdot \\nabla_H q$ 为零，因为 $\\nabla_H q = 0$。然而，通量辐散 $\\nabla_H \\cdot (\\mathbf{v}_H q)$ 不一定为零。为了使这个问题可解，我们必须将有点不精确的短语“可忽略的水平平流”解释为一种常见的物理近似，即对于大尺度热带环境，垂直积分的水平水汽通量辐散与收支方程中的其他项相比可以忽略不计：\n$$\n\\nabla_H \\cdot \\int_{0}^{\\infty} \\rho \\mathbf{v}_H q \\, dz \\approx 0\n$$\n有了这个假设，稳态水汽收支方程大大简化：\n$$\n0 = E - P_{rate} \\implies P_{rate} = E\n$$\n这意味着降水率等于地表蒸发率。\n\n我们现在可以计算降水率。地表蒸发率 $E$ 与地表潜热通量 $F_L$ 的关系是 $E = F_L / L_v$。\n给定数值：\n$F_L = 130\\ \\mathrm{W\\, m^{-2}} = 130\\ \\mathrm{J\\, s^{-1}\\, m^{-2}}$\n$L_{v} = 2.5 \\times 10^{6}\\ \\mathrm{J\\ kg^{-1}}$\n\n以降水质量通量单位表示的降水率为：\n$$\nP_{rate} = \\frac{130\\ \\mathrm{J\\, s^{-1}\\, m^{-2}}}{2.5 \\times 10^{6}\\ \\mathrm{J\\ kg^{-1}}} = 5.2 \\times 10^{-5}\\ \\mathrm{kg\\, m^{-2}\\, s^{-1}}\n$$\n我们需要将这个速率转换为 $\\mathrm{mm\\, day^{-1}}$ 单位。问题提供了转换因子，$1\\ \\mathrm{mm\\, day^{-1}}$ 对应于 $1\\ \\mathrm{kg\\, m^{-2}\\, day^{-1}}$。我们必须将时间单位从秒转换为天。一天有 $24 \\times 60 \\times 60 = 86400$ 秒。\n$$\nP_{rate} (\\mathrm{kg\\, m^{-2}\\, day^{-1}}) = (5.2 \\times 10^{-5}\\ \\mathrm{kg\\, m^{-2}\\, s^{-1}}) \\times (86400\\ \\mathrm{s\\, day^{-1}})\n$$\n$$\nP_{rate} = (5.2 \\times 10^{-5}) \\times (8.64 \\times 10^{4})\\ \\mathrm{kg\\, m^{-2}\\, day^{-1}}\n$$\n$$\nP_{rate} = 5.2 \\times 8.64 \\times 10^{-1}\\ \\mathrm{kg\\, m^{-2}\\, day^{-1}}\n$$\n$$\nP_{rate} = 4.4928\\ \\mathrm{kg\\, m^{-2}\\, day^{-1}}\n$$\n使用给定的对应关系，以 $\\mathrm{mm\\, day^{-1}}$ 为单位的降水率在数值上等于此值。\n$$\nP_{rate} = 4.4928\\ \\mathrm{mm\\, day^{-1}}\n$$\n四舍五入到三位有效数字，我们得到最终答案。\n$$\nP_{rate} \\approx 4.49\\ \\mathrm{mm\\, day^{-1}}\n$$",
            "answer": "$$\n\\boxed{4.49}\n$$"
        },
        {
            "introduction": "为了在计算机上求解上一练习中的守恒方程，我们需要依赖数值格式。本练习探讨了一个看似简单的平流过程（输送能量和质量的核心过程）数值格式，如何引入非预期的数值扩散。通过进行修正方程分析，你将能够量化这种误差，这是评估和开发数值模型的一项关键技能，并能深刻理解数值解与真实物理过程之间的差异。",
            "id": "4025449",
            "problem": "考虑在长度为 $L$ 的周期性区域中，在空间均匀、不随时间变化的速度 $u$ 下的一维无源示踪物平流。示踪物浓度 $c(x,t)$ 满足通量形式的质量守恒方程 $\\frac{\\partial c}{\\partial t} + \\frac{\\partial (u c)}{\\partial x} = 0$。对于 $u > 0$ 的情况，使用在网格间距为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上的一阶迎风有限体积离散化方法。设在时间层 $n$、网格单元索引为 $i$ 的网格平均示踪物浓度为 $c_{i}^{n}$。\n\n从通量形式的守恒定律和 $u > 0$ 时迎风数值通量的定义出发，推导出用 $c_{i}^{n}$ 及其迎风邻居表示的 $c_{i}^{n+1}$ 的离散更新方程。利用周期性边界条件，证明该格式对于所有 $n$ 都保持离散示踪剂总质量 $\\sum_{i} c_{i}^{n} \\Delta x$ 守恒。\n\n接下来，对该离散格式进行修正方程（等效偏微分方程）分析，分析到 $\\Delta x$ 和 $\\Delta t$ 的主导非平凡阶，以表明它近似于一个形如 $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = D_{\\mathrm{eff}} \\frac{\\partial^{2} c}{\\partial x^{2}} + \\text{higher-order terms}$ 的平流扩散方程，并用 $u$、$\\Delta x$ 和 $\\Delta t$ 推导出有效扩散系数 $D_{\\mathrm{eff}}$。\n\n为了用解析解验证推导，考虑初始条件 $c(x,0) = c_{0} + A \\cos(k x)$，其中 $c_{0}$ 和 $A$ 是常数，且 $k = \\frac{2 \\pi}{L}$。使用常系数平流扩散方程的解析解，证明模态振幅演化为 $A(t) = A \\exp(-D_{\\mathrm{eff}} k^{2} t)$，并验证对于小的 $k \\Delta x$，在一个时间步长 $t = \\Delta t$ 后预测的振幅与离散格式的放大率在同阶上是一致的。\n\n使用以下代表数值天气预报的物理上合理的参数：\n- 区域长度 $L = 1.0 \\times 10^{6} \\,\\text{m}$，\n- 速度 $u = 10 \\,\\text{m s}^{-1}$，\n- 网格间距 $\\Delta x = 1.0 \\times 10^{4} \\,\\text{m}$，\n- 时间步长 $\\Delta t = 5.0 \\times 10^{2} \\,\\text{s}$，\n- 常数 $c_{0} = 1$ 和 $A = 0.1$。\n\n计算有效扩散系数 $D_{\\mathrm{eff}}$ 的值，并用 $\\text{m}^{2} \\,\\text{s}^{-1}$ 表示你的最终答案。将你的答案四舍五入到四位有效数字。最终答案必须是一个实数。",
            "solution": "**1. 离散更新方程的推导**\n\n守恒定律以通量形式给出：\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0\n$$\n其中通量为 $F = uc$。对于有限体积法，我们将此方程在一个网格单元 $i$上积分，从 $x_{i-1/2}$ 到 $x_{i+1/2}$，其中 $x_{i \\pm 1/2} = x_i \\pm \\frac{\\Delta x}{2}$。\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial c}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} \\,dx = 0\n$$\n将网格平均浓度定义为 $c_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} c(x,t) \\,dx$，第一项变为 $\\frac{d(c_i \\Delta x)}{dt}$。对第二项应用微积分基本定理得到 $F(x_{i+1/2}) - F(x_{i-1/2})$。半离散方程为：\n$$\n\\frac{d(c_i \\Delta x)}{dt} + F_{i+1/2} - F_{i-1/2} = 0\n$$\n其中 $F_{i \\pm 1/2}$ 是单元交界面上的数值通量。用一阶向前欧拉格式近似时间导数，我们得到：\n$$\n\\frac{c_i^{n+1} \\Delta x - c_i^n \\Delta x}{\\Delta t} + F_{i+1/2}^n - F_{i-1/2}^n = 0\n$$\n对于 $u > 0$ 的一阶迎风格式，单元交界面上的浓度值取自交界面的“迎风”侧单元，即左侧单元。因此，交界面 $i+1/2$ 处的通量 $F = uc$ 用单元 $i$ 的浓度近似，而交界面 $i-1/2$ 处的通量用单元 $i-1$ 的浓度近似：\n$$\nF_{i+1/2}^n \\approx u c_i^n\n$$\n$$\nF_{i-1/2}^n \\approx u c_{i-1}^n\n$$\n将这些代入离散方程：\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} \\Delta x + u c_i^n - u c_{i-1}^n = 0\n$$\n重新整理以求解 $c_i^{n+1}$，得到离散更新方程：\n$$\nc_i^{n+1} = c_i^n - \\frac{u \\Delta t}{\\Delta x} (c_i^n - c_{i-1}^n)\n$$\n定义库朗数 $\\sigma = \\frac{u \\Delta t}{\\Delta x}$，则该格式为 $c_i^{n+1} = c_i^n - \\sigma(c_i^n - c_{i-1}^n)$。\n\n**2. 离散总质量守恒**\n\n在时间层 $n$ 的离散总质量定义为 $M^n = \\sum_i c_i^n \\Delta x$，其中求和遍历周期性区域中的所有单元。假设有 $N$ 个单元，索引从 $i=1$ 到 $N$。时间层 $n+1$ 的总质量为：\n$$\nM^{n+1} = \\sum_{i=1}^{N} c_i^{n+1} \\Delta x\n$$\n代入离散更新方程：\n$$\nM^{n+1} = \\sum_{i=1}^{N} \\left[ c_i^n - \\frac{u \\Delta t}{\\Delta x} (c_i^n - c_{i-1}^n) \\right] \\Delta x\n$$\n$$\nM^{n+1} = \\sum_{i=1}^{N} c_i^n \\Delta x - u \\Delta t \\sum_{i=1}^{N} (c_i^n - c_{i-1}^n)\n$$\n第一项是时间 $n$ 的总质量 $M^n$。第二项是一个伸缩求和：\n$$\n\\sum_{i=1}^{N} (c_i^n - c_{i-1}^n) = (c_1^n - c_0^n) + (c_2^n - c_1^n) + \\dots + (c_N^n - c_{N-1}^n) = c_N^n - c_0^n\n$$\n由于周期性边界条件，单元 $0$ 中的值与最后一个单元 $N$ 中的值相同。因此，$c_0^n = c_N^n$。该和为零。\n$$\n\\sum_{i=1}^{N} (c_i^n - c_{i-1}^n) = 0\n$$\n因此，$M^{n+1} = M^n$。离散总质量对所有 $n$ 都是守恒的。\n\n**3. 修正方程分析与有效扩散**\n\n我们从离散更新方程开始，并将每一项替换为其在点 $(x_i, t_n)$ 附近的泰勒级数展开，其中 $c(x_i, t_n) = c_i^n$。\n$$\nc_i^{n+1} = c(x_i, t_n+\\Delta t) \\approx c_i^n + \\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + O((\\Delta t)^3)\n$$\n$$\nc_{i-1}^n = c(x_i-\\Delta x, t_n) \\approx c_i^n - \\Delta x \\frac{\\partial c}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{(\\Delta x)^3}{6} \\frac{\\partial^3 c}{\\partial x^3} + O((\\Delta x)^4)\n$$\n将这些代入 $c_i^{n+1} = c_i^n - \\sigma(c_i^n - c_{i-1}^n)$ 中：\n$$\nc_i^n + \\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = c_i^n - \\frac{u \\Delta t}{\\Delta x} \\left[ c_i^n - \\left( c_i^n - \\Delta x \\frac{\\partial c}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\dots \\right) \\right]\n$$\n简化并消去 $c_i^n$：\n$$\n\\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = - \\frac{u \\Delta t}{\\Delta x} \\left( \\Delta x \\frac{\\partial c}{\\partial x} - \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} + \\dots \\right)\n$$\n除以 $\\Delta t$：\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\Delta t}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = -u \\frac{\\partial c}{\\partial x} + \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\dots\n$$\n重新整理得到修正方程：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{\\Delta t}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\text{高阶项}\n$$\n为了得到所要求的形式，我们必须将右侧的时间导数用空间导数表示。该方程的最低阶近似为 $\\frac{\\partial c}{\\partial t} \\approx -u \\frac{\\partial c}{\\partial x}$。对 $t$ 求导得到 $\\frac{\\partial^2 c}{\\partial t^2} \\approx -u \\frac{\\partial}{\\partial x}(\\frac{\\partial c}{\\partial t})$。再次代入最低阶近似，得到 $\\frac{\\partial^2 c}{\\partial t^2} \\approx -u \\frac{\\partial}{\\partial x}(-u \\frac{\\partial c}{\\partial x}) = u^2 \\frac{\\partial^2 c}{\\partial x^2}$。\n将此结果代回修正方程：\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 c}{\\partial x^2} \\right) + \\text{高阶项}\n$$\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 c}{\\partial x^2} + \\text{高阶项}\n$$\n通过与目标平流扩散方程进行比较，我们确定有效扩散系数为：\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) = \\frac{u \\Delta x}{2} (1 - \\sigma)\n$$\n\n**4. 与解析解的验证**\n\n考虑平流扩散方程 $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = D_{\\mathrm{eff}} \\frac{\\partial^{2} c}{\\partial x^{2}}$。我们寻找形如 $c(x,t) = c_0 + A(t) \\exp(ikx)$ 的解。将其代入偏微分方程（常数 $c_0$ 是平凡的），我们有：\n$$\n\\frac{dA}{dt} e^{ikx} + u (ik A(t) e^{ikx}) = D_{\\mathrm{eff}} (-k^2 A(t) e^{ikx})\n$$\n除以 $e^{ikx}$ 得到复振幅 $A(t)$ 的常微分方程：\n$$\n\\frac{dA}{dt} = (-iuk - D_{\\mathrm{eff}} k^2) A(t)\n$$\n解为 $A(t) = A(0) \\exp((-iuk - D_{\\mathrm{eff}} k^2)t)$。物理振幅是其模 $|A(t)|$：\n$$\n|A(t)| = |A(0)| |\\exp(-iukt)| |\\exp(-D_{\\mathrm{eff}} k^2 t)| = |A(0)| \\cdot 1 \\cdot \\exp(-D_{\\mathrm{eff}} k^2 t)\n$$\n这证实了傅里叶模态的振幅按 $A \\exp(-D_{\\mathrm{eff}} k^2 t)$ 衰减，其中 $A$ 现在代表初始振幅 $|A(0)|$。\n\n接下来，我们检查与离散格式的一致性。通过将 $c_j^n = G^n \\exp(ikj\\Delta x)$ 代入离散方程，可以找到格式的放大因子 $G$：\n$$\nG^{n+1} e^{ikj\\Delta x} = G^n e^{ikj\\Delta x} - \\sigma(G^n e^{ikj\\Delta x} - G^n e^{ik(j-1)\\Delta x})\n$$\n除以 $G^n e^{ikj\\Delta x}$：\n$$\nG = 1 - \\sigma(1 - e^{-ik\\Delta x})\n$$\n放大因子的模的平方是：\n$$\n|G|^2 = |1 - \\sigma(1-\\cos(k\\Delta x)) + i\\sigma \\sin(k\\Delta x)|^2 = (1 - \\sigma(1-\\cos(k\\Delta x)))^2 + (\\sigma \\sin(k\\Delta x))^2\n$$\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(1-\\cos(k\\Delta x))^2 + \\sigma^2\\sin^2(k\\Delta x)\n$$\n使用 $\\sin^2\\theta + \\cos^2\\theta = 1$：\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(1 - 2\\cos(k\\Delta x) + \\cos^2(k\\Delta x) + \\sin^2(k\\Delta x))\n$$\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(2 - 2\\cos(k\\Delta x)) = 1 - 2\\sigma(1-\\sigma)(1-\\cos(k\\Delta x))\n$$\n对于小的 $k\\Delta x$，我们使用泰勒展开 $1-\\cos(k\\Delta x) \\approx \\frac{(k\\Delta x)^2}{2}$。\n$$\n|G|^2 \\approx 1 - 2\\sigma(1-\\sigma)\\frac{(k\\Delta x)^2}{2} = 1 - \\sigma(1-\\sigma)(k\\Delta x)^2\n$$\n解析解在一个时间步长 $t=\\Delta t$ 后的振幅平方比为 $[|A(\\Delta t)|/|A(0)|]^2 = [\\exp(-D_{\\mathrm{eff}} k^2 \\Delta t)]^2 = \\exp(-2D_{\\mathrm{eff}} k^2 \\Delta t)$。对于小的 $\\Delta t$，这大约是 $1 - 2D_{\\mathrm{eff}} k^2 \\Delta t$。\n令两种振幅平方比的表达式相等：\n$$\n1 - \\sigma(1-\\sigma)(k\\Delta x)^2 \\approx 1 - 2D_{\\mathrm{eff}} k^2 \\Delta t\n$$\n$$\n\\sigma(1-\\sigma)k^2(\\Delta x)^2 = 2D_{\\mathrm{eff}} k^2 \\Delta t\n$$\n代入 $\\sigma = u\\Delta t/\\Delta x$：\n$$\n\\frac{u\\Delta t}{\\Delta x}(1-\\sigma)(\\Delta x)^2 = 2D_{\\mathrm{eff}} \\Delta t \\implies u\\Delta x(1-\\sigma) = 2D_{\\mathrm{eff}}\n$$\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2}(1-\\sigma)\n$$\n这表明离散格式的振幅衰减与修正方程在主导非平凡阶上是一致的。\n\n**5. $D_{\\mathrm{eff}}$ 的数值计算**\n\n使用给定的参数：\n$u = 10 \\,\\text{m s}^{-1}$\n$\\Delta x = 1.0 \\times 10^{4} \\,\\text{m}$\n$\\Delta t = 5.0 \\times 10^{2} \\,\\text{s}$\n\n首先，计算库朗数 $\\sigma$：\n$$\n\\sigma = \\frac{u \\Delta t}{\\Delta x} = \\frac{(10) (5.0 \\times 10^{2})}{1.0 \\times 10^{4}} = \\frac{5000}{10000} = 0.5\n$$\n现在，计算有效扩散系数 $D_{\\mathrm{eff}}$：\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2}(1-\\sigma) = \\frac{(10)(1.0 \\times 10^{4})}{2}(1 - 0.5)\n$$\n$$\nD_{\\mathrm{eff}} = \\frac{1.0 \\times 10^{5}}{2}(0.5) = (5.0 \\times 10^{4})(0.5) = 2.5 \\times 10^{4} \\,\\text{m}^{2} \\,\\text{s}^{-1}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nD_{\\mathrm{eff}} = 2.500 \\times 10^{4} \\,\\text{m}^{2} \\,\\text{s}^{-1}\n$$",
            "answer": "$$\\boxed{2.500 \\times 10^{4}}$$"
        },
        {
            "introduction": "本练习综合了前两个实践的要点，为数值误差问题提供了建设性的解决方案。它专注于在交错网格上设计一个有限体积格式，以保证质量的精确守恒——这对于长期气候模拟而言是一个不可妥协的属性。通过在球面上实现这一守恒格式，并将其与一个非守恒格式进行对比，你将亲身体验支撑现代天气和气候模型的关键设计原则。",
            "id": "4025478",
            "problem": "考虑用于数值天气预报和气候模拟的球面浅水方程。其基本原理是在一个半径为 $R$ 的旋转球体上，对厚度为 $h(\\phi,\\lambda,t)$ 的单一均匀流体层所表达的质量、动量和能量守恒定律。通量形式的质量守恒定律指出，一个物质体积内质量的变化率等于穿过其边界的净质量通量。对于具有恒定质量密度 $ \\rho $ 的均匀层，这简化为关于层厚的守恒定律，其中平流通量取决于水平速度场 $ \\mathbf{u} = (u(\\phi,\\lambda,t), v(\\phi,\\lambda,t)) $。使用球面坐标，其中纬度为 $ \\phi $，经度为 $ \\lambda $（角度以弧度为单位），并将散度定理应用于由纬度和经度线界定的有限体积，可以推导出一个有限体积通量形式的离散化方法。当跨共享面的通量计算一次并以相反的符号用于相邻单元时，该方法可确保精确的全局质量守恒。解释在交错网格（例如 Arakawa C-网格，其中 $h$ 位于单元中心，速度分量位于单元面）上变量的布局如何保证质量通量在单元面上自然地计算，并将其与同位网格（例如 Arakawa A-网格）进行对比。在同位网格上，对平流项进行简单的中心差分通常不会产生面通量的伸缩求和，因此可能无法实现精确的质量守恒。\n\n仅从以下基本定律和定义出发，推导在经纬度网格上的一个一致的通量形式有限体积离散化，该离散化确保层厚更新的精确全局质量守恒：\n- 质量守恒：$ \\dfrac{\\partial (\\rho h)}{\\partial t} + \\nabla \\cdot (\\rho h \\mathbf{u}) = 0 $。\n- 对于恒定的 $ \\rho $，其厚度形式为：$ \\dfrac{\\partial h}{\\partial t} + \\nabla \\cdot (h \\mathbf{u}) = 0 $。\n- 散度定理：$ \\displaystyle \\int_{\\Omega} \\nabla \\cdot \\mathbf{F} \\, \\mathrm{d}A = \\oint_{\\partial \\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, \\mathrm{d}s $。\n- 半径为 $R$ 的球面上的球坐标度量因子：在纬度 $ \\phi $ 处沿经度的局部线元为 $ R \\, \\mathrm{d}\\phi $，沿纬度的局部线元为 $ R \\cos \\phi \\, \\mathrm{d}\\lambda $；由 $ \\phi_{i-\\frac{1}{2}} \\le \\phi \\le \\phi_{i+\\frac{1}{2}} $ 和 $ \\lambda_{j-\\frac{1}{2}} \\le \\lambda \\le \\lambda_{j+\\frac{1}{2}} $ 界定的经纬度单元的面积元为 $ R^2 \\, (\\sin \\phi_{i+\\frac{1}{2}} - \\sin \\phi_{i-\\frac{1}{2}}) \\, (\\lambda_{j+\\frac{1}{2}} - \\lambda_{j-\\frac{1}{2}}) $。\n\n您必须：\n- 从第一性原理出发，推导一个基于面积分体积通量的 $h$ 的离散更新公式，该公式在经度方向使用周期性边界条件且区域包含两极时，能够保证 $ \\sum_{i,j} h_{i,j} A_{i,j} $（其中 $ A_{i,j} $ 是第 $(i,j)$ 个单元的几何面积）的全局守恒达到舍入误差级别。\n- 阐明网格交错（Arakawa C-网格）如何实现通量的自然和守恒计算，并解释为什么对 $ \\nabla \\cdot (h \\mathbf{u}) $ 的简单同位（Arakawa A-网格）中心差分近似通常因度量因子和非伸缩离散算子而无法保证在球面上精确守恒。\n- 实现一个程序，使用以下两种方法对厚度更新执行单步显式时间步进：\n  1. 在 Arakawa C-网格上使用守恒的通量形式有限体积法，该方法使用在每个面上计算一次并反对称地应用于两个相邻单元的面积分体积通量。\n  2. 在 Arakawa A-网格上对 $ \\nabla \\cdot (h \\mathbf{u}) $ 进行简单的同位中心差分近似，该近似在单元中心使用中心差分计算 $ \\dfrac{1}{R \\cos \\phi} \\dfrac{\\partial (h u)}{\\partial \\lambda} + \\dfrac{1}{R \\cos \\phi} \\dfrac{\\partial (h v \\cos \\phi)}{\\partial \\phi} $。\n- 对两种方法使用相同的指定初始条件和速度场：角速度为 $ \\Omega $ 的刚体旋转，产生 $ u(\\phi) = \\Omega R \\cos \\phi $ 和 $ v(\\phi) = 0 $，以及层厚场 $ h(\\phi,\\lambda,0) = H_0 + H_1 \\cos \\phi \\cos(k \\lambda) $。\n\n程序中使用的物理常数和参数：\n- 地球半径 $ R = 6.371 \\times 10^6 \\, \\mathrm{m} $。\n- 重力加速度 $ g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2} $。\n- 层质量密度 $ \\rho = 1000 \\, \\mathrm{kg} \\, \\mathrm{m}^{-3} $。\n- 角速度 $ \\Omega = 1.0 \\times 10^{-4} \\, \\mathrm{rad} \\, \\mathrm{s}^{-1} $。\n- 基础厚度 $ H_0 = 10000 \\, \\mathrm{m} $，扰动振幅 $ H_1 = 100 \\, \\mathrm{m} $，以及经向波数 $ k = 3 $。\n\n角度单位为弧度。所有经度坐标在 $ [0, 2\\pi) $ 上是周期的；纬度中心位于 $ \\phi_i = -\\dfrac{\\pi}{2} + \\left(i + \\dfrac{1}{2}\\right) \\Delta \\phi $，其中 $ i = 0, 1, \\dots, N_\\phi - 1 $，且 $ \\Delta \\phi = \\dfrac{\\pi}{N_\\phi} $，纬度边界在 $ \\phi_{-\\frac{1}{2}} = -\\dfrac{\\pi}{2} $ 和 $ \\phi_{N_\\phi-\\frac{1}{2}} = \\dfrac{\\pi}{2} $。经度中心位于 $ \\lambda_j = j \\Delta \\lambda $，其中 $ j = 0, 1, \\dots, N_\\lambda - 1 $，且 $ \\Delta \\lambda = \\dfrac{2\\pi}{N_\\lambda} $，边界为周期性。\n\n时间步进：\n- 使用每种方法分别对 $h$ 的质量守恒定律应用一个大小为 $ \\Delta t $ 的前向欧拉时间步。\n\n为每个测试案例定义和计算以下诊断量：\n- 绝对全局质量误差 $ |M^{(1)} - M^{(0)}| $，单位为 $ \\mathrm{kg} $，其中 $ M^{(n)} = \\rho \\sum_{i,j} h^{(n)}_{i,j} A_{i,j} $，$n = 0$ 或 $1$ 表示时间层。\n- 总离散能量变化 $ E^{(1)} - E^{(0)} $，单位为 $ \\mathrm{J} $，其中 $ E^{(n)} = \\sum_{i,j} \\left( \\dfrac{1}{2} \\rho h^{(n)}_{i,j} \\left(u^2(\\phi_i) + v^2(\\phi_i)\\right) + \\dfrac{1}{2} \\rho g \\left(h^{(n)}_{i,j}\\right)^2 \\right) A_{i,j} $。\n\n测试套件：\n- 案例 1：守恒的 C-网格通量形式，$ N_\\phi = 36 $，$ N_\\lambda = 72 $，$ \\Delta t = 600 \\, \\mathrm{s} $。\n- 案例 2：简单的 A-网格中心差分，$ N_\\phi = 36 $，$ N_\\lambda = 72 $，$ \\Delta t = 600 \\, \\mathrm{s} $。\n- 案例 3：守恒的 C-网格通量形式，$ N_\\phi = 4 $，$ N_\\lambda = 8 $，$ \\Delta t = 600 \\, \\mathrm{s} $。\n- 案例 4：简单的 A-网格中心差分，$ N_\\phi = 4 $，$ N_\\lambda = 8 $，$ \\Delta t = 1200 \\, \\mathrm{s} $。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表。该列表必须按 $ [m_1, e_1, m_2, e_2, m_3, e_3, m_4, e_4] $ 的顺序排列，其中 $ m_c $ 是案例 $ c $ 的绝对全局质量误差（单位 $ \\mathrm{kg} $），$ e_c $ 是能量变化（单位 $ \\mathrm{J} $）。例如，$ [m_1,e_1,m_2,e_2,m_3,e_3,m_4,e_4] $。",
            "solution": "### 第 1 部分：守恒有限体积格式的推导（C-网格）\n\n基本原理是对于密度恒为 $ \\rho $、厚度为 $ h $ 的流体，其质量守恒，由通量形式的连续性方程表示：\n$$\n\\frac{\\partial h}{\\partial t} + \\nabla \\cdot (h \\mathbf{u}) = 0\n$$\n其中 $ \\mathbf{u} = (u, v) $ 是水平速度矢量。\n\n为推导有限体积离散化，我们将此方程在一个由纬度 $ \\phi_{i-\\frac{1}{2}} $、$ \\phi_{i+\\frac{1}{2}} $ 和经度 $ \\lambda_{j-\\frac{1}{2}} $、$ \\lambda_{j+\\frac{1}{2}} $ 界定的网格单元面积 $ A_{i,j} $ 上积分。\n$$\n\\int_{A_{i,j}} \\frac{\\partial h}{\\partial t} \\, \\mathrm{d}A + \\int_{A_{i,j}} \\nabla \\cdot (h \\mathbf{u}) \\, \\mathrm{d}A = 0\n$$\n假设 $ h_{i,j} $ 代表单元平均厚度，第一项可近似为 $ A_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} $。第二项使用散度定理进行变换，该定理将一个区域上散度的面积分等同于穿过其边界 $ \\partial A_{i,j} $ 的通量：\n$$\n\\int_{A_{i,j}} \\nabla \\cdot (h \\mathbf{u}) \\, \\mathrm{d}A = \\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s\n$$\n其中 $ \\mathbf{n} $ 是向外的单位法向量。这给出了单元平均厚度的半离散方程：\n$$\nA_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - \\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s\n$$\n右侧的线积分代表流出该单元的总净体积通量。它是穿过单元四个面（东、西、南、北）的通量之和。设 $ F_{E} $、$ F_{W} $、$ F_{N} $、$ F_{S} $ 是穿过这些面的总体积通量。\n$$\n\\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s = F_{E, i,j} - F_{W, i,j} + F_{N, i,j} - F_{S, i,j}\n$$\n在 C-网格上，像 $ h $ 这样的标量变量位于单元中心 $ (\\phi_i, \\lambda_j) $，而速度分量位于单元面上。纬向速度 $ u $ 位于东/西面 $ (\\phi_i, \\lambda_{j \\pm \\frac{1}{2}}) $，经向速度 $ v $ 位于南/北面 $ (\\phi_{i \\pm \\frac{1}{2}}, \\lambda_j) $。这种交错布局对于计算通量来说是自然的。\n\n在纬度 $ \\phi $ 处的纬线段长度为 $ R \\cos \\phi \\, \\mathrm{d}\\lambda $，经线段长度为 $ R \\, \\mathrm{d}\\phi $。总通量是沿单元面的积分：\n- 通过东面 $ \\lambda_{j+\\frac{1}{2}} $ 的纬向通量：$ F_{E, i,j} \\equiv F_{\\lambda, i, j+\\frac{1}{2}} = \\int_{\\phi_{i-\\frac{1}{2}}}^{\\phi_{i+\\frac{1}{2}}} (h u)_{i, j+\\frac{1}{2}} R \\, \\mathrm{d}\\phi \\approx (h u)_{i, j+\\frac{1}{2}} R \\Delta\\phi $\n- 通过北面 $ \\phi_{i+\\frac{1}{2}} $ 的经向通量：$ F_{N, i,j} \\equiv F_{\\phi, i+\\frac{1}{2}, j} = \\int_{\\lambda_{j-\\frac{1}{2}}}^{\\lambda_{j+\\frac{1}{2}}} (h v)_{i+\\frac{1}{2}, j} R \\cos\\phi_{i+\\frac{1}{2}} \\, \\mathrm{d}\\lambda \\approx (h v)_{i+\\frac{1}{2}, j} R \\cos\\phi_{i+\\frac{1}{2}} \\Delta\\lambda $\n\n西面和南面的通量分别为 $ F_{\\lambda, i, j-\\frac{1}{2}} $ 和 $ F_{\\phi, i-\\frac{1}{2}, j} $。半离散方程变为：\n$$\nA_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\n由于 $ u $ 和 $ v $ 定义在面上，我们只需要在面上近似 $ h $。通常使用简单的算术平均：$ h_{i, j+\\frac{1}{2}} \\approx \\frac{1}{2}(h_{i,j} + h_{i,j+1}) $。这定义了通量项 $ (h u)_{i, j+\\frac{1}{2}} $。应用前向欧拉时间步 $ h^{n+1} = h^n + \\Delta t \\frac{\\mathrm{d}h}{\\mathrm{d}t} $ 得到最终的更新公式：\n$$\nh_{i,j}^{n+1} = h_{i,j}^{n} - \\frac{\\Delta t}{A_{i,j}} [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\n全局质量为 $ M = \\sum_{i,j} \\rho h_{i,j} A_{i,j} $。全局质量的变化为 $ \\Delta M = \\rho \\sum_{i,j} (h_{i,j}^{n+1} - h_{i,j}^{n}) A_{i,j} $。代入更新公式：\n$$\n\\Delta M = - \\rho \\Delta t \\sum_{i,j} [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\n关键在于，流出单元 $ (i,j) $ 的通量 $ F_{\\lambda, i, j+\\frac{1}{2}} $ 正是流入单元 $ (i, j+1) $ 的通量。因为这些通量在每个面上只计算一次，并以相反的符号应用于相邻的两个单元，所以对所有单元求和会变成一个伸缩求和。对于周期性经度，$ \\sum_{j} (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) = 0 $。对于经向通量，$ \\sum_{i} (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) = F_{\\phi, N_\\phi-\\frac{1}{2}, j} - F_{\\phi, -\\frac{1}{2}, j} $。这些是极点处的通量。在极点 $ \\phi = \\pm \\pi/2 $ 处，单元面的长度为零（$ \\cos(\\pm\\pi/2) = 0 $），所以这些边界通量为零。因此，$ \\Delta M = 0 $。这表明 C-网格有限体积格式保证了在机器精度内的精确全局质量守恒。\n\n### 第 2 部分：与同位格式的对比（A-网格）\n\n在 A-网格上，所有变量（$ h, u, v $）都定义在单元中心 $ (\\phi_i, \\lambda_j) $。连续性方程直接从其微分形式离散化：\n$$\n\\frac{\\partial h}{\\partial t} = - \\nabla \\cdot (h \\mathbf{u}) = - \\frac{1}{R \\cos \\phi} \\left( \\frac{\\partial (hu)}{\\partial \\lambda} + \\frac{\\partial (hv \\cos \\phi)}{\\partial \\phi} \\right)\n$$\n在单元 $ (i,j) $ 处的一个简单的中心差分近似是：\n$$\n\\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} \\approx - \\frac{1}{R \\cos \\phi_i} \\left( \\frac{(hu)_{i,j+1} - (hu)_{i,j-1}}{2\\Delta\\lambda} + \\frac{(hv\\cos\\phi)_{i+1,j} - (hv\\cos\\phi)_{i-1,j}}{2\\Delta\\phi} \\right)\n$$\n经过一个时间步 $ \\Delta t $ 后，总质量的变化为：\n$$\n\\Delta M = \\rho \\sum_{i,j} (h_{i,j}^{n+1} - h_{i,j}^{n}) A_{i,j} = \\rho \\Delta t \\sum_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} A_{i,j}\n$$\n这个和通常不会伸缩抵消为零，因为在更新不同单元时，涉及相同通量点（例如 $(hu)_{i,j+1}$）的项会被不同的几何因子（例如 $A_{i,j}/\\cos\\phi_i$ 和 $A_{i,j+2}/\\cos\\phi_{i+2}$）加权。这种离散散度算子并非离散梯度算子的真正伴随算子的失败，意味着单元间的通量没有得到隐式平衡，从而导致总质量出现虚假变化。\n\n对于本问题中给定的特定速度场，$v=0$ 且 $ u = \\Omega R \\cos \\phi $，A-网格的更新简化为：\n$$\n\\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - \\frac{1}{R \\cos \\phi_i} \\frac{h_{i,j+1}(\\Omega R \\cos\\phi_i) - h_{i,j-1}(\\Omega R \\cos\\phi_i)}{2\\Delta\\lambda} = - \\frac{\\Omega}{2\\Delta\\lambda} (h_{i,j+1} - h_{i,j-1})\n$$\n该项对总质量变化的贡献与 $ \\sum_{i,j} A_{i,j} (h_{i,j+1} - h_{i,j-1}) $ 成正比。首先对 $ j $ 求和：由于周期性边界条件，$ \\sum_{j} (h_{i,j+1} - h_{i,j-1}) = 0 $。因此，对于这个特定的简化案例，简单的 A-网格格式也恰好守恒质量。\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the shallow water thickness equation for two different numerical schemes\n    and calculates mass and energy conservation diagnostics.\n    \"\"\"\n    # Physical constants and parameters\n    R = 6.371e6  # Earth radius in m\n    g = 9.81  # Gravitational acceleration in m/s^2\n    rho = 1000.0  # Layer mass density in kg/m^3\n    Omega = 1.0e-4  # Angular speed in rad/s\n    H0 = 10000.0  # Base thickness in m\n    H1 = 100.0  # Perturbation amplitude in m\n    k = 3  # Longitudinal wavenumber\n\n    test_cases = [\n        ('c_grid', 36, 72, 600.0),\n        ('a_grid', 36, 72, 600.0),\n        ('c_grid', 4, 8, 600.0),\n        ('a_grid', 4, 8, 1200.0)\n    ]\n\n    results = []\n\n    for method, N_phi, N_lambda, dt in test_cases:\n        # 1. Grid Setup\n        d_phi = np.pi / N_phi\n        d_lambda = 2 * np.pi / N_lambda\n\n        # Cell center coordinates\n        phi_c = -np.pi / 2 + (np.arange(N_phi) + 0.5) * d_phi\n        lon_c = np.arange(N_lambda) * d_lambda\n        LON_C, PHI_C = np.meshgrid(lon_c, phi_c)\n\n        # Cell face latitudes (for area calculation)\n        phi_f = -np.pi / 2 + np.arange(N_phi + 1) * d_phi\n\n        # Cell areas\n        sin_phi_f = np.sin(phi_f)\n        d_sin_phi = sin_phi_f[1:] - sin_phi_f[:-1]\n        A = R**2 * d_sin_phi[:, np.newaxis] * d_lambda\n\n        # 2. Initial Conditions\n        h0 = H0 + H1 * np.cos(PHI_C) * np.cos(k * LON_C)\n\n        # Velocity field (at cell centers for energy calculation)\n        u_c = Omega * R * np.cos(PHI_C)\n        v_c = np.zeros_like(u_c)\n        \n        # 3. Calculate Initial Mass and Energy\n        def calculate_diagnostics(h_field, u_field, v_field, area_grid):\n            # Mass M = rho * sum(h_ij * A_ij)\n            mass = rho * np.sum(h_field * area_grid)\n            \n            # Energy E = sum( (1/2*rho*h*(u^2+v^2) + 1/2*rho*g*h^2) * A_ij )\n            ke_density = 0.5 * rho * h_field * (u_field**2 + v_field**2)\n            pe_density = 0.5 * rho * g * h_field**2\n            energy = np.sum((ke_density + pe_density) * area_grid)\n            return mass, energy\n\n        M0, E0 = calculate_diagnostics(h0, u_c, v_c, A)\n\n        # 4. Perform a single time step\n        h1 = np.zeros_like(h0)\n        \n        if method == 'c_grid':\n            # Conservative Flux-Form Method (C-grid)\n            # Velocity u at east-west faces (constant in lambda)\n            u_face = Omega * R * np.cos(phi_c) # 1D array\n            \n            # h at east-west faces (average of adjacent cell centers)\n            h_face = 0.5 * (h0 + np.roll(h0, -1, axis=1))\n\n            # Total volumetric flux through east-west faces\n            # F_lambda = (h*u)_face * Face_Area = (h*u)_face * R*d_phi\n            F_lambda = h_face * u_face[:, np.newaxis] * R * d_phi\n            \n            # Flux divergence in longitude. F_lambda_j-1/2 = F_lambda_j-1 rolled\n            div_F_lambda = F_lambda - np.roll(F_lambda, 1, axis=1)\n\n            # Meridional fluxes are zero since v=0\n            div_F_phi = np.zeros_like(h0)\n            \n            # Update h\n            h1 = h0 - (dt / A) * (div_F_lambda + div_F_phi)\n\n        elif method == 'a_grid':\n            # Naive Central Difference Method (A-grid)\n            # All variables are at cell centers.\n            # Update law: dh/dt = -Omega/(2*d_lambda) * (h_{j+1} - h_{j-1})\n            # This is derived from the full form with v=0 and u = Omega*R*cos(phi)\n            \n            # Zonal advection of h\n            h_jp1 = np.roll(h0, -1, axis=1)\n            h_jm1 = np.roll(h0, 1, axis=1)\n            \n            dhdt = -Omega / (2 * d_lambda) * (h_jp1 - h_jm1)\n            \n            h1 = h0 + dt * dhdt\n\n        # 5. Calculate Final Mass and Energy\n        M1, E1 = calculate_diagnostics(h1, u_c, v_c, A)\n\n        # 6. Compute diagnostics\n        mass_error = abs(M1 - M0)\n        energy_change = E1 - E0\n        \n        results.extend([mass_error, energy_change])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the shallow water thickness equation for two different numerical schemes\n    and calculates mass and energy conservation diagnostics.\n    \"\"\"\n    # Physical constants and parameters\n    R = 6.371e6  # Earth radius in m\n    g = 9.81  # Gravitational acceleration in m/s^2\n    rho = 1000.0  # Layer mass density in kg/m^3\n    Omega = 1.0e-4  # Angular speed in rad/s\n    H0 = 10000.0  # Base thickness in m\n    H1 = 100.0  # Perturbation amplitude in m\n    k = 3  # Longitudinal wavenumber\n\n    test_cases = [\n        ('c_grid', 36, 72, 600.0),\n        ('a_grid', 36, 72, 600.0),\n        ('c_grid', 4, 8, 600.0),\n        ('a_grid', 4, 8, 1200.0)\n    ]\n\n    results = []\n\n    for method, N_phi, N_lambda, dt in test_cases:\n        # 1. Grid Setup\n        d_phi = np.pi / N_phi\n        d_lambda = 2 * np.pi / N_lambda\n\n        # Cell center coordinates\n        phi_c = -np.pi / 2 + (np.arange(N_phi) + 0.5) * d_phi\n        lon_c = np.arange(N_lambda) * d_lambda\n        LON_C, PHI_C = np.meshgrid(lon_c, phi_c)\n\n        # Cell face latitudes (for area calculation)\n        phi_f = -np.pi / 2 + np.arange(N_phi + 1) * d_phi\n\n        # Cell areas\n        sin_phi_f = np.sin(phi_f)\n        d_sin_phi = sin_phi_f[1:] - sin_phi_f[:-1]\n        A = R**2 * d_sin_phi[:, np.newaxis] * d_lambda\n\n        # 2. Initial Conditions\n        h0 = H0 + H1 * np.cos(PHI_C) * np.cos(k * LON_C)\n\n        # Velocity field (at cell centers for energy calculation)\n        u_c = Omega * R * np.cos(PHI_C)\n        v_c = np.zeros_like(u_c)\n        \n        # 3. Calculate Initial Mass and Energy\n        def calculate_diagnostics(h_field, u_field, v_field, area_grid):\n            # Mass M = rho * sum(h_ij * A_ij)\n            mass = rho * np.sum(h_field * area_grid)\n            \n            # Energy E = sum( (1/2*rho*h*(u^2+v^2) + 1/2*rho*g*h^2) * A_ij )\n            ke_density = 0.5 * rho * h_field * (u_field**2 + v_field**2)\n            pe_density = 0.5 * rho * g * h_field**2\n            energy = np.sum((ke_density + pe_density) * area_grid)\n            return mass, energy\n\n        M0, E0 = calculate_diagnostics(h0, u_c, v_c, A)\n\n        # 4. Perform a single time step\n        h1 = np.zeros_like(h0)\n        \n        if method == 'c_grid':\n            # Conservative Flux-Form Method (C-grid)\n            # Velocity u at east-west faces (constant in lambda)\n            u_face = Omega * R * np.cos(phi_c) # 1D array\n            \n            # h at east-west faces (average of adjacent cell centers)\n            h_face = 0.5 * (h0 + np.roll(h0, -1, axis=1))\n\n            # Total volumetric flux through east-west faces\n            # F_lambda = (h*u)_face * Face_Area = (h*u)_face * R*d_phi\n            F_lambda = h_face * u_face[:, np.newaxis] * R * d_phi\n            \n            # Flux divergence in longitude. F_lambda_j-1/2 = F_lambda_j-1 rolled\n            div_F_lambda = F_lambda - np.roll(F_lambda, 1, axis=1)\n\n            # Meridional fluxes are zero since v=0\n            div_F_phi = np.zeros_like(h0)\n            \n            # Update h\n            h1 = h0 - (dt / A) * (div_F_lambda + div_F_phi)\n\n        elif method == 'a_grid':\n            # Naive Central Difference Method (A-grid)\n            # All variables are at cell centers.\n            # Update law: dh/dt = -Omega/(2*d_lambda) * (h_{j+1} - h_{j-1})\n            # This is derived from the full form with v=0 and u = Omega*R*cos(phi)\n            \n            # Zonal advection of h\n            h_jp1 = np.roll(h0, -1, axis=1)\n            h_jm1 = np.roll(h0, 1, axis=1)\n            \n            dhdt = -Omega / (2 * d_lambda) * (h_jp1 - h_jm1)\n            \n            h1 = h0 + dt * dhdt\n\n        # 5. Calculate Final Mass and Energy\n        M1, E1 = calculate_diagnostics(h1, u_c, v_c, A)\n\n        # 6. Compute diagnostics\n        mass_error = abs(M1 - M0)\n        energy_change = E1 - E0\n        \n        results.extend([mass_error, energy_change])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}