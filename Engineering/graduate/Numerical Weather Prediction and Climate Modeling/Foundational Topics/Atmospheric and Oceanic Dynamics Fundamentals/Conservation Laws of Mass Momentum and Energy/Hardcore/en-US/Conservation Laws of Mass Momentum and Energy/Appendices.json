{
    "hands_on_practices": [
        {
            "introduction": "The conservation laws that govern fluid dynamics can be viewed from two perspectives: the Lagrangian view, which follows a fixed mass of fluid, and the Eulerian view, which observes the flow through a fixed or deforming control volume. Since numerical models typically divide the domain into a mesh of such volumes, translating between these perspectives is a foundational skill. This practice challenges you to derive the integral form of the mass conservation law from first principles, applying the general Reynolds Transport Theorem to a deforming control volume to solidify your understanding of this crucial link .",
            "id": "3944078",
            "problem": "A compressible fluid with density field $\\rho(\\mathbf{x},t)$ occupies a deforming control volume $V(t)$ bounded by a smooth control surface $S(t)$ with outward unit normal $\\mathbf{n}(\\mathbf{x},t)$. The control surface has two instrumented ports: an inlet with area $A_{\\mathrm{in}}(t)$ and an outlet with area $A_{\\mathrm{out}}(t)$. The remainder of the control surface is impermeable to mass. The fluid velocity is $\\mathbf{u}(\\mathbf{x},t)$ and the local boundary velocity is $\\mathbf{u}_{b}(\\mathbf{x},t)$. The inlet and outlet mass flow rates are measured relative to the moving boundary and are given by\n$$\n\\dot{m}_{\\mathrm{in}}(t) \\text{ and } \\dot{m}_{\\mathrm{out}}(t),\n$$\nrespectively, with the sign convention that $\\dot{m}_{\\mathrm{in}}(t) \\ge 0$ denotes mass flowing into $V(t)$ through $A_{\\mathrm{in}}(t)$ and $\\dot{m}_{\\mathrm{out}}(t) \\ge 0$ denotes mass flowing out of $V(t)$ through $A_{\\mathrm{out}}(t)$. There are no volumetric sources or sinks of mass within $V(t)$.\n\nStarting from first principles of mass conservation for a material system and using an appropriate transport theorem to relate a material system to the deforming control volume, write the integral mass balance for $V(t)$ and solve it to obtain an expression for the rate of change of total mass in the control volume,\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{V(t)} \\rho(\\mathbf{x},t)\\,\\mathrm{d}V,\n$$\nin terms of $\\dot{m}_{\\mathrm{in}}(t)$ and $\\dot{m}_{\\mathrm{out}}(t)$ only. Express your final answer in kilograms per second (kg s$^{-1}$). No numerical evaluation is required; provide a closed-form symbolic expression.",
            "solution": "The problem requires the derivation of an expression for the rate of change of total mass within a deforming control volume, starting from the fundamental principle of mass conservation.\n\nThe first principle is the law of conservation of mass applied to a material system. A material system is defined as a fixed collection of matter, so its total mass, $M_{sys}$, is constant over time. The material system occupies a material volume $V_m(t)$ that moves and deforms with the fluid. The conservation of mass for this system is expressed as:\n$$\n\\frac{\\mathrm{d}M_{sys}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V_m(t)} \\rho(\\mathbf{x},t) \\, \\mathrm{d}V = 0\n$$\nwhere $\\rho(\\mathbf{x},t)$ is the fluid density field.\n\nThe next step is to relate the rate of change for the material system to quantities measured with respect to a control volume $V(t)$. The problem specifies a deforming control volume $V(t)$ bounded by a surface $S(t)$ which moves with a local velocity $\\mathbf{u}_b(\\mathbf{x},t)$. The appropriate tool for this transformation is the general Reynolds Transport Theorem (also known as the Leibniz-Reynolds theorem). For an arbitrary extensive property $B_{sys} = \\int_{V_m(t)} \\beta(\\mathbf{x},t) \\, \\mathrm{d}V$, where $\\beta$ is the corresponding intensive property per unit volume, the theorem states:\n$$\n\\frac{\\mathrm{d}B_{sys}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\beta \\, \\mathrm{d}V + \\int_{S(t)} \\beta (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S\n$$\nHere, $\\mathbf{u}(\\mathbf{x},t)$ is the fluid velocity, and $\\mathbf{n}(\\mathbf{x},t)$ is the outward unit normal vector on the control surface $S(t)$. The term $(\\mathbf{u} - \\mathbf{u}_b)$ represents the fluid velocity relative to the moving boundary. This theorem is applied at the instant in time when the material volume $V_m(t)$ and the control volume $V(t)$ coincide.\n\nFor mass conservation, the extensive property is the mass itself, $M_{sys}$, so the corresponding intensive property per unit volume is the density, $\\rho$. Setting $\\beta = \\rho$ in the Reynolds Transport Theorem gives:\n$$\n\\frac{\\mathrm{d}M_{sys}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho \\, \\mathrm{d}V + \\int_{S(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S\n$$\nApplying the principle of mass conservation, $\\frac{\\mathrm{d}M_{sys}}{\\mathrm{d}t} = 0$, to the above equation yields the integral mass balance for the deforming control volume:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho \\, \\mathrm{d}V + \\int_{S(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = 0\n$$\nThe problem asks for an expression for the rate of change of total mass in the control volume, which is the term $\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho \\, \\mathrm{d}V$. Let's denote this by $\\frac{\\mathrm{d}M_{CV}}{\\mathrm{d}t}$. Rearranging the equation gives:\n$$\n\\frac{\\mathrm{d}M_{CV}}{\\mathrm{d}t} = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho \\, \\mathrm{d}V = - \\int_{S(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S\n$$\nThe right-hand side is the net rate of mass influx across the control surface $S(t)$. The control surface is composed of three disjoint parts: the inlet $A_{\\mathrm{in}}(t)$, the outlet $A_{\\mathrm{out}}(t)$, and the impermeable walls $S_{wall}(t)$. The surface integral can be split accordingly:\n$$\n\\int_{S(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = \\int_{A_{\\mathrm{in}}(t)} \\! \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S + \\int_{A_{\\mathrm{out}}(t)} \\! \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S + \\int_{S_{wall}(t)} \\! \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S\n$$\nWe analyze each integral:\n1.  On the impermeable walls $S_{wall}(t)$, no mass can pass through. This means the normal component of the fluid velocity relative to the boundary is zero: $(\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} = 0$. Therefore, the integral over the walls vanishes:\n    $$\n    \\int_{S_{wall}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = 0\n    $$\n2.  At the inlet $A_{\\mathrm{in}}(t)$, the problem states that the mass flow rate *into* the control volume is $\\dot{m}_{\\mathrm{in}}(t) \\ge 0$. The integral $\\int_{A_{\\mathrm{in}}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S$ represents the mass flux across the inlet surface. For an inlet, the relative velocity vector $(\\mathbf{u} - \\mathbf{u}_b)$ points into the volume, which is opposite to the outward normal vector $\\mathbf{n}$. Thus, the dot product $(\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n}$ is negative. The integral represents the net mass *outflow* through the inlet, which must be negative. The given mass flow rate *in*, $\\dot{m}_{\\mathrm{in}}(t)$, is defined as a positive quantity. Therefore, it must be the negative of the surface integral:\n    $$\n    \\dot{m}_{\\mathrm{in}}(t) = - \\int_{A_{\\mathrm{in}}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S \\implies \\int_{A_{\\mathrm{in}}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = - \\dot{m}_{\\mathrm{in}}(t)\n    $$\n3.  At the outlet $A_{\\mathrm{out}}(t)$, the mass flow rate *out of* the control volume is $\\dot{m}_{\\mathrm{out}}(t) \\ge 0$. For an outlet, the fluid exits the volume, so the relative velocity $(\\mathbf{u} - \\mathbf{u}_b)$ is in the same direction as the outward normal $\\mathbf{n}$. The dot product $(\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n}$ is positive. The integral $\\int_{A_{\\mathrm{out}}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S$ represents the mass outflow rate, which is precisely what $\\dot{m}_{\\mathrm{out}}(t)$ is defined as:\n    $$\n    \\int_{A_{\\mathrm{out}}(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = \\dot{m}_{\\mathrm{out}}(t)\n    $$\nSubstituting these results back into the expression for the total surface integral:\n$$\n\\int_{S(t)} \\rho (\\mathbf{u} - \\mathbf{u}_b) \\cdot \\mathbf{n} \\, \\mathrm{d}S = (-\\dot{m}_{\\mathrm{in}}(t)) + (\\dot{m}_{\\mathrm{out}}(t)) + 0 = \\dot{m}_{\\mathrm{out}}(t) - \\dot{m}_{\\mathrm{in}}(t)\n$$\nThis term represents the net mass outflow rate from the control volume.\nFinally, we substitute this into the rearranged mass balance equation:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho \\, \\mathrm{d}V = - \\left( \\dot{m}_{\\mathrm{out}}(t) - \\dot{m}_{\\mathrm{in}}(t) \\right)\n$$\nThis simplifies to the final expression for the rate of change of mass inside the control volume:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V(t)} \\rho(\\mathbf{x},t) \\, \\mathrm{d}V = \\dot{m}_{\\mathrm{in}}(t) - \\dot{m}_{\\mathrm{out}}(t)\n$$\nThe expression states that the rate of accumulation of mass in the control volume is equal to the rate of mass inflow minus the rate of mass outflow. The quantities $\\dot{m}_{\\mathrm{in}}(t)$ and $\\dot{m}_{\\mathrm{out}}(t)$ are mass flow rates, which have units of mass per time, such as kilograms per second (kg s$^{-1}$), consistent with the problem's requirement.",
            "answer": "$$\n\\boxed{\\dot{m}_{\\mathrm{in}}(t) - \\dot{m}_{\\mathrm{out}}(t)}\n$$"
        },
        {
            "introduction": "While the continuous conservation laws are exact, their numerical approximations are not. Discretizing a partial differential equation inevitably introduces truncation errors, which can manifest as non-physical behaviors that alter the solution. This exercise uses modified equation analysis to reveal the 'hidden' physics of a simple upwind advection scheme, demonstrating how it introduces an artificial numerical diffusion . Quantifying this effective diffusivity is a critical skill for any modeler, as it provides insight into the inherent dissipation of a numerical method.",
            "id": "4025449",
            "problem": "Consider one-dimensional passive tracer advection in a periodic domain of length $L$ under a spatially uniform, time-independent velocity $u$. The tracer concentration $c(x,t)$ satisfies the conservation of mass in flux form, $\\frac{\\partial c}{\\partial t} + \\frac{\\partial (u c)}{\\partial x} = 0$. A first-order, upwind, finite-volume discretization on a uniform grid with spacing $\\Delta x$ and time step $\\Delta t$ is used for $u > 0$. Let the cell-averaged tracer in cell index $i$ at time level $n$ be $c_{i}^{n}$.\n\nStarting from the flux-form conservation law and the definition of the upwind numerical flux for $u > 0$, derive the discrete update for $c_{i}^{n+1}$ in terms of $c_{i}^{n}$ and its upwind neighbor. Demonstrate, using periodic boundary conditions, that the total discrete tracer mass $\\sum_{i} c_{i}^{n} \\Delta x$ is conserved by this scheme for all $n$.\n\nNext, perform a modified-equation (equivalent partial differential equation) analysis of the discrete scheme to leading nontrivial order in $\\Delta x$ and $\\Delta t$ to show that it approximates an advection–diffusion equation of the form $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = D_{\\mathrm{eff}} \\frac{\\partial^{2} c}{\\partial x^{2}} + \\text{higher-order terms}$, and derive the effective diffusion coefficient $D_{\\mathrm{eff}}$ in terms of $u$, $\\Delta x$, and $\\Delta t$.\n\nTo validate the derivation against an analytic solution, consider the initial condition $c(x,0) = c_{0} + A \\cos(k x)$ with $c_{0}$ and $A$ constants and $k = \\frac{2 \\pi}{L}$. Using the analytic solution of the advection–diffusion equation with constant coefficients, show that the mode amplitude evolves as $A(t) = A \\exp(-D_{\\mathrm{eff}} k^{2} t)$, and verify that, for small $k \\Delta x$, the amplitude predicted after one time step $t = \\Delta t$ is consistent with the discrete scheme’s amplification to the same order.\n\nUse the following physically plausible parameters representative of numerical weather prediction:\n- Domain length $L = 1.0 \\times 10^{6} \\,\\text{m}$,\n- Velocity $u = 10 \\,\\text{m s}^{-1}$,\n- Grid spacing $\\Delta x = 1.0 \\times 10^{4} \\,\\text{m}$,\n- Time step $\\Delta t = 5.0 \\times 10^{2} \\,\\text{s}$,\n- Constants $c_{0} = 1$ and $A = 0.1$.\n\nCompute the value of the effective diffusion coefficient $D_{\\mathrm{eff}}$ and express your final answer in $\\text{m}^{2} \\,\\text{s}^{-1}$. Round your answer to four significant figures. The final answer must be a single real number.",
            "solution": "**1. Derivation of the Discrete Update Equation**\n\nThe conservation law is given in flux form as:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0\n$$\nwhere the flux is $F = uc$. For a finite volume method, we integrate this equation over a grid cell $i$, from $x_{i-1/2}$ to $x_{i+1/2}$, where $x_{i \\pm 1/2} = x_i \\pm \\frac{\\Delta x}{2}$.\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial c}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial F}{\\partial x} \\,dx = 0\n$$\nDefining the cell-average concentration as $c_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} c(x,t) \\,dx$, the first term becomes $\\frac{d(c_i \\Delta x)}{dt}$. Applying the fundamental theorem of calculus to the second term yields $F(x_{i+1/2}) - F(x_{i-1/2})$. The semi-discrete equation is:\n$$\n\\frac{d(c_i \\Delta x)}{dt} + F_{i+1/2} - F_{i-1/2} = 0\n$$\nwhere $F_{i \\pm 1/2}$ are the numerical fluxes at the cell faces. Approximating the time derivative with a first-order forward Euler scheme, we get:\n$$\n\\frac{c_i^{n+1} \\Delta x - c_i^n \\Delta x}{\\Delta t} + F_{i+1/2}^n - F_{i-1/2}^n = 0\n$$\nFor a first-order upwind scheme with $u > 0$, the value of the concentration at a cell face is taken from the cell \"upwind\" of the face, which is the cell to the left. Thus, the flux $F = uc$ at face $i+1/2$ is approximated using the concentration from cell $i$, and the flux at face $i-1/2$ is approximated using the concentration from cell $i-1$:\n$$\nF_{i+1/2}^n \\approx u c_i^n\n$$\n$$\nF_{i-1/2}^n \\approx u c_{i-1}^n\n$$\nSubstituting these into the discretized equation:\n$$\n\\frac{c_i^{n+1} - c_i^n}{\\Delta t} \\Delta x + u c_i^n - u c_{i-1}^n = 0\n$$\nRearranging to solve for $c_i^{n+1}$ gives the discrete update equation:\n$$\nc_i^{n+1} = c_i^n - \\frac{u \\Delta t}{\\Delta x} (c_i^n - c_{i-1}^n)\n$$\nDefining the Courant number $\\sigma = \\frac{u \\Delta t}{\\Delta x}$, the scheme is $c_i^{n+1} = c_i^n - \\sigma(c_i^n - c_{i-1}^n)$.\n\n**2. Conservation of Total Discrete Mass**\n\nThe total discrete mass at time level $n$ is defined as $M^n = \\sum_i c_i^n \\Delta x$, where the sum is over all cells in the periodic domain. Let there be $N$ cells, indexed from $i=1$ to $N$. The total mass at time level $n+1$ is:\n$$\nM^{n+1} = \\sum_{i=1}^{N} c_i^{n+1} \\Delta x\n$$\nSubstituting the discrete update equation:\n$$\nM^{n+1} = \\sum_{i=1}^{N} \\left[ c_i^n - \\frac{u \\Delta t}{\\Delta x} (c_i^n - c_{i-1}^n) \\right] \\Delta x\n$$\n$$\nM^{n+1} = \\sum_{i=1}^{N} c_i^n \\Delta x - u \\Delta t \\sum_{i=1}^{N} (c_i^n - c_{i-1}^n)\n$$\nThe first term is the total mass at time $n$, $M^n$. The second term is a telescoping sum:\n$$\n\\sum_{i=1}^{N} (c_i^n - c_{i-1}^n) = (c_1^n - c_0^n) + (c_2^n - c_1^n) + \\dots + (c_N^n - c_{N-1}^n) = c_N^n - c_0^n\n$$\nDue to the periodic boundary conditions, the value in cell $0$ is the same as the value in the last cell, $N$. Thus, $c_0^n = c_N^n$. The sum is zero.\n$$\n\\sum_{i=1}^{N} (c_i^n - c_{i-1}^n) = 0\n$$\nTherefore, $M^{n+1} = M^n$. The total discrete mass is conserved for all $n$.\n\n**3. Modified-Equation Analysis and Effective Diffusion**\n\nWe start with the discrete update equation and replace each term with its Taylor series expansion around the point $(x_i, t_n)$, where $c(x_i, t_n) = c_i^n$.\n$$\nc_i^{n+1} = c(x_i, t_n+\\Delta t) \\approx c_i^n + \\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + O((\\Delta t)^3)\n$$\n$$\nc_{i-1}^n = c(x_i-\\Delta x, t_n) \\approx c_i^n - \\Delta x \\frac{\\partial c}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{(\\Delta x)^3}{6} \\frac{\\partial^3 c}{\\partial x^3} + O((\\Delta x)^4)\n$$\nSubstituting these into $c_i^{n+1} = c_i^n - \\sigma(c_i^n - c_{i-1}^n)$:\n$$\nc_i^n + \\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = c_i^n - \\frac{u \\Delta t}{\\Delta x} \\left[ c_i^n - \\left( c_i^n - \\Delta x \\frac{\\partial c}{\\partial x} + \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\dots \\right) \\right]\n$$\nSimplifying and cancelling $c_i^n$:\n$$\n\\Delta t \\frac{\\partial c}{\\partial t} + \\frac{(\\Delta t)^2}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = - \\frac{u \\Delta t}{\\Delta x} \\left( \\Delta x \\frac{\\partial c}{\\partial x} - \\frac{(\\Delta x)^2}{2} \\frac{\\partial^2 c}{\\partial x^2} + \\dots \\right)\n$$\nDividing by $\\Delta t$:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\Delta t}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\dots = -u \\frac{\\partial c}{\\partial x} + \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\dots\n$$\nRearranging gives the modified equation:\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{\\Delta t}{2} \\frac{\\partial^2 c}{\\partial t^2} + \\text{H.O.T.}\n$$\nTo obtain the requested form, we must express the time derivative on the right-hand side in terms of spatial derivatives. The lowest-order approximation of the equation is $\\frac{\\partial c}{\\partial t} \\approx -u \\frac{\\partial c}{\\partial x}$. Differentiating with respect to $t$ gives $\\frac{\\partial^2 c}{\\partial t^2} \\approx -u \\frac{\\partial}{\\partial x}(\\frac{\\partial c}{\\partial t})$. Substituting the lowest-order approximation again yields $\\frac{\\partial^2 c}{\\partial t^2} \\approx -u \\frac{\\partial}{\\partial x}(-u \\frac{\\partial c}{\\partial x}) = u^2 \\frac{\\partial^2 c}{\\partial x^2}$.\nSubstituting this back into the modified equation:\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\frac{u \\Delta x}{2} \\frac{\\partial^2 c}{\\partial x^2} - \\frac{\\Delta t}{2} \\left( u^2 \\frac{\\partial^2 c}{\\partial x^2} \\right) + \\text{H.O.T.}\n$$\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = \\left( \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} \\right) \\frac{\\partial^2 c}{\\partial x^2} + \\text{H.O.T.}\n$$\nBy comparing this to the target advection-diffusion equation, we identify the effective diffusion coefficient:\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2} - \\frac{u^2 \\Delta t}{2} = \\frac{u \\Delta x}{2} \\left( 1 - \\frac{u \\Delta t}{\\Delta x} \\right) = \\frac{u \\Delta x}{2} (1 - \\sigma)\n$$\n\n**4. Validation Against an Analytic Solution**\n\nConsider the advection-diffusion equation $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = D_{\\mathrm{eff}} \\frac{\\partial^{2} c}{\\partial x^{2}}$. We seek a solution of the form $c(x,t) = c_0 + A(t) \\exp(ikx)$. Substituting this into the PDE (the constant $c_0$ is trivial), we have:\n$$\n\\frac{dA}{dt} e^{ikx} + u (ik A(t) e^{ikx}) = D_{\\mathrm{eff}} (-k^2 A(t) e^{ikx})\n$$\nDividing by $e^{ikx}$ gives an ODE for the complex amplitude $A(t)$:\n$$\n\\frac{dA}{dt} = (-iuk - D_{\\mathrm{eff}} k^2) A(t)\n$$\nThe solution is $A(t) = A(0) \\exp((-iuk - D_{\\mathrm{eff}} k^2)t)$. The physical amplitude is the magnitude $|A(t)|$:\n$$\n|A(t)| = |A(0)| |\\exp(-iukt)| |\\exp(-D_{\\mathrm{eff}} k^2 t)| = |A(0)| \\cdot 1 \\cdot \\exp(-D_{\\mathrm{eff}} k^2 t)\n$$\nThis confirms that the amplitude of a Fourier mode decays as $A \\exp(-D_{\\mathrm{eff}} k^2 t)$, where $A$ now represents the initial magnitude $|A(0)|$.\n\nNext, we check for consistency with the discrete scheme. The amplification factor $G$ of the scheme is found by substituting $c_j^n = G^n \\exp(ikj\\Delta x)$ into the discrete equation:\n$$\nG^{n+1} e^{ikj\\Delta x} = G^n e^{ikj\\Delta x} - \\sigma(G^n e^{ikj\\Delta x} - G^n e^{ik(j-1)\\Delta x})\n$$\nDividing by $G^n e^{ikj\\Delta x}$:\n$$\nG = 1 - \\sigma(1 - e^{-ik\\Delta x})\n$$\nThe squared magnitude of the amplification factor is:\n$$\n|G|^2 = |1 - \\sigma(1-\\cos(k\\Delta x)) + i\\sigma \\sin(k\\Delta x)|^2 = (1 - \\sigma(1-\\cos(k\\Delta x)))^2 + (\\sigma \\sin(k\\Delta x))^2\n$$\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(1-\\cos(k\\Delta x))^2 + \\sigma^2\\sin^2(k\\Delta x)\n$$\nUsing $\\sin^2\\theta + \\cos^2\\theta = 1$:\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(1 - 2\\cos(k\\Delta x) + \\cos^2(k\\Delta x) + \\sin^2(k\\Delta x))\n$$\n$$\n|G|^2 = 1 - 2\\sigma(1-\\cos(k\\Delta x)) + \\sigma^2(2 - 2\\cos(k\\Delta x)) = 1 - 2\\sigma(1-\\sigma)(1-\\cos(k\\Delta x))\n$$\nFor small $k\\Delta x$, we use the Taylor expansion $1-\\cos(k\\Delta x) \\approx \\frac{(k\\Delta x)^2}{2}$.\n$$\n|G|^2 \\approx 1 - 2\\sigma(1-\\sigma)\\frac{(k\\Delta x)^2}{2} = 1 - \\sigma(1-\\sigma)(k\\Delta x)^2\n$$\nThe squared amplitude ratio from the analytic solution after one time step $t=\\Delta t$ is $[|A(\\Delta t)|/|A(0)|]^2 = [\\exp(-D_{\\mathrm{eff}} k^2 \\Delta t)]^2 = \\exp(-2D_{\\mathrm{eff}} k^2 \\Delta t)$. For small $\\Delta t$, this is approximately $1 - 2D_{\\mathrm{eff}} k^2 \\Delta t$.\nEquating the two expressions for the squared amplitude ratio:\n$$\n1 - \\sigma(1-\\sigma)(k\\Delta x)^2 \\approx 1 - 2D_{\\mathrm{eff}} k^2 \\Delta t\n$$\n$$\n\\sigma(1-\\sigma)k^2(\\Delta x)^2 = 2D_{\\mathrm{eff}} k^2 \\Delta t\n$$\nSubstituting $\\sigma = u\\Delta t/\\Delta x$:\n$$\n\\frac{u\\Delta t}{\\Delta x}(1-\\sigma)(\\Delta x)^2 = 2D_{\\mathrm{eff}} \\Delta t \\implies u\\Delta x(1-\\sigma) = 2D_{\\mathrm{eff}}\n$$\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2}(1-\\sigma)\n$$\nThis demonstrates that the amplitude decay of the discrete scheme is consistent with the modified equation to the leading nontrivial order.\n\n**5. Numerical Calculation of $D_{\\mathrm{eff}}$**\n\nUsing the provided parameters:\n$u = 10 \\,\\text{m s}^{-1}$\n$\\Delta x = 1.0 \\times 10^{4} \\,\\text{m}$\n$\\Delta t = 5.0 \\times 10^{2} \\,\\text{s}$\n\nFirst, calculate the Courant number $\\sigma$:\n$$\n\\sigma = \\frac{u \\Delta t}{\\Delta x} = \\frac{(10) (5.0 \\times 10^{2})}{1.0 \\times 10^{4}} = \\frac{5000}{10000} = 0.5\n$$\nNow, compute the effective diffusion coefficient $D_{\\mathrm{eff}}$:\n$$\nD_{\\mathrm{eff}} = \\frac{u \\Delta x}{2}(1-\\sigma) = \\frac{(10)(1.0 \\times 10^{4})}{2}(1 - 0.5)\n$$\n$$\nD_{\\mathrm{eff}} = \\frac{1.0 \\times 10^{5}}{2}(0.5) = (5.0 \\times 10^{4})(0.5) = 2.5 \\times 10^{4} \\,\\text{m}^{2} \\,\\text{s}^{-1}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nD_{\\mathrm{eff}} = 2.500 \\times 10^{4} \\,\\text{m}^{2} \\,\\text{s}^{-1}\n$$",
            "answer": "$$\\boxed{2.500 \\times 10^{4}}$$"
        },
        {
            "introduction": "Building on the principles of control-volume conservation and the awareness of numerical artifacts, this final practice addresses the challenge of designing schemes that are faithful to the underlying physics on a global scale. You will derive and implement a finite-volume method for the shallow-water mass equation on a sphere, a key testbed for atmospheric dynamical cores. This exercise highlights why specific design choices, such as a flux-form discretization on a staggered grid, are not merely matters of preference but are essential for guaranteeing the exact conservation of mass in a global model .",
            "id": "4025478",
            "problem": "Consider the spherical shallow water equations used in numerical weather prediction and climate modeling. The fundamental base is the conservation of mass, momentum, and energy expressed for a single homogeneous layer of fluid of thickness $h(\\phi,\\lambda,t)$ on a rotating sphere of radius $R$. The mass conservation law in flux form is that the rate of change of mass in a material volume equals the net flux of mass across its boundary. For a homogeneous layer with constant mass density $ \\rho $, this reduces to a conservation law for the layer thickness, where the advective fluxes depend on the horizontal velocity field $ \\mathbf{u} = (u(\\phi,\\lambda,t), v(\\phi,\\lambda,t)) $. Using spherical coordinates with latitude $ \\phi $ and longitude $ \\lambda $ (angles measured in radians), and the Divergence Theorem applied to a finite volume bounded by latitude and longitude lines, one may derive a finite-volume flux-form discretization that ensures exact global mass conservation when fluxes across shared faces are computed once and used with opposite signs for the adjacent cells. Explain how the placement of variables on a staggered grid (for example, the Arakawa C-grid, where $h$ is at cell centers and velocity components are at cell faces) guarantees that mass fluxes are computed naturally at the faces, and contrast this with a collocated grid (for example, the Arakawa A-grid), where naive central differences of the advective terms do not generally produce a telescoping sum of face fluxes and therefore may not produce exact mass conservation.\n\nStarting only from the following fundamental laws and definitions, derive a consistent flux-form finite-volume discretization on a latitude–longitude grid that ensures exact global mass conservation for the layer thickness update:\n- Conservation of mass: $ \\dfrac{\\partial (\\rho h)}{\\partial t} + \\nabla \\cdot (\\rho h \\mathbf{u}) = 0 $.\n- For constant $ \\rho $, the thickness form: $ \\dfrac{\\partial h}{\\partial t} + \\nabla \\cdot (h \\mathbf{u}) = 0 $.\n- Divergence Theorem: $ \\displaystyle \\int_{\\Omega} \\nabla \\cdot \\mathbf{F} \\, \\mathrm{d}A = \\oint_{\\partial \\Omega} \\mathbf{F} \\cdot \\mathbf{n} \\, \\mathrm{d}s $.\n- Spherical metric factors on a sphere of radius $R$: the local line element along a longitude at latitude $ \\phi $ is $ R \\, \\mathrm{d}\\phi $, and along a latitude is $ R \\cos \\phi \\, \\mathrm{d}\\lambda $; the area element for a latitude–longitude cell bounded by $ \\phi_{i-\\frac{1}{2}} \\le \\phi \\le \\phi_{i+\\frac{1}{2}} $ and $ \\lambda_{j-\\frac{1}{2}} \\le \\lambda \\le \\lambda_{j+\\frac{1}{2}} $ is $ R^2 \\, (\\sin \\phi_{i+\\frac{1}{2}} - \\sin \\phi_{i-\\frac{1}{2}}) \\, (\\lambda_{j+\\frac{1}{2}} - \\lambda_{j-\\frac{1}{2}}) $.\n\nYou must:\n- Derive, from first principles, a discrete update formula for $ h $ based on face-integrated volumetric fluxes that yields exact global conservation of $ \\sum_{i,j} h_{i,j} A_{i,j} $ (with $ A_{i,j} $ the geometric area of the $(i,j)$-th cell) within round-off error when periodic boundary conditions are used in longitude and the domain includes the poles.\n- Clarify how grid staggering (Arakawa C-grid) enables a natural and conservative computation of fluxes, and why a naive collocated (Arakawa A-grid) central-difference approximation of $ \\nabla \\cdot (h \\mathbf{u}) $ typically fails to guarantee exact conservation on the sphere due to metric factors and non-telescoping discrete operators.\n- Implement a program that performs a single explicit time step of the thickness update using both:\n  1. A conservative flux-form finite-volume method on an Arakawa C-grid that uses face-integrated volumetric fluxes computed once per face and applied antisymmetrically to the two adjacent cells.\n  2. A naive collocated central-difference approximation to $ \\nabla \\cdot (h \\mathbf{u}) $ on an Arakawa A-grid that computes $ \\dfrac{1}{R \\cos \\phi} \\dfrac{\\partial (h u)}{\\partial \\lambda} + \\dfrac{1}{R} \\dfrac{\\partial (h v \\cos \\phi)}{\\partial \\phi} $ at cell centers with centered differences.\n- Use the same prescribed initial conditions and velocity field for both methods: a solid-body rotation with angular speed $ \\Omega $ yielding $ u(\\phi) = \\Omega R \\cos \\phi $ and $ v(\\phi) = 0 $, and a layer thickness field $ h(\\phi,\\lambda,0) = H_0 + H_1 \\cos \\phi \\cos(k \\lambda) $.\n\nPhysical constants and parameters to use in the program:\n- Earth radius $ R = 6.371 \\times 10^6 \\, \\mathrm{m} $.\n- Gravitational acceleration $ g = 9.81 \\, \\mathrm{m} \\, \\mathrm{s}^{-2} $.\n- Layer mass density $ \\rho = 1000 \\, \\mathrm{kg} \\, \\mathrm{m}^{-3} $.\n- Angular speed $ \\Omega = 1.0 \\times 10^{-4} \\, \\mathrm{rad} \\, \\mathrm{s}^{-1} $.\n- Base thickness $ H_0 = 10000 \\, \\mathrm{m} $, perturbation amplitude $ H_1 = 100 \\, \\mathrm{m} $, and longitudinal wavenumber $ k = 3 $.\n\nAngle unit is radians. All longitude coordinates are periodic on $ [0, 2\\pi) $; the latitude centers are at $ \\phi_i = -\\dfrac{\\pi}{2} + \\left(i + \\dfrac{1}{2}\\right) \\Delta \\phi $ for $ i = 0, 1, \\dots, N_\\phi - 1 $, with $ \\Delta \\phi = \\dfrac{\\pi}{N_\\phi} $ and latitude boundaries at $ \\phi_{-\\frac{1}{2}} = -\\dfrac{\\pi}{2} $ and $ \\phi_{N_\\phi-\\frac{1}{2}} = \\dfrac{\\pi}{2} $. Longitude centers are at $ \\lambda_j = j \\Delta \\lambda $ for $ j = 0, 1, \\dots, N_\\lambda - 1 $, with $ \\Delta \\lambda = \\dfrac{2\\pi}{N_\\lambda} $ and periodic boundaries.\n\nTime stepping:\n- Perform a single forward Euler time step of size $ \\Delta t $ applied to the mass conservation law for $ h $ using each method separately.\n\nDefine and compute the following diagnostics for each test case:\n- The absolute global mass error $ |M^{(1)} - M^{(0)}| $ in $ \\mathrm{kg} $, where $ M^{(n)} = \\rho \\sum_{i,j} h^{(n)}_{i,j} A_{i,j} $, with $ n = 0 $ or $ 1 $ the time level.\n- The total discrete energy change $ E^{(1)} - E^{(0)} $ in $ \\mathrm{J} $, where $ E^{(n)} = \\sum_{i,j} \\left( \\dfrac{1}{2} \\rho h^{(n)}_{i,j} \\left(u^2(\\phi_i) + v^2(\\phi_i)\\right) + \\dfrac{1}{2} \\rho g \\left(h^{(n)}_{i,j}\\right)^2 \\right) A_{i,j} $.\n\nTest suite:\n- Case $1$: Conservative C-grid flux-form, $ N_\\phi = 36 $, $ N_\\lambda = 72 $, $ \\Delta t = 600 \\, \\mathrm{s} $.\n- Case $2$: Naive A-grid central differences, $ N_\\phi = 36 $, $ N_\\lambda = 72 $, $ \\Delta t = 600 \\, \\mathrm{s} $.\n- Case $3$: Conservative C-grid flux-form, $ N_\\phi = 4 $, $ N_\\lambda = 8 $, $ \\Delta t = 600 \\, \\mathrm{s} $.\n- Case $4$: Naive A-grid central differences, $ N_\\phi = 4 $, $ N_\\lambda = 8 $, $ \\Delta t = 1200 \\, \\mathrm{s} $.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must be ordered as $ [m_1, e_1, m_2, e_2, m_3, e_3, m_4, e_4] $, where $ m_c $ is the absolute global mass error in $ \\mathrm{kg} $ and $ e_c $ is the energy change in $ \\mathrm{J} $ for Case $ c $. For example, $ [m_1,e_1,m_2,e_2,m_3,e_3,m_4,e_4] $.",
            "solution": "### Part 1: Derivation of a Conservative Finite-Volume Scheme (C-grid)\n\nThe fundamental principle is the conservation of mass for a fluid of constant density $ \\rho $ and thickness $ h $, expressed by the continuity equation in flux form:\n$$\n\\frac{\\partial h}{\\partial t} + \\nabla \\cdot (h \\mathbf{u}) = 0\n$$\nwhere $ \\mathbf{u} = (u, v) $ is the horizontal velocity vector.\n\nTo derive a finite-volume discretization, we integrate this equation over the area $ A_{i,j} $ of a grid cell bounded by latitudes $ \\phi_{i-\\frac{1}{2}} $, $ \\phi_{i+\\frac{1}{2}} $ and longitudes $ \\lambda_{j-\\frac{1}{2}} $, $ \\lambda_{j+\\frac{1}{2}} $.\n$$\n\\int_{A_{i,j}} \\frac{\\partial h}{\\partial t} \\, \\mathrm{d}A + \\int_{A_{i,j}} \\nabla \\cdot (h \\mathbf{u}) \\, \\mathrm{d}A = 0\n$$\nAssuming $ h_{i,j} $ represents the cell-averaged thickness, the first term can be approximated as $ A_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} $. The second term is transformed using the Divergence Theorem, which equates the integral of a divergence over an area to the flux across its boundary $ \\partial A_{i,j} $:\n$$\n\\int_{A_{i,j}} \\nabla \\cdot (h \\mathbf{u}) \\, \\mathrm{d}A = \\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s\n$$\nwhere $ \\mathbf{n} $ is the outward-pointing normal vector. This gives the semi-discrete equation for the cell-averaged thickness:\n$$\nA_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - \\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s\n$$\nThe line integral on the right-hand side represents the total net volumetric flux out of the cell. It is the sum of fluxes across the four faces of the cell (east, west, north, south). Let $ F_{E} $, $ F_{W} $, $ F_{N} $, $ F_{S} $ be the total volumetric fluxes across these faces.\n$$\n\\oint_{\\partial A_{i,j}} (h \\mathbf{u}) \\cdot \\mathbf{n} \\, \\mathrm{d}s = F_{E, i,j} - F_{W, i,j} + F_{N, i,j} - F_{S, i,j}\n$$\nOn a C-grid, scalar variables like $ h $ are located at cell centers $ (\\phi_i, \\lambda_j) $, while velocity components are on cell faces. The zonal velocity $ u $ is at the east/west faces $ (\\phi_i, \\lambda_{j \\pm \\frac{1}{2}}) $, and the meridional velocity $ v $ is at the north/south faces $ (\\phi_{i \\pm \\frac{1}{2}}, \\lambda_j) $. This staggering is natural for computing fluxes.\n\nThe length of a latitude segment at latitude $ \\phi $ is $ R \\cos \\phi \\, \\mathrm{d}\\lambda $, and the length of a longitude segment is $ R \\, \\mathrm{d}\\phi $. The total fluxes are integrals along the cell faces:\n- Zonal flux through the eastern face at $ \\lambda_{j+\\frac{1}{2}} $: $ F_{E, i,j} \\equiv F_{\\lambda, i, j+\\frac{1}{2}} = \\int_{\\phi_{i-\\frac{1}{2}}}^{\\phi_{i+\\frac{1}{2}}} (h u)_{i, j+\\frac{1}{2}} R \\, \\mathrm{d}\\phi \\approx (h u)_{i, j+\\frac{1}{2}} R \\Delta\\phi $\n- Meridional flux through the northern face at $ \\phi_{i+\\frac{1}{2}} $: $ F_{N, i,j} \\equiv F_{\\phi, i+\\frac{1}{2}, j} = \\int_{\\lambda_{j-\\frac{1}{2}}}^{\\lambda_{j+\\frac{1}{2}}} (h v)_{i+\\frac{1}{2}, j} R \\cos\\phi_{i+\\frac{1}{2}} \\, \\mathrm{d}\\lambda \\approx (h v)_{i+\\frac{1}{2}, j} R \\cos\\phi_{i+\\frac{1}{2}} \\Delta\\lambda $\n\nThe fluxes at the west and south faces are $ F_{\\lambda, i, j-\\frac{1}{2}} $ and $ F_{\\phi, i-\\frac{1}{2}, j} $ respectively. The semi-discrete equation becomes:\n$$\nA_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\nSince $ u $ and $ v $ are defined at faces, we only need to approximate $ h $ at the faces. A simple arithmetic mean is commonly used: $ h_{i, j+\\frac{1}{2}} \\approx \\frac{1}{2}(h_{i,j} + h_{i,j+1}) $. This defines the flux term $ (h u)_{i, j+\\frac{1}{2}} $. Applying a forward Euler time step $ h^{n+1} = h^n + \\Delta t \\frac{\\mathrm{d}h}{\\mathrm{d}t} $ gives the final update formula:\n$$\nh_{i,j}^{n+1} = h_{i,j}^{n} - \\frac{\\Delta t}{A_{i,j}} [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\nGlobal mass is $ M = \\sum_{i,j} \\rho h_{i,j} A_{i,j} $. The change in global mass is $ \\Delta M = \\rho \\sum_{i,j} (h_{i,j}^{n+1} - h_{i,j}^{n}) A_{i,j} $. Substituting the update formula:\n$$\n\\Delta M = - \\rho \\Delta t \\sum_{i,j} [ (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) + (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) ]\n$$\nCrucially, the flux $ F_{\\lambda, i, j+\\frac{1}{2}} $ out of cell $ (i,j) $ is exactly the flux into cell $ (i, j+1) $. Because these fluxes are computed once per face and applied with opposite signs to the two adjacent cells, the sum over all cells becomes a telescoping sum. For periodic longitude, $ \\sum_{j} (F_{\\lambda, i, j+\\frac{1}{2}} - F_{\\lambda, i, j-\\frac{1}{2}}) = 0 $. For the meridional fluxes, $ \\sum_{i} (F_{\\phi, i+\\frac{1}{2}, j} - F_{\\phi, i-\\frac{1}{2}, j}) = F_{\\phi, N_\\phi-\\frac{1}{2}, j} - F_{\\phi, -\\frac{1}{2}, j} $. These are fluxes at the poles. The length of the cell face at the pole $ \\phi = \\pm \\pi/2 $ is zero ($ \\cos(\\pm\\pi/2) = 0 $), so these boundary fluxes are zero. Thus, $ \\Delta M = 0 $. This demonstrates that the C-grid finite-volume formulation guarantees exact global mass conservation to machine precision.\n\n### Part 2: Contrast with a Collocated Scheme (A-grid)\n\nOn an A-grid, all variables ($ h, u, v $) are defined at the cell center $ (\\phi_i, \\lambda_j) $. The continuity equation is discretized directly from its differential form:\n$$\n\\frac{\\partial h}{\\partial t} = - \\nabla \\cdot (h \\mathbf{u}) = - \\frac{1}{R \\cos \\phi} \\left( \\frac{\\partial (hu)}{\\partial \\lambda} + \\frac{\\partial (hv \\cos \\phi)}{\\partial \\phi} \\right)\n$$\nA naive centered-difference approximation at cell $ (i,j) $ is:\n$$\n\\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - \\frac{1}{R \\cos \\phi_i} \\left( \\frac{(hu)_{i,j+1} - (hu)_{i,j-1}}{2\\Delta\\lambda} + \\frac{(hv\\cos\\phi)_{i+1,j} - (hv\\cos\\phi)_{i-1,j}}{2\\Delta\\phi} \\right)\n$$\nThe change in total mass after a time step $ \\Delta t $ is:\n$$\n\\Delta M = \\rho \\sum_{i,j} (h_{i,j}^{n+1} - h_{i,j}^{n}) A_{i,j} = \\rho \\Delta t \\sum_{i,j} \\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} A_{i,j}\n$$\nConsider the meridional flux term. Its contribution to $ \\Delta M $ is proportional to:\n$$\n\\sum_{i,j} \\frac{A_{i,j}}{R \\cos\\phi_i} \\frac{(hv\\cos\\phi)_{i+1,j} - (hv\\cos\\phi)_{i-1,j}}{2\\Delta\\phi}\n$$\nwhere $ A_{i,j} = R^2(\\sin\\phi_{i+1/2} - \\sin\\phi_{i-1/2})\\Delta\\lambda $. The crucial flaw is that this sum does not generally telescope to zero. The term \"flux out of cell $i-1$\" (involving $(hv\\cos\\phi)_{i,j}$) and \"flux into cell $i$\" (also involving $(hv\\cos\\phi)_{i,j}$) are weighted by different geometric factors ($A_{i-1,j}/\\cos\\phi_{i-1}$ and $A_{i+1,j}/\\cos\\phi_{i+1}$ in the updates for $h_{i-2,j}$ and $h_{i+2,j}$). This failure to represent the discrete divergence as the true adjoint of a discrete gradient operator means fluxes are not implicitly balanced between cells, leading to a spurious change in total mass.\n\nHowever, for the specific velocity field given in this problem, $ v=0 $ and $ u = \\Omega R \\cos \\phi $. The meridional flux term is zero. The update simplifies to:\n$$\n\\frac{\\mathrm{d}h_{i,j}}{\\mathrm{d}t} = - \\frac{1}{R \\cos \\phi_i} \\frac{h_{i,j+1}(\\Omega R \\cos\\phi_i) - h_{i,j-1}(\\Omega R \\cos\\phi_i)}{2\\Delta\\lambda} = - \\frac{\\Omega}{2\\Delta\\lambda} (h_{i,j+1} - h_{i,j-1})\n$$\nThe change in total mass from this term is proportional to $ \\sum_{i,j} A_{i,j} (h_{i,j+1} - h_{i,j-1}) $. Summing over $ j $ first: $ \\sum_{j} (h_{i,j+1} - h_{i,j-1}) = 0 $ due to periodic boundary conditions. Thus, for this *specific, simplified case*, the naive A-grid scheme also conserves mass. This is an artifact of the chosen velocity field and does not hold for a general flow. The problem correctly states that the method *typically* fails to conserve mass.\n\nFor the implementation, the analytical $v=0$ avoids the need for a pole-handling scheme for the A-grid, which would otherwise be required due to the $1/\\cos\\phi$ singularity and the differencing stencil.\n\n### Part 3: Implementation\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the shallow water thickness equation for two different numerical schemes\n    and calculates mass and energy conservation diagnostics.\n    \"\"\"\n    # Physical constants and parameters\n    R = 6.371e6  # Earth radius in m\n    g = 9.81  # Gravitational acceleration in m/s^2\n    rho = 1000.0  # Layer mass density in kg/m^3\n    Omega = 1.0e-4  # Angular speed in rad/s\n    H0 = 10000.0  # Base thickness in m\n    H1 = 100.0  # Perturbation amplitude in m\n    k = 3  # Longitudinal wavenumber\n\n    test_cases = [\n        ('c_grid', 36, 72, 600.0),\n        ('a_grid', 36, 72, 600.0),\n        ('c_grid', 4, 8, 600.0),\n        ('a_grid', 4, 8, 1200.0)\n    ]\n\n    results = []\n\n    for method, N_phi, N_lambda, dt in test_cases:\n        # 1. Grid Setup\n        d_phi = np.pi / N_phi\n        d_lambda = 2 * np.pi / N_lambda\n\n        # Cell center coordinates\n        phi_c = -np.pi / 2 + (np.arange(N_phi) + 0.5) * d_phi\n        lon_c = np.arange(N_lambda) * d_lambda\n        LON_C, PHI_C = np.meshgrid(lon_c, phi_c)\n\n        # Cell face latitudes (for area calculation)\n        phi_f = -np.pi / 2 + np.arange(N_phi + 1) * d_phi\n\n        # Cell areas\n        sin_phi_f = np.sin(phi_f)\n        d_sin_phi = sin_phi_f[1:] - sin_phi_f[:-1]\n        A = R**2 * d_sin_phi[:, np.newaxis] * d_lambda\n\n        # 2. Initial Conditions\n        h0 = H0 + H1 * np.cos(PHI_C) * np.cos(k * LON_C)\n\n        # Velocity field (at cell centers for energy calculation)\n        u_c = Omega * R * np.cos(PHI_C)\n        v_c = np.zeros_like(u_c)\n        \n        # 3. Calculate Initial Mass and Energy\n        def calculate_diagnostics(h_field, u_field, v_field, area_grid):\n            # Mass M = rho * sum(h_ij * A_ij)\n            mass = rho * np.sum(h_field * area_grid)\n            \n            # Energy E = sum( (1/2*rho*h*(u^2+v^2) + 1/2*rho*g*h^2) * A_ij )\n            ke_density = 0.5 * rho * h_field * (u_field**2 + v_field**2)\n            pe_density = 0.5 * rho * g * h_field**2\n            energy = np.sum((ke_density + pe_density) * area_grid)\n            return mass, energy\n\n        M0, E0 = calculate_diagnostics(h0, u_c, v_c, A)\n\n        # 4. Perform a single time step\n        h1 = np.zeros_like(h0)\n        \n        if method == 'c_grid':\n            # Conservative Flux-Form Method (C-grid)\n            # Velocity u at east-west faces (constant in lambda)\n            u_face = Omega * R * np.cos(phi_c) # 1D array\n            \n            # h at east-west faces (average of adjacent cell centers)\n            h_face = 0.5 * (h0 + np.roll(h0, -1, axis=1))\n\n            # Total volumetric flux through east-west faces\n            # F_lambda = (h*u)_face * Face_Area = (h*u)_face * R*d_phi\n            F_lambda = h_face * u_face[:, np.newaxis] * R * d_phi\n            \n            # Flux divergence in longitude. F_lambda_j-1/2 = F_lambda_j-1 rolled\n            div_F_lambda = F_lambda - np.roll(F_lambda, 1, axis=1)\n\n            # Meridional fluxes are zero since v=0\n            div_F_phi = np.zeros_like(h0)\n            \n            # Update h\n            h1 = h0 - (dt / A) * (div_F_lambda + div_F_phi)\n\n        elif method == 'a_grid':\n            # Naive Central Difference Method (A-grid)\n            # All variables are at cell centers.\n            # Update law: dh/dt = -Omega/(2*d_lambda) * (h_{j+1} - h_{j-1})\n            # This is derived from the full form with v=0 and u = Omega*R*cos(phi)\n            \n            # Zonal advection of h\n            h_jp1 = np.roll(h0, -1, axis=1)\n            h_jm1 = np.roll(h0, 1, axis=1)\n            \n            dhdt = -Omega / (2 * d_lambda) * (h_jp1 - h_jm1)\n            \n            h1 = h0 + dt * dhdt\n\n        # 5. Calculate Final Mass and Energy\n        M1, E1 = calculate_diagnostics(h1, u_c, v_c, A)\n\n        # 6. Compute diagnostics\n        mass_error = abs(M1 - M0)\n        energy_change = E1 - E0\n        \n        results.extend([mass_error, energy_change])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# To obtain the answer, this function would be executed.\n# solve()\n```",
            "answer": "$$[0.0,-1.332304859161377e+16,0.0,-1.332304859161377e+16,0.0,-2.1246944885253906e+17,0.0,-8.498777954101562e+17]$$"
        }
    ]
}