{
    "hands_on_practices": [
        {
            "introduction": "Understanding the Brunt-Väisälä frequency begins with its physical manifestation as the natural frequency of oscillation for a parcel of air displaced vertically in a stable atmosphere. This fundamental exercise guides you through the derivation of the governing equation for this buoyancy oscillation, treating an idealized air parcel as a simple harmonic oscillator. By completing this practice , you will connect the abstract value of $N$ to concrete physical properties like the oscillation period and a parcel's maximum velocity, building a strong conceptual foundation.",
            "id": "4019099",
            "problem": "A neutrally buoyant instrumented balloon is used as a Lagrangian tracer in a stably stratified atmospheric layer represented by a one-dimensional vertical column of a Numerical Weather Prediction (NWP) model under the Boussinesq approximation. The base state is hydrostatic and horizontally homogeneous, with a monotonically increasing base-state potential temperature profile. Consider small-amplitude, adiabatic vertical motions of the balloon relative to its equilibrium level, and neglect viscous and radiative effects.\n\nStarting from the vertical momentum equation for a Lagrangian parcel and the adiabatic thermodynamic relation connecting perturbation potential temperature to vertical displacement, derive the governing ordinary differential equation for the parcel’s vertical displacement as a function of time and identify the angular frequency of the resulting oscillation in terms of base-state quantities. You are told that the stratification is characterized by a Brunt–Väisälä frequency (BVF) $N$ with value $N = 0.01\\,\\mathrm{s^{-1}}$. The balloon is initially displaced upward from its equilibrium level by an amplitude $A = 100\\,\\mathrm{m}$ and released from rest to undergo free oscillation.\n\nCompute the oscillation period and estimate the maximum vertical velocity attained during the free oscillation. Express the period in $\\mathrm{s}$ and the maximum vertical velocity in $\\mathrm{m\\,s^{-1}}$. Round your two answers to four significant figures.",
            "solution": "The problem asks for the derivation of the governing equation for a vertically displaced parcel in a stably stratified atmosphere and the calculation of its oscillation period and maximum velocity.\n\nLet $z'$ be the vertical displacement of the neutrally buoyant balloon from its equilibrium level $z_0$. The vertical motion of the balloon, acting as a Lagrangian parcel, is governed by the vertical momentum equation. Under the Boussinesq approximation, the vertical acceleration of the parcel is driven by the buoyancy force, which arises from the density difference between the parcel and its surrounding environment. The equation of motion for small vertical displacement $z'$ is:\n$$\n\\frac{d^2 z'}{dt^2} = a_z = g \\frac{\\rho_e - \\rho_p}{\\rho_0}\n$$\nwhere $a_z$ is the vertical acceleration, $g$ is the acceleration due to gravity, $\\rho_p$ is the density of the parcel, $\\rho_e$ is the density of the environment at the parcel's height, and $\\rho_0$ is a constant reference density. The term $\\rho_e - \\rho_p$ represents the density anomaly.\n\nIt is more convenient to work with potential temperature, $\\theta$, which is conserved during adiabatic processes. The Boussinesq equation of state relates density perturbations to potential temperature perturbations:\n$$\n\\frac{\\rho'}{\\rho_0} = -\\frac{\\theta'}{\\theta_0}\n$$\nHere, the perturbation $\\rho' = \\rho_p - \\rho_e$ is the parcel's density relative to the environment, and $\\theta' = \\theta_p - \\theta_e$ is the parcel's potential temperature relative to the environment. Substituting $\\rho_p - \\rho_e$ into the acceleration equation:\n$$\n\\frac{d^2 z'}{dt^2} = g \\frac{-(\\rho_p - \\rho_e)}{\\rho_0} = -g \\frac{\\rho'}{\\rho_0}\n$$\nUsing the thermodynamic relation, this becomes:\n$$\n\\frac{d^2 z'}{dt^2} = -g \\left(-\\frac{\\theta'}{\\theta_0}\\right) = \\frac{g}{\\theta_0} \\theta'\n$$\nwhere $\\theta_0$ is a reference potential temperature.\n\nNext, we relate the potential temperature perturbation $\\theta'$ to the vertical displacement $z'$. The balloon's motion is adiabatic, so its potential temperature, $\\theta_p$, is conserved. The balloon starts at an equilibrium level $z_0$, so its potential temperature is equal to the environmental potential temperature at that level, $\\bar{\\theta}(z_0)$. Thus, $\\theta_p = \\bar{\\theta}(z_0)$.\n\nWhen the balloon is displaced to a new height $z_0 + z'$, its potential temperature remains $\\bar{\\theta}(z_0)$. The environmental potential temperature at this new height is $\\bar{\\theta}(z_0 + z')$. The potential temperature perturbation is the difference between the parcel's and the environment's potential temperature at this new level:\n$$\n\\theta' = \\theta_p - \\bar{\\theta}(z_0 + z') = \\bar{\\theta}(z_0) - \\bar{\\theta}(z_0 + z')\n$$\nFor a small displacement $z'$, we can use a first-order Taylor series expansion for the environmental potential temperature profile $\\bar{\\theta}(z)$ around $z_0$:\n$$\n\\bar{\\theta}(z_0 + z') \\approx \\bar{\\theta}(z_0) + z' \\frac{d\\bar{\\theta}}{dz}\\bigg|_{z_0}\n$$\nSubstituting this into the expression for $\\theta'$:\n$$\n\\theta' \\approx \\bar{\\theta}(z_0) - \\left(\\bar{\\theta}(z_0) + z' \\frac{d\\bar{\\theta}}{dz}\\bigg|_{z_0}\\right) = -z' \\frac{d\\bar{\\theta}}{dz}\n$$\nNow, we substitute this expression for $\\theta'$ back into the equation of motion:\n$$\n\\frac{d^2 z'}{dt^2} = \\frac{g}{\\theta_0} \\left(-z' \\frac{d\\bar{\\theta}}{dz}\\right) = -\\left(\\frac{g}{\\theta_0} \\frac{d\\bar{\\theta}}{dz}\\right) z'\n$$\nThis is the governing ordinary differential equation for the parcel's vertical displacement. It is the equation for a simple harmonic oscillator. We can rearrange it as:\n$$\n\\frac{d^2 z'}{dt^2} + \\left(\\frac{g}{\\theta_0} \\frac{d\\bar{\\theta}}{dz}\\right) z' = 0\n$$\nThe term in the parenthesis is the square of the angular frequency of the oscillation. This quantity is defined as the square of the Brunt–Väisälä frequency, $N$:\n$$\nN^2 \\equiv \\frac{g}{\\theta_0} \\frac{d\\bar{\\theta}}{dz}\n$$\nSince the problem states the atmosphere is stably stratified, the potential temperature increases with height, so $\\frac{d\\bar{\\theta}}{dz} > 0$, which ensures that $N^2 > 0$ and $N$ is a real frequency, leading to stable oscillations.\nThe governing ODE is thus:\n$$\n\\frac{d^2 z'}{dt^2} + N^2 z' = 0\n$$\nThe angular frequency of the oscillation is $N$, the Brunt–Väisälä frequency.\n\nThe general solution to this ODE is $z'(t) = C_1 \\cos(Nt) + C_2 \\sin(Nt)$, where $C_1$ and $C_2$ are constants determined by the initial conditions.\nThe given initial conditions are:\n1. Initial displacement: $z'(0) = A = 100\\,\\mathrm{m}$.\n2. Released from rest: The initial vertical velocity is $v'(0) = \\frac{dz'}{dt}\\bigg|_{t=0} = 0$.\n\nApplying the first condition to the general solution:\n$z'(0) = C_1 \\cos(0) + C_2 \\sin(0) = C_1 = A$. So, $C_1 = 100\\,\\mathrm{m}$.\n\nThe vertical velocity is the time derivative of the displacement:\n$v'(t) = \\frac{dz'}{dt} = -C_1 N \\sin(Nt) + C_2 N \\cos(Nt)$.\nApplying the second condition:\n$v'(0) = -A N \\sin(0) + C_2 N \\cos(0) = C_2 N = 0$.\nSince $N \\neq 0$, it follows that $C_2 = 0$.\n\nThe specific solution for the balloon's vertical displacement is:\n$$\nz'(t) = A \\cos(Nt)\n$$\nAnd its vertical velocity is:\n$$\nv'(t) = -A N \\sin(Nt)\n$$\n\nWe can now compute the required values. We are given $N = 0.01\\,\\mathrm{s^{-1}}$ and $A = 100\\,\\mathrm{m}$.\n\nFirst, we compute the oscillation period, $T$. The relationship between period and angular frequency $N$ is $T = \\frac{2\\pi}{N}$.\n$$\nT = \\frac{2\\pi}{0.01\\,\\mathrm{s^{-1}}} = 200\\pi\\,\\mathrm{s}\n$$\nNumerically, using $\\pi \\approx 3.14159265$:\n$$\nT \\approx 200 \\times 3.14159265\\,\\mathrm{s} \\approx 628.3185\\,\\mathrm{s}\n$$\nRounding to four significant figures, the period is $T = 628.3\\,\\mathrm{s}$.\n\nSecond, we compute the maximum vertical velocity, $v_{max}$. The velocity is given by $v'(t) = -A N \\sin(Nt)$. The magnitude of the velocity is $|v'(t)| = | -A N \\sin(Nt) | = A N |\\sin(Nt)|$. The maximum value of $|\\sin(Nt)|$ is $1$. Therefore, the maximum vertical velocity is:\n$$\nv_{max} = A N\n$$\nSubstituting the given values:\n$$\nv_{max} = (100\\,\\mathrm{m}) \\times (0.01\\,\\mathrm{s^{-1}}) = 1\\,\\mathrm{m\\,s^{-1}}\n$$\nExpressing this to four significant figures, we get $v_{max} = 1.000\\,\\mathrm{m\\,s^{-1}}$.\n\nThe oscillation period is $628.3\\,\\mathrm{s}$ and the maximum vertical velocity is $1.000\\,\\mathrm{m\\,s^{-1}}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 628.3  1.000 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "In the real atmosphere, moisture significantly influences air density and, consequently, static stability. This practice  moves from idealized theory to numerical application, tasking you with computing stability using both dry potential temperature, $\\theta$, and the more accurate virtual potential temperature, $\\theta_v$. By implementing and comparing these two metrics on realistic atmospheric soundings, you will gain hands-on experience in quantifying the critical role of moisture, a fundamental skill in modern weather and climate modeling.",
            "id": "4019084",
            "problem": "Consider a hydrostatic, horizontally homogeneous atmospheric column observed by a vertical sounding, intended for use in Numerical Weather Prediction (NWP) and climate modeling. The sounding provides discrete levels of pressure, temperature, and specific humidity. Your task is to derive, implement, and compare two measures of static stability: one based on dry potential temperature and one based on virtual potential temperature. From these, infer and contrast the column-mean Brunt-Väisälä frequency for a humid tropical sounding versus a dry computation that ignores moisture.\n\nStarting point and allowed fundamental base:\n- Hydrostatic balance: $\\,\\dfrac{\\partial p}{\\partial z} = -\\rho g\\,$ where $\\,p\\,$ is pressure, $\\,z\\,$ is height, $\\,\\rho\\,$ is density, and $\\,g\\,$ is the gravitational acceleration.\n- Ideal gas law for a moist mixture expressed via virtual temperature: $\\,p = \\rho R_d T_v\\,$, where $\\,R_d\\,$ is the specific gas constant for dry air and $\\,T_v\\,$ is virtual temperature defined such that the mixture obeys the dry-air gas constant.\n- Potential temperature for unsaturated adiabatic displacements: $\\,\\theta\\,$ defined by $\\,T = \\theta \\left(\\dfrac{p}{p_0}\\right)^{\\kappa}\\,$ with $\\,\\kappa = \\dfrac{R_d}{c_{p,d}}\\,$, $\\,T\\,$ temperature, $\\,p\\,$ pressure, $\\,p_0\\,$ a reference pressure, and $\\,c_{p,d}\\,$ the specific heat at constant pressure for dry air.\n- Virtual potential temperature $\\,\\theta_v\\,$ defined analogously using $\\,T_v\\,$.\n\nYou must:\n1. From the hydrostatic law and ideal gas law, derive the layer thickness between two adjacent pressure levels using the hypsometric relation in terms of layer-mean virtual temperature. Use this to compute the geometric height difference $\\,\\Delta z\\,$ for each adjacent pair of sounding levels.\n2. Starting from the definition of buoyancy for small adiabatic vertical displacements in a stably stratified atmosphere, derive the expression for the Brunt–Väisälä frequency in terms of the vertical gradient of potential temperature. Do this for both the dry potential temperature $\\,\\theta\\,$ and the virtual potential temperature $\\,\\theta_v\\,$, leading to layer-wise expressions that you implement numerically using finite differences over $\\,\\Delta z\\,$.\n3. Define a single representative “column-mean buoyancy frequency” $\\,N_{\\text{col}}\\,$ in $\\mathrm{s}^{-1}$ for each method (dry versus virtual) as the square root of the vertical-thickness-weighted mean of layer $\\,N^2\\,$ over the full set of layers in the sounding. If the thickness-weighted mean of $\\,N^2\\,$ is negative, report $\\,N_{\\text{col}} = 0\\,$ to avoid non-real values.\n4. Compute and report the difference $\\,\\Delta N = N_{\\text{col,virtual}} - N_{\\text{col,dry}}\\,$ in $\\mathrm{s}^{-1}$ for each test case.\n\nVirtual temperature and moisture specification:\n- Express virtual temperature $\\,T_v\\,$ exactly in terms of the specific humidity $\\,q\\,$ by converting to the mixing ratio $\\,r = \\dfrac{q}{1-q}\\,$ and using $\\,T_v = T \\,\\dfrac{1 + r/\\epsilon}{1 + r}\\,$ with $\\,\\epsilon = \\dfrac{R_d}{R_v}\\,$, where $\\,R_v\\,$ is the specific gas constant for water vapor. Assume no liquid water or ice is present (unsaturated conditions), so condensed water terms can be neglected.\n\nNumerical implementation requirements:\n- Use International System of Units (SI): $\\,p\\,$ in $\\mathrm{Pa}$, $\\,T\\,$ and $\\,T_v\\,$ in $\\mathrm{K}$, $\\,q\\,$ in $\\mathrm{kg/kg}$, $\\,z\\,$ in $\\mathrm{m}$, and $\\,N\\,$ in $\\mathrm{s}^{-1}$.\n- Constants: $\\,g = 9.80665\\,\\mathrm{m\\,s^{-2}}\\,$, $\\,R_d = 287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}\\,$, $\\,R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}\\,$, $\\,c_{p,d} = 1004\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}\\,$, $\\,p_0 = 10^5\\,\\mathrm{Pa}\\,$, and $\\,\\kappa = \\dfrac{R_d}{c_{p,d}}\\,$.\n- Discrete layers: For adjacent levels $\\,i\\,$ and $\\,i+1\\,$, approximate the hypsometric thickness using layer-mean $\\,T_v\\,$, and compute finite differences for $\\,\\theta\\,$ and $\\,\\theta_v\\,$ over $\\,\\Delta z\\,$. Use layer-mean $\\,\\theta\\,$ and $\\,\\theta_v\\,$ in the respective stability scalings.\n\nTest suite:\nProvide computations for the following three soundings, each defined by arrays of pressure $\\,p\\,$, temperature $\\,T\\,$, and specific humidity $\\,q\\,$:\n- Case A (humid tropical low levels):\n  - $\\,p = [100000,\\,95000,\\,90000,\\,85000]\\,\\mathrm{Pa}\\,$\n  - $\\,T = [300.0,\\,296.0,\\,292.5,\\,289.0]\\,\\mathrm{K}\\,$\n  - $\\,q = [0.0180,\\,0.0160,\\,0.0120,\\,0.0090]\\,\\mathrm{kg/kg}\\,$\n- Case B (dry midlatitude lower troposphere):\n  - $\\,p = [100000,\\,90000,\\,80000,\\,70000]\\,\\mathrm{Pa}\\,$\n  - $\\,T = [288.0,\\,281.0,\\,274.0,\\,267.0]\\,\\mathrm{K}\\,$\n  - $\\,q = [0.0020,\\,0.0015,\\,0.0010,\\,0.0008]\\,\\mathrm{kg/kg}\\,$\n- Case C (dry-neutral baseline with a humidity gradient):\n  - $\\,p = [100000,\\,95000,\\,90000]\\,\\mathrm{Pa}\\,$\n  - $\\,T = [300.0,\\,295.65,\\,291.00]\\,\\mathrm{K}\\,$\n  - $\\,q = [0.0100,\\,0.0080,\\,0.0060]\\,\\mathrm{kg/kg}\\,$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one sublist per test case. Each sublist must contain three floats in $\\mathrm{s}^{-1}$: $[N_{\\text{col,dry}}, N_{\\text{col,virtual}}, \\Delta N]$. All floats must be rounded to six decimal places. For example: $[[0.010000,0.011000,0.001000],[...],[...]]$.",
            "solution": "The solution proceeds in four stages as requested:\n1.  Derivation of the hypsometric equation for layer thickness.\n2.  Derivation of the Brunt-Väisälä frequency from the principles of buoyancy.\n3.  Definition of the column-mean frequency.\n4.  Application of these principles to the provided test cases.\n\n**1. Layer Thickness from the Hypsometric Equation**\n\nThe derivation starts from two fundamental principles provided: hydrostatic balance and the ideal gas law for moist air.\nThe hydrostatic balance equation is:\n$$\n\\frac{\\partial p}{\\partial z} = -\\rho g\n$$\nwhere $p$ is pressure, $z$ is geometric height, $\\rho$ is air density, and $g$ is the acceleration due to gravity.\n\nThe ideal gas law for moist air is expressed using the virtual temperature $T_v$:\n$$\np = \\rho R_d T_v\n$$\nwhere $R_d$ is the specific gas constant for dry air.\n\nBy substituting the expression for density $\\rho = \\frac{p}{R_d T_v}$ from the ideal gas law into the hydrostatic equation, we obtain:\n$$\n\\frac{\\partial p}{\\partial z} = -\\frac{p g}{R_d T_v}\n$$\nThis equation can be rearranged to express the differential change in height $dz$ in terms of the differential change in pressure $dp$:\n$$\ndz = -\\frac{R_d T_v}{g} \\frac{dp}{p}\n$$\nTo find the thickness $\\Delta z = z_2 - z_1$ of a layer between two pressure levels $p_1$ and $p_2$ (where $p_2  p_1$), we integrate this expression:\n$$\n\\Delta z = \\int_{z_1}^{z_2} dz = -\\frac{R_d}{g} \\int_{p_1}^{p_2} T_v d(\\ln p)\n$$\nFor numerical computation between discrete levels, we approximate the integral by assuming the virtual temperature is constant throughout the layer, equal to its mean value $\\overline{T_v}$:\n$$\n\\Delta z \\approx -\\frac{R_d}{g} \\overline{T_v} \\int_{p_1}^{p_2} d(\\ln p) = -\\frac{R_d}{g} \\overline{T_v} (\\ln p_2 - \\ln p_1)\n$$\nThis simplifies to the hypsometric equation for layer thickness:\n$$\n\\Delta z = \\frac{R_d \\overline{T_v}}{g} \\ln\\left(\\frac{p_1}{p_2}\\right)\n$$\nFor a layer between sounding levels $i$ and $i+1$, we use $\\overline{T_{v,i}} = \\frac{T_{v,i} + T_{v,i+1}}{2}$, and the layer thickness is $\\Delta z_i = \\frac{R_d \\overline{T_v}}{g} \\ln\\left(\\frac{p_i}{p_{i+1}}\\right)$.\n\n**2. Derivation of the Brunt-Väisälä Frequency ($N^2$)**\n\nThe Brunt-Väisälä frequency, $N$, quantifies the frequency of vertical oscillations a parcel of air undergoes when displaced adiabatically in a stably stratified environment. It is derived from the buoyancy force acting on the displaced parcel.\n\nConsider a parcel of air at equilibrium at height $z$ with density $\\rho(z)$ and temperature $T_v(z)$. If this parcel is displaced vertically by a small distance $\\delta z$ without mixing, it will experience a change in pressure to match the environment at height $z+\\delta z$, which is $p(z+\\delta z)$. However, its temperature and density will evolve adiabatically. The net vertical force per unit mass on the parcel is the buoyancy force:\n$$\nF_b = g \\frac{\\rho_{env}(z+\\delta z) - \\rho_{parcel}(z+\\delta z)}{\\rho_{parcel}(z+\\delta z)}\n$$\nFor small displacements, $\\rho_{parcel} \\approx \\rho_{env}$, so the restoring acceleration is:\n$$\n\\frac{d^2(\\delta z)}{dt^2} \\approx g \\frac{\\rho_{env} - \\rho_{parcel}}{\\rho_{env}}\n$$\nUsing the ideal gas law $p = \\rho R_d T_v$, we can express the densities in terms of virtual temperature at the common pressure level $p(z+\\delta z)$. This gives $\\rho \\propto 1/T_v$. The acceleration becomes:\n$$\n\\frac{d^2(\\delta z)}{dt^2} = g \\frac{T_{v,parcel}(z+\\delta z) - T_{v,env}(z+\\delta z)}{T_{v,env}(z+\\delta z)}\n$$\nFor an adiabatic displacement, the parcel conserves its virtual potential temperature, $\\theta_v$. The virtual potential temperature is defined by $T_v = \\theta_v \\left(\\frac{p}{p_0}\\right)^{\\kappa}$, where $\\kappa = R_d/c_{p,d}$ and $p_0$ is a reference pressure. The parcel's virtual potential temperature at its new height is the same as it was at its original height, i.e., $\\theta_{v,parcel}(z+\\delta z) = \\theta_{v,env}(z)$. Consequently, its virtual temperature is $T_{v,parcel}(z+\\delta z) = \\theta_{v,env}(z) \\left(\\frac{p(z+\\delta z)}{p_0}\\right)^{\\kappa}$.\nThe environment's virtual temperature at the new height is $T_{v,env}(z+\\delta z) = \\theta_{v,env}(z+\\delta z) \\left(\\frac{p(z+\\delta z)}{p_0}\\right)^{\\kappa}$.\n\nSubstituting these into the acceleration equation and cancelling the pressure term:\n$$\n\\frac{d^2(\\delta z)}{dt^2} = g \\frac{\\theta_{v,env}(z) - \\theta_{v,env}(z+\\delta z)}{\\theta_{v,env}(z+\\delta z)}\n$$\nUsing a first-order Taylor series expansion for $\\theta_{v,env}(z+\\delta z) \\approx \\theta_{v,env}(z) + \\frac{d\\theta_{v,env}}{dz}\\delta z$, and approximating the denominator $\\theta_{v,env}(z+\\delta z) \\approx \\theta_{v,env}(z)$, we get:\n$$\n\\frac{d^2(\\delta z)}{dt^2} = - \\left( \\frac{g}{\\theta_{v,env}(z)} \\frac{d\\theta_{v,env}}{dz} \\right) \\delta z\n$$\nThis is the equation for a simple harmonic oscillator, $\\frac{d^2 x}{dt^2} = -\\omega^2 x$. The square of the angular frequency of oscillation, which is the Brunt-Väisälä frequency squared, is therefore:\n$$\nN_v^2 = \\frac{g}{\\theta_v} \\frac{d\\theta_v}{dz}\n$$\nThis is the expression for the \"virtual\" or \"moist\" case. The \"dry\" case is derived identically but assumes zero moisture, so $T_v \\to T$ and $\\theta_v \\to \\theta$:\n$$\nN_d^2 = \\frac{g}{\\theta} \\frac{d\\theta}{dz}\n$$\nFor numerical implementation across a layer of thickness $\\Delta z$, we use finite differences and layer-mean quantities, as specified:\n$$\nN_{v,i}^2 = \\frac{g}{\\overline{\\theta_{v,i}}} \\frac{\\theta_{v,i+1} - \\theta_{v,i}}{\\Delta z_i} \\quad \\text{and} \\quad N_{d,i}^2 = \\frac{g}{\\overline{\\theta_{i}}} \\frac{\\theta_{i+1} - \\theta_i}{\\Delta z_i}\n$$\nwhere $\\overline{\\theta_i} = \\frac{\\theta_i + \\theta_{i+1}}{2}$ and $\\overline{\\theta_{v,i}} = \\frac{\\theta_{v,i} + \\theta_{v,i+1}}{2}$.\n\n**3. Column-Mean Buoyancy Frequency**\n\nAs specified, the column-mean buoyancy frequency $N_{\\text{col}}$ is the square root of the vertical-thickness-weighted mean of the layer-wise $N^2$ values.\nThe weighted mean is:\n$$\n\\overline{N^2}_{\\text{col}} = \\frac{\\sum_{i=1}^{M-1} N_i^2 \\Delta z_i}{\\sum_{i=1}^{M-1} \\Delta z_i} = \\frac{\\sum_i N_i^2 \\Delta z_i}{\\Delta z_{total}}\n$$\nwhere $M$ is the number of levels in the sounding and the summation is over all $M-1$ layers.\nThe column frequency is then:\n$$\nN_{\\text{col}} = \\begin{cases} \\sqrt{\\overline{N^2}_{\\text{col}}}  \\text{if } \\overline{N^2}_{\\text{col}} \\geq 0 \\\\ 0  \\text{if } \\overline{N^2}_{\\text{col}}  0 \\end{cases}\n$$\nThis calculation is performed separately for the dry ($N_{\\text{col,dry}}$) and virtual ($N_{\\text{col,virtual}}$) cases. The final requested quantity is the difference $\\Delta N = N_{\\text{col,virtual}} - N_{\\text{col,dry}}$.\n\n**4. Computational Procedure Summary**\n\nFor each test case:\n1.  Define constants: $g=9.80665$, $R_d=287.05$, $R_v=461.5$, $c_{p,d}=1004$, $p_0=10^5$. Calculate $\\epsilon = R_d/R_v$ and $\\kappa=R_d/c_{p,d}$.\n2.  Input arrays for pressure ($p$), temperature ($T$), and specific humidity ($q$).\n3.  At each vertical level $j$:\n    -   Compute mixing ratio: $r_j = q_j / (1 - q_j)$.\n    -   Compute virtual temperature: $T_{v,j} = T_j (1 + r_j/\\epsilon) / (1 + r_j)$.\n    -   Compute potential temperature: $\\theta_j = T_j (p_0 / p_j)^\\kappa$.\n    -   Compute virtual potential temperature: $\\theta_{v,j} = T_{v,j} (p_0 / p_j)^\\kappa$.\n4.  For each layer $i$ between levels $i$ and $i+1$:\n    -   Compute layer-mean virtual temperature $\\overline{T_{v,i}} = (T_{v,i} + T_{v,i+1})/2$.\n    -   Compute layer thickness $\\Delta z_i = (R_d/g) \\overline{T_{v,i}} \\ln(p_i/p_{i+1})$.\n    -   Compute layer-mean potential temperatures $\\overline{\\theta_i}$ and $\\overline{\\theta_{v,i}}$.\n    -   Compute layer-wise $N_{d,i}^2$ and $N_{v,i}^2$ using the finite difference formulas.\n5.  Compute the thickness-weighted column means $\\overline{N^2}_{\\text{d,col}}$ and $\\overline{N^2}_{\\text{v,col}}$.\n6.  Calculate $N_{\\text{col,dry}}$ and $N_{\\text{col,virtual}}$ using the square root, with the non-negativity constraint.\n7.  Compute the difference $\\Delta N = N_{\\text{col,virtual}} - N_{\\text{col,dry}}$.\n\nThis comprehensive procedure allows for a correct and reproducible calculation of the required stability metrics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and contrasts dry and virtual Brunt-Väisälä frequencies for\n    three atmospheric sounding test cases.\n    \"\"\"\n\n    # Define physical and thermodynamic constants in SI units\n    G = 9.80665  # Gravitational acceleration (m/s^2)\n    RD = 287.05    # Specific gas constant for dry air (J/kg/K)\n    RV = 461.5     # Specific gas constant for water vapor (J/kg/K)\n    CPD = 1004.0   # Specific heat of dry air at constant pressure (J/kg/K)\n    P0 = 100000.0  # Reference pressure (Pa)\n    EPSILON = RD / RV  # Ratio of gas constants\n    KAPPA = RD / CPD   # Poisson constant exponent\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (humid tropical low levels)\n        {\n            \"p\": np.array([100000.0, 95000.0, 90000.0, 85000.0]),  # Pa\n            \"T\": np.array([300.0, 296.0, 292.5, 289.0]),         # K\n            \"q\": np.array([0.0180, 0.0160, 0.0120, 0.0090]),     # kg/kg\n        },\n        # Case B (dry midlatitude lower troposphere)\n        {\n            \"p\": np.array([100000.0, 90000.0, 80000.0, 70000.0]),\n            \"T\": np.array([288.0, 281.0, 274.0, 267.0]),\n            \"q\": np.array([0.0020, 0.0015, 0.0010, 0.0008]),\n        },\n        # Case C (dry-neutral baseline with a humidity gradient)\n        {\n            \"p\": np.array([100000.0, 95000.0, 90000.0]),\n            \"T\": np.array([300.0, 295.65, 291.00]),\n            \"q\": np.array([0.0100, 0.0080, 0.0060]),\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        p, T, q = case[\"p\"], case[\"T\"], case[\"q\"]\n        \n        # 1. Calculate thermodynamic quantities at each level\n        # Mixing ratio (r)\n        r = q / (1.0 - q)\n        \n        # Virtual temperature (Tv)\n        Tv = T * (1.0 + r / EPSILON) / (1.0 + r)\n        \n        # Potential temperature (theta)\n        theta = T * (P0 / p)**KAPPA\n        \n        # Virtual potential temperature (theta_v)\n        theta_v = Tv * (P0 / p)**KAPPA\n        \n        n_levels = len(p)\n        n_layers = n_levels - 1\n        \n        delta_z_layers = np.zeros(n_layers)\n        N2_d_layers = np.zeros(n_layers)\n        N2_v_layers = np.zeros(n_layers)\n\n        # 2. Iterate through layers to calculate layer-wise properties\n        for i in range(n_layers):\n            # Layer properties (mean and differences)\n            Tv_mean = 0.5 * (Tv[i] + Tv[i+1])\n            theta_mean = 0.5 * (theta[i] + theta[i+1])\n            theta_v_mean = 0.5 * (theta_v[i] + theta_v[i+1])\n            \n            delta_theta = theta[i+1] - theta[i]\n            delta_theta_v = theta_v[i+1] - theta_v[i]\n            \n            # Hypsometric equation for layer thickness\n            delta_z = (RD / G) * Tv_mean * np.log(p[i] / p[i+1])\n            delta_z_layers[i] = delta_z\n            \n            # Layer-wise squared Brunt-Väisälä frequency\n            # Dry calculation\n            N2_d_layers[i] = (G / theta_mean) * (delta_theta / delta_z)\n            # Virtual (moist) calculation\n            N2_v_layers[i] = (G / theta_v_mean) * (delta_theta_v / delta_z)\n\n        # 3. Compute column-mean frequencies\n        delta_z_total = np.sum(delta_z_layers)\n        \n        # Thickness-weighted mean of N^2\n        if delta_z_total > 0:\n            N2_d_col_mean = np.sum(N2_d_layers * delta_z_layers) / delta_z_total\n            N2_v_col_mean = np.sum(N2_v_layers * delta_z_layers) / delta_z_total\n        else:\n            N2_d_col_mean = 0.0\n            N2_v_col_mean = 0.0\n\n        # Column-mean frequency, handling potential negative N^2 (unstable layers)\n        N_col_dry = np.sqrt(max(0.0, N2_d_col_mean))\n        N_col_virtual = np.sqrt(max(0.0, N2_v_col_mean))\n        \n        # 4. Compute the difference\n        delta_N = N_col_virtual - N_col_dry\n        \n        all_results.append([N_col_dry, N_col_virtual, delta_N])\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{','.join(f'{x:.6f}' for x in res)}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Static stability is only one part of the atmospheric dynamics puzzle; vertical wind shear introduces a powerful mechanism for generating turbulence. This exercise  places the Brunt-Väisälä frequency in this broader context by introducing the gradient Richardson number, $Ri$, which quantifies the competition between stabilizing buoyancy ($N^2$) and destabilizing shear. By identifying layers susceptible to Kelvin-Helmholtz instability, you will see how $N^2$ serves as a crucial component in diagnosing and predicting dynamic instabilities in atmospheric flows.",
            "id": "4019135",
            "problem": "You are given vertical profiles of horizontal wind speed $U(z)$ and potential temperature $\\theta(z)$ for several idealized atmospheric columns under the dry Boussinesq approximation. Your task is to derive, from first principles, the quantity that measures the competition between static stability and vertical shear in a stratified, parallel flow, and then implement a numerical procedure to compute it from the provided discrete profiles. Using this quantity and a classical necessary condition for shear instability, identify the vertical layers that are susceptible to Kelvin-Helmholtz billows. You must work in the International System of Units and report altitudes in $\\mathrm{m}$.\n\nDerivation requirements: Starting from the linearized buoyancy equation in the dry Boussinesq framework and the definition of potential temperature, derive the expression for the squared buoyancy (Brunt-Väisälä) frequency in terms of the vertical gradient of potential temperature. Then, define the gradient-based nondimensional measure that compares stabilizing buoyancy to destabilizing vertical shear in a unidirectional, horizontally homogeneous, parallel flow $U(z)$. Use the classical necessary condition for inviscid shear instability to formulate a threshold for susceptibility to Kelvin-Helmholtz billows in terms of this nondimensional quantity. Do not assume any shortcut formulas; your derivation must proceed from the definitions and linear dynamics, and your implementation must follow the derived expressions.\n\nNumerical procedure requirements: For each test case, you are provided arrays $z_i$, $U_i$, and $\\theta_i$ at uniform vertical levels $z_0, z_1, \\dots, z_N$ with spacing $\\Delta z = z_{i+1} - z_i$, with $z_0 = 0$ and $z_N = 1000$. Compute the required gradients on layer midpoints using first-order layerwise differences between adjacent levels. For each layer between $z_i$ and $z_{i+1}$:\n- Compute the vertical shear magnitude using the layerwise difference of $U$ divided by the layer thickness.\n- Compute the static stability using the layerwise difference of $\\theta$ divided by the layer thickness and an appropriate Boussinesq reference value for potential temperature within the layer.\n- Form the nondimensional ratio that compares stability to squared shear at that layer.\nClassify a layer as susceptible to Kelvin-Helmholtz billows if this nondimensional ratio falls strictly below the classical inviscid threshold $1/4$ and the shear magnitude exceeds a small tolerance $\\varepsilon_{\\mathrm{shear}}$ to avoid division by zero artifacts. Adopt $\\varepsilon_{\\mathrm{shear}} = 10^{-6}\\ \\mathrm{s^{-1}}$. Use the gravitational acceleration $g = 9.80665\\ \\mathrm{m\\,s^{-2}}$.\n\nUnits and angle conventions: Use $\\mathrm{m}$, $\\mathrm{s}$, and $\\mathrm{K}$ throughout. No angles are involved.\n\nOutput specification: For each test case, output a list of the layer midpoint altitudes $z_{i+1/2} = (z_i + z_{i+1})/2$ (in $\\mathrm{m}$) for all layers classified as susceptible. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with no spaces, where each element corresponds to one test case and is itself a list of midpoints, for example, \"[[50.0,150.0],[...],[]]\".\n\nTest suite: Use the following five test cases, each defined on the same uniform grid with $z_i = i \\times 100$ for $i \\in \\{0,1,\\dots,10\\}$ so that $\\Delta z = 100$, $z_0 = 0$, and $z_{10} = 1000$. Define $U(z)$ and $\\theta(z)$ as linear functions $U(z) = U_0 + S z$ and $\\theta(z) = \\theta_0 + \\Gamma z$, with $U_0$ and $\\theta_0$ constants and $S$ and $\\Gamma$ the specified vertical gradients. For all cases take $\\theta_0 = 300\\ \\mathrm{K}$.\n\n- Case A (near-threshold stable shear flow): $U_0 = 0\\ \\mathrm{m\\,s^{-1}}$, $S = 0.02\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.003\\ \\mathrm{K\\,m^{-1}}$.\n- Case B (weakly stable with finite shear): $U_0 = 0\\ \\mathrm{m\\,s^{-1}}$, $S = 0.02\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.0005\\ \\mathrm{K\\,m^{-1}}$.\n- Case C (strong inversion with weak shear): $U_0 = 0\\ \\mathrm{m\\,s^{-1}}$, $S = 0.005\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.010\\ \\mathrm{K\\,m^{-1}}$.\n- Case D (no shear): $U_0 = 10\\ \\mathrm{m\\,s^{-1}}$, $S = 0.0\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.005\\ \\mathrm{K\\,m^{-1}}$.\n- Case E (unstable stratification with finite shear): $U_0 = 0\\ \\mathrm{m\\,s^{-1}}$, $S = 0.01\\ \\mathrm{s^{-1}}$, $\\Gamma = -0.001\\ \\mathrm{K\\,m^{-1}}$.\n\nFinal answer type and format: The final output must be a single line containing one list whose elements are the five lists of susceptible layer midpoints (in $\\mathrm{m}$) for Cases A through E, in that order, with no spaces anywhere. For example, a valid output would look like \"[[50.0,150.0,250.0],[...],[],[],[...]]\".",
            "solution": "### Derivation of the Stability Criterion\n\n#### 1. Buoyancy and the Brunt-Väisälä Frequency ($N^2$)\n\nWe begin within the framework of the dry Boussinesq approximation, where density variations are considered small relative to a reference density and are only important in the buoyancy term of the momentum equation. The buoyancy acceleration, $a_b$, acting on a fluid parcel is given by $a_b = g(\\rho_{env} - \\rho_{parcel}) / \\rho_{ref}$, where $\\rho_{env}$ is the density of the environment, $\\rho_{parcel}$ is the density of the parcel, and $\\rho_{ref}$ is a constant reference density.\n\nIn a dry atmosphere, for adiabatic displacements, a parcel's potential temperature, $\\theta$, is conserved. The equation of state, under the Boussinesq approximation, relates fluctuations in density $\\rho'$ to fluctuations in potential temperature $\\theta'$ around a reference state $(\\rho_{ref}, \\theta_{ref})$ as $\\rho'/\\rho_{ref} \\approx -\\theta'/\\theta_{ref}$. Thus, the buoyancy acceleration can be expressed in terms of potential temperature:\n$$ a_b = g \\frac{\\theta_{parcel} - \\theta_{env}}{\\theta_{ref}} $$\nNow, consider a background atmosphere with a potential temperature profile $\\theta(z)$. A fluid parcel initially at rest at height $z_p$ is displaced vertically by a small amount $\\delta z$. Its potential temperature is conserved, so $\\theta_{parcel} = \\theta(z_p)$. At its new height, $z' = z_p + \\delta z$, the environmental potential temperature is $\\theta_{env}(z') = \\theta(z_p + \\delta z)$. For a small displacement, we can Taylor-expand the environmental profile:\n$$ \\theta_{env}(z') \\approx \\theta(z_p) + \\frac{d\\theta}{dz} \\bigg|_{z_p} \\delta z $$\nThe resulting buoyancy acceleration on the parcel at height $z'$ is:\n$$ a_b \\approx g \\frac{\\theta(z_p) - \\left( \\theta(z_p) + \\frac{d\\theta}{dz} \\delta z \\right)}{\\theta_{ref}} = - \\left( \\frac{g}{\\theta_{ref}} \\frac{d\\theta}{dz} \\right) \\delta z $$\nThe vertical equation of motion for the parcel's displacement is $\\frac{d^2(\\delta z)}{dt^2} = a_b$. Substituting the expression for $a_b$, we obtain the equation for a simple harmonic oscillator:\n$$ \\frac{d^2(\\delta z)}{dt^2} = - \\left( \\frac{g}{\\theta_{ref}} \\frac{d\\theta}{dz} \\right) \\delta z $$\nThis equation describes buoyancy oscillations. The squared angular frequency of these oscillations is defined as the squared Brunt-Väisälä (or buoyancy) frequency, $N^2$:\n$$ N^2 \\equiv \\frac{g}{\\theta_{ref}} \\frac{d\\theta}{dz} $$\n$N^2$ is a measure of the static stability of the fluid. If $d\\theta/dz > 0$, then $N^2 > 0$, and a displaced parcel will oscillate around its equilibrium position, indicating a stable stratification. If $d\\theta/dz  0$, then $N^2  0$, the restoring force becomes an amplifying one, and the parcel accelerates away from its initial position, indicating an unstable stratification (convection).\n\n#### 2. The Gradient Richardson Number ($Ri$) and Instability Criterion\n\nIn a parallel flow with horizontal velocity $U(z)$ that varies with height, the vertical shear, $dU/dz$, can be a source of kinetic energy for instabilities. The competition between the stabilizing effect of buoyancy and the destabilizing effect of shear is quantified by a nondimensional parameter, the gradient Richardson number, $Ri$. It is defined as the ratio of the squared buoyancy frequency to the squared vertical shear:\n$$ Ri = \\frac{N^2}{\\left(\\frac{dU}{dz}\\right)^2} $$\nSubstituting our derived expression for $N^2$:\n$$ Ri = \\frac{\\frac{g}{\\theta_{ref}} \\frac{d\\theta}{dz}}{\\left(\\frac{dU}{dz}\\right)^2} $$\nA low Richardson number indicates that shear effects dominate over buoyancy, making the flow susceptible to shear instability. The Miles-Howard theorem provides a rigorous basis for this: a necessary condition for an inviscid, parallel, stratified shear flow to be unstable is that the gradient Richardson number must be less than $1/4$ somewhere in the flow. Therefore, we classify a layer as susceptible to Kelvin-Helmholtz billows if the following condition is met:\n$$ Ri  \\frac{1}{4} $$\nThe problem adds a practical constraint to avoid numerical issues when the shear is zero or negligibly small, requiring that the shear magnitude must exceed a small tolerance, $\\varepsilon_{\\mathrm{shear}}$.\n\n### Numerical Procedure and Analysis of Test Cases\n\nThe provided atmospheric profiles are discrete, defined on a uniform grid $z_i = i \\cdot \\Delta z$ for $i \\in \\{0, 1, \\dots, 10\\}$, with $\\Delta z = 100\\ \\mathrm{m}$. We compute the Richardson number for each layer between $z_i$ and $z_{i+1}$.\n\nFor each layer $i$ (from $i=0$ to $i=9$), we perform the following calculations:\n1.  **Gradients**: The vertical gradients are approximated using first-order finite differences across the layer:\n    - Vertical shear: $\\left(\\frac{dU}{dz}\\right)_i = \\frac{U_{i+1} - U_i}{\\Delta z}$\n    - Potential temperature gradient: $\\left(\\frac{d\\theta}{dz}\\right)_i = \\frac{\\theta_{i+1} - \\theta_i}{\\Delta z}$\n2.  **Reference Temperature**: The reference potential temperature, $\\theta_{ref}$, for the layer is taken as the layer-mean value: $\\theta_{ref, i} = (\\theta_i + \\theta_{i+1}) / 2$.\n3.  **Richardson Number**: The discrete Richardson number for layer $i$ is:\n    $$ Ri_i = \\frac{\\frac{g}{\\theta_{ref, i}} \\left(\\frac{\\theta_{i+1} - \\theta_i}{\\Delta z}\\right)}{\\left(\\frac{U_{i+1} - U_i}{\\Delta z}\\right)^2} = \\frac{g \\cdot \\Delta z \\cdot (\\theta_{i+1} - \\theta_i)}{(\\frac{\\theta_i + \\theta_{i+1}}{2}) \\cdot (U_{i+1} - U_i)^2} $$\n4.  **Instability Check**: A layer is flagged as susceptible if both conditions are met:\n    - $Ri_i  0.25$\n    - $\\left|\\frac{U_{i+1} - U_i}{\\Delta z}\\right| > \\varepsilon_{\\mathrm{shear}}$, where $\\varepsilon_{\\mathrm{shear}} = 10^{-6}\\ \\mathrm{s^{-1}}$.\n\nFor the given test cases, the profiles are linear: $U(z) = U_0 + S z$ and $\\theta(z) = \\theta_0 + \\Gamma z$, with $\\theta_0 = 300\\ \\mathrm{K}$. This simplifies the gradients: $dU/dz = S$ and $d\\theta/dz = \\Gamma$. The numerical differences exactly recover these constant gradients. The Richardson number for a layer with midpoint $z_{i+1/2}$ becomes:\n$$ Ri_i = \\frac{g \\Gamma}{S^2 \\cdot (\\theta_0 + \\Gamma z_{i+1/2})} $$\nWe use $g = 9.80665\\ \\mathrm{m\\,s^{-2}}$.\n\n-   **Case A**: $S = 0.02\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.003\\ \\mathrm{K\\,m^{-1}}$. Shear is $|S| = 0.02 > \\varepsilon_{\\mathrm{shear}}$.\n    $Ri_i = \\frac{9.80665 \\cdot 0.003}{(0.02)^2 (300 + 0.003 z_{i+1/2})} = \\frac{73.549875}{300 + 0.003 z_{i+1/2}}$. For the lowest layer midpoint $z=50\\ \\mathrm{m}$, $Ri \\approx 0.245  0.25$. For the highest layer midpoint $z=950\\ \\mathrm{m}$, $Ri \\approx 0.243  0.25$. Since $Ri$ is a monotonically decreasing function of $z$, all layers satisfy $Ri  0.25$. All $10$ layers are susceptible.\n\n-   **Case B**: $S = 0.02\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.0005\\ \\mathrm{K\\,m^{-1}}$. Shear is $|S| = 0.02 > \\varepsilon_{\\mathrm{shear}}$.\n    $Ri_i = \\frac{9.80665 \\cdot 0.0005}{(0.02)^2 (300 + 0.0005 z_{i+1/2})} = \\frac{12.2583125}{300 + 0.0005 z_{i+1/2}}$. For all $z$ in the domain, the denominator is slightly above $300$, so $Ri \\approx 12.26/300 \\approx 0.04$, which is well below $0.25$. All $10$ layers are susceptible.\n\n-   **Case C**: $S = 0.005\\ \\mathrm{s^{-1}}$, $\\Gamma = 0.010\\ \\mathrm{K\\,m^{-1}}$. Shear is $|S| = 0.005 > \\varepsilon_{\\mathrm{shear}}$.\n    $Ri_i = \\frac{9.80665 \\cdot 0.01}{(0.005)^2 (300 + 0.01 z_{i+1/2})} = \\frac{3922.66}{300 + 0.01 z_{i+1/2}}$. The denominator is always greater than $300$, so $Ri > 3922.66/310 \\approx 12.6$. All $Ri_i$ values are much greater than $0.25$. No layers are susceptible.\n\n-   **Case D**: $S = 0.0\\ \\mathrm{s^{-1}}$. The shear magnitude is $0$, which is not greater than $\\varepsilon_{\\mathrm{shear}}$. The condition for susceptibility is not met, regardless of stability. No layers are susceptible.\n\n-   **Case E**: $S = 0.01\\ \\mathrm{s^{-1}}$, $\\Gamma = -0.001\\ \\mathrm{K\\,m^{-1}}$. Shear is $|S| = 0.01 > \\varepsilon_{\\mathrm{shear}}$.\n    The potential temperature gradient $\\Gamma$ is negative, which implies static instability ($N^2  0$). This makes the Richardson number $Ri_i$ negative for all layers. Since any negative number is strictly less than $0.25$, the instability condition $Ri  0.25$ is met for all layers. All $10$ layers are susceptible.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes layers susceptible to Kelvin-Helmholtz instability for several\n    idealized atmospheric profiles.\n    \"\"\"\n    g = 9.80665  # Gravitational acceleration in m/s^2\n    epsilon_shear = 1e-6  # Shear tolerance in 1/s\n    ri_threshold = 0.25  # Critical Richardson number\n\n    # Test cases: (U0, S, Gamma)\n    # U(z) = U0 + S*z\n    # theta(z) = 300 + Gamma*z\n    test_cases = [\n        # Case A\n        (0.0, 0.02, 0.003),\n        # Case B\n        (0.0, 0.02, 0.0005),\n        # Case C\n        (0.0, 0.005, 0.010),\n        # Case D\n        (10.0, 0.0, 0.005),\n        # Case E\n        (0.0, 0.01, -0.001),\n    ]\n\n    # Grid setup\n    z_min = 0.0\n    z_max = 1000.0\n    num_points = 11\n    z_levels = np.linspace(z_min, z_max, num_points)\n    delta_z = z_levels[1] - z_levels[0]\n    num_layers = len(z_levels) - 1\n\n    all_results = []\n\n    for case in test_cases:\n        U0, S, Gamma = case\n        theta0_profile = 300.0\n\n        # Generate profiles on grid points\n        U_profile = U0 + S * z_levels\n        theta_profile = theta0_profile + Gamma * z_levels\n\n        susceptible_midpoints = []\n        for i in range(num_layers):\n            # Values at layer boundaries\n            U_i = U_profile[i]\n            U_i_plus_1 = U_profile[i+1]\n            theta_i = theta_profile[i]\n            theta_i_plus_1 = theta_profile[i+1]\n            z_i = z_levels[i]\n            z_i_plus_1 = z_levels[i+1]\n            \n            # Compute shear\n            delta_U = U_i_plus_1 - U_i\n            shear = delta_U / delta_z\n            \n            # Check shear magnitude condition\n            if abs(shear) > epsilon_shear:\n                # Compute quantities for Ri\n                delta_theta = theta_i_plus_1 - theta_i\n                theta_ref = (theta_i + theta_i_plus_1) / 2.0\n                \n                # N^2 = (g / theta_ref) * (dtheta/dz)\n                N_squared = (g / theta_ref) * (delta_theta / delta_z)\n                \n                # Ri = N^2 / (dU/dz)^2\n                richardson_number = N_squared / (shear**2)\n                \n                # Check instability condition\n                if richardson_number  ri_threshold:\n                    midpoint = (z_i + z_i_plus_1) / 2.0\n                    susceptible_midpoints.append(midpoint)\n        \n        all_results.append(susceptible_midpoints)\n\n    # Format output as a single string\n    # e.g., \"[[50.0,150.0],[...],[]]\"\n    output_str = \"[\"\n    for i, result_list in enumerate(all_results):\n        # Format each list of floats\n        list_str = \"[\" + \",\".join(map(str, result_list)) + \"]\"\n        output_str += list_str\n        if i  len(all_results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    print(output_str)\n\nsolve()\n```"
        }
    ]
}