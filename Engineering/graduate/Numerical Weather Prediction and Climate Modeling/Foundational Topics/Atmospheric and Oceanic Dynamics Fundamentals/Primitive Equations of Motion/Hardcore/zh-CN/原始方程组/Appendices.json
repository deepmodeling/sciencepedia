{
    "hands_on_practices": [
        {
            "introduction": "虽然地转平衡是理解大尺度大气环流的有力近似，但真实的大气流动从不完美平衡。本练习通过动手推导和量化这种平衡的偏差——非地转风，将其直接与加速度和无量纲的罗斯比数相联系 ()。掌握这项技能对于深入理解天气系统（如急流和锋面）的动力学至关重要，因为正是这些非地转分量驱动了垂直运动和天气现象的发生。",
            "id": "4078720",
            "problem": "一个$f$平面上的中纬度中尺度气流，其模型由原始方程组的水平动量方程描述，该模型采用了Boussinesq近似，忽略了摩擦力和度量项，并假设垂直气压分布满足静力平衡。在笛卡尔坐标系中，速度矢量$\\boldsymbol{u} = (u,v)$的水平动量方程为\n$$\n\\frac{D \\boldsymbol{u}}{D t} + f \\, \\boldsymbol{k} \\times \\boldsymbol{u} = - \\frac{1}{\\rho} \\nabla_{h} p,\n$$\n其中 $f$ 是科里奥利参数，$\\boldsymbol{k}$ 是垂直方向的单位矢量，$\\rho$ 是密度，$\\nabla_{h}$ 是水平梯度算子。地转风 $\\boldsymbol{u}_{g}$ 由地转平衡定义\n$$\nf \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{g} = - \\frac{1}{\\rho} \\nabla_{h} p,\n$$\n非地转风为 $\\boldsymbol{u}_{a} \\equiv \\boldsymbol{u} - \\boldsymbol{u}_{g}$。\n\n从给定的原始动量方程和地转风定义出发，推导非地转风大小 $|\\boldsymbol{u}_{a}|$ 的一个主阶诊断表达式，该表达式用水平加速度尺度 $A_{h}$ 和科里奥利参数 $f$ 表示。然后，使用由下式定义的罗斯贝数\n$$\n\\mathrm{Ro} \\equiv \\frac{A_{h}}{f \\, |\\boldsymbol{u}_{g}|},\n$$\n说明在相同假设下，如何用 $\\mathrm{Ro}$ 和 $|\\boldsymbol{u}_{g}|$ 表示同一个大小。\n\n对于一个特定的气流，其科里奥利参数 $f = 1.03 \\times 10^{-4} \\ \\mathrm{s}^{-1}$，水平加速度尺度 $A_{h} = 2.40 \\times 10^{-4} \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$，罗斯贝数 $\\mathrm{Ro} = 0.16$，计算非地转风大小 $|\\boldsymbol{u}_{a}|$ 的数值。最终答案以 $\\mathrm{m} \\ \\mathrm{s}^{-1}$ 为单位，并四舍五入到四位有效数字。仅提供单个数值作为最终答案。",
            "solution": "该问题已根据指定标准进行验证。\n\n### 第 1 步：提取已知条件\n问题提供了以下信息：\n-   **水平动量方程：**\n    $$ \\frac{D \\boldsymbol{u}}{D t} + f \\, \\boldsymbol{k} \\times \\boldsymbol{u} = - \\frac{1}{\\rho} \\nabla_{h} p $$\n    其中 $\\boldsymbol{u} = (u,v)$ 是水平速度，$f$ 是科里奥利参数，$\\boldsymbol{k}$ 是垂直单位矢量，$\\rho$ 是密度，$p$ 是气压，$D/Dt$ 是物质导数。\n-   **地转风定义：**\n    $$ f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{g} = - \\frac{1}{\\rho} \\nabla_{h} p $$\n-   **非地转风定义：**\n    $$ \\boldsymbol{u}_{a} \\equiv \\boldsymbol{u} - \\boldsymbol{u}_{g} $$\n-   **罗斯贝数定义：**\n    $$ \\mathrm{Ro} \\equiv \\frac{A_{h}}{f \\, |\\boldsymbol{u}_{g}|} $$\n    其中 $A_h$ 是水平加速度尺度。\n-   **数值：**\n    -   $f = 1.03 \\times 10^{-4} \\ \\mathrm{s}^{-1}$\n    -   $A_{h} = 2.40 \\times 10^{-4} \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$\n    -   $\\mathrm{Ro} = 0.16$\n\n### 第 2 步：使用提取的已知条件进行验证\n对问题的有效性进行评估：\n-   **科学依据：** 该问题基于原始运动方程，这是地球物理流体动力学和数值天气预报的基础。地转风和非地转风的方程和定义都是标准的。所做的假设（Boussinesq、静力、f平面、无粘）是常见的，并且适用于模拟中纬度中尺度现象。数值对于此类气流是物理上现实的。\n-   **适定性：** 该问题是适定的。它要求基于一组自洽的方程和数据进行特定的推导和数值计算。信息充分且一致，可以得到唯一解。\n-   **客观性：** 问题使用精确、标准的科学术语陈述，没有歧义或主观论断。\n\n### 第 3 步：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n### 非地转风大小的推导\n\n推导从给定的水平动量方程开始：\n$$ \\frac{D \\boldsymbol{u}}{D t} + f \\, \\boldsymbol{k} \\times \\boldsymbol{u} = - \\frac{1}{\\rho} \\nabla_{h} p $$\n气压梯度项 $- \\frac{1}{\\rho} \\nabla_{h} p$ 由地转平衡定义：\n$$ - \\frac{1}{\\rho} \\nabla_{h} p = f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{g} $$\n将此定义代入动量方程，得到：\n$$ \\frac{D \\boldsymbol{u}}{D t} + f \\, \\boldsymbol{k} \\times \\boldsymbol{u} = f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{g} $$\n我们可以重新排列此方程以分离出加速度项：\n$$ \\frac{D \\boldsymbol{u}}{D t} = f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{g} - f \\, \\boldsymbol{k} \\times \\boldsymbol{u} $$\n提取右侧的公因项，得到：\n$$ \\frac{D \\boldsymbol{u}}{D t} = f \\, \\boldsymbol{k} \\times (\\boldsymbol{u}_{g} - \\boldsymbol{u}) $$\n非地转风定义为 $\\boldsymbol{u}_{a} = \\boldsymbol{u} - \\boldsymbol{u}_{g}$。因此，$\\boldsymbol{u}_{g} - \\boldsymbol{u} = -\\boldsymbol{u}_{a}$。将此代入方程，得到总加速度与非地转风之间的直接关系：\n$$ \\frac{D \\boldsymbol{u}}{D t} = -f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{a} $$\n问题要求非地转风大小 $|\\boldsymbol{u}_{a}|$ 的表达式。我们取此矢量方程两边的模：\n$$ \\left| \\frac{D \\boldsymbol{u}}{D t} \\right| = \\left| -f \\, \\boldsymbol{k} \\times \\boldsymbol{u}_{a} \\right| $$\n问题将 $A_{h}$ 定义为水平加速度尺度，我们将其解释为总水平加速度的大小，即 $A_{h} = \\left| \\frac{D \\boldsymbol{u}}{D t} \\right|$。右侧的模为 $|-f| |\\boldsymbol{k}| |\\boldsymbol{u}_{a}| \\sin(\\theta)$，其中 $\\theta$ 是矢量 $\\boldsymbol{k}$ 和 $\\boldsymbol{u}_{a}$ 之间的夹角。由于 $\\boldsymbol{k}$ 是垂直单位矢量，而 $\\boldsymbol{u}_{a}$ 是水平风矢量，它们是正交的，所以 $\\theta = \\pi/2$ 且 $\\sin(\\theta) = 1$。单位矢量的模为 $|\\boldsymbol{k}| = 1$。给定 $f  0$，我们有 $|-f| = f$。\n大小方程简化为：\n$$ A_{h} = f |\\boldsymbol{u}_{a}| $$\n求解非地转风的大小，得到第一个要求的表达式：\n$$ |\\boldsymbol{u}_{a}| = \\frac{A_{h}}{f} $$\n这是 $|\\boldsymbol{u}_{a}|$ 的主阶诊断表达式。\n\n接下来，我们用罗斯贝数 $\\mathrm{Ro}$ 和地转风大小 $|\\boldsymbol{u}_{g}|$ 来表示 $|\\boldsymbol{u}_{a}|$。罗斯贝数定义为：\n$$ \\mathrm{Ro} = \\frac{A_{h}}{f \\, |\\boldsymbol{u}_{g}|} $$\n从我们的第一个结果可知 $A_{h} = f |\\boldsymbol{u}_{a}|$。将其代入罗斯贝数的定义中：\n$$ \\mathrm{Ro} = \\frac{f |\\boldsymbol{u}_{a}|}{f \\, |\\boldsymbol{u}_{g}|} $$\n科里奥利参数 $f$ 被消去，得到：\n$$ \\mathrm{Ro} = \\frac{|\\boldsymbol{u}_{a}|}{|\\boldsymbol{u}_{g}|} $$\n重新整理以求解 $|\\boldsymbol{u}_{a}|$，得到第二个要求的表达式：\n$$ |\\boldsymbol{u}_{a}| = \\mathrm{Ro} \\, |\\boldsymbol{u}_{g}| $$\n\n### 数值计算\n\n问题提供了以下数值来计算非地转风的大小：\n-   $f = 1.03 \\times 10^{-4} \\ \\mathrm{s}^{-1}$\n-   $A_{h} = 2.40 \\times 10^{-4} \\ \\mathrm{m} \\ \\mathrm{s}^{-2}$\n\n使用第一个推导出的公式，我们可以直接计算 $|\\boldsymbol{u}_{a}|$：\n$$ |\\boldsymbol{u}_{a}| = \\frac{A_{h}}{f} = \\frac{2.40 \\times 10^{-4} \\ \\mathrm{m} \\ \\mathrm{s}^{-2}}{1.03 \\times 10^{-4} \\ \\mathrm{s}^{-1}} $$\n分子和分母中的因子 $10^{-4}$ 被消去：\n$$ |\\boldsymbol{u}_{a}| = \\frac{2.40}{1.03} \\ \\mathrm{m} \\ \\mathrm{s}^{-1} $$\n进行除法运算：\n$$ |\\boldsymbol{u}_{a}| \\approx 2.330097087... \\ \\mathrm{m} \\ \\mathrm{s}^{-1} $$\n问题要求结果四舍五入到四位有效数字。前四位有效数字是 $2$、$3$、$3$ 和 $0$。第五位是 $0$，所以我们向下舍入（即保持第四位数字不变）。\n因此，非地转风大小的数值为 $2.330 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{2.330}\n$$"
        },
        {
            "introduction": "本练习在平衡流的概念基础上，将理论付诸于计算实践。你将实现一个算法，从基本物理量（位势、涡度和散度）中计算平衡风（地转风）和完整风场 ()。通过这种方式，你将具体理解在地转近似中被忽略的风的辐散分量如何对总风场做出贡献，这是气象数据分析和数值模式初始化的核心任务之一。",
            "id": "4078700",
            "problem": "你需要实现一个完整的、可运行的程序，该程序在一个双周期水平域上，从给定的位势场通过地转反演计算平衡风场，并将其与通过涡度-散度反演得到的全风场进行比较。其科学背景是用于数值天气预报和气候模拟的静力原始运动方程。推导和算法必须从基本的水平动量方程（在常数科里奥利参数平面，即所谓的f平面上表示）、水平涡度和散度的标准定义，以及著名的水平矢量场亥姆霍兹分解出发。没有提供预先推导好的目标公式；你的解答必须论证并推导出必要的关系式。\n\n物理和数学背景设置如下。考虑一个二维双周期域，它代表一个具有恒定科里奥利参数的中纬度切平面。设向东的笛卡尔坐标为 $x$，向北的笛卡尔坐标为 $y$，单位均为米。设位势为 $\\Phi(x,y)$，单位为 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$，水平风为 $\\boldsymbol{v}(x,y) = (u(x,y), v(x,y))$，单位为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$。科里奥利参数为常数 $f_0$，单位为 $\\mathrm{s}^{-1}$。假设流场在 $x$ 和 $y$ 方向上都是水平周期的。\n\n从水平动量方程和小罗斯贝数近似出发，推导与给定地转位势场 $\\Phi(x,y)$ 相关的平衡地转风。另外，使用亥姆霍兹分解将水平风表示为一个源于流函数的无辐散分量和一个源于速度势的无旋分量之和，并利用相对涡度和水平散度的定义，推导在双周期域上的相应反演关系。实现一个使用傅里叶方法在周期域上执行必要的反演和空间微分的算法。\n\n你的程序必须构建以下参数值和场量的测试套件：\n\n- 域参数：\n    - $L_x = 3.0\\times 10^6\\,\\mathrm{m}$，$L_y = 3.0\\times 10^6\\,\\mathrm{m}$。\n    - 网格分辨率：$N_x = 128$，$N_y = 96$。\n    - 科里奥利参数：$f_0 = 1.0\\times 10^{-4}\\,\\mathrm{s}^{-1}$。\n    - 域在 $x$ 和 $y$ 方向上都是双周期的。\n\n- 使用整数傅里叶模态构造解析的流函数和速度势场。对于每个测试用例，定义整数 $m_{\\psi,x}$、$m_{\\psi,y}$、$m_{\\chi,x}$、$m_{\\chi,y}$ 和振幅 $A_\\psi$（单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$）和 $A_\\chi$（单位 $\\mathrm{m}^2\\,\\mathrm{s}^{-1}$）。设波数为 $k_{\\psi,x} = 2\\pi m_{\\psi,x}/L_x$，$k_{\\psi,y} = 2\\pi m_{\\psi,y}/L_y$，$k_{\\chi,x} = 2\\pi m_{\\chi,x}/L_x$，$k_{\\chi,y} = 2\\pi m_{\\chi,y}/L_y$。定义流函数和速度势场为\n    - $\\psi(x,y) = A_\\psi \\cos\\!\\big(k_{\\psi,x} x\\big)\\cos\\!\\big(k_{\\psi,y} y\\big)$，\n    - $\\chi(x,y) = A_\\chi \\sin\\!\\big(k_{\\chi,x} x\\big)\\cos\\!\\big(k_{\\chi,y} y\\big)$。\n  这些选择确保了零平均值和空间周期性。\n\n- 通过在f平面上的笛卡尔拉普拉斯算子，从解析的流函数和速度势定义相对涡度和散度的测试场，\n    - $\\zeta(x,y) = \\nabla^2 \\psi(x,y)$，\n    - $\\delta(x,y) = \\nabla^2 \\chi(x,y)$，\n  从而使反演在周期域上是数学适定的。\n\n- 将每个测试用例的位势定义为 $\\Phi(x,y) = f_0\\,\\psi(x,y)$，这在地转关系中隔离了旋转平衡分量，同时排除了来自无旋分量的任何直接贡献。\n\n你必须处理以下四个测试用例，每个用例由 $(A_\\psi, m_{\\psi,x}, m_{\\psi,y}, A_\\chi, m_{\\chi,x}, m_{\\chi,y})$ 指定：\n\n1. $(1.0\\times 10^6, 3, 2, 0.0, 0, 0)$。\n2. $(1.0\\times 10^6, 3, 2, 5.0\\times 10^5, 5, 4)$。\n3. $(0.0, 0, 0, 1.0\\times 10^6, 4, 3)$。\n4. $(3.0\\times 10^5, 20, 15, 3.0\\times 10^5, 21, 16)$。\n\n对于每个测试用例，计算：\n- 根据f平面上水平动量方程推导出的地转平衡，通过反演给定的 $\\Phi(x,y)$ 来计算地转风 $\\boldsymbol{v}_g(x,y)$。\n- 根据周期域上亥姆霍兹分解推导出的涡度-散度反演，通过反演给定的 $\\zeta(x,y)$ 和 $\\delta(x,y)$ 来计算全风场 $\\boldsymbol{v}(x,y)$。\n\n然后，计算地转风和全风场在整个域上的速度均方根差异，\n$$\nD = \\left[ \\frac{1}{N_x N_y} \\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} \\left( \\big(u_{i,j} - u_{g,i,j}\\big)^2 + \\big(v_{i,j} - v_{g,i,j}\\big)^2 \\right) \\right]^{1/2}.\n$$\n将每个 $D$ 表示为 $\\mathrm{m}\\,\\mathrm{s}^{-1}$，四舍五入到六位小数。\n\n你的程序应生成单行输出，其中包含四个结果，形式为用方括号括起来的逗号分隔列表，按测试用例的顺序排列，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$，其中每个条目是以 $\\mathrm{m}\\,\\mathrm{s}^{-1}$ 为单位、四舍五入到六位小数的浮点数。不应打印任何其他文本。",
            "solution": "该问题要求在一个双周期域上计算和比较水平风场的两种不同表示：从位势场推导出的平衡地转风，以及从涡度和散度场推导出的全风场。这涉及到从第一性原理推导控制关系，并使用傅里叶方法实现数值解。\n\n### 第一部分：地转风的推导\n\n在具有恒定科里奥利参数 $f_0$ 的旋转平面（f平面）上，流体的水平动量方程可以写为：\n$$\n\\frac{Du}{Dt} - f_0 v = -\\frac{\\partial \\Phi}{\\partial x}\n$$\n$$\n\\frac{Dv}{Dt} + f_0 u = -\\frac{\\partial \\Phi}{\\partial y}\n$$\n这里，$\\boldsymbol{v} = (u,v)$ 是水平风矢量，$\\Phi$ 是位势，$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + u\\frac{\\partial}{\\partial x} + v\\frac{\\partial}{\\partial y}$ 表示二维流动的物质导数，包含了局地时间倾向和平流。\n\n地转平衡是大尺度动力学中的一个基本概念，其中罗斯贝数很小，意味着加速度项 $\\left(\\frac{Du}{Dt}, \\frac{Dv}{Dt}\\right)$ 与科里奥利力和气压梯度力相比可以忽略不计。在此近似下，动量方程简化为：\n$$\n-f_0 v_g = -\\frac{\\partial \\Phi}{\\partial x}\n$$\n$$\nf_0 u_g = -\\frac{\\partial \\Phi}{\\partial y}\n$$\n其中 $\\boldsymbol{v}_g = (u_g, v_g)$ 表示地转风。求解地转风的分量，我们得到以下关系式：\n$$\nu_g = -\\frac{1}{f_0} \\frac{\\partial \\Phi}{\\partial y}\n$$\n$$\nv_g = \\frac{1}{f_0} \\frac{\\partial \\Phi}{\\partial x}\n$$\n这些方程完全根据位势场 $\\Phi$ 定义了地转风场。\n\n### 第二部分：从涡度和散度推导全风场\n\n根据亥姆霍兹分解定理，任何矢量场（例如水平风 $\\boldsymbol{v}$）都可以唯一地（在周期域上，至多相差一个常数）分解为一个无辐散（旋转）分量和一个无旋（辐散）分量。这些分量可以分别用标量流函数 $\\psi$ 和标量速度势 $\\chi$ 来表示。\n\n无辐散分量由 $\\boldsymbol{v}_\\psi = \\hat{\\boldsymbol{k}} \\times \\nabla \\psi$ 给出，无旋分量由 $\\boldsymbol{v}_\\chi = \\nabla \\chi$ 给出。在笛卡尔坐标系中，该分解为总风场分量 $u$ 和 $v$ 提供了以下表达式：\n$$\nu = -\\frac{\\partial \\psi}{\\partial y} + \\frac{\\partial \\chi}{\\partial x}\n$$\n$$\nv = \\frac{\\partial \\psi}{\\partial x} + \\frac{\\partial \\chi}{\\partial y}\n$$\n相对涡度的垂直分量 $\\zeta$ 和水平散度 $\\delta$ 定义为：\n$$\n\\zeta \\equiv \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}\n$$\n$$\n\\delta \\equiv \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\n$$\n将用 $\\psi$ 和 $\\chi$ 表示的 $u$ 和 $v$ 的表达式代入这些定义，我们发现：\n$$\n\\zeta = \\frac{\\partial}{\\partial x}\\left(\\frac{\\partial \\psi}{\\partial x} + \\frac{\\partial \\chi}{\\partial y}\\right) - \\frac{\\partial}{\\partial y}\\left(-\\frac{\\partial \\psi}{\\partial y} + \\frac{\\partial \\chi}{\\partial x}\\right) = \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} = \\nabla^2 \\psi\n$$\n$$\n\\delta = \\frac{\\partial}{\\partial x}\\left(-\\frac{\\partial \\psi}{\\partial y} + \\frac{\\partial \\chi}{\\partial x}\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{\\partial \\psi}{\\partial x} + \\frac{\\partial \\chi}{\\partial y}\\right) = \\frac{\\partial^2 \\chi}{\\partial x^2} + \\frac{\\partial^2 \\chi}{\\partial y^2} = \\nabla^2 \\chi\n$$\n这得到了一对泊松方程，它们将流函数和速度势与涡度和散度场联系起来：\n$$\n\\nabla^2 \\psi = \\zeta\n$$\n$$\n\\nabla^2 \\chi = \\delta\n$$\n给定场 $\\zeta(x,y)$ 和 $\\delta(x,y)$，可以求解这些椭圆型偏微分方程以得到 $\\psi$ 和 $\\chi$。然后可以通过对计算出的势函数求空间导数来恢复全风场 $\\boldsymbol{v}=(u,v)$。\n\n### 第三部分：使用傅里叶方法的数值算法\n\n该问题设置在一个双周期域上，这使得基于快速傅里叶变换（FFT）的谱方法非常适合所需的计算。\n\n设 $F(x,y)$ 是域上的一个函数，$\\hat{F}(k_x, k_y)$ 是其二维离散傅里叶变换，其中 $k_x$ 和 $k_y$ 分别是纬向和经向波数。我们利用的傅里叶变换的关键性质是，物理空间中的微分在谱空间中变成乘法：\n$$\n\\mathcal{F}\\left( \\frac{\\partial F}{\\partial x} \\right) = i k_x \\hat{F}(k_x, k_y)\n$$\n$$\n\\mathcal{F}\\left( \\frac{\\partial F}{\\partial y} \\right) = i k_y \\hat{F}(k_x, k_y)\n$$\n拉普拉斯算子则变为：\n$$\n\\mathcal{F}\\left( \\nabla^2 F \\right) = -(k_x^2 + k_y^2) \\hat{F}(k_x, k_y)\n$$\n\n总体算法流程如下：\n\n1.  **网格与波数设置**：定义物理网格尺寸（$L_x, L_y$）和分辨率（$N_x, N_y$）。构建物理坐标网格 $x$ 和 $y$。构建与离散傅里叶变换相对应的波数网格 $k_x$ 和 $k_y$。预先计算一个二维数组用于表示波数大小的平方，$k^2 = k_x^2 + k_y^2$。\n\n2.  **场量生成**：对于每个测试用例，问题为流函数 $\\psi_{true}$ 和速度势 $\\chi_{true}$ 提供了解析形式。根据这些，定义我们计算所需的输入场：\n    -   位势：$\\Phi = f_0 \\psi_{true}$\n    -   涡度：$\\zeta = \\nabla^2 \\psi_{true}$\n    -   散度：$\\delta = \\nabla^2 \\chi_{true}$\n    这些量在物理网格上计算。这样的构造确保了 $\\zeta$ 和 $\\delta$ 的平均值为零，这是在周期域上求解泊松方程的必要条件。\n\n3.  **地转风计算**：\n    a. 计算位势场 $\\Phi$ 的二维FFT，得到 $\\hat{\\Phi}(k_x, k_y)$。\n    b. 计算位势梯度的谱表示：$i k_y \\hat{\\Phi}$ 和 $i k_x \\hat{\\Phi}$。\n    c. 对这些谱表示应用二维逆FFT，以在物理空间中获得 $\\frac{\\partial \\Phi}{\\partial y}$ 和 $\\frac{\\partial \\Phi}{\\partial x}$。\n    d. 计算地转风分量：$u_g = -(1/f_0) \\frac{\\partial \\Phi}{\\partial y}$ 和 $v_g = (1/f_0) \\frac{\\partial \\Phi}{\\partial x}$。\n\n4.  **全风场计算**：\n    a. 计算涡度 $\\zeta$ 和散度 $\\delta$ 的二维FFT，得到 $\\hat{\\zeta}(k_x, k_y)$ 和 $\\hat{\\delta}(k_x, k_y)$。\n    b. 通过除法在谱空间中求解泊松方程：\n       $$\n       \\hat{\\psi} = -\\frac{\\hat{\\zeta}}{k_x^2 + k_y^2} \\quad \\text{和} \\quad \\hat{\\chi} = -\\frac{\\hat{\\delta}}{k_x^2 + k_y^2}\n       $$\n       对于零波数模式（$k_x=k_y=0$），会出现分母为零的特殊情况。由于 $\\zeta$ 和 $\\delta$ 的平均值为零，它们的直流分量 $\\hat{\\zeta}(0,0)$ 和 $\\hat{\\delta}(0,0)$ 也为零。通过设置 $\\hat{\\psi}(0,0) = 0$ 和 $\\hat{\\chi}(0,0) = 0$ 来处理该比率，这实际上固定了势函数中任意的加法常数。\n    c. 计算风分量的谱表示：\n       $$\n       \\hat{u} = -i k_y \\hat{\\psi} + i k_x \\hat{\\chi}\n       $$\n       $$\n       \\hat{v} = i k_x \\hat{\\psi} + i k_y \\hat{\\chi}\n       $$\n    d. 对 $\\hat{u}$ 和 $\\hat{v}$ 应用二维逆FFT，以在物理空间中获得全风场分量 $u$ 和 $v$。取逆变换的实部以消除由浮点不精确性产生的微小虚部分量。\n\n5.  **误差计算**：在整个网格上计算全风场 $\\boldsymbol{v}=(u,v)$ 和地转风 $\\boldsymbol{v}_g=(u_g,v_g)$ 之间的均方根（RMS）差异 $D$：\n    $$\n    D = \\left[ \\frac{1}{N_x N_y} \\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} \\left( (u_{i,j} - u_{g,i,j})^2 + (v_{i,j} - v_{g,i,j})^2 \\right) \\right]^{1/2}\n    $$\n    问题的构造使得 $\\boldsymbol{v}_g$ 正是全风场的旋转分量。因此，差值 $\\boldsymbol{v} - \\boldsymbol{v}_g$ 精确地是风场的无旋（辐散）分量 $\\boldsymbol{v}_\\chi$。计算出的值 $D$ 是这个辐散风分量的速度均方根。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares geostrophic and full wind fields on a doubly periodic domain.\n    \"\"\"\n\n    # --- Domain Parameters ---\n    Lx = 3.0e6  # m\n    Ly = 3.0e6  # m\n    Nx = 128\n    Ny = 96\n    f0 = 1.0e-4  # s^-1\n\n    # --- Test Cases ---\n    # (A_psi, m_psi_x, m_psi_y, A_chi, m_chi_x, m_chi_y)\n    test_cases = [\n        (1.0e6, 3, 2, 0.0, 0, 0),\n        (1.0e6, 3, 2, 5.0e5, 5, 4),\n        (0.0, 0, 0, 1.0e6, 4, 3),\n        (3.0e5, 20, 15, 3.0e5, 21, 16),\n    ]\n\n    # --- Grid and Wavenumber Setup ---\n    # Physical grid\n    x = (np.arange(Nx) / Nx) * Lx\n    y = (np.arange(Ny) / Ny) * Ly\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Wavenumber grids\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=Lx / Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=Ly / Ny)\n    KX, KY = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n\n    # Squared wavenumber magnitude for Laplacian operator\n    K2 = KX**2 + KY**2\n\n    # Handle singularity at k=0 for Poisson inversion\n    K2_inv = np.divide(1.0, K2, where=K2 != 0)\n    K2_inv[0, 0] = 0.0  # Set DC component to 0\n\n    results = []\n\n    for case in test_cases:\n        A_psi, m_psi_x, m_psi_y, A_chi, m_chi_x, m_chi_y = case\n\n        # --- 1. Define Analytic and Input Fields ---\n\n        # Wavenumbers for analytic fields\n        k_psi_x = 2 * np.pi * m_psi_x / Lx\n        k_psi_y = 2 * np.pi * m_psi_y / Ly\n        k_chi_x = 2 * np.pi * m_chi_x / Lx\n        k_chi_y = 2 * np.pi * m_chi_y / Ly\n\n        # Analytic streamfunction and velocity potential\n        psi_true = A_psi * np.cos(k_psi_x * X) * np.cos(k_psi_y * Y)\n        chi_true = A_chi * np.sin(k_chi_x * X) * np.cos(k_chi_y * Y)\n        \n        # Input fields for the inversion algorithms\n        # Geopotential\n        Phi = f0 * psi_true\n        \n        # Vorticity and Divergence (derived analytically from true fields)\n        zeta = -(k_psi_x**2 + k_psi_y**2) * psi_true\n        delta = -(k_chi_x**2 + k_chi_y**2) * chi_true\n\n        # --- 2. Compute Geostrophic Wind (v_g) ---\n\n        # FFT of geopotential\n        Phi_hat = np.fft.fftn(Phi)\n\n        # Derivatives in spectral space\n        dPhi_dx_hat = 1j * KX * Phi_hat\n        dPhi_dy_hat = 1j * KY * Phi_hat\n\n        # Inverse FFT to get derivatives in physical space\n        dPhi_dx = np.fft.ifftn(dPhi_dx_hat).real\n        dPhi_dy = np.fft.ifftn(dPhi_dy_hat).real\n\n        # Geostrophic wind components\n        u_g = (-1 / f0) * dPhi_dy\n        v_g = (1 / f0) * dPhi_dx\n\n        # --- 3. Compute Full Wind (v) ---\n\n        # FFT of vorticity and divergence\n        zeta_hat = np.fft.fftn(zeta)\n        delta_hat = np.fft.fftn(delta)\n\n        # Solve for potentials in spectral space (Poisson inversion)\n        psi_hat = -zeta_hat * K2_inv\n        chi_hat = -delta_hat * K2_inv\n        \n        # Ensure DC component is zero (mean potential is zero)\n        psi_hat[0, 0] = 0.0\n        chi_hat[0, 0] = 0.0\n\n        # Wind components in spectral space\n        u_hat = -1j * KY * psi_hat + 1j * KX * chi_hat\n        v_hat = 1j * KX * psi_hat + 1j * KY * chi_hat\n\n        # Inverse FFT to get wind components in physical space\n        u = np.fft.ifftn(u_hat).real\n        v = np.fft.ifftn(v_hat).real\n\n        # --- 4. Compute RMS Difference ---\n        \n        # Squared speed difference\n        diff_sq_speed = (u - u_g)**2 + (v - v_g)**2\n        \n        # Root-mean-square difference\n        D = np.sqrt(np.mean(diff_sq_speed))\n        \n        results.append(round(D, 6))\n\n    # --- Final Output ---\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "数值求解随时间演变的原始方程带来了巨大的挑战，尤其是在计算稳定性方面。本练习深入探讨了惯性重力波（系统中传播最快的波）时间步进格式的稳定性分析 ()。通过比较一个完全显式格式与一个更先进的半隐式格式，你将从根本上理解为何不同的数值策略对于构建高效且稳定的大气和海洋模式至关重要，因为这直接关系到模型所能使用的最大时间步长。",
            "id": "4078729",
            "problem": "考虑一个具有常数科里奥利参数 ($f$) 的平面上的线性化静力浅水原始方程，其平均深度为 $H$，重力加速度为 $g$，线性自由面位移为 $\\eta$。忽略平流、摩擦和非绝热源。令 $\\mathbf{u} = (u, v)$ 表示水平速度分量。控制方程为\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x}, \\quad\n\\frac{\\partial v}{\\partial t} + f u = - g \\frac{\\partial \\eta}{\\partial y}, \\quad\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0.\n$$\n假设一个双周期域，并分析一个具有波数 $k$ 和 $\\ell$、波数大小 $K = \\sqrt{k^{2} + \\ell^{2}}$、相位与 $\\exp\\!\\left(i(k x + \\ell y - \\omega t)\\right)$ 成正比的单个水平傅里叶模态。定义重力波速 $c = \\sqrt{g H}$。\n\n您将比较应用于此线性系统的惯性重力波标准模的两种时间离散化方案：\n\n$1.$ 应用于完整线性系统的完全显式蛙跳格式：\n$$\n\\mathbf{X}^{n+1} = \\mathbf{X}^{n-1} + 2 \\,\\Delta t \\, \\mathcal{L} \\,\\mathbf{X}^{n},\n$$\n其中 $\\mathbf{X}^{n} = (u^{n}, v^{n}, \\eta^{n})$，$\\mathcal{L}$ 是针对单个傅里叶模态的空间离散化系统的常系数线性算子。\n\n$2.$ 一种半隐式（SI）格式，其中重力波项（压强梯度和连续性耦合）使用 Crank–Nicolson 方法（该方法是二阶精度且时间中心的）进行时间离散化，而科里奥利项则保持显式蛙跳形式。也就是说，将 $\\mathcal{L} = \\mathcal{C} + \\mathcal{G}$ 分解为科里奥利部分 $\\mathcal{C}$ 和重力波部分 $\\mathcal{G}$，并进行时间步进，使得 $\\mathcal{G}$ 由 Crank-Nicolson 半隐式处理，而 $\\mathcal{C}$ 保留在蛙跳格式的右端项中。\n\n从第一性原理出发，不引用任何预先推导的目标公式，完成以下任务：\n\n$-$ 从线性化方程和傅里叶模态拟设出发，推导连续系统的惯性重力波色散关系 $\\omega$，用 $f$、$c$ 和 $K$ 表示。\n\n$-$ 对于完全显式蛙跳格式，对惯性重力波模态进行 von Neumann 标准模稳定性分析，并求得最大稳定时间步长 $\\Delta t_{\\mathrm{E,max}}$，将其表示为 $f$、$c$ 和 $K$ 的函数。\n\n$-$ 对于所述的半隐式格式，根据应用于线性斜对称算子的 Crank–Nicolson 方法的性质，以及对惯性振子的蛙跳格式稳定性分析，进行严格论证，以求得由剩余的显式快项所施加的最大稳定时间步长 $\\Delta t_{\\mathrm{SI,max}}$。\n\n最后，将您的比较表示为闭式比\n$$\nR = \\frac{\\Delta t_{\\mathrm{SI,max}}}{\\Delta t_{\\mathrm{E,max}}}\n$$\n，用 $f$、$c$ 和 $K$ 表示。您的最终答案必须是 $R$ 的单个解析表达式。不需要进行数值计算，也不允许四舍五入。由于 $R$ 是无量纲的，因此不需要物理单位。",
            "solution": "所述问题具有科学依据、是适定的、客观且自洽的。这是地球物理流体动力学数值方法分析中的一个标准练习，基于基本的线性化浅水方程。所有必要的定义、方程和参数均已提供，不存在内部矛盾或歧义。因此，有必要给出完整解答。\n\n解答过程遵循问题陈述中概述的任务序列。\n\n首先，我们推导连续系统中惯性重力波的色散关系。控制方程为：\n$$\n\\frac{\\partial u}{\\partial t} - f v = - g \\frac{\\partial \\eta}{\\partial x} \\quad (1)\n$$\n$$\n\\frac{\\partial v}{\\partial t} + f u = - g \\frac{\\partial \\eta}{\\partial y} \\quad (2)\n$$\n$$\n\\frac{\\partial \\eta}{\\partial t} + H\\left(\\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}\\right) = 0 \\quad (3)\n$$\n我们假设一个形式为 $(u, v, \\eta) = (\\hat{u}, \\hat{v}, \\hat{\\eta}) \\exp\\!\\left(i(k x + \\ell y - \\omega t)\\right)$ 的平面波解，其中 $(\\hat{u}, \\hat{v}, \\hat{\\eta})$ 是复数常振幅。在此拟设下，偏导数变为乘法：$\\frac{\\partial}{\\partial t} \\to -i\\omega$、$\\frac{\\partial}{\\partial x} \\to ik$ 和 $\\frac{\\partial}{\\partial y} \\to i\\ell$。将此代入方程 $(1)-(3)$，得到关于振幅的线性代数方程组：\n$$\n-i\\omega \\hat{u} - f \\hat{v} = - g (ik) \\hat{\\eta} \\quad (4)\n$$\n$$\n-i\\omega \\hat{v} + f \\hat{u} = - g (i\\ell) \\hat{\\eta} \\quad (5)\n$$\n$$\n-i\\omega \\hat{\\eta} + H\\left(ik \\hat{u} + i\\ell \\hat{v}\\right) = 0 \\quad (6)\n$$\n从方程 $(4)$ 和 $(5)$，我们求解以 $\\hat{\\eta}$ 表示的 $\\hat{u}$ 和 $\\hat{v}$：\n$$\n\\begin{pmatrix} -i\\omega  -f \\\\ f  -i\\omega \\end{pmatrix} \\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = ig\\hat{\\eta} \\begin{pmatrix} k \\\\ \\ell \\end{pmatrix}\n$$\n该 $2 \\times 2$ 矩阵的行列式为 $(-i\\omega)^2 - (-f)(f) = f^2 - \\omega^2$。假设 $\\omega^2 \\neq f^2$，我们可以对该矩阵求逆以求得：\n$$\n\\begin{pmatrix} \\hat{u} \\\\ \\hat{v} \\end{pmatrix} = \\frac{1}{f^2 - \\omega^2} \\begin{pmatrix} -i\\omega  f \\\\ -f  -i\\omega \\end{pmatrix} ig\\hat{\\eta} \\begin{pmatrix} k \\\\ \\ell \\end{pmatrix} = \\frac{ig}{f^2 - \\omega^2} \\begin{pmatrix} -i\\omega k + f\\ell \\\\ -fk -i\\omega\\ell \\end{pmatrix} \\hat{\\eta}\n$$\n因此，我们有：\n$$\n\\hat{u} = \\frac{g( \\omega k + if\\ell )}{f^2 - \\omega^2} \\hat{\\eta} \\quad (7)\n$$\n$$\n\\hat{v} = \\frac{g( \\omega \\ell - ifk )}{f^2 - \\omega^2} \\hat{\\eta} \\quad (8)\n$$\n现在，将 $\\hat{u}$ 和 $\\hat{v}$ 的这些表达式代入方程 $(6)$：\n$$\n-i\\omega \\hat{\\eta} + iH \\left( k \\frac{g(\\omega k + if\\ell)}{f^2 - \\omega^2} \\hat{\\eta} + \\ell \\frac{g(\\omega \\ell - ifk)}{f^2 - \\omega^2} \\hat{\\eta} \\right) = 0\n$$\n假设存在非平凡解（$\\hat{\\eta} \\neq 0$），我们可以两边同除以 $i\\hat{\\eta}$：\n$$\n-\\omega + \\frac{gH}{f^2 - \\omega^2} \\left[ k(\\omega k + if\\ell) + \\ell(\\omega \\ell - ifk) \\right] = 0\n$$\n$$\n-\\omega + \\frac{gH}{f^2 - \\omega^2} \\left[ \\omega k^2 + ifk\\ell + \\omega \\ell^2 - ifk\\ell \\right] = 0\n$$\n$$\n-\\omega + \\frac{gH}{f^2 - \\omega^2} \\left[ \\omega (k^2 + \\ell^2) \\right] = 0\n$$\n该方程存在一个解 $\\omega=0$，对应于定常地转模。对于惯性重力波，我们假设 $\\omega \\neq 0$ 并两边同除以 $\\omega$：\n$$\n-1 + \\frac{gH(k^2 + \\ell^2)}{f^2 - \\omega^2} = 0\n$$\n使用定义 $K^2 = k^2 + \\ell^2$ 和 $c^2 = gH$，上式简化为：\n$$\nf^2 - \\omega^2 = c^2 K^2\n$$\n这就得出了惯性重力波的色散关系：\n$$\n\\omega^2 = f^2 + c^2 K^2\n$$\n惯性重力波模态的频率为 $\\omega = \\pm \\sqrt{f^2 + c^2 K^2}$。\n\n其次，我们分析完全显式蛙跳格式的稳定性。该格式由 $\\mathbf{X}^{n+1} = \\mathbf{X}^{n-1} + 2 \\Delta t \\mathcal{L} \\mathbf{X}^{n}$ 给出。对于线性系统，此格式的稳定性由算子 $\\mathcal{L}$ 的特征值决定。连续系统为 $\\frac{d\\mathbf{X}}{dt} = \\mathcal{L}\\mathbf{X}$。与平面波的时间依赖性 $e^{-i\\omega t}$ 比较，我们看到 $\\mathcal{L}$ 的特征值为 $\\mu = -i\\omega$，其中 $\\omega$ 是连续系统的特征频率。因此，$\\mathcal{L}$ 的特征值是纯虚数：$\\mu_j = -i\\omega_j$。\n对于蛙跳格式，我们寻找一个放大因子 $\\lambda$，使得 $\\mathbf{X}^n = \\lambda^n \\mathbf{X}^0$。将此代入单个模态的格式中，得到 $\\lambda^2 \\mathbf{X}^0 = \\mathbf{X}^0 + 2 \\Delta t \\mu \\lambda \\mathbf{X}^0$，从而导出 $\\lambda$ 的特征方程：\n$$\n\\lambda^2 - 2\\Delta t \\mu \\lambda - 1 = 0\n$$\n$\\lambda$ 的解为 $\\lambda = \\Delta t \\mu \\pm \\sqrt{(\\Delta t \\mu)^2 + 1}$。为保证稳定性，我们要求所有模态的 $|\\lambda| \\leq 1$。代入 $\\mu = -i\\omega$：\n$$\n\\lambda = -i\\omega\\Delta t \\pm \\sqrt{1 - (\\omega\\Delta t)^2}\n$$\n如果 $|\\omega\\Delta t| \\leq 1$，则 $1 - (\\omega\\Delta t)^2 \\ge 0$，平方根下的项为实数。此时 $\\lambda$ 的模为 $|\\lambda|^2 = (-\\omega\\Delta t)^2 + (1 - (\\omega\\Delta t)^2) = 1$。该格式是中性稳定的。如果 $|\\omega\\Delta t|  1$，平方根下的项为虚数，产生一个模大于 1 的根，这会导致指数增长和不稳定性。\n因此，稳定性条件是对于系统中存在的所有频率 $\\omega$，都有 $|\\omega\\Delta t| \\leq 1$。最大允许时间步长受最高频率的限制：\n$$\n\\Delta t \\leq \\frac{1}{\\max|\\omega|}\n$$\n对于完整的惯性重力系统，最高频率的大小为 $\\max|\\omega| = \\sqrt{f^2 + c^2 K^2}$。因此，完全显式格式的最大稳定时间步长为：\n$$\n\\Delta t_{\\mathrm{E,max}} = \\frac{1}{\\sqrt{f^2 + c^2 K^2}}\n$$\n\n第三，我们分析半隐式格式的稳定性。线性算子 $\\mathcal{L}$ 被分解为科里奥利部分 $\\mathcal{C}$ 和重力波部分 $\\mathcal{G}$。该格式为：\n$$\n\\frac{\\mathbf{X}^{n+1} - \\mathbf{X}^{n-1}}{2\\Delta t} = \\mathcal{C}\\mathbf{X}^n + \\mathcal{G}\\frac{\\mathbf{X}^{n+1} + \\mathbf{X}^{n-1}}{2}\n$$\n包含 $\\mathcal{G}$ 的项使用 Crank-Nicolson 方法进行隐式处理（该方法是时间中心的，与蛙跳格式相匹配）。重力波算子 $\\mathcal{G}$ 的特征值是纯虚数，$\\mu_{\\mathcal{G}} = 0, \\pm i c K$。应用于具有纯虚数特征值的算子的 Crank-Nicolson 格式是无条件稳定的；对于任何时间步长 $\\Delta t$，其放大因子的模都恰好为 1。因此，对重力波项的隐式处理不对此时间步长施加稳定性限制。\n因此，整个半隐式格式的稳定性受到计算中显式部分的限制，即对科里奥利项 $\\mathcal{C}\\mathbf{X}^n$ 的蛙跳处理。我们必须分析应用于系统 $\\frac{d\\mathbf{X}}{dt} = \\mathcal{C}\\mathbf{X}$ 的蛙跳格式的稳定性。这描述了惯性振荡。该系统的频率 $\\omega_{\\mathcal{C}}$ 由 $-i\\mathcal{C}$ 的特征值给出。傅里叶模态的算子 $\\mathcal{C}$ 为：\n$$\n\\mathcal{C} = \\begin{pmatrix} 0  f  0 \\\\ -f  0  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\n其特征方程为 $\\det(\\mathcal{C} - \\mu I) = -\\mu(\\mu^2 + f^2) = 0$，给出特征值 $\\mu_{\\mathcal{C}} = 0, \\pm if$。对应的频率为 $\\omega_{\\mathcal{C}} = 0, \\pm f$。\n这个显式部分的蛙跳格式稳定性条件是 $\\Delta t \\leq \\frac{1}{\\max|\\omega_{\\mathcal{C}}|}$。由于 $\\max|\\omega_{\\mathcal{C}}| = |f|$，稳定性判据变为：\n$$\n\\Delta t |f| \\leq 1\n$$\n因此，半隐式格式的最大稳定时间步长由科里奥利频率决定：\n$$\n\\Delta t_{\\mathrm{SI,max}} = \\frac{1}{|f|}\n$$\n\n最后，我们计算比率 $R = \\Delta t_{\\mathrm{SI,max}} / \\Delta t_{\\mathrm{E,max}}$。\n$$\nR = \\frac{1/|f|}{1/\\sqrt{f^2 + c^2 K^2}} = \\frac{\\sqrt{f^2 + c^2 K^2}}{|f|}\n$$\n由于 $|f|^2 = f^2$，我们可以将其写为：\n$$\nR = \\sqrt{\\frac{f^2 + c^2 K^2}{f^2}} = \\sqrt{1 + \\frac{c^2 K^2}{f^2}}\n$$\n这个比率量化了半隐式格式的计算优势，当重力波速 $c$ 或波数 $K$ 相对于惯性频率 $f$ 较大时，该格式允许使用大得多的时间步长。",
            "answer": "$$\n\\boxed{\\sqrt{1 + \\frac{c^{2}K^{2}}{f^{2}}}}\n$$"
        }
    ]
}