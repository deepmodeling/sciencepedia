{
    "hands_on_practices": [
        {
            "introduction": "大气科学中的许多计算都始于准确描述一个气块的热力学状态。本练习将引导你应用理想气体定律和道尔顿分压定律等基本原理，计算包含水汽的湿空气气块的关键属性。通过这个实践，你将掌握从基本观测量（如总压、温度和水汽混合比）推导出混合气体常数、分压和总密度的核心技能 。",
            "id": "4039100",
            "problem": "一个大气模式网格单元的特征为：测得的总压 $p = 1000\\,\\mathrm{hPa}$，绝对温度 $T = 298\\,\\mathrm{K}$，以及水汽混合比 $r = 0.02$（单位质量干空气中的水汽质量）。假设干空气和水汽表现为理想气体，并形成一个不存在液态水的理想混合物。从每种组分 $i$（干空气、水汽）的理想气体定律 $p_i = \\rho_i R_i T$、道尔顿分压定律以及混合比 $r$ 的定义出发，推导计算混合物比气体常数 $R_m$、水汽分压 $e$、干空气分压 $p_d$ 和混合物总密度 $\\rho$ 所需的表达式。使用干空气和水汽的标准比气体常数，$R_d = 287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 和 $R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。将 $R_m$ 以 $\\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 为单位表示，$e$ 和 $p_d$ 以 $\\mathrm{hPa}$ 为单位表示，$\\rho$ 以 $\\mathrm{kg\\,m^{-3}}$ 为单位表示。将每个最终量四舍五入到四位有效数字。为计算 $\\rho$，将压力转换为国际单位制（SI）基本单位 $\\mathrm{Pa}$，以与 $R_m$ 和 $T$ 的单位保持一致。",
            "solution": "该问题陈述经核实具有科学依据、提法恰当且客观。它基于热力学基本原理，提供了一套完整且一致的已知条件、假设和要求输出。因此，有必要给出完整解答。\n\n该问题要求推导并计算一个湿空气块的四个量：混合物比气体常数 $R_m$、水汽分压 $e$、干空气分压 $p_d$ 和混合物总密度 $\\rho$。\n\n给定的参数是：\n总压，$p = 1000\\,\\mathrm{hPa}$\n绝对温度，$T = 298\\,\\mathrm{K}$\n水汽混合比，$r = 0.02$\n干空气比气体常数，$R_d = 287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n水汽比气体常数，$R_v = 461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$\n\n这个问题的基础在于三个原理：每种组分的理想气体定律、道尔顿分压定律以及混合比的定义。\n\n干空气的理想气体定律是：\n$$p_d = \\rho_d R_d T$$\n其中 $p_d$ 是干空气的分压，$\\rho_d$ 是其密度。\n\n水汽的理想气体定律是：\n$$e = \\rho_v R_v T$$\n其中 $e$ 是水汽的分压（常用符号，而非 $p_v$），$\\rho_v$ 是其密度。\n\n道尔顿定律指出，总压是分压之和：\n$$p = p_d + e$$\n\n混合比 $r$ 定义为水汽质量 $m_v$ 与干空气质量 $m_d$ 之比。这等价于它们的密度之比：\n$$r = \\frac{m_v}{m_d} = \\frac{\\rho_v V}{\\rho_d V} = \\frac{\\rho_v}{\\rho_d}$$\n\n首先，我们推导分压 $p_d$ 和 $e$ 的表达式。我们可以从它们各自的气体定律中表达密度 $\\rho_d$ 和 $\\rho_v$：\n$$\\rho_d = \\frac{p_d}{R_d T} \\quad \\text{和} \\quad \\rho_v = \\frac{e}{R_v T}$$\n将这些代入混合比 $r$ 的定义中：\n$$r = \\frac{e / (R_v T)}{p_d / (R_d T)} = \\frac{e}{p_d} \\frac{R_d}{R_v}$$\n我们定义气体常数之比为 $\\epsilon = \\frac{R_d}{R_v}$。这是一个无量纲常数。\n$$r = \\frac{e}{p_d} \\epsilon \\implies e = p_d \\frac{r}{\\epsilon}$$\n现在我们得到一个关于两个未知数 $p_d$ 和 $e$ 的二元线性方程组：\n$$p = p_d + e$$\n$$e = p_d \\frac{r}{\\epsilon}$$\n将第二个方程代入第一个方程：\n$$p = p_d + p_d \\frac{r}{\\epsilon} = p_d \\left(1 + \\frac{r}{\\epsilon}\\right) = p_d \\left(\\frac{\\epsilon + r}{\\epsilon}\\right)$$\n求解 $p_d$：\n$$p_d = p \\left(\\frac{\\epsilon}{\\epsilon + r}\\right)$$\n现在，我们可以用 $e = p - p_d$ 求出 $e$：\n$$e = p - p \\left(\\frac{\\epsilon}{\\epsilon + r}\\right) = p \\left(1 - \\frac{\\epsilon}{\\epsilon + r}\\right) = p \\left(\\frac{\\epsilon + r - \\epsilon}{\\epsilon + r}\\right)$$\n$$e = p \\left(\\frac{r}{\\epsilon + r}\\right)$$\n\n接下来，我们推导混合物比气体常数 $R_m$ 的表达式。整个湿空气混合物的状态方程是 $p = \\rho R_m T$，其中 $\\rho = \\rho_d + \\rho_v$ 是总密度。常数 $R_m$ 是各个气体常数的质量加权平均值：\n$$R_m = \\frac{m_d R_d + m_v R_v}{m_d + m_v}$$\n将分子和分母同时除以干空气的质量 $m_d$：\n$$R_m = \\frac{R_d + (m_v/m_d) R_v}{1 + m_v/m_d}$$\n代入混合比的定义 $r = m_v/m_d$：\n$$R_m = \\frac{R_d + r R_v}{1 + r}$$\n\n最后，混合物的总密度 $\\rho$ 直接从混合物的理想气体定律推导得出：\n$$p = \\rho R_m T \\implies \\rho = \\frac{p}{R_m T}$$\n\n现在我们可以计算数值了。\n首先，计算常数 $\\epsilon$：\n$$\\epsilon = \\frac{R_d}{R_v} = \\frac{287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}}{461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}} \\approx 0.62200$$\n使用给定值 $p = 1000\\,\\mathrm{hPa}$ 和 $r = 0.02$：\n水汽分压 $e$ 为：\n$$e = (1000\\,\\mathrm{hPa}) \\left(\\frac{0.02}{0.62200 + 0.02}\\right) = (1000\\,\\mathrm{hPa}) \\left(\\frac{0.02}{0.64200}\\right) \\approx 31.1526\\,\\mathrm{hPa}$$\n四舍五入到四位有效数字，$e = 31.15\\,\\mathrm{hPa}$。\n\n干空气分压 $p_d$ 为：\n$$p_d = p - e = 1000\\,\\mathrm{hPa} - 31.1526\\,\\mathrm{hPa} = 968.8474\\,\\mathrm{hPa}$$\n四舍五入到四位有效数字，$p_d = 968.8\\,\\mathrm{hPa}$。\n\n混合物比气体常数 $R_m$ 为：\n$$R_m = \\frac{287.05\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}} + (0.02)(461.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}})}{1 + 0.02} = \\frac{287.05 + 9.23}{1.02}\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}} = \\frac{296.28}{1.02}\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}} \\approx 290.4706\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$$\n四舍五入到四位有效数字，$R_m = 290.5\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n\n混合物总密度 $\\rho$ 使用国际单位制基本单位计算。我们必须将压力从 hPa 转换为 Pa：$p = 1000\\,\\mathrm{hPa} = 1000 \\times 100\\,\\mathrm{Pa} = 100000\\,\\mathrm{Pa} = 10^5\\,\\mathrm{Pa}$。\n使用未四舍五入的 $R_m$ 值：\n$$\\rho = \\frac{100000\\,\\mathrm{Pa}}{(290.4706\\,\\mathrm{J\\,kg^{-1}\\,K^{-1}})(298\\,\\mathrm{K})} \\approx \\frac{100000}{86560.24}\\,\\mathrm{kg\\,m^{-3}} \\approx 1.15526\\,\\mathrm{kg\\,m^{-3}}$$\n四舍五入到四位有效数字，$\\rho = 1.155\\,\\mathrm{kg\\,m^{-3}}$。\n\n按要求的顺序（$R_m$、$e$、$p_d$、$\\rho$）并将结果四舍五入到四位有效数字的最终计算量为：$290.5$、$31.15$、$968.8$ 和 $1.155$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n290.5  31.15  968.8  1.155\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "真实的数值天气预报模型必须处理包含液态水和冰等多相态的大气。这个练习模拟了模型网格中的一个实际情景，要求你区分气相（干空气和水汽）与凝结相（液滴和冰晶）的贡献。通过计算包含所有相态的总密度，并验证只有气相成分才对压力有贡献，你将深入理解在复杂的多相系统中如何正确应用状态方程 。",
            "id": "4039097",
            "problem": "考虑一个数值天气预报和气候模拟系统中的单个网格模型层，该系统将大气视为由干空气、水汽、液态水和冰组成的多组分混合物。状态方程 (EOS) 指的是决定气相压力的热力学变量之间的关系。假设气态组分表现为理想气体，并且凝结相在模型时间尺度上是不可压缩的。物质 $k$ 的质量混合比 $q_k$ 定义为物质 $k$ 的质量与单位质量湿空气的质量之比，干空气的质量分数满足 $q_d = 1 - q_v - q_l - q_i$。分质量密度满足 $\\rho_k = q_k \\rho$，其中 $\\rho$ 是总湿空气密度。\n\n给定以下模型层状态：\n- 压力 $p = 8.50 \\times 10^{4}$ $\\mathrm{Pa}$，\n- 温度 $T = 278$ $\\mathrm{K}$，\n- 质量混合比 $q_v = 0.012$，$q_l = 0.001$ 和 $q_i = 0.0002$。\n\n使用以下经过充分检验的理想气体常数：\n- 干空气比气体常数 $R_d = 287.05$ $\\mathrm{J \\, kg^{-1} \\, K^{-1}}$，\n- 水汽比气体常数 $R_v = 461.5$ $\\mathrm{J \\, kg^{-1} \\, K^{-1}}$。\n\n从理想气体混合物的基本定义和定律（道尔顿分压定律和适用于每种气态组分的理想气体定律）出发，推导出总湿空气密度 $\\rho$，计算分密度 $\\rho_g$（气相，即干空气加水汽）、$\\rho_l$（液相）和 $\\rho_i$（冰相），然后验证仅在状态方程中使用气相密度是否能再现给定的压力 $p$。报告气相密度 $\\rho_g$ 的数值，单位为 $\\mathrm{kg \\, m^{-3}}$，并将您的答案四舍五入到四位有效数字。",
            "solution": "对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n-   总压力：$p = 8.50 \\times 10^{4}$ $\\mathrm{Pa}$\n-   温度：$T = 278$ $\\mathrm{K}$\n-   水汽的质量混合比：$q_v = 0.012$\n-   液态水的质量混合比：$q_l = 0.001$\n-   冰的质量混合比：$q_i = 0.0002$\n-   干空气的比气体常数：$R_d = 287.05$ $\\mathrm{J \\, kg^{-1} \\, K^{-1}}$\n-   水汽的比气体常数：$R_v = 461.5$ $\\mathrm{J \\, kg^{-1} \\, K^{-1}}$\n-   干空气质量分数的定义：$q_d = 1 - q_v - q_l - q_i$\n-   分质量密度的定义：$\\rho_k = q_k \\rho$\n-   假设：干空气和水汽表现为理想气体。\n-   假设：凝结相（液态水、冰）是不可压缩的，且其蒸气压可忽略不计。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于大气热力学的基本原理，特别是湿空气的状态方程，这是数值天气预报和气候模拟的基石。所作假设在此背景下是标准且恰当的。提供的物理数值是符合实际的。\n2.  **提法恰当**：问题陈述清晰，提供了推导所求量唯一解所需的所有数据和定义。\n3.  **客观性**：问题以精确、无偏见和定量的语言表述。\n\n### 步骤3：结论与行动\n该问题在科学上是合理的，提法恰当且客观。它没有违反任何无效标准。因此，该问题是**有效的**。下面将推导解答。\n\n推导从支配理想气体混合物的基本原理开始。气相的总压力 $p$ 由道尔顿定律确定，该定律指出总压力是组分气体分压之和。在此系统中，气态组分是干空气和水汽。\n\n$$p = p_d + p_v$$\n\n其中 $p_d$ 是干空气的分压，$p_v$ 是水汽的分压。假设凝结相（液态水和冰）的蒸气压可忽略不计，对总压力 $p$ 没有贡献。\n\n根据理想气体定律，每种气态物质 $k$ 的分压由下式给出：\n\n$$p_k = \\rho_k R_k T$$\n\n其中 $\\rho_k$ 是分质量密度（单位混合物体积中物质 $k$ 的质量），$R_k$ 是其比气体常数，$T$ 是绝对温度。将此应用于干空气和水汽，我们有：\n\n$$p_d = \\rho_d R_d T$$\n$$p_v = \\rho_v R_v T$$\n\n将这些代入道尔顿定律，得到以分密度表示的气体混合物状态方程：\n\n$$p = \\rho_d R_d T + \\rho_v R_v T$$\n\n问题根据总湿空气密度 $\\rho$（包括所有相：气相、液相、冰相）和质量混合比 $q_k$ 来定义分质量密度 $\\rho_k$。\n\n$$\\rho_k = q_k \\rho$$\n\n将 $\\rho_d$ 和 $\\rho_v$ 的这些定义代入压力方程，得到：\n\n$$p = (q_d \\rho) R_d T + (q_v \\rho) R_v T$$\n\n这可以重新整理，以关联总压力 $p$ 和总湿空气密度 $\\rho$：\n\n$$p = \\rho T (q_d R_d + q_v R_v)$$\n\n这个方程可以反解，以求出总湿空气密度 $\\rho$：\n\n$$\\rho = \\frac{p}{T (q_d R_d + q_v R_v)}$$\n\n为了进行数值计算，我们首先使用给定的混合比确定干空气的质量分数 $q_d$：\n\n$$q_d = 1 - q_v - q_l - q_i = 1 - 0.012 - 0.001 - 0.0002 = 0.9868$$\n\n接下来，我们计算 $\\rho$ 表达式中分母的项：\n\n$$q_d R_d + q_v R_v = (0.9868)(287.05 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}}) + (0.012)(461.5 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}})$$\n$$q_d R_d + q_v R_v = 283.25334 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}} + 5.538 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}} = 288.79134 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}}$$\n\n现在，我们可以计算总湿空气密度 $\\rho$：\n\n$$\\rho = \\frac{8.50 \\times 10^4 \\, \\mathrm{Pa}}{(278 \\, \\mathrm{K})(288.79134 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}})} = \\frac{8.50 \\times 10^4}{80284.00252} \\, \\mathrm{kg \\, m^{-3}} \\approx 1.058742 \\, \\mathrm{kg \\, m^{-3}}$$\n\n问题要求计算气相密度 $\\rho_g$。气相由干空气和水汽组成。气相的总密度是其组分分密度之和：\n\n$$\\rho_g = \\rho_d + \\rho_v$$\n\n使用定义 $\\rho_k = q_k \\rho$，我们可以写出：\n\n$$\\rho_g = q_d \\rho + q_v \\rho = (q_d + q_v)\\rho$$\n\n我们首先计算气相质量分数的总和：\n\n$$q_d + q_v = 0.9868 + 0.012 = 0.9988$$\n\n现在我们计算气相密度 $\\rho_g$：\n\n$$\\rho_g = (0.9988)(1.058742 \\, \\mathrm{kg \\, m^{-3}}) \\approx 1.057476 \\, \\mathrm{kg \\, m^{-3}}$$\n\n问题还要求验证仅在状态方程中使用气相密度是否能再现给定的压力 $p$。这可以通过为气相组分单独构建一个状态方程来证明。气体混合物的状态方程可以写成 $p = \\rho_g R_m T$，其中 $R_m$ 是干空气和水汽混合物的比气体常数。$R_m$ 是单个气体常数的质量加权平均值：\n\n$$R_m = \\frac{M_d R_d + M_v R_v}{M_d + M_v} = \\frac{q_d M R_d + q_v M R_v}{q_d M + q_v M} = \\frac{q_d R_d + q_v R_v}{q_d + q_v}$$\n\n通过将 $\\rho_g = \\rho (q_d + q_v)$ 和 $R_m$ 的表达式代入 $p = \\rho_g R_m T$，我们得到：\n\n$$p = \\left[ \\rho (q_d + q_v) \\right] \\left[ \\frac{q_d R_d + q_v R_v}{q_d + q_v} \\right] T$$\n$$p = \\rho T (q_d R_d + q_v R_v)$$\n\n这与我们推导 $\\rho$ 所用的方程相同。这证实了压力完全由气相组分决定，形式为 $p = \\rho_g R_m T$ 的状态方程与基本定律完全一致。使用计算出的值：\n\n$$R_m = \\frac{288.79134}{0.9988} \\approx 289.1381 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}}$$\n$$p = (1.057476 \\, \\mathrm{kg \\, m^{-3}})(289.1381 \\, \\mathrm{J \\, kg^{-1} \\, K^{-1}})(278 \\, \\mathrm{K}) \\approx 8.50 \\times 10^4 \\, \\mathrm{Pa}$$\n\n这验证了整个框架。最后的任务是报告气相密度 $\\rho_g$ 的数值，并四舍五入到四位有效数字。\n\n$$\\rho_g \\approx 1.057476 \\, \\mathrm{kg \\, m^{-3}}$$\n\n四舍五入到四位有效数字得到 $1.057$。\n液态水和冰的分密度分别为 $\\rho_l = q_l \\rho \\approx 0.001059 \\, \\mathrm{kg \\, m^{-3}}$ 和 $\\rho_i = q_i \\rho \\approx 0.000212 \\, \\mathrm{kg \\, m^{-3}}$。这些密度与 $\\rho_g$ 一起，总和为总密度 $\\rho$。",
            "answer": "$$\\boxed{1.057}$$"
        },
        {
            "introduction": "将物理方程转化为可靠的计算机代码是数值建模的核心挑战。本练习要求你设计并实施一个验证程序，以确保状态方程在模型不同模块间的内在一致性。通过执行一系列“闭环”计算——即从一组变量出发，经过一系列转换后应能精确返回初始值——你将学会如何量化和最小化数值误差，这是确保复杂天气和气候模型长期稳定性和准确性的关键一步 。",
            "id": "4039084",
            "problem": "设计并实现一个独立的程序，用于在数值天气预报中，验证代表热力学、微物理和动力学的抽象模型模块间的状态方程（EOS）的内部一致性。必须通过在状态变量压强 $p$、温度 $T$、比湿 $q$（单位质量湿空气中水汽的质量）、密度 $\\rho$ 和比内能 $e$ 之间形成闭环来检验其一致性。假设以下基本理论基础，您必须在所有推导和计算中使用它们：\n\n1. 湿空气的理想气体混合物模型：\n   - 干空气的比气体常数为 $R_d$，水汽的比气体常数为 $R_v$。\n   - 单位质量湿空气的混合物比气体常数为\n     $$R_m(q) = (1 - q) R_d + q R_v.$$\n   - 混合物的理想气体定律为\n     $$p = \\rho \\, R_m(q) \\, T.$$\n\n2. 对于定容比热为常数且与温度无关的双组分理想气体混合物（干空气和水汽），其比内能为：\n   - 设 $c_{pd}$ 和 $c_{pv}$ 分别为干空气和水汽的定压比热。\n   - 定义 $c_{vd} = c_{pd} - R_d$ 和 $c_{vv} = c_{pv} - R_v$。\n   - 以两组分在 $T = 0$ K 时的内能为零点，混合物的比内能（单位质量湿空气）为\n     $$e(T, q) = \\big((1 - q) c_{vd} + q c_{vv}\\big) \\, T.$$\n   - 因此，其反算公式 $T(e, q)$ 为\n     $$T(e, q) = \\frac{e}{(1 - q) c_{vd} + q c_{vv}}.$$\n\n使用以下数值常数：\n- $R_d = 287.05$ J kg$^{-1}$ K$^{-1}$，\n- $R_v = 461.5$ J kg$^{-1}$ K$^{-1}$，\n- $c_{pd} = 1004.7$ J kg$^{-1}$ K$^{-1}$，\n- $c_{pv} = 1870.0$ J kg$^{-1}$ K$^{-1}$。\n\n所有物理量必须使用以下单位处理：\n- $p$ 单位为帕斯卡 (Pa)，\n- $T$ 单位为开尔文 (K)，\n- $q$ 单位为千克每千克 (kg kg$^{-1}$)，\n- $\\rho$ 单位为千克每立方米 (kg m$^{-3}$)，\n- $e$ 单位为焦耳每千克 (J kg$^{-1}$)。\n\n为每个测试用例实现的闭环一致性检验：\n- 环路 A（热力学-微物理）：$T \\rightarrow e \\rightarrow T$。根据 $T$ 和 $q$ 计算 $e$，然后反算以恢复 $T$，并报告相对误差\n  $$\\varepsilon_A = \\frac{|T_{\\text{out}} - T_{\\text{in}}|}{T_{\\text{in}}}.$$\n- 环路 B（动力学-EOS）：$(p, T, q) \\rightarrow \\rho \\rightarrow p$。使用理想气体定律根据 $p$、$T$、$q$ 计算 $\\rho$，然后根据 $\\rho$、$T$、$q$ 重新计算 $p$，并报告\n  $$\\varepsilon_B = \\frac{|p_{\\text{out}} - p_{\\text{in}}|}{p_{\\text{in}}}.$$\n- 环路 C（跨模块：热力学 + 动力学）：$(p, e, q) \\rightarrow T \\rightarrow \\rho \\rightarrow p$。根据 $e$、$q$ 计算 $T$，然后根据 $p$、$T$、$q$ 计算 $\\rho$，再根据 $\\rho$、$T$、$q$ 计算 $p$，并报告\n  $$\\varepsilon_C = \\frac{|p_{\\text{out}} - p_{\\text{in}}|}{p_{\\text{in}}}.$$\n- 环路 D（动力学-EOS 反向配对）：$(\\rho, T, q) \\rightarrow p \\rightarrow \\rho$。根据 $\\rho$、$T$、$q$ 计算 $p$，然后根据 $p$、$T$、$q$ 重新计算 $\\rho$，并报告\n  $$\\varepsilon_D = \\frac{|\\rho_{\\text{out}} - \\rho_{\\text{in}}|}{\\rho_{\\text{in}}}.$$\n- 环路 E（通过 $p$ 和 $e$ 的组合一致性）：$(p, \\rho, q) \\rightarrow T \\rightarrow e \\rightarrow T$。通过理想气体定律根据 $p$、$\\rho$、$q$ 计算 $T$，然后根据 $T$、$q$ 计算 $e$，再反算 $e$ 和 $q$ 以恢复 $T$，并报告\n  $$\\varepsilon_E = \\frac{|T_{\\text{out}} - T_{\\text{in}}|}{T_{\\text{in}}}.$$\n\n对每个测试用例，定义最大环路误差\n$$\\varepsilon_{\\max} = \\max\\{\\varepsilon_A, \\varepsilon_B, \\varepsilon_C, \\varepsilon_D, \\varepsilon_E\\}.$$\n\n您的程序必须为以下每个测试用例计算 $\\varepsilon_{\\max}$，这些用例涵盖了大气条件的典型范围和边缘情况：\n- 用例 1：$(p, T, q) = (100000,\\; 300,\\; 0.01)$，\n- 用例 2：$(p, T, q) = (80000,\\; 250,\\; 0)$，\n- 用例 3：$(p, T, q) = (95000,\\; 305,\\; 0.03)$，\n- 用例 4：$(p, T, q) = (30000,\\; 220,\\; 0.001)$，\n- 用例 5：$(p, T, q) = (10000,\\; 260,\\; 0.02)$，\n- 用例 6：$(p, T, q) = (101325,\\; 273.15,\\; 0.0075)$。\n\n所有输入必须以上述指定单位进行解释。输出是无量纲的相对误差。您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的浮点数列表，其顺序与上面列出的用例相同，例如，“[x1,x2,x3,x4,x5,x6]”。",
            "solution": "该问题要求设计并实现一个程序，以验证用于数值天气预报和气候模型的简化湿空气状态方程（EOS）的内部一致性。此验证通过在主要热力学状态变量之间执行一系列闭环计算，并量化由此产生的数值误差来完成。该问题基于大气热力学的坚实原理，且问题陈述清晰，提供了所有必要的方程、常数和程序。\n\n**控制方程和常数**\n湿空气的状态由压强 $p$、温度 $T$、密度 $\\rho$、比湿 $q$（水汽的质量分数）和比内能 $e$ 描述。这些变量之间的关系由理想气体混合物模型定义。\n\n湿空气混合物的比气体常数 $R_m$ 是干空气的比气体常数 $R_d$ 和水汽的比气体常数 $R_v$ 的质量加权平均值：\n$$R_m(q) = (1 - q) R_d + q R_v$$\n湿空气的理想气体定律将压强、密度和温度联系起来：\n$$p = \\rho \\, R_m(q) \\, T$$\n比内能 $e$ 是为定容比热恒定的理想气体混合物定义的。给定干空气的定压比热 $c_{pd}$ 和水汽的定压比热 $c_{pv}$，我们首先使用理想气体的迈耶关系（Mayer's relation）推导出定容比热：\n$$c_{vd} = c_{pd} - R_d$$\n$$c_{vv} = c_{pv} - R_v$$\n相对于 $T=0$ K 的零点，混合物的比内能（每单位质量的湿空气）是各组分内能的质量加权平均值：\n$$e(T, q) = \\big((1 - q) c_{vd} + q c_{vv}\\big) \\, T$$\n该方程可以反算，以求得作为内能和比湿函数的温度：\n$$T(e, q) = \\frac{e}{(1 - q) c_{vd} + q c_{vv}}$$\n\n提供了物理常数的数值，并且必须在所有计算中使用：\n- $R_d = 287.05$ J kg$^{-1}$ K$^{-1}$\n- $R_v = 461.5$ J kg$^{-1}$ K$^{-1}$\n- $c_{pd} = 1004.7$ J kg$^{-1}$ K$^{-1}$\n- $c_{pv} = 1870.0$ J kg$^{-1}$ K$^{-1}$\n\n由此，我们计算出派生常数：\n- $c_{vd} = 1004.7 - 287.05 = 717.65$ J kg$^{-1}$ K$^{-1}$\n- $c_{vv} = 1870.0 - 461.5 = 1408.5$ J kg$^{-1}$ K$^{-1}$\n\n**闭环一致性分析**\n任务的核心是验证这些方程在数值上是否一致。这是通过执行闭环计算来完成的，理论上，最终计算出的变量应与其初始值相同。任何偏差都是数值浮点误差的度量。对于每个由初始状态 $(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$ 定义的测试用例，我们评估五个这样的环路。一些环路需要 $(p, T, q)$ 元组中未直接提供的初始变量；这些变量必须从初始状态计算得出。\n\n**环路 A：$T \\rightarrow e \\rightarrow T$**\n该环路检查温度和内能之间的正向和反向关系。\n1. 给定初始温度 $T_{\\text{in}}$ 和比湿 $q_{\\text{in}}$。\n2. 计算比内能：$e_{\\text{out}} = \\big((1 - q_{\\text{in}}) c_{vd} + q_{\\text{in}} c_{vv}\\big) \\, T_{\\text{in}}$。\n3. 从该能量重新计算温度：$T_{\\text{out}} = \\frac{e_{\\text{out}}}{(1 - q_{\\text{in}}) c_{vd} + q_{\\text{in}} c_{vv}} = \\frac{\\big((1 - q_{\\text{in}}) c_{vd} + q_{\\text{in}} c_{vv}\\big) \\, T_{\\text{in}}}{(1 - q_{\\text{in}}) c_{vd} + q_{\\text{in}} c_{vv}} = T_{\\text{in}}$。\n代数上，$T_{\\text{out}} = T_{\\text{in}}$。相对误差为 $\\varepsilon_A = |T_{\\text{out}} - T_{\\text{in}}| / T_{\\text{in}}$。\n\n**环路 B：$(p, T, q) \\rightarrow \\rho \\rightarrow p$**\n该环路检查理想气体定律的一致性。\n1. 给定 $(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$。\n2. 计算密度：$\\rho_{\\text{out}} = \\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) \\, T_{\\text{in}}}$。\n3. 重新计算压强：$p_{\\text{out}} = \\rho_{\\text{out}} \\, R_m(q_{\\text{in}}) \\, T_{\\text{in}} = \\left(\\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) \\, T_{\\text{in}}}\\right) R_m(q_{\\text{in}}) \\, T_{\\text{in}} = p_{\\text{in}}$。\n代数上，$p_{\\text{out}} = p_{\\text{in}}$。相对误差为 $\\varepsilon_B = |p_{\\text{out}} - p_{\\text{in}}| / p_{\\text{in}}$。\n\n**环路 C：$(p, e, q) \\rightarrow T \\rightarrow \\rho \\rightarrow p$**\n该环路结合了热力学和动力学关系。测试用例提供了 $(p, T, q)$，因此我们必须首先计算初始能量 $e$。\n1. 给定状态 $(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$。\n2. 计算初始能量：$e_{\\text{loop}} = e(T_{\\text{in}}, q_{\\text{in}})$。\n3. 环路从 $(p_{\\text{in}}, e_{\\text{loop}}, q_{\\text{in}})$ 开始。\n4. 计算温度：$T_{\\text{out1}} = T(e_{\\text{loop}}, q_{\\text{in}}) = T(e(T_{\\text{in}}, q_{\\text{in}}), q_{\\text{in}}) = T_{\\text{in}}$。\n5. 计算密度：$\\rho_{\\text{out}} = \\rho(p_{\\text{in}}, T_{\\text{out1}}, q_{\\text{in}}) = \\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) T_{\\text{in}}}$。\n6. 重新计算压强：$p_{\\text{out}} = p(\\rho_{\\text{out}}, T_{\\text{out1}}, q_{\\text{in}}) = \\rho_{\\text{out}} R_m(q_{\\text{in}}) T_{\\text{in}} = p_{\\text{in}}$。\n代数上，$p_{\\text{out}} = p_{\\text{in}}$。相对误差为 $\\varepsilon_C = |p_{\\text{out}} - p_{\\text{in}}| / p_{\\text{in}}$。\n\n**环路 D：$(\\rho, T, q) \\rightarrow p \\rightarrow \\rho$**\n该环路是从密度开始对理想气体定律的另一次检验。\n1. 给定状态 $(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$。\n2. 计算初始密度：$\\rho_{\\text{in\\_loop}} = \\rho(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}}) = \\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) T_{\\text{in}}}$。\n3. 环路从 $(\\rho_{\\text{in\\_loop}}, T_{\\text{in}}, q_{\\text{in}})$ 开始。\n4. 计算压强：$p_{\\text{out1}} = p(\\rho_{\\text{in\\_loop}}, T_{\\text{in}}, q_{\\text{in}}) = \\rho_{\\text{in\\_loop}} R_m(q_{\\text{in}}) T_{\\text{in}} = p_{\\text{in}}$。\n5. 重新计算密度：$\\rho_{\\text{out}} = \\rho(p_{\\text{out1}}, T_{\\text{in}}, q_{\\text{in}}) = \\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) T_{\\text{in}}} = \\rho_{\\text{in\\_loop}}$。\n代数上，$\\rho_{\\text{out}} = \\rho_{\\text{in\\_loop}}$。相对误差为 $\\varepsilon_D = |\\rho_{\\text{out}} - \\rho_{\\text{in\\_loop}}| / \\rho_{\\text{in\\_loop}}$。\n\n**环路 E：$(p, \\rho, q) \\rightarrow T \\rightarrow e \\rightarrow T$**\n该环路通过所有状态变量提供了一个全面的检验。\n1. 给定状态 $(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$。\n2. 计算初始密度：$\\rho_{\\text{in\\_loop}} = \\rho(p_{\\text{in}}, T_{\\text{in}}, q_{\\text{in}})$。\n3. 环路从 $(p_{\\text{in}}, \\rho_{\\text{in\\_loop}}, q_{\\text{in}})$ 开始。误差的参考温度是 $T_{\\text{in}}$。\n4. 计算温度：$T_{\\text{out1}} = T(p_{\\text{in}}, \\rho_{\\text{in\\_loop}}, q_{\\text{in}}) = \\frac{p_{\\text{in}}}{\\rho_{\\text{in\\_loop}} R_m(q_{\\text{in}})} = \\frac{p_{\\text{in}}}{(\\frac{p_{\\text{in}}}{R_m(q_{\\text{in}}) T_{\\text{in}}}) R_m(q_{\\text{in}})} = T_{\\text{in}}$。\n5. 计算能量：$e_{\\text{out}} = e(T_{\\text{out1}}, q_{\\text{in}}) = e(T_{\\text{in}}, q_{\\text{in}})$。\n6. 从能量重新计算温度：$T_{\\text{out}} = T(e_{\\text{out}}, q_{\\text{in}}) = T(e(T_{\\text{in}}, q_{\\text{in}}), q_{\\text{in}}) = T_{\\text{in}}$。\n代数上，$T_{\\text{out}} = T_{\\text{in}}$。相对误差为 $\\varepsilon_E = |T_{\\text{out}} - T_{\\text{in}}| / T_{\\text{in}}$。\n\n**实现计划**\n实现将精确遵循以下步骤。将构建一个 Python 程序以：\n1. 定义所有主要和派生的物理常数。\n2. 创建一组函数，每个函数对应一个物理方程，以确保清晰性和可重用性。例如，`get_e_from_T_q(T, q)`、`get_rho_from_p_T_q(p, T, q)` 等。\n3. 遍历提供的六个测试用例中的每一个。\n4. 对每个用例，执行上面概述的五个验证环路，计算相对误差 $\\varepsilon_A, \\varepsilon_B, \\varepsilon_C, \\varepsilon_D, \\varepsilon_E$。\n5. 确定该用例的最大误差 $\\varepsilon_{\\max} = \\max\\{\\varepsilon_A, \\varepsilon_B, \\varepsilon_C, \\varepsilon_D, \\varepsilon_E\\}$。由于使用标准的双精度浮点运算，这些误差预计在机器精度（$\\approx 10^{-16}$）的量级。\n6. 收集所有用例的 $\\varepsilon_{\\max}$ 值，并以指定的逗号分隔格式打印它们。\n这种系统化的方法确保了数值实现正确反映了代数模型，并为其自洽性提供了定量度量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum loop error for a set of test cases to validate\n    the internal consistency of an equation of state for moist air.\n    \"\"\"\n\n    # Define physical constants as per the problem statement.\n    # All units are SI.\n    R_d = 287.05  # J kg^-1 K^-1 (specific gas constant for dry air)\n    R_v = 461.5   # J kg^-1 K^-1 (specific gas constant for water vapor)\n    c_pd = 1004.7 # J kg^-1 K^-1 (specific heat at constant pressure for dry air)\n    c_pv = 1870.0 # J kg^-1 K^-1 (specific heat at constant pressure for water vapor)\n\n    # Derive specific heats at constant volume using Mayer's relation.\n    c_vd = c_pd - R_d\n    c_vv = c_pv - R_v\n\n    def get_Rm(q):\n        \"\"\"Computes mixture specific gas constant R_m.\"\"\"\n        return (1.0 - q) * R_d + q * R_v\n    \n    def get_cvm(q):\n        \"\"\"Computes mixture specific heat at constant volume c_vm.\"\"\"\n        return (1.0 - q) * c_vd + q * c_vv\n\n    # --- Core state functions derived from the EOS ---\n\n    def get_e_from_T_q(T, q):\n        \"\"\"Computes specific internal energy e from T and q.\"\"\"\n        return get_cvm(q) * T\n\n    def get_T_from_e_q(e, q):\n        \"\"\"Computes temperature T from e and q.\"\"\"\n        cvm = get_cvm(q)\n        # Avoid division by zero, though not expected for valid q.\n        if cvm == 0:\n            return 0.0\n        return e / cvm\n\n    def get_rho_from_p_T_q(p, T, q):\n        \"\"\"Computes density rho from p, T, and q.\"\"\"\n        Rm = get_Rm(q)\n        # Avoid division by zero for T or Rm.\n        if T == 0 or Rm == 0:\n            return np.inf\n        return p / (Rm * T)\n\n    def get_p_from_rho_T_q(rho, T, q):\n        \"\"\"Computes pressure p from rho, T, and q.\"\"\"\n        return rho * get_Rm(q) * T\n\n    def get_T_from_p_rho_q(p, rho, q):\n        \"\"\"Computes temperature T from p, rho, and q.\"\"\"\n        Rm = get_Rm(q)\n        # Avoid division by zero.\n        if rho == 0 or Rm == 0:\n            return np.inf\n        return p / (rho * Rm)\n\n    # --- Test Cases ---\n    test_cases = [\n        # (p in Pa, T in K, q in kg/kg)\n        (100000.0, 300.0, 0.01),\n        (80000.0, 250.0, 0.0),\n        (95000.0, 305.0, 0.03),\n        (30000.0, 220.0, 0.001),\n        (10000.0, 260.0, 0.02),\n        (101325.0, 273.15, 0.0075),\n    ]\n\n    results = []\n    for case in test_cases:\n        p_in, T_in, q_in = case\n        \n        errors = []\n\n        # Loop A: T -> e -> T\n        e_tmp = get_e_from_T_q(T_in, q_in)\n        T_out_A = get_T_from_e_q(e_tmp, q_in)\n        err_A = abs(T_out_A - T_in) / T_in if T_in != 0 else 0.0\n        errors.append(err_A)\n\n        # Loop B: (p, T, q) -> rho -> p\n        rho_tmp = get_rho_from_p_T_q(p_in, T_in, q_in)\n        p_out_B = get_p_from_rho_T_q(rho_tmp, T_in, q_in)\n        err_B = abs(p_out_B - p_in) / p_in if p_in != 0 else 0.0\n        errors.append(err_B)\n\n        # Loop C: (p, e, q) -> T -> rho -> p\n        e_loop_in = get_e_from_T_q(T_in, q_in)\n        T_tmp_C = get_T_from_e_q(e_loop_in, q_in)\n        rho_tmp_C = get_rho_from_p_T_q(p_in, T_tmp_C, q_in)\n        p_out_C = get_p_from_rho_T_q(rho_tmp_C, T_tmp_C, q_in)\n        err_C = abs(p_out_C - p_in) / p_in if p_in != 0 else 0.0\n        errors.append(err_C)\n        \n        # Loop D: (rho, T, q) -> p -> rho\n        rho_in_loop = get_rho_from_p_T_q(p_in, T_in, q_in)\n        p_tmp_D = get_p_from_rho_T_q(rho_in_loop, T_in, q_in)\n        rho_out_D = get_p_from_rho_T_q(p_tmp_D, T_in, q_in)\n        err_D = abs(rho_out_D - rho_in_loop) / rho_in_loop if rho_in_loop != 0 else 0.0\n        errors.append(err_D)\n        \n        # Loop E: (p, rho, q) -> T -> e -> T\n        rho_in_loop_E = get_rho_from_p_T_q(p_in, T_in, q_in)\n        T_tmp1_E = get_T_from_p_rho_q(p_in, rho_in_loop_E, q_in)\n        e_tmp_E = get_e_from_T_q(T_tmp1_E, q_in)\n        T_out_E = get_T_from_e_q(e_tmp_E, q_in)\n        err_E = abs(T_out_E - T_in) / T_in if T_in != 0 else 0.0\n        errors.append(err_E)\n\n        # Find the maximum error for the current case\n        max_error = max(errors) if errors else 0.0\n        results.append(max_error)\n\n    # Format the final output string as required.\n    # The default string representation of floats is sufficient.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}