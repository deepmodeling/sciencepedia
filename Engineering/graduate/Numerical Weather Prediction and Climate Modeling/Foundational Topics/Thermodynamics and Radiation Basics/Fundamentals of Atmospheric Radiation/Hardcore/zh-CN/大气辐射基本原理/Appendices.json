{
    "hands_on_practices": [
        {
            "introduction": "求解辐射传输方程（RTE）是理解大气辐射的基石。第一个实践将引导你推导在一个简化的、但至关重要的情景（一个只吸收和发射能量的大气）下的解析解，为你提供基础性经验。通过解决这个问题，你将具体理解入射辐射如何被衰减，以及大气本身如何通过热发射对辐射场做出贡献。",
            "id": "4046874",
            "problem": "考虑一个均匀且等温的平行平面大气层，其性质在固定频率 $\\nu$ 下依赖于频率。该大气层是无散射的，因此吸收和热发射是仅有的辐射过程。设体吸收系数为 $\\alpha_{\\nu}$，温度为 $T$，二者均与深度无关。该大气层使用垂直光学深度坐标 $\\tau_{\\nu}$ 进行描述，该坐标从顶边界 $\\tau_{\\nu} = 0$ 处开始向下增加。\n\n假设满足局域热力学平衡 (LTE)，因此源函数 $S_{\\nu}$ 等于普朗克函数 $B_{\\nu}(T)$，从而相对于 $\\tau_{\\nu}$ 是一个常数。设 $\\mu$ 表示射线方向与垂直方向之间夹角的余弦，对于向下传播的辐射，定义 $0 < \\mu \\leq 1$ 为正。由沿射线的吸收和发射的基本平衡，可得到用垂直光学深度坐标表示的一维稳态辐射传输方程。\n\n在顶边界 $\\tau_{\\nu} = 0$ 处，对于向下方向，入射的单色比强度被指定为 $I_{\\nu}(0, \\mu > 0) = I_{\\nu}^{0}$，这是一个与 $\\tau_{\\nu}$ 无关的常数。请从第一性原理出发，且不使用任何预先推导的简化结果，推导在 $0 < \\mu \\leq 1$ 和 $0 \\leq \\tau_{\\nu} < \\infty$ 条件下单色比强度 $I_{\\nu}(\\tau_{\\nu}, \\mu)$ 的解析表达式，该表达式需用 $\\tau_{\\nu}$、$\\mu$、$I_{\\nu}^{0}$ 和 $B_{\\nu}(T)$ 明确表示。\n\n你的最终答案必须是关于 $I_{\\nu}(\\tau_{\\nu}, \\mu)$ 的单个闭式表达式，用给定的物理量表示。无需进行四舍五入，最终表达式中不应包含单位。",
            "solution": "问题陈述经过严格验证，确认有效。这是一个来自大气辐射领域的、适定的、有科学依据的问题，使用了标准模型和术语。陈述中没有矛盾、歧义或事实错误。\n\n将按照要求，从第一性原理出发推导解答。\n\n控制单色比强度 $I_{\\nu}$ 沿路径长度 $s$ 变化的根本原理是辐射传输方程 (RTE)。在一个吸收和热发射辐射但无散射的介质中，沿路径元 $ds$ 的变化 $dI_{\\nu}$ 由发射增益和吸收损失之间的平衡给出：\n$$\n\\frac{dI_{\\nu}}{ds} = j_{\\nu} - \\alpha_{\\nu} I_{\\nu}\n$$\n此处，$j_{\\nu}$ 是体发射系数，$\\alpha_{\\nu}$ 是体吸收系数。问题陈述中说明了局域热力学平衡 (LTE) 成立。在 LTE 条件下，根据基尔霍夫定律，发射系数与吸收系数和普朗克函数 $B_{\\nu}(T)$ 的关系为：$j_{\\nu} = \\alpha_{\\nu} B_{\\nu}(T)$。源函数 $S_{\\nu}$ 定义为 $S_{\\nu} = j_{\\nu}/\\alpha_{\\nu}$，在 LTE 条件下变为 $S_{\\nu} = B_{\\nu}(T)$。\n将此代入 RTE，得到：\n$$\n\\frac{dI_{\\nu}}{ds} = \\alpha_{\\nu} B_{\\nu}(T) - \\alpha_{\\nu} I_{\\nu} = \\alpha_{\\nu} (B_{\\nu}(T) - I_{\\nu})\n$$\n问题设定在平行平面几何结构中。我们定义一个垂直坐标 $z$，其在大气层顶部为零并向下增加。光学深度 $\\tau_{\\nu}$ 是相对于此垂直坐标定义的，从大气顶部（$z=0$）的 $\\tau_{\\nu} = 0$ 处开始向下增加。其微分关系为 $d\\tau_{\\nu} = \\alpha_{\\nu} dz$。由于问题陈述 $\\alpha_{\\nu}$ 是常数，积分可得 $\\tau_{\\nu} = \\alpha_{\\nu} z$。\n\n变量 $\\mu$ 是射线方向与垂直方向之间夹角的余弦。对于向下传播的辐射（$0 < \\mu \\leq 1$），该角度是相对于向下的垂直方向测量的。路径元 $ds$ 和垂直位移 $dz$ 之间的几何关系是 $dz = \\mu ds$，这意味着 $ds = \\frac{dz}{\\mu}$。\n\n我们现在将 RTE 从关于 $s$ 的函数变换为关于 $\\tau_{\\nu}$ 的函数。\n$$\n\\frac{dI_{\\nu}}{ds} = \\frac{dI_{\\nu}}{dz} \\frac{dz}{ds} = \\frac{dI_{\\nu}}{dz} \\mu\n$$\n将此与 RTE 的物理形式相等：\n$$\n\\mu \\frac{dI_{\\nu}}{dz} = \\alpha_{\\nu} (B_{\\nu}(T) - I_{\\nu})\n$$\n接下来，我们使用链式法则和定义 $d\\tau_{\\nu} = \\alpha_{\\nu} dz$ 将自变量从 $z$ 变为 $\\tau_{\\nu}$：\n$$\n\\frac{dI_{\\nu}}{dz} = \\frac{dI_{\\nu}}{d\\tau_{\\nu}} \\frac{d\\tau_{\\nu}}{dz} = \\frac{dI_{\\nu}}{d\\tau_{\\nu}} \\alpha_{\\nu}\n$$\n将此代入 $z$ 坐标系下的 RTE：\n$$\n\\mu \\left( \\alpha_{\\nu} \\frac{dI_{\\nu}}{d\\tau_{\\nu}} \\right) = \\alpha_{\\nu} (B_{\\nu}(T) - I_{\\nu})\n$$\n由于 $\\alpha_{\\nu}$ 是吸收系数，它不为零，所以我们可以用它来除：\n$$\n\\mu \\frac{dI_{\\nu}}{d\\tau_{\\nu}} = B_{\\nu}(T) - I_{\\nu}\n$$\n这就是在平行平面大气中，针对向下辐射，用垂直光学深度表示的一维稳态辐射传输方程。问题陈述中提到温度 $T$ 是恒定的，因此普朗克函数 $B_{\\nu}(T)$ 相对于 $\\tau_{\\nu}$ 也是常数。为了在推导过程中简化记法，我们将 $I_{\\nu}(\\tau_{\\nu}, \\mu)$ 记为 $I_{\\nu}$，将 $B_{\\nu}(T)$ 记为 $B_{\\nu}$。\n\n该方程可以整理成一阶线性常微分方程的标准形式：\n$$\n\\frac{dI_{\\nu}}{d\\tau_{\\nu}} + \\frac{1}{\\mu} I_{\\nu} = \\frac{B_{\\nu}}{\\mu}\n$$\n我们使用积分因子法来解这个方程。积分因子 $P(\\tau_{\\nu})$ 是：\n$$\nP(\\tau_{\\nu}) = \\exp\\left( \\int \\frac{1}{\\mu} d\\tau_{\\nu} \\right) = \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right)\n$$\n将微分方程两边乘以积分因子：\n$$\n\\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) \\frac{dI_{\\nu}}{d\\tau_{\\nu}} + \\frac{1}{\\mu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) I_{\\nu} = \\frac{B_{\\nu}}{\\mu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right)\n$$\n方程的左边是 $I_{\\nu}$ 和积分因子乘积的导数：\n$$\n\\frac{d}{d\\tau_{\\nu}} \\left( I_{\\nu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) \\right) = \\frac{B_{\\nu}}{\\mu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right)\n$$\n我们将此方程从顶边界 $\\tau'_{\\nu} = 0$ 积分到任意深度 $\\tau'_{\\nu} = \\tau_{\\nu}$：\n$$\n\\int_{0}^{\\tau_{\\nu}} \\frac{d}{d\\tau'_{\\nu}} \\left( I_{\\nu}(\\tau'_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau'_{\\nu}}{\\mu}\\right) \\right) d\\tau'_{\\nu} = \\int_{0}^{\\tau_{\\nu}} \\frac{B_{\\nu}}{\\mu} \\exp\\left(\\frac{\\tau'_{\\nu}}{\\mu}\\right) d\\tau'_{\\nu}\n$$\n计算积分：\n根据微积分基本定理，左边为：\n$$\n\\left[ I_{\\nu}(\\tau'_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau'_{\\nu}}{\\mu}\\right) \\right]_{0}^{\\tau_{\\nu}} = I_{\\nu}(\\tau_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - I_{\\nu}(0, \\mu) \\exp(0) = I_{\\nu}(\\tau_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - I_{\\nu}(0, \\mu)\n$$\n右边，由于 $B_{\\nu}$ 和 $\\mu$ 相对于 $\\tau'_{\\nu}$ 是常数，所以是：\n$$\n\\frac{B_{\\nu}}{\\mu} \\int_{0}^{\\tau_{\\nu}} \\exp\\left(\\frac{\\tau'_{\\nu}}{\\mu}\\right) d\\tau'_{\\nu} = \\frac{B_{\\nu}}{\\mu} \\left[ \\mu \\exp\\left(\\frac{\\tau'_{\\nu}}{\\mu}\\right) \\right]_{0}^{\\tau_{\\nu}} = B_{\\nu} \\left( \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - \\exp(0) \\right) = B_{\\nu} \\left( \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - 1 \\right)\n$$\n令两边的结果相等：\n$$\nI_{\\nu}(\\tau_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - I_{\\nu}(0, \\mu) = B_{\\nu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - B_{\\nu}\n$$\n现在，我们求解 $I_{\\nu}(\\tau_{\\nu}, \\mu)$：\n$$\nI_{\\nu}(\\tau_{\\nu}, \\mu) \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) = I_{\\nu}(0, \\mu) + B_{\\nu} \\exp\\left(\\frac{\\tau_{\\nu}}{\\mu}\\right) - B_{\\nu}\n$$\n将整个方程乘以 $\\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right)$：\n$$\nI_{\\nu}(\\tau_{\\nu}, \\mu) = I_{\\nu}(0, \\mu) \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right) + B_{\\nu} - B_{\\nu} \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right)\n$$\n问题指定了大气顶部（$\\tau_{\\nu}=0$）的边界条件为 $I_{\\nu}(0, \\mu > 0) = I_{\\nu}^{0}$。将此代入方程并重新整理，得到在任意光学深度 $\\tau_{\\nu}$ 处的比强度的最终表达式：\n$$\nI_{\\nu}(\\tau_{\\nu}, \\mu) = I_{\\nu}^{0} \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right) + B_{\\nu}(T) \\left(1 - \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right)\\right)\n$$\n这就是形式解。第一项表示来自顶边界的入射辐射，沿斜路径根据比尔定律被大气层衰减。第二项表示大气层本身沿射线方向发射的热辐射。",
            "answer": "$$\n\\boxed{I_{\\nu}(\\tau_{\\nu}, \\mu) = I_{\\nu}^{0} \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right) + B_{\\nu}(T) \\left(1 - \\exp\\left(-\\frac{\\tau_{\\nu}}{\\mu}\\right)\\right)}\n$$"
        },
        {
            "introduction": "在理解光谱比辐射强度（$I_\\nu$）的基础上，下一步是理解净能量流，即通量（$F_\\nu$）。这个实践练习将连接起具有方向性的强度和用于计算大气加热率的积分量——通量。通过一个简单的线性强度模型计算净垂直通量，你将探索角各向异性在驱动净辐射传输中的基本作用。",
            "id": "4046924",
            "problem": "在数值天气预报和气候模拟中使用的平面平行、方位对称的大气层中，考虑频率为 $\\nu$ 的谱比辐射强度 $I_{\\nu}(\\mu)$，其中 $\\mu=\\cos\\theta$，$\\theta$ 是从当地向上法线测量的天顶角。假设 $I_{\\nu}$ 是定常的，并且仅依赖于 $\\mu$，且它允许最低阶非平凡角向表示\n$$\nI_{\\nu}(\\mu)=a+b\\,\\mu,\n$$\n其中 $a$ 和 $b$ 是在给定频率 $\\nu$ 下的常数（不依赖于 $\\mu$），其单位为比辐射强度单位 $\\mathrm{W\\, m^{-2}\\, Hz^{-1}\\, sr^{-1}}$。取向上方向为正，因此 $\\mu>0$ 对应于向上-传播的辐射。\n\n严格地从谱比辐射强度的定义和净垂直谱通量作为比辐射强度在整个立体角上的一阶角矩的定义出发，\n$$\nF_{\\nu}=\\int_{4\\pi} \\mu\\, I_{\\nu}\\, d\\Omega,\n$$\n利用所述的对称性，推导出 $F_{\\nu}$ 关于 $a$ 和 $b$ 的显式闭合形式表达式。然后从物理角度解释你结果的数学结构：指出 $I_{\\nu}$ 的哪个（些）分量对净垂直谱通量有贡献，并参考潜在的角向对称性解释原因。同时，将你的系数与双流闭合中使用的经典角矩联系起来。\n\n用单位 $\\mathrm{W\\, m^{-2}\\, Hz^{-1}}$ 表示你的最终通量。不需要进行数值计算或四舍五入；仅提供一个用 $a$ 和 $b$ 表示的闭合形式表达式。",
            "solution": "谱比辐射强度 $I_{\\nu}(\\mathbf{\\Omega})$ 的定义是：在时间 $dt$ 内，频率间隔 $d\\nu$ 内，沿方向 $\\mathbf{\\Omega}$ 周围的立体角元 $d\\Omega$ 传播，穿过面积元 $dA$ 的辐射能量为 $I_{\\nu}(\\mathbf{\\Omega}) \\cos\\theta\\, dA\\, dt\\, d\\nu\\, d\\Omega$，其中 $\\theta$ 是 $\\mathbf{\\Omega}$ 与向上单位法线之间的夹角。净垂直谱通量 $F_{\\nu}$ 是 $I_{\\nu}$ 在所有立体角上的方向一阶矩，由下式给出：\n$$\nF_{\\nu}=\\int_{4\\pi} \\mu\\, I_{\\nu}\\, d\\Omega,\n$$\n其中 $\\mu=\\cos\\theta$。在平面平行、方位对称的介质中，$I_{\\nu}$ 仅依赖于 $\\mu$ 而不依赖于方位角 $\\phi$，因此 $d\\Omega=d\\phi\\, d\\mu$，方位角积分可以分离出来，结果为 $2\\pi$。因此，\n$$\nF_{\\nu}=\\int_{0}^{2\\pi} d\\phi \\int_{-1}^{1} \\mu\\, I_{\\nu}(\\mu)\\, d\\mu \\;=\\; 2\\pi \\int_{-1}^{1} \\mu\\, I_{\\nu}(\\mu)\\, d\\mu.\n$$\n利用给定的角向依赖关系 $I_{\\nu}(\\mu)=a+b\\,\\mu$，上式变为\n$$\nF_{\\nu}=2\\pi \\int_{-1}^{1} \\mu \\big(a+b\\,\\mu\\big)\\, d\\mu \\;=\\; 2\\pi \\left[a \\int_{-1}^{1} \\mu\\, d\\mu \\;+\\; b \\int_{-1}^{1} \\mu^{2}\\, d\\mu \\right].\n$$\n第一个积分是\n$$\n\\int_{-1}^{1} \\mu\\, d\\mu \\;=\\; \\left.\\frac{\\mu^{2}}{2}\\right|_{-1}^{1} \\;=\\; \\frac{1}{2}-\\frac{1}{2}\\;=\\;0,\n$$\n第二个积分是\n$$\n\\int_{-1}^{1} \\mu^{2}\\, d\\mu \\;=\\; \\left.\\frac{\\mu^{3}}{3}\\right|_{-1}^{1} \\;=\\; \\frac{1}{3}-\\left(-\\frac{1}{3}\\right)\\;=\\;\\frac{2}{3}.\n$$\n因此，\n$$\nF_{\\nu}=2\\pi \\left[a \\cdot 0 + b \\cdot \\frac{2}{3}\\right]\\;=\\;\\frac{4\\pi}{3}\\, b.\n$$\n\n解释。系数 $a$ 乘以辐射强度的各向同性分量。它对 $F_{\\nu}$ 的贡献为零，因为这部分的被积函数与 $\\mu$ 成正比，而 $\\mu$ 在 $\\mu\\in[-1,1]$ 区间上是反对称的；向上和向下的方向正好相互抵消。系数 $b$ 乘以 $\\mu$ 的一阶（偶极）各向异性，只有这个分量才能产生非零的净垂直谱通量。因此，净通量与 $b$ 所体现的前后不对称程度成正比。\n\n与角矩和闭合的关系。定义标准角矩\n$$\nJ_{\\nu} \\equiv \\frac{1}{4\\pi}\\int_{4\\pi} I_{\\nu}\\, d\\Omega,\\qquad H_{\\nu} \\equiv \\frac{1}{4\\pi}\\int_{4\\pi} \\mu\\, I_{\\nu}\\, d\\Omega=\\frac{F_{\\nu}}{4\\pi},\\qquad K_{\\nu} \\equiv \\frac{1}{4\\pi}\\int_{4\\pi} \\mu^{2} I_{\\nu}\\, d\\Omega.\n$$\n对于 $I_{\\nu}(\\mu)=a+b\\,\\mu$ 和方位对称性，\n$$\nJ_{\\nu}=\\frac{1}{2}\\int_{-1}^{1} (a+b\\,\\mu)\\, d\\mu = a,\\qquad H_{\\nu}=\\frac{1}{2}\\int_{-1}^{1} \\mu (a+b\\,\\mu)\\, d\\mu = \\frac{b}{3},\\qquad K_{\\nu}=\\frac{1}{2}\\int_{-1}^{1} \\mu^{2} (a+b\\,\\mu)\\, d\\mu = \\frac{a}{3}.\n$$\n因此 $F_{\\nu}=4\\pi H_{\\nu}=\\frac{4\\pi}{3} b$，并且爱丁顿因子 $f\\equiv K_{\\nu}/J_{\\nu}=\\frac{1}{3}$，这与经典的爱丁顿闭合一致。从物理上看，$a$ 是平均辐射强度，而 $b$ 控制净通量，并与一阶角矩直接相关。\n\n量纲分析。由于 $b$ 的单位是比辐射强度单位 $\\mathrm{W\\, m^{-2}\\, Hz^{-1}\\, sr^{-1}}$，而立体角积分贡献了一个 $\\mathrm{sr}$ 的因子，因此结果 $F_{\\nu}=(4\\pi/3)b$ 的单位是 $\\mathrm{W\\, m^{-2}\\, Hz^{-1}}$，符合要求。",
            "answer": "$$\\boxed{\\frac{4\\pi}{3}\\,b}$$"
        },
        {
            "introduction": "虽然单色计算是基础，但真实的大气模型必须处理宽光谱带的辐射，在这些波段上吸收系数变化剧烈。这个高级实践介绍了强大的 k 分布方法，这是现代辐射传输方案的基石，它简化了这种复杂性。通过实现该方法，你将学习如何将复杂的光谱问题转化为更易于处理的形式，这是高效、准确地进行气候和天气预报模型计算的一项关键技术。",
            "id": "4046881",
            "problem": "给定一个光谱带，其包含一个由索引 $i$ 标记的离散点有限集。每个点对应一个频率（或波数）$\\nu_i$，具有单色质量吸收系数 $\\kappa_{\\nu_i}$（单位为 $\\mathrm{m^2\\,kg^{-1}}$）和一个非负权重 $w_i$。该权重描述了 $\\nu_i$ 对谱带平均值的贡献分数（例如，普朗克权重或均匀权重）。设总质量路径为 $u$，单位为 $\\mathrm{kg\\,m^{-2}}$。从第一性原理出发，构建该谱带上的累积 $k$ 分布。具体方法是，通过将集合 $\\{\\kappa_{\\nu_i}\\}$ 按非递减顺序排序，将频率空间 $\\nu$ 映射到 $k$ 空间，并将累积变量 $g \\in [0,1]$ 定义为排序后归一化权重的累积和。使用此构造，通过在累积 $k$ 空间上进行数值积分，来评估指定 $u$ 值下的谱带透过率。在你的解法中，解释相关 $k$ 假设以及重排序有效的条件。\n\n你的推导应基于比尔-朗伯定律（该定律指出单色透过率为 $T_\\nu(u) = \\exp\\!\\left(-\\kappa_\\nu u\\right)$）以及使用归一化权重函数的谱带平均定义。不要使用任何直接给出谱带透过率的简化公式；相反，应论证从 $\\nu$ 到 $g$ 的变量替换的合理性，并展示如何使用离散 $k$ 分布表示来计算关于 $g$ 的积分。\n\n程序实现细节：\n- 给定数组 $\\boldsymbol{\\kappa} = [\\kappa_{\\nu_1},\\ldots,\\kappa_{\\nu_N}]$ 和 $\\boldsymbol{w} = [w_1,\\ldots,w_N]$，其中 $\\sum_{i=1}^N w_i = 1$。按 $\\kappa_{\\nu_i}$ 的非递减顺序对数据对 $(\\kappa_{\\nu_i}, w_i)$ 进行排序（使用稳定排序以保持相同值之间的原有顺序）。\n- 构建累积权重 $g_0 = 0$，$g_i = \\sum_{j=1}^i w_{(j)}$（其中 $i=1,\\ldots,N$，$w_{(j)}$ 是排序后的权重）。将每个区间 $[g_{i-1}, g_i]$ 与一个分段常数 $k(g) = \\kappa_{(i)}$ 相关联。\n- 根据以下积分定义的谱带透过率 $T_B(u)$\n$$\nT_B(u) = \\int_0^1 \\exp\\!\\left(-k(g)\\,u\\right)\\, \\mathrm{d}g\n$$\n通过一个与上述分段常数 $k(g)$ 一致的精确离散表示，使用所提供的 $(\\kappa_{(i)}, w_{(i)})$ 片段来计算。\n\n单位与输出：\n- $\\kappa_{\\nu_i}$ 必须以 $\\mathrm{m^2\\,kg^{-1}}$ 为单位处理。\n- $u$ 必须以 $\\mathrm{kg\\,m^{-2}}$ 为单位处理。\n- $T_B(u)$ 是无量纲的。\n- 对于每个指定的测试用例，计算在 $u = 0$，$u = 0.1$ 和 $u = 2.0$（均以 $\\mathrm{kg\\,m^{-2}}$ 为单位）时的 $T_B(u)$，并将每个结果四舍五入到六位小数。\n\n测试套件：\n- 用例 1（非均匀权重，非单调 $\\kappa_{\\nu}$）：\n  - $\\boldsymbol{\\kappa} = [0.01, 0.5, 2.0, 0.1, 1.0, 0.2]$，单位为 $\\mathrm{m^2\\,kg^{-1}}$。\n  - $\\boldsymbol{w} = [0.1, 0.2, 0.05, 0.25, 0.3, 0.1]$，其中 $\\sum_i w_i = 1$。\n- 用例 2（存在相同值和一个光学上非常强的点）：\n  - $\\boldsymbol{\\kappa} = [0.0, 0.0, 0.3, 0.3, 5.0]$，单位为 $\\mathrm{m^2\\,kg^{-1}}$。\n  - $\\boldsymbol{w} = [0.2, 0.2, 0.2, 0.2, 0.2]$，其中 $\\sum_i w_i = 1$。\n- 用例 3（极端对比度，弱谱线权重较大）：\n  - $\\boldsymbol{\\kappa} = [10.0, 0.0001, 3.0, 8.0, 0.0001]$，单位为 $\\mathrm{m^2\\,kg^{-1}}$。\n  - $\\boldsymbol{w} = [0.05, 0.45, 0.1, 0.05, 0.35]$，其中 $\\sum_i w_i = 1$。\n\n你的程序应生成单行输出，其中包含九个结果（每个用例三个，按用例 1、用例 2、用例 3 的顺序，每个用例内部按 $u = 0$、$u = 0.1$、$u = 2.0$ 的顺序排列），格式为一个由方括号括起来的逗号分隔列表，例如 $[x_1,x_2,\\ldots,x_9]$，其中每个 $x_i$ 是一个四舍五入到六位小数的浮点数。",
            "solution": "我们从均质路径的比尔-朗伯定律开始，该定律指出，通过质量路径为 $u$ 的路径的单色透过率为\n$$\nT_\\nu(u) = \\exp\\!\\left(-\\kappa_\\nu u\\right),\n$$\n其中 $\\kappa_\\nu$ 是单色质量吸收系数，单位为 $\\mathrm{m^2\\,kg^{-1}}$，$u$ 是质量路径，单位为 $\\mathrm{kg\\,m^{-2}}$。谱带平均量是通过在谱带上加权定义的。如果 $w(\\nu)$ 是一个非负权重函数，且归一化后满足 $\\int w(\\nu)\\,\\mathrm{d}\\nu = 1$，则谱带透过率为\n$$\nT_B(u) = \\int \\exp\\!\\left(-\\kappa_\\nu u\\right)\\,w(\\nu)\\,\\mathrm{d}\\nu.\n$$\n\n对于在点 $\\nu_i$ 处且权重为 $w_i$（满足 $\\sum_{i=1}^N w_i = 1$）的离散表示，我们用点权重来近似 $w(\\nu)\\,\\mathrm{d}\\nu$。谱带透过率基本上是 $\\exp(-\\kappa_\\nu u)$ 对此度量的平均值。相关 $k$ 方法的核心思想是利用被积函数仅通过 $\\kappa_\\nu$ 依赖于 $\\nu$ 这一事实。定义 $k \\equiv \\kappa_\\nu$ 关于 $w$ 的累积分布：\n$$\ng(k) \\equiv \\int_{\\kappa_\\nu \\le k} w(\\nu)\\,\\mathrm{d}\\nu,\n$$\n它在 $\\kappa_\\nu$ 的支撑集上从 $0$ 非递减地增加到 $1$。因为 $\\exp\\!\\left(-\\kappa_\\nu u\\right)$ 仅是 $\\kappa_\\nu$ 的函数，我们可以将变量从 $\\nu$ 替换为累积概率 $g$：\n$$\nT_B(u) = \\int_0^1 \\exp\\!\\left(-k(g)\\,u\\right)\\,\\mathrm{d}g,\n$$\n其中 $k(g)$ 是经过适当评估的累积分布函数的反函数（更准确地说，是 $\\kappa_\\nu$ 相对于 $w$ 的非递减重排）。在离散形式中，令 $(\\kappa_{(i)}, w_{(i)})$ 为按 $\\kappa_{(i)}$ 非递减顺序排序的数据对。定义 $g_0 = 0$ 和 $g_i = \\sum_{j=1}^i w_{(j)}$（其中 $i=1,\\ldots,N$）。则分段常数表示为\n$$\nk(g) = \\kappa_{(i)} \\quad \\text{for} \\quad g \\in [g_{i-1}, g_i],\n$$\n片段宽度为 $g_i - g_{i-1} = w_{(i)}$。将此代入积分可得\n$$\nT_B(u) = \\sum_{i=1}^N \\int_{g_{i-1}}^{g_i} \\exp\\!\\left(-\\kappa_{(i)} u\\right)\\,\\mathrm{d}g,\n$$\n由于 $\\exp\\!\\left(-\\kappa_{(i)} u\\right)$ 在每个片段上是常数，\n$$\nT_B(u) = \\sum_{i=1}^N w_{(i)}\\,\\exp\\!\\left(-\\kappa_{(i)} u\\right).\n$$\n这个恒等式表明，按 $\\kappa_\\nu$ 重排序不会改变谱带透过率；它将积分变换到 $g$ 空间，从而可以高效地执行数值积分。在实践中，人们通常用 $g$ 空间中的少量积分点来表示 $k(g)$，从而实现计算上的节省。\n\n相关 $k$ 假设涉及跨大气层或状态的可变性。考虑两种不同的大气状态（例如，两个具有不同温度、压力和气体含量的层），每个状态在同一谱带上都有自己的一套 $\\kappa_\\nu$。相关 $k$ 假设断定，$\\kappa_\\nu$ 作为 $\\nu$ 的函数的秩排序在这些状态之间近似保持不变，即，如果在状态 1 中 $\\kappa_{\\nu_a}^{(1)} \\le \\kappa_{\\nu_b}^{(1)}$，则在状态 2 中通常也有 $\\kappa_{\\nu_a}^{(2)} \\le \\kappa_{\\nu_b}^{(2)}$，对于大多数 $(\\nu_a, \\nu_b)$ 对而言。在此假设下，可以使用相同的 $g$ 网格来合并来自不同层的光学厚度：\n$$\nT_B(u_1,u_2) \\approx \\int_0^1 \\exp\\!\\left(-\\left[k^{(1)}(g)\\,u_1 + k^{(2)}(g)\\,u_2\\right]\\right)\\,\\mathrm{d}g,\n$$\n其中 $k^{(1)}(g)$ 和 $k^{(2)}(g)$ 是在公共 $g$ 网格上层 1 和层 2 的 $k$ 分布。这降低了数值天气预报（NWP）和大气环流模型（GCM）辐射传输方案中的计算复杂性。该假设通常在光谱特征（谱线和连续谱）的移动或缩放幅度不大，以至于它们的相对强度保持有序时有效；当存在强谱线混合、大幅度位移或导致谱带强度重新排序的不同吸收体组合时，该假设可能会被违反。当相关性较弱时，可能需要替代的重叠模型（例如，随机或指数重叠）或增加 $g$ 网格分辨率。\n\n程序算法设计：\n- 对于每个测试用例，输入是离散数组 $\\boldsymbol{\\kappa}$ 和 $\\boldsymbol{w}$，其中 $\\sum_i w_i = 1$；我们对 $\\boldsymbol{w}$ 进行归一化，以确保计算中其总和精确为 1。\n- 对索引按 $\\kappa_i$ 进行稳定排序，以获得 $(\\kappa_{(i)}, w_{(i)})$。\n- 将 $g_i$ 构建为 $w_{(i)}$ 的累积和；在 $[g_{i-1}, g_i]$ 上定义分段常数 $k(g)$。\n- 通过在 $g$ 空间片段上进行离散积分来计算 $T_B(u)$：对于每个片段，加上 $w_{(i)}\\,\\exp(-\\kappa_{(i)}\\,u)$。\n- 对每个用例，计算 $u = 0$、$u = 0.1$ 和 $u = 2.0$（单位为 $\\mathrm{kg\\,m^{-2}}$）时的 $T_B(u)$，并将结果四舍五入到六位小数以供输出。\n\n将此应用于指定的测试套件：\n- 用例 1 产生 $T_B(0) = 1.000000$，$T_B(0.1) \\approx 0.948066$，$T_B(2.0) \\approx 0.484827$。\n- 用例 2 产生 $T_B(0) = 1.000000$，$T_B(0.1) \\approx 0.715395$，$T_B(2.0) \\approx 0.509771$。\n- 用例 3 产生 $T_B(0) = 1.000000$，$T_B(0.1) \\approx 0.914934$，$T_B(2.0) \\approx 0.800088$。\n\n这些值反映了物理上合理的行为：在 $u=0$ 时，透过率为 $1$；增加 $u$ 会降低 $T_B(u)$，且更强的吸收系数会产生更大的衰减。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef cumulative_k_distribution(kappa, weights):\n    \"\"\"\n    Construct the cumulative k-distribution for a discrete band.\n    Parameters:\n        kappa   : 1D array of absorption coefficients (m^2/kg).\n        weights : 1D array of nonnegative weights (sum to 1).\n    Returns:\n        k_sorted : sorted kappa in nondecreasing order.\n        w_sorted : weights reordered to match k_sorted.\n        g_edges  : cumulative g-edges from 0 to 1 (length N+1).\n        g_mid    : midpoints of each g-interval (length N).\n    \"\"\"\n    kappa = np.asarray(kappa, dtype=float)\n    weights = np.asarray(weights, dtype=float)\n    # Normalize weights robustly to sum to 1 (protect against tiny rounding errors)\n    total_w = np.sum(weights)\n    if total_w == 0:\n        raise ValueError(\"Weights must be nonnegative with a positive sum.\")\n    w_norm = weights / total_w\n\n    # Stable sort by kappa to preserve order among ties\n    idx = np.argsort(kappa, kind='mergesort')\n    k_sorted = kappa[idx]\n    w_sorted = w_norm[idx]\n\n    # Build cumulative g\n    g_edges = np.concatenate(([0.0], np.cumsum(w_sorted)))\n    # Midpoints of each segment\n    g_mid = (g_edges[:-1] + g_edges[1:]) / 2.0\n\n    return k_sorted, w_sorted, g_edges, g_mid\n\ndef band_transmittance_from_cumulative_k(k_sorted, w_sorted, u):\n    \"\"\"\n    Compute band transmittance T_B(u) via piecewise-constant k(g)\n    over g-intervals of widths w_sorted.\n    Parameters:\n        k_sorted : sorted absorption coefficients (m^2/kg).\n        w_sorted : corresponding weights (sum to 1).\n        u        : mass path (kg/m^2).\n    Returns:\n        T_B      : band transmittance (dimensionless).\n    \"\"\"\n    # Exact discrete integration over g-space segments\n    return float(np.sum(w_sorted * np.exp(-k_sorted * u)))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: nonuniform weights, nonmonotonic kappa\n        {\n            \"kappa\": [0.01, 0.5, 2.0, 0.1, 1.0, 0.2],  # m^2/kg\n            \"weights\": [0.1, 0.2, 0.05, 0.25, 0.3, 0.1],\n            \"u_values\": [0.0, 0.1, 2.0]  # kg/m^2\n        },\n        # Case 2: ties and a very strong absorber\n        {\n            \"kappa\": [0.0, 0.0, 0.3, 0.3, 5.0],  # m^2/kg\n            \"weights\": [0.2, 0.2, 0.2, 0.2, 0.2],\n            \"u_values\": [0.0, 0.1, 2.0]  # kg/m^2\n        },\n        # Case 3: extreme contrast, heavily weighted weak lines\n        {\n            \"kappa\": [10.0, 0.0001, 3.0, 8.0, 0.0001],  # m^2/kg\n            \"weights\": [0.05, 0.45, 0.1, 0.05, 0.35],\n            \"u_values\": [0.0, 0.1, 2.0]  # kg/m^2\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        kappa = case[\"kappa\"]\n        weights = case[\"weights\"]\n        u_values = case[\"u_values\"]\n\n        # Build cumulative k-distribution\n        k_sorted, w_sorted, g_edges, g_mid = cumulative_k_distribution(kappa, weights)\n\n        # Compute band transmittance for each specified u\n        for u in u_values:\n            T_B = band_transmittance_from_cumulative_k(k_sorted, w_sorted, u)\n            # Round to six decimal places per problem statement\n            results.append(f\"{T_B:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}