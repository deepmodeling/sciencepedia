{
    "hands_on_practices": [
        {
            "introduction": "超越简化的平面平行近似，本练习将探讨地球曲率对辐射传输的影响。您将通过应用几何原理和渐近分析，在更真实的球层大气中推导大气质量因子（AMF）的表达式。这项实践  能够提升您在数学物理方面的技能，并突显出考虑倾斜路径几何（尤其是在大天顶角情况下）的重要性。",
            "id": "4016471",
            "problem": "考虑一个用于数值天气预报和气候模拟的晴朗、水平均匀的大气层。假设大气处于静力平衡状态，是等温的，并且可以用理想气体定律很好地描述，因此质量密度随几何高度呈指数下降，$\\rho(h) = \\rho_{0} \\exp(-h/H)$，其中 $H$ 是密度标高，$\\rho_{0}$ 是海平面密度。假设在一个很窄的谱带内，质量消光系数 $\\kappa$ 不随高度变化。忽略水平传播进入大气的太阳光束；而是考虑在海平面（$h=0$）沿与当地垂直方向成天顶角 $\\theta$ 的直线视线进行的地面向上辐射测量，并忽略大气折射。\n\n从第一性原理出发，即 Beer–Lambert 定律 $dI/ds = -\\kappa \\rho(s)\\, I(s)$ 以及射线路径与半径为 $R_{\\mathrm{e}}$ 的球形地球之间的几何关系，推导斜路径光学厚度 $\\tau(\\theta)$ 和大气质量因子 (AMF) $M(\\theta) = \\tau(\\theta)/\\tau(0)$ 的领头阶渐近表达式，该表达式在 $H/R_{\\mathrm{e}}$ 很小时有效。您的推导必须仅使用上述假设、静力平衡所蕴含的指数密度剖面以及球形大气中的直线几何。将 $H/R_{\\mathrm{e}}$ 视为小参数，并保留到 $H/R_{\\mathrm{e}}$ 的一阶项。\n\n然后，在 $\\theta = 80^{\\circ}$，$H = 7.5\\ \\mathrm{km}$ 和 $R_{\\mathrm{e}} = 6371\\ \\mathrm{km}$ 的条件下，计算得到的 $M(\\theta)$ 的值。将 $M(80^{\\circ})$ 的最终数值表示为一个纯数，并将您的答案四舍五入到四位有效数字。全程使用度作为角度单位。",
            "solution": "用户希望在球形等温大气模型下推导大气质量因子（AMF）的渐近表达式，然后针对一个具体情况进行求值。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n- 大气模型：晴朗、水平均匀、静力平衡、等温、理想气体定律。\n- 质量密度剖面：$\\rho(h) = \\rho_{0} \\exp(-h/H)$，其中 $h$ 是几何高度，$\\rho_{0}$ 是海平面密度， $H$ 是密度标高。\n- 质量消光系数：$\\kappa$，不随高度变化。\n- 辐射传输定律：Beer–Lambert 定律，$dI/ds = -\\kappa \\rho(s) I(s)$。\n- 几何：半径为 $R_{\\mathrm{e}}$ 的球形地球。视线是从海平面（$h=0$）出发，与天顶角成 $\\theta$ 的直线。忽略折射。\n- 渐近展开参数：小的 $H/R_{\\mathrm{e}}$。保留到 $H/R_{\\mathrm{e}}$ 的一阶项。\n- 大气质量因子 (AMF) 的定义：$M(\\theta) = \\tau(\\theta)/\\tau(0)$，其中 $\\tau(\\theta)$ 是斜路径光学厚度。\n- 用于求值的数值：\n  - 天顶角：$\\theta = 80^{\\circ}$\n  - 密度标高：$H = 7.5\\ \\mathrm{km}$\n  - 地球半径：$R_{\\mathrm{e}} = 6371\\ \\mathrm{km}$\n- 要求输出：\n  1. $\\tau(\\theta)$ 和 $M(\\theta)$ 的领头阶渐近表达式的推导。\n  2. $M(80^{\\circ})$ 的数值，四舍五入到四位有效数字。\n\n**1.2. 使用提取的已知条件进行验证**\n- **科学依据：** 问题使用了一个标准、简化的大气模型（等温、指数密度），这是大气物理学中一个常用且有效的一阶近似。Beer-Lambert 定律是辐射传输的基本原理。几何结构是一个标准的球壳模型。该问题具有科学合理性。\n- **适定性：** 问题清楚地指明了出发原理、假设、所需的推导（渐近展开）和最终计算。根据给定信息可以确定唯一解。\n- **客观性：** 语言技术性强且精确，没有主观或模糊的陈述。\n- **完备性与一致性：** 提供了推导和计算所需的所有必要信息。假设是内部一致的（静力+等温意味着指数密度）。\n- **可行性：** 条件和数值对于地球大气层是物理上现实的。\n\n**1.3. 结论与行动**\n问题是有效的。我将继续进行推导和求解。\n\n### 步骤 2：推导与求解\n\n光学厚度 $\\tau$ 由微分关系 $d\\tau = \\kappa \\rho ds$ 定义，其中 $ds$ 是路径长度微元。从地面（$s=0$）到大气层顶部（$s \\to \\infty$）的总斜路径光学厚度由以下积分给出：\n$$ \\tau(\\theta) = \\int_{0}^{\\infty} \\kappa \\rho(s) ds $$\n质量消光系数 $\\kappa$ 是常数。密度 $\\rho$ 取决于高度 $h$。我们必须利用球形地球的几何关系来关联路径长度 $s$ 和高度 $h$。\n\n设观测者位于地球表面（半径为 $R_{\\mathrm{e}}$）的 $O$ 点。地心为 $C$。光线直线路径上的点 $P$ 距离观测者为 $s$，并且在地面以上的高度为 $h$。$O$ 点的当地垂直方向与光线路径之间的夹角是天顶角 $\\theta$。对三角形 $\\triangle COP$ 应用余弦定理，其中边长为 $CO = R_{\\mathrm{e}}$，$CP = R_{\\mathrm{e}} + h$ 和 $OP = s$，在 $O$ 点的角为 $180^{\\circ} - \\theta$：\n$$ (R_{\\mathrm{e}} + h)^2 = R_{\\mathrm{e}}^2 + s^2 - 2 R_{\\mathrm{e}} s \\cos(180^{\\circ} - \\theta) $$\n$$ (R_{\\mathrm{e}} + h)^2 = R_{\\mathrm{e}}^2 + s^2 + 2 R_{\\mathrm{e}} s \\cos(\\theta) $$\n为了将路径元 $ds$ 与高度增量 $dh$ 联系起来，我们对这个方程关于 $s$ 求导：\n$$ 2(R_{\\mathrm{e}} + h) \\frac{dh}{ds} = 2s + 2 R_{\\mathrm{e}} \\cos(\\theta) $$\n$$ \\frac{dh}{ds} = \\frac{s + R_{\\mathrm{e}} \\cos(\\theta)}{R_{\\mathrm{e}} + h} $$\n我们可以解这个关于 $s$ 的二次方程得到 $s = -R_{\\mathrm{e}}\\cos(\\theta) + \\sqrt{(R_{\\mathrm{e}}+h)^2 - R_{\\mathrm{e}}^2 \\sin^2(\\theta)}$。将此代入 $dh/ds$ 的表达式中：\n$$ \\frac{dh}{ds} = \\frac{\\sqrt{(R_{\\mathrm{e}}+h)^2 - R_{\\mathrm{e}}^2 \\sin^2(\\theta)}}{R_{\\mathrm{e}} + h} = \\sqrt{1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)} $$\n这给出了关联 $ds$ 和 $dh$ 的几何因子：\n$$ ds = \\frac{dh}{\\sqrt{1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)}} $$\n斜路径光学厚度的积分变为：\n$$ \\tau(\\theta) = \\int_{0}^{\\infty} \\kappa \\rho_{0} \\exp(-h/H) \\left[1 - \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 \\sin^2(\\theta)\\right]^{-\\frac{1}{2}} dh $$\n问题要求对小的 $H/R_{\\mathrm{e}}$ 进行渐近展开。项 $\\exp(-h/H)$ 确保了积分的主要贡献来自于量级为标高 $H$ 的高度 $h$。因此，我们可以对小的 $h/R_{\\mathrm{e}}$ 展开几何因子。令 $x = h/R_{\\mathrm{e}}$。\n$$ \\left(\\frac{R_{\\mathrm{e}}}{R_{\\mathrm{e}}+h}\\right)^2 = (1 + x)^{-2} \\approx 1 - 2x + O(x^2) $$\n将此代入平方根内的项：\n$$ 1 - (1 - 2x)\\sin^2(\\theta) = 1 - \\sin^2(\\theta) + 2x\\sin^2(\\theta) = \\cos^2(\\theta) + 2\\frac{h}{R_{\\mathrm{e}}}\\sin^2(\\theta) $$\n几何因子变为：\n$$ \\left(\\cos^2(\\theta) + 2\\frac{h}{R_{\\mathrm{e}}}\\sin^2(\\theta)\\right)^{-\\frac{1}{2}} = \\frac{1}{\\cos(\\theta)} \\left(1 + \\frac{2h}{R_{\\mathrm{e}}} \\frac{\\sin^2(\\theta)}{\\cos^2(\\theta)}\\right)^{-\\frac{1}{2}} = \\sec(\\theta) \\left(1 + \\frac{2h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right)^{-\\frac{1}{2}} $$\n对小的 $u$ 使用二项式近似 $(1+u)^{-\\frac{1}{2}} \\approx 1 - \\frac{1}{2}u$：\n$$ \\sec(\\theta) \\left(1 - \\frac{1}{2} \\frac{2h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) = \\sec(\\theta) \\left(1 - \\frac{h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这个表达式是几何因子的一阶近似。我们将其代入 $\\tau(\\theta)$ 的积分中：\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 \\int_{0}^{\\infty} \\exp(-h/H) \\sec(\\theta) \\left(1 - \\frac{h}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) dh $$\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 \\sec(\\theta) \\left[ \\int_{0}^{\\infty} \\exp(-h/H) dh - \\frac{\\tan^2(\\theta)}{R_{\\mathrm{e}}} \\int_{0}^{\\infty} h \\exp(-h/H) dh \\right] $$\n我们现在计算这两个积分：\n第一个积分是：\n$$ \\int_{0}^{\\infty} \\exp(-h/H) dh = \\left[-H \\exp(-h/H)\\right]_{0}^{\\infty} = 0 - (-H) = H $$\n第二个积分可以用分部积分法求解，或者通过识别它为一个 Gamma 函数来求解。令 $u=h/H$，则 $h=uH$ 且 $dh=Hdu$：\n$$ \\int_{0}^{\\infty} h \\exp(-h/H) dh = \\int_{0}^{\\infty} uH \\exp(-u) Hdu = H^2 \\int_{0}^{\\infty} u \\exp(-u) du = H^2 \\Gamma(2) = H^2(1!) = H^2 $$\n将这些结果代回 $\\tau(\\theta)$ 的表达式中：\n$$ \\tau(\\theta) \\approx \\kappa \\rho_0 H \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这就是所要求的斜路径光学厚度 $\\tau(\\theta)$ 的领头阶渐近表达式。\n\n接下来，我们求垂直光学厚度 $\\tau(0)$，它对应于 $\\theta=0$。在这种情况下，$ds = dh$。\n$$ \\tau(0) = \\int_{0}^{\\infty} \\kappa \\rho(h) dh = \\kappa \\rho_0 \\int_{0}^{\\infty} \\exp(-h/H) dh = \\kappa \\rho_0 H $$\n大气质量因子 (AMF) 定义为 $M(\\theta) = \\tau(\\theta)/\\tau(0)$。\n$$ M(\\theta) \\approx \\frac{\\kappa \\rho_0 H \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right)}{\\kappa \\rho_0 H} $$\n$$ M(\\theta) \\approx \\sec(\\theta) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(\\theta)\\right) $$\n这就是所要求的 AMF 的渐近表达式，在 $H/R_{\\mathrm{e}}$ 的一阶项内有效。\n\n最后，我们用给定的数值来计算这个表达式的值：$\\theta = 80^{\\circ}$，$H = 7.5\\ \\mathrm{km}$，以及 $R_{\\mathrm{e}} = 6371\\ \\mathrm{km}$。\n比率 $H/R_{\\mathrm{e}}$ 是：\n$$ \\frac{H}{R_{\\mathrm{e}}} = \\frac{7.5}{6371} \\approx 0.00117718 $$\n所需的三角函数是：\n$$ \\sec(80^{\\circ}) = \\frac{1}{\\cos(80^{\\circ})} \\approx 5.758770 $$\n$$ \\tan(80^{\\circ}) \\approx 5.671282 $$\n$$ \\tan^2(80^{\\circ}) \\approx (5.671282)^2 \\approx 32.163334 $$\n现在，我们计算 $M(80^{\\circ})$：\n$$ M(80^{\\circ}) \\approx \\sec(80^{\\circ}) \\left(1 - \\frac{H}{R_{\\mathrm{e}}} \\tan^2(80^{\\circ})\\right) $$\n$$ M(80^{\\circ}) \\approx 5.758770 \\left(1 - (0.00117718) \\times (32.163334)\\right) $$\n$$ M(80^{\\circ}) \\approx 5.758770 \\left(1 - 0.037861\\right) $$\n$$ M(80^{\\circ}) \\approx 5.758770 \\times 0.962139 $$\n$$ M(80^{\\circ}) \\approx 5.54078 $$\n将结果四舍五入到四位有效数字得到 $5.541$。",
            "answer": "$$\\boxed{5.541}$$"
        },
        {
            "introduction": "真实的辐射传输计算必须有效处理具有复杂重叠光谱的多种吸收气体的综合效应。本练习引入了“等效消光系数”的概念，这是一项关键的参数化技术。通过解决这个问题 ，您将学会如何表示光谱带内多种吸收体的净效应，从而深入了解气候模型如何简化辐射计算。",
            "id": "4016477",
            "problem": "考虑一个在数值天气预报（NWP）和气候辐射方案中使用的短波谱带。一个几何厚度为 $\\Delta z$ 的平行平面大气层，被太阳天顶角为 $\\theta$（单位：度）的太阳直射光束照射。忽略散射和发射，因此衰减仅由分子吸收控制。两种吸收性物质，标记为 $A$ 和 $B$（例如，臭氧和水汽），在该谱带内光谱重叠。假设这是一个均匀层，因此对于每个波数 $\\nu$，单色消光系数 $k_{A,\\nu}$ 和 $k_{B,\\nu}$ 沿路径为常数，并且比尔-朗伯定律适用。\n\n在平行平面近似下，穿过该层的直射光束路径长度为 $L=\\Delta z/\\mu$，其中 $\\mu=\\cos\\theta$。对于组合的吸收物质，波数 $\\nu$ 处的单色透过率由比尔-朗伯定律和光学深度的可加性确定。使用谱带上的归一化光谱权重定义谱带平均直射光束透过率 $\\overline{T}$。等效消光方法用一个在整个谱带上具有恒定消光系数 $k_{\\mathrm{eq}}$ 的单一伪吸收体来替代重叠的吸收物质，该系数的选择是为了保持谱带平均直射光束透过率不变。\n\n从比尔-朗伯定律以及光学深度和谱带平均透过率的定义出发，推导出一个能够保持两种重叠吸收物质的谱带平均直射光束透过率的 $k_{\\mathrm{eq}}$ 解析表达式。然后，根据以下科学上合理的配置，对 $k_{\\mathrm{eq}}$ 进行数值计算：\n- 几何厚度 $\\Delta z = 1000\\ \\mathrm{m}$。\n- 太阳天顶角 $\\theta = 60^\\circ$（度）。\n- 一个近似谱带权重的四点求积法，其权重为 $w_1=\\;0.1$, $w_2=\\;0.2$, $w_3=\\;0.4$, $w_4=\\;0.3$。\n- 物质 $A$ 的单色消光系数（假设在每个求积节点上，该系数在整个层中是恒定的）：\n  $k_{A,1}=\\;3.0\\times 10^{-5}\\ \\mathrm{m}^{-1}$, $k_{A,2}=\\;2.5\\times 10^{-4}\\ \\mathrm{m}^{-1}$, $k_{A,3}=\\;1.2\\times 10^{-3}\\ \\mathrm{m}^{-1}$, $k_{A,4}=\\;8.0\\times 10^{-4}\\ \\mathrm{m}^{-1}$。\n- 物质 $B$ 的单色消光系数：\n  $k_{B,1}=\\;4.0\\times 10^{-4}\\ \\mathrm{m}^{-1}$, $k_{B,2}=\\;1.0\\times 10^{-3}\\ \\mathrm{m}^{-1}$, $k_{B,3}=\\;2.0\\times 10^{-4}\\ \\mathrm{m}^{-1}$, $k_{B,4}=\\;9.0\\times 10^{-4}\\ \\mathrm{m}^{-1}$。\n\n以 $\\mathrm{m}^{-1}$ 为单位表示最终的等效消光系数 $k_{\\mathrm{eq}}$，并将您的答案四舍五入到四位有效数字。不要报告任何中间值。答案必须是一个单一的实数值。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、是适定的、客观的，并包含得出唯一解所需的所有必要信息，且没有矛盾。\n\n求解过程首先推导等效消光系数 $k_{\\mathrm{eq}}$ 的解析表达式，然后用给定的数值计算该表达式的值。\n\n对于波数为 $\\nu$ 的单色辐射，通过长度为 $L$ 的路径的透过率 $T_\\nu$ 由比尔-朗伯定律给出：\n$$T_\\nu = \\exp(-\\tau_\\nu)$$\n其中 $\\tau_\\nu$ 是单色光学深度。对于均匀介质，光学深度是消光系数 $k_\\nu$ 和路径长度 $L$ 的乘积：\n$$\\tau_\\nu = k_\\nu L$$\n问题陈述中忽略了散射和发射，因此衰减仅由A和B两种物质的吸收引起。在给定波数 $\\nu$ 处的总消光系数是各个消光系数之和：\n$$k_\\nu = k_{A,\\nu} + k_{B,\\nu}$$\n这是基于非反应性吸收物质混合物的光学深度可加性原理。因此，总光学深度为：\n$$\\tau_\\nu = (k_{A,\\nu} + k_{B,\\nu}) L$$\n对于几何厚度为 $\\Delta z$、太阳天顶角为 $\\theta$ 的平行平面大气，路径长度 $L$ 由 $L = \\Delta z / \\mu$ 给出，其中 $\\mu = \\cos\\theta$。\n\n谱带平均透过率 $\\overline{T}$ 是通过对四个求积点的离散求和计算得出的，这些点具有权重 $w_i$ 和在节点 $i = 1, 2, 3, 4$ 处的相应单色属性。在节点 $i$ 处的单色透过率为：\n$$T_i = \\exp(-\\tau_i) = \\exp(-(k_{A,i} + k_{B,i}) L)$$\n因此，这个双吸收体系统的谱带平均透过率为：\n$$\\overline{T}_{\\mathrm{true}} = \\sum_{i=1}^{4} w_i T_i = \\sum_{i=1}^{4} w_i \\exp(-(k_{A,i} + k_{B,i}) L)$$\n\n等效消光方法旨在找到一个单一的、在光谱上恒定的消光系数 $k_{\\mathrm{eq}}$，以使谱带平均透过率保持不变。对于此伪吸收体，在任何节点 $i$ 处的单色透过率为：\n$$T_{\\mathrm{eq}, i} = \\exp(-k_{\\mathrm{eq}} L)$$\n由于 $k_{\\mathrm{eq}}$ 在整个谱带上是恒定的，因此 $T_{\\mathrm{eq}, i}$ 也是恒定的。等效系统的谱带平均透过率为：\n$$\\overline{T}_{\\mathrm{eq}} = \\sum_{i=1}^{4} w_i T_{\\mathrm{eq}, i} = \\exp(-k_{\\mathrm{eq}} L) \\sum_{i=1}^{4} w_i$$\n问题陈述中权重是归一化的，意味着 $\\sum w_i = 1$。因此，表达式简化为：\n$$\\overline{T}_{\\mathrm{eq}} = \\exp(-k_{\\mathrm{eq}} L)$$\n\n为了求得 $k_{\\mathrm{eq}}$，我们令谱带平均透过率的两个表达式相等：$\\overline{T}_{\\mathrm{true}} = \\overline{T}_{\\mathrm{eq}}$。\n$$\\exp(-k_{\\mathrm{eq}} L) = \\sum_{i=1}^{4} w_i \\exp(-(k_{A,i} + k_{B,i}) L)$$\n为了解出 $k_{\\mathrm{eq}}$，我们对两边取自然对数：\n$$-k_{\\mathrm{eq}} L = \\ln\\left( \\sum_{i=1}^{4} w_i \\exp(-(k_{A,i} + k_{B,i}) L) \\right)$$\n整理以求解 $k_{\\mathrm{eq}}$ 并代入 $L = \\Delta z / \\mu$，得到最终的解析表达式：\n$$k_{\\mathrm{eq}} = -\\frac{1}{L} \\ln\\left( \\sum_{i=1}^{4} w_i \\exp(-(k_{A,i} + k_{B,i}) L) \\right) = -\\frac{\\mu}{\\Delta z} \\ln\\left( \\sum_{i=1}^{4} w_i \\exp\\left(-\\frac{(k_{A,i} + k_{B,i})\\Delta z}{\\mu}\\right) \\right)$$\n\n现在，我们使用所提供的数据对该表达式进行数值计算。\n首先，计算路径长度 $L$：\n- 几何厚度 $\\Delta z = 1000\\ \\mathrm{m}$。\n- 太阳天顶角 $\\theta = 60^\\circ$。\n- $\\mu = \\cos(60^\\circ) = 0.5$。\n- 路径长度 $L = \\frac{\\Delta z}{\\mu} = \\frac{1000\\ \\mathrm{m}}{0.5} = 2000\\ \\mathrm{m}$。\n\n接下来，我们确定每个求积节点处的总消光系数 $k_i = k_{A,i} + k_{B,i}$：\n- $k_1 = k_{A,1} + k_{B,1} = 3.0 \\times 10^{-5}\\ \\mathrm{m}^{-1} + 4.0 \\times 10^{-4}\\ \\mathrm{m}^{-1} = 4.3 \\times 10^{-4}\\ \\mathrm{m}^{-1}$。\n- $k_2 = k_{A,2} + k_{B,2} = 2.5 \\times 10^{-4}\\ \\mathrm{m}^{-1} + 1.0 \\times 10^{-3}\\ \\mathrm{m}^{-1} = 1.25 \\times 10^{-3}\\ \\mathrm{m}^{-1}$。\n- $k_3 = k_{A,3} + k_{B,3} = 1.2 \\times 10^{-3}\\ \\mathrm{m}^{-1} + 2.0 \\times 10^{-4}\\ \\mathrm{m}^{-1} = 1.4 \\times 10^{-3}\\ \\mathrm{m}^{-1}$。\n- $k_4 = k_{A,4} + k_{B,4} = 8.0 \\times 10^{-4}\\ \\mathrm{m}^{-1} + 9.0 \\times 10^{-4}\\ \\mathrm{m}^{-1} = 1.7 \\times 10^{-3}\\ \\mathrm{m}^{-1}$。\n\n接下来，计算每个节点的单色光学深度 $\\tau_i = k_i L$：\n- $\\tau_1 = (4.3 \\times 10^{-4}\\ \\mathrm{m}^{-1}) \\times (2000\\ \\mathrm{m}) = 0.86$。\n- $\\tau_2 = (1.25 \\times 10^{-3}\\ \\mathrm{m}^{-1}) \\times (2000\\ \\mathrm{m}) = 2.5$。\n- $\\tau_3 = (1.4 \\times 10^{-3}\\ \\mathrm{m}^{-1}) \\times (2000\\ \\mathrm{m}) = 2.8$。\n- $\\tau_4 = (1.7 \\times 10^{-3}\\ \\mathrm{m}^{-1}) \\times (2000\\ \\mathrm{m}) = 3.4$。\n\n现在，使用权重 $w_1 = 0.1$, $w_2 = 0.2$, $w_3 = 0.4$, 和 $w_4 = 0.3$ 计算谱带平均透过率 $\\overline{T}_{\\mathrm{true}}$。\n$$\\overline{T}_{\\mathrm{true}} = \\sum_{i=1}^{4} w_i \\exp(-\\tau_i) = 0.1 \\exp(-0.86) + 0.2 \\exp(-2.5) + 0.4 \\exp(-2.8) + 0.3 \\exp(-3.4)$$\n$$\\overline{T}_{\\mathrm{true}} \\approx 0.1(0.423162) + 0.2(0.082085) + 0.4(0.060810) + 0.3(0.033373)$$\n$$\\overline{T}_{\\mathrm{true}} \\approx 0.0423162 + 0.0164170 + 0.0243240 + 0.0100120 \\approx 0.0930692$$\n\n最后，我们求解 $k_{\\mathrm{eq}}$：\n$$k_{\\mathrm{eq}} = -\\frac{1}{L} \\ln(\\overline{T}_{\\mathrm{true}}) = -\\frac{1}{2000\\ \\mathrm{m}} \\ln(0.0930692)$$\n$$k_{\\mathrm{eq}} \\approx -\\frac{-2.37445}{2000\\ \\mathrm{m}} \\approx 0.001187225\\ \\mathrm{m}^{-1}$$\n$$k_{\\mathrm{eq}} \\approx 1.187225 \\times 10^{-3}\\ \\mathrm{m}^{-1}$$\n按照要求，四舍五入到四位有效数字，我们得到：\n$$k_{\\mathrm{eq}} = 1.187 \\times 10^{-3}\\ \\mathrm{m}^{-1}$$",
            "answer": "$$\\boxed{1.187 \\times 10^{-3}}$$"
        },
        {
            "introduction": "这项综合性练习将理论与实践相结合，指导您构建一个数值辐射传输模型。您需要将连续的 Beer-Lambert 定律转化为离散算法，同时考虑大气分层和使用求积方案处理光谱变化。这项编码实践  为理解现代天气和气候模型中辐射传输计算的核心组成部分提供了基础。",
            "id": "4016475",
            "problem": "考虑一个用于数值天气预报和气候模拟的平行平面大气柱，其中单一物质的吸收是主导过程。该大气柱被划分为 $i = 1, 2, \\dots, N$ 索引的离散水平层，每层具有已知的层厚度 $\\Delta z_i$（单位：米）和吸收物质量密度 $\\rho_i$（单位：千克/立方米）。一束直射短波射线以太阳天顶角 $\\theta$（单位：度）从大气柱顶部入射。辐射传输仅考虑吸收过程；散射和发射被忽略。目标是使用光谱变化吸收的离散求积表示，计算从大气柱顶部到底部的波段平均直射束透射率。\n\n此问题的基本原理：\n- 沿路径的纯吸收辐射传输方程为 $dI/ds = -\\kappa_{\\text{ext}} \\rho \\, I$，其中 $I$ 是比辐射强度，$\\kappa_{\\text{ext}}$ 是吸收（或消光）系数（单位：平方米/千克），$\\rho$ 是吸收物密度（单位：千克/立方米），$s$ 是路径长度（单位：米）。\n- 沿路径的光学深度定义为 $\\tau = \\int \\kappa_{\\text{ext}} \\rho \\, ds$。\n- 在平行平面大气中，天顶角为 $\\theta$ 的光束的斜程元满足 $ds = dz / \\mu$，其中 $\\mu = \\cos(\\theta)$，当 $\\theta$ 用于三角函数时，其单位应为弧度。\n\n光谱带处理：\n- 跨波段的光谱变化吸收由一组 $M$ 个求积节点表示，索引为 $j = 1, 2, \\dots, M$，其权重 $w_j$ 满足 $\\sum_{j=1}^M w_j = 1$，以及依赖于层的吸收系数节点 $\\kappa_{i,j}$（单位：平方米/千克）。\n- 节点 $\\kappa_{i,j}$ 在各层之间是一致排序的（即，对于所有层，相同的索引 $j$ 代表波段上相同的累积概率位置）。\n\n任务：\n1. 从上述基本原理出发，推导整个大气柱的波段平均直射束透射率的离散计算方案，用 $N$, $M$, $\\Delta z_i$, $\\rho_i$, $\\theta$, $w_j$ 和 $\\kappa_{i,j}$ 表示。您的推导必须：\n   - 从纯吸收辐射传输方程和光学深度的定义开始。\n   - 使用适当的平行平面几何结构，其中 $\\mu = \\cos(\\theta)$。\n   - 论证分层和光谱求积如何结合以产生波段平均透射率。\n   - 展示一种数值稳定的方法，用于组合多层的透射率并在求积节点上进行合并，该方法应在光学深度极大或极小时避免上溢/下溢。\n2. 在一个完整的、可运行的程序中实现所推导的方案，该程序仅使用下面提供的数据。程序必须：\n   - 将输入的 $\\theta$（单位：度）解释，并在需要时内部转换为弧度。\n   - 使用单位为米的 $\\Delta z_i$、单位为千克/立方米的 $\\rho_i$、单位为平方米/千克的 $\\kappa_{i,j}$，并产生无量纲的透射率。\n   - 稳健地处理 $\\mu \\rightarrow 0$ 的情况，确保数值稳定性，避免除以零。\n   - 生成单行输出，包含以逗号分隔并用方括号括起来的结果列表（例如 $[r_1,r_2,\\dots]$），其中每个 $r_k$ 是测试用例 $k$ 的波段平均透射率。\n   - 将每个结果表示为浮点数，四舍五入到八位小数，不含任何额外文本或空格。\n\n测试套件：\n- 使用 $M = 4$ 个求积节点，权重为 $w = [\\,0.25,\\,0.35,\\,0.20,\\,0.20\\,]$，因此 $w_1 = 0.25$, $w_2 = 0.35$, $w_3 = 0.20$, $w_4 = 0.20$ 且 $\\sum_{j=1}^4 w_j = 1$。\n\n定义五个测试用例，每个都由元组 $\\left( \\{\\Delta z_i\\}_{i=1}^N, \\{\\rho_i\\}_{i=1}^N, \\theta, \\{\\kappa_{i,j}\\}_{i=1,j=1}^{N,M}, \\{w_j\\}_{j=1}^M \\right)$ 完全指定：\n\n1. 用例 1 (正常路径，中等吸收，中等天顶角):\n   - $N = 4$\n   - $\\Delta z = [\\,1000,\\,1500,\\,800,\\,1200\\,]$ 米\n   - $\\rho = [\\,1.5\\times 10^{-5},\\,1.0\\times 10^{-5},\\,8.0\\times 10^{-6},\\,6.0\\times 10^{-6}\\,]$ 千克/立方米\n   - $\\theta = 60$ 度\n   - 按层 $i$ 和节点 $j$ 的 $\\kappa_{i,j}$（单位：平方米/千克）：\n     - 层 1：$[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2：$[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3：$[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n     - 层 4：$[\\,1.0,\\,10.0,\\,0.1,\\,3.0\\,]$\n\n2. 用例 2 (光学薄，近天底):\n   - $N = 3$\n   - $\\Delta z = [\\,1000,\\,1000,\\,1000\\,]$ 米\n   - $\\rho = [\\,2.0\\times 10^{-7},\\,1.0\\times 10^{-7},\\,1.5\\times 10^{-7}\\,]$ 千克/立方米\n   - $\\theta = 0$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1：$[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2：$[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3：$[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n\n3. 用例 3 (极光学厚，强吸收，斜程路径):\n   - $N = 3$\n   - $\\Delta z = [\\,2000,\\,3000,\\,1500\\,]$ 米\n   - $\\rho = [\\,2.0\\times 10^{-4},\\,1.5\\times 10^{-4},\\,1.0\\times 10^{-4}\\,]$ 千克/立方米\n   - $\\theta = 78.463$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1：$[\\,30.0,\\,300.0,\\,3.0,\\,100.0\\,]$\n     - 层 2：$[\\,25.0,\\,250.0,\\,2.5,\\,80.0\\,]$\n     - 层 3：$[\\,20.0,\\,200.0,\\,2.0,\\,60.0\\,]$\n\n4. 用例 4 (掠射角，光学属性与用例 1 相同但近地平线):\n   - $N = 4$\n   - $\\Delta z = [\\,1000,\\,1500,\\,800,\\,1200\\,]$ 米\n   - $\\rho = [\\,1.5\\times 10^{-5},\\,1.0\\times 10^{-5},\\,8.0\\times 10^{-6},\\,6.0\\times 10^{-6}\\,]$ 千克/立方米\n   - $\\theta = 87$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1：$[\\,2.0,\\,20.0,\\,0.2,\\,5.0\\,]$\n     - 层 2：$[\\,1.5,\\,15.0,\\,0.15,\\,4.0\\,]$\n     - 层 3：$[\\,3.0,\\,30.0,\\,0.3,\\,6.0\\,]$\n     - 层 4：$[\\,1.0,\\,10.0,\\,0.1,\\,3.0\\,]$\n\n5. 用例 5 (零吸收合理性检查):\n   - $N = 2$\n   - $\\Delta z = [\\,1000,\\,500\\,]$ 米\n   - $\\rho = [\\,1.0\\times 10^{-3},\\,1.0\\times 10^{-3}\\,]$ 千克/立方米\n   - $\\theta = 45$ 度\n   - $\\kappa_{i,j}$:\n     - 层 1：$[\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,]$\n     - 层 2：$[\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,]$\n\n要求输出：\n- 您的程序应生成单行输出，其中包含五个测试用例的波段平均透射率，格式为方括号内的逗号分隔列表，每个浮点数四舍五入到八位小数，例如 $[t_1,t_2,t_3,t_4,t_5]$。",
            "solution": "该问题是有效的。它在科学上基于辐射传输原理，问题设定良好，提供了充分且一致的数据，并要求推导和实现一种大气模拟中使用的标准算法。\n\n波段平均直射束透射率的计算方案推导过程如下，从提供的基本原理开始。\n\n1. **辐射传输方程的积分**\n\n控制纯吸收辐射传输的基本方程为：\n$$ \\frac{dI}{ds} = -\\kappa_{\\text{ext}} \\rho \\, I $$\n其中 $I$ 是比辐射强度，$\\kappa_{\\text{ext}}$ 是质量吸收系数（单位：m$^2$/kg），$\\rho$ 是吸收物密度（单位：kg/m$^3$），$s$ 是路径长度（单位：米）。对于单色光束（在单一波长或频率下），其中 $\\kappa_{\\text{ext}}$ 在短路径段上是常数，这是一个一阶线性常微分方程。我们可以分离变量，并从起点 $s_1$ 到终点 $s_2$ 对其进行积分：\n$$ \\int_{I(s_1)}^{I(s_2)} \\frac{dI'}{I'} = -\\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n$$ \\ln\\left(\\frac{I(s_2)}{I(s_1)}\\right) = -\\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n右侧的积分定义为沿路径从 $s_1$ 到 $s_2$ 的光学深度 $\\tau$。\n$$ \\tau(s_1, s_2) = \\int_{s_1}^{s_2} \\kappa_{\\text{ext}} \\rho \\, ds' $$\n对两边取指数，得到比尔-朗伯定律，该定律关联了最终强度 $I(s_2)$ 和初始强度 $I(s_1)$：\n$$ I(s_2) = I(s_1) e^{-\\tau(s_1, s_2)} $$\n透射率 $T$ 是穿过介质的辐射分数，定义为 $T = I(s_2) / I(s_1)$。因此，单色透射率为：\n$$ T = e^{-\\tau} $$\n\n2. **平行平面大气几何**\n\n在平行平面大气中，几何结构被简化。一束直射辐射以太阳天顶角 $\\theta$ 进入大气层顶部。斜程路径元 $ds$ 与相应的垂直距离元 $dz$ 之间的关系由 $ds = dz/\\mu$ 给出，其中 $\\mu = \\cos(\\theta)$ 且 $\\theta$ 以弧度表示。项 $1/\\mu$ 是大气质量因子。\n\n光学深度积分可以重写为垂直坐标 $z$ 的函数。假设辐射路径穿过垂直距离 $\\Delta z$，则斜程光学深度 $\\Delta \\tau$ 为：\n$$ \\Delta \\tau = \\int_{\\text{path}} \\kappa_{\\text{ext}} \\rho \\, ds = \\int_{\\text{vertical}} \\kappa_{\\text{ext}} \\rho \\frac{dz}{\\mu} = \\frac{1}{\\mu} \\int_{\\text{vertical}} \\kappa_{\\text{ext}} \\rho \\, dz $$\n积分 $\\int \\kappa_{\\text{ext}} \\rho \\, dz$ 是垂直光学深度。\n\n3. **大气层的离散化**\n\n大气柱从上到下被划分为 $N$ 个离散层，索引为 $i=1, \\dots, N$。在每一层 $i$ 内部，厚度 $\\Delta z_i$、吸收物密度 $\\rho_i$ 和吸收系数 $\\kappa_{\\text{ext}, i}$ 被假定为常数。因此，单层 $i$ 的垂直光学深度，记为 $\\Delta \\delta_i$，为：\n$$ \\Delta \\delta_i = \\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i $$\n该层的斜程光学深度为：\n$$ \\Delta \\tau_i = \\frac{\\Delta \\delta_i}{\\mu} = \\frac{\\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i}{\\mu} $$\n光学深度是可加的。整个大气柱的总斜程光学深度 $\\tau_{\\text{total}}$ 是各层光学深度之和：\n$$ \\tau_{\\text{total}} = \\sum_{i=1}^N \\Delta \\tau_i = \\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{\\text{ext}, i} \\rho_i \\Delta z_i $$\n相应地，总透射率是各层透射率的乘积。这为展示数值稳定性提供了一条途径。总透射率 $T_{\\text{total}}$ 为：\n$$ T_{\\text{total}} = \\prod_{i=1}^N T_i = \\prod_{i=1}^N e^{-\\Delta \\tau_i} = \\exp\\left(-\\sum_{i=1}^N \\Delta \\tau_i\\right) = e^{-\\tau_{\\text{total}}} $$\n先求和光学深度，再进行单次指数计算，如 $e^{-\\tau_{\\text{total}}}$，比乘以许多小的透射率值在数值上更稳定，后者可能导致过早的下溢。\n\n4. **使用求积法进行光谱积分**\n\n吸收系数 $\\kappa_{\\text{ext}}$ 随波长变化。该问题指定了一种求积方案来计算波段平均透射率。光谱带由 $M$ 个求积节点表示，索引为 $j=1, \\dots, M$。每个节点都有一个关联的权重 $w_j$（满足 $\\sum_{j=1}^M w_j = 1$）和一组依赖于层的吸收系数 $\\kappa_{i,j}$。每个索引 $j$ 代表一个“伪单色”计算。\n\n波段平均透射率 $T_{\\text{band}}$ 是每个求积节点上透射率的加权平均值：\n$$ T_{\\text{band}} = \\sum_{j=1}^M w_j T_j $$\n其中 $T_j$ 是第 $j$ 个求积节点的总大气柱透射率。\n\n5. **最终计算方案**\n\n结合以上步骤，我们首先计算每个求积节点 $j$ 的总斜程光学深度：\n$$ \\tau_j = \\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i $$\n然后，我们计算每个节点的透射率：\n$$ T_j = e^{-\\tau_j} $$\n最后，我们计算波段平均透射率：\n$$ T_{\\text{band}} = \\sum_{j=1}^M w_j T_j = \\sum_{j=1}^M w_j \\exp\\left(-\\frac{1}{\\mu} \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i \\right) $$\n这就是待实现的离散计算公式。\n\n6. **数值稳定性考虑**\n\n该公式需要具有鲁棒性，尤其是在掠射角情况下，此时 $\\theta \\to 90^\\circ$，因此 $\\mu = \\cos(\\theta) \\to 0$。\n- 如果 $\\mu \\to 0$ 且总垂直光学深度 $\\delta_j = \\sum_{i=1}^N \\kappa_{i,j} \\rho_i \\Delta z_i > 0$，则斜程光学深度 $\\tau_j = \\delta_j / \\mu \\to \\infty$。物理上，这对应于无限长的路径，透射率 $T_j = e^{-\\tau_j}$ 必须为 $0$。\n- 如果总垂直光学深度 $\\delta_j = 0$（即此光谱节点无吸收），则无论 $\\mu$ 为何值，$\\tau_j = 0$，透射率 $T_j = e^0 = 1$。\n- 在实现时，我们首先计算总垂直光学深度向量 $\\{\\delta_j\\}_{j=1}^M$。如果 $\\theta \\ge 90^\\circ$，我们检查每个 $\\delta_j$：若 $\\delta_j > 0$，则设 $T_j=0$；否则，设 $T_j=1$。如果 $\\theta < 90^\\circ$，我们计算 $\\mu = \\cos(\\theta_{\\text{rad}})$ 并继续进行 $\\tau_j$ 和 $T_j$ 的完整计算。这种方法避免了除以零，并确保了在地平线处的物理行为正确性。使用 NumPy 的向量化操作可以高效、简洁地实现此逻辑。`np.exp(-large_number)` 的计算会正确地下溢到 $0.0$，满足了对于极大光学深度的稳定性要求。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes direct-beam band-mean transmittance for multiple atmospheric test cases.\n\n    The function implements a discrete radiative transfer model for an absorption-only,\n    plane-parallel atmosphere. The model uses a quadrature scheme (k-distribution)\n    to handle spectrally varying absorption.\n\n    The calculation follows these steps:\n    1. For each quadrature node j, calculate the total vertical optical depth (VOD) by\n       summing the layer VODs over all N layers: delta_j = sum_{i=1 to N} (kappa_{i,j} * rho_i * delta_z_i).\n    2. Calculate the cosine of the solar zenith angle, mu = cos(theta).\n    3. Calculate the slant optical depth for each node: tau_j = delta_j / mu. A special\n       case is handled for grazing angles (theta >= 90 deg) to avoid division by zero\n       and ensure physical correctness.\n    4. Compute the transmittance for each node: T_j = exp(-tau_j).\n    5. The final band-mean transmittance is the weighted sum over all quadrature\n       nodes: T_band = sum_{j=1 to M} (w_j * T_j).\n    \"\"\"\n\n    # Define the fixed quadrature weights for all test cases.\n    weights = np.array([0.25, 0.35, 0.20, 0.20])\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, moderate absorption, mid-zenith)\n        {\n            \"delta_z\": np.array([1000.0, 1500.0, 800.0, 1200.0]),\n            \"rho\": np.array([1.5e-5, 1.0e-5, 8.0e-6, 6.0e-6]),\n            \"theta_deg\": 60.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0],\n                [1.0, 10.0, 0.1, 3.0]\n            ])\n        },\n        # Case 2 (optically thin, near-nadir)\n        {\n            \"delta_z\": np.array([1000.0, 1000.0, 1000.0]),\n            \"rho\": np.array([2.0e-7, 1.0e-7, 1.5e-7]),\n            \"theta_deg\": 0.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0]\n            ])\n        },\n        # Case 3 (extremely optically thick, strong absorption, slanted path)\n        {\n            \"delta_z\": np.array([2000.0, 3000.0, 1500.0]),\n            \"rho\": np.array([2.0e-4, 1.5e-4, 1.0e-4]),\n            \"theta_deg\": 78.463,\n            \"kappa\": np.array([\n                [30.0, 300.0, 3.0, 100.0],\n                [25.0, 250.0, 2.5, 80.0],\n                [20.0, 200.0, 2.0, 60.0]\n            ])\n        },\n        # Case 4 (grazing angle, same as Case 1 but near-horizon)\n        {\n            \"delta_z\": np.array([1000.0, 1500.0, 800.0, 1200.0]),\n            \"rho\": np.array([1.5e-5, 1.0e-5, 8.0e-6, 6.0e-6]),\n            \"theta_deg\": 87.0,\n            \"kappa\": np.array([\n                [2.0, 20.0, 0.2, 5.0],\n                [1.5, 15.0, 0.15, 4.0],\n                [3.0, 30.0, 0.3, 6.0],\n                [1.0, 10.0, 0.1, 3.0]\n            ])\n        },\n        # Case 5 (zero absorption sanity check)\n        {\n            \"delta_z\": np.array([1000.0, 500.0]),\n            \"rho\": np.array([1.0e-3, 1.0e-3]),\n            \"theta_deg\": 45.0,\n            \"kappa\": np.array([\n                [0.0, 0.0, 0.0, 0.0],\n                [0.0, 0.0, 0.0, 0.0]\n            ])\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_z = case[\"delta_z\"]\n        rho = case[\"rho\"]\n        theta_deg = case[\"theta_deg\"]\n        kappa = case[\"kappa\"]\n\n        # Reshape rho and delta_z for broadcasting with kappa (N, M) matrix.\n        # This creates (N, 1) arrays that broadcast to (N, M).\n        rho_col = rho[:, np.newaxis]\n        delta_z_col = delta_z[:, np.newaxis]\n        \n        # Calculate vertical optical depth for each layer and each spectral node.\n        # Resulting shape is (N, M).\n        layer_vods = kappa * rho_col * delta_z_col\n        \n        # Sum over layers (axis=0) to get total vertical optical depth for each node.\n        # Resulting shape is (M,).\n        total_vod_j = layer_vods.sum(axis=0)\n        \n        # Handle grazing angle for numerical stability and physical correctness.\n        if theta_deg >= 90.0:\n            # For grazing or upward paths in plane-parallel model, path is infinite.\n            # Transmittance is 0 unless VOD is 0.\n            transmittance_j = np.where(total_vod_j > 0, 0.0, 1.0)\n        else:\n            # Convert angle to radians and compute cosine.\n            theta_rad = np.deg2rad(theta_deg)\n            mu = np.cos(theta_rad)\n            \n            # Calculate slant optical depth for each spectral node.\n            slant_tau_j = total_vod_j / mu\n            \n            # Calculate transmittance at each spectral node.\n            transmittance_j = np.exp(-slant_tau_j)\n            \n        # Compute band-mean transmittance as the weighted sum (dot product).\n        band_transmittance = np.dot(weights, transmittance_j)\n        \n        results.append(f\"{band_transmittance:.8f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}