{
    "hands_on_practices": [
        {
            "introduction": "The journey into modeling optical imaging begins with understanding how light interacts with a single, elementary feature on a photomask. This first practice challenges you to derive the diffraction pattern from a simple rectangular slit from first principles. By applying the Fraunhofer diffraction approximation , you will uncover the fundamental Fourier transform relationship between the object in the mask plane and the light distribution in the pupil plane, which governs the ultimate resolution of the system.",
            "id": "4145745",
            "problem": "In advanced optical lithography for semiconductor manufacturing, the aerial image generated by a mask opening is modeled using scalar diffraction theory under the far-field (Fraunhofer) approximation. Consider a monochromatic, coherent plane wave from a Light Amplification by Stimulated Emission of Radiation (LASER) of vacuum wavelength $\\lambda$ incident normally on a one-dimensional, infinitely extended slit in the $y$-direction with finite width $w$ in the $x$-direction. The aperture transmission is $A(x)=1$ for $|x|\\leq w/2$ and $A(x)=0$ otherwise. The observation is performed in the far field at an angle $\\theta$ relative to the optical axis (the $z$-direction), such that the scalar Kirchhoff diffraction integral reduces to the Fourier transform of $A(x)$ evaluated on the spatial frequency $k_{x}=k\\sin\\theta$, where $k=2\\pi/\\lambda$ is the free-space wavenumber.\n\nStarting from the Huygens–Fresnel principle and the Fraunhofer diffraction approximation, derive the far-field intensity distribution $I(\\theta)$ up to a multiplicative constant, and from that determine:\n\n1. The angular positions $\\theta_{m}$ of all nulls (zeros) of $I(\\theta)$, indexed by the nonzero integer order $m\\in\\mathbb{Z}\\setminus\\{0\\}$, that satisfy the physical constraint $|\\sin\\theta_{m}|\\leq 1$.\n2. The full angular width $\\Delta\\theta_{\\text{main}}$ of the main lobe, defined as the angular separation between the first two nulls symmetrically located about $\\theta=0$.\n\nExpress your final results for $\\theta_{m}$ and $\\Delta\\theta_{\\text{main}}$ as closed-form analytic expressions in terms of $w$ and $\\lambda$. Express angles in radians. No numerical evaluation or rounding is required. Your final answer must be a single composite expression containing both results.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of Fraunhofer diffraction, a cornerstone of physical optics. The problem is well-posed, with all necessary conditions and variables defined, leading to a unique and meaningful solution. The language is objective and formal.\n\nThe problem requires the derivation of the far-field intensity distribution from a single slit under coherent, monochromatic, normal illumination. According to the provided information, which aligns with the scalar theory of Fraunhofer diffraction, the complex amplitude of the diffracted electric field, $E$, in the far field at an observation angle $\\theta$ is proportional to the Fourier transform of the aperture transmission function, $A(x)$. The Fourier transform is evaluated at the spatial frequency $k_x = k\\sin\\theta$, where $k = 2\\pi/\\lambda$ is the wave number, $\\lambda$ is the vacuum wavelength of the light, and $x$ is the coordinate across the aperture.\n\nThe aperture transmission function $A(x)$ for a slit of width $w$ centered at the origin is given as:\n$$\nA(x) =\n\\begin{cases}\n1 & \\text{for } |x| \\leq w/2 \\\\\n0 & \\text{for } |x| > w/2\n\\end{cases}\n$$\nThe far-field amplitude $E(\\theta)$ is thus proportional to the Fourier transform of $A(x)$:\n$$\nE(\\theta) \\propto \\int_{-\\infty}^{\\infty} A(x) \\exp(-i k_x x) \\,dx\n$$\nSubstituting the expression for $A(x)$:\n$$\nE(\\theta) \\propto \\int_{-w/2}^{w/2} 1 \\cdot \\exp(-i k_x x) \\,dx\n$$\nWe evaluate this integral:\n$$\n\\int_{-w/2}^{w/2} \\exp(-i k_x x) \\,dx = \\left[ \\frac{\\exp(-i k_x x)}{-i k_x} \\right]_{-w/2}^{w/2}\n$$\nAssuming $k_x \\neq 0$:\n$$\n= \\frac{\\exp(-i k_x w/2) - \\exp(i k_x w/2)}{-i k_x} = \\frac{\\exp(i k_x w/2) - \\exp(-i k_x w/2)}{i k_x}\n$$\nUsing the Euler identity $\\sin(\\alpha) = \\frac{\\exp(i\\alpha) - \\exp(-i\\alpha)}{2i}$, we can rewrite the expression:\n$$\n= \\frac{2 \\sin(k_x w/2)}{k_x}\n$$\nTo express this in the form of a sinc function, we multiply and divide by $w/2$:\n$$\n= w \\frac{\\sin(k_x w/2)}{k_x w/2}\n$$\nNow, we substitute the spatial frequency $k_x = k \\sin\\theta = \\frac{2\\pi}{\\lambda}\\sin\\theta$. The argument of the sine function becomes:\n$$\n\\frac{k_x w}{2} = \\frac{1}{2} \\left( \\frac{2\\pi}{\\lambda}\\sin\\theta \\right) w = \\frac{\\pi w \\sin\\theta}{\\lambda}\n$$\nSo, the far-field amplitude is:\n$$\nE(\\theta) \\propto w \\frac{\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)}{\\frac{\\pi w \\sin\\theta}{\\lambda}}\n$$\nThe intensity $I(\\theta)$ of the diffracted light is proportional to the squared magnitude of the complex amplitude, $I(\\theta) \\propto |E(\\theta)|^2$. Therefore, up to a multiplicative constant, the intensity distribution is:\n$$\nI(\\theta) \\propto \\left[ \\frac{\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)}{\\frac{\\pi w \\sin\\theta}{\\lambda}} \\right]^2\n$$\nThis is the classic sinc-squared intensity pattern for single-slit diffraction.\n\n1. Determination of the null angular positions $\\theta_m$:\nThe nulls (zeros) of the intensity distribution $I(\\theta)$ occur where the numerator is zero, provided the denominator is non-zero. The numerator, $\\sin\\left(\\frac{\\pi w \\sin\\theta}{\\lambda}\\right)$, is zero when its argument is a non-zero integer multiple of $\\pi$.\n$$\n\\frac{\\pi w \\sin\\theta_m}{\\lambda} = m\\pi, \\quad \\text{for } m \\in \\mathbb{Z} \\setminus \\{0\\}\n$$\nThe case $m=0$ is excluded because it corresponds to $\\theta=0$. For $\\theta \\to 0$, the expression $\\sin(\\alpha)/\\alpha \\to 1$, which gives the principal maximum of the diffraction pattern, not a null.\nSolving for $\\sin\\theta_m$:\n$$\n\\sin\\theta_m = \\frac{m\\lambda}{w}\n$$\nThe angular positions $\\theta_m$ are then found by taking the arcsin of this expression. The physical constraint $|\\sin\\theta_m| \\leq 1$ means that solutions only exist for integer orders $m$ such that $|m| \\leq w/\\lambda$. The arcsin function's domain automatically respects this constraint.\n$$\n\\theta_m = \\arcsin\\left(\\frac{m\\lambda}{w}\\right), \\quad \\text{for } m \\in \\mathbb{Z} \\setminus \\{0\\} \\text{ such that } \\left|\\frac{m\\lambda}{w}\\right| \\leq 1\n$$\n\n2. Determination of the full angular width of the main lobe $\\Delta\\theta_{\\text{main}}$:\nThe main lobe is the central bright fringe, centered at $\\theta=0$. Its angular extent is bounded by the first nulls on either side of the center. These correspond to the integer orders $m=1$ and $m=-1$.\nThe angular position of the first null for $m=1$ is:\n$$\n\\theta_1 = \\arcsin\\left(\\frac{1 \\cdot \\lambda}{w}\\right) = \\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\nThe angular position of the first null for $m=-1$ is:\n$$\n\\theta_{-1} = \\arcsin\\left(\\frac{-1 \\cdot \\lambda}{w}\\right) = -\\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\nThe full angular width of the main lobe, $\\Delta\\theta_{\\text{main}}$, is the angular separation between these two nulls:\n$$\n\\Delta\\theta_{\\text{main}} = \\theta_1 - \\theta_{-1} = \\arcsin\\left(\\frac{\\lambda}{w}\\right) - \\left(-\\arcsin\\left(\\frac{\\lambda}{w}\\right)\\right)\n$$\n$$\n\\Delta\\theta_{\\text{main}} = 2\\arcsin\\left(\\frac{\\lambda}{w}\\right)\n$$\nThis expression is the exact angular width. In the common small-angle approximation where $\\lambda \\ll w$, $\\arcsin(x) \\approx x$, which would yield $\\Delta\\theta_{\\text{main}} \\approx 2\\lambda/w$. However, the problem does not specify this approximation, so the exact form is required.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\arcsin\\left(\\frac{m\\lambda}{w}\\right) & 2\\arcsin\\left(\\frac{\\lambda}{w}\\right) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Real-world lithography systems do not use a single, perfectly coherent plane wave for illumination; instead, they employ extended, partially coherent sources to optimize the imaging process. This exercise introduces the crucial concept of the partial coherence parameter, $\\sigma$, which quantifies the properties of the illumination source relative to the projection lens aperture. Mastering the calculation and interpretation of $\\sigma$  is essential for navigating the critical trade-offs between resolution, contrast, and process robustness in a manufacturing environment.",
            "id": "4145681",
            "problem": "In advanced optical lithography for semiconductor manufacturing, imaging of periodic structures is governed by diffraction and interference in a projection system whose performance is constrained by the pupil of the lens. Consider a Deep Ultraviolet (DUV) immersion projection system whose illumination is provided by a spatially uniform, circular source that fills the entrance pupil of the projection lens up to a finite angular semi-radius. The imaging occurs in an immersion medium of refractive index $n$, and the projection lens defines a maximum pupil semi-angle beyond which no diffracted orders are transmitted.\n\nStarting from first principles of diffraction-limited imaging, specifically the Abbe theory of image formation and the definition of Numerical Aperture (NA), derive an expression for the partial coherence parameter (commonly denoted by $\\sigma$) in terms of the illumination source angular semi-radius and the projection lens pupil semi-angle, both measured in the same medium. Then compute its value for the following physically consistent parameters:\n- Refractive index of the immersion medium: $n = 1.44$.\n- Illumination source angular semi-radius: $\\theta_{s} = \\frac{\\pi}{6}$ radians.\n- Projection lens maximum pupil semi-angle: $\\theta_{p} = \\frac{\\pi}{3}$ radians.\n\nFinally, briefly interpret, based on diffraction and interference arguments, how the computed value of $\\sigma$ would affect imaging contrast for a dense line-space grating whose spatial frequency is near the resolution limit of the projection system, relative to the two limiting cases of fully coherent illumination (i.e., $\\sigma \\to 0$) and quasi-incoherent illumination (i.e., $\\sigma \\to 1$).\n\nExpress the computed value of $\\sigma$ as a dimensionless number and round your answer to four significant figures. Angles are given in radians.",
            "solution": "The problem requires the derivation of the partial coherence parameter, $\\sigma$, its calculation for a given set of parameters, and a physical interpretation of its effect on image contrast. The problem is well-posed, scientifically grounded in the principles of Fourier optics as applied to lithography, and provides a consistent and complete set of parameters.\n\nThe validation process confirms the problem's validity:\n1.  **Givens Extraction**:\n    - Refractive index of immersion medium: $n = 1.44$\n    - Illumination source angular semi-radius: $\\theta_{s} = \\frac{\\pi}{6}$ radians\n    - Projection lens maximum pupil semi-angle: $\\theta_{p} = \\frac{\\pi}{3}$ radians\n2.  **Validation**:\n    - The problem is scientifically sound, resting on the established Abbe theory of imaging and the definition of partial coherence in optical lithography.\n    - All terms are well-defined, and the provided numerical values are physically realistic for a modern immersion lithography system. For instance, the numerical aperture of the projection lens would be $n \\sin(\\theta_{p}) = 1.44 \\sin(\\frac{\\pi}{3}) = 1.44 \\frac{\\sqrt{3}}{2} \\approx 1.247$, which is a typical value for such systems.\n    - The problem is self-contained and free of contradictions.\n\nThe problem is deemed valid. We proceed with the solution.\n\nThe solution is divided into three parts: derivation, calculation, and interpretation.\n\n**Part 1: Derivation of the Partial Coherence Parameter $\\sigma$**\n\nThe formation of an image in a projection system, according to the Abbe theory, is a two-step process: first, the object (photomask) diffracts the incident illumination into a spectrum of plane waves (diffraction orders); second, the projection lens collects a portion of this diffracted light within its pupil and re-interferes it to form the image on the wafer.\n\nThe extent of the collected diffracted orders is determined by the Numerical Aperture (NA) of the projection lens. The NA is defined as:\n$$\\text{NA} = n \\sin(\\theta_{\\text{max}})$$\nwhere $n$ is the refractive index of the medium in which imaging occurs and $\\theta_{\\text{max}}$ is the maximum semi-angle of the cone of light that can enter or exit the lens. For the projection lens, this angle is the pupil semi-angle, $\\theta_{p}$.\nThus, the numerical aperture of the projection lens is:\n$$\\text{NA}_{\\text{lens}} = n \\sin(\\theta_{p})$$\n\nThe illumination system is also characterized by a numerical aperture, which describes the range of angles over which the mask is illuminated. For a circular source with an angular semi-radius of $\\theta_{s}$, the numerical aperture of the illumination is:\n$$\\text{NA}_{\\text{illum}} = n \\sin(\\theta_{s})$$\n\nThe partial coherence parameter, $\\sigma$, is a dimensionless quantity that quantifies the degree of coherence of the illumination. It is defined as the ratio of the numerical aperture of the illumination system to the numerical aperture of the projection lens:\n$$\\sigma = \\frac{\\text{NA}_{\\text{illum}}}{\\text{NA}_{\\text{lens}}}$$\nThis ratio effectively compares the angular extent of the illumination source to the acceptance angle of the lens pupil, when both are projected onto the pupil plane.\n\nSubstituting the expressions for $\\text{NA}_{\\text{illum}}$ and $\\text{NA}_{\\text{lens}}$ gives:\n$$\\sigma = \\frac{n \\sin(\\theta_{s})}{n \\sin(\\theta_{p})}$$\nSince both angles are measured in the same immersion medium of refractive index $n$, the refractive index cancels out. The final derived expression is:\n$$\\sigma = \\frac{\\sin(\\theta_{s})}{\\sin(\\theta_{p})}$$\n\n**Part 2: Calculation of $\\sigma$**\n\nWe are given the following values:\n- Illumination source angular semi-radius: $\\theta_{s} = \\frac{\\pi}{6}$ radians.\n- Projection lens maximum pupil semi-angle: $\\theta_{p} = \\frac{\\pi}{3}$ radians.\n\nFirst, we compute the sine of each angle:\n$$\\sin(\\theta_{s}) = \\sin\\left(\\frac{\\pi}{6}\\right) = \\frac{1}{2}$$\n$$\\sin(\\theta_{p}) = \\sin\\left(\\frac{\\pi}{3}\\right) = \\frac{\\sqrt{3}}{2}$$\n\nNow, we substitute these values into the derived expression for $\\sigma$:\n$$\\sigma = \\frac{\\sin(\\theta_{s})}{\\sin(\\theta_{p})} = \\frac{1/2}{\\sqrt{3}/2} = \\frac{1}{\\sqrt{3}}$$\n\nTo obtain the numerical value, we compute the result and round to four significant figures as requested:\n$$\\sigma = \\frac{1}{\\sqrt{3}} \\approx 0.577350269...$$\nRounding to four significant figures yields:\n$$\\sigma \\approx 0.5774$$\n\n**Part 3: Interpretation of the Effect on Imaging Contrast**\n\nThe computed value $\\sigma \\approx 0.5774$ represents a state of partial coherence. We are asked to compare the imaging contrast for a dense grating near the resolution limit under this condition with the limiting cases of fully coherent illumination ($\\sigma \\to 0$) and quasi-incoherent illumination ($\\sigma \\to 1$).\n\nImage contrast for a periodic structure arises from the interference of at least two diffraction orders ($0^\\text{th}$ and $\\pm 1^\\text{st}$ for a simple grating) collected by the lens pupil.\n\n- **Fully Coherent Illumination ($\\sigma \\to 0$)**: The illumination is a single, on-axis plane wave. The diffraction orders are discrete points in the pupil. If the $0^\\text{th}$ and $\\pm 1^\\text{st}$ orders are captured, they interfere with fixed phase relationships. This can produce the highest possible image contrast (modulation), potentially reaching $100\\%$. However, the resolution is limited, and this ideal contrast is highly sensitive to aberrations like defocus.\n\n- **Quasi-Incoherent Illumination ($\\sigma \\to 1$)**: The illumination source fills the entire pupil ($\\text{NA}_{\\text{illum}} \\approx \\text{NA}_{\\text{lens}}$). The final image is an intensity sum of images produced by each independent point on the source. For a grating near the resolution limit, many illumination angles will result in only the $0^\\text{th}$ order being captured, which contributes a uniform background intensity and does not form a pattern. This addition of background light severely degrades the overall image contrast, even though some off-axis points on the source might enhance resolution compared to the on-axis coherent case.\n\n- **Partial Coherence ($\\sigma \\approx 0.5774$)**: This is a practical compromise. The illumination source is extended but smaller than the pupil. Compared to the coherent case ($\\sigma \\to 0$), contrast is reduced. The reason is that interference is averaged over a continuous range of illumination angles. This averaging process blurs the sharp nulls of the ideal coherent interference pattern, thus reducing the peak-to-valley intensity difference (modulation). However, compared to the quasi-incoherent case ($\\sigma \\to 1$), the contrast is significantly higher. By limiting the source size ($\\sigma  1$), we exclude those illumination angles that contribute only background light and no pattern information. This preserves a substantial portion of the interference-based modulation while gaining some of the benefits of off-axis illumination, such as improved resolution for certain feature types and better depth of focus, which are critical for robust manufacturing processes.\n\nIn summary, the computed $\\sigma$ value provides a balance, sacrificing some of the maximal theoretical contrast of coherent imaging to achieve higher practical resolution and process stability compared to both the purely coherent and quasi-incoherent limits.",
            "answer": "$$\\boxed{0.5774}$$"
        },
        {
            "introduction": "Moving from analysis to design, this final practice simulates a core task in modern computational lithography: optimizing the illumination source to print a desired pattern. You will implement a scalar imaging model to computationally search for the ideal annular illumination parameters that maximize image contrast for a given feature pitch. This hands-on coding challenge  provides direct insight into the powerful Resolution Enhancement Techniques (RET) that enable the manufacturing of today's most advanced semiconductor devices.",
            "id": "4145707",
            "problem": "You are asked to write a program that, for a one-dimensional periodic line-space pattern imaged by a scalar, unaberrated projection system, computes the optimal annular source parameters $\\left(\\sigma_{in},\\sigma_{out}\\right)$ that maximize aerial image contrast at the fundamental spatial frequency of the pattern. The setting reflects advanced optical lithography at wavelength $\\lambda=193\\,\\mathrm{nm}$ and Numerical Aperture (NA) $=0.93$, with partially coherent illumination modeled as a uniform-intensity annulus in the source pupil. The objective is to formulate the physically consistent image formation under partially coherent illumination using scalar Fourier optics from first principles, then implement a numerical search over annular source parameters that maximizes contrast. Your program must implement the model and perform the optimization for a provided test suite of target pitches.\n\nFundamental physical and modeling assumptions:\n- Use scalar Abbe imaging in the spatial frequency domain. Let the pupil cutoff spatial frequency be $f_c=\\mathrm{NA}/\\lambda$. A source point is represented in normalized pupil coordinates by radius $\\sigma\\in[0,1]$ and azimuth $\\theta\\in[0,2\\pi)$, where $\\sigma=1$ corresponds to the pupil edge.\n- Consider a one-dimensional, binary amplitude mask (thin, no imaging bias) consisting of periodic line-space with duty factor $0.5$ (i.e., equal line and space widths). The mask amplitude transmittance has Fourier series amplitudes given by $A_0=0.5$ and $A_{\\pm 1}=1/\\pi$, and $A_m=0$ for even $m\\neq 0$. These are obtained from the standard Fourier series of a $50\\%$ duty cycle rectangular wave.\n- Only the diffraction orders $m=0$ and $m=\\pm 1$ need to be considered in the aerial image (neglect higher orders). The pattern spatial frequency is $k=1/p$, where $p$ is the pitch. Introduce the normalized frequency $\\nu=\\lambda/(\\mathrm{NA}\\,p)$.\n- For a given source point $\\left(\\sigma,\\theta\\right)$, the $m=0$ order lies at normalized pupil coordinate $\\sigma\\cos\\theta$, the $m=+1$ order at $\\sigma\\cos\\theta+\\nu$, and the $m=-1$ order at $\\sigma\\cos\\theta-\\nu$ in the one-dimensional cut along the line-space direction. An order is transmitted if and only if its normalized coordinate magnitude is $\\leq 1$.\n- The aerial image intensity is obtained by incoherently averaging the intensities formed by each source point over the source annulus. Because of partial coherence, you must average intensities (not fields). The contribution to the fundamental spatial frequency arises from interference between the $m=0$ order and each of the $m=\\pm 1$ orders that are transmitted. The contribution from the $m=+1$ and $m=-1$ branches add at the same phase for a telecentric projection system at best focus.\n\nDefinition of contrast and computation to be implemented:\n- For a single source point $\\left(\\sigma,\\theta\\right)$, define indicator functions $P_{+}(\\sigma,\\theta;\\nu)$ and $P_{-}(\\sigma,\\theta;\\nu)$ that are $1$ if the $m=+1$ or $m=-1$ order is transmitted, respectively, and $0$ otherwise. Use the pass conditions $|\\sigma\\cos\\theta+\\nu|\\leq 1$ and $|\\sigma\\cos\\theta-\\nu|\\leq 1$. Angles must be in radians.\n- For that single source point, the intensity’s fundamental harmonic (coefficient of $\\cos(2\\pi x/p)$) has amplitude proportional to $2A_0A_1\\left(P_{+}+P_{-}\\right)$, while the direct current (DC) intensity (spatial average) is $A_0^2 + A_1^2\\left(P_{+}+P_{-}\\right)$, when only $m=0$ and $m=\\pm 1$ are kept.\n- The partially coherent image contrast is the ratio of the source-averaged fundamental amplitude to the source-averaged DC intensity, with averaging over the annular source area element proportional to $\\sigma\\,d\\sigma\\,d\\theta$. That is, you must compute an area-weighted average over $\\sigma\\in[\\sigma_{in},\\sigma_{out}]$ and $\\theta\\in[0,2\\pi)$.\n\nOptimization task:\n- For each target pitch $p$, perform a discrete grid search over annular sources $\\left(\\sigma_{in},\\sigma_{out}\\right)$ subject to $0\\le \\sigma_{in}\\sigma_{out}\\le 1$, a minimum annular thickness constraint $\\sigma_{out}-\\sigma_{in}\\ge \\Delta\\sigma_{min}$, and a uniform source intensity over the annulus.\n- Use a uniform grid in $\\sigma$ with step $\\Delta\\sigma=0.01$ and restrict $\\sigma_{in}\\ge 0.20$ to reflect practical source obscuration. Use $\\Delta\\sigma_{min}=0.05$. Use uniform angular sampling with $N_\\theta=4096$ samples in $[0,2\\pi)$ in radians for the $\\theta$ integration.\n- For each candidate annulus, numerically approximate the contrast by discrete summation consistent with the above model. Then select the $\\left(\\sigma_{in},\\sigma_{out}\\right)$ that maximizes the contrast.\n- Tie-breaking: If multiple candidates achieve the maximum contrast within an absolute tolerance of $10^{-12}$, select the one with the smallest annular thickness $\\sigma_{out}-\\sigma_{in}$. If still tied, choose the smallest $\\sigma_{out}$, and then the smallest $\\sigma_{in}$.\n- In the edge case where the maximum contrast over all candidates equals zero within absolute tolerance $10^{-12}$ (i.e., no resolvable first-order diffraction for any source point, such as when $\\nu2$), return $\\left(-1.0,-1.0\\right)$ for that test case.\n\nNumerical constants and units:\n- Use $\\lambda=193\\,\\mathrm{nm}$ and $\\mathrm{NA}=0.93$.\n- Target pitches $p$ are specified in nanometers and must be treated consistently with $\\lambda$ to compute $\\nu=\\lambda/(\\mathrm{NA}\\,p)$.\n- Angles must be in radians.\n- Your output parameters $\\sigma_{in},\\sigma_{out}$ are dimensionless and must be rounded to three decimal places.\n\nTest suite:\n- Use the following four pitches: $p\\in\\{220\\,\\mathrm{nm},130\\,\\mathrm{nm},105\\,\\mathrm{nm},95\\,\\mathrm{nm}\\}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing a Python-like list with four elements, one per test case, in the same order as above. Each element must be a two-element list containing $\\left[\\sigma_{in},\\sigma_{out}\\right]$ rounded to three decimal places. For example, a valid output line has the form $[[0.300,0.700],[0.250,0.850],[0.210,0.780],[-1.000,-1.000]]$ with no extra spaces beyond those necessary to separate tokens.\n\nNo user input is allowed; the program must run as is and print the single required line. Your implementation must adhere to the integration and discretization instructions above and must not invoke any external files or networks.",
            "solution": "The user has provided a well-defined problem in the field of optical lithography modeling. A validation of the problem statement has been performed, and it has been found to be scientifically sound, well-posed, and objective. The problem requires the determination of optimal annular illumination parameters to maximize aerial image contrast for several periodic patterns. The solution will be derived from first principles of scalar Fourier optics and implemented numerically as a grid search optimization according to the specified constraints.\n\nThe solution proceeds in three main stages:\n1.  **Analytical Formulation**: We derive the expression for aerial image contrast under partially coherent annular illumination.\n2.  **Numerical Approximation**: We discretize the analytical expression to enable numerical computation as per the problem's requirements.\n3.  **Optimization Algorithm**: We design a grid search algorithm to find the optimal source parameters that maximize the computed contrast, including the specified tie-breaking logic.\n\n**1. Analytical Formulation of Contrast**\n\nThe system consists of a projection system with numerical aperture $NA$ imaging a periodic mask of pitch $p$ at wavelength $\\lambda$. The key parameter governing resolution is the normalized spatial frequency $\\nu$ of the pattern:\n$$ \\nu = \\frac{\\lambda}{NA \\cdot p} $$\nThe mask is a 1D line-space pattern with a $50\\%$ duty cycle. For such a binary amplitude grating, the Fourier series amplitudes of its transmittance function are given. We consider only the three central diffraction orders: the zeroth order ($m=0$) and the first orders ($m=\\pm 1$). Their amplitudes are provided as $A_0 = 0.5$ and $A_1 = 1/\\pi$ (we assume $A_{-1} = A_1$ in magnitude, as is standard and implied by the problem formulation).\n\nThe illumination is partially coherent, originating from an annular source. A point on the source is described by normalized pupil coordinates $(\\sigma, \\theta)$, where $\\sigma$ is the radial coordinate ($0 \\le \\sigma \\le 1$) and $\\theta$ is the azimuthal angle ($0 \\le \\theta  2\\pi$). For a source point at $(\\sigma, \\theta)$, the three diffraction orders are shifted in the pupil of the projection lens. Along the axis parallel to the pattern's periodicity, their normalized positions are:\n-   $m=0$ order: $u_0 = \\sigma \\cos\\theta$\n-   $m=+1$ order: $u_{+1} = \\sigma \\cos\\theta + \\nu$\n-   $m=-1$ order: $u_{-1} = \\sigma \\cos\\theta - \\nu$\n\nAn order is transmitted through the system if its position magnitude does not exceed the pupil radius, i.e., $|u_m| \\le 1$. The $m=0$ order is always transmitted since $|\\sigma \\cos\\theta| \\le \\sigma \\le 1$. The transmission of the first orders is conditional. We define indicator functions $P_{+}(\\sigma, \\theta; \\nu)$ and $P_{-}(\\sigma, \\theta; \\nu)$:\n$$ P_{+}(\\sigma, \\theta; \\nu) = \\begin{cases} 1,  \\text{if } |\\sigma \\cos\\theta + \\nu| \\le 1 \\\\ 0,  \\text{otherwise} \\end{cases} $$\n$$ P_{-}(\\sigma, \\theta; \\nu) = \\begin{cases} 1,  \\text{if } |\\sigma \\cos\\theta - \\nu| \\le 1 \\\\ 0,  \\text{otherwise} \\end{cases} $$\nFor a single source point, the aerial image intensity $I(x)$ results from the interference of the transmitted orders. The image contrast is defined by the fundamental harmonic component and the DC (average) intensity. Using the provided model:\n-   Amplitude of the fundamental harmonic (proportional to $\\cos(2\\pi x/p)$): $N_{sp}(\\sigma, \\theta) = 2 A_0 A_1 (P_{+} + P_{-})$\n-   DC component of intensity: $D_{sp}(\\sigma, \\theta) = A_0^2 + A_1^2 (P_{+} + P_{-})$\n\nTo find the contrast for the full annular source, defined by an inner radius $\\sigma_{in}$ and an outer radius $\\sigma_{out}$, we must average these quantities over the area of the annulus. The area element is $dA = \\sigma \\, d\\sigma \\, d\\theta$.\nThe source-averaged fundamental amplitude is $\\langle N \\rangle$ and the source-averaged DC intensity is $\\langle D \\rangle$. The image contrast $C$ is their ratio:\n$$ C = \\frac{\\langle N \\rangle}{\\langle D \\rangle} = \\frac{\\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} N_{sp}(\\sigma, \\theta) \\, \\sigma \\, d\\sigma \\, d\\theta}{\\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} D_{sp}(\\sigma, \\theta) \\, \\sigma \\, d\\sigma \\, d\\theta} $$\nSubstituting the expressions for $N_{sp}$ and $D_{sp}$:\n$$ C(\\sigma_{in}, \\sigma_{out}, \\nu) = \\frac{2 A_0 A_1 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} (P_{+} + P_{-}) \\, \\sigma \\, d\\sigma \\, d\\theta}{A_0^2 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} \\sigma \\, d\\sigma \\, d\\theta + A_1^2 \\int_{\\sigma_{in}}^{\\sigma_{out}} \\int_{0}^{2\\pi} (P_{+} + P_{-}) \\, \\sigma \\, d\\sigma \\, d\\theta} $$\nLet's define two integrals to simplify this expression. First, an angular integral $I(\\sigma, \\nu)$:\n$$ I(\\sigma, \\nu) = \\int_{0}^{2\\pi} [P_{+}(\\sigma, \\theta; \\nu) + P_{-}(\\sigma, \\theta; \\nu)] \\, d\\theta $$\nAnd a radial integral $J(\\sigma_{in}, \\sigma_{out}, \\nu)$:\n$$ J(\\sigma_{in}, \\sigma_{out}, \\nu) = \\int_{\\sigma_{in}}^{\\sigma_{out}} I(\\sigma, \\nu) \\, \\sigma \\, d\\sigma $$\nThe integral of the source area in the denominator is simply $\\int_{\\sigma_{in}}^{\\sigma_{out}} 2\\pi\\sigma \\, d\\sigma = \\pi(\\sigma_{out}^2 - \\sigma_{in}^2)$.\nThe contrast expression becomes:\n$$ C(\\sigma_{in}, \\sigma_{out}, \\nu) = \\frac{2 A_0 A_1 J(\\sigma_{in}, \\sigma_{out}, \\nu)}{\\pi A_0^2 (\\sigma_{out}^2 - \\sigma_{in}^2) + A_1^2 J(\\sigma_{in}, \\sigma_{out}, \\nu)} $$\n\n**2. Numerical Approximation**\n\nTo find the optimal $(\\sigma_{in}, \\sigma_{out})$, we must evaluate this contrast expression numerically. The problem specifies the discretization methods.\n-   The angular integral $I(\\sigma, \\nu)$ is approximated by a sum over $N_\\theta = 4096$ equally spaced angles $\\theta_j = j \\frac{2\\pi}{N_\\theta}$ for $j=0, \\dots, N_\\theta-1$.\n$$ I(\\sigma, \\nu) \\approx \\frac{2\\pi}{N_\\theta} \\sum_{j=0}^{N_\\theta-1} [P_{+}(\\sigma, \\theta_j; \\nu) + P_{-}(\\sigma, \\theta_j; \\nu)] $$\n-   The optimization is a grid search over discrete values of $\\sigma_{in}$ and $\\sigma_{out}$. The grid for $\\sigma$ has a step of $\\Delta\\sigma = 0.01$. The radial integral $J$ is calculated for each candidate annulus $(\\sigma_{in}, \\sigma_{out})$ from this grid. We use the trapezoidal rule for this integral:\n$$ J(\\sigma_{in}, \\sigma_{out}, \\nu) \\approx \\int_{\\sigma_{in}}^{\\sigma_{out}} I(\\sigma, \\nu) \\sigma \\, d\\sigma $$\nThe numerical evaluation will be performed on the set of discrete $\\sigma$ points falling within the $[\\sigma_{in}, \\sigma_{out}]$ interval.\n\n**3. Optimization Algorithm**\n\nFor each target pitch $p$, we perform the following steps:\n1.  Calculate the normalized frequency $\\nu$. If $\\nu  2$, no first-order diffraction is possible (since we need $|\\sigma \\cos\\theta \\pm \\nu| \\le 1$, which requires $|\\pm \\nu| - |\\sigma \\cos\\theta| \\le 1 \\implies \\nu - \\sigma \\le 1 \\implies \\nu-1 \\le \\sigma \\le 1$, which is impossible if $\\nu2$). In this case, contrast is always zero, and we return $(-1.0, -1.0)$.\n2.  Define the discrete $\\sigma$ grid from $\\sigma=0.20$ to $\\sigma=1.00$ with step $\\Delta\\sigma = 0.01$.\n3.  Pre-compute the values of $I(\\sigma, \\nu)$ for each $\\sigma$ on the grid using the discrete angular summation.\n4.  Initialize `best_contrast` to a negative value and `best_params` to a default.\n5.  Iterate through all valid candidate annuli $(\\sigma_{in}, \\sigma_{out})$ from the $\\sigma$ grid, subject to the constraints:\n    - $\\sigma_{in} \\ge 0.20$\n    - $\\sigma_{in}  \\sigma_{out}$\n    - $\\sigma_{out} - \\sigma_{in} \\ge 0.05$\n6.  For each candidate annulus:\n    a. Calculate $J(\\sigma_{in}, \\sigma_{out}, \\nu)$ via numerical integration (trapezoidal rule) of the pre-computed $I(\\sigma, \\nu)\\sigma$ values.\n    b. Calculate the contrast $C$ using the formula derived in Part 1.\n    c. Compare the calculated contrast with the current maximum. If it is higher, update `best_contrast` and `best_params`. The comparison and update process must strictly follow the specified tie-breaking rules:\n        i.  Highest contrast wins (within a tolerance of $10^{-12}$).\n        ii. If tied, smallest thickness $(\\sigma_{out} - \\sigma_{in})$ wins.\n        iii. If still tied, smallest $\\sigma_{out}$ wins.\n        iv. If still tied, smallest $\\sigma_{in}$ wins (this is resolved by the loop order).\n7.  After checking all candidates, if the overall `best_contrast` is zero (or below the $10^{-12}$ tolerance), return $(-1.0, -1.0)$. Otherwise, return the stored `best_params`.\n8.  The final results for all pitches are collected and formatted as required.\nThis computational procedure is implemented in the following Python script.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    # Define physical constants and test cases\n    lambda_ = 193.0  # Wavelength in nm\n    NA = 0.93        # Numerical Aperture\n    test_pitches = [220.0, 130.0, 105.0, 95.0]  # Pitches in nm\n\n    # Model parameters\n    A0 = 0.5\n    A1 = 1.0 / np.pi\n    \n    # Grid search and integration parameters\n    sigma_min_in = 0.20\n    sigma_max_out = 1.00\n    d_sigma = 0.01\n    min_thickness = 0.05\n    n_theta = 4096\n    \n    # Tolerance for floating point comparisons\n    tol = 1e-12\n\n    results = []\n    for p in test_pitches:\n        s_in, s_out = find_optimal_annulus(p, lambda_, NA, A0, A1,\n                                           sigma_min_in, sigma_max_out, d_sigma,\n                                           min_thickness, n_theta, tol)\n        results.append((s_in, s_out))\n    \n    # Format the output as specified\n    formatted_results = [f\"[{res[0]:.3f},{res[1]:.3f}]\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef find_optimal_annulus(p, lambda_, NA, A0, A1,\n                        sigma_min_in, sigma_max_out, d_sigma,\n                        min_thickness, n_theta, tol):\n    \"\"\"\n    Finds the optimal annular source parameters (sigma_in, sigma_out) for a given pitch.\n    \"\"\"\n    nu = lambda_ / (NA * p)\n    \n    # If nu  2, no first-order diffraction is possible. Contrast is always 0.\n    if nu  2.0:\n        return -1.0, -1.0\n\n    # Define the discrete grid for sigma\n    sigma_grid = np.round(np.arange(sigma_min_in, sigma_max_out + d_sigma/2, d_sigma), 2)\n    num_sigma_points = len(sigma_grid)\n    \n    # Pre-compute angular integral I(sigma, nu) for each sigma on the grid\n    theta = np.linspace(0, 2 * np.pi, n_theta, endpoint=False)\n    cos_theta = np.cos(theta)\n    \n    I_vals = np.zeros(num_sigma_points)\n    for i, sigma in enumerate(sigma_grid):\n        u = sigma * cos_theta\n        P_plus = np.abs(u + nu) = 1.0\n        P_minus = np.abs(u - nu) = 1.0\n        integrand_theta = P_plus + P_minus\n        # discrete integration over theta: sum * d_theta = mean * N_theta * (2*pi/N_theta)\n        I_vals[i] = np.mean(integrand_theta) * 2 * np.pi\n\n    # The integrand for the radial integral J is I(sigma, nu) * sigma\n    integrand_J = I_vals * sigma_grid\n\n    # Initialize variables for optimization\n    best_contrast = -1.0\n    best_params = (-1.0, -1.0)\n    best_thickness = float('inf')\n    best_s_out = float('inf')\n\n    min_thickness_idx_delta = int(round(min_thickness / d_sigma))\n\n    # Grid search over all valid annuli\n    for i in range(num_sigma_points):\n        s_in = sigma_grid[i]\n        # Ensure minimum thickness constraint is met\n        for j in range(i + min_thickness_idx_delta, num_sigma_points):\n            s_out = sigma_grid[j]\n            \n            # Extract sub-arrays for integration over the current annulus\n            sub_sigma_grid = sigma_grid[i:j+1]\n            sub_integrand_J = integrand_J[i:j+1]\n            \n            # The radial integral J, evaluated numerically using the trapezoidal rule.\n            # np.trapz is part of numpy 1.23.5\n            J_val = np.trapz(sub_integrand_J, x=sub_sigma_grid)\n            \n            if abs(J_val)  1e-15:\n                current_contrast = 0.0\n            else:\n                num_term = 2 * A0 * A1 * J_val\n                den_term1 = np.pi * A0**2 * (s_out**2 - s_in**2)\n                den_term2 = A1**2 * J_val\n                current_contrast = num_term / (den_term1 + den_term2)\n\n            current_thickness = s_out - s_in\n\n            # Tie-breaking logic, applied with a numerical tolerance\n            if current_contrast  best_contrast + tol:\n                best_contrast = current_contrast\n                best_params = (s_in, s_out)\n                best_thickness = current_thickness\n                best_s_out = s_out\n            elif abs(current_contrast - best_contrast) = tol:\n                if current_thickness  best_thickness - tol:\n                    best_params = (s_in, s_out)\n                    best_thickness = current_thickness\n                    best_s_out = s_out\n                elif abs(current_thickness - best_thickness) = tol:\n                    if s_out  best_s_out - tol:\n                        best_params = (s_in, s_out)\n                        best_s_out = s_out\n                        # The final tie-breaker on s_in is implicitly handled\n                        # by the loop order, which tests smaller s_in first.\n\n    # Final check for the edge case where no configuration yields contrast\n    if best_contrast = tol:\n      return -1.0, -1.0\n    \n    return best_params\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}