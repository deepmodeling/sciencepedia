{
    "hands_on_practices": [
        {
            "introduction": "A deep understanding of partially coherent imaging begins with its mathematical core, the Transmission Cross Coefficient (TCC). The TCC is the kernel in the Hopkins bilinear integral that fully encapsulates the properties of the illumination source and the projection pupil. This exercise  provides foundational practice by guiding you through the analytical derivation of the TCC for a system with a Gaussian source and an apodized pupil. By subsequently using this derived TCC to calculate the image contrast for a simple periodic mask, you will forge a direct link between the abstract properties of the optical system and a tangible, measurable imaging outcome.",
            "id": "4130992",
            "problem": "Consider a one-dimensional, scalar, partially coherent imaging system used in semiconductor lithography, modeled within the Hopkins framework. The illumination source angular distribution in spatial-frequency space is described by a Gaussian, and the projection optics exhibit a cosine amplitude apodization across the pupil. Let the source be characterized by\n$$S(\\sigma) = S_{0} \\exp\\!\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right),$$\nwhere $\\sigma$ is the one-dimensional source spatial-frequency coordinate, $S_{0}$ is a positive constant, and $\\sigma_{s} > 0$ quantifies the width of the Gaussian distribution. Let the pupil amplitude apodization be given by\n$$P(k) = \\cos\\!\\left(\\frac{\\pi}{2}\\,\\frac{k}{k_{c}}\\right)$$\nfor $|k| \\leq k_{c}$ and $P(k) = 0$ otherwise, where $k$ is the one-dimensional spatial-frequency coordinate in the pupil plane and $k_{c} > 0$ is the pupil cut-off spatial frequency set by the Numerical Aperture and the wavelength. Assume the illumination is sufficiently narrow relative to the pupil stop, specifically $\\sigma_{s} \\ll k_{c}$, so that the principal contribution to the relevant integrals arises from $|\\sigma| \\ll k_{c}$ and the finite pupil support can be neglected when evaluating convolutions of $S(\\sigma)$ with smooth functions of $k$.\n\nStarting from first principles of scalar linear systems and the foundations of the Hopkins formulation (the image intensity being bilinear in the mask spectrum with a kernel determined by the source angular distribution and the pupil amplitude), derive an analytic expression for the Transmission Cross Coefficient (TCC), defined as the bilinear kernel that maps the object spectrum into the image intensity spectrum, for the specified Gaussian source and cosine-apodized pupil under the narrow-source approximation stated above.\n\nThen, consider a periodic mask whose complex amplitude transmission has a one-dimensional spectrum\n$$M(k) = M_{0}\\,\\big[\\delta(k - f_{0}) + \\delta(k + f_{0})\\big],$$\nwith $M_{0} > 0$ and fundamental spatial frequency $f_{0} > 0$. Using the derived TCC, express the Michelson contrast of the image intensity for this mask, defined as $C = I_{2 f_{0}}/I_{0}$ where $I_{0}$ is the mean (zero-frequency) component of the image intensity and $I_{2 f_{0}}$ is the cosine-modulation amplitude at spatial frequency $2 f_{0}$ that appears in the image intensity due to the bilinear nature of partially coherent imaging. Provide a single closed-form analytic expression for $C$ in terms of $\\sigma_{s}$, $k_{c}$, and $f_{0}$.\n\nNo numerical evaluation is required, and no rounding is needed. Express the final answer as a single closed-form analytic expression without units.",
            "solution": "The problem requires the derivation of the Transmission Cross Coefficient (TCC) for a one-dimensional partially coherent imaging system and subsequently using it to find the image contrast for a specific periodic mask.\n\n### Step 1: Derivation of the Transmission Cross Coefficient (TCC)\n\nThe Hopkins formulation describes the intensity in the image plane, $I(x)$, as a bilinear transformation of the mask's complex amplitude spectrum, $M(k)$. For a one-dimensional system, this is given by:\n$$I(x) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} M(k_1) M^*(k_2) \\text{TCC}(k_1, k_2) \\exp(i(k_1 - k_2)x) \\, dk_1 \\, dk_2$$\nThe kernel of this transformation, $\\text{TCC}(k_1, k_2)$, is the Transmission Cross Coefficient. It is defined by the convolution of the source's angular distribution, $S(\\sigma)$, with the pupil functions, $P(k)$. For a 1D system, it is:\n$$\\text{TCC}(k_1, k_2) = \\int_{-\\infty}^{\\infty} S(\\sigma) P(\\sigma + k_1) P^*(\\sigma + k_2) \\, d\\sigma$$\nwhere $\\sigma$ is the spatial frequency coordinate for the source, and $k_1, k_2$ are spatial frequency coordinates for the mask spectrum.\n\nThe problem provides the following givens:\n1.  The source distribution: $S(\\sigma) = S_{0} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right)$, where $S_0$ is a positive constant.\n2.  The pupil amplitude function: $P(k) = \\cos\\left(\\frac{\\pi k}{2 k_{c}}\\right)$ for $|k| \\leq k_{c}$ and $P(k) = 0$ otherwise. Since $P(k)$ is real, the complex conjugate $P^*(k)$ is equal to $P(k)$.\n3.  The narrow-source approximation: $\\sigma_s \\ll k_c$. This implies that the Gaussian source $S(\\sigma)$ is very narrow compared to the width of the pupil. The problem statement specifies that this allows neglecting the finite pupil support in the integration. This means we can use the cosine expression for $P(k)$ over the entire integration domain with respect to $\\sigma$, as the rapidly decaying Gaussian $S(\\sigma)$ will make contributions from regions where $|\\sigma+k_{1,2}| > k_c$ negligible, assuming $|k_{1,2}| \\le k_c$.\n\nSubstituting the given $S(\\sigma)$ and $P(k)$ into the TCC definition:\n$$\\text{TCC}(k_1, k_2) = \\int_{-\\infty}^{\\infty} S_{0} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\cos\\left(\\frac{\\pi (\\sigma + k_1)}{2 k_c}\\right) \\cos\\left(\\frac{\\pi (\\sigma + k_2)}{2 k_c}\\right) \\, d\\sigma$$\nWe use the trigonometric product-to-sum identity $\\cos(A)\\cos(B) = \\frac{1}{2}[\\cos(A+B) + \\cos(A-B)]$.\nLet $A = \\frac{\\pi (\\sigma + k_1)}{2 k_c}$ and $B = \\frac{\\pi (\\sigma + k_2)}{2 k_c}$. Then:\n$$A+B = \\frac{\\pi}{2 k_c} (2\\sigma + k_1 + k_2)$$\n$$A-B = \\frac{\\pi}{2 k_c} (k_1 - k_2)$$\nThe TCC integral becomes:\n$$\\text{TCC}(k_1, k_2) = \\frac{S_0}{2} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\left[ \\cos\\left(\\frac{\\pi(k_1 - k_2)}{2 k_c}\\right) + \\cos\\left(\\frac{\\pi(2\\sigma + k_1 + k_2)}{2 k_c}\\right) \\right] \\, d\\sigma$$\nWe can split this into two integrals:\n$$\\text{TCC}(k_1, k_2) = \\frac{S_0}{2} \\cos\\left(\\frac{\\pi(k_1 - k_2)}{2 k_c}\\right) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) d\\sigma + \\frac{S_0}{2} \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\cos\\left(\\frac{\\pi\\sigma}{k_c} + \\frac{\\pi(k_1 + k_2)}{2 k_c}\\right) d\\sigma$$\nThe first integral is a standard Gaussian integral: $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)dx = \\sqrt{\\pi/a}$. Here, $a = 1/(2\\sigma_s^2)$, so the integral is $\\sqrt{2\\pi\\sigma_s^2} = \\sqrt{2\\pi}\\sigma_s$.\nThe second integral involves a cosine term with argument depending on $\\sigma$. Using $\\cos(X+Y) = \\cos(X)\\cos(Y) - \\sin(X)\\sin(Y)$:\n$$\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\left[ \\cos\\left(\\frac{\\pi\\sigma}{k_c}\\right)\\cos\\left(\\frac{\\pi(k_1+k_2)}{2k_c}\\right) - \\sin\\left(\\frac{\\pi\\sigma}{k_c}\\right)\\sin\\left(\\frac{\\pi(k_1+k_2)}{2k_c}\\right) \\right] d\\sigma$$\nThe term with $\\sin(\\pi\\sigma/k_c)$ integrates to zero because it is an odd function of $\\sigma$ multiplied by an even function, integrated over a symmetric interval $(-\\infty, \\infty)$.\nThe remaining integral is:\n$$\\cos\\left(\\frac{\\pi(k_1+k_2)}{2k_c}\\right) \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\cos\\left(\\frac{\\pi\\sigma}{k_c}\\right) d\\sigma$$\nThis is a standard Fourier cosine transform of a Gaussian. Using the integral identity $\\int_{-\\infty}^{\\infty} \\exp(-ax^2)\\cos(bx)dx = \\sqrt{\\pi/a} \\exp(-b^2/(4a))$, with $a=1/(2\\sigma_s^2)$ and $b=\\pi/k_c$:\n$$\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{\\sigma^{2}}{2 \\sigma_{s}^{2}}\\right) \\cos\\left(\\frac{\\pi\\sigma}{k_c}\\right) d\\sigma = \\sqrt{2\\pi\\sigma_s^2} \\exp\\left(-\\frac{(\\pi/k_c)^2}{4/(2\\sigma_s^2)}\\right) = \\sqrt{2\\pi}\\sigma_s \\exp\\left(-\\frac{\\pi^2 \\sigma_s^2}{2 k_c^2}\\right)$$\nCombining the results for both parts of the TCC integral:\n$$\\text{TCC}(k_1, k_2) = \\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ \\cos\\left(\\frac{\\pi(k_1-k_2)}{2k_c}\\right) + \\cos\\left(\\frac{\\pi(k_1+k_2)}{2k_c}\\right) \\exp\\left(-\\frac{\\pi^2 \\sigma_s^2}{2 k_c^2}\\right) \\right]$$\nThis is the analytic expression for the TCC under the given conditions.\n\n### Step 2: Calculation of the Image Contrast\n\nThe problem provides a periodic mask with spectrum $M(k) = M_{0}\\big[\\delta(k - f_{0}) + \\delta(k + f_{0})\\big]$. Since $M(k)$ is real, $M^*(k) = M(k)$. We substitute this into the expression for image intensity $I(x)$:\n$$I(x) = \\int \\int M_0^2 [\\delta(k_1-f_0) + \\delta(k_1+f_0)] [\\delta(k_2-f_0) + \\delta(k_2+f_0)] \\text{TCC}(k_1, k_2) \\exp(i(k_1-k_2)x) \\, dk_1 dk_2$$\nThe sifting property of the Dirac delta functions collapses the double integral into a sum of four terms, corresponding to the pairs $(k_1, k_2) \\in \\{(f_0, f_0), (-f_0, -f_0), (f_0, -f_0), (-f_0, f_0)\\}$.\n$$I(x) = M_0^2 \\left[ \\text{TCC}(f_0, f_0) + \\text{TCC}(-f_0, -f_0) + \\text{TCC}(f_0, -f_0)e^{i2f_0x} + \\text{TCC}(-f_0, f_0)e^{-i2f_0x} \\right]$$\nFrom the derived TCC expression, we can see that $\\text{TCC}(k_1, k_2)$ is real and symmetric, i.e., $\\text{TCC}(k_1, k_2) = \\text{TCC}(k_2, k_1)$. Also, $\\text{TCC}(-k_1, -k_2) = \\text{TCC}(k_1, k_2)$.\nTherefore, $\\text{TCC}(-f_0, -f_0) = \\text{TCC}(f_0, f_0)$ and $\\text{TCC}(-f_0, f_0) = \\text{TCC}(f_0, -f_0)$.\nThe intensity becomes:\n$$I(x) = M_0^2 \\left[ 2\\text{TCC}(f_0, f_0) + \\text{TCC}(f_0, -f_0)(e^{i2f_0x} + e^{-i2f_0x}) \\right]$$\n$$I(x) = 2M_0^2 \\left[ \\text{TCC}(f_0, f_0) + \\text{TCC}(f_0, -f_0) \\cos(2f_0x) \\right]$$\nThe problem defines the Michelson contrast as $C = I_{2 f_{0}}/I_{0}$, where $I_0$ is the mean (zero-frequency) component of the image intensity and $I_{2 f_{0}}$ is the cosine-modulation amplitude. From the expression for $I(x)$, we identify:\n$$I_0 = 2M_0^2 \\, \\text{TCC}(f_0, f_0)$$\n$$I_{2f_0} = 2M_0^2 \\, \\text{TCC}(f_0, -f_0)$$\nThe contrast is the ratio:\n$$C = \\frac{I_{2f_0}}{I_0} = \\frac{\\text{TCC}(f_0, -f_0)}{\\text{TCC}(f_0, f_0)}$$\nLet's evaluate the necessary TCC terms. For simplicity, let $E = \\exp\\left(-\\frac{\\pi^2 \\sigma_s^2}{2 k_c^2}\\right)$.\nFor $\\text{TCC}(f_0, f_0)$: $k_1=f_0, k_2=f_0$. $k_1-k_2 = 0$, $k_1+k_2=2f_0$.\n$$\\text{TCC}(f_0, f_0) = \\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ \\cos(0) + \\cos\\left(\\frac{\\pi(2f_0)}{2k_c}\\right) E \\right] = \\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ 1 + E \\cos\\left(\\frac{\\pi f_0}{k_c}\\right) \\right]$$\nFor $\\text{TCC}(f_0, -f_0)$: $k_1=f_0, k_2=-f_0$. $k_1-k_2 = 2f_0$, $k_1+k_2=0$.\n$$\\text{TCC}(f_0, -f_0) = \\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ \\cos\\left(\\frac{\\pi(2f_0)}{2k_c}\\right) + \\cos(0) E \\right] = \\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ \\cos\\left(\\frac{\\pi f_0}{k_c}\\right) + E \\right]$$\nNow we compute the ratio for the contrast $C$:\n$$C = \\frac{\\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ \\cos\\left(\\frac{\\pi f_0}{k_c}\\right) + E \\right]}{\\frac{S_0\\sqrt{2\\pi}\\sigma_s}{2} \\left[ 1 + E \\cos\\left(\\frac{\\pi f_0}{k_c}\\right) \\right]} = \\frac{\\cos\\left(\\frac{\\pi f_0}{k_c}\\right) + E}{1 + E \\cos\\left(\\frac{\\pi f_0}{k_c}\\right)}$$\nSubstituting back the expression for $E$:\n$$C = \\frac{\\cos\\left(\\frac{\\pi f_0}{k_c}\\right) + \\exp\\left(-\\frac{\\pi^2 \\sigma_s^2}{2 k_c^2}\\right)}{1 + \\exp\\left(-\\frac{\\pi^2 \\sigma_s^2}{2 k_c^2}\\right) \\cos\\left(\\frac{\\pi f_0}{k_c}\\right)}$$\nThis is the final closed-form analytic expression for the Michelson contrast $C$ in terms of $\\sigma_s$, $k_c$, and $f_0$.",
            "answer": "$$\\boxed{\\frac{\\cos\\left(\\frac{\\pi f_{0}}{k_{c}}\\right) + \\exp\\left(-\\frac{\\pi^{2} \\sigma_{s}^{2}}{2 k_{c}^{2}}\\right)}{1 + \\exp\\left(-\\frac{\\pi^{2} \\sigma_{s}^{2}}{2 k_{c}^{2}}\\right) \\cos\\left(\\frac{\\pi f_{0}}{k_{c}}\\right)}}$$"
        },
        {
            "introduction": "Moving from foundational theory to industrial application, this practice explores how the Hopkins model drives Optical Proximity Correction (OPC), a critical technology in modern semiconductor manufacturing. The problem  leverages a linearized model based on sensitivities derived from the full Hopkins formulation, a technique central to efficient computational lithography. By calculating the specific mask dimension adjustments needed to make dense and isolated features print at the same target size, you will engage with the fundamental logic of model-based OPC and see how predictive imaging physics is essential for creating manufacturable photomasks.",
            "id": "4130959",
            "problem": "A semiconductor lithography process uses a projection system with wavelength $\\lambda = 193\\,\\mathrm{nm}$, numerical aperture $\\mathrm{NA} = 0.93$, and conventional partial coherence parameter $\\sigma = 0.40$. The system reduction factor is $R = 4$. Consider one-dimensional binary mask patterns printing lines in a resist that is modeled by a constant-threshold development model in which the printed edge on the wafer is located where the aerial image intensity equals a fixed threshold $I_{\\mathrm{th}}$. The target wafer critical dimension is a line width of $w_{\\mathrm{t}} = 45\\,\\mathrm{nm}$. For the dense $1{:}1$ line-space case, the wafer pitch is $P_{\\mathrm{w}} = 90\\,\\mathrm{nm}$, and for the isolated case the line is sufficiently separated from neighbors that its imaging can be treated as isolated.\n\nThe partially coherent aerial image intensity $I(x)$ at the wafer is governed by the Hopkins formulation, which expresses the intensity as a bilinear functional of the mask transmission given by the Transmission Cross Coefficient (TCC):\n$$\nI(x) \\;=\\; \\iint TCC(f_{1}, f_{2})\\, M(f_{1})\\, M^{*}(f_{2})\\, \\exp\\!\\big(i 2\\pi (f_{1}-f_{2}) x\\big)\\, \\mathrm{d}f_{1}\\, \\mathrm{d}f_{2},\n$$\nwhere $M(f)$ is the Fourier transform of the mask transmission function, and $x$ is the wafer-plane coordinate. The resist threshold is $I_{\\mathrm{th}} = 0.300$ (normalized intensity units). The printed edge location on the wafer for the target line is $x_{\\mathrm{t}} = w_{\\mathrm{t}}/2$ by symmetry.\n\nAssume the nominal mask line width corresponding to the target wafer dimension is $w_{\\mathrm{m},0} = R\\, w_{\\mathrm{t}} = 180\\,\\mathrm{nm}$. Around this nominal width, the aerial image intensity at $x_{\\mathrm{t}}$ responds approximately linearly to small mask width perturbations $\\Delta w_{\\mathrm{m}}$ according to\n$$\nI_{j}(x_{\\mathrm{t}}; w_{\\mathrm{m}}) \\;\\approx\\; I_{j,0} \\;+\\; S_{j}\\, (w_{\\mathrm{m}} - w_{\\mathrm{m},0}),\n$$\nwhere $j \\in \\{d, i\\}$ denotes the dense and isolated cases, respectively; $I_{j,0} = I_{j}(x_{\\mathrm{t}}; w_{\\mathrm{m},0})$ and $S_{j} = \\left.\\frac{\\partial I_{j}(x_{\\mathrm{t}}; w_{\\mathrm{m}})}{\\partial w_{\\mathrm{m}}}\\right|_{w_{\\mathrm{m},0}}$ are quantities obtained from the Hopkins formulation by evaluating the bilinear form and its parametric derivative with respect to $w_{\\mathrm{m}}$ at $x_{\\mathrm{t}}$. For the given optical configuration and binary mask, a truncated Transmission Cross Coefficient expansion retaining the lowest diffraction orders yields the following values at $x_{\\mathrm{t}}$:\n- Dense case: $I_{d,0} = 0.312$, $S_{d} = 1.80 \\times 10^{-3}\\,\\mathrm{nm}^{-1}$.\n- Isolated case: $I_{i,0} = 0.284$, $S_{i} = 2.10 \\times 10^{-3}\\,\\mathrm{nm}^{-1}$.\n\nCompute the mask width biases $\\Delta w_{d}$ and $\\Delta w_{i}$ (in $\\mathrm{nm}$) that must be applied to the dense and isolated mask lines, respectively, so that both print the target wafer critical dimension $w_{\\mathrm{t}}$ under the resist threshold model; that is, enforce $I_{j}(x_{\\mathrm{t}}; w_{\\mathrm{m},0} + \\Delta w_{j}) = I_{\\mathrm{th}}$ for each case. Provide your final numerical answers for $(\\Delta w_{d}, \\Delta w_{i})$ as a two-entry row matrix, and round your answers to three significant figures. Express all mask biases in $\\mathrm{nm}$.",
            "solution": "The core of the problem is to determine the required mask width biases, $\\Delta w_{d}$ for a dense line and $\\Delta w_{i}$ for an isolated line, such that both print at the target wafer critical dimension, $w_{\\mathrm{t}} = 45\\,\\mathrm{nm}$. In the provided constant-threshold resist model, this condition is met when the aerial image intensity at the target line edge, located at $x_{\\mathrm{t}} = w_{\\mathrm{t}}/2$, is equal to the resist threshold, $I_{\\mathrm{th}} = 0.300$.\n\nThe problem supplies a linear model for the intensity at the target edge, $I_{j}(x_{\\mathrm{t}})$, as a function of the mask width, $w_{\\mathrm{m}}$. This model is an approximation around the nominal mask width, $w_{\\mathrm{m},0} = R\\, w_{\\mathrm{t}} = 4 \\times 45\\,\\mathrm{nm} = 180\\,\\mathrm{nm}$. The linear model is given by:\n$$\nI_{j}(x_{\\mathrm{t}}; w_{\\mathrm{m}}) \\approx I_{j,0} + S_{j} (w_{\\mathrm{m}} - w_{\\mathrm{m},0})\n$$\nwhere $j \\in \\{d, i\\}$ for the dense and isolated cases, respectively. $I_{j,0}$ is the intensity at the edge for the nominal mask width $w_{\\mathrm{m},0}$, and $S_{j}$ is the sensitivity of this intensity to changes in the mask width.\n\nWe need to find the bias $\\Delta w_{j}$ such that the new mask width, $w_{\\mathrm{m}} = w_{\\mathrm{m},0} + \\Delta w_{j}$, results in the intensity at the target edge being equal to the threshold intensity. We substitute $w_{\\mathrm{m}} = w_{\\mathrm{m},0} + \\Delta w_{j}$ into the linear model and set the result equal to $I_{\\mathrm{th}}$:\n$$\nI_{\\mathrm{th}} = I_{j,0} + S_{j} \\big((w_{\\mathrm{m},0} + \\Delta w_{j}) - w_{\\mathrm{m},0}\\big)\n$$\nThis simplifies to:\n$$\nI_{\\mathrm{th}} = I_{j,0} + S_{j} \\Delta w_{j}\n$$\nWe can now solve for the required mask bias $\\Delta w_{j}$:\n$$\nS_{j} \\Delta w_{j} = I_{\\mathrm{th}} - I_{j,0}\n$$\n$$\n\\Delta w_{j} = \\frac{I_{\\mathrm{th}} - I_{j,0}}{S_{j}}\n$$\nThis single formula allows us to calculate the bias for both the dense and isolated cases using the provided numerical values.\n\nFor the dense case ($j=d$):\nThe given values are $I_{\\mathrm{th}} = 0.300$, $I_{d,0} = 0.312$, and $S_{d} = 1.80 \\times 10^{-3}\\,\\mathrm{nm}^{-1}$.\nSubstituting these into the formula for the bias:\n$$\n\\Delta w_{d} = \\frac{0.300 - 0.312}{1.80 \\times 10^{-3}\\,\\mathrm{nm}^{-1}} = \\frac{-0.012}{1.80 \\times 10^{-3}}\\,\\mathrm{nm}\n$$\n$$\n\\Delta w_{d} = -\\frac{12 \\times 10^{-3}}{1.80 \\times 10^{-3}}\\,\\mathrm{nm} = -\\frac{12}{1.8}\\,\\mathrm{nm} = -\\frac{120}{18}\\,\\mathrm{nm} = -\\frac{20}{3}\\,\\mathrm{nm}\n$$\nNumerically, this is $\\Delta w_{d} \\approx -6.666... \\,\\mathrm{nm}$. Note that the negative sign indicates the mask line must be made narrower than the nominal width. This is expected, as the nominal intensity $I_{d,0} = 0.312$ is higher than the threshold $I_{\\mathrm{th}} = 0.300$, meaning the line would print too wide without correction. A narrower mask line reduces the intensity at the edge.\n\nFor the isolated case ($j=i$):\nThe given values are $I_{\\mathrm{th}} = 0.300$, $I_{i,0} = 0.284$, and $S_{i} = 2.10 \\times 10^{-3}\\,\\mathrm{nm}^{-1}$.\nSubstituting these into the formula for the bias:\n$$\n\\Delta w_{i} = \\frac{0.300 - 0.284}{2.10 \\times 10^{-3}\\,\\mathrm{nm}^{-1}} = \\frac{0.016}{2.10 \\times 10^{-3}}\\,\\mathrm{nm}\n$$\n$$\n\\Delta w_{i} = \\frac{16 \\times 10^{-3}}{2.10 \\times 10^{-3}}\\,\\mathrm{nm} = \\frac{16}{2.1}\\,\\mathrm{nm} = \\frac{160}{21}\\,\\mathrm{nm}\n$$\nNumerically, this is $\\Delta w_{i} \\approx 7.619047... \\,\\mathrm{nm}$. The positive sign indicates the mask line must be made wider than the nominal width. This is also expected, as the nominal intensity $I_{i,0} = 0.284$ is lower than the threshold $I_{\\mathrm{th}} = 0.300$, meaning the line would print too narrow. A wider mask line increases the intensity at the edge.\n\nThe problem requires the final numerical answers for $(\\Delta w_{d}, \\Delta w_{i})$ rounded to three significant figures.\n- For the dense case: $\\Delta w_{d} \\approx -6.666... \\,\\mathrm{nm}$ rounds to $-6.67\\,\\mathrm{nm}$.\n- For the isolated case: $\\Delta w_{i} \\approx 7.619047... \\,\\mathrm{nm}$ rounds to $7.62\\,\\mathrm{nm}$.\n\nThe required mask biases are therefore $\\Delta w_{d} = -6.67\\,\\mathrm{nm}$ and $\\Delta w_{i} = 7.62\\,\\mathrm{nm}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -6.67 & 7.62 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The final practice culminates in the construction of a two-dimensional imaging simulator to analyze a complex spatial effect that is invisible to one-dimensional models. This exercise  has you implement the Abbe method, an intuitive and powerful numerical approach for realizing the Hopkins integral by summing the intensities from multiple coherent systems, each corresponding to a different point on the light source. Simulating the imaging of a finite-length line and quantifying the resulting line-end shortening will provide you with invaluable hands-on experience in numerical Fourier optics and a deeper appreciation for how diffraction phenomena dictate the ultimate fidelity of printed patterns.",
            "id": "4130977",
            "problem": "A partially coherent projection imaging system in semiconductor manufacturing is modeled using the Hopkins formulation, which expresses the image intensity as a bilinear functional of the mask transmission spectrum and the system’s Transmission Cross Coefficient (TCC). Equivalently, the Abbe imaging method computes a partially coherent aerial image by integrating coherent images over the source angular distribution. Consider a scalar diffraction model with a circular pupil of numerical aperture $\\,\\mathrm{NA}\\,$ and a uniform circular source characterized by the partial coherence factor $\\,\\sigma\\,$, defined as the ratio of source numerical aperture to $\\,\\mathrm{NA}\\,$. Defocus is introduced as a quadratic phase across the pupil parameterized by a dimensionless defocus parameter in waves at the pupil edge.\n\nYou must implement a two-dimensional simulation of an isolated line in the wafer plane and quantify line-end shortening. The line-end shortening is defined as the retreat distance of a specified aerial image intensity contour relative to the mask line end along the line axis. Your program must compute this retreat for several $(\\sigma,\\delta)$ conditions, where $\\,\\sigma\\,$ is the partial coherence factor and $\\,\\delta\\,$ is the dimensionless defocus parameter (in waves at the pupil edge). The final output must be a single line containing the retreat distances for all test cases as a comma-separated list enclosed in square brackets, with each retreat expressed in $\\,\\mathrm{nm}\\,$ as a floating-point number.\n\nFundamental base and assumptions:\n- Use scalar Fourier optics and the Huygens–Fresnel principle to model coherent imaging. The coherent field in the image plane is the inverse Fourier transform of the product of the mask spectrum and the coherent transfer function.\n- The coherent transfer function is determined by the pupil function in spatial frequency. A circular pupil imposes a cutoff spatial frequency.\n- Partially coherent imaging (Hopkins formulation) can be realized by integrating the squared magnitude of the coherent image field over the source distribution.\n- The pupil defocus is modeled by a quadratic phase $\\,\\exp\\!\\big(i\\pi \\delta \\rho^2\\big)\\,$, where $\\,\\rho\\,$ is the normalized radial coordinate inside the pupil ($\\,\\rho\\in[0,1]\\,$) and $\\,\\delta\\,$ is the defocus in waves at the pupil edge.\n\nGeometry and optical parameters:\n- Wavelength: $\\,\\lambda = 193\\,\\mathrm{nm}\\,$.\n- Numerical aperture: $\\,\\mathrm{NA} = 0.93\\,$.\n- Spatial sampling in the wafer plane: square grid with pixel size $\\,\\Delta x = \\Delta y = 2\\,\\mathrm{nm}\\,$ and grid size $\\,N_x = N_y = 256\\,$ samples.\n- Mask pattern: an isolated line of width $\\,W = 40\\,\\mathrm{nm}\\,$ oriented along the $\\,y\\,$-axis, starting at $\\,y = 0\\,$ and extending to $\\,y = L\\,$ with $\\,L = 200\\,\\mathrm{nm}\\,$. The line is centered at $\\,x=0\\,$.\n- The aerial image threshold used to determine the contour is set to a fraction of the interior peak intensity: $\\,\\alpha = 0.3\\,$. Specifically, define a reference interior region within the line as $\\,|x| \\le W/4\\,$ and $\\,0.7L \\le y \\le 0.9L\\,$, and let the threshold be $\\,T = \\alpha \\, I_\\text{ref}\\,$, where $\\,I_\\text{ref}\\,$ is the mean image intensity over the reference interior region.\n\nFourier-domain definitions:\n- Let the spatial frequency coordinates be $\\,k_x\\,$ and $\\,k_y\\,$ in cycles per $\\,\\mathrm{nm}\\,$, computed from the discrete Fourier transform grid. The circular pupil imposes a cutoff spatial frequency\n$$\nk_c = \\frac{\\mathrm{NA}}{\\lambda}\\,,\n$$\nand the uniform circular source fills a disk in frequency space of radius $\\,\\sigma k_c\\,$.\n- For each source point represented by a frequency shift vector $\\,\\mathbf{s} = (s_x,s_y)\\,$ with $\\,\\|\\mathbf{s}\\|\\le \\sigma k_c\\,$, the coherent transfer function (pupil) is given by\n$$\nP_{\\mathbf{s}}(k_x,k_y) = \\Pi\\!\\left(\\frac{\\sqrt{(k_x - s_x)^2 + (k_y - s_y)^2}}{k_c}\\right) \\, \\exp\\!\\left(i\\pi \\delta \\left(\\frac{\\sqrt{(k_x - s_x)^2 + (k_y - s_y)^2}}{k_c}\\right)^2\\right)\n$$\nwhere $\\,\\Pi(r)\\,$ is $\\,1\\,$ for $\\,r \\le 1\\,$ and $\\,0\\,$ otherwise.\n- The coherent image field for source point $\\,\\mathbf{s}\\,$ is obtained by inverse Fourier transform of the product of the mask spectrum and $\\,P_{\\mathbf{s}}\\,$. The partially coherent aerial image intensity is the weighted sum (integral) of $\\,|E_{\\mathbf{s}}(x,y)|^2\\,$ over all source points within the uniform disk.\n\nLine-end shortening measurement:\n- Along the centerline $\\,x=0\\,$, find the smallest $\\,y \\ge 0\\,$ such that $\\,I(0,y)\\ge T\\,$. Use linear interpolation between samples to refine the crossing location. The retreat distance is defined as this $\\,y\\,$ value in $\\,\\mathrm{nm}\\,$.\n- Edge cases:\n    - If $\\,I(0,0)\\ge T\\,$, the retreat distance is $\\,0\\,$.\n    - If $\\,I(0,y) < T\\,$ for all $\\,0 \\le y \\le L\\,$, set the retreat distance to $\\,L\\,$.\n\nYour program must implement the above model and produce results for the following test suite of $(\\sigma,\\delta)$ pairs:\n1. $(\\sigma, \\delta) = (0.3, 0)$\n2. $(\\sigma, \\delta) = (0.7, 0)$\n3. $(\\sigma, \\delta) = (1.0, 0)$\n4. $(\\sigma, \\delta) = (0.7, 0.5)$\n5. $(\\sigma, \\delta) = (0.7, -0.5)$\n6. $(\\sigma, \\delta) = (0.3, 1.0)\n\nAngle units do not appear in the final output. All physical distances must be expressed in $\\,\\mathrm{nm}\\,$. The final output format must be a single line containing a Python list of the six retreat distances, in the same order as the test suite, as floating-point numbers in $\\,\\mathrm{nm}\\,$: for example, \"[d1,d2,d3,d4,d5,d6]\".",
            "solution": "The core of this problem is to simulate the formation of a partially coherent aerial image of a specified mask pattern and to quantify a critical process metric, line-end shortening (LES). The simulation will be conducted using the Abbe method, which models a partially coherent source as a collection of discrete, mutually incoherent point sources. The total image intensity is the sum of the intensities generated by each source point acting independently.\n\n### 1. Model Formulation\n\n**Spatial and Frequency Domains**\nThe simulation is performed on a two-dimensional Cartesian grid. The spatial domain, corresponding to the wafer plane, is defined by a grid of size $N_x \\times N_y$ with a pixel size of $\\Delta x \\times \\Delta y$. The provided parameters are $N_x = N_y = 256$ and $\\Delta x = \\Delta y = 2\\,\\mathrm{nm}$. This establishes a physical simulation area (field of view) of $L_x = N_x \\Delta x = 512\\,\\mathrm{nm}$ by $L_y = N_y \\Delta y = 512\\,\\mathrm{nm}$. The spatial coordinates $(x,y)$ are centered at $(0,0)$.\n\nThe corresponding frequency domain is accessed via the Discrete Fourier Transform (DFT). The frequency coordinates $(k_x, k_y)$ are given in cycles per nm. The frequency sampling interval is determined by the spatial field of view: $\\Delta k_x = 1/L_x$ and $\\Delta k_y = 1/L_y$. This establishes a frequency grid with coordinates conveniently generated using `fftfreq` routines, centered at $(0,0)$ for analysis.\n\n**Mask Pattern and Spectrum**\nThe object to be imaged is a simple opaque mask with a single transparent line. The mask transmission function, $M(x,y)$, is defined as:\n$$\nM(x,y) =\n\\begin{cases}\n1 & \\text{if } |x| \\le W/2 \\text{ and } 0 \\le y \\le L \\\\\n0 & \\text{otherwise}\n\\end{cases}\n$$\nwhere the line width is $W = 40\\,\\mathrm{nm}$ and its length is $L = 200\\,\\mathrm{nm}$. The input to the optical system is the Fourier transform of this mask, known as the mask spectrum, $\\mathcal{M}(k_x, k_y) = \\mathcal{F}\\{M(x,y)\\}$, which is computed numerically using a Fast Fourier Transform (FFT).\n\n**Abbe's Method for Partially Coherent Imaging**\nThe partially coherent light source, a uniform circular disk, is modeled by discretizing it into a set of $N_s$ individual point sources, each located at a specific position $\\mathbf{s}_j = (s_{x,j}, s_{y,j})$ in the frequency domain. The magnitude of these vectors is bounded by $\\|\\mathbf{s}_j\\| \\le \\sigma k_c$, where $\\sigma$ is the partial coherence factor and $k_c = \\mathrm{NA}/\\lambda$ is the cutoff frequency of the projection system.\n\nAccording to Abbe's principle, the total intensity in the image plane, $I(x,y)$, is the incoherent sum of the intensities produced by each point source:\n$$\nI(x,y) = \\frac{1}{N_s} \\sum_{j=1}^{N_s} |E_{\\mathbf{s}_j}(x,y)|^2\n$$\nwhere $E_{\\mathbf{s}_j}(x,y)$ is the complex-valued coherent image field produced by the $j$-th source point. The normalization by $N_s$ is appropriate for a uniform source.\n\n**Coherent Image Formation**\nFor each source point $\\mathbf{s}$, the coherent image is formed by filtering the mask spectrum with the coherent transfer function (CTF), also known as the pupil function $P_{\\mathbf{s}}(k_x, k_y)$. The pupil function for a source point at $\\mathbf{s}$ is a shifted, circular aperture with a phase aberration for defocus. It is given by:\n$$\nP_{\\mathbf{s}}(k_x, k_y) = \\Pi\\left(\\frac{\\|\\mathbf{k}-\\mathbf{s}\\|}{k_c}\\right) \\exp\\left(i\\pi \\delta \\left(\\frac{\\|\\mathbf{k}-\\mathbf{s}\\|}{k_c}\\right)^2\\right)\n$$\nHere, $\\mathbf{k} = (k_x, k_y)$ is the frequency vector, $k_c=\\mathrm{NA}/\\lambda$ is the pupil cutoff frequency, and $\\Pi(r)$ is the circle function, which is $1$ for $r \\le 1$ and $0$ otherwise. The parameter $\\delta$ represents the defocus in units of waves at the pupil edge. The term $\\|\\mathbf{k} - \\mathbf{s}\\|$ indicates that the pupil is centered at the source point's location $\\mathbf{s}$ in the frequency plane.\n\nThe spectrum of the coherent image field is the product of the mask spectrum and the CTF:\n$$\n\\mathcal{E}_{\\mathbf{s}}(k_x, k_y) = \\mathcal{M}(k_x,k_y) \\cdot P_{\\mathbf{s}}(k_x,k_y)\n$$\nThe coherent field itself is then found by applying the inverse Fourier transform:\n$$\nE_{\\mathbf{s}}(x,y) = \\mathcal{F}^{-1}\\{\\mathcal{E}_{\\mathbf{s}}(k_x,k_y)\\}\n$$\nThis process is repeated for all source points, and the resulting intensities are summed to yield the final partially coherent aerial image $I(x,y)$.\n\n### 2. Line-End Shortening Measurement\n\nAfter computing the aerial image $I(x,y)$, the next step is to measure the line-end shortening.\n\n**Intensity Threshold**\nThe measurement is based on an intensity contour at a threshold level $T$. This threshold is defined relative to the peak intensity inside the line feature, far from the ends. A reference region is defined as $|x| \\le W/4 = 10\\,\\mathrm{nm}$ and $0.7L \\le y \\le 0.9L$ (i.e., $140\\,\\mathrm{nm} \\le y \\le 180\\,\\mathrm{nm}$). The reference intensity, $I_\\text{ref}$, is the mean intensity within this region. The threshold is then calculated as:\n$$\nT = \\alpha \\cdot I_\\text{ref}\n$$\nwith the given fraction $\\alpha = 0.3$.\n\n**Contour Location and Retreat Distance**\nThe line-end shortening is determined by finding where the image of the line end at $y=0$ actually forms. This is done by analyzing the intensity profile along the line's central axis, $I(0,y)$. We search for the smallest value of $y \\ge 0$ where the intensity $I(0,y)$ crosses the threshold $T$.\n\nLet the discrete intensity profile along the centerline be $I_c(y_j)$. The algorithm searches for the first index $j$ corresponding to $y_j \\ge 0$ such that $I_c(y_j) \\ge T$. If this condition is met at the first point ($y=0$), the retreat distance is $0$. If no such point is found within the mask length ($0 \\le y \\le L$), the retreat is set to $L$. Otherwise, a crossing is found between two adjacent grid points, $(y_{j-1}, I_c(y_{j-1}))$ and $(y_j, I_c(y_j))$. The precise location of the crossing, $y_\\text{retreat}$, is found using linear interpolation:\n$$\ny_{\\text{retreat}} = y_{j-1} + (y_j - y_{j-1}) \\frac{T - I_c(y_{j-1})}{I_c(y_j) - I_c(y_{j-1})}\n$$\nThis value $y_\\text{retreat}$ is the line-end shortening, representing the distance the $T$-level contour has pulled back from the nominal mask edge at $y=0$.\n\nThe entire procedure is executed for each $(\\sigma, \\delta)$ pair specified in the test suite to generate the final list of results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import fft\n\ndef solve():\n    \"\"\"\n    Simulates partially coherent imaging of a line feature to calculate line-end shortening\n    for various optical conditions.\n    \"\"\"\n    # === Problem Parameters ===\n    # Optical parameters\n    LAMBDA = 193.0  # Wavelength in nm\n    NA = 0.93  # Numerical aperture\n\n    # Spatial grid parameters\n    N = 256  # Grid size (Nx = Ny = N)\n    DX = 2.0  # Pixel size in nm (dx = dy = DX)\n    \n    # Mask parameters\n    W = 40.0  # Line width in nm\n    L = 200.0  # Line length in nm\n\n    # Measurement parameters\n    ALPHA = 0.3  # Threshold fraction\n\n    # Test suite of (sigma, delta) pairs\n    test_cases = [\n        (0.3, 0.0),\n        (0.7, 0.0),\n        (1.0, 0.0),\n        (0.7, 0.5),\n        (0.7, -0.5),\n        (0.3, 1.0),\n    ]\n\n    # === Pre-calculations ===\n    # Spatial coordinates (centered)\n    x = np.arange(-N / 2, N / 2) * DX\n    y = np.arange(-N / 2, N / 2) * DX\n    X, Y = np.meshgrid(x, y)\n\n    # Frequency coordinates (centered)\n    kx = fft.fftshift(fft.fftfreq(N, DX))\n    ky = fft.fftshift(fft.fftfreq(N, DX))\n    KX, KY = np.meshgrid(kx, ky)\n    \n    # Pupil cutoff frequency\n    k_c = NA / LAMBDA\n\n    # Create mask pattern\n    mask = np.zeros((N, N), dtype=np.float64)\n    mask[(np.abs(X) <= W / 2) & (Y >= 0) & (Y <= L)] = 1.0\n\n    # Mask spectrum (pre-calculate)\n    # The ifftshift prepares the spatially centered mask for FFT.\n    # The fftshift centers the resulting spectrum.\n    mask_spectrum = fft.fftshift(fft.fft2(fft.ifftshift(mask)))\n\n    results = []\n\n    # === Main Loop for each test case ===\n    for sigma, delta in test_cases:\n        # --- Source Discretization ---\n        # Find all source points on the frequency grid within the source disk\n        k_source_radius = sigma * k_c\n        source_points_dist_sq = KX**2 + KY**2\n        source_mask = source_points_dist_sq <= k_source_radius**2\n        source_coords = np.argwhere(source_mask)\n        source_k_coords = [(kx[c], ky[r]) for r, c in source_coords]\n        \n        num_source_points = len(source_k_coords)\n        if num_source_points == 0:\n            # Handle case for sigma=0 or very small sigma\n            # Add a single on-axis point for coherent imaging\n            source_k_coords = [(0.0, 0.0)]\n            num_source_points = 1\n\n        total_intensity = np.zeros((N, N), dtype=np.float64)\n\n        # --- Abbe's Method: Sum of Coherent Images ---\n        for sx, sy in source_k_coords:\n            # Define coherent transfer function (pupil) for this source point\n            kx_shifted = KX - sx\n            ky_shifted = KY - sy\n            \n            # Normalized radial coordinate in pupil\n            rho_sq = (kx_shifted**2 + ky_shifted**2) / (k_c**2)\n            \n            pupil = np.zeros((N, N), dtype=np.complex128)\n            pupil_mask = rho_sq <= 1.0\n            \n            if delta != 0:\n                pupil[pupil_mask] = np.exp(1j * np.pi * delta * rho_sq[pupil_mask])\n            else:\n                pupil[pupil_mask] = 1.0\n\n            # Coherent image formation\n            image_spectrum = mask_spectrum * pupil\n            \n            # Inverse FFT to get coherent field.\n            # ifftshift prepares centered spectrum for IFFT.\n            # fftshift centers the resulting spatial field.\n            coherent_field = fft.fftshift(fft.ifft2(fft.ifftshift(image_spectrum)))\n            \n            total_intensity += np.abs(coherent_field)**2\n\n        # Normalize by number of source points\n        if num_source_points > 0:\n            total_intensity /= num_source_points\n\n        # --- Line-End Shortening Measurement ---\n        # Calculate intensity threshold T\n        ref_region_mask = (np.abs(X) <= W / 4) & (Y >= 0.7 * L) & (Y <= 0.9 * L)\n        iref = np.mean(total_intensity[ref_region_mask])\n        threshold = ALPHA * iref\n\n        # Extract centerline intensity profile\n        centerline_idx = N // 2\n        centerline_intensity = total_intensity[:, centerline_idx]\n        \n        # Find retreat distance\n        retreat_dist = L # Default to L if no crossing is found\n        y_start_idx = N // 2 # Index for y=0\n\n        # Check edge case at y=0\n        if centerline_intensity[y_start_idx] >= threshold:\n            retreat_dist = 0.0\n        else:\n            # Search for crossing for y > 0\n            for j in range(y_start_idx + 1, N):\n                if y[j] > L: # Stop search beyond the mask length\n                    break\n                if centerline_intensity[j] >= threshold:\n                    # Found crossing between j-1 and j. Interpolate.\n                    y_prev = y[j-1]\n                    y_curr = y[j]\n                    I_prev = centerline_intensity[j-1]\n                    I_curr = centerline_intensity[j]\n                    \n                    retreat_dist = y_prev + (y_curr - y_prev) * (threshold - I_prev) / (I_curr - I_prev)\n                    break\n        \n        results.append(retreat_dist)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}