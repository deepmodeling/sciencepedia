{
    "hands_on_practices": [
        {
            "introduction": "Understanding and quantifying optical aberrations is fundamental to designing and characterizing high-performance projection systems. This exercise will guide you through the process of translating classical Seidel aberrations into the mathematically robust framework of Zernike polynomials. By mastering this conversion , you will gain a deeper insight into how different types of wavefront errors are modeled and analyzed in modern optical design and lithography simulation.",
            "id": "4162813",
            "problem": "A projection lithography system for semiconductor manufacturing is modeled using a scalar pupil function with a circular aperture of unit radius. The optical path difference $W(\\rho,\\theta)$ across the pupil is expanded on an orthonormal Zernike basis defined on the unit disk, with radial coordinate $\\rho \\in [0,1]$ and azimuthal angle $\\theta \\in [0,2\\pi)$ in radians. Adopt the Optical Society of America/American National Standards Institute normalization convention where the Zernike polynomials $Z_{n}^{m}(\\rho,\\theta)$ are orthonormal on the unit disk with respect to the weight $\\rho$, and are given by\n$$\nZ_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times\n\\begin{cases}\n\\cos(m\\theta), & m \\ge 0, \\\\\n\\sin(|m|\\theta), & m < 0,\n\\end{cases}\n$$\nwith $N_{n,0} = \\sqrt{n+1}$ and $N_{n,m} = \\sqrt{2(n+1)}$ for $m \\neq 0$, and $R_{n}^{m}(\\rho)$ the standard Zernike radial polynomials.\n\nConsider primary Seidel aberration amplitudes specified as coefficients of the following monomials in the pupil coordinates (optical path difference in meters): defocus $A_{\\mathrm{def}}$ multiplying $\\rho^{2}$, astigmatism oriented along the $x$-axis with amplitude $A_{\\mathrm{ast}}$ multiplying $\\rho^{2}\\cos(2\\theta)$, coma oriented along the $x$-axis with amplitude $A_{\\mathrm{coma}}$ multiplying $\\rho^{3}\\cos(\\theta)$, and primary spherical aberration with amplitude $A_{\\mathrm{sph}}$ multiplying $\\rho^4$. The illumination wavelength is $\\lambda$ (expressed in meters). In the scalar imaging model, the induced phase is $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$ in radians.\n\nStarting from the scalar wave optics representation and the orthonormal Zernike basis definition above, map these Seidel forms to Zernike coefficients and construct the pupil phase $\\phi(\\rho,\\theta)$ with piston and tilt removed. Express your final answer as a single closed-form symbolic expression in terms of $\\rho$, $\\theta$, $A_{\\mathrm{def}}$, $A_{\\mathrm{ast}}$, $A_{\\mathrm{coma}}$, $A_{\\mathrm{sph}}$, and $\\lambda$, in radians. Do not include any overall piston or tilt terms. No numerical evaluation is required.",
            "solution": "The user wants me to solve the following problem:\nA projection lithography system for semiconductor manufacturing is modeled using a scalar pupil function with a circular aperture of unit radius. The optical path difference $W(\\rho,\\theta)$ across the pupil is expanded on an orthonormal Zernike basis defined on the unit disk, with radial coordinate $\\rho \\in [0,1]$ and azimuthal angle $\\theta \\in [0,2\\pi)$ in radians. Adopt the Optical Society of America/American National Standards Institute normalization convention where the Zernike polynomials $Z_{n}^{m}(\\rho,\\theta)$ are orthonormal on the unit disk with respect to the weight $\\rho$, and are given by\n$$\nZ_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times\n\\begin{cases}\n\\cos(m\\theta), & m \\ge 0, \\\\\n\\sin(|m|\\theta), & m < 0,\n\\end{cases}\n$$\nwith $N_{n,0} = \\sqrt{n+1}$ and $N_{n,m} = \\sqrt{2(n+1)}$ for $m \\neq 0$, and $R_{n}^{m}(\\rho)$ the standard Zernike radial polynomials.\n\nConsider primary Seidel aberration amplitudes specified as coefficients of the following monomials in the pupil coordinates (optical path difference in meters): defocus $A_{\\mathrm{def}}$ multiplying $\\rho^{2}$, astigmatism oriented along the $x$-axis with amplitude $A_{\\mathrm{ast}}$ multiplying $\\rho^{2}\\cos(2\\theta)$, coma oriented along the $x$-axis with amplitude $A_{\\mathrm{coma}}$ multiplying $\\rho^{3}\\cos(\\theta)$, and primary spherical aberration with amplitude $A_{\\mathrm{sph}}$ multiplying $\\rho^{4}$. The illumination wavelength is $\\lambda$ (expressed in meters). In the scalar imaging model, the induced phase is $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$ in radians.\n\nStarting from the scalar wave optics representation and the orthonormal Zernike basis definition above, map these Seidel forms to Zernike coefficients and construct the pupil phase $\\phi(\\rho,\\theta)$ with piston and tilt removed. Express your final answer as a single closed-form symbolic expression in terms of $\\rho$, $\\theta$, $A_{\\mathrm{def}}$, $A_{\\mathrm{ast}}$, $A_{\\mathrm{coma}}$, $A_{\\mathrm{sph}}$, and $\\lambda$, in radians. Do not include any overall piston or tilt terms. No numerical evaluation is required.\n\n### Step 1: Extract Givens\n-   Pupil function: Scalar, circular aperture, unit radius ($\\rho \\in [0,1]$, $\\theta \\in [0, 2\\pi)$).\n-   Optical Path Difference (OPD): $W(\\rho,\\theta)$.\n-   Basis: Orthonormal Zernike polynomials $Z_{n}^{m}(\\rho,\\theta)$ on the unit disk with weight $\\rho$.\n-   Zernike definition: $Z_{n}^{m}(\\rho,\\theta) = N_{n,m} R_{n}^{m}(\\rho) \\times \\begin{cases} \\cos(m\\theta), & m \\ge 0 \\\\ \\sin(|m|\\theta), & m < 0 \\end{cases}$.\n-   Normalization constants: $N_{n,0} = \\sqrt{n+1}$, $N_{n,m} = \\sqrt{2(n+1)}$ for $m \\neq 0$.\n-   Seidel aberration terms contributing to $W(\\rho,\\theta)$:\n    1.  Defocus: $A_{\\mathrm{def}} \\rho^{2}$\n    2.  Astigmatism (x-axis): $A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta)$\n    3.  Coma (x-axis): $A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta)$\n    4.  Spherical: $A_{\\mathrm{sph}} \\rho^{4}$\n-   Amplitudes $A_{\\mathrm{def}}, A_{\\mathrm{ast}}, A_{\\mathrm{coma}}, A_{\\mathrm{sph}}$ are in meters.\n-   Wavelength: $\\lambda$ in meters.\n-   Phase-OPD relation: $\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} W(\\rho,\\theta)$ in radians.\n-   Objective: Construct the pupil phase $\\phi(\\rho,\\theta)$ with piston and tilt removed.\n-   Output: A single closed-form symbolic expression for the final phase.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is well-grounded in physical optics, specifically in the theory of aberrations used in optical system design and lithography modeling. The relationship between Seidel and Zernike polynomials is a standard and fundamental concept.\n-   **Well-Posed**: The problem is clearly defined. It asks for a specific mathematical transformation (representation of Seidel aberrations in a piston- and tilt-removed Zernike basis) and provides all necessary definitions and constants. The goal is unambiguous, and a unique solution exists.\n-   **Objective**: The problem is stated using precise, standard, and objective scientific terminology. There are no subjective or opinion-based components.\n-   **Flaw Checklist**:\n    1.  *Scientific/Factual Unsoundness*: None. The framework is standard optical engineering.\n    2.  *Non-Formalizable/Irrelevant*: None. The problem is a formal mathematical derivation.\n    3.  *Incomplete/Contradictory Setup*: None. The definitions of the Zernike basis and the Seidel terms are self-contained and sufficient for the derivation.\n    4.  *Unrealistic/Infeasible*: None. This is a standard modeling problem.\n    5.  *Ill-Posed/Poorly Structured*: None. The requirement to remove piston and tilt ensures a unique representation.\n    6.  *Pseudo-Profound/Trivial*: None. The problem requires a non-trivial application of the properties of Zernike polynomials.\n    7.  *Outside Scientific Verifiability*: None. The derivation is mathematically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived.\n\nThe total optical path difference (OPD), $W(\\rho,\\theta)$, is the sum of the given Seidel aberration terms:\n$$W(\\rho,\\theta) = A_{\\mathrm{def}} \\rho^{2} + A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta) + A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta) + A_{\\mathrm{sph}} \\rho^{4}$$\nThe problem requires constructing the phase with piston and tilt removed. This is equivalent to finding the total OPD, expanding it in the orthonormal Zernike basis, and then setting the coefficients for the piston and tilt terms to zero. An equivalent and more direct method is to calculate the total piston and tilt content of $W(\\rho,\\theta)$ and subtract these components.\n\nThe Zernike polynomials corresponding to piston and x-tilt are, respectively:\n-   Piston ($n=0, m=0$): $Z_{0}^{0}(\\rho,\\theta) = N_{0,0} R_{0}^{0}(\\rho) = \\sqrt{0+1} \\cdot 1 = 1$.\n-   X-Tilt ($n=1, m=1$): $Z_{1}^{1}(\\rho,\\theta) = N_{1,1} R_{1}^{1}(\\rho) \\cos(\\theta) = \\sqrt{2(1+1)} \\rho \\cos(\\theta) = 2\\rho\\cos(\\theta)$.\n\nThe total OPD can be expanded as $W(\\rho,\\theta) = \\sum_{n,m} c_{n,m} Z_{n}^{m}(\\rho,\\theta)$. The OPD with piston and tilt removed, which we will denote as $W_{\\mathrm{ab}}(\\rho,\\theta)$, is given by:\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = W(\\rho,\\theta) - c_{0,0}Z_{0}^{0}(\\rho,\\theta) - c_{1,1}Z_{1}^{1}(\\rho,\\theta)$$\nWe assume the y-tilt component $c_{1,-1}$ is zero, as all given aberrations are symmetric with respect to the $x$-axis.\n\nTo find the coefficients $c_{0,0}$ and $c_{1,1}$, we must express each Seidel monomial in the Zernike basis. We list the relevant Zernike polynomials:\n-   $Z_{0}^{0} = 1$ (Piston)\n-   $Z_{1}^{1} = 2\\rho\\cos(\\theta)$ (Tilt)\n-   $Z_{2}^{0} = \\sqrt{3}(2\\rho^2 - 1)$ (Defocus)\n-   $Z_{3}^{1} = \\sqrt{8}(3\\rho^3-2\\rho)\\cos(\\theta)$ (Coma)\n-   $Z_{4}^{0} = \\sqrt{5}(6\\rho^4-6\\rho^2+1)$ (Spherical)\n\nFrom these definitions, we can invert the relationships to express the monomials in terms of Zernike polynomials:\n1.  From $Z_{2}^{0} = 2\\sqrt{3}\\rho^2 - \\sqrt{3}$ and $Z_{0}^{0}=1$:\n    $2\\sqrt{3}\\rho^2 = Z_{2}^{0} + \\sqrt{3}Z_{0}^{0} \\implies \\rho^2 = \\frac{1}{2\\sqrt{3}}Z_{2}^{0} + \\frac{1}{2}Z_{0}^{0}$.\n    The piston component ($\\propto Z_{0}^{0}$) of $\\rho^2$ is $\\frac{1}{2}$.\n\n2.  From $Z_{1}^{1} = 2\\rho\\cos(\\theta)$ and $Z_{3}^{1} = \\sqrt{8}(3\\rho^3\\cos(\\theta) - 2\\rho\\cos(\\theta))$:\n    Substitute $\\rho\\cos(\\theta) = \\frac{1}{2}Z_{1}^{1}$ into the expression for $Z_{3}^{1}$:\n    $Z_{3}^{1} = \\sqrt{8}(3\\rho^3\\cos(\\theta) - 2(\\frac{1}{2}Z_{1}^{1})) = 3\\sqrt{8}\\rho^3\\cos(\\theta) - \\sqrt{8}Z_{1}^{1}$.\n    $3\\sqrt{8}\\rho^3\\cos(\\theta) = Z_{3}^{1} + \\sqrt{8}Z_{1}^{1} \\implies \\rho^3\\cos(\\theta) = \\frac{1}{3\\sqrt{8}}Z_{3}^{1} + \\frac{1}{3}Z_{1}^{1}$.\n    The tilt component ($\\propto Z_{1}^{1}$) of $\\rho^3\\cos(\\theta)$ is $\\frac{1}{3}$.\n\n3.  To find the piston component of $\\rho^4$, we could expand it in the full Zernike basis. However, a simpler method is to calculate its average value over the unit disk, which corresponds to its piston content. The average of a function $f(\\rho,\\theta)$ is $\\langle f \\rangle = \\frac{1}{\\pi}\\int_0^{2\\pi}\\int_0^1 f(\\rho,\\theta)\\rho\\,d\\rho\\,d\\theta$.\n    For a function $g(\\rho)$ that depends only on $\\rho$, this simplifies to $\\langle g(\\rho) \\rangle = 2\\int_0^1 g(\\rho)\\rho\\,d\\rho$.\n    The piston content of $\\rho^4$ is $\\langle \\rho^4 \\rangle = 2\\int_0^1 \\rho^4 \\rho\\,d\\rho = 2\\int_0^1 \\rho^5\\,d\\rho = 2[\\frac{\\rho^6}{6}]_0^1 = \\frac{1}{3}$.\n\nThe other terms, astigmatism $A_{\\mathrm{ast}}\\rho^2\\cos(2\\theta)$, have no piston or tilt components due to the orthogonality of the trigonometric functions ($\\cos(2\\theta)$ is orthogonal to $\\cos(\\theta)$ and to a constant over $[0, 2\\pi)$).\n\nNow we can find the total piston and tilt to be removed from $W(\\rho,\\theta)$.\nThe total OPD to be removed, $W_{\\text{remove}}$, is the sum of the piston and tilt contributions from all Seidel terms.\n-   Piston contribution from $A_{\\mathrm{def}}\\rho^2$: $A_{\\mathrm{def}}\\langle\\rho^2\\rangle = A_{\\mathrm{def}}(2[\\frac{\\rho^4}{4}]_0^1) = \\frac{A_{\\mathrm{def}}}{2}$.\n-   Piston contribution from $A_{\\mathrm{sph}}\\rho^4$: $A_{\\mathrm{sph}}\\langle\\rho^4\\rangle = A_{\\mathrm{sph}}(\\frac{1}{3}) = \\frac{A_{\\mathrm{sph}}}{3}$.\n-   Total Piston to remove: $P = (\\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}) Z_{0}^{0} = \\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}$.\n\n-   Tilt contribution from $A_{\\mathrm{coma}}\\rho^3\\cos(\\theta)$: This is the projection of $A_{\\mathrm{coma}}\\rho^3\\cos(\\theta)$ onto the tilt polynomial $Z_{1}^{1}$. From our decomposition, the coefficient of $Z_{1}^{1}$ is $\\frac{A_{\\mathrm{coma}}}{3}$.\n-   Total Tilt to remove: $T = c_{1,1}Z_{1}^{1} = \\frac{A_{\\mathrm{coma}}}{3} (2\\rho\\cos(\\theta)) = \\frac{2}{3}A_{\\mathrm{coma}}\\rho\\cos(\\theta)$.\n\nThe OPD with piston and tilt removed is $W_{\\mathrm{ab}}(\\rho,\\theta) = W(\\rho,\\theta) - P - T$.\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = \\left(A_{\\mathrm{def}} \\rho^{2} + A_{\\mathrm{ast}} \\rho^{2}\\cos(2\\theta) + A_{\\mathrm{coma}} \\rho^{3}\\cos(\\theta) + A_{\\mathrm{sph}} \\rho^{4}\\right) - \\left(\\frac{A_{\\mathrm{def}}}{2} + \\frac{A_{\\mathrm{sph}}}{3}\\right) - \\frac{2}{3}A_{\\mathrm{coma}}\\rho\\cos(\\theta)$$\nGrouping terms by the Seidel amplitudes provides a physically meaningful form:\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\left(\\rho^2 \\cos(2\\theta)\\right) + A_{\\mathrm{coma}}\\left(\\rho^3\\cos(\\theta) - \\frac{2}{3}\\rho\\cos(\\theta)\\right) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right)$$\nThis can be written more compactly as:\n$$W_{\\mathrm{ab}}(\\rho,\\theta) = A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right)$$\nThis expression represents each Seidel term made orthogonal to piston and tilt.\n\nFinally, we convert this OPD to phase $\\phi(\\rho,\\theta)$ using the given relation $\\phi = \\frac{2\\pi}{\\lambda}W$:\n$$\\phi(\\rho,\\theta) = \\frac{2\\pi}{\\lambda} \\left[ A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right) \\right]$$\nThis is the final closed-form expression for the pupil phase with piston and tilt removed.",
            "answer": "$$ \\boxed{ \\frac{2\\pi}{\\lambda} \\left[ A_{\\mathrm{def}}\\left(\\rho^2 - \\frac{1}{2}\\right) + A_{\\mathrm{ast}}\\rho^2 \\cos(2\\theta) + A_{\\mathrm{coma}}\\left(\\rho^3 - \\frac{2}{3}\\rho\\right)\\cos(\\theta) + A_{\\mathrm{sph}}\\left(\\rho^4 - \\frac{1}{3}\\right) \\right] } $$"
        },
        {
            "introduction": "The nature of an object, whether it primarily alters the amplitude or the phase of light, dramatically affects its appearance in a coherently-formed image. This practice problem explores the imaging of simple amplitude and phase objects, revealing a critical limitation of standard coherent systems . You will discover why phase variations can become \"invisible\" and learn the physical principles that underpin phase-contrast imaging techniques.",
            "id": "4162781",
            "problem": "A scalar coherent projection system for semiconductor lithography is modeled by a linear shift-invariant filter with coherent transfer function $H(f) = A(f)\\exp(i\\phi(f))$, where $A(f)$ is the pupil amplitude and $\\phi(f)$ is the pupil phase at spatial frequency $f$. Assume an aberration-free in-focus condition so that $A(f)=1$ for $|f|\\le f_{c}$ and $A(f)=0$ otherwise, and $\\phi(f)$ is constant across the passband so that $\\phi(f)=\\phi_{0}$ for all $|f|\\le f_{c}$. Consider one-dimensional periodic masks with fundamental spatial frequency $f$ satisfying $f<f_{c}$, so that only the zero and first diffraction orders ($0,\\pm f$) are transmitted by the pupil.\n\nTwo masks are to be imaged:\n- Amplitude sinusoidal mask: $t_{a}(x)=1+\\epsilon\\cos(2\\pi f x)$ with $0<\\epsilon\\ll 1$.\n- Phase sinusoidal mask with a $\\pi$ phase modulation depth: $t_{p}(x)=\\exp\\!\\big(i\\pi\\cos(2\\pi f x)\\big)$.\n\nStarting from Fourier optics for coherent imaging and the Jacobi–Anger expansion for the phase mask, derive the image intensity $I(x)$ in each case up to and including the fundamental harmonic at spatial frequency $f$, and define the harmonic image contrast at $f$ as $C_{f}=\\text{(amplitude of the }\\cos(2\\pi f x)\\text{ term in }I(x)) / \\text{(mean intensity)}$. Compute $C_{f}^{(\\text{phase},\\ \\pi)}$ for the phase mask and $C_{f}^{(\\text{ampl})}$ for the amplitude mask under the given pupil, and report the ratio $C_{f}^{(\\text{phase},\\ \\pi)} / C_{f}^{(\\text{ampl})}$ as a single value. No rounding is required. Explain the physical meaning of the result in terms of how pupil phase converts or suppresses phase information in coherent projection systems.",
            "solution": "The problem statement is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n- **System Model**: Scalar coherent projection system, modeled as a linear shift-invariant (LSI) filter.\n- **Coherent Transfer Function (CTF)**: $H(f') = A(f')\\exp(i\\phi(f'))$, where $f'$ denotes spatial frequency.\n- **Pupil Amplitude**: $A(f')=1$ for $|f'|\\le f_{c}$ and $A(f')=0$ otherwise.\n- **Pupil Phase**: $\\phi(f')=\\phi_{0}$ (constant) for all $|f'|\\le f_{c}$.\n- **Masks**: One-dimensional periodic masks with fundamental spatial frequency $f$.\n- **Frequency Condition**: $f<f_{c}$, and only the zero and first diffraction orders ($0, \\pm f$) are transmitted by the pupil. This implies that the second-order diffraction at frequency $2f$ is blocked, so $2f > f_c$. Thus, $f < f_c < 2f$.\n- **Amplitude Mask**: $t_{a}(x)=1+\\epsilon\\cos(2\\pi f x)$ with $0<\\epsilon\\ll 1$.\n- **Phase Mask**: $t_{p}(x)=\\exp(i\\pi\\cos(2\\pi f x))$.\n- **Task Requirements**:\n    1.  Starting from Fourier optics and using the Jacobi-Anger expansion for the phase mask, derive the image intensity $I(x)$ for each mask up to and including the fundamental harmonic at spatial frequency $f$.\n    2.  Define the harmonic image contrast at $f$ as $C_{f}=\\text{(amplitude of the }\\cos(2\\pi f x)\\text{ term in }I(x)) / \\text{(mean intensity)}$.\n    3.  Compute $C_{f}^{(\\text{phase},\\ \\pi)}$ and $C_{f}^{(\\text{ampl})}$.\n    4.  Report the ratio $C_{f}^{(\\text{phase},\\ \\pi)} / C_{f}^{(\\text{ampl})}$.\n    5.  Explain the physical meaning of the result.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is firmly based on the principles of Fourier optics, a standard and fundamental framework for describing imaging systems in physics and engineering, particularly in the context of semiconductor lithography. The LSI model, CTF, pupil function, and mask types are standard concepts. The use of the Jacobi-Anger expansion is the correct mathematical method for analyzing periodic phase objects.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary functions, constants, and conditions to derive a unique solution. The conditions on the spatial frequencies ($f < f_c < 2f$) are self-consistent and define a clear physical scenario (three-beam imaging).\n- **Objectivity**: The problem is stated in precise, objective, mathematical language, free from ambiguity or subjective assertions. The one minor point of physical idealization is the amplitude mask transmittance $t_a(x) = 1 + \\epsilon \\cos(2\\pi f x)$, which can exceed $1$. This is a common and accepted simplification in theoretical problems to represent a low-contrast object field and does not constitute a fundamental flaw invalidating the problem.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. We may proceed with the solution.\n\n### Derivation\nIn a coherent imaging system, the image field $E_{img}(x)$ is the result of filtering the object field $t(x)$ (assuming unit-amplitude plane wave illumination). In the frequency domain, this is described by $\\tilde{E}_{img}(f') = H(f') \\tilde{t}(f')$, where $\\tilde{t}(f')$ is the Fourier transform of the object. The image intensity is then $I(x) = |E_{img}(x)|^2$.\n\nThe given coherent transfer function is $H(f') = \\exp(i\\phi_0)$ for $|f'| \\le f_c$ and $H(f')=0$ for $|f'| > f_c$.\n\n**1. Amplitude Sinusoidal Mask**\n\nThe object transmission is $t_{a}(x)=1+\\epsilon\\cos(2\\pi f x)$. Using Euler's formula, this can be written as:\n$$t_{a}(x) = 1 + \\frac{\\epsilon}{2}\\exp(i2\\pi f x) + \\frac{\\epsilon}{2}\\exp(-i2\\pi f x)$$\nThe Fourier transform of the object field, $\\tilde{t}_a(f')$, consists of three Dirac delta functions:\n$$\\tilde{t}_{a}(f') = \\delta(f') + \\frac{\\epsilon}{2}\\delta(f' - f) + \\frac{\\epsilon}{2}\\delta(f' + f)$$\nThe image spectrum $\\tilde{E}_{img, a}(f')$ is found by multiplying $\\tilde{t}_a(f')$ by the CTF $H(f')$. Since $f<f_c$, the spectral components at $0, +f, -f$ are all transmitted.\n$$\\tilde{E}_{img, a}(f') = H(0)\\delta(f') + H(f)\\frac{\\epsilon}{2}\\delta(f' - f) + H(-f)\\frac{\\epsilon}{2}\\delta(f' + f)$$\nSubstituting $H(f') = \\exp(i\\phi_0)$ for these frequencies:\n$$\\tilde{E}_{img, a}(f') = \\exp(i\\phi_0)\\delta(f') + \\exp(i\\phi_0)\\frac{\\epsilon}{2}\\delta(f' - f) + \\exp(i\\phi_0)\\frac{\\epsilon}{2}\\delta(f' + f)$$\nThe image field $E_{img, a}(x)$ is the inverse Fourier transform of $\\tilde{E}_{img, a}(f')$:\n$$E_{img, a}(x) = \\exp(i\\phi_0) \\left( 1 + \\frac{\\epsilon}{2}\\exp(i2\\pi f x) + \\frac{\\epsilon}{2}\\exp(-i2\\pi f x) \\right) = \\exp(i\\phi_0) \\left( 1 + \\epsilon\\cos(2\\pi f x) \\right)$$\nThe image intensity $I_a(x)$ is the squared magnitude of the image field:\n$$I_a(x) = |E_{img, a}(x)|^2 = |\\exp(i\\phi_0)|^2 |1 + \\epsilon\\cos(2\\pi f x)|^2 = (1 + \\epsilon\\cos(2\\pi f x))^2$$\n$$I_a(x) = 1 + 2\\epsilon\\cos(2\\pi f x) + \\epsilon^2\\cos^2(2\\pi f x)$$\nUsing the identity $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$, we get:\n$$I_a(x) = 1 + 2\\epsilon\\cos(2\\pi f x) + \\frac{\\epsilon^2}{2}(1 + \\cos(4\\pi f x))$$\n$$I_a(x) = \\left(1 + \\frac{\\epsilon^2}{2}\\right) + 2\\epsilon\\cos(2\\pi f x) + \\frac{\\epsilon^2}{2}\\cos(4\\pi f x)$$\nFrom this expression for intensity, the mean intensity (DC component) is $\\langle I_a \\rangle = 1 + \\frac{\\epsilon^2}{2}$. The amplitude of the $\\cos(2\\pi f x)$ term is $2\\epsilon$.\nThe harmonic image contrast for the amplitude mask is:\n$$C_{f}^{(\\text{ampl})} = \\frac{2\\epsilon}{1 + \\frac{\\epsilon^2}{2}}$$\n\n**2. Phase Sinusoidal Mask**\n\nThe object transmission is $t_{p}(x)=\\exp(i\\pi\\cos(2\\pi f x))$. We use the Jacobi-Anger expansion: $\\exp(iz\\cos\\theta) = J_0(z) + 2\\sum_{k=1}^{\\infty} i^k J_k(z)\\cos(k\\theta)$.\nWith $z=\\pi$ and $\\theta=2\\pi f x$, the object field is:\n$$t_p(x) = J_0(\\pi) + 2iJ_1(\\pi)\\cos(2\\pi f x) + 2i^2J_2(\\pi)\\cos(4\\pi f x) + \\dots$$\n$$t_p(x) = J_0(\\pi) + 2iJ_1(\\pi)\\cos(2\\pi f x) - 2J_2(\\pi)\\cos(4\\pi f x) + \\dots$$\nThe Fourier transform $\\tilde{t}_p(f')$ is a series of delta functions at frequencies $0, \\pm f, \\pm 2f, \\dots$.\nThe problem states that only the $0$ and $\\pm 1$ orders are transmitted, which corresponds to the frequencies $0$ and $\\pm f$. All higher orders are blocked by the pupil aperture ($|kf'| > f_c$ for $k \\ge 2$). Therefore, the filtered object spectrum contains only the first two terms of the expansion.\n$$\\tilde{E}_{img, p}(f') = H(f') \\left( \\mathcal{F}\\{ J_0(\\pi) + 2iJ_1(\\pi)\\cos(2\\pi f x) \\} \\right) $$\n$$\\tilde{E}_{img, p}(f') = H(0)J_0(\\pi)\\delta(f') + H(f)iJ_1(\\pi)\\delta(f'-f) + H(-f)iJ_1(\\pi)\\delta(f'+f)$$\nSubstituting the CTF:\n$$\\tilde{E}_{img, p}(f') = \\exp(i\\phi_0)J_0(\\pi)\\delta(f') + \\exp(i\\phi_0)iJ_1(\\pi)\\delta(f'-f) + \\exp(i\\phi_0)iJ_1(\\pi)\\delta(f'+f)$$\nThe image field $E_{img, p}(x)$ is the inverse Fourier transform:\n$$E_{img, p}(x) = \\exp(i\\phi_0) \\left( J_0(\\pi) + iJ_1(\\pi)(\\exp(i2\\pi f x) + \\exp(-i2\\pi f x)) \\right)$$\n$$E_{img, p}(x) = \\exp(i\\phi_0) \\left( J_0(\\pi) + 2iJ_1(\\pi)\\cos(2\\pi f x) \\right)$$\nThe image intensity $I_p(x)$ is the squared magnitude of this field:\n$$I_p(x) = |E_{img, p}(x)|^2 = |\\exp(i\\phi_0)|^2 |J_0(\\pi) + 2iJ_1(\\pi)\\cos(2\\pi f x)|^2$$\nThe constant phase factor $\\exp(i\\phi_0)$ has a magnitude of $1$ and does not affect the intensity. The intensity is the sum of the squares of the real and imaginary parts of the complex term:\n$$I_p(x) = (J_0(\\pi))^2 + (2J_1(\\pi)\\cos(2\\pi f x))^2 = J_0^2(\\pi) + 4J_1^2(\\pi)\\cos^2(2\\pi f x)$$\nUsing the identity $\\cos^2(\\theta) = \\frac{1}{2}(1 + \\cos(2\\theta))$:\n$$I_p(x) = J_0^2(\\pi) + 4J_1^2(\\pi)\\left(\\frac{1}{2}(1 + \\cos(4\\pi f x))\\right)$$\n$$I_p(x) = \\left( J_0^2(\\pi) + 2J_1^2(\\pi) \\right) + 2J_1^2(\\pi)\\cos(4\\pi f x)$$\nThis expression for the intensity $I_p(x)$ contains a DC (mean) term and a harmonic term at frequency $2f$. The amplitude of the fundamental harmonic at frequency $f$ (the $\\cos(2\\pi f x)$ term) is exactly zero.\nThe mean intensity is $\\langle I_p \\rangle = J_0^2(\\pi) + 2J_1^2(\\pi)$.\nThe amplitude of the $\\cos(2\\pi f x)$ term is $0$.\nTherefore, the harmonic image contrast for the phase mask is:\n$$C_{f}^{(\\text{phase},\\ \\pi)} = \\frac{0}{J_0^2(\\pi) + 2J_1^2(\\pi)} = 0$$\n\n**3. Ratio and Physical Explanation**\n\nWe can now compute the required ratio:\n$$\\frac{C_{f}^{(\\text{phase},\\ \\pi)}}{C_{f}^{(\\text{ampl})}} = \\frac{0}{\\frac{2\\epsilon}{1 + \\epsilon^2/2}} = 0$$\n\n**Physical Meaning**:\nThe result of zero for the ratio arises because the contrast of the pure phase object image is zero at the fundamental frequency under these specific coherent imaging conditions. This result reveals a fundamental property of coherent imaging.\n\nIn a coherent system, the image is formed by the interference of the various diffraction orders transmitted by the pupil. For a pure phase object, the diffracted orders (e.g., $\\pm 1$ orders with amplitude proportional to $iJ_1(\\pi)$) are in phase quadrature (i.e., have a relative phase difference of $\\pi/2$) with the undiffracted zero-order light (with amplitude proportional to $J_0(\\pi)$).\n\nWhen these components are summed to form the image field $E_{img} = E_0 + E_{+1} + E_{-1}$, the field has the form $A + iB\\cos(2\\pi f x)$, where $A$ is the contribution from the real-valued zero order and $iB\\cos(2\\pi f x)$ is the contribution from the imaginary-valued sum of the $\\pm 1$ orders. The resulting intensity is $I = |A + iB\\cos(2\\pi f x)|^2 = A^2 + B^2\\cos^2(2\\pi f x)$. This intensity distribution contains spatial variations only at even harmonics of the fundamental frequency (i.e., at $2f, 4f, \\dots$), and lacks any variation at the fundamental frequency $f$.\n\nThe pupil phase $\\phi_0$ in this problem is constant across the entire pupil passband. This means all transmitted diffraction orders ($0, \\pm f$) receive the same phase shift. This common phase factor cancels out in the intensity calculation, $| \\exp(i\\phi_0) E |^2 = |E|^2$. Therefore, a constant pupil phase (which includes the case of an ideal aberration-free pupil where $\\phi_0=0$) is incapable of converting phase information in the object into intensity variations at the object's fundamental frequency. This phenomenon is a form of information suppression. To visualize a phase object, one must introduce a *differential* phase shift between the zero order and the diffracted orders, as is done in Zernike phase contrast microscopy, where a $\\pi/2$ phase plate is typically introduced in the pupil plane to act on the zero-order light. The given system lacks this mechanism, leading to zero contrast.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Bridging the gap from theory to practical application requires synthesizing multiple concepts into a computational model. This comprehensive exercise challenges you to build a scalar imaging simulator from the ground up, based on the Hopkins model of partial coherence . By implementing this model, you will directly investigate how practical mask imperfections, such as corner rounding and line-width bias, impact the final printed feature size.",
            "id": "4162766",
            "problem": "You are tasked with implementing a scalar partially coherent imaging model to analyze how mask bias and corner rounding alter the Fourier spectrum of the mask transmission function $t(x,y)$ and how these changes affect the aerial image critical dimension (CD) in projection lithography. The modeling context is advanced semiconductor manufacturing using projection systems. The model must be derived from fundamental scalar diffraction theory and partially coherent imaging principles, and then implemented numerically. Polarization and material dispersion are neglected, and the imaging is treated as a thin mask with binary amplitude transmission.\n\nBegin from the following fundamental bases:\n- The Huygens–Fresnel principle and Fourier optics, stating that under scalar coherent illumination, the field in the image plane can be modeled via a pupil-filtered spectrum of the mask: for a plane-wave source tilted by a spatial frequency vector $\\mathbf{s}$, the image-plane complex field is proportional to the inverse Fourier transform of the product of the mask spectrum $T(\\mathbf{f})$ and the pupil function $P(\\mathbf{f}-\\mathbf{s})$.\n- The Hopkins partially coherent imaging model, wherein the aerial image intensity is the sum of coherent image intensities from a distribution of source points (incoherent superposition of coherent images), i.e., $I(\\mathbf{x})$ is modeled as an average over source directions.\n\nAdopt the following physically plausible system parameters:\n- Wavelength $\\lambda$ in nanometers is fixed at $\\lambda = 193$ nm.\n- Numerical aperture (NA) is fixed at $\\mathrm{NA} = 0.93$.\n- Unit magnification is assumed for simplicity, so mask and wafer coordinates are treated equivalently in this modeling exercise.\n- The pupil cutoff spatial frequency radius is $f_c = \\mathrm{NA} / \\lambda$ with units of cycles per nanometer.\n- Partial coherence is modeled by a uniform annular source at radius $\\sigma f_c$ in frequency space, where $\\sigma$ is the partial coherence parameter $0 \\le \\sigma \\le 1$. Use an equal-weight discrete sampling of $8$ source points on this ring.\n\nDefine the mask transmission $t(x,y)$ as a binary amplitude function representing a rounded rectangle feature centered at the origin, with width $W$ and height $H$ (both in nanometers). A mask bias $\\Delta$ modifies both dimensions such that $W' = W + \\Delta$ and $H' = H + \\Delta$. Corner rounding is modeled with a radius $R$ (in nanometers) using the Minkowski sum of a smaller axis-aligned rectangle and a disk of radius $R$, implemented via the indicator function:\n$$\nt(x,y) = \\begin{cases}\n1, & \\text{if } \\Big(\\max(|x| - a_x, 0)\\Big)^2 + \\Big(\\max(|y| - a_y, 0)\\Big)^2 \\le R^2, \\\\\n0, & \\text{otherwise,}\n\\end{cases}\n$$\nwhere $a_x = \\max\\left(\\frac{W'}{2} - R,\\, 0\\right)$ and $a_y = \\max\\left(\\frac{H'}{2} - R,\\, 0\\right)$.\n\nLet $T(\\mathbf{f})$ be the two-dimensional Fourier transform of $t(x,y)$, and let $P(\\mathbf{f})$ be the circular pupil indicator with $P(\\mathbf{f}) = 1$ if $\\|\\mathbf{f}\\| \\le f_c$ and $P(\\mathbf{f}) = 0$ otherwise. For a given source point with shift $\\mathbf{s}$ of magnitude $\\|\\mathbf{s}\\| = \\sigma f_c$, the coherent image-plane field is:\n$$\nE_{\\mathbf{s}}(\\mathbf{x}) \\propto \\mathcal{F}^{-1}\\left\\{ T(\\mathbf{f}) P(\\mathbf{f} - \\mathbf{s}) \\right\\},\n$$\nand the partially coherent aerial image intensity is modeled as\n$$\nI(\\mathbf{x}) = \\frac{1}{N_s} \\sum_{k=1}^{N_s} \\left| E_{\\mathbf{s}_k}(\\mathbf{x}) \\right|^2,\n$$\nwhere $N_s$ is the number of source samples on the ring.\n\nFor each mask configuration, compute:\n1. The fraction of spectral energy above the pupil cutoff, defined as\n$$\n\\eta = \\frac{\\sum_{\\|\\mathbf{f}\\| > f_c} |T(\\mathbf{f})|^2}{\\sum_{\\mathbf{f}} |T(\\mathbf{f})|^2}.\n$$\n2. The aerial image CD along the $x$-axis at $y=0$, defined as the full-width at half-maximum (FWHM) of $I(x, 0)$ relative to the maximum intensity. Use an iso-intensity threshold of $0.5$ times the peak of $I(x,0)$ to determine the width. Express the CD in nanometers.\n\nFor each test case, report:\n- The change in CD in nanometers, $\\Delta \\mathrm{CD} = \\mathrm{CD}_\\text{biased,rounded} - \\mathrm{CD}_\\text{baseline}$, where the baseline uses $\\Delta = 0$ nm and $R = 0$ nm with the same $W$, $H$, $\\lambda$, $\\mathrm{NA}$, and $\\sigma$ as the test case.\n- The ratio of high-frequency energy above cutoff relative to baseline, $\\rho = \\eta_\\text{biased,rounded} / \\eta_\\text{baseline}$ (dimensionless).\n\nDiscretization requirements for the numerical implementation:\n- Use a square computational grid of $N \\times N$ samples, with $N = 512$ and sampling pitch $\\Delta x = \\Delta y = 4$ nm.\n- Construct frequency grids consistent with the Fast Fourier Transform (FFT), and use proper centering with frequency shifting for radial operations.\n- Angles for source sampling must be in radians.\n\nTest suite:\nEach test case is specified by $(W,H,\\Delta,R,\\sigma)$, all in nanometers except for $\\sigma$ which is dimensionless.\n- Test 1 (baseline feature, moderate partial coherence): $(100, 300, 0, 0, 0.3)$\n- Test 2 (positive bias and modest rounding, same $\\sigma$): $(100, 300, 5, 5, 0.3)$\n- Test 3 (negative bias with rounding, higher partial coherence): $(100, 300, -5, 5, 0.7)$\n- Test 4 (larger positive bias, no rounding, higher partial coherence): $(100, 300, 10, 0, 0.7)$\n- Test 5 (no bias, heavy rounding, intermediate partial coherence): $(100, 300, 0, 15, 0.5)$\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a list of two floats in the order $[\\Delta \\mathrm{CD}\\ \\text{in nm},\\ \\rho]$. For example, the output must look like:\n$[[\\Delta \\mathrm{CD}_1,\\rho_1],[\\Delta \\mathrm{CD}_2,\\rho_2],\\ldots]$.\n\nAll lengths must be in nanometers, angles must be in radians, and the reported CD changes must be in nanometers as decimals. The ratio $\\rho$ is dimensionless and must be reported as a decimal.",
            "solution": "The problem requires the implementation of a scalar partially coherent imaging model to analyze the effects of mask bias and corner rounding on the final aerial image in a projection lithography system. The solution must be constructed from first principles of Fourier optics and must be validated against the provided physical and numerical parameters. The problem is scientifically grounded, well-posed, and all necessary parameters are specified. The task is to compute the change in critical dimension ($\\Delta \\mathrm{CD}$) and the relative change in high-frequency spectral content ($\\rho$) for a series of mask geometries compared to a baseline rectangular feature.\n\nThe solution proceeds systematically, beginning with the definition of the computational domain, followed by the generation of the mask shape, computation of its spectrum, synthesis of the partially coherent aerial image, and finally extraction of the required metrics.\n\nFirst, we establish the computational domain. A two-dimensional square grid is defined in the spatial domain, $\\mathbf{x} = (x, y)$, with $N=512$ samples along each axis and a sampling pitch of $\\Delta x = \\Delta y = 4$ nm. This results in a total field of view of size $L \\times L$, where $L = N \\Delta x = 2048$ nm. The corresponding frequency domain, $\\mathbf{f}=(f_x, f_y)$, is determined by the properties of the discrete Fourier transform. The frequency sampling pitch is $\\Delta f = 1/L$, and the coordinates are centered around the origin, spanning from the negative to positive Nyquist frequency.\n\nThe optical system is defined by its wavelength, $\\lambda=193$ nm, and numerical aperture, $\\mathrm{NA}=0.93$. These parameters determine the resolving power of the system. In the frequency domain, the system's finite aperture is modeled by a circular pupil function, $P(\\mathbf{f})$, which is an indicator function that is unity for spatial frequencies whose magnitude is less than or equal to the cutoff frequency, $f_c$, and zero otherwise.\n$$\nf_c = \\frac{\\mathrm{NA}}{\\lambda} \\approx 0.004818 \\text{ cycles/nm}\n$$\n$$\nP(\\mathbf{f}) = \\begin{cases} 1, & \\|\\mathbf{f}\\| \\le f_c \\\\ 0, & \\|\\mathbf{f}\\| > f_c \\end{cases}\n$$\nwhere $\\|\\mathbf{f}\\| = \\sqrt{f_x^2 + f_y^2}$.\n\nThe object to be imaged is a binary mask. Its transmission function, $t(x,y)$, is specified for a rounded rectangle centered at the origin, with nominal width $W$ and height $H$. The effects of mask bias $\\Delta$ and corner rounding $R$ are incorporated by modifying the geometry. The effective width and height are $W' = W + \\Delta$ and $H' = H + \\Delta$. The rounded shape is modeled by the Minkowski sum of a rectangle of size $(W'-2R) \\times (H'-2R)$ and a disk of radius $R$. This is expressed by the indicator function:\n$$\nt(x,y) = \\begin{cases}\n1, & \\text{if } \\Big(\\max(|x| - a_x, 0)\\Big)^2 + \\Big(\\max(|y| - a_y, 0)\\Big)^2 \\le R^2 \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\nwith $a_x = \\max(\\frac{W'}{2} - R, 0)$ and $a_y = \\max(\\frac{H'}{2} - R, 0)$. This function is numerically constructed on the discrete spatial grid.\n\nThe complex-valued mask spectrum, $T(\\mathbf{f}) = \\mathcal{F}\\{t(x,y)\\}$, is computed using a 2D Fast Fourier Transform (FFT). From the spectrum, we calculate the first required metric, $\\eta$, which is the fraction of spectral energy lying outside the pupil cutoff radius $f_c$. According to Parseval's theorem, the energy in the frequency domain is proportional to the energy in the spatial domain. The metric $\\eta$ is thus:\n$$\n\\eta = \\frac{\\sum_{\\|\\mathbf{f}\\| > f_c} |T(\\mathbf{f})|^2}{\\sum_{\\mathbf{f}} |T(\\mathbf{f})|^2}\n$$\nThis is computed by summing the squared magnitude of the discrete spectrum components on the frequency grid points where $\\|\\mathbf{f}\\| > f_c$ and dividing by the total sum over all grid points.\n\nThe aerial image intensity $I(\\mathbf{x})$ is synthesized using the Hopkins model for partially coherent imaging. The illumination source is modeled as an annulus of radius $\\sigma f_c$, which we discretize into $N_s=8$ equally spaced point sources. Each point source at frequency-space location $\\mathbf{s}_k$ generates a coherent image. The image-plane field for a single source point is proportional to the inverse Fourier transform of the mask spectrum multiplied by a shifted pupil function:\n$$\nE_{\\mathbf{s}_k}(\\mathbf{x}) \\propto \\mathcal{F}^{-1}\\left\\{ T(\\mathbf{f}) P(\\mathbf{f} - \\mathbf{s}_k) \\right\\}\n$$\nNumerically, for each source point $\\mathbf{s}_k$, a binary mask for the shifted pupil $P(\\mathbf{f} - \\mathbf{s}_k)$ is generated on the frequency grid. This is multiplied element-wise with the mask spectrum $T(\\mathbf{f})$, and the result is transformed back to the spatial domain using a 2D inverse FFT to obtain $E_{\\mathbf{s}_k}(\\mathbf{x})$. The total aerial image intensity is the incoherent superposition (sum of intensities) of the images from all source points:\n$$\nI(\\mathbf{x}) = \\frac{1}{N_s} \\sum_{k=1}^{N_s} \\left| E_{\\mathbf{s}_k}(\\mathbf{x}) \\right|^2\n$$\n\nFinally, we extract the second metric, the critical dimension (CD), from the aerial image. The CD is defined as the full-width at half-maximum (FWHM) of the intensity profile along the x-axis, $I(x, 0)$. The intensity profile is extracted from the center row of the 2D intensity matrix $I(\\mathbf{x})$. The maximum intensity of this profile, $I_{max} = \\max(I(x, 0))$, is found, and the half-maximum threshold is set to $I_{thresh} = 0.5 \\times I_{max}$. To determine the width with sub-grid precision, we find the two spatial coordinates $x_{left}$ and $x_{right}$ where the intensity profile crosses this threshold. This is achieved through linear interpolation between the grid points that straddle the threshold value. The CD is then the difference: $\\mathrm{CD} = x_{right} - x_{left}$.\n\nFor each test case, specified by $(W, H, \\Delta, R, \\sigma)$, this entire procedure is executed to find $\\mathrm{CD}_\\text{test}$ and $\\eta_\\text{test}$. A corresponding baseline calculation is also performed using parameters $(W, H, 0, 0, \\sigma)$, yielding $\\mathrm{CD}_\\text{baseline}$ and $\\eta_\\text{baseline}$. The final reported values are the difference in CD, $\\Delta \\mathrm{CD} = \\mathrm{CD}_\\text{test} - \\mathrm{CD}_\\text{baseline}$, and the ratio of the high-frequency energy fractions, $\\rho = \\eta_\\text{test} / \\eta_\\text{baseline}$.",
            "answer": "```python\nimport numpy as np\n\nclass LithoSimulator:\n    \"\"\"\n    Implements a scalar partially coherent imaging model for projection lithography.\n    \"\"\"\n    def __init__(self, lambd, NA, N, dx):\n        \"\"\"\n        Initializes the simulator with system and grid parameters.\n\n        Args:\n            lambd (float): Wavelength in nm.\n            NA (float): Numerical aperture.\n            N (int): Number of grid points along one dimension.\n            dx (float): Spatial grid pitch in nm.\n        \"\"\"\n        self.lambd = float(lambd)\n        self.NA = float(NA)\n        self.N = int(N)\n        self.dx = float(dx)\n\n        self.f_c = self.NA / self.lambd  # Pupil cutoff frequency in 1/nm\n\n        # Spatial grid (centered)\n        x_1d = (np.arange(self.N) - self.N / 2) * self.dx\n        self.X, self.Y = np.meshgrid(x_1d, x_1d)\n\n        # Frequency grid (centered)\n        f_1d = np.fft.fftshift(np.fft.fftfreq(self.N, d=self.dx))\n        self.FX, self.FY = np.meshgrid(f_1d, f_1d, indexing='ij')\n        self.F_rad = np.sqrt(self.FX**2 + self.FY**2)\n\n    def _create_mask(self, W, H, delta, R):\n        \"\"\"Generates the binary mask transmission function for a rounded rectangle.\"\"\"\n        W_prime = W + delta\n        H_prime = H + delta\n        \n        a_x = max(W_prime / 2.0 - R, 0.0)\n        a_y = max(H_prime / 2.0 - R, 0.0)\n        \n        term_x = np.maximum(np.abs(self.X) - a_x, 0.0)\n        term_y = np.maximum(np.abs(self.Y) - a_y, 0.0)\n        \n        mask = (term_x**2 + term_y**2) <= R**2\n        return mask.astype(float)\n\n    def compute_metrics(self, W, H, delta, R, sigma):\n        \"\"\"\n        Computes aerial image CD and spectral energy metric for a given mask.\n        \n        Returns:\n            (float, float): A tuple containing (CD in nm, eta).\n        \"\"\"\n        # 1. Generate mask and its spectrum\n        t_xy = self._create_mask(W, H, delta, R)\n        T_f_unshifted = np.fft.fft2(t_xy)\n        T_f_shifted = np.fft.fftshift(T_f_unshifted)\n\n        # 2. Calculate eta (spectral energy metric)\n        total_energy = np.sum(np.abs(T_f_shifted)**2)\n        if total_energy < 1e-9: # Effectively zero\n            eta = 0.0\n        else:\n            hf_mask = self.F_rad > self.f_c\n            hf_energy = np.sum(np.abs(T_f_shifted[hf_mask])**2)\n            eta = hf_energy / total_energy\n\n        # 3. Calculate aerial image intensity I(x,y)\n        N_s = 8\n        source_radius = sigma * self.f_c\n        thetas = np.linspace(0, 2 * np.pi, N_s, endpoint=False)\n        \n        I_xy = np.zeros((self.N, self.N), dtype=float)\n        \n        for k in range(N_s):\n            s_x = source_radius * np.cos(thetas[k])\n            s_y = source_radius * np.sin(thetas[k])\n            \n            shifted_pupil_FX = self.FX - s_x\n            shifted_pupil_FY = self.FY - s_y\n            shifted_pupil_rad = np.sqrt(shifted_pupil_FX**2 + shifted_pupil_FY**2)\n            \n            P_shifted = (shifted_pupil_rad <= self.f_c).astype(float)\n            P_shifted_unshifted = np.fft.ifftshift(P_shifted)\n            \n            filtered_Tf = T_f_unshifted * P_shifted_unshifted\n            E_xy = np.fft.ifft2(filtered_Tf)\n            I_xy += np.abs(E_xy)**2\n        \n        I_xy /= N_s\n\n        # 4. Calculate CD\n        I_x_profile = I_xy[self.N // 2, :]\n        I_max = np.max(I_x_profile)\n        \n        if I_max < 1e-9: # Effectively zero\n            return 0.0, eta\n        \n        threshold = 0.5 * I_max\n        above_thresh = I_x_profile > threshold\n        crossings = np.where(np.diff(above_thresh))[0]\n        \n        if len(crossings) < 2:\n            # Fallback for unresolved or fully resolved features\n            cd_pixels = np.sum(above_thresh)\n            cd = cd_pixels * self.dx\n        else:\n            # Left edge interpolation\n            idx_left = crossings[0]\n            y1_left, y2_left = I_x_profile[idx_left], I_x_profile[idx_left + 1]\n            x1_left, x2_left = self.X[0, idx_left], self.X[0, idx_left + 1]\n            x_left = x1_left + (x2_left - x1_left) * (threshold - y1_left) / (y2_left - y1_left)\n\n            # Right edge interpolation\n            idx_right = crossings[-1]\n            y1_right, y2_right = I_x_profile[idx_right], I_x_profile[idx_right + 1]\n            x1_right, x2_right = self.X[0, idx_right], self.X[0, idx_right + 1]\n            x_right = x1_right + (x2_right - x1_right) * (threshold - y1_right) / (y2_right - y1_right)\n            \n            cd = x_right - x_left\n            \n        return cd, eta\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print results.\n    \"\"\"\n    # Define system parameters\n    LAMBDA = 193.0\n    NA = 0.93\n    N_GRID = 512\n    DX = 4.0\n\n    # Define test cases: (W, H, Delta, R, sigma)\n    test_cases = [\n        (100.0, 300.0, 0.0, 0.0, 0.3),\n        (100.0, 300.0, 5.0, 5.0, 0.3),\n        (100.0, 300.0, -5.0, 5.0, 0.7),\n        (100.0, 300.0, 10.0, 0.0, 0.7),\n        (100.0, 300.0, 0.0, 15.0, 0.5),\n    ]\n\n    simulator = LithoSimulator(lambd=LAMBDA, NA=NA, N=N_GRID, dx=DX)\n    results = []\n\n    for W, H, delta, R, sigma in test_cases:\n        # Calculate metrics for the test case\n        cd_test, eta_test = simulator.compute_metrics(W, H, delta, R, sigma)\n        \n        # Calculate metrics for the corresponding baseline (perfect rectangle)\n        cd_base, eta_base = simulator.compute_metrics(W, H, 0.0, 0.0, sigma)\n        \n        # Compute final reported values\n        delta_cd = cd_test - cd_base\n        \n        if abs(eta_base) < 1e-9:\n             # This case is unlikely for the given features\n            rho = 0.0 if abs(eta_test) < 1e-9 else float('inf')\n        else:\n            rho = eta_test / eta_base\n        \n        results.append([delta_cd, rho])\n        \n    print(f\"{results}\")\n\nsolve()\n```"
        }
    ]
}