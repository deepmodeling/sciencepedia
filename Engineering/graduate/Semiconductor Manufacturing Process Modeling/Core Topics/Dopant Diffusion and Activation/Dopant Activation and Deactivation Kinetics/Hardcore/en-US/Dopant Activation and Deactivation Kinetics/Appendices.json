{
    "hands_on_practices": [
        {
            "introduction": "To begin our exploration of dopant kinetics, we start with a foundational model. This exercise challenges you to describe the dynamic balance between active and inactive dopant populations using first-order reversible kinetics. By numerically solving the governing ordinary differential equation (ODE) for a non-isothermal anneal, you will gain hands-on experience with the Arrhenius law and the fundamental techniques for simulating time-dependent thermal processes, a cornerstone of modern semiconductor manufacturing .",
            "id": "4121849",
            "problem": "Consider a two-state dopant system in a semiconductor during thermal processing. Let $x(t)$ denote the fraction of electrically active dopant at time $t$, and $1 - x(t)$ denote the fraction in an inactive state. Assume first-order reversible kinetics between the inactive and active states with temperature-dependent rate constants. The activation rate constant $k_a(T)$ and deactivation rate constant $k_d(T)$ follow the Arrhenius law with pre-exponential factors and activation energies. Specifically, for any temperature $T$, the rate constants are given by $k_a(T)$ and $k_d(T)$ where each has the standard Arrhenius dependence on $T$ with energy expressed in electronvolts and the Boltzmann constant (denoted $k_B$) expressed in electronvolts per kelvin.\n\nStarting from mass-action kinetics and the Arrhenius temperature dependence for the rate constants, derive the governing equation for $x(t)$ under a general, non-isothermal temperature history $T(t)$. Then, for a temperature profile consisting of a linear ramp followed by a hold,\n- for $0 \\le t \\le t_{\\mathrm{ramp}}$ with $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$, let $T(t) = T_0 + \\beta t$;\n- for $t_{\\mathrm{ramp}}  t \\le t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$, let $T(t) = T_1$,\ncompute the final active fraction $x(t_{\\mathrm{final}})$ at $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$.\n\nAll energies must be in electronvolts, all temperatures in kelvin, time in seconds, and ramp rate in kelvin per second. Use $k_B = 8.617333262145 \\times 10^{-5}$ electronvolts per kelvin. The quantity $x(t)$ is dimensionless.\n\nYour program must numerically evaluate $x(t)$ over time for each test scenario described below and return the final value $x(t_{\\mathrm{final}})$ for each case. The numeric answer for each case must be rounded to six decimals. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").\n\nTest suite (each case is $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$ where $A_a$ and $A_d$ are the pre-exponential factors in $\\mathrm{s}^{-1}$, $E_a$ and $E_d$ are activation energies in electronvolts, $\\beta$ is the ramp rate in $\\mathrm{K/s}$, $T_0$ and $T_1$ are in $\\mathrm{K}$, $t_{\\mathrm{hold}}$ in $\\mathrm{s}$, and $x(0)$ is dimensionless):\n\n- Case 1 (general activation-dominant non-isothermal anneal): $(900,\\;1050,\\;10,\\;60,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$.\n- Case 2 (rapid ramp with short hold): $(900,\\;1050,\\;100,\\;5,\\;10^9,\\;1.5,\\;5\\times 10^7,\\;2.5,\\;0.0)$.\n- Case 3 (deactivation from a fully active initial state): $(1100,\\;1200,\\;20,\\;120,\\;0.0,\\;1.0,\\;10^9,\\;2.0,\\;1.0)$.\n- Case 4 (isothermal hold as a boundary case): $(1000,\\;1000,\\;10,\\;30,\\;5\\times 10^8,\\;1.6,\\;2\\times 10^7,\\;2.4,\\;0.2)$.\n\nYour program must implement the kinetics using the temperature-dependent rates and produce the final output in the exact format specified above. The outputs are floats rounded to six decimals, dimensionless.",
            "solution": "The problem requires the derivation and numerical solution of a kinetic model for dopant activation in a semiconductor under a non-isothermal thermal process. The validation of the problem statement confirms that it is scientifically grounded, well-posed, and contains all necessary information to proceed.\n\nFirst, we establish the governing differential equation from first principles. The system consists of two states for dopant atoms: active and inactive. Let $x(t)$ be the fraction of dopants in the active state at time $t$. Consequently, the fraction in the inactive state is $1 - x(t)$. The total concentration of dopants, $C_{total}$, is constant. The concentration of active dopants is $C_a(t) = x(t) C_{total}$, and the concentration of inactive dopants is $C_i(t) = (1-x(t))C_{total}$.\n\nThe problem states that the transition between these states follows first-order reversible kinetics:\n$$\n\\text{Inactive} \\underset{k_d}{\\stackrel{k_a}{\\rightleftharpoons}} \\text{Active}\n$$\nHere, $k_a$ is the rate constant for the activation reaction (Inactive $\\rightarrow$ Active), and $k_d$ is the rate constant for the deactivation reaction (Active $\\rightarrow$ Inactive).\n\nAccording to the law of mass action, the rate of change of the concentration of active dopants, $\\frac{dC_a}{dt}$, is given by the rate of formation from the inactive state minus the rate of loss to the inactive state:\n$$\n\\frac{dC_a}{dt} = k_a C_i - k_d C_a\n$$\nSubstituting the expressions for $C_a$ and $C_i$ in terms of the active fraction $x(t)$:\n$$\n\\frac{d(x(t) C_{total})}{dt} = k_a(T(t)) (1 - x(t)) C_{total} - k_d(T(t)) x(t) C_{total}\n$$\nSince $C_{total}$ is a constant, the derivative simplifies, and we can divide the entire equation by $C_{total}$:\n$$\n\\frac{dx}{dt} = k_a(T(t)) (1 - x(t)) - k_d(T(t)) x(t)\n$$\nThis is the governing first-order ordinary differential equation (ODE) for the active dopant fraction $x(t)$. The rate constants $k_a$ and $k_d$ are temperature-dependent, and thus time-dependent through the temperature history $T(t)$.\n\nThe temperature dependence of the rate constants is described by the Arrhenius equation:\n$$\nk_a(T) = A_a \\exp\\left(-\\frac{E_a}{k_B T}\\right)\n$$\n$$\nk_d(T) = A_d \\exp\\left(-\\frac{E_d}{k_B T}\\right)\n$$\nwhere $A_a$ and $A_d$ are the pre-exponential factors (in $\\mathrm{s}^{-1}$), $E_a$ and $E_d$ are the activation energies (in electronvolts, eV), and $k_B$ is the Boltzmann constant, given as $8.617333262145 \\times 10^{-5} \\, \\mathrm{eV} \\cdot \\mathrm{K}^{-1}$.\n\nThe temperature profile $T(t)$ is specified as a two-part process: a linear ramp followed by an isothermal hold.\nFor the ramp phase, where $0 \\le t \\le t_{\\mathrm{ramp}}$:\n$$\nT(t) = T_0 + \\beta t\n$$\nFor the hold phase, where $t_{\\mathrm{ramp}}  t \\le t_{\\mathrm{final}}$:\n$$\nT(t) = T_1\n$$\nThe duration of the ramp is $t_{\\mathrm{ramp}} = (T_1 - T_0)/\\beta$, and the total process time is $t_{\\mathrm{final}} = t_{\\mathrm{ramp}} + t_{\\mathrm{hold}}$. Note that for an isothermal process where $T_0 = T_1$, $t_{\\mathrm{ramp}}$ correctly evaluates to $0$ s.\n\nThe governing ODE can be expressed in the standard linear form $\\frac{dx}{dt} + P(t)x = Q(t)$:\n$$\n\\frac{dx}{dt} + [k_a(T(t)) + k_d(T(t))] x(t) = k_a(T(t))\n$$\nBecause the temperature $T(t)$ is not constant during the ramp phase, the coefficients of the ODE, $P(t) = k_a(T(t)) + k_d(T(t))$ and $Q(t) = k_a(T(t))$, are explicit functions of time. This makes the ODE non-autonomous, and an analytical solution is generally not feasible. Therefore, a numerical approach is required.\n\nThe problem is formulated as an initial value problem (IVP), with the ODE $\\frac{dx}{dt} = f(t, x)$ and an initial condition $x(0) = x_0$ provided for each case. We will solve this IVP numerically over the time interval $[0, t_{\\mathrm{final}}]$. The `scipy.integrate.solve_ivp` function from the SciPy library is a robust tool for this purpose. It implements several adaptive-stepsize algorithms suitable for both stiff and non-stiff ODEs. Chemical kinetic problems are often stiff, so using a method like 'Radau' or 'BDF' is advisable for stability and accuracy.\n\nThe computational procedure is as follows:\n1. For each test case, extract all parameters: $(T_0, T_1, \\beta, t_{\\mathrm{hold}}, A_a, E_a, A_d, E_d, x(0))$.\n2. Define a function, say `dxdt(t, y, params)`, that computes the right-hand side of the ODE. This function will:\n   a. Unpack the parameters.\n   b. Determine the temperature $T$ at the current time $t$ based on the piecewise definition of $T(t)$.\n   c. Calculate $k_a(T)$ and $k_d(T)$ using the Arrhenius equations.\n   d. Return the value of $\\frac{dx}{dt} = k_a (1 - x) - k_d x$. Note that `solve_ivp` expects the state variable `y` to be an array, so we use `x = y[0]`.\n3. Set the time span for integration to $[0, t_{\\mathrm{final}}]$ and the initial condition to $[x(0)]$.\n4. Call `solve_ivp` with the function from step 2, the time span, the initial condition, and the parameters.\n5. The result object from `solve_ivp` will contain the solution at various time points. The final active fraction, $x(t_{\\mathrm{final}})$, is the last value in the solution array, `sol.y[0, -1]`.\n6. This final value is rounded to six decimal places as required.\n7. This process is repeated for all test cases, and the results are aggregated into the specified output format.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation kinetics ODE for a set of test cases.\n    \"\"\"\n    \n    # Constants\n    K_B = 8.617333262145e-5  # Boltzmann constant in eV/K\n\n    # Test suite: (T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0)\n    test_cases = [\n        (900.0, 1050.0, 10.0, 60.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (900.0, 1050.0, 100.0, 5.0, 1e9, 1.5, 5e7, 2.5, 0.0),\n        (1100.0, 1200.0, 20.0, 120.0, 0.0, 1.0, 1e9, 2.0, 1.0),\n        (1000.0, 1000.0, 10.0, 30.0, 5e8, 1.6, 2e7, 2.4, 0.2),\n    ]\n\n    results = []\n\n    def dxdt(t, y, T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed):\n        \"\"\"\n        RHS of the ODE dx/dt for the active dopant fraction x.\n        \"\"\"\n        x = y[0]\n\n        # Determine temperature T at time t\n        if t = t_ramp:\n            T = T0 + beta * t\n        else:\n            T = T1\n        \n        # Prevent division by zero if T is ever 0, though not expected here\n        if T = 0:\n            return [0.0]\n\n        # Calculate Arrhenius rate constants\n        # Aa = 0 implies ka = 0, exp can be avoided\n        k_a = Aa * np.exp(-Ea / (K_B * T)) if Aa  0.0 else 0.0\n        # Ad = 0 implies kd = 0\n        k_d = Ad * np.exp(-Ed / (K_B * T)) if Ad  0.0 else 0.0\n\n        # Return rate of change of active fraction\n        return [k_a * (1 - x) - k_d * x]\n\n    for case in test_cases:\n        T0, T1, beta, t_hold, Aa, Ea, Ad, Ed, x0 = case\n\n        # Calculate time for the temperature ramp\n        # If beta is zero, but T0 != T1, t_ramp would be infinite, but problem spec avoids this.\n        # If T0 == T1, it's an isothermal case, and t_ramp is correctly 0.\n        if beta  0:\n            t_ramp = (T1 - T0) / beta\n        else:\n            t_ramp = 0.0\n\n        t_final = t_ramp + t_hold\n        \n        # Ensure t_final is non-zero to avoid integration errors\n        if t_final = 0:\n            results.append(round(x0, 6))\n            continue\n\n        # Set up parameters for the ODE solver\n        params = (T0, T1, beta, t_ramp, Aa, Ea, Ad, Ed)\n        \n        # Initial condition\n        y0 = [x0]\n        \n        # Time span for integration\n        t_span = [0, t_final]\n\n        # Solve the ODE. 'Radau' is a good choice for potentially stiff problems\n        # like chemical kinetics.\n        sol = solve_ivp(\n            dxdt,\n            t_span,\n            y0,\n            args=params,\n            method='Radau',\n            dense_output=True\n        )\n\n        # The solution at the final time point\n        x_final = sol.sol(t_final)[0]\n        \n        # Append the rounded result\n        results.append(round(x_final, 6))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Building upon the basic reversible reaction model, this practice delves into a more physically detailed deactivation mechanism: the formation of dopant clusters. Here, you will derive and solve an ODE that captures the non-linear kinetics of cluster formation, where multiple active dopant atoms aggregate into an inactive complex . This problem enhances your modeling skills by requiring you to incorporate conservation laws and handle higher-order reaction terms, providing a more nuanced understanding of why dopants lose their electrical activity at high concentrations.",
            "id": "4121856",
            "problem": "A dopant introduced into a semiconductor can exist in an electrically active substitutional state or in electrically inactive clusters composed of $n$ dopant atoms. Let $s(t)$ denote the fraction of total dopant that is substitutional at time $t$, and let $c(t)$ denote the number of clusters per dopant per unit dopant, such that dopant conservation imposes $s(t) + n\\,c(t) = 1$ and $c(t) \\ge 0$. The formation and dissolution of clusters are governed by mass action kinetics: the rate of cluster formation is proportional to $s(t)^n$ and the rate of cluster dissolution is proportional to $c(t)$, with temperature-dependent rate constants following the Arrhenius law. The temperature schedule $T(t)$ is piecewise linear over specified time nodes. The goal is to derive the governing ordinary differential equation (ODE) for $c(t)$, starting from mass action and conservation, and then numerically solve it for given anneal schedules to obtain the deactivated dopant fraction $f_{\\mathrm{deact}}(t) = n\\,c(t)$ at the end of each anneal. All quantities $s(t)$ and $c(t)$ are dimensionless fractions normalized by the total dopant content, time is in seconds, temperature is in Kelvin, and activation energies are in electron-volts. Arrhenius prefactors have units of inverse seconds. The Boltzmann constant used in Arrhenius expressions must be $k_{\\mathrm{B}} = 8.617333262145\\times 10^{-5}$ electron-volts per Kelvin.\n\nStarting point and definitions:\n- Dopant conservation: $s(t) + n\\,c(t) = 1$ for all $t$.\n- Mass action kinetics: $\\frac{dc}{dt} = k_{\\mathrm{on}}(T(t))\\,s(t)^n - k_{\\mathrm{off}}(T(t))\\,c(t)$, with $k_{\\mathrm{on}}(T) = k_{\\mathrm{on},0}\\,\\exp\\!\\left(-\\frac{E_{\\mathrm{a,on}}}{k_{\\mathrm{B}}\\,T}\\right)$ and $k_{\\mathrm{off}}(T) = k_{\\mathrm{off},0}\\,\\exp\\!\\left(-\\frac{E_{\\mathrm{a,off}}}{k_{\\mathrm{B}}\\,T}\\right)$.\n- Initial condition: $c(0) = 0$ (all dopant initially substitutional), so $s(0) = 1$.\n- Deactivated fraction: $f_{\\mathrm{deact}}(t) = n\\,c(t)$.\n\nTasks:\n1. Derive the ODE for $c(t)$ solely in terms of $c(t)$ and $T(t)$ using the conservation relation to eliminate $s(t)$.\n2. Implement a numerical solver for this ODE with a piecewise linear $T(t)$ defined by time-temperature nodes, using a robust stiff ODE method.\n3. For each test case below, compute $f_{\\mathrm{deact}}(t_{\\mathrm{final}})$ as a decimal number (no percentage sign), where $t_{\\mathrm{final}}$ is the last time node.\n\nTest suite (each case provides $n$, $k_{\\mathrm{on},0}$, $E_{\\mathrm{a,on}}$, $k_{\\mathrm{off},0}$, $E_{\\mathrm{a,off}}$, and time-temperature nodes):\n- Case $1$ (isothermal anneal): $n=2$, $k_{\\mathrm{on},0} = 10^{9}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,on}} = 3.0\\,\\mathrm{eV}$, $k_{\\mathrm{off},0} = 10^{11}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,off}} = 3.2\\,\\mathrm{eV}$, nodes $\\{(0, 1100), (1000, 1100)\\}$.\n- Case $2$ (ramp then hold): $n=2$, $k_{\\mathrm{on},0} = 10^{9}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,on}} = 3.0\\,\\mathrm{eV}$, $k_{\\mathrm{off},0} = 10^{11}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,off}} = 3.2\\,\\mathrm{eV}$, nodes $\\{(0, 300), (600, 1200), (1200, 1200)\\}$.\n- Case $3$ (spike anneal with stronger dissolution): $n=2$, $k_{\\mathrm{on},0} = 10^{9}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,on}} = 3.0\\,\\mathrm{eV}$, $k_{\\mathrm{off},0} = 5\\times 10^{12}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,off}} = 3.0\\,\\mathrm{eV}$, nodes $\\{(0, 300), (50, 1300), (60, 1300), (120, 800)\\}$.\n- Case $4$ (low-temperature long anneal, triatomic clusters): $n=3$, $k_{\\mathrm{on},0} = 10^{9}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,on}} = 3.2\\,\\mathrm{eV}$, $k_{\\mathrm{off},0} = 10^{11}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,off}} = 3.2\\,\\mathrm{eV}$, nodes $\\{(0, 300), (50, 900), (5050, 900)\\}$.\n- Case $5$ (no clustering edge case): $n=2$, $k_{\\mathrm{on},0} = 0\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,on}} = 3.0\\,\\mathrm{eV}$, $k_{\\mathrm{off},0} = 10^{11}\\,\\mathrm{s}^{-1}$, $E_{\\mathrm{a,off}} = 3.2\\,\\mathrm{eV}$, nodes $\\{(0, 1100), (1000, 1100)\\}$.\n\nNumerical and output requirements:\n- Use a stiff-capable ODE integrator and a continuous piecewise linear interpolation for $T(t)$ between the provided nodes.\n- Ensure the numerical solution respects $c(t) \\ge 0$ and $s(t) = 1 - n\\,c(t) \\ge 0$; if numerical drift would make $s(t)  0$, enforce $s(t) = 0$ in the rate evaluation.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above, for example, $[r_1,r_2,r_3,r_4,r_5]$, where each $r_i$ is the final value of $f_{\\mathrm{deact}}(t_{\\mathrm{final}})$ as a decimal number.",
            "solution": "The problem requires the derivation and numerical solution of an ordinary differential equation (ODE) governing dopant deactivation kinetics in a semiconductor.\n\nFirst, we derive the governing ODE for the normalized cluster concentration, $c(t)$. The system is described by two quantities: $s(t)$, the fraction of dopant atoms in an electrically active substitutional state, and $c(t)$, the number of clusters per total dopant atom. The conservation of dopant atoms, distributed between substitutional sites and clusters of size $n$, is given by the relation:\n$$s(t) + n\\,c(t) = 1$$\nThis equation states that the fraction of atoms in substitutional sites, $s(t)$, plus the fraction of atoms within clusters, $n\\,c(t)$, must sum to $1$. From this conservation law, we can express the substitutional fraction $s(t)$ as a function of the cluster concentration $c(t)$:\n$$s(t) = 1 - n\\,c(t)$$\nThe dynamics of clustering are described by mass-action kinetics. The rate of change of the cluster concentration, $\\dfrac{dc}{dt}$, is the net result of cluster formation and dissolution. The problem specifies the rate equation as:\n$$\\dfrac{dc}{dt} = k_{\\mathrm{on}}(T(t))\\,s(t)^n - k_{\\mathrm{off}}(T(t))\\,c(t)$$\nThe formation term is proportional to $s(t)^n$, which models a reaction where $n$ substitutional atoms are required to form one cluster. The dissolution term is proportional to $c(t)$, modeling the first-order decay of clusters. The rate constants, $k_{\\mathrm{on}}$ and $k_{\\mathrm{off}}$, are temperature-dependent.\n\nTo obtain a single ODE for $c(t)$, we substitute the expression for $s(t)$ from the conservation law into the rate equation. This eliminates $s(t)$ and yields the ODE exclusively in terms of $c(t)$ and the time-dependent temperature $T(t)$:\n$$\\dfrac{dc}{dt} = k_{\\mathrm{on}}(T(t))\\,(1 - n\\,c(t))^n - k_{\\mathrm{off}}(T(t))\\,c(t)$$\nThis is a first-order, non-linear ODE. The initial condition is given as $c(0) = 0$, which signifies that at the beginning of the anneal, all dopant atoms are in the substitutional state ($s(0)=1$).\n\nTo solve this ODE numerically, we must account for its specific characteristics. The temperature schedule, $T(t)$, is defined by a series of time-temperature nodes, $\\{(t_i, T_i)\\}$. Between these nodes, $T(t)$ is piecewise linear. For any time $t$ in an interval $[t_i, t_{i+1}]$, the temperature is found by linear interpolation:\n$$T(t) = T_i + (T_{i+1} - T_i) \\frac{t - t_i}{t_{i+1} - t_i}$$\nThe rate constants, $k_{\\mathrm{on}}$ and $k_{\\mathrm{off}}$, follow the Arrhenius law, exhibiting a strong exponential dependence on temperature:\n$$k_{\\mathrm{on}}(T) = k_{\\mathrm{on},0}\\,\\exp\\!\\left(-\\frac{E_{\\mathrm{a,on}}}{k_{\\mathrm{B}}\\,T}\\right) \\quad \\text{and} \\quad k_{\\mathrm{off}}(T) = k_{\\mathrm{off},0}\\,\\exp\\!\\left(-\\frac{E_{\\mathrm{a,off}}}{k_{\\mathrm{B}}\\,T}\\right)$$\nwhere $k_{\\mathrm{B}} = 8.617333262145\\times 10^{-5}\\,\\mathrm{eV} \\cdot \\mathrm{K}^{-1}$ is the Boltzmann constant.\nThe combination of rapidly changing temperatures and the exponential nature of the Arrhenius law means that the rate constants can vary by many orders of magnitude during the simulation. This leads to vastly different time scales for the reaction kinetics, making the ODE \"stiff\". Standard explicit ODE solvers would be forced to take extremely small time steps to maintain stability, leading to inefficiency. Therefore, a numerical integrator designed for stiff problems is required. The `solve_ivp` function from the `scipy.integrate` library provides such methods; we will use the `'Radau'` method, which is a robust, high-order implicit Runge-Kutta integrator suitable for stiff ODEs.\n\nThe ODE right-hand-side (RHS) function, let's denote it $f(t, c)$, to be passed to the solver is:\n$$f(t, c) = k_{\\mathrm{on}}(T(t))\\,(\\max(0, 1 - n\\,c))^n - k_{\\mathrm{off}}(T(t))\\,c$$\nIn this expression, we include the term $\\max(0, 1 - n\\,c)$ to enforce the physical constraint that the substitutional fraction $s(t) = 1 - n\\,c(t)$ cannot be negative. This prevents the solver from exploring unphysical states if numerical inaccuracies cause $c(t)$ to temporarily exceed its physical maximum of $1/n$. The other constraint, $c(t) \\ge 0$, is naturally enforced by the physics of the ODE: at $c=0$, the dissolution term is zero, and the formation term is non-negative, so $\\frac{dc}{dt} \\ge 0$, preventing the solution from becoming negative.\n\nThe computational procedure for each test case is as follows:\n1. Set the physical parameters: $n$, $k_{\\mathrm{on},0}$, $E_{\\mathrm{a,on}}$, $k_{\\mathrm{off},0}$, and $E_{\\mathrm{a,off}}$.\n2. Implement a function for $T(t)$ based on piecewise linear interpolation of the given time-temperature nodes.\n3. Define the ODE RHS function $f(t, c)$ incorporating the time-dependent temperature and rate constants, and the physical constraint on $s(t)$.\n4. Use `scipy.integrate.solve_ivp` with the `'Radau'` method to integrate the ODE from $t=0$ to the final time $t_{\\mathrm{final}}$, starting from the initial condition $c(0)=0$.\n5. The solver returns the value of $c(t_{\\mathrm{final}})$.\n6. Calculate the final deactivated fraction as $f_{\\mathrm{deact}}(t_{\\mathrm{final}}) = n \\cdot c(t_{\\mathrm{final}})$.\n\nThis process is systematically applied to each of the five test cases to obtain the required results.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant clustering ODE for a series of test cases and\n    prints the final deactivated fraction for each case.\n    \"\"\"\n    \n    # Physical constant\n    KB_EV_K = 8.617333262145e-5  # Boltzmann constant in eV/K\n\n    # Test cases as defined in the problem statement\n    test_cases = [\n        {\n            \"id\": 1, \"n\": 2, \"kon0\": 1e9, \"Ea_on\": 3.0, \"koff0\": 1e11, \"Ea_off\": 3.2,\n            \"nodes\": np.array([[0, 1100], [1000, 1100]])\n        },\n        {\n            \"id\": 2, \"n\": 2, \"kon0\": 1e9, \"Ea_on\": 3.0, \"koff0\": 1e11, \"Ea_off\": 3.2,\n            \"nodes\": np.array([[0, 300], [600, 1200], [1200, 1200]])\n        },\n        {\n            \"id\": 3, \"n\": 2, \"kon0\": 1e9, \"Ea_on\": 3.0, \"koff0\": 5e12, \"Ea_off\": 3.0,\n            \"nodes\": np.array([[0, 300], [50, 1300], [60, 1300], [120, 800]])\n        },\n        {\n            \"id\": 4, \"n\": 3, \"kon0\": 1e9, \"Ea_on\": 3.2, \"koff0\": 1e11, \"Ea_off\": 3.2,\n            \"nodes\": np.array([[0, 300], [50, 900], [5050, 900]])\n        },\n        {\n            \"id\": 5, \"n\": 2, \"kon0\": 0.0, \"Ea_on\": 3.0, \"koff0\": 1e11, \"Ea_off\": 3.2,\n            \"nodes\": np.array([[0, 1100], [1000, 1100]])\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current case\n        n = case[\"n\"]\n        kon0 = case[\"kon0\"]\n        Ea_on = case[\"Ea_on\"]\n        koff0 = case[\"koff0\"]\n        Ea_off = case[\"Ea_off\"]\n        nodes = case[\"nodes\"]\n        \n        time_points = nodes[:, 0]\n        temp_points = nodes[:, 1]\n        \n        t_final = time_points[-1]\n        \n        # If the total duration is zero, no change occurs from the initial state\n        if t_final == 0:\n            c_final = 0.0\n            f_deact = n * c_final\n            results.append(f_deact)\n            continue\n\n        # Create a piecewise linear-interpolated temperature function T(t)\n        def T_interp(t):\n            return np.interp(t, time_points, temp_points)\n\n        def dcdt(t, c_vec):\n            \"\"\"\n            The right-hand side of the ODE: dc/dt = f(t, c)\n            \"\"\"\n            c = c_vec[0]\n            T = T_interp(t)\n            \n            # Avoid division by zero, although not expected with given data\n            if T = 0:\n                return [0.0]\n\n            # Calculate Arrhenius rate constants\n            kon = kon0 * np.exp(-Ea_on / (KB_EV_K * T))\n            koff = koff0 * np.exp(-Ea_off / (KB_EV_K * T))\n\n            # Substitutional fraction, with physical constraint s = 0\n            s = 1.0 - n * c\n            s = max(0.0, s)\n\n            # Rate of change of cluster concentration\n            rate = kon * (s**n) - koff * c\n            return [rate]\n\n        # Initial condition: c(0) = 0\n        c0 = [0.0]\n        t_span = (0, t_final)\n\n        # Solve the stiff ODE using Radau method\n        sol = solve_ivp(dcdt, t_span, c0, method='Radau', t_eval=[t_final])\n        \n        c_final = sol.y[0, -1]\n        \n        # Calculate the final deactivated fraction\n        f_deact = n * c_final\n        results.append(f_deact)\n\n    # Print the results in the required format\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nif __name__ == '__main__':\n    solve()\n\n```"
        },
        {
            "introduction": "This final practice elevates our analysis to the systems level, simulating a realistic multi-step manufacturing flow involving both ion implantation and thermal annealing. You will construct and solve a coupled reaction network that includes not only dopant species but also the point defects ($I$ and $V$) that mediate their activation and deactivation . This capstone exercise bridges the gap between fundamental kinetics and process engineering, tasking you with using your simulation to predict and optimize a complete process sequence to achieve the maximum possible dopant activation.",
            "id": "4121922",
            "problem": "Consider a reaction network that captures dopant activation and deactivation in crystalline silicon during semiconductor manufacturing. Multiple ion implantation steps introduce dopant atoms and point defects, followed by thermal anneals at specified temperatures. Your task is to derive, implement, and solve a mass-action kinetic model with Arrhenius temperature dependence to predict the final fraction of electrically active dopant and to use this prediction to determine the optimal ordering of implants and anneals among the provided sequences.\n\nFundamental base and assumptions:\n- Use the mass-action law of chemical kinetics for reactions between species. If $A$ and $B$ react to form $C$ with a bimolecular rate constant $k$, then the forward reaction rate is $r = k [A][B]$.\n- Use the Arrhenius law for temperature dependence of rate constants, $k(T) = k_0 \\exp\\!\\left(-\\frac{E_a}{k_B T}\\right)$, where $k_0$ is the pre-exponential factor, $E_a$ is the activation energy, $k_B$ is the Boltzmann constant, and $T$ is the absolute temperature.\n- Neglect spatial gradients and diffusion; model in a well-mixed volume element so that all species are represented by densities in $\\text{cm}^{-3}$.\n\nSpecies:\n- $D_i$: interstitial dopant density (inactive), units $\\text{cm}^{-3}$.\n- $D_s$: substitutional dopant density (active), units $\\text{cm}^{-3}$.\n- $X$: dopant-interstitial complex density (inactive cluster), units $\\text{cm}^{-3}$.\n- $I$: self-interstitial density, units $\\text{cm}^{-3}$.\n- $V$: vacancy density, units $\\text{cm}^{-3}$.\n\nReactions:\n- Interstitialcy activation and its reverse:\n  $$D_i + I \\xrightarrow{k_1(T)} D_s,\\quad D_s \\xrightarrow{k_{1r}(T)} D_i + I.$$\n- Deactivation by complex formation and its reverse:\n  $$D_s + I \\xrightarrow{k_2(T)} X,\\quad X \\xrightarrow{k_{2r}(T)} D_s + I.$$\n- Interstitial-vacancy recombination:\n  $$I + V \\xrightarrow{k_3(T)} \\varnothing.$$\n\nWrite the mass-action ordinary differential equations (to be derived in your solution):\n- $\\frac{d D_i}{d t}$, $\\frac{d D_s}{d t}$, $\\frac{d X}{d t}$, $\\frac{d I}{d t}$, $\\frac{d V}{d t}$ as functions of the reaction rates.\n\nTemperature dependence:\n- Use $k_B = 8.617\\times 10^{-5}\\,\\text{eV/K}$.\n- Parameterize the Arrhenius prefactors and activation energies as follows (selected to be scientifically plausible, and self-consistent):\n  - $k_1$: $k_{1,0} = 1.0\\times 10^{-13}\\,\\text{cm}^3/\\text{s}$, $E_{a,1} = 0.80\\,\\text{eV}$.\n  - $k_{1r}$: $k_{1r,0} = 1.0\\times 10^{4}\\,\\text{s}^{-1}$, $E_{a,1r} = 2.20\\,\\text{eV}$.\n  - $k_2$: $k_{2,0} = 5.0\\times 10^{-14}\\,\\text{cm}^3/\\text{s}$, $E_{a,2} = 1.20\\,\\text{eV}$.\n  - $k_{2r}$: $k_{2r,0} = 5.0\\times 10^{2}\\,\\text{s}^{-1}$, $E_{a,2r} = 2.60\\,\\text{eV}$.\n  - $k_3$: $k_{3,0} = 2.0\\times 10^{-12}\\,\\text{cm}^3/\\text{s}$, $E_{a,3} = 0.50\\,\\text{eV}$.\n\nImplant steps:\n- An implant of dose $D$ instantly increases $D_i$ by $f_i D$, increases $D_s$ by $(1 - f_i) D$, and increases the point defects by $I \\leftarrow I + \\alpha_I D$, $V \\leftarrow V + \\alpha_V D$, where $f_i$ is the fraction of dopant initially interstitial and $\\alpha_I$, $\\alpha_V$ represent damage generation per dopant atom. These are instantaneous changes without time evolution.\n\nAnneal steps:\n- During an anneal at temperature $T$ for duration $\\tau$, the system evolves under the kinetic ordinary differential equations at constant $T$ for $t \\in [0,\\tau]$, and initial conditions set by the state immediately prior to the anneal step.\n\nObjective:\n- For each process sequence, compute the final active fraction defined as\n  $$\\phi = \\frac{D_s}{D_i + D_s + X},$$\n  evaluated at the end of the sequence. Additionally, compute the optimal sequence index that maximizes $\\phi$ among the provided sequences, using $1$-based indexing and breaking ties by choosing the smallest index.\n\nUnits and output:\n- All densities must be handled in $\\text{cm}^{-3}$, temperatures in $\\text{K}$, and durations in $\\text{s}$.\n- Express each active fraction $\\phi$ as a decimal rounded to three decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\phi_1,\\phi_2,\\phi_3,\\text{best}]$, where $\\phi_i$ are the final active fractions for the three test sequences, and $\\text{best}$ is the optimal sequence index (an integer).\n\nTest suite (three sequences):\n- Sequence $1$ (staged activation):\n  - Initial defects: $I_0 = 0\\,\\text{cm}^{-3}$, $V_0 = 0\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Anneal, $T = 1173\\,\\text{K}$, duration $\\tau = 600\\,\\text{s}$.\n  - Step $3$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $4$: Anneal, $T = 1273\\,\\text{K}$, duration $\\tau = 120\\,\\text{s}$.\n- Sequence $2$ (back-to-back implants then long anneal):\n  - Initial defects: $I_0 = 0\\,\\text{cm}^{-3}$, $V_0 = 0\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $3$: Anneal, $T = 1223\\,\\text{K}$, duration $\\tau = 900\\,\\text{s}$.\n- Sequence $3$ (initial defects and mixed spike/soak anneals):\n  - Initial defects: $I_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$, $V_0 = 5.0\\times 10^{18}\\,\\text{cm}^{-3}$.\n  - Step $1$: Implant, dose $3.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $2$: Anneal, $T = 1173\\,\\text{K}$, duration $\\tau = 60\\,\\text{s}$.\n  - Step $3$: Implant, dose $2.0\\times 10^{19}\\,\\text{cm}^{-3}$, $f_i = 0.95$, $\\alpha_I = 0.20$, $\\alpha_V = 0.20$.\n  - Step $4$: Anneal, $T = 1373\\,\\text{K}$, duration $\\tau = 30\\,\\text{s}$.\n\nImplementation requirements:\n- Solve the ordinary differential equations numerically for each anneal step using a method suitable for stiff systems.\n- Aggregate the results from all provided test sequences into the required single-line output format.",
            "solution": "The problem requires the formulation and numerical solution of a mass-action kinetic model to simulate dopant activation and deactivation in silicon during a sequence of ion implantation and thermal annealing steps. The objective is to determine the final fraction of electrically active dopants for several process sequences and to identify the optimal sequence that maximizes this fraction.\n\nThe model is based on a system of coupled ordinary differential equations (ODEs), which describe the time evolution of the concentrations of various species within a well-mixed volume element. The spatial dependence of concentrations is neglected.\n\nThe species involved in the reaction network are:\n- $D_i$: Interstitial dopant concentration (inactive), in units of $\\text{cm}^{-3}$.\n- $D_s$: Substitutional dopant concentration (electrically active), in units of $\\text{cm}^{-3}$.\n- $X$: Dopant-interstitial complex concentration (inactive), in units of $\\text{cm}^{-3}$.\n- $I$: Self-interstitial point defect concentration, in units of $\\text{cm}^{-3}$.\n- $V$: Vacancy point defect concentration, in units of $\\text{cm}^{-3}$.\n\nThe state of the system at any time $t$ is described by the vector of concentrations $y(t) = ([D_i], [D_s], [X], [I], [V])$.\n\nThe reactions governing the system kinetics are:\n1. Interstitialcy activation/deactivation: $D_i + I \\rightleftharpoons_{k_{1r}(T)}^{k_1(T)} D_s$\n2. Complex formation/dissolution: $D_s + I \\rightleftharpoons_{k_{2r}(T)}^{k_2(T)} X$\n3. Interstitial-vacancy recombination: $I + V \\xrightarrow{k_3(T)} \\varnothing$ (annihilation)\n\nAccording to the law of mass action, the rates for these reactions are given by:\n- $R_1 = k_1(T) [D_i] [I]$\n- $R_{1r} = k_{1r}(T) [D_s]$\n- $R_2 = k_2(T) [D_s] [I]$\n- $R_{2r} = k_{2r}(T) [X]$\n- $R_3 = k_3(T) [I] [V]$\n\nFrom these rates, we can derive the system of ODEs describing the rate of change of each species' concentration. The rate of change for each species is the sum of the rates of the reactions that produce it, minus the sum of the rates of the reactions that consume it.\n\nThe resulting system of five coupled first-order ODEs is:\n$$ \\frac{d[D_i]}{dt} = -R_1 + R_{1r} = -k_1 [D_i][I] + k_{1r} [D_s] $$\n$$ \\frac{d[D_s]}{dt} = R_1 - R_{1r} - R_2 + R_{2r} = k_1 [D_i][I] - k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] $$\n$$ \\frac{d[X]}{dt} = R_2 - R_{2r} = k_2 [D_s][I] - k_{2r} [X] $$\n$$ \\frac{d[I]}{dt} = -R_1 + R_{1r} - R_2 + R_{2r} - R_3 = -k_1 [D_i][I] + k_{1r} [D_s] - k_2 [D_s][I] + k_{2r} [X] - k_3 [I][V] $$\n$$ \\frac{d[V]}{dt} = -R_3 = -k_3 [I][V] $$\n\nA critical consistency check is to verify the conservation of total dopant atoms during an anneal. The total dopant concentration is $D_{tot} = [D_i] + [D_s] + [X]$. Its time derivative is $\\frac{dD_{tot}}{dt} = \\frac{d[D_i]}{dt} + \\frac{d[D_s]}{dt} + \\frac{d[X]}{dt}$. Summing the derived ODEs, all terms cancel, yielding $\\frac{dD_{tot}}{dt} = 0$, which confirms that the total dopant concentration is a conserved quantity during thermal annealing, as expected.\n\nThe temperature dependence of the rate constants $k_j$ is given by the Arrhenius equation:\n$$ k_j(T) = k_{j,0} \\exp\\left(-\\frac{E_{a,j}}{k_B T}\\right) $$\nwhere $k_{j,0}$ is the pre-exponential factor, $E_{a,j}$ is the activation energy for reaction $j$, $T$ is the absolute temperature in Kelvin, and $k_B$ is the Boltzmann constant, given as $8.617 \\times 10^{-5}\\,\\text{eV/K}$. The specific parameters for each reaction are provided in the problem statement.\n\nThe simulation proceeds by sequentially processing the steps for each given sequence:\n1.  **Implant Step:** This is modeled as an instantaneous change in the concentrations. For an implant of dose $D$, with interstitial fraction $f_i$ and damage factors $\\alpha_I$ and $\\alpha_V$, the state vector is updated as follows:\n    - $[D_i] \\leftarrow [D_i] + f_i D$\n    - $[D_s] \\leftarrow [D_s] + (1 - f_i) D$\n    - $[I] \\leftarrow [I] + \\alpha_I D$\n    - $[V] \\leftarrow [V] + \\alpha_V D$\n2.  **Anneal Step:** This step involves solving the system of ODEs over a time interval $[0, \\tau]$ at a constant temperature $T$. First, the rate constants $k_j(T)$ are calculated for the specified temperature $T$. Then, a numerical ODE solver is used to integrate the system. Due to the wide range of timescales possible in such kinetic systems, they are often stiff. Therefore, a numerical method suitable for stiff problems, such as the Backward Differentiation Formula (BDF), is required. The initial condition for the integration is the state vector at the end of the previous step. The final state vector from the solver becomes the initial state for the next step.\n\nAfter all steps in a sequence are completed, the final active dopant fraction, $\\phi$, is calculated using the final concentrations:\n$$ \\phi = \\frac{[D_s]_{final}}{[D_i]_{final} + [D_s]_{final} + [X]_{final}} $$\n\nThis procedure is repeated for each of the three test sequences. Finally, the sequence that yields the highest value of $\\phi$ is identified as the optimal one. The results are then formatted as requested.\n\nThe implementation will utilize the `scipy.integrate.solve_ivp` function with the `method='BDF'` option to handle the stiff ODE system during the anneal steps. The state of the system will be tracked using a NumPy array, which will be updated after each implant and anneal step.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the dopant activation/deactivation kinetics problem for three\n    different process sequences.\n    \"\"\"\n\n    # --- Constants and Parameters ---\n    KB = 8.617e-5  # Boltzmann constant in eV/K\n\n    # Arrhenius parameters: (k_0, E_a)\n    # k_0 units: cm^3/s for bimolecular, 1/s for unimolecular\n    # E_a units: eV\n    PARAMS = {\n        'k1': (1.0e-13, 0.80),\n        'k1r': (1.0e4, 2.20),\n        'k2': (5.0e-14, 1.20),\n        'k2r': (5.0e2, 2.60),\n        'k3': (2.0e-12, 0.50),\n    }\n\n    # --- Test Sequences Definition ---\n    # Structure: list of sequences, where each sequence is a list of steps.\n    # Each step is a dictionary defining its type and parameters.\n    # Species order in state vector: [Di, Ds, X, I, V]\n    \n    sequences = [\n        # Sequence 1\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 600},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1273, 'tau': 120}\n        ],\n        # Sequence 2\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1223, 'tau': 900}\n        ],\n        # Sequence 3\n        [\n            {'type': 'implant', 'dose': 3.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1173, 'tau': 60},\n            {'type': 'implant', 'dose': 2.0e19, 'fi': 0.95, 'alpha_I': 0.20, 'alpha_V': 0.20},\n            {'type': 'anneal', 'T': 1373, 'tau': 30}\n        ]\n    ]\n\n    initial_conditions = [\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 1: Di, Ds, X, I, V\n        np.array([0.0, 0.0, 0.0, 0.0, 0.0]), # Seq 2\n        np.array([0.0, 0.0, 0.0, 5.0e18, 5.0e18]) # Seq 3\n    ]\n\n    def get_rate_constants(T):\n        \"\"\"Calculates Arrhenius rate constants for a given temperature T.\"\"\"\n        k = {}\n        for key, (k0, Ea) in PARAMS.items():\n            k[key] = k0 * np.exp(-Ea / (KB * T))\n        return k['k1'], k['k1r'], k['k2'], k['k2r'], k['k3']\n\n    def ode_system(t, y, k1, k1r, k2, k2r, k3):\n        \"\"\"\n        Defines the system of ordinary differential equations for dopant kinetics.\n        y = [Di, Ds, X, I, V]\n        \"\"\"\n        Di, Ds, X, I, V = y\n        \n        # Ensure concentrations do not go below zero during integration\n        if Di  0: Di = 0\n        if Ds  0: Ds = 0\n        if X  0: X = 0\n        if I  0: I = 0\n        if V  0: V = 0\n\n        # Reaction rates\n        R1 = k1 * Di * I\n        R1r = k1r * Ds\n        R2 = k2 * Ds * I\n        R2r = k2r * X\n        R3 = k3 * I * V\n\n        # ODEs\n        dDi_dt = -R1 + R1r\n        dDs_dt = R1 - R1r - R2 + R2r\n        dX_dt = R2 - R2r\n        dI_dt = -R1 + R1r - R2 + R2r - R3\n        dV_dt = -R3\n        \n        return [dDi_dt, dDs_dt, dX_dt, dI_dt, dV_dt]\n\n    final_phis = []\n\n    for i, sequence in enumerate(sequences):\n        # Initialize state vector from the problem's initial conditions\n        y = np.copy(initial_conditions[i])\n\n        for step in sequence:\n            if step['type'] == 'implant':\n                dose = step['dose']\n                fi = step['fi']\n                alpha_I = step['alpha_I']\n                alpha_V = step['alpha_V']\n                \n                y[0] += fi * dose         # Di\n                y[1] += (1 - fi) * dose   # Ds\n                y[3] += alpha_I * dose    # I\n                y[4] += alpha_V * dose    # V\n            \n            elif step['type'] == 'anneal':\n                T = step['T']\n                tau = step['tau']\n                \n                # Calculate rate constants for the anneal temperature\n                k_tuple = get_rate_constants(T)\n                \n                # Solve the ODE system for the anneal duration\n                sol = solve_ivp(\n                    fun=ode_system,\n                    t_span=[0, tau],\n                    y0=y,\n                    method='BDF',  # Suitable for stiff systems\n                    args=k_tuple,\n                    dense_output=False\n                )\n                \n                # Update state vector with the final concentrations\n                y = sol.y[:, -1]\n\n        # Calculate final active fraction phi\n        Di_f, Ds_f, X_f = y[0], y[1], y[2]\n        total_dopant = Di_f + Ds_f + X_f\n        \n        # Handle case where total_dopant is zero to avoid division by zero\n        phi = (Ds_f / total_dopant) if total_dopant  0 else 0.0\n        final_phis.append(phi)\n\n    # Determine the optimal sequence (1-based index)\n    best_idx = np.argmax(final_phis) + 1\n\n    # Format the output string\n    phi_strings = [f\"{phi:.3f}\" for phi in final_phis]\n    output_list = phi_strings + [str(best_idx)]\n    \n    print(f\"[{','.join(output_list)}]\")\n\nsolve()\n```"
        }
    ]
}