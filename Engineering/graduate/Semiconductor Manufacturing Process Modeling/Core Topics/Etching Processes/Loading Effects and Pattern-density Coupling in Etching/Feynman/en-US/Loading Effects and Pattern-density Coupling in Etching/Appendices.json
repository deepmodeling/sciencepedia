{
    "hands_on_practices": [
        {
            "introduction": "This first exercise introduces the global loading effect using a simplified but powerful reactor-scale model. By treating the plasma chamber as a Continuous Stirred-Tank Reactor (CSTR), we can use a fundamental species conservation law to understand how the total reactive area on a wafer influences reactant concentration. This practice  will allow you to derive the relationship between pattern density and etch rate from first principles and explore how process parameters can be tuned to manage this critical effect.",
            "id": "4139087",
            "problem": "A single-wafer plasma etch reactor is modeled as a Continuous Stirred-Tank Reactor (CSTR) with well-mixed reactive species number density $c(t)$ in chamber volume $V$. The reactor is supplied with radicals at a fixed uniform volumetric generation rate $F$ (number per unit volume per unit time), and pumped with gas residence time $\\tau$. Reactive species are consumed at wafer surfaces by first-order surface kinetics with rate coefficient $k_s$ (having dimensions of length per unit time). Global pattern-density loading enters through the total reactive open area $A_{\\mathrm{open}}$ presented by the wafer being processed. \n\nAssume the following physically motivated foundations:\n- Species conservation in a well-mixed volume requires that the temporal evolution of the number density $c(t)$ balance supply, outflow, and surface-consumption terms.\n- First-order surface reaction kinetics implies a consumption flux per unit open area proportional to $k_s c(t)$, so the chamber-wide volumetric consumption term scales as $k_s c(t) A_{\\mathrm{open}} / V$.\n\nTwo wafers, processed in separate runs under identical reactor conditions, have different global open-area fractions $\\phi_1$ and $\\phi_2$. The wafer radius is $r = 0.15$ m, the chamber volume is $V = 5.0 \\times 10^{-2}$ m$^3$, the surface reaction rate coefficient is $k_s = 1.0$ m/s, and the gas residence time is $\\tau = 0.50$ s. The open-area fractions are $\\phi_1 = 0.20$ and $\\phi_2 = 0.50$. The total wafer area is $A_{\\mathrm{w}} = \\pi r^2$, and the global open areas are $A_{\\mathrm{open},i} = \\phi_i A_{\\mathrm{w}}$ for $i \\in \\{1,2\\}$.\n\nUsing the above foundations, derive the steady-state etch rate on each wafer as a function of $F$, $k_s$, $\\tau$, $V$, and $A_{\\mathrm{open}}$, and then compute the ratio of steady-state etch rates $R_1/R_2$ for the two wafers. Round your final ratio to four significant figures and express it as a dimensionless number. In your reasoning, discuss the process window implications of the computed ratio in terms of loading sensitivity and how adjustments to $F$, $k_s$, or $\\tau$ would alter pattern-density coupling.",
            "solution": "The problem asks for the ratio of steady-state etch rates for two wafers with different pattern densities, processed in a single-wafer plasma etch reactor modeled as a Continuous Stirred-Tank Reactor (CSTR). First, we must formulate the species conservation equation for the reactive species number density, $c(t)$, within the reactor volume $V$.\n\nThe principle of species conservation states that the rate of change of the total number of reactive species in the chamber, $V c(t)$, is the sum of the rates of generation, outflow, and consumption.\nThe temporal evolution of the number density $c(t)$ is given by the differential equation:\n$$\n\\frac{d(V c(t))}{dt} = (\\text{Generation Rate}) - (\\text{Outflow Rate}) - (\\text{Consumption Rate})\n$$\nThe terms are defined as follows based on the problem statement:\n$1$. The generation rate of species is given by the volumetric generation rate $F$ (number per unit volume per time) throughout the chamber volume $V$. Thus, the total generation rate is $F V$.\n$2$. The outflow rate is determined by the gas residence time $\\tau$. The volumetric flow rate of gas out of the chamber is $Q = V/\\tau$. The rate of species loss due to outflow is this flow rate multiplied by the species concentration, $Q c(t) = (V/\\tau) c(t)$.\n$3$. The consumption rate occurs at the wafer surface. The problem states that the consumption flux is governed by first-order kinetics, with a flux per unit open area of $k_s c(t)$. The total number of particles consumed per unit time is this flux multiplied by the total reactive open area, $A_{\\mathrm{open}}$. The consumption rate is therefore $k_s c(t) A_{\\mathrm{open}}$.\n\nSubstituting these terms into the conservation equation gives:\n$$\n\\frac{d(V c(t))}{dt} = F V - \\frac{V}{\\tau} c(t) - k_s A_{\\mathrm{open}} c(t)\n$$\nSince the volume $V$ is constant, we can divide by $V$ to obtain the equation for the number density $c(t)$:\n$$\n\\frac{dc(t)}{dt} = F - \\frac{c(t)}{\\tau} - \\frac{k_s A_{\\mathrm{open}}}{V} c(t)\n$$\nThis can be rewritten as:\n$$\n\\frac{dc(t)}{dt} = F - c(t) \\left( \\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open}}}{V} \\right)\n$$\nThe problem asks for the steady-state etch rates. At steady state, the number density is constant, so $\\frac{dc(t)}{dt} = 0$. Let $c_{\\mathrm{ss}}$ be the steady-state number density.\n$$\n0 = F - c_{\\mathrm{ss}} \\left( \\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open}}}{V} \\right)\n$$\nSolving for $c_{\\mathrm{ss}}$ yields:\n$$\nc_{\\mathrm{ss}} = \\frac{F}{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open}}}{V}}\n$$\nThe etch rate, $R$, is proportional to the flux of reactive species onto the wafer surface. The flux is given by $k_s c(t)$. Thus, we can write the steady-state etch rate $R$ as $R = \\gamma k_s c_{\\mathrm{ss}}$, where $\\gamma$ is a constant of proportionality (e.g., an etch yield factor).\n$$\nR = \\frac{\\gamma k_s F}{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open}}}{V}}\n$$\nWe need to compute the ratio of the steady-state etch rates, $R_1/R_2$, for two wafers with different open areas, $A_{\\mathrm{open},1}$ and $A_{\\mathrm{open},2}$. The reactor conditions ($F$, $k_s$, $\\tau$, $V$) and the proportionality constant $\\gamma$ are the same for both runs.\n$$\n\\frac{R_1}{R_2} = \\frac{\\frac{\\gamma k_s F}{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open},1}}{V}}}{\\frac{\\gamma k_s F}{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open},2}}{V}}}\n$$\nThe terms $\\gamma$, $k_s$, and $F$ cancel, leaving:\n$$\n\\frac{R_1}{R_2} = \\frac{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open},2}}{V}}{\\frac{1}{\\tau} + \\frac{k_s A_{\\mathrm{open},1}}{V}}\n$$\nThis expression shows the loading effect: the etch rate on one wafer depends on the properties of the *other* wafer being compared, through the common terms $1/\\tau$. This is because the reactant concentration is set by a global balance in the chamber.\n\nNow we substitute the given numerical values.\nWafer radius $r = 0.15$ m.\nTotal wafer area $A_{\\mathrm{w}} = \\pi r^2 = \\pi (0.15)^2 = 0.0225 \\pi$ m$^2$.\nThe open-area fractions are $\\phi_1 = 0.20$ and $\\phi_2 = 0.50$.\nThe corresponding open areas are:\n$A_{\\mathrm{open},1} = \\phi_1 A_{\\mathrm{w}} = 0.20 \\times 0.0225 \\pi = 0.0045 \\pi$ m$^2$.\n$A_{\\mathrm{open},2} = \\phi_2 A_{\\mathrm{w}} = 0.50 \\times 0.0225 \\pi = 0.01125 \\pi$ m$^2$.\n\nThe other parameters are:\nChamber volume $V = 5.0 \\times 10^{-2}$ m$^3$.\nSurface reaction rate coefficient $k_s = 1.0$ m/s.\nGas residence time $\\tau = 0.50$ s.\n\nLet's calculate the terms in the ratio expression. The pumping loss rate term is:\n$$\n\\frac{1}{\\tau} = \\frac{1}{0.50 \\text{ s}} = 2.0 \\text{ s}^{-1}\n$$\nThe consumption rate terms per unit concentration are:\n$$\n\\frac{k_s A_{\\mathrm{open},1}}{V} = \\frac{(1.0 \\text{ m/s}) (0.0045 \\pi \\text{ m}^2)}{5.0 \\times 10^{-2} \\text{ m}^3} = \\frac{0.0045 \\pi}{0.05} \\text{ s}^{-1} = 0.09 \\pi \\text{ s}^{-1}\n$$\n$$\n\\frac{k_s A_{\\mathrm{open},2}}{V} = \\frac{(1.0 \\text{ m/s}) (0.01125 \\pi \\text{ m}^2)}{5.0 \\times 10^{-2} \\text{ m}^3} = \\frac{0.01125 \\pi}{0.05} \\text{ s}^{-1} = 0.225 \\pi \\text{ s}^{-1}\n$$\nNow, substitute these into the ratio expression:\n$$\n\\frac{R_1}{R_2} = \\frac{2.0 + 0.225 \\pi}{2.0 + 0.09 \\pi}\n$$\nUsing a value for $\\pi \\approx 3.14159$, we calculate the numerator and denominator:\nNumerator: $2.0 + 0.225 \\times 3.14159 \\approx 2.0 + 0.70686 = 2.70686$.\nDenominator: $2.0 + 0.09 \\times 3.14159 \\approx 2.0 + 0.28274 = 2.28274$.\n$$\n\\frac{R_1}{R_2} \\approx \\frac{2.70686}{2.28274} \\approx 1.18580\n$$\nRounding to four significant figures, the ratio is $1.186$.\n\nThe fact that $R_1/R_2 > 1$ signifies a \"loading effect\": the wafer with the smaller open area ($\\phi_1 = 0.20$) etches faster than the wafer with the larger open area ($\\phi_2 = 0.50$). This is because a smaller reactive area consumes fewer reactants, leading to a higher steady-state concentration $c_{\\mathrm{ss}}$ in the chamber, which in turn increases the flux to the surface and the etch rate.\n\nDiscussion of process window implications:\nThe derived ratio quantifies pattern-density loading. The sensitivity of the etch rate to the open area $A_{\\mathrm{open}}$ depends on the relative magnitudes of the pumping loss term, $1/\\tau$, and the surface consumption term, $k_s A_{\\mathrm{open}}/V$.\n- The expression $c_{\\mathrm{ss}} = F / (1/\\tau + k_s A_{\\mathrm{open}}/V)$ shows that the reactant concentration is coupled to the wafer pattern density through $A_{\\mathrm{open}}$.\n- Strong coupling (a large loading effect) occurs when the consumption term $k_s A_{\\mathrm{open}}/V$ is comparable to or larger than the pumping term $1/\\tau$. This makes the etch rate highly sensitive to the pattern density, which is generally undesirable as it can cause poor rate control and variability between products.\n- Adjustments to reactor parameters can alter this coupling:\n  - **Generation Rate ($F$)**: Increasing $F$ increases all etch rates proportionally ($R \\propto F$), but it does not change the ratio $R_1/R_2$. Thus, it does not mitigate the relative loading effect.\n  - **Surface Reaction Coefficient ($k_s$)**: Decreasing $k_s$ (e.g., by lowering wafer temperature) reduces the consumption term relative to the pumping term. This drives the ratio $R_1/R_2$ closer to $1$, weakening the pattern-density coupling. The process becomes more \"flow-limited\" or \"supply-limited\".\n  - **Residence Time ($\\tau$)**: Decreasing $\\tau$ (i.e., increasing the gas flow rate $Q = V/\\tau$) increases the pumping term $1/\\tau$. This also makes the consumption term less significant in the overall balance, driving the ratio $R_1/R_2$ closer to $1$ and reducing loading sensitivity. Operating at high flow rates is a common strategy to create a more robust process with a wider window against pattern-density variations.\n\nIn summary, to minimize loading effects and expand the process window, one should operate in a regime where reactant depletion by surface reaction is small compared to the total flow of reactants through the chamber. This corresponds to high gas flow rates (small $\\tau$) and/or low surface reactivity (small $k_s$).",
            "answer": "$$\n\\boxed{1.186}\n$$"
        },
        {
            "introduction": "While the global loading model is instructive, real-world etch uniformity is governed by local variations in pattern density. This exercise  moves from the reactor scale to the die scale, introducing a transport-reaction model based on the screened Poisson equation. You will apply the powerful Green's function method to calculate the concentration depression at the center of a patterned region, providing a concrete understanding of concepts like screening length and the spatial extent of loading effects.",
            "id": "4139082",
            "problem": "Consider a neutral etchant whose surface concentration $c(\\mathbf{r})$ over a silicon wafer is laterally coupled by diffusion and locally depleted by first-order reaction at exposed features. Let the concentration depression be defined as $\\Delta c(\\mathbf{r}) = c_{\\infty} - c(\\mathbf{r})$, where $c_{\\infty}$ is the far-field concentration. Under quasi-steady operation and linear response, a widely used homogenized in-plane transport model for loading effects and pattern-density coupling posits that $\\Delta c(\\mathbf{r})$ obeys the two-dimensional screened Poisson partial differential equation (PDE)\n$$\n\\left( \\nabla_{\\parallel}^{2} - \\lambda^{2} \\right)\\,\\Delta c(\\mathbf{r}) \\;=\\; -\\,\\alpha\\,\\rho(\\mathbf{r}),\n$$\nwhere $\\nabla_{\\parallel}^{2}$ is the Laplacian in the wafer plane, $\\lambda0$ is the inverse screening length, $\\alpha0$ is a proportionality constant set by process parameters (diffusivity, boundary-layer exchange, and reaction kinetics), and $\\rho(\\mathbf{r})$ is the local exposed area density per unit footprint area.\n\nAssume a single circular dense region (disk) of radius $R$ centered at $\\mathbf{r}=\\mathbf{0}$ has uniform pattern density $\\rho(\\mathbf{r})=\\rho_{0}$ for $|\\mathbf{r}|\\le R$, and $\\rho(\\mathbf{r})=0$ for $|\\mathbf{r}|R$. The wafer is otherwise large enough that boundary influences are negligible. Using cylindrical coordinates and the modified Bessel function formalism appropriate to this PDE, derive an exact analytic expression for the concentration depression at the center, $\\Delta c(\\mathbf{0})$, in terms of $\\alpha$, $\\lambda$, $\\rho_{0}$, and $R$. Express your final answer as a single closed-form expression. No numerical evaluation or rounding is required.",
            "solution": "The problem asks for the concentration depression, $\\Delta c(\\mathbf{r})$, at the center of a circular region. The governing partial differential equation (PDE) is the two-dimensional screened Poisson equation:\n$$\n\\left( \\nabla_{\\parallel}^{2} - \\lambda^{2} \\right)\\,\\Delta c(\\mathbf{r}) \\;=\\; -\\,\\alpha\\,\\rho(\\mathbf{r})\n$$\nwhere $\\mathbf{r}$ is the position vector in the wafer plane. The source term, $\\rho(\\mathbf{r})$, is the pattern density, given as a constant $\\rho_0$ inside a disk of radius $R$ and zero outside:\n$$\n\\rho(\\mathbf{r}) = \\begin{cases} \\rho_{0}  \\text{for } |\\mathbf{r}| \\le R \\\\ 0  \\text{for } |\\mathbf{r}|  R \\end{cases}\n$$\nThe problem is best solved using the Green's function method. The Green's function $G(\\mathbf{r}, \\mathbf{r'})$ for the operator $(\\nabla_{\\parallel}^{2} - \\lambda^{2})$ in two dimensions, with the boundary condition that the solution vanishes at infinity, is given by:\n$$\nG(\\mathbf{r}, \\mathbf{r'}) \\;=\\; -\\frac{1}{2\\pi} K_{0}(\\lambda |\\mathbf{r} - \\mathbf{r'}|)\n$$\nwhere $K_{0}$ is the modified Bessel function of the second kind of order zero. This function satisfies the equation $(\\nabla_{\\parallel}^{2} - \\lambda^{2}) G(\\mathbf{r}, \\mathbf{r'}) = \\delta(\\mathbf{r} - \\mathbf{r'})$.\n\nThe solution $\\Delta c(\\mathbf{r})$ can be expressed as the convolution of the Green's function with the source term $-\\alpha\\rho(\\mathbf{r})$:\n$$\n\\Delta c(\\mathbf{r}) = \\int_{\\mathbb{R}^2} G(\\mathbf{r}, \\mathbf{r'}) \\left( -\\alpha\\,\\rho(\\mathbf{r'}) \\right) \\,d^2\\mathbf{r'}\n$$\nSubstituting the expression for the Green's function, we have:\n$$\n\\Delta c(\\mathbf{r}) = \\int_{\\mathbb{R}^2} \\left(-\\frac{1}{2\\pi} K_{0}(\\lambda |\\mathbf{r} - \\mathbf{r'}|)\\right) \\left( -\\alpha\\,\\rho(\\mathbf{r'}) \\right) \\,d^2\\mathbf{r'}\n$$\n$$\n\\Delta c(\\mathbf{r}) = \\frac{\\alpha}{2\\pi} \\int_{\\mathbb{R}^2} \\rho(\\mathbf{r'}) K_{0}(\\lambda |\\mathbf{r} - \\mathbf{r'}|) \\,d^2\\mathbf{r'}\n$$\nWe need to evaluate this expression at the center of the disk, i.e., at $\\mathbf{r} = \\mathbf{0}$.\n$$\n\\Delta c(\\mathbf{0}) = \\frac{\\alpha}{2\\pi} \\int_{\\mathbb{R}^2} \\rho(\\mathbf{r'}) K_{0}(\\lambda |-\\mathbf{r'}|) \\,d^2\\mathbf{r'}\n$$\nSince $\\rho(\\mathbf{r'})$ is non-zero only for $|\\mathbf{r'}| \\le R$ (where it equals $\\rho_0$), and $|-\\mathbf{r'}| = |\\mathbf{r'}|$, the integral becomes:\n$$\n\\Delta c(\\mathbf{0}) = \\frac{\\alpha \\rho_{0}}{2\\pi} \\int_{|\\mathbf{r'}| \\le R} K_{0}(\\lambda |\\mathbf{r'}|) \\,d^2\\mathbf{r'}\n$$\nTo evaluate this integral over the disk, we switch to polar coordinates for the integration variable $\\mathbf{r'}$. Let $r' = |\\mathbf{r'}|$ and let $\\theta'$ be the polar angle. The differential area element is $d^2\\mathbf{r'} = r' dr' d\\theta'$.\n$$\n\\Delta c(\\mathbf{0}) = \\frac{\\alpha \\rho_{0}}{2\\pi} \\int_{0}^{2\\pi} \\int_{0}^{R} K_{0}(\\lambda r') \\,r' dr' d\\theta'\n$$\nThe integrand is independent of $\\theta'$, so the angular integration yields a factor of $2\\pi$:\n$$\n\\Delta c(\\mathbf{0}) = \\frac{\\alpha \\rho_{0}}{2\\pi} \\cdot 2\\pi \\int_{0}^{R} r' K_{0}(\\lambda r') \\,dr'\n$$\n$$\n\\Delta c(\\mathbf{0}) = \\alpha \\rho_{0} \\int_{0}^{R} r' K_{0}(\\lambda r') \\,dr'\n$$\nTo solve the remaining integral, we use the following identity for modified Bessel functions:\n$$\n\\frac{d}{dx}\\left[x^{\\nu} K_{\\nu}(x)\\right] = -x^{\\nu} K_{\\nu-1}(x)\n$$\nFor $\\nu=1$, this identity becomes:\n$$\n\\frac{d}{dx}\\left[x K_{1}(x)\\right] = -x K_{0}(x)\n$$\nThis implies $\\int x K_{0}(x) \\,dx = -x K_{1}(x)$. We use this to evaluate our definite integral. Let $u = \\lambda r'$, so $du = \\lambda dr'$. The limits of integration change from $r' \\in [0, R]$ to $u \\in [0, \\lambda R]$.\n$$\n\\int_{0}^{R} r' K_{0}(\\lambda r') \\,dr' = \\int_{0}^{\\lambda R} \\frac{u}{\\lambda} K_{0}(u) \\frac{du}{\\lambda} = \\frac{1}{\\lambda^2} \\int_{0}^{\\lambda R} u K_{0}(u) \\,du\n$$\nUsing the integration formula:\n$$\n\\frac{1}{\\lambda^2} \\int_{0}^{\\lambda R} u K_{0}(u) \\,du = \\frac{1}{\\lambda^2} \\left[ -u K_{1}(u) \\right]_{0}^{\\lambda R}\n$$\nThe upper limit evaluates to $-(\\lambda R) K_{1}(\\lambda R)$. For the lower limit, we must consider the behavior of $u K_{1}(u)$ as $u \\to 0$. The asymptotic form of $K_{1}(u)$ for small $u$ is $K_{1}(u) \\sim 1/u$. Therefore:\n$$\n\\lim_{u \\to 0^+} u K_{1}(u) = \\lim_{u \\to 0^+} u \\cdot \\frac{1}{u} = 1\n$$\nSo the definite integral is:\n$$\n\\frac{1}{\\lambda^2} \\left( -(\\lambda R) K_{1}(\\lambda R) - (-1) \\right) = \\frac{1}{\\lambda^2} \\left( 1 - \\lambda R K_{1}(\\lambda R) \\right)\n$$\nSubstituting this result back into the expression for $\\Delta c(\\mathbf{0})$:\n$$\n\\Delta c(\\mathbf{0}) = \\alpha \\rho_{0} \\cdot \\frac{1}{\\lambda^2} \\left( 1 - \\lambda R K_{1}(\\lambda R) \\right)\n$$\nThis gives the final closed-form expression for the concentration depression at the center.\n$$\n\\Delta c(\\mathbf{0}) = \\frac{\\alpha \\rho_{0}}{\\lambda^2} \\left( 1 - \\lambda R K_{1}(\\lambda R) \\right)\n$$",
            "answer": "$$\\boxed{\\frac{\\alpha \\rho_{0}}{\\lambda^{2}} \\left( 1 - \\lambda R K_{1}(\\lambda R) \\right)}$$"
        },
        {
            "introduction": "Analytical solutions, like the one derived in the previous exercise, are invaluable for building intuition but are limited to simple geometries. To predict loading effects on realistic, complex layouts, we turn to computational models. In this hands-on coding practice , you will implement a kernel-convolution model, which is the numerical counterpart to the Green's function approach, to predict etch depth on a synthetic pattern and evaluate its accuracy, thereby gaining practical experience in the validation and comparison of process simulation tools.",
            "id": "4139148",
            "problem": "You are to implement and compare two predictive models for pattern-density coupling in plasma etching under loading effects using a synthetic chessboard layout. The goal is to evaluate the predictive accuracy of a kernel-convolution model against a simplified linear local-density model by computing mean absolute error across open features. The modeling must start from a transport-reaction description and derive the algorithmic expressions used. The domain is a periodic square wafer segment modeled on a grid.\n\nFundamental base:\n- Let the instantaneous etch rate at location with local open area indicator be denoted by $R(x,y)$, and the time-integrated etch depth by $H(x,y)$ over duration $T$. The open area indicator $P(x,y)$ is binary with $P(x,y)=1$ for open regions and $P(x,y)=0$ for masked regions.\n- Under steady-state gas-phase transport and surface reaction, let the local reactant concentration be $c(x,y)$ and the no-loading baseline concentration be $c_{\\infty}$. Loading reduces $c(x,y)$ due to distributed consumption. For a layer with periodic boundary conditions and screened diffusion, the screened Poisson Greenâ€™s function is exponentially decaying with a characteristic length $L$, which justifies representing the coarse-grained depletion by the spatial convolution of $P(x,y)$ with a normalized kernel that decays as $\\exp(-r/L)$, where $r$ is the radial distance.\n- Assume first-order surface reaction so the local etch rate scales linearly with $c(x,y)$ on open features.\n\nDefinitions for models to implement:\n- Ground truth model (reference diffusion-reaction): $R_{\\mathrm{true}}(x,y) = R_{0}\\,P(x,y)\\,\\frac{c(x,y)}{c_{\\infty}}$, with the depletion represented by a normalized exponential kernel. Define the relative concentration as $\\frac{c(x,y)}{c_{\\infty}} = \\max\\left(0,\\,1 - \\phi_{\\mathrm{true}}\\;\\left(P * K_{L_{\\mathrm{true}}}\\right)(x,y)\\right)$, where $*$ denotes periodic convolution, $K_{L}$ is the normalized kernel associated with length $L$, and $\\phi_{\\mathrm{true}}$ is a dimensionless depletion amplitude. The true etch depth is $H_{\\mathrm{true}}(x,y) = R_{\\mathrm{true}}(x,y)\\,T$.\n- Kernel-convolution model (predictive): $R_{\\mathrm{ker}}(x,y) = R_{0}\\,P(x,y)\\,\\max\\left(0,\\,1 - \\phi_{\\mathrm{model}}\\;\\left(P * K_{L_{\\mathrm{model}}}\\right)(x,y)\\right)$ and $H_{\\mathrm{ker}}(x,y) = R_{\\mathrm{ker}}(x,y)\\,T$, with model parameters $L_{\\mathrm{model}}$ and $\\phi_{\\mathrm{model}}$ possibly mismatched to the ground truth.\n- Simplified linear local-density model (predictive): Define a periodic box-window average of $P(x,y)$ over a half-width $w$ (in pixels) as $f_{\\mathrm{local}}(x,y) = P * U_{w}$, where $U_{w}$ is a normalized box kernel. The predicted rate is $R_{\\mathrm{lin}}(x,y) = R_{0}\\,P(x,y)\\,\\max\\left(0,\\,1 - k_{\\mathrm{lin}}\\;f_{\\mathrm{local}}(x,y)\\right)$ and $H_{\\mathrm{lin}}(x,y) = R_{\\mathrm{lin}}(x,y)\\,T$, with $k_{\\mathrm{lin}}$ a dimensionless slope.\n\nChessboard pattern:\n- On an $N \\times N$ grid with pixel pitch $d_{x}$ (in micrometers), create a chessboard where $P(i,j)=1$ if $\\left\\lfloor \\frac{i}{s} \\right\\rfloor + \\left\\lfloor \\frac{j}{s} \\right\\rfloor$ is even, and $P(i,j)=0$ otherwise, where $s$ is the square cell edge size in pixels. Index $i,j$ start at $0$.\n\nKernel construction:\n- Use periodic boundary conditions and perform convolution via the Fast Fourier Transform (FFT) to model the wafer segment as toroidal. For the exponential kernel $K_{L}$, use minimum-image periodic distances: $r(i,j) = \\sqrt{(\\min(i, N-i)\\,d_{x})^{2} + (\\min(j, N-j)\\,d_{x})^{2}}$. Construct $K_{L}(i,j) \\propto \\exp\\left(-\\frac{r(i,j)}{L}\\right)$ and normalize so that $\\sum_{i,j} K_{L}(i,j) = 1$. For the box kernel $U_{w}$, set $U_{w}(i,j) = 1$ for indices with $\\min(i, N-i) \\leq w$ and $\\min(j, N-j) \\leq w$, else $U_{w}(i,j) = 0$, then normalize.\n\nError metric:\n- Compute the mean absolute error on open features only: $\\mathrm{MAE}_{\\mathrm{ker}} = \\frac{1}{M}\\sum_{P(i,j)=1} \\left|H_{\\mathrm{ker}}(i,j) - H_{\\mathrm{true}}(i,j)\\right|$, and $\\mathrm{MAE}_{\\mathrm{lin}} = \\frac{1}{M}\\sum_{P(i,j)=1} \\left|H_{\\mathrm{lin}}(i,j) - H_{\\mathrm{true}}(i,j)\\right|$, where $M$ is the number of open pixels. Report both in nanometers.\n\nUnits:\n- The baseline etch rate $R_{0}$ must be in nanometers per second ($\\mathrm{nm/s}$).\n- The duration $T$ must be in seconds ($\\mathrm{s}$).\n- The pixel pitch $d_{x}$, lengths $L_{\\mathrm{true}}$ and $L_{\\mathrm{model}}$, and window radius $r_{w}$ must be in micrometers ($\\mu\\mathrm{m}$).\n- The mean absolute errors must be reported in nanometers ($\\mathrm{nm}$) as floating-point numbers.\n\nTest suite:\nImplement the above for the following parameter sets. For each case, compute $\\mathrm{MAE}_{\\mathrm{ker}}$ and $\\mathrm{MAE}_{\\mathrm{lin}}$.\n\n- Case $1$ (happy path, moderate coupling and slight model mismatch):\n    - $N=64$, $s=8$, $d_{x}=0.2$ $\\mu\\mathrm{m}$, $R_{0}=5$ $\\mathrm{nm/s}$, $T=10$ $\\mathrm{s}$, $L_{\\mathrm{true}}=2.0$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{true}}=0.35$, $L_{\\mathrm{model}}=1.8$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{model}}=0.30$, $k_{\\mathrm{lin}}=0.28$, $r_{w}=2.5$ $\\mu\\mathrm{m}$.\n- Case $2$ (boundary, short-range coupling near local behavior):\n    - $N=64$, $s=8$, $d_{x}=0.2$ $\\mu\\mathrm{m}$, $R_{0}=5$ $\\mathrm{nm/s}$, $T=10$ $\\mathrm{s}$, $L_{\\mathrm{true}}=0.3$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{true}}=0.25$, $L_{\\mathrm{model}}=0.5$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{model}}=0.25$, $k_{\\mathrm{lin}}=0.20$, $r_{w}=0.6$ $\\mu\\mathrm{m}$.\n- Case $3$ (edge, strong depletion and long-range coupling):\n    - $N=64$, $s=4$, $d_{x}=0.2$ $\\mu\\mathrm{m}$, $R_{0}=5$ $\\mathrm{nm/s}$, $T=10$ $\\mathrm{s}$, $L_{\\mathrm{true}}=3.5$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{true}}=0.85$, $L_{\\mathrm{model}}=3.0$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{model}}=0.70$, $k_{\\mathrm{lin}}=0.60$, $r_{w}=4.0$ $\\mu\\mathrm{m}$.\n- Case $4$ (edge, fine-grained chessboard at pixel scale):\n    - $N=64$, $s=1$, $d_{x}=0.2$ $\\mu\\mathrm{m}$, $R_{0}=5$ $\\mathrm{nm/s}$, $T=10$ $\\mathrm{s}$, $L_{\\mathrm{true}}=1.0$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{true}}=0.40$, $L_{\\mathrm{model}}=1.2$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{model}}=0.35$, $k_{\\mathrm{lin}}=0.30$, $r_{w}=1.2$ $\\mu\\mathrm{m}$.\n- Case $5$ (boundary, no true depletion but model mis-specified):\n    - $N=64$, $s=8$, $d_{x}=0.2$ $\\mu\\mathrm{m}$, $R_{0}=5$ $\\mathrm{nm/s}$, $T=10$ $\\mathrm{s}$, $L_{\\mathrm{true}}=2.0$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{true}}=0.0$, $L_{\\mathrm{model}}=1.8$ $\\mu\\mathrm{m}$, $\\phi_{\\mathrm{model}}=0.30$, $k_{\\mathrm{lin}}=0.50$, $r_{w}=2.0$ $\\mu\\mathrm{m}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with values ordered as $[\\mathrm{MAE}_{\\mathrm{ker}}^{(1)},\\mathrm{MAE}_{\\mathrm{lin}}^{(1)},\\mathrm{MAE}_{\\mathrm{ker}}^{(2)},\\mathrm{MAE}_{\\mathrm{lin}}^{(2)},\\dots,\\mathrm{MAE}_{\\mathrm{ker}}^{(5)},\\mathrm{MAE}_{\\mathrm{lin}}^{(5)}]$, expressed in nanometers ($\\mathrm{nm}$) as floating-point numbers.",
            "solution": "The core of the problem lies in modeling the spatial depletion of a chemical reactant during a plasma etch process. The etch rate $R$ is assumed to be proportional to the local reactant concentration $c(x,y)$ on open (unmasked) features. The pattern of open features is represented by a binary mask $P(x,y)$, where $P(x,y)=1$ for open areas and $P(x,y)=0$ for masked areas.\n\nThe ground truth model is based on a steady-state diffusion-reaction equation, where the spatial distribution of reactant concentration arises from a balance between supply from a baseline concentration $c_{\\infty}$ and consumption at the wafer surface. For a system with periodic boundary conditions and screened diffusion, the effect of distributed consumption can be described by a spatial convolution. The relative concentration is given by:\n$$\n\\frac{c(x,y)}{c_{\\infty}} = \\max\\left(0,\\,1 - \\phi_{\\mathrm{true}}\\;\\left(P * K_{L_{\\mathrm{true}}}\\right)(x,y)\\right)\n$$\nHere, $*$ denotes a $2\\mathrm{D}$ periodic convolution. The kernel $K_{L_{\\mathrm{true}}}$ represents the Green's function for the underlying transport process, which for screened diffusion, decays exponentially with a characteristic length $L_{\\mathrm{true}}$. The term $\\phi_{\\mathrm{true}}$ is a dimensionless constant representing the strength of the depletion. The local etch rate on open features is then $R_{\\mathrm{true}}(x,y) = R_{0}\\,P(x,y)\\,(c(x,y)/c_{\\infty})$, and the final etched depth over a time $T$ is $H_{\\mathrm{true}}(x,y) = R_{\\mathrm{true}}(x,y) \\cdot T$.\n\nThe task requires implementing this ground truth and two predictive models, then evaluating their accuracy using a Mean Absolute Error (MAE) metric. The entire domain is discretized on an $N \\times N$ grid.\n\nThe algorithmic design is broken down into the following steps:\n\n1.  **Pattern Generation**: We first generate the $N \\times N$ binary pattern array, $P$. The problem specifies a chessboard pattern where a pixel at grid coordinates $(i,j)$ is open ($P(i,j)=1$) if $\\lfloor i/s \\rfloor + \\lfloor j/s \\rfloor$ is an even number, where $s$ is the side length of the chessboard squares in pixels.\n\n2.  **Kernel Construction**: Both models and the ground truth rely on convolution kernels. We must construct these kernels on the $N \\times N$ grid, respecting the specified periodic boundary conditions.\n    *   **Distance Calculation**: The exponential kernel $K_L$ is a function of the distance from the origin. For a periodic (toroidal) domain of size $N \\times N$ pixels, the distance between two points must be calculated using the minimum-image convention. The distance of a pixel $(i,j)$ from the origin $(0,0)$ is given by $r(i,j) = \\sqrt{(\\min(i, N-i)\\,d_{x})^{2} + (\\min(j, N-j)\\,d_{x})^{2}}$, where $d_x$ is the physical size of a pixel.\n    *   **Exponential Kernel ($K_L$)**: The unnormalized exponential kernel is constructed as $K_L^{\\text{un}}(i,j) = \\exp(-r(i,j)/L)$. This is done for both $L_{\\mathrm{true}}$ and $L_{\\mathrm{model}}$.\n    *   **Box Kernel ($U_w$)**: The simplified linear model uses a local density a verage, which is a convolution with a normalized box kernel $U_w$. This kernel is defined as $U_w(i,j) = 1$ for pixels within a square window of half-width $w$ (in pixels) around the origin, and $0$ otherwise. Using periodic indices, this translates to $U_w^{\\text{un}}(i,j) = 1$ if $\\min(i, N-i) \\le w$ and $\\min(j, N-j) \\le w$. The parameter $r_w$ is given in micrometers ($\\mu\\mathrm{m}$), which must be converted to the pixel half-width $w$ via $w = \\text{round}(r_w/d_x)$. This interpretation is necessary to reconcile the parameter units with the kernel definition.\n    *   **Normalization**: All kernels must be normalized such that their elements sum to $1$. This ensures that the convolution operation preserves the mean value of the convolved signal if the convolving signal is uniform. For any unnormalized kernel $K^{\\text{un}}$, the normalized kernel is $K = K^{\\text{un}} / \\sum_{i,j} K^{\\text{un}}(i,j)$.\n\n3.  **Convolution and Model Evaluation**: The periodic convolutions are efficiently computed using the Fast Fourier Transform (FFT) by applying the convolution theorem: $\\mathcal{F}\\{A * B\\} = \\mathcal{F}\\{A\\} \\cdot \\mathcal{F}\\{B\\}$, where $\\mathcal{F}$ denotes the Fourier Transform. Thus, $A * B = \\mathcal{F}^{-1}\\{\\mathcal{F}\\{A\\} \\cdot \\mathcal{F}\\{B\\}\\}$. We implement this using `numpy.fft.fft2` and `numpy.fft.ifft2`. The etched depth for each model is then calculated:\n    *   **Ground Truth Depth ($H_{\\mathrm{true}}$)**:\n        $$\n        H_{\\mathrm{true}} = R_0 \\cdot T \\cdot P \\odot \\max\\left(0, 1 - \\phi_{\\mathrm{true}} \\cdot \\mathcal{F}^{-1}\\left\\{\\mathcal{F}\\{P\\} \\odot \\mathcal{F}\\{K_{L_{\\mathrm{true}}}\\}\\right\\}\\right)\n        $$\n    *   **Kernel Model Depth ($H_{\\mathrm{ker}}$)**:\n        $$\n        H_{\\mathrm{ker}} = R_0 \\cdot T \\cdot P \\odot \\max\\left(0, 1 - \\phi_{\\mathrm{model}} \\cdot \\mathcal{F}^{-1}\\left\\{\\mathcal{F}\\{P\\} \\odot \\mathcal{F}\\{K_{L_{\\mathrm{model}}}\\}\\right\\}\\right)\n        $$\n    *   **Linear Model Depth ($H_{\\mathrm{lin}}$)**:\n        $$\n        H_{\\mathrm{lin}} = R_0 \\cdot T \\cdot P \\odot \\max\\left(0, 1 - k_{\\mathrm{lin}} \\cdot \\mathcal{F}^{-1}\\left\\{\\mathcal{F}\\{P\\} \\odot \\mathcal{F}\\{U_w\\}\\right\\}\\right)\n        $$\n    (Here, $\\odot$ denotes element-wise multiplication.)\n\n4.  **Error Calculation**: The accuracy of the two predictive models is quantified by the Mean Absolute Error (MAE) computed only on the open features (where $P(i,j)=1$). Let $M = \\sum_{i,j} P(i,j)$ be the total number of open pixels. The errors are:\n    $$\n    \\mathrm{MAE}_{\\mathrm{ker}} = \\frac{1}{M}\\sum_{P(i,j)=1} \\left|H_{\\mathrm{ker}}(i,j) - H_{\\mathrm{true}}(i,j)\\right|\n    $$\n    $$\n    \\mathrm{MAE}_{\\mathrm{lin}} = \\frac{1}{M}\\sum_{P(i,j)=1} \\left|H_{\\mathrm{lin}}(i,j) - H_{\\mathrm{true}}(i,j)\\right|\n    $$\n    These are implemented by filtering the depth arrays using the boolean mask $P$ and then computing the mean of the absolute differences.\n\nThe final implementation iterates through the provided test cases, performing these four steps for each set of parameters and collecting the resulting MAE values.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares two predictive models for plasma etching loading effects.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (happy path, moderate coupling and slight model mismatch)\n        {'N': 64, 's': 8, 'd_x': 0.2, 'R0': 5, 'T': 10, 'L_true': 2.0, 'phi_true': 0.35, 'L_model': 1.8, 'phi_model': 0.30, 'k_lin': 0.28, 'r_w': 2.5},\n        # Case 2 (boundary, short-range coupling near local behavior)\n        {'N': 64, 's': 8, 'd_x': 0.2, 'R0': 5, 'T': 10, 'L_true': 0.3, 'phi_true': 0.25, 'L_model': 0.5, 'phi_model': 0.25, 'k_lin': 0.20, 'r_w': 0.6},\n        # Case 3 (edge, strong depletion and long-range coupling)\n        {'N': 64, 's': 4, 'd_x': 0.2, 'R0': 5, 'T': 10, 'L_true': 3.5, 'phi_true': 0.85, 'L_model': 3.0, 'phi_model': 0.70, 'k_lin': 0.60, 'r_w': 4.0},\n        # Case 4 (edge, fine-grained chessboard at pixel scale)\n        {'N': 64, 's': 1, 'd_x': 0.2, 'R0': 5, 'T': 10, 'L_true': 1.0, 'phi_true': 0.40, 'L_model': 1.2, 'phi_model': 0.35, 'k_lin': 0.30, 'r_w': 1.2},\n        # Case 5 (boundary, no true depletion but model mis-specified)\n        {'N': 64, 's': 8, 'd_x': 0.2, 'R0': 5, 'T': 10, 'L_true': 2.0, 'phi_true': 0.0, 'L_model': 1.8, 'phi_model': 0.30, 'k_lin': 0.50, 'r_w': 2.0},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        s = case['s']\n        d_x = case['d_x']\n        R0 = case['R0']\n        T = case['T']\n        L_true = case['L_true']\n        phi_true = case['phi_true']\n        L_model = case['L_model']\n        phi_model = case['phi_model']\n        k_lin = case['k_lin']\n        r_w = case['r_w']\n\n        # 1. Generate chessboard pattern P\n        i, j = np.mgrid[0:N, 0:N]\n        P = (np.floor(i / s) + np.floor(j / s)) % 2 == 0\n        P = P.astype(float)\n\n        # 2. Construct kernels\n        # Create periodic distance grid\n        idx = np.arange(N)\n        periodic_idx = np.minimum(idx, N - idx)\n        jj, ii = np.meshgrid(periodic_idx, periodic_idx)\n        r_pixels = np.sqrt(ii**2 + jj**2)\n        r_microns = r_pixels * d_x\n\n        # Exponential Kernels\n        K_true_unnormalized = np.exp(-r_microns / L_true)\n        K_model_unnormalized = np.exp(-r_microns / L_model)\n\n        # Box Kernel. Convert radius in um to half-width in pixels.\n        w_pixels = int(round(r_w / d_x))\n        U_w_unnormalized = np.zeros((N, N))\n        U_w_unnormalized[(ii = w_pixels)  (jj = w_pixels)] = 1.0\n\n        def calculate_depth(pattern, unnormalized_kernel, coefficient):\n            \"\"\"Computes etch depth based on a given kernel and coefficient.\"\"\"\n            # Normalize kernel\n            kernel_sum = np.sum(unnormalized_kernel)\n            if kernel_sum  0:\n                kernel_normalized = unnormalized_kernel / kernel_sum\n            else:\n                kernel_normalized = unnormalized_kernel # Avoids division by zero\n\n            # Periodic convolution via FFT\n            conv_result = np.real(np.fft.ifft2(np.fft.fft2(pattern) * np.fft.fft2(kernel_normalized)))\n\n            # Calculate rate and depth\n            depletion_factor = np.maximum(0, 1 - coefficient * conv_result)\n            rate = R0 * pattern * depletion_factor\n            depth = rate * T\n            return depth\n\n        # 3. Calculate etch depths for all three models\n        H_true = calculate_depth(P, K_true_unnormalized, phi_true)\n        H_ker = calculate_depth(P, K_model_unnormalized, phi_model)\n        H_lin = calculate_depth(P, U_w_unnormalized, k_lin)\n        \n        # 4. Calculate Mean Absolute Error (MAE) on open features\n        open_pixels_mask = (P == 1)\n        num_open_pixels = np.sum(open_pixels_mask)\n\n        if num_open_pixels == 0:\n            mae_ker = 0.0\n            mae_lin = 0.0\n        else:\n            mae_ker = np.sum(np.abs(H_ker[open_pixels_mask] - H_true[open_pixels_mask])) / num_open_pixels\n            mae_lin = np.sum(np.abs(H_lin[open_pixels_mask] - H_true[open_pixels_mask])) / num_open_pixels\n\n        results.extend([mae_ker, mae_lin])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}