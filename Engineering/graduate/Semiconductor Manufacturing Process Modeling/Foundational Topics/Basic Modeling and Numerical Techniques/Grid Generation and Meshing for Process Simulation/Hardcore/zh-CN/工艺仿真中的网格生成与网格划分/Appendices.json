{
    "hands_on_practices": [
        {
            "introduction": "在半导体工艺仿真中，精确表示器件的弯曲几何结构（例如氧化物层的圆角）至关重要。等参映射是一种强大的技术，它能将简单的参数域（如正方形）转换为物理世界中复杂的几何形状（如四分之一环）。本练习将引导你从第一性原理出发，推导一个用于描述圆角几何的映射，并计算其雅可比行列式 $J$，这是验证网格单元有效性的关键指标。",
            "id": "4129464",
            "problem": "一个曲线四边形网格单元将被放置在一个硅栅周围的热生长二氧化硅（氧化物）层的拐角处，该氧化物层形成一个四分之一圆弧的弯曲。为了在半导体制造过程建模（例如，掺杂剂扩散和氧化动力学）的数值积分过程中保持通量守恒，映射雅可比行列式在单元内所有高斯积分点处必须保持严格为正。\n\n将物理域视为一个由四条曲线界定的四分之一环形扇区：半径为 $R$ 的内圆弧（代表氧化物-硅界面）、半径为 $R+\\Delta R$ 的外圆弧（代表氧化物外边界），以及位于角度 $0$ 和 $\\pi/2$ 弧度的两条径向线。构建一个p阶曲线等参四边形单元，它将 $(\\xi,\\eta)$ 中的正方形参数域 $[-1,1]\\times[-1,1]$ 映射到这个物理扇区，使用的公式应与以下边界关联和光滑性原则一致：\n- 边 $\\eta=-1$ 和 $\\eta=1$ 分别映射到内圆弧和外圆弧。\n- 边 $\\xi=1$ 和 $\\xi=-1$ 分别映射到角度为 $0$ 和 $\\pi/2$ 的径向线。\n- 在整个单元中，半径随 $\\eta$ 单调变化，极角随 $\\xi$ 单调变化。\n\n从二维等参映射的基本定义、平面中扇区的极坐标表示以及坐标变换的雅可比行列式定义出发。推导一个光滑映射 $(x(\\xi,\\eta),y(\\xi,\\eta))$，该映射基于 $\\eta$ 的线性半径规律和 $\\xi$ 的线性角度规律构建，并精确满足四个边界关联。然后，计算雅可比行列式 $J(\\xi,\\eta)=\\det\\left(\\partial(x,y)/\\partial(\\xi,\\eta)\\right)$，作为 $(\\xi,\\eta)$、$R$ 和 $\\Delta R$ 的函数，并分析验证其在用于双线性/二次四边形积分的二乘二 Gauss–Legendre 点 $(\\xi,\\eta)\\in\\{\\pm 1/\\sqrt{3}\\}\\times\\{\\pm 1/\\sqrt{3}\\}$ 处是严格为正的。角度必须以弧度处理。\n\n作为最终答案，提供此映射的雅可比行列式 $J(\\xi,\\eta)$ 的单一闭式解析表达式。不要代入数值。以 $\\mathrm{m}^2$ 为单位表示雅可比行列式。",
            "solution": "该问题要求推导一个特定坐标变换的雅可比行列式，该变换用于将方形参数域映射到形状为四分之一环形的物理域。所得网格单元的有效性取决于雅可比行列式是否严格为正。\n\n首先，我们必须建立从参数坐标 $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ 到物理坐标 $(x,y)$ 的映射。问题指明，这是通过首先定义一个到极坐标 $(r, \\theta)$ 的映射来实现的，其中半径 $r$ 是 $\\eta$ 的线性函数，角度 $\\theta$ 是 $\\xi$ 的线性函数。\n\n设半径为 $r(\\eta) = a\\eta + b$。边界条件为：\n1.  当 $\\eta = -1$ 时，半径为内半径，即 $r(-1) = R$。\n2.  当 $\\eta = 1$ 时，半径为外半径，即 $r(1) = R + \\Delta R$。\n\n将这些条件代入线性形式，得到一个二元方程组：\n$$\n\\begin{cases}\n-a + b = R \\\\\na + b = R + \\Delta R\n\\end{cases}\n$$\n两方程相加得到 $2b = 2R + \\Delta R$，因此 $b = R + \\frac{\\Delta R}{2}$。\n第二个方程减去第一个方程得到 $2a = \\Delta R$，因此 $a = \\frac{\\Delta R}{2}$。\n于是，径向映射为：\n$$\nr(\\eta) = \\frac{\\Delta R}{2}\\eta + R + \\frac{\\Delta R}{2} = R + \\frac{\\Delta R}{2}(1+\\eta)\n$$\n\n接下来，设角度为 $\\theta(\\xi) = c\\xi + d$。边界条件为：\n1.  当 $\\xi = 1$ 时，角度为 $\\theta(1) = 0$。\n2.  当 $\\xi = -1$ 时，角度为 $\\theta(-1) = \\frac{\\pi}{2}$。\n\n将这些条件代入线性形式，得到：\n$$\n\\begin{cases}\nc + d = 0 \\\\\n-c + d = \\frac{\\pi}{2}\n\\end{cases}\n$$\n两方程相加得到 $2d = \\frac{\\pi}{2}$，因此 $d = \\frac{\\pi}{4}$。\n由于 $c+d=0$，我们有 $c = -d = -\\frac{\\pi}{4}$。\n于是，角度映射为：\n$$\n\\theta(\\xi) = -\\frac{\\pi}{4}\\xi + \\frac{\\pi}{4} = \\frac{\\pi}{4}(1-\\xi)\n$$\n这一选择确保了雅可比行列式为正，符合要求。如果 $\\xi$ 的方向相反，则会导致雅可比行列式为负，对应于一个翻转的单元，这在物理上和数值上都是无效的。\n\n从极坐标 $(r, \\theta)$ 到笛卡尔坐标 $(x, y)$ 的变换由标准关系式给出：\n$$\nx = r \\cos(\\theta) \\quad \\text{和} \\quad y = r \\sin(\\theta)\n$$\n代入我们得到的 $r(\\eta)$ 和 $\\theta(\\xi)$ 表达式，我们获得从 $(\\xi, \\eta)$ 到 $(x, y)$ 的完整映射：\n$$\nx(\\xi, \\eta) = \\left( R + \\frac{\\Delta R}{2}(1+\\eta) \\right) \\cos\\left( \\frac{\\pi}{4}(1-\\xi) \\right)\n$$\n$$\ny(\\xi, \\eta) = \\left( R + \\frac{\\Delta R}{2}(1+\\eta) \\right) \\sin\\left( \\frac{\\pi}{4}(1-\\xi) \\right)\n$$\n\n雅可比行列式为 $J(\\xi, \\eta) = \\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$。雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\ \\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta} \\end{pmatrix}\n$$\n我们使用链式法则计算偏导数。设 $r=r(\\eta)$ 和 $\\theta=\\theta(\\xi)$。\n$\\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi}(r \\cos\\theta) = -r \\sin\\theta \\frac{d\\theta}{d\\xi} = -r(\\eta) \\sin(\\theta(\\xi)) \\left(-\\frac{\\pi}{4}\\right) = \\frac{\\pi}{4}r(\\eta)\\sin(\\theta(\\xi))$\n$\\frac{\\partial x}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta}(r \\cos\\theta) = \\cos\\theta \\frac{dr}{d\\eta} = \\cos(\\theta(\\xi)) \\left(\\frac{\\Delta R}{2}\\right) = \\frac{\\Delta R}{2}\\cos(\\theta(\\xi))$\n$\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi}(r \\sin\\theta) = r \\cos\\theta \\frac{d\\theta}{d\\xi} = r(\\eta) \\cos(\\theta(\\xi)) \\left(-\\frac{\\pi}{4}\\right) = -\\frac{\\pi}{4}r(\\eta)\\cos(\\theta(\\xi))$\n$\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta}(r \\sin\\theta) = \\sin\\theta \\frac{dr}{d\\eta} = \\sin(\\theta(\\xi)) \\left(\\frac{\\Delta R}{2}\\right) = \\frac{\\Delta R}{2}\\sin(\\theta(\\xi))$\n\n雅可比矩阵为：\n$$\n\\mathbf{J} = \\begin{pmatrix} \\frac{\\pi}{4}r(\\eta)\\sin(\\theta(\\xi))  \\frac{\\Delta R}{2}\\cos(\\theta(\\xi)) \\\\ -\\frac{\\pi}{4}r(\\eta)\\cos(\\theta(\\xi))  \\frac{\\Delta R}{2}\\sin(\\theta(\\xi)) \\end{pmatrix}\n$$\n行列式为：\n$$\nJ(\\xi, \\eta) = \\left( \\frac{\\pi}{4}r(\\eta)\\sin(\\theta(\\xi)) \\right) \\left( \\frac{\\Delta R}{2}\\sin(\\theta(\\xi)) \\right) - \\left( \\frac{\\Delta R}{2}\\cos(\\theta(\\xi)) \\right) \\left( -\\frac{\\pi}{4}r(\\eta)\\cos(\\theta(\\xi)) \\right)\n$$\n$$\nJ(\\xi, \\eta) = \\frac{\\pi \\Delta R}{8} r(\\eta) \\sin^2(\\theta(\\xi)) + \\frac{\\pi \\Delta R}{8} r(\\eta) \\cos^2(\\theta(\\xi))\n$$\n提出公因子并使用三角恒等式 $\\sin^2\\alpha + \\cos^2\\alpha = 1$：\n$$\nJ(\\xi, \\eta) = \\frac{\\pi \\Delta R}{8} r(\\eta) (\\sin^2(\\theta(\\xi)) + \\cos^2(\\theta(\\xi))) = \\frac{\\pi \\Delta R}{8} r(\\eta)\n$$\n代入 $r(\\eta)$ 的表达式：\n$$\nJ(\\xi, \\eta) = \\frac{\\pi \\Delta R}{8} \\left( R + \\frac{\\Delta R}{2}(1+\\eta) \\right)\n$$\n这就是雅可比行列式的最终表达式。注意它与 $\\xi$ 无关。\n\n为验证雅可比行列式严格为正，我们分析其符号。物理参数 $R$（半径）和 $\\Delta R$（径向厚度）必须为正，所以 $R  0$ 且 $\\Delta R  0$。常数 $\\pi$ 也为正。因此，前置因子 $\\frac{\\pi \\Delta R}{8}$ 严格为正。\n$J$ 的符号由 $R + \\frac{\\Delta R}{2}(1+\\eta)$ 这一项决定。\n参数坐标 $\\eta$ 位于区间 $[-1, 1]$ 内。因此，$(1+\\eta)$ 项的范围是 $[0, 2]$。\n在下界 $\\eta = -1$ 处，该项为 $R + \\frac{\\Delta R}{2}(0) = R  0$。\n在上界 $\\eta = 1$ 处，该项为 $R + \\frac{\\Delta R}{2}(2) = R + \\Delta R  0$。\n由于该项是 $\\eta$ 的线性函数，并且在区间的两个端点都为正，因此对于所有 $\\eta \\in (-1, 1]$ 都是严格为正的，在 $\\eta = -1$ 处为非负。这对于单元内的任何点都成立，包括 Gauss-Legendre 点，其中 $\\eta = \\pm 1/\\sqrt{3}$。\n因此，对于参数域内部的所有点，$J(\\xi, \\eta)  0$，满足有效单元映射的条件。\n雅可比行列式的量纲单位是（$\\Delta R$ 的单位）$\\times$（$R$ 的单位），即长度的平方。考虑到在标准单位制中，$R$ 和 $\\Delta R$ 将以米为单位测量，雅可比行列式 $J$ 的单位为 $\\mathrm{m}^2$，这与微分面积元的预期一致。",
            "answer": "$$\n\\boxed{\\frac{\\pi \\Delta R}{8} \\left( R + \\frac{\\Delta R}{2}(1+\\eta) \\right)}\n$$"
        },
        {
            "introduction": "虽然简单的线性映射很有用，但在仿真复杂的扩散前沿等场景时，通常需要高阶单元来获得更高的精度。本练习将深入探讨二次（二阶）三角形单元的内部工作原理。你的任务是在特定数值积分点（高斯点）上计算雅可比行列式 $J$，这是验证单元没有发生过度扭曲、保证有限元仿真稳定性的一个关键步骤。",
            "id": "4129456",
            "problem": "在一个用于有限元法（FEM）的半导体工艺模拟网格中，使用一个二阶等参三角形单元来解析一个弯曲的扩散前沿。参考单元坐标用标准单位三角形上的 $r$ 和 $s$ 表示，其顶点位于 $(r,s)=(1,0)$、$(0,1)$ 和 $(0,0)$。该三角形的二次拉格朗日形函数在重心坐标 $L_1=r$、$L_2=s$、$L_3=1-r-s$ 上定义为\n$$\nN_1=L_1(2L_1-1),\\quad N_2=L_2(2L_2-1),\\quad N_3=L_3(2L_3-1),\\quad N_4=4L_1L_2,\\quad N_5=4L_2L_3,\\quad N_6=4L_3L_1.\n$$\n物理坐标 $(x,y)$ 通过以下方式进行等参映射\n$$\nx(r,s)=\\sum_{i=1}^{6}N_i(r,s)\\,x_i,\n$$\n$$\ny(r,s)=\\sum_{i=1}^{6}N_i(r,s)\\,y_i,\n$$\n其物理空间中的节点位置按对应于 $N_1$ 到 $N_6$ 的常规顺序列出如下：\n$$\n(x_1,y_1)=(0,0),\\quad (x_2,y_2)=(4,0),\\quad (x_3,y_3)=(0,3),\\quad (x_4,y_4)=(2,0.2),\\quad (x_5,y_5)=(1.8,1.7),\\quad (x_6,y_6)=(0.1,1.6).\n$$\n这些坐标定义了一个主要沿着节点 $2$ 和 $3$ 之间边缘的弯曲边界，这是光刻和蚀刻工艺中引入的圆角特征的典型表现。为了在单元上进行数值积分，考虑参考三角形上的三点高斯求积法则，其积分点为\n$(r,s)\\in\\left\\{\\left(\\frac{1}{6},\\frac{1}{6}\\right),\\left(\\frac{2}{3},\\frac{1}{6}\\right),\\left(\\frac{1}{6},\\frac{2}{3}\\right)\\right\\}$。\n从等参映射的基本原理和变换的雅可比行列式定义出发，计算雅可比行列式\n$J(r,s)=\\det\\left(\\frac{\\partial(x,y)}{\\partial(r,s)}\\right)=\\frac{\\partial x}{\\partial r}\\frac{\\partial y}{\\partial s}-\\frac{\\partial x}{\\partial s}\\frac{\\partial y}{\\partial r}$\n在每个给定积分点的值，并验证为避免在稳定的有限元组集中出现翻转或退化单元所需满足的正定性约束。报告在所列积分点中 $J$ 的最小值。将最终答案四舍五入到五位有效数字。不需要物理单位。",
            "solution": "二次三角形单元的等参映射是基于重心坐标上的二次拉格朗日基函数构建的，它通过边中节点的布置确保了弯曲边界的几何协调性。雅可比行列式 $J(r,s)$ 衡量了映射的局部面积缩放比例，并且在积分域上必须保持严格为正，以保持定向并避免在有限元法（FEM）组集过程中的数值不稳定性。\n\n我们首先用形函数来表示该映射：\n$$\nx(r,s)=\\sum_{i=1}^{6}N_i(r,s)\\,x_i,\\qquad y(r,s)=\\sum_{i=1}^{6}N_i(r,s)\\,y_i,\n$$\n并计算雅可比矩阵的各项\n$$\nx_r(r,s)=\\sum_{i=1}^{6}\\frac{\\partial N_i}{\\partial r}(r,s)\\,x_i,\\quad x_s(r,s)=\\sum_{i=1}^{6}\\frac{\\partial N_i}{\\partial s}(r,s)\\,x_i,\n$$\n$$\ny_r(r,s)=\\sum_{i=1}^{6}\\frac{\\partial N_i}{\\partial r}(r,s)\\,y_i,\\quad y_s(r,s)=\\sum_{i=1}^{6}\\frac{\\partial N_i}{\\partial s}(r,s)\\,y_i.\n$$\n当 $L_1=r$、$L_2=s$ 且 $L_3=1-r-s$ 时，二次形函数为\n$$\nN_1=r(2r-1),\\quad N_2=s(2s-1),\\quad N_3=L_3(2L_3-1),\\quad N_4=4rs,\\quad N_5=4sL_3,\\quad N_6=4L_3r.\n$$\n它们的偏导数可以通过直接求导以及恒等式 $\\frac{\\partial L_3}{\\partial r}=-1$ 和 $\\frac{\\partial L_3}{\\partial s}=-1$ 得出：\n$$\n\\frac{\\partial N_1}{\\partial r}=4r-1,\\quad \\frac{\\partial N_1}{\\partial s}=0,\\qquad \\frac{\\partial N_2}{\\partial r}=0,\\quad \\frac{\\partial N_2}{\\partial s}=4s-1,\n$$\n$$\n\\frac{\\partial N_3}{\\partial r}=(4L_3-1)\\frac{\\partial L_3}{\\partial r}=-4L_3+1,\\quad \\frac{\\partial N_3}{\\partial s}=-4L_3+1,\n$$\n$$\n\\frac{\\partial N_4}{\\partial r}=4s,\\quad \\frac{\\partial N_4}{\\partial s}=4r,\n$$\n$$\n\\frac{\\partial N_5}{\\partial r}=4s\\,\\frac{\\partial L_3}{\\partial r}=-4s,\\quad \\frac{\\partial N_5}{\\partial s}=4\\left(L_3+s\\,\\frac{\\partial L_3}{\\partial s}\\right)=4(1-r-2s),\n$$\n$$\n\\frac{\\partial N_6}{\\partial r}=4\\left(L_3+r\\,\\frac{\\partial L_3}{\\partial r}\\right)=4(1-2r-s),\\quad \\frac{\\partial N_6}{\\partial s}=4r\\,\\frac{\\partial L_3}{\\partial s}=-4r.\n$$\n我们在三个高斯求积点上分别计算这些表达式的值。\n\n点1：$(r,s)=\\left(\\frac{1}{6},\\frac{1}{6}\\right)$，此时 $L_3=\\frac{2}{3}$。导数为\n$$\n\\frac{\\partial N_1}{\\partial r}=-\\frac{1}{3},\\quad \\frac{\\partial N_1}{\\partial s}=0,\\quad \\frac{\\partial N_2}{\\partial r}=0,\\quad \\frac{\\partial N_2}{\\partial s}=-\\frac{1}{3},\n$$\n$$\n\\frac{\\partial N_3}{\\partial r}=-\\frac{5}{3},\\quad \\frac{\\partial N_3}{\\partial s}=-\\frac{5}{3},\\quad \\frac{\\partial N_4}{\\partial r}=\\frac{2}{3},\\quad \\frac{\\partial N_4}{\\partial s}=\\frac{2}{3},\n$$\n$$\n\\frac{\\partial N_5}{\\partial r}=-\\frac{2}{3},\\quad \\frac{\\partial N_5}{\\partial s}=2,\\quad \\frac{\\partial N_6}{\\partial r}=2,\\quad \\frac{\\partial N_6}{\\partial s}=-\\frac{2}{3}.\n$$\n使用节点坐标\n$$\n(x_1,y_1)=(0,0),\\ (x_2,y_2)=(4,0),\\ (x_3,y_3)=(0,3),\\ (x_4,y_4)=(2,0.2),\\ (x_5,y_5)=(1.8,1.7),\\ (x_6,y_6)=(0.1,1.6),\n$$\n我们得到\n$$\nx_r=\\left(-\\frac{1}{3}\\right)\\cdot 0+0\\cdot 4+\\left(-\\frac{5}{3}\\right)\\cdot 0+\\left(\\frac{2}{3}\\right)\\cdot 2+\\left(-\\frac{2}{3}\\right)\\cdot 1.8+2\\cdot 0.1=\\frac{1}{3},\n$$\n$$\nx_s=0\\cdot 0+\\left(-\\frac{1}{3}\\right)\\cdot 4+\\left(-\\frac{5}{3}\\right)\\cdot 0+\\left(\\frac{2}{3}\\right)\\cdot 2+2\\cdot 1.8+\\left(-\\frac{2}{3}\\right)\\cdot 0.1=\\frac{53}{15},\n$$\n$$\ny_r=\\left(-\\frac{1}{3}\\right)\\cdot 0+0\\cdot 0+\\left(-\\frac{5}{3}\\right)\\cdot 3+\\left(\\frac{2}{3}\\right)\\cdot 0.2+\\left(-\\frac{2}{3}\\right)\\cdot 1.7+2\\cdot 1.6=-\\frac{14}{5},\n$$\n$$\ny_s=0\\cdot 0+\\left(-\\frac{1}{3}\\right)\\cdot 0+\\left(-\\frac{5}{3}\\right)\\cdot 3+\\left(\\frac{2}{3}\\right)\\cdot 0.2+2\\cdot 1.7+\\left(-\\frac{2}{3}\\right)\\cdot 1.6=-\\frac{38}{15}.\n$$\n因此，\n$$\nJ_1=x_r\\,y_s-x_s\\,y_r=\\left(\\frac{1}{3}\\right)\\left(-\\frac{38}{15}\\right)-\\left(\\frac{53}{15}\\right)\\left(-\\frac{14}{5}\\right)=-\\frac{38}{45}+\\frac{742}{75}=\\frac{2036}{225}\\approx 9.0488889.\n$$\n\n点2：$(r,s)=\\left(\\frac{2}{3},\\frac{1}{6}\\right)$，此时 $L_3=\\frac{1}{6}$。导数为\n$$\n\\frac{\\partial N_1}{\\partial r}=\\frac{5}{3},\\quad \\frac{\\partial N_1}{\\partial s}=0,\\quad \\frac{\\partial N_2}{\\partial r}=0,\\quad \\frac{\\partial N_2}{\\partial s}=-\\frac{1}{3},\n$$\n$$\n\\frac{\\partial N_3}{\\partial r}=\\frac{1}{3},\\quad \\frac{\\partial N_3}{\\partial s}=\\frac{1}{3},\\quad \\frac{\\partial N_4}{\\partial r}=\\frac{2}{3},\\quad \\frac{\\partial N_4}{\\partial s}=\\frac{8}{3},\n$$\n$$\n\\frac{\\partial N_5}{\\partial r}=-\\frac{2}{3},\\quad \\frac{\\partial N_5}{\\partial s}=0,\\quad \\frac{\\partial N_6}{\\partial r}=-2,\\quad \\frac{\\partial N_6}{\\partial s}=-\\frac{8}{3}.\n$$\n计算可得\n$$\nx_r=\\left(\\frac{5}{3}\\right)\\cdot 0+0\\cdot 4+\\left(\\frac{1}{3}\\right)\\cdot 0+\\left(\\frac{2}{3}\\right)\\cdot 2+\\left(-\\frac{2}{3}\\right)\\cdot 1.8+(-2)\\cdot 0.1=-\\frac{1}{15},\n$$\n$$\nx_s=0\\cdot 0+\\left(-\\frac{1}{3}\\right)\\cdot 4+\\left(\\frac{1}{3}\\right)\\cdot 0+\\left(\\frac{8}{3}\\right)\\cdot 2+0\\cdot 1.8+\\left(-\\frac{8}{3}\\right)\\cdot 0.1=\\frac{56}{15},\n$$\n$$\ny_r=\\left(\\frac{5}{3}\\right)\\cdot 0+0\\cdot 0+\\left(\\frac{1}{3}\\right)\\cdot 3+\\left(\\frac{2}{3}\\right)\\cdot 0.2+\\left(-\\frac{2}{3}\\right)\\cdot 1.7+(-2)\\cdot 1.6=-\\frac{16}{5},\n$$\n$$\ny_s=0\\cdot 0+\\left(-\\frac{1}{3}\\right)\\cdot 0+\\left(\\frac{1}{3}\\right)\\cdot 3+\\left(\\frac{8}{3}\\right)\\cdot 0.2+0\\cdot 1.7+\\left(-\\frac{8}{3}\\right)\\cdot 1.6=-\\frac{41}{15}.\n$$\n因此，\n$$\nJ_2=x_r\\,y_s-x_s\\,y_r=\\left(-\\frac{1}{15}\\right)\\left(-\\frac{41}{15}\\right)-\\left(\\frac{56}{15}\\right)\\left(-\\frac{16}{5}\\right)=\\frac{41}{225}+\\frac{896}{75}=\\frac{2729}{225}\\approx 12.1288889.\n$$\n\n点3：$(r,s)=\\left(\\frac{1}{6},\\frac{2}{3}\\right)$，此时 $L_3=\\frac{1}{6}$。导数为\n$$\n\\frac{\\partial N_1}{\\partial r}=-\\frac{1}{3},\\quad \\frac{\\partial N_1}{\\partial s}=0,\\quad \\frac{\\partial N_2}{\\partial r}=0,\\quad \\frac{\\partial N_2}{\\partial s}=\\frac{5}{3},\n$$\n$$\n\\frac{\\partial N_3}{\\partial r}=\\frac{1}{3},\\quad \\frac{\\partial N_3}{\\partial s}=\\frac{1}{3},\\quad \\frac{\\partial N_4}{\\partial r}=\\frac{8}{3},\\quad \\frac{\\partial N_4}{\\partial s}=\\frac{2}{3},\n$$\n$$\n\\frac{\\partial N_5}{\\partial r}=-\\frac{8}{3},\\quad \\frac{\\partial N_5}{\\partial s}=-2,\\quad \\frac{\\partial N_6}{\\partial r}=0,\\quad \\frac{\\partial N_6}{\\partial s}=-\\frac{2}{3}.\n$$\n计算可得\n$$\nx_r=\\left(-\\frac{1}{3}\\right)\\cdot 0+0\\cdot 4+\\left(\\frac{1}{3}\\right)\\cdot 0+\\left(\\frac{8}{3}\\right)\\cdot 2+\\left(-\\frac{8}{3}\\right)\\cdot 1.8+0\\cdot 0.1=\\frac{8}{15},\n$$\n$$\nx_s=0\\cdot 0+\\left(\\frac{5}{3}\\right)\\cdot 4+\\left(\\frac{1}{3}\\right)\\cdot 0+\\left(\\frac{2}{3}\\right)\\cdot 2+(-2)\\cdot 1.8+\\left(-\\frac{2}{3}\\right)\\cdot 0.1=\\frac{13}{3},\n$$\n$$\ny_r=\\left(-\\frac{1}{3}\\right)\\cdot 0+0\\cdot 0+\\left(\\frac{1}{3}\\right)\\cdot 3+\\left(\\frac{8}{3}\\right)\\cdot 0.2+\\left(-\\frac{8}{3}\\right)\\cdot 1.7+0\\cdot 1.6=-3,\n$$\n$$\ny_s=0\\cdot 0+\\left(\\frac{5}{3}\\right)\\cdot 0+\\left(\\frac{1}{3}\\right)\\cdot 3+\\left(\\frac{2}{3}\\right)\\cdot 0.2+(-2)\\cdot 1.7+\\left(-\\frac{2}{3}\\right)\\cdot 1.6=-\\frac{10}{3}.\n$$\n于是，\n$$\nJ_3=x_r\\,y_s-x_s\\,y_r=\\left(\\frac{8}{15}\\right)\\left(-\\frac{10}{3}\\right)-\\left(\\frac{13}{3}\\right)(-3)=-\\frac{16}{9}+13=\\frac{101}{9}\\approx 11.2222222.\n$$\n\n所有三个雅可比行列式均为严格正值：\n$$\nJ_1=\\frac{2036}{225}\\approx 9.0488889,\\quad J_2=\\frac{2729}{225}\\approx 12.1288889,\\quad J_3=\\frac{101}{9}\\approx 11.2222222,\n$$\n这满足了在稳定的有限元组集中避免单元翻转或退化所需的正定性约束。这些值中的最小值为\n$$\n\\min\\{J_1,J_2,J_3\\}=\\frac{2036}{225}\\approx 9.0488889.\n$$\n四舍五入到五位有效数字，最小雅可比行列式为 $9.0489$。",
            "answer": "$$\\boxed{9.0489}$$"
        },
        {
            "introduction": "从二维单元生成过渡到三维网格质量的挑战，我们将关注一种常见且棘手的问题：“薄片”四面体。这些质量极差的单元会严重影响仿真的准确性，修复它们并非简单地移动顶点，因为我们必须尊重器件结构中预设的边界。本练习是一个实用的算法设计挑战，你将学习如何在改善薄片单元形状的同时，遵守约束德劳内三角剖分（CDT）的规则，这是现代网格生成中的一项标准算法。",
            "id": "4129496",
            "problem": "给定一个表示多层半导体堆叠的三维约束Delaunay四面体网格。约束Delaunay三角剖分 (CDT) 保证了指定的边界段在三角剖分中作为边存在。如果一个点位于一个线段的直径球内部，则称该线段被此点侵占。直径球的定义是：以线段中点为球心，以线段长度的一半为半径的球体。在基于CDT的边界段恢复算法中，导致侵占的顶点运动会使恢复过程失效；因此，任何顶点重定位都必须避免进入任何约束边界段的直径球。\n\n如果一个四面体因其顶点几乎共面而导致质量较差，则被视为一个裂片（sliver），其典型特征是相对于某个对立面的高非常小，以及外接球半径与最短边长之比较大。为改善网格质量，我们考虑通过增加最差关联四面体中顶点相对于其对立面的高来进行顶点重定位，以消除裂片。\n\n从第一性原理出发：\n\n- 约束Delaunay三角剖分 (CDT) 强制指定的线段在三角剖分中保持为边。一条边 $(\\mathbf{a},\\mathbf{b})$ 的直径球由球心 $\\mathbf{c} = (\\mathbf{a} + \\mathbf{b})/2$ 和半径 $r = \\|\\mathbf{a} - \\mathbf{b}\\|/2$ 定义。如果一个点 $\\mathbf{x}$ 满足 $\\|\\mathbf{x} - \\mathbf{c}\\|  r$，则该点侵占了此线段。\n- 四面体顶点 $\\mathbf{x}$ 相对于其由顶点 $\\mathbf{p}_1,\\mathbf{p}_2,\\mathbf{p}_3$ 构成的对立面的高，是指 $\\mathbf{x}$ 到该对立面所在平面的垂直距离。如果 $\\mathbf{n}$ 是该平面的单位法向量且指向 $\\mathbf{x}$，则高为 $h = |\\mathbf{n} \\cdot (\\mathbf{x} - \\mathbf{p}_1)|$。\n- 具有顶点 $(\\mathbf{x},\\mathbf{p}_1,\\mathbf{p}_2,\\mathbf{p}_3)$ 的四面体的有向体积为 $s = \\frac{1}{6}\\det\\left[\\mathbf{p}_1-\\mathbf{x},\\ \\mathbf{p}_2-\\mathbf{x},\\ \\mathbf{p}_3-\\mathbf{x}\\right]$。当将 $\\mathbf{x}$ 沿方向 $\\mathbf{d}$ 移动到 $\\mathbf{x}(t) = \\mathbf{x} + t\\mathbf{d}$ 时，有向体积呈线性变化 $s(t) = s(0) - t S_1$，其中 $$S_1 = \\frac{1}{6}\\left(\\det[\\mathbf{d},\\ \\mathbf{p}_2-\\mathbf{x},\\ \\mathbf{p}_3-\\mathbf{x}] + \\det[\\mathbf{p}_1-\\mathbf{x},\\ \\mathbf{d},\\ \\mathbf{p}_3-\\mathbf{x}] + \\det[\\mathbf{p}_1-\\mathbf{x},\\ \\mathbf{p}_2-\\mathbf{x},\\ \\mathbf{d}]\\right)$$ 为了保持局部网格方向，我们要求 $s(t)$ 不得穿过零。\n\n设计一个算法，该算法：\n1. 使用最小高准则，识别一个顶点 $\\mathbf{x}$ 的最差关联裂片四面体。\n2. 选择重定位方向 $\\mathbf{d}$ 为该对立面的单位法向量，其朝向为增加高的方向。\n3. 计算沿方向 $\\mathbf{d}$ 的最大允许正位移 $t_{\\mathrm{enc}}$，使得对于每个约束段 $(\\mathbf{a},\\mathbf{b})$，重定位后的点 $\\mathbf{x}(t)$ 保持在直径球之外。对于每个线段，约束条件为 $\\|\\mathbf{x}(t) - \\mathbf{c}\\|^2 \\ge r^2$，其中 $\\mathbf{c} = \\frac{\\mathbf{a}+\\mathbf{b}}{2}$，$r = \\frac{\\|\\mathbf{a}-\\mathbf{b}\\|}{2}$。将 $\\mathbf{x}(t) = \\mathbf{x} + t\\mathbf{d}$ 代入，得到关于 $t$ 的二次不等式：$\\alpha t^2 + \\beta t + \\gamma \\ge 0,$ 其中 $\\alpha = \\|\\mathbf{d}\\|^2$，$\\beta = 2\\mathbf{d}\\cdot(\\mathbf{x}-\\mathbf{c})$，以及 $\\gamma = \\|\\mathbf{x}-\\mathbf{c}\\|^2 - r^2$。如果 $\\gamma  0$，则该线段已被侵占，不允许任何移动；如果 $\\gamma \\ge 0$，则在所有线段中，方程 $\\alpha t^2 + \\beta t + \\gamma = 0$ 的最小正根即为 $t_{\\mathrm{enc}}$；如果对于任何线段都没有正根，则报告该位移不受边界段恢复的约束。\n4. 为保证算法完整性，从有向体积的线性演化中计算局部方向保持界限 $t_{\\mathrm{vol}}$（最终报告中不使用 $t_{\\mathrm{vol}}$；这是算法设计中为避免单元反转而设置的步骤）。\n5. 仅报告 $t_{\\mathrm{enc}}$。\n\n您必须实现一个程序，对于每个测试用例，确定上述定义的 $t_{\\mathrm{enc}}$（单位为米）。如果当前位置 $\\mathbf{x}$ 已经侵占了至少一个线段的直径球，则返回 $0$。如果没有约束段产生正向相交（即沿 $\\mathbf{d}$ 的重定位永远不会进入任何直径球），则返回 $-1$ 以表明该位移不受边界段恢复的约束。\n\n输出中不使用角度。所有距离必须以米为单位表示。\n\n测试套件：\n- 案例1（正常情况）：$\\mathbf{x} = (0,0,0)$；对立面顶点 $\\mathbf{p}_1 = (20\\times 10^{-9}, 0, 0)$，$\\mathbf{p}_2 = (0, 30\\times 10^{-9}, 0)$，$\\mathbf{p}_3 = (0, 0, 0.5\\times 10^{-9})$。约束段：$(\\mathbf{a}_1,\\mathbf{b}_1) = ((50\\times 10^{-9}, 50\\times 10^{-9}, 0), (50\\times 10^{-9}, 50\\times 10^{-9}, 20\\times 10^{-9}))$，$(\\mathbf{a}_2,\\mathbf{b}_2) = ((12\\times 10^{-9}, -12\\times 10^{-9}, 5\\times 10^{-9}), (12\\times 10^{-9}, -12\\times 10^{-9}, 25\\times 10^{-9}))$。\n- 案例2（直径球上的边界条件）：$\\mathbf{x} = (0,0,0)$；对立面顶点 $\\mathbf{p}_1 = (18\\times 10^{-9}, 0, 0)$，$\\mathbf{p}_2 = (0, 18\\times 10^{-9}, 0)$，$\\mathbf{p}_3 = (0, 0, 0.1\\times 10^{-9})$。约束段：$(\\mathbf{a}_1,\\mathbf{b}_1) = ((0, 10\\times 10^{-9}, 0), (0, 10\\times 10^{-9}, 20\\times 10^{-9}))$，$(\\mathbf{a}_2,\\mathbf{b}_2) = ((-30\\times 10^{-9}, -30\\times 10^{-9}, 0), (-30\\times 10^{-9}, -30\\times 10^{-9}, 40\\times 10^{-9}))$。\n- 案例3（永不侵占的边缘情况）：$\\mathbf{x} = (0,0,0)$；对立面顶点 $\\mathbf{p}_1 = (25\\times 10^{-9}, 0, 0)$，$\\mathbf{p}_2 = (0, 25\\times 10^{-9}, 0)$，$\\mathbf{p}_3 = (0, 0, 1\\times 10^{-9})$。约束段：$(\\mathbf{a}_1,\\mathbf{b}_1) = ((200\\times 10^{-9}, 200\\times 10^{-9}, 200\\times 10^{-9}), (220\\times 10^{-9}, 220\\times 10^{-9}, 220\\times 10^{-9}))$。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3]\"）。每个结果是对应测试用例的 $t_{\\mathrm{enc}}$ 的浮点数值（单位为米），遵循上述规则（如果已侵占则返回 $0$，如果不受任何边界段约束则返回 $-1$）。",
            "solution": "该问题要求我们计算一个网格顶点 $\\mathbf{x}$ 沿指定方向 $\\mathbf{d}$ 的最大允许位移 $t_{\\mathrm{enc}}$，以确保其不侵占任何约束边界段。该过程基于计算几何与向量代数的基本原理。\n\n总体算法如下：\n1. 确定重定位方向 $\\mathbf{d}$。该方向定义为对立三角形面 $(\\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3)$ 的单位法向量，其朝向为增加顶点 $\\mathbf{x}$ 相对于该面所在平面的高。\n2. 对于每个约束边界段 $(\\mathbf{a}_i, \\mathbf{b}_i)$，将非侵占约束建立为一个关于位移参数 $t$ 的二次不等式。\n3. 分析该不等式，找到 $t$ 的允许范围。这包括检查初始是否侵占，并求解相应二次方程的正根。\n4. 最终值 $t_{\\mathrm{enc}}$ 是在所有约束段中找到的所有此类正根的最小值。如果顶点已经侵占（$0$）或移动不受约束（$-1$），则返回特殊值。\n\n让我们详细说明每个步骤。\n\n### 步骤 1：确定重定位方向 $\\mathbf{d}$\n\n重定位方向 $\\mathbf{d}$ 是包含顶点为 $\\mathbf{p}_1$、$\\mathbf{p}_2$ 和 $\\mathbf{p}_3$ 的三角形面所在平面的单位法向量。必须选择此方向，使得沿其移动顶点 $\\mathbf{x}$ 会增加高，即 $\\mathbf{x}$ 到该平面距离。\n\n首先，我们定义两个位于该平面内的向量：\n$$ \\mathbf{v}_1 = \\mathbf{p}_2 - \\mathbf{p}_1 $$\n$$ \\mathbf{v}_2 = \\mathbf{p}_3 - \\mathbf{p}_1 $$\n该面的一个法向量 $\\mathbf{N}$ 由它们的叉积给出：\n$$ \\mathbf{N} = \\mathbf{v}_1 \\times \\mathbf{v}_2 $$\n$\\mathbf{x}$ 的高是其到该平面的垂直距离。增加此距离的方向是沿着从平面指向 $\\mathbf{x}$ 的法向量方向。从平面上一点（例如 $\\mathbf{p}_1$）到 $\\mathbf{x}$ 的向量是 $(\\mathbf{x}-\\mathbf{p}_1)$。如果 $\\mathbf{N}$ 与 $(\\mathbf{x}-\\mathbf{p}_1)$ 的点积为正，则 $\\mathbf{N}$ 的方向是正确的。该点积的符号 $\\mathbf{N} \\cdot (\\mathbf{x}-\\mathbf{p}_1)$ 也与四面体 $(\\mathbf{x}, \\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3)$ 的有向体积成正比。\n\n因此，我们计算 $S = \\mathbf{N} \\cdot (\\mathbf{x}-\\mathbf{p}_1)$。如果 $S  0$，我们必须通过取 $-\\mathbf{N}$ 来反转法向量。设方向正确的法向量为 $\\mathbf{N}_{\\mathrm{oriented}}$。最终的重定位方向 $\\mathbf{d}$ 是单位向量：\n$$ \\mathbf{d} = \\frac{\\mathbf{N}_{\\mathrm{oriented}}}{\\|\\mathbf{N}_{\\mathrm{oriented}}\\|} $$\n如果 $\\|\\mathbf{N}_{\\mathrm{oriented}}\\|=0$，则该面的顶点共线，这将表示一个退化的四面体。\n\n### 步骤 2：建立侵占约束公式\n\n对于每个约束段 $(\\mathbf{a}, \\mathbf{b})$，我们必须确保重定位后的顶点 $\\mathbf{x}(t) = \\mathbf{x} + t\\mathbf{d}$（对于 $t  0$）不进入该线段的直径球。直径球由其中心 $\\mathbf{c}$ 和半径 $r$ 定义：\n$$ \\mathbf{c} = \\frac{\\mathbf{a} + \\mathbf{b}}{2}, \\quad r = \\frac{\\|\\mathbf{a} - \\mathbf{b}\\|}{2} $$\n非侵占条件是点 $\\mathbf{x}(t)$ 必须位于此球上或球外：\n$$ \\|\\mathbf{x}(t) - \\mathbf{c}\\|^2 \\ge r^2 $$\n将 $\\mathbf{x}(t) = \\mathbf{x} + t\\mathbf{d}$ 代入不等式：\n$$ \\|(\\mathbf{x} - \\mathbf{c}) + t\\mathbf{d}\\|^2 \\ge r^2 $$\n展开范数的平方：\n$$ ((\\mathbf{x} - \\mathbf{c}) + t\\mathbf{d}) \\cdot ((\\mathbf{x} - \\mathbf{c}) + t\\mathbf{d}) \\ge r^2 $$\n$$ \\|\\mathbf{x} - \\mathbf{c}\\|^2 + 2t (\\mathbf{d} \\cdot (\\mathbf{x} - \\mathbf{c})) + t^2 \\|\\mathbf{d}\\|^2 \\ge r^2 $$\n整理后得到关于 $t$ 的二次不等式：\n$$ (\\|\\mathbf{d}\\|^2) t^2 + (2 \\mathbf{d} \\cdot (\\mathbf{x} - \\mathbf{c})) t + (\\|\\mathbf{x} - \\mathbf{c}\\|^2 - r^2) \\ge 0 $$\n这符合 $\\alpha t^2 + \\beta t + \\gamma \\ge 0$ 的形式，其系数为：\n- $\\alpha = \\|\\mathbf{d}\\|^2 = 1$，因为 $\\mathbf{d}$ 是一个单位向量。\n- $\\beta = 2 \\mathbf{d} \\cdot (\\mathbf{x} - \\mathbf{c})$。\n- $\\gamma = \\|\\mathbf{x} - \\mathbf{c}\\|^2 - r^2$。\n\n### 步骤 3：求解最大位移 $t_{\\mathrm{enc}}$\n\n我们必须为每个约束段分析不等式 $t^2 + \\beta t + \\gamma \\ge 0$。\n\n首先，检查初始位置 $\\mathbf{x}$（在 $t=0$ 时）。这由 $\\gamma$ 的值决定：如果 $\\gamma  0$，则 $\\|\\mathbf{x} - \\mathbf{c}\\|^2  r^2$，意味着 $\\mathbf{x}$ 已经位于直径球内部。根据问题描述，如果任何线段最初被侵占，则不允许移动，并且 $t_{\\mathrm{enc}} = 0$。\n\n如果所有线段的 $\\gamma \\ge 0$，我们继续寻找使任何线段的不等式被违反的最小正 $t$。当 $t^2 + \\beta t + \\gamma  0$ 时，不等式被违反。这发生在二次方程 $t^2 + \\beta t + \\gamma = 0$ 的根之间。根由 $t = \\frac{-\\beta \\pm \\sqrt{\\Delta}}{2}$ 给出，其中 $\\Delta = \\beta^2 - 4\\gamma$ 是判别式。\n\n- 如果 $\\Delta  0$，二次式始终为正（因为 $\\alpha=10$），所以不等式总是满足。该线段对移动不施加任何约束。\n- 如果 $\\Delta \\ge 0$，存在实根 $t_1 \\le t_2$。不等式在 $t \\le t_1$ 和 $t \\ge t_2$ 时满足。由于我们从 $t=0$ 开始且条件满足（$\\gamma \\ge 0$），我们关心的是我们可能进入禁止区域 $(t_1, t_2)$ 的第一个正时间 $t$。这对应于最小的正根。\n\n根的符号取决于 $\\beta$ 和 $\\gamma$：\n- 由于我们只考虑 $\\gamma \\ge 0$ 的情况，根的乘积 $t_1t_2 = \\gamma$ 是非负的。这意味着根具有相同的符号（或者其中一个为零）。\n- 根的和为 $t_1+t_2 = -\\beta$。\n- 如果 $\\beta \\ge 0$，根的和为非正。由于它们的乘积是非负的，所以两个根都必须是非正的（$t_1, t_2 \\le 0$）。没有正根，因此对正位移 $t$ 没有约束。几何上，$\\beta \\ge 0$ 意味着 $\\mathbf{d} \\cdot (\\mathbf{x} - \\mathbf{c}) \\ge 0$，即运动方向不是朝向球心，因此不会发生侵占。\n- 如果 $\\beta  0$，根的和为正，所以两个根都必须是非负的。根为 $t_1 = \\frac{-\\beta - \\sqrt{\\Delta}}{2}$ 和 $t_2 = \\frac{-\\beta + \\sqrt{\\Delta}}{2}$。两者都 $\\ge 0$。最小的正根是 $t_1$。这是顶点在侵占该线段的直径球之前可以移动的距离。\n\n### 步骤 4：算法综合\n\n对于给定的顶点 $\\mathbf{x}$、其对立面 $(\\mathbf{p}_1, \\mathbf{p}_2, \\mathbf{p}_3)$ 以及一组约束段 $\\{(\\mathbf{a}_i, \\mathbf{b}_i)\\}$，找到 $t_{\\mathrm{enc}}$ 的算法是：\n\n1.  如步骤1所述计算重定位方向 $\\mathbf{d}$。\n2.  初始化一个空列表 `positive_roots`，用于存储约束位移值。\n3.  对于每个线段 $(\\mathbf{a}_i, \\mathbf{b}_i)$：\n    a. 计算 $\\mathbf{c}_i$、$r_i$ 和系数 $\\gamma_i = \\|\\mathbf{x} - \\mathbf{c}_i\\|^2 - r_i^2$。\n    b. 如果 $\\gamma_i  0$，则顶点已被侵占。最终结果是 $t_{\\mathrm{enc}} = 0$。终止并返回此值。\n4.  如果没有线段最初被侵占，则对每个线段继续：\n    a. 计算系数 $\\beta_i = 2 \\mathbf{d} \\cdot (\\mathbf{x} - \\mathbf{c}_i)$。\n    b. 如果 $\\beta_i  0$：\n        i. 计算判别式 $\\Delta_i = \\beta_i^2 - 4\\gamma_i$。\n        ii. 如果 $\\Delta_i \\ge 0$，计算较小的根 $t = \\frac{-\\beta_i - \\sqrt{\\Delta_i}}{2}$。\n        iii. 如果 $t  0$，将其添加到 `positive_roots` 列表中。\n5.  在检查完所有线段后：\n    a. 如果 `positive_roots` 为空，则对前向运动没有约束。结果是 $t_{\\mathrm{enc}} = -1$。\n    b. 否则，最大允许位移是所有收集到的正根中的最小值：$t_{\\mathrm{enc}} = \\min(\\text{positive\\_roots})$。\n\n此过程为任何有效输入提供了一个唯一且明确定义的 $t_{\\mathrm{enc}}$ 值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum allowable vertex displacement t_enc for multiple test cases.\n    \"\"\"\n    \n    # Test cases defined in the problem statement.\n    # Each case is a tuple: (x, p_face, segments)\n    # x: the vertex to move\n    # p_face: a list of 3 vertices defining the opposing face\n    # segments: a list of constrained segments, each a tuple of 2 vertices.\n    test_cases = [\n        (\n            np.array([0.0, 0.0, 0.0]),\n            [np.array([20e-9, 0, 0]), np.array([0, 30e-9, 0]), np.array([0, 0, 0.5e-9])],\n            [\n                (np.array([50e-9, 50e-9, 0]), np.array([50e-9, 50e-9, 20e-9])),\n                (np.array([12e-9, -12e-9, 5e-9]), np.array([12e-9, -12e-9, 25e-9]))\n            ]\n        ),\n        (\n            np.array([0.0, 0.0, 0.0]),\n            [np.array([18e-9, 0, 0]), np.array([0, 18e-9, 0]), np.array([0, 0, 0.1e-9])],\n            [\n                (np.array([0, 10e-9, 0]), np.array([0, 10e-9, 20e-9])),\n                (np.array([-30e-9, -30e-9, 0]), np.array([-30e-9, -30e-9, 40e-9]))\n            ]\n        ),\n        (\n            np.array([0.0, 0.0, 0.0]),\n            [np.array([25e-9, 0, 0]), np.array([0, 25e-9, 0]), np.array([0, 0, 1e-9])],\n            [\n                (np.array([200e-9, 200e-9, 200e-9]), np.array([220e-9, 220e-9, 220e-9]))\n            ]\n        )\n    ]\n\n    results = []\n    for x, p_face, segments in test_cases:\n        p1, p2, p3 = p_face\n        \n        # Step 1: Determine the relocation direction d\n        v1 = p2 - p1\n        v2 = p3 - p1\n        N_raw = np.cross(v1, v2)\n        \n        # Ensure normal is oriented to increase altitude (points towards x)\n        if np.dot(N_raw, x - p1)  0:\n            N_oriented = -N_raw\n        else:\n            N_oriented = N_raw\n        \n        norm_N = np.linalg.norm(N_oriented)\n        if norm_N == 0:\n            # Degenerate face, cannot determine direction. Skip case if happens.\n            # Based on problem, this should not occur.\n            results.append(np.nan) # Or handle as an error\n            continue\n\n        d = N_oriented / norm_N\n\n        positive_roots = []\n        already_encroached = False\n\n        # Step 2  3: Check each constrained segment\n        for a, b in segments:\n            c = (a + b) / 2.0\n            r_vec = a - b\n            r_sq = np.dot(r_vec, r_vec) / 4.0\n            \n            x_minus_c = x - c\n            gamma = np.dot(x_minus_c, x_minus_c) - r_sq\n            \n            # Check for initial encroachment\n            if gamma  0:\n                already_encroached = True\n                break\n        \n        if already_encroached:\n            results.append(0.0)\n            continue\n\n        # If not initially encroached, find smallest positive root for all segments\n        for a, b in segments:\n            c = (a + b) / 2.0\n            r_vec = a - b\n            r_sq = np.dot(r_vec, r_vec) / 4.0\n            \n            x_minus_c = x - c\n            gamma = np.dot(x_minus_c, x_minus_c) - r_sq\n            \n            # Alpha is 1 since d is a unit vector\n            beta = 2 * np.dot(d, x_minus_c)\n\n            # A positive root can only exist if beta  0 (moving towards ball)\n            if beta  0:\n                delta = beta**2 - 4 * gamma\n                # Real roots exist only if delta is non-negative\n                if delta >= 0:\n                    # The smaller root is the first intersection point\n                    t = (-beta - np.sqrt(delta)) / 2.0\n                    # We are interested in strictly positive roots\n                    if t > 0:\n                        positive_roots.append(t)\n\n        # Step 4: Report the final result for the test case\n        if not positive_roots:\n            results.append(-1.0) # Unconstrained\n        else:\n            t_enc = min(positive_roots)\n            results.append(t_enc)\n\n    print(f\"[{','.join(f'{r:.17e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}