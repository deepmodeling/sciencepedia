{
    "hands_on_practices": [
        {
            "introduction": "The Burton-Cabrera-Frank (BCF) model provides a powerful framework for understanding how adatoms populate a crystal surface during growth. The steady-state adatom density on a terrace results from a balance between deposition, diffusion, and desorption, governed by a second-order differential equation. This first exercise will guide you through solving this equation in the important limit of a very wide terrace, helping you build physical intuition for the relationship between deposition flux $F$ and mean adatom lifetime $\\tau$ in determining the surface concentration far from any sinks .",
            "id": "4111624",
            "problem": "A crystalline surface in a semiconductor epitaxy reactor is described by the Burton–Cabrera–Frank (BCF) step-flow model. Consider a single terrace of width $L$ bounded by atomically sharp steps that act as perfect sinks for adsorbed atoms (adatoms), so that the adatom density vanishes at the step edges. Adatoms are supplied uniformly by a deposition flux and are removed by desorption. In the steady state, the adatom density $n(x)$ on the terrace satisfies one-dimensional mass conservation with Fickian diffusion, uniform deposition, and first-order desorption. The terrace is very wide in the sense that $L$ is much larger than the diffusion length.\n\nAssume the following physically measured parameters: diffusion coefficient $D = 10^{-6}\\,\\mathrm{cm^{2}/s}$, mean adatom lifetime against desorption $\\tau = 0.5\\,\\mathrm{s}$, and deposition flux $F = 0.1\\,\\mathrm{ML/s}$, where $\\mathrm{ML}$ denotes monolayers. Use the BCF framework with perfect-sink boundary conditions at the steps and the definition of the diffusion length. Compute the steady-state spatially averaged adatom density on the terrace in the limit of a very wide terrace, and express your final answer in monolayers ($\\mathrm{ML}$). Round your answer to two significant figures.",
            "solution": "The problem asks for the steady-state spatially averaged adatom density on a very wide terrace, as described by the Burton–Cabrera–Frank (BCF) model.\n\nThe physical processes governing the adatom density $n$ are one-dimensional Fickian diffusion, uniform deposition with flux $F$, and first-order desorption with a mean lifetime $\\tau$. In the steady state, the mass conservation equation for the adatom density $n(x)$ is a second-order ordinary differential equation:\n$$D \\frac{d^2 n}{dx^2} - \\frac{n}{\\tau} + F = 0$$\nwhere $D$ is the diffusion coefficient, $\\tau$ is the adatom lifetime, and $F$ is the deposition flux.\n\nThis equation can be rearranged into a standard form:\n$$\\frac{d^2 n}{dx^2} - \\frac{1}{D\\tau}n = -\\frac{F}{D}$$\nWe define the adatom diffusion length $\\lambda_D$ as the characteristic distance an adatom diffuses before desorbing. It is given by $\\lambda_D = \\sqrt{D\\tau}$. Substituting this into the equation yields:\n$$\\frac{d^2 n}{dx^2} - \\frac{1}{\\lambda_D^2}n = -\\frac{F}{D}$$\nThe general solution to this non-homogeneous linear differential equation is the sum of a particular solution $n_p(x)$ and the solution to the homogeneous equation $n_h(x)$.\n\nA constant particular solution can be found by setting the derivative terms to zero:\n$$-\\frac{1}{\\lambda_D^2}n_p = -\\frac{F}{D} \\implies n_p = \\frac{F\\lambda_D^2}{D} = \\frac{F(D\\tau)}{D} = F\\tau$$\nThis particular solution $n_p = F\\tau$ represents the adatom density on an infinite terrace with no steps, where deposition and desorption are perfectly balanced.\n\nThe homogeneous equation is $\\frac{d^2 n_h}{dx^2} - \\frac{1}{\\lambda_D^2}n_h = 0$, which has the general solution:\n$$n_h(x) = C_1 \\cosh\\left(\\frac{x}{\\lambda_D}\\right) + C_2 \\sinh\\left(\\frac{x}{\\lambda_D}\\right)$$\nwhere $C_1$ and $C_2$ are constants determined by boundary conditions.\n\nThe full solution for the adatom density profile is:\n$$n(x) = n_h(x) + n_p(x) = C_1 \\cosh\\left(\\frac{x}{\\lambda_D}\\right) + C_2 \\sinh\\left(\\frac{x}{\\lambda_D}\\right) + F\\tau$$\n\nTo determine the constants, we apply the boundary conditions. Let the origin $x=0$ be at the center of the terrace of width $L$. The step edges are located at $x = -L/2$ and $x = L/2$. The problem states that the steps act as perfect sinks, so the adatom density vanishes at the edges:\n$$n(-L/2) = 0 \\quad \\text{and} \\quad n(L/2) = 0$$\nDue to the symmetric placement of the steps and uniform flux, the density profile $n(x)$ must be an even function, i.e., $n(x) = n(-x)$. This requires the coefficient of the odd function $\\sinh(x/\\lambda_D)$ to be zero, so $C_2 = 0$. The solution simplifies to:\n$$n(x) = C_1 \\cosh\\left(\\frac{x}{\\lambda_D}\\right) + F\\tau$$\nApplying the boundary condition at $x = L/2$:\n$$n(L/2) = C_1 \\cosh\\left(\\frac{L}{2\\lambda_D}\\right) + F\\tau = 0$$\nSolving for $C_1$:\n$$C_1 = - \\frac{F\\tau}{\\cosh\\left(\\frac{L}{2\\lambda_D}\\right)}$$\nSubstituting $C_1$ back, we obtain the full expression for the adatom density profile across the terrace:\n$$n(x) = F\\tau \\left(1 - \\frac{\\cosh(x/\\lambda_D)}{\\cosh(L/(2\\lambda_D))}\\right)$$\nThe problem requires the spatially averaged adatom density, $\\langle n \\rangle$, defined as:\n$$\\langle n \\rangle = \\frac{1}{L} \\int_{-L/2}^{L/2} n(x) dx$$\nSince $n(x)$ is an even function, this simplifies to:\n$$\\langle n \\rangle = \\frac{2}{L} \\int_{0}^{L/2} F\\tau \\left(1 - \\frac{\\cosh(x/\\lambda_D)}{\\cosh(L/(2\\lambda_D))}\\right) dx$$\nPerforming the integration:\n$$\\langle n \\rangle = \\frac{2F\\tau}{L} \\left[ \\int_{0}^{L/2} dx - \\frac{1}{\\cosh(L/(2\\lambda_D))} \\int_{0}^{L/2} \\cosh(x/\\lambda_D) dx \\right]$$\n$$\\langle n \\rangle = \\frac{2F\\tau}{L} \\left[ x - \\frac{\\lambda_D \\sinh(x/\\lambda_D)}{\\cosh(L/(2\\lambda_D))} \\right]_{0}^{L/2}$$\n$$\\langle n \\rangle = \\frac{2F\\tau}{L} \\left[ \\frac{L}{2} - \\frac{\\lambda_D \\sinh(L/(2\\lambda_D))}{\\cosh(L/(2\\lambda_D))} \\right]$$\n$$\\langle n \\rangle = F\\tau \\left[ 1 - \\frac{2\\lambda_D}{L} \\tanh\\left(\\frac{L}{2\\lambda_D}\\right) \\right]$$\nThis is the exact expression for the average density for any terrace width $L$.\n\nThe problem specifies the limit of a very wide terrace, where $L$ is much larger than the diffusion length $\\lambda_D$ ($L \\gg \\lambda_D$). Mathematically, this corresponds to the limit $L \\to \\infty$. We evaluate the limit of the expression for $\\langle n \\rangle$:\n$$\\lim_{L \\to \\infty} \\langle n \\rangle = \\lim_{L \\to \\infty} F\\tau \\left[ 1 - \\frac{2\\lambda_D}{L} \\tanh\\left(\\frac{L}{2\\lambda_D}\\right) \\right]$$\nAs $L \\to \\infty$, the argument of the hyperbolic tangent function $L/(2\\lambda_D) \\to \\infty$. The limit of the hyperbolic tangent is $\\lim_{u\\to\\infty} \\tanh(u) = 1$. The term $2\\lambda_D/L$ goes to $0$. Therefore, the entire second term in the brackets vanishes:\n$$\\lim_{L \\to \\infty} \\left[ \\frac{2\\lambda_D}{L} \\tanh\\left(\\frac{L}{2\\lambda_D}\\right) \\right] = 0 \\times 1 = 0$$\nThus, the spatially averaged adatom density in the limit of a very wide terrace is:\n$$\\langle n \\rangle = F\\tau$$\nPhysically, this means that on a very wide terrace, the influence of the step edges as sinks is negligible when averaged over the entire terrace width. The density over the vast majority of the terrace reaches the equilibrium value $F\\tau$ dictated by the balance between deposition and desorption.\n\nNow, we substitute the given numerical values:\nDeposition flux, $F = 0.1\\,\\mathrm{ML/s}$.\nMean lifetime, $\\tau = 0.5\\,\\mathrm{s}$.\nThe diffusion coefficient $D = 10^{-6}\\,\\mathrm{cm^{2}/s}$ is not needed for this final calculation, but it provides the context for the diffusion length $\\lambda_D = \\sqrt{D\\tau}$ and validates that the \"wide terrace\" limit is a physically meaningful concept.\n\n$$\\langle n \\rangle = (0.1\\,\\mathrm{ML/s}) \\times (0.5\\,\\mathrm{s}) = 0.05\\,\\mathrm{ML}$$\nThe problem asks to round the answer to two significant figures.\n$$\\langle n \\rangle = 0.050\\,\\mathrm{ML}$$",
            "answer": "$$\\boxed{0.050}$$"
        },
        {
            "introduction": "While the concept of a 'perfect sink' is a useful idealization, real-world atom incorporation at a step edge is a kinetic process with its own characteristic rate. This means the overall growth rate can be limited either by how fast adatoms diffuse across the terrace (transport-limited) or by how slowly they attach at the step (kinetically-limited). This practice focuses on deriving a dimensionless parameter that directly compares the characteristic rates of these competing processes, allowing you to classify the growth regime and identify the system's bottleneck .",
            "id": "4111667",
            "problem": "Consider step-flow growth on a vicinal semiconductor surface modeled by the Burton–Cabrera–Frank (BCF) framework. Adatoms land on terraces and diffuse with diffusivity $D$, possibly desorb with mean lifetime $\\tau$, and attach at steps with a kinetic coefficient $k$. The mean terrace width is $\\ell$. In the BCF description, the steady adatom transport on a terrace arises from diffusion across the terrace and reaction (attachment) at the step, with a boundary condition that linearly relates the net step flux to the local departure from the step-edge equilibrium concentration. Assume a quasi-steady state on the terrace and regular step trains.\n\nStarting from the adatom mass balance and Fick’s law, and using the linear kinetic boundary condition at the step, derive a dimensionless group that classifies whether transport is limited by terrace diffusion or by step attachment. Use the given values $D=10^{-6}\\,\\mathrm{cm^2/s}$, $\\tau=1\\,\\mathrm{s}$, $k=100\\,\\mathrm{cm/s}$, and $\\ell=50\\,\\mathrm{nm}$ to evaluate this dimensionless group, and use it to decide whether the process is diffusion-limited or attachment-limited under these conditions. Round your reported value of the dimensionless group to three significant figures and express it in standard scientific notation. Report only the value of the dimensionless group without any units; explain the regime classification in your derivation.",
            "solution": "The problem requires the derivation of a dimensionless group to classify whether step-flow growth is limited by diffusion across the terrace or by the kinetics of attachment at the step edge. This can be done by comparing the characteristic rates (or velocities) of these two competing processes.\n\n**1. Derivation of the Dimensionless Group**\n\nThe overall process of an adatom incorporating into a step involves two serial steps: (1) diffusion across the terrace to the step, and (2) attachment at the step edge. The slower of these two steps will be the bottleneck for the overall growth rate.\n\n*   **Characteristic Rate of Step Attachment:** The kinetic coefficient, $k$, is given with units of velocity ($\\mathrm{cm/s}$) and directly represents the characteristic rate of atom incorporation at a step edge. We can define the characteristic velocity of attachment as:\n    $$v_{\\text{attach}} = k$$\n\n*   **Characteristic Rate of Terrace Diffusion:** To define a comparable rate for diffusion, we consider the time it takes for an adatom to diffuse across a distance comparable to the terrace width, $\\ell$. From random walk theory, this diffusion time, $\\tau_{\\text{diff}}$, scales as:\n    $$\\tau_{\\text{diff}} \\sim \\frac{\\ell^2}{D}$$\n    where $D$ is the diffusion coefficient. We can then define an effective velocity for mass transport across the terrace as the distance divided by this time:\n    $$v_{\\text{diff}} \\sim \\frac{\\ell}{\\tau_{\\text{diff}}} = \\frac{\\ell}{\\ell^2 / D} = \\frac{D}{\\ell}$$\n    This velocity, $v_{\\text{diff}}$, represents how quickly diffusion can supply adatoms from the terrace to the step.\n\nThe competition between these two processes is quantified by their ratio. We define a dimensionless group, $\\Lambda$, as the ratio of the attachment rate to the diffusion rate:\n$$\n\\Lambda = \\frac{v_{\\text{attach}}}{v_{\\text{diff}}} = \\frac{k}{D/\\ell} = \\frac{k\\ell}{D}\n$$\nThis dimensionless group allows for the classification of the growth regime:\n-   If $\\Lambda \\gg 1$, then $v_{\\text{attach}} \\gg v_{\\text{diff}}$. This implies that attachment is much faster than diffusion. The overall process is limited by the slower transport step. This is the **diffusion-limited** growth regime.\n-   If $\\Lambda \\ll 1$, then $v_{\\text{attach}} \\ll v_{\\text{diff}}$. This implies that attachment is much slower than diffusion. The incorporation of adatoms into the step is the bottleneck. This is the **attachment-limited** (or kinetically-limited) growth regime.\n\n**2. Evaluation of the Dimensionless Group**\n\nWe are given the following values. We must ensure they are in consistent units (cm).\n-   $k = 100\\,\\mathrm{cm/s}$\n-   $\\ell = 50\\,\\mathrm{nm} = 50 \\times 10^{-7}\\,\\mathrm{cm} = 5 \\times 10^{-6}\\,\\mathrm{cm}$\n-   $D = 10^{-6}\\,\\mathrm{cm^2/s}$\n\nSubstituting these values into the expression for $\\Lambda$:\n$$\n\\Lambda = \\frac{(100\\,\\mathrm{cm/s}) \\times (5 \\times 10^{-6}\\,\\mathrm{cm})}{10^{-6}\\,\\mathrm{cm^2/s}} = \\frac{5 \\times 10^{-4}}{10^{-6}} = 500\n$$\nThe resulting value is dimensionless, as expected. Rounding to three significant figures and expressing in standard scientific notation gives:\n$$\n\\Lambda = 5.00 \\times 10^2\n$$\n\n**3. Conclusion on Growth Regime**\n\nThe calculated value is $\\Lambda = 500$. Since $500 \\gg 1$, the attachment rate is much greater than the diffusion rate. Therefore, the rate-limiting step for the process under these conditions is terrace diffusion. The process is **diffusion-limited**. The adatom lifetime, $\\tau$, was not needed for this comparison but can be used to confirm that desorption is not the dominant limiting factor overall ($\\lambda_D = \\sqrt{D\\tau} = 10\\,\\mu\\mathrm{m}$, which is much larger than $\\ell=50\\,\\mathrm{nm}$).",
            "answer": "$$\n\\boxed{5.00 \\times 10^2}\n$$"
        },
        {
            "introduction": "Analytical solutions to the BCF equations provide deep insight but are often restricted to simplified cases. To model realistic growth scenarios with arbitrary terrace widths and kinetic parameters, we must turn to numerical methods. This capstone exercise bridges the gap between theory and simulation by tasking you with building a numerical solver for the full BCF boundary value problem from first principles . By implementing a finite-difference scheme for the diffusion equation with general kinetic (Robin) boundary conditions, you will develop a versatile tool to analyze terrace kinetics beyond idealized assumptions.",
            "id": "4111625",
            "problem": "You are tasked with building a numerical solver grounded in the Burton–Cabrera–Frank (BCF) step-flow model for terrace kinetics in semiconductor manufacturing. Starting from the steady-state adatom balance on a terrace, the continuum description enforces adatom diffusion with deposition and desorption, coupled to kinetic exchange at steps. The governing law for the adatom concentration $c(x)$ on a single terrace of width $L$ is a one-dimensional steady diffusion-reaction equation, with Robin (mixed) boundary conditions at the left and right steps representing linear kinetic exchange. Your task is to derive a finite-difference scheme from first principles and implement it to compute the concentration profile $c(x)$ across many terraces. To achieve universal applicability and remove physical units, you must work in a dimensionless formulation.\n\nUse the following context-appropriate fundamental base:\n- The terrace diffusion equation under steady-state deposition $F$ and desorption lifetime $\\tau$ is given by $D \\,\\dfrac{d^2 c}{dx^2} - \\dfrac{c}{\\tau} + F = 0$, where $D$ is the adatom diffusivity.\n- The Robin boundary condition at the left step ($x=0$) is $-D \\,\\dfrac{dc}{dx}\\big|_{x=0} = k_+ \\left(c(0) - c_{\\mathrm{eq}}\\right)$ and at the right step ($x=L$) is $D \\,\\dfrac{dc}{dx}\\big|_{x=L} = k_- \\left(c(L) - c_{\\mathrm{eq}}\\right)$, where $k_+$ and $k_-$ are kinetic coefficients and $c_{\\mathrm{eq}}$ is the local equilibrium concentration at the step.\n- Non-dimensionalize the system using the diffusion length $\\ell = \\sqrt{D \\tau}$, the scaled position $s = x/\\ell$, and the scaled concentration $\\varphi(s) = c(x) / (F \\tau)$. Define the dimensionless terrace width $\\Lambda = L/\\ell$, the dimensionless equilibrium $\\varphi_{\\mathrm{eq}} = c_{\\mathrm{eq}}/(F \\tau)$, and the dimensionless kinetic coefficients $\\kappa_+ = k_+ \\sqrt{\\tau/D}$ and $\\kappa_- = k_- \\sqrt{\\tau/D}$. In these variables, the steady-state equation becomes $\\dfrac{d^2 \\varphi}{ds^2} - \\varphi + 1 = 0$ on $s \\in [0,\\Lambda]$, with boundary conditions $-\\dfrac{d\\varphi}{ds}\\big|_{s=0} = \\kappa_+ \\left(\\varphi(0) - \\varphi_{\\mathrm{eq}}\\right)$ and $\\dfrac{d\\varphi}{ds}\\big|_{s=\\Lambda} = \\kappa_- \\left(\\varphi(\\Lambda) - \\varphi_{\\mathrm{eq}}\\right)$.\n\nYour program must:\n- Formulate a second-order accurate finite-difference scheme on a uniform grid for the dimensionless boundary value problem $\\dfrac{d^2 \\varphi}{ds^2} - \\varphi + 1 = 0$ on $[0,\\Lambda]$, with Robin boundary conditions at $s=0$ and $s=\\Lambda$.\n- Solve the resulting linear system for $\\varphi(s)$ on each terrace independently.\n- For each terrace, compute and return:\n  1. The terrace-averaged dimensionless concentration $\\overline{\\varphi} = \\dfrac{1}{N+1} \\sum_{j=0}^{N} \\varphi_j$, where $N$ is the number of subintervals (so there are $N+1$ grid points).\n  2. The dimensionless step fluxes at $s=0$ and $s=\\Lambda$, defined by $J^{\\mathrm{hat}}_{\\mathrm{left}} = -\\dfrac{d\\varphi}{ds}\\big|_{s=0}$ and $J^{\\mathrm{hat}}_{\\mathrm{right}} = \\dfrac{d\\varphi}{ds}\\big|_{s=\\Lambda}$. By the boundary conditions, these can be computed as $J^{\\mathrm{hat}}_{\\mathrm{left}} = \\kappa_+ \\left(\\varphi(0) - \\varphi_{\\mathrm{eq}}\\right)$ and $J^{\\mathrm{hat}}_{\\mathrm{right}} = \\kappa_- \\left(\\varphi(\\Lambda) - \\varphi_{\\mathrm{eq}}\\right)$.\n\nYour finite-difference scheme must be constructed without using any pre-derived shortcut formulas for the final discrete system. Use a uniform grid $s_j = j h$ for $j = 0,1,\\ldots,N$ with spacing $h = \\Lambda/N$. Discretize the interior using a second-order central difference for the second derivative and a second-order one-sided difference for the boundary derivatives when enforcing the Robin boundary conditions.\n\nImplement the solver for many terraces and validate it using the following test suite. Each test case provides arrays defining multiple terraces. For each terrace, use the specified number of subintervals $N$ (giving $N+1$ grid points). All outputs are dimensionless, so no physical units are required.\n\nTest Suite:\n- Test Case $1$ (general symmetric kinetics):\n  - $\\Lambda$ values: $[0.5, 1.0, 2.0, 3.0]$\n  - $\\kappa_+$ values: $[1.0, 1.0, 1.0, 1.0]$\n  - $\\kappa_-$ values: $[1.0, 1.0, 1.0, 1.0]$\n  - $\\varphi_{\\mathrm{eq}} = 0.0$\n  - $N$ values: $[50, 50, 50, 50]$\n- Test Case $2$ (asymmetric kinetics and narrow terraces):\n  - $\\Lambda$ values: $[0.1, 0.3, 0.5]$\n  - $\\kappa_+$ values: $[0.01, 0.01, 0.01]$\n  - $\\kappa_-$ values: $[100.0, 100.0, 100.0]$\n  - $\\varphi_{\\mathrm{eq}} = 0.0$\n  - $N$ values: $[20, 30, 40]$\n- Test Case $3$ (nonzero equilibrium and strong kinetics):\n  - $\\Lambda$ values: $[1.0, 2.0, 1.5]$\n  - $\\kappa_+$ values: $[10.0, 10.0, 10.0]$\n  - $\\kappa_-$ values: $[10.0, 10.0, 10.0]$\n  - $\\varphi_{\\mathrm{eq}} = 0.2$\n  - $N$ values: $[60, 80, 70]$\n\nOutput Specification:\n- For each test case, produce a list whose entries correspond to terraces, in the same order as provided. Each terrace’s entry must be a list of three floats: $[\\overline{\\varphi}, J^{\\mathrm{hat}}_{\\mathrm{left}}, J^{\\mathrm{hat}}_{\\mathrm{right}}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with no spaces. The global structure is a list of the three test case results, for example: $[[0.1,0.2,0.3],[0.4,0.5,0.6],[0.7,0.8,0.9]]$ but following the nested format where each inner item is itself a list of three floats per terrace.\n\nYour implementation must be entirely self-contained and must not require any input from the user. All computations and outputs are dimensionless, so no physical units are used or required. Angles are not involved.",
            "solution": "The problem requires the numerical solution of a one-dimensional, steady-state, dimensionless boundary value problem (BVP) that models adatom concentration on a semiconductor terrace, based on the Burton–Cabrera–Frank (BCF) theory.\n\nThe governing dimensionless equation for the scaled adatom concentration $\\varphi(s)$ on a terrace of scaled width $\\Lambda$ is:\n$$\n\\dfrac{d^2 \\varphi}{ds^2} - \\varphi + 1 = 0 \\quad \\text{for } s \\in [0, \\Lambda]\n$$\nThis is subject to Robin (mixed) boundary conditions at the terrace edges, $s=0$ and $s=\\Lambda$:\n$$\n-\\dfrac{d\\varphi}{ds}\\bigg|_{s=0} = \\kappa_+ \\left(\\varphi(0) - \\varphi_{\\mathrm{eq}}\\right)\n$$\n$$\n\\dfrac{d\\varphi}{ds}\\bigg|_{s=\\Lambda} = \\kappa_- \\left(\\varphi(\\Lambda) - \\varphi_{\\mathrm{eq}}\\right)\n$$\nwhere $\\kappa_+$ and $\\kappa_-$ are dimensionless kinetic coefficients and $\\varphi_{\\mathrm{eq}}$ is the dimensionless equilibrium concentration.\n\nWe will solve this BVP using a second-order accurate finite-difference method.\n\n**1. Discretization**\n\nFirst, we discretize the spatial domain $s \\in [0, \\Lambda]$ into a uniform grid. The domain is divided into $N$ subintervals of equal width $h$, yielding $N+1$ grid points $s_j = j h$ for $j = 0, 1, \\ldots, N$. The grid spacing is $h = \\Lambda/N$. We denote the numerical approximation of $\\varphi(s_j)$ as $\\varphi_j$.\n\n**2. Finite-Difference Approximation for Interior Points**\n\nFor any interior grid point $s_j$ where $j \\in \\{1, 2, \\ldots, N-1\\}$, we approximate the second derivative $\\dfrac{d^2\\varphi}{ds^2}$ using a second-order central difference formula:\n$$\n\\dfrac{d^2\\varphi}{ds^2}\\bigg|_{s_j} \\approx \\dfrac{\\varphi_{j-1} - 2\\varphi_j + \\varphi_{j+1}}{h^2}\n$$\nSubstituting this into the governing differential equation gives a discrete equation for each interior point:\n$$\n\\dfrac{\\varphi_{j-1} - 2\\varphi_j + \\varphi_{j+1}}{h^2} - \\varphi_j + 1 = 0\n$$\nMultiplying by $h^2$ and rearranging terms to group the unknown variables $\\varphi_j$ yields a linear algebraic equation:\n$$\n\\varphi_{j-1} - (2 + h^2)\\varphi_j + \\varphi_{j+1} = -h^2 \\quad \\text{for } j = 1, 2, \\ldots, N-1\n$$\nThis provides $N-1$ equations for the $N+1$ unknown concentrations $\\{\\varphi_0, \\varphi_1, \\ldots, \\varphi_N\\}$. Two additional equations are required, which we derive from the boundary conditions.\n\n**3. Finite-Difference Approximation for Boundary Conditions**\n\nThe problem specifies the use of second-order one-sided finite-difference formulas for the first derivative at the boundaries.\n\nAt the left boundary, $s=s_0=0$:\nThe derivative $\\dfrac{d\\varphi}{ds}\\big|_{s=0}$ is approximated using a second-order forward difference formula, which requires three points:\n$$\n\\dfrac{d\\varphi}{ds}\\bigg|_{s_0} \\approx \\dfrac{-3\\varphi_0 + 4\\varphi_1 - \\varphi_2}{2h}\n$$\nSubstituting this into the left boundary condition $-\\dfrac{d\\varphi}{ds}\\big|_{s_0} = \\kappa_+ (\\varphi_0 - \\varphi_{\\mathrm{eq}})$:\n$$\n-\\left(\\dfrac{-3\\varphi_0 + 4\\varphi_1 - \\varphi_2}{2h}\\right) = \\kappa_+ (\\varphi_0 - \\varphi_{\\mathrm{eq}})\n$$\n$$\n3\\varphi_0 - 4\\varphi_1 + \\varphi_2 = 2h\\kappa_+ (\\varphi_0 - \\varphi_{\\mathrm{eq}})\n$$\nRearranging to group the unknowns gives the first equation of our linear system:\n$$\n(3 - 2h\\kappa_+)\\varphi_0 - 4\\varphi_1 + \\varphi_2 = -2h\\kappa_+\\varphi_{\\mathrm{eq}}\n$$\n\nAt the right boundary, $s=s_N=\\Lambda$:\nThe derivative $\\dfrac{d\\varphi}{ds}\\big|_{s_N}$ is approximated using a second-order backward difference formula:\n$$\n\\dfrac{d\\varphi}{ds}\\bigg|_{s_N} \\approx \\dfrac{3\\varphi_N - 4\\varphi_{N-1} + \\varphi_{N-2}}{2h}\n$$\nSubstituting this into the right boundary condition $\\dfrac{d\\varphi}{ds}\\big|_{s_N} = \\kappa_- (\\varphi_N - \\varphi_{\\mathrm{eq}})$:\n$$\n\\dfrac{3\\varphi_N - 4\\varphi_{N-1} + \\varphi_{N-2}}{2h} = \\kappa_- (\\varphi_N - \\varphi_{\\mathrm{eq}})\n$$\n$$\n\\varphi_{N-2} - 4\\varphi_{N-1} + 3\\varphi_N = 2h\\kappa_- (\\varphi_N - \\varphi_{\\mathrm{eq}})\n$$\nRearranging gives the final equation of our linear system:\n$$\n\\varphi_{N-2} - 4\\varphi_{N-1} + (3 - 2h\\kappa_-)\\varphi_N = -2h\\kappa_-\\varphi_{\\mathrm{eq}}\n$$\n\n**4. The Linear System of Equations**\n\nBy combining the equations for the interior points and the two boundary points, we form a system of $N+1$ linear equations for the $N+1$ unknowns $\\vec{\\varphi} = [\\varphi_0, \\varphi_1, \\ldots, \\varphi_N]^T$. This system can be written in matrix form as $A\\vec{\\varphi} = \\vec{b}$.\n\nThe matrix $A$ is an $(N+1) \\times (N+1)$ matrix with the following non-zero entries:\n- For row $j=0$:\n$A_{0,0} = 3 - 2h\\kappa_+$, $A_{0,1} = -4$, $A_{0,2} = 1$\n- For rows $j = 1, \\ldots, N-1$:\n$A_{j,j-1} = 1$, $A_{j,j} = -(2+h^2)$, $A_{j,j+1} = 1$\n- For row $j=N$:\n$A_{N,N-2} = 1$, $A_{N,N-1} = -4$, $A_{N,N} = 3 - 2h\\kappa_-$\n\nThe vector $\\vec{b}$ is an $(N+1) \\times 1$ column vector with the following entries:\n- For row $j=0$: $b_0 = -2h\\kappa_+\\varphi_{\\mathrm{eq}}$\n- For rows $j = 1, \\ldots, N-1$: $b_j = -h^2$\n- For row $j=N$: $b_N = -2h\\kappa_-\\varphi_{\\mathrm{eq}}$\n\nThis linear system can be solved using standard numerical linear algebra methods to find the vector of concentrations $\\vec{\\varphi}$.\n\n**5. Calculation of Output Quantities**\n\nOnce the solution vector $\\vec{\\varphi}$ is obtained, we can compute the required output metrics for each terrace:\n1.  The terrace-averaged dimensionless concentration $\\overline{\\varphi}$, calculated using a discrete average over the grid points:\n    $$\n    \\overline{\\varphi} = \\dfrac{1}{N+1} \\sum_{j=0}^{N} \\varphi_j\n    $$\n2.  The dimensionless step fluxes, which can be computed directly from the boundary conditions and the now-known boundary concentrations $\\varphi_0$ and $\\varphi_N$:\n    $$\n    J^{\\mathrm{hat}}_{\\mathrm{left}} = \\kappa_+ (\\varphi_0 - \\varphi_{\\mathrm{eq}})\n    $$\n    $$\n    J^{\\mathrm{hat}}_{\\mathrm{right}} = \\kappa_- (\\varphi_N - \\varphi_{\\mathrm{eq}})\n    $$\n\nThe implemented numerical solver will execute this procedure for each set of terrace parameters provided in the test suite.",
            "answer": "```python\nimport numpy as np\n\ndef solve_terrace(Lambda, kappa_p, kappa_m, phi_eq, N):\n    \"\"\"\n    Solves the BCF dimensionless BVP for a single terrace using a finite-difference scheme.\n    \n    Args:\n        Lambda (float): Dimensionless terrace width.\n        kappa_p (float): Dimensionless kinetic coefficient at s=0.\n        kappa_m (float): Dimensionless kinetic coefficient at s=Lambda.\n        phi_eq (float): Dimensionless equilibrium concentration.\n        N (int): Number of subintervals for the grid.\n\n    Returns:\n        list: A list of three floats: [average_concentration, left_flux, right_flux].\n    \"\"\"\n    # N is the number of subintervals, so there are N+1 grid points.\n    num_points = N + 1\n    h = Lambda / N\n    h2 = h * h\n\n    # Initialize the matrix A and vector b for the linear system A*phi = b\n    A = np.zeros((num_points, num_points))\n    b = np.zeros(num_points)\n\n    # --- Populate the matrix A and vector b ---\n\n    # Equation for the first row (j=0), from the left boundary condition\n    # (3 - 2*h*kappa_p)*phi_0 - 4*phi_1 + phi_2 = -2*h*kappa_p*phi_eq\n    A[0, 0] = 3.0 - 2.0 * h * kappa_p\n    A[0, 1] = -4.0\n    if num_points > 2:\n        A[0, 2] = 1.0\n    b[0] = -2.0 * h * kappa_p * phi_eq\n\n    # Equations for interior rows (j=1 to N-1) from the governing DE\n    # phi_{j-1} - (2 + h^2)*phi_j + phi_{j+1} = -h^2\n    for j in range(1, N):\n        A[j, j - 1] = 1.0\n        A[j, j] = -(2.0 + h2)\n        A[j, j + 1] = 1.0\n        b[j] = -h2\n\n    # Equation for the last row (j=N), from the right boundary condition\n    # phi_{N-2} - 4*phi_{N-1} + (3 - 2*h*kappa_m)*phi_N = -2*h*kappa_m*phi_eq\n    if num_points > 2:\n        A[N, N - 2] = 1.0\n    # The smallest N in test cases is 20, so N-1 and N-2 indices are always valid.\n    A[N, N - 1] = -4.0\n    A[N, N] = 3.0 - 2.0 * h * kappa_m\n    b[N] = -2.0 * h * kappa_m * phi_eq\n    \n    # Solve the linear system for phi\n    try:\n        phi_vec = np.linalg.solve(A, b)\n    except np.linalg.LinAlgError:\n        # This should not happen for a well-posed problem.\n        # Return NaNs as a signal of failure.\n        return [np.nan, np.nan, np.nan]\n\n    # --- Calculate output quantities ---\n    \n    # 1. Terrace-averaged dimensionless concentration\n    avg_phi = np.mean(phi_vec)\n    \n    # 2. Dimensionless step fluxes\n    J_left = kappa_p * (phi_vec[0] - phi_eq)\n    J_right = kappa_m * (phi_vec[-1] - phi_eq)\n    \n    return [avg_phi, J_left, J_right]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final results.\n    \"\"\"\n    test_cases = [\n        # Test Case 1: general symmetric kinetics\n        {\n            \"Lambda_vals\": [0.5, 1.0, 2.0, 3.0],\n            \"kappa_p_vals\": [1.0, 1.0, 1.0, 1.0],\n            \"kappa_m_vals\": [1.0, 1.0, 1.0, 1.0],\n            \"phi_eq\": 0.0,\n            \"N_vals\": [50, 50, 50, 50],\n        },\n        # Test Case 2: asymmetric kinetics and narrow terraces\n        {\n            \"Lambda_vals\": [0.1, 0.3, 0.5],\n            \"kappa_p_vals\": [0.01, 0.01, 0.01],\n            \"kappa_m_vals\": [100.0, 100.0, 100.0],\n            \"phi_eq\": 0.0,\n            \"N_vals\": [20, 30, 40],\n        },\n        # Test Case 3: nonzero equilibrium and strong kinetics\n        {\n            \"Lambda_vals\": [1.0, 2.0, 1.5],\n            \"kappa_p_vals\": [10.0, 10.0, 10.0],\n            \"kappa_m_vals\": [10.0, 10.0, 10.0],\n            \"phi_eq\": 0.2,\n            \"N_vals\": [60, 80, 70],\n        }\n    ]\n\n    all_results = []\n    for case_data in test_cases:\n        case_results = []\n        num_terraces = len(case_data[\"Lambda_vals\"])\n        for i in range(num_terraces):\n            Lambda = case_data[\"Lambda_vals\"][i]\n            kappa_p = case_data[\"kappa_p_vals\"][i]\n            kappa_m = case_data[\"kappa_m_vals\"][i]\n            phi_eq = case_data[\"phi_eq\"]\n            N = case_data[\"N_vals\"][i]\n            \n            terrace_result = solve_terrace(Lambda, kappa_p, kappa_m, phi_eq, N)\n            case_results.append(terrace_result)\n        all_results.append(case_results)\n\n    # Format the final output string according to the specification (list of lists, no spaces)\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}