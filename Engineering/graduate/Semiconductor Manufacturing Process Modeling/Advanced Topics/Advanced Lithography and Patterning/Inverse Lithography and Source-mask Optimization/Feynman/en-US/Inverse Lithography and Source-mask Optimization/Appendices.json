{
    "hands_on_practices": [
        {
            "introduction": "Before we can optimize a mask pattern, we must first decide how to represent it on a computational grid. This exercise bridges the gap between the physical world of optics and the digital domain of computation. By applying the Nyquist-Shannon sampling theorem, you will derive the fundamental relationship between the resolution limit of the projection system and the required pixel size for the mask representation .",
            "id": "4134394",
            "problem": "An inverse lithography technology (ILT) mask for source-mask optimization (SMO) is represented on a discrete pixel grid in real space. The projection system is modeled using scalar, coherent imaging with numerical aperture $NA$, exposure wavelength $\\lambda$, and a mask-to-wafer linear reduction factor $M_{r}$ (mask features are $M_{r}$ times larger than the corresponding wafer features). Assume the aerial image formation is bandlimited by the projection optics, and neglect resist and etch effects so that the Optical Transfer Function (OTF) cutoff governs the minimum resolvable spatial period. Use the Nyquist–Shannon sampling theorem for the pixel grid.\n\nStarting from first principles of scalar diffraction and Fourier optics, derive a relationship between the pixel size $p$ on the mask and the minimum resolvable line width on the mask, denoted $L_{\\min,\\text{mask}}$. Your derivation must proceed from the passband limitation imposed by the projection optics and the sampling condition required to represent any mask pattern whose image is within this passband. Express the relationship in closed form and interpret its meaning in terms of the minimum resolvable feature size on the mask.\n\nThen, taking the mask field of view to be a square of side $F = 50\\,\\mu\\text{m}$ and the desired mask-grid resolution to be $p = 1\\,\\text{nm}$, compute the total number of pixels required to represent this field. Express the final pixel count as an exact integer without units. No rounding is required.",
            "solution": "The problem is evaluated as valid. It is scientifically grounded in the principles of Fourier optics and sampling theory as applied to semiconductor lithography, is well-posed with a clear objective and sufficient information, and is free of subjective or ambiguous language.\n\nThe problem consists of two parts. The first part requires the derivation of a relationship between the mask pixel size $p$ and the minimum resolvable line width on the mask, $L_{\\min,\\text{mask}}$. The second part requires the calculation of the total number of pixels for a given mask field of view and pixel size.\n\n**Part 1: Derivation of the Relationship**\n\nWe begin from the first principles of scalar diffraction theory for a coherent imaging system. The projection optics are characterized by the numerical aperture $NA$, the exposure wavelength $\\lambda$, and the mask-to-wafer linear reduction factor $M_r$.\n\nThe optical system acts as a low-pass filter for spatial frequencies. The maximum spatial frequency, in radians per unit length, that can be transmitted by the objective lens and appear in the aerial image on the wafer is determined by the $NA$ and $\\lambda$. This cutoff frequency is given by:\n$$k_{\\max, \\text{wafer}} = \\frac{2\\pi NA}{\\lambda}$$\nAny spatial frequency component of the object's spectrum that, when mapped to the image plane, has a magnitude greater than $k_{\\max, \\text{wafer}}$ will be filtered out by the optical system's pupil.\n\nThe mask features are larger than the wafer features by a factor of $M_r$. This demagnification in real space corresponds to a magnification of spatial frequencies. A spatial frequency $k_{\\text{mask}}$ on the mask corresponds to a spatial frequency $k_{\\text{wafer}} = M_r k_{\\text{mask}}$ on the wafer. Consequently, the cutoff frequency of the optical system, when referred back to the mask coordinate system, is:\n$$k_{\\max, \\text{mask}} = \\frac{k_{\\max, \\text{wafer}}}{M_r} = \\frac{2\\pi NA}{\\lambda M_r}$$\n\nThe problem defines the minimum resolvable line width, $L_{\\min}$, based on the passband limitation. The minimum resolvable spatial period, $\\Lambda_{\\min}$, corresponds to the resolution limit of the optical system. For coherent illumination, the smallest period of a grating that can be resolved occurs when its first-order diffracted beam is just captured by the lens. This limit is $\\Lambda_{\\min, \\text{wafer}} = \\lambda/NA$. The minimum resolvable line width is typically defined as half of this minimum period (i.e., the half-pitch):\n$$L_{\\min, \\text{wafer}} = \\frac{\\Lambda_{\\min, \\text{wafer}}}{2} = \\frac{\\lambda}{2NA}$$\nThis is the minimum line width resolvable on the wafer. The corresponding feature on the mask is $M_r$ times larger. Thus, the minimum resolvable line width on the mask is:\n$$L_{\\min, \\text{mask}} = M_r L_{\\min, \\text{wafer}} = M_r \\left( \\frac{\\lambda}{2NA} \\right) = \\frac{M_r \\lambda}{2NA}$$\n\nThe mask pattern is represented on a discrete pixel grid of size $p$. To ensure that the mask representation is adequate for the imaging process, we apply the Nyquist-Shannon sampling theorem. The theorem states that to perfectly reconstruct a signal, the sampling frequency must be at least twice the maximum frequency present in the signal. In this context, the signal is the continuous mask pattern that we are representing with discrete pixels. We only need to ensure that the mask grid can represent all frequencies up to the cutoff imposed by the optical system, $k_{\\max, \\text{mask}}$.\n\nWorking with cyclical frequencies, where $f = k/(2\\pi)$, the maximum cyclical frequency on the mask that is passed by the system is:\n$$f_{\\max, \\text{mask}} = \\frac{k_{\\max, \\text{mask}}}{2\\pi} = \\frac{NA}{\\lambda M_r}$$\nThe sampling frequency on the mask grid for a pixel size $p$ is $f_s = 1/p$. The Nyquist-Shannon theorem requires $f_s \\ge 2f_{\\max, \\text{mask}}$. Substituting the expressions for $f_s$ and $f_{\\max, \\text{mask}}$ yields:\n$$\\frac{1}{p} \\ge 2 \\left( \\frac{NA}{\\lambda M_r} \\right)$$\nSolving for the pixel size $p$, we obtain the condition:\n$$p \\le \\frac{\\lambda M_r}{2NA}$$\nBy comparing this inequality with the previously derived expression for the minimum resolvable line width on the mask, $L_{\\min, \\text{mask}} = \\frac{M_r \\lambda}{2NA}$, we find the direct relationship:\n$$p \\le L_{\\min, \\text{mask}}$$\n\nThis inequality is the required relationship. It signifies that the mask pixel size $p$ must be less than or equal to the minimum resolvable line width on the mask $L_{\\min, \\text{mask}}$. This ensures that the pixel grid is fine enough to describe any feature, including sub-resolution assist features, whose spatial frequencies are within the passband of the projection optics. If $p$ were larger than this limit, the mask grid would be unable to represent the high-frequency information that the optical system can transmit, leading to aliasing and a failure of the inverse lithography optimization. The limiting case, $p = L_{\\min, \\text{mask}}$, corresponds to sampling at exactly the Nyquist rate.\n\n**Part 2: Calculation of Pixel Count**\n\nThe problem specifies a square mask field of view with side length $F = 50\\,\\text{\\mu m}$ and a desired mask-grid pixel size of $p = 1\\,\\text{nm}$. We are asked to compute the total number of pixels required to represent this field.\n\nFirst, we must ensure the units are consistent. We will convert both lengths to meters.\n$$F = 50\\,\\text{\\mu m} = 50 \\times 10^{-6}\\,\\text{m}$$\n$$p = 1\\,\\text{nm} = 1 \\times 10^{-9}\\,\\text{m}$$\n\nThe number of pixels along one dimension of the square field, $N_{\\text{side}}$, is the total length of the side divided by the size of a single pixel:\n$$N_{\\text{side}} = \\frac{F}{p} = \\frac{50 \\times 10^{-6}\\,\\text{m}}{1 \\times 10^{-9}\\,\\text{m}} = 50 \\times 10^3 = 50000$$\nThe total number of pixels, $N_{\\text{total}}$, in the square field is the square of the number of pixels along one side:\n$$N_{\\text{total}} = (N_{\\text{side}})^2 = (50000)^2 = (5 \\times 10^4)^2 = 25 \\times 10^8 = 2,500,000,000$$\n\nThe total number of pixels required to represent the specified field of view at the given resolution is $2,500,000,000$.",
            "answer": "$$\\boxed{2500000000}$$"
        },
        {
            "introduction": "Sub-Resolution Assist Features (SRAFs) are a cornerstone of modern resolution enhancement techniques, improving the printability of main features without printing themselves. This practice presents a realistic optimization challenge: determining the ideal placement of an SRAF to maximize the image contrast of a primary line. You will simulate the imaging process and navigate the crucial trade-off between enhancing the main feature and maintaining SRAF non-printability across a process window of focus and dose variations .",
            "id": "4134402",
            "problem": "Consider a one-dimensional coherent imaging model for Semiconductor Manufacturing Process Modeling with a single point source illumination and a thin lens system. You will compute the optimal placement distance of a Sub-Resolution Assist Feature (SRAF) from the edge of a main clear line on a binary mask using a resist threshold model, and verify nonprinting of the SRAF across specified defocus and dose variation windows. Inverse lithography and source-mask optimization are framed here as choosing the SRAF placement to optimize image quality at the main feature while enforcing nonprinting constraints for the assist feature.\n\nAssume scalar, paraxial, coherent imaging with unity magnification, a binary real-valued mask amplitude transmittance, and a band-limited pupil. Let the one-dimensional spatial coordinate be $x$ expressed in nanometers. Let the wavelength be $\\lambda$ (in nanometers), and the Numerical Aperture (NA) be a positive, unitless value. The coherent imaging amplitude in the image plane is given by the inverse Fourier transform of the product of the mask spectrum and the pupil function with defocus phase. Specifically, define the spatial frequency variable $k$ (in cycles per nanometer), the pupil cutoff frequency as $k_c = \\mathrm{NA} / \\lambda$, and the defocus parameter in waves at the pupil edge as $N_\\mathrm{waves}$ (unitless). The pupil function is a low-pass filter with a quadratic phase:\n$$\nP(k;N_\\mathrm{waves}) = \\begin{cases}\n\\exp\\!\\left(i\\,2\\pi\\,N_\\mathrm{waves}\\left(\\frac{k}{k_c}\\right)^2\\right), & |k| \\le k_c, \\\\\n0, & |k| > k_c.\n\\end{cases}\n$$\nLet the mask amplitude transmittance be $m(x) \\in \\{0,1\\}$, equal to $1$ inside clear openings and $0$ otherwise. The coherent image-plane complex field is\n$$\nE(x;N_\\mathrm{waves}) = \\mathcal{F}^{-1}\\left\\{\\mathcal{F}\\{m(x)\\}\\cdot P(k;N_\\mathrm{waves})\\right\\},\n$$\nand the aerial image intensity is $I(x;N_\\mathrm{waves}) = |E(x;N_\\mathrm{waves})|^2$. Normalize intensity such that a uniform infinite clear mask would produce $I(x)=1$. To achieve this normalization numerically, define $I_\\mathrm{uniform}(x;N_\\mathrm{waves})$ as the intensity for $m(x) \\equiv 1$ under the same $P(k;N_\\mathrm{waves})$, and use\n$$\n\\tilde{I}(x;N_\\mathrm{waves}) = \\frac{I(x;N_\\mathrm{waves})}{\\langle I_\\mathrm{uniform}(x;N_\\mathrm{waves})\\rangle},\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the spatial mean, ensuring $\\tilde{I}(x)=1$ for a uniform clear mask.\n\nUse a simple resist threshold model with dose scaling: for a given dose $D$ (dimensionless, relative to nominal), a location $x$ prints if $D\\,\\tilde{I}(x;N_\\mathrm{waves}) \\ge I_\\mathrm{th}$, where $I_\\mathrm{th}$ is the resist threshold (dimensionless). Otherwise, it does not print.\n\nMask geometry specification:\n- A main clear line of width $W_\\mathrm{main}$ centered at $x=0$, i.e., $m(x)=1$ for $|x|\\le W_\\mathrm{main}/2$.\n- One rectangular SRAF of width $W_\\mathrm{a}$ placed to the right of the main line. Its near edge is at distance $s$ from the right edge of the main line, so it occupies $x \\in [W_\\mathrm{main}/2 + s,\\, W_\\mathrm{main}/2 + s + W_\\mathrm{a}]$.\n\nOptimization objective and constraints:\n- Define the nominal dose $D_\\mathrm{nom} = (D_\\mathrm{min} + D_\\mathrm{max})/2$.\n- Define the nominal threshold crossing level $I_\\mathrm{cross} = I_\\mathrm{th}/D_\\mathrm{nom}$.\n- At nominal focus ($N_\\mathrm{waves}=0$), define the right-edge threshold crossing position $x^\\star$ as the location near the right edge where $\\tilde{I}(x^\\star;0) = I_\\mathrm{cross}$ (take the first crossing moving outward from the main line). Define the edge slope magnitude at the crossing as $S = \\left|\\frac{d\\tilde{I}}{dx}\\big|_{x^\\star}\\right|$.\n- Choose $s$ to maximize $S$ subject to the following nonprinting and printing constraints across the specified process window:\n    1. Nonprinting SRAF: for all $N_\\mathrm{waves}$ in the defocus set and $D \\in [D_\\mathrm{min}, D_\\mathrm{max}]$, at the SRAF center $x_\\mathrm{a,center} = W_\\mathrm{main}/2 + s + W_\\mathrm{a}/2$, require $D\\,\\tilde{I}(x_\\mathrm{a,center};N_\\mathrm{waves}) < I_\\mathrm{th}$.\n    2. Printing main feature: for all $N_\\mathrm{waves}$ in the defocus set, with dose $D=D_\\mathrm{min}$, at the main center $x=0$, require $D_\\mathrm{min}\\,\\tilde{I}(0;N_\\mathrm{waves}) > I_\\mathrm{th}$.\n\nDefocus set specification:\n- Use a discrete set of defocus values in waves at the pupil edge: $\\{-N_\\mathrm{max}, -N_\\mathrm{max}/2, 0, N_\\mathrm{max}/2, N_\\mathrm{max}\\}$.\n\nNumerical implementation requirements:\n- Perform the coherent imaging using discrete Fourier transforms on a sufficiently large one-dimensional computational window to avoid wrap-around artifacts. Use a spatial sampling that ensures the Nyquist frequency comfortably exceeds $k_c$.\n- Compute $\\tilde{I}(x;N_\\mathrm{waves})$ for the required mask configurations and defocus values.\n- Search $s$ over a specified discrete range to identify the feasible $s$ that maximizes $S$. If no feasible $s$ exists, return $-1$ for that test case.\n\nUnits and output:\n- All distances ($W_\\mathrm{main}$, $W_\\mathrm{a}$, $s$) must be handled in nanometers, and the returned optimal $s$ must be expressed in nanometers as a float rounded to one decimal place. If infeasible, return the integer $-1$.\n- Angles are not involved, so no angle unit is required.\n\nTest suite:\nCompute the optimal SRAF placement distance $s$ for each of the following parameter sets. For each test case, take the search range for $s$ as given. The final output must be a single line containing the four results as a comma-separated list enclosed in square brackets.\n\n- Case 1 (typical dry lithography):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.85$, $W_\\mathrm{main} = 40$ nm, $W_\\mathrm{a} = 15$ nm\n    - $I_\\mathrm{th} = 0.30$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.20$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 2 (lower numerical aperture):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.50$, $W_\\mathrm{main} = 40$ nm, $W_\\mathrm{a} = 15$ nm\n    - $I_\\mathrm{th} = 0.30$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.20$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 3 (high numerical aperture, tighter dose and larger defocus window):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 1.35$, $W_\\mathrm{main} = 30$ nm, $W_\\mathrm{a} = 12$ nm\n    - $I_\\mathrm{th} = 0.25$, $D_\\mathrm{min} = 0.95$, $D_\\mathrm{max} = 1.05$\n    - $N_\\mathrm{max} = 0.30$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\n- Case 4 (narrow main line):\n    - $\\lambda = 193$ nm, $\\mathrm{NA} = 0.93$, $W_\\mathrm{main} = 20$ nm, $W_\\mathrm{a} = 10$ nm\n    - $I_\\mathrm{th} = 0.28$, $D_\\mathrm{min} = 0.90$, $D_\\mathrm{max} = 1.10$\n    - $N_\\mathrm{max} = 0.25$ waves\n    - $s \\in [20, 200]$ nm in steps of $2$ nm\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"). Each result must be the optimal SRAF placement distance $s$ in nanometers rounded to one decimal place, or the integer -1 if no feasible solution is found under the constraints and search range.",
            "solution": "The user has provided a well-posed problem in the domain of computational lithography, an area of semiconductor manufacturing process modeling. The task is to determine the optimal placement of a Sub-Resolution Assist Feature (SRAF) to enhance the image quality of a primary feature on a photomask.\n\nThe problem will be solved by adhering to the following structured, principle-based methodology:\n\n1.  **Problem Formulation**: The core of the problem lies in modeling a one-dimensional coherent optical imaging system using Fourier optics. The system maps a binary mask's amplitude transmittance, $m(x)$, to an aerial image intensity in the image plane, $\\tilde{I}(x)$. The goal is to optimize the SRAF position, $s$, to maximize the image slope $S$ at the main feature's edge, subject to constraints on the process window (variations in defocus and exposure dose).\n\n2.  **Imaging Model Implementation**: The aerial image is calculated via the Fourier transform pathway, as specified: $E(x) = \\mathcal{F}^{-1}\\{\\mathcal{F}\\{m(x)\\} \\cdot P(k)\\}$, where $P(k)$ is the pupil function. This is equivalent to a convolution of the mask $m(x)$ with the coherent point spread function $h(x) = \\mathcal{F}^{-1}\\{P(k)\\}$. For numerical computation, we will use the Discrete Fourier Transform (DFT) as implemented by `numpy.fft`.\n    -   A sufficiently large computational grid for the spatial coordinate $x$ is established to prevent circular convolution artifacts inherent to DFT-based convolution.\n    -   The spatial sampling interval, $\\Delta x$, is chosen to ensure the Nyquist frequency, $k_{\\mathrm{Nyquist}} = 1/(2\\Delta x)$, is well above the pupil's cutoff frequency, $k_c = \\mathrm{NA} / \\lambda$.\n    -   The mask transmittance function $m(x)$ is discretized onto this grid for each candidate SRAF position $s$.\n    -   The pupil function $P(k; N_{\\mathrm{waves}})$ is also discretized on the corresponding frequency-space grid $k$. It acts as a low-pass filter with a defocus-dependent quadratic phase term.\n    -   For each defocus value, the product of the mask's spectrum and the pupil function is computed, followed by an inverse DFT to obtain the complex electric field $E(x)$ in the image plane.\n    -   The intensity is then $I(x) = |E(x)|^2$.\n    -   The problem specifies a normalization procedure. For a uniform clear mask ($m(x) \\equiv 1$), the optical system, with $P(k=0)=1$, produces a uniform field $E(x)=1$ and intensity $I(x)=1$. The specified normalization factor, $\\langle I_{\\mathrm{uniform}} \\rangle$, thus evaluates to $1$. The normalized intensity $\\tilde{I}(x)$ is therefore identical to the calculated $I(x)$. This will be implemented as described for full compliance, though the factor is unity.\n\n3.  **Optimization and Constraint Checking**: The solution involves a search over the prescribed discrete range of SRAF placement distances, $s$. For each value of $s$:\n    a.  **Feasibility Analysis**: The feasibility of the placement is tested against the specified process window. This involves computing the aerial image $\\tilde{I}(x; N_{\\mathrm{waves}})$ for all five discrete defocus values ($\\{-N_{\\mathrm{max}}, -N_{\\mathrm{max}}/2, 0, N_{\\mathrm{max}}/2, N_{\\mathrm{max}}\\}$).\n        i.  **Main Feature Printing Constraint**: For the main feature to print reliably, its central intensity must remain above the resist threshold even at the lowest dose, $D_{\\mathrm{min}}$. This translates to the condition $\\tilde{I}(0;N_{\\mathrm{waves}}) > I_{\\mathrm{th}} / D_{\\mathrm{min}}$ for all defocus values.\n        ii. **SRAF Non-Printing Constraint**: The SRAF must not print. This is most critical at the highest dose, $D_{\\mathrm{max}}$. The condition is that the intensity at the SRAF's center, $x_{\\mathrm{a,center}}$, must remain below the resist threshold: $\\tilde{I}(x_{\\mathrm{a,center}};N_{\\mathrm{waves}}) < I_{\\mathrm{th}} / D_{\\mathrm{max}}$ for all defocus values.\n        If both constraints are met for all defocus conditions, the SRAF placement $s$ is deemed feasible.\n\n    b.  **Objective Function Evaluation**: If $s$ is feasible, the objective function, which is the image log-slope (ILS) or simply the image slope magnitude $S$ at the feature edge, is calculated. This is performed at nominal focus ($N_{\\mathrm{waves}}=0$).\n        i.  The target intensity level for edge placement is $I_{\\mathrm{cross}} = I_{\\mathrm{th}}/D_{\\mathrm{nom}}$, where $D_{\\mathrm{nom}} = (D_{\\mathrm{min}} + D_{\\mathrm{max}})/2$.\n        ii. The edge position, $x^{\\star}$, is found by locating the coordinate near the main feature's right edge ($x \\approx W_{\\mathrm{main}}/2$) where $\\tilde{I}(x^{\\star}; 0) = I_{\\mathrm{cross}}$. This is done by finding the grid segment where the intensity crosses the threshold and using linear interpolation.\n        iii. The derivative of the intensity, $d\\tilde{I}/dx$, is computed numerically using a finite difference method (`numpy.gradient`).\n        iv. The slope magnitude $S = |\\frac{d\\tilde{I}}{dx}|$ is found by interpolating the computed gradient at the position $x^{\\star}$.\n\n4.  **Optimal Solution Selection**: The algorithm iterates through all candidate values of $s$, maintaining a record of the feasible $s$ that has yielded the highest slope $S$ so far. If no feasible value of $s$ is found within the search range, the result for that test case is $-1$, as per the problem specification. Otherwise, the optimal $s$ is reported, rounded to one decimal place. This procedure is repeated for each of the four test cases provided.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the SRAF placement problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: typical dry lithography\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.85, \"W_main\": 40.0, \"W_a\": 15.0,\n            \"I_th\": 0.30, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.20, \"s_range\": (20, 200, 2)\n        },\n        # Case 2: lower numerical aperture\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.50, \"W_main\": 40.0, \"W_a\": 15.0,\n            \"I_th\": 0.30, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.20, \"s_range\": (20, 200, 2)\n        },\n        # Case 3: high numerical aperture, tighter dose and larger defocus window\n        {\n            \"lambda_nm\": 193.0, \"NA\": 1.35, \"W_main\": 30.0, \"W_a\": 12.0,\n            \"I_th\": 0.25, \"D_min\": 0.95, \"D_max\": 1.05,\n            \"N_max\": 0.30, \"s_range\": (20, 200, 2)\n        },\n        # Case 4: narrow main line\n        {\n            \"lambda_nm\": 193.0, \"NA\": 0.93, \"W_main\": 20.0, \"W_a\": 10.0,\n            \"I_th\": 0.28, \"D_min\": 0.90, \"D_max\": 1.10,\n            \"N_max\": 0.25, \"s_range\": (20, 200, 2)\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_optimal_sraf_placement(**case)\n        if result == -1:\n            results.append(-1)\n        else:\n            results.append(round(result, 1))\n    \n    # Format the final output string\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\n\ndef find_optimal_sraf_placement(lambda_nm, NA, W_main, W_a, I_th, D_min, D_max, N_max, s_range):\n    \"\"\"\n    Computes the optimal SRAF placement for a single set of parameters.\n    \"\"\"\n    # 1. Numerical Grid Setup\n    N_points = 4096\n    dx = 1.0  # nm\n    L = N_points * dx\n    x = np.linspace(-L / 2, L / 2, N_points, endpoint=False)\n    k = np.fft.fftshift(np.fft.fftfreq(N_points, d=dx))\n\n    # 2. Parameter Calculation\n    k_c = NA / lambda_nm\n    defocus_set = [-N_max, -N_max / 2, 0, N_max / 2, N_max]\n    \n    D_nom = (D_min + D_max) / 2.0\n    I_cross = I_th / D_nom\n    \n    # Process window thresholds for normalized intensity\n    I_main_print_min = I_th / D_min\n    I_sraf_nonprint_max = I_th / D_max\n\n    # 3. Pre-compute Pupil Functions and Normalization\n    pupil_functions = {}\n    norm_factors = {}\n    \n    # Pupil for normalization\n    m_uniform = np.ones(N_points)\n    M_uniform_k = np.fft.fftshift(np.fft.fft(m_uniform))\n\n    for n_waves in defocus_set:\n        pupil = np.exp(1j * 2 * np.pi * n_waves * (k / k_c)**2)\n        pupil[np.abs(k) > k_c] = 0.0\n        pupil_functions[n_waves] = pupil\n\n        # Calculate normalization factor\n        E_uniform_field_k = M_uniform_k * pupil\n        e_uniform_x = np.fft.ifft(np.fft.ifftshift(E_uniform_field_k))\n        I_uniform_x = np.abs(e_uniform_x)**2\n        norm_factors[n_waves] = np.mean(I_uniform_x)\n        \n    # 4. Search for Optimal s\n    s_min, s_max, s_step = s_range\n    s_values = np.arange(s_min, s_max + s_step, s_step)\n    \n    best_s = -1\n    max_S = -1.0\n\n    for s in s_values:\n        # Create mask\n        m_x = np.zeros(N_points)\n        # Main feature\n        m_x[np.abs(x) = W_main / 2] = 1.0\n        # SRAF\n        sraf_start = W_main / 2 + s\n        sraf_end = sraf_start + W_a\n        m_x[(x >= sraf_start)  (x = sraf_end)] = 1.0\n        \n        M_k = np.fft.fftshift(np.fft.fft(m_x))\n\n        is_s_feasible = True\n        I_nominal = None\n        \n        for n_waves in defocus_set:\n            P_k = pupil_functions[n_waves]\n            norm = norm_factors[n_waves]\n\n            E_field_k = M_k * P_k\n            E_x = np.fft.ifft(np.fft.ifftshift(E_field_k))\n            I_x = np.abs(E_x)**2\n            I_tilde = I_x / norm\n\n            if n_waves == 0:\n                I_nominal = I_tilde\n\n            # Check main feature printing constraint\n            I_center = np.interp(0.0, x, I_tilde)\n            if I_center = I_main_print_min:\n                is_s_feasible = False\n                break\n            \n            # Check SRAF non-printing constraint\n            x_a_center = W_main / 2 + s + W_a / 2\n            I_sraf_center = np.interp(x_a_center, x, I_tilde)\n            if I_sraf_center >= I_sraf_nonprint_max:\n                is_s_feasible = False\n                break\n        \n        if is_s_feasible:\n            # Calculate slope S at nominal focus\n            x_search_start_idx = np.searchsorted(x, W_main / 2)\n            \n            I_minus_cross = I_nominal[x_search_start_idx:] - I_cross\n            \n            # Find first crossing index\n            cross_indices = np.where((I_minus_cross[:-1] > 0)  (I_minus_cross[1:] = 0))[0]\n            \n            if len(cross_indices) > 0:\n                idx = cross_indices[0] + x_search_start_idx\n                \n                # Linear interpolation to find x_star\n                x1, y1 = x[idx], I_nominal[idx]\n                x2, y2 = x[idx + 1], I_nominal[idx + 1]\n                x_star = x1 + (I_cross - y1) * (x2 - x1) / (y2 - y1)\n\n                # Calculate slope\n                grad_I = np.gradient(I_nominal, dx)\n                S = np.abs(np.interp(x_star, x, grad_I))\n\n                if S > max_S:\n                    max_S = S\n                    best_s = s\n    \n    return best_s\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "An optimized mask design is only as good as its manufactured counterpart. This exercise moves from ideal geometries to the practical realities of mask fabrication by analyzing the impact of corner rounding—an unavoidable manufacturing imperfection. You will simulate a 2D feature and quantify the sensitivity of the printed contour to this rounding, providing a tangible understanding of how mask errors propagate to Edge Placement Error (EPE) on the wafer .",
            "id": "4134381",
            "problem": "Consider a two-dimensional scalar aerial imaging model for a single square opening on a binary mask used in advanced semiconductor manufacturing. Let the mask transmission be approximated by a binary function $M(x,y) \\in \\{0,1\\}$, where $M(x,y)=1$ denotes the transparent region and $M(x,y)=0$ denotes the opaque region. The nominal transparent region is a square of side length $L$ centered at the origin, with edges parallel to the coordinate axes. Corner rounding of the mask is parameterized by a nonnegative radius $r$, meaning the square’s corners are replaced by quarter-circles of radius $r$ tangent to the edges. The aerial image $I(x,y)$ under partially coherent imaging is approximated using a space-invariant Gaussian point-spread function $\\mathrm{PSF}(x,y)$ with standard deviation $\\sigma$, such that $I(x,y)$ is modeled by the convolution $I(x,y) = (M * \\mathrm{PSF})(x,y)$, where the Gaussian kernel is normalized to unit integral. This approximation is widely used as a lumped model capturing the combined optical blur of the projection system and resist effects.\n\nEdge Placement Error (EPE) is defined here with respect to a resist threshold contour: for a specified threshold $T \\in (0,1)$, the printed contour is taken to be the level set $\\{(x,y) \\mid I(x,y) = T\\}$. For a given cutline, the local EPE is the scalar difference (in nanometers) between the threshold crossing location along that cutline and the crossing location for the reference case with zero corner rounding $r=0$. We consider two cutlines:\n- the horizontal axis along $y=0$ for $x \\ge 0$, and\n- the $45$ degree diagonal line $y=x$ for $x \\ge 0$ (angle specified in degrees).\n\nDefine the EPE sensitivities with respect to corner rounding $r$ as the finite-difference slopes\n$$\nS_{\\mathrm{axis}} = \\frac{\\Delta x_{\\mathrm{axis}}(r_{\\mathrm{pert}}) - \\Delta x_{\\mathrm{axis}}(0)}{r_{\\mathrm{pert}}},\n\\qquad\nS_{\\mathrm{diag}} = \\frac{\\Delta x_{\\mathrm{diag}}(r_{\\mathrm{pert}}) - \\Delta x_{\\mathrm{diag}}(0)}{r_{\\mathrm{pert}}},\n$$\nwhere $\\Delta x_{\\mathrm{axis}}(r)$ is the threshold crossing coordinate $x$ along $y=0$ for mask rounding $r$, and $\\Delta x_{\\mathrm{diag}}(r)$ is the threshold crossing coordinate $x$ along $y=x$ for mask rounding $r$. The reference mask rounding is $r=0$, and the perturbation is $r=r_{\\mathrm{pert}}0$. Both $S_{\\mathrm{axis}}$ and $S_{\\mathrm{diag}}$ must be expressed in nanometers per nanometer (i.e., as decimal ratios). All distances must be computed and reported in nanometers (nm).\n\nStarting from foundational principles in Fourier optics and linear systems (the convolution representation for $I(x,y)$) together with a threshold resist model, write a program that:\n1. Constructs a binary mask $M(x,y)$ on a uniform Cartesian grid with spatial sampling pitch $d$ (in nanometers) over a square field of view large enough to minimize boundary artifacts in the convolution. The rounded-corner square should be implemented exactly as the union of axis-aligned strips and quarter-circle corner patches: inside the original nominal square, a point $(x,y)$ is deemed transparent for mask rounding radius $r$ if either $|x| \\le L/2 - r$ or $|y| \\le L/2 - r$, or it lies inside the quarter circle centered at $(\\operatorname{sgn}(x)\\,(L/2 - r), \\operatorname{sgn}(y)\\,(L/2 - r))$ with radius $r$.\n2. Forms a normalized Gaussian point-spread function $\\mathrm{PSF}(x,y)$ with standard deviation $\\sigma$ (in nanometers).\n3. Computes the aerial image $I(x,y)$ via convolution $M * \\mathrm{PSF}$ and extracts the threshold crossing $x$-locations along the two specified cutlines using linear interpolation on the sampled profiles. The crossing must be the first position moving outward from the origin where the sampled aerial image falls below $T$.\n4. Computes the finite-difference EPE sensitivities $S_{\\mathrm{axis}}$ and $S_{\\mathrm{diag}}$ using $r=0$ and $r=r_{\\mathrm{pert}}$.\n\nEnsure scientific realism by:\n- Justifying the Gaussian kernel as a lumped approximation consistent with scalar diffraction and resist blur.\n- Choosing a field of view and sampling pitch that prevent aliasing and edge effects from corrupting the threshold crossing determination.\n\nAngle specification: use $45$ degrees for the diagonal line. Report all distances in nanometers, and report the sensitivities as decimal ratios in nanometers per nanometer.\n\nTest Suite:\nImplement and solve the following four test cases, each defined by $(L, r_{\\mathrm{pert}}, \\sigma, T, d)$ with all quantities in nanometers and $T$ dimensionless:\n- Case $1$: $(L, r_{\\mathrm{pert}}, \\sigma, T, d) = (100, 5, 8, 0.5, 1)$.\n- Case $2$: $(L, r_{\\mathrm{pert}}, \\sigma, T, d) = (100, 5, 20, 0.5, 1)$.\n- Case $3$: $(L, r_{\\mathrm{pert}}, \\sigma, T, d) = (80, 2, 8, 0.4, 1)$.\n- Case $4$: $(L, r_{\\mathrm{pert}}, \\sigma, T, d) = (120, 10, 12, 0.6, 1)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is a two-element list $[S_{\\mathrm{axis}}, S_{\\mathrm{diag}}]$ in nanometers per nanometer, using decimal representation. For example, the output format must be\n$[ [s_{1,\\mathrm{axis}}, s_{1,\\mathrm{diag}}], [s_{2,\\mathrm{axis}}, s_{2,\\mathrm{diag}}], [s_{3,\\mathrm{axis}}, s_{3,\\mathrm{diag}}], [s_{4,\\mathrm{axis}}, s_{4,\\mathrm{diag}}] ]$,\nwith no additional text.",
            "solution": "The problem statement has been critically validated and is determined to be scientifically grounded, well-posed, and objective. It presents a formalizable computational problem rooted in the standard principles of scalar diffraction theory and semiconductor lithography process modeling. All parameters are clearly defined, and the test cases are physically realistic. We may therefore proceed with a complete solution.\n\nThe problem requires the calculation of the sensitivity of a printed feature's edge placement to mask corner rounding. This is a fundamental task in lithography process modeling, quantifying how manufacturing imperfections on the mask translate to errors on the wafer. The solution is developed from first principles, based on the provided linear systems model of aerial image formation.\n\n**1. Theoretical Framework**\n\nThe core of the model is the representation of the aerial image intensity, $I(x,y)$, as the convolution of the mask transmission function, $M(x,y)$, and a Point-Spread Function (PSF), $\\mathrm{PSF}(x,y)$:\n$$I(x,y) = (M * \\mathrm{PSF})(x,y) = \\int_{-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} M(x', y') \\, \\mathrm{PSF}(x-x', y-y') \\, dx' dy'$$\nThis equation describes a Linear, Space-Invariant (LSI) system, which is a standard approximation for optical imaging systems operating under partially coherent illumination.\n\nThe mask function, $M(x,y)$, is binary, taking a value of $1$ for transparent regions and $0$ for opaque regions. The nominal feature is a square of side length $L$, centered at the origin. Corner rounding is modeled by a radius $r$, which defines the extent of material removed from the ideal sharp corners.\n\nThe problem specifies a Gaussian $\\mathrm{PSF}$, a scientifically justified choice. In a real optical projection system, the image is blurred by multiple effects: lens aberrations, diffraction limits, illumination partial coherence, and diffusion processes within the photoresist. A Gaussian function $\\mathrm{PSF}(x,y) = \\frac{1}{2\\pi\\sigma^2} \\exp\\left(-\\frac{x^2+y^2}{2\\sigma^2}\\right)$ serves as a powerful \"lumped parameter\" model. Its use is motivated by the Central Limit Theorem; the cumulative effect of many small, independent blurring mechanisms tends toward a Gaussian distribution. The standard deviation, $\\sigma$, thus encapsulates the total blur of the lithographic process. The PSF is normalized such that its integral over the plane is unity, conserving energy.\n\nThe final printed pattern on the wafer is determined by the interaction of the aerial image with the photoresist. The problem adopts a simple but effective threshold model, where the boundary of the printed feature is the level set contour defined by $I(x,y) = T$, for a constant threshold $T \\in (0,1)$.\n\n**2. Numerical Implementation Strategy**\n\nTo compute the solution, we must translate the continuous mathematical model into a discrete numerical algorithm. This involves discretization of space, numerical convolution, and interpolation.\n\n**2.1. Discretization and Grid Setup**\nThe continuous functions $M(x,y)$ and $\\mathrm{PSF}(x,y)$ are sampled on a uniform Cartesian grid of size $N \\times N$ points with a spatial sampling pitch of $d$. To ensure numerical accuracy and avoid artifacts, several choices are critical:\n- **Field of View**: The simulation domain must be large enough to contain the mask feature and the significant extent of the PSF, with additional padding to prevent wrap-around errors (aliasing) during convolution via the Fast Fourier Transform (FFT). The image size is roughly the sum of the mask size and the PSF's effective size. A safe choice is a domain twice the extent of the final image. A grid of $N=513$ points with $d=1$ nm provides a field of view of $513 \\times 513 \\, \\mathrm{nm}^2$, which is ample for the given parameters (e.g., for $L=120$ nm and $\\sigma=20$ nm, the image extends to about $\\pm(L/2 + 3\\sigma) = \\pm 120$ nm).\n- **Sampling Pitch**: The pitch $d=1$ nm is sufficiently small compared to the characteristic lengths of the problem ($L$, $r_{\\mathrm{pert}}$, and $\\sigma$) to accurately represent the geometry and capture the variations in the image.\n- **Centering**: An odd grid size ($N=513$) is chosen so that the origin $(0,0)$ coincides precisely with the central pixel of the grid, simplifying the extraction of data along the principal axes.\n\n**2.2. Mask Generation**\nA function is implemented to generate the $N \\times N$ matrix representing the mask, $M(x,y)$, for a given side length $L$ and corner rounding radius $r$. For each grid point $(x_i, y_j)$, the value $M(x_i,y_j)$ is set to $1$ if the point lies within the rounded square, and $0$ otherwise. The geometry is constructed as specified: a point $(x,y)$ inside the nominal $L \\times L$ square is transparent if:\n1. $|x| \\le L/2 - r$, OR\n2. $|y| \\le L/2 - r$, OR\n3. It lies within a corner-rounding quarter-circle. For a point in a corner region (e.g., $x  L/2-r$ and $y  L/2-r$), the condition is $(x - (L/2-r))^2 + (y - (L/2-r))^2 \\le r^2$. This logic is applied symmetrically to all four quadrants.\n\n**2.3. PSF and Convolution**\nThe Gaussian PSF is also generated on the $N \\times N$ grid. The discrete kernel is normalized by dividing by the sum of its elements, ensuring that the discrete convolution preserves the mean intensity of the mask. The convolution is performed efficiently in the frequency domain using the convolution theorem, which states that $\\mathcal{F}\\{M * \\mathrm{PSF}\\} = \\mathcal{F}\\{M\\} \\cdot \\mathcal{F}\\{\\mathrm{PSF}\\}$, where $\\mathcal{F}$ denotes the Fourier Transform. The `scipy.signal.fftconvolve` function is employed, which internally handles the FFTs, element-wise multiplication, and inverse FFT, and correctly manages padding and output centering (`mode='same'`).\n\n**2.4. Threshold Crossing and Interpolation**\nAfter computing the 2D aerial image $I(x,y)$, 1D profiles are extracted along two cutlines for $x \\ge 0$:\n- **Axis**: The horizontal line $y=0$. This corresponds to the central row of the image matrix, starting from the center pixel.\n- **Diagonal**: The line $y=x$. This corresponds to the main diagonal of the image matrix, starting from the center pixel.\n\nThe problem defines the Edge Placement Error (EPE) based on the position where the image intensity crosses the threshold $T$. Since the image is sampled on a discrete grid, the exact crossing point lies between two grid points. We find the first adjacent pair of points $(p_i, p_{i+1})$ along a cutline profile where the intensity values bracket the threshold $T$ (i.e., $I(p_i)  T$ and $I(p_{i+1}) \\le T$). The sub-grid crossing coordinate $x_c$ is then found using linear interpolation:\n$$x_c = x_i + (x_{i+1} - x_i) \\frac{T - I(x_i)}{I(x_{i+1}) - I(x_i)}$$\nFor the diagonal cutline $y=x$, this formula is applied to the $x$-coordinates of the points on the diagonal.\n\n**2.5. Sensitivity Calculation**\nThe final step is to compute the EPE sensitivities. For each test case, the entire procedure (mask generation, convolution, and edge finding) is executed twice:\n1. **Reference Case**: with corner rounding $r=0$. This yields edge positions $\\Delta x_{\\mathrm{axis}}(0)$ and $\\Delta x_{\\mathrm{diag}}(0)$.\n2. **Perturbed Case**: with corner rounding $r=r_{\\mathrm{pert}}$. This yields edge positions $\\Delta x_{\\mathrm{axis}}(r_{\\mathrm{pert}})$ and $\\Delta x_{\\mathrm{diag}}(r_{\\mathrm{pert}})$.\n\nThe sensitivities are then calculated using the provided finite-difference formulas:\n$$S_{\\mathrm{axis}} = \\frac{\\Delta x_{\\mathrm{axis}}(r_{\\mathrm{pert}}) - \\Delta x_{\\mathrm{axis}}(0)}{r_{\\mathrm{pert}}}$$\n$$S_{\\mathrm{diag}} = \\frac{\\Delta x_{\\mathrm{diag}}(r_{\\mathrm{pert}}) - \\Delta x_{\\mathrm{diag}}(0)}{r_{\\mathrm{pert}}}$$\nThe results are reported as decimal ratios in units of nanometers per nanometer (nm/nm). A negative sensitivity indicates that increasing the corner rounding (i.e., removing mask area) causes the printed edge to pull inwards towards the feature center.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.signal import fftconvolve\n\ndef create_mask(L, r, N, d):\n    \"\"\"\n    Creates a binary mask for a square with rounded corners.\n\n    Args:\n        L (float): Nominal side length of the square in nm.\n        r (float): Corner rounding radius in nm.\n        N (int): Number of grid points along one dimension (should be odd).\n        d (float): Grid sampling pitch in nm.\n\n    Returns:\n        numpy.ndarray: A 2D array representing the binary mask.\n    \"\"\"\n    if r  0:\n        raise ValueError(\"Corner radius r must be non-negative.\")\n    if r > L / 2:\n        raise ValueError(\"Corner radius r cannot be larger than L/2.\")\n        \n    half_width = (N - 1) / 2 * d\n    coords = np.linspace(-half_width, half_width, N)\n    X, Y = np.meshgrid(coords, coords)\n\n    # Initialize mask as opaque\n    mask = np.zeros((N, N), dtype=np.float64)\n\n    # Condition for being inside the central cross shape (union of two strips)\n    is_center_region = (np.abs(X) = L / 2 - r) | (np.abs(Y) = L / 2 - r)\n\n    # Condition for being in one of the four corner regions\n    is_corner_region = (np.abs(X) > L / 2 - r)  (np.abs(Y) > L / 2 - r)\n    \n    # Calculate distance from the relevant corner circle center\n    # The center of the rounding circle for each corner\n    corner_centers_x = np.sign(X) * (L / 2 - r)\n    corner_centers_y = np.sign(Y) * (L / 2 - r)\n    \n    # Squared distance from the center of the corner circle\n    dist_sq_from_corner_center = (X - corner_centers_x)**2 + (Y - corner_centers_y)**2\n    is_in_corner_circle = dist_sq_from_corner_center = r**2\n\n    # A point is transparent if it's in the central cross or in a rounded corner patch.\n    # We must also ensure we are within the original L x L bounding box.\n    # The geometry definition implies this, as checked in the analysis.\n    inside_nominal_square = (np.abs(X) = L/2)  (np.abs(Y) = L/2)\n    \n    transparent_region = (is_center_region | (is_corner_region  is_in_corner_circle))  inside_nominal_square\n    mask[transparent_region] = 1.0\n\n    return mask\n\ndef create_psf(sigma, N, d):\n    \"\"\"\n    Creates a normalized 2D Gaussian Point-Spread Function (PSF).\n\n    Args:\n        sigma (float): Standard deviation of the Gaussian in nm.\n        N (int): Number of grid points along one dimension.\n        d (float): Grid sampling pitch in nm.\n\n    Returns:\n        numpy.ndarray: A 2D array representing the normalized PSF.\n    \"\"\"\n    half_width = (N - 1) / 2 * d\n    coords = np.linspace(-half_width, half_width, N)\n    X, Y = np.meshgrid(coords, coords)\n    \n    R2 = X**2 + Y**2\n    psf = np.exp(-R2 / (2 * sigma**2))\n    \n    # Normalize the discrete kernel to have a sum of 1\n    psf /= np.sum(psf)\n    \n    return psf\n\ndef find_threshold_crossing(profile, x_coords, T):\n    \"\"\"\n    Finds the threshold crossing point in a 1D profile using linear interpolation.\n\n    Args:\n        profile (numpy.ndarray): 1D array of image intensity values.\n        x_coords (numpy.ndarray): 1D array of corresponding x-coordinates.\n        T (float): The intensity threshold.\n\n    Returns:\n        float: The interpolated x-coordinate of the threshold crossing.\n    \"\"\"\n    # Find the indices where the profile crosses the threshold (from above to below)\n    indices = np.where((profile[:-1] > T)  (profile[1:] = T))[0]\n    \n    if len(indices) == 0:\n        # If no crossing is found, return NaN. This indicates a potential issue.\n        return np.nan\n\n    # We need the first crossing moving away from the origin\n    i = indices[0]\n    \n    x0, x1 = x_coords[i], x_coords[i+1]\n    y0, y1 = profile[i], profile[i+1]\n\n    if y1 == y0: # Avoid division by zero, though unlikely for a smooth profile\n        return x0\n        \n    x_crossing = x0 + (x1 - x0) * (T - y0) / (y1 - y0)\n    return x_crossing\n\ndef solve_case(L, r_pert, sigma, T, d):\n    \"\"\"\n    Computes EPE sensitivities for a single test case.\n    \"\"\"\n    # Use an odd grid size for a well-defined center pixel\n    N = 513\n    \n    center_idx = (N - 1) // 2\n    half_width = center_idx * d\n    coords = np.linspace(-half_width, half_width, N)\n\n    # 1. Create the common PSF\n    psf = create_psf(sigma, N, d)\n\n    # --- 2. Reference case (r = 0) ---\n    mask_ref = create_mask(L, 0.0, N, d)\n    image_ref = fftconvolve(mask_ref, psf, mode='same')\n    \n    # Horizontal axis cutline\n    profile_ref_axis = image_ref[center_idx, center_idx:]\n    x_coords_axis = coords[center_idx:]\n    x_axis_ref = find_threshold_crossing(profile_ref_axis, x_coords_axis, T)\n    \n    # Diagonal y=x cutline\n    profile_ref_diag = image_ref.diagonal()[center_idx:]\n    x_coords_diag = coords[center_idx:] # x-coordinates along the diagonal\n    x_diag_ref = find_threshold_crossing(profile_ref_diag, x_coords_diag, T)\n\n    # --- 3. Perturbed case (r = r_pert) ---\n    mask_pert = create_mask(L, r_pert, N, d)\n    image_pert = fftconvolve(mask_pert, psf, mode='same')\n    \n    # Horizontal axis cutline\n    profile_pert_axis = image_pert[center_idx, center_idx:]\n    x_axis_pert = find_threshold_crossing(profile_pert_axis, x_coords_axis, T)\n    \n    # Diagonal y=x cutline\n    profile_pert_diag = image_pert.diagonal()[center_idx:]\n    x_diag_pert = find_threshold_crossing(profile_pert_diag, x_coords_diag, T)\n    \n    # --- 4. Compute Sensitivities ---\n    if r_pert == 0:\n        # This case is excluded by the problem statement (r_pert > 0)\n        # but handle for robustness.\n        s_axis = 0.0\n        s_diag = 0.0\n    else:\n        s_axis = (x_axis_pert - x_axis_ref) / r_pert\n        s_diag = (x_diag_pert - x_diag_ref) / r_pert\n        \n    return [s_axis, s_diag]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # (L, r_pert, sigma, T, d)\n    test_cases = [\n        (100.0, 5.0, 8.0, 0.5, 1.0),\n        (100.0, 5.0, 20.0, 0.5, 1.0),\n        (80.0, 2.0, 8.0, 0.4, 1.0),\n        (120.0, 10.0, 12.0, 0.6, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        L, r_pert, sigma, T, d = case\n        result = solve_case(L, r_pert, sigma, T, d)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The format \"[s1, s2],[s3, s4]\" is generated by this print structure.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}