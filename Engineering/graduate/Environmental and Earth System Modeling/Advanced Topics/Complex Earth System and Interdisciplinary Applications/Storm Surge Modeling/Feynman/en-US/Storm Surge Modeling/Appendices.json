{
    "hands_on_practices": [
        {
            "introduction": "Understanding storm surge begins with the fundamental physics of how wind transfers momentum to the water surface, causing it to pile up against the coast. This idealized exercise strips the problem down to its essential components—a balance between wind stress and the opposing pressure gradient—to derive the classic wind setup formula. By working through this derivation , you will build a strong intuition for the key physical parameters that govern the magnitude of a storm surge.",
            "id": "3918126",
            "problem": "Consider a one-dimensional, cross-shore, barotropic equilibrium over a uniform continental shelf of width $L$, extending from an offshore point at $x=0$ to a coastline at $x=L$. The bed depth varies linearly as $h(x)=h_o - s x$, where $h_o>0$ is the offshore depth at $x=0$, $s>0$ is the constant bed slope (with depth decreasing toward the coast), and $h_c=h(L)=h_o-sL>0$ is the (finite) coastal depth at $x=L$. A spatially uniform, steady onshore wind stress of magnitude $\\tau_w$ acts in the positive $x$-direction. The flow is assumed alongshore uniform, hydrostatic, and governed by the depth-integrated, barotropic shallow-water equations. The bottom stress is parameterized by $\\tau_b = \\rho C_f u|u|$, where $\\rho$ is the water density, $C_f$ is a dimensionless drag coefficient, and $u(x)$ is the depth-averaged cross-shore velocity (positive toward the coast). Ignore the Coriolis force, atmospheric pressure gradients, and horizontal mixing other than the bottom stress.\n\nStarting from the depth-integrated momentum and continuity equations and enforcing physically appropriate boundary conditions at the coast, derive the equilibrium sea surface setup $\\eta(x)$ relative to the offshore level $\\eta(0)=0$. Then compute the closed-form expression for the equilibrium surge height at the coast, $\\eta(L)$, in terms of $\\tau_w$, $\\rho$, $g$, $s$, $h_o$, and $h_c$. Express the final surge height in meters. No numerical values are provided; your final answer must be an analytic expression only, with no rounding required.",
            "solution": "The user wants me to solve a fluid dynamics problem. I will first validate the problem statement and then proceed to a solution if it is valid.\n\n### Step 1: Extract Givens\n- **Geometry**: One-dimensional, cross-shore model from $x=0$ (offshore) to $x=L$ (coastline).\n- **Bathymetry**: Bed depth is given by $h(x) = h_o - s x$, where $h_o > 0$ is the offshore depth, $s>0$ is the constant bed slope, and $h_c = h(L) = h_o - sL > 0$ is the coastal depth.\n- **Forcing**: A spatially uniform, steady onshore wind stress of magnitude $\\tau_w$ acts in the positive $x$-direction.\n- **Governing Physics**: The flow is governed by the depth-integrated, barotropic shallow-water equations.\n- **Assumptions**: The flow is alongshore uniform, hydrostatic, and steady state (equilibrium). Coriolis force, atmospheric pressure gradients, and horizontal mixing (other than bottom stress) are neglected.\n- **Bottom Stress**: Parameterized as $\\tau_b = \\rho C_f u|u|$, where $\\rho$ is water density, $C_f$ is a dimensionless drag coefficient, and $u(x)$ is the depth-averaged cross-shore velocity.\n- **Boundary Condition**: The sea surface setup $\\eta(x)$ is relative to the offshore level, so $\\eta(0) = 0$. A physically appropriate boundary condition is required at the coast ($x=L$).\n- **Objective**: Derive the equilibrium sea surface setup $\\eta(x)$ and compute the closed-form expression for the equilibrium surge height at the coast, $\\eta(L)$, in terms of $\\tau_w$, $\\rho$, $g$, $s$, $h_o$, and $h_c$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is a classic idealized model of wind-driven storm surge, based on the well-established shallow-water equations. The setup, assumptions, and parameterizations are standard in physical oceanography and coastal engineering. The problem is scientifically sound.\n- **Well-Posed**: The problem specifies the governing equations (implicitly), geometry, forcing, dissipation, and one boundary condition $\\eta(0)=0$. It asks for a \"physically appropriate\" boundary condition at the coast. For a solid boundary like a coastline, the no-flux condition $u(L)=0$ is physically required. With this condition, the problem becomes well-defined and a unique, stable solution for the steady state can be determined.\n- **Objective**: The problem is stated in precise, objective language with clearly defined variables and goals.\n\nThe problem does not exhibit any of the flaws listed in the user's instructions (e.g., scientific unsoundness, missing information, vagueness). The prompt to \"Express the final surge height in meters\" while also stating \"No numerical values are provided\" is a minor inconsistency, but the overriding instruction is to provide an \"analytic expression only,\" which is unambiguous.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed to derive the solution.\n\nThe analysis begins with the one-dimensional, depth-integrated shallow-water equations for conservation of mass (continuity) and momentum.\n\nThe continuity equation is:\n$$\n\\frac{\\partial \\eta}{\\partial t} + \\frac{\\partial}{\\partial x} \\left[ (h+\\eta) u \\right] = 0\n$$\nThe momentum equation is:\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = -g \\frac{\\partial \\eta}{\\partial x} + \\frac{\\tau_w}{\\rho(h+\\eta)} - \\frac{\\tau_b}{\\rho(h+\\eta)}\n$$\nHere, $\\eta(x,t)$ is the sea surface elevation, $u(x,t)$ is the depth-averaged cross-shore velocity, $h(x)$ is the still water depth, $g$ is the acceleration due to gravity, $\\rho$ is the water density, $\\tau_w$ is the surface wind stress, and $\\tau_b$ is the bottom friction stress.\n\nThe problem specifies a steady-state (equilibrium) solution, which means all time derivatives are zero, i.e., $\\frac{\\partial}{\\partial t} = 0$.\nThe continuity equation simplifies to:\n$$\n\\frac{d}{dx} \\left[ (h(x)+\\eta(x)) u(x) \\right] = 0\n$$\nThis implies that the volume flux per unit width, $Q(x) = (h(x)+\\eta(x)) u(x)$, is constant for all $x \\in [0, L]$.\n\nAt the coastline, $x=L$, there is a solid boundary. The physically appropriate boundary condition is that there can be no flow into or out of the land, which is the no-flux condition:\n$$\nu(L) = 0\n$$\nApplying this condition to the constant volume flux, we find:\n$$\nQ(L) = (h(L)+\\eta(L)) u(L) = (h(L)+\\eta(L)) \\cdot 0 = 0\n$$\nSince the flux $Q(x)$ is constant everywhere, it must be zero for all $x \\in [0, L]$. Therefore,\n$$\n(h(x)+\\eta(x)) u(x) = 0\n$$\nThe total water depth, $h(x) + \\eta(x)$, is positive everywhere on the domain $[0,L]$. The problem states $h_c = h(L) > 0$, and while the surge $\\eta(x)$ can be positive or negative, for a typical onshore wind setup, $\\eta(x)$ will be non-negative. Thus, $h(x) + \\eta(x) > 0$. This requires that the velocity must be zero everywhere:\n$$\nu(x) = 0 \\quad \\text{for all } x \\in [0, L]\n$$\n\nWith $u(x)=0$, the steady-state momentum equation simplifies significantly. The advective term $u \\frac{du}{dx}$ is zero. The bottom stress, given by $\\tau_b = \\rho C_f u|u|$, is also zero. The momentum equation reduces to a balance between the pressure gradient force due to the sea surface slope and the wind stress:\n$$\n0 = -g \\frac{d\\eta}{dx} + \\frac{\\tau_w}{\\rho(h(x)+\\eta(x))}\n$$\nRearranging this gives a first-order ordinary differential equation for the sea surface elevation $\\eta(x)$:\n$$\n\\frac{d\\eta}{dx} = \\frac{\\tau_w}{\\rho g (h(x)+\\eta(x))}\n$$\nThis is a nonlinear ODE due to the $\\eta(x)$ term in the denominator. To obtain a closed-form analytical solution as requested, a standard and physically justified approximation is made. For most realistic continental shelf scenarios, the surge height is much smaller than the water depth, i.e., $\\eta(x) \\ll h(x)$. This allows for the linearization of the denominator:\n$$\nh(x) + \\eta(x) \\approx h(x)\n$$\nThe momentum equation becomes:\n$$\n\\frac{d\\eta}{dx} \\approx \\frac{\\tau_w}{\\rho g h(x)}\n$$\nWe are given the linear profile for the bed depth: $h(x) = h_o - s x$. Substituting this into the differential equation:\n$$\n\\frac{d\\eta}{dx} = \\frac{\\tau_w}{\\rho g (h_o - s x)}\n$$\nTo find $\\eta(x)$, we integrate this equation with respect to $x$ from the offshore boundary at $x=0$ to an arbitrary position $x$:\n$$\n\\int_{0}^{\\eta(x)} d\\eta' = \\int_{0}^{x} \\frac{\\tau_w}{\\rho g (h_o - s x')} dx'\n$$\nThe left side is simply $\\eta(x) - \\eta(0)$. We are given the boundary condition $\\eta(0)=0$. The constants $\\tau_w$, $\\rho$, $g$, and $s$ can be taken outside the integral on the right:\n$$\n\\eta(x) = \\frac{\\tau_w}{\\rho g} \\int_{0}^{x} \\frac{1}{h_o - s x'} dx'\n$$\nThe integral is evaluated as:\n$$\n\\int_{0}^{x} \\frac{1}{h_o - s x'} dx' = \\left[ -\\frac{1}{s} \\ln(h_o - s x') \\right]_{0}^{x}\n$$\n$$\n= -\\frac{1}{s} \\left[ \\ln(h_o - s x) - \\ln(h_o - s \\cdot 0) \\right]\n$$\n$$\n= -\\frac{1}{s} \\left[ \\ln(h_o - s x) - \\ln(h_o) \\right] = \\frac{1}{s} \\left[ \\ln(h_o) - \\ln(h_o - s x) \\right]\n$$\nUsing the properties of logarithms, this simplifies to:\n$$\n= \\frac{1}{s} \\ln\\left(\\frac{h_o}{h_o - s x}\\right)\n$$\nSubstituting this back into the expression for $\\eta(x)$:\n$$\n\\eta(x) = \\frac{\\tau_w}{\\rho g s} \\ln\\left(\\frac{h_o}{h_o - s x}\\right)\n$$\nThis is the expression for the equilibrium sea surface setup across the shelf. To find the surge height at the coast, we evaluate this expression at $x=L$:\n$$\n\\eta(L) = \\frac{\\tau_w}{\\rho g s} \\ln\\left(\\frac{h_o}{h_o - s L}\\right)\n$$\nThe problem requires the final answer to be expressed in terms of $h_c$, the coastal depth, where $h_c = h(L) = h_o - sL$. Substituting $h_c$ for the term $h_o - sL$ in the denominator of the logarithm's argument gives the final result:\n$$\n\\eta(L) = \\frac{\\tau_w}{\\rho g s} \\ln\\left(\\frac{h_o}{h_c}\\right)\n$$\nThis is the closed-form analytical expression for the storm surge at the coast under the given assumptions.",
            "answer": "$$\n\\boxed{\\frac{\\tau_w}{\\rho g s} \\ln\\left(\\frac{h_o}{h_c}\\right)}\n$$"
        },
        {
            "introduction": "When we translate the continuous governing equations into a discrete numerical model, we must obey certain rules to prevent the solution from becoming unstable. The Courant-Friedrichs-Lewy (CFL) condition is the most critical of these rules for explicit time-stepping schemes, linking the timestep, grid size, and wave propagation speed. This practice  provides a concrete calculation of the maximum stable timestep for a model using an unstructured grid, a core skill for any computational modeler.",
            "id": "3918129",
            "problem": "A storm surge model is solved on an unstructured triangular mesh using an explicit finite-volume method for the two-dimensional depth-averaged Shallow Water Equations (SWE). To ensure stability, the timestep must satisfy the Courant-Friedrichs-Lewy (CFL) condition appropriate for hyperbolic conservation laws, with the signal speed determined by the depth-averaged flow speed and gravity wave speed. The characteristic cell length is taken as the triangle inradius, defined for a triangle with area $A$ and perimeter $P$ as $R = \\frac{2A}{P}$.\n\nConsider three representative triangular cells in a coastal channel, with vertex coordinates (in meters), cell-averaged depths (in meters), and cell-averaged velocities (in meters per second) given by:\n- Cell $1$: vertices at $(0,0)$, $(100,0)$, $(0,100)$; $H_{1} = 10$; $\\mathbf{u}_{1} = (1.2,\\,0.8)$.\n- Cell $2$: vertices at $(100,0)$, $(200,0)$, $(100,100)$; $H_{2} = 4$; $\\mathbf{u}_{2} = (2.6,\\,0.4)$.\n- Cell $3$: vertices at $(0,100)$, $(100,100)$, $(0,200)$; $H_{3} = 15$; $\\mathbf{u}_{3} = (0.5,\\,-0.2)$.\n\nUse gravitational acceleration $g = 9.81$ m/s$^2$ and a chosen Courant number $\\text{CFL} = 0.75$. Starting from first principles for the SWE and the CFL stability requirement, derive an expression for a stable timestep $\\Delta t$ in terms of the maximum local signal speed and the characteristic length $R$ of each cell. Then, for the given data, compute the numerically stable timestep $\\Delta t$ by identifying the most restrictive cell. Round your final answer to four significant figures and express it in seconds.",
            "solution": "The problem statement has been validated and found to be scientifically grounded, well-posed, and free of inconsistencies or ambiguities. It presents a standard application of the Courant-Friedrichs-Lewy (CFL) stability condition to the Shallow Water Equations (SWE), a fundamental concept in computational fluid dynamics and geophysical modeling. All necessary data are provided. A complete solution can be constructed.\n\nThe stability of an explicit finite-volume scheme for hyperbolic conservation laws, such as the two-dimensional depth-averaged Shallow Water Equations, is governed by the CFL condition. This condition states that the numerical domain of dependence must contain the physical domain of dependence. For a given cell $i$, the timestep $\\Delta t_i$ must satisfy:\n$$ \\Delta t_i \\le \\text{CFL} \\frac{R_i}{S_{\\text{max},i}} $$\nwhere $\\text{CFL}$ is the Courant number, $R_i$ is the characteristic length of the cell, and $S_{\\text{max},i}$ is the maximum local signal speed in that cell. For a scheme to be stable over the entire computational domain, the global timestep $\\Delta t$ must be less than or equal to the minimum of all local timesteps:\n$$ \\Delta t = \\min_{i} (\\Delta t_i) = \\text{CFL} \\times \\min_{i} \\left( \\frac{R_i}{S_{\\text{max},i}} \\right) $$\n\nFirst, we must derive the expression for the maximum signal speed, $S_{\\text{max}}$. For the SWE, signals propagate via advection with the fluid flow and as gravity waves. The speed of a shallow water gravity wave, $c$, is given by:\n$$ c = \\sqrt{gH} $$\nwhere $g$ is the acceleration due to gravity and $H$ is the total water depth. The fluid velocity is a vector $\\mathbf{u} = (u, v)$, with a magnitude $|\\mathbf{u}| = \\sqrt{u^2 + v^2}$. The fastest a signal can propagate occurs when a gravity wave travels in the same direction as the fluid flow. Therefore, the maximum signal speed is the sum of the flow speed magnitude and the gravity wave speed:\n$$ S_{\\text{max}} = |\\mathbf{u}| + c = |\\mathbf{u}| + \\sqrt{gH} $$\n\nThe problem defines the characteristic length $R$ for a triangular cell as its inradius:\n$$ R = \\frac{2A}{P} $$\nwhere $A$ is the area of the triangle and $P$ is its perimeter.\n\nCombining these elements, the limiting timestep is determined by the cell that yields the minimum value for the ratio $\\frac{R}{S_{\\text{max}}}$. We will now compute this value for each of the three given cells.\n\nFirst, we calculate the geometric properties of the triangular cells. All three cells are geometrically congruent right-angled isosceles triangles. Let's compute the properties for Cell $1$ with vertices at $V_1(0,0)$, $V_2(100,0)$, and $V_3(0,100)$.\nThe lengths of the sides are:\n- $s_1 = \\text{distance}(V_1, V_2) = \\sqrt{(100-0)^2 + (0-0)^2} = 100$ meters.\n- $s_2 = \\text{distance}(V_1, V_3) = \\sqrt{(0-0)^2 + (100-0)^2} = 100$ meters.\n- $s_3 = \\text{distance}(V_2, V_3) = \\sqrt{(100-0)^2 + (0-100)^2} = \\sqrt{100^2 + (-100)^2} = \\sqrt{20000} = 100\\sqrt{2}$ meters.\n\nThe perimeter $P$ is the sum of the side lengths:\n$$ P = 100 + 100 + 100\\sqrt{2} = 100(2 + \\sqrt{2}) \\text{ meters} $$\nThe area $A$ of this right triangle is:\n$$ A = \\frac{1}{2} \\times \\text{base} \\times \\text{height} = \\frac{1}{2} \\times 100 \\times 100 = 5000 \\text{ m}^2 $$\nThe inradius $R$ is therefore:\n$$ R = \\frac{2A}{P} = \\frac{2 \\times 5000}{100(2 + \\sqrt{2})} = \\frac{100}{2 + \\sqrt{2}} = \\frac{100(2 - \\sqrt{2})}{(2 + \\sqrt{2})(2 - \\sqrt{2})} = \\frac{100(2 - \\sqrt{2})}{4-2} = 50(2 - \\sqrt{2}) \\text{ meters} $$\nSince all three cells are geometrically identical, $R_1 = R_2 = R_3 = R = 50(2 - \\sqrt{2})$ m.\n\nNow, we compute the maximum signal speed $S_{\\text{max},i}$ for each cell using the given depth $H_i$, velocity $\\mathbf{u}_i$, and $g = 9.81$ m/s$^2$.\n\n**Cell 1:** $H_1 = 10$ m, $\\mathbf{u}_1 = (1.2, 0.8)$ m/s.\n- Flow speed: $|\\mathbf{u}_1| = \\sqrt{1.2^2 + 0.8^2} = \\sqrt{1.44 + 0.64} = \\sqrt{2.08}$ m/s.\n- Wave speed: $c_1 = \\sqrt{g H_1} = \\sqrt{9.81 \\times 10} = \\sqrt{98.1}$ m/s.\n- Max signal speed: $S_{\\text{max},1} = \\sqrt{2.08} + \\sqrt{98.1}$ m/s.\n- Ratio: $\\frac{R_1}{S_{\\text{max},1}} = \\frac{50(2 - \\sqrt{2})}{\\sqrt{2.08} + \\sqrt{98.1}}$ s.\n\n**Cell 2:** $H_2 = 4$ m, $\\mathbf{u}_2 = (2.6, 0.4)$ m/s.\n- Flow speed: $|\\mathbf{u}_2| = \\sqrt{2.6^2 + 0.4^2} = \\sqrt{6.76 + 0.16} = \\sqrt{6.92}$ m/s.\n- Wave speed: $c_2 = \\sqrt{g H_2} = \\sqrt{9.81 \\times 4} = \\sqrt{39.24}$ m/s.\n- Max signal speed: $S_{\\text{max},2} = \\sqrt{6.92} + \\sqrt{39.24}$ m/s.\n- Ratio: $\\frac{R_2}{S_{\\text{max},2}} = \\frac{50(2 - \\sqrt{2})}{\\sqrt{6.92} + \\sqrt{39.24}}$ s.\n\n**Cell 3:** $H_3 = 15$ m, $\\mathbf{u}_3 = (0.5, -0.2)$ m/s.\n- Flow speed: $|\\mathbf{u}_3| = \\sqrt{0.5^2 + (-0.2)^2} = \\sqrt{0.25 + 0.04} = \\sqrt{0.29}$ m/s.\n- Wave speed: $c_3 = \\sqrt{g H_3} = \\sqrt{9.81 \\times 15} = \\sqrt{147.15}$ m/s.\n- Max signal speed: $S_{\\text{max},3} = \\sqrt{0.29} + \\sqrt{147.15}$ m/s.\n- Ratio: $\\frac{R_3}{S_{\\text{max},3}} = \\frac{50(2 - \\sqrt{2})}{\\sqrt{0.29} + \\sqrt{147.15}}$ s.\n\nTo find the most restrictive cell, we must find the minimum of these three ratios. Since the numerator $R_i$ is the same for all cells, we need to find the cell with the maximum denominator $S_{\\text{max},i}$. Let's evaluate the terms numerically:\n$R \\approx 50(2 - 1.41421) \\approx 29.289$ m.\n\n- $S_{\\text{max},1} \\approx \\sqrt{2.08} + \\sqrt{98.1} \\approx 1.442 + 9.905 \\approx 11.347$ m/s.\n- $S_{\\text{max},2} \\approx \\sqrt{6.92} + \\sqrt{39.24} \\approx 2.631 + 6.264 \\approx 8.895$ m/s.\n- $S_{\\text{max},3} \\approx \\sqrt{0.29} + \\sqrt{147.15} \\approx 0.539 + 12.131 \\approx 12.670$ m/s.\n\nComparing the maximum signal speeds, $S_{\\text{max},3} > S_{\\text{max},1} > S_{\\text{max},2}$. Therefore, Cell $3$ has the largest signal speed and will yield the smallest ratio $R/S_{\\text{max}}$, making it the most restrictive cell for the timestep calculation.\n\nThe minimum ratio is:\n$$ \\min_{i} \\left( \\frac{R_i}{S_{\\text{max},i}} \\right) = \\frac{R_3}{S_{\\text{max},3}} = \\frac{50(2 - \\sqrt{2})}{\\sqrt{0.29} + \\sqrt{147.15}} \\approx \\frac{29.2893}{12.6696} \\approx 2.31189 \\text{ s} $$\n\nFinally, we compute the stable timestep $\\Delta t$ using the given Courant number $\\text{CFL} = 0.75$:\n$$ \\Delta t = \\text{CFL} \\times \\min_{i} \\left( \\frac{R_i}{S_{\\text{max},i}} \\right) = 0.75 \\times \\frac{50(2 - \\sqrt{2})}{\\sqrt{0.29} + \\sqrt{147.15}} $$\n$$ \\Delta t \\approx 0.75 \\times 2.31189 \\approx 1.7339175 \\text{ s} $$\n\nRounding the final answer to four significant figures gives $1.734$ seconds.",
            "answer": "$$\\boxed{1.734}$$"
        },
        {
            "introduction": "A key capability of advanced storm surge models is their ability to simulate coastal inundation, where water advances over previously dry land. This \"wetting and drying\" process is notoriously difficult to implement in a way that conserves water mass, a fundamental physical law. This exercise  challenges you to implement and compare two different algorithms, highlighting how careful numerical design is essential for producing physically realistic and reliable inundation forecasts.",
            "id": "3918102",
            "problem": "You are asked to implement and analyze a wetting-drying activation criterion in a one-dimensional finite-volume model of storm surge inundation. The fundamental base is conservation of mass for the depth-integrated shallow-water system, expressed as the continuity equation. The derivation and implementation must start from the following well-tested laws and definitions, without using shortcut formulas beyond those implied by the derivation:\n\n1. The depth-integrated continuity equation for long-wave motion in a channel of unit width is $$\\frac{\\partial H}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(H u\\right) = 0,$$ where $H(x,t)$ is the water depth (in $\\mathrm{m}$) and $u(x,t)$ is a prescribed velocity (in $\\mathrm{m/s}$).\n2. A uniform one-dimensional grid with $N$ cells over length $L$ has spacing $\\Delta x = L/N$.\n3. The Courant–Friedrichs–Lewy (CFL) number is defined as $\\mathrm{CFL} = \\frac{u \\Delta t}{\\Delta x}$. For stability of the explicit scheme, enforce $\\mathrm{CFL} \\leq 1$ by choosing $\\Delta t = \\frac{T}{\\lceil T / (\\alpha \\Delta x / u)\\rceil}$ with a safety factor $0 < \\alpha \\leq 1$.\n4. An upwind finite-volume discretization with constant positive $u$ uses interface fluxes $F_{i+1/2} = u H_i^{a}$, where $H_i^{a}$ is the active (transporting) water depth in cell $i$. The discrete update for cell $i$ over time-step $\\Delta t$ is $$H_i^{a,n+1} = H_i^{a,n} - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right),$$ with a left boundary inflow flux $F_{1/2}^n = u H_{\\mathrm{in}}(t_n)$ and a closed right boundary $F_{N+1/2}^n = 0$.\n5. The surge pulse entering from the left boundary is prescribed as $$H_{\\mathrm{in}}(t) = \\begin{cases} H_0 \\sin^2\\left(\\frac{\\pi t}{T_p}\\right), & 0 \\le t \\le T_p, \\\\ 0, & t > T_p. \\end{cases}$$\n\nActivation and deactivation criterion:\n\n- A cell is active if its active water depth satisfies $H_i^{a} \\ge H_{\\min}$. When the active depth is below the threshold $H_{\\min}$, the cell is deactivated.\n\nYou must implement and compare two models for deactivation:\n\n- Naive deactivation: After each time-step, for every cell set $H_i^{a,n+1} = 0$ whenever $H_i^{a,n+1} < H_{\\min}$. No subthreshold water is retained.\n- Conservative ponding: Maintain an inactive reservoir depth $H_i^{r}$ per cell. After each time-step, if the tentative active update $H_i^{a,n+1}$ is below $H_{\\min}$, transfer the entire nonnegative tentative active depth into the reservoir, i.e., $H_i^{r,n+1} \\leftarrow H_i^{r,n} + \\max(H_i^{a,n+1}, 0)$ and set $H_i^{a,n+1} \\leftarrow 0$. If $H_i^{r,n+1} \\ge H_{\\min}$, instantaneously reactivate by setting $H_i^{a,n+1} \\leftarrow H_i^{a,n+1} + H_i^{r,n+1}$ and $H_i^{r,n+1} \\leftarrow 0$. Fluxes are always computed using only the active depth $H^{a}$.\n\nMass diagnostics:\n\n- The reference global mass (per unit width) accumulated in the domain by time $T$ is $M_{\\mathrm{ref}}(T) = \\int_0^T u H_{\\mathrm{in}}(t)\\, dt.$ With a closed right boundary, there is no outflow, so this integral equals the mass that should be present in the domain for an exactly mass-conserving scheme.\n- The model-computed global mass at time $T$ is $M_{\\mathrm{tot}}(T) = \\Delta x \\sum_{i=1}^{N} \\left(H_i^{a}(T) + H_i^{r}(T)\\right)$ for the conservative ponding scheme, and $M_{\\mathrm{tot}}(T) = \\Delta x \\sum_{i=1}^{N} H_i^{a}(T)$ for the naive deactivation scheme.\n- Define the global mass error fraction $E = \\frac{M_{\\mathrm{tot}}(T) - M_{\\mathrm{ref}}(T)}{M_{\\mathrm{ref}}(T)},$ which is dimensionless. Your program must compute $E$ for both deactivation models.\n\nImplementation requirements:\n\n- Use the explicit upwind finite-volume scheme derived above.\n- Use $\\alpha = 0.5$ to set the time-step via the CFL constraint.\n- The domain width is $1\\,\\mathrm{m}$, so all masses are per unit width, with units $\\mathrm{m}^2$.\n- Express the final output values as decimal floats without any unit symbols.\n\nTest suite:\n\nRun the simulation for the following four test cases, each specified by $(H_{\\min}, L, N, u, T, H_0, T_p)$:\n\n1. Case A (happy path): $(0.01\\,\\mathrm{m}, 1000\\,\\mathrm{m}, 200, 2\\,\\mathrm{m/s}, 60\\,\\mathrm{s}, 0.2\\,\\mathrm{m}, 20\\,\\mathrm{s})$.\n2. Case B (edge: subthreshold pulse): $(0.05\\,\\mathrm{m}, 500\\,\\mathrm{m}, 100, 1\\,\\mathrm{m/s}, 40\\,\\mathrm{s}, 0.04\\,\\mathrm{m}, 20\\,\\mathrm{s})$.\n3. Case C (boundary: nearly no deactivation): $(10^{-6}\\,\\mathrm{m}, 1000\\,\\mathrm{m}, 200, 2\\,\\mathrm{m/s}, 60\\,\\mathrm{s}, 0.2\\,\\mathrm{m}, 20\\,\\mathrm{s})$.\n4. Case D (coarse grid, stronger threshold): $(0.02\\,\\mathrm{m}, 1000\\,\\mathrm{m}, 50, 3\\,\\mathrm{m/s}, 30\\,\\mathrm{s}, 0.05\\,\\mathrm{m}, 15\\,\\mathrm{s})$.\n\nFinal output format:\n\nYour program must produce a single line of output containing the eight results, ordered as [$E_{\\text{naive,A}}$, $E_{\\text{conservative,A}}$, $E_{\\text{naive,B}}$, $E_{\\text{conservative,B}}$, $E_{\\text{naive,C}}$, $E_{\\text{conservative,C}}$, $E_{\\text{naive,D}}$, $E_{\\text{conservative,D}}$], printed as a Python-style list of decimal floats on one line, with no additional text.",
            "solution": "The user's request is to implement and analyze two different wetting-drying schemes within a one-dimensional finite-volume storm surge model. The problem is scientifically sound, well-posed, and provides all necessary information for a unique solution. It is based on the fundamental principle of mass conservation expressed by the shallow-water continuity equation, a standard explicit numerical discretization (first-order upwind), and the Courant-Friedrichs-Lewy (CFL) stability condition. The parameters for all test cases are fully specified, and the evaluation metrics are clearly defined. Therefore, the problem is valid.\n\n### 1. Problem Formulation and Discretization\n\nThe governing equation is the depth-integrated continuity equation for a channel of unit width:\n$$\n\\frac{\\partial H}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(H u\\right) = 0\n$$\nwhere $H(x,t)$ is the total water depth and $u$ is a prescribed, constant positive velocity.\n\nWe discretize the spatial domain of length $L$ into $N$ uniform cells, each of width $\\Delta x = L/N$. The state variable in each cell $i$ is the cell-averaged water depth $H_i(t)$. Integrating the governing equation over cell $i$ (from $x_{i-1/2}$ to $x_{i+1/2}$) and applying the divergence theorem yields:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial H}{\\partial t} \\,dx + \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial (Hu)}{\\partial x} \\,dx = 0\n$$\n$$\n\\frac{d}{dt} (\\Delta x H_i) + \\left. (Hu) \\right|_{x_{i+1/2}} - \\left. (Hu) \\right|_{x_{i-1/2}} = 0\n$$\nDividing by $\\Delta x$ and defining the numerical flux at cell interfaces as $F_{i \\pm 1/2} = (Hu)_{i \\pm 1/2}$, we get the semi-discrete form:\n$$\n\\frac{d H_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nFor a constant positive velocity $u$, the first-order upwind scheme dictates that the flux at an interface is determined by the state of the upwind cell. Thus, $F_{i+1/2} = u H_i$. The problem specifies that fluxes are computed using only the *active* water depth, $H_i^a$, which can be transported. So, the numerical flux is $F_{i+1/2} = u H_i^a$.\n\nUsing a forward Euler scheme for time integration with time step $\\Delta t$, we arrive at the fully discrete explicit update rule:\n$$\n\\frac{H_i^{a,n+1} - H_i^{a,n}}{\\Delta t} = -\\frac{1}{\\Delta x} (F_{i+1/2}^n - F_{i-1/2}^n)\n$$\n$$\nH_i^{a,n+1} = H_i^{a,n} - \\frac{\\Delta t}{\\Delta x} (u H_i^{a,n} - u H_{i-1}^{a,n})\n$$\nThis is the update scheme provided in the problem statement, where boundary conditions are $F_{1/2}^n = u H_{\\mathrm{in}}(t_n)$ at the left boundary and $F_{N+1/2}^n = 0$ at the closed right boundary.\n\n### 2. Time Step Calculation\n\nThe time step $\\Delta t$ is determined by the CFL condition to ensure numerical stability. With a safety factor $\\alpha = 0.5$, the condition is $\\mathrm{CFL} = \\frac{u \\Delta t}{\\Delta x} \\le \\alpha$. To ensure the total simulation time $T$ is met exactly, $\\Delta t$ is calculated as:\n$$\n\\Delta t = \\frac{T}{\\lceil T / (\\alpha \\Delta x / u)\\rceil}\n$$\nThe number of time steps is $N_t = \\lceil T / (\\alpha \\Delta x / u) \\rceil$.\n\n### 3. Wetting and Drying Models\n\nThe core of the problem lies in handling cells where the water depth drops below a minimum threshold $H_{\\min}$.\n\n**Model 1: Naive Deactivation**\nThis is a non-conservative approach. After computing the tentative updated active depth $H_i^{a,n+1}$ for each cell, any depth below the threshold is simply discarded:\n$$\n\\text{If } H_i^{a,n+1}  H_{\\min}, \\text{ then set } H_i^{a,n+1} = 0.\n$$\nThis process inherently violates mass conservation, as small amounts of water are continuously removed from the system.\n\n**Model 2: Conservative Ponding**\nThis scheme is designed to conserve mass. It introduces an inactive reservoir depth, $H_i^r$, for each cell. Water in the reservoir is stationary and does not contribute to fluxes.\nThe logic applied at each time step is as follows:\n1.  **Deactivation and Ponding**: If the tentative active depth $H_i^{a,n+1}$ is below $H_{\\min}$, the non-negative portion of this water is transferred to the reservoir.\n    - $H_i^{r, \\text{new}} \\leftarrow H_i^{r,n} + \\max(0, H_i^{a,n+1})$\n    - $H_i^{a, \\text{new}} \\leftarrow 0$\n2.  **Reactivation**: After the ponding step, if the total water in a cell's reservoir, $H_i^{r, \\text{new}}$, meets or exceeds the threshold, the cell is reactivated. All water from the reservoir is moved back into the active depth.\n    - If $H_i^{r, \\text{new}} \\ge H_{\\min}$:\n        - $H_i^{a, \\text{new}} \\leftarrow H_i^{a, \\text{new}} + H_i^{r, \\text{new}}$\n        - $H_i^{r, \\text{new}} \\leftarrow 0$\n\nThis two-stage process ensures that total water mass ($H^a + H^r$) is conserved within the cell during the wetting-drying update.\n\n### 4. Mass Conservation Analysis\n\nTo evaluate the models, we compare the total mass in the domain at the end of the simulation, $M_{\\mathrm{tot}}(T)$, with the total mass that should have entered, $M_{\\mathrm{ref}}(T)$.\n\n**Reference Mass, $M_{\\mathrm{ref}}(T)$**\nThe total mass that enters the domain is the time integral of the inflow mass flux, $u H_{\\mathrm{in}}(t)$, over the simulation duration. The inflow occurs only for $t \\in [0, T_p]$. Let $T_{\\text{inflow}} = \\min(T, T_p)$.\n$$\nM_{\\mathrm{ref}}(T) = \\int_0^{T_{\\text{inflow}}} u H_{\\mathrm{in}}(t) \\, dt = \\int_0^{T_{\\text{inflow}}} u H_0 \\sin^2\\left(\\frac{\\pi t}{T_p}\\right) \\, dt\n$$\nUsing the identity $\\sin^2(\\theta) = \\frac{1 - \\cos(2\\theta)}{2}$, the integral evaluates to:\n$$\nM_{\\mathrm{ref}}(T) = u H_0 \\left[ \\frac{t}{2} - \\frac{T_p}{4\\pi}\\sin\\left(\\frac{2\\pi t}{T_p}\\right) \\right]_0^{T_{\\text{inflow}}} = u H_0 \\left( \\frac{T_{\\text{inflow}}}{2} - \\frac{T_p}{4\\pi}\\sin\\left(\\frac{2\\pi T_{\\text{inflow}}}{T_p}\\right) \\right)\n$$\nIn the special case where $T_{\\text{inflow}}=T_p$, this simplifies to $M_{\\mathrm{ref}}(T)=uH_0T_p/2$.\n\n**Model-Computed Mass, $M_{\\mathrm{tot}}(T)$**\nThe total mass in the simulation domain is the sum of water depths in all cells, multiplied by the cell width $\\Delta x$.\n- For the naive model: $M_{\\mathrm{tot}}(T) = \\Delta x \\sum_{i=1}^{N} H_i^{a}(T)$\n- For the conservative model: $M_{\\mathrm{tot}}(T) = \\Delta x \\sum_{i=1}^{N} \\left(H_i^{a}(T) + H_i^{r}(T)\\right)$\n\n**Global Mass Error Fraction, $E$**\nThe performance metric is the relative error:\n$$\nE = \\frac{M_{\\mathrm{tot}}(T) - M_{\\mathrm{ref}}(T)}{M_{\\mathrm{ref}}(T)}\n$$\nFor the naive model, we expect $E  0$ due to mass destruction. For the conservative model, the underlying numerical scheme is perfectly conservative. The primary source of error is the discretization of the time integral of the inflow boundary condition, which is a sum over discrete time steps versus the analytical integral. This error is typically small.\n\n### 5. Algorithmic Implementation\n\nThe solution will be implemented in Python using NumPy for efficient array operations. A single function will run the simulation for a given set of parameters and a specified wetting-drying model.\n\n1.  Initialize parameters: $H_{\\min}, L, N, u, T, H_0, T_p, \\alpha$.\n2.  Calculate derived constants: $\\Delta x$, $N_t$, $\\Delta t$.\n3.  Initialize state arrays: `H_a` (active depth) and `H_r` (reservoir depth, for conservative model only) to zeros.\n4.  Begin time-stepping loop for $n$ from $0$ to $N_t-1$:\n    a. Calculate current time $t_n = n \\Delta t$.\n    b. Determine inflow depth $H_{\\mathrm{in}}(t_n)$.\n    c. Compute flux array `F` of size $N+1$:\n        - $F_0 = u H_{\\mathrm{in}}(t_n)$\n        - $F_{i+1} = u H_a[i]$ for $i=0, \\dots, N-2$\n        - $F_N = 0$\n    d. Calculate tentative active depth update for all cells:\n        `H_a_tentative[i] = H_a[i] - (dt/dx) * (F[i+1] - F[i])`\n    e. Apply the chosen wetting-drying logic (Naive or Conservative) to obtain the final `H_a` and `H_r` for time step $n+1$.\n5.  After the loop, calculate $M_{\\mathrm{tot}}(T)$ from the final state arrays.\n6.  Calculate $M_{\\mathrm{ref}}(T)$ using the analytical integral formula.\n7.  Compute and return the mass error fraction $E$.\n\nThis algorithm is executed for both models on all four test cases to generate the required eight output values.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(params, model_type):\n    \"\"\"\n    Runs a 1D shallow-water simulation with a specified wetting-drying model.\n    \"\"\"\n    H_min, L, N, u, T, H0, Tp = params\n    alpha = 0.5\n\n    # Grid and time step parameters\n    dx = L / N\n    # Per problem statement: dt = T / ceil( T / (alpha * dx / u) )\n    # This guarantees T is an integer multiple of dt.\n    num_timesteps = int(np.ceil(T / (alpha * dx / u)))\n    if num_timesteps == 0:\n        # Handle cases where T is very small\n        return 0.0\n    dt = T / num_timesteps\n    \n    # CFL check (for verification)\n    cfl = u * dt / dx\n    if cfl > 1.0:\n        # This should not happen with the given dt formula and alpha = 1\n        print(f\"Warning: CFL condition violated. CFL={cfl}\")\n\n    # State variables\n    H_a = np.zeros(N)  # Active water depth\n    H_r = np.zeros(N)  # Reservoir water depth (for conservative model)\n\n    # Time-stepping loop\n    for n in range(num_timesteps):\n        t = n * dt\n        \n        # Inflow boundary condition\n        if 0 = t = Tp:\n            H_in = H0 * (np.sin(np.pi * t / Tp))**2\n        else:\n            H_in = 0.0\n\n        # Flux calculation (upwind for u > 0)\n        fluxes = np.zeros(N + 1)\n        fluxes[0] = u * H_in  # Left boundary flux F_{1/2}\n        fluxes[1:N] = u * H_a[:-1] # Internal fluxes F_{i+1/2}\n        fluxes[N] = 0.0  # Right boundary flux F_{N+1/2}\n\n        # Tentative update using finite volume scheme\n        H_a_tentative = H_a - (dt / dx) * (fluxes[1:] - fluxes[:-1])\n\n        # Apply wetting-drying logic\n        if model_type == 'naive':\n            H_a = np.where(H_a_tentative  H_min, 0.0, H_a_tentative)\n        elif model_type == 'conservative':\n            # 1. Deactivation and Ponding\n            # Transfer sub-threshold active water to the reservoir\n            sub_threshold_mask = H_a_tentative  H_min\n            \n            # Water to be ponded must be non-negative\n            ponded_water = np.maximum(0, H_a_tentative[sub_threshold_mask])\n            \n            # Update reservoir\n            H_r[sub_threshold_mask] += ponded_water\n            \n            # Update active depth: set to zero where sub-threshold, else keep tentative value\n            H_a = np.where(sub_threshold_mask, 0.0, H_a_tentative)\n            \n            # 2. Reactivation\n            # If reservoir depth now exceeds threshold, move it back to active\n            reactivation_mask = H_r >= H_min\n            H_a[reactivation_mask] += H_r[reactivation_mask]\n            H_r[reactivation_mask] = 0.0\n        else:\n            raise ValueError(\"Unknown model type\")\n\n    # Final mass calculation\n    if model_type == 'naive':\n        M_tot = dx * np.sum(H_a)\n    else:  # conservative\n        M_tot = dx * np.sum(H_a + H_r)\n        \n    return M_tot\n\ndef calculate_reference_mass(params):\n    \"\"\"\n    Calculates the analytical reference mass that entered the domain.\n    \"\"\"\n    _, _, _, u, T, H0, Tp = params\n    \n    if H0 == 0 or u == 0 or Tp == 0:\n        return 0.0\n        \n    T_inflow = min(T, Tp)\n    \n    # M_ref = integral from 0 to T_inflow of u * H0 * sin^2(pi*t/Tp) dt\n    term1 = T_inflow / 2.0\n    term2 = (Tp / (4.0 * np.pi)) * np.sin(2.0 * np.pi * T_inflow / Tp)\n    M_ref = u * H0 * (term1 - term2)\n    \n    return M_ref\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    # Test cases: (H_min, L, N, u, T, H0, Tp)\n    test_cases = [\n        # Case A (happy path)\n        (0.01, 1000, 200, 2, 60, 0.2, 20),\n        # Case B (edge: subthreshold pulse)\n        (0.05, 500, 100, 1, 40, 0.04, 20),\n        # Case C (boundary: nearly no deactivation)\n        (1e-6, 1000, 200, 2, 60, 0.2, 20),\n        # Case D (coarse grid, stronger threshold)\n        (0.02, 1000, 50, 3, 30, 0.05, 15),\n    ]\n\n    results = []\n    for params in test_cases:\n        M_ref = calculate_reference_mass(params)\n        \n        # Prevent division by zero if no mass should enter\n        if M_ref == 0.0:\n            E_naive = 0.0\n            E_conservative = 0.0\n        else:\n            # Naive model\n            M_tot_naive = run_simulation(params, 'naive')\n            E_naive = (M_tot_naive - M_ref) / M_ref\n            \n            # Conservative ponding model\n            M_tot_conservative = run_simulation(params, 'conservative')\n            E_conservative = (M_tot_conservative - M_ref) / M_ref\n\n        results.extend([E_naive, E_conservative])\n\n    # Format output as specified\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}