{
    "hands_on_practices": [
        {
            "introduction": "Understanding tidal forcing begins with its astronomical origins. This fundamental exercise guides you through the derivation of the tide-generating potential from first principles, starting with Newton's law of gravity. By performing a Taylor expansion, you will discover how the differential force across the Earth creates the tides and will estimate the magnitude of this effect, laying the groundwork for all tidal models .",
            "id": "3926697",
            "problem": "Consider the equilibrium tide concept used to prescribe large-scale barotropic tidal forcing in an Ocean General Circulation Model (OGCM). The vertical equilibrium tide at the ocean surface is given by $\\eta_{eq} = U/g$, where $U$ is the tide-generating potential per unit mass and $g$ is gravitational acceleration. Assume a spherically symmetric Earth of radius $R$ and a point on the equator. Let the Moon of mass $M_{m}$ be at mean distance $r$ from Earth’s center, and adopt Newtonian gravity.\n\nStarting from the lunar gravitational potential at a point on Earth’s surface, $\\Phi(\\mathbf{x}) = -G M_{m}/|\\mathbf{r}-\\mathbf{x}|$, perform a Taylor expansion in the small parameter $\\epsilon = R/r$ up to and including second order, and explain why the constant (zeroth order) and linear (first order) terms do not contribute to the tide-generating potential in the co-rotating Earth–Moon frame. From this derivation, obtain the leading-order scaling for the degree-two tide-generating potential $U$ at the equator and justify that it is of order $G M_{m} R^{2}/r^{3}$ up to an order-one geometric factor associated with the semi-diurnal variation.\n\nUsing this scaling, compute an order-of-magnitude estimate for the lunar semi-diurnal tide-generating potential $U$ and the corresponding equilibrium tide $\\eta_{eq} = U/g$ at the equator. Use the following standard Earth–Moon parameter values: $G = 6.67430 \\times 10^{-11}\\ \\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$, $M_{m} = 7.342 \\times 10^{22}\\ \\mathrm{kg}$, $R = 6.371 \\times 10^{6}\\ \\mathrm{m}$, $r = 3.844 \\times 10^{8}\\ \\mathrm{m}$, and $g = 9.81\\ \\mathrm{m\\,s^{-2}}$. Treat the geometric factor as order unity for an order-of-magnitude estimate.\n\nRound both $U$ and $\\eta_{eq}$ to $2$ significant figures. Express $U$ in $\\mathrm{m^{2}\\,s^{-2}}$ and $\\eta_{eq}$ in $\\mathrm{m}$. Report your final results as a two-entry row vector $\\left(U,\\ \\eta_{eq}\\right)$.",
            "solution": "The user has requested a solution to a problem concerning the equilibrium tide concept. The first step, as per the rules, is to validate the problem statement.\n\n### Step 1: Extract Givens\n- **Concept**: Equilibrium tide for large-scale barotropic tidal forcing in an Ocean General Circulation Model (OGCM).\n- **Definition**: The vertical equilibrium tide is $\\eta_{eq} = U/g$.\n- **Variables**:\n    - $U$: tide-generating potential per unit mass.\n    - $g$: gravitational acceleration.\n    - $R$: radius of a spherically symmetric Earth.\n    - $M_m$: mass of the Moon.\n    - $r$: mean distance from Earth’s center to the Moon.\n    - $\\mathbf{x}$: position vector of a point on Earth's surface relative to Earth's center.\n    - $\\mathbf{r}$: position vector of the Moon relative to Earth's center.\n- **Physics**: Newtonian gravity.\n- **Potential Formula**: The lunar gravitational potential at point $\\mathbf{x}$ is $\\Phi(\\mathbf{x}) = -G M_{m}/|\\mathbf{r}-\\mathbf{x}|$.\n- **Expansion Parameter**: $\\epsilon = R/r$ is a small parameter.\n- **Task 1**: Perform a Taylor expansion of $\\Phi(\\mathbf{x})$ in $\\epsilon$ up to and including second order.\n- **Task 2**: Explain why the constant (zeroth order) and linear (first order) terms do not contribute to the tide-generating potential $U$ in the co-rotating Earth–Moon frame.\n- **Task 3**: Obtain the leading-order scaling for the degree-two tide-generating potential $U$ at the equator and justify its order as $G M_{m} R^{2}/r^{3}$.\n- **Task 4**: Compute an order-of-magnitude estimate for $U$ and $\\eta_{eq}$ at the equator, treating the geometric factor as order unity.\n- **Constants**:\n    - $G = 6.67430 \\times 10^{-11}\\ \\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$\n    - $M_{m} = 7.342 \\times 10^{22}\\ \\mathrm{kg}$\n    - $R = 6.371 \\times 10^{6}\\ \\mathrm{m}$\n    - $r = 3.844 \\times 10^{8}\\ \\mathrm{m}$\n    - $g = 9.81\\ \\mathrm{m\\,s^{-2}}$\n- **Output Requirements**:\n    - Round $U$ and $\\eta_{eq}$ to 2 significant figures.\n    - Express $U$ in $\\mathrm{m^{2}\\,s^{-2}}$ and $\\eta_{eq}$ in $\\mathrm{m}$.\n    - Report the final result as a two-entry row vector $(U, \\eta_{eq})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It presents a standard derivation in classical mechanics and geophysics. The physical model (Newtonian gravity), the mathematical approach (Taylor expansion), and the concepts (tide-generating potential, equilibrium tide) are all fundamental and well-established. The provided constants are standard astronomical and physical values. The assumption that $\\epsilon=R/r$ is small is physically correct. The problem contains no scientific flaws, internal contradictions, or ambiguities. All information required for the derivation and calculation is provided.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will now be provided.\n\n### Solution Derivation\nThe lunar gravitational potential per unit mass at a point $\\mathbf{x}$ on the Earth's surface is given by:\n$$\n\\Phi(\\mathbf{x}) = -\\frac{G M_{m}}{|\\mathbf{r}-\\mathbf{x}|}\n$$\nwhere $\\mathbf{r}$ is the position vector of the Moon and $\\mathbf{x}$ is the position vector of the point on the surface, both relative to the Earth's center. The magnitude $|\\mathbf{r}-\\mathbf{x}|$ can be expressed as:\n$$\n|\\mathbf{r}-\\mathbf{x}| = \\sqrt{(\\mathbf{r}-\\mathbf{x})\\cdot(\\mathbf{r}-\\mathbf{x})} = \\sqrt{|\\mathbf{r}|^2 - 2\\mathbf{r}\\cdot\\mathbf{x} + |\\mathbf{x}|^2}\n$$\nLet $|\\mathbf{r}| = r$, $|\\mathbf{x}| = R$, and the angle between $\\mathbf{r}$ and $\\mathbf{x}$ be $\\theta$ (the zenith angle of the Moon). Then $\\mathbf{r}\\cdot\\mathbf{x} = rR\\cos\\theta$. Substituting these gives:\n$$\n|\\mathbf{r}-\\mathbf{x}| = \\sqrt{r^2 - 2rR\\cos\\theta + R^2} = r\\sqrt{1 - 2\\frac{R}{r}\\cos\\theta + \\left(\\frac{R}{r}\\right)^2}\n$$\nLet $\\epsilon = R/r$. The potential becomes:\n$$\n\\Phi(\\mathbf{x}) = -\\frac{G M_{m}}{r} \\left(1 - 2\\epsilon\\cos\\theta + \\epsilon^2\\right)^{-1/2}\n$$\nThe term in the parenthesis is the generating function for the Legendre polynomials, $P_n(\\cos\\theta)$, which allows the expansion:\n$$\n\\left(1 - 2\\epsilon\\cos\\theta + \\epsilon^2\\right)^{-1/2} = \\sum_{n=0}^{\\infty} \\epsilon^n P_n(\\cos\\theta)\n$$\nExpanding the potential $\\Phi(\\mathbf{x})$ up to the second order in $\\epsilon=(R/r)$ yields:\n$$\n\\Phi(\\mathbf{x}) = -\\frac{G M_{m}}{r} \\sum_{n=0}^{2} \\left(\\frac{R}{r}\\right)^n P_n(\\cos\\theta) + \\mathcal{O}(\\epsilon^3)\n$$\nUsing the first three Legendre polynomials, $P_0(\\cos\\theta) = 1$, $P_1(\\cos\\theta) = \\cos\\theta$, and $P_2(\\cos\\theta) = \\frac{1}{2}(3\\cos^2\\theta - 1)$, we get:\n$$\n\\Phi(\\mathbf{x}) = \\underbrace{-\\frac{G M_{m}}{r}}_{n=0 \\text{ term}} \\underbrace{-\\frac{G M_{m} R}{r^2}\\cos\\theta}_{n=1 \\text{ term}} \\underbrace{-\\frac{G M_{m} R^2}{2r^3}(3\\cos^2\\theta - 1)}_{n=2 \\text{ term}} + \\mathcal{O}(\\epsilon^3)\n$$\nThe tide-generating potential, $U$, is the part of the gravitational potential that causes deformation. It is found by considering the frame of reference co-accelerating with the center of the Earth. The gravitational force per unit mass exerted by the Moon at the Earth's center ($\\mathbf{x}=0$) is $\\mathbf{F}_C = -\\nabla\\Phi|_{\\mathbf{x}=0} = -G M_m \\mathbf{r}/r^3$. This force accelerates the Earth as a rigid body. In the co-accelerating frame, an inertial potential, $\\Phi_{inertial} = -\\mathbf{x} \\cdot \\mathbf{F}_C$, must be added.\n$$\n\\Phi_{inertial} = -\\mathbf{x} \\cdot \\left(-\\frac{G M_{m}}{r^3}\\mathbf{r}\\right) = \\frac{G M_{m}}{r^3}(\\mathbf{x}\\cdot\\mathbf{r}) = \\frac{G M_{m}}{r^3}(R r \\cos\\theta) = \\frac{G M_{m} R}{r^2}\\cos\\theta\n$$\nThe tide-generating potential $U$ is the sum of the full potential $\\Phi$ and this inertial potential:\n$$\nU(\\mathbf{x}) = \\Phi(\\mathbf{x}) + \\Phi_{inertial}(\\mathbf{x})\n$$\nSubstituting the expansion for $\\Phi(\\mathbf{x})$:\n$$\nU(\\mathbf{x}) = \\left(-\\frac{G M_{m}}{r} - \\frac{G M_{m} R}{r^2}\\cos\\theta - \\frac{G M_{m} R^2}{2r^3}(3\\cos^2\\theta - 1) + \\dots\\right) + \\frac{G M_{m} R}{r^2}\\cos\\theta\n$$\n$$\nU(\\mathbf{x}) = -\\frac{G M_{m}}{r} - \\frac{G M_{m} R^2}{2r^3}(3\\cos^2\\theta - 1) + \\mathcal{O}(\\epsilon^3)\n$$\nNow we can explain the contributions of the zeroth and first-order terms.\n- The zeroth-order term, $-G M_m/r$, is spatially constant across the Earth at any given time. The tidal forces are derived from the gradient of the potential ($\\mathbf{F}_{tide}=-\\nabla U$). The gradient of a constant is zero, so this term produces no force and can be dropped, as potential is defined only up to an additive constant.\n- The first-order term from the original potential $\\Phi(\\mathbf{x})$, which is $-\\frac{G M_{m} R}{r^2}\\cos\\theta$, is exactly cancelled by the inertial potential $\\Phi_{inertial}$. This term corresponds to a uniform gravitational field across the Earth, which is responsible for the acceleration of the Earth as a whole toward the Moon. Since the ocean and solid Earth experience this acceleration together, it does not cause any relative deformation or tides.\n\nThe leading-order, spatially varying term that generates tides is the second-order (degree-two) term:\n$$\nU_{2}(\\mathbf{x}) = -\\frac{G M_m R^2}{r^3} P_2(\\cos\\theta) = -\\frac{G M_m R^2}{2r^3}(3\\cos^2\\theta - 1)\n$$\nThe magnitude of this potential is determined by the scaling factor $\\frac{G M_m R^2}{r^3}$. The term $P_2(\\cos\\theta)$ is a dimensionless geometric factor of order one that describes the spatial structure of the tide. For a point on the equator, as the Earth rotates, the zenith angle $\\theta$ of the Moon varies. If the Moon is in the equatorial plane, $\\theta$ varies periodically, and the potential depends on $\\cos^2\\theta$. Due to the identity $\\cos^2\\theta = (1+\\cos(2\\theta))/2$, this term contains a component that varies with twice the frequency of the Earth's rotation relative to the Moon, giving rise to the semi-diurnal (twice daily) tide. The justification that the potential is of order $G M_{m} R^{2}/r^{3}$ comes from this derivation, where the order-one geometric factor $P_2(\\cos\\theta)$ multiplies this scaling.\n\nFor the order-of-magnitude estimate, we are instructed to treat the geometric factor as order unity and use the scaling factor as the value for $U$:\n$$\nU \\approx \\frac{G M_{m} R^2}{r^3}\n$$\nSubstituting the given values:\n$$\nU \\approx \\frac{(6.67430 \\times 10^{-11}\\ \\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}) \\times (7.342 \\times 10^{22}\\ \\mathrm{kg}) \\times (6.371 \\times 10^{6}\\ \\mathrm{m})^2}{(3.844 \\times 10^{8}\\ \\mathrm{m})^3}\n$$\n$$\nU \\approx \\frac{(4.8996 \\times 10^{12}) \\times (4.0590 \\times 10^{13})}{5.6812 \\times 10^{25}} \\ \\mathrm{m^2\\,s^{-2}}\n$$\n$$\nU \\approx \\frac{1.9889 \\times 10^{26}}{5.6812 \\times 10^{25}} \\ \\mathrm{m^2\\,s^{-2}} \\approx 3.5007\\ \\mathrm{m^2\\,s^{-2}}\n$$\nRounding to $2$ significant figures, $U \\approx 3.5\\ \\mathrm{m^2\\,s^{-2}}$.\n\nNow, we compute the corresponding equilibrium tide $\\eta_{eq} = U/g$:\n$$\n\\eta_{eq} \\approx \\frac{3.5007\\ \\mathrm{m^2\\,s^{-2}}}{9.81\\ \\mathrm{m\\,s^{-2}}} \\approx 0.35685\\ \\mathrm{m}\n$$\nRounding to $2$ significant figures, $\\eta_{eq} \\approx 0.36\\ \\mathrm{m}$.\n\nThe final results are reported as a two-entry row vector $(U, \\eta_{eq})$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.5 & 0.36 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The concept of an equilibrium tide on a perfectly rigid Earth provides a crucial theoretical baseline. However, our planet is not rigid; the solid Earth itself deforms under tidal loads, an effect quantified by Love numbers $h_2$ and $k_2$. This practice explores how this elastic response modifies the ocean tide measured by a tide gauge, a critical correction needed to bridge the gap between idealized theory and real-world observations .",
            "id": "3926670",
            "problem": "Consider a barotropic ocean forced by the principal lunar semidiurnal constituent ($M_2$). The large-scale sea surface is assumed to adjust quasi-statically to maintain an equipotential of the combined gravitational and centrifugal fields. Let the tide-generating potential be denoted by $U$ and the mean gravitational acceleration by $g$. When the solid Earth is allowed to elastically deform under the external tidal loading, its response is characterized by the degree-$2$ Love numbers: the vertical displacement Love number $h_2$ and the potential Love number $k_2$. The rigid Earth case corresponds to $h_2=0$ and $k_2=0$.\n\nStarting from the equipotential condition and Newtonian gravity, and using only the definitions above, derive the expression for the fractional (percentage) change in the $M_2$ equilibrium tide amplitude due to including a deformable Earth with Love numbers $h_2$ and $k_2$, relative to the rigid Earth. Then, evaluate this fractional change using the representative values $h_2=0.6$ and $k_2=0.3$.\n\nExpress the percentage change as a dimensionless decimal (for example, $0.123$ represents $12.3$ percent). Round your final numerical answer to $3$ significant figures.",
            "solution": "The problem requires the derivation of the fractional change in the equilibrium tide amplitude when accounting for the elastic deformation of the solid Earth, relative to a rigid Earth. The solution is based on the principle that the sea surface, in the quasi-static limit, adjusts to form an equipotential surface of the total gravitational and centrifugal potential.\n\nFirst, let us establish the equilibrium tide height for the case of a perfectly rigid Earth. The total potential, $\\Psi$, at the sea surface is the sum of the Earth's own gravitational potential, $\\Phi_{\\text{Earth}}$, and the external tide-generating potential, $U$. Let the mean sea level correspond to a sphere of radius $R$. The equilibrium tide, $\\eta$, is the deviation of the sea surface from this mean level. The Earth's gravitational potential at a height $\\eta$ above the mean sea level can be approximated to first order as $\\Phi_{\\text{Earth}}(R+\\eta) \\approx \\Phi_{\\text{Earth}}(R) - g\\eta$, where $g$ is the mean gravitational acceleration at the surface. The total potential at the sea surface is therefore $\\Psi(R+\\eta) = \\Phi_{\\text{Earth}}(R) - g\\eta + U$. For the sea surface to be an equipotential, $\\Psi(R+\\eta)$ must be constant. Since $\\Phi_{\\text{Earth}}(R)$ is constant on the mean sphere, the spatially and temporally varying parts must sum to zero (or a constant, which can be absorbed into the definition of the mean sea level). Thus, we have the condition $U - g\\eta = \\text{constant}$. This leads to the expression for the equilibrium tide height on a rigid Earth, $\\eta_{\\text{rigid}}$:\n$$\ng \\eta_{\\text{rigid}} = U \\implies \\eta_{\\text{rigid}} = \\frac{U}{g}\n$$\n\nNext, we consider a deformable Earth. The tidal potential $U$ not only attracts the ocean water but also deforms the solid Earth. This deformation has two consequences relevant to the observed sea level.\n\n1.  **Vertical Displacement of the Solid Earth**: The solid Earth's surface itself is displaced vertically by the tidal forces. This displacement, $\\delta_r$, is directly proportional to the tide-generating potential. The degree-$2$ vertical displacement Love number, $h_2$, defines this relationship for the degree-$2$ components of the potential (such as the $M_2$ tide). The vertical displacement of the sea floor is given by:\n    $$\n    \\delta_r = \\frac{h_2 U}{g}\n    $$\n    This is the uplift of the solid ground, measured in a space-fixed reference frame.\n\n2.  **Induced Gravitational Potential**: The redistribution of mass within the deformed Earth creates an additional gravitational potential, $\\Phi_{\\text{add}}$. This induced potential is also proportional to the original tide-generating potential. The degree-$2$ potential Love number, $k_2$, quantifies this effect as:\n    $$\n    \\Phi_{\\text{add}} = k_2 U\n    $$\n    This additional potential acts on the water in the oceans, contributing to the total tidal forcing.\n\nNow, we formulate the new equipotential condition for the sea surface on the deformable Earth. The total potential acting on the water now includes the induced potential $\\Phi_{\\text{add}}$. Let $\\eta'$ be the height of the sea surface in the space-fixed reference frame. The equipotential condition on the water surface becomes:\n$$\nU + \\Phi_{\\text{add}} - g \\eta' = \\text{constant}\n$$\nSubstituting $\\Phi_{\\text{add}} = k_2 U$, we get:\n$$\nU + k_2 U - g \\eta' = 0 \\implies g \\eta' = (1 + k_2) U\n$$\nThis gives the elevation of the sea surface relative to the Earth's center of mass:\n$$\n\\eta' = \\frac{(1 + k_2) U}{g}\n$$\nHowever, the equilibrium tide, which would be measured by a tide gauge, is the height of the sea surface relative to the deforming sea floor. Let us denote this measurable tide height as $\\eta_{\\text{deformable}}$. It is the difference between the absolute sea surface height $\\eta'$ and the absolute displacement of the solid Earth's surface $\\delta_r$:\n$$\n\\eta_{\\text{deformable}} = \\eta' - \\delta_r\n$$\nSubstituting the expressions for $\\eta'$ and $\\delta_r$:\n$$\n\\eta_{\\text{deformable}} = \\frac{(1 + k_2) U}{g} - \\frac{h_2 U}{g} = (1 + k_2 - h_2) \\frac{U}{g}\n$$\nThe amplitude of the equilibrium tide is proportional to the coefficient multiplying $U/g$. For the rigid Earth, the amplitude $A_{\\text{rigid}}$ is proportional to $1$. For the deformable Earth, the amplitude $A_{\\text{deformable}}$ is proportional to the factor $(1 + k_2 - h_2)$.\n\nThe problem asks for the fractional change in the amplitude due to the deformable Earth, relative to the rigid Earth. This is defined as $\\frac{A_{\\text{deformable}} - A_{\\text{rigid}}}{A_{\\text{rigid}}}$.\n$$\n\\text{Fractional Change} = \\frac{(1 + k_2 - h_2) - 1}{1} = k_2 - h_2\n$$\nThe physical interpretation of this result is that the observed tide is reduced from the hypothetical rigid-Earth tide due to the solid Earth's yielding (the $-h_2$ term, as the ground rises with the water), but this reduction is partly offset by the self-attraction of the tidally deformed Earth (the $+k_2$ term).\n\nFinally, we evaluate this expression using the given representative values for the degree-$2$ Love numbers: $h_2 = 0.6$ and $k_2 = 0.3$.\n$$\n\\text{Fractional Change} = 0.3 - 0.6 = -0.3\n$$\nThis result indicates a reduction of $30\\%$ in the equilibrium tide amplitude. The problem requires the answer as a dimensionless decimal rounded to $3$ significant figures. The calculated value is exactly $-0.3$. To express this to $3$ significant figures, we write it as $-0.300$.",
            "answer": "$$\\boxed{-0.300}$$"
        },
        {
            "introduction": "In a tidally forced ocean at steady state, the astronomical power input must be balanced by frictional dissipation. This hands-on computational problem connects global-scale forcing to local-scale physics by tasking you with calculating the total energy dissipation in a model ocean. Comparing this dissipation to the known astronomical power input provides a powerful, integrated check on a model's dynamical consistency and physical parameterizations .",
            "id": "3926648",
            "problem": "Consider a depth-averaged (barotropic) tide on a rotating Earth. In a statistically steady regime, conservation of mechanical energy implies that the globally integrated rate at which the tide-generating potential does work on the ocean equals the globally integrated barotropic dissipation. The following foundational principles are given as the starting point: (i) the definition of power as the rate of work, expressed as force dotted with velocity; (ii) the depth-integrated bottom stress appearing in the depth-averaged momentum equation represents a sink of kinetic energy; (iii) the astronomical power input is equal to the product of the tidal torque and the associated angular speed; (iv) the global dissipation is obtained by integrating (summing) the local dissipation density over the ocean surface area. Two commonly used bottom-stress parameterizations are: a linear friction with coefficient $r$ (with units of inverse seconds), and a quadratic drag with drag coefficient $C_{D}$ (dimensionless). Let $\\rho$ denote seawater density, $\\mathbf{u}$ the depth-averaged horizontal velocity, $|\\mathbf{u}|$ its magnitude, $H$ the local water depth, and $dA$ an elemental horizontal area.\n\nYour task is to derive, from these principles alone, the computable expressions for the global barotropic tidal dissipation under each parameterization, and to compare each to the astronomical input power. Then, implement these expressions in a program that evaluates a small, discrete test suite. The program must adhere to the following requirements.\n\nDerivation targets to be encoded in your program:\n- Using the linear bottom-friction parameterization, start from the depth-integrated momentum balance in which linear stress appears as a Rayleigh drag acceleration $-r\\,\\mathbf{u}$. From the definition of power as stress dotted with velocity per unit area and the fact that the depth-integrated stress equals the acceleration term multiplied by $\\rho H$, derive the local instantaneous dissipation rate density and its global integral over all ocean cells where $H>0$.\n- Using the quadratic drag parameterization with bottom stress proportional to $\\rho C_{D}|\\mathbf{u}|\\,\\mathbf{u}$, derive the local instantaneous dissipation rate density and its global integral over all ocean cells where $H>0$.\n- For the astronomical input, use the definition of power as torque times angular speed and compute the input power from a specified torque and angular speed.\n- Define the relative mismatch for a method as $(D-P_{\\mathrm{in}})/P_{\\mathrm{in}}$, where $D$ is the globally integrated dissipation for that method and $P_{\\mathrm{in}}$ is the astronomical input power. In the edge case $P_{\\mathrm{in}}=0$, define the relative mismatch to be $+\\infty$ when $D>0$ and $0$ when $D=0$.\n\nUnits and numerical conventions:\n- Use $\\rho$ in kilograms per cubic meter. Use $r$ in inverse seconds, $C_{D}$ dimensionless, $|\\mathbf{u}|$ in meters per second, $H$ in meters, $dA$ in square meters, torque in newton-meters, angular speed in radians per second, power in watts.\n- Express all final power values in Terawatts (Terawatt (TW)), where $1$ Terawatt equals $10^{12}$ watts, and express all relative mismatches as dimensionless decimals.\n- Angles, when used in angular speed, must be in radians per second.\n- Round all printed outputs to $6$ decimal places.\n\nTest suite specification:\nFor each test case, you are given rectangular arrays of equal shape for $|\\mathbf{u}|$, $H$, and cell area $A$ (representing $dA$ for each discrete cell), along with scalars $\\rho$, $r$, $C_{D}$, torque $\\tau$, and angular speed $\\omega$. Treat any cell with $H=0$ as land (no ocean), which contributes zero to the sums, independent of $|\\mathbf{u}|$. Each test case must return five values in order: the linear-drag global dissipation in TW, the quadratic-drag global dissipation in TW, the astronomical input power in TW, the relative mismatch for linear drag, and the relative mismatch for quadratic drag.\n\nUse the following three test cases:\n\n- Test case $1$:\n  - Arrays $A$ in square meters:\n    $\\left[\\left[6.0\\times 10^{13},\\,6.0\\times 10^{13},\\,6.0\\times 10^{13}\\right],\\left[6.0\\times 10^{13},\\,6.0\\times 10^{13},\\,6.0\\times 10^{13}\\right]\\right]$.\n  - Arrays $H$ in meters:\n    $\\left[\\left[4000,\\,3000,\\,0\\right],\\left[200,\\,1000,\\,5000\\right]\\right]$.\n  - Arrays $|\\mathbf{u}|$ in meters per second:\n    $\\left[\\left[0.20,\\,0.10,\\,0.00\\right],\\left[0.40,\\,0.05,\\,0.15\\right]\\right]$.\n  - Scalars: $\\rho=1025$, $r=1.2\\times 10^{-4}$, $C_{D}=0.0025$, $\\tau=4.0\\times 10^{16}$, $\\omega=1.405\\times 10^{-4}$.\n\n- Test case $2$:\n  - Arrays $A$ in square meters:\n    $\\left[\\left[6.0\\times 10^{13},\\,6.0\\times 10^{13},\\,6.0\\times 10^{13}\\right],\\left[6.0\\times 10^{13},\\,6.0\\times 10^{13},\\,6.0\\times 10^{13}\\right]\\right]$.\n  - Arrays $H$ in meters:\n    $\\left[\\left[500,\\,50,\\,0\\right],\\left[30,\\,0,\\,4000\\right]\\right]$.\n  - Arrays $|\\mathbf{u}|$ in meters per second:\n    $\\left[\\left[0.05,\\,0.02,\\,0.00\\right],\\left[0.01,\\,0.00,\\,0.03\\right]\\right]$.\n  - Scalars: $\\rho=1025$, $r=2.0\\times 10^{-4}$, $C_{D}=0.0030$, $\\tau=0.0$, $\\omega=1.454\\times 10^{-4}$.\n\n- Test case $3$:\n  - Arrays $A$ in square meters:\n    $\\left[\\left[5.0\\times 10^{13},\\,7.0\\times 10^{13},\\,6.0\\times 10^{13}\\right],\\left[5.5\\times 10^{13},\\,6.5\\times 10^{13},\\,6.0\\times 10^{13}\\right]\\right]$.\n  - Arrays $H$ in meters:\n    $\\left[\\left[100,\\,200,\\,4000\\right],\\left[150,\\,1000,\\,3500\\right]\\right]$.\n  - Arrays $|\\mathbf{u}|$ in meters per second:\n    $\\left[\\left[0.30,\\,0.25,\\,0.10\\right],\\left[0.60,\\,0.05,\\,0.20\\right]\\right]$.\n  - Scalars: $\\rho=1025$, $r=1.0\\times 10^{-4}$, $C_{D}=0.0020$, $\\tau=3.5\\times 10^{16}$, $\\omega=1.405\\times 10^{-4}$.\n\nProgram output format:\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets. The list must contain, in order, for test case $1$ then test case $2$ then test case $3$, the five values per case described above, each rounded to $6$ decimal places: $\\left[D_{\\mathrm{lin},1},\\,D_{\\mathrm{quad},1},\\,P_{\\mathrm{in},1},\\,\\Delta_{\\mathrm{lin},1},\\,\\Delta_{\\mathrm{quad},1},\\,D_{\\mathrm{lin},2},\\,D_{\\mathrm{quad},2},\\,P_{\\mathrm{in},2},\\,\\Delta_{\\mathrm{lin},2},\\,\\Delta_{\\mathrm{quad},2},\\,D_{\\mathrm{lin},3},\\,D_{\\mathrm{quad},3},\\,P_{\\mathrm{in},3},\\,\\Delta_{\\mathrm{lin},3},\\,\\Delta_{\\mathrm{quad},3}\\right]$, where $D$ and $P_{\\mathrm{in}}$ are in Terawatts, and $\\Delta$ are dimensionless relative mismatches. If a relative mismatch is defined as $+\\infty$, print it exactly as the string \"inf\".",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of classical mechanics and geophysical fluid dynamics, specifically concerning the energy balance of barotropic tides. The provided physical laws, parameterizations (linear and quadratic drag), and definitions are standard in the field. The problem is well-posed, providing all necessary data and constraints for a unique, computable solution. The language is objective and unambiguous. We may, therefore, proceed with the derivation and solution.\n\nThe core of the problem is to derive expressions for tidal energy dissipation from fundamental principles and then to implement these as a computational algorithm. We will address each part in turn.\n\n**1. Derivation of Tidal Dissipation Expressions**\n\nWe are tasked with finding the globally integrated rate of energy dissipation, $D$, for two different bottom friction parameterizations. Dissipation is the rate at which mechanical energy is converted into internal energy, typically heat, due to frictional forces. The local rate of work done by a frictional force $\\mathbf{F}_{\\text{fric}}$ on the fluid is $d\\dot{W} = \\mathbf{F}_{\\text{fric}} \\cdot \\mathbf{u}$. As this represents an energy loss for the fluid flow, the dissipation rate is the negative of this quantity, $dD = -d\\dot{W}$. The local dissipation rate density, $\\varepsilon$, is the dissipation per unit horizontal area, $\\varepsilon = dD/dA$. The total global dissipation $D$ is the integral of $\\varepsilon$ over the entire ocean surface area.\n\n**1.1. Linear Drag Dissipation ($D_{\\text{lin}}$)**\n\nThe linear friction parameterization is given by a Rayleigh drag acceleration, which is a frictional force per unit mass:\n$$\n\\frac{\\mathbf{F}_{\\text{fric}}}{\\text{mass}} = -r\\,\\mathbf{u}\n$$\nwhere $r$ is the linear friction coefficient in units of $\\text{s}^{-1}$ and $\\mathbf{u}$ is the depth-averaged velocity.\n\nFor a fluid column with depth $H$ over a small area $dA$, the mass is $dm = \\rho H dA$, where $\\rho$ is the water density. The total frictional force on this fluid column is:\n$$\nd\\mathbf{F}_{\\text{fric}} = (-r\\,\\mathbf{u}) \\, dm = -r \\rho H \\mathbf{u} \\, dA\n$$\nThe rate of work done *by* this force *on* the fluid is:\n$$\nd\\dot{W} = d\\mathbf{F}_{\\text{fric}} \\cdot \\mathbf{u} = (-r \\rho H \\mathbf{u} \\, dA) \\cdot \\mathbf{u} = -r \\rho H |\\mathbf{u}|^2 \\, dA\n$$\nHere, $|\\mathbf{u}|^2 = \\mathbf{u} \\cdot \\mathbf{u}$ is the squared magnitude of the velocity. The dissipation rate is the rate of energy loss, so it is the positive definite quantity $dD = -d\\dot{W}$:\n$$\ndD_{\\text{lin}} = r \\rho H |\\mathbf{u}|^2 \\, dA\n$$\nThe local dissipation rate density (power per unit area) is therefore:\n$$\n\\varepsilon_{\\text{lin}} = \\frac{dD_{\\text{lin}}}{dA} = r \\rho H |\\mathbf{u}|^2\n$$\nThe global dissipation, $D_{\\text{lin}}$, is obtained by integrating this density over the entire ocean basin, which in the discrete formulation of the problem becomes a sum over all ocean cells (where $H > 0$):\n$$\nD_{\\text{lin}} = \\int_{\\text{ocean}} r \\rho H |\\mathbf{u}|^2 \\, dA \\quad \\rightarrow \\quad D_{\\text{lin}} = \\sum_{i \\text{ where } H_i>0} r \\rho H_i |\\mathbf{u}_i|^2 A_i\n$$\nwhere the index $i$ runs over all grid cells, and $A_i$ is the area of cell $i$.\n\n**1.2. Quadratic Drag Dissipation ($D_{\\text{quad}}$)**\n\nThe quadratic drag parameterization models the bottom stress $\\boldsymbol{\\tau}_b$ (force per unit area) directly:\n$$\n\\boldsymbol{\\tau}_b = \\rho C_D |\\mathbf{u}| \\mathbf{u}\n$$\nwhere $C_D$ is the dimensionless drag coefficient. The rate of work done by the bottom stress on the fluid per unit area is $\\boldsymbol{\\tau}_b \\cdot \\mathbf{u}$. Note that the stress $\\boldsymbol{\\tau}_b$ is the force exerted *by the seabed on the fluid*, so the rate of work done is negative, representing energy transfer from the fluid to the boundary.\n$$\n\\dot{W}_{\\text{per area}} = \\boldsymbol{\\tau}_b \\cdot \\mathbf{u} = (\\rho C_D |\\mathbf{u}| \\mathbf{u}) \\cdot \\mathbf{u} = \\rho C_D |\\mathbf{u}| ( \\mathbf{u} \\cdot \\mathbf{u}) = \\rho C_D |\\mathbf{u}|^3\n$$\nThe sign of this physical work is context-dependent. Here, dissipation is a positive quantity representing the energy sink. We define the local dissipation density $\\varepsilon_{\\text{quad}}$ as the magnitude of this work rate:\n$$\n\\varepsilon_{\\text{quad}} = \\rho C_D |\\mathbf{u}|^3\n$$\nThe global dissipation, $D_{\\text{quad}}$, is the integral of this density over the ocean area, which discretizes to a sum over all ocean cells ($H > 0$):\n$$\nD_{\\text{quad}} = \\int_{\\text{ocean}} \\rho C_D |\\mathbf{u}|^3 \\, dA \\quad \\rightarrow \\quad D_{\\text{quad}} = \\sum_{i \\text{ where } H_i>0} \\rho C_D |\\mathbf{u}_i|^3 A_i\n$$\nNote that the water depth $H$ does not explicitly appear in the expression for $\\varepsilon_{\\text{quad}}$, but it implicitly influences the velocity field $\\mathbf{u}$. The summation is constrained to ocean cells where $H_i > 0$.\n\n**2. Astronomical Input Power and Relative Mismatch**\n\nThe astronomical input power, $P_{\\text{in}}$, is the rate at which the tide-generating potential does work on the ocean. This is given as the product of the tidal torque, $\\tau$, and the associated angular speed, $\\omega$:\n$$\nP_{\\text{in}} = \\tau \\omega\n$$\nThe relative mismatch for a dissipation method, $\\Delta$, compares the calculated global dissipation $D$ to the input power $P_{\\text{in}}$:\n$$\n\\Delta = \\frac{D - P_{\\text{in}}}{P_{\\text{in}}}\n$$\nFor the edge case where $P_{\\text{in}} = 0$, the mismatch is defined as $+\\infty$ if $D > 0$ and $0$ if $D = 0$.\n\n**3. Computational Strategy**\n\nThe derived formulae are implemented for a set of discrete test cases. For each case, we are given arrays for cell area $A_i$, water depth $H_i$, and velocity magnitude $|\\mathbf{u}_i|$, along with scalar parameters $\\rho, r, C_D, \\tau,$ and $\\omega$.\n\nThe algorithm proceeds as follows:\n1.  For each test case, identify the ocean cells by creating a mask where $H_i > 0$.\n2.  Calculate the linear dissipation $D_{\\text{lin}}$ in Watts by summing the term $r \\rho H_i |\\mathbf{u}_i|^2 A_i$ over all ocean cells.\n3.  Calculate the quadratic dissipation $D_{\\text{quad}}$ in Watts by summing the term $\\rho C_D |\\mathbf{u}_i|^3 A_i$ over all ocean cells.\n4.  Calculate the astronomical input power $P_{\\text{in}}$ in Watts using $\\tau \\omega$.\n5.  Convert the three power values ($D_{\\text{lin}}, D_{\\text{quad}}, P_{\\text{in}}$) to Terawatts ($\\text{TW}$) by dividing by $10^{12}$.\n6.  Calculate the relative mismatches $\\Delta_{\\text{lin}}$ and $\\Delta_{\\text{quad}}$ using the provided formula, properly handling the special case of $P_{\\text{in}} = 0$.\n7.  Collect the five resulting values for each test case, formatted to $6$ decimal places, into a single list for output.\n\nThis procedure is directly translated into the provided Python program.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes tidal dissipation and astronomical power for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"A\": np.array([[6.0e13, 6.0e13, 6.0e13], [6.0e13, 6.0e13, 6.0e13]]),\n            \"H\": np.array([[4000, 3000, 0], [200, 1000, 5000]]),\n            \"u_mag\": np.array([[0.20, 0.10, 0.00], [0.40, 0.05, 0.15]]),\n            \"rho\": 1025,\n            \"r\": 1.2e-4,\n            \"C_D\": 0.0025,\n            \"tau\": 4.0e16,\n            \"omega\": 1.405e-4,\n        },\n        {\n            \"A\": np.array([[6.0e13, 6.0e13, 6.0e13], [6.0e13, 6.0e13, 6.0e13]]),\n            \"H\": np.array([[500, 50, 0], [30, 0, 4000]]),\n            \"u_mag\": np.array([[0.05, 0.02, 0.00], [0.01, 0.00, 0.03]]),\n            \"rho\": 1025,\n            \"r\": 2.0e-4,\n            \"C_D\": 0.0030,\n            \"tau\": 0.0,\n            \"omega\": 1.454e-4,\n        },\n        {\n            \"A\": np.array([[5.0e13, 7.0e13, 6.0e13], [5.5e13, 6.5e13, 6.0e13]]),\n            \"H\": np.array([[100, 200, 4000], [150, 1000, 3500]]),\n            \"u_mag\": np.array([[0.30, 0.25, 0.10], [0.60, 0.05, 0.20]]),\n            \"rho\": 1025,\n            \"r\": 1.0e-4,\n            \"C_D\": 0.0020,\n            \"tau\": 3.5e16,\n            \"omega\": 1.405e-4,\n        },\n    ]\n\n    all_results = []\n    \n    # Conversion factor from Watts to Terawatts\n    W_to_TW = 1.0e-12\n\n    def format_val(value):\n        \"\"\"Formats a value to 6 decimal places, handling infinity.\"\"\"\n        if value == float('inf'):\n            return 'inf'\n        return f\"{value:.6f}\"\n\n    for case in test_cases:\n        A = case[\"A\"]\n        H = case[\"H\"]\n        u_mag = case[\"u_mag\"]\n        rho = case[\"rho\"]\n        r = case[\"r\"]\n        C_D = case[\"C_D\"]\n        tau = case[\"tau\"]\n        omega = case[\"omega\"]\n        \n        # Create a mask for ocean cells (H > 0)\n        ocean_mask = H > 0\n        \n        # Calculate linear dissipation\n        # D_lin = sum(r * rho * H * |u|^2 * A) over ocean cells\n        d_lin_local = r * rho * H * u_mag**2 * A\n        d_lin_watts = np.sum(d_lin_local[ocean_mask])\n        d_lin_tw = d_lin_watts * W_to_TW\n\n        # Calculate quadratic dissipation\n        # D_quad = sum(rho * C_D * |u|^3 * A) over ocean cells\n        d_quad_local = rho * C_D * u_mag**3 * A\n        d_quad_watts = np.sum(d_quad_local[ocean_mask])\n        d_quad_tw = d_quad_watts * W_to_TW\n        \n        # Calculate astronomical input power\n        p_in_watts = tau * omega\n        p_in_tw = p_in_watts * W_to_TW\n\n        # Calculate relative mismatches\n        # Mismatch = (D - P_in) / P_in\n        if p_in_tw == 0:\n            mismatch_lin = float('inf') if d_lin_tw > 0 else 0.0\n            mismatch_quad = float('inf') if d_quad_tw > 0 else 0.0\n        else:\n            mismatch_lin = (d_lin_tw - p_in_tw) / p_in_tw\n            mismatch_quad = (d_quad_tw - p_in_tw) / p_in_tw\n            \n        case_results = [\n            d_lin_tw,\n            d_quad_tw,\n            p_in_tw,\n            mismatch_lin,\n            mismatch_quad\n        ]\n        all_results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    formatted_results = [format_val(res) for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}