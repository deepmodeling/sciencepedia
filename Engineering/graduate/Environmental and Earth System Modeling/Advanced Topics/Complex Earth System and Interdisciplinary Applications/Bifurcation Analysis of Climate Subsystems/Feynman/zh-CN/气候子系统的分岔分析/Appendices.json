{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您分析温盐环流（THC）的一个经典概念模型。通过这个看似简单的模型，我们将揭示气候子系统中一个深刻的特性：多重平衡态和鞍结分岔的存在。这个实践旨在锻炼您从基本物理原理出发，推导系统平衡点并分析其稳定性的核心分析能力，这是理解气候临界点如何产生的基石。",
            "id": "3865564",
            "problem": "考虑一个简化的温盐环流（THC）双箱模型，其中盆地间的盐度差由单个无量纲标量变量 $S(t)$ 表示，净淡水强迫差由无量纲控制参数 $F$ 表示。流的大小被认为与由给定的热强迫和可变的盐强迫引起的密度差成线性比例关系，即 $q = a - b S$，其中 $a  0$ 和 $b  0$ 是无量纲常数，分别代表标度化的热驱动和盐收缩。在盐度差的盐平衡中，平流作用以与流量大小乘以盐度差成正比的速率输出盐分，并且还有一个额外的线性混合项。由此得到的无量纲演化方程为\n$$\n\\frac{dS}{dt} \\;=\\; F \\;-\\; \\big(|\\,a - b S\\,| + \\delta\\big)\\,S,\n$$\n其中 $\\delta  0$ 是一个无量纲混合参数。该公式源于双箱框架中的盐质量守恒和固定热强迫下密度的线性状态方程，其中平流交换取决于密度驱动流的大小。\n\n任务：\n1. 从盐质量守恒原理和线性关系 $q = a - b S$ 出发，推导 $S$ 的平衡条件，并分段求出在 $S \\leq a/b$ 和 $S \\geq a/b$ 区间内的平衡分支 $S^{*}(F)$。\n2. 推导平衡点处的雅可比式（即方程右端对 $S$ 的导数），并用其符号来判断平衡分支的局域线性稳定性。用 $a$、$b$ 和 $\\delta$ 明确说明每个分支的稳定性。\n3. 使用典范参数值 $a = 1$、$b = 1$ 和 $\\delta = 0.2$，计算该系统中发生鞍结（折叠）分岔时的临界淡水强迫 $F_{c}$。\n\n将 $F_{c}$ 的最终答案表示为一个无量纲数。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题陈述是关于代表气候子系统的简化动力系统分岔分析的有效练习。该模型是物理海洋学中一个成熟的概念工具（Stommel类型的箱式模型）。方程定义清晰，参数已指定，任务在数学上是精确的。该问题是自洽的、有科学依据且适定的。\n\n无量纲盐度差 $S(t)$ 的演化方程由下式给出\n$$\n\\frac{dS}{dt} = F - \\big(|\\,a - b S\\,| + \\delta\\big)\\,S\n$$\n其中 $F$、$a$、$b$ 和 $\\delta$ 是正的无量纲参数。\n\n### 任务1：平衡分支\n\n平衡态，记作 $S^*$，通过将时间导数设为零 $\\frac{dS}{dt} = 0$ 来找到。这得出了平衡条件：\n$$\nF = \\big(|\\,a - b S^*\\,| + \\delta\\big)\\,S^*\n$$\n绝对值项要求我们根据 $a - bS$ 的符号，在两个独立的区间内分析该系统。\n\n**区间1：$S \\leq \\frac{a}{b}$**\n\n在此区间内，$a - bS \\geq 0$，所以 $|a - bS| = a - bS$。平衡条件变为：\n$$\nF = (a - bS^* + \\delta)S^*\n$$\n将其重新整理为关于 $S^*$ 的标准二次方程形式，得到：\n$$\nb(S^*)^2 - (a + \\delta)S^* + F = 0\n$$\n我们使用二次方程求根公式来解 $S^*$：\n$$\nS^*(F) = \\frac{(a + \\delta) \\pm \\sqrt{(a + \\delta)^2 - 4bF}}{2b}\n$$\n这些解是实数解，条件是判别式为非负，即 $(a + \\delta)^2 - 4bF \\geq 0$，这意味着 $F \\leq \\frac{(a + \\delta)^2}{4b}$。这在此区间内给出了两个平衡分支，我们将其记为 $S^{*}_{+}$ 和 $S^{*}_{-}$。\n\n**区间2：$S \\geq \\frac{a}{b}$**\n\n在此区间内，$a - bS \\leq 0$，所以 $|a - bS| = -(a - bS) = bS - a$。平衡条件变为：\n$$\nF = (bS^* - a + \\delta)S^*\n$$\n将其重新整理为关于 $S^*$ 的二次方程形式，得到：\n$$\nb(S^*)^2 - (a - \\delta)S^* - F = 0\n$$\n使用二次方程求根公式解 $S^*$：\n$$\nS^*(F) = \\frac{(a - \\delta) \\pm \\sqrt{(a - \\delta)^2 + 4bF}}{2b}\n$$\n由于 $b  0$，$F  0$，平方根下的项总是正的并且大于 $(a - \\delta)^2$。因此，$\\sqrt{(a - \\delta)^2 + 4bF}  |a - \\delta|$。带有减号的根，$\\frac{(a - \\delta) - \\sqrt{\\dots}}{2b}$，总是负的。由于 $S$ 代表盐度差，物理上它被限制为非负。因此我们只保留正根，它在此区间内定义了一个单一的平衡分支：\n$$\nS^{**}(F) = \\frac{(a - \\delta) + \\sqrt{(a - \\delta)^2 + 4bF}}{2b}\n$$\n该分支在 $S^{**}(F) \\geq \\frac{a}{b}$ 的 $F$ 值下有效。\n\n### 任务2：稳定性分析\n\n平衡点 $S^*$ 的局域线性稳定性由雅可比式 $J = \\frac{df}{dS}$ 在 $S^*$ 处的符号决定，其中 $f(S) = F - \\big(|\\,a - b S\\,| + \\delta\\big)\\,S$。如果 $J  0$，则平衡是稳定的；如果 $J > 0$，则是不稳定的。\n\n**区间1：$S  \\frac{a}{b}$**\n\n在这里，$f(S) = F - (a + \\delta)S + bS^2$。雅可比式为：\n$$\nJ(S) = \\frac{df}{dS} = - (a + \\delta) + 2bS\n$$\n对于下分支，$S^{*}_{-} = \\frac{(a + \\delta) - \\sqrt{(a + \\delta)^2 - 4bF}}{2b}$：\n$$\nJ(S^{*}_{-}) = -(a + \\delta) + 2b \\left( \\frac{(a + \\delta) - \\sqrt{(a + \\delta)^2 - 4bF}}{2b} \\right) = - \\sqrt{(a + \\delta)^2 - 4bF}\n$$\n对于 $F  \\frac{(a + \\delta)^2}{4b}$，平方根下的项为正，所以 $J(S^{*}_{-})  0$。因此，下分支 $S^{*}_{-}$ 是 **稳定的**。\n\n对于上分支，$S^{*}_{+} = \\frac{(a + \\delta) + \\sqrt{(a + \\delta)^2 - 4bF}}{2b}$：\n$$\nJ(S^{*}_{+}) = -(a + \\delta) + 2b \\left( \\frac{(a + \\delta) + \\sqrt{(a + \\delta)^2 - 4bF}}{2b} \\right) = + \\sqrt{(a + \\delta)^2 - 4bF}\n$$\n对于 $F  \\frac{(a + \\delta)^2}{4b}$，$J(S^{*}_{+}) > 0$。因此，这个中间分支 $S^{*}_{+}$ 是 **不稳定的**。\n\n**区间2：$S > \\frac{a}{b}$**\n\n在这里，$f(S) = F + (a - \\delta)S - bS^2$。雅可比式为：\n$$\nJ(S) = \\frac{df}{dS} = (a - \\delta) - 2bS\n$$\n对于平衡分支 $S^{**} = \\frac{(a - \\delta) + \\sqrt{(a - \\delta)^2 + 4bF}}{2b}$：\n$$\nJ(S^{**}) = (a - \\delta) - 2b \\left( \\frac{(a - \\delta) + \\sqrt{(a - \\delta)^2 + 4bF}}{2b} \\right) = - \\sqrt{(a - \\delta)^2 + 4bF}\n$$\n由于 $b  0$、$F  0$ 且参数为实数，平方根下的项总是正的。因此，$J(S^{**})  0$。分支 $S^{**}$ 是 **稳定的**。\n\n### 任务3：鞍结分岔的临界强迫\n\n当一个稳定平衡和一个不稳定平衡合并并消失时，会发生鞍结（或折叠）分岔。在这个模型中，这对应于稳定分支 $S^{*}_{-}$ 和不稳定分支 $S^{*}_{+}$ 合并的点。在数学上，当区间1的二次方程的两个不同实根合并为一个单实根时，这种情况就会发生。这发生在二次方程的判别式为零时：\n$$\n(a + \\delta)^2 - 4bF = 0\n$$\n这个条件定义了临界淡水强迫 $F_c$：\n$$\nF_c = \\frac{(a + \\delta)^2}{4b}\n$$\n这也是雅可比式为零的点，$J(S^{*}_{\\pm}) = 0$，这是鞍结分岔的一般条件。分岔点处的 $S$ 值为 $S_c = \\frac{a+\\delta}{2b}$。为使这一点成为区间1内的一个有效分岔点，我们必须有 $S_c \\leq a/b$，这意味着 $a+\\delta \\leq 2a$，或 $\\delta \\leq a$。给定参数 $a=1$ 和 $\\delta=0.2$，此条件得到满足。\n\n我们现在将给定的典范参数值 $a = 1$、$b = 1$ 和 $\\delta = 0.2$ 代入 $F_c$ 的表达式中：\n$$\nF_c = \\frac{(1 + 0.2)^2}{4 \\times 1} = \\frac{(1.2)^2}{4} = \\frac{1.44}{4} = 0.36\n$$\n问题要求答案四舍五入到四位有效数字。\n\n$F_c = 0.3600$。",
            "answer": "$$\n\\boxed{0.3600}\n$$"
        },
        {
            "introduction": "在您通过上一个练习  建立了分析理解的基础上，本实践将重心转向强大的数值方法。我们将使用分岔的“范式”（normal form），它是一种描述特定类型分岔的通用数学模型。您的任务是开发一个计算程序，以自动寻找平衡点并诊断其稳定性，这对于分析那些无法求得解析解的复杂气候模型来说是一项至关重要的技能。",
            "id": "3865644",
            "problem": "考虑一个通过中心流形约简（CMR）从基于物理的能量平衡框架中获得的降维、无量纲的一维气候子系统模型。描述慢不变动力学的自治常微分方程（ODE）为\n$$\n\\frac{dX}{dt} = f(X;\\mu) = \\mu + X - X^3,\n$$\n其中 $X$ 是一个无量纲的状态变量，代表一个缓慢变化的大尺度气候量（例如，归一化的全球平均温度异常或冰线坐标），而 $\\mu$ 是一个无量纲的控制参数，代表有效的外部强迫（例如，标度化的辐射强迫或淡水扰动）。此流的不变集是满足不变性条件的平衡点 $X^\\star$\n$$\nf(X^\\star;\\mu) = 0.\n$$\n平衡点 $X^\\star$ 的线性稳定性由线性化系数决定\n$$\n\\lambda(X^\\star;\\mu) = \\left.\\frac{\\partial f}{\\partial X}\\right|_{X^\\star} = 1 - 3\\,(X^\\star)^2.\n$$\n一个平衡点是线性稳定的当且仅当 $\\lambda(X^\\star;\\mu)  0$，是线性不稳定的当且仅当 $\\lambda(X^\\star;\\mu)  0$。在鞍结分岔点，一对平衡点合并，此时 $\\lambda(X^\\star;\\mu)=0$。\n\n您的任务是演示数值方法，该方法能够：\n- 在指定的参数值 $\\mu$ 下，近似计算模型的所有实不变平衡点 $X^\\star$。\n- 通过 $\\lambda(X^\\star;\\mu)$ 的符号验证其稳定性。\n- 通过在数值计算出的平衡点处评估残差 $|f(X^\\star;\\mu)|$ 来量化不变集近似的数值精度。\n\n实现一个算法，对于每个给定的 $\\mu$，数值求解三次方程 $-X^3 + X + \\mu = 0$（等价于 $f(X;\\mu)=0$）的所有实根，筛选出纯实数解，使用一个小的绝对容差来合并在退化（二重根）参数值下出现的重复根，并计算稳定性分类和诊断指标。诊断指标必须包括：\n- 不同实平衡点的总数 $N_{\\mathrm{eq}}$。\n- 由 $\\lambda(X^\\star;\\mu)$ 的符号决定的线性稳定平衡点的数量 $N_{\\mathrm{st}}$。\n- 在数值找到的平衡点集合上的最大残差 $R_{\\max} = \\max_{X^\\star} |f(X^\\star;\\mu)|$。\n- 最小绝对线性化幅值 $L_{\\min} = \\min_{X^\\star} |\\lambda(X^\\star;\\mu)|$，该值突显了系统接近鞍结条件的程度，此时 $|\\lambda|$ 趋近于 $0$。\n\n设计的数值方法需要在具有一个平衡点、三个平衡点以及两个平衡点合并的退化鞍结情况的体系中都具有鲁棒性。您不得使用三次方程的任何闭式解析解；仅依赖数值算法。\n\n测试套件：\n为以下控制参数值评估您的程序，这些值包括一般情况、边缘情况和边界情况：\n- $\\mu = -0.350$ （预期有三个平衡点的一般情况），\n- $\\mu = 0.000$ （对称情况），\n- $\\mu = 0.300$ （一般情况），\n- $\\mu = \\frac{2}{3\\sqrt{3}} \\approx 0.3849001794597505$ （正边界鞍结），\n- $\\mu = -\\frac{2}{3\\sqrt{3}} \\approx -0.3849001794597505$ （负边界鞍结），\n- $\\mu = 0.500$ （单一平衡点体系）。\n\n答案规格和最终输出格式：\n- 对于每个测试用例，输出一个列表 $[N_{\\mathrm{eq}}, N_{\\mathrm{st}}, R_{\\max}, L_{\\min}]$，其中 $R_{\\max}$ 和 $L_{\\min}$ 以四舍五入到八位小数的十进制数报告。\n- 将所有测试用例的结果（按上述顺序）聚合成一个单行输出，该输出是一个用方括号括起来的逗号分隔列表，其中每个元素是上述每个测试用例的列表。例如，输出必须看起来像\n$$\n[[N_{\\mathrm{eq}},N_{\\mathrm{st}},R_{\\max},L_{\\min}],\\ldots]\n$$\n打印为单行，没有空格。\n- 由于所有量都是无量纲的，因此不需要指定物理单位。不使用角度。不使用百分比。",
            "solution": "该问题要求对自治常微分方程 $\\frac{dX}{dt} = f(X;\\mu) = \\mu + X - X^3$ 的平衡解进行数值研究。分析涉及为指定的控制参数 $\\mu$ 值找到所有实平衡点 $X^\\star$，确定它们的稳定性，并量化解的数值精度。\n\n动力系统的平衡态或不变集 $X^\\star$ 是指系统状态不随时间变化的那个点，即 $\\frac{dX}{dt} = 0$。这导出了代数平衡条件：\n$$\nf(X^\\star;\\mu) = \\mu + X^\\star - (X^\\star)^3 = 0\n$$\n这个方程是关于状态变量 $X^\\star$ 的三次多项式。任务是为给定的 $\\mu$ 值找到其所有实根。\n\n该问题明确禁止使用三次方程的闭式解析解，要求采用纯数值方法。一个标准且鲁棒的方法是使用数值多项式求根算法。这类算法通常基于伴随矩阵特征值计算，能够根据多项式系数找到其所有根（包括实根和复根）。所讨论的多项式可以写成标准形式 $-X^3 + 0X^2 + 1X^1 + \\mu X^0 = 0$。对于一个接受按降幂顺序排列的多项式系数的数值库函数，输入向量将是 $[-1, 0, 1, \\mu]$。\n\n通用求根器的输出将包括复根。由于状态变量 $X$ 代表一个物理量，我们只对实平衡点感兴趣。如果一个数值根 $z = a + ib$ 的虚部 $|b|$ 小于一个很小的数值容差（即 $|b|  \\epsilon_{\\mathrm{imag}}$），则该根被认为是实根。其实部 $a$ 则被视为平衡点 $X^\\star$ 的值。\n\n此外，在某些临界参数值 $\\mu$ 下，系统会经历鞍结分岔，其中两个平衡点合并。在数值上，这对应于多项式的一个重根。由于浮点运算的限制，数值求解器可能会返回两个不同但非常接近的根，而不是一个单一的重根。为了正确识别不同平衡点的数量，需要进行后处理步骤。在筛选出实根后，对它们进行排序，任何相邻的根 $X^\\star_i$ 和 $X^\\star_{i+1}$，如果其绝对差小于一个合并容差（即 $|X^\\star_{i+1} - X^\\star_i|  \\epsilon_{\\mathrm{merge}}$），则被视为一个单一的退化平衡点。\n\n一旦确定了不同实平衡点的集合 $\\{X^\\star\\}$，便可评估它们的线性稳定性。稳定性由线性化系数 $\\lambda$ 的符号决定，该系数是常微分方程右侧在平衡点处的导数：\n$$\n\\lambda(X^\\star;\\mu) = \\left.\\frac{\\partial f}{\\partial X}\\right|_{X^\\star} = 1 - 3(X^\\star)^2\n$$\n如果 $\\lambda  0$（扰动衰减），平衡点是线性稳定的；如果 $\\lambda  0$（扰动增长），则是不稳定的。$\\lambda = 0$ 的情况对应于临界稳定性，是鞍结分岔的条件。\n\n该算法对每个给定的 $\\mu$ 计算四个诊断指标：\n1.  $N_{\\mathrm{eq}}$：不同实平衡点的总数，通过对筛选和合并过程后的唯一根进行计数获得。\n2.  $N_{\\mathrm{st}}$：线性稳定平衡点的数量，通过对满足 $\\lambda(X^\\star;\\mu)  0$ 的平衡点进行计数获得。\n3.  $R_{\\max}$：最大绝对残差，定义为 $R_{\\max} = \\max_{X^\\star} |f(X^\\star;\\mu)|$。该指标可作为对数值求根质量的检查，因为对于精确的根，残差应接近机器精度。\n4.  $L_{\\min}$：最小绝对线性化幅值，$L_{\\min} = \\min_{X^\\star} |\\lambda(X^\\star;\\mu)|$。该值是系统接近分岔点的敏感指标，因为当系统接近 $\\lambda(X^\\star;\\mu) = 0$ 的条件时，它会趋近于 $0$。\n\n总之，对于测试套件中提供的每个 $\\mu$ 值，实现将执行以下步骤：\n1.  将多项式系数定义为 $[-1, 0, 1, \\mu]$。\n2.  使用数值求解器（如 `numpy.roots`）计算三次多项式的所有根。\n3.  通过检查虚部的绝对值是否低于一个小的容差 $\\epsilon_{\\mathrm{imag}}$ 来分离出实根。\n4.  使用容差 $\\epsilon_{\\mathrm{merge}}$ 对实根集合进行排序和合并，以获得不同的平衡点 $\\{X^\\star_i\\}$。\n5.  统计不同平衡点的数量以确定 $N_{\\mathrm{eq}}$。\n6.  对于每个 $X^\\star_i$，计算 $\\lambda(X^\\star_i;\\mu)$ 并统计稳定平衡点的数量以得出 $N_{\\mathrm{st}}$。\n7.  对于每个 $X^\\star_i$，计算残差 $|f(X^\\star_i; \\mu)|$ 并找到最大值 $R_{\\max}$。\n8.  对于每个 $X^\\star_i$，计算 $|\\lambda(X^\\star_i; \\mu)|$ 并找到最小值 $L_{\\min}$。\n9.  将这四个指标编译并格式化为最终输出所指定的列表结构。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the bifurcation analysis problem for the given ODE.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        -0.350,\n        0.000,\n        0.300,\n        2 / (3 * np.sqrt(3)),\n        -2 / (3 * np.sqrt(3)),\n        0.500\n    ]\n\n    # Tolerance for identifying a root as purely real.\n    TOLERANCE_IMAG = 1e-9\n    # Tolerance for merging near-duplicate roots.\n    TOLERANCE_MERGE = 1e-8\n\n    # Store results for all test cases.\n    all_results = []\n\n    for mu in test_cases:\n        # Define the coefficients of the polynomial -X^3 + X + mu = 0.\n        coeffs = [-1, 0, 1, mu]\n\n        # Use numpy.roots to find all roots (real and complex).\n        roots = np.roots(coeffs)\n\n        # Filter for purely real roots by checking the imaginary part.\n        real_roots = sorted([r.real for r in roots if abs(r.imag)  TOLERANCE_IMAG])\n\n        # Merge duplicates that arise at degenerate cases.\n        if not real_roots:\n            distinct_roots = []\n        else:\n            distinct_roots = [real_roots[0]]\n            for i in range(1, len(real_roots)):\n                if abs(real_roots[i] - distinct_roots[-1]) > TOLERANCE_MERGE:\n                    distinct_roots.append(real_roots[i])\n        \n        X_stars = np.array(distinct_roots)\n        \n        # Calculate diagnostic metrics.\n        N_eq = len(X_stars)\n\n        if N_eq == 0:\n            # This case will not occur for a cubic polynomial with real coefficients,\n            # but is included for algorithmic robustness.\n            N_st = 0\n            R_max = 0.0\n            L_min = 0.0\n        else:\n            # Calculate residuals: f(X;mu) = mu + X - X^3\n            residuals = np.abs(mu + X_stars - X_stars**3)\n            R_max = np.max(residuals)\n\n            # Calculate stability coefficients: lambda = 1 - 3*X^2\n            lambdas = 1 - 3 * X_stars**2\n            L_min = np.min(np.abs(lambdas))\n            \n            # Count the number of stable equilibria (lambda  0).\n            N_st = int(np.sum(lambdas  0))\n\n        # Format the results for the current test case.\n        # R_max and L_min must be formatted to 8 decimal places.\n        case_result_str = (\n            f\"[{N_eq},\"\n            f\"{N_st},\"\n            f\"{R_max:.8f},\"\n            f\"{L_min:.8f}]\"\n        )\n        all_results.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # e.g., [[N_eq,N_st,R_max,L_min],[...],...] with no spaces.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这个实践将探讨接近气候临界点所带来的一个关键后果：可预测性的丧失。通过研究一个接近鞍结分岔点的系统，您将学习使用变分方程来量化初始条件和模型参数中的微小不确定性是如何随时间被放大的。这项练习清晰地表明，为何临界点的早期预警信号和分岔结构分析不仅是理论上的追求，更是对实际气候预测和风险评估至关重要。",
            "id": "3865520",
            "problem": "考虑一个无量纲化的一维气候子系统，其模型为一个鞍结分岔范式的常微分方程（ODE）。设状态变量为 $x$，控制参数为 $\\mu$。该系统根据以下方程演化：\n$$\n\\frac{dx}{dt} = f(x,\\mu) = \\mu - x^2,\n$$\n初始条件为 $x(0) = x_0$。对于 $\\mu  0$，系统在 $x^\\star = \\sqrt{\\mu}$ 处存在一个稳定平衡点，而分岔（双曲稳定性的丧失）发生在 $\\mu = 0$。\n\n在分岔点附近，由于对初始条件和参数不确定性的灵敏度增加，预报技巧会下降。您的任务是在有限的预报时域内，通过计算 $x_0$ 和 $\\mu$ 中的微小不确定性如何传播到 $x(T)$（其中 $T$ 为预报时效）中的不确定性，来量化这种下降。请使用以下基础理论：\n- 流映射 $\\Phi_T(x_0,\\mu)$ 由初值问题的解 $x(t)$ 在 $t = T$ 处的值定义。\n- 针对独立来源的一阶不确定性传播理论指出，在不确定性很小的情况下，预报量的方差等于每个来源的方差通过流映射灵敏度的平方传播后的总和。\n\n设 $\\sigma_{x_0}^2$ 为 $x_0$ 中不确定性的方差，$\\sigma_{\\mu}^2$ 为 $\\mu$ 中不确定性的方差。将预报时效为 $T$ 时的预报技巧指数 $S$ 定义为：\n$$\nS = \\frac{1}{1 + \\frac{V_f}{V_0}},\n$$\n其中 $V_f$ 是通过一阶传播计算出的在时间 $T$ 的预报方差，$V_0 = \\sigma_{x_0}^2 + \\sigma_{\\mu}^2$ 是基准方差。预报技巧 $S$ 是无量纲的。相对于 $V_0$，较大的 $V_f$ 意味着较小的 $S$。\n\n开发一个完整的程序，该程序能够：\n1. 通过求解从该 ODE 和流映射定义中导出的相应变分方程，计算系统 $\\frac{dx}{dt} = \\mu - x^2$ 在指定 $(x_0,\\mu)$ 处的流映射 $\\Phi_T(x_0,\\mu)$ 以及灵敏度 $\\frac{\\partial \\Phi_T}{\\partial x_0}$ 和 $\\frac{\\partial \\Phi_T}{\\partial \\mu}$。\n2. 假设 $x_0$ 和 $\\mu$ 中的不确定性是独立的，并且足够小以使一阶传播有效，使用这些灵敏度计算预报方差：\n$$\nV_f = \\left(\\frac{\\partial \\Phi_T}{\\partial x_0}\\right)^2 \\sigma_{x_0}^2 + \\left(\\frac{\\partial \\Phi_T}{\\partial \\mu}\\right)^2 \\sigma_{\\mu}^2,\n$$\n3. 返回每个测试用例的预报技巧指数 $S$。\n\n此问题中的所有变量均为无量纲，预报时效为 $T = 5$。对每个测试用例，使用 $x_0 = \\sqrt{\\max(\\mu, 0)}$。使用 $\\sigma_{x_0} = 1 \\times 10^{-3}$ 和 $\\sigma_{\\mu} = 1 \\times 10^{-3}$。\n\n测试套件：\n- 情况 1：$\\mu = 0.5$（远离分岔点；稳定平衡点明确）。\n- 情况 2：$\\mu = 0.1$（更接近分岔点）。\n- 情况 3：$\\mu = 0.01$（非常接近分岔点）。\n- 情况 4：$\\mu = 0.0$（在分岔点上；非双曲平衡点）。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $[s_1,s_2,s_3,s_4]$，其中每个 $s_i$ 是相应情况下的预报技巧指数 $S$，以浮点数表示。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于动力系统理论和分岔分析，特别是使用了鞍结分岔的范式。该问题是适定的，为得到唯一且有意义的解提供了所有必要的数据和定义。其语言客观、精确，设定内部一致且无事实错误。\n\n任务是为一个由常微分方程（ODE）$\\frac{dx}{dt} = \\mu - x^2$ 描述的简单气候子系统模型计算预报技巧指数 $S$。该指数用于量化分岔点 $\\mu=0$ 附近预报技巧的下降程度。$S$ 的计算依赖于预报方差 $V_f$，而 $V_f$ 是通过将状态 $x_0$ 和参数 $\\mu$ 的初始不确定性在预报时域 $T$ 内传播来确定的。这种传播需要计算最终状态 $x(T)$ 相对于 $x_0$ 和 $\\mu$ 的灵敏度。\n\n设流映射为 $\\Phi_T(x_0, \\mu) = x(T)$，其中 $x(t)$ 是初值问题的解。灵敏度是此映射的偏导数，特别是在特定点 $(x_0, \\mu)$ 处求值的 $\\frac{\\partial \\Phi_T}{\\partial x_0}$ 和 $\\frac{\\partial \\Phi_T}{\\partial \\mu}$。这些灵敏度可以通过与原始 ODE 联立求解一个变分方程组来找到。\n\n设 $S_{x_0}(t) = \\frac{\\partial x(t)}{\\partial x_0}$ 和 $S_{\\mu}(t) = \\frac{\\partial x(t)}{\\partial \\mu}$。我们通过将原始 ODE $\\frac{dx}{dt} = \\mu - x^2$ 分别对 $x_0$ 和 $\\mu$ 求导，来推导这些灵敏度的控制方程。\n\n相对于初始条件的灵敏度 $S_{x_0}$：\n$$\n\\frac{d}{dt} S_{x_0} = \\frac{d}{dt} \\left( \\frac{\\partial x}{\\partial x_0} \\right) = \\frac{\\partial}{\\partial x_0} \\left( \\frac{dx}{dt} \\right) = \\frac{\\partial}{\\partial x_0} (\\mu - x^2)\n$$\n使用链式法则 $\\frac{\\partial f(x,\\mu)}{\\partial x_0} = \\frac{\\partial f}{\\partial x}\\frac{\\partial x}{\\partial x_0}$，我们得到：\n$$\n\\frac{dS_{x_0}}{dt} = (-2x) S_{x_0}\n$$\n初始条件通过将 $x(0) = x_0$ 对 $x_0$ 求导得到：\n$$\nS_{x_0}(0) = \\frac{\\partial x(0)}{\\partial x_0} = \\frac{\\partial x_0}{\\partial x_0} = 1\n$$\n\n相对于参数的灵敏度 $S_{\\mu}$：\n$$\n\\frac{d}{dt} S_{\\mu} = \\frac{d}{dt} \\left( \\frac{\\partial x}{\\partial \\mu} \\right) = \\frac{\\partial}{\\partial \\mu} \\left( \\frac{dx}{dt} \\right) = \\frac{\\partial}{\\partial \\mu} (\\mu - x^2)\n$$\n使用链式法则 $\\frac{\\partial f(x,\\mu)}{\\partial \\mu} = \\frac{\\partial f}{\\partial \\mu} + \\frac{\\partial f}{\\partial x}\\frac{\\partial x}{\\partial \\mu}$，我们得到：\n$$\n\\frac{dS_{\\mu}}{dt} = 1 + (-2x) S_{\\mu}\n$$\n初始条件通过将 $x(0) = x_0$ 对 $\\mu$ 求导得到。在计算偏导数 $\\frac{\\partial \\Phi_T}{\\partial \\mu}$ 时，初始条件 $x_0$ 被视为一个独立变量。因此：\n$$\nS_{\\mu}(0) = \\frac{\\partial x(0)}{\\partial \\mu} = \\frac{\\partial x_0}{\\partial \\mu} = 0\n$$\n\n我们必须求解以下从 $t=0$ 到 $t=T=5$ 的三个耦合常微分方程组：\n设状态向量为 $y(t) = [y_0(t), y_1(t), y_2(t)]^T \\equiv [x(t), S_{x_0}(t), S_{\\mu}(t)]^T$。\n$$\n\\frac{dy}{dt} =\n\\begin{pmatrix}\n\\mu - y_0^2 \\\\\n-2 y_0 y_1 \\\\\n1 - 2 y_0 y_2\n\\end{pmatrix}\n$$\n对于每个测试用例，参数 $\\mu$ 是给定的。轨迹的初始条件指定为 $x_0 = \\sqrt{\\max(\\mu, 0)}$。这意味着对于 $\\mu  0$ 的情况，我们从稳定平衡点 $x^\\star = \\sqrt{\\mu}$ 开始每个模拟；对于 $\\mu = 0$ 的情况，我们从非双曲平衡点 $x^\\star=0$ 开始。因此，对于任何测试用例，轨迹都是平凡的：对所有 $t$ 都有 $x(t) = x_0$。虽然这使得变分方程存在解析解，但问题所规定的数值解是一种更通用的方法，我们将予以实现。该系统的初始向量为：\n$$\ny(0) = [x_0, 1, 0]^T\n$$\n将系统积分到 $T=5$ 后，最终状态向量为 $y(T) = [\\Phi_T, \\frac{\\partial \\Phi_T}{\\partial x_0}, \\frac{\\partial \\Phi_T}{\\partial \\mu}]^T$。\n\n计算出灵敏度后，我们计算预报方差 $V_f$ 和预报技巧指数 $S$。问题提供了 $\\sigma_{x_0} = 1 \\times 10^{-3}$ 和 $\\sigma_{\\mu} = 1 \\times 10^{-3}$，因此方差为 $\\sigma_{x_0}^2 = 1 \\times 10^{-6}$ 和 $\\sigma_{\\mu}^2 = 1 \\times 10^{-6}$。\n\n基准方差为 $V_0 = \\sigma_{x_0}^2 + \\sigma_{\\mu}^2 = 2 \\times 10^{-6}$。\n预报方差为 $V_f = \\left(\\frac{\\partial \\Phi_T}{\\partial x_0}\\right)^2 \\sigma_{x_0}^2 + \\left(\\frac{\\partial \\Phi_T}{\\partial \\mu}\\right)^2 \\sigma_{\\mu}^2$。\n预报技巧指数为 $S = \\frac{1}{1 + V_f/V_0}$。\n\n每个测试用例的步骤如下：\n1.  设置 $\\mu$ 的值。\n2.  计算初始状态 $x_0 = \\sqrt{\\max(\\mu, 0)}$。\n3.  定义初始向量 $y(0) = [x_0, 1, 0]^T$。\n4.  数值求解从 $t=0$ 到 $t=T=5$ 的常微分方程组。\n5.  从 $t=T$ 时的解中提取灵敏度 $S_{x_0}(T)$ 和 $S_{\\mu}(T)$。\n6.  计算 $V_f$，然后计算 $S$。\n\n对测试套件中的每个 $\\mu$ 值重复此过程。结果表明，随着 $\\mu$ 接近分岔点 0，灵敏度 $\\frac{\\partial \\Phi_T}{\\partial \\mu}$ 会显著增长，导致预报方差 $V_f$ 增大，预报技巧 $S$ 相应降低。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Computes the forecast skill index for a simple climate model near a\n    saddle-node bifurcation.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases_mu = [0.5, 0.1, 0.01, 0.0]\n\n    # Define constants\n    T = 5.0  # Forecast lead time\n    sigma_x0 = 1e-3  # Uncertainty in initial condition\n    sigma_mu = 1e-3  # Uncertainty in parameter\n    \n    var_x0 = sigma_x0**2\n    var_mu = sigma_mu**2\n    V0 = var_x0 + var_mu  # Baseline variance\n\n    def system_ode(t, y, mu):\n        \"\"\"\n        Defines the system of coupled ODEs for the state and its sensitivities.\n        \n        Args:\n            t (float): Time.\n            y (np.ndarray): State vector [x, S_x0, S_mu].\n            mu (float): Control parameter.\n            \n        Returns:\n            np.ndarray: Derivatives [dx/dt, dS_x0/dt, dS_mu/dt].\n        \"\"\"\n        x, S_x0, S_mu = y\n        \n        # Original ODE\n        dx_dt = mu - x**2\n        \n        # Variational equation for sensitivity to x0\n        dS_x0_dt = -2.0 * x * S_x0\n        \n        # Variational equation for sensitivity to mu\n        dS_mu_dt = 1.0 - 2.0 * x * S_mu\n        \n        return np.array([dx_dt, dS_x0_dt, dS_mu_dt])\n\n    results = []\n    for mu in test_cases_mu:\n        # 1. Determine initial condition for the state variable\n        # The problem specifies starting at the equilibrium point.\n        x0 = np.sqrt(np.maximum(mu, 0))\n        \n        # 2. Set the initial vector for the full system [x, S_x0, S_mu]\n        # S_x0(0) = d(x(0))/d(x0) = 1\n        # S_mu(0) = d(x(0))/d(mu) = 0 (partial derivative)\n        y0 = np.array([x0, 1.0, 0.0])\n        \n        # 3. Solve the system of ODEs\n        # We use a high-precision solver to handle stiffness near the bifurcation\n        sol = solve_ivp(\n            fun=system_ode,\n            t_span=[0, T],\n            y0=y0,\n            args=(mu,),\n            method='RK45',\n            rtol=1e-9,\n            atol=1e-12\n        )\n        \n        # 4. Extract sensitivities at the final time T\n        y_T = sol.y[:, -1]\n        # x_T = y_T[0]  # Not needed for skill index calculation\n        S_x0_T = y_T[1]\n        S_mu_T = y_T[2]\n        \n        # 5. Compute the forecast variance Vf\n        Vf = (S_x0_T**2) * var_x0 + (S_mu_T**2) * var_mu\n        \n        # 6. Compute the forecast skill index S\n        S = 1.0 / (1.0 + Vf / V0)\n        \n        results.append(S)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}