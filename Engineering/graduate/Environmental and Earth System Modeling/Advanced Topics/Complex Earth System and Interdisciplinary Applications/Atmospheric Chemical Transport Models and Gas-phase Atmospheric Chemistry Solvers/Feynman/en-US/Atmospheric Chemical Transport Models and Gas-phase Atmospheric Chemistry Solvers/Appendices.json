{
    "hands_on_practices": [
        {
            "introduction": "Implicit numerical solvers are essential for integrating the stiff systems of ordinary differential equations that describe atmospheric chemistry, and the Jacobian matrix is the cornerstone of their efficiency and stability. This practice provides foundational experience in deriving this crucial matrix directly from a chemical mechanism (), focusing on the core $NO_x$-$O_3$ photostationary state reactions. By translating these chemical interactions into the mathematical language of partial derivatives, you will gain a concrete understanding of the structure required by the solvers in modern chemical transport models.",
            "id": "3863642",
            "problem": "Consider a zero-dimensional chemical box model representative of a grid cell in an atmospheric chemical transport model (CTM), focusing on the gas-phase photostationary subsystem involving ozone and nitrogen oxides. Assume constant temperature and pressure over the solver time step, such that the number densities of molecular oxygen and the third body are constant. The chemical mechanism is limited to the following reactions:\n1. $NO + O_{3} \\to NO_{2} + O_{2}$,\n2. $NO_{2} + h\\nu \\to NO + O$,\n3. $O + O_{2} + M \\to O_{3} + M$.\n\nAssume the Law of Mass Action holds for bimolecular and termolecular reactions, and treat the photolysis frequency as constant over the time step. Define the species concentration vector as $\\mathbf{x} = \\big([O_{3}], [NO], [NO_{2}], [O]\\big)$, and let the rate coefficients be $k_{1}$ for the $NO + O_{3}$ reaction, $J$ for the $NO_{2}$ photolysis, and $k_{3}$ for the $O + O_{2} + M$ recombination. The concentrations $[O_{2}]$ and $[M]$ are constants determined by the background atmosphere.\n\nStarting from the fundamental principles of mass conservation and the Law of Mass Action, derive the system of ordinary differential equations for $\\mathbf{x}$ that represent the net chemical production minus loss for each species. Then, compute the Jacobian matrix $\\mathbf{J} = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{x}}$ of the chemical tendency vector $\\mathbf{f}(\\mathbf{x})$, where $\\mathbf{f}(\\mathbf{x})$ is the right-hand side of the ordinary differential equations. Identify the sign pattern of each Jacobian entry in terms of production and loss couplings implied by the mechanism.\n\nProvide, as your final answer, the full $4 \\times 4$ Jacobian matrix written as an analytic expression in terms of $k_{1}$, $J$, $k_{3}$, $[O_{2}]$, $[M]$, $[O_{3}]$, and $[NO]$, ordered according to $\\mathbf{x} = \\big([O_{3}], [NO], [NO_{2}], [O]\\big)$. Express the final answer exactly; do not round. Do not include units in the final answer.",
            "solution": "The problem is first validated against the required criteria.\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n-   **Model**: Zero-dimensional chemical box model.\n-   **System**: Gas-phase photostationary subsystem involving ozone ($O_{3}$), nitric oxide ($NO$), nitrogen dioxide ($NO_{2}$), and atomic oxygen ($O$).\n-   **Reactions**:\n    1.  $NO + O_{3} \\to NO_{2} + O_{2}$ with rate coefficient $k_{1}$.\n    2.  $NO_{2} + h\\nu \\to NO + O$ with photolysis frequency $J$.\n    3.  $O + O_{2} + M \\to O_{3} + M$ with rate coefficient $k_{3}$.\n-   **Assumptions**: Law of Mass Action holds; temperature and pressure are constant.\n-   **Constants**: Rate coefficients $k_{1}$ and $k_{3}$; photolysis frequency $J$; number densities $[O_{2}]$ and $[M]$.\n-   **Species Vector**: $\\mathbf{x} = \\big([O_{3}], [NO], [NO_{2}], [O]\\big)$.\n-   **Task**: \n    1. Derive the system of ordinary differential equations (ODEs), $\\frac{d\\mathbf{x}}{dt} = \\mathbf{f}(\\mathbf{x})$.\n    2. Compute the Jacobian matrix $\\mathbf{J} = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{x}}$.\n    3. Provide the full $4 \\times 4$ Jacobian matrix as the final answer.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Groundedness**: The problem describes the core chemical reactions of the photostationary state for tropospheric and stratospheric ozone, a fundamental concept in atmospheric chemistry. The use of the Law of Mass Action is standard for modeling chemical kinetics. The problem is scientifically sound.\n-   **Well-Posedness**: The problem clearly defines the chemical system and asks for the derivation of the governing kinetic equations and their Jacobian. This is a standard and well-defined mathematical task with a unique solution.\n-   **Objectivity**: The problem statement is expressed in precise, unbiased, and standard scientific language.\n\n**Step 3: Verdict and Action**\nThe problem is valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. We may proceed to the solution.\n\n**Derivation of the Solution**\n\nThe rate of change for the concentration of each species is determined by the sum of the rates of reactions that produce it minus the sum of the rates of reactions that consume it. The rates of the three reactions, based on the Law of Mass Action, are:\n-   Rate of reaction 1: $R_{1} = k_{1} [NO] [O_{3}]$\n-   Rate of reaction 2: $R_{2} = J [NO_{2}]$\n-   Rate of reaction 3: $R_{3} = k_{3} [O] [O_{2}] [M]$\n\nUsing these rate expressions, we can write the system of ordinary differential equations (ODEs) for the net rate of change of each species in the vector $\\mathbf{x} = \\big([O_{3}], [NO], [NO_{2}], [O]\\big)$.\n\n1.  **For $[O_{3}]$**: Ozone is produced in reaction 3 and consumed in reaction 1.\n    $$ \\frac{d[O_{3}]}{dt} = R_{3} - R_{1} = k_{3} [O] [O_{2}] [M] - k_{1} [NO] [O_{3}] $$\n\n2.  **For $[NO]$**: Nitric oxide is produced in reaction 2 and consumed in reaction 1.\n    $$ \\frac{d[NO]}{dt} = R_{2} - R_{1} = J [NO_{2}] - k_{1} [NO] [O_{3}] $$\n\n3.  **For $[NO_{2}]$**: Nitrogen dioxide is produced in reaction 1 and consumed in reaction 2.\n    $$ \\frac{d[NO_{2}]}{dt} = R_{1} - R_{2} = k_{1} [NO] [O_{3}] - J [NO_{2}] $$\n\n4.  **For $[O]$**: Atomic oxygen is produced in reaction 2 and consumed in reaction 3.\n    $$ \\frac{d[O]}{dt} = R_{2} - R_{3} = J [NO_{2}] - k_{3} [O] [O_{2}] [M] $$\n\nThis system of ODEs defines the chemical tendency vector $\\mathbf{f}(\\mathbf{x}) = \\frac{d\\mathbf{x}}{dt}$. Let $x_{1}=[O_{3}]$, $x_{2}=[NO]$, $x_{3}=[NO_{2}]$, and $x_{4}=[O]$. The components of $\\mathbf{f}(\\mathbf{x})$ are:\n$$\nf_{1}(\\mathbf{x}) = k_{3} x_{4} [O_{2}] [M] - k_{1} x_{2} x_{1} \\\\\nf_{2}(\\mathbf{x}) = J x_{3} - k_{1} x_{2} x_{1} \\\\\nf_{3}(\\mathbf{x}) = k_{1} x_{2} x_{1} - J x_{3} \\\\\nf_{4}(\\mathbf{x}) = J x_{3} - k_{3} x_{4} [O_{2}] [M]\n$$\n\nThe Jacobian matrix $\\mathbf{J}$ is a $4 \\times 4$ matrix where each element $J_{ij}$ is the partial derivative of the $i$-th rate function with respect to the $j$-th species concentration, $J_{ij} = \\frac{\\partial f_{i}}{\\partial x_{j}}$. We compute these partial derivatives.\n\n**Row 1 of $\\mathbf{J}$ (Derivatives of $f_{1}$):**\n-   $J_{11} = \\frac{\\partial f_{1}}{\\partial [O_{3}]} = \\frac{\\partial}{\\partial x_{1}}(k_{3} x_{4} [O_{2}] [M] - k_{1} x_{2} x_{1}) = -k_{1} x_{2} = -k_{1} [NO]$\n-   $J_{12} = \\frac{\\partial f_{1}}{\\partial [NO]} = \\frac{\\partial}{\\partial x_{2}}(k_{3} x_{4} [O_{2}] [M] - k_{1} x_{2} x_{1}) = -k_{1} x_{1} = -k_{1} [O_{3}]$\n-   $J_{13} = \\frac{\\partial f_{1}}{\\partial [NO_{2}]} = \\frac{\\partial}{\\partial x_{3}}(k_{3} x_{4} [O_{2}] [M] - k_{1} x_{2} x_{1}) = 0$\n-   $J_{14} = \\frac{\\partial f_{1}}{\\partial [O]} = \\frac{\\partial}{\\partial x_{4}}(k_{3} x_{4} [O_{2}] [M] - k_{1} x_{2} x_{1}) = k_{3} [O_{2}] [M]$\n\n**Row 2 of $\\mathbf{J}$ (Derivatives of $f_{2}$):**\n-   $J_{21} = \\frac{\\partial f_{2}}{\\partial [O_{3}]} = \\frac{\\partial}{\\partial x_{1}}(J x_{3} - k_{1} x_{2} x_{1}) = -k_{1} x_{2} = -k_{1} [NO]$\n-   $J_{22} = \\frac{\\partial f_{2}}{\\partial [NO]} = \\frac{\\partial}{\\partial x_{2}}(J x_{3} - k_{1} x_{2} x_{1}) = -k_{1} x_{1} = -k_{1} [O_{3}]$\n-   $J_{23} = \\frac{\\partial f_{2}}{\\partial [NO_{2}]} = \\frac{\\partial}{\\partial x_{3}}(J x_{3} - k_{1} x_{2} x_{1}) = J$\n-   $J_{24} = \\frac{\\partial f_{2}}{\\partial [O]} = \\frac{\\partial}{\\partial x_{4}}(J x_{3} - k_{1} x_{2} x_{1}) = 0$\n\n**Row 3 of $\\mathbf{J}$ (Derivatives of $f_{3}$):**\n-   $J_{31} = \\frac{\\partial f_{3}}{\\partial [O_{3}]} = \\frac{\\partial}{\\partial x_{1}}(k_{1} x_{2} x_{1} - J x_{3}) = k_{1} x_{2} = k_{1} [NO]$\n-   $J_{32} = \\frac{\\partial f_{3}}{\\partial [NO]} = \\frac{\\partial}{\\partial x_{2}}(k_{1} x_{2} x_{1} - J x_{3}) = k_{1} x_{1} = k_{1} [O_{3}]$\n-   $J_{33} = \\frac{\\partial f_{3}}{\\partial [NO_{2}]} = \\frac{\\partial}{\\partial x_{3}}(k_{1} x_{2} x_{1} - J x_{3}) = -J$\n-   $J_{34} = \\frac{\\partial f_{3}}{\\partial [O]} = \\frac{\\partial}{\\partial x_{4}}(k_{1} x_{2} x_{1} - J x_{3}) = 0$\n\n**Row 4 of $\\mathbf{J}$ (Derivatives of $f_{4}$):**\n-   $J_{41} = \\frac{\\partial f_{4}}{\\partial [O_{3}]} = \\frac{\\partial}{\\partial x_{1}}(J x_{3} - k_{3} x_{4} [O_{2}] [M]) = 0$\n-   $J_{42} = \\frac{\\partial f_{4}}{\\partial [NO]} = \\frac{\\partial}{\\partial x_{2}}(J x_{3} - k_{3} x_{4} [O_{2}] [M]) = 0$\n-   $J_{43} = \\frac{\\partial f_{4}}{\\partial [NO_{2}]} = \\frac{\\partial}{\\partial x_{3}}(J x_{3} - k_{3} x_{4} [O_{2}] [M]) = J$\n-   $J_{44} = \\frac{\\partial f_{4}}{\\partial [O]} = \\frac{\\partial}{\\partial x_{4}}(J x_{3} - k_{3} x_{4} [O_{2}] [M]) = -k_{3} [O_{2}] [M]$\n\nThe diagonal elements of the Jacobian, $J_{ii}$, represent the feedback of a species on its own rate of change. All diagonal elements are negative, indicating that an increase in any species' concentration enhances its own net destruction rate. This is characteristic of a stable chemical system and is a crucial property for the stability of numerical solvers used in CTMs. The off-diagonal elements, $J_{ij}$ for $i \\neq j$, represent the chemical coupling between species. A positive $J_{ij}$ means species $j$ produces species $i$, while a negative value means species $j$ consumes species $i$. For example, $J_{14} = k_{3}[O_{2}][M] > 0$ shows that an increase in atomic oxygen, $[O]$, leads to an increase in the production rate of ozone, $[O_{3}]$. Conversely, $J_{12} = -k_{1}[O_{3}] < 0$ shows that an increase in nitric oxide, $[NO]$, increases the loss rate of ozone.\n\nAssembling the elements gives the final Jacobian matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-k_{1} [NO] & -k_{1} [O_{3}] & 0 & k_{3} [O_{2}] [M] \\\\\n-k_{1} [NO] & -k_{1} [O_{3}] & J & 0 \\\\\nk_{1} [NO] & k_{1} [O_{3}] & -J & 0 \\\\\n0 & 0 & J & -k_{3} [O_{2}] [M]\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A robust chemical model must not only describe reaction rates but also respect fundamental thermodynamic laws at equilibrium, a connection provided by the principle of microscopic reversibility. This exercise () challenges you to build and run a numerical simulation that explicitly verifies this principle for a reversible reaction. By integrating the kinetic system to its long-time steady state, you will confirm that the dynamic outcome correctly converges to the equilibrium state predicted by thermodynamic data, a critical validation for any chemical solver.",
            "id": "3863617",
            "problem": "Consider a single grid cell in a gas-phase atmospheric chemistry model where the reversible reaction $A + B \\leftrightarrow C$ occurs. The state variables are the molar concentrations $[A](t)$, $[B](t)$, and $[C](t)$ in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$, evolving under the law of mass action. The forward rate coefficient $k_f(T)$ (units $\\mathrm{m}^3\\,\\mathrm{mol}^{-1}\\,\\mathrm{s}^{-1}$) is assumed to follow an Arrhenius temperature dependence, and the reverse rate coefficient $k_r(T)$ (units $\\mathrm{s}^{-1}$) is constrained by thermodynamic microreversibility via the equilibrium constant $K_{\\mathrm{th}}(T)$ obtained from the standard Gibbs free energy change. The fundamental basis to use is: (i) the law of mass action, (ii) Arrhenius kinetics for elementary reactions, and (iii) equilibrium thermodynamics linking the equilibrium constant to the standard Gibbs free energy.\n\nYour task is to derive and implement a solver for the time-dependent concentrations, and then verify that the long-time numerical solution approaches thermodynamic equilibrium consistent with $K_{\\mathrm{th}}(T)$. You must proceed from explicit definitions and the conservation laws implied by the stoichiometry, without invoking shortcut formulas that jump directly to the target result.\n\nUse the following fundamental facts and definitions as your starting point:\n- The law of mass action gives the Ordinary Differential Equation (ODE) system\n$$\\frac{d[A]}{dt} = -k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C],\\quad \\frac{d[B]}{dt} = -k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C],\\quad \\frac{d[C]}{dt} = k_f(T)\\,[A]\\,[B] - k_r(T)\\,[C].$$\n- Arrhenius kinetics: $$k_f(T) = A_f\\,\\exp\\!\\left(-\\frac{E_{a,f}}{R\\,T}\\right),$$ where $A_f$ has units $\\mathrm{m}^3\\,\\mathrm{mol}^{-1}\\,\\mathrm{s}^{-1}$, $E_{a,f}$ has units $\\mathrm{J}\\,\\mathrm{mol}^{-1}$, $R$ is the universal gas constant (units $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$), and $T$ is temperature in $\\mathrm{K}$. The reverse rate coefficient must satisfy microreversibility at equilibrium, which in the presence of an equilibrium constant $K_{\\mathrm{th}}(T)$ implies $$k_r(T) = \\frac{k_f(T)}{K_{\\mathrm{th}}(T)}.$$\n- Equilibrium thermodynamics gives $$K_{\\mathrm{th}}(T) = \\exp\\!\\left(-\\frac{\\Delta G^\\circ(T)}{R\\,T}\\right),\\quad \\Delta G^\\circ(T) = \\Delta H^\\circ - T\\,\\Delta S^\\circ,$$ where $\\Delta H^\\circ$ is the standard enthalpy change (units $\\mathrm{J}\\,\\mathrm{mol}^{-1}$) and $\\Delta S^\\circ$ is the standard entropy change (units $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$).\n\nThe program you write must:\n- Implement $k_f(T)$, $K_{\\mathrm{th}}(T)$, and $k_r(T) = k_f(T)/K_{\\mathrm{th}}(T)$ as defined above for each test case.\n- Solve the ODE system for $[A](t)$, $[B](t)$, $[C](t)$ using a numerically stable method appropriate for stiff systems. Continue integration until a steady state is reached, quantified by the normalized flux residual\n$$\\rho = \\frac{\\left|k_f(T)\\,[A]\\,[B] - k_r(T)\\,[C]\\right|}{k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C] + \\epsilon},$$\nwhere $\\epsilon$ is a small positive number to avoid division by zero; use $\\epsilon = 10^{-300}$ with units consistent with the numerator and denominator. Terminate when $\\rho < 10^{-6}$ or when a reasonable upper time bound is reached by progressive time-interval extension.\n- At the final time (the long-time limit), compute the numerical equilibrium ratio $$K_{\\mathrm{num}} = \\frac{[C]}{[A]\\,[B]}$$ and compare it to the thermodynamic $K_{\\mathrm{th}}(T)$ and to the kinetic ratio $K_{\\mathrm{kin}} = k_f(T)/k_r(T)$.\n- Report three floats per test case: the absolute difference $|K_{\\mathrm{num}} - K_{\\mathrm{th}}|$, the absolute difference $|K_{\\mathrm{num}} - K_{\\mathrm{kin}}|$, and the final $\\rho$.\n\nUnits and numerical requirements:\n- Concentrations must be in $\\mathrm{mol}\\,\\mathrm{m}^{-3}$, temperature in $\\mathrm{K}$, $A_f$ in $\\mathrm{m}^3\\,\\mathrm{mol}^{-1}\\,\\mathrm{s}^{-1}$, $E_{a,f}$ and $\\Delta H^\\circ$ in $\\mathrm{J}\\,\\mathrm{mol}^{-1}$, $\\Delta S^\\circ$ in $\\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, and time in $\\mathrm{s}$.\n- Use $R = 8.314462618\\ \\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- The long-time limit must be approached numerically (do not solve the algebraic equilibrium relation analytically in the program). Ensure non-negativity of concentrations throughout; if numerical roundoff produces small negative values, project them back to non-negative values before computing diagnostics.\n\nTest suite:\nProvide three scientifically plausible and self-consistent test cases. For each case, specify $(T, A_f, E_{a,f}, \\Delta H^\\circ, \\Delta S^\\circ, [A]_0, [B]_0, [C]_0)$:\n- Case $1$ (general case, moderate equilibrium): $T = 298$, $A_f = 1.0\\times 10^{5}$, $E_{a,f} = 5000$, $\\Delta H^\\circ = -20000$, $\\Delta S^\\circ = -60$, $[A]_0 = 1.0\\times 10^{-3}$, $[B]_0 = 2.0\\times 10^{-3}$, $[C]_0 = 0.0$.\n- Case $2$ (lower temperature, stronger equilibrium, with some product initially present): $T = 250$, $A_f = 1.0\\times 10^{5}$, $E_{a,f} = 5000$, $\\Delta H^\\circ = -25000$, $\\Delta S^\\circ = -55$, $[A]_0 = 5.0\\times 10^{-4}$, $[B]_0 = 5.0\\times 10^{-4}$, $[C]_0 = 1.0\\times 10^{-5}$.\n- Case $3$ (higher temperature, weaker equilibrium, reactant imbalance): $T = 310$, $A_f = 1.0\\times 10^{5}$, $E_{a,f} = 5000$, $\\Delta H^\\circ = -15000$, $\\Delta S^\\circ = -70$, $[A]_0 = 1.0\\times 10^{-3}$, $[B]_0 = 1.0\\times 10^{-4}$, $[C]_0 = 0.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of three-element lists, one per test case, enclosed in square brackets. For example: $[[r_{1,1},r_{1,2},r_{1,3}],[r_{2,1},r_{2,2},r_{2,3}],[r_{3,1},r_{3,2},r_{3,3}]]$, where each $r_{i,j}$ is a float as defined above. No other text should be printed.",
            "solution": "The user has provided a problem statement that requires validation prior to a solution.\n\n### Step 1: Extract Givens\n- **Governing Reaction:** A reversible gas-phase reaction $A + B \\leftrightarrow C$.\n- **State Variables:** Molar concentrations $[A](t)$, $[B](t)$, $[C](t)$ in units of $\\mathrm{mol}\\,\\mathrm{m}^{-3}$.\n- **Kinetic Model:** The system evolves according to the law of mass action, described by the Ordinary Differential Equation (ODE) system:\n$$\n\\frac{d[A]}{dt} = -k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C] \\\\\n\\frac{d[B]}{dt} = -k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C] \\\\\n\\frac{d[C]}{dt} = k_f(T)\\,[A]\\,[B] - k_r(T)\\,[C]\n$$\n- **Forward Rate Coefficient:** The temperature dependence is given by the Arrhenius equation:\n$$k_f(T) = A_f\\,\\exp\\!\\left(-\\frac{E_{a,f}}{R\\,T}\\right)$$\n- **Reverse Rate Coefficient:** This is constrained by the principle of microreversibility:\n$$k_r(T) = \\frac{k_f(T)}{K_{\\mathrm{th}}(T)}$$\n- **Thermodynamic Equilibrium Constant:** This is derived from the standard Gibbs free energy change:\n$$K_{\\mathrm{th}}(T) = \\exp\\!\\left(-\\frac{\\Delta G^\\circ(T)}{R\\,T}\\right)$$\nwhere $\\Delta G^\\circ(T) = \\Delta H^\\circ - T\\,\\Delta S^\\circ$.\n- **Physical Constant:** The universal gas constant $R = 8.314462618\\ \\mathrm{J}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$.\n- **Numerical Task:** Solve the ODE system until a steady state is reached.\n- **Termination Criterion:** The integration stops when the normalized flux residual $\\rho$ is less than $10^{-6}$:\n$$\\rho = \\frac{\\left|k_f(T)\\,[A]\\,[B] - k_r(T)\\,[C]\\right|}{k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C] + \\epsilon}$$\nwhere $\\epsilon = 10^{-300}$.\n- **Output Metrics:** For each test case, report the three values: $|K_{\\mathrm{num}} - K_{\\mathrm{th}}|$, $|K_{\\mathrm{num}} - K_{\\mathrm{kin}}|$, and the final $\\rho$, where:\n    - $K_{\\mathrm{num}} = \\frac{[C]}{[A]\\,[B]}$ at the final long-time state.\n    - $K_{\\mathrm{kin}} = k_f(T)/k_r(T)$.\n- **Test Cases:** Three distinct sets of parameters and initial conditions are provided:\n    1.  $(T, A_f, E_{a,f}, \\Delta H^\\circ, \\Delta S^\\circ, [A]_0, [B]_0, [C]_0) = (298\\,\\mathrm{K}, 1.0\\times 10^{5}, 5000, -20000, -60, 1.0\\times 10^{-3}, 2.0\\times 10^{-3}, 0.0)$\n    2.  $(T, A_f, E_{a,f}, \\Delta H^\\circ, \\Delta S^\\circ, [A]_0, [B]_0, [C]_0) = (250\\,\\mathrm{K}, 1.0\\times 10^{5}, 5000, -25000, -55, 5.0\\times 10^{-4}, 5.0\\times 10^{-4}, 1.0\\times 10^{-5})$\n    3.  $(T, A_f, E_{a,f}, \\Delta H^\\circ, \\Delta S^\\circ, [A]_0, [B]_0, [C]_0) = (310\\,\\mathrm{K}, 1.0\\times 10^{5}, 5000, -15000, -70, 1.0\\times 10^{-3}, 1.0\\times 10^{-4}, 0.0)$\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is based on cornerstone principles of physical chemistry: the law of mass action, Arrhenius kinetics, and the thermodynamic definition of the equilibrium constant. The link between kinetics and thermodynamics via the principle of microreversibility is a standard and fundamental concept. The problem is chemically and mathematically sound.\n2.  **Well-Posed:** The problem defines a complete initial value problem for a system of ODEs. All necessary parameters, initial conditions, and constants are provided. The objective and the required output are specified precisely. A unique and stable solution is expected to exist.\n3.  **Objective:** The language is formal and quantitative, free from any subjectivity or ambiguity.\n4.  **Flaw Analysis:**\n    - The problem has no scientific or factual unsoundness.\n    - It is a formalizable problem directly relevant to computational atmospheric chemistry.\n    - The setup is complete and self-consistent. The definition $k_r = k_f/K_{\\mathrm{th}}$ is a central constraint of the problem, not a contradiction; the task is to numerically verify that the system dynamics honor this constraint.\n    - The provided data values are physically realistic and dimensionally consistent.\n    - The problem structure is clear and leads to a meaningful numerical experiment.\n    - While the relationship $K_{\\mathrm{kin}} = K_{\\mathrm{th}}$ is true by definition within the problem setup, the numerical verification that $K_{\\mathrm{num}} \\to K_{\\mathrm{th}}$ is a non-trivial task that validates the consistency of the entire model (dynamics approaching thermodynamic equilibrium).\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-posed, scientifically sound exercise in numerical chemical kinetics. I will proceed with a full solution.\n\n### Solution and Implementation Design\n\nThe problem requires solving a system of ordinary differential equations (ODEs) that describe the time evolution of concentrations in a reversible chemical reaction, and then verifying that the long-time (equilibrium) state of the system is consistent with thermodynamic predictions.\n\n**1. Fundamental Equations and Conservation Laws**\nThe kinetics of the reaction $A + B \\leftrightarrow C$ are governed by the law of mass action:\n$$\n\\frac{d[A]}{dt} = \\frac{d[B]}{dt} = -k_f(T)\\,[A]\\,[B] + k_r(T)\\,[C] \\\\\n\\frac{d[C]}{dt} = k_f(T)\\,[A]\\,[B] - k_r(T)\\,[C]\n$$\nFrom this system, we can deduce two independent conservation laws based on the reaction stoichiometry ($1$ mole of $A$ reacts with $1$ mole of $B$ to produce $1$ mole of $C$).\n- The difference in concentration between species $A$ and $B$ is constant:\n$\\frac{d}{dt}([A] - [B]) = 0 \\implies [A](t) - [B](t) = [A]_0 - [B]_0$.\n- The sum of concentrations of reactant $A$ and product $C$ (and similarly for $B$ and $C$) is constant, representing conservation of the 'A' and 'B' moieties:\n$\\frac{d}{dt}([A] + [C]) = 0 \\implies [A](t) + [C](t) = [A]_0 + [C]_0$.\n\nThese conservation laws reduce the dimensionality of the system from three to one. However, for numerical implementation, it is often more robust and straightforward to integrate the full system of three state variables and use the conservation laws as a check on the accuracy of the numerical solution. The state vector is $\\vec{y}(t) = ([A](t), [B](t), [C](t))$.\n\n**2. Rate Constants and Thermodynamic Consistency**\nThe problem explicitly defines the relationship between kinetics and thermodynamics. The forward rate constant, $k_f$, is defined by the Arrhenius equation, while the reverse rate constant, $k_r$, is not independent but is determined by $k_f$ and the thermodynamic equilibrium constant, $K_{\\mathrm{th}}$.\n$$ k_f(T) = A_f\\,\\exp\\!\\left(-\\frac{E_{a,f}}{R\\,T}\\right) \\quad \\text{and} \\quad K_{\\mathrm{th}}(T) = \\exp\\!\\left(-\\frac{\\Delta H^\\circ - T\\Delta S^\\circ}{R\\,T}\\right) $$\nThe principle of microscopic reversibility (or detailed balance) demands that at equilibrium, the forward and reverse rates are equal. This leads to the definition of the kinetic equilibrium ratio, $K_{\\mathrm{kin}}$:\n$$ k_f(T)\\,[A]_{\\text{eq}}\\,[B]_{\\text{eq}} = k_r(T)\\,[C]_{\\text{eq}} \\implies K_{\\mathrm{kin}} \\equiv \\frac{k_f(T)}{k_r(T)} = \\frac{[C]_{\\text{eq}}}{[A]_{\\text{eq}}\\,[B]_{\\text{eq}}} $$\nThe problem requires that the kinetic model be consistent with thermodynamics, so we set $K_{\\mathrm{kin}} = K_{\\mathrm{th}}$. This implies $k_r(T) = k_f(T) / K_{\\mathrm{th}}(T)$. The purpose of the exercise is to demonstrate that a numerical simulation of the time-dependent system, governed by these rate constants, naturally evolves to a state where the ratio of concentrations, which we call $K_{\\mathrm{num}} = [C]/([A][B])$, converges to both $K_{\\mathrm{kin}}$ and $K_{\\mathrm{th}}$.\n\n**3. Numerical Solution Strategy**\nChemical kinetic systems are often \"stiff,\" meaning they involve processes occurring on vastly different timescales. Near equilibrium, the forward and reverse reaction fluxes are large but their difference is small, which can pose a challenge for standard explicit ODE solvers. Therefore, an implicit solver designed for stiff systems is required. The `scipy.integrate.solve_ivp` function with the `method='Radau'` or `method='BDF'` is an excellent choice for this task.\n\nTo find the steady-state solution, we integrate the ODE system over progressively longer time intervals until the normalized flux residual, $\\rho$, falls below the specified tolerance of $10^{-6}$. This approach avoids having to guess the equilibrium timescale a priori. The algorithm is as follows:\n- Initialize the state vector $\\vec{y} = \\vec{y}_0$ at time $t=0$.\n- Set an initial time step, e.g., $\\Delta t = 1.0 \\, s$.\n- Loop:\n    1. Numerically integrate the system from the current time $t$ to $t + \\Delta t$ to obtain the new state $\\vec{y}_{\\text{new}}$.\n    2. Enforce non-negativity on the resulting concentrations by projecting any small negative values to $0.0$.\n    3. Calculate the residual $\\rho$ using the new state $\\vec{y}_{\\text{new}}$.\n    4. If $\\rho < 10^{-6}$, the system has reached equilibrium. Terminate the loop.\n    5. Otherwise, update the current state and time, increase the time step $\\Delta t$ (e.g., by doubling it), and continue.\n\n**4. Verification Metrics**\nUpon termination, the final state vector provides the numerical equilibrium concentrations $([A]_{\\text{eq}}, [B]_{\\text{eq}}, [C]_{\\text{eq}})$. From these, we compute:\n- The numerical equilibrium ratio: $K_{\\mathrm{num}} = [C]_{\\text{eq}} / ([A]_{\\text{eq}}\\,[B]_{\\text{eq}})$.\n- The absolute difference with the thermodynamic constant: $|K_{\\mathrm{num}} - K_{\\mathrm{th}}|$.\n- The absolute difference with the kinetic constant: $|K_{\\mathrm{num}} - K_{\\mathrm{kin}}|$. Since we defined $K_{\\mathrm{kin}} = K_{\\mathrm{th}}$, these two differences should be identical, limited only by floating-point precision. This confirms the logical consistency of the setup.\n- The final value of the residual, $\\rho_{\\text{final}}$, which should be less than $10^{-6}$.\n\nThe small, non-zero value of these differences will reflect the numerical precision of the ODE solver and the finite tolerance used for the termination criterion.\n\nThis procedure constitutes a complete and rigorous method for solving the problem and verifying the fundamental link between chemical dynamics and thermodynamics.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the chemical kinetics problem for the given test cases and prints the results.\n    \"\"\"\n    # Define the universal gas constant\n    R = 8.314462618  # J mol^-1 K^-1\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case, moderate equilibrium)\n        {\n            \"T\": 298.0, \"Af\": 1.0e5, \"Eaf\": 5000.0, \"dH0\": -20000.0, \"dS0\": -60.0,\n            \"A0\": 1.0e-3, \"B0\": 2.0e-3, \"C0\": 0.0\n        },\n        # Case 2 (lower temperature, stronger equilibrium, with some product initially present)\n        {\n            \"T\": 250.0, \"Af\": 1.0e5, \"Eaf\": 5000.0, \"dH0\": -25000.0, \"dS0\": -55.0,\n            \"A0\": 5.0e-4, \"B0\": 5.0e-4, \"C0\": 1.0e-5\n        },\n        # Case 3 (higher temperature, weaker equilibrium, reactant imbalance)\n        {\n            \"T\": 310.0, \"Af\": 1.0e5, \"Eaf\": 5000.0, \"dH0\": -15000.0, \"dS0\": -70.0,\n            \"A0\": 1.0e-3, \"B0\": 1.0e-4, \"C0\": 0.0\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        result = process_case(params, R)\n        results.append(result)\n\n    # Format the final output string as specified: [[r1,r2,r3],[...],...]\n    print(str(results).replace(' ', ''))\n\ndef process_case(params, R):\n    \"\"\"\n    Processes a single test case: calculates constants, solves the ODE system,\n    and computes the required verification metrics.\n    \"\"\"\n    T = params[\"T\"]\n    Af = params[\"Af\"]\n    Eaf = params[\"Eaf\"]\n    dH0 = params[\"dH0\"]\n    dS0 = params[\"dS0\"]\n    y0 = np.array([params[\"A0\"], params[\"B0\"], params[\"C0\"]])\n    \n    # Tiny number to prevent division by zero in rho calculation\n    epsilon = 1.0e-300\n    rho_target = 1.0e-6\n\n    # 1. Calculate thermodynamic and kinetic constants\n    # Standard Gibbs free energy change\n    dG0 = dH0 - T * dS0\n    # Thermodynamic equilibrium constant\n    K_th = np.exp(-dG0 / (R * T))\n    # Forward rate coefficient (Arrhenius)\n    k_f = Af * np.exp(-Eaf / (R * T))\n    # Reverse rate coefficient from microreversibility\n    # Check if K_th is near zero to avoid division by zero, though unlikely with given params.\n    if K_th  epsilon:\n      k_r = 0.0 # effectively\n    else:\n      k_r = k_f / K_th\n\n    # Kinetic equilibrium ratio, should be equal to K_th by definition\n    K_kin = k_f / k_r if k_r > 0 else float('inf')\n\n    # 2. Define the ODE system for d[A]/dt, d[B]/dt, d[C]/dt\n    def ode_system(t, y):\n        A, B, C = y\n        # Enforce non-negativity\n        A = max(0.0, A)\n        B = max(0.0, B)\n        C = max(0.0, C)\n        \n        forward_rate = k_f * A * B\n        reverse_rate = k_r * C\n        \n        dAdt = -forward_rate + reverse_rate\n        dBdt = -forward_rate + reverse_rate\n        dCdt = forward_rate - reverse_rate\n        \n        return [dAdt, dBdt, dCdt]\n\n    # 3. Solve the ODE system until steady state is reached\n    y_current = y0\n    t_current = 0.0\n    time_scale = 1.0e-6 # Start with a small time scale\n    max_iter = 30 # Prevent infinite loops\n    final_rho = 1.0\n\n    for i in range(max_iter):\n        t_span = [t_current, t_current + time_scale]\n        \n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=t_span,\n            y0=y_current,\n            method='Radau', # A good choice for stiff systems\n            dense_output=False,\n            atol=1e-12, # Absolute tolerance\n            rtol=1e-9   # Relative tolerance\n        )\n        \n        if not sol.success:\n            # If solver fails, something is wrong. Report failure and current state.\n            final_rho = -1.0 # Indicate failure\n            break\n\n        y_current = sol.y[:, -1]\n        \n        # Project small negative values from numerical error back to non-negative\n        y_current = np.maximum(y_current, 0.0)\n        \n        A_final, B_final, C_final = y_current\n        \n        forward_flux = k_f * A_final * B_final\n        reverse_flux = k_r * C_final\n\n        numerator = abs(forward_flux - reverse_flux)\n        denominator = forward_flux + reverse_flux + epsilon\n        final_rho = numerator / denominator\n        \n        if final_rho  rho_target:\n            break\n            \n        t_current += time_scale\n        time_scale *= 10.0 # Progressively extend the time interval\n\n    # 4. Compute final verification metrics\n    A_final, B_final, C_final = y_current\n    \n    # Calculate numerical equilibrium ratio, handle potential division by zero\n    denominator_Knum = A_final * B_final\n    if denominator_Knum  epsilon:\n        # If reactants are fully depleted, a large K_num is expected\n        K_num = float('inf') if C_final > epsilon else 0.0\n    else:\n        K_num = C_final / denominator_Knum\n\n    # Calculate absolute differences\n    diff_K_th = abs(K_num - K_th)\n    diff_K_kin = abs(K_num - K_kin)\n\n    return [diff_K_th, diff_K_kin, final_rho]\n\n# Execute the simulation\nsolve()\n```"
        },
        {
            "introduction": "Atmospheric Chemical Transport Models (CTMs) simulate species evolution under the combined influence of chemical reactions and physical transport, which are often handled separately using operator splitting techniques. This exercise () delves into the accuracy of Strang splitting, a widely used second-order method, for a coupled advection-reaction system. By analytically deriving both the true solution and the split approximation, you will precisely quantify the local error and understand its origin in the non-commutativity of the chemical and transport operators.",
            "id": "3863578",
            "problem": "Consider the one-dimensional (1-D) advection–reaction partial differential equation (PDE)\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = -k(x)\\,c,\n$$\non a periodic domain $x \\in [0,1)$ with constant advection velocity $u$ and spatially varying first-order loss rate $k(x)$. The initial condition is $c(x,0)=c_0(x)$. Let $c_{\\mathrm{unsplit}}(x,\\Delta t)$ denote the exact solution obtained by integrating the coupled advection–reaction system without operator splitting over a single time step $\\Delta t$, and $c_{\\mathrm{Strang}}(x,\\Delta t)$ denote the Strang-split approximation over the same time step using the canonical composition “half reaction, full advection, half reaction.” The computational gas-phase chemistry context is linear here, with the reaction treated as a local ordinary differential equation (ODE) $c'=-k(x)\\,c$ and advection as a pure translation by the velocity $u$. Assume periodic boundary conditions and smooth $k(x)$ and $c_0(x)$.\n\nStarting only from:\n- the method of characteristics for linear advection,\n- the local-in-space solution of the linear ODE $c'=-k(x)\\,c$ at fixed $x$,\n- the definition of Strang splitting (second-order composition of sub-operators: reaction–advection–reaction with time fractions $\\Delta t/2$, $\\Delta t$, $\\Delta t/2$),\nderive an explicit, closed-form expression for $c_{\\mathrm{unsplit}}(x,\\Delta t)$ and for $c_{\\mathrm{Strang}}(x,\\Delta t)$ in terms of $c_0$, $k$, $u$, $x$, and $\\Delta t$ on the periodic domain, without invoking any shortcut formulas. Then, using these expressions, quantify the pointwise difference $|c_{\\mathrm{Strang}}(x,\\Delta t)-c_{\\mathrm{unsplit}}(x,\\Delta t)|$ and show that the local-in-time error scales as $O(\\Delta t^3)$ for smooth $k(x)$, by connecting the Strang composition to the trapezoidal approximation of a time integral along characteristics.\n\nYou must implement a program that evaluates this single-step local error over a uniform grid in $x$ for the following specific, smooth and periodic choices:\n- Domain: $x \\in [0,1)$, periodic.\n- Initial condition: $c_0(x)=1 + 0.5 \\sin(2\\pi x) + 0.25 \\cos(4\\pi x)$.\n- Spatially varying loss rate: $k(x)=k_0 + k_1 \\sin(2\\pi x)$.\n- Advection velocity: $u$ is a constant.\n\nYour program must:\n- Use a high-resolution uniform grid in $x$ to approximate the supremum norm of the local error $e(\\Delta t)=\\|c_{\\mathrm{Strang}}(\\cdot,\\Delta t)-c_{\\mathrm{unsplit}}(\\cdot,\\Delta t)\\|_{\\infty}$ over one time step.\n- For each test, report the normalized quantity $e(\\Delta t)/\\Delta t^3$ as a floating-point number.\n\nImplement closed-form evaluations of both $c_{\\mathrm{unsplit}}$ and $c_{\\mathrm{Strang}}$ using only the fundamental derivations outlined above. Do not use any numerical time integration; only evaluate the derived formulas. Handle periodicity analytically through the periodic trigonometric definitions.\n\nTest suite. Run five tests that cover a general case, refinement for scaling, and edge cases:\n- Test $1$: $\\Delta t=0.2$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n- Test $2$: $\\Delta t=0.1$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n- Test $3$: $\\Delta t=0.05$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n- Test $4$ (edge, commuting operators): $\\Delta t=0.2$, $u=0.7$, $k_0=1.0$, $k_1=0.0$.\n- Test $5$ (edge, no advection): $\\Delta t=0.2$, $u=0.0$, $k_0=1.0$, $k_1=0.5$.\n\nAll quantities are dimensionless. For each test, compute $e(\\Delta t)/\\Delta t^3$ using a sufficiently fine grid in $x$ so that the reported values reflect the theoretical $\\Delta t^3$ scaling. Round each reported value to $10$ significant digits.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the tests above. For example, it should look like\n$[r_1,r_2,r_3,r_4,r_5]$\nwhere each $r_i$ is the rounded floating-point value for the corresponding test.",
            "solution": "The user wants to validate and solve a problem concerning the error analysis of Strang splitting for a one-dimensional advection-reaction partial differential equation (PDE).\n\n### Step 1: Extract Givens\n\n- **PDE:** $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = -k(x)\\,c$\n- **Domain:** $x \\in [0,1)$, periodic.\n- **Initial Condition:** $c(x,0) = c_0(x)$.\n- **Advection Velocity:** $u$ is a constant.\n- **Reaction Rate:** $k(x)$ is a spatially varying first-order loss rate.\n- **Exact Solution:** $c_{\\mathrm{unsplit}}(x,\\Delta t)$ is the exact solution over one time step $\\Delta t$.\n- **Approximate Solution:** $c_{\\mathrm{Strang}}(x,\\Delta t)$ is the Strang-split approximation over $\\Delta t$, using the composition: half reaction ($\\Delta t/2$), full advection ($\\Delta t$), half reaction ($\\Delta t/2$).\n- **Sub-problems:** The reaction is a local ODE $c'=-k(x)\\,c$, and advection is a pure translation.\n- **Task 1 (Derivation):** Derive explicit, closed-form expressions for $c_{\\mathrm{unsplit}}(x,\\Delta t)$ and $c_{\\mathrm{Strang}}(x,\\Delta t)$.\n- **Task 2 (Error Analysis):** Using the derived expressions, show that the local-in-time pointwise error $|c_{\\mathrm{Strang}}(x,\\Delta t)-c_{\\mathrm{unsplit}}(x,\\Delta t)|$ is $O(\\Delta t^3)$ for smooth $k(x)$ by connecting the approximation to the trapezoidal rule.\n- **Task 3 (Implementation):** Implement a program to compute the normalized supremum norm of the local error, $e(\\Delta t)/\\Delta t^3 = \\|c_{\\mathrm{Strang}}(\\cdot,\\Delta t)-c_{\\mathrm{unsplit}}(\\cdot,\\Delta t)\\|_{\\infty} / \\Delta t^3$.\n- **Specific Functions:**\n    - $c_0(x)=1 + 0.5 \\sin(2\\pi x) + 0.25 \\cos(4\\pi x)$\n    - $k(x)=k_0 + k_1 \\sin(2\\pi x)$\n- **Test Suite:**\n    - Test 1: $\\Delta t=0.2$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n    - Test 2: $\\Delta t=0.1$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n    - Test 3: $\\Delta t=0.05$, $u=0.7$, $k_0=1.0$, $k_1=0.5$.\n    - Test 4: $\\Delta t=0.2$, $u=0.7$, $k_0=1.0$, $k_1=0.0$.\n    - Test 5: $\\Delta t=0.2$, $u=0.0$, $k_0=1.0$, $k_1=0.5$.\n- **Output Format:** A comma-separated list of the 5 test results, rounded to $10$ significant digits, enclosed in square brackets.\n\n### Step 2: Validate Using Extracted Givens\n\n- **Scientifically Grounded:** The problem is a standard exercise in the numerical analysis of PDEs, specifically focusing on operator splitting methods (Strang splitting), which are widely used in computational physics and chemistry. The advection-reaction equation is a fundamental model in transport phenomena. All concepts are well-established in mathematics and computational science.\n- **Well-Posed:** The problem is well-posed. The PDE with a given smooth initial condition and periodic boundary conditions has a unique, stable solution. The task is to derive and compare this exact solution to a standard numerical approximation. The parameters are fully specified.\n- **Objective:** The problem is stated using precise mathematical and computational language. There are no subjective or ambiguous terms.\n- **Completeness:** The problem is self-contained and provides all necessary information (equations, definitions, parameters, and specific functions) to perform the derivation and implementation.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined task in computational science that requires both analytical derivation and numerical implementation. I will now proceed with the solution.\n\n### Derivation and Analysis\n\nThe governing PDE is a linear, first-order advection-reaction equation:\n$$\n\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = -k(x)c\n$$\nWe are asked to find the exact solution and the Strang-split approximation over a single time step $\\Delta t$.\n\n#### 1. Exact Unsplit Solution, $c_{\\mathrm{unsplit}}(x, \\Delta t)$\n\nWe use the method of characteristics. The characteristic curves $x(t)$ are defined by the advection velocity:\n$$\n\\frac{dx}{dt} = u\n$$\nIntegrating this gives the characteristic lines $x(t) = x_{\\text{start}} + ut$. A point $x$ at time $t$ originated from the position $x_{\\text{start}} = x - ut$.\n\nAlong a characteristic, the total derivative of $c(x(t), t)$ with respect to time is:\n$$\n\\frac{dc}{dt} = \\frac{\\partial c}{\\partial t} + \\frac{dx}{dt}\\frac{\\partial c}{\\partial x} = \\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x}\n$$\nSubstituting this into the PDE, we obtain an ordinary differential equation (ODE) for $c$ along the characteristic:\n$$\n\\frac{dc}{dt} = -k(x(t))c\n$$\nTo find the solution at a point $(x, \\Delta t)$, we consider the characteristic that passes through this point. This characteristic originated at position $x_0 = x - u\\Delta t$ at time $t=0$. The initial value for the ODE is $c(0) = c(x_0, 0) = c_0(x_0)$.\n\nThe equation along the characteristic is $\\frac{dc}{dt} = -k(x_0+ut)c$. Integrating this ODE from $t=0$ to $t=\\Delta t$ gives:\n$$\nc(x, \\Delta t) = c_0(x_0) \\exp\\left( -\\int_0^{\\Delta t} k(x_0 + u\\tau) d\\tau \\right)\n$$\nSubstituting $x_0 = x - u\\Delta t$, we get:\n$$\nc(x, \\Delta t) = c_0(x - u\\Delta t) \\exp\\left( -\\int_0^{\\Delta t} k(x - u\\Delta t + u\\tau) d\\tau \\right)\n$$\nTo simplify the integral, we perform a change of variable. Let $s = x - u\\Delta t + u\\tau$. Then $ds = u d\\tau$, and the integration limits for $s$ are from $x - u\\Delta t$ (at $\\tau=0$) to $x$ (at $\\tau=\\Delta t$).\nAssuming $u \\neq 0$, the integral becomes:\n$$\n\\int_{x-u\\Delta t}^{x} k(s) \\frac{ds}{u} = \\frac{1}{u} \\int_{x-u\\Delta t}^{x} k(s) ds\n$$\nThus, the exact solution is:\n$$\nc_{\\mathrm{unsplit}}(x, \\Delta t) = c_0(x - u\\Delta t) \\exp\\left( -\\frac{1}{u} \\int_{x-u\\Delta t}^{x} k(s) ds \\right) \\quad (\\text{for } u \\neq 0)\n$$\nFor the special case $u=0$, the PDE simplifies to $\\frac{\\partial c}{\\partial t} = -k(x)c$. For each fixed $x$, this is a simple ODE with solution $c(x, t) = c(x,0) \\exp(-k(x)t)$. Therefore:\n$$\nc_{\\mathrm{unsplit}}(x, \\Delta t) = c_0(x) \\exp(-k(x)\\Delta t) \\quad (\\text{for } u = 0)\n$$\n\n#### 2. Strang Splitting Solution, $c_{\\mathrm{Strang}}(x, \\Delta t)$\n\nStrang splitting approximates the solution by sequentially applying the operators for reaction and advection. The sequence is: half a step of reaction, a full step of advection, and another half a step of reaction.\n\n**Step 1: First half reaction step ($\\Delta t/2$):**\nSolve $\\frac{\\partial c}{\\partial t} = -k(x)c$ for a duration $\\Delta t/2$ starting from $c_0(x)$.\n$$ c_1(x) = c_0(x) \\exp\\left(-k(x) \\frac{\\Delta t}{2}\\right) $$\n\n**Step 2: Full advection step ($\\Delta t$):**\nSolve $\\frac{\\partial c}{\\partial t} + u \\frac{\\partial c}{\\partial x} = 0$ for a duration $\\Delta t$ starting from $c_1(x)$. This is pure advection, which translates the solution profile.\n$$ c_2(x) = c_1(x - u\\Delta t) = c_0(x - u\\Delta t) \\exp\\left(-k(x - u\\Delta t) \\frac{\\Delta t}{2}\\right) $$\n\n**Step 3: Second half reaction step ($\\Delta t/2$):**\nSolve $\\frac{\\partial c}{\\partial t} = -k(x)c$ for a duration $\\Delta t/2$ starting from $c_2(x)$.\n$$ c_{\\mathrm{Strang}}(x, \\Delta t) = c_2(x) \\exp\\left(-k(x) \\frac{\\Delta t}{2}\\right) $$\nSubstituting the expression for $c_2(x)$:\n$$ c_{\\mathrm{Strang}}(x, \\Delta t) = \\left[ c_0(x - u\\Delta t) \\exp\\left(-k(x - u\\Delta t) \\frac{\\Delta t}{2}\\right) \\right] \\exp\\left(-k(x) \\frac{\\Delta t}{2}\\right) $$\nCombining the exponential terms, we arrive at the closed-form expression for the Strang-split solution:\n$$\nc_{\\mathrm{Strang}}(x, \\Delta t) = c_0(x - u\\Delta t) \\exp\\left( -\\frac{\\Delta t}{2} \\left[k(x) + k(x - u\\Delta t)\\right] \\right)\n$$\nNote that if $u=0$, this correctly reduces to $c_0(x)\\exp(-k(x)\\Delta t)$, which matches the exact solution for the no-advection case.\n\n#### 3. Error Analysis and Connection to Trapezoidal Rule\n\nWe now analyze the local pointwise error $|c_{\\mathrm{Strang}}(x,\\Delta t) - c_{\\mathrm{unsplit}}(x,\\Delta t)|$. Both expressions share the pre-factor $c_0(x-u\\Delta t)$. The difference arises from the arguments of the exponential terms.\n\nFor the exact solution, the argument is $-I_{\\mathrm{exact}} = -\\frac{1}{u}\\int_{x-u\\Delta t}^{x} k(s) ds$.\nFor the Strang-split solution, the argument is $-I_{\\mathrm{Strang}} = -\\frac{\\Delta t}{2} [k(x) + k(x-u\\Delta t)]$.\n\nLet's examine the term $I_{\\mathrm{Strang}}$. It can be rewritten as:\n$$\nI_{\\mathrm{Strang}} = \\frac{x - (x-u\\Delta t)}{u} \\frac{k(x) + k(x-u\\Delta t)}{2}\n$$\nThis is precisely the trapezoidal rule approximation for the integral $\\frac{1}{u}\\int_{x-u\\Delta t}^{x} k(s) ds$. The error of the trapezoidal rule for an integral $\\int_a^b f(s)ds$ is given by $-\\frac{(b-a)^3}{12}f''(\\xi)$ for some $\\xi \\in [a,b]$.\n\nApplying this to our integral term $I_{\\mathrm{exact}}$ (with $f(s)=k(s)$, $b=x$, $a=x-u\\Delta t$), we get:\n$$\n\\frac{1}{u}\\int_{x-u\\Delta t}^{x} k(s) ds = \\frac{\\Delta t}{2} [k(x) + k(x-u\\Delta t)] - \\frac{1}{u} \\frac{(u\\Delta t)^3}{12} k''(\\xi)\n$$\nfor some $\\xi \\in [x-u\\Delta t, x]$. Thus,\n$$\nI_{\\mathrm{exact}} = I_{\\mathrm{Strang}} - \\frac{u^2 \\Delta t^3}{12} k''(\\xi)\n$$\nThe difference between the solutions is:\n$$\nc_{\\mathrm{Strang}} - c_{\\mathrm{unsplit}} = c_0(x-u\\Delta t) \\left[ \\exp(-I_{\\mathrm{Strang}}) - \\exp(-I_{\\mathrm{exact}}) \\right]\n$$\n$$\n= c_0(x-u\\Delta t) \\exp(-I_{\\mathrm{Strang}}) \\left[ 1 - \\exp(I_{\\mathrm{Strang}} - I_{\\mathrm{exact}}) \\right]\n$$\n$$\n= c_0(x-u\\Delta t) \\exp(-I_{\\mathrm{Strang}}) \\left[ 1 - \\exp\\left(\\frac{u^2 \\Delta t^3}{12} k''(\\xi)\\right) \\right]\n$$\nFor small $\\Delta t$, the argument of the inner exponential is small. Using the Taylor expansion $\\exp(z) \\approx 1+z$ for small $z$:\n$$\nc_{\\mathrm{Strang}} - c_{\\mathrm{unsplit}} \\approx c_0(x-u\\Delta t) \\exp(-I_{\\mathrm{Strang}}) \\left[ 1 - \\left(1 + \\frac{u^2 \\Delta t^3}{12} k''(\\xi)\\right) \\right]\n$$\n$$\n= -c_0(x-u\\Delta t) \\exp(-I_{\\mathrm{Strang}}) \\frac{u^2 \\Delta t^3}{12} k''(\\xi)\n$$\nAs $\\Delta t \\to 0$, $I_{\\mathrm{Strang}} \\to 0$ and $\\xi \\to x$. The leading term of the error becomes:\n$$\nc_{\\mathrm{Strang}}(x, \\Delta t) - c_{\\mathrm{unsplit}}(x, \\Delta t) = -c_0(x) \\frac{u^2 k''(x)}{12} \\Delta t^3 + O(\\Delta t^4)\n$$\nThis shows that the local pointwise error is of order $O(\\Delta t^3)$, provided that $k(x)$ is at least twice differentiable, which is true for the given smooth, periodic function $k(x)$.\n\n#### 4. Explicit Formulas for Implementation\n\nFor the given $k(x) = k_0 + k_1 \\sin(2\\pi x)$, we need the definite integral for the exact solution. The antiderivative is:\n$$\nK(s) = \\int k(s) ds = \\int (k_0 + k_1 \\sin(2\\pi s)) ds = k_0 s - \\frac{k_1}{2\\pi} \\cos(2\\pi s)\n$$\nThe integral term in the exponent of $c_{\\mathrm{unsplit}}$ is:\n$$\n\\frac{1}{u}\\int_{x-u\\Delta t}^{x} k(s) ds = \\frac{1}{u}[K(x) - K(x-u\\Delta t)] = k_0 \\Delta t - \\frac{k_1}{2\\pi u} [\\cos(2\\pi x) - \\cos(2\\pi(x-u\\Delta t))]\n$$\nSo the argument of the exponential in $c_{\\mathrm{unsplit}}$ for $u \\neq 0$ is:\n$$\n\\arg_{\\mathrm{unsplit}} = -k_0 \\Delta t + \\frac{k_1}{2\\pi u} [\\cos(2\\pi x) - \\cos(2\\pi(x-u\\Delta t))]\n$$\n\nThe argument for $c_{\\mathrm{Strang}}$ using the given $k(x)$ is:\n$$\n\\arg_{\\mathrm{Strang}} = -\\frac{\\Delta t}{2} [ (k_0+k_1\\sin(2\\pi x)) + (k_0+k_1\\sin(2\\pi(x-u\\Delta t))) ]\n$$\n$$\n= -\\Delta t \\left( k_0 + \\frac{k_1}{2} [\\sin(2\\pi x) + \\sin(2\\pi(x-u\\Delta t))] \\right)\n$$\nThese explicit formulas will be used in the implementation.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the normalized local error of Strang splitting for an\n    advection-reaction equation over one time step.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (dt, u, k0, k1)\n        (0.2, 0.7, 1.0, 0.5),\n        (0.1, 0.7, 1.0, 0.5),\n        (0.05, 0.7, 1.0, 0.5),\n        (0.2, 0.7, 1.0, 0.0),\n        (0.2, 0.0, 1.0, 0.5),\n    ]\n\n    results = []\n    \n    # Use a high-resolution grid to minimize spatial discretization error.\n    # N=2**14 = 16384\n    N = 16384\n    x = np.linspace(0, 1, N, endpoint=False)\n\n    # Define initial condition and reaction rate functions.\n    # The functions are vectorized for numpy arrays.\n    def c0_func(x_val):\n        return 1.0 + 0.5 * np.sin(2 * np.pi * x_val) + 0.25 * np.cos(4 * np.pi * x_val)\n\n    def k_func(x_val, k0, k1):\n        return k0 + k1 * np.sin(2 * np.pi * x_val)\n\n    for dt, u, k0, k1 in test_cases:\n        # Characteristic departure point. Periodicity is handled by trigonometric functions.\n        x_prime = x - u * dt\n        \n        # Evaluate initial condition at departure points.\n        c0_at_x_prime = c0_func(x_prime)\n        \n        # --- Calculate Strang Splitting Solution ---\n        # Evaluate k at current and departure points.\n        k_at_x = k_func(x, k0, k1)\n        k_at_x_prime = k_func(x_prime, k0, k1)\n        \n        # Argument of the exponent for the Strang solution\n        exp_arg_strang = -0.5 * dt * (k_at_x + k_at_x_prime)\n        c_strang = c0_at_x_prime * np.exp(exp_arg_strang)\n\n        # --- Calculate Exact Unsplit Solution ---\n        if u == 0.0:\n            # Handle the no-advection case (u=0) separately.\n            # Here, the solution is purely local reaction.\n            c0_at_x = c0_func(x)\n            exp_arg_unsplit = -k_at_x * dt\n            c_unsplit = c0_at_x * np.exp(exp_arg_unsplit)\n        else:\n            # Handle the general advection-reaction case (u!=0).\n            # Use the derived formula for the integrated exponent.\n            cos_term = np.cos(2 * np.pi * x) - np.cos(2 * np.pi * x_prime)\n            exp_arg_unsplit = -k0 * dt + (k1 / (2 * np.pi * u)) * cos_term\n            c_unsplit = c0_at_x_prime * np.exp(exp_arg_unsplit)\n            \n        # --- Calculate Normalized Error ---\n        # Supremum norm of the pointwise difference\n        sup_norm_error = np.max(np.abs(c_strang - c_unsplit))\n        \n        # Normalize by dt^3 to observe O(dt^3) scaling\n        # For commuting cases (Test 4  5), the error is theoretically zero.\n        if dt == 0.0:\n            norm_error = 0.0\n        else:\n            norm_error = sup_norm_error / (dt**3)\n            \n        # Round the result to 10 significant digits as specified.\n        # The formatting string \"{:.10g}\" handles significant figures correctly.\n        # It's converted back to a float for the final list.\n        rounded_result = float(f\"{norm_error:.10g}\")\n        results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}