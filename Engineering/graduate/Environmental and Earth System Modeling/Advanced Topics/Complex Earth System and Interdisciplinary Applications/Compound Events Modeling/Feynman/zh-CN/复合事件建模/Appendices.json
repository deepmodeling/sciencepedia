{
    "hands_on_practices": [
        {
            "introduction": "复合事件分析的第一步是超越简单的事件频率，并正式量化风险之间的依赖程度。本练习将运用概率论中的基本加法法则（或称容斥原理），从边际概率和并集概率中计算出联合概率。通过将计算出的联合概率与统计独立性假设下的期望值进行比较，我们可以揭示驱动复合风险的关键依赖关系。",
            "id": "3868819",
            "problem": "在一次季风季节的滨海复合灾害评估中，设$P$表示日总降水量（单位：毫米），$S$表示相对于平均海平面的日风暴潮距平（单位：米）。定义两个事件$A=\\{P>50\\}$和$B=\\{S>1.0\\}$。假设对于一个特定地点和稳定的季节性气候学，你从一个长的均一记录中计算得出以下概率：$P(A)=0.12$，$P(B)=0.04$以及$P(A\\cup B)=0.145$。请仅从概率公理和基本集合恒等式出发，推导用$P(A)$、$P(B)$和$P(A\\cup B)$表示$P(A\\cap B)$的表达式，然后用给定值对其进行数值计算。此外，简要讨论为什么统计独立性对应于$P(A\\cap B)=P(A)P(B)$，以及在这种特殊情况下，该条件如何约束$P(A\\cup B)$。将$P(A\\cap B)$的数值表示为小数，并将您的答案四舍五入到四位有效数字。",
            "solution": "在进行求解之前，对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 设$P$为日总降水量，单位为毫米。\n- 设$S$为相对于平均海平面的日风暴潮距平，单位为米。\n- 事件$A = \\{P > 50\\}$。\n- 事件$B = \\{S > 1.0\\}$。\n- $P(A) = 0.12$。\n- $P(B) = 0.04$。\n- $P(A \\cup B) = 0.145$。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学或事实合理性**：该问题基于水文学和海岸工程中复合事件分析的有效科学背景。变量$P$和$S$代表具有物理意义的量。事件$A$和$B$的指定阈值，即50毫米/天的降水量和1.0米的风暴潮，对于重大的气象和海洋事件是现实的数值。所提供的概率都是有效的，即它们位于区间$[0, 1]$内。基本一致性检查成立：$P(A \\cup B) = 0.145 \\geq \\max(P(A), P(B)) = \\max(0.12, 0.04) = 0.12$，且$P(A \\cup B) = 0.145 \\leq P(A) + P(B) = 0.12 + 0.04 = 0.16$。前提在科学上和数学上都是合理的。\n- **良态性**：该问题是良态的。它提供了推导和计算所需概率的所有必要数据。所要求的推导和讨论基于概率论的标准、明确的原理。存在唯一解。\n- **客观性**：问题陈述使用了清晰、精确、客观的语言，没有任何主观或非形式化的主张。\n\n**步骤3：结论与行动**\n问题有效。将提供解答。\n\n这个问题的基础在于概率公理和基本集合论。我们被要求找出两个事件$A$和$B$的交集的概率，记作$P(A \\cap B)$。这代表了高降水量和高风暴潮在同一天发生的复合事件。\n\n对于有限个互斥事件，概率的第三公理指出，它们的并集的概率是它们各自概率的总和。虽然事件$A$和$B$不一定是互斥的，但我们可以利用这一原理推导出概率的一般加法法则。集合$A \\cup B$可以被划分为三个不相交的集合：$A \\cap B^c$、$B \\cap A^c$和$A \\cap B$，其中$A^c$和$B^c$分别是$A$和$B$的补集。\n因此，并集的概率为：\n$$P(A \\cup B) = P(A \\cap B^c) + P(B \\cap A^c) + P(A \\cap B)$$\n我们也知道$P(A) = P(A \\cap B) + P(A \\cap B^c)$以及$P(B) = P(A \\cap B) + P(B \\cap A^c)$。\n将这两个相加得到：\n$$P(A) + P(B) = P(A \\cap B^c) + P(B \\cap A^c) + 2 P(A \\cap B)$$\n将$P(A \\cup B)$的表达式代入此方程，得到：\n$$P(A) + P(B) = P(A \\cup B) + P(A \\cap B)$$\n这个恒等式是两个事件的容斥原理。它是连接并集、交集和单个事件概率的基本关系。\n\n问题要求用$P(A)$、$P(B)$和$P(A \\cup B)$表示$P(A \\cap B)$。通过重排容斥原理，我们直接得到所求的表达式：\n$$P(A \\cap B) = P(A) + P(B) - P(A \\cup B)$$\n这就是所要求的形式推导。\n\n现在，我们可以使用给定的值对这个表达式进行数值计算：\n$P(A) = 0.12$\n$P(B) = 0.04$\n$P(A \\cup B) = 0.145$\n将这些值代入推导出的公式：\n$$P(A \\cap B) = 0.12 + 0.04 - 0.145$$\n$$P(A \\cap B) = 0.16 - 0.145$$\n$$P(A \\cap B) = 0.015$$\n问题要求答案四舍五入到四位有效数字。计算出的值为$0.015$，它有两位有效数字。为了用四位有效数字表示，我们添加后缀零：$0.01500$。\n\n接下来，我们讨论统计独立性。当且仅当两个事件$A$和$B$的联合发生概率是它们各自概率的乘积时，它们被定义为统计独立的。在数学上，这个条件是：\n$$P(A \\cap B) = P(A) P(B)$$\n这个定义意味着一个事件的发生不提供关于另一个事件发生可能性的任何信息。\n如果独立性成立，这个条件为$P(A \\cap B)$提供了一个特定值，这又通过容斥原理约束了$P(A \\cup B)$的值。具体来说，如果$A$和$B$是独立的，我们可以在一般加法法则中用$P(A)P(B)$代替$P(A \\cap B)$：\n$$P(A \\cup B) = P(A) + P(B) - P(A)P(B)$$\n这是两个独立事件并集概率的表达式。\n\n对于给定的数据，让我们检查独立性假设是否成立。在独立性假设下，交集的概率将是：\n$$P(A)P(B) = (0.12)(0.04) = 0.0048$$\n我们计算出的实际交集概率值为$P(A \\cap B) = 0.015$。由于$0.015 \\neq 0.0048$，事件$A$和$B$不是统计独立的。事实上，因为$P(A \\cap B) > P(A)P(B)$，这两个事件是正相关的。这在物理上是直观的；导致极端降水（事件$A$）的大尺度天气系统通常伴随着驱动高风暴潮（事件$B$）的强风，因此它们的发生是相互关联的。",
            "answer": "$$\\boxed{0.01500}$$"
        },
        {
            "introduction": "对于罕见的极端事件，传统的依赖性度量可能会产生误导，从而低估真实的复合风险。本练习探讨了渐进独立性的概念，并引入了“隐藏”尾部依赖性（hidden regular variation）来区分那些在高阈值下仍保留显著残余依赖性的情况。通过这个思想实验，你将理解为什么对诸如并发高温和干旱等极端复合事件进行准确风险评估，需要更细致的依赖性模型。",
            "id": "3868820",
            "problem": "一个区域的夏季复合风险由两个环境指数来表征：$X$ 代表热浪强度，$Y$ 代表干旱严重程度。假设两个指数都经过变换，具有单位 Fréchet 边缘分布，因此对于较大的阈值 $t$，边缘超越概率满足 $P(X>t) \\sim t^{-1}$ 和 $P(Y>t) \\sim t^{-1}$。渐近上尾相关系数定义为 $\\lambda_U = \\lim_{t \\to \\infty} \\frac{P(X>t, Y>t)}{P(X>t)}$。Ledford 和 Tawn 意义下的尾部相关系数由一个缓变函数 $L(t)$ 和一个参数 $\\eta \\in (0,1]$ 的存在来定义，使得当 $t \\to \\infty$ 时，$P(X>t, Y>t) \\sim L(t)\\,t^{-1/\\eta}$。考虑 $(X,Y)$ 的两个候选相关性模型，每个模型的 $\\lambda_U = 0$（渐近独立），但它们的残余尾部相关结构不同：\n\n- 模型 I：基准渐近独立，无隐藏正则变差，意味着 $X$ 和 $Y$ 在极端水平上具有独立的尾部行为。\n- 模型 II：具有隐藏正则变差的渐近独立，其特征为 $\\eta = 0.7$ 和相同的缓变行为 $L(t)$。\n\n假设选择的阈值使得每个指数每个夏季的边缘超越概率为 $p = 0.02$，各年份是可交换的且时间相关性较弱，因此稀有事件的计数可以近似为跨年份独立，并且 $L(t)$ 在感兴趣的范围内可以被视为近似恒定（这是缓变函数在渐近风险近似中的一个标准假设）。在 $n = 50$ 个夏季中，比较这两个模型对于至少发生一次并发超越事件（定义为在任何一个夏季发生事件 $\\{X>t, Y>t\\}$）的概率的影响，以及对罕见并发热浪和干旱风险的解释。下列哪个陈述与主导定义和渐近行为最一致？\n\nA. 在模型 II 下，每个夏季的联合超越概率按 $p^{1/\\eta}$ 缩放，对于小的 $p$ 值，这比 $p^2$ 更大；数值上，在 50 个夏季中至少发生一次并发事件的概率，模型 II 约为 $0.17$，而模型 I 约为 $0.02$，因此尽管 $\\lambda_U=0$，隐藏正则变差仍显著增加了复合风险。\n\nB. 因为两个模型都有 $\\lambda_U=0$，所以在 50 个夏季中至少发生一次并发超越的概率在模型 I 和模型 II 下是渐近相同的，并且在两种情况下都约为 $0.02$。\n\nC. 具有 $\\eta=0.7$ 的隐藏正则变差相对于独立情况降低了联合尾部概率，因此在 50 个夏季中并发超越的期望次数在模型 II 下比在模型 I 下更小。\n\nD. 在模型 II 下，每个夏季的联合超越概率按 $p^2$ 缩放，与独立基线相匹配，因此隐藏正则变差在实践中不影响复合风险。\n\nE. 隐藏正则变差意味着 $\\lambda_U>0$，因此每个夏季的联合超越概率在 $p$ 中是渐近恒定的，导致在 50 个夏季中几乎肯定会至少发生一次并发事件。",
            "solution": "首先将验证问题陈述的科学性和逻辑一致性。\n\n### 第 1 步：提取已知信息\n- 两个环境指数：$X$（热浪强度）和 $Y$（干旱严重程度）。\n- 边缘分布：单位 Fréchet 边缘。\n- 边缘尾部行为：对于大阈值 $t$，边缘超越概率满足 $P(X>t) \\sim t^{-1}$ 和 $P(Y>t) \\sim t^{-1}$。\n- 渐近上尾相关系数：$\\lambda_U = \\lim_{t \\to \\infty} \\frac{P(X>t, Y>t)}{P(X>t)}$。\n- 尾部相关系数（Ledford 和 Tawn）：对于一个缓变函数 $L(t)$ 和一个参数 $\\eta \\in (0,1]$，$P(X>t, Y>t) \\sim L(t)\\,t^{-1/\\eta}$。\n- 模型 I：基准渐近独立，$\\lambda_U = 0$，意味着独立的尾部行为。\n- 模型 II：具有隐藏正则变差的渐近独立，其特征为 $\\lambda_U = 0$ 和 $\\eta = 0.7$。函数 $L(t)$ 被假设具有“相同的缓变行为”。\n- 每个夏季的边缘超越概率：$p = 0.02$。\n- 时间段：$n = 50$ 个夏季。\n- 年际相关性：各年份是可交换的，具有弱时间相关性，允许稀有事件计数近似为跨年份独立。\n- 关于 $L(t)$ 的假设：在感兴趣的范围内，$L(t)$ 可被视为近似恒定。\n\n### 第 2 步：使用提取的已知信息进行验证\n该问题在科学上植根于多元极值理论的统计领域。所提出的概念——单位 Fréchet 边缘分布、上尾相关系数 $\\lambda_U$ 以及通过系数 $\\eta$ 实现渐近独立的 Ledford-Tawn 框架——都是用于模拟复合事件的标准且成熟的方法。\n\n$\\lambda_U$ 和 $\\eta$ 之间的关系是一致的：\n$\\lambda_U$ 的定义是 $\\lim_{t \\to \\infty} P(Y>t|X>t) = \\lim_{t \\to \\infty} \\frac{P(X>t, Y>t)}{P(X>t)}$。\n使用给定的渐近形式，$\\lambda_U = \\lim_{t \\to \\infty} \\frac{L(t)t^{-1/\\eta}}{t^{-1}} = \\lim_{t \\to \\infty} L(t)t^{1-1/\\eta}$。\n对于 $\\eta \\in (0,1)$，我们有 $1 - 1/\\eta  0$，这导致当 $t \\to \\infty$ 时 $t^{1-1/\\eta} \\to 0$。由于 $L(t)$ 是缓变函数，极限为 $\\lambda_U = 0$。这正确地描述了渐近独立。因此，如陈述所述，$\\eta=0.7$ 的情况属于渐近独立类 ($\\lambda_U=0$)。尾部完全独立的情况可以在此框架内通过设置 $\\eta=0.5$ 和 $L(t)=1$ 来建模，因为 $P(Xt,Yt) \\approx P(Xt)P(Yt) \\sim (t^{-1})^2 = t^{-2} = t^{-1/0.5}$。\n\n问题设定是适定的、客观的，并包含足够的信息来比较这两个模型。没有科学上的矛盾或逻辑谬误。\n\n### 第 3 步：结论和行动\n问题陈述是有效的。解决方案将通过推导每个模型的风险含义并评估给定的选项来进行。\n\n### 推导与分析\n\n核心任务是计算在 $n=50$ 个夏季中至少发生一次并发超越事件 $\\{Xt, Yt\\}$ 的概率。设 $p_{\\text{joint}}$ 为单个夏季发生此事件的概率。由于事件在不同夏季之间被视为独立的，因此在 $n$ 个夏季中至少发生一次事件的概率是 $P_{\\text{total}} = 1 - (1-p_{\\text{joint}})^n$。\n\n我们已知边缘超越概率 $p = P(Xt) = P(Yt) = 0.02$。根据单位 Fréchet 边缘分布的性质，$p \\sim t^{-1}$，这意味着阈值 $t$ 满足 $t \\approx p^{-1}$。\n\n**模型 I：基准渐近独立**\n该模型假设对于极端事件，$X$ 和 $Y$ 是独立的。\n单个夏季的联合概率为：\n$$p_{\\text{joint, I}} = P(Xt, Yt) = P(Xt)P(Yt) = p \\cdot p = p^2$$\n代入 $p=0.02$：\n$$p_{\\text{joint, I}} = (0.02)^2 = 0.0004$$\n在 $n=50$ 个夏季中至少发生一次此类事件的概率是：\n$$P_{\\text{total, I}} = 1 - (1 - p_{\\text{joint, I}})^{50} = 1 - (1 - 0.0004)^{50}$$\n使用计算器，$ (0.9996)^{50} \\approx 0.980198 $。\n$$P_{\\text{total, I}} \\approx 1 - 0.980198 = 0.019802$$\n这个值约等于 $0.02$。\n\n**模型 II：具有隐藏正则变差的渐近独立**\n该模型由具有 $\\eta=0.7$ 的 Ledford-Tawn 框架描述。\n联合概率为 $P(Xt, Yt) \\sim L(t)t^{-1/\\eta}$。\n代入 $t \\approx p^{-1}$ 并将 $L(t)$ 视为常数 $C$，联合概率随边缘概率 $p$ 的缩放关系为：\n$$p_{\\text{joint, II}} \\approx C \\cdot p^{1/\\eta}$$\n当 $\\eta=0.7$ 时，指数为 $1/0.7 = 10/7 \\approx 1.4286$。\n缩放关系为 $p_{\\text{joint, II}} \\propto p^{10/7}$。\n对于独立情况（模型 I），缩放关系为 $p^2$。由于模型 II 的指数（$10/7 \\approx 1.4286$）小于模型 I 的指数（$2$），对于小的概率 $p$，模型 II 将预测比模型 I 高得多的联合概率。这捕捉了“隐藏”或“残余”的相关性。\n\n### 逐项分析\n\n**A. 在模型 II 下，每个夏季的联合超越概率按 $p^{1/\\eta}$ 缩放，对于小的 $p$ 值，这比 $p^2$ 更大；数值上，在 50 个夏季中至少发生一次并发事件的概率，模型 II 约为 $0.17$，而模型 I 约为 $0.02$，因此尽管 $\\lambda_U=0$，隐藏正则变差仍显著增加了复合风险。**\n- **缩放定律**：基于 Ledford-Tawn 模型，概率按 $p^{1/\\eta}$ 缩放的陈述是正确的。\n- **与独立性的比较**：该陈述指出这给出的值比 $p^2$ 大是正确的，因为对于 $p=0.02$ 和 $\\eta=0.7$，指数 $1/\\eta \\approx 1.4286  2$。\n- **模型 I 的数值**：“约 $0.02$” 的值与我们计算出的 $0.0198$ 一致。\n- **模型 II 的数值**：我们来核对 $0.17$ 这个值。这需要 $1 - (1 - p_{\\text{joint, II}})^{50} \\approx 0.17$，这意味着 $p_{\\text{joint, II}} \\approx 0.00372$。我们知道 $p_{\\text{joint, II}} \\approx C \\cdot p^{1/0.7} = C \\cdot (0.02)^{10/7} \\approx C \\cdot 0.001964$。为了得到 $0.00372$ 的概率，常数 $C$ 必须是 $C \\approx 0.00372 / 0.001964 \\approx 1.89$。虽然问题没有指定 $C$，但在应用中 $C \\approx 2$ 的值是合理的。“相同的缓变行为”这句话可能意味着函数形式很简单，并且问题期望这个常数可以被推断出来，或者作为选项中给定的值被接受。\n- **结论**：隐藏正则变差显著增加复合风险的结论是该理论的核心信息，并通过概率之间的巨大差异（$0.17$ 对比 $0.02$）得到了证明。这个陈述在定性和概念上的每个方面都是合理的。模型 II 的数值可以通过一个合理（尽管未说明）的缓变函数常数来实现。\n**结论：正确。**\n\n**B. 因为两个模型都有 $\\lambda_U=0$，所以在 50 个夏季中至少发生一次并发超越的概率在模型 I 和模型 II 下是渐近相同的，并且在两种情况下都约为 $0.02$。**\n这根本上是错误的。系数 $\\eta$ 专门用于区分渐近独立模型类（其中 $\\lambda_U=0$）内部的不同相关结构。如前所示，$\\eta=0.7$ 的模型比行为等同于 $\\eta=0.5$（独立）的模型具有显著更高的联合概率。因此，概率是不相同的。\n**结论：错误。**\n\n**C. 具有 $\\eta=0.7$ 的隐藏正则变差相对于独立情况降低了联合尾部概率，因此在 50 个夏季中并发超越的期望次数在模型 II 下比在模型 I 下更小。**\n这与事实相反。模型 II 的联合概率按 $p^{1/0.7} \\approx p^{1.43}$ 缩放，而模型 I（独立）的联合概率按 $p^2$ 缩放。由于 $1.43  2$，对于小的 $p$（如 $p=0.02$），$p^{1.43}  p^2$。因此，具有 $\\eta0.5$ 的隐藏正则变差*增加*了相对于独立性的联合概率，导致更高的期望事件数。\n**结论：错误。**\n\n**D. 在模型 II 下，每个夏季的联合超越概率按 $p^2$ 缩放，与独立基线相匹配，因此隐藏正则变差在实践中不影响复合风险。**\n这错误地陈述了模型 II 的缩放定律。该模型的定义特征是概率按 $p^{1/\\eta}$（其中 $\\eta=0.7$）缩放，这与独立性的 $p^2$ 缩放（$\\eta=0.5$）不同。因此，它确实会显著影响复合风险。\n**结论：错误。**\n\n**E. 隐藏正则变差意味着 $\\lambda_U0$，因此每个夏季的联合超越概率在 $p$ 中是渐近恒定的，导致在 50 个夏季中几乎肯定会至少发生一次并发事件。**\n这个陈述包含多个错误。首先，隐藏正则变差是为渐近独立情况（即 $\\lambda_U=0$）开发的概念。$\\lambda_U  0$ 的情况被称为渐近相关。其次，如果 $\\lambda_U  0$，联合概率为 $p_{\\text{joint}} \\approx \\lambda_U p$，它在 $p$ 中是线性的，而不是恒定的。当 $p \\to 0$ 时，它趋于 $0$。\n**结论：错误。**\n\n基于分析，陈述 A 是唯一一个正确描述了 a) 理论缩放，b) 与独立性的定性比较，以及 c) 对风险评估的总体影响的选项。所提供的数值与理论一致，其中模型 II 的缓变函数的常数由选项本身隐含定义。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "真实世界的环境系统通常是非平稳的，其统计特性会随气候协变量等因素而变化。这个综合性练习要求你构建一个完整的、由协变量驱动的复合事件模型，该模型结合了广义极值（GEV）分布来描述边际行为，并使用极值copula来捕捉依赖结构。更进一步，你将利用此模型进行归因分析，量化复合风险的变化在多大程度上是由单个极端事件（边际）的变化或其依赖结构的变化所驱动的。",
            "id": "3868831",
            "problem": "考虑两个环境变量 $X_1$ 和 $X_2$，它们代表地球系统中不同物理相关过程的块最大值（例如，极端降水和海岸浪涌）。假设两个变量都以气候协变量 $Z$ 为条件，服从广义极值 (GEV) 分布。变量 $i \\in \\{1,2\\}$ 在阈值 $x$ 和协变量值 $Z=z$ 时的 GEV 边际累积分布函数记为 $F_i(x \\mid Z=z)$，其参数为 $\\mu_i(z)$ (位置)，$\\sigma_i(z)$ (尺度) 和 $\\xi_i(z)$ (形状)。对于任何实数 $x$ 且 $\\sigma_i(z)0$，GEV 分布定义如下：\n- 当 $\\xi_i(z) \\neq 0$ 时，支撑集由 $1+\\xi_i(z)\\,(x-\\mu_i(z))/\\sigma_i(z)  0$ 给出，累积分布函数为 $F_i(x \\mid Z=z) = \\exp\\!\\left(-\\left[1+\\xi_i(z)\\,\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right]^{-1/\\xi_i(z)}\\right)$。\n- 当 $\\xi_i(z) = 0$ 时，累积分布函数为 $F_i(x \\mid Z=z) = \\exp\\!\\left(-\\exp\\!\\left(-\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right)\\right)$。\n\n进一步假设最大值 $(X_1,X_2)$ 的联合分布是最大稳定分布，并由一个逻辑稳定尾部相关函数驱动的极值 copula 来表征。具体来说，用 $C(p_1,p_2 \\mid Z=z)$ 表示应用于边际概率 $p_1=F_1(x_1 \\mid Z=z)$ 和 $p_2=F_2(x_2 \\mid Z=z)$ 的极值 copula。该 copula 由稳定尾部相关函数 $l(t_1,t_2 \\mid Z=z)$（其中 $t_i=-\\log(p_i)$）和一个相关性参数 $\\alpha(z)\\in(0,1]$ 决定。稳定尾部相关函数的逻辑形式由 $l(t_1,t_2 \\mid Z=z) = \\left(t_1^{1/\\alpha(z)} + t_2^{1/\\alpha(z)}\\right)^{\\alpha(z)}$ 给出。由此产生的极值 copula 为 $C(p_1,p_2 \\mid Z=z) = \\exp\\!\\left(-\\,l(-\\log p_1,-\\log p_2 \\mid Z=z)\\right)$，它编码了最大值之间的相关结构，同时保留了 GEV 边际分布。\n\n定义在阈值 $(u_1,u_2)$ 和协变量值 $Z=z$ 下的复合超越概率为两个变量同时超过其阈值的概率，即 $\\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z)$。必须从第一性原理出发，基于 GEV 边际分布的定义、由逻辑稳定尾部相关函数导出的极值 copula 以及联合概率的容斥原理来推导该概率。然后，您必须使用一种对称的、路径无关的分解方法，将两种情景 $Z=z_1$ 和 $Z=z_2$ 之间复合超越概率的变化归因于边际分布的变化与相关性结构的变化。该方法基于对两条转换路径（边际-然后-相关性 和 相关性-然后-边际）贡献的平均。\n\n对 GEV 边际分布和逻辑相关性参数采用协变量驱动的参数化。对于每个变量 $i \\in \\{1,2\\}$，指定\n$\\mu_i(z) = \\mu_{i0} + \\mu_{i1}\\,z$，$\\sigma_i(z) = \\sigma_{i0}\\,\\exp(\\sigma_{i1}\\,z)$，以及 $\\xi_i(z) = \\xi_{i0} + \\xi_{i1}\\,z$，其中 $\\sigma_{i0}0$。对于相关性，指定 $\\alpha(z) = \\alpha_0 + \\alpha_1\\,z$，对于所考虑的情景，$\\alpha(z)\\in(0,1]$。\n\n您的任务是编写一个完整的程序，对下面列出的每个测试用例执行以下操作：\n- 计算复合超越概率 $\\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_1)$ 和 $\\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_2)$。\n- 计算总变化 $\\Delta = \\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_2) - \\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_1)$。\n- 对 $\\Delta$ 进行对称归因（在两条路径上取平均），将其分解为边际贡献和相关性贡献，定义如下：\n  路径 A (边际-然后-相关性)：仅边际混合概率 $\\mathbb{P}_{\\text{M}}$ 使用来自 $Z=z_2$ 的 $F_1(\\cdot \\mid Z=z_2)$ 和 $F_2(\\cdot \\mid Z=z_2)$ 以及来自 $Z=z_1$ 的 $C(\\cdot,\\cdot \\mid Z=z_1)$。沿路径 A 的相关性贡献为 $\\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_2) - \\mathbb{P}_{\\text{M}}$，而沿路径 A 的边际贡献为 $\\mathbb{P}_{\\text{M}} - \\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_1)$。\n  路径 B (相关性-然后-边际)：仅相关性混合概率 $\\mathbb{P}_{\\text{D}}$ 使用来自 $Z=z_1$ 的 $F_1(\\cdot \\mid Z=z_1)$ 和 $F_2(\\cdot \\mid Z=z_1)$ 以及来自 $Z=z_2$ 的 $C(\\cdot,\\cdot \\mid Z=z_2)$。沿路径 B 的边际贡献为 $\\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_2) - \\mathbb{P}_{\\text{D}}$，而沿路径 B 的相关性贡献为 $\\mathbb{P}_{\\text{D}} - \\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_1)$。最终的边际贡献是沿两条路径的边际贡献的平均值，最终的相关性贡献是沿两条路径的相关性贡献的平均值。\n\n您必须将所有导出的概率表示为实数 (浮点数)。答案不涉及物理单位。\n\n测试套件：\n- 案例 1 (中等正相关和混合尾部边际的一般情况)：\n  - 情景：$z_1=0$, $z_2=1$。\n  - 变量 1：$\\mu_{10}=30$，$\\mu_{11}=2$，$\\sigma_{10}=10$，$\\sigma_{11}=0.1$，$\\xi_{10}=0.1$，$\\xi_{11}=0.0$，阈值 $u_1=70$。\n  - 变量 2：$\\mu_{20}=1.5$，$\\mu_{21}=0.2$，$\\sigma_{20}=0.5$，$\\sigma_{21}=0.05$，$\\xi_{20}=-0.1$，$\\xi_{21}=0.0$，阈值 $u_2=5.5$。\n  - 相关性：$\\alpha_0=0.6$, $\\alpha_1=-0.1$。\n- 案例 2 (具有 Gumbel 边际和变化的位移/尺度的独立性边界)：\n  - 情景：$z_1=0$, $z_2=2$。\n  - 变量 1：$\\mu_{10}=0$，$\\mu_{11}=0$，$\\sigma_{10}=1$，$\\sigma_{11}=0$，$\\xi_{10}=0$，$\\xi_{11}=0$，阈值 $u_1=2$。\n  - 变量 2：$\\mu_{20}=0$，$\\mu_{21}=1$，$\\sigma_{20}=1$，$\\sigma_{21}=0.2$，$\\xi_{20}=0$，$\\xi_{21}=0$，阈值 $u_2=3$。\n  - 相关性：$\\alpha_0=1$, $\\alpha_1=0$。\n- 案例 3 (仅相关性变化，边际分布固定)：\n  - 情景：$z_1=0$, $z_2=1$。\n  - 变量 1：$\\mu_{10}=10$，$\\mu_{11}=0$，$\\sigma_{10}=2$，$\\sigma_{11}=0$，$\\xi_{10}=0.05$，$\\xi_{11}=0$，阈值 $u_1=20$。\n  - 变量 2：$\\mu_{20}=5$，$\\mu_{21}=0$，$\\sigma_{20}=1$，$\\sigma_{21}=0$，$\\xi_{20}=0$，$\\xi_{21}=0$，阈值 $u_2=8$。\n  - 相关性：$\\alpha_0=0.9$, $\\alpha_1=-0.6$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例贡献一个包含五个浮点数的子列表，顺序为 $[\\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_1), \\mathbb{P}(X_1u_1,X_2u_2 \\mid Z=z_2), \\Delta, \\text{边际贡献}, \\text{相关性贡献}]$。例如，最终输出应类似于 $[[p_{1,1},p_{1,2},\\Delta_1,m_1,d_1],[p_{2,1},p_{2,2},\\Delta_2,m_2,d_2],[p_{3,1},p_{3,2},\\Delta_3,m_3,d_3]]$。",
            "solution": "此问题需要经过验证。\n\n### 步骤 1：提取已知信息\n- **边际分布**：两个环境变量 $X_1$ 和 $X_2$ 服从以气候协变量 $Z$ 为条件的广义极值 (GEV) 分布。\n- **GEV CDF**：对于变量 $i \\in \\{1,2\\}$，在阈值 $x$ 和协变量值 $Z=z$ 时，CDF 为 $F_i(x \\mid Z=z)$，参数为 $\\mu_i(z)$、$\\sigma_i(z)0$ 和 $\\xi_i(z)$。\n  - 如果 $\\xi_i(z) \\neq 0$：$F_i(x \\mid Z=z) = \\exp\\!\\left(-\\left[1+\\xi_i(z)\\,\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right]^{-1/\\xi_i(z)}\\right)$，支撑集为 $1+\\xi_i(z)\\,(x-\\mu_i(z))/\\sigma_i(z)  0$。\n  - 如果 $\\xi_i(z) = 0$：$F_i(x \\mid Z=z) = \\exp\\!\\left(-\\exp\\!\\left(-\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right)\\right)$。\n- **相关性结构**：$(X_1, X_2)$ 的联合分布由一个极值 copula $C(p_1, p_2 \\mid Z=z)$ 建模，该 copula 具有一个逻辑稳定尾部相关函数 $l(t_1,t_2 \\mid Z=z) = \\left(t_1^{1/\\alpha(z)} + t_2^{1/\\alpha(z)}\\right)^{\\alpha(z)}$，其中 $t_i = -\\log(p_i)$，$p_i = F_i(x_i \\mid Z=z)$。相关性参数为 $\\alpha(z) \\in (0,1]$。\n- **Copula 函数**：$C(p_1,p_2 \\mid Z=z) = \\exp\\!\\left(-\\,l(-\\log p_1,-\\log p_2 \\mid Z=z)\\right)$。\n- **目标量**：复合超越概率 $\\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z)$。\n- **参数化**：\n  - GEV：$\\mu_i(z) = \\mu_{i0} + \\mu_{i1}\\,z$，$\\sigma_i(z) = \\sigma_{i0}\\,\\exp(\\sigma_{i1}\\,z)$，$\\xi_i(z) = \\xi_{i0} + \\xi_{i1}\\,z$。\n  - 相关性：$\\alpha(z) = \\alpha_0 + \\alpha_1\\,z$。\n- **归因任务**：使用对称、路径无关的平均方法，将总变化 $\\Delta = \\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_2) - \\mathbb{P}(X_1u_1, X_2u_2 \\mid Z=z_1)$ 分解为来自边际分布和相关性的贡献。\n  - 路径 A (边际-然后-相关性)：混合概率 $\\mathbb{P}_{\\text{M}}$ 使用来自 $z_2$ 的边际分布和来自 $z_1$ 的相关性。边际贡献为 $\\mathbb{P}_{\\text{M}} - \\mathbb{P}(\\dots|z_1)$，相关性贡献为 $\\mathbb{P}(\\dots|z_2) - \\mathbb{P}_{\\text{M}}$。\n  - 路径 B (相关性-然后-边际)：混合概率 $\\mathbb{P}_{\\text{D}}$ 使用来自 $z_1$ 的边际分布和来自 $z_2$ 的相关性。相关性贡献为 $\\mathbb{P}_{\\text{D}} - \\mathbb{P}(\\dots|z_1)$，边际贡献为 $\\mathbb{P}(\\dots|z_2) - \\mathbb{P}_{\\text{D}}$。\n  - 最终贡献是路径 A 和 B 的平均值。\n- **测试用例**：提供了三个具有特定参数值的测试用例。\n\n### 步骤 2：使用提取的已知信息进行验证\n该问题具有科学依据，定义明确且客观。\n- **科学依据**：该问题使用了极值理论（GEV 分布）和 copula 理论（极值 copula，逻辑斯谛模型）中的标准、成熟模型，这些模型广泛应用于环境和地球系统建模。归因方法是灵敏度分析的标准技术。该问题不违反任何科学或数学原理。\n- **适定性**：提供了所有必要的参数、函数形式和定义。检查了测试用例的参数值以确保它们在有效域内（例如，$\\sigma  0$，$\\alpha \\in (0,1]$，以及 GEV 支撑集内的阈值），事实确实如此。任务定义清晰，可得出唯一的、有意义的解。\n- **客观性**：语言精确、正式，没有主观论断。该问题是一个基于给定模型和数据的形式化数学练习。\n\n### 步骤 3：结论与行动\n此问题被判定为**有效**。将提供解决方案。\n\n问题的核心是计算复合超越概率 $\\mathbb{P}(X_1  u_1, X_2  u_2 \\mid Z=z)$，并将其在两种情景 $Z=z_1$ 和 $Z=z_2$ 之间的变化归因于边际分布的变化与相关性结构的变化。\n\n首先，我们推导复合超越概率的表达式。令 $p_1 = F_1(u_1 \\mid Z=z)$ 和 $p_2 = F_2(u_2 \\mid Z=z)$ 为在给定阈值 $u_1$ 和 $u_2$ 下的边际累积概率。联合累积分布函数由 copula 给出：$\\mathbb{P}(X_1 \\le u_1, X_2 \\le u_2 \\mid Z=z) = C(p_1, p_2 \\mid Z=z)$。我们感兴趣的概率 $\\mathbb{P}(X_1  u_1, X_2  u_2 \\mid Z=z)$ 指的是联合生存函数。利用概率的容斥原理，我们将联合生存概率与 copula 和边际概率联系起来：\n$$\n\\mathbb{P}(X_1  u_1, X_2  u_2) = 1 - \\mathbb{P}(X_1 \\le u_1) - \\mathbb{P}(X_2 \\le u_2) + \\mathbb{P}(X_1 \\le u_1, X_2 \\le u_2)\n$$\n代入边际和联合 CDF 的符号，我们得到：\n$$\nP_{exc}(u_1, u_2 \\mid z) = 1 - p_1 - p_2 + C(p_1, p_2 \\mid Z=z)\n$$\n问题指定了边际分布的 GEV CDF $F_i(x \\mid Z=z)$ 和相关性的极值 copula。这些分布的参数 $\\mu_i(z)$、$\\sigma_i(z)$、$\\xi_i(z)$ 和 $\\alpha(z)$ 是协变量 $Z=z$ 的函数。GEV CDF $F_i(x \\mid z)$ 计算如下：\n$$\nF_i(x \\mid z) = \\begin{cases} \\exp\\left(-\\exp\\left(-\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right)\\right)  \\text{如果 } \\xi_i(z)=0 \\\\ \\exp\\left(-\\left[1+\\xi_i(z)\\frac{x-\\mu_i(z)}{\\sigma_i(z)}\\right]^{-1/\\xi_i(z)}\\right)  \\text{如果 } \\xi_i(z)\\neq0 \\end{cases}\n$$\ncopula $C(p_1, p_2 \\mid Z=z)$ 由逻辑稳定尾部相关函数 $l(t_1, t_2 \\mid Z=z) = (t_1^{1/\\alpha(z)} + t_2^{1/\\alpha(z)})^{\\alpha(z)}$ 构建，其中 $t_i = -\\log p_i$。则 copula 为：\n$$\nC(p_1, p_2 \\mid Z=z) = \\exp(-l(-\\log p_1, -\\log p_2 \\mid Z=z)) = \\exp\\left(-\\left((-\\log p_1)^{1/\\alpha(z)} + (-\\log p_2)^{1/\\alpha(z)}\\right)^{\\alpha(z)}\\right)\n$$\n有了这些组件，我们可以计算任何给定情景 $z$ 的复合超越概率。\n\n令两个变量的边际参数集表示为 $M(z) = \\{\\mu_1(z), \\sigma_1(z), \\xi_1(z), \\mu_2(z), \\sigma_2(z), \\xi_2(z)\\}$，相关性参数表示为 $D(z) = \\alpha(z)$。超越概率可以写成这些参数集的函数：$P(M(z), D(z))$。我们考虑两种情景，$z_1$ 和 $z_2$。\n基线概率为 $P_1 = P(M(z_1), D(z_1))$。\n最终概率为 $P_2 = P(M(z_2), D(z_2))$。\n总变化为 $\\Delta = P_2 - P_1$。\n\n归因分析需要计算两种混合情景下的概率：\n1. 来自 $z_2$ 的边际分布和来自 $z_1$ 的相关性：$\\mathbb{P}_{\\text{M}} = P(M(z_2), D(z_1))$。\n2. 来自 $z_1$ 的边际分布和来自 $z_2$ 的相关性：$\\mathbb{P}_{\\text{D}} = P(M(z_1), D(z_2))$。\n\n变化沿两条路径分解：\n路径 A (边际，然后相关性)：变化分为由边际引起的部分 $\\Delta_{M,A} = \\mathbb{P}_{\\text{M}} - P_1$ 和由相关性引起的部分 $\\Delta_{D,A} = P_2 - \\mathbb{P}_{\\text{M}}$。\n路径 B (相关性，然后边际)：变化分为由相关性引起的部分 $\\Delta_{D,B} = \\mathbb{P}_{\\text{D}} - P_1$ 和由边际引起的部分 $\\Delta_{M,B} = P_2 - \\mathbb{P}_{\\text{D}}$。\n\n最终的对称、路径无关的贡献是每条路径贡献的平均值：\n- 边际贡献：$\\Delta_M = (\\Delta_{M,A} + \\Delta_{M,B}) / 2$。\n- 相关性贡献：$\\Delta_D = (\\Delta_{D,A} + \\Delta_{D,B}) / 2$。\n根据构造，$\\Delta_M + \\Delta_D = \\Delta$。\n\n该解决方案涉及实现函数来计算 GEV 参数、GEV CDF、copula 和复合超越概率。然后，协调这些函数来计算 $P_1$、$P_2$、$\\mathbb{P}_{\\text{M}}$ 和 $\\mathbb{P}_{\\text{D}}$，并由此为每个测试用例推导出最终的归因分量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the compound event attribution problem for the provided test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (general case)\n        {\n            \"z1\": 0.0, \"z2\": 1.0, \"u1\": 70.0, \"u2\": 5.5,\n            \"mu10\": 30.0, \"mu11\": 2.0, \"sigma10\": 10.0, \"sigma11\": 0.1, \"xi10\": 0.1, \"xi11\": 0.0,\n            \"mu20\": 1.5, \"mu21\": 0.2, \"sigma20\": 0.5, \"sigma21\": 0.05, \"xi20\": -0.1, \"xi21\": 0.0,\n            \"alpha0\": 0.6, \"alpha1\": -0.1\n        },\n        # Case 2 (independence boundary)\n        {\n            \"z1\": 0.0, \"z2\": 2.0, \"u1\": 2.0, \"u2\": 3.0,\n            \"mu10\": 0.0, \"mu11\": 0.0, \"sigma10\": 1.0, \"sigma11\": 0.0, \"xi10\": 0.0, \"xi11\": 0.0,\n            \"mu20\": 0.0, \"mu21\": 1.0, \"sigma20\": 1.0, \"sigma21\": 0.2, \"xi20\": 0.0, \"xi21\": 0.0,\n            \"alpha0\": 1.0, \"alpha1\": 0.0\n        },\n        # Case 3 (dependence-only change)\n        {\n            \"z1\": 0.0, \"z2\": 1.0, \"u1\": 20.0, \"u2\": 8.0,\n            \"mu10\": 10.0, \"mu11\": 0.0, \"sigma10\": 2.0, \"sigma11\": 0.0, \"xi10\": 0.05, \"xi11\": 0.0,\n            \"mu20\": 5.0, \"mu21\": 0.0, \"sigma20\": 1.0, \"sigma21\": 0.0, \"xi20\": 0.0, \"xi21\": 0.0,\n            \"alpha0\": 0.9, \"alpha1\": -0.6\n        }\n    ]\n\n    def get_gev_cdf(x, mu, sigma, xi):\n        \"\"\"Computes the GEV cumulative distribution function.\"\"\"\n        if sigma = 0:\n            raise ValueError(\"Scale parameter sigma must be positive.\")\n        \n        # Handle the Gumbel case (xi = 0)\n        if xi == 0.0:\n            return np.exp(-np.exp(-(x - mu) / sigma))\n\n        # Handle the Frechet/Weibull cases (xi != 0)\n        support_term = 1 + xi * (x - mu) / sigma\n        if support_term = 0:\n            # If x is outside the support of the distribution\n            if xi > 0: # Lower bound at mu - sigma/xi\n                return 0.0\n            else: # Upper bound at mu - sigma/xi\n                return 1.0\n        \n        return np.exp(-np.power(support_term, -1.0 / xi))\n\n    def get_compound_exceedance_prob(u1, u2, m1_params, m2_params, alpha):\n        \"\"\"\n        Computes the compound exceedance probability P(X1 > u1, X2 > u2).\n        \"\"\"\n        mu1, sigma1, xi1 = m1_params\n        mu2, sigma2, xi2 = m2_params\n\n        p1 = get_gev_cdf(u1, mu1, sigma1, xi1)\n        p2 = get_gev_cdf(u2, mu2, sigma2, xi2)\n\n        # Avoid log(0) for probabilities at the boundary\n        if p1 == 0.0 or p2 == 0.0:\n            return 0.0\n        if p1 == 1.0:\n            return 1.0 - p2 # S_2\n        if p2 == 1.0:\n            return 1.0 - p1 # S_1\n\n        t1 = -np.log(p1)\n        t2 = -np.log(p2)\n        \n        l = np.power(np.power(t1, 1.0/alpha) + np.power(t2, 1.0/alpha), alpha)\n        copula_val = np.exp(-l)\n        \n        prob = 1.0 - p1 - p2 + copula_val\n        return prob\n\n    results = []\n    for case in test_cases:\n        # Define functions to get parameters based on covariate z\n        def get_params_at_z(z):\n            mu1 = case[\"mu10\"] + case[\"mu11\"] * z\n            sigma1 = case[\"sigma10\"] * np.exp(case[\"sigma11\"] * z)\n            xi1 = case[\"xi10\"] + case[\"xi11\"] * z\n            m1_params = (mu1, sigma1, xi1)\n\n            mu2 = case[\"mu20\"] + case[\"mu21\"] * z\n            sigma2 = case[\"sigma20\"] * np.exp(case[\"sigma21\"] * z)\n            xi2 = case[\"xi20\"] + case[\"xi21\"] * z\n            m2_params = (mu2, sigma2, xi2)\n\n            alpha = case[\"alpha0\"] + case[\"alpha1\"] * z\n            \n            return m1_params, m2_params, alpha\n\n        u1, u2 = case[\"u1\"], case[\"u2\"]\n        z1, z2 = case[\"z1\"], case[\"z2\"]\n\n        # Get parameter sets for the two scenarios\n        m1_params_z1, m2_params_z1, alpha_z1 = get_params_at_z(z1)\n        m1_params_z2, m2_params_z2, alpha_z2 = get_params_at_z(z2)\n\n        # Calculate probabilities for the four scenarios (P1, P2, PM, PD)\n        # P1: Margins and dependence from z1\n        p1 = get_compound_exceedance_prob(u1, u2, m1_params_z1, m2_params_z1, alpha_z1)\n        \n        # P2: Margins and dependence from z2\n        p2 = get_compound_exceedance_prob(u1, u2, m1_params_z2, m2_params_z2, alpha_z2)\n        \n        # PM: Margins from z2, dependence from z1\n        p_m = get_compound_exceedance_prob(u1, u2, m1_params_z2, m2_params_z2, alpha_z1)\n        \n        # PD: Margins from z1, dependence from z2\n        p_d = get_compound_exceedance_prob(u1, u2, m1_params_z1, m2_params_z1, alpha_z2)\n\n        # Total change\n        delta = p2 - p1\n\n        # Path A contributions\n        delta_m_a = p_m - p1\n        delta_d_a = p2 - p_m\n\n        # Path B contributions\n        delta_d_b = p_d - p1\n        delta_m_b = p2 - p_d\n\n        # Averaged contributions\n        margins_contribution = (delta_m_a + delta_m_b) / 2.0\n        dependence_contribution = (delta_d_a + delta_d_b) / 2.0\n        \n        case_results = [p1, p2, delta, margins_contribution, dependence_contribution]\n        results.append(f\"[{','.join(map(str, case_results))}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}