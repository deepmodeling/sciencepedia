{
    "hands_on_practices": [
        {
            "introduction": "在概率性事件归因中，最核心的任务是量化气候变化对特定极端事件发生可能性的影响。本练习将带你完成这一基本计算。通过使用来自“事实”世界（包含人为影响）和“反事实”世界（不含人为影响）的大型气候模式模拟数据，你将直接估计风险比（Risk Ratio, $RR$），即事件在两种情景下发生概率的比值。这个实践不仅能让你掌握 $RR$ 的计算方法，还能让你学会如何评估其统计不确定性，这是做出可靠科学论断的关键一步。",
            "id": "4041785",
            "problem": "一个全球耦合大气环流模型（GCM）被用于对一个热浪阈值进行大样本事件归因分析。该阈值定义为日最高温度超过一个由长期控制模拟校准的高分位数。生成了两组仅大气的模拟，它们具有不同的外部强迫，但具有相同的模式物理和可比的样本量：一组是具有现代强迫的“事实”世界，另一组是近似工业化前强迫的“反事实”世界。令 $N_1$ 和 $N_0$ 分别表示事实世界和反事实世界集合中，从所有集合成员和相关季节汇集的独立日样本总数，令 $n_1$ 和 $n_0$ 表示相应的超阈值事件次数。假设在每个世界中，超阈值事件是具有恒定概率的独立伯努利试验。\n\n在一次具体的分析中，模型在事实世界中生成了 $N_1 = 50{,}000$ 个日样本，其中有 $n_1 = 2{,}100$ 次超阈值事件；在反事实世界中生成了 $N_0 = 50{,}000$ 个日样本，其中有 $n_0 = 200$ 次超阈值事件。\n\n仅使用核心定义和二项抽样的大样本性质，完成以下任务：\n\n- 将事件的风险比（RR）定义为事实世界中的超阈值概率与反事实世界中的超阈值概率之比，并根据给定的计数计算其最大似然估计。\n- 从二项模型和样本比例的大样本高斯近似出发，推导估计风险比的自然对数的渐近标准误，然后使用给定的计数进行数值计算。\n\n将估计的风险比及其自然对数的渐近标准误均四舍五入至四位有效数字。报告无量纲量（不要将任何结果表示为百分比）。",
            "solution": "该问题具有科学依据，提法明确，并包含了唯一解所需的所有信息。我们可以开始分析。\n\n令 $p_1$ 为事实世界中日最高温度超阈值的真实概率，令 $p_0$ 为反事实世界中超阈值的真实概率。问题陈述，在每个世界中，超阈值事件的发生被建模为独立的伯努利试验。\n因此，事实世界中总共 $N_1$ 个样本里的超阈值事件次数 $n_1$ 是服从二项分布的随机变量的一个实现，$n_1 \\sim \\text{Bin}(N_1, p_1)$。\n类似地，反事实世界中的超阈值事件次数 $n_0$ 服从 $n_0 \\sim \\text{Bin}(N_0, p_0)$。\n\n二项分布的概率参数 $p$ 的最大似然估计（MLE）是样本比例 $\\hat{p} = \\frac{n}{N}$。\n因此，$p_1$ 和 $p_0$ 的最大似然估计为：\n$$ \\hat{p}_1 = \\frac{n_1}{N_1} $$\n$$ \\hat{p}_0 = \\frac{n_0}{N_0} $$\n\n第一个任务是定义风险比（$RR$）并计算其最大似然估计。\n$RR$ 定义为事实世界中的超阈值概率与反事实世界中的超阈值概率之比：\n$$ RR = \\frac{p_1}{p_0} $$\n\n根据最大似然估计的不变性，参数函数的最大似然估计量就是将该函数应用于参数的最大似然估计量。因此，风险比的最大似然估计（记为 $\\widehat{RR}$）为：\n$$ \\widehat{RR} = \\frac{\\hat{p}_1}{\\hat{p}_0} = \\frac{n_1/N_1}{n_0/N_0} $$\n\n使用所提供的数据，$N_1 = 50,000$，$n_1 = 2,100$，$N_0 = 50,000$，以及 $n_0 = 200$：\n$$ \\hat{p}_1 = \\frac{2,100}{50,000} = 0.042 $$\n$$ \\hat{p}_0 = \\frac{200}{50,000} = 0.004 $$\n$$ \\widehat{RR} = \\frac{0.042}{0.004} = 10.5 $$\n四舍五入到四位有效数字，我们得到 $\\widehat{RR} = 10.50$。\n\n第二个任务是推导估计风险比的自然对数的渐近标准误，$\\text{SE}(\\ln(\\widehat{RR}))$。\n令 $g(p_1, p_0) = \\ln(RR) = \\ln(\\frac{p_1}{p_0}) = \\ln(p_1) - \\ln(p_0)$。我们感兴趣的是 $g(\\hat{p}_1, \\hat{p}_0) = \\ln(\\widehat{RR})$ 的标准误。\n\n根据中心极限定理，对于大样本量，样本比例 $\\hat{p}_1$ 和 $\\hat{p}_0$ 的分布近似为高斯分布：\n$$ \\hat{p}_1 \\approx \\mathcal{N}\\left(p_1, \\frac{p_1(1-p_1)}{N_1}\\right) $$\n$$ \\hat{p}_0 \\approx \\mathcal{N}\\left(p_0, \\frac{p_0(1-p_0)}{N_0}\\right) $$\n方差为 $\\text{Var}(\\hat{p}_1) = \\frac{p_1(1-p_1)}{N_1}$ 和 $\\text{Var}(\\hat{p}_0) = \\frac{p_0(1-p_0)}{N_0}$。由于事实世界和反事实世界的模拟是独立的，因此 $\\text{Cov}(\\hat{p}_1, \\hat{p}_0) = 0$。\n\n我们使用多元Delta方法来求 $\\ln(\\widehat{RR})$ 的渐近方差。对于两个独立估计量的函数 $g(\\hat{\\theta}_1, \\hat{\\theta}_2)$，其方差近似为：\n$$ \\text{Var}(g(\\hat{\\theta}_1, \\hat{\\theta}_2)) \\approx \\left(\\frac{\\partial g}{\\partial \\theta_1}\\right)^2 \\text{Var}(\\hat{\\theta}_1) + \\left(\\frac{\\partial g}{\\partial \\theta_2}\\right)^2 \\text{Var}(\\hat{\\theta}_2) $$\n其中偏导数在真实参数值 $(\\theta_1, \\theta_2)$ 处求值。\n\n在我们的例子中，$\\theta_1 = p_1$，$\\theta_2 = p_0$，且 $g(p_1, p_0) = \\ln(p_1) - \\ln(p_0)$。偏导数为：\n$$ \\frac{\\partial g}{\\partial p_1} = \\frac{1}{p_1} $$\n$$ \\frac{\\partial g}{\\partial p_0} = -\\frac{1}{p_0} $$\n\n将这些代入Delta方法公式：\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\left(\\frac{1}{p_1}\\right)^2 \\text{Var}(\\hat{p}_1) + \\left(-\\frac{1}{p_0}\\right)^2 \\text{Var}(\\hat{p}_0) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1}{p_1^2} \\left( \\frac{p_1(1-p_1)}{N_1} \\right) + \\frac{1}{p_0^2} \\left( \\frac{p_0(1-p_0)}{N_0} \\right) $$\n$$ \\text{Var}(\\ln(\\widehat{RR})) \\approx \\frac{1-p_1}{p_1 N_1} + \\frac{1-p_0}{p_0 N_0} $$\n这是渐近方差。为了获得估计方差，我们将真实参数 $p_1$ 和 $p_0$ 替换为其最大似然估计 $\\hat{p}_1$ 和 $\\hat{p}_0$：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1-\\hat{p}_1}{\\hat{p}_1 N_1} + \\frac{1-\\hat{p}_0}{\\hat{p}_0 N_0} $$\n代入 $\\hat{p}_1 = n_1/N_1$ 和 $\\hat{p}_0 = n_0/N_0$：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{1 - n_1/N_1}{ (n_1/N_1) N_1} + \\frac{1 - n_0/N_0}{ (n_0/N_0) N_0} = \\frac{(N_1 - n_1)/N_1}{n_1} + \\frac{(N_0 - n_0)/N_0}{n_0} $$\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\frac{N_1 - n_1}{n_1 N_1} + \\frac{N_0 - n_0}{n_0 N_0} $$\n该表达式可以重写为：\n$$ \\widehat{\\text{Var}}(\\ln(\\widehat{RR})) = \\left(\\frac{1}{n_1} - \\frac{1}{N_1}\\right) + \\left(\\frac{1}{n_0} - \\frac{1}{N_0}\\right) $$\n渐近标准误是该估计方差的平方根：\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{n_1} - \\frac{1}{N_1} + \\frac{1}{n_0} - \\frac{1}{N_0}} $$\n\n现在，我们用给定的计数进行数值计算：\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} - \\frac{1}{50,000} + \\frac{1}{200} - \\frac{1}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{\\frac{1}{2,100} + \\frac{1}{200} - \\frac{2}{50,000}} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.000476190... + 0.005 - 0.00004} $$\n$$ \\text{SE}(\\ln(\\widehat{RR})) = \\sqrt{0.005436190...} \\approx 0.07373052... $$\n四舍五入到四位有效数字，我们得到 $\\text{SE}(\\ln(\\widehat{RR})) = 0.07373$。\n\n所要求的两个量是估计的风险比 $\\widehat{RR}$，以及其对数的渐近标准误 $\\text{SE}(\\ln(\\widehat{RR}))$。\n- 估计的风险比：$10.50$\n- 对数风险比的渐近标准误：$0.07373$",
            "answer": "$$\\boxed{\\begin{pmatrix} 10.50  0.07373 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了风险比的基本计算后，下一步是将其应用于实际数据并探索其稳健性。本练习要求你编写程序，针对一个重度降水事件，计算不同事件定义阈值 $\\tau$ 下的风险比。这个动手实践突显了归因研究中的一个关键问题：归因结果对事件阈值的选择非常敏感。此外，它还迫使你处理现实世界中的“边缘案例”，例如当反事实模拟中未观测到事件时，如何科学地解释和报告风险比。",
            "id": "3864390",
            "problem": "一项区域尺度的事件归因研究将超过固定日阈值的强降水作为关注事件。给定两个有限的日降水实现集合，单位为毫米/天 (mm/day)：一个代表包含所有观测强迫的现实气候 ($F$)，另一个代表移除了人为强迫的反事实气候 ($C$)。目标是计算在一系列阈值下的风险比，并检验其对阈值选择的敏感性。\n\n从概率作为指示函数期望的基本定义出发，气候状态 $S \\in \\{F, C\\}$ 下事件 $E$ 的概率可以定义为 $P_S(E) = \\mathbb{E}_S[\\mathbb{I}(X \\in E)]$，其中 $X$ 是一个日降水随机变量，$\\mathbb{I}(\\cdot)$ 是指示函数。对于一个阈值 $\\tau$ (单位 mm/day)，将强降水事件定义为 $E_{\\tau} = \\{x \\in \\mathbb{R} : x \\ge \\tau\\}$。给定一个有限集合 $x_{1:S}, x_{2:S}, \\ldots, x_{n_S:S}$，经验超越概率是指示函数值的样本均值。风险比则是同一阈值下，现实超越概率与反事实超越概率之比，并通过遍历多个阈值来评估其敏感性。\n\n您必须实现一个程序，为每个提供的测试用例执行以下步骤：\n- 计算在每个阈值 $\\tau$ 下，现实集合 $F$ 的经验超越概率，即大于或等于 $\\tau$ 的条目所占的比例。\n- 计算在每个阈值 $\\tau$ 下，反事实集合 $C$ 的经验超越概率，即大于或等于 $\\tau$ 的条目所占的比例。\n- 计算风险比 $RR(\\tau)$，即同一阈值下，现实超越概率除以反事实超越概率。\n- 边界情况处理必须遵循以下规则：\n  - 如果反事实超越概率为零而现实超越概率严格为正，则 $RR(\\tau)$ 返回 $+\\infty$。\n  - 如果现实和反事实超越概率均为零，则 $RR(\\tau)$ 返回非数值 ($\\mathrm{NaN}$)。\n  - 如果现实超越概率为零而反事实超越概率严格为正，则 $RR(\\tau)$ 返回 $0$。\n\n所有阈值的单位都必须视为 mm/day。风险比是无量纲的，应作为浮点数返回。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例在不同阈值下的风险比本身也显示为一个用方括号括起来的逗号分隔列表，所有这些列表都连接成最终的顶层列表。例如，输出格式必须类似于 $[[r_{1,1}, r_{1,2}], [r_{2,1}, r_{2,2}]]$，但使用实际计算出的值。\n\n使用以下测试套件，它涵盖了一般情况、概率相等的情况以及包括零超越概率在内的边界情况。所有降水值和阈值的单位均为 mm/day：\n\n- 测试用例 $1$ (现实气候中存在更高极端值的一般情况):\n  - 现实集合 $F_1$: $[0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10]$\n  - 反事实集合 $C_1$: $[0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8]$\n  - 阈值范围 $\\Tau_1$: $[20, 50, 80, 100]$\n\n- 测试用例 $2$ (两种气候下情况几乎相等):\n  - 现实集合 $F_2$: $[2, 7, 15, 18, 22, 30, 45, 50, 5, 12]$\n  - 反事实集合 $C_2$: $[3, 6, 16, 17, 21, 28, 47, 52, 4, 13]$\n  - 阈值范围 $\\Tau_2$: $[5, 25, 60]$\n\n- 测试用例 $3$ (现实气候呈现更重的尾部，导致在更高阈值下出现无限大的比率):\n  - 现实集合 $F_3$: $[0, 20, 45, 70, 95, 130, 5, 35]$\n  - 反事实集合 $C_3$: $[0, 10, 25, 40, 55, 70, 5, 20]$\n  - 阈值范围 $\\Tau_3$: $[40, 90, 130]$\n\n- 测试用例 $4$ (两种气候都大体干燥，出现两种概率均为零的边界情况):\n  - 现实集合 $F_4$: $[0, 0, 0, 1, 2]$\n  - 反事实集合 $C_4$: $[0, 0, 0, 1, 2]$\n  - 阈值范围 $\\Tau_4$: $[1, 5]$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个内部列表按阈值的相同顺序包含其测试用例的风险比。要求的最终输出格式为 $[[r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}], [r_{2,1}, r_{2,2}, r_{2,3}], [r_{3,1}, r_{3,2}, r_{3,3}], [r_{4,1}, r_{4,2}]]$，其中 $r_{i,j}$ 是浮点数（在适用的情况下可能包括 $+\\infty$ 和 $\\mathrm{NaN}$）。",
            "solution": "该问题是有效的。它在科学上基于气候科学和统计学的原理，特别是在极端事件归因领域。问题提法明确，提供了所有必要的数据、清晰的定义和明确的计算过程，包括对边界情况的处理。经验概率和风险比的定义在该领域是标准的。\n\n目标是计算在一系列阈值 $\\tau$ 下强降水事件的风险比 $RR(\\tau)$。该比率量化了在现实气候（有人为强迫）和反事实气候（没有人为强迫）之间，极端事件发生概率的变化。\n\n气候状态 $S$ 下事件 $E$ 的概率基本定义由指示函数的期望给出：$P_S(E) = \\mathbb{E}_S[\\mathbb{I}(X \\in E)]$，其中 $X$ 是关注的随机变量（日降水量），而 $\\mathbb{I}(\\cdot)$ 是指示函数，当其参数为真时为 $1$，否则为 $0$。关注的事件是日降水量超过阈值 $\\tau$，记为 $E_{\\tau} = \\{x \\in \\mathbb{R} : x \\ge \\tau\\}$。\n\n给定来自气候状态 $S$ 的 $n_S$ 个实现的有限集合 $\\{x_{1,S}, x_{2,S}, \\ldots, x_{n_S,S}\\}$，期望通过样本均值来估计。因此，经验超越概率是达到或超过阈值的集合成员所占的比例：\n$$\nP_S(X \\ge \\tau) = \\frac{1}{n_S} \\sum_{i=1}^{n_S} \\mathbb{I}(x_{i,S} \\ge \\tau) = \\frac{\\text{count of } x_i \\text{ such that } x_i \\ge \\tau}{n_S}\n$$\n设 $P_F(\\tau)$ 为现实集合 $F$ 的超越概率，$P_C(\\tau)$ 为反事实集合 $C$ 的超越概率。阈值 $\\tau$ 处的风险比定义为：\n$$\nRR(\\tau) = \\frac{P_F(\\tau)}{P_C(\\tau)}\n$$\n对于一个给定的测试用例，它由一个现实集合 $F$、一个反事实集合 $C$ 和一组阈值 $\\Tau$ 组成，其计算过程如下。对于每个阈值 $\\tau \\in \\Tau$：\n$1$. 计算 $F$ 中大于或等于 $\\tau$ 的值的数量，记为 $N_F(\\tau)$。\n$2$. 计算现实概率 $P_F(\\tau) = \\frac{N_F(\\tau)}{n_F}$，其中 $n_F$ 是集合 $F$ 的成员总数。\n$3$. 计算 $C$ 中大于或等于 $\\tau$ 的值的数量，记为 $N_C(\\tau)$。\n$4$. 计算反事实概率 $P_C(\\tau) = \\frac{N_C(\\tau)}{n_C}$，其中 $n_C$ 是集合 $C$ 的成员总数。\n$5$. 根据 $P_F(\\tau)$ 和 $P_C(\\tau)$ 的值，应用指定的除法和边界情况规则来计算风险比 $RR(\\tau)$：\n    - 如果 $P_C(\\tau) > 0$，则 $RR(\\tau) = \\frac{P_F(\\tau)}{P_C(\\tau)}$。这种情况同时涵盖了 $P_F(\\tau) > 0$ 和 $P_F(\\tau) = 0$（此时得出 $RR(\\tau)=0$）。\n    - 如果 $P_C(\\tau) = 0$ 且 $P_F(\\tau) > 0$，则该事件在反事实气候中不可能发生，但在现实气候中可能发生。这意味着风险无限增加，因此 $RR(\\tau) = +\\infty$。\n    - 如果 $P_C(\\tau) = 0$ 且 $P_F(\\tau) = 0$，则在两个有限集合中均未观测到该事件。比率 $\\frac{0}{0}$ 是不确定的，表示没有足够的数据来量化风险的变化。因此，$RR(\\tau) = \\mathrm{NaN}$ (非数值)。\n\n让我们以测试用例 $1$ 为例进行演算：\n- 现实集合 $F_1 = [0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10]$。大小为 $n_F = 12$。\n- 反事实集合 $C_1 = [0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8]$。大小为 $n_C = 12$。\n- 阈值 $\\Tau_1 = [20, 50, 80, 100]$。\n\n对于 $\\tau = 20$:\n- 在 $F_1$ 中超过阈值的值：$\\{35, 60, 85, 110, 20, 40, 95\\}$。计数 $N_F(20) = 7$。$P_F(20) = \\frac{7}{12}$。\n- 在 $C_1$ 中超过阈值的值：$\\{25, 40, 55, 70, 30, 60\\}$。计数 $N_C(20) = 6$。$P_C(20) = \\frac{6}{12}$。\n- $RR(20) = \\frac{7/12}{6/12} = \\frac{7}{6} \\approx 1.167$。\n\n对于 $\\tau = 50$:\n- 在 $F_1$ 中超过阈值的值：$\\{60, 85, 110, 95\\}$。计数 $N_F(50) = 4$。$P_F(50) = \\frac{4}{12}$。\n- 在 $C_1$ 中超过阈值的值：$\\{55, 70, 60\\}$。计数 $N_C(50) = 3$。$P_C(50) = \\frac{3}{12}$。\n- $RR(50) = \\frac{4/12}{3/12} = \\frac{4}{3} \\approx 1.333$。\n\n对于 $\\tau = 80$:\n- 在 $F_1$ 中超过阈值的值：$\\{85, 110, 95\\}$。计数 $N_F(80) = 3$。$P_F(80) = \\frac{3}{12}$。\n- 在 $C_1$ 中超过阈值的值：无。计数 $N_C(80) = 0$。$P_C(80) = \\frac{0}{12} = 0$。\n- 因为 $P_F(80) > 0$ 且 $P_C(80) = 0$，所以 $RR(80) = +\\infty$。\n\n对于 $\\tau = 100$:\n- 在 $F_1$ 中超过阈值的值：$\\{110\\}$。计数 $N_F(100) = 1$。$P_F(100) = \\frac{1}{12}$。\n- 在 $C_1$ 中超过阈值的值：无。计数 $N_C(100) = 0$。$P_C(100) = \\frac{0}{12} = 0$。\n- 因为 $P_F(100) > 0$ 且 $P_C(100) = 0$，所以 $RR(100) = +\\infty$。\n\n测试用例 $1$ 的最终风险比列表为 $[\\frac{7}{6}, \\frac{4}{3}, +\\infty, +\\infty]$。实现将使用浮点数表示这些值。所有其他测试用例都应用相同的过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the risk ratio for heavy precipitation events across multiple thresholds\n    for a series of test cases, each with a factual and a counterfactual climate ensemble.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (Factual_Ensemble, Counterfactual_Ensemble, Threshold_Sweep)\n    test_cases = [\n        # Test Case 1 (general case with higher factual extremes)\n        ([0, 5, 12, 35, 60, 85, 110, 20, 0, 40, 95, 10],\n         [0, 3, 8, 25, 40, 55, 70, 15, 0, 30, 60, 8],\n         [20, 50, 80, 100]),\n        \n        # Test Case 2 (near equality across climates)\n        ([2, 7, 15, 18, 22, 30, 45, 50, 5, 12],\n         [3, 6, 16, 17, 21, 28, 47, 52, 4, 13],\n         [5, 25, 60]),\n         \n        # Test Case 3 (factual exhibits heavier tail leading to infinite ratios)\n        ([0, 20, 45, 70, 95, 130, 5, 35],\n         [0, 10, 25, 40, 55, 70, 5, 20],\n         [40, 90, 130]),\n         \n        # Test Case 4 (both climates largely dry, edge-case with both probabilities zero)\n        ([0, 0, 0, 1, 2],\n         [0, 0, 0, 1, 2],\n         [1, 5])\n    ]\n\n    all_results = []\n    for f_ensemble, c_ensemble, thresholds in test_cases:\n        # Convert lists to NumPy arrays for efficient vectorized operations\n        f_array = np.array(f_ensemble, dtype=float)\n        c_array = np.array(c_ensemble, dtype=float)\n        \n        n_f = len(f_array)\n        n_c = len(c_array)\n        \n        case_results = []\n        for tau in thresholds:\n            # Compute the number of exceedances for the factual ensemble\n            n_exceed_f = np.sum(f_array >= tau)\n            # Compute the empirical exceedance probability for the factual ensemble\n            p_f = n_exceed_f / n_f\n            \n            # Compute the number of exceedances for the counterfactual ensemble\n            n_exceed_c = np.sum(c_array >= tau)\n            # Compute the empirical exceedance probability for the counterfactual ensemble\n            p_c = n_exceed_c / n_c\n            \n            # Compute the risk ratio (RR) with specified edge-case handling\n            if p_c == 0.0:\n                if p_f > 0.0:\n                    # Counterfactual prob = 0, Factual prob > 0 -> infinite risk\n                    rr = np.inf\n                else: # p_f is also 0.0\n                    # Both probabilities are 0 -> Indeterminate (0/0)\n                    rr = np.nan\n            else:\n                # Standard case, including when p_f is 0 and p_c > 0 (results in 0.0)\n                rr = p_f / p_c\n                \n            case_results.append(rr)\n        \n        all_results.append(case_results)\n\n    # Format the final output string as a list of lists.\n    # This involves creating a string representation for each inner list\n    # and then joining them together.\n    inner_list_strings = []\n    for result_list in all_results:\n        # Convert each number (including inf/nan) to its string representation\n        str_results = [str(r) for r in result_list]\n        # Join them with commas and enclose in brackets\n        inner_list_strings.append(f\"[{','.join(str_results)}]\")\n    \n    # Join the inner list strings with commas and enclose in top-level brackets\n    final_output_string = f\"[{','.join(inner_list_strings)}]\"\n    \n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "简单的事件计数方法在样本量有限时存在局限性，而参数化建模提供了一种更强大、更具洞察力的归因途径。本练习将引导你使用极值理论（Extreme Value Theory）中的广义极值（GEV）分布。你将通过解析推导，探究GEV分布的位置参数 $\\mu$ 的变化（代表气候系统平均状态的改变）如何精确地转化为事件重现期的变化。这种方法不仅能够提供比简单计数更稳健的风险评估，还能将风险的变化与气候分布的物理变化直接联系起来。",
            "id": "4041693",
            "problem": "考虑一个气候变量（例如，年最大日降水量）的年区组最大值序列 $\\{X_{1}, X_{2}, \\dots, X_{n}\\}$，其被建模为从广义极值（GEV）分布中进行的独立同分布抽样。该分布的位置参数为 $\\mu$，尺度参数为 $\\sigma>0$，形状参数为 $\\xi \\neq 0$。对于一个值 $x$，GEV分布的累积分布函数由下式给出\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n其定义域为满足 $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$ 的 $x$ 值。设 $z$ 为基准重现水平，使得在基准气候下，一年的超越概率为 $P(X > z) = \\frac{1}{T_{b}}$，其中 $T_{b} > 1$ 是以年为单位的基准重现期。\n\n假设在由系统性强迫引起的受扰动气候状态下，位置参数变为 $\\mu' = \\mu + \\Delta\\mu$，而 $\\sigma$ 和 $\\xi$ 保持不变。假设各年份之间保持独立，且阈值 $z$ 固定在其基准值上。仅使用期望值的定义和GEV累积分布函数，推导以下两个量的精确表达式：\n- 在受扰动气候下，未来 $n$ 年内超越阈值 $z$ 的期望次数，以及\n- 在受扰动气候下，与阈值 $z$ 相关的受扰动后的重现期 $T'$（以年为单位）。\n\n请用一个包含 $n$、$T_{b}$、$\\sigma$、$\\xi$ 和 $\\Delta\\mu$ 的单一闭式表达式来表示你的最终答案。你必须陈述并使用为确保有效性所需的任何定义域条件（例如，对GEV支撑集的正值约束），但你最终方框内的答案不得包含这些条件。不需要进行数值近似或四舍五入，最终方框内的表达式中也不应包含任何物理单位。",
            "solution": "广义极值（GEV）分布描述了区组最大值，其累积分布函数为\n$$\nG(x; \\mu, \\sigma, \\xi) = \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{x-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n其定义在支撑集 $1 + \\xi\\,\\frac{x-\\mu}{\\sigma} > 0$ 上。对于一个固定的阈值 $z$，在参数 $(\\mu, \\sigma, \\xi)$ 下，每年的超越概率为\n$$\np(\\mu) \\equiv P(X > z) \\;=\\; 1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n同样，定义域限制为 $1 + \\xi\\,\\frac{z-\\mu}{\\sigma} > 0$。\n\n根据重现期的定义，基准条件 $P(X > z) = 1/T_{b}$ 意味着\n$$\n1 - G(z; \\mu, \\sigma, \\xi) \\;=\\; \\frac{1}{T_{b}}\n\\;\\;\\Longrightarrow\\;\\;\nG(z; \\mu, \\sigma, \\xi) \\;=\\; 1 - \\frac{1}{T_{b}}.\n$$\n使用GEV累积分布函数，我们有\n$$\n\\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\n\\;=\\;\n1 - \\frac{1}{T_{b}}.\n$$\n对两边取自然对数，得到\n$$\n-\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right),\n$$\n所以\n$$\n\\left[1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right]^{-1/\\xi}\n\\;=\\;\n-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right).\n$$\n定义正量（对于 $T_{b} > 1$）\n$$\nA \\;\\equiv\\; -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right) \\;>\\; 0.\n$$\n那么\n$$\n1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi},\n$$\n因此\n$$\nz - \\mu\n\\;=\\;\n\\frac{\\sigma}{\\xi}\\,\\Big(A^{-\\xi} - 1\\Big).\n$$\n\n在位置参数为 $\\mu' = \\mu + \\Delta\\mu$（$\\sigma$ 和 $\\xi$ 不变）的受扰动气候下，对于同一阈值 $z$ 的每年超越概率变为\n$$\np' \\;\\equiv\\; P(X > z \\,|\\, \\mu') \\;=\\; 1 - G\\big(z; \\mu + \\Delta\\mu, \\sigma, \\xi\\big)\n\\;=\\;\n1 - \\exp\\!\\left(-\\left[1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n其受扰动后的支撑集条件为\n$$\n1 + \\xi\\,\\frac{z-(\\mu+\\Delta\\mu)}{\\sigma} \\;>\\; 0.\n$$\n使用上面找到的 $z - \\mu$ 的表达式，\n$$\n1 + \\xi\\,\\frac{z - (\\mu + \\Delta\\mu)}{\\sigma}\n\\;=\\;\n1 + \\xi\\,\\frac{(z-\\mu) - \\Delta\\mu}{\\sigma}\n\\;=\\;\n\\left(1 + \\xi\\,\\frac{z-\\mu}{\\sigma}\\right) - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\n\\;=\\;\nA^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}.\n$$\n因此，\n$$\np' \\;=\\; 1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right),\n$$\n当 $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$ 时有效（以确保受扰动后的阈值在GEV支撑集内）。\n\n根据期望的线性和独立性，在受扰动气候下，未来 $n$ 个独立年份内的期望超越次数为\n$$\nE' \\;=\\; n\\,p' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}.\n$$\n\n阈值 $z$ 的受扰动后重现期 $T'$ 定义为每年超越概率的倒数，\n$$\nT' \\;=\\; \\frac{1}{p'}\n\\;=\\;\n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1}.\n$$\n\n总结一下，当 $A = -\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)$ 时，精确表达式为\n$$\nE' \\;=\\; n\\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\},\n\\qquad\nT' \\;=\\; \\left\\{1 - \\exp\\!\\left(-\\left[A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right]^{-1/\\xi}\\right)\\right\\}^{-1},\n$$\n受制于定义域条件 $A^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma} > 0$，该条件确保了阈值 $z$ 在受扰动气候下位于支撑集内。这些公式明确地将位置偏移 $\\Delta\\mu$ 与GEV框架下 $n$ 年内的期望超越次数和相应重现期的变化联系起来。",
            "answer": "$$\\boxed{\\begin{pmatrix}\nn\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right] \n\\left[1 - \\exp\\!\\left(-\\left(\\left[-\\ln\\!\\left(1 - \\frac{1}{T_{b}}\\right)\\right]^{-\\xi} - \\xi\\,\\frac{\\Delta\\mu}{\\sigma}\\right)^{-1/\\xi}\\right)\\right]^{-1}\n\\end{pmatrix}}$$"
        }
    ]
}