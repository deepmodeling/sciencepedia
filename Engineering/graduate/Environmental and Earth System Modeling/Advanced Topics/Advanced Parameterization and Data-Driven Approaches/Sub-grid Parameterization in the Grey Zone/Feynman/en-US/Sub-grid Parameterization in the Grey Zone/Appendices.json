{
    "hands_on_practices": [
        {
            "introduction": "The first step in navigating the modeling challenges of the atmospheric grey zone is to develop a quantitative understanding of what it means for a physical phenomenon to be resolved by a numerical model. This exercise introduces the critical distinction between a model's grid spacing, $\\Delta$, and its effective resolution, $\\lambda_{\\min}$, which is the smallest scale the model can represent with physical fidelity. By calculating a simple resolvability ratio , you will gain a concrete numerical intuition for why certain features, like convective updrafts, fall into the ambiguous grey zone where they are neither fully resolved nor fully sub-grid.",
            "id": "3918979",
            "problem": "Consider an atmosphere model operating in the so-called grey zone of deep convection, where some convective structures are partially represented by the resolved dynamics and partially by sub-grid parameterizations. The horizontal grid spacing is $\\,\\Delta = 2\\,\\mathrm{km}\\,$ and the model’s numerics imply an effective resolution factor of $\\,6\\,$, meaning that reliable, energetically consistent representation of features requires a characteristic horizontal scale at least several grid cells wide due to numerical diffusion and dispersion. A convective updraft is approximately axisymmetric with radius $\\,r_{u} = 1\\,\\mathrm{km}\\,$.\n\nStarting from the definitions of grid spacing and the concept of effective resolution as the smallest physically trustworthy resolved scale, proceed as follows:\n- Use the effective resolution factor to determine the minimum resolvable horizontal length scale $\\,\\lambda_{\\min}\\,$.\n- Define the updraft’s characteristic horizontal scale as its diameter $\\,D = 2 r_{u}\\,$.\n- Define the resolvability ratio $\\,R\\,$ as the ratio of the updraft’s diameter to the minimum resolvable scale.\n- Based on physical reasoning about spectral content and numerical dissipation at scales near $\\,\\lambda_{\\min}\\,$, use $\\,R\\,$ to classify the updraft as explicitly resolved, marginally resolved, or unresolved, and justify the classification in terms of why sub-grid parameterization is or is not required in the grey zone.\n\nCompute and report the resolvability ratio $\\,R\\,$. Express the final numerical answer as a dimensionless decimal value, and round your answer to four significant figures.",
            "solution": "The problem statement is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- Horizontal grid spacing: $\\Delta = 2\\,\\mathrm{km}$\n- Effective resolution factor: $6$\n- Updraft radius: $r_{u} = 1\\,\\mathrm{km}$\n- Definition of minimum resolvable horizontal length scale: $\\lambda_{\\min}$ is determined by the effective resolution factor and the grid spacing. The problem states that reliable representation requires a characteristic scale of at least this size, which is \"several grid cells wide\".\n- Definition of updraft's characteristic horizontal scale: $D = 2 r_{u}$\n- Definition of resolvability ratio: $R = \\frac{D}{\\lambda_{\\min}}$\n- Task requirement: Compute $R$, classify the updraft's resolvability, and justify the need for sub-grid parameterization. The final value of $R$ must be a decimal rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the required criteria.\n- **Scientifically Grounded:** The problem is firmly based on fundamental concepts in numerical atmospheric modeling, specifically the relationship between grid spacing ($\\Delta$), effective resolution ($\\lambda_{\\min}$), and the representation of physical phenomena. The concept of a \"grey zone\" where phenomena are partially resolved and partially parameterized is a central topic in modern weather and climate modeling. The values provided for grid spacing and updraft size are physically realistic.\n- **Well-Posed:** All necessary information and definitions required to calculate the resolvability ratio $R$ are explicitly provided. The question is structured logically, guiding the user from intermediate calculations to a final conclusion. A unique and meaningful solution exists.\n- **Objective:** The problem is expressed in precise, technical language, free of subjective or ambiguous terminology.\n- **Completeness and Consistency:** The problem is self-contained and free of contradictions. The definitions of $\\lambda_{\\min}$, $D$, and $R$ are consistent with each other.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid as it is scientifically sound, well-posed, objective, and self-contained. A full solution will be provided.\n\nThe solution proceeds by following the steps outlined in the problem statement.\n\nFirst, we determine the minimum resolvable horizontal length scale, $\\lambda_{\\min}$. This scale represents the smallest feature that the numerical model can represent with physical and energetic consistency. It is defined as the product of the horizontal grid spacing, $\\Delta$, and the effective resolution factor.\nGiven:\n- Horizontal grid spacing, $\\Delta = 2\\,\\mathrm{km}$\n- Effective resolution factor = $6$\n\nThe minimum resolvable scale is calculated as:\n$$\n\\lambda_{\\min} = 6 \\times \\Delta\n$$\nSubstituting the value of $\\Delta$:\n$$\n\\lambda_{\\min} = 6 \\times 2\\,\\mathrm{km} = 12\\,\\mathrm{km}\n$$\n\nNext, we determine the updraft's characteristic horizontal scale, $D$. This is defined as the diameter of the approximately axisymmetric updraft.\nGiven:\n- Updraft radius, $r_{u} = 1\\,\\mathrm{km}$\n\nThe diameter is calculated as:\n$$\nD = 2 r_{u}\n$$\nSubstituting the value of $r_{u}$:\n$$\nD = 2 \\times 1\\,\\mathrm{km} = 2\\,\\mathrm{km}\n$$\n\nNow, we compute the resolvability ratio, $R$, which is defined as the ratio of the updraft's diameter to the minimum resolvable scale.\n$$\nR = \\frac{D}{\\lambda_{\\min}}\n$$\nSubstituting the calculated values for $D$ and $\\lambda_{\\min}$:\n$$\nR = \\frac{2\\,\\mathrm{km}}{12\\,\\mathrm{km}} = \\frac{1}{6}\n$$\nTo express this as a decimal value, we perform the division:\n$$\nR = 0.16666...\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nR \\approx 0.1667\n$$\n\nFinally, we classify the updraft and justify the need for parameterization based on the value of $R$.\n- **Classification:** A resolvability ratio of $R \\approx 0.1667$ means that the characteristic scale of the updraft ($D=2\\,\\mathrm{km}$) is only about $16.7\\%$ of the smallest scale the model can faithfully resolve ($\\lambda_{\\min}=12\\,\\mathrm{km}$). Since $R \\ll 1$, the updraft is definitively **unresolved**. It is far too small to be captured by the model's resolved dynamics. Features are considered \"resolved\" when $R \\gg 1$ and \"marginally resolved\" (in the grey zone) when $R \\approx 1$.\n\n- **Justification for Parameterization:** Because the updraft is unresolved, its dynamics, structure, and associated transport of heat, moisture, and momentum cannot be explicitly represented on the model grid. Any feature appearing at this scale in the model solution would be a numerically spurious artifact, heavily damped by numerical diffusion. The physical effects of the convective updraft on the larger-scale environment would be missing from the simulation. Therefore, to account for these crucial sub-grid scale processes, a **sub-grid parameterization scheme is essential**. This scheme must represent the collective statistical effects of such unresolved updrafts, thereby incorporating their impact on the resolved-scale atmospheric state. This situation is a classic example of why parameterizations are required, even as model resolution increases and enters the \"grey zone\".",
            "answer": "$$\n\\boxed{0.1667}\n$$"
        },
        {
            "introduction": "Having established a criterion for when a process is sub-grid, we now explore the mathematical origin of the terms that parameterizations are designed to represent. This practice demonstrates that the act of spatial filtering—a formal analogue to a model's finite resolution—introduces new, unclosed terms into the governing equations when applied to nonlinear processes like advection. This exercise  makes the abstract concept of sub-grid effects precise by deriving the residual flux, $\\tau = \\overline{u c} - \\overline{u}\\overline{c}$, which embodies the unresolved transport that must be parameterized in terms of resolved-scale quantities.",
            "id": "3919027",
            "problem": "Consider the one-dimensional conservation equation for a passive tracer field $c(x,t)$ advected by a velocity field $u(x,t)$ and diffused by a molecular diffusivity $\\kappa$:\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right).\n$$\nIntroduce a spatial filtering operator defined by convolution with a normalized, symmetric kernel $G_{\\delta}(r)$ of characteristic nondimensional width $\\delta$:\n$$\n\\overline{f}(x) \\equiv \\int_{-\\infty}^{\\infty} G_{\\delta}(r)\\, f(x-r)\\, \\mathrm{d}r, \\quad \\int_{-\\infty}^{\\infty} G_{\\delta}(r)\\, \\mathrm{d}r = 1, \\quad G_{\\delta}(r) = G_{\\delta}(-r).\n$$\nAssume $G_{\\delta}$ commutes with spatial differentiation. Filtering the conservation equation yields a resolved prognostic equation for $\\overline{c}(x,t)$ in which the nonlinear advective term generates a residual. Construct the residual term that arises from filtering the nonlinear advection and interpret it as a scale-transfer flux divergence that requires parameterization in the intermediate-resolution regime often called the \"grey zone.\" Your construction must start from the conservation form and the definition of the filter.\n\nThen, specialize to a Gaussian kernel $G_{\\delta}(r)$ with variance equal to $\\delta^{2}$, and to smooth, polynomial underlying fields\n$$\nu(x) = u_{0} + \\alpha\\, x, \\qquad c(x) = c_{0} + \\beta\\, x + \\gamma\\, x^{2},\n$$\nwhere $u_{0}$, $\\alpha$, $c_{0}$, $\\beta$, and $\\gamma$ are constants and all variables are nondimensional. Compute exactly, by evaluating the convolution integrals implied by $G_{\\delta}$, the residual flux divergence associated with filtered nonlinear advection,\n$$\nR(x) \\equiv \\frac{\\partial}{\\partial x}\\left(\\overline{u\\,c} - \\overline{u}\\,\\overline{c}\\right),\n$$\nand provide a single closed-form analytic expression for $R(x)$ in terms of $\\alpha$, $\\gamma$, and $\\delta$. Express your final answer as a symbolic expression; do not include any units. No numerical rounding is required.",
            "solution": "The problem asks for two main tasks: first, to derive the general form of the residual term that arises from filtering the nonlinear advection term in a one-dimensional conservation equation and interpret it; second, to compute this residual term exactly for specific polynomial forms of the velocity and tracer fields with a Gaussian filter.\n\nFirst, we address the general derivation. The given conservation equation for the tracer field $c(x,t)$ is\n$$\n\\frac{\\partial c}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(u\\,c\\right) = \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right).\n$$\nWe apply the spatial filtering operator, denoted by an overbar $\\overline{(\\cdot)}$, to each term of this equation. The filtering operator is defined by convolution and is assumed to be time-independent and to commute with spatial differentiation. Applying the filter gives\n$$\n\\overline{\\frac{\\partial c}{\\partial t}} + \\overline{\\frac{\\partial}{\\partial x}\\left(u\\,c\\right)} = \\overline{\\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial c}{\\partial x}\\right)}.\n$$\nUsing the assumed properties of the filter, this becomes\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\overline{u\\,c}\\right) = \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial \\overline{c}}{\\partial x}\\right),\n$$\nwhere we also assume the molecular diffusivity $\\kappa$ is a constant. The goal is to obtain a prognostic equation for the resolved field $\\overline{c}$ in terms of resolved quantities. The nonlinear advection term $\\frac{\\partial}{\\partial x}(\\overline{u\\,c})$ is problematic because $\\overline{u\\,c}$ is not generally equal to $\\overline{u}\\,\\overline{c}$. To handle this, we decompose the filtered product $\\overline{u\\,c}$ as follows:\n$$\n\\overline{u\\,c} = \\overline{u}\\,\\overline{c} + \\left(\\overline{u\\,c} - \\overline{u}\\,\\overline{c}\\right).\n$$\nSubstituting this decomposition into the filtered equation yields\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial}{\\partial x}\\left[\\overline{u}\\,\\overline{c} + \\left(\\overline{u\\,c} - \\overline{u}\\,\\overline{c}\\right)\\right] = \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial \\overline{c}}{\\partial x}\\right).\n$$\nRearranging the terms to isolate the evolution of $\\overline{c}$ driven by resolved-scale processes gives\n$$\n\\frac{\\partial \\overline{c}}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\overline{u}\\,\\overline{c}\\right) = \\frac{\\partial}{\\partial x}\\left(\\kappa\\,\\frac{\\partial \\overline{c}}{\\partial x}\\right) - \\frac{\\partial}{\\partial x}\\left(\\overline{u\\,c} - \\overline{u}\\,\\overline{c}\\right).\n$$\nThe term $R(x,t) \\equiv \\frac{\\partial}{\\partial x}\\left(\\overline{u\\,c} - \\overline{u}\\,\\overline{c}\\right)$ is the residual flux divergence. The quantity $\\tau(x,t) = \\overline{u\\,c} - \\overline{u}\\,\\overline{c}$ is the sub-grid scale (SGS) flux. The term $-R(x,t)$ acts as a source or sink for the resolved concentration $\\overline{c}$, representing the net effect of transport by the unresolved, sub-grid scales of motion. In the \"grey zone\" of modeling, where the grid scale (or filter width $\\delta$) is not small enough to fully separate the resolved and unresolved motions, this term is significant and its parameterization in terms of resolved fields like $\\overline{u}$ and $\\overline{c}$ is a central challenge. It represents the divergence of a flux that transfers the quantity $c$ across the scale cut-off defined by the filter.\n\nNext, we compute this residual flux divergence $R(x)$ for the specific case given. The fields are\n$$\nu(x) = u_{0} + \\alpha\\, x, \\qquad c(x) = c_{0} + \\beta\\, x + \\gamma\\, x^{2}.\n$$\nThe filter kernel is a Gaussian $G_{\\delta}(r)$ with variance $\\delta^2$. The key properties of this kernel are its moments, where $m_k = \\int_{-\\infty}^{\\infty} r^k G_{\\delta}(r) \\, \\mathrm{d}r$. Since the kernel is symmetric and normalized, we have $m_0 = 1$, $m_1 = 0$, $m_2 = \\delta^2$, and $m_3 = 0$.\n\nWe need to compute the components of the SGS flux $\\tau(x) = \\overline{u\\,c}(x) - \\overline{u}(x)\\,\\overline{c}(x)$.\n\n1.  Compute $\\overline{u}(x)$:\n    $\\overline{u}(x) = \\int_{-\\infty}^{\\infty} G_{\\delta}(r) [u_0 + \\alpha(x-r)] \\mathrm{d}r = (u_0+\\alpha x) \\int G_{\\delta}(r)\\mathrm{d}r - \\alpha \\int r G_{\\delta}(r)\\mathrm{d}r = (u_0+\\alpha x)(1) - \\alpha(0) = u_0 + \\alpha x$.\n    Thus, $\\overline{u}(x) = u(x)$.\n\n2.  Compute $\\overline{c}(x)$:\n    $\\overline{c}(x) = \\int_{-\\infty}^{\\infty} G_{\\delta}(r) [c_0 + \\beta(x-r) + \\gamma(x-r)^2] \\mathrm{d}r$.\n    Using the moments of the kernel:\n    $\\overline{c}(x) = c_0 m_0 + \\beta(x m_0 - m_1) + \\gamma(x^2 m_0 - 2x m_1 + m_2)$.\n    $\\overline{c}(x) = c_0 + \\beta x + \\gamma(x^2 + \\delta^2) = (c_0 + \\beta x + \\gamma x^2) + \\gamma\\delta^2$.\n    Thus, $\\overline{c}(x) = c(x) + \\gamma\\delta^2$.\n\n3.  Compute the product of the filtered fields, $\\overline{u}(x)\\overline{c}(x)$:\n    $\\overline{u}(x)\\overline{c}(x) = u(x) [c(x) + \\gamma\\delta^2] = u(x)c(x) + \\gamma\\delta^2 u(x)$.\n    $\\overline{u}(x)\\overline{c}(x) = u(x)c(x) + \\gamma\\delta^2(u_0 + \\alpha x)$.\n\n4.  Compute the filtered product, $\\overline{u\\,c}(x)$:\n    First, find the product $u(x)c(x)$:\n    $u(x)c(x) = (u_0 + \\alpha x)(c_0 + \\beta x + \\gamma x^2) = u_0 c_0 + (u_0\\beta + \\alpha c_0)x + (u_0\\gamma + \\alpha\\beta)x^2 + \\alpha\\gamma x^3$.\n    This is a cubic polynomial. We filter it term by term:\n    $\\overline{u\\,c}(x) = \\overline{u_0 c_0} + \\overline{(u_0\\beta + \\alpha c_0)x} + \\overline{(u_0\\gamma + \\alpha\\beta)x^2} + \\overline{\\alpha\\gamma x^3}$.\n    Using the results for filtering powers of $x$: $\\overline{1}=1$, $\\overline{x}=x$, $\\overline{x^2}=x^2+\\delta^2$, and $\\overline{x^3} = x^3+3x\\delta^2$. The last is found by $\\overline{x^3} = \\int G_{\\delta}(r)(x-r)^3\\mathrm{d}r = x^3 - 3x^2 m_1 + 3x m_2 - m_3 = x^3 + 3x\\delta^2$.\n    So,\n    $\\overline{u\\,c}(x) = u_0 c_0 + (u_0\\beta + \\alpha c_0)x + (u_0\\gamma + \\alpha\\beta)(x^2+\\delta^2) + \\alpha\\gamma(x^3+3x\\delta^2)$.\n    Expanding this and regrouping terms:\n    $\\overline{u\\,c}(x) = [u_0 c_0 + (u_0\\beta + \\alpha c_0)x + (u_0\\gamma + \\alpha\\beta)x^2 + \\alpha\\gamma x^3] + (u_0\\gamma + \\alpha\\beta)\\delta^2 + 3\\alpha\\gamma x\\delta^2$.\n    The term in brackets is $u(x)c(x)$.\n    $\\overline{u\\,c}(x) = u(x)c(x) + (u_0\\gamma + \\alpha\\beta)\\delta^2 + 3\\alpha\\gamma x\\delta^2$.\n\n5.  Compute the SGS flux $\\tau(x)$:\n    $\\tau(x) = \\overline{u\\,c}(x) - \\overline{u}(x)\\overline{c}(x)$\n    $\\tau(x) = [u(x)c(x) + (u_0\\gamma + \\alpha\\beta)\\delta^2 + 3\\alpha\\gamma x\\delta^2] - [u(x)c(x) + \\gamma\\delta^2(u_0 + \\alpha x)]$.\n    $\\tau(x) = u(x)c(x) + u_0\\gamma\\delta^2 + \\alpha\\beta\\delta^2 + 3\\alpha\\gamma x\\delta^2 - u(x)c(x) - u_0\\gamma\\delta^2 - \\alpha\\gamma x\\delta^2$.\n    The terms $u(x)c(x)$ and $u_0\\gamma\\delta^2$ cancel, leaving:\n    $\\tau(x) = \\alpha\\beta\\delta^2 + (3\\alpha\\gamma - \\alpha\\gamma) x\\delta^2 = \\alpha\\beta\\delta^2 + 2\\alpha\\gamma x\\delta^2$.\n\n6.  Compute the residual flux divergence $R(x)$:\n    $R(x) = \\frac{\\partial}{\\partial x} \\tau(x) = \\frac{\\partial}{\\partial x} \\left(\\alpha\\beta\\delta^2 + 2\\alpha\\gamma x\\delta^2\\right)$.\n    Since $\\alpha$, $\\beta$, $\\gamma$, and $\\delta$ are constants, the derivative of the first term is zero.\n    $R(x) = 2\\alpha\\gamma\\delta^2$.\n\nThis is the final expression for the residual flux divergence. It is a constant that depends on the velocity gradient (strain rate) $\\alpha$, the curvature of the tracer field $\\gamma$, and the square of the filter width $\\delta^2$. It is independent of the spatial coordinate $x$ and the constant and linear coefficients of the fields.",
            "answer": "$$\\boxed{2\\alpha\\gamma\\delta^{2}}$$"
        },
        {
            "introduction": "This chapter culminates in a hands-on coding exercise where theory meets practice. You will simulate the dynamic competition between resolved atmospheric motions and a sub-grid convection scheme using a simplified but physically grounded model. The exercise focuses on the consumption of Convective Available Potential Energy (CAPE) and investigates how numerical choices, such as the model time step $\\Delta t$ and the use of sub-stepping for the parameterization, fundamentally alter the balance between resolved and parameterized processes. By implementing and experimenting with this system , you will gain direct insight into the numerical sensitivities inherent in grey-zone modeling and appreciate the critical role of time-integration strategies.",
            "id": "3918997",
            "problem": "You are asked to design and implement a time integration experiment to quantify how adjusting the model time step and substepping alters the consumption of Convective Available Potential Energy (CAPE) and the resolved vertical motion in the \"grey zone\" where both explicit resolution and sub-grid convection contribute. The experiment must be formulated as a single-column model using a simplified but scientifically grounded set of ordinary differential equations that couple resolved vertical velocity and CAPE.\n\nUse the following foundational base and closures:\n1. The Boussinesq vertical momentum equation for the vertical velocity $w$ is modeled as\n$$\n\\frac{d w}{d t} = b - c_d w,\n$$\nwhere $b$ is vertical buoyancy (acceleration), $c_d$ is a linear drag coefficient, and $t$ is time.\n2. Convective Available Potential Energy (CAPE), denoted $A$, is defined as the vertical integral of buoyancy:\n$$\nA = \\int_{z_0}^{z_T} b \\, dz,\n$$\nso $A$ has units of $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$ (equivalent to $\\mathrm{J}\\,\\mathrm{kg}^{-1}$).\n3. In a bulk single-column closure suitable for the grey zone, approximate buoyancy as\n$$\nb \\approx \\frac{A}{L},\n$$\nwhere $L$ is a representative depth of the unstable layer (in $\\mathrm{m}$), so $b$ has units of $\\mathrm{m}\\,\\mathrm{s}^{-2}$.\n4. The CAPE budget includes two sinks: a resolved removal tied to resolved uplift and a sub-grid convective parameterization sink:\n$$\n\\frac{d A}{d t} = - \\underbrace{\\kappa_r \\frac{|w| A}{L}}_{\\text{resolved removal}} - \\underbrace{\\kappa_c A}_{\\text{convective parameterization}}.\n$$\nHere, $\\kappa_r$ is a dimensionless efficiency and $\\kappa_c$ is a rate (in $\\mathrm{s}^{-1}$). The resolved removal scales with vertical motion $|w|$ and the available energy $A$ over depth $L$.\n\nYou must simulate the coupled evolution of $w(t)$ and $A(t)$ for a fixed horizon time $T$, comparing outcomes across multiple choices of the external model time step $\\Delta t$ and the number of substeps $n_{\\text{sub}}$ used to apply the convective parameterization within each $\\Delta t$. Within each outer step of size $\\Delta t$, apply the following operator splitting:\n- First apply $n_{\\text{sub}}$ explicit-Euler substeps of the convective parameterization tendency $-\\kappa_c A$, each with internal step $\\Delta t_c = \\Delta t / n_{\\text{sub}}$.\n- Then update $w$ over the full $\\Delta t$ using explicit Euler with the buoyancy computed from the post-convective $A$:\n$$\nw \\leftarrow w + \\Delta t \\left( \\frac{A}{L} - c_d w \\right).\n$$\n- Finally apply the resolved removal of CAPE over the full $\\Delta t$ using explicit Euler:\n$$\nA \\leftarrow A - \\Delta t \\, \\kappa_r \\frac{|w| A}{L}.\n$$\n\nPositivity constraints and accounting:\n- If any update would make $A$ negative, clip $A$ to $0$ and attribute only the physically realizable amount to the corresponding sink.\n- Track separately over the whole simulation time the nonnegative integrals $C_{\\text{tot}}$ and $R_{\\text{tot}}$, defined as the total CAPE ($\\mathrm{J}\\,\\mathrm{kg}^{-1}$) consumed by the convective parameterization and by the resolved removal, respectively.\n\nUnits and outputs:\n- Express vertical velocity $w$ in $\\mathrm{m}\\,\\mathrm{s}^{-1}$ and CAPE consumption in $\\mathrm{J}\\,\\mathrm{kg}^{-1}$.\n- For each test case, your program must output a list of three floats $[w_T, C_{\\text{tot}}, R_{\\text{tot}}]$, where $w_T$ is the final resolved vertical velocity at time $T$, $C_{\\text{tot}}$ is total CAPE consumed by the convective parameterization, and $R_{\\text{tot}}$ is total CAPE consumed by resolved removal.\n\nModel constants to use in all cases:\n- Depth $L = 1000\\,\\mathrm{m}$.\n- Drag coefficient $c_d = 0.02\\,\\mathrm{s}^{-1}$.\n- Resolved removal efficiency $\\kappa_r = 0.5$ (dimensionless).\n- Convective parameterization rate $\\kappa_c = 0.005\\,\\mathrm{s}^{-1}$.\n- Simulation horizon $T = 600\\,\\mathrm{s}$.\n\nInitial conditions:\n- Unless otherwise specified, use $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$ and $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nTime integration details:\n- Use explicit Euler updates exactly as written above.\n- Use $N = \\lfloor T / \\Delta t \\rfloor$ outer steps; ignore any remainder time.\n\nTest suite:\nRun the simulation for the following parameter sets to probe different behaviors (happy path, coarse time step, strong substepping, and edge cases):\n1. Case 1 (reference fine step): $\\Delta t = 1\\,\\mathrm{s}$, $n_{\\text{sub}} = 1$, $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n2. Case 2 (coarser step, no substepping): $\\Delta t = 30\\,\\mathrm{s}$, $n_{\\text{sub}} = 1$, $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n3. Case 3 (coarser step with substepping): $\\Delta t = 30\\,\\mathrm{s}$, $n_{\\text{sub}} = 5$, $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n4. Case 4 (very coarse step, no substepping): $\\Delta t = 120\\,\\mathrm{s}$, $n_{\\text{sub}} = 1$, $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n5. Case 5 (very coarse step with substepping): $\\Delta t = 120\\,\\mathrm{s}$, $n_{\\text{sub}} = 8$, $A_0 = 1500\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n6. Case 6 (low initial CAPE edge case): $\\Delta t = 30\\,\\mathrm{s}$, $n_{\\text{sub}} = 4$, $A_0 = 100\\,\\mathrm{J}\\,\\mathrm{kg}^{-1}$, $w_0 = 0\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of this list corresponds to one test case and must itself be a list of three floats $[w_T, C_{\\text{tot}}, R_{\\text{tot}}]$ in the units specified. For example, the program must print something like $[[w_1,C_1,R_1],[w_2,C_2,R_2],\\dots]$ on a single line, with no additional text.",
            "solution": "The problem presents a valid, well-posed, and scientifically grounded task to investigate the numerical behavior of a simplified atmospheric model. All necessary parameters, constants, initial conditions, and numerical procedures are provided. The model itself, while simplified, is based on established physical principles of buoyancy, drag, and energy conservation, making it suitable for a computational experiment in the context of sub-grid parameterization. The exploration of how different time-stepping strategies ($\\Delta t$ and $n_{\\text{sub}}$) affect the model's evolution is a standard and meaningful question in computational science. The problem is therefore valid, and a solution can be constructed.\n\nThe task is to simulate the evolution of resolved vertical velocity, $w$, and Convective Available Potential Energy (CAPE), $A$, using a coupled system of ordinary differential equations. The system is given by:\n$$\n\\frac{d w}{d t} = \\frac{A}{L} - c_d w\n$$\n$$\n\\frac{d A}{d t} = - \\kappa_r \\frac{|w| A}{L} - \\kappa_c A\n$$\nwhere $L$ is a characteristic depth, $c_d$ is a drag coefficient, $\\kappa_r$ is a resolved removal efficiency, and $\\kappa_c$ is a convective parameterization rate.\n\nThe solution is obtained by numerical time integration using an operator-splitting method with an explicit Euler scheme. The total simulation horizon is $T = 600\\,\\mathrm{s}$. For a given external time step $\\Delta t$, the number of integration steps is $N = \\lfloor T / \\Delta t \\rfloor$. Each step from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ consists of three sequential operations:\n\n1.  **Convective Parameterization Update**: The effect of the sub-grid convection term, $-\\kappa_c A$, is applied first. This is done by taking $n_{\\text{sub}}$ smaller time steps, each of size $\\Delta t_c = \\Delta t / n_{\\text{sub}}$. Let $A_n$ be the CAPE at the beginning of the outer step. We compute an intermediate value, $A'_{n}$, by applying the update $n_{\\text{sub}}$ times. For each substep $j$ from $1$ to $n_{\\text{sub}}$:\n    $$\n    A^{(j)} = A^{(j-1)} - \\Delta t_c \\cdot \\kappa_c \\cdot A^{(j-1)}\n    $$\n    where $A^{(0)} = A_n$. The total CAPE consumed by this parameterization, $C_{\\text{tot}}$, is accumulated. At each step, a positivity constraint is enforced: if an update would result in $A < 0$, $A$ is set to $0$, and only the amount of CAPE actually removed is added to the accumulator. Let $A'_{n}$ be the value of CAPE after these $n_{\\text{sub}}$ substeps.\n\n2.  **Vertical Velocity Update**: The vertical velocity $w$ is then updated over the full time step $\\Delta t$ using the explicit Euler method. The buoyancy term uses the post-convective CAPE, $A'_{n}$. The value of $w$ at the start of the interval is $w_n$.\n    $$\n    w_{n+1} = w_n + \\Delta t \\left( \\frac{A'_{n}}{L} - c_d w_n \\right)\n    $$\n\n3.  **Resolved Removal Update**: Finally, the CAPE is updated due to the resolved removal term, $- \\kappa_r \\frac{|w| A}{L}$. This update is also applied over the full time step $\\Delta t$. Following the sequential nature of the operator split, this step uses the post-convective CAPE, $A'_{n}$, and the newly computed velocity, $w_{n+1}$.\n    $$\n    A_{n+1} = A'_{n} - \\Delta t \\cdot \\kappa_r \\frac{|w_{n+1}| A'_{n}}{L}\n    $$\n    The total CAPE consumed by resolved motions, $R_{\\text{tot}}$, is accumulated. Again, the positivity constraint is enforced: $A_{n+1}$ cannot be negative.\n\nThis three-step process is repeated for $N$ time steps. The algorithm starts with initial conditions $A_0$ and $w_0$. The model constants are fixed across all simulations: $L = 1000\\,\\mathrm{m}$, $c_d = 0.02\\,\\mathrm{s}^{-1}$, $\\kappa_r = 0.5$, and $\\kappa_c = 0.005\\,\\mathrm{s}^{-1}$.\n\nThe implementation will consist of a main loop that iterates through the provided test cases. For each case, a simulation function executes the time-stepping loop described above. State variables ($A$, $w$) and accumulators ($C_{\\text{tot}}$, $R_{\\text{tot}}$) are initialized. The core of the simulation is a loop that runs for $N$ steps. Inside this loop, temporary variables are used to correctly manage the flow of information in the operator-split scheme, ensuring that the output of one step becomes the input for the next, as detailed in the logic above. After the simulation completes, the final vertical velocity, $w_T$, and the total consumed CAPE, $C_{\\text{tot}}$ and $R_{\\text{tot}}$, are collected. The results from all test cases are then formatted into a single list of lists as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a time integration experiment for a simplified\n    single-column atmospheric model to quantify CAPE consumption and vertical motion\n    under different time-stepping strategies.\n    \"\"\"\n\n    # --- Model Constants ---\n    L = 1000.0  # Representative depth of the unstable layer [m]\n    c_d = 0.02  # Linear drag coefficient [s^-1]\n    kappa_r = 0.5  # Resolved removal efficiency [dimensionless]\n    kappa_c = 0.005 # Convective parameterization rate [s^-1]\n    T = 600.0   # Simulation horizon [s]\n    \n    # --- Test Suite ---\n    # Each tuple represents a test case: (delta_t, n_sub, A0, w0)\n    test_cases = [\n        (1.0, 1, 1500.0, 0.0),    # Case 1: Reference fine step\n        (30.0, 1, 1500.0, 0.0),   # Case 2: Coarser step, no substepping\n        (30.0, 5, 1500.0, 0.0),   # Case 3: Coarser step with substepping\n        (120.0, 1, 1500.0, 0.0),  # Case 4: Very coarse step, no substepping\n        (120.0, 8, 1500.0, 0.0),  # Case 5: Very coarse step with substepping\n        (30.0, 4, 100.0, 0.0),    # Case 6: Low initial CAPE edge case\n    ]\n\n    all_results = []\n\n    for params in test_cases:\n        delta_t, n_sub, A0, w0 = params\n\n        # --- State Variables ---\n        A = A0  # Convective Available Potential Energy [J/kg or m^2/s^2]\n        w = w0  # Resolved vertical velocity [m/s]\n\n        # --- Accumulators for Total Consumption ---\n        C_tot = 0.0  # CAPE consumed by convective parameterization [J/kg]\n        R_tot = 0.0  # CAPE consumed by resolved removal [J/kg]\n\n        # --- Time Integration Parameters ---\n        num_steps = int(np.floor(T / delta_t))\n        delta_tc = delta_t / n_sub if n_sub > 0 else 0.0\n\n        # --- Time-Stepping Loop ---\n        for _ in range(num_steps):\n            \n            # --- 1. Convective Parameterization Update (with substeps) ---\n            A_post_conv = A\n            for _ in range(n_sub):\n                # Calculate potential removal for this substep\n                potential_removal_conv = delta_tc * kappa_c * A_post_conv\n                \n                # Enforce positivity: actual removal cannot exceed available CAPE\n                actual_removal_conv = min(potential_removal_conv, A_post_conv)\n                \n                # Update CAPE and accumulator\n                A_post_conv -= actual_removal_conv\n                C_tot += actual_removal_conv\n\n            # --- 2. Vertical Velocity Update ---\n            # Update w using post-convective A and w from the start of the step\n            buoyancy = A_post_conv / L\n            w_new = w + delta_t * (buoyancy - c_d * w)\n\n            # --- 3. Resolved Removal Update ---\n            # Update A using post-convective A and the newly computed w\n            \n            # Calculate potential removal for this step\n            potential_removal_res = delta_t * kappa_r * abs(w_new) * A_post_conv / L\n            \n            # Enforce positivity\n            actual_removal_res = min(potential_removal_res, A_post_conv)\n            \n            # Update CAPE and accumulator\n            A_new = A_post_conv - actual_removal_res\n            R_tot += actual_removal_res\n            \n            # --- Update state for the next full time step ---\n            A = A_new\n            w = w_new\n\n        # Store the final state [w_T, C_tot, R_tot] for this case\n        all_results.append([w, C_tot, R_tot])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        }
    ]
}