{
    "hands_on_practices": [
        {
            "introduction": "谱方法的核心工具是傅里叶变换，它能将信号从物理空间转换到频率空间。这个练习将指导你通过编程实现离散傅里叶变换 (DFT)，并分析一些合成信号的频谱，这些信号模拟了地球系统模型中常见的周期性成分 ()。通过这个实践，你将学会如何从 DFT 的复数输出中提取物理上有意义的单边振幅谱，这是后续应用的基础。",
            "id": "3914642",
            "problem": "您的任务是设计并实现一个程序，用于计算实值、均匀采样的合成信号的离散傅里叶变换 (DFT)。这些信号代表了环境与地球系统建模中使用的理想化谐波分量（例如，海洋或大气动力学中的日潮和半日潮谐波）。目标是确定哪些非负频率仓对应于非零正弦分量，并使用对实信号具有物理意义的单边振幅谱报告其振幅。\n\n基本原理和定义：\n- 对于一个长度为 $N$ 的复数序列 $\\{u_n\\}_{n=0}^{N-1}$，其离散傅里叶变换 (DFT) 定义为\n$$\nU_k = \\sum_{n=0}^{N-1} u_n \\, e^{-i \\, 2\\pi k n / N}, \\quad k=0,1,\\dots,N-1,\n$$\n其中 $i$ 是虚数单位，$e^{(\\cdot)}$ 表示指数函数。\n- 一个形如 $A \\sin\\!\\big(2\\pi m n / N + \\phi\\big)$ 或 $A \\cos\\!\\big(2\\pi m n / N + \\phi\\big)$ 的实正弦分量，其中整数 $m \\in \\{0,1,\\dots,N-1\\}$，会在双边谱中的频率仓 $k=m$ 和 $k=N-m$ 处贡献能量。当 $N$ 为偶数时，在 $k=0$（直流分量）和 $k=N/2$（奈奎斯特频率）处有特殊情况。\n\n振幅报告约定：\n- 您必须使用单边振幅谱 $A_k$ 报告非负频率仓 $k \\in \\{0,1,\\dots,\\lfloor N/2 \\rfloor\\}$ 的振幅，它由 $U_k$ 定义如下：\n$$\nA_k =\n\\begin{cases}\n\\frac{|U_k|}{N},  & \\text{若 } k=0 \\text{ 或 } k=\\frac{N}{2} \\text{ (当 $N$ 为偶数时)}, \\\\[6pt]\n\\frac{2|U_k|}{N},  & \\text{若 } 1 \\le k \\le \\frac{N}{2}-1 \\text{ (当 $N$ 为偶数时)},\n\\end{cases}\n$$\n对于奇数 $N$ 的情况类似，只有 $k=0$ 使用第一种情况。这里 $|\\cdot|$ 表示复模。此约定确保了在频率仓 $k$ 处振幅为 $A$ 的纯实正弦波在单边谱中显示为 $A_k = A$，同时避免了对对称共轭对的重复计算。角度以弧度为单位。\n\n频率仓识别：\n- 识别所有单边振幅 $A_k$ 超过固定绝对容差 $\\tau = 10^{-8}$ 的非负频率仓 $k$。返回这些 $k$ 的严格递增排序列表，以及对应的振幅 $A_k$（四舍五入到六位小数）。\n\n数值与算法约束：\n- 使用标准数值库完全按照上述定义计算 DFT。您可以使用与 DFT 定义一致的快速傅里叶变换 (FFT) 实现。\n- 所有数组都是有限的，长度为 $N$，具体由测试用例指定。除非明确说明（本问题中未说明），否则不执行加窗或零填充。\n\n测试套件：\n实现您的程序来处理以下五个测试用例。每个信号都是实值的，并为 $n \\in \\{0,1,\\dots,N-1\\}$ 定义：\n1. $N=32$, $u_n = \\sin\\!\\left(2\\pi \\frac{n}{8}\\right) + \\sin\\!\\left(2\\pi \\frac{n}{16}\\right)$.\n2. $N=32$, $u_n = 0.5 + \\sin\\!\\left(2\\pi \\frac{n}{8}\\right)$。常数项是直流 (DC) 分量。\n3. $N=32$, $u_n = \\cos\\!\\left(\\pi n\\right)$。这是偶数 $N$ 的奈奎斯特分量。\n4. $N=64$, $u_n = 1.2 \\, \\sin\\!\\left(2\\pi \\frac{5 n}{64} + 0.3\\right)$.\n5. $N=64$, $u_n = 0.3 + 0.8 \\, \\cos\\!\\left(2\\pi \\frac{10 n}{64}\\right) + 0.5 \\, \\sin\\!\\left(2\\pi \\frac{12 n}{64}\\right)$.\n\n对于每个测试用例，输出一个包含以下两项的对：\n- 检测到的非负频率仓 $k$ 的排序列表；\n- 相应的单边振幅 $A_k$ 的列表，每个值四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含五个测试用例的结果，格式为方括号括起来的逗号分隔列表，每个测试用例表示为一个双元素列表。例如：\n\"[[[k_1,k_2],[A_1,A_2]],[...],[...],[...],[...]]\"\n- 最终输出不得包含空格。\n- 所有数值必须是普通十进制数。此问题中无需报告物理单位。\n- 输出必须由布尔值、整数、浮点数或这些类型的列表组成。\n\n您的实现应完全自包含，无需用户输入。",
            "solution": "经评估，该问题陈述有效。它基于傅里叶分析的原理，具有科学依据，其定义和约束条件清晰完整，表述适定，并使用客观、正式的语言。陈述中没有矛盾、歧义或事实错误。该任务是离散傅里叶变换 (DFT) 在信号处理中的一个标准应用，与指定的环境与地球系统建模领域相关。因此，我们可以着手解决。\n\n这个问题的核心是计算几个实值离散信号的单边振幅谱。对于一个实值信号 $\\{u_n\\}_{n=0}^{N-1}$，其 DFT 系数 $\\{U_k\\}_{k=0}^{N-1}$ 表现出共轭对称性，即对于 $k=1, \\dots, N-1$，$U_k = U_{N-k}^*$，其中星号表示复共轭。这种对称性意味着幅值也是对称的，$|U_k| = |U_{N-k}|$，也就是说对于 $k > N/2$ 的频率信息是冗余的。单边谱将来自对称的等效负频率仓（$k$ 和 $N-k$）的能量合并到单个正频率仓 $k$ 中，从而提供了一种物理上更直观的振幅表示。\n\n解决每个测试用例的步骤如下：\n\n1.  **信号生成**：对于给定的信号定义 $u_n$ 和采样数 $N$，生成离散序列 $\\{u_n\\}_{n=0}^{N-1}$。自变量是离散索引 $n$，其范围从 $0$ 到 $N-1$。\n\n2.  **DFT 计算**：计算序列 $\\{u_n\\}$ 的 DFT，以获得复值频域表示 $\\{U_k\\}_{k=0}^{N-1}$，使用公式：\n    $$\n    U_k = \\sum_{n=0}^{N-1} u_n \\, e^{-i \\, 2\\pi k n / N}\n    $$\n    这在计算上通过标准的快速傅里叶变换 (FFT) 算法实现，这是一种计算 DFT 的高效方法。\n\n3.  **单边振幅谱计算**：从 DFT 系数 $\\{U_k\\}$ 中，我们为非负频率仓（范围从 $k=0$ 到 $k=\\lfloor N/2 \\rfloor$）构建单边振幅谱 $\\{A_k\\}$。问题提供了精确的归一化规则，这些规则考虑了直流分量（$k=0$）和奈奎斯特频率（对于偶数 $N$，$k=N/2$）的特殊情况。\n    -   对于从 $1$ 到但不包括奈奎斯特频率的频率仓 $k$（即 $1 \\le k  N/2$），振幅通过将 DFT 系数的幅值加倍并用 $N$ 进行归一化来计算：\n        $$\n        A_k = \\frac{2|U_k|}{N}\n        $$\n        因子 $2$ 考虑了来自相应对称频率仓 $N-k$ 的能量。\n    -   对于直流分量（$k=0$）和奈奎斯特频率（$k=N/2$，如果 $N$ 是偶数），这些频率仓没有明确的对称对应部分。因此，它们的振幅计算不乘以因子 $2$：\n        $$\n        A_k = \\frac{|U_k|}{N} \\quad \\text{对于 } k=0 \\text{ 或 } k=\\frac{N}{2}\n        $$\n    这种归一化确保了形如 $A \\cos(2\\pi m n/N + \\phi)$ 的纯实正弦波将在单边谱中的频率仓 $k=m$ 处正确地记录下振幅 $A$。\n\n4.  **分量识别与格式化**：\n    -   对计算出的振幅 $\\{A_k\\}$ 进行筛选，以识别显著的频率分量。如果频率仓 $k$ 处的振幅 $A_k$ 超过指定的容差 $\\tau = 10^{-8}$，则认为该分量是显著的。\n    -   将所有显著分量的整数索引 $k$ 收集到一个列表中，并按严格递增顺序排序。\n    -   将相应的振幅 $A_k$ 收集到第二个列表中，每个值按要求四舍五入到六位小数。\n    -   该测试用例的最终结果是这两个列表组成的一个对。\n\n让我们以测试用例 1 为例说明：$N=32$, $u_n = \\sin(2\\pi \\frac{n}{8}) + \\sin(2\\pi \\frac{n}{16})$。\n这个信号可以用 DFT 频率指数 $m$ 重写为 $u_n = \\sin(2\\pi \\frac{4n}{32}) + \\sin(2\\pi \\frac{2n}{32})$。这是两个纯正弦波的叠加，其振幅均为 $1$，分别位于频率指数 $m_1=2$ 和 $m_2=4$ 处。这两个频率都落在 $1 \\le k  N/2$ 的范围内，因此适用 $2|U_k|/N$ 规则。根据傅里叶理论，单边谱应在频率仓 $k=2$ 处显示振幅为 $1.0$，在频率仓 $k=4$ 处显示振幅为 $1.0$。所有其他振幅应为零（或在机器精度范围内接近零）。该算法将识别出频率仓 $k=2$ 和 $k=4$ 是显著的，因为它们的振幅将约为 $1.0$，远高于容差 $\\tau = 10^{-8}$。因此，此用例的预期输出是 `[[2,4], [1.0, 1.0]]`。\n\n将此相同步骤系统地应用于所有五个测试用例。对于常数项（例如，用例 2 中的 $0.5$），我们预期在 $k=0$ 处有一个分量。对于像 $\\cos(\\pi n)$ 这样的项（其中 $N=32$），即 $\\cos(2\\pi \\frac{16n}{32})$，我们预期在奈奎斯特频率 $k=N/2=16$ 处有一个分量。实现将严格应用这些规则来生成最终的格式化输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the one-sided amplitude spectrum for a suite of test signals\n    and identifies significant frequency components.\n    \"\"\"\n    \n    # Define the test cases as tuples of (N, signal_function)\n    # The signal function takes the array of indices n as input.\n    test_cases = [\n        (32, lambda n: np.sin(2 * np.pi * n / 8) + np.sin(2 * np.pi * n / 16)),\n        (32, lambda n: 0.5 + np.sin(2 * np.pi * n / 8)),\n        (32, lambda n: np.cos(np.pi * n)),\n        (64, lambda n: 1.2 * np.sin(2 * np.pi * 5 * n / 64 + 0.3)),\n        (64, lambda n: 0.3 + 0.8 * np.cos(2 * np.pi * 10 * n / 64) + 0.5 * np.sin(2 * np.pi * 12 * n / 64))\n    ]\n\n    results = []\n    tolerance = 1e-8\n\n    for N, signal_func in test_cases:\n        # Step 1: Signal Generation\n        n = np.arange(N)\n        u_n = signal_func(n)\n\n        # Step 2: DFT Computation using FFT\n        U_k = np.fft.fft(u_n)\n\n        # Step 3: One-Sided Amplitude Spectrum Calculation\n        num_one_sided_freqs = N // 2 + 1\n        # Extract magnitudes for non-negative frequencies\n        U_k_mag_one_sided = np.abs(U_k[:num_one_sided_freqs])\n        \n        # Calculate amplitudes with normalization factor of 2/N\n        A_k = U_k_mag_one_sided * 2 / N\n        \n        # Correct the DC (k=0) and Nyquist (k=N/2) components\n        A_k[0] = U_k_mag_one_sided[0] / N\n        if N % 2 == 0:\n            # The last element corresponds to the Nyquist frequency\n            A_k[-1] = U_k_mag_one_sided[-1] / N\n\n        # Step 4: Component Identification and Formatting\n        # Find indices where amplitude exceeds the tolerance\n        significant_bins = np.where(A_k > tolerance)[0]\n        \n        # Get the corresponding amplitudes and round them\n        significant_amplitudes = np.round(A_k[significant_bins], 6)\n        \n        # Append the result for this case\n        results.append([significant_bins.tolist(), significant_amplitudes.tolist()])\n\n    # Final print statement in the exact required format with no spaces.\n    final_output_str = str(results).replace(\" \", \"\")\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "掌握了傅里叶变换之后，下一个关键问题是：为什么它在求解微分方程中如此强大？这个练习通过解析推导，揭示了谱方法的一个核心优势：物理空间中的微分运算在谱空间中等效为简单的乘法运算 ()。你将对一个具体的示踪剂场应用该原理，从而亲手验证这一优雅的数学性质，并加深对谱微分基本原理的理解。",
            "id": "3914646",
            "problem": "考虑一个在理想化环境和地球系统建模中使用的一维纬向周期示踪场 $u(x)$，其定义在区间 $x \\in [0,2\\pi)$ 上，具有周期性边界条件和傅里叶级数表示。设其复指数傅里叶级数定义为\n$$\nu(x) = \\sum_{k\\in\\mathbb{Z}} \\hat{u}_k \\exp(i k x),\n$$\n其中傅里叶系数 $\\hat{u}_k$ 由以下定义给出\n$$\n\\hat{u}_k = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} u(x)\\exp(-i k x)\\,\\mathrm{d}x.\n$$\n从这些定义以及微分是线性算子这一性质出发，推导函数 $u(x)$ 的傅里叶系数与其一阶空间导数 $u_x(x) = \\frac{\\mathrm{d}u}{\\mathrm{d}x}(x)$ 的傅里叶系数在该周期性域上的一般关系。然后，将您推导出的关系应用于特定的示踪场\n$$\nu(x) = \\sin(3x) + 0.5\\,\\cos(5x),\n$$\n以计算谱导数并在物理空间中重构 $u_x(x)$。在您的推导中，请明确指出 $u(x)$ 的非零傅里叶系数，并展示它们在微分下的变换过程，然后将结果简化为以 $x$ 的基本三角函数表示的 $u_x(x)$ 的解析表达式。将最终答案表示为关于 $x$ 的单一闭式函数。无需四舍五入，也无需报告单位。",
            "solution": "所述问题是有效的。这是一个关于谱方法应用的适定、自洽且有科学依据的练习，而谱方法是环境和地球系统建模的基础。我们将继续进行推导和求解。\n\n问题的核心在于傅里叶级数的一个性质，该性质将物理空间中的微分与谱（傅里叶）空间中的简单代数运算联系起来。我们将首先推导这个一般性质，然后将其应用于给定的特定函数。\n\n**第一部分：谱导数的一般关系**\n\n我们从函数 $u(x)$ 在周期性域 $x \\in [0, 2\\pi)$ 上通过其复指数傅里叶级数的定义开始：\n$$u(x) = \\sum_{k\\in\\mathbb{Z}} \\hat{u}_k \\exp(i k x)$$\n这里，$k$ 是整数波数，$\\hat{u}_k$ 是复傅里葉系数。$u(x)$ 的一阶空间导数是 $u_x(x) = \\frac{\\mathrm{d}u}{\\mathrm{d}x}$。由于微分是线性算子，我们可以对级数逐项求导。对于足够光滑的函数（如此问题中给出的函数），此操作是合理的。\n$$u_x(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( \\sum_{k\\in\\mathbb{Z}} \\hat{u}_k \\exp(i k x) \\right) = \\sum_{k\\in\\mathbb{Z}} \\hat{u}_k \\frac{\\mathrm{d}}{\\mathrm{d}x} (\\exp(i k x))$$\n复指数函数关于 $x$ 的导数是：\n$$\\frac{\\mathrm{d}}{\\mathrm{d}x} (\\exp(i k x)) = i k \\exp(i k x)$$\n将此结果代回 $u_x(x)$ 的级数，我们得到：\n$$u_x(x) = \\sum_{k\\in\\mathbb{Z}} (i k \\hat{u}_k) \\exp(i k x)$$\n根据定义，函数 $u_x(x)$ 也有一个傅里叶级数表示，其系数记为 $\\widehat{(u_x)}_k$：\n$$u_x(x) = \\sum_{k\\in\\mathbb{Z}} \\widehat{(u_x)}_k \\exp(i k x)$$\n通过令 $u_x(x)$ 的两个级数表示相等，并比较每个波数 $k$ 对应的项，我们得到函数及其导数的傅里叶系数之间的一般关系：\n$$\\widehat{(u_x)}_k = i k \\hat{u}_k$$\n这个基本结果表明，物理空间中的微分等价于在谱空间中乘以 $i k$。\n\n**第二部分：应用于特定示踪场**\n\n我们得到特定的示踪场：\n$$u(x) = \\sin(3x) + 0.5\\cos(5x)$$\n为应用谱微分法则，我们必须首先求出该函数的非零傅里叶系数 $\\hat{u}_k$。我们使用欧拉公式将 $\\sin(3x)$ 和 $\\cos(5x)$ 表示为复指数形式：\n$$\\sin(3x) = \\frac{\\exp(i3x) - \\exp(-i3x)}{2i}$$\n$$\\cos(5x) = \\frac{\\exp(i5x) + \\exp(-i5x)}{2}$$\n将这些代入 $u(x)$ 的表达式，并注意 $0.5 = \\frac{1}{2}$：\n$$u(x) = \\frac{\\exp(i3x) - \\exp(-i3x)}{2i} + \\frac{1}{2} \\left( \\frac{\\exp(i5x) + \\exp(-i5x)}{2} \\right)$$\n$$u(x) = \\frac{1}{2i}\\exp(i3x) - \\frac{1}{2i}\\exp(-i3x) + \\frac{1}{4}\\exp(i5x) + \\frac{1}{4}\\exp(-i5x)$$\n由于 $\\frac{1}{i} = -i$，我们有：\n$$u(x) = \\left(-\\frac{i}{2}\\right)\\exp(i3x) + \\left(\\frac{i}{2}\\right)\\exp(-i3x) + \\frac{1}{4}\\exp(i5x) + \\frac{1}{4}\\exp(-i5x)$$\n通过将其与一般形式 $u(x) = \\sum_{k\\in\\mathbb{Z}} \\hat{u}_k \\exp(i k x)$直接比较，我们可以明确地确定 $u(x)$ 的非零傅里叶系数：\n- 当 $k=3$ 时： $\\hat{u}_3 = -\\frac{i}{2}$\n- 当 $k=-3$ 时： $\\hat{u}_{-3} = \\frac{i}{2}$\n- 当 $k=5$ 时： $\\hat{u}_5 = \\frac{1}{4}$\n- 当 $k=-5$ 时： $\\hat{u}_{-5} = \\frac{1}{4}$\n对于 $k \\notin \\{-5, -3, 3, 5\\}$，所有其他系数 $\\hat{u}_k$ 均为零。\n\n接下来，我们应用微分法则 $\\widehat{(u_x)}_k = i k \\hat{u}_k$ 来求导数 $u_x(x)$ 的傅里叶系数：\n- 当 $k=3$ 时： $\\widehat{(u_x)}_3 = i(3)\\hat{u}_3 = 3i\\left(-\\frac{i}{2}\\right) = -\\frac{3i^2}{2} = \\frac{3}{2}$\n- 当 $k=-3$ 时： $\\widehat{(u_x)}_{-3} = i(-3)\\hat{u}_{-3} = -3i\\left(\\frac{i}{2}\\right) = -\\frac{3i^2}{2} = \\frac{3}{2}$\n- 当 $k=5$ 时： $\\widehat{(u_x)}_5 = i(5)\\hat{u}_5 = 5i\\left(\\frac{1}{4}\\right) = \\frac{5i}{4}$\n- 当 $k=-5$ 时： $\\widehat{(u_x)}_{-5} = i(-5)\\hat{u}_{-5} = -5i\\left(\\frac{1}{4}\\right) = -\\frac{5i}{4}$\n\n**第三部分：在物理空间中重构导数**\n\n我们现在从其傅里叶系数 $\\widehat{(u_x)}_k$ 重构 $u_x(x)$：\n$$u_x(x) = \\sum_{k \\in \\{-5,-3,3,5\\}} \\widehat{(u_x)}_k \\exp(i k x)$$\n$$u_x(x) = \\widehat{(u_x)}_{-5}\\exp(-i5x) + \\widehat{(u_x)}_{-3}\\exp(-i3x) + \\widehat{(u_x)}_{3}\\exp(i3x) + \\widehat{(u_x)}_{5}\\exp(i5x)$$\n代入我们刚刚计算出的系数值：\n$$u_x(x) = \\left(-\\frac{5i}{4}\\right)\\exp(-i5x) + \\left(\\frac{3}{2}\\right)\\exp(-i3x) + \\left(\\frac{3}{2}\\right)\\exp(i3x) + \\left(\\frac{5i}{4}\\right)\\exp(i5x)$$\n为了简化此表达式并返回到实值三角函数，我们将波数相反的项组合在一起：\n$$u_x(x) = \\frac{3}{2}\\left(\\exp(i3x) + \\exp(-i3x)\\right) + \\frac{5i}{4}\\left(\\exp(i5x) - \\exp(-i5x)\\right)$$\n回顾余弦和正弦的欧拉公式，$2\\cos(\\theta) = \\exp(i\\theta) + \\exp(-i\\theta)$ 和 $2i\\sin(\\theta) = \\exp(i\\theta) - \\exp(-i\\theta)$，我们可以写出：\n$$u_x(x) = \\frac{3}{2}(2\\cos(3x)) + \\frac{5i}{4}(2i\\sin(5x))$$\n$$u_x(x) = 3\\cos(3x) + \\frac{10i^2}{4}\\sin(5x)$$\n使用恒等式 $i^2 = -1$ 并化简分数，我们得到导数的最终闭式表达式：\n$$u_x(x) = 3\\cos(3x) - \\frac{5}{2}\\sin(5x)$$\n此结果与直接对原始函数 $u(x)$ 进行微分所得到的结果相同，从而证实了谱方法的正确性。",
            "answer": "$$\n\\boxed{3\\cos(3x) - \\frac{5}{2}\\sin(5x)}\n$$"
        },
        {
            "introduction": "本章的终极实践是将前面学到的概念融会贯通，构建一个用于模拟二维不可压缩流体运动的完整伪谱求解器 ()。你将为二维欧拉方程编写代码，处理其中的非线性平流项，并学习一种名为“三分之二规则”的关键技术来消除混叠误差。最后，你将通过检验能量和拟能这两个理论上的不变量，来评估你所构建模型的物理守恒性，体验从理论到实际数值模拟的全过程。",
            "id": "3914652",
            "problem": "考虑方形周期域上关于涡度场的二维不可压缩 Euler 方程。设计算域为 $[0,2\\pi]\\times[0,2\\pi]$，具有周期性边界条件，角度以弧度表示。定义涡度 $\\,\\omega(x,y,t)\\,$、流函数 $\\,\\psi(x,y,t)\\,$ 以及速度 $\\,\\mathbf{u}(x,y,t)=(u_x,u_y)\\,$。控制方程为\n$$\\frac{\\partial \\omega}{\\partial t} + J(\\psi,\\omega) = 0,$$\n其中雅可比行列式 $\\,J(\\psi,\\omega) = \\frac{\\partial \\psi}{\\partial x}\\frac{\\partial \\omega}{\\partial y} - \\frac{\\partial \\psi}{\\partial y}\\frac{\\partial \\omega}{\\partial x}\\,$，以及泊松关系 $\\,\\nabla^2 \\psi = \\omega\\,$. 速度由流函数通过 $\\,u_x = -\\frac{\\partial \\psi}{\\partial y}\\,$ 和 $\\,u_y = \\frac{\\partial \\psi}{\\partial x}\\,$ 恢复。\n\n目标是使用带有快速傅里叶变换 (FFT) 和三分之二去混叠的伪谱法计算涡度的时间演化，然后量化无粘性动力学中动能和拟能的守恒特性。动能密度 $\\,E\\,$ 和拟能密度 $\\,Z\\,$ 定义为\n$$E(t) = \\frac{1}{2}\\langle |\\mathbf{u}(x,y,t)|^2 \\rangle, \\quad Z(t) = \\frac{1}{2}\\langle \\omega(x,y,t)^2 \\rangle,$$\n其中 $\\,\\langle \\cdot \\rangle\\,$ 表示在域上的空间平均。对于无粘性二维 Euler 方程，在连续设定下，$\\,E(t)\\,$ 和 $\\,Z(t)\\,$ 均为运动不变量。在本问题中，您将评估这些不变量在采用去混叠和显式时间步进的伪谱离散化方法下被保持得如何。\n\n数值方法说明：\n- 空间离散化是在域 $\\,L_x=L_y=2\\pi\\,$ 上的一个 $\\,N\\times N\\,$ 网格（$\\,N\\,$为偶数）上进行的傅里叶伪谱法。\n- 波数与离散傅里叶变换的定义一致；由于 $\\,L_x=L_y=2\\pi\\,$，将 $\\,k_x\\,$ 和 $\\,k_y\\,$ 表示为整数值的角波数。\n- 谱方法微分通过在傅里叶空间中乘以 $\\,\\mathrm{i}k_x\\,$ 或 $\\,\\mathrm{i}k_y\\,$ 实现。\n- 非线性平流项 $\\,J(\\psi,\\omega)\\,$ 通过将所需场变换到物理空间、进行乘法运算、再变换回来的伪谱方法计算。\n- 通过将所有满足 $\\,|k_x|  K_c\\,$ 或 $\\,|k_y|  K_c\\,$（其中 $\\,K_c = \\left\\lfloor \\frac{N}{3} \\right\\rfloor\\,$）的傅里叶模态置零来强制执行三分之二去混叠。这一操作在形成物理空间乘积之前和将乘积变换回谱空间之后都进行。在每个时间步结束时，对更新后的涡度谱应用相同的截断。\n- 时间步进对无粘性动力学 $\\,\\frac{\\partial \\omega}{\\partial t} = -J(\\psi,\\omega)\\,$ 使用经典的四阶 Runge–Kutta 方法。\n\n能量和拟能诊断量：\n- 在初始时刻 $\\,t=0\\,$，使用上面定义的流函数关系和速度恢复方法，从初始涡度计算 $\\,E(0)\\,$ 和 $\\,Z(0)\\,$。\n- 积分到最终时刻 $\\,t=T\\,$ 后，计算 $\\,E(T)\\,$ 和 $\\,Z(T)\\,$。\n- 对于每个测试用例，报告两个值：\n    1. 如果 $\\,E(0)  0\\,$，返回相对变化 $\\,\\Delta E = \\frac{E(T)-E(0)}{E(0)}\\,$；如果 $\\,E(0)=0\\,$，则返回 $\\,E(T)\\,$ 作为一个无量纲标量。\n    2. 如果 $\\,Z(0)  0\\,$，返回相对变化 $\\,\\Delta Z = \\frac{Z(T)-Z(0)}{Z(0)}\\,$；如果 $\\,Z(0)=0\\,$，则返回 $\\,Z(T)\\,$ 作为一个无量纲标量。\n所有报告的值都是无量纲标量。\n\n测试套件：\n对于每个用例，指定 $\\,N\\,$、时间步长 $\\,\\Delta t\\,$、时间步数 $\\,n_\\text{steps}\\,$ 以及作为解析函数的初始涡度 $\\,\\omega(x,y,0)\\,$，角度以弧度表示。\n\n- 用例 $\\,\\text{A1}\\,$（基准分辨率，保守时间步）：\n    - $\\,N=64\\,$, $\\,\\Delta t = 0.0025\\,$, $\\,n_\\text{steps} = 400\\,$ 所以 $\\,T = 1.0\\,$.\n    - $\\,\\omega(x,y,0) = \\sin(x)\\cos(y) + 0.5\\cos(2x)\\cos(y) - 0.25\\sin(y)\\,$.\n- 用例 $\\,\\text{A2}\\,$（相同初始条件，较大时间步）：\n    - $\\,N=64\\,$, $\\,\\Delta t = 0.01\\,$, $\\,n_\\text{steps} = 200\\,$ 所以 $\\,T = 2.0\\,$.\n    - $\\,\\omega(x,y,0) = \\sin(x)\\cos(y) + 0.5\\cos(2x)\\cos(y) - 0.25\\sin(y)\\,$.\n- 用例 $\\,\\text{Z0}\\,$（零涡度边缘情况）：\n    - $\\,N=32\\,$, $\\,\\Delta t = 0.01\\,$, $\\,n_\\text{steps} = 100\\,$ 所以 $\\,T = 1.0\\,$.\n    - $\\,\\omega(x,y,0) = 0\\,$.\n- 用例 $\\,\\text{B}\\,$（更高分辨率，混合模态初始条件）：\n    - $\\,N=96\\,$, $\\,\\Delta t = 0.002\\,$, $\\,n_\\text{steps} = 300\\,$ 所以 $\\,T = 0.6\\,$.\n    - $\\,\\omega(x,y,0) = \\sin(x) + \\sin(y) + 0.1\\sin(x+y) + 0.1\\sin(2x-y)\\,$.\n\n输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个双元素列表 $\\,[$energy\\_metric$, $enstrophy\\_metric$]\\,$。例如，输出必须是\n$$[ [a_1,b_1], [a_2,b_2], [a_3,b_3], [a_4,b_4] ]$$\n的形式，所有值均为十进制数。最终值根据定义是无量纲的；因此，输出中不需要物理单位。\n\n您的程序必须是一个完整的、可运行的程序，该程序实现带去混叠的伪谱求解器，并为四个测试用例生成指定的输出。",
            "solution": "用户提供了一个有效的问题陈述。任务是使用伪谱法模拟双周期域上关于涡度的二维不可压缩 Euler 方程。模拟结果将用于量化动能和拟能的数值守恒性，这是连续系统的两个不变量。数值方案包括用于时间积分的四阶 Runge-Kutta (RK4) 方法和用于控制非线性平流项产生的混叠误差的三分之二去混叠规则。\n\n解决方案的结构如下：\n1.  **控制方程与谱表示**：回顾涡度-流函数形式的 Euler 方程及其在傅里叶空间中的表示。\n2.  **非线性项的伪谱法**：描述如何使用谱空间和物理空间的混合运算来计算雅可比项 $J(\\psi, \\omega)$。\n3.  **去混叠**：解释三分之二规则及其在问题陈述中描述的具体应用。\n4.  **时间积分**：实现用于在时间上推进涡度谱的 RK4 方案。\n5.  **诊断量计算**：使用帕塞瓦尔定理从涡度谱计算动能和拟能的公式。\n6.  **算法实现**：解决每个测试用例的计算工作流程总结。\n\n**1. 控制方程与谱表示**\n\n控制方程是涡度演化方程和将涡度 $\\omega$ 与流函数 $\\psi$ 联系起来的泊松方程：\n$$\n\\frac{\\partial \\omega}{\\partial t} + J(\\psi,\\omega) = 0 \\quad \\text{其中} \\quad J(\\psi,\\omega) = \\frac{\\partial \\psi}{\\partial x}\\frac{\\partial \\omega}{\\partial y} - \\frac{\\partial \\psi}{\\partial y}\\frac{\\partial \\omega}{\\partial x}\n$$\n$$\n\\nabla^2 \\psi = \\omega\n$$\n域是具有周期性边界条件的方形区域 $[0, 2\\pi] \\times [0, 2\\pi]$。这种周期性使得傅里叶级数表示法很自然。此域上的标量场 $f(x,y,t)$ 可以表示为：\n$$\nf(x,y,t) = \\sum_{k_x=-\\infty}^{\\infty} \\sum_{k_y=-\\infty}^{\\infty} \\hat{f}(k_x, k_y, t) e^{i(k_x x + k_y y)}\n$$\n其中 $k_x$ 和 $k_y$ 是整数波数，$\\hat{f}(k_x, k_y, t)$ 是复傅里叶系数。在数值计算中，我们在 $N \\times N$ 网格上使用离散傅里叶变换 (DFT)。波数变得离散且有限，范围从 $-N/2$ 到 $N/2-1$。\n\n空间导数在傅里叶空间中可以高效计算。偏导数的傅里叶变换是：\n$$\n\\mathcal{F}\\left(\\frac{\\partial f}{\\partial x}\\right) = i k_x \\hat{f}(k_x, k_y) \\quad \\text{和} \\quad \\mathcal{F}\\left(\\frac{\\partial f}{\\partial y}\\right) = i k_y \\hat{f}(k_x, k_y)\n$$\n泊松方程 $\\nabla^2 \\psi = \\omega$ 在傅里叶空间中变为代数形式：\n$$\n( (ik_x)^2 + (ik_y)^2 ) \\hat{\\psi} = - (k_x^2 + k_y^2) \\hat{\\psi} = \\hat{\\omega}\n$$\n这使我们能够直接从涡度谱 $\\hat{\\omega}$ 求解流函数谱 $\\hat{\\psi}$：\n$$\n\\hat{\\psi}(k_x, k_y) = -\\frac{\\hat{\\omega}(k_x, k_y)}{k_x^2 + k_y^2} \\quad \\text{对于} \\quad (k_x, k_y) \\neq (0,0)\n$$\n对于平均模态 $(k_x, k_y) = (0,0)$，分母为零。所有测试用例的初始涡度平均值为零，因此 $\\hat{\\omega}(0,0)=0$。流函数的平均值 $\\hat{\\psi}(0,0)$ 在物理上是无关紧要的，因为它不影响速度场（速度场取决于 $\\psi$ 的导数），所以我们设置 $\\hat{\\psi}(0,0) = 0$。\n\n**2. 非线性项的伪谱法**\n\n非线性雅可比项 $J(\\psi, \\omega)$ 涉及场的乘积，这在傅里叶空间中对应于卷积。直接计算这些卷积的计算成本很高 ($O(N^4)$)。伪谱法提供了一种更高效的 $O(N^2 \\log N)$ 方法：\n1.  从谱场 $\\hat{\\omega}$ 和 $\\hat{\\psi}$ 开始。\n2.  计算所需导数的谱表示，例如 $\\widehat{\\frac{\\partial \\psi}{\\partial x}} = i k_x \\hat{\\psi}$。\n3.  对这些谱导数应用快速傅里叶逆变换 (IFFT)，以获得它们在物理空间中对应的场，例如 $\\frac{\\partial \\psi}{\\partial x}(x,y)$。\n4.  在物理空间中执行乘法，以计算 $J(x,y) = \\frac{\\partial \\psi}{\\partial x}\\frac{\\partial \\omega}{\\partial y} - \\frac{\\partial \\psi}{\\partial y}\\frac{\\partial \\omega}{\\partial x}$。\n5.  对 $J(x,y)$ 应用快速傅里叶正变换 (FFT)，以获得其谱 $\\hat{J}(k_x, k_y)$。\n\n涡度谱的时间演化则由 $\\frac{\\partial \\hat{\\omega}}{\\partial t} = - \\hat{J}$ 给出。\n\n**3. 去混叠**\n\n由于离散傅里叶变换(DFT)的周期性，物理空间中的乘法会产生人为的高频模态，这种现象称为混叠。应用三分之二去混叠规则来防止这种情况。截止波数定义为 $K_c = \\lfloor N/3 \\rfloor$。\n根据问题的规定，该过程包括三个滤波步骤：\n1.  **乘积前**：在将导数（例如 $\\widehat{\\frac{\\partial \\psi}{\\partial x}}$）变换到物理空间进行乘法之前，所有满足 $|k_x|  K_c$ 或 $|k_y|  K_c$ 的傅里叶系数都被置为零。这确保了相乘的场的光谱内容受到限制。\n2.  **乘积后**：在物理空间中计算乘积（雅可比项）并将其变换回傅里叶空间后，再次使用相同的规则截断得到的谱 $\\hat{J}$。这移除了由乘法产生并可能导致混叠的高频内容。\n3.  **时间步结束时**：在完成整个 RK4 时间步后，最后一次截断更新后的涡度谱 $\\hat{\\omega}(t+\\Delta t)$。\n\n此过程确保所有非线性相互作用都没有混叠误差。\n\n**4. 时间积分**\n\n涡度谱的半离散化方程是一个常微分方程 (ODE)：\n$$\n\\frac{d\\hat{\\omega}(t)}{dt} = \\mathcal{R}(\\hat{\\omega}(t))\n$$\n其中 $\\mathcal{R}(\\hat{\\omega}(t)) = -\\hat{J}(\\psi,\\omega)$ 是右侧项，它包括带去混叠的伪谱计算。该常微分方程组使用经典的四阶 Runge-Kutta (RK4) 方法进行积分。对于从 $t_n$ 到 $t_{n+1}=t_n+\\Delta t$ 的一个时间步：\n$$\n\\begin{aligned}\n    k_1 = \\mathcal{R}(\\hat{\\omega}_n) \\\\\n    k_2 = \\mathcal{R}(\\hat{\\omega}_n + \\frac{\\Delta t}{2} k_1) \\\\\n    k_3 = \\mathcal{R}(\\hat{\\omega}_n + \\frac{\\Delta t}{2} k_2) \\\\\n    k_4 = \\mathcal{R}(\\hat{\\omega}_n + \\Delta t k_3) \\\\\n    \\hat{\\omega}_{n+1} = \\hat{\\omega}_n + \\frac{\\Delta t}{6} (k_1 + 2k_2 + 2k_3 + k_4)\n\\end{aligned}\n$$\n计算出 $\\hat{\\omega}_{n+1}$ 后，应用步末去混叠滤波器。\n\n**5. 诊断量计算**\n\n动能 $E$ 和拟能 $Z$ 是使用帕塞瓦尔定理从涡度谱 $\\hat{\\omega}$ 计算得出的。对于 NumPy 使用的 DFT 归一化，平方场 $\\langle f^2 \\rangle$ 的空间平均值与其 FFT $\\hat{f}_{FFT}$ 相关：\n$$\n\\langle f^2 \\rangle = \\frac{1}{N^2} \\sum_{j,l=0}^{N-1} |f(x_j, y_l)|^2 = \\frac{1}{N^4} \\sum_{k_x, k_y} |\\hat{f}_{FFT}(k_x, k_y)|^2\n$$\n因此，拟能 $Z = \\frac{1}{2} \\langle \\omega^2 \\rangle$ 为：\n$$\nZ(t) = \\frac{1}{2N^4} \\sum_{k_x, k_y} |\\hat{\\omega}(k_x, k_y, t)|^2\n$$\n动能 $E = \\frac{1}{2} \\langle |\\mathbf{u}|^2 \\rangle = \\frac{1}{2} \\langle u_x^2 + u_y^2 \\rangle$ 也可以用 $\\hat{\\omega}$ 表示。首先，我们找到速度谱：$\\hat{u}_x = -ik_y \\hat{\\psi}$ 和 $\\hat{u}_y = ik_x \\hat{\\psi}$。代入 $\\hat{\\psi}$，我们有：\n$$\nE(t) = \\frac{1}{2N^4} \\sum_{(k_x,k_y) \\neq (0,0)} (k_x^2 + k_y^2) |\\hat{\\psi}|^2 = \\frac{1}{2N^4} \\sum_{(k_x,k_y) \\neq (0,0)} \\frac{|\\hat{\\omega}(k_x, k_y, t)|^2}{k_x^2 + k_y^2}\n$$\n排除 $(k_x,k_y)=(0,0)$ 模态，因为它不包含动能。\n\n**6. 算法实现**\n\n对于每个测试用例，求解器按以下步骤进行：\n1.  设置计算网格 ($N \\times N$) 和相应的二维波数数组 ($k_x, k_y$)。预计算拉普拉斯逆算子和去混叠掩码。\n2.  在网格上评估初始涡度 $\\omega(x,y,0)$ 并通过 FFT 计算其谱 $\\hat{\\omega}(0)$。对此初始谱应用去混叠滤波器。\n3.  使用谱公式计算初始能量 $E(0)$ 和拟能 $Z(0)$。\n4.  循环指定的步数 ($n_\\text{steps}$)，在每一步使用 RK4 方法推进 $\\hat{\\omega}$。用于常微分方程右侧项的函数封装了雅可比行列式的完整伪谱和去混叠过程。\n5.  在最后一个时间步后，计算最终能量 $E(T)$ 和拟能 $Z(T)$。\n6.  计算所需的输出指标（$\\Delta E$ 或 $E(T)$，以及 $\\Delta Z$ 或 $Z(T)$）并存储它们。\n7.  处理完所有用例后，将结果格式化为指定的字符串格式并打印到标准输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case A1: (N, dt, n_steps, omega_func)\n        (64, 0.0025, 400, lambda x, y: np.sin(x)*np.cos(y) + 0.5*np.cos(2*x)*np.cos(y) - 0.25*np.sin(y)),\n        # Case A2\n        (64, 0.01, 200, lambda x, y: np.sin(x)*np.cos(y) + 0.5*np.cos(2*x)*np.cos(y) - 0.25*np.sin(y)),\n        # Case Z0\n        (32, 0.01, 100, lambda x, y: np.zeros_like(x)),\n        # Case B\n        (96, 0.002, 300, lambda x, y: np.sin(x) + np.sin(y) + 0.1*np.sin(x+y) + 0.1*np.sin(2*x-y))\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _run_solver(*params)\n        results.append(result)\n        \n    # Format the output into the specified string format: [[a1,b1],[a2,b2],...]\n    # Using str(r) produces spaces, e.g., '[1.2, 3.4]'\n    # The template 'f\"[{','.join(map(str, results))}]\"' produces '[[1.2, 3.4],[5.6, 7.8]]'\n    # which seems to be the intended format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _run_solver(N, dt, n_steps, omega_func):\n    \"\"\"\n    Solves the 2D Euler equations for a single test case.\n    \"\"\"\n    # 1. Grid, Wavenumbers, and Pre-computation\n    L = 2.0 * np.pi\n    dx = L / N\n    # Physical grid\n    x = np.arange(N) * dx\n    X, Y = np.meshgrid(x, x, indexing='ij')\n\n    # Wavenumber grid (integer angular wavenumbers for domain size 2*pi)\n    k_1d = np.fft.fftfreq(N) * N\n    kx, ky = np.meshgrid(k_1d, k_1d, indexing='ij')\n    \n    # Inverse Laplacian for Poisson solve: inv_lap = -1/(k_x^2+k_y^2)\n    k_sq = kx**2 + ky**2\n    # Avoid division by zero for the k=0 mode.\n    # The w_hat[0,0] is zero, so psi_hat[0,0] will be 0.\n    inv_lap = np.divide(-1.0, k_sq, out=np.zeros_like(k_sq), where=(k_sq != 0))\n\n    # Dealiasing filter setup (2/3 rule)\n    Kc = N // 3\n    dealias_mask = (np.abs(kx) > Kc) | (np.abs(ky) > Kc)\n\n    def dealias(f_hat):\n        \"\"\"Applies the dealiasing filter to a spectral field.\"\"\"\n        f_hat[dealias_mask] = 0.0\n        return f_hat\n\n    # 2. Diagnostics: Energy and Enstrophy Calculation\n    def calculate_invariants(w_hat):\n        \"\"\"Computes kinetic energy and enstrophy from the vorticity spectrum.\"\"\"\n        # Enstrophy Z = 0.5 *"
        }
    ]
}