{
    "hands_on_practices": [
        {
            "introduction": "谱方法的核心优势之一在于它能将物理空间中复杂的微分运算转化为谱空间中简单的代数运算。本练习将通过推导双调和算子 $\\nabla^4$ 的谱表示来具体展示这一强大特性，该算子在模拟耗散过程中至关重要。我们将利用球谐函数是球面拉普拉斯算子特征函数这一关键性质。 ",
            "id": "3914974",
            "problem": "考虑单位球面上的一个标量场 $q(\\theta,\\phi)$，用标准球坐标 $\\theta \\in [0,\\pi]$ 和 $\\phi \\in [0,2\\pi)$ 表示。单位球面意味着几何半径 $a$ 为 $a = 1$，因此所有算子都是无量纲的。单位球面上的 Laplace–Beltrami 算子 $\\nabla^{2}$（也称为球拉普拉斯算子）定义为\n$$\n\\nabla^{2} f(\\theta,\\phi) \\equiv \\frac{1}{\\sin\\theta}\\frac{\\partial}{\\partial \\theta}\\!\\left(\\sin\\theta\\,\\frac{\\partial f}{\\partial \\theta}\\right) + \\frac{1}{\\sin^{2}\\theta}\\,\\frac{\\partial^{2} f}{\\partial \\phi^{2}}.\n$$\n假设 $q(\\theta,\\phi)$ 允许球谐展开\n$$\nq(\\theta,\\phi) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\hat{q}_{\\ell m}\\,Y_{\\ell}^{m}(\\theta,\\phi),\n$$\n其中 $Y_{\\ell}^{m}(\\theta,\\phi)$ 是单位球面上的标准正交球谐函数。利用 $Y_{\\ell}^{m}$ 的完备性和正交性以及球面上 Laplace–Beltrami 算子的定义，推导作用于 $q(\\theta,\\phi)$ 的双调和算子 $\\nabla^{4} \\equiv \\nabla^{2}\\nabla^{2}$ 的谱（球谐）表示，并计算相应的以总波数 $\\ell$ 表示的特征值。你的最终答案必须是仅用 $\\ell$ 表示的单个闭式解析表达式，对应于作用在单位球面上的 $Y_{\\ell}^{m}$ 的 $\\nabla^{4}$ 算子的特征值。不需要数值近似。",
            "solution": "问题陈述已经过严格的验证过程。\n\n**第一步：提取已知条件**\n- 单位球面上的标量场：$q(\\theta,\\phi)$，其中 $\\theta \\in [0,\\pi]$ 且 $\\phi \\in [0,2\\pi)$。\n- 单位球面半径：$a = 1$。\n- Laplace–Beltrami 算子：$\\nabla^{2} f(\\theta,\\phi) \\equiv \\frac{1}{\\sin\\theta}\\frac{\\partial}{\\partial \\theta}\\!\\left(\\sin\\theta\\,\\frac{\\partial f}{\\partial \\theta}\\right) + \\frac{1}{\\sin^{2}\\theta}\\,\\frac{\\partial^{2} f}{\\partial \\phi^{2}}$。\n- 球谐展开：$q(\\theta,\\phi) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\hat{q}_{\\ell m}\\,Y_{\\ell}^{m}(\\theta,\\phi)$。\n- 基函数：$Y_{\\ell}^{m}(\\theta,\\phi)$ 是单位球面上的标准正交球谐函数。\n- 双调和算子定义：$\\nabla^{4} \\equiv \\nabla^{2}\\nabla^{2}$。\n- 目标：推导 $\\nabla^{4} q(\\theta,\\phi)$ 的谱表示，并计算 $\\nabla^4$ 算子关于总波数 $\\ell$ 的相应特征值。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它基于有关 Laplace–Beltrami 算子和球谐函数的数学物理和微分几何的标准的、公认的原理。这是一个适定问题，提供了所有必要的定义以确定特征值的唯一、有意义的解。语言客观而精确。该问题是自洽的、一致的，并且在数学上是可行的。未发现与科学不健全、不完整或模糊性相关的缺陷。\n\n**第三步：结论与行动**\n问题被认定为有效。将推导解答。\n\n推导过程从球谐函数相对于 Laplace–Beltrami 算子的基本性质出发。根据定义，球谐函数 $Y_{\\ell}^{m}(\\theta,\\phi)$ 是球面上 Laplace–Beltrami 算子 $\\nabla^2$ 的特征函数。对于半径为 $a$ 的球面，特征值方程为：\n$$\n\\nabla^{2} Y_{\\ell}^{m}(\\theta,\\phi) = -\\frac{\\ell(\\ell+1)}{a^2} Y_{\\ell}^{m}(\\theta,\\phi)\n$$\n其中 $\\ell$ 是总波数（一个非负整数，$\\ell \\ge 0$），$m$ 是纬向波数（一个整数，$-\\ell \\le m \\le \\ell$）。问题指定了一个单位球面，其 $a=1$。因此，特征值方程简化为：\n$$\n\\nabla^{2} Y_{\\ell}^{m}(\\theta,\\phi) = -\\ell(\\ell+1) Y_{\\ell}^{m}(\\theta,\\phi)\n$$\n值 $-\\ell(\\ell+1)$ 是算子 $\\nabla^2$ 对应于特征函数 $Y_{\\ell}^{m}$ 的特征值。\n\n问题要求双调和算子 $\\nabla^{4}$（定义为 $\\nabla^{4} \\equiv \\nabla^{2}\\nabla^{2}$）的谱表示和特征值。这意味着应用 Laplace–Beltrami 算子两次。$\\nabla^2$ 的线性是一个关键性质。\n\n让我们找出 $\\nabla^4$ 对单个球谐基函数 $Y_{\\ell}^{m}(\\theta,\\phi)$ 的作用。\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = \\nabla^{2} \\left( \\nabla^{2} Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n我们代入 $\\nabla^{2} Y_{\\ell}^{m}(\\theta,\\phi)$ 的特征值方程的结果：\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = \\nabla^{2} \\left( -\\ell(\\ell+1) Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n由于对于任何给定的 $\\ell$，$-\\ell(\\ell+1)$ 是一个标量常数，它可以从线性算子 $\\nabla^2$ 中提出来：\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = -\\ell(\\ell+1) \\left( \\nabla^{2} Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n现在，我们再次应用 $\\nabla^2$ 的特征值性质：\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = -\\ell(\\ell+1) \\left( -\\ell(\\ell+1) Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n将标量因子相乘得到：\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = \\left( -\\ell(\\ell+1) \\right)^2 Y_{\\ell}^{m}(\\theta,\\phi)\n$$\n$$\n\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) = (\\ell(\\ell+1))^2 Y_{\\ell}^{m}(\\theta,\\phi)\n$$\n这是算子 $\\nabla^4$ 的一个特征值方程。它表明球谐函数 $Y_{\\ell}^{m}$ 也是双调和算子 $\\nabla^4$ 的特征函数，其对应的特征值为 $(\\ell(\\ell+1))^2$。该特征值仅依赖于总波数 $\\ell$，而不依赖于纬向波数 $m$。\n\n为了找到 $\\nabla^{4}q(\\theta,\\phi)$ 的谱表示，我们将该算子应用于 $q(\\theta,\\phi)$ 的球谐展开。由于 $\\nabla^4$ 的线性，我们可以将算子单独应用于级数的每一项：\n$$\n\\nabla^{4} q(\\theta,\\phi) = \\nabla^{4} \\left( \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\hat{q}_{\\ell m}\\,Y_{\\ell}^{m}(\\theta,\\phi) \\right) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\hat{q}_{\\ell m} \\left( \\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n代入我们关于 $\\nabla^{4} Y_{\\ell}^{m}(\\theta,\\phi)$ 的结果：\n$$\n\\nabla^{4} q(\\theta,\\phi) = \\sum_{\\ell=0}^{\\infty}\\sum_{m=-\\ell}^{\\ell} \\hat{q}_{\\ell m} \\left( (\\ell(\\ell+1))^2 Y_{\\ell}^{m}(\\theta,\\phi) \\right)\n$$\n这就是 $\\nabla^{4}q(\\theta,\\phi)$ 的谱表示。$\\nabla^{4}q$ 的球谐系数是 $(\\ell(\\ell+1))^2 \\hat{q}_{\\ell m}$。\n\n问题明确要求将作用于 $Y_{\\ell}^m$ 的 $\\nabla^4$ 的特征值表示为仅含 $\\ell$ 的闭式解析表达式。从特征值方程 $\\nabla^{4} Y_{\\ell}^{m} = (\\ell(\\ell+1))^2 Y_{\\ell}^{m}$ 可知，该特征值显然是 $(\\ell(\\ell+1))^2$。",
            "answer": "$$\n\\boxed{(\\ell(\\ell+1))^2}\n$$"
        },
        {
            "introduction": "在理解了微分算子在谱空间中的简化表示后，下一个合乎逻辑的步骤是学习如何将一个物理场表示在谱域中。本练习聚焦于计算一个纬向对称场的球谐函数系数。这是一个宝贵的实践，它不仅巩固了球谐变换的定义，还清晰地展示了物理对称性如何巧妙地反映在谱系数中。 ",
            "id": "3915028",
            "problem": "考虑单位球面上的一个仅依赖于地理纬度 $\\phi$ 的标量场，记为 $f(\\phi)$，其中经度为 $\\lambda \\in [0,2\\pi)$，纬度为 $\\phi \\in \\left[-\\frac{\\pi}{2},\\frac{\\pi}{2}\\right]$。令余纬为 $\\theta = \\frac{\\pi}{2}-\\phi$，从而有 $\\cos\\theta = \\sin\\phi$ 和 $\\sin\\theta = \\cos\\phi$。复球面谐波 $Y_{\\ell}^{m}(\\theta,\\lambda)$ 定义为\n$$\nY_{\\ell}^{m}(\\theta,\\lambda) \\;=\\; N_{\\ell m}\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\exp(i m \\lambda),\n$$\n其中 $P_{\\ell}^{m}$ 是连带勒让德函数（使用 Condon–Shortley 相位约定），且\n$$\nN_{\\ell m} \\;=\\; \\sqrt{\\frac{2\\ell+1}{4\\pi}\\,\\frac{(\\ell - m)!}{(\\ell + m)!}}。\n$$\n假设在单位球面上使用标准的 $L^{2}$ 内积，则 $f$ 的球面谐波系数 $a_{\\ell m}$ 通过曲面内积定义为\n$$\na_{\\ell m} \\;=\\; \\int_{0}^{2\\pi}\\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,Y_{\\ell}^{m}(\\theta,\\lambda)^{\\ast}\\,\\cos\\phi\\,\\mathrm{d}\\phi\\,\\mathrm{d}\\lambda,\n$$\n其中 ${}^{\\ast}$ 表示复共轭，单位球面上的曲面元为 $\\mathrm{d}\\Omega=\\cos\\phi\\,\\mathrm{d}\\phi\\,\\mathrm{d}\\lambda$。\n\n从上述定义出发，且仅利用复指数在 $[0,2\\pi)$ 上的基本正交性，即\n$$\n\\int_{0}^{2\\pi} \\exp\\!\\big(i(m-m')\\lambda\\big)\\,\\mathrm{d}\\lambda \\;=\\; 2\\pi\\,\\delta_{m m'},\n$$\n推导 $a_{\\ell m}$ 的单个闭式表达式，该表达式用关于 $\\phi$ 的一维积分表示，并严格解释为什么对于一个仅与纬度相关的场 $f(\\phi)$，只有纬向波数 $m=0$ 的模态可以是非零的。你的最终答案必须是 $a_{\\ell m}$ 的单个解析表达式，完全用 $f(\\phi)$、$\\ell$、 $m$、勒让德多项式 $P_{\\ell}$ 和标准常数表示。不需要进行数值计算，也不需要单位。将最终答案表示为单个表达式；不要分情况单独给出。",
            "solution": "所述问题是有效的。它在数学物理原理上有科学依据，内部一致，适定，并且包含得到唯一解所需的所有必要信息。因此，我们可以进行推导。\n\n单位球面上标量场 $f$ 的球面谐波系数 $a_{\\ell m}$ 由内积给出：\n$$\na_{\\ell m} \\;=\\; \\int_{0}^{2\\pi}\\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,Y_{\\ell}^{m}(\\theta,\\lambda)^{\\ast}\\,\\cos\\phi\\,\\mathrm{d}\\phi\\,\\mathrm{d}\\lambda\n$$\n其中 ${}^{\\ast}$ 表示复共轭，$\\phi$ 是纬度，$\\lambda$ 是经度，$\\theta = \\frac{\\pi}{2}-\\phi$ 是余纬。单位球面上的曲面元为 $\\mathrm{d}\\Omega=\\cos\\phi\\,\\mathrm{d}\\phi\\,\\mathrm{d}\\lambda$。\n\n复球面谐波 $Y_{\\ell}^{m}(\\theta, \\lambda)$ 定义为：\n$$\nY_{\\ell}^{m}(\\theta,\\lambda) \\;=\\; N_{\\ell m}\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\exp(i m \\lambda)\n$$\n其中 $N_{\\ell m}$ 是一个实值归一化常数，$P_{\\ell}^{m}$ 是实值连带勒让德函数。因此，其复共轭为：\n$$\nY_{\\ell}^{m}(\\theta,\\lambda)^{\\ast} \\;=\\; N_{\\ell m}\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\exp(-i m \\lambda)\n$$\n将此代入 $a_{\\ell m}$ 的表达式中：\n$$\na_{\\ell m} \\;=\\; \\int_{0}^{2\\pi}\\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,\\left( N_{\\ell m}\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\exp(-i m \\lambda) \\right)\\,\\cos\\phi\\,\\mathrm{d}\\phi\\,\\mathrm{d}\\lambda\n$$\n问题陈述标量场 $f$ 仅是纬度的函数，即 $f(\\phi)$。余纬 $\\theta$ 也仅是 $\\phi$ 的函数。因此，项 $f(\\phi)$、$N_{\\ell m}$、$P_{\\ell}^{m}(\\cos\\theta)$ 和 $\\cos\\phi$ 都与经度 $\\lambda$ 无关。我们可以使用 Fubini 定理将二重积分分离为两个单变量积分的乘积：\n$$\na_{\\ell m} \\;=\\; N_{\\ell m} \\left( \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\cos\\phi\\,\\mathrm{d}\\phi \\right) \\left( \\int_{0}^{2\\pi} \\exp(-i m \\lambda)\\,\\mathrm{d}\\lambda \\right)\n$$\n我们现在关注关于经度 $\\lambda$ 的积分：\n$$\n\\int_{0}^{2\\pi} \\exp(-i m \\lambda)\\,\\mathrm{d}\\lambda\n$$\n这个积分可以使用所提供的复指数的正交关系来计算：\n$$\n\\int_{0}^{2\\pi} \\exp\\!\\big(i(k-k')\\lambda\\big)\\,\\mathrm{d}\\lambda \\;=\\; 2\\pi\\,\\delta_{k k'}\n$$\n为了使我们的积分与此形式匹配，我们可以将 $\\exp(-im\\lambda)$ 写为 $\\exp(i(0-m)\\lambda)$。这相当于在正交关系中设置 $k=0$ 和 $k'=m$。因此，计算结果为：\n$$\n\\int_{0}^{2\\pi} \\exp(-i m \\lambda)\\,\\mathrm{d}\\lambda \\;=\\; 2\\pi\\,\\delta_{0 m}\n$$\n克罗内克 δ 符号 $\\delta_{0m}$，在 $m=0$ 时等于 $1$，在 $m \\neq 0$ 时等于 $0$。\n\n将此结果代回 $a_{\\ell m}$ 的表达式中：\n$$\na_{\\ell m} \\;=\\; N_{\\ell m} \\left( \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}^{m}(\\cos\\theta)\\,\\cos\\phi\\,\\mathrm{d}\\phi \\right) (2\\pi\\,\\delta_{0 m})\n$$\n因子 $\\delta_{0m}$ 的存在为只有纬向波数 $m=0$ 的模态可以是非零的提供了严格的理由。如果纬向波数 $m$ 是除零以外的任何整数，则 $\\delta_{0m}=0$，这会迫使整个系数 $a_{\\ell m}$ 为零。从物理上讲，一个与经度无关的场 $f(\\phi)$ 是纬向对称的，并且在纬向上不包含任何波动变化。因此，其谱表示不能包含任何非纬向（$m \\neq 0$）分量。\n\n由于对于所有 $m \\neq 0$ 的情况，$a_{\\ell m} = 0$，我们只需要计算 $m=0$ 情况下的表达式。对于 $m=0$，我们有 $\\delta_{00}=1$。系数 $a_{\\ell 0}$ 是：\n$$\na_{\\ell 0} \\;=\\; 2\\pi\\,N_{\\ell 0} \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}^{0}(\\cos\\theta)\\,\\cos\\phi\\,\\mathrm{d}\\phi\n$$\n现在我们简化 $m=0$ 时的各项。归一化常数 $N_{\\ell m}$ 变为：\n$$\nN_{\\ell 0} \\;=\\; \\sqrt{\\frac{2\\ell+1}{4\\pi}\\,\\frac{(\\ell - 0)!}{(\\ell + 0)!}} \\;=\\; \\sqrt{\\frac{2\\ell+1}{4\\pi}} \\;=\\; \\frac{\\sqrt{2\\ell+1}}{2\\sqrt{\\pi}}\n$$\n当 $m=0$ 时，连带勒让德函数 $P_{\\ell}^{m}(x)$ 与普通勒让德多项式 $P_{\\ell}(x)$ 相同。因此，$P_{\\ell}^{0}(\\cos\\theta) = P_{\\ell}(\\cos\\theta)$。使用给定关系 $\\cos\\theta = \\sin\\phi$，我们有 $P_{\\ell}^{0}(\\cos\\theta) = P_{\\ell}(\\sin\\phi)$。\n\n将这些简化后的项代入 $a_{\\ell 0}$ 的表达式中：\n$$\na_{\\ell 0} \\;=\\; 2\\pi \\left( \\frac{\\sqrt{2\\ell+1}}{2\\sqrt{\\pi}} \\right) \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}(\\sin\\phi)\\,\\cos\\phi\\,\\mathrm{d}\\phi\n$$\n简化常数：\n$$\na_{\\ell 0} \\;=\\; \\sqrt{\\pi(2\\ell+1)} \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}(\\sin\\phi)\\,\\cos\\phi\\,\\mathrm{d}\\phi\n$$\n为了提供一个对所有整数 $m$ 都有效的 $a_{\\ell m}$ 的单个闭式表达式，我们使用克罗内克 δ 符号合并 $m=0$ 和 $m\\neq0$ 的结果：\n$$\na_{\\ell m} \\;=\\; \\delta_{m0} \\sqrt{\\pi(2\\ell+1)} \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi)\\,P_{\\ell}(\\sin\\phi)\\,\\cos\\phi\\,\\mathrm{d}\\phi\n$$\n这个单一表达式满足所有条件。对于 $m \\neq 0$，它得出零；对于 $m=0$，它给出正确的非零值。该表达式用 $f(\\phi)$、$\\ell$、$m$（通过 $\\delta_{m0}$）、勒让德多项式 $P_{\\ell}$ 和标准常数表示。",
            "answer": "$$\n\\boxed{\\delta_{m0} \\sqrt{\\pi(2\\ell+1)} \\int_{-\\frac{\\pi}{2}}^{\\frac{\\pi}{2}} f(\\phi) P_{\\ell}(\\sin\\phi) \\cos\\phi \\,\\mathrm{d}\\phi}\n$$"
        },
        {
            "introduction": "现在，让我们将前面学到的概念结合起来，为大气和海洋模式中常见的方程组构建一个求解器。本练习涉及求解一个源于半隐式时间格式的垂直耦合亥姆霍兹方程组，这是一个极具实践意义的任务。你将实现并比较两种求解方法，其中一种方法将充分利用谱方法和模态分解的威力来完全解耦该方程组，从而展示这种方法的效率和巧妙之处。 ",
            "id": "3914998",
            "problem": "考虑一个在边长为 $2\\pi$ 的周期性方形域上的线性、静水、多层浅水系统，该系统采用半隐式时间离散化。其中，对于层厚度扰动向量场 $u(x,y)\\in\\mathbb{R}^N$（具有 $N$ 个垂直分层）的预报更新，需要求解一个水平椭圆、垂直耦合的亥姆霍兹系统，其抽象形式如下\n$$\n\\left(I - \\mu\\,\\nabla^2 \\otimes B\\right) u = f,\n$$\n其中 $I$ 是 $N\\times N$ 单位矩阵，$\\mu>0$ 是一个常数参数，源于对快重力波的半隐式处理，$\\nabla^2$ 是周期域上的水平拉普拉斯算子，$\\otimes$ 表示关于垂直和水平空间的克罗内克积，$B\\in\\mathbb{R}^{N\\times N}$ 是一个对称半正定垂直耦合矩阵，用于编码静水正压/斜压耦合，而 $f(x,y)\\in\\mathbb{R}^N$ 是一个给定的右端项。在边长为 $2\\pi$ 的周期性方形域上，水平傅里叶模态为 $e^{i(k_x x + k_y y)}$，其波数 $k_x,k_y\\in\\mathbb{Z}$ 为整数，并满足 $\\nabla^2 e^{i(k_x x + k_y y)} = -\\left(k_x^2+k_y^2\\right)e^{i(k_x x + k_y y)}$。\n\n你的任务是：\n- 从第一性原理出发，以多层浅水方程和周期域上水平拉普拉斯算子的谱表示为起点，推导为何将垂直坐标转换为正压/斜压模态可以对角化垂直耦合，并产生一个跨水平波数和垂直模态的块对角结构。\n- 实现一个求解器，该求解器针对每个离散的水平傅里叶模态，用两种不同但数学上等价的方式反演耦合的亥姆霍兹系统：\n  $1.$ 直接垂直耦合反演：对于每个水平波数，反演 $N\\times N$ 矩阵 $A(k_x,k_y) = I + \\mu\\,(k_x^2+k_y^2)\\,B$，并将其应用于 $f$ 的傅里叶系数。\n  $2.$ 模态对角反演：计算标准正交特征分解 $B = Q \\Lambda Q^\\top$，其中 $\\Lambda=\\mathrm{diag}(\\lambda_1,\\dots,\\lambda_N)$，通过 $Q^\\top$ 将 $f$ 的傅里叶系数转换到模态空间，然后对每个模态 $i$ 反演标量亥姆霍兹因子 $1+\\mu\\,(k_x^2+k_y^2)\\,\\lambda_i$，最后通过 $Q$ 变换回来。\n- 在一个离散网格上，使用离散傅里叶变换，通过报告两种解在物理空间中的最大绝对差，数值上证明两种反演方法产生的解在浮点舍入误差范围内是相同的。\n\n离散化与实现细节：\n- 在边长为 $2\\pi$ 的周期域上，使用一个在 $x$ 方向有 $N_x$ 个点、在 $y$ 方向有 $N_y$ 个点的均匀网格。使用复数到复数的离散傅里叶变换在水平方向上以谱方法表示场。\n- 通过 $k_x = 2\\pi\\,\\mathrm{fftfreq}(N_x, d=(2\\pi)/N_x)$ 和 $k_y = 2\\pi\\,\\mathrm{fftfreq}(N_y, d=(2\\pi)/N_y)$ 计算傅里叶波数（单位为弧度/单位长度），以使 $k_x,k_y\\in\\mathbb{Z}$，并构造 $k^2 = k_x^2 + k_y^2$。\n- 为了可复现性，每个测试用例使用一个固定的伪随机种子，将右端项 $f$ 构建为一个包含独立同分布的标准正态分布项的实值数组。将 $f$ 排列成形状为 $(N, N_y, N_x)$ 的数组，每层一个水平场。对每一层独立应用离散傅里叶变换。\n\n测试套件：\n对于以下每一组参数集，提供两种反演方法在物理空间中的最大绝对差。对于每个测试，在构建 $f$ 之前，将伪随机数生成器的种子设置为指定的值。\n- 测试 $1$ (带有正压零模的理想路径)：$N=2$, $N_x=8$, $N_y=8$, $\\mu=0.1$，以及\n$$\nB=\\begin{bmatrix}\n1  -1\\\\\n-1  1\n\\end{bmatrix},\n$$\n种子 $=123$。\n- 测试 $2$ (三层，带有正压零模和更强的耦合)：$N=3$, $N_x=16$, $N_y=8$, $\\mu=1.0$，以及\n$$\nB=\\begin{bmatrix}\n1  -1  0\\\\\n-1  2  -1\\\\\n0  -1  1\n\\end{bmatrix},\n$$\n种子 $=1$。\n- 测试 $3$ (三层，严格正定耦合和一维条带网格)：$N=3$, $N_x=1$, $N_y=16$, $\\mu=0.01$，以及\n$$\nB=\\begin{bmatrix}\n2  -1  0\\\\\n-1  2  -1\\\\\n0  -1  2\n\\end{bmatrix},\n$$\n种子 $=7$。\n\n程序所需输出：\n- 您的程序必须为每个测试计算上述两种反演方法得到的物理空间解之间的最大绝对差，即：\n$$\n\\max_{i\\in\\{1,\\dots,N\\},\\,y,\\,x}\\left|u^{\\mathrm{direct}}_i(x,y) - u^{\\mathrm{modal}}_i(x,y)\\right|,\n$$\n并将这三个值汇总到一个单行打印的 Python 列表字面量中。\n- 最终输出格式：单行包含由方括号括起来的三个结果，以逗号分隔，无多余空格或文本，例如：\"[r1,r2,r3]\"。\n- 在此设置中，所有量都是无量纲的，因此不需要物理单位。角度由谱表示隐式地以弧度度量，且不使用百分比。\n\n您的程序必须是一个单一、独立的脚本，该脚本能够构建测试场、执行谱反演，并以指定的确切格式打印所需的列表。",
            "solution": "所提出的问题是计算科学领域中的一个有效任务，特别是在环境与地球系统模拟领域。它要求对一个亥姆霍兹方程组的谱求解器进行推导和数值实现，这是半隐式数值天气预报和海洋模型中的一个标准组成部分。该问题具有科学依据，是适定的，并且所有参数和程序都得到了明确定义。\n\n问题的核心是求解层厚度扰动向量场 $u(x,y) \\in \\mathbb{R}^N$ 的线性椭圆偏微分方程组：\n$$\n\\left(I - \\mu\\,\\nabla^2 \\otimes B\\right) u = f\n$$\n其中 $I$ 是 $N \\times N$ 单位矩阵，$\\mu > 0$ 是一个常数，$\\nabla^2$ 是边长为 $2\\pi$ 的周期性方形域上的水平拉普拉斯算子，$B \\in \\mathbb{R}^{N\\times N}$ 是一个对称半正定垂直耦合矩阵，$f(x,y) \\in \\mathbb{R}^N$ 是一个给定的强迫场。符号 $\\nabla^2 \\otimes B$ 表示标量算子 $\\nabla^2$ 作用于场的水平分量，而矩阵 $B$ 作用于垂直（层）分量。\n\n我们将首先从第一性原理推导一个两步变换——先变换到水平傅里叶空间，然后变换到垂直模态空间——如何完全对角化该问题。随后，我们将描述两种数值上不同但数学上等价的求解方法的实现。\n\n**解耦的推导**\n\n求解策略取决于所涉及的线性算子的性质。水平算子 $\\nabla^2$ 和由矩阵 $B$ 的乘法所代表的垂直算子，都可以在它们各自的基表示中被对角化。\n\n**1. 通过傅里叶变换在水平波数空间中解耦**\n\n该问题设置在一个周期域 $[0, 2\\pi) \\times [0, 2\\pi)$ 上。在此类域上，线性、常系数微分算子的自然基函数是复指数函数，它们是拉普拉斯算子的特征函数。任何足够光滑的向量场 $u(x,y)$ 都可以用傅里叶级数表示：\n$$\nu(x,y) = \\sum_{k_x \\in \\mathbb{Z}} \\sum_{k_y \\in \\mathbb{Z}} \\hat{u}(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\n其中 $\\hat{u}(k_x, k_y) \\in \\mathbb{C}^N$ 是对应于水平波数对 $(k_x, k_y)$ 的傅里叶系数向量。拉普拉斯算子作用于此表示上为：\n$$\n\\nabla^2 u(x,y) = \\sum_{k_x, k_y} \\hat{u}(k_x, k_y) \\nabla^2 e^{i(k_x x + k_y y)} = \\sum_{k_x, k_y} -(k_x^2 + k_y^2) \\hat{u}(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\n我们在相同的基中表示右端项 $f(x,y)$：\n$$\nf(x,y) = \\sum_{k_x, k_y} \\hat{f}(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\n将这些级数表示代入控制方程，得到：\n$$\n\\sum_{k_x, k_y} \\left( I \\hat{u}(k_x, k_y) - \\mu (-(k_x^2 + k_y^2)) B \\hat{u}(k_x, k_y) \\right) e^{i(k_x x + k_y y)} = \\sum_{k_x, k_y} \\hat{f}(k_x, k_y) e^{i(k_x x + k_y y)}\n$$\n由于傅里叶基函数 $\\{e^{i(k_x x + k_y y)}\\}$ 的正交性，该等式必须对每个模态的系数独立成立。这将单个偏微分方程组转换为一大组独立的线性代数方程组，每个波数对 $(k_x, k_y)$ 对应一个。\n令 $k^2 = k_x^2 + k_y^2$。对于每个 $(k_x, k_y)$，我们有：\n$$\n\\left( I + \\mu k^2 B \\right) \\hat{u}(k_x, k_y) = \\hat{f}(k_x, k_y)\n$$\n这是一个关于傅里叶系数向量 $\\hat{u}(k_x, k_y)$ 的 $N \\times N$ 线性方程组。因此，原始的偏微分方程组已在水平波数上被块对角化。\n\n**2. 通过特征分解在垂直模态空间中解耦**\n\n现在我们专注于求解针对单个固定波数对 $(k_x, k_y)$ 的 $N \\times N$ 矩阵系统。控制该系统的矩阵是 $A(k) = I + \\mu k^2 B$。矩阵 $B$ 被指定为实对称矩阵。根据谱定理，它是可正交对角化的。存在一个正交矩阵 $Q$，其列是 $B$ 的特征向量，以及一个对角矩阵 $\\Lambda$，其对角线元素是对应的实特征值 $\\lambda_1, \\lambda_2, \\dots, \\lambda_N$，使得：\n$$\nB = Q \\Lambda Q^\\top\n$$\n$Q$ 的列代表系统的垂直“模态”（例如，正压模和斜压模）。将此分解代入我们的矩阵系统：\n$$\n(I + \\mu k^2 Q \\Lambda Q^\\top) \\hat{u}(k_x, k_y) = \\hat{f}(k_x, k_y)\n$$\n由于 $Q$ 是正交的，使用性质 $I = Q Q^\\top$：\n$$\n(Q Q^\\top + Q (\\mu k^2 \\Lambda) Q^\\top) \\hat{u}(k_x, k_y) = \\hat{f}(k_x, k_y)\n$$\n提出因子 $Q$ 和 $Q^\\top$：\n$$\nQ (I + \\mu k^2 \\Lambda) Q^\\top \\hat{u}(k_x, k_y) = \\hat{f}(k_x, k_y)\n$$\n左乘 $Q^\\top$：\n$$\n(I + \\mu k^2 \\Lambda) Q^\\top \\hat{u}(k_x, k_y) = Q^\\top \\hat{f}(k_x, k_y)\n$$\n我们在垂直模态的基中定义解向量和强迫向量：\n- $\\hat{u}^*(k_x, k_y) = Q^\\top \\hat{u}(k_x, k_y)$ (变换到模态空间)\n- $\\hat{f}^*(k_x, k_y) = Q^\\top \\hat{f}(k_x, k_y)$ (变换到模态空间)\n\n系统变为：\n$$\n(I + \\mu k^2 \\Lambda) \\hat{u}^*(k_x, k_y) = \\hat{f}^*(k_x, k_y)\n$$\n矩阵 $(I + \\mu k^2 \\Lambda)$ 是对角矩阵，其对角线元素为 $(1 + \\mu k^2 \\lambda_i)$。这意味着关于模态系数 $\\hat{u}^*$ 的 $N$ 个耦合方程组已解耦为 $N$ 个独立的标量方程：\n$$\n(1 + \\mu k^2 \\lambda_i) \\hat{u}^*_i(k_x, k_y) = \\hat{f}^*_i(k_x, k_y), \\quad \\text{for } i = 1, \\dots, N\n$$\n每个标量分量的解是平凡的：$\\hat{u}^*_i = \\hat{f}^*_i / (1 + \\mu k^2 \\lambda_i)$。一旦所有的 $\\hat{u}^*_i$ 都被找到，通过反向变换 $\\hat{u}(k_x, k_y) = Q \\hat{u}^*(k_x, k_y)$ 即可恢复原始垂直坐标下的解。这完成了推导，表明水平傅里叶变换和垂直模态变换的组合完全对角化了亥姆霍兹算子。\n\n**数值实现**\n\n上述推导直接引出了两种不同但等价的数值求解方法。连续傅里叶变换由离散傅里叶变换（DFT）近似，并通过快速傅里叶变换（FFT）高效计算。\n\n**方法 1：直接垂直耦合反演**\n此方法遵循推导的第一阶段。\n1.  对每个垂直层 $j \\in \\{1, \\dots, N\\}$，计算强迫场 $f_j(x,y)$ 的二维 DFT，以获得谱系数 $\\hat{f}_j(k_x, k_y)$。\n2.  对每个离散波数对 $(k_x, k_y)$：\n    a. 构造 $N \\times N$ 矩阵 $A(k) = I + \\mu (k_x^2+k_y^2) B$。\n    b. 使用标准线性代数库函数（例如，矩阵求逆）求解 $N \\times N$ 线性系统 $A(k) \\hat{u}(k_x, k_y) = \\hat{f}(k_x, k_y)$ 以得到 $\\hat{u}(k_x, k_y)$。\n3.  对每个垂直层 $j$，对计算出的解系数 $\\hat{u}_j(k_x, k_y)$ 执行二维逆 DFT，以获得物理空间解 $u_j(x,y)$。\n\n**方法 2：模态对角反演**\n此方法遵循完全对角化的过程。\n1.  计算垂直耦合矩阵的标准正交特征分解 $B = Q \\Lambda Q^\\top$。\n2.  计算强迫场 $f(x,y)$ 的二维 DFT 以得到 $\\hat{f}(k_x, k_y)$。\n3.  对每个波数对 $(k_x, k_y)$，将强迫系数变换到垂直模态基：$\\hat{f}^*(k_x, k_y) = Q^\\top \\hat{f}(k_x, k_y)$。\n4.  对每个垂直模态 $i \\in \\{1, \\dots, N\\}$ 和每个波数对 $(k_x, k_y)$，求解解耦的标量方程：\n    $$\n    \\hat{u}^*_i(k_x, k_y) = \\frac{\\hat{f}^*_i(k_x, k_y)}{1 + \\mu (k_x^2+k_y^2) \\lambda_i}\n    $$\n5.  对每个波数对 $(k_x, k_y)$，将解系数从模态基变换回物理垂直基：$\\hat{u}(k_x, k_y) = Q \\hat{u}^*(k_x, k_y)$。\n6.  对系数 $\\hat{u}(k_x, k_y)$ 执行二维逆 DFT，以获得物理空间解 $u(x,y)$。\n\n两种方法在算法上不同，但数学上是等价的。它们求解的是同一组线性方程。因此，如果实现正确，它们应该产生相同的解，仅因浮点舍入误差而异。本数值实验旨在确认这种等价性。",
            "answer": "```python\nimport numpy as np\n\ndef solve_helmholtz(N, Nx, Ny, mu, B, seed):\n    \"\"\"\n    Solves the multilayer Helmholtz system using two methods and returns the max difference.\n    \"\"\"\n    # Set the pseudorandom seed for reproducibility\n    np.random.seed(seed)\n    \n    # 1. Construct the right-hand side f in physical space\n    # f is real-valued with i.i.d. standard normal entries\n    f_phys = np.random.standard_normal(size=(N, Ny, Nx))\n    \n    # 2. Compute wavenumbers\n    # The problem specifies kx, ky should be integers. \n    # fftfreq(N, d=L/N) yields frequencies in cycles per unit length.\n    # Wavenumber (in rad/unit length) = 2*pi * frequency.\n    #\n    # freq_x = fftfreq(Nx, d=(2*np.pi)/Nx)\n    # kx = 2*np.pi * freq_x = 2*np.pi * [0, 1, ..., N/2-1, -N/2, ..., -1] / (2*pi)\n    # So kx = [0, 1, ..., N/2-1, -N/2, ..., -1], which are integers.\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=(2 * np.pi / Nx))\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=(2 * np.pi / Ny))\n    \n    kx_2d, ky_2d = np.meshgrid(kx_1d, ky_1d)\n    k_squared = kx_2d**2 + ky_2d**2  # Shape: (Ny, Nx)\n    \n    # 3. Transform f to spectral space\n    f_hat = np.fft.fft2(f_phys, axes=(1, 2))  # Shape: (N, Ny, Nx)\n\n    # --- Method 1: Direct Vertical-Coupled Inversion ---\n    \n    u_hat_direct = np.zeros_like(f_hat)\n    I = np.identity(N)\n    \n    # Loop over each point in horizontal spectral space\n    for iy in range(Ny):\n        for ix in range(Nx):\n            k2 = k_squared[iy, ix]\n            # Form the N x N matrix for this wavenumber\n            A = I + mu * k2 * B\n            # Invert the matrix and solve for u_hat\n            A_inv = np.linalg.inv(A)\n            u_hat_direct[:, iy, ix] = A_inv @ f_hat[:, iy, ix]\n            \n    # Transform solution back to physical space\n    u_phys_direct = np.real(np.fft.ifft2(u_hat_direct, axes=(1, 2)))\n\n    # --- Method 2: Modal-Diagonal Inversion ---\n    \n    # 2a. Eigendecomposition of B\n    lambdas, Q = np.linalg.eigh(B) # eigh for symmetric matrices\n    \n    # 2b. Transform f_hat to modal space\n    # f_hat_star = Q.T @ f_hat\n    # Use einsum for clean broadcasting over (Ny, Nx) dimensions\n    f_hat_star = np.einsum('ij,jyx->iyx', Q.T, f_hat)\n    \n    # 2c. Solve scalar Helmholtz equations in modal space\n    # Denominator shape will broadcast from (N, 1, 1) and (Ny, Nx) to (N, Ny, Nx)\n    denominator = 1.0 + mu * lambdas[:, np.newaxis, np.newaxis] * k_squared\n    \n    # Handle potential division by zero, though problem setup prevents this\n    # Since mu > 0, B is PSD (lambdas >= 0), k_squared >= 0, denominator >= 1.\n    u_hat_star = f_hat_star / denominator\n    \n    # 2d. Transform solution back to physical vertical space\n    # u_hat_modal = Q @ u_hat_star\n    u_hat_modal = np.einsum('ij,jyx->iyx', Q, u_hat_star)\n\n    # Transform solution back to physical grid space\n    u_phys_modal = np.real(np.fft.ifft2(u_hat_modal, axes=(1, 2)))\n\n    # --- 4. Compare solutions ---\n    \n    # Compute the maximum absolute difference between the two solutions\n    max_diff = np.max(np.abs(u_phys_direct - u_phys_modal))\n    \n    return max_diff\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 2, \"Nx\": 8, \"Ny\": 8, \"mu\": 0.1, \n            \"B\": np.array([[1.0, -1.0], [-1.0, 1.0]]),\n            \"seed\": 123\n        },\n        {\n            \"N\": 3, \"Nx\": 16, \"Ny\": 8, \"mu\": 1.0,\n            \"B\": np.array([[1.0, -1.0, 0.0], [-1.0, 2.0, -1.0], [0.0, -1.0, 1.0]]),\n            \"seed\": 1\n        },\n        {\n            \"N\": 3, \"Nx\": 1, \"Ny\": 16, \"mu\": 0.01,\n            \"B\": np.array([[2.0, -1.0, 0.0], [-1.0, 2.0, -1.0], [0.0, -1.0, 2.0]]),\n            \"seed\": 7\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        max_diff = solve_helmholtz(\n            N=case[\"N\"],\n            Nx=case[\"Nx\"],\n            Ny=case[\"Ny\"],\n            mu=case[\"mu\"],\n            B=case[\"B\"],\n            seed=case[\"seed\"]\n        )\n        results.append(max_diff)\n\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}