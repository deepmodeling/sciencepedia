{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的非静力大气模型之前，我们必须首先确定是否必须放弃静力平衡假设。本练习将使用尺度分析——一种对物理学家和模型开发者都极为强大的工具——在一个真实的大气现象（飑线）场景中，比较垂直加速度与主导的静力平衡力的大小。通过这个练习，你将能定量地判断非静力效应的重要性，并巩固对静力平衡在*何时*以及*为何*失效的理解。",
            "id": "3898934",
            "problem": "考虑一个深对流飑线，其最强的上升气流占据一个深度约为 $5$ km 的层。观测表明，其特征垂直速度大小为 $w \\sim 15 \\text{ m/s}$，在 $\\Delta z \\sim 5 \\text{ km}$ 的范围内，垂直压力扰动（相对于流体静力学基态）的大小为 $\\Delta p \\sim 2 \\text{ kPa}$。假设空气密度随高度近似恒定，为 $\\rho \\sim 1 \\text{ kg/m}^3$，重力加速度为 $g = 9.81 \\text{ m/s}^2$。在此尺度下，黏性效应和垂直科里奥利力可以忽略不计。\n\n从可压缩动量方程的垂直分量和基态的流体静力学平衡出发，推导物质垂直加速度的尺度估计，并用它来量化其相对于单位质量的流体静力学压力梯度的量级。具体来说，使用物质导数的量纲分析来估计特征物质垂直加速度，然后形成该加速度与单位质量的流体静力学压力梯度大小之比 $\\varepsilon$。\n\n报告使用给定数据计算出的无量纲比值 $\\varepsilon$ 的数值。答案保留三位有效数字。",
            "solution": "合适的出发点是可压缩动量方程的垂直分量，\n$$\n\\frac{D w}{D t} \\;=\\; -\\,\\frac{1}{\\rho}\\,\\frac{\\partial p}{\\partial z} \\;-\\; g \\;+\\; \\text{(黏性及其他小项)}.\n$$\n流体静力学基态 $(p_0,\\rho_0)$ 满足\n$$\n\\frac{\\partial p_0}{\\partial z} \\;=\\; -\\,\\rho_0\\,g.\n$$\n将物理量分解为基态加扰动，即 $p = p_0 + p'$ 和 $\\rho = \\rho_0 + \\rho'$，然后减去流体静力学平衡方程，得到扰动形式\n$$\n\\frac{D w}{D t} \\;=\\; -\\,\\frac{1}{\\rho}\\,\\frac{\\partial p'}{\\partial z} \\;-\\; g\\,\\frac{\\rho'}{\\rho} \\;+\\; \\text{(黏性及其他小项)}.\n$$\n为了进行尺度估计，我们考虑一个特征垂直尺度 $L_z$ 和速度尺度 $w$。通过量纲分析，物质导数的尺度可表示为\n$$\n\\left|\\frac{D w}{D t}\\right| \\;\\sim\\; \\frac{w^2}{L_z},\n$$\n因为 $|\\partial w/\\partial z| \\sim w/L_z$，并且在强对流中，平流项 $w\\,\\partial w/\\partial z$ 在此尺度上主导了局地倾向。单位质量的流体静力学压力梯度的大小就是 $g$，因为在流体静力学平衡中 $-(1/\\rho)\\,\\partial p_0/\\partial z = g$。\n\n因此，所求的无量纲比值为\n$$\n\\varepsilon \\;=\\; \\frac{\\text{特征物质垂直加速度}}{\\text{流体静力学压力梯度加速度}} \\;\\sim\\; \\frac{w^2/L_z}{g} \\;=\\; \\frac{w^2}{g\\,L_z}.\n$$\n使用给定值 $w = 15 \\text{ m/s}$ 和 $L_z = \\Delta z = 5 \\text{ km} = 5000 \\text{ m}$，以及 $g = 9.81 \\text{ m/s}^2$，我们得到\n$$\n\\varepsilon \\;=\\; \\frac{(15)^2}{9.81 \\times 5000} \\;=\\; \\frac{225}{49050} \\;=\\; \\frac{1}{218} \\;\\approx\\; 0.004587\\ldots\n$$\n保留三位有效数字，结果是\n$$\n\\varepsilon \\;\\approx\\; 0.00459.\n$$\n作为与非静力学动力学相关的一致性检验，给定层内的压力扰动 $\\Delta p \\sim 2000 \\text{ Pa}$ 在 $\\Delta z \\sim 5000 \\text{ m}$ 范围内，意味着非静力学压力梯度加速度的大小为\n$$\n\\left|\\frac{1}{\\rho}\\frac{\\Delta p}{\\Delta z}\\right| \\;\\sim\\; \\frac{2000}{1 \\times 5000} \\;=\\; 0.4 \\ \\text{m s}^{-2},\n$$\n这是 $g$ 的一个不可忽略的部分（约 $0.041$）。尽管物质垂直加速度与 $g$ 相比很小（$\\varepsilon \\approx 0.00459$），但它与非静力学压力梯度和浮力加速度处于同一量级，为了捕捉观测到的垂直运动，这些项必须保留。该尺度分析证明了进行非静力学模拟的必要性，在非静力学模拟中，垂直动量方程的求解不强加流体静力学平衡的假设。",
            "answer": "$$\\boxed{0.00459}$$"
        },
        {
            "introduction": "一旦选定了控制方程，就必须对其进行数值求解，这个过程引入了各种计算上的约束，其中最基本的就是数值稳定性。本练习将引导你应用 Courant–Friedrichs–Lewy (CFL) 条件，它将时间步长、网格间距和流速联系起来，是保证显式时间积分格式数值解不会发散的关键。掌握这一概念对于成功运行任何显式大气模型都至关重要。",
            "id": "3898925",
            "problem": "一个用于可压缩流的非静力大气模型，在一个均匀网格上，通过在水平和垂直方向上的显式平流来推进预报变量（例如，速度和位温）。考虑一个单一时间步，其中水平风速为 $U = 20\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，垂直速度为 $w = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，水平网格间距为 $\\Delta x = 1\\,\\mathrm{km}$，垂直网格间距为 $\\Delta z = 100\\,\\mathrm{m}$。平流算子通过单调迎风有限体积通量进行离散化，时间积分使用三阶强保稳 Runge–Kutta (SSP RK3) 方法。假设采用非分裂更新，其中水平和垂直平流通量同时施加。\n\n从线性平流的第一性原理和显式方法的 Courant–Friedrichs–Lewy (CFL) 稳定性要求出发，完成以下任务：\n\n- 根据时间步长 $\\Delta t$ 和给定参数，构建水平和垂直平流的无量纲 Courant 数。\n- 推导在二维情况下，对于采用单调空间通量和 SSP RK3 时间积分的非分裂显式平流更新，关于 $\\Delta t$ 的稳定性约束。\n- 使用推导出的约束，选择能同时满足水平和垂直平流稳定性的最大时间步长。\n\n以秒为单位表示最终的时间步长。最终答案必须是单一实数值。除精确算术外，不需要进行四舍五入。",
            "solution": "该问题是有效的，因为它科学地基于计算流体力学的原理，是适定的，并包含了推导唯一解所需的所有信息。\n\n该问题要求计算一个使用特定数值方案求解的二维线性平流问题的最大稳定时间步长 $\\Delta t$。在一个具有恒定速度 $U$ 和 $w$ 的二维域 $(x, z)$ 中，一个守恒标量 $q$ 的控制偏微分方程 (PDE) 是：\n$$\n\\frac{\\partial q}{\\partial t} + U \\frac{\\partial q}{\\partial x} + w \\frac{\\partial q}{\\partial z} = 0\n$$\n\n根据问题陈述的要求，求解过程包括三个步骤。\n\n首先，我们构建无量纲 Courant 数。Courant 数表示在一维情况下，信息在单个时间步内穿过的网格单元的比例。对于水平 ($x$) 和垂直 ($z$) 方向，Courant 数（分别表示为 $C_x$ 和 $C_z$）定义如下：\n$$\nC_x = \\frac{|U| \\Delta t}{\\Delta x}\n$$\n$$\nC_z = \\frac{|w| \\Delta t}{\\Delta z}\n$$\n在这里，$\\Delta t$ 是时间步长， $|U|$ 和 $|w|$ 是平流速度的大小，$\\Delta x$ 和 $\\Delta z$ 是相应方向上的网格间距。\n\n其次，我们推导稳定性约束。平流方程显式时间积分方案的数值稳定性由 Courant–Friedrichs–Lewy (CFL) 条件决定。该条件将时间步长 $\\Delta t$ 与网格间距和波传播速度联系起来。\n\n问题指定了“非分裂”更新，其中水平和垂直平流同时处理。空间离散化是“单调迎风有限体积通量”。此类方案最简单和最基本的例子是一阶迎风法。对于正速度 $U  0$ 和 $w  0$，在网格点 $(i, j)$ 处的偏微分方程的半离散形式为：\n$$\n\\frac{dq_{i,j}}{dt} = -\\frac{U}{\\Delta x}(q_{i,j} - q_{i-1,j}) - \\frac{w}{\\Delta z}(q_{i,j} - q_{i,j-1})\n$$\n如果该系统使用一阶前向欧拉法进行时间积分，则此二维、非分裂、一阶迎风方案的稳定性条件是各个 Courant 数之和：\n$$\nC_x + C_z \\le 1\n$$\n或\n$$\n\\frac{|U| \\Delta t}{\\Delta x} + \\frac{|w| \\Delta t}{\\Delta z} \\le 1\n$$\n问题指定使用三阶强保稳 Runge–Kutta (SSP RK3) 方法进行时间积分。SSP 方法的一个关键特性是，它们被设计用来在特定的时间步长约束下保持前向欧拉法的稳定性（和单调性）。对于如此处所考虑的线性双曲问题，当使用像一阶迎风这样的单调格式进行离散化时，标准的三阶 SSP RK 方法的 SSP 系数为 $1$。这意味着 SSP RK3 方案稳定的充要条件是前向欧拉方案稳定。因此，SSP RK3 和迎风空间格式组合方案的稳定性约束与前向欧拉法的 CFL 条件相同。因此，推导出的稳定性约束为：\n$$\n\\frac{|U| \\Delta t}{\\Delta x} + \\frac{|w| \\Delta t}{\\Delta z} \\le 1\n$$\n\n第三，我们使用推导出的约束来找到最大稳定时间步长 $\\Delta t_{max}$。我们可以通过提出因子 $\\Delta t$ 来重新排列稳定性不等式：\n$$\n\\Delta t \\left( \\frac{|U|}{\\Delta x} + \\frac{|w|}{\\Delta z} \\right) \\le 1\n$$\n最大稳定时间步长对应于等式成立的情况：\n$$\n\\Delta t_{max} = \\frac{1}{\\frac{|U|}{\\Delta x} + \\frac{|w|}{\\Delta z}}\n$$\n现在我们将给定的数值代入这个表达式。参数如下：\n- 水平风速: $U = 20\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 垂直速度: $w = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 水平网格间距: $\\Delta x = 1\\,\\mathrm{km} = 1000\\,\\mathrm{m}$\n- 垂直网格间距: $\\Delta z = 100\\,\\mathrm{m}$\n\n首先，我们计算分母中的各项：\n$$\n\\frac{|U|}{\\Delta x} = \\frac{20\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{1000\\,\\mathrm{m}} = 0.02\\,\\mathrm{s}^{-1}\n$$\n$$\n\\frac{|w|}{\\Delta z} = \\frac{5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}}{100\\,\\mathrm{m}} = 0.05\\,\\mathrm{s}^{-1}\n$$\n这些项的和是：\n$$\n\\frac{|U|}{\\Delta x} + \\frac{|w|}{\\Delta z} = 0.02\\,\\mathrm{s}^{-1} + 0.05\\,\\mathrm{s}^{-1} = 0.07\\,\\mathrm{s}^{-1}\n$$\n最后，我们计算最大稳定时间步长：\n$$\n\\Delta t_{max} = \\frac{1}{0.07\\,\\mathrm{s}^{-1}} = \\frac{1}{\\frac{7}{100}}\\,\\mathrm{s} = \\frac{100}{7}\\,\\mathrm{s}\n$$\n能够同时满足水平和垂直平流稳定性的最大时间步长是 $\\frac{100}{7}$ 秒。",
            "answer": "$$\\boxed{\\frac{100}{7}}$$"
        },
        {
            "introduction": "编写完模型代码后，我们如何确定它是正确的？本练习介绍科学计算的一个基石：模型验证中的收敛性测试。通过在一个具有已知精确解的理想化案例（平流暖泡）中，比较一系列不同分辨率网格的数值结果，我们可以测量计算误差并验证其是否以我们所选数值格式的理论预测速率收敛。这是建立模型结果可信度的关键一步。",
            "id": "4068897",
            "problem": "考虑一个二维干大气区域，由矩形 $\\Omega = [0,L_x]\\times[0,L_z]$ 表示，其横向和垂直边界是周期性的。在用于数值天气预报（NWP）的非静力大气模型中，上升暖泡测试用于评估模型在预设动力学条件下，对局地位温扰动的输运和演变能力的优劣。为分离并评估标量输运的离散化精度，使用一个制造测试，其中扰动由一个恒定的、无散度的速度场平流。这将输运算子与浮力引起的加速度分离开来，同时为验证目的保留了科学真实性。\n\n从给定速度下的位温输运的标量守恒定律开始：\n$$\n\\frac{\\partial \\theta}{\\partial t} + u\\frac{\\partial \\theta}{\\partial x} + w\\frac{\\partial \\theta}{\\partial z} = 0,\n$$\n其中 $\\theta$ 是位温，$u$ 是水平速度，$w$ 是垂直速度。假设初始条件是一个叠加在恒定背景上的高斯暖泡：\n$$\n\\theta(x,z,0) = \\theta_b + A\\exp\\left(-\\frac{(x-x_0)^2 + (z-z_0)^2}{2R^2}\\right),\n$$\n其中 $\\theta_b$ 是背景位温，$A$ 是暖泡振幅，$(x_0,z_0)$ 是暖泡中心，$R$ 是暖泡半径。在预设的恒定速度下，时刻 $t$ 的精确解是平移\n$$\n\\theta_{\\text{exact}}(x,z,t) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x,t)-x_0\\big)^2 + \\big(\\tilde{z}(z,t)-z_0\\big)^2}{2R^2}\\right),\n$$\n其中周期性位移为 $\\tilde{x}(x,t) = (x - ut)\\bmod L_x$ 和 $\\tilde{z}(z,t) = (z - wt)\\bmod L_z$。\n\n使用 MacCormack 预报-校正方法（对于光滑解，在空间和时间上均为二阶精度），在 $x$ 方向有 $N_x$ 个点、$z$ 方向有 $N_z$ 个点的均匀网格上离散化标量输运。令 $\\Delta x = L_x/N_x$，$\\Delta z = L_z/N_z$，并选择一个满足 Courant–Friedrichs–Lewy (CFL) 条件的时间步长 $\\Delta t$：\n$$\n\\Delta t = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right),\n$$\n并进行调整以确保精确达到最终时间。在周期性网格上，MacCormack 格式通过以下步骤将 $\\theta^n$推进到 $\\theta^{n+1}$：\n预报步：\n$$\n\\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right),\n$$\n校正步：\n$$\n\\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right],\n$$\n其中索引是周期性循环的（即，当 $i=N_x-1$ 时，$i+1$ 映射到 $0$，在 $z$ 方向上类似）。\n\n为在时刻 $T$ 进行最终比较，定义具有科学意义的误差范数，即在 $\\Omega$ 上的空间平均积分范数，使得所有范数都具有开尔文（Kelvin）单位：\n- 归一化 $L^1$ 范数：\n$$\n\\|e\\|_{L^1} = \\frac{1}{L_x L_z} \\int_\\Omega |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)| \\, dx\\, dz.\n$$\n- 归一化 $L^2$ 范数：\n$$\n\\|e\\|_{L^2} = \\sqrt{\\frac{1}{L_x L_z} \\int_\\Omega \\left(\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)\\right)^2 \\, dx\\, dz }.\n$$\n- $L^\\infty$ 范数：\n$$\n\\|e\\|_{L^\\infty} = \\max_{(x,z)\\in\\Omega} |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)|.\n$$\n使用 $\\Delta x\\Delta z$ 作为单元面积，在离散网格上通过黎曼和来近似这些积分。\n\n使用在连续的网格间距 $h_k = \\max(\\Delta x_k,\\Delta z_k)$ 下的归一化 $L^2$ 误差，计算观测到的精度阶 $p$：\n$$\np_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}.\n$$\n\n使用以下科学上一致的参数（单位采用国际单位制，SI）：\n- 区域尺寸: $L_x = 1000\\,\\mathrm{m}$，$L_z = 1000\\,\\mathrm{m}$。\n- 恒定速度: $u = 5\\,\\mathrm{m/s}$，$w = 2\\,\\mathrm{m/s}$。\n- 暖泡参数: 背景 $\\theta_b = 300\\,\\mathrm{K}$，振幅 $A = 1\\,\\mathrm{K}$，半径 $R = 100\\,\\mathrm{m}$，中心 $(x_0,z_0)=(200\\,\\mathrm{m},200\\,\\mathrm{m})$。\n- 最终时间: $T = 100\\,\\mathrm{s}$。\n- Courant–Friedrichs–Lewy (CFL) 数: $\\mathrm{CFL}=0.4$ (无量纲)。\n- 网格（测试套件）: 案例1使用 $(N_x,N_z)=(32,32)$，案例2使用 $(64,64)$，案例3使用 $(128,128)$，案例4使用 $(256,256)$。\n\n任务：\n1. 为上述标量输运问题实现带周期性边界条件的 MacCormack 格式。\n2. 对测试套件中的每个网格，计算在时刻 $T$ 的数值解与精确解之间的归一化 $L^1$、归一化 $L^2$ 和 $L^\\infty$ 误差范数。\n3. 使用归一化 $L^2$ 误差，计算连续网格分辨率 $(32\\to64)$、$(64\\to128)$ 和 $(128\\to256)$ 之间的观测精度阶 $p$。\n\n答案规格：\n- 所有误差范数以开尔文（Kelvin）为单位表示，并四舍五入到六位小数。\n- 观测精度阶 $p$ 以无量纲浮点数表示，并四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序如下：\n$$\n[\\|e\\|_{L^2}(32), \\|e\\|_{L^2}(64), \\|e\\|_{L^2}(128), \\|e\\|_{L^2}(256), p_{32\\to64}, p_{64\\to128}, p_{128\\to256}]\n$$\n其中每个 $\\|e\\|_{L^2}(N)$ 是 $N_x=N_z=N$ 网格的归一化 $L^2$ 误差。所有误差单位均为 $\\mathrm{K}$，所有 $p$ 值均为无量纲，每个值都四舍五入到六位小数。",
            "solution": "该问题被评估为科学上合理、适定、客观且自洽。它描述了标量平流方程的标准数值验证测试，这是计算流体动力学和数值天气预报中的一个基本问题。所有参数、方程和数值方法都得到了清晰且正确的定义。该问题是有效的。\n\n求解过程如下：\n首先，我们根据问题陈述建立物理和数值参数。\n区域为 $\\Omega = [0,L_x]\\times[0,L_z]$，其中 $L_x = 1000\\,\\mathrm{m}$ 且 $L_z = 1000\\,\\mathrm{m}$。\n恒定速度场为 $(u, w) = (5\\,\\mathrm{m/s}, 2\\,\\mathrm{m/s})$。\n初始位温扰动是一个高斯暖泡，定义如下：\n- 背景位温 $\\theta_b = 300\\,\\mathrm{K}$\n- 振幅 $A = 1\\,\\mathrm{K}$\n- 半径 $R = 100\\,\\mathrm{m}$\n- 初始中心 $(x_0, z_0) = (200\\,\\mathrm{m}, 200\\,\\mathrm{m})$\n\n模拟运行至最终时间 $T = 100\\,\\mathrm{s}$。数值格式使用由 Courant–Friedrichs–Lewy (CFL) 数 $\\mathrm{CFL}=0.4$ 确定的时间步长 $\\Delta t$ 进行推进。\n\n对于每个具有网格分辨率 $(N_x, N_z)$ 的测试案例，我们执行以下步骤：\n\n1.  **网格和时间步长离散化**：\n    定义一个均匀网格，在 x 方向有 $N_x$ 个点，在 z 方向有 $N_z$ 个点。网格间距为 $\\Delta x = L_x/N_x$ 和 $\\Delta z = L_z/N_z$。网格点为 $(x_i, z_j) = (i\\Delta x, j\\Delta z)$，其中 $i \\in \\{0, \\dots, N_x-1\\}$ 且 $j \\in \\{0, \\dots, N_z-1\\}$。\n    时间步长 $\\Delta t$ 必须满足 CFL 条件并确保模拟精确达到最终时间 $T$。首先，计算一个临时时间步长：\n    $$\n    \\Delta t_{\\text{CFL}} = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right)\n    $$\n    然后，计算时间步数 $N_t$，其为满足 $N_t \\Delta t_{\\text{CFL}} \\ge T$ 的最小整数：\n    $$\n    N_t = \\left\\lceil \\frac{T}{\\Delta t_{\\text{CFL}}} \\right\\rceil\n    $$\n    接着，将用于模拟的最终时间步长调整为：\n    $$\n    \\Delta t = \\frac{T}{N_t}\n    $$\n\n2.  **初始条件**：\n    将连续初始条件离散化到网格上，得到初始场 $\\theta^0_{i,j}$：\n    $$\n    \\theta^0_{i,j} = \\theta(x_i, z_j, 0) = \\theta_b + A\\exp\\left(-\\frac{(x_i-x_0)^2 + (z_j-z_0)^2}{2R^2}\\right)\n    $$\n\n3.  **使用 MacCormack 格式进行时间积分**：\n    在 $N_t$ 个步长内将解从时间 $t=0$ 推进到 $t=T$。在每个步长 $n$ 中，从 $\\theta^n$ 到 $\\theta^{n+1}$，应用两步 MacCormack 方法。鉴于使用了周期性边界条件，有限差分所需的空间位移可以通过对数据数组执行循环滚动操作来高效实现。\n\n    **预报步**：此步骤对空间导数使用向前差分。\n    $$\n    \\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right)\n    $$\n    索引按周期性处理，例如，当 $i=N_x-1$ 时，$i+1$ 变为 $0$。\n\n    **校正步**：此步骤对预报场 $\\hat{\\theta}$ 使用向后差分。\n    $$\n    \\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right]\n    $$\n    同样，索引按周期性处理。这个两步过程在最终时间 $T$ 产生数值解 $\\theta^{N_t}_{i,j}$。\n\n4.  **精确解计算**：\n    在最终时间 $T$，使用提供的考虑了周期性回绕的公式计算每个网格点 $(x_i, z_j)$ 上的精确解：\n    $$\n    \\theta_{\\text{exact}}(x_i,z_j,T) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x_i,T)-x_0\\big)^2 + \\big(\\tilde{z}(z_j,T)-z_0\\big)^2}{2R^2}\\right)\n    $$\n    其中 $\\tilde{x}(x_i,T) = (x_i - uT)\\bmod L_x$ 且 $\\tilde{z}(z_j,T) = (z_j - wT)\\bmod L_z$。\n\n5.  **误差范数计算**：\n    误差场是数值解与精确解之间的差值：$e_{i,j} = \\theta^{N_t}_{i,j} - \\theta_{\\text{exact}}(x_i,z_j,T)$。指定的范数通过离散求和来近似。\n    - 归一化 $L^1$ 范数：\n    $$\n    \\|e\\|_{L^1} \\approx \\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} |e_{i,j}|\n    $$\n    - 归一化 $L^2$ 范数：\n    $$\n    \\|e\\|_{L^2} \\approx \\sqrt{\\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} e_{i,j}^2}\n    $$\n    - $L^\\infty$ 范数：\n    $$\n    \\|e\\|_{L^\\infty} \\approx \\max_{i,j} |e_{i,j}|\n    $$\n\n6.  **观测精度阶**：\n    在计算了对应于特征网格间距 $h_k$ 和 $h_{k+1}$ 的两个连续网格分辨率的归一化 $L^2$ 误差 $\\|e\\|_{L^2}(h_k)$ 后，观测到的精度阶 $p$ 计算如下：\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k)\\right) - \\ln\\left(\\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}\n    $$\n    由于网格在每个维度上都加密了 2 倍，即 $N_{k+1}=2N_k$，这意味着 $h_{k+1}=h_k/2$。分母简化为 $\\ln(h_k/h_{k+1}) = \\ln(2)$。\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\|e\\|_{L^2}(h_k) / \\|e\\|_{L^2}(h_{k+1})\\right)}{\\ln(2)}\n    $$\n\n对测试套件中的每个网格分辨率：$(32,32)$、$(64,64)$、$(128,128)$ 和 $(256,256)$ 重复此过程。最终输出将包括四个计算出的 $\\|e\\|_{L^2}$ 范数和三个由此产生的观测精度阶 $p$。鉴于 MacCormack 格式对于光滑解是二阶精度的，计算出的 $p$ 值预计会接近 2。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    def run_simulation(N):\n        \"\"\"\n        Runs a single simulation for a given grid resolution N x N.\n\n        Args:\n            N (int): The number of grid points in each dimension (Nx and Nz).\n\n        Returns:\n            tuple: A tuple containing the L1, L2, and L-infinity error norms.\n        \"\"\"\n        # Scientific parameters (SI units)\n        Lx = 1000.0  # m\n        Lz = 1000.0  # m\n        u = 5.0      # m/s\n        w = 2.0      # m/s\n        theta_b = 300.0  # K\n        A = 1.0      # K\n        R = 100.0    # m\n        x0 = 200.0   # m\n        z0 = 200.0   # m\n        T = 100.0    # s\n        CFL = 0.4    # dimensionless\n\n        # Grid and time step discretization\n        Nx, Nz = N, N\n        dx, dz = Lx / Nx, Lz / Nz\n        \n        # Grid coordinates\n        # Using np.arange for grid points [0, L-dx]\n        x = np.arange(Nx) * dx\n        z = np.arange(Nz) * dz\n        # meshgrid with 'xy' indexing (default) creates arrays of shape (Nz, Nx)\n        # xx[j, i] = x[i], zz[j, i] = z[j]\n        xx, zz = np.meshgrid(x, z)\n\n        # Time step calculation\n        if u == 0 and w == 0:\n             # aribtrary time step if velocity is zero, though problem states non-zero\n             dt_cfl = 1.0\n        else:\n            dt_cfl_x = dx / abs(u) if abs(u)  0 else float('inf')\n            dt_cfl_z = dz / abs(w) if abs(w)  0 else float('inf')\n            dt_cfl = CFL * min(dt_cfl_x, dt_cfl_z)\n        \n        num_steps = int(np.ceil(T / dt_cfl))\n        dt = T / num_steps\n\n        # Initial condition\n        theta = theta_b + A * np.exp(-((xx - x0)**2 + (zz - z0)**2) / (2 * R**2))\n\n        # Time integration loop\n        for _ in range(num_steps):\n            theta_n = theta.copy()\n            \n            # Predictor step (forward differences)\n            # axis=1 for x-dir (columns), axis=0 for z-dir (rows)\n            dtheta_dx_fwd = (np.roll(theta_n, -1, axis=1) - theta_n) / dx\n            dtheta_dz_fwd = (np.roll(theta_n, -1, axis=0) - theta_n) / dz\n            hat_theta = theta_n - dt * (u * dtheta_dx_fwd + w * dtheta_dz_fwd)\n\n            # Corrector step (backward differences on hat_theta)\n            dhat_theta_dx_bwd = (hat_theta - np.roll(hat_theta, 1, axis=1)) / dx\n            dhat_theta_dz_bwd = (hat_theta - np.roll(hat_theta, 1, axis=0)) / dz\n            theta = 0.5 * (theta_n + hat_theta - dt * (u * dhat_theta_dx_bwd + w * dhat_theta_dz_bwd))\n\n        # Compute exact solution at time T\n        x_shifted = (xx - u * T) % Lx\n        z_shifted = (zz - w * T) % Lz\n        theta_exact = theta_b + A * np.exp(-((x_shifted - x0)**2 + (z_shifted - z0)**2) / (2 * R**2))\n\n        # Calculate error field and norms\n        error = theta - theta_exact\n        \n        # Normalized L1 norm\n        l1_norm = np.mean(np.abs(error))\n        # Normalized L2 norm\n        l2_norm = np.sqrt(np.mean(error**2))\n        # L-infinity norm\n        linf_norm = np.max(np.abs(error))\n\n        return l1_norm, l2_norm, linf_norm\n\n    # Define the test cases from the problem statement.\n    test_cases_N = [32, 64, 128, 256]\n\n    l2_errors = []\n    for N_val in test_cases_N:\n        _, l2, _ = run_simulation(N_val)\n        l2_errors.append(l2)\n\n    # Compute observed order of accuracy p\n    orders_of_accuracy = []\n    for i in range(len(l2_errors) - 1):\n        # p = log(E_k / E_{k+1}) / log(h_k / h_{k+1})\n        # h_k / h_{k+1} = (L/N_k) / (L/N_{k+1}) = N_{k+1} / N_k = 2\n        p = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders_of_accuracy.append(p)\n\n    # Assemble final result list as per problem specification\n    final_results = l2_errors + orders_of_accuracy\n\n    # Format and print the final output\n    formatted_results = [f\"{val:.6f}\" for val in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}