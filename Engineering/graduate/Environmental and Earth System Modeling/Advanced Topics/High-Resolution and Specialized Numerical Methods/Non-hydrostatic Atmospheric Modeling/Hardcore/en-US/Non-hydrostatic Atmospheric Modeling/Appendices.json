{
    "hands_on_practices": [
        {
            "introduction": "A fundamental decision in atmospheric modeling is whether to use the full non-hydrostatic equations or the simpler hydrostatic approximation, a choice that hinges on the scale of the phenomenon being studied. This practice provides a quantitative method to make this decision by using scaling analysis to evaluate the importance of vertical acceleration in a vigorous convective system. By working through this exercise, you will gain insight into the physical reasoning that determines when the hydrostatic balance breaks down and non-hydrostatic dynamics become essential .",
            "id": "3898934",
            "problem": "Consider a deep convective squall line whose strongest updrafts occupy a layer of depth approximately $5$ km. Observations indicate a characteristic vertical velocity magnitude $w \\sim 15$ m s$^{-1}$ and a vertical pressure perturbation (relative to the hydrostatic base state) of magnitude $\\Delta p \\sim 2$ kPa across $\\Delta z \\sim 5$ km. Take the air density to be approximately constant with height, $\\rho \\sim 1$ kg m$^{-3}$, and the acceleration due to gravity as $g = 9.81$ m s$^{-2}$. Viscous effects and vertical Coriolis force can be neglected at this scale.\n\nStarting from the vertical component of the compressible momentum equation and the hydrostatic balance for the base state, derive a scaling estimate for the material vertical acceleration and use it to quantify its magnitude relative to the hydrostatic pressure gradient per unit mass. Specifically, use dimensional analysis of the material derivative to estimate a characteristic material vertical acceleration, and then form the ratio $\\varepsilon$ of this acceleration to the magnitude of the hydrostatic pressure gradient per unit mass.\n\nReport the numerical value of the dimensionless ratio $\\varepsilon$ computed using the given data. Round your answer to three significant figures.",
            "solution": "The appropriate starting point is the vertical component of the compressible momentum equation,\n$$\n\\frac{D w}{D t} \\;=\\; -\\,\\frac{1}{\\rho}\\,\\frac{\\partial p}{\\partial z} \\;-\\; g \\;+\\; \\text{(viscous and other small terms)}.\n$$\nThe hydrostatic base state $(p_0,\\rho_0)$ satisfies\n$$\n\\frac{\\partial p_0}{\\partial z} \\;=\\; -\\,\\rho_0\\,g.\n$$\nDecomposing into a base state plus perturbations, $p = p_0 + p'$ and $\\rho = \\rho_0 + \\rho'$, and subtracting the hydrostatic balance gives the perturbation form\n$$\n\\frac{D w}{D t} \\;=\\; -\\,\\frac{1}{\\rho}\\,\\frac{\\partial p'}{\\partial z} \\;-\\; g\\,\\frac{\\rho'}{\\rho} \\;+\\; \\text{(viscous and other small terms)}.\n$$\nFor a scaling estimate, we consider a characteristic vertical scale $L_z$ and velocity scale $w$. The material derivative is scaled by dimensional analysis as\n$$\n\\left|\\frac{D w}{D t}\\right| \\;\\sim\\; \\frac{w^2}{L_z},\n$$\nsince $|\\partial w/\\partial z| \\sim w/L_z$ and the advective contribution $w\\,\\partial w/\\partial z$ dominates the local tendency at this scale in vigorous convection. The magnitude of the hydrostatic pressure gradient per unit mass is simply $g$, because in hydrostatic balance $-(1/\\rho)\\,\\partial p_0/\\partial z = g$.\n\nTherefore, the requested dimensionless ratio is\n$$\n\\varepsilon \\;=\\; \\frac{\\text{characteristic material vertical acceleration}}{\\text{hydrostatic pressure-gradient acceleration}} \\;\\sim\\; \\frac{w^2/L_z}{g} \\;=\\; \\frac{w^2}{g\\,L_z}.\n$$\nUsing the given values $w = 15$ m s$^{-1}$ and $L_z = \\Delta z = 5$ km $= 5000$ m, with $g = 9.81$ m s$^{-2}$, we obtain\n$$\n\\varepsilon \\;=\\; \\frac{(15)^2}{9.81 \\times 5000} \\;=\\; \\frac{225}{49050} \\;=\\; \\frac{1}{218} \\;\\approx\\; 0.004587\\ldots\n$$\nRounded to three significant figures, this is\n$$\n\\varepsilon \\;\\approx\\; 0.00459.\n$$\nAs a consistency check relevant to nonhydrostatic dynamics, the given pressure perturbation across the layer, $\\Delta p \\sim 2000$ Pa over $\\Delta z \\sim 5000$ m, implies a nonhydrostatic pressure-gradient acceleration magnitude\n$$\n\\left|\\frac{1}{\\rho}\\frac{\\Delta p}{\\Delta z}\\right| \\;\\sim\\; \\frac{2000}{1 \\times 5000} \\;=\\; 0.4 \\ \\text{m s}^{-2},\n$$\nwhich is a non-negligible fraction of $g$ (about $0.041$). Although the material vertical acceleration is small compared to $g$ (with $\\varepsilon \\approx 0.00459$), it is of the same order as the nonhydrostatic pressure-gradient and buoyancy accelerations that must be retained to capture the observed vertical motions. This scaling justifies the need for nonhydrostatic modeling, in which the vertical momentum equation is solved without imposing hydrostatic balance.",
            "answer": "$$\\boxed{0.00459}$$"
        },
        {
            "introduction": "Modeling atmospheric flow over complex terrain requires coordinate systems that follow the land surface, but this introduces a notorious numerical challenge known as the pressure gradient force (PGF) error. This exercise delves into this classic problem, demonstrating how a naive calculation in a terrain-following sigma-coordinate system can produce large, spurious accelerations even in a resting atmosphere. Understanding this issue is the first step toward implementing a 'well-balanced' scheme that correctly handles terrain and prevents the generation of artificial flows .",
            "id": "4068851",
            "problem": "Consider a two-dimensional, dry, compressible, non-hydrostatic atmosphere in a resting hydrostatic equilibrium over steep terrain. The resting state satisfies the hydrostatic balance $ \\frac{\\partial p}{\\partial z} = - \\rho g $, where $p$ is pressure, $\\rho$ is density, $z$ is geometric height, and $g$ is the gravitational acceleration. The terrain height is given by $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $, with constants $z_{0}$, amplitude $A$, and horizontal wavelength $L$. The vertical coordinate is the terrain-following sigma coordinate $ \\sigma \\in [0,1] $ with the mapping\n$$\nz(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H,\n$$\nwhere $H$ is a constant model-top height. In a naive implementation of the horizontal pressure-gradient force in a sigma-coordinate model, the horizontal pressure gradient is discretized at fixed $ \\sigma $ (rather than at fixed geometric height $z$), so that the residual horizontal acceleration in the hydrostatic resting state becomes $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $.\n\nStarting from the hydrostatic balance and the sigma-coordinate mapping above, derive a closed-form expression for $ a_{\\text{naive}} $ in terms of $ g $, $ \\sigma $, and the terrain slope $ \\frac{d z_{s}}{d x} $. Then, for the parameter values $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $, $ H = 12{,}000 \\ \\mathrm{m} $, $ z_{0} = 1{,}500 \\ \\mathrm{m} $, $ A = 1{,}000 \\ \\mathrm{m} $, $ L = 30{,}000 \\ \\mathrm{m} $, evaluate $ a_{\\text{naive}} $ at $ x = 0 $ and $ \\sigma = 0.25 $. Finally, explain, using first principles, how a well-balanced modification that enforces the evaluation of the horizontal pressure gradient at fixed geometric height $z$ (or equivalently adds the appropriate metric correction) reduces the residual acceleration for the hydrostatic resting state.\n\nRound your numerical result for $ a_{\\text{naive}} $ to four significant figures. Express the final acceleration in $ \\mathrm{m\\,s^{-2}} $. Your final answer must be a single real number.",
            "solution": "The core task is to derive an expression for the naive horizontal acceleration, defined as $ a_{\\text{naive}} = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $. The term $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ represents the partial derivative of pressure $p$ with respect to the horizontal coordinate $x$, holding the sigma coordinate $\\sigma$ constant.\n\nTo relate this to physical quantities, we must transform the derivative from the $ (x, \\sigma) $ coordinate system to the physical $ (x, z) $ coordinate system. Pressure $p$ is physically a function of $x$ and $z$, i.e., $ p(x, z) $. In the sigma-coordinate system, the vertical coordinate $z$ is itself a function of $x$ and $\\sigma$, so we have $ p(x, z(x, \\sigma)) $. Using the chain rule for multivariable functions, we can express the partial derivative of $p$ with respect to $x$ at constant $\\sigma$ as:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} + \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThe problem states that the atmosphere is in a resting hydrostatic equilibrium. In such a state, there are no horizontal variations in pressure on a constant geometric height ($z$) surface. The pressure field depends only on the vertical coordinate, $ p = p(z) $. This implies that the true horizontal pressure gradient is zero:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = 0\n$$\nThe vertical pressure gradient is given by the hydrostatic balance equation:\n$$\n\\frac{\\partial p}{\\partial z} = - \\rho g\n$$\nThe final term we need is the slope of the constant-$\\sigma$ surface, $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} $. We find this by differentiating the given coordinate transformation $ z(\\sigma, x) = (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H $ with respect to $x$ while holding $\\sigma$ constant:\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = \\frac{\\partial}{\\partial x} \\left[ (1 - \\sigma)\\, z_{s}(x) + \\sigma\\, H \\right]\n$$\nSince $\\sigma$ and $H$ are constant with respect to this differentiation, we get:\n$$\n\\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nNow we substitute these three components back into the chain rule expression:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = 0 + (-\\rho g) \\left( (1 - \\sigma) \\frac{d z_{s}}{d x} \\right) = - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nFinally, we substitute this result into the definition of $ a_{\\text{naive}} $:\n$$\na_{\\text{naive}} = - \\frac{1}{\\rho} \\left[ - \\rho g (1 - \\sigma) \\frac{d z_{s}}{d x} \\right] = g (1 - \\sigma) \\frac{d z_{s}}{d x}\n$$\nThis is the required closed-form expression for the spurious acceleration.\n\nNext, we evaluate this expression for the given parameters at $ x = 0 $ and $ \\sigma = 0.25 $. The terrain height is $ z_{s}(x) = z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) $. First, we calculate the terrain slope $ \\frac{d z_{s}}{d x} $:\n$$\n\\frac{d z_{s}}{d x} = \\frac{d}{dx} \\left[ z_{0} + A \\sin\\!\\left(\\frac{2\\pi}{L} x\\right) \\right] = A \\cos\\!\\left(\\frac{2\\pi}{L} x\\right) \\cdot \\frac{2\\pi}{L}\n$$\nEvaluating the slope at $ x = 0 $:\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi A}{L} \\cos(0) = \\frac{2\\pi A}{L}\n$$\nNow we substitute the given numerical values: $ g = 9.81 \\ \\mathrm{m\\,s^{-2}} $, $ A = 1{,}000 \\ \\mathrm{m} $, and $ L = 30{,}000 \\ \\mathrm{m} $:\n$$\n\\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = \\frac{2\\pi (1000)}{30000} = \\frac{2\\pi}{30} = \\frac{\\pi}{15}\n$$\nThis is a dimensionless quantity (slope). Now we can compute $ a_{\\text{naive}} $ at $ \\sigma = 0.25 $:\n$$\na_{\\text{naive}} = g (1 - \\sigma) \\left.\\frac{d z_{s}}{d x}\\right|_{x=0} = (9.81) \\cdot (1 - 0.25) \\cdot \\left(\\frac{\\pi}{15}\\right)\n$$\n$$\na_{\\text{naive}} = (9.81) \\cdot (0.75) \\cdot \\left(\\frac{\\pi}{15}\\right) = (9.81) \\cdot \\frac{3}{4} \\cdot \\frac{\\pi}{15} = \\frac{9.81 \\pi}{20}\n$$\nCalculating the numerical value:\n$$\na_{\\text{naive}} \\approx 1.54096119 \\dots \\ \\mathrm{m\\,s^{-2}}\n$$\nRounding to four significant figures gives $ 1.541 \\ \\mathrm{m\\,s^{-2}} $.\n\nFinally, we explain how a well-balanced modification corrects this spurious acceleration.\nThe fundamental source of the error is that the naive calculation $ - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} $ does not represent the true horizontal pressure gradient force. The true horizontal acceleration is given by $ a_x = - \\frac{1}{\\rho}\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $. In a resting hydrostatic state, $ a_x = 0 $. The naive calculation produces a non-zero result because constant-$\\sigma$ surfaces are not horizontal but follow the terrain. Moving along a constant-$\\sigma$ surface over sloped terrain involves a change in geometric height $z$, which in a hydrostatic atmosphere means a change in pressure. The naive formulation misinterprets this pressure change as a horizontal pressure gradient.\n\nA well-balanced scheme is designed to compute the true horizontal pressure gradient, $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} $, correctly. From our chain rule expansion, we can rearrange to solve for this term:\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThe well-balanced horizontal acceleration is therefore:\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{z} = - \\frac{1}{\\rho} \\left( \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - \\frac{\\partial p}{\\partial z} \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} \\right)\n$$\nSubstituting the hydrostatic relation $ \\frac{\\partial p}{\\partial z} = - \\rho g $ into the correction term yields:\n$$\na_x = - \\frac{1}{\\rho} \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} - g \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma}\n$$\nThis corrected formulation consists of two terms: the naive pressure gradient on the $\\sigma$-surface and a metric correction term that accounts for the slope of that surface. For the resting state, we derived earlier that $ \\left.\\frac{\\partial p}{\\partial x}\\right|_{\\sigma} = -\\rho g (1-\\sigma)\\frac{dz_s}{dx} $ and $ \\left.\\frac{\\partial z}{\\partial x}\\right|_{\\sigma} = (1-\\sigma)\\frac{dz_s}{dx} $. Substituting these into the well-balanced formula gives:\n$$\na_x = - \\frac{1}{\\rho} \\left( -\\rho g (1-\\sigma)\\frac{dz_s}{dx} \\right) - g \\left( (1-\\sigma)\\frac{dz_s}{dx} \\right)\n$$\n$$\na_x = g (1-\\sigma)\\frac{dz_s}{dx} - g (1-\\sigma)\\frac{dz_s}{dx} = 0\n$$\nThus, the well-balanced scheme correctly calculates zero acceleration for the resting state because the two large, opposing terms cancel perfectly. The essence of a well-balanced numerical model is to discretize these two terms in a consistent manner to preserve this cancellation property, preventing the generation of spurious flows over terrain.",
            "answer": "$$\\boxed{1.541}$$"
        },
        {
            "introduction": "After a numerical model is coded, it is crucial to verify that the implementation is correct and performs as theoretically expected. This hands-on practice guides you through a standard verification procedure using a simplified rising warm bubble test, a common benchmark in non-hydrostatic modeling. You will assess the model's performance by comparing its output against a known exact solution and computing the observed order of accuracy, a powerful method for diagnosing implementation errors and building confidence in your code .",
            "id": "4068897",
            "problem": "Consider a two-dimensional dry atmosphere domain represented by the rectangle $\\Omega = [0,L_x]\\times[0,L_z]$ with periodic lateral and vertical boundaries. In non-hydrostatic atmospheric modeling for Numerical Weather Prediction (NWP), the rising warm bubble test evaluates how well a model transports and evolves a localized potential temperature perturbation under prescribed dynamics. To isolate and assess discretization accuracy of scalar transport, use a manufactured test in which the perturbation is advected by a constant, divergence-free velocity field. This isolates the transport operator from buoyancy-induced accelerations while retaining scientific realism for verification purposes.\n\nStart from the scalar conservation law for potential temperature transport under given velocity:\n$$\n\\frac{\\partial \\theta}{\\partial t} + u\\frac{\\partial \\theta}{\\partial x} + w\\frac{\\partial \\theta}{\\partial z} = 0,\n$$\nwhere $\\theta$ is the potential temperature, $u$ is the horizontal velocity, and $w$ is the vertical velocity. Assume the initial condition is a warm Gaussian bubble superposed on a constant background:\n$$\n\\theta(x,z,0) = \\theta_b + A\\exp\\left(-\\frac{(x-x_0)^2 + (z-z_0)^2}{2R^2}\\right),\n$$\nwhere $\\theta_b$ is the background potential temperature, $A$ is the bubble amplitude, $(x_0,z_0)$ is the bubble center, and $R$ is the bubble radius. Under the prescribed constant velocities, the exact solution at time $t$ is the translation\n$$\n\\theta_{\\text{exact}}(x,z,t) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x,t)-x_0\\big)^2 + \\big(\\tilde{z}(z,t)-z_0\\big)^2}{2R^2}\\right),\n$$\nwith periodic shifts $\\tilde{x}(x,t) = (x - ut)\\bmod L_x$ and $\\tilde{z}(z,t) = (z - wt)\\bmod L_z$.\n\nDiscretize the scalar transport on a uniform grid with $N_x$ points in $x$ and $N_z$ points in $z$, using the MacCormack predictor-corrector method (second order in space and time for smooth solutions). Let $\\Delta x = L_x/N_x$, $\\Delta z = L_z/N_z$, and choose a time step $\\Delta t$ satisfying a Courant–Friedrichs–Lewy (CFL) condition:\n$$\n\\Delta t = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right),\n$$\nwith adjustments so that the final time is reached exactly. The MacCormack scheme on a periodic grid advances $\\theta^n$ to $\\theta^{n+1}$ via:\nPredictor:\n$$\n\\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right),\n$$\nCorrector:\n$$\n\\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right],\n$$\nwhere indices are wrapped periodically (i.e., $i+1$ maps to $0$ when $i=N_x-1$ and similarly in $z$).\n\nDefine scientifically meaningful error norms for a final comparison at time $T$ by spatially averaged integral norms over $\\Omega$ so that all have units of Kelvin:\n- The normalized $L^1$ norm:\n$$\n\\Vert e \\Vert_{L^1} = \\frac{1}{L_x L_z} \\int_\\Omega |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)| \\, dx\\, dz.\n$$\n- The normalized $L^2$ norm:\n$$\n\\Vert e \\Vert_{L^2} = \\sqrt{\\frac{1}{L_x L_z} \\int_\\Omega \\left(\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)\\right)^2 \\, dx\\, dz }.\n$$\n- The $L^\\infty$ norm:\n$$\n\\Vert e \\Vert_{L^\\infty} = \\max_{(x,z)\\in\\Omega} |\\theta_{\\text{num}}(x,z,T) - \\theta_{\\text{exact}}(x,z,T)|.\n$$\nApproximate these integrals by Riemann sums on the discrete grid using $\\Delta x\\Delta z$ as the cell area.\n\nCompute the observed order of accuracy $p$ using the normalized $L^2$ error at successive grid spacings $h_k = \\max(\\Delta x_k,\\Delta z_k)$:\n$$\np_{k\\to k+1} = \\frac{\\ln\\left(\\Vert e \\Vert_{L^2}(h_k)\\right) - \\ln\\left(\\Vert e \\Vert_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}.\n$$\n\nUse the following scientifically consistent parameters (units in the International System of Units; SI):\n- Domain sizes: $L_x = 1000\\,\\mathrm{m}$, $L_z = 1000\\,\\mathrm{m}$.\n- Constant velocities: $u = 5\\,\\mathrm{m/s}$, $w = 2\\,\\mathrm{m/s}$.\n- Bubble parameters: background $\\theta_b = 300\\,\\mathrm{K}$, amplitude $A = 1\\,\\mathrm{K}$, radius $R = 100\\,\\mathrm{m}$, center $(x_0,z_0)=(200\\,\\mathrm{m},200\\,\\mathrm{m})$.\n- Final time: $T = 100\\,\\mathrm{s}$.\n- Courant–Friedrichs–Lewy (CFL) number: $\\mathrm{CFL}=0.4$ (dimensionless).\n- Grids (test suite): case $1$ uses $(N_x,N_z)=(32,32)$, case $2$ uses $(64,64)$, case $3$ uses $(128,128)$, case $4$ uses $(256,256)$.\n\nTasks:\n1. Implement the MacCormack scheme with periodic boundaries for the scalar transport problem described above.\n2. For each grid in the test suite, compute the normalized $L^1$, normalized $L^2$, and $L^\\infty$ error norms between the numerical and exact solutions at time $T$.\n3. Using the normalized $L^2$ errors, compute the observed order of accuracy $p$ between successive grid resolutions $(32\\to64)$, $(64\\to128)$, and $(128\\to256)$.\n\nAnswer specifications:\n- Express all error norms in Kelvin, rounded to six decimal places.\n- Express observed orders of accuracy $p$ as dimensionless floats, rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order:\n$$\n[\\Vert e \\Vert_{L^2}(32), \\Vert e \\Vert_{L^2}(64), \\Vert e \\Vert_{L^2}(128), \\Vert e \\Vert_{L^2}(256), p_{32\\to64}, p_{64\\to128}, p_{128\\to256}]\n$$\nwhere each $\\Vert e \\Vert_{L^2}(N)$ is the normalized $L^2$ error for the grid with $N_x=N_z=N$. All errors are in $\\mathrm{K}$ and all $p$ values are dimensionless, each rounded to six decimal places.",
            "solution": "The problem is evaluated as scientifically sound, well-posed, objective, and self-contained. It describes a standard numerical verification test for a scalar advection equation, a fundamental problem in computational fluid dynamics and numerical weather prediction. All parameters, equations, and numerical methods are clearly and correctly defined. The problem is valid.\n\nThe solution proceeds as follows:\nFirst, we establish the physical and numerical parameters as specified in the problem statement.\nThe domain is $\\Omega = [0,L_x]\\times[0,L_z]$ with $L_x = 1000\\,\\mathrm{m}$ and $L_z = 1000\\,\\mathrm{m}$.\nThe constant velocity field is $(u, w) = (5\\,\\mathrm{m/s}, 2\\,\\mathrm{m/s})$.\nThe initial potential temperature perturbation is a Gaussian bubble defined by:\n- Background potential temperature $\\theta_b = 300\\,\\mathrm{K}$\n- Amplitude $A = 1\\,\\mathrm{K}$\n- Radius $R = 100\\,\\mathrm{m}$\n- Initial center $(x_0, z_0) = (200\\,\\mathrm{m}, 200\\,\\mathrm{m})$\n\nThe simulation runs until a final time $T = 100\\,\\mathrm{s}$. The numerical scheme is advanced using a time step $\\Delta t$ determined by a Courant–Friedrichs–Lewy (CFL) number of $\\mathrm{CFL}=0.4$.\n\nFor each test case with grid resolution $(N_x, N_z)$, we perform the following steps:\n\n1.  **Grid and Time Step Discretization**:\n    A uniform grid is defined with $N_x$ points in the x-direction and $N_z$ points in the z-direction. The grid spacings are $\\Delta x = L_x/N_x$ and $\\Delta z = L_z/N_z$. The grid points are $(x_i, z_j) = (i\\Delta x, j\\Delta z)$ for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_z-1\\}$.\n    The time step $\\Delta t$ must satisfy the CFL condition and ensure the simulation reaches the final time $T$ exactly. First, a provisional time step is calculated:\n    $$\n    \\Delta t_{\\text{CFL}} = \\mathrm{CFL}\\times\\min\\left(\\frac{\\Delta x}{|u|},\\frac{\\Delta z}{|w|}\\right)\n    $$\n    The number of time steps, $N_t$, is then calculated as the smallest integer such that $N_t \\Delta t_{\\text{CFL}} \\ge T$:\n    $$\n    N_t = \\left\\lceil \\frac{T}{\\Delta t_{\\text{CFL}}} \\right\\rceil\n    $$\n    The final time step used for the simulation is then adjusted to be:\n    $$\n    \\Delta t = \\frac{T}{N_t}\n    $$\n\n2.  **Initial Condition**:\n    The continuous initial condition is discretized onto the grid, yielding the initial field $\\theta^0_{i,j}$:\n    $$\n    \\theta^0_{i,j} = \\theta(x_i, z_j, 0) = \\theta_b + A\\exp\\left(-\\frac{(x_i-x_0)^2 + (z_j-z_0)^2}{2R^2}\\right)\n    $$\n\n3.  **Time Integration with MacCormack Scheme**:\n    The solution is advanced from time $t=0$ to $t=T$ over $N_t$ steps. At each step $n$, from $\\theta^n$ to $\\theta^{n+1}$, the two-step MacCormack method is applied. Given the use of periodic boundary conditions, the spatial shifts required for finite differences can be efficiently implemented using a circular roll operation on the data arrays.\n\n    **Predictor step**: This step uses forward differences for the spatial derivatives.\n    $$\n    \\hat{\\theta}_{i,j} = \\theta^n_{i,j} - \\Delta t \\left( u \\frac{\\theta^n_{i+1,j}-\\theta^n_{i,j}}{\\Delta x} + w \\frac{\\theta^n_{i,j+1}-\\theta^n_{i,j}}{\\Delta z} \\right)\n    $$\n    The indices are handled periodically, e.g., for $i=N_x-1$, $i+1$ becomes $0$.\n\n    **Corrector step**: This step uses backward differences on the predicted field $\\hat{\\theta}$.\n    $$\n    \\theta^{n+1}_{i,j} = \\frac{1}{2}\\left[\\theta^n_{i,j} + \\hat{\\theta}_{i,j} - \\Delta t \\left( u \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i-1,j}}{\\Delta x} + w \\frac{\\hat{\\theta}_{i,j}-\\hat{\\theta}_{i,j-1}}{\\Delta z} \\right)\\right]\n    $$\n    Again, indices are treated periodically. This two-step process yields the numerical solution $\\theta^{N_t}_{i,j}$ at the final time $T$.\n\n4.  **Exact Solution Calculation**:\n    At the final time $T$, the exact solution at each grid point $(x_i, z_j)$ is calculated using the provided formula, which accounts for periodic wrapping:\n    $$\n    \\theta_{\\text{exact}}(x_i,z_j,T) = \\theta_b + A\\exp\\left(-\\frac{\\big(\\tilde{x}(x_i,T)-x_0\\big)^2 + \\big(\\tilde{z}(z_j,T)-z_0\\big)^2}{2R^2}\\right)\n    $$\n    where $\\tilde{x}(x_i,T) = (x_i - uT)\\bmod L_x$ and $\\tilde{z}(z_j,T) = (z_j - wT)\\bmod L_z$.\n\n5.  **Error Norm Calculation**:\n    The error field is the difference between the numerical and exact solutions: $e_{i,j} = \\theta^{N_t}_{i,j} - \\theta_{\\text{exact}}(x_i,z_j,T)$. The specified norms are approximated by discrete sums.\n    - Normalized $L^1$ norm:\n    $$\n    \\Vert e \\Vert_{L^1} \\approx \\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} |e_{i,j}|\n    $$\n    - Normalized $L^2$ norm:\n    $$\n    \\Vert e \\Vert_{L^2} \\approx \\sqrt{\\frac{1}{N_x N_z} \\sum_{j=0}^{N_z-1}\\sum_{i=0}^{N_x-1} e_{i,j}^2}\n    $$\n    - $L^\\infty$ norm:\n    $$\n    \\Vert e \\Vert_{L^\\infty} \\approx \\max_{i,j} |e_{i,j}|\n    $$\n\n6.  **Observed Order of Accuracy**:\n    After computing the normalized $L^2$ error, $\\Vert e \\Vert_{L^2}(h_k)$, for two successive grid resolutions corresponding to characteristic grid spacings $h_k$ and $h_{k+1}$, the observed order of accuracy $p$ is calculated as:\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\Vert e \\Vert_{L^2}(h_k)\\right) - \\ln\\left(\\Vert e \\Vert_{L^2}(h_{k+1})\\right)}{\\ln(h_k) - \\ln(h_{k+1})}\n    $$\n    Since the grid is refined by a factor of $2$ in each dimension, $N_{k+1}=2N_k$, which implies $h_{k+1}=h_k/2$. The denominator simplifies to $\\ln(h_k/h_{k+1}) = \\ln(2)$.\n    $$\n    p_{k\\to k+1} = \\frac{\\ln\\left(\\Vert e \\Vert_{L^2}(h_k) / \\Vert e \\Vert_{L^2}(h_{k+1})\\right)}{\\ln(2)}\n    $$\n\nThis procedure is repeated for each grid resolution in the test suite: $(32,32)$, $(64,64)$, $(128,128)$, and $(256,256)$. The final output will consist of the four calculated $\\Vert e \\Vert_{L^2}$ norms and the three resulting observed orders of accuracy $p$. Given that the MacCormack scheme is second-order accurate for smooth solutions, the calculated values of $p$ are expected to be close to $2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    \n    def run_simulation(N):\n        \"\"\"\n        Runs a single simulation for a given grid resolution N x N.\n\n        Args:\n            N (int): The number of grid points in each dimension (Nx and Nz).\n\n        Returns:\n            tuple: A tuple containing the L1, L2, and L-infinity error norms.\n        \"\"\"\n        # Scientific parameters (SI units)\n        Lx = 1000.0  # m\n        Lz = 1000.0  # m\n        u = 5.0      # m/s\n        w = 2.0      # m/s\n        theta_b = 300.0  # K\n        A = 1.0      # K\n        R = 100.0    # m\n        x0 = 200.0   # m\n        z0 = 200.0   # m\n        T = 100.0    # s\n        CFL = 0.4    # dimensionless\n\n        # Grid and time step discretization\n        Nx, Nz = N, N\n        dx, dz = Lx / Nx, Lz / Nz\n        \n        # Grid coordinates\n        # Using np.arange for grid points [0, L-dx]\n        x = np.arange(Nx) * dx\n        z = np.arange(Nz) * dz\n        # meshgrid with 'xy' indexing (default) creates arrays of shape (Nz, Nx)\n        # xx[j, i] = x[i], zz[j, i] = z[j]\n        xx, zz = np.meshgrid(x, z)\n\n        # Time step calculation\n        if u == 0 and w == 0:\n             # aribtrary time step if velocity is zero, though problem states non-zero\n             dt_cfl = 1.0\n        else:\n            dt_cfl_x = dx / abs(u) if abs(u)  0 else float('inf')\n            dt_cfl_z = dz / abs(w) if abs(w)  0 else float('inf')\n            dt_cfl = CFL * min(dt_cfl_x, dt_cfl_z)\n        \n        num_steps = int(np.ceil(T / dt_cfl))\n        dt = T / num_steps\n\n        # Initial condition\n        theta = theta_b + A * np.exp(-((xx - x0)**2 + (zz - z0)**2) / (2 * R**2))\n\n        # Time integration loop\n        for _ in range(num_steps):\n            theta_n = theta.copy()\n            \n            # Predictor step (forward differences)\n            # axis=1 for x-dir (columns), axis=0 for z-dir (rows)\n            dtheta_dx_fwd = (np.roll(theta_n, -1, axis=1) - theta_n) / dx\n            dtheta_dz_fwd = (np.roll(theta_n, -1, axis=0) - theta_n) / dz\n            hat_theta = theta_n - dt * (u * dtheta_dx_fwd + w * dtheta_dz_fwd)\n\n            # Corrector step (backward differences on hat_theta)\n            dhat_theta_dx_bwd = (hat_theta - np.roll(hat_theta, 1, axis=1)) / dx\n            dhat_theta_dz_bwd = (hat_theta - np.roll(hat_theta, 1, axis=0)) / dz\n            theta = 0.5 * (theta_n + hat_theta - dt * (u * dhat_theta_dx_bwd + w * dhat_theta_dz_bwd))\n\n        # Compute exact solution at time T\n        x_shifted = (xx - u * T) % Lx\n        z_shifted = (zz - w * T) % Lz\n        theta_exact = theta_b + A * np.exp(-((x_shifted - x0)**2 + (z_shifted - z0)**2) / (2 * R**2))\n\n        # Calculate error field and norms\n        error = theta - theta_exact\n        \n        # Normalized L1 norm\n        l1_norm = np.mean(np.abs(error))\n        # Normalized L2 norm\n        l2_norm = np.sqrt(np.mean(error**2))\n        # L-infinity norm\n        linf_norm = np.max(np.abs(error))\n\n        return l1_norm, l2_norm, linf_norm\n\n    # Define the test cases from the problem statement.\n    test_cases_N = [32, 64, 128, 256]\n\n    l2_errors = []\n    for N_val in test_cases_N:\n        _, l2, _ = run_simulation(N_val)\n        l2_errors.append(l2)\n\n    # Compute observed order of accuracy p\n    orders_of_accuracy = []\n    for i in range(len(l2_errors) - 1):\n        # p = log(E_k / E_{k+1}) / log(h_k / h_{k+1})\n        # h_k / h_{k+1} = (L/N_k) / (L/N_{k+1}) = N_{k+1} / N_k = 2\n        p = np.log(l2_errors[i] / l2_errors[i+1]) / np.log(2)\n        orders_of_accuracy.append(p)\n\n    # Assemble final result list as per problem specification\n    final_results = l2_errors + orders_of_accuracy\n\n    # Format and print the final output\n    formatted_results = [f\"{val:.6f}\" for val in final_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}