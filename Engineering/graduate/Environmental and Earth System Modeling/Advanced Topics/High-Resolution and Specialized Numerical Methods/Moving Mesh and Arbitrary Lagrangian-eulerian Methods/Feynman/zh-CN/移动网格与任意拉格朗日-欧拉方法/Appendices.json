{
    "hands_on_practices": [
        {
            "introduction": "任意拉格朗日-欧拉（ALE）方法的核心在于其处理移动和变形网格的能力。为了确保数值方案的准确性，必须满足一个基本条件：几何守恒律（GCL）。本练习  将指导您通过一个计算测试来验证，当且仅当离散GCL成立时，ALE有限体积法才能精确地保持一个均匀的标量场，从而深刻理解GCL在防止非物理源汇产生中的关键作用。",
            "id": "3897514",
            "problem": "您的任务是为被动标量场在一维任意拉格朗日-欧拉（ALE）有限体积格式中验证几何守恒特性。考虑一个长度为 $L$（单位：米）的一维周期性区域，该区域被划分为 $N$ 个具有移动网格界面的单元。令 $q(x,t)$ 表示一个被动标量， $u$ （单位：米/秒）表示一个空间均匀的物理平流速度。网格以预设的界面速度 $w(x,t)$（单位：米/秒）移动。目标是构建一个计算测试，证明当离散几何守恒律（GCL）成立时，经过一阶迎风 ALE 有限体积更新的一个显式时间步长后，空间上恒定的 $q$ 仍严格保持不变。\n\n使用的基本原理和定义：\n- 欧拉形式下 $q$ 的守恒律：在周期性区域上 $\\partial_t q + \\partial_x \\left( u q \\right) = 0$。\n- 任意拉格朗日-欧拉（ALE）通量定义：通过移动界面的通量使用相对速度 $(u - w)$。\n- 几何守恒律（GCL）：对于移动网格，单元尺寸的演化必须与界面运动一致。\n- 有限体积原理：使用界面通量和单元度量（尺寸）来演化单元平均值。\n\n要求：\n1. 在移动网格上，针对尺寸为 $J_i$ 的单元上的单元平均值 $q_i$，推导并实现一个单步显式有限体积更新。该更新使用相对速度为 $(u - w)$ 的 ALE 通量和一阶迎风数值通量。此更新必须遵守离散 GCL。\n2. 使用周期性边界条件。\n3. 将 $q_i$ 初始化为空间常数值 $q_0$（无量纲）。证明当离散 GCL 成立且 $u$ 空间均匀时，经过一次更新后，$q_i$ 仍然等于 $q_0$。\n4. 实现一个对比案例，在该案例中故意违反离散 GCL，以表明恒定场不被保持。\n5. 使用在界面 $x_{j+1/2}$ 上定义的网格界面速度 $w(x_{j+1/2}) = A \\,\\sin\\!\\left( 2\\pi m \\, x_{j+1/2}/L \\right)$，其中 $A$（单位：米/秒）是振幅，$m$ 是控制网格速度空间振荡的整数波数。初始界面位置是均匀分布的：对于整数界面索引 $j \\in \\{0,1,\\dots,N\\}$，$x_{j+1/2} = j \\, L/N$。\n6. 执行一个大小为 $\\Delta t$（单位：秒）的前向欧拉时间步。更新必须是守恒的，并且必须在具有周期性索引的界面上使用 ALE 相对速度 $(u - w)$。一阶迎风的选择基于每个界面上 $(u - w)$ 的符号。\n7. 通过计算每个测试用例在更新后与初始常数值 $q_0$ 的最大绝对偏差来量化结果：$\\max_i \\left| q_i^{n+1} - q_0 \\right|$。然后将此偏差与容差 $\\varepsilon = 10^{-12}$（无量纲）进行比较，并生成一个布尔结果：如果偏差小于或等于 $\\varepsilon$，则返回 $\\,\\text{True}\\,$，否则返回 $\\,\\text{False}\\,$。\n\n测试套件：\n提供并评估以下五个测试用例，每个用例指定为一个元组 $(N, L, u, A, m, \\Delta t, q_0, \\text{gcl})$，其中 $\\text{gcl}$ 是一个布尔值，指示在更新中是强制执行离散 GCL（$\\text{True}$）还是故意违反它（$\\text{False}$）：\n- 案例 1（非平凡移动网格，ALE 理想情况）：$(128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, \\text{True})$。\n- 案例 2（纯网格运动，零物理平流）：$(64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, \\text{True})$。\n- 案例 3（强网格振荡，相对速度符号变化）：$(100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, \\text{True})$。\n- 案例 4（静态网格，欧拉极限）：$(80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, \\text{True})$。\n- 案例 5（故意违反 GCL）：$(128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, \\text{False})$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含以上述顺序排列的五个测试用例的结果，结果为逗号分隔的列表并用方括号括起来。每个条目都必须是通过测试最大绝对偏差是否小于或等于 $\\varepsilon = 10^{-12}$ 而获得的布尔值。例如，输出必须类似于“[True,True,True,True,False]”。输出中不需要单位，因为结果是无量纲的布尔值。",
            "solution": "用户提供的问题被评估为有效。它在科学上基于计算流体动力学的原理，特别是关于移动网格上的有限体积方法。该问题是适定的，提供了构建一个独特且有意义的数值实验所需的所有参数、方程和边界条件。目标清晰且可形式化。\n\n问题的核心在于为任意拉格朗日-欧拉（ALE）有限体积格式验证几何守恒律（GCL）。我们首先推导数值更新方程。\n\n具有物理平流速度 $u$ 的被动标量 $q(x,t)$ 的一维守恒律的欧拉形式为：\n$$\n\\partial_t q + \\partial_x (u q) = 0\n$$\n我们考虑对长度为 $L$ 的一维周期性区域进行有限体积离散化。该区域被划分为 $N$ 个单元，索引为 $i \\in \\{0, 1, \\dots, N-1\\}$。单元 $i$ 由移动区间 $[x_i(t), x_{i+1}(t)]$ 定义，其中 $x_i(t)$ 和 $x_{i+1}(t)$ 分别是单元左、右界面的位置。单元 $i$ 的大小为 $J_i(t) = x_{i+1}(t) - x_i(t)$。单元平均量 $q_i(t)$ 定义为：\n$$\nq_i(t) = \\frac{1}{J_i(t)} \\int_{x_i(t)}^{x_{i+1}(t)} q(x,t) \\, dx\n$$\n将守恒律在移动单元 $i$ 上积分并应用莱布尼茨积分法则，得到单元中标量总量 $J_i q_i$ 的精确演化方程：\n$$\n\\frac{d}{dt}(J_i q_i) = - \\left( (u-w)q \\right)_{i+1} + \\left( (u-w)q \\right)_{i}\n$$\n这里，$w(x,t) = dx/dt$ 是网格速度，因此 $w_j(t)$ 是界面 $j$ 的速度。项 $F_{ALE} = (u-w)q$ 是 ALE 通量，表示 $q$ 相对于移动单元边界的通量。\n\n我们使用时间步长为 $\\Delta t$ 的一阶显式（前向欧拉）格式对该半离散方程进行时间离散：\n$$\n\\frac{J_i^{n+1} q_i^{n+1} - J_i^n q_i^n}{\\Delta t} = - \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\n其中上标 $n$ 表示时间层 $t^n$，$\\mathcal{F}_j^n$ 是在时间 $t^n$ 时界面 $j$ 处 ALE 通量的数值近似。这可以重排以形成守恒量 $J_i q_i$ 的更新方程：\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_i^n - \\Delta t \\left( \\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n \\right)\n$$\n问题指定了一阶迎风通量。界面 $j$ 处的相对速度为 $v_{rel,j} = u - w_j$，其中 $u$ 是常数。界面 $j$ （位于左侧单元 $j-1$ 和右侧单元 $j$ 之间）的迎风通量由 $v_{rel,j}$ 的符号决定：\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_{j, \\text{upwind}}^n = \\begin{cases} v_{rel,j}^n q_{j-1}^n  &\\text{if } v_{rel,j}^n \\ge 0 \\\\ v_{rel,j}^n q_j^n  &\\text{if } v_{rel,j}^n < 0 \\end{cases}\n$$\n单元尺寸 $J_i$ 的演化也必须正确处理。单元尺寸的时间导数为 $\\frac{dJ_i}{dt} = \\frac{dx_{i+1}}{dt} - \\frac{dx_i}{dt} = w_{i+1} - w_i$。用前向欧拉法离散化此式，得到离散几何守恒律（GCL）：\n$$\n\\frac{J_i^{n+1} - J_i^n}{\\Delta t} = w_{i+1}^n - w_i^n \\quad \\implies \\quad J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)\n$$\n为了获得更新后的单元平均值 $q_i^{n+1}$，我们将更新后的守恒量除以更新后的单元尺寸：\n$$\nq_i^{n+1} = \\frac{J_i^n q_i^n - \\Delta t (\\mathcal{F}_{i+1}^n - \\mathcal{F}_i^n)}{J_i^{n+1}}\n$$\n关键在于，要使 GCL 成立，分母中的 $J_i^{n+1}$ 必须使用其自身的演化方程计算，如上所述。\n\n现在，我们测试该格式保持恒定状态的能力，即“自由流保持”特性。设初始状态为空间常数：对所有 $i$，有 $q_i^n = q_0$。对于任意界面 $j$，相邻单元中的状态是相同的，$q_{j-1}^n = q_j^n = q_0$。因此，无论相对速度 $v_{rel,j}$ 的符号如何，迎风状态始终是 $q_0$。数值通量简化为：\n$$\n\\mathcal{F}_j^n = v_{rel,j}^n q_0 = (u - w_j^n) q_0\n$$\n将此代入守恒量的更新方程中：\n$$\nJ_i^{n+1} q_i^{n+1} = J_i^n q_0 - \\Delta t \\left( (u - w_{i+1}^n)q_0 - (u - w_i^n)q_0 \\right)\n$$\n提取公因子 $q_0$ 并简化通量差：\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( u - w_{i+1}^n - u + w_i^n \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n - \\Delta t \\left( - (w_{i+1}^n - w_i^n) \\right) \\right]\n$$\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]\n$$\n方括号中的项正是根据离散 GCL 得出的新单元尺寸 $J_i^{n+1}$ 的表达式。因此，如果强制执行 GCL：\n$$\nJ_i^{n+1} q_i^{n+1} = q_0 J_i^{n+1}\n$$\n这将导致 $q_i^{n+1} = q_0$（假设 $J_i^{n+1} \\neq 0$），证明了恒定状态被完美地保持了。\n\n相反，如果违反 GCL，例如错误地假设单元尺寸是静态的（$J_i^{n+1} = J_i^n$），更新方程变为：\n$$\nq_i^{n+1} = \\frac{q_0 \\left[ J_i^n + \\Delta t (w_{i+1}^n - w_i^n) \\right]}{J_i^n} = q_0 \\left( 1 + \\frac{\\Delta t}{J_i^n} (w_{i+1}^n - w_i^n) \\right)\n$$\n由于网格速度 $w$ 不是均匀的（对于 $A \\neq 0$ 和 $m \\neq 0$），项 $w_{i+1}^n - w_i^n$ 通常不为零，导致 $q_i^{n+1} \\neq q_0$。这会产生虚假的标量源或汇，违反了守恒性。\n\n实现将为每个测试用例模拟一个时间步。\n1. 在长度为 $L$ 的周期性区域上，初始化一个包含 $N$ 个单元和 $N+1$ 个界面的均匀网格。初始单元尺寸为 $J_i^n = L/N$。\n2. 对所有单元，初始化标量场 $q_i^n = q_0$。\n3. 在 $N+1$ 个界面位置 $x_j$ 的每一个上计算网格速度 $w_j^n = A \\sin(2\\pi m x_j/L)$。\n4. 在所有界面上计算迎风 ALE 数值通量 $\\mathcal{F}_j^n$，并正确处理周期性边界。\n5. 计算新的单元尺寸 $J_i^{n+1}$。如果 `gcl` 标志为 `True`，则使用 GCL 更新 $J_i^{n+1} = J_i^n + \\Delta t (w_{i+1}^n - w_i^n)$。如果为 `False`，则设置 $J_i^{n+1} = J_i^n$。\n6. 使用主更新公式计算新的单元平均值 $q_i^{n+1}$。\n7. 计算最大绝对偏差 $\\max_i |q_i^{n+1} - q_0|$，并将其与容差 $\\varepsilon = 10^{-12}$ 进行比较。\n将提供针对指定测试用例的此比较结果。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, L, u, A, m, dt, q0, enforce_gcl):\n    \"\"\"\n    Performs one time step of an ALE finite-volume scheme and checks for GCL property.\n\n    Args:\n        N (int): Number of cells.\n        L (float): Domain length.\n        u (float): Spatially uniform physical advection velocity.\n        A (float): Amplitude of mesh interface velocity.\n        m (int): Wavenumber of mesh interface velocity.\n        dt (float): Time step size.\n        q0 (float): Initial spatially constant scalar value.\n        enforce_gcl (bool): If True, enforces the discrete GCL. If False, violates it.\n\n    Returns:\n        float: The maximum absolute deviation from the initial constant value q0.\n    \"\"\"\n    # 1. Initialize grid and scalar field\n    # N+1 faces from j=0 to N. Face j is at position x_faces[j].\n    x_faces = np.linspace(0.0, L, N + 1)\n    \n    # N cells. Cell i is between face i and face i+1.\n    # Initial cell sizes J (metric) are uniform.\n    J_old = np.full(N, L / N)\n    \n    # Initial scalar field q is constant at q0.\n    q_old = np.full(N, q0)\n\n    # 2. Calculate mesh velocities at faces\n    # w_faces[j] is the velocity of face j.\n    w_faces = A * np.sin(2 * np.pi * m * x_faces / L)\n\n    # 3. Compute ALA first-order upwind numerical fluxes\n    # Relative velocity at faces\n    v_rel_faces = u - w_faces\n    \n    # To compute fluxes at N+1 faces, we need the states from the left and right cells.\n    # We use periodic boundary conditions.\n    # For face j, the left state is q[j-1] and the right state is q[j].\n    # q_left_vals[j] = q[j-1], q_right_vals[j] = q[j] (with periodic wrap-around)\n    q_left_vals = np.concatenate(([q_old[-1]], q_old))\n    q_right_vals = np.concatenate((q_old, [q_old[0]]))\n    \n    # Compute upwind flux at each of the N+1 faces\n    # F(j) = v_rel(j) * q_upwind(j)\n    F_faces = np.where(\n        v_rel_faces >= 0,\n        v_rel_faces * q_left_vals,\n        v_rel_faces * q_right_vals\n    )\n\n    # 4. Update cell sizes (metric)\n    if enforce_gcl:\n        # GCL holds: update cell sizes based on face velocities\n        # w_diff[i] = w[i+1] - w[i]\n        w_diff = w_faces[1:] - w_faces[:-1]\n        J_new = J_old + dt * w_diff\n    else:\n        # GCL is violated: cell sizes are assumed to be static\n        J_new = J_old.copy()\n        \n    # Check for mesh tangling, though not expected for these parameters.\n    # If any J_new is non-positive, the result is invalid.\n    if np.any(J_new = 0):\n        # Return a large error to indicate failure if this unlikely event occurs.\n        return np.inf\n\n    # 5. Update the scalar field\n    # The change in the conserved quantity J*q in cell i is due to flux difference\n    # flux_diff[i] = F[i+1] - F[i]\n    flux_diff = F_faces[1:] - F_faces[:-1]\n    \n    # Update the conserved quantity J*q\n    qJ_new = J_old * q_old - dt * flux_diff\n    \n    # Get the new cell-averaged scalar value\n    q_new = qJ_new / J_new\n\n    # 6. Calculate the maximum deviation\n    max_deviation = np.max(np.abs(q_new - q0))\n    \n    return max_deviation\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N, L, u, A, m, dt, q0, gcl)\n        (128, 1.0, 0.7, 0.3, 3, 0.001, 2.0, True),\n        (64, 1.0, 0.0, 0.5, 1, 0.002, 1.0, True),\n        (100, 1.0, 0.1, 0.9, 5, 0.0005, -3.0, True),\n        (80, 1.0, 0.4, 0.0, 0, 0.005, 0.37, True),\n        (128, 1.0, 0.3, 0.4, 2, 0.001, 1.0, False),\n    ]\n\n    epsilon = 1e-12\n    results = []\n    \n    for case in test_cases:\n        N, L, u, A, m, dt, q0, gcl = case\n        deviation = run_simulation(N, L, u, A, m, dt, q0, gcl)\n        results.append(deviation = epsilon)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在保证了方案的精度之后，下一个实际问题是确保其数值稳定性。对于显式ALE格式，稳定时间步长的选择不仅受流体速度的限制，还受到网格自身运动速度的影响。本练习  旨在从第一性原理出发，推导并计算综合考虑了流体平流和网格变形的时间步长限制，这对于成功运行显式ALE模拟至关重要。",
            "id": "3897512",
            "problem": "考虑一个二维、深度平均的河口输运模型，该模型在一个非结构化平面网格上采用显式有限体积法 (FVM) 进行离散，网格节点通过任意拉格朗日-欧拉 (ALE) 网格运动进行推进。预报的守恒标量在每个移动的控制体积上满足局部守恒律。穿过一个面的平流通量取决于流体相对于该面运动的速度。设流体速度场表示为 $\\boldsymbol{u}(\\boldsymbol{x},t)$，网格速度场表示为 $\\boldsymbol{w}(\\boldsymbol{x},t)$，并设面由单位外法向量 $\\boldsymbol{n}$ 和边长来表征。\n\n给定以下科学上合理的界限和几何最小值，足以确定此 ALE FVM 的一个保守显式时间步长稳定性约束：\n- 流体速率大小的统一界限：$\\|\\boldsymbol{u}\\| \\le 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$。\n- 网格速率大小的统一界限：$\\|\\boldsymbol{w}\\| \\le 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$。\n- 整个网格中所有面的全局最小边长：$L_{\\min} = 25 \\ \\mathrm{m}$。\n\n假设显式 FVM 在空间和时间上使用二阶单调通量限制器，使其依赖区域要求由一个库朗类常数 $C_{\\mathrm{adv}} = 0.5$ 来强制执行，并且网格运动受到限制，通过用 $C_{\\mathrm{mesh}} = 0.3$ 限制每步的节点位移，来避免面交叉并满足离散几何守恒约束。\n\n从局部守恒和依赖区域论证的第一性原理出发，推导当仅有给定的界限和 $L_{\\min}$ 可用时，确保所有面上的显式 ALE 通量稳定性的时间步长 $\\Delta t$ 的保守约束，然后计算这些约束组合所蕴含的最大稳定时间步长 $\\Delta t_{\\max}$。\n\n最终答案以秒为单位表示。将您的数值答案四舍五入到三位有效数字。",
            "solution": "问题要求推导显式任意拉格朗日-欧拉 (ALE) 有限体积法 (FVM) 的最大稳定时间步长 $\\Delta t_{\\max}$。此类格式的稳定性受两个主要约束的控制：一个与平流算子的数值稳定性有关（CFL 条件），另一个与保持移动网格的几何完整性有关。我们必须从第一性原理推导每个约束的数学形式，然后将它们组合起来，以找到最严格的限制。\n\n设守恒标量为 $c$。在 ALE 框架下，对于一个时变控制体积 $V_i(t)$，守恒律的积分形式由雷诺输运定理给出：\n$$\n\\frac{d}{dt} \\int_{V_i(t)} c \\, dV = - \\oint_{\\partial V_i(t)} \\boldsymbol{F}_{\\text{adv}} \\cdot \\boldsymbol{n} \\, dA\n$$\n其中源/汇项被忽略，因为它们通常不影响显式平流的时间步长约束。平流通量矢量 $\\boldsymbol{F}_{\\text{adv}}$ 由 $\\boldsymbol{F}_{\\text{adv}} = c(\\boldsymbol{u} - \\boldsymbol{w})$ 给出，其中 $\\boldsymbol{u}$ 是流体速度，$\\boldsymbol{w}$ 是网格速度，$\\boldsymbol{n}$ 是边界 $\\partial V_i(t)$ 上的单位外法向量。项 $\\boldsymbol{u} - \\boldsymbol{w}$ 是流体相对于移动单元边界的相对速度。\n\n**1. 平流稳定性约束 (CFL 条件)**\n一个显式时间步进格式是稳定的，当且仅当一个网格单元的数值依赖区域包含其物理依赖区域。这就是库朗-弗里德里希斯-列维 (CFL) 条件。对于平流问题，这意味着在一个时间步长 $\\Delta t$ 内，流体质点行进的距离不应大于网格单元的特征尺寸。信息传播的特征速度由流体相对于网格的速度决定。\n\n垂直于单元面的平流速度由 $|(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$ 给出。为了推导出一个保守的、全局适用的时间步长限制，我们必须考虑在整个计算域和所有时间内该速度可能的最大值。\n设 $v_{\\text{char}} = |(\\boldsymbol{u} - \\boldsymbol{w}) \\cdot \\boldsymbol{n}|$。使用柯西-施瓦茨不等式以及 $\\boldsymbol{n}$ 是单位向量 ($\\|\\boldsymbol{n}\\| = 1$) 的事实：\n$$\nv_{\\text{char}} \\le \\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\|\\boldsymbol{n}\\| = \\|\\boldsymbol{u} - \\boldsymbol{w}\\|\n$$\n接下来，对 $\\|\\boldsymbol{u} - \\boldsymbol{w}\\|$ 应用三角不等式：\n$$\n\\|\\boldsymbol{u} - \\boldsymbol{w}\\| \\le \\|\\boldsymbol{u}\\| + \\|-\\boldsymbol{w}\\| = \\|\\boldsymbol{u}\\| + \\|\\boldsymbol{w}\\|\n$$\n因此，最大特征速度 $v_{\\text{char, max}}$ 受最大流体速率 $U_{\\max} = \\sup \\|\\boldsymbol{u}\\|$ 和最大网格速率 $W_{\\max} = \\sup \\|\\boldsymbol{w}\\|$ 之和的限制。这种最坏情况发生在流体速度和网格速度都达到最大值且方向相反时。\n$$\nv_{\\text{char, max}} \\le U_{\\max} + W_{\\max}\n$$\nCFL 条件指出，在一个时间步长内，波或质点行进的距离 $v_{\\text{char, max}} \\Delta t$ 必须小于或等于特征网格尺寸 $L_{\\text{char}}$ 的一个分数。这个分数就是库朗数 $C_{\\text{adv}}$。\n$$\n(U_{\\max} + W_{\\max}) \\Delta t \\le C_{\\text{adv}} L_{\\text{char}}\n$$\n对于非结构化网格上的保守全局时间步长，特征长度 $L_{\\text{char}}$ 取为最小的长度尺度，即给定的全局最小边长 $L_{\\min}$。这得出了对 $\\Delta t$ 的第一个约束：\n$$\n\\Delta t \\le \\Delta t_{\\text{adv}} = \\frac{C_{\\text{adv}} L_{\\min}}{U_{\\max} + W_{\\max}}\n$$\n代入给定值：$C_{\\text{adv}} = 0.5$，$L_{\\min} = 25 \\ \\mathrm{m}$，$U_{\\max} = 1.5 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$，以及 $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$：\n$$\n\\Delta t_{\\text{adv}} = \\frac{0.5 \\times 25}{1.5 + 0.4} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.5789 \\ \\mathrm{s}\n$$\n\n**2. 网格几何完整性约束**\n在 ALE 模拟中，网格顶点会移动。如果在一个时间步长内移动得太远，单元可能会发生翻转（体积变为负值）或严重扭曲，导致模拟失败。为防止这种情况，任何节点在一个时间步长内的位移必须限制为最小相邻单元尺寸的一个分数。\n在一个时间步长 $\\Delta t$ 内，节点的最大位移受 $W_{\\max} \\Delta t$ 限制。问题指明，该位移受一个常数 $C_{\\text{mesh}}$ 相对于一个特征长度的限制。为了在全局上保持网格质量，这个长度必须再次选择最严格的那个，即 $L_{\\min}$。\n因此，约束条件是：\n$$\nW_{\\max} \\Delta t \\le C_{\\text{mesh}} L_{\\min}\n$$\n这给出了对 $\\Delta t$ 的第二个约束：\n$$\n\\Delta t \\le \\Delta t_{\\text{mesh}} = \\frac{C_{\\text{mesh}} L_{\\min}}{W_{\\max}}\n$$\n代入给定值：$C_{\\text{mesh}} = 0.3$，$L_{\\min} = 25 \\ \\mathrm{m}$，以及 $W_{\\max} = 0.4 \\ \\mathrm{m} \\ \\mathrm{s}^{-1}$：\n$$\n\\Delta t_{\\text{mesh}} = \\frac{0.3 \\times 25}{0.4} = \\frac{7.5}{0.4} = 18.75 \\ \\mathrm{s}\n$$\n\n**3. 最大稳定时间步长**\n模拟的总体时间步长 $\\Delta t$ 必须同时满足平流稳定性和网格几何约束才有效。因此，最大稳定时间步长 $\\Delta t_{\\max}$ 是推导出的两个上界中的最小值：\n$$\n\\Delta t_{\\max} = \\min(\\Delta t_{\\text{adv}}, \\Delta t_{\\text{mesh}})\n$$\n$$\n\\Delta t_{\\max} = \\min \\left( \\frac{12.5}{1.9}, 18.75 \\right) \\ \\mathrm{s}\n$$\n数值上，$\\Delta t_{\\text{adv}} \\approx 6.5789 \\ \\mathrm{s}$ 且 $\\Delta t_{\\text{mesh}} = 18.75 \\ \\mathrm{s}$。更严格的约束是平流 CFL 条件。\n$$\n\\Delta t_{\\max} = \\frac{12.5}{1.9} \\ \\mathrm{s} \\approx 6.578947... \\ \\mathrm{s}\n$$\n问题要求将数值答案四舍五入到三位有效数字。\n$$\n\\Delta t_{\\max} \\approx 6.58 \\ \\mathrm{s}\n$$",
            "answer": "$$\\boxed{6.58}$$"
        },
        {
            "introduction": "ALE方法的灵活性带来了巨大优势，但也引入了网格可能会严重扭曲甚至“缠结”的风险，从而导致计算失败。因此，实时监控网格质量是ALE模拟中的一项核心任务，也是实现自适应网格重划分（r-adaptivity）的第一步。本练习  通过一个具体的例子，让您亲手计算一个变形单元的质量度量，从而直观地理解如何量化网格变形，并为更高级的网格控制策略打下基础。",
            "id": "3897538",
            "problem": "一个沿海河口航道在坐标为 $(x,y) \\in [0,2] \\times [0,1]$ 的矩形域上进行建模。使用任意拉格朗日-欧拉 (ALE) 网格，通过由潮汐驱动的剪切引起的规定水平变形来演化计算网格。初始时刻的网格包含两个四节点双线性四边形单元，其节点顺序 $(1,2,3,4)$ 分别对应左下、右下、右上和左上。初始（未变形）的节点坐标为：\n- 单元 $E_1$：$(x_1,y_1)=(0,0)$，$(x_2,y_2)=(1,0)$，$(x_3,y_3)=(1,1)$，$(x_4,y_4)=(0,1)$。\n- 单元 $E_2$：$(x_1,y_1)=(1,0)$，$(x_2,y_2)=(2,0)$，$(x_3,y_3)=(2,1)$，$(x_4,y_4)=(1,1)$。\n\nALE 网格遵循规定的变形场移动\n$$\nx'(t) \\;=\\; x \\;+\\; \\gamma\\, t\\, y \\,\\bigl(1 + \\alpha\\, x\\bigr), \n\\qquad\ny'(t) \\;=\\; y,\n$$\n其中 $\\gamma\\, t = g = 1.2$ 且 $\\alpha = 0.5$。此时，每个单元的物理节点坐标是通过将 $(x',y')$ 应用于初始节点坐标得到的。\n\n对每个四边形使用标准的双线性参考到物理映射，在单元中心 $(\\xi,\\eta)=(0,0)$ 处计算雅可比矩阵 $J$，并计算各向同性质量度量\n$$\nq \\;=\\; \\frac{2\\,\\det(J)}{\\mathrm{tr}\\!\\bigl(J^{\\top} J\\bigr)}.\n$$\n如果一个单元计算出的 $q$ 值严格小于阈值 $\\tau = 0.4$，则该单元将被标记以进行 r-自适应重定位。\n\n从 ALE 映射和双线性等参单元的基本定义出发，推导在每个单元中心计算 $q$ 所需的表达式，并确定需要 r-自适应重定位的单元数量。将最终答案表示为一个无单位的整数。无需进行四舍五入。",
            "solution": "我们从任意拉格朗日-欧拉 (ALE) 映射和标准双线性等参四边形单元开始。对于每个具有节点 $i=1,2,3,4$ 和物理节点坐标 $(x_i,y_i)$ 的四边形，从参考正方形 $(\\xi,\\eta)\\in[-1,1]^2$ 到物理单元的双线性映射为\n$$\nx(\\xi,\\eta) \\;=\\; \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\, x_i,\n\\qquad\ny(\\xi,\\eta) \\;=\\; \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\, y_i,\n$$\n其中四个双线性形函数为\n$$\nN_1(\\xi,\\eta) \\;=\\; \\frac{(1-\\xi)(1-\\eta)}{4},\\quad\nN_2(\\xi,\\eta) \\;=\\; \\frac{(1+\\xi)(1-\\eta)}{4},\\quad\nN_3(\\xi,\\eta) \\;=\\; \\frac{(1+\\xi)(1+\\eta)}{4},\\quad\nN_4(\\xi,\\eta) \\;=\\; \\frac{(1-\\xi)(1+\\eta)}{4}.\n$$\n雅可比矩阵 $J$ 在 $(\\xi,\\eta)$ 处为\n$$\nJ(\\xi,\\eta) \\;=\\; \n\\begin{pmatrix}\nx_{\\xi}  x_{\\eta} \\\\\ny_{\\xi}  y_{\\eta}\n\\end{pmatrix},\n\\qquad\nx_{\\xi} \\;=\\; \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi} x_i,\\quad\nx_{\\eta} \\;=\\; \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta} x_i,\n$$\n$y_{\\xi}$ 和 $y_{\\eta}$ 的表达式与此类似。在单元中心 $(\\xi,\\eta)=(0,0)$ 处，形函数的导数为\n$$\n\\frac{\\partial N_1}{\\partial \\xi} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_2}{\\partial \\xi} = \\frac{1}{4},\\quad\n\\frac{\\partial N_3}{\\partial \\xi} = \\frac{1}{4},\\quad\n\\frac{\\partial N_4}{\\partial \\xi} = -\\frac{1}{4},\n$$\n$$\n\\frac{\\partial N_1}{\\partial \\eta} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_2}{\\partial \\eta} = -\\frac{1}{4},\\quad\n\\frac{\\partial N_3}{\\partial \\eta} = \\frac{1}{4},\\quad\n\\frac{\\partial N_4}{\\partial \\eta} = \\frac{1}{4}.\n$$\n因此，在中心处，\n$$\nx_{\\xi} \\;=\\; \\frac{-x_1 + x_2 + x_3 - x_4}{4},\\quad\nx_{\\eta} \\;=\\; \\frac{-x_1 - x_2 + x_3 + x_4}{4},\n$$\n$$\ny_{\\xi} \\;=\\; \\frac{-y_1 + y_2 + y_3 - y_4}{4},\\quad\ny_{\\eta} \\;=\\; \\frac{-y_1 - y_2 + y_3 + y_4}{4}.\n$$\n\nALE 变形场为\n$$\nx' \\;=\\; x + g\\, y \\,\\bigl(1 + \\alpha\\, x\\bigr),\\qquad y' \\;=\\; y,\n$$\n其中 $g=1.2$ 且 $\\alpha=0.5$。我们将此应用于初始节点坐标。\n\n对于单元 $E_1$，初始节点为\n$$\n(x_1,y_1)=(0,0),\\quad (x_2,y_2)=(1,0),\\quad (x_3,y_3)=(1,1),\\quad (x_4,y_4)=(0,1).\n$$\n变形后，\n\\begin{align*}\nx_1' = 0 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 0) \\;=\\; 0,  \\quad y_1' = 0,\\\\\nx_2' = 1 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1,  \\quad y_2' = 0,\\\\\nx_3' = 1 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1 + g(1+\\alpha),  \\quad y_3' = 1,\\\\\nx_4' = 0 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 0) \\;=\\; g,  \\quad y_4' = 1.\n\\end{align*}\n以符号形式表示，设 $a=\\alpha$，\n$$\nx_1'=0,\\quad x_2'=1,\\quad x_3' = 1 + g(1+a),\\quad x_4' = g,\n\\qquad\ny_1'=0,\\; y_2'=0,\\; y_3'=1,\\; y_4'=1.\n$$\n计算中心处的导数：\n\\begin{align*}\nx_{\\xi}^{(E_1)} = \\frac{-x_1' + x_2' + x_3' - x_4'}{4}\n= \\frac{-0 + 1 + \\bigl(1 + g(1+a)\\bigr) - g}{4}\n= \\frac{2 + g a}{4},\\\\[4pt]\nx_{\\eta}^{(E_1)} = \\frac{-x_1' - x_2' + x_3' + x_4'}{4}\n= \\frac{-0 - 1 + \\bigl(1 + g(1+a)\\bigr) + g}{4}\n= \\frac{g(2+a)}{4},\\\\[4pt]\ny_{\\xi}^{(E_1)} = \\frac{-y_1' + y_2' + y_3' - y_4'}{4} = \\frac{-0 + 0 + 1 - 1}{4} = 0,\\\\[4pt]\ny_{\\eta}^{(E_1)} = \\frac{-y_1' - y_2' + y_3' + y_4'}{4} = \\frac{-0 - 0 + 1 + 1}{4} = \\frac{1}{2}.\n\\end{align*}\n因此，\n$$\nJ_{E_1} \\;=\\; \n\\begin{pmatrix}\n\\dfrac{2 + g a}{4}  \\dfrac{g(2+a)}{4} \\\\\n0  \\dfrac{1}{2}\n\\end{pmatrix}.\n$$\n\n对于单元 $E_2$，初始节点为\n$$\n(x_1,y_1)=(1,0),\\quad (x_2,y_2)=(2,0),\\quad (x_3,y_3)=(2,1),\\quad (x_4,y_4)=(1,1).\n$$\n变形后，\n\\begin{align*}\nx_1' = 1 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1,  \\quad y_1' = 0,\\\\\nx_2' = 2 + g\\cdot 0 \\cdot (1 + \\alpha \\cdot 2) \\;=\\; 2,  \\quad y_2' = 0,\\\\\nx_3' = 2 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 2) \\;=\\; 2 + g(1+2a),  \\quad y_3' = 1,\\\\\nx_4' = 1 + g\\cdot 1 \\cdot (1 + \\alpha \\cdot 1) \\;=\\; 1 + g(1+a),  \\quad y_4' = 1.\n\\end{align*}\n计算中心处的导数：\n\\begin{align*}\nx_{\\xi}^{(E_2)} = \\frac{-x_1' + x_2' + x_3' - x_4'}{4}\n= \\frac{-1 + 2 + \\bigl(2 + g(1+2a)\\bigr) - \\bigl(1 + g(1+a)\\bigr)}{4}\n= \\frac{2 + g a}{4},\\\\[4pt]\nx_{\\eta}^{(E_2)} = \\frac{-x_1' - x_2' + x_3' + x_4'}{4}\n= \\frac{-1 - 2 + \\bigl(2 + g(1+2a)\\bigr) + \\bigl(1 + g(1+a)\\bigr)}{4}\n= \\frac{g(2+3a)-1}{4},\\\\[4pt]\ny_{\\xi}^{(E_2)} = \\frac{-y_1' + y_2' + y_3' - y_4'}{4} = \\frac{-0 + 0 + 1 - 1}{4} = 0,\\\\[4pt]\ny_{\\eta}^{(E_2)} = \\frac{-y_1' - y_2' + y_3' + y_4'}{4} = \\frac{-0 - 0 + 1 + 1}{4} = \\frac{1}{2}.\n\\end{align*}\n因此，\n$$\nJ_{E_2} \\;=\\;\n\\begin{pmatrix}\n\\dfrac{2 + g a}{4}  \\dfrac{g(2+3a)-1}{4} \\\\\n0  \\dfrac{1}{2}\n\\end{pmatrix}.\n$$\n\n我们现在计算各向同性质量度量\n$$\nq \\;=\\; \\frac{2\\,\\det(J)}{\\mathrm{tr}\\!\\bigl(J^{\\top} J\\bigr)}.\n$$\n对于形如下式的通用矩阵\n$$\nJ \\;=\\;\n\\begin{pmatrix}\nA  B \\\\\n0  D\n\\end{pmatrix},\n$$\n我们有 $\\det(J) = A D$，以及 $\\mathrm{tr}(J^{\\top} J) = A^2 + B^2 + 0^2 + D^2 = A^2 + B^2 + D^2$。\n\n将此应用于 $E_1$，其中 $A = \\dfrac{2 + g a}{4}$，$B = \\dfrac{g(2+a)}{4}$，且 $D = \\dfrac{1}{2}$，\n\\begin{align*}\n\\det(J_{E_1}) = \\frac{2 + g a}{4}\\cdot \\frac{1}{2} \\;=\\; \\frac{2 + g a}{8},\\\\\n\\mathrm{tr}\\!\\bigl(J_{E_1}^{\\top} J_{E_1}\\bigr) = \\left(\\frac{2 + g a}{4}\\right)^{2} + \\left(\\frac{g(2+a)}{4}\\right)^{2} + \\left(\\frac{1}{2}\\right)^{2} \\\\\n= \\frac{(2 + g a)^{2}}{16} + \\frac{g^{2}(2+a)^{2}}{16} + \\frac{1}{4}.\n\\end{align*}\n因此，\n\\begin{align*}\nq_{E_1} = \\frac{2\\,\\det(J_{E_1})}{\\mathrm{tr}\\!\\bigl(J_{E_1}^{\\top} J_{E_1}\\bigr)}\n= \\frac{2 \\cdot \\dfrac{2 + g a}{8}}{\\dfrac{(2 + g a)^{2}}{16} + \\dfrac{g^{2}(2+a)^{2}}{16} + \\dfrac{1}{4}} \\\\\n= \\frac{\\dfrac{2 + g a}{4}}{\\dfrac{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}{16}}\n= \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}.\n\\end{align*}\n\n类似地，对于 $E_2$，其中 $A = \\dfrac{2 + g a}{4}$，$B = \\dfrac{g(2+3a)-1}{4}$，且 $D = \\dfrac{1}{2}$，\n\\begin{align*}\nq_{E_2}\n= \\frac{4(2 + g a)}{(2 + g a)^{2} + (g(2+3a)-1)^{2} + 4}.\n\\end{align*}\n\n我们现在代入给定参数 $g = 1.2$ 和 $a = \\alpha = 0.5$：\n\\begin{align*}\n2 + g a = 2 + (1.2)(0.5) \\;=\\; 2 + 0.6 \\;=\\; 2.6,\\\\\n(2 + g a)^{2} = (2.6)^{2} \\;=\\; 6.76,\\\\\ng^{2} = (1.2)^{2} \\;=\\; 1.44,\\\\\n2 + a = 2 + 0.5 \\;=\\; 2.5,\\qquad (2 + a)^{2} \\;=\\; (2.5)^{2} \\;=\\; 6.25,\\\\\ng^{2}(2+a)^{2} = 1.44 \\cdot 6.25 \\;=\\; 9.00,\\\\\ng(2+3a)-1 = 1.2(2+1.5)-1 = 1.2(3.5)-1 = 4.2-1=3.2, \\quad (g(2+3a)-1)^2 = 3.2^2 = 10.24.\n\\end{align*}\n计算 $q_{E_1}$：\n\\begin{align*}\nq_{E_1} = \\frac{4(2 + g a)}{(2 + g a)^{2} + g^{2}(2+a)^{2} + 4}\n= \\frac{4 \\cdot 2.6}{6.76 + 9.00 + 4} \n= \\frac{10.4}{19.76}\n\\approx 0.526.\n\\end{align*}\n计算 $q_{E_2}$：\n\\begin{align*}\nq_{E_2} = \\frac{4(2 + g a)}{(2 + g a)^{2} + (g(2+3a)-1)^{2} + 4}\n= \\frac{10.4}{6.76 + 10.24 + 4}\n= \\frac{10.4}{21.0}\n\\approx 0.495.\n\\end{align*}\n\n**更正：** 在原始推导中，单元E2的 $x_\\eta$ 计算存在错误。\n对于 $E_2$，$x_1'=1, x_2'=2, x_3'=2+g(1+2a), x_4'=1+g(1+a)$。\n$x_{\\eta}^{(E_2)} = \\frac{-x_1' - x_2' + x_3' + x_4'}{4} = \\frac{-1-2 + (2+g(1+2a)) + (1+g(1+a))}{4} = \\frac{g(2+3a)}{4}$。\n我的手工校对出错了。原始解答中的公式是正确的。\n$g(2+3a) = 1.2(2+1.5) = 1.2(3.5) = 4.2$。\n$g^2(2+3a)^2 = 1.44 \\cdot (3.5)^2 = 1.44 \\cdot 12.25 = 17.64$.\n让我们使用原始解答的正确数值重新计算。\n\n计算 $q_{E_1}$：\n\\begin{align*}\nq_{E_1} = \\frac{4(2.6)}{6.76 + 9.00 + 4} \n= \\frac{10.4}{19.76}\n\\approx 0.5263.\n\\end{align*}\n计算 $q_{E_2}$：\n\\begin{align*}\nq_{E_2} = \\frac{4(2.6)}{6.76 + 17.64 + 4}\n= \\frac{10.4}{28.4}\n\\approx 0.3662.\n\\end{align*}\n\n阈值为 $\\tau = 0.4$。我们进行比较：\n- 对于 $E_1$，$q_{E_1} \\approx 0.526 > 0.4$；$E_1$ 未被标记。\n- 对于 $E_2$，$q_{E_2} \\approx 0.3662  0.4$；$E_2$ 被标记。\n\n因此，恰好有一个单元需要 r-自适应重定位。所要求的最终答案是被标记的单元数量，即 $1$。",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}