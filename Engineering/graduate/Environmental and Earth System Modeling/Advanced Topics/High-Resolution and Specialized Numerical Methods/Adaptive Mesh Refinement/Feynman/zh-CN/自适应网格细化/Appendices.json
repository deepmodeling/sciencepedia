{
    "hands_on_practices": [
        {
            "introduction": "一个稳定的数值模拟要求在时间步长和网格间距之间取得精妙的平衡，这一原则被CFL条件所概括。在自适应网格加密（AMR）中，不同区域具有不同的网格分辨率，这引出了一种优雅的策略——“时间子循环”。本练习将引导您从第一性原理出发，推导各层级的时间步长，这是实现和分析任何显式AMR格式的一项基本技能。",
            "id": "3730525",
            "problem": "考虑一个一维线性双曲守恒律方程组 $u_{t} + A u_{x} = 0$，其中 $A \\in \\mathbb{R}^{m \\times m}$ 是一个可对角化且具有实特征值的矩阵，并设特征速度的最大绝对值为 $|\\lambda_{\\max}| = \\max_{k} |\\lambda_{k}|$。一个带单调数值通量的一阶显式有限体积离散化方法，在间距为 $h$ 的均匀网格上，通过每个时间步最多传播一个单元的信息来更新单元平均值。为了保证此类显式格式的稳定性，需要确保离散依赖域包含连续依赖域。现在考虑一个具有层级 $\\ell = 0, 1, \\dots, L-1$ 的自适应网格加密（AMR）层级结构，其中层级 $\\ell$ 的均匀单元间距为 $h_{\\ell}$，且对于固定的整数加密比 $r \\ge 2$，有 $h_{\\ell+1} = h_{\\ell}/r$。假设使用时间子循环，使得层级 $\\ell$ 以其自身的时间步长 $\\Delta t_{\\ell}$ 推进，同时在所有层级上保持一个共同的无量纲 Courant 数。\n\n任务：\n1. 从系统的双曲特性以及在间距为 $h$ 的网格上，以速度 $|\\lambda_{\\max}|$ 传播的波在每个时间步内不超过一个单元的要求出发，推导显式离散化的稳定性限制条件，该条件用无量纲因子 $\\mathrm{C} \\in (0,1)$、网格间距 $h$ 和特征速度界 $|\\lambda_{\\max}|$ 来表示。清楚地陈述对 $\\Delta t$ 的限制形式，不引用任何预先给定的公式。\n2. 使用 AMR 层级定义和时间子循环假设，推导各层级时间步长 $\\Delta t_{\\ell}$ 与基础粗层级时间步长 $\\Delta t_{0}$ 和加密比 $r$ 之间的关系。\n3. 对于一个特定的三层层级结构，$L=3$，粗层级间距 $h_{0} = 0.04\\,\\mathrm{m}$，加密比 $r = 2$，最大特征速度 $|\\lambda_{\\max}| = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，以及共同的无量纲 Courant 因子 $\\mathrm{C} = 0.8$，计算层级 $\\ell=2$ 的时间步长 $\\Delta t_{2}$（单位为秒）。将答案四舍五入到四位有效数字，并以秒为单位表示时间。\n\n定义：Courant–Friedrichs–Lewy (CFL) 条件指的是在显式格式中关联 $\\Delta t$、$h$ 和特征速度的稳定性约束。自适应网格加密 (AMR) 指的是通过整数比例进行空间加密的层级网格。",
            "solution": "该问题提出了一个关于在自适应网格加密（AMR）框架内双曲偏微分方程数值格式稳定性的多部分任务。解答按要求分为三个相继的推导和计算部分。\n\n### 第 1 部分：稳定性限制条件的推导\n\n问题涉及一个一维线性双曲守恒律方程组 $u_{t} + A u_{x} = 0$，其中矩阵 $A$ 的特征值 $\\lambda_k$ 代表信息在域中传播的特征速度。最大传播速度记为 $|\\lambda_{\\max}| = \\max_{k} |\\lambda_{k}|$。\n\n为使显式数值格式稳定，必须满足 Courant–Friedrichs–Lewy (CFL) 条件。该条件是收敛的必要条件，并确保离散化时空网格中一个点的数值依赖域包含该同一点的物理（或连续）依赖域。\n\n题目陈述为该条件提供了一个直接的物理解释：“以速度 $|\\lambda_{\\max}|$ 传播的波在间距为 $h$ 的网格上每个时间步内不超过一个单元”。让我们将其形式化。在时间间隔 $\\Delta t$ 内，物理波可以传播的最大距离为 $|\\lambda_{\\max}| \\Delta t$。对于一个在均匀单元间距为 $h$ 的网格上的一阶显式格式，在时间 $t_{n+1} = t_n + \\Delta t$ 时，以 $x_i$ 为中心的单元上的数值解依赖于时间 $t_n$ 时单元 $i-1$、$i$ 和 $i+1$ 的信息。这意味着数值方法在一个时间步内只能传播与单元尺寸 $h$ 同量级的距离。为保证稳定性，物理传播距离不能超过数值格式所能“看到”的距离。因此，最快物理波传播的距离必须小于或等于一个网格单元的宽度：\n$$|\\lambda_{\\max}| \\Delta t \\le h$$\n这个不等式确保了从时间 $t_n$ 时数值模板内任意点出发的特征线在时间 $t_n + \\Delta t$ 之前不会离开该模板。\n\n问题引入了一个无量纲因子 $\\mathrm{C} \\in (0,1)$，它作为安全因子，并被称为 Courant 数。稳定性条件表示为要求物理平流距离与网格单元尺寸之比受此因子限制：\n$$\\frac{|\\lambda_{\\max}| \\Delta t}{h} \\le \\mathrm{C}$$\n通过整理这个不等式，我们得到对于间距为 $h$ 的网格，对时间步长 $\\Delta t$ 的稳定性限制：\n$$\\Delta t \\le \\mathrm{C} \\frac{h}{|\\lambda_{\\max}|}$$\n\n### 第 2 部分：各层级时间步长关系的推导\n\nAMR 层级包含层级 $\\ell = 0, 1, \\dots, L-1$。层级 $\\ell$ 上的单元间距 $h_{\\ell}$ 与上一粗层级 $\\ell-1$ 上的间距通过一个恒定的整数加密比 $r \\ge 2$ 相关联，使得 $h_{\\ell} = h_{\\ell-1}/r$。这导出了层级 $\\ell$ 上网格间距用基础粗层级间距 $h_0$ 表示的一般表达式：\n$$h_{\\ell} = \\frac{h_0}{r^{\\ell}}$$\n模拟采用时间子循环，其中每个层级 $\\ell$ 使用其自身的时间步长 $\\Delta t_{\\ell}$。一个关键的约束是所有层级都保持一个共同的无量纲 Courant 数 $\\mathrm{C}$。为了最大化计算效率，每个层级上的时间步长被选为在第 1 部分中推导的稳定性极限。对于任意层级 $\\ell$，这给出：\n$$\\Delta t_{\\ell} = \\mathrm{C} \\frac{h_{\\ell}}{|\\lambda_{\\max}|}$$\n我们的目标是找到 $\\Delta t_{\\ell}$ 与基础粗层级时间步长 $\\Delta t_0$ 之间的关系。对于最粗的层级 $\\ell=0$，时间步长为：\n$$\\Delta t_0 = \\mathrm{C} \\frac{h_0}{|\\lambda_{\\max}|}$$\n现在，我们将 $h_{\\ell}$ 的表达式代入 $\\Delta t_{\\ell}$ 的通用公式中：\n$$\\Delta t_{\\ell} = \\mathrm{C} \\frac{(h_0/r^{\\ell})}{|\\lambda_{\\max}|} = \\frac{1}{r^{\\ell}} \\left(\\mathrm{C} \\frac{h_0}{|\\lambda_{\\max}|}\\right)$$\n括号中的项正是 $\\Delta t_0$ 的表达式。因此，我们得出了所求的关系式：\n$$\\Delta t_{\\ell} = \\frac{\\Delta t_0}{r^{\\ell}}$$\n这个结果表明，在具有恒定 Courant 数的时间子循环 AMR 格式中，给定层级上的时间步长与 $r^{\\ell}$ 成反比，这意味着更精细的层级需要相应更小的时间步长。\n\n### 第 3 部分：$\\Delta t_{2}$ 的计算\n\n任务是为一个特定的三层层级结构（$\\ell=0, 1, 2$）计算时间步长 $\\Delta t_2$，具有以下给定参数：\n- 粗层级间距: $h_0 = 0.04\\,\\mathrm{m}$\n- 加密比: $r = 2$\n- 最大特征速度: $|\\lambda_{\\max}| = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 共同 Courant 因子: $\\mathrm{C} = 0.8$\n\n首先，我们必须确定最精细层级 $\\ell=2$ 上的网格间距。使用 $h_{\\ell}$ 的公式：\n$$h_2 = \\frac{h_0}{r^2}$$\n代入数值：\n$$h_2 = \\frac{0.04\\,\\mathrm{m}}{2^2} = \\frac{0.04\\,\\mathrm{m}}{4} = 0.01\\,\\mathrm{m}$$\n接下来，我们使用层级 $\\ell=2$ 稳定性极限下的各层级时间步长公式：\n$$\\Delta t_2 = \\mathrm{C} \\frac{h_2}{|\\lambda_{\\max}|}$$\n代入给定值和计算出的 $h_2$：\n$$\\Delta t_2 = 0.8 \\times \\frac{0.01\\,\\mathrm{m}}{5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = 0.8 \\times (0.002\\,\\mathrm{s})$$\n$$\\Delta t_2 = 0.0016\\,\\mathrm{s}$$\n题目要求答案以秒为单位表示，并四舍五入到四位有效数字。值 $0.0016$ 写成四位有效数字是 $0.001600$。用标准科学记数法表示，即为 $1.600 \\times 10^{-3}$。",
            "answer": "$$\\boxed{1.600 \\times 10^{-3}}$$"
        },
        {
            "introduction": "AMR的强大之处在于使用不同分辨率的网格，但这带来了一个挑战：如何确保像质量这样的物理量在粗细网格边界上得到完美守恒？答案在于一种名为“通量重返流（flux refluxing）”的关键技术。这个动手实践将引导您详细计算重返流过程的每一步，将界面守恒的抽象原理转化为一个具体且易于理解的数值操作。",
            "id": "4006196",
            "problem": "考虑反应流中单一物质质量分数 $Y$ 的一维对流-扩散子步骤，该步骤在自适应网格加密（AMR）框架内构建。其中，反应通过算子分裂法处理，并且在此子步骤中不活跃（即反应源项为零）。在此子步骤中，该物质的控制守恒律为\n$$\n\\frac{\\partial (\\rho Y)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0,\n$$\n其中总物质通量为\n$$\nF = \\rho u Y - \\rho D \\frac{\\partial Y}{\\partial x},\n$$\n其中 $\\rho$ 是质量密度，$u$ 是对流速度，$D$ 是分子扩散系数。假设密度 $\\rho$ 恒定，且横截面积均匀为 $1$，因此单元体积即为长度。\n\n一个粗网格由两个粗单元 $C0$ 和 $C1$ 组成，覆盖范围为 $x \\in [0, 2\\Delta x_c]$，粗单元宽度为 $\\Delta x_c$。一个加密比 $r = 2$ 的细网格覆盖了粗单元 $C1$ 的整个空间范围，由两个宽度为 $\\Delta x_f = \\Delta x_c/2$ 的细单元 $F1$ 和 $F2$ 组成。$C0$ 和细网格之间的界面位于 $x = \\Delta x_c$。位于 $x = \\Delta x_c$ 的面由粗单元 $C0$ 和细单元 $F1$ 共享。位于 $x = 0$ 的左边界是一个具有固定狄利克雷质量分数的入流边界。\n\n参数和初始数据如下：\n- 密度 $\\rho = 1.0 \\ \\mathrm{kg/m^3}$，\n- 对流速度 $u = 0.8 \\ \\mathrm{m/s}$（$x$ 正方向），\n- 扩散系数 $D = 1.0 \\times 10^{-4} \\ \\mathrm{m^2/s}$，\n- 粗单元宽度 $\\Delta x_c = 2.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 细单元宽度 $\\Delta x_f = 1.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 时间步长 $\\Delta t = 5.0 \\times 10^{-4} \\ \\mathrm{s}$，\n- $x=0$ 处的入流质量分数：$Y_{\\text{in}} = 0.20$，\n- 初始质量分数：$Y_{C0}^n = 0.06$，$Y_{F1}^n = 0.12$，$Y_{F2}^n = 0.08$。\n\n在粗网格层级上，被覆盖的粗网格邻居 $C1$ 的状态由细网格数据的保守限制定义，因此其粗网格质量分数为平均值 $Y_{C1}^n = (Y_{F1}^n + Y_{F2}^n)/2$。\n\n使用以下从守恒律和本构通量推导出的、符合物理的、标准的离散化原则：\n- 对流面状态 $Y$ 基于 $u$ 的符号进行迎风选择，\n- 扩散通量使用中心差分，基于相邻单元中心的距离计算；对于宽度分别为 $\\Delta x_L$ 和 $\\Delta x_R$ 的两个单元之间的面，中心距为 $\\Delta x_L/2 + \\Delta x_R/2$。\n\n任务：\n1. 使用 $Y_{C0}^n$ 和粗网格邻居 $Y_{C1}^n$，并以 $\\Delta x_c$ 为中心距，计算 $C0$ 右侧面（位于 $x = \\Delta x_c$）的粗网格层级对流-扩散通量。同时，使用 $Y_{\\text{in}}$ 和 $Y_{C0}^n$，并以 $\\Delta x_c/2$ 为中心距，计算 $C0$ 左边界（位于 $x=0$）的面通量。\n2. 通过守恒律所蕴含的有限体积更新方法，使用左右两侧面的粗网格层级通量，在时间步长 $\\Delta t$ 内更新 $Y_{C0}$。\n3. 使用来自 $C0$ 的迎风状态和来自 $F1$ 的细网格状态，并以 $\\Delta x_c/2 + \\Delta x_f/2$ 为中心距，计算 $C0$ 和 $F1$ 之间界面（位于 $x = \\Delta x_c$）上的细网格层级通量。\n4. 用细网格层级的界面通量填充一个通量寄存器，并对粗单元 $C0$ 应用回流修正，使其最终更新状态与通过 $x = \\Delta x_c$ 的细网格层级界面通量保持一致。\n5. 根据修正后的 $Y_{C0}^{n+1}$，计算 $C0$ 中每单位横截面积的最终物质质量，其定义为 $m_{C0}^{n+1} = \\rho \\, Y_{C0}^{n+1} \\, \\Delta x_c$，并以 $\\mathrm{kg/m^2}$ 为单位表示。\n\n将您的最终答案四舍五入到四位有效数字，并以 $\\mathrm{kg/m^2}$ 为单位表示最终质量。",
            "solution": "### 解题推导\n对于密度 $\\rho$ 恒定、体积为 $\\Delta x_i$（单位面积）的通用单元 $i$，控制方程的有限体积离散化形式为：\n$$ Y_i^{n+1} = Y_i^n - \\frac{\\Delta t}{\\rho \\Delta x_i} (F_{i+1/2} - F_{i-1/2}) $$\n在左单元 $L$ 和右单元 $R$ 之间的一个面上的通量 $F$ 被离散为对流通量和扩散通量之和。给定 $u > 0$，对流部分使用来自左单元的状态 $Y_L$。扩散通量是中心差分。\n$$ F_{face} = (\\rho u Y_L) - (\\rho D) \\frac{Y_R - Y_L}{d_{centers}} $$\n其中 $d_{centers}$ 是单元中心之间的距离。\n\n首先，我们确定粗网格邻居 $C1$ 的状态。它是覆盖其上的细单元的体积加权平均（限制）。\n$$ Y_{C1}^n = \\frac{Y_{F1}^n \\Delta x_f + Y_{F2}^n \\Delta x_f}{\\Delta x_c} = \\frac{Y_{F1}^n + Y_{F2}^n}{r} $$\n当 $r=2$ 时，这是一个简单的平均：\n$$ Y_{C1}^n = \\frac{0.12 + 0.08}{2} = 0.10 $$\n\n**任务1：计算 $C0$ 的粗网格层级通量**\n\n单元 $C0$ 的左侧面在 $x=0$ 处，右侧面在 $x=\\Delta x_c$ 处。\n\n- **$C0$ 左侧面（$x=0$ 处）的通量 ($F_{C0,left}$):**\n左侧“单元”是边界条件 $Y_{\\text{in}}$，右侧单元是 $C0$。给定的中心距为 $d_{centers} = \\Delta x_c / 2$。\n对流使用上游状态 $Y_{\\text{in}}$。\n$$ F_{C0,left} = \\rho u Y_{\\text{in}} - \\rho D \\frac{Y_{C0}^n - Y_{\\text{in}}}{\\Delta x_c / 2} $$\n$$ F_{C0,left} = (1.0)(0.8)(0.20) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.06 - 0.20}{2.0 \\times 10^{-3} / 2} $$\n$$ F_{C0,left} = 0.16 - (1.0 \\times 10^{-4}) \\frac{-0.14}{1.0 \\times 10^{-3}} = 0.16 - (1.0 \\times 10^{-4})(-140) = 0.16 + 0.014 = 0.174 $$\n\n- **$C0$ 右侧面（$x=\\Delta x_c$ 处）的通量（粗网格层级）($F_{C0,right}^c$):**\n左侧单元是 $C0$，右侧单元是 $C1$。给定的中心距为 $d_{centers} = \\Delta x_c$。\n对流使用左侧状态 $Y_{C0}^n$。\n$$ F_{C0,right}^c = \\rho u Y_{C0}^n - \\rho D \\frac{Y_{C1}^n - Y_{C0}^n}{\\Delta x_c} $$\n$$ F_{C0,right}^c = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.10 - 0.06}{2.0 \\times 10^{-3}} $$\n$$ F_{C0,right}^c = 0.048 - (1.0 \\times 10^{-4}) \\frac{0.04}{2.0 \\times 10^{-3}} = 0.048 - (1.0 \\times 10^{-4})(20) = 0.048 - 0.002 = 0.046 $$\n\n**任务2：使用粗网格通量更新 $Y_{C0}$**\n\n这是仅使用粗网格层级信息对 $C0$ 进行的临时更新。\n$$ Y_{C0}^{n+1, \\text{coarse}} = Y_{C0}^n - \\frac{\\Delta t}{\\rho \\Delta x_c} (F_{C0,right}^c - F_{C0,left}) $$\n$$ Y_{C0}^{n+1, \\text{coarse}} = 0.06 - \\frac{5.0 \\times 10^{-4}}{(1.0)(2.0 \\times 10^{-3})} (0.046 - 0.174) $$\n$$ Y_{C0}^{n+1, \\text{coarse}} = 0.06 - (0.25) (-0.128) = 0.06 + 0.032 = 0.092 $$\n\n**任务3：计算细网格层级的界面通量**\n\n这是在粗-细界面 $x=\\Delta x_c$ 处更精确的通量。左侧单元是 $C0$，右侧单元是细单元 $F1$。中心距为 $d_{centers} = \\Delta x_c/2 + \\Delta x_f/2$。\n$$ d_{centers} = \\frac{2.0 \\times 10^{-3}}{2} + \\frac{1.0 \\times 10^{-3}}{2} = 1.0 \\times 10^{-3} + 0.5 \\times 10^{-3} = 1.5 \\times 10^{-3} \\ \\mathrm{m} $$\n细网格层级的通量 $F_{C0,right}^f$ 是：\n$$ F_{C0,right}^f = \\rho u Y_{C0}^n - \\rho D \\frac{Y_{F1}^n - Y_{C0}^n}{\\Delta x_c/2 + \\Delta x_f/2} $$\n$$ F_{C0,right}^f = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.12 - 0.06}{1.5 \\times 10^{-3}} $$\n$$ F_{C0,right}^f = 0.048 - (1.0 \\times 10^{-4}) \\frac{0.06}{1.5 \\times 10^{-3}} = 0.048 - (1.0 \\times 10^{-4})(40) = 0.048 - 0.004 = 0.044 $$\n\n**任务4：应用回流修正**\n\n通量回流（refluxing）程序修正粗单元状态，以确保在粗-细界面的守恒性。对 $Y_{C0}^{n+1, \\text{coarse}}$ 的更新基于界面处粗网格层级通量和细网格层级通量之间的差异。\n由于通量差异， $C0$ 中物质质量的变化为 $\\Delta m = (F_{C0,right}^c - F_{C0,right}^f) \\Delta t A$。由于面积 $A=1$，对状态变量 $Y_{C0}$ 的修正为：\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(F_{C0,right}^c - F_{C0,right}^f) \\Delta t}{\\rho \\Delta x_c} $$\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(0.046 - 0.044) (5.0 \\times 10^{-4})}{(1.0) (2.0 \\times 10^{-3})} = \\frac{(0.002) (5.0 \\times 10^{-4})}{2.0 \\times 10^{-3}} = \\frac{1.0 \\times 10^{-6}}{2.0 \\times 10^{-3}} = 0.0005 $$\n$C0$ 的最终修正状态为：\n$$ Y_{C0}^{n+1} = Y_{C0}^{n+1, \\text{coarse}} + \\Delta Y_{C0}^{\\text{reflux}} $$\n$$ Y_{C0}^{n+1} = 0.092 + 0.0005 = 0.0925 $$\n\n**任务5：计算 $C0$ 中的最终物质质量**\n\n单元 $C0$ 中每单位横截面积的最终物质质量为：\n$$ m_{C0}^{n+1} = \\rho \\, Y_{C0}^{n+1} \\, \\Delta x_c $$\n$$ m_{C0}^{n+1} = (1.0 \\ \\mathrm{kg/m^3}) \\times (0.0925) \\times (2.0 \\times 10^{-3} \\ \\mathrm{m}) $$\n$$ m_{C0}^{n+1} = 0.185 \\times 10^{-3} \\ \\mathrm{kg/m^2} = 1.85 \\times 10^{-4} \\ \\mathrm{kg/m^2} $$\n题目要求将答案四舍五入到四位有效数字。\n$$ m_{C0}^{n+1} = 1.850 \\times 10^{-4} \\ \\mathrm{kg/m^2} $$",
            "answer": "$$\\boxed{1.850 \\times 10^{-4}}$$"
        },
        {
            "introduction": "除了数值精度，AMR在大规模模拟中的实际成功还取决于计算效率。动态变化的网格会导致处理器之间的严重负载不平衡，从而造成性能瓶颈。本练习模拟了这一常见的高性能计算挑战，要求您确定一个盈亏平衡点：在何时，重新划分网格的成本会被负载均衡带来的收益所抵消。这是优化并行AMR应用的一项关键分析。",
            "id": "3094958",
            "problem": "考虑一个一维域，它被均匀地分解到 $P$ 个相同的处理器上，这些处理器在块同步并行（BSP）模型下运行，其中每个时间步的耗时由最慢的处理器决定。基础网格在每个处理器上有 $n_b$ 个单元，更新一个单元一个时间步所需的时间为 $c$ 秒，因此如果一个处理器在一个步骤中持有 $N$ 个单元，则需要 $cN$ 秒。一个自适应网格加密（AMR）区域会将其所在位置的局部单元密度增加一个因子 $q>1$。当 AMR 区域完全驻留在某个处理器的子域内时，它会在此停留整整 $T_s$ 个连续的时间步，然后移动到下一个处理器的子域。假设 AMR 区域足够小，在那 $T_s$ 步期间可以完全包含在单个子域中，并且在 AMR 区域之外，网格保持基础分辨率。\n\n在 AMR 区域进入一个新的处理器子域的瞬间，您可以选择保持当前（静态）的分区，或者调用重新分区来为接下来的 $T_s$ 步完美地平衡所有处理器上的总单元数。如果您不重新分区，那么在那 $T_s$ 步期间，包含 AMR 区域的处理器持有 $qn_b$ 个单元，而其他每个处理器持有 $n_b$ 个单元，每步的墙上时间等于 $c$ 乘以该步中所有处理器上单元数的最大值。如果您重新分区，您需要在那 $T_s$ 步开始时支付一次性重新分区成本 $C_r$，然后每个处理器在接下来的 $T_s$ 步中都精确地持有总单元数的均等份额。一次性重新分区成本建模为 $C_r=C_0+\\alpha N_{\\text{mig}}$，其中 $C_0$ 是一个固定的开销，$\\alpha$ 是每个迁移单元所需的时间，而 $N_{\\text{mig}}$ 是为实现完美平衡，必须从最初包含 AMR 区域的处理器迁移出去的单元数。\n\n仅使用 BSP 计时模型和线性的每单元成本，从第一性原理推导出最小整数 $T_{\\star}$，使得在 AMR 区域进入时调用重新分区所产生的总墙上时间（在那 $T_s$ 步内）严格小于不重新分区的情况。然后使用以下参数评估 $T_{\\star}$：$P=8$， $n_b=1.0\\times 10^{6}$ 个单元， $c=2.0\\times 10^{-8}$ 秒/单元/步， $q=5$， $C_0=0.40$ 秒，以及 $\\alpha=1.0\\times 10^{-7}$ 秒/单元。将 $T_{\\star}$ 报告为整数时间步数（无单位）。不要四舍五入；给出精确整数。",
            "solution": "### 求解推导\n目标是找到最小整数步数 $T_{\\star}$，使得在 $T_s$ 步的周期内，进行重新分区所花费的总墙上时间（$W_{\\text{repart}}$）严格小于不进行重新分区所花费的总墙上时间（$W_{\\text{no-repart}}$）。条件是：\n$$W_{\\text{repart}}  W_{\\text{no-repart}}$$\n\n首先，我们推导 $W_{\\text{no-repart}}$ 的表达式。\n在这种情况下，一个处理器持有 $qn_b$ 个单元，其他 $P-1$ 个处理器各持有 $n_b$ 个单元。根据 BSP 模型，每一步的时间由最慢的处理器决定。由于 $q  1$，持有 $qn_b$ 个单元的处理器是最慢的。\n单步时间为 $t_{\\text{step, no-repart}} = c \\times (qn_b)$。\n在 $T_s$ 步中，总墙上时间为：\n$$W_{\\text{no-repart}} = T_s \\cdot t_{\\text{step, no-repart}} = T_s c q n_b$$\n\n接下来，我们推导 $W_{\\text{repart}}$ 的表达式。\n这包括一次性重新分区成本 $C_r$，以及在负载均衡情况下 $T_s$ 步的计算时间。\n$$W_{\\text{repart}} = C_r + T_s \\cdot t_{\\text{step, repart}}$$\n\n为了求出负载均衡时的每步时间 $t_{\\text{step, repart}}$，我们首先需要模拟中的总单元数 $N_{\\text{total}}$。\n$$N_{\\text{total}} = (qn_b) + (P-1)n_b = (q + P - 1)n_b$$\n在完美重新分区后，P 个处理器中的每一个都持有相等数量的单元 $N_{\\text{bal}}$。\n$$N_{\\text{bal}} = \\frac{N_{\\text{total}}}{P} = \\frac{(q + P - 1)n_b}{P}$$\n那么，负载均衡时单步的时间是：\n$$t_{\\text{step, repart}} = c N_{\\text{bal}} = c \\frac{(q + P - 1)n_b}{P}$$\n\n现在，我们必须计算重新分区成本 $C_r = C_0 + \\alpha N_{\\text{mig}}$。迁移的单元数 $N_{\\text{mig}}$ 是为了达到均衡状态必须从最初过载的处理器上移走的单元数。\n$$N_{\\text{mig}} = (\\text{初始单元数}) - (\\text{最终单元数}) = qn_b - N_{\\text{bal}}$$\n$$N_{\\text{mig}} = qn_b - \\frac{(q + P - 1)n_b}{P} = n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\n$$N_{\\text{mig}} = n_b \\left( \\frac{Pq - q - P + 1}{P} \\right) = n_b \\frac{(P-1)(q-1)}{P}$$\n将此代入 $C_r$ 的表达式中：\n$$C_r = C_0 + \\alpha \\left( n_b \\frac{(P-1)(q-1)}{P} \\right)$$\n\n我们现在可以组合出 $W_{\\text{repart}}$ 的完整表达式：\n$$W_{\\text{repart}} = C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c \\frac{(q + P - 1)n_b}{P}$$\n\n现在，我们求解不等式 $W_{\\text{repart}}  W_{\\text{no-repart}}$ 以求出 $T_s$：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c n_b \\frac{q + P - 1}{P}  T_s c q n_b$$\n为了分离出 $T_s$，我们将包含 $T_s$ 的项归到一边：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s \\left( c q n_b - c n_b \\frac{q + P - 1}{P} \\right)$$\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\n右侧括号中的项与计算 $N_{\\text{mig}}$ 时遇到的项相同：\n$$q - \\frac{q + P - 1}{P} = \\frac{(P-1)(q-1)}{P}$$\n不等式变为：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\frac{(P-1)(q-1)}{P}$$\n解出 $T_s$：\n$$T_s > \\frac{C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\n我们可以将这个分数分成两项：\n$$T_s > \\frac{C_0}{c n_b \\frac{(P-1)(q-1)}{P}} + \\frac{\\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\n$$T_s > \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$$\n问题要求满足此严格不等式的最小整数 $T_s$，我们称之为 $T_{\\star}$。如果我们将右侧定义为 $V$，即 $T_s > V$，则 $T_s$ 的最小整数值为 $\\lfloor V \\rfloor + 1$。\n$$T_{\\star} = \\left\\lfloor \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c} \\right\\rfloor + 1$$\n\n### 数值计算\n我们现在将给定的参数代入这个推导出的表达式中：\n-   $P=8$\n-   $n_b=1.0 \\times 10^{6}$\n-   $c=2.0 \\times 10^{-8}$\n-   $q=5$\n-   $C_0=0.40$\n-   $\\alpha=1.0 \\times 10^{-7}$\n\n我们来计算表达式 $V = \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$ 的值。\n\n第二项是：\n$$\\frac{\\alpha}{c} = \\frac{1.0 \\times 10^{-7}}{2.0 \\times 10^{-8}} = 5$$\n\n第一项是：\n$$\\frac{P C_0}{c n_b (P-1)(q-1)} = \\frac{8 \\times 0.40}{(2.0 \\times 10^{-8})(1.0 \\times 10^{6})(8-1)(5-1)}$$\n$$\\frac{3.2}{(2.0 \\times 10^{-2})(7)(4)} = \\frac{3.2}{(0.02)(28)} = \\frac{3.2}{0.56}$$\n$$\\frac{3.2}{0.56} = \\frac{320}{56} = \\frac{40 \\times 8}{7 \\times 8} = \\frac{40}{7}$$\n\n现在，我们将各项相加求 $V$：\n$$V = \\frac{40}{7} + 5 = \\frac{40}{7} + \\frac{35}{7} = \\frac{75}{7}$$\n用小数形式表示，$V \\approx 10.714$。\n\n最后，我们计算 $T_{\\star}$：\n$$T_{\\star} = \\left\\lfloor \\frac{75}{7} \\right\\rfloor + 1 = \\lfloor 10.714... \\rfloor + 1 = 10 + 1 = 11$$\n\n使得重新分区变得严格更有优势的最小整数步数是 11。",
            "answer": "$$\\boxed{11}$$"
        }
    ]
}