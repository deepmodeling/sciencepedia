{
    "hands_on_practices": [
        {
            "introduction": "在显式数值格式中，时间步长的大小受网格分辨率的严格限制，这便是著名的 Courant–Friedrichs–Lewy (CFL) 条件。自适应网格加密（AMR）中不同层级的网格尺寸差异巨大，因此采用与各层级网格大小相匹配的局部时间步长（即时间子循环）是提高计算效率的关键。这个练习将指导你从基本原理出发，推导AMR框架下的多层级时间步长关系，这是理解AMR高效稳定运行的核心。",
            "id": "3730525",
            "problem": "考虑一个一维线性双曲守恒律方程组 $u_{t} + A u_{x} = 0$，其中 $A \\in \\mathbb{R}^{m \\times m}$ 是一个可对角化且具有实特征值的矩阵，并设特征速度的最大值为 $|\\lambda_{\\max}| = \\max_{k} |\\lambda_{k}|$。在间距为 $h$ 的均匀网格上，一种带单调数值通量的一阶显式有限体积离散格式通过每个时间步最多传播一个单元的信息来更新单元平均值。为保证此类显式格式的稳定性，需确保离散依赖域包含连续依赖域。现在考虑一个自适应网格加密 (AMR) 层次结构，其层级为 $\\ell = 0, 1, \\dots, L-1$，其中层级 $\\ell$ 的单元间距为 $h_{\\ell}$，且对于一个固定的整数加密比 $r \\ge 2$，有 $h_{\\ell+1} = h_{\\ell}/r$。假设使用时间子循环，使得层级 $\\ell$ 以其自身的时间步长 $\\Delta t_{\\ell}$ 向前推进，同时在所有层级上保持一个共同的无量纲库朗数。\n\n任务：\n1. 从系统的双曲特性以及在间距为 $h$ 的网格上，以速度 $|\\lambda_{\\max}|$ 传播的波在每个时间步内不超过一个单元的要求出发，推导显式离散格式的稳定性限制。该限制应以无量纲因子 $\\mathrm{C} \\in (0,1)$、网格间距 $h$ 和特征速度界 $|\\lambda_{\\max}|$ 来表示。清晰地陈述对 $\\Delta t$ 的限制形式，不要引用任何预先给定的公式。\n2. 使用 AMR 层次结构定义和时间子循环假设，推导各层级时间步长 $\\Delta t_{\\ell}$ 与基础粗网格层级时间步长 $\\Delta t_{0}$ 及加密比 $r$ 之间的关系。\n3. 对于一个特定的三层级层次结构，其中 $L=3$，粗网格层级间距 $h_{0} = 0.04\\,\\mathrm{m}$，加密比 $r = 2$，最大特征速度 $|\\lambda_{\\max}| = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$，以及共同的无量纲库朗因子 $\\mathrm{C} = 0.8$，计算层级 $\\ell=2$ 的时间步长 $\\Delta t_{2}$（单位为秒）。将你的答案四舍五入到四位有效数字，并以秒为单位表示时间。\n\n定义：库朗-弗里德里希斯-列维 (Courant–Friedrichs–Lewy, CFL) 条件指的是在显式格式中关联 $\\Delta t$、$h$ 和特征速度的稳定性约束。自适应网格加密 (Adaptive Mesh Refinement, AMR) 指的是通过整数比进行空间加密的层次化网格。",
            "solution": "该问题提出了一个关于自适应网格加密 (AMR) 框架内双曲偏微分方程数值格式稳定性的多部分任务。解答按照要求，分为三个连续的推导和计算部分。\n\n### 第 1 部分：稳定性限制的推导\n\n问题涉及一个一维线性双曲守恒律方程组 $u_{t} + A u_{x} = 0$，其中矩阵 $A$ 的特征值 $\\lambda_k$ 代表信息在域中传播的特征速度。最大传播速度表示为 $|\\lambda_{\\max}| = \\max_{k} |\\lambda_{k}|$。\n\n为使显式数值格式稳定，必须满足库朗-弗里德里希斯-列维 (CFL) 条件。该条件是收敛的必要条件，它确保离散时空网格中某一点的数值依赖域包含该点对应的物理（或连续）依赖域。\n\n问题陈述为该条件提供了一个直接的物理解释：“在间距为 $h$ 的网格上，以速度 $|\\lambda_{\\max}|$ 传播的波在每个时间步内不超过一个单元”。让我们将其形式化。在时间间隔 $\\Delta t$ 内，物理波能传播的最大距离是 $|\\lambda_{\\max}| \\Delta t$。对于一个在均匀单元间距为 $h$ 的网格上的一阶显式格式，位于 $x_i$ 的单元在时间 $t_{n+1} = t_n + \\Delta t$ 的数值解依赖于时间 $t_n$ 时 $i-1$、$i$ 和 $i+1$ 单元的信息。这意味着数值方法在一个时间步内只能传播与单元尺寸 $h$ 同量级的距离。为保证稳定性，物理传播距离不能超过数值格式能“看到”的距离。因此，最快物理波传播的距离必须小于或等于一个网格单元的宽度：\n$$|\\lambda_{\\max}| \\Delta t \\le h$$\n这个不等式确保了在时间 $t_n$ 从数值模板内任意点出发的特征线在时间 $t_n + \\Delta t$ 之前不会离开该模板。\n\n问题引入了一个无量纲因子 $\\mathrm{C} \\in (0,1)$，它作为安全因子，被称为库朗数。稳定性条件表示为要求物理平流距离与网格单元尺寸之比受此因子约束：\n$$\\frac{|\\lambda_{\\max}| \\Delta t}{h} \\le \\mathrm{C}$$\n通过整理这个不等式，我们得到对于间距为 $h$ 的网格，时间步长 $\\Delta t$ 的稳定性限制：\n$$\\Delta t \\le \\mathrm{C} \\frac{h}{|\\lambda_{\\max}|}$$\n\n### 第 2 部分：各层级时间步长关系的推导\n\nAMR 层次结构包含层级 $\\ell = 0, 1, \\dots, L-1$。层级 $\\ell$ 上的单元间距 $h_{\\ell}$ 与其上一层粗网格（层级 $\\ell-1$）的间距通过一个固定的整数加密比 $r \\ge 2$ 相关联，即 $h_{\\ell} = h_{\\ell-1}/r$。由此可得层级 $\\ell$ 的网格间距相对于基础粗网格层级间距 $h_0$ 的通用表达式：\n$$h_{\\ell} = \\frac{h_0}{r^{\\ell}}$$\n模拟采用时间子循环，其中每个层级 $\\ell$ 使用其自身的时间步长 $\\Delta t_{\\ell}$。一个关键约束是在所有层级上保持一个共同的无量纲库朗数 $\\mathrm{C}$。为了最大化计算效率，每个层级上的时间步长被选择为在第 1 部分推导出的稳定性极限。对于任意层级 $\\ell$，这给出：\n$$\\Delta t_{\\ell} = \\mathrm{C} \\frac{h_{\\ell}}{|\\lambda_{\\max}|}$$\n我们的目标是找到 $\\Delta t_{\\ell}$ 和基础粗网格层级时间步长 $\\Delta t_0$ 之间的关系。对于最粗的层级 $\\ell=0$，时间步长为：\n$$\\Delta t_0 = \\mathrm{C} \\frac{h_0}{|\\lambda_{\\max}|}$$\n现在，我们将 $h_{\\ell}$ 的表达式代入 $\\Delta t_{\\ell}$ 的通用公式中：\n$$\\Delta t_{\\ell} = \\mathrm{C} \\frac{(h_0/r^{\\ell})}{|\\lambda_{\\max}|} = \\frac{1}{r^{\\ell}} \\left(\\mathrm{C} \\frac{h_0}{|\\lambda_{\\max}|}\\right)$$\n括号中的项正是 $\\Delta t_0$ 的表达式。因此，我们得到了所求的关系：\n$$\\Delta t_{\\ell} = \\frac{\\Delta t_0}{r^{\\ell}}$$\n这个结果表明，在具有恒定库朗数的时间子循环 AMR 格式中，给定层级上的时间步长与 $r^{\\ell}$ 成反比，这意味着更精细的层级需要相应更小的时间步长。\n\n### 第 3 部分：$\\Delta t_{2}$ 的计算\n\n任务是为一个特定的三层级层次结构（$\\ell=0, 1, 2$）计算时间步长 $\\Delta t_2$，给定参数如下：\n- 粗网格层级间距：$h_0 = 0.04\\,\\mathrm{m}$\n- 加密比：$r = 2$\n- 最大特征速度：$|\\lambda_{\\max}| = 5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- 共同库朗因子：$\\mathrm{C} = 0.8$\n\n首先，我们必须确定最精细层级 $\\ell=2$ 上的网格间距。使用 $h_{\\ell}$ 的公式：\n$$h_2 = \\frac{h_0}{r^2}$$\n代入数值：\n$$h_2 = \\frac{0.04\\,\\mathrm{m}}{2^2} = \\frac{0.04\\,\\mathrm{m}}{4} = 0.01\\,\\mathrm{m}$$\n接下来，我们使用层级 $\\ell=2$ 在稳定性极限下的各层级时间步长公式：\n$$\\Delta t_2 = \\mathrm{C} \\frac{h_2}{|\\lambda_{\\max}|}$$\n代入给定值和计算出的 $h_2$：\n$$\\Delta t_2 = 0.8 \\times \\frac{0.01\\,\\mathrm{m}}{5\\,\\mathrm{m}\\,\\mathrm{s}^{-1}} = 0.8 \\times (0.002\\,\\mathrm{s})$$\n$$\\Delta t_2 = 0.0016\\,\\mathrm{s}$$\n问题要求答案以秒为单位表示，并四舍五入到四位有效数字。数值 $0.0016$ 写成四位有效数字是 $0.001600$。用标准科学记数法表示，即为 $1.600 \\times 10^{-3}$。",
            "answer": "$$\\boxed{1.600 \\times 10^{-3}}$$"
        },
        {
            "introduction": "自适应网格加密的核心挑战之一是在粗细网格的交界面上维持物理守恒律，例如质量或能量守恒。若直接拼接不同分辨率的计算结果，会导致通量不匹配，从而产生非物理的源或汇。本练习通过一个具体的平流-扩散问题，引导你手动计算“通量修正”（refluxing）过程，亲身体验AMR如何通过这一关键技术确保跨尺度计算的守恒性。",
            "id": "4006196",
            "problem": "考虑反应流中单一物质质量分数 $Y$ 的一维平流-扩散子步，该子步在自适应网格加密（AMR）框架内构建。其中，反应通过算子分裂处理，并在此子步中不活跃（即反应源项为零）。在此子步中，该物质的控制守恒定律为\n$$\n\\frac{\\partial (\\rho Y)}{\\partial t} + \\frac{\\partial F}{\\partial x} = 0,\n$$\n其中总物质通量为\n$$\nF = \\rho u Y - \\rho D \\frac{\\partial Y}{\\partial x},\n$$\n式中 $\\rho$ 是质量密度，$u$ 是平流速度，$D$ 是分子扩散系数。假设密度 $\\rho$ 恒定，横截面积均匀为 $1$，因此网格体积即为长度。\n\n一个粗网格由两个粗网格单元 $C0$ 和 $C1$ 组成，覆盖 $x \\in [0, 2\\Delta x_c]$，粗网格单元宽度为 $\\Delta x_c$。一个加密比 $r = 2$ 的细网格覆盖了粗网格单元 $C1$ 的整个空间范围，由两个宽度为 $\\Delta x_f = \\Delta x_c/2$ 的细网格单元 $F1$ 和 $F2$ 组成。$C0$ 与细网格之间的界面位于 $x = \\Delta x_c$。位于 $x = \\Delta x_c$ 的面由粗网格单元 $C0$ 和细网格单元 $F1$ 共享。位于 $x = 0$ 的左边界是一个入流边界，具有固定的狄利克雷质量分数。\n\n参数和初始数据如下：\n- 密度 $\\rho = 1.0 \\ \\mathrm{kg/m^3}$，\n- 平流速度 $u = 0.8 \\ \\mathrm{m/s}$ (正 $x$ 方向)，\n- 扩散系数 $D = 1.0 \\times 10^{-4} \\ \\mathrm{m^2/s}$，\n- 粗网格宽度 $\\Delta x_c = 2.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 细网格宽度 $\\Delta x_f = 1.0 \\times 10^{-3} \\ \\mathrm{m}$，\n- 时间步长 $\\Delta t = 5.0 \\times 10^{-4} \\ \\mathrm{s}$，\n- $x=0$ 处的入流质量分数：$Y_{\\text{in}} = 0.20$，\n- 初始质量分数：$Y_{C0}^n = 0.06$，$Y_{F1}^n = 0.12$，$Y_{F2}^n = 0.08$。\n\n在粗网格层级上，被覆盖的粗网格邻居 $C1$ 的状态由细网格数据的保守限制定义，因此其粗网格质量分数为平均值 $Y_{C1}^n = (Y_{F1}^n + Y_{F2}^n)/2$。\n\n使用以下源于守恒定律和本构通量的符合物理的标准离散化原则：\n- 基于 $u$ 的符号，对平流通量中的面状态 $Y$ 进行迎风选择，\n- 对扩散通量使用中心差分，采用相邻网格中心的距离；对于宽度为 $\\Delta x_L$ 和 $\\Delta x_R$ 的两个网格单元之间的面，中心距为 $\\Delta x_L/2 + \\Delta x_R/2$。\n\n任务：\n1. 使用 $Y_{C0}^n$ 和粗网格邻居 $Y_{C1}^n$，并采用中心距 $\\Delta x_c$，计算 $C0$ 右侧面（位于 $x = \\Delta x_c$）的粗网格层级平流-扩散通量。同时，使用 $Y_{\\text{in}}$ 和 $Y_{C0}^n$，并采用中心距 $\\Delta x_c/2$，计算 $C0$ 左边界（位于 $x=0$）的面通量。\n2. 使用左右两侧面的粗网格层级通量，通过守恒定律所蕴含的有限体积法更新，在时间步长 $\\Delta t$ 内更新 $Y_{C0}$。\n3. 使用来自 $C0$ 的迎风状态和来自 $F1$ 的细网格状态，并采用中心距 $\\Delta x_c/2 + \\Delta x_f/2$，计算 $C0$ 和 $F1$ 之间界面（$x = \\Delta x_c$）上的细网格层级通量。\n4. 用细网格层级界面通量填充一个通量寄存器，并对粗网格单元 $C0$ 应用回流通量修正，使其最终更新的状态与通过 $x = \\Delta x_c$ 的细网格层级界面通量保持一致。\n5. 根据修正后的 $Y_{C0}^{n+1}$，计算 $C0$ 中单位横截面积的最终物质质量，定义为 $m_{C0}^{n+1} = \\rho \\, Y_{C0}^{n+1} \\, \\Delta x_c$，并以 $\\mathrm{kg/m^2}$ 为单位表示。\n\n将您的最终答案四舍五入到四位有效数字，并以 $\\mathrm{kg/m^2}$ 为单位表示最终质量。",
            "solution": "本解答将按照问题中提出的五个任务，逐步进行计算。\n\n首先，根据已知条件，计算粗网格单元 $C1$ 的等效初始质量分数。由于它被细网格单元 $F1$ 和 $F2$ 覆盖，其状态由细网格状态的平均值给出：\n$$ Y_{C1}^n = \\frac{Y_{F1}^n + Y_{F2}^n}{2} = \\frac{0.12 + 0.08}{2} = 0.10 $$\n\n通量 $F$ 的离散表达式为：$F = \\rho u Y_L - \\rho D \\frac{Y_R - Y_L}{d_{\\text{centers}}}$，其中 $Y_L$ 和 $Y_R$ 分别是界面左侧和右侧的质量分数，$d_{\\text{centers}}$ 是相邻单元中心的距离。由于平流速度 $u > 0$，平流项采用上游（左侧）单元的状态。\n\n### 任务 1：计算 $C0$ 的粗网格层级通量\n\n1.  **$C0$ 左侧面 ($x=0$) 的通量 $F_{C0,left}$**：\n    左侧是入流边界，右侧是单元 $C0$。$Y_L = Y_{\\text{in}} = 0.20$，$Y_R = Y_{C0}^n = 0.06$，$d_{\\text{centers}} = \\Delta x_c / 2 = 1.0 \\times 10^{-3} \\ \\mathrm{m}$。\n    $$ F_{C0,left} = (1.0)(0.8)(0.20) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.06 - 0.20}{1.0 \\times 10^{-3}} = 0.16 - (10^{-4})(-140) = 0.16 + 0.014 = 0.174 $$\n\n2.  **$C0$ 右侧面 ($x=\\Delta x_c$) 的粗网格通量 $F_{C0,right}^c$**：\n    左侧是单元 $C0$，右侧是单元 $C1$。$Y_L = Y_{C0}^n = 0.06$，$Y_R = Y_{C1}^n = 0.10$，$d_{\\text{centers}} = \\Delta x_c = 2.0 \\times 10^{-3} \\ \\mathrm{m}$。\n    $$ F_{C0,right}^c = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.10 - 0.06}{2.0 \\times 10^{-3}} = 0.048 - (10^{-4})(20) = 0.048 - 0.002 = 0.046 $$\n\n### 任务 2：使用粗网格通量更新 $Y_{C0}$\n\n使用有限体积法对 $Y_{C0}$ 进行临时更新：\n$$ Y_{C0}^{n+1, \\text{coarse}} = Y_{C0}^n - \\frac{\\Delta t}{\\rho \\Delta x_c} (F_{C0,right}^c - F_{C0,left}) $$\n$$ Y_{C0}^{n+1, \\text{coarse}} = 0.06 - \\frac{5.0 \\times 10^{-4}}{(1.0)(2.0 \\times 10^{-3})} (0.046 - 0.174) = 0.06 - 0.25(-0.128) = 0.06 + 0.032 = 0.092 $$\n\n### 任务 3：计算细网格层级界面通量\n\n计算在粗-细界面 ($x=\\Delta x_c$) 上的更精确的通量 $F_{C0,right}^f$。左侧是单元 $C0$，右侧是细网格单元 $F1$。$Y_L = Y_{C0}^n = 0.06$，$Y_R = Y_{F1}^n = 0.12$。\n中心距 $d_{\\text{centers}} = \\Delta x_c/2 + \\Delta x_f/2 = 1.0 \\times 10^{-3} + 0.5 \\times 10^{-3} = 1.5 \\times 10^{-3} \\ \\mathrm{m}$。\n$$ F_{C0,right}^f = (1.0)(0.8)(0.06) - (1.0)(1.0 \\times 10^{-4}) \\frac{0.12 - 0.06}{1.5 \\times 10^{-3}} = 0.048 - (10^{-4})(40) = 0.048 - 0.004 = 0.044 $$\n\n### 任务 4：应用回流通量修正\n\n通量不匹配会导致质量不守恒。回流通量修正是为了补偿这一差异。对 $Y_{C0}$ 的状态修正量为：\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(F_{C0,right}^c - F_{C0,right}^f) \\Delta t}{\\rho \\Delta x_c} $$\n$$ \\Delta Y_{C0}^{\\text{reflux}} = \\frac{(0.046 - 0.044) (5.0 \\times 10^{-4})}{(1.0) (2.0 \\times 10^{-3})} = \\frac{0.002 \\times 5.0 \\times 10^{-4}}{2.0 \\times 10^{-3}} = \\frac{1.0 \\times 10^{-6}}{2.0 \\times 10^{-3}} = 0.0005 $$\n将此修正量加到临时的粗网格更新结果上，得到最终的更新状态：\n$$ Y_{C0}^{n+1} = Y_{C0}^{n+1, \\text{coarse}} + \\Delta Y_{C0}^{\\text{reflux}} = 0.092 + 0.0005 = 0.0925 $$\n\n### 任务 5：计算 $C0$ 中的最终物质质量\n\n$C0$ 中单位横截面积的最终物质质量 $m_{C0}^{n+1}$ 计算如下：\n$$ m_{C0}^{n+1} = \\rho \\cdot Y_{C0}^{n+1} \\cdot \\Delta x_c = (1.0 \\ \\mathrm{kg/m^3}) \\times (0.0925) \\times (2.0 \\times 10^{-3} \\ \\mathrm{m}) $$\n$$ m_{C0}^{n+1} = 1.85 \\times 10^{-4} \\ \\mathrm{kg/m^2} $$\n按要求四舍五入到四位有效数字，结果为 $1.850 \\times 10^{-4} \\ \\mathrm{kg/m^2}$。",
            "answer": "$$\\boxed{1.850 \\times 10^{-4}}$$"
        },
        {
            "introduction": "在高性能计算中，自适应网格加密的动态特性会造成计算负载在不同处理器间的不均衡，严重影响并行效率。解决这一问题的常见方法是“重分区”，即动态迁移网格数据以重新平衡负载，但这本身也会带来开销。这个练习构建了一个性能模型，让你能够量化分析计算不均衡的代价与重分区的开销之间的权衡，从而决定何时进行重分区是划算的。",
            "id": "3094958",
            "problem": "考虑一个一维域，它被均匀地分解到 $P$ 个相同的处理器上，这些处理器在“体同步并行”（Bulk Synchronous Parallel, BSP）模型下运行，其中每个时间步的耗时由最慢的处理器决定。基础网格在每个处理器上有 $n_b$ 个单元，更新一个单元一个时间步所需的时间是 $c$ 秒。因此，如果一个处理器在一个时间步中持有 $N$ 个单元，则需要 $cN$ 秒。一个自适应网格加密（Adaptive Mesh Refinement, AMR）区域会将其所在位置的局部单元密度增加一个因子 $q1$。当 AMR 区域完全驻留在某个给定处理器的子域内时，它会在那里停留恰好 $T_s$ 个连续的时间步，然后移动到下一个处理器的子域。假设 AMR 区域足够小，可以在这 $T_s$ 步内完全包含在单个子域中，并且在 AMR 区域之外，网格保持基础分辨率。\n\n在 AMR 区域进入新处理器子域的瞬间，你可以选择保持当前（静态）的分区，或者调用重新分区以在接下来的 $T_s$ 步中完美平衡所有处理器上的总单元数。如果不进行重新分区，那么在这 $T_s$ 步期间，包含 AMR 区域的处理器将持有 $qn_b$ 个单元，而其他每个处理器持有 $n_b$ 个单元，每步的墙上时间等于 $c$ 乘以该步中所有处理器上的最大单元数。如果进行重新分区，你需要在这 $T_s$ 步的开始支付一次性的重新分区成本 $C_r$，然后在这 $T_s$ 的每一步中，每个处理器都精确地持有其均分到的总单元数。一次性重新分区成本建模为 $C_r=C_0+\\alpha N_{\\text{mig}}$，其中 $C_0$ 是一个固定开销，$\\alpha$ 是每个迁移单元所需的时间，而 $N_{\\text{mig}}$ 是为实现完美平衡，必须从最初包含 AMR 区域的处理器上迁移出的单元数量。\n\n仅使用 BSP 计时模型和线性的每单元成本，从第一性原理推导出最小整数 $T_{\\star}$，使得在 AMR 区域进入时调用重新分区所产生的总墙上时间（在 $T_s$ 步内）严格小于不进行重新分区所花的时间。然后为以下参数评估 $T_{\\star}$：$P=8$， $n_b=1.0\\times 10^{6}$ 个单元， $c=2.0\\times 10^{-8}$ 秒/单元/步， $q=5$， $C_0=0.40$ 秒，以及 $\\alpha=1.0\\times 10^{-7}$ 秒/单元。将 $T_{\\star}$ 报告为整数时间步数（无单位）。不要四舍五入；给出精确的整数。",
            "solution": "目标是找到最小整数步数 $T_{\\star}$，使得在 $T_s$ 步的时间段内，进行重新分区的总墙上时间 ($W_{\\text{repart}}$) 严格小于不进行重新分区的总墙上时间 ($W_{\\text{no-repart}}$)。条件是：\n$$W_{\\text{repart}}  W_{\\text{no-repart}}$$\n\n首先，我们推导 $W_{\\text{no-repart}}$ 的表达式。\n在这种情况下，一个处理器持有 $qn_b$ 个单元，其他 $P-1$ 个处理器各持有 $n_b$ 个单元。根据 BSP 模型，每步的时间由最慢的处理器决定。由于 $q > 1$，持有 $qn_b$ 个单元的处理器是最慢的。\n单步所需时间为 $t_{\\text{step, no-repart}} = c \\times (qn_b)$。\n在 $T_s$ 步内，总墙上时间为：\n$$W_{\\text{no-repart}} = T_s \\cdot t_{\\text{step, no-repart}} = T_s c q n_b$$\n\n接下来，我们推导 $W_{\\text{repart}}$ 的表达式。\n这包括一次性的重新分区成本 $C_r$，加上在负载均衡情况下 $T_s$ 步的计算时间。\n$$W_{\\text{repart}} = C_r + T_s \\cdot t_{\\text{step, repart}}$$\n\n为了找到负载均衡时每步的时间 $t_{\\text{step, repart}}$，我们首先需要计算模拟中的总单元数 $N_{\\text{total}}$。\n$$N_{\\text{total}} = (qn_b) + (P-1)n_b = (q + P - 1)n_b$$\n完美重新分区后，P 个处理器中的每一个都持有相等数量的单元 $N_{\\text{bal}}$。\n$$N_{\\text{bal}} = \\frac{N_{\\text{total}}}{P} = \\frac{(q + P - 1)n_b}{P}$$\n那么，在负载均衡情况下单步的时间是：\n$$t_{\\text{step, repart}} = c N_{\\text{bal}} = c \\frac{(q + P - 1)n_b}{P}$$\n\n现在，我们必须计算重新分区成本 $C_r = C_0 + \\alpha N_{\\text{mig}}$。迁移的单元数 $N_{\\text{mig}}$ 是为了达到均衡状态必须从最初过载的处理器上移走的单元数量。\n$$N_{\\text{mig}} = (\\text{初始单元数}) - (\\text{最终单元数}) = qn_b - N_{\\text{bal}}$$\n$$N_{\\text{mig}} = qn_b - \\frac{(q + P - 1)n_b}{P} = n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\n$$N_{\\text{mig}} = n_b \\left( \\frac{Pq - q - P + 1}{P} \\right) = n_b \\frac{(P-1)(q-1)}{P}$$\n将此代入 $C_r$ 的表达式中：\n$$C_r = C_0 + \\alpha \\left( n_b \\frac{(P-1)(q-1)}{P} \\right)$$\n\n我们现在可以组合出 $W_{\\text{repart}}$ 的完整表达式：\n$$W_{\\text{repart}} = C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c \\frac{(q + P - 1)n_b}{P}$$\n\n现在，我们求解不等式 $W_{\\text{repart}}  W_{\\text{no-repart}}$ 以解出 $T_s$：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P} + T_s c n_b \\frac{q + P - 1}{P}  T_s c q n_b$$\n为了分离 $T_s$，我们将包含 $T_s$ 的项归类到一起：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s \\left( c q n_b - c n_b \\frac{q + P - 1}{P} \\right)$$\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\left( q - \\frac{q + P - 1}{P} \\right)$$\n右侧括号中的项与计算 $N_{\\text{mig}}$ 时遇到的项相同：\n$$q - \\frac{q + P - 1}{P} = \\frac{(P-1)(q-1)}{P}$$\n不等式变为：\n$$C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}  T_s c n_b \\frac{(P-1)(q-1)}{P}$$\n求解 $T_s$：\n$$T_s > \\frac{C_0 + \\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\n我们可以将分数分成两项：\n$$T_s > \\frac{C_0}{c n_b \\frac{(P-1)(q-1)}{P}} + \\frac{\\alpha n_b \\frac{(P-1)(q-1)}{P}}{c n_b \\frac{(P-1)(q-1)}{P}}$$\n$$T_s > \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$$\n问题要求满足此严格不等式的最小整数 $T_s$，我们称之为 $T_{\\star}$。如果我们将右侧定义为 $V$，即 $T_s > V$，则 $T_s$ 的最小整数值为 $\\lfloor V \\rfloor + 1$。\n$$T_{\\star} = \\left\\lfloor \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c} \\right\\rfloor + 1$$\n\n### 数值计算\n我们现在将给定的参数代入这个推导出的表达式中：\n-   $P=8$\n-   $n_b=1.0 \\times 10^{6}$\n-   $c=2.0 \\times 10^{-8}$\n-   $q=5$\n-   $C_0=0.40$\n-   $\\alpha=1.0 \\times 10^{-7}$\n\n让我们计算表达式 $V = \\frac{P C_0}{c n_b (P-1)(q-1)} + \\frac{\\alpha}{c}$ 的值。\n\n第二项是：\n$$\\frac{\\alpha}{c} = \\frac{1.0 \\times 10^{-7}}{2.0 \\times 10^{-8}} = 5$$\n\n第一项是：\n$$\\frac{P C_0}{c n_b (P-1)(q-1)} = \\frac{8 \\times 0.40}{(2.0 \\times 10^{-8})(1.0 \\times 10^{6})(8-1)(5-1)}$$\n$$\\frac{3.2}{(2.0 \\times 10^{-2})(7)(4)} = \\frac{3.2}{(0.02)(28)} = \\frac{3.2}{0.56}$$\n$$\\frac{3.2}{0.56} = \\frac{320}{56} = \\frac{40 \\times 8}{7 \\times 8} = \\frac{40}{7}$$\n\n现在，我们合并各项来求 $V$：\n$$V = \\frac{40}{7} + 5 = \\frac{40}{7} + \\frac{35}{7} = \\frac{75}{7}$$\n用小数形式表示，$V \\approx 10.714$。\n\n最后，我们计算 $T_{\\star}$：\n$$T_{\\star} = \\left\\lfloor \\frac{75}{7} \\right\\rfloor + 1 = \\lfloor 10.714... \\rfloor + 1 = 10 + 1 = 11$$\n\n使得重新分区变得严格更有优势的最小整数步数是 11。",
            "answer": "$$\\boxed{11}$$"
        }
    ]
}