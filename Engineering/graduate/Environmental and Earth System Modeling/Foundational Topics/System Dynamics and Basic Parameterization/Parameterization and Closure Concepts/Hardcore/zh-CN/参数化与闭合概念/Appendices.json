{
    "hands_on_practices": [
        {
            "introduction": "本章节的实践练习旨在将理论知识应用于实际问题。第一个练习将引导我们探索最基础的闭合形式——梯度扩散假说，也称为K理论。我们将该理论应用于一个经典的大气边界层问题，即计算感热通量，从而将雷诺分解这一抽象概念与一个可计算的、具有物理意义的公式联系起来 。这个练习是理解更复杂参数化方案的基石。",
            "id": "3905149",
            "problem": "考虑一个水平均匀、定常的大气边界层（ABL）片段，其中平均垂直运动可以忽略不计，空气可视为Boussinesq流体。对于像位温 $T$ 这样的标量，其预报方程可以进行 Reynolds 分解，得到一个平均方程，其中未解析的湍流输送以协方差项的形式出现。在一阶闭合中，这种未解析的输送通过梯度扩散假设进行参数化，使用热涡动扩散系数 $K_{\\theta}$。从 Reynolds 分解下标量（位温）的守恒方程出发，并应用一阶闭合概念处理湍流热通量，推导感热通量 $H$ 关于 $K_{\\theta}$、平均温度梯度 $\\partial \\overline{T}/\\partial z$、空气密度 $\\rho$ 和定压比热 $c_{p}$ 的表达式。然后，对于 $K_{\\theta} = 1$ m$^{2}$ s$^{-1}$ 且代表不稳定层结的垂直均匀平均温度梯度 $\\partial \\overline{T}/\\partial z = -0.01$ K m$^{-1}$ 的情况，使用 $\\rho = 1.2$ kg m$^{-3}$ 和 $c_{p} = 1004$ J kg$^{-1}$ K$^{-1}$ 计算 $H$。采用符号约定，其中向上的垂直速度为正，向上的感热通量为正。解释在此约定下，不稳定层结中计算出的通量的符号，并简要说明在另一种将指向地表的向下通量视为正值的地表能量收支约定中，该符号会如何表示。将您的数值答案四舍五入至四位有效数字，并以 W m$^{-2}$ 为单位表示感热通量。",
            "solution": "首先根据指定标准验证问题。\n\n### 第1步：提取已知条件\n- 系统：水平均匀、定常的大气边界层（ABL）片段。\n- 平均垂直运动可以忽略不计。\n- 流体性质：空气可视为Boussinesq流体。\n- 标量：位温，记为 $T$。\n- 建模方法：对 $T$ 的预报方程进行 Reynolds 分解。应用一阶闭合，使用梯度扩散假设和热涡动扩散系数 $K_{\\theta}$。\n- 推导任务：推导感热通量 $H$ 关于 $K_{\\theta}$、平均温度梯度 $\\partial \\overline{T}/\\partial z$、空气密度 $\\rho$ 和定压比热 $c_{p}$ 的表达式。\n- 计算任务：对于 $K_{\\theta} = 1 \\text{ m}^{2} \\text{ s}^{-1}$ 且 $\\partial \\overline{T}/\\partial z = -0.01 \\text{ K m}^{-1}$ 的情况，使用 $\\rho = 1.2 \\text{ kg m}^{-3}$ 和 $c_{p} = 1004 \\text{ J kg}^{-1} \\text{ K}^{-1}$ 计算 $H$。\n- 符号约定：向上的垂直速度为正；向上的感热通量为正。\n- 解释任务1：解释在不稳定层结下计算出的通量的符号。\n- 解释任务2：说明在另一种将向下通量视为正值的地表能量收支约定中，该符号如何表示。\n- 格式要求：将数值答案四舍五入至四位有效数字，并以 W m$^{-2}$ 为单位表示。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。这是大气边界层物理学和微气象学中的一个标准问题，直接涉及参数化和闭合的主题。Reynolds 分解、一阶闭合和感热通量的概念是该学科的基础。推导和数值计算所需的所有参数和条件均已提供，并且这些数值对于所描述的情景（不稳定的ABL）是物理上现实的。该问题不包含矛盾、歧义或事实错误。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n在流体中，对于像位温 $T$ 这样的标量，忽略分子扩散和源/汇项的守恒方程为：\n$$\n\\frac{\\partial T}{\\partial t} + \\mathbf{u} \\cdot \\nabla T = 0\n$$\n其中 $\\mathbf{u} = (u, v, w)$ 是速度矢量。在笛卡尔坐标系中，方程为：\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} + v \\frac{\\partial T}{\\partial y} + w \\frac{\\partial T}{\\partial z} = 0\n$$\n我们应用 Reynolds 分解，将每个变量分解为一个平均分量（用上划线表示）和一个湍流脉动分量（用撇号表示）：$T = \\overline{T} + T'$, $u = \\overline{u} + u'$, $v = \\overline{v} + v'$, and $w = \\overline{w} + w'$。将这些代入守恒方程，并对整个方程取集合平均（Reynolds 平均），得到：\n$$\n\\frac{\\partial \\overline{T}}{\\partial t} + \\overline{u} \\frac{\\partial \\overline{T}}{\\partial x} + \\overline{v} \\frac{\\partial \\overline{T}}{\\partial y} + \\overline{w} \\frac{\\partial \\overline{T}}{\\partial z} + \\frac{\\partial \\overline{u'T'}}{\\partial x} + \\frac{\\partial \\overline{v'T'}}{\\partial y} + \\frac{\\partial \\overline{w'T'}}{\\partial z} = 0\n$$\n问题为这个ABL片段指定了几个条件：\n1.  **定常态**：$\\frac{\\partial}{\\partial t} = 0$。第一项消失。\n2.  **水平均匀**：对于平均量，$\\frac{\\partial}{\\partial x} = 0$ 且 $\\frac{\\partial}{\\partial y} = 0$。第二、三、五、六项消失。\n3.  **平均垂直运动可忽略**：$\\overline{w} = 0$。第四项消失。\n\n应用这些条件后，平均位温收支方程简化为：\n$$\n\\frac{\\partial \\overline{w'T'}}{\\partial z} = 0\n$$\n该方程表明，湍流动能热通量 $\\overline{w'T'}$ 的垂直梯度为零。这意味着在没有其他效应（如辐射通量辐散）的情况下，$\\overline{w'T'}$ 随高度保持不变。\n\n感热通量 $H$ 是由湍流流体运动引起的垂直热量输送，定义为：\n$$\nH = \\rho c_{p} \\overline{w'T'}\n$$\n其中 $\\rho$ 是空气密度，$c_{p}$ 是定压比热容。\n\n接下来，问题要求应用一阶闭合方案，具体来说是梯度扩散假设（也称为K理论）。这种方法用平均量的梯度来参数化未解析的湍流通量。对于位温的垂直通量，关系式为：\n$$\n\\overline{w'T'} = -K_{\\theta} \\frac{\\partial \\overline{T}}{\\partial z}\n$$\n这里，$K_{\\theta}$ 是热涡动扩散系数，一个表示湍流混合效率的参数。负号至关重要：它确保通量方向与位温降低的方向一致，即当位温随高度降低（负梯度）时，会产生正（向上）的通量。\n\n将此参数化代入感热通量 $H$ 的定义中，得到所需的表达式：\n$$\nH = \\rho c_{p} \\left(-K_{\\theta} \\frac{\\partial \\overline{T}}{\\partial z}\\right) = -\\rho c_{p} K_{\\theta} \\frac{\\partial \\overline{T}}{\\partial z}\n$$\n这就是推导出的感热通量 $H$ 的表达式。\n\n接下来，我们使用给定的数值计算 $H$：\n- $\\rho = 1.2 \\text{ kg m}^{-3}$\n- $c_{p} = 1004 \\text{ J kg}^{-1} \\text{ K}^{-1}$\n- $K_{\\theta} = 1 \\text{ m}^{2} \\text{ s}^{-1}$\n- $\\frac{\\partial \\overline{T}}{\\partial z} = -0.01 \\text{ K m}^{-1}$\n\n将这些值代入推导出的公式中：\n$$\nH = -(1.2 \\text{ kg m}^{-3}) (1004 \\text{ J kg}^{-1} \\text{ K}^{-1}) (1 \\text{ m}^{2} \\text{ s}^{-1}) (-0.01 \\text{ K m}^{-1})\n$$\n$$\nH = (-1.2 \\times 1004 \\times 1 \\times -0.01) \\frac{\\text{kg} \\cdot \\text{J} \\cdot \\text{m}^2 \\cdot \\text{K}}{\\text{m}^3 \\cdot \\text{kg} \\cdot \\text{K} \\cdot \\text{s} \\cdot \\text{m}}\n$$\n单位简化为 $\\text{J m}^{-2} \\text{ s}^{-1}$，等价于瓦特每平方米，即 $\\text{W m}^{-2}$。\n计算数值：\n$$\nH = (1.2)(1004)(0.01) = 12.048 \\text{ W m}^{-2}\n$$\n按要求四舍五入到四位有效数字，得到：\n$$\nH = 12.05 \\text{ W m}^{-2}\n$$\n\n计算出的通量符号为正。这与物理条件相符。给定的梯度 $\\frac{\\partial \\overline{T}}{\\partial z} = -0.01 \\text{ K m}^{-1}$ 是负值，意味着位温随高度降低。这个条件定义了一个静力不稳定的气层。在这样的气层中，一个向上位移的气块比其新环境更暖（因此密度更小），导致它继续上升。这种由浮力驱动的运动导致强烈的垂直混合，将近地表的暖空气向上输送，并将高处的冷空气向下输送。净结果是向上的热量输送。根据向上通量为正的符号约定，感热通量 $H$ 必须为正，这与我们计算出的结果 $H > 0$ 一致。\n\n最后，考虑另一种地表能量收支约定，其中指向地表的向下通量被视为正值。我们计算出的通量是离开地表的向上通量。在地表约定中，这种向上通量将用负号表示。因此，在该约定下，通量将为 $H = -12.05 \\text{ W m}^{-2}$。",
            "answer": "$$\\boxed{12.05}$$"
        },
        {
            "introduction": "虽然K理论在概念上很直观，但更精确的模型通常需要更复杂的闭合方案。本次实践将带领我们构建并求解一个“1.5阶”湍流闭合模型，其中湍流动能（TKE）本身是一个预报量。这个练习代表了向真实大气模型复杂性迈出的一步，它不仅深化了我们对湍流产生和耗散过程的理解，还要求我们采用计算方法来求解特定大气条件下的湍流廓线 。",
            "id": "3905106",
            "problem": "使用湍流动能平衡和带稳定度相关混合长的一阶闭合方案，对一个稳态、水平均匀的大气边界层进行建模。目标是，在给定切变廓线 $S(z)$ 和依赖于稳定度的混合长 $\\ell(z)$ 的情况下，从基本原理出发，推导并计算单位质量的湍流动能 $e(z)$ 的垂直廓线，然后总结指定测试案例的结果。\n\n从以下基本基础开始：\n\n- 在稳态、水平均匀且忽略湍流输送的条件下，湍流动能（TKE）的平衡方程为\n$$\nP(z) + B(z) - \\varepsilon(z) = 0,\n$$\n其中 $P(z)$ 是切变生成项，$B(z)$ 是浮力生成项（对流不稳定时为正，稳定层结时为负），$\\varepsilon(z)$ 是耗散项。在此处使用的简化闭合方案中，稳定度效应已嵌入混合长 $\\ell(z)$ 中，而不是通过 $B(z)$ 显式引入；因此，我们使用简化的平衡关系 $P(z) = \\varepsilon(z)$。\n\n- 涡黏性闭合方案为\n$$\n\\nu_t(z) = c_m\\, \\ell(z)\\, \\sqrt{e(z)},\n$$\n其中 $c_m$ 是一个无量纲校准常数，$\\nu_t(z)$ 是湍流（涡）黏性，$\\ell(z)$ 是混合长，$e(z)$ 是单位质量的湍流动能。\n\n- 切变生成项为\n$$\nP(z) = \\nu_t(z)\\, S(z)^2,\n$$\n其中 $S(z)$ 是平均切变率的大小（单位为 $\\mathrm{s}^{-1}$），定义为水平风垂直梯度的范数。\n\n- 耗散率闭合方案为\n$$\n\\varepsilon(z) = c_{\\varepsilon}\\, \\frac{e(z)^{3/2}}{\\ell(z)},\n$$\n其中 $c_{\\varepsilon}$ 是一个正的无量纲常数。\n\n- 混合长受地面层标度和外层渐近线的限制，采用 Blackadar 形式，其稳定性取自 Monin–Obukhov 相似性理论（MOST）：\n$$\n\\ell(z) = \\frac{\\kappa z}{1 + \\frac{\\kappa z}{\\ell_{\\infty}}}\\, \\frac{1}{\\Phi_m(\\zeta)},\n$$\n其中 $\\kappa$ 是 von Kármán 常数，$\\ell_{\\infty}$ 是外层极限长度尺度，$\\zeta = z/L$ 是稳定度参数（$L$ 为 Obukhov 长度），$\\Phi_m(\\zeta)$ 是由 Businger–Dyer 形式给出的 MOST 稳定度函数：\n$$\n\\Phi_m(\\zeta) =\n\\begin{cases}\n1 + 5\\zeta,  \\zeta \\ge 0 \\quad \\text{(稳定)},\\\\\n\\left(1 - 16\\zeta\\right)^{-1/4},  \\zeta  0 \\quad \\text{(不稳定)}.\n\\end{cases}\n$$\n这些关系在边界层气象学中得到了充分的检验。\n\n任务：\n1. 在简化的稳态平衡条件下，利用上述基础和闭合方案，推导出 $e(z)$ 关于 $\\ell(z)$、$S(z)$、$c_m$ 和 $c_{\\varepsilon}$ 的显式代数表达式。\n2. 实现一个程序，在指定的垂直网格上为下面定义的每个测试案例计算 $e(z)$。对于每个案例，报告在给定层高范围内 $e(z)$ 的最大值，以 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$ 为单位的浮点数表示，并四舍五入到六位小数。\n\n使用的常数：\n- $\\kappa = 0.4$。\n- $c_m = 0.01$。\n- $c_{\\varepsilon} = 1.0$。\n\n测试套件的定义：\n对每个案例，定义 $z \\in [0, z_{\\max}]$（$\\Delta z = 1\\,\\mathrm{m}$）、切变廓线 $S(z)$、Obukhov 长度 $L$ 和极限混合长 $\\ell_{\\infty}$。\n\n- 案例 A（一般不稳定，“理想路径”）：\n  - $z_{\\max} = 600\\,\\mathrm{m}$。\n  - $S(z) = S_0 \\exp(-z/z_s)$，其中 $S_0 = 0.3\\,\\mathrm{s}^{-1}$，$z_s = 200\\,\\mathrm{m}$。\n  - $L = -50\\,\\mathrm{m}$。\n  - $\\ell_{\\infty} = 150\\,\\mathrm{m}$。\n\n- 案例 B（中等稳定）：\n  - $z_{\\max} = 300\\,\\mathrm{m}$。\n  - $S(z) = \\dfrac{S_0}{1 + z/z_s}$，其中 $S_0 = 0.25\\,\\mathrm{s}^{-1}$，$z_s = 100\\,\\mathrm{m}$。\n  - $L = 100\\,\\mathrm{m}$。\n  - $\\ell_{\\infty} = 120\\,\\mathrm{m}$。\n\n- 案例 C（类中性，具有非常大的 Obukhov 长度）：\n  - $z_{\\max} = 400\\,\\mathrm{m}$。\n  - $S(z) = S_0$ 为常数，其中 $S_0 = 0.2\\,\\mathrm{s}^{-1}$。\n  - $L = 10^9\\,\\mathrm{m}$（等效于中性）。\n  - $\\ell_{\\infty} = 200\\,\\mathrm{m}$。\n\n- 案例 D（零切变的边缘情况）：\n  - $z_{\\max} = 500\\,\\mathrm{m}$。\n  - 对所有 $z$，$S(z) = 0$。\n  - $L = -30\\,\\mathrm{m}$。\n  - $\\ell_{\\infty} = 150\\,\\mathrm{m}$。\n\n单位：\n- 以 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$ 为单位报告 $e(z)$。\n- 最终的程序输出必须是每个案例（按 A、B、C、D 的顺序）的 $e(z)$ 最大值，四舍五入到六位小数。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result_A,result_B,result_C,result_D]$），每个条目都是一个以 $\\mathrm{m}^2\\,\\mathrm{s}^{-2}$ 为单位、四舍五入到六位小数的浮点值。\n- 您的程序必须是自包含的，不得要求任何用户输入，并且必须完全按照描述计算指定测试套件的结果。",
            "solution": "该问题要求在一个简化的大气边界层模型中，推导并计算单位质量湍流动能 $e(z)$ 的垂直廓线。解答分为两部分：首先是 $e(z)$ 的代数推导，其次是求解指定测试案例的计算实现。\n\n**1. 湍流动能表达式的推导**\n\n出发点是给定的稳态、水平均匀的湍流动能（TKE）收支方程，在所述简化条件下，该方程简化为切变生成项 $P(z)$ 和耗散项 $\\varepsilon(z)$ 之间的平衡：\n$$\nP(z) = \\varepsilon(z)\n$$\n该方程假定，湍涡与平均垂直风切变相互作用产生 TKE 的速率，与 TKE 在最小运动尺度上通过黏性力转化为内能的速率完全平衡。\n\n接下来，我们引入为生成项和耗散项提供的闭合假设。切变生成项定义为：\n$$\nP(z) = \\nu_t(z)\\, S(z)^2\n$$\n其中 $S(z)$ 是平均切变率的大小，$\\nu_t(z)$ 是涡黏性。涡黏性本身使用基于局地 TKE $e(z)$ 和湍流混合长 $\\ell(z)$ 的一阶闭合方案进行参数化：\n$$\n\\nu_t(z) = c_m\\, \\ell(z)\\, \\sqrt{e(z)}\n$$\n此处，$c_m$ 是一个无量纲常数，给定值为 $0.01$。将 $\\nu_t(z)$ 的这个表达式代入 $P(z)$ 的方程中，得到：\n$$\nP(z) = \\left( c_m\\, \\ell(z)\\, \\sqrt{e(z)} \\right) S(z)^2 = c_m\\, \\ell(z)\\, e(z)^{1/2}\\, S(z)^2\n$$\n耗散率 $\\varepsilon(z)$ 被参数化为 $e(z)$ 和 $\\ell(z)$ 的函数：\n$$\n\\varepsilon(z) = c_{\\varepsilon}\\, \\frac{e(z)^{3/2}}{\\ell(z)}\n$$\n其中 $c_{\\varepsilon}$ 是另一个无量纲常数，给定值为 $1.0$。\n\n现在，我们将 $P(z)$ 和 $\\varepsilon(z)$ 的这些表达式代回简化的 TKE 平衡方程 $P(z) = \\varepsilon(z)$ 中：\n$$\nc_m\\, \\ell(z)\\, e(z)^{1/2}\\, S(z)^2 = c_{\\varepsilon}\\, \\frac{e(z)^{3/2}}{\\ell(z)}\n$$\n为了找到 $e(z)$ 的显式表达式，我们重排此方程以分离出 $e(z)$。我们可以将涉及 $e(z)$ 的项归到一边。假设 $e(z)  0$（这是湍流存在的物理要求），我们可以将方程两边同除以 $e(z)^{1/2}$：\n$$\nc_m\\, \\ell(z)\\, S(z)^2 = c_{\\varepsilon}\\, \\frac{e(z)^{3/2 - 1/2}}{\\ell(z)} = c_{\\varepsilon}\\, \\frac{e(z)}{\\ell(z)}\n$$\n求解 $e(z)$ 现在变得很简单。我们将方程两边乘以 $\\ell(z)$ 并除以 $c_{\\varepsilon}$：\n$$\ne(z) = \\frac{c_m}{c_{\\varepsilon}} \\left( \\ell(z) S(z) \\right)^2\n$$\n这就是单位质量湍流动能 $e(z)$ 的最终代数表达式，它以局地混合长 $\\ell(z)$、平均切变率 $S(z)$ 以及闭合常数 $c_m$ 和 $c_{\\varepsilon}$ 的函数形式表示。它表明，在该闭合框架下，TKE 与切变率的平方和混合长的平方成正比。如果切变 $S(z)$ 为零，则 $e(z)$ 也为零，这是一个物理上一致的结果，因为没有生成机制。\n\n**2. 计算实现**\n\n对于四个指定的测试案例中的每一个，都对推导出的 $e(z)$ 表达式进行数值评估。步骤如下：\n\n首先，对每个案例，定义一个从地表（$z=0$）到指定最大高度 $z_{\\max}$ 的离散垂直网格，网格间距为 $\\Delta z = 1\\,\\mathrm{m}$。\n\n其次，在每个网格点 $z$ 处，计算必要的物理量：\n1.  根据特定案例提供的函数计算切变廓线 $S(z)$。\n2.  使用给定的 Obukhov 长度 $L$ 计算稳定度参数 $\\zeta = z/L$。\n3.  使用适当的 Businger-Dyer 形式，根据 $\\zeta$ 的符号确定 Monin-Obukhov 稳定度函数 $\\Phi_m(\\zeta)$：\n    $$\n    \\Phi_m(\\zeta) =\n    \\begin{cases}\n    1 + 5\\zeta,  \\text{对于 } \\zeta \\ge 0 \\\\\n    \\left(1 - 16\\zeta\\right)^{-1/4},  \\text{对于 } \\zeta  0\n    \\end{cases}\n    $$\n4.  然后使用 Blackadar 公式计算与稳定度相关的混合长 $\\ell(z)$：\n    $$\n    \\ell(z) = \\frac{\\kappa z}{1 + \\frac{\\kappa z}{\\ell_{\\infty}}}\\, \\frac{1}{\\Phi_m(\\zeta)}\n    $$\n    其中 $\\kappa = 0.4$，$\\ell_{\\infty}$ 是特定案例的极限长度尺度。在地表 $z=0$ 处，该公式正确地得出 $\\ell(0) = 0$。\n\n第三，利用代表 $S(z)$ 和 $\\ell(z)$ 廓线的数组，使用推导出的公式计算湍流动能 $e(z)$ 的廓线：\n$$\ne(z) = \\left(\\frac{c_m}{c_{\\varepsilon}}\\right) \\ell(z)^2 S(z)^2 = \\left(\\frac{0.01}{1.0}\\right) \\ell(z)^2 S(z)^2 = 0.01\\, \\ell(z)^2 S(z)^2\n$$\n\n最后，对于每个案例，找出整个垂直廓线上 $e(z)$ 的最大值。然后将此最大值四舍五入到六位小数，以生成所需的输出。对所有四个测试案例（A、B、C 和 D）重复此过程，并将结果汇总到一个格式化的列表中。对于案例 D，由于 $S(z)$ 处处为 0，因此得到的 $e(z)$ 廓线也处处为零，其最大值因此为 $0.0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and computes the vertical profile of turbulent kinetic energy e(z)\n    for several atmospheric boundary layer scenarios.\n    \"\"\"\n    \n    # Define constants\n    KAPPA = 0.4  # von Kármán constant\n    C_M = 0.01   # Eddy viscosity constant\n    C_EPS = 1.0  # Dissipation constant\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"z_max\": 600,\n            \"S_func\": lambda z: 0.3 * np.exp(-z / 200.0),\n            \"L\": -50.0,\n            \"l_inf\": 150.0,\n        },\n        {\n            \"name\": \"B\",\n            \"z_max\": 300,\n            \"S_func\": lambda z: 0.25 / (1.0 + z / 100.0),\n            \"L\": 100.0,\n            \"l_inf\": 120.0,\n        },\n        {\n            \"name\": \"C\",\n            \"z_max\": 400,\n            \"S_func\": lambda z: 0.2 * np.ones_like(z),\n            \"L\": 1e9,\n            \"l_inf\": 200.0,\n        },\n        {\n            \"name\": \"D\",\n            \"z_max\": 500,\n            \"S_func\": lambda z: np.zeros_like(z),\n            \"L\": -30.0,\n            \"l_inf\": 150.0,\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        z_max = case[\"z_max\"]\n        S_func = case[\"S_func\"]\n        L = case[\"L\"]\n        l_inf = case[\"l_inf\"]\n\n        # Create the vertical grid (z in meters)\n        # z in [0, z_max] with Delta_z = 1m\n        z = np.arange(0, z_max + 1, 1.0)\n\n        # 1. Calculate the shear profile S(z)\n        S_profile = S_func(z)\n\n        # 2. Calculate the stability parameter zeta(z)\n        # Handle z=0 separately to avoid 0/0 if L were 0, though not in these cases.\n        # np.divide handles division by a large L value correctly.\n        zeta = np.divide(z, L, out=np.zeros_like(z, dtype=float), where=(L!=0))\n\n        # 3. Calculate the MOST stability function Phi_m(z)\n        phi_m = np.where(zeta >= 0, \n                         1.0 + 5.0 * zeta,\n                         (1.0 - 16.0 * zeta)**(-0.25))\n\n        # 4. Calculate the mixing length profile l(z)\n        # The formula for l(z) has z in the numerator, so l(0) = 0 naturally.\n        # This prevents division-by-zero for phi_m at z=0.\n        l_profile = np.zeros_like(z, dtype=float)\n        # Avoid division by zero in phi_m term if z=0, though phi_m(0)=1\n        non_zero_z_indices = z > 0\n        \n        # Blackadar formula for mixing length\n        # A more direct implementation, which also works correctly for z=0:\n        denominator_l = 1.0 + (KAPPA * z / l_inf)\n        l_z_neutral = (KAPPA * z) / denominator_l\n        l_profile = np.divide(l_z_neutral, phi_m, out=np.zeros_like(l_z_neutral), where=phi_m!=0)\n        \n        # 5. Calculate the TKE profile e(z)\n        e_profile = (C_M / C_EPS) * (l_profile**2) * (S_profile**2)\n\n        # 6. Find the maximum value and round it.\n        max_e = np.max(e_profile)\n        results.append(max_e)\n\n    # Final print statement in the exact required format.\n    # Format each result to ensure six decimal places.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "闭合问题远不止局限于湍流。最后一个练习将我们的视野扩展到气候模拟中的一个核心挑战：如何表示次网格尺度云结构对辐射的影响。通过比较两种截然不同的云垂直重叠参数化方案——“最大重叠”与“随机重叠”，本练习揭示了模型中的结构性假设如何显著影响地球反照率这样的大尺度系统属性 。这有助于我们理解参数化选择在地球系统模型中的深远意义。",
            "id": "3905165",
            "problem": "您正在模拟不同垂直重叠闭合假设下，大气层顶的云短波辐射效应。任务是使用一个物理上一致的、平面平行的双流相加框架，推导、实现并比较两种极端的重叠闭合方案——最大重叠和随机重叠。\n\n假设与基本原理：\n- 在平面平行板层中的辐射传输能量守恒意味着，对于一个具有反射率和透射率的散射层，能量在反射和透射过程中是守恒的。\n- 独立柱近似（Independent Column Approximation, ICA）断言，大气层顶反照率可以计算为代表各层云存在或缺失实现的子柱的面积加权平均值。\n- 垂直重叠闭合方案参数化了子网格中云的存在在层与层之间的关联方式。最大重叠闭合方案对应于云区之间完美的垂直相干性，而随机重叠闭合方案对应于各层云出现的统计独立性。\n\n物理量与定义：\n- 云量廓线由一组层云量 $\\{c_i\\}_{i=1}^N$ 组成，其中每个 $c_i \\in [0,1]$ 是第 $i$ 层为云的概率（或面积分数）。\n- 每个云层 $i$ 都有一个相关的宽带短波光学厚度 $\\tau_i \\ge 0$（无量綱）。\n- 晴空大气层顶反照率用 $\\alpha_{\\mathrm{clr}} \\in [0,1]$ 表示（无量綱）。\n- 对于光学厚度为 $\\tau$ 的单个云板层，使用一个经过充分检验的经验函数 $r(\\tau)$ 来近似其宽带短波反射率 $r(\\tau)$，该函数在 $\\tau$上是单调的，并满足 $r(0)=0$ 和当 $\\tau\\to\\infty$ 时 $r(\\tau)\\to 1$。在实现中，使用一个根据观测数据校准的有理函数，其中包含一个正常数参数 $\\gamma$，并在云中吸收可忽略不计的假设下，将相应的透射率定义为 $t(\\tau)=1-r(\\tau)$。\n- 当一个反射率为 $r(\\tau)$、透射率为 $t(\\tau)$ 的云板层覆盖在一个其下方有效反射率为 $\\alpha$ 的系统之上时，双流相加原理意味着净大气层顶反射率 $R(\\tau,\\alpha)$ 由云板层和下垫反射体之间的重复多次反射唯一确定，此过程能量守恒。\n\n待比较的重叠闭合方案：\n- 最大重叠闭合方案：所有云层在出现云的同一子柱中对齐。总云区面积是最大层云量 $C_{\\mathrm{max}}=\\max_i c_i$，云的光学厚度在对齐的云子柱中相加，得到组合光学厚度 $\\tau_{\\mathrm{sum}}=\\sum_{i=1}^N \\tau_i$。\n- 随机重叠闭合方案：每层云的存在与其他层相互独立。整个气柱由所有 $2^N$ 个子柱表示，每个子柱对应一个云层的子集，其概率由每层云存在或不存在的概率之积给出。\n\n任务：\n1. 从能量守恒和独立柱近似出发，从第一性原理推导 $R(\\tau,\\alpha)$ 的表达式，即光学厚度为 $\\tau$ 的云板层覆盖在反射率为 $\\alpha$ 的下垫反射体之上时的大气层顶反射率。证明云板层与下垫反射体之间的多次反射级数收敛，并得出一个在 $r(\\tau)1$ 和 $\\alpha1$ 条件下与能量守恒一致的闭式表达式。\n2. 使用推导出的 $R(\\tau,\\alpha)$，构建以下两种情况的大气层顶反照率（无量纲）公式：\n   - 最大重叠闭合方案：$A_{\\mathrm{max}}$ 定义为光学厚度为 $\\tau_{\\mathrm{sum}}$ 的对齐云子柱与反射率为 $\\alpha_{\\mathrm{clr}}$ 的晴空区域的面积加权混合。\n   - 随机重叠闭合方案：$A_{\\mathrm{rnd}}$ 定义为对所有 $2^N$ 个子柱的 ICA 面积加权平均，每个子柱的光学厚度是其包含的云层的 $\\tau_i$ 之和。\n3. 对以下每个测试用例，计算差异 $\\Delta A = A_{\\mathrm{max}} - A_{\\mathrm{rnd}}$（无量纲）。提供四舍五入到六位小数的结果。\n\n实现的数值闭合细节：\n- 使用 $r(\\tau)=\\dfrac{\\tau}{\\tau+\\gamma}$，其中正常数 $\\gamma$ 代表一个经验性宽带缩放参数，并使用 $t(\\tau)=1-r(\\tau)$。\n- 使用由云板层和下垫反射体之间多次反射所蕴含的双流相加关系 $R(\\tau,\\alpha)$。\n\n测试套件：\n每个测试用例是一个形式为 $(\\{c_i\\}, \\{\\tau_i\\}, \\alpha_{\\mathrm{clr}}, \\gamma)$ 的元组，其值如下：\n\n- 用例 1（通用多层）：$\\{c_i\\}=[0.2,0.5,0.1]$, $\\{\\tau_i\\}=[5.0,10.0,0.5]$, $\\alpha_{\\mathrm{clr}}=0.08$, $\\gamma=7.7$。\n- 用例 2（无云，边界情况）：$\\{c_i\\}=[0.0,0.0]$, $\\{\\tau_i\\}=[1.0,20.0]$, $\\alpha_{\\mathrm{clr}}=0.10$, $\\gamma=7.7$。\n- 用例 3（全云，边界情况）：$\\{c_i\\}=[1.0,1.0]$, $\\{\\tau_i\\}=[3.0,3.0]$, $\\alpha_{\\mathrm{clr}}=0.06$, $\\gamma=7.7$。\n- 用例 4（薄云上覆厚云）：$\\{c_i\\}=[0.5,0.5]$, $\\{\\tau_i\\}=[0.2,15.0]$, $\\alpha_{\\mathrm{clr}}=0.10$, $\\gamma=7.7$。\n- 用例 5（高低云量交替）：$\\{c_i\\}=[0.9,0.1,0.9,0.1]$, $\\{\\tau_i\\}=[20.0,1.0,15.0,1.0]$, $\\alpha_{\\mathrm{clr}}=0.12$, $\\gamma=7.7$。\n\n输出：\n您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按上述用例的顺序排列结果，每个 $\\Delta A$ 值四舍五入到六位小数（例如，“[0.012345,-0.000001,0.100000,0.000000,0.023456]”）。\n\n所有量均为无量纲；光学厚度、反照率、反射率和透射率是无单位的小数。本问题不涉及角度。",
            "solution": "该问题要求在一个简化的辐射传输框架内，推导并比较两种云垂直重叠闭合方案——最大重叠和随机重叠。一项关键验证确认该问题在科学上是合理的、适定的，并且基于大气辐射传输的既定原理。因此，我们可以着手求解。\n\n解决方案分为三部分：\n1.  推导覆盖在反射表面上的散射层的大气层顶（TOA）反射率。\n2.  在最大重叠和随机重叠闭合方案下构建总大气反照率的公式。\n3.  将这些公式应用于所提供的测试用例。\n\n### 1. TOA反射率 $R(\\tau, \\alpha)$ 的推导\n\n我们的任务是推导单个光学厚度为 $\\tau$ 的非吸收散射层覆盖在反照率为 $\\alpha$ 的表面之上时的大气层顶反射率 $R(\\tau,\\alpha)$ 的表达式。该层的特征是其反射率 $r(\\tau)$ 和透射率 $t(\\tau)$。由于假设没有吸收，该层的能量守恒意味着 $r(\\tau) + t(\\tau) = 1$。\n\n我们对云层与下垫面之间的多次反射进行建模。考虑一个单位的太阳入射通量到达云层顶部。\n\n总反射通量 $R(\\tau,\\alpha)$ 是逸出到太空的一系列无穷通量贡献之和：\n1.  从云层顶部的初始直接反射：$r(\\tau)$。\n2.  向下透过云层（$t(\\tau)$），从表面反射（$\\alpha$），再向上透过云层（$t(\\tau)$）的通量。这一阶贡献为 $t(\\tau) \\cdot \\alpha \\cdot t(\\tau) = \\alpha t(\\tau)^2$。\n3.  向下透射，从表面向上反射，从云层底部向下反射（$r(\\tau)$），再次从表面反射（$\\alpha$），最后向上透过云层（$t(\\tau)$）的通量。这二阶贡献为 $t(\\tau) \\cdot \\alpha \\cdot r(\\tau) \\cdot \\alpha \\cdot t(\\tau) = \\alpha^2 r(\\tau) t(\\tau)^2$。\n4.  随后的每一项代表在云层-表面系统内的一次额外内部反射。第 $k$ 项（对于 $k \\ge 1$）对应于 $k-1$ 次内部反射，由 $\\alpha^k r(\\tau)^{k-1} t(\\tau)^2$ 给出。\n\n将所有贡献相加得到总反射率：\n$$\nR(\\tau, \\alpha) = r(\\tau) + \\alpha t(\\tau)^2 + \\alpha^2 r(\\tau) t(\\tau)^2 + \\alpha^3 r(\\tau)^2 t(\\tau)^2 + \\dots\n$$\n从第二项开始的各项形成一个几何级数。我们可以提出公因子 $\\alpha t(\\tau)^2$：\n$$\nR(\\tau, \\alpha) = r(\\tau) + \\alpha t(\\tau)^2 \\left(1 + \\alpha r(\\tau) + (\\alpha r(\\tau))^2 + \\dots \\right)\n$$\n该级数为 $\\sum_{k=0}^{\\infty} (\\alpha r(\\tau))^k$。为使其收敛，公比的绝对值必须小于1。由于 $r(\\tau) \\in [0, 1)$ 且 $\\alpha \\in [0, 1)$，条件 $|\\alpha r(\\tau)|  1$ 得到满足。该几何级数的和为 $\\frac{1}{1 - \\alpha r(\\tau)}$。\n\n将和代回，我们得到：\n$$\nR(\\tau, \\alpha) = r(\\tau) + \\frac{\\alpha t(\\tau)^2}{1 - \\alpha r(\\tau)}\n$$\n使用非吸收假设 $t(\\tau) = 1 - r(\\tau)$，我们有：\n$$\nR(\\tau, \\alpha) = r(\\tau) + \\frac{\\alpha (1 - r(\\tau))^2}{1 - \\alpha r(\\tau)}\n$$\n这是该系统 TOA 反射率的闭式表达式。对于 $\\tau=0$ 的晴空柱特殊情况，根据反射率函数定义有 $r(0)=0$。将此代入公式得到 $R(0, \\alpha) = 0 + \\frac{\\alpha(1-0)^2}{1-0} = \\alpha$，这正确地恢复了下垫面反照率，正如预期。\n\n在实现中，问题指定反射率函数为 $r(\\tau) = \\dfrac{\\tau}{\\tau+\\gamma}$，其中 $\\gamma$ 是给定的正常数。\n\n### 2. 重叠闭合方案的反照率公式构建\n\n独立柱近似（ICA）指出，区域平均的 TOA 反照率是各独立子柱反照率的总和，按其面积分数加权。\n\n#### A. 最大重叠闭合方案\n\n在最大重叠闭合方案中，假设所有云层的云部分是垂直对齊的。这将区域划分为两个子柱：一个完全有云，一个完全晴空。\n\n-   **云子柱**：此子柱的面积分数由任何层中的最大云量决定，$C_{\\mathrm{max}} = \\max(\\{c_i\\}_{i=1}^N)$。所有云层中的云是堆叠的，因此它们的光学厚度相加，得到总光学厚度 $\\tau_{\\mathrm{sum}} = \\sum_{i=1}^N \\tau_i$。该柱的反照率是 $A_{\\mathrm{cld}} = R(\\tau_{\\mathrm{sum}}, \\alpha_{\\mathrm{clr}})$，其中 $\\alpha_{\\mathrm{clr}}$ 是晴空反照率。\n-   **晴空子柱**：区域的剩余部分 $1 - C_{\\mathrm{max}}$ 是完全晴朗的。此子柱的反照率就是 $\\alpha_{\\mathrm{clr}}$。\n\n总的区域平均反照率 $A_{\\mathrm{max}}$ 是面积加权平均值：\n$$\nA_{\\mathrm{max}} = C_{\\mathrm{max}} \\cdot R(\\tau_{\\mathrm{sum}}, \\alpha_{\\mathrm{clr}}) + (1 - C_{\\mathrm{max}}) \\cdot \\alpha_{\\mathrm{clr}}\n$$\n\n#### B. 随机重叠闭合方案\n\n在随机重叠闭合方案中，每层云的存在是统计上独立的。对于一个有 $N$ 层的系统，这会产生 $2^N$ 个独特的大气子柱，对应于云层和晴空层的每一种可能组合。\n\n每个子柱可以通过一个二进制向量 $S = (s_1, s_2, \\dots, s_N)$ 来索引，其中如果第 $i$ 层有云，则 $s_i=1$，如果晴朗，则 $s_i=0$。\n\n-   **子柱面积分数**：由于独立性假设，一个子柱 $S$ 的概率（面积分数）是各个层概率的乘积：\n    $$\n    P(S) = \\prod_{i=1}^N \\left( (c_i)^{s_i} (1-c_i)^{1-s_i} \\right)\n    $$\n-   **子柱光学厚度**：一个子柱 $S$ 的总光学厚度是其云层光学厚度的总和：\n    $$\n    \\tau_S = \\sum_{i=1}^N s_i \\tau_i\n    $$\n-   **子柱反照率**：子柱 $S$ 的反照率由 $A_S = R(\\tau_S, \\alpha_{\\mathrm{clr}})$ 给出。\n\n总的区域平均反照率 $A_{\\mathrm{rnd}}$ 是所有子柱反照率按其面积分数加权的总和：\n$$\nA_{\\mathrm{rnd}} = \\sum_{S \\in \\{0,1\\}^N} P(S) \\cdot A_S = \\sum_{S \\in \\{0,1\\}^N} \\left[ \\left( \\prod_{i=1}^N (c_i)^{s_i} (1-c_i)^{1-s_i} \\right) \\cdot R\\left( \\sum_{i=1}^N s_i \\tau_i, \\alpha_{\\mathrm{clr}} \\right) \\right]\n$$\n\n### 3. $\\Delta A = A_{\\mathrm{max}} - A_{\\mathrm{rnd}}$ 的计算\n\n最后一步是为每个提供的测试用例实现推导出的 $A_{\\mathrm{max}}$ 和 $A_{\\mathrm{rnd}}$ 公式。然后将计算并报告差异 $\\Delta A$。实现过程将首先定义 $r(\\tau)$ 和 $R(\\tau, \\alpha)$ 的函数，然后基于上述逻辑构建计算 $A_{\\mathrm{max}}$ 和 $A_{\\mathrm{rnd}}$ 的函数。随机重叠的计算涉及遍历所有 $2^N$ 种可能的云配置。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries outside the standard library or specified versions are permitted.\n\ndef solve():\n    \"\"\"\n    Computes and prints the difference in top-of-atmosphere albedo between\n    maximum and random overlap cloud closure assumptions for a set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: General multi-layer\n        ({'cs': [0.2, 0.5, 0.1], 'taus': [5.0, 10.0, 0.5], 'alpha_clr': 0.08, 'gamma': 7.7}),\n        # Case 2: No clouds, boundary\n        ({'cs': [0.0, 0.0], 'taus': [1.0, 20.0], 'alpha_clr': 0.10, 'gamma': 7.7}),\n        # Case 3: Fully cloudy, boundary\n        ({'cs': [1.0, 1.0], 'taus': [3.0, 3.0], 'alpha_clr': 0.06, 'gamma': 7.7}),\n        # Case 4: Thin over thick\n        ({'cs': [0.5, 0.5], 'taus': [0.2, 15.0], 'alpha_clr': 0.10, 'gamma': 7.7}),\n        # Case 5: Alternating high-low fractions\n        ({'cs': [0.9, 0.1, 0.9, 0.1], 'taus': [20.0, 1.0, 15.0, 1.0], 'alpha_clr': 0.12, 'gamma': 7.7})\n    ]\n\n    results = []\n    \n    # Define physical functions based on the problem derivation\n    def r_func(tau, gamma):\n        \"\"\"Calculates cloudy slab reflectance.\"\"\"\n        if tau == 0:\n            return 0.0\n        return tau / (tau + gamma)\n\n    def R_func(tau, alpha_clr, gamma):\n        \"\"\"\n        Calculates top-of-atmosphere reflectance for a cloudy slab over a reflector\n        using the two-stream adding formula.\n        \"\"\"\n        if tau == 0:\n            return alpha_clr\n        \n        reflectance = r_func(tau, gamma)\n        # Assuming no absorption, transmittance t = 1 - r\n        transmittance = 1.0 - reflectance\n        \n        # Derived formula: R = r + (alpha * t^2) / (1 - alpha * r)\n        denominator = 1.0 - alpha_clr * reflectance\n        if denominator == 0:\n            # Physically unrealistic case, but for robustness\n            return 1.0 \n        \n        total_reflectance = reflectance + (alpha_clr * transmittance**2) / denominator\n        return total_reflectance\n\n    for case in test_cases:\n        cs = case['cs']\n        taus = case['taus']\n        alpha_clr = case['alpha_clr']\n        gamma = case['gamma']\n        \n        N = len(cs)\n\n        # --- Calculate A_max (Maximum Overlap) ---\n        if not cs:\n            C_max = 0.0\n        else:\n            C_max = max(cs) if cs else 0.0\n        \n        tau_sum = sum(taus)\n        \n        # Albedo of the single cloudy column\n        A_cld_max = R_func(tau_sum, alpha_clr, gamma)\n        \n        # Area-weighted total albedo\n        A_max = C_max * A_cld_max + (1.0 - C_max) * alpha_clr\n\n        # --- Calculate A_rnd (Random Overlap) ---\n        A_rnd = 0.0\n        if N > 0:\n            # Iterate through all 2^N possible subcolumns\n            for k in range(2**N):\n                prob_k = 1.0\n                tau_k = 0.0\n                for i in range(N):\n                    # Check if the i-th layer is cloudy in this subcolumn\n                    if (k >> i)  1:\n                        # Layer i is cloudy\n                        prob_k *= cs[i]\n                        tau_k += taus[i]\n                    else:\n                        # Layer i is clear\n                        prob_k *= (1.0 - cs[i])\n                \n                # If probability of a column is zero, it doesn't contribute\n                if prob_k > 0:\n                    A_k = R_func(tau_k, alpha_clr, gamma)\n                    A_rnd += prob_k * A_k\n        else: # No layers\n            A_rnd = alpha_clr\n\n        # Calculate the difference and store result\n        delta_A = A_max - A_rnd\n        results.append(delta_A)\n\n    # Format output as a string with results rounded to six decimal places.\n    # Using f-string formatting to ensure trailing zeros.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}