{
    "hands_on_practices": [
        {
            "introduction": "任何建模工作的核心都是从基本物理原理出发，建立并求解描述系统行为的方程。本练习将指导你通过质量守恒原理，为一个简单的零维“箱式模型”构建控制方程，并推导出其解析解。掌握这一过程不仅是理解模型动态（如稳态和响应时间）的基础，也为后续更复杂的数值模拟提供了理论基准。",
            "id": "3933279",
            "problem": "考虑一个用于环境和地球系统建模的零维、充分混合的储库模型，其中标量广延量 $X(t)$ 代表一个固定体积箱体中示踪剂的总质量。量 $X(t)$ 的演变由一个速率为 $S$ 的恒定外部源和一个速率常数为 $k$ 的一阶损失过程驱动。使用质量守恒定律为 $X(t)$ 建立控制常微分方程 (ODE)。然后，不使用预先记下的公式，推导并直接代入验证满足初始条件 $X(0)=X_0$（其中 $X_0$ 是一个指定的有限常数）的唯一解 $X(t)$ 的闭式解析表达式。\n\n最后，施加具有物理意义的约束条件，即解在所有 $t \\geq 0$ 的情况下保持有限，并且在所有 $t \\geq 0$ 的情况下 $X(t) \\geq 0$。推导参数 $k$、$S$ 和初始条件 $X_0$ 为满足这些约束条件所需的一致性要求。以闭式形式提供 $X(t)$ 的解析表达式作为最终答案。不要进行数值计算。",
            "solution": "该问题要求为一个零维储库模型建立并求解一个微分方程，验证其解，并根据物理约束推导参数的一致性要求。\n\n首先，我们验证问题陈述的有效性。\n\n**第一步：提取已知条件**\n- 模型：零维、充分混合的储库，用于描述标量广延量 $X(t)$，即示踪剂的总质量。\n- 体积：固定。\n- 输入：速率为 $S$ 的恒定外部源。\n- 输出：速率常数为 $k$ 的一阶损失过程。\n- 控制原理：质量守恒。\n- 初始条件：$X(0) = X_0$，其中 $X_0$ 是一个指定的有限常数。\n- 约束1：解 $X(t)$ 在所有 $t \\geq 0$ 的情况下必须保持有限。\n- 约束2：解 $X(t)$ 必须为非负值，$X(t) \\geq 0$，适用于所有 $t \\geq 0$。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题描述了一个经典的房室或箱式模型，这是环境科学、药代动力学和化学工程中的一个基本工具。它基于质量守恒原理，这是物理学和化学的基石。源项和汇项（恒定流入、一阶衰减）是许多自然和工程过程中标准且物理上现实的表示方法。该问题在科学上是合理的。\n- **适定性：** 任务是求解一个带给定初始条件的一阶线性常微分方程。这构成了一个标准的初值问题 (IVP)，已知其具有唯一且稳定的解。\n- **客观性：** 该问题使用精确、明确的数学和物理术语陈述。没有主观或基于意见的元素。\n\n**第三步：结论与行动**\n该问题具有科学依据、适定、客观且内部一致。这是一个有效的问题。我们可以继续进行求解。\n\n**第一部分：建立控制 ODE**\n质量守恒原理指出，示踪剂质量的变化率 $\\frac{dX}{dt}$ 等于进入系统的质量速率减去离开系统的质量速率。\n进入的质量速率由一个恒定源 $S$ 给出。\n离开的质量速率是由一个一阶损失过程引起的。这意味着损失速率与存在的示踪剂量 $X(t)$ 成正比。因此，损失速率为 $kX(t)$。\n综合这些项，我们建立控制常微分方程 (ODE)：\n$$\n\\frac{dX(t)}{dt} = S - kX(t)\n$$\n\n**第二部分：求解 ODE**\n该 ODE 可以重写为一阶线性微分方程的标准形式：\n$$\n\\frac{dX}{dt} + kX = S\n$$\n我们使用积分因子法求解此方程，积分因子为 $I(t)$。积分因子定义为 $I(t) = \\exp\\left(\\int k \\, dt\\right)$。由于 $k$ 是常数，这可以简化为 $I(t) = \\exp(kt)$。\n将整个 ODE 乘以积分因子 $I(t)$：\n$$\n\\exp(kt) \\frac{dX}{dt} + k \\exp(kt) X = S \\exp(kt)\n$$\n根据微分的乘法法则，该方程的左侧是乘积 $X(t) \\exp(kt)$ 的导数：\n$$\n\\frac{d}{dt} \\left( X(t) \\exp(kt) \\right) = S \\exp(kt)\n$$\n为了求出 $X(t)$，我们对两边关于时间 $t$ 积分：\n$$\n\\int \\frac{d}{dt} \\left( X(t) \\exp(kt) \\right) dt = \\int S \\exp(kt) dt\n$$\n这得到：\n$$\nX(t) \\exp(kt) = \\frac{S}{k} \\exp(kt) + C\n$$\n其中 $C$ 是积分常数。请注意，此步骤假设 $k \\neq 0$。$k=0$ 的情况将在约束分析中考虑。\n为了求出 $X(t)$ 的显式解，我们两边除以 $\\exp(kt)$：\n$$\nX(t) = \\frac{S}{k} + C \\exp(-kt)\n$$\n现在，我们应用初始条件 $X(0) = X_0$ 来确定常数 $C$。\n$$\nX(0) = \\frac{S}{k} + C \\exp(-k \\cdot 0) = \\frac{S}{k} + C\n$$\n将此结果设为等于 $X_0$：\n$$\nX_0 = \\frac{S}{k} + C \\implies C = X_0 - \\frac{S}{k}\n$$\n将 $C$ 的这个表达式代回通解，得到该初值问题的唯一解：\n$$\nX(t) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)\n$$\n\n**第三部分：验证解**\n我们通过直接代入原始 ODE 和检查初始条件来验证此解。\n首先，我们计算解 $X(t)$ 的导数：\n$$\n\\frac{dX}{dt} = \\frac{d}{dt} \\left[ \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt) \\right] = 0 + \\left(X_0 - \\frac{S}{k}\\right) (-k \\exp(-kt)) = -k \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)\n$$\n现在，将 $X(t)$ 和 $\\frac{dX}{dt}$ 代入 ODE $\\frac{dX}{dt} = S - kX$。\n左侧 (LHS) 是：\n$$\n\\text{LHS} = -k \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)\n$$\n右侧 (RHS) 是：\n$$\n\\text{RHS} = S - k \\left[ \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt) \\right] = S - S - k \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt) = -k \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)\n$$\n由于 LHS = RHS，该解满足 ODE。\n接下来，我们检查 $t=0$ 时的初始条件：\n$$\nX(0) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-k \\cdot 0) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\cdot 1 = \\frac{S}{k} + X_0 - \\frac{S}{k} = X_0\n$$\n初始条件也得到满足。验证成功。\n\n**第四部分：来自约束的一致性要求**\n我们必须推导参数 $k$、$S$ 和 $X_0$ 为满足两个物理约束条件所需的要求。\n\n**约束1：$X(t)$ 在所有 $t \\geq 0$ 的情况下必须是有限的。**\n解为 $X(t) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)$。当 $t$ 很大时，其行为由项 $\\exp(-kt)$ 决定。\n- 如果 $k  0$：当 $t \\to \\infty$ 时，$\\exp(-kt) \\to 0$。解 $X(t)$ 趋近于一个有限的稳态值 $X_{ss} = \\frac{S}{k}$。对于任何有限的 $t \\geq 0$，$\\exp(-kt)$ 是有限的，因此 $X(t)$ 也是有限的。这种情况与约束一致。\n- 如果 $k  0$：令 $k = -\\alpha$，其中 $\\alpha  0$。解变为 $X(t) = -\\frac{S}{\\alpha} + \\left(X_0 + \\frac{S}{\\alpha}\\right) \\exp(\\alpha t)$。当 $t \\to \\infty$ 时，项 $\\exp(\\alpha t)$ 无界增长。除非系数 $\\left(X_0 + \\frac{S}{\\alpha}\\right)$ 恰好为零，否则 $X(t)$ 将发散到 $\\pm\\infty$。这违反了有限性约束。一个物理上描述的“损失过程”不能有负的速率常数，因为那将代表指数增长。\n- 如果 $k = 0$：原始 ODE 变为 $\\frac{dX}{dt} = S$。对其积分得到 $X(t) = St + C$。根据 $X(0) = X_0$，我们得到 $X(t) = St + X_0$。如果 $S \\neq 0$，当 $t \\to \\infty$ 时，$X(t)$ 会线性无界增长或减少，违反有限性约束。如果 $S=0$，则 $X(t)=X_0$，这是有限的。\n为保证解对于任意物理上合理的初始条件和源在所有 $t \\geq 0$ 时都有限，我们必须有 $k  0$。\n\n**约束2：$X(t) \\geq 0$ 适用于所有 $t \\geq 0$。**\n由于 $X(t)$ 代表质量，它必须是非负的。这从第一性原理上对参数施加了约束：\n- 初始质量必须为非负：$X_0 \\geq 0$。\n- 源速率（质量增加）必须为非负：$S \\geq 0$。\n- 损失速率常数必须为非负。结合有限性要求，这意味着我们必须有 $k  0$。\n\n让我们验证这三个条件（$X_0 \\geq 0$，$S \\geq 0$，$k  0$）是否足以保证在所有 $t \\geq 0$ 的情况下 $X(t) \\geq 0$。解为 $X(t) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)$。\n我们通过考虑 $X(t)$ 在 $t \\geq 0$ 时的最小值来分析其行为。其导数为 $\\frac{dX}{dt} = k\\left(\\frac{S}{k} - X_0\\right)\\exp(-kt)$。由于 $k0$ 和 $\\exp(-kt)0$，导数的符号是恒定的，由 $(\\frac{S}{k} - X_0)$ 的符号决定。\n- 情况A：$X_0  \\frac{S}{k}$。此时 $\\frac{dX}{dt}  0$，因此 $X(t)$ 是单调递增的。其最小值出现在 $t=0$ 处，即 $X(0) = X_0$。由于我们要求 $X_0 \\geq 0$，该函数始终为非负。\n- 情况B：$X_0  \\frac{S}{k}$。此时 $\\frac{dX}{dt}  0$，因此 $X(t)$ 是单调递减的。它从 $X_0$ 开始，并在 $t \\to \\infty$ 时趋近于渐近值 $X_{ss} = \\frac{S}{k}$。最小值是极限 $\\lim_{t\\to\\infty} X(t) = \\frac{S}{k}$。由于我们要求 $S \\geq 0$ 和 $k  0$，这个极限是非负的（$\\frac{S}{k} \\geq 0$）。因此，$X(t)$ 始终保持非负。\n- 情况C：$X_0 = \\frac{S}{k}$。此时 $\\frac{dX}{dt} = 0$，因此对于所有 $t$，$X(t) = X_0 = \\frac{S}{k}$。由于 $X_0 \\geq 0$，该函数始终为非负。\n\n在所有情况下，条件 $X_0 \\geq 0$，$S \\geq 0$ 和 $k  0$ 都足以确保在所有 $t \\geq 0$ 的情况下 $X(t) \\geq 0$。\n\n因此，具有物理意义的参数一致性要求是：\n$$\nk  0, \\quad S \\geq 0, \\quad X_0 \\geq 0\n$$\n\n问题要求以闭式解析表达式的形式给出 $X(t)$ 作为最终答案。\n$$\nX(t) = \\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)\n$$\n此表达式在推导的一致性要求下有效。",
            "answer": "$$\n\\boxed{\\frac{S}{k} + \\left(X_0 - \\frac{S}{k}\\right) \\exp(-kt)}\n$$"
        },
        {
            "introduction": "虽然解析解能提供深刻的洞察，但大多数真实世界的环境模型都过于复杂，必须依赖数值方法求解。本练习将带你从连续的微分方程过渡到离散的计算机模拟，并探讨最简单的数值积分方法——前向欧拉法。通过分析，你将亲手推导出数值稳定性的关键条件，理解时间步长的选择如何直接决定模拟结果的物理真实性。",
            "id": "3933251",
            "problem": "考虑一个常用于环境箱式模型中的零维线性弛豫模型，其中标量示踪物 $X(t)$ 根据常微分方程 (ODE) $\\,\\frac{dX}{dt}=-k\\,X\\,$（其中 $\\,k0\\,$ 为常数）向零弛豫。使用显式前向欧拉时间离散作为在时间上推进 $X$ 的数值方法。\n\n(a) 通过分析应用于线性常微分方程 $\\,\\frac{dX}{dt}=-k\\,X\\,$ 的前向欧拉更新的离散时间放大因子，推导关于时间步长 $\\,\\Delta t\\,$ 和速率常数 $\\,k\\,$ 的实负特征值的稳定域。将稳定域解释为所有能保证对于任意初始值 $\\,X_0\\,$，数值解 $\\,X_n\\,$ 渐近衰减至零的 $\\,\\Delta t\\,$ 值的集合。\n\n(b) 使用你的稳定性条件，确定对于以下每个速率常数，允许的最大均匀时间步长 $\\,\\Delta t_{\\max}\\,$：\n- $\\,k_1=0.15\\,\\mathrm{day}^{-1}\\,$,\n- $\\,k_2=2.0\\,\\mathrm{day}^{-1}\\,$,\n- $\\,k_3=1.0\\times 10^{-4}\\,\\mathrm{s}^{-1}\\,$.\n\n将每个 $\\,\\Delta t_{\\max}\\,$ 以小时为单位表示，并将你的答案四舍五入到四位有效数字。",
            "solution": "基本依据是零维弛豫过程的线性检验方程，$\\,\\frac{dX}{dt}=-k\\,X\\,$，其中 $\\,k0\\,$。显式前向欧拉法通过计算当前状态和时间的趋势项，将解从 $\\,t_n\\,$ 推进到 $\\,t_{n+1}=t_n+\\Delta t\\,$。将前向欧拉法应用于该线性常微分方程，得到以下形式的线性递推关系\n$$\nX_{n+1} \\;=\\; X_n + \\Delta t\\,\\left(-k\\,X_n\\right) \\;=\\; \\left(1 - k\\,\\Delta t\\right)\\,X_n \\,.\n$$\n定义放大因子 $\\,G\\,$ 为\n$$\nG \\;\\equiv\\; \\frac{X_{n+1}}{X_n} \\;=\\; 1 - k\\,\\Delta t \\,.\n$$\n为了数值解渐近衰减意义下的线性稳定性，我们要求重复应用更新会减小 $\\,X_n\\,$ 的量级，这等价于\n$$\n|G|  1 \\,.\n$$\n代入 $\\,G=1-k\\,\\Delta t\\,$ 得到不等式\n$$\n|\\,1 - k\\,\\Delta t\\,|  1 \\,.\n$$\n因为 $\\,k0\\,$ 且 $\\,\\Delta t0\\,$，我们通过将其展开为双重不等式来求解该不等式：\n$$\n-1  1 - k\\,\\Delta t  1 \\,.\n$$\n所有部分减去 $\\,1\\,$ 得到\n$$\n-2  -\\,k\\,\\Delta t  0 \\,,\n$$\n并且所有部分乘以 $-1$ 会反转不等号，\n$$\n0  k\\,\\Delta t  2 \\,.\n$$\n由于 $\\,k0\\,$，这等价于\n$$\n0  \\Delta t  \\frac{2}{k} \\,.\n$$\n因此，对于 $\\,k0\\,$，应用于 $\\,\\frac{dX}{dt}=-k\\,X\\,$ 的显式欧拉法的稳定域是满足 $\\,0  \\Delta t  2/k\\,$ 的时间步长 $\\,\\Delta t\\,$ 的集合。中性稳定性的边界出现在 $\\,\\Delta t=2/k\\,$ 处，此时 $\\,|G|=1\\,$。\n\n接下来，为每个给定的 $\\,k\\,$ 计算 $\\,\\Delta t_{\\max}=\\frac{2}{k}\\,$，并将结果以小时为单位表示。\n\n1. 对于 $\\,k_1 = 0.15\\,\\mathrm{day}^{-1}\\,$，\n$$\n\\Delta t_{\\max}^{(1)} \\;=\\; \\frac{2}{0.15}\\;\\mathrm{day} \\;=\\; 13.\\overline{3}\\;\\mathrm{day} \\,.\n$$\n使用 $\\,1\\,\\mathrm{day}=24\\,\\mathrm{h}\\,$ 将天转换为小时：\n$$\n\\Delta t_{\\max}^{(1)} \\;=\\; 13.\\overline{3}\\times 24 \\;\\mathrm{h} \\;=\\; 320\\;\\mathrm{h} \\,.\n$$\n四舍五入到四位有效数字：$\\,320.0\\,$。\n\n2. 对于 $\\,k_2 = 2.0\\,\\mathrm{day}^{-1}\\,$，\n$$\n\\Delta t_{\\max}^{(2)} \\;=\\; \\frac{2}{2.0}\\;\\mathrm{day} \\;=\\; 1\\;\\mathrm{day} \\;=\\; 24\\;\\mathrm{h} \\,.\n$$\n四舍五入到四位有效数字：$\\,24.00\\,$。\n\n3. 对于 $\\,k_3 = 1.0\\times 10^{-4}\\,\\mathrm{s}^{-1}\\,$，\n$$\n\\Delta t_{\\max}^{(3)} \\;=\\; \\frac{2}{1.0\\times 10^{-4}}\\;\\mathrm{s} \\;=\\; 2.0\\times 10^{4}\\;\\mathrm{s} \\,.\n$$\n使用 $\\,1\\,\\mathrm{h}=3600\\,\\mathrm{s}\\,$ 将秒转换为小时：\n$$\n\\Delta t_{\\max}^{(3)} \\;=\\; \\frac{2.0\\times 10^{4}}{3600}\\;\\mathrm{h} \\;=\\; \\frac{20000}{3600}\\;\\mathrm{h} \\;=\\; 5.\\overline{5}\\;\\mathrm{h} \\approx 5.555\\ldots\\;\\mathrm{h} \\,.\n$$\n四舍五入到四位有效数字：$\\,5.556\\,$。\n\n因此，对于这三种情况，以小时为单位的最大稳定前向欧拉时间步长分别为 $\\,320.0\\,$、$\\,24.00\\,$ 和 $\\,5.556\\,$。",
            "answer": "$$\\boxed{\\begin{pmatrix}320.0  24.00  5.556\\end{pmatrix}}$$"
        },
        {
            "introduction": "模型的最终价值在于其解释和预测现实世界现象的能力，而这需要通过“校准”过程将模型与观测数据对齐。本练习是一个综合性的编程任务，你将使用一个简化的碳循环模型，并通过普通最小二乘法（OLS）根据合成数据来估计其关键参数。这个过程不仅能让你掌握模型校准的核心技术，还将引导你思考参数可识别性这一高级问题，即我们拥有的数据是否足以唯一地确定模型的参数。",
            "id": "3933316",
            "problem": "考虑一个将大气表示为单个均匀混合储库的零维碳循环模型。设 $x(t)$ 表示相对于一个固定的工业化前基线的大气二氧化碳浓度异常，单位为百万分率 (PPM)，设 $E(t)$ 表示人为二氧化碳排放，单位为十亿吨碳/年 (GtC/yr)。假设以下基于单箱储库和线性吸收的线性质量平衡模型：\n$$\\frac{dx}{dt} = -\\gamma x(t) + k E(t),$$\n其中，$k$ 是排放-浓度转换因子，单位为 $\\text{PPM}/\\text{GtC}$，$\\gamma$ 是大气调整速率，单位为 $\\text{yr}^{-1}$。该模型是一个零维表示，忽略了空间异质性和内部自由度，同时捕捉了与碳汇的主要交换。\n\n您的任务是编写一个完整、可运行的程序，使用普通最小二乘法 (OLS) 从离散采样的排放和浓度观测数据中校准 $k$ 和 $\\gamma$。使用时间步长 $\\Delta t = 1$ 年的前向欧拉法离散化控制方程，以获得一个适合对连续年份差异进行线性回归的关系。假设可用的浓度观测值为 $c_t$ (单位为 PPM)，它是真实值 $x_t$ 加上一个确定性的测量-模型偏差 $\\eta_t$。程序必须通过最小化与模型所蕴含的离散时间回归一致的残差平方和，来为每个测试案例估计 $k$ (单位为 $\\text{PPM}/\\text{GtC}$) 和 $\\gamma$ (单位为 $\\text{yr}^{-1}$)。任何三角函数中的角度都必须以弧度处理。\n\n为了研究可识别性限制，还需为每个测试案例计算一个无量纲的数值可识别性分数，该分数定义为最小二乘拟合中使用的设计矩阵的条件数。较大的条件数表示更严重的病态和较差的可识别性。使用标准的2-范数条件数。\n\n使用以下一套综合但科学上合理的测试用例。在所有情况下，使用初始条件 $x_0 = 0$ PPM，年度时间步长 $\\Delta t = 1$ 年，并使用离散化模型根据排放强迫 $E_t$ 和真实参数正向构建 $x_t$。然后，通过 $c_t = x_t + \\eta_t$ 形成观测值。所有三角函数参数必须以弧度为单位。\n\n- 案例A（一般的“理想路径”）：时长 $T = 60$ 年，真实参数 $k_\\text{true} = 0.45$ $\\text{PPM}/\\text{GtC}$ 和 $\\gamma_\\text{true} = 0.02$ $\\text{yr}^{-1}$。排放强迫\n$$E_t = 5 + 0.08 t + 0.5 \\sin(0.2 t)\\ \\text{GtC/yr},$$\n测量-模型偏差\n$$\\eta_t = 0.05 \\sin(0.3 t)\\ \\text{PPM}.$$\n\n- 案例B（由于近似恒定的强迫导致可识别性受限）：时长 $T = 60$ 年，真实参数 $k_\\text{true} = 0.47$ $\\text{PPM}/\\text{GtC}$ 和 $\\gamma_\\text{true} = 0.03$ $\\text{yr}^{-1}$。排放强迫\n$$E_t = 8 + 0.2 \\sin(0.1 t)\\ \\text{GtC/yr},$$\n测量-模型偏差\n$$\\eta_t = 0.02 \\sin(0.5 t)\\ \\text{PPM}.$$\n\n- 案例C（短记录边界条件）：时长 $T = 10$ 年，真实参数 $k_\\text{true} = 0.45$ $\\text{PPM}/\\text{GtC}$ 和 $\\gamma_\\text{true} = 0.02$ $\\text{yr}^{-1}$。排放强迫\n$$E_t = 6 + 0.1 t\\ \\text{GtC/yr},$$\n测量-模型偏差\n$$\\eta_t = 0.05 \\sin(0.4 t)\\ \\text{PPM}.$$\n\n- 案例D（带噪声的观测）：时长 $T = 60$ 年，真实参数 $k_\\text{true} = 0.45$ $\\text{PPM}/\\text{GtC}$ 和 $\\gamma_\\text{true} = 0.02$ $\\text{yr}^{-1}$。排放强迫\n$$E_t = 5 + 0.08 t + 0.5 \\sin(0.2 t)\\ \\text{GtC/yr},$$\n测量-模型偏差\n$$\\eta_t = 0.2 \\sin(0.7 t) + 0.1 \\cos(0.2 t)\\ \\text{PPM}.$$\n\n在每种情况下，通过以下方式构建离散状态\n$$x_{t+1} = x_t + \\Delta t\\left(-\\gamma_\\text{true} x_t + k_\\text{true} E_t\\right),$$\n并通过以下方式构建观测浓度\n$$c_t = x_t + \\eta_t.$$\n\n根据观测序列 $\\{c_t\\}_{t=0}^T$ 和排放序列 $\\{E_t\\}_{t=0}^{T-1}$，构建一个与前向欧拉离散化一致的线性回归，通过普通最小二乘法 (OLS) 估计 $k$ 和 $\\gamma$。同时，计算回归设计矩阵的条件数作为可识别性分数。\n\n您的程序应生成单行输出，其中包含每个案例的估计 $k$ (单位为 $\\text{PPM}/\\text{GtC}$)、估计 $\\gamma$ (单位为 $\\text{yr}^{-1}$) 和条件数（无量纲），按 A、B、C、D 的顺序展平，作为一个用方括号括起来的逗号分隔列表。例如，输出格式必须是\n$$[k_A,\\gamma_A,\\kappa_A,k_B,\\gamma_B,\\kappa_B,k_C,\\gamma_C,\\kappa_C,k_D,\\gamma_D,\\kappa_D],$$\n其中每个符号表示一个实数（浮点数）。不应打印任何其他文本。",
            "solution": "用户要求使用普通最小二乘法 (OLS) 校准一个零维碳循环模型。第一步是根据给定的连续模型及其离散化形式，构建一个线性回归问题。\n\n大气二氧化碳异常 $x(t)$ 的控制微分方程为：\n$$\n\\frac{dx}{dt} = -\\gamma x(t) + k E(t)\n$$\n其中 $\\gamma$ 是大气调整速率， $k$ 是排放-浓度转换因子， $E(t)$ 是排放强迫。\n\n问题指定使用时间步长 $\\Delta t = 1$ 年的前向欧拉法来离散化此方程。离散形式为：\n$$\n\\frac{x_{t+1} - x_t}{\\Delta t} = -\\gamma x_t + k E_t\n$$\n鉴于 $\\Delta t = 1$，这可以简化为：\n$$\nx_{t+1} - x_t = k E_t - \\gamma x_t\n$$\n这个方程描述了真实但未被观测到的状态 $x_t$ 的演化。可用的数据是观测到的浓度 $c_t$，它通过 $c_t = x_t + \\eta_t$ 与真实状态相关联，其中 $\\eta_t$ 是一个测量-模型偏差。\n\n为了使用可观测量 $\\{c_t\\}$ 和 $\\{E_t\\}$ 进行回归，我们可以将这些可观测量代入离散化的方程中。这是一种常用但非完美的方法。我们用观测值 $c_t$ 近似真实状态 $x_t$，用观测到的变化 $c_{t+1} - c_t$ 近似真实状态的变化 $x_{t+1} - x_t$。这就得到了回归模型：\n$$\nc_{t+1} - c_t \\approx k E_t - \\gamma c_t\n$$\n这个关系可以构建成标准的线性模型形式 $y = X\\beta$。假设回归在时间索引 $t = 0, 1, \\dots, T-1$ 上进行。我们定义：\n- 时间 $t$ 的响应变量为 $y_t = c_{t+1} - c_t$。\n- 时间 $t$ 的预测变量为排放 $E_t$ 和浓度 $c_t$。\n- 待估计的参数向量为 $\\beta = \\begin{pmatrix} \\beta_1 \\\\ \\beta_2 \\end{pmatrix}$。\n\n每个时间步的回归方程为 $y_t = \\beta_1 E_t + \\beta_2 c_t + \\epsilon_t$，其中 $\\epsilon_t$ 是残差。通过与我们推导出的关系进行比较，可以从估计的回归系数 $\\hat{\\beta}_1$ 和 $\\hat{\\beta}_2$ 中识别出模型参数 $k$ 和 $\\gamma$：\n$$\n\\hat{k} = \\hat{\\beta}_1\n$$\n$$\n\\hat{\\gamma} = -\\hat{\\beta}_2\n$$\nOLS 的完整系统以矩阵形式表示。响应向量 $y$ 和设计矩阵 $X$ 构建如下：\n$$\ny = \\begin{pmatrix} c_1 - c_0 \\\\ c_2 - c_1 \\\\ \\vdots \\\\ c_T - c_{T-1} \\end{pmatrix}, \\quad\nX = \\begin{pmatrix} E_0  c_0 \\\\ E_1  c_1 \\\\ \\vdots  \\vdots \\\\ E_{T-1}  c_{T-1} \\end{pmatrix}\n$$\nOLS 估计量 $\\hat{\\beta}$ 是使残差平方和 $S(\\beta) = ||y - X\\beta||_2^2$ 最小化的向量。其解析解由正规方程给出：\n$$\n\\hat{\\beta} = (X^T X)^{-1} X^T y\n$$\n在数值上，使用基于矩阵分解（如奇异值分解 (SVD)）的方法来求解这个系统更为稳定，`numpy.linalg.lstsq` 正是采用了这种方法。\n\n参数估计的一个关键方面是可识别性，它关系到参数是否能从可用数据中唯一确定。在线性回归的背景下，当设计矩阵 $X$ 的列向量近似线性相关（即多重共线性）时，就会出现可识别性差的问题。在这种情况下，矩阵 $X^T X$ 是病态的（接近奇异），使其逆矩阵对数据中的微小变化（如测量噪声）高度敏感。这会导致参数估计具有较大的方差和协方差。\n\n问题要求使用设计矩阵的条件数 $\\kappa(X)$ 来量化这一方面，作为数值可识别性分数。2-范数条件数是 $X$ 的最大奇异值与最小奇异值之比：\n$$\n\\kappa(X) = \\frac{\\sigma_{\\max}(X)}{\\sigma_{\\min}(X)}\n$$\n大的条件数表示 OLS 问题是病态的，因此参数的可识别性很差。这在案例 B 中是预期的，因为其排放强迫 $E_t$ 近似为常数。在这种情况下，所产生的状态 $c_t$ 也将趋于一个近似恒定的稳态，使得设计矩阵的两列 $[E_t]$ 和 $[c_t]$ 近似共线，从而导致一个大的 $\\kappa(X)$。\n\n每个测试案例的总体算法如下：\n1.  根据指定的函数，生成排放强迫的时间序列 $\\{E_t\\}_{t=0}^{T-1}$。\n2.  使用离散化模型 $x_{t+1} = (1 - \\gamma_\\text{true}) x_t + k_\\text{true} E_t$ 和初始条件 $x_0 = 0$，迭代计算真实状态轨迹 $\\{x_t\\}_{t=0}^T$。\n3.  通过将指定的偏差项 $\\eta_t$ 添加到真实状态 $x_t$ 上，生成观测浓度 $\\{c_t\\}_{t=0}^T$。\n4.  使用 $\\{c_t\\}$ 和 $\\{E_t\\}$ 的时间序列构建响应向量 $y$ 和设计矩阵 $X$。\n5.  使用 `numpy.linalg.lstsq` 求解 OLS 参数估计值 $\\hat{\\beta}$。\n6.  从 $\\hat{\\beta}$ 计算估计的物理参数 $\\hat{k}$ 和 $\\hat{\\gamma}$。\n7.  使用 `numpy.linalg.cond` 计算设计矩阵的条件数 $\\kappa(X)$，作为可识别性分数。\n8.  收集所有案例的结果 $(\\hat{k}, \\hat{\\gamma}, \\kappa)$，并按指定格式进行格式化。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calibrates a zero-dimensional carbon cycle model and assesses parameter identifiability\n    for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"T\": 60,\n            \"k_true\": 0.45,\n            \"gamma_true\": 0.02,\n            \"E_func\": lambda t: 5 + 0.08 * t + 0.5 * np.sin(0.2 * t),\n            \"eta_func\": lambda t: 0.05 * np.sin(0.3 * t),\n        },\n        {\n            \"name\": \"B\",\n            \"T\": 60,\n            \"k_true\": 0.47,\n            \"gamma_true\": 0.03,\n            \"E_func\": lambda t: 8 + 0.2 * np.sin(0.1 * t),\n            \"eta_func\": lambda t: 0.02 * np.sin(0.5 * t),\n        },\n        {\n            \"name\": \"C\",\n            \"T\": 10,\n            \"k_true\": 0.45,\n            \"gamma_true\": 0.02,\n            \"E_func\": lambda t: 6 + 0.1 * t,\n            \"eta_func\": lambda t: 0.05 * np.sin(0.4 * t),\n        },\n        {\n            \"name\": \"D\",\n            \"T\": 60,\n            \"k_true\": 0.45,\n            \"gamma_true\": 0.02,\n            \"E_func\": lambda t: 5 + 0.08 * t + 0.5 * np.sin(0.2 * t),\n            \"eta_func\": lambda t: 0.2 * np.sin(0.7 * t) + 0.1 * np.cos(0.2 * t),\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        T = case[\"T\"]\n        k_true = case[\"k_true\"]\n        gamma_true = case[\"gamma_true\"]\n        E_func = case[\"E_func\"]\n        eta_func = case[\"eta_func\"]\n        \n        delta_t = 1.0\n        x0 = 0.0\n\n        # Time vector for states and observations (t=0, ..., T)\n        t_full = np.arange(T + 1)\n        # Time vector for emissions (t=0, ..., T-1)\n        t_emissions = np.arange(T)\n\n        # 1. Generate synthetic data\n        # Emissions forcing E_t for t = 0 to T-1\n        E = E_func(t_emissions)\n\n        # True state x_t for t = 0 to T\n        x = np.zeros(T + 1)\n        x[0] = x0\n        for t in range(T):\n            # Forward Euler step: x_{t+1} = x_t + Delta_t * f(x_t, E_t)\n            # With Delta_t=1: x_{t+1} = x_t + (-gamma_true * x_t + k_true * E_t)\n            x[t+1] = (1 - gamma_true * delta_t) * x[t] + k_true * delta_t * E[t]\n            \n        # Measurement discrepancy eta_t and observed concentration c_t for t = 0 to T\n        eta = eta_func(t_full)\n        c = x + eta\n\n        # 2. Set up and solve the Ordinary Least Squares (OLS) regression\n        # The model is c_{t+1} - c_t approx k*E_t - gamma*c_t\n        # This corresponds to a linear regression y = X * beta\n        \n        # Response vector y = c_{t+1} - c_t for t=0, ..., T-1\n        y = c[1:] - c[:-1]\n        \n        # Design matrix X, where row t is [E_t, c_t] for t=0, ..., T-1\n        X = np.stack([E, c[:-1]], axis=1)\n\n        # Solve for beta = [beta_1, beta_2]^T\n        beta, _, _, _ = np.linalg.lstsq(X, y, rcond=None)\n        \n        # 3. Extract estimated parameters and compute identifiability score\n        # From the model, we identify beta_1 = k and beta_2 = -gamma\n        k_hat = beta[0]\n        gamma_hat = -beta[1]\n\n        # The identifiability score is the condition number of the design matrix X\n        kappa = np.linalg.cond(X)\n\n        # Store results for this case\n        all_results.extend([k_hat, gamma_hat, kappa])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}