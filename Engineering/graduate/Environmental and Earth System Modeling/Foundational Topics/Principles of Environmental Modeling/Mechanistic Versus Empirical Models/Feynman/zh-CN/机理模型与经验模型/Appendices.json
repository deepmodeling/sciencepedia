{
    "hands_on_practices": [
        {
            "introduction": "要真正理解机理模型和经验模型之间的差异，最好的方法之一就是直接对它们进行比较。本练习将引导您剖析蒸散发（evapotranspiration, ET）研究中一个基石性的机理模型——Penman-Monteith方程，并将其与一个简单的基于温度的经验估算模型进行对比。通过推导两者之间的偏差因子，您将深刻地从分析层面理解，简单的经验模型忽略了哪些关键物理过程（如辐射和湿度），以及在何种条件下这种忽略会导致显著的预测误差 。",
            "id": "3892589",
            "problem": "一个陆地冠层在稳态、水平均质且储热可忽略的条件下进行建模。设冠层-地面系统吸收的净辐射为$R_{n}$，地面传导热通量为$G$。地表的能量守恒表明，感热通量$H$与潜热通量$L$之和满足$R_{n} - G = H + L$。潜热通量$L$通过$L = \\lambda E$与蒸散速率$E$相关，其中$\\lambda$是汽化潜热。热量和水汽的空气动力学传输由基于物理的阻力$r_{a}$（空气动力学阻力）和$r_{s}$（地表或冠层阻力）控制。感热通量遵循$H \\propto \\rho c_{p} (T_{s} - T_{a}) / r_{a}$，而水汽传输取决于饱和水汽压差和阻力，其中干湿表常数$\\gamma$将热量和质量传输耦合起来。设$s$表示在空气温度$T$下评估的饱和水汽压曲线相对于温度的斜率，设$D$表示饱和水汽压差。空气密度为$\\rho$，定压比热为$c_{p}$。\n\n从结合了地表能量平衡和带阻力的质量传输的物理Penman–Monteith框架出发，推导一个无量纲蒸散指数$I_{\\mathrm{PM}}$，该指数衡量可用能量$R_{n} - G$转化为潜热的分数，定义为$I_{\\mathrm{PM}} = \\lambda E / (R_{n} - G)$，并用变量$\\{s, \\gamma, D, r_{a}, r_{s}, \\rho, c_{p}, R_{n}, G\\}$表示。\n\n接下来，考虑一个忽略辐射和水汽输送的基于经验温度的蒸散（ET）估算器，其表达式为$E_{\\mathrm{emp}} = \\alpha T^{\\beta}$，其中$\\alpha$和$\\beta$是校准常数，$T$是空气温度。定义一个相应的无量纲经验指数$I_{\\mathrm{emp}} = \\lambda E_{\\mathrm{emp}} / (R_{n} - G)$。推导经验指数和机理指数之间的偏差因子$B$，$B = I_{\\mathrm{emp}} / I_{\\mathrm{PM}}$，作为一个单一的闭式解析表达式，用$\\{ \\alpha, \\beta, T, s, \\gamma, D, r_{a}, r_{s}, \\rho, c_{p}, R_{n}, G, \\lambda \\}$表示。\n\n将$B$的表达式作为最终答案。不需要进行数值评估。如果出现任何中间量纲量，请确保$B$的最终表达式是无量纲的。不要在最终答案中包含单位。如果您决定在解题过程中为说明目的计算数值，请仅使用有效数字指定任何四舍五入；否则，请提供精确的符号表达式。",
            "solution": "该问题要求推导偏差因子$B$，用于比较蒸散的经验模型与机理性的Penman-Monteith框架。偏差因子定义为它们各自无量纲指数的比值，$B = I_{\\mathrm{emp}} / I_{\\mathrm{PM}}$。推导过程分三步进行：首先，推导Penman-Monteith指数$I_{\\mathrm{PM}}$；其次，构建经验指数$I_{\\mathrm{emp}}$；第三，计算它们的比值$B$。\n\n首先，我们使用Penman-Monteith方法推导潜热通量$L = \\lambda E$的表达式。该框架将地表能量平衡与空气动力学和地表阻力原理相结合，以消除通常是未测量变量的地表温度$T_s$。控制方程如下：\n1.  地表能量平衡：$R_n - G = H + L$，其中$R_n$是净辐射，$G$是地表热通量，$H$是感热通量，$L$是潜热通量。\n2.  感热通量：$H = \\frac{\\rho c_p (T_s - T_a)}{r_a}$，其中$\\rho$是空气密度，$c_p$是空气比热，$T_s$是地表温度，$T_a$是空气温度（在问题的经验模型中记为$T$），$r_a$是空气动力学阻力。\n3.  基于水汽输送的潜热通量：$L = \\frac{\\rho c_p}{\\gamma} \\frac{e_s(T_s) - e_a}{r_a + r_s}$，其中$\\gamma$是干湿表常数，$e_s(T_s)$是地表温度下的饱和水汽压，$e_a$是空气的实际水汽压，$r_s$是地表阻力。\n\n$e_s(T_s)$项引入了未知量$T_s$。为了消除它，我们在空气温度$T_a$附近对饱和水汽压函数进行线性化：$e_s(T_s) \\approx e_s(T_a) + s(T_s - T_a)$，其中$s$是$T_a$处的饱和水汽压曲线的斜率。饱和水汽压差定义为$D = e_s(T_a) - e_a$。将这些代入$L$的方程中：\n$$L = \\frac{\\rho c_p}{\\gamma} \\frac{(e_s(T_a) + s(T_s - T_a)) - e_a}{r_a + r_s} = \\frac{\\rho c_p}{\\gamma} \\frac{(e_s(T_a) - e_a) + s(T_s - T_a)}{r_a + r_s}$$\n$$L = \\frac{\\rho c_p}{\\gamma} \\frac{D + s(T_s - T_a)}{r_a + r_s}$$\n我们现在有一个涉及$T_s - T_a$的方程组。从感热通量方程中，我们可以将$T_s - T_a$表示为：\n$$T_s - T_a = \\frac{H r_a}{\\rho c_p}$$\n根据能量平衡，$H = R_n - G - L$。将此代入$T_s - T_a$的表达式中：\n$$T_s - T_a = \\frac{(R_n - G - L)r_a}{\\rho c_p}$$\n现在我们将这个$T_s - T_a$的表达式代回整理后的$L$方程中：\n$$L(r_a + r_s) = \\frac{\\rho c_p}{\\gamma} D + \\frac{\\rho c_p s}{\\gamma}(T_s - T_a)$$\n$$L(r_a + r_s) = \\frac{\\rho c_p D}{\\gamma} + \\frac{\\rho c_p s}{\\gamma} \\frac{(R_n - G - L)r_a}{\\rho c_p}$$\n$$L(r_a + r_s) = \\frac{\\rho c_p D}{\\gamma} + \\frac{s r_a}{\\gamma}(R_n - G - L)$$\n为了解出$L$，我们将所有包含$L$的项组合在一起：\n$$L(r_a + r_s) + L\\frac{s r_a}{\\gamma} = \\frac{s r_a}{\\gamma}(R_n - G) + \\frac{\\rho c_p D}{\\gamma}$$\n$$L\\left(r_a + r_s + \\frac{s r_a}{\\gamma}\\right) = \\frac{s r_a (R_n - G) + \\rho c_p D}{\\gamma}$$\n$$L\\left(\\frac{\\gamma(r_a + r_s) + s r_a}{\\gamma}\\right) = \\frac{s r_a (R_n - G) + \\rho c_p D}{\\gamma}$$\n$$L(\\gamma(r_a + r_s) + s r_a) = s r_a (R_n - G) + \\rho c_p D$$\n$$L = \\frac{s r_a (R_n - G) + \\rho c_p D}{s r_a + \\gamma(r_a + r_s)}$$\n通过将分子和分母同时除以$r_a(s+\\gamma)$，可以得到一个更常见的形式：\n$$L = \\frac{\\frac{s}{s+\\gamma}(R_n-G) + \\frac{\\rho c_p D}{r_a(s+\\gamma)}}{1 + \\frac{\\gamma r_s}{r_a(s+\\gamma)}}$$\n然而，所推导的形式已经足够。为了标准表示，我们在我们推导出的形式的分母中除以$r_a$：\n$$L = \\frac{s r_a (R_n - G) + \\rho c_p D}{r_a(s+\\gamma) + \\gamma r_s}$$\nPenman-Monteith无量纲指数$I_{\\mathrm{PM}}$是用于蒸散的可用能量的分数：\n$$I_{\\mathrm{PM}} = \\frac{L}{R_n - G} = \\frac{1}{R_n - G} \\left( \\frac{s r_a (R_n - G) + \\rho c_p D}{s r_a + \\gamma r_a + \\gamma r_s} \\right)$$\n$$I_{\\mathrm{PM}} = \\frac{s r_a + \\frac{\\rho c_p D}{R_n - G}}{r_a(s+\\gamma) + \\gamma r_s}$$\n\n第二，我们构建经验指数$I_{\\mathrm{emp}}$。问题提供了一个蒸散速率的经验估算器，$E_{\\mathrm{emp}} = \\alpha T^{\\beta}$。相应的潜热通量是$L_{\\mathrm{emp}} = \\lambda E_{\\mathrm{emp}} = \\lambda \\alpha T^{\\beta}$。那么无量纲经验指数是：\n$$I_{\\mathrm{emp}} = \\frac{L_{\\mathrm{emp}}}{R_n - G} = \\frac{\\lambda \\alpha T^{\\beta}}{R_n - G}$$\n\n第三，我们计算偏差因子$B = I_{\\mathrm{emp}} / I_{\\mathrm{PM}}$：\n$$B = \\frac{\\frac{\\lambda \\alpha T^{\\beta}}{R_n - G}}{\\frac{s r_a (R_n - G) + \\rho c_p D}{(R_n - G)(r_a(s+\\gamma) + \\gamma r_s)}}$$\n$$B = \\frac{\\lambda \\alpha T^{\\beta}}{R_n - G} \\times \\frac{(R_n - G)(r_a(s+\\gamma) + \\gamma r_s)}{s r_a (R_n - G) + \\rho c_p D}$$\n分子中的$(R_n - G)$项被约去，得到偏差因子的最终表达式：\n$$B = \\frac{\\lambda \\alpha T^{\\beta} (r_a(s+\\gamma) + \\gamma r_s)}{s r_a (R_n - G) + \\rho c_p D}$$\n这就是用所有指定变量表示的偏差因子$B$的闭式解析表达式。量纲分析证实该表达式是无量纲的，这符合两个无量纲指数之比的预期。",
            "answer": "$$ \\boxed{ \\frac{\\lambda \\alpha T^{\\beta} (r_{a}(s+\\gamma) + \\gamma r_{s})}{s r_{a} (R_{n} - G) + \\rho c_{p} D} } $$"
        },
        {
            "introduction": "在理论比较的基础上，本练习将带您进入计算实践，以探索不同模型的动态行为。您将亲手实现一个简化的机理水文平衡模型和一个线性经验模型，并比较它们对气候输入（降水和温度）的敏感性或弹性。此练习采用了“合成数据”的方法，这在建模中是一种常用技术，用于检验一个模型能否准确地恢复已知的内在关系 。通过这个编码实践，您将具体地看到机理模型的响应如何呈现非线性和状态依赖性，而这正是简单经验模型通常难以捕捉的特性。",
            "id": "3892568",
            "problem": "考虑一个具有每日降水量和温度的水文流域。您将从一个机理模型中计算敏感性指标，并将其与基于该机理模型生成的合成数据所构建的经验回归模型得到的边际效应进行比较。\n\n机理模型基础：\n- 日降水量用 $P$ 表示，单位为 $\\mathrm{mm/day}$；日温度用 $T$ 表示，单位为 $\\mathrm{K}$。\n- 饱和水汽压由 $e_{s}(T) = e_{0} \\exp\\left(\\alpha (T - T_{\\mathrm{ref}})\\right)$ 表示，其中 $e_{0}$ 是一个常数，单位为 $\\mathrm{kPa}$；$\\alpha$ 是一个经验常数，单位为 $\\mathrm{K^{-1}}$；$T_{\\mathrm{ref}}$ 是一个选定的参考温度，单位为 $\\mathrm{K}$。\n- 潜在蒸散发替代量由 $\\mathrm{ET}(T) = k_{\\mathrm{et}} \\, e_{s}(T)$ 给出，其中 $k_{\\mathrm{et}}$ 是一个比例常数，单位为 $\\mathrm{mm/day/kPa}$。\n- 径流被模拟为一个简单的水量平衡模型，径流系数为 $\\phi \\in [0,1]$：$Q = \\phi \\, \\max\\{0, P - \\mathrm{ET}(T)\\}$，其中 $Q$ 的单位是 $\\mathrm{mm/day}$。\n\n敏感性定义：\n- 径流对降水的弹性为 $E_{P} = \\frac{\\partial \\ln Q}{\\partial \\ln P} = \\frac{P}{Q} \\frac{\\partial Q}{\\partial P}$。\n- 径流对温度的弹性为 $E_{T} = \\frac{\\partial \\ln Q}{\\partial \\ln T} = \\frac{T}{Q} \\frac{\\partial Q}{\\partial T}$。\n- 如果在评估点 $Q \\le 0$，则设 $E_{P} = 0$ 且 $E_{T} = 0$。\n\n经验回归基础：\n- 您将通过从指定的正态分布中抽取 $P_{i}$ 和 $T_{i}$，并通过机理模型计算 $Q_{i}$，来生成一个合成数据集 $(P_{i}, T_{i}, Q_{i})$，其中 $i = 1, \\dots, N$。然后，将具有指定标准差的零均值高斯噪声 $\\varepsilon_{i}$ 添加到 $Q_{i}$ 中，以获得 $Q_{i}^{\\mathrm{noisy}} = Q_{i} + \\varepsilon_{i}$。\n- 对合成数据 $(P_{i}, T_{i}, Q_{i}^{\\mathrm{noisy}})$ 拟合一个线性普通最小二乘回归模型 $Q \\approx \\beta_{0} + \\beta_{P} P + \\beta_{T} T$。\n- 降水的经验边际效应是 $\\frac{\\partial Q}{\\partial P} = \\beta_{P}$（单位为 $\\mathrm{mm/day}$ 每 $\\mathrm{mm/day}$），温度的经验边际效应是 $\\frac{\\partial Q}{\\partial T} = \\beta_{T}$（单位为 $\\mathrm{mm/day}$ 每 $\\mathrm{K}$）。\n- 使用拟合的回归模型计算评估点 $(P_{0}, T_{0})$ 的预测径流，$Q_{\\mathrm{hat}} = \\beta_{0} + \\beta_{P} P_{0} + \\beta_{T} T_{0}$。将 $(P_{0}, T_{0})$ 处的经验弹性定义为 $E_{P}^{\\mathrm{emp}} = \\frac{\\beta_{P} P_{0}}{Q_{\\mathrm{hat}}}$ 和 $E_{T}^{\\mathrm{emp}} = \\frac{\\beta_{T} T_{0}}{Q_{\\mathrm{hat}}}$。如果 $Q_{\\mathrm{hat}} \\le 0$，则设 $E_{P}^{\\mathrm{emp}} = 0$ 且 $E_{T}^{\\mathrm{emp}} = 0$。\n\n单位：\n- 降水量 $P$ 和径流 $Q$ 的单位必须是 $\\mathrm{mm/day}$。\n- 温度 $T$ 的单位必须是 $\\mathrm{K}$。\n- 所有弹性 $E_{P}$ 和 $E_{T}$ 均为无量纲数，应以小数值报告。\n\n测试套件：\n对于每种情况，使用指定的参数，并使用给定的样本大小和标准差生成合成数据。为保证可复现性，请使用提供的随机种子。\n\n- 情况 1（温带，中等降水）：\n  - $\\phi = 0.6$, $e_{0} = 2.3\\,\\mathrm{kPa}$, $\\alpha = 0.03\\,\\mathrm{K^{-1}}$, $k_{\\mathrm{et}} = 0.2\\,\\mathrm{mm/day/kPa}$, $T_{\\mathrm{ref}} = 293\\,\\mathrm{K}$。\n  - 评估点：$P_{0} = 5.0\\,\\mathrm{mm/day}$, $T_{0} = 293.0\\,\\mathrm{K}$。\n  - 合成数据：$N = 300$, $P_{i} \\sim \\mathcal{N}(P_{0}, \\sigma_{P}^{2})$，其中 $\\sigma_{P} = 0.5\\,\\mathrm{mm/day}$ 且 $P_{i}$ 在 0 处截断；$T_{i} \\sim \\mathcal{N}(T_{0}, \\sigma_{T}^{2})$，其中 $\\sigma_{T} = 2.0\\,\\mathrm{K}$；噪声 $\\varepsilon_{i} \\sim \\mathcal{N}(0, \\sigma_{\\varepsilon}^{2})$，其中 $\\sigma_{\\varepsilon} = 0.1\\,\\mathrm{mm/day}$；随机种子 $= 1$。\n\n- 情况 2（干旱，温暖，接近零径流边界）：\n  - $\\phi = 0.7$, $e_{0} = 2.3\\,\\mathrm{kPa}$, $\\alpha = 0.03\\,\\mathrm{K^{-1}}$, $k_{\\mathrm{et}} = 0.25\\,\\mathrm{mm/day/kPa}$, $T_{\\mathrm{ref}} = 293\\,\\mathrm{K}$。\n  - 评估点：$P_{0} = 0.2\\,\\mathrm{mm/day}$, $T_{0} = 300.0\\,\\mathrm{K}$。\n  - 合成数据：$N = 300$, $\\sigma_{P} = 0.1\\,\\mathrm{mm/day}$, $\\sigma_{T} = 4.0\\,\\mathrm{K}$, $\\sigma_{\\varepsilon} = 0.05\\,\\mathrm{mm/day}$；随机种子 $= 2$。\n\n- 情况 3（凉爽气候）：\n  - $\\phi = 0.8$, $e_{0} = 2.3\\,\\mathrm{kPa}$, $\\alpha = 0.03\\,\\mathrm{K^{-1}}$, $k_{\\mathrm{et}} = 0.2\\,\\mathrm{mm/day/kPa}$, $T_{\\mathrm{ref}} = 293\\,\\mathrm{K}$。\n  - 评估点：$P_{0} = 3.0\\,\\mathrm{mm/day}$, $T_{0} = 280.0\\,\\mathrm{K}$。\n  - 合成数据：$N = 300$, $\\sigma_{P} = 0.3\\,\\mathrm{mm/day}$, $\\sigma_{T} = 2.0\\,\\mathrm{K}$, $\\sigma_{\\varepsilon} = 0.1\\,\\mathrm{mm/day}$；随机种子 $= 3$。\n\n程序要求：\n- 实现机理模型，并根据上述规则，为每种情况计算在 $(P_{0}, T_{0})$ 处的 $E_{P}$ 和 $E_{T}$。\n- 为每种情况生成合成数据集，并通过普通最小二乘法拟合经验回归模型，以获得 $\\beta_{0}$、$\\beta_{P}$ 和 $\\beta_{T}$。计算在 $(P_{0}, T_{0})$ 处的 $E_{P}^{\\mathrm{emp}}$ 和 $E_{T}^{\\mathrm{emp}}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。该列表必须按顺序包含情况 1、情况 2、情况 3 的结果：每种情况的 $[E_{P}, E_{T}, E_{P}^{\\mathrm{emp}}, E_{T}^{\\mathrm{emp}}]$，平铺成一个列表。例如，输出格式为 $[e_{11}, e_{12}, e_{13}, e_{14}, e_{21}, e_{22}, e_{23}, e_{24}, e_{31}, e_{32}, e_{33}, e_{34}]$，其中 $e_{c1} = E_{P}$，$e_{c2} = E_{T}$，$e_{c3} = E_{P}^{\\mathrm{emp}}$，$e_{c4} = E_{T}^{\\mathrm{emp}}$ 分别代表情况 $c$ 的结果。",
            "solution": "该问题要求对源自两种不同建模范式的敏感性指标进行比较分析：一种是基于过程的机理模型，另一种是数据驱动的经验模型。目标是在不同气候情景下，计算并对比两种模型中径流对降水和温度的弹性。\n\n首先，我们处理机理模型。该模型是基于日水量平衡的流域水文学的简化表示。当每日降水量 $P$（单位为 $\\mathrm{mm/day}$）超过潜在蒸散发替代量 $\\mathrm{ET}(T)$（单位为 $\\mathrm{mm/day}$）时，就会产生径流，用 $Q$ 表示，单位为 $\\mathrm{mm/day}$。$\\mathrm{ET}(T)$ 是日温度 $T$（单位为 $\\mathrm{K}$）的函数。控制方程为：\n$$Q = \\phi \\, \\max\\{0, P - \\mathrm{ET}(T)\\}$$\n其中 $\\phi$ 是一个介于 0 和 1 之间的无量纲径流系数。蒸散发替代量 $\\mathrm{ET}(T)$ 与饱和水汽压 $e_s(T)$ 呈线性比例关系，后者使用温度的指数函数进行建模，这是一种与 Clausius-Clapeyron 关系相关的常见近似方法：\n$$e_s(T) = e_{0} \\exp\\left(\\alpha (T - T_{\\mathrm{ref}})\\right)$$\n$$\\mathrm{ET}(T) = k_{\\mathrm{et}} \\, e_{s}(T)$$\n在这里，$e_0$ 是参考饱和水汽压，单位为 $\\mathrm{kPa}$；$\\alpha$ 是温度敏感性系数，单位为 $\\mathrm{K^{-1}}$；$T_{\\mathrm{ref}}$ 是参考温度，单位为 $\\mathrm{K}$；$k_{\\mathrm{et}}$ 是一个转换因子，单位为 $\\mathrm{mm/day/kPa}$。\n\n径流 $Q$ 对其驱动因素 $P$ 和 $T$ 变化的敏感性通过弹性来量化。变量 $Y$ 相对于变量 $X$ 的弹性是它们分数变化的比率，$E_X = \\frac{\\% \\Delta Y}{\\% \\Delta X} = \\frac{\\partial \\ln Y}{\\partial \\ln X} = \\frac{X}{Y}\\frac{\\partial Y}{\\partial X}$。对于此问题，我们计算径流对降水的弹性 $E_P$ 和对温度的弹性 $E_T$。为此，我们需要 $Q$ 的偏导数。\n\n函数 $Q(P, T)$ 包含一个 $\\max$ 函数，这使得它在 $P = \\mathrm{ET}(T)$ 的点上不可微。然而，对于所有其他点，导数都是明确定义的。\n如果 $P > \\mathrm{ET}(T)$，则 $Q = \\phi(P - \\mathrm{ET}(T))$。偏导数为：\n$$\\frac{\\partial Q}{\\partial P} = \\phi$$\n$$\\frac{\\partial Q}{\\partial T} = -\\phi \\frac{\\partial \\mathrm{ET}(T)}{\\partial T} = -\\phi \\frac{\\partial}{\\partial T} \\left( k_{\\mathrm{et}} e_0 \\exp\\left(\\alpha (T - T_{\\mathrm{ref}})\\right) \\right) = -\\phi \\alpha \\left( k_{\\mathrm{et}} e_s(T) \\right) = -\\phi \\alpha \\mathrm{ET}(T)$$\n如果 $P \\le \\mathrm{ET}(T)$，则 $Q=0$，其关于 $P$ 和 $T$ 的偏导数均为 0。问题规定，如果在评估点 $(P_0, T_0)$ 处 $Q \\le 0$，则弹性 $E_P$ 和 $E_T$ 设为 0。这与 $P_0 \\le \\mathrm{ET}(T_0)$ 的情况一致。有了导数，给定点 $(P_0, T_0)$ 的机理弹性为：\n$$E_{P} = \\frac{P_{0}}{Q_{0}} \\frac{\\partial Q}{\\partial P} = \\frac{P_{0}}{Q_{0}} \\phi$$\n$$E_{T} = \\frac{T_{0}}{Q_{0}} \\frac{\\partial Q}{\\partial T} = \\frac{T_{0}}{Q_{0}} (-\\phi \\alpha \\mathrm{ET}(T_0))$$\n\n接下来，我们构建经验模型。这包括通过运行机理模型来生成合成数据集。我们从以评估点 $(P_0, T_0)$ 为中心的正态分布中抽取 $N$ 个降水量 $P_i$ 和温度 $T_i$ 的样本。为保持物理真实性，降水量的值在 0 处进行截断。对于每对 $(P_i, T_i)$，我们使用机理方程计算“真实”径流 $Q_i$。为了模拟测量误差或未建模的过程，我们添加零均值高斯噪声 $\\varepsilon_i$ 以获得带噪声的观测值 $Q_i^{\\mathrm{noisy}} = Q_i + \\varepsilon_i$。\n\n使用这个合成数据集 $\\{(P_i, T_i, Q_i^{\\mathrm{noisy}})\\}_{i=1}^N$，我们拟合一个形式如下的线性回归模型：\n$$Q \\approx \\beta_{0} + \\beta_{P} P + \\beta_{T} T$$\n系数 $\\beta_0$、$\\beta_P$ 和 $\\beta_T$ 是通过最小化误差平方和来确定的，这是一个标准的普通最小二乘法 (OLS) 程序。这可以用线性代数来解决。我们构建一个设计矩阵 $A$，其中每一行是 $[1, P_i, T_i]$，以及一个由 $Q_i^{\\mathrm{noisy}}$ 值组成的目标向量 $\\mathbf{b}$。系数向量 $\\mathbf{x} = [\\beta_0, \\beta_P, \\beta_T]^T$ 通过求解正规方程 $A^T A \\mathbf{x} = A^T \\mathbf{b}$ 来找到，`numpy.linalg.lstsq` 为此提供了一个稳健的求解器。\n\n拟合的系数 $\\beta_P$ 和 $\\beta_T$ 代表了线性模型估计的 $P$ 和 $T$ 对 $Q$ 的边际效应。这些效应在整个域中是恒定的，这是与机理模型的状态依赖性导数的一个关键区别。\n\n为了计算经验弹性，我们首先使用拟合的回归模型预测在评估点 $(P_{0}, T_{0})$ 的径流：\n$$Q_{\\mathrm{hat}} = \\beta_{0} + \\beta_{P} P_{0} + \\beta_{T} T_{0}$$\n然后，以与机理弹性类似的方式定义经验弹性，使用回归系数作为偏导数的代理：\n$$E_{P}^{\\mathrm{emp}} = \\frac{P_{0}}{Q_{\\mathrm{hat}}} \\beta_{P}$$\n$$E_{T}^{\\mathrm{emp}} = \\frac{T_{0}}{Q_{\\mathrm{hat}}} \\beta_{T}$$\n与机理情况一样，如果预测径流 $Q_{\\mathrm{hat}}$ 为非正值，则弹性设为 0。\n\n实现过程将通过为每个组件定义Python函数来进行：计算 $\\mathrm{ET}$、$Q$、机理弹性、生成合成数据、执行OLS回归以及计算经验弹性。这种模块化结构将应用于提供的三个测试用例，并使用指定的参数和随机种子以保证可复现性。最终输出是一个平铺列表，包含每种情况下计算出的四个弹性值（$E_P$, $E_T$, $E_P^{\\mathrm{emp}}$, $E_T^{\\mathrm{emp}}$）。对这些值的比较突显了基于第一性原理的模型（机理模型）和拟合数据的模型（经验模型）之间的差异，特别是线性经验模型如何近似基础系统的非线性行为，尤其是在阈值 $P = \\mathrm{ET}(T)$ 附近。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares mechanistic and empirical streamflow elasticities\n    for three distinct hydrologic cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (temperate, moderate precipitation)\n        {\n            \"phi\": 0.6, \"e0\": 2.3, \"alpha\": 0.03, \"k_et\": 0.2, \"T_ref\": 293.0,\n            \"P0\": 5.0, \"T0\": 293.0,\n            \"N\": 300, \"sigma_P\": 0.5, \"sigma_T\": 2.0, \"sigma_eps\": 0.1,\n            \"seed\": 1\n        },\n        # Case 2 (dry, warm, near-zero flow boundary)\n        {\n            \"phi\": 0.7, \"e0\": 2.3, \"alpha\": 0.03, \"k_et\": 0.25, \"T_ref\": 293.0,\n            \"P0\": 0.2, \"T0\": 300.0,\n            \"N\": 300, \"sigma_P\": 0.1, \"sigma_T\": 4.0, \"sigma_eps\": 0.05,\n            \"seed\": 2\n        },\n        # Case 3 (cool climate)\n        {\n            \"phi\": 0.8, \"e0\": 2.3, \"alpha\": 0.03, \"k_et\": 0.2, \"T_ref\": 293.0,\n            \"P0\": 3.0, \"T0\": 280.0,\n            \"N\": 300, \"sigma_P\": 0.3, \"sigma_T\": 2.0, \"sigma_eps\": 0.1,\n            \"seed\": 3\n        }\n    ]\n\n    # Mechanistic model helper functions\n    def calculate_es(T, e0, alpha, T_ref):\n        return e0 * np.exp(alpha * (T - T_ref))\n\n    def calculate_et(T, k_et, e0, alpha, T_ref):\n        es = calculate_es(T, e0, alpha, T_ref)\n        return k_et * es\n\n    def calculate_q(P, T, phi, k_et, e0, alpha, T_ref):\n        et_val = calculate_et(T, k_et, e0, alpha, T_ref)\n        return phi * np.maximum(0, P - et_val)\n\n    def calculate_mechanistic_elasticities(P0, T0, phi, k_et, e0, alpha, T_ref):\n        et0 = calculate_et(T0, k_et, e0, alpha, T_ref)\n        q0 = calculate_q(P0, T0, phi, k_et, e0, alpha, T_ref)\n\n        if q0 = 0:\n            return 0.0, 0.0\n        \n        # Derivatives are valid since P0 > et0 implies q0 > 0\n        dQ_dP = phi\n        dQ_dT = -phi * alpha * et0\n\n        E_P = (P0 / q0) * dQ_dP\n        E_T = (T0 / q0) * dQ_dT\n        \n        return E_P, E_T\n\n    def calculate_empirical_elasticities(params):\n        # Unpack parameters\n        phi = params[\"phi\"]\n        e0 = params[\"e0\"]\n        alpha = params[\"alpha\"]\n        k_et = params[\"k_et\"]\n        T_ref = params[\"T_ref\"]\n        P0 = params[\"P0\"]\n        T0 = params[\"T0\"]\n        N = params[\"N\"]\n        sigma_P = params[\"sigma_P\"]\n        sigma_T = params[\"sigma_T\"]\n        sigma_eps = params[\"sigma_eps\"]\n        seed = params[\"seed\"]\n\n        # Generate synthetic data\n        rng = np.random.default_rng(seed)\n        P_i = rng.normal(P0, sigma_P, N)\n        P_i[P_i  0] = 0  # Clip precipitation at 0\n        T_i = rng.normal(T0, sigma_T, N)\n        \n        Q_i = calculate_q(P_i, T_i, phi, k_et, e0, alpha, T_ref)\n        \n        noise = rng.normal(0, sigma_eps, N)\n        Q_noisy = Q_i + noise\n\n        # Perform Ordinary Least Squares (OLS) regression\n        # Q_noisy = beta0 * 1 + betaP * P + betaT * T\n        A = np.vstack([np.ones(N), P_i, T_i]).T\n        b = Q_noisy\n        \n        # Solve for [beta0, beta_P, beta_T]\n        coeffs, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n        beta0, beta_P, beta_T = coeffs[0], coeffs[1], coeffs[2]\n\n        # Calculate empirical elasticities\n        Q_hat = beta0 + beta_P * P0 + beta_T * T0\n\n        if Q_hat = 0:\n            return 0.0, 0.0\n            \n        E_P_emp = (beta_P * P0) / Q_hat\n        E_T_emp = (beta_T * T0) / Q_hat\n\n        return E_P_emp, E_T_emp\n\n    results = []\n    for case in test_cases:\n        # Mechanistic calculation\n        E_P, E_T = calculate_mechanistic_elasticities(\n            case[\"P0\"], case[\"T0\"], case[\"phi\"], case[\"k_et\"],\n            case[\"e0\"], case[\"alpha\"], case[\"T_ref\"]\n        )\n        \n        # Empirical calculation\n        E_P_emp, E_T_emp = calculate_empirical_elasticities(case)\n\n        results.extend([E_P, E_T, E_P_emp, E_T_emp])\n\n    # Final print statement in the exact required format\n    # Using a general formatter for consistent decimal representation\n    formatted_results = [f\"{r:.7f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了机理模型与经验模型在结构和行为上的差异之后，最后一个关键步骤是学习如何严谨地评估和比较它们。本练习聚焦于环境数据中普遍存在的时间自相关问题，这个问题违反了标准交叉验证方法的基本假设。通过深入理解时间分块交叉验证（time-blocked cross-validation）背后的逻辑，您将学会如何设计公平且稳健的模型评估框架 。这是一项至关重要的技能，它能帮助您避免“信息泄露”，从而对模型的真实预测性能做出诚实的评估，尤其是在比较基于过程的模型和功能强大的数据驱动方法（如神经网络）时。",
            "id": "3892601",
            "problem": "环境时间序列由于物理上的储存和释放过程而表现出时间依赖性。考虑日流域出流量 $X_t$，为便于推理，将其建模为带外生强迫的一阶自回归（AR）过程，\n$$\nX_t = \\beta U_t + \\phi X_{t-1} + \\varepsilon_t,\n$$\n其中 $U_t$ 是一个可观测的外生输入（例如，降水量），$\\beta$ 是一个未知的敏感性系数，$0  \\phi  1$ 量化了由储存引起的持续性，而 $\\varepsilon_t$ 是一个独立同分布的创新项。您希望比较一个源自质量守恒的机理降雨-径流模型（状态更新为 $S_{t+1} = S_t + I_t - O_t$，其中 $X_t \\equiv O_t$）和一个使用 $U_t$ 及过去的 $X_t$ 作为输入的经验性循环神经网络（RNN）的预测能力。训练和验证过程必须控制时间依赖性，以避免信息泄露。\n\n从时间序列中独立性、协方差和因果关系的定义，以及机理模型背后的物理质量平衡约束出发，论证应如何为非独立且非同分布的数据构建交叉验证。定义一种时间分块交叉验证方案，即在连续的时间块上进行训练，在不相交的连续时间块上进行验证，两者之间由 $g$ 天的缓冲区隔开，该方案同样应用于两种模型类型，且在任何情况下都不能获取未来信息。\n\n假设您为由自回归依赖性引起的训练集和验证集之间的交叉协方差设定一个独立性容忍度 $\\epsilon \\in (0,1)$，并且您正在考虑每日预测的 $\\phi = 0.9$ 和 $\\epsilon = 0.05$。\n\n选择所有正确的陈述：\n\nA) 在随机均匀打乱日期的随机 $k$ 折交叉验证中，对于任何弱平稳过程，训练和验证残差之间的期望协方差为零，因此不需要特殊的时间分块。\n\nB) 在一阶自回归依赖性（系数为 $\\phi$）下，在最后一个训练日和第一个验证日之间引入一个 $g$ 天的时间缓冲区，使得 $\\phi^g \\le \\epsilon$，可以使交叉协方差在容忍度 $\\epsilon$ 下变得可以忽略不计，并为时间分块交叉验证提供了理由。\n\nC) 对于 $\\phi = 0.9$ 和 $\\epsilon = 0.05$，任何 $g \\ge 20$ 天的缓冲区都足以确保 $\\phi^g \\le \\epsilon$。\n\nD) 为了公平地比较机理模型和经验模型，两者必须在相同的时间块上进行训练和验证，并且在预测时被限制在相同的信息集内（即两种模型都不能获取未来的 $U_t$ 或 $X_t$），因为可获取信息的差异否则可能会主导表观的预测能力。\n\nE) 在不同流域间进行空间分块，同时在每个流域内打乱时间顺序，等同于用于评估时间泛化能力的时间分块交叉验证，因此在这个时间预测任务中，对于公平比较而言是可接受的。",
            "solution": "核心问题是，当数据表现出时间依赖性（自相关）时，如何有效估计模型在未见数据上的预测能力。标准的交叉验证（CV）方法假定样本是独立同分布（i.i.d.）的。这个假定在时间序列中被违背，因为时间上相近的观测值是相关的。天真地应用像随机 $k$ 折交叉验证这样的方法会导致“信息泄露”，即模型在无意中用到了来自验证集的信息进行训练（反之亦然），从而导致对其泛化性能的评估过于乐观和有偏。问题要求我们在此背景下，论证合适的验证策略，特别是时间分块交叉验证。\n\nA) 在随机均匀打乱日期的随机 $k$ 折交叉验证中，对于任何弱平稳过程，训练和验证残差之间的期望协方差为零，因此不需要特殊的时间分块。\n\n这个陈述从根本上是错误的。随机 $k$ 折交叉验证的核心假设是数据生成过程产生 i.i.d. 样本。对于具有自相关性的时间序列，例如所描述的 AR(1) 过程（$X_t = \\beta U_t + \\phi X_{t-1} + \\varepsilon_t$ 且 $\\phi  0$），观测值不是独立的。打乱数据虽然破坏了时间顺序，但也产生了一个关键缺陷：一个在时间 $t$ 的数据点可能被放入训练集，而其高度相关的邻近点（在时间 $t-1$ 或 $t+1$）则被放入验证集。模型于是可以轻易地通过利用这种非因果的邻近性来“预测”验证点，这会给人一种不切实际的印象，误以为模型能够预测真正的未来。问题不在于抽象意义上的“残差的期望协方差”，而在于训练集和验证集本身之间的依赖性，这种依赖性使得该验证过程无效。特殊的分块恰恰是减轻这种信息泄露、并更真实地评估模型向前泛化能力所必需的。**错误**。\n\nB) 在一阶自回归依赖性（系数为 $\\phi$）下，在最后一个训练日和第一个验证日之间引入一个 $g$ 天的时间缓冲区，使得 $\\phi^g \\le \\epsilon$，可以使交叉协方差在容忍度 $\\epsilon$ 下变得可以忽略不计，并为时间分块交叉验证提供了理由。\n\n这个陈述正确地指出了时间分块交叉验证背后的原理。对于一个 AR(1) 过程，滞后 $k$ 阶的自相关与 $\\phi^k$ 成正比。这意味着两点之间的依赖性随其时间间隔呈指数衰减。为了创建“近似”独立的训练集和验证集，我们可以在它们之间用一个时间缓冲区隔开。如果训练数据在时间 $T$ 结束，验证数据在时间 $T+g+1$ 开始，那么缓冲区就由从 $T+1$ 到 $T+g$ 的 $g$ 天组成。任何训练点和任何验证点之间的最小滞后是 $g+1$。$X_T$ 和 $X_{T+g+1}$ 之间的相关性与 $\\phi^{g+1}$ 成正比。该陈述使用了条件 $\\phi^g \\le \\epsilon$，这是一种实用且稍微保守的方式，用以确保在大小为 $g$ 的缓冲区之后（即滞后 $g+1$ 时）的相关性低于容忍度 $\\epsilon$，因为对于 $0  \\phi  1$，$ \\phi^{g+1}  \\phi^g$。这个程序直接解决了时间依赖性问题，并为使用时间分块交叉验证提供了坚实的理由。**正确**。\n\nC) 对于 $\\phi = 0.9$ 和 $\\epsilon = 0.05$，任何 $g \\ge 20$ 天的缓冲区都足以确保 $\\phi^g \\le \\epsilon$。\n\n这是对陈述 B 中原理的定量应用。我们需要找到满足不等式 $(0.9)^g \\le 0.05$ 的最小整数 $g$。我们可以通过对两边取自然对数来求解 $g$：\n$$ g \\ln(0.9) \\le \\ln(0.05) $$\n因为 $0  0.9  1$，其对数 $\\ln(0.9)$ 是一个负数。因此，当我们除以 $\\ln(0.9)$ 时，必须反转不等号：\n$$ g \\ge \\frac{\\ln(0.05)}{\\ln(0.9)} $$\n使用近似值 $\\ln(0.05) \\approx -2.99573$ 和 $\\ln(0.9) \\approx -0.10536$，我们得到：\n$$ g \\ge \\frac{-2.99573}{-0.10536} \\approx 28.43 $$\n由于天数 $g$ 必须是整数，满足条件的最小 $g$ 值为 $g=29$。该陈述提出 $g \\ge 20$ 就足够了。我们来测试一下 $g=20$：$(0.9)^{20} \\approx 0.122$，这明显大于 $0.05$。因此，20天的缓冲区不足以将自相关性降低到期望的容忍度。该陈述在数值上是错误的。**错误**。\n\nD) 为了公平地比较机理模型和经验模型，两者必须在相同的时间块上进行训练和验证，并且在预测时被限制在相同的信息集内（即两种模型都不能获取未来的 $U_t$ 或 $X_t$），因为可获取信息的差异否则可能会主导表观的预测能力。\n\n这个陈述阐明了科学模型比较的一条基本准则。任何比较若要有效，都必须在“ceteris paribus”（其他条件相同）的情况下进行。这包括：\n1. 对所有被比较的模型使用完全相同的数据分区进行训练和验证。这确保了性能上的任何差异都不是因为某个模型在“更简单”或“更困难”的数据子集上进行测试。\n2. 确保所有模型在预测时都能访问完全相同的信息集。如果一个模型被给予了另一个模型所没有的未来信息（例如，用未来的降水 $U_{t+1}$ 来预测出流 $X_t$），那么这种比较就毫无意义。表观的预测能力将被这种信息优势所主导，而不是模型内在的优劣（机理 vs. 经验）。\n这个原则对于无偏评估至关重要，并且在这里被正确地陈述了。**正确**。\n\nE) 在不同流域间进行空间分块，同时在每个流域内打乱时间顺序，等同于用于评估时间泛化能力的时间分块交叉验证，因此在这个时间预测任务中，对于公平比较而言是可接受的。\n\n这个陈述混淆了两种不同类型的模型泛化能力。\n- **时间泛化能力**评估模型在给定位置（或系统）上向前预测时间的能力。这需要使用尊重时间箭头的方法来测试，例如时间分块交叉验证。\n- **空间泛化能力**评估模型在一个新的、未见过的位置上的表现能力。这需要使用空间分块（例如，在九个流域上训练，在第十个上测试）来测试。\n所提议的方案——空间分块结合在每个流域内的时间打乱——是在错误地假设每个流域内的时间序列数据是 i.i.d. 的前提下，测试空间泛化能力。正如在对(A)的分析中所确立的，打乱时间序列数据是评估时间性能的无效程序。因此，这个方案并不“等同于时间分块交叉验证”，也不是评估问题中描述的*时间*预测任务的“可接受”方法。**错误**。",
            "answer": "$$\\boxed{BD}$$"
        }
    ]
}