{
    "hands_on_practices": [
        {
            "introduction": "Box models are indispensable tools in environmental science, allowing us to conceptualize and quantify the behavior of complex systems. This first practice  guides you through the fundamental process of building such a model from first principles. By deriving the governing ordinary differential equations for a two-compartment system and solving for its steady state, you will gain a core understanding of how to translate physical processes like exchange, sources, and sinks into a robust mathematical framework.",
            "id": "3870092",
            "problem": "Consider two well-mixed compartments representing adjacent regions in a stratified lake. Let the tracer mass in the upper box be $M_1(t)$ and in the lower box be $M_2(t)$, where $t$ is time. The boxes exchange mass symmetrically at a rate parameter $r$ with units of $\\mathrm{s}^{-1}$, meaning that in a small time interval $\\mathrm{d}t$ the mass transferred from box $1$ to box $2$ is $r M_1(t) \\mathrm{d}t$ and from box $2$ to box $1$ is $r M_2(t) \\mathrm{d}t$. Each box has an external source $S_i$ with units of $\\mathrm{kg\\,s}^{-1}$, where $i \\in \\{1,2\\}$, and a first-order removal process with rate $k_i$ with units of $\\mathrm{s}^{-1}$ that irreversibly removes the tracer from the system (e.g., due to chemical transformation or export). Assume $r > 0$, $S_1 \\ge 0$, $S_2 \\ge 0$, $k_1 \\ge 0$, and $k_2 \\ge 0$. Starting from conservation of mass and the definition of the exchange processes, write down the governing Ordinary Differential Equations (ODEs) for $M_1(t)$ and $M_2(t)$, and analytically derive the steady-state masses $M_1^{\\star}$ and $M_2^{\\star}$. Then, using first principles, identify the parameter conditions under which the total mass in the combined two-box system, $M_{\\mathrm{T}}(t) = M_1(t) + M_2(t)$, is conserved in the sense that its time derivative vanishes for all states and times due solely to internal exchange (i.e., no net production or loss from external forcing or internal removal). For reporting, provide the steady-state total mass $M_{\\mathrm{T}}^{\\star}$ as a single closed-form analytic expression in terms of $S_1$, $S_2$, $r$, $k_1$, and $k_2$. No numerical rounding is required. Express $M_{\\mathrm{T}}^{\\star}$ without units in your final expression.",
            "solution": "The problem asks for the derivation of the governing equations for a two-compartment system, the determination of its steady-state masses, an analysis of the conditions for total mass conservation, and an expression for the total steady-state mass.\n\nFirst, we establish the governing differential equations based on the principle of conservation of mass. For any control volume, the rate of change of mass is equal to the sum of all mass fluxes into the volume minus the sum of all mass fluxes out of the volume.\n\nFor the upper box (compartment $1$), the mass is $M_1(t)$.\nThe fluxes into box $1$ are:\n1.  External source: $S_1$\n2.  Exchange from box $2$: $r M_2(t)$\n\nThe fluxes out of box $1$ are:\n1.  Removal process: $k_1 M_1(t)$\n2.  Exchange to box $2$: $r M_1(t)$\n\nApplying the mass balance principle, the governing Ordinary Differential Equation (ODE) for $M_1(t)$ is:\n$$ \\frac{dM_1}{dt} = S_1 + r M_2(t) - k_1 M_1(t) - r M_1(t) $$\n$$ \\frac{dM_1}{dt} = S_1 + r M_2(t) - (k_1 + r) M_1(t) $$\n\nSimilarly, for the lower box (compartment $2$), the mass is $M_2(t)$.\nThe fluxes into box $2$ are:\n1.  External source: $S_2$\n2.  Exchange from box $1$: $r M_1(t)$\n\nThe fluxes out of box $2$ are:\n1.  Removal process: $k_2 M_2(t)$\n2.  Exchange to box $1$: $r M_2(t)$\n\nThe governing ODE for $M_2(t)$ is:\n$$ \\frac{dM_2}{dt} = S_2 + r M_1(t) - k_2 M_2(t) - r M_2(t) $$\n$$ \\frac{dM_2}{dt} = S_2 + r M_1(t) - (k_2 + r) M_2(t) $$\n\nNext, we find the steady-state masses, denoted by $M_1^{\\star}$ and $M_2^{\\star}$. At steady state, the masses are constant, so their time derivatives are zero: $\\frac{dM_1}{dt} = 0$ and $\\frac{dM_2}{dt} = 0$. This yields a system of two linear algebraic equations:\n$$ 0 = S_1 + r M_2^{\\star} - (k_1 + r) M_1^{\\star} $$\n$$ 0 = S_2 + r M_1^{\\star} - (k_2 + r) M_2^{\\star} $$\nRearranging into a standard matrix form $\\mathbf{A}\\mathbf{x} = \\mathbf{b}$:\n$$ (k_1 + r) M_1^{\\star} - r M_2^{\\star} = S_1 $$\n$$ -r M_1^{\\star} + (k_2 + r) M_2^{\\star} = S_2 $$\nThis can be written as:\n$$ \\begin{pmatrix} k_1+r  -r \\\\ -r  k_2+r \\end{pmatrix} \\begin{pmatrix} M_1^{\\star} \\\\ M_2^{\\star} \\end{pmatrix} = \\begin{pmatrix} S_1 \\\\ S_2 \\end{pmatrix} $$\nTo solve for $M_1^{\\star}$ and $M_2^{\\star}$, we can use Cramer's rule or matrix inversion. The determinant of the coefficient matrix is:\n$$ D = \\det \\begin{pmatrix} k_1+r  -r \\\\ -r  k_2+r \\end{pmatrix} = (k_1+r)(k_2+r) - (-r)(-r) $$\n$$ D = k_1 k_2 + k_1 r + k_2 r + r^2 - r^2 = k_1 k_2 + r(k_1+k_2) $$\nA unique steady-state solution exists if $D \\neq 0$. Given $r > 0$, $k_1 \\ge 0$, and $k_2 \\ge 0$, $D$ is zero only if $k_1=0$ and $k_2=0$. We assume at least one removal rate is positive, ensuring $D>0$.\nUsing Cramer's rule:\n$$ M_1^{\\star} = \\frac{\\det \\begin{pmatrix} S_1  -r \\\\ S_2  k_2+r \\end{pmatrix}}{D} = \\frac{S_1(k_2+r) - S_2(-r)}{k_1 k_2 + r(k_1+k_2)} = \\frac{S_1(k_2+r) + rS_2}{k_1 k_2 + r(k_1+k_2)} $$\n$$ M_2^{\\star} = \\frac{\\det \\begin{pmatrix} k_1+r  S_1 \\\\ -r  S_2 \\end{pmatrix}}{D} = \\frac{S_2(k_1+r) - S_1(-r)}{k_1 k_2 + r(k_1+k_2)} = \\frac{S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\n\nThe third task is to identify the conditions under which the total mass $M_{\\mathrm{T}}(t) = M_1(t) + M_2(t)$ is conserved. We first find the ODE for $M_{\\mathrm{T}}(t)$ by summing the ODEs for $M_1(t)$ and $M_2(t)$:\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = \\frac{dM_1}{dt} + \\frac{dM_2}{dt} = \\left(S_1 + r M_2 - (k_1 + r) M_1\\right) + \\left(S_2 + r M_1 - (k_2 + r) M_2\\right) $$\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = S_1 + S_2 + (r M_2 - r M_2) + (r M_1 - r M_1) - k_1 M_1 - k_2 M_2 $$\n$$ \\frac{dM_{\\mathrm{T}}}{dt} = S_1 + S_2 - k_1 M_1(t) - k_2 M_2(t) $$\nThe internal exchange terms $r M_1$ and $r M_2$ cancel out, meaning the internal exchange process is conservative with respect to the total mass of the system. The problem asks for the condition where $M_{\\mathrm{T}}$ is conserved, which is defined as its time derivative vanishing due to \"no net production or loss from external forcing or internal removal\". This implies we must set the corresponding terms in the ODE for $dM_{\\mathrm{T}}/dt$ to zero.\n1.  No net production from external forcing: $S_1 + S_2 = 0$. Since $S_1 \\ge 0$ and $S_2 \\ge 0$, this requires $S_1 = 0$ and $S_2 = 0$.\n2.  No net loss from internal removal: $k_1 M_1(t) + k_2 M_2(t) = 0$. This must hold for all states $(M_1, M_2)$ and times. Since $M_1 \\ge 0$ and $M_2 \\ge 0$, and the removal rates $k_1 \\ge 0$ and $k_2 \\ge 0$, this equation can only be satisfied for all non-trivial states if the coefficients are zero, i.e., $k_1 = 0$ and $k_2 = 0$.\nThe parameter conditions for total mass conservation are therefore $S_1 = S_2 = k_1 = k_2 = 0$.\n\nFinally, we are asked to provide the steady-state total mass $M_{\\mathrm{T}}^{\\star} = M_1^{\\star} + M_2^{\\star}$ for the general case. We sum the derived expressions for $M_1^{\\star}$ and $M_2^{\\star}$:\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1(k_2+r) + rS_2}{k_1 k_2 + r(k_1+k_2)} + \\frac{S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1(k_2+r) + rS_2 + S_2(k_1+r) + rS_1}{k_1 k_2 + r(k_1+k_2)} $$\nExpanding the numerator:\n$$ \\text{Numerator} = S_1 k_2 + S_1 r + r S_2 + S_2 k_1 + S_2 r + r S_1 $$\n$$ \\text{Numerator} = S_1 k_2 + S_2 k_1 + 2rS_1 + 2rS_2 $$\n$$ \\text{Numerator} = S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2) $$\nSo, the total steady-state mass is:\n$$ M_{\\mathrm{T}}^{\\star} = \\frac{S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2)}{k_1 k_2 + r(k_1 + k_2)} $$\nThis is the final closed-form expression for the total mass at steady state.",
            "answer": "$$\n\\boxed{\\frac{S_1 k_2 + S_2 k_1 + 2r(S_1 + S_2)}{k_1 k_2 + r(k_1 + k_2)}}\n$$"
        },
        {
            "introduction": "While analytical models are perfectly conservative, their numerical counterparts can introduce subtle errors that violate this principle. This next practice  moves from model building to the critical skill of model diagnostics. Using output data from a hypothetical reactive transport simulation, you will perform a mass budget analysis to calculate the \"mass leakage,\" quantifying the extent to which a numerical scheme fails to conserve total mass. This is a vital skill for model validation and debugging.",
            "id": "3870088",
            "problem": "Consider a one-dimensional, two-cell finite volume model of a channel segment transporting and reacting three dissolved species, denoted by $A$, $B$, and $C$. Each species follows an advection–diffusion–reaction equation derived from conservation of mass. Let the governing law for species $i$ be \n$\\frac{\\partial c_{i}}{\\partial t} + \\nabla \\cdot \\boldsymbol{J}_{i} = r_{i}$, \nwhere $c_{i}$ is the mass concentration, $\\boldsymbol{J}_{i}$ is the total flux (advection plus diffusion), and $r_{i}$ is the mass production rate due to reactions. The reactions are $\\text{A} + \\text{B} \\rightleftharpoons \\text{C}$ with mass-conservative stoichiometry encoded by two nonnegative rate densities $\\rho_{1}$ and $\\rho_{2}$ (units $\\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$), namely\n$r_{A} = -\\rho_{1} + \\rho_{2}$, $r_{B} = -\\rho_{1} + \\rho_{2}$, $r_{C} = 2\\rho_{1} - 2\\rho_{2}$,\nso that $\\sum_{i \\in \\{A,B,C\\}} r_{i} = 0$ pointwise.\n\nA finite volume time update is carried out from time $t^{n}$ to $t^{n+1} = t^{n} + \\Delta t$ on two equal cells ($j=1,2$) of volumes $V_{1} = V_{2} = 1000\\ \\mathrm{m}^{3}$ with time step $\\Delta t = 3600\\ \\mathrm{s}$. Let $M_{i,j}^{n} = V_{j} c_{i,j}^{n}$ denote the species $i$ mass in cell $j$ at time $t^{n}$.\n\nYou are to construct a domain-integrated diagnostic for total mass conservation by summing the species equations and eliminating internal-face exchanges, thereby isolating any discrepancy arising from discretization. Define the domain mass change over the time step as $\\Delta M_{\\mathrm{tot}} = \\sum_{i}\\sum_{j} \\left(M_{i,j}^{n+1} - M_{i,j}^{n}\\right)$. The outward (leaving the domain) net boundary flux rates for each species are provided at the left ($L$) and right ($R$) boundaries as constants over the time step, $F_{i}^{L}$ and $F_{i}^{R}$, with units $\\mathrm{kg}\\ \\mathrm{s}^{-1}$ and sign convention positive outward.\n\nData:\n- Cell volumes: $V_{1} = V_{2} = 1000\\ \\mathrm{m}^{3}$.\n- Time step: $\\Delta t = 3600\\ \\mathrm{s}$.\n- Concentrations at $t^{n}$:\n  $c_{A,1}^{n} = 1.200\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{A,2}^{n} = 0.800\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$,\n  $c_{B,1}^{n} = 0.900\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{B,2}^{n} = 1.300\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$,\n  $c_{C,1}^{n} = 0.700\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{C,2}^{n} = 0.600\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$.\n- Concentrations at $t^{n+1}$:\n  $c_{A,1}^{n+1} = 1.160\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{A,2}^{n+1} = 0.780\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$,\n  $c_{B,1}^{n+1} = 0.880\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{B,2}^{n+1} = 1.260\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$,\n  $c_{C,1}^{n+1} = 0.690\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$, $c_{C,2}^{n+1} = 0.545\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}$.\n- Reaction rate densities (assumed cell-constant over the time step):\n  $\\rho_{1,1} = 0.010\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$, $\\rho_{2,1} = 0.008\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$,\n  $\\rho_{1,2} = 0.006\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$, $\\rho_{2,2} = 0.007\\ \\mathrm{kg}\\ \\mathrm{m}^{-3}\\ \\mathrm{s}^{-1}$.\n- Boundary flux rates (positive outward):\n  $F_{A}^{L} = 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$, $F_{B}^{L} = -0.02\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$, $F_{C}^{L} = 0.00\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$,\n  $F_{A}^{R} = 0.03\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$, $F_{B}^{R} = 0.01\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$, $F_{C}^{R} = -0.02\\ \\mathrm{kg}\\ \\mathrm{s}^{-1}$.\n\nTask:\n1. Starting from the species conservation law and the finite volume balance for each cell, derive a closed-form expression for the one-step domain-integrated “mass leakage” diagnostic $L$ defined as the unaccounted change in total mass, i.e., the difference between the actual domain mass change and the change predicted by the sum of boundary fluxes and reaction terms.\n2. Evaluate $L$ using the provided data.\n\nExpress your final answer in kilograms and round your answer to four significant figures.",
            "solution": "### Part 1: Derivation of the Mass Leakage Diagnostic $L$\n\nThe conservation of mass for a species $i$ in a control volume $V_j$ is given by integrating the governing partial differential equation over the volume $V_j$:\n$$ \\int_{V_j} \\frac{\\partial c_i}{\\partial t} dV + \\int_{V_j} \\nabla \\cdot \\boldsymbol{J}_i dV = \\int_{V_j} r_i dV $$\nUsing the divergence theorem, the flux term becomes a surface integral over the boundary $\\partial V_j$:\n$$ \\frac{d}{dt} \\int_{V_j} c_i dV + \\oint_{\\partial V_j} \\boldsymbol{J}_i \\cdot \\mathbf{n} dS = \\int_{V_j} r_i dV $$\nIn a finite volume discretization, we consider average quantities over cell $j$ and time step $\\Delta t = t^{n+1} - t^n$. The mass of species $i$ in cell $j$ is $M_{i,j} = V_j c_{i,j}$. The explicit time-discretized form of the mass balance for cell $j$ and species $i$ is:\n$$ \\frac{M_{i,j}^{n+1} - M_{i,j}^{n}}{\\Delta t} + \\mathcal{F}_{i,j} = V_j r_{i,j} $$\nwhere $\\mathcal{F}_{i,j}$ is the net rate of mass of species $i$ leaving cell $j$ through all its faces, and $r_{i,j}$ is the average mass production rate in cell $j$. The problem asks for a domain-integrated diagnostic. We sum this equation over all species $i \\in \\{A, B, C\\}$ and all cells $j \\in \\{1, 2\\}$:\n$$ \\sum_{i,j} \\frac{M_{i,j}^{n+1} - M_{i,j}^{n}}{\\Delta t} + \\sum_{i,j} \\mathcal{F}_{i,j} = \\sum_{i,j} V_j r_{i,j} $$\nThe first term can be rewritten using the definition of total domain mass change, $\\Delta M_{\\mathrm{tot}} = \\sum_{i,j} (M_{i,j}^{n+1} - M_{i,j}^{n})$.\nThe flux summation $\\sum_{i,j} \\mathcal{F}_{i,j}$ involves summing fluxes over all faces of all cells. For internal faces between adjacent cells, the flux leaving one cell is equal to the flux entering the adjacent cell. Therefore, these internal fluxes cancel out in the domain-wide sum. What remains are the fluxes at the external boundaries of the domain.\n$$ \\sum_{i,j} \\mathcal{F}_{i,j} = \\sum_i (F_i^L + F_i^R) $$\nThis sum is the total net rate of mass leaving the domain, with the sign convention that $F_i^L$ and $F_i^R$ are positive for outward flux.\n\nThe reaction term summation $\\sum_{i,j} V_j r_{i,j}$ can be grouped by cell: $\\sum_j V_j (\\sum_i r_{i,j})$. The problem states that the reaction stoichiometry is mass-conservative, i.e., $\\sum_i r_i = 0$ at every point. Thus, for each cell $j$, $\\sum_i r_{i,j} = 0$. We can verify this with the provided rate definitions:\nFor any cell $j$, $\\sum_i r_{i,j} = r_{A,j} + r_{B,j} + r_{C,j} = (-\\rho_{1,j} + \\rho_{2,j}) + (-\\rho_{1,j} + \\rho_{2,j}) + (2\\rho_{1,j} - 2\\rho_{2,j}) = 0$.\nTherefore, the total reaction contribution to the change in total mass is zero: $\\sum_{i,j} V_j r_{i,j} = 0$.\n\nThe ideal mass balance for the entire domain is:\n$$ \\frac{\\Delta M_{\\mathrm{tot}}}{\\Delta t} + \\sum_i (F_i^L + F_i^R) = 0 \\implies \\Delta M_{\\mathrm{tot}} = -\\Delta t \\sum_i (F_i^L + F_i^R) $$\nThis equation states that the change in total mass within the domain is exactly balanced by the net transport of mass across its boundaries.\n\nThe mass leakage diagnostic $L$ is defined as the unaccounted change in total mass, which is the residual of the numerically computed mass balance. It is the actual mass change minus the change predicted by all specified physical processes (fluxes and reactions):\n$$ L = \\Delta M_{\\mathrm{tot}} - \\left( -\\Delta t \\sum_i (F_i^L + F_i^R) + \\Delta t \\sum_{i,j} V_j r_{i,j} \\right) $$\nSince the total reaction term is zero:\n$$ L = \\Delta M_{\\mathrm{tot}} + \\Delta t \\sum_{i \\in \\{A,B,C\\}} (F_i^L + F_i^R) $$\nThis is the final expression for the mass leakage diagnostic.\n\n### Part 2: Evaluation of $L$\nWe now evaluate this expression using the provided data.\n\nFirst, calculate the actual total mass change, $\\Delta M_{\\mathrm{tot}}$.\nThe total mass at time $t^n$ is $M_{\\mathrm{tot}}^n = \\sum_{i,j} M_{i,j}^{n} = \\sum_{i,j} V_j c_{i,j}^{n}$. Since $V_1 = V_2 = V = 1000\\ \\mathrm{m}^3$:\n$M_{\\mathrm{tot}}^n = V \\sum_{i,j} c_{i,j}^{n} = 1000 \\times (1.200 + 0.800 + 0.900 + 1.300 + 0.700 + 0.600)$\n$M_{\\mathrm{tot}}^n = 1000 \\times (5.500) = 5500\\ \\mathrm{kg}$.\n\nThe total mass at time $t^{n+1}$ is $M_{\\mathrm{tot}}^{n+1} = \\sum_{i,j} M_{i,j}^{n+1} = V \\sum_{i,j} c_{i,j}^{n+1}$:\n$M_{\\mathrm{tot}}^{n+1} = 1000 \\times (1.160 + 0.780 + 0.880 + 1.260 + 0.690 + 0.545)$\n$M_{\\mathrm{tot}}^{n+1} = 1000 \\times (5.315) = 5315\\ \\mathrm{kg}$.\n\nThe actual change in total mass is:\n$$ \\Delta M_{\\mathrm{tot}} = M_{\\mathrm{tot}}^{n+1} - M_{\\mathrm{tot}}^{n} = 5315 - 5500 = -185\\ \\mathrm{kg} $$\n\nNext, calculate the total mass transported out of the domain through boundaries over the time step $\\Delta t$.\nTotal outward flux rate:\n$$ \\sum_i (F_i^L + F_i^R) = (F_A^L + F_B^L + F_C^L) + (F_A^R + F_B^R + F_C^R) $$\n$$ = (0.05 - 0.02 + 0.00) + (0.03 + 0.01 - 0.02) $$\n$$ = (0.03) + (0.02) = 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1} $$\nTotal mass transported out is this rate multiplied by the time step $\\Delta t = 3600\\ \\mathrm{s}$:\n$$ \\Delta t \\sum_i (F_i^L + F_i^R) = 3600\\ \\mathrm{s} \\times 0.05\\ \\mathrm{kg}\\ \\mathrm{s}^{-1} = 180\\ \\mathrm{kg} $$\n\nFinally, calculate the leakage $L$:\n$$ L = \\Delta M_{\\mathrm{tot}} + \\Delta t \\sum_i (F_i^L + F_i^R) $$\n$$ L = -185\\ \\mathrm{kg} + 180\\ \\mathrm{kg} = -5\\ \\mathrm{kg} $$\nA negative value for $L$ indicates that the system has lost $5\\ \\mathrm{kg}$ of mass that is not accounted for by the specified outward boundary fluxes. This represents a numerical mass loss error in the simulation step from $t^n$ to $t^{n+1}$.\n\nRounding to four significant figures as requested, the result is $-5.000\\ \\mathrm{kg}$.",
            "answer": "$$\\boxed{-5.000}$$"
        },
        {
            "introduction": "This final practice integrates physical theory with numerical implementation, a capstone skill for any environmental modeler. This exercise  challenges you to model the evolution of a river bed by first deriving the governing partial differential equation—the Exner equation—from mass conservation principles. You will then build a conservative finite-volume scheme to solve this equation, directly connecting the continuous conservation law to a discrete, verifiable algorithm that respects it.",
            "id": "3870147",
            "problem": "A one-dimensional river reach of length $L$ is modeled as $N$ equal finite-volume cells with cell width $\\Delta x = L/N$ and unit channel width. The bed elevation field is denoted by $\\eta(x,t)$, and the porosity of the bed material is $\\lambda_p \\in [0,1)$. Starting strictly from conservation of mass for the sediment phase applied to a control volume, derive the governing bed evolution equation (commonly referred to as the Exner equation) for this one-dimensional setting. For computation, adopt a linear slope-driven transport formula in which the volumetric bedload sediment flux per unit width $q_s(x,t)$ is proportional to the negative bed slope, specified by $q_s(x,t) = -K \\,\\partial \\eta/\\partial x$, where $K$ is a positive constant with units of $\\mathrm{m}^2/\\mathrm{s}$. Upstream and downstream boundary sediment fluxes are prescribed as constants $q_{\\text{in}}$ and $q_{\\text{out}}$, respectively.\n\nImplement an explicit finite-volume method consistent with the derived governing equation on the $N$ cells. Use face fluxes $F_i$ at cell interfaces indexed from $i=0$ (upstream boundary face) to $i=N$ (downstream boundary face), enforce $F_0 = q_{\\text{in}}$, $F_N = q_{\\text{out}}$, and compute interior face fluxes $F_i$ for $i=1,\\dots,N-1$ from the specified transport formula using adjacent cell elevations. Choose a time step $\\Delta t$ that satisfies a stability constraint based on the Courant–Friedrichs–Lewy (CFL) condition appropriate for the explicit discretization of the resulting diffusion-type equation; if $K=0$, use a uniform subdivision of the total simulation time. Evolve the bed from an initial elevation profile $\\eta(x,0)$ over a total time $T$.\n\nFor each simulation, compute the domain-average bed elevation change $\\overline{\\Delta \\eta}_{\\text{num}}$, defined as the spatial average of $\\eta(x,T)-\\eta(x,0)$ over $[0,L]$, and compare it to the analytical domain-average bed elevation change $\\overline{\\Delta \\eta}_{\\text{ana}}$ implied by integrating the governing bed mass balance over the domain with constant boundary fluxes. Report, for each case, the absolute error $E = |\\overline{\\Delta \\eta}_{\\text{num}} - \\overline{\\Delta \\eta}_{\\text{ana}}|$.\n\nPhysical units:\n- $L$ in meters (m), $T$ in seconds (s), $K$ in $\\mathrm{m}^2/\\mathrm{s}$, $q_{\\text{in}}$ and $q_{\\text{out}}$ in $\\mathrm{m}^2/\\mathrm{s}$, $\\eta$ in meters (m), $E$ in meters (m).\n- Express the final errors as floats in meters.\n\nInitial condition specification:\n- Use a sinusoidal initial bed profile $\\eta(x,0) = A \\sin\\left(2\\pi x/L\\right)$ with amplitude $A$ in meters, where $x$ is the cell-center coordinate.\n\nTest suite (each tuple is $(L,N,K,\\lambda_p,T,q_{\\text{in}},q_{\\text{out}},A)$):\n1. $(100.0, 50, 0.02, 0.40, 10.0, 0.005, 0.002, 0.0)$\n2. $(200.0, 100, 0.05, 0.35, 20.0, 0.004, 0.004, 0.5)$\n3. $(80.0, 80, 0.0, 0.0, 5.0, 0.003, 0.001, 0.3)$\n4. $(150.0, 75, 0.001, 0.90, 15.0, 0.002, 0.0015, 0.1)$\n5. $(50.0, 25, 0.03, 0.60, 1.0, 0.0, 0.0, 0.25)$\n\nRequired final output format:\n- Your program should produce a single line of output containing the errors for the five test cases as a comma-separated list of floats rounded to six decimal places, enclosed in square brackets (e.g., \"[e1,e2,e3,e4,e5]\"), where each $e_i$ is in meters.",
            "solution": "### Part 1: Derivation of the Governing Equation\n\nThe derivation begins with the principle of conservation of sediment mass for a control volume. Consider a one-dimensional river reach where the bed elevation is given by $\\eta(x,t)$. The bed material has a constant porosity $\\lambda_p$. The quantity of interest is the volume of sediment solids per unit channel width.\n\nLet's define a control volume (CV) over a small segment of the river bed from $x$ to $x+\\Delta x$, with a unit width. The total volume of the bed layer within this CV is $\\eta \\Delta x$. The volume occupied by sediment solids is this total volume multiplied by the solids fraction, which is $(1-\\lambda_p)$. Therefore, the volume of sediment solids in the CV is $V_{sed} = (1-\\lambda_p)\\eta\\Delta x$.\n\nThe principle of mass conservation states that the time rate of change of sediment volume within the CV must equal the net rate at which sediment volume enters the CV.\n$$\n\\frac{\\partial V_{sed}}{\\partial t} = \\text{Flux}_{\\text{in}} - \\text{Flux}_{\\text{out}}\n$$\nThe volumetric sediment flux per unit width is denoted by $q_s(x,t)$.\n- Sediment flux entering the CV at face $x$ is $q_s(x,t)$.\n- Sediment flux leaving the CV at face $x+\\Delta x$ is $q_s(x+\\Delta x, t)$.\n\nThe mass balance equation for the control volume is:\n$$\n\\frac{\\partial}{\\partial t} \\left[ (1-\\lambda_p) \\eta(x,t) \\Delta x \\right] = q_s(x,t) - q_s(x+\\Delta x, t)\n$$\nAssuming that the porosity $\\lambda_p$ and the cell width $\\Delta x$ are constant, we can rewrite this as:\n$$\n(1-\\lambda_p) \\Delta x \\frac{\\partial \\eta}{\\partial t} = - [q_s(x+\\Delta x, t) - q_s(x,t)]\n$$\nDividing by $\\Delta x$ gives:\n$$\n(1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} = - \\frac{q_s(x+\\Delta x, t) - q_s(x,t)}{\\Delta x}\n$$\nIn the limit as $\\Delta x \\to 0$, the right-hand side becomes the negative of the spatial derivative of the flux:\n$$\n(1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} = - \\frac{\\partial q_s}{\\partial x}\n$$\nThis is the general form of the one-dimensional Exner equation for bed evolution. It states that the bed elevation changes in response to spatial gradients in sediment transport.\n\nThe problem specifies a linear slope-driven transport formula:\n$$\nq_s(x,t) = -K \\frac{\\partial \\eta}{\\partial x}\n$$\nwhere $K$ is a positive transport coefficient. Substituting this expression for $q_s$ into the Exner equation yields:\n$$\n(1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} = - \\frac{\\partial}{\\partial x} \\left( -K \\frac{\\partial \\eta}{\\partial x} \\right)\n$$\nAssuming $K$ is a constant, this simplifies to a linear diffusion equation:\n$$\n(1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} = K \\frac{\\partial^2 \\eta}{\\partial x^2}\n$$\nOr, in standard diffusion form:\n$$\n\\frac{\\partial \\eta}{\\partial t} = D \\frac{\\partial^2 \\eta}{\\partial x^2} \\quad \\text{where } D = \\frac{K}{1-\\lambda_p}\n$$\nThis is the governing partial differential equation (PDE) for the bed evolution under the given transport law.\n\n### Part 2: Numerical Scheme Design\n\nAn explicit finite-volume method is employed. The domain of length $L$ is discretized into $N$ cells, indexed $j=0, 1, \\dots, N-1$. Each cell has width $\\Delta x = L/N$. The bed elevation $\\eta_j(t)$ represents the average elevation in cell $j$.\n\nIntegrating the conservative form of the Exner equation, $(1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} = - \\frac{\\partial q_s}{\\partial x}$, over cell $j$ (from $x_j - \\Delta x/2$ to $x_j + \\Delta x/2$):\n$$\n\\int_{x_j-\\Delta x/2}^{x_j+\\Delta x/2} (1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} \\,dx = - \\int_{x_j-\\Delta x/2}^{x_j+\\Delta x/2} \\frac{\\partial q_s}{\\partial x} \\,dx\n$$\nThis yields:\n$$\n(1-\\lambda_p) \\Delta x \\frac{d\\eta_j}{dt} = q_s(x_j-\\Delta x/2) - q_s(x_j+\\Delta x/2)\n$$\nLet $F_j$ be the flux at the left face of cell $j$ (interface between cell $j-1$ and $j$) and $F_{j+1}$ be the flux at the right face (interface between cell $j$ and $j+1$). The equation for cell $j$ is:\n$$\n\\frac{d\\eta_j}{dt} = \\frac{1}{(1-\\lambda_p)\\Delta x} (F_j - F_{j+1})\n$$\nThe fluxes are defined as follows:\n- Boundary fluxes: $F_0 = q_{\\text{in}}$ and $F_N = q_{\\text{out}}$.\n- Interior fluxes ($j=1, \\dots, N-1$): The flux is computed using a centered difference approximation for the slope between adjacent cells. The flux $F_j$ at the interface between cell $j-1$ and cell $j$ is:\n$$\nF_j = -K \\left( \\frac{\\partial \\eta}{\\partial x} \\right)_{\\text{face } j} \\approx -K \\frac{\\eta_j - \\eta_{j-1}}{\\Delta x}\n$$\nUsing an explicit forward Euler scheme for time integration with time step $\\Delta t$, the update for the elevation $\\eta_j^n$ at time step $n$ is:\n$$\n\\eta_j^{n+1} = \\eta_j^n + \\frac{\\Delta t}{(1-\\lambda_p)\\Delta x} (F_j^n - F_{j+1}^n)\n$$\nThe full simulation proceeds by calculating all fluxes $F_j^n$ at time $n$ based on the elevations $\\eta^n$, and then using the above formula to compute all elevations $\\eta_j^{n+1}$ for the next time step.\n\n### Part 3: Stability and Time Step Selection\n\nThe explicit scheme is conditionally stable. The underlying PDE is a diffusion equation with diffusivity $D = K/(1-\\lambda_p)$. The stability for the Forward-Time Centered-Space (FTCS) scheme requires the dimensionless diffusion number to be less than or equal to $1/2$:\n$$\n\\frac{D \\Delta t}{(\\Delta x)^2} = \\frac{K \\Delta t}{(1-\\lambda_p)(\\Delta x)^2} \\le \\frac{1}{2}\n$$\nThis imposes an upper limit on the time step:\n$$\n\\Delta t \\le \\frac{(1-\\lambda_p)(\\Delta x)^2}{2K}\n$$\nTo ensure stability, the implementation will select a time step $\\Delta t$ based on this CFL condition. The total simulation time $T$ will be divided into an integer number of steps, $N_{steps} = \\lceil T / \\Delta t_{max} \\rceil$, where $\\Delta t_{max}$ is the stability limit. The actual time step used is then $\\Delta t = T / N_{steps}$ to ensure the simulation ends exactly at time $T$. If $K=0$, the diffusive term vanishes, and the explicit scheme is stable for any $\\Delta t$. In this case, a uniform subdivision of $T$ into a sufficiently large number of steps is used as specified.\n\n### Part 4: Analytical Mass Balance Check\n\nThe quantity to be verified is the domain-averaged bed elevation change. This can be derived analytically by integrating the governing PDE over the entire domain $[0,L]$:\n$$\n\\int_0^L (1-\\lambda_p) \\frac{\\partial \\eta}{\\partial t} \\,dx = - \\int_0^L \\frac{\\partial q_s}{\\partial x} \\,dx\n$$\nAssuming constant $\\lambda_p$ and applying the fundamental theorem of calculus:\n$$\n(1-\\lambda_p) \\frac{d}{dt} \\left( \\int_0^L \\eta \\,dx \\right) = -[q_s(L,t) - q_s(0,t)]\n$$\nWith boundary conditions $q_s(0,t) = q_{\\text{in}}$ and $q_s(L,t) = q_{\\text{out}}$, this becomes:\n$$\n(1-\\lambda_p) \\frac{d}{dt} (L\\overline{\\eta}) = q_{\\text{in}} - q_{\\text{out}}\n$$\nwhere $\\overline{\\eta}(t) = \\frac{1}{L}\\int_0^L \\eta(x,t) dx$ is the domain-average elevation.\nIntegrating with respect to time from $0$ to $T$:\n$$\n(1-\\lambda_p) L (\\overline{\\eta}(T) - \\overline{\\eta}(0)) = (q_{\\text{in}} - q_{\\text{out}})T\n$$\nThe analytical domain-average change $\\overline{\\Delta \\eta}_{\\text{ana}} = \\overline{\\eta}(T) - \\overline{\\eta}(0)$ is thus:\n$$\n\\overline{\\Delta \\eta}_{\\text{ana}} = \\frac{(q_{\\text{in}} - q_{\\text{out}})T}{(1-\\lambda_p)L}\n$$\nThe implemented finite-volume method is conservative by construction. Therefore, the numerically computed average elevation change, $\\overline{\\Delta \\eta}_{\\text{num}}$, should theoretically be identical to $\\overline{\\Delta \\eta}_{\\text{ana}}$. The requested error $E = |\\overline{\\Delta \\eta}_{\\text{num}} - \\overline{\\Delta \\eta}_{\\text{ana}}|$ serves as a verification of the correct implementation of this conservative property, and any non-zero value will be due to floating-point arithmetic precision limits.",
            "answer": "[0.000000,0.000000,0.000000,0.000000,0.000000]"
        }
    ]
}