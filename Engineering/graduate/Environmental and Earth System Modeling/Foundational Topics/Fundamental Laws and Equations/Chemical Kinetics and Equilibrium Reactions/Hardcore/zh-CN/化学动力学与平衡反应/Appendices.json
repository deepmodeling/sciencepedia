{
    "hands_on_practices": [
        {
            "introduction": "在环境水化学中，准确预测溶解物质的化学形态（即形态分布）对其迁移、生物有效性和毒性至关重要。本练习将引导你从基本原理出发，为像磷酸这样的多质子酸构建一个形态分布模型。通过此过程，你将掌握如何应用质量作用定律和质量守恒定律，并学习如何使用戴维斯（Davies）方程来校正离子强度带来的非理想溶液效应。",
            "id": "3867376",
            "problem": "一个在受磷酸盐影响的含水层中的地下水样本，被近似为在$25\\,^{\\circ}\\mathrm{C}$下离子强度$I = 0.10\\,\\mathrm{mol\\,L^{-1}}$的均一水溶液。磷酸，通常表示为三元酸$H_{3}A$，经历逐步去质子化过程$H_{3}A \\rightleftharpoons H_{2}A^{-} + H^{+}$，$H_{2}A^{-} \\rightleftharpoons HA^{2-} + H^{+}$，以及$HA^{2-} \\rightleftharpoons A^{3-} + H^{+}$。在$25\\,^{\\circ}\\mathrm{C}$无限稀释条件下，其热力学（基于活度）酸解离常数由$pK_{a1}^{\\mathrm{a}} = 2.148$，$pK_{a2}^{\\mathrm{a}} = 7.198$和$pK_{a3}^{\\mathrm{a}} = 12.375$给出。测得的样本$\\mathrm{pH}$值为$7.50$（定义为$\\mathrm{pH} = -\\log_{10} a_{H^{+}}$，其中$a_{H^{+}}$是氢离子活度）。\n\n从质量作用定律、活度定义和多元酸的质量平衡出发，推导出当$j = 0,1,2,3$时物种分数$\\alpha_{j}(\\mathrm{pH})$的分布，其中$\\alpha_{j}$是总酸中以$H^{3-j}A^{j-}$形式存在的分数。然后，使用戴维斯（Davies）方程，考虑在给定离子强度下的非理想性，计算当$\\mathrm{pH} = 7.50$和$I = 0.10\\,\\mathrm{mol\\,L^{-1}}$时，以$A^{3-}$形式存在的分数$\\alpha_{3}$。\n\n使用Davies方程计算电荷为$z_{i}$的离子$i$在$25\\,^{\\circ}\\mathrm{C}$时的活度系数$\\gamma_{i}$，\n$$\n-\\log_{10}\\gamma_{i} \\;=\\; A z_{i}^{2}\\!\\left(\\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3\\,I\\right),\n$$\n其中$A = 0.51$，并假设中性物种的$\\gamma$为$1$。将报告的$\\mathrm{pH}$值视为基于活度，$a_{H^{+}} = 10^{-\\mathrm{pH}}$，并使用$a_{H^{+}} = \\gamma_{H^{+}}[H^{+}]$将其转换为自由质子浓度$[H^{+}]$。忽略所示酸碱反应之外的络合作用，并忽略超出活度系数所能描述范围的特定离子对效应。将$\\alpha_{3}$的最终数值答案四舍五入至四位有效数字。该分数为无量纲，且必须以小数（而非百分数）形式报告。",
            "solution": "该问题要求推导三元酸的物种分布，并计算在指定的pH值和离子强度条件下，完全去质子化物种$A^{3-}$的分数。解答必须使用Davies方程来考虑非理想行为。\n\n首先，我们推导物种分数$\\alpha_j$的一般表达式。磷酸$H_3A$的逐步去质子化由三个平衡描述：\n$$H_{3}A \\rightleftharpoons H_{2}A^{-} + H^{+} \\quad K_{a1}^{\\mathrm{a}} = \\frac{a_{H_{2}A^{-}} a_{H^{+}}}{a_{H_{3}A}}$$\n$$H_{2}A^{-} \\rightleftharpoons HA^{2-} + H^{+} \\quad K_{a2}^{\\mathrm{a}} = \\frac{a_{HA^{2-}} a_{H^{+}}}{a_{H_{2}A^{-}}}$$\n$$HA^{2-} \\rightleftharpoons A^{3-} + H^{+} \\quad K_{a3}^{\\mathrm{a}} = \\frac{a_{A^{3-}} a_{H^{+}}}{a_{HA^{2-}}}$$\n这里，$K_{aj}^{\\mathrm{a}}$是热力学（基于活度）酸解离常数，$a_i$代表物种$i$的活度。\n\n离子$i$的活度$a_i$与其摩尔浓度$[i]$的关系为$a_i = \\gamma_i [i]$，其中$\\gamma_i$是活度系数。对于像$H_3A$这样的中性物种，给定$\\gamma_{H_3A} = 1$。所有磷酸盐物种的总浓度$C_T$是各个物种浓度的总和：\n$$C_T = [H_3A] + [H_2A^-] + [HA^{2-}] + [A^{3-}]$$\n每个物种的分数$\\alpha_j$定义为该物种的浓度除以总浓度$C_T$。例如，$\\alpha_3 = [A^{3-}]/C_T$。\n\n为了找到$\\alpha_j$的表达式，我们将每个物种的浓度表示为相对于一个选定的参考物种。由于给定的pH值7.50与给定的$pK_{a2}^{\\mathrm{a}}$值7.198最接近，物种$H_2A^-$和$HA^{2-}$将占主导地位。我们选择$HA^{2-}$作为参考物种。\n\n从平衡表达式中，我们可以写出浓度比。设$\\gamma_0, \\gamma_1, \\gamma_2, \\gamma_3$分别为$H_3A, H_2A^-, HA^{2-}, A^{3-}$的活度系数。\n$$\\frac{[H_2A^-]}{[HA^{2-}]} = \\frac{a_{H_2A^-}/\\gamma_1}{a_{HA^{2-}}/\\gamma_2} = \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1}$$\n$$\\frac{[H_3A]}{[H_2A^-]} = \\frac{a_{H_3A}/\\gamma_0}{a_{H_2A^-}/\\gamma_1} = \\frac{a_{H^+}}{K_{a1}^{\\mathrm{a}}} \\frac{\\gamma_1}{\\gamma_0}$$\n$$\\frac{[A^{3-}]}{[HA^{2-}]} = \\frac{a_{A^{3-}}/\\gamma_3}{a_{HA^{2-}}/\\gamma_2} = \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3}$$\n结合这些，我们将所有浓度用$[HA^{2-}]$表示：\n$$[H_2A^-] = [HA^{2-}] \\left( \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1} \\right)$$\n$$[H_3A] = [H_2A^-] \\left( \\frac{a_{H^+}}{K_{a1}^{\\mathrm{a}}} \\frac{\\gamma_1}{\\gamma_0} \\right) = [HA^{2-}] \\left( \\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0} \\right)$$\n$$[A^{3-}] = [HA^{2-}] \\left( \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3} \\right)$$\n总浓度为：\n$$C_T = [HA^{2-}] \\left( \\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0} + \\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1} + 1 + \\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3} \\right)$$\n物种分数$\\alpha_j$的一般表达式是和中对应于该物种的项除以整个和。设分母（括号中的项）为$D$。那么物种分数分布为：\n$$\\alpha_0 = \\frac{1}{D} \\left(\\frac{(a_{H^+})^2}{K_{a1}^{\\mathrm{a}} K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_0}\\right), \\quad \\alpha_1 = \\frac{1}{D} \\left(\\frac{a_{H^+}}{K_{a2}^{\\mathrm{a}}} \\frac{\\gamma_2}{\\gamma_1}\\right), \\quad \\alpha_2 = \\frac{1}{D}, \\quad \\alpha_3 = \\frac{1}{D} \\left(\\frac{K_{a3}^{\\mathrm{a}}}{a_{H^+}} \\frac{\\gamma_2}{\\gamma_3}\\right)$$\n至此完成了所要求的物种分数分布$\\alpha_j(\\mathrm{pH})$的推导。\n\n现在，我们计算$\\alpha_3$的数值。给定的参数是：\n$\\mathrm{pH} = 7.50 \\implies a_{H^+} = 10^{-7.50}$\n$I = 0.10\\,\\mathrm{mol\\,L^{-1}}$\n$A = 0.51$\n$pK_{a1}^{\\mathrm{a}} = 2.148 \\implies K_{a1}^{\\mathrm{a}} = 10^{-2.148}$\n$pK_{a2}^{\\mathrm{a}} = 7.198 \\implies K_{a2}^{\\mathrm{a}} = 10^{-7.198}$\n$pK_{a3}^{\\mathrm{a}} = 12.375 \\implies K_{a3}^{\\mathrm{a}} = 10^{-12.375}$\n\n首先，我们使用Davies方程计算每个电荷为$z_i$的离子的活度系数$\\gamma_i$：\n$$-\\log_{10}\\gamma_{i} = A z_{i}^{2} \\left(\\frac{\\sqrt{I}}{1+\\sqrt{I}} - 0.3 I\\right)$$\n括号中的项对于本问题是一个常数：\n$$\\frac{\\sqrt{0.10}}{1+\\sqrt{0.10}} - 0.3(0.10) \\approx \\frac{0.316228}{1.316228} - 0.03 \\approx 0.240253 - 0.03 = 0.210253$$\n所以，$-\\log_{10}\\gamma_i = 0.51 z_i^2 (0.210253) = 0.107229 z_i^2$。这给出$\\log_{10}\\gamma_i = -0.107229 z_i^2$。\n\n磷酸盐物种的电荷为$z_0 = 0$（对于$H_3A$），$z_1 = -1$（对于$H_2A^-$），$z_2 = -2$（对于$HA^{2-}$），和$z_3 = -3$（对于$A^{3-}$）。\n$\\gamma_0 = \\gamma_{H_3A} = 1$（因为$z_0=0$）。\n$\\log_{10}\\gamma_1 = -0.107229(-1)^2 = -0.107229 \\implies \\gamma_1 = 10^{-0.107229} \\approx 0.78121$\n$\\log_{10}\\gamma_2 = -0.107229(-2)^2 = -0.428916 \\implies \\gamma_2 = 10^{-0.428916} \\approx 0.37246$\n$\\log_{10}\\gamma_3 = -0.107229(-3)^2 = -0.965061 \\implies \\gamma_3 = 10^{-0.965061} \\approx 0.10838$\n\n接下来，我们计算分母$D$中的各项：\n设$T_0=\\frac{[H_3A]}{[HA^{2-}]}$，$T_1=\\frac{[H_2A^-]}{[HA^{2-}]}$，$T_2=1$，$T_3=\\frac{[A^{3-}]}{[HA^{2-}]}$。\n\n$T_0 = \\frac{(10^{-7.50})^2}{10^{-2.148} \\cdot 10^{-7.198}} \\frac{0.37246}{1} = \\frac{10^{-15.00}}{10^{-9.346}} (0.37246) = 10^{-5.654} (0.37246) \\approx 8.26 \\times 10^{-7}$\n$T_1 = \\frac{10^{-7.50}}{10^{-7.198}} \\frac{0.37246}{0.78121} = 10^{-0.302} (0.47677) \\approx 0.49888 \\times 0.47677 \\approx 0.23787$\n$T_2 = 1$\n$T_3 = \\frac{10^{-12.375}}{10^{-7.50}} \\frac{0.37246}{0.10838} = 10^{-4.875} (3.4367) \\approx (1.3335 \\times 10^{-5}) \\times 3.4367 \\approx 4.583 \\times 10^{-5}$\n\n分母是这些项的和：\n$D = T_0 + T_1 + T_2 + T_3 \\approx (8.26 \\times 10^{-7}) + 0.23787 + 1 + (4.583 \\times 10^{-5}) \\approx 1.23792$\n\n分数$\\alpha_3$是项$T_3$与总和$D$的比值：\n$$\\alpha_3 = \\frac{T_3}{D} = \\frac{4.583 \\times 10^{-5}}{1.23792} \\approx 3.7021 \\times 10^{-5}$$\n四舍五入到四位有效数字，我们得到$3.702 \\times 10^{-5}$。按要求转换为小数：\n$$\\alpha_3 = 0.00003702$$\n这反映了这样一个事实：在pH=7.50时，该值远低于有效三级解离常数（$pK_{a3}' \\approx 11.8$），因此完全去质子化物种$A^{3-}$的份额预计会非常小。",
            "answer": "$$\\boxed{0.00003702}$$"
        },
        {
            "introduction": "虽然简单体系的化学平衡可以解析求解，但真实环境水体（如湖泊、河流和地下水）通常包含多个相互作用的酸碱系统，使得解析求解变得不切实际。本练习展示了如何基于电中性原理，为复杂的多组分水溶液建立一个综合平衡模型。你将学习如何运用牛顿–拉弗森（Newton–Raphson）等数值方法来求解系统的主控变量（如$\\mathrm{pH}$），这是现代地球化学模拟软件的核心计算任务。",
            "id": "3867365",
            "problem": "考虑一个封闭、混合均匀的水溶液体系，温度为 $25\\,^{\\circ}\\mathrm{C}$，其中的质子转移反应受化学质量作用定律、水的自电离以及各元素质量守恒的支配。该体系包含水、溶解性无机碳、硼和总氨，以及作为固定背景阳离子和阴离子的非反应性强离子。待求的未知量是以 $\\mathrm{pH}$ 计量的酸度，定义为 $\\mathrm{pH} = -\\log_{10}([\\mathrm{H}^{+}])$，其中 $[\\mathrm{H}^{+}]$ 是氢离子的摩尔浓度，单位为 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$。\n\n基本依据如下：\n- 电中性（电荷平衡）：在封闭水溶液中，正电荷总和等于负电荷总和。\n- 稀溶液条件下酸碱平衡的化学质量作用定律。\n- 水在 $25\\,^{\\circ}\\mathrm{C}$ 时的自电离。\n- 每种守恒总量的质量守恒（例如，总无机碳）。\n\n假设在 $25\\,^{\\circ}\\mathrm{C}$ 时，以下平衡和定义成立：\n- 水的自电离：$K_w = [\\mathrm{H}^{+}][\\mathrm{OH}^{-}]$，其中 $K_w = 10^{-14}$。\n- 碳酸盐体系：$\\mathrm{H}_2\\mathrm{CO}_3 \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{HCO}_3^{-}$，其中 $K_1 = 10^{-6.3}$；以及 $\\mathrm{HCO}_3^{-} \\rightleftharpoons \\mathrm{H}^{+} + \\mathrm{CO}_3^{2-}$，其中 $K_2 = 10^{-10.3}$；定义总溶解无机碳 $C_T = [\\mathrm{H}_2\\mathrm{CO}_3] + [\\mathrm{HCO}_3^{-}] + [\\mathrm{CO}_3^{2-}]$。\n- 硼体系：$\\mathrm{B(OH)}_3 + \\mathrm{H}_2\\mathrm{O} \\rightleftharpoons \\mathrm{B(OH)}_4^{-} + \\mathrm{H}^{+}$，其中 $K_B = 10^{-9.24}$；定义总硼 $B_T = [\\mathrm{B(OH)}_3] + [\\mathrm{B(OH)}_4^{-}]$。\n- 氨/铵体系：$\\mathrm{NH}_4^{+} \\rightleftharpoons \\mathrm{NH}_3 + \\mathrm{H}^{+}$，酸度常数 $K_{a,\\mathrm{NH}_4} = 10^{-9.25}$；定义总氨 $N_T = [\\mathrm{NH}_3] + [\\mathrm{NH}_4^{+}]$。\n- 固定的强一价阳离子浓度 $S_c$（例如钠）和固定的强一价阴离子浓度 $S_a$（例如氯化物），它们不参与酸碱平衡。\n\n对于给定的 $[\\mathrm{H}^{+}] = H$，各物种的浓度由平衡约束和总浓度决定：\n- $[\\mathrm{OH}^{-}] = K_w / H$。\n- 碳酸盐物种形成分数由质量作用定律和 $C_T$ 守恒导出，分母为 $D(H) = H^2 + K_1 H + K_1 K_2$。则 $[\\mathrm{HCO}_3^{-}] = C_T \\,\\alpha_1(H)$ 且 $[\\mathrm{CO}_3^{2-}] = C_T \\,\\alpha_2(H)$，其中 $\\alpha_1(H) = \\dfrac{K_1 H}{D(H)}$ 且 $\\alpha_2(H) = \\dfrac{K_1 K_2}{D(H)}$。\n- 硼：$[\\mathrm{B(OH)}_4^{-}] = B_T \\,\\dfrac{K_B}{H + K_B}$。\n- 氨/铵：$[\\mathrm{NH}_4^{+}] = N_T \\,\\dfrac{H}{H + K_{a,\\mathrm{NH}_4}}$。\n\n电中性原理给出了耦合所有平衡的标量方程，\n$$\nf(H) \\equiv \\underbrace{H}_{[\\mathrm{H}^{+}]} + \\underbrace{S_c}_{\\text{固定阳离子}} + \\underbrace{N_T \\,\\frac{H}{H + K_{a,\\mathrm{NH}_4}}}_{[\\mathrm{NH}_4^{+}]} \\;-\\; \\underbrace{\\frac{K_w}{H}}_{[\\mathrm{OH}^{-}]} \\;-\\; \\underbrace{S_a}_{\\text{固定阴离子}} \\;-\\; \\underbrace{C_T \\,\\alpha_1(H)}_{[\\mathrm{HCO}_3^{-}]} \\;-\\; \\underbrace{2\\,C_T \\,\\alpha_2(H)}_{2[\\mathrm{CO}_3^{2-}]} \\;-\\; \\underbrace{B_T \\,\\frac{K_B}{H + K_B}}_{[\\mathrm{B(OH)}_4^{-}]} \\;=\\; 0.\n$$\n\n你的任务是通过在变量 $H$ 上使用牛顿-拉夫逊求根法求解 $f(H) = 0$ 来计算 $\\mathrm{pH}$。通过对 $f(H)$ 关于 $H$ 求导，推导出牛顿-拉夫逊迭代更新式 $H_{n+1} = H_n - f(H_n)/f'(H_n)$，并实现一个鲁棒的算法，确保 $H$ 保持在物理上有意义的界限 $H \\in [10^{-14}, 10^{0}]$ 内，对应于 $\\mathrm{pH} \\in [14, 0]$。如果牛顿-拉夫逊法从中性初始猜测值开始未能收敛，则在 $\\log_{10}(H)$ 上实现一个后备的区间搜索法来定位符号变化点，然后使用二分法收敛到根。\n\n所有浓度必须以 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$ 为单位处理，最终答案必须以 $\\mathrm{pH}$ 值表示。你的程序必须为每个测试用例生成一个四舍五入到四位小数的浮点数 $\\mathrm{pH}$。要求的最终输出格式是单行包含一个由方括号括起来的逗号分隔的 $\\mathrm{pH}$ 值列表，例如 $[\\mathrm{pH}_1,\\mathrm{pH}_2,\\mathrm{pH}_3]$。\n\n使用以下参数值（$(C_T,B_T,N_T,S_c,S_a)$，单位为 $\\mathrm{mol}\\,\\mathrm{L}^{-1}$）的测试套件：\n1. 案例 1（基准纯水）：$(0, 0, 0, 0, 0)$。\n2. 案例 2（不含固定强离子的封闭碳酸盐-硼体系）：$(2\\times 10^{-3}, 4\\times 10^{-4}, 0, 0, 0)$。\n3. 案例 3（具有过量固定阳离子和混合弱酸/碱的碱性趋势）：$(1\\times 10^{-3}, 4\\times 10^{-4}, 1\\times 10^{-5}, 1\\times 10^{-3}, 2\\times 10^{-4})$。\n4. 案例 4（存在过量固定阴离子和氨的酸性趋势）：$(1\\times 10^{-4}, 0, 1\\times 10^{-4}, 2\\times 10^{-4}, 1\\times 10^{-3})$。\n5. 案例 5（氨主导，无碳酸盐或硼，无固定强离子）：$(0, 0, 3\\times 10^{-3}, 0, 0)$。\n\n你的程序应该生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果（例如 $[x_1,x_2,x_3,x_4,x_5]$），其中每个 $x_i$ 是案例 $i$ 的 $\\mathrm{pH}$ 值，四舍五入到四位小数。",
            "solution": "该问题陈述已经过仔细验证，并被确定为有效。它在科学上基于水溶液化学平衡原理，问题良构，对于氢离子浓度有唯一解，并且以客观、正式的语言陈述。它提出了一个非平凡的计算化学问题，没有矛盾、歧义或不合理的假设。因此，我们可以着手解决。\n\n问题的核心是通过求解一个源自电中性原理的非线性代数方程，来找到复杂水溶液中的氢离子浓度，记为 $H \\equiv [\\mathrm{H}^{+}]$。然后根据其定义 $\\mathrm{pH} = -\\log_{10}(H)$ 计算 pH 值。\n\n电荷平衡或电中性方程要求所有正电荷的摩尔浓度之和等于所有负电荷的摩尔浓度之和。体系中的带电物种为：\n- 阳离子：$\\mathrm{H}^{+}$、$\\mathrm{NH}_4^{+}$ 和总浓度为 $S_c$ 的固定强阳离子。\n- 阴离子：$\\mathrm{OH}^{-}$、$\\mathrm{HCO}_3^{-}$、$\\mathrm{CO}_3^{2-}$、$\\mathrm{B(OH)}_4^{-}$ 和总浓度为 $S_a$ 的固定强阴离子。\n\n因此，电中性条件是：\n$$[\\mathrm{H}^{+}] + [\\mathrm{NH}_4^{+}] + S_c = [\\mathrm{OH}^{-}] + [\\mathrm{HCO}_3^{-}] + 2[\\mathrm{CO}_3^{2-}] + [\\mathrm{B(OH)}_4^{-}] + S_a$$\n$[\\mathrm{CO}_3^{2-}]$ 的系数 $2$ 是因为其带有双负电荷。\n\n问题给出了每种弱酸/碱物种浓度作为 $H$ 和总浓度（$C_T$、$B_T$、$N_T$）的函数的表达式。这些表达式是从质量作用定律和各元素组的质量守恒定律推导出来的。将这些表达式代入电中性方程并重新整理，得到求根问题 $f(H) = 0$，其中：\n$$\nf(H) = H + S_c + N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}} - \\frac{K_w}{H} - S_a - C_T \\left( \\frac{K_1 H}{H^2 + K_1 H + K_1 K_2} + \\frac{2 K_1 K_2}{H^2 + K_1 H + K_1 K_2} \\right) - B_T \\frac{K_B}{H + K_B}\n$$\n这可以更紧凑地写成：\n$$\nf(H) = H + S_c + N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}} - \\frac{K_w}{H} - S_a - C_T \\frac{K_1 H + 2 K_1 K_2}{H^2 + K_1 H + K_1 K_2} - B_T \\frac{K_B}{H + K_B}\n$$\n\n为使用牛顿-拉夫逊法求解 $f(H) = 0$，我们需要 $f(H)$ 对 $H$ 的导数，记为 $f'(H)$。迭代过程由 $H_{n+1} = H_n - f(H_n)/f'(H_n)$ 给出。我们通过对 $f(H)$ 的每一项进行微分来推导 $f'(H)$：\n- $\\frac{d}{dH}(H) = 1$\n- $\\frac{d}{dH}(S_c) = 0$\n- $\\frac{d}{dH}\\left(N_T \\frac{H}{H + K_{a,\\mathrm{NH}_4}}\\right) = N_T \\frac{(1)(H + K_{a,\\mathrm{NH}_4}) - H(1)}{(H + K_{a,\\mathrm{NH}_4})^2} = N_T \\frac{K_{a,\\mathrm{NH}_4}}{(H + K_{a,\\mathrm{NH}_4})^2}$\n- $\\frac{d}{dH}\\left(-\\frac{K_w}{H}\\right) = \\frac{K_w}{H^2}$\n- $\\frac{d}{dH}(-S_a) = 0$\n- 对于碳酸盐项，令 $N(H) = K_1 H + 2K_1 K_2$ 且 $D(H) = H^2 + K_1 H + K_1 K_2$。则 $N'(H) = K_1$ 且 $D'(H) = 2H + K_1$。使用商法则：\n  $\\frac{d}{dH}\\left(\\frac{N(H)}{D(H)}\\right) = \\frac{N'(H)D(H) - N(H)D'(H)}{D(H)^2} = \\frac{K_1(H^2+K_1H+K_1K_2) - (K_1H+2K_1K_2)(2H+K_1)}{D(H)^2}$\n  分子简化为 $-K_1 H^2 - 4K_1 K_2 H - K_1^2 K_2 = -K_1(H^2 + 4K_2 H + K_1 K_2)$。\n  因此，整个碳酸盐项的导数为 $-C_T \\left( \\frac{-K_1(H^2 + 4K_2 H + K_1 K_2)}{D(H)^2} \\right) = C_T \\frac{K_1(H^2 + 4K_2 H + K_1 K_2)}{(H^2 + K_1 H + K_1 K_2)^2}$。\n- $\\frac{d}{dH}\\left(-B_T \\frac{K_B}{H + K_B}\\right) = -B_T K_B \\frac{-1}{(H+K_B)^2} = B_T \\frac{K_B}{(H + K_B)^2}$\n\n合并所有项，完整的导数是：\n$$\nf'(H) = 1 + \\frac{K_w}{H^2} + N_T \\frac{K_{a,\\mathrm{NH}_4}}{(H + K_{a,\\mathrm{NH}_4})^2} + C_T \\frac{K_1(H^2 + 4K_2H + K_1K_2)}{(H^2 + K_1H + K_1K_2)^2} + B_T \\frac{K_B}{(H + K_B)^2}\n$$\n对于有物理意义的浓度（$H0$），所有常数（$K_i$）和总浓度（$C_T$、$B_T$、$N_T$）都是非负的。因此，$f'(H)$ 表达式中的所有项都是非负的，且前两项（$1 + K_w/H^2$）是严格为正的。因此，$f'(H)  0$ 对所有 $H0$ 成立。这证明了 $f(H)$ 是 $H$ 的一个严格单调递增函数，从而保证最多只有一个根。因为当 $H \\to 0^+$ 时 $f(H) \\to -\\infty$（由于 $-K_w/H$ 项），而当 $H \\to \\infty$ 时 $f(H) \\to +\\infty$（由于 $H$ 项），所以 $H$ 的唯一正根必定存在。\n\n数值算法实现如下：\n1.  为给定的测试用例初始化常数和参数。\n2.  尝试使用牛顿-拉夫逊法找到根，从一个中性猜测值 $H_0 = 10^{-7} \\, \\mathrm{mol}\\,\\mathrm{L}^{-1}$ 开始。\n3.  迭代过程为 $H_{n+1} = H_n - f(H_n)/f'(H_n)$。当 $H$ 的变化量小于预设容差（例如 $10^{-15}$）时，迭代停止。迭代次数被限制（例如，限制为 $50$ 次）以检测不收敛的情况。\n4.  在每一步执行一个关键的鲁棒性检查：如果下一个迭代值 $H_{n+1}$ 超出物理上合理的界限 $H \\in [10^{-14}, 1]$，则认为牛顿-拉夫逊法失败。\n5.  如果牛顿-拉夫逊法失败（由于超过迭代限制或产生越界估计值），则启动一个更鲁棒的后备方法。\n6.  后备方法是二分法算法。由于 $f(H)$ 是单调的，并且我们知道对于典型的化学浓度，$f(10^{-14})  0$ 且 $f(1) > 0$，因此区间 $[10^{-14}, 1]$ 为根提供了一个保证存在的区间。二分法通过反复将该区间减半，同时确保根仍在区间内，从而可靠地（尽管速度较慢地）收敛到解。二分法一直持续到区间宽度小于设定的容差为止。\n7.  一旦找到根 $H$，就计算 pH 值为 $\\mathrm{pH} = -\\log_{10}(H)$，并按要求四舍五入到四位小数。\n\n这种两阶段策略结合了牛顿-拉夫逊法的快速收敛性和二分法的保证稳定性，为这类化学平衡问题提供了一个鲁棒的求解器。",
            "answer": "[7.0000,8.3582,9.3905,5.9525,10.9575]"
        },
        {
            "introduction": "从平衡问题转向动力学问题，许多关键的环境过程，例如污染物的生物降解，是由反应速率而非最终平衡状态决定的。本练习旨在解决数值求解动力学方程时遇到的挑战，特别是生物地球化学中常见的“刚性”方程组。你将为一个遵循蒙诺（Monod）速率方程的底物消耗过程，推导并实现一个稳健的隐式数值积分方案（即带有牛顿–拉弗森求解器的后向欧拉法），这是环境和生态模型中不可或缺的一项技能。",
            "id": "3867366",
            "problem": "在一个充分混合的水生控制体积中，一种溶解性有机底物被一个微生物群落根据饱和（Monod）速率定律进行生物降解。令 $C(t)$ 表示底物浓度，单位为 $\\mathrm{mol\\, m^{-3}}$。忽略输运并假设体积恒定，其质量平衡为\n$$\\frac{dC}{dt} \\;=\\; -r(C),$$\n其中体积反应速率 $r(C)$ 服从 Monod 形式\n$$r(C) \\;=\\; V_{\\max}\\,\\frac{C}{K + C},$$\n其中 $V_{\\max}$ 是最大体积消耗速率，$K$ 是半饱和常数。考虑一个从 $t_n$ 到 $t_{n+1}=t_n+\\Delta t$ 的单个隐式时间步长，使用后向欧拉时间积分。从给定的常微分方程 (ODE) 出发，推导 $C_{n+1}$ 的后向欧拉离散更新式以及必须求解的相应非线性残差函数。然后，构建 Newton–Raphson 迭代，包括显式标量雅可比矩阵，以求解该隐式步骤。采用以下收敛准则：当绝对残差满足 $|F(C_{n+1}^{(k)})| \\le \\tau_F$ 或相对变化满足 $\\left|\\Delta C^{(k)}\\right|/\\left|C_{n+1}^{(k)}\\right| \\le \\tau_x$ 时，终止 Newton–Raphson 迭代，其中 $F$ 是残差，$\\Delta C^{(k)}$ 是第 $k$ 次迭代的 Newton 校正量，$(\\tau_F,\\tau_x)$ 是指定的容差。\n\n使用以下参数值\n$$V_{\\max} \\;=\\; 1.5 \\times 10^{-7},\\quad K \\;=\\; 1.0 \\times 10^{-4},\\quad C_n \\;=\\; 5.0 \\times 10^{-4},\\quad \\Delta t \\;=\\; 900,$$\n所有量均采用一致的国际单位制（SI）单位，因此 $C$ 的单位是 $\\mathrm{mol\\, m^{-3}}$，时间单位是 $\\mathrm{s}$，以及以下容差\n$$\\tau_F \\;=\\; 1.0 \\times 10^{-8} \\quad \\text{and} \\quad \\tau_x \\;=\\; 1.0 \\times 10^{-8},$$\n从初始猜测值 $C_{n+1}^{(0)}=C_n$ 开始执行 Newton–Raphson 迭代，并计算满足所述收敛准则的更新后浓度 $C_{n+1}$。将最终数值答案四舍五入到四位有效数字。以 $\\mathrm{mol\\, m^{-3}}$ 为单位表示最终浓度。",
            "solution": "对问题进行验证。\n\n### 第 1 步：提取已知条件\n- **控制方程**：底物浓度 $C(t)$ 的质量平衡由以下常微分方程 (ODE) 给出：\n$$\n\\frac{dC}{dt} = -r(C)\n$$\n- **反应速率定律**：体积反应速率 $r(C)$ 是一个 Monod 函数：\n$$\nr(C) = V_{\\max}\\,\\frac{C}{K + C}\n$$\n- **数值方法**：使用后向欧拉法，从 $t_n$ 到 $t_{n+1}=t_n+\\Delta t$ 的单个隐式时间步长。\n- **任务**：\n  1. 推导后向欧拉离散更新式和非线性残差函数 $F(C_{n+1})$。\n  2. 构建 Newton–Raphson 迭代，包括显式标量雅可比矩阵，以求解该隐式步骤。\n  3. 使用一组特定参数和一个初始猜测值，执行 Newton–Raphson 迭代以求得 $C_{n+1}$。\n- **参数值**：\n  - 最大速率, $V_{\\max} = 1.5 \\times 10^{-7} \\, \\mathrm{mol\\, m^{-3}\\, s^{-1}}$\n  - 半饱和常数, $K = 1.0 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$\n  - $t_n$ 时刻的初始浓度, $C_n = 5.0 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$\n  - 时间步长, $\\Delta t = 900 \\, \\mathrm{s}$\n- **初始猜测值**：对于 Newton–Raphson 方法，新时间步长浓度的初始猜测值为 $C_{n+1}^{(0)} = C_n$。\n- **收敛准则**：当第 $k$ 次迭代满足以下任一条件时，终止 Newton–Raphson 迭代：\n  1. 绝对残差: $|F(C_{n+1}^{(k)})| \\le \\tau_F$\n  2. 相对变化: $|\\Delta C^{(k)}|/|C_{n+1}^{(k)}| \\le \\tau_x$\n- **容差**：\n  - 残差容差, $\\tau_F = 1.0 \\times 10^{-8}$\n  - 相对变化容差, $\\tau_x = 1.0 \\times 10^{-8}$\n- **最终输出要求**：$C_{n+1}$ 的最终数值答案应四舍五入到四位有效数字。\n\n### 第 2 步：使用提取的已知条件进行验证\n1.  **科学依据**：该问题基于微生物动力学的 Monod 模型和用于数值积分的后向欧拉法。两者都是环境工程和计算科学中标准且被广泛接受的原理。该模型在科学上是合理的。\n2.  **适定性**：问题定义清晰。它要求推导一个数值方案并应用它，同时提供了所有必要的参数。对于正浓度，Monod 函数是良态的，而后向欧拉法是 A-稳定的，使其适用于这类刚性动力学问题。预期会得到一个唯一、稳定的 $C_{n+1}$ 解。\n3.  **客观性**：问题以精确、形式化的数学语言陈述，没有歧义或主观论断。\n4.  **完整性和一致性**：问题是自洽的。它提供了控制方程、速率定律、所有参数值、要使用的数值方法、迭代的初始条件以及明确的收敛准则。没有矛盾之处。\n5.  **现实性和可行性**：对于水生环境中的微生物降解过程，参数值在物理上是现实的。所需的任务是标准的计算程序。\n\n### 第 3 步：结论与行动\n经检验，该问题是有效的，因为它具有科学依据、适定、客观且自洽。现在开始求解过程。\n\n### 求解推导\n\n**1. 后向欧拉离散化与残差函数**\n\n控制 ODE 为：\n$$\n\\frac{dC}{dt} = -V_{\\max}\\,\\frac{C}{K + C}\n$$\n应用后向欧拉法，我们在时间 $t_{n+1}$ 处近似时间导数，并在 $t_{n+1}$ 处计算右侧项：\n$$\n\\frac{C_{n+1} - C_n}{\\Delta t} = -V_{\\max}\\,\\frac{C_{n+1}}{K + C_{n+1}}\n$$\n这是 $C_{n+1}$ 的隐式离散更新方程。为了求解 $C_{n+1}$，我们通过重排方程使其等于零，定义一个残差函数 $F(C_{n+1})$：\n$$\nF(C_{n+1}) = C_{n+1} - C_n + \\Delta t \\, V_{\\max} \\, \\frac{C_{n+1}}{K + C_{n+1}} = 0\n$$\n这是必须为 $C_{n+1}$ 求解的非线性代数方程。\n\n**2. Newton–Raphson 构建**\n\nNewton–Raphson 方法是一种迭代求根算法。对于一个标量函数 $F(x)$，其迭代公式为：\n$$\nx^{(k+1)} = x^{(k)} - \\frac{F(x^{(k)})}{F'(x^{(k)})}\n$$\n在我们的问题中，$x$ 对应于 $C_{n+1}$。$C_{n+1}$ 的迭代公式是：\n$$\nC_{n+1}^{(k+1)} = C_{n+1}^{(k)} - \\frac{F(C_{n+1}^{(k)})}{J(C_{n+1}^{(k)})}\n$$\n其中 $k$ 是迭代指数，$J(C_{n+1})$ 是标量雅可比矩阵，即残差函数关于 $C_{n+1}$ 的导数，即 $J(C) = F'(C)$。\n\n让我们计算雅可比矩阵 $J(C)$：\n$$\nJ(C) = \\frac{d}{dC} F(C) = \\frac{d}{dC} \\left( C - C_n + \\Delta t \\, V_{\\max} \\, \\frac{C}{K + C} \\right)\n$$\n第一项 $C$ 的导数是 $1$。第二项 $-C_n$ 是关于 $C$ 的常数，所以其导数为 $0$。对于第三项，我们使用微分学的商法则 $\\frac{d}{dx}\\left(\\frac{u}{v}\\right) = \\frac{u'v - uv'}{v^2}$：\n$$\n\\frac{d}{dC}\\left(\\frac{C}{K + C}\\right) = \\frac{(1)(K + C) - (C)(1)}{(K + C)^2} = \\frac{K}{(K + C)^2}\n$$\n综合这些结果，雅可比矩阵为：\n$$\nJ(C) = 1 + \\Delta t \\, V_{\\max} \\, \\frac{K}{(K + C)^2}\n$$\n第 $k$ 次迭代的 Newton 校正量为 $\\Delta C^{(k)} = -F(C_{n+1}^{(k)})/J(C_{n+1}^{(k)})$，更新后的值为 $C_{n+1}^{(k+1)} = C_{n+1}^{(k)} + \\Delta C^{(k)}$。\n\n**3. 数值计算**\n\n给定以下数值：\n$V_{\\max} = 1.5 \\times 10^{-7}$, $K = 1.0 \\times 10^{-4}$, $C_n = 5.0 \\times 10^{-4}$, $\\Delta t = 900$。\n函数的常数为：\n$\\Delta t \\, V_{\\max} = 900 \\times (1.5 \\times 10^{-7}) = 1.35 \\times 10^{-4}$。\n$\\Delta t \\, V_{\\max} \\, K = (1.35 \\times 10^{-4}) \\times (1.0 \\times 10^{-4}) = 1.35 \\times 10^{-8}$。\n\n迭代所用的函数为：\n$$\nF(C) = C - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{C}{1.0 \\times 10^{-4} + C}\n$$\n$$\nJ(C) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + C)^2}\n$$\n容差为 $\\tau_F = 1.0 \\times 10^{-8}$ 和 $\\tau_x = 1.0 \\times 10^{-8}$。初始猜测值为 $C_{n+1}^{(0)} = C_n = 5.0 \\times 10^{-4}$。\n\n**迭代 $k=0$**：\n$C_{n+1}^{(0)} = 5.0 \\times 10^{-4}$。\n$F(C_{n+1}^{(0)}) = 5.0 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{5.0 \\times 10^{-4}}{1.0 \\times 10^{-4} + 5.0 \\times 10^{-4}} = (1.35 \\times 10^{-4}) \\frac{5}{6} = 1.125 \\times 10^{-4}$。\n$|F(C_{n+1}^{(0)})| = 1.125 \\times 10^{-4}  \\tau_F$。\n$J(C_{n+1}^{(0)}) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + 5.0 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{(6.0 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{36.0 \\times 10^{-8}} = 1 + 0.0375 = 1.0375$。\n$\\Delta C^{(0)} = -\\frac{F(C_{n+1}^{(0)})}{J(C_{n+1}^{(0)})} = -\\frac{1.125 \\times 10^{-4}}{1.0375} \\approx -1.0843373 \\times 10^{-4}$。\n$C_{n+1}^{(1)} = C_{n+1}^{(0)} + \\Delta C^{(0)} = 5.0 \\times 10^{-4} - 1.0843373 \\times 10^{-4} = 3.9156627 \\times 10^{-4}$。\n相对变化：$|\\Delta C^{(0)}|/|C_{n+1}^{(1)}| \\approx |-1.084 \\times 10^{-4}|/|3.916 \\times 10^{-4}| \\approx 0.277  \\tau_x$。\n\n**迭代 $k=1$**：\n$C_{n+1}^{(1)} = 3.9156627 \\times 10^{-4}$。\n$F(C_{n+1}^{(1)}) = 3.9156627 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{3.9156627 \\times 10^{-4}}{1.0 \\times 10^{-4} + 3.9156627 \\times 10^{-4}} \\approx -1.0843373 \\times 10^{-4} + 1.0753575 \\times 10^{-4} \\approx -8.9798 \\times 10^{-7}$。\n$|F(C_{n+1}^{(1)})| \\approx 8.98 \\times 10^{-7}  \\tau_F$。\n$J(C_{n+1}^{(1)}) = 1 + \\frac{1.35 \\times 10^{-8}}{(1.0 \\times 10^{-4} + 3.9156627 \\times 10^{-4})^2} = 1 + \\frac{1.35 \\times 10^{-8}}{(4.9156627 \\times 10^{-4})^2} \\approx 1 + \\frac{1.35 \\times 10^{-8}}{2.41637 \\times 10^{-7}} \\approx 1 + 0.055869 = 1.055869$。\n$\\Delta C^{(1)} = -\\frac{-8.9798 \\times 10^{-7}}{1.055869} \\approx 8.50468 \\times 10^{-7}$。\n$C_{n+1}^{(2)} = C_{n+1}^{(1)} + \\Delta C^{(1)} = 3.9156627 \\times 10^{-4} + 8.50468 \\times 10^{-7} = 3.9241674 \\times 10^{-4}$。\n相对变化：$|\\Delta C^{(1)}|/|C_{n+1}^{(2)}| \\approx |8.505 \\times 10^{-7}|/|3.924 \\times 10^{-4}| \\approx 0.00217  \\tau_x$。\n\n**迭代 $k=2$**：\n$C_{n+1}^{(2)} = 3.9241674 \\times 10^{-4}$。\n$F(C_{n+1}^{(2)}) = 3.9241674 \\times 10^{-4} - 5.0 \\times 10^{-4} + (1.35 \\times 10^{-4}) \\frac{3.9241674 \\times 10^{-4}}{1.0 \\times 10^{-4} + 3.9241674 \\times 10^{-4}} \\approx -1.0758326 \\times 10^{-4} + 1.0758401 \\times 10^{-4} \\approx 7.5 \\times 10^{-10}$。\n$|F(C_{n+1}^{(2)})| \\approx 7.5 \\times 10^{-10}$。\n我们检查绝对残差的收敛准则：\n$|F(C_{n+1}^{(2)})| \\approx 7.5 \\times 10^{-10} \\le \\tau_F = 1.0 \\times 10^{-8}$。\n准则已满足。迭代终止。\n\n时间 $t_{n+1}$ 时浓度的收敛值为 $C_{n+1} \\approx 3.9241674 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$。\n按要求将结果四舍五入到四位有效数字：\n$C_{n+1} \\approx 3.924 \\times 10^{-4} \\, \\mathrm{mol\\, m^{-3}}$。",
            "answer": "$$\\boxed{3.924 \\times 10^{-4}}$$"
        }
    ]
}