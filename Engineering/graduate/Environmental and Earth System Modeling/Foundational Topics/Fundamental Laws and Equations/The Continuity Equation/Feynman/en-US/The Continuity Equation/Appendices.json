{
    "hands_on_practices": [
        {
            "introduction": "This first exercise grounds our understanding in the integral form of the continuity equation. We'll act as environmental accountants, meticulously tracking every source, sink, and flux of a conserved substance within a defined coastal embayment. This practice hones the essential skill of performing a mass balance calculation—the bedrock of all conservative models—by requiring careful integration of boundary fluxes and internal volumetric sources to predict the net change in total mass over time .",
            "id": "3921745",
            "problem": "A coastal embayment is idealized as a rectangular control volume with horizontal coordinates $x \\in [0,L]$, $y \\in [0,W]$, and vertical coordinate $z \\in [0,H]$ measured upward from the bed. A conserved dissolved tracer with total mass $M(t)$ is transported across the open lateral boundaries, deposited at the air–sea interface, taken up at the sediment–water interface, and produced within the water column by a volumetric source. All processes are assumed constant in time over the step $[t_{0},t_{0}+\\Delta t]$, spatially uniform where specified, and scientifically consistent.\n\nGeometry and timing:\n- $L = 5000\\,\\mathrm{m}$, $W = 2000\\,\\mathrm{m}$, $H = 15\\,\\mathrm{m}$.\n- $\\Delta t = 2.0\\,\\mathrm{hours}$.\n\nBoundary fluxes and internal sources (sign convention: positive values increase mass inside the domain; negative values decrease it):\n- Time-averaged integrated lateral flux rate across the western open boundary: $F_{\\mathrm{W}} = +1.80 \\times 10^{4}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$.\n- Time-averaged integrated lateral flux rate across the eastern open boundary: $F_{\\mathrm{E}} = -2.10 \\times 10^{4}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$.\n- Uniform deposition flux density over the surface: $q_{\\mathrm{surf}} = +3.50 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$, applied over the area $A_{\\mathrm{surf}} = L W$.\n- Uniform uptake flux density at the bed: $q_{\\mathrm{bot}} = -1.20 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$, applied over the area $A_{\\mathrm{bot}} = L W$.\n- Volumetric source distribution in the interior: $s(x,y,z) = s_{0}\\,\\bigl[1 + \\alpha\\,(x/L) + \\beta\\,(y/W)\\bigr]\\,(z/H)$ with $s_{0} = 2.00 \\times 10^{-8}\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$, $\\alpha = 0.25$, and $\\beta = -0.10$.\n\nStarting from the fundamental principle of mass conservation and the definitions of flux and source, compute the total mass change $\\Delta M = M(t_{0}+\\Delta t) - M(t_{0})$ over the time step by consistently aggregating the lateral boundary contributions, the surface and bottom fluxes, and the integrated volumetric source. Express the final result in $\\mathrm{kg}$ and round your answer to four significant figures.",
            "solution": "The problem requires the computation of the total change in mass, $\\Delta M$, of a conserved tracer within a specified rectangular control volume over a time interval $\\Delta t$. The governing principle is the law of mass conservation, which can be expressed in its integral form for a control volume $V$. The rate of change of the total mass $M(t)$ within the volume is the sum of all mass fluxes across its boundaries and all internal sources and sinks.\nThe total rate of mass change, $\\frac{dM}{dt}$, is the algebraic sum of the rates from all contributing processes:\n$$ \\frac{dM}{dt} = F_{\\mathrm{lateral}} + F_{\\mathrm{surf/bot}} + S_{\\mathrm{total}} $$\nThe terms on the right-hand side represent the net rate of change due to lateral boundary fluxes, surface and bottom fluxes, and the integrated volumetric source, respectively. The problem specifies a sign convention where positive values correspond to an increase of mass within the domain.\nSince all fluxes and source rates are assumed to be constant over the time step $\\Delta t = t_{0}+\\Delta t - t_{0}$, the total change in mass $\\Delta M = M(t_{0}+\\Delta t) - M(t_{0})$ is calculated by multiplying the constant total rate of change by the duration of the time step:\n$$ \\Delta M = \\left(\\frac{dM}{dt}\\right) \\times \\Delta t $$\nWe proceed by calculating each contribution to the total rate $\\frac{dM}{dt}$.\n\n1. Net Lateral Flux Rate\nThe problem provides the time-averaged integrated mass flux rates across the western and eastern boundaries. The northern and southern boundaries are implicitly considered closed (no flux).\n-   Western boundary flux: $F_{\\mathrm{W}} = +1.80 \\times 10^{4}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$\n-   Eastern boundary flux: $F_{\\mathrm{E}} = -2.10 \\times 10^{4}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}$\nThe net lateral flux rate is the sum of these two contributions:\n$$ F_{\\mathrm{lateral}} = F_{\\mathrm{W}} + F_{\\mathrm{E}} = (1.80 \\times 10^{4}) + (-2.10 \\times 10^{4})\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = -0.30 \\times 10^{4}\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = -3000\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\n\n2. Net Surface and Bottom Flux Rate\nThe fluxes at the air-sea interface (surface) and the sediment-water interface (bottom) are given as flux densities (mass per unit area per unit time). To find the total flux rate, we multiply these densities by the horizontal area over which they act, $A = L \\times W$.\n-   Area: $A = (5000\\,\\mathrm{m})(2000\\,\\mathrm{m}) = 1.0 \\times 10^{7}\\,\\mathrm{m}^2$\n-   Surface deposition flux density: $q_{\\mathrm{surf}} = +3.50 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$\n-   Bottom uptake flux density: $q_{\\mathrm{bot}} = -1.20 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}$\nThe total rate of mass change from the surface flux is:\n$$ F_{\\mathrm{surf}} = q_{\\mathrm{surf}} \\times A = (3.50 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}) \\times (1.0 \\times 10^{7}\\,\\mathrm{m}^2) = 35.0\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\nThe total rate of mass change from the bottom flux is:\n$$ F_{\\mathrm{bot}} = q_{\\mathrm{bot}} \\times A = (-1.20 \\times 10^{-6}\\,\\mathrm{kg}\\,\\mathrm{m}^{-2}\\,\\mathrm{s}^{-1}) \\times (1.0 \\times 10^{7}\\,\\mathrm{m}^2) = -12.0\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\nThe net flux rate from these two boundaries is:\n$$ F_{\\mathrm{surf/bot}} = F_{\\mathrm{surf}} + F_{\\mathrm{bot}} = 35.0\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} - 12.0\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = 23.0\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\n\n3. Integrated Volumetric Source Rate\nThe volumetric source term, $s(x,y,z)$, is spatially variable and must be integrated over the entire control volume $V = LWH = (5000\\,\\mathrm{m})(2000\\,\\mathrm{m})(15\\,\\mathrm{m}) = 1.5 \\times 10^{8}\\,\\mathrm{m}^3$. The total source rate, $S_{\\mathrm{total}}$, is:\n$$ S_{\\mathrm{total}} = \\int_V s(x,y,z) \\,dV = \\int_{0}^{H} \\int_{0}^{W} \\int_{0}^{L} s_{0}\\,\\left[1 + \\alpha\\,\\frac{x}{L} + \\beta\\,\\frac{y}{W}\\right]\\,\\frac{z}{H} \\, dx \\, dy \\, dz $$\nThe integral is separable in $z$ and the $(x,y)$ pair:\n$$ S_{\\mathrm{total}} = \\frac{s_0}{H} \\left( \\int_{0}^{H} z \\, dz \\right) \\left( \\int_{0}^{W} \\int_{0}^{L} \\left(1 + \\frac{\\alpha x}{L} + \\frac{\\beta y}{W}\\right) dx \\, dy \\right) $$\nEvaluating the individual integrals:\n$$ \\int_{0}^{H} z \\, dz = \\left[\\frac{z^2}{2}\\right]_{0}^{H} = \\frac{H^2}{2} $$\n$$ \\int_{0}^{W} \\int_{0}^{L} \\left(1 + \\frac{\\alpha x}{L} + \\frac{\\beta y}{W}\\right) dx \\, dy = \\int_{0}^{W} \\left[x + \\frac{\\alpha x^2}{2L} + \\frac{\\beta y x}{W}\\right]_{x=0}^{x=L} dy = \\int_{0}^{W} \\left(L + \\frac{\\alpha L}{2} + \\frac{\\beta L y}{W}\\right) dy $$\n$$ = \\left[Ly + \\frac{\\alpha L y}{2} + \\frac{\\beta L y^2}{2W}\\right]_{y=0}^{y=W} = LW + \\frac{\\alpha LW}{2} + \\frac{\\beta LW}{2} = LW\\left(1 + \\frac{\\alpha + \\beta}{2}\\right) $$\nCombining the terms, we get:\n$$ S_{\\mathrm{total}} = \\frac{s_0}{H} \\left(\\frac{H^2}{2}\\right) \\left(LW\\left(1 + \\frac{\\alpha + \\beta}{2}\\right)\\right) = \\frac{s_0 LWH}{2} \\left(1 + \\frac{\\alpha + \\beta}{2}\\right) $$\nSubstituting the given values: $s_{0} = 2.00 \\times 10^{-8}\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$, $V = LWH = 1.5 \\times 10^{8}\\,\\mathrm{m}^3$, $\\alpha = 0.25$, and $\\beta = -0.10$.\n$$ S_{\\mathrm{total}} = \\frac{(2.00 \\times 10^{-8}\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1})(1.5 \\times 10^{8}\\,\\mathrm{m}^3)}{2} \\left(1 + \\frac{0.25 - 0.10}{2}\\right) $$\n$$ S_{\\mathrm{total}} = \\frac{3.00}{2} \\left(1 + \\frac{0.15}{2}\\right) \\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = 1.5 \\times (1 + 0.075) \\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = 1.5 \\times 1.075 \\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = 1.6125\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\n\n4. Total Rate of Mass Change\nThe total rate of mass change is the sum of all calculated components:\n$$ \\frac{dM}{dt} = F_{\\mathrm{lateral}} + F_{\\mathrm{surf/bot}} + S_{\\mathrm{total}} $$\n$$ \\frac{dM}{dt} = (-3000) + (23.0) + (1.6125) \\,\\mathrm{kg}\\,\\mathrm{s}^{-1} = -2975.3875\\,\\mathrm{kg}\\,\\mathrm{s}^{-1} $$\n\n5. Total Mass Change\nThe total change in mass, $\\Delta M$, is obtained by multiplying this rate by the time step, $\\Delta t = 2.0\\,\\mathrm{hours} = 2.0 \\times 3600\\,\\mathrm{s} = 7200\\,\\mathrm{s}$.\n$$ \\Delta M = \\left(\\frac{dM}{dt}\\right) \\times \\Delta t = (-2975.3875\\,\\mathrm{kg}\\,\\mathrm{s}^{-1}) \\times (7200\\,\\mathrm{s}) = -21422790\\,\\mathrm{kg} $$\nRounding the result to four significant figures as requested:\n$$ \\Delta M \\approx -2.142 \\times 10^{7}\\,\\mathrm{kg} $$",
            "answer": "$$\\boxed{-2.142 \\times 10^{7}}$$"
        },
        {
            "introduction": "Building on the concept of a static mass budget, this practice takes the crucial next step from accounting to prediction. By implementing a simple numerical model for a tidal basin, you will translate the differential form of the continuity equation, $\\frac{dV}{dt} = Q_{\\text{net}}$, into a dynamic simulation of water level evolution. This hands-on coding exercise highlights the interplay between the conservation law, non-linear system geometry ($A(h)$), and the logic of numerical time-stepping to solve for a system's state over time .",
            "id": "3921740",
            "problem": "A well-mixed tidal basin is represented as a single control volume with a horizontal free surface whose elevation above the basin bottom is denoted by $h(t)$ in $\\mathrm{m}$. The basin receives a specified inflow hydrograph $Q_{\\text{in}}(t)$ in $\\mathrm{m^3/s}$ and loses water to atmospheric evaporation represented as a flux per unit area $E(t)$ in $\\mathrm{m/s}$; there are no other sources or sinks. The basin bathymetry defines a wetted surface area $A(h)$ in $\\mathrm{m^2}$ as a function of the free-surface elevation $h$, with the following piecewise-linear specification:\n- For $0 \\le h \\le h_1$: $A(h) = s_1 h$.\n- For $h_1 < h \\le h_2$: $A(h) = s_1 h_1 + s_2 (h - h_1)$.\n- For $h > h_2$: $A(h) = s_1 h_1 + s_2 (h_2 - h_1) + s_3 (h - h_2)$.\nHere $h_1$ and $h_2$ are positive elevations in $\\mathrm{m}$ and $s_1$, $s_2$, $s_3$ are positive slopes in $\\mathrm{m^2/m}$.\n\nStarting from the fundamental conservation of mass and the geometric relationship between volume and area, derive an algorithm to compute the time evolution of $h(t)$ over a finite horizon. The basin’s water volume $V(t)$ in $\\mathrm{m^3}$ must never become negative, and when $V(t)=0$, the corresponding free-surface elevation is $h(t)=0$.\n\nThe inflow hydrograph is given by $Q_{\\text{in}}(t) = Q_0 + Q_1 \\sin\\left( \\frac{2\\pi t}{P} \\right)$, with $Q_0$ and $Q_1$ in $\\mathrm{m^3/s}$ and the tidal period $P$ in $\\mathrm{s}$. The evaporation flux is given by $E(t) = e_0 + e_1 \\cos\\left( \\frac{2\\pi t}{D} \\right)$, where $D = 86400$ is the duration of one day in $\\mathrm{s}$, and $e_0$ and $e_1$ are specified in $\\mathrm{mm/day}$ and must be converted to $\\mathrm{m/s}$ before use.\n\nImplement a numerical time-marching solution based only on the conservation-of-mass principle and the bathymetric geometry described above, using a fixed time step $\\Delta t$ in $\\mathrm{s}$ over a finite horizon $T$ in $\\mathrm{s}$. The program must accept no external input; it must internally define and evaluate the following three test cases, each using the same bathymetry but distinct hydrograph and evaporation parameters. For each case, compute and report the final free-surface elevation $h(T)$ in $\\mathrm{m}$, rounded to three decimal places.\n\nBathymetry parameters common to all cases:\n- $h_1 = 2.0$ in $\\mathrm{m}$, $h_2 = 4.0$ in $\\mathrm{m}$.\n- $s_1 = 5.0 \\times 10^5$ in $\\mathrm{m^2/m}$, $s_2 = 1.5 \\times 10^6$ in $\\mathrm{m^2/m}$, $s_3 = 6.0 \\times 10^6$ in $\\mathrm{m^2/m}$.\n\nTime integration parameters common to all cases:\n- $T = 432000$ in $\\mathrm{s}$ (five days).\n- $\\Delta t = 300$ in $\\mathrm{s}$.\n\nTest Case $1$ (general variability “happy path”):\n- Initial elevation $h(0) = 1.0$ in $\\mathrm{m}$.\n- Inflow: $Q_0 = 120$ in $\\mathrm{m^3/s}$, $Q_1 = 80$ in $\\mathrm{m^3/s}$, $P = 44712$ in $\\mathrm{s}$.\n- Evaporation: $e_0 = 4.0$ in $\\mathrm{mm/day}$, $e_1 = 1.5$ in $\\mathrm{mm/day}$.\n\nTest Case $2$ (evaporation-dominated boundary with potential drying):\n- Initial elevation $h(0) = 0.3$ in $\\mathrm{m}$.\n- Inflow: $Q_0 = 0$ in $\\mathrm{m^3/s}$, $Q_1 = 0$ in $\\mathrm{m^3/s}$, $P = 44712$ in $\\mathrm{s}$.\n- Evaporation: $e_0 = 6.0$ in $\\mathrm{mm/day}$, $e_1 = 2.0$ in $\\mathrm{mm/day}$.\n\nTest Case $3$ (strong inflow with weak evaporation):\n- Initial elevation $h(0) = 1.5$ in $\\mathrm{m}$.\n- Inflow: $Q_0 = 800$ in $\\mathrm{m^3/s}$, $Q_1 = 300$ in $\\mathrm{m^3/s}$, $P = 44712$ in $\\mathrm{s}$.\n- Evaporation: $e_0 = 3.0$ in $\\mathrm{mm/day}$, $e_1 = 1.0$ in $\\mathrm{mm/day}$.\n\nYour program must produce a single line of output containing the three final elevations as a comma-separated list enclosed in square brackets, in the order of Test Case $1$, Test Case $2$, Test Case $3$. For example, the output format must be exactly like $[h_1,h_2,h_3]$, where each $h_i$ is a decimal number rounded to three decimal places in $\\mathrm{m}$.",
            "solution": "The problem requires the derivation and implementation of an algorithm to simulate the time evolution of the water surface elevation, $h(t)$, in a tidal basin. The solution is founded on the principle of mass conservation for a control volume.\n\nThe integral form of the mass conservation equation, also known as the continuity equation for a control volume with time-varying volume $V$, is given by:\n$$\n\\frac{dV}{dt} = \\sum Q_{\\text{in}} - \\sum Q_{\\text{out}}\n$$\nwhere $\\sum Q_{\\text{in}}$ is the sum of all volumetric inflow rates and $\\sum Q_{\\text{out}}$ is the sum of all volumetric outflow rates.\n\nFor the specified tidal basin, the only inflow is the hydrograph $Q_{\\text{in}}(t)$. The only outflow is due to evaporation, which is given as a flux per unit area, $E(t)$. The total volumetric outflow rate due to evaporation is the flux multiplied by the wetted surface area, $A(h(t))$. Therefore, the mass balance equation for the basin is:\n$$\n\\frac{dV}{dt} = Q_{\\text{in}}(t) - E(t)A(h(t))\n$$\nThe problem defines the geometry of the basin through a piecewise-linear relationship for the surface area $A(h)$. The volume of the basin, $V(h)$, can be determined by integrating the area function from the bottom ($h=0$) to the free surface elevation $h$:\n$$\nV(h) = \\int_0^h A(h') dh'\n$$\nGiven the piecewise definition of $A(h)$:\n- For $0 \\le h \\le h_1$: $A(h) = s_1 h$\n- For $h_1 < h \\le h_2$: $A(h) = A(h_1) + s_2 (h - h_1)$ where $A(h_1) = s_1 h_1$\n- For $h > h_2$: $A(h) = A(h_2) + s_3 (h - h_2)$ where $A(h_2) = s_1 h_1 + s_2 (h_2 - h_1)$\n\nPerforming the integration yields the piecewise function for volume $V(h)$:\n- For $0 \\le h \\le h_1$:\n  $$ V(h) = \\int_0^h s_1 h' dh' = \\frac{1}{2} s_1 h^2 $$\n- For $h_1 < h \\le h_2$:\n  $$ V(h) = V(h_1) + \\int_{h_1}^h [s_1 h_1 + s_2 (h' - h_1)] dh' = V(h_1) + s_1 h_1 (h - h_1) + \\frac{1}{2} s_2 (h - h_1)^2 $$\n  where $V(h_1) = \\frac{1}{2} s_1 h_1^2$.\n- For $h > h_2$:\n  $$ V(h) = V(h_2) + \\int_{h_2}^h [A(h_2) + s_3 (h' - h_2)] dh' = V(h_2) + A(h_2) (h - h_2) + \\frac{1}{2} s_3 (h - h_2)^2 $$\n  where $V(h_2)$ is the volume at elevation $h_2$.\n\nTo solve the problem numerically, we discretize the volume-based differential equation in time using the forward Euler method with a fixed time step $\\Delta t$. Let $V_n$ be the volume at time $t_n = n \\Delta t$. The volume at the next time step, $V_{n+1}$, is approximated as:\n$$\nV_{n+1} = V_n + \\Delta t \\left( Q_{\\text{in}}(t_n) - E(t_n)A(h_n) \\right)\n$$\nwhere $h_n$ is the elevation corresponding to volume $V_n$. The problem imposes the physical constraint that volume cannot be negative, so we must enforce $V_{n+1} \\ge 0$.\n\nThe core of the numerical algorithm is a time-marching loop where the state of the system is its volume, $V(t)$.\nThe algorithm proceeds as follows:\n1.  Initialize the simulation at $t=0$. Given the initial elevation $h(0)$, compute the initial volume $V_0 = V(h(0))$ using the piecewise $V(h)$ function.\n2.  Iterate for each time step $n=0, 1, 2, \\dots, N-1$, where $N = T/\\Delta t$. At each step:\n    a. Let the current state be the volume $V_n$.\n    b. Compute the corresponding elevation $h_n$ by inverting the $V(h)$ relationship. This requires solving for $h$ given $V_n$.\n    c. Compute the surface area $A_n = A(h_n)$ using the piecewise $A(h)$ function.\n    d. Compute the forcing terms at time $t_n = n \\Delta t$: $Q_{\\text{in}}(t_n)$ and $E(t_n)$. The evaporation rates $e_0$ and $e_1$, given in $\\mathrm{mm/day}$, must be converted to $\\mathrm{m/s}$ by multiplying by the factor $\\frac{10^{-3} \\mathrm{m/mm}}{86400 \\mathrm{s/day}}$.\n    e. Update the volume: $V_{n+1} = V_n + \\Delta t (Q_{\\text{in}}(t_n) - E(t_n) A_n)$.\n    f. Apply the non-negativity constraint: $V_{n+1} = \\max(0, V_{n+1})$.\n    g. The new state is $V_{n+1}$.\n3.  After completing all time steps, the final volume is $V_N$. The final elevation $h(T)$ is computed by inverting the $V(h)$ relationship for $V_N$.\n\nThe inversion of $V(h)$ to find $h(V)$ is critical. Let $V_1 = V(h_1)$ and $V_2 = V(h_2)$ be the volumes at the transition elevations.\n- For $0 \\le V \\le V_1$:\n  $$ h = \\sqrt{\\frac{2V}{s_1}} $$\n- For $V_1 < V \\le V_2$: $V = V_1 + s_1 h_1 (h - h_1) + \\frac{1}{2} s_2 (h - h_1)^2$. This is a quadratic equation for $\\delta h = h - h_1$. The physically meaningful solution is:\n  $$ h = h_1 + \\frac{-s_1 h_1 + \\sqrt{(s_1 h_1)^2 + 2s_2(V - V_1)}}{s_2} $$\n- For $V > V_2$: $V = V_2 + A(h_2) (h - h_2) + \\frac{1}{2} s_3 (h - h_2)^2$. This is a quadratic equation for $\\delta h = h - h_2$. The solution is:\n  $$ h = h_2 + \\frac{-A(h_2) + \\sqrt{A(h_2)^2 + 2s_3(V - V_2)}}{s_3} $$\nThis complete algorithm will be implemented to solve for the final elevation $h(T)$ for each of the three test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the final water surface elevation in a tidal basin for three test cases.\n    \"\"\"\n\n    # --- Global Parameters ---\n    # Bathymetry parameters (m, m^2/m)\n    h1, h2 = 2.0, 4.0\n    s1, s2, s3 = 5.0e5, 1.5e6, 6.0e6\n    \n    # Time integration parameters (s)\n    T = 432000.0  # Total simulation time (5 days)\n    dt = 300.0     # Time step\n\n    # Physical constants\n    D = 86400.0  # Duration of one day (s)\n    MM_DAY_TO_M_S = 1e-3 / 86400.0  # Conversion from mm/day to m/s\n\n    class Bathymetry:\n        \"\"\"\n        Encapsulates the bathymetric properties of the basin.\n        \"\"\"\n        def __init__(self, s1, s2, s3, h1, h2):\n            self.s1, self.s2, self.s3 = s1, s2, s3\n            self.h1, self.h2 = h1, h2\n\n            # Pre-calculate transition areas and volumes\n            self.A1 = self.s1 * self.h1\n            self.V1 = 0.5 * self.s1 * self.h1**2\n            \n            self.A2 = self.A1 + self.s2 * (self.h2 - self.h1)\n            self.V2 = self.V1 + self.A1 * (self.h2 - self.h1) + 0.5 * self.s2 * (self.h2 - self.h1)**2\n\n        def get_area_from_h(self, h):\n            \"\"\"Computes surface area A from elevation h.\"\"\"\n            if h = 0:\n                return 0.0\n            elif h = self.h1:\n                return self.s1 * h\n            elif h = self.h2:\n                return self.A1 + self.s2 * (h - self.h1)\n            else:\n                return self.A2 + self.s3 * (h - self.h2)\n        \n        def get_volume_from_h(self, h):\n            \"\"\"Computes volume V from elevation h.\"\"\"\n            if h = 0:\n                return 0.0\n            elif h = self.h1:\n                return 0.5 * self.s1 * h**2\n            elif h = self.h2:\n                return self.V1 + self.A1 * (h - self.h1) + 0.5 * self.s2 * (h - self.h1)**2\n            else:\n                return self.V2 + self.A2 * (h - self.h2) + 0.5 * self.s3 * (h - self.h2)**2\n\n        def get_h_from_volume(self, V):\n            \"\"\"Computes elevation h from volume V by inverting the V(h) relationship.\"\"\"\n            if V = 0:\n                return 0.0\n            elif V = self.V1:\n                return np.sqrt(2 * V / self.s1)\n            elif V = self.V2:\n                # Solve quadratic equation for (h-h1)\n                delta_h = (-self.A1 + np.sqrt(self.A1**2 + 2 * self.s2 * (V - self.V1))) / self.s2\n                return self.h1 + delta_h\n            else:\n                # Solve quadratic equation for (h-h2)\n                delta_h = (-self.A2 + np.sqrt(self.A2**2 + 2 * self.s3 * (V - self.V2))) / self.s3\n                return self.h2 + delta_h\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case 1: General variability\n        {'h0': 1.0, 'Q0': 120.0, 'Q1': 80.0, 'P': 44712.0, 'e0': 4.0, 'e1': 1.5},\n        # Case 2: Evaporation-dominated\n        {'h0': 0.3, 'Q0': 0.0, 'Q1': 0.0, 'P': 44712.0, 'e0': 6.0, 'e1': 2.0},\n        # Case 3: Strong inflow\n        {'h0': 1.5, 'Q0': 800.0, 'Q1': 300.0, 'P': 44712.0, 'e0': 3.0, 'e1': 1.0},\n    ]\n\n    results = []\n    \n    # Instantiate the common bathymetry model\n    basin_bathy = Bathymetry(s1, s2, s3, h1, h2)\n\n    for case in test_cases:\n        # --- Simulation Setup ---\n        # Unpack parameters\n        h0 = case['h0']\n        Q0, Q1, P = case['Q0'], case['Q1'], case['P']\n        e0_conv = case['e0'] * MM_DAY_TO_M_S\n        e1_conv = case['e1'] * MM_DAY_TO_M_S\n\n        # Initial state\n        V = basin_bathy.get_volume_from_h(h0)\n        \n        # --- Time-Marching Loop ---\n        num_steps = int(T / dt)\n        for n in range(num_steps):\n            t = n * dt\n            \n            # Get h and A from the current state V\n            h = basin_bathy.get_h_from_volume(V)\n            A = basin_bathy.get_area_from_h(h)\n            \n            # Calculate forcing terms\n            Qin = Q0 + Q1 * np.sin(2 * np.pi * t / P)\n            E = e0_conv + e1_conv * np.cos(2 * np.pi * t / D)\n            \n            # Update volume using Forward Euler\n            V_next = V + dt * (Qin - E * A)\n            \n            # Enforce non-negativity constraint\n            V = max(0.0, V_next)\n\n        # --- Final Result ---\n        h_final = basin_bathy.get_h_from_volume(V)\n        results.append(round(h_final, 3))\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "When we move from simple, well-mixed systems to spatially-resolved models, the continuity equation presents new numerical challenges, particularly in the advection term, $\\nabla \\cdot (\\mathbf{u}c)$. This exercise has you directly confront one of the classic problems in computational fluid dynamics: the trade-off between accuracy and physical realism. By applying a higher-order scheme, you will see how non-physical oscillations can arise and learn the principles behind flux limiters, which are essential for developing robust, high-resolution models that conserve mass without generating spurious results .",
            "id": "3921743",
            "problem": "Consider a one-dimensional conservative tracer $c(x,t)$ advected in a straight channel by a constant, positive velocity $u0$. The governing law is the continuity equation for a passive tracer advected by a known flow, which states that the rate of change of the tracer within any fixed control volume equals the net advective flux into that volume. For a uniform mesh of $N$ cells of width $\\Delta x$, with cell averages $c_i^n$ at time $t^n$, the finite-volume update is obtained by integrating the continuity equation over each cell and applying the divergence theorem to write the change as the difference of fluxes across the cell faces. Denote the face fluxes by $F_{i+1/2}^n$, and consider the explicit update $c_i^{n+1} = c_i^n - (\\Delta t/\\Delta x)\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)$, where the advective flux $F_{i+1/2}^n$ is approximated as $F_{i+1/2}^n = u\\,c_{i+1/2}^n$ for $u0$, with $c_{i+1/2}^n$ a reconstruction of the face value from neighboring cell averages.\n\nLet the mesh have $N=4$ interior cells indexed by $i=1,2,3,4$, with zero inflow and outflow through the domain boundaries at faces $x_{1/2}$ and $x_{9/2}$, so $F_{1/2}^n=F_{9/2}^n=0$. Consider the following un-limited upwind-biased second-order reconstruction for $u0$:\n$$\nc_{i+1/2}^n \\equiv c_i^n + \\frac{1}{2}\\left(c_i^n - c_{i-1}^n\\right), \\quad \\text{for } i=1,2,3,4,\n$$\nwith the understanding that at the left boundary the reconstruction reduces to $c_{1/2}^n=0$ because $c_0^n=0$ and there is no inflow.\n\nSuppose the initial data at time $t^n$ are $c_1^n=0$, $c_2^n=1$, $c_3^n=0$, $c_4^n=0$, and choose a Courant number $\\nu=u\\Delta t/\\Delta x=0.6$. Using the above finite-volume update with $F_{i+1/2}^n = u\\,c_{i+1/2}^n$, compute the one-step update $c_i^{n+1}$ for $i=1,2,3,4$. Based on the results and the governing principles of conservation and monotonicity for advective transport, select all statements that are correct:\n\nA. The described upwind-biased reconstruction leads to a conservative update of the total tracer mass but can generate new extrema (overshoot and undershoot) from the given initial condition for $\\nu=0.6$.\n\nB. Because the update is expressed as a flux difference across each cell, values outside the initial range $\\left[0,1\\right]$ cannot be introduced; monotonicity is automatically preserved.\n\nC. Introducing a flux limiter within a Monotonic Upwind Scheme for Conservation Laws (MUSCL) that enforces $c_{i+1/2}^n \\in \\left[\\min\\left(c_{i-1}^n,c_i^n\\right),\\max\\left(c_{i-1}^n,c_i^n\\right)\\right]$ at every face for $u0$ can maintain boundedness (no new overshoot or undershoot) for $0\\nu\\le 1$ while preserving conservation through the finite-volume flux-difference update.\n\nD. Flux limiters necessarily break conservation because they alter the flux values at each face in a way that is different for the left and right neighboring cells.\n\nE. A Total Variation Diminishing (TVD) limiter can be constructed so that, for $0\\nu1$, the scheme is second-order accurate in smooth regions and reverts to first-order near extrema, thereby preventing spurious oscillations while conserving tracer mass.\n\nSelect all correct options.",
            "solution": "The user has provided a problem concerning the numerical solution of a one-dimensional advection equation using a finite-volume method. I will first validate the problem statement and then proceed to a full solution and evaluation of the given options.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n-   **Governing Law:** One-dimensional advection of a conservative tracer $c(x,t)$ with a constant, positive velocity $u0$. The governing principle is the continuity equation.\n-   **Numerical Method:** Finite-volume scheme on a uniform mesh of $N=4$ cells of width $\\Delta x$.\n-   **Update Formula:** $c_i^{n+1} = c_i^n - (\\Delta t/\\Delta x)\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)$, for cells $i=1,2,3,4$.\n-   **Flux Formula:** $F_{i+1/2}^n = u\\,c_{i+1/2}^n$.\n-   **Boundary Conditions:** Zero inflow and outflow, specified as $F_{1/2}^n=0$ and $F_{9/2}^n=0$. These correspond to the fluxes at the leftmost and rightmost boundaries of the domain.\n-   **Reconstruction Scheme:** An un-limited, upwind-biased, second-order reconstruction for $u0$ is given by $c_{i+1/2}^n \\equiv c_i^n + \\frac{1}{2}\\left(c_i^n - c_{i-1}^n\\right)$, for $i=1,2,3,4$.\n-   **Boundary Data for Reconstruction:** A ghost cell value $c_0^n=0$ is provided for the reconstruction at the left boundary.\n-   **Initial Conditions:** At time $t^n$, the cell averages are $c_1^n=0$, $c_2^n=1$, $c_3^n=0$, $c_4^n=0$.\n-   **Courant Number:** $\\nu \\equiv u\\Delta t/\\Delta x = 0.6$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, being a standard topic in computational fluid dynamics and numerical analysis for hyperbolic partial differential equations. The terms and methods (finite volume, continuity equation, upwind reconstruction, Courant number) are well-established.\n\nThe problem is well-posed. It provides all necessary components for a unique calculation: the update equation, the flux calculation method, initial data, boundary conditions, and all relevant parameters.\n\nThe problem is objective and uses precise, formal language.\n\nLet us check for consistency. The finite-volume update for $N=4$ cells requires fluxes $F_{1/2}^n, F_{3/2}^n, F_{5/2}^n, F_{7/2}^n, F_{9/2}^n$. The boundary conditions explicitly set $F_{1/2}^n=0$ and $F_{9/2}^n=0$. The remaining interior fluxes, $F_{3/2}^n, F_{5/2}^n, F_{7/2}^n$, must be computed using the reconstruction. The reconstruction formula is given for $i=1,2,3,4$, which would define $c_{3/2}^n, c_{5/2}^n, c_{7/2}^n, c_{9/2}^n$. For the right boundary flux $F_{9/2}^n$, the reconstruction for $i=4$ gives $c_{9/2}^n = c_4^n + \\frac{1}{2}(c_4^n-c_3^n)$. With the given initial data ($c_3^n=0, c_4^n=0$), this yields $c_{9/2}^n=0$, which implies $F_{9/2}^n=0$. This is consistent with the stated boundary condition. For the left boundary, reconstruction for $i=1$ gives $c_{3/2}^n$, which requires $c_0^n$. The problem provides $c_0^n=0$. All information is self-consistent and complete.\n\n**Step 3: Verdict and Action**\nThe problem statement is **valid**. I will proceed with the derivation of the solution.\n\n### Solution Derivation\n\nThe task is first to compute the one-step update $c_i^{n+1}$ for $i=1,2,3,4$ and then evaluate the propositions.\n\n**1. Calculation of the one-step update $c_i^{n+1}$**\n\nThe finite-volume update formula can be written in terms of the Courant number $\\nu = u\\Delta t/\\Delta x$ as:\n$$c_i^{n+1} = c_i^n - \\nu \\left( \\frac{F_{i+1/2}^n}{u} - \\frac{F_{i-1/2}^n}{u} \\right) = c_i^n - \\nu \\left(c_{i+1/2}^n - c_{i-1/2}^n\\right)$$\n\nFirst, we must compute the reconstructed values at the cell faces, $c_{i+1/2}^n$, using the given initial data: $c_0^n=0$ (ghost cell), $c_1^n=0$, $c_2^n=1$, $c_3^n=0$, $c_4^n=0$.\n\n-   **Face $i=1/2$ (Left Boundary):** The boundary condition is $F_{1/2}^n=0$, which implies $c_{1/2}^n=0$.\n-   **Face $i=3/2$:** Using the reconstruction formula for $i=1$:\n    $$c_{3/2}^n = c_1^n + \\frac{1}{2}\\left(c_1^n - c_0^n\\right) = 0 + \\frac{1}{2}(0 - 0) = 0$$\n-   **Face $i=5/2$:** Using the reconstruction formula for $i=2$:\n    $$c_{5/2}^n = c_2^n + \\frac{1}{2}\\left(c_2^n - c_1^n\\right) = 1 + \\frac{1}{2}(1 - 0) = 1.5$$\n-   **Face $i=7/2$:** Using the reconstruction formula for $i=3$:\n    $$c_{7/2}^n = c_3^n + \\frac{1}{2}\\left(c_3^n - c_2^n\\right) = 0 + \\frac{1}{2}(0 - 1) = -0.5$$\n-   **Face $i=9/2$ (Right Boundary):** The boundary condition is $F_{9/2}^n=0$, which implies $c_{9/2}^n=0$. As noted during validation, the reconstruction for $i=4$ yields $c_{9/2}^n=c_4^n+\\frac{1}{2}(c_4^n-c_3^n)=0+\\frac{1}{2}(0-0)=0$, which is consistent.\n\nNow, we compute the updated cell averages $c_i^{n+1}$ using $\\nu=0.6$:\n-   **Cell $i=1$:**\n    $$c_1^{n+1} = c_1^n - \\nu(c_{3/2}^n - c_{1/2}^n) = 0 - 0.6(0 - 0) = 0$$\n-   **Cell $i=2$:**\n    $$c_2^{n+1} = c_2^n - \\nu(c_{5/2}^n - c_{3/2}^n) = 1 - 0.6(1.5 - 0) = 1 - 0.9 = 0.1$$\n-   **Cell $i=3$:**\n    $$c_3^{n+1} = c_3^n - \\nu(c_{7/2}^n - c_{5/2}^n) = 0 - 0.6(-0.5 - 1.5) = 0 - 0.6(-2.0) = 1.2$$\n-   **Cell $i=4$:**\n    $$c_4^{n+1} = c_4^n - \\nu(c_{9/2}^n - c_{7/2}^n) = 0 - 0.6(0 - (-0.5)) = 0 - 0.6(0.5) = -0.3$$\n\nThe updated state is $(c_1^{n+1}, c_2^{n+1}, c_3^{n+1}, c_4^{n+1}) = (0, 0.1, 1.2, -0.3)$.\n\n**2. Evaluation of the Options**\n\nThe initial data $c^n$ are in the range $[0, 1]$. The updated data $c^{n+1}$ have a maximum of $1.2$ and a minimum of $-0.3$. This shows the generation of new extrema: an overshoot (a value greater than the initial maximum) and an undershoot (a value less than the initial minimum).\n\nLet's check for conservation of total mass, $M = \\sum_i c_i \\Delta x$.\n-   Initial total mass: $M^n = (c_1^n + c_2^n + c_3^n + c_4^n)\\Delta x = (0+1+0+0)\\Delta x = 1\\Delta x$.\n-   Final total mass: $M^{n+1} = (c_1^{n+1} + c_2^{n+1} + c_3^{n+1} + c_4^{n+1})\\Delta x = (0 + 0.1 + 1.2 - 0.3)\\Delta x = 1\\Delta x$.\nThe total mass is conserved. This is expected from the finite-volume \"flux-difference\" form, $c_i^{n+1} = c_i^n - (\\Delta t/\\Delta x)(F_{i+1/2}^n - F_{i-1/2}^n)$, with zero-flux boundary conditions, because the sum of the updates is a telescoping series that results in the net flux through the domain boundaries: $\\sum_i (F_{i+1/2}^n - F_{i-1/2}^n) = F_{N+1/2}^n - F_{1/2}^n$. Here, this is $F_{9/2}^n - F_{1/2}^n = 0-0=0$.\n\nNow we evaluate each option.\n\n**A. The described upwind-biased reconstruction leads to a conservative update of the total tracer mass but can generate new extrema (overshoot and undershoot) from the given initial condition for $\\nu=0.6$.**\nOur calculations confirm both parts of this statement. The total mass is conserved ($1\\Delta x$ before and after). New extrema are generated ($c_3^{n+1}=1.2  1$ and $c_4^{n+1}=-0.3  0$). This behavior is characteristic of unlimited second-order linear schemes like the one described (which is the Beam-Warming scheme).\n**Verdict: Correct.**\n\n**B. Because the update is expressed as a flux difference across each cell, values outside the initial range $\\left[0,1\\right]$ cannot be introduced; monotonicity is automatically preserved.**\nThe premise \"the update is expressed as a flux difference\" is true and guarantees conservation. However, the conclusion \"monotonicity is automatically preserved\" is false. Our direct calculation provides a counterexample, where values of $1.2$ and $-0.3$ were generated from an initial condition in the range $[0, 1]$. Higher-order linear schemes are generally not monotonicity-preserving.\n**Verdict: Incorrect.**\n\n**C. Introducing a flux limiter within a Monotonic Upwind Scheme for Conservation Laws (MUSCL) that enforces $c_{i+1/2}^n \\in \\left[\\min\\left(c_{i-1}^n,c_i^n\\right),\\max\\left(c_{i-1}^n,c_i^n\\right)\\right]$ at every face for $u0$ can maintain boundedness (no new overshoot or undershoot) for $0\\nu\\le 1$ while preserving conservation through the finite-volume flux-difference update.**\nThis statement describes the core purpose and functionality of MUSCL-type schemes with flux limiters.\n-   **Conservation:** As long as a single, consistent flux value $F_{i+1/2}^n$ is defined at each face and used for the cells to its left and right, the flux-difference formulation ensures conservation. Flux limiters are designed to work this way.\n-   **Boundedness/Monotonicity:** The purpose of a flux limiter is to adjust the higher-order reconstruction (like the one in this problem) towards a first-order, monotone reconstruction near sharp gradients or extrema. This prevents the formation of new extrema. The condition stated, $c_{i+1/2}^n \\in [\\min(c_{i-1}^n, c_i^n), \\max(c_{i-1}^n, c_i^n)]$, is a form of local constraint on the reconstruction to ensure non-oscillatory behavior. Appropriately designed limiters guarantee the scheme is Total Variation Diminishing (TVD) for a Courant number range like $0\\nu\\le 1$, which implies boundedness. The statement that this \"can\" be done is correct.\n**Verdict: Correct.**\n\n**D. Flux limiters necessarily break conservation because they alter the flux values at each face in a way that is different for the left and right neighboring cells.**\nThis statement is fundamentally incorrect. The principle of a conservative finite-volume scheme is that the flux leaving one cell is exactly the flux entering the next. Flux limiters operate by computing a single, limited reconstructed value $c_{i+1/2}^n$ at the face, which defines a single flux value $F_{i+1/2}^n$. This same value is used as an outflow for cell $i$ and an inflow for cell $i+1$. The statement's reasoning is flawed; the limiter does not create two different flux values at the same face. Thus, conservation is preserved.\n**Verdict: Incorrect.**\n\n**E. A Total Variation Diminishing (TVD) limiter can be constructed so that, for $0\\nu1$, the scheme is second-order accurate in smooth regions and reverts to first-order near extrema, thereby preventing spurious oscillations while conserving tracer mass.**\nThis is a comprehensive and accurate description of modern high-resolution TVD schemes.\n-   **Conservation:** As explained for C and D, the scheme remains conservative.\n-   **Accuracy:** By design, TVD limiters are inactive (e.g., the limiter function $\\phi \\approx 1$) in smooth regions of the solution, allowing the scheme to achieve its underlying second-order accuracy. Near extrema, the limiter becomes active ($\\phi \\to 0$), reducing the scheme to the robust (but dissipative) first-order upwind scheme.\n-   **Oscillation Prevention:** The TVD property, $TV(c^{n+1}) \\le TV(c^n)$, where $TV$ is the total variation $\\sum_i |c_{i+1}-c_i|$, mathematically guarantees that no new local extrema can form and existing ones are not amplified. This prevents spurious oscillations.\n-   **CFL Condition:** The TVD property for such explicit schemes is conditional on the Courant number being less than or equal to $1$.\nThe statement correctly summarizes all these key features.\n**Verdict: Correct.**",
            "answer": "$$\\boxed{ACE}$$"
        }
    ]
}