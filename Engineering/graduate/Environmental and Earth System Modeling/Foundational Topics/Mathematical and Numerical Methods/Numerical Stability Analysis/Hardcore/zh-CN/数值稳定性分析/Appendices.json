{
    "hands_on_practices": [
        {
            "introduction": "冯·诺依曼稳定性分析是理解线性常系数偏微分方程数值格式中误差传播规律的基石。本练习通过将该方法应用于热传导方程的前向时间中心空间（FTCS）格式，提供了一项基础实践，该方程是模拟环境系统中扩散过程的核心模型。通过分析傅里叶模态的增长因子，您将推导出保证解稳定性的关键条件，它联系了时间步长、网格间距和物理扩散系数 。",
            "id": "4047668",
            "problem": "在计算聚变科学与工程中，托卡马克内沿磁力线方向的平行电子热传导，在主导阶上通常可以用一维热方程来建模。考虑电子温度 $u(x,t)$ 的偏微分方程 $u_{t} = \\kappa \\, u_{xx}$，其中热扩散系数 $\\kappa  0$ 为常数，定义在周期性域 $x \\in [0,L]$ 上。将空间离散化为均匀网格 $x_{j} = j \\,\\Delta x$（$j$ 为整数索引，$\\Delta x = L/N$，$N \\in \\mathbb{N}$ 足够大），并将时间离散化为 $t^{n} = n \\,\\Delta t$（$n$ 为整数索引，$\\Delta t  0$）。考虑显式时间前向中心空间 (FTCS) 格式，\n$$\nu_{j}^{n+1} \\;=\\; u_{j}^{n} \\;+\\; \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} \\;-\\; 2\\,u_{j}^{n} \\;+\\; u_{j-1}^{n}\\right),\n$$\n并服从周期性边界条件。使用适用于数值稳定性分析的第一性原理，包括导出热方程的能量守恒、相容的有限差分近似以及周期性网格上的离散傅里叶 (von Neumann) 模态分析，来分析该格式相对于网格上可分辨的任意扰动的线性稳定性。确定能保证所有离散傅里叶模态都稳定的最大时间步长。请将您的最终答案表示为最大允许时间步长 $\\Delta t_{\\max}$ 关于 $\\kappa$ 和 $\\Delta x$ 的单个闭式符号表达式。最终表达式无需四舍五入，也不应包含单位。您可以从概念上引用 Courant–Friedrichs–Lewy (CFL) 条件，但必须从放大因子出发推导稳定性限制，不得直接使用任何现成的结论。",
            "solution": "该问题要求推导应用于周期性域上一维热方程 $u_{t} = \\kappa \\, u_{xx}$ 的时间前向中心空间 (FTCS) 格式的稳定性条件。将使用离散傅里叶 (von Neumann) 方法进行稳定性分析，以确定最大允许时间步长 $\\Delta t_{\\max}$。\n\n给定的 FTCS 数值格式为：\n$$\nu_{j}^{n+1} = u_{j}^{n} + \\frac{\\kappa \\,\\Delta t}{\\Delta x^{2}} \\left(u_{j+1}^{n} - 2\\,u_{j}^{n} + u_{j-1}^{n}\\right)\n$$\n其中 $u_j^n$ 近似于温度 $u(x_j, t^n)$，$\\Delta t$ 是时间步长，$\\Delta x$ 是空间网格间距。\n\nvon Neumann 稳定性分析假设初始误差分布可以分解为傅里叶级数。由于该有限差分格式是线性的，我们可以分析单个傅里叶模态的行为。在网格点 $x_j = j \\Delta x$ 和时间层 $t^n = n \\Delta t$ 上的数值解的任意模态可以表示为：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j} = \\hat{u}^n(k) e^{i k j \\Delta x}\n$$\n其中 $k$ 是波数，$i$ 是虚数单位，$\\hat{u}^n(k)$ 是在时间层 $n$ 的模态振幅。为了使格式稳定，每个模态的振幅必须不能随时间增长。这由放大因子 $G(k)$ 来量化，其定义关系为：\n$$\n\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)\n$$\n稳定性要求对于网格可分辨的所有可能的波数 $k$，放大因子的模都小于或等于一，即 $|G(k)| \\le 1$。\n\n为了求出 $G(k)$，我们将傅里叶模态表示代入 FTCS 格式中。\n格式中的各项变为：\n- $u_{j}^{n+1} = \\hat{u}^{n+1}(k) e^{i k j \\Delta x} = G(k) \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j}^{n} = \\hat{u}^{n}(k) e^{i k j \\Delta x}$\n- $u_{j+1}^{n} = \\hat{u}^{n}(k) e^{i k (j+1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x}$\n- $u_{j-1}^{n} = \\hat{u}^{n}(k) e^{i k (j-1) \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x}$\n\n将这些代入 FTCS 方程：\n$$\nG(k) \\hat{u}^{n}(k) e^{i k j \\Delta x} = \\hat{u}^{n}(k) e^{i k j \\Delta x} + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{i k \\Delta x} - 2\\hat{u}^{n}(k) e^{i k j \\Delta x} + \\hat{u}^{n}(k) e^{i k j \\Delta x} e^{-i k \\Delta x} \\right)\n$$\n我们可以将整个方程除以公共因子 $\\hat{u}^{n}(k) e^{i k j \\Delta x}$（假设为非平凡解）：\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( e^{i k \\Delta x} - 2 + e^{-i k \\Delta x} \\right)\n$$\n使用欧拉恒等式 $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$，我们可以简化括号中的表达式：\n$$\nG(k) = 1 + \\frac{\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\cos(k \\Delta x) - 2 \\right) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 1 - \\cos(k \\Delta x) \\right)\n$$\n为了进一步简化，我们使用三角半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$$\nG(k) = 1 - \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\left( 2\\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\right) = 1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n放大因子 $G(k)$ 是一个实数。稳定性条件 $|G(k)| \\le 1$ 变为 $-1 \\le G(k) \\le 1$。\n\n我们来分析这两个不等式：\n1.  $G(k) \\le 1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 1\n    $$\n    $$\n    -\\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\le 0\n    $$\n    由于 $\\kappa  0$, $\\Delta t  0$, $\\Delta x^2  0$ 且 $\\sin^2(\\cdot) \\ge 0$，这个不等式总是满足的。\n\n2.  $G(k) \\ge -1$:\n    $$\n    1 - \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right) \\ge -1\n    $$\n    $$\n    2 \\ge \\frac{4\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n    两边除以 $2$:\n    $$\n    1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} \\sin^2\\left(\\frac{k \\Delta x}{2}\\right)\n    $$\n这个不等式必须对网格上可表示的所有波数 $k$ 都成立。无量纲波数的范围是 $k \\Delta x \\in [-\\pi, \\pi]$。为了找到对 $\\Delta t$ 最严格的条件，我们必须找到项 $\\sin^2(k \\Delta x / 2)$ 的最大值。$\\sin^2(\\theta)$ 的最大值为 $1$，当 $\\theta = \\pi/2 + m\\pi$（$m$ 为任意整数）时取得。对于 $k \\Delta x = \\pi$（这对应于网格能分辨的最高频率，或最短波长 $\\lambda=2\\Delta x$），我们有：\n$$\n\\sin^2\\left(\\frac{\\pi}{2}\\right) = 1\n$$\n这代表了稳定性的“最坏情况”。将这个最大值代入不等式，得到必须满足的稳定性条件：\n$$\n1 \\ge \\frac{2\\kappa \\Delta t}{\\Delta x^2} (1)\n$$\n$$\n\\frac{2\\kappa \\Delta t}{\\Delta x^2} \\le 1\n$$\n为使 FTCS 格式稳定，必须满足此条件。当等式成立时，我们得到最大允许时间步长 $\\Delta t_{\\max}$：\n$$\n\\frac{2\\kappa \\Delta t_{\\max}}{\\Delta x^2} = 1\n$$\n解出 $\\Delta t_{\\max}$：\n$$\n\\Delta t_{\\max} = \\frac{\\Delta x^2}{2\\kappa}\n$$\n这是一维热方程的显式 FTCS 方法众所周知的稳定性约束。它表明，为保持数值稳定性，时间步长必须随着空间网格间距的减小而呈平方关系减小。",
            "answer": "$$\\boxed{\\frac{\\Delta x^{2}}{2\\kappa}}$$"
        },
        {
            "introduction": "当我们在空间上将偏微分方程离散化时，会得到一个大型的常微分方程组——这便是所谓的“线方法”（method of lines）。此时，模拟的稳定性在很大程度上取决于我们选择的时间积分方案。本练习旨在探究几种常用的线性多步法的稳定性，通过比较显式的 Adams-Bashforth 方法和隐式的 Adams-Moulton 方法，引入绝对稳定区域这一至关重要的概念 。",
            "id": "3899750",
            "problem": "在环境和地球系统模拟的大气化学中，一种常见的亚网格参数化是反应性示踪剂的一阶衰减，其理想化的形式为线性常微分方程 $y'(t) = -\\alpha y(t)$，其中 $\\alpha  0$ 为常数。考虑使用固定时间步长 $h$ 和四种线性多步时间积分格式：2阶和3阶的 Adams–Bashforth 显式方法，以及2阶和3阶的 Adams–Moulton 隐式方法。\n\n从线性多步法的绝对稳定性定义出发，通过分析线性测试方程 $y' = \\lambda y$（其中 $\\lambda \\in \\mathbb{C}$），推导这四种方法在应用于 $y' = -\\alpha y$（即 $\\lambda = -\\alpha  0$）时沿负实轴的绝对稳定性条件。利用这些条件，就无量纲量 $z = h \\lambda = -h \\alpha$ 而言，确定每种方法保持绝对稳定时沿负实轴的 $|z|$ 的最大无量纲界限。然后，对于固定的衰减率 $\\alpha$，计算在 $y' = -\\alpha y$ 上对所有四种方法都同时保持绝对稳定的最大统一时间步长 $h_{\\text{max}}$。\n\n将 $h_{\\text{max}}$ 的最终表达式表示为仅含 $\\alpha$ 的符号函数。最终时间步长以秒为单位表示。不需要进行数值四舍五入。",
            "solution": "首先验证问题是适定的、有科学依据且客观的。这是常微分方程数值分析中的一个标准练习。\n\n线性多步法（LMM）的稳定性是通过将其应用于线性测试方程 $y'(t) = \\lambda y(t)$（其中 $\\lambda \\in \\mathbb{C}$）来分析的。对于给定的问题 $y'(t) = -\\alpha y(t)$，我们有 $\\lambda = -\\alpha$，其中 $\\alpha$ 是一个正常数。一个通用的 $k$-步LMM由以下公式给出：\n$$ \\sum_{j=0}^{k} a_j y_{n+j} = h \\sum_{j=0}^{k} b_j f(t_{n+j}, y_{n+j}) $$\n其中 $h$ 是时间步长，$y_n \\approx y(t_n)$，并且我们归一化 $a_k = 1$。将此应用于测试方程 $y'(t) = \\lambda y(t)$ 得到：\n$$ \\sum_{j=0}^{k} a_j y_{n+j} = h \\lambda \\sum_{j=0}^{k} b_j y_{n+j} $$\n令 $z = h\\lambda = -h\\alpha$。我们寻找形式为 $y_n = \\xi^n$ 的解。将此代入方程得到稳定性多项式 $\\Pi(\\xi, z)$：\n$$ \\Pi(\\xi, z) = \\rho(\\xi) - z \\sigma(\\xi) = 0 $$\n其中 $\\rho(\\xi) = \\sum_{j=0}^{k} a_j \\xi^j$ 和 $\\sigma(\\xi) = \\sum_{j=0}^{k} b_j \\xi^j$ 分别是该方法的第一和第二特征多项式。\n\n对于给定的 $z$，如果稳定性多项式 $\\Pi(\\xi_i, z)=0$ 的所有根 $\\xi_i$ 都满足根条件：$|\\xi_i| \\le 1$，且任何模为 $|\\xi_i| = 1$ 的根都必须是单根，则该方法是绝对稳定的。绝对稳定域 $S$ 是复平面中所有满足此条件的 $z$ 的集合。我们关心的是该区域与负实轴的交集，它给出了一个形如 $[z_{b}, 0]$（其中 $z_b \\le 0$）的稳定区间。值 $|z_b|$ 是为保证稳定性对 $|z|$ 施加的最大无量纲界限。稳定域的边界可以通过设置 $|\\xi| = 1$ 来找到，对于负实轴，通常是设置 $\\xi = -1$。\n\n我们现在分析这四种方法。\n\n**1. Adams-Bashforth 2步方法（AB2，显式，2阶）**\n公式为 $y_{n+1} - y_n = h \\left( \\frac{3}{2} f_n - \\frac{1}{2} f_{n-1} \\right)$。为了确定多项式，我们将索引加1以匹配$k=2$的通用形式： $y_{n+2} - y_{n+1} = h \\left( \\frac{3}{2} f_{n+1} - \\frac{1}{2} f_n \\right)$。\n特征多项式为：\n$\\rho(\\xi) = \\xi^2 - \\xi$\n$\\sigma(\\xi) = \\frac{3}{2}\\xi - \\frac{1}{2}$\n稳定性多项式为 $\\xi^2 - \\xi - z\\left(\\frac{3}{2}\\xi - \\frac{1}{2}\\right) = 0$。\n负实轴上稳定区间的边界通常通过设置 $\\xi = -1$ 来找到：\n$$ (-1)^2 - (-1) - z\\left(\\frac{3}{2}(-1) - \\frac{1}{2}\\right) = 0 $$\n$$ 1 + 1 - z\\left(-\\frac{3}{2} - \\frac{1}{2}\\right) = 0 $$\n$$ 2 - z(-2) = 0 \\implies 2 + 2z = 0 \\implies z = -1 $$\n负实轴上的稳定区间是 $[-1, 0]$。$|z|$ 的最大界限是 $|z|_{\\text{max,AB2}} = |-1| = 1$。\n\n**2. Adams-Bashforth 3步方法（AB3，显式，3阶）**\n公式为 $y_{n+1} - y_n = h \\left( \\frac{23}{12} f_n - \\frac{16}{12} f_{n-1} + \\frac{5}{12} f_{n-2} \\right)$。我们将索引加2以匹配$k=3$的通用形式： $y_{n+3} - y_{n+2} = h \\left( \\frac{23}{12} f_{n+2} - \\frac{16}{12} f_{n+1} + \\frac{5}{12} f_n \\right)$。\n特征多项式为：\n$\\rho(\\xi) = \\xi^3 - \\xi^2$\n$\\sigma(\\xi) = \\frac{23}{12}\\xi^2 - \\frac{16}{12}\\xi + \\frac{5}{12}$\n稳定性多项式为 $\\xi^3 - \\xi^2 - z\\left(\\frac{23}{12}\\xi^2 - \\frac{16}{12}\\xi + \\frac{5}{12}\\right) = 0$。\n设置 $\\xi = -1$：\n$$ (-1)^3 - (-1)^2 - z\\left(\\frac{23}{12}(-1)^2 - \\frac{16}{12}(-1) + \\frac{5}{12}\\right) = 0 $$\n$$ -1 - 1 - z\\left(\\frac{23}{12} + \\frac{16}{12} + \\frac{5}{12}\\right) = 0 $$\n$$ -2 - z\\left(\\frac{44}{12}\\right) = 0 \\implies -2 - z\\frac{11}{3} = 0 \\implies z = -2 \\cdot \\frac{3}{11} = -\\frac{6}{11} $$\n稳定区间是 $[-6/11, 0]$。$|z|$ 的最大界限是 $|z|_{\\text{max,AB3}} = |-6/11| = \\frac{6}{11}$。\n\n**3. Adams-Moulton 2步方法（AM2，隐式，2阶）**\n该方法是梯形法则：$y_{n+1} - y_n = h \\left( \\frac{1}{2} f_{n+1} + \\frac{1}{2} f_n \\right)$。这是一个1步方法（$k=1$）。\n特征多项式为：\n$\\rho(\\xi) = \\xi - 1$\n$\\sigma(\\xi) = \\frac{1}{2}\\xi + \\frac{1}{2}$\n稳定性多项式方程为 $(\\xi - 1) - z\\left(\\frac{1}{2}\\xi + \\frac{1}{2}\\right) = 0$。\n解出 $\\xi$：\n$$ \\xi \\left(1 - \\frac{z}{2}\\right) = 1 + \\frac{z}{2} \\implies \\xi = \\frac{1 + z/2}{1 - z/2} $$\nA-稳定性条件 $|\\xi| \\le 1$ 变为 $|\\frac{1 + z/2}{1 - z/2}| \\le 1$。两边平方，这等价于 $|1 + z/2|^2 \\le |1 - z/2|^2$。令 $z = x+iy$。\n$$ (1 + x/2)^2 + (y/2)^2 \\le (1 - x/2)^2 + (y/2)^2 $$\n$$ 1 + x + x^2/4 \\le 1 - x + x^2/4 \\implies 2x \\le 0 \\implies \\text{Re}(z) \\le 0 $$\n此方法是 A-稳定的。其绝对稳定域是整个左半复平面。对于负实轴（$z = -h\\alpha  0$），该方法对任何 $h  0$ 都是稳定的。因此，稳定区间是 $(-\\infty, 0]$。$|z|$ 的界限是无穷大。\n$|z|_{\\text{max,AM2}} = \\infty$。\n\n**4. Adams-Moulton 3步方法（AM3，隐式，3阶）**\n公式为 $y_{n+1} - y_n = h \\left( \\frac{5}{12} f_{n+1} + \\frac{8}{12} f_n - \\frac{1}{12} f_{n-1} \\right)$。我们将索引加1以匹配$k=2$的通用形式：$y_{n+2} - y_{n+1} = h \\left( \\frac{5}{12} f_{n+2} + \\frac{8}{12} f_{n+1} - \\frac{1}{12} f_n \\right)$。\n特征多项式为：\n$\\rho(\\xi) = \\xi^2 - \\xi$\n$\\sigma(\\xi) = \\frac{5}{12}\\xi^2 + \\frac{8}{12}\\xi - \\frac{1}{12}$\n稳定性多项式为 $\\xi^2 - \\xi - z\\left(\\frac{5}{12}\\xi^2 + \\frac{8}{12}\\xi - \\frac{1}{12}\\right) = 0$。\n设置 $\\xi = -1$：\n$$ (-1)^2 - (-1) - z\\left(\\frac{5}{12}(-1)^2 + \\frac{8}{12}(-1) - \\frac{1}{12}\\right) = 0 $$\n$$ 1 + 1 - z\\left(\\frac{5}{12} - \\frac{8}{12} - \\frac{1}{12}\\right) = 0 $$\n$$ 2 - z\\left(\\frac{-4}{12}\\right) = 0 \\implies 2 - z\\left(-\\frac{1}{3}\\right) = 0 \\implies 2 + \\frac{z}{3} = 0 \\implies z = -6 $$\n稳定区间是 $[-6, 0]$。$|z|$ 的最大界限是 $|z|_{\\text{max,AM3}} = |-6| = 6$。\n\n**同时稳定性条件**\n对于一个固定的时间步长 $h$，要使其在应用于 $y' = -\\alpha y$ 时对所有四种方法都同时稳定，无量纲量 $|z| = h\\alpha$ 必须满足每种方法的稳定性条件：\n$$ h\\alpha \\le \\min\\left(|z|_{\\text{max,AB2}}, |z|_{\\text{max,AB3}}, |z|_{\\text{max,AM2}}, |z|_{\\text{max,AM3}}\\right) $$\n代入推导出的界限：\n$$ h\\alpha \\le \\min\\left(1, \\frac{6}{11}, \\infty, 6\\right) $$\n比较有限值：$\\frac{6}{11} \\approx 0.545$、 $1$ 和 $6$。最小值为 $\\frac{6}{11}$。\n因此，同时绝对稳定的条件是 $h\\alpha \\le \\frac{6}{11}$。\n\n最大的统一时间步长 $h_{\\text{max}}$ 在此不等式的极限处获得：\n$$ h_{\\text{max}}\\alpha = \\frac{6}{11} $$\n解出 $h_{\\text{max}}$ 得到：\n$$ h_{\\text{max}} = \\frac{6}{11\\alpha} $$\n问题要求答案以秒为单位。假设衰减率常数 $\\alpha$ 的单位是秒的倒数（$s^{-1}$），则得到的时间步长 $h_{\\text{max}}$ 的单位将是秒。",
            "answer": "$$\\boxed{\\frac{6}{11\\alpha}}$$"
        },
        {
            "introduction": "真实的环境系统很少具有均匀的物理属性，这使得简单的解析稳定性分析方法难以适用。本计算练习旨在弥合理论与实践之间的鸿沟，挑战一个具有空间非均匀系数的反应扩散问题。您将运用线方法，将复杂的空间算子组装成一个矩阵，并通过数值计算该矩阵的谱半径来确定显式欧拉时间步长的稳定性极限——这是一种适用于复杂模型的强大通用技术 。",
            "id": "3899693",
            "problem": "考虑一个环境柱中通用被动标量的一维输运，其扩散系数 $\\kappa(x)$ 和一阶反应速率 $\\alpha(x)$ 在空间上非均匀。连续的控制定律是质量守恒结合 Fickian 扩散和线性反应：标量浓度 $u(x,t)$ 满足偏微分方程 (PDE)\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u,\n$$\n在域 $x \\in [0,L]$ 上，使用齐次 Dirichlet 边界条件 $u(0,t) = 0$ 和 $u(L,t) = 0$。假设对所有 $x$ 都有 $\\kappa(x) \\ge 0$ 和 $\\alpha(x) \\ge 0$。\n\n使用具有 $N$ 个内部点的均匀网格对空间算子进行离散化，间距为 $\\Delta x = L/(N+1)$，内部节点位置为 $x_i = i\\,\\Delta x$ (对于 $i = 1,\\dots,N$)，面心位置为 $x_{j+\\frac{1}{2}} = (j+\\tfrac{1}{2})\\,\\Delta x$ (对于 $j = 0,\\dots,N$)。在面心处计算扩散系数 $\\kappa_{j+\\frac{1}{2}} = \\kappa(x_{j+\\frac{1}{2}})$，在节点处计算反应速率 $\\alpha_i = \\alpha(x_i)$。使用带有 Dirichlet 边界条件的二阶保守通量形式，组装与半离散系统 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\,\\mathbf{u}$ 对应的线性离散算子 $\\mathbf{L} \\in \\mathbb{R}^{N \\times N}$：\n- 对于 $i = 1,\\dots,N$，\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i,\n$$\n约定 $u_0 = 0$ 和 $u_{N+1} = 0$。\n\n考虑半离散系统的显式前向欧拉 (Forward Euler) 时间步进格式，$ \\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n}$。将稳定性极限定义为最大时间步长 $\\Delta t_{\\max}$（单位为秒），在此步长下，前向欧拉方法对离散算子 $\\mathbf{L}$ 的所有模式都保持线性稳定。\n\n任务：\n1. 根据上述规范，为每个测试案例组装矩阵 $\\mathbf{L}$。\n2. 使用适用于对称正定矩阵的迭代方法，通过计算 $-\\mathbf{L}$ 的最大特征值来估计所组装矩阵的谱半径 $\\rho(\\mathbf{L})$。\n3. 根据估计的谱半径，计算最大允许的前向欧拉时间步长 $\\Delta t_{\\max}$（单位为秒）。报告所有 $\\Delta t_{\\max}$ 值，四舍五入到小数点后 $6$ 位。\n4. 你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,r_3]$）。\n\n单位和约定：\n- 域长度 $L$ 必须以米（$\\mathrm{m}$）为单位指定。\n- 扩散系数 $\\kappa(x)$ 必须以平方米/秒（$\\mathrm{m}^2/\\mathrm{s}$）为单位指定。\n- 反应速率 $\\alpha(x)$ 必须以秒的倒数（$\\mathrm{s}^{-1}$）为单位指定。\n- 最终时间步长 $\\Delta t_{\\max}$ 必须以秒（$\\mathrm{s}$）为单位表示。\n\n测试套件（四个案例，旨在检验不同的非均匀性模式和边界条件）：\n\n- 案例 A（平滑非均匀性）：\n    - $L = 100\\,\\mathrm{m}$, $N = 50$,\n    - $\\kappa(x) = 10^{-2}\\,\\big(1 + 0.5 \\sin(2\\pi x / L)\\big)$,\n    - $\\alpha(x) = 10^{-3}\\,\\big(1 + 0.25 \\cos(2\\pi x / L)\\big)$.\n\n- 案例 B（双层介质，无反应）：\n    - $L = 100\\,\\mathrm{m}$, $N = 100$,\n    - $\\kappa(x) = \\begin{cases}\n        5 \\times 10^{-3},  x  40\\,\\mathrm{m},\\\\\n        2 \\times 10^{-2},  x \\ge 40\\,\\mathrm{m},\n      \\end{cases}$\n    - $\\alpha(x) \\equiv 0$.\n\n- 案例 C（线性变化的扩散与强局部反应）：\n    - $L = 100\\,\\mathrm{m}$, $N = 80$,\n    - $\\kappa(x) = 1.5 \\times 10^{-2}\\,\\big(1 + 0.9\\,x/L\\big)$,\n    - $\\alpha(x) = \\begin{cases}\n        2 \\times 10^{-2},  30\\,\\mathrm{m} \\le x \\le 70\\,\\mathrm{m},\\\\\n        10^{-3},  \\text{其他情况},\n      \\end{cases}$.\n\n- 案例 D（边界增强扩散，弱反应）：\n    - $L = 10\\,\\mathrm{m}$, $N = 50$,\n    - $\\kappa(x) = 10^{-2}\\,\\Big(1 + 4\\,e^{-(x/1)^2} + 4\\,e^{-((x - L)/1)^2}\\Big)$,\n    - $\\alpha(x) \\equiv 10^{-5}$.\n\n输出规范：\n- 为每个案例计算 $\\Delta t_{\\max}$，结果为浮点数，单位为秒。\n- 你的程序应生成单行输出，其中包含按 A、B、C、D 顺序排列的四个结果，以逗号分隔的列表形式用方括号括起来，并四舍五入到小数点后 $6$ 位，例如 $[a,b,c,d]$。",
            "solution": "确定应用于一维反应扩散方程的前向欧拉格式的最大稳定时间步长问题，是数值分析中一个适定且有科学依据的练习。所提供的控制方程、离散化方案和边界条件在计算物理和工程领域是标准的。每个测试案例的所有参数和函数都已明确定义，使得该问题自成体系且清晰明确。验证证实了该问题是合理的，并且可以推导出严谨的解。\n\n求解过程分为三个主要步骤：首先，我们将离散线性算子表示为矩阵；其次，我们分析前向欧拉方法的稳定性，以推导出最大时间步长 $\\Delta t_{\\max}$ 的表达式；第三，我们设计一种计算策略，为给定的测试案例计算该值。\n\n**1. 离散化与矩阵构建**\n\n控制偏微分方程为：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial x}\\!\\left(\\kappa(x)\\,\\frac{\\partial u}{\\partial x}\\right) - \\alpha(x)\\,u\n$$\n空间域 $x \\in [0, L]$ 被离散化为 $N$ 个内部单元，宽度为 $\\Delta x = L/(N+1)$。浓度 $u(x,t)$ 由一个向量 $\\mathbf{u}(t) \\in \\mathbb{R}^N$ 表示，其中 $(\\mathbf{u})_i = u_i(t) \\approx u(x_i, t)$。半离散系统为 $\\frac{d\\mathbf{u}}{dt} = \\mathbf{L}\\mathbf{u}$，其中 $\\mathbf{L}$ 是一个 $N \\times N$ 矩阵。\n\n$\\mathbf{L}\\mathbf{u}$ 的第 $i$ 个分量由指定的二阶保守有限差分/体积公式给出：\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\frac{1}{\\Delta x}\\left[\\kappa_{i+\\frac{1}{2}}\\,\\frac{u_{i+1}-u_i}{\\Delta x} - \\kappa_{i-\\frac{1}{2}}\\,\\frac{u_i-u_{i-1}}{\\Delta x}\\right] - \\alpha_i\\,u_i\n$$\n通过收集乘以 $u_{i-1}$、$u_i$ 和 $u_{i+1}$ 的项，我们可以确定矩阵 $\\mathbf{L}$ 的元素。\n$$\n(\\mathbf{L}\\mathbf{u})_i = \\left(\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i-1} + \\left(-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i\\right) u_i + \\left(\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}\\right) u_{i+1}\n$$\n这种结构定义了一个三对角矩阵 $\\mathbf{L}$。通过在 $i=1$ 和 $i=N$ 的方程中分别设置 $u_0=0$ 和 $u_{N+1}=0$，齐次 Dirichlet 边界条件 $u(0,t)=0$ 和 $u(L,t)=0$ 被纳入考虑。对于 $i,j \\in \\{1,\\dots,N\\}$，$\\mathbf{L}$ 的元素为：\n$$\nL_{ij} = \\begin{cases}\n\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{如果 } j=i-1 \\\\\n-\\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} - \\alpha_i  \\text{如果 } j=i \\\\\n\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{如果 } j=i+1 \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n由于 $\\kappa(x)$ 对 $L_{i,i-1}$ 和 $L_{i-1,i}$ 都是在同一个面心位置 $x_{i-1/2}$ 进行求值，因此矩阵 $\\mathbf{L}$ 是对称的。\n\n**2. 前向欧拉方法的稳定性分析**\n\n前向欧拉时间步进格式为：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{n} + \\Delta t\\,\\mathbf{L}\\,\\mathbf{u}^{n} = (\\mathbf{I} + \\Delta t\\,\\mathbf{L})\\mathbf{u}^{n}\n$$\n其中 $\\mathbf{I}$ 是单位矩阵。为使该方法稳定，放大矩阵 $\\mathbf{G} = \\mathbf{I} + \\Delta t\\,\\mathbf{L}$ 的谱半径不得超过 $1$。即 $\\rho(\\mathbf{G}) \\le 1$。\n\n$\\mathbf{G}$ 的特征值为 $\\mu_j = 1 + \\Delta t\\,\\lambda_j$，其中 $\\{\\lambda_j\\}$ 是 $\\mathbf{L}$ 的特征值。稳定性条件是对于所有 $j$ 都有 $|\\mu_j| \\le 1$。\n\n矩阵 $\\mathbf{L}$ 是对称的，因此其特征值 $\\lambda_j$ 都是实数。此外，$\\mathbf{L}$ 是负定的。这可以通过考虑二次型 $\\mathbf{v}^T \\mathbf{L} \\mathbf{v}$ 来证明。$\\mathbf{L}$ 的扩散部分对应于离散的负拉普拉斯算子，在 Dirichlet 条件下是负定的，而反应部分 $-\\text{diag}(\\alpha_i)$ 是半负定的（因为 $\\alpha_i \\ge 0$）。因此，所有特征值 $\\lambda_j$ 都是实数且为负。\n\n对于 $\\lambda_j  0$，稳定性条件 $|1 + \\Delta t\\,\\lambda_j| \\le 1$ 可简化为：\n$$\n-1 \\le 1 + \\Delta t\\,\\lambda_j \\le 1\n$$\n由于 $\\Delta t  0$ 和 $\\lambda_j  0$，右侧的不等式总是成立的。左侧的不等式决定了稳定性极限：\n$$\n-2 \\le \\Delta t\\,\\lambda_j \\implies \\Delta t \\le \\frac{-2}{\\lambda_j} = \\frac{2}{-\\lambda_j} = \\frac{2}{|\\lambda_j|}\n$$\n这必须对所有特征值都成立。最严格的约束来自于绝对值最大的特征值，即最小的负特征值 $\\lambda_{\\min} = \\min_j(\\lambda_j)$。因此，最大稳定时间步长为：\n$$\n\\Delta t_{\\max} = \\frac{2}{|\\lambda_{\\min}|} = \\frac{2}{\\max_j |\\lambda_j|} = \\frac{2}{\\rho(\\mathbf{L})}\n$$\n其中 $\\rho(\\mathbf{L})$ 是 $\\mathbf{L}$ 的谱半径。\n\n**3. 计算策略**\n\n任务简化为计算 $\\mathbf{L}$ 的谱半径。问题引导我们去计算矩阵 $\\mathbf{M} = -\\mathbf{L}$ 的最大特征值。$\\mathbf{M}$ 的特征值是 $-\\lambda_j$。由于 $\\lambda_j  0$，$\\mathbf{M}$ 的所有特征值都是正数。$\\mathbf{M}$ 的最大特征值 $\\lambda_{\\max}(\\mathbf{M})$ 是：\n$$\n\\lambda_{\\max}(\\mathbf{M}) = \\max_j(-\\lambda_j) = -\\min_j(\\lambda_j) = -\\lambda_{\\min} = |\\lambda_{\\min}| = \\rho(\\mathbf{L})\n$$\n矩阵 $\\mathbf{M} = -\\mathbf{L}$ 是对称正定的 (SPD)。问题正确地建议使用适合于对称正定矩阵的迭代方法。在 `scipy.sparse.linalg.eigsh` 中实现的 Lanczos 算法是寻找大型对称矩阵最大特征值的一种高效且稳健的选择，它满足“迭代方法”的要求。\n\n每个测试案例的算法如下：\n1.  定义参数 $L$ 和 $N$，以及函数 $\\kappa(x)$ 和 $\\alpha(x)$。\n2.  构建网格：空间步长 $\\Delta x = L/(N+1)$，节点位置 $x_i$ 和面心位置 $x_{j+1/2}$。\n3.  在面心网格上计算 $\\kappa(x)$，在节点网格上计算 $\\alpha(x)$。\n4.  组装 $N \\times N$ 矩阵 $\\mathbf{M} = -\\mathbf{L}$，其元素为：\n    $$\n    M_{ij} = \\begin{cases}\n    -\\frac{\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2}  \\text{如果 } j=i-1 \\\\\n    \\frac{\\kappa_{i+\\frac{1}{2}}+\\kappa_{i-\\frac{1}{2}}}{(\\Delta x)^2} + \\alpha_i  \\text{如果 } j=i \\\\\n    -\\frac{\\kappa_{i+\\frac{1}{2}}}{(\\Delta x)^2}  \\text{如果 } j=i+1 \\\\\n    0  \\text{其他情况}\n    \\end{cases}\n    $$\n5.  使用 `scipy.sparse.linalg.eigsh` 计算 $\\mathbf{M}$ 的最大特征值，该值等于 $\\rho(\\mathbf{L})$。\n6.  计算 $\\Delta t_{\\max} = 2 / \\rho(\\mathbf{L})$。\n7.  最终结果四舍五入到小数点后 $6$ 位，并按要求格式呈现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse.linalg import eigsh\n\ndef calculate_dt_max(L, N, kappa_func, alpha_func):\n    \"\"\"\n    Assembles the discrete operator matrix and computes the max stable time step.\n\n    Args:\n        L (float): Domain length in meters.\n        N (int): Number of interior grid points.\n        kappa_func (callable): Function for diffusion coefficient kappa(x).\n        alpha_func (callable): Function for reaction rate alpha(x).\n\n    Returns:\n        float: The maximum stable time step (dt_max) in seconds.\n    \"\"\"\n    # 1. Construct the grid\n    dx = L / (N + 1)\n    # Node locations x_i for i=1,...,N\n    x_nodes = np.arange(1, N + 1) * dx\n    # Face locations x_{j+1/2} for j=0,...,N\n    x_faces = (np.arange(0, N + 1) + 0.5) * dx\n\n    # 2. Evaluate kappa at faces and alpha at nodes\n    kappa_at_faces = kappa_func(x_faces)\n    alpha_at_nodes = alpha_func(x_nodes)\n\n    # 3. Assemble the matrix M = -L\n    # M is an N x N symmetric positive definite matrix.\n    # Python array indices k are from 0 to N-1.\n    # The PDE node index i corresponds to array index k=i-1.\n    # kappa_{i-1/2} corresponds to kappa_at_faces[k]\n    # kappa_{i+1/2} corresponds to kappa_at_faces[k+1]\n    \n    M = np.zeros((N, N))\n    \n    # Diagonal entries\n    # M_kk = (kappa_{k+1/2} + kappa_{k-1/2}) / dx^2 + alpha_k\n    diag_terms = (kappa_at_faces[1:] + kappa_at_faces[:-1]) / dx**2 + alpha_at_nodes\n    np.fill_diagonal(M, diag_terms)\n\n    # Off-diagonal entries\n    # M_{k,k+1} = -kappa_{k+1/2} / dx^2\n    off_diag_terms = -kappa_at_faces[1:-1] / dx**2\n    np.fill_diagonal(M[0:, 1:], off_diag_terms)\n    np.fill_diagonal(M[1:, 0:], off_diag_terms) # Symmetric matrix\n\n    # 4. Compute the largest eigenvalue of M\n    # M is SPD, so its largest magnitude eigenvalue is its largest eigenvalue.\n    # eigsh uses an iterative method (Lanczos) suitable for large symmetric matrices.\n    # k=1 asks for only one eigenvalue, which='LM' specifies the largest magnitude.\n    # Since M is dense but N is small, this is efficient enough.\n    spectral_radius_L = eigsh(M, k=1, which='LM', return_eigenvectors=False)[0]\n\n    # 5. Compute the maximum stable time step\n    dt_max = 2.0 / spectral_radius_L\n    \n    return dt_max\n\ndef solve():\n    # Define kappa and alpha functions for each test case\n    # Case A\n    def kappa_A(x):\n        L_A = 100.0\n        return 1e-2 * (1.0 + 0.5 * np.sin(2.0 * np.pi * x / L_A))\n    def alpha_A(x):\n        L_A = 100.0\n        return 1e-3 * (1.0 + 0.25 * np.cos(2.0 * np.pi * x / L_A))\n\n    # Case B\n    def kappa_B(x):\n        return np.where(x  40.0, 5e-3, 2e-2)\n    def alpha_B(x):\n        return np.zeros_like(x)\n\n    # Case C\n    def kappa_C(x):\n        L_C = 100.0\n        return 1.5e-2 * (1.0 + 0.9 * x / L_C)\n    def alpha_C(x):\n        return np.where((x = 30.0)  (x = 70.0), 2e-2, 1e-3)\n\n    # Case D\n    def kappa_D(x):\n        L_D = 10.0\n        return 1e-2 * (1 + 4 * np.exp(-(x**2)) + 4 * np.exp(-((x - L_D)**2)))\n    def alpha_D(x):\n        return np.full_like(x, 1e-5)\n\n    test_cases = [\n        {'L': 100.0, 'N': 50, 'kappa_func': kappa_A, 'alpha_func': alpha_A},\n        {'L': 100.0, 'N': 100, 'kappa_func': kappa_B, 'alpha_func': alpha_B},\n        {'L': 100.0, 'N': 80, 'kappa_func': kappa_C, 'alpha_func': alpha_C},\n        {'L': 10.0, 'N': 50, 'kappa_func': kappa_D, 'alpha_func': alpha_D}\n    ]\n\n    results = []\n    for case in test_cases:\n        dt = calculate_dt_max(case['L'], case['N'], case['kappa_func'], case['alpha_func'])\n        results.append(dt)\n\n    # Format results to 6 decimal places and print in the specified format\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}