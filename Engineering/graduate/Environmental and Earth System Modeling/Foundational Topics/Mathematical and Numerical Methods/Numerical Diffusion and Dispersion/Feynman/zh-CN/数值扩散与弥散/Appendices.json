{
    "hands_on_practices": [
        {
            "introduction": "冯·诺伊曼稳定性分析为我们提供了理论上的放大因子 $G(k)$，它是理解数值格式行为的核心。本次实践旨在通过一个数值实验，直接计算测量放大因子的大小 $|G(k)|$，从而将抽象的理论与具体的模拟结果联系起来。这个练习不仅能验证我们的理论理解，还为我们提供了一种诊断和评估不同数值格式性能的实用工具。",
            "id": "3899290",
            "problem": "您的任务是为一维、周期性、线性平流模型设计并实现一个基于傅里叶的数值扩散诊断工具。其基本原理是一维线性平流方程，\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0,\n$$\n该方程定义在长度为 $L$ 的周期性域上，使用包含 $N$ 个点的均匀网格，网格间距为 $\\Delta x = L/N$。物理参数为平流速度 $c$（单位：米/秒）和时间步长 $\\Delta t$（单位：秒）。对于单模初始条件，\n$$\nu(x,0) = \\cos(k x),\n$$\n其中波数 $k$ 的单位为弧度/米，纯平流的精确连续解会保持振幅不变，这意味着经过单个时间步后，数值计算出的振幅的任何衰减都源于数值扩散。该诊断工具应通过测量一个时间步 $\\Delta t$ 内离散傅里叶振幅的衰减，来估计数值放大因子的模，记为 $|G(k)|$。\n\n为了使该诊断算法具体化并可测试，我们使用一阶迎风有限差分格式来近似平流方程（适用于正平流速度 $c > 0$）：\n$$\nu_i^{n+1} = u_i^n - \\nu \\left(u_i^n - u_{i-1}^n\\right),\n$$\n其中 $u_i^n$ 是网格索引 $i$ 和时间层 $n$ 上的离散解，$\\nu = \\frac{c \\Delta t}{\\Delta x}$ 是 Courant-Friedrichs-Lewy (CFL) 数。强制施加周期性边界条件，使得 $u_{-1}^n$被解释为 $u_{N-1}^n$。将场初始化为\n$$\nu_i^0 = \\cos(k x_i), \\quad x_i = i \\Delta x, \\quad i = 0,1,\\dots,N-1,\n$$\n其中波数的选择与离散网格兼容：$k = \\frac{2\\pi m}{L}$，对于整数模索引 $m \\in \\{0,1,\\dots,N-1\\}$。\n\n通过计算一个时间步后模 $m$ 处的离散傅里叶变换 (DFT) 系数的模与初始模的比值，来估计数值放大因子的模 $|G(k)|$。具体来说，令 $U_m^0$ 和 $U_m^1$ 分别表示从 $u_i^0$ 和 $u_i^1$ 得到的模 $m$ 处的复数 DFT 系数（使用标准的未归一化 DFT）。然后计算\n$$\n|G(k)| = \\frac{\\left|U_m^1\\right|}{\\left|U_m^0\\right|}。\n$$\n在此，离散场 $\\{u_i\\}_{i=0}^{N-1}$ 的离散傅里叶变换 (DFT) 定义为\n$$\n\\hat{u}_m = \\sum_{i=0}^{N-1} u_i \\exp\\left(-\\mathrm{i} \\frac{2\\pi m i}{N}\\right),\n$$\n针对模索引 $m$。诊断结果 $|G(k)|$ 是无量纲的，并且必须以浮点数形式报告。\n\n在所有测试用例中，使用以下共享的物理一致性参数：\n- 域长度 $L = 1000$ 米。\n- 网格点数 $N = 128$，因此 $\\Delta x = L/N$ 米。\n- 平流速度 $c = 10$ 米/秒。\n- 模波数 $k = \\frac{2\\pi m}{L}$ 弧度/米，整数 $m$ 由每个测试用例指定。\n- 时间步长 $\\Delta t$ 由 Courant-Friedrichs-Lewy (CFL) 数 $\\nu$ 决定，通过 $\\Delta t = \\nu \\frac{\\Delta x}{c}$ 秒计算。\n\n您的程序必须：\n1. 针对每个测试用例中指定的 $m$，初始化场 $u_i^0 = \\cos(k x_i)$。\n2. 使用带周期性边界条件的一阶迎风格式将场推进一个时间步。\n3. 计算初始场和推进后场的 DFT，并针对指定的模 $m$ 评估 $|G(k)|$。\n4. 汇总所有测试用例的结果，并生成包含浮点结果列表的单行输出。\n\n测试套件：\n- 用例 1 (正常路径，长波，中等稳定性): $m = 1$, $\\nu = 0.2$。\n- 用例 2 (中尺度波，CFL 为 0.5): $m = 32$, $\\nu = 0.5$。\n- 用例 3 (近奈奎斯特波，接近稳定性边界的高 CFL): $m = 63$, $\\nu = 0.9$。\n- 用例 4 (零模边界情况): $m = 0$, $\\nu = 0.7$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表，例如，\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4].\n$$\n每个 $\\text{result}_j$ 必须是相应测试用例计算出的 $|G(k)|$ 的浮点值。最终答案不需要单位，因为 $|G(k)|$ 是无量纲的。",
            "solution": "该问题被评估为有效，因为它科学地基于偏微分方程数值分析的原理，问题定义清晰，具有完整且一致的参数集，并以客观、正式的语言表述。任务是为一维线性平流模型实现一个数值扩散的诊断工具。\n\n控制方程是线性平流方程：\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = 0\n$$\n该方程在一个长度为 $L$ 的周期性域上使用一个包含 $N$ 个点的网格进行求解。空间网格点为 $x_i = i \\Delta x$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$，网格间距为 $\\Delta x = L/N$。\n\n数值格式为一阶迎风法，对于正平流速度 $c > 0$，该方法将方程离散化为：\n$$\nu_i^{n+1} = u_i^n - \\nu (u_i^n - u_{i-1}^n)\n$$\n此处，$u_i^n$ 表示在网格点 $i$ 和时间层 $n$ 上的解，而 $\\nu = \\frac{c \\Delta t}{\\Delta x}$ 是 Courant-Friedrichs-Lewy (CFL) 数。时间步长为 $\\Delta t$。周期性边界条件意味着 $u_{-1}^n = u_{N-1}^n$。\n\n诊断过程包括以下步骤：\n\n1.  **参数计算**：对于每个由模索引 $m$ 和 CFL 数 $\\nu$ 指定的测试用例，我们首先计算必要的物理和数值参数。\n    -   网格间距：$\\Delta x = \\frac{L}{N} = \\frac{1000}{128} = 7.8125$ 米。\n    -   波数：$k = \\frac{2\\pi m}{L}$。这确保了初始波形在域上是周期性的。\n    -   时间步长：$\\Delta t = \\nu \\frac{\\Delta x}{c}$。这是从 CFL 数的定义中推导出来的。\n\n2.  **初始化**：在时间 $t=0$（即时间层 $n=0$）时，用单模余弦波初始化模拟场：\n    $$\n    u_i^0 = \\cos(k x_i) = \\cos\\left(\\frac{2\\pi m}{L} \\cdot i \\Delta x\\right) = \\cos\\left(\\frac{2\\pi m i}{N}\\right)\n    $$\n    这个离散场表示初始状态 $u(x,0)$。\n\n3.  **时间推进**：我们将解推进一个时间步长 $\\Delta t$，以获得时间层 $n=1$ 上的场，记为 $u_i^1$。这通过应用一次迎风格式来完成：\n    $$\n    u_i^1 = u_i^0 - \\nu (u_i^0 - u_{i-1}^0)\n    $$\n    周期性边界条件通过将索引 $i-1$ 对 $N$ 取模来处理。对于 $i=0$，$u_{-1}^0$ 变为 $u_{N-1}^0$。\n\n4.  **傅里叶分析**：诊断的核心是比较时间步前后解的傅里叶谱。我们计算初始场 $u^0$ 和推进后场 $u^1$ 的离散傅里叶变换 (DFT)。序列 $\\{v_i\\}_{i=0}^{N-1}$ 的 DFT 由下式给出：\n    $$\n    \\hat{v}_j = \\sum_{i=0}^{N-1} v_i \\exp\\left(-\\mathrm{i} \\frac{2\\pi j i}{N}\\right)\n    $$\n    令 $U_m^0$ 和 $U_m^1$ 分别为对应于初始场 $u_i^0$ 和 $u_i^1$ 的模索引 $m$ 处的复数 DFT 系数。\n\n5.  **放大因子计算**：在波数 $k$ 处的数值放大因子的模，记为 $|G(k)|$，量化了特定模式由于数值格式引起的振幅变化。它被估计为模 $m$ 处 DFT 系数模的比值：\n    $$\n    |G(k)| = \\frac{|U_m^1|}{|U_m^0|}\n    $$\n    初始条件 $u_i^0 = \\cos\\left(\\frac{2\\pi m i}{N}\\right)$ 可以使用欧拉公式表示为 $\\frac{1}{2}\\left(e^{\\mathrm{i} \\frac{2\\pi m i}{N}} + e^{-\\mathrm{i} \\frac{2\\pi m i}{N}}\\right)$。其 DFT 的非零系数主要出现在模索引 $m$ 和 $N-m$ 处（这是离散网格上 $-m$ 的别名）。因此，对于 $m \\in \\{1, \\dots, N/2\\}$， $|U_m^0|$ 将不为零，从而确保该比率是良定义的。\n    \n    一个特殊情况是 $m=0$，对应于 $k=0$。初始条件对于所有 $i$ 都是 $u_i^0 = \\cos(0) = 1$。对于一个常数场，项 $(u_i^0 - u_{i-1}^0)$ 为零，所以 $u_i^1 = u_i^0$。因此，$U_0^1 = U_0^0$，我们期望 $|G(0)|$ 精确地等于 1。\n\n对于每个测试用例，都遵循此过程来计算 $|G(k)|$ 的单个浮点值。最终输出是这些值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the numerical amplification factor for the first-order upwind scheme\n    for a series of test cases based on a 1D linear advection model.\n    \"\"\"\n    \n    # Define shared physical and numerical parameters.\n    L = 1000.0  # Domain length in meters\n    N = 128     # Number of grid points\n    c = 10.0    # Advection speed in m/s\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (mode index m, CFL number nu)\n    test_cases = [\n        (1, 0.2),   # Case 1: long wave, moderate stability\n        (32, 0.5),  # Case 2: mid-scale wave, half CFL\n        (63, 0.9),  # Case 3: near-Nyquist wave, high CFL\n        (0, 0.7),   # Case 4: zero mode boundary case\n    ]\n    \n    results = []\n    \n    # Calculate grid spacing (constant for all cases)\n    dx = L / N\n    \n    # Generate the spatial grid coordinates (constant for all cases)\n    x = np.arange(N) * dx\n    \n    for m, nu in test_cases:\n        # Step 1: Calculate case-specific parameters\n        # Wavenumber k is implicitly handled via the mode index m and grid properties\n        # during initialization and DFT analysis.\n        # It can be explicitly calculated as:\n        # k = (2 * np.pi * m) / L\n        \n        # Step 2: Initialize the field u^0\n        # u_i^0 = cos(k * x_i) = cos( (2*pi*m/L) * (i*L/N) ) = cos(2*pi*m*i / N)\n        # Using arange(N) for indices i = 0, 1, ..., N-1\n        u0 = np.cos(2.0 * np.pi * m * np.arange(N) / N)\n        \n        # Step 3: Advance the field by one time step to get u^1\n        # The upwind scheme is u_i^{n+1} = u_i^n - nu * (u_i^n - u_{i-1}^n).\n        # np.roll(u0, 1) shifts elements to the right, so u0[i] becomes u0[i-1],\n        # correctly implementing the periodic boundary condition.\n        u1 = u0 - nu * (u0 - np.roll(u0, 1))\n        \n        # Step 4: Compute the Discrete Fourier Transforms (DFTs)\n        # numpy.fft.fft provides the unnormalized DFT as specified.\n        U0_coeffs = np.fft.fft(u0)\n        U1_coeffs = np.fft.fft(u1)\n        \n        # Extract the complex coefficient at the specified mode m\n        U0_m = U0_coeffs[m]\n        U1_m = U1_coeffs[m]\n        \n        # Step 5: Calculate the magnitude of the numerical amplification factor\n        # For m=0, u0 is a constant field, so |U0_m| is N != 0.\n        # For m > 0, cos(2*pi*m*i/N) is composed of two complex exponentials,\n        # so |U0_m| is N/2 != 0. Thus, division by zero is not an issue.\n        if np.abs(U0_m) == 0:\n            # This case should not be reached with the given initial conditions.\n            # If it were, it would imply the initial mode has zero amplitude,\n            # making the amplification factor undefined. We'd assign 1.0.\n            amp_factor = 1.0\n        else:\n            amp_factor = np.abs(U1_m) / np.abs(U0_m)\n            \n        results.append(amp_factor)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "虽然单模态分析富有洞察力，但真实世界中的信号（如示踪剂羽流）通常由多种频率的波叠加而成。本次实践使用一个高斯脉冲作为更真实的信号，来观察数值扩散和数值频散的综合影响。通过设计特定的指标来分别衡量方差衰减和相位偏移，我们将学习如何在实际模拟中分离并量化这两种截然不同的数值误差。",
            "id": "3803225",
            "problem": "考虑由偏微分方程 $c_t + u c_x = 0$ 控制的被动示踪剂的一维线性平流，该过程发生在长度为 $L$、速度为常数 $u$ 的周期性域上。在没有物理扩散的情况下，精确解会输运任何初始条件 $c(x,0)$，而不会改变其形状、总质量或空间方差。然而，离散数值格式会引入数值误差，这些误差可以分解为两种效应：数值扩散（即振幅阻尼，会减小示踪剂波动的方差）和数值频散（即相位误差，会移动或扭曲特征，但不一定会改变其振幅）。您的任务是使用两种标准的显式格式，对一个高斯脉冲在恰好一个平流周期 $T = L/u$ 内的这两种效应进行量化。\n\n实现一个程序，该程序：\n- 在一个具有 $N$ 个点、网格间距为 $\\Delta x = L/N$ 的均匀周期性网格上表示解，并根据指定的库朗-弗里德里希斯-列维数（CFL）$\\mathrm{C} = u \\Delta t / \\Delta x$ 选择时间步长 $\\Delta t$。\n- 在 $[0,L)$ 上将示踪剂初始化为一个以 $x_0$ 为中心、标准差为 $\\sigma$ 的高斯脉冲：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right),\n$$\n其中 $d(x;x_0)$ 是在环 $[0,L)$ 上 $x$ 和 $x_0$ 之间的最小周期距离，因此 $d \\in \\left[-\\frac{L}{2},\\frac{L}{2}\\right]$。\n- 使用以下保守、周期性的有限差分更新规则之一，将示踪剂演化恰好一个周期 $T = L/u$（空间用索引 $i \\in \\{0,\\dots,N-1\\}$ 离散化，时间层级为 $n$）：\n    1. 一阶迎风格式（对于 $u \\ge 0$）：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\,\\left(c_i^n - c_{i-1}^n\\right),\n    $$\n    使用周期性索引 $c_{-1}^n \\equiv c_{N-1}^n$。\n    2. Lax–Wendroff（二阶）格式：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right),\n    $$\n    使用周期性索引。\n- 确保时间步数 $n_T$ 恰好满足 $n_T \\Delta t = T$。对于下方的测试套件，通过选择 $\\mathrm{C}$ 使得 $T/\\Delta t = N/\\mathrm{C}$ 为整数来保证这一点。\n- 通过在 $t=0$ 和 $t=T$ 之间零均值示踪剂场的离散空间方差（每单位长度）的衰减来量化数值扩散。定义在时间 $t^n$ 的离散均值和方差为\n$$\n\\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2.\n$$\n报告比率\n$$\nR_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}},\n$$\n如果存在数值扩散，该值应小于 $1$；对于完全非扩散性的演化，该值等于 $1$。\n- 通过零均值示踪剂场的主导大尺度傅里叶模态在一个周期内的残余相移来量化数值频散。令 $\\widehat{C}_1^n$ 表示在时间 $t^n$、波数为 $k_1 = 2\\pi/L$（$k=1$ 模态）时零均值场的离散傅里叶系数，通过以下离散傅里叶变换约定计算\n$$\n\\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right).\n$$\n一个周期后，精确连续解对于任何整数空间傅里叶模态都没有净相位变化。因此，$k=1$ 模态的任何非零相位变化都纯粹是数值性的。定义包裹相位差\n$$\n\\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right),\n$$\n其中 $\\mathrm{wrap}(\\theta)$ 将角度映射到 $(-\\pi,\\pi]$。通过以下公式将此相位差转换为以米为单位的等效空间相移\n$$\n\\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi,\n$$\n这是一周期后主导模态的残余空间位移。报告以米为单位的 $\\Delta x_{\\mathrm{phase}}$。\n\n您的程序必须为每个测试用例计算列表 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$，并将所有测试用例的结果汇总到标准输出的单行中，格式为一个用方括号括起来的逗号分隔列表，其中每个元素对应一个测试用例，并且本身是一个包含两个浮点数的列表。不应打印任何其他文本。\n\n所有物理量必须使用指定的单位处理：$L$ 以米（$\\mathrm{m}$）为单位，$u$ 以米/秒（$\\mathrm{m/s}$）为单位，$T$ 以秒（$\\mathrm{s}$）为单位，$\\Delta x_{\\mathrm{phase}}$ 以米（$\\mathrm{m}$）为单位。内部用于相位计算的角度必须是弧度。\n\n测试套件：\n实现以下四种情况。对于每种情况，运行恰好一个周期并报告 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n- 情况 A（一阶迎风，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 情况 B（Lax–Wendroff，中等 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.05\\,L$，$x_0 = 0.3\\,L$。\n- 情况 C（一阶迎风，极限 $\\mathrm{C}$ 值）：$L = 1.0\\,\\mathrm{m}$，$N = 200$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 1.0$，$\\sigma = 0.08\\,L$，$x_0 = 0.4\\,L$。\n- 情况 D（Lax–Wendroff，窄脉冲）：$L = 1.0\\,\\mathrm{m}$，$N = 256$，$u = 1.0\\,\\mathrm{m/s}$，$\\mathrm{C} = 0.5$，$\\sigma = 0.01\\,L$，$x_0 = 0.25\\,L$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个有四个元素的列表，每个元素都是一个按 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$ 顺序排列的包含两个浮点数的列表，分别对应情况 A、B、C 和 D。例如：\n$$\n[ [r_A, s_A], [r_B, s_B], [r_C, s_C], [r_D, s_D] ]\n$$\n其中每个 $r_\\cdot$ 和 $s_\\cdot$ 都是一个浮点数。输出中不应包含单位；所有距离都隐式地以米为单位，所有比率都是无量纲的。",
            "solution": "该问题要求量化用于求解一维线性平流方程 $c_t + u c_x = 0$ 的两种有限差分格式的数值扩散和数值频散。该方程描述了被动示踪剂浓度 $c(x,t)$ 在长度为 $L$ 的一维周期性域上以恒定速度 $u$ 的输运过程。精确解会平移初始示踪剂廓线 $c(x,0)$，而不会改变其形状、振幅或方差。然而，数值格式会引入误差，表现为数值扩散（振幅的阻尼）和数值频散（导致形状扭曲的相位误差）。任务是在一个完整的平流周期 $T = L/u$ 后，为高斯初始条件计算这些误差。\n\n解决方案的制定过程是：首先离散化控制方程，然后实现指定的数值格式，最后对模拟的初始和最终状态应用明确定义的度量标准。\n\n**1. 离散化与模拟设置**\n\n连续域 $[0, L)$ 被离散化为一个由 $N$ 个点组成的均匀网格，索引为 $i = 0, \\dots, N-1$。网格点位于 $x_i = i \\Delta x$，其中网格间距为 $\\Delta x = L/N$。时间被离散化为大小为 $\\Delta t$ 的步长。空间和时间离散化之间的关系由库朗-弗里德里希斯-列维（CFL）数控制，定义为 $\\mathrm{C} = u \\Delta t / \\Delta x$。为了所使用的显式格式的稳定性，该数值必须受到限制。\n\n模拟运行的总时长为 $T = L/u$，这对应于一个特征绕周期性域平流一周所需的时间。总时间步数 $n_T$ 的选择应满足 $n_T \\Delta t = T$。通过代入 $T$、$\\Delta t$ 和 $\\mathrm{C}$ 的定义，我们得到 $n_T = \\frac{L/u}{( \\mathrm{C} \\Delta x / u)} = \\frac{L}{\\mathrm{C} (L/N)} = N/\\mathrm{C}$。问题保证，对于所有测试用例，$N/\\mathrm{C}$ 都是一个整数，确保模拟恰好在一个周期结束。\n\n**2. 初始条件**\n\n初始示踪剂分布是一个高斯脉冲，由下式给出：\n$$\nc(x,0) = \\exp\\left(-\\frac{(d(x;x_0))^2}{2 \\sigma^2}\\right)\n$$\n这里，$x_0$ 是脉冲的中心，$\\sigma$ 是其标准差，$d(x; x_0)$ 是任意点 $x$ 与中心 $x_0$ 之间的最小周期距离。该距离函数正确处理了周期性域的环绕特性，并定义在区间 $[-\\frac{L}{2}, \\frac{L}{2}]$ 上。在网格 $\\{x_i\\}$ 上的离散实现中，每个 $x_i$ 到 $x_0$ 的距离计算为 $d(x_i; x_0) = (x_i - x_0) - L \\cdot \\mathrm{round}((x_i - x_0)/L)$。这确保了高斯脉冲在圆形域上正确且对称地居中。\n\n**3. 数值格式**\n\n离散示踪剂场 $c_i^n \\approx c(x_i, t^n)$ 的演化使用两种显式、保守的有限差分格式计算。通过对空间索引使用模运算来强制实现周期性，使得 $c_{i \\pm N}^n = c_i^n$。\n\n*   **一阶迎风格式：** 对于正速度 $u \\ge 0$，该格式由下式给出：\n    $$\n    c_i^{n+1} = c_i^n - \\mathrm{C}\\left(c_i^n - c_{i-1}^n\\right)\n    $$\n    该格式在空间和时间上都是一阶精确的。已知在 $0 \\le \\mathrm{C} \\le 1$ 时是数值稳定的。其主阶截断误差项与空间二阶导数成正比，起到扩散项的作用。因此，该格式具有很强的耗散性，导致陡峭的梯度被抹平，振幅随时间衰减。在 $\\mathrm{C}=1$ 的特殊情况下，格式变为 $c_i^{n+1} = c_{i-1}^n$，这是网格上的精确平移算子。在这种情况下，离散解被无误差地输运。\n\n*   **Lax–Wendroff 格式：** 这是一个在空间和时间上均为二阶精确的格式：\n    $$\n    c_i^{n+1} = c_i^n - \\frac{\\mathrm{C}}{2}\\left(c_{i+1}^n - c_{i-1}^n\\right) + \\frac{\\mathrm{C}^2}{2}\\left(c_{i+1}^n - 2 c_i^n + c_{i-1}^n\\right)\n    $$\n    Lax–Wendroff 格式在 $|\\mathrm{C}| \\le 1$ 时是稳定的。它的构造旨在消除二阶截断误差项，使其比迎风格式的耗散性显著降低。然而，其主导误差项与空间三阶导数成正比，这会引入频散误差。这些误差导致解的不同傅里叶分量以不正确的相速度传播，从而产生伪振荡，尤其是在陡峭特征附近。\n\n在实现时，这些更新规则在每个时间步向量化地应用于整个解数组 $c^n$。像 $c_{i\\pm 1}^n$ 这样的项所需的周期性平移可以通过数组滚动操作高效处理。\n\n**4. 数值误差的量化**\n\n计算两个度量标准来量化一个周期 $T$ 后数值扩散和频散的影响。\n\n*   **数值扩散度量 ($R_{\\mathrm{var}}$)：** 数值扩散会阻尼示踪剂波动的振幅。这种效应通过测量解的空间方差的衰减来量化。在时间层级 $n$ 的示踪剂场的离散均值和方差为：\n    $$\n    \\overline{c}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} c_i^n, \\quad \\mathrm{Var}^n = \\frac{1}{N} \\sum_{i=0}^{N-1} \\left(c_i^n - \\overline{c}^n\\right)^2\n    $$\n    扩散度量是时间 $t^{n_T} = T$ 时的最终方差与时间 $t=0$ 时的初始方差之比：\n    $$\n    R_{\\mathrm{var}} = \\frac{\\mathrm{Var}^{n_T}}{\\mathrm{Var}^{0}}\n    $$\n    对于一个完美的、非扩散的格式，$R_{\\mathrm{var}} = 1$。数值扩散的存在导致 $R_{\\mathrm{var}}  1$。\n\n*   **数值频散度量 ($\\Delta x_{\\mathrm{phase}}$)：** 数值频散导致不同波长以不正确的速度传播。这通过检查解的特定傅里叶模态的相位来分析。我们关注与域匹配的最长波长的模态，其波数为 $k_1 = 2\\pi/L$。此模态的复系数是通过对零均值示踪剂场 $c_j^n - \\overline{c}^n$ 进行离散傅里叶变换（DFT）得到的：\n    $$\n    \\widehat{C}_k^n = \\sum_{j=0}^{N-1} \\left(c_j^n - \\overline{c}^n\\right) \\exp\\left(-\\mathrm{i}\\, \\frac{2\\pi k j}{N}\\right)\n    $$\n    对于一个周期 $T=L/u$ 后的精确解，场会恢复到其原始状态，因此任何傅里叶系数的相位都应该不变。任何数值相位误差都由 $k=1$ 模态 $\\widehat{C}_1^n$ 的最终相位与初始相位之差捕获。包裹相位差计算如下：\n    $$\n    \\Delta \\phi = \\mathrm{wrap}\\left(\\arg\\left(\\widehat{C}_1^{n_T}\\right) - \\arg\\left(\\widehat{C}_1^{0}\\right)\\right)\n    $$\n    其中 $\\mathrm{wrap}(\\theta)$ 函数将角度 $\\theta$ 映射到区间 $(-\\pi, \\pi]$。相位误差 $\\Delta \\phi$ 等效于一个错误的空间位移。$\\delta x$ 的空间位移会产生 $-k_1 \\delta x = - (2\\pi/L) \\delta x$ 的相位变化。因此，等效的空间相移为：\n    $$\n    \\Delta x_{\\mathrm{phase}} = -\\,\\frac{L}{2\\pi}\\,\\Delta \\phi\n    $$\n    该值表示示踪剂的主导大尺度特征在一周期后的残余位移。一个非零的 $\\Delta x_{\\mathrm{phase}}$ 是该格式累积频散误差的直接度量。\n\n**5. 算法实现**\n\n对于每个测试用例，算法按以下步骤进行：\n1.  初始化参数（$L$、$N$、$u$、$\\mathrm{C}$ 等）。\n2.  构建空间网格 $x_i$ 和初始高斯廓线 $c^0$。\n3.  计算初始方差 $\\mathrm{Var}^0$ 和初始相位 $\\arg(\\widehat{C}_1^0)$。\n4.  循环 $n_T = N/\\mathrm{C}$ 个时间步，在每一步应用所选的数值格式（迎风或 Lax-Wendroff）来更新解向量。\n5.  循环结束后，计算最终方差 $\\mathrm{Var}^{n_T}$ 和最终相位 $\\arg(\\widehat{C}_1^{n_T})$。\n6.  使用上述公式计算度量 $R_{\\mathrm{var}}$ 和 $\\Delta x_{\\mathrm{phase}}$。\n7.  存储结果对 $[R_{\\mathrm{var}}, \\Delta x_{\\mathrm{phase}}]$。\n\n对所有四个测试用例重复此过程，并将结果汇总到一个最终列表中以供输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the 1D advection problem.\n    \"\"\"\n\n    def solve_case(scheme, L, N, u, C, sigma_rel, x0_rel):\n        \"\"\"\n        Solves a single case of the 1D advection problem.\n\n        Args:\n            scheme (str): 'upwind' or 'lax-wendroff'.\n            L (float): Domain length in meters.\n            N (int): Number of grid points.\n            u (float): Advection velocity in m/s.\n            C (float): Courant number.\n            sigma_rel (float): Standard deviation as a fraction of L.\n            x0_rel (float): Initial pulse center as a fraction of L.\n\n        Returns:\n            list: A list containing [R_var, delta_x_phase].\n        \"\"\"\n        # 1. Setup simulation parameters\n        dx = L / N\n        T = L / u\n        n_T = int(round(N / C))\n        # dt = T / n_T # Equivalent to C * dx / u\n\n        sigma = sigma_rel * L\n        x0 = x0_rel * L\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # 2. Set Initial Condition (Periodic Gaussian)\n        dist_x = x - x0\n        # Minimal periodic distance on the torus [0, L)\n        d = dist_x - L * np.round(dist_x / L)\n        c0 = np.exp(-(d**2) / (2 * sigma**2))\n\n        # 3. Analyze Initial State\n        var0 = np.var(c0)\n        c0_zm = c0 - np.mean(c0)\n        C_hat_0 = np.fft.fft(c0_zm)\n        # Phase of the k=1 mode\n        phi0 = np.angle(C_hat_0[1])\n\n        # 4. Time Evolution Loop\n        c_current = c0.copy()\n        if scheme == 'upwind':\n            for _ in range(n_T):\n                c_current = (1 - C) * c_current + C * np.roll(c_current, 1)\n        elif scheme == 'lax-wendroff':\n            for _ in range(n_T):\n                c_ip1 = np.roll(c_current, -1)\n                c_im1 = np.roll(c_current, 1)\n                term1 = -0.5 * C * (c_ip1 - c_im1)\n                term2 = 0.5 * C**2 * (c_ip1 - 2 * c_current + c_im1)\n                c_current = c_current + term1 + term2\n        else:\n            raise ValueError(f\"Unknown scheme: {scheme}\")\n\n        c_final = c_current\n\n        # 5. Analyze Final State\n        var_final = np.var(c_final)\n        c_final_zm = c_final - np.mean(c_final)\n        C_hat_nT = np.fft.fft(c_final_zm)\n        # Phase of the k=1 mode\n        phi_nT = np.angle(C_hat_nT[1])\n\n        # 6. Calculate Metrics\n        # Numerical Diffusion: Variance Ratio\n        R_var = var_final / var0 if var0 > 0 else 1.0\n\n        # Numerical Dispersion: Phase Shift\n        \n        # Wrap angle to (-pi, pi]\n        def wrap_angle(angle):\n            return (angle + np.pi) % (2 * np.pi) - np.pi\n\n        delta_phi_raw = phi_nT - phi0\n        delta_phi = wrap_angle(delta_phi_raw)\n\n        delta_x_phase = -L * delta_phi / (2 * np.pi)\n\n        return [R_var, delta_x_phase]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: first-order upwind, moderate C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case B: Lax-Wendroff, moderate C\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.05, 'x0_rel': 0.3},\n        # Case C: first-order upwind, limiting C\n        {'scheme': 'upwind', 'L': 1.0, 'N': 200, 'u': 1.0, 'C': 1.0, 'sigma_rel': 0.08, 'x0_rel': 0.4},\n        # Case D: Lax-Wendroff, narrow pulse\n        {'scheme': 'lax-wendroff', 'L': 1.0, 'N': 256, 'u': 1.0, 'C': 0.5, 'sigma_rel': 0.01, 'x0_rel': 0.25},\n    ]\n\n    results = []\n    for case_params in test_cases:\n        result = solve_case(**case_params)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n```"
        },
        {
            "introduction": "前面的练习主要关注显式格式，它们在地球系统模型中很常见。本次实践将挑战我们，将分析技能应用于另一类重要的数值格式：隐式格式。通过从第一性原理出发，推导并分析一个隐式格式的放大因子，我们将巩固对冯·诺伊曼分析方法的掌握，并深刻理解不同的离散化选择（如此处使用的后向欧拉法）如何从根本上改变数值格式的稳定性和误差特性。",
            "id": "3899289",
            "problem": "考虑由偏微分方程 $u_{t} + c\\,u_{x} = 0$ 控制的周期性域上的被动示踪剂的线性平流，其中 $c$ 是一个恒定的平流速度。在间距为 $\\Delta x$、索引为 $j \\in \\mathbb{Z}$ 的均匀网格上离散化空间，并以步长 $\\Delta t$、索引为 $n \\in \\mathbb{Z}$ 离散化时间。使用 backward Euler 法进行时间推进，并用二阶中心差分近似空间导数，两者均在时间层 $n+1$ 上计算。具体来说，通过将 backward Euler 时间导数 $({u^{n+1}_{j} - u^{n}_{j}})/{\\Delta t}$ 与中心空间导数 $(u^{n+1}_{j+1} - u^{n+1}_{j-1})/(2\\,\\Delta x)$ 相结合，构建一个全离散格式。\n\n使用波数为 $k$、网格点为 $x_{j} = j\\,\\Delta x$ 的离散傅里叶模态假设 $u^{n}_{j} = \\hat{u}^{n} \\exp(i\\,k\\,x_{j})$，从第一性原理推导由 $\\hat{u}^{n+1} = G(k)\\,\\hat{u}^{n}$ 定义的单步放大因子 $G(k)$。然后，从复数的绝对值和辐角的定义出发，通过用 $k$、$c$、$\\Delta x$ 和 $\\Delta t$ 表示其模 $|G(k)|$ 和辐角 $\\arg(G(k))$，并给出在 $\\theta \\to 0$（其中 $\\theta \\equiv k\\,\\Delta x$）极限下的小波数展开，直至并包括领先的非平凡项，来量化该格式的数值扩散和相位滞后。将这些结果与精确的连续时间传播因子 $\\exp(-i\\,c\\,k\\,\\Delta t)$ 进行比较，以确定耗散误差和色散误差首次出现的阶数。\n\n将你的最终答案报告为放大因子 $G(k)$ 关于 $k$、$c$、$\\Delta x$ 和 $\\Delta t$ 的闭式解析表达式。不需要进行数值计算，也无需四舍五入。最终的方框答案必须只包含 $G(k)$ 的单个表达式。",
            "solution": "该问题陈述是有效的，因为它具有科学依据、适定且客观。它提出了一个偏微分方程数值分析中的标准问题。\n\n线性平流的控制偏微分方程为：\n$$\nu_{t} + c\\,u_{x} = 0\n$$\n其中 $u(x, t)$ 是被动示踪剂的浓度，$c$ 是一个恒定的平流速度，$t$ 是时间，$x$ 是空间坐标。\n\n该问题指定了一个全离散格式，它使用 backward Euler 法处理时间导数，使用二阶中心差分处理空间导数，两者都在未来的时间层 $n+1$ 上进行计算。在空间间距为 $\\Delta x$（由 $j$ 索引）、时间步长为 $\\Delta t$（由 $n$ 索引）的均匀网格上的离散方程为：\n$$\n\\frac{u^{n+1}_{j} - u^{n}_{j}}{\\Delta t} + c \\frac{u^{n+1}_{j+1} - u^{n+1}_{j-1}}{2\\,\\Delta x} = 0\n$$\n\n为了进行 von Neumann 稳定性分析，我们将离散傅里叶模态假设 $u^{n}_{j} = \\hat{u}^{n} \\exp(i\\,k\\,x_{j})$（其中 $x_{j} = j\\,\\Delta x$）代入离散方程。方程中的各项变为：\n$u^{n}_{j} = \\hat{u}^{n} \\exp(i\\,k\\,j\\,\\Delta x)$\n$u^{n+1}_{j} = \\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x)$\n$u^{n+1}_{j+1} = \\hat{u}^{n+1} \\exp(i\\,k\\,(j+1)\\,\\Delta x) = \\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x)\\exp(i\\,k\\,\\Delta x)$\n$u^{n+1}_{j-1} = \\hat{u}^{n+1} \\exp(i\\,k\\,(j-1)\\,\\Delta x) = \\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x)\\exp(-i\\,k\\,\\Delta x)$\n\n将这些代入离散方程得到：\n$$\n\\frac{\\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x) - \\hat{u}^{n} \\exp(i\\,k\\,j\\,\\Delta x)}{\\Delta t} + c \\frac{\\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x)\\exp(i\\,k\\,\\Delta x) - \\hat{u}^{n+1} \\exp(i\\,k\\,j\\,\\Delta x)\\exp(-i\\,k\\,\\Delta x)}{2\\,\\Delta x} = 0\n$$\n我们可以消去公因子 $\\exp(i\\,k\\,j\\,\\Delta x)$（它不为零）：\n$$\n\\frac{\\hat{u}^{n+1} - \\hat{u}^{n}}{\\Delta t} + c \\frac{\\hat{u}^{n+1} (\\exp(i\\,k\\,\\Delta x) - \\exp(-i\\,k\\,\\Delta x))}{2\\,\\Delta x} = 0\n$$\n使用 Euler 恒等式 $\\exp(i\\phi) - \\exp(-i\\phi) = 2i\\sin(\\phi)$，方程简化为：\n$$\n\\frac{\\hat{u}^{n+1} - \\hat{u}^{n}}{\\Delta t} + c \\frac{\\hat{u}^{n+1} (2i\\sin(k\\,\\Delta x))}{2\\,\\Delta x} = 0\n$$\n$$\n\\frac{\\hat{u}^{n+1} - \\hat{u}^{n}}{\\Delta t} + i \\frac{c}{\\Delta x} \\sin(k\\,\\Delta x) \\hat{u}^{n+1} = 0\n$$\n为了求出放大因子 $G(k) = \\hat{u}^{n+1} / \\hat{u}^{n}$，我们重排方程以求解 $\\hat{u}^{n+1}$：\n$$\n\\hat{u}^{n+1} \\left( \\frac{1}{\\Delta t} + i \\frac{c}{\\Delta x} \\sin(k\\,\\Delta x) \\right) = \\frac{\\hat{u}^{n}}{\\Delta t}\n$$\n两边乘以 $\\Delta t$ 得到：\n$$\n\\hat{u}^{n+1} \\left( 1 + i \\frac{c \\Delta t}{\\Delta x} \\sin(k\\,\\Delta x) \\right) = \\hat{u}^{n}\n$$\n因此，单步放大因子为：\n$$\nG(k) = \\frac{\\hat{u}^{n+1}}{\\hat{u}^{n}} = \\frac{1}{1 + i \\frac{c \\Delta t}{\\Delta x} \\sin(k\\,\\Delta x)}\n$$\n\n接下来，我们量化数值扩散和相位滞后。为了进行此分析，方便地定义 Courant 数 $\\sigma = \\frac{c \\Delta t}{\\Delta x}$ 和无量纲波数 $\\theta = k\\,\\Delta x$。放大因子变为：\n$$\nG(\\theta) = \\frac{1}{1 + i \\sigma \\sin(\\theta)}\n$$\n对于单个傅里叶模态，$u_t + c u_x = 0$ 的精确解是 $u(x,t) = \\exp(i k (x - ct))$。在时间 $\\Delta t$ 内的精确单步传播因子是 $G_{exact} = \\exp(-i c k \\Delta t) = \\exp(-i \\sigma \\theta)$。\n\n数值扩散由放大因子的模 $|G(\\theta)|$ 来表征。对于精确解， $|G_{exact}| = |\\exp(-i \\sigma \\theta)| = 1$，表明没有振幅衰减。对于数值格式：\n$$\n|G(\\theta)| = \\left| \\frac{1}{1 + i \\sigma \\sin(\\theta)} \\right| = \\frac{1}{|1 + i \\sigma \\sin(\\theta)|} = \\frac{1}{\\sqrt{1^2 + (\\sigma \\sin(\\theta))^2}} = \\frac{1}{\\sqrt{1 + \\sigma^2 \\sin^2(\\theta)}}\n$$\n由于 $\\sigma^2 \\sin^2(\\theta) \\ge 0$，对于所有 $\\theta$，我们有 $|G(\\theta)| \\le 1$。该格式是无条件稳定的。当 $|G(\\theta)|  1$ 时，即对于任何 $\\sin(\\theta) \\ne 0$ 的 $\\theta$，会发生耗散（振幅衰减）。\n\n为了找到耗散误差的阶数，我们对 $\\theta \\to 0$ 进行小波数展开。我们使用 Taylor 级数 $\\sin(\\theta) = \\theta - \\frac{\\theta^3}{6} + O(\\theta^5)$ 和 $(1+x)^{-1/2} = 1 - \\frac{1}{2}x + O(x^2)$。\n$$\n\\sin^2(\\theta) = \\left(\\theta - \\frac{\\theta^3}{6} + \\dots\\right)^2 = \\theta^2 - \\frac{\\theta^4}{3} + O(\\theta^6)\n$$\n$$\n|G(\\theta)| = \\left(1 + \\sigma^2 \\left(\\theta^2 - \\frac{\\theta^4}{3} + \\dots\\right)\\right)^{-1/2} = 1 - \\frac{1}{2}\\sigma^2\\left(\\theta^2 - \\frac{\\theta^4}{3} + \\dots\\right) + O(\\theta^4) = 1 - \\frac{1}{2}\\sigma^2\\theta^2 + O(\\theta^4)\n$$\n模的误差为 $|G(\\theta)| - |G_{exact}| = (1 - \\frac{1}{2}\\sigma^2\\theta^2 + \\dots) - 1 = -\\frac{1}{2}\\sigma^2\\theta^2 + O(\\theta^4)$。领先的误差项是关于 $\\theta$ 的二阶项，因此耗散误差首次出现在 $O(\\theta^2)$ 阶。\n\n数值色散由放大因子的辐角 $\\phi_{num} = \\arg(G(\\theta))$ 来表征。在 $\\Delta t$ 时间内的精确相移是 $\\phi_{exact} = \\arg(G_{exact}) = -\\sigma\\theta$。对于数值格式，我们首先将 $G(\\theta)$ 写成笛卡尔形式：\n$$\nG(\\theta) = \\frac{1}{1 + i \\sigma \\sin(\\theta)} \\cdot \\frac{1 - i \\sigma \\sin(\\theta)}{1 - i \\sigma \\sin(\\theta)} = \\frac{1 - i \\sigma \\sin(\\theta)}{1 + \\sigma^2 \\sin^2(\\theta)}\n$$\n辐角为：\n$$\n\\phi_{num} = \\arg(G(\\theta)) = \\arctan\\left( \\frac{-\\sigma \\sin(\\theta)}{1} \\right) = -\\arctan(\\sigma\\sin(\\theta))\n$$\n为了找到色散误差的阶数，我们使用 $\\sin(\\theta)$ 和 $\\arctan(x) = x - \\frac{x^3}{3} + O(x^5)$ 的级数对 $\\theta \\to 0$ 进行展开：\n$$\n\\sigma\\sin(\\theta) = \\sigma\\left(\\theta - \\frac{\\theta^3}{6} + O(\\theta^5)\\right)\n$$\n$$\n\\phi_{num} = -\\arctan\\left(\\sigma\\theta - \\frac{\\sigma\\theta^3}{6} + O(\\theta^5)\\right)\n$$\n$$\n\\phi_{num} = -\\left[ \\left(\\sigma\\theta - \\frac{\\sigma\\theta^3}{6}\\right) - \\frac{1}{3}(\\sigma\\theta)^3 + O(\\theta^5) \\right] = -\\sigma\\theta + \\frac{\\sigma\\theta^3}{6} + \\frac{\\sigma^3\\theta^3}{3} + O(\\theta^5)\n$$\n$$\n\\phi_{num} = -\\sigma\\theta + \\left(\\frac{\\sigma}{6} + \\frac{\\sigma^3}{3}\\right)\\theta^3 + O(\\theta^5)\n$$\n相位误差为 $\\phi_{num} - \\phi_{exact} = \\left(-\\sigma\\theta + \\left(\\frac{\\sigma}{6} + \\frac{\\sigma^3}{3}\\right)\\theta^3 + \\dots\\right) - (-\\sigma\\theta) = \\left(\\frac{\\sigma}{6} + \\frac{\\sigma^3}{3}\\right)\\theta^3 + O(\\theta^5)$。领先的误差项是关于 $\\theta$ 的三阶项，因此色散误差首次出现在 $O(\\theta^3)$ 阶。\n\n总之，放大因子是从第一性原理推导出来的。使用小波数展开分析了其模和相位。分析表明，对于小波数，该数值格式引入了与 $\\theta^2$ 成比例的耗散误差和与 $\\theta^3$ 成比例的色散误差。",
            "answer": "$$\n\\boxed{\\frac{1}{1 + i \\frac{c \\Delta t}{\\Delta x} \\sin(k \\Delta x)}}\n$$"
        }
    ]
}