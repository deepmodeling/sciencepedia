{
    "hands_on_practices": [
        {
            "introduction": "The foundation of all climate and weather modeling is the energy input from the Sun. This first practice grounds our study in fundamental physics by exploring how to quantify the solar radiation arriving at the top of the atmosphere (TOA). By deriving the inverse-square law from the principle of energy conservation, you will understand why solar irradiance changes with orbital distance and calculate this effect for Earth's closest approach to the Sun, a key variable in climate science .",
            "id": "3911974",
            "problem": "Consider the top-of-atmosphere (TOA) shortwave irradiance incident on a plane normal to the Sun’s beam. Assume the Sun’s total power output, known as the solar luminosity $L_{\\odot}$, is constant over the timescale of Earth’s orbital motion, and that the radiation field is locally collimated at Earth such that the measured TOA irradiance equals the radiant flux density crossing a spherical surface centered on the Sun. The solar constant $S_0$ is defined as the TOA irradiance measured at the reference Earth–Sun distance $r_0$ equal to one Astronomical Unit (AU). Using conservation of energy and geometric spreading of radiation, derive from first principles the distance-scaling factor that relates the instantaneous TOA irradiance at distance $r$ to the reference value $S_0$. Then, using your derived relationship, compute the corrected solar constant at perihelion for $S_0=1361\\ \\mathrm{W\\,m^{-2}}$ and instantaneous Earth–Sun distance $r=0.9833\\ \\mathrm{AU}$, taking $r_0=1\\ \\mathrm{AU}$. Round your final numerical answer to four significant figures and express it in watts per square meter ($\\mathrm{W\\,m^{-2}}$).",
            "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- Sun's total power output (solar luminosity): $L_{\\odot}$ is constant.\n- Radiation field is locally collimated at Earth.\n- Measured TOA irradiance equals the radiant flux density crossing a spherical surface centered on the Sun.\n- Solar constant $S_0$ is the TOA irradiance at reference Earth–Sun distance $r_0$.\n- Reference distance $r_0 = 1$ Astronomical Unit (AU).\n- Task 1: Derive the distance-scaling factor relating instantaneous TOA irradiance at distance $r$ to $S_0$.\n- Task 2: Compute the corrected solar constant at perihelion.\n- Given value for solar constant: $S_0 = 1361\\ \\mathrm{W\\,m^{-2}}$.\n- Given instantaneous Earth–Sun distance at perihelion: $r = 0.9833\\ \\mathrm{AU}$.\n- Required numerical answer precision: Round to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The problem is based on the fundamental principle of conservation of energy as applied to electromagnetic radiation, specifically the inverse-square law. The definitions of solar luminosity, irradiance, and the solar constant are standard in physics and atmospheric science. The provided numerical values for $S_0$ and the perihelion distance are consistent with accepted scientific data.\n- **Well-Posed**: The problem is well-posed. It asks for a derivation from first principles and a subsequent calculation, providing all necessary data to arrive at a unique, stable, and meaningful solution.\n- **Objective**: The problem is stated in precise, objective language, free of ambiguity or subjective claims.\n- **Completeness and Consistency**: The problem is self-contained. The provided data are sufficient and consistent for the required derivation and calculation.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid** as it is scientifically sound, well-posed, objective, and complete. A solution will be provided.\n\n### Derivation and Solution\n\nThe core principle for this problem is the conservation of energy. The Sun radiates energy at a total rate equal to its luminosity, $L_{\\odot}$. Assuming this radiation spreads out isotropically (uniformly in all directions), the power $L_{\\odot}$ must pass through any concentric spherical surface surrounding the Sun.\n\nThe radiant flux density, or irradiance $S$, at a distance $r$ from the center of the Sun is defined as the power per unit area. For a spherical surface of radius $r$, the surface area is $A = 4\\pi r^2$. Therefore, the irradiance at this distance is the total luminosity divided by the surface area of the sphere:\n$$\nS(r) = \\frac{L_{\\odot}}{A} = \\frac{L_{\\odot}}{4\\pi r^2}\n$$\nThis relationship is known as the inverse-square law for radiation.\n\nThe solar constant, $S_0$, is defined as the specific value of this irradiance measured at a reference distance $r_0$, which is the mean Earth–Sun distance, defined as $1$ Astronomical Unit (AU). Thus, we can write:\n$$\nS_0 = S(r_0) = \\frac{L_{\\odot}}{4\\pi r_0^2}\n$$\nThe problem states that $L_{\\odot}$ is constant. We can therefore use the equation for $S_0$ to express $L_{\\odot}$ in terms of $S_0$ and $r_0$:\n$$\nL_{\\odot} = S_0 \\cdot 4\\pi r_0^2\n$$\nNow, we can substitute this expression for $L_{\\odot}$ back into the general equation for irradiance $S(r)$ at any arbitrary distance $r$:\n$$\nS(r) = \\frac{S_0 \\cdot 4\\pi r_0^2}{4\\pi r^2}\n$$\nThe term $4\\pi$ cancels from the numerator and denominator, yielding the relationship between the irradiance at distance $r$ and the solar constant $S_0$:\n$$\nS(r) = S_0 \\frac{r_0^2}{r^2} = S_0 \\left(\\frac{r_0}{r}\\right)^2\n$$\nThe distance-scaling factor that relates the instantaneous TOA irradiance at distance $r$ to the reference value $S_0$ is therefore $\\left(\\frac{r_0}{r}\\right)^2$. This completes the derivation.\n\nNext, we use this derived relationship to compute the corrected solar constant (instantaneous TOA irradiance) at perihelion. The problem provides the following values:\n- Reference solar constant, $S_0 = 1361\\ \\mathrm{W\\,m^{-2}}$\n- Reference distance, $r_0 = 1\\ \\mathrm{AU}$\n- Instantaneous distance at perihelion, $r = 0.9833\\ \\mathrm{AU}$\n\nLet $S_{p}$ be the irradiance at perihelion. Substituting these values into our derived equation:\n$$\nS_{p} = S_0 \\left(\\frac{r_0}{r}\\right)^2 = 1361 \\cdot \\left(\\frac{1\\ \\mathrm{AU}}{0.9833\\ \\mathrm{AU}}\\right)^2\n$$\nThe units of distance (AU) cancel out, leaving a dimensionless scaling factor:\n$$\nS_{p} = 1361 \\cdot \\left(\\frac{1}{0.9833}\\right)^2\n$$\nNow, we perform the calculation:\n$$\nS_{p} \\approx 1361 \\cdot (1.0169836)^2 \\approx 1361 \\cdot 1.0342556\n$$\n$$\nS_{p} \\approx 1407.6219\\ \\mathrm{W\\,m^{-2}}\n$$\nThe problem requires the final answer to be rounded to four significant figures. The first four significant figures are $1$, $4$, $0$, and $7$. The fifth significant figure is $6$, which is greater than or equal to $5$, so we round up the fourth digit.\n$$\nS_{p} \\approx 1408\\ \\mathrm{W\\,m^{-2}}\n$$",
            "answer": "$$\\boxed{1408}$$"
        },
        {
            "introduction": "Once sunlight enters the atmosphere, its journey is shaped by absorption and scattering. This exercise focuses on absorption by atmospheric gases like ozone, which have highly complex absorption spectra. You will use the correlated-$k$ distribution method, a powerful and computationally efficient technique essential to modern climate models, to calculate the band-averaged transmittance through an ozone layer . This practice offers a concrete look at how we parameterize the intricate physics of gas absorption for large-scale simulations.",
            "id": "3911918",
            "problem": "Consider a plane-parallel atmosphere composed of an ozone layer that absorbs shortwave radiation within a single narrow spectral band. Assume absorption-only conditions (no scattering and no reflection) for the direct solar beam. The solar beam makes an angle with the vertical whose cosine is $\\mu_{0}$, and the vertically integrated ozone mass path is $u$. The absorption coefficient exhibits strong spectral variability across the band and is represented using a correlated-$k$ distribution with $8$ quadrature points.\n\nYou are provided the following data:\n- Ozone mass path: $u = 6.43 \\times 10^{-3} \\,\\mathrm{kg}\\,\\mathrm{m}^{-2}$.\n- Cosine of solar zenith angle: $\\mu_{0} = 0.5$.\n- Quadrature weights $\\{w_{i}\\}_{i=1}^{8}$ and corresponding absorption coefficients $\\{k_{i}\\}_{i=1}^{8}$ for the band:\n  - $w_{1} = 0.05$, $k_{1} = 0.2 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{2} = 0.10$, $k_{2} = 0.5 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{3} = 0.15$, $k_{3} = 1.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{4} = 0.20$, $k_{4} = 2.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{5} = 0.20$, $k_{5} = 5.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{6} = 0.15$, $k_{6} = 10.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{7} = 0.10$, $k_{7} = 20.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n  - $w_{8} = 0.05$, $k_{8} = 50.0 \\,\\mathrm{m}^{2}\\,\\mathrm{kg}^{-1}$.\n\nCompute the band-averaged direct-beam shortwave transmittance through the ozone layer using these $8$ correlated-$k$ points. Express your final answer as a dimensionless number, and round your answer to four significant figures.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and based on objective, consistent data. It represents a standard application of the correlated-$k$ distribution method in atmospheric radiative transfer, a fundamental topic in environmental and earth system modeling. All necessary parameters are provided, and their values are physically realistic. The quadrature weights $\\{w_i\\}$ correctly sum to $1$, ensuring the integrity of the numerical scheme.\n\nThe quantity to be computed is the band-averaged transmittance $\\bar{T}$ of the direct solar beam through an ozone layer. The atmosphere is considered plane-parallel, and only absorption is taken into account.\n\nAccording to the Beer-Lambert-Bouguer law, the monochromatic transmittance $T_{\\nu}$ at a specific frequency $\\nu$ for a path through an absorbing medium is given by:\n$$ T_{\\nu} = \\exp(-\\tau_{\\nu}) $$\nwhere $\\tau_{\\nu}$ is the monochromatic optical depth. For an absorbing gas in a plane-parallel atmosphere, the optical depth for a slant path is related to the vertical column amount of the absorber. The solar beam traverses the atmosphere at a zenith angle $\\theta_0$, so its path length is increased by a factor of $1/\\mu_0$ compared to the vertical path, where $\\mu_0 = \\cos(\\theta_0)$ is the cosine of the solar zenith angle. This factor is known as the air mass factor for a plane-parallel atmosphere.\n\nThe monochromatic optical depth $\\tau_{\\nu}$ is therefore given by:\n$$ \\tau_{\\nu} = \\frac{k_{\\nu} u}{\\mu_0} $$\nHere, $k_{\\nu}$ is the mass absorption coefficient of ozone at frequency $\\nu$ (in $\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$), $u$ is the vertically integrated mass path of ozone (in $\\mathrm{kg}\\,\\mathrm{m}^{-2}$), and $\\mu_0$ is the cosine of the solar zenith angle (dimensionless). The quantity $u/\\mu_0$ represents the slant mass path.\n\nThe monochromatic transmittance is thus:\n$$ T_{\\nu} = \\exp\\left(-\\frac{k_{\\nu} u}{\\mu_0}\\right) $$\nThe absorption coefficient $k_{\\nu}$ varies rapidly and non-monotonically with frequency within an absorption band. To calculate the band-averaged transmittance $\\bar T$, one would ideally integrate $T_{\\nu}$ over the entire spectral band. The correlated-$k$ distribution method is a powerful and efficient way to approximate this integral. It works by re-ordering the spectral integration over the cumulative distribution of the absorption coefficient, $g(k)$. The band-averaged transmittance is expressed as:\n$$ \\bar{T} = \\int_0^1 \\exp\\left(-\\frac{k(g) u}{\\mu_0}\\right) dg $$\nThis integral is numerically evaluated using a quadrature scheme, where the integration range $[0, 1]$ is divided into $N$ intervals of size $w_i$ (the weights), and for each interval, a representative absorption coefficient $k_i$ is used. The formula for the band-averaged transmittance becomes a weighted sum:\n$$ \\bar{T} \\approx \\sum_{i=1}^{N} w_i \\exp\\left(-\\frac{k_i u}{\\mu_0}\\right) $$\nThe problem provides all the necessary components for this calculation with $N=8$ quadrature points.\n\nThe given values are:\n- Ozone mass path: $u = 6.43 \\times 10^{-3} \\,\\mathrm{kg}\\,\\mathrm{m}^{-2}$.\n- Cosine of solar zenith angle: $\\mu_{0} = 0.5$.\n- Quadrature weights $\\{w_{i}\\}_{i=1}^{8}$ and absorption coefficients $\\{k_{i}\\}_{i=1}^{8}$.\n\nFirst, we calculate the slant mass path, which we denote $m_{slant}$:\n$$ m_{slant} = \\frac{u}{\\mu_0} = \\frac{6.43 \\times 10^{-3} \\,\\mathrm{kg}\\,\\mathrm{m}^{-2}}{0.5} = 1.286 \\times 10^{-2} \\,\\mathrm{kg}\\,\\mathrm{m}^{-2} $$\nNow, we compute the transmittance term $T_i = \\exp(-k_i m_{slant})$ for each of the $8$ quadrature points and multiply by its corresponding weight $w_i$.\n\nFor $i=1$: $k_1 = 0.2 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_1 = 0.05$.\n$w_1 T_1 = 0.05 \\times \\exp(-0.2 \\times 1.286 \\times 10^{-2}) = 0.05 \\times \\exp(-0.002572) \\approx 0.05 \\times 0.99743 = 0.0498715$\n\nFor $i=2$: $k_2 = 0.5 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_2 = 0.10$.\n$w_2 T_2 = 0.10 \\times \\exp(-0.5 \\times 1.286 \\times 10^{-2}) = 0.10 \\times \\exp(-0.00643) \\approx 0.10 \\times 0.99359 = 0.0993591$\n\nFor $i=3$: $k_3 = 1.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_3 = 0.15$.\n$w_3 T_3 = 0.15 \\times \\exp(-1.0 \\times 1.286 \\times 10^{-2}) = 0.15 \\times \\exp(-0.01286) \\approx 0.15 \\times 0.98722 = 0.1480836$\n\nFor $i=4$: $k_4 = 2.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_4 = 0.20$.\n$w_4 T_4 = 0.20 \\times \\exp(-2.0 \\times 1.286 \\times 10^{-2}) = 0.20 \\times \\exp(-0.02572) \\approx 0.20 \\times 0.97461 = 0.1949218$\n\nFor $i=5$: $k_5 = 5.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_5 = 0.20$.\n$w_5 T_5 = 0.20 \\times \\exp(-5.0 \\times 1.286 \\times 10^{-2}) = 0.20 \\times \\exp(-0.0643) \\approx 0.20 \\times 0.93772 = 0.1875444$\n\nFor $i=6$: $k_6 = 10.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_6 = 0.15$.\n$w_6 T_6 = 0.15 \\times \\exp(-10.0 \\times 1.286 \\times 10^{-2}) = 0.15 \\times \\exp(-0.1286) \\approx 0.15 \\times 0.87934 = 0.1319009$\n\nFor $i=7$: $k_7 = 20.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_7 = 0.10$.\n$w_7 T_7 = 0.10 \\times \\exp(-20.0 \\times 1.286 \\times 10^{-2}) = 0.10 \\times \\exp(-0.2572) \\approx 0.10 \\times 0.77322 = 0.0773220$\n\nFor $i=8$: $k_8 = 50.0 \\,\\mathrm{m}^2\\,\\mathrm{kg}^{-1}$, $w_8 = 0.05$.\n$w_8 T_8 = 0.05 \\times \\exp(-50.0 \\times 1.286 \\times 10^{-2}) = 0.05 \\times \\exp(-0.643) \\approx 0.05 \\times 0.52570 = 0.0262848$\n\nThe total band-averaged transmittance $\\bar{T}$ is the sum of these contributions:\n$$ \\bar{T} = \\sum_{i=1}^{8} w_i T_i $$\n$$ \\bar{T} \\approx 0.0498715 + 0.0993591 + 0.1480836 + 0.1949218 + 0.1875444 + 0.1319009 + 0.0773220 + 0.0262848 $$\n$$ \\bar{T} \\approx 0.9152881 $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ \\bar{T} \\approx 0.9153 $$\nThis value represents the fraction of incident solar radiation in the specified spectral band that is transmitted directly through the ozone layer without being absorbed.",
            "answer": "$$\n\\boxed{0.9153}\n$$"
        },
        {
            "introduction": "A complete picture of shortwave radiative transfer requires synthesizing multiple processes: absorption, scattering, and reflection from the surface. This final practice brings these elements together by guiding you through the construction of a complete, albeit simplified, radiative transfer model from first principles. By deriving and implementing a two-stream model that includes a Lambertian surface boundary condition , you will translate theory into a functional tool for calculating planetary albedo, one of the most critical parameters in the Earth's energy budget.",
            "id": "3911947",
            "problem": "You will implement a two-stream radiative transfer solver that accounts for coupling to a Lambertian surface and computes the broadband albedo for specified optical depth and single-scattering albedo. The solution must start from the Radiative Transfer Equation (RTE) for shortwave radiation in a plane-parallel atmosphere with isotropic scattering and proceed to a discrete-ordinate two-stream formulation. The atmosphere is homogeneous in the vertical, and the surface is Lambertian with a constant reflectance. The incident illumination at the top is diffuse and normalized to unit downward flux for each spectral band. The target quantity is the broadband albedo expressed as a dimensionless decimal fraction.\n\nFundamental laws and core definitions to use:\n- The Radiative Transfer Equation (RTE) for specific intensity $I(\\tau,\\mu)$ in a plane-parallel medium with isotropic scattering: $$\\mu \\frac{d I(\\tau,\\mu)}{d \\tau} = -I(\\tau,\\mu) + \\frac{\\omega_0}{2} \\int_{-1}^{1} I(\\tau,\\mu') \\, d\\mu',$$ where $\\tau$ is optical depth measured downward, $\\mu$ is the cosine of the zenith angle, and $\\omega_0$ is the single-scattering albedo.\n- A Lambertian surface with reflectance $\\alpha_s$ reflects flux according to $$F^{-}(\\tau_{\\star}) = \\alpha_s F^{+}(\\tau_{\\star}),$$ where $F^{+}$ and $F^{-}$ are downward and upward hemispheric fluxes at the bottom of the atmosphere $\\tau = \\tau_{\\star}$.\n- In the two-stream discrete-ordinate method with $N=2$ streams and Gauss–Legendre quadrature, the angular nodes are $\\mu_1 = 1/\\sqrt{3}$ and $-\\mu_1$ with weights equal to $1$. The fluxes are defined by $$F^{+}(\\tau) = 2 \\pi \\mu_1 I^{+}(\\tau), \\quad F^{-}(\\tau) = 2 \\pi \\mu_1 I^{-}(\\tau),$$ where $I^{+}$ and $I^{-}$ are the intensities in the downward and upward directions.\n\nFrom these bases, derive the two-stream flux equations and incorporate the Lambertian surface coupling to compute the top-of-atmosphere albedo for each spectral band. Aggregate the results across bands using given weights to produce the broadband albedo.\n\nProgramming task:\n- Implement the two-stream discrete-ordinate system for fluxes:\n  $$\\frac{d F^{+}}{d \\tau} = \\frac{(-1 + \\omega_0/2) F^{+} + (\\omega_0/2) F^{-}}{\\mu_1}, \\quad \\frac{d F^{-}}{d \\tau} = \\frac{(-\\omega_0/2) F^{+} + (1 - \\omega_0/2) F^{-}}{\\mu_1}.$$\n- Enforce the top boundary condition for diffuse illumination: $$F^{+}(0) = 1,$$ and determine $F^{-}(0)$ by satisfying the Lambertian surface boundary condition at the bottom: $$F^{-}(\\tau_{\\star}) = \\alpha_s F^{+}(\\tau_{\\star}).$$\n- Solve the linear system by superposition: propagate two basis initial conditions $(F^{+}(0),F^{-}(0)) = (1,0)$ and $(0,1)$ to the bottom via matrix exponential, and combine them to satisfy the bottom boundary. Then compute the band albedo $$A_b = \\frac{F^{-}(0)}{F^{+}(0)}.$$\n- Compute broadband albedo as $$A_{\\text{bb}} = \\sum_{b} w_b \\, A_b,$$ where $w_b$ are given nonnegative weights that sum to one.\n\nNumerical requirements and units:\n- The broadband albedo and band albedos must be returned as decimal fractions (dimensionless).\n- Angles are represented through $\\mu_1 = 1/\\sqrt{3}$; there is no separate angle unit to report.\n- Use double precision calculations.\n\nTest suite:\nProvide a program that computes the broadband albedo for the following test cases. Each test case specifies the per-band optical depths and single-scattering albedos, along with band weights and a surface Lambertian reflectance.\n\n1. General three-band case (happy path):\n   - $\\tau = [0.3, 1.5, 5.0]$\n   - $\\omega_0 = [0.98, 0.85, 0.60]$\n   - $w = [0.5, 0.3, 0.2]$\n   - $\\alpha_s = 0.15$\n2. Boundary case with zero optical depth:\n   - $\\tau = [0.0]$\n   - $\\omega_0 = [0.70]$\n   - $w = [1.0]$\n   - $\\alpha_s = 0.30$\n3. Strongly absorbing atmosphere:\n   - $\\tau = [2.0]$\n   - $\\omega_0 = [0.0]$\n   - $w = [1.0]$\n   - $\\alpha_s = 0.60$\n4. Highly scattering, optically thick atmosphere:\n   - $\\tau = [20.0]$\n   - $\\omega_0 = [0.999]$\n   - $w = [1.0]$\n   - $\\alpha_s = 0.05$\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where each result is the broadband albedo for the corresponding test case, rounded to six decimal places.",
            "solution": "We begin from the Radiative Transfer Equation (RTE) for specific intensity $I(\\tau,\\mu)$ in a plane-parallel, homogeneous medium with isotropic scattering:\n$$\\mu \\frac{d I(\\tau,\\mu)}{d \\tau} = -I(\\tau,\\mu) + \\frac{\\omega_0}{2} \\int_{-1}^{1} I(\\tau,\\mu') \\, d\\mu'.$$\nThe optical depth $\\tau$ measures extinction downward, $\\mu$ is the cosine of the zenith angle, and $\\omega_0$ is the single-scattering albedo. For isotropic scattering, the phase function is constant, so the scattering source term depends only on the angular integral of intensity.\n\nTo form a computationally tractable model, we adopt the discrete-ordinate two-stream approximation with $N=2$ streams. Using Gauss–Legendre quadrature on $[-1,1]$ with $N=2$ yields nodes $\\mu_1 = 1/\\sqrt{3}$ and $-\\mu_1$, both with weight $1$. We denote $I^{+}(\\tau) = I(\\tau,\\mu_1)$ and $I^{-}(\\tau) = I(\\tau,-\\mu_1)$. The integral $\\int_{-1}^{1} I(\\tau,\\mu') \\, d\\mu'$ is approximated as $I^{+}(\\tau) + I^{-}(\\tau)$ by the two-point quadrature rule.\n\nSubstituting this quadrature into the RTE for the two streams gives:\n$$\\mu_1 \\frac{d I^{+}}{d \\tau} = -I^{+} + \\frac{\\omega_0}{2}\\left(I^{+} + I^{-}\\right),$$\n$$-\\mu_1 \\frac{d I^{-}}{d \\tau} = -I^{-} + \\frac{\\omega_0}{2}\\left(I^{+} + I^{-}\\right).$$\nWe convert intensities to fluxes using the definitions for hemispheric flux in the two-stream discretization:\n$$F^{+}(\\tau) = 2\\pi \\mu_1 I^{+}(\\tau), \\quad F^{-}(\\tau) = 2\\pi \\mu_1 I^{-}(\\tau).$$\nMultiplying the intensity equations by $2\\pi \\mu_1$ converts to flux-form ordinary differential equations (ODEs):\n$$\\mu_1 \\frac{d F^{+}}{d \\tau} = -F^{+} + \\frac{\\omega_0}{2}\\left(F^{+} + F^{-}\\right),$$\n$$-\\mu_1 \\frac{d F^{-}}{d \\tau} = -F^{-} + \\frac{\\omega_0}{2}\\left(F^{+} + F^{-}\\right).$$\nEquivalently,\n$$\\frac{d F^{+}}{d \\tau} = \\frac{(-1 + \\omega_0/2) F^{+} + (\\omega_0/2) F^{-}}{\\mu_1},$$\n$$\\frac{d F^{-}}{d \\tau} = \\frac{(-\\omega_0/2) F^{+} + (1 - \\omega_0/2) F^{-}}{\\mu_1}.$$\nThese are linear ODEs with constant coefficients. We write them compactly as\n$$\\frac{d}{d \\tau} \\begin{bmatrix} F^{+} \\\\ F^{-} \\end{bmatrix} = \\mathbf{A} \\begin{bmatrix} F^{+} \\\\ F^{-} \\end{bmatrix}, \\quad \\mathbf{A} = \\frac{1}{\\mu_1}\\begin{bmatrix} -1 + \\frac{\\omega_0}{2}  \\frac{\\omega_0}{2} \\\\ -\\frac{\\omega_0}{2}  1 - \\frac{\\omega_0}{2} \\end{bmatrix}.$$\nThe boundary conditions are as follows. At the top-of-atmosphere, the incident illumination is diffuse and normalized such that the downward flux is unity:\n$$F^{+}(0) = 1.$$\nThere is no prescribed incident upward flux at the top, so $F^{-}(0)$ is unknown and must be determined by satisfying the bottom boundary condition. At the bottom of the atmospheric layer, located at $\\tau = \\tau_{\\star}$, the Lambertian surface with reflectance $\\alpha_s$ imposes a flux boundary coupling:\n$$F^{-}(\\tau_{\\star}) = \\alpha_s F^{+}(\\tau_{\\star}).$$\nThe system is linear and time-invariant in $\\tau$, so the solution at $\\tau = \\tau_{\\star}$ is related to the top boundary $(F^{+}(0),F^{-}(0))$ via the matrix exponential:\n$$\\begin{bmatrix} F^{+}(\\tau_{\\star}) \\\\ F^{-}(\\tau_{\\star}) \\end{bmatrix} = \\exp(\\mathbf{A} \\tau_{\\star}) \\begin{bmatrix} F^{+}(0) \\\\ F^{-}(0) \\end{bmatrix}.$$\nDefine two basis solutions by propagating the initial conditions $(1,0)$ and $(0,1)$ through the slab:\n$$\\begin{bmatrix} F^{+}_1(\\tau_{\\star}) \\\\ F^{-}_1(\\tau_{\\star}) \\end{bmatrix} = \\exp(\\mathbf{A} \\tau_{\\star}) \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}, \\quad \\begin{bmatrix} F^{+}_2(\\tau_{\\star}) \\\\ F^{-}_2(\\tau_{\\star}) \\end{bmatrix} = \\exp(\\mathbf{A} \\tau_{\\star}) \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}.$$\nWith the actual top boundary $F^{+}(0)=1$ and unknown $F^{-}(0)=x$, the bottom fluxes are given by\n$$F^{+}(\\tau_{\\star}) = F^{+}_1(\\tau_{\\star}) + x F^{+}_2(\\tau_{\\star}), \\quad F^{-}(\\tau_{\\star}) = F^{-}_1(\\tau_{\\star}) + x F^{-}_2(\\tau_{\\star}).$$\nImposing the Lambertian condition $F^{-}(\\tau_{\\star}) = \\alpha_s F^{+}(\\tau_{\\star})$ yields a scalar equation for $x$:\n$$F^{-}_1(\\tau_{\\star}) + x F^{-}_2(\\tau_{\\star}) = \\alpha_s\\left[F^{+}_1(\\tau_{\\star}) + x F^{+}_2(\\tau_{\\star})\\right].$$\nSolve for $x$:\n$$x = \\frac{\\alpha_s F^{+}_1(\\tau_{\\star}) - F^{-}_1(\\tau_{\\star})}{F^{-}_2(\\tau_{\\star}) - \\alpha_s F^{+}_2(\\tau_{\\star})}.$$\nThe top-of-atmosphere albedo for the band is the ratio of the upward to downward flux at the top:\n$$A_b = \\frac{F^{-}(0)}{F^{+}(0)} = \\frac{x}{1} = x.$$\nTo compute the broadband albedo across multiple bands indexed by $b$ with weights $w_b$ that sum to one, we compute $A_b$ for each band using its $(\\tau_b,\\omega_{0,b})$ and the common $\\alpha_s$, then form\n$$A_{\\text{bb}} = \\sum_b w_b A_b.$$\n\nAlgorithmic design:\n1. For each band, set $\\mu_1 = 1/\\sqrt{3}$ and form the $2 \\times 2$ matrix $\\mathbf{A}$ using the given $\\omega_{0,b}$.\n2. Compute the matrix exponential $\\mathbf{M} = \\exp(\\mathbf{A} \\tau_b)$.\n3. Extract basis vectors at the bottom: $\\begin{bmatrix} F^{+}_1 \\\\ F^{-}_1 \\end{bmatrix} = \\mathbf{M} \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$ and $\\begin{bmatrix} F^{+}_2 \\\\ F^{-}_2 \\end{bmatrix} = \\mathbf{M} \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$.\n4. Solve for the top upward flux $x = (\\alpha_s F^{+}_1 - F^{-}_1)/(F^{-}_2 - \\alpha_s F^{+}_2)$.\n5. Set $A_b = x$ and aggregate the broadband albedo $A_{\\text{bb}} = \\sum_b w_b A_b$.\n6. Repeat for all test cases and report the results as decimal fractions rounded to six decimal places.\n\nScientific realism and edge cases:\n- When $\\tau = 0$, the matrix exponential is the identity, so $F^{+}_1 = 1$, $F^{-}_1 = 0$, $F^{+}_2 = 0$, $F^{-}_2 = 1$, yielding $x = \\alpha_s$, consistent with a transparent atmosphere where the albedo equals the surface reflectance.\n- When $\\omega_0 = 0$, scattering vanishes and the ODEs reduce to pure absorption for the downward stream with upward flux determined solely by surface reflection attenuated by upward path; the matrix exponential handles this regime.\n- For optically thick, highly scattering atmospheres, the computed albedo approaches the reflectance of a semi-infinite scattering medium, with the surface contribution damped by the atmospheric multiple scattering.\n\nThe implementation uses a matrix exponential for accuracy and efficiency, avoiding numerical instabilities associated with integrating stiff ODEs for large optical depths. The final program computes the broadband albedo for the four specified test cases and prints the results in the required format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef two_stream_band_albedo(tau, w0, alpha_s):\n    \"\"\"\n    Compute band albedo using two-stream discrete-ordinate method with Lambertian surface coupling.\n    Parameters:\n        tau (float): Optical depth of the layer (downward).\n        w0 (float): Single-scattering albedo.\n        alpha_s (float): Lambertian surface reflectance (dimensionless).\n    Returns:\n        float: Top-of-atmosphere band albedo (dimensionless).\n    \"\"\"\n    # Two-stream Gauss–Legendre node for N=2\n    mu1 = 1.0 / np.sqrt(3.0)\n\n    # Construct the 2x2 coefficient matrix A for dF/dtau = A F\n    A = (1.0 / mu1) * np.array([\n        [-1.0 + 0.5 * w0,  0.5 * w0],\n        [-0.5 * w0,        1.0 - 0.5 * w0]\n    ])\n\n    # Matrix exponential to propagate from top (tau=0) to bottom (tau=tau)\n    M = expm(A * tau)\n\n    # Basis solutions at the bottom for initial conditions (1,0) and (0,1)\n    F1 = M @ np.array([1.0, 0.0])\n    F2 = M @ np.array([0.0, 1.0])\n\n    # Solve for upward flux at top (x) satisfying bottom boundary F^- = alpha_s F^+\n    denom = F2[1] - alpha_s * F2[0]\n    numer = alpha_s * F1[0] - F1[1]\n\n    # Handle potential near-zero denominator robustly\n    if np.isclose(denom, 0.0, atol=1e-14, rtol=0.0):\n        # In pathological cases, revert to small regularization to avoid division by zero\n        denom = denom + np.sign(denom) * 1e-14 if denom != 0.0 else 1e-14\n\n    x = numer / denom  # Upward flux at top, since F^+(0)=1\n\n    return float(x)\n\ndef broadband_albedo(tau_list, w0_list, weights, alpha_s):\n    \"\"\"\n    Compute broadband albedo given lists of tau and w0 per band, weights, and surface albedo.\n    Parameters:\n        tau_list (list[float]): Optical depths per band.\n        w0_list (list[float]): Single-scattering albedos per band.\n        weights (list[float]): Band weights that sum to 1.\n        alpha_s (float): Lambertian surface reflectance.\n    Returns:\n        float: Broadband albedo as weighted sum of band albedos.\n    \"\"\"\n    tau_arr = np.array(tau_list, dtype=float)\n    w0_arr = np.array(w0_list, dtype=float)\n    w_arr = np.array(weights, dtype=float)\n\n    # Normalize weights to avoid sensitivity to small numerical drift\n    if not np.isclose(np.sum(w_arr), 1.0, atol=1e-12):\n        w_arr = w_arr / np.sum(w_arr)\n\n    band_albedos = []\n    for t, w0 in zip(tau_arr, w0_arr):\n        Ab = two_stream_band_albedo(t, w0, alpha_s)\n        band_albedos.append(Ab)\n\n    band_albedos = np.array(band_albedos, dtype=float)\n    return float(np.sum(w_arr * band_albedos))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Each test case: (tau_list, w0_list, weights, alpha_s)\n        ([0.3, 1.5, 5.0], [0.98, 0.85, 0.60], [0.5, 0.3, 0.2], 0.15),\n        ([0.0],           [0.70],             [1.0],           0.30),\n        ([2.0],           [0.0],              [1.0],           0.60),\n        ([20.0],          [0.999],            [1.0],           0.05),\n    ]\n\n    results = []\n    for tau_list, w0_list, weights, alpha_s in test_cases:\n        result = broadband_albedo(tau_list, w0_list, weights, alpha_s)\n        # Round to six decimal places as required\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}