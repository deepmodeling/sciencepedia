{
    "hands_on_practices": [
        {
            "introduction": "地球物理流体动力学的核心在于理解不同作用力的相对重要性。通过标度分析和无量纲化，我们可以从基本原理出发，评估各种近似的适用性。本练习将通过计算罗斯贝数 $Ro$、弗劳德数 $Fr$ 和宽高比 $\\epsilon$，来量化行星尺度流动中的惯性力、科氏力和重力效应，从而判断静力平衡和地转平衡近似的合理性 。",
            "id": "3925160",
            "problem": "考虑在Boussinesq近似（除与重力加速度相乘的项外，密度变化均被忽略）和非弹性近似（通过对参考密度加权的速度施加散度约束来滤除快速声波）下的旋转、分层原始方程。这些方程描述了受地球自转（通过科里奥利项）和重力（通过浮力）影响的大尺度大气和海洋运动。通过使用特征水平速度尺度$U$、水平长度尺度$L$、垂直长度尺度$H$、科里奥利参数$f$和重力加速度$g$对控制方程进行无量纲化，可以得到一组衡量各项相对重要性的典型无量纲参数：一个旋转参数（罗斯贝数）、一个重力波参数（弗劳德数）和一个表示流体层薄度的宽高比。\n\n使用行星中纬度特征值 $U \\sim 10\\,\\mathrm{m\\,s^{-1}}$、$L \\sim 10^{6}\\,\\mathrm{m}$、$H \\sim 10^{4}\\,\\mathrm{m}$、$f \\sim 10^{-4}\\,\\mathrm{s^{-1}}$，并取$g=9.81\\,\\mathrm{m\\,s^{-2}}$，完成以下任务：\n- 从旋转Boussinesq原始方程和量纲推理出发，确定区分旋转、重力和几何效应的三个主要无量纲参数。然后，使用上述数值计算它们的具体值。\n- 基于你的结果，从第一性原理出发，论证静力平衡（垂直压力梯度与浮力相平衡）和地转平衡（科里奥利力与水平压力梯度相平衡）对于这些行星尺度是否是合适的领头阶近似。\n\n将你的最终数值结果表示为$\\left(Ro, Fr, \\epsilon\\right)$顺序的单个行向量，其中$Ro$是罗斯贝数，$Fr$是浅水弗劳德数，$\\epsilon$是宽高比。将每个条目四舍五入到三位有效数字。这些条目是无量纲的，报告时无需单位。",
            "solution": "该问题陈述具有科学依据、问题适定、客观且内部一致。它提供了所有必要的信息，用以确定和计算所需的无量纲参数，并评估地转近似和静力近似在指定物理尺度下的有效性。因此，该问题被认为是有效的，并提供完整解答如下。\n\n问题要求确定和计算控制大尺度行星流动的三个关键无量纲参数，并基于这些参数评估两个基本动力学平衡。分析从Boussinesq近似下的原始方程开始。\n\n首先，我们通过对控制力和几何结构进行量纲分析，来确定这三个无量纲参数。给定的特征尺度为水平速度$U$、水平长度$L$、垂直长度$H$、科里奥利参数$f$和重力加速度$g$。\n\n罗斯贝数 ($Ro$):\n罗斯贝数衡量惯性力与科里奥利力之比。在旋转坐标系中，忽略摩擦的水平动量方程为：\n$$ \\frac{D\\mathbf{u}_h}{Dt} = - f \\mathbf{k} \\times \\mathbf{u}_h - \\frac{1}{\\rho_0} \\nabla_h p $$\n其中$\\mathbf{u}_h$是水平速度矢量，$\\mathbf{k}$是垂直方向的单位矢量，$p$是压力。物质导数为$\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$。惯性加速度项$\\frac{D\\mathbf{u}_h}{Dt}$主要由平流部分$\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h$主导，其尺度为$\\frac{U^2}{L}$。科里奥利加速度项$f \\mathbf{k} \\times \\mathbf{u}_h$的尺度为$fU$。\n这两项之比定义了罗斯贝数：\n$$ Ro = \\frac{|\\text{惯性力}|}{|\\text{科里奥利力}|} \\sim \\frac{U^2/L}{fU} = \\frac{U}{fL} $$\n\n弗劳德数 ($Fr$):\n弗劳德数比较流动的动能与重力波相关的势能。对于深度为$H$的流体，长波或浅水外重力波的速度为$c = \\sqrt{gH}$。弗劳德数是特征流速$U$与此波速之比。问题在输出格式中指明了“浅水弗劳德数”，确认了此定义。\n$$ Fr = \\frac{U}{c} = \\frac{U}{\\sqrt{gH}} $$\n该参数常以其平方形式$Fr^2 = U^2/(gH)$出现，表示动能与势能之比。\n\n宽高比 ($\\epsilon$):\n该参数是一个纯几何比率，描述流体域的薄度。它定义为特征垂直长度尺度$H$与特征水平长度尺度$L$之比。\n$$ \\epsilon = \\frac{H}{L} $$\n\n接下来，我们使用给定的行星中纬度运动的特征尺度来计算这些参数的数值：\n$U = 10\\,\\mathrm{m\\,s^{-1}}$\n$L = 10^6\\,\\mathrm{m}$\n$H = 10^4\\,\\mathrm{m}$\n$f = 10^{-4}\\,\\mathrm{s^{-1}}$\n$g = 9.81\\,\\mathrm{m\\,s^{-2}}$\n\n计算罗斯贝数：\n$$ Ro = \\frac{10\\,\\mathrm{m\\,s^{-1}}}{(10^{-4}\\,\\mathrm{s^{-1}}) \\times (10^6\\,\\mathrm{m})} = \\frac{10}{10^2} = 0.1 $$\n\n计算弗劳德数：\n重力波速为 $c = \\sqrt{gH} = \\sqrt{(9.81\\,\\mathrm{m\\,s^{-2}}) \\times (10^4\\,\\mathrm{m})} = \\sqrt{98100}\\,\\mathrm{m\\,s^{-1}} \\approx 313.209\\,\\mathrm{m\\,s^{-1}}$。\n$$ Fr = \\frac{10\\,\\mathrm{m\\,s^{-1}}}{313.209\\,\\mathrm{m\\,s^{-1}}} \\approx 0.031927... $$\n\n计算宽高比：\n$$ \\epsilon = \\frac{10^4\\,\\mathrm{m}}{10^6\\,\\mathrm{m}} = 10^{-2} = 0.01 $$\n\n将这些值四舍五入到三位有效数字，我们得到：\n$Ro = 0.100$\n$Fr \\approx 0.0319$\n$\\epsilon = 0.0100$\n\n最后，我们评估地转平衡和静力平衡的有效性。\n\n地转平衡：\n地转平衡是水平动量方程中科里奥利力与水平压力梯度力之间的领头阶平衡（$f \\mathbf{k} \\times \\mathbf{u}_h \\approx -\\frac{1}{\\rho_0} \\nabla_h p$）。当惯性力远小于科里奥利力时，此平衡成立。罗斯贝数$Ro$精确地量化了这一比率。我们计算出的值为$Ro = 0.100$。由于$Ro \\ll 1$，惯性项比科里奥利项和压力梯度项小一个数量级。因此，对于描述这些尺度下的大尺度行星流动，地转平衡是一个合适且准确的领头阶近似。\n\n静力平衡：\n静力平衡是垂直动量方程中垂直压力梯度力与重力之间的领头阶平衡（$\\frac{\\partial p}{\\partial z} \\approx -\\rho g$）。当垂直加速度相对于主导垂直平衡的力可以忽略不计时，此近似有效。\n静力近似在大尺度大气和海洋流动中有效的主要原因是小宽高比，$\\epsilon = H/L$。我们计算出$\\epsilon = 0.0100$。\n小宽高比意味着流动的几何形状是薄片状。根据不可压缩或非弹性流体的连续性方程（$\\nabla \\cdot \\mathbf{u} \\approx 0$），垂直速度$W$的尺度与水平速度$U$的关系为$W \\sim U(H/L) = U\\epsilon$。\n垂直加速度的尺度为$W/T \\sim W(U/L) \\sim (U\\epsilon)(U/L) = U^2\\epsilon/L = U^2 H /L^2$。垂直平衡中的力（压力梯度和重力）的量级为$g$。垂直加速度与重力之比为$\\frac{U^2 H / L^2}{g} = \\frac{U^2}{gH} \\frac{H^2}{L^2} = Fr^2 \\epsilon^2$。\n用我们的数值，这个比率约为$(0.0319)^2 \\times (0.01)^2 \\approx 10^{-3} \\times 10^{-4} = 10^{-7}$，这是一个极小的值。\n更直接地看，考察无量纲垂直动量方程会发现，垂直加速度项相对于主要平衡项（压力梯度和重力）被一个因子$\\epsilon^2 = (0.01)^2 = 10^{-4}$缩放。由于$\\epsilon^2 \\ll 1$，垂直加速度在动力学上是不重要的。因此，对于这些行星尺度，静力平衡是一个极其精确的近似。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.100  0.0319  0.0100 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "层结是地球流体的一个基本特征，它决定了内部波的传播和垂直混合。布伦特-维萨拉频率 $N^2$ 是衡量静态稳定性的关键参数。本练习将指导你推导和计算在典型的大气（非弹性近似）和海洋（Boussinesq近似）层结中的 $N^2$ 值，让你亲身体会这两种近似在实际应用中的差异 。",
            "id": "3925142",
            "problem": "考虑两种稳定层结的地球物理流体，它们由静力原始方程在相应的密度处理下描述。在大气中，假定采用非弹性近似（密度变化在浮力项中保留，但从声波中滤除）；而在海洋中，假定采用Boussinesq近似（除浮力项外，参考密度为常数）。\n\n大气情况（非弹性，静力）：干燥对流层的背景位温$\\Theta(z)$随高度$z$线性增加，其中$z$是从地表向上测量的。该廓线为$\\Theta(z) = \\Theta_{0} + \\Gamma_{\\theta} z$，其中$\\Theta_{0} = 300 \\ \\mathrm{K}$且$\\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}}$。重力为常数$g = 9.81 \\ \\mathrm{m \\ s^{-2}}$。假定大尺度运动满足静力平衡，并且是在此背景场上的小振幅扰动。\n\n海洋情况（Boussinesq，静力）：上层海洋密度跃层的密度随高度$z$线性减小（$z$向上测量，平均海平面处$z=0$）。在深度$z=-200 \\ \\mathrm{m}$和$z=-100 \\ \\mathrm{m}$之间，位密随$z$线性地从$1024 \\ \\mathrm{kg \\ m^{-3}}$减小到$1022 \\ \\mathrm{kg \\ m^{-3}}$。使用常数参考密度$\\rho_{0} = 1025 \\ \\mathrm{kg \\ m^{-3}}$和相同的重力$g$。\n\n任务：\n1. 从静力原始方程和适用于每种近似的基本定义出发，推导每种情况下（大气：用位温梯度表示；海洋：用背景密度梯度表示）的Brunt–Väisälä频率平方$N^{2}$的表达式。\n2. 计算对流层廓线和海洋密度跃层的$N^{2}$值。将每个$N^{2}$以$\\mathrm{s^{-2}}$为单位表示。\n3. 使用您计算出的值，确定无量纲比率$R = N^{2}_{\\mathrm{ocean}} / N^{2}_{\\mathrm{trop}}$。将$R$的最终答案表示为单个实数，并四舍五入到四位有效数字。\n\n在您的解答中，还需讨论在非弹性近似（大气）与Boussinesq近似（海洋）下，$N^{2}$的大小如何影响静力原始方程中的内模结构（垂直本征函数和频率），并着重说明由于各自的密度处理方式导致垂直模态权重上的任何差异。该讨论不属于最终数值答案的一部分。",
            "solution": "该问题要求针对特定的大气和海洋情况，推导和计算Brunt–Väisälä频率的平方$N^2$，计算它们的比率，并讨论其对内波模态的影响。\n\n该问题具有科学依据，提法明确且客观。它基于地球物理流体动力学的基本原理（静力平衡、Boussinesq近似和非弹性近似、静力稳定度）。所提供的数据是自洽的，足以得到唯一解。因此，该问题被认为是有效的，并将提供解答。\n\n### 第1部分：Brunt–Väisälä频率($N^2$)的推导\n\nBrunt–Väisälä频率的平方$N^2$表示在静力稳定的层结流体中，一个流体质块从其平衡位置绝热位移后垂直振荡的固有频率的平方。一般推导从考虑这样一个质块的垂直加速度开始。作用在质块上单位体积的净垂直力是浮力，由$-g(\\rho_p - \\rho_e)$给出，其中$g$是重力加速度，$\\rho_p$是质块的密度，$\\rho_e$是周围环境的密度。\n\n对于一个小的垂直位移$\\delta z$，运动方程为：\n$$ \\rho_p \\frac{d^2(\\delta z)}{dt^2} = -g(\\rho_p - \\rho_e(z+\\delta z)) $$\n通过对每个流体系统进行线性化并应用适当的热力学约束，我们可以推导出$N^2$的表达式。\n\n**A. 大气情况（非弹性，静力）**\n\n对于干燥大气，在非弹性近似中，密度变化对浮力很重要，但从声学效应中被滤除。流体质块的状态最好用其位温$\\Theta$来描述，$\\Theta$在绝热位移过程中是守恒的。\n\n假设背景状态由位温廓线$\\Theta(z)$表征。一个处于平衡高度$z$的质块的位温为$\\Theta(z)$。如果该质块垂直位移一小段距离$\\delta z$到新的高度$z + \\delta z$，其位温仍为$\\Theta(z)$。在这个新高度，周围环境的位温为$\\Theta(z + \\delta z) \\approx \\Theta(z) + \\frac{d\\Theta}{dz}\\delta z$。\n\n在非弹性系统中，浮力与位温差成正比。垂直加速度$a = d^2(\\delta z)/dt^2$由以下公式给出：\n$$ a = g \\frac{\\Theta_{\\text{parcel}} - \\Theta_{\\text{env}}}{\\Theta_{\\text{ref}}} $$\n此处，$\\Theta_{\\text{parcel}} = \\Theta(z)$ 且 $\\Theta_{\\text{env}} = \\Theta(z + \\delta z)$。$\\Theta_{\\text{ref}}$ 是一个常数参考位温。因此，\n$$ a = g \\frac{\\Theta(z) - \\left(\\Theta(z) + \\frac{d\\Theta}{dz}\\delta z\\right)}{\\Theta_{\\text{ref}}} = - \\left(\\frac{g}{\\Theta_{\\text{ref}}} \\frac{d\\Theta}{dz}\\right) \\delta z $$\n这是简谐运动的方程，$\\frac{d^2(\\delta z)}{dt^2} = -N^2 \\delta z$。通过比较，大气中的Brunt–Väisälä频率平方为：\n$$ N^2 = \\frac{g}{\\Theta_{\\text{ref}}} \\frac{d\\Theta}{dz} $$\n对于给定的问题，参考位温是$\\Theta_{0}$，梯度是$\\Gamma_{\\theta}$。\n$$ N^2_{\\mathrm{trop}} = \\frac{g}{\\Theta_{0}} \\frac{d\\Theta}{dz} $$\n\n**B. 海洋情况（Boussinesq，静力）**\n\n在Boussinesq近似中，动量方程中的密度$\\rho$被视为常数参考值$\\rho_0$，但在浮力项中其变化至关重要。为分析稳定性，我们使用位密，它对于绝热移动的质块是守恒的。问题中将其称为“位密”，我们记为$\\rho(z)$。\n\n考虑一个在高度$z$处平衡的质块，其位密为$\\rho(z)$。当位移到$z + \\delta z$时，它保持这个密度不变。在$z + \\delta z$处的环境密度为$\\rho(z + \\delta z) \\approx \\rho(z) + \\frac{d\\rho}{dz}\\delta z$。\n\n作用于质块的单位质量浮力为$-g(\\rho_{\\text{parcel}} - \\rho_{\\text{env}})/\\rho_0$。运动方程为：\n$$ \\frac{d^2(\\delta z)}{dt^2} = -g \\frac{\\rho(z) - \\left(\\rho(z) + \\frac{d\\rho}{dz}\\delta z\\right)}{\\rho_0} = -g \\frac{-\\frac{d\\rho}{dz}\\delta z}{\\rho_0} = \\left(-\\frac{g}{\\rho_0} \\frac{d\\rho}{dz}\\right) \\delta z $$\n对于稳定层结，密度必须随高度减小，因此$d\\rho/dz  0$。这会产生一个恢复力。该方程的形式为$\\frac{d^2(\\delta z)}{dt^2} = -N^2 \\delta z$。通过比较，海洋的Brunt–Väisälä频率平方为：\n$$ N^2_{\\mathrm{ocean}} = -\\frac{g}{\\rho_0} \\frac{d\\rho}{dz} $$\n\n\n### 第2部分：$N^2$的计算\n\n**A. 大气情况**\n\n给定数据：\n- $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$\n- $\\Theta(z) = \\Theta_{0} + \\Gamma_{\\theta} z$\n- $\\Theta_{0} = 300 \\ \\mathrm{K}$\n- $\\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}}$\n\n首先，我们转换$\\Gamma_{\\theta}$的单位：\n$$ \\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}} = 3 \\ \\frac{\\mathrm{K}}{1000 \\ \\mathrm{m}} = 0.003 \\ \\mathrm{K \\ m^{-1}} $$\n位温梯度是常数：$\\frac{d\\Theta}{dz} = \\Gamma_{\\theta} = 0.003 \\ \\mathrm{K \\ m^{-1}}$。\n\n使用推导出的公式，并取$\\Theta_{\\text{ref}} = \\Theta_0$：\n$$ N^2_{\\mathrm{trop}} = \\frac{g}{\\Theta_0} \\frac{d\\Theta}{dz} = \\frac{9.81 \\ \\mathrm{m \\ s^{-2}}}{300 \\ \\mathrm{K}} \\times 0.003 \\ \\mathrm{K \\ m^{-1}} $$\n$$ N^2_{\\mathrm{trop}} = \\frac{9.81 \\times 0.003}{300} \\ \\mathrm{s^{-2}} = \\frac{0.02943}{300} \\ \\mathrm{s^{-2}} = 9.81 \\times 10^{-5} \\ \\mathrm{s^{-2}} $$\n\n**B. 海洋情况**\n\n给定数据：\n- $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$\n- $\\rho_0 = 1025 \\ \\mathrm{kg \\ m^{-3}}$\n- 在 $z_1 = -200 \\ \\mathrm{m}$ 处, $\\rho_1 = 1024 \\ \\mathrm{kg \\ m^{-3}}$\n- 在 $z_2 = -100 \\ \\mathrm{m}$ 处, $\\rho_2 = 1022 \\ \\mathrm{kg \\ m^{-3}}$\n\n密度廓线是线性的，所以梯度$\\frac{d\\rho}{dz}$是常数：\n$$ \\frac{d\\rho}{dz} = \\frac{\\rho_2 - \\rho_1}{z_2 - z_1} = \\frac{1022 \\ \\mathrm{kg \\ m^{-3}} - 1024 \\ \\mathrm{kg \\ m^{-3}}}{-100 \\ \\mathrm{m} - (-200 \\ \\mathrm{m})} = \\frac{-2 \\ \\mathrm{kg \\ m^{-3}}}{100 \\ \\mathrm{m}} = -0.02 \\ \\mathrm{kg \\ m^{-4}} $$\n这个负梯度证实了密度跃层是稳定层结的。\n\n使用推导出的公式：\n$$ N^2_{\\mathrm{ocean}} = -\\frac{g}{\\rho_0} \\frac{d\\rho}{dz} = -\\frac{9.81 \\ \\mathrm{m \\ s^{-2}}}{1025 \\ \\mathrm{kg \\ m^{-3}}} \\times (-0.02 \\ \\mathrm{kg \\ m^{-4}}) $$\n$$ N^2_{\\mathrm{ocean}} = \\frac{9.81 \\times 0.02}{1025} \\ \\mathrm{s^{-2}} = \\frac{0.1962}{1025} \\ \\mathrm{s^{-2}} \\approx 1.914146 \\times 10^{-4} \\ \\mathrm{s^{-2}} $$\n\n### 第3部分：无量纲比率$R$\n\n无量纲比率$R$定义为$R = N^{2}_{\\mathrm{ocean}} / N^{2}_{\\mathrm{trop}}$。\n$$ R = \\frac{1.914146 \\times 10^{-4} \\ \\mathrm{s^{-2}}}{9.81 \\times 10^{-5} \\ \\mathrm{s^{-2}}} $$\n或者，我们可以在代入数值之前先计算符号比率：\n$$ R = \\frac{-\\frac{g}{\\rho_0} \\frac{d\\rho}{dz}}{\\frac{g}{\\Theta_0} \\frac{d\\Theta}{dz}} = \\frac{-\\frac{d\\rho}{dz}/\\rho_0}{\\frac{d\\Theta}{dz}/\\Theta_0} = \\frac{-(-0.02 \\ \\mathrm{kg \\ m^{-4}}) / (1025 \\ \\mathrm{kg \\ m^{-3}})}{(0.003 \\ \\mathrm{K \\ m^{-1}}) / (300 \\ \\mathrm{K})} $$\n$$ R = \\frac{0.02 / 1025}{0.003 / 300} = \\frac{0.02}{1025} \\times \\frac{300}{0.003} = \\frac{2 \\times 10^{-2}}{1025} \\times \\frac{3 \\times 10^2}{3 \\times 10^{-3}} = \\frac{2 \\times 10^{-2}}{1025} \\times 10^5 = \\frac{2000}{1025} $$\n$$ R = \\frac{80}{41} \\approx 1.9512195... $$\n四舍五入到四位有效数字，我们得到$R = 1.951$。\n\n### 第4部分：关于内模结构的讨论\n\nBrunt-Väisälä频率$N^2$的大小是内重力波动力学的核心。这些波的垂直结构通常由一个二阶常微分方程控制，该方程在非弹性近似和Boussinesq近似下具有不同的形式。\n\n在两个系统中，$N(z)$都定义了自由传播内波的局部频率上限，即波频率$\\omega$必须满足$\\omega^2 \\leq N^2(z)$。我们的计算表明，对于给定的廓线，$N^2_{\\mathrm{ocean}}  N^2_{\\mathrm{trop}}$，这意味着海洋密度跃层支持比指定的对流层更高频率的内波。对于给定的水平波数，更大的$N^2$也会导致更大的垂直波数，对应于更短的垂直波长。\n\n内模结构中更根本的差异源于对背景密度$\\rho_0(z)$的处理。\n\n**Boussinesq近似（海洋）：** 密度$\\rho_0$被视为常数。对于常数$N$，垂直速度$w$的垂直结构方程为$\\frac{d^2 w}{dz^2} + k_z^2 w = 0$，其中$k_z^2 = k_h^2(N^2 - \\omega^2)/\\omega^2$。其解（本征函数）是简单的正弦函数，例如，对于高度为$H$的区域，$w(z) = W_m \\sin(m\\pi z/H)$。对于给定的模态，垂直速度和位移的振幅随高度是均匀的。当运动的垂直尺度远小于密度标高时，此近似有效，这一条件在海洋中通常得到满足。\n\n**非弹性近似（大气）：** 背景密度$\\rho_0(z)$随高度显著变化，通常呈指数递减，$\\rho_0(z) \\approx \\rho_{0s}\\exp(-z/H_{\\rho})$，其中$H_{\\rho}$是密度标高（约8公里）。控制垂直结构的方程更为复杂，通常针对密度加权变量（如$\\psi = \\sqrt{\\rho_0(z)} w$）来书写。这将方程转换为类薛定谔形式：$\\frac{d^2 \\psi}{dz^2} + \\left[ \\frac{N^2(z)}{c^2} - \\frac{1}{4H_{\\rho}^2} \\right] \\psi = 0$（对于垂直传播，其中$c$是水平相速）。\n\n$\\sqrt{\\rho_0(z)}$加权的关键含义是，为了使本征函数$\\psi(z)$保持有界，物理垂直速度$w(z) = \\psi(z)/\\sqrt{\\rho_0(z)}$必须随高度以$\\exp(z/2H_{\\rho})$的形式增长。这意味着大气内波的速度和位移振幅在密度较低的高海拔地区显著更大。这种放大确保了波的动能密度$\\frac{1}{2}\\rho_0(z) w^2 = \\frac{1}{2}\\psi^2$不会无界增长。相比之下，在Boussinesq近似下，动能密度$\\frac{1}{2}\\rho_0 w^2$的垂直结构与$w^2$的垂直结构相同。垂直模态权重的这种根本差异意味着，大气波的最大表现和输运效应往往出现在高海拔地区，而海洋内波的振幅结构在垂直方向上的偏斜较小。",
            "answer": "$$\n\\boxed{1.951}\n$$"
        },
        {
            "introduction": "将理论方程转化为数值模型是环境和地球系统建模的核心技能。Boussinesq近似和非弹性近似中的无辐散约束 ($\\nabla \\cdot \\mathbf{u} = 0$) 在数值求解中需要特殊处理。本练习将引导你通过一个完整的编程任务，从基本原理出发，设计并实现一个投影法求解器，以通过求解压力泊松方程来精确地施加这一关键的物理约束 。",
            "id": "3925134",
            "problem": "您的任务是设计并实现一种用于二维 Boussinesq 流的投影法，该方法基于不可压缩原始方程，使用周期性区域和基于快速傅里叶变换 (FFT) 的谱方法离散。其目标是通过压力求解来校正一个试探速度，从而强制执行无散度约束。本问题中的所有量都是无量纲的。您的实现必须是一个独立的、自包含的程序，对于一组指定的测试用例，计算特定的数值诊断量，并将它们以单行、逗号分隔、方括号括起来的列表形式输出。\n\n从适用于不可压缩 Boussinesq 流的基本定律和核心定义开始。在具有恒定参考密度的 Boussinesq 近似下，质量连续性方程简化为不可压缩性约束 $\\,\\nabla \\cdot \\mathbf{u} = 0\\,$，并且动量受到压力梯度的作用，该梯度动态地强制执行此约束。在投影法中，通过对不含压力梯度的动量方程进行步进，构造一个试探速度 $\\,\\mathbf{u}^{\\ast}\\,$，然后使用一个压力场来校正 $\\,\\mathbf{u}^{\\ast}\\,$，使得校正后的速度满足 $\\,\\nabla \\cdot \\mathbf{u}^{n+1} = 0\\,$。您的任务是从这些原理中推导出所需的压力方程，并实现一个与二维周期性方形区域和谱方法微分相一致的求解器。\n\n区域和离散化要求：\n\n- 使用边长为 $\\,L = 1\\,$ 的二维方形周期性区域。设空间坐标为 $\\,x \\in [0,1)\\,$ 和 $\\,y \\in [0,1)\\,$。\n- 在一个 $\\,N_x \\times N_y\\,$ 个点的均匀网格上进行离散，其中 $\\,N_x = 64\\,$ 且 $\\,N_y = 64\\,$。\n- 使用时间步长 $\\,\\Delta t = 0.05\\,$。\n- 假设恒定参考密度 $\\,\\rho_0 = 1\\,$。\n- 通过快速傅里叶变换 (FFT) 使用谱方法微分，并在两个方向上都使用周期性边界条件。使用在长度为 $\\,1\\,$ 的区域上进行 FFT 的标准约定来定义傅里叶波数，使得傅里叶空间中的微分对应于乘以 $\\,\\mathrm{i} k\\,$，其中 $\\,k\\,$ 是波数。\n\n投影法说明：\n\n- 根据下文规定，为每个测试用例构造一个试探速度 $\\,\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})\\,$。\n- 在一个时间步长 $\\,\\Delta t\\,$ 内用压力梯度校正 $\\,\\mathbf{u}^{\\ast}\\,$ 后，通过强制执行 $\\,\\nabla \\cdot \\mathbf{u}^{n+1} = 0\\,$ 来推导其所蕴含的压力方程。\n- 实现一个与周期性边界条件相一致的谱方法泊松求解器来求解压力。通过适当地设置零傅里叶模，将压力的平均值固定为零。\n- 使用计算出的压力来校正试探速度，使得校正后的速度 $\\,\\mathbf{u}^{n+1}\\,$ 在相同的谱方法微分下是（在数值精度范围内）无散度的。\n\n测试套件（三个用例）：\n\n设 $\\,k_x\\,$ 和 $\\,k_y\\,$ 表示整数波数，并使用定义在区域上的三角函数场，其参数乘以 $\\,2\\pi\\,$ 以确保周期性，例如 $\\,\\sin(2\\pi k_x x)\\,$。\n\n用例 $\\,1\\,$ （已为无散场）:\n- 定义流函数 $\\,\\psi(x,y) = A \\sin(2\\pi k_x x)\\sin(2\\pi k_y y)\\,$，其中 $\\,A = 1.2\\,$，$\\,k_x = 2\\,$ 且 $\\,k_y = 3\\,$。\n- 定义 $\\,u^{\\ast} = \\partial \\psi/\\partial y\\,$ 和 $\\,v^{\\ast} = -\\partial \\psi/\\partial x\\,$。根据构造，该场是精确无散度的。\n\n用例 $\\,2\\,$ （纯无旋场）:\n- 定义势函数 $\\,\\phi(x,y) = B \\cos(2\\pi k_x x)\\cos(2\\pi k_y y)\\,$，其中 $\\,B = 0.9\\,$，$\\,k_x = 4\\,$ 且 $\\,k_y = 5\\,$。\n- 定义 $\\,u^{\\ast} = \\partial \\phi/\\partial x\\,$ 和 $\\,v^{\\ast} = \\partial \\phi/\\partial y\\,$。该场是一个纯梯度场，具有非零散度。\n\n用例 $\\,3\\,$ （混合无旋和无散场）:\n- 定义流函数 $\\,\\psi(x,y) = A_3 \\sin(2\\pi k^{\\psi}_x x)\\sin(2\\pi k^{\\psi}_y y)\\,$，其中 $\\,A_3 = 0.8\\,$，$\\,k^{\\psi}_x = 3\\,$ 且 $\\,k^{\\psi}_y = 4\\,$。\n- 定义势函数 $\\,\\phi(x,y) = B_3 \\cos(2\\pi k^{\\phi}_x x)\\cos(2\\pi k^{\\phi}_y y)\\,$，其中 $\\,B_3 = 0.7\\,$，$\\,k^{\\phi}_x = 5\\,$ 且 $\\,k^{\\phi}_y = 2\\,$。\n- 定义 $\\,u^{\\ast} = \\partial \\psi/\\partial y + \\partial \\phi/\\partial x\\,$ 和 $\\,v^{\\ast} = -\\partial \\psi/\\partial x + \\partial \\phi/\\partial y\\,$。\n\n要求的诊断量：\n\n对于每个用例，使用谱方法导数计算以下诊断量：\n\n- 投影前 $\\,\\mathbf{u}^{\\ast}\\,$ 散度的均方根 (RMS)，定义为 $\\,\\sqrt{\\langle(\\nabla \\cdot \\mathbf{u}^{\\ast})^2\\rangle}\\,$，其中 $\\,\\langle\\cdot\\rangle\\,$ 表示在网格上的空间平均。\n- 投影后校正速度 $\\,\\mathbf{u}^{n+1}\\,$ 散度的 RMS。\n- 一个速度误差范数，用于量化投影是否产生了理论上预期的无散场：\n  - 用例 $\\,1\\,$：差值 $\\,\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}\\,$ 的 RMS。\n  - 用例 $\\,2\\,$：$\\,\\mathbf{u}^{n+1}\\,$ 的 RMS，因为在周期性区域上，纯梯度场的投影无散分量应为零。\n  - 用例 $\\,3\\,$：$\\,\\mathbf{u}^{n+1}\\,$ 与仅由流函数计算出的无散分量，即 $\\,(\\partial \\psi/\\partial y,\\,-\\partial \\psi/\\partial x)\\,$ 之间的差值的 RMS。\n\n所有计算都必须通过傅里叶变换使用谱方法导数，并且必须在给定的网格和区域上一致地执行。\n\n最终输出格式：\n\n您的程序应生成单行输出，包含 $\\,9\\,$ 个浮点数结果，按如下顺序排列：\n$\\,[$divergence\\_before\\_case1, divergence\\_after\\_case1, velocity\\_error\\_case1, divergence\\_before\\_case2, divergence\\_after\\_case2, velocity\\_error\\_case2, divergence\\_before\\_case3, divergence\\_after\\_case3, velocity\\_error\\_case3$]\\,$。\n这些数字必须以逗号分隔的列表形式打印，并用方括号括起来，不含任何额外文本。\n\n角度单位：所有三角函数的参数均以弧度为单位。\n\n物理单位：不适用，所有变量均为无量纲。\n\n您的实现必须是自包含的，且不应需要任何输入；它必须在内部定义测试用例，并打印最终的逗号分隔列表。基于 FFT 的投影和诊断量计算必须遵循开头所述的基本定律以及您对压力方程和校正步骤的推导。确保科学真实性和内部一致性；该程序必须能够在支持数值数组和 FFT 的现代环境中直接运行。",
            "solution": "该问题要求在周期性区域上，使用谱方法离散，为二维不可压缩 Boussinesq 流设计并实现一种投影法。核心任务是通过求解一个压力场来校正一个试探速度场，从而强制执行无散度条件 $\\,\\nabla \\cdot \\mathbf{u} = 0\\,$。\n\n投影法包括两个主要步骤。首先，获得一个试探速度 $\\,\\mathbf{u}^{\\ast}\\,$。在一个完整的时间步进格式中，这将涉及在没有压力梯度项的情况下推进动量方程。问题陈述为三个测试用例提供了 $\\,\\mathbf{u}^{\\ast}\\,$ 的显式解析形式。其次，该试探速度通过一个类压力标量场 $\\,p\\,$ 的梯度进行校正，以得到新时间层上的速度 $\\,\\mathbf{u}^{n+1}\\,$，该速度必须是无散度的。此校正步骤表示为：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho_0} \\nabla p\n$$\n其中 $\\,\\Delta t\\,$ 是时间步长，$\\,\\rho_0\\,$ 是恒定参考密度。\n\n为了求出压力 $\\,p\\,$，我们对校正后的速度场 $\\,\\mathbf{u}^{n+1}\\,$ 强制施加不可压缩性约束：\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\n将 $\\,\\mathbf{u}^{n+1}\\,$ 的表达式代入该约束，得到：\n$$\n\\nabla \\cdot \\left( \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho_0} \\nabla p \\right) = 0\n$$\n整理各项，我们得到压力泊松方程 (Pressure Poisson Equation, PPE)：\n$$\n\\nabla^2 p = \\frac{\\rho_0}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast}\n$$\n代表试探速度散度的右侧项，充当泊松方程的源项。求解该方程得到 $\\,p\\,$，使我们能够计算校正量并获得最终的无散度速度场 $\\,\\mathbf{u}^{n+1}\\,$。\n\n该问题指定在边长为 $\\,L=1\\,$、网格点数为 $\\,N_x \\times N_y\\,$ 的二维周期性区域上使用谱方法。这种背景非常适合使用快速傅里叶变换 (FFT)。在傅里叶空间中，微分算子变为代数乘法。函数 $\\,f(x,y)\\,$ 由其傅里叶系数 $\\,\\hat{f}(k_x, k_y)\\,$ 表示。梯度、散度和拉普拉斯算子的变换如下：\n$$\n\\mathcal{F}(\\nabla f) = i\\mathbf{k} \\hat{f} = (i k_x \\hat{f}, i k_y \\hat{f})\n$$\n$$\n\\mathcal{F}(\\nabla \\cdot \\mathbf{v}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{v}} = i k_x \\hat{u} + i k_y \\hat{v}\n$$\n$$\n\\mathcal{F}(\\nabla^2 f) = -|\\mathbf{k}|^2 \\hat{f} = -(k_x^2 + k_y^2) \\hat{f}\n$$\n其中 $\\,\\mathbf{k} = (k_x, k_y)\\,$ 是波数向量。对于长度为 $\\,L=1\\,$ 的区域，与 FFT 对应的离散波数为 $\\,k_x = 2\\pi m_x\\,$ 和 $\\,k_y = 2\\pi m_y\\,$，其中 $\\,m_x\\,$ 和 $\\,m_y\\,$ 是从 $\\,-N/2\\,$ 到 $\\,N/2-1\\,$ 的整数。\n\n对 PPE 应用傅里叶变换得到：\n$$\n-(k_x^2 + k_y^2) \\hat{p}(k_x, k_y) = \\frac{\\rho_0}{\\Delta t} \\mathcal{F}(\\nabla \\cdot \\mathbf{u}^{\\ast}) = \\frac{\\rho_0}{\\Delta t} (i k_x \\hat{u}^{\\ast} + i k_y \\hat{v}^{\\ast})\n$$\n我们可以解出压力的傅里叶系数 $\\,\\hat{p}\\,$：\n$$\n\\hat{p}(k_x, k_y) = - \\frac{\\rho_0}{\\Delta t} \\frac{i k_x \\hat{u}^{\\ast} + i k_y \\hat{v}^{\\ast}}{k_x^2 + k_y^2}\n$$\n该解对所有满足 $\\,k_x^2 + k_y^2 \\neq 0\\,$ 的波数有效。对于零波数模（$\\,k_x=k_y=0\\,$），分母为零。这对应于平均压力，在周期性区域中是不确定的。问题指定通过将平均压力设为零来解决此不确定性，这等同于设置 $\\,\\hat{p}(0, 0) = 0\\,$。这是自洽的，因为对于一个其导数通过谱方法计算的周期场，分子（平均散度）也为零。\n\n一旦 $\\,\\hat{p}\\,$ 已知，我们使用变换后的校正方程计算校正速度的傅里叶变换 $\\,\\hat{\\mathbf{u}}^{n+1}\\,$：\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^{\\ast} - \\frac{\\Delta t}{\\rho_0} (i\\mathbf{k} \\hat{p})\n$$\n按分量表示为：\n$$\n\\hat{u}^{n+1} = \\hat{u}^{\\ast} - i k_x \\frac{\\Delta t}{\\rho_0} \\hat{p}\n$$\n$$\n\\hat{v}^{n+1} = \\hat{v}^{\\ast} - i k_y \\frac{\\Delta t}{\\rho_0} \\hat{p}\n$$\n然后通过对 $\\,\\hat{\\mathbf{u}}^{n+1}\\,$ 应用逆 FFT 来恢复最终的校正速度场 $\\,\\mathbf{u}^{n+1}(x,y)\\,$。\n\n要求的诊断量计算如下：速度场 $\\,\\mathbf{v}=(u,v)\\,$ 的散度通过谱方法计算，即对其傅里叶表示进行逆 FFT：$\\,\\nabla \\cdot \\mathbf{v} = \\mathcal{F}^{-1}(i k_x \\hat{u} + i k_y \\hat{v})\\,$。网格上某量 $\\,F\\,$ 的均方根 (RMS) 定义为 $\\,\\sqrt{\\langle F^2 \\rangle}\\,$，其中 $\\,\\langle \\cdot \\rangle\\,$ 表示空间平均。对于矢量场 $\\,\\mathbf{v}\\,$，其 RMS 为 $\\,\\sqrt{\\langle |\\mathbf{v}|^2 \\rangle} = \\sqrt{\\langle u^2 + v^2 \\rangle}\\,$。\n\n每个测试用例的数值实现将按以下步骤进行：\n1.  在 $\\,64 \\times 64\\,$ 网格上定义试探速度场 $\\,\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})\\,$。\n2.  计算 $\\,u^{\\ast}\\,$ 和 $\\,v^{\\ast}\\,$ 的二维 FFT，得到 $\\,\\hat{u}^{\\ast}\\,$ 和 $\\,\\hat{v}^{\\ast}\\,$。\n3.  计算 $\\,\\mathbf{u}^{\\ast}\\,$ 散度的 RMS (诊断量 1)。\n4.  在傅里叶空间中求解 PPE 得到 $\\,\\hat{p}\\,$，并设置 $\\,\\hat{p}(0,0)=0\\,$。\n5.  在傅里叶空间中计算校正后的速度场 $\\,\\hat{\\mathbf{u}}^{n+1}\\,$。\n6.  计算 $\\,\\hat{u}^{n+1}\\,$ 和 $\\,\\hat{v}^{n+1}\\,$ 的二维逆 FFT，得到实空间中的 $\\,u^{n+1}\\,$ 和 $\\,v^{n+1}\\,$。\n7.  计算 $\\,\\mathbf{u}^{n+1}\\,$ 散度的 RMS (诊断量 2)，预期该值接近机器精度。\n8.  计算该用例的特定速度误差范数 (诊断量 3)。这涉及将 $\\,\\mathbf{u}^{n+1}\\,$ 与初始场的已知无散分量进行比较。\n\n这个系统性的步骤牢固地建立在不可压缩流体动力学和傅里叶分析的原理之上，确保了解决方案的正确性和可验证性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a spectral projection method for 2D incompressible Boussinesq flow\n    and computes specified diagnostics for three test cases.\n    \"\"\"\n    # Domain and discretization parameters\n    L = 1.0\n    Nx = 64\n    Ny = 64\n    \n    # Physical and numerical parameters\n    dt = 0.05\n    rho0 = 1.0\n    \n    # Create spatial grid\n    x = np.arange(Nx) / Nx * L\n    y = np.arange(Ny) / Ny * L\n    X, Y = np.meshgrid(x, y, indexing='ij')\n    \n    # Create wavenumber grids\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=L/Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=L/Ny)\n    Kx, Ky = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n    \n    # Squared wavenumber magnitude, handling the k=0 case for division later\n    k_sq = Kx**2 + Ky**2\n    k_sq_inv = np.zeros_like(k_sq)\n    nonzero_k = k_sq != 0\n    k_sq_inv[nonzero_k] = 1.0 / k_sq[nonzero_k]\n\n    def compute_rms_divergence(u, v, Kx, Ky):\n        \"\"\"Computes RMS of divergence using spectral derivatives.\"\"\"\n        u_hat = np.fft.fft2(u)\n        v_hat = np.fft.fft2(v)\n        div_hat = 1j * Kx * u_hat + 1j * Ky * v_hat\n        div = np.real(np.fft.ifft2(div_hat))\n        return np.sqrt(np.mean(div**2))\n\n    def compute_rms_vector(u, v):\n        \"\"\"Computes RMS of a vector field.\"\"\"\n        return np.sqrt(np.mean(u**2 + v**2))\n\n    results = []\n\n    # --- Case 1: Solenoidal field ---\n    A = 1.2\n    k_x1 = 2\n    k_y1 = 3\n    \n    # Define tentative velocity u_star (already divergence-free)\n    psi1 = A * np.sin(2 * np.pi * k_x1 * X) * np.sin(2 * np.pi * k_y1 * Y)\n    u_star1 = A * (2 * np.pi * k_y1) * np.sin(2 * np.pi * k_x1 * X) * np.cos(2 * np.pi * k_y1 * Y)\n    v_star1 = -A * (2 * np.pi * k_x1) * np.cos(2 * np.pi * k_x1 * X) * np.sin(2 * np.pi * k_y1 * Y)\n    \n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before1 = compute_rms_divergence(u_star1, v_star1, Kx, Ky)\n    \n    # Perform projection\n    u_star1_hat = np.fft.fft2(u_star1)\n    v_star1_hat = np.fft.fft2(v_star1)\n    div_u_star1_hat = 1j * Kx * u_star1_hat + 1j * Ky * v_star1_hat\n    p1_hat = - (rho0 / dt) * div_u_star1_hat * k_sq_inv\n    \n    u_np1_hat1 = u_star1_hat - (dt / rho0) * (1j * Kx * p1_hat)\n    v_np1_hat1 = v_star1_hat - (dt / rho0) * (1j * Ky * p1_hat)\n    \n    u_np1_1 = np.real(np.fft.ifft2(u_np1_hat1))\n    v_np1_1 = np.real(np.fft.ifft2(v_np1_hat1))\n    \n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after1 = compute_rms_divergence(u_np1_1, v_np1_1, Kx, Ky)\n    \n    # Diagnostic 3: Velocity error norm\n    vel_error1 = compute_rms_vector(u_np1_1 - u_star1, v_np1_1 - v_star1)\n    \n    results.extend([rms_div_before1, rms_div_after1, vel_error1])\n\n    # --- Case 2: Irrotational field ---\n    B = 0.9\n    k_x2 = 4\n    k_y2 = 5\n    \n    phi2 = B * np.cos(2 * np.pi * k_x2 * X) * np.cos(2 * np.pi * k_y2 * Y)\n    u_star2 = -B * (2 * np.pi * k_x2) * np.sin(2 * np.pi * k_x2 * X) * np.cos(2 * np.pi * k_y2 * Y)\n    v_star2 = -B * (2 * np.pi * k_y2) * np.cos(2 * np.pi * k_x2 * X) * np.sin(2 * np.pi * k_y2 * Y)\n\n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before2 = compute_rms_divergence(u_star2, v_star2, Kx, Ky)\n    \n    # Perform projection\n    u_star2_hat = np.fft.fft2(u_star2)\n    v_star2_hat = np.fft.fft2(v_star2)\n    div_u_star2_hat = 1j * Kx * u_star2_hat + 1j * Ky * v_star2_hat\n    p2_hat = - (rho0 / dt) * div_u_star2_hat * k_sq_inv\n    \n    u_np1_hat2 = u_star2_hat - (dt / rho0) * (1j * Kx * p2_hat)\n    v_np1_hat2 = v_star2_hat - (dt / rho0) * (1j * Ky * p2_hat)\n\n    u_np1_2 = np.real(np.fft.ifft2(u_np1_hat2))\n    v_np1_2 = np.real(np.fft.ifft2(v_np1_hat2))\n    \n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after2 = compute_rms_divergence(u_np1_2, v_np1_2, Kx, Ky)\n    \n    # Diagnostic 3: Velocity error norm (RMS of the final velocity)\n    vel_error2 = compute_rms_vector(u_np1_2, v_np1_2)\n    \n    results.extend([rms_div_before2, rms_div_after2, vel_error2])\n\n    # --- Case 3: Mixed field ---\n    A3 = 0.8\n    k_psi_x = 3\n    k_psi_y = 4\n    B3 = 0.7\n    k_phi_x = 5\n    k_phi_y = 2\n    \n    # Solenoidal part\n    u_psi3 = A3 * (2 * np.pi * k_psi_y) * np.sin(2 * np.pi * k_psi_x * X) * np.cos(2 * np.pi * k_psi_y * Y)\n    v_psi3 = -A3 * (2 * np.pi * k_psi_x) * np.cos(2 * np.pi * k_psi_x * X) * np.sin(2 * np.pi * k_psi_y * Y)\n    \n    # Irrotational part\n    u_phi3 = -B3 * (2 * np.pi * k_phi_x) * np.sin(2 * np.pi * k_phi_x * X) * np.cos(2 * np.pi * k_phi_y * Y)\n    v_phi3 = -B3 * (2 * np.pi * k_phi_y) * np.cos(2 * np.pi * k_phi_x * X) * np.sin(2 * np.pi * k_phi_y * Y)\n    \n    u_star3 = u_psi3 + u_phi3\n    v_star3 = v_psi3 + v_phi3\n    \n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before3 = compute_rms_divergence(u_star3, v_star3, Kx, Ky)\n    \n    # Perform projection\n    u_star3_hat = np.fft.fft2(u_star3)\n    v_star3_hat = np.fft.fft2(v_star3)\n    div_u_star3_hat = 1j * Kx * u_star3_hat + 1j * Ky * v_star3_hat\n    p3_hat = - (rho0 / dt) * div_u_star3_hat * k_sq_inv\n    \n    u_np1_hat3 = u_star3_hat - (dt / rho0) * (1j * Kx * p3_hat)\n    v_np1_hat3 = v_star3_hat - (dt / rho0) * (1j * Ky * p3_hat)\n    \n    u_np1_3 = np.real(np.fft.ifft2(u_np1_hat3))\n    v_np1_3 = np.real(np.fft.ifft2(v_np1_hat3))\n\n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after3 = compute_rms_divergence(u_np1_3, v_np1_3, Kx, Ky)\n\n    # Diagnostic 3: Velocity error norm (difference from a priori solenoidal part)\n    vel_error3 = compute_rms_vector(u_np1_3 - u_psi3, v_np1_3 - v_psi3)\n\n    results.extend([rms_div_before3, rms_div_after3, vel_error3])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}