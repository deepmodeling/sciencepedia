{
    "hands_on_practices": [
        {
            "introduction": "Scale analysis is a foundational tool in geophysical fluid dynamics, allowing us to simplify the governing equations by retaining only the dominant physical effects for a given phenomenon. This exercise will guide you through the calculation of key non-dimensional parameters—the Rossby number ($Ro$), Froude number ($Fr$), and aspect ratio ($\\epsilon$)—using characteristic scales of planetary motion. By evaluating the magnitude of these parameters, you will be able to quantitatively justify the validity of the geostrophic and hydrostatic approximations, which together form the basis of the primitive equations used in large-scale weather and climate models .",
            "id": "3925160",
            "problem": "Consider the rotating, stratified primitive equations under the Boussinesq approximation (density variations are neglected except where they multiply gravitational acceleration) and the anelastic approximation (fast acoustic waves are filtered by enforcing a divergence constraint on a reference-density-weighted velocity). These equations describe large-scale atmospheric and oceanic motions subject to Earth’s rotation via the Coriolis term and gravity via buoyancy. By non-dimensionalizing the governing equations using characteristic horizontal velocity scale $U$, horizontal length scale $L$, vertical length scale $H$, Coriolis parameter $f$, and gravitational acceleration $g$, one obtains a set of canonical non-dimensional parameters that measure the relative importance of terms: a rotational parameter (Rossby number), a gravitational-wave parameter (Froude number), and an aspect ratio that encodes the thinness of the fluid layer.\n\nUsing characteristic planetary midlatitude values $U \\sim 10\\,\\mathrm{m\\,s^{-1}}$, $L \\sim 10^{6}\\,\\mathrm{m}$, $H \\sim 10^{4}\\,\\mathrm{m}$, $f \\sim 10^{-4}\\,\\mathrm{s^{-1}}$, and taking $g=9.81\\,\\mathrm{m\\,s^{-2}}$, do the following:\n- Starting from the rotating Boussinesq primitive equations and dimensional reasoning, identify the three leading non-dimensional parameters that distinguish rotational, gravitational, and geometric effects. Then, using the values above, compute their numerical values.\n- Based on your results, reason from first principles whether the hydrostatic balance (vertical pressure gradient balancing buoyancy) and the geostrophic balance (Coriolis force balancing horizontal pressure gradient) are appropriate leading-order approximations for these planetary scales.\n\nExpress your final numerical results as a single row vector in the order $\\left(Ro, Fr, \\epsilon\\right)$, where $Ro$ is the Rossby number, $Fr$ is the shallow-water Froude number, and $\\epsilon$ is the aspect ratio. Round each entry to three significant figures. The entries are dimensionless and should be reported without units.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and internally consistent. It provides all necessary information to identify and compute the required non-dimensional parameters and to assess the validity of the geostrophic and hydrostatic approximations for the specified physical scales. Therefore, the problem is deemed valid and a full solution is provided below.\n\nThe problem asks for the identification and calculation of three key non-dimensional parameters governing large-scale planetary flows, and an assessment of two fundamental dynamical balances based on these parameters. The analysis starts from the primitive equations under the Boussinesq approximation.\n\nFirst, we identify the three non-dimensional parameters through dimensional analysis of the governing forces and geometry. The characteristic scales are given as horizontal velocity $U$, horizontal length $L$, vertical length $H$, Coriolis parameter $f$, and gravitational acceleration $g$.\n\nThe Rossby Number ($Ro$):\nThe Rossby number measures the ratio of inertial forces to the Coriolis force. The horizontal momentum equation in the rotating frame is, ignoring friction:\n$$ \\frac{D\\mathbf{u}_h}{Dt} = - f \\mathbf{k} \\times \\mathbf{u}_h - \\frac{1}{\\rho_0} \\nabla_h p $$\nwhere $\\mathbf{u}_h$ is the horizontal velocity vector, $\\mathbf{k}$ is the unit vector in the vertical direction, and $p$ is the pressure. The material derivative is $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla$. The inertial acceleration term, $\\frac{D\\mathbf{u}_h}{Dt}$, is dominated by the advective part $\\mathbf{u}_h \\cdot \\nabla_h \\mathbf{u}_h$, which scales as $\\frac{U^2}{L}$. The Coriolis acceleration term, $f \\mathbf{k} \\times \\mathbf{u}_h$, scales as $fU$.\nThe ratio of these two terms defines the Rossby number:\n$$ Ro = \\frac{|\\text{Inertial Force}|}{|\\text{Coriolis Force}|} \\sim \\frac{U^2/L}{fU} = \\frac{U}{fL} $$\n\nThe Froude Number ($Fr$):\nThe Froude number compares the kinetic energy of the flow to the potential energy associated with gravity waves. For a fluid of depth $H$, the speed of long, or shallow-water, external gravity waves is $c = \\sqrt{gH}$. The Froude number is the ratio of the characteristic flow speed $U$ to this wave speed. The problem specifies the \"shallow-water Froude number\" in the output format, confirming this definition.\n$$ Fr = \\frac{U}{c} = \\frac{U}{\\sqrt{gH}} $$\nThis parameter is often seen in its squared form, $Fr^2 = U^2/(gH)$, which represents the ratio of kinetic energy to potential energy.\n\nThe Aspect Ratio ($\\epsilon$):\nThis parameter is a purely geometric ratio that describes the thinness of the fluid domain. It is defined as the ratio of the characteristic vertical length scale $H$ to the characteristic horizontal length scale $L$.\n$$ \\epsilon = \\frac{H}{L} $$\n\nNext, we compute the numerical values of these parameters using the provided characteristic scales for planetary midlatitude motions:\n$U = 10\\,\\mathrm{m\\,s^{-1}}$\n$L = 10^6\\,\\mathrm{m}$\n$H = 10^4\\,\\mathrm{m}$\n$f = 10^{-4}\\,\\mathrm{s^{-1}}$\n$g = 9.81\\,\\mathrm{m\\,s^{-2}}$\n\nCalculation of the Rossby number:\n$$ Ro = \\frac{10\\,\\mathrm{m\\,s^{-1}}}{(10^{-4}\\,\\mathrm{s^{-1}}) \\times (10^6\\,\\mathrm{m})} = \\frac{10}{10^2} = 0.1 $$\n\nCalculation of the Froude number:\nThe gravity wave speed is $c = \\sqrt{gH} = \\sqrt{(9.81\\,\\mathrm{m\\,s^{-2}}) \\times (10^4\\,\\mathrm{m})} = \\sqrt{98100}\\,\\mathrm{m\\,s^{-1}} \\approx 313.209\\,\\mathrm{m\\,s^{-1}}$.\n$$ Fr = \\frac{10\\,\\mathrm{m\\,s^{-1}}}{313.209\\,\\mathrm{m\\,s^{-1}}} \\approx 0.031927... $$\n\nCalculation of the aspect ratio:\n$$ \\epsilon = \\frac{10^4\\,\\mathrm{m}}{10^6\\,\\mathrm{m}} = 10^{-2} = 0.01 $$\n\nRounding these values to three significant figures, we get:\n$Ro = 0.100$\n$Fr \\approx 0.0319$\n$\\epsilon = 0.0100$\n\nFinally, we assess the validity of the geostrophic and hydrostatic balances.\n\nGeostrophic Balance:\nGeostrophic balance is the leading-order balance in the horizontal momentum equation between the Coriolis force and the horizontal pressure gradient force ($f \\mathbf{k} \\times \\mathbf{u}_h \\approx -\\frac{1}{\\rho_0} \\nabla_h p$). This balance holds when the inertial forces are much smaller than the Coriolis force. The Rossby number, $Ro$, precisely quantifies this ratio. Our calculated value is $Ro = 0.100$. Since $Ro \\ll 1$, the inertial terms are an order of magnitude smaller than the Coriolis and pressure gradient terms. Therefore, geostrophic balance is an appropriate and accurate leading-order approximation for describing large-scale planetary flows at these scales.\n\nHydrostatic Balance:\nHydrostatic balance is the leading-order balance in the vertical momentum equation between the vertical pressure gradient force and gravity ($\\frac{\\partial p}{\\partial z} \\approx -\\rho g$). This approximation is valid when the vertical acceleration is negligible compared to the forces that dominate the vertical balance.\nThe primary reason for the validity of the hydrostatic approximation in large-scale atmospheric and oceanic flows is the small aspect ratio, $\\epsilon = H/L$. We calculated $\\epsilon = 0.0100$.\nA small aspect ratio implies that the geometry of the flow is a thin sheet. By the continuity equation for an incompressible or anelastic fluid ($\\nabla \\cdot \\mathbf{u} \\approx 0$), the scaling for vertical velocity $W$ is related to the horizontal velocity $U$ by $W \\sim U(H/L) = U\\epsilon$.\nThe vertical acceleration scales as $W/T \\sim W(U/L) \\sim (U\\epsilon)(U/L) = U^2\\epsilon/L = U^2 H /L^2$. The forces in the vertical balance (pressure gradient and gravity) are of order $g$. The ratio of vertical acceleration to gravity is $\\frac{U^2 H / L^2}{g} = \\frac{U^2}{gH} \\frac{H^2}{L^2} = Fr^2 \\epsilon^2$.\nWith our values, this ratio is approximately $(0.0319)^2 \\times (0.01)^2 \\approx 10^{-3} \\times 10^{-4} = 10^{-7}$, which is exceptionally small.\nMore directly, looking at the non-dimensional vertical momentum equation reveals that the vertical acceleration term is scaled by a factor of $\\epsilon^2 = (0.01)^2 = 10^{-4}$ relative to the main balancing terms (pressure gradient and gravity). Since $\\epsilon^2 \\ll 1$, the vertical acceleration is dynamically insignificant. Thus, hydrostatic balance is an extremely accurate approximation for these planetary scales.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.100 & 0.0319 & 0.0100 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "The stability of a stratified fluid to vertical displacements is quantified by the Brunt-Väisälä frequency, $N$, a critical parameter that governs the behavior of internal gravity waves. This practice contrasts the calculation of the squared frequency, $N^2$, in the atmosphere (using the anelastic approximation) and the ocean (using the Boussinesq approximation). By working through these distinct physical settings, you will not only practice calculating static stability but also develop a deeper understanding of how the differing treatments of density in the anelastic and Boussinesq frameworks lead to fundamental differences in the vertical structure and properties of internal waves .",
            "id": "3925142",
            "problem": "Consider two stably stratified geophysical fluids described by the hydrostatic primitive equations under the appropriate density treatments. In the atmosphere, assume the anelastic approximation (density variations retained in buoyancy but filtered from sound waves), while in the ocean, assume the Boussinesq approximation (constant reference density except in buoyancy).\n\nAtmospheric case (anelastic, hydrostatic): A dry troposphere has background potential temperature $\\Theta(z)$ that increases linearly with altitude $z$, where $z$ is measured upward from the surface. The profile is $\\Theta(z) = \\Theta_{0} + \\Gamma_{\\theta} z$ with $\\Theta_{0} = 300 \\ \\mathrm{K}$ and $\\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}}$. Gravity is constant with $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$. Assume large-scale motions satisfying hydrostatic balance and small-amplitude perturbations about this background.\n\nOceanic case (Boussinesq, hydrostatic): An upper-ocean pycnocline has density decreasing linearly with height $z$ (which is measured upward, with $z=0$ at the mean sea surface). Between depths $z=-200 \\ \\mathrm{m}$ and $z=-100 \\ \\mathrm{m}$, the potential density decreases from $1024 \\ \\mathrm{kg \\ m^{-3}}$ to $1022 \\ \\mathrm{kg \\ m^{-3}}$ in a linear manner with $z$. Use a constant reference density $\\rho_{0} = 1025 \\ \\mathrm{kg \\ m^{-3}}$ and the same gravity $g$.\n\nTasks:\n1. Starting from the hydrostatic primitive equations and fundamental definitions appropriate to each approximation, derive the expression for the squared Brunt–Väisälä frequency $N^{2}$ for each case (atmosphere: in terms of the potential temperature gradient; ocean: in terms of the background density gradient).\n2. Evaluate the resulting $N^{2}$ for the tropospheric profile and for the ocean pycnocline. Express each $N^{2}$ in $\\mathrm{s^{-2}}$.\n3. Using your computed values, determine the dimensionless ratio $R = N^{2}_{\\mathrm{ocean}} / N^{2}_{\\mathrm{trop}}$. Express your final answer for $R$ as a single real number and round it to four significant figures.\n\nIn your solution, also discuss how the magnitude of $N^{2}$ influences the internal mode structure (vertical eigenfunctions and frequencies) in the hydrostatic primitive equations under the anelastic approximation (atmosphere) versus under the Boussinesq approximation (ocean), highlighting any differences in the weighting of vertical modes due to the respective density treatments. The discussion is not part of the final numerical answer.",
            "solution": "The problem asks for the derivation and evaluation of the squared Brunt–Väisälä frequency, $N^2$, for a specified atmospheric and oceanic case, the calculation of their ratio, and a discussion on the implications for internal wave modes.\n\nThe problem is scientifically grounded, well-posed, and objective. It is based on fundamental principles of geophysical fluid dynamics (hydrostatic balance, Boussinesq and anelastic approximations, static stability). The provided data is self-consistent and sufficient for a unique solution. The problem is therefore deemed valid and a solution will be provided.\n\n### Part 1: Derivation of the Brunt–Väisälä Frequency ($N^2$)\n\nThe squared Brunt–Väisälä frequency, $N^2$, represents the square of the natural frequency of vertical oscillation for a fluid parcel displaced adiabatically from its equilibrium position in a statically stable, stratified fluid. The general derivation starts from considering the vertical acceleration of such a parcel. The net vertical force per unit volume on the parcel is the buoyancy force, given by $-g(\\rho_p - \\rho_e)$, where $g$ is the acceleration due to gravity, $\\rho_p$ is the parcel's density, and $\\rho_e$ is the density of the surrounding environment.\n\nFor a small vertical displacement $\\delta z$, the equation of motion is:\n$$ \\rho_p \\frac{d^2(\\delta z)}{dt^2} = -g(\\rho_p - \\rho_e(z+\\delta z)) $$\nBy linearizing and applying the appropriate thermodynamic constraints for each fluid system, we can derive the expression for $N^2$.\n\n**A. Atmospheric Case (Anelastic, Hydrostatic)**\n\nIn the anelastic approximation for a dry atmosphere, density variations are important for buoyancy but are filtered from acoustic effects. The state of a fluid parcel is best described by its potential temperature, $\\Theta$, which is conserved during adiabatic displacements.\n\nLet the background state be characterized by a potential temperature profile $\\Theta(z)$. A parcel at equilibrium at height $z$ has potential temperature $\\Theta(z)$. If this parcel is displaced vertically by a small distance $\\delta z$ to a new height $z + \\delta z$, its potential temperature remains $\\Theta(z)$. The surrounding environment at this new height has a potential temperature of $\\Theta(z + \\delta z) \\approx \\Theta(z) + \\frac{d\\Theta}{dz}\\delta z$.\n\nThe buoyancy force in the anelastic system is proportional to the potential temperature difference. The vertical acceleration $a = d^2(\\delta z)/dt^2$ is given by:\n$$ a = g \\frac{\\Theta_{\\text{parcel}} - \\Theta_{\\text{env}}}{\\Theta_{\\text{ref}}} $$\nHere, $\\Theta_{\\text{parcel}} = \\Theta(z)$ and $\\Theta_{\\text{env}} = \\Theta(z + \\delta z)$. $\\Theta_{\\text{ref}}$ is a constant reference potential temperature. Thus,\n$$ a = g \\frac{\\Theta(z) - \\left(\\Theta(z) + \\frac{d\\Theta}{dz}\\delta z\\right)}{\\Theta_{\\text{ref}}} = - \\left(\\frac{g}{\\Theta_{\\text{ref}}} \\frac{d\\Theta}{dz}\\right) \\delta z $$\nThis is the equation for simple harmonic motion, $\\frac{d^2(\\delta z)}{dt^2} = -N^2 \\delta z$. By comparison, the squared Brunt–Väisälä frequency for the atmosphere is:\n$$ N^2 = \\frac{g}{\\Theta_{\\text{ref}}} \\frac{d\\Theta}{dz} $$\nFor the given problem, the reference potential temperature is $\\Theta_{0}$, and the gradient is $\\Gamma_{\\theta}$.\n$$ N^2_{\\mathrm{trop}} = \\frac{g}{\\Theta_{0}} \\frac{d\\Theta}{dz} $$\n\n**B. Oceanic Case (Boussinesq, Hydrostatic)**\n\nIn the Boussinesq approximation, the density $\\rho$ is treated as a constant reference value $\\rho_0$ in the momentum equation, except in the buoyancy term where its variations are critical. For analyzing stability, we use potential density, which is conserved for a parcel moving adiabatically. The problem refers to this as \"potential density,\" which we will denote as $\\rho(z)$.\n\nConsider a parcel at equilibrium at height $z$ with potential density $\\rho(z)$. When displaced to $z + \\delta z$, it retains this density. The environment at $z + \\delta z$ has a density of $\\rho(z + \\delta z) \\approx \\rho(z) + \\frac{d\\rho}{dz}\\delta z$.\n\nThe buoyancy force per unit mass on the parcel is $-g(\\rho_{\\text{parcel}} - \\rho_{\\text{env}})/\\rho_0$. The equation of motion is:\n$$ \\frac{d^2(\\delta z)}{dt^2} = -g \\frac{\\rho(z) - \\left(\\rho(z) + \\frac{d\\rho}{dz}\\delta z\\right)}{\\rho_0} = -g \\frac{-\\frac{d\\rho}{dz}\\delta z}{\\rho_0} = \\left(\\frac{g}{\\rho_0} \\frac{d\\rho}{dz}\\right) \\delta z $$\nFor a stable stratification, density must decrease with height, so $d\\rho/dz < 0$. This gives rise to a restoring force. The equation is of the form $\\frac{d^2(\\delta z)}{dt^2} = -N^2 \\delta z$. By comparison, the squared Brunt–Väisälä frequency for the ocean is:\n$$ N^2_{\\mathrm{ocean}} = -\\frac{g}{\\rho_0} \\frac{d\\rho}{dz} $$\n\n\n### Part 2: Evaluation of $N^2$\n\n**A. Atmospheric Case**\n\nGiven data:\n- $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$\n- $\\Theta(z) = \\Theta_{0} + \\Gamma_{\\theta} z$\n- $\\Theta_{0} = 300 \\ \\mathrm{K}$\n- $\\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}}$\n\nFirst, we convert the units of $\\Gamma_{\\theta}$:\n$$ \\Gamma_{\\theta} = 3 \\ \\mathrm{K \\ km^{-1}} = 3 \\ \\frac{\\mathrm{K}}{1000 \\ \\mathrm{m}} = 0.003 \\ \\mathrm{K \\ m^{-1}} $$\nThe gradient of potential temperature is constant: $\\frac{d\\Theta}{dz} = \\Gamma_{\\theta} = 0.003 \\ \\mathrm{K \\ m^{-1}}$.\n\nUsing the derived formula with $\\Theta_{\\text{ref}} = \\Theta_0$:\n$$ N^2_{\\mathrm{trop}} = \\frac{g}{\\Theta_0} \\frac{d\\Theta}{dz} = \\frac{9.81 \\ \\mathrm{m \\ s^{-2}}}{300 \\ \\mathrm{K}} \\times 0.003 \\ \\mathrm{K \\ m^{-1}} $$\n$$ N^2_{\\mathrm{trop}} = \\frac{9.81 \\times 0.003}{300} \\ \\mathrm{s^{-2}} = \\frac{0.02943}{300} \\ \\mathrm{s^{-2}} = 9.81 \\times 10^{-5} \\ \\mathrm{s^{-2}} $$\n\n**B. Oceanic Case**\n\nGiven data:\n- $g = 9.81 \\ \\mathrm{m \\ s^{-2}}$\n- $\\rho_0 = 1025 \\ \\mathrm{kg \\ m^{-3}}$\n- At $z_1 = -200 \\ \\mathrm{m}$, $\\rho_1 = 1024 \\ \\mathrm{kg \\ m^{-3}}$\n- At $z_2 = -100 \\ \\mathrm{m}$, $\\rho_2 = 1022 \\ \\mathrm{kg \\ m^{-3}}$\n\nThe density profile is linear, so the gradient $\\frac{d\\rho}{dz}$ is constant:\n$$ \\frac{d\\rho}{dz} = \\frac{\\rho_2 - \\rho_1}{z_2 - z_1} = \\frac{1022 \\ \\mathrm{kg \\ m^{-3}} - 1024 \\ \\mathrm{kg \\ m^{-3}}}{-100 \\ \\mathrm{m} - (-200 \\ \\mathrm{m})} = \\frac{-2 \\ \\mathrm{kg \\ m^{-3}}}{100 \\ \\mathrm{m}} = -0.02 \\ \\mathrm{kg \\ m^{-4}} $$\nThis negative gradient confirms that the pycnocline is stably stratified.\n\nUsing the derived formula:\n$$ N^2_{\\mathrm{ocean}} = -\\frac{g}{\\rho_0} \\frac{d\\rho}{dz} = -\\frac{9.81 \\ \\mathrm{m \\ s^{-2}}}{1025 \\ \\mathrm{kg \\ m^{-3}}} \\times (-0.02 \\ \\mathrm{kg \\ m^{-4}}) $$\n$$ N^2_{\\mathrm{ocean}} = \\frac{9.81 \\times 0.02}{1025} \\ \\mathrm{s^{-2}} = \\frac{0.1962}{1025} \\ \\mathrm{s^{-2}} \\approx 1.914146 \\times 10^{-4} \\ \\mathrm{s^{-2}} $$\n\n### Part 3: Dimensionless Ratio $R$\n\nThe dimensionless ratio $R$ is defined as $R = N^{2}_{\\mathrm{ocean}} / N^{2}_{\\mathrm{trop}}$.\n$$ R = \\frac{1.914146 \\times 10^{-4} \\ \\mathrm{s^{-2}}}{9.81 \\times 10^{-5} \\ \\mathrm{s^{-2}}} $$\nAlternatively, we can compute the ratio symbolically before substituting values:\n$$ R = \\frac{-\\frac{g}{\\rho_0} \\frac{d\\rho}{dz}}{\\frac{g}{\\Theta_0} \\frac{d\\Theta}{dz}} = \\frac{-\\frac{d\\rho}{dz}/\\rho_0}{\\frac{d\\Theta}{dz}/\\Theta_0} = \\frac{-(-0.02 \\ \\mathrm{kg \\ m^{-4}}) / (1025 \\ \\mathrm{kg \\ m^{-3}})}{(0.003 \\ \\mathrm{K \\ m^{-1}}) / (300 \\ \\mathrm{K})} $$\n$$ R = \\frac{0.02 / 1025}{0.003 / 300} = \\frac{0.02}{1025} \\times \\frac{300}{0.003} = \\frac{2 \\times 10^{-2}}{1025} \\times \\frac{3 \\times 10^2}{3 \\times 10^{-3}} = \\frac{2 \\times 10^{-2}}{1025} \\times 10^5 = \\frac{2000}{1025} $$\n$$ R = \\frac{80}{41} \\approx 1.9512195... $$\nRounding to four significant figures, we get $R = 1.951$.\n\n### Part 4: Discussion on Internal Mode Structure\n\nThe magnitude of the Brunt-Väisälä frequency $N^2$ is central to the dynamics of internal gravity waves. The vertical structure of these waves is typically governed by a second-order ordinary differential equation, which takes different forms under the anelastic and Boussinesq approximations.\n\nIn both systems, $N(z)$ defines the local upper frequency limit for freely propagating internal waves, meaning wave frequencies $\\omega$ must satisfy $\\omega^2 \\leq N^2(z)$. Our calculation shows that for the given profiles, $N^2_{\\mathrm{ocean}} > N^2_{\\mathrm{trop}}$, implying the oceanic pycnocline supports higher-frequency internal waves than the specified tropospheric layer. For a given horizontal wavenumber, a larger $N^2$ also leads to a larger vertical wavenumber, corresponding to a shorter vertical wavelength.\n\nThe more fundamental difference in the internal mode structure arises from the treatment of the background density, $\\rho_0(z)$.\n\n**Boussinesq Approximation (Ocean):** The density $\\rho_0$ is treated as constant. For a constant $N$, the vertical structure equation for vertical velocity $w$ is $\\frac{d^2 w}{dz^2} + k_z^2 w = 0$, where $k_z^2 = k_h^2(N^2 - \\omega^2)/\\omega^2$. The solutions (eigenfunctions) are simple sinusoids, e.g., $w(z) = W_m \\sin(m\\pi z/H)$ for a domain of height $H$. The amplitude of vertical velocity and displacement is uniform with height for a given mode. This approximation is valid when the vertical scale of motion is much smaller than the density scale height, a condition often met in the ocean.\n\n**Anelastic Approximation (Atmosphere):** The background density $\\rho_0(z)$ varies significantly with height, typically decreasing exponentially, $\\rho_0(z) \\approx \\rho_{0s}\\exp(-z/H_{\\rho})$, where $H_{\\rho}$ is the density scale height (approx. $8$ km). The governing vertical structure equation is more complex and is often written for a density-weighted variable, such as $\\psi = \\sqrt{\\rho_0(z)} w$. This transforms the equation into a Schrödinger-like form: $\\frac{d^2 \\psi}{dz^2} + \\left[ \\frac{N^2(z)}{c^2} - \\frac{1}{4H_{\\rho}^2} \\right] \\psi = 0$ (for vertical propagation, where $c$ is the horizontal phase speed).\n\nThe key implication of the $\\sqrt{\\rho_0(z)}$ weighting is that for the eigenfunctions $\\psi(z)$ to remain bounded, the physical vertical velocity $w(z) = \\psi(z)/\\sqrt{\\rho_0(z)}$ must grow with height as $\\exp(z/2H_{\\rho})$. This means that atmospheric internal waves have velocity and displacement amplitudes that are significantly larger at higher altitudes where density is lower. This amplication ensures that the wave kinetic energy density, $\\frac{1}{2}\\rho_0(z) w^2 = \\frac{1}{2}\\psi^2$, does not grow unboundedly. In contrast, under the Boussinesq approximation, the vertical structure of kinetic energy density $\\frac{1}{2}\\rho_0 w^2$ is identical to that of $w^2$. This fundamental difference in the weighting of vertical modes means that atmospheric waves tend to have their largest expression and transport effects at high altitudes, while oceanic internal waves are less vertically skewed in their amplitude structure.",
            "answer": "$$\n\\boxed{1.951}\n$$"
        },
        {
            "introduction": "Moving from theory to practice, this exercise delves into the numerical implementation of the Boussinesq approximation, where the incompressibility constraint $\\nabla \\cdot \\mathbf{u} = 0$ must be rigorously enforced. You will derive and implement a spectral projection method, a cornerstone algorithm in computational fluid dynamics, which uses a pressure field to project a velocity field onto the space of divergence-free fields. This hands-on coding task involves solving a Pressure Poisson Equation in Fourier space, providing direct experience with how numerical models ensure that mass is conserved in incompressible flows .",
            "id": "3925134",
            "problem": "You are tasked with designing and implementing a projection method for two-dimensional Boussinesq flow under the incompressible primitive equations, using a periodic domain and a spectral discretization with the Fast Fourier Transform (FFT). The aim is to enforce the divergence-free constraint by correcting a tentative velocity via a pressure solve. All quantities in this problem are nondimensional. Your implementation must be a single, self-contained program that, for a set of prescribed test cases, computes specified numerical diagnostics and outputs them in a single line as a comma-separated list enclosed in square brackets.\n\nBegin from the fundamental laws and core definitions appropriate to incompressible Boussinesq flow. In the Boussinesq approximation with constant reference density, the mass continuity equation reduces to the incompressibility constraint $\\nabla \\cdot \\mathbf{u} = 0$, and the momentum is subject to pressure gradients that dynamically enforce this constraint. In a projection method, one constructs a tentative velocity $\\mathbf{u}^{\\ast}$ by stepping the momentum equation without the pressure gradient and then corrects $\\mathbf{u}^{\\ast}$ using a pressure field so that the corrected velocity satisfies $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$. Your task is to derive the required pressure equation from these principles and implement a solver consistent with a two-dimensional periodic square domain and spectral differentiation.\n\nDomain and discretization requirements:\n\n- Use a two-dimensional square periodic domain of side length $L = 1$. Let spatial coordinates be $x \\in [0,1)$ and $y \\in [0,1)$.\n- Discretize on a uniform grid of $N_x \\times N_y$ points, with $N_x = 64$ and $N_y = 64$.\n- Use a time step $\\Delta t = 0.05$.\n- Assume constant reference density $\\rho_0 = 1$.\n- Use spectral differentiation via the Fast Fourier Transform (FFT), and periodic boundary conditions in both directions. Define Fourier wavenumbers using the standard conventions for the FFT on a domain of length $1$ so that differentiation in Fourier space corresponds to multiplication by $\\mathrm{i} k$, where $k$ is the wavenumber.\n\nProjection method specification:\n\n- Construct a tentative velocity $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ for each test case as prescribed below.\n- Derive the pressure equation implied by enforcing $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ after correcting $\\mathbf{u}^{\\ast}$ with a pressure gradient over one time step $\\Delta t$.\n- Implement a spectral Poisson solver for the pressure that is consistent with periodic boundary conditions. Fix the mean of the pressure to zero by setting the zero Fourier mode appropriately.\n- Correct the tentative velocity using the computed pressure so that the corrected velocity $\\mathbf{u}^{n+1}$ is (to numerical precision) divergence-free under the same spectral differentiation.\n\nTest suite (three cases):\n\nLet $k_x$ and $k_y$ denote integer wavenumbers, and use trigonometric fields defined on the domain with arguments scaled by $2\\pi$ to ensure periodicity, for example $\\sin(2\\pi k_x x)$.\n\nCase $1$ (already solenoidal):\n- Define a streamfunction $\\psi(x,y) = A \\sin(2\\pi k_x x)\\sin(2\\pi k_y y)$ with $A = 1.2$, $k_x = 2$, and $k_y = 3$.\n- Define $u^{\\ast} = \\partial \\psi/\\partial y$ and $v^{\\ast} = -\\partial \\psi/\\partial x$. This field is exactly divergence-free by construction.\n\nCase $2$ (purely irrotational):\n- Define a potential $\\phi(x,y) = B \\cos(2\\pi k_x x)\\cos(2\\pi k_y y)$ with $B = 0.9$, $k_x = 4$, and $k_y = 5$.\n- Define $u^{\\ast} = \\partial \\phi/\\partial x$ and $v^{\\ast} = \\partial \\phi/\\partial y$. This field is purely a gradient field and has nonzero divergence.\n\nCase $3$ (mixed irrotational and solenoidal):\n- Define a streamfunction $\\psi(x,y) = A_3 \\sin(2\\pi k^{\\psi}_x x)\\sin(2\\pi k^{\\psi}_y y)$ with $A_3 = 0.8$, $k^{\\psi}_x = 3$, and $k^{\\psi}_y = 4$.\n- Define a potential $\\phi(x,y) = B_3 \\cos(2\\pi k^{\\phi}_x x)\\cos(2\\pi k^{\\phi}_y y)$ with $B_3 = 0.7$, $k^{\\phi}_x = 5$, and $k^{\\phi}_y = 2$.\n- Define $u^{\\ast} = \\partial \\psi/\\partial y + \\partial \\phi/\\partial x$ and $v^{\\ast} = -\\partial \\psi/\\partial x + \\partial \\phi/\\partial y$.\n\nRequired diagnostics:\n\nFor each case, compute the following diagnostics using spectral derivatives:\n\n- The root-mean-square (RMS) of the divergence of $\\mathbf{u}^{\\ast}$ before projection, defined as $\\sqrt{\\langle(\\nabla \\cdot \\mathbf{u}^{\\ast})^2\\rangle}$, where $\\langle\\cdot\\rangle$ denotes the spatial average over the grid.\n- The RMS of the divergence of the corrected velocity $\\mathbf{u}^{n+1}$ after projection.\n- A velocity error norm that quantifies whether the projection yields the theoretically expected solenoidal field:\n  - Case $1$: the RMS of the difference $\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}$.\n  - Case $2$: the RMS of $\\mathbf{u}^{n+1}$, since the projected solenoidal component of a pure gradient field on a periodic domain should be zero.\n  - Case $3$: the RMS of the difference between $\\mathbf{u}^{n+1}$ and the solenoidal component computed from the streamfunction alone, namely $(\\partial \\psi/\\partial y, -\\partial \\psi/\\partial x)$.\n\nAll calculations must use spectral derivatives via the Fourier transform and must be performed consistently on the given grid and domain.\n\nFinal output format:\n\nYour program should produce a single line of output containing the $9$ floating-point results ordered as\n`[divergence_before_case1, divergence_after_case1, velocity_error_case1, divergence_before_case2, divergence_after_case2, velocity_error_case2, divergence_before_case3, divergence_after_case3, velocity_error_case3]`.\nThe numbers must be printed as a comma-separated list enclosed in square brackets, with no additional text.\n\nAngle units: All trigonometric functions use arguments in radians.\n\nPhysical units: Not applicable, all variables are nondimensional.\n\nYour implementation must be self-contained and must not require any input; it must define the test cases internally and print the final comma-separated list. The FFT-based projection and diagnostic computations must follow from the fundamental laws stated at the beginning and your derivation of the pressure equation and correction step. Ensure scientific realism and internal consistency; the program must be runnable as-is in a modern environment supporting numerical arrays and FFTs.",
            "solution": "The problem requires the design and implementation of a projection method for two-dimensional incompressible Boussinesq flow on a periodic domain, using a spectral discretization. The core task is to enforce the divergence-free condition $\\nabla \\cdot \\mathbf{u} = 0$ by solving for a pressure field that corrects a tentative velocity field.\n\nThe projection method consists of two main steps. First, a tentative velocity, $\\mathbf{u}^{\\ast}$, is obtained. In a full time-stepping scheme, this would involve advancing the momentum equation without the pressure gradient term. The problem statement provides explicit analytical forms for $\\mathbf{u}^{\\ast}$ for three test cases. Second, this tentative velocity is corrected by the gradient of a pressure-like scalar field, $p$, to yield the velocity at the new time level, $\\mathbf{u}^{n+1}$, which must be divergence-free. This correction step is expressed as:\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho_0} \\nabla p\n$$\nwhere $\\Delta t$ is the time step and $\\rho_0$ is the constant reference density.\n\nTo find the pressure $p$, we enforce the incompressibility constraint on the corrected velocity field $\\mathbf{u}^{n+1}$:\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\nSubstituting the expression for $\\mathbf{u}^{n+1}$ into the constraint gives:\n$$\n\\nabla \\cdot \\left( \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho_0} \\nabla p \\right) = 0\n$$\nRearranging the terms, we obtain the Pressure Poisson Equation (PPE):\n$$\n\\nabla^2 p = \\frac{\\rho_0}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast}\n$$\nThe right-hand side, representing the divergence of the tentative velocity, acts as the source term for the Poisson equation. Solving this equation for $p$ allows us to compute the correction and obtain the final, divergence-free velocity field $\\mathbf{u}^{n+1}$.\n\nThe problem specifies a spectral method on a two-dimensional periodic domain of side length $L=1$ with a grid of $N_x \\times N_y$ points. This context is ideal for using the Fast Fourier Transform (FFT). In Fourier space, differential operators become algebraic multiplications. A function $f(x,y)$ is represented by its Fourier coefficients $\\hat{f}(k_x, k_y)$. The operators for gradient, divergence, and Laplacian transform as follows:\n$$\n\\mathcal{F}(\\nabla f) = i\\mathbf{k} \\hat{f} = (i k_x \\hat{f}, i k_y \\hat{f})\n$$\n$$\n\\mathcal{F}(\\nabla \\cdot \\mathbf{v}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{v}} = i k_x \\hat{u} + i k_y \\hat{v}\n$$\n$$\n\\mathcal{F}(\\nabla^2 f) = -|\\mathbf{k}|^2 \\hat{f} = -(k_x^2 + k_y^2) \\hat{f}\n$$\nwhere $\\mathbf{k} = (k_x, k_y)$ is the wavenumber vector. For a domain of length $L=1$, the discrete wavenumbers corresponding to the FFT are $k_x = 2\\pi m_x$ and $k_y = 2\\pi m_y$, where $m_x$ and $m_y$ are integers from $-N/2$ to $N/2-1$.\n\nApplying the Fourier transform to the PPE yields:\n$$\n-(k_x^2 + k_y^2) \\hat{p}(k_x, k_y) = \\frac{\\rho_0}{\\Delta t} \\mathcal{F}(\\nabla \\cdot \\mathbf{u}^{\\ast}) = \\frac{\\rho_0}{\\Delta t} (i k_x \\hat{u}^{\\ast} + i k_y \\hat{v}^{\\ast})\n$$\nWe can solve for the Fourier coefficients of the pressure, $\\hat{p}$:\n$$\n\\hat{p}(k_x, k_y) = - \\frac{\\rho_0}{\\Delta t} \\frac{i k_x \\hat{u}^{\\ast} + i k_y \\hat{v}^{\\ast}}{k_x^2 + k_y^2}\n$$\nThis solution is valid for all wavenumbers where $k_x^2 + k_y^2 \\neq 0$. For the zero-wavenumber mode ($k_x=k_y=0$), the denominator is zero. This corresponds to the mean pressure, which is undetermined in a periodic domain. The problem specifies to fix this ambiguity by setting the mean pressure to zero, which is equivalent to setting $\\hat{p}(0, 0) = 0$. This is consistent, as the numerator (the mean divergence) is also zero for a periodic field whose derivatives are computed spectrally.\n\nOnce $\\hat{p}$ is known, we compute the Fourier transform of the corrected velocity, $\\hat{\\mathbf{u}}^{n+1}$, using the transformed correction equation:\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^{\\ast} - \\frac{\\Delta t}{\\rho_0} (i\\mathbf{k} \\hat{p})\n$$\nComponent-wise, this is:\n$$\n\\hat{u}^{n+1} = \\hat{u}^{\\ast} - i k_x \\frac{\\Delta t}{\\rho_0} \\hat{p}\n$$\n$$\n\\hat{v}^{n+1} = \\hat{v}^{\\ast} - i k_y \\frac{\\Delta t}{\\rho_0} \\hat{p}\n$$\nThe final corrected velocity field $\\mathbf{u}^{n+1}(x,y)$ is then recovered by applying the inverse FFT to $\\hat{\\mathbf{u}}^{n+1}$.\n\nThe required diagnostics are computed as follows:\nThe divergence of a velocity field $\\mathbf{v}=(u,v)$ is computed spectrally by taking the inverse FFT of its Fourier representation: $\\nabla \\cdot \\mathbf{v} = \\mathcal{F}^{-1}(i k_x \\hat{u} + i k_y \\hat{v})$.\nThe root-mean-square (RMS) of a quantity $F$ over the grid is defined as $\\sqrt{\\langle F^2 \\rangle}$, where $\\langle \\cdot \\rangle$ denotes the spatial average. For a vector field $\\mathbf{v}$, the RMS is $\\sqrt{\\langle |\\mathbf{v}|^2 \\rangle} = \\sqrt{\\langle u^2 + v^2 \\rangle}$.\n\nThe numerical implementation will proceed as follows for each test case:\n1.  Define the tentative velocity field $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ on the $64 \\times 64$ grid.\n2.  Compute the 2D FFT of $u^{\\ast}$ and $v^{\\ast}$ to get $\\hat{u}^{\\ast}$ and $\\hat{v}^{\\ast}$.\n3.  Compute the RMS of the divergence of $\\mathbf{u}^{\\ast}$ (Diagnostic 1).\n4.  Solve the PPE in Fourier space for $\\hat{p}$, setting $\\hat{p}(0,0)=0$.\n5.  Calculate the corrected velocity field $\\hat{\\mathbf{u}}^{n+1}$ in Fourier space.\n6.  Compute the inverse 2D FFT of $\\hat{u}^{n+1}$ and $\\hat{v}^{n+1}$ to get $u^{n+1}$ and $v^{n+1}$ in real space.\n7.  Compute the RMS of the divergence of $\\mathbf{u}^{n+1}$ (Diagnostic 2), which is expected to be near machine precision.\n8.  Compute the specialized velocity error norm for the case (Diagnostic 3). This involves comparing $\\mathbf{u}^{n+1}$ to the known solenoidal component of the initial field.\n\nThis systematic procedure, based firmly on the principles of incompressible fluid dynamics and Fourier analysis, ensures a correct and verifiable solution.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a spectral projection method for 2D incompressible Boussinesq flow\n    and computes specified diagnostics for three test cases.\n    \"\"\"\n    # Domain and discretization parameters\n    L = 1.0\n    Nx = 64\n    Ny = 64\n    \n    # Physical and numerical parameters\n    dt = 0.05\n    rho0 = 1.0\n    \n    # Create spatial grid\n    x = np.arange(Nx) / Nx * L\n    y = np.arange(Ny) / Ny * L\n    X, Y = np.meshgrid(x, y, indexing='ij')\n    \n    # Create wavenumber grids\n    kx_1d = 2 * np.pi * np.fft.fftfreq(Nx, d=L/Nx)\n    ky_1d = 2 * np.pi * np.fft.fftfreq(Ny, d=L/Ny)\n    Kx, Ky = np.meshgrid(kx_1d, ky_1d, indexing='ij')\n    \n    # Squared wavenumber magnitude, handling the k=0 case for division later\n    k_sq = Kx**2 + Ky**2\n    k_sq_inv = np.zeros_like(k_sq)\n    nonzero_k = k_sq != 0\n    k_sq_inv[nonzero_k] = 1.0 / k_sq[nonzero_k]\n\n    def compute_rms_divergence(u, v, Kx, Ky):\n        \"\"\"Computes RMS of divergence using spectral derivatives.\"\"\"\n        u_hat = np.fft.fft2(u)\n        v_hat = np.fft.fft2(v)\n        div_hat = 1j * Kx * u_hat + 1j * Ky * v_hat\n        div = np.real(np.fft.ifft2(div_hat))\n        return np.sqrt(np.mean(div**2))\n\n    def compute_rms_vector(u, v):\n        \"\"\"Computes RMS of a vector field.\"\"\"\n        return np.sqrt(np.mean(u**2 + v**2))\n\n    results = []\n\n    # --- Case 1: Solenoidal field ---\n    A = 1.2\n    k_x1 = 2\n    k_y1 = 3\n    \n    # Define tentative velocity u_star (already divergence-free)\n    psi1 = A * np.sin(2 * np.pi * k_x1 * X) * np.sin(2 * np.pi * k_y1 * Y)\n    u_star1 = A * (2 * np.pi * k_y1) * np.sin(2 * np.pi * k_x1 * X) * np.cos(2 * np.pi * k_y1 * Y)\n    v_star1 = -A * (2 * np.pi * k_x1) * np.cos(2 * np.pi * k_x1 * X) * np.sin(2 * np.pi * k_y1 * Y)\n    \n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before1 = compute_rms_divergence(u_star1, v_star1, Kx, Ky)\n    \n    # Perform projection\n    u_star1_hat = np.fft.fft2(u_star1)\n    v_star1_hat = np.fft.fft2(v_star1)\n    div_u_star1_hat = 1j * Kx * u_star1_hat + 1j * Ky * v_star1_hat\n    p1_hat = - (rho0 / dt) * div_u_star1_hat * k_sq_inv\n    \n    u_np1_hat1 = u_star1_hat - (dt / rho0) * (1j * Kx * p1_hat)\n    v_np1_hat1 = v_star1_hat - (dt / rho0) * (1j * Ky * p1_hat)\n    \n    u_np1_1 = np.real(np.fft.ifft2(u_np1_hat1))\n    v_np1_1 = np.real(np.fft.ifft2(v_np1_hat1))\n    \n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after1 = compute_rms_divergence(u_np1_1, v_np1_1, Kx, Ky)\n    \n    # Diagnostic 3: Velocity error norm\n    vel_error1 = compute_rms_vector(u_np1_1 - u_star1, v_np1_1 - v_star1)\n    \n    results.extend([rms_div_before1, rms_div_after1, vel_error1])\n\n    # --- Case 2: Irrotational field ---\n    B = 0.9\n    k_x2 = 4\n    k_y2 = 5\n    \n    phi2 = B * np.cos(2 * np.pi * k_x2 * X) * np.cos(2 * np.pi * k_y2 * Y)\n    u_star2 = -B * (2 * np.pi * k_x2) * np.sin(2 * np.pi * k_x2 * X) * np.cos(2 * np.pi * k_y2 * Y)\n    v_star2 = -B * (2 * np.pi * k_y2) * np.cos(2 * np.pi * k_x2 * X) * np.sin(2 * np.pi * k_y2 * Y)\n\n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before2 = compute_rms_divergence(u_star2, v_star2, Kx, Ky)\n    \n    # Perform projection\n    u_star2_hat = np.fft.fft2(u_star2)\n    v_star2_hat = np.fft.fft2(v_star2)\n    div_u_star2_hat = 1j * Kx * u_star2_hat + 1j * Ky * v_star2_hat\n    p2_hat = - (rho0 / dt) * div_u_star2_hat * k_sq_inv\n    \n    u_np1_hat2 = u_star2_hat - (dt / rho0) * (1j * Kx * p2_hat)\n    v_np1_hat2 = v_star2_hat - (dt / rho0) * (1j * Ky * p2_hat)\n\n    u_np1_2 = np.real(np.fft.ifft2(u_np1_hat2))\n    v_np1_2 = np.real(np.fft.ifft2(v_np1_hat2))\n    \n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after2 = compute_rms_divergence(u_np1_2, v_np1_2, Kx, Ky)\n    \n    # Diagnostic 3: Velocity error norm (RMS of the final velocity)\n    vel_error2 = compute_rms_vector(u_np1_2, v_np1_2)\n    \n    results.extend([rms_div_before2, rms_div_after2, vel_error2])\n\n    # --- Case 3: Mixed field ---\n    A3 = 0.8\n    k_psi_x = 3\n    k_psi_y = 4\n    B3 = 0.7\n    k_phi_x = 5\n    k_phi_y = 2\n    \n    # Solenoidal part\n    u_psi3 = A3 * (2 * np.pi * k_psi_y) * np.sin(2 * np.pi * k_psi_x * X) * np.cos(2 * np.pi * k_psi_y * Y)\n    v_psi3 = -A3 * (2 * np.pi * k_psi_x) * np.cos(2 * np.pi * k_psi_x * X) * np.sin(2 * np.pi * k_psi_y * Y)\n    \n    # Irrotational part\n    u_phi3 = -B3 * (2 * np.pi * k_phi_x) * np.sin(2 * np.pi * k_phi_x * X) * np.cos(2 * np.pi * k_phi_y * Y)\n    v_phi3 = -B3 * (2 * np.pi * k_phi_y) * np.cos(2 * np.pi * k_phi_x * X) * np.sin(2 * np.pi * k_phi_y * Y)\n    \n    u_star3 = u_psi3 + u_phi3\n    v_star3 = v_psi3 + v_phi3\n    \n    # Diagnostic 1: RMS divergence before projection\n    rms_div_before3 = compute_rms_divergence(u_star3, v_star3, Kx, Ky)\n    \n    # Perform projection\n    u_star3_hat = np.fft.fft2(u_star3)\n    v_star3_hat = np.fft.fft2(v_star3)\n    div_u_star3_hat = 1j * Kx * u_star3_hat + 1j * Ky * v_star3_hat\n    p3_hat = - (rho0 / dt) * div_u_star3_hat * k_sq_inv\n    \n    u_np1_hat3 = u_star3_hat - (dt / rho0) * (1j * Kx * p3_hat)\n    v_np1_hat3 = v_star3_hat - (dt / rho0) * (1j * Ky * p3_hat)\n    \n    u_np1_3 = np.real(np.fft.ifft2(u_np1_hat3))\n    v_np1_3 = np.real(np.fft.ifft2(v_np1_hat3))\n\n    # Diagnostic 2: RMS divergence after projection\n    rms_div_after3 = compute_rms_divergence(u_np1_3, v_np1_3, Kx, Ky)\n\n    # Diagnostic 3: Velocity error norm (difference from a priori solenoidal part)\n    vel_error3 = compute_rms_vector(u_np1_3 - u_psi3, v_np1_3 - v_psi3)\n\n    results.extend([rms_div_before3, rms_div_after3, vel_error3])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}