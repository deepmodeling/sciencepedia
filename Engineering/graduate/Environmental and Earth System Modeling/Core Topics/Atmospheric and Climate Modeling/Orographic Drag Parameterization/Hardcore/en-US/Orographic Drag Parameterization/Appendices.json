{
    "hands_on_practices": [
        {
            "introduction": "To parameterize orographic drag, we must first understand its physical origin. This foundational exercise guides you through the classic derivation of momentum flux generated by an idealized mountain wave . By starting from the linearized Boussinesq equations, you will see how flow over topography generates vertically propagating waves that transport momentum, leading to a drag force on the surface.",
            "id": "3904231",
            "problem": "Consider a two-dimensional, steady, inviscid, linear Boussinesq flow with uniform background wind speed $U$ blowing over an isolated ridge. Assume small-amplitude topography so that linear theory applies, and adopt the hydrostatic approximation for internal gravity waves. The stratification is uniform with Brunt–Väisälä frequency (BVF) $N$, and the background density is $\\rho$. Let the ridge be represented by a single monochromatic Fourier component of height $h(x)=H\\cos(kx)$, where $H$ is the height amplitude and $k=2\\pi/\\lambda$ is the horizontal wavenumber associated with wavelength $\\lambda$. At the lower boundary $z=0$, impose the kinematic boundary condition that the vertical velocity equals the advection of terrain by the background flow.\n\nStarting only from the linearized, steady, inviscid Boussinesq equations with hydrostatic balance, continuity, and uniform stratification:\n- continuity: $ik\\,u' + im\\,w' = 0$ for a plane-wave solution $\\propto \\exp(i(kx+mz))$,\n- hydrostatic balance: $\\partial p'/\\partial z = \\rho\\,b'$,\n- steady buoyancy: $U\\,\\partial b'/\\partial x + N^{2} w' = 0$,\n- horizontal momentum: $U\\,\\partial u'/\\partial x = -\\frac{1}{\\rho}\\,\\partial p'/\\partial x$,\nand the terrain boundary condition at $z=0$: $w(x,0) = U\\,\\partial h/\\partial x$,\n\nderive the phase-averaged vertical flux of horizontal momentum $\\rho\\,\\overline{u'w'}$ carried by the hydrostatic mountain wave and demonstrate its dependence on the fundamental parameters and topographic amplitude. Then, for the specific case\n$\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$, $N = 0.012\\,\\mathrm{s}^{-1}$, $H = 300\\,\\mathrm{m}$, and $\\lambda = 20\\,\\mathrm{km}$,\nevaluate the signed surface momentum flux (a stress) and express it in $\\mathrm{N}\\,\\mathrm{m}^{-2}$. Round your final numerical answer to three significant figures.",
            "solution": "The user wants me to solve a problem in geophysical fluid dynamics concerning hydrostatic mountain waves.\n\n### Step 1: Extract Givens\nThe problem provides the following information and governing equations:\n- Flow is two-dimensional, steady, inviscid, linear, and Boussinesq.\n- Background wind speed is uniform, $U$.\n- Stratification is uniform with Brunt–Väisälä frequency $N$.\n- Background density is $\\rho$.\n- The terrain is a single monochromatic ridge: $h(x) = H\\cos(kx)$, where $H$ is the height amplitude and $k=2\\pi/\\lambda$ is the horizontal wavenumber.\n- The hydrostatic approximation is to be used.\n- The governing linearized equations are provided (in a mix of differential and Fourier-space forms):\n    - Continuity for a plane wave: $ik\\,u' + im\\,w' = 0$.\n    - Hydrostatic balance: $\\partial p'/\\partial z = \\rho\\,b'$.\n    - Steady-state buoyancy: $U\\,\\partial b'/\\partial x + N^{2} w' = 0$.\n    - Horizontal momentum: $U\\,\\partial u'/\\partial x = -\\frac{1}{\\rho}\\,\\partial p'/\\partial x$.\n- The lower boundary condition at $z=0$ is the kinematic condition: $w(x,0) = U\\,\\partial h/\\partial x$.\n- Specific numerical values for the final calculation:\n    - $\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n    - $U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n    - $N = 0.012\\,\\mathrm{s}^{-1}$\n    - $H = 300\\,\\mathrm{m}$\n    - $\\lambda = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement will now be validated.\n1.  **Scientifically Grounded**: The problem is a classic, textbook example of linear mountain wave theory, a fundamental topic in atmospheric dynamics and environmental fluid mechanics. The governing equations are the standard linearized Boussinesq equations under the hydrostatic approximation. The physical setup is realistic and serves as a foundational model for understanding orographic drag. The problem is firmly scientifically grounded.\n2.  **Well-Posed**: The problem is well-posed. It provides a complete set of governing equations and a well-defined boundary condition. The request to find the momentum flux is a standard calculation that follows from solving the system. An implicit upper boundary condition (the radiation condition) is required for a unique solution, which is standard practice for such problems to ensure that wave energy propagates away from the source (the mountain) at high altitudes.\n3.  **Objective**: The language is precise, quantitative, and free of any subjectivity or bias.\n4.  **Completeness and Consistency**: The provided equations and conditions are consistent and sufficient to derive the requested quantities. The problem explicitly states to adopt the hydrostatic approximation, which resolves any ambiguity about which set of equations to use. The numerical values are physically plausible for Earth's atmosphere.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of Momentum Flux\nWe seek the phase-averaged vertical flux of horizontal momentum, $\\mathcal{F}_M = \\rho\\,\\overline{u'w'}$. The overbar denotes a spatial average over one horizontal wavelength. The perturbations $u'$ (horizontal velocity) and $w'$ (vertical velocity) are solutions to the given linear system.\n\nWe assume solutions of the form $f'(x,z) = \\Re\\{\\hat{f}(z)e^{ikx}\\}$, where $\\hat{f}(z)$ is the complex amplitude of the perturbation variable $f'$. Substituting this form into the governing differential equations yields a set of equations for the complex amplitudes:\n1.  Horizontal momentum: $U(ik\\hat{u}) = -\\frac{1}{\\rho}(ik\\hat{p}) \\implies \\hat{p} = -\\rho U \\hat{u}$.\n2.  Buoyancy: $U(ik\\hat{b}) + N^2\\hat{w} = 0 \\implies \\hat{b} = \\frac{iN^2}{Uk}\\hat{w}$.\n3.  Hydrostatic balance: $\\frac{d\\hat{p}}{dz} = \\rho \\hat{b}$.\n4.  Continuity: $ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0$.\n\nWe combine these equations to find a single governing equation for $\\hat{w}(z)$. Differentiating the horizontal momentum equation (1) with respect to $z$ gives $\\frac{d\\hat{p}}{dz} = -\\rho U \\frac{d\\hat{u}}{dz}$.\nSubstituting this and the buoyancy relation (2) into the hydrostatic equation (3) gives:\n$-\\rho U \\frac{d\\hat{u}}{dz} = \\rho \\left(\\frac{iN^2}{Uk}\\hat{w}\\right) \\implies \\frac{d\\hat{u}}{dz} = -\\frac{iN^2}{U^2k}\\hat{w}$.\nFrom the continuity equation (4), we have $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$. Differentiating this with respect to $z$ yields $\\frac{d\\hat{u}}{dz} = \\frac{i}{k}\\frac{d^2\\hat{w}}{dz^2}$.\nEquating the two expressions for $\\frac{d\\hat{u}}{dz}$:\n$\\frac{i}{k}\\frac{d^2\\hat{w}}{dz^2} = -\\frac{iN^2}{U^2k}\\hat{w}$.\nMultiplying by $k/i$ simplifies this to the Taylor-Goldstein equation for hydrostatic flow:\n$$\n\\frac{d^2\\hat{w}}{dz^2} + \\frac{N^2}{U^2}\\hat{w} = 0\n$$\nThis is a second-order ordinary differential equation with constant coefficients. Let $m^2 = (N/U)^2$. The general solution is $\\hat{w}(z) = A e^{imz} + B e^{-imz}$. For a physically meaningful solution, wave energy must propagate upward, away from the topography. For a stationary wave ($U0$, $k0$), this radiation condition requires that we select the solution with upward group velocity, which corresponds to downward phase velocity, meaning we choose the positive root for the vertical wavenumber, $m = N/U$. The solution is thus $\\hat{w}(z) = A e^{imz}$.\n\nThe constant $A$ is determined by the lower boundary condition at $z=0$: $w(x,0) = U \\frac{\\partial h}{\\partial x}$.\nGiven $h(x)=H\\cos(kx)$, we have $\\frac{\\partial h}{\\partial x} = -Hk\\sin(kx)$.\nSo, $w(x,0) = -UHk\\sin(kx)$.\nWe can write this in complex form: $w(x,0) = \\Re\\{iUHke^{ikx}\\}$.\nAlso, from our assumed solution form, $w(x,0) = \\Re\\{\\hat{w}(0)e^{ikx}\\} = \\Re\\{Ae^{ikx}\\}$.\nComparing the two expressions, we find the amplitude at the boundary: $A = \\hat{w}(0) = iUHk$.\nThus, the solution for the vertical velocity amplitude is:\n$$\n\\hat{w}(z) = iUHk e^{imz}, \\quad \\text{where } m = \\frac{N}{U}\n$$\nNext, we find the horizontal velocity amplitude $\\hat{u}(z)$ using the continuity equation, $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$:\n$\\frac{d\\hat{w}}{dz} = \\frac{d}{dz}(iUHk e^{imz}) = (iUHk)(im)e^{imz} = -UHkm e^{imz}$.\nSubstituting $m=N/U$: $\\frac{d\\hat{w}}{dz} = -UHk(N/U)e^{imz} = -NHk e^{imz}$.\nThen, $\\hat{u}(z) = \\frac{i}{k}(-NHk e^{imz}) = -iNH e^{imz}$.\n\nNow we can compute the phase-averaged momentum flux. For two quantities $a = \\Re\\{\\hat{a}e^{ikx}\\}$ and $b = \\Re\\{\\hat{b}e^{ikx}\\}$, the phase average of their product is $\\overline{ab} = \\frac{1}{2}\\Re\\{\\hat{a}\\hat{b}^*\\}$, where $\\hat{b}^*$ is the complex conjugate of $\\hat{b}$.\nWe have $\\hat{u}(z) = -iNH e^{imz}$ and $\\hat{w}(z) = iUHk e^{imz}$.\nThe complex conjugate of $\\hat{w}$ is $\\hat{w}^*(z) = -iUHk e^{-imz}$.\nThe product is:\n$\\hat{u}\\hat{w}^* = (-iNH e^{imz})(-iUHk e^{-imz}) = i^2 (NH)(UHk) e^{imz-imz} = -NUH^2k$.\nThe average product $\\overline{u'w'}$ is:\n$$\n\\overline{u'w'} = \\frac{1}{2}\\Re\\{-NUH^2k\\} = -\\frac{1}{2}NUH^2k\n$$\nThis quantity is independent of height $z$, consistent with an inviscid, steady flow. The vertical flux of horizontal momentum is:\n$$\n\\mathcal{F}_M = \\rho\\,\\overline{u'w'} = -\\frac{1}{2}\\rho N U k H^2\n$$\nThe negative sign indicates a downward flux of positive (eastward) momentum, which exerts a drag force on the mountain.\n\n### Numerical Evaluation\nWe are asked to evaluate the signed surface momentum flux for the given parameters:\n- $\\rho = 0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $U = 15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}$\n- $N = 0.012\\,\\mathrm{s}^{-1}$\n- $H = 300\\,\\mathrm{m}$\n- $\\lambda = 20\\,\\mathrm{km} = 2 \\times 10^4\\,\\mathrm{m}$\n\nFirst, we calculate the horizontal wavenumber $k$:\n$$\nk = \\frac{2\\pi}{\\lambda} = \\frac{2\\pi}{2 \\times 10^4\\,\\mathrm{m}} = \\pi \\times 10^{-4}\\,\\mathrm{m}^{-1}\n$$\nNow, substitute these values into the expression for the momentum flux:\n$$\n\\mathcal{F}_M = -\\frac{1}{2} (0.9\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}) (0.012\\,\\mathrm{s}^{-1}) (15\\,\\mathrm{m}\\,\\mathrm{s}^{-1}) (\\pi \\times 10^{-4}\\,\\mathrm{m}^{-1}) (300\\,\\mathrm{m})^2\n$$\n$$\n\\mathcal{F}_M = - \\frac{1}{2} (0.9)(0.012)(15)(\\pi \\times 10^{-4})(9 \\times 10^4) \\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\nThe powers of $10$ cancel out. We are left with:\n$$\n\\mathcal{F}_M = - \\frac{1}{2} (0.9)(0.012)(15)(\\pi)(9)\n$$\nLet's compute the numerical product:\n$$\n0.5 \\times 0.9 \\times 0.012 \\times 15 \\times 9 = 0.729\n$$\nSo, the momentum flux is:\n$$\n\\mathcal{F}_M = -0.729\\pi \\,\\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\nUsing the value of $\\pi \\approx 3.14159...$:\n$$\n\\mathcal{F}_M \\approx -0.729 \\times 3.14159 = -2.29022... \\,\\,\\mathrm{N}\\,\\mathrm{m}^{-2}\n$$\nRounding to three significant figures, the signed surface momentum flux is $-2.29\\,\\mathrm{N}\\,\\mathrm{m}^{-2}$.",
            "answer": "$$\\boxed{-2.29}$$"
        },
        {
            "introduction": "Moving from idealized theory to a global atmospheric model introduces new complexities, chief among them the issue of 'double counting'. As model resolution increases, some orography is explicitly resolved, generating its own waves, while finer-scale features still require parameterization . This problem challenges you to think about this 'gray zone' of partially resolved processes and devise a strategy to ensure the parameterized and resolved drag components work in concert, not in conflict.",
            "id": "3904221",
            "problem": "A global atmospheric General Circulation Model (GCM) with horizontal grid spacing $\\Delta x \\approx 25\\,\\mathrm{km}$ explicitly represents terrain height in its dynamical core and computes prognostic winds by solving the rotating, stratified momentum equations. In mountainous regions, the resolved flow over ridges produces gravity waves that propagate upward and, upon dissipation or encountering critical levels, decelerate the mean flow through the divergence of the resolved eddy momentum flux. The same GCM also includes an orographic gravity wave drag parameterization intended to represent subgrid-scale orography by adding a column-integrated stress tendency in the momentum equation.\n\nConsider the Reynolds decomposition $u = \\overline{u} + u'$ and $w = \\overline{w} + w'$, and the mean zonal momentum budget in a column above complex terrain. The resolved gravity waves induce a vertical flux of zonal momentum $\\tau_{\\mathrm{r}} = \\rho\\,\\overline{u' w'}$ whose vertical gradient, $-\\partial_z \\tau_{\\mathrm{r}}$, appears as a mean-flow drag in the momentum equation. The parameterization adds an additional tendency that can be written in stress form as $-\\partial_z \\tau_{\\mathrm{p}}$, where $\\tau_{\\mathrm{p}}$ is the parameterized stress derived from subgrid orographic statistics.\n\nWhich option best explains, from first principles, how double counting of gravity wave drag can occur in this GCM when resolved orography generates gravity wave drag explicitly in the dynamics, and proposes a scientifically defensible diagnostic that detects such situations and reduces the parameterized drag accordingly?\n\nA. Double counting arises because the divergence of resolved eddy momentum flux, $-\\partial_z \\left(\\rho\\,\\overline{u' w'}\\right)$, is already acting as a sink of $\\overline{u}$ due to waves generated by terrain that is partially resolved at scale $\\Delta x$, while the parameterization applies an additional $-\\partial_z \\tau_{\\mathrm{p}}$ without excluding the same scales. A detection-and-reduction diagnostic is to compute $\\tau_{\\mathrm{r}} = \\rho\\,\\overline{u' w'}$ over a layer immediately above the orography (e.g., between $z_1$ and $z_2$ in the lower troposphere), form a non-dimensional ratio $\\mathcal{R} = \\min\\!\\left(1,\\,\\left|\\tau_{\\mathrm{r}}\\right|/\\tau_{\\mathrm{cap}}\\right)$ where $\\tau_{\\mathrm{cap}}$ is the stress magnitude the parameterization would apply in that layer absent tapering, and then taper the parameterized stress using $S = 1 - \\mathcal{R}$ so that $\\tau_{\\mathrm{p}} \\leftarrow S\\,\\tau_{\\mathrm{p}}$. This uses the resolved wave momentum flux as a direct indicator of explicit drag and proportionally reduces the parameterized tendency.\n\nB. Double counting occurs only when the Froude number $Fr = U/(N H)$ falls below $1$ because flow blocking near mountains prevents gravity waves, so any parameterized drag would be spurious; the diagnostic is to disable the parameterization whenever $Fr  1$. This prevents double counting by relying on blocking thresholds.\n\nC. Double counting is due to excessive surface roughness effects that the model dynamical core cannot represent; a practical diagnostic is to monitor near-surface wind speed $U_{10}$ and reduce the parameterized drag when $U_{10}$ exceeds a preset threshold, since high winds imply the dynamics already accounts for drag.\n\nD. Double counting is avoided by applying a fixed spectral cutoff to the parameterization: compute the orographic variance spectrum and restrict $\\tau_{\\mathrm{p}}$ to wavenumbers strictly smaller than $2\\pi/\\Delta x$, independent of the instantaneous flow; this spectral separation is sufficient to detect and eliminate overlaps with resolved dynamics, so no additional diagnostic using model-resolved fluxes is needed.",
            "solution": "The problem asks for the best explanation of \"double counting\" of orographic drag in a GCM and a scientifically defensible method to mitigate it. This issue arises in the \"gray zone\" of model resolution (typically a few to tens of kilometers) where some topographic features are large enough to be partially resolved by the model's dynamics, while smaller features remain subgrid.\n\n*   **Option A: Correct.** This option accurately describes the core problem: the model's dynamics explicitly simulate waves from resolved orography (contributing a drag term $-\\partial_z \\tau_{\\mathrm{r}}$), while the parameterization adds another drag term ($-\\partial_z \\tau_{\\mathrm{p}}$) for subgrid orography. If the parameterization isn't aware of what the dynamics are already doing, it will \"double count\" the drag from the same range of topographic scales. The proposed diagnostic is a sophisticated, physically-based solution known as \"flux matching\" or a scale-aware tapering function. By calculating the resolved momentum flux ($\\tau_{\\mathrm{r}}$) generated by the model's dynamics, it provides a direct measure of the explicitly captured drag. Using this to proportionally reduce the parameterized flux ($\\tau_{\\mathrm{p}}$) is a standard and effective technique to ensure the total drag (resolved + parameterized) is physically consistent. The formula $\\tau_{\\mathrm{p}} \\leftarrow (1 - \\mathcal{R})\\,\\tau_{\\mathrm{p}}$ correctly implements this tapering.\n\n*   **Option B: Incorrect.** Flow blocking (low Froude number) is a physical regime that governs the *type* of drag (low-level vs. wave drag), not the problem of scale overlap. Disabling the parameterization entirely based on a Froude number criterion does not address the fundamental issue of double counting when waves *are* generated by partially resolved terrain.\n\n*   **Option C: Incorrect.** Using near-surface wind speed as a proxy for drag is physically unsound. High winds do not necessarily mean all drag effects have been captured by the dynamics; in fact, strong winds are precisely when drag forces become most important. This approach lacks a direct physical link to the scale-overlap problem.\n\n*   **Option D: Incorrect.** While applying a fixed spectral cutoff is a necessary component of a scale-aware scheme, it is often insufficient on its own. It assumes a clean separation between resolved and unresolved scales, which is not true in practice due to numerical diffusion and the effective resolution of the model. Furthermore, it's a static approach. A dynamic diagnostic, as proposed in A, is superior because it responds to the model's actual, instantaneous state, accounting for how well the resolved dynamics are *actually* capturing the wave generation in a given situation.\n\nTherefore, option A provides the most complete and physically robust explanation and solution.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "This final practice is a capstone exercise where you will build a simplified orographic gravity wave drag parameterization from the ground up . You will implement an algorithm that launches a spectrum of waves, propagates their momentum flux vertically, and determines where that momentum is deposited due to wave breaking or critical level absorption. This provides an invaluable, hands-on understanding of how these complex schemes function within Earth system models.",
            "id": "3904213",
            "problem": "Consider the parameterization of orographic drag in a vertically varying atmosphere under the linear Boussinesq approximation for two-dimensional stationary mountain waves. You are given a stratification profile $N(z)$, a background wind profile $U(z)$ aligned with the horizontal wavenumber vector, and a discrete set of terrain spectral components characterized by horizontal wavenumber $k$ and terrain amplitude $h_0$. From the fundamental base comprising (i) the Boussinesq continuity and momentum equations, (ii) the internal gravity wave dispersion relation for two-dimensional stationary waves, and (iii) the conservation of wave action in slowly varying media, derive the expressions necessary to compute the vertical wavenumber $m(z)$, the vertical flux of horizontal momentum (also called Eliassen-Palm flux) and the saturation criterion. Using those expressions, implement an algorithm to vertically propagate each spectral component from the lower boundary upward through a discrete grid until wave breaking (saturation) or a critical level is encountered, and compute the resulting vertical distribution of momentum deposition.\n\nThe algorithmic requirements are as follows:\n\n- Start from fundamental laws and core definitions to derive the governing relations needed for vertical propagation of stationary internal gravity waves forced by orography. Do not use pre-packaged or shortcut formulas that are not derived from the fundamental base.\n- Assume a constant reference density $ \\rho_0 $ and use the two-dimensional, non-rotating, hydrostatic-consistent limit of the Boussinesq framework appropriate for mountain waves.\n- Implement vertical propagation on a uniform grid $z_i$ from $z=0$ to $z=10{,}000$ meters at $1{,}000$ meters spacing. At each level, determine whether the internal gravity wave is able to propagate ($m^2(z_i) > 0$), whether it encounters a turning level ($m^2(z_i) \\le 0$), whether it saturates according to a physically motivated nonlinearity threshold, or whether it encounters a critical level (defined when the intrinsic phase speed vanishes due to $|U(z_i)|$ crossing below a small threshold).\n- For each spectral component with parameters $k$ and $h_0$, initialize the upward vertical flux of horizontal momentum at the lower boundary using the appropriate relations derived from the fundamental base. Under the assumption of adiabatic propagation in the absence of breaking or critical levels, this flux is conserved with height. When saturation occurs (based on a derived nonlinearity parameter reaching unity), or a critical level is encountered (based on a threshold for $|U(z)|$), or a turning level is reached ($m^2(z) \\le 0$), deposit the remaining upward flux locally at that level. Sum the momentum deposition contributions from all spectral components to obtain the net vertical profile.\n- Express all momentum deposition values in units of Newtons per square meter ($\\mathrm{N}\\,\\mathrm{m}^{-2}$). For the final program output, round every reported float to six decimal places.\n\nUse the following constants and test suite. All mathematical entities (symbols, variables, functions, and numbers) are to be treated consistently with their physical meaning:\n\n- Reference density: $ \\rho_0 = 1.0 \\,\\mathrm{kg}\\,\\mathrm{m}^{-3} $.\n- Critical-level threshold: $ U_{\\mathrm{crit}} = 0.5 \\,\\mathrm{m}\\,\\mathrm{s}^{-1} $.\n\nVertical grid:\n- Levels at $z_i = 0, 1000, 2000, \\dots, 10000$ meters.\n\nTest Suite (three cases), each defined by $N(z)$, $U(z)$ and a set of discrete spectral components $\\{(k,h_0)\\}$:\n\n- Case A (monotonic shear leading to possible saturation):\n  - Stratification: $N(z) = 0.01 \\,\\mathrm{s}^{-1}$ for all $z$.\n  - Wind: $U(z) = 10 + 1.2 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - Spectral components: $(k_1,h_{0,1}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (8\\times 10^{-4}\\,\\mathrm{m}^{-1}, 100\\,\\mathrm{m})$.\n\n- Case B (critical level due to wind reversal with height):\n  - Stratification: $N(z) = 0.01 \\,\\mathrm{s}^{-1}$ for all $z$.\n  - Wind: $U(z) = 12 - 3 \\times (z/1000) \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$.\n  - Spectral components: $(k_1,h_{0,1}) = (4\\times 10^{-4}\\,\\mathrm{m}^{-1}, 150\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (6\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (3\\times 10^{-4}\\,\\mathrm{m}^{-1}, 200\\,\\mathrm{m})$.\n\n- Case C (decreasing stratification leading to a turning level):\n  - Stratification: $N(z) = 0.014 - 0.0008 \\times (z/1000) \\,\\mathrm{s}^{-1}$.\n  - Wind: $U(z) = 15 \\,\\mathrm{m}\\,\\mathrm{s}^{-1}$ for all $z$.\n  - Spectral components: $(k_1,h_{0,1}) = (7\\times 10^{-4}\\,\\mathrm{m}^{-1}, 120\\,\\mathrm{m})$, $(k_2,h_{0,2}) = (5\\times 10^{-4}\\,\\mathrm{m}^{-1}, 180\\,\\mathrm{m})$, $(k_3,h_{0,3}) = (9\\times 10^{-4}\\,\\mathrm{m}^{-1}, 80\\,\\mathrm{m})$.\n\nNumerical and physical handling guidelines:\n- The vertical wavenumber $m(z)$ must be determined from the dispersion relation appropriate for two-dimensional stationary internal gravity waves in a Boussinesq fluid with horizontally aligned mean flow.\n- The polarization relations must be used to relate the vertical velocity amplitude to horizontal velocity perturbations and compute the vertical flux of horizontal momentum.\n- Use the conservation of wave action to infer how amplitudes evolve with $z$ in the absence of breaking or critical levels, enabling the calculation of the nonlinearity parameter and its saturation threshold.\n- Upon saturation, encountering a critical level, or reaching a turning level, deposit the remaining upward flux at the current level and stop the propagation of that spectral component.\n\nFinal Output Specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to one test case and is itself a list of $11$ floats representing the net momentum deposition at each of the $11$ vertical levels $z_i$ (from $z=0$ to $z=10{,}000$ meters), in $\\mathrm{N}\\,\\mathrm{m}^{-2}$, rounded to six decimal places. For example: \"[[x_0,x_1,...,x_{10}],[y_0,y_1,...,y_{10}],[z_0,z_1,...,z_{10}]]\".",
            "solution": "The problem requires the derivation of a model for orographic gravity wave drag and its implementation. The derivation will proceed from the fundamental equations of fluid dynamics under the specified approximations.\n\n**1. Fundamental Equations and Linearization**\n\nWe begin with the two-dimensional, steady-state, non-rotating, inviscid Boussinesq equations for a stratified fluid, linearized about a background state with horizontal velocity $U(z)$ and density profile $\\bar{\\rho}(z)$. The perturbation quantities are velocity components $(u', w')$, pressure $p'$, and density $\\rho'$. The reference density is a constant $\\rho_0$.\n\nThe linearized momentum equations are:\n$$ U \\frac{\\partial u'}{\\partial x} + w' \\frac{dU}{dz} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial x} \\quad (1) $$\n$$ U \\frac{\\partial w'}{\\partial x} = -\\frac{1}{\\rho_0}\\frac{\\partial p'}{\\partial z} - \\frac{\\rho' g}{\\rho_0} \\quad (2) $$\nThe continuity equation is:\n$$ \\frac{\\partial u'}{\\partial x} + \\frac{\\partial w'}{\\partial z} = 0 \\quad (3) $$\nThe thermodynamic equation, representing conservation of density for a fluid parcel, is:\n$$ U \\frac{\\partial \\rho'}{\\partial x} + w' \\frac{d\\bar{\\rho}}{dz} = 0 \\quad (4) $$\nWe define the Brunt-Väisälä frequency $N$ by $N^2(z) = -\\frac{g}{\\rho_0}\\frac{d\\bar{\\rho}}{dz}$. Using this, equation $(4)$ becomes:\n$$ U \\frac{\\partial}{\\partial x} \\left(-\\frac{\\rho' g}{\\rho_0}\\right) - w' N^2 = 0 \\quad (5) $$\n\n**2. Derivation of the Taylor-Goldstein Equation**\n\nWe seek wave-like solutions of the form $\\psi'(x,z) = \\Re\\{\\hat{\\psi}(z) e^{ikx}\\}$ for any perturbation variable $\\psi'$, where $k$ is the horizontal wavenumber. Substituting this form into the linearized equations yields a system of ordinary differential equations (ODEs) for the complex amplitudes $\\hat{u}(z), \\hat{w}(z), \\hat{p}(z), \\hat{\\rho}(z)$:\n$$ ikU\\hat{u} + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\quad (6) $$\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0}\\frac{d\\hat{p}}{dz} - \\frac{\\hat{\\rho}g}{\\rho_0} \\quad (7) $$\n$$ ik\\hat{u} + \\frac{d\\hat{w}}{dz} = 0 \\quad (8) $$\n$$ ikU\\left(-\\frac{\\hat{\\rho}g}{\\rho_0}\\right) - \\hat{w} N^2 = 0 \\quad (9) $$\n\nFrom $(8)$, we express $\\hat{u}$ in terms of $\\hat{w}$: $\\hat{u} = \\frac{i}{k}\\frac{d\\hat{w}}{dz}$.\nFrom $(9)$, we express the buoyancy term in terms of $\\hat{w}$: $-\\frac{\\hat{\\rho}g}{\\rho_0} = \\frac{N^2}{ikU}\\hat{w}$.\n\nSubstitute $\\hat{u}$ into $(6)$ to solve for $\\hat{p}$:\n$$ ikU\\left(\\frac{i}{k}\\frac{d\\hat{w}}{dz}\\right) + \\hat{w}\\frac{dU}{dz} = -\\frac{ik}{\\rho_0}\\hat{p} \\implies \\hat{p} = \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) $$\nNow, differentiate $\\hat{p}$ with respect to $z$ and substitute it, along with the expression for buoyancy, into $(7)$:\n$$ ikU\\hat{w} = -\\frac{1}{\\rho_0} \\frac{d}{dz} \\left[ \\rho_0 \\left( \\frac{U}{k^2}\\frac{d\\hat{w}}{dz} - \\frac{i}{k}\\frac{dU}{dz}\\hat{w} \\right) \\right] + \\frac{N^2}{ikU}\\hat{w} $$\nAfter expanding the derivative and rearranging terms, we obtain the Taylor-Goldstein equation:\n$$ \\frac{d^2\\hat{w}}{dz^2} + \\left( \\frac{N^2}{U^2} - k^2 - \\frac{U_{zz}}{U} \\right) \\hat{w} = 0 $$\nwhere $U_{zz} = d^2U/dz^2$.\n\n**3. Vertical Wavenumber, $m(z)$**\n\nThe problem specifies analysis for a \"slowly varying media\", which corresponds to the WKB approximation. In this limit, the term involving the curvature of the wind profile, $U_{zz}/U$, is negligible compared to the other terms. The governing equation simplifies to:\n$$ \\frac{d^2\\hat{w}}{dz^2} + m^2(z)\\hat{w} = 0 $$\nThis is the equation for a harmonic oscillator with a spatially varying frequency. The local vertical wavenumber, $m(z)$, is defined by:\n$$ m^2(z) = \\frac{N(z)^2}{U(z)^2} - k^2 $$\nFor a wave to propagate vertically, its solution must be oscillatory in $z$, which requires $m^2(z) > 0$. If $m^2(z) \\le 0$, the solution is evanescent, and the wave cannot propagate. This condition, $m^2(z) \\le 0$, defines a **turning level**.\n\n**4. Vertical Flux of Horizontal Momentum**\n\nThe vertical flux of horizontal momentum per unit area is given by $F_m = \\rho_0 \\overline{u'w'}$, where the overbar denotes a horizontal average over one wavelength. We introduce the vertical parcel displacement $\\eta'(x, z)$. For small displacements, the vertical velocity is the total derivative of the displacement: $w' = \\frac{D\\eta'}{Dt} = (\\frac{\\partial}{\\partial t} + U\\frac{\\partial}{\\partial x})\\eta'$. For stationary waves ($\\partial/\\partial t = 0$), this simplifies to $w' = U\\frac{\\partial \\eta'}{\\partial x}$. For a single Fourier mode $\\eta'(x,z) = \\Re\\{\\hat{\\eta}(z) e^{ikx}\\}$, we have $\\hat{w}(z) = ikU(z)\\hat{\\eta}(z)$.\n\nThe kinematic boundary condition at the surface ($z=0$) forces the flow to follow the terrain $h(x)$. Thus, $\\eta'(x,0) = h(x)$. For a spectral component $h(x) = h_0 \\cos(kx)$, the complex amplitude of the displacement at the surface is $\\hat{\\eta}(0) = h_0$.\n\nTo find the momentum flux, we need to relate $u'$ and $\\eta'$. Combining the continuity equation $(3)$ and the relation between $w'$ and $\\eta'$:\n$$ \\frac{\\partial u'}{\\partial x} = -\\frac{\\partial w'}{\\partial z} = -\\frac{\\partial}{\\partial z}\\left(U\\frac{\\partial \\eta'}{\\partial x}\\right) = -U\\frac{\\partial^2 \\eta'}{\\partial x \\partial z} - \\frac{dU}{dz}\\frac{\\partial \\eta'}{\\partial x} $$\nIntegrating with respect to $x$ gives $u' = -U\\frac{\\partial \\eta'}{\\partial z} - \\frac{dU}{dz}\\eta'$. For upward energy propagation, the vertical structure of $\\eta'$ is proportional to $e^{imz}$. Under the WKB approximation ($\\partial_z \\gg \\frac{1}{U}\\frac{dU}{dz}$ etc.), we have $\\frac{\\partial \\eta'}{\\partial z} \\approx im\\eta'$, leading to $\\hat{u} \\approx -imU\\hat{\\eta}$.\n\nThe momentum flux is then:\n$F_m = \\rho_0 \\overline{u'w'} = \\frac{1}{2}\\rho_0 \\Re\\{\\hat{u}(ikU\\hat{\\eta})^*\\} = \\frac{1}{2}\\rho_0 \\Re\\{(-imU\\hat{\\eta})(-ikU\\hat{\\eta}^*)\\} = \\frac{1}{2}\\rho_0 \\Re\\{-mkU^2|\\hat{\\eta}|^2\\}$.\n$$ F_m(z) = -\\frac{1}{2} \\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2 $$\nThe negative sign indicates a downward flux of horizontal momentum, which corresponds to a drag on the surface. For an upward propagating wave launched from the ground, the magnitude of this flux at the surface ($z=0$), denoted $J_0$, is:\n$$ J_0 = |F_m(0)| = \\frac{1}{2}\\rho_0 m_0 k U_0^2 h_0^2 $$\nwhere $U_0 = U(0)$, $N_0 = N(0)$, and $m_0 = \\sqrt{N_0^2/U_0^2 - k^2}$.\nFor a steady, non-dissipating wave, the vertical flux of horizontal momentum is conserved with height, i.e., $F_m(z) = F_m(0)$. Therefore, the magnitude $J(z) = J_0$ remains constant until the wave encounters a critical level, turning level, or breaks.\n\n**5. Saturation Criterion**\n\nWave breaking (saturation) occurs when the wave amplitude becomes too large, leading to convective instability. This happens when the total potential temperature gradient $\\partial\\theta/\\partial z$ becomes non-positive. This is equivalent to the condition $\\partial b/\\partial z \\le 0$ on the buoyancy $b = \\bar{b}(z)+b'(x,z)$. The onset criterion is $\\partial b'/\\partial z \\ge N^2$.\n\nFrom the thermodynamic equation $(5)$, we found $b' = -N^2\\eta'$. The saturation criterion is therefore:\n$$ \\frac{\\partial}{\\partial z}(-N^2 \\eta') \\ge N^2 \\implies -N^2 \\frac{\\partial \\eta'}{\\partial z} \\ge N^2 \\implies \\frac{\\partial \\eta'}{\\partial z} \\le -1 $$\nThe amplitude of the vertical gradient of displacement is $|\\frac{\\partial \\eta'}{\\partial z}| \\approx |im\\eta'| = m|\\hat{\\eta}|$. Thus, saturation occurs when the nonlinearity parameter $S(z) = m(z)|\\hat{\\eta}(z)|$ reaches a value of order unity. We set the threshold at $S(z) \\ge 1$.\n\nTo evaluate $S(z)$, we find $|\\hat{\\eta}(z)|$ from the conservation of momentum flux magnitude: $J_0 = \\frac{1}{2}\\rho_0 m(z) k U(z)^2 |\\hat{\\eta}(z)|^2$.\n$$ |\\hat{\\eta}(z)|^2 = \\frac{2 J_0}{\\rho_0 k m(z) U(z)^2} $$\nSubstituting this into the expression for $S(z)$:\n$$ S(z) = m(z) \\sqrt{\\frac{2 J_0}{\\rho_0 k m(z) U(z)^2}} = \\sqrt{\\frac{2 J_0 m(z)}{\\rho_0 k U(z)^2}} $$\nThe wave is considered to break at level $z_i$ if $S(z_i) \\ge 1$.\n\n**6. Algorithmic Procedure**\n\nThe algorithm for computing the vertical profile of momentum deposition is as follows.\nFor each atmospheric profile case:\n1. Initialize a total deposition array, $D[z_i]$, to zeros for all grid levels $z_i$.\n2. For each spectral component $(k, h_0)$:\n   a. Calculate background state $U_0=U(0)$, $N_0=N(0)$.\n   b. Calculate the surface vertical wavenumber squared: $m_0^2 = N_0^2/U_0^2 - k^2$.\n   c. If $m_0^2 \\le 0$, the wave is evanescent at the source. The momentum flux is zero. Proceed to the next component.\n   d. Otherwise, calculate the magnitude of the momentum flux at the surface: $J_0 = \\frac{1}{2}\\rho_0 m_0 k U_0^2 h_0^2$.\n   e. Propagate this flux vertically. Iterate from level $i=1$ to the top level ($z_i = 1000, 2000, ..., 10000$ m).\n      i. At level $z_i$, calculate $U_i=U(z_i)$ and $N_i=N(z_i)$.\n      ii. **Critical Level Check:** If $|U_i|  U_{\\mathrm{crit}}$, the wave is absorbed. Add $J_0$ to the deposition at this level, $D[z_i] += J_0$, and terminate propagation for this component (break the vertical loop).\n      iii. **Turning Level Check:** Calculate $m_i^2 = N_i^2/U_i^2 - k^2$. If $m_i^2 \\le 0$, the wave is reflected/trapped. The upward flux is terminated. Add $J_0$ to $D[z_i]$ and break the loop.\n      iv. **Saturation Check:** If the wave is still propagating, calculate the saturation parameter $S_i^2 = \\frac{2 J_0 m_i}{\\rho_0 k U_i^2}$, where $m_i=\\sqrt{m_i^2}$. If $S_i^2 \\ge 1$, the wave breaks. Add $J_0$ to $D[z_i]$ and break the loop.\n   f. If the loop completes without breaking, the wave's momentum flux escapes the top of the model domain and is not deposited.\n3. The final array $D$ represents the total momentum deposition profile for the case.\nThis procedure is repeated for all test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes orographic gravity wave drag deposition profiles for given atmospheric conditions.\n    \"\"\"\n    # Define constants\n    rho_0 = 1.0  # kg/m^3\n    U_crit = 0.5  # m/s\n\n    # Define vertical grid\n    z_levels = np.linspace(0, 10000, 11)  # 0, 1000, ..., 10000 meters\n\n    # Define Test Suite\n    test_suite = {\n        \"A\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 10.0 + 1.2 * (z / 1000.0),\n            \"components\": [\n                (5e-4, 200.0),\n                (3e-4, 150.0),\n                (8e-4, 100.0),\n            ]\n        },\n        \"B\": {\n            \"N_func\": lambda z: 0.01,\n            \"U_func\": lambda z: 12.0 - 3.0 * (z / 1000.0),\n            \"components\": [\n                (4e-4, 150.0),\n                (6e-4, 120.0),\n                (3e-4, 200.0),\n            ]\n        },\n        \"C\": {\n            \"N_func\": lambda z: 0.014 - 0.0008 * (z / 1000.0),\n            \"U_func\": lambda z: 15.0,\n            \"components\": [\n                (7e-4, 120.0),\n                (5e-4, 180.0),\n                (9e-4, 80.0),\n            ]\n        }\n    }\n\n    all_results = []\n\n    for case_id in [\"A\", \"B\", \"C\"]:\n        case_data = test_suite[case_id]\n        N_func = case_data[\"N_func\"]\n        U_func = case_data[\"U_func\"]\n        components = case_data[\"components\"]\n\n        total_deposition = np.zeros(len(z_levels))\n\n        for k, h0 in components:\n            # 1. Initialization at the lower boundary (z=0)\n            z0 = z_levels[0]\n            U0 = U_func(z0)\n            N0 = N_func(z0)\n            \n            # Ensure U0 is not at a critical level for flux calculation\n            if abs(U0)  1e-9:\n                continue # No wave launched\n\n            m_squared_0 = (N0**2 / U0**2) - k**2\n\n            # Check if the wave is propagating at the surface\n            if m_squared_0 = 0:\n                # Evanescent wave, no upward flux\n                continue\n\n            m0 = np.sqrt(m_squared_0)\n            \n            # Calculate magnitude of momentum flux at the surface\n            J0 = 0.5 * rho_0 * m0 * k * (U0**2) * (h0**2)\n            \n            # 2. Vertical Propagation\n            flux_deposited = False\n            for i in range(1, len(z_levels)):\n                zi = z_levels[i]\n                Ui = U_func(zi)\n                Ni = N_func(zi)\n                \n                # Check for critical level\n                if abs(Ui)  U_crit:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n\n                m_squared_i = (Ni**2 / Ui**2) - k**2\n\n                # Check for turning level\n                if m_squared_i = 0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n                \n                mi = np.sqrt(m_squared_i)\n\n                # Check for saturation (wave breaking)\n                # Saturation criterion S^2 >= 1, where S^2 = (2 * J0 * m_i) / (rho_0 * k * U_i^2)\n                saturation_param_sq = (2.0 * J0 * mi) / (rho_0 * k * Ui**2)\n                if saturation_param_sq >= 1.0:\n                    total_deposition[i] += J0\n                    flux_deposited = True\n                    break\n            \n            # The problem implies that if a wave reaches the top without breaking,\n            # its momentum is not deposited in the specified domain.\n            \n        # Format results for the current case\n        case_results_rounded = [round(val, 6) for val in total_deposition]\n        all_results.append(case_results_rounded)\n    \n    # Format the final output string as specified\n    formatted_case_results = []\n    for res_list in all_results:\n        formatted_list = f\"[{','.join(f'{x:.6f}' for x in res_list)}]\"\n        formatted_case_results.append(formatted_list)\n    \n    final_output_string = f\"[{','.join(formatted_case_results)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}