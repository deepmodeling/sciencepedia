{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of geophysical fluid dynamics is understanding when the complex horizontal momentum equations can be simplified. This exercise guides you through a formal scale analysis to derive the Rossby number, $Ro$, a dimensionless parameter that quantifies the ratio of inertial to Coriolis forces. Mastering this derivation is crucial for rigorously defining the domain of validity for the geostrophic approximation, which underpins our understanding of large-scale atmospheric and oceanic circulation .",
            "id": "4048767",
            "problem": "Consider a midlatitude synoptic-scale flow on a rotating, stratified Earth, approximated as Boussinesq and hydrostatic, with negligible friction at leading order. The horizontal momentum equations in a frame rotating with the Earth contain material acceleration and Coriolis acceleration. Using a characteristic horizontal velocity scale $U$ and horizontal length scale $L$, perform a nondimensionalization of the horizontal momentum equations on an $f$-plane, where the Coriolis parameter is $f(\\phi)=2\\Omega \\sin\\phi$ and $\\phi$ is latitude. From first principles of scale analysis, identify the dimensionless parameter that measures the ratio of inertial (advective and centripetal) acceleration to Coriolis acceleration for synoptic systems, and derive its dependence on $U$, $L$, and $f$.\n\nThen, evaluate this parameter for a representative midlatitude synoptic system with $U=20\\,\\mathrm{m\\,s^{-1}}$ and $L=1000\\,\\mathrm{km}$ at latitude $\\phi=45^\\circ$, using the Earth's rotation rate $\\Omega=7.292\\times 10^{-5}\\,\\mathrm{s^{-1}}$. Take $\\phi$ in degrees. Round your numerical answer to four significant figures and express it as a pure number (dimensionless).",
            "solution": "The problem requires the derivation of a dimensionless parameter from the horizontal momentum equations for synoptic-scale flow and its numerical evaluation. The validation process confirms the problem is scientifically sound, well-posed, and objective.\n\nThe horizontal momentum equations for a fluid on a rotating planet, neglecting friction and in the Boussinesq approximation, can be written in vector form as:\n$$ \\frac{D\\mathbf{u}}{Dt} = -f\\mathbf{k} \\times \\mathbf{u} - \\frac{1}{\\rho_0} \\nabla_h p $$\nwhere $\\mathbf{u}$ is the horizontal velocity vector, $t$ is time, $\\frac{D}{Dt} = \\frac{\\partial}{\\partial t} + \\mathbf{u} \\cdot \\nabla_h$ is the material derivative, $f$ is the Coriolis parameter, $\\mathbf{k}$ is the local vertical unit vector, $\\rho_0$ is a constant reference density, and $\\nabla_h p$ is the horizontal pressure gradient.\n\nThe term on the left, $\\frac{D\\mathbf{u}}{Dt}$, represents the inertial acceleration of a fluid parcel relative to the rotating frame of reference. The first term on the right, $-f\\mathbf{k} \\times \\mathbf{u}$, is the Coriolis acceleration. The problem asks for the ratio of the inertial acceleration to the Coriolis acceleration. We can determine the characteristic magnitude of these two terms through scale analysis.\n\nLet $U$ be the characteristic horizontal velocity scale and $L$ be the characteristic horizontal length scale. The variables can be scaled as follows:\n- Horizontal velocity: a component like $u$ or $v$ scales as $U$. So, $|\\mathbf{u}| \\sim U$.\n- Horizontal gradients: $\\nabla_h$ scales as $1/L$.\n- The material derivative contains two parts: the local time derivative $\\frac{\\partial}{\\partial t}$ and the advective derivative $\\mathbf{u} \\cdot \\nabla_h$. For synoptic-scale systems, the characteristic advective time scale is $T \\sim L/U$. Thus, the local time derivative scales as $\\frac{\\partial}{\\partial t} \\sim \\frac{1}{T} = \\frac{U}{L}$.\n\nLet us now find the magnitude of the inertial and Coriolis acceleration terms.\n\n1.  **Inertial Acceleration**: The inertial acceleration is given by the material derivative, $\\frac{D\\mathbf{u}}{Dt} = \\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla_h)\\mathbf{u}$.\n    The magnitude of the local time derivative term is:\n    $$ \\left| \\frac{\\partial \\mathbf{u}}{\\partial t} \\right| \\sim \\frac{U}{T} = \\frac{U}{L/U} = \\frac{U^2}{L} $$\n    The magnitude of the advective derivative term is:\n    $$ \\left| (\\mathbf{u} \\cdot \\nabla_h)\\mathbf{u} \\right| \\sim (U \\cdot \\frac{1}{L}) U = \\frac{U^2}{L} $$\n    Since both components of the inertial acceleration have the same characteristic magnitude, the overall magnitude of the inertial acceleration is:\n    $$ \\left| \\frac{D\\mathbf{u}}{Dt} \\right| \\sim \\frac{U^2}{L} $$\n    This term encompasses both advective effects and centripetal acceleration due to the curvature of the flow path.\n\n2.  **Coriolis Acceleration**: The Coriolis acceleration is given by $-f\\mathbf{k} \\times \\mathbf{u}$. Its magnitude is:\n    $$ |-f\\mathbf{k} \\times \\mathbf{u}| = |f| |\\mathbf{u}| \\sin(\\theta) $$\n    where $\\theta$ is the angle between $\\mathbf{k}$ and $\\mathbf{u}$. Since $\\mathbf{u}$ is the horizontal velocity, it is perpendicular to the vertical vector $\\mathbf{k}$, so $\\theta = \\pi/2$ and $\\sin(\\theta)=1$.\n    The characteristic magnitude of the Coriolis acceleration is:\n    $$ | -f\\mathbf{k} \\times \\mathbf{u} | \\sim f U $$\n\nNow, we can derive the dimensionless parameter by taking the ratio of the magnitude of the inertial acceleration to the magnitude of the Coriolis acceleration. This parameter is known as the Rossby number, denoted $Ro$.\n$$ Ro = \\frac{\\text{Magnitude of Inertial Acceleration}}{\\text{Magnitude of Coriolis Acceleration}} = \\frac{U^2/L}{fU} $$\n$$ Ro = \\frac{U}{fL} $$\nThis expression shows the dependence of the dimensionless parameter on the characteristic scales $U$, $L$, and the Coriolis parameter $f$.\n\nNext, we evaluate this parameter for the given values:\n-   Characteristic horizontal velocity scale: $U = 20\\,\\mathrm{m\\,s^{-1}}$\n-   Characteristic horizontal length scale: $L = 1000\\,\\mathrm{km} = 1000 \\times 10^3\\,\\mathrm{m} = 10^6\\,\\mathrm{m}$\n-   Earth's rotation rate: $\\Omega = 7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}}$\n-   Latitude: $\\phi = 45^\\circ$\n\nFirst, we calculate the Coriolis parameter $f$ at the given latitude. The problem specifies an $f$-plane approximation, so we use a constant value of $f$ evaluated at $\\phi = 45^\\circ$.\n$$ f = 2 \\Omega \\sin\\phi = 2 \\times (7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\sin(45^\\circ) $$\nUsing $\\sin(45^\\circ) = \\frac{\\sqrt{2}}{2}$, we have:\n$$ f = 2 \\times (7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\frac{\\sqrt{2}}{2} = \\sqrt{2} \\times 7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}} $$\n$$ f \\approx 1.031254 \\times 10^{-4}\\,\\mathrm{s^{-1}} $$\nNow, we substitute the values of $U$, $f$, and $L$ into the expression for the Rossby number:\n$$ Ro = \\frac{U}{fL} = \\frac{20\\,\\mathrm{m\\,s^{-1}}}{(1.031254 \\times 10^{-4}\\,\\mathrm{s^{-1}}) \\times (10^6\\,\\mathrm{m})} $$\n$$ Ro = \\frac{20}{1.031254 \\times 10^2} = \\frac{20}{103.1254} $$\n$$ Ro \\approx 0.193933... $$\nThe problem requires the answer to be rounded to four significant figures.\n$$ Ro \\approx 0.1939 $$\nThis value, being small compared to $1$, indicates that for midlatitude synoptic-scale flows, the Coriolis acceleration is dominant over the inertial acceleration, which is the basis for the geostrophic approximation.",
            "answer": "$$\\boxed{0.1939}$$"
        },
        {
            "introduction": "While geostrophic balance provides an excellent first approximation, it neglects the effect of flow curvature. This practice delves into the next level of dynamical balance, the gradient wind, which incorporates the centrifugal acceleration for steady, axisymmetric flow. By analyzing the resulting quadratic equation for wind speed, you will uncover a fundamental physical constraint that limits the intensity of high-pressure systems, a key asymmetry not captured by geostrophic theory .",
            "id": "4048715",
            "problem": "Consider a steady, horizontally nondivergent, axisymmetric flow around a closed isobar of radius $r$ centered on a pressure extremum in the Northern Hemisphere (NH). Assume constant air density $\\rho$, an Earth rotation rate $\\Omega$, and neglect vertical motion and friction. Let the tangential wind speed be $v$ (positive for counterclockwise, cyclonic flow in the NH, negative for clockwise, anticyclonic flow). The Coriolis parameter is $f = 2 \\Omega \\sin \\varphi$, where $\\varphi$ is latitude, and the radial pressure gradient is $\\partial p/\\partial r$ defined positive outward. Using Newton’s second law in a rotating frame and the kinematic relation for uniform circular motion, derive the steady radial force balance and express it as a quadratic equation in $v$. Then analyze the conditions under which this quadratic admits real solutions for physically meaningful wind (i.e., real $v$ whose magnitude $|v|$ is positive), paying particular attention to how these conditions differ between lows ($\\partial p/\\partial r  0$) and highs ($\\partial p/\\partial r  0$).\n\nFinally, evaluate the following specific anticyclonic case representative of a strong subtropical high: latitude $\\varphi = 12^\\circ$, radius $r = 1.50 \\times 10^{5}\\,\\mathrm{m}$, air density $\\rho = 1.20\\,\\mathrm{kg\\,m^{-3}}$, Earth rotation rate $\\Omega = 7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}}$, and outward pressure-gradient acceleration magnitude $S \\equiv - (1/\\rho)\\,\\partial p/\\partial r = 2.0 \\times 10^{-3}\\,\\mathrm{m\\,s^{-2}}$ (appropriate for a high since $\\partial p/\\partial r  0$ makes $S0$). Based on your derived criterion, determine whether a real solution exists.\n\nWhich option correctly states the criterion for the existence of real solutions and gives the correct physical interpretation and conclusion for the numerical case?\n\nA. The quadratic in $v$ has real roots if and only if $- (1/\\rho)\\,\\partial p/\\partial r \\le \\dfrac{f^{2} r}{4}$. In the numerical case, $f = 2 \\Omega \\sin \\varphi$ is small at $12^\\circ$, the inequality fails, so no gradient-wind balance exists for this anticyclone; physically, the combined centrifugal-plus-Coriolis term $v^{2}/r + f v$ has a finite minimum $- f^{2} r / 4$ at $v = - f r / 2$, which is insufficient to offset the outward pressure-gradient acceleration.\n\nB. Real roots exist if and only if $\\left| (1/\\rho)\\,\\partial p/\\partial r \\right| \\le f\\,v$; therefore one can always obtain balance by choosing sufficiently large $|v|$, even at the equator. In the numerical case, a solution is admitted with $|v| = \\sqrt{r S}$.\n\nC. For highs, the discriminant condition is $- (1/\\rho)\\,\\partial p/\\partial r \\ge \\dfrac{f^{2} r}{4}$; thus stronger highs are easier to balance at lower latitudes. The numerical case therefore has a valid solution corresponding to the larger-magnitude negative root.\n\nD. The gradient-wind quadratic always has at least one real root because $v^{2}/r \\ge 0$, but negative roots are unphysical and must be discarded. In the numerical case, the negative root is rejected and the positive one accepted as the cyclostrophic solution.",
            "solution": "Start from Newton’s second law in a rotating frame for steady, horizontal, axisymmetric flow about a center of curvature. In cylindrical coordinates with radial unit vector outward, the radial momentum equation for steady motion and no radial velocity is obtained by balancing accelerations:\n\n- The pressure-gradient acceleration is $- (1/\\rho)\\,\\partial p/\\partial r$, directed toward lower pressure; its radial component is negative (inward) for a low ($\\partial p/\\partial r  0$) and positive (outward) for a high ($\\partial p/\\partial r  0$).\n- The centrifugal acceleration associated with uniform circular motion of speed $v$ and curvature radius $r$ is $v^{2}/r$, directed outward.\n- The Coriolis acceleration has magnitude $f\\,|v|$ and is directed to the right of the motion in the NH. With $v$ taken positive for cyclonic (counterclockwise) flow, the radial Coriolis component is $+ f v$ (outward) when $v0$ and $- f |v|$ (inward) when $v0$. In signed form, the radial Coriolis component can be written compactly as $f v$.\n\nThe steady radial balance is therefore\n$$\n- \\frac{1}{\\rho}\\,\\frac{\\partial p}{\\partial r} + \\frac{v^{2}}{r} + f\\,v \\;=\\; 0.\n$$\nIntroduce the outward pressure-gradient acceleration\n$$\nS \\;\\equiv\\; - \\frac{1}{\\rho}\\,\\frac{\\partial p}{\\partial r},\n$$\nso that $S0$ for a low and $S0$ for a high. The balance becomes a quadratic in $v$,\n$$\n\\frac{v^{2}}{r} + f v + S \\;=\\; 0 \\quad \\Longleftrightarrow \\quad v^{2} + f r\\, v + S r \\;=\\; 0.\n$$\nThe discriminant of this quadratic is\n$$\n\\Delta \\;=\\; (f r)^{2} - 4 (S r) \\;=\\; f^{2} r^{2} - 4 S r.\n$$\nReal solutions exist if and only if $\\Delta \\ge 0$. Consider lows and highs separately:\n\n1. Lows ($S0$): Then $-4 S r = 4 |S| r  0$, so $\\Delta = f^{2} r^{2} + 4 |S| r  0$ for any finite $f$, $r$, and $S$. Thus the quadratic always has two real roots. Because the product of the roots is $S r0$, one root is positive and one is negative. The physically relevant NH low has $v0$ (cyclonic), i.e., the positive root, which yields a real, positive magnitude $|v|$.\n\n2. Highs ($S0$): Now $-4 S r  0$, so $\\Delta \\ge 0$ imposes the inequality\n$$\nf^{2} r^{2} - 4 S r \\;\\ge\\; 0 \n\\quad \\Longleftrightarrow \\quad \nS \\;\\le\\; \\frac{f^{2} r}{4}.\n$$\nEquivalently, expressed in terms of the radial pressure gradient,\n$$\n- \\frac{1}{\\rho}\\,\\frac{\\partial p}{\\partial r} \\;\\le\\; \\frac{f^{2} r}{4}.\n$$\nThis is a necessary and sufficient condition for the existence of any real solution for a high. The sum of the roots is $- f r  0$ and the product is $S r  0$, so both roots are negative when they exist. In the NH, a high has clockwise (anticyclonic) flow, which corresponds to $v0$; hence a negative root is physically acceptable and yields a positive speed magnitude $|v|$.\n\nThe physical interpretation of the inequality for highs can be obtained by analyzing the function\n$$\ng(v) \\;\\equiv\\; \\frac{v^{2}}{r} + f v,\n$$\nwhich represents the combined outward centrifugal and signed radial Coriolis contributions. The function $g(v)$ is a convex parabola with minimum at\n$$\n\\frac{d g}{d v} \\;=\\; \\frac{2 v}{r} + f \\;=\\; 0 \\quad \\Rightarrow \\quad v^{\\ast} \\;=\\; - \\frac{f r}{2},\n$$\nand minimum value\n$$\ng_{\\min} \\;=\\; \\frac{(v^{\\ast})^{2}}{r} + f v^{\\ast} \\;=\\; \\frac{f^{2} r}{4} - \\frac{f^{2} r}{2} \\;=\\; - \\frac{f^{2} r}{4}.\n$$\nFor a high, the outward pressure-gradient acceleration is $S0$. The radial balance $g(v) + S = 0$ can only be met if the most negative value of $g(v)$, namely $- f^{2} r / 4$, is large enough in magnitude to offset $S$. If $S  f^{2} r / 4$, then $g(v) + S  0$ for all $v$ and no real solution exists: the outward pressure-gradient acceleration cannot be countered by any combination of inward Coriolis (linear in $v$) and outward centrifugal (quadratic in $v$). This failure is most likely at low latitudes (small $f$) and small radii $r$, precisely the conditions of certain strong subtropical highs.\n\nNumerical evaluation for the given anticyclone:\n- Latitude $\\varphi = 12^\\circ$ gives \n$$\nf \\;=\\; 2 \\Omega \\sin \\varphi \\;=\\; 2 \\times (7.292 \\times 10^{-5}\\,\\mathrm{s^{-1}}) \\times \\sin(12^\\circ).\n$$\nCompute $\\sin(12^\\circ) \\approx 0.2079$, so\n$$\nf \\;\\approx\\; 2 \\times 7.292 \\times 10^{-5} \\times 0.2079 \\;\\approx\\; 3.03 \\times 10^{-5}\\,\\mathrm{s^{-1}}.\n$$\n- With $r = 1.50 \\times 10^{5}\\,\\mathrm{m}$, the threshold is\n$$\n\\frac{f^{2} r}{4} \\;=\\; \\frac{(3.03 \\times 10^{-5})^{2} \\times (1.50 \\times 10^{5})}{4}\n\\;\\approx\\; \\frac{9.18 \\times 10^{-10} \\times 1.50 \\times 10^{5}}{4}\n\\;\\approx\\; \\frac{1.377 \\times 10^{-4}}{4}\n\\;\\approx\\; 3.44 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}.\n$$\n- The given $S = 2.0 \\times 10^{-3}\\,\\mathrm{m\\,s^{-2}}$ far exceeds $3.44 \\times 10^{-5}\\,\\mathrm{m\\,s^{-2}}$, so the inequality $S \\le f^{2} r / 4$ is violated and the discriminant is negative. Therefore, no real solution exists for the gradient-wind balance in this anticyclone: the flow cannot be in steady gradient balance under the stated conditions.\n\nOption-by-option analysis:\n\nA. This option states the correct necessary and sufficient criterion for real roots for highs, $- (1/\\rho)\\,\\partial p/\\partial r \\le f^{2} r / 4$, and provides the correct physical interpretation via the minimum of $v^{2}/r + f v$ at $v = - f r / 2$. The numerical conclusion is correct: with $S$ much larger than $f^{2} r / 4$, there is no gradient-wind solution. Verdict: Correct.\n\nB. This option proposes $\\left| (1/\\rho)\\,\\partial p/\\partial r \\right| \\le f v$ as the criterion, which is not the discriminant condition for the quadratic and is dimensionally inconsistent unless $v$ is treated as an unknown within the criterion. It also asserts that arbitrarily large $|v|$ can always yield balance, which is false for highs because increasing $|v|$ increases outward centrifugal $v^{2}/r$ quadratically and inward Coriolis $f v$ linearly, yielding a finite maximum inward net of $- f^{2} r / 4$. The suggested $|v| = \\sqrt{r S}$ corresponds to equating $v^{2}/r$ to $S$, which neglects Coriolis and does not satisfy the signed balance for a high. Verdict: Incorrect.\n\nC. This option reverses the inequality for highs, claiming $- (1/\\rho)\\,\\partial p/\\partial r \\ge f^{2} r / 4$. The direction of the inequality is wrong; stronger highs at lower latitudes are harder (not easier) to balance because $f$ is smaller. The numerical conclusion is therefore wrong. Verdict: Incorrect.\n\nD. This option claims there is always at least one real root because $v^{2}/r \\ge 0$, which ignores the discriminant condition; for highs with $S  f^{2} r / 4$, there are no real roots at all. It further claims negative roots are unphysical, which is incorrect: negative $v$ is the physically appropriate anticyclonic direction in the NH, and the speed magnitude $|v|$ is positive. The appeal to a “cyclostrophic solution” in this context is also misplaced because cyclostrophic balance would require neglecting Coriolis, whereas the impossibility here stems from the combined quadratic-plus-linear structure of $v^{2}/r + f v$. Verdict: Incorrect.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Translating theoretical equations into practical algorithms is a central skill in Earth system modeling. This comprehensive computational exercise tasks you with building a program to calculate the geostrophic wind field from gridded geopotential data on a spherical Earth. You will implement finite-difference schemes, handle coordinate transformations using metric factors, and manage the singularity at the equator, providing a foundational experience in diagnosing atmospheric fields from model or observational data .",
            "id": "3883018",
            "problem": "You are given the task of designing and implementing a program that, starting from geopotential fields at a single pressure level on a latitude–longitude grid for an idealized Earth, computes the geostrophic wind vector. Your implementation must be grounded in first principles, beginning with the horizontal momentum equations on a rotating sphere and the definition of geopotential. You must explicitly handle unit conversions, metric factors on the sphere, and finite-difference approximations of horizontal gradients on a latitude–longitude grid. The program must also generate analytic reference solutions for specified test fields and quantify numerical error.\n\nFundamental bases to use:\n- Newton’s second law in a rotating reference frame and the inviscid, steady horizontal momentum balance on an $f$-plane where acceleration and friction are negligible, leading to a geostrophic balance between the horizontal pressure gradient force and the Coriolis force.\n- The relation between geopotential height and geopotential, where geopotential height times standard gravity equals geopotential.\n\nYour derivation must:\n- Begin from the steady, inviscid horizontal momentum equations on a rotating sphere, reduce to the geostrophic balance, and obtain component relations between the geostrophic wind vector and the horizontal gradient of geopotential in local east–north coordinates.\n- Relate partial derivatives with respect to longitude and latitude to local Cartesian components using spherical metric factors that depend on latitude.\n- Specify the finite-difference schemes for partial derivatives on the latitude–longitude grid, including periodic treatment in longitude and boundary treatment in latitude.\n- Specify how to convert from geopotential height to geopotential if the input field is provided as geopotential height, including the numerical value to use for standard gravity.\n\nComputational details to implement:\n- Use Earth radius $a$ equal to $6.371\\times 10^{6}$ meters and Earth rotation rate $\\Omega$ equal to $7.292115\\times 10^{-5}$ per second.\n- Use standard gravity $g_{0}$ equal to $9.80665$ meters per second squared when converting geopotential height $Z$ to geopotential $\\Phi$ via $\\Phi = g_{0} Z$.\n- The Coriolis parameter is $f = 2 \\Omega \\sin(\\varphi)$, where $\\varphi$ is latitude in radians.\n- The grid is regular in degrees with longitudes from $0^\\circ$ to less than $360^\\circ$ in increments of $5^\\circ$ and latitudes from $-80^\\circ$ to $+80^\\circ$ in increments of $5^\\circ$. Your program must internally convert degrees to radians where needed.\n- Compute horizontal gradients using finite differences with respect to longitude and latitude measured in radians. Use a central-difference stencil in the interior. Treat longitude as periodic and latitude as non-periodic with a one-sided second-order accurate stencil at the first and last latitude rows.\n- Map longitudinal and latitudinal derivatives to local east–west and north–south derivatives using spherical metric factors.\n- Compute the geostrophic wind components and handle the singularity near the equator by imposing a minimum magnitude threshold for $|f|$. Specifically, if $|f|  f_{\\min}$ with $f_{\\min} = 10^{-5}$ per second, treat the geostrophic wind as undefined at that grid point and represent it as Not-a-Number. This convention must be used consistently in both numerical and analytic reference evaluations and must be ignored when aggregating error statistics.\n\nAngle unit specification:\n- All input longitudes and latitudes are in degrees. All internal trigonometric and differentiation operations must use radians.\n\nPhysical unit specification:\n- Input geopotential $\\Phi$ must be in meters squared per second squared. If the input field is provided as geopotential height $Z$ in meters, convert to $\\Phi$ in meters squared per second squared using the specified standard gravity before any differentiation. Output geostrophic wind components must be in meters per second, and error metrics must be reported in meters per second.\n\nTest suite:\nImplement the following three test cases, each producing a two-tuple of root-mean-square errors for the zonal and meridional geostrophic wind components computed numerically versus analytic reference derived from the same fundamental laws:\n\n- Case $1$ (meridional-only variation, happy path with equator singularity present): The input field is geopotential $\\Phi(\\lambda,\\varphi) = A \\sin(\\varphi)$, where $\\lambda$ is longitude and $\\varphi$ is latitude, both in radians. Use $A = 5.0\\times 10^{3}$ meters squared per second squared. This case exercises the latitudinal gradient and yields a zero meridional geostrophic component by symmetry. Ensure that points with $|f|  f_{\\min}$ are excluded from error aggregation.\n- Case $2$ (zonal–meridional coupled variation, periodic longitude check): The input field is geopotential $\\Phi(\\lambda,\\varphi) = B \\cos(\\lambda)\\cos(\\varphi)$ with $B = 1.2\\times 10^{4}$ meters squared per second squared. This case exercises both zonal and meridional gradients and the periodic boundary in longitude.\n- Case $3$ (unit conversion edge case with wavenumber two): The input field is geopotential height $Z(\\lambda,\\varphi) = C_{z} \\cos(2\\lambda) + D_{z} \\sin(2\\varphi)$ in meters, with $C_{z} = 250$ meters and $D_{z} = 150$ meters. Convert this to geopotential using $\\Phi = g_{0} Z$ before computing gradients. This case exercises unit conversion and higher zonal and meridional wavenumbers.\n\nFor each case:\n- Construct the field on the specified grid.\n- Compute numerical geostrophic wind components using your finite-difference scheme and spherical metric factors.\n- Independently derive analytic geostrophic wind components from the continuous field and the same fundamental geostrophic balance, using exact derivatives with respect to $\\lambda$ and $\\varphi$.\n- Compute the root-mean-square error over all grid points where the geostrophic wind is defined, separately for the zonal component and the meridional component. Exclude undefined points marked as Not-a-Number from the aggregation.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[E_{u,1},E_{v,1},E_{u,2},E_{v,2},E_{u,3},E_{v,3}]$, where $E_{u,i}$ and $E_{v,i}$ are the root-mean-square errors in meters per second for the zonal and meridional components for case $i$, respectively. For example, a syntactically valid output would look like $[0.0123,0.0456,0.0011,0.0022,0.0333,0.0444]$.",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded task in computational atmospheric dynamics. All necessary constants, equations, boundary conditions, and numerical methods are specified, allowing for a unique and verifiable solution. The problem is self-contained, internally consistent, and free of ambiguity or factual error.\n\nThe design of the program to compute the geostrophic wind is based on fundamental principles of fluid dynamics on a rotating sphere. The derivation and implementation steps are outlined below.\n\n### 1. Fundamental Governing Equations\nThe starting point is the horizontal momentum balance for a fluid on a rotating sphere. In the absence of friction and assuming a steady state ($\\frac{D}{Dt}=0$), the inviscid horizontal momentum equations are considered. For large-scale atmospheric motions, the advective and metric curvature terms (e.g., $\\frac{u^2 \\tan\\varphi}{a}$) are small compared to the Coriolis and pressure gradient forces. This leads to the geostrophic balance, where the Coriolis force exactly balances the horizontal pressure gradient force.\n\nIn a local Cartesian coordinate system with $x$ pointing east (zonal direction) and $y$ pointing north (meridional direction), the balance is expressed as:\n$$ -f v_g = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} $$\n$$ f u_g = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial y} $$\nHere, $u_g$ is the zonal component of the geostrophic wind, $v_g$ is the meridional component, $p$ is the pressure, $\\rho$ is the density, and $f = 2\\Omega\\sin(\\varphi)$ is the Coriolis parameter, where $\\Omega$ is the Earth's rotation rate and $\\varphi$ is the latitude.\n\n### 2. Geopotential Formulation\nOn a surface of constant pressure (an isobaric surface), the horizontal pressure gradient force per unit mass, $-\\frac{1}{\\rho}\\nabla_h p$, is equal to the negative of the horizontal gradient of geopotential, $-\\nabla_h \\Phi$. The geopotential $\\Phi$ is defined as the work required to lift a unit mass from sea level to a certain height, and is related to the geopotential height $Z$ by $\\Phi = g_0 Z$, where $g_0$ is the standard gravity at sea level.\n\nThe components of the horizontal gradient of geopotential on a sphere of radius $a$ are given in terms of partial derivatives with respect to longitude $\\lambda$ and latitude $\\varphi$:\n$$ \\frac{\\partial \\Phi}{\\partial x} = \\frac{1}{a \\cos\\varphi} \\frac{\\partial \\Phi}{\\partial \\lambda} $$\n$$ \\frac{\\partial \\Phi}{\\partial y} = \\frac{1}{a} \\frac{\\partial \\Phi}{\\partial \\varphi} $$\nThe terms $\\frac{1}{a \\cos\\varphi}$ and $\\frac{1}{a}$ are the metric factors relating angular displacements ($d\\lambda, d\\varphi$) to physical distances in the east-west and north-south directions, respectively.\n\nSubstituting the geopotential gradient components into the geostrophic balance equations gives:\n$$ -f v_g = -\\frac{1}{a \\cos\\varphi} \\frac{\\partial \\Phi}{\\partial \\lambda} $$\n$$ f u_g = -\\frac{1}{a} \\frac{\\partial \\Phi}{\\partial \\varphi} $$\n\nSolving for the geostrophic wind components yields the final set of equations to be implemented:\n$$ u_g = -\\frac{1}{f a} \\frac{\\partial \\Phi}{\\partial \\varphi} $$\n$$ v_g = \\frac{1}{f a \\cos\\varphi} \\frac{\\partial \\Phi}{\\partial \\lambda} $$\n\n### 3. Numerical Discretization on a Latitude-Longitude Grid\nThe continuous geopotential field $\\Phi(\\lambda, \\varphi)$ is provided on a discrete grid. The partial derivatives $\\frac{\\partial \\Phi}{\\partial \\lambda}$ and $\\frac{\\partial \\Phi}{\\partial \\varphi}$ must be approximated using finite differences. All angular variables ($\\lambda, \\varphi$) and their increments ($d\\lambda, d\\varphi$) are converted from degrees to radians for calculations.\n\nThe grid has uniform spacing in longitude and latitude.\n-   **Zonal Gradient ($\\frac{\\partial \\Phi}{\\partial \\lambda}$)**: Longitude is periodic. A second-order central difference scheme is used, which naturally handles the periodicity by \"wrapping around\" at the boundaries. For a field $\\Phi$ on the grid, the derivative at longitude index $i$ is approximated as:\n    $$ \\left(\\frac{\\partial \\Phi}{\\partial \\lambda}\\right)_i \\approx \\frac{\\Phi_{i+1} - \\Phi_{i-1}}{2 d\\lambda} $$\n    where indices are taken modulo the number of longitude points. This is efficiently implemented using `np.roll`.\n\n-   **Meridional Gradient ($\\frac{\\partial \\Phi}{\\partial \\varphi}$)**: Latitude is not periodic. A second-order central difference is used for interior points. At the minimum and maximum latitude boundaries, second-order accurate one-sided (forward and backward, respectively) stencils are required:\n    -   At the first latitude row ($j=0$): $\\frac{-3\\Phi_0 + 4\\Phi_1 - \\Phi_2}{2 d\\varphi}$\n    -   At the last latitude row ($j=N-1$): $\\frac{3\\Phi_{N-1} - 4\\Phi_{N-2} + \\Phi_{N-3}}{2 d\\varphi}$\n    This entire scheme is conveniently implemented using `numpy.gradient` with the `edge_order=2` option.\n\n### 4. Handling of the Equatorial Singularity\nThe equations for $u_g$ and $v_g$ have the Coriolis parameter $f$ in the denominator. Since $f = 2\\Omega\\sin\\varphi$, it approaches zero at the equator ($\\varphi=0$), leading to a singularity. To handle this computationally, a minimum threshold $f_{\\min} = 10^{-5} \\text{ s}^{-1}$ is established. At any grid point where $|f|  f_{\\min}$, the geostrophic wind is considered undefined. In the implementation, these values are set to Not-a-Number (`NaN`). This masking is applied to both the numerically computed wind and the analytically derived reference wind.\n\n### 5. Analytic Reference and Error Quantification\nFor each test case, the provided continuous function for geopotential $\\Phi(\\lambda, \\varphi)$ allows for the exact calculation of the partial derivatives $\\frac{\\partial \\Phi}{\\partial \\lambda}$ and $\\frac{\\partial \\Phi}{\\partial \\varphi}$. These exact derivatives are then used in the geostrophic wind equations to compute the analytical (\"true\") wind components, $u_{g, \\text{analytic}}$ and $v_{g, \\text{analytic}}$.\n\nThe analytic solutions for the three test cases are:\n-   **Case 1:** $\\Phi = A \\sin(\\varphi)$\n    $$ u_{g, \\text{analytic}} = -\\frac{A}{2 \\Omega a} \\cot(\\varphi) $$\n    $$ v_{g, \\text{analytic}} = 0 $$\n-   **Case 2:** $\\Phi = B \\cos(\\lambda)\\cos(\\varphi)$\n    $$ u_{g, \\text{analytic}} = \\frac{B \\cos(\\lambda)}{2 \\Omega a} $$\n    $$ v_{g, \\text{analytic}} = -\\frac{B \\sin(\\lambda)}{2 \\Omega a \\sin\\varphi} $$\n-   **Case 3:** $Z = C_{z} \\cos(2\\lambda) + D_{z} \\sin(2\\varphi)$, with $\\Phi = g_0 Z$\n    $$ u_{g, \\text{analytic}} = -\\frac{g_0 D_{z} \\cos(2\\varphi)}{\\Omega a \\sin\\varphi} $$\n    $$ v_{g, \\text{analytic}} = -\\frac{g_0 C_{z} \\sin(2\\lambda)}{\\Omega a \\sin\\varphi \\cos\\varphi} $$\n\nThe accuracy of the numerical scheme is quantified by the Root-Mean-Square Error (RMSE) between the numerical and analytical wind fields. For the zonal component, the RMSE is:\n$$ E_u = \\sqrt{\\frac{\\sum (u_{g, \\text{numerical}} - u_{g, \\text{analytic}})^2}{N_{\\text{valid}}}} $$\nwhere the sum is over all $N_{\\text{valid}}$ grid points where the wind is defined (i.e., not `NaN`). A corresponding expression is used for the meridional component $E_v$. The `np.nanmean` function is used for this purpose as it automatically ignores `NaN` values.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes geostrophic wind from geopotential fields, evaluates numerical error against \n    analytic solutions for three test cases, and prints the results.\n    \"\"\"\n    \n    # Define physical constants as per the problem statement.\n    A_EARTH = 6.371e6  # Earth radius in meters\n    OMEGA = 7.292115e-5  # Earth rotation rate in per second\n    G0 = 9.80665  # Standard gravity in m/s^2\n    F_MIN = 1e-5  # Minimum Coriolis parameter magnitude in per second\n\n    def setup_grid():\n        \"\"\"\n        Initializes the latitude-longitude grid and related parameters.\n        \"\"\"\n        lons_deg = np.arange(0, 360, 5)\n        lons_rad = np.deg2rad(lons_deg)\n        d_lambda = np.deg2rad(5.0)\n\n        lats_deg = np.arange(-80, 80.1, 5)\n        lats_rad = np.deg2rad(lats_deg)\n        d_phi = np.deg2rad(5.0)\n\n        lambda_mesh, phi_mesh = np.meshgrid(lons_rad, lats_rad)\n        f_field = 2 * OMEGA * np.sin(phi_mesh)\n        \n        grid_params = {\n            \"lambda_mesh\": lambda_mesh,\n            \"phi_mesh\": phi_mesh,\n            \"d_lambda\": d_lambda,\n            \"d_phi\": d_phi,\n            \"f_field\": f_field,\n        }\n        return grid_params\n\n    def compute_numerical_derivatives(Phi_field, d_lambda, d_phi):\n        \"\"\"\n        Computes horizontal gradients of a field on the spherical grid \n        using finite differences.\n        \"\"\"\n        # Zonal derivative (d/d_lambda) with periodic boundary condition\n        dPhi_dlambda = (np.roll(Phi_field, -1, axis=1) - np.roll(Phi_field, 1, axis=1)) / (2 * d_lambda)\n        \n        # Meridional derivative (d/d_phi) with second-order one-sided boundaries\n        dPhi_dphi = np.gradient(Phi_field, d_phi, axis=0, edge_order=2)\n        \n        return dPhi_dlambda, dPhi_dphi\n\n    def compute_wind_components(dPhi_dlambda, dPhi_dphi, f_field, phi_mesh):\n        \"\"\"\n        Computes geostrophic wind components from geopotential gradients.\n        \"\"\"\n        # Create a mask for the near-equatorial singularity\n        mask = np.abs(f_field)  F_MIN\n\n        # Compute u_g = -(1 / (f * a)) * (dPhi / d_phi)\n        factor_u = np.full_like(f_field, np.nan)\n        np.divide(-1.0, f_field * A_EARTH, out=factor_u, where=~mask)\n        u_g = factor_u * dPhi_dphi\n\n        # Compute v_g = (1 / (f * a * cos(phi))) * (dPhi / d_lambda)\n        factor_v = np.full_like(f_field, np.nan)\n        denom_v = f_field * A_EARTH * np.cos(phi_mesh)\n        np.divide(1.0, denom_v, out=factor_v, where=~mask)\n        v_g = factor_v * dPhi_dlambda\n        \n        return u_g, v_g\n\n    def get_test_case_fields(case_id, grid, params):\n        \"\"\"\n        Generates the geopotential field and its analytical derivatives for a given test case.\n        \"\"\"\n        lambda_mesh, phi_mesh = grid[\"lambda_mesh\"], grid[\"phi_mesh\"]\n        \n        if case_id == 1:\n            A = params[0]\n            Phi = A * np.sin(phi_mesh)\n            dPhi_dlambda_an = np.zeros_like(lambda_mesh)\n            dPhi_dphi_an = A * np.cos(phi_mesh)\n        elif case_id == 2:\n            B = params[0]\n            Phi = B * np.cos(lambda_mesh) * np.cos(phi_mesh)\n            dPhi_dlambda_an = -B * np.sin(lambda_mesh) * np.cos(phi_mesh)\n            dPhi_dphi_an = -B * np.cos(lambda_mesh) * np.sin(phi_mesh)\n        elif case_id == 3:\n            Cz, Dz = params\n            Z = Cz * np.cos(2 * lambda_mesh) + Dz * np.sin(2 * phi_mesh)\n            Phi = G0 * Z\n            dPhi_dlambda_an = G0 * (-2 * Cz * np.sin(2 * lambda_mesh))\n            dPhi_dphi_an = G0 * (2 * Dz * np.cos(2 * phi_mesh))\n        else:\n            raise ValueError(\"Invalid case_id\")\n            \n        return Phi, dPhi_dlambda_an, dPhi_dphi_an\n\n    test_cases = [\n        # (case_id, (parameters...))\n        (1, (5.0e3,)),\n        (2, (1.2e4,)),\n        (3, (250.0, 150.0)),\n    ]\n\n    grid = setup_grid()\n    results = []\n\n    for case_id, params in test_cases:\n        # 1. Generate geopotential field and its analytical derivatives\n        Phi_field, dPhi_dlambda_an, dPhi_dphi_an = get_test_case_fields(case_id, grid, params)\n        \n        # 2. Compute numerical derivatives of the geopotential field\n        dPhi_dlambda_num, dPhi_dphi_num = compute_numerical_derivatives(\n            Phi_field, grid[\"d_lambda\"], grid[\"d_phi\"]\n        )\n        \n        # 3. Compute geostrophic wind from numerical derivatives\n        u_g_num, v_g_num = compute_wind_components(\n            dPhi_dlambda_num, dPhi_dphi_num, grid[\"f_field\"], grid[\"phi_mesh\"]\n        )\n        \n        # 4. Compute geostrophic wind from analytical derivatives (ground truth)\n        u_g_an, v_g_an = compute_wind_components(\n            dPhi_dlambda_an, dPhi_dphi_an, grid[\"f_field\"], grid[\"phi_mesh\"]\n        )\n        \n        # 5. Calculate Root-Mean-Square Error, ignoring NaN values\n        diff_u_sq = (u_g_num - u_g_an)**2\n        diff_v_sq = (v_g_num - v_g_an)**2\n        \n        rmse_u = np.sqrt(np.nanmean(diff_u_sq))\n        rmse_v = np.sqrt(np.nanmean(diff_v_sq))\n        \n        results.extend([rmse_u, rmse_v])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}