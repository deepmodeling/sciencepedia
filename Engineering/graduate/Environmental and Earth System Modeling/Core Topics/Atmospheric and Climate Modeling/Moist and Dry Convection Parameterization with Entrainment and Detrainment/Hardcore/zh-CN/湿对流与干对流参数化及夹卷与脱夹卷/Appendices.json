{
    "hands_on_practices": [
        {
            "introduction": "对流最基本的单元是上升的气块。第一个练习将模拟这一基础过程，重点关注环境混合（夹卷）和潜热释放如何影响气块的浮力。通过这个练习，你将亲手计算对流抑制能（$CIN$），这是启动对流所需克服的一个关键能量障碍，从而加深对对流触发机制的理解 。",
            "id": "3896701",
            "problem": "考虑一个用于在环境和地球系统建模中近似对流气块上升的一维夹卷羽流模型。令 $z$ 表示高度（单位：米），$z = 0$ 为地表，$z \\ge 0$ 指向天空。将环境虚位温廓线定义为高度的线性函数，\n$$\\theta_{v,e}(z) = \\theta_{v,0} + \\gamma_e z,$$\n其中 $\\theta_{v,0}$ 是地表环境虚位温（单位：开尔文），$\\gamma_e$ 是一个恒定的环境梯度（单位：开尔文/米）。一个上升的气块以速率 $\\epsilon$（单位：1/米）经历分数夹卷，这被建模为气块属性与环境的一阶混合。忽略出流对气块属性的影响。在抬升凝结高度（LCL）之上，潜热被参数化为一个恒定的源项，它以速率 $h_m$（单位：开尔文/米）增加气块的虚位温。气块虚位温 $\\theta_{v,p}(z)$ 根据以下常微分方程演变\n$$\\frac{d\\theta_{v,p}}{dz} = \\epsilon\\left(\\theta_{v,e}(z) - \\theta_{v,p}(z)\\right) + H(z),$$\n其中\n$$H(z) = \\begin{cases}\n0,  0 \\le z  z_{\\mathrm{LCL}},\\\\\nh_m,  z \\ge z_{\\mathrm{LCL}}.\n\\end{cases}$$\n气块相对于环境的浮力由下式给出\n$$B(z) = g \\frac{\\theta_{v,p}(z) - \\theta_{v,e}(z)}{\\theta_{v,e}(z)},$$\n其中 $g$ 是重力加速度（单位：米/秒²）。对流抑制能（CIN）是指将气块从地表抬升至其自由对流高度（LFC）所需的单位质量最小机械功，在自由对流高度，浮力首次变为非负值。形式上，将 $z_{\\mathrm{LFC}}$ 定义为 $B(z) \\ge 0$ 的最小高度，则 CIN 为\n$$\\mathrm{CIN}(\\epsilon) = - \\int_0^{z_{\\mathrm{LFC}}} \\min\\left(B(z), 0\\right) \\, dz.$$\n如果在固定的域顶 $z_{\\mathrm{top}}$ 以下不存在这样的 $z_{\\mathrm{LFC}}$，则定义\n$$\\mathrm{CIN}(\\epsilon) = - \\int_0^{z_{\\mathrm{top}}} \\min\\left(B(z), 0\\right) \\, dz.$$\n假设所有测试用例使用以下物理上合理的常数：\n- $g = 9.81$ 米/秒²，\n- $\\theta_{v,0} = 300$ 开尔文，\n- $\\gamma_e = 0.003$ 开尔文/米，\n- $z_{\\mathrm{LCL}} = 800$ 米，\n- $h_m = 0.005$ 开尔文/米，\n- $z_{\\mathrm{top}} = 3000$ 米，\n- 数值积分步长 $\\Delta z = 10$ 米。\n\n您必须对高度进行离散化，并对气块演变方程和浮力廓线进行积分，以计算每个参数集的 $\\mathrm{CIN}(\\epsilon)$。使用一种稳定的方法来检测 $z_{\\mathrm{LFC}}$，即 $B(z)$ 首次变为非负的高度；如果浮力在地表就变为非负，则对流抑制能为零。\n\n以焦耳/千克为单位表示每个最终的 $\\mathrm{CIN}$，四舍五入到一位小数。题目不涉及角度，因此无需指定角度单位。最终输出必须是单行，结果聚合为一个由方括号括起来的逗号分隔列表。\n\n测试套件：\n计算以下四种情况的 $\\mathrm{CIN}(\\epsilon)$，每种情况由分数夹卷率 $\\epsilon$（单位：1/米）和初始气块虚位温 $\\theta_{v,p}(0)$（单位：开尔文）定义：\n1. $(\\epsilon, \\theta_{v,p}(0)) = (0.0, 300.0)$,\n2. $(\\epsilon, \\theta_{v,p}(0)) = (2\\times 10^{-4}, 299.5)$,\n3. $(\\epsilon, \\theta_{v,p}(0)) = (10^{-3}, 299.0)$,\n4. $(\\epsilon, \\theta_{v,p}(0)) = (5\\times 10^{-4}, 301.0)$.\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4]”），其中每个结果是为相应测试用例计算的 CIN 值，单位为焦耳/千克，并四舍五入到一位小数。",
            "solution": "问题陈述已经过分析，并被认为是有效的。它在科学上基于大气热力学和对流原理，采用了一个标准的一维夹卷羽流模型。该问题是适定的，提供了一个具有明确初始条件和所有必要参数的一阶常微分方程。语言客观，要求清晰明确。\n\n此问题的解决方案涉及对气块虚位温廓线进行数值积分，随后计算其浮力廓线，最后对对流抑制能（CIN）积分进行数值评估。对每个指定的测试用例执行此过程。\n\n算法步骤如下：\n\n1.  **域离散化**：将连续的垂直域 $z \\in [0, z_{\\mathrm{top}}]$ 离散化为有限数量的点。我们定义一个均匀网格 $z_i = i \\cdot \\Delta z$，其中 $i = 0, 1, 2, \\dots, N$，$N = z_{\\mathrm{top}} / \\Delta z$。给定的参数为 $z_{\\mathrm{top}} = 3000$ 米和 $\\Delta z = 10$ 米，得到 $N=300$ 个区间和 $301$ 个网格点。\n\n2.  **环境廓线**：环境虚位温 $\\theta_{v,e}(z)$ 是高度的线性函数。其在每个离散网格点 $z_i$ 的值计算如下：\n    $$ \\theta_{v,e}(z_i) = \\theta_{v,0} + \\gamma_e z_i $$\n    其中 $\\theta_{v,0} = 300$ K 且 $\\gamma_e = 0.003$ K/m。\n\n3.  **气块虚位温廓线**：气块虚位温 $\\theta_{v,p}(z)$ 的演变由以下常微分方程（ODE）控制：\n    $$ \\frac{d\\theta_{v,p}}{dz} = \\epsilon\\left(\\theta_{v,e}(z) - \\theta_{v,p}(z)\\right) + H(z) $$\n    这是一个初值问题，每个测试用例都提供了 $\\theta_{v,p}(0)$。我们对这个 ODE 进行数值求解。一阶欧拉前向方法对于此问题结构是足够且合适的。从 $z_i$ 处的值求得网格点 $z_{i+1}$ 处的 $\\theta_{v,p}$ 的迭代方案是：\n    $$ \\theta_{v,p}(z_{i+1}) = \\theta_{v,p}(z_i) + \\Delta z \\left[ \\epsilon\\left(\\theta_{v,e}(z_i) - \\theta_{v,p}(z_i)\\right) + H(z_i) \\right] $$\n    加热项 $H(z_i)$ 由相对于抬升凝结高度 $z_{\\mathrm{LCL}} = 800$ 米的高度决定，其中 $h_m = 0.005$ K/m：\n    $$ H(z_i) = \\begin{cases} 0,  z_i  z_{\\mathrm{LCL}} \\\\ h_m,  z_i \\ge z_{\\mathrm{LCL}} \\end{cases} $$\n    此积分从 $z_0 = 0$ 到 $z_N = z_{\\mathrm{top}}$ 迭代执行。\n\n4.  **浮力廓线**：一旦所有网格点的气块和环境温度廓线 $\\theta_{v,p}(z_i)$ 和 $\\theta_{v,e}(z_i)$ 都已知，就可以使用其定义计算浮力廓线 $B(z_i)$：\n    $$ B(z_i) = g \\frac{\\theta_{v,p}(z_i) - \\theta_{v,e}(z_i)}{\\theta_{v,e}(z_i)} $$\n    其中 $g = 9.81$ m/s²。\n\n5.  **自由对流高度（LFC）**：LFC, $z_{\\mathrm{LFC}}$, 是气块浮力首次变为非负的最低高度。\n    *   首先，我们检查地表浮力 $B(0)$。如果 $B(0) \\ge 0$，则气块初始为正浮力或中性浮力。在此情况下，$z_{\\mathrm{LFC}} = 0$ 且 $\\mathrm{CIN} = 0$。\n    *   如果 $B(0)  0$，我们在离散浮力廓线 $B(z_i)$ 中搜索第一个索引 $i_{\\mathrm{LFC}}$，使得 $B(z_{i_{\\mathrm{LFC}}}) \\ge 0$。相应的高度为 $z_{\\mathrm{LFC}} = z_{i_{\\mathrm{LFC}}}$。\n    *   如果域内不存在这样的高度（即对于所有 $z_i \\le z_{\\mathrm{top}}$ 都有 $B(z_i)  0$），则 CIN 积分的上限变为 $z_{\\mathrm{top}}$。\n\n6.  **对流抑制能（CIN）计算**：CIN 通过对从地表到 LFC 的负浮力进行数值积分来计算。定义为：\n    $$ \\mathrm{CIN}(\\epsilon) = - \\int_0^{z_{\\mathrm{limit}}} \\min\\left(B(z), 0\\right) \\, dz $$\n    其中 $z_{\\mathrm{limit}}$ 是 LFC，如果未达到 LFC，则为 $z_{\\mathrm{top}}$。我们采用梯形法则进行此数值求积，它近似了从 $z_0$ 到 $z_{\\mathrm{limit}} = z_{i_{\\mathrm{limit}}}$ 的离散网格上的积分。被积函数是 $f(z_i) = \\min(B(z_i), 0)$。\n    $$ \\int_0^{z_{\\mathrm{limit}}} f(z) \\, dz \\approx \\sum_{j=0}^{i_{\\mathrm{limit}}-1} \\frac{f(z_j) + f(z_{j+1})}{2} \\Delta z $$\n    最终的 CIN 是这个值的负数。\n\n为四个测试用例中的每一个实施了此完整算法，并将所得的 CIN 值按要求四舍五入到一位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the convective inhibition problem for all test cases.\n    \"\"\"\n\n    # Define the physical constants provided in the problem statement.\n    constants = {\n        'g': 9.81,          # Gravitational acceleration (m/s^2)\n        'theta_v0': 300.0,    # Surface environmental virtual potential temperature (K)\n        'gamma_e': 0.003,     # Environmental gradient (K/m)\n        'z_lcl': 800.0,       # Lifting Condensation Level (m)\n        'h_m': 0.005,         # Latent heating rate (K/m)\n        'z_top': 3000.0,      # Domain top (m)\n        'dz': 10.0,           # Numerical integration step (m)\n    }\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (epsilon, theta_p_initial)\n    test_cases = [\n        (0.0, 300.0),\n        (2e-4, 299.5),\n        (1e-3, 299.0),\n        (5e-4, 301.0),\n    ]\n\n    results = []\n    for epsilon, theta_p_initial in test_cases:\n        # Calculate CIN for a single case.\n        result = calculate_cin_for_case(epsilon, theta_p_initial, constants)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_cin_for_case(epsilon, theta_p_initial, constants):\n    \"\"\"\n    Calculates CIN for a single set of parameters.\n    \n    Args:\n        epsilon (float): Fractional entrainment rate (1/m).\n        theta_p_initial (float): Initial parcel virtual potential temperature (K).\n        constants (dict): Dictionary of physical constants.\n        \n    Returns:\n        float: The calculated CIN in J/kg, rounded to one decimal place.\n    \"\"\"\n    g = constants['g']\n    theta_v0 = constants['theta_v0']\n    gamma_e = constants['gamma_e']\n    z_lcl = constants['z_lcl']\n    h_m = constants['h_m']\n    z_top = constants['z_top']\n    dz = constants['dz']\n\n    # Step 1: Discretize the vertical domain.\n    z_grid = np.arange(0, z_top + dz, dz)\n    n_levels = len(z_grid)\n\n    # Step 2: Calculate the environmental virtual potential temperature profile.\n    theta_e_profile = theta_v0 + gamma_e * z_grid\n\n    # Check for initial buoyancy. If non-negative, CIN is zero.\n    initial_buoyancy = g * (theta_p_initial - theta_e_profile[0]) / theta_e_profile[0]\n    if initial_buoyancy >= 0:\n        return 0.0\n\n    # Step 3: Integrate the parcel's virtual potential temperature profile.\n    theta_p_profile = np.zeros(n_levels)\n    theta_p_profile[0] = theta_p_initial\n\n    for i in range(n_levels - 1):\n        z_i = z_grid[i]\n        theta_p_i = theta_p_profile[i]\n        theta_e_i = theta_e_profile[i]\n\n        # Determine the heating term H(z)\n        H_i = h_m if z_i >= z_lcl else 0.0\n\n        # Calculate the derivative d(theta_p)/dz\n        dtheta_p_dz = epsilon * (theta_e_i - theta_p_i) + H_i\n\n        # Perform a single Euler forward step\n        theta_p_profile[i + 1] = theta_p_i + dtheta_p_dz * dz\n\n    # Step 4: Calculate the buoyancy profile.\n    buoyancy_profile = g * (theta_p_profile - theta_e_profile) / theta_e_profile\n\n    # Step 5: Find the Level of Free Convection (LFC).\n    # Find indices where buoyancy is non-negative.\n    lfc_indices = np.where(buoyancy_profile >= 0)[0]\n    \n    if len(lfc_indices) == 0:\n        # LFC is not found within the domain; integrate to the top.\n        i_limit = n_levels - 1\n    else:\n        # LFC is the first height where buoyancy is non-negative.\n        i_limit = lfc_indices[0]\n\n    # The problem implies surface LFC is handled, but to be safe:\n    if i_limit == 0:\n        return 0.0\n\n    # Step 6: Calculate CIN using numerical integration.\n    # The integration range is from z=0 to z_LFC (or z_top).\n    integration_z_points = z_grid[:i_limit + 1]\n    buoyancy_to_integrate = buoyancy_profile[:i_limit + 1]\n    \n    # The integrand is min(B(z), 0).\n    integrand = np.minimum(buoyancy_to_integrate, 0)\n    \n    # Use numpy's trapezoidal rule for numerical quadrature.\n    cin_integral = np.trapz(integrand, x=integration_z_points)\n    \n    # CIN is the negative of the integrated negative buoyancy.\n    cin = -cin_integral\n\n    return round(cin, 1)\n\nsolve()\n```"
        },
        {
            "introduction": "在参数化方案中，单个气块通常被集合成一个整体的“羽流”。这项练习的复杂性有所提升，要求你开发一个一维羽流模型，同时追踪质量通量和热力学属性的演变。此练习还涉及比较不同（且更真实）的夹卷参数化方案，这是气候和天气模型开发中的一个关键环节 。",
            "id": "3896699",
            "problem": "要求您在环境和地球系统建模的背景下，使用质量通量框架，为一维稳态对流上升羽流实现并比较两种夹卷参数化方案。比较的对象是常数夹卷率和随高度变化的夹卷率。目标是为给定的环境探空计算上升气流质量通量和浮力的垂直廓线，并总结特定的诊断输出。\n\n使用以下基本原理，您必须从第一性原理推导出工作方程：\n- 稳态夹卷羽流的质量守恒和应用于虚位温的标量混合。这两者共同构成了一个关于上升气流质量通量和在夹卷与出流作用下上升气流热力学属性的耦合常微分方程组（ODEs）。\n- 基于虚位温的浮力定义，与Boussinesq近似一致。\n\n环境探空和常数：\n- 环境虚位温廓线由一个关于高度的线性函数指定：$\\theta_{v,e}(z) = \\theta_{v,\\text{sfc}} + \\gamma z$，其中 $\\theta_{v,\\text{sfc}} = 300\\,\\mathrm{K}$ 且 $\\gamma = 0.004\\,\\mathrm{K\\,m^{-1}}$。\n- 重力加速度为 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$。\n- 羽流的下界为 $z_0 = 500\\,\\mathrm{m}$，模式顶为 $z_{\\text{top}} = 3000\\,\\mathrm{m}$。\n- 在 $z_0$ 处的初始上升气流质量通量为 $M_0 = 0.08\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}}$。\n- 初始上升气流虚位温由一个环境扰动设定：$\\theta_{v,u}(z_0) = \\theta_{v,e}(z_0) + \\Delta\\theta_{v,0}$，其中 $\\Delta\\theta_{v,0} = 2.0\\,\\mathrm{K}$。\n- 出流参数化为夹卷的固定比例：$\\delta(z) = \\alpha\\,\\epsilon(z)$，其中 $\\alpha$ 在每个测试案例中为常数。\n\n要比较的参数化方案：\n- 常数夹卷率：$\\epsilon(z) = \\epsilon_0$，其中 $\\epsilon_0$ 根据每个测试案例给定。\n- 随高度变化的夹卷率：$\\epsilon(z) = \\epsilon_0\\left(1 + \\frac{z}{H}\\right)$，其中 $H$ 是根据每个测试案例指定的深度尺度。\n\n任务：\n- 从夹卷羽流的质量守恒和标量混合出发，推导在夹卷和出流作用下，上升气流质量通量 $M(z)$ 和上升气流虚位温 $\\theta_{v,u}(z)$ 的控制常微分方程。然后，根据环境和上升气流的虚位温推导出浮力 $b(z)$ 的表达式。\n- 使用固定的垂直步长 $\\Delta z = 10\\,\\mathrm{m}$，实现从 $z_0$到 $z_{\\text{top}}$ 的高度数值积分，以获得测试套件中每种参数化案例的 $M(z)$ 和 $b(z)$。通过正确应用夹卷和出流效应，以及根据上升气流和环境之间的热力学差异计算浮力，来确保科学真实性。\n\n每个测试案例的所需输出：\n- 模式顶的上升气流质量通量：$M(z_{\\text{top}})$，单位为 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$。\n- 模式顶的浮力：$b(z_{\\text{top}})$，单位为 $\\mathrm{m\\,s^{-2}}$。\n- 第一个中性高度 $z_\\text{neutral}$，单位为米，定义为 $z \\in [z_0, z_{\\text{top}}]$ 中 $b(z)$ 首次变为非正值的最低高度。如果在此区间内没有出现中性高度，则返回 $-1.0$。\n\n测试套件：\n- 案例 1（理想路径）：常数夹卷，$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$ 且 $\\alpha = 0.2$。\n- 案例 2（随高度变化）：随高度变化的夹卷，$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$，$H = 2000\\,\\mathrm{m}$，且 $\\alpha = 0.2$。\n- 案例 3（边界情况，无夹卷）：常数夹卷，$\\epsilon_0 = 0.0\\,\\mathrm{m^{-1}}$ 且 $\\alpha = 0.2$。\n- 案例 4（边界情况，质量通量中性出流）：常数夹卷，$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$ 且 $\\alpha = 1.0$。\n\n单位：\n- 以浮点数形式返回 $M(z_{\\text{top}})$（单位 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$）、$b(z_{\\text{top}})$（单位 $\\mathrm{m\\,s^{-2}}$）和 $z_\\text{neutral}$（单位 $\\mathrm{m}$）。不要使用百分比。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，并用方括号括起来。每个内部列表对应一个测试案例，并且必须按 $[M(z_{\\text{top}}), b(z_{\\text{top}}), z_\\text{neutral}]$ 的顺序排列。例如：$[[m_1,b_1,z_1],[m_2,b_2,z_2],[m_3,b_3,z_3],[m_4,b_4,z_4]]$。",
            "solution": "我们从一维框架中稳态对流上升气流的质量通量表示开始。设 $M(z)$ 表示单位面积的上升气流质量通量，$\\epsilon(z)$ 和 $\\delta(z)$ 分别表示单位高度的夹卷率和出流率。设 $\\theta_{v,u}(z)$ 表示上升气流虚位温，$\\theta_{v,e}(z)$ 表示环境虚位温。浮力定义为 $b(z) = g\\,\\frac{\\theta_{v,u}(z) - \\theta_{v,e}(z)}{\\theta_{v,e}(z)}$，这与Boussinesq近似一致。推导过程基于以下基本原理。\n\n根据稳态夹卷羽流的质量守恒，质量通量随高度的变化率等于夹卷带来的净增益减去出流带来的净损失。单位高度内，环境质量流入羽流的量为 $\\epsilon(z)\\,M(z)$，而因出流导致羽流质量流出的量为 $\\delta(z)\\,M(z)$。因此，\n$$\n\\frac{dM}{dz} = \\left[\\epsilon(z) - \\delta(z)\\right]\\,M(z).\n$$\n我们将出流参数化为夹卷的一部分，$\\delta(z) = \\alpha\\,\\epsilon(z)$，其中 $0 \\le \\alpha \\le 1$ 以在测试案例中保持物理真实性。代入后得到\n$$\n\\frac{dM}{dz} = \\left[1 - \\alpha\\right]\\,\\epsilon(z)\\,M(z).\n$$\n\n接下来，对于上升气流携带的守恒标量 $\\chi$（忽略内部源和汇），稳态羽流的标量收支方程为\n$$\n\\frac{d}{dz}\\left[M(z)\\,\\chi_u(z)\\right] = \\epsilon(z)\\,M(z)\\,\\chi_e(z) - \\delta(z)\\,M(z)\\,\\chi_u(z),\n$$\n其中 $\\chi_u$ 表示上升气流标量，$\\chi_e$ 表示环境标量。用 $M(z)$ 除，并使用质量收支中的 $\\frac{dM}{dz}$，\n$$\n\\frac{d\\chi_u}{dz} + \\frac{1}{M(z)}\\frac{dM}{dz}\\,\\chi_u(z) = \\epsilon(z)\\,\\chi_e(z) - \\delta(z)\\,\\chi_u(z),\n$$\n$$\n\\frac{d\\chi_u}{dz} + \\left[1 - \\alpha\\right]\\,\\epsilon(z)\\,\\chi_u(z) = \\epsilon(z)\\,\\chi_e(z) - \\alpha\\,\\epsilon(z)\\,\\chi_u(z),\n$$\n简化为\n$$\n\\frac{d\\chi_u}{dz} = \\epsilon(z)\\,\\left[\\chi_e(z) - \\chi_u(z)\\right].\n$$\n取 $\\chi \\equiv \\theta_{v}$，我们得到\n$$\n\\frac{d\\theta_{v,u}}{dz} = \\epsilon(z)\\,\\left[\\theta_{v,e}(z) - \\theta_{v,u}(z)\\right].\n$$\n\n然后浮力计算为\n$$\nb(z) = g\\,\\frac{\\theta_{v,u}(z) - \\theta_{v,e}(z)}{\\theta_{v,e}(z)}.\n$$\n环境探空指定为\n$$\n\\theta_{v,e}(z) = \\theta_{v,\\text{sfc}} + \\gamma z,\n$$\n其中 $\\theta_{v,\\text{sfc}} = 300\\,\\mathrm{K}$ 且 $\\gamma = 0.004\\,\\mathrm{K\\,m^{-1}}$，以及常数 $g = 9.81\\,\\mathrm{m\\,s^{-2}}$，问题简化为数值积分以下耦合系统：\n- $\\frac{dM}{dz} = \\left[1 - \\alpha\\right]\\,\\epsilon(z)\\,M(z)$,\n- $\\frac{d\\theta_{v,u}}{dz} = \\epsilon(z)\\,\\left[\\theta_{v,e}(z) - \\theta_{v,u}(z)\\right]$,\n初始条件在 $z_0 = 500\\,\\mathrm{m}$ 处：\n- $M(z_0) = M_0 = 0.08\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}}$,\n- $\\theta_{v,u}(z_0) = \\theta_{v,e}(z_0) + \\Delta\\theta_{v,0}$，其中 $\\Delta\\theta_{v,0} = 2.0\\,\\mathrm{K}$,\n并积分至 $z_{\\text{top}} = 3000\\,\\mathrm{m}$。\n\n夹卷参数化方案：\n- 常数：$\\epsilon(z) = \\epsilon_0$.\n- 随高度变化：$\\epsilon(z) = \\epsilon_0\\left(1 + \\frac{z}{H}\\right)$.\n\n数值方法：\n- 使用固定步长的向前欧拉格式，步长 $\\Delta z = 10\\,\\mathrm{m}$，来推进 $M$ 和 $\\theta_{v,u}$：\n$$\nM_{n+1} = M_n + \\left[1 - \\alpha\\right]\\,\\epsilon(z_n)\\,M_n\\,\\Delta z,\n$$\n$$\n\\theta_{v,u,n+1} = \\theta_{v,u,n} + \\epsilon(z_n)\\left[\\theta_{v,e}(z_n) - \\theta_{v,u,n}\\right]\\Delta z.\n$$\n在每个高度层计算浮力\n$$\nb_n = g\\,\\frac{\\theta_{v,u,n} - \\theta_{v,e}(z_n)}{\\theta_{v,e}(z_n)}.\n$$\n记录第一个 $b$ 变为非正值的中性高度 $z_\\text{neutral}$。为提高精度，如果 $b_{n}  0$ 且 $b_{n+1} \\le 0$，在区间内进行线性插值：\n$$\nz_\\text{neutral} \\approx z_n + \\Delta z\\,\\frac{0 - b_n}{b_{n+1} - b_n}.\n$$\n如果在 $[z_0,z_{\\text{top}}]$ 上未找到穿越点，则返回 $-1.0$。\n\n测试套件参数：\n- 案例 1：$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$，$\\alpha = 0.2$（常数）。\n- 案例 2：$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$，$H = 2000\\,\\mathrm{m}$，$\\alpha = 0.2$（随高度变化）。\n- 案例 3：$\\epsilon_0 = 0.0\\,\\mathrm{m^{-1}}$，$\\alpha = 0.2$（常数；无夹卷的边界情况）。\n- 案例 4：$\\epsilon_0 = 1.0\\times 10^{-4}\\,\\mathrm{m^{-1}}$，$\\alpha = 1.0$（常数；出流在质量收支中正好抵消夹卷，因此 $M$ 随高度不变的边界情况）。\n\n每个案例的算法输出：\n- $M(z_{\\text{top}})$，单位为 $\\mathrm{kg\\,m^{-2}\\,s^{-1}}$，\n- $b(z_{\\text{top}})$，单位为 $\\mathrm{m\\,s^{-2}}$，\n- $z_\\text{neutral}$，单位为 $\\mathrm{m}$，如果不存在中性层，则为 $-1.0$。\n\n最终程序将每个案例的结果汇总到单行打印输出中，格式为逗号分隔的列表的列表，以符合要求的格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef integrate_case(case, params):\n    # Unpack global parameters\n    z0 = params['z0']\n    z_top = params['z_top']\n    dz = params['dz']\n    g = params['g']\n    theta_sfc = params['theta_sfc']\n    gamma = params['gamma']\n    M0 = params['M0']\n    dtheta0 = params['dtheta0']\n    H_default = params['H_default']\n\n    case_type = case['type']           # 'const' or 'linear'\n    eps0 = case['eps0']                # base entrainment [1/m]\n    alpha = case['alpha']              # detrainment fraction of entrainment\n    H = case.get('H', H_default)       # depth scale [m] for linear entrainment\n\n    # Environmental virtual potential temperature profile\n    def theta_env(z):\n        return theta_sfc + gamma * z\n\n    # Entrainment parameterization function\n    if case_type == 'const':\n        def eps(z):\n            return eps0\n    elif case_type == 'linear':\n        def eps(z):\n            return eps0 * (1.0 + z / H)\n    else:\n        raise ValueError(\"Unknown case type.\")\n\n    # Initialize state at z0\n    z_levels = np.arange(z0, z_top + dz, dz)\n    M = M0\n    theta_u = theta_env(z0) + dtheta0\n    b_prev = g * (theta_u - theta_env(z0)) / theta_env(z0)\n    neutral_height = None\n\n    # March upward\n    for i in range(1, len(z_levels)):\n        z = z_levels[i-1]\n        z_next = z_levels[i]\n        # Compute entrainment\n        eps_z = eps(z)\n\n        # Update mass flux\n        dM = (1.0 - alpha) * eps_z * M * dz\n        M_next = M + dM\n\n        # Update updraft virtual potential temperature\n        theta_e_z = theta_env(z)\n        dtheta_u = eps_z * (theta_e_z - theta_u) * dz\n        theta_u_next = theta_u + dtheta_u\n\n        # Compute buoyancy at next level\n        theta_e_next = theta_env(z_next)\n        b_next = g * (theta_u_next - theta_e_next) / theta_e_next\n\n        # Detect first neutral level\n        if neutral_height is None and (b_prev > 0.0) and (b_next = 0.0):\n            # Linear interpolation for crossing within [z, z_next]\n            frac = (0.0 - b_prev) / (b_next - b_prev) if (b_next - b_prev) != 0.0 else 0.0\n            neutral_height = z + dz * max(0.0, min(1.0, frac))\n\n        # Advance\n        M = M_next\n        theta_u = theta_u_next\n        b_prev = b_next\n\n    # Final outputs\n    M_top = M\n    b_top = b_prev\n    z_neutral = neutral_height if neutral_height is not None else -1.0\n\n    return [M_top, b_top, z_neutral]\n\ndef solve():\n    # Global parameters from the problem statement\n    params = {\n        'z0': 500.0,            # m\n        'z_top': 3000.0,        # m\n        'dz': 10.0,             # m\n        'g': 9.81,              # m/s^2\n        'theta_sfc': 300.0,     # K\n        'gamma': 0.004,         # K/m\n        'M0': 0.08,             # kg m^-2 s^-1\n        'dtheta0': 2.0,         # K\n        'H_default': 2000.0     # m\n    }\n\n    # Define the test cases from the problem statement\n    test_cases = [\n        # Case 1: Constant epsilon, alpha=0.2\n        {'type': 'const', 'eps0': 1.0e-4, 'alpha': 0.2},\n        # Case 2: Height-dependent epsilon, alpha=0.2, H=2000 m\n        {'type': 'linear', 'eps0': 1.0e-4, 'alpha': 0.2, 'H': 2000.0},\n        # Case 3: No entrainment, alpha=0.2\n        {'type': 'const', 'eps0': 0.0, 'alpha': 0.2},\n        # Case 4: Constant epsilon, alpha=1.0 (mass-flux neutral detrainment)\n        {'type': 'const', 'eps0': 1.0e-4, 'alpha': 1.0},\n    ]\n\n    results = []\n    for case in test_cases:\n        M_top, b_top, z_neutral = integrate_case(case, params)\n        results.append([M_top, b_top, z_neutral])\n\n    # Format output: single line, comma-separated lists with no spaces\n    def format_sublist(lst):\n        return \"[\" + \",\".join(f\"{x:.6f}\" for x in lst) + \"]\"\n    output = \"[\" + \",\".join(format_sublist(r) for r in results) + \"]\"\n    print(output)\n\nsolve()\n```"
        },
        {
            "introduction": "虽然数值模型功能强大，但简化情况下的解析解能提供宝贵的物理洞察力。最后一个练习将推导并实现一个集总羽流模型的闭合解，这将帮助你巩固对模型底层数学结构的理解。通过分析解，你还将探索模型对初始条件的敏感性，从而揭示其内在的重要假设 。",
            "id": "3896753",
            "problem": "考虑一个表示受环境混合影响的对流上升气流的垂直方向整体羽流。令 $z$ 表示高度（单位：米），$M(z)$ 表示上升气流的质量通量（单位：千克/平方米/秒），$\\phi_u(z)$ 表示一个守恒的上升气流标量（单位：开尔文，例如虚位温）。环境由线性廓线 $\\phi_e(z) = \\phi_{e0} + \\gamma z$ 表征，其中 $\\phi_{e0}$ 是 $z=0$ 处的环境值（单位：开尔文），$\\gamma$ 是垂直梯度（单位：开尔文/米）。夹卷和卷出被参数化为单位长度的恒定分数率 $\\epsilon$ 和 $\\lambda$（单位：米⁻¹）。\n\n从以下基本且广泛使用的整体羽流收支方程出发：\n- 包含夹卷和卷出的质量守恒：上升气流质量通量随高度的变化率与其当前值成正比，$\\,\\dfrac{dM}{dz} = (\\epsilon - \\lambda)\\,M\\,$，其中给定 $M(0) = M_0$（单位：千克/平方米/秒）。\n- 混合作用下的标量守恒：上升气流标量收支由 $\\,\\dfrac{d}{dz}\\left(M\\,\\phi_u\\right) = \\epsilon\\,M\\,\\phi_e - \\lambda\\,M\\,\\phi_u\\,$ 给出，其中 $\\phi_u(0) = \\phi_{u0}$（单位：开尔文）。\n\n推导在 $\\epsilon$ 和 $\\lambda$ 为常数、$\\phi_e(z)$ 为如上所述的线性函数时，$M(z)$ 和 $\\phi_u(z)$ 的解析解。然后，解析地确定在指定高度 $z=z_t$ 时，$M(z)$ 对初始质量通量 $M_0$ 的敏感性，即计算 $\\dfrac{\\partial M(z_t)}{\\partial M_0}$，并确定 $\\dfrac{\\partial \\phi_u(z_t)}{\\partial M_0}$。您的程序必须实现这些解和敏感性。\n\n物理单位和输出要求：\n- 高度 $z$ 和 $z_t$ 必须以米为单位处理。\n- 质量通量 $M$ 必须以千克/平方米/秒为单位返回。\n- 标量 $\\phi_u$ 必须以开尔文为单位返回。\n- 夹卷率和卷出率 $\\epsilon$ 和 $\\lambda$ 必须以米⁻¹为单位。\n- 环境梯度 $\\gamma$ 必须以开尔文/米为单位。\n- 不涉及角度。\n- 将所有最终数值结果表示为浮点数。\n\n测试套件：\n对于下面的每个测试用例，使用给定的参数计算元组 $\\left[\\phi_u(z_t),\\,M(z_t),\\,\\dfrac{\\partial M(z_t)}{\\partial M_0},\\,\\dfrac{\\partial \\phi_u(z_t)}{\\partial M_0}\\right]$：\n\n- 案例 $1$（常规正常路径）：\n  - $\\epsilon = 0.0001$ (米⁻¹)\n  - $\\lambda = 0.00002$ (米⁻¹)\n  - $\\phi_{e0} = 300$ (开尔文)\n  - $\\gamma = 0.003$ (开尔文/米)\n  - $z_t = 2000$ (米)\n  - $\\phi_{u0} = 302$ (开尔文)\n  - $M_0 = 0.3$ (千克/平方米/秒)\n\n- 案例 $2$（$M$ 随高度不变的边界情况）：\n  - $\\epsilon = 0.0001$ (米⁻¹)\n  - $\\lambda = 0.0001$ (米⁻¹)\n  - $\\phi_{e0} = 299$ (开尔文)\n  - $\\gamma = 0.004$ (开尔文/米)\n  - $z_t = 1500$ (米)\n  - $\\phi_{u0} = 301$ (开尔文)\n  - $M_0 = 0.5$ (千克/平方米/秒)\n\n- 案例 $3$（卷出主导导致 $M$ 减小）：\n  - $\\epsilon = 0.00015$ (米⁻¹)\n  - $\\lambda = 0.0003$ (米⁻¹)\n  - $\\phi_{e0} = 301$ (开尔文)\n  - $\\gamma = 0.0025$ (开尔文/米)\n  - $z_t = 3000$ (米)\n  - $\\phi_{u0} = 305$ (开尔文)\n  - $M_0 = 0.8$ (千克/平方米/秒)\n\n- 案例 $4$（强夹卷）：\n  - $\\epsilon = 0.0003$ (米⁻¹)\n  - $\\lambda = 0.00001$ (米⁻¹)\n  - $\\phi_{e0} = 298$ (开尔文)\n  - $\\gamma = 0.0015$ (开尔文/米)\n  - $z_t = 1000$ (米)\n  - $\\phi_{u0} = 300$ (开尔文)\n  - $M_0 = 0.2$ (千克/平方米/秒)\n\n最终输出格式：\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，其中每个测试用例的结果本身就是一个用方括号括起来的逗号分隔列表。例如，输出必须类似于 $\"[[r_{1,1},r_{1,2},r_{1,3},r_{1,4}],[r_{2,1},r_{2,2},r_{2,3},r_{2,4}],...]\"$，其中每个 $r_{i,j}$ 是根据上述指定顺序从相应测试用例计算出的浮点数。",
            "solution": "我们从具有恒定夹卷率和卷出率的整体对流羽流的质量守恒和标量守恒方程开始。令 $\\epsilon$ 表示夹卷率（单位：米⁻¹），$\\lambda$ 表示卷出率（单位：米⁻¹），$M(z)$ 表示上升气流质量通量（单位：千克/平方米/秒），$\\phi_u(z)$ 表示上升气流标量（例如虚位温，单位：开尔文），$\\phi_e(z)$ 表示环境标量（单位：开尔文）。\n\n基本基础和假设：\n- 包含夹卷和卷出的质量守恒由常微分方程（ODE）建模：\n$$\n\\frac{dM}{dz} = (\\epsilon - \\lambda) M,\n$$\n初始条件为 $M(0) = M_0$。\n- 混合作用下的标量守恒由常微分方程建模：\n$$\n\\frac{d}{dz}\\left(M \\phi_u\\right) = \\epsilon M \\phi_e - \\lambda M \\phi_u,\n$$\n初始条件为 $\\phi_u(0) = \\phi_{u0}$。这表示以速率 $\\epsilon M$ 加入携带 $\\phi_e$ 的环境质量，并以速率 $\\lambda M$ 移除携带 $\\phi_u$ 的羽流质量。\n\n我们采用线性环境廓线：\n$$\n\\phi_e(z) = \\phi_{e0} + \\gamma z,\n$$\n其中 $\\phi_{e0}$ 是 $z=0$ 处的环境标量（单位：开尔文），$\\gamma$ 是恒定的垂直梯度（单位：开尔文/米）。\n\n步骤 $1$：求解质量通量常微分方程。此常微分方程是可分离的：\n$$\n\\frac{dM}{dz} = \\alpha M,\\quad \\alpha \\equiv \\epsilon - \\lambda,\n$$\n其解为\n$$\nM(z) = M_0 \\exp(\\alpha z).\n$$\n这表示质量通量随高度呈指数增长或衰减，具体取决于夹卷和卷出之间的平衡。通过微分可得 $M(z)$ 对初始质量通量 $M_0$ 的敏感性：\n$$\n\\frac{\\partial M(z)}{\\partial M_0} = \\exp(\\alpha z).\n$$\n\n步骤 $2$：求解标量守恒常微分方程。从以下方程开始：\n$$\n\\frac{d}{dz}(M\\phi_u) = \\epsilon M \\phi_e - \\lambda M \\phi_u.\n$$\n使用乘法法则展开导数，得到\n$$\nM \\frac{d\\phi_u}{dz} + \\phi_u \\fracdM}{dz} = \\epsilon M \\phi_e - \\lambda M \\phi_u.\n$$\n两边同除以 $M$（假设 $M  0$）：\n$$\n\\frac{d\\phi_u}{dz} + \\phi_u \\frac{1}{M}\\frac{dM}{dz} = \\epsilon \\phi_e - \\lambda \\phi_u.\n$$\n使用质量解，$\\dfrac{1}{M}\\dfrac{dM}{dz} = \\alpha = \\epsilon - \\lambda$，得到\n$$\n\\frac{d\\phi_u}{dz} + (\\epsilon - \\lambda)\\phi_u = \\epsilon \\phi_e - \\lambda \\phi_u.\n$$\n涉及 $\\lambda \\phi_u$ 的项相消，得到经典的夹卷弛豫方程\n$$\n\\frac{d\\phi_u}{dz} + \\epsilon \\phi_u = \\epsilon \\phi_e(z).\n$$\n因此，在这种整体构型中，卷出影响质量通量，但不会直接出现在标量弛豫中，因为卷出移除的质量携带的 $\\phi_u$ 与羽流所含的相同，因此在按 $M$ 归一化后，在标量趋势项中被抵消。\n\n这是一个具有非恒定强迫项（通过 $\\phi_e(z)$）的线性一阶常微分方程。应用积分因子法，积分因子为 $\\mu(z) = \\exp(\\epsilon z)$：\n$$\n\\frac{d}{dz}\\left(\\mu(z) \\phi_u(z)\\right) = \\epsilon \\mu(z) \\phi_e(z) = \\epsilon \\exp(\\epsilon z)\\left(\\phi_{e0} + \\gamma z\\right).\n$$\n对 $z$ 积分：\n$$\n\\mu(z)\\phi_u(z) = \\epsilon \\int \\exp(\\epsilon z)\\phi_{e0}\\,dz + \\epsilon \\int \\exp(\\epsilon z) \\gamma z\\,dz + C,\n$$\n其中 $C$ 是积分常数。积分为\n$$\n\\epsilon \\int \\exp(\\epsilon z)\\phi_{e0}\\,dz = \\phi_{e0}\\exp(\\epsilon z),\n$$\n以及，通过对 $\\int z \\exp(\\epsilon z) dz$ 进行分部积分，\n$$\n\\epsilon \\int \\exp(\\epsilon z)\\gamma z\\,dz = \\gamma \\left(z \\exp(\\epsilon z) - \\frac{1}{\\epsilon}\\exp(\\epsilon z)\\right).\n$$\n因此，\n$$\n\\exp(\\epsilon z)\\phi_u(z) = \\phi_{e0}\\exp(\\epsilon z) + \\gamma \\left(z \\exp(\\epsilon z) - \\frac{1}{\\epsilon}\\exp(\\epsilon z)\\right) + C,\n$$\n两边同除以 $\\exp(\\epsilon z)$，\n$$\n\\phi_u(z) = \\phi_{e0} + \\gamma z - \\frac{\\gamma}{\\epsilon} + C \\exp(-\\epsilon z).\n$$\n应用 $z=0$ 处的初始条件：\n$$\n\\phi_u(0) = \\phi_{u0} = \\phi_{e0} - \\frac{\\gamma}{\\epsilon} + C \\implies C = \\phi_{u0} - \\phi_{e0} + \\frac{\\gamma}{\\epsilon}.\n$$\n因此，上升气流标量的解析解为\n$$\n\\phi_u(z) = \\phi_{e0} + \\gamma z - \\frac{\\gamma}{\\epsilon} + \\left(\\phi_{u0} - \\phi_{e0} + \\frac{\\gamma}{\\epsilon}\\right)\\exp(-\\epsilon z).\n$$\n\n步骤 $3$：$\\phi_u(z)$ 对 $M_0$ 的敏感性。在此整体构型中，$\\phi_u(z)$ 的解不依赖于 $M_0$。因此，\n$$\n\\frac{\\partial \\phi_u(z)}{\\partial M_0} = 0.\n$$\n\n算法实现：\n- 对于每个测试用例，读取 $(\\epsilon, \\lambda, \\phi_{e0}, \\gamma, z_t, \\phi_{u0}, M_0)$。\n- 计算 $\\alpha = \\epsilon - \\lambda$。\n- 计算 $M(z_t) = M_0 \\exp(\\alpha z_t)$。\n- 计算 $\\dfrac{\\partial M(z_t)}{\\partial M_0} = \\exp(\\alpha z_t)$。\n- 计算 $\\phi_u(z_t) = \\phi_{e0} + \\gamma z_t - \\dfrac{\\gamma}{\\epsilon} + \\left(\\phi_{u0} - \\phi_{e0} + \\dfrac{\\gamma}{\\epsilon}\\right)\\exp(-\\epsilon z_t)$。\n- 计算 $\\dfrac{\\partial \\phi_u(z_t)}{\\partial M_0} = 0$。\n- 将所有测试用例的结果汇总到一个列表的列表中，并以指定格式作为单行打印。\n\n科学真实性与边界情况：\n- 案例 $1$ 代表一个典型的对流上升气流，具有正的净夹卷（$\\alpha0$）和随高度增加的稳定环境标量（$\\gamma0$）。\n- 案例 $2$ 设置 $\\epsilon = \\lambda$，使得 $\\alpha=0$；质量通量不随高度变化，测试 $M$ 的边界条件。\n- 案例 $3$ 设置 $\\lambda\\epsilon$，使得 $\\alpha0$；质量通量随高度衰减，测试卷出主导的情况。\n- 案例 $4$ 增加 $\\epsilon$ 以测试更强的夹卷和 $\\phi_u$ 向垂直滞后的环境廓线的更快弛豫。\n\n所有输出均为浮点数。高度单位为米，质量通量单位为千克/平方米/秒，标量单位为开尔文，与上述单位一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (epsilon [1/m], lambda [1/m], phi_e0 [K], gamma [K/m], z_t [m], phi_u0 [K], M0 [kg m^-2 s^-1])\n    test_cases = [\n        (1.0e-4, 2.0e-5, 300.0, 3.0e-3, 2000.0, 302.0, 0.3),   # Case 1\n        (1.0e-4, 1.0e-4, 299.0, 4.0e-3, 1500.0, 301.0, 0.5),   # Case 2\n        (1.5e-4, 3.0e-4, 301.0, 2.5e-3, 3000.0, 305.0, 0.8),   # Case 3\n        (3.0e-4, 1.0e-5, 298.0, 1.5e-3, 1000.0, 300.0, 0.2),   # Case 4\n    ]\n\n    def compute_phi_u(eps, phi_e0, gamma, z_t, phi_u0):\n        # Avoid division by zero: eps is specified positive in test suite.\n        # Closed-form solution:\n        # phi_u(z) = phi_e0 + gamma*z - gamma/eps + (phi_u0 - phi_e0 + gamma/eps)*exp(-eps*z)\n        return phi_e0 + gamma * z_t - (gamma / eps) + (phi_u0 - phi_e0 + (gamma / eps)) * np.exp(-eps * z_t)\n\n    def compute_M(alpha, z_t, M0):\n        # M(z) = M0 * exp(alpha * z)\n        return M0 * np.exp(alpha * z_t)\n\n    results = []\n    for case in test_cases:\n        eps, lam, phi_e0, gamma, z_t, phi_u0, M0 = case\n        alpha = eps - lam\n\n        phi_u_zt = compute_phi_u(eps, phi_e0, gamma, z_t, phi_u0)       # [K]\n        M_zt = compute_M(alpha, z_t, M0)                                 # [kg m^-2 s^-1]\n        dM_dM0 = np.exp(alpha * z_t)                                     # sensitivity of M at z_t to M0\n        dphi_dM0 = 0.0                                                   # phi_u independent of M0 in this bulk formulation\n\n        results.append([float(phi_u_zt), float(M_zt), float(dM_dM0), float(dphi_dM0)])\n\n    # Final print statement in the exact required format.\n    # Produce a single line of output containing the list-of-lists.\n    # Ensure standard float string conversion without additional text.\n    print(\"[\" + \",\".join(\"[\" + \",\".join(str(x) for x in res) + \"]\" for res in results) + \"]\")\n\nsolve()\n```"
        }
    ]
}