{
    "hands_on_practices": [
        {
            "introduction": "海水密度的微小差异是驱动全球温盐环流的根本动力。本练习将通过一个具体案例，指导您使用简化的线性状态方程来计算海水密度异常，这是分析海洋动力学的第一步 。通过这个计算，您将亲身体验温度和盐度如何共同决定一个水团的浮力，并预测其垂直运动的趋势。",
            "id": "3926354",
            "problem": "在环境和地球系统温盐环流的建模中，海水密度取决于给定压力下的温度和盐度。考虑一个近地表水体，其压力为 $p=0\\,\\mathrm{dbar}$（分巴），状态为 $(T,S)=(2\\,\\mathrm{^{\\circ}C},35.2\\,\\mathrm{psu})$，参考状态为 $(T_0,S_0)=(4\\,\\mathrm{^{\\circ}C},35.0\\,\\mathrm{psu})$，其中 $\\mathrm{psu}$ 代表实用盐度单位。假设采用 Boussinesq 近似（BA），其中使用一个恒定的参考密度 $\\,\\rho_0\\,$ 来线性化热力学效应，同时保留浮力。取热膨胀系数 $\\alpha=2\\times 10^{-4}\\,\\mathrm{K}^{-1}$ 和盐收缩系数 $\\beta=7.5\\times 10^{-4}\\,\\mathrm{psu}^{-1}$，两者均在参考状态和 $p=0\\,\\mathrm{dbar}$ 压力下评估。设参考状态下的参考密度为 $\\,\\rho_0=1027\\,\\mathrm{kg\\,m^{-3}}$。\n\n从密度在固定压力下如何随温度和盐度变化的基本定义出发，并采用与 Boussinesq 近似一致的、关于 $(T_0,S_0)$ 的一阶线性化，计算在 $p=0\\,\\mathrm{dbar}$ 时的密度异常，即量 $\\rho'=\\rho(T,S,0)-\\rho(T_0,S_0,0)$，以 $\\mathrm{kg\\,m^{-3}}$ 为单位表示。将您的最终数值结果四舍五入至四位有效数字。然后，根据 $\\rho'$ 的符号和 Boussinesq 浮力概念，简要评估该水体相对于参考状态是静态地更轻还是更重，并说明其上升或下沉趋势的定性含义。最终答案仅需提供 $\\rho'$ 的数值；浮力评估应包含在您的推理过程中。",
            "solution": "该问题被认为是有效的，因为它具有科学依据、问题明确且客观。它提出了物理海洋学中关于 Boussinesq 近似下海水线性化状态方程的一个标准练习。所有必要的数据均已提供，且参数在物理上是现实的。\n\n海水密度 $\\rho$ 是温度（$T$）、盐度（$S$）和压力（$p$）的函数。在固定压力下，例如在 $p=0\\,\\mathrm{dbar}$ 的近地表条件下，密度是函数 $\\rho(T,S)$。为了分析与参考状态 $(T_0, S_0)$ 的微小偏差，我们可以对 $\\rho(T,S)$ 在该参考状态附近进行一阶泰勒级数展开：\n$$\n\\rho(T,S) \\approx \\rho(T_0,S_0) + \\left.\\frac{\\partial\\rho}{\\partial T}\\right|_{(T_0, S_0)} (T - T_0) + \\left.\\frac{\\partial\\rho}{\\partial S}\\right|_{(T_0, S_0)} (S - S_0)\n$$\n\n问题提供了参考状态下的参考密度为 $\\rho_0 = \\rho(T_0,S_0,0) = 1027\\,\\mathrm{kg\\,m^{-3}}$。偏导数与热膨胀系数 $\\alpha$ 和盐收缩系数 $\\beta$ 相关。根据海洋学中的标准定义，它们由下式给出：\n$$\n\\alpha \\equiv -\\frac{1}{\\rho_0} \\left.\\frac{\\partial\\rho}{\\partial T}\\right|_{(T_0, S_0)}\n$$\n$$\n\\beta \\equiv \\frac{1}{\\rho_0} \\left.\\frac{\\partial\\rho}{\\partial S}\\right|_{(T_0, S_0)}\n$$\n$\\alpha$ 定义中的负号确保了 $\\alpha$ 通常是一个正值，因为密度通常随温度升高而降低（在远离冰点时）。盐度增加总是会使密度增加，因此 $\\beta$ 是正值。\n\n根据这些定义，我们可以用给定的系数表示偏导数：\n$$\n\\left.\\frac{\\partial\\rho}{\\partial T}\\right|_{(T_0, S_0)} = -\\rho_0 \\alpha\n$$\n$$\n\\left.\\frac{\\partial\\rho}{\\partial S}\\right|_{(T_0, S_0)} = \\rho_0 \\beta\n$$\n\n将这些表达式代回泰勒展开式，得到海水的线性化状态方程：\n$$\n\\rho(T,S) \\approx \\rho_0 - \\rho_0 \\alpha (T - T_0) + \\rho_0 \\beta (S - S_0)\n$$\n这个方程可以重新排列成一个常见形式：\n$$\n\\rho(T,S) \\approx \\rho_0 \\left[ 1 - \\alpha (T - T_0) + \\beta (S - S_0) \\right]\n$$\n\n问题要求计算密度异常 $\\rho'$，它被定义为水体密度与参考密度之差：\n$$\n\\rho' = \\rho(T,S) - \\rho(T_0,S_0) = \\rho(T,S) - \\rho_0\n$$\n使用线性化状态方程，我们可以写出密度异常的表达式：\n$$\n\\rho' \\approx \\rho_0 \\left[ -\\alpha (T - T_0) + \\beta (S - S_0) \\right]\n$$\n\n现在，我们将所提供的值代入此表达式：\n水体状态：$(T,S) = (2\\,\\mathrm{^{\\circ}C}, 35.2\\,\\mathrm{psu})$\n参考状态：$(T_0,S_0) = (4\\,\\mathrm{^{\\circ}C}, 35.0\\,\\mathrm{psu})$\n参考密度：$\\rho_0 = 1027\\,\\mathrm{kg\\,m^{-3}}$\n热膨胀系数：$\\alpha = 2 \\times 10^{-4}\\,\\mathrm{K}^{-1}$\n盐收缩系数：$\\beta = 7.5 \\times 10^{-4}\\,\\mathrm{psu}^{-1}$\n\n温度和盐度的差值为：\n$$\nT - T_0 = 2\\,\\mathrm{^{\\circ}C} - 4\\,\\mathrm{^{\\circ}C} = -2\\,\\mathrm{^{\\circ}C} = -2\\,\\mathrm{K}\n$$\n$$\nS - S_0 = 35.2\\,\\mathrm{psu} - 35.0\\,\\mathrm{psu} = 0.2\\,\\mathrm{psu}\n$$\n\n现在我们计算密度异常 $\\rho'$：\n$$\n\\rho' = (1027\\,\\mathrm{kg\\,m^{-3}}) \\left[ -(2 \\times 10^{-4}\\,\\mathrm{K}^{-1})(-2\\,\\mathrm{K}) + (7.5 \\times 10^{-4}\\,\\mathrm{psu}^{-1})(0.2\\,\\mathrm{psu}) \\right]\n$$\n$$\n\\rho' = 1027 \\left[ (4 \\times 10^{-4}) + (1.5 \\times 10^{-4}) \\right] \\,\\mathrm{kg\\,m^{-3}}\n$$\n$$\n\\rho' = 1027 \\left[ 5.5 \\times 10^{-4} \\right] \\,\\mathrm{kg\\,m^{-3}}\n$$\n$$\n\\rho' = 0.56485 \\,\\mathrm{kg\\,m^{-3}}\n$$\n\n问题要求将最终数值结果四舍五入至四位有效数字。\n$$\n\\rho' \\approx 0.5649 \\,\\mathrm{kg\\,m^{-3}}\n$$\n\n对于问题的第二部分，我们评估浮力。密度异常 $\\rho'$ 是正值（$0.5649 > 0$）。这表明水体的密度 $\\rho(T,S)$ 大于参考密度 $\\rho_0$。因此，该水体比参考水更重（密度更大）。根据 Boussinesq 浮力概念，作用在水体上单位体积的净浮力由 $-g\\rho'$ 给出，其中 $g$ 是重力加速度。由于 $\\rho' > 0$，浮力为负，这意味着相对于周围流体存在一个净向下的力。这表明该水体在重力分层流体中是静态不稳定的，并且会倾向于下沉。这种冷而咸的海水的下沉是驱动温盐环流和形成深层海洋水团的一个基本机制。",
            "answer": "$$\n\\boxed{0.5649}\n$$"
        },
        {
            "introduction": "海洋表层的密度并非一成不变，而是持续受到大气的影响。这个练习将带您从静态的密度概念转向动态的通量计算，量化海-气界面的热量和淡水交换如何共同产生“浮力通量” 。理解浮力通量是掌握深水形成和海洋垂直对流等关键过程的核心。",
            "id": "3926322",
            "problem": "考虑一个亚热带海洋区域，其混合层与大气交换热量和淡水。假设海水的状态方程是线性的，$ \\rho' = -\\rho_0 \\left( \\alpha T' - \\beta S' \\right) $，并定义浮力为 $ b = -g \\rho' / \\rho_0 = g \\left( \\alpha T' - \\beta S' \\right) $。表面浮力通量 $B_0$ 是 $b$ 穿过海气界面的湍流通量。设净表面热通量为 $Q_T=-200\\,\\mathrm{W\\, m^{-2}}$（负值表示海洋冷却），净蒸发减去降水量为 $E-P=1\\,\\mathrm{m\\, yr^{-1}}$（正值表示净蒸发），近表面盐度为 $S_0=35$ 实用盐度单位（PSU）。取热膨胀系数为 $\\alpha=2\\times 10^{-4}\\,\\mathrm{K^{-1}}$，盐收缩系数为 $\\beta=7.5\\times 10^{-4}\\,\\mathrm{psu^{-1}}$，定压下海水的比热容为 $c_p=4000\\,\\mathrm{J\\, kg^{-1}\\, K^{-1}}$。使用重力加速度 $g=9.81\\,\\mathrm{m\\, s^{-2}}$ 和参考海水密度 $\\rho_0=1025\\,\\mathrm{kg\\, m^{-3}}$。假设淡水通量不含盐分，因此其对盐度的影响可以表示为基于 $S_0$ 的“虚拟”盐通量。\n\n从热量和盐量守恒以及线性状态方程出发，推导表面浮力通量 $B_0$ 关于 $Q_T$、$E-P$、$S_0$、$\\alpha$、$\\beta$、$c_p$、$g$ 和 $\\rho_0$ 的表达式，并明确符号约定。然后，利用给定参数对 $B_0$ 进行数值计算，并确定 $B_0$ 的净符号。\n\n将 $B_0$ 的最终数值结果以 $\\mathrm{m^2\\, s^{-3}}$ 为单位表示，并四舍五入到三位有效数字。根据您的计算值，明确说明净浮力通量是正还是负。对于从年到秒的转换，取 $1\\,\\mathrm{yr} = 365\\times 24\\times 3600\\,\\mathrm{s}$。",
            "solution": "首先验证问题，以确保其科学性、适定性和客观性。\n\n### 步骤 1：提取已知条件\n-   线性状态方程：$ \\rho' = -\\rho_0 \\left( \\alpha T' - \\beta S' \\right) $\n-   浮力定义：$ b = -g \\rho' / \\rho_0 = g \\left( \\alpha T' - \\beta S' \\right) $\n-   表面浮力通量定义：$B_0$ 是 $b$ 穿过海气界面的湍流通量。\n-   净表面热通量：$Q_T = -200\\,\\mathrm{W\\, m^{-2}}$（负值表示冷却）\n-   净蒸发减去降水量：$E-P = 1\\,\\mathrm{m\\, yr^{-1}}$（正值表示净蒸发）\n-   近表面盐度：$S_0=35$ PSU\n-   热膨胀系数：$\\alpha=2\\times 10^{-4}\\,\\mathrm{K^{-1}}$\n-   盐收缩系数：$\\beta=7.5\\times 10^{-4}\\,\\mathrm{psu^{-1}}$\n-   海水比热容：$c_p=4000\\,\\mathrm{J\\, kg^{-1}\\, K^{-1}}$\n-   重力加速度：$g=9.81\\,\\mathrm{m\\, s^{-2}}$\n-   参考海水密度：$\\rho_0=1025\\,\\mathrm{kg\\, m^{-3}}$\n-   假设：淡水通量不含盐分。\n-   转换：$1\\,\\mathrm{yr} = 365\\times 24\\times 3600\\,\\mathrm{s}$\n-   要求输出：$B_0$ 的最终数值结果，以 $\\mathrm{m^2\\, s^{-3}}$ 为单位，四舍五入到三位有效数字，以及 $B_0$ 的净符号。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是物理海洋学中的一个标准练习，涉及海气相互作用及其对海洋浮力影响的基本概念。\n-   **科学性**：该问题基于成熟的Boussinesq近似、线性的海水状态方程以及热量、淡水和浮力通量的标准定义。所有概念都是海洋动力学的核心。所提供的物理常数是符合实际的。该问题在科学上是合理的。\n-   **适定性**：该问题提供了推导表达式和计算表面浮力通量数值所需的所有数据和定义。问题明确无歧义，且有唯一解。\n-   **客观性**：语言精确且定量。不存在主观或基于观点的陈述。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供完整解答。\n\n### 表面浮力通量的推导\n海水水块的浮力定义为 $b = g(\\alpha T' - \\beta S')$，其中 $T'$ 和 $S'$ 是相对于参考状态的温度和盐度扰动。表面浮力通量 $B_0$ 是浮力穿过海气界面（$z=0$）的湍动运动学通量。它由表面垂直速度脉动 $w'$ 和浮力脉动 $b'$ 的协方差给出：\n$$ B_0 = \\langle w'b' \\rangle_s $$\n其中尖括号 $\\langle \\cdot \\rangle$ 表示湍流平均，下标 $s$ 表示在表面处取值。代入 $b$ 的表达式：\n$$ B_0 = \\langle w' g(\\alpha T' - \\beta S') \\rangle_s = g(\\alpha \\langle w'T' \\rangle_s - \\beta \\langle w'S' \\rangle_s) $$\n项 $\\langle w'T' \\rangle_s$ 是运动学表面热通量。它与净表面热通量 $Q_T$（单位为 $\\mathrm{W\\, m^{-2}}$ 或 $\\mathrm{J\\, s^{-1}\\, m^{-2}}$）的关系如下：\n$$ Q_T = \\rho_0 c_p \\langle w'T' \\rangle_s $$\n给定的符号约定是，当海洋冷却时 $Q_T  0$。这意味着热量从海洋流出，对应于负的运动学热通量。整理 $\\langle w'T' \\rangle_s$ 的表达式：\n$$ \\langle w'T' \\rangle_s = \\frac{Q_T}{\\rho_0 c_p} $$\n项 $\\langle w'S' \\rangle_s$ 是运动学表面盐通量。这个通量并非由于与大气的直接盐分交换，而是由淡水通量产生的“虚拟”盐通量。净蒸发，$E-P  0$，从表层带走淡水，增加了剩余海水的盐度。盐度的增加可以表示为等效的盐分输入海洋的通量。这个虚拟盐通量的大小由下式给出：\n$$ \\langle w'S' \\rangle_s = S_0 (E-P) $$\n这里，$S_0$ 是表面盐度，$E-P$ 是以 $\\mathrm{m\\, s^{-1}}$ 为单位的净淡水通量。如果 $E-P  0$，表面盐度增加，这等效于一个正的（向下的）盐通量。\n\n将运动学通量的表达式代回 $B_0$ 的方程中：\n$$ B_0 = g \\left( \\alpha \\frac{Q_T}{\\rho_0 c_p} - \\beta S_0 (E-P) \\right) $$\n这个表达式将表面浮力通量与大气强迫联系起来，大气强迫由热通量 $Q_T$ 和淡水通量 $E-P$ 代表。负的 $B_0$ 对应于表面浮力损失（水变得更稠密），这会使水体变得不稳定，并可能导致对流。正的 $B_0$ 对应于浮力增加（水变得更轻），这会使水体分层。\n\n### 数值计算\n我们现在使用给定的数值计算 $B_0$。首先，所有量都必须使用统一的国际单位制（SI）单位。淡水通量 $E-P$ 必须从 $\\mathrm{m\\, yr^{-1}}$ 转换为 $\\mathrm{m\\, s^{-1}}$。\n$$ 1\\,\\mathrm{yr} = 365 \\times 24 \\times 3600\\,\\mathrm{s} = 31,536,000\\,\\mathrm{s} $$\n$$ E-P = \\frac{1\\,\\mathrm{m}}{31,536,000\\,\\mathrm{s}} \\approx 3.170979... \\times 10^{-8}\\,\\mathrm{m\\, s^{-1}} $$\n\n浮力通量 $B_0$ 包含一个热分量 $B_T$ 和一个盐分量 $B_S$。\n$$ B_0 = B_T + B_S $$\n热分量为：\n$$ B_T = g \\alpha \\frac{Q_T}{\\rho_0 c_p} $$\n代入数值：\n$$ B_T = (9.81\\,\\mathrm{m\\, s^{-2}}) (2 \\times 10^{-4}\\,\\mathrm{K^{-1}}) \\frac{-200\\,\\mathrm{J\\, s^{-1}\\, m^{-2}}}{(1025\\,\\mathrm{kg\\, m^{-3}}) (4000\\,\\mathrm{J\\, kg^{-1}\\, K^{-1}})} $$\n$$ B_T = (1.962 \\times 10^{-3}\\,\\mathrm{m\\, s^{-2}\\, K^{-1}}) \\frac{-200\\,\\mathrm{K\\, kg\\, m s^{-1}}}{4,100,000\\,\\mathrm{kg\\, m^{-1}}} $$\n$$ B_T = (1.962 \\times 10^{-3}) (-4.87804... \\times 10^{-5})\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_T \\approx -9.5707... \\times 10^{-8}\\,\\mathrm{m^2\\, s^{-3}} $$\n盐分量为：\n$$ B_S = -g \\beta S_0 (E-P) $$\n代入数值：\n$$ B_S = -(9.81\\,\\mathrm{m\\, s^{-2}}) (7.5 \\times 10^{-4}\\,\\mathrm{psu^{-1}}) (35\\,\\mathrm{psu}) (3.170979... \\times 10^{-8}\\,\\mathrm{m\\, s^{-1}}) $$\n$$ B_S = -(9.81) (7.5 \\times 10^{-4}) (35) (3.170979... \\times 10^{-8})\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_S = -(0.2575125) (3.170979... \\times 10^{-8})\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_S \\approx -8.1678... \\times 10^{-9}\\,\\mathrm{m^2\\, s^{-3}} $$\n总表面浮力通量是这两个分量的和：\n$$ B_0 = B_T + B_S = (-9.5707... \\times 10^{-8}) + (-8.1678... \\times 10^{-9})\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_0 = (-9.5707... \\times 10^{-8}) - (0.81678... \\times 10^{-8})\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_0 = -10.3875... \\times 10^{-8}\\,\\mathrm{m^2\\, s^{-3}} $$\n$$ B_0 = -1.03875... \\times 10^{-7}\\,\\mathrm{m^2\\, s^{-3}} $$\n四舍五入到三位有效数字，结果是：\n$$ B_0 \\approx -1.04 \\times 10^{-7}\\,\\mathrm{m^2\\, s^{-3}} $$\n浮力通量 $B_0$ 的净符号为负。这表示海洋表面净浮力损失。表层水的冷却和因蒸发导致的盐度增加都导致表层密度增加，使表层水浮力减小，从而促进垂直混合或深层水形成。",
            "answer": "$$ \\boxed{-1.04 \\times 10^{-7}} $$"
        },
        {
            "introduction": "温盐环流系统表现出复杂的非线性行为，其稳定性是气候科学中的一个核心问题。本练习将引导您分析一个经典的双箱模型，这是一个用于理解大西洋经向翻转环流（AMOC）稳定性的简化系统 。通过求解该模型的稳态解，您将探索淡水强迫如何导致环流系统出现多个平衡态（例如“开启”和“关闭”状态），并判断不同状态下的主导驱动力。",
            "id": "3926295",
            "problem": "考虑一个在Boussinesq近似下的大西洋经向翻转环流（AMOC）的双箱模型，其中一个箱体代表低纬度，另一个代表高纬度。假设箱体之间交换一个无量纲的翻转输运量 $\\tilde{q}$，当上层水流从低纬度流向高纬度时，该值取正。假设密度异常与箱间温差和盐度差呈线性状态方程关系，并且热量和盐量在物理规定的边界通量作用下处于稳态守恒。目标是计算 $\\tilde{q}$ 的多个稳态解（如果存在），并根据对密度的相对贡献将翻转环流分类为热主导型或盐主导型。\n\n基本依据：\n- Boussinesq近似意味着流体不可压缩，且密度变化仅影响浮力，不影响连续性。\n- 海水密度异常的线性状态方程为 $\\Delta \\rho = \\rho_0\\left(-\\alpha \\Delta T + \\beta \\Delta S\\right)$，其中 $\\rho_0$ 是参考密度，$\\alpha$ 是热膨胀系数，$\\beta$ 是盐缩系数，$\\Delta T$ 是温差（低纬度减去高纬度），$\\Delta S$ 是盐度差（低纬度减去高纬度）。\n- 对于一个具有平流和线性表面强迫的充分混合箱体，其稳态标量守恒对温度给出 $0 = \\eta\\left(\\Delta T_\\star - \\Delta T\\right) - \\left(|\\tilde{q}| + \\kappa_T\\right)\\Delta T$，对盐度给出 $0 = f_S - \\left(|\\tilde{q}| + \\kappa_S\\right)\\Delta S^\\prime$。其中 $\\eta$ 是温度的弛豫率，$\\Delta T_\\star$ 是一个预设的大尺度经向温度反差，$\\kappa_T$ 和 $\\kappa_S$ 分别是温度和盐度的无量纲对称混合参数，$f_S$ 是一个无量纲淡水强迫（表示为虚拟盐通量），$\\Delta S^\\prime$ 是由特征盐度反差 $S_\\star$ 缩放的无量纲盐度差。这些关系得出\n$$\nx(\\tilde{q}) = \\frac{\\Delta T}{\\Delta T_\\star} = \\frac{1}{1 + |\\tilde{q}| + \\kappa_T}, \\quad y(\\tilde{q}) = \\frac{\\Delta S^\\prime}{1} = \\frac{f_S}{|\\tilde{q}| + \\kappa_S}.\n$$\n- 一个水力闭合关系将输运与无量纲化的密度差联系起来，表示为\n$$\n\\tilde{q} = c\\left(-\\alpha\\,\\Delta T_\\star\\,x(\\tilde{q}) + \\beta\\,S_\\star\\,y(\\tilde{q})\\right),\n$$\n其中 $c$ 是一个结合了几何、摩擦与弛豫尺度的无量纲比例常数，$S_\\star$ 是盐度差的缩放尺度。\n\n因此，稳态问题是一个非线性的分段系统\n$$\n\\tilde{q} = c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 + |\\tilde{q}| + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{|\\tilde{q}| + \\kappa_S}\\right),\n$$\n该系统可能根据参数的不同而拥有多个 $\\tilde{q}$ 的实数解。对于给定的解 $\\tilde{q}$，计算实际的温度和盐度反差：\n$$\n\\Delta T = \\Delta T_\\star\\,x(\\tilde{q}) = \\Delta T_\\star \\frac{1}{1 + |\\tilde{q}| + \\kappa_T}, \\quad \\Delta S = S_\\star\\,y(\\tilde{q}) = S_\\star \\frac{f_S}{|\\tilde{q}| + \\kappa_S},\n$$\n以及相应的密度贡献\n$$\nD_T = \\alpha\\,\\Delta T, \\quad D_S = \\beta\\,\\Delta S.\n$$\n如果 $|D_T|  |D_S|$，则将平衡态分类为热主导型；如果 $|D_S| \\ge |D_T|$，则分类为盐主导型。\n\n您必须编写一个完整的、可运行的程序，对于一组指定的参数和淡水强迫值，该程序能在分支 $\\tilde{q} \\ge 0$ 和 $\\tilde{q} \\le 0$ 上找到 $\\tilde{q}$ 的所有稳态解，对每个解进行分类，并总结（在所有测试的 $f_S$ 值中）产生热主导与盐主导翻转环流的参数范围。\n\n您的算法应：\n- 通过在 $\\tilde{q} \\ge 0$ 上使用 $|\\tilde{q}| = \\tilde{q}$ 和在 $\\tilde{q} \\le 0$ 上使用 $|\\tilde{q}| = -\\tilde{q}$ 分别求解，来处理分段的绝对值。\n- 对于每个分支，定义函数\n$$\ng_\\pm(\\tilde{q}) = c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 \\pm \\tilde{q} + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{\\pm \\tilde{q} + \\kappa_S}\\right) - \\tilde{q},\n$$\n其中 $+$ 对应 $\\tilde{q} \\ge 0$，$-$ 对应 $\\tilde{q} \\le 0$，并使用稳健的区间套定法，在有界搜索域 $[-Q_{\\max}, Q_{\\max}]$（其中 $Q_{\\max} = 100$）内找到所有实根。舍弃任何违反分支符号条件的根。\n- 对于找到的每个根，计算 $\\Delta T$、$\\Delta S$、$D_T$、$D_S$ 及其分类。\n\n测试套件：\n定义四个测试用例，每个用例为一个参数元组和一个淡水强迫值 $f_S$ 的列表。参数为 $\\alpha$（单位：/开尔文）、$\\beta$（单位：/实用盐度单位）、$\\Delta T_\\star$（单位：开尔文）、$S_\\star$（单位：实用盐度单位）、$\\kappa_T$（无量纲）、$\\kappa_S$（无量纲）和 $c$（无量纲）。使用以下科学上合理的值：\n- 测试用例1：$(\\alpha, \\beta, \\Delta T_\\star, S_\\star, \\kappa_T, \\kappa_S, c) = (2\\times 10^{-4}, 8\\times 10^{-4}, 25, 2, 0.3, 0.2, 80)$，其中 $f_S \\in \\{0.1, 0.3, 0.5, 0.7, 0.9\\}$。\n- 测试用例2：$(\\alpha, \\beta, \\Delta T_\\star, S_\\star, \\kappa_T, \\kappa_S, c) = (2\\times 10^{-4}, 8\\times 10^{-4}, 15, 3, 0.1, 0.1, 120)$，其中 $f_S \\in \\{0.0, 0.2, 0.4, 0.6, 0.8, 1.0\\}$。\n- 测试用例3：$(\\alpha, \\beta, \\Delta T_\\star, S_\\star, \\kappa_T, \\kappa_S, c) = (2\\times 10^{-4}, 8\\times 10^{-4}, 35, 1, 0.5, 0.5, 50)$，其中 $f_S \\in \\{0.05, 0.1, 0.2, 0.4\\}$。\n- 测试用例4：$(\\alpha, \\beta, \\Delta T_\\star, S_\\star, \\kappa_T, \\kappa_S, c) = (2\\times 10^{-4}, 8\\times 10^{-4}, 20, 2.5, 0.2, 0.3, 100)$，其中 $f_S \\in \\{0.15, 0.25, 0.35, 0.45, 0.55, 0.65, 0.75\\}$。\n\n对每个测试用例，在其 $f_S$ 列表上计算：\n- 在所有 $f_S$ 值中找到的稳态解的最大数量（一个整数）。\n- 存在至少一个热主导平衡态的 $f_S$ 值的数量（一个整数）。\n- 存在至少一个盐主导平衡态的 $f_S$ 值的数量（一个整数）。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例对应一个包含上述三个整数的列表，顺序与描述一致。例如，输出应类似于 $[ [n_1,t_1,s_1],[n_2,t_2,s_2],\\dots ]$。所有输出都是无量纲的，报告时不得附带任何物理单位。本问题不涉及角度，因此无需指定角度单位，也未要求百分比。",
            "solution": "用户提供了一个来自环境与地球系统建模领域的问题，具体聚焦于一个简化的大西洋经向翻转环流（AMOC）双箱模型。任务是找到翻转输运的多个稳态解，并根据主导的密度驱动机制（热力或盐度）对其进行分类。\n\n### 问题验证\n\n**步骤1：提取已知信息**\n\n- **模型：** Boussinesq近似下AMOC的双箱模型。\n- **状态变量：** 无量纲翻转输运量 $\\tilde{q}$。\n- **状态方程：** 线性密度异常 $\\Delta \\rho = \\rho_0\\left(-\\alpha \\Delta T + \\beta \\Delta S\\right)$。\n- **无量纲标量差：**\n  - 温度：$x(\\tilde{q}) = \\frac{\\Delta T}{\\Delta T_\\star} = \\frac{1}{1 + |\\tilde{q}| + \\kappa_T}$\n  - 盐度：$y(\\tilde{q}) = \\frac{\\Delta S^\\prime}{1} = \\frac{f_S}{|\\tilde{q}| + \\kappa_S}$\n- **水力闭合：** $\\tilde{q} = c\\left(-\\alpha\\,\\Delta T_\\star\\,x(\\tilde{q}) + \\beta\\,S_\\star\\,y(\\tilde{q})\\right)$\n- **完整稳态方程：** $\\tilde{q} = c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 + |\\tilde{q}| + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{|\\tilde{q}| + \\kappa_S}\\right)$\n- **物理参数定义：** $\\alpha$（热膨胀系数）、$\\beta$（盐缩系数）、$\\Delta T_\\star$（特征温度反差）、$S_\\star$（特征盐度反差）、$\\kappa_T$、$\\kappa_S$（无量纲混合参数）、$c$（无量纲水力常数）、$f_S$（无量纲淡水强迫）。\n- **分类标准：**\n  - 如果 $|D_T|  |D_S|$，则平衡态为热主导。\n  - 如果 $|D_S| \\ge |D_T|$，则平衡态为盐主导。\n  - 其中 $D_T = \\alpha\\,\\Delta T$ 且 $D_S = \\beta\\,\\Delta S$。\n- **算法要求：**\n  - 分别求解 $\\tilde{q} \\ge 0$ 和 $\\tilde{q} \\le 0$ 的情况。\n  - 求函数 $g_\\pm(\\tilde{q}) = c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 \\pm \\tilde{q} + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{\\pm \\tilde{q} + \\kappa_S}\\right) - \\tilde{q} = 0$ 的根。\n  - 在搜索域 $[-100, 100]$ 上使用稳健的区间套定法。\n- **测试用例和输出：** 提供了四组特定的参数和相关的 $f_S$ 值列表。对每个测试用例，要求输出一个包含三个整数的列表：找到的稳态解的最大数量、具有至少一个热主导态的 $f_S$ 值的计数，以及具有至少一个盐主导态的 $f_S$ 值的计数。\n\n**步骤2：验证**\n\n- **科学依据：** 该问题在物理海洋学中有坚实的理论基础。使用Stommel型箱式模型，配合线性状态方程和指定的强迫，是研究AMOC稳定性及多重平衡态可能性的经典有效方法。所提供的参数值在物理上是现实的。\n- **适定性：** 该问题是适定的。它要求解一个定义明确但非线性且分段的代数方程。关于求解方法（稳健的区间套定法）和具体输出的说明是清晰明确的。\n- **客观性：** 问题陈述完全客观，使用了精确的数学公式和量化标准。不含主观或基于观点的内容。\n\n所有其他验证标准（完整性、一致性、可行性等）也得到满足。该问题是一个应用于公认物理模型的标准数值分析任务。\n\n**步骤3：结论**\n\n问题有效。将开发一个完整的解决方案。\n\n### 解决方案设计\n\n问题的核心是求解关于无量纲翻转环流 $\\tilde{q}$ 的非线性方程的实根：\n$$f(\\tilde{q}) = \\tilde{q} - c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 + |\\tilde{q}| + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{|\\tilde{q}| + \\kappa_S}\\right) = 0$$\n由于存在绝对值 $|\\tilde{q}|$，我们必须在两个独立的域上分段求解该方程：$\\tilde{q} \\ge 0$ 和 $\\tilde{q} \\le 0$。\n\n**1. $\\tilde{q} \\ge 0$ 的分支：**\n对于 $\\tilde{q} \\ge 0$，我们有 $|\\tilde{q}| = \\tilde{q}$。方程变为：\n$$f_+(\\tilde{q}) = \\tilde{q} - c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 + \\tilde{q} + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{\\tilde{q} + \\kappa_S}\\right) = 0$$\n我们在域 $[0, Q_{\\max}]$（其中 $Q_{\\max}=100$）内寻找 $f_+(\\tilde{q})$ 的根。\n\n**2. $\\tilde{q} \\le 0$ 的分支：**\n对于 $\\tilde{q} \\le 0$，我们有 $|\\tilde{q}| = -\\tilde{q}$。方程变为：\n$$f_-(\\tilde{q}) = \\tilde{q} - c\\left(-\\alpha\\,\\Delta T_\\star\\,\\frac{1}{1 - \\tilde{q} + \\kappa_T} + \\beta\\,S_\\star\\,\\frac{f_S}{-\\tilde{q} + \\kappa_S}\\right) = 0$$\n我们在域 $[-Q_{\\max}, 0]$ 内寻找 $f_-(\\tilde{q})$ 的根。注意，由于 $\\tilde{q} \\le 0$ 且 $\\kappa_T, \\kappa_S  0$，分母总是正数，因此在搜索域内没有奇点。\n\n**3. 求根算法：**\n为使用区间套定法稳健地找到所有根，我们将对每个分支采用扫描求解法：\n- 将搜索域（例如 $[0, Q_{\\max}]$）离散化为大量小区间。\n- 我们在每个小区间 $[x_i, x_{i+1}]$ 的端点上计算函数值（$f_+$ 或 $f_-$）。\n- 如果函数变号，即 $f(x_i) \\cdot f(x_{i+1})  0$，则该区间内必有根。\n- 然后应用一个使用区间套定的数值求根器，例如Brent方法（`scipy.optimize.brentq`），对每个此类区间进行高精度求根。\n- 通过计算 $f(\\tilde{q})$ 在 $\\tilde{q}=0$ 处的值，对 $\\tilde{q}=0$ 处的根进行特殊检查。\n- 收集两个分支上找到的所有唯一根。\n\n**4. 平衡态分类：**\n对于找到的每个有效根 $\\tilde{q}$，我们对相应的平衡态进行分类。\n- 首先，我们计算热力和盐度密度贡献的绝对值 $|D_T|$ 和 $|D_S|$：\n$$|D_T| = \\left|\\alpha\\,\\Delta T\\right| = \\alpha\\,\\Delta T_\\star \\frac{1}{1 + |\\tilde{q}| + \\kappa_T}$$\n$$|D_S| = \\left|\\beta\\,\\Delta S\\right| = \\beta\\,S_\\star \\frac{f_S}{|\\tilde{q}| + \\kappa_S}$$\n（注意：由于在测试用例中所有参数 $\\alpha, \\beta, \\Delta T_\\star, S_\\star, f_S$ 都是非负的，分母也一样，所以密度贡献 $D_T$ 和 $D_S$ 本身是非负的，因此绝对值符号可以省略，但为了一般性我们保留它们）。\n- 然后根据指定的标准确定分类：\n  - 如果 $|D_T|  |D_S|$，则平衡态为**热主导**。\n  - 如果 $|D_S| \\ge |D_T|$，则平衡态为**盐主导**。\n\n**5. 程序化实现：**\n对提供的四个测试用例中的每一个都实现整个算法。对于每个测试用例，我们遍历其淡水强迫值 $f_S$ 的列表。对于每个 $f_S$：\n- 我们找到所有的稳态解 $\\tilde{q}$。\n- 我们对每个解进行分类。\n- 我们记录解的总数，以及是否存在至少一个热主导和/或一个盐主导的解。\n\n对给定测试用例的所有 $f_S$ 值进行迭代后，我们计算所需的三个聚合指标：\n1.  在任何单个 $f_S$ 值下找到的解的最大数量。\n2.  产生至少一个热主导解的 $f_S$ 值的总数。\n3.  产生至少一个盐主导解的 $f_S$ 值的总数。\n\n然后将所有四个测试用例的结果合并为一个列表的列表，作为最终输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import optimize\n\ndef solve():\n    \"\"\"\n    Solves the two-box AMOC model for multiple equilibria across a range of\n    freshwater forcings for four different parameter sets.\n    \"\"\"\n\n    # Define the four test cases as per the problem statement.\n    test_cases = [\n        {\n            \"params\": (2e-4, 8e-4, 25, 2, 0.3, 0.2, 80),\n            \"fS_values\": [0.1, 0.3, 0.5, 0.7, 0.9]\n        },\n        {\n            \"params\": (2e-4, 8e-4, 15, 3, 0.1, 0.1, 120),\n            \"fS_values\": [0.0, 0.2, 0.4, 0.6, 0.8, 1.0]\n        },\n        {\n            \"params\": (2e-4, 8e-4, 35, 1, 0.5, 0.5, 50),\n            \"fS_values\": [0.05, 0.1, 0.2, 0.4]\n        },\n        {\n            \"params\": (2e-4, 8e-4, 20, 2.5, 0.2, 0.3, 100),\n            \"fS_values\": [0.15, 0.25, 0.35, 0.45, 0.55, 0.65, 0.75]\n        }\n    ]\n\n    all_results = []\n    Q_max = 100.0  # Search domain [-Q_max, Q_max]\n    num_scan_points = 2001 # Number of points to scan for root bracketing\n    root_tolerance = 1e-9\n\n    def find_all_roots(func, domain_min, domain_max, args):\n        \"\"\"Finds all roots of a function in a domain by scanning for sign changes.\"\"\"\n        roots = []\n        domain = np.linspace(domain_min, domain_max, num_scan_points)\n        f_vals = func(domain, *args)\n        \n        for i in range(len(domain) - 1):\n            if f_vals[i] * f_vals[i+1]  0:\n                try:\n                    root = optimize.brentq(func, domain[i], domain[i+1], args=args)\n                    \n                    # Avoid adding duplicate roots\n                    is_duplicate = False\n                    for r in roots:\n                        if abs(root - r)  root_tolerance:\n                            is_duplicate = True\n                            break\n                    if not is_duplicate:\n                        roots.append(root)\n\n                except ValueError:\n                    # brentq can fail if values at endpoints have the same sign,\n                    # which can happen with floating point inaccuracies. Pass.\n                    pass\n        return roots\n\n    for case in test_cases:\n        alpha, beta, delta_T_star, S_star, kappa_T, kappa_S, c = case[\"params\"]\n        fS_values = case[\"fS_values\"]\n\n        max_num_states = 0\n        thermal_count = 0\n        salinity_count = 0\n\n        for f_S in fS_values:\n            args = (alpha, beta, delta_T_star, S_star, kappa_T, kappa_S, c, f_S)\n\n            # Define the functions for the two branches (q >= 0 and q = 0)\n            def f_plus(q, alpha, beta, delta_T_star, S_star, kappa_T, kappa_S, c, f_S):\n                term_T = -alpha * delta_T_star / (1 + q + kappa_T)\n                term_S = beta * S_star * f_S / (q + kappa_S)\n                return q - c * (term_T + term_S)\n\n            def f_minus(q, alpha, beta, delta_T_star, S_star, kappa_T, kappa_S, c, f_S):\n                term_T = -alpha * delta_T_star / (1 - q + kappa_T)\n                term_S = beta * S_star * f_S / (-q + kappa_S)\n                return q - c * (term_T + term_S)\n            \n            solutions = []\n\n            # Check for root at q=0\n            if f_S > 0: # Avoid division by zero if kappa_S is 0\n                val_at_zero = -c * (\n                    -alpha * delta_T_star / (1 + kappa_T) +\n                    beta * S_star * f_S / kappa_S\n                )\n                if abs(val_at_zero)  root_tolerance:\n                    solutions.append(0.0)\n\n            # Find roots on q > 0 branch\n            positive_roots = find_all_roots(f_plus, root_tolerance, Q_max, args)\n            solutions.extend(positive_roots)\n\n            # Find roots on q  0 branch\n            negative_roots = find_all_roots(f_minus, -Q_max, -root_tolerance, args)\n            solutions.extend(negative_roots)\n\n            max_num_states = max(max_num_states, len(solutions))\n            \n            has_thermal = False\n            has_salinity = False\n            \n            if solutions:\n                for q_tilde in solutions:\n                    q_abs = abs(q_tilde)\n                    \n                    # Calculate density contributions\n                    D_T_abs = alpha * delta_T_star / (1 + q_abs + kappa_T)\n                    D_S_abs = beta * S_star * f_S / (q_abs + kappa_S)\n                    \n                    # Classify\n                    if D_T_abs > D_S_abs:\n                        has_thermal = True\n                    else: # D_S_abs >= D_T_abs\n                        has_salinity = True\n            \n            if has_thermal:\n                thermal_count += 1\n            if has_salinity:\n                salinity_count += 1\n        \n        all_results.append([max_num_states, thermal_count, salinity_count])\n\n    # Format the final output string exactly as specified.\n    # str() on a list produces the correct \"[v1, v2, ...]\" format.\n    result_str = \",\".join(map(str, all_results))\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        }
    ]
}