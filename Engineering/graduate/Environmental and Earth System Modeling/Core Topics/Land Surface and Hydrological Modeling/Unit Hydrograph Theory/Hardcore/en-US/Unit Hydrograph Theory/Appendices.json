{
    "hands_on_practices": [
        {
            "introduction": "The foundation of Unit Hydrograph theory lies in treating a catchment as a Linear Time-Invariant (LTI) system. This powerful abstraction allows us to predict the runoff response to any complex rainfall event by understanding its response to a single, simple input. This practice () operationalizes this core concept by guiding you to implement the principle of superposition through discrete convolution, building a predictive flood hydrograph model from the ground up.",
            "id": "3928620",
            "problem": "You are tasked with developing a computational method to predict a flood hydrograph for a multi-peak effective rainfall hyetograph by decomposing it into rectangular pulses and summing the corresponding $U_D(t)$ responses. Work within the principles of Unit Hydrograph theory in a rainfall–runoff system. Assume the watershed behaves approximately as a Linear Time-Invariant (LTI) system with negligible non-linearities over the range of inputs and durations considered, and that mass conservation holds. The Unit Hydrograph (UH) of duration $D$ hours, denoted $U_D(t)$, is defined here as the per-unit-depth response function: the direct runoff discharge per unit depth of effective rainfall applied uniformly for duration $D$. Accordingly, $U_D(t)$ has units of cubic meters per second per millimeter, so that multiplying $U_D(t)$ by a rainfall excess depth in millimeters yields discharge in cubic meters per second.\n\nStarting from the following fundamental bases:\n- Linearity: If an effective rainfall input of depth $a$ produces a direct runoff hydrograph $a \\cdot U_D(t)$ and a depth $b$ produces $b \\cdot U_D(t)$, then depth $a+b$ produces $\\left(a+b\\right) \\cdot U_D(t)$.\n- Time invariance: If a depth $p$ is applied as a rectangular pulse over an interval of duration $D$, then shifting the pulse by time $\\tau$ shifts the response by the same $\\tau$ without changing its shape or magnitude.\n- Mass conservation: The integral of the discharge resulting from a unit depth of effective rainfall equals the corresponding volume of water generated by that depth over the catchment area.\n\nUsing these principles, derive an algorithm that, for a multi-peak hyetograph represented as a finite sequence of rectangular pulses of duration $D$, predicts the corresponding direct runoff hydrograph by summing scaled and time-shifted $U_D(t)$ responses. Implement this algorithm in a program that operates on discrete time with step size equal to the pulse duration $D$.\n\nDefinitions and computational requirements:\n- Let $D$ be the pulse duration in hours.\n- Let the effective rainfall hyetograph be given by intensities $r_k$ in millimeters per hour for each rectangular pulse $k$. The depth in millimeters of pulse $k$ is $p_k = r_k \\times D$.\n- Let $U_D[n]$ be the sampled per-unit-depth Unit Hydrograph values at discrete times $t_n = nD$ with units cubic meters per second per millimeter.\n- The predicted discharge sequence $Q[n]$ in cubic meters per second is obtained by summing the scaled and time-shifted $U_D$ responses corresponding to each pulse depth $p_k$.\n\nYour program must compute $Q[n]$ for each provided test case. Express all predicted discharges in cubic meters per second ($\\mathrm{m^3/s}$), rounded to three decimal places.\n\nTest Suite:\n- Case $1$ (happy path, multi-peak):\n  - Pulse duration $D = 1$ hour.\n  - Effective rainfall intensities $r_k$ (millimeters per hour): $[0, 6, 18, 0, 12, 6, 0]$.\n  - Per-unit-depth Unit Hydrograph $U_D[n]$ (cubic meters per second per millimeter): $[0, 40, 120, 80, 40, 0]$.\n- Case $2$ (boundary condition with interspersed zero pulses):\n  - Pulse duration $D = 2$ hours.\n  - Effective rainfall intensities $r_k$ (millimeters per hour): $[0, 8, 0, 12, 0]$.\n  - Per-unit-depth Unit Hydrograph $U_D[n]$ (cubic meters per second per millimeter): $[0, 25, 75, 50, 25, 0]$.\n- Case $3$ (edge case with very short Unit Hydrograph):\n  - Pulse duration $D = 1$ hour.\n  - Effective rainfall intensities $r_k$ (millimeters per hour): $[5, 0, 5, 0, 5]$.\n  - Per-unit-depth Unit Hydrograph $U_D[n]$ (cubic meters per second per millimeter): $[0, 30, 0]$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is an inner list of floats for the predicted hydrograph of one test case. For example: $[[q_{1,0}, q_{1,1}, \\dots],[q_{2,0}, \\dots],[q_{3,0}, \\dots]]$. The values must be in $\\mathrm{m^3/s}$, rounded to three decimal places.",
            "solution": "The user has provided a problem statement that requires the development of a computational method for predicting a flood hydrograph based on the principles of Unit Hydrograph theory. The initial and most critical step is to validate the problem's integrity.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Core Principles**: Linearity, Time Invariance, Mass Conservation.\n- **System**: A rainfall–runoff system modeled as a Linear Time-Invariant (LTI) system.\n- **Definitions**:\n    - $D$: Pulse duration in hours.\n    - $U_D(t)$: Per-unit-depth Unit Hydrograph of duration $D$, defined as the direct runoff discharge per unit depth of effective rainfall. Units are cubic meters per second per millimeter ($\\mathrm{m^3/s/mm}$).\n    - $r_k$: Effective rainfall intensity for rectangular pulse $k$, in millimeters per hour ($\\mathrm{mm/hr}$).\n    - $p_k$: Depth of pulse $k$, calculated as $p_k = r_k \\times D$, in millimeters ($\\mathrm{mm}$).\n    - $U_D[n]$: Sampled per-unit-depth Unit Hydrograph values at discrete times $t_n = nD$.\n    - $Q[n]$: Predicted discharge sequence in cubic meters per second ($\\mathrm{m^3/s}$).\n- **Computational Requirement**: Compute $Q[n]$ by summing scaled and time-shifted $U_D$ responses, with results rounded to three decimal places.\n- **Test Case 1**:\n    - $D = 1$ hour.\n    - $r_k = [0, 6, 18, 0, 12, 6, 0]$ $\\mathrm{mm/hr}$.\n    - $U_D[n] = [0, 40, 120, 80, 40, 0]$ $\\mathrm{m^3/s/mm}$.\n- **Test Case 2**:\n    - $D = 2$ hours.\n    - $r_k = [0, 8, 0, 12, 0]$ $\\mathrm{mm/hr}$.\n    - $U_D[n] = [0, 25, 75, 50, 25, 0]$ $\\mathrm{m^3/s/mm}$.\n- **Test Case 3**:\n    - $D = 1$ hour.\n    - $r_k = [5, 0, 5, 0, 5]$ $\\mathrm{mm/hr}$.\n    - $U_D[n] = [0, 30, 0]$ $\\mathrm{m^3/s/mm}$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is subjected to rigorous validation:\n- **Scientifically Grounded**: The problem is fundamentally based on the Unit Hydrograph theory, a cornerstone of engineering hydrology for modeling rainfall-runoff processes. The LTI system assumption, along with the principles of linearity (superposition) and time invariance, are the canonical framework for this theory. The problem is a direct and standard application of these principles.\n- **Well-Posed**: The problem is well-posed. Given an input signal (effective rainfall hyetograph) and the system's impulse response (Unit Hydrograph), the task of finding the output signal (direct runoff hydrograph) is a well-defined mathematical problem. For the given discrete inputs, a unique and stable solution exists.\n- **Objective**: The problem is stated using precise, quantitative, and unambiguous terminology. All variables, units, and relationships are explicitly defined.\n- **Flaw Analysis**:\n    1.  **Scientific Unsoundness**: None. The model is a standard, albeit simplified, representation of a real-world hydrological system.\n    2.  **Non-Formalizable/Irrelevant**: None. The problem is directly formalizable into a mathematical algorithm. It is entirely relevant to the specified topic.\n    3.  **Incomplete/Contradictory**: None. All necessary data ($D$, $r_k$, $U_D[n]$) are provided for each test case. The definitions and units are internally consistent (e.g., $(\\mathrm{mm/hr}) \\times (\\mathrm{hr}) = \\mathrm{mm}$; $(\\mathrm{mm}) \\times (\\mathrm{m^3/s/mm}) = \\mathrm{m^3/s}$).\n    4.  **Unrealistic/Infeasible**: None. The numerical values for rainfall and runoff are within plausible ranges for hypothetical catchments.\n    5.  **Ill-Posed**: None. The problem structure leads to a unique solution via a standard algorithm.\n    6.  **Pseudo-Profound/Trivial**: None. The problem assesses the core conceptual and computational understanding of the convolution principle in an applied science context. It is a fundamental, not trivial, exercise.\n    7.  **Outside Verifiability**: None. The results are deterministic and computationally verifiable.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. It is scientifically sound, well-posed, and internally consistent. The solution process can proceed.\n\n### Principle-Based Solution Derivation\n\nThe problem requires the calculation of a direct runoff hydrograph, $Q[n]$, resulting from a multi-peak effective rainfall hyetograph. The foundation for this calculation rests upon the principles of linearity and time-invariance, which define the watershed as a Linear Time-Invariant (LTI) system.\n\n**1. System Representation in Discrete Time**\nThe system is analyzed at discrete time steps of size $D$.\n- The input is the effective rainfall hyetograph, represented as a sequence of depths, $P = \\{p_0, p_1, \\dots, p_{M-1}\\}$. Each depth $p_k$ is derived from the given rainfall intensity $r_k$ over the duration $D$:\n$$ p_k = r_k \\cdot D $$\nwhere $k$ is the time index, such that time $t = kD$.\n- The system's fundamental response is characterized by the per-unit-depth Unit Hydrograph, $U_D[n]$, a discrete sequence $U = \\{u_0, u_1, \\dots, u_{N-1}\\}$ where $u_n = U_D[n]$. This represents the hydrograph resulting from a single rainfall pulse of unit depth ($1$ mm) and duration $D$.\n\n**2. Application of Superposition and Time-Invariance**\nThe total runoff is the sum of the responses to each individual rainfall pulse.\n\n- **Response to a single pulse**: Consider the rainfall pulse $p_k$ occurring at time index $k$.\n    - By the principle of **linearity**, the magnitude of the runoff hydrograph is scaled by the depth of the rainfall. The response to pulse $p_k$ is therefore $p_k \\cdot U$.\n    - By the principle of **time-invariance**, the response to a pulse occurring at time $k$ is identical in shape to the response to a pulse at time $0$, but is shifted in time by $k$ steps.\n\n- **Summation of responses**: The total discharge at any time index $n$, denoted $Q[n]$, is the sum of contributions from all rainfall pulses that have occurred up to and including time $n$. The contribution at time $n$ from a pulse $p_k$ that occurred at time $k$ (where $k \\le n$) is $p_k \\cdot u_{n-k}$.\n\nSumming the contributions from all past and present pulses ($k=0, 1, \\dots, n$) gives the total discharge at time $n$:\n$$ Q[n] = \\sum_{k=0}^{n} p_k \\cdot u_{n-k} $$\nThis expression is the definition of the **discrete convolution** of the input sequence $P$ and the system response sequence $U$. It is often denoted as:\n$$ Q = P * U $$\n\n**3. Algorithmic Implementation**\nThe problem is reduced to computing the discrete convolution of the effective rainfall depth sequence and the unit hydrograph ordinate sequence.\n\n- **Step A: Pre-processing**: For each test case, the sequence of effective rainfall depths, $p_k$, must first be calculated from the given rainfall intensities, $r_k$, and the pulse duration, $D$.\n- **Step B: Convolution**: The sequences $P = \\{p_k\\}$ and $U = \\{u_n\\}$ are convolved to produce the direct runoff hydrograph sequence, $Q = \\{Q[n]\\}$. If $P$ has length $M$ and $U$ has length $N$, the resulting sequence $Q$ will have length $M+N-1$.\n- **Step C: Post-processing**: The calculated discharge values in $Q$ are rounded to three decimal places as required.\n\nThis procedure will be implemented for each of the three provided test cases. The `numpy` library in Python provides an efficient function, `numpy.convolve`, which performs this exact operation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes direct runoff hydrographs for given rainfall hyetographs and unit hydrographs\n    based on the principles of Linear Time-Invariant systems in hydrology.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"D\": 1,  # Pulse duration in hours\n            \"r\": [0, 6, 18, 0, 12, 6, 0],  # Effective rainfall intensities (mm/hr)\n            \"U\": [0, 40, 120, 80, 40, 0],  # Per-unit-depth Unit Hydrograph (m^3/s/mm)\n        },\n        {\n            \"D\": 2,\n            \"r\": [0, 8, 0, 12, 0],\n            \"U\": [0, 25, 75, 50, 25, 0],\n        },\n        {\n            \"D\": 1,\n            \"r\": [5, 0, 5, 0, 5],\n            \"U\": [0, 30, 0],\n        },\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Extract data for the current case\n        D = case[\"D\"]\n        r = np.array(case[\"r\"], dtype=float)\n        U = np.array(case[\"U\"], dtype=float)\n\n        # Step 1: Calculate the effective rainfall depth for each pulse.\n        # Depth (mm) = Intensity (mm/hr) * Duration (hr)\n        p = r * D\n\n        # Step 2: Compute the direct runoff hydrograph using discrete convolution.\n        # The output hydrograph Q is the convolution of the rainfall pulse depths p\n        # and the unit hydrograph U. This is the mathematical embodiment of the\n        # superposition of scaled and time-shifted responses.\n        Q = np.convolve(p, U)\n\n        # Step 3: Round the results to three decimal places as specified.\n        Q_rounded = np.round(Q, 3)\n\n        # Add the resulting list of floats to the main results list.\n        all_results.append(Q_rounded.tolist())\n\n    # Final print statement in the exact required format: [[...],[...],...]\n    # We construct the string manually to avoid extraneous spaces that `str(list)` might add.\n    inner_lists_as_strings = [str(res).replace(\" \", \"\") for res in all_results]\n    final_output_string = f\"[{','.join(inner_lists_as_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "While the assumption of linearity is a cornerstone of Unit Hydrograph theory, real-world hydrological processes often deviate from this ideal. This exercise () moves beyond simple application to critical evaluation, challenging you to design a numerical experiment that investigates how common rainfall loss models introduce nonlinearity. By quantifying the deviation from a truly linear response, you will gain a deeper understanding of the model's limitations and the conditions under which its assumptions hold.",
            "id": "3928688",
            "problem": "Consider a catchment represented by a linear time-invariant system under Unit Hydrograph Theory, where the direct runoff hydrograph is modeled as the convolution of the effective rainfall hyetograph with a unit hydrograph. The fundamental base for this problem consists of the following well-tested definitions and modeling assumptions: the effective rainfall is the portion of the rainfall that contributes to direct runoff after satisfying abstractions, and a unit hydrograph is the impulse response function that yields the catchment’s discharge per unit depth of effective rainfall. The convolution operator is used to map an input effective rainfall hyetograph into an output discharge hydrograph, consistent with the principles of linear systems. The system assumes that the unit hydrograph integrates to unity in the appropriate sense for a unit depth input. You are to design and implement a numerical test of linearity by comparing hydrograph scaling between two storms of different intensities, and you must quantify deviations using a relative squared-integral norm (the $L^2$ norm) of the difference between the actual and the linearly scaled hydrographs.\n\nUse the following ingredients to construct the rainfall and runoff:\n\n1. Rainfall hyetograph shape: Define a dimensionless triangular shape function $s(t)$ on the interval $t \\in [0,T]$ hours, with a peak at $t=T/2$, normalized such that $\\int_{0}^{T} s(t)\\,dt = 1$ hour. A valid choice is the continuous piecewise-linear function\n$$\ns(t) = \n\\begin{cases}\n\\frac{4}{T^2}\\,t & \\text{for } 0 \\le t \\le \\frac{T}{2}, \\\\\n\\frac{4}{T^2}\\,(T - t) & \\text{for } \\frac{T}{2} < t \\le T, \\\\\n0 & \\text{otherwise}.\n\\end{cases}\n$$\nGiven a constant storm intensity $R$ in $\\mathrm{mm/hr}$, the rainfall hyetograph is $R\\,s(t)$ with units $\\mathrm{mm/hr}$.\n\n2. Loss model for effective rainfall: Let there be an Initial Abstraction $I_a$ in $\\mathrm{mm}$ and a Constant Loss $f_c$ in $\\mathrm{mm/hr}$. The effective rainfall rate $p_e(t)$ in $\\mathrm{mm/hr}$ is given by a thresholded loss formulation that first satisfies the initial abstraction by cumulative rainfall depth and then applies the constant loss to the remaining intensity. Denote cumulative rainfall depth by $D(t)=\\int_0^t R\\,s(\\tau)\\,d\\tau$ in $\\mathrm{mm}$. Then for a discrete-time algorithm, at each time step, if $D(t) \\le I_a$ set $p_e(t)=0$, and otherwise set $p_e(t)=\\max\\{0, R\\,s(t) - f_c\\}$.\n\n3. Unit hydrograph: Model the unit hydrograph $h(t)$ using the Nash cascade form with shape parameter $n$ (dimensionless) and scale parameter $k$ in hours:\n$$\nh(t) = \\frac{t^{n-1}\\,e^{-t/k}}{k^n\\,\\Gamma(n)},\n$$\nfor $t \\ge 0$, where $\\Gamma(n)$ is the gamma function. This $h(t)$ has units of $\\mathrm{hr}^{-1}$ and satisfies $\\int_0^\\infty h(t)\\,dt = 1$ hour.\n\n4. Discharge computation: The direct runoff discharge hydrograph $Q(t)$ in $\\mathrm{m^3/s}$ is obtained by convolving $p_e(t)$ with $h(t)$ and converting from depth-rate over area to volumetric flow-rate. Use catchment area $A$ in $\\mathrm{km^2}$, with the conversion $1\\,\\mathrm{mm}$ over $1\\,\\mathrm{km^2}$ equals $10^3\\,\\mathrm{m^3}$, and $1\\,\\mathrm{hr} = 3600\\,\\mathrm{s}$. Numerically approximate the continuous-time convolution integral by a discrete-time convolution with a uniform time step $\\Delta t$ in hours, ensuring dimensional consistency by including the $\\Delta t$ factor.\n\n5. Linearity test: For two storms with intensities $R_1$ and $R_2$ sharing the same shape $s(t)$ and the same loss parameters $I_a$ and $f_c$, compute their discharge hydrographs $Q_1(t)$ and $Q_2(t)$. Let the intensity ratio be $c = R_2/R_1$. Define the relative $L^2$ deviation metric\n$$\n\\mathcal{E} = \\frac{\\left\\|Q_2 - c\\,Q_1\\right\\|_{L^2}}{\\max\\left(\\left\\|c\\,Q_1\\right\\|_{L^2},\\,\\varepsilon\\right)},\n$$\nwith\n$$\n\\left\\|X\\right\\|_{L^2} = \\left( \\int_0^{T_\\mathrm{end}} X(t)^2\\,dt \\right)^{1/2},\n$$\napproximated in discrete time by $\\left(\\sum_i X_i^2\\,\\Delta t_s\\right)^{1/2}$, where $\\Delta t_s = \\Delta t \\times 3600$ seconds and $T_\\mathrm{end}$ is chosen to include the full hydrograph support. Use a small positive constant $\\varepsilon$ (dimensionless in the ratio) to avoid division by zero when $\\left\\|c\\,Q_1\\right\\|_{L^2}$ vanishes; set $\\varepsilon = 10^{-12}$.\n\nYour task is to implement a program that, for each specified test case, constructs the two storms, computes $Q_1(t)$ and $Q_2(t)$ via discrete convolution with the Nash unit hydrograph, and returns the relative $L^2$ deviation $\\mathcal{E}$ as a floating-point number.\n\nUse the following test suite, each defined by $(T, \\Delta t, A, n, k, I_a, f_c, R_1, R_2)$:\n\n- Case $1$ (happy path, perfectly linear system since losses are zero): $(T=$ $6$ $\\mathrm{hr}$, $\\Delta t=$ $0.1$ $\\mathrm{hr}$, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ $\\mathrm{hr}$, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $0$ $\\mathrm{mm/hr}$, $R_1=$ $10$ $\\mathrm{mm/hr}$, $R_2=$ $25$ $\\mathrm{mm/hr})$.\n- Case $2$ (nonlinearity due to constant loss): $(T=$ $6$ $\\mathrm{hr}$, $\\Delta t=$ $0.1$ $\\mathrm{hr}$, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ $\\mathrm{hr}$, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $5$ $\\mathrm{mm/hr}$, $R_1=$ $10$ $\\mathrm{mm/hr}$, $R_2=$ $25$ $\\mathrm{mm/hr})$.\n- Case $3$ (nonlinearity due to initial abstraction): $(T=$ $6$ $\\mathrm{hr}$, $\\Delta t=$ $0.1$ $\\mathrm{hr}$, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ $\\mathrm{hr}$, $I_a=$ $10$ $\\mathrm{mm}$, $f_c=$ $0$ $\\mathrm{mm/hr}$, $R_1=$ $12$ $\\mathrm{mm/hr}$, $R_2=$ $24$ $\\mathrm{mm/hr})$.\n- Case $4$ (edge case: weak storm below constant loss threshold): $(T=$ $6$ $\\mathrm{hr}$, $\\Delta t=$ $0.1$ $\\mathrm{hr}$, $A=$ $50$ $\\mathrm{km^2}$, $n=$ $3$, $k=$ $1$ $\\mathrm{hr}$, $I_a=$ $0$ $\\mathrm{mm}$, $f_c=$ $8$ $\\mathrm{mm/hr}$, $R_1=$ $6$ $\\mathrm{mm/hr}$, $R_2=$ $12$ $\\mathrm{mm/hr})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[$result1,result2,result3,result4$]$). Each result must be the relative $L^2$ deviation $\\mathcal{E}$ for the corresponding case, expressed as a decimal number (unitless).",
            "solution": "The problem provides a comprehensive framework for a numerical experiment in catchment hydrology, based on Unit Hydrograph Theory. The task is to quantify the nonlinearity introduced by common rainfall loss models. The problem statement is scientifically sound, well-posed, and objective. It is based on established principles of linear systems theory applied to hydrology, specifically the convolution of effective rainfall with a unit hydrograph to produce a direct runoff hydrograph. The models for rainfall, losses, and the unit hydrograph are standard and well-defined. All necessary parameters for the numerical simulation are provided. Therefore, the problem is valid, and a solution can be constructed.\n\nThe solution proceeds in the following steps for each test case:\n\n1.  **Discretize Time Domain**: A discrete time array, $t_i$, is established with a constant time step, $\\Delta t$. The total simulation duration, $T_{\\mathrm{end}}$, must be sufficiently long to capture the entire hydrograph response. Given the rainfall duration of $T=6$ hours and the unit hydrograph parameters ($n=3$, $k=1$ hr), a simulation time of $T_{\\mathrm{end}} = 50$ hours is chosen to ensure the hydrograph has fully receded.\n\n2.  **Generate Unit Hydrograph ($h(t)$)**: The Nash cascade model is used to generate the discrete unit hydrograph ordinates, $h_i = h(t_i)$. The formula is:\n    $$h(t) = \\frac{t^{n-1}\\,e^{-t/k}}{k^n\\,\\Gamma(n)}$$\n    where $n$ is the shape parameter, $k$ is the scale parameter (in hours), and $\\Gamma(n)$ is the gamma function. This hydrograph has units of $\\mathrm{hr}^{-1}$. The discrete version is evaluated at each time step $t_i$.\n\n3.  **Generate Effective Rainfall Hyetographs ($p_e(t)$)**: For each of the two storms (with rainfall intensities $R_1$ and $R_2$), the effective rainfall hyetograph is computed.\n    a. First, the total rainfall hyetograph, $p(t)$, is generated using the given triangular shape function $s(t)$ and intensity $R$: $p(t) = R\\,s(t)$, with units of $\\mathrm{mm/hr}$.\n    $$\n    s(t) = \n    \\begin{cases}\n    \\frac{4}{T^2}\\,t & \\text{for } 0 \\le t \\le \\frac{T}{2},\\\\\n    \\frac{4}{T^2}\\,(T - t) & \\text{for } \\frac{T}{2} < t \\le T,\\\\\n    0 & \\text{otherwise}.\n    \\end{cases}\n    $$\n    b. Next, the loss model is applied. The cumulative rainfall depth up to time $t$, $D(t) = \\int_0^t p(\\tau)d\\tau$, is computed numerically as a cumulative sum: $D_i = \\Delta t \\sum_{j=0}^{i} p_j$.\n    c. The effective rainfall rate, $p_e(t)$, is determined according to the rule: if $D(t) \\le I_a$, then $p_e(t)=0$; otherwise, $p_e(t) = \\max\\{0, p(t) - f_c\\}$. Here, $I_a$ is the initial abstraction (in $\\mathrm{mm}$) and $f_c$ is the constant loss rate (in $\\mathrm{mm/hr}$). This rule introduces nonlinearity. If $I_a=0$ and $f_c=0$, then $p_e(t) = p(t)$, and the effective rainfall generation is a linear scaling of $R$.\n\n4.  **Compute Discharge Hydrographs ($Q(t)$)**: The direct runoff hydrograph, in terms of depth rate ($\\mathrm{mm/hr}$), is the convolution of the effective rainfall $p_e(t)$ and the unit hydrograph $h(t)$:\n    $$Q_{\\text{depth}}(t) = \\int_0^t p_e(\\tau) h(t-\\tau) d\\tau$$\n    This is approximated by the discrete convolution sum: $(Q_{\\text{depth}})_i = \\Delta t \\sum_{j=0}^i (p_e)_j h_{i-j}$. Numerically, this corresponds to `np.convolve(pe, h) * dt`. The resulting time series in $\\mathrm{mm/hr}$ is then converted to volumetric flow rate $Q(t)$ in $\\mathrm{m^3/s}$ using the catchment area $A$ (in $\\mathrm{km^2}$) and conversion factors:\n    $$Q[\\mathrm{m^3/s}] = Q_{\\text{depth}}[\\mathrm{mm/hr}] \\times A[\\mathrm{km^2}] \\times \\frac{1000}{3600}$$\n    This procedure yields the two hydrographs, $Q_1(t)$ and $Q_2(t)$, for the two storms.\n\n5.  **Quantify Nonlinearity ($\\mathcal{E}$)**: The deviation from linearity is measured by the relative $L^2$ norm of the difference between the second storm's hydrograph, $Q_2(t)$, and a linearly scaled version of the first, $c\\,Q_1(t)$, where $c = R_2/R_1$.\n    The discrete approximation for the $L^2$ norm is given as $\\left\\|X\\right\\|_{L^2} \\approx \\left(\\sum_i X_i^2\\,\\Delta t_s\\right)^{1/2}$, where $\\Delta t_s = \\Delta t \\times 3600$ is the time step in seconds.\n    The deviation metric $\\mathcal{E}$ is calculated as:\n    $$\\mathcal{E} = \\frac{\\left\\|Q_2 - c\\,Q_1\\right\\|_{L^2}}{\\max\\left(\\left\\|c\\,Q_1\\right\\|_{L^2},\\,\\varepsilon\\right)}$$\n    The small constant $\\varepsilon = 10^{-12}$ prevents division by zero. A value of $\\mathcal{E} \\approx 0$ indicates linear behavior, while $\\mathcal{E} > 0$ indicates a quantifiable degree of nonlinearity introduced by the loss model.\n\nThis entire procedure is implemented for each of the four provided test cases to calculate their respective deviation metrics.",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import gamma\n\ndef calculate_hydrograph(R, T, dt, A, Ia, fc, t_arr, h_arr):\n    \"\"\"\n    Calculates the discharge hydrograph for a given storm and catchment properties.\n\n    Args:\n        R (float): Storm intensity (mm/hr).\n        T (float): Storm duration for the triangular shape (hr).\n        dt (float): Time step (hr).\n        A (float): Catchment area (km^2).\n        Ia (float): Initial abstraction (mm).\n        fc (float): Constant loss rate (mm/hr).\n        t_arr (np.ndarray): Time array (hr).\n        h_arr (np.ndarray): Unit hydrograph ordinates (1/hr).\n\n    Returns:\n        np.ndarray: Discharge hydrograph Q(t) in m^3/s.\n    \"\"\"\n    # 1. Rainfall hyetograph shape function s(t)\n    s = np.zeros_like(t_arr)\n    mask1 = (t_arr >= 0)  (t_arr = T / 2.0)\n    s[mask1] = (4.0 / T**2) * t_arr[mask1]\n    mask2 = (t_arr > T / 2.0)  (t_arr = T)\n    s[mask2] = (4.0 / T**2) * (T - t_arr[mask2])\n\n    # 2. Total rainfall hyetograph p(t)\n    p = R * s\n\n    # 3. Effective rainfall hyetograph pe(t)\n    pe = np.zeros_like(p)\n    # Avoid computation if rainfall is zero.\n    if R > 0:\n        # Cumulative rainfall depth D(t)\n        D = np.cumsum(p) * dt\n        \n        # Apply loss model based on the problem statement\n        ia_satisfied_mask = D > Ia\n        p_potential = np.maximum(0, p - fc)\n        pe[ia_satisfied_mask] = p_potential[ia_satisfied_mask]\n\n    # 4. Convolution to get runoff depth rate\n    # The result of `convolve` has length len(pe) + len(h_arr) - 1.\n    # We truncate to the simulation time length.\n    q_depth_rate = np.convolve(pe, h_arr, mode='full')[:len(t_arr)] * dt\n\n    # 5. Unit conversion to m^3/s\n    # Conversion: A [km^2] * 10^6 [m^2/km^2] * q [mm/hr] * 10^-3 [m/mm] / 3600 [s/hr]\n    conversion_factor = (A * 1000.0) / 3600.0\n    Q_m3s = q_depth_rate * conversion_factor\n    \n    return Q_m3s\n\ndef compute_deviation(case):\n    \"\"\"\n    Computes the linearity deviation metric for a single test case.\n    \n    Args:\n        case (tuple): A tuple containing all parameters for the test case.\n        \n    Returns:\n        float: The relative L2 deviation metric E.\n    \"\"\"\n    T, dt, A, n, k, Ia, fc, R1, R2 = case\n    epsilon = 1e-12\n    dt_s = dt * 3600.0\n    \n    # Use a simulation time long enough to capture the full hydrograph response\n    t_end = 50.0 \n    t_arr = np.arange(0, t_end, dt)\n\n    # Generate Unit Hydrograph h(t) using the Nash cascade model\n    h_arr = np.zeros_like(t_arr)\n    if k > 0:\n        # For t > 0\n        idx_pos = t_arr > 0\n        t_pos = t_arr[idx_pos]\n        # Using np.power for safe exponentiation\n        h_arr[idx_pos] = (np.power(t_pos, n - 1) * np.exp(-t_pos / k)) / (np.power(k, n) * gamma(n))\n        \n        # Handle t = 0 explicitly for robustness\n        if t_arr[0] == 0:\n            if n == 1:\n                h_arr[0] = 1.0 / k\n            # else h_arr[0] remains 0, which is correct for n > 1\n\n    # Calculate discharge hydrographs for both storms\n    Q1 = calculate_hydrograph(R1, T, dt, A, Ia, fc, t_arr, h_arr)\n    Q2 = calculate_hydrograph(R2, T, dt, A, Ia, fc, t_arr, h_arr)\n    \n    # Calculate the linearity test metric\n    c = R2 / R1 if R1 != 0 else 0.0\n    \n    cQ1 = c * Q1\n    diff_Q = Q2 - cQ1\n\n    # Calculate L2 norms\n    norm_diff = np.sqrt(np.sum(diff_Q**2) * dt_s)\n    norm_cQ1 = np.sqrt(np.sum(cQ1**2) * dt_s)\n    \n    # Calculate the relative deviation E\n    E = norm_diff / max(norm_cQ1, epsilon)\n    \n    return E\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    # Test cases defined as (T, dt, A, n, k, Ia, fc, R1, R2)\n    test_cases = [\n        # Case 1 (happy path, perfectly linear system since losses are zero)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 0.0, 10.0, 25.0),\n        # Case 2 (nonlinearity due to constant loss)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 5.0, 10.0, 25.0),\n        # Case 3 (nonlinearity due to initial abstraction)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 10.0, 0.0, 12.0, 24.0),\n        # Case 4 (edge case: weak storm below constant loss threshold)\n        (6.0, 0.1, 50.0, 3.0, 1.0, 0.0, 8.0, 6.0, 12.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        E = compute_deviation(case)\n        results.append(E)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A successful model calibration often yields a runoff hydrograph that closely matches observations, but does this imply the model structure itself is uniquely correct? This practice () delves into the advanced concept of equifinality, a fundamental challenge in environmental modeling. You will demonstrate that two structurally distinct unit hydrographs can generate remarkably similar outputs for certain inputs, highlighting the inherent ambiguity in model identification and the critical importance of considering model uncertainty.",
            "id": "3928742",
            "problem": "Consider a linear time-invariant (LTI) catchment model under Unit Hydrograph Theory, where the Discrete Unit Hydrograph (DUH) $U_{D}[k]$ describes the fraction of a unit depth of effective rainfall that contributes to direct runoff discharge during the $k$-th discrete time interval. Let the time step be $\\Delta t = 1$ hour, the DUH length be $K = 48$ steps, and the catchment area be $A = 200 \\times 10^{6}$ square meters. Assume that the effective rainfall hyetograph $P_{e}[n]$ is given in millimeters per hour and is already net of losses. The direct runoff discharge $Q[n]$ in cubic meters per second is obtained from the discrete convolution of $P_{e}[n]$ with $U_{D}[k]$ as follows:\n$$\nQ[n] = \\frac{A}{3600 \\times 1000} \\sum_{k=0}^{K-1} U_{D}[k] \\cdot P_{e}[n-k],\n$$\nwhere $P_{e}[m] = 0$ for $m  0$ and for $m$ beyond the length of the hyetograph.\n\nYour task is to demonstrate equifinality by constructing two distinct DUH shapes $U_{D,1}[k]$ and $U_{D,2}[k]$ that yield similar discharge responses $Q_{1}[n]$ and $Q_{2}[n]$ for a given set of storms. Both $U_{D,1}[k]$ and $U_{D,2}[k]$ must satisfy $\\sum_{k=0}^{K-1} U_{D,i}[k] = 1$, must be nonnegative, and must be defined on the support $k = 1,2,\\dots,K$ by sampling continuous-time kernels at integer hours and renormalizing. Construct:\n- A unimodal $U_{D,1}[k]$ using a Gamma kernel with shape $k_{1} = 4$ and scale $\\theta_{1} = 1.5$ hours,\n- A bimodal $U_{D,2}[k]$ as an equal-weight mixture of two Gamma kernels with means $m_{1} = 4$ hours and $m_{2} = 8$ hours, and variances $v_{1} = 5$ hours$^{2}$ and $v_{2} = 5$ hours$^{2}$. For each component, choose shape $k_{i} = \\frac{m_{i}^{2}}{v_{i}}$ and scale $\\theta_{i} = \\frac{v_{i}}{m_{i}}$, and then mix them with equal weights before renormalizing on the discrete support.\n\nUse the following test suite of effective rainfall hyetographs $P_{e}[n]$ with length $L = 48$ hours:\n- Storm $S_{1}$ (block rainfall): $P_{e}[n] = 10$ for $n \\in \\{5,6,\\dots,16\\}$ and $P_{e}[n] = 0$ otherwise.\n- Storm $S_{2}$ (triangular long event): $P_{e}[n]$ increases linearly from $0$ at $n = 8$ to $5$ at $n = 20$, and then decreases linearly to $0$ at $n = 32$; $P_{e}[n] = 0$ otherwise.\n- Storm $S_{3}$ (two pulses): $P_{e}[n] = 8$ for $n \\in \\{3,4,5,6,7\\}$ and $P_{e}[n] = 6$ for $n \\in \\{20,21,22,23,24,25\\}$; $P_{e}[n] = 0$ otherwise.\n- Storm $S_{4}$ (impulse-like): $P_{e}[n] = 25$ for $n = 12$ and $P_{e}[n] = 0$ otherwise.\n- Storm $S_{5}$ (zero rainfall boundary case): $P_{e}[n] = 0$ for all $n$.\n\nFor each storm $S_{j}$, compute the two discharge responses $Q_{1,j}[n]$ and $Q_{2,j}[n]$ in cubic meters per second. Then compute the Normalized Root Mean Square Error (RMSE) between the two responses as\n$$\n\\mathrm{NRMSE}(S_{j}) = \\frac{\\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} \\left(Q_{1,j}[n] - Q_{2,j}[n]\\right)^{2}}}{\\max\\left(\\max_{n} Q_{1,j}[n],\\ \\max_{n} Q_{2,j}[n],\\ \\varepsilon\\right)},\n$$\nwhere $N$ is the length of the full discrete convolution output and $\\varepsilon = 10^{-12}$ is a small constant to handle the case of identically zero discharges. Express all discharges in cubic meters per second, and express the final normalized errors as dimensionless floats.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\mathrm{NRMSE}(S_{1}), \\mathrm{NRMSE}(S_{2}), \\mathrm{NRMSE}(S_{3}), \\mathrm{NRMSE}(S_{4}), \\mathrm{NRMSE}(S_{5})]$.\n\nEnsure scientific realism by strictly enforcing nonnegativity of $U_{D,i}[k]$ and normalization to unit area on the discrete support, and by using the given physical units. The final floats should be rounded to six decimal places in the output line. In addition to computing the numerical values, the problem requires that the constructed $U_{D,1}[k]$ and $U_{D,2}[k]$ be distinct in shape while yielding similar $Q[n]$ for at least the multi-hour storms $S_{1}$, $S_{2}$, and $S_{3}$; the impulse-like $S_{4}$ and the boundary case $S_{5}$ serve as edge-case tests of sensitivity and correctness.",
            "solution": "The problem is valid as it is scientifically grounded in established hydrological principles, is well-posed with all necessary information provided, and is objectively formulated. The task is to demonstrate the concept of equifinality in a linear catchment model by constructing two structurally different Unit Hydrographs that produce similar runoff responses for certain rainfall events.\n\nThe core of the problem lies in the discrete convolution model for direct runoff, a fundamental component of Unit Hydrograph Theory. The direct runoff discharge, $Q[n]$, is modeled as the output of a Linear Time-Invariant (LTI) system, where the effective rainfall hyetograph $P_e[n]$ is the input signal and the Discrete Unit Hydrograph (DUH) $U_D[k]$ is the system's impulse response.\n\nThe governing equation for discharge, once converted to the correct units, is effectively:\n$$\nQ[n] = C \\cdot \\sum_{k=0}^{K-1} U_{D}[k] \\cdot P_{e}[n-k]\n$$\nThis is a discrete convolution operation, often denoted as $Q[n] = C \\cdot (U_D * P_e)[n]$. The constant $C$ serves to convert the units of the convolution output (which are in mm/hr) to the desired discharge units of cubic meters per second (m$^3$/s). Given a catchment area $A = 200 \\times 10^6$ m$^2$, a time step $\\Delta t = 1$ hr, and the need to convert rainfall from millimeters to meters, the constant $C$ is calculated as:\n$$\nC = \\frac{A \\text{ [m}^2\\text{]}}{1000 \\text{ [mm/m]} \\cdot \\Delta t \\text{ [hr]} \\cdot 3600 \\text{ [s/hr]}} = \\frac{200 \\times 10^6}{1000 \\cdot 1 \\cdot 3600} = \\frac{200 \\times 10^6}{3.6 \\times 10^6} = \\frac{500}{9} \\ \\frac{\\text{m}^3/\\text{s}}{\\text{mm/hr}}\n$$\n\nThe procedure involves the following steps:\n1.  Construction of two distinct Discrete Unit Hydrographs, $U_{D,1}[k]$ and $U_{D,2}[k]$.\n2.  Generation of runoff hydrographs $Q_1[n]$ and $Q_2[n]$ for a suite of five different rainfall storms.\n3.  Evaluation of the similarity between $Q_1[n]$ and $Q_2[n]$ for each storm using the Normalized Root Mean Square Error (NRMSE).\n\n**Step 1: Construction of Discrete Unit Hydrographs**\n\nBoth DUHs are of length $K=48$ and are derived by sampling continuous-time kernels at integer hours $t \\in \\{1, 2, \\dots, K\\}$ and subsequently normalizing the discrete sequence to ensure $\\sum_{k=0}^{K-1} U_D[k] = 1$. The sampling at $t_k = k+1$ for $k=0, \\dots, K-1$ aligns the indices of the DUH array with the standard $0$-indexed convolution sum, while respecting that the underlying Gamma probability density function (PDF) is defined for $t0$. The Gamma PDF is given by $f(t; \\alpha, \\theta) = \\frac{t^{\\alpha-1} e^{-t/\\theta}}{\\theta^\\alpha \\Gamma(\\alpha)}$, where $\\alpha$ is the shape parameter and $\\theta$ is the scale parameter.\n\n- **Unimodal DUH, $U_{D,1}[k]$**: This DUH is based on a single Gamma distribution with shape parameter $k_1 = 4$ and scale parameter $\\theta_1 = 1.5$ hours.\nThe raw, un-normalized values $u_{1,raw}[k]$ are first computed by sampling the PDF:\n$$\nu_{1,raw}[k] = f(t=k+1; k_1=4, \\theta_1=1.5) \\quad \\text{for } k = 0, 1, \\dots, 47\n$$\nThese values are then normalized to create the final DUH:\n$$\nU_{D,1}[k] = \\frac{u_{1,raw}[k]}{\\sum_{j=0}^{K-1} u_{1,raw}[j]}\n$$\n\n- **Bimodal DUH, $U_{D,2}[k]$**: This DUH is constructed as an equal-weight mixture of two Gamma distributions. The parameters for each component are derived from the specified mean ($m$) and variance ($v$) using the relations $\\alpha = m^2/v$ and $\\theta = v/m$.\n\n  - **Component 1**: $m_1 = 4$ hr, $v_1 = 5$ hr$^2$.\n    - Shape: $\\alpha_{2,1} = m_1^2 / v_1 = 4^2 / 5 = 3.2$.\n    - Scale: $\\theta_{2,1} = v_1 / m_1 = 5 / 4 = 1.25$ hr.\n\n  - **Component 2**: $m_2 = 8$ hr, $v_2 = 5$ hr$^2$.\n    - Shape: $\\alpha_{2,2} = m_2^2 / v_2 = 8^2 / 5 = 12.8$.\n    - Scale: $\\theta_{2,2} = v_2 / m_2 = 5 / 8 = 0.625$ hr.\n\nThe raw, un-normalized values $u_{2,raw}[k]$ are an equal-weight sum of the two component PDFs sampled at $t=k+1$:\n$$\nu_{2,raw}[k] = 0.5 \\cdot f(t=k+1; \\alpha_{2,1}, \\theta_{2,1}) + 0.5 \\cdot f(t=k+1; \\alpha_{2,2}, \\theta_{2,2})\n$$\nThese values are then normalized to create the final DUH:\n$$\nU_{D,2}[k] = \\frac{u_{2,raw}[k]}{\\sum_{j=0}^{K-1} u_{2,raw}[j]}\n$$\n\n**Step 2: Generation of Runoff Hydrographs**\n\nFor each of the five specified storm hyetographs $P_{e,j}[n]$ (of length $L=48$), two direct runoff hydrographs, $Q_{1,j}[n]$ and $Q_{2,j}[n]$, are computed. The length of the resulting hydrographs will be $N = L+K-1 = 48+48-1 = 95$.\n$$\nQ_{1,j}[n] = C \\cdot (U_{D,1} * P_{e,j})[n]\n$$\n$$\nQ_{2,j}[n] = C \\cdot (U_{D,2} * P_{e,j})[n]\n$$\nThe convolution is performed numerically.\n\n**Step 3: Quantification of Response Similarity**\n\nThe difference between the two runoff hydrographs for each storm $S_j$ is quantified using the Normalized Root Mean Square Error (NRMSE):\n$$\n\\mathrm{NRMSE}(S_{j}) = \\frac{\\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} \\left(Q_{1,j}[n] - Q_{2,j}[n]\\right)^{2}}}{\\max\\left(\\max_{n} Q_{1,j}[n],\\ \\max_{n} Q_{2,j}[n],\\ \\varepsilon\\right)}\n$$\nwhere $N=95$ is the length of the hydrographs and $\\varepsilon = 10^{-12}$ is a small constant to prevent division by zero, particularly relevant for the zero-rainfall case ($S_5$). This metric provides a dimensionless measure of the average discrepancy between the two hydrographs, scaled by the peak flow. Lower values of NRMSE indicate stronger similarity, demonstrating the principle of equifinality. The different storm structures are expected to test the model responses' sensitivity: smoother, longer-duration storms ($S_1, S_2, S_3$) are expected to yield lower NRMSE values than the sharp, impulse-like storm ($S_4$), as the convolution operation has a smoothing effect that can mask differences in the DUHs.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import gamma\n\ndef solve():\n    \"\"\"\n    Solves the unit hydrograph equifinality problem.\n    \"\"\"\n    # Define physical and model constants from the problem statement\n    A = 200.0e6  # Catchment area in square meters\n    DELTA_T = 1.0  # Time step in hours\n    K = 48  # DUH length in steps\n    L = 48  # Rainfall hyetograph length in steps\n    EPSILON = 1e-12 # Small constant for NRMSE calculation\n\n    # Conversion constant from (mm/hr) to (m^3/s)\n    # C = A[m^2] / (1000[mm/m] * DELTA_T[hr] * 3600[s/hr])\n    C = A / (1000.0 * 3600.0 * DELTA_T)\n\n    # Time points for sampling the continuous kernels (t = 1, 2, ..., K)\n    t_sampling = np.arange(1, K + 1)\n\n    # --- Construct Unimodal DUH (U_D,1) ---\n    k1, theta1 = 4.0, 1.5\n    u1_raw = gamma.pdf(t_sampling, a=k1, scale=theta1)\n    u1_normalized = u1_raw / np.sum(u1_raw)\n\n    # --- Construct Bimodal DUH (U_D,2) ---\n    # Component 1\n    m1, v1 = 4.0, 5.0\n    k2_1, theta2_1 = m1**2 / v1, v1 / m1\n    # Component 2\n    m2, v2 = 8.0, 5.0\n    k2_2, theta2_2 = m2**2 / v2, v2 / m2\n\n    u2_comp1_raw = gamma.pdf(t_sampling, a=k2_1, scale=theta2_1)\n    u2_comp2_raw = gamma.pdf(t_sampling, a=k2_2, scale=theta2_2)\n\n    # Equal-weight mixture\n    u2_raw = 0.5 * u2_comp1_raw + 0.5 * u2_comp2_raw\n    u2_normalized = u2_raw / np.sum(u2_raw)\n\n    # Store the two DUHs\n    duhs = [u1_normalized, u2_normalized]\n\n    # --- Define Test Suite of Storms ---\n    # The problem defines 5 storms\n    storm_definitions = [\n        {'type': 'block', 'params': {'start': 5, 'end': 16, 'val': 10.0}},\n        {'type': 'triangular', 'params': {'p1': (8, 0.0), 'p2': (20, 5.0), 'p3': (32, 0.0)}},\n        {'type': 'two_pulses', 'params': [\n            {'start': 3, 'end': 7, 'val': 8.0},\n            {'start': 20, 'end': 25, 'val': 6.0}\n        ]},\n        {'type': 'impulse', 'params': {'loc': 12, 'val': 25.0}},\n        {'type': 'zero', 'params': {}},\n    ]\n\n    results = []\n    for storm_def in storm_definitions:\n        # Generate the effective rainfall hyetograph P_e[n]\n        pe = np.zeros(L)\n        if storm_def['type'] == 'block':\n            p = storm_def['params']\n            pe[p['start']:p['end']+1] = p['val']\n        elif storm_def['type'] == 'triangular':\n            p = storm_def['params']\n            xp = np.array([p['p1'][0], p['p2'][0], p['p3'][0]])\n            fp = np.array([p['p1'][1], p['p2'][1], p['p3'][1]])\n            pe_indices = np.arange(L)\n            pe = np.interp(pe_indices, xp, fp)\n            pe[pe  0] = 0 # Ensure non-negativity from interpolation\n        elif storm_def['type'] == 'two_pulses':\n            for pulse in storm_def['params']:\n                pe[pulse['start']:pulse['end']+1] = pulse['val']\n        elif storm_def['type'] == 'impulse':\n            p = storm_def['params']\n            pe[p['loc']] = p['val']\n        elif storm_def['type'] == 'zero':\n            pass # pe is already all zeros\n\n        # Compute discharge hydrographs Q1 and Q2\n        q1 = C * np.convolve(u1_normalized, pe)\n        q2 = C * np.convolve(u2_normalized, pe)\n\n        # Compute Normalized Root Mean Square Error (NRMSE)\n        diff_sq = (q1 - q2)**2\n        mse = np.mean(diff_sq)\n        rmse = np.sqrt(mse)\n        \n        q_max = np.max([np.max(q1), np.max(q2), EPSILON])\n        \n        nrmse = rmse / q_max\n        results.append(nrmse)\n\n    # Format the output as specified\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```"
        }
    ]
}