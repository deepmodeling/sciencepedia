{
    "hands_on_practices": [
        {
            "introduction": "在积雪融化之前，其内部温度必须首先升高至 $0\\,^{\\circ}\\mathrm{C}$。本练习引入了“冷含量”这一概念，它量化了将零度以下的积雪加热至熔点所需的能量。通过将能量守恒原理应用于一个夜间的控制体积，您将学会计算积雪热力学状态的演变，这是预测融雪时间的根本步骤。",
            "id": "3913260",
            "problem": "在晴空条件下，对一个高海拔高山草甸的隆冬干雪层进行整夜监测。将雪堆视为一个从雪面延伸至雪-土界面的控制体，其中不存在液态水且无降水。采用符号约定，所有指向雪堆内部的地表通量均为正值。以下半小时涡动相关诊断表明，夜间通量是平稳的；因此，整个夜间的平均通量可视为常数：\n- 净辐射 ($R_{n}$)：$-80\\ \\mathrm{W\\,m^{-2}}$，\n- 感热通量 ($H$)：$+70\\ \\mathrm{W\\,m^{-2}}$，\n- 潜热通量 ($LE$)：$+20\\ \\mathrm{W\\,m^{-2}}$（正值表示凝结到雪面上），\n- 地热通量 ($G$)：$+10\\ \\mathrm{W\\,m^{-2}}$（从土壤向上传导至雪中）。\n\n假设夜晚从当地时间 20:00 持续到 08:00。初始雪层在空间上是均匀的，深度 $h = 0.60\\ \\mathrm{m}$，堆积密度 $\\rho = 300\\ \\mathrm{kg\\,m^{-3}}$，在 20:00 时的均匀温度为 $T_i = -8\\,^{\\circ}\\mathrm{C}$。忽略整个夜间雪层内部的任何垂直温度梯度（即，将雪温视为空间均匀），并通过取恒定值 $c_{i} = 2100\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 来忽略冰的比热对温度的依赖性。忽略任何融化；如果雪堆变为 $0\\,^{\\circ}\\mathrm{C}$ 的等温状态，假设任何额外的能量都将用于相变，但夜间没有再冻结或水分滞留。\n\n从雪堆控制体的能量守恒和冷含量的定义（即相对于 $0\\,^{\\circ}\\mathrm{C}$ 等温雪堆的能量亏损）出发，推导联系时间积分的净能量输入与夜间冷含量变化的控制关系式。然后计算 08:00 时的剩余冷含量。\n\n为本题目的，将单位面积的冷含量定义为\n$$\nCC \\equiv -\\int_{0}^{h} \\rho\\, c_{i}\\, T(z)\\, dz,\n$$\n其中 T 是以摄氏度为单位的温度（因此冰点以下的温度 $T0$ 会得到 $CC > 0$）。使用给定的数据和假设，评估 08:00 时的剩余冷含量。\n\n将你的最终答案表示为一个等于 08:00 时剩余冷含量的单一数值，单位为 $\\mathrm{MJ\\,m^{-2}}$。将你的答案四舍五入到四位有效数字。在你的推理中，说明雪堆是否在早晨达到 $0\\,^{\\circ}\\mathrm{C}$ 的等温状态，但最终答案只报告所要求的数值。",
            "solution": "首先将热力学第一定律（即能量守恒原理）应用于被视为控制体的雪堆。雪堆单位面积内能的变化率 $\\frac{dU}{dt}$ 等于进入雪堆的单位面积净能量通量 $Q_{net}$。\n$$ \\frac{dU}{dt} = Q_{net} $$\n净能量通量是控制体边界上各个通量的总和：净辐射 ($R_n$)、感热通量 ($H$)、潜热通量 ($LE$) 和地热通量 ($G$)。\n$$ Q_{net} = R_n + H + LE + G $$\n使用给定的值：\n$$ Q_{net} = (-80) + (+70) + (+20) + (+10)\\ \\mathrm{W\\,m^{-2}} = 20\\ \\mathrm{W\\,m^{-2}} $$\n由于 $Q_{net}$ 为正，雪堆有净能量增益。问题说明通量是平稳的，所以 $Q_{net}$ 不随时间变化。\n\n问题将单位面积冷含量 $CC$ 定义为\n$$ CC \\equiv -\\int_{0}^{h} \\rho\\, c_{i}\\, T(z)\\, dz $$\n其中 $T(z)$ 是以摄氏度（或相对于冰点的开尔文温差）为单位的温度。单位面积的内能 $U$，相对于 $0\\,^{\\circ}\\mathrm{C}$ 冰的参考状态，定义为\n$$ U \\equiv \\int_{0}^{h} \\rho\\, c_{i}\\, T(z)\\, dz $$\n从这些定义可以清楚地看出 $U = -CC$。将此关系代入能量守恒方程，得到冷含量的控制关系式：\n$$ \\frac{d(-CC)}{dt} = Q_{net} \\implies \\frac{d(CC)}{dt} = -Q_{net} $$\n为求得夜间持续时间内冷含量的总变化，我们对该方程从初始时间 $t_i$ (20:00) 到最终时间 $t_f$ (08:00) 进行时间积分。持续时间为 $\\Delta t = t_f - t_i = 12\\ \\mathrm{小时}$。\n$$ \\int_{CC_i}^{CC_f} d(CC) = \\int_{t_i}^{t_f} (-Q_{net})\\, dt $$\n由于 $Q_{net}$ 是常数，积分得出：\n$$ CC_f - CC_i = -Q_{net} \\Delta t $$\n其中 $CC_i$ 和 $CC_f$ 分别是初始和最终冷含量。因此，最终冷含量为：\n$$ CC_f = CC_i - Q_{net} \\Delta t $$\n该方程就是推导出的，联系冷含量变化与时间积分净能量输入的控制关系式。\n\n接下来，我们计算此方程中的各项。\n初始冷含量 $CC_i$ 是根据雪堆的初始状态计算的。温度均匀 ($T_i = -8\\,^{\\circ}\\mathrm{C}$) 和密度均匀 ($\\rho = 300\\ \\mathrm{kg\\,m^{-3}}$) 的假设简化了 $CC$ 的积分定义：\n$$ CC_i = -\\rho\\, c_i\\, T_i\\, h $$\n乘积 $\\rho h$ 是单位面积的雪质量 $m_s$：\n$$ m_s = \\rho h = (300\\ \\mathrm{kg\\,m^{-3}}) \\times (0.60\\ \\mathrm{m}) = 180\\ \\mathrm{kg\\,m^{-2}} $$\n已知冰的比热 $c_i = 2100\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，初始冷含量为：\n$$ CC_i = -(180\\ \\mathrm{kg\\,m^{-2}}) \\times (2100\\ \\mathrm{J\\,kg^{-1}\\,K^{-1}}) \\times (-8\\ \\mathrm{K}) = 3,024,000\\ \\mathrm{J\\,m^{-2}} $$\n注意，$-8\\,^{\\circ}\\mathrm{C}$ 的温度相当于相对于 $0\\,^{\\circ}\\mathrm{C}$ 的 $8\\ \\mathrm{K}$ 的温度亏损。\n以要求的单位 $\\mathrm{MJ\\,m^{-2}}$ 表示，$CC_i = 3.024\\ \\mathrm{MJ\\,m^{-2}}$。这是将雪堆加热到 $0\\,^{\\circ}\\mathrm{C}$ 所需的能量。\n\n夜间的总能量输入是净通量 $Q_{net}$ 和时间间隔 $\\Delta t$ 的乘积。\n$$ \\Delta t = 12\\ \\mathrm{h} \\times 3600\\ \\mathrm{s\\,h^{-1}} = 43,200\\ \\mathrm{s} $$\n总能量输入为：\n$$ Q_{net} \\Delta t = (20\\ \\mathrm{J\\,s^{-1}\\,m^{-2}}) \\times (43,200\\ \\mathrm{s}) = 864,000\\ \\mathrm{J\\,m^{-2}} = 0.864\\ \\mathrm{MJ\\,m^{-2}} $$\n添加到雪堆的能量 $0.864\\ \\mathrm{MJ\\,m^{-2}}$ 小于初始冷含量 $3.024\\ \\mathrm{MJ\\,m^{-2}}$。因此，到早晨时雪堆不会升温到 $0\\,^{\\circ}\\mathrm{C}$，无融化假设是有效的。\n\n在 08:00 时的剩余冷含量 $CC_f$ 计算如下：\n$$ CC_f = CC_i - Q_{net} \\Delta t = 3.024\\ \\mathrm{MJ\\,m^{-2}} - 0.864\\ \\mathrm{MJ\\,m^{-2}} = 2.160\\ \\mathrm{MJ\\,m^{-2}} $$\n最终答案要求以 $\\mathrm{MJ\\,m^{-2}}$ 为单位，并四舍五入到四位有效数字。计算值 $2.160$ 满足这些要求。",
            "answer": "$$\\boxed{2.160}$$"
        },
        {
            "introduction": "当积雪整体处于熔点温度时，所有净能量输入都将用于相变过程。本练习要求您通过综合各项关键的地表能量平衡分量，将热力学第一定律应用于正在融化的积雪。掌握这项计算对于量化融雪产水量至关重要，而融雪产水量是水文模型中的一个关键输出变量。",
            "id": "3913283",
            "problem": "在一个中纬度高山地区，观测了一个积雪控制体在当地时间 $13{:}00$ 到 $14{:}00$ 的一小时区间内的变化。假设积雪层是 $0\\,^{\\circ}\\mathrm{C}$ 的等温层，因此在这一个小时内的所有净能量输入都可用于产生融雪，并忽略除融化外的任何其他内部能量储存变化。使用应用于控制体的热力学第一定律来构建积雪表层的能量守恒框架。采用以下符号约定：当能量通量指向并进入积雪时为正。在此约定下，净辐射 $R_{n}$ 向下时为正；感热通量 $H$ 和潜热通量 $LE$ 向下时为正；地热（土壤到雪）通量 $G$ 向上进入积雪时为正；降雨平流热 $P$ 在降雨向积雪输送热量时为正。该小时的剩余融雪能量 $M$ 是该小时内输入积雪的时间积分净能量。\n\n该小时的仪器测量得出以下最佳估计值和单标准差不确定性（Standard Deviation (SD)），其中通量以该小时内的时间平均值报告：\n- 净辐射 $R_{n} = 142 \\pm 10\\ \\mathrm{W\\,m^{-2}}$。\n- 感热通量 $H = -18 \\pm 12\\ \\mathrm{W\\,m^{-2}}$。\n- 潜热通量 $LE = -36 \\pm 15\\ \\mathrm{W\\,m^{-2}}$。\n- 地热通量 $G = +12 \\pm 3\\ \\mathrm{W\\,m^{-2}}$。\n- 该小时的降雨平流热 $P_{\\text{hour}} = 0.112 \\pm 0.015\\ \\mathrm{MJ\\,m^{-2}}$。\n\n将所有不确定性视为在该小时内是独立的、高斯的和时间平稳的。使用一致的符号约定和单位转换，从第一性原理推导出一小时区间的剩余融雪能量 $M$ 的表达式，并计算其最佳估计值。以兆焦耳每平方米（MJ m$^{-2}$）表示最终能量。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题要求根据能量守恒原理，计算一小时内可用于融雪的总能量 $M$。$M$ 是所有能量输入项的总和。能量输入包括时间积分的地表能量通量（净辐射 $R_n$、感热通量 $H$、潜热通量 $LE$、地热通量 $G$）和降雨平流热 $P_{\\text{hour}}$。\n\n首先，推导 $M$ 的表达式。由于积雪在 $0\\,^{\\circ}\\mathrm{C}$ 下是等温的，所有净能量都用于融化。总融雪能量 $M$ 是各分量之和：\n$$\nM = \\left( \\int_{0}^{\\Delta t} (R_n + H + LE + G) \\, dt \\right) + P_{\\text{hour}}\n$$\n因为通量被报告为时间平均值，积分简化为与时间间隔 $\\Delta t = 1\\,\\mathrm{hour} = 3600\\,\\mathrm{s}$ 的乘积：\n$$\nM = (R_n + H + LE + G) \\cdot \\Delta t + P_{\\text{hour}}\n$$\n接下来，计算最佳估计值。\n1.  **计算净地表通量 $Q_{\\text{surf}}$：**\n    $$\n    Q_{\\text{surf}} = R_n + H + LE + G = 142 + (-18) + (-36) + 12 = 100\\,\\mathrm{W\\,m^{-2}}\n    $$\n    这是一个净能量输入。\n\n2.  **将通量转换为能量：**\n    在一小时内，来自地表通量的总能量 $E_{\\text{surf}}$ 为：\n    $$\n    E_{\\text{surf}} = Q_{\\text{surf}} \\cdot \\Delta t = (100\\,\\mathrm{J\\,s^{-1}\\,m^{-2}}) \\times (3600\\,\\mathrm{s}) = 360,000\\,\\mathrm{J\\,m^{-2}}\n    $$\n\n3.  **单位换算：**\n    将 $E_{\\text{surf}}$ 转换为兆焦耳每平方米 ($\\mathrm{MJ\\,m^{-2}}$)：\n    $$\n    E_{\\text{surf}} = 360,000\\,\\mathrm{J\\,m^{-2}} \\times \\frac{1\\,\\mathrm{MJ}}{10^6\\,\\mathrm{J}} = 0.36\\,\\mathrm{MJ\\,m^{-2}}\n    $$\n\n4.  **计算总融雪能量 $M$：**\n    将地表通量能量与已知的降雨平流热 $P_{\\text{hour}} = 0.112\\,\\mathrm{MJ\\,m^{-2}}$ 相加：\n    $$\n    M = E_{\\text{surf}} + P_{\\text{hour}} = 0.36\\,\\mathrm{MJ\\,m^{-2}} + 0.112\\,\\mathrm{MJ\\,m^{-2}} = 0.472\\,\\mathrm{MJ\\,m^{-2}}\n    $$\n\n5.  **格式化最终答案：**\n    问题要求答案保留四位有效数字。因此，最终答案为 $0.4720\\,\\mathrm{MJ\\,m^{-2}}$。",
            "answer": "$$\n\\boxed{0.4720}\n$$"
        },
        {
            "introduction": "本练习超越了简单的整体收支计算，通过模拟热传导过程深入探讨积雪的内部物理机制。您将建立一个数值模型来求解热方程，该方程描述了温度在积雪内部随时间和空间的变化。这项练习为您提供了计算建模的基础经验，并揭示了地表能量通量如何驱动积雪内部温度剖面的演变。",
            "id": "3913265",
            "problem": "考虑一个厚度为 $H$（单位：米）的一维垂直雪柱，其空间坐标 $z \\in [0, H]$ 从雪面 $z=0$ 向下测量。瞬态温度场 $T(z,t)$（单位：开尔文）在一个没有内部源且热物理性质恒定的连续介质中根据能量守恒演化。从内能的基本守恒定律出发，温度满足热传导方程\n$$\\rho c \\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial z}\\left(k \\frac{\\partial T}{\\partial z}\\right),$$\n其中 $\\rho$ 是雪密度（单位：千克/立方米），$c$ 是雪的比热容（单位：焦耳/千克/开尔文），$k$ 是雪的热导率（单位：瓦特/米/开尔文）。表面能量平衡作为时变的诺伊曼边界条件施加在雪面上，\n$$-k \\left.\\frac{\\partial T}{\\partial z}\\right|_{z=0} = q_{\\mathrm{surf}}(t),$$\n其中 $q_{\\mathrm{surf}}(t)$（单位：瓦特/平方米）是给定的日强迫，代表指向雪内的净表面热通量，向下为正。在雪底 $z=H$ 处，施加零热通量，\n$$-k \\left.\\frac{\\partial T}{\\partial z}\\right|_{z=H} = 0.$$\n初始温度是均匀的，$T(z,0) = T_{\\mathrm{init}}$。\n\n你必须从上述基本原理出发，推导出一个在均匀网格上数值稳定、时间上二阶精确的格式，以计算持续时间为 $P = 86400$ 秒（24小时）的完整日循环中的瞬态温度剖面。表面强迫由下式给出\n$$q_{\\mathrm{surf}}(t) = q_{\\mathrm{mean}} + q_{\\mathrm{amp}} \\sin\\left(\\frac{2\\pi t}{P}\\right),$$\n其中 $q_{\\mathrm{mean}}$ 和 $q_{\\mathrm{amp}}$ 是常数（单位：瓦特/平方米）。通过比较模型计算的24小时内雪柱积分内能的变化与同一时期内时间积分的给定表面热通量，来验证能量守恒。在时间 $t$ 时，单位水平面积上的雪柱积分内能为\n$$E(t) = \\int_0^H \\rho c T(z,t)\\,dz \\quad \\text{(单位：焦耳/平方米)}。$$\n假设底部通量为零，能量守恒要求\n$$E(P) - E(0) = \\int_0^P q_{\\mathrm{surf}}(t)\\,dt.$$\n在离散形式中，使用与数值格式相同的均匀网格上的梯形法则来近似空间积分，并使用与时间步进一致的梯形法则来近似时间积分。\n\n为以下测试套件实现你的数值格式，以计算瞬态温度剖面并验证能量守恒。对于每个测试用例，模拟24小时（$P = 86400$ 秒），并报告：\n- 最终表面温度 $T(z=0,t=P)$，单位为开尔文，四舍五入到三位小数，\n- 内能的净变化 $\\Delta E = E(P) - E(0)$，单位为焦耳/平方米，四舍五入到一位小数，\n- 时间积分的表面通量 $\\int_0^P q_{\\mathrm{surf}}(t)\\,dt$，单位为焦耳/平方米，四舍五入到一位小数，\n- 一个布尔值，当且仅当 $\\left|\\Delta E - \\int_0^P q_{\\mathrm{surf}}(t)\\,dt\\right| \\le \\varepsilon_{\\mathrm{abs}} + \\varepsilon_{\\mathrm{rel}} \\max\\left(\\left|\\Delta E\\right|,\\left|\\int_0^P q_{\\mathrm{surf}}(t)\\,dt\\right|\\right)$ 成立时为 $True$，其中 $\\varepsilon_{\\mathrm{abs}} = 1.0$ (焦耳/平方米) 和 $\\varepsilon_{\\mathrm{rel}} = 0.01$ (十进制)，否则为 $False$。\n\n测试套件参数集：\n- 用例 A (正常路径):\n  - $H = 0.5$ (米), $\\rho = 300$ (千克/立方米), $c = 2100$ (焦耳/千克/开尔文), $k = 0.2$ (瓦特/米/开尔文),\n  - $T_{\\mathrm{init}} = 263.15$ (开尔文),\n  - $q_{\\mathrm{mean}} = 10$ (瓦特/平方米), $q_{\\mathrm{amp}} = 150$ (瓦特/平方米),\n  - 空间网格点数 $M = 50$ (整数), 时间步长 $\\Delta t = 120$ (秒)。\n- 用例 B (零均值强迫下的边界行为):\n  - $H = 1.0$ (米), $\\rho = 350$ (千克/立方米), $c = 2000$ (焦耳/千克/开尔文), $k = 0.1$ (瓦特/米/开尔文),\n  - $T_{\\mathrm{init}} = 268.15$ (开尔文),\n  - $q_{\\mathrm{mean}} = 0$ (瓦特/平方米), $q_{\\mathrm{amp}} = 200$ (瓦特/平方米),\n  - $M = 100$ (整数), $\\Delta t = 60$ (秒)。\n- 用例 C (导热性更强且有净冷却的薄雪层):\n  - $H = 0.2$ (米), $\\rho = 250$ (千克/立方米), $c = 2100$ (焦耳/千克/开尔文), $k = 0.35$ (瓦特/米/开尔文),\n  - $T_{\\mathrm{init}} = 270.15$ (开尔文),\n  - $q_{\\mathrm{mean}} = -20$ (瓦特/平方米), $q_{\\mathrm{amp}} = 100$ (瓦特/平方米),\n  - $M = 40$ (整数), $\\Delta t = 20$ (秒)。\n\n角度单位不适用。所有量必须以指定的物理单位表示。你的程序应产生单行输出，其中包含一个方括号括起来的逗号分隔列表，每个测试用例对应一个子列表，顺序为用例A、用例B、用例C，每个子列表的格式为 $[T_{\\mathrm{surf}},\\Delta E,\\int_0^P q_{\\mathrm{surf}}(t)\\,dt,\\mathrm{boolean}]$，例如 $[[300.123,1234.5,1200.0,True],[\\dots],[\\dots]]$。",
            "solution": "该问题是求解具有常系数的一维热传导方程：\n$$ \\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial z^2} $$\n其中 $\\alpha = k/(\\rho c)$ 是热扩散率。将使用有限差分法求解。\n\n**1. 离散化**\n我们将空间域 $z \\in [0, H]$ 离散化为一个由 $M$ 个点 $z_i = i\\Delta z$ 组成的均匀网格，其中 $i=0, 1, \\dots, M-1$，$ \\Delta z = H/(M-1)$。时间域被离散化为大小为 $\\Delta t$ 的步长，使得 $t_n = n\\Delta t$。网格点 $i$ 和时间步 $n$ 的温度记为 $T_i^n$。\n\n**2. Crank-Nicolson 格式**\n为了在时间上达到二阶精度，我们使用 Crank-Nicolson 方法。这涉及在当前时间步 $n$ 和下一个时间步 $n+1$ 之间对空间导数进行平均：\n$$ \\frac{T_i^{n+1} - T_i^n}{\\Delta t} = \\frac{\\alpha}{2} \\left( \\frac{T_{i+1}^n - 2T_i^n + T_{i-1}^n}{(\\Delta z)^2} + \\frac{T_{i+1}^{n+1} - 2T_i^{n+1} + T_{i-1}^{n+1}}{(\\Delta z)^2} \\right) $$\n令 $r = \\frac{\\alpha \\Delta t}{2(\\Delta z)^2}$。重新整理方程，将未知数（在步骤 $n+1$）与已知数（在步骤 $n$）分开，得到内部节点（$i=1, \\dots, M-2$）的方程：\n$$ -r T_{i-1}^{n+1} + (1+2r)T_i^{n+1} - r T_{i+1}^{n+1} = r T_{i-1}^n + (1-2r)T_i^n + r T_{i+1}^n $$\n\n**3. 边界条件**\n诺伊曼边界条件通过使用虚拟点来引入，以保持二阶空间精度。\n\n**表面 $z=0$ (i=0):**\n边界条件为 $-k \\frac{\\partial T}{\\partial z} = q_{\\mathrm{surf}}(t)$。我们在 $z_{-1} = -\\Delta z$ 处引入一个虚拟点。在 $z_0$ 处对导数使用中心差分给出：\n$$ -k \\frac{T_1 - T_{-1}}{2\\Delta z} = q_{\\mathrm{surf}}(t) \\implies T_{-1} = T_1 + \\frac{2\\Delta z}{k} q_{\\mathrm{surf}}(t) $$\n我们在时间层 $n$ 和 $n+1$ 上都应用这个关系。将 $T_{-1}^n$ 和 $T_{-1}^{n+1}$ 的表达式代入 $i=0$ 处的 Crank-Nicolson 公式，我们得到：\n$$ (1+2r)T_0^{n+1} - 2rT_1^{n+1} = (1-2r)T_0^n + 2rT_1^n + \\frac{\\Delta t}{\\rho c \\Delta z}(q_{\\mathrm{surf}}^{n} + q_{\\mathrm{surf}}^{n+1}) $$\n这构成了我们线性系统的第一行。\n\n**底部 $z=H$ (i=M-1):**\n条件是零通量，$-k \\frac{\\partial T}{\\partial z} = 0$。在 $z_M = H+\\Delta z$ 处使用一个虚拟点，中心差分为：\n$$ -k \\frac{T_M - T_{M-2}}{2\\Delta z} = 0 \\implies T_M = T_{M-2} $$\n将 $T_M^n = T_{M-2}^n$ 和 $T_M^{n+1} = T_{M-2}^{n+1}$ 代入 $i=M-1$ 处的 Crank-Nicolson 公式：\n$$ -2rT_{M-2}^{n+1} + (1+2r)T_{M-1}^{n+1} = 2rT_{M-2}^n + (1-2r)T_{M-1}^n $$\n这构成了我们线性系统的最后一行。\n\n**4. 矩阵系统与求解**\n关于未知温度 $T_i^{n+1}$ 的 $M$ 个线性方程组可以写成矩阵形式 $\\mathbf{A}\\mathbf{T}^{n+1} = \\mathbf{b}^n$，其中 $\\mathbf{T}^{n+1}$ 是新时间步的温度向量。\n\n矩阵 $\\mathbf{A}$ 是一个三对角矩阵，定义为：\n$$ \\mathbf{A} = \\begin{pmatrix}\n1+2r  -2r    \\\\\n-r  1+2r  -r   \\\\\n \\ddots  \\ddots  \\ddots  \\\\\n  -r  1+2r  -r \\\\\n   -2r  1+2r\n\\end{pmatrix} $$\n右端向量 $\\mathbf{b}^n$ 取决于已知的温度 $\\mathbf{T}^n$ 和边界强迫：\n- $b_0^n = (1-2r)T_0^n + 2rT_1^n + \\frac{\\Delta t}{\\rho c \\Delta z}(q_{\\mathrm{surf}}^{n} + q_{\\mathrm{surf}}^{n+1})$\n- $b_i^n = rT_{i-1}^n + (1-2r)T_i^n + rT_{i+1}^n$ for $i=1, \\ldots, M-2$\n- $b_{M-1}^n = 2rT_{M-2}^n + (1-2r)T_{M-1}^n$\n\n在每个时间步，这个三对角系统可以使用托马斯算法高效地求解 $\\mathbf{T}^{n+1}$。\n\n**5. 能量守恒验证**\n在模拟完整个周期 $P$ 后，我们验证能量守恒。雪堆单位面积内能的变化量 $\\Delta E = E(P) - E(0)$ 是通过使用梯形法则对温度剖面进行数值积分来计算的：\n$$ E(t) = \\int_0^H \\rho c T(z,t)\\,dz \\approx \\Delta z \\left( \\frac{\\rho c T(z_0,t) + \\rho c T(z_{M-1},t)}{2} + \\sum_{i=1}^{M-2} \\rho c T(z_i,t) \\right) $$\n来自表面通量的总能量输入 $I_q = \\int_0^P q_{\\mathrm{surf}}(t)\\,dt$ 也使用梯形法则对通量值的时间序列进行计算。\n然后使用指定的绝对和相对容差检查来比较这两个量：\n$$ \\left|\\Delta E - I_q\\right| \\le \\varepsilon_{\\mathrm{abs}} + \\varepsilon_{\\mathrm{rel}} \\max\\left(\\left|\\Delta E\\right|,\\left|I_q\\right|\\right) $$\n这个过程为数值实现的正确性和能量守恒性质提供了可靠的检验。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef run_simulation(params: dict) - list:\n    \"\"\"\n    Solves the 1D heat equation for a snowpack and verifies energy conservation.\n\n    Args:\n        params: A dictionary containing all physical and numerical parameters for the simulation.\n\n    Returns:\n        A list containing the final surface temperature, change in internal energy,\n        integrated surface flux, and a boolean for energy conservation.\n    \"\"\"\n    # Unpack parameters\n    H = params['H']\n    rho = params['rho']\n    c = params['c']\n    k = params['k']\n    T_init = params['T_init']\n    q_mean = params['q_mean']\n    q_amp = params['q_amp']\n    M = params['M']\n    dt = params['dt']\n    P = 86400.0  # Total simulation time in seconds (24 hours)\n\n    # Grid and time setup\n    dz = H / (M - 1)\n    N_steps = int(P / dt)\n    z_nodes = np.linspace(0, H, M)\n    t_nodes = np.linspace(0, P, N_steps + 1)\n\n    # Initial temperature profile\n    T = np.full(M, T_init)\n\n    # Dimensionless parameter for the Crank-Nicolson scheme\n    alpha = k / (rho * c)\n    r = alpha * dt / (2 * dz**2)\n\n    # Pre-calculate surface heat flux time series\n    q_surf = q_mean + q_amp * np.sin(2 * np.pi * t_nodes / P)\n\n    # Construct the LHS matrix 'A' for the tridiagonal solver.\n    # The matrix is stored in the 'banded' format required by scipy.linalg.solve_banded.\n    A_banded = np.zeros((3, M))\n    A_banded[1, :] = 1 + 2 * r      # Main diagonal\n    A_banded[0, 1:] = -r             # Upper diagonal\n    A_banded[2, :-1] = -r          # Lower diagonal\n    # Modify for Neumann boundary conditions\n    A_banded[0, 1] = -2 * r          # A[0, 1]\n    A_banded[2, M - 2] = -2 * r    # A[M-1, M-2]\n\n    # Calculate initial internal energy\n    E_initial = np.trapz(rho * c * T, dx=dz)\n\n    # Time-stepping loop\n    for n in range(N_steps):\n        # Construct the RHS vector 'b'\n        b = np.zeros(M)\n        \n        # Interior points (i=1 to M-2)\n        b[1:-1] = r * T[:-2] + (1 - 2 * r) * T[1:-1] + r * T[2:]\n        \n        # Boundary at z=0 (i=0) with surface flux\n        q_n = q_surf[n]\n        q_n_plus_1 = q_surf[n + 1]\n        flux_term = (dt / (rho * c * dz)) * (q_n + q_n_plus_1)\n        b[0] = (1 - 2 * r) * T[0] + 2 * r * T[1] + flux_term\n        \n        # Boundary at z=H (i=M-1) with zero flux\n        b[-1] = 2 * r * T[-2] + (1 - 2 * r) * T[-1]\n        \n        # Solve the tridiagonal system A*T_new = b for T_new\n        T = solve_banded((1, 1), A_banded, b)\n\n    # --- Post-processing and Verification ---\n\n    # Final surface temperature, rounded\n    T_surf_final = round(T[0], 3)\n    \n    # Calculate final internal energy\n    E_final = np.trapz(rho * c * T, dx=dz)\n    \n    # Calculate total change in internal energy\n    delta_E_unrounded = E_final - E_initial\n    \n    # Calculate time-integrated surface flux\n    I_q_unrounded = np.trapz(q_surf, dx=dt)\n\n    # Perform energy conservation check with unrounded values\n    eps_abs = 1.0\n    eps_rel = 0.01\n    # Handle the case where both values are zero to avoid division by zero\n    if delta_E_unrounded == 0 and I_q_unrounded == 0:\n        is_conserved = True\n    else:\n        check_val = eps_abs + eps_rel * max(abs(delta_E_unrounded), abs(I_q_unrounded))\n        is_conserved = abs(delta_E_unrounded - I_q_unrounded) = check_val\n\n    # Round energy values for reporting\n    delta_E = round(delta_E_unrounded, 1)\n    I_q = round(I_q_unrounded, 1)\n    \n    return [T_surf_final, delta_E, I_q, is_conserved]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results in the specified format.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path\n        {'H': 0.5, 'rho': 300, 'c': 2100, 'k': 0.2, 'T_init': 263.15,\n         'q_mean': 10, 'q_amp': 150, 'M': 50, 'dt': 120},\n        # Case B: boundary behavior with zero-mean forcing\n        {'H': 1.0, 'rho': 350, 'c': 2000, 'k': 0.1, 'T_init': 268.15,\n         'q_mean': 0, 'q_amp': 200, 'M': 100, 'dt': 60},\n        # Case C: thin, more conductive snowpack with net cooling\n        {'H': 0.2, 'rho': 250, 'c': 2100, 'k': 0.35, 'T_init': 270.15,\n         'q_mean': -20, 'q_amp': 100, 'M': 40, 'dt': 20},\n    ]\n\n    all_results = []\n    for case_params in test_cases:\n        all_results.append(run_simulation(case_params))\n    \n    # Format the final output string precisely as requested\n    formatted_strings = []\n    for res in all_results:\n        # res is a list like [T_surf, delta_E, I_q, is_conserved]\n        # The str() of a bool is 'True' or 'False', which is correct.\n        s = f\"[{res[0]},{res[1]},{res[2]},{str(res[3])}]\"\n        formatted_strings.append(s)\n    \n    print(f\"[{','.join(formatted_strings)}]\")\n\nsolve()\n```"
        }
    ]
}