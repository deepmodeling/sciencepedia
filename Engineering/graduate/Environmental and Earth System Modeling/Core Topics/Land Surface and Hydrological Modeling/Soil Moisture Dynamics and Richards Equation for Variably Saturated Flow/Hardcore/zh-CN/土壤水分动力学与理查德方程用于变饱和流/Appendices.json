{
    "hands_on_practices": [
        {
            "introduction": "在深入研究理查兹方程的完整数值解之前，理解控制土壤水运动的主导力至关重要。本练习利用量纲分析这一强大工具，将复杂的偏微分方程精炼为一个无量纲数，从而帮助我们直观地理解重力与毛细管力在何种情况下占据主导地位。通过这种方式，我们能够识别流动状态（例如，重力驱动的运动波或毛细管力驱动的扩散），而无需进行复杂的求解过程 。",
            "id": "3913604",
            "problem": "考虑在地球重力作用下，均质土柱中的一维垂向非饱和变饱和流。从水量质量守恒定律和非饱和变饱和流的达西-白金汉定律出发，通过引入特征垂直长度尺度 $L$、特征基质（压力）水头大小 $\\Psi^{\\ast}$、特征饱和导水率 $K_{s}$ 以及相关的时间尺度 $T$ 来进行尺度分析。使用这些尺度定义一个无量纲毛细管数 $\\mathcal{C}$，该数衡量了垂向通量中毛细管压力水头梯度与重力的相对重要性。然后，推断毛细管作用主导或重力主导的极限情况。\n\n选择所有关于 $\\mathcal{C}$ 的解释以及在相应极限情况下流动行为的正确陈述：\n\nA. 在极限 $\\mathcal{C} \\gg 1$ 的情况下，对达西-白金汉通量的引力贡献在主导阶上可以忽略不计，控制动力学由毛细管作用主导；在主导阶上，通量简化为 $q \\approx -K(h)\\,\\partial h/\\partial z$，并且入渗锋面被强烈的毛细管梯度平滑。\n\nB. 在极限 $\\mathcal{C} \\ll 1$ 的情况下，毛细管压力水头梯度在主导阶上可以忽略不计，通量近似为 $q \\approx -K(h)$（向下），守恒定律简化为 $\\partial \\theta/\\partial t + \\partial(-K(\\theta))/\\partial z \\approx 0$，即一个由重力驱动的运动波，其特征由 $-\\,\\mathrm{d}K/\\mathrm{d}\\theta$ 决定。\n\nC. 无量纲数 $\\mathcal{C}$ 比较的是惯性力与粘性力；因此，$\\mathcal{C} \\gg 1$ 意味着惯性效应主导流动。\n\nD. 在从地下水位开始的静水毛细上升中，选择 $L$ 等于平衡上升高度，$\\Psi^{\\ast}$ 等于基质水头的特征大小，会得到数量级为1的 $\\mathcal{C}$，这反映了平衡状态下重力与毛细管作用之间的平衡。\n\nE. 对于具有极大 $\\mathcal{C}$ 值的土壤，由于重力可以忽略不计，其动力学变得与 $K(h)$ 无关；因此，任何两个具有不同导水率函数的土壤都会表现出相同的再分布行为。",
            "solution": "用户提供了一个关于多孔介质中一维非饱和变饱和流的问题陈述。我的任务是首先验证问题陈述的有效性，如果有效，则继续进行完整解答并评估给出的选项。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **系统：** 一维（$1$D）垂向非饱和变饱和流。\n- **介质：** 均质土柱。\n- **外力：** 地球重力。\n- **控制原理：** 水量质量守恒定律和非饱和变饱和流的达西-白金汉定律。\n- **任务1：** 进行尺度分析。\n- **特征尺度：**\n    - 垂直长度尺度：$L$\n    - 基质（压力）水头大小：$\\Psi^{\\ast}$\n    - 饱和导水率：$K_{s}$\n    - 相关的时间尺度：$T$\n- **任务2：** 定义一个无量纲毛细管数 $\\mathcal{C}$，用于衡量垂向通量中毛细管压力水头梯度与重力的相对重要性。\n- **任务3：** 分析毛细管作用主导与重力主导的流动的极限情况。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题牢固地植根于多孔介质流动的经典理论，特别是使用了理查兹方程，该方程由质量守恒原理和达西-白金汉定律推导而来。这些是水文地质学、土壤物理学和环境工程中的基石概念。该问题在科学上是合理的。\n- **适定性：** 该问题要求通过尺度分析推导一个无量纲数，并解释其在极限情况下的物理意义。这是物理学和工程学中理解系统行为而无需求解完整控制方程的标准且明确定义的过程。可以推导出 $\\mathcal{C}$ 的唯一且有意义的定义，其极限的解释是标准结果。\n- **客观性：** 语言技术性强、精确，没有主观或模糊的术语。所有使用的术语在相关科学领域都有公认的含义。\n- **完整性和一致性：** 该问题提供了进行尺度分析所需的所有必要概念元素。它指明了要使用的物理定律和特征尺度。整个设置是自洽且内部一致的。\n\n**步骤3：结论和行动**\n问题陈述是有效的。这是一个关于多孔介质中输运现象的标准、适定的问题。我现在将进行推导和求解。\n\n### 推导与求解\n\n**1. 控制方程**\n非饱和变饱和多孔介质中水的一维垂向流动由理查兹方程描述。它结合了质量守恒定律和达西-白金汉定律。设 $z$ 为垂向坐标，向上为正， $t$ 为时间。\n\n水的质量守恒定律为：\n$$ \\frac{\\partial \\theta}{\\partial t} = -\\frac{\\partial q}{\\partial z} $$\n其中 $\\theta$ 是体积含水量（无量纲, $[L^3/L^3]$），$q$ 是体积水通量（达西流速, $[L/T]$）。\n\n重力作用下垂向流动的达西-白金汉定律为：\n$$ q = -K(h) \\frac{\\partial \\Phi}{\\partial z} $$\n其中 $K(h)$ 是非饱和导水率（$[L/T]$），它是基质水头 $h$ （$[L]$）的强函数，$\\Phi$ 是总水头（$[L]$）。总水头是基质水头和高程水头之和，$\\Phi = h + z$。\n\n将总水头代入达西-白金汉定律：\n$$ q = -K(h) \\frac{\\partial (h+z)}{\\partial z} = -K(h) \\left( \\frac{\\partial h}{\\partial z} + 1 \\right) $$\n因此，通量 $q$ 由两部分组成：\n- $q_{cap} = -K(h) \\frac{\\partial h}{\\partial z}$ （由毛细管压力水头梯度驱动的通量）\n- $q_{grav} = -K(h)$ （由重力驱动的通量）\n\n**2. 尺度分析与 $\\mathcal{C}$ 的定义**\n问题要求一个无量纲数 $\\mathcal{C}$，用来比较毛细管压力水头梯度与重力的重要性。这等同于比较总水头梯度中两个驱动项 $\\frac{\\partial h}{\\partial z}$ 和 $1$ 的量级。\n\n我们引入特征尺度：\n- 基质水头 $h$ 由其特征大小 $\\Psi^{\\ast}$ 进行尺度化：$h \\sim \\Psi^{\\ast}$。\n- 垂向坐标 $z$ 由特征长度 $L$ 进行尺度化：$z \\sim L$。\n\n使用这些尺度，我们可以估算毛细管压力水头梯度的数量级：\n$$ \\left| \\frac{\\partial h}{\\partial z} \\right| \\sim \\frac{\\Psi^{\\ast}}{L} $$\n重力水头梯度精确地为 $\\frac{\\partial z}{\\partial z} = 1$。\n\n无量纲毛细管数 $\\mathcal{C}$ 是毛细管梯度特征大小与重力梯度之比：\n$$ \\mathcal{C} = \\frac{|\\text{characteristic capillary gradient}|}{|\\text{characteristic gravity gradient}|} = \\frac{\\Psi^{\\ast}/L}{1} = \\frac{\\Psi^{\\ast}}{L} $$\n由于 $\\Psi^{\\ast}$（压力水头）和 $L$ 的单位都是长度，所以 $\\mathcal{C}$ 是一个无量纲数。\n\n现在我们根据 $\\mathcal{C}$ 的值分析极限情况。\n\n- **毛细管作用主导情况：** 如果 $\\mathcal{C} \\gg 1$，则 $\\Psi^{\\ast}/L \\gg 1$。这意味着特征毛细管梯度 $|\\partial h/\\partial z|$ 远大于重力梯度 $1$。\n- **重力主导情况：** 如果 $\\mathcal{C} \\ll 1$，则 $\\Psi^{\\ast}/L \\ll 1$。这意味着特征毛细管梯度 $|\\partial h/\\partial z|$ 远小于重力梯度。\n\n**3. 评估选项**\n\n**A. 在极限 $\\mathcal{C} \\gg 1$ 的情况下，对达西-白金汉通量的引力贡献在主导阶上可以忽略不计，控制动力学由毛细管作用主导；在主导阶上，通量简化为 $q \\approx -K(h)\\,\\partial h/\\partial z$，并且入渗锋面被强烈的毛细管梯度平滑。**\n\n如果 $\\mathcal{C} \\gg 1$，则 $|\\partial h/\\partial z| \\gg 1$。通量表达式 $q = -K(h) (\\partial h/\\partial z + 1)$ 由 $\\partial h/\\partial z$ 项主导。因此，在主导阶上：\n$$ q \\approx -K(h) \\frac{\\partial h}{\\partial z} $$\n重力贡献 $-K(h)$ 确实可以忽略。将此通量代入守恒定律 $\\partial\\theta/\\partial t = -\\partial q/\\partial z$ 得到：\n$$ \\frac{\\partial \\theta}{\\partial t} \\approx \\frac{\\partial}{\\partial z} \\left( K(h) \\frac{\\partial h}{\\partial z} \\right) $$\n使用比水容量 $C(h) = d\\theta/dh$，方程变为 $C(h) \\frac{\\partial h}{\\partial t} \\approx \\frac{\\partial}{\\partial z} \\left( K(h) \\frac{\\partial h}{\\partial z} \\right)$。这是一个非线性扩散方程（也称为福克-普朗克方程）。扩散过程的特点是平滑陡峭的梯度。因此，入渗锋面将被平滑掉。该陈述完全正确。\n**结论：正确**\n\n**B. 在极限 $\\mathcal{C} \\ll 1$ 的情况下，毛细管压力水头梯度在主导阶上可以忽略不计，通量近似为 $q \\approx -K(h)$（向下），守恒定律简化为 $\\partial \\theta/\\partial t + \\partial(-K(\\theta))/\\partial z \\approx 0$，即一个由重力驱动的运动波，其特征由 $-\\,\\mathrm{d}K/\\mathrm{d}\\theta$ 决定。**\n\n如果 $\\mathcal{C} \\ll 1$，则 $|\\partial h/\\partial z| \\ll 1$。在通量表达式 $q = -K(h) (\\partial h/\\partial z + 1)$ 中，$\\partial h/\\partial z$ 项与 $1$ 相比可以忽略。因此，在主导阶上：\n$$ q \\approx -K(h)(1) = -K(h) $$\n负号表示向下的流动（因为 $z$ 向上为正，且 $K(h)$ 为非负）。守恒定律 $\\partial\\theta/\\partial t = -\\partial q/\\partial z$ 变为：\n$$ \\frac{\\partial \\theta}{\\partial t} \\approx -\\frac{\\partial}{\\partial z}(-K(h)) $$\n由于 $\\theta$ 是 $h$ 的唯一函数，我们可以将 $K$ 表示为 $\\theta$ 的函数，$K(\\theta)$。于是方程为 $\\frac{\\partial \\theta}{\\partial t} + \\frac{\\partial(-K(\\theta))}{\\partial z} \\approx 0$。这是一个一阶双曲型偏微分方程，描述了波的传播。这种由重力驱动的流动被称为运动波。对于形式为 $\\frac{\\partial u}{\\partial t} + \\frac{\\partial F(u)}{\\partial x} = 0$ 的方程，特征速度（波速）由 $c = dF/du$ 给出。在我们的例子中，$u = \\theta$ 且 $F(\\theta) = -K(\\theta)$。因此，特征速度为 $c(\\theta) = \\frac{d}{d\\theta}(-K(\\theta)) = -\\frac{dK}{d\\theta}$。该陈述完全正确。\n**结论：正确**\n\n**C. 无量纲数 $\\mathcal{C}$ 比较的是惯性力与粘性力；因此，$\\mathcal{C} \\gg 1$ 意味着惯性效应主导流动。**\n\n比较惯性力与粘性力的无量纲数是雷诺数，通常定义为 $Re = \\rho v L / \\mu$。达西-白金汉定律本身是在蠕动流（雷诺数非常低）的假设下推导出来的，其中粘性力占主导，惯性力可以忽略。我们的数 $\\mathcal{C} = \\Psi^{\\ast}/L$ 比较的是一个压力梯度（由毛细管作用引起）的量级与另一个势梯度（由重力引起）的量级。它是一个力的比率，但不是惯性力与粘性力的比率。这个陈述从根本上误解了 $\\mathcal{C}$ 的物理意义。\n**结论：不正确**\n\n**D. 在从地下水位开始的静水毛细上升中，选择 $L$ 等于平衡上升高度，$\\Psi^{\\ast}$ 等于基质水头的特征大小，会得到数量级为1的 $\\mathcal{C}$，这反映了平衡状态下重力与毛细管作用之间的平衡。**\n\n在静水力平衡状态下，净通量 $q$ 为零。这意味着：\n$$ q = -K(h) \\left( \\frac{\\partial h}{\\partial z} + 1 \\right) = 0 $$\n对于 $K(h)  0$ 的湿润区域，这要求总水头梯度为零：\n$$ \\frac{\\partial h}{\\partial z} + 1 = 0 \\quad \\implies \\quad \\frac{\\partial h}{\\partial z} = -1 $$\n这表明毛细管压力水头梯度（量级为 $1$）与重力水头梯度（量级为 $1$）之间达到了完美平衡。如果我们选择特征长度尺度 $L$ 为毛细带的高度，并选择 $\\Psi^{\\ast}$ 为此高度上基质水头的量级，则特征梯度为 $|\\partial h/\\partial z| \\sim \\Psi^{\\ast}/L$。由于在平衡状态下该梯度等于 $1$，我们必须有 $\\Psi^{\\ast}/L = 1$，这意味着 $\\mathcal{C} = 1$。这标志着两种力之间的平衡。该陈述在物理上和数学上都是合理的。\n**结论：正确**\n\n**E. 对于具有极大 $\\mathcal{C}$ 值的土壤，由于重力可以忽略不计，其动力学变得与 $K(h)$ 无关；因此，任何两个具有不同导水率函数的土壤都会表现出相同的再分布行为。**\n\n如选项A的分析所示，在 $\\mathcal{C} \\gg 1$ 的极限情况下，控制方程近似为：\n$$ C(h) \\frac{\\partial h}{\\partial t} \\approx \\frac{\\partial}{\\partial z} \\left( K(h) \\frac{\\partial h}{\\partial z} \\right) $$\n动力学显然依赖于导水率函数 $K(h)$。函数 $K(h)$（以及 $C(h)$）决定了土壤的水力扩散率 $D(h) = K(h)/C(h)$，它控制着水分再分布的速率。在其他条件相同的情况下，具有较高 $K(h)$ 的土壤将比具有较低 $K(h)$ 的土壤更快地再分布水分。动力学变得与 $K(h)$ 无关的前提是错误的，因此结论也是错误的。\n**结论：不正确**",
            "answer": "$$\\boxed{ABD}$$"
        },
        {
            "introduction": "本练习是进入数值建模世界的第一步，它关注的是稳定入渗这一基本情景。首先，你将为一个简化的稳态问题推导出解析解，从而获得一个精确的基准。随后，你将构建一个数值求解器，并利用该解析解来验证你的代码，这是计算科学中称为“验证”的关键步骤，旨在确保模型被正确地实现 。",
            "id": "3913605",
            "problem": "考虑一维垂直稳定入渗到一个半无限多孔介质中，在环境和地球系统建模中，该过程由变饱和流的 Richards 方程混合形式来模拟。设 $x$ 表示从地表向下的深度，其中 $x \\ge 0$。Darcy 通量 $q$ 定义为向下为正。水力水头的表示方式使得通量与压力水头之间的稳态控制关系与所选的符号约定一致，并由下式给出\n$$\nq = K(\\psi)\\left(1 + \\frac{d\\psi}{dx}\\right),\n$$\n其中 $\\psi(x)$ 是压力水头（单位：$\\mathrm{m}$），$K(\\psi)$ 是非饱和导水率（单位：$\\mathrm{m/s}$），项 $1$ 反映了在向下的坐标约定下的单位重力水头梯度。假设导水率采用 Gardner 模型，\n$$\nK(\\psi) = K_s \\exp(\\alpha \\psi),\n$$\n其中 $K_s$ 是饱和导水率（单位：$\\mathrm{m/s}$），$\\alpha$ 是 Gardner 参数（单位：$\\mathrm{m^{-1}}$）。在半无限域中的稳定流条件下，地表水头边界条件为常数 $\\psi(0) = \\psi_0$，远场条件为当 $x \\to \\infty$ 时压力水头趋于常数 $\\psi_\\infty$，质量守恒意味着通量 $q$ 随深度保持不变，并满足 $q = K(\\psi_\\infty)$。\n\n从上述基本定律和定义（稳态下的质量守恒、有明确符号约定的 Darcy 定律、所选坐标系下的水力水头定义以及 $K(\\psi)$ 的 Gardner 模型）出发，推导在 $x \\in [0,\\infty)$ 范围内关于参数 $K_s$、$\\alpha$、 $q$ 和 $\\psi_0$ 的压力水头剖面 $\\psi(x)$ 的解析解。然后，对稳态常微分方程实施数值求解，\n$$\n\\frac{d\\psi}{dx} = \\frac{q}{K(\\psi)} - 1 = \\frac{q}{K_s \\exp(\\alpha \\psi)} - 1,\n$$\n在一个截断域 $[0,L]$ 上，使用从 $x=0$ 处 $\\psi(0)=\\psi_0$ 开始的稳健初值公式，该域的深度应足以近似远场条件 $\\psi(x) \\to \\psi_\\infty$（其中 $q = K_s\\exp(\\alpha \\psi_\\infty)$）。通过计算最大绝对偏差来比较解析解和数值解\n$$\n\\Delta_{\\max} = \\max_{x \\in \\{x_i\\}_{i=0}^{N-1}} \\left|\\psi_{\\mathrm{analytic}}(x) - \\psi_{\\mathrm{numeric}}(x)\\right|\n$$\n在一组指定的采样深度 $\\{x_i\\}$ 上。\n\n所有水头以 $\\mathrm{m}$ 表示，深度以 $\\mathrm{m}$ 表示，导水率和通量以 $\\mathrm{m/s}$ 表示。测试用例的最终答案必须是表示 $\\Delta_{\\max}$（单位：$\\mathrm{m}$）的浮点数。\n\n您的程序必须实现常微分方程的解析解和数值求解器，然后对以下每个测试用例评估 $\\Delta_{\\max}$（每个测试用例指定 $K_s$（单位：$\\mathrm{m/s}$）、$\\alpha$（单位：$\\mathrm{m^{-1}}$）、$\\psi_0$（单位：$\\mathrm{m}$）、$\\psi_\\infty$（单位：$\\mathrm{m}$）、$L$（单位：$\\mathrm{m}$）和采样点数 $N$）：\n\n- 情况 A（一般理想路径）：$K_s = 1.0 \\times 10^{-6}\\,\\mathrm{m/s}$，$\\alpha = 4.0\\,\\mathrm{m^{-1}}$，$\\psi_0 = -0.2\\,\\mathrm{m}$，$\\psi_\\infty = -0.5\\,\\mathrm{m}$， $L = 2.0\\,\\mathrm{m}$，$N = 51$。\n- 情况 B（边界条件为地表水头等于远场水头，导致剖面为常数）：$K_s = 1.0 \\times 10^{-6}\\,\\mathrm{m/s}$，$\\alpha = 4.0\\,\\mathrm{m^{-1}}$，$\\psi_0 = -0.5\\,\\mathrm{m}$，$\\psi_\\infty = -0.5\\,\\mathrm{m}$，$L = 2.0\\,\\mathrm{m}$，$N = 51$。\n- 情况 C（由于 $\\alpha$ 较大且域较浅而产生的急剧过渡）：$K_s = 1.0 \\times 10^{-6}\\,\\mathrm{m/s}$，$\\alpha = 20.0\\,\\mathrm{m^{-1}}$，$\\psi_0 = -0.05\\,\\mathrm{m}$，$\\psi_\\infty = -0.5\\,\\mathrm{m}$，$L = 0.5\\,\\mathrm{m}$，$N = 101$。\n- 情况 D（由于 $\\alpha$ 较小且域较深而产生的缓慢变化）：$K_s = 1.0 \\times 10^{-6}\\,\\mathrm{m/s}$，$\\alpha = 0.5\\,\\mathrm{m^{-1}}$，$\\psi_0 = -0.1\\,\\mathrm{m}$，$\\psi_\\infty = -1.0\\,\\mathrm{m}$，$L = 5.0\\,\\mathrm{m}$，$N = 101$。\n\n对每种情况，明确使用 $q = K_s \\exp(\\alpha \\psi_\\infty)$。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，“[resultA,resultB,resultC,resultD]”）。每个条目必须是对应情况下 $\\Delta_{\\max}$ 的浮点值（单位：$\\mathrm{m}$）。",
            "solution": "用户提供了一个水文地质学和土壤物理学领域的问题，具体涉及一维稳态入渗。任务是首先验证问题的完整性，如果有效，则继续解决它。解决方案涉及推导压力水头剖面的解析表达式，为控制性常微分方程（ODE）实现一个数值求解器，并对一组测试用例比较这两种解。\n\n### 步骤 1：问题验证\n\n给定条件从问题陈述中逐字提取：\n- 稳定 Darcy 通量 $q$ 的控制关系：$q = K(\\psi)\\left(1 + \\frac{d\\psi}{dx}\\right)$\n- $K(\\psi)$ 非饱和导水率的 Gardner 模型：$K(\\psi) = K_s \\exp(\\alpha \\psi)$\n- 坐标系：$x$ 是深度，向下为正，$x \\ge 0$。\n- 域：半无限，$[0, \\infty)$。\n- 边界条件：恒定地表水头 $\\psi(0) = \\psi_0$，以及当 $x \\to \\infty$ 时，远场恒定水头 $\\psi(x) \\to \\psi_\\infty$。\n- 通量条件：根据质量守恒和远场边界条件，恒定通量为 $q = K(\\psi_\\infty)$。\n- 压力水头 $\\psi(x)$ 的 ODE：$\\frac{d\\psi}{dx} = \\frac{q}{K_s \\exp(\\alpha \\psi)} - 1$。\n- 比较度量：$\\Delta_{\\max} = \\max_{x \\in \\{x_i\\}_{i=0}^{N-1}} \\left|\\psi_{\\mathrm{analytic}}(x) - \\psi_{\\mathrm{numeric}}(x)\\right|$。\n- 为 $K_s$, $\\alpha$, $\\psi_0$, $\\psi_\\infty$, $L$, 和 $N$ 提供具体值的测试用例。\n\n根据验证标准对问题进行评估：\n- **科学依据**：该问题基于 Richards 方程，这是变饱和流理论的基石。Gardner 导水率模型是一个广泛使用的经验函数。该设置描述了土壤物理学中一个经典的、基本的问题。该问题在科学上是合理的。\n- **适定性**：该任务要求解一个具有给定初始条件的一阶常微分方程。这构成了一个适定的初值问题，预期会有一个唯一解。解析解的推导是微积分中的一个标准练习。\n- **客观性和完整性**：问题使用精确的数学和物理术语（$q$、$K(\\psi)$、$\\psi$ 等）进行陈述。解析推导和数值求解所需的所有参数、方程和边界条件都已明确提供。\n\n问题陈述没有科学缺陷、矛盾或含糊不清之处。它是一个完整、一致且适定的问题，基于已建立的物理原理。\n\n### 结论与行动\n问题是**有效的**。将按照指定的结构提供解决方案。\n\n### 第 1 部分：解析解推导\n压力水头剖面 $\\psi(x)$ 由以下一阶常微分方程控制：\n$$\n\\frac{d\\psi}{dx} = \\frac{q}{K_s \\exp(\\alpha \\psi)} - 1\n$$\n初始条件为 $\\psi(0) = \\psi_0$。这是一个可分离的微分方程。我们可以重新整理它以分离变量 $\\psi$ 和 $x$：\n$$\ndx = \\frac{d\\psi}{\\frac{q}{K_s \\exp(\\alpha \\psi)} - 1}\n$$\n将右侧的分子和分母同乘以 $K_s \\exp(\\alpha \\psi)$ 得：\n$$\ndx = \\frac{K_s \\exp(\\alpha \\psi)}{q - K_s \\exp(\\alpha \\psi)} d\\psi\n$$\n对于向较干燥土壤的入渗，通常有 $\\psi_0  \\psi_\\infty$，并且由于 $\\psi$ 为负且 $\\alpha  0$，我们有 $K_s \\exp(\\alpha\\psi) \\ge K_s \\exp(\\alpha\\psi_\\infty) = q$。因此，分母 $q - K_s \\exp(\\alpha \\psi)$ 是非正的。我们重写表达式以确保被积函数在积分时是良定的：\n$$\ndx = - \\frac{K_s \\exp(\\alpha \\psi)}{K_s \\exp(\\alpha \\psi) - q} d\\psi\n$$\n我们对两边进行积分。深度 $x$ 从 $0$ 积分到 $x$，压力水头 $\\psi$ 从地表值 $\\psi_0$ 积分到深度 $x$ 处的值 $\\psi(x)$：\n$$\n\\int_0^x dx' = -\\int_{\\psi_0}^{\\psi(x)} \\frac{K_s \\exp(\\alpha \\psi')}{K_s \\exp(\\alpha \\psi') - q} d\\psi'\n$$\n右侧可以用换元法求解。设 $u = K_s \\exp(\\alpha \\psi') - q$。那么其微分为 $du = \\alpha K_s \\exp(\\alpha \\psi') d\\psi'$，这意味着 $K_s \\exp(\\alpha \\psi') d\\psi' = \\frac{1}{\\alpha} du$。积分变为：\n$$\nx = -\\frac{1}{\\alpha} \\int_{u_0}^{u(x)} \\frac{du}{u} = -\\frac{1}{\\alpha} \\left[ \\ln(u) \\right]_{u_0}^{u(x)}\n$$\n其中 $u_0 = K_s \\exp(\\alpha \\psi_0) - q$ 且 $u(x) = K_s \\exp(\\alpha \\psi(x)) - q$。\n$$\nx = -\\frac{1}{\\alpha} \\left[ \\ln(K_s \\exp(\\alpha \\psi(x)) - q) - \\ln(K_s \\exp(\\alpha \\psi_0) - q) \\right]\n$$\n$$\nx = -\\frac{1}{\\alpha} \\ln\\left( \\frac{K_s \\exp(\\alpha \\psi(x)) - q}{K_s \\exp(\\alpha \\psi_0) - q} \\right)\n$$\n为了求 $\\psi(x)$，我们对其进行求解：\n$$\n-\\alpha x = \\ln\\left( \\frac{K_s \\exp(\\alpha \\psi(x)) - q}{K_s \\exp(\\alpha \\psi_0) - q} \\right)\n$$\n$$\n\\exp(-\\alpha x) = \\frac{K_s \\exp(\\alpha \\psi(x)) - q}{K_s \\exp(\\alpha \\psi_0) - q}\n$$\n$$\nK_s \\exp(\\alpha \\psi(x)) - q = (K_s \\exp(\\alpha \\psi_0) - q)\\exp(-\\alpha x)\n$$\n$$\nK_s \\exp(\\alpha \\psi(x)) = q + (K_s \\exp(\\alpha \\psi_0) - q)\\exp(-\\alpha x)\n$$\n两边同除以 $K_s$ 并取自然对数，然后再除以 $\\alpha$，得到 $\\psi(x)$ 的显式解：\n$$\n\\psi(x) = \\frac{1}{\\alpha} \\ln\\left[ \\frac{q}{K_s} + \\left(\\exp(\\alpha \\psi_0) - \\frac{q}{K_s}\\right) \\exp(-\\alpha x) \\right]\n$$\n最后，代入给定条件 $q = K(\\psi_\\infty) = K_s \\exp(\\alpha \\psi_\\infty)$，或 $\\frac{q}{K_s} = \\exp(\\alpha \\psi_\\infty)$，我们得到解析解的最终形式：\n$$\n\\psi_{\\mathrm{analytic}}(x) = \\frac{1}{\\alpha} \\ln\\left[ \\exp(\\alpha \\psi_\\infty) + \\left(\\exp(\\alpha \\psi_0) - \\exp(\\alpha \\psi_\\infty)\\right) \\exp(-\\alpha x) \\right]\n$$\n\n### 第 2 部分：数值解与比较\n数值解是通过求解由以下定义的初值问题（IVP）获得的：\n- 常微分方程：$\\frac{d\\psi}{dx} = \\frac{q}{K_s \\exp(\\alpha \\psi)} - 1$\n- 初始条件：$\\psi(0) = \\psi_0$\n- 积分域：$[0, L]$\n\n这个初值问题使用一个标准的数值常微分方程求解器来解决。Python 库 `scipy` 提供了函数 `scipy.integrate.solve_ivp`，它是一个用于此目的的稳健且通用的工具。对于每个测试用例，都使用特定的参数（$K_s$、$\\alpha$、$\\psi_0$、$q$）调用此函数，从 $x=0$ 积分到 $x=L$。解在 $[0, L]$ 上均匀分布的 $N$ 个点 $\\{x_i\\}$ 的网格上进行评估。\n\n解析解和数值解之间的比较通过最大绝对偏差 $\\Delta_{\\max}$ 来量化。对于每个测试用例，我们计算：\n1. 由 $N$ 个评估点组成的网格，$x_i = i \\frac{L}{N-1}$，其中 $i=0, 1, \\dots, N-1$。\n2. 使用推导出的公式得到的解析解向量 $\\psi_{\\mathrm{analytic}}(x_i)$。\n3. 从 `solve_ivp` 函数获得的数值解向量 $\\psi_{\\mathrm{numeric}}(x_i)$。\n4. 这两个向量之间的最大绝对差：$\\Delta_{\\max} = \\max_{i} |\\psi_{\\mathrm{analytic}}(x_i) - \\psi_{\\mathrm{numeric}}(x_i)|$。\n\n对四个指定的测试用例中的每一个都实施此程序，从而提供数值求解器相对于精确解析解的准确性度量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the steady infiltration problem for four test cases and prints the maximum deviation\n    between analytical and numerical solutions.\n    \"\"\"\n\n    test_cases = [\n        # Case A: General happy path\n        (1.0e-6, 4.0, -0.2, -0.5, 2.0, 51),\n        # Case B: Constant profile\n        (1.0e-6, 4.0, -0.5, -0.5, 2.0, 51),\n        # Case C: Sharp transition\n        (1.0e-6, 20.0, -0.05, -0.5, 0.5, 101),\n        # Case D: Slow variation\n        (1.0e-6, 0.5, -0.1, -1.0, 5.0, 101),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_max = solve_and_compare_case(*case)\n        results.append(delta_max)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_and_compare_case(Ks, alpha, psi0, psi_inf, L, N):\n    \"\"\"\n    Derives analytical and numerical solutions for one case and computes the maximum deviation.\n\n    Args:\n        Ks (float): Saturated hydraulic conductivity (m/s).\n        alpha (float): Gardner parameter (m^-1).\n        psi0 (float): Pressure head at the surface (m).\n        psi_inf (float): Pressure head at infinity (m).\n        L (float): Depth of the truncated domain (m).\n        N (int): Number of sampling points.\n\n    Returns:\n        float: The maximum absolute deviation Delta_max (m).\n    \"\"\"\n    # Calculate the steady-state flux q based on the far-field condition\n    q = Ks * np.exp(alpha * psi_inf)\n\n    # Define the grid of points for evaluation\n    x_points = np.linspace(0, L, N)\n\n    # 1. Analytical Solution\n    # The analytical solution is psi(x) = (1/alpha) * ln[exp(alpha*psi_inf) + (exp(alpha*psi0) - exp(alpha*psi_inf)) * exp(-alpha*x)]\n    # We pre-calculate terms to enhance readability and potentially stability\n    exp_alpha_psi_inf = np.exp(alpha * psi_inf)\n    exp_alpha_psi0 = np.exp(alpha * psi0)\n    \n    # Handle the trivial case where psi0 == psi_inf to avoid floating point inaccuracies\n    if np.isclose(psi0, psi_inf):\n        psi_analytic = np.full_like(x_points, psi0)\n    else:\n        # Calculate the argument of the logarithm\n        term_in_ln = exp_alpha_psi_inf + (exp_alpha_psi0 - exp_alpha_psi_inf) * np.exp(-alpha * x_points)\n        psi_analytic = (1 / alpha) * np.log(term_in_ln)\n\n    # 2. Numerical Solution\n    # Define the ODE: d(psi)/dx = q / (Ks * exp(alpha * psi)) - 1\n    def ode_func(x, psi):\n        # The ODE is autonomous (not explicitly dependent on x)\n        # psi is passed as a single-element array by solve_ivp\n        psi_val = psi[0]\n        # Avoid potential overflow/underflow in exp if psi becomes very large/small\n        # though it should be stable for this problem\n        dpsi_dx = (q / (Ks * np.exp(alpha * psi_val))) - 1.0\n        return dpsi_dx\n\n    # Set up and run the ODE solver\n    sol = solve_ivp(\n        fun=ode_func,\n        t_span=(0, L),\n        y0=[psi0],\n        method='RK45',  # Standard robust Runge-Kutta method\n        t_eval=x_points,\n        rtol=1e-8,\n        atol=1e-10\n    )\n    \n    psi_numeric = sol.y[0]\n\n    # 3. Comparison\n    # Calculate the maximum absolute deviation between the two solutions\n    delta_max = np.max(np.abs(psi_analytic - psi_numeric))\n    \n    return delta_max\n\nsolve()\n```"
        },
        {
            "introduction": "这个综合性练习将你所学的技能应用于一个更接近真实世界环境过程的复杂瞬态问题。你将模拟土壤在一天内对周期性大气蒸发需求的响应，这对于理解陆地-大气相互作用至关重要。此练习超越了简化的稳态假设，采用更真实的van Genuchten-Mualem模型和随时间变化的边界条件，展示了数值模型在研究动态环境系统中的强大预测能力 。",
            "id": "3913567",
            "problem": "考虑一个深度为 $L$ 的一维垂直土壤柱，受到日变化大气需求的影响，其特征为正弦形式的势能蒸发 (PE) 率，记作 $E_p(t)$。土壤水分动力学由多孔介质中的质量守恒和变饱和条件下的 Darcy–Buckingham 流组合而成。控制基础方程如下：\n- 质量守恒：$\\dfrac{\\partial \\theta}{\\partial t} + \\dfrac{\\partial q}{\\partial z} = 0$，其中 $\\theta$ 是体积含水量，$q$ 是 Darcy 通量（向下为正）。\n- Darcy–Buckingham 定律：$q = -K(h)\\left(\\dfrac{\\partial h}{\\partial z} - 1\\right)$，其中 $h$ 是压力水头（在非饱和条件下为负），$K(h)$ 是导水率。\n- 通过 van Genuchten–Mualem 模型的本构关系：\n  - 有效饱和度：$S_e(h) = \\left[1 + (\\alpha |h|)^n \\right]^{-m}$，对于 $h \\le 0$，其中 $m = 1 - \\dfrac{1}{n}$。\n  - 含水量：$\\theta(h) = \\theta_r + S_e(h)\\left(\\theta_s - \\theta_r\\right)$，其中 $\\theta_r$ 是残余含水量，$\\theta_s$ 是饱和含水量。\n  - 导水率：$K(h) = K_s S_e(h)^{\\ell} \\left[1 - \\left(1 - S_e(h)^{1/m}\\right)^m\\right]^2$，其中 $K_s$ 是饱和导水率，$\\ell$ 是孔隙连通性参数。\n\n假设 $z$ 轴向下为正，地表处 $z=0$，底部 $z=L$。顶部边界为大气通量边界，具有给定的正弦 PE：\n$$\nE_p(t) = E_{\\mathrm{mean}} + E_{\\mathrm{amp}} \\sin\\left(\\dfrac{2\\pi t}{T}\\right),\n$$\n其中 $T = 86400\\,\\mathrm{s}$ 为一天。将向上的蒸发视为地表的负通量，因此施加的顶部边界通量为 $q(0,t) = -E_p(t)$。如果地表达到接近残余含水量的条件，使得 $\\theta(0,t) \\le \\theta_r$，则进一步的干燥会受到抑制，边界通量限制为 $q(0,t) = 0$。在底部，假设为自由排水，即单位重力梯度：$q(L,t) = K\\left(h(L,t)\\right)$。\n\n从上述基础出发，使用有限体积法推导一个对 $\\theta$ 质量守恒的离散化方案。也就是说，使用根据 Darcy–Buckingham 定律和 van Genuchten–Mualem 本构关系计算出的界面通量，来一致地近似通量的散度 $\\left(\\dfrac{\\partial q}{\\partial z}\\right)$。使用持水曲线所隐含的反演关系 $\\theta \\mapsto h$，在每个时间步从 $\\theta$ 获取 $h$。在单日内实现一个显式时间步进格式，并诊断干燥锋的形成，干燥锋定义为在时间 $t$ 满足 $S_e(h(z,t)) \\le S_{\\mathrm{thresh}}$ 的最深位置 $z_f(t)$。报告一天内的最大干燥锋深度 $\\max_{t \\in [0,T]} z_f(t)$。\n\n您的程序必须模拟以下测试套件，每个测试在 $T = 86400\\,\\mathrm{s}$ 内进行，使用在 $L=0.5\\,\\mathrm{m}$（深度）上分布的 $N=101$ 个节点的均匀网格，以及 $\\Delta t = 20\\,\\mathrm{s}$ 的显式时间步长。使用代表壤土的 van Genuchten–Mualem 参数：$\\alpha = 3.6\\,\\mathrm{m}^{-1}$，$n = 1.56$，$m = 1 - \\dfrac{1}{n}$，$\\theta_r = 0.078\\,\\mathrm{m}^3/\\mathrm{m}^3$，$\\theta_s = 0.43\\,\\mathrm{m}^3/\\mathrm{m}^3$，$K_s = 1.0 \\times 10^{-5}\\,\\mathrm{m/s}$，以及 $\\ell = 0.5$。初始条件是均匀的，由一个恒定的压力水头 $h_{\\mathrm{init}}$（负值）设定，并通过持水曲线转换为初始含水量。\n\n定义干燥阈值为 $S_{\\mathrm{thresh}} = 0.30$，地表通量限制为：如果 $\\theta(0,t) \\le \\theta_r + \\varepsilon$，其中 $\\varepsilon = 10^{-6}\\,\\mathrm{m}^3/\\mathrm{m}^3$，则设置 $q(0,t)=0$。四个测试案例如下：\n1. 案例 A（基线日变化需求）：$E_{\\mathrm{mean}} = 3.5\\times 10^{-8}\\,\\mathrm{m/s}$，$E_{\\mathrm{amp}} = 5.0\\times 10^{-8}\\,\\mathrm{m/s}$，$h_{\\mathrm{init}} = -0.5\\,\\mathrm{m}$。\n2. 案例 B（更强的午间需求）：$E_{\\mathrm{mean}} = 3.5\\times 10^{-8}\\,\\mathrm{m/s}$，$E_{\\mathrm{amp}} = 1.2\\times 10^{-7}\\,\\mathrm{m/s}$，$h_{\\mathrm{init}} = -0.5\\,\\mathrm{m}$。\n3. 案例 C（恒定需求）：$E_{\\mathrm{mean}} = 3.5\\times 10^{-8}\\,\\mathrm{m/s}$，$E_{\\mathrm{amp}} = 0.0\\,\\mathrm{m/s}$，$h_{\\mathrm{init}} = -0.5\\,\\mathrm{m}$。\n4. 案例 D（初始干燥剖面）：$E_{\\mathrm{mean}} = 3.5\\times 10^{-8}\\,\\mathrm{m/s}$，$E_{\\mathrm{amp}} = 5.0\\times 10^{-8}\\,\\mathrm{m/s}$，$h_{\\mathrm{init}} = -2.0\\,\\mathrm{m}$。\n\n您的程序必须为每个案例计算日最大干燥锋深度 $\\max_{t\\in [0,T]} z_f(t)$，以米为单位并四舍五入到三位小数。最终所需的输出格式是包含在方括号中的单行逗号分隔列表，例如 `[0.123,0.456,0.789,0.012]`。",
            "solution": "该问题要求实现一个数值模型，以模拟大气强迫下一维垂直土柱中的土壤水分动力学，并使用该模型确定几个测试案例在一天内的定义的干燥锋的最大深度。\n\n### 步骤1：问题验证\n\n已根据所需标准对问题陈述进行了严格评估。\n\n*   **提取给定条件**：所有控制方程（质量守恒、Darcy-Buckingham 定律）、本构关系（用于 $\\theta(h)$ 和 $K(h)$ 的 van Genuchten-Mualem 模型）、边界条件（顶部的正弦势能蒸发、底部的自由排水）、初始条件（均匀压力水头）、数值方案要求（有限体积法、显式时间步进）以及物理和数值参数均已按陈述提取。\n*   **验证评估**：\n    1.  **科学基础**：该问题基于 Richards 方程和 van Genuchten-Mualem 模型，这些是土壤物理学和水文学中的标准和基本框架。所有原理都已得到充分证实。\n    2.  **适定性**：该问题指定了一个偏微分方程及其适当的初始和边界条件，为瞬态模拟提供了完整的信息集。\n    3.  **客观性**：问题使用精确的数学语言陈述，没有主观性。\n    4.  **完整性与一致性**：所有必要的参数都已提供，并且它们的物理单位是一致的。该设置是自洽的。\n    5.  **数值稳定性**：一个值得注意的点是规定了采用固定时间步长 $\\Delta t = 20\\,\\mathrm{s}$ 的显式时间步进格式。用于高度非线性的 Richards 方程的显式格式受到严格的稳定性约束，通常需要非常小的时间步长。给定的 $\\Delta t$ 可能会超过指定网格分辨率和土壤参数的稳定性极限，可能导致数值振荡。然而，任务是按照描述实现指定的数值实验。这是指定数值方法的一个特点，而不是物理问题本身的无效性。获得的结果将是这种特定数值设置的后果。\n\n*   **结论**：该问题被认为是**有效的**，因为它构成了一个基于已建立的科学原理的、定义明确的数值任务。\n\n### 步骤2：数学和数值公式\n\n问题的核心是求解变饱和流的一维 Richards 方程，该方程结合了质量守恒定律和 Darcy-Buckingham 定律：\n$$\n\\frac{\\partial \\theta}{\\partial t} = -\\frac{\\partial q}{\\partial z} = \\frac{\\partial}{\\partial z} \\left[ K(h)\\left(\\frac{\\partial h}{\\partial z} - 1\\right) \\right]\n$$\n此处，$\\theta$ 是体积含水量，$t$ 是时间，$z$ 是垂直坐标（向下为正），$q$ 是水通量，$h$ 是压力水头，$K(h)$ 是非饱和导水率。$\\theta$ 和 $h$ 之间以及 $K$ 和 $h$ 之间的关系由 van Genuchten-Mualem (VGM) 本构关系给出。\n\n**2.1. 有限体积离散化**\n我们采用单元中心的有限体积法。深度为 $L$ 的土柱被离散为 $N-1$ 个单元，节点 $z_i$ 位于每个单元的中心。对于均匀网格，节点坐标为 $z_i = (i + 0.5)\\Delta z$，其中 $i=0, \\ldots, N-2$。然而，为了简化索引，使其直接映射到数组索引 $0, \\ldots, N-1$，我们定义 $N$ 个节点位于 $z_i = i \\cdot \\Delta z$ 的位置，其中 $i=0, \\ldots, N-1$ 且 $\\Delta z = L/(N-1)$。然后，我们考虑围绕这些节点的控制体积。对于内部节点 ($i=1, \\ldots, N-2$)，控制体积为 $[z_i - \\Delta z/2, z_i + \\Delta z/2]$，大小为 $\\Delta z$。对于边界节点，控制体积为半尺寸：顶部节点 ($i=0$) 为 $[z_0, z_0 + \\Delta z/2]$，底部节点 ($i=N-1$) 为 $[z_{N-1} - \\Delta z/2, z_{N-1}]$。\n\n对节点 $i$ 的控制体积 $V_i$ 积分质量守恒方程，得到：\n$$\n\\int_{V_i} \\frac{\\partial \\theta}{\\partial t} dV = - \\int_{V_i} \\frac{\\partial q}{\\partial z} dV\n$$\n近似空间平均值，得到每个节点含水量 $\\theta_i(t)$ 的半离散常微分方程 (ODE)：\n$$\n\\frac{d\\theta_i}{dt} V_i = q_{i-1/2} - q_{i+1/2}\n$$\n其中 $q_{i \\pm 1/2}$ 是控制体积界面处的通量。节点的方程为：\n*   内部节点 ($i=1, \\ldots, N-2$)，其中 $V_i = \\Delta z$：$\\dfrac{d\\theta_i}{dt} = \\dfrac{q_{i-1/2} - q_{i+1/2}}{\\Delta z}$\n*   顶部节点 ($i=0$)，其中 $V_0 = \\Delta z/2$：$\\dfrac{d\\theta_0}{dt} = \\dfrac{q_{\\text{top}} - q_{1/2}}{\\Delta z/2}$\n*   底部节点 ($i=N-1$)，其中 $V_{N-1} = \\Delta z/2$：$\\dfrac{d\\theta_{N-1}}{dt} = \\dfrac{q_{N-3/2} - q_{\\text{bottom}}}{\\Delta z/2}$\n\n**2.2. 通量近似**\n节点 $i$ 和 $i+1$ 之间的节间通量 $q_{i+1/2}$ 使用这些节点上的值来近似。压力水头梯度通过有限差分近似，界面导水率取为节点导水率的算术平均值：\n$$\nq_{i+1/2} = -K_{i+1/2} \\left[ \\left(\\frac{\\partial h}{\\partial z}\\right)_{i+1/2} - 1 \\right] \\approx -\\frac{K(h_i) + K(h_{i+1})}{2} \\left( \\frac{h_{i+1} - h_i}{\\Delta z} - 1 \\right)\n$$\n边界通量为：\n*   顶部通量 ($q_{\\text{top}}$)：$q(0,t) = -E_p(t) = -\\left[E_{\\mathrm{mean}} + E_{\\mathrm{amp}} \\sin\\left(\\frac{2\\pi t}{T}\\right)\\right]$，限制条件为：如果地表含水量 $\\theta_0$ 约等于残余含水量，即 $\\theta_0 \\le \\theta_r + \\varepsilon$，则 $q(0,t) = 0$。\n*   底部通量 ($q_{\\text{bottom}}$)：自由排水条件意味着单位重力梯度（即压力水头梯度 $\\partial h/\\partial z \\approx 0$）。根据向下为正坐标系的达西-白金汉定律 $q = -K(\\partial h/\\partial z - 1)$，这简化为 $q(L,t) \\approx K(h(L,t))$。因此，$q_{\\text{bottom}} = K(h_{N-1})$。\n\n**2.3. 显式时间积分**\n使用显式前向欧拉格式对常微分方程组进行时间积分：\n$$\n\\frac{\\theta_i^{k+1} - \\theta_i^k}{\\Delta t} = F_i(\\boldsymbol{\\theta}^k, \\boldsymbol{h}^k)\n$$\n其中 $F_i$ 表示离散化的空间算子（半离散方程的右侧）。完整的更新方程为：\n*   对于 $i=0$：$\\theta_0^{k+1} = \\theta_0^k + \\dfrac{\\Delta t}{\\Delta z/2} \\left( q_{\\text{top}}^k - q_{1/2}^k \\right)$\n*   对于 $i=1, \\ldots, N-2$：$\\theta_i^{k+1} = \\theta_i^k + \\dfrac{\\Delta t}{\\Delta z} \\left( q_{i-1/2}^k - q_{i+1/2}^k \\right)$\n*   对于 $i=N-1$：$\\theta_{N-1}^{k+1} = \\theta_{N-1}^k + \\dfrac{\\Delta t}{\\Delta z/2} \\left( q_{N-3/2}^k - q_{\\text{bottom}}^k \\right)$\n\n**2.4. 本构关系与反演**\n在每个时间步，根据水头 $h^k$ 计算通量后，我们将 $\\theta$ 更新为 $\\theta^{k+1}$。为了进入下一个时间步，我们必须找到对应的水头 $h^{k+1}$。这需要反演土壤持水曲线 $\\theta(h)$。\n给定 $\\theta = \\theta_r + S_e(\\theta_s - \\theta_r)$，我们找到有效饱和度 $S_e = \\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r}$。\n对于 $h \\le 0$，VGM 持水曲线为 $S_e(h) = \\left[1 + (\\alpha |h|)^n \\right]^{-m}$。其反函数为：\n$$\nh(\\theta) = -\\frac{1}{\\alpha} \\left[ \\left(\\frac{\\theta - \\theta_r}{\\theta_s - \\theta_r}\\right)^{-1/m} - 1 \\right]^{1/n}\n$$\n此表达式用于从 $\\theta^{k+1}$ 计算 $h^{k+1}$。对于接近 $\\theta_r$ 的 $\\theta$ 值需小心处理，因为此时嵌套项会趋于无穷大。在实现中，为防止数值错误，$\\theta$ 会被限制在 $[\\theta_r + \\delta, \\theta_s]$ 范围内，其中 $\\delta$ 是一个小的正数。\n\n### 步骤3：算法流程\n\n每个测试案例的模拟遵循以下步骤：\n1.  **初始化**：\n    *   设置空间网格 ($z_i$)、时间步长 ($t_k$) 和常数。\n    *   为所有 $i=0, \\ldots, N-1$ 设置初始压力水头剖面 $h_i^0 = h_{\\mathrm{init}}$。\n    *   使用 $\\theta(h)$ 函数从 $h_i^0$ 计算初始含水量剖面 $\\theta_i^0$。\n    *   将最大干燥锋深度 `max_depth` 初始化为 $0.0$。\n2.  **时间循环**：对于从 $0$ 到 $T$ 的每个时间步 $t_k$：\n    a.  计算所有节点的导水率 $K_i^k = K(h_i^k)$。\n    b.  使用当前时间步 $k$ 的水头和导水率值，计算所有通量：内部通量 $q_{i+1/2}^k$、顶部通量 $q_{\\text{top}}^k$ 和底部通量 $q_{\\text{bottom}}^k$。根据 $\\theta_0^k$ 应用地表通量限制。\n    c.  使用显式欧拉公式将所有节点的含水量更新至 $\\theta_i^{k+1}$。\n    d.  将新的含水量值 $\\theta_i^{k+1}$ 限制在物理现实范围内，例如 $[\\theta_r, \\theta_s]$，以确保稳定性和反演函数的有效性。\n    e.  通过对 $\\theta_i^{k+1}$ 应用反函数 $h(\\theta)$，计算新的压力水头剖面 $h_i^{k+1}$。\n    f.  **诊断干燥锋**：\n        i.  计算所有节点的有效饱和度 $S_e(h_i^{k+1})$。\n        ii. 找到所有满足 $S_e(h_j^{k+1}) \\le S_{\\mathrm{thresh}}$ 的节点索引 $j$ 的集合。\n        iii. 如果此集合非空，找到集合中的最大索引 $j_{\\max}$。当前的干燥锋深度为 $z_{j_{\\max}}$。\n        iv. 如果集合为空，则当前深度为 $0.0$。\n        v. 更新 `max_depth = max(max_depth, current_depth)`。\n3.  **结果**：循环结束后，`max_depth` 保存了整个模拟日内的最大干燥锋深度。该值被存储用于给定的测试案例。\n\n对问题中指定的所有四个测试案例重复此过程。最终输出是这些最大深度的列表，四舍五入到三位小数。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the soil moisture dynamics problem for four test cases.\n    \"\"\"\n\n    def run_simulation(E_mean, E_amp, h_init):\n        # --- Parameters and Constants ---\n        L = 0.5  # m, depth of soil column\n        N = 101  # number of nodes\n        T = 86400  # s, total simulation time (1 day)\n        dt = 20  # s, time step\n\n        # Loam soil parameters (van Genuchten-Mualem)\n        alpha = 3.6  # 1/m\n        n = 1.56\n        theta_r = 0.078  # m^3/m^3\n        theta_s = 0.43   # m^3/m^3\n        Ks = 1.0e-5    # m/s\n        l = 0.5        # pore-connectivity parameter\n        \n        m = 1.0 - 1.0 / n\n\n        # Boundary and simulation control\n        S_thresh = 0.30\n        surface_theta_limit_epsilon = 1.0e-6\n\n        # --- Grid and Time Setup ---\n        dz = L / (N - 1)\n        z = np.linspace(0, L, N)\n        num_steps = int(T / dt)\n\n        # --- Helper functions for constitutive relations ---\n        def get_Se_from_h(h):\n            # h is expected to be = 0\n            h_abs = np.abs(h)\n            return (1 + (alpha * h_abs)**n)**(-m)\n\n        def get_theta_from_h(h):\n            Se = get_Se_from_h(h)\n            return theta_r + Se * (theta_s - theta_r)\n\n        def get_K_from_h(h):\n            Se = get_Se_from_h(h)\n            # Add small epsilon to avoid log(0) or division by zero if Se is 0 or 1\n            Se_safe = np.clip(Se, 1e-9, 1.0 - 1e-9)\n            term1 = Se_safe**l\n            term2_base = 1 - (1 - Se_safe**(1/m))**m\n            term2 = term2_base**2\n            return Ks * term1 * term2\n\n        def get_h_from_theta(theta):\n            # Clamp theta to avoid math errors outside the valid range\n            theta_safe = np.clip(theta, theta_r + 1e-9, theta_s)\n            Se = (theta_safe - theta_r) / (theta_s - theta_r)\n            # Again, clip Se to avoid powers of zero or negative numbers\n            Se_safe = np.clip(Se, 1e-9, 1.0 - 1e-9)\n            term = Se_safe**(-1/m) - 1\n            # Ensure term is non-negative before taking the n-th root\n            term_safe = np.maximum(term, 0)\n            h = -1/alpha * (term_safe)**(1/n)\n            return h\n\n        # --- Initialization ---\n        h = np.full(N, h_init)\n        theta = get_theta_from_h(h)\n        \n        max_drying_front_depth = 0.0\n\n        # --- Time-stepping Loop ---\n        for k in range(num_steps):\n            t = k * dt\n\n            # 1. Calculate hydraulic properties at step k\n            K = get_K_from_h(h)\n\n            # 2. Calculate fluxes at step k\n            # Internal fluxes (at interfaces i+1/2)\n            K_half = 0.5 * (K[:-1] + K[1:])\n            dh_dz = (h[1:] - h[:-1]) / dz\n            q_half = -K_half * (dh_dz - 1)\n\n            # Top boundary flux\n            Ep = E_mean + E_amp * np.sin(2 * np.pi * t / T)\n            if theta[0] = theta_r + surface_theta_limit_epsilon:\n                q_top = 0.0\n            else:\n                q_top = -Ep\n            \n            # Bottom boundary flux (free drainage)\n            q_bottom = K[-1]\n\n            # 3. Update water content (theta) to step k+1 using explicit Euler\n            theta_new = np.copy(theta)\n            # Node 0 (half volume)\n            theta_new[0] += (dt / (dz / 2.0)) * (q_top - q_half[0])\n            # Internal nodes (full volume)\n            theta_new[1:-1] += (dt / dz) * (q_half[:-1] - q_half[1:])\n            # Node N-1 (half volume)\n            theta_new[-1] += (dt / (dz / 2.0)) * (q_half[-1] - q_bottom)\n\n            theta = theta_new\n\n            # 4. Update pressure head (h) for step k+1\n            # Clamp theta to physical bounds before inversion\n            theta = np.clip(theta, theta_r, theta_s)\n            h = get_h_from_theta(theta)\n\n            # 5. Diagnose drying front depth\n            Se_current = (theta - theta_r) / (theta_s - theta_r)\n            dry_indices = np.where(Se_current = S_thresh)[0]\n            \n            current_front_depth = 0.0\n            if dry_indices.size > 0:\n                # Deepest location is the z-coordinate of the last index found\n                current_front_depth = z[dry_indices[-1]]\n            \n            if current_front_depth > max_drying_front_depth:\n                max_drying_front_depth = current_front_depth\n\n        return max_drying_front_depth\n\n    # --- Test Cases ---\n    test_cases = [\n        # (E_mean, E_amp, h_init)\n        (3.5e-8, 5.0e-8, -0.5),  # Case A\n        (3.5e-8, 1.2e-7, -0.5),  # Case B\n        (3.5e-8, 0.0, -0.5),    # Case C\n        (3.5e-8, 5.0e-8, -2.0)   # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        E_mean, E_amp, h_init = case\n        result = run_simulation(E_mean, E_amp, h_init)\n        results.append(result)\n\n    # --- Final Output ---\n    # Round results to three decimal places and format as specified.\n    print(f\"[{','.join(f'{x:.3f}' for x in results)}]\")\n\nsolve()\n```"
        }
    ]
}