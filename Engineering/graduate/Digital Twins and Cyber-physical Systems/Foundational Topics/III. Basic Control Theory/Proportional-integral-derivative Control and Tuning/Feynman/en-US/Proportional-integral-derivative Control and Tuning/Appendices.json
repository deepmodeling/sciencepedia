{
    "hands_on_practices": [
        {
            "introduction": "This practice addresses a critical aspect of practical PID controller implementation: the transition from manual to automatic control. In real-world systems, such as a plant supervised by a Digital Twin, switching modes without careful state initialization can cause a sudden \"bump\" in the control signal, potentially damaging equipment or destabilizing the process. This exercise guides you through the first-principles derivation of the conditions for a bumpless transfer, requiring you to properly initialize the controller's integral term to ensure a smooth and safe transition .",
            "id": "4237286",
            "problem": "A Cyber-Physical System (CPS) using a Digital Twin (DT) supervises a single-input single-output plant. The plant has been operated in manual mode, where the actuator command is held at a constant value. At time $t = 0$, the mode is switched to automatic control governed by a Proportional-Integral-Derivative (PID) controller in parallel form with derivative action filtered by a first-order low-pass, defined by\n$$\nu(t) \\;=\\; K_{p}\\,e(t)\\;+\\;I(t)\\;+\\;K_{d}\\,v(t),\n$$\nwhere $e(t) = r(t) - y(t)$ is the tracking error between the setpoint $r(t)$ and the measured output $y(t)$, $I(t)$ is the integrator contribution to the control signal, and $v(t)$ is the filtered derivative of the error satisfying the first-order filter equation\n$$\nT_{f}\\,\\dot{v}(t) \\;+\\; v(t) \\;=\\; \\dot{e}(t).\n$$\nThe integrator contribution is generated by an internal state $\\xi(t)$ via $I(t) = K_{i}\\,\\xi(t)$ and $\\dot{\\xi}(t) = e(t)$ when the controller is in automatic mode. In manual mode, the PID is not driving the plant; however, the DT provides estimates of $e(t)$ and $\\dot{e}(t)$.\n\nTo avoid output discontinuities at the moment of switching, the automatic controller output $u(0^{+})$ must not introduce a jump relative to the manual command $u(0^{-})$ immediately prior to the switch. Compute, from first principles, the conditions under which bumpless transfer occurs at $t=0$ for this controller structure, and use them to design the integrator state initialization $\\xi(0^{+})$ such that the integrator contribution $I(0^{+})$ ensures a continuous control signal.\n\nAssume the following DT-observed quantities and controller parameters at $t=0$:\n- $u(0^{-}) = 3.1$ volts,\n- $r(0) = 2.0$ (same unit as $y$),\n- $y(0) = 1.7$ (same unit as $r$),\n- $\\dot{e}(0) = -0.4$ (same unit as $e$ per second),\n- $K_{p} = 3.0$,\n- $K_{i} = 2.0$,\n- $K_{d} = 0.5$,\n- $T_{f} = 0.05$ seconds.\n\nAssume the derivative filter state is initialized to avoid a jump in the derivative contribution by choosing $v(0^{+})$ consistent with the filter model and the DT estimate at $t=0$. Using these data, determine the numerical value of the required integrator contribution $I(0^{+})$ that achieves bumpless transfer. Round your final answer to four significant figures and express it in volts.",
            "solution": "The fundamental principle of bumpless transfer is to ensure the continuity of the control signal, $u(t)$, at the moment of switching from manual to automatic control. Let $t=0$ be the time of the switch. The condition for bumpless transfer is thus:\n$$\nu(0^{+}) = u(0^{-})\n$$\nwhere $u(0^{-})$ is the control signal value in manual mode immediately prior to the switch, and $u(0^{+})$ is the initial value of the control signal generated by the automatic PID controller immediately after the switch.\n\nThe problem provides the value of the manual control signal as $u(0^{-}) = 3.1$ volts.\n\nThe PID controller is defined in parallel form as $u(t) = K_{p}\\,e(t) + I(t) + K_{d}\\,v(t)$. At the instant $t=0^{+}$, the automatic controller's output is:\n$$\nu(0^{+}) = K_{p}\\,e(0^{+}) + I(0^{+}) + K_{d}\\,v(0^{+})\n$$\nTo achieve bumpless transfer, we must have $u(0^{-}) = K_{p}\\,e(0^{+}) + I(0^{+}) + K_{d}\\,v(0^{+})$. Our goal is to determine the required value of the integrator contribution, $I(0^{+})$, that satisfies this equation. This requires us to determine the values of the other terms at $t=0^{+}$.\n\nFirst, we determine the proportional term's contribution. The tracking error is $e(t) = r(t) - y(t)$. Assuming that the plant output $y(t)$ and the setpoint $r(t)$ are continuous functions of time at the switching instant (a standard assumption for physical systems and non-impulsive setpoint changes), we have $e(0^{+}) = e(0)$. The values at $t=0$ are given: $r(0) = 2.0$ and $y(0) = 1.7$. Therefore, the error at the time of switching is:\n$$\ne(0) = r(0) - y(0) = 2.0 - 1.7 = 0.3\n$$\nThe contribution from the proportional term is $K_{p}\\,e(0)$.\n\nSecond, we determine the derivative term's contribution. The filtered derivative of the error, $v(t)$, is governed by the differential equation $T_{f}\\,\\dot{v}(t) + v(t) = \\dot{e}(t)$. The problem states that the derivative filter state $v(0^{+})$ is to be initialized to be \"consistent with the filter model and the DT estimate at $t=0$\". This is a standard procedure to avoid an artificial 'kick' from the derivative term upon initialization. The most direct and common method for a smooth initialization is to set the filter's state equal to the current (unfiltered) value of the signal it is meant to be filtering. In this case, the input to the filter is $\\dot{e}(t)$, and the Digital Twin provides the estimate $\\dot{e}(0) = -0.4$. Thus, we initialize the filter state as:\n$$\nv(0^{+}) = \\dot{e}(0) = -0.4\n$$\nThis initialization implies that at $t=0$, the filter equation becomes $T_{f}\\,\\dot{v}(0^{+}) + \\dot{e}(0) = \\dot{e}(0)$, which leads to $T_{f}\\,\\dot{v}(0^{+}) = 0$. Since $T_{f} = 0.05 \\neq 0$, this means $\\dot{v}(0^{+}) = 0$. This corresponds to an optimally smooth start for the derivative filter, as its rate of change is initially zero.\n\nNow we can substitute the known quantities into the bumpless transfer condition and rearrange the equation to solve for the required integrator contribution, $I(0^{+})$:\n$$\nI(0^{+}) = u(0^{-}) - K_{p}\\,e(0) - K_{d}\\,v(0^{+})\n$$\nSubstituting $e(0) = r(0) - y(0)$ and $v(0^{+}) = \\dot{e}(0)$, we get the general design equation:\n$$\nI(0^{+}) = u(0^{-}) - K_{p}\\,(r(0) - y(0)) - K_{d}\\,\\dot{e}(0)\n$$\nWe now substitute the given numerical values:\n- $u(0^{-}) = 3.1$\n- $K_{p} = 3.0$\n- $r(0) = 2.0$\n- $y(0) = 1.7$\n- $K_{d} = 0.5$\n- $\\dot{e}(0) = -0.4$\n\nThe calculation is as follows:\n$$\nI(0^{+}) = 3.1 - (3.0) \\times (2.0 - 1.7) - (0.5) \\times (-0.4)\n$$\n$$\nI(0^{+}) = 3.1 - (3.0) \\times (0.3) - (-0.2)\n$$\n$$\nI(0^{+}) = 3.1 - 0.9 + 0.2\n$$\n$$\nI(0^{+}) = 2.4\n$$\nThe problem also asks to design the integrator state initialization $\\xi(0^{+})$. The relationship is given by $I(t) = K_{i}\\,\\xi(t)$. Therefore, at $t=0^{+}$:\n$$\n\\xi(0^{+}) = \\frac{I(0^{+})}{K_{i}}\n$$\nUsing the given value $K_{i} = 2.0$:\n$$\n\\xi(0^{+}) = \\frac{2.4}{2.0} = 1.2\n$$\nThis completes the design aspect of the problem. The final numerical answer required is the value for $I(0^{+})$, expressed in volts and rounded to four significant figures.\n\nThe calculated value is $I(0^{+}) = 2.4$. To express this with four significant figures, we write it as $2.400$.",
            "answer": "$$\\boxed{2.400}$$"
        },
        {
            "introduction": "Building on the theme of managing controller states, this practice explores integrator windup, a pervasive issue where actuator saturation degrades PID performance. When a large error persists, the integral term can grow excessively, and unwinding this accumulated value introduces significant delays once the error is resolved. This problem challenges you to connect a classical tuning method with the practical reality of actuator limits by calculating the integrator state boundary that signals the onset of windup, a key concept in designing anti-windup compensation schemes .",
            "id": "2731947",
            "problem": "A unity-feedback loop uses a Proportional-Integral-Derivative (PID) controller tuned by the Ziegler–Nichols (ZN) ultimate oscillation method. In the ultimate test with a proportional-only controller, sustained oscillations were observed at the ultimate gain $K_{u} = 8$ and ultimate period $T_{u} = 2.5\\,\\mathrm{s}$. The PID is implemented in the ideal parallel form, and the actuator saturates at an upper hard limit $u_{\\text{max}} = 4.5$ (in the actuator’s native units).\n\nAt an instant $t_{0}$ during a large setpoint change, the measured error and its time derivative are $e(t_{0}) = 0.8$ and $\\dot{e}(t_{0}) = -0.3\\,\\mathrm{s}^{-1}$, respectively. The derivative action is applied to the error signal. The controller employs an anti-windup back-calculation scheme with a finite tracking time constant $T_{t} > 0$.\n\nAssume standard Ziegler–Nichols rules based on $(K_{u}, T_{u})$ are used to determine the PID parameters, and assume the anti-windup back-calculation drives the internal integrator so that, at equilibrium under saturation, the internally computed unsaturated control equals the saturated actuator output. Under these conditions, determine the maximum value of the controller’s integrator state $x_{I,\\max}(t_{0})$ that is consistent with no windup at $t_{0}$, defined as the value of the integrator state for which the internally computed control equals $u_{\\text{max}}$ at $t_{0}$.\n\nExpress your final answer as a single real number in the units of “error-times-seconds” (for instance, if the error is in radians, the unit is $\\mathrm{rad}\\cdot\\mathrm{s}$). Round your answer to five significant figures.",
            "solution": "The task is to determine the maximum value of the controller's integrator state, denoted $x_{I,\\max}(t_{0})$, such that the controller's internally computed output is precisely at the saturation limit $u_{\\text{max}}$ at a given instant $t_{0}$.\n\nThe ideal parallel form of a PID controller is described by the equation for the unsaturated control output, $u_{\\text{unsat}}(t)$:\n$$u_{\\text{unsat}}(t) = K_{p} e(t) + K_{i} x_{I}(t) + K_{d} \\frac{de(t)}{dt}$$\nwhere $x_{I}(t)$ represents the integrator state, defined as $x_{I}(t) = \\int_{0}^{t} e(\\tau) d\\tau$. The parameters $K_{p}$, $K_{i}$, and $K_{d}$ are the proportional, integral, and derivative gains, respectively.\n\nThe problem states that the controller parameters are determined using the standard Ziegler-Nichols ultimate oscillation method rules for a PID controller. These rules are as follows:\n- Proportional gain: $K_{p} = 0.6 K_{u}$\n- Integral time constant: $T_{i} = 0.5 T_{u}$\n- Derivative time constant: $T_{d} = 0.125 T_{u}$\n\nThe gains $K_{i}$ and $K_{d}$ are related to $K_{p}$, $T_{i}$, and $T_{d}$ by the following standard definitions for the parallel form:\n- $K_{i} = \\frac{K_{p}}{T_{i}}$\n- $K_{d} = K_{p} T_{d}$\n\nWe are given the ultimate gain $K_{u} = 8$ and the ultimate period $T_{u} = 2.5\\,\\mathrm{s}$. We can now compute the controller parameters.\n$$K_{p} = 0.6 \\times 8 = 4.8$$\n$$T_{i} = 0.5 \\times 2.5\\,\\mathrm{s} = 1.25\\,\\mathrm{s}$$\n$$T_{d} = 0.125 \\times 2.5\\,\\mathrm{s} = 0.3125\\,\\mathrm{s}$$\n\nUsing these time constants, we compute the integral and derivative gains:\n$$K_{i} = \\frac{K_{p}}{T_{i}} = \\frac{4.8}{1.25\\,\\mathrm{s}} = 3.84\\,\\mathrm{s}^{-1}$$\n$$K_{d} = K_{p} T_{d} = 4.8 \\times 0.3125\\,\\mathrm{s} = 1.5\\,\\mathrm{s}$$\n\nThe condition for the system to be at the threshold of saturation at time $t_{0}$ is that the unsaturated control output equals the saturation limit $u_{\\text{max}}$.\n$$u_{\\text{unsat}}(t_{0}) = u_{\\text{max}}$$\n\nSubstituting the PID controller equation at $t_{0}$ with the integrator state being $x_{I,\\max}(t_0)$:\n$$K_{p} e(t_{0}) + K_{i} x_{I,\\max}(t_{0}) + K_{d} \\dot{e}(t_{0}) = u_{\\text{max}}$$\nWe must solve this equation for $x_{I,\\max}(t_{0})$.\n$$x_{I,\\max}(t_{0}) = \\frac{1}{K_{i}} \\left( u_{\\text{max}} - K_{p} e(t_{0}) - K_{d} \\dot{e}(t_{0}) \\right)$$\n\nNow, we substitute the known numerical values into this expression:\n- $u_{\\text{max}} = 4.5$\n- $e(t_{0}) = 0.8$\n- $\\dot{e}(t_{0}) = -0.3\\,\\mathrm{s}^{-1}$\n- $K_{p} = 4.8$\n- $K_{i} = 3.84\\,\\mathrm{s}^{-1}$\n- $K_{d} = 1.5\\,\\mathrm{s}$\n\nThe computation proceeds as follows:\n$$x_{I,\\max}(t_{0}) = \\frac{1}{3.84} \\left( 4.5 - (4.8)(0.8) - (1.5)(-0.3) \\right)$$\n$$x_{I,\\max}(t_{0}) = \\frac{1}{3.84} \\left( 4.5 - 3.84 + 0.45 \\right)$$\n$$x_{I,\\max}(t_{0}) = \\frac{1}{3.84} \\left( 1.11 \\right)$$\n$$x_{I,\\max}(t_{0}) = 0.2890625$$\nThe units are consistent, resulting in \"error-times-seconds\" as required.\n\nThe problem requires the answer to be rounded to five significant figures. The calculated value is $0.2890625$. The first five significant figures are $2, 8, 9, 0, 6$. The subsequent digit is $2$, which is less than $5$, so we round down.\n\nTherefore, the maximum value of the integrator state consistent with no windup is $0.28906$.",
            "answer": "$$\\boxed{0.28906}$$"
        },
        {
            "introduction": "This final practice moves beyond linear control into the realm of nonlinear systems, a core challenge in modern cyber-physical systems. For plants whose dynamics change with their operating point, a fixed-gain PID controller is often inadequate. This exercise tasks you with designing a gain-scheduled PID controller by systematically linearizing a nonlinear plant model at various operating points and then applying robust analysis techniques to verify the design's stability, providing a powerful methodology for extending PID control to a broader class of systems .",
            "id": "4237268",
            "problem": "Consider a single-input single-output nonlinear plant that exhibits smooth saturation, used as the physical component of a Digital Twin (a virtual replica used for analysis and control design). The plant dynamics are given by the differential equation\n$$\\dot{x}(t) = -a\\,x(t) + b\\,\\mathrm{sat}(u(t)), \\quad y(t) = x(t),$$\nwhere $a > 0$, $b > 0$, and the saturation is modeled by a smooth function\n$$\\mathrm{sat}(u) = u_{\\text{max}} \\tanh\\!\\left(\\frac{u}{u_{\\text{max}}}\\right),$$\nwith $u_{\\text{max}} > 0$.\n\nAt an operating point defined by a constant input $u^\\star$, the local slope of the saturation nonlinearity is the derivative of $\\mathrm{sat}(u)$ with respect to $u$ evaluated at $u^\\star$, namely\n$$\\alpha = \\left.\\frac{d}{du}\\,\\mathrm{sat}(u)\\right|_{u=u^\\star} = \\mathrm{sech}^2\\!\\left(\\frac{u^\\star}{u_{\\text{max}}}\\right),$$\nwhere $\\mathrm{sech}(z) = 1/\\cosh(z)$. At each operating point, the plant can be linearized to the transfer function\n$$G(s;\\alpha) = \\frac{b\\,\\alpha}{s + a}.$$\n\nDesign a gain-scheduled Proportional-Integral-Derivative (PID) controller\n$$C(s;\\alpha) = K_p(\\alpha) + \\frac{K_i(\\alpha)}{s} + K_d(\\alpha)\\,s,$$\nby deriving a method that, for each operating point characterized by $\\alpha$, assigns gains $K_p(\\alpha)$, $K_i(\\alpha)$, and $K_d(\\alpha)$ such that the closed-loop characteristic polynomial matches a desired second-order form with a specified damping ratio $0  \\zeta  1$ and a natural frequency schedule $\\omega_n(\\alpha)$, constructed from first principles without invoking any pre-derived tuning rule shortcuts. You must start from the closed-loop characteristic equation and equate normalized coefficients to the target second-order polynomial to derive $K_p(\\alpha)$ and $K_i(\\alpha)$ in terms of $\\zeta$, $\\omega_n(\\alpha)$, $a$, $b$, $\\alpha$, and a chosen constant $K_d(\\alpha) = K_d$ (i.e., use a constant derivative gain across the schedule).\n\nTo verify robustness, model the plant parameter variations as two independent multiplicative input uncertainties: one for the pole location parameter $a$ and one for the saturation slope mismatch $\\alpha$. That is, include two scalar uncertainty blocks $\\delta_a$ and $\\delta_\\alpha$, each bounded in magnitude by their respective uncertainty radii $\\epsilon_a$ and $\\epsilon_\\alpha$, and let both act as input multiplicative uncertainties with constant weights\n$W_a(j\\omega) = \\epsilon_a$ and $W_\\alpha(j\\omega) = \\epsilon_\\alpha$.\nUnder this structured uncertainty, the robust stability condition based on structured singular value (also known as the $\\mu$-analysis) reduces to checking whether\n$$\\sup_{\\omega \\in \\mathbb{R}_{\\ge 0}}\\,\\mu\\!\\left(M(j\\omega)\\right)  1,$$\nwhere the interconnection matrix is diagonal\n$$M(j\\omega) = \\begin{bmatrix} W_a(j\\omega)\\,T(j\\omega)  0 \\\\ 0  W_\\alpha(j\\omega)\\,T(j\\omega) \\end{bmatrix},$$\nand the complementary sensitivity function is\n$$T(j\\omega;\\alpha) = \\frac{L(j\\omega;\\alpha)}{1 + L(j\\omega;\\alpha)}, \\quad L(j\\omega;\\alpha) = C(j\\omega;\\alpha)\\,G(j\\omega;\\alpha).$$\nYou must compute the worst-case $\\mu$ across frequencies and across the provided operating points.\n\nYour program must:\n- Construct the gain schedule by deriving and applying the closed-loop coefficient matching method as specified.\n- Compute $T(j\\omega;\\alpha)$ over a log-spaced frequency grid spanning $10^{-3}$ to $10^{2}$ radians per second for each operating point.\n- Evaluate the structured singular value for the diagonal $M(j\\omega)$ defined above, which simplifies to\n$$\\mu\\!\\left(M(j\\omega)\\right) = \\max\\!\\left(\\left|W_a(j\\omega)\\,T(j\\omega)\\right|,\\;\\left|W_\\alpha(j\\omega)\\,T(j\\omega)\\right|\\right).$$\n- Report, for each test case, the maximal value of $\\mu$ over the frequency grid and over all specified operating points.\n\nUse the following three test cases, which together form the test suite:\n1. Happy path case with moderate uncertainties and modest derivative action:\n   - $a = 1.0$, $b = 1.0$, $u_{\\text{max}} = 1.0$,\n   - operating points $u^\\star \\in \\{0.2,\\,0.6,\\,1.0\\}$,\n   - damping ratio $\\zeta = 0.7$,\n   - natural frequency schedule $\\omega_n(\\alpha) = \\omega_0 \\sqrt{\\alpha}$ with $\\omega_0 = 3.0$ radians per second,\n   - constant derivative gain $K_d = 0.05$,\n   - uncertainty radii $\\epsilon_a = 0.2$, $\\epsilon_\\alpha = 0.1$.\n2. Boundary case with large uncertainties:\n   - same $a$, $b$, $u_{\\text{max}}$, operating points, $\\zeta$, and $\\omega_n(\\alpha)$ as case 1,\n   - constant derivative gain $K_d = 0.05$,\n   - uncertainty radii $\\epsilon_a = 1.5$, $\\epsilon_\\alpha = 1.5$.\n3. Edge case with stronger derivative action:\n   - same $a$, $b$, $u_{\\text{max}}$, operating points, $\\zeta$, and $\\omega_n(\\alpha)$ as case 1,\n   - constant derivative gain $K_d = 0.30$,\n   - uncertainty radii $\\epsilon_a = 0.2$, $\\epsilon_\\alpha = 0.1$.\n\nAngle and frequency units must be in radians. The maximal $\\mu$ values must be reported as decimal numbers rounded to three decimals.",
            "solution": "### Part 1: Derivation of Controller Gain-Scheduling Laws\n\nThe analysis begins with the linearized plant model and the PID controller structure. The plant's local dynamics around an operating point $u^\\star$ are described by the first-order transfer function:\n$$G(s;\\alpha) = \\frac{b\\,\\alpha}{s + a}$$\nwhere the parameter $\\alpha = \\mathrm{sech}^2(u^\\star/u_{\\text{max}})$ quantifies the slope of the saturation function at the operating point.\n\nThe PID controller is defined in the Laplace domain as:\n$$C(s;\\alpha) = K_p(\\alpha) + \\frac{K_i(\\alpha)}{s} + K_d s$$\nFor this design, the derivative gain $K_d(\\alpha)$ is a specified constant, $K_d$. The proportional gain $K_p(\\alpha)$ and integral gain $K_i(\\alpha)$ are functions of the operating point, $\\alpha$, which we must determine.\n\nThe closed-loop system's stability and performance are determined by the roots of its characteristic equation, $1 + L(s;\\alpha) = 0$, where $L(s;\\alpha) = C(s;\\alpha)G(s;\\alpha)$ is the open-loop transfer function.\n$$L(s;\\alpha) = \\left( \\frac{K_d s^2 + K_p(\\alpha) s + K_i(\\alpha)}{s} \\right) \\left( \\frac{b\\,\\alpha}{s + a} \\right) = \\frac{b\\,\\alpha(K_d s^2 + K_p(\\alpha) s + K_i(\\alpha))}{s(s+a)}$$\nSubstituting this into the characteristic equation yields $s(s+a) + b\\,\\alpha(K_d s^2 + K_p(\\alpha) s + K_i(\\alpha)) = 0$. Expanding and collecting terms by powers of $s$ gives the closed-loop characteristic polynomial, $P_{cl}(s)$:\n$$(1 + b\\,\\alpha K_d)s^2 + (a + b\\,\\alpha K_p(\\alpha))s + (b\\,\\alpha K_i(\\alpha)) = 0$$\nThe design objective is to make the closed-loop response match that of a canonical second-order system with a characteristic polynomial:\n$$P_{des}(s) = s^2 + 2\\zeta \\omega_n(\\alpha) s + \\omega_n^2(\\alpha)$$\nwhere $\\zeta$ is the desired damping ratio and $\\omega_n(\\alpha)$ is the natural frequency schedule.\n\nTo equate the two polynomials, we first normalize $P_{cl}(s)$ by dividing by its leading coefficient, $(1 + b\\,\\alpha K_d)$:\n$$s^2 + \\left(\\frac{a + b\\,\\alpha K_p(\\alpha)}{1 + b\\,\\alpha K_d}\\right)s + \\left(\\frac{b\\,\\alpha K_i(\\alpha)}{1 + b\\,\\alpha K_d}\\right) = 0$$\nBy equating the coefficients of this normalized polynomial with those of $P_{des}(s)$, we derive the expressions for the scheduled gains.\n\nEquating the coefficients of the $s^1$ term yields the gain-scheduling law for the proportional gain:\n$$K_p(\\alpha) = \\frac{2\\zeta \\omega_n(\\alpha) (1 + b\\,\\alpha K_d) - a}{b\\,\\alpha}$$\nEquating the coefficients of the $s^0$ term yields the gain-scheduling law for the integral gain:\n$$K_i(\\alpha) = \\frac{\\omega_n^2(\\alpha) (1 + b\\,\\alpha K_d)}{b\\,\\alpha}$$\nThese two equations provide the necessary formulas to compute the controller gains for any operating point $\\alpha$.\n\n### Part 2: Robust Stability Analysis via $\\mu$-Analysis\n\nThe robustness of the designed controller to parametric uncertainty is assessed using the structured singular value, $\\mu$. The uncertainty is modeled by two independent multiplicative blocks, $\\delta_a$ and $\\delta_\\alpha$, with magnitude bounds $\\epsilon_a$ and $\\epsilon_\\alpha$. The interconnection matrix for the $\\mu$-analysis is given as:\n$$M(j\\omega) = \\begin{bmatrix} W_a(j\\omega)\\,T(j\\omega;\\alpha)  0 \\\\ 0  W_\\alpha(j\\omega)\\,T(j\\omega;\\alpha) \\end{bmatrix}$$\nwhere $T(j\\omega;\\alpha)$ is the complementary sensitivity function, and $W_a(j\\omega) = \\epsilon_a$ and $W_\\alpha(j\\omega) = \\epsilon_\\alpha$ are constant uncertainty weights. The complementary sensitivity function is defined as:\n$$T(j\\omega;\\alpha) = \\frac{L(j\\omega;\\alpha)}{1 + L(j\\omega;\\alpha)}$$\nFor a block-diagonal matrix such as $M(j\\omega)$, the structured singular value $\\mu$ is simply the maximum magnitude of its diagonal entries.\n$$\\mu(M(j\\omega)) = \\max\\left(\\left|W_a(j\\omega) T(j\\omega;\\alpha)\\right|, \\left|W_\\alpha(j\\omega) T(j\\omega;\\alpha)\\right|\\right)$$\nSubstituting the constant weights $W_a(j\\omega) = \\epsilon_a$ and $W_\\alpha(j\\omega) = \\epsilon_\\alpha$:\n$$\\mu(M(j\\omega)) = \\max\\left(\\epsilon_a \\left|T(j\\omega;\\alpha)\\right|, \\epsilon_\\alpha \\left|T(j\\omega;\\alpha)\\right|\\right) = \\left|T(j\\omega;\\alpha)\\right| \\max(\\epsilon_a, \\epsilon_\\alpha)$$\nThe robust stability condition is satisfied if the peak value of $\\mu$ over all frequencies and all operating points is less than $1$. The task is to find this peak value, $\\sup_{\\alpha, \\omega} \\mu(M(j\\omega))$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the gain-scheduled PID design and robustness analysis problem.\n    \"\"\"\n    test_cases = [\n        # Case 1: Happy path\n        {\n            \"a\": 1.0, \"b\": 1.0, \"u_max\": 1.0,\n            \"u_star_values\": [0.2, 0.6, 1.0],\n            \"zeta\": 0.7, \"omega_0\": 3.0, \"K_d\": 0.05,\n            \"epsilon_a\": 0.2, \"epsilon_alpha\": 0.1,\n        },\n        # Case 2: Large uncertainties\n        {\n            \"a\": 1.0, \"b\": 1.0, \"u_max\": 1.0,\n            \"u_star_values\": [0.2, 0.6, 1.0],\n            \"zeta\": 0.7, \"omega_0\": 3.0, \"K_d\": 0.05,\n            \"epsilon_a\": 1.5, \"epsilon_alpha\": 1.5,\n        },\n        # Case 3: Stronger derivative action\n        {\n            \"a\": 1.0, \"b\": 1.0, \"u_max\": 1.0,\n            \"u_star_values\": [0.2, 0.6, 1.0],\n            \"zeta\": 0.7, \"omega_0\": 3.0, \"K_d\": 0.30,\n            \"epsilon_a\": 0.2, \"epsilon_alpha\": 0.1,\n        },\n    ]\n\n    results = []\n\n    # Define a high-resolution logarithmic frequency grid\n    omega_grid = np.logspace(-3, 2, 10000)\n    s = 1j * omega_grid\n\n    for case in test_cases:\n        a = case[\"a\"]\n        b = case[\"b\"]\n        u_max = case[\"u_max\"]\n        u_star_values = case[\"u_star_values\"]\n        zeta = case[\"zeta\"]\n        omega_0 = case[\"omega_0\"]\n        K_d = case[\"K_d\"]\n        epsilon_a = case[\"epsilon_a\"]\n        epsilon_alpha = case[\"epsilon_alpha\"]\n\n        max_mu_for_case = 0.0\n\n        for u_star in u_star_values:\n            # Step 1: Calculate operating point dependent parameter alpha\n            # alpha = sech^2(u_star / u_max)\n            alpha = (1.0 / np.cosh(u_star / u_max))**2\n\n            # Step 2: Calculate scheduled natural frequency\n            omega_n = omega_0 * np.sqrt(alpha)\n\n            # Step 3: Derive controller gains K_p and K_i based on pole placement\n            # K_i(alpha) = (omega_n(alpha)^2 * (1 + b*alpha*K_d)) / (b*alpha)\n            # K_p(alpha) = (2*zeta*omega_n(alpha)*(1 + b*alpha*K_d) - a) / (b*alpha)\n            # Both terms have a common denominator and a common factor in the numerator\n            common_numerator_factor = 1.0 + b * alpha * K_d\n            common_denominator = b * alpha\n\n            K_i = (omega_n**2 * common_numerator_factor) / common_denominator\n            K_p = (2 * zeta * omega_n * common_numerator_factor - a) / common_denominator\n\n            # Step 4: Evaluate transfer functions over the frequency grid\n            # Plant: G(s) = b*alpha / (s + a)\n            G_s = (b * alpha) / (s + a)\n            \n            # Controller: C(s) = K_p + K_i/s + K_d*s\n            C_s = K_p + K_i / s + K_d * s\n\n            # Loop transfer function: L(s) = C(s)G(s)\n            L_s = C_s * G_s\n\n            # Complementary sensitivity function: T(s) = L(s) / (1 + L(s))\n            T_s = L_s / (1.0 + L_s)\n\n            # Step 5: Compute the structured singular value mu\n            # mu(M(jw)) = |T(jw)| * max(epsilon_a, epsilon_alpha)\n            mu_values = np.abs(T_s) * max(epsilon_a, epsilon_alpha)\n            \n            # Find the peak mu for the current operating point\n            peak_mu_for_op_point = np.max(mu_values)\n\n            # Update the worst-case mu for the entire test case\n            if peak_mu_for_op_point > max_mu_for_case:\n                max_mu_for_case = peak_mu_for_op_point\n        \n        results.append(f\"{max_mu_for_case:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}