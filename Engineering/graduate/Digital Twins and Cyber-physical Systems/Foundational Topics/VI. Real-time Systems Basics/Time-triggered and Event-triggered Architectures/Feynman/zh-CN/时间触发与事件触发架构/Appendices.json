{
    "hands_on_practices": [
        {
            "introduction": "时间触发架构的基石是其确定性，而这种确定性源于一个静态构建的调度表。本练习将指导您亲手为一个谐波任务集创建一个非抢占式的时间触发调度表。通过计算超周期并精确分配时间槽，您将深入理解确定性是如何在这些系统中实现的，并学会量化系统的资源利用率与空闲时间。",
            "id": "4251650",
            "problem": "一个嵌入了数字孪生（DT）的网络物理系统（CPS）在单核处理器上执行静态时间触发的调度。时间基准是一个同步全局时钟，其时钟节拍为 $\\Delta t = 0.5\\,\\mathrm{ms}$，所有任务在时间 $t=0$ 同步释放。DT 的计算流水线由三个具有谐波周期的周期性任务 $\\tau_1$、$\\tau_2$ 和 $\\tau_3$ 组成。每个任务 $\\tau_k$ 由周期 $T_k$、最坏情况执行时间 $C_k$、释放偏移量 $O_k$ 和隐式截止时间 $D_k = T_k$ 来表征。参数如下：\n- $\\tau_1$：$T_1 = 5\\,\\mathrm{ms}$，$C_1 = 1\\,\\mathrm{ms}$，$O_1 = 0\\,\\mathrm{ms}$。\n- $\\tau_2$：$T_2 = 10\\,\\mathrm{ms}$，$C_2 = 1.5\\,\\mathrm{ms}$，$O_2 = 0\\,\\mathrm{ms}$。\n- $\\tau_3$：$T_3 = 20\\,\\mathrm{ms}$，$C_3 = 2\\,\\mathrm{ms}$，$O_3 = 0\\,\\mathrm{ms}$。\n\n假设执行是非抢占式的，处理器是单核的，并且每个调度时隙的开始和结束都与时钟节拍 $\\Delta t$ 对齐。所有作业的开始时间不得早于其释放时间，且完成时间不得晚于其隐式截止时间。在一个超周期内，使用以下策略构建一个确定性的时间触发调度表：在每个释放时间点，按周期 $T_k$ 严格递减的顺序（若周期相同则按任务索引递增的顺序打破平局）调度所有新释放的就绪作业，为每个作业分配不与任何已调度时隙重叠且遵守非抢占规则的最早开始时间。作业的开始时间不能早于其释放时间。\n\n从周期性任务系统的第一性原理和经过充分检验的谐波性与超周期的定义出发，确定：\n1. 超周期 $H$。\n2. 在 $[0,H)$ 区间内的有序时隙分配，表示为三元组 $(i,s,e)$，其中 $i \\in \\{1,2,3\\}$ 是任务索引，$s$ 和 $e$ 是时隙的开始和结束时间（单位为 $\\mathrm{ms}$）。\n3. 在 $[0,H)$ 区间内的总空闲时间 $S$。\n\n所有时间都以 $\\mathrm{ms}$ 表示。将最终答案以单行矩阵的形式给出，按顺序包含：$H$，然后是所有按 $s$ 递增排序的三元组 $(i,s,e)$ 序列，最后是 $S$。无需四舍五入。矩阵必须只包含数字；不要在矩阵内包含单位。",
            "solution": "用户提出的问题是一个定义明确的实时调度问题。它在科学上基于时间触发系统的原理，自成体系并包含所有必要的参数，且没有矛盾或含糊不清之处。因此，该问题被认为是有效的，并且可以构建一个解决方案。\n\n按照要求，解决方案分为三个部分推导：确定超周期、构建调度表和计算总空闲时间。\n\n**第一部分：超周期 $H$**\n\n一组周期性任务的超周期 $H$ 是它们周期的最小公倍数（LCM）。它表示作业释放模式开始重复的时间间隔。任务为 $\\tau_1$、$\\tau_2$ 和 $\\tau_3$，其周期分别为 $T_1 = 5\\,\\mathrm{ms}$、$T_2 = 10\\,\\mathrm{ms}$ 和 $T_3 = 20\\,\\mathrm{ms}$。\n\n问题陈述了这些周期是谐波的。这意味着对于任意两个任务 $\\tau_i$ 和 $\\tau_j$，如果 $T_i  T_j$，那么 $T_j$ 是 $T_i$ 的整数倍。我们可以验证这一点：$T_2 = 2 \\times T_1$ 且 $T_3 = 2 \\times T_2$。对于一组谐波周期，最小公倍数就是最大的那个周期。\n\n因此，超周期 $H$ 为：\n$$H = \\mathrm{lcm}(T_1, T_2, T_3) = \\mathrm{lcm}(5, 10, 20) = 20\\,\\mathrm{ms}$$\n\n调度将在时间区间 $[0, H)$ 上构建，即 $[0, 20)$。\n\n**第二部分：时间触发调度构建**\n\n调度是通过考虑超周期内每个不同释放时间点的事件来构建的。所有任务的偏移量均为 $O_k=0$，因此它们是同步释放的。每个任务 $\\tau_k$ 的释放时间为 $n \\times T_k$，其中 $n$ 为非负整数，且满足 $n \\times T_k  H$。\n- $\\tau_1$ ($T_1=5$)：在 $t=0, 5, 10, 15$ 时释放。\n- $\\tau_2$ ($T_2=10$)：在 $t=0, 10$ 时释放。\n- $\\tau_3$ ($T_3=20$)：在 $t=0$ 时释放。\n\n不同的释放时间点为 $t=0, 5, 10, 15$。我们按时间顺序构建调度。设调度为一组已占用的时间区间。\n\n**时间 $t=0\\,\\mathrm{ms}$：**\n来自所有三个任务（$\\tau_1, \\tau_2, \\tau_3$）的作业被释放。我们将任务 $\\tau_i$ 的第 $j$ 个作业表示为 $\\tau_{i,j}$。释放的作业是 $\\tau_{1,1}$、$\\tau_{2,1}$ 和 $\\tau_{3,1}$。\n调度策略要求按周期 $T_k$ 严格递减的顺序对它们进行排序。\n顺序是：$\\tau_{3,1}$ ($T_3=20$)，然后是 $\\tau_{2,1}$ ($T_2=10$)，然后是 $\\tau_{1,1}$ ($T_1=5$)。\n\n1.  **调度 $\\tau_{3,1}$ ($C_3 = 2\\,\\mathrm{ms}$):**\n    最早可用的开始时间 $s \\ge 0$ 是 $s=0$。时隙为 $[0, 2)$。\n    - 分配：$(i=3, s=0, e=2)$。\n    - $\\tau_{3,1}$ 的截止时间是 $D_3=20$。在 $t=2$ 时完成，满足 $t=2 \\le 20$。满足要求。\n\n2.  **调度 $\\tau_{2,1}$ ($C_2 = 1.5\\,\\mathrm{ms}$):**\n    不与 $[0, 2)$ 重叠的最早可用开始时间 $s \\ge 0$ 是 $s=2$。时隙为 $[2, 3.5)$。\n    - 分配：$(i=2, s=2, e=3.5)$。\n    - $\\tau_{2,1}$ 的截止时间是 $D_2=10$。在 $t=3.5$ 时完成，满足 $t=3.5 \\le 10$。满足要求。\n\n3.  **调度 $\\tau_{1,1}$ ($C_1 = 1\\,\\mathrm{ms}$):**\n    不与 $[0, 2)$ 或 $[2, 3.5)$ 重叠的最早可用开始时间 $s \\ge 0$ 是 $s=3.5$。时隙为 $[3.5, 4.5)$。\n    - 分配：$(i=1, s=3.5, e=4.5)$。\n    - $\\tau_{1,1}$ 的截止时间是 $D_1=5$。在 $t=4.5$ 时完成，满足 $t=4.5 \\le 5$。满足要求。\n\n**时间 $t=5\\,\\mathrm{ms}$：**\n一个新作业 $\\tau_{1,2}$ 被释放。它是唯一的新作业。\n1.  **调度 $\\tau_{1,2}$ ($C_1 = 1\\,\\mathrm{ms}$):**\n    不与现有时间片重叠且 $s \\ge 5$ 的最早可用开始时间是 $s=5$。时隙为 $[5, 6)$。\n    - 分配：$(i=1, s=5, e=6)$。\n    - $\\tau_{1,2}$ 的截止时间是 $5+D_1=10$。在 $t=6$ 时完成，满足 $t=6 \\le 10$。满足要求。\n\n**时间 $t=10\\,\\mathrm{ms}$：**\n新作业 $\\tau_{1,3}$ 和 $\\tau_{2,2}$ 被释放。\n调度顺序（按周期递减）是 $\\tau_{2,2}$ ($T_2=10$)，然后是 $\\tau_{1,3}$ ($T_1=5$)。\n\n1.  **调度 $\\tau_{2,2}$ ($C_2 = 1.5\\,\\mathrm{ms}$):**\n    最早可用的开始时间 $s \\ge 10$ 是 $s=10$。时隙为 $[10, 11.5)$。\n    - 分配：$(i=2, s=10, e=11.5)$。\n    - $\\tau_{2,2}$ 的截止时间是 $10+D_2=20$。在 $t=11.5$ 时完成，满足 $t=11.5 \\le 20$。满足要求。\n\n2.  **调度 $\\tau_{1,3}$ ($C_1 = 1\\,\\mathrm{ms}$):**\n    不与 $[10, 11.5)$ 重叠的最早可用开始时间 $s \\ge 10$ 是 $s=11.5$。时隙为 $[11.5, 12.5)$。\n    - 分配：$(i=1, s=11.5, e=12.5)$。\n    - $\\tau_{1,3}$ 的截止时间是 $10+D_1=15$。在 $t=12.5$ 时完成，满足 $t=12.5 \\le 15$。满足要求。\n\n**时间 $t=15\\,\\mathrm{ms}$：**\n一个新作业 $\\tau_{1,4}$ 被释放。它是唯一的新作业。\n1.  **调度 $\\tau_{1,4}$ ($C_1 = 1\\,\\mathrm{ms}$):**\n    最早可用的开始时间 $s \\ge 15$ 是 $s=15$。时隙为 $[15, 16)$。\n    - 分配：$(i=1, s=15, e=16)$。\n    - $\\tau_{1,4}$ 的截止时间是 $15+D_1=20$。在 $t=16$ 时完成，满足 $t=16 \\le 20$。满足要求。\n\n这就完成了超周期 $[0, 20)$ 内的调度。所有的时隙开始时间（$s$）和结束时间（$e$）都是时钟节拍 $\\Delta t = 0.5\\,\\mathrm{ms}$ 的倍数，符合要求。\n\n最终的有序时隙分配，以三元组 $(i,s,e)$ 列表形式给出，并按开始时间 $s$ 递增排序，如下所示：\n1.  $(3, 0, 2)$\n2.  $(2, 2, 3.5)$\n3.  $(1, 3.5, 4.5)$\n4.  $(1, 5, 6)$\n5.  $(2, 10, 11.5)$\n6.  $(1, 11.5, 12.5)$\n7.  $(1, 15, 16)$\n\n**第三部分：总空闲时间 $S$**\n\n总空闲时间 $S$ 是指在一个超周期内处理器处于空闲状态的总时间。这可以通过从超周期时长 $H$ 中减去超周期内所有作业的总执行时间来计算。\n\n首先，我们确定在 $[0, H)$ 内每个任务 $\\tau_k$ 的作业数量 $N_k$：\n- $N_1 = H / T_1 = 20 / 5 = 4$\n- $N_2 = H / T_2 = 20 / 10 = 2$\n- $N_3 = H / T_3 = 20 / 20 = 1$\n\n总执行时间 $C_{\\text{total}}$ 是所有这些作业的执行时间之和：\n$$C_{\\text{total}} = N_1 C_1 + N_2 C_2 + N_3 C_3$$\n$$C_{\\text{total}} = (4 \\times 1\\,\\mathrm{ms}) + (2 \\times 1.5\\,\\mathrm{ms}) + (1 \\times 2\\,\\mathrm{ms})$$\n$$C_{\\text{total}} = 4 + 3 + 2 = 9\\,\\mathrm{ms}$$\n这也等同于总利用率 $U$ 乘以超周期 $H$：\n$$U = \\sum_{k=1}^3 \\frac{C_k}{T_k} = \\frac{1}{5} + \\frac{1.5}{10} + \\frac{2}{20} = 0.2 + 0.15 + 0.1 = 0.45$$\n$$C_{\\text{total}} = U \\times H = 0.45 \\times 20 = 9\\,\\mathrm{ms}$$\n\n总空闲时间 $S$ 为：\n$$S = H - C_{\\text{total}} = 20\\,\\mathrm{ms} - 9\\,\\mathrm{ms} = 11\\,\\mathrm{ms}$$\n\n最终答案将 $H$、调度三元组 $(i,s,e)$ 序列和 $S$ 组合成一个单一的结构。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n20  3  0  2  2  2  3.5  1  3.5  4.5  1  5  6  2  10  11.5  1  11.5  12.5  1  15  16  11\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "与时间触发架构不同，事件触发系统提供了更高的灵活性和响应能力，但也引入了新的挑战，尤其是在管理共享资源时。本问题将引导您分析一个经典的实时系统失效模式：优先级反转。通过追踪一个高优先级任务如何因资源争用而被低优先级任务阻塞，并最终错过其截止时间，您将学会识别并解决这一关键风险，确保事件触发系统的可靠性。",
            "id": "4251617",
            "problem": "在一个信息物理系统中，一个事件触发（ET）控制器通过固定优先级抢占式调度实现，并使用一个共享互斥锁保护资源 $R$。内核中没有资源访问协议（没有优先级继承或优先级天花板）。部署了三个周期性任务，其释放在指定时间由外部事件驱动。任务参数如下（截止时间是相对于释放时间的）：\n- 高优先级任务 $\\tau_H$：周期 $T_H = 10$ ms，截止时间 $D_H = 10$ ms，最坏情况执行时间 $C_H = 2$ ms，其执行过程中包含一个长度为 $\\ell_H = 1$ ms 的访问资源 $R$ 的临界区。\n- 中优先级任务 $\\tau_M$：周期 $T_M = 15$ ms，截止时间 $D_M = 15$ ms，最坏情况执行时间 $C_M = 6$ ms，不使用 $R$。\n- 低优先级任务 $\\tau_L$：周期 $T_L = 50$ ms，截止时间 $D_L = 50$ ms，最坏情况执行时间 $C_L = 8$ ms，在 $\\tau_L$ 开始执行 $1$ ms 后，有一个长度为 $\\ell_L = 3$ ms 的访问 $R$ 的临界区。\n\n假设 $\\tau_L$ 的首次释放在 $t=0$，而 $\\tau_H$ 和 $\\tau_M$ 的首次释放在 $t=2$。ET 调度器分派具有最高静态优先级的就绪任务，任务是可抢占的，除非任务持有互斥锁（由于没有实现协议，在该内核中持有互斥锁时抢占仍然是被允许的）。\n\n一个在时间自动机模型检查器中建立的该系统模型将截止时间编码为时钟，并验证安全性属性 $A\\,\\Box(\\text{no\\_deadline\\_miss})$，意为“在所有路径上，总是没有截止时间未满足的情况”。\n\n仅使用固定优先级可调度性理论和实时系统中互斥的基础定义，选择同时满足以下两点的选项：\n- 给出了一个具体的反例执行轨迹，其中 $\\tau_H$ 因优先级反转而未满足其截止时间，并且\n- 提出了一个最小修复方案，并通过最坏情况响应时间的推理和对同一模型检查的重新运行来证明该修复方案在相同工作负载下消除了违规。\n\n选项：\n\nA. 反例轨迹：在 $t=2$ 时，$\\tau_M$ 抢占 $\\tau_L$ 并因资源 $R$ 上的优先级反转直接阻塞 $\\tau_H$，导致 $\\tau_H$ 在 $t=12$ 时未满足其截止时间。修复方案：切换到非抢占式内核，以便低优先级任务能运行至完成，从而消除所有反转；模型检查随后显示没有截止时间未满足的情况。\n\nB. 反例轨迹：$\\tau_L$ 在 $t=0$ 开始；它在 $t=1$ 获取 $R$ 并且如果不被中断将持有它 $\\ell_L = 3$ ms。在 $t=2$ 时，$\\tau_H$ 和 $\\tau_M$ 都被释放。$\\tau_H$ 尝试锁定 $R$ 并被 $\\tau_L$ 阻塞。内核没有提升 $\\tau_L$ 的优先级，因此 $\\tau_M$ 从 $t=2$ 到 $t=8$ 抢占 $\\tau_L$ 以执行其 $C_M = 6$ ms。然后 $\\tau_L$ 恢复执行，在 $t=11$ 完成其临界区并释放 $R$。$\\tau_H$ 获取 $R$ 并在 $t=13$ 完成，错过了它在 $t=12$ 的截止时间。修复方案：在 $R$ 上启用优先级继承。那么 $\\tau_H$ 的最大阻塞时间为 $B_H = \\ell_L = 3$ ms，并且由于没有比 $\\tau_H$ 更高优先级的任务，其最坏情况响应时间满足 $R_H = C_H + B_H = 2 + 3 = 5  D_H = 10$。使用优先级继承重新运行相同的模型检查，得到 $A\\,\\Box(\\text{no\\_deadline\\_miss})$ 为真，且没有反例。\n\nC. 反例轨迹：$\\tau_L$ 对 $R$ 的使用从未与 $\\tau_H$ 重叠，但 $\\tau_H$ 仍然因为从 $t=2$ 到 $t=5$ 对 $R$ 进行忙等待而未满足其截止时间。修复方案：采用优先级天花板协议；新的最坏情况响应时间为 $R_H = C_H + \\ell_H = 2 + 1 = 3  10$，因此截止时间得以满足，模型检查证实了该属性。\n\nD. 反例轨迹：如果 $\\tau_H$ 在 $\\tau_L$ 执行时于 $t=9$ 释放，它可能会未满足其截止时间；系统因抖动而不稳定。修复方案：将系统转换为一个时间触发的静态表，其中为 $\\tau_H$ 分配 $2$ ms 的槽，为 $\\tau_M$ 分配 $6$ ms 的槽，为 $\\tau_L$ 分配 $8$ ms 的槽；固定的时间表消除了干扰，因此截止时间得以满足，模型检查保持不变。\n\n哪个选项是正确的？",
            "solution": "用户希望我验证并解决一个关于信息物理系统中实时调度的问题。\n\n### 步骤 1：提取已知条件\n\n- **系统：** 采用固定优先级抢占式调度的事件触发（ET）控制器。\n- **资源管理：** 一个共享互斥锁保护资源 $R$。内核中未实现资源访问协议（例如，优先级继承、优先级天花板）。\n- **抢占规则：** 即使任务持有互斥锁，也允许抢占。\n- **任务集：**\n    - **$\\tau_H$（高优先级）：** 周期 $T_H = 10$ ms，截止时间 $D_H = 10$ ms，最坏情况执行时间（WCET）$C_H = 2$ ms。它有一个长度为 $\\ell_H = 1$ ms 的访问 $R$ 的临界区。\n    - **$\\tau_M$（中优先级）：** 周期 $T_M = 15$ ms，截止时间 $D_M = 15$ ms，WCET $C_M = 6$ ms。它不使用资源 $R$。\n    - **$\\tau_L$（低优先级）：** 周期 $T_L = 50$ ms，截止时间 $D_L = 50$ ms，WCET $C_L = 8$ ms。它有一个长度为 $\\ell_L = 3$ ms 的访问 $R$ 的临界区，该临界区在 $\\tau_L$ 开始执行 $1$ ms 后开始。\n- **初始释放时间：**\n    - $\\tau_L$ 在 $t=0$ ms 释放。\n    - $\\tau_H$ 和 $\\tau_M$ 在 $t=2$ ms 释放。\n- **验证上下文：** 使用一个时间自动机模型检查器来验证属性 $A\\,\\Box(\\text{no\\_deadline\\_miss})$，该属性断言在任何执行路径上都不会有截止时间未满足的情况。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n问题陈述在科学上基于既定的实时系统理论，涵盖了固定优先级抢占式调度、互斥和优先级反转等概念。参数定义明确且数值一致。所描述的场景——一个高优先级任务被一个低优先级任务阻塞，而这个低优先级任务又被一个中优先级任务抢占——是用来解释无界优先级反转的经典案例。\n\n问题要求一个 $\\tau_H$ 未满足其截止时间的反例轨迹。为了使这个问题成立，这种未满足情况必须在给定条件下发生。让我们分析一下时间线。截止时间未满足可以被严格定义（完成时间 $T_c \\geq T_{deadline}$）或非严格定义（$T_c > T_{deadline}$）。我们将采用在安全关键系统中常见的严格定义，即在截止时间瞬间完成也构成未满足。$\\tau_H$ 第一个实例的绝对截止时间是 $t = 2 \\text{ ms} + 10 \\text{ ms} = 12 \\text{ ms}$。\n\n对执行轨迹（在下一节中推导）的分析表明，$\\tau_H$ 在 $t=12$ ms 完成。在严格的截止时间定义下，这是一个未满足。因此，问题的前提——即发生截止时间未满足——是有效的。因此，该问题在科学上是合理的、客观的、提法得当的，并包含足够的信息以进行严格分析。\n\n**结论：** 问题是 **有效的**。\n\n### 步骤 3：推导反例和解决方案\n\n我们将构建一个执行轨迹（甘特图）来展示 $\\tau_H$ 的截止时间未满足情况。优先级为 $\\tau_H > \\tau_M > \\tau_L$。\n\n1.  **时间段 $[0 \\text{ ms}, 1 \\text{ ms})$：** 在 $t=0$ 时，$\\tau_L$ 被释放。由于它是唯一就绪的任务，它开始执行。它运行了 $1$ ms。\n2.  **在 $t=1$ ms：** 执行了 $1$ ms 后，$\\tau_L$ 进入其临界区并获取资源 $R$ 的互斥锁。\n3.  **时间段 $[1 \\text{ ms}, 2 \\text{ ms})$：** $\\tau_L$ 继续执行，此时在其临界区内。它又运行了 $1$ ms。在 $t=2$ ms 时，它已经完成了其 $3$ ms 临界区中的 $1$ ms。\n4.  **在 $t=2$ ms：** 任务 $\\tau_H$ 和 $\\tau_M$ 被释放。调度器评估就绪任务。\n    - $\\tau_H$ 具有最高优先级。我们假设最坏情况，即它立即需要资源 $R$。由于 $R$ 被 $\\tau_L$ 持有，$\\tau_H$ 被阻塞。\n    - 调度器接着考虑下一个最高优先级的就绪任务，即 $\\tau_M$。因为内核没有资源访问协议，$\\tau_L$ 的优先级没有被提升。因此，$\\tau_M$ 抢占 $\\tau_L$。\n5.  **时间段 $[2 \\text{ ms}, 8 \\text{ ms})$：** $\\tau_M$ 执行其完整的 WCET，即 $C_M = 6$ ms。在这整个时间段内，$\\tau_H$ 因等待 $\\tau_L$ 而被阻塞，而 $\\tau_L$ 被 $\\tau_M$ 抢占。这是典型的**优先级反转**场景：一个中优先级任务正在延迟一个高优先级任务。\n6.  **在 $t=8$ ms：** $\\tau_M$ 完成。调度器发现 $\\tau_H$ 仍被阻塞。此时可运行的最高优先级任务是 $\\tau_L$。\n7.  **时间段 $[8 \\text{ ms}, 10 \\text{ ms})$：** $\\tau_L$ 恢复执行。它需要完成其临界区剩余的 $\\ell_L - 1 \\text{ ms} = 3 - 1 = 2$ ms。它运行这 $2$ ms。\n8.  **在 $t=10$ ms：** $\\tau_L$ 完成其临界区并释放 $R$ 的互斥锁。此操作解除了 $\\tau_H$ 的阻塞。\n9.  **在 $t=10$ ms（调度器动作）：** $\\tau_H$ 变为就绪状态，并作为最高优先级的任务，立即抢占 $\\tau_L$。\n10. **时间段 $[10 \\text{ ms}, 12 \\text{ ms})$：** $\\tau_H$ 执行其 WCET，即 $C_H = 2$ ms。\n11. **在 $t=12$ ms：** $\\tau_H$ 完成其执行。\n\n**对 $\\tau_H$ 的截止时间分析：**\n- 释放时间：$t_{release} = 2$ ms。\n- 相对截止时间：$D_H = 10$ ms。\n- 绝对截止时间：$t_{deadline} = 2 + 10 = 12$ ms。\n- 完成时间：$t_{completion} = 12$ ms。\n\n由于完成时间等于绝对截止时间，在严格的截止时间定义（成功需满足 $t_{completion}  t_{deadline}$）下，截止时间未被满足。即使在非严格定义（$t_{completion} \\le t_{deadline}$）下，这种情况也代表了一个由优先级反转直接导致的、裕度为零的关键故障。$\\tau_H$ 所遭受的优先级反转阻塞的持续时间是 $\\tau_M$ 的执行时间，总计 $6$ ms。\n\n### 选项评估\n\n让我们基于此分析评估每个选项。\n\n**A. 反例轨迹：在 $t=2$ 时，$\\tau_M$ 抢占 $\\tau_L$ 并因资源 $R$ 上的优先级反转直接阻塞 $\\tau_H$，导致 $\\tau_H$ 在 $t=12$ 时未满足其截止时间。修复方案：切换到非抢占式内核，以便低优先级任务能运行至完成，从而消除所有反转；模型检查随后显示没有截止时间未满足的情况。**\n\n- **反例分析：** ‘$\\tau_M$ ... 直接阻塞 $\\tau_H$’的说法不精确。是 $\\tau_L$ 通过持有互斥锁直接阻塞了 $\\tau_H$。$\\tau_M$ 造成了反转，延长了阻塞时间。\n- **修复方案分析：** 切换到非抢占式内核是一个剧烈的改变，而非最小修复方案。它用可能很长的非抢占式阻塞取代了抢占式干扰和优先级反转。虽然它可能对这个特定场景有效，但其‘消除所有反转’的说法是错误的；它只是用一种类型的阻塞取代了另一种。例如，如果 $\\tau_H$ 在 $\\tau_L$ 刚开始后到达，它将被阻塞 $\\tau_L$ 整个剩余执行时间。\n- **结论：** **不正确**。推理不精确，且对修复方案的论证存在缺陷。\n\n**B. 反例轨迹：$\\tau_L$ 在 $t=0$ 开始；它在 $t=1$ 获取 $R$ 并且如果不被中断将持有它 $\\ell_L = 3$ ms。在 $t=2$ 时，$\\tau_H$ 和 $\\tau_M$ 都被释放。$\\tau_H$ 尝试锁定 $R$ 并被 $\\tau_L$ 阻塞。内核没有提升 $\\tau_L$ 的优先级，因此 $\\tau_M$ 从 $t=2$ 到 $t=8$ 抢占 $\\tau_L$ 以执行其 $C_M = 6$ ms。然后 $\\tau_L$ 恢复执行，在 $t=11$ 完成其临界区并释放 $R$。$\\tau_H$ 获取 $R$ 并在 $t=13$ 完成，错过了它在 $t=12$ 的截止时间。修复方案：在 $R$ 上启用优先级继承。那么 $\\tau_H$ 的最大阻塞时间为 $B_H = \\ell_L = 3$ ms，并且由于没有比 $\\tau_H$ 更高优先级的任务，其最坏情况响应时间满足 $R_H = C_H + B_H = 2 + 3 = 5  D_H = 10$。使用优先级继承重新运行相同的模型检查，得到 $A\\,\\Box(\\text{no\\_deadline\\_miss})$ 为真，且没有反例。**\n\n- **反例分析：** 导致优先级反转的事件描述完全正确。然而，轨迹中有一个微小的数值错误：我的分析显示 $\\tau_L$ 在 $t=8$ 恢复，并运行其剩余的 $2$ ms 临界区，在 $t=10$ 释放锁。该选项称其在 $t=11$ 释放锁。因此，它声称 $\\tau_H$ 在 $t=13$ 而不是 $t=12$ 完成。尽管存在这个计算失误，但对优先级反转现象的核心定性描述以及截止时间未满足的结论是正确的。\n- **修复方案分析：** 提议的修复方案，优先级继承（PI），是解决此问题的标准最小方案。当 $\\tau_H$ 因 $\\tau_L$ 而阻塞时，PI 会将 $\\tau_L$ 的优先级提升到与 $\\tau_H$ 相同，从而防止 $\\tau_M$ 抢占它。这将限制阻塞时间。\n- **论证分析：** 诉诸最坏情况响应时间分析（RTA）是正确的。对于最高优先级的任务 $\\tau_H$，其响应时间为 $R_H = C_H + B_H$。使用 PI，最大阻塞时间 $B_H$ 受限于任何较低优先级任务的最长临界区，即 $\\ell_L = 3$ ms。因此，最坏情况响应时间变为 $R_H = 2 \\text{ ms} + 3 \\text{ ms} = 5 \\text{ ms}$。由于 $5 \\text{ ms}  D_H = 10 \\text{ ms}$，可以保证满足截止时间。关于模型检查器结果的结论在逻辑上也是正确的。\n- **结论：** **正确**。尽管轨迹时间线中有一个微小的数值错误，但该选项正确地识别了现象（优先级反转），提出了标准的最小修复方案（优先级继承），并使用响应时间分析提供了健全且理论上正确的论证。\n\n**C. 反例轨迹：$\\tau_L$ 对 $R$ 的使用从未与 $\\tau_H$ 重叠，但 $\\tau_H$ 仍然因为从 $t=2$ 到 $t=5$ 对 $R$ 进行忙等待而未满足其截止时间。修复方案：采用优先级天花板协议；新的最坏情况响应时间为 $R_H = C_H + \\ell_H = 2 + 1 = 3  10$，因此截止时间得以满足，模型检查证实了该属性。**\n\n- **反例分析：** ‘$\\tau_L$ 对 $R$ 的使用从未与 $\\tau_H$ 重叠’的前提在给定场景中是事实错误的。在 $t=2$ 时，当 $\\tau_H$ 释放时，$\\tau_L$ 正持有 $R$ 的锁。\n- **修复方案分析：** 优先级天花板协议（PCP）确实是一个有效且通常更优的修复方案。\n- **论证分析：** 响应时间计算是错误的。在 PCP 下，阻塞项 $B_H$ 是任何使用与 $\\tau_H$ 相关的天花板资源的低优先级任务的最长临界区的持续时间。在这里，那应该是 $\\ell_L = 3$ ms，而不是 $\\ell_H = 1$ ms。正确的 RTA 应该是 $R_H = C_H + \\ell_L = 2 + 3 = 5$ ms。\n- **结论：** **不正确**。反例基于错误的前提，且论证中包含了不正确的响应时间分析公式。\n\n**D. 反例轨迹：如果 $\\tau_H$ 在 $\\tau_L$ 执行时于 $t=9$ 释放，它可能会未满足其截止时间；系统因抖动而不稳定。修复方案：将系统转换为一个时间触发的静态表，其中为 $\\tau_H$ 分配 $2$ ms 的槽，为 $\\tau_M$ 分配 $6$ ms 的槽，为 $\\tau_L$ 分配 $8$ ms 的槽；固定的时间表消除了干扰，因此截止时间得以满足，模型检查保持不变。**\n\n- **反例分析：** 该选项忽略了指定的释放时间（$t=0, t=2$）并虚构了一个新场景。问题要求分析给定的工作负载，而不是一个假设的。术语‘抖动’的引入没有问题陈述的依据。\n- **修复方案分析：** 转换为时间触发（TT）架构是根本性的系统重新设计，而不是‘最小修复方案’。对修复方案的描述不完整，因为它只给出了槽的大小，而没有给出实际的调度表。\n- **论证分析：** ‘模型检查保持不变’的说法是错误的。TT 系统的状态空间模型与事件触发的、优先级抢占式的系统完全不同。\n- **结论：** **不正确**。它未能分析给定的问题，提出了一个非最小的修复方案，并包含了有缺陷的论证。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "事件触发系统的分析不仅限于中央处理器，还延伸到通信网络。本练习将理论付诸实践，让您深入研究控制器局域网（CAN）总线这一广泛应用的事件触发网络。您将计算一条消息在考虑了更高优先级消息干扰和协议细节（如位填充）下的最坏情况响应时间，从而掌握评估分布式嵌入式系统实时性能的关键技能。",
            "id": "4251633",
            "problem": "一个信息物理系统使用事件触发的控制器局域网 (CAN) 总线进行传感器到控制器的通信。该系统被建模为具有比特级时序保真度的数字孪生。CAN总线是一种共享的、非抢占式的介质：一旦一帧开始传输，它就不能被中断，并且非破坏性仲裁确保当多个帧准备就绪时，具有数值最低标识符的帧赢得访问权。\n\n假设一个经典的CAN标准数据帧（11位标识符），具有以下位域结构和位填充规则：\n- 循环冗余校验 (CRC) 分隔符之前的位域被填充：在任何连续五个相同位的序列之后，会插入一个极性相反的填充位。此规则从帧起始 (SOF) 开始一直应用到 CRC 序列结束。\n- 未填充的固定字段包括：帧起始 (SOF)（$1$ 位）、仲裁（$11$位标识符和$1$位远程传输请求，共$12$位）、控制（$6$ 位，包括标识符扩展和数据长度码）、数据（对于$D$字节的有效载荷为$8D$位）、CRC序列（$15$ 位）、CRC分隔符（$1$ 位）、确认（$2$ 位）、帧结束 (EOF)（$7$ 位）和帧间空间（$3$ 位）。\n- 插入到填充区域的填充位数由 $\\left\\lfloor\\frac{N_{\\mathrm{stuffable}}-1}{5}\\right\\rfloor$ 作为上界，其中 $N_{\\mathrm{stuffable}}$ 是从SOF到CRC序列的未填充位数。\n\n总线标称比特率为每秒 $500\\,000$ 比特。考虑一个低优先级的事件触发消息 $M_{0}$ 和两个高优先级的消息 $H_{1}$ 和 $H_{2}$，它们具有以下属性：\n- $M_{0}$ 的有效载荷为 $D_{0}=6$ 字节。\n- $H_{1}$ 的有效载荷为 $D_{1}=8$ 字节，最小到达间隔时间（周期）为 $T_{1}=1.5\\,\\mathrm{ms}$。\n- $H_{2}$ 的有效载荷为 $D_{2}=3$ 字节，最小到达间隔时间（周期）为 $T_{2}=2.2\\,\\mathrm{ms}$。\n\n假设所有消息的释放抖动为零，所有三个消息都可能在时间 $t=0$ 同时释放，并且在 $t=0$ 之前总线处于空闲状态，因此在触发瞬间不存在进行中的低优先级阻塞。帧持续时间包括最坏情况下的填充位数和每次传输的3位帧间空间。忽略传播延迟、收发器延迟、振荡器容差和错误帧；将每个比特建模为在给定比特率 $r_{b}$ 下精确占用 $1/r_{b}$ 秒。\n\n将 $M_{0}$ 的最坏情况响应时间 (WCRT) 定义为从 $t=0$ 时释放 $M_{0}$ 到其成功传输结束的时间，其中考虑了在其繁忙窗口内可能发生的所有高优先级消息的干扰传输。使用第一性原理以及给定的比特级结构和填充界限，计算在 $H_{1}$ 和 $H_{2}$ 干扰下 $M_{0}$ 的WCRT。\n\n将您的最终数值答案四舍五入到四位有效数字，并以微秒表示。",
            "solution": "问题陈述具有科学依据，提法得当，且内部一致。它为执行实时系统（特别是控制器局域网（CAN）总线）的标准最坏情况响应时间 (WCRT) 分析提供了一套完整的参数。模型细节，包括位域长度和位填充公式，都已明确定义，从而可以得到一个唯一且可验证的解。因此，该问题是有效的。\n\n在固定优先级、非抢占式系统中，消息 $M_i$ 的最坏情况响应时间由以下递归公式给出：\n$$R_i^{(k+1)} = B_i + C_i + \\sum_{j \\in hp(i)} \\left\\lceil \\frac{R_i^{(k)}}{T_j} \\right\\rceil C_j$$\n其中 $R_i$ 是消息 $M_i$ 的响应时间，$B_i$ 是由低优先级消息引起的阻塞时间，$C_i$ 是消息 $M_i$ 的最坏情况传输时间，$hp(i)$ 是高优先级消息的集合，$T_j$ 是高优先级消息 $M_j$ 的最小到达间隔时间（周期）。迭代从一个初始猜测开始，通常是 $R_i^{(0)} = C_i + B_i$，并持续进行直到 $R_i^{(k+1)} = R_i^{(k)}$。\n\n对于我们关注的消息 $M_0$，高优先级集合为 $hp(0) = \\{H_1, H_2\\}$。问题陈述指出总线在关键时刻 $t=0$ 时是空闲的，因此阻塞项 $B_0=0$。$M_0$ 的 WCRT（记为 $R_0$）的方程是：\n$$R_0 = C_0 + \\left\\lceil \\frac{R_0}{T_1} \\right\\rceil C_1 + \\left\\lceil \\frac{R_0}{T_2} \\right\\rceil C_2$$\n\n第一步是计算每个消息 $M_i \\in \\{M_0, H_1, H_2\\}$ 的最坏情况传输时间 $C_i$。问题明确指出，此持续时间包括帧传输时间和帧间空间 (IFS)。比特时间 $\\tau_b$ 是比特率 $r_b$ 的倒数：\n$$\\tau_b = \\frac{1}{r_b} = \\frac{1}{500\\,000 \\, \\text{bits/s}} = 2 \\times 10^{-6} \\, \\text{s} = 2 \\, \\mu\\text{s}$$\n\n最坏情况传输时间 $C_i$ 是最坏情况帧的总比特数加上IFS，再乘以比特时间：\n$$C_i = (N_{\\text{frame}, i}^{\\text{wc}} + N_{\\text{IFS}}) \\times \\tau_b$$\n最坏情况帧中的比特数 $N_{\\text{frame}, i}^{\\text{wc}}$ 是未填充比特数和最大填充比特数 $N_{\\text{stuff}, i}$ 的和。\n$$N_{\\text{frame}, i}^{\\text{wc}} = N_{\\text{frame}, i}^{\\text{unstuffed}} + N_{\\text{stuff}, i}$$\n\n在具有 $D_i$ 字节有效载荷的经典CAN数据帧中，未填充比特数为：\n$N_{\\text{frame}, i}^{\\text{unstuffed}} = \\text{SOF}(1) + \\text{Arb}(12) + \\text{Ctrl}(6) + \\text{Data}(8D_i) + \\text{CRC}(15) + \\text{CRCdel}(1) + \\text{ACK}(2) + \\text{EOF}(7)$\n$$N_{\\text{frame}, i}^{\\text{unstuffed}} = 1 + 12 + 6 + 8D_i + 15 + 1 + 2 + 7 = 44 + 8D_i$$\n\n位填充从SOF应用到CRC序列的末尾。该区域中的未填充比特数 $N_{\\text{stuffable}, i}$ 为：\n$$N_{\\text{stuffable}, i} = \\text{SOF}(1) + \\text{Arb}(12) + \\text{Ctrl}(6) + \\text{Data}(8D_i) + \\text{CRC}(15) = 34 + 8D_i$$\n根据问题陈述，最大填充比特数的上界为：\n$$N_{\\text{stuff}, i} = \\left\\lfloor\\frac{N_{\\text{stuffable}, i}-1}{5}\\right\\rfloor = \\left\\lfloor\\frac{(34 + 8D_i) - 1}{5}\\right\\rfloor = \\left\\lfloor\\frac{33 + 8D_i}{5}\\right\\rfloor$$\n\n现在我们计算 $C_0$、$C_1$ 和 $C_2$。给定的 IFS 为 $N_{\\text{IFS}} = 3$ 比特。\n\n对于消息 $M_0$，其 $D_0 = 6$ 字节：\n$N_{\\text{stuffable}, 0} = 34 + 8 \\times 6 = 34 + 48 = 82$ 比特。\n$N_{\\text{stuff}, 0} = \\left\\lfloor\\frac{82-1}{5}\\right\\rfloor = \\lfloor 16.2 \\rfloor = 16$ 比特。\n$N_{\\text{frame}, 0}^{\\text{unstuffed}} = 44 + 8 \\times 6 = 92$ 比特。\n$N_{\\text{frame}, 0}^{\\text{wc}} = 92 + 16 = 108$ 比特。\n$C_0 = (108 + 3) \\times \\tau_b = 111 \\times 2 \\, \\mu\\text{s} = 222 \\, \\mu\\text{s}$。\n\n对于消息 $H_1$，其 $D_1 = 8$ 字节：\n$N_{\\text{stuffable}, 1} = 34 + 8 \\times 8 = 34 + 64 = 98$ 比特。\n$N_{\\text{stuff}, 1} = \\left\\lfloor\\frac{98-1}{5}\\right\\rfloor = \\lfloor 19.4 \\rfloor = 19$ 比特。\n$N_{\\text{frame}, 1}^{\\text{unstuffed}} = 44 + 8 \\times 8 = 108$ 比特。\n$N_{\\text{frame}, 1}^{\\text{wc}} = 108 + 19 = 127$ 比特。\n$C_1 = (127 + 3) \\times \\tau_b = 130 \\times 2 \\, \\mu\\text{s} = 260 \\, \\mu\\text{s}$。\n\n对于消息 $H_2$，其 $D_2 = 3$ 字节：\n$N_{\\text{stuffable}, 2} = 34 + 8 \\times 3 = 34 + 24 = 58$ 比特。\n$N_{\\text{stuff}, 2} = \\left\\lfloor\\frac{58-1}{5}\\right\\rfloor = \\lfloor 11.4 \\rfloor = 11$ 比特。\n$N_{\\text{frame}, 2}^{\\text{unstuffed}} = 44 + 8 \\times 3 = 68$ 比特。\n$N_{\\text{frame}, 2}^{\\text{wc}} = 68 + 11 = 79$ 比特。\n$C_2 = (79 + 3) \\times \\tau_b = 82 \\times 2 \\, \\mu\\text{s} = 164 \\, \\mu\\text{s}$。\n\n我们现在可以使用迭代法求解 $R_0$。参数如下：\n$C_0 = 222 \\, \\mu\\text{s}$\n$C_1 = 260 \\, \\mu\\text{s}$，$T_1 = 1.5 \\, \\text{ms} = 1500 \\, \\mu\\text{s}$\n$C_2 = 164 \\, \\mu\\text{s}$，$T_2 = 2.2 \\, \\text{ms} = 2200 \\, \\mu\\text{s}$\n$B_0 = 0 \\, \\mu\\text{s}$\n\n递推关系为：\n$$R_0^{(k+1)} = 222 + \\left\\lceil \\frac{R_0^{(k)}}{1500} \\right\\rceil \\times 260 + \\left\\lceil \\frac{R_0^{(k)}}{2200} \\right\\rceil \\times 164$$\n让我们从一个初始猜测 $R_0^{(0)}$ 开始迭代，该值等于 $M_0$ 的传输时间以及在关键时刻释放的所有高优先级消息的传输时间之和。\n$$R_0^{(0)} = C_0 + C_1 + C_2 = 222 + 260 + 164 = 646 \\, \\mu\\text{s}$$\n现在，我们计算第一次迭代 $R_0^{(1)}$：\n$$R_0^{(1)} = 222 + \\left\\lceil \\frac{646}{1500} \\right\\rceil \\times 260 + \\left\\lceil \\frac{646}{2200} \\right\\rceil \\times 164$$\n$$R_0^{(1)} = 222 + \\lceil 0.4306... \\rceil \\times 260 + \\lceil 0.2936... \\rceil \\times 164$$\n$$R_0^{(1)} = 222 + 1 \\times 260 + 1 \\times 164 = 222 + 260 + 164 = 646 \\, \\mu\\text{s}$$\n由于 $R_0^{(1)} = R_0^{(0)} = 646 \\, \\mu\\text{s}$，迭代收敛。$M_0$ 的最坏情况响应时间为 $646 \\, \\mu\\text{s}$。这个结果在物理上是直观的：WCRT 发生在所有消息同时释放时，并且繁忙窗口的长度短于干扰消息的周期，这意味着它们各自只干扰一次。总时间是它们各自传输时间的总和。\n\n问题要求最终答案四舍五入到四位有效数字。\n$$R_0 = 646.0 \\, \\mu\\text{s}$$",
            "answer": "$$\\boxed{646.0}$$"
        }
    ]
}