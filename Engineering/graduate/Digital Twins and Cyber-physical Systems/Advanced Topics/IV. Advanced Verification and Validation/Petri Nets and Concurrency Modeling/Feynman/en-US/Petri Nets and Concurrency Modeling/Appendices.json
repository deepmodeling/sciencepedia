{
    "hands_on_practices": [
        {
            "introduction": "The most fundamental skill in working with Petri nets is understanding how the system state, or marking, evolves over time. This exercise focuses on the core 'firing rule', where you will manually trace the effects of a sequence of transitions on the net's marking. By stepping through the process of verifying enabled transitions and calculating the resulting state changes, you will gain a concrete understanding of the net's dynamics, a crucial first step before tackling more complex analyses. ",
            "id": "4234869",
            "problem": "A production orchestration scenario in a Cyber-Physical System (CPS) and its digital twin (DT) is modeled by a Place/Transition Petri net. The net captures concurrent flows between the physical execution queue and the DTâ€™s validation queue. The Petri net is defined by the tuple $\\mathcal{N} = (P, T, \\text{Pre}, \\text{Post})$, where $P = \\{p_1, p_2, p_3, p_4\\}$ are places ordered as $(p_1, p_2, p_3, p_4)$ and $T = \\{t_1, t_2, t_3\\}$ are transitions ordered as $(t_1, t_2, t_3)$. The weighted input and output incidence matrices $\\text{Pre}$ and $\\text{Post}$ (with rows indexed by places and columns indexed by transitions) are\n$$\n\\text{Pre} = \n\\begin{pmatrix}\n2 & 0 & 3 \\\\\n1 & 1 & 2 \\\\\n0 & 2 & 0 \\\\\n0 & 1 & 0\n\\end{pmatrix},\n\\quad\n\\text{Post} =\n\\begin{pmatrix}\n0 & 1 & 0 \\\\\n0 & 2 & 0 \\\\\n2 & 0 & 1 \\\\\n1 & 0 & 2\n\\end{pmatrix}.\n$$\nThe initial marking is $M_0 = \\begin{pmatrix}4 \\\\ 2 \\\\ 1 \\\\ 0\\end{pmatrix}$, where the vector order corresponds to $(p_1, p_2, p_3, p_4)$.\n\nUsing only the fundamental definition of enabling and the firing rule, and without invoking any shortcut formulas, apply the transition sequence $\\langle t_1, t_2, t_3 \\rangle$ from $M_0$, verifying enabling at each step. Let the resulting marking be $M_3$. Define the scalar performance discrepancy functional\n$$\nD(M) = -\\,m_1 + m_3 + 2\\,m_4,\n$$\nwhere $m_i$ denotes the token count in place $p_i$ in marking $M$.\n\nCompute $D(M_3)$. Express your final answer as a single real-valued number. No rounding is required, and no physical units are involved.",
            "solution": "The problem requires the calculation of a scalar functional $D(M_3)$ which depends on the marking $M_3$. The marking $M_3$ is the state of the Petri net after executing the transition sequence $\\sigma = \\langle t_1, t_2, t_3 \\rangle$ starting from the initial marking $M_0$. We must follow the fundamental definitions of enabling and firing for a Place/Transition Petri net at each step.\n\nA transition $t_j \\in T$ is enabled at a marking $M$ if and only if for every place $p_i \\in P$, the number of tokens in $p_i$, denoted by $M(p_i)$, is greater than or equal to the weight of the arc from $p_i$ to $t_j$. This is given by the condition $M \\ge \\text{Pre}(\\cdot, j)$ for all components, where $\\text{Pre}(\\cdot, j)$ is the $j$-th column of the input incidence matrix $\\text{Pre}$.\n\nIf an enabled transition $t_j$ fires at marking $M_k$, it produces a new marking $M_{k+1}$ according to the state equation:\n$$M_{k+1} = M_k - \\text{Pre}(\\cdot, j) + \\text{Post}(\\cdot, j)$$\nwhere $\\text{Post}(\\cdot, j)$ is the $j$-th column of the output incidence matrix $\\text{Post}$.\n\nThe given initial marking is $M_0 = \\begin{pmatrix} 4 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix}$. The components of a marking vector $M$ are denoted as $M = \\begin{pmatrix} m_1 \\\\ m_2 \\\\ m_3 \\\\ m_4 \\end{pmatrix}$. We will now apply the transition sequence step-by-step.\n\n**Step 1: Firing of transition $t_1$ from marking $M_0$**\n\nFirst, we verify if transition $t_1$ is enabled at $M_0$. This requires $M_0 \\ge \\text{Pre}(\\cdot, 1)$. The first column of $\\text{Pre}$ is $\\text{Pre}(\\cdot, 1) = \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\nWe check the condition component-wise:\n$$\n\\begin{pmatrix} 4 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} \\ge \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThis corresponds to:\n$m_1 = 4 \\ge 2$ (true)\n$m_2 = 2 \\ge 1$ (true)\n$m_3 = 1 \\ge 0$ (true)\n$m_4 = 0 \\ge 0$ (true)\nSince all conditions are met, transition $t_1$ is enabled at $M_0$.\n\nUpon firing $t_1$, the new marking $M_1$ is calculated. The first column of $\\text{Post}$ is $\\text{Post}(\\cdot, 1) = \\begin{pmatrix} 0 \\\\ 0 \\\\ 2 \\\\ 1 \\end{pmatrix}$.\n$$\nM_1 = M_0 - \\text{Pre}(\\cdot, 1) + \\text{Post}(\\cdot, 1) = \\begin{pmatrix} 4 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 2 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\\\ 2 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 4-2+0 \\\\ 2-1+0 \\\\ 1-0+2 \\\\ 0-0+1 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 1 \\\\ 3 \\\\ 1 \\end{pmatrix}\n$$\nSo, the marking after firing $t_1$ is $M_1 = \\begin{pmatrix} 2 \\\\ 1 \\\\ 3 \\\\ 1 \\end{pmatrix}$.\n\n**Step 2: Firing of transition $t_2$ from marking $M_1$**\n\nNext, we verify if transition $t_2$ is enabled at $M_1$. This requires $M_1 \\ge \\text{Pre}(\\cdot, 2)$. The second column of $\\text{Pre}$ is $\\text{Pre}(\\cdot, 2) = \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix}$.\nWe check the condition component-wise:\n$$\n\\begin{pmatrix} 2 \\\\ 1 \\\\ 3 \\\\ 1 \\end{pmatrix} \\ge \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix}\n$$\nThis corresponds to:\n$m_1 = 2 \\ge 0$ (true)\n$m_2 = 1 \\ge 1$ (true)\n$m_3 = 3 \\ge 2$ (true)\n$m_4 = 1 \\ge 1$ (true)\nSince all conditions are met, transition $t_2$ is enabled at $M_1$.\n\nUpon firing $t_2$, the new marking $M_2$ is calculated. The second column of $\\text{Post}$ is $\\text{Post}(\\cdot, 2) = \\begin{pmatrix} 1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\n$$\nM_2 = M_1 - \\text{Pre}(\\cdot, 2) + \\text{Post}(\\cdot, 2) = \\begin{pmatrix} 2 \\\\ 1 \\\\ 3 \\\\ 1 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 1 \\\\ 2 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2-0+1 \\\\ 1-1+2 \\\\ 3-2+0 \\\\ 1-1+0 \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\nSo, the marking after firing $t_2$ is $M_2 = \\begin{pmatrix} 3 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\n\n**Step 3: Firing of transition $t_3$ from marking $M_2$**\n\nFinally, we verify if transition $t_3$ is enabled at $M_2$. This requires $M_2 \\ge \\text{Pre}(\\cdot, 3)$. The third column of $\\text{Pre}$ is $\\text{Pre}(\\cdot, 3) = \\begin{pmatrix} 3 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}$.\nWe check the condition component-wise:\n$$\n\\begin{pmatrix} 3 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} \\ge \\begin{pmatrix} 3 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThis corresponds to:\n$m_1 = 3 \\ge 3$ (true)\n$m_2 = 2 \\ge 2$ (true)\n$m_3 = 1 \\ge 0$ (true)\n$m_4 = 0 \\ge 0$ (true)\nSince all conditions are met, transition $t_3$ is enabled at $M_2$.\n\nUpon firing $t_3$, the final marking $M_3$ is calculated. The third column of $\\text{Post}$ is $\\text{Post}(\\cdot, 3) = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix}$.\n$$\nM_3 = M_2 - \\text{Pre}(\\cdot, 3) + \\text{Post}(\\cdot, 3) = \\begin{pmatrix} 3 \\\\ 2 \\\\ 1 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3 \\\\ 2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 2 \\end{pmatrix} = \\begin{pmatrix} 3-3+0 \\\\ 2-2+0 \\\\ 1-0+1 \\\\ 0-0+2 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 2 \\\\ 2 \\end{pmatrix}\n$$\nThe final marking after the sequence $\\langle t_1, t_2, t_3 \\rangle$ is $M_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 2 \\\\ 2 \\end{pmatrix}$.\n\n**Step 4: Calculation of the performance discrepancy functional $D(M_3)$**\n\nThe functional is defined as $D(M) = -m_1 + m_3 + 2m_4$. We evaluate this for the marking $M_3$, which has components $m_1 = 0$, $m_2 = 0$, $m_3 = 2$, and $m_4 = 2$.\n$$\nD(M_3) = - (0) + (2) + 2(2) = 0 + 2 + 4 = 6\n$$\nThe value of the performance discrepancy functional at the final marking $M_3$ is $6$.",
            "answer": "$$\n\\boxed{6}\n$$"
        },
        {
            "introduction": "While tracing a single firing sequence is useful, understanding the full behavioral scope of a concurrent system requires exploring all its reachable states. This practice guides you through the construction of a reachability graph, which serves as a complete map of a system's potential evolution from an initial state. Through this process, you will learn to identify critical system properties such as boundedness, the presence of deadlocks, and the existence of home states, all of which are essential for verifying system correctness and liveness. ",
            "id": "4234904",
            "problem": "A Digital Twin (DT) coordinating a Cyber-Physical System (CPS) executes a cyclic three-stage pipeline on a stream of tasks: sense, compute, and actuate. The pipeline is modeled as a Place/Transition Petri Net (P/T PN) with three places and three transitions, each arc weight equal to $1$. The places are $P_1$ (sense), $P_2$ (compute), and $P_3$ (actuate). The transitions are $t_{12}$, $t_{23}$, and $t_{31}$, which move one token from $P_1$ to $P_2$, from $P_2$ to $P_3$, and from $P_3$ to $P_1$, respectively. There are $2$ indistinguishable tokens in the net representing two concurrent task instances in the DT-CPS loop, and the initial marking is $M_0 = (1, 1, 0)$, where the tuple gives the token counts in $(P_1, P_2, P_3)$.\n\nConstruct the reachability graph under the standard firing rule for Place/Transition Petri Nets (a transition is enabled if all its input places contain at least one token; firing the transition consumes one token from each input place and produces one token in each output place). Then compute the number of distinct markings that are reachable from $M_0$, detect whether any reachable marking is a deadlock marking (a marking with no enabled transitions), and identify the set of home markings (a marking $M_h$ such that from any reachable marking there exists a firing sequence that reaches $M_h$).\n\nExpress your final answer as a single row matrix using the LaTeX $\\texttt{pmatrix}$ environment in the order $(N\\ D\\ H)$, where $N$ is the number of distinct reachable markings, $D$ is the number of reachable deadlock markings, and $H$ is the number of home markings among the reachable markings. No rounding is required.",
            "solution": "We begin from the fundamental definitions of a Place/Transition Petri Net (P/T PN), marking and firing: a marking assigns a nonnegative integer number of tokens to each place, a transition is enabled if its input places have sufficient tokens according to arc weights, and firing removes tokens from input places and adds tokens to output places, preserving token counts along arcs.\n\nThe given net has places $P_1$, $P_2$, $P_3$ and transitions $t_{12}$, $t_{23}$, $t_{31}$ with unit-weight arcs arranged as a cycle:\n- $t_{12}$ has input $P_1$ and output $P_2$,\n- $t_{23}$ has input $P_2$ and output $P_3$,\n- $t_{31}$ has input $P_3$ and output $P_1$.\n\nThe initial marking is $M_0 = (1, 1, 0)$, and the total number of tokens is $2$.\n\nFirst, we establish boundedness using a place-invariant argument. Define the linear form $I = x_1 + x_2 + x_3$, where $x_i$ is the token count in place $P_i$. For each transition $t_{12}$, $t_{23}$, $t_{31}$, one token is removed from one place and added to another, so $I$ is unchanged by any firing. Therefore, for any reachable marking $M$, we have $x_1 + x_2 + x_3 = 2$. Since each $x_i \\in \\mathbb{N}_0$, the net is bounded and the reachable markings must lie among the integer nonnegative solutions to $x_1 + x_2 + x_3 = 2$.\n\nWe enumerate all nonnegative integer triples $(x_1, x_2, x_3)$ with $x_1 + x_2 + x_3 = 2$:\n- $(2, 0, 0)$,\n- $(0, 2, 0)$,\n- $(0, 0, 2)$,\n- $(1, 1, 0)$,\n- $(1, 0, 1)$,\n- $(0, 1, 1)$.\n\nThus there are $6$ candidates for reachable markings. We now show that all six are reachable from $M_0 = (1, 1, 0)$, and construct the reachability graph.\n\nFrom $M_0 = (1, 1, 0)$, the enabled transitions are $t_{12}$ (since $P_1$ has $1$ token) and $t_{23}$ (since $P_2$ has $1$ token). Firing:\n- $t_{12}$ yields $(0, 2, 0)$,\n- $t_{23}$ yields $(1, 0, 1)$.\n\nFrom $(0, 2, 0)$, the only enabled transition is $t_{23}$, which yields $(0, 1, 1)$.\n\nFrom $(1, 0, 1)$, the enabled transitions are $t_{12}$ and $t_{31}$. Firing:\n- $t_{12}$ yields $(0, 1, 1)$,\n- $t_{31}$ yields $(2, 0, 0)$.\n\nFrom $(0, 1, 1)$, the enabled transitions are $t_{23}$ and $t_{31}$. Firing:\n- $t_{23}$ yields $(0, 0, 2)$,\n- $t_{31}$ yields $(1, 1, 0)$.\n\nFrom $(2, 0, 0)$, the only enabled transition is $t_{12}$, which yields $(1, 1, 0)$.\n\nFrom $(0, 0, 2)$, the only enabled transition is $t_{31}$, which yields $(1, 0, 1)$.\n\nTherefore, every one of the six candidate markings is reachable, and the reachability graph has the vertex set\n$$\n\\{(2, 0, 0),\\ (0, 2, 0),\\ (0, 0, 2),\\ (1, 1, 0),\\ (1, 0, 1),\\ (0, 1, 1)\\}\n$$\nwith directed edges defined by the firings above. It is immediate from the edge structure that the graph is strongly connected: for example, from any node, one can reach $(1, 1, 0)$ and from $(1, 1, 0)$ one can reach the others.\n\nNext, we detect deadlocks. A deadlock marking is one in which no transition is enabled. In this net, a transition is enabled whenever there is a token in its input place. Since the sum of tokens across $P_1$, $P_2$, and $P_3$ is $2$, each reachable marking has at least one place with a positive token count, and correspondingly at least one enabled transition ($t_{12}$ if $x_1 > 0$, $t_{23}$ if $x_2 > 0$, $t_{31}$ if $x_3 > 0$). Explicit inspection of the six reachable markings above confirms that in each case there is at least one enabled transition. Hence, there are no deadlock markings among the reachable markings, so the count $D = 0$.\n\nFinally, we identify home markings. A marking $M_h$ is a home marking if, from any reachable marking, there exists a firing sequence that reaches $M_h$. Because the reachability graph is strongly connected, for any chosen marking (e.g., $M_0 = (1, 1, 0)$), there exists a directed path from any other reachable marking to $M_0$. Therefore, $M_0$ is a home marking. Moreover, by the same reasoning, every reachable marking is a home marking: from any marking one can reach any other via appropriate sequences of $t_{12}$, $t_{23}$, and $t_{31}$. Thus the number of home markings equals the number of reachable markings, $H = 6$.\n\nCollecting the results:\n- Number of distinct reachable markings $N = 6$,\n- Number of reachable deadlock markings $D = 0$,\n- Number of home markings among reachable markings $H = 6$.\n\nWe express the final answer as the row matrix $(N\\ D\\ H)$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 6 & 0 & 6 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Moving beyond analysis, a key application of Petri nets in cyber-physical systems is in control synthesis. This advanced exercise challenges you to address a classic concurrency problem: deadlock arising from resource contention. You will first diagnose the structural cause of the deadlock using the concept of a siphon, and then apply this insight to design and implement a supervisory controller that provably prevents the deadlock, ensuring the system remains live and productive. ",
            "id": "4234899",
            "problem": "Consider a resource-allocation model for a Digital Twin of a Cyber-Physical System (CPS) represented as a Petri net. The system has two shared actuators and two concurrent tasks that acquire the actuators sequentially in opposite orders. The Petri net is defined by the set of places $P = \\{ p_{r1}, p_{r2}, p_{a1}, p_{a2}, p_{b1}, p_{b2} \\}$ and transitions $T = \\{ t_{a1}, t_{a2}, t_{a\\_rel}, t_{b1}, t_{b2}, t_{b\\_rel} \\}$, with all arc weights equal to $1$. The initial marking $M_{0}$ is given by $M_{0}(p_{r1}) = 1$, $M_{0}(p_{r2}) = 1$, and $M_{0}(p) = 0$ for all other places $p \\in P$. The transition pre-sets and post-sets are:\n- $t_{a1}$: ${}^{\\bullet} t_{a1} = \\{ p_{r1} \\}$ and $t_{a1}^{\\bullet} = \\{ p_{a1} \\}$,\n- $t_{a2}$: ${}^{\\bullet} t_{a2} = \\{ p_{r2}, p_{a1} \\}$ and $t_{a2}^{\\bullet} = \\{ p_{a2} \\}$,\n- $t_{a\\_rel}$: ${}^{\\bullet} t_{a\\_rel} = \\{ p_{a2} \\}$ and $t_{a\\_rel}^{\\bullet} = \\{ p_{r1}, p_{r2} \\}$,\n- $t_{b1}$: ${}^{\\bullet} t_{b1} = \\{ p_{r2} \\}$ and $t_{b1}^{\\bullet} = \\{ p_{b1} \\}$,\n- $t_{b2}$: ${}^{\\bullet} t_{b2} = \\{ p_{r1}, p_{b1} \\}$ and $t_{b2}^{\\bullet} = \\{ p_{b2} \\}$,\n- $t_{b\\_rel}$: ${}^{\\bullet} t_{b\\_rel} = \\{ p_{b2} \\}$ and $t_{b\\_rel}^{\\bullet} = \\{ p_{r1}, p_{r2} \\}$.\n\nLet $S = \\{ p_{r1}, p_{r2}, p_{a2}, p_{b2} \\}$. Starting from core definitions of Petri nets and siphons, first explain why $S$ satisfies the formal definition of a siphon and why emptiness of $S$ entails a deadlock in this model. Then construct a supervisor (a monitor place) $p_{m}$ with suitable arcs to enforce the structural constraint that the siphon does not become empty during execution in the supervised net. Use only unit-weight arcs and choose an initial marking $M_{0}(p_{m})$ that achieves this enforcement. Finally, compute the set of reachable markings in the supervised net starting from the augmented initial marking, and report the cardinality of this reachable set as a single integer. Express the final answer as a plain integer, with no units and no rounding specification necessary.",
            "solution": "The problem asks for four main tasks:\n1.  To demonstrate that the given set $S = \\{ p_{r1}, p_{r2}, p_{a2}, p_{b2} \\}$ is a siphon.\n2.  To explain why the emptiness of this siphon corresponds to a deadlock state.\n3.  To design a supervisory controller (a monitor place $p_m$ and associated arcs) that prevents the siphon from becoming empty.\n4.  To compute the number of reachable markings in the supervised system.\n\nLet the Petri net be denoted by $N = (P, T, F, W)$, where $P$ is the set of places, $T$ is the set of transitions, $F \\subseteq (P \\times T) \\cup (T \\times P)$ is the set of arcs, and $W: F \\to \\{1, 2, ...\\}$ is the weight function. In this problem, all arc weights are $1$.\n\n**Part 1: Validation of $S$ as a Siphon**\n\nA non-empty set of places $S \\subseteq P$ is defined as a siphon if the set of all input transitions to $S$, denoted ${}^{\\bullet}S$, is a subset of the set of all output transitions from $S$, denoted $S^{\\bullet}$. Formally, a siphon satisfies ${}^{\\bullet}S \\subseteq S^{\\bullet}$.\n\nThe set of input transitions to $S$ is ${}^{\\bullet}S = \\{ t \\in T \\mid t^{\\bullet} \\cap S \\neq \\emptyset \\}$.\nThe set of output transitions from $S$ is $S^{\\bullet} = \\{ t \\in T \\mid {}^{\\bullet}t \\cap S \\neq \\emptyset \\}$.\n\nThe given set is $S = \\{ p_{r1}, p_{r2}, p_{a2}, p_{b2} \\}$.\n\nFirst, we identify the set of input transitions ${}^{\\bullet}S$:\n- $t_{a1}^{\\bullet} = \\{ p_{a1} \\}$. Since $p_{a1} \\notin S$, $t_{a1} \\notin {}^{\\bullet}S$.\n- $t_{a2}^{\\bullet} = \\{ p_{a2} \\}$. Since $p_{a2} \\in S$, $t_{a2} \\in {}^{\\bullet}S$.\n- $t_{a\\_rel}^{\\bullet} = \\{ p_{r1}, p_{r2} \\}$. Since $\\{ p_{r1}, p_{r2} \\} \\subset S$, $t_{a\\_rel} \\in {}^{\\bullet}S$.\n- $t_{b1}^{\\bullet} = \\{ p_{b1} \\}$. Since $p_{b1} \\notin S$, $t_{b1} \\notin {}^{\\bullet}S$.\n- $t_{b2}^{\\bullet} = \\{ p_{b2} \\}$. Since $p_{b2} \\in S$, $t_{b2} \\in {}^{\\bullet}S$.\n- $t_{b\\_rel}^{\\bullet} = \\{ p_{r1}, p_{r2} \\}$. Since $\\{ p_{r1}, p_{r2} \\} \\subset S$, $t_{b\\_rel} \\in {}^{\\bullet}S$.\nThus, the set of input transitions is ${}^{\\bullet}S = \\{ t_{a2}, t_{a\\_rel}, t_{b2}, t_{b\\_rel} \\}$.\n\nNext, we identify the set of output transitions $S^{\\bullet}$:\n- ${}^{\\bullet}t_{a1} = \\{ p_{r1} \\}$. Since $p_{r1} \\in S$, $t_{a1} \\in S^{\\bullet}$.\n- ${}^{\\bullet}t_{a2} = \\{ p_{r2}, p_{a1} \\}$. Since $p_{r2} \\in S$, $t_{a2} \\in S^{\\bullet}$.\n- ${}^{\\bullet}t_{a\\_rel} = \\{ p_{a2} \\}$. Since $p_{a2} \\in S$, $t_{a\\_rel} \\in S^{\\bullet}$.\n- ${}^{\\bullet}t_{b1} = \\{ p_{r2} \\}$. Since $p_{r2} \\in S$, $t_{b1} \\in S^{\\bullet}$.\n- ${}^{\\bullet}t_{b2} = \\{ p_{r1}, p_{b1} \\}$. Since $p_{r1} \\in S$, $t_{b2} \\in S^{\\bullet}$.\n- ${}^{\\bullet}t_{b\\_rel} = \\{ p_{b2} \\}$. Since $p_{b2} \\in S$, $t_{b\\_rel} \\in S^{\\bullet}$.\nThus, the set of output transitions is $S^{\\bullet} = \\{ t_{a1}, t_{a2}, t_{a\\_rel}, t_{b1}, t_{b2}, t_{b\\_rel} \\}$.\n\nComparing the two sets, we find that every element of ${}^{\\bullet}S$ is also an element of $S^{\\bullet}$. Therefore, ${}^{\\bullet}S \\subseteq S^{\\bullet}$, which confirms that $S = \\{ p_{r1}, p_{r2}, p_{a2}, p_{b2} \\}$ is a siphon.\n\n**Part 2: Emptiness of Siphon and Deadlock**\n\nA key property of a siphon is that if it becomes empty of tokens (i.e., for a marking $M$, $M(p) = 0$ for all $p \\in S$), it will remain empty for all subsequent reachable markings. This is because any transition $t \\in {}^{\\bullet}S$ that could add a token to $S$ must, by the siphon definition, also be an output transition from $S$ ($t \\in S^{\\bullet}$). This means $t$ requires at least one token from a place in $S$ to be enabled. If $S$ is empty, no such transition can fire, and no new tokens can enter $S$.\n\nFor this specific Petri net, we first identify the Place-Invariants (P-invariants). A P-invariant is a vector $y$ such that $y^T C = 0$, where $C$ is the incidence matrix of the net. This implies $y^T M$ is constant for all reachable markings $M$. The two fundamental P-invariants for this system correspond to the conservation of resources:\n1.  For resource $r_1$: $M(p_{r1}) + M(p_{a1}) + M(p_{b2}) = \\text{constant}$. At $M_0$, this is $1+0+0 = 1$.\n2.  For resource $r_2$: $M(p_{r2}) + M(p_{b1}) + M(p_{a2}) = \\text{constant}$. At $M_0$, this is $1+0+0 = 1$.\n\nLet's find the total number of tokens in the siphon $S$, denoted by $|M|_S = \\sum_{p \\in S} M(p)$:\n$|M|_S = M(p_{r1}) + M(p_{r2}) + M(p_{a2}) + M(p_{b2})$.\nUsing the P-invariants, we can substitute for $M(p_{r1})$ and $M(p_{r2})$:\n$M(p_{r1}) = 1 - M(p_{a1}) - M(p_{b2})$\n$M(p_{r2}) = 1 - M(p_{b1}) - M(p_{a2})$\nSubstituting these into the expression for $|M|_S$:\n$|M|_S = (1 - M(p_{a1}) - M(p_{b2})) + (1 - M(p_{b1}) - M(p_{a2})) + M(p_{a2}) + M(p_{b2})$\n$|M|_S = 2 - M(p_{a1}) - M(p_{b1})$.\n\nThe siphon $S$ is empty if and only if $|M|_S = 0$. This implies $2 - M(p_{a1}) - M(p_{b1}) = 0$, or $M(p_{a1}) + M(p_{b1}) = 2$. Given the net structure, places $p_{a1}$ and $p_{b1}$ can hold at most one token each. Thus, the siphon is empty if and only if $M(p_{a1}) = 1$ and $M(p_{b1}) = 1$.\n\nThis state is reachable in the unsupervised net via the firing sequence $M_0 \\xrightarrow{t_{a1}} M' \\xrightarrow{t_{b1}} M_{deadlock}$.\n$M_0 = (1, 1, 0, 0, 0, 0)^T$.\n$M' = (0, 1, 1, 0, 0, 0)^T$.\n$M_{deadlock} = (0, 0, 1, 0, 1, 0)^T$. At this marking, $M(p_{a1})=1$ and $M(p_{b1})=1$.\nIn this state $M_{deadlock}$:\n- $t_{a1}$ is disabled (needs $p_{r1}$, which is empty).\n- $t_{a2}$ is disabled (needs $p_{r2}$, which is empty).\n- $t_{a\\_rel}$ is disabled (needs $p_{a2}$, which is empty).\n- $t_{b1}$ is disabled (needs $p_{r2}$, which is empty).\n- $t_{b2}$ is disabled (needs $p_{r1}$, which is empty).\n- $t_{b\\_rel}$ is disabled (needs $p_{b2}$, which is empty).\nSince no transitions are enabled, the system is in a total deadlock. Therefore, the emptiness of siphon $S$ implies a deadlock.\n\n**Part 3: Supervisor Design**\n\nTo prevent the deadlock, we must prevent the siphon $S$ from becoming empty. From the analysis above, this is equivalent to enforcing the constraint $M(p_{a1}) + M(p_{b1}) < 2$, or more strictly $M(p_{a1}) + M(p_{b1}) \\le 1$, because markings are integer-valued.\n\nWe introduce a monitor place $p_m$ to enforce this linear constraint. The control law will be implemented by making $p_m$ enforce the invariant $M(p_m) + M(p_{a1}) + M(p_{b1}) = k$ for some constant $k$.\nLet's choose $k=1$. The invariant is $M(p_m) + M(p_{a1}) + M(p_{b1}) = 1$.\nAt the initial marking $M_0$, we have $M_0(p_{a1})=0$ and $M_0(p_{b1})=0$. To satisfy the invariant, the initial marking of the monitor place must be $M_0(p_m) = 1 - 0 - 0 = 1$.\n\nTo maintain this invariant, we add arcs to and from $p_m$. The change in the marking of $p_m$ upon a transition firing, $\\Delta M(p_m)$, must be $\\Delta M(p_m) = -(\\Delta M(p_{a1}) + \\Delta M(p_{b1}))$.\n- For $t_{a1}$: A token is added to $p_{a1}$, so $\\Delta M(p_{a1}) = 1$ and $\\Delta M(p_{b1}) = 0$. We need $\\Delta M(p_m) = -1$. This requires an arc from $p_m$ to $t_{a1}$.\n- For $t_{a2}$: A token is removed from $p_{a1}$, so $\\Delta M(p_{a1}) = -1$ and $\\Delta M(p_{b1}) = 0$. We need $\\Delta M(p_m) = 1$. This requires an arc from $t_{a2}$ to $p_m$.\n- For $t_{b1}$: A token is added to $p_{b1}$, so $\\Delta M(p_{a1}) = 0$ and $\\Delta M(p_{b1}) = 1$. We need $\\Delta M(p_m) = -1$. This requires an arc from $p_m$ to $t_{b1}$.\n- For $t_{b2}$: A token is removed from $p_{b1}$, so $\\Delta M(p_{a1}) = 0$ and $\\Delta M(p_{b1}) = -1$. We need $\\Delta M(p_m) = 1$. This requires an arc from $t_{b2}$ to $p_m$.\n- Other transitions do not affect $p_{a1}$ or $p_{b1}$, so no arcs involving $p_m$ are needed for them.\n\nThe supervisor is thus defined as:\n- A new place $p_m$.\n- Initial marking $M_0(p_m) = 1$.\n- New arcs (unit weight): $(p_m, t_{a1})$, $(t_{a2}, p_m)$, $(p_m, t_{b1})$, $(t_{b2}, p_m)$.\n\nThis supervisor ensures $|M|_S = 2 - (M(p_{a1}) + M(p_{b1})) \\ge 2 - 1 = 1$, preventing the siphon from becoming empty.\n\n**Part 4: Reachable Markings of the Supervised Net**\n\nWe perform a reachability analysis of the supervised net. The state vector is an augmented marking $M_{sup} = (M(p_{r1}), M(p_{r2}), M(p_{a1}), M(p_{a2}), M(p_{b1}), M(p_{b2}), M(p_m))$.\nThe augmented initial marking is $M_0 = (1, 1, 0, 0, 0, 0, 1)$.\n\n1.  **Start at $M_0 = (1, 1, 0, 0, 0, 0, 1)$**.\n    - Enabled transitions:\n        - $t_{a1}$ (req: $p_{r1}, p_m$). Firing leads to $M_1 = (0, 1, 1, 0, 0, 0, 0)$.\n        - $t_{b1}$ (req: $p_{r2}, p_m$). Firing leads to $M_2 = (1, 0, 0, 0, 1, 0, 0)$.\n    - The state $M_{deadlock}$ is now unreachable because from state $M_1$, transition $t_{b1}$ is disabled due to $M_1(p_m)=0$.\n\n2.  **From $M_1 = (0, 1, 1, 0, 0, 0, 0)$**.\n    - Enabled transitions:\n        - $t_{a2}$ (req: $p_{r2}, p_{a1}$). Firing leads to $M_3 = (0, 0, 0, 1, 0, 0, 1)$.\n    - All other transitions are disabled.\n\n3.  **From $M_2 = (1, 0, 0, 0, 1, 0, 0)$**.\n    - Enabled transitions:\n        - $t_{b2}$ (req: $p_{r1}, p_{b1}$). Firing leads to $M_4 = (0, 0, 0, 0, 0, 1, 1)$.\n    - All other transitions are disabled.\n\n4.  **From $M_3 = (0, 0, 0, 1, 0, 0, 1)$**.\n    - Enabled transitions:\n        - $t_{a\\_rel}$ (req: $p_{a2}$). Firing leads back to $(1, 1, 0, 0, 0, 0, 1)$, which is $M_0$.\n\n5.  **From $M_4 = (0, 0, 0, 0, 0, 1, 1)$**.\n    - Enabled transitions:\n        - $t_{b\\_rel}$ (req: $p_{b2}$). Firing leads back to $(1, 1, 0, 0, 0, 0, 1)$, which is $M_0$.\n\nThe analysis shows that all paths lead back to the initial marking and no new markings can be reached. The set of all reachable markings is $\\{M_0, M_1, M_2, M_3, M_4\\}$. These five markings are distinct.\n\n- $M_0 = (1, 1, 0, 0, 0, 0, 1)$\n- $M_1 = (0, 1, 1, 0, 0, 0, 0)$\n- $M_2 = (1, 0, 0, 0, 1, 0, 0)$\n- $M_3 = (0, 0, 0, 1, 0, 0, 1)$\n- $M_4 = (0, 0, 0, 0, 0, 1, 1)$\n\nThe number of reachable markings in the supervised net is $5$.",
            "answer": "$$\n\\boxed{5}\n$$"
        }
    ]
}