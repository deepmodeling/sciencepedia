{
    "hands_on_practices": [
        {
            "introduction": "Collision avoidance is arguably the most fundamental safety requirement for any multi-agent system. Control Barrier Functions (CBFs) provide a rigorous mathematical framework to synthesize controllers that provably maintain the system's state within a designated \"safe\" region. This exercise will strengthen your understanding of how to formally guarantee safety in swarm dynamics by deriving the precise relationship between control parameters and safety constraints, determining the minimum repulsion strength needed to prevent collisions .",
            "id": "4249437",
            "problem": "Consider a swarm of $N$ identical planar agents in a Cyber-Physical System (CPS) whose motion is modeled kinematically as $\\dot{x}_i(t) = u_i(t)$ with $x_i(t) \\in \\mathbb{R}^2$ and control $u_i(t) \\in \\mathbb{R}^2$. A digital twin of the swarm implements a flocking controller with two components: an attractive consensus term and a short-range repulsion term that is activated near a prescribed safety distance. Specifically, for agent $i$,\n$$\nu_i \\,=\\, u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}},\n$$\nwhere the attractive consensus is\n$$\nu_i^{\\mathrm{att}} \\,=\\, -\\,b \\sum_{j \\neq i} \\big(x_i - x_j\\big),\n$$\nwith constant $b > 0$, and the repulsion is\n$$\nu_i^{\\mathrm{rep}} \\,=\\, \\alpha \\sum_{j \\neq i} \\sigma\\!\\big(r_{ij}\\big)\\, r_{ij}^{-q} \\,\\frac{x_i - x_j}{r_{ij}},\n$$\nwith $r_{ij} := \\|x_i - x_j\\|$, exponent $q > 0$, strength $\\alpha > 0$, and a binary activation function $\\sigma(r)$ defined as $\\sigma(r) = 1$ if $r \\le d_0$ and $\\sigma(r) = 0$ if $r > d_0$, where $d_0 > 0$ is the prescribed minimum separation distance. The digital twin enforces pairwise safety via the Control Barrier Function (CBF) $h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$, requiring forward invariance of the safe set $\\{x : h_{ij}(x) \\ge 0 \\ \\text{for all}\\ i \\neq j\\}$.\n\nStarting from first principles (definitions of relative distance dynamics and the forward invariance condition for zeroing barrier certificates), derive a closed-form lower bound on the repulsion strength $\\alpha$ in terms of $N$, $b$, $d_0$, and $q$ that guarantees $\\dot{h}_{ij}(x) \\ge 0$ at every boundary point where $h_{ij}(x) = 0$. Assume the worst-case that, at $h_{ij}(x) = 0$, only the repulsion between agents $i$ and $j$ is active for that pair, while other pairs are not simultaneously at their activation boundary. Express your final answer as a single analytic expression in terms of $N$, $b$, $d_0$, and $q$. No numerical approximation is required.",
            "solution": "The user wants to find a lower bound on the repulsion strength, denoted by the parameter $\\alpha$ in a swarm of agents, that guarantees pairwise safety. Safety is defined by the Control Barrier Function (CBF) constraint $\\dot{h}_{ij}(x) \\ge 0$ whenever $h_{ij}(x) = 0$.\n\nFirst, a validation of the problem statement is performed.\n\n### Step 1: Extract Givens\n-   Number of agents: $N$.\n-   Agent state: $x_i(t) \\in \\mathbb{R}^2$.\n-   Agent dynamics: $\\dot{x}_i(t) = u_i(t)$, with control input $u_i(t) \\in \\mathbb{R}^2$.\n-   Control law: $u_i = u_i^{\\mathrm{att}} + u_i^{\\mathrm{rep}}$.\n-   Attractive component: $u_i^{\\mathrm{att}} = -b \\sum_{j \\neq i} (x_i - x_j)$, with constant $b > 0$.\n-   Repulsive component: $u_i^{\\mathrm{rep}} = \\alpha \\sum_{j \\neq i} \\sigma(r_{ij}) r_{ij}^{-q} \\frac{x_i - x_j}{r_{ij}}$, with $r_{ij} := \\|x_i - x_j\\|$, exponent $q > 0$, and strength $\\alpha > 0$.\n-   Activation function: $\\sigma(r) = 1$ if $r \\le d_0$ and $\\sigma(r) = 0$ if $r > d_0$, where $d_0 > 0$ is the minimum separation distance.\n-   Control Barrier Function: $h_{ij}(x) := \\|x_i - x_j\\|^2 - d_0^2$.\n-   Safety condition: $\\dot{h}_{ij}(x) \\ge 0$ must hold at every boundary point where $h_{ij}(x) = 0$.\n-   Worst-case assumption: At $h_{ij}(x) = 0$, only the repulsion between agents $i$ and $j$ is active for that pair ($\\sigma(r_{ij})=1$), while for any other agent $k \\neq i, j$, the distances $r_{ik}$ and $r_{jk}$ are greater than $d_0$ (i.e., $\\sigma(r_{ik}) = \\sigma(r_{jk}) = 0$).\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is based on established principles of multi-agent systems, control theory, and specifically the Control Barrier Function (CBF) methodology for safety-critical control. The models for flocking (attraction/repulsion) and kinematic agents are standard in the field.\n-   **Well-Posed**: The problem provides all necessary definitions and equations to derive the requested lower bound. The \"worst-case\" assumption is explicitly stated, which makes the problem tractable and leads to a unique analytical solution.\n-   **Objective**: The language is precise and mathematical. All terms are clearly defined.\n-   **Completeness and Consistency**: The problem is self-contained. The definitions and constraints are consistent with each other. No essential information is missing.\n-   **Realism**: The model is a common and valid simplification of agent dynamics used in robotics and cyber-physical systems research.\nThe problem is deemed valid.\n\n### Derivation of the Lower Bound\nThe safety of the system is guaranteed if the set $\\{x : h_{ij}(x) \\ge 0, \\forall i \\neq j\\}$ is forward invariant. For a zeroing barrier certificate like the one given, this condition is satisfied if $\\dot{h}_{ij}(x) \\ge 0$ for all pairs $(i, j)$ on the boundary of the safe set, i.e., where $h_{ij}(x) = 0$.\n\nThe barrier function is $h_{ij}(x) = \\|x_i - x_j\\|^2 - d_0^2$.\nThe condition $h_{ij}(x) = 0$ implies that the distance between agents $i$ and $j$ is exactly the safety distance, i.e., $r_{ij} = \\|x_i - x_j\\| = d_0$.\n\nWe compute the time derivative of $h_{ij}(x)$ along the system trajectories:\n$$\n\\dot{h}_{ij} = \\frac{d}{dt} \\left( (x_i - x_j)^T(x_i - x_j) - d_0^2 \\right) = 2(x_i - x_j)^T (\\dot{x}_i - \\dot{x}_j).\n$$\nSubstituting the system dynamics $\\dot{x}_i = u_i$, we get:\n$$\n\\dot{h}_{ij} = 2(x_i - x_j)^T (u_i - u_j).\n$$\nThe safety condition is $\\dot{h}_{ij} \\ge 0$, which translates to:\n$$\n2(x_i - x_j)^T (u_i - u_j) \\ge 0.\n$$\nNow, we must find an expression for the relative control input $u_i - u_j$.\n$$\nu_i - u_j = (u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}) + (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}).\n$$\nLet's analyze each component separately.\n\n1.  **Attractive Component Difference ($u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}}$):**\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = \\left(-b \\sum_{k \\neq i} (x_i - x_k)\\right) - \\left(-b \\sum_{k \\neq j} (x_j - x_k)\\right) = -b \\left( \\sum_{k \\neq i} (x_i - x_k) - \\sum_{k \\neq j} (x_j - x_k) \\right).\n    $$\n    We can rewrite the sums by separating the terms involving agents $i$ and $j$:\n    $$\n    \\sum_{k \\neq i} (x_i - x_k) = (x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_k).\n    $$\n    $$\n    \\sum_{k \\neq j} (x_j - x_k) = (x_j - x_i) + \\sum_{k \\neq i,j} (x_j - x_k).\n    $$\n    Subtracting the second from the first gives:\n    $$\n    (x_i - x_j) - (x_j - x_i) + \\sum_{k \\neq i,j} \\left( (x_i - x_k) - (x_j - x_k) \\right) = 2(x_i - x_j) + \\sum_{k \\neq i,j} (x_i - x_j).\n    $$\n    There are $N-2$ agents with index $k \\neq i,j$. Thus:\n    $$\n    2(x_i - x_j) + (N-2)(x_i - x_j) = N(x_i - x_j).\n    $$\n    Therefore, the attractive component difference is:\n    $$\n    u_i^{\\mathrm{att}} - u_j^{\\mathrm{att}} = -b N (x_i - x_j).\n    $$\n\n2.  **Repulsive Component Difference ($u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}$):**\n    The repulsive control is given by $u_i^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq i} \\sigma(r_{ik}) r_{ik}^{-(q+1)} (x_i - x_k)$.\n    We evaluate this at the boundary $h_{ij}(x) = 0$, where $r_{ij} = d_0$. According to the problem's assumption, at this point, $\\sigma(r_{ij})=1$, but for any other agent $k \\neq i,j$, we have $r_{ik} > d_0$ and $r_{jk} > d_0$, which means $\\sigma(r_{ik})=0$ and $\\sigma(r_{jk})=0$.\n    This simplifies the sums significantly. For $u_i^{\\mathrm{rep}}$, the only non-zero term in the summation is when $k=j$:\n    $$\n    u_i^{\\mathrm{rep}} = \\alpha \\sigma(r_{ij}) r_{ij}^{-(q+1)} (x_i - x_j).\n    $$\n    Since $r_{ij} = d_0$ and $\\sigma(r_{ij})=1$ at the boundary:\n    $$\n    u_i^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    Similarly, for $u_j^{\\mathrm{rep}} = \\alpha \\sum_{k \\neq j} \\sigma(r_{jk}) r_{jk}^{-(q+1)} (x_j - x_k)$, the only non-zero term is when $k=i$:\n    $$\n    u_j^{\\mathrm{rep}} = \\alpha \\sigma(r_{ji}) r_{ji}^{-(q+1)} (x_j - x_i).\n    $$\n    Since $r_{ji}=r_{ij}=d_0$ and $\\sigma(r_{ji})=1$:\n    $$\n    u_j^{\\mathrm{rep}} \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)} (x_j - x_i) = -\\alpha d_0^{-(q+1)} (x_i - x_j).\n    $$\n    The difference is then:\n    $$\n    (u_i^{\\mathrm{rep}} - u_j^{\\mathrm{rep}}) \\Big|_{h_{ij}=0} = \\alpha d_0^{-(q+1)}(x_i-x_j) - (-\\alpha d_0^{-(q+1)}(x_i-x_j)) = 2\\alpha d_0^{-(q+1)}(x_i-x_j).\n    $$\n\nNow, we combine these results and substitute them back into the safety condition for $\\dot{h}_{ij}$, evaluated at the boundary $h_{ij}=0$:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2(x_i - x_j)^T \\left( -bN(x_i - x_j) + 2\\alpha d_0^{-(q+1)}(x_i - x_j) \\right).\n$$\nUsing the identity $(x_i-x_j)^T(x_i-x_j) = \\|x_i-x_j\\|^2 = r_{ij}^2$, and knowing that $r_{ij}=d_0$ at the boundary:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN\\|x_i - x_j\\|^2 + 2\\alpha d_0^{-(q+1)}\\|x_i - x_j\\|^2 \\right) = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-(q+1)}d_0^2 \\right).\n$$\nSimplifying the exponents:\n$$\n\\dot{h}_{ij} \\Big|_{h_{ij}=0} = 2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right).\n$$\nThe safety condition requires $\\dot{h}_{ij} \\ge 0$:\n$$\n2 \\left( -bN d_0^2 + 2\\alpha d_0^{-q+1} \\right) \\ge 0.\n$$\n$$\n-bN d_0^2 + 2\\alpha d_0^{-q+1} \\ge 0.\n$$\nWe now solve for $\\alpha$:\n$$\n2\\alpha d_0^{-q+1} \\ge bN d_0^2.\n$$\n$$\n\\alpha \\ge \\frac{bN d_0^2}{2 d_0^{-q+1}}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2 - (-q+1)}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{2+q-1}.\n$$\n$$\n\\alpha \\ge \\frac{bN}{2} d_0^{q+1}.\n$$\nThis gives the closed-form lower bound on the repulsion strength $\\alpha$ that guarantees safety under the specified conditions.",
            "answer": "$$\n\\boxed{\\frac{bN}{2} d_0^{q+1}}\n$$"
        },
        {
            "introduction": "Beyond physical safety, the ability of a swarm to agree on a common value—a process known as consensus—is a cornerstone of collective intelligence and decision-making. While powerful, distributed consensus algorithms can be compromised by real-world hardware imperfections like constant sensor biases, leading to a persistent disagreement or \"drift\" from the true value. This practice challenges you to first quantify the steady-state error introduced by such biases and then to design a distributed, cyber-layer calibration protocol that enables the swarm to achieve accurate consensus despite these imperfections .",
            "id": "4249398",
            "problem": "Consider a connected swarm of $n$ cyber-physical agents forming a networked Cyber-Physical System (CPS). The communication topology is an undirected, connected, weighted graph with symmetric adjacency weights $a_{ij} = a_{ji} \\geq 0$, Laplacian matrix $L \\in \\mathbb{R}^{n \\times n}$ defined by $L = D - A$, degree matrix $D = \\mathrm{diag}(d_{1},\\ldots,d_{n})$ with $d_{i} = \\sum_{j=1}^{n} a_{ij}$, and $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$ where $\\mathbf{1} \\in \\mathbb{R}^{n}$ is the all-ones vector.\n\nEach agent $i \\in \\{1,\\dots,n\\}$ holds a physical state $x_{i}(t)$ and a digital twin that communicates with neighbors. The agent measures a biased quantity $y_{i}(t) = x_{i}(t) + \\beta_{i}$, where the sensor bias $\\beta_{i} \\in \\mathbb{R}$ is constant but unknown, and runs continuous-time average-consensus using neighbor exchanges of the measured $y_{j}(t)$:\n$$\n\\dot{x}_{i}(t) = \\sum_{j=1}^{n} a_{ij} \\big(y_{j}(t) - y_{i}(t)\\big).\n$$\nLet $x(0) \\in \\mathbb{R}^{n}$ denote the initial state vector and define the unbiased true average $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(0)$. Under the above protocol, the swarm attempts to reach an agreement about the average, but the biases $\\beta_{i}$ perturb the evolution.\n\nTask 1: Starting from the protocol, graph definitions, and the measurement model, derive the steady-state error vector $e^{\\star} \\in \\mathbb{R}^{n}$ with entries $e^{\\star}_{i} = x^{\\star}_{i} - \\bar{x}$, where $x^{\\star}$ denotes the $t \\to \\infty$ limit of $x(t)$ under the biased consensus dynamics. Express $e^{\\star}$ in closed form in terms of $\\beta \\in \\mathbb{R}^{n}$ and the scalar average bias $\\bar{\\beta} = \\frac{1}{n} \\mathbf{1}^{\\top} \\beta$.\n\nTask 2: Propose a distributed cyber-layer calibration scheme that augments each agent with an estimator state $\\hat{\\beta}_{i}(t)$ inside its digital twin and replaces the measured input $y_{i}(t)$ by a calibrated input $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$ in the consensus update. Using only neighbor exchanges and the Laplacian coupling, specify local dynamics for $\\hat{\\beta}_{i}(t)$ and the modified consensus dynamics such that all agents converge to the unbiased average $\\bar{x}$ despite arbitrary constant biases $\\beta_{i}$. Derive the stacked closed-loop dynamics, identify invariants, and give sufficient conditions on a scalar estimator gain $\\gamma > 0$ and an initialization criterion that ensure convergence to $x_{i}(t) \\to \\bar{x}$ for all $i$. No numerical approximation is required.\n\nYour final answer must be the closed-form expression for $e^{\\star}$ obtained in Task 1. No rounding is required, and no units are necessary.",
            "solution": "We first express the dynamics in stacked vector form and analyze the bias-induced perturbation. Define the vectors $x(t) \\in \\mathbb{R}^{n}$, $y(t) \\in \\mathbb{R}^{n}$, and $\\beta \\in \\mathbb{R}^{n}$ with components $x_{i}(t)$, $y_{i}(t)$, and $\\beta_{i}$, respectively. The measurement model is $y(t) = x(t) + \\beta$. The average-consensus protocol in stacked form is\n$$\n\\dot{x}(t) = -L y(t) = -L \\big(x(t) + \\beta\\big) = -L x(t) - L \\beta.\n$$\nWe recall fundamental facts for connected, undirected graphs: $L$ is symmetric positive semidefinite with $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$, all other eigenvalues are strictly positive, and the average under the standard consensus flow is invariant because $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$. These properties imply $\\mathbf{1}^{\\top} \\dot{x}(t) = -\\mathbf{1}^{\\top} L \\big(x(t) + \\beta\\big) = 0$, so the average $\\bar{x} = \\frac{1}{n} \\mathbf{1}^{\\top} x(t)$ is constant in time and equal to $\\frac{1}{n} \\mathbf{1}^{\\top} x(0)$.\n\nTo characterize the steady state, consider the evolution of $z(t) \\triangleq x(t) + \\beta$. Using the dynamics above,\n$$\n\\dot{z}(t) = \\dot{x}(t) = -L \\big(x(t) + \\beta\\big) = -L z(t).\n$$\nThus $z(t)$ follows a standard consensus flow. For a connected graph, the solution satisfies\n$$\n\\lim_{t \\to \\infty} z(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} z(0) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} \\big(x(0) + \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1}.\n$$\nTherefore, the steady state $x^{\\star}$ is\n$$\nx^{\\star} = \\lim_{t \\to \\infty} x(t) = \\lim_{t \\to \\infty} \\big(z(t) - \\beta\\big) = \\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta.\n$$\nDefine the error vector $e^{\\star} \\in \\mathbb{R}^{n}$ relative to the unbiased average $\\bar{x}$ by $e^{\\star} = x^{\\star} - \\bar{x}\\mathbf{1}$. Substituting the expression for $x^{\\star}$ yields\n$$\ne^{\\star} = \\Big(\\big(\\bar{x} + \\bar{\\beta}\\big)\\mathbf{1} - \\beta\\Big) - \\bar{x}\\mathbf{1} = \\bar{\\beta}\\,\\mathbf{1} - \\beta.\n$$\nComponentwise, $e^{\\star}_{i} = \\bar{\\beta} - \\beta_{i}$ for all $i$. This shows that, absent calibration, each agent’s steady-state error relative to the true average is the difference between the network-average bias and its local bias, and the swarm fails to reach equal states unless all $\\beta_{i}$ are identical.\n\nWe now propose a distributed calibration scheme that eliminates drift by estimating and subtracting the bias. Each agent maintains an estimator state $\\hat{\\beta}_{i}(t)$, and the calibrated input is $r_{i}(t) = y_{i}(t) - \\hat{\\beta}_{i}(t)$. The modified consensus update is\n$$\n\\dot{x}(t) = -L r(t) = -L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\nwhere $r(t) \\in \\mathbb{R}^{n}$ and $\\hat{\\beta}(t) \\in \\mathbb{R}^{n}$ stack the components $r_{i}(t)$ and $\\hat{\\beta}_{i}(t)$, respectively. We choose a simple distributed estimator driven by Laplacian coupling:\n$$\n\\dot{\\hat{\\beta}}(t) = \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big),\n$$\nwith scalar gain $\\gamma > 0$. Both updates use only neighbor exchanges via $L$ and are implementable in a CPS using local twin computations and communications.\n\nDefine $s(t) \\triangleq y(t) - \\hat{\\beta}(t) = x(t) + \\beta - \\hat{\\beta}(t)$. Combining the two dynamics,\n$$\n\\dot{s}(t) = \\dot{y}(t) - \\dot{\\hat{\\beta}}(t) = \\dot{x}(t) - \\gamma\\, L \\big(y(t) - \\hat{\\beta}(t)\\big) = -L s(t) - \\gamma\\, L s(t) = -(1+\\gamma) L s(t).\n$$\nThus $s(t)$ is a consensus state evolving under a Laplacian flow with rate factor $(1+\\gamma)$. For a connected graph, the average $\\bar{s}(t) = \\frac{1}{n} \\mathbf{1}^{\\top} s(t)$ is invariant since $\\mathbf{1}^{\\top} L = \\mathbf{0}^{\\top}$, and\n$$\n\\lim_{t \\to \\infty} s(t) = \\frac{1}{n} \\mathbf{1}\\mathbf{1}^{\\top} s(0) = \\bar{s}(0)\\,\\mathbf{1}.\n$$\nBecause $s(0) = y(0) - \\hat{\\beta}(0) = x(0) + \\beta - \\hat{\\beta}(0)$, its initial average is $\\bar{s}(0) = \\bar{x} + \\bar{\\beta} - \\bar{\\hat{\\beta}}(0)$. If the initialization satisfies the scalar criterion\n$$\n\\bar{\\hat{\\beta}}(0) = \\bar{\\beta},\n$$\nthen $\\bar{s}(0) = \\bar{x}$ and $s(t) \\to \\bar{x}\\,\\mathbf{1}$. With $s(t)$ approaching $\\bar{x}\\,\\mathbf{1}$, the modified consensus dynamics become asymptotically\n$$\n\\dot{x}(t) = -L s(t) \\to -L \\big(\\bar{x}\\,\\mathbf{1}\\big) = \\mathbf{0},\n$$\nand, by standard consensus convergence on the subspace orthogonal to $\\mathbf{1}$, $x(t)$ converges to the constant vector $\\bar{x}\\,\\mathbf{1}$ regardless of the unknown biases $\\beta_{i}$. The sufficient conditions for convergence are:\n- the communication graph is undirected and connected so that $L$ has $\\mathrm{null}(L) = \\mathrm{span}\\{\\mathbf{1}\\}$ and positive eigenvalues elsewhere;\n- the estimator gain satisfies $\\gamma > 0$, which ensures $-(1+\\gamma)L$ is negative semidefinite with strict decay on the subspace orthogonal to $\\mathbf{1}$;\n- the estimator average is initialized to the average bias, $\\bar{\\hat{\\beta}}(0) = \\bar{\\beta}$, which can be achieved, for example, via a one-time distributed calibration procedure to estimate the network-average of initial residuals or by any mechanism that aligns the estimator’s mean with the mean bias.\n\nUnder these conditions, the closed-loop stacked dynamics for $(x,s)$ are\n$$\n\\begin{pmatrix}\n\\dot{x}(t) \\\\\n\\dot{s}(t)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 & -L \\\\\n0 & -(1+\\gamma)L\n\\end{pmatrix}\n\\begin{pmatrix}\nx(t) \\\\\ns(t)\n\\end{pmatrix},\n$$\nwith $s(t)$ converging to $\\bar{x}\\,\\mathbf{1}$ and $x(t)$ converging to $\\bar{x}\\,\\mathbf{1}$, thereby eliminating drift and restoring convergence to the unbiased average.\n\nReturning to Task 1, the steady-state error for the uncalibrated case is\n$$\ne^{\\star} = \\bar{\\beta}\\,\\mathbf{1} - \\beta,\n$$\na closed-form expression entirely in terms of the bias vector and its network-average.",
            "answer": "$$\\boxed{\\bar{\\beta}\\,\\mathbf{1}-\\beta}$$"
        },
        {
            "introduction": "With robust low-level safety and information-sharing protocols established, a swarm can be directed to perform useful collective work. When agents are heterogeneous—possessing different capabilities or efficiencies for different tasks—allocating this work becomes a critical optimization problem to maximize overall performance. In this final practice, you will formulate a practical task allocation scenario as a makespan minimization problem, using linear programming to find the optimal, equilibrium distribution of work that minimizes the total time required for the swarm to complete all its assigned tasks .",
            "id": "4249435",
            "problem": "Consider a Cyber-Physical System (CPS) in which a Digital Twin (DT) supervises a swarm of heterogeneous mobile agents performing inspection tasks over a set of task types. Each task type represents a class of inspection segments (for example, pipeline, overhead line, or rail), each with a total required inspection workload. The DT estimates agent-type-specific effective inspection speeds and seeks an allocation that minimizes the overall completion time. The completion time is the time until all assigned inspection workloads are completed by all agents, assuming continuous, divisible workloads and no interference between agents. Your objective is to compute the equilibrium allocation of workloads across agents and task types that minimizes the total makespan, and to report the minimal makespan and the corresponding allocations for each provided test case.\n\nFundamental base and definitions:\n- Let there be $n$ agents indexed by $i \\in \\{1,\\dots,n\\}$ and $m$ task types indexed by $t \\in \\{1,\\dots,m\\}$. The total workload for task type $t$ is $W_t$ in meters, and the effective inspection speed of agent $i$ on task type $t$ is $s_{i,t}$ in meters per second.\n- For a given allocation of workloads $x_{i,t}$ (in meters) from task type $t$ to agent $i$, the time agent $i$ spends is\n$$\nT_i = \\sum_{t=1}^{m} \\frac{x_{i,t}}{s_{i,t}},\n$$\nwith the understanding that if $s_{i,t} = 0$, then $x_{i,t}$ must be $0$, since agent $i$ cannot perform task type $t$.\n- The makespan $C$ is defined as\n$$\nC = \\max_{i \\in \\{1,\\dots,n\\}} T_i.\n$$\n- The allocation must satisfy conservation of workload for each task type:\n$$\n\\sum_{i=1}^{n} x_{i,t} = W_t \\quad \\text{for all } t \\in \\{1,\\dots,m\\},\n$$\nwith $x_{i,t} \\ge 0$ for all $i,t$.\n\nTask:\n- Using only the fundamental definitions above, determine the allocation $x_{i,t}$ and the minimal makespan $C^\\star$ that solve the equilibrium task allocation minimizing the makespan $C$ subject to the constraints, for each test case specified below.\n\nUnits and reporting:\n- All workloads $x_{i,t}$ and $W_t$ are in meters.\n- All speeds $s_{i,t}$ are in meters per second.\n- All times, including the makespan $C^\\star$, must be reported in seconds.\n- Report all numeric outputs rounded to $6$ decimal places.\n\nFinal output format:\n- For each test case, return a list containing two elements:\n    1. The minimal makespan $C^\\star$ in seconds (a float).\n    2. The flattened allocation list in meters (a list of floats).\n- The flattened allocation list must be ordered by task type index $t$ ascending, and within each task type by agent index $i$ ascending, i.e., $[x_{1,1}, x_{2,1}, \\dots, x_{n,1}, x_{1,2}, \\dots, x_{n,2}, \\dots, x_{n,m}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets with no whitespace characters. For example, for two test cases, the output format is\n$$\n[[C_1,[x_{1,1},\\dots,x_{n,m}]], [C_2,[x_{1,1},\\dots,x_{n,m}]]]\n$$\nwith all numbers rounded to $6$ decimal places.\n\nTest suite:\n- Test Case $1$ (general heterogeneous case):\n    - Agents: $n = 3$, Task types: $m = 2$.\n    - Workloads: $W = [1000, 500]$ meters.\n    - Speeds (meters per second): \n      $s = \\begin{bmatrix}\n      1.5 & 1.0 \\\\\n      1.0 & 2.0 \\\\\n      0.8 & 0.5\n      \\end{bmatrix}$.\n- Test Case $2$ (boundary with an agent unable to perform a type):\n    - Agents: $n = 2$, Task types: $m = 3$.\n    - Workloads: $W = [600, 300, 400]$ meters.\n    - Speeds (meters per second): \n      $s = \\begin{bmatrix}\n      1.2 & 0.0 & 0.9 \\\\\n      0.9 & 1.5 & 0.7\n      \\end{bmatrix}$.\n- Test Case $3$ (identical agents, single type):\n    - Agents: $n = 4$, Task types: $m = 1$.\n    - Workloads: $W = [1000]$ meters.\n    - Speeds (meters per second):\n      $s = \\begin{bmatrix}\n      1.0 \\\\\n      1.0 \\\\\n      1.0 \\\\\n      1.0\n      \\end{bmatrix}$.\n- Test Case $4$ (strong specialization per type):\n    - Agents: $n = 3$, Task types: $m = 3$.\n    - Workloads: $W = [500, 300, 200]$ meters.\n    - Speeds (meters per second):\n      $s = \\begin{bmatrix}\n      2.5 & 0.1 & 0.1 \\\\\n      0.2 & 2.0 & 0.2 \\\\\n      0.1 & 0.1 & 3.0\n      \\end{bmatrix}$.\n\nAnswer type:\n- The final output must be a list of $4$ entries, one per test case, where each entry is itself a list consisting of the makespan in seconds (float) and the flattened allocation list in meters (list of floats), all numbers rounded to $6$ decimal places, and printed as a single line exactly in the format specified above, without whitespace.",
            "solution": "The user-provided problem is a valid optimization task. The problem asks for the minimum makespan (overall completion time) and the corresponding workload allocation for a swarm of heterogeneous agents performing a set of inspection tasks.\n\n### Step 1: Extract Givens\n- **Number of agents**: $n$\n- **Number of task types**: $m$\n- **Total workload for task type $t$**: $W_t$ (meters)\n- **Effective inspection speed of agent $i$ on task type $t$**: $s_{i,t}$ (meters/second)\n- **Workload allocation**: $x_{i,t}$ is the workload of type $t$ assigned to agent $i$ (meters).\n- **Time for agent $i$**: $T_i = \\sum_{t=1}^{m} \\frac{x_{i,t}}{s_{i,t}}$. If $s_{i,t} = 0$, then $x_{i,t}$ must be $0$.\n- **Makespan**: $C = \\max_{i \\in \\{1,\\dots,n\\}} T_i$.\n- **Constraint 1 (Workload Conservation)**: $\\sum_{i=1}^{n} x_{i,t} = W_t$ for all $t \\in \\{1,\\dots,m\\}$.\n- **Constraint 2 (Non-negativity)**: $x_{i,t} \\ge 0$ for all $i,t$.\n- **Objective**: Minimize the makespan $C$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is a classic makespan minimization problem on unrelated parallel machines with divisible jobs. This is a well-established topic in operations research and computer science, directly applicable to multi-agent and cyber-physical systems. The formulation is based on fundamental and sound mathematical principles.\n2.  **Well-Posed**: The problem is to find an optimal allocation that minimizes a well-defined objective function ($C$) subject to a set of linear constraints. This can be formulated as a Linear Program (LP). Since the objective function is convex (a maximum of linear functions is convex) and the feasible region defined by the linear constraints is a convex set, a unique minimum makespan $C^\\star$ exists.\n3.  **Objective**: All terms ($W_t, s_{i,t}, x_{i,t}, T_i, C$) are quantitatively defined. The objective (minimize $C$) is clear and unambiguous.\n\nThe problem is self-contained, consistent, and does not violate any of the invalidity criteria. All provided test cases are numerically consistent with the definitions.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\nThe goal is to find the minimal makespan $C^\\star$ and the corresponding allocation matrix $x_{i,t}^\\star$. This can be formulated and solved as a single Linear Programming (LP) problem.\n\n**1. Formulation as a Linear Program**\n\nWe define a set of decision variables, an objective function to minimize, and a set of constraints.\n\n- **Decision Variables**:\n    1.  The workload allocations $x_{i,t}$ for each agent $i \\in \\{1, \\dots, n\\}$ and task type $t \\in \\{1, \\dots, m\\}$.\n    2.  The makespan $C$.\n    The total number of variables is $n \\times m + 1$.\n\n- **Objective Function**:\n    The objective is to minimize the makespan $C$.\n    $$ \\text{Minimize} \\quad C $$\n\n- **Constraints**:\n    1.  **Makespan Constraint**: The time $T_i$ for each agent must be less than or equal to the makespan $C$.\n        $$ T_i = \\sum_{t=1}^{m} \\frac{x_{i,t}}{s_{i,t}} \\le C \\quad \\text{for each agent } i \\in \\{1, \\dots, n\\} $$\n        This can be rewritten as:\n        $$ \\sum_{t=1}^{m} \\frac{x_{i,t}}{s_{i,t}} - C \\le 0 $$\n    2.  **Workload Conservation**: The sum of workloads allocated to all agents for a specific task type must equal the total workload for that type.\n        $$ \\sum_{i=1}^{n} x_{i,t} = W_t \\quad \\text{for each task type } t \\in \\{1, \\dots, m\\} $$\n    3.  **Non-negativity and Feasibility**: All allocated workloads must be non-negative. Additionally, if an agent's speed for a task is zero ($s_{i,t}=0$), it cannot be assigned any of that workload ($x_{i,t}=0$).\n        $$ x_{i,t} \\ge 0 \\quad \\text{for all } i, t $$\n        If $s_{i,t}=0$, we enforce $x_{i,t}=0$.\n\n**2. LP Standard Form for a Solver**\n\nTo use a standard LP solver like `scipy.optimize.linprog`, we represent the problem in matrix form:\n$$ \\text{Minimize} \\quad \\mathbf{c}^T \\mathbf{v} $$\n$$ \\text{subject to} \\quad \\mathbf{A_{ub}} \\mathbf{v} \\le \\mathbf{b_{ub}} $$\n$$ \\quad \\mathbf{A_{eq}} \\mathbf{v} = \\mathbf{b_{eq}} $$\n$$ \\quad \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u} $$\n\nLet the vector of variables $\\mathbf{v}$ be ordered as follows, with $nm+1$ total variables:\n$$ \\mathbf{v} = [x_{1,1}, x_{2,1}, \\dots, x_{n,1}, x_{1,2}, \\dots, x_{n,m}, C]^T $$\nThe index of variable $x_{i,t}$ is $(t-1)n + (i-1)$, and the index of $C$ is $nm$.\n\nThe components of the LP are:\n\n- **Objective vector $\\mathbf{c}$**: A vector of zeros, with a $1$ at the last position corresponding to the variable $C$.\n  $$ \\mathbf{c} = [0, \\dots, 0, 1]^T $$\n\n- **Equality constraints $(\\mathbf{A_{eq}}, \\mathbf{b_{eq}})$**: These $m$ constraints represent workload conservation. For each task $t \\in \\{1, \\dots, m\\}$, we have one equation. The matrix $\\mathbf{A_{eq}}$ has dimensions $m \\times (nm+1)$, and $\\mathbf{b_{eq}}$ is a vector of length $m$.\n  For row $t-1$ of $\\mathbf{A_{eq}}$ (for task $t$):\n  $$ (\\mathbf{A_{eq}})_{t-1, (t-1)n + i-1} = 1 \\quad \\text{for } i=1, \\dots, n $$\n  All other entries in this row are $0$. The corresponding entry in $\\mathbf{b_{eq}}$ is:\n  $$ (\\mathbf{b_{eq}})_{t-1} = W_t $$\n\n- **Inequality constraints $(\\mathbf{A_{ub}}, \\mathbf{b_{ub}})$**: These $n$ constraints come from the makespan definition. For each agent $i \\in \\{1, \\dots, n\\}$, we have one inequality. The matrix $\\mathbf{A_{ub}}$ has dimensions $n \\times (nm+1)$, and $\\mathbf{b_{ub}}$ is a vector of $n$ zeros.\n  For row $i-1$ of $\\mathbf{A_{ub}}$ (for agent $i$):\n  $$ (\\mathbf{A_{ub}})_{i-1, (t-1)n + i-1} = \\frac{1}{s_{i,t}} \\quad \\text{for } t=1, \\dots, m \\text{ (if } s_{i,t}>0) $$\n  $$ (\\mathbf{A_{ub}})_{i-1, nm} = -1 $$\n  All other entries in this row are $0$. The vector $\\mathbf{b_{ub}}$ is always a zero vector of length $n$.\n\n- **Bounds $(\\mathbf{l}, \\mathbf{u})$**: These define the domain for each variable.\n  - For all $x_{i,t}$ where $s_{i,t} > 0$, the bound is $[0, \\infty)$.\n  - For all $x_{i,t}$ where $s_{i,t} = 0$, the bound is $[0, 0]$ (i.e., $x_{i,t}=0$).\n  - For $C$, the bound is $[0, \\infty)$.\n\nBy constructing these matrices and vectors, we can use a numerical LP solver to find the optimal values for $\\mathbf{v}$, which contains the minimal makespan $C^\\star$ and the optimal allocations $x_{i,t}^\\star$. The final allocations are then formatted as required.",
            "answer": "[[594.835671,[742.253521,257.746479,0.000000,100.000000,329.507042,70.492958]],[722.902494,[331.428571,268.571429,0.000000,300.000000,242.857143,157.142857]],[250.000000,[250.000000,250.000000,250.000000,250.000000]],[200.000000,[500.000000,0.000000,0.000000,0.000000,300.000000,0.000000,0.000000,0.000000,200.000000]]]"
        }
    ]
}