## 引言
在现代赛博物理系统（CPS）的设计与运行中，不确定性是一个无法回避的核心挑战。尽管[数字孪生](@entry_id:171650)等技术提供了前所未有的高保真度模型，但模型与物理现实之间的差异、外部环境的扰动以及测量噪声依然存在。若不加以妥善处理，这些不确定性将严重威胁系统的性能、安全性乃至稳定性。因此，开发能够在不确定性存在下保证可靠运行的控制策略，已成为控制理论与工程实践中的关键议题。

本文旨在系统性地探讨两种主流的、用于处理[模型预测控制](@entry_id:1128006)（MPC）中不确定性的先进方法：基于“管道”（Tube-based）的[鲁棒MPC](@entry_id:174393)和[随机MPC](@entry_id:1132433)（Stochastic MPC）。我们将从基本原理出发，逐步深入到它们在复杂工程系统中的实际应用，最终通过实践练习巩固所学知识。

在“原理与机制”一章中，我们将剖析这两种方法背后的数学思想，理解它们如何分别通过[最坏情况分析](@entry_id:168192)和概率性保证来确保系统安全。随后的“应用与跨学科连接”一章，将展示这些理论如何应用于网络化系统、大规模基础设施和[数字孪生](@entry_id:171650)等前沿领域，揭示其跨学科的价值。最后，“动手实践”部分将提供具体的计算练习，帮助读者将理论知识转化为实践技能。通过这三个层次的深入学习，读者将能够全面掌握在不确定环境下设计安全、高效控制系统的核心技术。

## 原理与机制

本章旨在深入探讨在模型预测控制（MPC）框架下处理不确定性的核心原理与机制。在理想化的控制问题中，我们假设系统模型是精确的。然而，在现实世界的赛博物理系统（CPS）中，模型与物理现实之间总是存在差异。这些差异，即不确定性，若不加以妥善处理，可能导致性能下降、违反约束，甚至系统不稳定。本章将系统性地介绍两种主流的应对不确定性的思想范式：基于“管道”（Tube-based）的[鲁棒MPC](@entry_id:174393)和[随机MPC](@entry_id:1132433)（Stochastic MPC），并进一步探讨连接二者的现代方法——分布[鲁棒MPC](@entry_id:174393)。

### 不确定性的基本挑战与分类

在深入探讨控制策略之前，我们必须首先理解并区分[模型不确定性](@entry_id:265539)的主要类型。考虑一个由数字孪生监督的离散时间[线性系统](@entry_id:147850)，其动态通常被建模为：

$x_{k+1} = A x_k + B u_k + w_k$

其中，$x_k \in \mathbb{R}^n$ 是系统状态，$u_k \in \mathbb{R}^m$ 是控制输入，而 $(A, B)$ 是标称[系统矩阵](@entry_id:172230)。不确定性主要通过两种方式进入这个模型 。

第一种是**附加扰动不确定性**（Additive Disturbance Uncertainty）。这表现为外源项 $w_k$，它被加到系统的动态方程中。这个扰动项代表了各种未建模的效应，例如外部环境力、[测量噪声](@entry_id:275238)的传递效应或过程噪声。其关键特征是**可加性**：$w_k$ 的影响独立于当前的状态 $x_k$ 和输入 $u_k$。在[鲁棒控制](@entry_id:260994)的框架下，我们通常假设 $w_k$ 属于一个已知的[有界集](@entry_id:157754)合 $\mathcal{W}$（例如，一个包含原点的[紧凸集](@entry_id:272594)）。在[随机控制](@entry_id:170804)的框架下，我们则假设 $w_k$ 是一个具有已知（或可估计）概率分布的[随机变量](@entry_id:195330)。

第二种是**参数不确定性**（Parametric Uncertainty）。这种不确定性存在于模型本身的参数中，即矩阵 $(A, B)$ 并非精确已知。真实的系统动态可能是 $x_{k+1} = A_{true} x_k + B_{true} u_k$，其中 $(A_{true}, B_{true})$ 位于某个已知的参数不确定性集合 $\mathcal{P}$ 内。与附加扰动不同，[参数不确定性](@entry_id:264387)的影响是**[乘性](@entry_id:187940)的**。例如，如果 $A_{true} = A + \Delta A$，不确定性会引入一个与状态相关的项 $\Delta A x_k$。这意味着不确定性对系统演化的影响大小，直接取决于当前状态 $x_k$ 和输入 $u_k$ 的大小。

正确区分这两种不确定性至关重要，因为它们需要不同的控制策略来应对。例如，一个数字孪生可以通过在线系统辨识（如[递归最小二乘法](@entry_id:263435)，RLS）利用实时数据来减小对 $(A, B)$ 的参数不确定性。然而，即使模型参数被完美辨识，代表残余[过程噪声](@entry_id:270644)的附加扰动 $w_k$ 仍然存在。因此，一种有效的控制策略必须能够同时处理这两种不确定性，或者至少对其主要来源具有鲁棒性 。本章将主要聚焦于处理有界的附加扰动。

### [鲁棒模型预测控制](@entry_id:174393)：最坏情况范式

当安全是首要考虑因素时，控制设计通常采用一种保守但可靠的哲学：确保系统在**所有**可能的不确定性实现下都能满足约束。这就是[鲁棒控制](@entry_id:260994)的核心思想。对于一个受有界扰动 $w_k \in \mathcal{W}$ 影响的系统，[鲁棒MPC](@entry_id:174393)的目标是找到一个控制策略，确保状态和输入约束（$x_k \in \mathcal{X}, u_k \in \mathcal{U}$）在整个运行期间对任何可能的扰动序列都得到满足 。

#### 最小-最大（Min-Max）MPC的理念与挑战

从理论上讲，最理想的[鲁棒MPC](@entry_id:174393)可以被构建为一个**最小-最大（min-max）优化问题**。该问题旨在寻找一个最优的因果控制**策略**（即一系列从历史信息到当前输入的映射函数），使得在**最坏情况**的扰动序列下，累积成本[函数最小化](@entry_id:138381)。

这个公式虽然理论上完美，但存在巨大的计算挑战。决策变量不再是一个简单的控制输入序列，而是一个[函数序列](@entry_id:145607)（即策略），这使得优化问题变为无限维的。需要在线解决这样一个与“对手”（最坏情况的扰动）博弈的函数优化问题，对于大多数实际应用来说是不可行的 。

#### 基于管道（Tube-Based）的MPC：一种可行的近似方法

为了克服最小-最大MPC的[计算障碍](@entry_id:898044)，**基于管道（Tube-based）的MPC** 应运而生。它通过限制控制策略的结构，将无限维的[策略优化](@entry_id:635350)问题转化为一个可计算的有限维优化问题。其核心思想是**运动分解**。

我们将物理系统的实际状态 $x_k$ 分解为一个**标称状态** $z_k$ 和一个**误差状态** $e_k$ 的和，即 $x_k = z_k + e_k$。标称状态 $z_k$ 由一个无扰动的理想模型驱动，用于在线规划。误差状态 $e_k$ 则捕获了实际轨迹与标称轨迹之间的偏差。相应地，控制输入也被分解为一个**标称输入** $v_k$ 和一个用于抑制误差的**辅助反馈**项的和：$u_k = v_k + K e_k$，其中 $K$ 是一个预先设计的[反馈增益](@entry_id:271155)矩阵。

通过代数推导，我们可以将耦合的系统动态分离为两个独立的动态系统 ：

1.  **标称动态**:
    $z_{k+1} = A z_k + B v_k$
    这个无扰动的[线性系统](@entry_id:147850)由数字孪生中的MPC优化器用于预测和规划标称轨迹 $(z_k, v_k)$。

2.  **误差动态**:
    $e_{k+1} = x_{k+1} - z_{k+1} = (A x_k + B u_k + w_k) - (A z_k + B v_k)$
    代入 $x_k = z_k + e_k$ 和 $u_k = v_k + K e_k$ 后，我们得到：
    $e_{k+1} = A(z_k+e_k) + B(v_k+Ke_k) + w_k - A z_k - B v_k = (A+BK)e_k + w_k$
    这个关键的结果表明，误差的演化是**自治的**，它只依赖于前一时刻的误差和外部扰动，而与标称轨迹 $(z_k, v_k)$ 无关。通过离线选择增益 $K$ 使得闭环矩阵 $(A+BK)$ 稳定（例如，使其所有特征值都在复平面的[单位圆](@entry_id:267290)内，即**Schur稳定**），我们就可以确保误差动态是有界的。

#### 约束误差：鲁棒不变管道

既然误差动态是稳定的，并且由有界扰动 $w_k \in \mathcal{W}$ 驱动，我们可以找到一个集合来“容纳”所有可能的误差轨迹。这个集合被称为**鲁棒正不变（Robust Positive Invariant, RPI）集**。一个集合 $\mathcal{E}$ 被称为误差动态的RPI集，如果对于任何在集合内的误差 $e_k \in \mathcal{E}$ 和任何在扰动集内的扰动 $w_k \in \mathcal{W}$，下一个误差状态 $e_{k+1}$ 仍然位于集合 $\mathcal{E}$ 内 。

这个[不变性条件](@entry_id:171412)可以用**[闵可夫斯基和](@entry_id:176841)（Minkowski Sum）**来形式化地表达。两个集合 $\mathcal{A}$ 和 $\mathcal{B}$ 的[闵可夫斯基和](@entry_id:176841)定义为 $\mathcal{A} \oplus \mathcal{B} := \{a+b \mid a \in \mathcal{A}, b \in \mathcal{B}\}$。从集合 $\mathcal{E}$ 出发的所有可能后继误差状态的集合是 $(A+BK)\mathcal{E} \oplus \mathcal{W}$。因此，RPI条件为：

$(A+BK)\mathcal{E} \oplus \mathcal{W} \subseteq \mathcal{E}$

如果初始误差 $e_0$ 位于 $\mathcal{E}$ 内（例如，通过设置 $z_0 = x_0$ 使得 $e_0 = 0$），那么在辅助反馈 $K$ 的作用下，未来所有的误差 $e_k$ 都将被限制在 $\mathcal{E}$ 内。这个集合 $\mathcal{E}$ 构成了环绕标称轨迹的“管道”的[横截面](@entry_id:154995)。

#### 确保鲁棒安全：约束收紧

我们已经成功地将误差限制在管道 $\mathcal{E}$ 内。现在的问题是：如何确保实际状态 $x_k = z_k + e_k$ 和实际输入 $u_k = v_k + Ke_k$ 始终满足其原始约束 $x_k \in \mathcal{X}$ 和 $u_k \in \mathcal{U}$？答案是，我们必须对MPC优化的**标称系统**施加更严格的约束。这个过程被称为**约束收紧（Constraint Tightening）**。

为了推导收紧的约束，我们引入**庞特里亚金差（Pontryagin Difference）**的概念。集合 $\mathcal{A}$ 相对于集合 $\mathcal{B}$ 的庞特里亚金差定义为：

$\mathcal{A} \ominus \mathcal{B} := \{ c \in \mathbb{R}^n \mid c \oplus \mathcal{B} \subseteq \mathcal{A} \}$

直观地，$\mathcal{A} \ominus \mathcal{B}$ 是集合 $\mathcal{A}$ 的一个“收缩”版本，它保证了从该集合中任取一点 $c$，并加上 $\mathcal{B}$ 中的任意一点 $b$，其结果 $c+b$ 仍然会落在 $\mathcal{A}$ 内部 。

利用这个定义，我们可以导出标称变量必须满足的约束  ：
-   **状态约束**: 为了确保 $x_k = z_k + e_k \in \mathcal{X}$ 对所有 $e_k \in \mathcal{E}$ 成立，标称状态 $z_k$ 必须满足 $z_k \oplus \mathcal{E} \subseteq \mathcal{X}$。根据庞特里亚金差的定义，这等价于 $z_k \in \mathcal{X} \ominus \mathcal{E}$。
-   **输入约束**: 为了确保 $u_k = v_k + Ke_k \in \mathcal{U}$ 对所有 $e_k \in \mathcal{E}$ 成立，标称输入 $v_k$ 必须满足 $v_k \oplus K\mathcal{E} \subseteq \mathcal{U}$，其中 $K\mathcal{E} := \{Ke \mid e \in \mathcal{E}\}$。这等价于 $v_k \in \mathcal{U} \ominus K\mathcal{E}$。

通过这种方式，原本复杂的鲁棒约束问题被转化为了一个在收[紧约束](@entry_id:635234)下的确定性标称MPC问题，这个问题的决策变量是标称输入序列 $\{v_k\}$，可以在线高效求解。

#### 确保稳定性与[递归可行性](@entry_id:167169)

有限时域的MPC要保证长时间稳定运行，还需要引入**[终端约束](@entry_id:176488)（Terminal Ingredients）**，即一个**[终端集](@entry_id:163892)** $\mathcal{X}_f$ 和一个**终端成本** $V_f(\cdot)$ 。其目的是确保在每个时刻，MPC问题都是**递归可行**的（即总能找到一个解），并且[闭环系统](@entry_id:270770)是稳定的。

为达到此目的，[终端集](@entry_id:163892)和终端成本通常需要满足以下充分条件：
1.  **[终端集](@entry_id:163892)的[不变性](@entry_id:140168)**：[终端集](@entry_id:163892) $\mathcal{X}_f$ 必须是标称系统在某个终端控制律（如 $\kappa(\bar{x}) = K\bar{x}$）下的一个**控制[不变集](@entry_id:275226)**，并且它自身也要满足收紧的状态和输入约束。也就是说，对于所有 $\bar{x} \in \mathcal{X}_f$，必须有 $(A+BK)\bar{x} \in \mathcal{X}_f$，同时 $\mathcal{X}_f \subseteq \mathcal{X} \ominus \mathcal{E}$ 且 $K\mathcal{X}_f \subseteq \mathcal{U} \ominus K\mathcal{E}$。
2.  **终端成本的下降条件**：终端成本 $V_f$ 必须是标称系统在[终端集](@entry_id:163892) $\mathcal{X}_f$ 上的一个**[控制李雅普诺夫函数](@entry_id:164136)**。这意味着对于所有 $\bar{x} \in \mathcal{X}_f$，必须满足 $V_f((A+BK)\bar{x}) - V_f(\bar{x}) \le -\ell(\bar{x}, K\bar{x})$，其中 $\ell$ 是阶段成本。

这些条件确保了我们可以通过一个“移位并追加”（shift-append）的论证来证明[递归可行性](@entry_id:167169)，并保证最优成本函数是一个[李雅普诺夫函数](@entry_id:273986)，从而证明标称系统的[渐近稳定](@entry_id:168077)。结合管道的[不变性](@entry_id:140168)，这最终保证了真实物理系统在满足约束的同时，其状态会收敛到误差管道 $\mathcal{E}$ 内，实现了**实际稳定（practical stability）**。

### [随机模型预测控制](@entry_id:1132433)：概率性范式

与[鲁棒MPC](@entry_id:174393)的保守哲学不同，**[随机模型预测控制](@entry_id:1132433)（Stochastic MPC, SMPC）** 适用于不确定性可以被描述为概率分布的场景。例如，扰动 $w_k$ 可能是一个均值为零、具有特定协方差的高斯[随机变量](@entry_id:195330)。在这种情况下，要求在所有情况下（包括概率极低的极端事件）都满足约束可能过于严苛，甚至导致控制问题无解。SMPC因此采用了一种更为灵活的概率性方法 。

#### SMPC中的目标与约束

SMPC在目标和约束的处理上与[鲁棒MPC](@entry_id:174393)有着根本的不同：
-   **目标函数**: SMPC的目标通常是最小化未来成本的**[期望值](@entry_id:150961)**，即 $\mathbb{E}\left[\sum_{i=0}^{N-1} \ell(x_{k+i}, u_{k+i}) + V_f(x_{k+N})\right]$。这使得控制器能够平衡平均性能，而不是仅仅关注最坏情况。
-   **约束**: 硬约束被软化为**[机会约束](@entry_id:166268)（Chance Constraints）**。一个机会约束的形式为 $\mathbb{P}\{x_k \in \mathcal{X}\} \ge 1 - \epsilon$，其中 $\epsilon \in (0,1)$ 是一个小的风险容忍度。它允许约束在极小的概率 $\epsilon$ 下被违反，从而在性能和安全性之间进行量化权衡。

#### 可计算的重构方法

[机会约束](@entry_id:166268)本身通常难以直接在优化问题中处理，因为计算一个集合的[概率测度](@entry_id:190821)通常是非凸且计算昂贵的。然而，在特定条件下，机会约束可以被重构为确定性的凸约束。

一个典型的例子是，对于一个[线性系统](@entry_id:147850)、附加[高斯噪声](@entry_id:260752)以及线性（或多面体）约束。考虑一个标量线性[机会约束](@entry_id:166268) $\mathbb{P}\{a^\top x_{k+i} \le b\} \ge 1 - \epsilon$。如果 $x_{k+i}$ 是一个均值为 $z_{k+i}$、协方差为 $\Sigma_{x,i}$ 的[高斯随机向量](@entry_id:635820)，那么 $a^\top x_{k+i}$ 也是一个标量[高斯变量](@entry_id:276673)，其均值为 $a^\top z_{k+i}$，方差为 $a^\top \Sigma_{x,i} a$。该[机会约束](@entry_id:166268)等价于以下确定性约束 ：

$a^\top z_{k+i} + \Phi^{-1}(1 - \epsilon)\sqrt{a^\top \Sigma_{x,i} a} \le b$

其中 $\Phi^{-1}(\cdot)$ 是[标准正态分布](@entry_id:184509)的[逆累积分布函数](@entry_id:266870)（[分位数函数](@entry_id:271351)）。这个约束是关于标称状态 $z_{k+i}$ 的一个**[二阶锥](@entry_id:637114)约束**，是凸的。因此，整个SMPC问题可以转化为一个可以高效求解的[凸优化](@entry_id:137441)问题。

#### 超越简单概率：高级风险度量

[机会约束](@entry_id:166268)（等价于**风险价值 [VaR](@entry_id:140792)**）有一个显著的局限：它只关心违约的概率，而不关心违约发生时的**严重程度**。一个可能导致灾难性后果的微小违约和一个无伤大雅的微小违约在[机会约束](@entry_id:166268)看来并无区别。为了更精细地管理风险，控制领域借鉴了[金融工程](@entry_id:136943)中的概念，引入了更先进的风险度量，特别是**条件风险价值（Conditional Value-at-Risk, C[VaR](@entry_id:140792)）** 。

-   **风险价值 (VaR)**: 在[置信水平](@entry_id:182309)为 $\alpha$ 时，VaR是损失分布的 $\alpha$-分位数。它回答了这样一个问题：“在最好的 $\alpha \times 100\%$ 的情况下，我的最大损失是多少？”。
-   **[条件风险价值 (CVaR)](@entry_id:139415)**: 在[置信水平](@entry_id:182309)为 $\alpha$ 时，CVaR是损失超过VaR时的[条件期望](@entry_id:159140)。它回答了这样一个问题：“在最坏的 $(1-\alpha) \times 100\%$ 的情况下，我的平均损失是多少？”。

相比[VaR](@entry_id:140792)，C[VaR](@entry_id:140792)具有多项优势 ：
-   **一致性 (Coherence)**: CVaR是一个**[一致性风险度量](@entry_id:137862)**，满足包括**[次可加性](@entry_id:137224)**在内的多条良好公理。[次可加性](@entry_id:137224)意味着“风险分散不会增加总风险”，而VaR在某些情况下会违反此性质。
-   **[凸性](@entry_id:138568) (Convexity)**: 优化C[VaR](@entry_id:140792)通常会得到一个[凸优化](@entry_id:137441)问题，而优化VaR通常是非凸的。C[VaR](@entry_id:140792)可以被优雅地重构为一个辅助变量的最小化问题：
    $\text{CVaR}_\alpha(L) = \min_{z \in \mathbb{R}} \left( z + \frac{1}{1-\alpha} \mathbb{E}[\max(L - z, 0)] \right)$
-   **[可计算性](@entry_id:276011) (Tractability)**: 使用**样本平均近似（Sample Average Approximation, SAA）**，上述期望可以用样本均值代替，从而将[CVaR优化](@entry_id:145828)问题转化为一个标准的[线性规划](@entry_id:138188)（LP）或二次规划（QP），这些问题都有非常高效的求解器。这使得基于CVaR的SMPC具有实时计算的潜力。

由于C[VaR](@entry_id:140792)对[尾部风险](@entry_id:141564)的捕捉更为灵敏且计算上更具优势，它在需要精细化[风险管理](@entry_id:141282)的SMPC应用中，正成为比VaR更受青睐的选择。

### 分布[鲁棒MPC](@entry_id:174393)：连接鲁棒与随机的桥梁

[鲁棒MPC](@entry_id:174393)假设最坏情况，可能过于保守；SMPC假设概率分布已知，可能过于乐观。在许多实际的CPS中，数字孪生可以通过收集数据来估计扰动分布，但这个估计本身也存在不确定性。**分布[鲁棒模型预测控制](@entry_id:174393)（Distributionally Robust MPC, DR-MPC）** 正是为了解决这一问题而设计的。它在鲁棒和随机方法之间架起了一座桥梁。

其核心思想是，不再假设一个单一的、精确的概率分布，而是考虑一个由数据支持的、合理的**分布[模糊集](@entry_id:269080)** $\mathcal{P}$，并对该集合中**最坏的分布**进行优化。

#### 分布鲁棒机会约束 (DRCC)

一个分布鲁棒[机会约束](@entry_id:166268)的形式如下 ：

$\inf_{\mathbb{Q} \in \mathcal{P}} \mathbb{Q}\{x_k \in \mathcal{X}\} \ge 1 - \alpha$

这要求在模糊集 $\mathcal{P}$ 中所有可能的概率分布 $\mathbb{Q}$ 中，满足约束的概率的**[下确界](@entry_id:140118)**（即最坏情况下的概率）至少为 $1 - \alpha$。这提供了一个对分布估计误差的鲁棒性保证。

#### 基于数据构建模糊集：瓦瑟斯坦球

如何构建一个有意义的[模糊集](@entry_id:269080) $\mathcal{P}$？一种强大且流行的方法是围绕从数据中得到的**[经验分布](@entry_id:274074)** $\hat{\mathbb{P}}_N = \frac{1}{N} \sum_{i=1}^N \delta_{w^{(i)}}$ 来构建一个“球”。这个“球”的度量需要能够衡量分布之间的“距离”。

**[瓦瑟斯坦距离](@entry_id:147338)（Wasserstein Distance）**，也称作“[推土机距离](@entry_id:147338)”，正是为此而生的度量。它衡量了将一个分布的“质量”变换为另一个分布的“质量”所需的最小“成本”，其中成本与移动的距离有关。它不仅仅看分布的形状，还考虑了它们在几何空间上的位置。

基于此，我们可以定义**瓦瑟斯坦球模糊集** ：

$\mathcal{P} = \{ \mathbb{Q} \mid W_p(\mathbb{Q}, \hat{\mathbb{P}}_N) \le \varepsilon \}$

其中 $W_p$ 是 $p$-阶[瓦瑟斯坦距离](@entry_id:147338)，$\varepsilon > 0$ 是球的半径。这个集合包含了所有与[经验分布](@entry_id:274074) $\hat{\mathbb{P}}_N$ 在[瓦瑟斯坦距离](@entry_id:147338)意义下“足够近”的分布。球的半径 $\varepsilon$ 直接控制了鲁棒性的水平：$\varepsilon$ 越大，[模糊集](@entry_id:269080)越大，控制器就越保守。理论上，这个半径可以与数据量 $N$ 和所需的[置信水平](@entry_id:182309)相关联，为在保守性与性能之间进行权衡提供了一个有理论依据的调节旋钮。

综上所述，DR-MPC通过结合数据驱动的分布估计和[鲁棒优化](@entry_id:163807)的思想，为在不确定环境下设计安全、高性能的控制器提供了一个强大的、可调节的框架。