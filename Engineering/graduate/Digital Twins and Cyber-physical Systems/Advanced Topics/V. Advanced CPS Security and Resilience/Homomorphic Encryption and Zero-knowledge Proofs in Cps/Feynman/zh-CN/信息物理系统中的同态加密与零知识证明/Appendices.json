{
    "hands_on_practices": [
        {
            "introduction": "在全同态加密的实际应用中，尤其是在资源受限的信息物理系统中（CPS），理解计算成本至关重要。不同的同态加密操作具有迥异的性能特征。本练习提供了一种具体方法，来量化使用BFV方案（一种流行的基于整数的加密方法）进行计算的成本，通过分析一个简单的算术电路，您将学会区分像加法这样的低成本操作和像乘法这样的高成本操作，后者需要一种名为“重线性化”（relinearization）的昂贵维护过程。",
            "id": "4226129",
            "problem": "一个信息物理系统 (CPS) 数字孪生必须使用 Brakerski–Fan–Vercauteren (BFV) 分级同态加密方案，对传感器流上的加密状态更新进行评估。该计算表示为一个算术电路，包含 $3$ 个作用于密文输入的乘法门和 $10$ 个加法门，其正确性稍后将通过计算的零知识证明 (ZKP) 来证明，而无需泄露明文。假设 BFV 同态评估具有以下基础：\n\n- 一个 BFV 密文表示为一个数对，密文-密文加法产生一个密文，其表示长度保持不变。\n- 密文-密文乘法产生一个表示长度增加的密文，必须使用带有预计算评估密钥的重线性化将其降回来，以便在没有自举的分级设置中继续评估。\n- BFV 精确算术中不使用重缩放。\n\n在这些条件下，并假设电路中的每个乘法门都是密文-密文乘法，并且在每次此类乘法后立即应用重线性化以在整个评估过程中保持恒定的密文表示长度，请确定评估该电路所需的密文-密文乘法总数和重线性化总数。请按（密文-密文乘法总数，重线性化总数）的顺序，以行矩阵的形式提供您的最终答案。无需四舍五入，且无单位。",
            "solution": "该问题要求分析使用 Brakerski–Fan–Vercauteren (BFV) 同态加密方案评估算术电路的计算成本，特别是在乘法和重线性化操作方面。\n\n首先，需要对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 计算模型是由信息物理系统 (CPS) 数字孪生评估的算术电路。\n- 加密方案是 BFV 分级同态加密。\n- 电路包含 $3$ 个乘法门和 $10$ 个加法门。\n- 门的输入是密文。\n- 计算的正确性稍后将通过零知识证明 (ZKP) 进行验证。\n- BFV 密文-密文加法不改变密文表示长度。\n- BFV 密文-密文乘法会增加密文表示长度。\n- 重线性化是在乘法之后减少密文表示长度的强制性操作。\n- 在每次密文-密文乘法后立即应用重线性化。\n- 每个乘法门都是密文-密文乘法。\n- 评估是分级的，不使用自举。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据。对 BFV 同态加密方案特性的描述——特别是加法和乘法之间的对比——是准确的。BFV 中的密文加法是作用于底层多项式上的分量级运算，它保留了密文的形式（一对多项式）。相比之下，密文乘法涉及张量积，将密文从一对增加到三元组（或在一般情况下从长度 $k+1$ 增加到 $2k+1$），这需要通过重线性化过程将其恢复为标准的数对格式，以便进行后续操作。问题所处的背景，即在 CPS 中使用安全计算的数字孪生，是一个有效且活跃的研究领域。\n\n该问题是适定 (well-posed) 的。它提供了得出确定性答案所需的所有数据和约束。问题很精确，要求两个特定的量。假设也已明确说明。\n\n该问题是客观的，没有任何主观或不科学的主张。它是应用密码学领域内一个可形式化的问题。\n\n**步骤3：结论与行动**\n问题陈述被认为是有效的。现在将推导出一个正式的解决方案。\n\n该问题要求两个量：密文-密文乘法总数和重线性化总数。\n\n令 $N_{mult}$ 为密文-密文乘法总数，令 $N_{relin}$ 为重线性化总数。\n\n问题明确指出算术电路包含 $3$ 个乘法门。它进一步明确了假设“电路中的每个乘法门都是密文-密文乘法”。这直接决定了 $N_{mult}$ 的值。\n$$\nN_{mult} = 3\n$$\n给出的加法门数量为 $10$，对于所提问题而言是无关信息，因为问题说明密文-密文加法不需要任何像重线性化这样的规模缩减维护操作。\n\n接下来，我们确定重线性化的总数 $N_{relin}$。问题为评估过程提供了一个清晰明确的规则：“在每次此类乘法后立即应用重线性化以保持恒定的密文表示长度。” 这在密文-密文乘法操作和重线性化操作之间建立了一一对应的直接关系。每发生一次乘法，就必须执行一次后续的重线性化。\n\n鉴于有 $N_{mult} = 3$ 次密文-密文乘法，根据所述过程，逻辑上和直接地可以得出，必须有相同数量的重线性化操作。\n$$\nN_{relin} = N_{mult}\n$$\n代入 $N_{mult}$ 的值：\n$$\nN_{relin} = 3\n$$\n因此，评估指定的算术电路需要 $3$ 次密文-密文乘法和 $3$ 次重线性化。最终答案应以行矩阵的形式呈现，按要求的顺序包含这两个值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n3  & 3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然BFV方案能在整数上提供精确算术，但许多CPS应用（如控制系统）处理的是实数，并且可以容忍微小的精度误差。CKKS方案正是为此设计的，但它要求仔细选择参数以平衡精度、安全性和性能。本实践问题挑战您扮演系统设计者的角色，为一个基于CKKS的系统确定必要的参数，您将学习到乘法深度、期望的输出精度和动态范围如何相互作用，共同决定了计算成功且不失过多准确性所需的最小“模数预算”（modulus budget）。",
            "id": "4226124",
            "problem": "一个信息物理系统 (CPS) 数字孪生使用 Cheon–Kim–Kim–Song (CKKS) 近似同态加密方案计算一个非线性加密控制律。每次评估中，该控制算法的最长密文-密文乘法链深度为 $D = 6$。系统设计者指定了期望的输出动态范围界 $R_{\\text{out}} = 4$（意味着真实明文输出的幅值以 $4$ 为界）和最终解密输出的目标相对精度要求 $\\varepsilon = 1.5 \\times 10^{-11}$。\n\n假设以下经过充分测试的 CKKS 属性和建模假设：\n- CKKS 使用一个缩放因子 $\\Delta > 0$ 将实数值编码为定点数；量化分辨率约为 $\\Delta^{-1}$ 的量级。\n- 每次密文-密文乘法后进行重缩放以恢复缩放因子，会消耗模数链中的一个素数，其比特大小约为 $\\log_{2}(\\Delta)$；重缩放操作会按该素数的比特大小减小模数。\n- 在此控制评估中，由定点量化和重缩放产生的总绝对输出误差可以由 $E \\leq \\kappa \\Delta^{-1}$ 作为上界，其中 $\\kappa$ 是一个已知的与算法相关的常数，由系数增长和操作计数导出（对于此控制器，可取 $\\kappa = 100$）。\n- 为了进行此规模计算，与明文常数相乘和加法运算不消耗层级，也不改变缩放方案。\n\n设计一个在每个层级使用相同基础缩放因子 $\\Delta$ 的统一缩放方案，并确定所需的最小模数链规模，以使最终绝对输出误差界 $E$ 最多为 $\\varepsilon R_{\\text{out}}$。在确定规模时，包括一个用于注入基础缩放因子的初始素数（因此模数链必须包含 $D+1$ 个素数，每个素数的比特大小为 $\\log_{2}(\\Delta)$），并忽略用于重线性化或密钥切换的任何辅助素数。\n\n计算满足这些假设下的动态范围和精度要求的最小总模数预算（以比特为单位），定义为 $Q_{\\text{total}} = (D+1)\\log_{2}(\\Delta)$。将最终数值答案四舍五入到四位有效数字。",
            "solution": "该问题是有效的，因为它在科学上基于近似同态加密的原理（特别是 CKKS 方案），问题设定良好且有唯一解，并使用客观和精确的技术语言表述。所有求解所需量的数据和模型均已提供。\n\n目标是计算同态评估控制律所需的最小总模数预算 $Q_{\\text{total}}$。问题给出了该预算的计算公式：\n$$Q_{\\text{total}} = (D+1)\\log_{2}(\\Delta)$$\n其中 $D$ 是乘法深度，$\\Delta$ 是基础缩放因子。我们已知 $D=6$。任务简化为找到满足系统精度要求的最小所需缩放因子 $\\Delta$。\n\n系统要求最终相对精度为 $\\varepsilon = 1.5 \\times 10^{-11}$。计算输出的动态范围以 $R_{\\text{out}} = 4$ 为界。目标相对精度可以转换为最终输出的目标绝对误差界 $E_{\\text{target}}$。最大允许绝对误差是相对精度与输出最大可能幅值的乘积：\n$$E_{\\text{target}} = \\varepsilon R_{\\text{out}}$$\n\n问题提供了一个由 CKKS 计算引入的绝对误差 $E$ 的上界模型：\n$$E \\leq \\kappa \\Delta^{-1}$$\n其中 $\\kappa=100$ 是一个与特定算法相关的常数。\n\n为满足精度要求，计算产生的实际误差界必须不大于目标绝对误差界。因此，我们必须强制满足以下条件：\n$$\\kappa \\Delta^{-1} \\leq E_{\\text{target}}$$\n代入 $E_{\\text{target}}$ 的表达式，我们得到：\n$$\\kappa \\Delta^{-1} \\leq \\varepsilon R_{\\text{out}}$$\n为了找到最小的总模数预算，我们必须使用满足此条件的最小缩放因子 $\\Delta$。最小的 $\\Delta$ 通过解不等式求得：\n$$\\frac{\\kappa}{\\varepsilon R_{\\text{out}}} \\leq \\Delta$$\n因此，所需的最小缩放因子，我们记为 $\\Delta_{\\min}$，是：\n$$\\Delta_{\\min} = \\frac{\\kappa}{\\varepsilon R_{\\text{out}}}$$\n\n现在，我们可以代入给定的数值：$D=6$，$\\kappa=100$，$\\varepsilon=1.5 \\times 10^{-11}$，以及 $R_{\\text{out}}=4$。\n首先，我们计算 $\\Delta_{\\min}$：\n$$\\Delta_{\\min} = \\frac{100}{(1.5 \\times 10^{-11}) \\times 4} = \\frac{100}{6 \\times 10^{-11}} = \\frac{50}{3} \\times 10^{11}$$\n\n接下来，我们将 $\\Delta_{\\min}$ 的值和给定的 $D$ 值代入 $Q_{\\text{total}}$ 的公式中：\n$$Q_{\\text{total}} = (6+1)\\log_{2}\\left(\\frac{50}{3} \\times 10^{11}\\right) = 7 \\log_{2}\\left(\\frac{50}{3} \\times 10^{11}\\right)$$\n为了计算以 $2$ 为底的对数，我们可以使用换底公式 $\\log_{2}(x) = \\frac{\\ln(x)}{\\ln(2)}$：\n$$Q_{\\text{total}} = 7 \\times \\frac{\\ln\\left(\\frac{50}{3} \\times 10^{11}\\right)}{\\ln(2)}$$\n计算对数中参数的值：\n$$\\frac{50}{3} \\times 10^{11} \\approx 1.666... \\times 10^{12}$$\n现在，我们计算 $Q_{\\text{total}}$ 的数值：\n$$Q_{\\text{total}} \\approx 7 \\times \\frac{\\ln(1.666... \\times 10^{12})}{\\ln(2)}$$\n$$Q_{\\text{total}} \\approx 7 \\times \\frac{28.1418468}{0.6931472}$$\n$$Q_{\\text{total}} \\approx 7 \\times 40.60018$$\n$$Q_{\\text{total}} \\approx 284.20126$$\n\n问题要求将最终答案四舍五入到四位有效数字。$284.20126$ 的前四位有效数字是 $2$、$8$、$4$ 和 $2$。第五位有效数字是 $0$，所以我们向下舍入（即截断）。\n$$Q_{\\text{total}} \\approx 284.2$$\n这表示满足指定设计约束所需的模数链的最小总比特大小。",
            "answer": "$$\\boxed{284.2}$$"
        },
        {
            "introduction": "同态加密确保了计算过程中数据的机密性，但它不能阻止恶意方提供格式错误的密文或执行不正确的计算。零知识证明（ZKP）可以提供可验证性，但这种安全保障是有代价的。在这个问题中，您将量化在CPS网络中集成ZKP的实际开销，通过计算为加密传感器消息添加Schnorr风格证明所需的额外通信和计算功耗，您将对安全性、隐私性和系统资源之间的现实世界权衡获得关键理解。",
            "id": "4226091",
            "problem": "一个时间同步的信息物理系统 (CPS) 网络通过将加密的传感器测量值流式传输到聚合器进行同态融合来支持数字孪生。$N$ 个传感器中的每一个都以采样率 $f_{s}$ 发送消息，其中每条消息包含一个在 $2048$ 位模数下的 Paillier 密文。Paillier 加密将明文映射到模 $n^{2}$ 的乘法群中，因此一个密文是模 $n^{2}$ 的单个元素；对于位长为 $2048$ 的 $n$，密文的位长为 $4096$（即 $512$ 字节）。为了在保护隐私的同时防止恶意构造的密文，每条消息都附加了一个在素数阶 $q \\approx 2^{256}$、生成元为 $G$ 的椭圆曲线群 $\\mathbb{G}$ 中的非交互式 Schnorr 式知识证明（通过 Fiat–Shamir 变换）。证明者拥有私钥 $x \\in \\mathbb{Z}_{q}$ 和公钥 $X = x G$，并为每条消息构建证明元素：使用随机数 $r \\in \\mathbb{Z}_{q}$ 的承诺 $t = r G$，以及响应 $s = r + c x \\bmod q$，其中挑战 $c \\in \\mathbb{Z}_{q}$ 是使用密码学哈希函数对记录字段进行哈希计算得出的。网络对 $\\mathbb{G}$ 的元素使用压缩点编码，因此每个群元素占用 $33$ 字节，而 $\\mathbb{Z}_{q}$ 中的标量占用 $32$ 字节。每条消息中的非交互式证明记录由数对 $(t, s)$ 组成。\n\n假设传感器的微控制器和无线电具有以下实际性能和能量参数：\n- 每个传感器的 CPU 频率为 $f_{\\text{cpu}} = 10^{8}$ Hz。\n- 在执行密码学操作时，CPU 消耗的平均动态功耗为 $P_{\\text{cpu}} = 0.5$ W，产生每周期能量 $E_{\\text{cycle}} = P_{\\text{cpu}} / f_{\\text{cpu}}$。\n- 一次椭圆曲线标量乘法（计算 $t = r G$）的成本为 $C_{\\text{ec}} = 2.5 \\times 10^{6}$ 个周期。\n- Fiat–Shamir 哈希使用 $32$ 字节的输出，其计算成本为每输入字节 $12$ 个周期，外加每次调用固定的 $80$ 个周期。哈希输入连接了 Paillier 密文（$512$ 字节）、承诺 $t$（$33$ 字节）、公钥 $X$（$33$ 字节）和一个每消息随机数（$8$ 字节）。\n- $\\mathbb{Z}_{q}$ 中的单次模乘法成本为 $C_{\\text{mul}} = 2000$ 个周期，模加法成本为 $C_{\\text{add}} = 50$ 个周期。\n- 为 $r$ 生成随机数的成本为 $C_{\\text{rand}} = 1000$ 个周期。\n- 无线电传输能量为每传输比特 $e_{\\text{tx}} = 50 \\times 10^{-9}$ J。\n\n假设有 $N = 300$ 个传感器，每个传感器的采样率为 $f_{s} = 10$ Hz。将通信开销定义为由于 Schnorr 式证明而导致的（全网范围内）每秒额外传输的比特数，将计算开销定义为全网范围内计算证明所产生的额外 CPU 动态功耗（瓦特）。在上述参数下，计算总开销功率，其定义为所有传感器中为增加的证明比特产生的无线电传输功率与为增加的证明计算产生的 CPU 动态功耗之和。\n\n以瓦特为单位表示最终结果，并将答案四舍五入到四位有效数字。",
            "solution": "该问题要求计算在信息物理系统 (CPS) 的消息中添加非交互式 Schnorr 式知识证明所引入的总开销功率。这个总开销功率，记为 $P_{\\text{total}}$，是无线电传输的功率开销 $P_{\\text{comm}}$ 和 CPU 计算的功率开销 $P_{\\text{comp}}$ 的总和。\n\n$$\nP_{\\text{total}} = P_{\\text{comm}} + P_{\\text{comp}}\n$$\n\n我们将分别计算每个部分。\n\n首先，我们计算通信开销功率 $P_{\\text{comm}}$。这是在整个网络中传输证明的附加比特所需的功率。证明由一个数对 $(t, s)$ 组成，其中 $t$ 是一个椭圆曲线点，$s$ 是一个标量。\n\n承诺 $t$（一个压缩的椭圆曲线点）的大小为 $L_t = 33$ 字节。\n响应 $s$（$\\mathbb{Z}_q$ 中的一个标量）的大小为 $L_s = 32$ 字节。\n\n每条消息的证明总大小 $L_{\\text{proof}}$ 是其各部分大小的总和：\n$$\nL_{\\text{proof}} = L_t + L_s = 33 \\text{ 字节} + 32 \\text{ 字节} = 65 \\text{ 字节}\n$$\n为了计算功率，我们需要以比特为单位的大小。由于 $1$ 字节 = $8$ 比特，因此以比特为单位的大小是：\n$$\nL_{\\text{proof, bits}} = L_{\\text{proof}} \\times 8 = 65 \\times 8 = 520 \\text{ 比特}\n$$\n网络由 $N=300$ 个传感器组成，每个传感器以 $f_s = 10 \\text{ Hz}$ 的采样率传输消息。全网范围内证明的总比特率 $R_{\\text{proof}}$ 是：\n$$\nR_{\\text{proof}} = N \\times f_s \\times L_{\\text{proof, bits}}\n$$\n代入给定值：\n$$\nR_{\\text{proof}} = 300 \\times 10 \\text{ s}^{-1} \\times 520 \\text{ 比特} = 1,560,000 \\text{ 比特/秒}\n$$\n传输单个比特的能量为 $e_{\\text{tx}} = 50 \\times 10^{-9} \\text{ J/bit}$。通信功率是比特率和每比特能量的乘积：\n$$\nP_{\\text{comm}} = R_{\\text{proof}} \\times e_{\\text{tx}}\n$$\n$$\nP_{\\text{comm}} = 1,560,000 \\text{ 比特/秒} \\times (50 \\times 10^{-9} \\text{ J/比特}) = 0.078 \\text{ W}\n$$\n\n接下来，我们计算计算开销功率 $P_{\\text{comp}}$。这是所有传感器用于计算证明所消耗的平均 CPU 动态功耗。首先，我们必须确定生成单个证明所需的 CPU 周期数 $C_{\\text{proof}}$。生成过程包括以下几个步骤：\n1. 生成随机标量 $r$：$C_{\\text{rand}} = 1000$ 个周期。\n2. 计算承诺 $t = rG$：这是一次椭圆曲线标量乘法，成本为 $C_{\\text{ec}} = 2.5 \\times 10^6$ 个周期。\n3. 通过哈希计算挑战 $c$：成本取决于输入大小。输入是 Paillier 密文（$L_{\\text{cipher}} = 512$ 字节）、承诺 $t$（$L_t = 33$ 字节）、公钥 $X$（$L_X = 33$ 字节）和一个随机数（$L_{\\text{nonce}} = 8$ 字节）的串联。总输入长度为：\n$$\nL_{\\text{hash\\_in}} = L_{\\text{cipher}} + L_t + L_X + L_{\\text{nonce}} = 512 + 33 + 33 + 8 = 586 \\text{ 字节}\n$$\n哈希成本为每输入字节 $12$ 个周期，外加固定的 $80$ 个周期。因此，哈希计算的周期数 $C_{\\text{hash}}$ 为：\n$$\nC_{\\text{hash}} = (12 \\text{ 周期/字节} \\times L_{\\text{hash\\_in}}) + 80 \\text{ 周期} = (12 \\times 586) + 80 = 7032 + 80 = 7112 \\text{ 周期}\n$$\n4. 计算响应 $s = r + cx \\pmod q$：这涉及一次模乘法（成本 $C_{\\text{mul}} = 2000$ 个周期）和一次模加法（成本 $C_{\\text{add}} = 50$ 个周期）。总成本为：\n$$\nC_{s} = C_{\\text{mul}} + C_{\\text{add}} = 2000 + 50 = 2050 \\text{ 周期}\n$$\n每个证明的总周期数是每个步骤的周期数之和：\n$$\nC_{\\text{proof}} = C_{\\text{rand}} + C_{\\text{ec}} + C_{\\text{hash}} + C_{s}\n$$\n$$\nC_{\\text{proof}} = 1000 + 2,500,000 + 7112 + 2050 = 2,510,162 \\text{ 周期}\n$$\n每个 CPU 周期消耗的能量 $E_{\\text{cycle}}$ 是 CPU 功耗 $P_{\\text{cpu}} = 0.5 \\text{ W}$ 除以 CPU 频率 $f_{\\text{cpu}} = 10^8 \\text{ Hz}$：\n$$\nE_{\\text{cycle}} = \\frac{P_{\\text{cpu}}}{f_{\\text{cpu}}} = \\frac{0.5 \\text{ W}}{10^8 \\text{ Hz}} = 5 \\times 10^{-9} \\text{ J/周期}\n$$\n计算一个证明的总能量 $E_{\\text{proof}}$ 是：\n$$\nE_{\\text{proof}} = C_{\\text{proof}} \\times E_{\\text{cycle}} = 2,510,162 \\text{ 周期} \\times (5 \\times 10^{-9} \\text{ J/周期}) = 0.01255081 \\text{ J}\n$$\n单个传感器的平均计算功率是每个证明的能量乘以证明的生成速率 $f_s$：\n$$\nP_{\\text{comp,1}} = E_{\\text{proof}} \\times f_s = 0.01255081 \\text{ J} \\times 10 \\text{ Hz} = 0.1255081 \\text{ W}\n$$\n整个 $N=300$ 个传感器的网络总计算功率是：\n$$\nP_{\\text{comp}} = N \\times P_{\\text{comp,1}} = 300 \\times 0.1255081 \\text{ W} = 37.65243 \\text{ W}\n$$\n\n最后，总开销功率 $P_{\\text{total}}$ 是通信和计算功率开销的总和：\n$$\nP_{\\text{total}} = P_{\\text{comm}} + P_{\\text{comp}} = 0.078 \\text{ W} + 37.65243 \\text{ W} = 37.73043 \\text{ W}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nP_{\\text{total}} \\approx 37.73 \\text{ W}\n$$",
            "answer": "$$\n\\boxed{37.73}\n$$"
        }
    ]
}