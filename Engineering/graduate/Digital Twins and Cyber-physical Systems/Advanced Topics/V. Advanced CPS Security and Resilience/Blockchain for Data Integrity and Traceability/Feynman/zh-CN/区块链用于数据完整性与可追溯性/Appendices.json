{
    "hands_on_practices": [
        {
            "introduction": "区块链保证数据完整性的基石是其所依赖的密码学哈希函数的抗碰撞性。然而，这种安全性并非绝对，而是概率性的。本练习  将引导您应用概率论中的经典“生日问题”模型，从第一性原理出发，推导并量化哈希碰撞的概率。通过这个实践，您将学会如何评估一个基于哈希的溯源系统其安全保证的强度，并理解在给定哈希输出长度下，系统能够安全记录的数据规模的理论上限。",
            "id": "4207086",
            "problem": "数字孪生是物理资产的一种计算表示，其状态变化会随时间被记录。考虑一个信息物理系统，其中每条数字孪生记录都通过提交记录内容的加密哈希值，锚定到一个分布式账本技术（DLT）系统。假设在随机预言机模型（ROM）下，哈希函数的行为如同一个理想随机函数：对于一个固定的比特长度 $b$，每个输入都被均匀且独立地映射到 $M = 2^{b}$ 个可能输出中的一个。\n\n假设有 $n$ 条独立记录，通过将每条记录哈希为一个 $b$ 比特的摘要并将其包含在区块链交易中来进行锚定。定义一次碰撞为两条不同记录产生相同摘要的事件。仅从 ROM 假设和有放回抽样的核心组合概率原理出发，推导碰撞概率 $p$ 作为 $n$ 和 $b$ 的函数的渐近表达式，该表达式在 $n \\ll 2^{b/2}$ 的范围内有效。然后，使用您推导出的表达式，确定在这种锚定场景下，当 $b = 256$ 时，使得碰撞概率满足 $p \\leq 10^{-6}$ 的最大 $n$ 值。将您的最终数值答案四舍五入至四位有效数字。",
            "solution": "首先对问题进行验证，以确保其科学上可靠、问题提出得当且客观。\n\n### 步骤1：提取已知条件\n- 一个数字孪生系统将记录锚定到分布式账本技术（DLT）系统。\n- 锚定是通过提交记录内容的加密哈希值来完成的。\n- 哈希函数在随机预言机模型（ROM）下被建模为一个理想的随机函数。\n- 哈希函数具有固定的比特长度 $b$。\n- 可能的哈希输出数量为 $M = 2^b$。\n- 每个输入被均匀且独立地映射到 $M$ 个输出中的一个。\n- 独立记录的数量为 $n$。\n- 碰撞定义为两条不同的记录产生相同的哈希摘要的事件。\n- 任务1：在 $n \\ll 2^{b/2}$ 的范围内，推导碰撞概率 $p$ 作为 $n$ 和 $b$ 的函数的渐近表达式。此推导必须从有放回抽样的核心组合概率原理开始。\n- 任务2：使用推导出的表达式，确定当 $b = 256$ 时，使得碰撞概率 $p \\leq 10^{-6}$ 的最大 $n$ 值。\n- 四舍五入说明：$n$ 的最终数值答案必须四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据。随机预言机模型是密码学中用于分析哈希函数安全性的标准理论工具。所描述的场景——哈希数据并将哈希值存储在区块链上以保证完整性——是 DLT 的一种常见且有效的应用。该问题是概率论中经典“生日问题”的一个变体。\n\n该问题提出得当。它提供了所有必要的参数（$n$、$b$、$p$）和一个明确的目标。在特定范围（$n \\ll 2^{b/2}$）内进行渐近推导的要求是精确的。随后的数值计算基于特定的值和明确的约束，从而得出唯一的解。\n\n该问题是客观的。语言是技术性的，没有歧义或主观论断。\n\n问题陈述没有违反任何无效标准。它科学上可靠、可形式化、完整且结构良好。\n\n### 步骤3：结论与行动\n该问题被视为有效。将提供完整的解答。\n\n### 解答推导\n\n这个问题等价于生日问题。我们从一个包含 $M$ 种可能性的集合中有放回地选择 $n$ 个项目（哈希值），并且我们想要找到至少有一次重复（一次碰撞）的概率。\n\n令 $p$ 为至少发生一次碰撞的概率。首先计算其互补事件 $p_{nc}$ 的概率会更简单，即没有碰撞的概率。\n\n对 $n$ 条记录进行哈希的总可能结果数为 $M^n$，因为 $n$ 条记录中的每一条都可以独立地哈希到 $M$ 个值中的任意一个。\n\n对于没有碰撞的事件，每条记录必须哈希到唯一的值。\n第一条记录可以哈希到 $M$ 个值中的任意一个。\n第二条记录必须哈希到剩下的 $M-1$ 个值中的一个。\n第三条记录必须哈希到剩下的 $M-2$ 个值中的一个。\n...\n第 $n$ 条记录必须哈希到剩下的 $M-(n-1)$ 个值中的一个。\n\n没有碰撞的结果数是以下乘积：\n$$N_{nc} = M(M-1)(M-2)\\cdots(M-n+1)$$\n这是 $M$ 的 $n$-排列数，记为 $P(M, n)$。\n\n没有碰撞的概率 $p_{nc}$ 是有利结果数与总结果数的比率：\n$$p_{nc} = \\frac{M(M-1)\\cdots(M-n+1)}{M^n} = \\frac{M}{M} \\cdot \\frac{M-1}{M} \\cdot \\frac{M-2}{M} \\cdots \\frac{M-n+1}{M}$$\n这可以写成一个乘积形式：\n$$p_{nc} = \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)$$\n因此，至少有一次碰撞的概率 $p$ 是：\n$$p = 1 - p_{nc} = 1 - \\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)$$\n\n现在，我们必须推导在 $n \\ll 2^{b/2} = \\sqrt{M}$ 范围内有效的 $p$ 的渐近表达式。在此范围内，$n$ 远小于 $M$，这确保了对于乘积中的所有 $k$（$0 \\leq k  n$），$k/M$ 都非常小。\n\n我们可以分析 $p_{nc}$ 的自然对数：\n$$\\ln(p_{nc}) = \\ln\\left(\\prod_{k=0}^{n-1} \\left(1 - \\frac{k}{M}\\right)\\right) = \\sum_{k=0}^{n-1} \\ln\\left(1 - \\frac{k}{M}\\right)$$\n对于一个很小的值 $x$，自然对数的泰勒级数展开为 $\\ln(1-x) = -x - \\frac{x^2}{2} - \\frac{x^3}{3} - \\cdots$。由于 $k/M$ 很小，我们可以近似 $\\ln(1 - k/M) \\approx -k/M$。\n$$\\ln(p_{nc}) \\approx \\sum_{k=0}^{n-1} \\left(-\\frac{k}{M}\\right) = -\\frac{1}{M} \\sum_{k=0}^{n-1} k$$\n前 $n-1$ 个非负整数的和由公式 $\\frac{(n-1)n}{2}$ 给出。\n$$\\ln(p_{nc}) \\approx -\\frac{n(n-1)}{2M}$$\n对两边取指数，得到 $p_{nc}$ 的近似值：\n$$p_{nc} \\approx \\exp\\left(-\\frac{n(n-1)}{2M}\\right)$$\n将其代入 $p$ 的表达式中：\n$$p \\approx 1 - \\exp\\left(-\\frac{n(n-1)}{2M}\\right)$$\n条件 $n \\ll \\sqrt{M}$ 意味着 $n^2 \\ll M$，这意味着指数函数的自变量 $y = \\frac{n(n-1)}{2M}$ 非常接近于零。我们可以使用 $e^{-y}$ 的泰勒级数展开 $e^{-y} = 1 - y + \\frac{y^2}{2!} - \\cdots$。对于小的 $y$，我们可以近似 $e^{-y} \\approx 1-y$。\n$$p \\approx 1 - \\left(1 - \\frac{n(n-1)}{2M}\\right) = \\frac{n(n-1)}{2M}$$\n对于大的 $n$，我们可以进一步近似 $n(n-1) \\approx n^2$，得到 $p \\approx \\frac{n^2}{2M}$。然而，表达式 $p \\approx \\frac{n(n-1)}{2M}$ 更为准确。代入 $M = 2^b$，推导出的渐近表达式为：\n$$p \\approx \\frac{n(n-1)}{2 \\cdot 2^b}$$\n\n这完成了问题的第一部分。对于第二部分，我们必须找到当哈希比特长度 $b = 256$ 时，使得 $p \\leq 10^{-6}$ 的最大 $n$ 值。\n我们使用推导出的渐近表达式：\n$$\\frac{n(n-1)}{2 \\cdot 2^{256}} \\leq 10^{-6}$$\n由于我们预计 $n$ 是一个非常大的数，近似 $n(n-1) \\approx n^2$ 是高度准确的。不等式变为：\n$$\\frac{n^2}{2 \\cdot 2^{256}} \\leq 10^{-6}$$\n解出 $n$：\n$$n^2 \\leq 2 \\cdot 2^{256} \\cdot 10^{-6}$$\n$$n^2 \\leq 2^{257} \\cdot 10^{-6}$$\n$$n \\leq \\sqrt{2^{257} \\cdot 10^{-6}} = 2^{257/2} \\cdot 10^{-3} = 2^{128.5} \\cdot 10^{-3}$$\n为了计算这个值，我们使用以10为底的对数：\n$$\\log_{10}(n) \\leq \\log_{10}(2^{128.5} \\cdot 10^{-3})$$\n$$\\log_{10}(n) \\leq \\log_{10}(2^{128.5}) + \\log_{10}(10^{-3})$$\n$$\\log_{10}(n) \\leq 128.5 \\cdot \\log_{10}(2) - 3$$\n使用值 $\\log_{10}(2) \\approx 0.30102999566$:\n$$\\log_{10}(n) \\leq 128.5 \\cdot (0.30102999566) - 3$$\n$$\\log_{10}(n) \\leq 38.682354442 - 3$$\n$$\\log_{10}(n) \\leq 35.682354442$$\n为了找到 $n$，我们计算 $10$ 的这个次方：\n$$n \\leq 10^{35.682354442} = 10^{0.682354442} \\cdot 10^{35}$$\n$$n \\leq 4.812328 \\times 10^{35}$$\n问题要求的是最大 $n$。由于 $n$ 必须是一个整数，最大值为 $\\lfloor 4.812328 \\times 10^{35} \\rfloor$。我们被要求将最终数值答案四舍五入到四位有效数字。这给出：\n$$n_{max} \\approx 4.812 \\times 10^{35}$$\n我们必须验证这个 $n$ 值是否与用于推导的 $n \\ll 2^{b/2}$ 范围一致。\n这里，$b=256$，所以 $2^{b/2} = 2^{128}$。\n$$2^{128} = 10^{\\log_{10}(2^{128})} = 10^{128 \\cdot \\log_{10}(2)} \\approx 10^{128 \\cdot 0.30103} \\approx 10^{38.53184} \\approx 3.403 \\times 10^{38}$$\n我们计算出的值 $n \\approx 4.812 \\times 10^{35}$ 确实远小于 $2^{128} \\approx 3.403 \\times 10^{38}$。比值约为 $\\frac{n}{2^{128}} \\approx \\frac{4.812 \\times 10^{35}}{3.403 \\times 10^{38}} \\approx 1.4 \\times 10^{-3}$，这是一个小数。因此，使用渐近表达式是合理的。\n在保持碰撞概率低于 $10^{-6}$ 的情况下可以锚定的最大记录数 $n$ 约为 $4.812 \\times 10^{35}$。",
            "answer": "$$\\boxed{4.812 \\times 10^{35}}$$"
        },
        {
            "introduction": "在确认了哈希函数的概率安全性之后，下一个核心问题是如何高效地利用它来为海量数据提供可验证的追溯性。默克尔树（Merkle tree）为此提供了关键的数据结构。本练习  将带您深入默克尔累加器的内部工作原理，通过计算单个事件的审计证明大小和验证所需时间，让您亲身体验数据可追溯性的实际成本。这项技能对于设计需要在资源受限设备上进行验证的数字孪生和网络物理系统至关重要。",
            "id": "4207069",
            "problem": "一个用于信息物理系统（CPS）的生产级数字孪生记录了一条包含 $10^{5}$ 个顺序事件的监管链。每个事件都作为叶子节点提交到一个基于二叉树结构的仅追加默克尔累加器中，其中每个内部节点存储其两个子节点哈希值串联后的加密哈希值。默克尔根被周期性地锚定在区块链上。一个计算资源有限的客户端验证单个事件的成员资格证明，以确保数据的完整性和可追溯性。\n\n假设如下：\n- 加密哈希函数为安全哈希算法256（SHA-256），其输出长度为 $h=256$ 位，并接受可变长度的输入。\n- 该累加器表示为一个满二叉默克尔树，其叶子节点对应于事件；当叶子节点数量不是2的幂时，会对树进行必要的填充，使得从叶子到根的路径长度等于 $\\lceil \\log_{2}(n) \\rceil$，其中 $n$ 是叶子节点的数量。\n- 一个叶子节点的成员资格证明包含从该叶子到根的路径上的一系列兄弟节点的哈希值，以及每个层级一个用于指示兄弟节点在左侧还是右侧的方向位。除这些组件外，证明中不包含额外的元数据或签名。\n- 客户端设备处理哈希的持续数据吞吐量为 $r=5 \\times 10^{6}$ 字节/秒，并且每次哈希调用会产生固定的开销 $t_{0}=4 \\times 10^{-4}$ 秒，该开销与输入长度无关。在验证的每个层级，父哈希是通过将当前节点哈希与其兄弟节点的哈希串联计算得出的，因此每个层级的输入长度为 $2 \\times (h/8)$ 字节。\n\n任务：\n1. 计算单个事件的审计证明大小，单位为 kibibyte (KiB)，其中 $1$ Kibibyte $=1024$ 字节。计算中需包括方向位的开销（以字节为单位打包），假设方向位被紧密打包，对于长度为 $L$ 层的路径，消耗 $\\lceil L/8 \\rceil$ 字节。\n2. 计算客户端端到端验证单个成员资格证明所需的总验证时间（以秒为单位），计算中需考虑每次哈希的固定开销和每个层级的数据处理时间。\n\n将两个数值答案四舍五入到四位有效数字。以 $[$证明大小（KiB）$, $验证时间（秒）$]$ 的顺序，将最终答案表示为一个双元素行矩阵。",
            "solution": "在尝试求解之前，对问题陈述进行验证。\n\n### 第1步：提取已知条件\n- 顺序事件的数量（默克尔树中的叶子节点）：$n = 10^{5}$\n- 哈希函数：SHA-256\n- 哈希输出长度：$h = 256$ 位\n- 默克尔树结构：一个满二叉树，经过填充以使从任意叶子到根的路径长度为 $L = \\lceil \\log_{2}(n) \\rceil$。\n- 成员资格证明内容：一系列兄弟节点的哈希值以及每个层级一个方向位。\n- 客户端哈希计算吞吐量：$r = 5 \\times 10^{6}$ 字节/秒\n- 固定的单次哈希调用开销：$t_{0} = 4 \\times 10^{-4}$ 秒\n- 验证期间每次哈希计算的输入长度：$2 \\times (h/8)$ 字节\n- 证明大小的目标单位：kibibyte (KiB)，其中 $1 \\text{ KiB} = 1024$ 字节\n- 验证时间的目标单位：秒\n- 要求精度：将最终数值答案四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n评估问题的有效性。\n\n- **科学依据**：该问题充分基于计算机科学和密码学的既定原则。默克尔累加器、SHA-256和成员资格证明的概念是确保数据完整性的标准工具，尤其是在区块链和分布式账本技术中。其性能模型将固定的调用开销与依赖于数据吞吐量的成本分开，是性能分析中一种常见且合理的简化方法。\n- **适定性**：该问题是适定的。它提供了所有必要的参数（$n$、$h$、$r$、$t_0$）和一组明确的任务（计算证明大小和验证时间）。树结构和证明构成的定义清晰明确，能够推导出一个唯一的解。\n- **客观性**：问题以客观、技术性的语言陈述，没有主观或推测性的主张。\n- **完整性与一致性**：所提供的数据是自洽且一致的。使用 $L = \\lceil \\log_{2}(n) \\rceil$ 正确地处理了叶子节点数不是2的幂的树的路径长度。验证过程的描述与标准的默克尔证明验证一致。\n- **现实性**：参数是现实的。一个包含 $10^{5}$ 个事件的系统是常见的规模。一个哈希吞吐量为 $5$ MB/s、单次调用开销为 $0.4$ ms 的客户端设备对于现代嵌入式或移动硬件是合理的。\n\n### 第3步：结论与行动\n该问题被判定为**有效**，因为它具有科学依据、适定性，并且其所有组成部分都一致且定义清晰。现在开始求解。\n\n### 解题过程\n\n解答分为两部分，对应于所要求的两个任务。\n\n**第1部分：审计证明大小计算**\n\n首先，我们确定默克尔树的层数，它决定了成员资格证明中组件的数量。对于一个有 $n$ 个叶子节点的树，从任意叶子到根的路径长度 $L$ 由下式给出：\n$$L = \\lceil \\log_{2}(n) \\rceil$$\n代入给定值 $n = 10^{5}$：\n$$L = \\lceil \\log_{2}(10^{5}) \\rceil = \\lceil 5 \\log_{2}(10) \\rceil$$\n使用对数的换底公式，$\\log_{2}(10) = \\frac{\\ln(10)}{\\ln(2)} \\approx \\frac{2.302585}{0.693147} \\approx 3.321928$。\n$$L = \\lceil 5 \\times 3.321928 \\rceil = \\lceil 16.60964 \\rceil = 17$$\n单个事件的成员资格证明必须包含从叶子到根的树的 $L=17$ 个层级中每一层的一个兄弟哈希值。\n\n证明的大小 $S$ 是这些兄弟哈希值的大小和方向位大小的总和。\n\n单个哈希输出的大小为 $h = 256$ 位。以字节为单位，即：\n$$S_{hash} = \\frac{h}{8} = \\frac{256}{8} = 32 \\text{ bytes}$$\n证明中 $L$ 个兄弟哈希值的总大小为：\n$$S_{hashes} = L \\times S_{hash} = 17 \\times 32 = 544 \\text{ bytes}$$\n\n证明还包括 $L = 17$ 个方向位。问题陈述这些位是紧密打包并存储在 $\\lceil L/8 \\rceil$ 字节中的。\n$$S_{bits} = \\lceil \\frac{L}{8} \\rceil = \\lceil \\frac{17}{8} \\rceil = \\lceil 2.125 \\rceil = 3 \\text{ bytes}$$\n\n证明的总大小（以字节为单位）是哈希数据和方向位数据的总和：\n$$S_{total} = S_{hashes} + S_{bits} = 544 + 3 = 547 \\text{ bytes}$$\n\n为了将其转换为 kibibyte (KiB)，我们使用换算因子 $1 \\text{ KiB} = 1024$ 字节。\n$$S_{\\text{KiB}} = \\frac{S_{total}}{1024} = \\frac{547}{1024} \\approx 0.5341796875 \\text{ KiB}$$\n四舍五入到四位有效数字，证明大小为 $0.5342$ KiB。\n\n**第2部分：验证时间计算**\n\n总验证时间 $T_{total}$ 是总固定开销时间 $T_{overhead}$ 和总数据处理时间 $T_{proc}$ 的和。\n$$T_{total} = T_{overhead} + T_{proc}$$\n验证要求客户端在每个层级执行一次哈希计算，以将当前节点的哈希与其兄弟节点的哈希结合起来，然后向树的上方前进。由于有 $L=17$ 个层级，因此需要进行 $17$ 次哈希计算。\n\n总固定开销是哈希调用次数乘以单次哈希开销 $t_{0}$。\n$$T_{overhead} = L \\times t_{0} = 17 \\times (4 \\times 10^{-4} \\text{ s}) = 68 \\times 10^{-4} \\text{ s} = 0.0068 \\text{ s}$$\n\n数据处理时间取决于哈希函数必须处理的总数据量。在 $L=17$ 个层级中的每一层，哈希函数的输入是两个哈希值的串联。这个输入的大小 $D_{input}$ 是：\n$$D_{input} = 2 \\times S_{hash} = 2 \\times 32 = 64 \\text{ bytes}$$\n在所有 $L$ 个层级上处理的总数据量 $D_{total}$ 是：\n$$D_{total} = L \\times D_{input} = 17 \\times 64 = 1088 \\text{ bytes}$$\n总数据处理时间是这个总数据大小除以客户端的处理吞吐量 $r$。\n$$T_{proc} = \\frac{D_{total}}{r} = \\frac{1088 \\text{ bytes}}{5 \\times 10^{6} \\text{ bytes/s}} = 217.6 \\times 10^{-6} \\text{ s} = 0.0002176 \\text{ s}$$\n\n最后，总验证时间是：\n$$T_{total} = T_{overhead} + T_{proc} = 0.0068 \\text{ s} + 0.0002176 \\text{ s} = 0.0070176 \\text{ s}$$\n四舍五入到四位有效数字，验证时间为 $0.007018$ 秒。\n\n最终答案是证明大小（以 KiB 为单位）和验证时间（以秒为单位），表示为一个双元素行矩阵。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.5342  0.007018\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "将区块链技术用于确保数据完整性，并不仅仅是一个纯粹的数字信息处理问题，尤其是在网络物理系统（CPS）中，它会直接影响到物理世界的实时动态。本练习  将您置于一个安全关键型控制系统的设计场景中，要求您运用控制理论的知识来分析问题。通过计算为保证系统稳定性（以相位裕度为指标）所允许的最大区块链附加延迟，您将学会如何量化和平衡数据完整性需求与物理系统的实时性及安全性要求之间的内在张力。",
            "id": "4207045",
            "problem": "一个安全关键的信息物理系统（CPS）及其同步的数字孪生（DT）使用许可链来不可变地记录每个感测到的状态和控制执行，以确保数据完整性和可追溯性。该物理对象被建模为一个线性时不变的单输入单输出系统，其传递函数为 $P(s)=\\frac{1}{s+1}$，由一个连续时间比例控制器 $C(s)=K$（其中 $K=3$）进行控制。区块链提交被置于回路中，因此控制器在执行前将每个控制决策提交到账本，这引入了一个额外的纯传输延迟。回路中所有非区块链延迟也建模为纯延迟，具体如下：传感器延迟 $\\delta_{s}=20\\,\\mathrm{ms}$，边缘计算时间 $\\delta_{c}=15\\,\\mathrm{ms}$，网络传输时间 $\\delta_{n}=10\\,\\mathrm{ms}$，以及执行器接口延迟 $\\delta_{a}=5\\,\\mathrm{ms}$。由区块链引起的延迟记为 $\\tau_{bc}$。假设系统为线性时不变动力学，并且所有延迟作为一个等效的纯延迟进入前向通路。\n\n为了维持安全关键性能，闭环相位裕度的要求下限为 $\\phi_{\\min}=\\frac{\\pi}{3}$ 弧度。使用开环穿越频率和相位裕度的频域定义，以及纯时间延迟对相位的影响，推导出在不违反相位裕度要求的情况下，可增加的最大允许区块链延迟 $\\tau_{bc,\\max}$ 的精确表达式。然后使用给定数据进行数值计算。\n\n最终答案以秒为单位表示，并四舍五入到四位有效数字。所有角度均以弧度为单位。",
            "solution": "该问题经评估具有科学依据、提法明确、客观且自成体系，因此被认为是有效的。我们可以开始进行正式求解。\n\n所描述的系统是一个负反馈控制回路。开环传递函数记为 $L(s)$，由控制器传递函数 $C(s)$、对象传递函数 $P(s)$ 以及代表总纯时间延迟的传递函数 $e^{-s\\tau_{total}}$ 的乘积构成。\n\n给定的组件如下：\n- 对象传递函数：$P(s) = \\frac{1}{s+1}$\n- 控制器传递函数（比例控制）：$C(s) = K$，给定增益 $K=3$。\n- 总时间延迟 $\\tau_{total}$ 是回路中所有单个延迟的总和。\n\n各个延迟分别为：传感器延迟 $\\delta_{s}=20\\,\\mathrm{ms}$，边缘计算时间 $\\delta_{c}=15\\,\\mathrm{ms}$，网络传输时间 $\\delta_{n}=10\\,\\mathrm{ms}$，执行器接口延迟 $\\delta_{a}=5\\,\\mathrm{ms}$，以及由区块链引起的延迟 $\\tau_{bc}$。\n\n我们首先将固定的、非区块链延迟的总和定义为 $\\tau_{fixed}$：\n$$\n\\tau_{fixed} = \\delta_{s} + \\delta_{c} + \\delta_{n} + \\delta_{a}\n$$\n那么总延迟为：\n$$\n\\tau_{total} = \\tau_{fixed} + \\tau_{bc}\n$$\n开环传递函数 $L(s)$ 的构造如下：\n$$\nL(s) = C(s) P(s) e^{-s\\tau_{total}} = \\frac{K}{s+1} e^{-s\\tau_{total}}\n$$\n代入 $K=3$ 的值：\n$$\nL(s) = \\frac{3}{s+1} e^{-s\\tau_{total}}\n$$\n为了分析相位裕度，我们必须首先确定增益穿越频率 $\\omega_c$。它被定义为开环传递函数的幅值等于1时的频率。\n$$\n|L(j\\omega_c)| = 1\n$$\n我们通过令 $s=j\\omega$ 来计算幅值：\n$$\n|L(j\\omega)| = \\left| \\frac{3}{j\\omega+1} e^{-j\\omega\\tau_{total}} \\right| = \\left| \\frac{3}{j\\omega+1} \\right| |e^{-j\\omega\\tau_{total}}|\n$$\n纯延迟项的幅值 $|e^{-j\\omega\\tau_{total}}|$ 始终为 $1$。剩余部分的幅值为：\n$$\n\\left| \\frac{3}{j\\omega+1} \\right| = \\frac{|3|}{|j\\omega+1|} = \\frac{3}{\\sqrt{\\omega^2 + 1^2}}\n$$\n在 $\\omega = \\omega_c$ 时令其等于 $1$：\n$$\n\\frac{3}{\\sqrt{\\omega_c^2 + 1}} = 1\n$$\n$$\n3 = \\sqrt{\\omega_c^2 + 1}\n$$\n两边平方可得：\n$$\n9 = \\omega_c^2 + 1\n$$\n求解 $\\omega_c$：\n$$\n\\omega_c^2 = 8 \\implies \\omega_c = \\sqrt{8} = 2\\sqrt{2} \\, \\mathrm{rad/s}\n$$\n注意频率必须为非负数。\n\n接下来，我们求开环传递函数的相位 $\\angle L(j\\omega)$。这是各项相位贡献的总和：\n$$\n\\angle L(j\\omega) = \\angle\\left(\\frac{3}{j\\omega+1}\\right) + \\angle(e^{-j\\omega\\tau_{total}})\n$$\n第一项的相位是：\n$$\n\\angle\\left(\\frac{3}{j\\omega+1}\\right) = \\angle(3) - \\angle(1+j\\omega) = 0 - \\arctan\\left(\\frac{\\omega}{1}\\right) = -\\arctan(\\omega)\n$$\n时间延迟的相位贡献是：\n$$\n\\angle(e^{-j\\omega\\tau_{total}}) = -\\omega\\tau_{total}\n$$\n因此，总相位是：\n$$\n\\angle L(j\\omega) = -\\arctan(\\omega) - \\omega\\tau_{total}\n$$\n相位裕度 $\\phi_m$ 由以下关系式定义，角度以弧度为单位：\n$$\n\\phi_m = \\pi + \\angle L(j\\omega_c)\n$$\n代入我们在 $\\omega_c$ 处的相位表达式：\n$$\n\\phi_m = \\pi - \\arctan(\\omega_c) - \\omega_c\\tau_{total}\n$$\n问题要求最小相位裕度为 $\\phi_{\\min} = \\frac{\\pi}{3}$ 弧度。为了求出最大允许总延迟 $\\tau_{total, \\max}$，我们将 $\\phi_m$ 设为此下限：\n$$\n\\frac{\\pi}{3} = \\pi - \\arctan(\\omega_c) - \\omega_c\\tau_{total, \\max}\n$$\n我们现在求解 $\\tau_{total, \\max}$：\n$$\n\\omega_c\\tau_{total, \\max} = \\pi - \\frac{\\pi}{3} - \\arctan(\\omega_c) = \\frac{2\\pi}{3} - \\arctan(\\omega_c)\n$$\n$$\n\\tau_{total, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(\\omega_c)}{\\omega_c}\n$$\n代入 $\\omega_c = 2\\sqrt{2}$：\n$$\n\\tau_{total, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(2\\sqrt{2})}{2\\sqrt{2}}\n$$\n最大允许的区块链延迟 $\\tau_{bc, \\max}$ 是这个最大总延迟与固定延迟总和之间的差值：\n$$\n\\tau_{bc, \\max} = \\tau_{total, \\max} - \\tau_{fixed}\n$$\n首先，我们计算以秒为单位的总固定延迟：\n$$\n\\tau_{fixed} = (20 + 15 + 10 + 5) \\, \\mathrm{ms} = 50 \\, \\mathrm{ms} = 0.050 \\, \\mathrm{s}\n$$\n现在我们可以写出 $\\tau_{bc, \\max}$ 的最终符号表达式：\n$$\n\\tau_{bc, \\max} = \\frac{\\frac{2\\pi}{3} - \\arctan(2\\sqrt{2})}{2\\sqrt{2}} - 0.050\n$$\n为了获得数值，我们计算各项的值（所有角度均使用弧度）：\n$$\n\\frac{2\\pi}{3} \\approx 2.094395\n$$\n$$\n2\\sqrt{2} \\approx 2.828427\n$$\n$$\n\\arctan(2\\sqrt{2}) \\approx \\arctan(2.828427) \\approx 1.230960\n$$\n将这些值代入 $\\tau_{total, \\max}$ 的表达式中：\n$$\n\\tau_{total, \\max} \\approx \\frac{2.094395 - 1.230960}{2.828427} = \\frac{0.863435}{2.828427} \\approx 0.305267 \\, \\mathrm{s}\n$$\n最后，我们减去固定延迟以求得 $\\tau_{bc, \\max}$：\n$$\n\\tau_{bc, \\max} \\approx 0.305267 - 0.050 = 0.255267 \\, \\mathrm{s}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\tau_{bc, \\max} \\approx 0.2553 \\, \\mathrm{s}\n$$",
            "answer": "$$\\boxed{0.2553}$$"
        }
    ]
}