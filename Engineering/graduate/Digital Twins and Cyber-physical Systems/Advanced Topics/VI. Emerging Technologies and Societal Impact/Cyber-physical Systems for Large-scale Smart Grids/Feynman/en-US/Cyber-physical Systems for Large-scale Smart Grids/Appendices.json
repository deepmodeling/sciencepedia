{
    "hands_on_practices": [
        {
            "introduction": "Understanding the dynamic response of a power grid to load changes is fundamental to designing a stable cyber-physical system. This first practice explores the foundational principles of frequency control by analyzing the system's reaction to a sudden load increase. By deriving the closed-loop transfer function and applying the Final Value Theorem, you will analytically demonstrate the distinct roles of primary droop control for initial stabilization and secondary integral control for eliminating steady-state frequency error, a cornerstone concept in automatic generation control (AGC).",
            "id": "4211441",
            "problem": "A large-scale smart grid is modeled as a single-area aggregate in a cyber-physical system with a digital twin that estimates the system frequency deviation and dispatches control actions. The aggregate dynamics of the physical grid frequency are modeled by the swing equation and linearized primary and secondary controls. Assume the following standard elements:\n\n- The swing equation for the aggregate frequency deviation is $M \\frac{d \\Delta \\omega(t)}{dt} = \\Delta P_{m}(t) - \\Delta P_{L}(t) - D \\Delta \\omega(t)$, where $M$ is the equivalent inertia constant, $D$ is the equivalent damping coefficient representing load-frequency sensitivity, $\\Delta \\omega(t)$ is the angular frequency deviation in radians per second, $\\Delta P_{m}(t)$ is the mechanical power deviation, and $\\Delta P_{L}(t)$ is the load deviation.\n- Primary droop control uses droop coefficient $R$ such that the primary control gain is $K_{p} = \\frac{1}{R}$, and it contributes to mechanical power as $\\Delta P_{m,\\mathrm{pri}}(t) = - K_{p} \\Delta \\omega(t)$.\n- Secondary control (automatic generation control) uses integral action with gain $K_{i}$ acting on the measured frequency deviation, producing $\\Delta P_{\\mathrm{sec}}(t)$ with $\\frac{d}{dt}\\Delta P_{\\mathrm{sec}}(t) = - K_{i} \\Delta \\omega(t)$. The net mechanical power deviation is $\\Delta P_{m}(t) = \\Delta P_{m,\\mathrm{pri}}(t) + \\Delta P_{\\mathrm{sec}}(t)$.\n- The digital twin provides an accurate $\\Delta \\omega(t)$; all signal measurements and actuation are idealized (no deadbands, delays, or saturation).\n\nAt time $t = 0$, the area experiences a step increase in load of magnitude $\\Delta P_{L}(t) = \\Delta P_{0} u(t)$ with $\\Delta P_{0} = 100$ MW, where $u(t)$ is the unit step. Starting from the above definitions and fundamental laws, derive the closed-loop input-output relation from $\\Delta P_{L}(s)$ to $\\Delta \\omega(s)$, and use it to compute the steady-state frequency deviation $\\lim_{t \\to \\infty} \\Delta f(t)$, where $\\Delta f(t) = \\frac{\\Delta \\omega(t)}{2 \\pi}$. Express the final answer in Hertz. Do not round; provide the exact value as a single number.",
            "solution": "The problem requires the derivation of the closed-loop transfer function mapping a load disturbance to the system's frequency deviation and the subsequent calculation of the steady-state frequency deviation for a step-load disturbance. The analysis begins with the provided dynamic equations for the single-area smart grid model.\n\nThe governing equations are:\n1. Swing Equation: $M \\frac{d \\Delta \\omega(t)}{dt} = \\Delta P_{m}(t) - \\Delta P_{L}(t) - D \\Delta \\omega(t)$\n2. Net Mechanical Power: $\\Delta P_{m}(t) = \\Delta P_{m,\\mathrm{pri}}(t) + \\Delta P_{\\mathrm{sec}}(t)$\n3. Primary Control (Droop): $\\Delta P_{m,\\mathrm{pri}}(t) = - K_{p} \\Delta \\omega(t)$\n4. Secondary Control (Integral Action): $\\frac{d}{dt}\\Delta P_{\\mathrm{sec}}(t) = - K_{i} \\Delta \\omega(t)$\n\nTo derive the transfer function, we convert these time-domain equations to the Laplace domain. Assuming the system is at rest before $t=0$, all initial conditions are zero. The Laplace transforms of the equations are:\n\n1'. $M s \\Delta \\omega(s) = \\Delta P_{m}(s) - \\Delta P_{L}(s) - D \\Delta \\omega(s)$\n2'. $\\Delta P_{m}(s) = \\Delta P_{m,\\mathrm{pri}}(s) + \\Delta P_{\\mathrm{sec}}(s)$\n3'. $\\Delta P_{m,\\mathrm{pri}}(s) = - K_{p} \\Delta \\omega(s)$\n4'. $s \\Delta P_{\\mathrm{sec}}(s) = - K_{i} \\Delta \\omega(s)$, which implies $\\Delta P_{\\mathrm{sec}}(s) = -\\frac{K_{i}}{s} \\Delta \\omega(s)$\n\nWe combine these algebraic equations to find the relationship between the input, $\\Delta P_{L}(s)$, and the output, $\\Delta \\omega(s)$. First, substitute the expressions for $\\Delta P_{m,\\mathrm{pri}}(s)$ and $\\Delta P_{\\mathrm{sec}}(s)$ into the equation for the net mechanical power, $\\Delta P_{m}(s)$:\n$\\Delta P_{m}(s) = - K_{p} \\Delta \\omega(s) - \\frac{K_{i}}{s} \\Delta \\omega(s) = - \\left( K_{p} + \\frac{K_{i}}{s} \\right) \\Delta \\omega(s)$\n\nNext, substitute this expression for $\\Delta P_{m}(s)$ into the transformed swing equation (1'):\n$M s \\Delta \\omega(s) = - \\left( K_{p} + \\frac{K_{i}}{s} \\right) \\Delta \\omega(s) - \\Delta P_{L}(s) - D \\Delta \\omega(s)$\n\nTo solve for $\\Delta \\omega(s)$, we rearrange the equation by moving all terms containing $\\Delta \\omega(s)$ to the left-hand side:\n$M s \\Delta \\omega(s) + D \\Delta \\omega(s) + K_{p} \\Delta \\omega(s) + \\frac{K_{i}}{s} \\Delta \\omega(s) = - \\Delta P_{L}(s)$\n\nFactor out $\\Delta \\omega(s)$:\n$\\Delta \\omega(s) \\left( Ms + D + K_{p} + \\frac{K_{i}}{s} \\right) = - \\Delta P_{L}(s)$\n\nTo simplify the expression in the parentheses, we find a common denominator, $s$:\n$\\Delta \\omega(s) \\left( \\frac{Ms^{2} + (D + K_{p})s + K_{i}}{s} \\right) = - \\Delta P_{L}(s)$\n\nThe closed-loop input-output relation, which is the transfer function $G(s) = \\frac{\\Delta \\omega(s)}{\\Delta P_{L}(s)}$, is therefore:\n$$G(s) = \\frac{\\Delta \\omega(s)}{\\Delta P_{L}(s)} = \\frac{-s}{Ms^{2} + (D + K_{p})s + K_{i}}$$\n\nThis is the first required result. Now we proceed to compute the steady-state frequency deviation. The grid experiences a step increase in load of magnitude $\\Delta P_{0} = 100$ MW, such that $\\Delta P_{L}(t) = \\Delta P_{0} u(t)$. The Laplace transform of this input is:\n$\\Delta P_{L}(s) = \\mathcal{L}\\{\\Delta P_{0} u(t)\\} = \\frac{\\Delta P_{0}}{s}$\n\nThe angular frequency deviation in the Laplace domain, $\\Delta \\omega(s)$, is the product of the transfer function $G(s)$ and the input $\\Delta P_{L}(s)$:\n$\\Delta \\omega(s) = G(s) \\Delta P_{L}(s) = \\left( \\frac{-s}{Ms^{2} + (D + K_{p})s + K_{i}} \\right) \\left( \\frac{\\Delta P_{0}}{s} \\right)$\n$\\Delta \\omega(s) = \\frac{-\\Delta P_{0}}{Ms^{2} + (D + K_{p})s + K_{i}}$\n\nTo find the steady-state value of the angular frequency deviation, $\\Delta \\omega_{ss} = \\lim_{t \\to \\infty} \\Delta \\omega(t)$, we apply the Final Value Theorem (FVT) of Laplace transforms, which states that $\\lim_{t \\to \\infty} y(t) = \\lim_{s \\to 0} s Y(s)$, provided that all poles of $sY(s)$ are in the left half of the complex plane. The poles of the system are the roots of the characteristic equation $Ms^{2} + (D + K_{p})s + K_{i} = 0$. For a physically stable power system, the inertia $M$, damping $D$, primary control gain $K_p$, and secondary control gain $K_i$ are all positive constants. The coefficients of the second-order characteristic polynomial are $M > 0$, $(D + K_{p}) > 0$, and $K_{i} > 0$. According to the Routh-Hurwitz stability criterion, a second-order system is stable if and only if all coefficients have the same sign. Since all coefficients are positive, the system is stable, its poles lie in the left half-plane, and the FVT is applicable.\n\nApplying the FVT:\n$\\Delta \\omega_{ss} = \\lim_{s \\to 0} s \\Delta \\omega(s) = \\lim_{s \\to 0} s \\left( \\frac{-\\Delta P_{0}}{Ms^{2} + (D + K_{p})s + K_{i}} \\right)$\n$\\Delta \\omega_{ss} = \\lim_{s \\to 0} \\frac{-s \\Delta P_{0}}{Ms^{2} + (D + K_{p})s + K_{i}}$\n\nEvaluating the limit by substituting $s=0$:\n$\\Delta \\omega_{ss} = \\frac{-(0) \\Delta P_{0}}{M(0)^{2} + (D + K_{p})(0) + K_{i}} = \\frac{0}{K_{i}}$\nSince $K_i$ is a non-zero gain, the result is:\n$\\Delta \\omega_{ss} = 0$ rad/s\n\nThis result demonstrates a fundamental property of integral control: it drives the steady-state error to zero for a step input. The secondary control (AGC) ensures that the frequency returns to its nominal value after a load disturbance.\n\nThe problem asks for the steady-state frequency deviation in Hertz, $\\Delta f_{ss}$. The relationship between angular frequency deviation $\\Delta \\omega$ and frequency deviation $\\Delta f$ is $\\Delta f(t) = \\frac{\\Delta \\omega(t)}{2 \\pi}$.\nThus, the steady-state value is:\n$\\Delta f_{ss} = \\lim_{t \\to \\infty} \\Delta f(t) = \\frac{1}{2 \\pi} \\lim_{t \\to \\infty} \\Delta \\omega(t) = \\frac{\\Delta \\omega_{ss}}{2 \\pi} = \\frac{0}{2 \\pi} = 0$ Hz.\nThe steady-state frequency deviation is $0$ Hertz.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "While analytical methods are powerful for understanding steady-state behavior, real-world grid events involve complex transient dynamics that are best explored through simulation. This exercise introduces the concept of a hybrid system, where a discrete event—an abrupt transmission line trip—causes a switch in the system's continuous dynamics. You will model this scenario by formulating and numerically integrating a set of ordinary differential equations, providing a hands-on experience in simulating the grid's transient frequency response and evaluating critical performance metrics like the frequency nadir.",
            "id": "4211450",
            "problem": "Consider an aggregated area of a large-scale smart grid modeled as a hybrid cyber-physical system with two discrete modes: nominal operation (grid-connected) and islanded mode (after a line trip event). The system transitions from nominal to islanded mode at time $t = 1\\ \\text{s}$ due to an instantaneous loss of an intertie. The objective is to compute the post-event frequency trajectory under primary frequency droop control, using a principled continuous-time model based on foundational power system dynamics.\n\nStart from the swing equation for an equivalent generator representing the area. Use per-unit normalization on the area power base and incorporate frequency-dependent load damping. Let $H$ denote the inertia constant in seconds, $f_0$ the nominal frequency in hertz, and let $\\Delta f(t)$ be the frequency deviation in hertz. Let $\\Delta P_m(t)$ be the mechanical power deviation from pre-event equilibrium in per unit, and let $\\Delta P_e(t)$ be the electrical power deviation in per unit due to the disturbance and load-frequency effects. Assume load-frequency sensitivity is modeled by a linear damping coefficient $D$ (per unit power per per-unit frequency deviation). Assume primary control is realized by a first-order governor with droop coefficient $R$ (per-unit frequency per per-unit power) and a time constant $T_g$ (in seconds). Assume the aggregate electrical disturbance is a step increase in electrical power demand equal to the lost import $P_{\\text{step}}$ (in per unit) applied at $t = 1\\ \\text{s}$, i.e., $\\Delta P_e(t)$ includes a step of magnitude $P_{\\text{step}}$ at $t = 1\\ \\text{s}$ representing islanding.\n\nYou must derive, implement, and simulate the continuous dynamics that follow from:\n- The swing equation and power balance conservation, and\n- The governor droop law with a first-order actuator model.\n\nLet the hybrid switch be defined as follows:\n- For $0 \\le t  1\\ \\text{s}$ (nominal operation mode), $\\Delta P_e(t) = 0$ and the system is at equilibrium with $\\Delta f(0) = 0$ and $\\Delta P_m(0) = 0$.\n- For $t \\ge 1\\ \\text{s}$ (islanded mode), $\\Delta P_e(t) = P_{\\text{step}}$, i.e., an increase in effective electrical power demand equal to the lost import.\n\nUsing only these foundational principles and definitions, formulate the minimal closed set of ordinary differential equations in continuous time for the states $\\Delta f(t)$ (in hertz) and $\\Delta P_m(t)$ (in per unit), valid for all $t \\ge 0$ with the hybrid forcing $\\Delta P_e(t)$ defined above. Numerically integrate the resulting system over a finite horizon $[0, T_{\\text{end}}]$ for each parameter set in the test suite below. The numerical integration method is not prescribed; you may use any standard method suitable for stiff or non-stiff systems. The discrete event at $t = 1\\ \\text{s}$ must be enforced exactly in the forcing term as a mode switch.\n\nFor each test case, compute the following two scalar performance metrics, expressed in hertz:\n1. The frequency nadir after the event, defined as $\\min_{t \\in [1\\ \\text{s}, T_{\\text{end}}]} \\left(f_0 + \\Delta f(t)\\right)$, in hertz, rounded to $6$ decimal places.\n2. The absolute frequency at time $t = 5\\ \\text{s}$, i.e., $f_0 + \\Delta f(5\\ \\text{s})$, in hertz, rounded to $6$ decimal places.\n\nAll physical quantities that appear in the final answers must be reported in hertz. Angles do not appear in this problem, so no angle unit is required. Percentages must not be used; all values are real numbers.\n\nTest suite parameters:\n- Case A (happy path, $50$ hertz system, moderate inertia and droop): $f_0 = 50\\ \\text{Hz}$, $H = 5$, $D = 1$, $R = 0.05$, $T_g = 0.5\\ \\text{s}$, $P_{\\text{step}} = 0.2$, $T_{\\text{end}} = 10\\ \\text{s}$.\n- Case B (different nominal frequency, low inertia, strong primary response): $f_0 = 60\\ \\text{Hz}$, $H = 2$, $D = 0.5$, $R = 0.04$, $T_g = 0.2\\ \\text{s}$, $P_{\\text{step}} = 0.1$, $T_{\\text{end}} = 8\\ \\text{s}$.\n- Case C (high inertia, weak droop, larger disturbance): $f_0 = 50\\ \\text{Hz}$, $H = 10$, $D = 2$, $R = 0.1$, $T_g = 1.0\\ \\text{s}$, $P_{\\text{step}} = 0.3$, $T_{\\text{end}} = 12\\ \\text{s}$.\n- Case D (edge case with negligible disturbance, no explicit load damping): $f_0 = 50\\ \\text{Hz}$, $H = 3$, $D = 0$, $R = 0.05$, $T_g = 0.05\\ \\text{s}$, $P_{\\text{step}} = 0.001$, $T_{\\text{end}} = 5.5\\ \\text{s}$.\n\nYour program must:\n- Implement the model derived from the fundamental principles to compute $\\Delta f(t)$ and $\\Delta P_m(t)$ for each test case with the hybrid switch at $t = 1\\ \\text{s}$.\n- For each test case, output the two hertz-valued metrics specified above, rounded to $6$ decimal places.\n- Aggregate all results for the four cases into a single line of output containing a comma-separated list enclosed in square brackets, ordered as $[\\text{nadir}_A,\\ f_5^{(A)},\\ \\text{nadir}_B,\\ f_5^{(B)},\\ \\text{nadir}_C,\\ f_5^{(C)},\\ \\text{nadir}_D,\\ f_5^{(D)}]$, where each entry is a float.\n\nThe final output must be exactly one line in the specified format, with no additional text.",
            "solution": "The problem requires the formulation and numerical solution of a continuous-time model for the primary frequency response of an islanded power system area. The model must be derived from first principles, specifically the swing equation and a first-order governor model. We will construct a state-space representation of the system dynamics. The state variables are the frequency deviation, $\\Delta f(t)$ in hertz, and the mechanical power deviation, $\\Delta P_m(t)$ in per unit (p.u.).\n\nThe system is defined by two interconnected physical principles: the conservation of energy (swing equation) and the primary control action (governor response).\n\nFirst, we establish the swing equation which governs the dynamics of the rotational speed of the equivalent generator representing the area. The linearized swing equation, relating the change in rotor speed to the power imbalance, is given by:\n$$\n\\frac{2H}{f_0} \\frac{d(\\Delta f)}{dt} = \\Delta P_m(t) - \\Delta P_{load}(t)\n$$\nHere, $H$ is the aggregate inertia constant in seconds, $f_0$ is the nominal system frequency in Hz, $\\Delta f(t)$ is the frequency deviation in Hz, and $\\Delta P_m(t)$ is the deviation in mechanical power input from its pre-event equilibrium value in p.u. The term $\\Delta P_{load}(t)$ represents the total deviation in electrical load in p.u. This total load deviation is composed of two parts: the external disturbance $\\Delta P_e(t)$ and the frequency-dependent load response (load damping).\n\nThe external disturbance $\\Delta P_e(t)$ is modeled as a step function due to the islanding event at $t=1\\,\\text{s}$:\n$$\n\\Delta P_e(t) = \\begin{cases} 0  \\text{for } t  1\\,\\text{s} \\\\ P_{\\text{step}}  \\text{for } t \\ge 1\\,\\text{s} \\end{cases}\n$$\nwhere $P_{\\text{step}}$ is the magnitude of the lost import power, which now must be supplied by the local generation, effectively acting as an instantaneous increase in local demand.\n\nThe load damping effect models the inherent tendency of many electrical loads to consume slightly less power when frequency drops. This is quantified by the damping coefficient $D$, defined in units of p.u. power per p.u. frequency deviation. The per-unit frequency deviation is $\\frac{\\Delta f(t)}{f_0}$. Thus, the change in load due to damping is $D \\frac{\\Delta f(t)}{f_0}$. This term acts to stabilize the system by counteracting frequency changes.\n\nThe total electrical load deviation is the sum of the disturbance and the damping effect:\n$$\n\\Delta P_{load}(t) = \\Delta P_e(t) + D \\frac{\\Delta f(t)}{f_0}\n$$\nSubstituting this into the swing equation gives:\n$$\n\\frac{2H}{f_0} \\frac{d(\\Delta f)}{dt} = \\Delta P_m(t) - \\left( \\Delta P_e(t) + D \\frac{\\Delta f(t)}{f_0} \\right)\n$$\nRearranging to isolate the derivative of the first state variable, $\\Delta f(t)$, we obtain the first ordinary differential equation (ODE):\n$$\n\\frac{d(\\Delta f)}{dt} = -\\frac{D}{2H} \\Delta f(t) + \\frac{f_0}{2H} \\Delta P_m(t) - \\frac{f_0}{2H} \\Delta P_e(t)\n$$\n\nSecond, we model the primary frequency control action, which is performed by the governor of the equivalent generator. The governor adjusts the mechanical power input $\\Delta P_m(t)$ in response to the frequency deviation $\\Delta f(t)$. The control law is based on a droop characteristic, where the desired steady-state mechanical power change is proportional to the frequency deviation. The droop coefficient $R$ is defined as the change in p.u. frequency required for a full p.u. power response. The target power reference for the governor, $\\Delta P_{ref}(t)$, is therefore:\n$$\n\\Delta P_{ref}(t) = -\\frac{1}{R} \\left( \\frac{\\Delta f(t)}{f_0} \\right)\n$$\nThe negative sign ensures that a frequency drop (negative $\\Delta f$) results in a command to increase mechanical power.\n\nThe problem specifies a first-order actuator model for the governor, with a time constant $T_g$. This means the actual mechanical power $\\Delta P_m(t)$ follows the reference $\\Delta P_{ref}(t)$ with a first-order lag:\n$$\nT_g \\frac{d(\\Delta P_m)}{dt} + \\Delta P_m(t) = \\Delta P_{ref}(t)\n$$\nSubstituting the expression for $\\Delta P_{ref}(t)$:\n$$\nT_g \\frac{d(\\Delta P_m)}{dt} + \\Delta P_m(t) = -\\frac{1}{R f_0} \\Delta f(t)\n$$\nRearranging to isolate the derivative of the second state variable, $\\Delta P_m(t)$, we get the second ODE:\n$$\n\\frac{d(\\Delta P_m)}{dt} = -\\frac{1}{R T_g f_0} \\Delta f(t) - \\frac{1}{T_g} \\Delta P_m(t)\n$$\n\nWe now have a complete system of two coupled, linear, first-order ordinary differential equations. Let the state vector be $x(t) = \\begin{bmatrix} \\Delta f(t) \\\\ \\Delta P_m(t) \\end{bmatrix}$. The system can be written in state-space form $\\dot{x}(t) = Ax(t) + Bu(t)$:\n$$\n\\frac{d}{dt} \\begin{bmatrix} \\Delta f(t) \\\\ \\Delta P_m(t) \\end{bmatrix} = \\begin{bmatrix} -\\frac{D}{2H}  \\frac{f_0}{2H} \\\\ -\\frac{1}{R T_g f_0}  -\\frac{1}{T_g} \\end{bmatrix} \\begin{bmatrix} \\Delta f(t) \\\\ \\Delta P_m(t) \\end{bmatrix} + \\begin{bmatrix} -\\frac{f_0}{2H} \\\\ 0 \\end{bmatrix} \\Delta P_e(t)\n$$\nThe system is at equilibrium before the event, so the initial conditions at $t=0$ are:\n$$\n\\Delta f(0) = 0 \\quad \\text{and} \\quad \\Delta P_m(0) = 0\n$$\nThis system of ODEs will be numerically integrated from $t=0$ to $t=T_{\\text{end}}$ for each set of parameters provided in the test suite. A standard numerical solver, such as a Runge-Kutta method, is suitable. The piecewise constant nature of the input $\\Delta P_e(t)$ is handled directly within the function defining the derivatives.\n\nFrom the resulting time-domain solution for $\\Delta f(t)$, we can calculate the required metrics:\n1.  The frequency nadir is found by computing $\\min_{t \\in [1, T_{\\text{end}}]} (f_0 + \\Delta f(t))$. This involves evaluating the solution over a fine time grid in the post-event interval.\n2.  The frequency at $t=5\\,\\text{s}$ is calculated directly as $f_0 + \\Delta f(5)$.\n\nThis completes the formulation of the problem. The implementation will involve translating this mathematical model into code and executing it for the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Derives and solves the system of ODEs for primary frequency control\n    in a power system and computes specified performance metrics.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (happy path, 50 hertz system, moderate inertia and droop)\n        {'f0': 50.0, 'H': 5.0, 'D': 1.0, 'R': 0.05, 'Tg': 0.5, 'P_step': 0.2, 'T_end': 10.0},\n        # Case B (different nominal frequency, low inertia, strong primary response)\n        {'f0': 60.0, 'H': 2.0, 'D': 0.5, 'R': 0.04, 'Tg': 0.2, 'P_step': 0.1, 'T_end': 8.0},\n        # Case C (high inertia, weak droop, larger disturbance)\n        {'f0': 50.0, 'H': 10.0, 'D': 2.0, 'R': 0.1, 'Tg': 1.0, 'P_step': 0.3, 'T_end': 12.0},\n        # Case D (edge case with negligible disturbance, no explicit load damping)\n        {'f0': 50.0, 'H': 3.0, 'D': 0.0, 'R': 0.05, 'Tg': 0.05, 'P_step': 0.001, 'T_end': 5.5}\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        f0 = case['f0']\n        H = case['H']\n        D = case['D']\n        R = case['R']\n        Tg = case['Tg']\n        P_step = case['P_step']\n        T_end = case['T_end']\n\n        # Define the system of ordinary differential equations (ODEs).\n        # y[0] is delta_f (frequency deviation in Hz)\n        # y[1] is delta_Pm (mechanical power deviation in p.u.)\n        def system_dynamics(t, y):\n            delta_f, delta_Pm = y\n            \n            # Hybrid switch for the electrical disturbance at t=1s\n            delta_Pe = P_step if t >= 1.0 else 0.0\n            \n            # Equation for d(delta_f)/dt from the swing equation\n            # d(df)/dt = -(D/(2H))*df + (f0/(2H))*dPm - (f0/(2H))*dPe\n            d_delta_f_dt = (f0 / (2.0 * H)) * (delta_Pm - delta_Pe) - (D / (2.0 * H)) * delta_f\n            \n            # Equation for d(delta_Pm)/dt from the first-order governor model\n            # d(dPm)/dt = -(1/(R*Tg*f0))*df - (1/Tg)*dPm\n            d_delta_Pm_dt = (-1.0 / (R * Tg * f0)) * delta_f - (1.0 / Tg) * delta_Pm\n            \n            return [d_delta_f_dt, d_delta_Pm_dt]\n\n        # Set initial conditions: system at equilibrium\n        y0 = [0.0, 0.0]\n        \n        # Set the time span for integration\n        t_span = [0.0, T_end]\n        \n        # Numerically solve the ODE system.\n        # dense_output=True allows for evaluation at any point in the interval.\n        sol = solve_ivp(system_dynamics, t_span, y0, method='RK45', dense_output=True, rtol=1e-8, atol=1e-8)\n        \n        # --- Calculate and store the performance metrics ---\n        \n        # 1. Frequency nadir (minimum frequency) post-event\n        # The nadir occurs after the disturbance at t=1.0s.\n        # We evaluate the solution on a fine grid to find the minimum.\n        t_eval_nadir = np.linspace(1.0, T_end, 2000)\n        delta_f_values = sol.sol(t_eval_nadir)[0]\n        nadir = f0 + np.min(delta_f_values)\n        \n        # 2. Absolute frequency at t=5s\n        # All T_end values are >= 5.5s, so t=5s is a valid point.\n        delta_f_at_5s = sol.sol(5.0)[0]\n        f_at_5s = f0 + delta_f_at_5s\n\n        # Append the rounded results to the list\n        all_results.append(round(nadir, 6))\n        all_results.append(round(f_at_5s, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Moving beyond classical feedback, modern smart grids leverage advanced, optimization-based control strategies to manage complexity and respect operational limits. This practice provides an introduction to Model Predictive Control (MPC), a powerful technique for controlling constrained systems. By focusing on a single-step prediction horizon, you will derive the optimal control action from first principles of quadratic optimization, learning how to systematically incorporate system constraints—in this case, actuator limits—into the control design, a crucial skill for developing sophisticated grid management applications.",
            "id": "4211471",
            "problem": "A balancing-authority digital twin within a large-scale smart grid is used to compute fast corrective dispatch for an energy storage resource. The cyber-physical system (CPS) is modeled in discrete time by the linear time-invariant dynamics\n$$\nx_{k+1}=A x_k + B u_k,\n$$\nwhere $x_k\\in \\mathbb{R}^2$ is the deviation state capturing aggregated frequency and tie-line power deviations in per unit (p.u.), and $u_k\\in \\mathbb{R}$ is the control input representing the storage’s net active power injection (p.u.). The Model Predictive Control (MPC) problem for a single-step prediction horizon penalizes the predicted next-state deviation and the actuation effort with the stage cost\n$$\nJ = x_{1}^{\\top} Q x_{1} + u_{0}^{\\top} R u_{0},\n$$\nwhere $x_{1}=A x_{0} + B u_{0}$ is the one-step-ahead state prediction from the current deviation $x_{0}$. The weighting matrices are positive semidefinite/definite as appropriate.\n\nAssume the following scientifically plausible digital-twin model, obtained from linearization of area control error dynamics around an operating point:\n$$\nA=\\begin{pmatrix} 0.97  0.02 \\\\ -0.01  0.99 \\end{pmatrix},\\quad\nB=\\begin{pmatrix} 0.05 \\\\ 0.10 \\end{pmatrix},\\quad\nQ=\\begin{pmatrix} 100  0 \\\\ 0  50 \\end{pmatrix},\\quad\nR=0.8,\n$$\nand the measured current deviation state is\n$$\nx_{0}=\\begin{pmatrix} 0.002 \\\\ -0.015 \\end{pmatrix}.\n$$\nThe actuator is limited by the physical converter and grid-code constraints to satisfy $|u_{0}|\\le u_{\\max}$ with $u_{\\max}=0.06$ in p.u.\n\nStarting from first principles of quadratic optimization for linear systems and without invoking any pre-derived MPC control formulae, derive the unconstrained minimizer of $J$ for the single-step horizon and then enforce the actuation limit by projecting onto the admissible set if needed. Compute the resulting feasible optimal control action $u_{0}^{\\star}$ for the given data. Express your final answer in per unit (p.u.) and round to $4$ significant figures.",
            "solution": "The objective is to find the optimal control action $u_0$ that minimizes the single-step cost function $J$, subject to actuator constraints. The cost function is given by:\n$$J = x_{1}^{\\top} Q x_{1} + u_{0}^{\\top} R u_{0}$$\nThe state at the next time step, $x_1$, is predicted from the current state $x_0$ and the control action $u_0$ using the linear system model:\n$$x_{1} = A x_0 + B u_0$$\n\nFirst, we find the unconstrained optimal control by substituting the state prediction into the cost function, which expresses $J$ as a function of only $u_0$:\n$$J(u_0) = (A x_0 + B u_0)^{\\top} Q (A x_0 + B u_0) + u_0^{\\top} R u_0$$\nSince $u_0$ is a scalar in this problem ($u_0 \\in \\mathbb{R}$), we can write $u_0^{\\top} R u_0 = R u_0^2$. Expanding the quadratic term:\n$$J(u_0) = (x_0^{\\top} A^{\\top} + u_0 B^{\\top}) Q (A x_0 + B u_0) + R u_0^2$$\n$$J(u_0) = x_0^{\\top} A^{\\top} Q A x_0 + x_0^{\\top} A^{\\top} Q B u_0 + u_0 B^{\\top} Q A x_0 + u_0 B^{\\top} Q B u_0 + R u_0^2$$\nThe middle two terms are scalars and are transposes of each other, so they are equal. The expression simplifies to a standard quadratic form in $u_0$:\n$$J(u_0) = (B^{\\top} Q B + R) u_0^2 + 2(B^{\\top} Q A x_0) u_0 + x_0^{\\top} A^{\\top} Q A x_0$$\nTo find the value of $u_0$ that minimizes this quadratic function, we take the derivative with respect to $u_0$ and set it to zero:\n$$\\frac{dJ}{du_0} = 2(B^{\\top} Q B + R) u_0 + 2(B^{\\top} Q A x_0) = 0$$\nSolving for the unconstrained optimal control, $u_{0, \\text{unc}}$:\n$$u_{0, \\text{unc}} = -(B^{\\top} Q B + R)^{-1} (B^{\\top} Q A x_0)$$\n\nNow, we substitute the given numerical values to compute $u_{0, \\text{unc}}$:\n$A=\\begin{pmatrix} 0.97  0.02 \\\\ -0.01  0.99 \\end{pmatrix}, B=\\begin{pmatrix} 0.05 \\\\ 0.10 \\end{pmatrix}, Q=\\begin{pmatrix} 100  0 \\\\ 0  50 \\end{pmatrix}, R=0.8, x_{0}=\\begin{pmatrix} 0.002 \\\\ -0.015 \\end{pmatrix}$\n\n1.  Calculate the predicted state without control, $A x_0$:\n    $$A x_0 = \\begin{pmatrix} 0.97(0.002) + 0.02(-0.015) \\\\ -0.01(0.002) + 0.99(-0.015) \\end{pmatrix} = \\begin{pmatrix} 0.00194 - 0.0003 \\\\ -0.00002 - 0.01485 \\end{pmatrix} = \\begin{pmatrix} 0.00164 \\\\ -0.01487 \\end{pmatrix}$$\n\n2.  Calculate the terms in the expression for $u_{0, \\text{unc}}$:\n    -   $B^{\\top} Q = \\begin{pmatrix} 0.05  0.10 \\end{pmatrix} \\begin{pmatrix} 100  0 \\\\ 0  50 \\end{pmatrix} = \\begin{pmatrix} 5  5 \\end{pmatrix}$\n    -   Numerator term: $B^{\\top} Q A x_0 = \\begin{pmatrix} 5  5 \\end{pmatrix} \\begin{pmatrix} 0.00164 \\\\ -0.01487 \\end{pmatrix} = 5(0.00164) + 5(-0.01487) = 0.0082 - 0.07435 = -0.06615$\n    -   Denominator term: $B^{\\top} Q B + R = \\begin{pmatrix} 5  5 \\end{pmatrix} \\begin{pmatrix} 0.05 \\\\ 0.10 \\end{pmatrix} + 0.8 = (5(0.05) + 5(0.10)) + 0.8 = (0.25 + 0.50) + 0.8 = 0.75 + 0.8 = 1.55$\n\n3.  Compute $u_{0, \\text{unc}}$:\n    $$u_{0, \\text{unc}} = - (1.55)^{-1} (-0.06615) = \\frac{0.06615}{1.55} \\approx 0.0426774$$\n\nFinally, we must enforce the actuator constraint $|u_0| \\le u_{\\max}$, where $u_{\\max} = 0.06$. The optimal constrained control action $u_0^{\\star}$ is found by projecting the unconstrained solution onto the feasible set $[-0.06, 0.06]$. This is done by saturating the value if it lies outside the bounds:\n$$u_0^{\\star} = \\max(-u_{\\max}, \\min(u_{\\max}, u_{0, \\text{unc}}))$$\nSince our calculated unconstrained value is $u_{0, \\text{unc}} \\approx 0.0426774$, which satisfies $-0.06 \\le 0.0426774 \\le 0.06$, the unconstrained solution is feasible. Therefore, the optimal control action is:\n$$u_0^{\\star} = 0.0426774 \\text{ p.u.}$$\nRounding to 4 significant figures as requested gives $0.04268$.",
            "answer": "$$\n\\boxed{0.04268}\n$$"
        }
    ]
}