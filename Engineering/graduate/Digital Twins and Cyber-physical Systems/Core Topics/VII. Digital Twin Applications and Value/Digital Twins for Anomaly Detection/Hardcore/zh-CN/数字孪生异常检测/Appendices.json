{
    "hands_on_practices": [
        {
            "introduction": "数字孪生异常检测的基础是标称系统的精确数学模型。通过比较孪生模型的预测与物理系统的实际测量值，我们可以生成一个“残差”信号，它能放大异常引起的不一致性。本练习将引导您完成一个核心过程：将一个真实的非线性直流电机模型进行线性化，以创建一个对微小异常高度敏感的线性残差生成器。这个实践阐明了如何将物理原理转化为可用于诊断的数学工具 。",
            "id": "4215454",
            "problem": "一个由直流 (DC) 电机组成的信息物理系统 (CPS) 由一个基于模型的数字孪生进行监控。物理电机的动力学包括粘性摩擦、弱三次摩擦、反电动势和负载转矩。标称连续时间非线性状态空间模型使用状态向量 $x = [\\omega\\ i]^{\\top}$、控制输入 $u$ 和输出 $y$，其中\n$$\n\\dot{\\omega} = \\frac{1}{J}\\left(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load}}\\right), \\quad\n\\dot{i} = \\frac{1}{L}\\left(u - R i - K_{e} \\omega\\right), \\quad\ny = \\omega,\n$$\n其中 $\\omega$ 是角速度，$i$ 是电枢电流。数字孪生使用相同的标称模型和相同的指令输入 $u$ 来产生预测输出 $\\hat{y}$。异常被建模为仅作用于物理设备负载转矩上的一个小的加性扰动 $d(t)$，因此设备负载转矩变为 $\\tau_{\\text{load}} + d(t)$，而数字孪生使用标称的 $\\tau_{\\text{load}}$。\n\n参数为 $J = 0.01$, $B = 0.005$, $B_{\\text{nl}} = 1 \\times 10^{-7}$, $L = 0.05$, $R = 1$, $K_{t} = 0.5$ 和 $K_{e} = 0.5$。标称工作点由稳态值 $\\omega_{0} = 100$, $i_{0} = 1.6$, $u_{0} = 51.6$ 和 $\\tau_{\\text{load},0} = 0.2$ 表征，这些值满足标称模型的平衡条件。残差 $r(t)$ 定义为测量输出与预测输出之差 $r(t) = y(t) - \\hat{y}(t)$。\n\n从平衡和围绕工作点 $(\\omega_{0}, i_{0}, u_{0})$ 的一阶泰勒展开（雅可比线性化）的定义出发，执行以下操作：\n\n1. 推导设备和数字孪生在工作点 $(\\omega_{0}, i_{0}, u_{0})$ 附近的线性化小信号模型，并辨识标称模型的矩阵 $A$、$B$ 和 $C$，以及从异常输入 $d(t)$ 到状态动力学的扰动通道 $E$。\n2. 使用线性化模型，推导小异常的残差生成器动力学，即当设备和数字孪生在工作点共享相同的初始条件和相同的指令输入 $u(t)$ 时，由 $d(t)$ 驱动的残差 $r(t)$ 的线性化动力学。\n3. 对于一个恒定阶跃异常 $d(t) = d_{0}$，其中 $d_{0} = 0.02$（转矩单位），计算由线性化动力学隐含的稳态残差值 $r_{\\text{ss}}$。以弧度/秒为单位表示最终数值答案，并将答案四舍五入到四位有效数字。",
            "solution": "首先验证问题，以确保其具有科学依据、适定且客观。所提供的模型是直流电机的标准表示，参数在物理上是合理的。该任务涉及控制理论中的标准技术：线性化和残差分析。我们首先通过将时间导数设为零来验证给定的工作点 $(\\omega_{0}, i_{0}, u_{0}, \\tau_{\\text{load},0}) = (100, 1.6, 51.6, 0.2)$ 是标称模型的一个平衡点：\n对于 $\\dot{\\omega} = 0$：\n$$K_{t} i_{0} - B \\omega_{0} - B_{\\text{nl}} \\omega_{0}^{3} - \\tau_{\\text{load},0} = (0.5)(1.6) - (0.005)(100) - (1 \\times 10^{-7})(100)^{3} - 0.2$$\n$$= 0.8 - 0.5 - (10^{-7})(10^{6}) - 0.2 = 0.8 - 0.5 - 0.1 - 0.2 = 0$$\n对于 $\\dot{i} = 0$：\n$$u_{0} - R i_{0} - K_{e} \\omega_{0} = 51.6 - (1)(1.6) - (0.5)(100) = 51.6 - 1.6 - 50 = 0$$\n平衡条件得到满足。问题是有效的，我们可以继续求解。\n\n非线性状态空间模型可以写成 $\\dot{x} = f(x, u)$ 的形式，其中 $x = [\\omega\\ i]^{\\top}$。\n$f(x, u) = \\begin{pmatrix} f_1 \\\\ f_2 \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{J}\\left(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load}}\\right) \\\\ \\frac{1}{L}\\left(u - R i - K_{e} \\omega\\right) \\end{pmatrix}$。\n输出为 $y = h(x) = \\omega$。\n\n**1. 线性化模型的推导**\n\n系统在工作点 $(x_0, u_0)$ 附近进行线性化，其中 $x_0 = [\\omega_0 \\ i_0]^{\\top} = [100 \\ 1.6]^{\\top}$ 且 $u_0 = 51.6$。线性化模型由 $\\delta\\dot{x} = A \\delta x + B \\delta u$ 给出，其中 $\\delta x = x - x_0$ 且 $\\delta u = u - u_0$。矩阵 $A$ 和 $B$ 是 $f$ 关于 $x$ 和 $u$ 的雅可比矩阵，在工作点处求值。\n\n雅可比矩阵 $A$ 为：\n$$A = \\frac{\\partial f}{\\partial x}\\bigg|_{x_0, u_0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial \\omega} & \\frac{\\partial f_1}{\\partial i} \\\\ \\frac{\\partial f_2}{\\partial \\omega} & \\frac{\\partial f_2}{\\partial i} \\end{pmatrix}_{x_0, u_0}$$\n偏导数是：\n$\\frac{\\partial f_1}{\\partial \\omega} = \\frac{1}{J}(-B - 3B_{\\text{nl}}\\omega^2)$。在 $\\omega_0=100$ 处求值：\n$\\frac{\\partial f_1}{\\partial \\omega}\\bigg|_{\\omega_0} = \\frac{1}{0.01}(-0.005 - 3(1 \\times 10^{-7})(100)^2) = 100(-0.005 - 0.003) = -0.8$。\n$\\frac{\\partial f_1}{\\partial i} = \\frac{K_t}{J} = \\frac{0.5}{0.01} = 50$。\n$\\frac{\\partial f_2}{\\partial \\omega} = -\\frac{K_e}{L} = -\\frac{0.5}{0.05} = -10$。\n$\\frac{\\partial f_2}{\\partial i} = -\\frac{R}{L} = -\\frac{1}{0.05} = -20$。\n因此，状态矩阵 $A$ 为：\n$$A = \\begin{pmatrix} -0.8 & 50 \\\\ -10 & -20 \\end{pmatrix}$$\n\n输入矩阵 $B$ 为：\n$$B = \\frac{\\partial f}{\\partial u}\\bigg|_{x_0, u_0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial u} \\\\ \\frac{\\partial f_2}{\\partial u} \\end{pmatrix}_{x_0, u_0} = \\begin{pmatrix} 0 \\\\ \\frac{1}{L} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{1}{0.05} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 20 \\end{pmatrix}$$\n\n输出方程为 $y = \\omega$，它已经是状态变量的线性函数。输出矩阵 $C$ 为：\n$$C = \\frac{\\partial h}{\\partial x}\\bigg|_{x_0} = \\begin{pmatrix} \\frac{\\partial \\omega}{\\partial \\omega} & \\frac{\\partial \\omega}{\\partial i} \\end{pmatrix} = \\begin{pmatrix} 1 & 0 \\end{pmatrix}$$\n\n异常 $d(t)$ 作为加性负载转矩进入物理设备动力学。设备的 $\\dot{\\omega}$ 方程为 $\\dot{\\omega}_{\\text{plant}} = \\frac{1}{J}(K_{t} i - B \\omega - B_{\\text{nl}} \\omega^{3} - \\tau_{\\text{load},0} - d(t))$。扰动通道矩阵 $E$ 将扰动 $d(t)$ 映射到状态动力学。\n$$E = \\frac{\\partial f}{\\partial d}\\bigg|_{d=0} = \\begin{pmatrix} \\frac{\\partial f_1}{\\partial d} \\\\ \\frac{\\partial f_2}{\\partial d} \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{J} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{0.01} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -100 \\\\ 0 \\end{pmatrix}$$\n\n**2. 残差生成器动力学的推导**\n\n设 $\\delta x_p(t)$ 为物理设备的小信号状态偏差，$\\delta \\hat{x}(t)$ 为数字孪生的小信号状态偏差。线性化模型为：\n设备： $\\delta \\dot{x}_p(t) = A \\delta x_p(t) + B \\delta u(t) + E d(t)$\n孪生： $\\delta \\dot{\\hat{x}}(t) = A \\delta \\hat{x}(t) + B \\delta u(t)$\n小信号输出为 $\\delta y(t) = C \\delta x_p(t)$ 和 $\\delta \\hat{y}(t) = C \\delta \\hat{x}(t)$。\n\n残差为 $r(t) = y(t) - \\hat{y}(t) = (y_0 + \\delta y(t)) - (\\hat{y}_0 + \\delta\\hat{y}(t))$。由于工作点相同 ($y_0 = \\hat{y}_0$)，所以 $r(t) = \\delta y(t) - \\delta \\hat{y}(t) = C(\\delta x_p(t) - \\delta \\hat{x}(t))$。\n设状态误差为 $e(t) = \\delta x_p(t) - \\delta \\hat{x}(t)$。状态误差的动力学通过将孪生的状态方程从设备的状态方程中减去得到：\n$$\\dot{e}(t) = \\delta \\dot{x}_p(t) - \\delta \\dot{\\hat{x}}(t) = (A \\delta x_p + B \\delta u + E d) - (A \\delta \\hat{x} + B \\delta u)$$\n$$\\dot{e}(t) = A(\\delta x_p - \\delta \\hat{x}) + (B - B)\\delta u + E d = A e(t) + E d(t)$$\n那么残差由 $r(t) = C e(t)$ 给出。\n问题陈述初始条件相同，因此 $e(0) = \\delta x_p(0) - \\delta \\hat{x}(0) = 0$。\n因此，残差生成器是如下的线性时不变系统：\n$$ \\dot{e}(t) = A e(t) + E d(t), \\quad e(0)=0 $$\n$$ r(t) = C e(t) $$\n\n**3. 稳态残差的计算**\n\n对于一个恒定阶跃异常 $d(t) = d_0 = 0.02$，通过将状态误差的时间导数设为零 $\\dot{e}(t) = 0$ 来找到稳态响应，前提是假设系统矩阵 $A$ 是稳定的。$A$ 的特征值具有负实部（特征方程为 $\\lambda^2+20.8\\lambda+516=0$），因此系统是稳定的。\n在稳态下，我们有 $0 = A e_{\\text{ss}} + E d_0$。\n求解稳态误差 $e_{\\text{ss}}$：\n$$e_{\\text{ss}} = -A^{-1}E d_0$$\n那么稳态残差 $r_{\\text{ss}}$ 为：\n$$r_{\\text{ss}} = C e_{\\text{ss}} = -C A^{-1} E d_0$$\n这一项 $-C A^{-1} E$ 是系统从输入 $d$ 到输出 $r$ 的直流增益。\n首先，我们计算 $A$ 的逆矩阵：\n$$\\det(A) = (-0.8)(-20) - (50)(-10) = 16 + 500 = 516$$\n$$A^{-1} = \\frac{1}{\\det(A)}\\begin{pmatrix} -20 & -50 \\\\ 10 & -0.8 \\end{pmatrix} = \\frac{1}{516}\\begin{pmatrix} -20 & -50 \\\\ 10 & -0.8 \\end{pmatrix}$$\n现在我们计算乘积 $C A^{-1} E$：\n$$C A^{-1} E = \\begin{pmatrix} 1 & 0 \\end{pmatrix} \\left(\\frac{1}{516}\\begin{pmatrix} -20 & -50 \\\\ 10 & -0.8 \\end{pmatrix}\\right) \\begin{pmatrix} -100 \\\\ 0 \\end{pmatrix}$$\n$$= \\frac{1}{516} \\begin{pmatrix} 1 & 0 \\end{pmatrix} \\begin{pmatrix} (-20)(-100) + (-50)(0) \\\\ (10)(-100) + (-0.8)(0) \\end{pmatrix} = \\frac{1}{516} \\begin{pmatrix} 1 & 0 \\end{pmatrix} \\begin{pmatrix} 2000 \\\\ -1000 \\end{pmatrix} = \\frac{2000}{516}$$\n稳态残差为：\n$$r_{\\text{ss}} = - \\frac{2000}{516} d_0$$\n代入 $d_0 = 0.02$：\n$$r_{\\text{ss}} = - \\frac{2000}{516} \\times 0.02 = - \\frac{40}{516} \\approx -0.0775193798...$$\n四舍五入到四位有效数字，我们得到：\n$$r_{\\text{ss}} = -0.07752$$\n单位是弧度/秒，与 $\\omega$ 的单位相同。",
            "answer": "$$\\boxed{-0.07752}$$"
        },
        {
            "introduction": "生成残差信号后，下一个挑战是如何将其中的真实异常与随机噪声区分开。这需要深刻理解不确定性是如何在系统动态中传播的。本练习深入探讨了状态估计理论的核心，指导您从第一性原理出发，推导出状态和新息协方差传播的基本方程 。这为您创建能够适应系统动态变化的自适应检测阈值奠定了理论基础。",
            "id": "4215465",
            "problem": "一个信息物理系统 (CPS) 的数字孪生 (DT) 跟踪一个时间索引为 $k \\in \\mathbb{N}$ 的线性化离散时间状态。真实状态根据 $x_{k+1} = A x_{k} + w_{k}$ 演化，其中 $x_{k} \\in \\mathbb{R}^{n}$，$A \\in \\mathbb{R}^{n \\times n}$ 是常数，过程噪声 $w_{k}$ 是一个零均值高斯随机向量，其协方差为 $Q \\in \\mathbb{R}^{n \\times n}$。数字孪生维护一个无偏预测器 $\\hat{x}_{k \\mid k-1}$，其相关的状态预测误差为 $e_{k \\mid k-1} = x_{k} - \\hat{x}_{k \\mid k-1}$，协方差为 $P_{k} = \\mathbb{E}[e_{k \\mid k-1} e_{k \\mid k-1}^{\\top}]$。假设 $x_{0}$ 是零均值的，其协方差为 $P_{0}$，并且下面引入的序列 $\\{w_{k}\\}$ 和 $\\{v_{k}\\}$ 相互独立且独立于 $x_{0}$。\n\n一个传感器提供测量值 $y_{k} = H x_{k} + v_{k}$，其中 $H \\in \\mathbb{R}^{m \\times n}$，测量噪声 $v_{k}$ 是零均值高斯随机向量，其协方差为 $R \\in \\mathbb{R}^{m \\times m}$。用于异常检测的新息（或残差）为 $r_{k} = y_{k} - H \\hat{x}_{k \\mid k-1}$。数字孪生通过 Mahalanobis 距离检验采用新息门控，以决定是否标记异常。\n\n仅从协方差、独立性的定义以及高斯随机变量线性变换的性质出发，执行以下操作：\n1) 在给定的线性动力学和噪声假设下，推导将 $P_{k}$ 映射到 $P_{k+1}$ 的状态预测协方差递归式。\n2) 展开此递归式，以获得用 $A$, $P_{0}$, $Q$ 和 $k$ 表示的 $P_{k}$ 的闭式表达式，该表达式对任意 $k \\in \\mathbb{N}$ 有效。\n3) 推导用 $H$, $P_{k}$ 和 $R$ 表示的新息协方差 $S_{k} = \\mathbb{E}[r_{k} r_{k}^{\\top}]$。\n4) 从 $r_{k}$ 的高斯性出发，证明平方 Mahalanobis 距离 $d_{k}^{2} = r_{k}^{\\top} S_{k}^{-1} r_{k}$ 服从自由度为 $m$ 的卡方分布，并表示一个实现固定虚警概率 $\\alpha \\in (0,1)$ 的动态门控阈值 $\\gamma_{k}$，将其作为 $m$ 和 $\\alpha$ 的符号函数。解释在 $P_{k}$ 和 $S_{k}$ 中时变不确定性的背景下，为什么这个阈值被称为“动态”的。\n\n将您的最终答案表示为在第2项中推导出的 $P_{k}$ 的闭式表达式。不要提供任何数值计算。无需四舍五入。单位不适用。",
            "solution": "问题陈述经过验证，具有科学依据、适定且客观。它描述了线性系统中状态估计和异常检测的标准场景。解答过程通过基于所提供的模型和定义推导所要求的量来进行。\n\n我们按顺序处理这四个任务。\n\n**1) 状态预测协方差递归式的推导**\n\n时刻 $k+1$ 的状态预测误差定义为 $e_{k+1 \\mid k} = x_{k+1} - \\hat{x}_{k+1 \\mid k}$。问题描述了一个维护预测器的数字孪生，但没有指定测量更新步骤（例如，Kalman 滤波器校正步骤）。用于异常检测的新息门控的上下文意味着，我们将传入的测量值与纯粹基于模型的预测进行比较。因此，最合乎逻辑且一致的解释是，状态预测是基于先前的预测向前传播的，没有包含测量更新。这意味着时刻 $k+1$ 的预测器是从时刻 $k$ 的预测器 $\\hat{x}_{k \\mid k-1}$ 通过系统动力学传播得出的：\n$$\n\\hat{x}_{k+1 \\mid k} = A \\hat{x}_{k \\mid k-1}\n$$\n状态本身根据 $x_{k+1} = A x_{k} + w_{k}$ 演化。将这些代入 $e_{k+1 \\mid k}$ 的定义中：\n$$\ne_{k+1 \\mid k} = (A x_{k} + w_{k}) - (A \\hat{x}_{k \\mid k-1}) = A (x_{k} - \\hat{x}_{k \\mid k-1}) + w_{k}\n$$\n根据时刻 $k$ 的预测误差的定义 $e_{k \\mid k-1} = x_{k} - \\hat{x}_{k \\mid k-1}$，我们有：\n$$\ne_{k+1 \\mid k} = A e_{k \\mid k-1} + w_{k}\n$$\n时刻 $k+1$ 的状态预测误差协方差，在问题陈述中记为 $P_{k+1}$（其中 $P_{k+1} = P_{k+1 \\mid k}$），由期望 $P_{k+1} = \\mathbb{E}[e_{k+1 \\mid k} e_{k+1 \\mid k}^{\\top}]$ 给出。代入 $e_{k+1 \\mid k}$ 的表达式：\n$$\nP_{k+1} = \\mathbb{E}[(A e_{k \\mid k-1} + w_{k})(A e_{k \\mid k-1} + w_{k})^{\\top}]\n$$\n展开乘积：\n$$\nP_{k+1} = \\mathbb{E}[A e_{k \\mid k-1} e_{k \\mid k-1}^{\\top} A^{\\top} + A e_{k \\mid k-1} w_{k}^{\\top} + w_{k} e_{k \\mid k-1}^{\\top} A^{\\top} + w_{k} w_{k}^{\\top}]\n$$\n根据期望的线性性质：\n$$\nP_{k+1} = A \\mathbb{E}[e_{k \\mid k-1} e_{k \\mid k-1}^{\\top}] A^{\\top} + A \\mathbb{E}[e_{k \\mid k-1} w_{k}^{\\top}] + \\mathbb{E}[w_{k} e_{k \\mid k-1}^{\\top}] A^{\\top} + \\mathbb{E}[w_{k} w_{k}^{\\top}]\n$$\n根据问题定义，我们有 $\\mathbb{E}[e_{k \\mid k-1} e_{k \\mid k-1}^{\\top}] = P_{k}$ 和 $\\mathbb{E}[w_{k} w_{k}^{\\top}] = Q$。状态预测误差 $e_{k \\mid k-1}$ 是初始状态 $x_0$ 和直到时刻 $k-1$ 的过程噪声序列（即 $\\{w_0, w_1, \\dots, w_{k-1}\\}$）的函数。过程噪声 $w_k$ 独立于此历史。因此，$e_{k \\mid k-1}$ 和 $w_k$ 是统计上独立的。由于 $w_k$ 是零均值的（$\\mathbb{E}[w_k] = 0$），它们是不相关的：\n$$\n\\mathbb{E}[e_{k \\mid k-1} w_{k}^{\\top}] = \\mathbb{E}[e_{k \\mid k-1}] \\mathbb{E}[w_{k}^{\\top}] = 0\n$$\n交叉项消失。状态预测协方差的递归式为：\n$$\nP_{k+1} = A P_{k} A^{\\top} + Q\n$$\n\n**2) $P_{k}$ 的闭式表达式**\n\n我们从初始协方差 $P_0$ 开始展开递归式 $P_{k+1} = A P_{k} A^{\\top} + Q$。问题假设 $\\hat{x}_{0 \\mid -1} = \\mathbb{E}[x_0] = 0$，因此 $e_{0 \\mid -1} = x_0$ 且 $P_0 = \\mathbb{E}[x_0 x_0^\\top]$。\n当 $k=1$ 时：\n$$\nP_{1} = A P_{0} A^{\\top} + Q\n$$\n当 $k=2$ 时：\n$$\nP_{2} = A P_{1} A^{\\top} + Q = A (A P_{0} A^{\\top} + Q) A^{\\top} + Q = A^{2} P_{0} (A^{\\top})^{2} + A Q A^{\\top} + Q\n$$\n当 $k=3$ 时：\n$$\nP_{3} = A P_{2} A^{\\top} + Q = A (A^{2} P_{0} (A^{\\top})^{2} + A Q A^{\\top} + Q) A^{\\top} + Q = A^{3} P_{0} (A^{\\top})^{3} + A^{2} Q (A^{\\top})^{2} + A Q A^{\\top} + Q\n$$\n通过观察，一个通用模式浮现出来。对于任意 $k \\in \\mathbb{N}$（假设 $\\mathbb{N}=\\{0, 1, 2, ...\\}$），$P_k$ 的闭式表达式为：\n$$\nP_{k} = A^{k} P_{0} (A^{\\top})^{k} + \\sum_{i=0}^{k-1} A^{i} Q (A^{\\top})^{i}\n$$\n这是 $P_k$ 的离散时间 Lyapunov 方程的解。当 $k=0$ 时，和式为空，其值为零，得到 $P_0 = A^0 P_0 (A^\\top)^0 = P_0$，这是一致的。\n\n**3) 新息协方差 $S_{k}$ 的推导**\n\n新息定义为 $r_{k} = y_{k} - H \\hat{x}_{k \\mid k-1}$。给定测量模型 $y_{k} = H x_{k} + v_{k}$。将此代入新息方程：\n$$\nr_{k} = (H x_{k} + v_{k}) - H \\hat{x}_{k \\mid k-1} = H (x_{k} - \\hat{x}_{k \\mid k-1}) + v_{k}\n$$\n这可以简化为 $r_{k} = H e_{k \\mid k-1} + v_{k}$。\n新息协方差是 $S_{k} = \\mathbb{E}[r_{k} r_{k}^{\\top}]$。代入 $r_k$ 的表达式：\n$$\nS_{k} = \\mathbb{E}[(H e_{k \\mid k-1} + v_{k})(H e_{k \\mid k-1} + v_{k})^{\\top}]\n$$\n展开乘积：\n$$\nS_{k} = \\mathbb{E}[H e_{k \\mid k-1} e_{k \\mid k-1}^{\\top} H^{\\top} + H e_{k \\mid k-1} v_{k}^{\\top} + v_{k} e_{k \\mid k-1}^{\\top} H^{\\top} + v_{k} v_{k}^{\\top}]\n$$\n根据期望的线性性质：\n$$\nS_{k} = H \\mathbb{E}[e_{k \\mid k-1} e_{k \\mid k-1}^{\\top}] H^{\\top} + H \\mathbb{E}[e_{k \\mid k-1} v_{k}^{\\top}] + \\mathbb{E}[v_{k} e_{k \\mid k-1}^{\\top}] H^{\\top} + \\mathbb{E}[v_{k} v_{k}^{\\top}]\n$$\n我们有 $\\mathbb{E}[e_{k \\mid k-1} e_{k \\mid k-1}^{\\top}] = P_{k}$ 和 $\\mathbb{E}[v_{k} v_{k}^{\\top}] = R$。状态预测误差 $e_{k \\mid k-1}$ 取决于 $x_0$ 和 $\\{w_0, \\dots, w_{k-1}\\}$。根据定义，测量噪声 $v_k$ 独立于初始状态 $x_0$ 和整个过程噪声序列 $\\{w_j\\}$。因此，$e_{k \\mid k-1}$ 和 $v_k$ 是统计上独立的。由于 $v_k$ 是零均值的，它们是不相关的。交叉项为零：\n$$\n\\mathbb{E}[e_{k \\mid k-1} v_{k}^{\\top}] = 0\n$$\n因此，新息协方差为：\n$$\nS_{k} = H P_{k} H^{\\top} + R\n$$\n\n**4) Mahalanobis 距离分布和门控阈值**\n\n首先，我们确定新息 $r_k$ 的分布。初始状态 $x_0$、过程噪声 $w_k$ 和测量噪声 $v_k$ 都被指定为高斯随机向量。高斯向量的线性变换结果也是高斯向量。状态 $x_k$ 和预测误差 $e_{k \\mid k-1}$ 是通过对这些初始高斯变量进行一系列线性运算生成的，因此它们也是高斯变量。新息 $r_{k} = H e_{k \\mid k-1} + v_{k}$ 是高斯向量 $e_{k \\mid k-1}$ 和 $v_k$ 的线性组合，所以 $r_k$ 也是一个高斯随机向量。它的均值是 $\\mathbb{E}[r_k] = H \\mathbb{E}[e_{k \\mid k-1}] + \\mathbb{E}[v_k]$。由于预测器是无偏的（$\\mathbb{E}[\\hat{x}_{k \\mid k-1}] = \\mathbb{E}[x_k]$），预测误差是零均值的（$\\mathbb{E}[e_{k \\mid k-1}]=0$）。又因为 $\\mathbb{E}[v_k]=0$，我们得出结论 $\\mathbb{E}[r_k]=0$。因此，$r_k \\sim \\mathcal{N}(0, S_k)$。\n\n为了分析平方 Mahalanobis 距离 $d_{k}^{2} = r_{k}^{\\top} S_{k}^{-1} r_{k}$，我们对新息向量进行归一化。令 $S_k^{1/2}$ 为 $S_k$ 的一个矩阵平方根（例如，通过 Cholesky 分解得到），使得 $S_k = S_k^{1/2} (S_k^{1/2})^{\\top}$。我们定义一个归一化向量 $z_k = (S_k^{1/2})^{-1} r_k$。向量 $z_k$ 是高斯向量 $r_k$ 的线性变换，所以它也是高斯向量，其均值为 $\\mathbb{E}[z_k] = (S_k^{1/2})^{-1} \\mathbb{E}[r_k] = 0$。其协方差为：\n$$\n\\mathbb{E}[z_k z_k^{\\top}] = \\mathbb{E}[(S_k^{1/2})^{-1} r_k r_k^{\\top} ((S_k^{1/2})^{-1})^{\\top}] = (S_k^{1/2})^{-1} \\mathbb{E}[r_k r_k^{\\top}] ((S_k^{1/2})^{-1})^{\\top} = (S_k^{1/2})^{-1} S_k ((S_k^{1/2})^{\\top})^{-1} = I_m\n$$\n其中 $I_m$ 是 $m \\times m$ 的单位矩阵。因此，$z_k$ 是一个标准多元正态随机向量，$z_k \\sim \\mathcal{N}(0, I_m)$，其 $m$ 个分量是独立的标准正态变量。\nMahalanobis 距离可以重写为：\n$$\nd_k^2 = r_{k}^{\\top} S_{k}^{-1} r_{k} = r_{k}^{\\top} (((S_{k}^{1/2})^{\\top})^{-1} (S_{k}^{1/2})^{-1}) r_{k} = ((S_{k}^{1/2})^{-1}r_k)^{\\top} ((S_{k}^{1/2})^{-1}r_k) = z_k^{\\top} z_k\n$$\n这是 $z_k$ 的 $m$ 个分量的平方和：$d_k^2 = \\sum_{i=1}^{m} z_{k,i}^2$。根据定义，$m$ 个独立标准正态随机变量的平方和服从自由度为 $m$ 的卡方分布。因此，$d_k^2 \\sim \\chi^2(m)$。\n\n如果 $d_k^2 > \\gamma_k$，则标记一个异常。如果即使系统正常运行时（即，在推导出的原假设 $d_k^2 \\sim \\chi^2(m)$ 下）也满足此条件，则会发生虚警。虚警概率 $\\alpha$ 由下式给出：\n$$\n\\alpha = P(d_k^2 > \\gamma_k)\n$$\n令 $F_{\\chi^2(m)}$ 为自由度为 $m$ 的卡方分布的累积分布函数 (CDF)。那么 $P(d_k^2 \\le \\gamma_k) = F_{\\chi^2(m)}(\\gamma_k)$，因此 $\\alpha = 1 - F_{\\chi^2(m)}(\\gamma_k)$。阈值 $\\gamma_k$ 可以通过对 CDF 求逆得到：\n$$\n\\gamma_{k} = (F_{\\chi^2(m)})^{-1}(1 - \\alpha)\n$$\n这个阈值仅取决于测量维度 $m$ 和期望的虚警概率 $\\alpha$，这两者都是常数。因此，$\\gamma_k$ 的数值对所有 $k$ 都是恒定的。门控过程之所以被称为“动态”的，是因为检验本身 $r_{k}^{\\top} S_{k}^{-1} r_{k} > \\gamma_k$ 涉及到时变的新息协方差矩阵 $S_k$。新息的接受域由椭球 $\\{ r \\in \\mathbb{R}^m \\mid r^{\\top} S_{k}^{-1} r \\le \\gamma_k \\}$ 定义，随着状态预测协方差 $P_k$ 的演化，该区域的大小和方向在每个时间步 $k$ 都会改变。该阈值被应用于这个动态归一化的统计量。",
            "answer": "$$\\boxed{A^{k} P_{0} (A^{\\top})^{k} + \\sum_{i=0}^{k-1} A^{i} Q (A^{\\top})^{i}}$$"
        },
        {
            "introduction": "在理解了残差生成和不确定性传播之后，您现在可以设计一个正式的统计检测器了。本练习提供了一个具体的计算场景，您将据此计算残差协方差，并设计一个基于马氏距离（Mahalanobis distance）的卡方检验。通过创建一个具有特定、可量化性能（即误报率 $ \\alpha $）的检测器，这项实践将理论知识固化为可应用的工程技能 。",
            "id": "4215503",
            "problem": "一个用于信息物理系统 (CPS) 异常检测的数字孪生，在离散时间 $k$ 将设备状态预测为 $\\hat{x}_{k} \\in \\mathbb{R}^{3}$，其预测误差为 $e_{k} = x_{k} - \\hat{x}_{k}$。预测误差被建模为零均值高斯分布，其协方差为 $P_{k} \\in \\mathbb{R}^{3 \\times 3}$。两个物理传感器通过线性观测模型 $y_{k} = C x_{k} + v_{k}$ 测量状态的一个子集，其中 $C \\in \\mathbb{R}^{2 \\times 3}$ 且 $v_{k}$ 是零均值高斯分布，协方差为 $R \\in \\mathbb{R}^{2 \\times 2}$，并与 $e_{k}$ 独立。残差定义为 $r_{k} = y_{k} - C \\hat{x}_{k}$。假设系统正常运行（无异常），因此上述概率模型完全成立。\n\n给定以下数值指定的矩阵：\n$$\nP_{k} =\n\\begin{pmatrix}\n0.036 & 0.012 & -0.004 \\\\\n0.012 & 0.081 & \\;\\;0.003 \\\\\n-0.004 & 0.003 & \\;\\;0.25\n\\end{pmatrix},\n\\quad\nC =\n\\begin{pmatrix}\n1 & 0 & 0 \\\\\n0 & 1 & 0\n\\end{pmatrix},\n\\quad\nR =\n\\begin{pmatrix}\n0.014 & 0 \\\\\n0 & 0.019\n\\end{pmatrix}.\n$$\n\n任务：\n1) 根据线性高斯模型和独立性的基本原理，计算在正常运行情况下 $r_{k}$ 的 $2 \\times 2$ 残差协方差矩阵。提供确切的数值矩阵。\n\n2) 设计一个卡方异常检测器，当二次型 $q_{k} = r_{k}^{\\top} S_{k}^{-1} r_{k}$ 超过为达到固定显著性水平 $\\alpha \\in (0,1)$ 而选择的阈值 $\\gamma(\\alpha)$ 时，在时间 $k$ 标记异常。推导 $\\gamma(\\alpha)$ 关于 $\\alpha$ 的闭式解析表达式。\n\n答案规格：\n- 你最终的方框答案必须是卡方阈值 $\\gamma(\\alpha)$ 的单一闭式解析表达式，且仅用 $\\alpha$ 表示。方框答案中不要包含任何单位。\n- 无需四舍五入。",
            "solution": "问题经过验证，具有科学依据、适定且客观。我们将分两步解决这个问题。\n\n**1) 计算残差协方差矩阵 $S_k$**\n\n残差定义为 $r_k = y_k - C \\hat{x}_k$。将测量模型 $y_k = C x_k + v_k$ 代入，我们得到：\n$$r_k = (C x_k + v_k) - C \\hat{x}_k = C(x_k - \\hat{x}_k) + v_k = C e_k + v_k$$\n其中 $e_k$ 是预测误差，$v_k$ 是测量噪声。\n\n残差协方差矩阵 $S_k$ 定义为 $S_k = \\mathbb{E}[r_k r_k^\\top]$。代入 $r_k$ 的表达式：\n$$S_k = \\mathbb{E}[(C e_k + v_k)(C e_k + v_k)^\\top]$$\n展开乘积：\n$$S_k = \\mathbb{E}[C e_k e_k^\\top C^\\top + C e_k v_k^\\top + v_k e_k^\\top C^\\top + v_k v_k^\\top]$$\n根据期望的线性性质，并利用问题中给出的 $e_k$ 和 $v_k$ 相互独立的事实（这意味着它们的协方差为零，即 $\\mathbb{E}[e_k v_k^\\top] = \\mathbb{E}[e_k]\\mathbb{E}[v_k^\\top] = 0$）：\n$$S_k = C \\mathbb{E}[e_k e_k^\\top] C^\\top + \\mathbb{E}[v_k v_k^\\top] = C P_k C^\\top + R$$\n现在，我们代入给定的数值：\n$$\nC P_k = \\begin{pmatrix} 1 & 0 & 0 \\\\ 0 & 1 & 0 \\end{pmatrix} \\begin{pmatrix} 0.036 & 0.012 & -0.004 \\\\ 0.012 & 0.081 & 0.003 \\\\ -0.004 & 0.003 & 0.25 \\end{pmatrix} = \\begin{pmatrix} 0.036 & 0.012 & -0.004 \\\\ 0.012 & 0.081 & 0.003 \\end{pmatrix}\n$$\n$$\nC P_k C^\\top = \\begin{pmatrix} 0.036 & 0.012 & -0.004 \\\\ 0.012 & 0.081 & 0.003 \\end{pmatrix} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\\\ 0 & 0 \\end{pmatrix} = \\begin{pmatrix} 0.036 & 0.012 \\\\ 0.012 & 0.081 \\end{pmatrix}\n$$\n最后，加上测量噪声协方差 $R$：\n$$\nS_k = \\begin{pmatrix} 0.036 & 0.012 \\\\ 0.012 & 0.081 \\end{pmatrix} + \\begin{pmatrix} 0.014 & 0 \\\\ 0 & 0.019 \\end{pmatrix} = \\begin{pmatrix} 0.050 & 0.012 \\\\ 0.012 & 0.100 \\end{pmatrix}\n$$\n这就是残差的协方差矩阵。\n\n**2) 推导阈值 $\\gamma(\\alpha)$**\n\n在正常运行（零假设 $H_0$）下，残差 $r_k$ 是两个零均值高斯向量 $e_k$ 和 $v_k$ 的线性组合，因此它本身也是一个零均值高斯向量，即 $r_k \\sim \\mathcal{N}(0, S_k)$。\n\n检验统计量 $q_k = r_k^\\top S_k^{-1} r_k$ 是 $r_k$ 的马氏距离平方。一个基本统计学结果是，如果一个 $m$ 维高斯随机向量 $z \\sim \\mathcal{N}(0, \\Sigma)$，那么 $z^\\top \\Sigma^{-1} z$ 服从自由度为 $m$ 的卡方分布，记为 $\\chi^2(m)$。\n\n在我们的案例中，残差 $r_k$ 是一个二维向量（$m=2$）。因此，$q_k$ 服从自由度为 2 的卡方分布，即 $q_k \\sim \\chi^2(2)$。\n\n我们希望找到一个阈值 $\\gamma(\\alpha)$，使得在 $H_0$ 为真时，检验统计量超过该阈值的概率（即虚警率）等于 $\\alpha$：\n$$P(q_k > \\gamma(\\alpha)) = \\alpha$$\n自由度为 2 的卡方分布的概率密度函数 (PDF) 是 $f(x) = \\frac{1}{2} e^{-x/2}$，对于 $x \\ge 0$。其累积分布函数 (CDF) 是 $F(x) = \\int_0^x \\frac{1}{2} e^{-t/2} dt = 1 - e^{-x/2}$。\n因此，\n$$P(q_k > \\gamma(\\alpha)) = 1 - P(q_k \\le \\gamma(\\alpha)) = 1 - F(\\gamma(\\alpha))$$\n$$ \\alpha = 1 - (1 - e^{-\\gamma(\\alpha)/2}) = e^{-\\gamma(\\alpha)/2} $$\n为了求解 $\\gamma(\\alpha)$，我们对方程两边取自然对数：\n$$ \\ln(\\alpha) = -\\frac{\\gamma(\\alpha)}{2} $$\n最后，我们得到阈值的闭式表达式：\n$$ \\gamma(\\alpha) = -2 \\ln(\\alpha) $$",
            "answer": "$$ \\boxed{-2 \\ln(\\alpha)} $$"
        }
    ]
}