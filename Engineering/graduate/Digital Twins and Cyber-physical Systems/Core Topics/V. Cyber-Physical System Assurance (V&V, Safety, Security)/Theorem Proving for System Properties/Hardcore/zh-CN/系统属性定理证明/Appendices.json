{
    "hands_on_practices": [
        {
            "introduction": "最弱前置条件（Weakest Precondition, WP）演算是演绎验证中的一种基石技术，它使我们能够为一个系统推导出必须满足的精确输入条件，以确保其输出始终符合期望的安全规约。本练习将此方法应用于一个典型的信号处理流水线，通过反向传播后置条件来推导对输入信号的约束，这对于验证数字孪生和CPS中的数据处理模块至关重要。",
            "id": "4250414",
            "problem": "考虑一个数字孪生中的离散时间网络物理传感管道。设输入传感器序列为一个实值序列 $\\{y[k]\\}_{k \\in \\mathbb{Z}}$，且满足 $\\|y\\|_{\\infty} = \\sup_{k \\in \\mathbb{Z}} |y[k]|  \\infty$。该管道应用以下一系列操作来生成输出 $\\{r[k]\\}_{k \\in \\mathbb{Z}}$：\n1) 一个具有三个抽头 $h_{0}, h_{1}, h_{2} \\in \\mathbb{R}$ 的因果有限脉冲响应滤波器：\n$$\nv[k] = h_{0} y[k] + h_{1} y[k-1] + h_{2} y[k-2].\n$$\n2) 一个由 $\\gamma > 0$ 参数化的非线性归一化映射，逐元素应用：\n$$\nw[k] = g(v[k]) \\quad \\text{其中} \\quad g(u) = \\frac{u}{1 + \\gamma |u|}.\n$$\n3) 一个仿射缩放和偏移：\n$$\nr[k] = \\alpha w[k] + \\beta,\n$$\n其中 $\\alpha, \\beta \\in \\mathbb{R}$。\n\n数字孪生输出流所需的安全属性是均匀边界后置条件\n$$\n\\forall k \\in \\mathbb{Z}:\\ |r[k]| \\leq B,\n$$\n其中给定 $B > 0$。假设参数满足 $0  B - |\\beta|  |\\alpha|/\\gamma$。\n\n使用用于顺序组合的最弱前置条件（WP）语义以及关于线性算子诱导范数和单调利普希茨非线性的基本事实，推导输入 $\\{y[k]\\}$ 上的最弱前置条件谓词，以确保上述后置条件对所有时间指标均成立。然后，计算最小边界 $C$，使得最弱前置条件可以写成规范形式\n$$\n\\|y\\|_{\\infty} \\leq C.\n$$\n\n将最终的 $C$ 表示为关于 $\\alpha, \\beta, \\gamma, B,$ 和滤波器系数 $h_{0}, h_{1}, h_{2}$ 的单个闭式解析表达式。无需进行数值评估，也无需指定单位。最终答案必须是单个表达式。",
            "solution": "问题要求推导输入序列 $\\{y[k]\\}$ 上的最弱前置条件，该条件保证对所有 $k \\in \\mathbb{Z}$，安全属性 $|r[k]| \\leq B$ 都成立。所寻求的最弱前置条件的形式为 $\\|y\\|_{\\infty} \\leq C$。推导过程是通过将后置条件从输出 $r[k]$ 沿操作序列向后传播到输入 $y[k]$。\n\n该管道由三个顺序操作组成：\n1. FIR 滤波器: $v[k] = h_{0} y[k] + h_{1} y[k-1] + h_{2} y[k-2]$\n2. 非线性映射: $w[k] = g(v[k]) = \\frac{v[k]}{1 + \\gamma |v[k]|}$\n3. 仿射变换: $r[k] = \\alpha w[k] + \\beta$\n\n后置条件是关于输出的安全属性：\n$$\n\\forall k \\in \\mathbb{Z}: |r[k]| \\leq B\n$$\n\n我们将从最后一个阶段开始，找出每个阶段的最弱前置条件。\n\n**步骤 1：关于 $\\{w[k]\\}$ 的前置条件**\n我们从 $r[k]$ 的条件开始，并对仿射变换求逆。\n$$\n|r[k]| \\leq B \\iff |\\alpha w[k] + \\beta| \\leq B\n$$\n这个双边不等式等价于：\n$$\n-B \\leq \\alpha w[k] + \\beta \\leq B\n$$\n从各部分减去 $\\beta$ 得到：\n$$\n-B - \\beta \\leq \\alpha w[k] \\leq B - \\beta\n$$\n问题陈述提供了约束 $0  B - |\\beta|  |\\alpha|/\\gamma$，这意味着 $B > |\\beta|$ 且 $|\\alpha| \\neq 0$。我们必须考虑 $\\alpha$ 的符号。\n\n情况 1：$\\alpha > 0$。则 $|\\alpha| = \\alpha$。\n$$\n\\frac{-B - \\beta}{\\alpha} \\leq w[k] \\leq \\frac{B - \\beta}{\\alpha}\n$$\n这等价于 $|w[k]| \\leq \\min\\left(\\frac{B - \\beta}{\\alpha}, \\frac{B + \\beta}{\\alpha}\\right)$。由于 $B > |\\beta|$，两个分子都为正。最小值为 $\\frac{B - |\\beta|}{\\alpha} = \\frac{B - |\\beta|}{|\\alpha|}$。\n\n情况 2：$\\alpha  0$。则 $|\\alpha| = -\\alpha$。\n$$\n\\frac{B - \\beta}{\\alpha} \\leq w[k] \\leq \\frac{-B - \\beta}{\\alpha} \\implies \\frac{-(B - \\beta)}{|\\alpha|} \\leq w[k] \\leq \\frac{-(-B-\\beta)}{|\\alpha|} \\implies \\frac{-(B - \\beta)}{|\\alpha|} \\leq w[k] \\leq \\frac{B + \\beta}{|\\alpha|}\n$$\n这等价于 $|w[k]| \\leq \\min\\left(\\frac{B + \\beta}{|\\alpha|}, \\frac{B - \\beta}{|\\alpha|}\\right) = \\frac{B - |\\beta|}{|\\alpha|}$。\n\n在两种情况下，$w[k]$ 上的最弱前置条件都是：\n$$\n|w[k]| \\leq \\frac{B - |\\beta|}{|\\alpha|}\n$$\n让我们将此界限定义为 $B' = \\frac{B - |\\beta|}{|\\alpha|}$。$\\{w[k]\\}$ 上的前置条件是对所有 $k \\in \\mathbb{Z}$，有 $|w[k]| \\leq B'$。\n\n**步骤 2：关于 $\\{v[k]\\}$ 的前置条件**\n接下来，我们将 $\\{w[k]\\}$ 上的条件通过非线性映射 $g(u)$ 向后传播。\n$$\n|w[k]| \\leq B' \\iff \\left| \\frac{v[k]}{1 + \\gamma |v[k]|} \\right| \\leq B'\n$$\n这可以简化为：\n$$\n\\frac{|v[k]|}{1 + \\gamma |v[k]|} \\leq B'\n$$\n令 $x = |v[k]|$。对于 $x \\geq 0$，函数 $f(x) = \\frac{x}{1 + \\gamma x}$ 是单调递增的，因为其导数 $f'(x) = \\frac{1}{(1+\\gamma x)^2}$ 对于 $\\gamma > 0$ 总是正的。因此，我们可以在不改变不等式方向的情况下解出 $x$。\n$$\nx \\leq B'(1 + \\gamma x) \\implies x \\leq B' + \\gamma B' x \\implies x(1 - \\gamma B') \\leq B'\n$$\n问题陈述 $0  B - |\\beta|  |\\alpha|/\\gamma$。除以 $|\\alpha| > 0$ 得到 $0  \\frac{B - |\\beta|}{|\\alpha|}  \\frac{1}{\\gamma}$，即 $0  B'  1/\\gamma$。这意味着 $1 - \\gamma B' > 0$。因此，我们可以除以 $(1 - \\gamma B')$：\n$$\nx \\leq \\frac{B'}{1 - \\gamma B'}\n$$\n代入 $x = |v[k]|$ 和 $B' = \\frac{B - |\\beta|}{|\\alpha|}$，$v[k]$ 上的最弱前置条件是：\n$$\n|v[k]| \\leq \\frac{\\frac{B - |\\beta|}{|\\alpha|}}{1 - \\gamma \\frac{B - |\\beta|}{|\\alpha|}} = \\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}\n$$\n让我们将这个新界限定义为 $B'' = \\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}$。该条件是对所有 $k \\in \\mathbb{Z}$，有 $|v[k]| \\leq B''$。\n\n**步骤 3：关于 $\\{y[k]\\}$ 的前置条件**\n最后，我们将 $\\{v[k]\\}$ 上的条件通过 FIR 滤波器向后传播。我们需要找到形式为 $\\|y\\|_{\\infty} \\leq C$ 的最弱前置条件，以确保对所有 $k$ 都有 $|v[k]| \\leq B''$。\n$$\n|v[k]| = |h_0 y[k] + h_1 y[k-1] + h_2 y[k-2]|\n$$\n使用三角不等式：\n$$\n|v[k]| \\leq |h_0||y[k]| + |h_1||y[k-1]| + |h_2||y[k-2]|\n$$\n由于对于任何索引 $j$ 都有 $|y[j]| \\leq \\sup_{i \\in \\mathbb{Z}} |y[i]| = \\|y\\|_{\\infty}$，我们可以写出：\n$$\n|v[k]| \\leq |h_0|\\|y\\|_{\\infty} + |h_1|\\|y\\|_{\\infty} + |h_2|\\|y\\|_{\\infty} = (|h_0| + |h_1| + |h_2|)\\|y\\|_{\\infty}\n$$\n项 $\\|h\\|_1 = |h_0| + |h_1| + |h_2|$ 是滤波器脉冲响应的 $L_1$-范数，也就是卷积算子的诱导 $L_{\\infty}$-范数。这个界是紧的，意味着对于任何 $\\|y\\|_{\\infty}$，都存在一个序列 $\\{y[k]\\}$ 使得 $\\sup_k |v[k]| = \\|h\\|_1 \\|y\\|_{\\infty}$。\n为了保证对所有 $k$ 和所有有效的输入序列都有 $|v[k]| \\leq B''$，充分条件是 $|v[k]|$ 的最大可能值受 $B''$ 的限制：\n$$\n\\|h\\|_1 \\|y\\|_{\\infty} \\leq B''\n$$\n这给出了关于 $\\|y\\|_{\\infty}$ 的一个条件：\n$$\n\\|y\\|_{\\infty} \\leq \\frac{B''}{\\|h\\|_1}\n$$\n问题要求找到最小边界 $C$，使得 $\\|y\\|_{\\infty} \\leq C$ 是这种形式的最弱前置条件。这对应于 $\\|y\\|_{\\infty}$ 上界的可能最大值，即恰好为 $\\frac{B''}{\\|h\\|_1}$（假设 $\\|h\\|_1 \\neq 0$）。如果 $\\|h\\|_1 = 0$，则 $v[k]=0$ 且任何输入都是允许的，因此不存在有限的最小边界 $C$。我们假设 $\\|h\\|_1 > 0$。\n因此，$C$ 由下式给出：\n$$\nC = \\frac{B''}{|h_0| + |h_1| + |h_2|}\n$$\n代入 $B''$ 的表达式：\n$$\nC = \\frac{\\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}}{|h_0| + |h_1| + |h_2|} = \\frac{B - |\\beta|}{\\left(|\\alpha| - \\gamma (B - |\\beta|)\\right)\\left(|h_0| + |h_1| + |h_2|\\right)}\n$$\n这是最小边界 $C$ 的最终闭式表达式。",
            "answer": "$$\n\\boxed{\\frac{B - |\\beta|}{(|\\alpha| - \\gamma (B - |\\beta|))(|h_{0}| + |h_{1}| + |h_{2}|)}}\n$$"
        },
        {
            "introduction": "许多网络物理系统本质上是随机的，并且包含需要由控制器解决的非确定性选择。马尔可夫决策过程（Markov Decision Process, MDP）为这类系统提供了一个强大的建模框架。本练习旨在通过求解贝尔曼方程来计算系统在最优（或最差）调度策略下维持安全属性的精确概率，从而深入理解概率模型检验的核心思想。",
            "id": "4250421",
            "problem": "信息物理系统 (CPS) 的数字孪生 (DT) 用于合成监控，以将物理资产保持在安全包络内。该 DT 被建模为马尔可夫决策过程 (MDP)，定义为一个元组 $(S, A, P, s_{\\mathrm{init}})$，其中 $S$ 是有限状态集，$A$ 是有限动作集，$P: S \\times A \\times S \\to [0,1]$ 是一个转移核，满足对于所有 $s \\in S$ 和 $a \\in A$，都有 $\\sum_{s' \\in S} P(s,a,s')=1$，并且 $s_{\\mathrm{init}} \\in S$ 是初始状态。一个确定性无记忆调度器 (策略) $\\sigma: S \\to A$ 解决了非确定性问题，从而诱导出一个离散时间马尔可夫链。安全性质在概率计算树逻辑 (PCTL) 中表示为 $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$，其中 $\\mathbf{G}$ 是“全局”（总是）时序算子，“safe”是表征安全集的一元状态谓词。\n\n考虑以下为 DT 监控器建模的具体 MDP 实例：\n\n- 状态：$S=\\{s_{0}, s_{1}, s_{2}, ok, fail\\}$。初始状态是 $s_{\\mathrm{init}}=s_{0}$。\n- 安全集：$\\mathrm{Safe}=\\{s_{0}, s_{1}, s_{2}, ok\\}$；唯一的不安全状态是 $fail$。\n- 可用动作和转移：\n  - 在 $s_{0}$：动作 $a$ 和 $b$。\n    - $P(s_{0}, a, s_{1})=\\frac{1}{2}$, $P(s_{0}, a, s_{2})=\\frac{1}{2}$。\n    - $P(s_{0}, b, s_{1})=\\frac{1}{3}$, $P(s_{0}, b, s_{2})=\\frac{1}{3}$, $P(s_{0}, b, fail)=\\frac{1}{3}$。\n  - 在 $s_{1}$：动作 $c$ 和 $d$。\n    - $P(s_{1}, c, ok)=\\frac{255}{256}$, $P(s_{1}, c, fail)=\\frac{1}{256}$。\n    - $P(s_{1}, d, ok)=\\frac{31}{32}$, $P(s_{1}, d, fail)=\\frac{1}{32}$。\n  - 在 $s_{2}$：动作 $e$ 和 $f$。\n    - $P(s_{2}, e, ok)=\\frac{511}{512}$, $P(s_{2}, e, fail)=\\frac{1}{512}$。\n    - $P(s_{2}, f, ok)=\\frac{15}{16}$, $P(s_{2}, f, fail)=\\frac{1}{16}$。\n  - $ok$ 和 $fail$ 是吸收态：$P(ok, -, ok)=1$ 且 $P(fail, -, fail)=1$。\n- 指定的调度器：$\\sigma^{\\star}(s_{0})=a$, $\\sigma^{\\star}(s_{1})=c$, $\\sigma^{\\star}(s_{2})=e$。\n\n任务：\n1) 从 PCTL 的形式语义和调度器 $\\sigma^{\\star}$ 下诱导的马尔可夫链出发，证明性质 $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$ 在 $s_{0}$ 处成立。最后给出 $\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}]$ 的精确值，并说明其为何满足阈值。\n2) 通过求解安全性的 Bellman 方程，计算在所有调度器上满足安全性质 $\\mathbf{G}\\, \\mathrm{safe}$ 的最小概率，即，计算\n$$\nv_{\\min}(s_{0}) \\;=\\; \\inf_{\\sigma}\\; \\mathbb{P}^{\\sigma}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}],\n$$\n作为该 MDP 相应方程组的最小不动点解。以精确分数形式表示你的最终答案。需要提交的最终答案是单个数字 $v_{\\min}(s_{0})$（无单位）。",
            "solution": "我们首先回顾在马尔可夫决策过程 (MDP) 中进行概率安全性推理所需的核心定义。一个 MDP $(S, A, P, s_{\\mathrm{init}})$ 由一个有限状态集 $S$、一个有限动作集 $A$ 和转移概率 $P(s,a,s')$ 构成，且对于每个 $s \\in S$ 和 $a \\in A$ 都满足 $\\sum_{s' \\in S} P(s,a,s')=1$。一个确定性无记忆调度器 $\\sigma: S \\to A$ 仅根据当前状态选择一个动作，从而诱导出一个离散时间、时齐的马尔可夫链，其单步转移概率为 $P_{\\sigma}(s,s') := P(s,\\sigma(s),s')$。\n\n概率计算树逻辑 (PCTL) 公式 $\\mathbb{P}_{\\ge p}[\\mathbf{G}\\, \\varphi]$ 的语义要求，在调度器 $\\sigma$ 下，从给定状态 $s$ 开始的无限路径上的概率测度，为那些满足 $\\mathbf{G}\\, \\varphi$ 的路径（即在所有时间点上都保持在满足状态谓词 $\\varphi$ 的状态中的路径）赋予至少为 $p$ 的测度。在我们的设定中，$\\varphi$ 是谓词“safe”，它恰好由安全集 $\\mathrm{Safe}$ 中的状态满足。\n\n对于一个固定的调度器 $\\sigma$，概率 $\\mathbb{P}^{\\sigma}_{s}[\\mathbf{G}\\, \\mathrm{safe}]$ 等于永不访问不安全状态 $fail$ 的无限路径集合的测度。一般来说，$\\mathbf{G}\\, \\mathrm{safe}$ 是 $\\mathbf{F}\\, \\mathrm{unsafe}$ 的补集，其中 $\\mathbf{F}$ 是“最终”算子；因此\n$$\n\\mathbb{P}^{\\sigma}_{s}[\\mathbf{G}\\, \\mathrm{safe}] \\;=\\; 1 \\;-\\; \\mathbb{P}^{\\sigma}_{s}[\\mathbf{F}\\, fail].\n$$\n在这里给出的有限吸收结构中，所有从 $s_{0}$ 开始的轨迹最多在 2 步内到达 $ok$ 或 $fail$，之后它们将永远停留在那里，因为 $ok$ 和 $fail$ 是吸收态。因此，“全局安全”事件与“在不访问 $fail$ 的情况下到达 $ok$”事件重合。\n\n第 1 部分：在指定调度器 $\\sigma^{\\star}$ 下的验证。\n\n在 $\\sigma^{\\star}$ 下，诱导的马尔可夫链具有以下非平凡转移：\n- 从 $s_{0}$ 出发，动作 $a$ 以概率 $\\frac{1}{2}$ 导致 $s_{1}$，以概率 $\\frac{1}{2}$ 导致 $s_{2}$。\n- 从 $s_{1}$ 出发，动作 $c$ 以概率 $\\frac{255}{256}$ 导致 $ok$，以概率 $\\frac{1}{256}$ 导致 $fail$。\n- 从 $s_{2}$ 出发，动作 $e$ 以概率 $\\frac{511}{512}$ 导致 $ok$，以概率 $\\frac{1}{512}$ 导致 $fail$。\n\n由于 $ok$ 和 $fail$ 是吸收态，违反 $\\mathbf{G}\\, \\mathrm{safe}$ 的唯一方式是到达 $fail$。因此，从 $s_{0}$ 开始满足 $\\mathbf{G}\\, \\mathrm{safe}$ 的概率就是从 $s_{0}$ 到达 $ok$ 而不访问 $fail$ 的概率，在这里这恰好可以在两步内发生。以从 $s_{0}$ 的第一次转移为条件：\n$$\n\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}]\n\\;=\\; \\frac{1}{2} \\cdot \\frac{255}{256} \\;+\\; \\frac{1}{2} \\cdot \\frac{511}{512}\n\\;=\\; \\frac{255}{512} \\;+\\; \\frac{511}{1024}\n\\;=\\; \\frac{510}{1024} \\;+\\; \\frac{511}{1024}\n\\;=\\; \\frac{1021}{1024}.\n$$\n由于 $\\frac{1021}{1024} = 0.9970703125$，我们有 $\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}] \\ge 0.99$，因此 PCTL 性质 $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$ 在 $\\sigma^{\\star}$ 下于 $s_{0}$ 处成立。\n\n第 2 部分：通过安全性的 Bellman 方程计算最小概率。\n\n我们现在计算在所有调度器上满足安全性质的最小概率。对于安全性质，最坏情况（对抗性）满足概率 $v_{\\min}(s)$ 是以下 Bellman 方程组的最小不动点解，该方程组由路径测度定义的单步展开和调度器量化推导而来：\n- 对于不安全状态 $fail$，$v_{\\min}(fail) = 0$。\n- 对于吸收安全状态 $ok$，$v_{\\min}(ok) = 1$。\n- 对于其他状态 $s \\in \\{s_{0}, s_{1}, s_{2}\\}$，\n$$\nv_{\\min}(s) \\;=\\; \\min_{a \\in A(s)} \\sum_{s' \\in S} P(s,a,s') \\, v_{\\min}(s').\n$$\n直观上，最小化反映了对抗性地选择动作，以最小化永久停留在安全集中的概率。\n\n我们通过反向代入法求解这些方程，利用其无环结构（所有非吸收态最多在 2 步内到达 $ok$ 或 $fail$）。\n\n首先，在 $s_{1}$ 我们有两个动作：\n- 在动作 $c$ 下，$v_{\\min}(s_{1})$ 将是 $\\frac{255}{256} \\cdot v_{\\min}(ok) + \\frac{1}{256} \\cdot v_{\\min}(fail) = \\frac{255}{256} \\cdot 1 + \\frac{1}{256} \\cdot 0 = \\frac{255}{256}$。\n- 在动作 $d$ 下，$v_{\\min}(s_{1})$ 将是 $\\frac{31}{32} \\cdot v_{\\min}(ok) + \\frac{1}{32} \\cdot v_{\\min}(fail) = \\frac{31}{32}$。\n因此，\n$$\nv_{\\min}(s_{1}) \\;=\\; \\min \\left\\{ \\frac{255}{256}, \\frac{31}{32} \\right\\} \\;=\\; \\frac{31}{32}.\n$$\n\n其次，在 $s_{2}$：\n- 在动作 $e$ 下，$v_{\\min}(s_{2})$ 将是 $\\frac{511}{512}$。\n- 在动作 $f$ 下，$v_{\\min}(s_{2})$ 将是 $\\frac{15}{16}$。\n因此，\n$$\nv_{\\min}(s_{2}) \\;=\\; \\min \\left\\{ \\frac{511}{512}, \\frac{15}{16} \\right\\} \\;=\\; \\frac{15}{16}.\n$$\n\n最后，在 $s_{0}$：\n- 在动作 $a$ 下，$v_{\\min}(s_{0})$ 将是\n$$\n\\frac{1}{2}\\, v_{\\min}(s_{1}) \\;+\\; \\frac{1}{2}\\, v_{\\min}(s_{2})\n\\;=\\; \\frac{1}{2} \\cdot \\frac{31}{32} \\;+\\; \\frac{1}{2} \\cdot \\frac{15}{16}\n\\;=\\; \\frac{1}{2} \\cdot \\left( \\frac{31}{32} + \\frac{30}{32} \\right)\n\\;=\\; \\frac{61}{64}.\n$$\n- 在动作 $b$ 下，$v_{\\min}(s_{0})$ 将是\n$$\n\\frac{1}{3}\\, v_{\\min}(s_{1}) \\;+\\; \\frac{1}{3}\\, v_{\\min}(s_{2}) \\;+\\; \\frac{1}{3}\\, v_{\\min}(fail)\n\\;=\\; \\frac{1}{3} \\cdot \\frac{31}{32} \\;+\\; \\frac{1}{3} \\cdot \\frac{15}{16} \\;+\\; \\frac{1}{3} \\cdot 0\n\\;=\\; \\frac{1}{3} \\cdot \\left( \\frac{31}{32} + \\frac{30}{32} \\right)\n\\;=\\; \\frac{61}{96}.\n$$\n因此，\n$$\nv_{\\min}(s_{0}) \\;=\\; \\min \\left\\{ \\frac{61}{64}, \\frac{61}{96} \\right\\} \\;=\\; \\frac{61}{96}.\n$$\n\n这个值是在所有调度器上，从初始状态 $s_{0}$ 开始满足安全性质 $\\mathbf{G}\\, \\mathrm{safe}$ 的最小概率。以精确分数形式表示，\n$$\nv_{\\min}(s_{0}) \\;=\\; \\frac{61}{96}.\n$$",
            "answer": "$$\\boxed{\\frac{61}{96}}$$"
        },
        {
            "introduction": "混合系统结合了离散的逻辑控制和连续的物理动态，对它们的验证提出了独特的挑战。基于可满足性模理论（Satisfiability Modulo Theories, SMT）的有界模型检验是一种强大的自动化技术，能够精确地分析这类系统在有限时间内的行为。本练习演示了如何将一个混合自动机的有界可达性问题编码为一个逻辑公式，并利用SMT求解器来形式化地证明或证伪系统是否可能达到不安全状态。",
            "id": "4250424",
            "problem": "考虑一个纵向车辆的数字孪生，在信息物理系统 (CPS) 领域中被建模为一个混合自动机。该混合自动机有两个离散模式，分别表示为 $M_0$ (加速) 和 $M_1$ (刹车)。连续状态为 $(x,v) \\in \\mathbb{R}^2$，其中 $x$ 是位置，$v$ 是速度。连续动态和不变式如下：\n- 在模式 $M_0$ 中：$\\dot{x} = v$, $\\dot{v} = a_{\\max}$，其中 $a_{\\max} = 2$，不变式为 $v \\le v_{\\max}$，其中 $v_{\\max} = 10$。\n- 在模式 $M_1$ 中：$\\dot{x} = v$, $\\dot{v} = -b_{\\max}$，其中 $b_{\\max} = 4$，不变式为 $v \\ge 0$。\n\n存在一个由守卫使能的单向转换 $M_0 \\to M_1$，其守卫条件为 $x \\ge x_{\\mathrm{guard}}$，其中 $x_{\\mathrm{guard}} = 15$。在所考虑的时间范围内不允许反向转换。初始集为单点集 $x(0) = 0$, $v(0) = 0$。不安全集由谓词 $x \\ge X_U \\wedge v \\ge V_U$ 定义，其中 $X_U = 20$ 且 $V_U = 9$。时间预算为 $T_U = 4$，我们考虑一个有界时域可达性查询，该查询最多允许一次离散转换（即最多一次模式切换）。\n\n任务是在可满足性模理论 (SMT) 中，形式化一个可达性查询，该查询询问是否存在此混合自动机的一次运行，其最多进行一次切换，总耗时不超过 $T_U$，并能到达不安全集。此处，可满足性模理论 (SMT) 指的是关于一阶公式在一系列背景理论（如实数算术）组合下的可满足性判定问题。该编码必须对于上述给出的精确连续动态是可靠的（即，不是粗略的欠近似），并使用由恒定加速和减速所蕴含的常微分方程 (ODEs) 的闭式解。\n\n选择一个选项，该选项正确地构建了这样一个 SMT 编码，并正确地解释了 SMT 求解器的 UNSAT 结果如何构成在给定有界时域内不安全集不可达的证明。\n\nA. 引入存在性的非负时间变量 $\\tau_0,\\tau_1 \\in \\mathbb{R}_{\\ge 0}$ 和一个布尔值 $z \\in \\{0,1\\}$，它选择在 $M_0$ 中的单个连续段（$z=0$）或先在 $M_0$ 后在 $M_1$ 的两段式运行（$z=1$）。使用闭式解和每个段上的单调性来编码精确的连续流和不变式：\n- 情况 $z=0$（无切换，仅在 $M_0$ 中）：$x_f = \\tfrac{1}{2} a_{\\max}\\tau_0^2$, $v_f = a_{\\max}\\tau_0$, $v_f \\le v_{\\max}$, $\\tau_0 \\le T_U$, 以及 $x_f \\ge X_U \\wedge v_f \\ge V_U$。\n- 情况 $z=1$（先 $M_0$ 后 $M_1$）：$x_1 = \\tfrac{1}{2} a_{\\max}\\tau_0^2$, $v_1 = a_{\\max}\\tau_0$, $v_1 \\le v_{\\max}$, $x_1 \\ge x_{\\mathrm{guard}}$，然后 $x_f = x_1 + v_1\\tau_1 - \\tfrac{1}{2} b_{\\max}\\tau_1^2$, $v_f = v_1 - b_{\\max}\\tau_1$, $v_f \\ge 0$, 以及 $\\tau_0 + \\tau_1 \\le T_U$，再加上 $x_f \\ge X_U \\wedge v_f \\ge V_U$。总体公式是这两种情况的析取，并且是非线性实数算术上的无量词公式。因为该编码与混合自动机的有界语义在语义上是等价的，所以 UNSAT 结果证明了在有界时域内不安全集是不可达的。\nB. 对连续动态使用单步前向欧拉离散化，步长固定为 $\\Delta = T_U$：对于 $M_0$，有 $x_f = x(0) + v(0)\\Delta$, $v_f = v(0) + a_{\\max}\\Delta$；对于 $M_1$，有 $x_f = x(0) + v(0)\\Delta$, $v_f = v(0) - b_{\\max}\\Delta$。仅在最终时刻 $T_U$ 强制执行不变式，并使用 $x(T_U) \\ge x_{\\mathrm{guard}}$ 对切换进行建模。结论是，如果得到的线性算术约束为 UNSAT，那么对于真实的连续动态，不安全集是不可达的。\nC. 通过对时间的全称量化来编码不变式：在 $M_0$ 中 $\\forall t \\in [0,\\tau_0].\\, v(t) \\le v_{\\max}$，在 $M_1$ 中 $\\forall t \\in [0,\\tau_1].\\, v(t) \\ge 0$，但将流线性近似为：在 $M_0$ 中 $x(t) = x(0) + v(0)t$, $v(t) = v(0) + a_{\\max}t$，在 $M_1$ 中 $v(t) = v(0) - b_{\\max}t$，并使用守卫 $x(\\tau_0) \\ge x_{\\mathrm{guard}}$。论证即使 SMT 求解器对此公式返回 UNSAT，也只确立了在离散化模型中不安全集是不可达的，而在精确的连续模型中可能仍然是可达的。\nD. 精确编码流，但在刹车时交换 $b_{\\max}$ 的符号（使用 $\\dot{v} = +b_{\\max}$），并将守卫强制为 $x(\\tau_0) \\le x_{\\mathrm{guard}}$。陈述 SAT 结果蕴含不可达性，而 UNSAT 结果蕴含可达性，因为求解器搜索的是反例。\n\n只有一个选项是正确的。",
            "solution": "### 步骤 1：提取已知信息\n\n问题为纵向车辆的混合自动机模型提供了以下数据和定义：\n-   **离散模式**: $M_0$ (加速)，$M_1$ (刹车)。\n-   **连续状态**: $(x,v) \\in \\mathbb{R}^2$，其中 $x$ 为位置，$v$ 为速度。\n-   **初始状态**: $x(0) = 0$, $v(0) = 0$。\n-   **模式 $M_0$ (加速)**：\n    -   动态：$\\dot{x} = v$, $\\dot{v} = a_{\\max}$。\n    -   常量：$a_{\\max} = 2$。\n    -   不变式：$v \\le v_{\\max}$。\n    -   常量：$v_{\\max} = 10$。\n-   **模式 $M_1$ (刹车)**：\n    -   动态：$\\dot{x} = v$, $\\dot{v} = -b_{\\max}$。\n    -   常量：$b_{\\max} = 4$。\n    -   不变式：$v \\ge 0$。\n-   **转换**: 只允许单向转换 $M_0 \\to M_1$。不允许反向转换 $M_1 \\to M_0$。\n    -   守卫：$x \\ge x_{\\mathrm{guard}}$。\n    -   常量：$x_{\\mathrm{guard}} = 15$。\n-   **不安全集**: 由谓词 $x \\ge X_U \\wedge v \\ge V_U$ 定义。\n    -   常量：$X_U = 20$, $V_U = 9$。\n-   **有界时域可达性查询**:\n    -   时间预算：总耗时最多为 $T_U = 4$。\n    -   切换约束：最多一次离散转换（从 $M_0$ 到 $M_1$）。\n-   **任务要求**: 在可满足性模理论 (SMT) 中使用精确连续动态的闭式解来形式化可达性查询。SMT 求解器的 UNSAT 结果必须构成不可达性的证明。\n\n### 步骤 2：使用提取的已知信息进行验证\n\n根据验证标准对问题陈述进行评估：\n-   **有科学依据**: 问题使用了一个标准、简化的一维运动学模型（恒定加速/减速），这是物理学中的一个基本概念。混合自动机是信息物理系统 (CPS) 和控制理论领域中一个成熟的形式化方法。SMT 是形式化验证的一种标准技术。该问题在科学上和数学上都是可靠的。\n-   **适定的**: 问题定义清晰。它明确说明了混合自动机的完整动态，包括初始条件、不变式、守卫条件和所有物理参数。可达性问题是明确无误的，具有清晰的不安全集以及对时间和模式切换次数的明确界限。这种结构确保了存在一个特定的、可验证的解。\n-   **客观的**: 问题以精确、客观的数学和逻辑语言陈述。它没有模糊性、主观性或基于观点的论断。\n\n问题陈述没有缺陷。它不是科学上不可靠、不完整、矛盾或不适定的。这是混合系统形式化验证中的一个标准问题。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。将推导出一个解决方案。\n\n### 正确 SMT 编码的推导\n\n任务是确定是否存在一个系统轨迹，其总持续时间最多为 $T_U=4$ 且最多有一次模式切换，从 $(x,v)=(0,0)$ 开始并进入由 $x \\ge 20 \\wedge v \\ge 9$ 定义的不安全集。这可以编码为一个非线性实数算术上的 SMT 公式。该编码必须是精确的，使用微分方程的闭式解。\n\n在“最多一次切换”的约束下，有两种可能的场景：\n1.  **零次切换**：系统完全在模式 $M_0$ 中演化。\n2.  **一次切换**：系统在 $M_0$ 中演化一段时间，然后转换到 $M_1$ 并再演化一段时间。\n\n设 $\\tau_0$ 是在模式 $M_0$ 中花费的时间，$\\tau_1$ 是在模式 $M_1$ 中花费的时间。两者都必须是非负实数，即 $\\tau_0 \\ge 0, \\tau_1 \\ge 0$。\n\n#### 情况 1：零次切换（轨迹仅在 $M_0$ 中）\n\n在这种情况下，$\\tau_1=0$。系统在 $M_0$ 中演化了持续时间 $\\tau_0$。\n-   初始条件：$x(0)=0$, $v(0)=0$。\n-   $M_0$ 中的动态：$\\dot{v} = a_{\\max} = 2$, $\\dot{x}=v$。\n-   对动态进行积分，得到在时间 $t \\in [0, \\tau_0]$ 时的状态：\n    -   $v(t) = v(0) + a_{\\max} t = 2t$\n    -   $x(t) = x(0) + \\int_0^t v(s) ds = \\int_0^t 2s \\, ds = t^2$\n-   设在时刻 $\\tau_0$ 的最终状态表示为 $(x_f, v_f)$。因此，$x_f = \\tau_0^2$ 且 $v_f = 2\\tau_0$。\n-   一个有效的、不安全轨迹的约束是：\n    1.  时间预算：$\\tau_0 \\le T_U \\implies \\tau_0 \\le 4$。\n    2.  $M_0$ 中的不变式：对于所有 $t \\in [0, \\tau_0]$，$v(t) \\le v_{\\max}$。由于 $v(t)=2t$ 是单调递增的，如果 $v(\\tau_0) \\le v_{\\max} \\implies 2\\tau_0 \\le 10$，则此条件满足。\n    3.  不安全条件：最终状态必须在不安全集中：$x_f \\ge X_U \\wedge v_f \\ge V_U \\implies \\tau_0^2 \\ge 20 \\wedge 2\\tau_0 \\ge 9$。\n    由于在此模式下 $x(t)$ 和 $v(t)$ 都是非递减的，如果不安全集在任何时间 $t \\in [0, \\tau_0]$ 被达到，那么它在时间 $\\tau_0$ 也被达到。因此，在端点进行检查就足够了。\n\n这种情况的 SMT 公式是这些约束在存在变量 $\\tau_0 \\ge 0$ 上的合取。\n\n#### 情况 2：一次切换 ($M_0 \\to M_1$)\n\n系统在 $M_0$ 中演化持续时间 $\\tau_0$，进行切换，然后在 $M_1$ 中演化持续时间 $\\tau_1$。\n-   **第一段（在模式 $M_0$ 中持续时间 $\\tau_0$）**：\n    -   切换时刻 $\\tau_0$ 的状态，表示为 $(x_1, v_1)$：\n        -   $v_1 = a_{\\max} \\tau_0 = 2\\tau_0$。\n        -   $x_1 = \\frac{1}{2} a_{\\max} \\tau_0^2 = \\tau_0^2$。\n    -   $M_0$ 中的不变式检查：$v_1 \\le v_{\\max} \\implies 2\\tau_0 \\le 10$。\n    -   守卫条件检查：$x_1 \\ge x_{\\mathrm{guard}} \\implies \\tau_0^2 \\ge 15$。\n-   **第二段（在模式 $M_1$ 中持续时间 $\\tau_1$）**：\n    -   系统从状态 $(x_1, v_1)$ 开始这一段。在这一段内，相对时间 $t' \\in [0, \\tau_1]$ 的状态是：\n        -   $v(t') = v_1 - b_{\\max}t' = 2\\tau_0 - 4t'$。\n        -   $x(t') = x_1 + v_1 t' - \\frac{1}{2}b_{\\max} (t')^2 = \\tau_0^2 + (2\\tau_0)t' - 2(t')^2$。\n    -   设进入该段后 $\\tau_1$ 时刻的最终状态为 $(x_f, v_f)$：\n        -   $v_f = 2\\tau_0 - 4\\tau_1$。\n        -   $x_f = \\tau_0^2 + 2\\tau_0\\tau_1 - 2\\tau_1^2$。\n-   这种情况的总体约束是：\n    1.  时间预算：$\\tau_0 + \\tau_1 \\le T_U \\implies \\tau_0 + \\tau_1 \\le 4$。\n    2.  $M_1$ 中的不变式：对于所有 $t' \\in [0, \\tau_1]$，$v(t') \\ge 0$。由于 $v(t')$ 是单调递减的，如果 $v_f \\ge 0 \\implies 2\\tau_0 - 4\\tau_1 \\ge 0$，则此条件成立。\n    3.  不安全条件：最终状态必须在不安全集中：$x_f \\ge X_U \\wedge v_f \\ge V_U \\implies (\\tau_0^2 + 2\\tau_0\\tau_1 - 2\\tau_1^2 \\ge 20) \\wedge (2\\tau_0 - 4\\tau_1 \\ge 9)$。\n    注意：在整个轨迹中，$v$ 和 $x$ 都是非递减的（在 $M_1$ 中，$v \\ge 0$ 是一个不变式，因此 $\\dot{x}=v \\ge 0$），所以检查运行的最终时刻的可达性就足够了。\n\n这种情况的 SMT 公式是第一段和第二段的所有约束在存在变量 $\\tau_0 \\ge 0, \\tau_1 \\ge 0$ 上的合取。\n\n#### 总体 SMT 公式和解释\n\n完整的可达性 SMT 查询是情况 1 和情况 2 公式的析取（逻辑或）。这是一个非线性实数算术上的无量词公式 (QF_NRA)。\n-   如果求解器找到满足任一约束集的 $\\tau_0$ 和/或 $\\tau_1$ 的值，它将返回 SAT。这对应于一条到达不安全集的具体轨迹。\n-   如果求解器证明不存在这样的值，它将返回 UNSAT。因为该编码是问题约束下所有可能轨迹的精确表示，所以 UNSAT 结果是不安全集不可达的形式化证明。\n\n### 逐项分析\n\n**A. 引入存在性的非负时间变量 ...**\n此选项描述了上面推导出的精确编码。\n-   它使用一个选择变量 $z$（或隐式地，一个析取）正确地对两种场景（零次或一次切换）进行建模。\n-   它在两种模式下都使用了正确的位置和速度闭式解，从正确的初始/中间条件开始：情况 1 为 $x_f = \\frac{1}{2} a_{\\max}\\tau_0^2$, $v_f = a_{\\max}\\tau_0$，情况 2 为 $x_f = x_1 + v_1\\tau_1 - \\frac{1}{2}b_{\\max}\\tau_1^2$, $v_f = v_1 - b_{\\max}\\tau_1$。\n-   它正确地强制执行了所有约束：时间预算、不变式（利用单调性）、守卫和不安全集条件。\n-   它对公式类型（非线性实数算术上的无量词公式）的解释是正确的。\n-   它的结论，即由于编码的语义等价性，UNSAT 结果证明了不可达性，是正确的，并且是这种验证方法的核心要点。\n\n结论：**正确**。\n\n**B. 使用单步前向欧拉离散化 ...**\n此选项建议使用一种近似方法（步长较大的单步欧拉法 $\\Delta = T_U$）。\n-   首先，这直接违反了问题要求使用“精确连续动态”和“闭式解”的规定。\n-   其次，这样粗略的近似（例如，$x_f = x(0) + v(0)\\Delta = 0$）极其不准确，不能正确表示系统的行为。\n-   第三，对于近似模型的 UNSAT 结果能证明精确模型的不可达性这一结论通常是错误的。只有当近似是可达集的一个保证的过近似时，这样的结论才成立，而简单的欧拉步长并非如此。\n\n结论：**不正确**。\n\n**C. 通过全称量化编码不变式 ...**\n此选项有多个缺陷。\n-   它建议将位置流线性近似为：$x(t) = x(0) + v(0)t$。这对于恒定加速度的情况是根本错误的，因为其流是二次的。正确的公式是 $x(t) = x(0) + v(0)t + \\frac{1}{2} at^2$。\n-   通过提出一个有缺陷的、近似的模型，它未能满足问题对精确编码的要求。\n-   它的结论，即该模型的 UNSAT 结果不能保证精确模型的不可达性，是正确的，但这恰恰突显了为什么所提出的方法不适合*证明*不可达性的任务。\n\n结论：**不正确**。\n\n**D. 精确编码流，但在刹车时交换 $b_{\\max}$ 的符号 ...**\n此选项包含几个严重错误。\n-   `交换 $b_{\\max}$ 的符号`：使用 $\\dot{v} = +b_{\\max}$ 进行刹车在物理上是不正确的。它模拟的是加速，而不是减速。\n-   `将守卫强制为 $x(\\tau_0) \\le x_{\\mathrm{guard}}`**：这是守卫逻辑的反面。一个守卫 $x \\ge x_{\\mathrm{guard}}$ 在条件满足时*使能*一个转换。\n-   `陈述 SAT 结果蕴含不可达性，而 UNSAT 结果蕴含可达性`：这个逻辑是颠倒的。对于一个编码可达性的公式，SAT 意味着可达，而 UNSAT 意味着不可达。\n\n结论：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}