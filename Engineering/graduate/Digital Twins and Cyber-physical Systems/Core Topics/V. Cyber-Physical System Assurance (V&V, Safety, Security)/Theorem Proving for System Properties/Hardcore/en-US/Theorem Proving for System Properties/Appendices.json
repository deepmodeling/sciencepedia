{
    "hands_on_practices": [
        {
            "introduction": "We begin our practical exploration with a foundational technique in deductive verification: the weakest precondition calculus. This method allows us to reason backward from a desired outcome, or 'postcondition,' to derive the most lenient 'precondition' on the initial state that guarantees the outcome. This exercise  challenges you to apply this powerful concept to a multi-stage signal processing pipeline, a common element in digital twins and cyber-physical systems, to ensure its output remains within safe bounds.",
            "id": "4250414",
            "problem": "Consider a discrete-time cyber-physical sensing pipeline in a digital twin. Let the input sensor sequence be a real-valued sequence $\\{y[k]\\}_{k \\in \\mathbb{Z}}$ with $\\|y\\|_{\\infty} = \\sup_{k \\in \\mathbb{Z}} |y[k]|  \\infty$. The pipeline applies the following sequence of operations to produce the output $\\{r[k]\\}_{k \\in \\mathbb{Z}}$:\n1) A causal finite impulse response filter with three taps $h_{0}, h_{1}, h_{2} \\in \\mathbb{R}$:\n$$\nv[k] = h_{0} y[k] + h_{1} y[k-1] + h_{2} y[k-2].\n$$\n2) A nonlinear normalization map parameterized by $\\gamma  0$ applied elementwise:\n$$\nw[k] = g(v[k]) \\quad \\text{with} \\quad g(u) = \\frac{u}{1 + \\gamma |u|}.\n$$\n3) An affine scaling and offset:\n$$\nr[k] = \\alpha w[k] + \\beta,\n$$\nwhere $\\alpha, \\beta \\in \\mathbb{R}$.\n\nThe safety property required for the digital twin’s output stream is the uniform bound postcondition\n$$\n\\forall k \\in \\mathbb{Z}:\\ |r[k]| \\leq B,\n$$\nwith $B  0$ given. Assume the parameters satisfy $0  B - |\\beta|  |\\alpha|/\\gamma$.\n\nUsing the weakest precondition (WP) semantics for sequential composition and foundational facts about induced norms of linear operators and monotone Lipschitz nonlinearities, derive the weakest precondition predicate on the input $\\{y[k]\\}$ that ensures the above postcondition holds for all time indices. Then, compute the minimal bound $C$ such that the weakest precondition can be written in the canonical form\n$$\n\\|y\\|_{\\infty} \\leq C.\n$$\n\nExpress the final $C$ as a single closed-form analytic expression in terms of $\\alpha, \\beta, \\gamma, B,$ and the filter coefficients $h_{0}, h_{1}, h_{2}$. No numerical evaluation is required, and no units need be specified. The final answer must be a single expression.",
            "solution": "The problem requires the derivation of the weakest precondition on the input sequence $\\{y[k]\\}$ that guarantees the safety property $|r[k]| \\leq B$ for all $k \\in \\mathbb{Z}$. The weakest precondition is sought in the form $\\|y\\|_{\\infty} \\leq C$. The derivation proceeds by propagating the postcondition backward through the sequence of operations, from the output $r[k]$ to the input $y[k]$.\n\nThe pipeline consists of three sequential operations:\n1. FIR filter: $v[k] = h_{0} y[k] + h_{1} y[k-1] + h_{2} y[k-2]$\n2. Nonlinear map: $w[k] = g(v[k]) = \\frac{v[k]}{1 + \\gamma |v[k]|}$\n3. Affine transform: $r[k] = \\alpha w[k] + \\beta$\n\nThe postcondition is the safety property on the output:\n$$\n\\forall k \\in \\mathbb{Z}: |r[k]| \\leq B\n$$\n\nWe will find the weakest precondition for each stage, starting from the last one.\n\n**Step 1: Precondition on $\\{w[k]\\}$**\nWe start with the condition on $r[k]$ and invert the affine transformation.\n$$\n|r[k]| \\leq B \\iff |\\alpha w[k] + \\beta| \\leq B\n$$\nThis two-sided inequality is equivalent to:\n$$\n-B \\leq \\alpha w[k] + \\beta \\leq B\n$$\nSubtracting $\\beta$ from all parts gives:\n$$\n-B - \\beta \\leq \\alpha w[k] \\leq B - \\beta\n$$\nThe problem statement provides the constraint $0  B - |\\beta|  |\\alpha|/\\gamma$, which implies $B  |\\beta|$ and $|\\alpha| \\neq 0$. We must consider the sign of $\\alpha$.\n\nCase 1: $\\alpha  0$. Then $|\\alpha| = \\alpha$.\n$$\n\\frac{-B - \\beta}{\\alpha} \\leq w[k] \\leq \\frac{B - \\beta}{\\alpha}\n$$\nThis is equivalent to $|w[k]| \\leq \\min\\left(\\frac{B - \\beta}{\\alpha}, \\frac{B + \\beta}{\\alpha}\\right)$. Since $B  |\\beta|$, both numerators are positive. The minimum is $\\frac{B - |\\beta|}{\\alpha} = \\frac{B - |\\beta|}{|\\alpha|}$.\n\nCase 2: $\\alpha  0$. Then $|\\alpha| = -\\alpha$.\n$$\n\\frac{B - \\beta}{\\alpha} \\leq w[k] \\leq \\frac{-B - \\beta}{\\alpha} \\implies \\frac{-(B - \\beta)}{|\\alpha|} \\leq w[k] \\leq \\frac{-(-B-\\beta)}{|\\alpha|} \\implies \\frac{-(B - \\beta)}{|\\alpha|} \\leq w[k] \\leq \\frac{B + \\beta}{|\\alpha|}\n$$\nThis is equivalent to $|w[k]| \\leq \\min\\left(\\frac{B + \\beta}{|\\alpha|}, \\frac{B - \\beta}{|\\alpha|}\\right) = \\frac{B - |\\beta|}{|\\alpha|}$.\n\nIn both cases, the weakest precondition on $w[k]$ is:\n$$\n|w[k]| \\leq \\frac{B - |\\beta|}{|\\alpha|}\n$$\nLet us define this bound as $B' = \\frac{B - |\\beta|}{|\\alpha|}$. The precondition on $\\{w[k]\\}$ is $|w[k]| \\leq B'$ for all $k \\in \\mathbb{Z}$.\n\n**Step 2: Precondition on $\\{v[k]\\}$**\nNext, we propagate the condition on $\\{w[k]\\}$ backward through the nonlinear map $g(u)$.\n$$\n|w[k]| \\leq B' \\iff \\left| \\frac{v[k]}{1 + \\gamma |v[k]|} \\right| \\leq B'\n$$\nThis simplifies to:\n$$\n\\frac{|v[k]|}{1 + \\gamma |v[k]|} \\leq B'\n$$\nLet $x = |v[k]|$. The function $f(x) = \\frac{x}{1 + \\gamma x}$ for $x \\geq 0$ is monotonically increasing, since its derivative $f'(x) = \\frac{1}{(1+\\gamma x)^2}$ is always positive for $\\gamma  0$. We can therefore solve for $x$ without changing the inequality direction.\n$$\nx \\leq B'(1 + \\gamma x) \\implies x \\leq B' + \\gamma B' x \\implies x(1 - \\gamma B') \\leq B'\n$$\nThe problem states $0  B - |\\beta|  |\\alpha|/\\gamma$. Dividing by $|\\alpha|  0$ gives $0  \\frac{B - |\\beta|}{|\\alpha|}  \\frac{1}{\\gamma}$, which is $0  B'  1/\\gamma$. This implies $1 - \\gamma B'  0$. Thus, we can divide by $(1 - \\gamma B')$:\n$$\nx \\leq \\frac{B'}{1 - \\gamma B'}\n$$\nSubstituting $x = |v[k]|$ and $B' = \\frac{B - |\\beta|}{|\\alpha|}$, the weakest precondition on $v[k]$ is:\n$$\n|v[k]| \\leq \\frac{\\frac{B - |\\beta|}{|\\alpha|}}{1 - \\gamma \\frac{B - |\\beta|}{|\\alpha|}} = \\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}\n$$\nLet us define this new bound as $B'' = \\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}$. The condition is $|v[k]| \\leq B''$ for all $k \\in \\mathbb{Z}$.\n\n**Step 3: Precondition on $\\{y[k]\\}$**\nFinally, we propagate the condition on $\\{v[k]\\}$ backward through the FIR filter. We need to find the weakest precondition of the form $\\|y\\|_{\\infty} \\leq C$ that ensures $|v[k]| \\leq B''$ for all $k$.\n$$\n|v[k]| = |h_0 y[k] + h_1 y[k-1] + h_2 y[k-2]|\n$$\nUsing the triangle inequality:\n$$\n|v[k]| \\leq |h_0||y[k]| + |h_1||y[k-1]| + |h_2||y[k-2]|\n$$\nSince $|y[j]| \\leq \\sup_{i \\in \\mathbb{Z}} |y[i]| = \\|y\\|_{\\infty}$ for any index $j$, we can write:\n$$\n|v[k]| \\leq |h_0|\\|y\\|_{\\infty} + |h_1|\\|y\\|_{\\infty} + |h_2|\\|y\\|_{\\infty} = (|h_0| + |h_1| + |h_2|)\\|y\\|_{\\infty}\n$$\nThe term $\\|h\\|_1 = |h_0| + |h_1| + |h_2|$ is the $L_1$-norm of the filter's impulse response, which is the induced $L_{\\infty}$-norm of the convolution operator. The bound is tight, meaning for any $\\|y\\|_{\\infty}$, there exists a sequence $\\{y[k]\\}$ such that $\\sup_k |v[k]| = \\|h\\|_1 \\|y\\|_{\\infty}$.\nTo guarantee $|v[k]| \\leq B''$ for all $k$ and all valid input sequences, it is sufficient that the maximum possible value of $|v[k]|$ is bounded by $B''$:\n$$\n\\|h\\|_1 \\|y\\|_{\\infty} \\leq B''\n$$\nThis gives a condition on $\\|y\\|_{\\infty}$:\n$$\n\\|y\\|_{\\infty} \\leq \\frac{B''}{\\|h\\|_1}\n$$\nThe problem asks for the minimal bound $C$ such that $\\|y\\|_{\\infty} \\leq C$ is the weakest precondition of this form. This corresponds to the largest possible value for the upper bound on $\\|y\\|_{\\infty}$, which is exactly $\\frac{B''}{\\|h\\|_1}$ (assuming $\\|h\\|_1 \\neq 0$). If $\\|h\\|_1 = 0$, then $v[k]=0$ and any input is permissible, so there is no finite minimal bound $C$. We assume $\\|h\\|_1  0$.\nTherefore, $C$ is given by:\n$$\nC = \\frac{B''}{|h_0| + |h_1| + |h_2|}\n$$\nSubstituting the expression for $B''$:\n$$\nC = \\frac{\\frac{B - |\\beta|}{|\\alpha| - \\gamma (B - |\\beta|)}}{|h_0| + |h_1| + |h_2|} = \\frac{B - |\\beta|}{\\left(|\\alpha| - \\gamma (B - |\\beta|)\\right)\\left(|h_0| + |h_1| + |h_2|\\right)}\n$$\nThis is the final closed-form expression for the minimal bound $C$.",
            "answer": "$$\n\\boxed{\\frac{B - |\\beta|}{(|\\alpha| - \\gamma (B - |\\beta|))(|h_{0}| + |h_{1}| + |h_{2}|)}}\n$$"
        },
        {
            "introduction": "Many cyber-physical systems exhibit stochastic behavior due to sensor noise, unpredictable environments, or randomized algorithms. To reason about such systems, we move from deterministic logic to probabilistic verification. This practice  introduces Markov Decision Processes (MDPs) as a formal model for systems combining probabilistic and nondeterministic choices. You will verify a safety property specified in Probabilistic Computation Tree Logic (PCTL) and determine the minimal safety probability, providing hands-on experience in quantifying the reliability of a system under different control strategies.",
            "id": "4250421",
            "problem": "A Digital Twin (DT) of a Cyber-Physical System (CPS) is used to synthesize supervisory control that keeps the physical asset within a safety envelope. The DT is modeled as a Markov Decision Process (MDP), defined as a tuple $(S, A, P, s_{\\mathrm{init}})$ where $S$ is a finite set of states, $A$ is a finite set of actions, $P: S \\times A \\times S \\to [0,1]$ is a transition kernel with $\\sum_{s' \\in S} P(s,a,s')=1$ for all $s \\in S$ and $a \\in A$, and $s_{\\mathrm{init}} \\in S$ is the initial state. A deterministic memoryless scheduler (policy) $\\sigma: S \\to A$ resolves the nondeterminism, inducing a discrete-time Markov chain. The safety property is expressed in Probabilistic Computation Tree Logic (PCTL) as $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$, where $\\mathbf{G}$ is the “globally” (always) temporal operator and “safe” is the unary state predicate characterizing the safe set.\n\nConsider the following concrete MDP instance modeling a DT supervisor:\n\n- States: $S=\\{s_{0}, s_{1}, s_{2}, ok, fail\\}$. The initial state is $s_{\\mathrm{init}}=s_{0}$.\n- Safe set: $\\mathrm{Safe}=\\{s_{0}, s_{1}, s_{2}, ok\\}$; the only unsafe state is $fail$.\n- Actions available and transitions:\n  - At $s_{0}$: actions $a$ and $b$.\n    - $P(s_{0}, a, s_{1})=\\frac{1}{2}$, $P(s_{0}, a, s_{2})=\\frac{1}{2}$.\n    - $P(s_{0}, b, s_{1})=\\frac{1}{3}$, $P(s_{0}, b, s_{2})=\\frac{1}{3}$, $P(s_{0}, b, fail)=\\frac{1}{3}$.\n  - At $s_{1}$: actions $c$ and $d$.\n    - $P(s_{1}, c, ok)=\\frac{255}{256}$, $P(s_{1}, c, fail)=\\frac{1}{256}$.\n    - $P(s_{1}, d, ok)=\\frac{31}{32}$, $P(s_{1}, d, fail)=\\frac{1}{32}$.\n  - At $s_{2}$: actions $e$ and $f$.\n    - $P(s_{2}, e, ok)=\\frac{511}{512}$, $P(s_{2}, e, fail)=\\frac{1}{512}$.\n    - $P(s_{2}, f, ok)=\\frac{15}{16}$, $P(s_{2}, f, fail)=\\frac{1}{16}$.\n  - $ok$ and $fail$ are absorbing: $P(ok, -, ok)=1$ and $P(fail, -, fail)=1$.\n- Specified scheduler: $\\sigma^{\\star}(s_{0})=a$, $\\sigma^{\\star}(s_{1})=c$, $\\sigma^{\\star}(s_{2})=e$.\n\nTasks:\n1) Starting from the formal semantics of PCTL and the induced Markov chain under the scheduler $\\sigma^{\\star}$, prove that the property $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$ holds at $s_{0}$. Conclude with the exact value of $\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}]$ and justify why it satisfies the threshold.\n2) Compute the minimal probability of satisfying the safety property $\\mathbf{G}\\, \\mathrm{safe}$ over all schedulers by solving the Bellman equations for safety, i.e., compute\n$$\nv_{\\min}(s_{0}) \\;=\\; \\inf_{\\sigma}\\; \\mathbb{P}^{\\sigma}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}],\n$$\nas the least fixed-point solution of the appropriate system of equations for this MDP. Express your final answer as an exact fraction. The final answer to submit is the single number $v_{\\min}(s_{0})$ (no units).",
            "solution": "We begin by recalling the core definitions needed to reason about probabilistic safety in a Markov Decision Process (MDP). An MDP $(S, A, P, s_{\\mathrm{init}})$ consists of a finite set of states $S$, a finite set of actions $A$, and transition probabilities $P(s,a,s')$ that satisfy $\\sum_{s' \\in S} P(s,a,s')=1$ for each $s \\in S$ and $a \\in A$. A deterministic memoryless scheduler $\\sigma: S \\to A$ selects an action as a function of the current state only, thereby inducing a discrete-time, time-homogeneous Markov chain with one-step transition probabilities $P_{\\sigma}(s,s') := P(s,\\sigma(s),s')$.\n\nThe semantics of the Probabilistic Computation Tree Logic (PCTL) formula $\\mathbb{P}_{\\ge p}[\\mathbf{G}\\, \\varphi]$ requires that the probability measure over infinite paths starting from a given state $s$ under scheduler $\\sigma$ assigns measure at least $p$ to those paths that satisfy $\\mathbf{G}\\, \\varphi$, i.e., those that remain in states satisfying the state predicate $\\varphi$ at all time indices. In our setting, $\\varphi$ is the predicate “safe”, satisfied exactly by states in the safe set $\\mathrm{Safe}$.\n\nFor a fixed scheduler $\\sigma$, the probability $\\mathbb{P}^{\\sigma}_{s}[\\mathbf{G}\\, \\mathrm{safe}]$ equals the measure of the set of infinite paths that never visit the unsafe state $fail$. In general, $\\mathbf{G}\\, \\mathrm{safe}$ is the complement of $\\mathbf{F}\\, \\mathrm{unsafe}$, where $\\mathbf{F}$ is the “eventually” operator; hence\n$$\n\\mathbb{P}^{\\sigma}_{s}[\\mathbf{G}\\, \\mathrm{safe}] \\;=\\; 1 \\;-\\; \\mathbb{P}^{\\sigma}_{s}[\\mathbf{F}\\, fail].\n$$\nIn the finite, absorbing structure given here, all trajectories starting from $s_{0}$ reach either $ok$ or $fail$ within at most $2$ steps, after which they remain there forever because $ok$ and $fail$ are absorbing. Consequently, the event “globally safe” coincides with “reach $ok$ without ever visiting $fail$”.\n\nPart $1$: Verification under the specified scheduler $\\sigma^{\\star}$.\n\nUnder $\\sigma^{\\star}$, the induced Markov chain has the following non-trivial transitions:\n- From $s_{0}$, action $a$ leads to $s_{1}$ with probability $\\frac{1}{2}$ and to $s_{2}$ with probability $\\frac{1}{2}$.\n- From $s_{1}$, action $c$ leads to $ok$ with probability $\\frac{255}{256}$ and to $fail$ with probability $\\frac{1}{256}$.\n- From $s_{2}$, action $e$ leads to $ok$ with probability $\\frac{511}{512}$ and to $fail$ with probability $\\frac{1}{512}$.\n\nBecause $ok$ and $fail$ are absorbing, the only way to violate $\\mathbf{G}\\, \\mathrm{safe}$ is to reach $fail$. The probability to satisfy $\\mathbf{G}\\, \\mathrm{safe}$ starting from $s_{0}$ is therefore the probability to go from $s_{0}$ to $ok$ without visiting $fail$, which here can happen in exactly two steps. Conditioning on the first transition from $s_{0}$:\n$$\n\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}]\n\\;=\\; \\frac{1}{2} \\cdot \\frac{255}{256} \\;+\\; \\frac{1}{2} \\cdot \\frac{511}{512}\n\\;=\\; \\frac{255}{512} \\;+\\; \\frac{511}{1024}\n\\;=\\; \\frac{510}{1024} \\;+\\; \\frac{511}{1024}\n\\;=\\; \\frac{1021}{1024}.\n$$\nSince $\\frac{1021}{1024} = 0.9970703125$, we have $\\mathbb{P}^{\\sigma^{\\star}}_{s_{0}}[\\mathbf{G}\\, \\mathrm{safe}] \\ge 0.99$, and the PCTL property $\\mathbb{P}_{\\ge 0.99}[\\mathbf{G}\\, \\mathrm{safe}]$ holds at $s_{0}$ under $\\sigma^{\\star}$.\n\nPart $2$: Minimal probability via Bellman equations for safety.\n\nWe now compute the minimal probability of satisfying the safety property over all schedulers. For safety properties, the worst-case (adversarial) satisfaction probability $v_{\\min}(s)$ is the least fixed-point solution of the following Bellman system, derived from one-step unfolding of the definition of path measures and scheduler quantification:\n- For unsafe $fail$, $v_{\\min}(fail) = 0$.\n- For absorbing safe $ok$, $v_{\\min}(ok) = 1$.\n- For other states $s \\in \\{s_{0}, s_{1}, s_{2}\\}$,\n$$\nv_{\\min}(s) \\;=\\; \\min_{a \\in A(s)} \\sum_{s' \\in S} P(s,a,s') \\, v_{\\min}(s').\n$$\nIntuitively, the minimization reflects the adversarial choice of actions that minimize the probability of remaining forever in the safe set.\n\nWe solve these equations by backward substitution, exploiting the acyclic structure (all non-absorbing states reach $ok$ or $fail$ in at most $2$ steps).\n\nFirst, at $s_{1}$ we have two actions:\n- Under $c$, $v_{\\min}(s_{1})$ would be $\\frac{255}{256} \\cdot v_{\\min}(ok) + \\frac{1}{256} \\cdot v_{\\min}(fail) = \\frac{255}{256} \\cdot 1 + \\frac{1}{256} \\cdot 0 = \\frac{255}{256}$.\n- Under $d$, $v_{\\min}(s_{1})$ would be $\\frac{31}{32} \\cdot v_{\\min}(ok) + \\frac{1}{32} \\cdot v_{\\min}(fail) = \\frac{31}{32}$.\nThus,\n$$\nv_{\\min}(s_{1}) \\;=\\; \\min \\left\\{ \\frac{255}{256}, \\frac{31}{32} \\right\\} \\;=\\; \\frac{31}{32}.\n$$\n\nSecond, at $s_{2}$:\n- Under $e$, $v_{\\min}(s_{2})$ would be $\\frac{511}{512}$.\n- Under $f$, $v_{\\min}(s_{2})$ would be $\\frac{15}{16}$.\nThus,\n$$\nv_{\\min}(s_{2}) \\;=\\; \\min \\left\\{ \\frac{511}{512}, \\frac{15}{16} \\right\\} \\;=\\; \\frac{15}{16}.\n$$\n\nFinally, at $s_{0}$:\n- Under $a$, $v_{\\min}(s_{0})$ would be\n$$\n\\frac{1}{2}\\, v_{\\min}(s_{1}) \\;+\\; \\frac{1}{2}\\, v_{\\min}(s_{2})\n\\;=\\; \\frac{1}{2} \\cdot \\frac{31}{32} \\;+\\; \\frac{1}{2} \\cdot \\frac{15}{16}\n\\;=\\; \\frac{1}{2} \\cdot \\left( \\frac{31}{32} + \\frac{30}{32} \\right)\n\\;=\\; \\frac{61}{64}.\n$$\n- Under $b$, $v_{\\min}(s_{0})$ would be\n$$\n\\frac{1}{3}\\, v_{\\min}(s_{1}) \\;+\\; \\frac{1}{3}\\, v_{\\min}(s_{2}) \\;+\\; \\frac{1}{3}\\, v_{\\min}(fail)\n\\;=\\; \\frac{1}{3} \\cdot \\frac{31}{32} \\;+\\; \\frac{1}{3} \\cdot \\frac{15}{16} \\;+\\; \\frac{1}{3} \\cdot 0\n\\;=\\; \\frac{1}{3} \\cdot \\left( \\frac{31}{32} + \\frac{30}{32} \\right)\n\\;=\\; \\frac{61}{96}.\n$$\nTherefore,\n$$\nv_{\\min}(s_{0}) \\;=\\; \\min \\left\\{ \\frac{61}{64}, \\frac{61}{96} \\right\\} \\;=\\; \\frac{61}{96}.\n$$\n\nThis value is the minimal probability, over all schedulers, of satisfying the safety property $\\mathbf{G}\\, \\mathrm{safe}$ from the initial state $s_{0}$. In exact fractional form,\n$$\nv_{\\min}(s_{0}) \\;=\\; \\frac{61}{96}.\n$$",
            "answer": "$$\\boxed{\\frac{61}{96}}$$"
        },
        {
            "introduction": "Our final practice tackles the complexity of hybrid systems, which feature an intricate interplay between discrete control logic and continuous physical dynamics. Verifying such systems, like the vehicle model in this problem, often involves translating the reachability question into a logical formula that can be decided by an automated tool. This exercise  guides you through the process of creating a Satisfiability Modulo Theories (SMT) encoding for a bounded-horizon safety problem, demonstrating how the question 'Can this unsafe state be reached?' can be answered by proving the (un)satisfiability of a set of mathematical constraints.",
            "id": "4250424",
            "problem": "Consider a digital twin of a longitudinal vehicle modeled as a hybrid automaton within the field of Cyber-Physical Systems (CPS). The hybrid automaton has two discrete modes, denoted by $M_0$ (Accelerate) and $M_1$ (Brake). The continuous state is $(x,v) \\in \\mathbb{R}^2$, where $x$ is position and $v$ is velocity. The continuous dynamics and invariants are:\n- In mode $M_0$: $\\dot{x} = v$, $\\dot{v} = a_{\\max}$ with $a_{\\max} = 2$, and invariant $v \\le v_{\\max}$ with $v_{\\max} = 10$.\n- In mode $M_1$: $\\dot{x} = v$, $\\dot{v} = -b_{\\max}$ with $b_{\\max} = 4$, and invariant $v \\ge 0$.\n\nThere is a single guard-enabled transition $M_0 \\to M_1$ with guard $x \\ge x_{\\mathrm{guard}}$ where $x_{\\mathrm{guard}} = 15$. No reverse transition is allowed within the time horizon considered. The initial set is the singleton $x(0) = 0$, $v(0) = 0$. The unsafe set is defined by the predicate $x \\ge X_U \\wedge v \\ge V_U$ where $X_U = 20$ and $V_U = 9$. The time budget is $T_U = 4$, and we consider a bounded-horizon reachability query allowing at most one discrete transition (i.e., at most one mode switch).\n\nThe task is to formalize, in Satisfiability Modulo Theories (SMT), a reachability query that asks whether there exists a run of this hybrid automaton with at most one switch and total elapsed time at most $T_U$ that reaches the unsafe set. Here, Satisfiability Modulo Theories (SMT) refers to the decision problem of the satisfiability of first-order formulas with respect to combinations of background theories (such as real arithmetic). The encoding must be sound with respect to the exact continuous dynamics given above (i.e., not a coarse under-approximation), using the closed-form solutions to the ordinary differential equations (ODEs) implied by constant acceleration and deceleration.\n\nSelect the option that correctly constructs such an SMT encoding and correctly explains how an UNSAT result from an SMT solver constitutes a proof of unreachability of the unsafe set within the given bounded horizon.\n\nA. Introduce existential nonnegative time variables $\\tau_0,\\tau_1 \\in \\mathbb{R}_{\\ge 0}$ and a Boolean $z \\in \\{0,1\\}$ that selects either a single continuous segment in $M_0$ ($z=0$) or a two-segment run in $M_0$ then $M_1$ ($z=1$). Encode the exact continuous flows and invariants using closed-form solutions and monotonicity over each segment:\n- Case $z=0$ (no switch, only $M_0$): $x_f = \\tfrac{1}{2} a_{\\max}\\tau_0^2$, $v_f = a_{\\max}\\tau_0$, $v_f \\le v_{\\max}$, $\\tau_0 \\le T_U$, and $x_f \\ge X_U \\wedge v_f \\ge V_U$.\n- Case $z=1$ ($M_0$ then $M_1$): $x_1 = \\tfrac{1}{2} a_{\\max}\\tau_0^2$, $v_1 = a_{\\max}\\tau_0$, $v_1 \\le v_{\\max}$, $x_1 \\ge x_{\\mathrm{guard}}$, then $x_f = x_1 + v_1\\tau_1 - \\tfrac{1}{2} b_{\\max}\\tau_1^2$, $v_f = v_1 - b_{\\max}\\tau_1$, $v_f \\ge 0$, and $\\tau_0 + \\tau_1 \\le T_U$, together with $x_f \\ge X_U \\wedge v_f \\ge V_U$. The overall formula is the disjunction of these two cases and is quantifier-free over nonlinear real arithmetic. Because the encoding is semantically equivalent to the bounded semantics of the hybrid automaton, an UNSAT result proves the unsafe set is unreachable within the bounded horizon.\n\nB. Use a single-step forward Euler discretization for the continuous dynamics with a fixed step size $\\Delta = T_U$: $x_f = x(0) + v(0)\\Delta$, $v_f = v(0) + a_{\\max}\\Delta$ for $M_0$, and $x_f = x(0) + v(0)\\Delta$, $v_f = v(0) - b_{\\max}\\Delta$ for $M_1$. Enforce invariants only at the final time $T_U$ and model the switch using $x(T_U) \\ge x_{\\mathrm{guard}}$. Conclude that if the resulting linear arithmetic constraints are UNSAT, then the unsafe set is unreachable for the true continuous dynamics.\n\nC. Encode the invariants by universal quantification over time: $\\forall t \\in [0,\\tau_0].\\, v(t) \\le v_{\\max}$ in $M_0$ and $\\forall t \\in [0,\\tau_1].\\, v(t) \\ge 0$ in $M_1$, but approximate the flows linearly as $x(t) = x(0) + v(0)t$, $v(t) = v(0) + a_{\\max}t$ in $M_0$ and $v(t) = v(0) - b_{\\max}t$ in $M_1$, with the guard $x(\\tau_0) \\ge x_{\\mathrm{guard}}$. Argue that even if the SMT solver returns UNSAT for this formula, it only establishes that the unsafe set is unreachable in the discretized model and may still be reachable in the exact continuous model.\n\nD. Encode the flows exactly but swap the sign of $b_{\\max}$ in braking (use $\\dot{v} = +b_{\\max}$), and enforce the guard as $x(\\tau_0) \\le x_{\\mathrm{guard}}$. State that a SAT result implies unreachability and an UNSAT result implies reachability, because the solver searches for counterexamples.\n\nOnly one option is correct.",
            "solution": "### Step 1: Extract Givens\n\nThe problem provides the following data and definitions for a hybrid automaton model of a longitudinal vehicle:\n-   **Discrete Modes**: $M_0$ (Accelerate), $M_1$ (Brake).\n-   **Continuous State**: $(x,v) \\in \\mathbb{R}^2$, where $x$ is position and $v$ is velocity.\n-   **Initial State**: $x(0) = 0$, $v(0) = 0$.\n-   **Mode $M_0$ (Accelerate)**:\n    -   Dynamics: $\\dot{x} = v$, $\\dot{v} = a_{\\max}$.\n    -   Constant: $a_{\\max} = 2$.\n    -   Invariant: $v \\le v_{\\max}$.\n    -   Constant: $v_{\\max} = 10$.\n-   **Mode $M_1$ (Brake)**:\n    -   Dynamics: $\\dot{x} = v$, $\\dot{v} = -b_{\\max}$.\n    -   Constant: $b_{\\max} = 4$.\n    -   Invariant: $v \\ge 0$.\n-   **Transition**: A single transition $M_0 \\to M_1$ is allowed. No reverse transition $M_1 \\to M_0$ is permitted.\n    -   Guard: $x \\ge x_{\\mathrm{guard}}$.\n    -   Constant: $x_{\\mathrm{guard}} = 15$.\n-   **Unsafe Set**: Defined by the predicate $x \\ge X_U \\wedge v \\ge V_U$.\n    -   Constants: $X_U = 20$, $V_U = 9$.\n-   **Bounded-Horizon Reachability Query**:\n    -   Time Budget: Total elapsed time is at most $T_U = 4$.\n    -   Switching Constraint: At most one discrete transition (from $M_0$ to $M_1$).\n-   **Task Requirement**: Formalize the reachability query in Satisfiability Modulo Theories (SMT) using closed-form solutions for the exact continuous dynamics. An UNSAT result from the SMT solver must constitute a proof of unreachability.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem statement is evaluated against the validation criteria:\n-   **Scientifically Grounded**: The problem uses a standard, simplified model of one-dimensional kinematics (constant acceleration/deceleration) which is a fundamental concept in physics. Hybrid automata are a well-established formalism in the field of Cyber-Physical Systems (CPS) and control theory. SMT is a standard technique for formal verification. The problem is scientifically and mathematically sound.\n-   **Well-Posed**: The problem is clearly defined. It specifies the complete dynamics of the hybrid automaton, including initial conditions, invariants, guard conditions, and all physical parameters. The reachability question is unambiguous, with a clear unsafe set and explicit bounds on time and the number of mode switches. This structure ensures that a specific, verifiable solution exists.\n-   **Objective**: The problem is stated in precise, objective mathematical and logical language. It is free from ambiguity, subjectivity, or opinion-based claims.\n\nThe problem statement has no flaws. It is not scientifically unsound, incomplete, contradictory, or ill-posed. It is a standard problem in the formal verification of hybrid systems.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. A solution will be derived.\n\n### Derivation of the Correct SMT Encoding\n\nThe task is to determine if there exists a trajectory of the system, with a total duration of at most $T_U=4$ and at most one mode switch, that starts at $(x,v)=(0,0)$ and enters the unsafe set defined by $x \\ge 20 \\wedge v \\ge 9$. This can be encoded as an SMT formula over non-linear real arithmetic. The encoding must be exact, using the closed-form solutions of the differential equations.\n\nTwo scenarios are possible under the \"at most one switch\" constraint:\n1.  **Zero switches**: The system evolves entirely in mode $M_0$.\n2.  **One switch**: The system evolves in $M_0$ for some duration, then transitions to $M_1$ and evolves for another duration.\n\nLet $\\tau_0$ be the time spent in mode $M_0$ and $\\tau_1$ be the time spent in mode $M_1$. Both must be non-negative real numbers, $\\tau_0 \\ge 0, \\tau_1 \\ge 0$.\n\n#### Case 1: Zero switches (trajectory in $M_0$ only)\n\nIn this case, $\\tau_1=0$. The system evolves in $M_0$ for a duration $\\tau_0$.\n-   Initial conditions: $x(0)=0$, $v(0)=0$.\n-   Dynamics in $M_0$: $\\dot{v} = a_{\\max} = 2$, $\\dot{x}=v$.\n-   Integrating the dynamics gives the state at time $t \\in [0, \\tau_0]$:\n    -   $v(t) = v(0) + a_{\\max} t = 2t$\n    -   $x(t) = x(0) + \\int_0^t v(s) ds = \\int_0^t 2s \\, ds = t^2$\n-   Let the final state be at time $\\tau_0$, denoted $(x_f, v_f)$. Thus, $x_f = \\tau_0^2$ and $v_f = 2\\tau_0$.\n-   The constraints for a valid, unsafe trajectory are:\n    1.  Time budget: $\\tau_0 \\le T_U \\implies \\tau_0 \\le 4$.\n    2.  Invariant in $M_0$: $v(t) \\le v_{\\max}$ for all $t \\in [0, \\tau_0]$. Since $v(t)=2t$ is monotonically increasing, this is satisfied if $v(\\tau_0) \\le v_{\\max} \\implies 2\\tau_0 \\le 10$.\n    3.  Unsafe condition: The final state must be in the unsafe set: $x_f \\ge X_U \\wedge v_f \\ge V_U \\implies \\tau_0^2 \\ge 20 \\wedge 2\\tau_0 \\ge 9$.\n    Since both $x(t)$ and $v(t)$ are non-decreasing in this mode, if the unsafe set is reached at any time $t \\in [0, \\tau_0]$, it is also reached at time $\\tau_0$. Thus, checking at the endpoint is sufficient.\n\nThe SMT formula for this case is the conjunction of these constraints on the existential variable $\\tau_0 \\ge 0$.\n\n#### Case 2: One switch ($M_0 \\to M_1$)\n\nThe system evolves in $M_0$ for duration $\\tau_0$, switches, and then evolves in $M_1$ for duration $\\tau_1$.\n-   **Segment 1 (Mode $M_0$ for time $\\tau_0$)**:\n    -   State at switching time $\\tau_0$, denoted $(x_1, v_1)$:\n        -   $v_1 = a_{\\max} \\tau_0 = 2\\tau_0$.\n        -   $x_1 = \\frac{1}{2} a_{\\max} \\tau_0^2 = \\tau_0^2$.\n    -   Invariant check in $M_0$: $v_1 \\le v_{\\max} \\implies 2\\tau_0 \\le 10$.\n    -   Guard condition check: $x_1 \\ge x_{\\mathrm{guard}} \\implies \\tau_0^2 \\ge 15$.\n-   **Segment 2 (Mode $M_1$ for time $\\tau_1$)**:\n    -   The system starts this segment from state $(x_1, v_1)$. The state at a relative time $t' \\in [0, \\tau_1]$ within this segment is:\n        -   $v(t') = v_1 - b_{\\max}t' = 2\\tau_0 - 4t'$.\n        -   $x(t') = x_1 + v_1 t' - \\frac{1}{2}b_{\\max} (t')^2 = \\tau_0^2 + (2\\tau_0)t' - 2(t')^2$.\n    -   Let the final state be at time $\\tau_1$ into the segment, denoted $(x_f, v_f)$:\n        -   $v_f = 2\\tau_0 - 4\\tau_1$.\n        -   $x_f = \\tau_0^2 + 2\\tau_0\\tau_1 - 2\\tau_1^2$.\n-   The overall constraints for this case are:\n    1.  Time budget: $\\tau_0 + \\tau_1 \\le T_U \\implies \\tau_0 + \\tau_1 \\le 4$.\n    2.  Invariant in $M_1$: $v(t') \\ge 0$ for all $t' \\in [0, \\tau_1]$. Since $v(t')$ is monotonically decreasing, this holds if $v_f \\ge 0 \\implies 2\\tau_0 - 4\\tau_1 \\ge 0$.\n    3.  Unsafe condition: The final state must be in the unsafe set: $x_f \\ge X_U \\wedge v_f \\ge V_U \\implies (\\tau_0^2 + 2\\tau_0\\tau_1 - 2\\tau_1^2 \\ge 20) \\wedge (2\\tau_0 - 4\\tau_1 \\ge 9)$.\n    Note: Both $v$ and $x$ are non-decreasing over the entire trajectory (in $M_1$, $v \\ge 0$ is an invariant, so $\\dot{x}=v \\ge 0$), so checking for reachability at the final time of the run is sufficient.\n\nThe SMT formula for this case is the conjunction of all constraints for Segment 1 and Segment 2 on the existential variables $\\tau_0 \\ge 0, \\tau_1 \\ge 0$.\n\n#### Overall SMT Formula and Interpretation\n\nThe complete SMT query for reachability is the disjunction (logical OR) of the formulas for Case 1 and Case 2. This is a quantifier-free formula over non-linear real arithmetic (QF_NRA).\n-   If the solver finds values for $\\tau_0$ and/or $\\tau_1$ that satisfy either set of constraints, it returns SAT. This corresponds to a concrete trajectory that reaches the unsafe set.\n-   If the solver proves that no such values exist, it returns UNSAT. Because the encoding is an exact representation of all possible trajectories under the problem's constraints, an UNSAT result is a formal proof that the unsafe set is unreachable.\n\n### Option-by-Option Analysis\n\n**A. Introduce existential nonnegative time variables ...**\nThis option describes the exact encoding derived above.\n-   It correctly models the two scenarios (zero or one switch) using a selector variable $z$ (or implicitly, a disjunction).\n-   It uses the correct closed-form solutions for position and velocity in both modes, starting from the correct initial/intermediate conditions: $x_f = \\frac{1}{2} a_{\\max}\\tau_0^2$, $v_f = a_{\\max}\\tau_0$ for Case 1, and $x_f = x_1 + v_1\\tau_1 - \\frac{1}{2}b_{\\max}\\tau_1^2$, $v_f = v_1 - b_{\\max}\\tau_1$ for Case 2.\n-   It correctly enforces all constraints: time budget, invariants (leveraging monotonicity), the guard, and the unsafe set condition.\n-   Its explanation of the formula type (quantifier-free over nonlinear real arithmetic) is correct.\n-   Its conclusion that an UNSAT result proves unreachability due to the semantic equivalence of the encoding is correct and is the central point of this verification method.\n\nVerdict: **Correct**.\n\n**B. Use a single-step forward Euler discretization ...**\nThis option proposes using an approximation method (single-step Euler with a large step size $\\Delta = T_U$).\n-   First, this directly violates the problem's requirement to use \"exact continuous dynamics\" and \"closed-form solutions\".\n-   Second, such a crude approximation (e.g., $x_f = x(0) + v(0)\\Delta = 0$) is grossly inaccurate and does not correctly represent the system's behavior.\n-   Third, the conclusion that UNSAT for an approximate model proves unreachability for the exact model is generally false. Such a conclusion is only valid if the approximation is a guaranteed over-approximation of the reachable set, which is not the case for a simple Euler step.\n\nVerdict: **Incorrect**.\n\n**C. Encode the invariants by universal quantification ... but approximate the flows linearly ...**\nThis option has multiple flaws.\n-   It proposes approximating the position flow as linear: $x(t) = x(0) + v(0)t$. This is fundamentally incorrect for constant acceleration, where the flow is quadratic. The correct formula is $x(t) = x(0) + v(0)t + \\frac{1}{2} at^2$.\n-   By proposing a flawed, approximate model, it fails to meet the problem's requirement for an exact encoding.\n-   The conclusion that UNSAT for this model does not guarantee unreachability for the exact model is true, but this only highlights why the proposed method is inadequate for the task of *proving* unreachability.\n\nVerdict: **Incorrect**.\n\n**D. Encode the flows exactly but swap the sign of $b_{\\max}$ ... and enforce the guard as $x(\\tau_0) \\le x_{\\mathrm{guard}}$ ...**\nThis option contains several critical errors.\n-   `swap the sign of $b_{\\max}$`: Using $\\dot{v} = +b_{\\max}$ for braking is physically incorrect. It models acceleration, not deceleration.\n-   `enforce the guard as $x(\\tau_0) \\le x_{\\mathrm{guard}}`**: This is the inverse of the guard's logic. A guard $x \\ge x_{\\mathrm{guard}}$ *enables* a transition when the condition is met.\n-   `State that a SAT result implies unreachability and an UNSAT result implies reachability`: This logic is reversed. For a formula encoding reachability, SAT means reachable and UNSAT means unreachable.\n\nVerdict: **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}