## 引言
随着计算与物理过程在网络物理系统（CPS）中的日益融合，系统能力得到空前提升，但也引入了复杂的安全漏洞，使得数字威胁可能导致灾难性的物理后果。传统的IT安全[威胁建模](@entry_id:924842)方法已不足以应对这些挑战，因为它们常常忽略了物理“被控对象”的关键动态特性，从而无法识别基于物理原理的严重攻击向量。本文旨在为CPS提供一个全面、系统的[结构化威胁建模](@entry_id:1132567)指南。

我们将从三个层面深入探讨该主题。第一章“原理与机制”，将奠定理论基础，阐明“被控对象感知”安全分析的核心原则，并介绍STAMP/STPA等[系统论](@entry_id:265873)方法。第二章“应用与跨学科联系”，将展示这些原则如何在工业控制、[自动驾驶](@entry_id:270800)等实际系统中落地，并揭示其与控制理论、安全工程等学科的深刻联系。最后，在“动手实践”部分，读者将通过具体问题演练，将理论知识转化为实践技能。通过这一结构化的学习路径，本文旨在帮助读者建立起一套严谨的[CPS安全](@entry_id:1131376)分析框架。

## 原理与机制

本章深入探讨了网络物理系统（Cyber-Physical Systems, CPS）[结构化威胁建模](@entry_id:1132567)的核心原理与关键机制。在前一章介绍背景的基础上，本章将从第一性原理出发，系统地阐述定义[CPS安全](@entry_id:1131376)问题的独特形式，并介绍用于识别、分析和评估威胁的系统化方法。我们将通过一系列具体的思想实验和案例，揭示将计算与物理过程分离开来进行安全分析的内在局限性，并建立一个整合了控制理论、实时系统和安全工程的严谨框架。

### CPS的形式化定义与安全范式

要对CPS进行威胁建模，首先必须精确理解其本质。一个CPS并不仅仅是任何带有软件和传感器的物理设备。其核心特征在于**计算、通信与物理动态通过闭环反馈的紧密耦合**。 这种耦合是定义[CPS安全](@entry_id:1131376)问题的基石。

从形式上看，一个CPS的物理过程（或称“被控对象”）通常可以用一组[微分](@entry_id:158422)或[差分方程](@entry_id:262177)来描述。例如，一个[连续时间系统](@entry_id:276553)的动态可以表示为[状态空间](@entry_id:160914)形式：

$$
\dot{x}(t) = f(x(t), u(t), w(t))
$$

其中，$x(t)$ 是系统的物理[状态向量](@entry_id:154607)（如温度、位置、压力），$u(t)$ 是由控制器施加的控制输入向量（如阀门开度、电机电压），而 $w(t)$ 代表外部扰动。系统的传感器则通过一个测量函数来感知物理状态：

$$
y(t) = h(x(t), v(t))
$$

这里的 $y(t)$ 是传感器输出，而 $v(t)$ 代表[测量噪声](@entry_id:275238)。控制器——CPS的“网络”或“计算”部分——根据传感器测量值（或基于其得到的估计状态 $\hat{x}(t)$）和参考设定点 $r(t)$ 来计算控制输入：

$$
u(t) = \pi(\hat{x}(t), r(t))
$$

这个控制策略 $\pi$ 由软件实现，并通过网络传输至执行器，最终作用于物理世界。

这个闭环结构（物理过程 $\rightarrow$ 传感器 $\rightarrow$ 控制器 $\rightarrow$ 执行器 $\rightarrow$ 物理过程）意味着网络世界的事件与物理世界的后果之间存在着直接的因果通路。因此，**[结构化威胁建模](@entry_id:1132567) (Structured Threat Modeling, STM)** 在CPS背景下，必须是一种**基于模型的安全分析方法**。它不能仅仅是罗列软件漏洞（如通用漏洞披露 CVEs）或进行非结构化的风险头脑风暴。一个严谨的STM过程必须从一个能够描述整个闭-环系统的模型出发，该模型需包含上述所有元素：被控对象动态 $f$、测量过程 $h$、控制策略 $\pi$、以及执行器、传感器和网络的物理与时间约束。威胁场景的推导必须明确地与违反物理约束、控制目标或安全不变式（例如，一个形式化为 $I(x,u)$ 的约束）联系起来。

### 基本原则：被控对象感知(Plant-Aware)的安全性分析

[CPS安全](@entry_id:1131376)分析最根本的原则是**被控对象感知 (plant-aware)**，即任何有效的威胁模型都必须将物理过程的动态特性纳入考量。忽略被控对象动态，将其视为一个简单的“输入-输出”黑盒，是[CPS安全](@entry_id:1131376)分析中最常见且最危险的错误。

一个典型的例子是共振攻击。设想一个工业CPS中的单自由度运动轴，其物理动态可以通过一个[二阶线性常微分方程](@entry_id:189146)来精确近似 ：

$$
\ddot{x}(t) + 2 \zeta \omega_n \dot{x}(t) + \omega_n^2 x(t) = \omega_n^2 u(t)
$$

这里，$x(t)$ 是位移，$u(t)$ 是指令输入，$\omega_n$ 是系统的[固有频率](@entry_id:174472)，$\zeta$ 是[阻尼比](@entry_id:262264)。假设系统的安全要求是位移必须始终保持在安全范围内，即 $|x(t)| \le x_{\mathrm{safe}}$。

一个攻击者若能进行执行器指令注入，便可产生一个[正弦输入](@entry_id:269486)信号 $u(t) = u_0 \sin(\omega t)$。如果[威胁建模](@entry_id:924842)团队采用一个**被控对象无关 (plant-agnostic)** 的方法，他们可能会做出一个简化的、看似合理的静态假设，例如输出约等于输入，即 $|x(t)| \approx |u(t)|$。基于此模型，他们会得出结论：只要攻击者注入的信号幅值 $u_0$ 小于 $x_{\mathrm{safe}}$，系统就是安全的。

然而，这个结论是完全错误的。根据[线性系统理论](@entry_id:172825)，当输入频率 $\omega$ 接近系统的[固有频率](@entry_id:174472) $\omega_n$ 时，系统会发生**共振**。对于一个[正弦输入](@entry_id:269486)，系统的[稳态](@entry_id:139253)输出幅值 $X$ 是输入幅值 $u_0$ 乘以系统在频率 $\omega$ 处的增益 $|G(j\omega)|$。当 $\omega = \omega_n$ 时，这个增益为：

$$
|G(j\omega_n)| = \frac{1}{2\zeta}
$$

假设系统参数为 $\omega_n = 10 \ \mathrm{rad/s}$，$\zeta = 0.05$（一个典型的轻阻尼系统），$x_{\mathrm{safe}} = 1 \ \mathrm{m}$。攻击者注入一个幅值仅为 $u_0 = 0.1 \ \mathrm{m}$ 的信号。根据被控对象无关的模型，预测的最大位移仅为 $0.1 \ \mathrm{m}$，远低于安全阈值 $1 \ \mathrm{m}$，因此不会识别出任何危险。

然而，真实的物理响应是，攻击者将输入频率调至 $\omega = \omega_n = 10 \ \mathrm{rad/s}$。此时，系统的增益为 $\frac{1}{2 \times 0.05} = 10$。因此，实际的[稳态](@entry_id:139253)位移幅值为：

$$
X = u_0 |G(j\omega_n)| = (0.1 \ \mathrm{m}) \times 10 = 1.0 \ \mathrm{m}
$$

这个幅值恰好达到了安全边界 $x_{\mathrm{safe}}$，构成了一个严重的安全风险。一个看似微不足道的网络层输入，通过利用物理动态，被放大了十倍，从而导致了物理世界的危险状态。这个例子无可辩駁地证明了，任何声称“完整”的CPS威胁模型，如果忽略了被控对象的动态特性，都必然是不完整的，因为它会漏掉这类依赖于频率的、可能导致灾难性后果的攻击。

### [结构化威胁建模](@entry_id:1132567)的核心概念

基于被控对象感知的原则，我们可以构建一套用于[CPS威胁建模](@entry_id:1133108)的核心概念。

#### 将风险定义为物理损失的期望

在CPS中，风险不能简单地用信息技术领域的指标（如CVSS评分）来衡量。风险必须被量化为**物理损失的[期望值](@entry_id:150961)**。这需要一个能够连接网络事件和物理后果的数学框架。

我们可以将风险 $R$ 定义为关于一系列危险后果 $h \in H$ 的预期损失。每个危险后果 $h$（例如，温度超限、机械臂碰撞）都有一个相关的损失函数 $\ell(h)$。网络世界的攻击事件 $c \in C$（例如，[传感器欺骗](@entry_id:1131487)、控制器[代码注入](@entry_id:747437)）以一定的概率 $p(c)$ 发生。一个网络事件 $c$ 是否能导致一个物理危险 $h$，取决于它是否能通过CPS的闭环动态成功传播，这个传播的概率我们记为 $p(h \mid c)$。

根据[期望值](@entry_id:150961)的定义和[全概率公式](@entry_id:911633)，CPS的风险可以严谨地表示为：

$$
R = \mathbb{E}[\ell(h)] = \sum_{c \in C} p(c) \sum_{h \in H} p(h \mid c) \, \ell(h)
$$

这个公式的精髓在于条件概率 $p(h \mid c)$。这个值完全由系统的闭环动态（即前述的 $f, h, \pi$ 等）决定，它捕捉了**网络-物理传播 (cyber-to-physical propagation)** 的过程。一个高C[VSS](@entry_id:635952)评分的漏洞，如果其影响在物理动态中被抑制或衰减，那么它对物理风险的贡献可能很小。相反，一个看似轻微的网络扰动，如果能触发共振等放大效应，则可能导致巨大的物理风险。因此，像[数字孪生](@entry_id:171650)这样的高保真仿真模型对于估计 $p(h \mid c)$ 至关重要。

#### CPS资产分类：将安全功能视为一等资产

[威胁建模](@entry_id:924842)始于识别需要保护的**资产**。在CPS中，资产的范畴必须超越传统IT的范畴。一个全面的CPS资产分类法应包含三个类别 ：

1.  **网络资产 (Cyber Artifacts)**：包括软件、固件、配置文件、[数字孪生](@entry_id:171650)模型、数据管道、通信协议等。
2.  **物理组件 (Physical Components)**：包括传感器、执行器、机械结构、电源、线路等。
3.  **安全功能 (Safety Functions)**：这是一个关键的、CPS特有的资产类别。安全功能是指那些用于 enforcing 安全约束以防止系统进入危险状态的控制或监控功能。例如，紧急停止逻辑、安全联锁、速度限制器等。

将安全功能视为一等资产是至关重要的。从第一性原理出发，资产是指任何其受损会导致任务失败、违反安全约束或改变系统价值的元素。安全功能的设计目标正是为了 enforcing 安全不变式 $I(x)$，从而将系统状态限定在安全区域内，避免其进入危险状态集 $\mathcal{H}$。

攻击者的目标是最大化风险 $R = \mathbb{E}[L]$。一个直接的策略就是增加系统进入危险状态的概率 $\mathbb{P}(x \in \mathcal{H})$。如果攻击者能够破坏一个安全功能（例如，通过篡改其逻辑（[完整性攻击](@entry_id:1126561)）或使其失效（可用性攻击）），他们就打开了通往危险状态的路径。因此，破坏安全功能是实现攻击目标、增加物理风险的直接手段。正因为安全功能对防御者有降低风险的价值，所以它对攻击者就有破坏它以增加风险的价值。因此，安全功能完全符合资产的定义，必须在威胁模型中作为核心保护对象加以分析。

#### 在[实时约束](@entry_id:754130)下理解CIA三元组

信息安全的经典**CIA三元组**（[机密性、完整性、可用性](@entry_id:1122869)）在CPS中依然适用，但其内涵和权重发生了深刻变化，特别是**可用性 (Availability)**。

在传统IT系统中，可用性通常指服务的正常运行时间或平均[响应时间](@entry_id:271485)。但在CPS中，尤其是在具有硬[实时约束](@entry_id:754130)的控制回路中，可用性的定义变得极其严格：它要求**每一次控制计算和操作都必须在其指定的硬截止时间 (deadline) 内完成**。错过一次截止时间就可能构成一次系统故障，因为过时的控制指令可能导致系统不稳定或进入危险状态。

这就引发了**完整性 (Integrity)** 与 **可用性** 之间的根本性权衡。为了保证消息的完整性以抵御欺骗和篡改威胁，我们通常会引入加密措施，如消息认证码 (Message Authentication Code, MAC)。然而，生成和验证MAC会消耗计算资源，增加消息长度也会增加传输时间。这些安全开销会挤占本已紧张的时间预算。

考虑一个[网络控制](@entry_id:275222)回路，其[采样周期](@entry_id:265475)和硬截止时间均为 $T = 10 \ \mathrm{ms}$。假设回路中的固有延迟（包括传感、网络传输、控制器计算和驱动）总的最坏情况为 $7.0 \ \mathrm{ms}$，并为网络[抖动](@entry_id:200248)保留了 $0.5 \ \mathrm{ms}$ 的预算。那么，可用于安全措施的剩余时间裕量为：

$$
\text{Slack} = 10.0 - (7.0 + 0.5) = 2.5 \ \mathrm{ms}
$$

现在，假设我们考虑两种[MAC方案](@entry_id:165701)来增强完整性：
- **標準HMAC**：引入 $2.4 \ \mathrm{ms}$ 的计算开销和 $0.8 \ \mathrm{ms}$ 的序列化开销，总开销为 $3.2 \ \mathrm{ms}$。
- **轻量级MAC**：引入 $1.0 \ \mathrm{ms}$ 的计算开销和 $0.2 \ \mathrm{ms}$ 的序列化开销，总开销为 $1.2 \ \mathrm{ms}$。

显然，$3.2 \ \mathrm{ms} > 2.5 \ \mathrm{ms}$。如果采用标准HMAC，最坏情况下的端到端延迟将达到 $7.5 + 3.2 = 10.7 \ \mathrm{ms}$，超过了 $10 \ \mathrm{ms}$ 的硬截止时间。这将导致可用性丧失，可能引发物理危险。相比之下，轻量级MAC的开销 $1.2 \ \mathrm{ms}$ 在时间裕量之内，它在提供完整性保护的同时，也保证了系统的实时可用性。这个例子清晰地表明，在CPS中，安全解决方案的设计不能脱离系统的实时动态约束。有时，为了保证基本的可用性（即稳定性），我们可能不得不选择一个强度较低但开销更小的完整性机制。

### 系统化的威胁识别与分析

有了上述核心原理，我们现在可以探索系统化地识别和分析威胁的具体机制。

#### 映射攻击面：分层架构与信任边界

CPS，特别是[工业控制系统](@entry_id:1126469)（ICS），通常采用分层架构来组织。一个典型的模型（类似于[普渡模型](@entry_id:1130311)）将系统分为以下几个层次 ：

- **L0 (现场层)**：直接与物理过程交互的设备，如传感器和执行器。
- **L1 (控制层)**：执行[实时控制](@entry_id:754131)逻辑的设备，如[可编程逻辑](@entry_id:164033)控制器 (PLC)。
- **L2 (监控层)**：进行监控和数据采集的系统，如SCADA和[人机界面](@entry_id:904987) (HMI)。
- **L3 (企业层)**：企业IT系统，用于数据分析和业务规划。

**攻击面 (Attack Surface)** 是攻击者可以与系统交互、施加影响的所有接口、入口点和暴露功能的集合。对CPS进行[结构化威胁建模](@entry_id:1132567)的一个关键步骤，就是系统地枚举每个层次及其互联链路上的攻击面。

- 在**L0**，攻击面包括物理信号线路（如可被注入信号的4–20 mA电流环）、智能设备的维护端口和通信协议（如HART）、以及现场总线（如Modbus RTU）的物理接线。
- 在**L1**，攻击面包括PLC的编程接口（USB、[以太](@entry_id:275233)网）、用于下载梯形图或功能块的工程协议、PLC固件更新机制、以及暴露在网络上的工业协议（如Modbus TCP, EtherNet/IP）。
- 在**L2**，攻击面包括HMI的操作员认证、SCADA服务器上运行的服务（历史数据库、报警服务器）、Web HMI的前端漏洞、以及远程访问机制（如RDP）。
- 在**L3-L2边界**，攻击面主要体现在隔离区（DMZ）及其防火墙规则，以及用于远程访问的VPN和跳板机。
- 在**L3**，企业网络中的任何一台被攻陷的计算机都可能成为攻击者向运营技术（OT）网络横向移动的跳板。

这种分层枚举提供了一个结构化的“地图”，用于系统地发现潜在的攻击路径，而不是随机猜测。

#### 信任边界的形式化

**信任边界 (Trust Boundary)** 是系统中信任假设发生变化的地方。在上述[分层模型](@entry_id:274952)中，层与层之间的接口就是非正式的信任边界。为了进行更严谨的分析，我们可以对信任边界进行形式化定义。

我们可以将CPS模型化为一个图 $G = (V, E)$，其中顶点 $V$ 代表组件，边 $E$ 代表通信信道。我们可以为每条边 $e \in E$ 定义一个信任属性向量 $P(e)$，该向量捕捉了我们对该信道上通信的信任假设。例如，这个向量可以包含三个布尔谓词：

- **完整性 $I(e)$**: 如果边 $e$ 上的所有消息都受到有效MAC的保护，则为1，否则为0。
- **时效性 $T(e)$**: 如果边 $e$ 的最坏情况延迟和[抖动](@entry_id:200248)在规定界限内，则为1，否则为0。
- **授权性 $A(e)$**: 如果边 $e$ 上的机制能有效阻止未经授权的源向执行器发送命令，则为1，否则为0。

这样，每条边都被标记上一个信任向量 $P(e) = (I(e), T(e), A(e)) \in \{0,1\}^3$。这个标记过程自然地将边的集合 $E$ **划分**为最多 $2^3=8$ 个区域，每个区域内的所有边具有完全相同的信任属性。

信任边界此时可以被严谨地定义为：**任何两个共享一个顶点且信任向量不同的相邻边之间的接口**。这个[形式化方法](@entry_id:1125241)使得信任边界不再是一个模糊的概念，而是模型中一个可被精确识别和分析的结构。它指出了[安全控制](@entry_id:1131181)必须被部署的确切位置——即信任属性发生降级（如从1变为0）的边界处。

#### CPS特有的威胁类别

除了传统的网络攻击，CPS还面临着利用其物理特性的独特威胁。

- **时序攻击 (Timing Attacks)**: 如前所述，CPS的正确性依赖于时间。攻击者可以不篡改数据内容，而仅仅通过操纵数据的**时间**来破坏系统。这包括：
    - **延迟攻击 (Delay Attack)**：向通信信道中注入固定的额[外延](@entry_id:161930)迟，降低系统的[相位裕度](@entry_id:264609)，可能导致振荡或不稳定。
    - **[抖动](@entry_id:200248)攻击 (Jitter Attack)**：引入时变的延迟，使得采样间隔不均匀，这会干扰[数字控制](@entry_id:275588)器的性能。
    - **去同步攻击 (Desynchronization Attack)**：通过操纵时钟同步协议，使系统中不同组件的时间基准产生偏移或漂移。这会使依赖于时间戳的数据（如状态估计）失效。
    
    这些攻击将网络层的时间违规，直接转化为物理层的危险（如超调或失稳）。

- **供应链威胁 (Supply Chain Threats)**: CPS设备漫长的生命周期和复杂的供应链使其极易受到供应链攻击。这些威胁在设备部署到 OT 网络之前就已经潜入。关键类别包括：
    - **伪劣/仿冒组件 (Counterfeit Components)**：在生产过程中使用未经认证或 substandard 的硬件（如微控制器、传感器），可能导致性能不可靠或包含[硬件木马](@entry_id:1125920)。威胁源头在组件供应[商域](@entry_id:154960)（信任边界 $b_1$）。
    - **恶意固件 (Malicious Firmware)**：固件在开发阶段（$b_2$）被植入后门，或在交付给代工厂（$b_3$）的过程中被篡改。
    - **受损工具链 (Compromised Tooling)**：开发阶段的编译器（$b_2$）或生产阶段的烧录工具（$b_3$）被攻击者篡改，使其在处理合法代码或固件时自动注入恶意负载。

    这些威胁的共同点是它们跨越了多个信任边界（供应商 $\rightarrow$ 开发商 $\rightarrow$ 集成商 $\to$ 最终用户），使得检测和溯源极为困难。

### [系统论](@entry_id:265873)方法论：STAMP 与 STPA-Sec

最后，为了整合上述所有原理和机制，我们需要一个顶层的、系统化的分析方法论。传统的安全分析方法如故障模式与影响分析 (FMEA) 和[故障树分析](@entry_id:1124863) (FTA) 主要关注**组件失效**。它们试图通过分析“哪个组件会坏”以及“它坏了会怎样”来理解系统风险。

然而，在复杂的CPS中，许多灾难性事故的发生并非源于任何组件的“失效”，而是源于系统设计本身存在的缺陷，导致组件之间发生了**不安全的交互**，即使每个组件都“正常”工作。

**[系统论](@entry_id:265873)事故模型与过程 (Systems-Theoretic Accident Model and Processes, STAMP)** 提供了一个全新的范式。它将安全（和安防）视为一个**控制问题**，而非可靠性问题。 在STAMP框架下，事故被定义为“由于 safety constraints 未能被有效 enforcing 而导致的损失”。

基于STAMP的 hazard analysis technique, **[系统论](@entry_id:265873)过程分析 (System-Theoretic Process Analysis, STPA)**，提供了一套具体的分析步骤：
1.  **定义损失和系统级危险**：识别不可接受的系统级损失（如人员伤亡、环境破坏）以及可能导致这些损失的系统状态（危险）。
2.  **构建控制结构**：绘制出系统的分层控制结构图，包含控制器、被控过程、传感器和执行器，以及它们之间的控制指令和反馈信道。
3.  **识别不安全控制行为 (Unsafe Control Actions, UCAs)**：对于每个控制器，分析哪四类控制行为可能导致危险：
    - 提供了会导致危险的控制指令。
    - 未能提供必要的控制指令来避免危险。
    - 提供了时序不当（过早、过晚）的控制指令。
    - 控制指令的持续时间不当（过长、过短）。
4.  **识别原因场景**：分析控制回路，找出可能导致UCAs发生的原因。这不仅仅是组件故障，更包括：
    - 控制器算法的缺陷。
    - 反馈通路的问题（如传感器测量不准、延迟）。
    - 控制器所依赖的 process model 不准确。

**STPA-Sec** 是STPA在[网络安全](@entry_id:262820)领域的扩展。它将攻击者视为一个智能的、能够扰乱控制回路的外部因素。分析过程与STPA类似，但增加了识别攻击者如何通过操纵控制指令或反馈信息来故意引发UCAs的步骤。

STAMP和STPA-Sec的强大之处在于，它们迫使分析师从系统整体的、动态的、交互的视角出发，去思考安全是如何“涌现”或“丧失”的，而不是局限于静态的组件故障列表。这种方法论与CPS的本质——即计算与物理动态的紧密耦合——完美契合，为[结构化威胁建模](@entry_id:1132567)提供了坚实的理论基础。