{
    "hands_on_practices": [
        {
            "introduction": "The conservation of mass is a foundational pillar of fluid dynamics. This exercise provides a fundamental practice by deriving the differential form of the continuity equation from its physical, integral statement, a crucial step in formulating CFD models . By applying this derived equation to a specific velocity field, you will gain hands-on experience in evaluating the incompressibility condition, $\\nabla \\cdot \\mathbf{u} = 0$, a property that profoundly impacts the numerical strategy for solving fluid flows.",
            "id": "4209477",
            "problem": "A Digital Twin (DT) of a Cyber-Physical System (CPS) is being validated against mass conservation for a two-dimensional computational fluid dynamics (CFD) surrogate velocity field. Consider the velocity field given by $\\mathbf{u}(x,y) = (ax, -ay)$, where $a$ is a constant with dimensions of $\\text{s}^{-1}$, and the fluid density $\\rho$ is spatially uniform and constant in time. Starting from the integral statement of mass conservation for an arbitrary fixed control volume, derive the local differential form of the continuity equation. Then evaluate $\\nabla \\cdot \\mathbf{u}$ and use your derivation to assess whether the flow is incompressible under the stated conditions. Provide your computed value of $\\nabla \\cdot \\mathbf{u}$ expressed in $\\text{s}^{-1}$. No rounding is required; report the exact value.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- Velocity field: $\\mathbf{u}(x,y) = (ax, -ay)$\n- Constant: $a$ with dimensions of $\\text{s}^{-1}$\n- Fluid density: $\\rho$ is spatially uniform and constant in time.\n- Task 1: Start from the integral statement of mass conservation for an arbitrary fixed control volume and derive the local differential form of the continuity equation.\n- Task 2: Evaluate $\\nabla \\cdot \\mathbf{u}$.\n- Task 3: Use the derivation to assess whether the flow is incompressible.\n- Task 4: Provide the computed value of $\\nabla \\cdot \\mathbf{u}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is based on the fundamental principle of mass conservation in fluid dynamics (the continuity equation) and uses a standard, physically realistic velocity field (stagnation-point flow). The context of CFD for Digital Twins is appropriate. The problem is scientifically sound.\n- **Well-Posedness**: The problem provides all necessary information to perform the requested derivation and calculation. The objectives are clear, and a unique, meaningful solution exists.\n- **Objectivity**: The problem is stated using precise, objective, and technical language.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A full solution will be provided.\n\n**Derivation of the Differential Form of the Continuity Equation**\n\nThe principle of mass conservation states that for any arbitrary control volume $V$ fixed in space, with a boundary surface $S$, the rate of increase of mass within the volume must equal the net rate of mass flow into the volume. This is expressed in integral form as:\n$$\n\\frac{d}{dt} \\int_V \\rho \\, dV = - \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS\n$$\nwhere $\\rho$ is the fluid density, $\\mathbf{u}$ is the velocity field, and $\\mathbf{n}$ is the outward-pointing unit normal vector to the surface element $dS$. Rearranging gives the standard form:\n$$\n\\frac{d}{dt} \\int_V \\rho \\, dV + \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS = 0\n$$\n\nThe first term represents the rate of change of mass inside the control volume, and the second term represents the net mass flux out of the control volume through its surface $S$.\n\nSince the control volume $V$ is fixed, the time derivative can be moved inside the integral, acting on the density field:\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\, dV + \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS = 0\n$$\n\nNext, we apply the Divergence Theorem (or Gauss's Theorem) to the surface integral. The theorem states that for a vector field $\\mathbf{F}$, $\\oint_S \\mathbf{F} \\cdot \\mathbf{n} \\, dS = \\int_V \\nabla \\cdot \\mathbf{F} \\, dV$. In our case, the vector field is the mass flux density, $\\mathbf{F} = \\rho \\mathbf{u}$. Applying the theorem transforms the surface integral into a volume integral:\n$$\n\\oint_S (\\rho \\mathbf{u}) \\cdot \\mathbf{n} \\, dS = \\int_V \\nabla \\cdot (\\rho \\mathbf{u}) \\, dV\n$$\n\nSubstituting this back into the conservation equation yields:\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\, dV + \\int_V \\nabla \\cdot (\\rho \\mathbf{u}) \\, dV = 0\n$$\n\nCombining the two volume integrals gives:\n$$\n\\int_V \\left( \\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) \\right) \\, dV = 0\n$$\n\nThis integral equation must hold for any arbitrary control volume $V$. This can only be true if the integrand itself is identically zero at every point in space. Therefore, we arrive at the local differential form of the continuity equation:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n\n**Application to Incompressible Flow**\n\nThe problem states that the fluid density $\\rho$ is spatially uniform and constant in time.\n- \"Constant in time\" implies that the partial derivative of density with respect to time is zero: $\\frac{\\partial \\rho}{\\partial t} = 0$.\n- \"Spatially uniform\" implies that the density does not vary with position, so its gradient is zero: $\\nabla \\rho = 0$.\n\nSubstituting $\\frac{\\partial \\rho}{\\partial t} = 0$ into the continuity equation gives:\n$$\n\\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n\nUsing the vector calculus identity $\\nabla \\cdot (f\\mathbf{A}) = f(\\nabla \\cdot \\mathbf{A}) + \\mathbf{A} \\cdot (\\nabla f)$, with $f = \\rho$ and $\\mathbf{A} = \\mathbf{u}$, we can expand the divergence term:\n$$\n\\rho (\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot (\\nabla \\rho) = 0\n$$\n\nSince the density is spatially uniform, $\\nabla \\rho = 0$, and the second term vanishes:\n$$\n\\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n\nAs the fluid density $\\rho$ is a physical property and must be non-zero (i.e., $\\rho \\neq 0$), the equation can only be satisfied if the divergence of the velocity field is zero:\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\n\nThis condition, $\\nabla \\cdot \\mathbf{u} = 0$, is the mathematical definition of an incompressible flow. A velocity field is considered incompressible if its divergence is zero.\n\n**Evaluation for the Given Velocity Field**\n\nThe problem provides the two-dimensional velocity field $\\mathbf{u}(x,y) = (u,v)$, where the components are $u = ax$ and $v = -ay$. We will now compute the divergence of this field.\n\nThe divergence operator in two-dimensional Cartesian coordinates is given by $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$.\n\nFirst, we calculate the partial derivative of the $x$-component of velocity with respect to $x$:\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x}(ax) = a\n$$\n\nNext, we calculate the partial derivative of the $y$-component of velocity with respect to $y$:\n$$\n\\frac{\\partial v}{\\partial y} = \\frac{\\partial}{\\partial y}(-ay) = -a\n$$\n\nNow, we sum these partial derivatives to find the divergence:\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = a + (-a) = 0\n$$\n\n**Assessment and Final Value**\n\nThe computed divergence of the velocity field is $\\nabla \\cdot \\mathbf{u} = 0$. Based on our derivation, this is precisely the condition for an incompressible flow. Therefore, the given velocity field $\\mathbf{u}(x,y) = (ax, -ay)$ represents an incompressible flow.\n\nThe problem asks for the computed value of $\\nabla \\cdot \\mathbf{u}$. The value is $0$. The constant $a$ has units of $\\text{s}^{-1}$, so the derivatives $\\frac{\\partial u}{\\partial x}$ and $\\frac{\\partial v}{\\partial y}$ also have units of $\\text{s}^{-1}$. Their sum, the divergence, therefore has units of $\\text{s}^{-1}$.\nThe final value is $0 \\, \\text{s}^{-1}$.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Translating continuous partial differential equations into discrete algorithms that a computer can solve introduces new challenges, chief among them being numerical stability. This practice guides you through a von Neumann stability analysis to derive the celebrated Courant-Friedrichs-Lewy (CFL) condition from first principles . Mastering this analysis is essential for understanding why explicit numerical schemes have a maximum permissible time step and how it relates to the physical properties of the flow and the grid resolution.",
            "id": "4209519",
            "problem": "A cyber-physical Digital Twin (DT) of a long, straight pipeline models the transport of a passive scalar field $\\phi(x,t)$ by a constant axial velocity $a$ using the linear advection equation $\\partial_{t}\\phi + a\\,\\partial_{x}\\phi = 0$. The DT advances the field state on a uniform grid of spacing $\\Delta x$ with periodic boundary conditions by an explicit forward-Euler time integrator and a first-order ($1$) upwind spatial discretization consistent with the sign of $a$. Assume $a \\ne 0$. To ensure numerically stable synchronization between the DT and its physical counterpart, determine the largest allowable time step that guarantees linear stability of all Fourier modes of the discretized scheme.\n\nStarting only from the given partial differential equation, the stated discretization choices, and first principles (conservation, consistency, and mode-wise amplification boundedness), derive the stability constraint by requiring that the amplification factor of any spatial Fourier mode has magnitude at most $1$ for all wavenumbers. Then extract from this constraint the maximum stable time step as a closed-form expression in terms of $a$ and $\\Delta x$.\n\nProvide your final answer as a single closed-form symbolic expression in terms of $a$ and $\\Delta x$. Do not include units. No numerical rounding is required.",
            "solution": "The problem statement is first validated to ensure it is scientifically grounded, self-contained, and well-posed.\n\n### Step 1: Extract Givens\n- **Partial Differential Equation (PDE)**: The linear advection equation for a passive scalar $\\phi(x,t)$ is $\\partial_{t}\\phi + a\\,\\partial_{x}\\phi = 0$.\n- **Advection Velocity**: $a$ is a constant and $a \\ne 0$.\n- **Numerical Grid**: The spatial domain is discretized on a uniform grid with spacing $\\Delta x$.\n- **Boundary Conditions**: The domain has periodic boundary conditions.\n- **Time Integration Scheme**: An explicit forward-Euler method is used.\n- **Spatial Discretization Scheme**: A first-order upwind scheme is used, with the direction chosen based on the sign of $a$.\n- **Stability Criterion**: The amplification factor $\\lambda$ of any spatial Fourier mode must satisfy $|\\lambda| \\le 1$.\n- **Objective**: Derive the stability constraint and determine the largest allowable time step, $\\Delta t_{max}$, as a closed-form expression in terms of $a$ and $\\Delta x$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a classic exercise in the von Neumann stability analysis of finite difference schemes for a fundamental PDE.\n- **Scientific Grounding**: The linear advection equation is a cornerstone of transport phenomena. The forward-Euler and first-order upwind methods are standard, albeit simple, numerical schemes. Von Neumann stability analysis is the canonical method for analyzing linear, constant-coefficient schemes on uniform grids with periodic boundary conditions. The problem is firmly rooted in the principles of numerical analysis and computational fluid dynamics.\n- **Well-Posedness**: All necessary components are provided: the governing equation, the temporal and spatial discretization methods, the grid structure, and the boundary conditions. The objective is clearly and unambiguously stated.\n- **Objectivity**: The problem is stated in precise, formal language, free of any subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is scientifically sound, well-posed, and all information required for a unique solution is provided. I will proceed with the derivation.\n\n### Solution Derivation\n\nThe analysis begins by constructing the fully discretized form of the governing PDE, $\\partial_{t}\\phi + a\\,\\partial_{x}\\phi = 0$. Let $\\phi_j^n$ denote the numerical approximation of the scalar field $\\phi$ at spatial grid point $x_j = j\\Delta x$ and time $t_n = n\\Delta t$.\n\nThe temporal derivative is discretized using the explicit forward-Euler scheme:\n$$ \\partial_{t}\\phi \\approx \\frac{\\phi_j^{n+1} - \\phi_j^n}{\\Delta t} $$\n\nThe spatial derivative is discretized using a first-order upwind scheme, which depends on the sign of the velocity $a$. The \"upwind\" direction is the direction from which information is flowing.\n\n**Case 1: $a > 0$**\nThe flow is in the positive $x$-direction. Information at grid point $j$ arrives from the left (from point $j-1$). The upwind spatial derivative is a backward difference:\n$$ \\partial_{x}\\phi \\approx \\frac{\\phi_j^n - \\phi_{j-1}^n}{\\Delta x} $$\nSubstituting these discretizations into the PDE gives:\n$$ \\frac{\\phi_j^{n+1} - \\phi_j^n}{\\Delta t} + a \\left( \\frac{\\phi_j^n - \\phi_{j-1}^n}{\\Delta x} \\right) = 0 $$\nSolving for the state at the next time step, $\\phi_j^{n+1}$:\n$$ \\phi_j^{n+1} = \\phi_j^n - \\frac{a \\Delta t}{\\Delta x} \\left( \\phi_j^n - \\phi_{j-1}^n \\right) $$\nLet's define the Courant number $C$ as $C = \\frac{a \\Delta t}{\\Delta x}$. Since $a > 0$, we have $C > 0$. The equation becomes:\n$$ \\phi_j^{n+1} = (1 - C) \\phi_j^n + C \\phi_{j-1}^n $$\n\n**Case 2: $a < 0$**\nThe flow is in the negative $x$-direction. Information at grid point $j$ arrives from the right (from point $j+1$). The upwind spatial derivative is a forward difference:\n$$ \\partial_{x}\\phi \\approx \\frac{\\phi_{j+1}^n - \\phi_j^n}{\\Delta x} $$\nSubstituting into the PDE:\n$$ \\frac{\\phi_j^{n+1} - \\phi_j^n}{\\Delta t} + a \\left( \\frac{\\phi_{j+1}^n - \\phi_j^n}{\\Delta x} \\right) = 0 $$\nSolving for $\\phi_j^{n+1}$:\n$$ \\phi_j^{n+1} = \\phi_j^n - \\frac{a \\Delta t}{\\Delta x} \\left( \\phi_{j+1}^n - \\phi_j^n \\right) $$\nUsing the same definition for the Courant number, $C = \\frac{a \\Delta t}{\\Delta x}$, which is now negative ($C < 0$), we get:\n$$ \\phi_j^{n+1} = (1 + C) \\phi_j^n - C \\phi_{j+1}^n $$\nTo unify the analysis, it is more convenient to use the absolute Courant number, $C_{abs} = \\frac{|a| \\Delta t}{\\Delta x}$. Note that $C_{abs}$ is always non-negative.\nFor $a>0$, $C = C_{abs}$. The scheme is $\\phi_j^{n+1} = (1 - C_{abs}) \\phi_j^n + C_{abs} \\phi_{j-1}^n$.\nFor $a<0$, $C = -C_{abs}$. The scheme becomes $\\phi_j^{n+1} = (1 - C_{abs}) \\phi_j^n + C_{abs} \\phi_{j+1}^n$.\n\nWe now perform a von Neumann stability analysis. A single Fourier mode of the solution is represented as:\n$$ \\phi_j^n = \\hat{\\phi}^n(k) e^{i k x_j} = \\hat{\\phi}^n(k) e^{i k j \\Delta x} $$\nwhere $k$ is the wavenumber and $i = \\sqrt{-1}$. The amplification factor, $\\lambda(k)$, relates the amplitude of the mode at successive time steps: $\\hat{\\phi}^{n+1}(k) = \\lambda(k) \\hat{\\phi}^n(k)$. Stability requires $|\\lambda(k)| \\le 1$ for all wavenumbers $k$.\n\nWe analyze the two cases for $a$.\n\n**Stability Analysis for $a > 0$:**\nSubstitute the Fourier mode into the discretized equation $\\phi_j^{n+1} = (1 - C_{abs}) \\phi_j^n + C_{abs} \\phi_{j-1}^n$:\n$$ \\lambda(k) \\hat{\\phi}^n(k) e^{i k j \\Delta x} = (1 - C_{abs}) \\hat{\\phi}^n(k) e^{i k j \\Delta x} + C_{abs} \\hat{\\phi}^n(k) e^{i k (j-1) \\Delta x} $$\nDividing by $\\hat{\\phi}^n(k) e^{i k j \\Delta x}$ yields the amplification factor:\n$$ \\lambda(k) = 1 - C_{abs} + C_{abs} e^{-i k \\Delta x} $$\nLet $\\theta = k \\Delta x$ be the dimensionless phase angle.\n$$ \\lambda(\\theta) = 1 - C_{abs} + C_{abs}(\\cos\\theta - i\\sin\\theta) = (1 - C_{abs} + C_{abs}\\cos\\theta) - i(C_{abs}\\sin\\theta) $$\nThe magnitude squared of the amplification factor is:\n$$ |\\lambda(\\theta)|^2 = (1 - C_{abs} + C_{abs}\\cos\\theta)^2 + (-C_{abs}\\sin\\theta)^2 $$\n$$ |\\lambda(\\theta)|^2 = (1-C_{abs})^2 + 2C_{abs}(1-C_{abs})\\cos\\theta + C_{abs}^2\\cos^2\\theta + C_{abs}^2\\sin^2\\theta $$\n$$ |\\lambda(\\theta)|^2 = (1-C_{abs})^2 + 2C_{abs}(1-C_{abs})\\cos\\theta + C_{abs}^2 $$\n$$ |\\lambda(\\theta)|^2 = 1 - 2C_{abs} + C_{abs}^2 + 2C_{abs}\\cos\\theta - 2C_{abs}^2\\cos\\theta + C_{abs}^2 $$\n$$ |\\lambda(\\theta)|^2 = 1 - 2C_{abs}(1 - \\cos\\theta) + 2C_{abs}^2(1 - \\cos\\theta) $$\n$$ |\\lambda(\\theta)|^2 = 1 - 2C_{abs}(1 - C_{abs})(1 - \\cos\\theta) $$\nFor stability, $|\\lambda(\\theta)|^2 \\le 1$.\n$$ 1 - 2C_{abs}(1 - C_{abs})(1 - \\cos\\theta) \\le 1 $$\n$$ -2C_{abs}(1 - C_{abs})(1 - \\cos\\theta) \\le 0 $$\nSince $C_{abs} = \\frac{|a|\\Delta t}{\\Delta x} > 0$ and the term $(1 - \\cos\\theta)$ is always non-negative (ranging from $0$ to $2$), the inequality is satisfied if and only if:\n$$ 1 - C_{abs} \\ge 0 \\implies C_{abs} \\le 1 $$\n\n**Stability Analysis for $a < 0$:**\nSubstitute the Fourier mode into the discretized equation $\\phi_j^{n+1} = (1 - C_{abs}) \\phi_j^n + C_{abs} \\phi_{j+1}^n$:\n$$ \\lambda(k) \\hat{\\phi}^n(k) e^{i k j \\Delta x} = (1 - C_{abs}) \\hat{\\phi}^n(k) e^{i k j \\Delta x} + C_{abs} \\hat{\\phi}^n(k) e^{i k (j+1) \\Delta x} $$\nDividing by $\\hat{\\phi}^n(k) e^{i k j \\Delta x}$:\n$$ \\lambda(k) = 1 - C_{abs} + C_{abs} e^{i k \\Delta x} $$\n$$ \\lambda(\\theta) = 1 - C_{abs} + C_{abs}(\\cos\\theta + i\\sin\\theta) = (1 - C_{abs} + C_{abs}\\cos\\theta) + i(C_{abs}\\sin\\theta) $$\nThe magnitude squared is:\n$$ |\\lambda(\\theta)|^2 = (1 - C_{abs} + C_{abs}\\cos\\theta)^2 + (C_{abs}\\sin\\theta)^2 $$\nThe result is identical to the case $a > 0$:\n$$ |\\lambda(\\theta)|^2 = 1 - 2C_{abs}(1 - C_{abs})(1 - \\cos\\theta) $$\nThe stability condition is therefore also identical: $C_{abs} \\le 1$.\n\n**Conclusion on Stability:**\nFor any non-zero velocity $a$, the numerical scheme is stable if and only if the absolute Courant number is less than or equal to $1$.\n$$ C_{abs} = \\frac{|a| \\Delta t}{\\Delta x} \\le 1 $$\nThis is the celebrated Courant-Friedrichs-Lewy (CFL) condition for this particular numerical method. The largest allowable time step, $\\Delta t_{max}$, is found when this inequality becomes an equality:\n$$ \\frac{|a| \\Delta t_{max}}{\\Delta x} = 1 $$\nSolving for $\\Delta t_{max}$ yields the final expression:\n$$ \\Delta t_{max} = \\frac{\\Delta x}{|a|} $$",
            "answer": "$$\\boxed{\\frac{\\Delta x}{|a|}}$$"
        },
        {
            "introduction": "Simulating incompressible flows presents a unique challenge: pressure has no explicit governing equation and must be calculated indirectly to enforce mass conservation. This practice delves into the heart of modern CFD solvers by walking you through a single iteration of the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE) algorithm . By constructing and solving the pressure correction equation and updating the velocity fields, you will gain invaluable insight into the iterative logic that underpins pressure-velocity coupling in a finite volume framework.",
            "id": "4209517",
            "problem": "Consider the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE) applied to a collocated, cell-centered two-dimensional finite volume grid, as used in Digital Twins (DT) for Cyber-Physical Systems (CPS). The computational fluid dynamics fundamentals required here begin with the conservation of mass and the discretized linearized momentum equations for an incompressible fluid. All variables in this problem are nondimensionalized using consistent reference scales so that the mass conservation residuals, velocities, pressure, density, and coefficients are dimensionless. Assume a uniform square grid with unit cell lengths and unit face areas, and a unit reference density.\n\nYour task is to perform one SIMPLE iteration on a uniform grid of size $2 \\times 2$ cells. The iteration must be based on the following fundamental base:\n\n- Conservation of mass for incompressible flow states that the discrete net mass outflow per cell must be zero. If $r_m$ denotes the mass imbalance computed from predicted velocities, the velocity corrections must enforce that the corrected net outflow equals $-r_m$.\n- The discrete linearized momentum equations imply that velocity corrections are proportional to pressure correction differences across faces, with proportionality captured by known face coefficients derived from the momentum equation diagonal coefficients. You must derive the pressure correction equation from these principles (using only conservation of mass and discretized momentum linearization) and solve it with appropriate boundary treatment for a $2 \\times 2$ grid.\n- Apply under-relaxation to pressure and velocity updates using given relaxation factors.\n\nGrid and indexing convention:\n- Let the grid indices be $(i,j)$ with $i \\in \\{0,1\\}$ (left to right) and $j \\in \\{0,1\\}$ (bottom to top). Use row-major flattening: the linear index is $k = j \\cdot 2 + i$, so the ordering of cells is $(0,0)$, $(1,0)$, $(0,1)$, $(1,1)$, corresponding to $k = 0,1,2,3$ respectively.\n- At domain boundaries, use homogeneous Dirichlet boundary conditions for pressure correction, meaning that the pressure correction outside the domain is zero.\n\nDefinitions you must use:\n- Let $p^{\\text{old}}$ be the current cell-centered pressure field, $u^\\ast$ and $v^\\ast$ be the predicted cell-centered velocities, and $r_m$ be the mass imbalance per cell computed from $u^\\ast$ and $v^\\ast$.\n- Let $a^x$ and $a^y$ be the diagonal coefficients of the discretized momentum equations for the $x$ and $y$ components of velocity at each cell.\n- Define per-face proportionality coefficients for velocity correction implicitly via the linearized momentum relation so that the mass flux correction across a face can be expressed as the unit-density coefficient times the pressure correction difference across that face. At interior faces, use a symmetric average of adjacent cell coefficients; at boundary faces, use the adjacent interior cell coefficient alone.\n- The pressure correction equation must be assembled from conservation of mass and the velocity correction relations at faces. Homogeneous Dirichlet boundary conditions on pressure correction are to be enforced by treating the outside pressure correction as zero in your discrete equations.\n\nUpdate rules after solving the pressure correction:\n- Pressure update: $p^{\\text{new}} = p^{\\text{old}} + \\alpha_p \\, p'$ where $p'$ is the solved pressure correction and $\\alpha_p$ is the pressure under-relaxation factor.\n- Velocity update at cell centers: use a consistent averaging of adjacent face corrections derived from the momentum linearization to obtain $u'$ and $v'$, then $u^{\\text{new}} = u^\\ast + \\alpha_u \\, u'$ and $v^{\\text{new}} = v^\\ast + \\alpha_u \\, v'$, where $\\alpha_u$ is the velocity under-relaxation factor.\n\nYou must implement this for the following test suite. For each test case, all arrays are given in the row-major flattened order $(0,0)$, $(1,0)$, $(0,1)$, $(1,1)$.\n\nCommon parameters for all cases:\n- Grid size is $2 \\times 2$.\n- Density is unit and nondimensionalized, equal to $1$.\n\nTest case $1$ (general case):\n- $p^{\\text{old}} = [0.0, 0.2, 0.1, 0.0]$.\n- $u^\\ast = [1.0, 0.8, 0.5, 0.3]$.\n- $v^\\ast = [0.4, 0.6, 0.2, 0.1]$.\n- $r_m = [0.10, -0.05, 0.00, 0.20]$.\n- $a^x = [10.0, 10.0, 8.0, 8.0]$.\n- $a^y = [12.0, 12.0, 9.0, 9.0]$.\n- $\\alpha_p = 0.7$, $\\alpha_u = 0.5$.\n\nTest case $2$ (zero residual edge case):\n- $p^{\\text{old}} = [0.10, 0.10, 0.10, 0.10]$.\n- $u^\\ast = [0.10, 0.20, 0.30, 0.40]$.\n- $v^\\ast = [0.00, 0.00, 0.00, 0.00]$.\n- $r_m = [0.00, 0.00, 0.00, 0.00]$.\n- $a^x = [5.0, 5.0, 5.0, 5.0]$.\n- $a^y = [5.0, 5.0, 5.0, 5.0]$.\n- $\\alpha_p = 0.9$, $\\alpha_u = 0.3$.\n\nTest case $3$ (high stiffness in momentum):\n- $p^{\\text{old}} = [0.0, 0.0, 0.0, 0.0]$.\n- $u^\\ast = [0.5, 0.5, 0.5, 0.5]$.\n- $v^\\ast = [0.5, 0.5, 0.5, 0.5]$.\n- $r_m = [1.0, 0.0, 0.0, -0.5]$.\n- $a^x = [100.0, 100.0, 100.0, 100.0]$.\n- $a^y = [100.0, 100.0, 100.0, 100.0]$.\n- $\\alpha_p = 0.9$, $\\alpha_u = 0.7$.\n\nYour program must:\n- Assemble and solve the pressure correction equation for the $2 \\times 2$ grid using the principles stated above.\n- Apply the specified under-relaxation to update $p$, $u$, and $v$.\n- For each test case, produce a list of $12$ floating-point values in the following order: the four updated pressures $p^{\\text{new}}$ (row-major order), followed by the four updated $u^{\\text{new}}$ values, followed by the four updated $v^{\\text{new}}$ values.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each element is itself a bracketed comma-separated list for one test case. For example, the format must be like $[ [\\dots], [\\dots], [\\dots] ]$ with each inner list containing exactly $12$ floats in the order specified.",
            "solution": "The problem is well-posed, scientifically grounded, and provides a complete set of data and definitions to perform one iteration of the Semi-Implicit Method for Pressure-Linked Equations (SIMPLE). The task is to first derive the pressure correction equation from fundamental principles of mass conservation and linearized momentum, and then use its solution to update the pressure and velocity fields. We will proceed with a step-by-step derivation followed by the implementation.\n\n### 1. Derivation of the Pressure Correction Equation\n\nThe foundation of the SIMPLE algorithm is to enforce mass conservation through a pressure correction field. The discrete form of the mass conservation equation for an incompressible fluid with unit density ($\\rho=1$) and unit cell volumes and face areas ($\\Delta V=1$, $A_f=1$) in a cell $(i,j)$ is:\n$$ \\sum_{f \\in \\text{faces}} \\mathbf{u}_f \\cdot \\mathbf{n}_f A_f = (u_{i+1/2, j} - u_{i-1/2, j}) + (v_{i, j+1/2} - v_{i, j-1/2}) = 0 $$\nwhere $u_{i+1/2, j}$ is the velocity on the east face, $v_{i, j+1/2}$ is on the north face, and so on.\n\nThe predicted velocity field $(u^\\ast, v^\\ast)$ does not satisfy this equation, resulting in a mass imbalance (residual), $r_m$, for each cell $k=(i,j)$:\n$$ r_{m,k} = (u^\\ast_{i+1/2, j} - u^\\ast_{i-1/2, j}) + (v^\\ast_{i, j+1/2} - v^\\ast_{i, j-1/2}) $$\nThe problem provides cell-centered mass residuals $r_m$, which we use directly. The corrected velocity field, $\\mathbf{u} = \\mathbf{u}^\\ast + \\mathbf{u}'$, must satisfy mass conservation. Substituting this into the conservation equation and subtracting the equation for the predicted field yields an equation for the velocity corrections $\\mathbf{u}'=(u', v')$:\n$$ (u'_{i+1/2, j} - u'_{i-1/2, j}) + (v'_{i, j+1/2} - v'_{i, j-1/2}) = -r_{m,k} $$\n\nThe next step is to relate the velocity corrections at the faces to the cell-centered pressure corrections, $p'$. Based on the linearized momentum equations, the velocity correction at a face is proportional to the pressure correction gradient across that face. For the east face of cell $(i,j)$, the $x$-velocity correction is:\n$$ u'_{i+1/2, j} = d^x_{i+1/2, j} (p'_{i,j} - p'_{i+1,j}) $$\nSimilarly for the other faces:\n$$ u'_{i-1/2, j} = d^x_{i-1/2, j} (p'_{i-1,j} - p'_{i,j}) $$\n$$ v'_{i, j+1/2} = d^y_{i, j+1/2} (p'_{i,j} - p'_{i,j+1}) $$\n$$ v'_{i, j-1/2} = d^y_{i, j-1/2} (p'_{i,j-1} - p'_{i,j}) $$\nThe face coefficients $d^x$ and $d^y$ are derived from the diagonal coefficients of the momentum equations, $a^x$ and $a^y$. Following the problem specification:\n- For an interior face between two cells $k_1$ and $k_2$, the coefficient is the average of the inverse diagonal coefficients: e.g., $d^x_{k_1, k_2} = \\frac{1}{2}\\left(\\frac{1}{a^x_{k_1}} + \\frac{1}{a^x_{k_2}}\\right)$.\n- For a boundary face adjacent to an interior cell $k_{int}$, the coefficient is the inverse of the interior cell's diagonal coefficient: e.g., $d^x_{bnd} = \\frac{1}{a^x_{k_{int}}}$.\n\nSubstituting these relations into the continuity equation for corrections gives the pressure correction equation for cell $k=(i,j)$:\n$$ d^x_{i+1/2, j} (p'_{i,j} - p'_{i+1,j}) - d^x_{i-1/2, j} (p'_{i-1,j} - p'_{i,j}) + d^y_{i, j+1/2} (p'_{i,j} - p'_{i,j+1}) - d^y_{i, j-1/2} (p'_{i,j-1} - p'_{i,j}) = -r_{m,k} $$\nGrouping terms by the cell's own pressure correction $p'_{i,j}$ and its neighbors:\n$$ \\left( \\sum_{f} d_f \\right) p'_{i,j} - \\sum_{nb} d_{f,nb} p'_{nb} = -r_{m,k} $$\nwhere $f$ indexes the faces of cell $(i,j)$ and $nb$ indexes the neighboring cells.\n\nFor the given $2 \\times 2$ grid with cells indexed $0, 1, 2, 3$, this forms a $4 \\times 4$ linear system $\\mathbf{A} \\mathbf{p'} = \\mathbf{b}$, where $\\mathbf{p'} = [p'_0, p'_1, p'_2, p'_3]^T$ and $\\mathbf{b} = -[r_{m,0}, r_{m,1}, r_{m,2}, r_{m,3}]^T$. The boundary conditions are homogeneous Dirichlet for pressure correction, meaning $p'=0$ for any point outside the domain.\n\nThe matrix $\\mathbf{A}$ is constructed as follows, where $d^x_{01}$ is the coefficient on the face between cells $0$ and $1$, etc.:\n- $A_{00} = (d^x_{W0} + d^x_{01} + d^y_{S0} + d^y_{02})$\n- $A_{11} = (d^x_{01} + d^x_{E1} + d^y_{S1} + d^y_{13})$\n- $A_{22} = (d^x_{W2} + d^x_{23} + d^y_{02} + d^y_{N2})$\n- $A_{33} = (d^x_{23} + d^x_{E3} + d^y_{13} + d^y_{N3})$\n- $A_{01} = A_{10} = -d^x_{01}$\n- $A_{02} = A_{20} = -d^y_{02}$\n- $A_{13} = A_{31} = -d^y_{13}$\n- $A_{23} = A_{32} = -d^x_{23}$\n- All other off-diagonal elements are $0$.\n\n### 2. Update Procedure\n\nAfter solving $\\mathbf{A} \\mathbf{p'} = \\mathbf{b}$ for $\\mathbf{p'}$, we update the pressure and velocity fields.\n\n**Pressure Update:**\nThe cell-centered pressure is updated using under-relaxation with factor $\\alpha_p$:\n$$ p^{\\text{new}}_k = p^{\\text{old}}_k + \\alpha_p \\, p'_k $$\n\n**Velocity Update:**\nFirst, we find the cell-centered velocity corrections, $u'_k$ and $v'_k$, by averaging the corrections at the surrounding faces. For a cell $k=(i,j)$:\n$$ u'_k = \\frac{1}{2} (u'_{i-1/2, j} + u'_{i+1/2, j}) $$\n$$ v'_k = \\frac{1}{2} (v'_{i, j-1/2} + v'_{i, j+1/2}) $$\nThe face corrections are calculated using the solved $p'$ values and the appropriate boundary conditions ($p'_{out}=0$). For example, for cell $0=(0,0)$:\n$$ u'_0 = \\frac{1}{2} \\left( d^x_{-1/2,0}(p'_{-1,0} - p'_0) + d^x_{1/2,0}(p'_0 - p'_1) \\right) = \\frac{1}{2} \\left( d^x_{W0}(0 - p'_0) + d^x_{01}(p'_0 - p'_1) \\right) $$\n$$ v'_0 = \\frac{1}{2} \\left( d^y_{0,-1/2}(p'_{0,-1} - p'_0) + d^y_{0,1/2}(p'_0 - p'_2) \\right) = \\frac{1}{2} \\left( d^y_{S0}(0 - p'_0) + d^y_{02}(p'_0 - p'_2) \\right) $$\nSimilar expressions are derived for all other cells. Finally, the cell-centered velocities are updated using under-relaxation with factor $\\alpha_u$:\n$$ u^{\\text{new}}_k = u^\\ast_k + \\alpha_u \\, u'_k $$\n$$ v^{\\text{new}}_k = v^\\ast_k + \\alpha_u \\, v'_k $$\n\nThe following implementation will systematically perform these calculations for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the fluid dynamics problem for all test cases as specified.\n    This function implements one iteration of the SIMPLE algorithm on a 2x2 grid.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"p_old\": np.array([0.0, 0.2, 0.1, 0.0]),\n            \"u_star\": np.array([1.0, 0.8, 0.5, 0.3]),\n            \"v_star\": np.array([0.4, 0.6, 0.2, 0.1]),\n            \"r_m\": np.array([0.10, -0.05, 0.00, 0.20]),\n            \"ax\": np.array([10.0, 10.0, 8.0, 8.0]),\n            \"ay\": np.array([12.0, 12.0, 9.0, 9.0]),\n            \"alpha_p\": 0.7,\n            \"alpha_u\": 0.5,\n        },\n        {\n            \"p_old\": np.array([0.10, 0.10, 0.10, 0.10]),\n            \"u_star\": np.array([0.10, 0.20, 0.30, 0.40]),\n            \"v_star\": np.array([0.00, 0.00, 0.00, 0.00]),\n            \"r_m\": np.array([0.00, 0.00, 0.00, 0.00]),\n            \"ax\": np.array([5.0, 5.0, 5.0, 5.0]),\n            \"ay\": np.array([5.0, 5.0, 5.0, 5.0]),\n            \"alpha_p\": 0.9,\n            \"alpha_u\": 0.3,\n        },\n        {\n            \"p_old\": np.array([0.0, 0.0, 0.0, 0.0]),\n            \"u_star\": np.array([0.5, 0.5, 0.5, 0.5]),\n            \"v_star\": np.array([0.5, 0.5, 0.5, 0.5]),\n            \"r_m\": np.array([1.0, 0.0, 0.0, -0.5]),\n            \"ax\": np.array([100.0, 100.0, 100.0, 100.0]),\n            \"ay\": np.array([100.0, 100.0, 100.0, 100.0]),\n            \"alpha_p\": 0.9,\n            \"alpha_u\": 0.7,\n        },\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        p_old = case[\"p_old\"]\n        u_star = case[\"u_star\"]\n        v_star = case[\"v_star\"]\n        r_m = case[\"r_m\"]\n        ax = case[\"ax\"]\n        ay = case[\"ay\"]\n        alpha_p = case[\"alpha_p\"]\n        alpha_u = case[\"alpha_u\"]\n\n        # Cell indices: 0=(0,0), 1=(1,0), 2=(0,1), 3=(1,1)\n        # Invert momentum diagonal coeffs\n        inv_ax = 1.0 / ax\n        inv_ay = 1.0 / ay\n        \n        # Calculate face coefficients 'd'\n        # Internal faces\n        dx_01 = 0.5 * (inv_ax[0] + inv_ax[1])\n        dx_23 = 0.5 * (inv_ax[2] + inv_ax[3])\n        dy_02 = 0.5 * (inv_ay[0] + inv_ay[2])\n        dy_13 = 0.5 * (inv_ay[1] + inv_ay[3])\n\n        # Boundary faces\n        dx_W0, dx_E1 = inv_ax[0], inv_ax[1]\n        dx_W2, dx_E3 = inv_ax[2], inv_ax[3]\n        dy_S0, dy_S1 = inv_ay[0], inv_ay[1]\n        dy_N2, dy_N3 = inv_ay[2], inv_ay[3]\n\n        # Assemble the 4x4 matrix A for the pressure correction equation A * p' = b\n        A = np.zeros((4, 4))\n        # Diagonal elements\n        A[0, 0] = dx_W0 + dx_01 + dy_S0 + dy_02\n        A[1, 1] = dx_01 + dx_E1 + dy_S1 + dy_13\n        A[2, 2] = dx_W2 + dx_23 + dy_N2 + dy_02\n        A[3, 3] = dx_23 + dx_E3 + dy_N3 + dy_13\n        # Off-diagonal elements\n        A[0, 1] = A[1, 0] = -dx_01\n        A[0, 2] = A[2, 0] = -dy_02\n        A[1, 3] = A[3, 1] = -dy_13\n        A[2, 3] = A[3, 2] = -dx_23\n\n        # Assemble the RHS vector b\n        b = -r_m\n\n        # Solve for pressure correction p'\n        p_prime = np.linalg.solve(A, b)\n        \n        # Update pressure\n        p_new = p_old + alpha_p * p_prime\n\n        # Calculate cell-centered velocity corrections u', v'\n        u_prime = np.zeros(4)\n        v_prime = np.zeros(4)\n\n        # Face velocity corrections\n        # u'-faces\n        u_prime_W0 = dx_W0 * (0 - p_prime[0])\n        u_prime_E0_W1 = dx_01 * (p_prime[0] - p_prime[1]) # Face between 0 and 1\n        u_prime_E1 = dx_E1 * (p_prime[1] - 0)\n        u_prime_W2 = dx_W2 * (0 - p_prime[2])\n        u_prime_E2_W3 = dx_23 * (p_prime[2] - p_prime[3]) # Face between 2 and 3\n        u_prime_E3 = dx_E3 * (p_prime[3] - 0)\n        \n        # v'-faces\n        v_prime_S0 = dy_S0 * (0 - p_prime[0])\n        v_prime_N0_S2 = dy_02 * (p_prime[0] - p_prime[2]) # Face between 0 and 2\n        v_prime_N2 = dy_N2 * (p_prime[2] - 0)\n        v_prime_S1 = dy_S1 * (0 - p_prime[1])\n        v_prime_N1_S3 = dy_13 * (p_prime[1] - p_prime[3]) # Face between 1 and 3\n        v_prime_N3 = dy_N3 * (p_prime[3] - 0)\n\n        # Average face corrections to get cell-centered corrections\n        u_prime[0] = 0.5 * (u_prime_W0 + u_prime_E0_W1)\n        u_prime[1] = 0.5 * (u_prime_E0_W1 + u_prime_E1)\n        u_prime[2] = 0.5 * (u_prime_W2 + u_prime_E2_W3)\n        u_prime[3] = 0.5 * (u_prime_E2_W3 + u_prime_E3)\n\n        v_prime[0] = 0.5 * (v_prime_S0 + v_prime_N0_S2)\n        v_prime[1] = 0.5 * (v_prime_S1 + v_prime_N1_S3)\n        v_prime[2] = 0.5 * (v_prime_N0_S2 + v_prime_N2)\n        v_prime[3] = 0.5 * (v_prime_N1_S3 + v_prime_N3)\n\n        # Update velocities\n        u_new = u_star + alpha_u * u_prime\n        v_new = v_star + alpha_u * v_prime\n\n        # Combine results for this case\n        case_results = np.concatenate([p_new, u_new, v_new])\n        all_results.append(f\"[{','.join(f'{x:.7f}' for x in case_results)}]\")\n\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        }
    ]
}