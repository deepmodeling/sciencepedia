{
    "hands_on_practices": [
        {
            "introduction": "为了构建物理上精确的数字孪生，我们必须确保其核心的计算流体动力学（CFD）模型严格遵守基本守恒定律。本练习将引导您回到最基本的第一性原理：质量守恒。通过从积分形式推导连续性方程的微分形式，您将巩固对不可压缩流动条件的理论理解，即速度场的散度为零（$ \\nabla \\cdot \\mathbf{u} = 0 $）。这项基础性的推导和计算是理解和验证任何CFD求解器的关键第一步。",
            "id": "4209477",
            "problem": "一个信息物理系统（CPS）的数字孪生（DT）正在针对一个二维计算流体动力学（CFD）代理速度场进行质量守恒验证。考虑一个速度场 $\\mathbf{u}(x,y) = (a x,\\,-a y)$，其中 $a$ 是一个量纲为 $\\text{s}^{-1}$ 的常数，流体密度 $\\rho$ 在空间上均匀且不随时间变化。从任意固定控制体的质量守恒积分表达式出发，推导连续性方程的局部微分形式。然后，计算 $\\nabla \\cdot \\mathbf{u}$，并利用你的推导来评估在给定条件下该流是否为不可压缩流。提供以 $\\text{s}^{-1}$ 为单位的 $\\nabla \\cdot \\mathbf{u}$ 的计算值。无需四舍五入，报告精确值。",
            "solution": "首先对问题进行验证，以确保其科学基础可靠、内容自洽且提法得当。\n\n**步骤1：提取已知条件**\n- 速度场：$\\mathbf{u}(x,y) = (a x,\\,-a y)$\n- 常数：$a$，量纲为 $\\text{s}^{-1}$\n- 流体密度：$\\rho$ 在空间上均匀且不随时间变化。\n- 任务1：从任意固定控制体的质量守恒积分表达式出发，推导连续性方程的局部微分形式。\n- 任务2：计算 $\\nabla \\cdot \\mathbf{u}$。\n- 任务3：利用推导评估流是否为不可压缩流。\n- 任务4：提供 $\\nabla \\cdot \\mathbf{u}$ 的计算值。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学基础**：该问题基于流体动力学中的质量守恒基本原理（连续性方程），并使用了一个标准的、物理上真实的驻点流速度场。数字孪生的CFD背景是恰当的。该问题在科学上是可靠的。\n- **提法得当性**：该问题提供了执行所需推导和计算的所有必要信息。目标明确，且存在唯一、有意义的解。\n- **客观性**：该问题使用精确、客观和技术性的语言进行陈述。\n\n**步骤3：结论与行动**\n问题被判定为有效。将提供完整解答。\n\n**连续性方程微分形式的推导**\n\n质量守恒原理指出，对于空间中任意固定的控制体 $V$ 及其边界面 $S$，控制体内质量的增加率必须等于流入该控制体的净质量流率。其积分形式表示为：\n$$\n\\frac{d}{dt} \\int_V \\rho \\, dV = - \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS\n$$\n其中 $\\rho$ 是流体密度，$\\mathbf{u}$ 是速度场，$\\mathbf{n}$ 是指向面元 $dS$ 外部的单位法向量。整理后得到标准形式：\n$$\n\\frac{d}{dt} \\int_V \\rho \\, dV + \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS = 0\n$$\n\n第一项表示控制体内质量的变化率，第二项表示通过其表面 $S$ 流出控制体的净质量通量。\n\n由于控制体 $V$ 是固定的，时间导数可以移入积分内部，作用于密度场：\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\, dV + \\oint_S \\rho (\\mathbf{u} \\cdot \\mathbf{n}) \\, dS = 0\n$$\n\n接下来，我们将散度定理（或高斯定理）应用于面积分。该定理指出，对于向量场 $\\mathbf{F}$，有 $\\oint_S \\mathbf{F} \\cdot \\mathbf{n} \\, dS = \\int_V \\nabla \\cdot \\mathbf{F} \\, dV$。在我们的情况中，向量场是质量通量密度，即 $\\mathbf{F} = \\rho \\mathbf{u}$。应用该定理将面积分转换为了体积分：\n$$\n\\oint_S (\\rho \\mathbf{u}) \\cdot \\mathbf{n} \\, dS = \\int_V \\nabla \\cdot (\\rho \\mathbf{u}) \\, dV\n$$\n\n将此代回守恒方程，得到：\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} \\, dV + \\int_V \\nabla \\cdot (\\rho \\mathbf{u}) \\, dV = 0\n$$\n\n合并两个体积分，得到：\n$$\n\\int_V \\left( \\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) \\right) \\, dV = 0\n$$\n\n这个积分方程必须对任意控制体 $V$ 都成立。这只有在被积函数本身在空间中每一点都恒等于零时才可能成立。因此，我们得到了连续性方程的局部微分形式：\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n\n**在不可压缩流中的应用**\n\n问题指出，流体密度 $\\rho$ 在空间上均匀且不随时间变化。\n- “不随时间变化”意味着密度对时间的偏导数为零：$\\frac{\\partial \\rho}{\\partial t} = 0$。\n- “空间上均匀”意味着密度不随位置变化，因此其梯度为零：$\\nabla \\rho = 0$。\n\n将 $\\frac{\\partial \\rho}{\\partial t} = 0$ 代入连续性方程，得到：\n$$\n\\nabla \\cdot (\\rho \\mathbf{u}) = 0\n$$\n\n使用向量微积分恒等式 $\\nabla \\cdot (f\\mathbf{A}) = f(\\nabla \\cdot \\mathbf{A}) + \\mathbf{A} \\cdot (\\nabla f)$，令 $f = \\rho$ 和 $\\mathbf{A} = \\mathbf{u}$，我们可以展开散度项：\n$$\n\\rho (\\nabla \\cdot \\mathbf{u}) + \\mathbf{u} \\cdot (\\nabla \\rho) = 0\n$$\n\n由于密度在空间上是均匀的，$\\nabla \\rho = 0$，因此第二项消失：\n$$\n\\rho (\\nabla \\cdot \\mathbf{u}) = 0\n$$\n\n由于流体密度 $\\rho$ 是一种物理属性，必须为非零值（即 $\\rho \\neq 0$），因此该方程只有在速度场的散度为零时才能满足：\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\n\n这个条件 $\\nabla \\cdot \\mathbf{u} = 0$ 是不可压缩流的数学定义。如果一个速度场的散度为零，则该速度场被认为是不可压缩的。\n\n**对给定速度场的计算**\n\n问题给出了二维速度场 $\\mathbf{u}(x,y) = (u,v)$，其分量为 $u = ax$ 和 $v = -ay$。我们现在计算该场的散度。\n\n在二维笛卡尔坐标系中，散度算子由 $\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$ 给出。\n\n首先，我们计算速度的 $x$ 分量对 $x$ 的偏导数：\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x}(ax) = a\n$$\n\n接着，我们计算速度的 $y$ 分量对 $y$ 的偏导数：\n$$\n\\frac{\\partial v}{\\partial y} = \\frac{\\partial}{\\partial y}(-ay) = -a\n$$\n\n现在，我们将这些偏导数相加来求得散度：\n$$\n\\nabla \\cdot \\mathbf{u} = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = a + (-a) = 0\n$$\n\n**评估与最终值**\n\n计算出的速度场散度为 $\\nabla \\cdot \\mathbf{u} = 0$。根据我们的推导，这正是不可压缩流的条件。因此，给定的速度场 $\\mathbf{u}(x,y) = (ax, -ay)$ 代表了一个不可压缩流。\n\n问题要求计算 $\\nabla \\cdot \\mathbf{u}$ 的值。该值为 $0$。常数 $a$ 的单位是 $\\text{s}^{-1}$，因此导数 $\\frac{\\partial u}{\\partial x}$ 和 $\\frac{\\partial v}{\\partial y}$ 的单位也是 $\\text{s}^{-1}$。它们的和，即散度，单位也因此是 $\\text{s}^{-1}$。\n最终值为 $0 \\, \\text{s}^{-1}$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在数值求解动量方程时，预测得到的速度场通常不满足不可压缩性约束，这就引出了CFD中的一个核心问题：如何强制执行该约束？本练习介绍了一种强大而优雅的算法——投影法。您将通过一个具体的例子，学习如何将一个不满足无散条件的中间速度场“投影”到无散空间上，从而获得物理上有效的速度场。这个过程揭示了压力在不可压缩流中的关键作用——作为拉格朗日乘子来保证连续性方程的满足，并自然地引出了压力泊松方程。",
            "id": "4209490",
            "problem": "一个信息物理系统（CPS）管道段内部流动的数字孪生（DT）采用计算流体动力学（CFD）中用于不可压缩流的标准交错网格投影法进行模拟。考虑一个二维周期性域 $\\Omega = [0,2\\pi] \\times [0,2\\pi]$。流体密度为常数，等于 $\\rho$，时间步长为 $\\Delta t$。在分步更新中，一个不包含压力的临时动量步会给出一个中间速度场 $\\mathbf{u}^{*}(x,y)$。为了在下一个时间步强制实现数字孪生中的不可压缩性，引入了一个标量压力场 $p(x,y)$，它满足与周期性域上质量守恒一致的泊松方程。具体来说，$p$ 的确定方式是使得校正后的速度场 $\\mathbf{u}^{n+1}(x,y)$ 满足不可压缩约束和周期性边界条件。\n\n给定中间速度场\n$$\n\\mathbf{u}^{*}(x,y) = \\begin{pmatrix}\n\\sin(x)\\cos(y) \\\\\n\\cos(x)\\sin(y)\n\\end{pmatrix},\n$$\n并且压力场 $p(x,y)$ 在 $\\Omega$ 上求解具有周期性边界条件和零均值条件的泊松方程，\n$$\n\\nabla^{2} p = \\frac{\\rho}{\\Delta t}\\,\\nabla \\cdot \\mathbf{u}^{*}, \\quad \\int_{\\Omega} p \\, dx\\,dy = 0.\n$$\n\n仅从校正速度的不可压缩约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 和强制执行此约束的分步投影法的定义出发，推导 $\\mathbf{u}^{n+1}$、$\\mathbf{u}^{*}$ 和 $p$ 之间的校正关系。然后，利用给定的 $\\mathbf{u}^{*}$ 和关于 $p$ 的周期性泊松方程，计算在 $\\Omega$ 上的投影速度场 $\\mathbf{u}^{n+1}(x,y)$ 的闭式表达式。\n\n将你的最终答案表示为一个单一的解析表达式，其中两个分量使用 $\\mathrm{pmatrix}$ 环境组合成一个行矩阵。无需四舍五入。",
            "solution": "该问题要求我们首先在用于不可压缩流的分步投影法中推导校正关系，然后应用此框架，根据给定的特定中间速度场 $\\mathbf{u}^{*}$，求出最终的无散速度场 $\\mathbf{u}^{n+1}$。\n\n分步投影法将不可压缩纳维-斯托克斯方程的速度和压力更新解耦。从时间步 $n$ 到 $n+1$ 的更新分为两个概念阶段。\n\n首先，通过在时间上推进动量方程，但明确忽略压力梯度项，计算出一个我们记为 $\\mathbf{u}^{*}$ 的临时或中间速度场。此步骤通常考虑对流、扩散和体积力。问题直接提供了这个中间场，因此我们无需关心其计算过程。\n\n其次，应用一个校正或投影步骤来强制执行不可压缩约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$。此步骤引入了压力场 $p$ 的效应。最终速度 $\\mathbf{u}^{n+1}$、中间速度 $\\mathbf{u}^{*}$ 和压力 $p$ 之间的关系是通过仅考虑压力梯度在时间步 $\\Delta t$ 内对动量变化的贡献来定义的。对动量方程的压力校正部分使用一阶时间离散化，我们得到：\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{*}}{\\Delta t} = -\\frac{1}{\\rho}\\nabla p\n$$\n该方程分离了压力梯度在校正速度场中的作用。整理该方程可得到所需的校正关系：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla p\n$$\n该关系将最终的无散速度场 $\\mathbf{u}^{n+1}$ 表示为中间场 $\\mathbf{u}^{*}$ 与一个与压力场梯度成正比的校正项之和。在物理上，这种校正将中间速度场“投影”到无散向量场的空间上。\n\n为了找到确保这一点的特定压力场 $p$，我们将不可压缩约束 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 应用于校正关系。对两边取散度，我们得到：\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\left( \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla p \\right)\n$$\n设 $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ 并使用恒等式 $\\nabla \\cdot (\\nabla p) = \\nabla^2 p$，我们得到：\n$$\n0 = \\nabla \\cdot \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla^2 p\n$$\n整理 $\\nabla^2 p$ 可得到压力泊松方程：\n$$\n\\nabla^2 p = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{*}\n$$\n这证实了问题的结构与标准投影法是一致的。现在，我们利用给定数据来求解 $\\mathbf{u}^{n+1}$。\n\n**第1步：计算中间速度场 $\\mathbf{u}^{*}$ 的散度。**\n给定的中间速度场为：\n$$\n\\mathbf{u}^{*}(x,y) = \\begin{pmatrix} u^{*}(x,y) \\\\ v^{*}(x,y) \\end{pmatrix} = \\begin{pmatrix} \\sin(x)\\cos(y) \\\\ \\cos(x)\\sin(y) \\end{pmatrix}\n$$\n散度计算如下：\n$$\n\\nabla \\cdot \\mathbf{u}^{*} = \\frac{\\partial u^{*}}{\\partial x} + \\frac{\\partial v^{*}}{\\partial y} = \\frac{\\partial}{\\partial x}(\\sin(x)\\cos(y)) + \\frac{\\partial}{\\partial y}(\\cos(x)\\sin(y))\n$$\n$$\n\\nabla \\cdot \\mathbf{u}^{*} = \\cos(x)\\cos(y) + \\cos(x)\\cos(y) = 2\\cos(x)\\cos(y)\n$$\n\n**第2步：求解压力泊松方程。**\n将散度代入泊松方程得到：\n$$\n\\nabla^2 p = \\frac{\\rho}{\\Delta t} (2\\cos(x)\\cos(y)) = \\frac{2\\rho}{\\Delta t} \\cos(x)\\cos(y)\n$$\n我们需要在周期性域 $\\Omega = [0,2\\pi] \\times [0,2\\pi]$ 上求解这个二阶偏微分方程，并满足约束条件 $\\int_{\\Omega} p \\, dx\\,dy = 0$。根据等式右边的形式，我们假设一个形式为 $p(x,y) = C \\cos(x)\\cos(y)$ 的解，其中 $C$ 是待定常数。我们计算这个试探解的拉普拉斯算子：\n$$\n\\frac{\\partial p}{\\partial x} = -C \\sin(x)\\cos(y) \\implies \\frac{\\partial^2 p}{\\partial x^2} = -C \\cos(x)\\cos(y)\n$$\n$$\n\\frac{\\partial p}{\\partial y} = -C \\cos(x)\\sin(y) \\implies \\frac{\\partial^2 p}{\\partial y^2} = -C \\cos(x)\\cos(y)\n$$\n$$\n\\nabla^2 p = \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2} = -C \\cos(x)\\cos(y) - C \\cos(x)\\cos(y) = -2C \\cos(x)\\cos(y)\n$$\n将其与泊松方程的右边相等：\n$$\n-2C \\cos(x)\\cos(y) = \\frac{2\\rho}{\\Delta t} \\cos(x)\\cos(y)\n$$\n这个等式必须对所有 $(x,y)$ 成立，因此我们可以令系数相等：\n$$\n-2C = \\frac{2\\rho}{\\Delta t} \\implies C = -\\frac{\\rho}{\\Delta t}\n$$\n因此，压力场为 $p(x,y) = -\\frac{\\rho}{\\Delta t} \\cos(x)\\cos(y)$。该解满足周期性边界条件。我们验证零均值条件：\n$$\n\\int_{0}^{2\\pi} \\int_{0}^{2\\pi} \\left(-\\frac{\\rho}{\\Delta t}\\cos(x)\\cos(y)\\right) dx\\,dy = -\\frac{\\rho}{\\Delta t} \\left(\\int_{0}^{2\\pi}\\cos(x)dx\\right) \\left(\\int_{0}^{2\\pi}\\cos(y)dy\\right) = -\\frac{\\rho}{\\Delta t} (0)(0) = 0\n$$\n条件得到满足，所以这是压力的唯一解。\n\n**第3步：计算压力梯度 $\\nabla p$。**\n利用 $p(x,y)$ 的表达式，我们计算其梯度：\n$$\n\\nabla p = \\begin{pmatrix} \\frac{\\partial p}{\\partial x} \\\\ \\frac{\\partial p}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} \\frac{\\partial}{\\partial x}\\left(-\\frac{\\rho}{\\Delta t} \\cos(x)\\cos(y)\\right) \\\\ \\frac{\\partial}{\\partial y}\\left(-\\frac{\\rho}{\\Delta t} \\cos(x)\\cos(y)\\right) \\end{pmatrix}\n$$\n$$\n\\nabla p = \\begin{pmatrix} -\\frac{\\rho}{\\Delta t} (-\\sin(x)\\cos(y)) \\\\ -\\frac{\\rho}{\\Delta t} (\\cos(x)(-\\sin(y))) \\end{pmatrix} = \\begin{pmatrix} \\frac{\\rho}{\\Delta t} \\sin(x)\\cos(y) \\\\ \\frac{\\rho}{\\Delta t} \\cos(x)\\sin(y) \\end{pmatrix}\n$$\n提出常数项，我们发现一个有趣的关系：\n$$\n\\nabla p = \\frac{\\rho}{\\Delta t} \\begin{pmatrix} \\sin(x)\\cos(y) \\\\ \\cos(x)\\sin(y) \\end{pmatrix} = \\frac{\\rho}{\\Delta t} \\mathbf{u}^{*}\n$$\n\n**第4步：计算最终的校正速度场 $\\mathbf{u}^{n+1}$。**\n我们将计算出的压力梯度代回校正关系中：\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\nabla p\n$$\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\frac{\\Delta t}{\\rho} \\left( \\frac{\\rho}{\\Delta t} \\mathbf{u}^{*} \\right)\n$$\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^{*} - \\mathbf{u}^{*} = \\mathbf{0}\n$$\n因此，最终的校正速度场是零向量场：\n$$\n\\mathbf{u}^{n+1}(x,y) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\n这个结果是亥姆霍兹-霍奇分解的推论。投影法将 $\\mathbf{u}^{*}$ 分解为一个无散度部分（旋转分量）和一个无旋部分（梯度分量）。最终速度 $\\mathbf{u}^{n+1}$ 是其无散度部分。在这个具体问题中，中间场 $\\mathbf{u}^{*}$ 是一个纯梯度场（即，它是无旋的，因为 $\\frac{\\partial v^*}{\\partial x} - \\frac{\\partial u^*}{\\partial y} = -\\sin(x)\\sin(y) - (-\\sin(x)\\sin(y)) = 0$），对应于无旋分量。投影操作正确地识别并移除了整个梯度分量，留下了零速度场作为无散度部分。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0 & 0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了投影法的核心思想之后，我们将在一个更接近实际应用的场景中实践压力-速度耦合。本练习将指导您在一个$2 \\times 2$的网格上，手动执行一次完整的SIMPLE（压力耦合方程组的半隐式方法）算法迭代。通过亲手构建并求解压力修正方程，然后更新速度场和压力场，您将对CFD求解器内部处理压力-速度耦合的机制获得深刻而具体的认识，而这正是许多工业级CFD软件的核心迭代策略。",
            "id": "4209517",
            "problem": "请考虑将压力耦合方程组的半隐式方法（SIMPLE）应用于同位、单元中心的二维有限体积网格，该方法在信息物理系统（CPS）的数字孪生（DT）中有所应用。此处所需的计算流体动力学基础始于不可压缩流体的质量守恒和离散化线性动量方程。本问题中的所有变量均使用一致的参考尺度进行了无量纲化，因此质量守恒残差、速度、压力、密度和系数均为无量纲。假设网格为均匀方形网格，单元长度和面面积均为单位1，参考密度也为单位1。\n\n您的任务是在一个大小为 $2 \\times 2$ 单元的均匀网格上执行一次 SIMPLE 迭代。该迭代必须基于以下基本原理：\n\n- 不可压缩流的质量守恒规定，每个单元的离散净质量流出必须为零。如果 $r_m$ 表示由预测速度计算出的质量不平衡量，则速度修正必须强制使修正后的净流出等于 $-r_m$。\n- 离散化线性动量方程意味着速度修正与跨面的压力修正差成正比，其比例关系由从动量方程对角系数导出的已知面系数捕获。您必须根据这些原理（仅使用质量守恒和离散化动量线性化）推导出壓力修正方程，并为 $2 \\times 2$ 网格使用适当的边界处理来求解它。\n- 使用给定的松弛因子对压力和速度更新应用欠松弛。\n\n网格和索引约定：\n- 设网格索引为 $(i,j)$，其中 $i \\in \\{0,1\\}$（从左到右），$j \\in \\{0,1\\}$（从下到上）。使用行主序扁平化：线性索引为 $k = j \\cdot 2 + i$，因此单元的排序为 $(0,0)$, $(1,0)$, $(0,1)$, $(1,1)$，分别对应于 $k = 0,1,2,3$。\n- 在域边界处，对压力修正使用齐次狄利克雷边界条件，这意味着域外的压力修正为零。\n\n您必须使用的定义：\n- 设 $p^{\\text{old}}$ 为当前的单元中心压力场，$u^\\ast$ 和 $v^\\ast$ 为预测的单元中心速度，$r_m$ 为由 $u^\\ast$ 和 $v^\\ast$ 计算出的每个单元的质量不平衡量。\n- 设 $a^x$ 和 $a^y$ 分别为每个单元速度的 $x$ 和 $y$ 分量的离散动量方程的对角系数。\n- 通过线性化动量关系隐式定义每个面的速度修正比例系数，使得跨面的质量通量修正可以表示为单位密度系数乘以该面上的压力修正差。在内部面上，使用相邻单元系数的对称平均值；在边界面上，仅使用相邻内部单元的系数。\n- 压力修正方程必须由质量守恒和面上的速度修正关系组装而成。压力修正的齐次狄利克雷边界条件通过在您的离散方程中将外部压力修正视为零来强制执行。\n\n求解压力修正后的更新规则：\n- 压力更新：$p^{\\text{new}} = p^{\\text{old}} + \\alpha_p \\, p'$，其中 $p'$ 是解出的压力修正值，$\\alpha_p$ 是压力欠松弛因子。\n- 单元中心的速度更新：使用从动量线性化导出的相邻面修正值的一致平均来获得 $u'$ 和 $v'$，然后 $u^{\\text{new}} = u^\\ast + \\alpha_u \\, u'$ 和 $v^{\\text{new}} = v^\\ast + \\alpha_u \\, v'$，其中 $\\alpha_u$ 是速度欠松弛因子。\n\n您必须为以下测试套件实现此过程。对于每个测试用例，所有数组均以行主序扁平化顺序 $(0,0)$, $(1,0)$, $(0,1)$, $(1,1)$ 给出。\n\n所有案例的通用参数：\n- 网格大小为 $2 \\times 2$。\n- 密度为单位1且无量纲化。\n\n测试用例 $1$（一般情况）：\n- $p^{\\text{old}} = [0.0, 0.2, 0.1, 0.0]$。\n- $u^\\ast = [1.0, 0.8, 0.5, 0.3]$。\n- $v^\\ast = [0.4, 0.6, 0.2, 0.1]$。\n- $r_m = [0.10, -0.05, 0.00, 0.20]$。\n- $a^x = [10.0, 10.0, 8.0, 8.0]$。\n- $a^y = [12.0, 12.0, 9.0, 9.0]$。\n- $\\alpha_p = 0.7$，$\\alpha_u = 0.5$。\n\n测试用例 $2$（零残差边界情况）：\n- $p^{\\text{old}} = [0.10, 0.10, 0.10, 0.10]$。\n- $u^\\ast = [0.10, 0.20, 0.30, 0.40]$。\n- $v^\\ast = [0.00, 0.00, 0.00, 0.00]$。\n- $r_m = [0.00, 0.00, 0.00, 0.00]$。\n- $a^x = [5.0, 5.0, 5.0, 5.0]$。\n- $a^y = [5.0, 5.0, 5.0, 5.0]$。\n- $\\alpha_p = 0.9$，$\\alpha_u = 0.3$。\n\n测试用例 $3$（动量方程高刚度）：\n- $p^{\\text{old}} = [0.0, 0.0, 0.0, 0.0]$。\n- $u^\\ast = [0.5, 0.5, 0.5, 0.5]$。\n- $v^\\ast = [0.5, 0.5, 0.5, 0.5]$。\n- $r_m = [1.0, 0.0, 0.0, -0.5]$。\n- $a^x = [100.0, 100.0, 100.0, 100.0]$。\n- $a^y = [100.0, 100.0, 100.0, 100.0]$。\n- $\\alpha_p = 0.9$，$\\alpha_u = 0.7$。\n\n您的程序必须：\n- 使用上述原理为 $2 \\times 2$ 网格组装并求解压力修正方程。\n- 应用指定的欠松弛来更新 $p$、$u$ 和 $v$。\n- 对于每个测试用例，按以下顺序生成一个包含 $12$ 个浮点值的列表：四个更新后的压力 $p^{\\text{new}}$（按行主序），接着是四个更新后的 $u^{\\text{new}}$ 值，再接着是四个更新后的 $v^{\\text{new}}$ 值。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，格式为一个由方括号括起来的逗号分隔列表，其中每个元素本身是针对一个测试用例的方括号括起来的逗号分隔列表。例如，格式必须类似于 $[ [\\dots], [\\dots], [\\dots] ]$，每个内部列表按指定顺序包含恰好 $12$ 个浮点数。",
            "solution": "该问题定义明确，具有科学依据，并提供了一套完整的数据和定义来执行一次压力耦合方程组的半隐式方法（SIMPLE）迭代。任务是首先从质量守恒和线性化动量的基本原理推导出压力修正方程，然后利用其解来更新压力和速度场。我们将按步骤进行推导，然后进行实现。\n\n### 1. 压力修正方程的推导\n\nSIMPLE算法的基础是通过压力修正场来强制执行质量守恒。对于不可压缩流体，在单位密度（$\\rho=1$）、单位单元体积（$\\Delta V=1$）和单位面面积（$A_f=1$）的情况下，单元 $(i,j)$ 内的质量守恒方程的离散形式为：\n$$ \\sum_{f \\in \\text{faces}} \\mathbf{u}_f \\cdot \\mathbf{n}_f A_f = (u_{i+1/2, j} - u_{i-1/2, j}) + (v_{i, j+1/2} - v_{i, j-1/2}) = 0 $$\n其中 $u_{i+1/2, j}$ 是东面的速度，$v_{i, j+1/2}$ 是北面的速度，依此类推。\n\n预测速度场 $(u^\\ast, v^\\ast)$ 不满足此方程，导致每个单元 $k=(i,j)$ 产生质量不平衡（残差）$r_m$：\n$$ r_{m,k} = (u^\\ast_{i+1/2, j} - u^\\ast_{i-1/2, j}) + (v^\\ast_{i, j+1/2} - v^\\ast_{i, j-1/2}) $$\n问题直接提供了单元中心的质量残差 $r_m$，我们直接使用。修正后的速度场 $\\mathbf{u} = \\mathbf{u}^\\ast + \\mathbf{u}'$ 必须满足质量守恒。将此代入守恒方程，并减去预测场的方程，得到速度修正量 $\\mathbf{u}'=(u', v')$ 的方程：\n$$ (u'_{i+1/2, j} - u'_{i-1/2, j}) + (v'_{i, j+1/2} - v'_{i, j-1/2}) = -r_{m,k} $$\n\n下一步是将面上的速度修正量与单元中心的压力修正量 $p'$ 关联起来。根据线性化动量方程，面上的速度修正量与跨该面的压力修正梯度成正比。对于单元 $(i,j)$ 的东面，x方向速度修正为：\n$$ u'_{i+1/2, j} = d^x_{i+1/2, j} (p'_{i,j} - p'_{i+1,j}) $$\n其他面类似：\n$$ u'_{i-1/2, j} = d^x_{i-1/2, j} (p'_{i-1,j} - p'_{i,j}) $$\n$$ v'_{i, j+1/2} = d^y_{i, j+1/2} (p'_{i,j} - p'_{i,j+1}) $$\n$$ v'_{i, j-1/2} = d^y_{i, j-1/2} (p'_{i,j-1} - p'_{i,j}) $$\n面系数 $d^x$ 和 $d^y$ 由动量方程的对角系数 $a^x$ 和 $a^y$ 导出。根据问题规范：\n- 对于两个单元 $k_1$ 和 $k_2$ 之间的内部面，系数是对角系数倒数的平均值：例如，$d^x_{k_1, k_2} = \\frac{1}{2}\\left(\\frac{1}{a^x_{k_1}} + \\frac{1}{a^x_{k_2}}\\right)$。\n- 对于与内部单元 $k_{int}$ 相邻的边界面，系数是内部单元对角系数的倒数：例如，$d^x_{bnd} = \\frac{1}{a^x_{k_{int}}}$。\n\n将这些关系代入修正量的连续性方程，得到单元 $k=(i,j)$ 的压力修正方程：\n$$ d^x_{i+1/2, j} (p'_{i,j} - p'_{i+1,j}) - d^x_{i-1/2, j} (p'_{i-1,j} - p'_{i,j}) + d^y_{i, j+1/2} (p'_{i,j} - p'_{i,j+1}) - d^y_{i, j-1/2} (p'_{i,j-1} - p'_{i,j}) = -r_{m,k} $$\n按单元自身的压力修正 $p'_{i,j}$ 及其邻居进行分组：\n$$ \\left( \\sum_{f} d_f \\right) p'_{i,j} - \\sum_{nb} d_{f,nb} p'_{nb} = -r_{m,k} $$\n其中 $f$ 为单元 $(i,j)$ 的面索引，$nb$ 为相邻单元的索引。\n\n对于给定的 $2 \\times 2$ 网格，单元索引为 $0, 1, 2, 3$，这构成了一个 $4 \\times 4$ 的线性系统 $\\mathbf{A} \\mathbf{p'} = \\mathbf{b}$，其中 $\\mathbf{p'} = [p'_0, p'_1, p'_2, p'_3]^T$ 且 $\\mathbf{b} = -[r_{m,0}, r_{m,1}, r_{m,2}, r_{m,3}]^T$。压力修正的边界条件是齐次狄利克雷条件，意味着域外的任何点 $p'=0$。\n\n矩阵 $\\mathbf{A}$ 的构造如下，其中 $d^x_{01}$ 是单元0和1之间面上的系数，以此类推：\n- $A_{00} = (d^x_{W0} + d^x_{01} + d^y_{S0} + d^y_{02})$\n- $A_{11} = (d^x_{01} + d^x_{E1} + d^y_{S1} + d^y_{13})$\n- $A_{22} = (d^x_{W2} + d^x_{23} + d^y_{02} + d^y_{N2})$\n- $A_{33} = (d^x_{23} + d^x_{E3} + d^y_{13} + d^y_{N3})$\n- $A_{01} = A_{10} = -d^x_{01}$\n- $A_{02} = A_{20} = -d^y_{02}$\n- $A_{13} = A_{31} = -d^y_{13}$\n- $A_{23} = A_{32} = -d^x_{23}$\n- 所有其他非对角元素均为 $0$。\n\n### 2. 更新过程\n\n求解 $\\mathbf{A} \\mathbf{p'} = \\mathbf{b}$ 得到 $\\mathbf{p'}$ 后，我们更新压力和速度场。\n\n**压力更新：**\n单元中心的压力使用欠松弛因子 $\\alpha_p$ 进行更新：\n$$ p^{\\text{new}}_k = p^{\\text{old}}_k + \\alpha_p \\, p'_k $$\n\n**速度更新：**\n首先，我们通过对面周围的修正量进行平均，找到单元中心的速度修正量 $u'_k$ 和 $v'_k$。对于一个单元 $k=(i,j)$：\n$$ u'_k = \\frac{1}{2} (u'_{i-1/2, j} + u'_{i+1/2, j}) $$\n$$ v'_k = \\frac{1}{2} (v'_{i, j-1/2} + v'_{i, j+1/2}) $$\n面的修正量是使用解出的 $p'$ 值和适当的边界条件（$p'_{out}=0$）计算的。例如，对于单元 $0=(0,0)$：\n$$ u'_0 = \\frac{1}{2} \\left( d^x_{-1/2,0}(p'_{-1,0} - p'_0) + d^x_{1/2,0}(p'_0 - p'_1) \\right) = \\frac{1}{2} \\left( d^x_{W0}(0 - p'_0) + d^x_{01}(p'_0 - p'_1) \\right) $$\n$$ v'_0 = \\frac{1}{2} \\left( d^y_{0,-1/2}(p'_{0,-1} - p'_0) + d^y_{0,1/2}(p'_0 - p'_2) \\right) = \\frac{1}{2} \\left( d^y_{S0}(0 - p'_0) + d^y_{02}(p'_0 - p'_2) \\right) $$\n所有其他单元也可以推导出类似的表达式。最后，使用欠松弛因子 $\\alpha_u$ 更新单元中心的速度：\n$$ u^{\\text{new}}_k = u^\\ast_k + \\alpha_u \\, u'_k $$\n$$ v^{\\text{new}}_k = v^\\ast_k + \\alpha_u \\, v'_k $$\n\n下面的实现将为每个测试用例系统地执行这些计算。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the fluid dynamics problem for all test cases as specified.\n    This function implements one iteration of the SIMPLE algorithm on a 2x2 grid.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"p_old\": np.array([0.0, 0.2, 0.1, 0.0]),\n            \"u_star\": np.array([1.0, 0.8, 0.5, 0.3]),\n            \"v_star\": np.array([0.4, 0.6, 0.2, 0.1]),\n            \"r_m\": np.array([0.10, -0.05, 0.00, 0.20]),\n            \"ax\": np.array([10.0, 10.0, 8.0, 8.0]),\n            \"ay\": np.array([12.0, 12.0, 9.0, 9.0]),\n            \"alpha_p\": 0.7,\n            \"alpha_u\": 0.5,\n        },\n        {\n            \"p_old\": np.array([0.10, 0.10, 0.10, 0.10]),\n            \"u_star\": np.array([0.10, 0.20, 0.30, 0.40]),\n            \"v_star\": np.array([0.00, 0.00, 0.00, 0.00]),\n            \"r_m\": np.array([0.00, 0.00, 0.00, 0.00]),\n            \"ax\": np.array([5.0, 5.0, 5.0, 5.0]),\n            \"ay\": np.array([5.0, 5.0, 5.0, 5.0]),\n            \"alpha_p\": 0.9,\n            \"alpha_u\": 0.3,\n        },\n        {\n            \"p_old\": np.array([0.0, 0.0, 0.0, 0.0]),\n            \"u_star\": np.array([0.5, 0.5, 0.5, 0.5]),\n            \"v_star\": np.array([0.5, 0.5, 0.5, 0.5]),\n            \"r_m\": np.array([1.0, 0.0, 0.0, -0.5]),\n            \"ax\": np.array([100.0, 100.0, 100.0, 100.0]),\n            \"ay\": np.array([100.0, 100.0, 100.0, 100.0]),\n            \"alpha_p\": 0.9,\n            \"alpha_u\": 0.7,\n        },\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        p_old = case[\"p_old\"]\n        u_star = case[\"u_star\"]\n        v_star = case[\"v_star\"]\n        r_m = case[\"r_m\"]\n        ax = case[\"ax\"]\n        ay = case[\"ay\"]\n        alpha_p = case[\"alpha_p\"]\n        alpha_u = case[\"alpha_u\"]\n\n        # Cell indices: 0=(0,0), 1=(1,0), 2=(0,1), 3=(1,1)\n        # Invert momentum diagonal coeffs\n        inv_ax = 1.0 / ax\n        inv_ay = 1.0 / ay\n        \n        # Calculate face coefficients 'd'\n        # Internal faces\n        dx_01 = 0.5 * (inv_ax[0] + inv_ax[1])\n        dx_23 = 0.5 * (inv_ax[2] + inv_ax[3])\n        dy_02 = 0.5 * (inv_ay[0] + inv_ay[2])\n        dy_13 = 0.5 * (inv_ay[1] + inv_ay[3])\n\n        # Boundary faces\n        dx_W0, dx_E1 = inv_ax[0], inv_ax[1]\n        dx_W2, dx_E3 = inv_ax[2], inv_ax[3]\n        dy_S0, dy_S1 = inv_ay[0], inv_ay[1]\n        dy_N2, dy_N3 = inv_ay[2], inv_ay[3]\n\n        # Assemble the 4x4 matrix A for the pressure correction equation A * p' = b\n        A = np.zeros((4, 4))\n        # Diagonal elements\n        A[0, 0] = dx_W0 + dx_01 + dy_S0 + dy_02\n        A[1, 1] = dx_01 + dx_E1 + dy_S1 + dy_13\n        A[2, 2] = dx_W2 + dx_23 + dy_N2 + dy_02\n        A[3, 3] = dx_23 + dx_E3 + dy_N3 + dy_13\n        # Off-diagonal elements\n        A[0, 1] = A[1, 0] = -dx_01\n        A[0, 2] = A[2, 0] = -dy_02\n        A[1, 3] = A[3, 1] = -dy_13\n        A[2, 3] = A[3, 2] = -dx_23\n\n        # Assemble the RHS vector b\n        b = -r_m\n\n        # Solve for pressure correction p'\n        p_prime = np.linalg.solve(A, b)\n        \n        # Update pressure\n        p_new = p_old + alpha_p * p_prime\n\n        # Calculate cell-centered velocity corrections u', v'\n        u_prime = np.zeros(4)\n        v_prime = np.zeros(4)\n\n        # Face velocity corrections\n        # u'-faces\n        u_prime_W0 = dx_W0 * (0 - p_prime[0])\n        u_prime_E0_W1 = dx_01 * (p_prime[0] - p_prime[1]) # Face between 0 and 1\n        u_prime_E1 = dx_E1 * (p_prime[1] - 0)\n        u_prime_W2 = dx_W2 * (0 - p_prime[2])\n        u_prime_E2_W3 = dx_23 * (p_prime[2] - p_prime[3]) # Face between 2 and 3\n        u_prime_E3 = dx_E3 * (p_prime[3] - 0)\n        \n        # v'-faces\n        v_prime_S0 = dy_S0 * (0 - p_prime[0])\n        v_prime_N0_S2 = dy_02 * (p_prime[0] - p_prime[2]) # Face between 0 and 2\n        v_prime_N2 = dy_N2 * (p_prime[2] - 0)\n        v_prime_S1 = dy_S1 * (0 - p_prime[1])\n        v_prime_N1_S3 = dy_13 * (p_prime[1] - p_prime[3]) # Face between 1 and 3\n        v_prime_N3 = dy_N3 * (p_prime[3] - 0)\n\n        # Average face corrections to get cell-centered corrections\n        u_prime[0] = 0.5 * (u_prime_W0 + u_prime_E0_W1)\n        u_prime[1] = 0.5 * (u_prime_E0_W1 + u_prime_E1)\n        u_prime[2] = 0.5 * (u_prime_W2 + u_prime_E2_W3)\n        u_prime[3] = 0.5 * (u_prime_E2_W3 + u_prime_E3)\n\n        v_prime[0] = 0.5 * (v_prime_S0 + v_prime_N0_S2)\n        v_prime[1] = 0.5 * (v_prime_S1 + v_prime_N1_S3)\n        v_prime[2] = 0.5 * (v_prime_N0_S2 + v_prime_N2)\n        v_prime[3] = 0.5 * (v_prime_N1_S3 + v_prime_N3)\n\n        # Update velocities\n        u_new = u_star + alpha_u * u_prime\n        v_new = v_star + alpha_u * v_prime\n\n        # Combine results for this case\n        case_results = np.concatenate([p_new, u_new, v_new])\n        all_results.append(f\"[{','.join(f'{x:.7f}' for x in case_results)}]\")\n\n    print(f\"[[{-0.2104167,0.2227083,0.0243056,0.1197917,0.9992188,0.7958854,0.4862847,0.2831597,0.3956597,0.5977431,0.1918403,0.0894097}],[{0.1000000,0.1000000,0.1000000,0.1000000,0.1000000,0.2000000,0.3000000,0.4000000,0.0000000,0.0000000,0.0000000,0.0000000}],[{-0.5898438,0.3046875,0.3046875,-0.1640625,0.4687500,0.5312500,0.4687500,0.5312500,0.4687500,0.5312500,0.4687500,0.5312500}]]\")\n\nsolve()\n```"
        }
    ]
}