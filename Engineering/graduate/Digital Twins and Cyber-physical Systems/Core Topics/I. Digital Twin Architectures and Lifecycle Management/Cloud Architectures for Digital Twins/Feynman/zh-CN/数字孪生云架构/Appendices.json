{
    "hands_on_practices": [
        {
            "introduction": "数字孪生系统通常由多个相互依赖的云服务构成，任何单一组件的故障都可能导致整个系统中断。本实践将探讨如何量化评估一个串行服务管道的端到端可用性，并演示如何通过引入冗余来显著提升系统的可靠性。通过此练习 ，您将掌握构建高可用架构的核心原则，即利用主动-主动（active-active）等冗余策略来满足工业级应用对韧性的严苛要求。",
            "id": "4208208",
            "problem": "一个用于信息物理系统的云托管数字孪生管道由三个顺序服务组成：一个摄取网关、一个流处理引擎以及一个可视化与警报前端。当且仅当所有三个服务都同时处于运行状态时，该孪生系统才被认为是可用的。假设如下：\n\n- 摄取网关的稳态可用性为 $0.999$，流处理器的稳态可用性为 $0.9995$，可视化前端的稳态可用性为 $0.9999$。稳态可用性定义为服务可运行时间的长期比例，这等于在交替更新过程模型下，服务处于其“运行”状态的平稳概率。\n- 由于故障域不相交，各服务的“运行”/“停机”状态在统计上是独立的，并且该孪生系统需要整个顺序路径都可运行才能服务请求。\n- 一项架构变更通过部署两个相同且独立的实例，为摄取网关引入了双活冗余，每个实例的稳态可用性为 $0.999$。只要这两个实例中至少有一个处于运行状态，该孪生系统在摄取阶段就保持可用。假设切换时间可忽略不计，且两个实例之间没有相关故障。\n\n基于上述关于可用性即稳态运行概率以及事件独立性的基本定义和假设，计算管道的原始端到端可用性，计算在为摄取网关引入双活冗余后的新端到端可用性，然后报告定义为新端到端可用性与原始端到端可用性之比的改进因子。最终答案以无单位小数表示，并四舍五入到六位有效数字。请勿在任何地方使用百分号。",
            "solution": "该问题要求计算因架构变更而带来的系统可用性改进因子。我们首先根据所提供的定义来形式化描述系统的可用性。\n\n设 $A_1$、$A_2$ 和 $A_3$ 分别代表摄取网关、流处理引擎和可视化前端的稳态可用性。根据问题陈述，它们的值如下：\n$A_1 = 0.999$\n$A_2 = 0.9995$\n$A_3 = 0.9999$\n\n一个组件的可用性是其可运行的概率。设 $U_i$ 为服务 $i$ 处于“运行”状态的事件。那么，$P(U_i) = A_i$。\n\n首先，我们计算管道的原始端到端可用性，记为 $A_{orig}$。问题陈述指出，该管道是一个顺序系统，这意味着当且仅当所有三个服务都同时可运行时，它才可用。服务也被说明是统计上独立的。因此，整个系统处于运行状态的概率是单个服务可用性的乘积：\n$$A_{orig} = P(U_1 \\cap U_2 \\cap U_3) = P(U_1) \\times P(U_2) \\times P(U_3)$$\n$$A_{orig} = A_1 \\times A_2 \\times A_3$$\n代入给定的值：\n$$A_{orig} = 0.999 \\times 0.9995 \\times 0.9999$$\n\n接下来，我们考虑架构变更，其中摄取网关被替换为双活冗余配置中的两个相同且独立的实例。设每个网关实例的可用性为 $A_{1,inst}$。根据问题，$A_{1,inst} = 0.999$，与原始的 $A_1$ 相同。只要这两个实例中至少有一个处于运行状态，新的摄取阶段就是可用的。\n\n计算这个冗余阶段的不可用性更为方便。单个实例的不可用性是 $1 - A_{1,inst}$。由于两个实例是独立的，它们同时都停机（不可用）的概率是它们各自不可用性的乘积。\n$$P(\\text{摄取阶段停机}) = (1 - A_{1,inst}) \\times (1 - A_{1,inst}) = (1 - A_{1,inst})^2$$\n新摄取阶段的可用性，我们记为 $A'_{1}$，是 $1$ 减去该阶段停机的概率：\n$$A'_{1} = 1 - (1 - A_{1,inst})^2$$\n代入 $A_{1,inst} = A_1 = 0.999$:\n$$A'_{1} = 1 - (1 - 0.999)^2 = 1 - (0.001)^2 = 1 - 0.000001 = 0.999999$$\n\n管道新的端到端可用性 $A_{new}$，是新摄取阶段、流处理器和前端的可用性的乘积。后两个组件保持不变。\n$$A_{new} = A'_{1} \\times A_2 \\times A_3$$\n$$A_{new} = (1 - (1 - A_1)^2) \\times A_2 \\times A_3$$\n\n最后，我们需要计算改进因子 $F$，它被定义为新端到端可用性与原始端到端可用性的比率。\n$$F = \\frac{A_{new}}{A_{orig}}$$\n代入 $A_{new}$ 和 $A_{orig}$ 的表达式：\n$$F = \\frac{(1 - (1 - A_1)^2) \\times A_2 \\times A_3}{A_1 \\times A_2 \\times A_3}$$\n$A_2$ 和 $A_3$ 项相互抵消，从而显著简化了改进因子的表达式：\n$$F = \\frac{1 - (1 - A_1)^2}{A_1}$$\n这表明改进因子仅取决于被设置为冗余的组件的可用性。\n\n现在，我们代入 $A_1$ 的数值：\n$$F = \\frac{1 - (1 - 0.999)^2}{0.999} = \\frac{1 - (0.001)^2}{0.999} = \\frac{1 - 0.000001}{0.999} = \\frac{0.999999}{0.999}$$\n执行除法运算：\n$$F = 1.001000001001...$$\n问题要求最终答案四舍五入到六位有效数字。前六位有效数字是 $1$、$0$、$0$、$1$、$0$ 和 $0$。第七位有效数字是 $0$，小于 $5$，所以我们向下舍入（即，保持第六位数字不变）。\n$$F \\approx 1.00100$$",
            "answer": "$$\\boxed{1.00100}$$"
        },
        {
            "introduction": "在确保系统可用之后，我们必须保证其数据的完整性与一致性，这对于需要在多个云区域间同步状态的分布式数字孪生至关重要。本实践深入探讨了分布式共识的基石——仲裁（quorum）协议，并运用集合论推导其核心一致性条件，如 $R+W \\gt N$。完成此练习  后，您将能够为数字孪生的状态存储设计合理的架构，并在数据一致性、容错能力和读取延迟之间做出明智的权衡。",
            "id": "4208249",
            "problem": "一个用于信息物理资产的云托管数字孪生编排器，使用 Quorum 协议将其命令日志复制到 $N$ 个相同的存储副本上。写操作在收到任意 $W$ 个不同副本的确认后提交，读操作在从任意 $R$ 个不同副本收集响应后返回具有最高版本的值。每个操作都从 $N$ 个副本中任意选择其要联系的副本。该编排器必须确保命令日志提供写后读可见性，并防止对物理系统的驱动出现分歧的已提交写入。读操作优先考虑低延迟；在此模型中，降低 $R$ 会减少读取完成时间，因为当第 $R$ 个最快响应的被联系副本响应时，读取即告完成。\n\n仅从关于有限集子集交集的集合论推理和上述操作定义出发，推导出关于 $(R,W,N)$ 的充分必要条件，以确保在所有执行中以下两个属性均成立：\n- 强写一致性：任意两个已完成的写操作必须至少有一个共同的副本确认了这两次写入，并且\n- 写后读一致性：在一个已完成的写操作之后调用的任何已完成的读操作，其接触的副本集必须与确认该写操作的副本集有交集，以便读操作可以返回其值。\n\n此外，在最多有 $f=1$ 个副本发生故障的情况下，该编排器必须仍然能够完成读操作和写操作，这意味着当最多一个副本不可用时，必须能够从幸存的副本中组成读仲裁和写仲裁。\n\n对于 $N=5$ 和 $f=1$ 的具体情况，确定满足所有推导出的条件同时最小化读取延迟的 $R$ 的最小整数值。通过展示一个兼容的 $W$ 来简要证明您选择的 $R$ 是可行的。仅将最小的 $R$ 作为最终答案报告。无需四舍五入。以整数形式表示答案。",
            "solution": "该问题要求推导读仲裁大小 $R$、写仲裁大小 $W$ 和副本总数 $N$ 的充分必要条件，以确保两种一致性和一种容错属性。然后将这些条件应用于一个具体案例，以找到 $R$ 的最小值。\n\n设 $S$ 是所有副本的集合，其中 $|S| = N$。一个写操作由副本子集 $Q_W \\subseteq S$ 确认，其中 $|Q_W| = W$。一个读操作从副本子集 $Q_R \\subseteq S$ 收集响应，其中 $|Q_R| = R$。\n\n首先，我们使用集合论推理来形式化这三个必需的属性。\n\n1.  **强写一致性：** 此属性规定，任意两个已完成的写操作必须至少有一个共同的副本。设 $Q_{W1}$ 和 $Q_{W2}$ 是确认了任意两个已完成写操作的副本集。条件是 $Q_{W1} \\cap Q_{W2} \\neq \\emptyset$。为了对 $Q_{W1}$ 和 $Q_{W2}$ 的任何选择都保证这一点，我们考虑交集最小的最坏情况。使用这两个集合并集的容斥原理：\n    $$|Q_{W1} \\cup Q_{W2}| = |Q_{W1}| + |Q_{W2}| - |Q_{W1} \\cap Q_{W2}|$$\n    由于并集是总副本集 $S$ 的一个子集，其大小不能超过 $N$：\n    $$|Q_{W1} \\cup Q_{W2}| \\le N$$\n    代入已知大小 $|Q_{W1}| = W$ 和 $|Q_{W2}| = W$：\n    $$N \\ge W + W - |Q_{W1} \\cap Q_{W2}|$$\n    对交集的大小进行整理，我们得到：\n    $$|Q_{W1} \\cap Q_{W2}| \\ge 2W - N$$\n    为了保证交集非空，其最小可能大小必须至少为 $1$。\n    $$2W - N \\ge 1 \\implies 2W > N$$\n    这是强写一致性的充分必要条件。\n\n2.  **写后读一致性：** 此属性要求任何已完成的读操作必须与任何先前已完成的写操作的副本集相交。设 $Q_W$ 是一个已完成写操作的副本集，而 $Q_R$ 是一个后续读操作的副本集。条件是 $Q_R \\cap Q_W \\neq \\emptyset$。推理过程与强写一致性的情况类似：\n    $$|Q_R \\cup Q_W| = |Q_R| + |Q_W| - |Q_R \\cap Q_W| \\le N$$\n    代入 $|Q_R| = R$ 和 $|Q_W| = W$：\n    $$N \\ge R + W - |Q_R \\cap Q_W|$$\n    $$|Q_R \\cap Q_W| \\ge R + W - N$$\n    为保证交集非空，我们要求：\n    $$R + W - N \\ge 1 \\implies R + W > N$$\n    这是写后读一致性的充分必要条件。\n\n3.  **容错性：** 系统必须能够在最多 $f$ 个故障存在的情况下完成读写操作。当有 $f$ 个故障时，可用副本的数量为 $N-f$。为了能够组成一个写仲裁，可用副本的数量必须至少为 $W$。同样地，为了能够组成一个读仲裁，可用副本的数量必须至少为 $R$。这给了我们两个条件：\n    $$W \\le N - f$$\n    $$R \\le N - f$$\n\n我们得到具体案例 $N=5$ 和 $f=1$。目标是找到 $R$ 的最小整数值。我们将这些值代入推导出的不等式中：\n(i) $2W > 5$\n(ii) $R + W > 5$\n(iii) $W \\le 5 - 1 \\implies W \\le 4$\n(iv) $R \\le 5 - 1 \\implies R \\le 4$\n\n根据不等式(i)，由于 $W$ 必须是整数，我们有 $W \\ge 3$。\n将其与不等式(iii)结合，我们得到 $W$ 可能的整数值：\n$$3 \\le W \\le 4$$\n所以，$W$ 可以是 $3$ 或 $4$。\n\n问题陈述中提到，通过降低 $R$ 来最小化读取延迟。我们寻求满足所有条件的最小整数 $R$，对于某个有效的 $W$ 选择。我们分析 $W$ 的两种可能情况。\n\n情况1：$W=3$。\n我们将 $W=3$ 代入不等式(ii)：\n$$R + 3 > 5 \\implies R > 2$$\n由于 $R$ 是整数，这意味着 $R \\ge 3$。不等式(iv)要求 $R \\le 4$。因此，对于 $W=3$，$R$ 的可能值为 $3$ 和 $4$。在这种情况下，$R$ 的最小值为 $3$。配对 $(R=3, W=3)$ 是一个有效的配置。\n\n情况2：$W=4$。\n我们将 $W=4$ 代入不等式(ii)：\n$$R + 4 > 5 \\implies R > 1$$\n由于 $R$ 是整数，这意味着 $R \\ge 2$。不等式(iv)要求 $R \\le 4$。因此，对于 $W=4$，$R$ 的可能值为 $2$、$3$ 和 $4$。在这种情况下，$R$ 的最小值为 $2$。配对 $(R=2, W=4)$ 是一个有效的配置。\n\n为了找到 $R$ 的总的最小整数值，我们比较两种有效情况下的最小值。$\\{3, 2\\}$ 的最小值是 $2$。\n因此，满足所有条件的 $R$ 的最小整数值是 $2$。这是可行的，因为可以通过一个兼容的写仲裁大小（例如，$W=4$）来实现。我们来验证配对 $(R=2, W=4)$ 在 $N=5$ 和 $f=1$ 的情况下是否成立：\n(i) $2(4) > 5 \\implies 8 > 5$。（满足）\n(ii) $2 + 4 > 5 \\implies 6 > 5$。（满足）\n(iii) $4 \\le 5 - 1 \\implies 4 \\le 4$。（满足）\n(iv) $2 \\le 5 - 1 \\implies 2 \\le 4$。（满足）\n所有条件都成立。我们还必须检查 $R=1$ 是否可能。如果 $R=1$，不等式(ii)给出 $1+W>5 \\implies W>4$。然而，不等式(iii)要求 $W \\le 4$。这些条件是矛盾的，所以 $R=1$ 不是一个可行的解决方案。\n\n$R$ 的最小整数值是 $2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "真实的系统架构设计需要在严格的性能与预算约束下进行，对于横跨边缘和云资源的数字孪生更是如此。本实践将排队论、网络延迟模型和资源约束等多个关键概念融合成一个组合优化问题。通过解决这个组件布局优化任务 ，您将获得系统化解决实际工程问题的宝贵经验，学会如何在混合云环境下，科学地平衡成本、延迟和资源利用率等相互制约的目标。",
            "id": "4208217",
            "problem": "您的任务是为部署在采用混合边缘-云架构的信息物理系统 (CPS) 中的数字孪生 (DT) 管道的组件设计一个部署优化方案。每个管道是一个由 $n$ 个组件组成的线性链，以 $ \\lambda $ (任务/秒) 的外生到达率处理流。对于每个组件 $i \\in \\{1,\\dots,n\\}$，您必须决定其部署位置 $x_i \\in \\{0,1\\}$，其中 $x_i = 0$ 表示部署在边缘，而 $x_i = 1$ 表示部署在云端。目标是最小化总云成本\n$$\nC(x) = \\sum_{i=1}^{n} c_i x_i,\n$$\n同时满足端到端延迟和边缘内存的约束。\n\n科学与工程基础：\n- 对于每个组件 $i$，当部署在平台 $p \\in \\{\\mathrm{edge},\\mathrm{cloud}\\}$ 上时，其服务率为 $ \\mu_{i,p} $ (任务/秒)。对于流到达率 $ \\lambda $，当 $ \\lambda  \\mu_{i,p} $ 时，稳定的 $ \\mathrm{M/M/1} $ 排队中的预期响应时间为\n$$\nW_{i,p} = \\frac{1}{\\mu_{i,p} - \\lambda} \\quad \\text{秒}.\n$$\n- 整个管道的端到端延迟等于组件响应时间的总和，加上当数据在相邻组件之间跨越边缘-云边界时产生的任何网络传输延迟。对于组件 $j$ 和 $j+1$ 之间的跨越，数据大小为 $ s_j $ 兆字节（MB），单向传播延迟为 $ p $ 毫秒，可用带宽为 $ B $ 兆字节/秒，则跨越延迟为\n$$\nL^{\\mathrm{net}}_{j} = p + \\frac{s_j}{B} \\cdot 1000 \\quad \\text{毫秒}.\n$$\n- 总端到端延迟（以毫秒为单位）为\n$$\nL_{\\mathrm{e2e}}(x) = \\left( \\sum_{i=1}^{n} 1000 \\cdot W_{i,p(i)} \\right) + \\left( \\sum_{j=1}^{n-1} \\mathbf{1}\\{x_j \\neq x_{j+1}\\} \\cdot L^{\\mathrm{net}}_{j} \\right),\n$$\n其中，如果 $ x_i = 0 $，则 $ p(i) = \\mathrm{edge} $；如果 $ x_i = 1 $，则 $ p(i) = \\mathrm{cloud} $。$ \\mathbf{1}\\{\\cdot\\} $ 是指示函数。\n- 边缘内存约束要求\n$$\n\\sum_{i=1}^{n} m_i \\cdot \\mathbf{1}\\{x_i = 0\\} \\leq M_{\\mathrm{edge,max}},\n$$\n其中 $ m_i $ 是组件 $ i $ 的内存占用（以千兆字节 GB 为单位），$ M_{\\mathrm{edge,max}} $ 是边缘内存容量。\n\n优化约束：\n- 端到端延迟约束：$ L_{\\mathrm{e2e}}(x) \\leq L_{\\max} $，其中 $ L_{\\max} = 30\\,\\mathrm{ms} $。\n- 边缘内存约束：$ \\sum_{i=1}^{n} m_i \\cdot \\mathbf{1}\\{x_i = 0\\} \\leq 2\\,\\mathrm{GB} $。\n- 稳定性约束：对于每个组件 $ i $，如果 $ x_i = 0 $，则 $ \\lambda  \\mu_{i,\\mathrm{edge}} $；如果 $ x_i = 1 $，则 $ \\lambda  \\mu_{i,\\mathrm{cloud}} $；否则该分配不可行。\n\n您的程序必须对每个测试用例，对所有 $2^n$ 种二进制分配 $ x = (x_1,\\dots,x_n) $ 进行穷举搜索，计算其在约束条件下的可行性，并返回最小云成本 $ C(x) $ 和达到该最小值的相应分配。如果不存在可行的分配，则返回 $ -1 $ 和一个空列表。\n\n所有涉及时间的答案必须以毫秒计算和检查，内存以千兆字节计算和检查。不涉及角度。成本是无单位标量。\n\n测试套件：\n- 案例 A（一般权衡）：\n  - $ n = 4 $,\n  - $ \\lambda = 150 $,\n  - $ \\mu_{\\mathrm{edge}} = [400,\\,330,\\,500,\\,380] $,\n  - $ \\mu_{\\mathrm{cloud}} = [800,\\,700,\\,900,\\,750] $,\n  - $ m = [0.6,\\,0.4,\\,0.8,\\,0.7] $,\n  - $ c = [3.0,\\,1.5,\\,4.0,\\,2.5] $,\n  - $ s = [1.5,\\,2.0,\\,1.0] $,\n  - $ B = 500 $,\n  - $ p = 2 $,\n  - $ M_{\\mathrm{edge,max}} = 2.0 $,\n  - $ L_{\\max} = 30 $.\n- 案例 B（边缘处边界可行）：\n  - $ n = 3 $,\n  - $ \\lambda = 120 $,\n  - $ \\mu_{\\mathrm{edge}} = [350,\\,360,\\,340] $,\n  - $ \\mu_{\\mathrm{cloud}} = [700,\\,720,\\,680] $,\n  - $ m = [0.8,\\,0.6,\\,0.6] $,\n  - $ c = [2.0,\\,3.0,\\,5.0] $,\n  - $ s = [1.0,\\,1.0] $,\n  - $ B = 800 $,\n  - $ p = 2 $,\n  - $ M_{\\mathrm{edge,max}} = 2.0 $,\n  - $ L_{\\max} = 30 $.\n- 案例 C（因不稳定性而不可行）：\n  - $ n = 4 $,\n  - $ \\lambda = 200 $,\n  - $ \\mu_{\\mathrm{edge}} = [180,\\,210,\\,190,\\,205] $,\n  - $ \\mu_{\\mathrm{cloud}} = [190,\\,220,\\,195,\\,215] $,\n  - $ m = [0.6,\\,0.5,\\,0.4,\\,0.4] $,\n  - $ c = [1.0,\\,1.0,\\,1.0,\\,1.0] $,\n  - $ s = [2.0,\\,2.0,\\,2.0] $,\n  - $ B = 400 $,\n  - $ p = 5 $,\n  - $ M_{\\mathrm{edge,max}} = 2.0 $,\n  - $ L_{\\max} = 30 $.\n\n要求的最终输出格式：\n您的程序应生成一行输出，其中包含一个逗号分隔的列表，该列表用方括号括起来，其中每个元素都是 $[C^\\star, x^\\star]$ 形式的列表，$ C^\\star $ 是最小成本（一个浮点数，如果不可行则为 $-1$），$ x^\\star $ 是相应的分配，表示为一个整数列表（0 代表边缘，1 代表云）。例如：$[[2.5,[0,0,0,1]],[0.0,[0,0,0]],[-1,[]]]$。",
            "solution": "该问题要求在一个混合边缘-云架构中，为一系列线性连接的计算组件找到成本最低的部署方案。解决方案必须通过对所有可能的 $2^n$ 种部署配置进行穷举搜索来找到。\n\n对于每个测试用例，求解算法遵循以下步骤：\n1.  初始化一个记录当前最小成本的变量 $C_{min}$ 为无穷大，以及对应的最佳分配 $x^\\star$ 为一个空列表。\n2.  对从 $0$ 到 $2^n-1$ 的每个整数进行迭代。该整数的 $n$ 位二进制表示即代表一个部署向量 $x$（例如，对于 $n=4$ 和整数 $5$，二进制是 `0101`，对应的向量是 $x=[0,1,0,1]$）。\n3.  对于每一个候选部署向量 $x$，我们通过评估所有约束条件来检查其可行性：\n    a.  **稳定性约束**：对于每个组件 $i$，我们验证任务到达率 $\\lambda$ 是否严格小于所选部署平台（边缘或云）的服务率 $\\mu_{i,p}$。如果任何组件不满足此条件，则该部署向量 $x$ 是不可行的，我们继续检查下一个向量。\n    b.  **边缘内存约束**：我们计算所有部署在边缘的组件（即 $x_i=0$ 的组件）所消耗的总内存量。如果这个总量超过了边缘设备的最大内存容量 $M_{\\mathrm{edge,max}}$，则该部署是不可行的。\n    c.  **端到端延迟约束**：我们计算总的端到端延迟 $L_{\\mathrm{e2e}}(x)$。这包括两个部分：\n        i.  **处理延迟**：对每个组件，我们使用 M/M/1 排队模型公式 $W_{i,p} = 1/(\\mu_{i,p} - \\lambda)$ 来计算其平均响应时间。然后将所有组件的响应时间（转换为毫秒）相加。\n        ii. **网络延迟**：我们检查部署向量中所有相邻的组件对 $(x_j, x_{j+1})$。如果一个组件部署在边缘而下一个在云端（或反之），即 $x_j \\neq x_{j+1}$，我们就计算并累加一次网络跨越延迟。该延迟由固定的传播延迟 $p$ 和取决于数据大小 $s_j$ 及带宽 $B$ 的传输延迟组成。\n        如果总延迟（处理延迟与网络延迟之和）超过了最大允许延迟 $L_{\\max}$，则该部署是不可行的。\n4.  如果一个部署向量 $x$ 通过了上述所有三个可行性检查，那么它是一个有效的解。我们计算其总成本 $C(x)$，即所有部署在云端的组件（$x_i=1$ 的组件）的相关成本 $c_i$ 之和。\n5.  我们将这个可行解的成本 $C(x)$ 与当前记录的最小成本 $C_{min}$ 进行比较。如果 $C(x)$ 更小，我们就更新 $C_{min}$ 为 $C(x)$，并记录 $x$ 为新的最佳分配 $x^\\star$。\n6.  在检查完所有 $2^n$ 个可能的部署向量后，如果 $C_{min}$ 仍然是无穷大，则意味着没有找到任何可行的解决方案，结果为 $[-1, []]$。否则，最终结果是 $[C_{min}, x^\\star]$。\n\n对每个测试用例重复此过程，并将所有结果汇总成一个列表。",
            "answer": "[[4.0,[1,0,1,0]],[0.0,[0,0,0]],[-1,[]]]"
        }
    ]
}