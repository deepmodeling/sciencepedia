{
    "hands_on_practices": [
        {
            "introduction": "线性特征(LC)方法的核心在于沿着中子飞行的直线路径精确求解输运方程。在非结构化网格（如四面体网格）中应用此方法，关键一步是如何表示网格单元内部的源项。本练习将引导你推导和应用重心坐标，将离散的顶点源值插值为沿特征线变化的连续线性源，并最终求解出射角通量，从而深入理解LC方法在复杂几何中的实现细节。",
            "id": "4233766",
            "problem": "考虑在三维非结构网格的单个四面体单元内，沿着一条直特征线的单群、稳态中子输运。在特征线法 (MOC) 中，假设总宏观截面在单元内为常数，并用 $\\Sigma_{t}$ 表示。沿着由弧长坐标 $s\\in[0,\\ell]$ 参数化的特征线，角通量 $\\psi(s)$ 满足从线性玻尔兹曼输运方程沿直线路径导出的基本线性常微分方程，\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\psi = q(s),\n$$\n其中 $q(s)$ 是四面体内部线段上的各向同性源。采用线性特征线空间离散：通过重心坐标插值附加在单元顶点上的节点源系数，从而将源在单元内近似为空间上的线性函数。\n\n给定四面体顶点的笛卡尔坐标：\n$$\n\\mathbf{v}_{1}=(0,0,0),\\quad \\mathbf{v}_{2}=(1,0,0),\\quad \\mathbf{v}_{3}=(0,1,0),\\quad \\mathbf{v}_{4}=(0,0,1).\n$$\n一条特征射线在\n$$\n\\mathbf{r}_{\\mathrm{in}}=(0.1,0.2,0.1)\n$$\n处进入四面体，并在\n$$\n\\mathbf{r}_{\\mathrm{out}}=(0.2,0.3,0.15)\n$$\n处离开。\n设节点源系数（与顶点关联的标量）为\n$$\nS_{1}=0.4,\\quad S_{2}=0.6,\\quad S_{3}=0.5,\\quad S_{4}=0.3.\n$$\n假设总宏观截面为 $\\Sigma_{t}=2$（无量纲单位），入射点的入射角通量为 $\\psi(0)=1.5$（无量纲单位）。令 $\\ell$ 为 $\\mathbf{r}_{\\mathrm{in}}$ 和 $\\mathbf{r}_{\\mathrm{out}}$ 之间由欧几里得范数测量的线段长度。\n\n任务：\n- 从四面体重心坐标的定义出发，推导一个公式，用于计算四面体中任意点 $\\mathbf{r}$ 的重心坐标向量 $\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1},\\lambda_{2},\\lambda_{3},\\lambda_{4})^{\\top}$，该公式是基于 $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$ 构建的 $4\\times 4$ 线性系统的解。利用此公式分别求出 $\\mathbf{r}_{\\mathrm{in}}$ 和 $\\mathbf{r}_{\\mathrm{out}}$ 的重心坐标 $\\boldsymbol{\\lambda}_{\\mathrm{in}}$ 和 $\\boldsymbol{\\lambda}_{\\mathrm{out}}$。\n- 证明沿着由 $\\mathbf{r}(s)=\\mathbf{r}_{\\mathrm{in}}+\\frac{s}{\\ell}\\left(\\mathbf{r}_{\\mathrm{out}}-\\mathbf{r}_{\\mathrm{in}}\\right)$ 参数化的直线段，重心坐标随 $s$ 线性变化，并且可以写成仿射形式 $\\boldsymbol{\\lambda}(s)=\\boldsymbol{\\alpha}+\\boldsymbol{\\beta}s$。请用 $\\boldsymbol{\\lambda}_{\\mathrm{in}}$、$\\boldsymbol{\\lambda}_{\\mathrm{out}}$ 和 $\\ell$ 来确定 $\\boldsymbol{\\alpha}$ 和 $\\boldsymbol{\\beta}$。\n- 使用线性源近似 $q(s)=\\sum_{i=1}^{4}S_{i}\\lambda_{i}(s)$，对输运常微分方程进行积分，以获得出口角通量 $\\psi(\\ell)$ 的闭式解析表达式，该表达式用 $\\Sigma_{t}$、$\\ell$、$\\psi(0)$、$\\mathbf{S}=(S_{1},S_{2},S_{3},S_{4})$ 以及上面推导出的 $\\boldsymbol{\\lambda}(s)$ 的参数表示。\n\n将您关于 $\\psi(\\ell)$ 的最终答案表示为一个包含指数函数的单一闭式解析表达式。最终表达式无需四舍五入，也不应包含单位。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于中子输运理论的原理，在数学上是适定的，并且是客观和自洽的。求解唯一解所需的所有数据均已提供。解答过程如下。\n\n该问题要求在一个四面体单元内，沿着一条特征线段求解一维稳态输运方程：\n$$\n\\frac{d\\psi}{ds} + \\Sigma_{t}\\psi(s) = q(s), \\quad s \\in [0, \\ell]\n$$\n初始条件为 $\\psi(s=0) = \\psi(0)$。源项 $q(s)$ 是通过使用重心坐标对节点源值进行线性插值定义的。\n\n**1. 重心坐标**\n\n对于具有顶点 $\\{\\mathbf{v}_{i}\\}_{i=1}^{4}$ 的四面体内的点 $\\mathbf{r} = (x, y, z)^{\\top}$，其重心坐标 $\\boldsymbol{\\lambda}(\\mathbf{r})=(\\lambda_{1}, \\lambda_{2}, \\lambda_{3}, \\lambda_{4})^{\\top}$ 由以下两个条件定义：\n$$\n\\mathbf{r} = \\sum_{i=1}^{4} \\lambda_{i} \\mathbf{v}_{i} \\quad \\text{和} \\quad \\sum_{i=1}^{4} \\lambda_{i} = 1.\n$$\n这些条件构成了关于 4 个未知数 $\\lambda_i$ 的 4 个线性方程组。其矩阵形式为：\n$$\n\\begin{pmatrix} v_{1x} & v_{2x} & v_{3x} & v_{4x} \\\\ v_{1y} & v_{2y} & v_{3y} & v_{4y} \\\\ v_{1z} & v_{2z} & v_{3z} & v_{4z} \\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\n给定的顶点是 $\\mathbf{v}_{1}=(0,0,0)$、$\\mathbf{v}_{2}=(1,0,0)$、$\\mathbf{v}_{3}=(0,1,0)$ 和 $\\mathbf{v}_{4}=(0,0,1)$。将这些代入矩阵系统，得到：\n$$\n\\begin{pmatrix} 0 & 1 & 0 & 0 \\\\ 0 & 0 & 1 & 0 \\\\ 0 & 0 & 0 & 1 \\\\ 1 & 1 & 1 & 1 \\end{pmatrix}\n\\begin{pmatrix} \\lambda_1 \\\\ \\lambda_2 \\\\ \\lambda_3 \\\\ \\lambda_4 \\end{pmatrix}\n=\n\\begin{pmatrix} x \\\\ y \\\\ z \\\\ 1 \\end{pmatrix}\n$$\n求解这个简单的系统，可以得到重心坐标作为笛卡尔坐标 $(x,y,z)$ 的函数：\n$$\n\\lambda_2 = x, \\quad \\lambda_3 = y, \\quad \\lambda_4 = z\n$$\n$$\n\\lambda_1 = 1 - \\lambda_2 - \\lambda_3 - \\lambda_4 = 1 - x - y - z\n$$\n所以，$\\boldsymbol{\\lambda}(\\mathbf{r}) = (1-x-y-z, x, y, z)^{\\top}$。\n\n使用此公式，我们计算入射点 $\\mathbf{r}_{\\mathrm{in}}=(0.1, 0.2, 0.1)$ 和出射点 $\\mathbf{r}_{\\mathrm{out}}=(0.2, 0.3, 0.15)$ 的重心坐标。\n对于 $\\mathbf{r}_{\\mathrm{in}}$：\n$\\lambda_{2, \\mathrm{in}} = 0.1$，$\\lambda_{3, \\mathrm{in}} = 0.2$，$\\lambda_{4, \\mathrm{in}} = 0.1$。\n$\\lambda_{1, \\mathrm{in}} = 1 - 0.1 - 0.2 - 0.1 = 0.6$。\n因此，$\\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.6, 0.1, 0.2, 0.1)^{\\top}$。\n\n对于 $\\mathbf{r}_{\\mathrm{out}}$：\n$\\lambda_{2, \\mathrm{out}} = 0.2$，$\\lambda_{3, \\mathrm{out}} = 0.3$，$\\lambda_{4, \\mathrm{out}} = 0.15$。\n$\\lambda_{1, \\mathrm{out}} = 1 - 0.2 - 0.3 - 0.15 = 0.35$。\n因此，$\\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.35, 0.2, 0.3, 0.15)^{\\top}$。\n\n**2. 沿特征线的重心坐标线性变化**\n\n特征线段由弧长 $s$ 参数化为：\n$$\n\\mathbf{r}(s) = \\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell} (\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}) = \\left(1-\\frac{s}{\\ell}\\right)\\mathbf{r}_{\\mathrm{in}} + \\frac{s}{\\ell}\\mathbf{r}_{\\mathrm{out}}, \\quad s \\in [0, \\ell]\n$$\n其中 $\\ell$ 是线段长度。由于从笛卡尔坐标 $\\mathbf{r}$到重心坐标 $\\boldsymbol{\\lambda}(\\mathbf{r})$ 的映射是仿射变换，并且 $\\mathbf{r}(s)$ 是 $s$ 的仿射（线性）函数，所以复合函数 $\\boldsymbol{\\lambda}(\\mathbf{r}(s))$ 也是 $s$ 的仿射函数。具体来说：\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}(\\mathbf{r}(s)) = \\left(1-\\frac{s}{\\ell}\\right)\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{in}}) + \\frac{s}{\\ell}\\boldsymbol{\\lambda}(\\mathbf{r}_{\\mathrm{out}})\n$$\n将此式重新排列成 $\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s$ 的形式：\n$$\n\\boldsymbol{\\lambda}(s) = \\boldsymbol{\\lambda}_{\\mathrm{in}} + \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})s\n$$\n因此，我们确定常数向量 $\\boldsymbol{\\alpha}$ 和斜率向量 $\\boldsymbol{\\beta}$ 为：\n$$\n\\boldsymbol{\\alpha} = \\boldsymbol{\\lambda}_{\\mathrm{in}} \\quad \\text{和} \\quad \\boldsymbol{\\beta} = \\frac{1}{\\ell}(\\boldsymbol{\\lambda}_{\\mathrm{out}} - \\boldsymbol{\\lambda}_{\\mathrm{in}})\n$$\n\n**3. 输运方程的积分**\n\n输运方程是一阶线性常微分方程。其解可以使用积分因子 $I(s)=\\exp(\\Sigma_t s)$ 求得。给定 $\\psi(0)$，$\\psi(\\ell)$ 的通解为：\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\int_0^\\ell q(s') \\exp(-\\Sigma_t (\\ell-s')) ds'\n$$\n沿特征线的源由 $q(s) = \\sum_{i=1}^4 S_i \\lambda_i(s) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}(s)$ 给出，其中 $\\mathbf{S}=(S_1, S_2, S_3, S_4)^\\top$。使用 $\\boldsymbol{\\lambda}(s)$ 的线性形式：\n$$\nq(s) = \\mathbf{S}^\\top(\\boldsymbol{\\alpha} + \\boldsymbol{\\beta}s) = (\\mathbf{S}^\\top \\boldsymbol{\\alpha}) + (\\mathbf{S}^\\top \\boldsymbol{\\beta})s\n$$\n令 $q_0 = \\mathbf{S}^\\top \\boldsymbol{\\alpha} = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = q(0)$ 且 $q_1 = \\mathbf{S}^\\top \\boldsymbol{\\beta} = \\frac{\\mathbf{S}^\\top(\\boldsymbol{\\lambda}_{\\mathrm{out}}-\\boldsymbol{\\lambda}_{\\mathrm{in}})}{\\ell} = \\frac{q(\\ell)-q(0)}{\\ell}$。源是 $s$ 的线性函数：$q(s) = q_0 + q_1 s$。\n\n积分项为 $\\exp(-\\Sigma_t \\ell) \\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds'$。我们计算该定积分：\n$$\n\\int_0^\\ell (q_0+q_1 s')\\exp(\\Sigma_t s') ds' = \\left[ \\frac{q_0}{\\Sigma_t}\\exp(\\Sigma_t s') \\right]_0^\\ell + q_1 \\int_0^\\ell s'\\exp(\\Sigma_t s') ds'\n$$\n对第二项使用分部积分法，$\\int s' e^{as'} ds' = (\\frac{s'}{a} - \\frac{1}{a^2})e^{as'}$，我们得到：\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left[ \\left(\\frac{s'}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t s') \\right]_0^\\ell\n$$\n$$\n= \\frac{q_0}{\\Sigma_t}(\\exp(\\Sigma_t \\ell)-1) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right)\\exp(\\Sigma_t \\ell) - \\left(-\\frac{1}{\\Sigma_t^2}\\right) \\right)\n$$\n将此结果代入 $\\psi(\\ell)$ 的解并化简：\n$$\n\\psi(\\ell) = \\psi(0)\\exp(-\\Sigma_t \\ell) + \\frac{q_0}{\\Sigma_t}(1-\\exp(-\\Sigma_t \\ell)) + q_1 \\left( \\left(\\frac{\\ell}{\\Sigma_t} - \\frac{1}{\\Sigma_t^2}\\right) + \\frac{1}{\\Sigma_t^2}\\exp(-\\Sigma_t \\ell) \\right)\n$$\n回顾 $q_0 = q(0)$ 和 $q_0+q_1\\ell = q(\\ell)$，通过将含有 $\\exp(-\\Sigma_t \\ell)$ 的项归并，可以得到一个更标准的形式：\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(0)+q_1\\ell}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n$$\n\\psi(\\ell) = \\left( \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} \\right) \\exp(-\\Sigma_t \\ell) + \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2}\n$$\n\n**4. 最终计算**\n\n现在我们代入给定的数值。\n首先，计算线段长度 $\\ell$：\n$$\n\\ell = \\|\\mathbf{r}_{\\mathrm{out}} - \\mathbf{r}_{\\mathrm{in}}\\|_2 = \\|(0.2-0.1, 0.3-0.2, 0.15-0.1)\\|_2 = \\|(0.1, 0.1, 0.05)\\|_2\n$$\n$$\n\\ell = \\sqrt{(0.1)^2 + (0.1)^2 + (0.05)^2} = \\sqrt{0.01 + 0.01 + 0.0025} = \\sqrt{0.0225} = 0.15\n$$\n接下来，使用 $\\mathbf{S}=(0.4, 0.6, 0.5, 0.3)^\\top$ 计算源值 $q(0)$ 和 $q(\\ell)$：\n$$\nq(0) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{in}} = (0.4)(0.6) + (0.6)(0.1) + (0.5)(0.2) + (0.3)(0.1) = 0.24 + 0.06 + 0.10 + 0.03 = 0.43\n$$\n$$\nq(\\ell) = \\mathbf{S}^\\top \\boldsymbol{\\lambda}_{\\mathrm{out}} = (0.4)(0.35) + (0.6)(0.2) + (0.5)(0.3) + (0.3)(0.15) = 0.14 + 0.12 + 0.15 + 0.045 = 0.455\n$$\n由此，我们求出源斜率参数 $q_1$：\n$$\nq_1 = \\frac{q(\\ell) - q(0)}{\\ell} = \\frac{0.455 - 0.43}{0.15} = \\frac{0.025}{0.15} = \\frac{25}{150} = \\frac{1}{6}\n$$\n剩余的值为：$\\psi(0)=1.5$，$\\Sigma_t=2$。我们来计算 $\\psi(\\ell)$ 表达式中的系数。\n光学厚度为 $\\Sigma_t \\ell = 2 \\times 0.15 = 0.3$。\n指数项的系数是：\n$$\nC_1 = \\psi(0) - \\frac{q(0)}{\\Sigma_t} + \\frac{q_1}{\\Sigma_t^2} = 1.5 - \\frac{0.43}{2} + \\frac{1/6}{2^2} = \\frac{3}{2} - \\frac{0.43}{2} + \\frac{1}{24} = \\frac{3}{2} - \\frac{43}{200} + \\frac{1}{24}\n$$\n$2$、$200$ 和 $24$ 的最小公分母是 $600$。\n$$\nC_1 = \\frac{3 \\times 300}{600} - \\frac{43 \\times 3}{600} + \\frac{1 \\times 25}{600} = \\frac{900 - 129 + 25}{600} = \\frac{796}{600} = \\frac{199}{150}\n$$\n常数项是：\n$$\nC_2 = \\frac{q(\\ell)}{\\Sigma_t} - \\frac{q_1}{\\Sigma_t^2} = \\frac{0.455}{2} - \\frac{1/6}{2^2} = \\frac{0.455}{2} - \\frac{1}{24} = \\frac{455}{2000} - \\frac{1}{24} = \\frac{91}{400} - \\frac{1}{24}\n$$\n$400$ 和 $24$ 的最小公分母是 $1200$。\n$$\nC_2 = \\frac{91 \\times 3}{1200} - \\frac{1 \\times 50}{1200} = \\frac{273 - 50}{1200} = \\frac{223}{1200}\n$$\n综合这些结果，出口通量的最终表达式为：\n$$\n\\psi(\\ell) = C_1 \\exp(-\\Sigma_t \\ell) + C_2 = \\frac{199}{150} \\exp(-0.3) + \\frac{223}{1200}\n$$\n我们也可以将指数写成分数形式，$-0.3 = -3/10$：\n$$\n\\psi(\\ell) = \\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}\n$$\n这就是出口角通量的最终闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{199}{150} \\exp\\left(-\\frac{3}{10}\\right) + \\frac{223}{1200}}$$"
        },
        {
            "introduction": "在开发输运计算程序时，选择合适的空间离散格式至关重要，因为它直接影响解的准确性和物理真实性。本实践将对比三种一维平板几何中的经典方法：阶梯特征线法(Step Characteristics, SC)、菱形差分法(Diamond Difference, DD)和线性特征线法(Linear Characteristics, LC)。通过实现这些方法并分析它们在不同光学厚度下的表现，你将亲身体验到为何某些格式（如DD）可能产生非物理振荡，并理解LC等特征线方法所固有的稳定性优势。",
            "id": "4233836",
            "problem": "考虑一个宽度为 $\\Delta$（单位 $\\mathrm{cm}$）的一维板元，其材料总宏观截面为 $\\Sigma_t$（单位 $\\mathrm{cm}^{-1}$），均匀各向同性体积源密度为 $Q$（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$）。沿着由方向余弦 $\\mu \\in (0,1]$ 表征的单个离散纵标方向，稳态线性玻尔兹曼输运方程简化为以下一维常微分方程\n$$\n\\mu \\frac{d \\psi(x)}{dx} + \\Sigma_t \\psi(x) = q(x),\n$$\n其中 $\\psi(x)$ 是角通量（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\mathrm{s}^{-1}$），$q(x)$ 是角源（单位 $\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$）。对于各向同性源密度 $Q$，角源在整个栅元内为 $q(x) = Q/2$。在左边界 $x = 0$ 处施加真空边界条件，因此对于 $\\mu > 0$ 的方向，入射角通量为 $\\psi(0) = 0$。目标是使用三种不同的空间离散化方法计算右边界 $x = \\Delta$ 处的出射角通量，记为 $\\psi(\\Delta)$：\n\n- 阶梯特征线法 (SC)：将源项视为在栅元内恒定，并在此假设下精确积分特征线。\n- 菱形差分法 (DD)：在栅元内对通量使用线性近似，并对流项使用中心离散。\n- 线性特征线法 (LC)：将源项视为在栅元内线性变化，并对线性源表示精确积分特征线。\n\n从给定的输运方程和边界条件出发，为 SC、DD 和 LC 格式推导单个栅元的更新关系式，该关系式将 $x = 0$ 处的入射边界通量和栅元源表示映射到 $x = \\Delta$ 处的出射边界通量。对于 LC，考虑一个通用的线性源参数化 $q(x) = q_L + \\left(\\frac{x}{\\Delta}\\right)(q_R - q_L)$，然后将其特化为均匀源情况 $q_L = q_R = Q/2$ 以匹配物理设置。对每种格式，用 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\mathrm{s}^{-1}$ 作单位表示出射角通量 $\\psi(\\Delta)$。\n\n定义光学厚度 $\\tau$ 为 $\\tau = \\Sigma_t \\Delta / \\mu$。使用此参数分析每种格式下出射通量相对于入射通量的单调性。具体来说，确定每种格式是否满足 $\\frac{\\partial \\psi(\\Delta)}{\\partial \\psi(0)} \\ge 0$，并通过检查相对于 $\\psi(0)$ 的灵敏度是否为非负来报告菱形差分格式的单调性（作为布尔值）。\n\n编写一个完整的程序，为以下测试套件计算每种格式的出射角通量和菱形差分格式的单调性布尔值。对所有情况使用真空边界条件 $\\psi(0) = 0$。所有出射角通量均以 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\mathrm{s}^{-1}$ 为单位表示，并四舍五入到六位小数。\n\n测试套件参数：\n- 情况 $1$（中等光学厚度的一般情况）：$\\mu = 1$, $\\Delta = 1\\,\\mathrm{cm}$, $\\Sigma_t = 0.5\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$。\n- 情况 $2$（菱形差分法单调性的边界）：$\\mu = 1$, $\\Delta = 2\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$。\n- 情况 $3$（大光学厚度）：$\\mu = 0.2$, $\\Delta = 1\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$。\n- 情况 $4$（小光学厚度极限）：$\\mu = 1$, $\\Delta = 10^{-6}\\,\\mathrm{cm}$, $\\Sigma_t = 1\\,\\mathrm{cm}^{-1}$, $Q = 1\\,\\mathrm{n}\\,\\mathrm{cm}^{-3}\\mathrm{s}^{-1}$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果本身是一个包含四个条目的列表，顺序为 $[\\psi_{\\mathrm{SC}}(\\Delta), \\psi_{\\mathrm{DD}}(\\Delta), \\psi_{\\mathrm{LC}}(\\Delta), \\text{DD\\_monotone}]$。例如，输出应如下所示：$[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3],[a_4,b_4,c_4,d_4]]$，其中每个 $a_i$、$b_i$、$c_i$ 是以 $\\mathrm{n}\\,\\mathrm{cm}^{-2}\\mathrm{s}^{-1}$ 为单位、四舍五入到六位小数的浮点数，每个 $d_i$ 是一个布尔值。",
            "solution": "用户提供了一个来自核反应堆物理领域的有效、适定的问题陈述，具体涉及一维、稳态、单能线性玻尔兹曼输运方程的空间离散化。该问题具有科学依据、客观，并包含推导所要求的数值格式和计算给定测试用例结果所需的所有信息。\n\n在宽度为 $\\Delta$ 的板中，沿着离散方向 $\\mu \\in (0,1]$ 的角通量 $\\psi(x)$ 的控制常微分方程由下式给出：\n$$ \\mu \\frac{d\\psi(x)}{dx} + \\Sigma_t \\psi(x) = q(x) $$\n其中 $\\Sigma_t$ 是总宏观截面，$q(x)$ 是角源。对于均匀、各向同性的体积源 $Q$，角源是恒定的：$q(x) = Q/2$。在 $x=0$ 处的边界条件是 $\\psi(0) = 0$。我们的目标是使用三种不同的格式来求出射通量 $\\psi(\\Delta)$。\n\n首先，我们通过求解该常微分方程建立一个通用的解析框架。重新整理方程得到：\n$$ \\frac{d\\psi(x)}{dx} + \\frac{\\Sigma_t}{\\mu} \\psi(x) = \\frac{q(x)}{\\mu} $$\n这是一个一阶线性常微分方程。我们可以使用积分因子 $I(x) = \\exp\\left(\\int \\frac{\\Sigma_t}{\\mu} dx\\right) = \\exp\\left(\\frac{\\Sigma_t x}{\\mu}\\right)$ 来求解它。将该常微分方程乘以 $I(x)$ 并从 $x=0$ 到 $x=\\Delta$ 积分，得到形式解：\n$$ \\psi(\\Delta)e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - \\psi(0)e^0 = \\int_0^\\Delta \\frac{q(x')}{\\mu} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n求解 $\\psi(\\Delta)$ 并引入栅元光学厚度 $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$，我们得到：\n$$ \\psi(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta q(x') e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n这个形式解是基于特征线方法的基础。\n\n**1. 阶梯特征线法 (SC) 格式**\n\n阶梯特征线法格式假设源项在整个栅元内是恒定的，即 $q(x) = \\bar{q}$。对于给定的问题，源在物理上是恒定的，$q(x) = Q/2$，所以我们设 $\\bar{q} = Q/2$。将此代入形式解的积分中：\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{e^{-\\tau}}{\\mu} \\int_0^\\Delta \\frac{Q}{2} e^{\\frac{\\Sigma_t x'}{\\mu}} dx' $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\mu} \\left[ \\frac{\\mu}{\\Sigma_t} e^{\\frac{\\Sigma_t x'}{\\mu}} \\right]_0^\\Delta $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Qe^{-\\tau}}{2\\Sigma_t} \\left( e^{\\frac{\\Sigma_t \\Delta}{\\mu}} - 1 \\right) $$\n$$ \\psi_{SC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\n由于 SC 的假设与恒定源的物理现实相符，因此该格式为此问题提供了精确的解析解。对入射通量的灵敏度为 $\\frac{\\partial \\psi_{SC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau}$。由于 $\\tau > 0$，该灵敏度始终为正，意味着该格式是无条件单调的。\n\n**2. 菱形差分法 (DD) 格式**\n\n菱形差分法格式是通过在栅元宽度 $\\Delta$ 上对输运方程进行积分来推导的：\n$$ \\int_0^\\Delta \\left( \\mu \\frac{d\\psi}{dx} + \\Sigma_t \\psi(x) \\right) dx = \\int_0^\\Delta q(x) dx $$\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\bar{\\psi} = \\Delta \\bar{q} $$\n其中 $\\bar{\\psi}$ 和 $\\bar{q}$ 是栅元平均通量和源。DD 格式对通量采用线性近似，这意味着闭合关系为 $\\bar{\\psi} = \\frac{\\psi(0) + \\psi(\\Delta)}{2}$。对于恒定源，$\\bar{q} = Q/2$。将这些代入平衡方程：\n$$ \\mu[\\psi(\\Delta) - \\psi(0)] + \\Sigma_t \\Delta \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\Delta \\frac{Q}{2} $$\n为了求解 $\\psi(\\Delta)$，我们除以 $\\mu$ 并使用 $\\tau = \\Sigma_t \\Delta / \\mu$：\n$$ [\\psi(\\Delta) - \\psi(0)] + \\tau \\frac{\\psi(0) + \\psi(\\Delta)}{2} = \\frac{\\tau Q}{2\\Sigma_t} $$\n对 $\\psi(\\Delta)$ 和 $\\psi(0)$ 的项进行分组：\n$$ \\psi(\\Delta) \\left(1 + \\frac{\\tau}{2}\\right) = \\psi(0) \\left(1 - \\frac{\\tau}{2}\\right) + \\frac{\\tau Q}{2\\Sigma_t} $$\n$$ \\psi_{DD}(\\Delta) = \\frac{1 - \\tau/2}{1 + \\tau/2} \\psi(0) + \\frac{\\tau Q / (2\\Sigma_t)}{1 + \\tau/2} = \\frac{2-\\tau}{2+\\tau}\\psi(0) + \\frac{\\tau Q}{\\Sigma_t(2+\\tau)} $$\n对入射通量的灵敏度为 $\\frac{\\partial \\psi_{DD}(\\Delta)}{\\partial \\psi(0)} = \\frac{2-\\tau}{2+\\tau}$。为了使其为非负，并且由于对于物理问题 $2+\\tau > 0$，我们需要 $2-\\tau \\ge 0$。因此，DD 格式是单调的当且仅当 $\\tau \\le 2$。\n\n**3. 线性特征线法 (LC) 格式**\n\n线性特征线法格式与 SC 从相同的形式解出发，但假设源是线性变化的：$q(x) = q_L + \\frac{x}{\\Delta}(q_R - q_L)$。问题要求将其特化为均匀源情况，其中 $q_L = q_R = Q/2$。这个代换使得源项变为常数 $q(x) = Q/2$，这是一个零次多项式，因而是线性函数的一个特例。其推导过程与阶梯特征线法的情况完全相同：\n$$ \\psi_{LC}(\\Delta) = \\psi(0)e^{-\\tau} + \\frac{Q}{2\\Sigma_t} \\left( 1 - e^{-\\tau} \\right) $$\n与 SC 一样，LC 格式对于此问题是精确的，并且是无条件单调的，因为 $\\frac{\\partial \\psi_{LC}(\\Delta)}{\\partial \\psi(0)} = e^{-\\tau} > 0$。\n\n**用于实现的公式总结**\n\n对于所有情况，边界条件为 $\\psi(0) = 0$。光学厚度为 $\\tau = \\frac{\\Sigma_t \\Delta}{\\mu}$。\n- **SC 通量**：$\\psi_{SC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$。为了在 $\\tau \\to 0$ 时数值稳定，可以重写为 $\\psi_{SC}(\\Delta) = \\frac{Q\\Delta}{2\\mu} \\frac{1-e^{-\\tau}}{\\tau}$。\n- **DD 通量**：$\\psi_{DD}(\\Delta) = \\frac{\\tau Q}{\\Sigma_t(2+\\tau)}$。可以重写为 $\\psi_{DD}(\\Delta) = \\frac{Q\\Delta}{\\mu(2+\\tau)}$。\n- **LC 通量**：$\\psi_{LC}(\\Delta) = \\frac{Q}{2\\Sigma_t} (1 - e^{-\\tau})$，与 SC 相同。\n- **DD 单调性**：一个指示 $\\tau \\le 2$ 是否成立的布尔值。\n\n这些公式用于计算所提供的测试套件的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes outgoing angular flux for SC, DD, and LC schemes and checks\n    DD monotonicity for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (mu, delta, sigma_t, Q)\n        (1.0, 1.0, 0.5, 1.0),\n        (1.0, 2.0, 1.0, 1.0),\n        (0.2, 1.0, 1.0, 1.0),\n        (1.0, 1.0e-6, 1.0, 1.0),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        mu, delta, sigma_t, Q = case\n\n        # Calculate optical thickness\n        # This is guaranteed to be non-zero for the given test cases.\n        tau = sigma_t * delta / mu\n\n        # --- SC and LC Scheme ---\n        # The SC and LC schemes are identical and exact for a constant source.\n        # psi_sc_lc = (Q / (2 * sigma_t)) * (1 - np.exp(-tau))\n        # This form is numerically unstable as sigma_t -> 0 (and tau -> 0).\n        # A more stable form is derived by substituting sigma_t = tau * mu / delta:\n        # psi_sc_lc = (Q * delta / (2 * mu)) * (1 - exp(-tau)) / tau\n        # We use np.expm1 for precision with small tau.\n        # -expm1(-x) is equivalent to 1-exp(-x) but more accurate for small x.\n        if tau == 0.0:\n            # This is the streaming limit as tau -> 0\n            psi_sc_lc = (Q * delta) / (2 * mu)\n        else:\n            psi_sc_lc = (Q * delta / (2 * mu)) * (-np.expm1(-tau) / tau)\n        \n        psi_sc = psi_sc_lc\n        psi_lc = psi_sc_lc\n\n        # --- DD Scheme ---\n        # psi_dd = (tau * Q) / (sigma_t * (2 + tau))\n        # A more stable form is derived by substituting tau/sigma_t = delta/mu:\n        psi_dd = (Q * delta / mu) / (2 + tau)\n\n        # --- DD Monotonicity ---\n        # The scheme is monotonic if tau = 2.\n        dd_monotone = tau = 2\n\n        # Append results for the current case\n        all_results.append([psi_sc, psi_dd, psi_lc, dd_monotone])\n\n    # Format the final output string as per the problem specification.\n    # The output must be a single line, representing a list of lists.\n    # Each sub-list contains three floats rounded to 6 decimal places and a boolean.\n    output_parts = []\n    for res in all_results:\n        # str(res[3]) will correctly produce 'True' or 'False'\n        part = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f},{str(res[3])}]\"\n        output_parts.append(part)\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "验证数值计算程序的正确性是科学计算中的一个核心挑战，而“人造解方法”(Method of Manufactured Solutions, MMS)为此提供了一个严谨的框架。在此练习中，你将不再求解一个未知问题，而是从一个我们预先“制造”的光滑解析解出发，反向推导出必须的源项，从而构造一个具有已知精确解的输运问题。通过将你的LC程序计算结果与这个人造解进行比较，你能够精确地量化离散误差，并验证代码实现的正确性和收敛阶。",
            "id": "4233777",
            "problem": "考虑稳态、单能、一维平板几何中的中子输运方程，其中未知的角通量 $\\psi(x,\\mu)$ 满足\n$$\n\\mu\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\psi(x,\\mu) = q(x,\\mu),\n$$\n其中空间坐标 $x\\in[0,L]$，方向余弦 $\\mu\\in\\{-1,+1\\}$，宏观总截面 $\\Sigma_t(x)$ 的单位为 $\\mathrm{m}^{-1}$，角源 $q(x,\\mu)$ 的单位与之匹配。边界条件在入流边界上给定角通量值：\n$$\n\\psi(0,+1) = \\psi_{\\text{in}}^+(0),\\quad \\psi(L,-1) = \\psi_{\\text{in}}^-(L).\n$$\n\n采用解析解构造法定义一个已知的参考解 $\\psi(x,\\mu)$，并由此推导出源项 $q(x,\\mu)$ 和截面 $\\Sigma_t(x)$，使得输运方程恒成立。目标是实现一种线性特征线（LC）空间离散格式，并量化其与制造解相比的误差。\n\n构造的角通量选择为\n$$\n\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\sin(\\pi x),\n$$\n其中 $x$ 的单位为米，$\\mu\\in\\{-1,+1\\}$。设宏观总截面在每个空间网格内为分片常数，由一个光滑函数定义\n$$\n\\Sigma_t(x) = \\Sigma_0(1+\\alpha x),\n$$\n但在每个网格内取为常数，其值等于网格中心处的值。使输运方程成立的相应制造源为\n$$\nq(x,\\mu) = \\mu\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\psi(x,\\mu),\n$$\n其中导数为\n$$\n\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\pi\\cos(\\pi x).\n$$\n\n在覆盖 $x\\in[0,L]$ 的 $N$ 个网格的均匀网格上实现 LC 方法，网格边界位于 $x_i = i h$（$i=0,1,\\dots,N$），网格宽度为 $h = L/N$。对于每个网格 $i$，在从方向 $\\mu$ 的上游边界算起的局部坐标 $s\\in[0,h]$ 中，用一个线性函数来近似角源 $q(x,\\mu)$：\n$$\nq_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}s,\n$$\n该函数通过在两个边界上的精确源值之间进行线性插值来构造，插值时使用每个网格内的常数截面 $\\Sigma_{t,i}=\\Sigma_t(x_{i+\\frac{1}{2}})$，其中 $x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2$。具体来说，定义斜率\n$$\n\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h},\n$$\n并设置\n$$\nq_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i}),\\quad q_{i,1}^{(+1)} = \\Delta q_i^{(+1)},\n$$\n$$\nq_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i}),\\quad q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}.\n$$\n为清楚起见，$q(x,\\mu;\\Sigma_{t,i})$ 表示使用每个网格的常数截面 $\\Sigma_{t,i}$ 计算的制造源。\n\n在每个网格内，LC 方法使用具有常数 $\\Sigma_{t,i}$ 和线性源 $q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}s$ 的线性常微分方程的精确解，将角通量从上游边界向前推进距离 $d\\in[0,h]$。对于 $\\Sigma_{t,i}\\neq 0$，\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}}e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right).\n$$\n对于纯流区极限 $\\Sigma_{t,i} = 0$，\n$$\n\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}d + \\frac{1}{2}q_{i,1}^{(\\mu)}d^2.\n$$\n\n使用由所选 $\\psi(x,\\mu)$ 导出的制造入流边界条件：\n$$\n\\psi(0,+1) = 2,\\quad \\psi(L,-1) = 2.\n$$\n在 $\\mu=+1$ 方向上，从 $x=0$ 到 $x=L$ 逐个网格进行推进；在 $\\mu=-1$ 方向上，从 $x=L$ 到 $x=0$ 逐个网格进行推进。通过设置从相应的上游边界算起的距离 $d = h/2$，记录每个网格中心的 LC 近似角通量。将 LC 近似的中心值与制造的精确中心值 $\\psi(x_{i+\\frac{1}{2}},\\mu)$ 进行比较，并计算在两个方向和所有网格中心上的均方根（RMS）误差：\n$$\n\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}.\n$$\n\n您的程序必须实现上述过程，并为以下五个测试案例生成 $\\varepsilon_{\\text{RMS}}$ 的数值，结果表示为无量纲浮点数。空间长度 $L$ 必须以米（$\\mathrm{m}$）表示，宏观总截面参数必须以逆米（$\\mathrm{m}^{-1}$）表示。测试套件如下：\n- 案例 A（理想情况）：$L = 1.0\\,\\mathrm{m}$, $N = 40$, $\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}$, $\\alpha = 0.5$.\n- 案例 B（单网格边界条件检查）：$L = 1.0\\,\\mathrm{m}$, $N = 1$, $\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}$, $\\alpha = 0.5$.\n- 案例 C（强衰减）：$L = 1.0\\,\\mathrm{m}$, $N = 40$, $\\Sigma_0 = 10.0\\,\\mathrm{m}^{-1}$, $\\alpha = 0.0$.\n- 案例 D（为观察收敛行为而加密网格）：$L = 1.0\\,\\mathrm{m}$, $N = 200$, $\\Sigma_0 = 1.0\\,\\mathrm{m}^{-1}$, $\\alpha = 0.5$.\n- 案例 E（纯流区极限）：$L = 1.0\\,\\mathrm{m}$, $N = 40$, $\\Sigma_0 = 0.0\\,\\mathrm{m}^{-1}$, $\\alpha = 0.0$.\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\varepsilon_A,\\varepsilon_B,\\varepsilon_C,\\varepsilon_D,\\varepsilon_E]$，其中每个条目是相应案例的 RMS 误差。",
            "solution": "The user has provided a problem that requires the implementation and verification of a linear characteristic (LC) spatial discretization for the steady-state, monoenergetic, one-dimensional neutron transport equation. The verification is to be performed using the method of manufactured solutions (MMS).\n\n### Step 1: Extract Givens\n\n-   **Governing Equation**: $\\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu) = q(x,\\mu)$\n-   **Domain**: Spatial coordinate $x \\in [0,L]$, direction cosine $\\mu \\in \\{-1, +1\\}$.\n-   **Manufactured Angular Flux**: $\\psi(x,\\mu) = 2 + \\sin(2\\pi x) + \\mu\\,\\sin(\\pi x)$.\n-   **Manufactured Cross-Section Profile**: $\\Sigma_t(x) = \\Sigma_0\\,(1+\\alpha x)$.\n-   **Discretized Cross-Section**: For cell $i$, $\\Sigma_{t,i}$ is constant, evaluated at the cell center: $\\Sigma_{t,i} = \\Sigma_t(x_{i+\\frac{1}{2}})$.\n-   **Manufactured Source Definition**: $q(x,\\mu) = \\mu\\,\\frac{d\\psi(x,\\mu)}{dx} + \\Sigma_t(x)\\,\\psi(x,\\mu)$, with $\\frac{d\\psi(x,\\mu)}{dx} = 2\\pi\\cos(2\\pi x) + \\mu\\,\\pi\\cos(\\pi x)$.\n-   **Boundary Conditions**: $\\psi(0,+1) = \\psi_{\\text{in}}^+(0)$, $\\psi(L,-1) = \\psi_{\\text{in}}^-(L)$. Derived from the manufactured solution: $\\psi(0,+1) = 2$ and $\\psi(L,-1) = 2$.\n-   **Spatial Discretization**: Uniform mesh of $N$ cells over $[0,L]$. Cell width $h = L/N$. Cell edges $x_i = i\\,h$. Cell center $x_{i+\\frac{1}{2}} = (x_i + x_{i+1})/2$.\n-   **Linear Source Approximation within Cell $i$**: $q_i(s,\\mu) \\approx q_{i,0}^{(\\mu)} + q_{i,1}^{(\\mu)}\\,s$, where $s$ is the local coordinate from the upstream edge.\n    -   The source approximation uses the per-cell constant cross-section $\\Sigma_{t,i}$.\n    -   Slope: $\\Delta q_i^{(\\mu)} = \\frac{q(x_{i+1},\\mu;\\Sigma_{t,i}) - q(x_i,\\mu;\\Sigma_{t,i})}{h}$.\n    -   Coefficients for $\\mu=+1$: $q_{i,0}^{(+1)} = q(x_i,+1;\\Sigma_{t,i})$, $q_{i,1}^{(+1)} = \\Delta q_i^{(+1)}$.\n    -   Coefficients for $\\mu=-1$: $q_{i,0}^{(-1)} = q(x_{i+1},-1;\\Sigma_{t,i})$, $q_{i,1}^{(-1)} = -\\Delta q_i^{(-1)}$.\n-   **Linear Characteristic (LC) Propagator**:\n    -   For $\\Sigma_{t,i} \\neq 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}}\\,e^{-\\Sigma_{t,i} d} + \\frac{q_{i,0}^{(\\mu)}}{\\Sigma_{t,i}}\\left(1 - e^{-\\Sigma_{t,i} d}\\right) + q_{i,1}^{(\\mu)}\\left(\\frac{d}{\\Sigma_{t,i}} - \\frac{1 - e^{-\\Sigma_{t,i} d}}{\\Sigma_{t,i}^2}\\right)$.\n    -   For $\\Sigma_{t,i} = 0$: $\\psi_{\\text{out}} = \\psi_{\\text{in}} + q_{i,0}^{(\\mu)}\\,d + \\frac{1}{2}\\,q_{i,1}^{(\\mu)}\\,d^2$.\n-   **Numerical Evaluation**: The LC-approximated flux is to be calculated at each cell center, which corresponds to propagating over a distance $d = h/2$ from the upstream edge.\n-   **Error Metric**: Root-Mean-Square (RMS) error: $\\varepsilon_{\\text{RMS}} = \\sqrt{\\frac{1}{2N}\\sum_{i=0}^{N-1}\\sum_{\\mu\\in\\{-1,+1\\}}\\left(\\psi_{\\text{LC}}(x_{i+\\frac{1}{2}},\\mu) - \\psi(x_{i+\\frac{1}{2}},\\mu)\\right)^2}$.\n-   **Test Cases**:\n    -   Case A: $L=1.0, N=40, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case B: $L=1.0, N=1, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case C: $L=1.0, N=40, \\Sigma_0=10.0, \\alpha=0.0$.\n    -   Case D: $L=1.0, N=200, \\Sigma_0=1.0, \\alpha=0.5$.\n    -   Case E: $L=1.0, N=40, \\Sigma_0=0.0, \\alpha=0.0$.\n\n### Step 2: Validate Using Extracted Givens\n\n-   **Scientific Grounding**: The problem is grounded in the well-established field of neutron transport theory. The one-dimensional, steady-state, monoenergetic transport equation is a standard model. The method of manufactured solutions is a rigorous and widely used technique for code verification. The linear characteristic method is a known, valid numerical scheme. All formulas and concepts are standard in computational reactor physics.\n-   **Well-Posedness**: The problem is well-posed. The governing ODE, combined with the inflow boundary conditions, defines a unique solution. The numerical method is explicitly defined, including the discretization of the cross-section and source term, the propagation algorithm, and the error calculation. The test cases are well-defined and cover various physical regimes.\n-   **Objectivity**: The problem is stated in precise, objective, mathematical language. There are no subjective or ambiguous terms.\n-   **Consistency and Completeness**: The problem is self-contained. All necessary equations, parameters, and procedures are provided. The givens are internally consistent. For example, the boundary conditions are correctly derived from the manufactured solution at the specified boundaries. The discretization of the source term is defined with sufficient clarity to avoid ambiguity. The formulas for the LC propagator correctly represent the analytical solution of the underlying ODE for a linear source and constant coefficients.\n\n### Step 3: Verdict and Action\n\nThe problem statement is valid. It is a well-defined numerical methods exercise with clear instructions and verifiable goals. I will proceed with the solution.\n\n### Principle-Based Design\n\nThe solution is architected around a main function that orchestrates the numerical simulation for a given set of physical and numerical parameters. This function implements the transport sweep algorithm, a cornerstone of solving the Boltzmann transport equation. The algorithm proceeds direction by direction.\n\nFirst, for the positive direction ($\\mu=+1$), the domain is traversed from left to right ($x=0$ to $x=L$). The angular flux at the left boundary is known. This known flux serves as the incoming flux for the first spatial cell. The linear characteristic (LC) method is then applied to propagate the solution across the cell. The LC method relies on the analytical solution of the transport equation under the assumption of a piecewise constant cross-section and a piecewise linear source. The problem rigorously specifies how to obtain these piecewise approximations from the given continuous manufactured profiles.\n\nSpecifically, within each cell $i$, the following steps are performed:\n1.  The constant cross-section $\\Sigma_{t,i}$ is determined by evaluating the continuous profile $\\Sigma_t(x)$ at the cell's midpoint $x_{i+1/2}$.\n2.  The linear source approximation $q_i(s,+1) \\approx q_{i,0}^{(+1)} + q_{i,1}^{(+1)} s$ is constructed. The coefficients are determined by evaluating the manufactured source function (using the just-computed $\\Sigma_{t,i}$) at the cell edges $x_i$ and $x_{i+1}$ and performing linear interpolation.\n3.  The LC propagation formula is invoked twice. First, to compute the flux at the cell center ($d=h/2$), which is stored for the final error calculation. Second, to compute the flux at the cell's exit face ($d=h$), which becomes the known incoming flux for the next cell, $i+1$.\n\nThis process repeats for all cells, completing the sweep for $\\mu=+1$.\n\nNext, a similar process is executed for the negative direction ($\\mu=-1$). This sweep proceeds from right to left ($x=L$ to $x=0$). The known incoming flux at the right boundary initializes the process. For each cell, the source is again linearized based on its values at the cell edges (using the appropriate cell-constant $\\Sigma_{t,i}$), and the LC formulas propagate the solution from the upstream edge (now the right edge, $x_{i+1}$) to the cell center and then to the downstream edge ($x_i$).\n\nAfter both sweeps are complete, the numerically computed flux values at all cell centers for both directions are available. The root-mean-square (RMS) error is then calculated by comparing these numerical values to the exact manufactured solution evaluated at the same cell center locations. This RMS error quantifies the accuracy of the LC discretization for the given problem parameters.\n\nHelper functions are designed to encapsulate the mathematical definitions of the manufactured solution, its derivative, and the source term. A dedicated function for the LC propagator handles the two cases: non-zero cross-section ($\\Sigma_{t,i} \\neq 0$) and the pure streaming limit ($\\Sigma_{t,i}=0$), directly implementing the formulas provided in the problem statement. This modular design enhances clarity and correctness.\n\nThe entire process is repeated for each of the five test cases defined in the problem, and the resulting RMS errors are collected for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef psi_manufactured(x, mu):\n    \"\"\"Calculates the manufactured angular flux psi(x, mu).\"\"\"\n    return 2.0 + np.sin(2.0 * np.pi * x) + mu * np.sin(np.pi * x)\n\ndef dpsi_dx_manufactured(x, mu):\n    \"\"\"Calculates the derivative of the manufactured flux, dpsi/dx.\"\"\"\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x) + mu * np.pi * np.cos(np.pi * x)\n\ndef q_manufactured(x, mu, sigma_val):\n    \"\"\"\n    Calculates the manufactured source q(x, mu) for a given constant \n    cross-section value.\n    \"\"\"\n    psi_val = psi_manufactured(x, mu)\n    dpsi_dx_val = dpsi_dx_manufactured(x, mu)\n    return mu * dpsi_dx_val + sigma_val * psi_val\n\ndef lc_propagate(psi_in, q0, q1, sigma, d):\n    \"\"\"\n    Propagates the angular flux across a distance d using the Linear\n    Characteristic method.\n    \"\"\"\n    if sigma == 0.0:\n        # Pure streaming case\n        return psi_in + q0 * d + 0.5 * q1 * d**2\n    else:\n        # Case with non-zero cross-section\n        exp_term = np.exp(-sigma * d)\n        \n        # To avoid catastrophic cancellation for small sigma*d, one could use\n        # Taylor expansions or functions like expm1, but direct implementation\n        # is sufficient for the given problem parameters.\n        psi_out = (\n            psi_in * exp_term\n            + (q0 / sigma) * (1.0 - exp_term)\n            + q1 * (d / sigma - (1.0 - exp_term) / sigma**2)\n        )\n        return psi_out\n\ndef calculate_rms_error(L, N, Sigma0, alpha):\n    \"\"\"\n    Implements the full LC transport sweep and computes the RMS error against\n    the manufactured solution.\n    \"\"\"\n    h = L / N\n    x_edges = np.linspace(0.0, L, N + 1)\n    x_centers = x_edges[:-1] + h / 2\n    \n    total_squared_error = 0.0\n\n    # Sweep for mu = +1 (forward)\n    mu = 1.0\n    psi_edge = psi_manufactured(0.0, mu)  # Inflow boundary condition at x=0\n\n    for i in range(N):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi, downstream is xi1\n        q_up = q_manufactured(xi, mu, sigma_ti)\n        q_down = q_manufactured(xi1, mu, sigma_ti)\n        q0 = q_up\n        q1 = (q_down - q_up) / h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n\n    # Sweep for mu = -1 (backward)\n    mu = -1.0\n    psi_edge = psi_manufactured(L, mu)  # Inflow boundary condition at x=L\n\n    for i in range(N - 1, -1, -1):\n        xi, xi1 = x_edges[i], x_edges[i+1]\n        xc = x_centers[i]\n        \n        # Cell-constant cross-section at cell center\n        sigma_ti = Sigma0 * (1.0 + alpha * xc)\n        \n        # Linear source parameters\n        # Upstream edge is xi1, downstream is xi\n        q_up = q_manufactured(xi1, mu, sigma_ti)\n        q_down = q_manufactured(xi, mu, sigma_ti)\n        q0 = q_up # Per problem spec, q0 is at upstream edge\n        q1 = (q_down - q_up) / h # -(q_up - q_down)/h\n        \n        # Calculate flux at cell center (d = h/2 from upstream edge)\n        psi_lc_center = lc_propagate(psi_edge, q0, q1, sigma_ti, h / 2.0)\n        \n        # Compare with exact solution at cell center\n        psi_exact_center = psi_manufactured(xc, mu)\n        total_squared_error += (psi_lc_center - psi_exact_center)**2\n        \n        # Propagate to the next cell edge (d = h from upstream edge)\n        psi_edge = lc_propagate(psi_edge, q0, q1, sigma_ti, h)\n        \n    rms_error = np.sqrt(total_squared_error / (2.0 * N))\n    return rms_error\n\ndef solve():\n    \"\"\"\n    Defines and runs the test cases, then prints the results in the\n    specified format.\n    \"\"\"\n    test_cases = [\n        # Case A: happy path\n        (1.0, 40, 1.0, 0.5),\n        # Case B: single cell boundary condition check\n        (1.0, 1, 1.0, 0.5),\n        # Case C: strong attenuation\n        (1.0, 40, 10.0, 0.0),\n        # Case D: refinement for convergence behavior\n        (1.0, 200, 1.0, 0.5),\n        # Case E: pure streaming limit\n        (1.0, 40, 0.0, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        L, N, Sigma0, alpha = params\n        error = calculate_rms_error(L, N, Sigma0, alpha)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}