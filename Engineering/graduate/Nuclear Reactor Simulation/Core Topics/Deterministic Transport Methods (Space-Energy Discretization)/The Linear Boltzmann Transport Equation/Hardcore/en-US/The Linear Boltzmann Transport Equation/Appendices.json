{
    "hands_on_practices": [
        {
            "introduction": "The Linear Boltzmann Transport Equation, at its core, describes particle behavior along straight-line paths. This exercise  introduces the method of characteristics, a powerful analytical technique that transforms the transport equation into a simpler ordinary differential equation along these paths. By solving this, you will derive how the angular flux at a point is composed of the attenuated flux from an upstream boundary and the integrated contributions from all sources along the way, providing a foundational understanding of particle attenuation and source build-up.",
            "id": "4255574",
            "problem": "Consider the steady-state, monoenergetic linear Boltzmann transport equation (LBTE) for the angular flux $ \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) $ in a homogeneous medium with constant total macroscopic cross section $ \\Sigma_{t} $ and a constant, isotropic volumetric source $ Q $ that is independent of position, direction, and energy. Assume that the direction $ \\boldsymbol{\\Omega} $ is a unit vector and that scattering is already subsumed into $ Q $ so that no explicit scattering term appears. Let $ s $ denote the path-length coordinate along a straight characteristic in the direction $ \\boldsymbol{\\Omega} $, with $ s = 0 $ at an inflow boundary where the boundary value $ \\psi(0) = \\psi_{b} $ is prescribed, and $ s = L $ at an interior point a distance $ L $ along the characteristic.\n\nStarting from the LBTE and the definition of the directional derivative along characteristics, derive the characteristic ordinary differential equation governing $ \\psi(s) $, and solve it subject to the inflow boundary condition to obtain the closed-form expression for $ \\psi(L) $ as a function of $ \\Sigma_{t} $, $ Q $, $ \\psi_{b} $, and $ L $.\n\nExpress your final answer as a single analytic expression. No rounding is required. Do not include units in the final boxed answer.",
            "solution": "The steady-state, monoenergetic linear Boltzmann transport equation (LBTE) in a homogeneous medium with no explicit scattering term is given by:\n$$\n\\boldsymbol{\\Omega} \\cdot \\boldsymbol{\\nabla}\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}) = Q\n$$\nAlong a characteristic line in the direction $\\boldsymbol{\\Omega}$, the path-length coordinate is denoted by $s$. The directional derivative $\\boldsymbol{\\Omega} \\cdot \\boldsymbol{\\nabla}\\psi$ is equivalent to the total derivative of the angular flux with respect to the path length, $\\frac{d\\psi}{ds}$. The LBTE thus simplifies to a first-order ordinary differential equation (ODE) for $\\psi(s)$:\n$$\n\\frac{d\\psi(s)}{ds} + \\Sigma_t \\psi(s) = Q\n$$\nThis ODE can be solved using an integrating factor, $I(s) = \\exp\\left(\\int \\Sigma_t ds\\right) = \\exp(\\Sigma_t s)$. Multiplying the entire equation by $I(s)$ yields:\n$$\n\\exp(\\Sigma_t s) \\frac{d\\psi(s)}{ds} + \\Sigma_t \\exp(\\Sigma_t s) \\psi(s) = Q \\exp(\\Sigma_t s)\n$$\nThe left-hand side is the result of the product rule for differentiation, $\\frac{d}{ds} \\left( \\psi(s) \\exp(\\Sigma_t s) \\right)$. The equation becomes:\n$$\n\\frac{d}{ds} \\left( \\psi(s) \\exp(\\Sigma_t s) \\right) = Q \\exp(\\Sigma_t s)\n$$\nWe integrate this equation along the characteristic from the boundary at $s=0$ to the point of interest at $s=L$:\n$$\n\\int_0^L \\frac{d}{ds'} \\left( \\psi(s') \\exp(\\Sigma_t s') \\right) ds' = \\int_0^L Q \\exp(\\Sigma_t s') ds'\n$$\nApplying the Fundamental Theorem of Calculus:\n$$\n\\psi(L)\\exp(\\Sigma_t L) - \\psi(0)\\exp(0) = Q \\left[ \\frac{\\exp(\\Sigma_t s')}{\\Sigma_t} \\right]_0^L\n$$\nSubstituting the boundary condition $\\psi(0) = \\psi_b$:\n$$\n\\psi(L)\\exp(\\Sigma_t L) - \\psi_b = \\frac{Q}{\\Sigma_t} (\\exp(\\Sigma_t L) - 1)\n$$\nFinally, we solve for $\\psi(L)$ by isolating it:\n$$\n\\psi(L) = \\psi_b \\exp(-\\Sigma_t L) + \\frac{Q}{\\Sigma_t} (1 - \\exp(-\\Sigma_t L))\n$$\nThis expression shows that the angular flux at distance $L$ is the sum of the attenuated boundary flux and the contribution from the integrated source along the path, also attenuated.",
            "answer": "$$\n\\boxed{\\psi_{b} \\exp(-\\Sigma_{t} L) + \\frac{Q}{\\Sigma_{t}}(1 - \\exp(-\\Sigma_{t} L))}\n$$"
        },
        {
            "introduction": "Moving from a single particle path to the behavior of an entire system, we now explore one of the most critical applications of the LBTE: determining the criticality of a nuclear reactor. This problem  formulates the transport equation as a $k$-eigenvalue problem, where the eigenvalue $k$ represents the multiplication factor of the neutron population from one generation to the next. By applying the principle of global particle conservation to a slab with idealized reflecting boundaries, you will see how the condition for a self-sustaining chain reaction simplifies to a fundamental balance between neutron production and absorption.",
            "id": "4255610",
            "problem": "Consider a homogeneous, planar slab of width $a$ occupying $0 \\leq x \\leq a$, infinite in the transverse directions, containing a one-speed neutron population with isotropic scattering and isotropic fission emission. Let the macroscopic total cross section be $\\Sigma_{t}$, the macroscopic scattering cross section be $\\Sigma_{s}$, the macroscopic absorption cross section be $\\Sigma_{a} = \\Sigma_{t} - \\Sigma_{s}$, and the macroscopic fission production be $\\nu \\Sigma_{f}$, with $\\nu$ the average neutron yield per fission. The boundaries at $x=0$ and $x=a$ are perfectly reflecting. Define the angular flux $\\psi(x,\\mu)$ for direction cosine $\\mu \\in [-1,1]$, the scalar flux $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu$, and the current $J(x) = \\int_{-1}^{1} \\mu \\,\\psi(x,\\mu) \\,\\mathrm{d}\\mu$.\n\nStarting from the linear Boltzmann transport equation (LBTE),\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\,\\psi(x,\\mu) \\;=\\; \\frac{\\Sigma_{s}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' \\;+\\; \\frac{1}{k}\\,\\frac{\\nu \\Sigma_{f}}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\,\\mathrm{d}\\mu' \\,,\n$$\nformulate the $k$-eigenvalue problem for this slab with the appropriate reflective boundary conditions at $x=0$ and $x=a$, and use fundamental conservation principles implied by the LBTE to deduce the symmetry of the fundamental (lowest) eigenmode with respect to the mid-plane $x = a/2$.\n\nThen, derive the analytic expression for the fundamental $k$-eigenvalue $k_{0}$ in terms of $\\nu \\Sigma_{f}$ and $\\Sigma_{a}$ only. Report your final answer as a closed-form symbolic expression; do not approximate. No units are required for the final answer since $k_{0}$ is dimensionless.",
            "solution": "To find the fundamental eigenvalue $k_0$, we apply the principle of neutron conservation. First, we integrate the given LBTE over all angles $\\mu \\in [-1, 1]$ to obtain the neutron balance equation.\n$$\n\\int_{-1}^{1} \\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} d\\mu + \\int_{-1}^{1} \\Sigma_t \\psi(x,\\mu) d\\mu = \\int_{-1}^{1} \\frac{1}{2}\\left(\\Sigma_s + \\frac{\\nu\\Sigma_f}{k}\\right) \\phi(x) d\\mu\n$$\nUsing the definitions of current $J(x) = \\int_{-1}^{1} \\mu\\psi(x,\\mu) d\\mu$ and scalar flux $\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) d\\mu$, this simplifies to:\n$$\n\\frac{dJ(x)}{dx} + \\Sigma_t \\phi(x) = \\left(\\Sigma_s + \\frac{\\nu\\Sigma_f}{k}\\right) \\phi(x) \\int_{-1}^{1} \\frac{1}{2} d\\mu = \\left(\\Sigma_s + \\frac{\\nu\\Sigma_f}{k}\\right) \\phi(x)\n$$\nRearranging and using the definition $\\Sigma_a = \\Sigma_t - \\Sigma_s$, we get the local balance equation:\n$$\n\\frac{dJ(x)}{dx} + (\\Sigma_t - \\Sigma_s) \\phi(x) = \\frac{\\nu\\Sigma_f}{k} \\phi(x) \\implies \\frac{dJ(x)}{dx} + \\Sigma_a \\phi(x) = \\frac{\\nu\\Sigma_f}{k} \\phi(x)\n$$\nThis equation states that the net leakage from a differential volume (divergence of the current) plus the absorption rate must balance the production rate.\n\nNext, we integrate this balance equation over the entire slab width, from $x=0$ to $x=a$, to establish a global neutron balance:\n$$\n\\int_0^a \\frac{dJ(x)}{dx} dx + \\int_0^a \\Sigma_a \\phi(x) dx = \\int_0^a \\frac{\\nu\\Sigma_f}{k} \\phi(x) dx\n$$\nApplying the Fundamental Theorem of Calculus to the first term and factoring out the constant cross sections:\n$$\nJ(a) - J(0) + \\Sigma_a \\int_0^a \\phi(x) dx = \\frac{\\nu\\Sigma_f}{k} \\int_0^a \\phi(x) dx\n$$\nThe problem specifies perfectly reflecting boundary conditions. A perfectly reflecting boundary implies that any particle leaving is replaced by one entering in the opposite direction, resulting in zero net current across the boundary. Therefore, $J(0)=0$ and $J(a)=0$. The total leakage from the system is zero.\n\nThe global balance equation simplifies to a statement that total absorption must equal total production:\n$$\n\\Sigma_a \\int_0^a \\phi(x) dx = \\frac{\\nu\\Sigma_f}{k} \\int_0^a \\phi(x) dx\n$$\nFor a critical system to exist, there must be a non-zero neutron population, meaning the scalar flux $\\phi(x)$ cannot be zero everywhere. Thus, the integral $\\int_0^a \\phi(x) dx$ must be positive. We can safely divide both sides by this integral, which leaves a condition on the cross sections and the eigenvalue $k_0$:\n$$\n\\Sigma_a = \\frac{\\nu\\Sigma_f}{k_0}\n$$\nSolving for the fundamental eigenvalue $k_0$ gives the final expression:\n$$\nk_0 = \\frac{\\nu\\Sigma_f}{\\Sigma_a}\n$$\nThis result confirms that in a system with no neutron leakage, criticality depends solely on the ratio of neutron production to absorption.",
            "answer": "$$\\boxed{\\frac{\\nu \\Sigma_{f}}{\\Sigma_{a}}}$$"
        },
        {
            "introduction": "While analytical solutions provide invaluable physical insight, most real-world transport scenarios require numerical methods. This final practice exercise  takes you from theory to computation by implementing the backbone of modern transport solvers: the discrete ordinates ($S_N$) method combined with a spatial differencing scheme. You will write a program to perform a single 'sweep' across a spatial mesh, calculating the angular flux for a set of discrete directions. This provides a tangible feel for the source iteration process and is a crucial first step in building a complete computational transport code.",
            "id": "4255613",
            "problem": "Consider a one-dimensional slab geometry for steady-state neutron transport with isotropic scattering and a spatially constant volumetric external source. The fundamental base is the one-speed, one-dimensional form of the linear Boltzmann transport equation for the angular flux $\\psi(x,\\mu)$,\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x),\n$$\nwhere $x$ is position in $\\text{cm}$ along the slab, $\\mu$ is the direction cosine, $\\Sigma_t$ is the macroscopic total cross section in $\\text{cm}^{-1}$, $\\Sigma_s$ is the macroscopic scattering cross section in $\\text{cm}^{-1}$, $q$ is the constant isotropic volumetric source in $\\text{n}/\\text{cm}^3\\text{-s-sr}$, and $\\phi(x)$ is the scalar flux in $\\text{n}/\\text{cm}^2\\text{-s}$. The scalar flux is defined as\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu.\n$$\n\nUse the discrete ordinates (also known as $S_N$) method at the $S_2$ level with Gaussâ€“Legendre quadrature, which employs two directions $\\mu_1 = +1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$ with weights $w_1 = 1$ and $w_2 = 1$. Apply the diamond difference spatial discretization on a uniform mesh of $N$ cells of width $h = L/N$, where $L$ is the slab thickness in $\\text{cm}$. Impose boundary conditions through specified incoming angular fluxes for the two discrete directions at the vacuum or incident boundaries.\n\nPerform a single source iteration starting from the initial guess $\\phi^{(0)}(x) = 0$ (so the scattering source is null on this iteration). Execute one full $S_2$ sweep: for $\\mu_10$, sweep left-to-right using the left boundary incoming condition, and for $\\mu_20$, sweep right-to-left using the right boundary incoming condition. Within each cell, use the diamond difference relation between cell-edge and cell-averaged angular fluxes to update the outgoing edge angular flux given the incoming edge angular flux and the cell source. After completing both directional sweeps, compute the first-iteration scalar flux $\\phi^{(1)}(x)$ at each cell center from the two cell-averaged angular fluxes and the $S_2$ weights.\n\nUnits must be adhered to as follows: report the final scalar flux values in $\\text{n}/\\text{cm}^2\\text{-s}$. Angles are not used explicitly; direction cosines $\\mu$ are dimensionless.\n\nImplement this procedure as a complete, runnable program. Your program must solve the following test suite and aggregate the results exactly as specified. For each test case, return the list of cell-centered first-iteration scalar flux values $\\phi^{(1)}$ as floating-point numbers. The program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets, with each floating-point number formatted to six decimal places (for example, $[\\,[0.123456,0.234567],\\,[0.345678,0.456789]\\,]$).\n\nTest suite (all parameters are constant over space within a case):\n\n- Test case $1$ (happy path, vacuum boundaries):\n  - Slab thickness $L = 10\\,\\text{cm}$, number of cells $N = 20$, $\\Sigma_t = 1.0\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.9\\,\\text{cm}^{-1}$, external source $q = 0.2\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: incoming angular flux $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$ at $x=0$ and $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$ at $x=L$ (vacuum at both ends).\n\n- Test case $2$ (pure absorber, vacuum boundaries):\n  - Slab thickness $L = 5\\,\\text{cm}$, number of cells $N = 10$, $\\Sigma_t = 1.0\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.0\\,\\text{cm}^{-1}$, external source $q = 0.1\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\n- Test case $3$ (incident beam at left boundary, vacuum at right):\n  - Slab thickness $L = 3\\,\\text{cm}$, number of cells $N = 6$, $\\Sigma_t = 0.5\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.4\\,\\text{cm}^{-1}$, external source $q = 0.0\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 1.0\\,\\text{n}/\\text{cm}^2\\text{-s-sr}$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\n- Test case $4$ (thin slab, moderate absorption, vacuum boundaries):\n  - Slab thickness $L = 2\\,\\text{cm}$, number of cells $N = 4$, $\\Sigma_t = 0.2\\,\\text{cm}^{-1}$, $\\Sigma_s = 0.0\\,\\text{cm}^{-1}$, external source $q = 0.05\\,\\text{n}/\\text{cm}^3\\text{-s-sr}$.\n  - Boundary conditions: $\\psi_{\\text{inc},\\text{left}}(\\mu_1) = 0$, $\\psi_{\\text{inc},\\text{right}}(\\mu_2) = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of lists enclosed in square brackets (e.g., $[\\,[\\phi_1^{(1)}(x_1),\\ldots,\\phi_1^{(1)}(x_N)],\\,[\\phi_2^{(1)}(x_1),\\ldots,\\phi_2^{(1)}(x_N)],\\,[\\phi_3^{(1)}(x_1),\\ldots,\\phi_3^{(1)}(x_N)],\\,[\\phi_4^{(1)}(x_1),\\ldots,\\phi_4^{(1)}(x_N)]\\,]$), with each floating-point number formatted to six decimal places and interpreted in $\\text{n}/\\text{cm}^2\\text{-s}$.",
            "solution": "The problem is valid as it presents a well-posed, scientifically grounded scenario in the field of computational neutron transport. All parameters, boundary conditions, and numerical methods are clearly defined, enabling a unique solution for the requested first iteration. The procedures and physical model are standard in nuclear engineering education and practice. We shall proceed with the derivation and implementation of the specified algorithm.\n\nThe problem requires the numerical solution of the one-speed, one-dimensional, steady-state linear Boltzmann transport equation for a slab geometry with isotropic scattering and a constant external source. The governing equation for the angular neutron flux $\\psi(x,\\mu)$ is:\n$$\n\\mu \\,\\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t \\,\\psi(x,\\mu) = Q(x,\\mu)\n$$\nwhere $x \\in [0, L]$ is the spatial coordinate, $\\mu \\in [-1, 1]$ is the cosine of the angle with the positive $x$-axis, $\\Sigma_t$ is the macroscopic total cross section, and $Q(x,\\mu)$ is the total source of neutrons. For this problem, the source is composed of an external volumetric source $q$ and a scattering source term:\n$$\nQ(x,\\mu) = q + \\frac{\\Sigma_s}{2}\\,\\phi(x)\n$$\nHere, $\\Sigma_s$ is the macroscopic scattering cross section and $\\phi(x)$ is the scalar flux, defined as the integral of the angular flux over all directions:\n$$\n\\phi(x) = \\int_{-1}^{1}\\psi(x,\\mu)\\,d\\mu\n$$\n\nThe discrete ordinates ($S_N$) method is employed to solve this equation. This method discretizes the angular variable $\\mu$ into a set of discrete directions $\\{\\mu_m\\}$ with corresponding quadrature weights $\\{w_m\\}$. The problem specifies an $S_2$ treatment with Gauss-Legendre quadrature, which yields two directions $\\mu_1 = 1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$, each with a weight $w_m=1$. This transforms the single integro-differential equation into a system of coupled ordinary differential equations, one for each discrete direction $\\mu_m$:\n$$\n\\mu_m \\,\\frac{d \\psi_m(x)}{dx} + \\Sigma_t \\,\\psi_m(x) = q + \\frac{\\Sigma_s}{2}\\,\\sum_{j=1}^{2} w_j \\psi_j(x)\n$$\nwhere $\\psi_m(x) \\equiv \\psi(x,\\mu_m)$ and the scalar flux is approximated by the quadrature sum $\\phi(x) \\approx \\sum_{j=1}^{2} w_j \\psi_j(x)$.\n\nThe spatial domain $[0, L]$ is discretized into $N$ uniform cells, each of width $h = L/N$. Let cell $i$ span the interval $[x_{i-1/2}, x_{i+1/2}]$. Integrating the discrete ordinates equation over cell $i$ yields a balance equation:\n$$\n\\mu_m (\\psi_{m,i+1/2} - \\psi_{m,i-1/2}) + \\Sigma_t h \\bar{\\psi}_{m,i} = h \\bar{S}_{m,i}\n$$\nHere, $\\psi_{m,i\\pm1/2}$ are the angular fluxes at the cell edges and $\\bar{\\psi}_{m,i}$ and $\\bar{S}_{m,i}$ are the cell-averaged angular flux and source, respectively. The source term for the first iteration, starting from an initial guess of zero scalar flux ($\\phi^{(0)}(x) = 0$), is simply the constant external source $\\bar{S}_{m,i} = q$.\n\nTo close this system, the diamond difference (DD) spatial discretization scheme is used. This scheme relates the cell-averaged flux to the cell-edge fluxes via a linear interpolation:\n$$\n\\bar{\\psi}_{m,i} = \\frac{\\psi_{m,i+1/2} + \\psi_{m,i-1/2}}{2}\n$$\nSubstituting the DD relation into the balance equation, we can derive an explicit formula for the outgoing flux from a cell as a function of the incoming flux. We use the absolute value of the direction cosine, $|\\mu_m|$, to provide a unified expression.\n\nFor a sweep in the direction of increasing $x$ ($\\mu_m  0$), the incoming flux to cell $i$ is $\\psi_{m,i-1/2}$ and the outgoing flux is $\\psi_{m,i+1/2}$. The update formula is:\n$$\n\\psi_{m,i+1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i-1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\nFor a sweep in the direction of decreasing $x$ ($\\mu_m  0$), the incoming flux to cell $i$ is $\\psi_{m,i+1/2}$ and the outgoing flux is $\\psi_{m,i-1/2}$. The update formula is:\n$$\n\\psi_{m,i-1/2} = \\frac{|\\mu_m| - \\frac{\\Sigma_t h}{2}}{|\\mu_m| + \\frac{\\Sigma_t h}{2}} \\psi_{m,i+1/2} + \\frac{h q}{|\\mu_m| + \\frac{\\Sigma_t h}{2}}\n$$\n\nThe overall algorithm for a single source iteration is as follows:\n1.  **Initialization**: Define problem parameters $L, N, \\Sigma_t, \\Sigma_s, q$, and boundary conditions. Calculate cell width $h=L/N$. The quadrature set is $\\mu_1 = 1/\\sqrt{3}$, $\\mu_2 = -1/\\sqrt{3}$, and $w_1 = w_2 = 1$. The initial scalar flux is $\\phi^{(0)}(x) = 0$, so the scattering source term is zero for this iteration.\n2.  **Sweep for $\\mu_1  0$ (Left-to-Right)**:\n    - Initialize the cell-edge angular flux at the left boundary $\\psi_{1,1/2} = \\psi_{\\text{inc},\\text{left}}(\\mu_1)$.\n    - For each cell $i=1, \\dots, N$, calculate the outgoing edge flux $\\psi_{1,i+1/2}$ using the incoming flux $\\psi_{1,i-1/2}$ and the first update formula.\n    - Store all edge fluxes $\\psi_{1,i-1/2}$ for $i=1, \\dots, N+1$.\n3.  **Sweep for $\\mu_2  0$ (Right-to-Left)**:\n    - Initialize the cell-edge angular flux at the right boundary $\\psi_{2,N+1/2} = \\psi_{\\text{inc},\\text{right}}(\\mu_2)$.\n    - For each cell $i=N, \\dots, 1$ (in reverse), calculate the outgoing edge flux $\\psi_{2,i-1/2}$ using the incoming flux $\\psi_{2,i+1/2}$ and the second update formula.\n    - Store all edge fluxes $\\psi_{2,i-1/2}$ for $i=1, \\dots, N+1$.\n4.  **Scalar Flux Update**:\n    - For each cell $i=1, \\dots, N$:\n    - Calculate the cell-averaged angular flux for direction 1 using the DD relation: $\\bar{\\psi}^{(1)}_{1,i} = (\\psi_{1,i+1/2} + \\psi_{1,i-1/2})/2$.\n    - Calculate the cell-averaged angular flux for direction 2: $\\bar{\\psi}^{(1)}_{2,i} = (\\psi_{2,i+1/2} + \\psi_{2,i-1/2})/2$.\n    - Compute the new cell-averaged scalar flux $\\bar{\\phi}^{(1)}_i$ using the $S_2$ quadrature formula:\n        $$\n        \\bar{\\phi}^{(1)}_i = w_1 \\bar{\\psi}^{(1)}_{1,i} + w_2 \\bar{\\psi}^{(1)}_{2,i} = \\bar{\\psi}^{(1)}_{1,i} + \\bar{\\psi}^{(1)}_{2,i}\n        $$\nThis procedure is implemented for each test case to produce the list of cell-centered scalar fluxes, $\\bar{\\phi}^{(1)}_i$.",
            "answer": "```python\nimport numpy as np\n\ndef s2_diamond_difference_iteration(L, N, Sigma_t, Sigma_s, q, psi_inc_left, psi_inc_right):\n    \"\"\"\n    Performs a single S2 source iteration with diamond differencing for a 1D slab.\n\n    Args:\n        L (float): Slab thickness in cm.\n        N (int): Number of spatial cells.\n        Sigma_t (float): Macroscopic total cross section in cm^-1.\n        Sigma_s (float): Macroscopic scattering cross section in cm^-1. (Not used in first iteration).\n        q (float): Isotropic volumetric source in n/cm^3-s-sr.\n        psi_inc_left (float): Incoming angular flux for mu>0 at x=0.\n        psi_inc_right (float): Incoming angular flux for mu0 at x=L.\n\n    Returns:\n        list[float]: A list of cell-centered scalar flux values for the first iteration.\n    \"\"\"\n    # S2 Gauss-Legendre quadrature set\n    mu = 1.0 / np.sqrt(3.0)\n    w = 1.0  # weights for both directions are 1\n\n    # Spatial discretization\n    h = L / N\n    \n    # In this first iteration, the scattering source is zero because phi_guess = 0.\n    # The total source Q is therefore just the external source q.\n    source = q\n\n    # Arrays to store cell-edge angular fluxes.\n    # Indices 0 to N correspond to spatial locations x_0, x_1, ..., x_N.\n    psi1_edge = np.zeros(N + 1)  # For mu1 > 0\n    psi2_edge = np.zeros(N + 1)  # For mu2  0\n\n    # ----- Sweep for mu1 > 0 (left-to-right) -----\n    psi1_edge[0] = psi_inc_left\n    \n    # Coefficients for the diamond difference update rule.\n    # These are the same for mu1 and mu2 because the formula uses |mu|.\n    # psi_out = C1 * psi_in + C2\n    C1_num = mu - Sigma_t * h / 2.0\n    C_den = mu + Sigma_t * h / 2.0\n    C1 = C1_num / C_den\n    C2 = h * source / C_den\n\n    # Sweep across the cells from left to right\n    for i in range(N):\n        psi1_edge[i + 1] = C1 * psi1_edge[i] + C2\n\n    # ----- Sweep for mu2  0 (right-to-left) -----\n    psi2_edge[N] = psi_inc_right\n    \n    # Sweep across the cells from right to left\n    for i in range(N - 1, -1, -1):\n        psi2_edge[i] = C1 * psi2_edge[i + 1] + C2\n\n    # ---- Calculate new cell-centered scalar flux -----\n    phi_cell_center = np.zeros(N)\n    for i in range(N):\n        # Cell-average angular flux using the diamond difference relation\n        psi1_cell_avg = (psi1_edge[i] + psi1_edge[i + 1]) / 2.0\n        psi2_cell_avg = (psi2_edge[i] + psi2_edge[i + 1]) / 2.0\n        \n        # Update scalar flux using S2 quadrature rule (w1=1, w2=1)\n        phi_cell_center[i] = w * psi1_cell_avg + w * psi2_cell_avg\n        \n    return list(phi_cell_center)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1: L=10, N=20, St=1.0, Ss=0.9, q=0.2, BCs: 0, 0\n        (10.0, 20, 1.0, 0.9, 0.2, 0.0, 0.0),\n        # Case 2: L=5, N=10, St=1.0, Ss=0.0, q=0.1, BCs: 0, 0\n        (5.0, 10, 1.0, 0.0, 0.1, 0.0, 0.0),\n        # Case 3: L=3, N=6, St=0.5, Ss=0.4, q=0.0, BCs: 1.0, 0\n        (3.0, 6, 0.5, 0.4, 0.0, 1.0, 0.0),\n        # Case 4: L=2, N=4, St=0.2, Ss=0.0, q=0.05, BCs: 0, 0\n        (2.0, 4, 0.2, 0.0, 0.05, 0.0, 0.0)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = s2_diamond_difference_iteration(*case)\n        all_results.append(result)\n\n    # Format the output string exactly as required\n    formatted_lists = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places\n        formatted_numbers = [f\"{val:.6f}\" for val in res_list]\n        # Create the inner list string: \"[num1,num2,...]\"\n        inner_list_str = \"[\" + \",\".join(formatted_numbers) + \"]\"\n        formatted_lists.append(inner_list_str)\n    \n    # Create the final outer list string: \"[[...],[...]]\"\n    final_output_str = \"[\" + \",\".join(formatted_lists) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}