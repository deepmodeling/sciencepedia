{
    "hands_on_practices": [
        {
            "introduction": "Understanding a numerical method's strengths often involves comparing it with alternatives. This first practice contrasts the Step Characteristic (SC) method with the classic Diamond Difference (DD) scheme. By analyzing a case where DD produces unphysical negative results, you will gain a practical appreciation for the inherent positivity of the SC method, a crucial property for any reliable transport simulation. ",
            "id": "4252019",
            "problem": "Consider a one-dimensional slab cell of width $\\Delta x$ in a steady-state, monoenergetic Discrete Ordinates Method (DOM) calculation. For a single ordinate direction with direction cosine $\\mu \\in (0,1]$, the angular flux $\\psi(x)$ in the cell satisfies the first-order linear transport equation\n$$\n\\mu \\frac{d \\psi(x)}{dx} + \\Sigma_{t} \\psi(x) = Q,\n$$\nwith total macroscopic cross section $\\Sigma_{t} > 0$ and a constant volumetric source $Q \\ge 0$ over the cell. Let the incoming face be at $x = x_{i-1/2}$ with known incoming angular flux $\\psi_{i-1/2} \\equiv \\psi(x_{i-1/2})$, and the outgoing face at $x = x_{i+1/2}$ with unknown outgoing angular flux $\\psi_{i+1/2} \\equiv \\psi(x_{i+1/2})$. Define the optical thickness in the ordinate direction as\n$$\n\\tau \\equiv \\frac{\\Sigma_{t} \\Delta x}{\\mu}.\n$$\nStarting from the transport equation, derive:\n- The Diamond Difference (DD) face-to-face update by integrating the cell balance and closing with the linear average $\\bar{\\psi} = (\\psi_{i-1/2} + \\psi_{i+1/2})/2$.\n- The Step Characteristic (SC) face-to-face update by solving the differential equation exactly over the cell with constant coefficients.\n\nUsing these two updates, analyze the possibility of producing a negative outgoing flux under identical optical thickness and source conditions. Take a counterexample with no volumetric source, $Q = 0$, and optical thickness $\\tau = 3$, with a positive incoming flux $\\psi_{i-1/2} > 0$.\n\nCompute the normalized difference between the SC and DD outgoing face fluxes,\n$$\nD \\equiv \\frac{\\psi_{i+1/2}^{\\mathrm{SC}} - \\psi_{i+1/2}^{\\mathrm{DD}}}{\\psi_{i-1/2}},\n$$\nfor the specified conditions, and provide its numerical value rounded to five significant figures. Express your final answer as a dimensionless number (no units).",
            "solution": "We start from the one-dimensional steady-state monoenergetic transport equation for a single ordinate direction with direction cosine $\\mu \\in (0,1]$:\n$$\n\\mu \\frac{d \\psi(x)}{dx} + \\Sigma_{t} \\psi(x) = Q,\n$$\nwhere $\\Sigma_{t} > 0$ and the source $Q \\ge 0$ is constant in the cell.\n\nDefine the left (incoming) face angular flux as $\\psi_{i-1/2} = \\psi(x_{i-1/2})$, the right (outgoing) face angular flux as $\\psi_{i+1/2} = \\psi(x_{i+1/2})$, and the cell width $\\Delta x = x_{i+1/2} - x_{i-1/2}$. The optical thickness along direction $\\mu$ is\n$$\n\\tau \\equiv \\frac{\\Sigma_{t} \\Delta x}{\\mu}.\n$$\n\nDiamond Difference (DD) update. We derive DD from the integrated cell balance. Integrating the transport equation over $x \\in [x_{i-1/2}, x_{i+1/2}]$,\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\mu \\frac{d \\psi}{dx} + \\Sigma_{t} \\psi \\right) \\, dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} Q \\, dx.\n$$\nThe left-hand side separates as\n$$\n\\mu \\left[ \\psi_{i+1/2} - \\psi_{i-1/2} \\right] + \\Sigma_{t} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\psi(x) \\, dx = Q \\Delta x.\n$$\nIntroduce the cell-average angular flux\n$$\n\\bar{\\psi} \\equiv \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\psi(x) \\, dx,\n$$\ngiving the exact cell balance\n$$\n\\mu \\left( \\psi_{i+1/2} - \\psi_{i-1/2} \\right) + \\Sigma_{t} \\Delta x \\, \\bar{\\psi} = Q \\Delta x.\n$$\nThe Diamond Difference closure assumes a linear variation and sets\n$$\n\\bar{\\psi} = \\frac{\\psi_{i-1/2} + \\psi_{i+1/2}}{2}.\n$$\nSubstitute this into the balance and divide by $\\mu$:\n$$\n\\left( \\psi_{i+1/2} - \\psi_{i-1/2} \\right) + \\frac{\\Sigma_{t} \\Delta x}{2 \\mu} \\left( \\psi_{i+1/2} + \\psi_{i-1/2} \\right) = \\frac{Q \\Delta x}{\\mu}.\n$$\nWith $\\tau = \\Sigma_{t} \\Delta x / \\mu$, this becomes\n$$\n\\left( 1 + \\frac{\\tau}{2} \\right) \\psi_{i+1/2} + \\left( -1 + \\frac{\\tau}{2} \\right) \\psi_{i-1/2} = \\frac{Q \\Delta x}{\\mu}.\n$$\nSolving for the outgoing face flux,\n$$\n\\psi_{i+1/2}^{\\mathrm{DD}} = \\frac{ \\dfrac{Q \\Delta x}{\\mu} + \\left( 1 - \\dfrac{\\tau}{2} \\right) \\psi_{i-1/2} }{ 1 + \\dfrac{\\tau}{2} }.\n$$\nThis is the DD update relating face fluxes and the cell source.\n\nStep Characteristic (SC) update. SC solves the differential equation exactly in a homogeneous cell. Rewrite the transport equation as\n$$\n\\frac{d \\psi}{dx} + \\frac{\\Sigma_{t}}{\\mu} \\psi = \\frac{Q}{\\mu}.\n$$\nThis is a first-order linear ordinary differential equation with constant coefficients. The integrating factor is\n$$\nI(x) = \\exp\\!\\left( \\frac{\\Sigma_{t}}{\\mu} x \\right).\n$$\nMultiplying through and integrating from $x_{i-1/2}$ to $x$ gives\n$$\n\\psi(x) \\, \\exp\\!\\left( \\frac{\\Sigma_{t}}{\\mu} x \\right) - \\psi_{i-1/2} \\, \\exp\\!\\left( \\frac{\\Sigma_{t}}{\\mu} x_{i-1/2} \\right) = \\int_{x_{i-1/2}}^{x} \\frac{Q}{\\mu} \\exp\\!\\left( \\frac{\\Sigma_{t}}{\\mu} s \\right) ds.\n$$\nSolving for $\\psi(x)$ and evaluating at $x = x_{i+1/2}$ yields\n$$\n\\psi_{i+1/2}^{\\mathrm{SC}} = \\psi_{i-1/2} \\exp(-\\tau) + \\frac{Q}{\\Sigma_{t}} \\left( 1 - \\exp(-\\tau) \\right),\n$$\nwhere we have used $\\tau = \\Sigma_{t} \\Delta x / \\mu$ and the exact integral of the exponential source term.\n\nCounterexample analysis for negativity in DD. Consider the case of no volumetric source, $Q = 0$, and optical thickness $\\tau = 3$, with a positive incoming flux $\\psi_{i-1/2} > 0$. Under these conditions, the DD update simplifies to\n$$\n\\psi_{i+1/2}^{\\mathrm{DD}} = \\frac{ \\left( 1 - \\dfrac{\\tau}{2} \\right) \\psi_{i-1/2} }{ 1 + \\dfrac{\\tau}{2} }.\n$$\nWith $\\tau = 3$, we have\n$$\n1 - \\frac{\\tau}{2} = 1 - \\frac{3}{2} = -\\frac{1}{2}, \\quad 1 + \\frac{\\tau}{2} = 1 + \\frac{3}{2} = \\frac{5}{2},\n$$\nso\n$$\n\\psi_{i+1/2}^{\\mathrm{DD}} = \\frac{ -\\dfrac{1}{2} }{ \\dfrac{5}{2} } \\, \\psi_{i-1/2} = -\\frac{1}{5} \\, \\psi_{i-1/2}.\n$$\nTherefore, $\\psi_{i+1/2}^{\\mathrm{DD}}$ is negative even though $\\psi_{i-1/2} > 0$ and $Q = 0$. This negativity arises whenever $\\tau > 2$ in a source-free cell, because the coefficient $(1 - \\tau/2)$ becomes negative while the denominator $(1 + \\tau/2)$ is positive.\n\nIn contrast, the SC update with $Q = 0$ guarantees positivity by exact attenuation:\n$$\n\\psi_{i+1/2}^{\\mathrm{SC}} = \\psi_{i-1/2} \\exp(-\\tau),\n$$\nwhich is strictly positive for any finite $\\tau$ when $\\psi_{i-1/2} > 0$.\n\nNormalized difference. The quantity requested is\n$$\nD \\equiv \\frac{ \\psi_{i+1/2}^{\\mathrm{SC}} - \\psi_{i+1/2}^{\\mathrm{DD}} }{ \\psi_{i-1/2} }.\n$$\nSubstituting the expressions with $Q = 0$ and $\\tau = 3$,\n$$\nD = \\exp(-3) - \\left( \\frac{ 1 - \\dfrac{3}{2} }{ 1 + \\dfrac{3}{2} } \\right) = \\exp(-3) - \\left( \\frac{ -\\dfrac{1}{2} }{ \\dfrac{5}{2} } \\right) = \\exp(-3) + \\frac{1}{5}.\n$$\nCompute $\\exp(-3)$ symbolically and then numerically:\n$$\n\\exp(-3) \\approx 0.049787068367863944.\n$$\nThus,\n$$\nD \\approx 0.049787068367863944 + 0.2 = 0.24978706836786394.\n$$\nRounded to five significant figures, the normalized difference is\n$$\nD \\approx 0.24979.\n$$\nThis quantifies, for the specified optical thickness and source-free condition, the positive correction that Step Characteristic provides over the Diamond Difference result, which is negative in this counterexample.",
            "answer": "$$\\boxed{0.24979}$$"
        },
        {
            "introduction": "Moving from one to multiple dimensions introduces new geometric challenges in tracking particle paths. This exercise extends the application of the characteristic solution to a two-dimensional Cartesian cell. You will practice determining how inflow faces illuminate outflow faces and calculate the resulting average outgoing fluxes, a foundational skill for developing multi-dimensional transport solvers. ",
            "id": "4251992",
            "problem": "Consider steady-state, monoenergetic neutron transport in a homogeneous, absorbing medium with a constant within-cell volumetric angular source $q$ (neutrons per cubic centimeter per second per steradian). The geometry is a rectangular Cartesian cell with width $\\Delta x$ in the $x$-direction and height $\\Delta y$ in the $y$-direction. A single discrete-ordinates direction is considered with direction cosines $\\mu$ in $x$ and $\\eta$ in $y$, where $\\mu > 0$ and $\\eta > 0$. The total macroscopic cross section is $\\Sigma_{t}$, taken to be spatially constant within the cell. There is no scattering source beyond the given fixed source $q$.\n\nThe governing steady-state linear Boltzmann transport equation for the angular flux $\\psi(\\mathbf{r}, \\Omega)$ along direction $\\Omega$ is\n$$\n\\Omega \\cdot \\nabla \\psi(\\mathbf{r}, \\Omega) + \\Sigma_{t} \\, \\psi(\\mathbf{r}, \\Omega) = q,\n$$\nand under the step characteristic assumption, $q$ and $\\Sigma_{t}$ are constant within the cell.\n\nBoundary inflow angular fluxes are uniform on the two inflow faces:\n- On the west face ($x = 0$), $\\psi(0,y;\\Omega) = \\psi_{W}$ for $0 \\le y \\le \\Delta y$.\n- On the south face ($y = 0$), $\\psi(x,0;\\Omega) = \\psi_{S}$ for $0 \\le x \\le \\Delta x$.\n\nYou are to compute the outgoing face-averaged angular fluxes on the east face ($x = \\Delta x$) and the north face ($y = \\Delta y$):\n$$\n\\bar{\\psi}_{E} = \\frac{1}{\\Delta y} \\int_{0}^{\\Delta y} \\psi(\\Delta x, y; \\Omega) \\, dy, \\qquad\n\\bar{\\psi}_{N} = \\frac{1}{\\Delta x} \\int_{0}^{\\Delta x} \\psi(x, \\Delta y; \\Omega) \\, dx,\n$$\nby integrating the characteristic solution of the transport equation from the appropriate inflow boundary along straight lines parallel to $\\Omega$.\n\nUse the following physically consistent parameters:\n- $\\Delta x = 2.0$ centimeters,\n- $\\Delta y = 3.0$ centimeters,\n- $\\mu = 0.6$,\n- $\\eta = 0.4$,\n- $\\Sigma_{t} = 0.8$ inverse centimeters,\n- $q = 0.3$ neutrons per cubic centimeter per second per steradian,\n- $\\psi_{W} = 1.1$ neutrons per square centimeter per second per steradian,\n- $\\psi_{S} = 0.9$ neutrons per square centimeter per second per steradian.\n\nExpress $\\bar{\\psi}_{E}$ and $\\bar{\\psi}_{N}$ in neutrons per square centimeter per second per steradian. Round your final numerical values to $4$ significant figures. Report your final answer as a two-entry row matrix $\\begin{pmatrix} \\bar{\\psi}_{E} & \\bar{\\psi}_{N} \\end{pmatrix}$.",
            "solution": "The governing steady-state, monoenergetic linear Boltzmann transport equation in two-dimensional Cartesian coordinates for a single discrete direction with direction cosines $\\mu$ and $\\eta$ is:\n$$\n\\mu \\frac{\\partial \\psi}{\\partial x} + \\eta \\frac{\\partial \\psi}{\\partial y} + \\Sigma_t \\psi = q\n$$\nHere, $\\psi(x, y)$ is the angular flux, $\\Sigma_t$ is the constant total macroscopic cross section, and $q$ is the constant volumetric angular source. We are given $\\mu > 0$ and $\\eta > 0$, which signifies that particles flow from the negative $x$ and $y$ directions toward the positive $x$ and $y$ directions. Therefore, the west ($x=0$) and south ($y=0$) faces are inflow boundaries, and the east ($x=\\Delta x$) and north ($y=\\Delta y$) faces are outflow boundaries.\n\nThe equation is a first-order linear partial differential equation, which can be solved using the method of characteristics. The characteristic lines are straight paths parallel to the direction vector $\\Omega = (\\mu, \\eta, ...)$. The equation can be rewritten as a directional derivative:\n$$\n\\frac{d\\psi}{ds} + \\Sigma_t \\psi = q\n$$\nwhere $s$ is the path length along the direction $\\Omega$. This is a first-order linear ordinary differential equation for $\\psi$ as a function of $s$. Its solution is:\n$$\n\\psi(s) = \\psi(0) \\exp(-\\Sigma_t s) + \\frac{q}{\\Sigma_t} \\left(1 - \\exp(-\\Sigma_t s)\\right)\n$$\nwhere $\\psi(0)$ is the angular flux at the starting point of the characteristic ($s=0$) on an inflow boundary, and $\\psi(s)$ is the flux after traveling a distance $s$ through the cell.\n\nA key step is to determine which parts of the outflow boundaries are illuminated by which parts of the inflow boundaries. The characteristic line originating from the bottom-left corner $(0,0)$ has the equation $y = (\\eta/\\mu)x$. We must determine where this line exits the cell of size $\\Delta x \\times \\Delta y$.\n\nThe position where this line intersects the east face ($x=\\Delta x$) is at $y_{cross} = (\\eta/\\mu) \\Delta x$.\nThe position where this line intersects the north face ($y=\\Delta y$) is at $x_{cross} = (\\mu/\\eta) \\Delta y$.\n\nUsing the given values:\n- $\\Delta x = 2.0$ cm, $\\Delta y = 3.0$ cm, $\\mu = 0.6$, $\\eta = 0.4$.\n- $y_{cross} = \\frac{0.4}{0.6} \\times 2.0 = \\frac{2}{3} \\times 2.0 = \\frac{4}{3} \\approx 1.333$ cm.\nSince $0 < y_{cross} < \\Delta y$, the characteristic from $(0,0)$ exits through the east face. This has two important consequences:\n1.  The east face ($x=\\Delta x$) is divided into two segments. The lower segment ($0 \\le y \\le y_{cross}$) is reached by characteristics originating from the south face ($y=0$). The upper segment ($y_{cross} \\le y \\le \\Delta y$) is reached by characteristics originating from the west face ($x=0$).\n2.  The entire north face ($y=\\Delta y, 0 \\le x \\le \\Delta x$) is reached only by characteristics originating from the west face ($x=0$). This is because any characteristic reaching the north face must have crossed the line $y=y_{cross}$ inside the cell, meaning it must have come from the west face.\n\nFirst, we calculate the average angular flux on the north face, $\\bar{\\psi}_{N}$.\nA characteristic reaching a point $(x, \\Delta y)$ on the north face originates from a point $(0, y_{in})$ on the west face. The path length $s$ is given by $x = \\mu s$, so $s = x/\\mu$. The inflow flux is $\\psi(0, y_{in}) = \\psi_W$.\nThe flux at $(x, \\Delta y)$ is thus:\n$$\n\\psi(x, \\Delta y) = \\psi_W \\exp\\left(-\\frac{\\Sigma_t x}{\\mu}\\right) + \\frac{q}{\\Sigma_t}\\left(1 - \\exp\\left(-\\frac{\\Sigma_t x}{\\mu}\\right)\\right)\n$$\nThe average flux on the north face is:\n$$\n\\bar{\\psi}_{N} = \\frac{1}{\\Delta x} \\int_{0}^{\\Delta x} \\psi(x, \\Delta y) \\, dx = \\frac{1}{\\Delta x} \\int_{0}^{\\Delta x} \\left[ \\left(\\psi_W - \\frac{q}{\\Sigma_t}\\right)\\exp\\left(-\\frac{\\Sigma_t x}{\\mu}\\right) + \\frac{q}{\\Sigma_t} \\right] dx\n$$\nLet $\\tau_x = \\frac{\\Sigma_t \\Delta x}{\\mu}$ be the optical thickness in the $x$-direction. The integral yields:\n$$\n\\bar{\\psi}_{N} = \\frac{1}{\\Delta x} \\left[ \\left(\\psi_W - \\frac{q}{\\Sigma_t}\\right) \\left(-\\frac{\\mu}{\\Sigma_t}\\right) \\left( \\exp(-\\tau_x) - 1 \\right) + \\frac{q}{\\Sigma_t}\\Delta x \\right]\n$$\n$$\n\\bar{\\psi}_{N} = \\left(\\psi_W - \\frac{q}{\\Sigma_t}\\right) \\frac{\\mu}{\\Sigma_t \\Delta x} (1 - \\exp(-\\tau_x)) + \\frac{q}{\\Sigma_t} = \\left(\\psi_W - \\frac{q}{\\Sigma_t}\\right) \\frac{1 - \\exp(-\\tau_x)}{\\tau_x} + \\frac{q}{\\Sigma_t}\n$$\n\nNext, we calculate the average angular flux on the east face, $\\bar{\\psi}_{E}$. We split the integral into two parts:\n$$\n\\bar{\\psi}_{E} = \\frac{1}{\\Delta y} \\left[ \\int_{0}^{y_{cross}} \\psi(\\Delta x, y) \\, dy + \\int_{y_{cross}}^{\\Delta y} \\psi(\\Delta x, y) \\, dy \\right]\n$$\nFor the lower segment ($0 \\le y \\le y_{cross}$), characteristics originate from the south face with flux $\\psi_S$. For a point $(\\Delta x, y)$, the path length is $s = y/\\eta$. The flux is $\\psi(\\Delta x, y) = \\psi_S \\exp(-\\Sigma_t y/\\eta) + \\frac{q}{\\Sigma_t}(1 - \\exp(-\\Sigma_t y/\\eta))$. The average flux over this segment, $\\bar{\\psi}_{E,S}$, is found similarly to $\\bar{\\psi}_N$:\n$$\n\\bar{\\psi}_{E,S} = \\frac{1}{y_{cross}} \\int_{0}^{y_{cross}} \\psi(\\Delta x, y) \\, dy = \\left(\\psi_S - \\frac{q}{\\Sigma_t}\\right) \\frac{1 - \\exp(-\\tau_{cross})}{\\tau_{cross}} + \\frac{q}{\\Sigma_t}\n$$\nwhere $\\tau_{cross} = \\frac{\\Sigma_t y_{cross}}{\\eta} = \\frac{\\Sigma_t (\\eta/\\mu)\\Delta x}{\\eta} = \\frac{\\Sigma_t \\Delta x}{\\mu} = \\tau_x$. Thus:\n$$\n\\bar{\\psi}_{E,S} = \\left(\\psi_S - \\frac{q}{\\Sigma_t}\\right) \\frac{1 - \\exp(-\\tau_x)}{\\tau_x} + \\frac{q}{\\Sigma_t}\n$$\nFor the upper segment ($y_{cross} \\le y \\le \\Delta y$), characteristics originate from the west face with flux $\\psi_W$. The path length for all these characteristics is constant, $s = \\Delta x / \\mu$. The flux is therefore constant over this segment:\n$$\n\\psi(\\Delta x, y) = \\bar{\\psi}_{E,W} = \\psi_W \\exp(-\\tau_x) + \\frac{q}{\\Sigma_t}(1-\\exp(-\\tau_x))\n$$\nThe total average flux on the east face is the weighted average of the fluxes on the two segments:\n$$\n\\bar{\\psi}_{E} = \\frac{y_{cross}}{\\Delta y} \\bar{\\psi}_{E,S} + \\frac{\\Delta y - y_{cross}}{\\Delta y} \\bar{\\psi}_{E,W}\n$$\n\nNow, we substitute the numerical values:\n- $\\Sigma_t = 0.8$, $q = 0.3 \\implies q/\\Sigma_t = 0.3/0.8 = 0.375$.\n- $\\psi_W = 1.1$, $\\psi_S = 0.9$.\n- $\\tau_x = \\frac{\\Sigma_t \\Delta x}{\\mu} = \\frac{0.8 \\times 2.0}{0.6} = \\frac{1.6}{0.6} = \\frac{8}{3}$.\n- $\\exp(-\\tau_x) = \\exp(-8/3) \\approx 0.069477$.\n- $\\frac{1 - \\exp(-\\tau_x)}{\\tau_x} = \\frac{1 - \\exp(-8/3)}{8/3} \\approx \\frac{1 - 0.069477}{2.6666...} \\approx 0.348946$.\n\nCalculation of $\\bar{\\psi}_N$:\n$$\n\\bar{\\psi}_N \\approx (1.1 - 0.375) \\times 0.348946 + 0.375 = 0.725 \\times 0.348946 + 0.375\n$$\n$$\n\\bar{\\psi}_N \\approx 0.252986 + 0.375 = 0.627986 \\approx 0.6280\n$$\n\nCalculation of $\\bar{\\psi}_E$:\n- $y_{cross} = 4/3$ cm. $\\Delta y = 3$ cm.\n- Weighting factors: $\\frac{y_{cross}}{\\Delta y} = \\frac{4/3}{3} = \\frac{4}{9}$, and $\\frac{\\Delta y - y_{cross}}{\\Delta y} = \\frac{3-4/3}{3} = \\frac{5/3}{3} = \\frac{5}{9}$.\n- Average flux from south-fed part:\n$$\n\\bar{\\psi}_{E,S} \\approx (0.9 - 0.375) \\times 0.348946 + 0.375 = 0.525 \\times 0.348946 + 0.375\n$$\n$$\n\\bar{\\psi}_{E,S} \\approx 0.183197 + 0.375 = 0.558197\n$$\n- Flux from west-fed part:\n$$\n\\bar{\\psi}_{E,W} \\approx 1.1 \\times 0.069477 + 0.375 \\times (1 - 0.069477) = 0.076425 + 0.348946\n$$\n$$\n\\bar{\\psi}_{E,W} \\approx 0.425371\n$$\n- Total average flux on east face:\n$$\n\\bar{\\psi}_E \\approx \\frac{4}{9} \\times 0.558197 + \\frac{5}{9} \\times 0.425371 \\approx 0.248088 + 0.236317\n$$\n$$\n\\bar{\\psi}_E \\approx 0.484405 \\approx 0.4844\n$$\nThe requested values rounded to $4$ significant figures are $\\bar{\\psi}_{E} = 0.4844$ and $\\bar{\\psi}_{N} = 0.6280$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.4844 & 0.6280\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The final step in mastering a numerical method is demonstrating that its implementation is correct. This practice guides you through the Method of Manufactured Solutions (MMS), a cornerstone of scientific software verification. By implementing a simple 1D SC solver and comparing its output against a known analytical solution, you will formally verify that the code achieves the expected first-order spatial accuracy. ",
            "id": "4251998",
            "problem": "Consider the steady-state, monoenergetic, one-dimensional neutron transport equation in slab geometry for the angular flux $\\psi(x,\\mu)$, where $x \\in [0,L]$ is the spatial coordinate in centimeters (cm) and $\\mu \\in [-1,1]$ is the direction cosine. The governing balance equation is the fundamental law\n$$\n\\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t(x) \\psi(x,\\mu) = Q(x,\\mu),\n$$\nwhere $\\Sigma_t(x)$ is the total macroscopic cross section in inverse centimeters ($\\mathrm{cm}^{-1}$) and $Q(x,\\mu)$ is a known source term with units consistent with the equation. Assume vacuum boundary conditions are replaced by consistent inflow boundary conditions derived from the manufactured solution described below, so that the boundary values are exactly compatible with the chosen $\\psi(x,\\mu)$.\n\nYou must design a Manufactured Solution (MS) in the following manner:\n- Choose a smooth, strictly positive angular flux of the form\n$$\n\\psi_{\\text{MS}}(x,\\mu) = \\exp(\\alpha x) \\left(1 + \\beta \\mu + \\gamma \\sin\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right),\n$$\nwith constants $\\alpha$ in $\\mathrm{cm}^{-1}$, $\\beta$ dimensionless, and $\\gamma$ dimensionless.\n- Choose a spatially varying total cross section\n$$\n\\Sigma_t(x) = \\Sigma_0 \\left(1 + c \\sin\\left(\\frac{2\\pi x}{L}\\right)\\right),\n$$\nwhere $\\Sigma_0$ is in $\\mathrm{cm}^{-1}$ and $c$ is dimensionless with $0 < c < 1$ to ensure $\\Sigma_t(x) > 0$.\n- Define the source $Q(x,\\mu)$ by requiring that $\\psi_{\\text{MS}}(x,\\mu)$ exactly satisfies the transport equation, i.e.,\n$$\nQ(x,\\mu) = \\mu \\frac{\\partial \\psi_{\\text{MS}}(x,\\mu)}{\\partial x} + \\Sigma_t(x)\\,\\psi_{\\text{MS}}(x,\\mu).\n$$\n\nYour task is to implement a step characteristic (SC) spatial discretization to approximate $\\psi(x,\\mu)$ on a uniform mesh of $N$ cells over $x \\in [0,L]$. In the SC method, within each cell $[x_i, x_{i+1}]$, treat $\\Sigma_t(x)$ and $Q(x,\\mu)$ as constants equal to their cell averages and advance the solution along characteristics from the inflow boundary to the outflow boundary for each discrete ordinate $\\mu$. Use inflow boundary values of $\\psi$ at $x=0$ for $\\mu>0$ and at $x=L$ for $\\mu<0$ set equal to $\\psi_{\\text{MS}}$ at those boundaries for the corresponding $\\mu$, ensuring consistency of the manufactured boundary conditions.\n\nYou must:\n- Use a discrete ordinates quadrature (e.g., Gaussâ€“Legendre) with $S_N$ points to represent the angular dependence in $\\mu$. Denote the quadrature points by $\\{\\mu_k\\}$ and corresponding weights by $\\{w_k\\}$, for $k=1,\\dots,S_N$, with $\\sum_k w_k = 2$ over $\\mu \\in [-1,1]$.\n- Compute the numerical SC approximation $\\psi_{\\text{SC}}(x_i+\\Delta x/2, \\mu_k)$ at cell centers $x_i+\\Delta x/2$, for $i=0,\\dots,N-1$, and all $k$.\n- Compute the exact manufactured solution $\\psi_{\\text{MS}}(x_i+\\Delta x/2, \\mu_k)$ at the same points.\n- Measure the normalized root-mean-square ($L^2$) error over space and angle as\n$$\nE_h = \\left[\\frac{1}{2L}\\sum_{k=1}^{S_N} w_k \\sum_{i=0}^{N-1} \\left(\\psi_{\\text{SC}}(x_i+\\tfrac{\\Delta x}{2},\\mu_k) - \\psi_{\\text{MS}}(x_i+\\tfrac{\\Delta x}{2},\\mu_k)\\right)^2 \\Delta x \\right]^{1/2},\n$$\nwhere $\\Delta x = L/N$.\n\nVerify first-order spatial convergence by computing the observed order of accuracy\n$$\np_{\\mathrm{obs}} = \\frac{\\log\\left(E_{h}/E_{h/2}\\right)}{\\log(2)},\n$$\non a uniform mesh when the number of cells is doubled.\n\nExpress all spatial quantities in centimeters (cm), all cross sections in inverse centimeters ($\\mathrm{cm}^{-1}$), and the final observed orders $p_{\\mathrm{obs}}$ as dimensionless floats.\n\nImplement the above using the following test suite of parameter sets, which must be hard-coded into the program:\n\n- Test case $1$ (moderate optical thickness):\n    - $L = 10$ cm,\n    - $\\Sigma_0 = 0.8$ $\\mathrm{cm}^{-1}$,\n    - $c = 0.3$,\n    - $\\alpha = 0.05$ $\\mathrm{cm}^{-1}$,\n    - $\\beta = 0.3$,\n    - $\\gamma = 0.6$,\n    - $S_N = 8$,\n    - meshes with $N = 40$ and $N = 80$.\n\n- Test case $2$ (optically thin):\n    - $L = 10$ cm,\n    - $\\Sigma_0 = 0.1$ $\\mathrm{cm}^{-1}$,\n    - $c = 0.2$,\n    - $\\alpha = 0.05$ $\\mathrm{cm}^{-1}$,\n    - $\\beta = 0.3$,\n    - $\\gamma = 0.6$,\n    - $S_N = 8$,\n    - meshes with $N = 40$ and $N = 80$.\n\n- Test case $3$ (optically thick):\n    - $L = 10$ cm,\n    - $\\Sigma_0 = 3.0$ $\\mathrm{cm}^{-1}$,\n    - $c = 0.2$,\n    - $\\alpha = 0.05$ $\\mathrm{cm}^{-1}$,\n    - $\\beta = 0.3$,\n    - $\\gamma = 0.6$,\n    - $S_N = 8$,\n    - meshes with $N = 40$ and $N = 80$.\n\nYour program should produce a single line of output containing the observed orders $p_{\\mathrm{obs}}$ for the three test cases as a comma-separated list enclosed in square brackets, for example, $[\\text{p1},\\text{p2},\\text{p3}]$, where each entry is a float. No other output must be printed.",
            "solution": "### 1. Theoretical Framework\n\nThe problem requires the numerical solution of the one-dimensional, steady-state, monoenergetic neutron transport equation in slab geometry:\n$$\n\\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t(x) \\psi(x,\\mu) = Q(x,\\mu)\n$$\nHere, $\\psi(x,\\mu)$ is the angular neutron flux at spatial position $x \\in [0, L]$ and direction cosine $\\mu \\in [-1, 1]$. $\\Sigma_t(x)$ is the total macroscopic cross section, and $Q(x,\\mu)$ is an external source.\n\nThe Method of Manufactured Solutions (MMS) is employed to verify the implementation of the numerical solver. This involves choosing a desired analytic form for the solution, $\\psi_{\\text{MS}}(x,\\mu)$, and substituting it into the transport equation to derive a corresponding source term, $Q(x,\\mu)$. The numerical method is then used to solve the equation with this source term, and the error between the numerical solution and the exact manufactured solution is measured to verify the code's accuracy and order of convergence.\n\n### 2. Manufactured Solution and Source\n\nThe manufactured angular flux is given by:\n$$\n\\psi_{\\text{MS}}(x,\\mu) = \\exp(\\alpha x) \\left(1 + \\beta \\mu + \\gamma \\sin\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right)\n$$\nThe spatially varying total cross section is:\n$$\n\\Sigma_t(x) = \\Sigma_0 \\left(1 + c \\sin\\left(\\frac{2\\pi x}{L}\\right)\\right)\n$$\nTo find the manufactured source $Q(x,\\mu)$, we compute the derivative of $\\psi_{\\text{MS}}(x,\\mu)$ with respect to $x$:\n$$\n\\frac{\\partial \\psi_{\\text{MS}}}{\\partial x} = \\alpha \\exp(\\alpha x) \\left(1 + \\beta \\mu + \\gamma \\sin\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right) + \\exp(\\alpha x) \\left(\\gamma \\frac{\\pi}{L} \\cos\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right)\n$$\nRecognizing the first term contains $\\psi_{\\text{MS}}(x,\\mu)$, this simplifies to:\n$$\n\\frac{\\partial \\psi_{\\text{MS}}}{\\partial x} = \\alpha \\psi_{\\text{MS}}(x,\\mu) + \\exp(\\alpha x) \\left(\\gamma \\frac{\\pi}{L} \\cos\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right)\n$$\nThe source $Q(x,\\mu)$ is then defined by substituting $\\psi_{\\text{MS}}$ into the transport equation:\n$$\nQ(x,\\mu) = \\mu \\frac{\\partial \\psi_{\\text{MS}}}{\\partial x} + \\Sigma_t(x) \\psi_{\\text{MS}}(x,\\mu)\n$$\n$$\nQ(x,\\mu) = \\mu \\left[\\alpha \\psi_{\\text{MS}}(x,\\mu) + \\exp(\\alpha x) \\gamma \\frac{\\pi}{L} \\cos\\left(\\frac{\\pi x}{L}\\right) \\mu^2\\right] + \\Sigma_t(x) \\psi_{\\text{MS}}(x,\\mu)\n$$\n$$\nQ(x,\\mu) = \\left(\\mu \\alpha + \\Sigma_t(x)\\right) \\psi_{\\text{MS}}(x,\\mu) + \\mu^3 \\gamma \\frac{\\pi}{L} \\exp(\\alpha x) \\cos\\left(\\frac{\\pi x}{L}\\right)\n$$\nThis expression provides the exact source required for $\\psi_{\\text{MS}}(x,\\mu)$ to be the true solution.\n\n### 3. Numerical Discretization\n\n#### 3.1. Angular Discretization (Discrete Ordinates)\nThe angular domain $\\mu \\in [-1, 1]$ is discretized into a set of $S_N$ discrete directions (ordinates) $\\{\\mu_k\\}$ and corresponding weights $\\{w_k\\}$, for $k=1, \\dots, S_N$. A Gauss-Legendre quadrature set is used, satisfying the normalization $\\sum_{k=1}^{S_N} w_k = 2$. The transport equation is then solved for each discrete ordinate $\\mu_k$.\n\n#### 3.2. Spatial Discretization and Step Characteristic Method\nThe spatial domain $x \\in [0, L]$ is divided into $N$ uniform cells, each of width $\\Delta x = L/N$. The cell boundaries are $x_i = i \\Delta x$ for $i=0, \\dots, N$. The $i$-th cell spans the interval $[x_i, x_{i+1}]$.\n\nThe Step Characteristic (SC) method assumes that within each cell $i$, the cross section $\\Sigma_t(x)$ and source $Q(x,\\mu_k)$ are constant and equal to their cell-averaged values:\n$$\n\\Sigma_{t,i} = \\frac{1}{\\Delta x} \\int_{x_i}^{x_{i+1}} \\Sigma_t(x) dx\n$$\n$$\nQ_{i,k} = \\frac{1}{\\Delta x} \\int_{x_i}^{x_{i+1}} Q(x, \\mu_k) dx\n$$\nThese integrals are computed numerically to high precision to avoid introducing additional errors that would corrupt the convergence analysis. Within cell $i$, for each ordinate $\\mu_k$, the transport equation becomes a simple ordinary differential equation:\n$$\n\\mu_k \\frac{d\\psi_k(x)}{dx} + \\Sigma_{t,i} \\psi_k(x) = Q_{i,k}\n$$\nwhere $\\psi_k(x) \\equiv \\psi(x, \\mu_k)$.\n\nThe solution of this ODE across a cell is found by advancing along the characteristic direction. Let $\\psi_{k, \\text{in}}$ be the known angular flux at the inflow boundary of the cell. The flux at a distance $s$ along the characteristic path from the inflow boundary is:\n$$\n\\psi_k(s) = \\psi_{k, \\text{in}} \\exp\\left(-\\frac{\\Sigma_{t,i} s}{|\\mu_k|}\\right) + \\frac{Q_{i,k}}{\\Sigma_{t,i}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{t,i} s}{|\\mu_k|}\\right)\\right)\n$$\nThe solution proceeds via a transport sweep:\n- **Forward Sweep ($\\mu_k > 0$)**: The sweep progresses from left ($x=0$) to right ($x=L$). For cell $i$, the inflow boundary is at $x_i$ and the inflow flux is $\\psi_k(x_i)$. The outflow flux at $x_{i+1}$ becomes the inflow flux for cell $i+1$. The inflow at the domain boundary is given by the manufactured solution: $\\psi_k(0) = \\psi_{\\text{MS}}(0, \\mu_k)$.\n- **Backward Sweep ($\\mu_k < 0$)**: The sweep progresses from right ($x=L$) to left ($x=0$). For cell $i$, the inflow boundary is at $x_{i+1}$ and the inflow flux is $\\psi_k(x_{i+1})$. The outflow flux at $x_i$ becomes the inflow flux for cell $i-1$. The inflow at the domain boundary is $\\psi_k(L) = \\psi_{\\text{MS}}(L, \\mu_k)$.\n\nThe problem requires computing the numerical solution at the cell centers, $x_{i,c} = x_i + \\Delta x/2$. The distance from any cell's inflow boundary to its center is $s = \\Delta x/2$. Thus, the cell-center flux is calculated as:\n$$\n\\psi_{\\text{SC}}(x_{i,c}, \\mu_k) = \\psi_{k, \\text{in}} \\exp\\left(-\\frac{\\Sigma_{t,i} \\Delta x}{2|\\mu_k|}\\right) + \\frac{Q_{i,k}}{\\Sigma_{t,i}} \\left(1 - \\exp\\left(-\\frac{\\Sigma_{t,i} \\Delta x}{2|\\mu_k|}\\right)\\right)\n$$\nwhere $\\psi_{k, \\text{in}}$ is $\\psi_k(x_i)$ for $\\mu_k > 0$ and $\\psi_k(x_{i+1})$ for $\\mu_k < 0$.\n\n### 4. Error Analysis and Convergence\nThe accuracy of the numerical solution is quantified by the discrete, normalized $L^2$ error norm:\n$$\nE_h = \\left[\\frac{1}{2L}\\sum_{k=1}^{S_N} w_k \\sum_{i=0}^{N-1} \\left(\\psi_{\\text{SC}}(x_{i,c},\\mu_k) - \\psi_{\\text{MS}}(x_{i,c},\\mu_k)\\right)^2 \\Delta x \\right]^{1/2}\n$$\nThe term $2L$ in the denominator normalizes the error by the measure of the phase space domain $(\\int_{-1}^1 d\\mu \\int_0^L dx = 2L)$. The parameter $h$ represents the mesh spacing, $h=\\Delta x=L/N$.\n\nThe observed order of accuracy, $p_{\\mathrm{obs}}$, is computed by comparing the error from two different mesh resolutions, a coarse mesh with spacing $h$ ( $N$ cells) and a fine mesh with spacing $h/2$ ($2N$ cells).\n$$\np_{\\mathrm{obs}} = \\frac{\\log\\left(E_{h}/E_{h/2}\\right)}{\\log(2)}\n$$\nFor the Step Characteristic method, which is a first-order accurate method in space, the expected value for $p_{\\mathrm{obs}}$ is approximately $1$. The implementation will calculate this value for each specified test case.",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(L, Sigma0, c, alpha, beta, gamma, SN, N):\n    \"\"\"\n    Solves the 1D transport equation using Step Characteristics for a given mesh.\n\n    Args:\n        L (float): Length of the domain in cm.\n        Sigma0 (float): Base total cross section in cm^-1.\n        c (float): Amplitude of cross section variation.\n        alpha (float): Parameter for manufactured solution.\n        beta (float): Parameter for manufactured solution.\n        gamma (float): Parameter for manufactured solution.\n        SN (int): Order of the discrete ordinates quadrature.\n        N (int): Number of spatial cells.\n\n    Returns:\n        float: The L2 error of the numerical solution.\n    \"\"\"\n    # 1. Define manufactured solution and related functions\n    def psi_ms(x, mu):\n        return np.exp(alpha * x) * (1 + beta * mu + gamma * np.sin(np.pi * x / L) * mu**2)\n\n    def sigma_t(x):\n        return Sigma0 * (1 + c * np.sin(2 * np.pi * x / L))\n\n    def q_source(x, mu):\n        term1 = (mu * alpha + sigma_t(x)) * psi_ms(x, mu)\n        term2 = mu**3 * gamma * (np.pi / L) * np.exp(alpha * x) * np.cos(np.pi * x / L)\n        return term1 + term2\n\n    # 2. Setup numerical grids\n    delta_x = L / N\n    x_nodes = np.linspace(0, L, N + 1)\n    x_centers = x_nodes[:-1] + delta_x / 2\n\n    mu_k, w_k = np.polynomial.legendre.leggauss(SN)\n\n    # 3. Compute cell-averaged coefficients\n    def integrate_cell(func, cell_idx):\n        \"\"\"Numerically integrate a function over a cell using Gauss quadrature.\"\"\"\n        a, b = x_nodes[cell_idx], x_nodes[cell_idx + 1]\n        quad_points_unit, quad_weights_unit = np.polynomial.legendre.leggauss(16) # High order for accuracy\n        t = 0.5 * (b - a) * quad_points_unit + 0.5 * (a + b)\n        integral = 0.5 * (b - a) * np.sum(quad_weights_unit * func(t))\n        return integral\n\n    sigma_t_avg = np.zeros(N)\n    q_avg = np.zeros((N, SN))\n    for i in range(N):\n        sigma_t_avg[i] = (1 / delta_x) * integrate_cell(sigma_t, i)\n        for k in range(SN):\n            q_avg[i, k] = (1 / delta_x) * integrate_cell(lambda x: q_source(x, mu_k[k]), i)\n\n    # 4. Perform transport sweeps\n    psi_sc_center = np.zeros((N, SN))\n    psi_edge = np.zeros((N + 1, SN))\n\n    # Forward sweep (mu > 0)\n    for k in range(SN):\n        if mu_k[k] > 0:\n            psi_edge[0, k] = psi_ms(0.0, mu_k[k])  # Inflow boundary condition\n            for i in range(N):\n                psi_in = psi_edge[i, k]\n                tau_half = sigma_t_avg[i] * delta_x / (2 * mu_k[k])\n                \n                if sigma_t_avg[i] > 1e-12:\n                    source_term = q_avg[i, k] / sigma_t_avg[i]\n                    exp_neg_tau_half = np.exp(-tau_half)\n                    psi_sc_center[i, k] = psi_in * exp_neg_tau_half + source_term * (1 - exp_neg_tau_half)\n                    \n                    exp_neg_tau_full = np.exp(-2*tau_half)\n                    psi_edge[i+1, k] = psi_in * exp_neg_tau_full + source_term * (1 - exp_neg_tau_full)\n                else: # Zero cross-section limit\n                    psi_sc_center[i, k] = psi_in + q_avg[i, k] * delta_x / (2 * mu_k[k])\n                    psi_edge[i+1, k] = psi_in + q_avg[i, k] * delta_x / mu_k[k]\n\n    # Backward sweep (mu  0)\n    for k in range(SN):\n        if mu_k[k]  0:\n            psi_edge[N, k] = psi_ms(L, mu_k[k])  # Inflow boundary condition\n            for i in range(N - 1, -1, -1):\n                psi_in = psi_edge[i + 1, k]\n                tau_half = sigma_t_avg[i] * delta_x / (2 * np.abs(mu_k[k]))\n\n                if sigma_t_avg[i] > 1e-12:\n                    source_term = q_avg[i, k] / sigma_t_avg[i]\n                    exp_neg_tau_half = np.exp(-tau_half)\n                    psi_sc_center[i, k] = psi_in * exp_neg_tau_half + source_term * (1 - exp_neg_tau_half)\n\n                    exp_neg_tau_full = np.exp(-2 * tau_half)\n                    psi_edge[i, k] = psi_in * exp_neg_tau_full + source_term * (1 - exp_neg_tau_full)\n                else: # Zero cross-section limit\n                    psi_sc_center[i, k] = psi_in + q_avg[i, k] * delta_x / (2 * np.abs(mu_k[k]))\n                    psi_edge[i, k] = psi_in + q_avg[i, k] * delta_x / np.abs(mu_k[k])\n\n    # 5. Compute the error\n    psi_ms_center = np.zeros((N, SN))\n    for i in range(N):\n        for k in range(SN):\n            psi_ms_center[i, k] = psi_ms(x_centers[i], mu_k[k])\n\n    error_sq_sum = 0.0\n    for i in range(N):\n        for k in range(SN):\n            error_sq_sum += w_k[k] * (psi_sc_center[i, k] - psi_ms_center[i, k])**2\n    \n    l2_error = np.sqrt( (1 / (2 * L)) * error_sq_sum * delta_x )\n\n    return l2_error\n\n\ndef solve():\n    \"\"\"\n    Main driver function to run test cases and compute observed order of convergence.\n    \"\"\"\n    test_cases = [\n        # (L, Sigma0, c, alpha, beta, gamma, SN, N1, N2)\n        (10.0, 0.8, 0.3, 0.05, 0.3, 0.6, 8, 40, 80), # Test case 1\n        (10.0, 0.1, 0.2, 0.05, 0.3, 0.6, 8, 40, 80), # Test case 2\n        (10.0, 3.0, 0.2, 0.05, 0.3, 0.6, 8, 40, 80), # Test case 3\n    ]\n\n    observed_orders = []\n    for case in test_cases:\n        L, Sigma0, c, alpha, beta, gamma, SN, N1, N2 = case\n        \n        error_h = run_simulation(L, Sigma0, c, alpha, beta, gamma, SN, N1)\n        error_h_half = run_simulation(L, Sigma0, c, alpha, beta, gamma, SN, N2)\n        \n        # p_obs = log(Eh / E(h/2)) / log(2)\n        p_obs = np.log(error_h / error_h_half) / np.log(2)\n        observed_orders.append(p_obs)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, observed_orders))}]\")\n\nsolve()\n\n```"
        }
    ]
}