{
    "hands_on_practices": [
        {
            "introduction": "The principle of detailed balance is a cornerstone of thermal neutron scattering, ensuring that scattering rates maintain thermal equilibrium in a moderator. This fundamental property of the scattering law, $S(\\alpha,\\beta)$, is not an arbitrary assumption but a direct consequence of microscopic reversibility. This first practice challenges you to derive the detailed balance relation from first principles using the classical free-gas model, providing a solid theoretical foundation for the relationship between neutron energy gain and loss .",
            "id": "4258831",
            "problem": "A monoatomic moderator is modeled as a classical ideal gas of independent point scatterers (the free-gas model). Neutron scattering is elastic in the center-of-mass frame, and the scatterer velocities follow the Maxwell–Boltzmann distribution at temperature $T$. The scattering law $S(\\alpha,\\beta)$ is defined via the usual dimensionless kinematic variables\n$$\n\\alpha \\equiv \\frac{E + E' - 2 \\mu \\sqrt{E E'}}{A k_{B} T}, \n\\qquad \n\\beta \\equiv \\frac{E' - E}{k_{B} T},\n$$\nwhere $E$ and $E'$ are the incident and outgoing neutron energies in electronvolts, $A$ is the ratio of the scatterer mass to the neutron mass, $\\mu$ is the cosine of the laboratory scattering angle, and $k_{B}$ is the Boltzmann constant.\n\nStarting only from:\n- Newtonian two-body elastic scattering kinematics,\n- the Maxwell–Boltzmann velocity distribution for the scatterers at temperature $T$, and\n- microscopic reversibility at thermal equilibrium,\n\nderive the equilibrium detailed-balance relation connecting $S(\\alpha,\\beta)$ and $S(\\alpha,-\\beta)$ for the free-gas model. Then, using your derived relation, evaluate the ratio $S(\\alpha,\\beta)/S(\\alpha,-\\beta)$ for a hydrogen moderator (so $A=1$) at temperature $T=600\\ \\text{K}$ when a neutron of energy $E=0.040\\ \\text{eV}$ scatters to $E'=0.020\\ \\text{eV}$. You may treat the cosine $\\mu$ as arbitrary, and you may assume the Boltzmann constant is $k_{B} = 8.617333262 \\times 10^{-5}\\ \\text{eV/K}$. \n\nReport the ratio as a dimensionless number rounded to four significant figures.",
            "solution": "The problem asks for two things: first, to derive the detailed-balance relation for the thermal scattering law $S(\\alpha, \\beta)$, and second, to use this relation to calculate the ratio $S(\\alpha, \\beta)/S(\\alpha, -\\beta)$ for a specific neutron scattering event.\n\nThe derivation must be based on three principles: Newtonian kinematics, the Maxwell-Boltzmann velocity distribution for the scatterers, and the principle of microscopic reversibility at thermal equilibrium.\n\nLet us begin with the derivation of the detailed-balance relation. The principle of microscopic reversibility, when applied to a system in thermal equilibrium, implies that the rate of any process is equal to the rate of its reverse process. Consider the process of a neutron scattering from an initial energy $E$ to a final energy $E'$ and the reverse process of scattering from $E'$ to $E$.\n\nThe rate of transitions from an initial state to a final state is proportional to the population of the initial state and the probability of the transition. In thermal equilibrium at temperature $T$, the neutron flux $\\phi(E)$ follows a Maxwellian distribution, which for energy $E$ is proportional to $E \\exp(-E / (k_B T))$. The transition probability is proportional to the double differential scattering cross section, $\\frac{d^2\\sigma}{dE'd\\Omega}(E \\to E', \\mu)$.\n\nThus, the equilibrium detailed-balance condition can be written by equating the rate of scattering from $E$ to $E'$ with the rate of scattering from $E'$ to $E$:\n$$\n\\phi(E) \\frac{d^2\\sigma}{dE'd\\Omega}(E \\to E', \\mu) = \\phi(E') \\frac{d^2\\sigma}{dE d\\Omega}(E' \\to E, \\mu)\n$$\nSubstituting the form of the Maxwellian flux, we get:\n$$\nC E \\exp\\left(-\\frac{E}{k_B T}\\right) \\frac{d^2\\sigma}{dE'd\\Omega}(E \\to E', \\mu) = C E' \\exp\\left(-\\frac{E'}{k_B T}\\right) \\frac{d^2\\sigma}{dE d\\Omega}(E' \\to E, \\mu)\n$$\nwhere $C$ is a constant of proportionality.\n\nThe scattering law $S(\\alpha, \\beta)$ is defined by its relationship to the double differential cross section:\n$$\n\\frac{d^2\\sigma}{dE'd\\Omega}(E \\to E', \\mu) = \\frac{\\sigma_b}{4\\pi k_B T} \\sqrt{\\frac{E'}{E}} S(\\alpha, \\beta)\n$$\nwhere $\\sigma_b$ is the bound scattering cross section. The specific normalization constant does not affect the final relation.\n\nFor the reverse process, where a neutron scatters from energy $E'$ to $E$, the roles of the initial and final energies are swapped. The dimensionless variables $\\alpha$ and $\\beta$ for the reverse process, denoted $\\alpha_{rev}$ and $\\beta_{rev}$, are:\n$$\n\\beta_{rev} = \\frac{E - E'}{k_B T} = -\\beta\n$$\n$$\n\\alpha_{rev} = \\frac{E' + E - 2 \\mu \\sqrt{E' E}}{A k_{B} T} = \\alpha\n$$\nThe variable $\\alpha$ is symmetric with respect to the interchange of $E$ and $E'$, while $\\beta$ is antisymmetric. Thus, the reverse process is described by the scattering law $S(\\alpha, -\\beta)$. The cross section for the reverse process is:\n$$\n\\frac{d^2\\sigma}{dE d\\Omega}(E' \\to E, \\mu) = \\frac{\\sigma_b}{4\\pi k_B T} \\sqrt{\\frac{E}{E'}} S(\\alpha, -\\beta)\n$$\n\nNow, we substitute these expressions for the cross sections into the detailed-balance equation:\n$$\nE \\exp\\left(-\\frac{E}{k_B T}\\right) \\left[ \\frac{\\sigma_b}{4\\pi k_B T} \\sqrt{\\frac{E'}{E}} S(\\alpha, \\beta) \\right] = E' \\exp\\left(-\\frac{E'}{k_B T}\\right) \\left[ \\frac{\\sigma_b}{4\\pi k_B T} \\sqrt{\\frac{E}{E'}} S(\\alpha, -\\beta) \\right]\n$$\nThe constant terms $\\frac{\\sigma_b}{4\\pi k_B T}$ on both sides cancel out:\n$$\nE \\exp\\left(-\\frac{E}{k_B T}\\right) \\sqrt{\\frac{E'}{E}} S(\\alpha, \\beta) = E' \\exp\\left(-\\frac{E'}{k_B T}\\right) \\sqrt{\\frac{E}{E'}} S(\\alpha, -\\beta)\n$$\nSimplifying the energy terms:\n$$\n\\sqrt{E} \\sqrt{E'} \\exp\\left(-\\frac{E}{k_B T}\\right) S(\\alpha, \\beta) = \\sqrt{E'} \\sqrt{E} \\exp\\left(-\\frac{E'}{k_B T}\\right) S(\\alpha, -\\beta)\n$$\nThe term $\\sqrt{EE'}$ cancels from both sides, leaving:\n$$\n\\exp\\left(-\\frac{E}{k_B T}\\right) S(\\alpha, \\beta) = \\exp\\left(-\\frac{E'}{k_B T}\\right) S(\\alpha, -\\beta)\n$$\nSolving for $S(\\alpha, \\beta)$, we obtain the detailed-balance relation:\n$$\nS(\\alpha, \\beta) = \\frac{\\exp\\left(-\\frac{E'}{k_B T}\\right)}{\\exp\\left(-\\frac{E}{k_B T}\\right)} S(\\alpha, -\\beta) = \\exp\\left(\\frac{E - E'}{k_B T}\\right) S(\\alpha, -\\beta)\n$$\nRecalling the definition $\\beta = \\frac{E' - E}{k_B T}$, we have $\\frac{E - E'}{k_B T} = -\\beta$. Therefore, the relation is:\n$$\nS(\\alpha, \\beta) = \\exp(-\\beta) S(\\alpha, -\\beta)\n$$\nThis relation is a fundamental consequence of thermal equilibrium and holds for any scattering system, including the free-gas model.\n\nNext, we are asked to evaluate the ratio $S(\\alpha,\\beta)/S(\\alpha,-\\beta)$ for the given conditions. From the derived relation, this ratio is simply:\n$$\n\\frac{S(\\alpha, \\beta)}{S(\\alpha, -\\beta)} = \\exp(-\\beta)\n$$\nWe need to calculate the value of $\\beta$ using the provided data:\nIncident neutron energy, $E = 0.040\\ \\text{eV}$.\nOutgoing neutron energy, $E' = 0.020\\ \\text{eV}$.\nModerator temperature, $T = 600\\ \\text{K}$.\nBoltzmann constant, $k_B = 8.617333262 \\times 10^{-5}\\ \\text{eV/K}$.\n\nThe dimensionless energy transfer $\\beta$ is:\n$$\n\\beta = \\frac{E' - E}{k_B T} = \\frac{0.020\\ \\text{eV} - 0.040\\ \\text{eV}}{(8.617333262 \\times 10^{-5}\\ \\text{eV/K}) \\times (600\\ \\text{K})}\n$$\nFirst, calculate the thermal energy $k_B T$:\n$$\nk_B T = (8.617333262 \\times 10^{-5}\\ \\text{eV/K}) \\times (600\\ \\text{K}) = 0.051703999572\\ \\text{eV}\n$$\nNow, calculate $\\beta$:\n$$\n\\beta = \\frac{-0.020\\ \\text{eV}}{0.051703999572\\ \\text{eV}} \\approx -0.38681026\n$$\nThe required ratio is $\\exp(-\\beta)$:\n$$\n\\frac{S(\\alpha, \\beta)}{S(\\alpha, -\\beta)} = \\exp(-(-0.38681026)) = \\exp(0.38681026) \\approx 1.472258\n$$\nRounding to four significant figures as requested, the ratio is $1.472$. The values for $A$ and $\\mu$ are not needed for this calculation as the detailed balance principle relates states of different energy, and the ratio depends only on the energy transfer $\\beta$.",
            "answer": "$$\\boxed{1.472}$$"
        },
        {
            "introduction": "While detailed balance governs energy exchange, the structure of the scattering law also dictates the conditions for momentum transfer. In crystalline materials, coherent elastic scattering ($\\beta=0$) gives rise to sharp features in the cross-section known as Bragg edges. This practice connects the abstract $S(\\alpha, \\beta)$ formalism to this observable phenomenon, exploring the kinematic conditions for Bragg scattering in a polycrystalline moderator like graphite . Mastering this link is key to understanding how a material's crystal structure influences neutron transport.",
            "id": "4258835",
            "problem": "In the thermal scattering treatment based on the scattering law $S(\\alpha,\\beta)$, the double-differential scattering cross section for a neutron of incident wave number $k$ and scattered wave number $k'$ is proportional to $S(\\alpha,\\beta)$, where $\\alpha$ is a dimensionless measure of momentum transfer and $\\beta$ is a dimensionless measure of energy transfer. For coherent elastic scattering from a perfect crystal at sufficiently low temperature that the Debye–Waller reduction can be neglected, the energy transfer is effectively zero (that is, $\\beta = 0$), and nonzero intensity arises only when the momentum transfer $\\mathbf{Q}=\\mathbf{k}-\\mathbf{k}'$ is equal to a reciprocal lattice vector $\\mathbf{G}$.\n\nConsider a polycrystalline (randomly oriented) graphite moderator, and focus on the family of crystal planes with interplanar spacing $d$. The coherent elastic contribution to $S(\\alpha,\\beta)$ is nonzero only when $|\\mathbf{Q}| = |\\mathbf{G}|$, with $|\\mathbf{G}| = 2\\pi/d$. Because a polycrystal samples all orientations, the largest accessible momentum transfer in elastic scattering is $|\\mathbf{Q}|_{\\max} = 2k$. A Bragg edge appears in the energy-dependent cross section each time a new set of planes becomes kinematically accessible, i.e., when $|\\mathbf{G}| = 2k$. Using only fundamental kinematics for nonrelativistic neutrons and the above kinematic accessibility criterion derived from the structure of $S(\\alpha,\\beta)$, derive an expression for the threshold (edge) neutron kinetic energy $E_{\\text{edge}}$ at which the first Bragg edge occurs for a given $d$. Then evaluate $E_{\\text{edge}}$ for the basal planes of graphite with spacing $d = 3.35\\,\\text{\\AA}$.\n\nUse the de Broglie relation and nonrelativistic kinetic energy for neutrons. The following constants are provided: Planck constant $h = 6.62607015 \\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$, neutron mass $m_{n} = 1.674927498 \\times 10^{-27}\\,\\text{kg}$, and $1\\,\\text{eV} = 1.602176634 \\times 10^{-19}\\,\\text{J}$. Take $1\\,\\text{\\AA} = 10^{-10}\\,\\text{m}$. Express your final numerical answer in millielectronvolts (meV) and round your answer to four significant figures.",
            "solution": "The derivation begins by relating the kinetic energy of a nonrelativistic neutron to its wave number. The kinetic energy $E$ of a neutron with mass $m_n$ and momentum $p$ is given by:\n$$\nE = \\frac{p^2}{2m_n}\n$$\nAccording to the de Broglie relation, the momentum $p$ is related to the reduced Planck constant $\\hbar$ and wave number $k$ by $p = \\hbar k$. Substituting this into the energy equation yields:\n$$\nE = \\frac{(\\hbar k)^2}{2m_n} = \\frac{\\hbar^2 k^2}{2m_n}\n$$\nThe problem states that a Bragg edge occurs when the kinematic condition for scattering off a new family of crystal planes is first met. For elastic scattering in a polycrystal, the maximum possible momentum transfer is $|\\mathbf{Q}|_{\\max} = 2k$, which occurs for backscattering. Scattering from a set of planes with reciprocal lattice vector magnitude $|\\mathbf{G}|$ is only possible if the maximum momentum transfer is at least as large as $|\\mathbf{G}|$. The threshold (edge) condition corresponds to the lowest energy (and thus lowest $k$) at which this is possible:\n$$\n2k_{\\text{edge}} = |\\mathbf{G}|\n$$\nThe problem gives the magnitude of the reciprocal lattice vector for planes with interplanar spacing $d$ as $|\\mathbf{G}| = 2\\pi/d$. Substituting this into the threshold condition gives:\n$$\n2k_{\\text{edge}} = \\frac{2\\pi}{d} \\quad \\implies \\quad k_{\\text{edge}} = \\frac{\\pi}{d}\n$$\nThe threshold energy, $E_{\\text{edge}}$, is the kinetic energy corresponding to this wave number. Substituting $k_{\\text{edge}}$ into the energy-wavenumber relation:\n$$\nE_{\\text{edge}} = \\frac{\\hbar^2 k_{\\text{edge}}^2}{2m_n} = \\frac{\\hbar^2}{2m_n} \\left(\\frac{\\pi}{d}\\right)^2 = \\frac{\\hbar^2 \\pi^2}{2m_n d^2}\n$$\nTo express this in terms of the Planck constant $h$, we use $\\hbar = h/(2\\pi)$:\n$$\nE_{\\text{edge}} = \\frac{(h/(2\\pi))^2 \\pi^2}{2m_n d^2} = \\frac{h^2/(4\\pi^2) \\cdot \\pi^2}{2m_n d^2} = \\frac{h^2}{8m_n d^2}\n$$\nThis is the final symbolic expression for the Bragg edge energy.\n\nNow, we evaluate $E_{\\text{edge}}$ for graphite, where $d = 3.35\\,\\text{\\AA}$, using the provided SI constants.\n- $h = 6.62607015 \\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$\n- $m_{n} = 1.674927498 \\times 10^{-27}\\,\\text{kg}$\n- $d = 3.35\\,\\text{\\AA} = 3.35 \\times 10^{-10}\\,\\text{m}$\n\nSubstitute these values into the derived expression:\n$$\nE_{\\text{edge}} = \\frac{(6.62607015 \\times 10^{-34})^2}{8 \\times (1.674927498 \\times 10^{-27}) \\times (3.35 \\times 10^{-10})^2} \\,\\text{J}\n$$\n$$\nE_{\\text{edge}} = \\frac{4.3904855 \\times 10^{-67}}{1.50374185 \\times 10^{-45}} \\,\\text{J} \\approx 2.919717 \\times 10^{-22}\\,\\text{J}\n$$\nTo convert the result to millielectronvolts (meV), we use the conversion factor $1\\,\\text{eV} = 1.602176634 \\times 10^{-19}\\,\\text{J}$.\nFirst, convert Joules to electronvolts:\n$$\nE_{\\text{edge}} (\\text{eV}) = \\frac{2.919717 \\times 10^{-22}\\,\\text{J}}{1.602176634 \\times 10^{-19}\\,\\text{J/eV}} \\approx 0.00182236\\,\\text{eV}\n$$\nNext, convert electronvolts to millielectronvolts ($1\\,\\text{eV} = 1000\\,\\text{meV}$):\n$$\nE_{\\text{edge}} (\\text{meV}) = 0.00182236\\,\\text{eV} \\times 1000\\,\\frac{\\text{meV}}{\\text{eV}} \\approx 1.82236\\,\\text{meV}\n$$\nRounding the result to four significant figures gives:\n$$\nE_{\\text{edge}} \\approx 1.822\\,\\text{meV}\n$$",
            "answer": "$$\n\\boxed{1.822}\n$$"
        },
        {
            "introduction": "The theoretical properties of $S(\\alpha,\\beta)$ must be preserved when the data is discretized and used in computer codes. This final practice moves from theory to application, simulating a core task of nuclear data processing codes like NJOY: ensuring that tabulated scattering data rigorously obeys physical laws. You will implement a procedure to correct a 'raw' data table to enforce the detailed balance principle, and then use this processed data to calculate a double-differential scattering cross-section . This exercise provides a crucial window into the practical treatment of the thermal scattering data used in reactor simulations.",
            "id": "4258837",
            "problem": "You are tasked with implementing a small, self-contained processor that emulates the core steps used by the Evaluated Nuclear Data File (ENDF) processing workflow for the Thermal Scattering Law (TSL), as performed by the Nuclear Data JOY (NJOY) code, Thermal Scattering Kernel Module (THERMR). Your program must use the Thermal Scattering Law, denoted by $S(\\alpha,\\beta)$, to compute the double-differential bound scattering cross section for a neutron scattering event from a bound moderator atom. The independent dimensionless variables are the momentum transfer parameter $\\alpha$ and the energy transfer parameter $\\beta$, which are defined from neutron kinematics and temperature.\n\nThe fundamental base is:\n- Neutron scattering kinematics for thermal scattering in terms of $\\alpha$ and $\\beta$, for a target-to-neutron mass ratio $A$, incident neutron energy $E$, outgoing energy $E'$, scattering cosine $\\mu$ (cosine of the angle between incident and outgoing neutron velocities), and temperature $T$.\n- The equilibrium detailed-balance relation for the Thermal Scattering Law: $S(\\alpha,\\beta) = \\exp(-\\beta)\\,S(\\alpha,-\\beta)$.\n- The double-differential bound scattering cross section formula for incoherent scattering expressed using the Thermal Scattering Law:\n$$\n\\frac{\\mathrm{d}^2 \\sigma}{\\mathrm{d} E' \\mathrm{d} \\Omega} \\;=\\; \\frac{\\sigma_b}{4\\pi\\, k_B T}\\,\\sqrt{\\frac{E'}{E}}\\,S(\\alpha,\\beta),\n$$\nwhere $\\sigma_b$ is the bound scattering cross section.\n\nYou must implement the following steps without relying on any external files:\n1. Construct an artificial ENDF-like $S(\\alpha,\\beta)$ dataset on a tensor grid as would be produced for an ENDF Material File $7$ (thermal scattering). Define the grid as:\n   - $\\alpha$ grid: $[0.0, 0.5, 1.0, 2.0, 4.0]$ (dimensionless).\n   - $\\beta$ grid: $[-4.0, -2.0, -1.0, 0.0, 1.0, 2.0, 4.0]$ (dimensionless).\n   On this grid, define a raw, unbalanced table $S_{\\mathrm{raw}}(\\alpha_i,\\beta_j)$ by the formula\n   $$\n   S_{\\mathrm{raw}}(\\alpha,\\beta) \\;=\\; \\exp(-\\alpha)\\,\\exp\\!\\left(-\\frac{\\beta^2}{1+\\alpha}\\right)\\,\\left(1 + 0.05\\,\\beta\\right).\n   $$\n   This deliberately violates detailed balance by the factor $\\left(1+0.05\\,\\beta\\right)$.\n\n2. Emulate the Thermal Scattering Kernel Module processing step that enforces detailed balance in the $\\beta$ dimension. Construct a balanced table $S_{\\mathrm{bal}}(\\alpha,\\beta)$ by pairwise symmetrization of positive and negative $\\beta$ values so that the balanced table satisfies $S_{\\mathrm{bal}}(\\alpha,\\beta) = \\exp(-\\beta)\\,S_{\\mathrm{bal}}(\\alpha,-\\beta)$ exactly for all tabulated $\\beta$. For each pair $\\pm \\beta$ with $\\beta>0$, define\n   $$\n   S_{\\mathrm{bal}}(\\alpha,+\\beta) \\;=\\; \\frac{1}{2}\\left[S_{\\mathrm{raw}}(\\alpha,+\\beta) \\;+\\; e^{-\\beta} S_{\\mathrm{raw}}(\\alpha,-\\beta)\\right],\n   $$\n   $$\n   S_{\\mathrm{bal}}(\\alpha,-\\beta) \\;=\\; \\frac{1}{2}\\left[S_{\\mathrm{raw}}(\\alpha,-\\beta) \\;+\\; e^{+\\beta} S_{\\mathrm{raw}}(\\alpha,+\\beta)\\right],\n   $$\n   and at $\\beta=0$ set $S_{\\mathrm{bal}}(\\alpha,0)=S_{\\mathrm{raw}}(\\alpha,0)$.\n\n3. Implement bilinear interpolation in the two-dimensional $(\\alpha,\\beta)$ space using the balanced table $S_{\\mathrm{bal}}(\\alpha,\\beta)$ with linear–linear interpolation on the provided grids. If the query $(\\alpha,\\beta)$ lies outside the convex hull of the provided grid, clamp each coordinate independently to the nearest endpoint before interpolating (no extrapolation).\n\n4. For each scattering case, compute $\\alpha$ and $\\beta$ using\n   $$\n   \\alpha \\;=\\; \\frac{E' + E \\;-\\; 2\\,\\sqrt{E E'}\\,\\mu}{A\\,k_B T}, \\qquad \\beta \\;=\\; \\frac{E' - E}{k_B T},\n   $$\n   where $k_B$ is the Boltzmann constant in electron-volts per kelvin. Use $k_B = 8.617333262\\times 10^{-5}\\,\\text{eV/K}$.\n\n5. Using the interpolated $S(\\alpha,\\beta)$ from step $3$, compute the double-differential cross section\n   $$\n   \\frac{\\mathrm{d}^2 \\sigma}{\\mathrm{d} E' \\mathrm{d} \\Omega} \\;=\\; \\frac{\\sigma_b}{4\\pi\\, k_B T}\\,\\sqrt{\\frac{E'}{E}}\\,S(\\alpha,\\beta),\n   $$\n   expressed in barns per electron-volt per steradian, that is, in $\\text{barn}/\\text{eV}/\\text{sr}$.\n\nPhysical units and constants:\n- Energies $E$ and $E'$ must be in electron-volts.\n- Temperature $T$ must be in kelvin.\n- The Boltzmann constant must be $k_B = 8.617333262\\times 10^{-5}\\,\\text{eV/K}$.\n- The output of the double-differential cross section must be in $\\text{barn}/\\text{eV}/\\text{sr}$.\n- The bound scattering cross section is $\\sigma_b$ in barns.\n\nAngle specification:\n- The input scattering cosine $\\mu$ is dimensionless and equals the cosine of the laboratory scattering angle; no angle unit conversion is required.\n\nTest suite:\nCompute the double-differential cross section for the following four cases, using the above procedure, parameters, and units:\n- Case $1$ (down-scatter, moderate angle): $E = 0.0253$, $E' = 0.0100$, $\\mu = 0.3$, $A = 1.0$, $T = 293.6$, $\\sigma_b = 80.27$.\n- Case $2$ (up-scatter, backward angle): $E = 0.0050$, $E' = 0.0200$, $\\mu = -0.5$, $A = 1.0$, $T = 293.6$, $\\sigma_b = 80.27$.\n- Case $3$ (no energy change, forward angle): $E = 0.0253$, $E' = 0.0253$, $\\mu = 1.0$, $A = 1.0$, $T = 293.6$, $\\sigma_b = 80.27$.\n- Case $4$ (extreme up-scatter, edge clamping test): $E = 0.0010$, $E' = 0.5000$, $\\mu = 0.0$, $A = 1.0$, $T = 293.6$, $\\sigma_b = 80.27$.\n\nYour program must:\n- Build the raw table $S_{\\mathrm{raw}}(\\alpha_i,\\beta_j)$ on the given grids using the specified formula.\n- Produce the balanced table $S_{\\mathrm{bal}}(\\alpha_i,\\beta_j)$ using the detailed-balance symmetrization.\n- For each case, compute $\\alpha$ and $\\beta$, clamp to the grid as needed, bilinearly interpolate $S_{\\mathrm{bal}}(\\alpha,\\beta)$, and compute the double-differential cross section in $\\text{barn}/\\text{eV}/\\text{sr}$.\n- Output a single line containing a Python-style list of the four numerical results as decimal numbers, each rounded to exactly $6$ decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[x1,x2,x3,x4]\".",
            "solution": "This problem requires implementing a simplified nuclear data processing workflow. The primary objective is to compute the double-differential bound scattering cross section, $\\frac{\\mathrm{d}^2 \\sigma}{\\mathrm{d} E' \\mathrm{d} \\Omega}$, from the thermal scattering law, $S(\\alpha, \\beta)$, while ensuring physical consistency.\n\n**Step 1: Construct the Raw Scattering Law Table, $S_{\\mathrm{raw}}(\\alpha, \\beta)$**\nFirst, an initial, un-symmetrized $S_{\\mathrm{raw}}(\\alpha, \\beta)$ table is generated on the specified discrete grids for $\\alpha$ and $\\beta$. The value at each grid point $(\\alpha_i, \\beta_j)$ is calculated using the provided formula:\n$$\nS_{\\mathrm{raw}}(\\alpha,\\beta) = \\exp(-\\alpha)\\,\\exp\\!\\left(-\\frac{\\beta^2}{1+\\alpha}\\right)\\,\\left(1 + 0.05\\,\\beta\\right)\n$$\nThe factor $(1 + 0.05\\,\\beta)$ intentionally violates the physical principle of detailed balance, which must be corrected.\n\n**Step 2: Enforce the Detailed Balance Principle**\nA fundamental physical requirement for the scattering law is detailed balance: $S(\\alpha, \\beta) = \\exp(-\\beta) \\, S(\\alpha, -\\beta)$. To enforce this, a new, balanced table $S_{\\mathrm{bal}}(\\alpha, \\beta)$ is constructed via symmetrization. For each $\\alpha$ and for each pair of $(\\pm\\beta)$ values with $\\beta > 0$, the new values are computed as:\n$$\nS_{\\mathrm{bal}}(\\alpha, +\\beta) = \\frac{1}{2}\\left[S_{\\mathrm{raw}}(\\alpha, +\\beta) + e^{-\\beta} S_{\\mathrm{raw}}(\\alpha, -\\beta)\\right]\n$$\n$$\nS_{\\mathrm{bal}}(\\alpha, -\\beta) = \\frac{1}{2}\\left[S_{\\mathrm{raw}}(\\alpha, -\\beta) + e^{+\\beta} S_{\\mathrm{raw}}(\\alpha, +\\beta)\\right]\n$$\nThis procedure guarantees that the resulting $S_{\\mathrm{bal}}(\\alpha, \\beta)$ table correctly satisfies detailed balance. For $\\beta=0$, the value is unchanged: $S_{\\mathrm{bal}}(\\alpha, 0) = S_{\\mathrm{raw}}(\\alpha, 0)$.\n\n**Step 3: Bilinear Interpolation of $S_{\\mathrm{bal}}(\\alpha, \\beta)$**\nThe balanced table is defined only on a discrete grid. To find $S(\\alpha, \\beta)$ for arbitrary values derived from scattering kinematics, bilinear interpolation is used. For a query point $(\\alpha, \\beta)$, the value is found by performing linear interpolation in each dimension within the grid cell. If a query point lies outside the defined grid boundaries, its coordinates are clamped to the nearest boundary value before interpolation.\n\n**Step 4: Calculation of Double-Differential Cross Section**\nFor each test case (defined by $E$, $E'$, $\\mu$, $A$, and $T$), the dimensionless variables $\\alpha$ and $\\beta$ are computed:\n$$\n\\alpha = \\frac{E' + E - 2\\sqrt{E E'}\\,\\mu}{A\\,k_B T}, \\qquad \\beta = \\frac{E' - E}{k_B T}\n$$\nThese values are used to find the corresponding $S(\\alpha, \\beta)$ value from the balanced, interpolated table. Finally, the double-differential cross section (in barn/eV/sr) is calculated using the standard formula for incoherent scattering:\n$$\n\\frac{\\mathrm{d}^2 \\sigma}{\\mathrm{d} E' \\mathrm{d} \\Omega} = \\frac{\\sigma_b}{4\\pi\\, k_B T}\\,\\sqrt{\\frac{E'}{E}}\\,S(\\alpha, \\beta)\n$$\nThe provided Python code implements this complete workflow, from table generation and balancing to interpolation and the final cross-section calculation for each test case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.interpolate import RectBivariateSpline\n\ndef solve():\n    \"\"\"\n    Computes the double-differential thermal neutron scattering cross section\n    by emulating the NJOY/THERMR workflow for S(alpha, beta) data.\n    \"\"\"\n    # 1. Define constants, grids, and test cases as per the problem statement.\n    k_B = 8.617333262e-5  # Boltzmann constant in eV/K\n    alpha_grid = np.array([0.0, 0.5, 1.0, 2.0, 4.0])\n    beta_grid = np.array([-4.0, -2.0, -1.0, 0.0, 1.0, 2.0, 4.0])\n\n    test_cases = [\n        # (E [eV], E' [eV], mu, A, T [K], sigma_b [barn])\n        (0.0253, 0.0100, 0.3, 1.0, 293.6, 80.27),  # Case 1\n        (0.0050, 0.0200, -0.5, 1.0, 293.6, 80.27), # Case 2\n        (0.0253, 0.0253, 1.0, 1.0, 293.6, 80.27),  # Case 3\n        (0.0010, 0.5000, 0.0, 1.0, 293.6, 80.27),  # Case 4\n    ]\n\n    # 2. Construct the raw, unbalanced S(alpha, beta) table.\n    def s_raw_func(alpha, beta):\n        \"\"\"Calculates the value of the raw S(alpha, beta) function.\"\"\"\n        # The term (1 + alpha) is always >= 1.0, so no division by zero.\n        return np.exp(-alpha) * np.exp(-beta**2 / (1.0 + alpha)) * (1.0 + 0.05 * beta)\n\n    # Create meshgrids to evaluate S_raw over the entire grid efficiently.\n    # 'ij' indexing ensures the output array shape is (len(alpha_grid), len(beta_grid)).\n    alpha_mesh, beta_mesh = np.meshgrid(alpha_grid, beta_grid, indexing='ij')\n    S_raw = s_raw_func(alpha_mesh, beta_mesh)\n\n    # 3. Construct the balanced S(alpha, beta) table by enforcing detailed balance.\n    S_bal = np.zeros_like(S_raw)\n    \n    # Find the index corresponding to beta = 0.\n    try:\n        beta_zero_idx = np.where(beta_grid == 0.0)[0][0]\n    except IndexError:\n        raise ValueError(\"Beta grid must contain a 0.0 value.\")\n\n    for i, alpha in enumerate(alpha_grid):\n        # For beta = 0, S_bal = S_raw.\n        S_bal[i, beta_zero_idx] = S_raw[i, beta_zero_idx]\n\n        # For beta > 0, apply the symmetrization formulas.\n        for j in range(beta_zero_idx + 1, len(beta_grid)):\n            beta_pos = beta_grid[j]\n            try:\n                # Find the index of the corresponding negative beta.\n                beta_neg_idx = np.where(beta_grid == -beta_pos)[0][0]\n            except IndexError:\n                raise ValueError(f\"Symmetric beta value for {beta_pos} not found in grid.\")\n\n            s_raw_pos = S_raw[i, j]\n            s_raw_neg = S_raw[i, beta_neg_idx]\n\n            # Symmetrization for +beta\n            S_bal[i, j] = 0.5 * (s_raw_pos + np.exp(-beta_pos) * s_raw_neg)\n            \n            # Symmetrization for -beta\n            # This could also be calculated as np.exp(beta_pos) * S_bal[i, j]\n            # to verify detailed balance, but the direct formula is also provided.\n            S_bal[i, beta_neg_idx] = 0.5 * (s_raw_neg + np.exp(beta_pos) * s_raw_pos)\n\n    # 4. Create a bilinear interpolator for the balanced S(alpha, beta) table.\n    # kx=1 and ky=1 specify linear interpolation in each dimension.\n    s_interpolator = RectBivariateSpline(alpha_grid, beta_grid, S_bal, kx=1, ky=1)\n\n    # 5. Process each test case.\n    results = []\n    for case in test_cases:\n        E, E_prime, mu, A, T, sigma_b = case\n        k_B_T = k_B * T\n\n        # Calculate alpha and beta from scattering kinematics.\n        if E <= 0.0 or E_prime < 0.0:\n            # Physical constraints, avoid math errors.\n            alpha_val = 0.0\n            beta_val = 0.0\n            S_val = 0.0\n        else:\n             alpha_val = (E_prime + E - 2.0 * np.sqrt(E * E_prime) * mu) / (A * k_B_T)\n             beta_val = (E_prime - E) / k_B_T\n\n        # Clamp the calculated alpha and beta to the grid boundaries.\n        alpha_clamped = np.clip(alpha_val, alpha_grid[0], alpha_grid[-1])\n        beta_clamped = np.clip(beta_val, beta_grid[0], beta_grid[-1])\n        \n        # Interpolate to find S(alpha, beta). The result is a 1-element array.\n        S_val = s_interpolator(alpha_clamped, beta_clamped, grid=False).item()\n\n        # Calculate the double-differential cross section.\n        if E == 0.0:\n            ds2_dEdO = 0.0  # Avoid division by zero\n        else:\n            ds2_dEdO = (sigma_b / (4.0 * np.pi * k_B_T)) * np.sqrt(E_prime / E) * S_val\n        \n        results.append(ds2_dEdO)\n\n    # 6. Format the results as specified and print to standard output.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}