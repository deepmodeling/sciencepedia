{
    "hands_on_practices": [
        {
            "introduction": "掌握共振自屏效应的第一步是理解共振截面形状如何影响有效截面。本练习  将理想化的窄共振近似(NRA)与更符合物理实际的多普勒展宽模型进行对比，让你亲手计算并量化温度效应对自屏结果的重要性。通过这个实践，你将能深入理解为何在反应堆分析中必须精确处理多普勒展宽效应。",
            "id": "4245987",
            "problem": "要求您在慢化剂-吸收剂混合物中，针对单一孤立吸收共振，评估窄共振近似在共振自屏背景下的影响。请在能量域中进行计算，单位为电子伏特，并使用以下物理上合理的建模假设和定义。\n\n从以下基础出发，这些基础在慢化理论和单能级共振模型中被广泛使用：\n\n- 单能级共振吸收截面近似为一个以能量 $E_0$ 为中心、半高全宽为 $\\Gamma$、中心高度为 $\\sigma_{\\text{peak}}$（单位为靶恩）的洛伦兹函数。记 $\\gamma = \\Gamma/2$，未展宽的共振吸收截面为\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}.\n$$\n\n- 靶核的热运动会引入多普勒展宽。将多普勒核建模为能量上标准差为 $\\sigma_{\\text{D}}$ 的高斯函数，展宽后的共振是洛伦兹函数与高斯函数的卷积。得到的线型是 Voigt 函数。令 $x = E - E_0$。面积归一化的 Voigt 函数为\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}},\n$$\n其中 $w(z)$ 是 Fadeeva 函数，$\\Re[\\cdot]$ 表示实部。为保持共振面积，将展宽后的吸收截面定义为\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma),\n\\quad\\text{with}\\quad\nA_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}.\n$$\n根据构造，$\\int_{-\\infty}^{\\infty} \\sigma_{\\text{V}}(E)\\, dE = \\int_{-\\infty}^{\\infty} \\sigma_{\\text{L}}(E)\\, dE$，且在 $\\sigma_{\\text{D}} \\to 0$ 的极限情况下，有 $\\sigma_{\\text{V}}(E) \\to \\sigma_{\\text{L}}(E)$。\n\n- 在一个简化的慢化机制中，在包含共振峰的窄能量窗内，本底截面 $\\sigma_{\\text{b}}$（单位为靶恩）为常数，局部中子通量与总截面成反比。在共振窗内将总截面近似为 $\\sigma_{\\text{b}} + \\sigma(E)$，则在能量区间 $[E_{\\text{low}}, E_{\\text{high}}]$ 上，自屏的、经通量加权的有效共振吸收截面定义为\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E)\\, \\phi(E)\\, dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E)\\, dE},\n\\quad\\text{with}\\quad\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}.\n$$\n任何比例常数在比值中都会被抵消。这为共振能量范围内的自屏效应提供了一个基于第一性原理、有物理基础的模型。\n\n在本问题中，将窄共振近似（NRA）定义为忽略多普勒展宽的近似，即使用 $\\sigma(E) = \\sigma_{\\text{L}}(E)$ 来计算 $\\sigma_{\\text{eff}}$。参考的“数值展宽自屏”结果则使用 $\\sigma(E) = \\sigma_{\\text{V}}(E)$ 和给定的多普勒宽度 $\\sigma_{\\text{D}}$。\n\n对于下方的每个测试用例，计算窄共振近似相对于展宽后参考值的相对误差，该误差定义为无量纲量\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}.\n$$\n\n所有能量必须以电子伏特（$\\mathrm{eV}$）处理。所有截面必须以靶恩处理。温度以开尔文（$\\mathrm{K}$）给出，仅为提供背景信息；多普勒宽度 $\\sigma_{\\text{D}}$ 对每个用例都直接以 $\\mathrm{eV}$ 为单位提供，且必须按给定值使用。本问题不涉及角度。您的程序必须对所需的能量积分进行数值计算。\n\n测试套件（每个元组为 $(E_0, \\Gamma, \\sigma_{\\text{peak}}, \\sigma_{\\text{b}}, \\sigma_{\\text{D}}, E_{\\text{low}}, E_{\\text{high}}, T)$，单位如说明）：\n- 用例 1（中等自屏，可分辨共振）：$(6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900)$。\n- 用例 2（大本底截面，自屏减弱）：$(6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900)$。\n- 用例 3（无多普勒展宽，检验极限行为）：$(20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300)$。\n- 用例 4（极窄热共振，强自屏）：$(0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600)$。\n\n您的程序应生成单行输出，其中包含这四个用例的相对误差，形式为一个用方括号括起来的逗号分隔列表，每个浮点数四舍五入到六位小数（例如，$[0.123456,-0.000001,0.000000,0.987654]$）。最终答案是如上文 $\\varepsilon$ 定义的无单位小数。",
            "solution": "该问题已经过验证，是计算核反应堆物理领域一个良态的、有科学依据的练习。它要求对多普勒展宽对共振自屏的影响进行数值评估。\n\n### 1. 理论框架\n\n问题的核心在于比较两种计算有效共振吸收截面 $\\sigma_{\\text{eff}}$ 的模型。这个量代表在指定能量范围内、考虑了自屏现象的通量加权平均截面。\n\n**a. 共振截面线型**\n\n- **洛伦兹（自然）线型：** 单一、孤立共振的固有能量依赖吸收截面由单能级 Breit-Wigner 公式描述，该公式具有洛伦兹形状。其表达式为：\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}\n$$\n其中 $E_0$ 是共振能量，$\\sigma_{\\text{peak}}$ 是截面峰值，$\\gamma = \\Gamma/2$ 是半高半宽。\n\n- **Voigt（多普勒展宽）线型：** 在有限温度的物理介质中，靶核处于热运动状态。这种运动会使靶核“看到”的入射中子的表观能量产生多普勒频移。对核速的麦克斯韦分布进行平均，相当于将洛伦兹线型与一个高斯函数进行卷积。最终得到的形状是 Voigt 线型。问题给出了面积守恒的公式：\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma)\n$$\n此处，$A_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}$ 是洛伦兹曲线下的面积，该面积在展宽过程中守恒。$\\sigma_{\\text{D}}$ 项是高斯多普勒核的标准差，而 $V(x; \\sigma_{\\text{D}}, \\gamma)$ 是面积归一化的 Voigt 函数，使用 Fadeeva 函数 $w(z)$ 定义：\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}}\n$$\n在多普勒宽度趋于零（$\\sigma_{\\text{D}} \\to 0$）的极限情况下，Voigt 线型 $\\sigma_{\\text{V}}(E)$ 收敛于洛伦兹线型 $\\sigma_{\\text{L}}(E)$。\n\n**b. 自屏与有效截面**\n\n共振自屏是通量凹陷的结果。在吸收截面 $\\sigma(E)$ 很大的能量处，中子被优先吸收，导致中子通量 $\\phi(E)$ 出现局部下降。在均匀混合物中，描述此效应的标准模型是：\n$$\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{total}}(E)} \\approx \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}\n$$\n其中 $\\sigma_{\\text{b}}$ 是每个吸收剂原子的恒定本底截面。\n\n有效截面 $\\sigma_{\\text{eff}}$ 是由这个凹陷的通量加权的 $\\sigma(E)$ 的平均值，以确保总反应率得以保持。它通过两个积分的比值计算得出：\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E) \\phi(E) dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E) dE} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma(E)}{\\sigma_{\\text{b}} + \\sigma(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)} dE}\n$$\n这些积分通常没有闭合形式的解析解，必须进行数值计算。\n\n### 2. 计算流程\n\n为了求得相对误差 $\\varepsilon$，我们必须使用近似和参考两种截面模型来计算 $\\sigma_{\\text{eff}}$。\n\n**a. 展宽后的有效截面 ($\\sigma_{\\text{eff}}^{\\text{broadened}}$)**\n这是参考计算，它使用物理上准确的多普勒展宽截面 $\\sigma(E) = \\sigma_{\\text{V}}(E)$。该计算需要数值求解：\n$$\n\\sigma_{\\text{eff}}^{\\text{broadened}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{V}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}\n$$\n当 $\\sigma_{\\text{D}} = 0$ 时，会出现一个特殊情况，此时我们设 $\\sigma_{\\text{V}}(E) = \\sigma_{\\text{L}}(E)$。\n\n**b. 窄共振近似 ($\\sigma_{\\text{eff}}^{\\text{NRA}}$)**\n这个近似，如问题中所定义，忽略了多普勒展宽，因此我们使用自然线型 $\\sigma(E) = \\sigma_{\\text{L}}(E)$。计算公式为：\n$$\n\\sigma_{\\text{eff}}^{\\text{NRA}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{L}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}\n$$\n\n**c. 相对误差 ($\\varepsilon$)**\n最后一步是使用给出的定义计算相对误差：\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}\n$$\n多普勒展宽会降低共振峰的峰值并加宽其基底。在自屏场景下（低 $\\sigma_{\\text{b}}$），峰值处的吸收已经饱和。展宽使得共振峰更宽的翼部暴露在更高、凹陷程度较低的通量中，这通常会增加总体有效吸收。因此，我们预期 $\\sigma_{\\text{eff}}^{\\text{broadened}} > \\sigma_{\\text{eff}}^{\\text{NRA}}$，这将导致一个负的误差 $\\varepsilon$。\n\n### 3. 实现细节\n\n该解决方案将用 Python 实现。\n- 数值积分将使用 `scipy.integrate` 中的 `quad` 函数执行，该函数提供稳健且精确的求积方法。\n- Voigt 线型所需的 Fadeeva 函数 $w(z)$ 将使用 `scipy.special` 中的 `wofz` 函数进行求值。\n- 将设计一个通用函数来计算 $\\sigma_{\\text{eff}}$，该函数接受相应的截面函数（$\\sigma_{\\text{L}}$ 或 $\\sigma_{\\text{V}}$）作为参数。\n- 主程序将遍历每个测试用例，执行两次 $\\sigma_{\\text{eff}}$ 的计算，计算相对误差，并存储结果。\n- 将明确处理 $\\sigma_{\\text{D}} = 0$ 的情况，以确保 $\\varepsilon = 0$ 并避免出现如除以零之类的数值问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the resonance self-shielding problem by calculating the relative\n    error of the Narrow Resonance Approximation (NRA) with respect to a\n    Doppler-broadened reference calculation.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Format: (E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, T)\n    test_cases = [\n        (6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900),\n        (6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900),\n        (20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300),\n        (0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600),\n    ]\n\n    def sigma_lorentzian(E, E0, gamma, sigma_peak):\n        \"\"\"Calculates the Lorentzian (unbroadened) cross section.\"\"\"\n        return sigma_peak * (gamma**2) / ((E - E0)**2 + gamma**2)\n\n    def sigma_voigt(E, E0, gamma, sigma_peak, sigma_D):\n        \"\"\"Calculates the Voigt (Doppler-broadened) cross section.\"\"\"\n        # Calculate the resonance area to preserve it.\n        area_L = np.pi * gamma * sigma_peak\n        \n        # Argument for the Fadeeva function.\n        z = (E - E0 + 1j * gamma) / (sigma_D * np.sqrt(2.0))\n        \n        # Area-normalized Voigt function V(E-E0; sigma_D, gamma).\n        # V = Re[w(z)] / (sigma_D * sqrt(2*pi))\n        voigt_func_val = np.real(wofz(z)) / (sigma_D * np.sqrt(2.0 * np.pi))\n        \n        return area_L * voigt_func_val\n\n    def calculate_effective_xs(xs_func, E_low, E_high, sigma_b, *xs_args):\n        \"\"\"\n        Calculates the self-shielded effective cross section for a given\n        cross section function (xs_func) over an energy interval.\n        \"\"\"\n        # Define the integrand for the numerator of the sigma_eff expression.\n        def numerator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return xs_val / (sigma_b + xs_val)\n\n        # Define the integrand for the denominator of the sigma_eff expression.\n        def denominator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return 1.0 / (sigma_b + xs_val)\n\n        # Use high-precision numerical integration.\n        num_integral, _ = quad(numerator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n        den_integral, _ = quad(denominator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n\n        # Avoid division by zero, although physically unlikely for this problem.\n        if abs(den_integral) < 1e-15:\n            return 0.0\n        \n        return num_integral / den_integral\n\n    results = []\n    for case in test_cases:\n        E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, _ = case\n        gamma = Gamma / 2.0\n\n        # --- 1. Calculate the NRA effective cross section ---\n        xs_args_lor = (E0, gamma, sigma_peak)\n        sigma_eff_nra = calculate_effective_xs(\n            sigma_lorentzian, E_low, E_high, sigma_b, *xs_args_lor\n        )\n\n        # --- 2. Calculate the Broadened effective cross section ---\n        # Handle the limiting case of zero Doppler broadening.\n        # In this limit, the Voigt profile becomes the Lorentzian profile.\n        if sigma_D < 1e-9:\n            sigma_eff_broadened = sigma_eff_nra\n        else:\n            xs_args_voigt = (E0, gamma, sigma_peak, sigma_D)\n            sigma_eff_broadened = calculate_effective_xs(\n                sigma_voigt, E_low, E_high, sigma_b, *xs_args_voigt\n            )\n\n        # --- 3. Calculate the relative error ---\n        if abs(sigma_eff_broadened) < 1e-12:\n            # If the broadened result is effectively zero, the NRA result\n            # should also be zero, so the error is zero.\n            epsilon = 0.0\n        else:\n            epsilon = (sigma_eff_nra - sigma_eff_broadened) / sigma_eff_broadened\n        \n        results.append(epsilon)\n\n    # Format the final output string as specified.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了单个共振的有效截面后，下一步是学习如何将这些精细的能量相关信息转化为确定论程序可以使用的多群常数，其中邦达连科方法是核心技术之一。本练习  让你探索这些群常数对计算中所用的权重谱形状的敏感性。你将量化因参考谱与真实谱不匹配而引入的偏差，这是生成高精度核数据库时面临的关键挑战。",
            "id": "4246007",
            "problem": "您的任务是量化参考中子能谱 $\\phi_{0}(E)$ 的选择如何影响单一吸收体核素的 Bondarenko 自屏因子，并计算当真实系统能谱与参考能谱不同时，在自屏多群吸收截面 $\\sigma_{g}$ 中产生的偏差。该任务必须从第一性原理出发按如下方式解决。\n\n从以下两个基本依据出发：\n- 群平均截面在能量 $E$ 上的定义，\n$$\n\\sigma_{g} \\equiv \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi(E)\\,\\sigma(E)\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi(E)\\,dE},\n$$\n其中 $\\phi(E)$ 是中子通量形状，$\\sigma(E)$ 是微观吸收截面。\n- 背景截面窄共振通量形状模型（共振自屏中的一个标准方法），该模型将在稀释截面 $D$（单位为靶恩）下的能量相关通量视为与以下表达式成正比\n$$\n\\phi(E;D) \\propto \\frac{\\phi_{0}(E)}{\\sigma(E)+D}.\n$$\n\n由此，推导在给定 $D$ 和参考能谱 $\\phi_{0}(E)$ 下的一致性自屏群截面，\n$$\n\\sigma_{g}^{\\text{ref}}(D) = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\dfrac{\\sigma(E)}{\\sigma(E)+D}\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\dfrac{1}{\\sigma(E)+D}\\,dE},\n$$\n以及使用相同参考能谱的无限稀释群截面，\n$$\n\\sigma_{g}^{\\infty,\\text{ref}} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\sigma(E)\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,dE}.\n$$\n将 Bondarenko 自屏因子定义为\n$$\nB_{g}^{\\text{ref}}(D) \\equiv \\frac{\\sigma_{g}^{\\text{ref}}(D)}{\\sigma_{g}^{\\infty,\\text{ref}}}.\n$$\n\n为量化能谱不匹配偏差，定义一个真实系统能谱 $\\phi_{\\text{true}}(E)$，并计算相应的一致性自屏群截面\n$$\n\\sigma_{g}^{\\text{true}}(D) = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{\\text{true}}(E)\\,\\dfrac{\\sigma(E)}{\\sigma(E)+D}\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{\\text{true}}(E)\\,\\dfrac{1}{\\sigma(E)+D}\\,dE}.\n$$\n对于任意选定的参考能谱 $\\phi_{0}(E)$，以靶恩为单位的绝对偏差为\n$$\n\\Delta\\sigma_{g}^{\\text{ref}}(D) \\equiv \\sigma_{g}^{\\text{ref}}(D) - \\sigma_{g}^{\\text{true}}(D).\n$$\n\n实现一个程序，使用以下科学上合理且完全指定的输入来近似单一吸收体的可分辨共振能量范围：\n\n- 能量网格：从 $E_{\\min} = 10^{0}\\,\\text{eV}$ 到 $E_{\\max} = 10^{4}\\,\\text{eV}$ 对数均匀分布的 $N = 20000$ 个点。\n\n- 吸收截面模型（单位为靶恩），为一个 $1/v$ 尾部和几个洛伦兹共振峰之和，\n$$\n\\sigma(E) = \\frac{A_{v}}{\\sqrt{E}} + \\sum_{i=1}^{5} A_{i}\\,\\frac{\\left(\\dfrac{\\Gamma_{i}}{2}\\right)^{2}}{(E - E_{i})^{2} + \\left(\\dfrac{\\Gamma_{i}}{2}\\right)^{2}},\n$$\n系数如下\n$\nA_{v} = 2.0,\n$\n$\n\\{E_{i}\\}_{i=1}^{5} = \\{6.67,\\,20.9,\\,36.7,\\,66.0,\\,96.7\\}\\,\\text{eV},\n$\n$\n\\{\\Gamma_{i}\\}_{i=1}^{5} = \\{0.30,\\,0.50,\\,1.00,\\,2.00,\\,3.00\\}\\,\\text{eV},\n$\n$\n\\{A_{i}\\}_{i=1}^{5} = \\{2000,\\,800,\\,500,\\,300,\\,200\\}\\,\\text{barns}.\n$\n\n- 参考能谱（非归一化形状是可接受的，因为归一化因子在比率中会抵消）：\n  - 类氧化铀（UOX）超热中子参考能谱：$\\phi_{0}^{\\text{UOX}}(E) \\propto E^{-1.0}$。\n  - 类混合氧化物（MOX）更硬的超热中子参考能谱：$\\phi_{0}^{\\text{MOX}}(E) \\propto E^{-0.8}$。\n\n- 用于偏差量化的真实系统能谱：$\\phi_{\\text{true}}(E) \\propto E^{-0.9}$。\n\n- 测试组（稀释截面，单位为靶恩），以覆盖不同的屏效应区：\n  - 强自屏：$D_{1} = 1.0$。\n  - 中等自屏：$D_{2} = 100.0$。\n  - 接近无限稀释：$D_{3} = 10^{6}$。\n\n必须在指定的网格上使用一致的求积法则进行数值积分。所有截面必须以靶恩为单位计算。不使用角度。程序必须为每个稀释度 $D_{k}$（其中 $k \\in \\{1,2,3\\}$）计算：\n- MOX 和 UOX 参考能谱下的 Bondarenko 因子之差，\n$\n\\Delta B(D_{k}) \\equiv B_{g}^{\\text{MOX}}(D_{k}) - B_{g}^{\\text{UOX}}(D_{k}),\n$\n无量纲。\n- 使用 UOX 参考能谱相对于真实能谱时，群吸收截面的绝对偏差，单位为靶恩，\n$\n\\Delta\\sigma_{g}^{\\text{UOX}}(D_{k}),\n$\n单位为靶恩。\n- 使用 MOX 参考能谱相对于真实能谱时，群吸收截面的绝对偏差，单位为靶恩，\n$\n\\Delta\\sigma_{g}^{\\text{MOX}}(D_{k}),\n$\n单位为靶恩。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，结果按以下顺序排列：\n$\n[\\Delta B(D_{1}),\\,\\Delta\\sigma_{g}^{\\text{UOX}}(D_{1}),\\,\\Delta\\sigma_{g}^{\\text{MOX}}(D_{1}),\\,\\Delta B(D_{2}),\\,\\Delta\\sigma_{g}^{\\text{UOX}}(D_{2}),\\,\\Delta\\sigma_{g}^{\\text{MOX}}(D_{2}),\\,\\Delta B(D_{3}),\\,\\Delta\\sigma_{g}^{\\text{UOX}}(D_{3}),\\,\\Delta\\sigma_{g}^{\\text{MOX}}(D_{3})].\n$\n- 将 $\\Delta B(D_{k})$ 表示为无量纲浮点数，保留六位小数；将 $\\Delta\\sigma_{g}^{\\text{UOX}}(D_{k})$ 和 $\\Delta\\sigma_{g}^{\\text{MOX}}(D_{k})$ 以靶恩为单位表示，保留六位小数。\n- 输出中不允许包含任何额外文本。\n\n您的实现必须是自包含的，且不需要外部输入。仅使用提供的参数。所有涉及截面的物理量必须以靶恩为单位处理，所有能量单位为电子伏特（eV）。积分必须遵循给定的能量边界（以eV为单位）。程序必须用通用的现代编程语言编写，并可使用标准的数值库进行积分和数组操作，前提是最终输出格式完全符合上述规定。",
            "solution": "问题陈述已经过严格验证，被认为是有效的。它在科学上基于核反应堆物理学原理，特别是共振自屏理论。该问题提法恰当、客观、自包含且计算上可行。所有定义、参数和目标都以足够的清晰度和精确度进行了规定，从而能够得出唯一且有意义的解。\n\n任务是量化在 Bondarenko 自屏因子方法中因选择不同参考能谱而导致的多群截面偏差。这将通过从第一性原理推导必要的公式，然后针对一个指定的测试案例进行数值实现来完成。\n\n我们从提供的两个基本定义开始。首先，对于一个具有微观截面 $\\sigma(E)$ 并暴露于中子通量 $\\phi(E)$ 的材料，其在能群 $[E_{\\min}, E_{\\max}]$ 上的群平均截面 $\\sigma_g$ 的定义为：\n$$\n\\sigma_{g} \\equiv \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi(E)\\,\\sigma(E)\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi(E)\\,dE}\n$$\n此方程将群截面定义为每个原子的反应率，按能量相关的中子通量进行平均。\n\n其次，我们使用窄共振（NR）近似来描述含有共振吸收体的燃料块内的通量形状。该模型指出，在吸收截面 $\\sigma(E)$ 较高的能量处，通量 $\\phi(E; D)$ 会被“压低”。它被给定为与一个平滑的背景通量 $\\phi_0(E)$ 成正比，并除以总截面，总截面近似为 $\\sigma(E) + D$，其中 $D$ 是一个有效稀释截面，代表与吸收体混合的所有其他材料。\n$$\n\\phi(E;D) \\propto \\frac{\\phi_{0}(E)}{\\sigma(E)+D}\n$$\n设比例常数为 $C$。将此通量形状 $\\phi(E;D) = C \\frac{\\phi_{0}(E)}{\\sigma(E)+D}$ 代入 $\\sigma_g$ 的定义，得到给定参考能谱 $\\phi_0(E)$ 下的自屏群截面 $\\sigma_g^{\\text{ref}}(D)$：\n$$\n\\sigma_{g}^{\\text{ref}}(D) = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\left( C \\frac{\\phi_{0}(E)}{\\sigma(E)+D} \\right) \\sigma(E)\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\left( C \\frac{\\phi_{0}(E)}{\\sigma(E)+D} \\right) dE}\n$$\n常数 $C$ 被消去，从而得出与 NR 模型一致的自屏群截面表达式：\n$$\n\\sigma_{g}^{\\text{ref}}(D) = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\dfrac{\\sigma(E)}{\\sigma(E)+D}\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\dfrac{1}{\\sigma(E)+D}\\,dE}\n$$\n无限稀释群截面 $\\sigma_{g}^{\\infty,\\text{ref}}$ 代表吸收体被稀释到如此程度（$D \\to \\infty$）以至于它不再扰动背景通量的情况。在此极限下，通量形状 $\\phi(E; D)$ 就变成了参考通量 $\\phi_0(E)$。将此应用于 $\\sigma_g$ 的基本定义，得到：\n$$\n\\sigma_{g}^{\\infty,\\text{ref}} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,\\sigma(E)\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{0}(E)\\,dE}\n$$\nBondarenko 自屏因子 $B_{g}^{\\text{ref}}(D)$ 定义为自屏截面与无限稀释截面之比。它量化了由于通量压低而导致的有效截面的减小。\n$$\nB_{g}^{\\text{ref}}(D) \\equiv \\frac{\\sigma_{g}^{\\text{ref}}(D)}{\\sigma_{g}^{\\infty,\\text{ref}}}\n$$\n为了评估因错误选择参考能谱而引入的误差，我们假设一个“真实”的系统能谱 $\\phi_{\\text{true}}(E)$，它将产生真实的自屏截面 $\\sigma_{g}^{\\text{true}}(D)$：\n$$\n\\sigma_{g}^{\\text{true}}(D) = \\frac{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{\\text{true}}(E)\\,\\dfrac{\\sigma(E)}{\\sigma(E)+D}\\,dE}{\\int_{E_{\\min}}^{E_{\\max}} \\phi_{\\text{true}}(E)\\,\\dfrac{1}{\\sigma(E)+D}\\,dE}\n$$\n当使用参考能谱 $\\phi_0(E)$ 而非真实能谱时，绝对偏差是其差值：\n$$\n\\Delta\\sigma_{g}^{\\text{ref}}(D) \\equiv \\sigma_{g}^{\\text{ref}}(D) - \\sigma_{g}^{\\text{true}}(D)\n$$\n计算过程是数值评估这些量。首先，我们将能量域从 $E_{\\min} = 10^0\\,\\text{eV}$ 到 $E_{\\max} = 10^4\\,\\text{eV}$ 在对数网格上离散化为 $N = 20000$ 个点，这在指定共振峰所在的较低能量处提供了更高的分辨率。设此网格为 $\\{E_j\\}$。\n\n接下来，我们使用提供的模型在每个网格点上评估吸收截面 $\\sigma(E_j)$，该模型是一个 $1/v$ 分量和五个 Breit-Wigner（洛伦兹）共振峰之和：\n$$\n\\sigma(E) = \\frac{A_{v}}{\\sqrt{E}} + \\sum_{i=1}^{5} A_{i}\\,\\frac{\\left(\\dfrac{\\Gamma_{i}}{2}\\right)^{2}}{(E - E_{i})^{2} + \\left(\\dfrac{\\Gamma_{i}}{2}\\right)^{2}}\n$$\n参数为 $A_v = 2.0$，$\\{E_i\\} = \\{6.67, 20.9, 36.7, 66.0, 96.7\\}\\,\\text{eV}$，$\\{\\Gamma_i\\} = \\{0.30, 0.50, 1.00, 2.00, 3.00\\}\\,\\text{eV}$，以及 $\\{A_i\\} = \\{2000, 800, 500, 300, 200\\}\\,\\text{barns}$。\n\n类似地，我们在相同的能量网格上评估三个通量能谱：\n-   $\\phi_0^{\\text{UOX}}(E_j) = E_j^{-1.0}$\n-   $\\phi_0^{\\text{MOX}}(E_j) = E_j^{-0.8}$\n-   $\\phi_{\\text{true}}(E_j) = E_j^{-0.9}$\n\n然后，所有积分都使用梯形法则在网格 $\\{E_j\\}$ 上近似为离散和，这对于精细划分的网格是一种一致且稳健的求积方法。对于任意被积函数 $f(E)$，积分为 $\\int f(E) dE \\approx \\sum_{j=1}^{N-1} \\frac{1}{2}(f(E_{j+1}) + f(E_j))(E_{j+1} - E_j)$。\n\n对于每个稀释值 $D_k \\in \\{1.0, 100.0, 10^6\\}$ 靶恩，计算以下各项：\n1.  无限稀释截面 $\\sigma_{g}^{\\infty,\\text{UOX}}$ 和 $\\sigma_{g}^{\\infty,\\text{MOX}}$。这些值对所有 $D_k$ 都是常数。\n2.  自屏截面 $\\sigma_{g}^{\\text{UOX}}(D_k)$、$\\sigma_{g}^{\\text{MOX}}(D_k)$ 和 $\\sigma_{g}^{\\text{true}}(D_k)$。\n3.  Bondarenko 因子 $B_{g}^{\\text{UOX}}(D_k)$ 和 $B_{g}^{\\text{MOX}}(D_k)$。\n4.  最终关注的量：$\\Delta B(D_k) = B_{g}^{\\text{MOX}}(D_k) - B_{g}^{\\text{UOX}}(D_k)$、$\\Delta\\sigma_{g}^{\\text{UOX}}(D_k) = \\sigma_{g}^{\\text{UOX}}(D_k) - \\sigma_{g}^{\\text{true}}(D_k)$ 和 $\\Delta\\sigma_{g}^{\\text{MOX}}(D_k) = \\sigma_{g}^{\\text{MOX}}(D_k) - \\sigma_{g}^{\\text{true}}(D_k)$。\n\n这个系统化的过程允许我们直接定量比较在不同自屏区中，使用不同标准参考能谱（UOX 和 MOX）相对于已知“真实”能谱所产生的影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes biases in Bondarenko factors and self-shielded cross sections\n    due to reference spectrum mismatch.\n    \"\"\"\n    \n    # 1. Define physical constants and problem parameters\n    E_min = 1.0  # eV\n    E_max = 1e4  # eV\n    N = 20000    # Number of grid points\n\n    # Cross section parameters\n    A_v = 2.0\n    E_resonances = np.array([6.67, 20.9, 36.7, 66.0, 96.7])      # eV\n    Gamma_widths = np.array([0.30, 0.50, 1.00, 2.00, 3.00])      # eV\n    A_amplitudes = np.array([2000.0, 800.0, 500.0, 300.0, 200.0]) # barns\n\n    # Test cases for dilution cross section D (barns)\n    test_cases = [1.0, 100.0, 1e6]\n\n    # 2. Set up energy grid and evaluate functions on the grid\n    # Logarithmic grid for better resolution at lower energies\n    E_grid = np.logspace(np.log10(E_min), np.log10(E_max), N)\n\n    # Calculate absorption cross section sigma(E) on the grid\n    sigma_E = A_v / np.sqrt(E_grid)\n    for i in range(len(E_resonances)):\n        lorentzian = A_amplitudes[i] * ((Gamma_widths[i] / 2.0)**2) / \\\n                     ((E_grid - E_resonances[i])**2 + (Gamma_widths[i] / 2.0)**2)\n        sigma_E += lorentzian\n\n    # Evaluate flux spectra phi(E) on the grid\n    phi_uox_E = E_grid**(-1.0)\n    phi_mox_E = E_grid**(-0.8)\n    phi_true_E = E_grid**(-0.9)\n\n    # 3. Define helper functions for physical quantities using numerical integration\n    def trapz_integrate(integrand, grid):\n        return np.trapz(integrand, grid)\n\n    def calculate_sigma_g(D, phi_E, sigma_E_grid, E_grid):\n        \"\"\"Calculates the self-shielded group cross section.\"\"\"\n        integrand_num = phi_E * (sigma_E_grid / (sigma_E_grid + D))\n        integrand_den = phi_E * (1.0 / (sigma_E_grid + D))\n        \n        integral_num = trapz_integrate(integrand_num, E_grid)\n        integral_den = trapz_integrate(integrand_den, E_grid)\n        \n        # Denominator will be non-zero for physical inputs\n        return integral_num / integral_den\n\n    def calculate_sigma_g_inf(phi_E, sigma_E_grid, E_grid):\n        \"\"\"Calculates the infinite-dilution group cross section.\"\"\"\n        integral_num = trapz_integrate(phi_E * sigma_E_grid, E_grid)\n        integral_den = trapz_integrate(phi_E, E_grid)\n        \n        return integral_num / integral_den\n\n    # 4. Pre-calculate quantities that do not depend on dilution D\n    sigma_g_inf_uox = calculate_sigma_g_inf(phi_uox_E, sigma_E, E_grid)\n    sigma_g_inf_mox = calculate_sigma_g_inf(phi_mox_E, sigma_E, E_grid)\n\n    # 5. Loop over test cases and compute the required quantities\n    results = []\n    for Dk in test_cases:\n        # Calculate self-shielded cross sections for current Dk\n        sigma_g_uox_Dk = calculate_sigma_g(Dk, phi_uox_E, sigma_E, E_grid)\n        sigma_g_mox_Dk = calculate_sigma_g(Dk, phi_mox_E, sigma_E, E_grid)\n        sigma_g_true_Dk = calculate_sigma_g(Dk, phi_true_E, sigma_E, E_grid)\n\n        # Calculate Bondarenko factors\n        B_g_uox_Dk = sigma_g_uox_Dk / sigma_g_inf_uox\n        B_g_mox_Dk = sigma_g_mox_Dk / sigma_g_inf_mox\n        \n        # Calculate difference in Bondarenko factors\n        delta_B_Dk = B_g_mox_Dk - B_g_uox_Dk\n        \n        # Calculate absolute biases in group cross section\n        delta_sigma_uox_Dk = sigma_g_uox_Dk - sigma_g_true_Dk\n        delta_sigma_mox_Dk = sigma_g_mox_Dk - sigma_g_true_Dk\n        \n        results.extend([delta_B_Dk, delta_sigma_uox_Dk, delta_sigma_mox_Dk])\n        \n    # 6. Format and print the final output as a single line\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the main function\nsolve()\n```"
        },
        {
            "introduction": "真实反应堆栅格中的自屏效应同时具有能量和空间两个维度。除了燃料内部的能量自屏外，燃料棒之间的相互影响（即所谓的“丹可夫效应”）也至关重要。本练习  专注于这种空间耦合效应，要求你推导并实现一个能量相关的丹可夫因子模型，并量化使用简化的、与能量无关的常数近似所带来的计算误差。",
            "id": "4245995",
            "problem": "在热中子反应堆中，由于慢化剂和燃料的有效总截面对能量有很强的依赖性，异质燃料栅格会表现出共振自屏效应。在可分辨共振区，燃料棒间的耦合通常通过一个类似丹可夫因子的屏蔽因子来表示，此处记为$C(E)$。该因子描述了一个中子离开一个燃料块后，在未与周围慢化剂发生碰撞的情况下到达另一个燃料块的概率。许多模拟工作流程使用一个均匀且不依赖于能量的常数$C$，这会在能群间的反应率预测和背景截面估算中引入偏差。\n\n基于以下基础：\n\n- 在均匀材料中，中子沿飞行路径的碰撞遵循泊松过程，其速率等于宏观总截面。因此，在行进距离$d$内不发生碰撞的概率为$\\exp(-\\Sigma_t d)$，其中$\\Sigma_t$是宏观总截面。\n- 在栅格中，当慢化剂的光学厚度可忽略不计时，棒间耦合概率趋近于一个由几何决定的极限值$C_g$。几何结构可以用一个特征块间路径长度$D_{\\mathrm{eff}}$来表示。\n- 可分辨共振区的超热中子通量形状可以近似为$1/E$的慢化能权重。\n\n您的任务是：\n\n1. 相对于一个与上述基本原理一致的能量依赖模型$C(E)$，量化在所有能群中使用统一常数$C$所产生的误差。使用通量-慢化能权重来衡量跨能群的偏差。\n2. 基于第一性原理，提出并实现一个能量依赖的$C(E)$模型。该模型需根据中子在慢化剂中无碰撞飞行的指数衰减和几何极限$C_g$推导得出。\n3. 对于每个测试案例，计算两个误差指标，以比较通量加权的统一常数$C_{\\mathrm{uni}}$与能量依赖的$C(E)$：\n   - 所有能群中的最大绝对偏差，$\\max_{g} \\lvert C_{\\mathrm{uni}} - C(E_g) \\rvert$。\n   - 通量加权的相对均方根误差，\n     $$\n     \\mathrm{RelRMS} = \\frac{\\sqrt{\\sum_g w_g \\left( C_{\\mathrm{uni}} - C(E_g) \\right)^2}}{\\sqrt{\\sum_g w_g \\, C(E_g)^2}},\n     $$\n     其中$w_g$是与$1/E_g$成正比的通量-慢化能权重。\n4. 构建一个包含不同慢化剂光学厚度和栅格间距的、符合材料物理实际的小型测试套件，并以无量纲十进制数的形式报告每个案例的两个指标。\n\n能群和单位：\n\n- 使用$N = 12$个能量点，从$E_{\\min} = \\mathrm{1\\,eV}$到$E_{\\max} = \\mathrm{10^4\\,eV}$呈对数等距分布。\n- 能量$E$的单位为$\\mathrm{eV}$，距离单位为$\\mathrm{cm}$。截面$\\Sigma$的单位为$\\mathrm{cm^{-1}}$。\n- 慢化剂的宏观总截面模型为\n  $$\n  \\Sigma_{t,m}(E) = \\Sigma_s + \\Sigma_{a,0} + \\frac{k_E}{\\sqrt{E}},\n  $$\n  其中$\\Sigma_s$是散射项，$\\Sigma_{a,0}$是一个小的吸收基线，而$k_E$是一个捕捉吸收趋势的弱能量依赖项，其单位为$\\mathrm{cm^{-1}\\,eV^{1/2}}$，使得$\\frac{k_E}{\\sqrt{E}}$的单位为$\\mathrm{cm^{-1}}$。\n- 定义通量-慢化能权重$w_g = \\frac{1}{E_g}$。\n\n能量依赖的$C(E)$建模要求：\n\n- 从中子在特征棒间慢化剂路径$D_{\\mathrm{eff}}$上无碰撞飞行的概率和几何极限$C_g$推导出$C(E)$的形式。实现此$C(E)$以计算各项指标。\n\n统一常数$C_{\\mathrm{uni}}$：\n\n- 将$C_{\\mathrm{uni}}$计算为$C(E)$在指定能量点上经通量加权的平均值，\n  $$\n  C_{\\mathrm{uni}} = \\frac{\\sum_g w_g \\, C(E_g)}{\\sum_g w_g}.\n  $$\n\n测试套件：\n\n- 案例1（基准压水堆(PWR)类栅格）：$D_{\\mathrm{eff}} = \\mathrm{0.20\\,cm}$，$\\Sigma_s = \\mathrm{0.45\\,cm^{-1}}$，$\\Sigma_{a,0} = \\mathrm{0.005\\,cm^{-1}}$，$k_E = \\mathrm{0.020\\,cm^{-1}\\,eV^{1/2}}$，$C_g = 0.75$。\n- 案例2（稀疏栅格，低光学厚度）：$D_{\\mathrm{eff}} = \\mathrm{0.20\\,cm}$，$\\Sigma_s = \\mathrm{0.20\\,cm^{-1}}$，$\\Sigma_{a,0} = \\mathrm{0.002\\,cm^{-1}}$，$k_E = \\mathrm{0.005\\,cm^{-1}\\,eV^{1/2}}$，$C_g = 0.70$。\n- 案例3（紧密栅格，高光学厚度）：$D_{\\mathrm{eff}} = \\mathrm{0.30\\,cm}$，$\\Sigma_s = \\mathrm{0.80\\,cm^{-1}}$，$\\Sigma_{a,0 = \\mathrm{0.010\\,cm^{-1}}$，$k_E = \\mathrm{0.050\\,cm^{-1}\\,eV^{1/2}}$，$C_g = 0.80$。\n\n程序要求和最终输出格式：\n\n- 为这三个案例实现上述计算。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按顺序包含案例1的两个指标，然后是案例2的两个指标，最后是案例3的两个指标，即\n  $$\n  [\\max\\text{-}\\mathrm{dev}_1, \\mathrm{RelRMS}_1, \\max\\text{-}\\mathrm{dev}_2, \\mathrm{RelRMS}_2, \\max\\text{-}\\mathrm{dev}_3, \\mathrm{RelRMS}_3].\n  $$\n- 所有报告的量均为无量纲十进制数（输出中不含物理单位）。",
            "solution": "该问题要求量化在核反应堆栅格的共振自屏效应背景下，使用通量加权常数$C_{\\mathrm{uni}}$近似能量依赖的丹可夫因子$C(E)$所产生的误差。解决方案涉及推导一个基于物理的$C(E)$模型，对一组测试案例进行数值实现，并计算指定的误差指标。\n\n逻辑步骤如下：\n1.  推导能量依赖的丹可夫因子$C(E)$的函数形式。\n2.  离散化能量域并定义计算网格。\n3.  对于每个测试案例，在离散能量网格上计算$C(E_g)$的值。\n4.  将常数近似值$C_{\\mathrm{uni}}$计算为$C(E_g)$的通量加权平均值。\n5.  计算所需的误差指标：最大绝对偏差和通量加权的相对均方根误差。\n\n**1. 能量依赖的丹可夫因子$C(E)$的推导**\n\n丹可夫因子$C(E)$表示一个从中子燃料块表面出来的中子，穿过周围的慢化剂并进入另一个燃料块而不发生碰撞的概率。这个概率可以通过考虑两个独立事件来建模：几何穿越和无碰撞飞行。\n\n-   **几何概率**：离开一个燃料块的中子必须处于能够截获另一个燃料块的轨道上。此事件的概率纯粹是栅格几何的函数。在非衰减（真空）慢化剂的极限情况下，此概率即为几何耦合因子$C_g$。这是$C(E)$可能的最大值。\n\n-   **无碰撞飞行概率**：穿过慢化剂的中子会发生碰撞。中子在宏观总截面为$\\Sigma_t$的均匀材料中行进距离$d$而不发生碰撞的概率由指数衰减定律给出，$P_{\\text{no-collision}} = \\exp(-\\Sigma_t d)$。对于当前问题，该材料是慢化剂，其截面是能量依赖的$\\Sigma_{t,m}(E)$，燃料块之间的特征路径长度为$D_{\\mathrm{eff}}$。因此，在此特征距离上无碰撞飞行的概率是$\\exp(-\\Sigma_{t,m}(E) D_{\\mathrm{eff}})$。\n\n结合这两个概念，我们可以将能量依赖的丹可夫因子表示为几何概率和无碰撞飞行概率的乘积。这得出了以下基于物理的模型：\n$$\nC(E) = C_g \\exp(-\\Sigma_{t,m}(E) D_{\\mathrm{eff}})\n$$\n该模型正确地满足了边界条件，即当慢化剂的光学厚度趋近于零时（即$\\Sigma_{t,m}(E) \\to 0$），丹可夫因子趋近于几何极限$C(E) \\to C_g$。能量依赖性是通过慢化剂的宏观总截面引入的，其表达式为：\n$$\n\\Sigma_{t,m}(E) = \\Sigma_s + \\Sigma_{a,0} + \\frac{k_E}{\\sqrt{E}}\n$$\n其中$\\Sigma_s$、$\\Sigma_{a,0}$和$k_E$是特定于材料的常数。\n\n**2. 计算网格和权重**\n\n分析是在$N=12$个离散能量点$E_g$上进行的，这些点在$E_{\\min} = 1\\,\\mathrm{eV}$和$E_{\\max} = 10^4\\,\\mathrm{eV}$之间呈对数等距分布。第$g$个点的能量由下式给出：\n$$\nE_g = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{g-1}{N-1}} \\quad \\text{对于 } g = 1, 2, \\ldots, N\n$$\n问题指定了$1/E$的超热通量形状，因此每个能量点$E_g$的通量-慢化能权重为：\n$$\nw_g = \\frac{1}{E_g}\n$$\n这些权重用于计算平均丹可夫因子和相对均方根误差。\n\n**3. 统一常数近似值$C_{\\mathrm{uni}}$**\n\n统一常数$C_{\\mathrm{uni}}$被定义为能量依赖函数$C(E_g)$在离散能量网格上的通量加权平均值。其公式为：\n$$\nC_{\\mathrm{uni}} = \\frac{\\sum_{g=1}^{N} w_g \\, C(E_g)}{\\sum_{g=1}^{N} w_g}\n$$\n此值代表了在$1/E$通量分布下，对$C(E)$的加权最小二乘意义上的最佳常数近似。\n\n**4. 误差指标**\n\n计算两个指标来量化$C_{\\mathrm{uni}}$与$C(E_g)$的偏差：\n\n-   **最大绝对偏差**：该指标捕捉了在整个能量范围内的最坏情况下的点误差。\n    $$\n    \\max_g \\lvert C_{\\mathrm{uni}} - C(E_g) \\rvert\n    $$\n\n-   **通量加权的相对均方根误差(RelRMS)**：该指标提供了一个偏差的积分度量，根据通量谱中每个能量点的重要性进行加权。\n    $$\n    \\mathrm{RelRMS} = \\frac{\\sqrt{\\sum_{g=1}^{N} w_g \\left( C_{\\mathrm{uni}} - C(E_g) \\right)^2}}{\\sqrt{\\sum_{g=1}^{N} w_g \\, C(E_g)^2}}\n    $$\n\n**5. 计算工作流程**\n\n对于所提供的三个测试案例中的每一个，执行以下计算序列：\n1.  指定案例的参数（$D_{\\mathrm{eff}}$、$\\Sigma_s$、$\\Sigma_{a,0}$、$k_E$、$C_g$）。\n2.  建立能量网格$E_g$和权重$w_g$。\n3.  计算慢化剂截面向量$\\Sigma_{t,m}(E_g)$。\n4.  计算丹可夫因子向量$C(E_g) = C_g \\exp(-\\Sigma_{t,m}(E_g) D_{\\mathrm{eff}})$。\n5.  使用其平均公式计算标量值$C_{\\mathrm{uni}}$。\n6.  计算并存储两个误差指标：最大绝对偏差和RelRMS。\n\n此过程被系统地应用于所有指定案例，以生成最终的数值结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes error metrics for approximating an energy-dependent Dancoff factor\n    with a uniform constant for three reactor lattice test cases.\n    \"\"\"\n\n    # Define common simulation parameters\n    E_min = 1.0  # eV\n    E_max = 1.0e4  # eV\n    N = 12  # Number of energy points\n\n    # Generate the logarithmic energy grid\n    # E_g are the center points of the energy groups\n    E_g = np.logspace(np.log10(E_min), np.log10(E_max), N)\n\n    # Define the test cases from the problem statement.\n    # Each case is a dictionary of physical parameters.\n    test_cases = [\n        # Case 1: Baseline Pressurized Water Reactor (PWR)-like lattice\n        {\n            \"D_eff\": 0.20,      # cm\n            \"Sigma_s\": 0.45,    # cm^-1\n            \"Sigma_a0\": 0.005,  # cm^-1\n            \"k_E\": 0.020,       # cm^-1 * eV^0.5\n            \"C_g\": 0.75         # dimensionless\n        },\n        # Case 2: Open lattice, low optical thickness\n        {\n            \"D_eff\": 0.20,\n            \"Sigma_s\": 0.20,\n            \"Sigma_a0\": 0.002,\n            \"k_E\": 0.005,\n            \"C_g\": 0.70\n        },\n        # Case 3: Tight lattice, high optical thickness\n        {\n            \"D_eff\": 0.30,\n            \"Sigma_s\": 0.80,\n            \"Sigma_a0\": 0.010,\n            \"k_E\": 0.050,\n            \"C_g\": 0.80\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        # Extract parameters for the current case\n        D_eff = params[\"D_eff\"]\n        Sigma_s = params[\"Sigma_s\"]\n        Sigma_a0 = params[\"Sigma_a0\"]\n        k_E = params[\"k_E\"]\n        C_g = params[\"C_g\"]\n\n        # Step 1: Calculate the energy-dependent moderator macroscopic total cross section\n        Sigma_tm_E = Sigma_s + Sigma_a0 + k_E / np.sqrt(E_g)\n\n        # Step 2: Calculate the energy-dependent Dancoff factor C(E)\n        # Model: C(E) = C_g * exp(-Sigma_tm(E) * D_eff)\n        C_E = C_g * np.exp(-Sigma_tm_E * D_eff)\n\n        # Step 3: Define the flux-lethargy weights (proportional to 1/E)\n        w_g = 1.0 / E_g\n\n        # Step 4: Calculate the flux-weighted uniform constant C_uni\n        C_uni = np.sum(w_g * C_E) / np.sum(w_g)\n\n        # Step 5: Compute the two required error metrics\n        # Metric 1: Maximum absolute deviation\n        max_dev = np.max(np.abs(C_uni - C_E))\n\n        # Metric 2: Flux-weighted relative root mean square error (RelRMS)\n        numerator_relrms = np.sqrt(np.sum(w_g * (C_uni - C_E)**2))\n        denominator_relrms = np.sqrt(np.sum(w_g * C_E**2))\n\n        # The denominator should not be zero for physically meaningful cross sections\n        if denominator_relrms == 0.0:\n            rel_rms = 0.0\n        else:\n            rel_rms = numerator_relrms / denominator_relrms\n        \n        results.extend([max_dev, rel_rms])\n\n    # Final print statement in the exact required format.\n    # The list contains [max-dev_1, RelRMS_1, max-dev_2, RelRMS_2, max-dev_3, RelRMS_3]\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}