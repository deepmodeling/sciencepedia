{
    "hands_on_practices": [
        {
            "introduction": "群常数凝聚不仅仅是数学上的平均，它必须捕捉关键的物理现象。第一个实践  深入探讨了共振自屏效应，这是一个关键效应，即在特定能量下的强吸收会耗尽局部中子通量。你将应用窄共振近似来量化丹科夫因子（Dancoff factor）——一个模拟燃料棒之間几何屏蔽的模型——如何影响凝聚后的共振积分，从而在反应堆几何构型与有效核数据之间建立起切实的联系。",
            "id": "4229465",
            "problem": "为了研究能量坍缩如何响应丹科夫因子（Dancoff factor）的变化，在窄共振近似下，对一个孤立的s波共振的群压缩建立了一个燃料-慢化剂栅格模型。考虑一种单一的共振吸收剂，它均匀分布在嵌入慢化剂中的圆柱形燃料棒内。该吸收剂在慢化能标中有一个窄的矩形共振，其高度（微观吸收截面）为 $\\,\\sigma_{r}\\,$，慢化能标宽度为 $\\,\\Delta u\\,$。在这种简化表示中，无限稀释共振积分为 $\\,I_{\\infty} = \\sigma_{r}\\,\\Delta u\\,$。在共振区间之外，假设存在一个稳态慢化谱，其通量在慢化能标中与 $\\,1/E\\,$ 成正比，并且存在一个在共振宽度上由恒定微观背景截面 $\\,\\sigma_{b}\\,$ 表示的背景。该背景来自两个贡献：吸收剂的势散射截面 $\\,\\sigma_{p}\\,$ 和与中子从燃料逃逸到慢化剂相关的逃逸贡献 $\\,\\sigma_{e}\\,$。Dancoff因子 $\\,C\\,$ 降低了逃逸造成稀释的有效性，因为从中子从一根燃料棒出来后，可能在未立即经历慢化的情况下进入另一根燃料棒；通过将有效背景截面取为以下形式来对此进行建模：\n$$\n\\sigma_{b}(C) = \\sigma_{p} + (1 - C)\\,\\sigma_{e}.\n$$\n假设以下物理上合理的值：$\\,\\sigma_{r} = 2000\\,\\text{barns}\\,$，$\\,\\Delta u = 0.06\\,$，$\\,\\sigma_{p} = 7\\,\\text{barns}\\,$，以及 $\\,\\sigma_{e} = 50\\,\\text{barns}\\,$。使用窄共振近似和稳态慢化论证，推导出压缩（群平均）共振积分 $\\,I_{\\text{eff}}(C)\\,$ 作为 $\\,C\\,$ 的函数，然后计算变化量\n$$\n\\Delta I = I_{\\text{eff}}(0.6) - I_{\\text{eff}}(0.2).\n$$\n最终答案以靶（barns）为单位表示，并四舍五入到四位有效数字。",
            "solution": "该问题要求计算由于Dancoff因子 $C$ 的变化而导致的有效共振积分的变化量 $\\Delta I$。解答基于非均匀系统的窄共振（NR）近似。\n\n首先，我们建立燃料内中子通量的表达式。在窄共振近似下，假定在共振区内散射的中子被散射到共振宽度之外的能量。因此，进入共振区的中子源由来自更高能量的恒定慢化源决定。在非均匀栅格中，此源来自于燃料棒内的势散射以及从中子从慢化剂进入燃料棒。单位慢化能标通量 $\\phi(u)$ 的平衡方程由源项除以总移出率给出。\n\n每个吸收剂原子的总移出截面为 $\\sigma_t(u) = \\sigma_a(u) + \\sigma_p + \\sigma_e$，其中 $\\sigma_a(u)$ 是在慢化能标 $u$ 处的吸收截面，$\\sigma_p$ 是吸收剂的势散射截面，而 $\\sigma_e$ 是代表向慢化剂泄漏的有效逃逸截面。每个吸收剂原子的源项与背景截面 $\\sigma_b = \\sigma_p + \\sigma_e$ 成正比，再乘以在没有共振时将存在的渐近通量 $\\phi_0$。\n\n因此，燃料内部的通量由于自屏效应而从渐近值 $\\phi_0$ 降低：\n$$\n\\phi(u) = \\frac{\\sigma_p + \\sigma_e}{\\sigma_a(u) + \\sigma_p + \\sigma_e} \\phi_0 = \\frac{\\sigma_b}{\\sigma_a(u) + \\sigma_b} \\phi_0\n$$\n问题指明背景截面 $\\sigma_b$ 依赖于Dancoff因子 $C$，该因子解释了一个中子从一根燃料棒逃逸后，在进入另一根燃料棒之前到达慢化剂的概率降低。给定的关系是：\n$$\n\\sigma_b(C) = \\sigma_p + (1 - C) \\sigma_e\n$$\n有效共振积分 $I_{\\text{eff}}$ 的定义使得共振区内每个吸收剂原子的总吸收率为 $R_a = I_{\\text{eff}} \\phi_0$。用慢化能标表示，其形式为：\n$$\nI_{\\text{eff}} = \\int_{\\text{res}} \\sigma_a(u) \\frac{\\phi(u)}{\\phi_0} du\n$$\n代入通量的表达式，我们得到：\n$$\nI_{\\text{eff}}(C) = \\int_{\\text{res}} \\sigma_a(u) \\frac{\\sigma_b(C)}{\\sigma_a(u) + \\sigma_b(C)} du\n$$\n问题将共振建模为慢化能标中的一个矩形函数。在慢化能标宽度 $\\Delta u$ 内，微观吸收截面为 $\\sigma_a(u) = \\sigma_r$，在其他地方为零。在此区间内，被积函数是常数。因此，积分简化为被积函数与区间宽度的乘积：\n$$\nI_{\\text{eff}}(C) = \\sigma_r \\left( \\frac{\\sigma_b(C)}{\\sigma_r + \\sigma_b(C)} \\right) \\Delta u\n$$\n我们认识到无限稀释共振积分为 $I_{\\infty} = \\sigma_r \\Delta u$。这对应于极端稀释的情况，即 $\\sigma_b \\to \\infty$，此时屏蔽因子趋近于1。因此，我们可以将有效共振积分写为：\n$$\nI_{\\text{eff}}(C) = I_{\\infty} \\left( \\frac{\\sigma_b(C)}{\\sigma_r + \\sigma_b(C)} \\right)\n$$\n代入 $\\sigma_b(C)$ 的表达式，得出 $I_{\\text{eff}}(C)$ 的最终函数形式：\n$$\nI_{\\text{eff}}(C) = I_{\\infty} \\left( \\frac{\\sigma_p + (1 - C) \\sigma_e}{\\sigma_r + \\sigma_p + (1 - C) \\sigma_e} \\right)\n$$\n给定的值为：$\\sigma_r = 2000$，$\\Delta u = 0.06$，$\\sigma_p = 7$，以及 $\\sigma_e = 50$。所有截面单位均为靶（barns）。\n\n首先，我们计算无限稀释共振积分：\n$$\nI_{\\infty} = \\sigma_r \\Delta u = (2000)(0.06) = 120 \\, \\text{barns}\n$$\n接下来，我们为两个指定的Dancoff因子 $C=0.2$ 和 $C=0.6$ 计算背景截面 $\\sigma_b(C)$。\n\n对于 $C = 0.2$：\n$$\n\\sigma_b(0.2) = \\sigma_p + (1 - 0.2) \\sigma_e = 7 + (0.8)(50) = 7 + 40 = 47 \\, \\text{barns}\n$$\n对于 $C = 0.6$：\n$$\n\\sigma_b(0.6) = \\sigma_p + (1 - 0.6) \\sigma_e = 7 + (0.4)(50) = 7 + 20 = 27 \\, \\text{barns}\n$$\n现在，我们可以计算每种情况下的有效共振积分。\n\n对于 $C = 0.2$：\n$$\nI_{\\text{eff}}(0.2) = I_{\\infty} \\left( \\frac{\\sigma_b(0.2)}{\\sigma_r + \\sigma_b(0.2)} \\right) = 120 \\left( \\frac{47}{2000 + 47} \\right) = 120 \\left( \\frac{47}{2047} \\right) \\approx 2.75525 \\, \\text{barns}\n$$\n对于 $C = 0.6$：\n$$\nI_{\\text{eff}}(0.6) = I_{\\infty} \\left( \\frac{\\sigma_b(0.6)}{\\sigma_r + \\sigma_b(0.6)} \\right) = 120 \\left( \\frac{27}{2000 + 27} \\right) = 120 \\left( \\frac{27}{2027} \\right) \\approx 1.59842 \\, \\text{barns}\n$$\n问题要求计算变化量 $\\Delta I = I_{\\text{eff}}(0.6) - I_{\\text{eff}}(0.2)$。\n$$\n\\Delta I = 120 \\left( \\frac{27}{2027} \\right) - 120 \\left( \\frac{47}{2047} \\right) = 1.59842... - 2.75525... = -1.156830... \\, \\text{barns}\n$$\nDancoff因子从0.2增加到0.6意味着燃料棒之间的屏蔽作用更强，这降低了慢化剂稀释共振吸收剂的有效性。这增加了通量凹陷（自屏），从而减小了有效共振积分。因此，$\\Delta I$ 的负号在物理上是一致的。\n\n将结果四舍五入到四位有效数字，我们得到：\n$$\n\\Delta I \\approx -1.157 \\, \\text{barns}\n$$",
            "answer": "$$\\boxed{-1.157}$$"
        },
        {
            "introduction": "在掌握了孤立的物理原理之后，我们现在转向一个全面的实际应用。这个问题  要求你为一个混合氧化物（MOX）燃料组件开发一个完整的多群凝聚程序，这是现代反应堆分析中的一个常见情景。通过实施通量加权方案，并比较基于非均匀与均匀化谱产生的结果，你将直接面对在为反应堆模拟生成精确少群常数时所涉及的实际挑战和敏感性。",
            "id": "4229480",
            "problem": "您的任务是在核反应堆模拟的背景下，推导并实现一个针对混合氧化物 (MOX) 燃料少群常数的能群凝聚程序，比较使用来自非均匀格架与均匀化栅元的中子能谱，并明确处理共振自屏差异。目标是根据提供的细群微观数据、同位素原子数密度和通量谱，计算凝聚后的吸收和中子产额加权裂变的宏观双群常数。计算必须基于第一性原理，在坍缩能群时保持反应率不变，并且必须以厘米的倒数（$\\text{cm}^{-1}$）为单位生成结果，并按指定格式进行四舍五入。\n\n基本和核心定义：\n- 稳态玻尔兹曼输运方程将中子通量与材料性质和源项联系起来。对于具有微观截面的反应，其反应率密度是中子通量与截面乘积对能量的积分。设 $E$ 表示能量，$\\phi(E)$ 表示中子通量，$\\sigma_x(E)$ 表示反应 $x$ 的微观截面，$N$ 表示原子数密度，$\\Sigma_x(E)$ 表示宏观截面。反应率密度为 $R_x = \\int \\phi(E) \\Sigma_x(E) \\,\\mathrm{d}E$，其中 $\\Sigma_x(E) = \\sum_i N_i \\sigma_{x,i}(E)$，求和遍及所有同位素 $i$。在离散能群中，积分被细群上的求和所取代。从细群到少群的能群坍缩必须在每个坍缩后的群内保持相同的反应率密度。在实际的非均匀格架中，未分辨和已分辨的共振吸收（尤其是在 Uranium-238 中）会导致共振能区的通量凹陷和有效微观截面的降低，这由从格点物理（例如，通过 Dancoff 修正模型）获得的自屏因子来表示。这些因子在非均匀格架和均匀化栅元之间有所不同，在凝聚之前必须一致地应用于共振能区中受影响的同位素。\n\n使用的数据：\n- 细群结构：共有 $8$ 个细能群，索引为 $g \\in \\{0,1,2,3,4,5,6,7\\}$，从最高能量（$g=0$）到最低能量（$g=7$）排序。您将凝聚为 $2$ 个群：一个快群，索引为 $g \\in \\{0,1,2,3,4\\}$；一个热群，索引为 $g \\in \\{5,6,7\\}$。\n- MOX 燃料混合物中包含的同位素：Plutonium-239 (Pu-239)、Plutonium-240 (Pu-240)、Plutonium-241 (Pu-241)、Uranium-238 (U-238)。\n- 同位素 $i$ 的原子数密度 $N_i$（单位：原子/立方厘米）：\n  - Pu-239: $1.5\\times 10^{21}$\n  - Pu-240: $0.6\\times 10^{21}$\n  - Pu-241: $0.3\\times 10^{21}$\n  - U-238: $2.0\\times 10^{21}$\n- 每个同位素 $i$ 和细群 $g$ 的微观吸收截面 $\\sigma_{a,i,g}$（单位：靶），按同位素列出，$8$ 个群的值按 $g=0$ 到 $g=7$ 的顺序列出：\n  - Pu-239: $(0.3, 0.5, 1.0, 2.0, 5.0, 200.0, 600.0, 800.0)$\n  - Pu-240: $(0.2, 0.3, 0.5, 0.8, 1.0, 50.0, 80.0, 100.0)$\n  - Pu-241: $(0.4, 0.6, 1.2, 2.5, 5.0, 250.0, 500.0, 700.0)$\n  - U-238: $(0.3, 0.4, 3.0, 5.0, 2.5, 0.6, 0.3, 0.2)$\n- 每个同位素 $i$ 和细群 $g$ 的微观中子产额加权裂变截面 $\\nu\\sigma_{f,i,g}$（单位：靶）：\n  - Pu-239: $(0.2, 0.4, 0.8, 1.2, 2.0, 900.0, 1500.0, 1700.0)$\n  - Pu-240: $(0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 2.0, 3.0)$\n  - Pu-241: $(0.3, 0.5, 1.0, 1.5, 2.5, 1000.0, 1600.0, 1800.0)$\n  - U-238: $(0.1, 0.08, 0.05, 0.02, 0.01, 0.0, 0.0, 0.0)$\n- 自屏处理：仅在构建宏观吸收截面之前，对 Uranium-238 的吸收截面 $\\sigma_{a,\\text{U-238},g}$ 应用自屏因子。对于非共振群，因子设为 $1$。对于共振群，使用每个测试用例中指定的因子。本问题中，$\\nu\\sigma_f$ 不应用自屏。\n\n单位换算：\n- 使用 $1$ 靶 $= 10^{-24}$ $\\text{cm}^2$。在计算宏观截面时，将微观截面乘以相应的原子数密度，并转换为厘米的倒数：$\\Sigma_{x,g} = \\sum_i N_i \\sigma_{x,i,g} \\times 10^{-24}$。\n\n凝聚要求：\n- 从离散群表示中的反应率密度定义出发，到少群的能群坍缩必须在每个凝聚群内保持反应率密度 $R_x$。也就是说，少群中的凝聚宏观截面乘以该少群中的总通量，必须等于构成该少群的细群上的反应率之和。您的程序必须实现这种守恒，以获得每个指定案例的凝聚双群宏观吸收和中子产额加权裂变常数。\n\n测试套件：\n- 案例 1（基准非均匀与均匀能谱，基准自屏）：\n  - 非均匀格架通量 $\\phi^{\\text{het}}_g$（单位：中子/平方厘米·秒）：$(2.0\\times 10^{13}, 1.5\\times 10^{13}, 0.8\\times 10^{13}, 0.6\\times 10^{13}, 0.7\\times 10^{13}, 1.2\\times 10^{13}, 1.8\\times 10^{13}, 2.0\\times 10^{13})$。\n  - 均匀化栅元通量 $\\phi^{\\text{hom}}_g$：$(2.0\\times 10^{13}, 1.6\\times 10^{13}, 1.2\\times 10^{13}, 1.0\\times 10^{13}, 0.9\\times 10^{13}, 1.1\\times 10^{13}, 1.5\\times 10^{13}, 1.7\\times 10^{13})$。\n  - Uranium-238 自屏因子 $S^{\\text{het}}_g$：$(1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0)$。\n  - Uranium-238 自屏因子 $S^{\\text{hom}}_g$：$(1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0)$。\n- 案例 2（非均匀通量在某个共振细群中为零，以测试稳定性；均匀情况不变；基准自屏）：\n  - 非均匀格架通量 $\\phi^{\\text{het}}_g$：$(2.0\\times 10^{13}, 1.5\\times 10^{13}, 0.8\\times 10^{13}, 0.0, 0.7\\times 10^{13}, 1.2\\times 10^{13}, 1.8\\times 10^{13}, 2.0\\times 10^{13})$。\n  - 均匀化栅元通量 $\\phi^{\\text{hom}}_g$：$(2.0\\times 10^{13}, 1.6\\times 10^{13}, 1.2\\times 10^{13}, 1.0\\times 10^{13}, 0.9\\times 10^{13}, 1.1\\times 10^{13}, 1.5\\times 10^{13}, 1.7\\times 10^{13})$。\n  - Uranium-238 自屏因子 $S^{\\text{het}}_g$：$(1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0)$。\n  - Uranium-238 自屏因子 $S^{\\text{hom}}_g$：$(1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0)$。\n- 案例 3（非均匀和均匀描述中均为均匀通量；基准自屏）：\n  - 非均匀格架通量 $\\phi^{\\text{het}}_g$：$(1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13})$。\n  - 均匀化栅元通量 $\\phi^{\\text{hom}}_g$：$(1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13}, 1.0\\times 10^{13})$。\n  - Uranium-238 自屏因子 $S^{\\text{het}}_g$：$(1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0)$。\n  - Uranium-238 自屏因子 $S^{\\text{hom}}_g$：$(1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0)$。\n- 案例 4（共振群中更强的非均匀自屏；均匀情况不变）：\n  - 非均匀格架通量 $\\phi^{\\text{het}}_g$：$(2.0\\times 10^{13}, 1.5\\times 10^{13}, 0.8\\times 10^{13}, 0.6\\times 10^{13}, 0.7\\times 10^{13}, 1.2\\times 10^{13}, 1.8\\times 10^{13}, 2.0\\times 10^{13})$。\n  - 均匀化栅元通量 $\\phi^{\\text{hom}}_g$：$(2.0\\times 10^{13}, 1.6\\times 10^{13}, 1.2\\times 10^{13}, 1.0\\times 10^{13}, 0.9\\times 10^{13}, 1.1\\times 10^{13}, 1.5\\times 10^{13}, 1.7\\times 10^{13})$。\n  - Uranium-238 自屏因子 $S^{\\text{het}}_g$：$(1.0, 0.4, 0.35, 0.3, 0.4, 1.0, 1.0, 1.0)$。\n  - Uranium-238 自屏因子 $S^{\\text{hom}}_g$：$(1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0)$。\n\n计算要求：\n- 对于每个测试案例和每种能谱（非均匀和均匀），计算：\n  - 宏观细群吸收截面 $\\Sigma_{a,g}$，通过对所有同位素求和 $N_i \\sigma_{a,i,g}$，按规定对 $\\sigma_{a,\\text{U-238},g}$ 应用 Uranium-238 自屏因子，并乘以 $10^{-24}$ 从靶转换为 $\\text{cm}^{-1}$。\n  - 宏观细群中子产额加权裂变截面 $\\nu\\Sigma_{f,g}$，通过对所有同位素求和 $N_i \\nu\\sigma_{f,i,g}$（不应用自屏），并乘以 $10^{-24}$ 从靶转换为 $\\text{cm}^{-1}$。\n  - 通过在每个凝聚群内的细群间保持反应率，将结果凝聚为吸收和中子产额加权裂变的双群宏观常数。\n\n输出规格：\n- 所有凝聚的宏观常数均以 $\\text{cm}^{-1}$ 表示。\n- 将每个凝聚常数四舍五入到 $6$ 位小数。\n- 对于每个测试案例，按以下顺序输出一个包含 $8$ 个浮点数的列表：$(\\Sigma_{a,\\text{fast}}^{\\text{het}}, \\Sigma_{a,\\text{thermal}}^{\\text{het}}, \\nu\\Sigma_{f,\\text{fast}}^{\\text{het}}, \\nu\\Sigma_{f,\\text{thermal}}^{\\text{het}}, \\Sigma_{a,\\text{fast}}^{\\text{hom}}, \\Sigma_{a,\\text{thermal}}^{\\text{hom}}, \\nu\\Sigma_{f,\\text{fast}}^{\\text{hom}}, \\nu\\Sigma_{f,\\text{thermal}}^{\\text{hom}})$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试案例，并且本身也是一个用方括号括起来的逗号分隔列表。例如，输出格式必须类似于 $[[r_{1,1},r_{1,2},\\dots,r_{1,8}],[r_{2,1},\\dots,r_{2,8}],\\dots]$。\n\n科学真实性与一致性：\n- 该场景模拟了真实的 MOX 同位素行为，包括 Uranium-238 的共振吸收自屏以及非均匀格架和均匀化栅元之间不同的能谱。该处理方法通过构造保持了反应率，并使用了与核反应堆物理一致的单位。",
            "solution": "## 问题验证 ##\n\n### 步骤 1：提取已知条件 ###\n- **细群结构**：$8$ 个细群（$g \\in \\{0, ..., 7\\}$）。\n- **双群结构**：\n  - 快群：$G_1 = \\{g \\in \\{0, 1, 2, 3, 4\\}\\}$\n  - 热群：$G_2 = \\{g \\in \\{5, 6, 7\\}\\}$\n- **同位素和原子数密度 ($N_i$)**：\n  - Pu-239: $N_{\\text{Pu-239}} = 1.5 \\times 10^{21}$ 原子/cm$^3$\n  - Pu-240: $N_{\\text{Pu-240}} = 0.6 \\times 10^{21}$ 原子/cm$^3$\n  - Pu-241: $N_{\\text{Pu-241}} = 0.3 \\times 10^{21}$ 原子/cm$^3$\n  - U-238: $N_{\\text{U-238}} = 2.0 \\times 10^{21}$ 原子/cm$^3$\n- **微观吸收截面（$\\sigma_{a,i,g}$，单位：靶）**：\n  - Pu-239: $(0.3, 0.5, 1.0, 2.0, 5.0, 200.0, 600.0, 800.0)$\n  - Pu-240: $(0.2, 0.3, 0.5, 0.8, 1.0, 50.0, 80.0, 100.0)$\n  - Pu-241: $(0.4, 0.6, 1.2, 2.5, 5.0, 250.0, 500.0, 700.0)$\n  - U-238: $(0.3, 0.4, 3.0, 5.0, 2.5, 0.6, 0.3, 0.2)$\n- **微观中子产额加权裂变截面（$\\nu\\sigma_{f,i,g}$，单位：靶）**：\n  - Pu-239: $(0.2, 0.4, 0.8, 1.2, 2.0, 900.0, 1500.0, 1700.0)$\n  - Pu-240: $(0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 2.0, 3.0)$\n  - Pu-241: $(0.3, 0.5, 1.0, 1.5, 2.5, 1000.0, 1600.0, 1800.0)$\n  - U-238: $(0.1, 0.08, 0.05, 0.02, 0.01, 0.0, 0.0, 0.0)$\n- **单位换算**：$1$ 靶 $= 10^{-24}$ cm$^2$。\n- **自屏**：仅应用于 U-238 的吸收截面 $\\sigma_{a,\\text{U-238},g}$。\n- **测试套件数据**：为四个不同案例提供了非均匀通量（$\\phi^{\\text{het}}_g$）、均匀通量（$\\phi^{\\text{hom}}_g$）、非均匀 U-238 自屏因子（$S^{\\text{het}}_g$）和均匀 U-238 自屏因子（$S^{\\text{hom}}_g$）的具体值。\n- **输出要求**：对于每个案例，计算并输出一个包含 $8$ 个数字的列表：$(\\Sigma_{a,\\text{fast}}^{\\text{het}}, \\Sigma_{a,\\text{thermal}}^{\\text{het}}, \\nu\\Sigma_{f,\\text{fast}}^{\\text{het}}, \\nu\\Sigma_{f,\\text{thermal}}^{\\text{het}}, \\Sigma_{a,\\text{fast}}^{\\text{hom}}, \\Sigma_{a,\\text{thermal}}^{\\text{hom}}, \\nu\\Sigma_{f,\\text{fast}}^{\\text{hom}}, \\nu\\Sigma_{f,\\text{thermal}}^{\\text{hom}})$，四舍五入到 $6$ 位小数。\n\n### 步骤 2：使用提取的已知条件进行验证 ###\n根据验证标准评估问题陈述：\n- **科学性**：该问题基于中子输运和反应堆物理的基本原理。通过保持反应率来进行群凝聚的程序是核反应堆分析中的标准核心技术。宏观截面、共振吸收的自屏因子以及非均匀与均匀模型之间的区别等概念都得到了良好确立和准确表述。\n- **适定性**：问题定义清晰。它提供了所有必要的输入数据（原子数密度、微观数据、通量谱、自屏因子）和一个明确的目标（计算双群凝聚截面）。计算方法源于第一性原理，能够得出唯一且稳定的解。\n- **客观性**：问题以精确、定量和无偏见的技术语言陈述。\n- **不完整或矛盾的设置**：问题是自洽的。求解所需的所有常数、变量和条件都已明确提供。所提供的数据或要求中没有矛盾之处。\n- **不切实际或不可行**：截面、原子数密度和通量的数值在一个简化的反应堆物理问题中处于合理范围内。物理场景是现实的。\n- **病态或结构不良**：群凝聚公式的推导是明确的。所有术语都有清晰的定义。测试案例 2 中有一个零通量值，这是对算法鲁棒性的有效测试，反应率守恒公式可以自然地处理这种情况（如果细群通量为零，它对分子和分母的总和贡献均为零）。\n- **伪深刻、琐碎或同义反复**：这个问题并非微不足道。它需要正确地分多步应用物理原理：首先，计算包含材料特定效应（自屏）的宏观细群数据；其次，进行通量加权平均以获得凝聚数据。\n\n### 步骤 3：结论与行动 ###\n此问题**有效**。这是一个在计算反应堆物理学中适定且具有科学依据的问题。我现在将继续进行求解。\n\n## 求解推导 ##\n\n能群凝聚的核心原理是保持反应率不变。设 $G$ 表示一个粗能群，它是一组细能群 $\\{g\\}$ 的集合。一个群中某种反应类型 $x$ 的反应率 $R_x$ 是宏观截面 $\\Sigma_x$ 和中子通量 $\\phi$ 的乘积。在离散群结构中，构成 $G$ 的一组细群上的总反应率由以下总和给出：\n$$ R_{x,G}^{\\text{total}} = \\sum_{g \\in G} R_{x,g} = \\sum_{g \\in G} \\Sigma_{x,g} \\phi_g $$\n其中 $\\Sigma_{x,g}$ 是细群 $g$ 中反应 $x$ 的宏观截面，$\\phi_g$ 是细群 $g$ 中的中子通量。\n\n凝聚之后，这个总反应率必须守恒。凝聚后的粗群截面 $\\Sigma_{x,G}$ 的定义是，当它乘以粗群中的总通量 $\\Phi_G$ 时，能得到相同的总反应率：\n$$ R_{x,G}^{\\text{total}} = \\Sigma_{x,G} \\Phi_G $$\n粗群中的总通量 $\\Phi_G$ 是其组成的细群中通量的总和：\n$$ \\Phi_G = \\sum_{g \\in G} \\phi_g $$\n通过令两个总反应率的表达式相等，我们可以解出凝聚截面 $\\Sigma_{x,G}$：\n$$ \\Sigma_{x,G} \\Phi_G = \\sum_{g \\in G} \\Sigma_{x,g} \\phi_g $$\n$$ \\Sigma_{x,G} = \\frac{\\sum_{g \\in G} \\Sigma_{x,g} \\phi_g}{\\sum_{g \\in G} \\phi_g} $$\n这是通量加权群凝聚的基本公式。它将用于计算双群（快群和热群）常数。\n\n每个测试案例的计算步骤如下：\n\n1.  **计算细群宏观截面 ($\\Sigma_{x,g}$)**\n    对于 $8$ 个细群中的每一个，反应类型 $x$（吸收 $a$ 或中子产额加权裂变 $\\nu f$）的宏观截面通过对所有同位素 $i$ 的贡献求和来计算：\n    $$ \\Sigma_{x,g} = \\left( \\sum_i N_i \\sigma_{x,i,g} \\right) \\times C $$\n    其中 $N_i$ 是同位素 $i$ 的原子数密度，$\\sigma_{x,i,g}$ 是其在群 $g$ 中的微观截面，$C = 10^{-24}$ 是从靶到 cm$^2$ 的转换因子。\n\n    对于吸收截面 $\\sigma_{a,g}$，必须应用 Uranium-238 的自屏因子 $S_g$：\n    $$ \\sigma'_{a,\\text{U-238},g} = S_g \\times \\sigma_{a,\\text{U-238},g} $$\n    宏观吸收截面则为：\n    $$ \\Sigma_{a,g} = \\left( N_{\\text{Pu-239}}\\sigma_{a,\\text{Pu-239},g} + N_{\\text{Pu-240}}\\sigma_{a,\\text{Pu-240},g} + N_{\\text{Pu-241}}\\sigma_{a,\\text{Pu-241},g} + N_{\\text{U-238}}\\sigma'_{a,\\text{U-238},g} \\right) \\times 10^{-24} $$\n    对于中子产额加权裂变截面 $\\nu\\Sigma_{f,g}$，不应用自屏：\n    $$ \\nu\\Sigma_{f,g} = \\left( \\sum_i N_i (\\nu\\sigma_{f,i,g}) \\right) \\times 10^{-24} $$\n    此计算将针对非均匀和均匀两种情景进行，使用各自的自屏因子。\n\n2.  **凝聚为双群截面**\n    细群被划分为一个快群 $G_{\\text{fast}} = \\{0, 1, 2, 3, 4\\}$ 和一个热群 $G_{\\text{thermal}} = \\{5, 6, 7\\}$。凝聚公式应用于每个群和每种反应类型，使用适当的通量谱（$\\phi^{\\text{het}}_g$ 或 $\\phi^{\\text{hom}}_g$）。\n\n    - **快群吸收截面 ($\\Sigma_{a,\\text{fast}}$)**：\n      $$ \\Sigma_{a,\\text{fast}} = \\frac{\\sum_{g=0}^{4} \\Sigma_{a,g} \\phi_g}{\\sum_{g=0}^{4} \\phi_g} $$\n    - **热群吸收截面 ($\\Sigma_{a,\\text{thermal}}$)**：\n      $$ \\Sigma_{a,\\text{thermal}} = \\frac{\\sum_{g=5}^{7} \\Sigma_{a,g} \\phi_g}{\\sum_{g=5}^{7} \\phi_g} $$\n    相同的公式也用于中子产额加权裂变截面 $\\nu\\Sigma_{f,\\text{fast}}$ 和 $\\nu\\Sigma_{f,\\text{thermal}}$。\n\n此程序将对所有四个测试案例实施，为每个案例生成一组 $8$ 个凝聚宏观常数。最终值将按规定四舍五入到 $6$ 位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an energy group condensation procedure for MOX fuel few-group constants.\n    \"\"\"\n\n    # --- Data Definition ---\n    \n    # 1 barn = 10^-24 cm^2\n    BARN_TO_CM2 = 1e-24\n\n    # Isotopes and atomic number densities (atoms/cm^3)\n    N = {\n        \"Pu239\": 1.5e21,\n        \"Pu240\": 0.6e21,\n        \"Pu241\": 0.3e21,\n        \"U238\": 2.0e21,\n    }\n    \n    isotopes = list(N.keys())\n\n    # Microscopic absorption cross sections sigma_a (barns) for 8 fine groups\n    sigma_a = {\n        \"Pu239\": np.array([0.3, 0.5, 1.0, 2.0, 5.0, 200.0, 600.0, 800.0]),\n        \"Pu240\": np.array([0.2, 0.3, 0.5, 0.8, 1.0, 50.0, 80.0, 100.0]),\n        \"Pu241\": np.array([0.4, 0.6, 1.2, 2.5, 5.0, 250.0, 500.0, 700.0]),\n        \"U238\":  np.array([0.3, 0.4, 3.0, 5.0, 2.5, 0.6, 0.3, 0.2]),\n    }\n\n    # Microscopic nu-fission cross sections nu*sigma_f (barns) for 8 fine groups\n    nu_sigma_f = {\n        \"Pu239\": np.array([0.2, 0.4, 0.8, 1.2, 2.0, 900.0, 1500.0, 1700.0]),\n        \"Pu240\": np.array([0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 2.0, 3.0]),\n        \"Pu241\": np.array([0.3, 0.5, 1.0, 1.5, 2.5, 1000.0, 1600.0, 1800.0]),\n        \"U238\":  np.array([0.1, 0.08, 0.05, 0.02, 0.01, 0.0, 0.0, 0.0]),\n    }\n\n    # Test cases from the problem statement\n    test_cases = [\n        # Case 1\n        {\n            \"phi_het\": np.array([2.0e13, 1.5e13, 0.8e13, 0.6e13, 0.7e13, 1.2e13, 1.8e13, 2.0e13]),\n            \"phi_hom\": np.array([2.0e13, 1.6e13, 1.2e13, 1.0e13, 0.9e13, 1.1e13, 1.5e13, 1.7e13]),\n            \"S_het\": np.array([1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0]),\n            \"S_hom\": np.array([1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0]),\n        },\n        # Case 2\n        {\n            \"phi_het\": np.array([2.0e13, 1.5e13, 0.8e13, 0.0, 0.7e13, 1.2e13, 1.8e13, 2.0e13]),\n            \"phi_hom\": np.array([2.0e13, 1.6e13, 1.2e13, 1.0e13, 0.9e13, 1.1e13, 1.5e13, 1.7e13]),\n            \"S_het\": np.array([1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0]),\n            \"S_hom\": np.array([1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0]),\n        },\n        # Case 3\n        {\n            \"phi_het\": np.array([1.0e13] * 8),\n            \"phi_hom\": np.array([1.0e13] * 8),\n            \"S_het\": np.array([1.0, 0.6, 0.55, 0.5, 0.6, 1.0, 1.0, 1.0]),\n            \"S_hom\": np.array([1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0]),\n        },\n        # Case 4\n        {\n            \"phi_het\": np.array([2.0e13, 1.5e13, 0.8e13, 0.6e13, 0.7e13, 1.2e13, 1.8e13, 2.0e13]),\n            \"phi_hom\": np.array([2.0e13, 1.6e13, 1.2e13, 1.0e13, 0.9e13, 1.1e13, 1.5e13, 1.7e13]),\n            \"S_het\": np.array([1.0, 0.4, 0.35, 0.3, 0.4, 1.0, 1.0, 1.0]),\n            \"S_hom\": np.array([1.0, 0.85, 0.8, 0.75, 0.85, 1.0, 1.0, 1.0]),\n        },\n    ]\n\n    all_results = []\n\n    def calculate_condensed_xs(flux_spectrum, u238_shielding_factors):\n        # Calculate fine-group macroscopic cross sections (Sigma)\n        Sigma_a_fine = np.zeros(8)\n        nu_Sigma_f_fine = np.zeros(8)\n\n        for iso in isotopes:\n            # Apply self-shielding only to U-238 absorption\n            if iso == \"U238\":\n                shielded_sigma_a = sigma_a[iso] * u238_shielding_factors\n                Sigma_a_fine += N[iso] * shielded_sigma_a * BARN_TO_CM2\n            else:\n                Sigma_a_fine += N[iso] * sigma_a[iso] * BARN_TO_CM2\n            \n            # No self-shielding for nu*sigma_f\n            nu_Sigma_f_fine += N[iso] * nu_sigma_f[iso] * BARN_TO_CM2\n\n        # Define group boundaries\n        fast_group_indices = slice(0, 5) # Groups 0, 1, 2, 3, 4\n        thermal_group_indices = slice(5, 8) # Groups 5, 6, 7\n\n        # --- Condensation Calculation ---\n        # Numerators are sum(Sigma_g * phi_g) over groups\n        rate_a_fast = np.sum(Sigma_a_fine[fast_group_indices] * flux_spectrum[fast_group_indices])\n        rate_a_thermal = np.sum(Sigma_a_fine[thermal_group_indices] * flux_spectrum[thermal_group_indices])\n        \n        rate_f_fast = np.sum(nu_Sigma_f_fine[fast_group_indices] * flux_spectrum[fast_group_indices])\n        rate_f_thermal = np.sum(nu_Sigma_f_fine[thermal_group_indices] * flux_spectrum[thermal_group_indices])\n\n        # Denominators are sum(phi_g) over groups\n        total_flux_fast = np.sum(flux_spectrum[fast_group_indices])\n        total_flux_thermal = np.sum(flux_spectrum[thermal_group_indices])\n\n        # Condensed cross section = Rate / Total Flux\n        # Handle case where total group flux is 0 to avoid division by zero\n        Sigma_a_fast = rate_a_fast / total_flux_fast if total_flux_fast > 0 else 0.0\n        Sigma_a_thermal = rate_a_thermal / total_flux_thermal if total_flux_thermal > 0 else 0.0\n        \n        nu_Sigma_f_fast = rate_f_fast / total_flux_fast if total_flux_fast > 0 else 0.0\n        nu_Sigma_f_thermal = rate_f_thermal / total_flux_thermal if total_flux_thermal > 0 else 0.0\n        \n        return [Sigma_a_fast, Sigma_a_thermal, nu_Sigma_f_fast, nu_Sigma_f_thermal]\n\n    for case in test_cases:\n        # Calculate for heterogeneous model\n        results_het = calculate_condensed_xs(case[\"phi_het\"], case[\"S_het\"])\n        \n        # Calculate for homogeneous model\n        results_hom = calculate_condensed_xs(case[\"phi_hom\"], case[\"S_hom\"])\n        \n        # Combine results and round\n        case_result = results_het + results_hom\n        rounded_result = [round(val, 6) for val in case_result]\n        all_results.append(rounded_result)\n\n    # Format the final output string as specified\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, res))}]\" for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "我们的最后一个实践解决了反应堆分析中的一个关键问题：我们如何确保简化的少群模型能准确再现高保真参考解的行为？这个练习  介绍了超均匀化（Superhomogenization, SPH）因子的概念，这是一种强制实现反应率等效的强大方法。你不仅将为一个二群系统计算这些因子，还将分析它们对初始核数据的敏感性，从而揭示凝聚、修正与模拟整体准确性之间的相互作用。",
            "id": "4229473",
            "problem": "要求您设计并实现一个完整且可运行的程序，用于计算在固定外源下双能群无限介质栅格的超均匀化（SPH）因子，并评估这些SPH因子对初始压缩核常数的灵敏度。其背景是核反应堆模拟，特别是群压缩和能量并群策略，并且该任务必须从多群系统中子平衡的基本原理出发进行求解。\n\n物理基础是在固定外源下，无空间泄漏的无限介质中的稳态多群中子平衡。对于双能群，用 $g \\in \\{1,2\\}$ 表示群指数。设宏观吸收截面为 $\\Sigma_{a,1}$ 和 $\\Sigma_{a,2}$，宏观散射截面为 $\\Sigma_{s,1\\to 2}$ 和 $\\Sigma_{s,2\\to 1}$。定义移出截面为 $\\Sigma_{r,1} = \\Sigma_{a,1} + \\Sigma_{s,1\\to 2}$ 和 $\\Sigma_{r,2} = \\Sigma_{a,2} + \\Sigma_{s,2\\to 1}$。设群1和群2中的固定外源分别为 $S_1$ 和 $S_2$。用 $\\phi_1$ 和 $\\phi_2$ 表示未知的群通量。\n\n您的程序必须：\n- 求解满足无限介质、固定源稳态平衡的通量矢量 $(\\phi_1,\\phi_2)$，该平衡用移出和散射耦合项表示。\n- 计算粗网吸收反应率 $A_1 = \\Sigma_{a,1}\\,\\phi_1$ 和 $A_2 = \\Sigma_{a,2}\\,\\phi_2$，其单位为中子/立方厘米·秒（$\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$）。\n- 给定目标吸收反应率 $A_1^{\\text{tar}}$ 和 $A_2^{\\text{tar}}$（代表详细的栅格计算结果），计算无量纲的超均匀化（SPH）因子 $f_1$ 和 $f_2$。这些因子以乘法方式应用于各群的粗网吸收反应率时，可以得到目标反应率。SPH因子是无量纲的。\n- 通过对固定源平衡方程求导，并将影响通过保持反应率的SPH因子定义进行传播，评估每个SPH因子相对于初始压缩常数 $\\Sigma_{a,1}$、$\\Sigma_{a,2}$、$\\Sigma_{s,1\\to 2}$ 和 $\\Sigma_{s,2\\to 1}$ 的一阶灵敏度。对于每个SPH因子，报告其相对于四个截面参数的四个偏导数，以及这四个导数中的最大绝对灵敏度。\n\n所有量都必须按单位体积处理；设体积 $V$ 为 $1$ $\\text{cm}^3$。截面的单位为逆厘米（$\\text{cm}^{-1}$），源的单位为 $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$，通量的单位为 $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}$，反应率的单位为 $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$。SPH因子及其灵敏度分别为无量纲和 $\\text{cm}$（对于灵敏度关于截面的导数）。\n\n使用以下参数集测试套件，每个参数集由 $(\\Sigma_{a,1}, \\Sigma_{a,2}, \\Sigma_{s,1\\to 2}, \\Sigma_{s,2\\to 1}, S_1, S_2, A_1^{\\text{tar}}, A_2^{\\text{tar}})$ 表示：\n\n- 案例1（中等耦合，正常情况）：\n  - $\\Sigma_{a,1} = 0.08$ $\\text{cm}^{-1}$, $\\Sigma_{a,2} = 0.12$ $\\text{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.25$ $\\text{cm}^{-1}$, $\\Sigma_{s,2\\to 1} = 0.20$ $\\text{cm}^{-1}$,\n  - $S_1 = 1.0 \\times 10^5$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $S_2 = 0.7 \\times 10^5$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$,\n  - $A_1^{\\text{tar}} = 9.0 \\times 10^3$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $A_2^{\\text{tar}} = 6.0 \\times 10^3$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$。\n\n- 案例2（近解耦边界情况）：\n  - $\\Sigma_{a,1} = 0.05$ $\\text{cm}^{-1}$, $\\Sigma_{a,2} = 0.10$ $\\text{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 1.0 \\times 10^{-3}$ $\\text{cm}^{-1}$, $\\Sigma_{s,2\\to 1} = 2.0 \\times 10^{-3}$ $\\text{cm}^{-1}$,\n  - $S_1 = 2.0 \\times 10^4$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $S_2 = 1.0 \\times 10^4$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$,\n  - $A_1^{\\text{tar}} = 1.5 \\times 10^3$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $A_2^{\\text{tar}} = 2.0 \\times 10^3$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$。\n\n- 案例3（强上散射极端情况）：\n  - $\\Sigma_{a,1} = 0.06$ $\\text{cm}^{-1}$, $\\Sigma_{a,2} = 0.08$ $\\text{cm}^{-1}$, $\\Sigma_{s,1\\to 2} = 0.05$ $\\text{cm}^{-1}$, $\\Sigma_{s,2\\to 1} = 0.30$ $\\text{cm}^{-1}$,\n  - $S_1 = 5.0 \\times 10^4$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $S_2 = 5.0 \\times 10^4$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$,\n  - $A_1^{\\text{tar}} = 1.0 \\times 10^4$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $A_2^{\\text{tar}} = 8.0 \\times 10^3$ $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$。\n\n算法要求：\n- 使用上面定义的移出项和散射项，构建并求解从固定源无限介质中子平衡导出的关于 $(\\phi_1,\\phi_2)$ 的 $2\\times 2$ 线性系统。\n- 根据与目标值保持反应率一致的定义，计算 $f_1$ 和 $f_2$。\n- 通过固定源平衡方程的线性化，并通过保持反应率的SPH因子定义进行传播，推导并计算 $f_1$ 和 $f_2$ 相对于 $\\Sigma_{a,1}$、$\\Sigma_{a,2}$、$\\Sigma_{s,1\\to 2}$ 和 $\\Sigma_{s,2\\to 1}$ 的一阶灵敏度。\n- 对于每个案例，返回包含 $12$ 个浮点数的列表 $[f_1, f_2, \\partial f_1/\\partial \\Sigma_{a,1}, \\partial f_1/\\partial \\Sigma_{a,2}, \\partial f_1/\\partial \\Sigma_{s,1\\to 2}, \\partial f_1/\\partial \\Sigma_{s,2\\to 1}, \\partial f_2/\\partial \\Sigma_{a,1}, \\partial f_2/\\partial \\Sigma_{a,2}, \\partial f_2/\\partial \\Sigma_{s,1\\to 2}, \\partial f_2/\\partial \\Sigma_{s,2\\to 1}, \\max(|\\partial f_1/\\partial \\Sigma_{a,1}|, |\\partial f_1/\\partial \\Sigma_{a,2}|, |\\partial f_1/\\partial \\Sigma_{s,1\\to 2}|, |\\partial f_1/\\partial \\Sigma_{s,2\\to 1}|), \\max(|\\partial f_2/\\partial \\Sigma_{a,1}|, |\\partial f_2/\\partial \\Sigma_{a,2}|, |\\partial f_2/\\partial \\Sigma_{s,1\\to 2}|, |\\partial f_2/\\partial \\Sigma_{s,2\\to 1}|)]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由三个特定案例列表组成的逗号分隔列表，并用方括号括起来，不含空格。例如，输出必须类似于 $[[x_{1,1},x_{1,2},\\dots,x_{1,12}],[x_{2,1},\\dots,x_{2,12}],[x_{3,1},\\dots,x_{3,12}]]$, 其中每个 $x_{i,j}$ 是一个浮点数。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于中子输运理论的基本原理，特别是无限介质的多群扩散近似。该问题是适定的，提供了所有必要的数据和定义来构建一个可解的线性方程组。所提供的物理参数是现实的，目标以客观、正式的语言清晰陈述。没有矛盾、歧义或不合理的假设。\n\n解决方案分三个阶段展开：首先，求解中子通量；其次，确定超均匀化（SPH）因子；第三，推导这些因子相对于核截面的解析灵敏度。\n\n在没有泄漏的无限介质中的稳态中子平衡遵循以下原理：对于每个能量群 $g$，中子移出的速率等于中子产生的速率。对于一个双能群系统（$g=1$ 为快群，$g=2$ 为热群），此平衡表示为：\n- 群1的损失 = 群1的产生\n$$ (\\Sigma_{a,1} + \\Sigma_{s,1\\to 2})\\phi_1 = \\Sigma_{s,2\\to 1}\\phi_2 + S_1 $$\n- 群2的损失 = 群2的产生\n$$ (\\Sigma_{a,2} + \\Sigma_{s,2\\to 1})\\phi_2 = \\Sigma_{s,1\\to 2}\\phi_1 + S_2 $$\n使用给定的移出截面定义 $\\Sigma_{r,1} = \\Sigma_{a,1} + \\Sigma_{s,1\\to 2}$ 和 $\\Sigma_{r,2} = \\Sigma_{a,2} + \\Sigma_{s,2\\to 1}$，我们可以将该系统写成矩阵形式 $M\\vec{\\phi} = \\vec{S}$：\n$$\n\\begin{pmatrix}\n\\Sigma_{r,1}  -\\Sigma_{s,2\\to 1} \\\\\n-\\Sigma_{s,1\\to 2}  \\Sigma_{r,2}\n\\end{pmatrix}\n\\begin{pmatrix}\n\\phi_1 \\\\\n\\phi_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nS_1 \\\\\nS_2\n\\end{pmatrix}\n$$\n通量矢量 $\\vec{\\phi}$ 的解通过对矩阵 $M$ 求逆得到：$\\vec{\\phi} = M^{-1}\\vec{S}$。$M$ 的行列式为 $D = \\Sigma_{r,1}\\Sigma_{r,2} - \\Sigma_{s,1\\to 2}\\Sigma_{s,2\\to 1}$。由于所有截面都是非负的，且吸收截面 $\\Sigma_{a,g}$ 是正的，因此 $D = \\Sigma_{a,1}\\Sigma_{a,2} + \\Sigma_{a,1}\\Sigma_{s,2\\to 1} + \\Sigma_{a,2}\\Sigma_{s,1\\to 2} > 0$，确保了唯一解的存在。逆矩阵为：\n$$\nM^{-1} = \\frac{1}{D}\n\\begin{pmatrix}\n\\Sigma_{r,2}  \\Sigma_{s,2\\to 1} \\\\\n\\Sigma_{s,1\\to 2}  \\Sigma_{r,1}\n\\end{pmatrix}\n$$\n因此，群通量的解析解为：\n$$ \\phi_1 = \\frac{1}{D} (\\Sigma_{r,2} S_1 + \\Sigma_{s,2\\to 1} S_2) $$\n$$ \\phi_2 = \\frac{1}{D} (\\Sigma_{s,1\\to 2} S_1 + \\Sigma_{r,1} S_2) $$\n\n超均匀化（SPH）因子 $f_1$ 和 $f_2$ 是无量纲的校正因子，它们使计算出的粗网吸收反应率 $A_g = \\Sigma_{a,g} \\phi_g$ 与给定的目标反应率 $A_g^{\\text{tar}}$ 相等。因此，它们的定义是：\n$$ f_g A_g = A_g^{\\text{tar}} \\implies f_g = \\frac{A_g^{\\text{tar}}}{A_g} = \\frac{A_g^{\\text{tar}}}{\\Sigma_{a,g} \\phi_g} \\quad \\text{for } g \\in \\{1,2\\} $$\n\n为了评估SPH因子相对于四个截面参数 $p \\in \\{\\Sigma_{a,1}, \\Sigma_{a,2}, \\Sigma_{s,1\\to 2}, \\Sigma_{s,2\\to 1}\\}$ 的一阶灵敏度，我们使用商法则和链式法则对 $f_g$ 的表达式进行微分。对于一个通用参数 $p$：\n$$ \\frac{\\partial f_g}{\\partial p} = \\frac{\\partial}{\\partial p} \\left( \\frac{A_g^{\\text{tar}}}{\\Sigma_{a,g} \\phi_g} \\right) = - \\frac{A_g^{\\text{tar}}}{(\\Sigma_{a,g} \\phi_g)^2} \\frac{\\partial}{\\partial p}(\\Sigma_{a,g} \\phi_g) = - \\frac{f_g}{\\Sigma_{a,g}\\phi_g} \\left( \\frac{\\partial \\Sigma_{a,g}}{\\partial p}\\phi_g + \\Sigma_{a,g} \\frac{\\partial \\phi_g}{\\partial p} \\right) $$\n$$ \\frac{\\partial f_g}{\\partial p} = -f_g \\left( \\frac{1}{\\Sigma_{a,g}}\\frac{\\partial \\Sigma_{a,g}}{\\partial p} + \\frac{1}{\\phi_g}\\frac{\\partial \\phi_g}{\\partial p} \\right) $$\n项 $\\frac{\\partial \\Sigma_{a,g}}{\\partial p}$ 是一个克罗内克δ函数，如果 $p=\\Sigma_{a,g}$ 则等于1，否则等于0。核心任务是找到通量灵敏度 $\\frac{\\partial \\phi_g}{\\partial p}$。这些可以通过对矩阵方程 $M\\vec{\\phi} = \\vec{S}$ 微分得到：\n$$ \\frac{\\partial M}{\\partial p}\\vec{\\phi} + M\\frac{\\partial \\vec{\\phi}}{\\partial p} = \\frac{\\partial \\vec{S}}{\\partial p} = \\vec{0} $$\n这得到了通量矢量的灵敏度方程：\n$$ \\frac{\\partial \\vec{\\phi}}{\\partial p} = -M^{-1} \\frac{\\partial M}{\\partial p} \\vec{\\phi} $$\n我们对每个参数推导 $\\frac{\\partial M}{\\partial p}$：\n- $p = \\Sigma_{a,1}: \\frac{\\partial M}{\\partial \\Sigma_{a,1}} = \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix}$\n- $p = \\Sigma_{a,2}: \\frac{\\partial M}{\\partial \\Sigma_{a,2}} = \\begin{pmatrix} 0  0 \\\\ 0  1 \\end{pmatrix}$\n- $p = \\Sigma_{s,1\\to 2}: \\frac{\\partial M}{\\partial \\Sigma_{s,1\\to 2}} = \\begin{pmatrix} 1  0 \\\\ -1  0 \\end{pmatrix}$\n- $p = \\Sigma_{s,2\\to 1}: \\frac{\\partial M}{\\partial \\Sigma_{s,2\\to 1}} = \\begin{pmatrix} 0  -1 \\\\ 0  1 \\end{pmatrix}$\n\n通过求解每个参数的灵敏度方程，我们得到通量导数，然后将其代入SPH灵敏度公式。所需的八个偏导数的最终解析表达式为：\n\n1.  相对于 $\\Sigma_{a,1}$ 的导数：\n    $$ \\frac{\\partial f_1}{\\partial \\Sigma_{a,1}} = -f_1 \\left( \\frac{1}{\\Sigma_{a,1}} - \\frac{\\Sigma_{r,2}}{D} \\right) $$\n    $$ \\frac{\\partial f_2}{\\partial \\Sigma_{a,1}} = f_2 \\frac{\\Sigma_{s,1\\to 2}\\phi_1}{D\\phi_2} $$\n2.  相对于 $\\Sigma_{a,2}$ 的导数：\n    $$ \\frac{\\partial f_1}{\\partial \\Sigma_{a,2}} = f_1 \\frac{\\Sigma_{s,2\\to 1}\\phi_2}{D\\phi_1} $$\n    $$ \\frac{\\partial f_2}{\\partial \\Sigma_{a,2}} = -f_2 \\left( \\frac{1}{\\Sigma_{a,2}} - \\frac{\\Sigma_{r,1}}{D} \\right) $$\n3.  相对于 $\\Sigma_{s,1\\to 2}$ 的导数：\n    $$ \\frac{\\partial f_1}{\\partial \\Sigma_{s,1\\to 2}} = f_1 \\frac{\\Sigma_{a,2}}{D} $$\n    $$ \\frac{\\partial f_2}{\\partial \\Sigma_{s,1\\to 2}} = -f_2 \\frac{\\Sigma_{a,1}\\phi_1}{D\\phi_2} $$\n4.  相对于 $\\Sigma_{s,2\\to 1}$ 的导数：\n    $$ \\frac{\\partial f_1}{\\partial \\Sigma_{s,2\\to 1}} = -f_1 \\frac{\\Sigma_{a,2}\\phi_2}{D\\phi_1} $$\n    $$ \\frac{\\partial f_2}{\\partial \\Sigma_{s,2\\to 1}} = f_2 \\frac{\\Sigma_{a,1}}{D} $$\n\n计算算法的步骤是：首先计算通量 $\\phi_1, \\phi_2$，然后计算SPH因子 $f_1, f_2$，最后利用这些中间结果来评估八个解析灵敏度导数。然后确定每个SPH因子的四个灵敏度中的最大绝对值。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes SPH factors and their sensitivities for a two-group infinite medium problem.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (moderate coupling, happy path)\n        (0.08, 0.12, 0.25, 0.20, 1.0e5, 0.7e5, 9.0e3, 6.0e3),\n        # Case 2 (near-decoupled boundary case)\n        (0.05, 0.10, 1.0e-3, 2.0e-3, 2.0e4, 1.0e4, 1.5e3, 2.0e3),\n        # Case 3 (strong upscatter edge case)\n        (0.06, 0.08, 0.05, 0.30, 5.0e4, 5.0e4, 1.0e4, 8.0e3),\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        Sig_a1, Sig_a2, Sig_s12, Sig_s21, S1, S2, A1_tar, A2_tar = case\n\n        # Step 1: Calculate removal cross sections\n        Sig_r1 = Sig_a1 + Sig_s12\n        Sig_r2 = Sig_a2 + Sig_s21\n\n        # Step 2: Solve for group fluxes (phi_1, phi_2)\n        # The system is M * phi = S, where\n        # M = [[Sig_r1, -Sig_s21], [-Sig_s12, Sig_r2]]\n        # S = [S1, S2]\n        # We solve phi = M_inv * S\n        \n        # Determinant of matrix M\n        D = Sig_r1 * Sig_r2 - Sig_s12 * Sig_s21\n        \n        #\n        # A quick check showed that D can be simplified to:\n        # D = Sig_a1*Sig_a2 + Sig_a1*Sig_s21 + Sig_a2*Sig_s12\n        # This form is more stable against catastrophic cancellation if s_12*s_21 is close to r_1*r_2\n        # For this problem, either is fine. We stick to the direct formula.\n        \n        if D == 0:\n            # This case shouldn't happen with the given physics\n            # but is good practice to handle.\n            raise ValueError(\"System matrix is singular.\")\n\n        # Fluxes from analytical solution\n        phi1 = (Sig_r2 * S1 + Sig_s21 * S2) / D\n        phi2 = (Sig_s12 * S1 + Sig_r1 * S2) / D\n\n        # Step 3: Compute SPH factors (f_1, f_2)\n        # SPH factors are defined by f_g * A_g = A_g_tar\n        # where A_g = Sig_a_g * phi_g\n        A1 = Sig_a1 * phi1\n        A2 = Sig_a2 * phi2\n\n        f1 = A1_tar / A1 if A1 != 0 else float('inf')\n        f2 = A2_tar / A2 if A2 != 0 else float('inf')\n\n        # Step 4: Compute sensitivities of SPH factors\n        # The analytical formulas derived from first principles are used.\n\n        # Derivatives w.r.t. Sigma_a,1\n        df1_dSa1 = -f1 * (1/Sig_a1 - Sig_r2/D)\n        df2_dSa1 = f2 * (Sig_s12 * phi1) / (D * phi2)\n\n        # Derivatives w.r.t. Sigma_a,2\n        df1_dSa2 = f1 * (Sig_s21 * phi2) / (D * phi1)\n        df2_dSa2 = -f2 * (1/Sig_a2 - Sig_r1/D)\n\n        # Derivatives w.r.t. Sigma_s,1->2\n        df1_ds12 = f1 * Sig_a2 / D\n        df2_ds12 = -f2 * (Sig_a1 * phi1) / (D * phi2)\n        \n        # Derivatives w.r.t. Sigma_s,2->1\n        df1_ds21 = -f1 * (Sig_a2 * phi2) / (D * phi1)\n        df2_ds21 = f2 * Sig_a1 / D\n\n        # Step 5: Calculate maximum absolute sensitivities\n        sens1_list = [df1_dSa1, df1_dSa2, df1_ds12, df1_ds21]\n        sens2_list = [df2_dSa1, df2_dSa2, df2_ds12, df2_ds21]\n        \n        max_abs_sens1 = np.max(np.abs(sens1_list))\n        max_abs_sens2 = np.max(np.abs(sens2_list))\n\n        case_results = [\n            f1, f2,\n            df1_dSa1, df1_dSa2, df1_ds12, df1_ds21,\n            df2_dSa1, df2_dSa2, df2_ds12, df2_ds21,\n            max_abs_sens1, max_abs_sens2\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string exactly as required\n    result_str = \"[\" + \",\".join([f\"[{','.join(map(str, res))}]\" for res in all_results]) + \"]\"\n    print(result_str)\n\nsolve()\n```"
        }
    ]
}