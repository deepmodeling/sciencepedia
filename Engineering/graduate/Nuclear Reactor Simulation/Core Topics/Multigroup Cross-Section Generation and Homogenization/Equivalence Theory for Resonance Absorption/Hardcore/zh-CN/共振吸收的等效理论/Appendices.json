{
    "hands_on_practices": [
        {
            "introduction": "共振自屏效应是反应堆物理中的一个核心概念，量化这一效应至关重要。本练习通过引入自屏因子 $f$ 来实现这一目标。您将从第一性原理出发，推导并计算一个有限厚度吸收体平板中的自屏因子，通过引入“逃逸截面”来模拟中子泄漏，从而亲手实践等效理论如何将几何形状与均匀化截面联系起来。",
            "id": "4223772",
            "problem": "一个均匀吸收体占据了一个厚度为 $a$ 的无限平板，其两侧均为真空边界。在能量 $E_{0}$ 附近的一个孤立共振峰内，该吸收体的微观吸收截面可以很好地用单能级洛伦兹分布表示，\n$$\n\\sigma_{a}(E) \\;=\\; \\sigma_{0}\\,\\frac{\\gamma^{2}}{(E-E_{0})^{2}+\\gamma^{2}} \\,,\n$$\n其中 $\\sigma_{0}$ 是在 $E=E_{0}$ 处的峰值，$\\gamma$ 是半高半宽。假设在此窄共振峰内，弹性散射和任何非共振吸收都可以忽略不计，并且外部慢化强度在共振区间内近似恒定，其形状与 $1/E$ 成正比（窄共振近似），即对于 $E$ 接近 $E_{0}$ 的情况，有 $W(E)=C/E\\simeq C/E_{0}$。\n\n在处理有限几何中子共振吸收的等效理论中，空间泄漏通过一个与能量无关的逃逸截面 $\\Sigma_{e}$ 来建模，该截面在能量依赖的平衡方程中产生一个移出项 $\\Sigma_{e}\\,\\phi(E)$。对于凸体内的各向同性角分布，平均弦长为 $\\ell=4V/S$，其中 $V$ 是体积，$S$ 是表面积。对于厚度为 $a$ 的无限平板，使用此结果求得 $\\Sigma_{e}$。\n\n设吸收体的原子核数密度为 $N$，并定义自屏敝因子\n$$\nf \\;=\\; \\frac{\\bar{\\sigma}_{a}}{\\sigma_{a}^{\\infty}} \\,,\n$$\n其中 $\\bar{\\sigma}_{a}$ 表示对自屏敝通量进行平均的共振吸收截面，$\\sigma_{a}^{\\infty}$ 表示对无限稀释通量进行平均的同一物理量，两者都是在共振区间上计算的。具体而言，\n$$\n\\bar{\\sigma}_{a} \\;=\\; \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE \\,, \\qquad \\sigma_{a}^{\\infty} \\;=\\; \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi_{\\infty}(E)\\,dE \\,,\n$$\n其中 $\\phi(E)$ 和 $\\phi_{\\infty}(E)$ 分别表示存在吸收体时的板内通量，以及在相同平板几何中无限稀释（即 $N\\to 0$）时的通量。假设吸收体在空间上是均匀的，并忽略共振峰内的上散射。\n\n给定以下数据：\n- 平板厚度 $a=0.50\\,\\mathrm{cm}$，\n- 原子核数密度 $N=8.0\\times 10^{21}\\,\\mathrm{cm}^{-3}$，\n- 微观截面峰值 $\\sigma_{0}=1000\\,\\mathrm{barn}$，\n- 共振半高半宽 $\\gamma=0.25\\,\\mathrm{eV}$，共振中心能量 $E_{0}=7.0\\,\\mathrm{eV}$（根据题目要求，您可以将 $W(E)$ 视为在整个共振区内是恒定的），\n\n根据上述概要从第一性原理推导 $f$ 并计算其数值。使用 $1\\,\\mathrm{barn}=10^{-24}\\,\\mathrm{cm}^{2}$。最终答案以无量纲小数表示，并四舍五入到四位有效数字。",
            "solution": "该问题被验证为具有科学依据、提法明确且客观。它代表了使用等效理论对共振吸收的标准（尽管简化了的）表述，这是核反应堆物理学的一个核心内容。所有必要的数据和假设都已提供，以获得唯一解。\n\n目标是计算自屏敝因子 $f$，其定义为通量加权积分的微观吸收截面 $\\bar{\\sigma}_{a}$ 与其无限稀释对应值 $\\sigma_{a}^{\\infty}$ 的比值。\n$$\nf = \\frac{\\bar{\\sigma}_{a}}{\\sigma_{a}^{\\infty}} = \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi_{\\infty}(E)\\,dE}\n$$\n该问题设定在窄共振（NR）近似的框架内，其中慢化源 $W(E)$ 在共振宽度上被认为是恒定的。均匀介质的中子平衡方程将中子损失（吸收和泄漏）与该源联系起来。问题指明，空间泄漏由一个移出项 $\\Sigma_{e}\\phi(E)$ 建模，其中 $\\Sigma_{e}$ 是一个与能量无关的宏观逃逸截面。由于假设弹性散射可以忽略，空间平均的、能量依赖的中子通量 $\\phi(E)$ 的平衡方程为：\n$$\n(\\Sigma_{a}(E) + \\Sigma_{e})\\phi(E) = W(E)\n$$\n这里，$\\Sigma_a(E) = N\\sigma_a(E)$ 是宏观吸收截面，其中 $N$ 是吸收体的原子核数密度。在窄共振近似下，$W(E) \\approx W_{0}$，是一个常数。因此，自屏敝通量为：\n$$\n\\phi(E) = \\frac{W_{0}}{\\Sigma_{a}(E) + \\Sigma_{e}} = \\frac{W_{0}}{N\\sigma_{a}(E) + \\Sigma_{e}}\n$$\n无限稀释通量 $\\phi_{\\infty}(E)$ 是在 $N \\to 0$ 极限下的通量，此时 $\\Sigma_a(E) \\to 0$。在这种情况下，平衡方程简化为 $\\Sigma_{e}\\phi_{\\infty}(E) = W_{0}$，从而得出：\n$$\n\\phi_{\\infty}(E) = \\frac{W_{0}}{\\Sigma_{e}}\n$$\n正如在没有共振吸收体时所预期的那样，该通量在整个共振区内不随能量变化而保持恒定。\n\n现在我们可以构建 $f$ 的分子和分母。\n分子是 $\\bar{\\sigma}_{a}$：\n$$\n\\bar{\\sigma}_{a} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{W_{0}}{N\\sigma_{a}(E) + \\Sigma_e} dE = W_{0} \\int_{-\\infty}^{\\infty} \\frac{\\sigma_{a}(E)}{N\\sigma_{a}(E) + \\Sigma_e} dE\n$$\n分母是 $\\sigma_{a}^{\\infty}$：\n$$\n\\sigma_{a}^{\\infty} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi_{\\infty}(E)\\,dE = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{W_{0}}{\\Sigma_{e}} dE = \\frac{W_{0}}{\\Sigma_{e}} \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) dE\n$$\n洛伦兹截面 $\\sigma_a(E)$ 的积分是一个标准结果。令 $x=E-E_0$：\n$$\n\\int_{-\\infty}^{\\infty} \\sigma_{a}(E) dE = \\int_{-\\infty}^{\\infty} \\sigma_{0}\\,\\frac{\\gamma^{2}}{(E-E_{0})^{2}+\\gamma^{2}} dE = \\sigma_0 \\gamma^2 \\int_{-\\infty}^{\\infty} \\frac{dx}{x^2 + \\gamma^2}\n$$\n该积分的计算结果为：\n$$\n\\sigma_0 \\gamma^2 \\left[ \\frac{1}{\\gamma}\\arctan\\left(\\frac{x}{\\gamma}\\right) \\right]_{-\\infty}^{\\infty} = \\sigma_0 \\gamma (\\pi)\n$$\n因此，分母为：\n$$\n\\sigma_{a}^{\\infty} = \\frac{W_{0}\\pi\\sigma_{0}\\gamma}{\\Sigma_{e}}\n$$\n对于分子，我们将洛伦兹形式代入被积函数：\n$$\n\\frac{\\sigma_{a}(E)}{N\\sigma_{a}(E) + \\Sigma_e} = \\frac{\\sigma_{0}\\,\\frac{\\gamma^{2}}{(E-E_{0})^{2}+\\gamma^{2}}}{N\\sigma_{0}\\,\\frac{\\gamma^{2}}{(E-E_{0})^{2}+\\gamma^{2}} + \\Sigma_e} = \\frac{\\sigma_0 \\gamma^2}{N\\sigma_0 \\gamma^2 + \\Sigma_e((E-E_0)^2 + \\gamma^2)} = \\frac{\\sigma_0 \\gamma^2}{\\Sigma_e(E-E_0)^2 + (N\\sigma_0 + \\Sigma_e)\\gamma^2}\n$$\n$\\bar{\\sigma}_{a}$ 的积分变为，再次令 $x=E-E_0$：\n$$\n\\bar{\\sigma}_{a} = W_{0} \\int_{-\\infty}^{\\infty} \\frac{\\sigma_0 \\gamma^2}{\\Sigma_e x^2 + (N\\sigma_0 + \\Sigma_e)\\gamma^2} dx = W_{0}\\sigma_0\\gamma^2 \\left[ \\frac{\\pi}{\\sqrt{\\Sigma_e}\\sqrt{(N\\sigma_0 + \\Sigma_e)\\gamma^2}} \\right]\n$$\n$$\n\\bar{\\sigma}_{a} = \\frac{W_{0}\\pi\\sigma_{0}\\gamma}{\\sqrt{\\Sigma_e(N\\sigma_0 + \\Sigma_e)}}\n$$\n现在，我们计算比值 $f = \\bar{\\sigma}_{a}/\\sigma_{a}^{\\infty}$：\n$$\nf = \\frac{\\frac{W_{0}\\pi\\sigma_{0}\\gamma}{\\sqrt{\\Sigma_e(N\\sigma_0 + \\Sigma_e)}}}{\\frac{W_{0}\\pi\\sigma_{0}\\gamma}{\\Sigma_{e}}} = \\frac{\\Sigma_e}{\\sqrt{\\Sigma_e(N\\sigma_0 + \\Sigma_e)}} = \\frac{\\Sigma_e}{\\sqrt{\\Sigma_e^2(1 + \\frac{N\\sigma_0}{\\Sigma_e})}} = \\frac{1}{\\sqrt{1 + \\frac{N\\sigma_0}{\\Sigma_e}}}\n$$\n这是等效理论中的一个经典结果。为了获得数值，我们必须首先确定 $\\Sigma_e$。问题指导我们使用平均弦长 $\\ell = 4V/S$。对于厚度为 $a$、面积为 $A_{surf}$ 的无限平板，其体积为 $V = a A_{surf}$，表面积为 $S = 2A_{surf}$。\n$$\n\\ell = \\frac{4V}{S} = \\frac{4(a A_{surf})}{2A_{surf}} = 2a\n$$\n在等效理论中，孤立凸体的逃逸截面通常定义为 $\\Sigma_e = 1/\\ell$。\n$$\n\\Sigma_e = \\frac{1}{2a}\n$$\n我们已知以下数据：\n平板厚度 $a = 0.50\\,\\mathrm{cm}$。\n原子核数密度 $N = 8.0 \\times 10^{21}\\,\\mathrm{cm}^{-3}$。\n截面峰值 $\\sigma_{0} = 1000\\,\\mathrm{barn} = 1000 \\times (10^{-24}\\,\\mathrm{cm}^{2}) = 1.0 \\times 10^{-21}\\,\\mathrm{cm}^{2}$。\n\n首先，我们计算 $\\Sigma_e$：\n$$\n\\Sigma_e = \\frac{1}{2(0.50\\,\\mathrm{cm})} = \\frac{1}{1.0\\,\\mathrm{cm}} = 1.0\\,\\mathrm{cm}^{-1}\n$$\n接下来，我们计算宏观截面峰值 $\\Sigma_{a,0} = N\\sigma_0$：\n$$\nN\\sigma_0 = (8.0 \\times 10^{21}\\,\\mathrm{cm}^{-3}) \\times (1.0 \\times 10^{-21}\\,\\mathrm{cm}^2) = 8.0\\,\\mathrm{cm}^{-1}\n$$\n最后，我们将这些值代入 $f$ 的表达式中：\n$$\nf = \\frac{1}{\\sqrt{1 + \\frac{N\\sigma_0}{\\Sigma_e}}} = \\frac{1}{\\sqrt{1 + \\frac{8.0\\,\\mathrm{cm}^{-1}}{1.0\\,\\mathrm{cm}^{-1}}}} = \\frac{1}{\\sqrt{1+8.0}} = \\frac{1}{\\sqrt{9.0}} = \\frac{1}{3}\n$$\n数值结果四舍五入到四位有效数字为 $0.3333$。共振参数 $\\gamma$ 和 $E_0$ 在最终计算中并未用到，但它们验证了窄共振近似的有效性，因为共振宽度（$\\sim \\gamma=0.25\\,\\mathrm{eV}$）远小于共振能量（$E_0=7.0\\,\\mathrm{eV}$）。",
            "answer": "$$\n\\boxed{0.3333}\n$$"
        },
        {
            "introduction": "在共振俘获计算中，对共振区内的中子能谱通量进行精确建模是关键。本练习将探讨三种广泛使用的近似模型：窄共振（NR）、宽共振（WR）和中等共振（IR）近似。通过为同一个 $^{238}\\mathrm{U}$ 共振峰计算并比较这三种模型预测的自屏因子，您将深入理解它们各自的物理假设以及对通量凹陷的不同处理方式。",
            "id": "4223807",
            "problem": "考虑一个包含稀浓度铀-238 ($^{238}\\mathrm{U}$) 的均匀无限介质，该介质作为共振吸收体。在可分辨共振区，使用具有恒定宽度的简化单能级 Breit–Wigner 形式，对一个以能量 $E_{0} = 6.67\\,\\mathrm{eV}$ 为中心的孤立s波俘获共振进行建模，其吸收微观截面用洛伦兹记法表示为，\n$$\n\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}},\n$$\n其中 $\\sigma_{r}$ 是共振峰值，$\\gamma = \\Gamma/2$ 是半宽。取 $\\sigma_{r} = 2500\\,\\mathrm{b}$ 和 $\\gamma = 0.30\\,\\mathrm{eV}$。使用等效理论来表示共振附近的慢化通量凹陷，即通过一个恒定的“背景”截面 $\\sigma_{0}$，它将几何形状和非共振相互作用合并为一个等效的、与能量无关的项，并取 $\\sigma_{0} = 30\\,\\mathrm{b}$。将通量归一化，使得在远离共振处（$\\sigma_{a}(E) \\approx 0$），通量幅度为1。\n\n对于此单个共振，将自屏效应因子 $f$ 定义为在指定通量模型下的共振吸收率与在恒定通量下的未屏蔽吸收率之比：\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}.\n$$\n计算并比较以下三种自屏效应因子：\n- 窄共振 (NR) 因子 $f_{\\mathrm{NR}}$，取共振范围内的 $\\phi(E)$ 为常数。\n- 宽共振 (WR) 因子 $f_{\\mathrm{WR}}$，取 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$。\n- 中间共振 (IR) 因子 $f_{\\mathrm{IR}}$，取 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$，其中 $p = 0.60$。\n\n从给定的定义和模型（洛伦兹截面和上述基于等效理论的通量形式）出发，推导 $f_{\\mathrm{NR}}$、$f_{\\mathrm{WR}}$ 和 $f_{\\mathrm{IR}}$ 的闭式表达式，然后根据给定参数对它们进行数值计算。将能量积分的边界视为延伸至无穷大，这是合理的，因为共振的宽度相对于勒程网格来说很窄。将 $f_{\\mathrm{NR}}$、$f_{\\mathrm{WR}}$ 和 $f_{\\mathrm{IR}}$ 中的每一个都表示为四位有效数字的无量纲数。最后，对它们的预测进行定量比较，即对它们的大小进行排序，并评论每种模型所隐含的自屏效应程度。",
            "solution": "首先验证该问题具有科学依据、适定、客观且完整。所有必要的物理模型、定义和数值参数均已提供，并且它们与核反应堆物理的既定原理一致，特别是共振吸收理论。该问题是应用等效理论和不同共振近似（窄共振、宽共振、中间共振）的标准练习。因此，我们开始求解。\n\n自屏效应因子 $f$ 定义为实际（被屏蔽的）共振吸收率与假设的未屏蔽吸收率之比：\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}\n$$\n该表达式的分母是未屏蔽共振积分，我们将其表示为 $I_{unsh}$。使用给定的吸收截面洛伦兹形式 $\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}$，我们可以计算这个积分。令 $x = E - E_0$，则 $dx = dE$。积分限仍为 $(-\\infty, \\infty)$。\n$$\nI_{unsh} = \\int_{-\\infty}^{\\infty} \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}\\,dE = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}}\n$$\n这是一个标准积分形式。\n$$\nI_{unsh} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma} \\arctan\\left(\\frac{x}{\\gamma}\\right) \\right]_{-\\infty}^{\\infty} = \\sigma_{r}\\gamma \\left( \\arctan(+\\infty) - \\arctan(-\\infty) \\right) = \\sigma_{r}\\gamma \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right)\n$$\n$$\nI_{unsh} = \\pi \\gamma \\sigma_{r}\n$$\n这个未屏蔽共振积分的结果作为所有三种情况的归一化因子。\n\n现在我们为三种指定的通量模型分别计算自屏效应因子。\n\n**1. 窄共振 (NR) 因子, $f_{\\mathrm{NR}}$**\n\n窄共振近似假设共振非常窄，以至于在共振区内的任何一次散射碰撞都会将中子移出共振能量范围。因此，通量不会因共振区内的吸收而降低，并保持其渐近值。根据远离共振处通量归一化的条件，我们有 $\\phi(E) = 1$。\n$$\nf_{\\mathrm{NR}} = \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,(1)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE} = \\frac{I_{unsh}}{I_{unsh}} = 1\n$$\n解析表达式为 $f_{\\mathrm{NR}} = 1$。其数值为 $1.000$。\n\n**2. 宽共振 (WR) 因子, $f_{\\mathrm{WR}}$**\n\n宽共振近似假设共振非常宽，以至于中子无法通过单次散射碰撞逃离共振区。因此，根据稳态慢化方程，通量会发生凹陷。在指定的模型条件下，得出 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$。因子 $f_{\\mathrm{WR}}$ 的分子是被屏蔽的共振积分 $I_{sh, WR}$：\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)} dE\n$$\n我们通过代入 $\\sigma_a(E)$ 的表达式来分析被积函数：\n$$\n\\frac{\\sigma_{a}(E)}{\\sigma_{0} + \\sigma_{a}(E)} = \\frac{\\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}}{\\sigma_{0} + \\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}} = \\frac{\\sigma_{r}\\gamma^{2}}{\\sigma_{0}((E-E_{0})^{2} + \\gamma^{2}) + \\sigma_{r}\\gamma^{2}}\n$$\n因此，积分变为：\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\frac{\\sigma_{0}\\sigma_{r}\\gamma^{2}}{\\sigma_{0}(E-E_{0})^{2} + \\sigma_{0}\\gamma^{2} + \\sigma_{r}\\gamma^{2}} dE\n$$\n让我们从被积函数的分母中提出因子 $\\sigma_0$，并令 $x = E - E_0$：\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})}\n$$\n这又是一个反正切积分形式，其中分母中的常数项对应于 $a^{2} = \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})$，所以 $a = \\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}$。\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} \\arctan\\left(\\frac{x}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\\right) \\right]_{-\\infty}^{\\infty}\n$$\n$$\nI_{sh, WR} = \\frac{\\sigma_{r}\\gamma}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} (\\pi) = \\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\n那么，自屏效应因子为：\n$$\nf_{\\mathrm{WR}} = \\frac{I_{sh, WR}}{I_{unsh}} = \\frac{\\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}}{\\pi \\gamma \\sigma_r} = \\frac{1}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\n使用给定值 $\\sigma_{r} = 2500\\,\\mathrm{b}$ 和 $\\sigma_{0} = 30\\,\\mathrm{b}$：\n$$\nf_{\\mathrm{WR}} = \\frac{1}{\\sqrt{1 + \\frac{2500}{30}}} = \\frac{1}{\\sqrt{1 + \\frac{250}{3}}} = \\frac{1}{\\sqrt{\\frac{253}{3}}} = \\sqrt{\\frac{3}{253}} \\approx 0.108893\n$$\n保留四位有效数字， $f_{\\mathrm{WR}} = 0.1089$。\n\n**3. 中间共振 (IR) 因子, $f_{\\mathrm{IR}}$**\n\n中间共振模型使用一个插值参数 $p$ 来连接窄共振和宽共振的极限情况，其通量由 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$ 给出。其计算过程在形式上与宽共振情况相同，只需在 $f_{\\mathrm{WR}}$ 的最终解析表达式中将 $\\sigma_r$ 替换为 $p \\sigma_r$。我们来快速验证一下。被屏蔽的积分为：\n$$\nI_{sh, IR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)} dE\n$$\n推导过程与 $f_{\\mathrm{WR}}$ 完全相同，但对应于 $\\frac{\\sigma_r}{\\sigma_0}$ 的项变为 $p\\frac{\\sigma_r}{\\sigma_0}$。因此，$f_{\\mathrm{IR}}$ 的闭式表达式为：\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + p\\frac{\\sigma_r}{\\sigma_0}}}\n$$\n使用给定值，包括 $p = 0.60$：\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{2500}{30}\\right)}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{250}{3}\\right)}} = \\frac{1}{\\sqrt{1 + 50}} = \\frac{1}{\\sqrt{51}} \\approx 0.140028\n$$\n保留四位有效数字， $f_{\\mathrm{IR}} = 0.1400$。\n\n**比较与排序**\n\n计算出的自屏效应因子为：\n- $f_{\\mathrm{NR}} = 1.000$\n- $f_{\\mathrm{IR}} = 0.1400$\n- $f_{\\mathrm{WR}} = 0.1089$\n\n按大小对它们进行排序，我们得到：\n$$\nf_{\\mathrm{WR}}  f_{\\mathrm{IR}}  f_{\\mathrm{NR}}\n$$\n自屏效应因子 $f$ 量化了共振能量处的通量凹陷；接近1的值意味着可忽略的屏蔽效应，而远小于1的值则表示强烈的屏蔽效应。\n- NR 模型 ($f_{\\mathrm{NR}}=1.000$) 假设没有通量凹陷，因此没有屏蔽效应。这是给定共振的理论最大吸收率。\n- WR 模型 ($f_{\\mathrm{WR}}=0.1089$) 假设了最大的通量凹陷，此时通量与总截面成反比。这导致了最强的屏蔽效应，使有效吸收率降低了约 $1/0.1089 \\approx 9.18$ 倍。\n- IR 模型 ($f_{\\mathrm{IR}}=0.1400$) 提供了一个中等水平的屏蔽，它考虑了中子在散射后逃离共振的部分概率。这种屏蔽效应是显著的，使吸收率降低了约 $1/0.1400 \\approx 7.14$ 倍，但不如纯 WR 极限情况那么严重。\n\n$f_{\\mathrm{NR}}$ 与另外两个因子之间的显著差异，突显了对于像 $^{238}\\mathrm{U}$ 中 $6.67\\,\\mathrm{eV}$ 共振这样的强低能共振，考虑自屏效应的至关重要性。对于这种情况，NR 近似在物理上是不合适的，而 WR 和 IR 模型则为被严重抑制的共振吸收提供了更切合实际的估计。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000  0.1089  0.1400\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "等效理论的最终检验在于其预测能否与更精确的输运计算相符。本练习将理论付诸实践，要求您编写一个一维离散纵标（$S_N$）输运求解器。您的任务是直接比较一个非均匀栅格模型和一个等效均匀化模型的总燃料吸收率，从而通过计算来验证等效原理的准确性和适用范围。",
            "id": "4223791",
            "problem": "考虑一个一维平板几何模型，其两端为真空边界，内部是由燃料层和慢化剂层组成的空间周期性栅格。该平板在给定能量下，受到单位体积内各向同性、空间均匀的外部源的照射。目标是通过比较反应率，来验证非均匀栅格与等效均匀混合物在共振吸收方面的等效性。\n\n从稳态、单能、平板几何中的中子输运方程开始，其中散射为各向同性且无裂变：\n$$\n\\mu \\frac{d \\psi(x,\\mu)}{dx} + \\Sigma_t(x) \\psi(x,\\mu) = Q(x) + \\frac{\\Sigma_s(x)}{2} \\int_{-1}^{1} \\psi(x,\\mu') \\, d\\mu',\n$$\n其中，$x$是空间坐标，$\\mu$是相对于平板法线的极角余弦，$\\psi(x,\\mu)$是角通量，$\\Sigma_t(x)$是宏观总截面，$\\Sigma_s(x)$是宏观散射截面，$Q(x)$是单位体积内的各向同性外源。真空边界意味着$\\psi(0,\\mu>0)=0$和$\\psi(L,\\mu0)=0$，其中$L$是平板宽度。标量通量定义为\n$$\n\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu) \\, d\\mu.\n$$\n\n使用离散纵标法，在$[-1,1]$上取$N=8$个高斯-勒让德角向求积点和权重，并在均匀网格上采用金刚石差分空间离散格式。对于每个权重为$w_m$的离散方向$\\mu_m$，以及宽度为$h$的空间单元（在该单元内$\\Sigma_t$和总源$S(x) = Q(x) + \\frac{\\Sigma_s(x)}{2} \\phi(x)$被视为常数），金刚石差分单元平衡给出了跨单元面的扫描关系：\n$$\n\\psi_{R} = \\frac{2 - \\tau}{2 + \\tau} \\, \\psi_{L} + \\frac{2 S h}{|\\mu_m| (2 + \\tau)}, \\quad \\tau = \\frac{\\Sigma_t h}{|\\mu_m|},\n$$\n该式适用于从左到右的扫描($\\mu_m>0$)，其中$\\psi_L$和$\\psi_R$分别是单元左侧和右侧界面上的入流和出流角通量。对于从右到左的扫描($\\mu_m0$)，采用相同的形式，从右边界开始，并施加相应的入流真空边界条件。单元平均角通量由入流和出流界面通量的算术平均值近似。执行源迭代直至标量通量收敛。\n\n将燃料中的反应率密度定义为$\\Sigma_{a,f} \\phi(x)$，其中$\\Sigma_{a,f} = \\Sigma_{t,f} - \\Sigma_{s,f}$是燃料的宏观吸收截面。在非均匀栅格中，将反应率密度在燃料子区域上积分。在等效均匀混合物中，使用通过对燃料和慢化剂的宏观总截面和散射截面进行体积分数加权而形成的宏观混合截面：\n$$\n\\Sigma_t^{\\text{mix}} = f_f \\Sigma_{t,f} + f_m \\Sigma_{t,m}, \\quad \\Sigma_s^{\\text{mix}} = f_f \\Sigma_{s,f} + f_m \\Sigma_{s,m}, \\quad f_f = \\frac{t_f}{p}, \\quad f_m = 1 - f_f,\n$$\n其中$t_f$是燃料层厚度，$p$是栅格节距，$f_f$和$f_m$分别是燃料和慢化剂的体积分数。计算均匀混合物的标量通量场，并将混合物中的燃料反应率表示为$f_f \\Sigma_{a,f} \\int_0^L \\phi_{\\text{mix}}(x) \\, dx$，这代表了在整个混合物中使用单一通量场假设下，单位面积上的燃料吸收。\n\n对于每个测试案例，计算比值$R$：\n$$\nR = \\frac{\\int_{\\text{fuel}} \\Sigma_{a,f} \\phi_{\\text{het}}(x) \\, dx}{f_f \\Sigma_{a,f} \\int_0^L \\phi_{\\text{mix}}(x) \\, dx},\n$$\n其中$\\phi_{\\text{het}}(x)$是非均匀栅格的标量通量，$\\phi_{\\text{mix}}(x)$是均匀混合物的标量通量。$R$值接近1表明，在所述近似条件下，共振吸收具有等效性。\n\n使用以下物理上合理的参数集作为测试套件。所有长度单位为厘米（cm），所有截面单位为厘米的倒数（cm$^{-1}$），能量单位为电子伏特（eV），外源$Q$的单位为中子/立方厘米/秒（n cm$^{-3}$ s$^{-1}$）。角向单位为无量纲的$\\mu$，区间为$[-1,1]$。\n\n- 测试案例1（强共振，典型栅格）：\n    - $E = 6.67$ eV,\n    - $L = 10.0$ cm,\n    - $p = 1.0$ cm,\n    - $t_f = 0.4$ cm,\n    - 燃料: $\\Sigma_{s,f} = 0.30$ cm$^{-1}$, $\\Sigma_{a,f} = 5.50$ cm$^{-1}$, 所以 $\\Sigma_{t,f} = 5.80$ cm$^{-1}$,\n    - 慢化剂: $\\Sigma_{s,m} = 0.58$ cm$^{-1}$, $\\Sigma_{a,m} = 0.02$ cm$^{-1}$, 所以 $\\Sigma_{t,m} = 0.60$ cm$^{-1}$,\n    - $Q = 1.0$ n cm$^{-3}$ s$^{-1}$。\n\n- 测试案例2（中等共振，典型栅格）：\n    - $E = 20.0$ eV,\n    - $L = 10.0$ cm,\n    - $p = 1.0$ cm,\n    - $t_f = 0.4$ cm,\n    - 燃料: $\\Sigma_{s,f} = 0.30$ cm$^{-1}$, $\\Sigma_{a,f} = 1.20$ cm$^{-1}$, 所以 $\\Sigma_{t,f} = 1.50$ cm$^{-1}$,\n    - 慢化剂: $\\Sigma_{s,m} = 0.29$ cm$^{-1}$, $\\Sigma_{a,m} = 0.01$ cm$^{-1}$, 所以 $\\Sigma_{t,m} = 0.30$ cm$^{-1}$,\n    - $Q = 1.0$ n cm$^{-3}$ s$^{-1}$。\n\n- 测试案例3（较弱共振，典型栅格）：\n    - $E = 36.7$ eV,\n    - $L = 10.0$ cm,\n    - $p = 1.0$ cm,\n    - $t_f = 0.4$ cm,\n    - 燃料: $\\Sigma_{s,f} = 0.30$ cm$^{-1}$, $\\Sigma_{a,f} = 0.80$ cm$^{-1}$, 所以 $\\Sigma_{t,f} = 1.10$ cm$^{-1}$,\n    - 慢化剂: $\\Sigma_{s,m} = 0.245$ cm$^{-1}$, $\\Sigma_{a,m} = 0.005$ cm$^{-1}$, 所以 $\\Sigma_{t,m} = 0.250$ cm$^{-1}$,\n    - $Q = 1.0$ n cm$^{-3}$ s$^{-1}$。\n\n- 测试案例4（强共振，泄漏主导的边缘情况）：\n    - $E = 6.67$ eV,\n    - $L = 1.0$ cm,\n    - $p = 1.0$ cm,\n    - $t_f = 0.4$ cm,\n    - 燃料: $\\Sigma_{s,f} = 0.30$ cm$^{-1}$, $\\Sigma_{a,f} = 5.50$ cm$^{-1}$, 所以 $\\Sigma_{t,f} = 5.80$ cm$^{-1}$,\n    - 慢化剂: $\\Sigma_{s,m} = 0.58$ cm$^{-1}$, $\\Sigma_{a,m} = 0.02$ cm$^{-1}$, 所以 $\\Sigma_{t,m} = 0.60$ cm$^{-1}$,\n    - $Q = 1.0$ n cm$^{-3}$ s$^{-1}$。\n\n使用均匀网格宽度$h = 0.02$ cm对空间进行离散（确保每个案例的$L/h$都是整数）。对于每个测试案例，计算如上定义的比值$R$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，`[r1,r2,r3,r4]`），其中每个$r_j$是按上述顺序列出的测试案例$j$的浮点数比值。",
            "solution": "该问题要求在一维平板栅格中验证共振吸收的等效性理论。这是通过比较空间显式的非均匀模型与体平均的均匀模型中的燃料吸收反应率来完成的。任务的核心是求解两种构型的稳态单能中子输运方程，然后计算指定的反应率之比。\n\n控制方程是平板几何中的单能线性玻尔兹曼输运方程：\n$$\n\\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_t(x) \\psi(x,\\mu) = \\frac{\\Sigma_s(x)}{2} \\phi(x) + Q(x)\n$$\n其中，$\\psi(x,\\mu)$是位置$x$处沿极角余弦为$\\mu$的方向运动的中子角通量，$\\Sigma_t(x)$是宏观总截面，$\\Sigma_s(x)$是宏观散射截面，$Q(x)$是各向同性外源。标量通量$\\phi(x)$是角通量在所有方向上的积分：\n$$\n\\phi(x) = \\int_{-1}^{1} \\psi(x,\\mu') \\, d\\mu'\n$$\n问题指定了真空边界条件，这意味着没有中子从外部进入平板：\n$$\n\\psi(0,\\mu>0) = 0 \\quad \\text{和} \\quad \\psi(L,\\mu0) = 0\n$$\n其中$L$是平板厚度。\n\n为了数值求解此积分-微分方程，我们对角向变量采用离散纵标（$S_N$）法，对空间变量采用金刚石差分法。\n\n**1. 角向离散：离散纵标（$S_N$）法**\n连续角向变量$\\mu$被离散为一组$N$个离散方向 $\\{\\mu_m\\}$ 及相应的权重 $\\{w_m\\}$，其中 $m=1, \\dots, N$。它们被选为区间$[-1,1]$上$N$点高斯-勒让德求积法则的节点和权重。该求积方法对最高$2N-1$次的多项式是精确的。输运方程中的积分项随后通过加权和来近似：\n$$\n\\phi(x) \\approx \\sum_{m=1}^{N} w_m \\psi(x, \\mu_m)\n$$\n将此代入输运方程，得到一个包含$N$个耦合常微分方程的方程组，每个方程对应一个离散方向$\\mu_m$：\n$$\n\\mu_m \\frac{d \\psi_m(x)}{dx} + \\Sigma_t(x) \\psi_m(x) = \\frac{\\Sigma_s(x)}{2} \\sum_{j=1}^{N} w_j \\psi_j(x) + Q(x)\n$$\n其中 $\\psi_m(x) = \\psi(x, \\mu_m)$。\n\n**2. 空间离散：金刚石差分法**\n空间域$[0, L]$被划分为一个由$I$个单元组成的均匀网格，每个单元的宽度为$h = L/I$。我们将单元边界位置表示为$x_{i-1/2}$，单元中心位置表示为$x_i$。在每个单元$i$（从$x_{i-1/2}$到$x_{i+1/2}$）内，材料性质$\\Sigma_t(x)$和$\\Sigma_s(x)$以及总源项$S(x) = \\frac{\\Sigma_s(x)}{2}\\phi(x) + Q(x)$被假定为常数，取其在单元中心$x_i$处的值。\n\n将方向$\\mu_m$的常微分方程在单元$i$上积分，得到单元平衡方程：\n$$\n\\mu_m (\\psi_{m, i+1/2} - \\psi_{m, i-1/2}) + \\Sigma_{t,i} h \\bar{\\psi}_{m,i} = S_i h\n$$\n其中$\\psi_{m, i\\pm1/2}$是单元边界处的角通量，$\\bar{\\psi}_{m,i}$是单元平均角通量。金刚石差分格式通过提供单元边界通量和单元平均通量之间的关系来封闭该系统：\n$$\n\\bar{\\psi}_{m,i} = \\frac{\\psi_{m, i-1/2} + \\psi_{m, i+1/2}}{2}\n$$\n求解这两个代数方程，用入流通量表示出流通量，得到一个扫描关系。对于从左到右的扫描（$\\mu_m > 0$），其中$\\psi_{m, i-1/2}$是入流通量，$\\psi_{m, i+1/2}$是出流通量，我们得到：\n$$\n\\psi_{m, i+1/2} = \\frac{2 - \\tau_i}{2 + \\tau_i} \\psi_{m, i-1/2} + \\frac{2 S_i h}{|\\mu_m|(2+\\tau_i)}\n$$\n其中 $\\tau_i = \\frac{\\Sigma_{t,i} h}{|\\mu_m|}$。对于从右到左的扫描（$\\mu_m  0$），使用类似的关系式，从右边界开始进行。\n\n**3. 求解算法：源迭代**\n该方程组通过迭代求解。此方法称为源迭代。\n1. 对标量通量分布$\\phi^{(0)}(x)$做一个初始猜测，例如，对所有$x$设$\\phi^{(0)}(x) = 1$。\n2. 对于迭代$k=1, 2, \\dots$：\n   a. 使用上一迭代步的标量通量计算各单元的总源项：$S_i^{(k)} = Q_i + \\frac{\\Sigma_{s,i}}{2} \\phi_i^{(k-1)}$。\n   b. 对于每个离散方向$\\mu_m$：\n      i. 如果$\\mu_m > 0$，设置边界条件$\\psi_{m, 1/2}=0$并从左到右扫描（$i=1, \\dots, I$），使用金刚石差分关系计算每个单元的出流通量$\\psi_{m, i+1/2}$。\n      ii. 如果$\\mu_m  0$，设置边界条件$\\psi_{m, I+1/2}=0$并从右到左扫描（$i=I, \\dots, 1$），计算每个单元的$\\psi_{m, i-1/2}$。\n      iii. 存储得到的单元平均角通量$\\bar{\\psi}_{m,i}^{(k)} = (\\psi_{m, i-1/2} + \\psi_{m, i+1/2}) / 2$。\n   c. 通过对所有角度的贡献求和来更新标量通量：$\\phi_i^{(k)} = \\sum_{m=1}^{N} w_m \\bar{\\psi}_{m,i}^{(k)}$。\n   d. 通过比较$\\phi^{(k)}$和$\\phi^{(k-1)}$来检查收敛性。例如，当差值的相对L2范数低于容差$\\epsilon$时停止：$\\frac{\\|\\phi^{(k)} - \\phi^{(k-1)}\\|_2}{\\|\\phi^{(k)}\\|_2}  \\epsilon$。\n3. 收敛后的标量通量$\\phi(x)$即为解。\n\n**4. 等效性验证流程**\n此流程针对两个模型执行：\n- **非均匀模型**：截面$\\Sigma_t(x)$和$\\Sigma_s(x)$被分段定义，对应于周期性栅格中的燃料层和慢化剂层。使用这些随空间变化的截面运行输运求解器，以找到$\\phi_{\\text{het}}(x)$。\n- **均匀模型**：栅格被一个均匀的混合物替代。混合物截面$\\Sigma_{t}^{\\text{mix}}$和$\\Sigma_{s}^{\\text{mix}}$通过对组分材料截面进行体积分数加权计算：\n  $$\n  \\Sigma^{\\text{mix}} = f_f \\Sigma_{f} + f_m \\Sigma_{m}\n  $$\n  其中$f_f = t_f/p$和$f_m = 1 - f_f$是燃料和慢化剂的体积分数。然后使用这些常数截面运行输运求解器，以找到$\\phi_{\\text{mix}}(x)$。\n\n最后，计算比值$R$以量化等效性：\n$$\nR = \\frac{\\text{燃料反应率 (非均匀)}}{\\text{燃料反应率 (均匀)}} = \\frac{\\int_{\\text{fuel}} \\Sigma_{a,f} \\phi_{\\text{het}}(x) \\, dx}{f_f \\Sigma_{a,f} \\int_0^L \\phi_{\\text{mix}}(x) \\, dx}\n$$\n由于$\\Sigma_{a,f}$是常数，它可以被约去。积分通过将单元平均通量值乘以单元宽度$h$来近似求和。由于$h$也是一个公因子，它也可以被约去，得到：\n$$\nR = \\frac{\\sum_{i \\in \\text{fuel}} \\phi_{\\text{het},i}}{f_f \\sum_{i=0}^{I-1} \\phi_{\\text{mix},i}}\n$$\n$R$值接近1将支持均匀化近似在计算总燃料吸收率方面的有效性。所提供的实现为每个指定的测试案例执行了这整个过程。",
            "answer": "```python\nimport numpy as np\n# The problem specification allows for numpy and scipy.\n# np.polynomial.legendre.leggauss is sufficient, so scipy is not imported.\n\ndef sn_solver(L, p, t_f, sig_t_f, sig_s_f, sig_t_m, sig_s_m, Q, h, N, is_het):\n    \"\"\"\n    Solves the 1D neutron transport equation using discrete ordinates\n    and diamond differencing.\n    \"\"\"\n    num_cells = int(round(L / h))\n    x_centers = h * (np.arange(num_cells) + 0.5)\n\n    sig_t = np.zeros(num_cells)\n    sig_s = np.zeros(num_cells)\n\n    if is_het:\n        for i in range(num_cells):\n            pos_in_period = x_centers[i] % p\n            # Due to floating point precision, use a small epsilon for comparison.\n            if pos_in_period  t_f:\n                sig_t[i] = sig_t_f\n                sig_s[i] = sig_s_f\n            else:\n                sig_t[i] = sig_t_m\n                sig_s[i] = sig_s_m\n    else:\n        f_f = t_f / p\n        f_m = 1.0 - f_f\n        sig_t_mix = f_f * sig_t_f + f_m * sig_t_m\n        sig_s_mix = f_f * sig_s_f + f_m * sig_s_m\n        sig_t.fill(sig_t_mix)\n        sig_s.fill(sig_s_mix)\n        \n    mu, w = np.polynomial.legendre.leggauss(N)\n    \n    phi = np.ones(num_cells)\n    \n    TOL = 1e-8\n    MAX_ITER = 2000\n\n    for k in range(MAX_ITER):\n        phi_old = phi.copy()\n        source_scatter = 0.5 * sig_s * phi\n        total_source = Q + source_scatter\n        \n        phi.fill(0.0)\n        \n        for m in range(N):\n            mu_m = mu[m]\n            w_m = w[m]\n            \n            psi_face = np.zeros(num_cells + 1)\n            \n            tau = sig_t * h / abs(mu_m)\n            # Ensure no division by zero in case a cell has tau = -2, although unlikely here.\n            denom = 2.0 + tau\n            c1 = (2.0 - tau) / denom\n            c2 = (2.0 * total_source * h) / (abs(mu_m) * denom)\n\n            if mu_m > 0:\n                psi_face[0] = 0.0  # Vacuum BC at x=0\n                for i in range(num_cells):\n                    psi_face[i+1] = c1[i] * psi_face[i] + c2[i]\n            else: # mu_m  0\n                psi_face[num_cells] = 0.0  # Vacuum BC at x=L\n                for i in range(num_cells - 1, -1, -1):\n                    psi_face[i] = c1[i] * psi_face[i+1] + c2[i]\n            \n            psi_center = 0.5 * (psi_face[:-1] + psi_face[1:])\n            phi += w_m * psi_center\n            \n        # Convergence check\n        norm_phi = np.linalg.norm(phi)\n        if norm_phi > 0:\n            err = np.linalg.norm(phi - phi_old) / norm_phi\n            if err  TOL:\n                break\n\n    return phi\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # Problem parameters\n    N_angular = 8\n    h_spatial = 0.02\n    Q_source = 1.0\n\n    # Test cases defined in the problem\n    test_cases = [\n        {'id': 1, 'L': 10.0, 'p': 1.0, 't_f': 0.4, 'sig_s_f': 0.30, 'sig_a_f': 5.50,\n         'sig_s_m': 0.58, 'sig_a_m': 0.02},\n        {'id': 2, 'L': 10.0, 'p': 1.0, 't_f': 0.4, 'sig_s_f': 0.30, 'sig_a_f': 1.20,\n         'sig_s_m': 0.29, 'sig_a_m': 0.01},\n        {'id': 3, 'L': 10.0, 'p': 1.0, 't_f': 0.4, 'sig_s_f': 0.30, 'sig_a_f': 0.80,\n         'sig_s_m': 0.245, 'sig_a_m': 0.005},\n        {'id': 4, 'L': 1.0, 'p': 1.0, 't_f': 0.4, 'sig_s_f': 0.30, 'sig_a_f': 5.50,\n         'sig_s_m': 0.58, 'sig_a_m': 0.02},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L = case['L']\n        p = case['p']\n        t_f = case['t_f']\n\n        sig_t_f = case['sig_s_f'] + case['sig_a_f']\n        sig_s_f = case['sig_s_f']\n        sig_t_m = case['sig_s_m'] + case['sig_a_m']\n        sig_s_m = case['sig_s_m']\n\n        # 1. Solve for the heterogeneous case\n        phi_het = sn_solver(L, p, t_f, sig_t_f, sig_s_f, sig_t_m, sig_s_m,\n                            Q_source, h_spatial, N_angular, is_het=True)\n\n        # 2. Solve for the homogeneous case\n        phi_mix = sn_solver(L, p, t_f, sig_t_f, sig_s_f, sig_t_m, sig_s_m,\n                            Q_source, h_spatial, N_angular, is_het=False)\n\n        # 3. Calculate the ratio R\n        num_cells = int(round(L / h_spatial))\n        x_centers = h_spatial * (np.arange(num_cells) + 0.5)\n        \n        is_fuel_mask = (x_centers % p)  t_f\n        \n        flux_integral_het_fuel = np.sum(phi_het[is_fuel_mask])\n        \n        f_f = t_f / p\n        flux_integral_mix = np.sum(phi_mix)\n        \n        if f_f == 0 or flux_integral_mix == 0:\n            ratio = float('nan') # Should not happen with given params\n        else:\n            denominator = f_f * flux_integral_mix\n            ratio = flux_integral_het_fuel / denominator\n\n        results.append(ratio)\n\n    # Format the final output string\n    output_str = f\"[{','.join([f'{r:.8f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}