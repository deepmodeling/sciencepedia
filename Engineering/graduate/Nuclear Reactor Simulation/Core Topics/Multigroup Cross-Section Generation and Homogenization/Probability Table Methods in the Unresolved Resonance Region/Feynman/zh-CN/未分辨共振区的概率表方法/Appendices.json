{
    "hands_on_practices": [
        {
            "introduction": "本实践练习旨在巩固概率表方法的核心应用。通过从基本物理原理出发，您将推导并计算自屏效应下的群平均截面，并探究背景截面 $\\sigma_0$ 变化对结果的影响 。这项练习对于理解共振自屏现象以及概率表如何量化该效应至关重要。",
            "id": "4242843",
            "problem": "给定一个关于核反应堆模拟中未分辨共振区 (URR) 概率表方法的问题。目标是根据第一性原理，计算当背景截面按指定百分比增加时，群平均微观俘获截面如何变化。未分辨共振区 (URR) 通过概率表处理，这些概率表为能群内的微观反应截面分布提供离散近似。概率表由多个栅元组成，每个栅元都具有相关的概率、微观总截面和微观俘获截面。背景截面，记为 $\\,\\sigma_0\\,$，单位为巴 (barn)，代表了其他材料和几何泄漏对共振自屏效应的稀释作用。\n\n从输运慢化平衡（该平衡意味着窄群内的能谱近似与微观总截面和背景项之和成反比）以及通量加权群平均的定义出发，利用离散概率表和所述物理假设，推导单个能群中群平均微观俘获截面的表达式。然后，对于给定的增量分数 $\\,\\delta\\,$（以小数形式表示），计算当背景截面从 $\\,\\sigma_0\\,$ 变为 $\\,\\sigma_0(1+\\delta)\\,$ 时，群平均俘获截面的变化量 $\\,\\Delta\\sigma_{c,g}\\,$。所有截面都必须以巴为单位处理。最终的数值答案必须是浮点数，表示以巴为单位的 $\\,\\Delta\\sigma_{c,g}\\,$，并采用指定的输出格式。\n\n作为起点的假设和核心定义：\n- 在慢化近似和存在稀释的情况下，窄能群中的中子通量与微观总截面和有效背景项之和的倒数成正比。使用此比例关系作为群内的通量形状。\n- 群平均微观反应截面定义为群上的通量加权平均。\n- 单个能群的 URR 概率表是一组 $\\,N\\,$ 个栅元。每个栅元 $\\,i\\,$ 都有一个概率 $\\,p_i\\,$、一个单位为巴的微观总截面 $\\,\\sigma_{t,i}\\,$ 和一个单位为巴的微观俘获截面 $\\,\\sigma_{c,i}\\,$。这些概率满足 $\\,\\sum_{i=1}^N p_i = 1\\,$。\n\n任务：\n- 根据所述原理推导算法，用于计算给定 URR 概率表和背景截面 $\\,\\sigma_0\\,$ 时单个能群中的群平均微观俘获截面，然后计算以巴为单位的 $\\,\\Delta\\sigma_{c,g} = \\sigma_{c,g}\\big(\\sigma_0(1+\\delta)\\big) - \\sigma_{c,g}(\\sigma_0)\\,$。\n- 在一个程序中实现所推导的算法，以评估下面列出的每个测试用例的 $\\,\\Delta\\sigma_{c,g}\\,$。\n\n测试套件：\n使用以下 URR 概率表和背景变化场景。对于每个表，条目以三元组列表 $\\,[p_i,\\,\\sigma_{t,i},\\,\\sigma_{c,i}]\\,$, 的形式给出，其中 $\\,p_i\\,$ 是无量纲的，$\\,\\sigma_{t,i}\\,$ 和 $\\,\\sigma_{c,i}\\,$ 的单位是巴。\n\n- 表 A（中等相关性，四个栅元）：\n  - 栅元 $\\,1$: $[\\,0.1,\\,150,\\,80\\,]$\n  - 栅元 $\\,2$: $[\\,0.2,\\,60,\\,15\\,]$\n  - 栅元 $\\,3$: $[\\,0.4,\\,30,\\,3\\,]$\n  - 栅元 $\\,4$: $[\\,0.3,\\,80,\\,25\\,]$\n\n- 表 B（强正相关性，四个栅元）：\n  - 栅元 $\\,1$: $[\\,0.25,\\,10,\\,1\\,]$\n  - 栅元 $\\,2$: $[\\,0.25,\\,100,\\,50\\,]$\n  - 栅元 $\\,3$: $[\\,0.25,\\,300,\\,150\\,]$\n  - 栅元 $\\,4$: $[\\,0.25,\\,1000,\\,600\\,]$\n\n评估以下情况，每种情况产生一个以巴为单位的浮点数结果：\n- 情况 $\\,1$：表 A，$\\,\\sigma_0 = 5\\,$ 巴，$\\,\\delta = 0.1\\,$。\n- 情况 $\\,2$：表 A，$\\,\\sigma_0 = 0.1\\,$ 巴，$\\,\\delta = 0.5\\,$。\n- 情况 $\\,3$：表 A，$\\,\\sigma_0 = 100\\,$ 巴，$\\,\\delta = 1.0\\,$。\n- 情况 $\\,4$：表 B，$\\,\\sigma_0 = 1\\,$ 巴，$\\,\\delta = 0.2\\,$。\n- 情况 $\\,5$：表 B，$\\,\\sigma_0 = 10\\,$ 巴，$\\,\\delta = 0.0\\,$。\n\n最终输出格式：\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应情况下以巴为单位的浮点数 $\\,\\Delta\\sigma_{c,g}\\,$，顺序与上面列出的情况相同。例如，输出必须类似于 $[\\text{result1},\\text{result2},\\text{result3},\\text{result4},\\text{result5}]$，不含任何额外文本。所有数值结果都是以巴为单位的浮点数。不涉及角度。增加百分比 $\\,\\delta\\,$ 以小数形式提供，不带百分号。",
            "solution": "该问题要求推导并实现一个算法，以计算由于背景截面 `$\\sigma_0$` 的变化而引起的群平均微观俘获截面的变化量 `$\\Delta\\sigma_{c,g}$`。推导过程基于所提供的基本原理。\n\n设能群由下标 `$g$` 表示。微观总截面为 `$\\sigma_t(E)$`，微观俘获截面为 `$\\sigma_c(E)$`，两者都是能量 `$E$` 的函数。背景截面 `$\\sigma_0$` 在群内是恒定的。\n\n首先，我们建立群平均微观俘获截面 `$\\sigma_{c,g}$` 的公式。问题陈述了两个核心假设：\n1. 群平均微观反应截面定义为群上的通量加权平均。对于俘获截面，即为：\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\sigma_c(E) \\phi(E) dE}{\\int_{g} \\phi(E) dE} $$\n其中 `$\\phi(E)$` 是能量 `$E$` 处的中子通量，积分范围是能群 `$g$` 的能量区间。\n\n2. 窄能群中的中子通量近似地与微观总截面和背景项之和成反比。这是均匀混合物慢化理论中窄共振 (NR) 近似的一个推论。\n$$ \\phi(E) \\propto \\frac{1}{\\sigma_t(E) + \\sigma_0} $$\n我们可以将其写为 `$\\phi(E) = \\frac{C}{\\sigma_t(E) + \\sigma_0}$`，其中 `$C$` 是某个归一化常数。\n\n将 `$\\phi(E)$` 的表达式代入 `$\\sigma_{c,g}$` 的定义中：\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\sigma_c(E) \\frac{C}{\\sigma_t(E) + \\sigma_0} dE}{\\int_{g} \\frac{C}{\\sigma_t(E) + \\sigma_0} dE} $$\n常数 `$C$` 从分子和分母中约去：\n$$ \\sigma_{c,g} = \\frac{\\int_{g} \\frac{\\sigma_c(E)}{\\sigma_t(E) + \\sigma_0} dE}{\\int_{g} \\frac{1}{\\sigma_t(E) + \\sigma_0} dE} $$\n\n概率表方法用离散概率分布取代了未分辨共振区 (URR) 内截面连续且复杂的能量依赖关系。我们不对能量 `$E$` 进行积分，而是对截面值的概率分布进行平均。单个能群的概率表由一组 `$N$` 个栅元组成，其中每个栅元 `$i$` 由一个概率 `$p_i$`、一个总截面 `$\\sigma_{t,i}$` 和一个俘获截面 `$\\sigma_{c,i}$` 来表征。概率是归一化的，使得 `$\\sum_{i=1}^N p_i = 1$`。\n\n这种离散表示使我们能够用对 `$N$` 个栅元的加权和来代替能量积分。函数 `$f(\\sigma_t(E), \\sigma_c(E))$` 在群上的积分可以通过使用概率表计算该函数的期望值来近似：\n$$ \\int_g f(\\sigma_t(E), \\sigma_c(E)) dE \\propto \\sum_{i=1}^N p_i f(\\sigma_{t,i}, \\sigma_{c,i}) $$\n将此近似应用于 `$\\sigma_{c,g}$` 的表达式，分子变为 `$\\sum_{i=1}^N p_i \\frac{\\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}$`，分母变为 `$\\sum_{i=1}^N p_i \\frac{1}{\\sigma_{t,i} + \\sigma_0}$`。\n\n因此，对于给定的背景截面 `$\\sigma_0$`，群平均微观俘获截面为：\n$$ \\sigma_{c,g}(\\sigma_0) = \\frac{\\sum_{i=1}^N p_i \\frac{\\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_{i=1}^N p_i \\frac{1}{\\sigma_{t,i} + \\sigma_0}} $$\n该公式正确地解释了共振自屏效应现象。项 `$\\frac{1}{\\sigma_{t,i} + \\sigma_0}$` 作为权重因子，对具有高总截面（此处存在通量凹陷）的截面带赋予较低的权重。\n\n问题要求计算当背景截面 `$\\sigma_0$` 增加一个分数 `$\\delta$` 时 `$\\sigma_{c,g}$` 的变化量。新的背景截面 `$\\sigma'_{0}$` 为：\n$$ \\sigma'_{0} = \\sigma_0 (1 + \\delta) $$\n变化量 `$\\Delta\\sigma_{c,g}$` 是用新背景截面计算的群平均俘获截面与用原始背景截面计算的群平均俘获截面之差：\n$$ \\Delta\\sigma_{c,g} = \\sigma_{c,g}(\\sigma'_{0}) - \\sigma_{c,g}(\\sigma_0) $$\n$$ \\Delta\\sigma_{c,g} = \\frac{\\sum_{i=1}^N \\frac{p_i \\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0(1+\\delta)}}{\\sum_{i=1}^N \\frac{p_i}{\\sigma_{t,i} + \\sigma_0(1+\\delta)}} - \\frac{\\sum_{i=1}^N \\frac{p_i \\sigma_{c,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_{i=1}^N \\frac{p_i}{\\sigma_{t,i} + \\sigma_0}} $$\n\n这就是需要实现的最终表达式。增加 `$\\sigma_0$` 会减弱自屏效应，因为它使得总有效截面 `$\\sigma_t + \\sigma_0$` 在各个概率带上更加均匀。这会“拉平”通量，导致群平均截面更接近其无限稀释值（`$\\sum p_i \\sigma_{c,i}$`）。因此，对于 `$\\delta > 0$`，我们预期 `$\\Delta\\sigma_{c,g} > 0$`。对于 `$\\delta = 0$`，`$\\Delta\\sigma_{c,g}$` 必须恰好为 `$0$`。\n\n算法如下：\n1. 对于每个测试用例，确定概率表（`$\\{p_i, \\sigma_{t,i}, \\sigma_{c,i}\\}$`）、初始背景截面 `$\\sigma_0$` 和分数变化量 `$\\delta$`。\n2. 使用推导的公式计算初始群平均俘获截面 `$\\sigma_{c,g}(\\sigma_0)$`。\n3. 计算新的背景截面 `$\\sigma'_{0} = \\sigma_0(1+\\delta)$`。\n4. 使用新的背景截面计算最终群平均俘获截面 `$\\sigma_{c,g}(\\sigma'_{0})$`。\n5. 计算差值 `$\\Delta\\sigma_{c,g} = \\sigma_{c,g}(\\sigma'_{0}) - \\sigma_{c,g}(\\sigma_0)$`。\n6. 存储此结果并对所有测试用例重复该过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the change in the group-averaged microscopic capture cross section\n    based on the URR probability table method for a given change in the\n    background cross section.\n    \"\"\"\n\n    # Define the probability tables from the problem statement.\n    # Each row is [p_i, sigma_t_i, sigma_c_i]\n    table_A = np.array([\n        [0.1, 150.0, 80.0],\n        [0.2, 60.0, 15.0],\n        [0.4, 30.0, 3.0],\n        [0.3, 80.0, 25.0]\n    ])\n\n    table_B = np.array([\n        [0.25, 10.0, 1.0],\n        [0.25, 100.0, 50.0],\n        [0.25, 300.0, 150.0],\n        [0.25, 1000.0, 600.0]\n    ])\n\n    # Define the test cases from the problem statement.\n    # Each entry is a tuple: (table, sigma_0, delta)\n    test_cases = [\n        (table_A, 5.0, 0.1),\n        (table_A, 0.1, 0.5),\n        (table_A, 100.0, 1.0),\n        (table_B, 1.0, 0.2),\n        (table_B, 10.0, 0.0)\n    ]\n\n    def calculate_group_capture_xs(table: np.ndarray, sigma_0: float) -> float:\n        \"\"\"\n        Calculates the group-averaged microscopic capture cross section.\n        \n        Args:\n            table: A numpy array representing the URR probability table.\n            sigma_0: The background cross section in barns.\n\n        Returns:\n            The group-averaged capture cross section in barns.\n        \"\"\"\n        p = table[:, 0]\n        sigma_t = table[:, 1]\n        sigma_c = table[:, 2]\n\n        # Denominator of the flux weighting factor (sigma_t_i + sigma_0)\n        weight_denom = sigma_t + sigma_0\n        \n        # Numerator of the group-averaged cross section formula:\n        # Sum(p_i * sigma_c_i / (sigma_t_i + sigma_0))\n        numerator = np.sum(p * sigma_c / weight_denom)\n\n        # Denominator of the group-averaged cross section formula:\n        # Sum(p_i / (sigma_t_i + sigma_0))\n        denominator = np.sum(p / weight_denom)\n        \n        # The case of a zero denominator is physically unrealistic with positive\n        # cross sections and probabilities, but included for robustness.\n        if denominator == 0.0:\n            # Fallback to infinitely dilute average, though this should not be reached.\n            return np.sum(p * sigma_c)\n\n        return numerator / denominator\n\n    results = []\n    for table, sigma_0, delta in test_cases:\n        # 1. Calculate the initial group-averaged capture cross section\n        sigma_c_g_initial = calculate_group_capture_xs(table, sigma_0)\n\n        # 2. Calculate the new background cross section\n        sigma_0_new = sigma_0 * (1.0 + delta)\n\n        # 3. Calculate the final group-averaged capture cross section\n        sigma_c_g_final = calculate_group_capture_xs(table, sigma_0_new)\n\n        # 4. Compute the change (Delta sigma_c,g)\n        delta_sigma_c_g = sigma_c_g_final - sigma_c_g_initial\n        results.append(delta_sigma_c_g)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "此练习深入探讨了未分辨共振区中一个关键的物理细节：截面间的相关性。您将通过一个具体的数值示例，量化忽略俘获截面 $\\sigma_\\gamma$ 与总截面 $\\sigma_t$ 之间的相关性所引入的计算偏差 。这个练习旨在揭示这种相关性的物理起源，并强调在进行精确的反应率计算时考虑它的重要性。",
            "id": "4242791",
            "problem": "您的任务是使用概率表方法为未分辨共振区 (URR) 构建并分析一个最小概率表示例，并量化当俘获截面与总截面之间的相关性被忽略时，俘获反应率中引入的偏差。其物理基础如下：在 URR 中，总截面和各道截面的共振涨落是通过随机方式来表示的。俘获反应率密度从第一性原理定义为 $R_\\gamma = N \\int \\phi(E) \\, \\sigma_\\gamma(E) \\, \\mathrm{d}E$，其中 $N$ 是核子数密度，$\\phi(E)$ 是作为能量函数的中子通量，$\\sigma_\\gamma(E)$ 是俘获截面。在采用 Bondarenko 自屏效应的概率表方法中，群内通量形状与总截面和背景截面之和成反比，即 $\\phi(E) \\propto 1/(\\sigma_t(E) + \\sigma_0)$，其中 $\\sigma_t(E)$ 是总截面，$\\sigma_0$ 是表征由其他核素和几何形状引起的自屏效应程度的背景截面。未分辨共振区在 $\\sigma_\\gamma$ 和 $\\sigma_t$ 之间表现出相关性，因为两者都由相同的共振结构决定；忽略这种相关性会导致将高的 $\\sigma_\\gamma$ 值与低 $\\sigma_t$ 值一起抽样，这会人为地提高通量权重，并使反应率产生偏差。\n\n从基本反应率定义和给定的通量正比关系出发，推导在保留相关性时能群内的适当的通量加权有效俘获截面，然后推导当 $\\sigma_\\gamma$ 独立于 $\\sigma_t$ 抽样（即忽略相关性）时的相应表达式。使用这些推导，针对给定的数值概率表，计算在几个 $\\sigma_0$ 值下的俘获反应率的相对偏差，该偏差定义为小数 $b = (\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} - \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}) / \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$。\n\n您必须编写一个完整、可运行的程序，该程序：\n- 实现单个未分辨能箱的双态概率表：\n  - 状态 1（“背景”）：概率 $p_1 = 0.9$，总截面 $\\sigma_{t,1} = 5$ 靶恩，俘获截面 $\\sigma_{\\gamma,1} = 0.2$ 靶恩。\n  - 状态 2（“共振”）：概率 $p_2 = 0.1$，总截面 $\\sigma_{t,2} = 100$ 靶恩，俘获截面 $\\sigma_{\\gamma,2} = 1.0$ 靶恩。\n- 使用 Bondarenko 自屏假设 $\\phi \\propto 1/(\\sigma_t + \\sigma_0)$ 作为群内通量加权的通量形状基础。\n- 当 $\\sigma_\\gamma$ 和 $\\sigma_t$ 之间的相关性被保留时（即，每个状态的 $\\sigma_\\gamma$ 与其自身的 $\\sigma_t$ 配对），计算 $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ 作为通量加权有效俘获截面。\n- 在假设 $\\sigma_\\gamma$ 独立于 $\\sigma_t$（即忽略相关性）的情况下计算 $\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$，然后计算如上定义的相对偏差 $b$。\n- 为以下背景截面（单位：靶恩）生成数值结果：$\\sigma_0 \\in \\{0, 0.01, 5, 100, 10^6\\}$。\n\n科学真实性要求：\n- 所有截面必须以靶恩为单位表示。\n- 偏差必须表示为小数（不带百分号）。\n- 您的推导必须从 $R_\\gamma = N \\int \\phi(E)\\sigma_\\gamma(E)\\,\\mathrm{d}E$ 和所述的通量正比关系开始，然后逻辑地推导出群有效公式。\n\n测试套件：\n- 使用上面给出的五个 $\\sigma_0$ 值来演示：\n  - 一个低 $\\sigma_0$ 的情况（例如 $\\sigma_0 = 0$ 和 $\\sigma_0 = 0.01$），此时偏差为大的正值（即，不相关处理会过高预测）。\n  - 中等 $\\sigma_0$（例如 $\\sigma_0 = 5$ 和 $\\sigma_0 = 100$），显示偏差减小。\n  - 一个非常大的 $\\sigma_0$（例如 $\\sigma_0 = 10^6$），显示当背景占主导地位并掩盖共振效应时，偏差按预期趋于 $0$。\n- 可量化的输出必须是浮点数：程序应计算并返回五个 $\\sigma_0$ 值对应的五个偏差 $b$ 的列表。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表形式的结果，并用方括号括起来（例如，$[b_1,b_2,b_3,b_4,b_5]$）。",
            "solution": "首先验证问题，确认其具有科学依据、提法明确且完整。唯一解所需的所有必要数据和定义均已提供。该物理模型基于核反应堆物理学中公认的标准原理，特别是针对未分辨共振区的概率表方法和 Bondarenko 自屏效应模型。\n\n目标是在两种不同的假设（相关和不相关截面）下推导通量加权有效俘获截面的表达式，并针对给定的双态概率表计算由此产生的相对偏差。\n\n起点是宽度为 $\\Delta E$ 的能群内俘获反应的反应率密度 $R_\\gamma$ 的定义：\n$$ R_\\gamma = N \\int_{\\Delta E} \\phi(E) \\sigma_\\gamma(E) \\, \\mathrm{d}E $$\n其中 $N$ 是核素数密度，$\\phi(E)$ 是中子通量谱，$\\sigma_\\gamma(E)$ 是微观俘获截面。群有效俘获截面 $\\sigma_{\\gamma, \\text{eff}}$ 的定义使得反应率可以表示为群平均通量 $\\bar{\\phi} = \\frac{1}{\\Delta E} \\int_{\\Delta E} \\phi(E) \\, \\mathrm{d}E$ 的形式。\n$$ R_\\gamma = N \\bar{\\phi} \\sigma_{\\gamma, \\text{eff}} \\Delta E $$\n通过令两个 $R_\\gamma$ 的表达式相等，我们得到了有效截面的形式化定义：\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\int_{\\Delta E} \\phi(E) \\sigma_\\gamma(E) \\, \\mathrm{d}E}{\\int_{\\Delta E} \\phi(E) \\, \\mathrm{d}E} = \\frac{\\langle \\phi \\sigma_\\gamma \\rangle}{\\langle \\phi \\rangle} $$\n其中尖括号表示在能群上的平均值。\n\n概率表方法将能量的连续函数 $\\sigma_t(E)$ 和 $\\sigma_\\gamma(E)$ 离散化为有限数量的状态，用索引 $i$ 表示。每个状态都有其在能群内发生的概率 $p_i$，以及相关的截面值 $\\sigma_{t,i}$ 和 $\\sigma_{\\gamma,i}$。积分被概率加权和所取代：\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\sum_i p_i \\phi_i \\sigma_{\\gamma,i}}{\\sum_j p_j \\phi_j} $$\n问题指定了 Bondarenko 自屏效应模型用于通量，其中群内通量形状被认为与总宏观截面成反比。对于单个核素，其微观等效形式为 $\\phi(E) \\propto 1/(\\sigma_t(E) + \\sigma_0)$，其中 $\\sigma_0$ 是代表所有其他材料的背景截面。因此，对于每个状态 $i$，通量权重因子为 $\\phi_i = C/(\\sigma_{t,i} + \\sigma_0)$，其中 $C$ 是一个比例常数，将从分子和分母中消去。\n$$ \\sigma_{\\gamma, \\text{eff}} = \\frac{\\sum_i p_i \\left( \\frac{C}{\\sigma_{t,i} + \\sigma_0} \\right) \\sigma_{\\gamma,i}}{\\sum_j p_j \\left( \\frac{C}{\\sigma_{t,j} + \\sigma_0} \\right)} = \\frac{\\sum_i p_i \\frac{\\sigma_{\\gamma,i}}{\\sigma_{t,i} + \\sigma_0}}{\\sum_j p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0}} $$\n这是用于后续推导的通用公式。\n\n给定的双态概率表为：\n状态 1：$p_1 = 0.9$, $\\sigma_{t,1} = 5$ 靶恩, $\\sigma_{\\gamma,1} = 0.2$ 靶恩。\n状态 2：$p_2 = 0.1$, $\\sigma_{t,2} = 100$ 靶恩, $\\sigma_{\\gamma,2} = 1.0$ 靶恩。\n\n要测试的背景截面为 $\\sigma_0 \\in \\{0, 0.01, 5, 100, 10^6\\}$ 靶恩。\n\n**情况1：相关有效截面 ($\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$)**\n在相关情况下，配对 $(\\sigma_{t,i}, \\sigma_{\\gamma,i})$ 是内在关联的。这是物理上正确的表示，因为两种截面都由相同的底层共振参数决定。我们直接将通用公式应用于给定的两个状态（$i=1, 2$）：\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = \\frac{p_1 \\frac{\\sigma_{\\gamma,1}}{\\sigma_{t,1} + \\sigma_0} + p_2 \\frac{\\sigma_{\\gamma,2}}{\\sigma_{t,2} + \\sigma_0}}{p_1 \\frac{1}{\\sigma_{t,1} + \\sigma_0} + p_2 \\frac{1}{\\sigma_{t,2} + \\sigma_0}} $$\n\n**情况2：不相关有效截面 ($\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$)**\n在不相关情况下，我们假设 $\\sigma_\\gamma$ 的值是独立于 $\\sigma_t$ 的值选择的。这意味着观察到特定配对 $(\\sigma_{t,j}, \\sigma_{\\gamma,k})$ 的联合概率是其边缘概率的乘积，$p(\\sigma_{t,j}) p(\\sigma_{\\gamma,k})$。在我们的模型中，$\\sigma_{t,j}$ 的边缘概率是 $p_j$，$\\sigma_{\\gamma,k}$ 的边缘概率是 $p_k$。有效截面的求和现在必须遍历所有 $2 \\times 2 = 4$ 个独立配对：\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\frac{\\sum_{j=1}^2 \\sum_{k=1}^2 p_j p_k \\frac{\\sigma_{\\gamma,k}}{\\sigma_{t,j} + \\sigma_0}}{\\sum_{j=1}^2 \\sum_{k=1}^2 p_j p_k \\frac{1}{\\sigma_{t,j} + \\sigma_0}} $$\n由于对 $j$ 和 $k$ 的求和是独立的，分子和分母可以进行因式分解：\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\frac{\\left( \\sum_{k=1}^2 p_k \\sigma_{\\gamma,k} \\right) \\left( \\sum_{j=1}^2 p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0} \\right)}{\\left( \\sum_{k=1}^2 p_k \\right) \\left( \\sum_{j=1}^2 p_j \\frac{1}{\\sigma_{t,j} + \\sigma_0} \\right)} $$\n由于 $\\sum_k p_k = p_1 + p_2 = 1$，表达式显著简化：\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = \\sum_{k=1}^2 p_k \\sigma_{\\gamma,k} = \\langle \\sigma_\\gamma \\rangle $$\n这表明，忽略相关性将有效俘获截面简化为其简单的概率加权平均值，即 $\\langle \\sigma_\\gamma \\rangle$，且与自屏效应无关。对于给定的数据：\n$$ \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} = p_1 \\sigma_{\\gamma,1} + p_2 \\sigma_{\\gamma,2} = (0.9)(0.2) + (0.1)(1.0) = 0.18 + 0.1 = 0.28 \\text{ 靶恩} $$\n这个值对于所有的 $\\sigma_0$ 都是恒定的。\n\n**相对偏差计算**\n相对偏差定义为 $b = (\\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}} - \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}) / \\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$。我们现在为每个给定的 $\\sigma_0$ 值计算 $\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ 和 $b$。\n\n对于 $\\sigma_0 = 0$ 靶恩：\n分子, $N = \\frac{(0.9)(0.2)}{5+0} + \\frac{(0.1)(1.0)}{100+0} = 0.036 + 0.001 = 0.037$\n分母, $D = \\frac{0.9}{5+0} + \\frac{0.1}{100+0} = 0.18 + 0.001 = 0.181$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D = 0.037 / 0.181 \\approx 0.20442$ 靶恩\n$b = (0.28 - 0.20442) / 0.20442 \\approx 0.36972$\n\n对于 $\\sigma_0 = 0.01$ 靶恩：\n$N = \\frac{0.18}{5.01} + \\frac{0.1}{100.01} \\approx 0.0359281 + 0.0009999 = 0.0369280$\n$D = \\frac{0.9}{5.01} + \\frac{0.1}{100.01} \\approx 0.1796407 + 0.0009999 = 0.1806406$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.204427$ 靶恩\n$b = (0.28 - 0.204427) / 0.204427 \\approx 0.36968$\n\n对于 $\\sigma_0 = 5$ 靶恩：\n$N = \\frac{0.18}{5+5} + \\frac{0.1}{100+5} = \\frac{0.18}{10} + \\frac{0.1}{105} = 0.018 + 0.00095238 \\approx 0.01895238$\n$D = \\frac{0.9}{10} + \\frac{0.1}{105} = 0.09 + 0.00095238 \\approx 0.09095238$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.208376$ 靶恩\n$b = (0.28 - 0.208376) / 0.208376 \\approx 0.34373$\n\n对于 $\\sigma_0 = 100$ 靶恩：\n$N = \\frac{0.18}{5+100} + \\frac{0.1}{100+100} = \\frac{0.18}{105} + \\frac{0.1}{200} \\approx 0.00171429 + 0.0005 = 0.00221429$\n$D = \\frac{0.9}{105} + \\frac{0.1}{200} \\approx 0.00857143 + 0.0005 = 0.00907143$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.244094$ 靶恩\n$b = (0.28 - 0.244094) / 0.244094 \\approx 0.14710$\n\n对于 $\\sigma_0 = 10^6$ 靶恩：\n在极限 $\\sigma_0 \\to \\infty$ 时，通量权重因子 $1/(\\sigma_{t,i} + \\sigma_0)$ 对于所有状态 $i$ 都变得相等。$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}}$ 表达式的分母变为 $\\frac{1}{\\sigma_0} (p_1+p_2)$，分子变为 $\\frac{1}{\\sigma_0} (p_1 \\sigma_{\\gamma,1}+p_2 \\sigma_{\\gamma,2})$。因此，$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} \\to \\langle \\sigma_\\gamma \\rangle = \\sigma_{\\gamma,\\text{eff}}^{\\text{uncorr}}$，且偏差 $b \\to 0$。\n$N = \\frac{0.18}{1000005} + \\frac{0.1}{1000100} \\approx 1.79991 \\times 10^{-7} + 9.9990 \\times 10^{-8} \\approx 2.79981 \\times 10^{-7}$\n$D = \\frac{0.9}{1000005} + \\frac{0.1}{1000100} \\approx 8.99955 \\times 10^{-7} + 9.9990 \\times 10^{-8} \\approx 9.99945 \\times 10^{-7}$\n$\\sigma_{\\gamma,\\text{eff}}^{\\text{corr}} = N/D \\approx 0.279994$ 靶恩\n$b = (0.28 - 0.279994) / 0.279994 \\approx 0.0000214$\n\n物理释义是：对于低 $\\sigma_0$（高自屏效应），在高截面共振态（状态 2）中，通量被严重压低。由于俘获截面在此状态下也最高，正确的相关计算正确地考虑了这种通量压低，从而产生较低的有效俘获率。不相关模型未能做到这一点，它将状态 2 的高俘获截面与一个受压低程度较小的通量进行平均，导致显著的过高预测（大的正偏差）。随着 $\\sigma_0$ 的增加，外部背景截面在总截面中占主导地位，通量变得更平坦（$\\phi(E) \\approx \\text{const.}$），自屏效应减弱，两种模型收敛到相同的结果，导致偏差趋于零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs a two-state probability table for an unresolved resonance region,\n    derives and calculates effective capture cross sections with and without\n    correlation, and computes the fractional bias for several background\n    cross sections.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # The probability table consists of two states for a single energy group.\n    # State 1 (\"background\")\n    p1 = 0.9\n    sigma_t1 = 5.0  # barns\n    sigma_g1 = 0.2  # barns\n\n    # State 2 (\"resonance\")\n    p2 = 0.1\n    sigma_t2 = 100.0 # barns\n    sigma_g2 = 1.0   # barns\n\n    # Background cross sections to test (in barns)\n    sigma_0_values = [0.0, 0.01, 5.0, 100.0, 1e6]\n\n    results = []\n\n    # Calculate the uncorrelated effective capture cross section.\n    # This is the simple probability-weighted average, constant for all sigma_0.\n    sigma_g_eff_uncorr = p1 * sigma_g1 + p2 * sigma_g2\n\n    # Loop over each background cross section value to calculate the bias.\n    for sigma_0 in sigma_0_values:\n        # Calculate the correlated effective capture cross section.\n        num_corr = (p1 * sigma_g1 / (sigma_t1 + sigma_0)) + (p2 * sigma_g2 / (sigma_t2 + sigma_0))\n        den_corr = (p1 / (sigma_t1 + sigma_0)) + (p2 / (sigma_t2 + sigma_0))\n        \n        # Avoid division by zero if denominator is zero (not possible here but good practice).\n        if den_corr == 0:\n            sigma_g_eff_corr = sigma_g_eff_uncorr # Fallback to infinite dilution\n        else:\n            sigma_g_eff_corr = num_corr / den_corr\n\n        # Calculate the fractional bias.\n        # Avoid division by zero if the correlated XS is zero.\n        if sigma_g_eff_corr == 0:\n            bias = float('inf') if sigma_g_eff_uncorr != 0 else 0.0\n        else:\n            bias = (sigma_g_eff_uncorr - sigma_g_eff_corr) / sigma_g_eff_corr\n        \n        results.append(bias)\n\n    # Print the results in the required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实际的多群计算中，我们需要在离散的能量点之间对概率表进行插值，而插值方法的选择会影响计算的准确性。本练习将引导您比较两种不同的插值方案——能量空间插值与概率空间插值——并评估它们在不同自屏条件下对群平均截面计算结果的影响 。通过这个练习，您将能更好地理解在实际应用中处理概率表能量依赖性时所面临的挑战和权衡。",
            "id": "4242816",
            "problem": "给定一个简化的、但物理上一致的模型问题，用于量化和比较两种插值方案应用于核反应堆模拟中未分辨共振区（URR）概率表时的效果。目标是计算群平均俘获截面，并评估不同插值策略对结果的影响。\n\n基本原理。使用以下与URR相关的基本假设和经过充分检验的近似：\n- 窄共振自屏近似：在每个概率表区间内，标量中子通量与总截面和一个能谱无关的背景（或稀释）截面之和成反比。具体来说，对于区间索引 $j$，通量权重意味着 $\\phi_j \\propto 1/(\\sigma_{t,j} + \\sigma_0)$，其中 $\\sigma_{t,j}$ 是区间 $j$ 内的总截面，$\\sigma_0$ 是背景截面。\n- 在给定能量下的有效俘获截面是使用上述通量权重对概率表各区间进行平均的俘获截面。\n- 在能量区间上的群平均截面是使用规定的能谱形状 $w(E)$ 进行能量上的通量加权平均。\n\n设置。考虑一个由 $E_1 = 20\\,\\text{keV}$ 和 $E_2 = 40\\,\\text{keV}$ 界定的单能群。对于两个列表能量 $E_1$ 和 $E_2$，给定含有 $N = 5$ 个等概率区间的概率表，其概率为 $w_j = 0.2$ ($j \\in \\{1,2,3,4,5\\}$)。每个区间包含一个总截面和一个俘获截面，单位均为靶（barns）。数据如下：\n- 在 $E_1$ 处：$\\sigma_{t}^{(1)} = [8.0, 12.0, 20.0, 60.0, 150.0]$ 且 $\\sigma_{c}^{(1)} = [0.2, 0.5, 1.5, 6.0, 20.0]$。\n- 在 $E_2$ 处：$\\sigma_{t}^{(2)} = [6.0, 9.0, 15.0, 40.0, 100.0]$ 且 $\\sigma_{c}^{(2)} = [0.15, 0.35, 1.0, 4.0, 13.0]$。\n\n定义两种插值方案来计算群内的有效俘获截面：\n1. 能量线性后平均插值（方法A）。使用概率表和背景截面 $\\sigma_0$ 计算 $E_1$ 和 $E_2$ 处的自屏有效俘获截面。然后，对于任意 $E \\in [E_1,E_2]$，对这些有效俘获截面进行能量线性插值：$\\sigma_{c,\\mathrm{eff}}^{A}(E)$ 定义为连接两端点有效值的关于 $E$ 的线性函数。\n2. 概率空间预平均插值（方法B）。对于每个区间 $j$，在目标能量 $E$ 处，对 $E_1$ 和 $E_2$ 之间的区间总截面和俘获截面进行线性插值。然后使用相同的自屏通量权重和 $\\sigma_0$ 计算有效俘获截面 $\\sigma_{c,\\mathrm{eff}}^{B}(E)$。\n\n对于群平均，使用形状函数 $w(E) = E^{-s}$ ($s \\ge 0$)，并按如下方式计算群平均俘获截面：\n$$\n\\langle \\sigma_c \\rangle = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}(E)\\, w(E)\\, dE}{\\int_{E_1}^{E_2} w(E)\\, dE}.\n$$\n\n任务。对于下方的每个测试用例，执行以下操作：\n- 使用方法 A 计算群平均俘获截面（单位：靶），记为 $\\langle \\sigma_c \\rangle_A$。\n- 使用方法 B 计算群平均俘获截面（单位：靶），记为 $\\langle \\sigma_c \\rangle_B$。\n- 计算相对差异（一个无量纲的小数），定义为\n$$\n\\delta = \\frac{|\\langle \\sigma_c \\rangle_B - \\langle \\sigma_c \\rangle_A|}{\\langle \\sigma_c \\rangle_B}.\n$$\n- 使用准则 $\\delta \\le \\tau$ (容差 $\\tau = 0.005$) 判断较简单的方法 A 是否可接受。\n\n所有能量积分必须以高精度进行数值计算。您必须使用具有足够点数的确定性求积方法来确保数值稳定性。背景截面 $\\sigma_0$ 的单位是靶（barns）。能量权重 $w(E)$ 使用的 $E$ 的单位是 $\\text{keV}$，最终的群平均俘获截面必须以靶（barns）表示。相对差异 $\\delta$ 必须表示为小数（而非百分比）。将报告的群平均俘获截面四舍五入到 $6$ 位小数，相对差异四舍五入到 $6$ 位小数。\n\n测试套件。使用以下5个测试用例，每个由 $(\\sigma_0, s)$ 指定：\n- 用例 1：$(10000.0, 1.0)$。\n- 用例 2：$(10.0, 1.0)$。\n- 用例 3：$(0.1, 1.0)$。\n- 用例 4：$(10.0, 0.0)$。\n- 用例 5：$(10.0, 2.0)$。\n\n输出规格。您的程序应生成单行输出，其中包含方括号括起来的、以逗号分隔的所有测试用例的结果列表。每个测试用例的结果必须是 $[\\langle \\sigma_c \\rangle_A,\\langle \\sigma_c \\rangle_B,\\delta,\\mathrm{flag}]$ 形式的四个元素的列表，其中如果 $\\delta \\le \\tau$，则 $\\mathrm{flag}$ 为整数 $1$，否则为 $0$。例如，总输出格式必须为\n$[[x_1,y_1,d_1,f_1],[x_2,y_2,d_2,f_2],\\dots]$\n其中所有 $x_i$ 和 $y_i$ 的单位为靶（barns），四舍五入到 $6$ 位小数，所有 $d_i$ 四舍五入到 $6$ 位小数，每个 $f_i$ 为一个整数。",
            "solution": "我们从未分辨共振区（URR）中使用概率表的自屏效应的基本定义开始。对于单个能量 $E$ 和背景截面 $\\sigma_0$，窄共振近似表明，区间 $j$ 中的标量通量与 $\\phi_j(E) \\propto 1/(\\sigma_{t,j}(E) + \\sigma_0)$ 成正比，其中 $\\sigma_{t,j}(E)$ 是该区间的总截面。给定一组区间概率 $\\{w_j\\}_{j=1}^N$ 且 $\\sum_j w_j = 1$，有效俘获截面由对各区间的通量加权平均定义：\n$$\n\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0) = \\frac{\\sum_{j=1}^N w_j \\, \\sigma_{c,j}(E)\\, \\frac{1}{\\sigma_{t,j}(E) + \\sigma_0}}{\\sum_{j=1}^N w_j \\, \\frac{1}{\\sigma_{t,j}(E) + \\sigma_0}}.\n$$\n该表达式源于反应率密度 $R_{c,j} \\propto \\sigma_{c,j}\\phi_j$ 的标准关系，并与稳态下的反应率平均保持一致。\n\n为了获得能量上的群平均俘获截面，我们采用能谱权重 $w(E) = E^{-s}$ ($s \\ge 0$)，并计算\n$$\n\\langle \\sigma_c \\rangle = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\n分母提供了正确的归一化，并因 $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ 的存在而将物理效应隔离在分子中。\n\n我们比较 $E_1$ 和 $E_2$ 之间的两种插值策略：\n\n- 方法A（能量线性后平均）。首先计算端点值：\n$$\n\\sigma_{c,\\mathrm{eff}}^{(1)} = \\sigma_{c,\\mathrm{eff}}(E_1;\\sigma_0), \\quad\n\\sigma_{c,\\mathrm{eff}}^{(2)} = \\sigma_{c,\\mathrm{eff}}(E_2;\\sigma_0).\n$$\n定义线性能量插值因子\n$$\n\\alpha(E) = \\frac{E_2 - E}{E_2 - E_1}.\n$$\n然后对于任意 $E \\in [E_1,E_2]$，定义\n$$\n\\sigma_{c,\\mathrm{eff}}^{A}(E) = \\alpha(E)\\, \\sigma_{c,\\mathrm{eff}}^{(1)} + \\left(1 - \\alpha(E)\\right)\\, \\sigma_{c,\\mathrm{eff}}^{(2)}.\n$$\n最后计算群平均值\n$$\n\\langle \\sigma_c \\rangle_A = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}^{A}(E)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\n\n- 方法B（概率空间预平均）。对于每个区间 $j$，对区间截面进行线性插值：\n$$\n\\sigma_{t,j}(E) = \\alpha(E)\\, \\sigma_{t,j}^{(1)} + \\left(1-\\alpha(E)\\right)\\, \\sigma_{t,j}^{(2)}, \\quad\n\\sigma_{c,j}(E) = \\alpha(E)\\, \\sigma_{c,j}^{(1)} + \\left(1-\\alpha(E)\\right)\\, \\sigma_{c,j}^{(2)}.\n$$\n将这些值代入自屏表达式以获得 $\\sigma_{c,\\mathrm{eff}}^{B}(E) = \\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$，然后计算\n$$\n\\langle \\sigma_c \\rangle_B = \\frac{\\int_{E_1}^{E_2} \\sigma_{c,\\mathrm{eff}}^{B}(E)\\, E^{-s}\\, dE}{\\int_{E_1}^{E_2} E^{-s}\\, dE}.\n$$\n\n插值选择的影响由相对差异量化\n$$\n\\delta = \\frac{\\left|\\langle \\sigma_c \\rangle_B - \\langle \\sigma_c \\rangle_A\\right|}{\\langle \\sigma_c \\rangle_B}.\n$$\n当 $\\delta \\le \\tau$ (容差 $\\tau = 0.005$) 时，我们接受方法 A，否则需要使用方法 B。\n\n算法设计。我们实现以下步骤：\n- 用数组 $\\{\\sigma_{t,j}^{(1)}\\}_{j=1}^N$、$\\{\\sigma_{c,j}^{(1)}\\}_{j=1}^N$、$\\{\\sigma_{t,j}^{(2)}\\}_{j=1}^N$、$\\{\\sigma_{c,j}^{(2)}\\}_{j=1}^N$ 和权重 $w_j = 1/N$ 表示 $E_1$ 和 $E_2$ 处的概率表。\n- 提供一个函数，根据上述通量加权有理表达式从区间截面和 $\\sigma_0$ 计算 $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$。这是窄共振近似的核心实现。\n- 对于方法 A，一次性计算 $\\sigma_{c,\\mathrm{eff}}^{(1)}$ 和 $\\sigma_{c,\\mathrm{eff}}^{(2)}$，然后使用 $\\alpha(E)$ 将 $\\sigma_{c,\\mathrm{eff}}^{A}(E)$ 定义为 $E$ 的线性函数。\n- 对于方法 B，在每个求积横坐标 $E$ 处，计算区间插值后的 $\\sigma_{t,j}(E)$ 和 $\\sigma_{c,j}(E)$，然后直接从相同的通量加权公式计算 $\\sigma_{c,\\mathrm{eff}}^{B}(E)$。\n- 使用高阶高斯求积法在 $[E_1,E_2]$ 上执行能量积分。设 $\\{x_q, w_q\\}_{q=1}^Q$ 是映射到 $[E_1,E_2]$ 上的横坐标和权重，则近似为\n$$\n\\int_{E_1}^{E_2} f(E)\\, dE \\approx \\sum_{q=1}^Q f(x_q)\\, w_q.\n$$\n我们使用足够大的 $Q$ 以确保在所有测试用例中的数值稳定性。\n- 对于每个测试用例 $(\\sigma_0, s)$，评估 $\\langle \\sigma_c \\rangle_A$ 和 $\\langle \\sigma_c \\rangle_B$，计算 $\\delta$，并判断方法 A 的可接受性。\n- 将 $\\langle \\sigma_c \\rangle_A$ 和 $\\langle \\sigma_c \\rangle_B$ 四舍五入到 $6$ 位小数（单位：靶），将 $\\delta$ 四舍五入到 $6$ 位小数。如果 $\\delta \\le 0.005$，可接受性标志为整数 $1$，否则为 $0$。\n\n为何以及何时每种方法是可接受的。如果背景截面 $\\sigma_0 \\to \\infty$（无限稀释），则通量权重变得与区间无关，因为\n$$\n\\frac{1}{\\sigma_{t,j}(E) + \\sigma_0} \\approx \\frac{1}{\\sigma_0} \\quad \\text{for all } j,\n$$\n有效俘获截面简化为 $\\sigma_{c,j}(E)$ 的概率加权算术平均值。在该极限下，线性特性确保了两种插值顺序是等效的，从而得到 $\\delta \\to 0$。更一般地，当 $\\sigma_{t,j}(E)$ 和 $\\sigma_{c,j}(E)$ 在群内随 $E$ 近似线性变化，且自屏扭曲较弱（中到大的 $\\sigma_0$）时，$\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ 近似为 $E$ 的线性函数，此时方法 A 是可接受的。相反，对于小的 $\\sigma_0$（强自屏效应），通量权重对 $\\sigma_{t,j}(E)$ 的非线性依赖导致 $\\sigma_{c,\\mathrm{eff}}(E;\\sigma_0)$ 成为 $E$ 的非线性函数。在这种情况下，在概率空间中进行预平均（方法 B）保留了区间分辨的非线性，并产生更准确的群平均值，而方法 A 的偏差可能会超出容差。\n\n程序实现了这些原理，评估了指定的测试套件，并打印出所需的列表\n$$\n\\big[\\,[\\langle \\sigma_c \\rangle_A,\\langle \\sigma_c \\rangle_B,\\delta,\\mathrm{flag}],\\dots\\big]\n$$\n截面单位为靶（barns），并按要求进行了四舍五入。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef compute_sigma_c_eff(sig_t, sig_c, probs, sigma0):\n    \"\"\"\n    Compute effective capture cross section with narrow resonance self-shielding:\n    sigma_c_eff = sum_j w_j * sigma_c_j / (sigma_t_j + sigma0) / sum_j w_j / (sigma_t_j + sigma0)\n    All inputs are 1D numpy arrays.\n    \"\"\"\n    inv_denom = 1.0 / (sig_t + sigma0)\n    num = np.sum(probs * sig_c * inv_denom)\n    den = np.sum(probs * inv_denom)\n    return num / den\n\ndef group_average_sigma(method, E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200):\n    \"\"\"\n    Compute group-averaged capture cross section for a given method over [E1,E2] with weight w(E)=E^{-s}.\n    method: 'A' or 'B'\n    \"\"\"\n    # Quadrature setup on [E1,E2]\n    # Use Gauss-Legendre nodes on [-1,1] mapped to [E1,E2]\n    xi, wi = leggauss(quad_n)\n    # Map to [E1, E2]\n    Emid = 0.5 * (E1 + E2)\n    Ehalf = 0.5 * (E2 - E1)\n    Es = Emid + Ehalf * xi  # energies\n    dE = Ehalf * wi         # differential weights\n\n    # Precompute endpoint effective values for method A\n    if method == 'A':\n        eff1 = compute_sigma_c_eff(sig_t1, sig_c1, probs, sigma0)\n        eff2 = compute_sigma_c_eff(sig_t2, sig_c2, probs, sigma0)\n\n    num = 0.0\n    den = 0.0\n    for E, wE in zip(Es, dE):\n        weight_E = (E ** (-s))  # spectral weight\n        if method == 'A':\n            alpha = (E2 - E) / (E2 - E1)\n            sigma_eff = alpha * eff1 + (1.0 - alpha) * eff2\n        elif method == 'B':\n            alpha = (E2 - E) / (E2 - E1)\n            sig_tE = alpha * sig_t1 + (1.0 - alpha) * sig_t2\n            sig_cE = alpha * sig_c1 + (1.0 - alpha) * sig_c2\n            sigma_eff = compute_sigma_c_eff(sig_tE, sig_cE, probs, sigma0)\n        else:\n            raise ValueError(\"Unknown method\")\n        num += sigma_eff * weight_E * wE\n        den += weight_E * wE\n\n    return num / den\n\ndef solve():\n    # Energy bounds in keV\n    E1 = 20.0\n    E2 = 40.0\n\n    # Probability table with N=5 equiprobable bins\n    probs = np.array([0.2, 0.2, 0.2, 0.2, 0.2], dtype=float)\n\n    # Cross sections at E1 (barns)\n    sig_t1 = np.array([8.0, 12.0, 20.0, 60.0, 150.0], dtype=float)\n    sig_c1 = np.array([0.2, 0.5, 1.5, 6.0, 20.0], dtype=float)\n\n    # Cross sections at E2 (barns)\n    sig_t2 = np.array([6.0, 9.0, 15.0, 40.0, 100.0], dtype=float)\n    sig_c2 = np.array([0.15, 0.35, 1.0, 4.0, 13.0], dtype=float)\n\n    # Test suite: (sigma0, s)\n    test_cases = [\n        (10000.0, 1.0),\n        (10.0, 1.0),\n        (0.1, 1.0),\n        (10.0, 0.0),\n        (10.0, 2.0),\n    ]\n\n    tau = 0.005  # tolerance for acceptability\n\n    results_str = []\n    for sigma0, s in test_cases:\n        # Group averages for both methods\n        gA = group_average_sigma('A', E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200)\n        gB = group_average_sigma('B', E1, E2, s, sigma0, probs, sig_t1, sig_c1, sig_t2, sig_c2, quad_n=200)\n        # Relative difference\n        rel = abs(gB - gA) / gB if gB != 0.0 else 0.0\n        flag = 1 if rel = tau else 0\n        # Format with required rounding\n        results_str.append(f\"[{gA:.6f},{gB:.6f},{rel:.6f},{flag}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        }
    ]
}