{
    "hands_on_practices": [
        {
            "introduction": "理论联系实践的第一步是亲手实现数值方法。本练习将指导您在一维平板几何中实现简单角平衡 (SCB) 方法，这是一个理想的起点。更重要的是，本练习旨在验证一个核心物理原则：在光学厚、散射占主导的区域，输运理论应渐近过渡到更简单的扩散理论。通过将您的 SCB 计算结果与扩散方程的解析解进行比较，您将亲身体验这一关键的输运-扩散对应关系，这是验证任何输运程序有效性的基本测试 。",
            "id": "4248673",
            "problem": "考虑一维平板中的稳态单能中子输运问题，该平板长度为 $L$，具有各向同性散射和各向同性内部源。未知角通量为 $ \\psi(x,\\mu) $，其中位置 $ x \\in [0,L] $，方向余弦 $ \\mu \\in [-1,1] $。标量通量为 $ \\phi(x) = \\frac{1}{2} \\int_{-1}^{1} \\psi(x,\\mu) \\,\\mathrm{d}\\mu $。其基本物理定律是稳态中子输运方程\n$$\n\\mu \\frac{\\mathrm{d} \\psi(x,\\mu)}{\\mathrm{d}x} + \\sigma_t \\psi(x,\\mu) = \\frac{\\sigma_s}{2} \\phi(x) + \\frac{Q}{2},\n$$\n其中 $ \\sigma_t $ 是总宏观截面，$ \\sigma_s $ 是散射宏观截面，$ Q $ 是各向同性体积源。施加真空边界条件：对于 $ \\mu > 0 $，在 $ x=0 $ 处的入射角通量为零；对于 $ \\mu  0 $，在 $ x=L $ 处的入射角通量为零。\n\n需要实现的数值方法是专用于一维的简单角点平衡（Simple Corner Balance, SCB）方法。SCB 方法是一种有限体积平衡格式，它通过在具有分段常数截面和源的每个网格单元上追踪特征线来强制实现角点平衡，并使用迎风格式的界面值来保证正定性和守恒性。您的程序必须实现与上述输运方程和所述边界条件一致的一维SCB方法，并使用具有 $ N = 4 $ 个角方向的对称离散纵标求积（记为区间 $ [-1,1] $ 上的 $ S_4 $ 高斯-勒让德求积）。\n\n为了验证 SCB 的扩散极限，请使用以下扩散标度变换：引入一个小参数 $ \\epsilon > 0 $ 并设置\n$$\n\\sigma_t = \\hat{\\sigma}_t,\\quad \\sigma_a = \\hat{\\sigma}_a \\epsilon^2,\\quad \\sigma_s = \\sigma_t - \\sigma_a,\\quad Q = \\hat{Q}\\,\\epsilon^2,\n$$\n其中 $ \\sigma_a $ 是吸收宏观截面，$ \\hat{\\sigma}_t > 0 $、$ \\hat{\\sigma}_a \\ge 0 $ 和 $ \\hat{Q} \\ge 0 $ 是不依赖于 $ \\epsilon $ 的固定参考值。在此标度变换下，当 $ \\epsilon \\to 0 $ 时的扩散极限由单能扩散方程描述\n$$\n- D \\frac{\\mathrm{d}^2 \\phi(x)}{\\mathrm{d}x^2} + \\sigma_a \\phi(x) = Q,\n$$\n其中扩散系数为 $ D = \\frac{1}{3 \\sigma_t} $。使用 Marshak 条件施加扩散形式的真空边界条件：\n$$\n\\phi(0) + 2 D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(0) = 0, \\quad \\phi(L) - 2 D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(L) = 0.\n$$\n这些边界条件引入了 $ 2 D $ 的外推长度。\n\n构建一个数值实验，以评估在上述定义的扩散标度变换下，SCB 输运解向扩散解的收敛性。在 $ [0,L] $ 上使用包含 $ N_x $ 个网格单元的均匀空间网格，截面和源为分段常数。对于每个测试用例，计算：\n- 在网格中心 $ x_i $ 处的 SCB 输运标量通量 $ \\phi_i^{\\mathrm{SCB}} $，其中 $ i = 1,2,\\dots,N_x $。\n- 在相同网格中心处的解析扩散标量通量 $ \\phi^{\\mathrm{diff}}(x_i) $，该解通过求解带有 Marshak 边界条件的常系数扩散方程得到。\n- 相对差异，通过网格上的离散 $ L^2 $ 范数来衡量，\n$$\nE = \\sqrt{\\frac{\\sum_{i=1}^{N_x} \\left( \\phi_i^{\\mathrm{SCB}} - \\phi^{\\mathrm{diff}}(x_i) \\right)^2 \\Delta x}{\\sum_{i=1}^{N_x} \\left( \\phi^{\\mathrm{diff}}(x_i) \\right)^2 \\Delta x}},\n$$\n其中 $ \\Delta x = L / N_x $。\n\n参数和单位：\n- 设 $ L = 1 $ (米)，$ \\hat{\\sigma}_t = 1 \\,\\mathrm{m}^{-1} $，$ \\hat{\\sigma}_a = 1 \\,\\mathrm{m}^{-1} $，$ \\hat{Q} = 1 \\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1} $。程序将报告无量纲的相对误差 $ E $；输出中不应打印任何物理单位。\n- 对方向 $ \\mu $ 使用区间 $ [-1,1] $ 上的 $ S_4 $ 对称高斯-勒让德求积，其权重 $ w $ 满足 $ \\sum w = 2 $。\n\n测试套件：\n- 用例 1 (一般情况): $ \\epsilon = 0.5 $, $ N_x = 40 $.\n- 用例 2 (较厚体系): $ \\epsilon = 0.25 $, $ N_x = 40 $.\n- 用例 3 (更具扩散性): $ \\epsilon = 0.125 $, $ N_x = 40 $.\n- 用例 4 (边缘情况，粗网格): $ \\epsilon = 0.125 $, $ N_x = 10 $.\n- 用例 5 (边缘情况，细网格): $ \\epsilon = 0.125 $, $ N_x = 80 $.\n\n您的程序必须：\n- 实现针对给定标度变换、边界条件和求积的输运方程的 SCB 方法。\n- 计算带有 Marshak 边界条件的常系数问题的解析扩散解。\n- 为每个测试用例评估相对误差 $ E $。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，\"[result1,result2,result3,result4,result5]\"），其中每个条目是对应测试用例的浮点值 $ E $，顺序与上面列出的一致。不应打印任何其他文本。角度通过方向余弦隐式地以弧度度量，但报告的值是无量纲的相对误差。",
            "solution": "该问题被评估为有效，因为它具有科学依据、良定、客观，并包含获得唯一解所需的所有必要信息。该良定问题要求实现用于一维、稳态、单能中子输运方程的简单角点平衡（SCB）数值方法，并将其与指定扩散极限下的解析扩散理论解进行比较。\n\n基本物理定律是中子输运方程：\n$$\n\\mu \\frac{\\mathrm{d} \\psi(x,\\mu)}{\\mathrm{d}x} + \\sigma_t \\psi(x,\\mu) = S(x)\n$$\n其中总源项 $S(x)$ 由下式给出\n$$\nS(x) = \\frac{\\sigma_s}{2} \\phi(x) + \\frac{Q}{2}\n$$\n标量通量 $\\phi(x)$ 是角通量 $\\psi(x, \\mu)$ 的角度积分。该问题定义在长度为 $L$ 且具有真空边界条件的平板上。\n\n求解过程分为三个部分：\n1. 推导相应扩散方程的解析解。\n2. 构建并实现用于输运方程的简单角点平衡（SCB）数值格式。\n3. 计算指定测试用例中数值输运解与解析扩散解之间的相对误差。\n\n**1. 解析扩散解**\n\n在指定的扩散标度变换中，其中 $\\sigma_t = \\hat{\\sigma}_t$，$\\sigma_a = \\hat{\\sigma}_a \\epsilon^2$，且 $Q = \\hat{Q}\\,\\epsilon^2$，对于小的 $\\epsilon$，输运方程渐近地趋近于单能扩散方程：\n$$\n- D \\frac{\\mathrm{d}^2 \\phi(x)}{\\mathrm{d}x^2} + \\sigma_a \\phi(x) = Q\n$$\n扩散系数为 $D = 1/(3\\sigma_t)$。对于给定的常数参数 $L=1$，$\\hat{\\sigma}_t=1$，$\\hat{\\sigma}_a=1$ 和 $\\hat{Q}=1$，扩散参数变为：\n$$\n\\sigma_t = 1, \\quad \\sigma_a = \\epsilon^2, \\quad Q = \\epsilon^2, \\quad D = \\frac{1}{3}\n$$\n该扩散方程是一个常系数二阶线性常微分方程。其通解是齐次解和特解之和。特解为 $\\phi_p(x) = Q/\\sigma_a = \\epsilon^2/\\epsilon^2 = 1$。齐次方程为 $-D \\frac{\\mathrm{d}^2 \\phi_h}{\\mathrm{d}x^2} + \\sigma_a \\phi_h = 0$，可重写为 $\\frac{\\mathrm{d}^2 \\phi_h}{\\mathrm{d}x^2} - \\frac{\\phi_h}{L_d^2} = 0$，其中 $L_d = \\sqrt{D/\\sigma_a} = \\sqrt{(1/3)/\\epsilon^2} = 1/(\\sqrt{3}\\epsilon)$ 是扩散长度。\n\n因此，通解为：\n$$\n\\phi(x) = A e^{-x/L_d} + B e^{x/L_d} + 1\n$$\n积分常数 $A$ 和 $B$ 通过应用 Marshak 边界条件来确定：\n1. 在 $x=0$ 处：$\\phi(0) + 2D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(0) = 0$\n2. 在 $x=L$ 处：$\\phi(L) - 2D \\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(L) = 0$\n\n通量的导数为 $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}x}(x) = -\\frac{A}{L_d} e^{-x/L_d} + \\frac{B}{L_d} e^{x/L_d}$。代入边界条件，得到一个关于 $A$ 和 $B$ 的 $2 \\times 2$ 线性系统：\n$$\n\\begin{pmatrix}\n1 - \\frac{2D}{L_d}  1 + \\frac{2D}{L_d} \\\\\n(1 + \\frac{2D}{L_d})e^{-L/L_d}  (1 - \\frac{2D}{L_d})e^{L/L_d}\n\\end{pmatrix}\n\\begin{pmatrix}\nA \\\\\nB\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-1 \\\\\n-1\n\\end{pmatrix}\n$$\n对每个给定的 $\\epsilon$ 求解该线性系统以得到 $A$ 和 $B$，从而获得完整的解析扩散解 $\\phi^{\\mathrm{diff}}(x)$。\n\n**2. 简单角点平衡（SCB）数值解**\n\nSCB 方法是应用于输运方程的一种有限体积格式。区域 $[0, L]$ 被离散为 $N_x$ 个宽度为 $\\Delta x = L/N_x$ 的均匀网格单元。角变量 $\\mu$ 使用 $S_4$ 对称高斯-勒让德求积组进行离散，得到 $N=4$ 个离散方向 $\\mu_m$ 和相应的权重 $w_m$。\n\n数值求解的核心是源迭代（Source Iteration, SI）方法，其过程如下：\n1.  初始化标量通量分布，例如，对所有网格单元 $i=1, \\dots, N_x$，设 $\\phi_i^{(0)} = 1$。\n2.  对于迭代 $k=0, 1, 2, \\dots$：\n    a. 基于上一步迭代的标量通量计算网格单元内的常数源项：$S_i^{(k+1/2)} = \\frac{\\sigma_s}{2} \\phi_i^{(k)} + \\frac{Q}{2}$。注意 $\\sigma_s = \\sigma_t - \\sigma_a = 1 - \\epsilon^2$。\n    b. 对每个离散方向 $\\mu_m$ 执行一次输运扫描，以计算更新后的网格平均角通量 $\\psi_{i,m}^{(k+1)}$。这里使用 SCB 方法，它在一维情况下等价于步进特征线法（Step Characteristics method）。该方法在假定源为常数的情况下，沿特征线追踪穿过每个网格单元。\n    \n    对于给定的方向 $\\mu_m$，离开一个网格单元的通量与入射通量和内部源相关。设 $\\psi_{in,m}$ 是网格单元 $i$ 的迎风面上的通量。网格单元的光学厚度为 $\\tau_{i,m} = \\sigma_t \\Delta x / |\\mu_m|$。出射面通量为：\n    $$\n    \\psi_{out,m} = \\psi_{in,m} e^{-\\tau_{i,m}} + \\frac{S_i^{(k+1/2)}}{\\sigma_t} (1 - e^{-\\tau_{i,m}})\n    $$\n    然后，使用通过在网格单元内沿特征线积分通量分布推导出的关系式，计算网格平均角通量 $\\psi_{i,m}^{(k+1)}$：\n    $$\n    \\psi_{i,m}^{(k+1)} = \\frac{S_i^{(k+1/2)}}{\\sigma_t} + \\left( \\psi_{in,m} - \\frac{S_i^{(k+1/2)}}{\\sigma_t} \\right) \\frac{1 - e^{-\\tau_{i,m}}}{\\tau_{i,m}}\n    $$\n    输运扫描沿着中子行进的方向遍历空间网格：\n    - 对于 $\\mu_m > 0$，扫描从左到右进行（$i=1, \\dots, N_x$）。左边界的入射通量为 $\\psi_{1/2, m} = 0$。\n    - 对于 $\\mu_m  0$，扫描从右到左进行（$i=N_x, \\dots, 1$）。右边界的入射通量为 $\\psi_{N_x+1/2, m} = 0$。\n\n    c. 在扫描完所有方向后，更新每个网格单元中的标量通量：\n    $$\n    \\phi_i^{(k+1)} = \\frac{1}{2} \\sum_{m=1}^{N} w_m \\psi_{i,m}^{(k+1)}\n    $$\n    因子 $1/2$ 来自定义式 $\\phi(x) = \\frac{1}{2} \\int_{-1}^1 \\psi(x, \\mu) d\\mu$。\n3. 检查收敛性。当连续标量通量迭代之间的相对差异小于某个容差时，迭代停止，即 $\\|\\phi^{(k+1)} - \\phi^{(k)}\\|_2 / \\|\\phi^{(k+1)}\\|_2  \\text{tol}$。\n\n**3. 误差计算**\n\n一旦 SCB 输运求解器收敛到解 $\\phi_i^{\\mathrm{SCB}}$，就将其与在相同网格中心 $x_i = (i-0.5)\\Delta x$ 处计算的解析扩散解 $\\phi^{\\mathrm{diff}}(x_i)$ 进行比较。相对差异使用离散 $L^2$ 范数来衡量：\n$$\nE = \\sqrt{\\frac{\\sum_{i=1}^{N_x} \\left( \\phi_i^{\\mathrm{SCB}} - \\phi^{\\mathrm{diff}}(x_i) \\right)^2}{\\sum_{i=1}^{N_x} \\left( \\phi^{\\mathrm{diff}}(x_i) \\right)^2}}\n$$\n对于均匀网格，分子和分母中的因子 $\\Delta x$ 会消掉。对问题描述中指定的每个测试用例都执行此计算。当 $\\epsilon \\to 0$ 时，我们预期 $E$ 会减小，这证实了在此极限下输运解收敛于扩散解。改变 $N_x$ 可以显示 SCB 方法的空间离散化误差对该比较的影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation for all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # (epsilon, Nx)\n        (0.5, 40),\n        (0.25, 40),\n        (0.125, 40),\n        (0.125, 10),\n        (0.125, 80),\n    ]\n\n    results = []\n    for epsilon, Nx in test_cases:\n        error = run_case(epsilon, Nx)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef run_case(epsilon, Nx):\n    \"\"\"\n    Runs a single test case for a given epsilon and Nx.\n    \n    Args:\n        epsilon (float): The diffusion scaling parameter.\n        Nx (int): The number of spatial cells.\n\n    Returns:\n        float: The relative L2 error between SCB and diffusion solutions.\n    \"\"\"\n    # Fixed parameters\n    L = 1.0\n    sigma_t_hat = 1.0\n    sigma_a_hat = 1.0\n    Q_hat = 1.0\n\n    # Scaled parameters\n    sigma_t = sigma_t_hat\n    sigma_a = sigma_a_hat * epsilon**2\n    sigma_s = sigma_t - sigma_a\n    Q_val = Q_hat * epsilon**2\n    D = 1.0 / (3.0 * sigma_t)\n\n    # Spatial mesh\n    dx = L / Nx\n    x_centers = np.linspace(dx / 2.0, L - dx / 2.0, Nx)\n\n    # 1. Compute analytical diffusion solution\n    phi_diff = get_diffusion_solution(L, D, sigma_a, Q_val, x_centers)\n\n    # 2. Compute SCB transport solution\n    phi_scb = get_scb_solution(L, Nx, sigma_t, sigma_s, Q_val)\n\n    # 3. Compute relative L2 error\n    norm_diff = np.linalg.norm(phi_diff)\n    if norm_diff == 0:\n        return np.linalg.norm(phi_scb - phi_diff)\n        \n    error = np.linalg.norm(phi_scb - phi_diff) / norm_diff\n    \n    return error\n\ndef get_diffusion_solution(L, D, sigma_a, Q_val, x_centers):\n    \"\"\"\n    Calculates the analytical solution to the 1D diffusion equation with Marshak BCs.\n    \"\"\"\n    if sigma_a == 0: # Purely scattering case\n        # Equation: -D * phi'' = Q. phi = -Q/(2D)*x^2 + C1*x + C2\n        # BCs: phi(0) + 2D*phi'(0) = 0, phi(L) - 2D*phi'(L) = 0\n        # phi'(x) = -Q/D * x + C1\n        # BC1 at x=0: C2 + 2D*C1 = 0 = C2 = -2*D*C1\n        # BC2 at x=L: -Q/(2D)*L^2 + C1*L + C2 - 2D*(-Q/D*L + C1) = 0\n        # -Q/(2D)*L^2 + C1*L - 2DC1 + 2QL - 2DC1 = 0\n        # C1*(L - 4D) = Q*L^2/(2D) - 2*Q*L\n        # C1 = (Q*L^2/(2D) - 2*Q*L) / (L-4*D)\n        C1 = (Q_val * L**2 / (2.0 * D) - 2.0 * Q_val * L) / (L - 4.0 * D)\n        C2 = -2.0 * D * C1\n        return -Q_val / (2.0 * D) * x_centers**2 + C1 * x_centers + C2\n\n    phi_p = Q_val / sigma_a\n    L_d = np.sqrt(D / sigma_a)\n    \n    # Setup the 2x2 linear system for coefficients A and B\n    # A * x = b, where x = [A, B]^T\n    alpha = 2.0 * D / L_d\n    exp_L_Ld = np.exp(L / L_d)\n    exp_neg_L_Ld = np.exp(-L / L_d)\n\n    mat_A = np.array([\n        [1.0 - alpha, 1.0 + alpha],\n        [(1.0 + alpha) * exp_neg_L_Ld, (1.0 - alpha) * exp_L_Ld]\n    ])\n    \n    vec_b = np.array([-phi_p, -phi_p])\n\n    try:\n        A, B = np.linalg.solve(mat_A, vec_b)\n    except np.linalg.LinAlgError:\n        # Fallback for ill-conditioned matrix\n        return np.full_like(x_centers, phi_p)\n\n    phi_analytic = A * np.exp(-x_centers / L_d) + B * np.exp(x_centers / L_d) + phi_p\n    return phi_analytic\n\ndef get_scb_solution(L, Nx, sigma_t, sigma_s, Q_val):\n    \"\"\"\n    Solves the 1D transport equation using the Simple Corner Balance (SCB) method.\n    \"\"\"\n    # S4 Gauss-Legendre quadrature set on [-1, 1]\n    # mu are nodes, w are weights. sum(w) = 2.\n    mu, w = np.polynomial.legendre.leggauss(4)\n    N = len(mu)\n\n    # Spatial discretization\n    dx = L / Nx\n    \n    # Source Iteration\n    phi = np.ones(Nx)  # Initial guess for scalar flux\n    max_iter = 20000\n    tol = 1.0e-12\n\n    for k in range(max_iter):\n        phi_old = np.copy(phi)\n        \n        # Calculate source term\n        S = (sigma_s / 2.0) * phi + (Q_val / 2.0)\n        \n        psi_cell = np.zeros((Nx, N))\n        S_over_sigt = S / sigma_t\n\n        for m in range(N):\n            tau_m = sigma_t * dx / abs(mu[m])\n            \n            # Robust calculation of (1 - exp(-tau)) / tau\n            if tau_m  1e-6:\n                f_tau = 1.0 - tau_m / 2.0 + tau_m**2 / 6.0\n            else:\n                f_tau = -np.expm1(-tau_m) / tau_m\n\n            exp_tau = np.exp(-tau_m)\n\n            if mu[m] > 0:\n                # Sweep from left to right\n                psi_face_in = 0.0  # Vacuum BC at x=0\n                for i in range(Nx):\n                    psi_cell[i, m] = S_over_sigt[i] \\\n                                   + (psi_face_in - S_over_sigt[i]) * f_tau\n                    psi_face_out = psi_face_in * exp_tau \\\n                                   + S_over_sigt[i] * (1.0 - exp_tau)\n                    psi_face_in = psi_face_out\n            else:  # mu[m]  0\n                # Sweep from right to left\n                psi_face_in = 0.0  # Vacuum BC at x=L\n                for i in range(Nx - 1, -1, -1):\n                    psi_cell[i, m] = S_over_sigt[i] \\\n                                   + (psi_face_in - S_over_sigt[i]) * f_tau\n                    psi_face_out = psi_face_in * exp_tau \\\n                                   + S_over_sigt[i] * (1.0 - exp_tau)\n                    psi_face_in = psi_face_out\n\n        # Update scalar flux\n        phi = 0.5 * np.sum(w * psi_cell, axis=1)\n        \n        # Check for convergence\n        norm_phi = np.linalg.norm(phi)\n        if norm_phi > 0:\n            rel_err = np.linalg.norm(phi - phi_old) / norm_phi\n            if rel_err  tol:\n                break\n    \n    return phi\n\nif __name__ == '__main__':\n    solve()\n```"
        },
        {
            "introduction": "在掌握了一维实现后，我们将进入更真实但也更复杂的二维情况。现实世界中的反应堆问题充满了不规则的几何形状，其材料界面很少能与我们规整的计算网格完美对齐。本练习模拟了这一挑战，要求您研究当材料不连续性与网格线错开时，SCB 方法的性能会受到何种影响 。通过将网格对齐和错开情况下的计算误差进行对比，您将深刻理解几何近似误差的来源及其对模拟精度的实际影响。",
            "id": "4248715",
            "problem": "考虑一个矩形域上的稳态、单能、二维中性粒子输运方程，该方程具有各向同性固定源和真空边界条件。设区域为单位正方形，坐标 $(x,y) \\in [0,1] \\times [0,1]$，离散化为一个由 $N_x \\times N_y$ 个矩形单元组成的均匀笛卡尔网格，单元宽度为 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。方向为 $\\boldsymbol{\\Omega} = (\\mu,\\eta)$ 且 $|\\boldsymbol{\\Omega}|=1$ 的角通量 $\\psi(x,y,\\boldsymbol{\\Omega})$ 的控制方程为\n$$\n\\boldsymbol{\\Omega} \\cdot \\nabla \\psi(x,y,\\boldsymbol{\\Omega}) + \\sigma_t(x,y)\\, \\psi(x,y,\\boldsymbol{\\Omega}) = q(x,y),\n$$\n其中 $\\sigma_t(x,y)$ 是总截面（单位为 $\\mathrm{cm}^{-1}$），$q(x,y)$ 是各向同性固定源（单位为 $\\mathrm{cm}^{-3}\\,\\mathrm{s}^{-1}$）。施加真空边界条件，意味着边界上所有入射的角通量均为零。\n\n在离散纵标法 (DOM) 中使用简单角点平衡 (SCB) 方法，并采用与基本对角线方向相对应的四个方向 $\\boldsymbol{\\Omega}_m$：\n- $\\boldsymbol{\\Omega}_1 = (\\mu,\\eta) = \\left(\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_2 = \\left(-\\frac{1}{\\sqrt{2}}, \\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_3 = \\left(\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}\\right)$,\n- $\\boldsymbol{\\Omega}_4 = \\left(-\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}\\right)$,\n求积权重相等，为 $w_m = \\frac{1}{4}$，$m=1,2,3,4$。\n\n在 SCB 方法中，单元离散化通过将角通量值与四个单元角点相关联来进行。对于每个方向 $\\boldsymbol{\\Omega}_m$，输运扫描以迎风顺序在每个单元内从一个角点推进到另一个角点。在具有常系数 $\\sigma_t$ 和 $q$ 的单元内，SCB 角点更新假定路径长度为\n$$\nL = \\frac{\\Delta x}{|\\mu|} + \\frac{\\Delta y}{|\\eta|},\n$$\n并通过求解沿特征线的一维常微分方程，从入射角点通量 $\\psi_{\\mathrm{in}}$ 近似计算出射角点通量 $\\psi_{\\mathrm{out}}$：\n$$\n\\frac{d\\psi}{ds} + \\sigma_t \\psi = q, \\quad s \\in [0,L],\n$$\n其解为\n$$\n\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\, e^{-\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - e^{-\\sigma_t L}\\right).\n$$\n在 SCB 方法中，单元平均角通量的近似值取为沿特征线的线平均值：\n$$\n\\overline{\\psi} = \\frac{1}{L}\\int_0^{L}\\left(\\psi_{\\mathrm{in}} e^{-\\sigma_t s} + \\frac{q}{\\sigma_t}\\left(1-e^{-\\sigma_t s}\\right)\\right) ds = \\psi_{\\mathrm{in}}\\, \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L}\\right).\n$$\n对于真空边界，区域边界上的所有入射角点通量均设为零。单元内的标量通量是单元平均角通量的求积加权和：\n$$\n\\phi = \\sum_{m=1}^4 w_m\\, \\overline{\\psi}_m.\n$$\n已知对于非负源 $q \\ge 0$ 和非负入射值，这种 SCB 方法是保正的。\n\n目标是构建并运行一组数值测试，其中材料不连续性与计算网格对齐或未对齐，并在这两种情况下，根据标量通量误差和正性比较 SCB 的性能。使用在加细网格上的高分辨率 SCB 解作为误差度量的参考（“真”）解。\n\n定义粗网格标量通量场 $\\phi^{\\mathrm{coarse}}_{i,j}$ 和块平均的精细参考标量通量 $\\phi^{\\mathrm{ref}}_{i,j}$ 之间的相对 $\\ell_2$ 误差为（其中精细网格是粗网格的整数加密）：\n$$\n\\varepsilon_{\\ell_2} = \\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{coarse}}_{i,j} - \\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}.\n$$\n同时记录正性指标，这是一个布尔值，用于断言是否对所有单元都成立 $\\phi^{\\mathrm{coarse}}_{i,j} \\ge 0$。\n\n测试套件。对于以下所有测试，精细参考网格使用 $N_x^{\\mathrm{fine}} = 200$ 和 $N_y^{\\mathrm{fine}} = 200$。粗网格和材料/源的设定如下：\n\n- 测试 1（对齐的不连续性，中等对比度）：$N_x = 20$, $N_y = 20$。当 $x  0.5$ 时，设 $\\sigma_t(x,y) = 1.0$ 且 $q(x,y) = 1.0$；当 $x \\ge 0.5$ 时，设 $\\sigma_t(x,y) = 5.0$ 且 $q(x,y) = 1.0$。\n\n- 测试 2（未对齐的不连续性，中等对比度）：$N_x = 20$, $N_y = 20$。当 $x  0.53$ 时，设 $\\sigma_t(x,y) = 1.0$ 且 $q(x,y) = 1.0$；当 $x \\ge 0.53$ 时，设 $\\sigma_t(x,y) = 5.0$ 且 $q(x,y) = 1.0$。\n\n- 测试 3（未对齐的不连续性，高对比度，更粗的网格）：$N_x = 10$, $N_y = 10$。当 $x  0.52$ 时，设 $\\sigma_t(x,y) = 0.5$ 且 $q(x,y) = 1.0$；当 $x \\ge 0.52$ 时，设 $\\sigma_t(x,y) = 20.0$ 且 $q(x,y) = 1.0$。\n\n- 测试 4（均匀介质基线）：$N_x = 20$, $N_y = 20$。在所有地方，设 $\\sigma_t(x,y) = 2.0$ 且 $q(x,y) = 1.0$。\n\n对于每个测试，使用指定的四个方向和真空边界条件实现 SCB 输运扫描，以计算粗网格标量通量；计算精细参考标量通量；将精细标量通量块平均到粗网格上；计算相对 $\\ell_2$ 误差 $\\varepsilon_{\\ell_2}$；并检查正性指标。\n\n最终输出格式。您的程序应生成单行输出，其中包含四个测试的结果，形式为方括号内的一个逗号分隔列表，每个测试的结果本身是一个 $[\\varepsilon_{\\ell_2}, \\text{positivity}]$ 形式的双元素列表。例如：\n$[[0.0123,True],[0.0456,True],[0.0789,True],[0.0012,True]]$。\n所有数值均为纯数字；输出中不包含任何物理单位。角度是无单位的方向余弦；不需要角度单位。",
            "solution": "该问题提出了粒子输运数值方法领域中一个明确定义的任务。它要求实现用于二维、稳态、单能输运问题的简单角点平衡 (SCB) 方法，并评估其在不同材料配置下的性能。该问题已经过验证，被认为是科学上合理、适定且客观的。\n\n### 基于原理的解决方案设计\n\n该解决方案涉及开发一个基于离散纵标法 ($S_N$) 和一种特定的空间离散格式——简单角点平衡 (SCB) 方法的数值模拟。总体目标是量化数值误差并验证 SCB 方法的正性，特别是在材料不连续性与计算网格对齐或未对齐的场景中。\n\n#### 1. 离散化与问题设置\n\n连续域 $(x,y) \\in [0,1] \\times [0,1]$ 被离散化为由 $N_x \\times N_y$ 个单元组成的均匀笛卡尔网格，每个单元的尺寸为 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。材料属性，即总截面 $\\sigma_t(x,y)$ 和源项 $q(x,y)$，被假定在每个单元内为常数。这些常数值通过在每个单元 $(i,j)$ 的中心（坐标为 $(x_c, y_c) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$，$i \\in \\{0, ..., N_x-1\\}$ 和 $j \\in \\{0, ..., N_y-1\\}$）处计算给定函数的值来确定。\n\n角域使用一个特定的离散纵标 ($S_N$) 求积组进行离散化，该求积组有四个方向 $\\boldsymbol{\\Omega}_m = (\\mu_m, \\eta_m)$ 和相应的权重 $w_m$。提供的集合包含四个对角线方向：\n- $\\boldsymbol{\\Omega}_1 = (1/\\sqrt{2}, 1/\\sqrt{2})$，权重 $w_1 = 1/4$\n- $\\boldsymbol{\\Omega}_2 = (-1/\\sqrt{2}, 1/\\sqrt{2})$，权重 $w_2 = 1/4$\n- $\\boldsymbol{\\Omega}_3 = (1/\\sqrt{2}, -1/\\sqrt{2})$，权重 $w_3 = 1/4$\n- $\\boldsymbol{\\Omega}_4 = (-1/\\sqrt{2}, -1/\\sqrt{2})$，权重 $w_4 = 1/4$\n\n对于这个集合，对所有 $m$ 都有 $|\\mu_m| = |\\eta_m| = 1/\\sqrt{2}$。\n\n#### 2. 输运扫描与简单角点平衡 (SCB)\n\n模拟的核心是输运扫描，这是一个迭代过程，用于求解整个空间网格上每个方向 $m$ 的角通量 $\\psi_m$。扫描按照粒子行进方向确定的顺序逐个单元进行，确保每个单元的流入边界条件可以从区域边界或先前计算的相邻单元中获知。\n\n对于一个方向 $\\boldsymbol{\\Omega}_m = (\\mu_m, \\eta_m)$，扫描进程如下：\n- 如果 $\\mu_m > 0$，则 $i$ 索引递增（从 $0$ 到 $N_x-1$）。\n- 如果 $\\mu_m  0$，则 $i$ 索引递减（从 $N_x-1$ 到 $0$）。\n- 如果 $\\eta_m > 0$，则 $j$ 索引递增（从 $0$ 到 $N_y-1$）。\n- 如果 $\\eta_m  0$，则 $j$ 索引递减（从 $N_y-1$ 到 $0$）。\n\n真空边界条件意味着任何进入区域的角通量都为零。这为扫描提供了起始值。角点通量 $\\psi_m$ 存储在一个尺寸为 $(N_x+1) \\times (N_y+1)$ 的顶点网格上。\n\n在每个单元 $(i,j)$ 和每个方向 $m$ 内，SCB 方法将单个入射角点通量 $\\psi_{\\mathrm{in}}$ 与单个出射角点通量 $\\psi_{\\mathrm{out}}$ 相关联。具体的角点取决于方向：\n- 对于 $\\boldsymbol{\\Omega}_1$ ($\\mu0, \\eta0$)：$\\psi_{\\mathrm{in}}$ 位于角点 $(i,j)$；$\\psi_{\\mathrm{out}}$ 位于角点 $(i+1,j+1)$。\n- 对于 $\\boldsymbol{\\Omega}_2$ ($\\mu0, \\eta0$)：$\\psi_{\\mathrm{in}}$ 位于角点 $(i+1,j)$；$\\psi_{\\mathrm{out}}$ 位于角点 $(i,j+1)$。\n- 对于 $\\boldsymbol{\\Omega}_3$ ($\\mu0, \\eta0$)：$\\psi_{\\mathrm{in}}$ 位于角点 $(i,j+1)$；$\\psi_{\\mathrm{out}}$ 位于角点 $(i+1,j)$。\n- 对于 $\\boldsymbol{\\Omega}_4$ ($\\mu0, \\eta0$)：$\\psi_{\\mathrm{in}}$ 位于角点 $(i+1,j+1)$；$\\psi_{\\mathrm{out}}$ 位于角点 $(i,j)$。\n\n更新是通过求解沿长度为 $L = \\frac{\\Delta x}{|\\mu_m|} + \\frac{\\Delta y}{|\\eta_m|}$ 的特征路径的一维输运方程得出的。这个特定（且简化的）路径长度是这里使用的 SCB 变体的一个定义性特征。其解给出出射通量：\n$$\n\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\, e^{-\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - e^{-\\sigma_t L}\\right)\n$$\n其中 $\\sigma_t$ 和 $q$ 是单元的常数属性。\n\n#### 3. 标量通量的计算\n\n计算出出射角点通量后，计算当前单元和方向的单元平均角通量 $\\overline{\\psi}_m$。这是通过沿同一特征路径对通量解进行平均得到的：\n$$\n\\overline{\\psi}_m = \\psi_{\\mathrm{in}}\\, \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L} + \\frac{q}{\\sigma_t}\\left(1 - \\frac{1 - e^{-\\sigma_t L}}{\\sigma_t L}\\right)\n$$\n为了在数值上处理 $\\sigma_t \\rightarrow 0$ 的情况，这些表达式可以使用 `expm1` 函数或针对小的 $\\sigma_t L$ 值的泰勒级数近似来实现。\n\n然后，通过将所有四个角方向的贡献（按求积权重加权）相加，得到总的单元平均标量通量 $\\phi_{i,j}$：\n$$\n\\phi_{i,j} = \\sum_{m=1}^4 w_m\\, \\overline{\\psi}_{m,i,j}\n$$\n对所有单元重复此过程，完成整个网格的标量通量场的计算。\n\n#### 4. 验证与误差分析\n\n该问题要求进行验证研究。使用相同的 SCB 方法在精细网格（$N_x^{\\mathrm{fine}} = 200, N_y^{\\mathrm{fine}} = 200$）上生成一个高分辨率的参考解。这个参考标量通量场 $\\phi^{\\mathrm{fine}}$ 在本分析中被视为“真”解。\n\n为了将粗网格解 $\\phi^{\\mathrm{coarse}}$ 与参考解进行比较，必须将精细网格解投影到粗网格上。这通过块平均来完成：粗参考网格中的每个单元 $\\phi^{\\mathrm{ref}}_{i,j}$ 的值被赋为其几何上包含的所有精细网格单元通量的算术平均值。\n\n然后，相对 $\\ell_2$ 误差范数计算如下：\n$$\n\\varepsilon_{\\ell_2} = \\frac{\\|\\phi^{\\mathrm{coarse}} - \\phi^{\\mathrm{ref}}\\|_2}{\\|\\phi^{\\mathrm{ref}}\\|_2} = \\frac{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{coarse}}_{i,j} - \\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}{\\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y}\\left(\\phi^{\\mathrm{ref}}_{i,j}\\right)^2\\right)^{1/2}}\n$$\n该度量量化了粗网格解与参考解之间的平均偏差。这些测试案例旨在突出显示当材料不连续性与网格的对齐方式不同时，此误差如何受到影响。当不连续性未对齐时，单个粗网格单元可能会跨越两个不同的材料区域。单元中心采样方案将一组属性赋给整个单元，引入了一种“涂抹”误差，预计会增加 $\\varepsilon_{\\ell_2}$。\n\n最后，进行正性检查以验证对所有单元 $(i,j)$ 是否都有 $\\phi^{\\mathrm{coarse}}_{i,j} \\ge 0$。具有非负源和流入条件的 SCB 方法本身是保正的，因此这可以作为对实现正确性的检查。\n\n整个算法通过一个利用 `numpy` 库进行高效数组操作的 Python 脚本实现。一个主函数负责协调执行四个指定的测试案例，每次都计算粗网格解及其对应的参考解，计算误差和正性，并最终按要求格式化结果。",
            "answer": "```python\nimport numpy as np\n\ndef run_scb_simulation(Nx, Ny, sigma_t_func, q_func):\n    \"\"\"\n    Executes a Simple Corner Balance (SCB) simulation on a grid.\n    \n    Args:\n        Nx (int): Number of cells in the x-direction.\n        Ny (int): Number of cells in the y-direction.\n        sigma_t_func (callable): Function sigma_t(x, y) returning the total cross-section.\n        q_func (callable): Function q(x, y) returning the isotropic source.\n\n    Returns:\n        numpy.ndarray: A (Nx, Ny) array of cell-averaged scalar fluxes.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n\n    # Cell-centered properties (using (i,j) for (x,y) indices)\n    sigma_t_cells = np.zeros((Nx, Ny))\n    q_cells = np.zeros((Nx, Ny))\n    for i in range(Nx):\n        for j in range(Ny):\n            x_c = (i + 0.5) * dx\n            y_c = (j + 0.5) * dy\n            sigma_t_cells[i, j] = sigma_t_func(x_c, y_c)\n            q_cells[i, j] = q_func(x_c, y_c)\n\n    # Angular directions and weights\n    sqrt2_inv = 1.0 / np.sqrt(2.0)\n    directions = [\n        (sqrt2_inv, sqrt2_inv),    # m=0: mu > 0, eta > 0\n        (-sqrt2_inv, sqrt2_inv),   # m=1: mu  0, eta > 0\n        (sqrt2_inv, -sqrt2_inv),  # m=2: mu > 0, eta  0\n        (-sqrt2_inv, -sqrt2_inv)  # m=3: mu  0, eta  0\n    ]\n    weights = [0.25, 0.25, 0.25, 0.25]\n\n    # Corner fluxes: 4 directions, (Nx+1) x (Ny+1) grid\n    psi_corners = np.zeros((4, Nx + 1, Ny + 1))\n    \n    # Cell-averaged scalar flux\n    phi_cells = np.zeros((Nx, Ny))\n    \n    TINY_VAL = 1e-9\n\n    for m, (mu, eta) in enumerate(directions):\n        w = weights[m]\n        \n        # Determine sweep ranges based on direction signs\n        i_range = range(Nx) if mu > 0 else range(Nx - 1, -1, -1)\n        j_range = range(Ny) if eta > 0 else range(Ny - 1, -1, -1)\n\n        for i in i_range:\n            for j in j_range:\n                sigma_t = sigma_t_cells[i, j]\n                q = q_cells[i, j]\n\n                # Identify incoming corner based on sweep direction\n                if m == 0:  # mu > 0, eta > 0\n                    psi_in = psi_corners[m, i, j]\n                elif m == 1:  # mu  0, eta > 0\n                    psi_in = psi_corners[m, i + 1, j]\n                elif m == 2:  # mu > 0, eta  0\n                    psi_in = psi_corners[m, i, j + 1]\n                else:  # m == 3, mu  0, eta  0\n                    psi_in = psi_corners[m, i + 1, j + 1]\n\n                # Path length as defined in the problem\n                L = dx / abs(mu) + dy / abs(eta)\n                sigma_L = sigma_t * L\n                \n                if sigma_t  TINY_VAL:\n                    # Taylor expansion for sigma_t -> 0\n                    psi_out = psi_in + q * L\n                    psi_avg = psi_in + q * L / 2.0\n                else:\n                    # Numerically stable formulation for update equations\n                    # exp_term = exp(-sigma_L)\n                    # 1 - exp_term = -expm1(-sigma_L)\n                    m_expm1_sl = -np.expm1(-sigma_L)\n                    psi_out = psi_in * (1.0 - m_expm1_sl) + (q / sigma_t) * m_expm1_sl\n                    \n                    # Cell-averaged angular flux\n                    avg_factor = m_expm1_sl / sigma_L\n                    psi_avg = psi_in * avg_factor + (q / sigma_t) * (1.0 - avg_factor)\n                \n                # Update outgoing corner\n                if m == 0:  # mu > 0, eta > 0\n                    psi_corners[m, i + 1, j + 1] = psi_out\n                elif m == 1:  # mu  0, eta > 0\n                    psi_corners[m, i, j + 1] = psi_out\n                elif m == 2:  # mu > 0, eta  0\n                    psi_corners[m, i + 1, j] = psi_out\n                else:  # m == 3, mu  0, eta  0\n                    psi_corners[m, i, j] = psi_out\n\n                phi_cells[i, j] += w * psi_avg\n                \n    return phi_cells\n\ndef block_average(phi_fine, Nx_coarse, Ny_coarse):\n    \"\"\" Averages a fine grid solution onto a coarse grid. \"\"\"\n    Nx_fine, Ny_fine = phi_fine.shape\n    ref_x = Nx_fine // Nx_coarse\n    ref_y = Ny_fine // Ny_coarse\n    \n    phi_ref_coarse = np.zeros((Nx_coarse, Ny_coarse))\n    for i in range(Nx_coarse):\n        for j in range(Ny_coarse):\n            block = phi_fine[i * ref_x : (i + 1) * ref_x,\n                             j * ref_y : (j + 1) * ref_y]\n            phi_ref_coarse[i, j] = np.mean(block)\n    return phi_ref_coarse\n\ndef solve():\n    \"\"\"\n    Main driver function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test 1 (Aligned, moderate contrast)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 1.0 if x  0.5 else 5.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 2 (Misaligned, moderate contrast)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 1.0 if x  0.53 else 5.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 3 (Misaligned, high contrast, coarser grid)\",\n            \"Nx\": 10, \"Ny\": 10,\n            \"sigma_t_func\": lambda x, y: 0.5 if x  0.52 else 20.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n        {\n            \"name\": \"Test 4 (Uniform medium baseline)\",\n            \"Nx\": 20, \"Ny\": 20,\n            \"sigma_t_func\": lambda x, y: 2.0,\n            \"q_func\": lambda x, y: 1.0,\n        },\n    ]\n\n    Nx_fine, Ny_fine = 200, 200\n    results = []\n\n    for case in test_cases:\n        Nx_coarse, Ny_coarse = case[\"Nx\"], case[\"Ny\"]\n        sigma_t_func = case[\"sigma_t_func\"]\n        q_func = case[\"q_func\"]\n\n        # Run coarse simulation\n        phi_coarse = run_scb_simulation(Nx_coarse, Ny_coarse, sigma_t_func, q_func)\n\n        # Run fine reference simulation\n        phi_fine = run_scb_simulation(Nx_fine, Ny_fine, sigma_t_func, q_func)\n\n        # Block-average the reference solution\n        phi_ref = block_average(phi_fine, Nx_coarse, Ny_coarse)\n\n        # Calculate relative l2 error\n        diff = phi_coarse - phi_ref\n        l2_err_num = np.sqrt(np.sum(diff**2))\n        l2_err_den = np.sqrt(np.sum(phi_ref**2))\n        rel_l2_error = l2_err_num / l2_err_den if l2_err_den > 0 else 0.0\n\n        # Check positivity\n        positivity = bool(np.all(phi_coarse >= 0))\n\n        results.append([rel_l2_error, positivity])\n\n    # Format and print the final output\n    result_str = ','.join([f\"[{res[0]:.10f},{str(res[1])}]\" for res in results])\n    result_str = result_str.replace(\"True\", \"True\").replace(\"False\", \"False\") # Ensure correct boolean capitalization\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "一个稳健的数值程序不仅需要正确的实现核心算法，还需要精确处理各种边界条件，尤其是在复杂的交界处。本练习是一个“纸笔”推导，它将引导您深入思考 SCB 方法的理论基础。我们将聚焦于一个棘手的具体情况：真空边界与镜面反射边界的交点 。通过从第一性原理出发，即在角点处的粒子流守恒，您将推导出在这种混合边界条件下正确的角通量计算公式，从而确保程序的物理一致性和守恒性。",
            "id": "4248716",
            "problem": "考虑二维空间中角通量 $\\,\\psi(x,y,\\mu,\\eta)\\,$ 的稳态单能中子输运方程，其中方向余弦为 $\\,\\mu=\\cos\\theta_x\\,$ 和 $\\,\\eta=\\cos\\theta_y\\,$：\n$$\n\\mu\\,\\frac{\\partial \\psi}{\\partial x} + \\eta\\,\\frac{\\partial \\psi}{\\partial y} + \\Sigma_t\\,\\psi \\;=\\; q\\,,\n$$\n其中 $\\,\\Sigma_t\\,$ 是总宏观截面，$\\,q\\,$ 是已知的体源。在 $\\,x=0\\,$ 和 $\\,y=0\\,$ 处的网格相邻边界分别施加真空和镜面反射条件：\n- 真空：对于 $\\,x=0\\,$，入射半程值满足 $\\,\\psi(0,y,\\mu0,\\eta)=0\\,$。\n- 镜面反射：对于 $\\,y=0\\,$，入射半程值满足 $\\,\\psi(x,0,\\mu,\\eta0)=\\psi(x,0,\\mu,-\\eta)\\,$。\n\n重点关注 $\\,x=0,\\,y=0\\,$ 处的网格角点，该角点是真空边界和反射边界的交点。在简单角点平衡 (Simple Corner Balance, SCB) 有限体积离散化中，用于计算通过相邻边的泄漏的角点值 $\\,\\psi_c^{(\\mu,\\eta)}\\,$，是通过在一个直角位于角点且两直角边与 $\\,x\\,$ 轴和 $\\,y\\,$ 轴对齐的直角三角形子控制体上强制施加局部角向平衡来定义的。对于角点层面的分析，作如下假设：\n- 在无穷小的三角形子控制体上，源项 $\\,q\\,$ 和衰减项 $\\,\\Sigma_t\\,\\psi\\,$ 可以忽略不计，因此流输在局部占主导地位。\n- 对于SCB平衡的目的，在角点尺度上，对三角形的每个边段使用分段常数近似 $\\,\\psi\\,$ 是足够的。\n- 离散纵标法 (Discrete Ordinates Method, SN) 提供了一组有限的卦限角度 $\\,(\\mu_m,\\eta_m)\\,$；考虑一个 $\\,\\mu0\\,$ 和 $\\,\\eta0\\,$ 的卦限，这样流输就从角点进入内部。\n\n在这些假设下，将散度定理应用于该三角形子控制体，意味着净流入内部（穿过斜边）的流输与穿过与 $\\,x\\,$ 轴和 $\\,y\\,$ 轴对齐的直角边的法向流输之和相平衡。对于分段常数的边值 $\\,\\psi_x^{(\\mu,\\eta)}\\,$ 和 $\\,\\psi_y^{(\\mu,\\eta)}\\,$ 以及斜边上的单个角点值 $\\,\\psi_c^{(\\mu,\\eta)}\\,$，角点处的守恒性和正性要求它是入射边贡献的凸组合，其权重取决于沿 $\\,x\\,$ 和 $\\,y\\,$ 方向的角向流输率。\n\n分析简单角点平衡 (SCB) 在此混合边界角点附近，对于方向为 $\\,\\mu0\\,$ 和 $\\,\\eta0\\,$ 的行为。从输运方程和给定的边界条件出发，并使用三角形上的局部流输主导的SCB平衡，确定角点值 $\\,\\psi_c^{(\\mu,\\eta)}\\,$ 应如何构造以满足以下条件：\n- 与真空和镜面反射的半程条件一致，\n- 在匹配边法向流输贡献的意义上是守恒的，\n- 对于任何非负的入射边界数据都保持为正。\n\n在这些标准下，以下哪种处理方法是稳健且正确的？\n\nA. 将 $\\,\\psi_c^{(\\mu,\\eta)}\\,$ 设置为两个相邻边值的算术平均值，即 $\\,\\psi_c^{(\\mu,\\eta)}=\\tfrac{1}{2}\\big(\\psi_x^{(\\mu,\\eta)}+\\psi_y^{(\\mu,\\eta)}\\big)\\,$，并根据每条边所适用的边界条件定义 $\\,\\psi_x^{(\\mu,\\eta)}\\,$ 和 $\\,\\psi_y^{(\\mu,\\eta)}\\,$。\n\nB. 将 $\\,\\psi_c^{(\\mu,\\eta)}\\,$ 构造为入射半程边值的凸组合，其权重为流输方向权重；具体使用\n$$\n\\psi_c^{(\\mu,\\eta)} \\;=\\; \\frac{\\mu}{\\mu+\\eta}\\,\\psi_x^{(\\mu,\\eta)} \\;+\\; \\frac{\\eta}{\\mu+\\eta}\\,\\psi_y^{(\\mu,\\eta)}\\,,\n$$\n其中，根据在 $\\,x=0\\,$ 处的真空条件，对 $\\,\\mu0\\,$ 强制 $\\,\\psi_x^{(\\mu,\\eta)}=0\\,$；根据在 $\\,y=0\\,$ 处的镜面反射条件，在适当的半程强制 $\\,\\psi_y^{(\\mu,\\eta)}=\\psi_y^{(\\mu,-\\eta)}\\,$。\n\nC. 只要相交的边界之一是真空，就将 $\\,\\psi_c^{(\\mu,\\eta)}=0\\,$，而不考虑另一个边界的类型。\n\nD. 通过将角度跨角平分线镜像来施加角点反射，并设置 $\\,\\psi_c^{(\\mu,\\eta)}=\\psi_c^{(\\eta,\\mu)}\\,$，与边边界类型无关，以使角点处理对称化。\n\nE. 在真空边界之外引入一个虚拟网格，并施加周期性边界条件，使得在角点处 $\\,\\psi_x^{(\\mu,\\eta)}=\\psi_y^{(\\mu,\\eta)}\\,$，然后设置 $\\,\\psi_c^{(\\mu,\\eta)}=\\psi_x^{(\\mu,\\eta)}\\,$。\n\n选择最能满足所述标准，并且是直接从输运方程、半程边界条件和混合真空-反射角点处的局部SCB流输平衡推导出的选项。",
            "solution": "用户希望我验证问题陈述，如果有效，则提供详细的解决方案。\n\n### 步骤1：提取给定条件\n\n-   **控制方程**：稳态、单能、二维中子输运方程：\n    $$ \\mu\\,\\frac{\\partial \\psi}{\\partial x} + \\eta\\,\\frac{\\partial \\psi}{\\partial y} + \\Sigma_t\\,\\psi \\;=\\; q $$\n-   **变量和常数**：\n    -   $\\psi(x,y,\\mu,\\eta)$: 角通量。\n    -   $\\mu, \\eta$: 方向余弦。\n    -   $\\Sigma_t$: 总宏观截面。\n    -   $q$: 已知的体源。\n-   **角点 $(x,y)=(0,0)$ 处的边界条件**：\n    -   在 $x=0$ 处（对于网格边上的所有 $y$）：真空边界，$\\psi(0,y,\\mu0,\\eta)=0$。\n    -   在 $y=0$ 处（对于网格边上的所有 $x$）：镜面反射，$\\psi(x,0,\\mu,\\eta0)=\\psi(x,0,\\mu,-\\eta)$。\n-   **方法和假设（简单角点平衡 - SCB）**：\n    -   分析针对角点 $x=0, y=0$。\n    -   分析针对 $\\mu0$ 和 $\\eta0$ 卦限中的一个离散方向。\n    -   在角点处的一个无穷小直角三角形子控制体上强制执行局部角向平衡。\n    -   在此无穷小体积中，源项 $q$ 和衰减项 $\\Sigma_t \\psi$ 可忽略不计，因此流输占主导地位：$\\mu\\,\\frac{\\partial \\psi}{\\partial x} + \\eta\\,\\frac{\\partial \\psi}{\\partial y} \\approx 0$。\n    -   在三角形的边上使用 $\\psi$ 的分段常数近似：直角边上为 $\\psi_x^{(\\mu,\\eta)}$ 和 $\\psi_y^{(\\mu,\\eta)}$，斜边上为 $\\psi_c^{(\\mu,\\eta)}$。\n    -   角点值 $\\psi_c^{(\\mu,\\eta)}$ 是入射边通量的凸组合，其权重取决于流输率（与 $\\mu$ 和 $\\eta$ 成正比）。\n-   **解的所需性质**：\n    -   与边界条件一致。\n    -   守恒（匹配流输贡献）。\n    -   对于非负入射数据保持正值。\n\n### 步骤2：使用提取的给定条件进行验证\n\n-   **科学依据**：是的。该问题基于线性玻尔兹曼输运方程，这是辐射转移和中子输运理论的基石。边界条件（真空、镜面反射）是标准的。简单角点平衡（SCB）方法是一种已知的数值技术，用于离散纵标（$S_N$）程序中，以解决标准差分格式（如菱形差分格式）的问题并确保正性。\n-   **定义明确**：是的。该问题要求在一组清晰的物理原理和边界条件下，推导特定数值方法的公式。所提供的信息足以推导出角通量的唯一且有意义的表达式。\n-   **客观性**：是的。该问题使用计算输运理论领域的精确技术语言进行表述。它没有歧义和主观陈述。\n\n该问题没有说明中列出的任何缺陷（例如，科学上不健全、不完整、矛盾等）。诸如为角点平衡忽略局部源和衰减等假设，在此类局部“修正”格式的推导中是标准的。\n\n### 步骤3：结论与行动\n\n问题陈述是**有效**的。开始求解。\n\n### 简单角点平衡公式的推导\n\n该问题涉及角通量 $\\psi$ 在方向 $(\\mu, \\eta)$ 且 $\\mu0, \\eta0$ 时的行为。这对应于粒子从角点 $(0,0)$ 流出到空间域的第一象限。简单角点平衡 (SCB) 方法基于在角点处一个无穷小的控制体上强制执行粒子守恒。\n\n让我们考虑一个顶点为 $(0,0)$, $(\\delta x, 0)$ 和 $(0, \\delta y)$ 的直角三角形控制体 $V$，其中 $\\delta x$ 和 $\\delta y$ 是无穷小长度。问题陈述指出，在该体积内源项和衰减项可忽略不计，因此输运方程简化为纯流输方程：\n$$ \\mu\\,\\frac{\\partial \\psi}{\\partial x} + \\eta\\,\\frac{\\partial \\psi}{\\partial y} = 0 $$\n这可以写成守恒形式 $\\nabla \\cdot (\\boldsymbol{\\Omega}\\psi) = 0$，其中 $\\boldsymbol{\\Omega} = (\\mu, \\eta)$ 是方向向量。\n\n对三角形面积 $A$ 进行积分并应用散度定理，得到：\n$$ \\iint_A \\nabla \\cdot (\\boldsymbol{\\Omega}\\psi) \\,dA = \\oint_{\\partial A} \\psi (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}) \\,ds = 0 $$\n其中 $\\partial A$ 是三角形的边界，$\\mathbf{n}$ 是向外的单位法向量。\n\n我们来计算沿三角形边界三条边段的线积分：\n1.  **底边（沿x轴）**：从 $x=0$ 到 $x=\\delta x$ 在 $y=0$ 处。这里，$\\mathbf{n}=(0,-1)$ 且 $ds=dx$。通量近似为常数入射值 $\\psi_y$。其贡献为：\n    $$ \\int_0^{\\delta x} \\psi_y (\\mu, \\eta) \\cdot (0, -1) \\,dx = \\int_0^{\\delta x} (-\\eta \\psi_y) \\,dx = -\\eta \\psi_y \\delta x $$\n2.  **左边（沿y轴）**：从 $y=0$ 到 $y=\\delta y$ 在 $x=0$ 处。这里，$\\mathbf{n}=(-1,0)$ 且 $ds=dy$。通量近似为常数入射值 $\\psi_x$。其贡献为：\n    $$ \\int_0^{\\delta y} \\psi_x (\\mu, -1) \\cdot (-1, 0) \\,dy = \\int_0^{\\delta y} (-\\mu \\psi_x) \\,dy = -\\mu \\psi_x \\delta y $$\n3.  **斜边**：从 $(\\delta x, 0)$ 到 $(0, \\delta y)$。向外法向量与 $(\\delta y, \\delta x)$ 成比例。单位法向量为 $\\mathbf{n} = \\frac{(\\delta y, \\delta x)}{\\sqrt{\\delta x^2 + \\delta y^2}}$。斜边长度为 $ds_h = \\sqrt{\\delta x^2 + \\delta y^2}$。此边上的通量是离开角点的通量，记为 $\\psi_c$。其贡献为：\n    $$ \\int_{\\text{hypotenuse}} \\psi_c (\\boldsymbol{\\Omega} \\cdot \\mathbf{n}) \\,ds_h = \\psi_c \\left( (\\mu, \\eta) \\cdot \\frac{(\\delta y, \\delta x)}{\\sqrt{\\delta x^2 + \\delta y^2}} \\right) \\sqrt{\\delta x^2 + \\delta y^2} = \\psi_c (\\mu\\delta y + \\eta\\delta x) $$\n\n将这三项贡献相加并设为零以强制平衡：\n$$ -\\eta \\psi_y \\delta x - \\mu \\psi_x \\delta y + \\psi_c (\\mu\\delta y + \\eta\\delta x) = 0 $$\n解出角点值 $\\psi_c$：\n$$ \\psi_c (\\mu\\delta y + \\eta\\delta x) = \\mu \\psi_x \\delta y + \\eta \\psi_y \\delta x $$\n$$ \\psi_c = \\frac{\\mu\\delta y}{\\mu\\delta y + \\eta\\delta x} \\psi_x + \\frac{\\eta\\delta x}{\\mu\\delta y + \\eta\\delta x} \\psi_y $$\n这个方程表明 $\\psi_c$ 是入射边界通量 $\\psi_x$ 和 $\\psi_y$ 的凸组合，如果 $\\psi_x, \\psi_y \\ge 0$，则满足正性要求。权重取决于方向 $(\\mu, \\eta)$ 和局部体积的尺寸 $(\\delta x, \\delta y)$。\n\n问题陈述通过说明权重取决于“沿 $x$ 和 $y$ 的角向流输率”（即 $\\mu$ 和 $\\eta$）来简化此模型。这暗示了意图采用简化模型，等同于设置 $\\delta x = \\delta y$（如在均匀方形网格中）。在这种情况下，公式变为：\n$$ \\psi_c = \\frac{\\mu}{\\mu+\\eta} \\psi_x + \\frac{\\eta}{\\mu+\\eta} \\psi_y $$\n\n现在，我们应用给定的边界条件，针对方向 $\\mu0, \\eta0$：\n-   通量 $\\psi_x$ 是 $x=0$ 边界上的值。对于入射通量（$\\mu0$）的真空条件规定 $\\psi(0,y,\\mu0,\\eta)=0$。因此，$\\psi_x = 0$。\n-   通量 $\\psi_y$ 是 $y=0$ 边界上的值。对于入射通量（$\\eta0$）的镜面反射条件规定，入射通量等于反射方向的出射通量：$\\psi(x,0,\\mu,\\eta0) = \\psi(x,0,\\mu,-\\eta)$。因此，$\\psi_y$ 不为零，而是被设置为方向 $(\\mu, -\\eta)$ 的通量值，即 $\\psi_y^{(\\mu,\\eta)} = \\psi_y^{(\\mu,-\\eta)}$。\n\n将这些代入 SCB 公式：\n$$ \\psi_c^{(\\mu,\\eta)} = \\frac{\\mu}{\\mu+\\eta}(0) + \\frac{\\eta}{\\mu+\\eta} \\psi_y^{(\\mu,-\\eta)} = \\frac{\\eta}{\\mu+\\eta} \\psi_y^{(\\mu,-\\eta)} $$\n这是 SCB 方法下，针对此特定混合边界条件角点的角点值的正确公式。\n\n### 逐项分析\n\n**A. 将 $\\psi_c^{(\\mu,\\eta)}$ 设置为两个相邻边值的算术平均值，即 $\\psi_c^{(\\mu,\\eta)}=\\tfrac{1}{2}\\big(\\psi_x^{(\\mu,\\eta)}+\\psi_y^{(\\mu,\\eta)}\\big)$，并根据每条边所适用的边界条件定义 $\\psi_x^{(\\mu,\\eta)}$ 和 $\\psi_y^{(\\mu,\\eta)}$。**\n此选项提出的权重为 $w_x = 1/2$ 和 $w_y = 1/2$。推导表明，权重必须是方向相关的，即 $\\mu$ 和 $\\eta$ 的函数。算术平均仅在 $\\mu=\\eta$ 的特定角度下有效（假设 $\\delta x = \\delta y$）。它不是一个普遍正确或稳健的流输物理模型。\n结论：**不正确**。\n\n**B. 将 $\\psi_c^{(\\mu,\\eta)}$ 构造为入射半程边值的凸组合，其权重为流输方向权重；具体使用\n$$\n\\psi_c^{(\\mu,\\eta)} \\;=\\; \\frac{\\mu}{\\mu+\\eta}\\,\\psi_x^{(\\mu,\\eta)} \\;+\\; \\frac{\\eta}{\\mu+\\eta}\\,\\psi_y^{(\\mu,\\eta)}\\,,\n$$\n其中，根据在 $x=0$ 处的真空条件，对 $\\mu0$ 强制 $\\psi_x^{(\\mu,\\eta)}=0$；根据在 $y=0$ 处的镜面反射条件，在适当的半程强制 $\\psi_y^{(\\mu,\\eta)}=\\psi_y^{(\\mu,-\\eta)}$。**\n这个选项与我们的推导完全吻合。它提出了经典的 SCB 公式，这是一个权重与流输率 $\\mu$ 和 $\\eta$ 成正比的凸组合。然后，它在各自的半程中正确应用了真空条件（$\\psi_x=0$ for $\\mu0$）和镜面反射条件（$\\psi_y^{(\\mu,\\eta0)} = \\psi_y^{(\\mu,-\\eta)}$）。这种方法通过推导是守恒的，保证了正性，并与边界条件一致。\n结论：**正确**。\n\n**C. 只要相交的边界之一是真空，就将 $\\psi_c^{(\\mu,\\eta)}=0$，而不考虑另一个边界的类型。**\n这是一种过度简化。我们推导出的结果是 $\\psi_c^{(\\mu,\\eta)} = \\frac{\\eta}{\\mu+\\eta} \\psi_y^{(\\mu,-\\eta)}$。如果存在从网格中出射并在 $y=0$ 边界被反射的通量，这个值通常不为零。将 $\\psi_c=0$ 忽略了来自反射边界的贡献，违反了粒子守恒。对于几乎平行于y轴的方向（$\\mu \\to 0, \\eta0$），通量应该几乎完全由反射边界决定，即 $\\psi_c \\approx \\psi_y$，而不是 $0$。此选项在该极限情况下失效。\n结论：**不正确**。\n\n**D. 通过将角度跨角平分线镜像来施加角点反射，并设置 $\\psi_c^{(\\mu,\\eta)}=\\psi_c^{(\\eta,\\mu)}$，与边边界类型无关，以使角点处理对称化。**\n边界条件在根本上是不对称的：一个是真空，另一个是反射。没有物理基础来在角点施加对称响应。此外，这个规定“与边边界类型无关”，这是一个致命缺陷。边界处的行为必须由边界条件决定。此选项忽略了问题的物理实质。\n结论：**不正确**。\n\n**E. 在真空边界之外引入一个虚拟网格，并施加周期性边界条件，使得在角点处 $\\psi_x^{(\\mu,\\eta)}=\\psi_y^{(\\mu,\\eta)}$，然后设置 $\\psi_c^{(\\mu,\\eta)}=\\psi_x^{(\\mu,\\eta)}$。**\n此选项提出了一个复杂且物理上不正确的程序。真空边界与周期性边界有本质上的不同。用周期性条件替换真空条件违反了问题陈述。$\\psi_x=\\psi_y$ 的结论没有根据。最后，设置 $\\psi_c=\\psi_x$ 并应用真空条件 $\\psi_x=0$ 会导致 $\\psi_c=0$，我们已经证明这是不正确的（选项C）。其理由是无稽之谈。\n结论：**不正确**。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}