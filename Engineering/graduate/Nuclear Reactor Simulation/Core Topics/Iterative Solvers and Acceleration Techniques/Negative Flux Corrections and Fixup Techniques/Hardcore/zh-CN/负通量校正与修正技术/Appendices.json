{
    "hands_on_practices": [
        {
            "introduction": "理论联系实践是掌握复杂概念的关键。本节的第一个实践将探讨非物理负通量产生的一种基本方式：数值离散格式的选择。我们将分析应用于瞬态扩散方程的简单前向欧拉法。通过推导保证通量解非负的必要条件，您将深入了解显式方法固有的稳定性限制，并理解为何过大的时间步长或过细的空间网格会导致违反正定性 。这项练习为您后续理解为何通常首选更稳健但更复杂的隐式方法奠定了基础。",
            "id": "4237665",
            "problem": "考虑一个单群带吸收的中子扩散一维平板模型，其形式通过用中子速度缩放时间进行了无量纲化，从而使时间导数项的系数为1。在区域 $\\,x \\in [0,L]\\,$ 上，中子通量 $\\,\\phi(x,t)\\,$ 的控制方程为\n$$\n\\frac{\\partial \\phi}{\\partial t} \\;=\\; D \\,\\frac{\\partial^{2}\\phi}{\\partial x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi \\;+\\; S(x,t)，\n$$\n其中 $\\,D>0\\,$ 是扩散系数，$\\,\\Sigma_{a} \\ge 0\\,$ 是宏观吸收截面。假设均匀狄利克雷边界条件为 $\\,\\phi(0,t) = \\phi(L,t) = \\phi_{b}\\,$，其中 $\\,\\phi_{b} \\ge 0\\,$，且源项非负 $\\,S(x,t) \\ge 0\\,$。在均匀网格 $\\,x_{i} = i\\,\\Delta x\\,$，$\\,i=0,1,\\dots,N\\,$ 上进行空间离散，并使用标准的二阶中心差分来近似拉普拉斯算子。使用时间步长为 $\\,\\Delta t\\,$ 的向前欧拉法进行时间推进：\n$$\n\\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n$$\n其中 $\\,i=1,2,\\dots,N-1\\,$，且 $\\,\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_{b}\\,$。假设对所有的 $\\,i\\,$ 都有 $\\,\\phi^{n}_{i} \\ge 0\\,$，并且 $\\,S^{n}_{i} \\ge 0\\,$。使用离散极值原理（DMP）框架和适用于防止负通量的单调性论证，推导该显式更新中系数所需满足的条件，以保证当 $\\,\\phi^{n}_{i} \\ge 0\\,$ 且 $\\,S^{n}_{i} \\ge 0\\,$ 时，有 $\\,\\phi^{n+1}_{i} \\ge 0\\,$。从此条件中，得出一个耦合 $\\,\\Delta t\\,$ 和 $\\,\\Delta x\\,$ 的不等式。\n\n现在，假设在此无量纲系统中，显式时间步长被选为吸收时间尺度的一半，具体为 $\\,\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}\\,$。在此选择下，推导出一个以 $\\,D\\,$ 和 $\\,\\Sigma_{a}\\,$ 表示的网格尺寸 $\\,\\Delta x\\,$ 的界限，该界限保证了所有内部点的显式更新的保正性。请用厘米（centimeters）表示你最终得到的 $\\,\\Delta x\\,$ 的界限。\n\n最后，通过参考向后欧拉矩阵的结构以及 $\\,\\mathsf{M}\\,$ 矩阵（其中 $\\,\\mathsf{M}\\,$ 代表一个非对角元素非正且其逆矩阵所有元素非负的矩阵）的概念，解释全隐式格式如何放宽你所推导的显式保正性界限。最终答案必须是关于 $\\,\\Delta x\\,$ 所需下界的一个封闭形式表达式。没有提供数值，因此不需要四舍五入。请用厘米表示最终的界限。",
            "solution": "在尝试求解之前，将首先验证问题陈述的科学合理性、一致性和完整性。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **控制方程：** 一维单群中子扩散方程如下：\n$$\n\\frac{\\partial \\phi}{\\partial t} \\;=\\; D \\,\\frac{\\partial^{2}\\phi}{\\partial x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi \\;+\\; S(x,t)\n$$\n- **区域：** $x \\in [0,L]$。\n- **系数：** 扩散系数 $D > 0$，宏观吸收截面 $\\Sigma_{a} \\ge 0$。\n- **边界和初始条件：** 均匀狄利克雷边界条件 $\\phi(0,t) = \\phi(L,t) = \\phi_{b}$，其中 $\\phi_{b} \\ge 0$。初始通量非负，$\\phi(x,0) \\ge 0$。\n- **源项：** 非负源项，$S(x,t) \\ge 0$。\n- **数值格式：**\n  - **空间离散：** 均匀网格 $x_{i} = i\\,\\Delta x$，$i=0,1,...,N$。使用标准的二阶中心差分近似拉普拉斯算子。\n  - **时间离散：** 采用时间步长为 $\\Delta t$ 的向前欧拉法。\n  - **全离散方程：**\n  $$\n  \\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n  $$\n  对于内部点 $i=1,2,...,N-1$。\n  - **离散边界条件：** 对于所有时间步 $n$，有 $\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_b$。\n- **保正性假设：** 在时间步 $n$，假设对所有 $i$ 都有 $\\phi^{n}_{i} \\ge 0$ 且 $S^{n}_{i} \\ge 0$。\n- **特定条件：** 为分析的第二部分选择了一个特定的时间步长：$\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$。\n- **目标：**\n  1. 推导保证 $\\phi^{n+1}_{i} \\ge 0$ 的系数条件。\n  2. 从此条件中获得一个耦合 $\\Delta t$ 和 $\\Delta x$ 的不等式。\n  3. 在 $\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$ 的条件下，推导网格尺寸 $\\Delta x$ 的下界。\n  4. 参考 $\\mathsf{M}$-矩阵的概念，解释全隐式（向后欧拉）格式如何放宽此界限。\n  5. 用厘米表示 $\\Delta x$ 下界的最终答案。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于中子扩散方程和标准数值方法（有限差分、向前/向后欧拉），这些都是核工程和计算物理中的基本概念。对保正性的分析以及离散极值原理和 $\\mathsf{M}$-矩阵理论的使用在此背景下是标准且正确的。该模型在科学上是合理的。\n- **清晰度和一致性：** 该问题在很大程度上是适定的和客观的。然而，存在一个微小的矛盾和一个模糊点。\n  1. 问题陈述方程为“无量纲形式”，但随后要求最终答案以“厘米”为单位。这是矛盾的。一个真正的无量纲系统没有单位。对时间变换后的方程 $\\frac{\\partial \\phi}{\\partial t} = D \\frac{\\partial^2\\phi}{\\partial x^2} - \\dots$ 进行仔细的量纲分析表明，如果原始物理时间 $t_{phys}$ 通过 $t = v t_{phys}$（其中 $v$ 是中子速度）进行缩放，那么新的时间变量 $t$ 的单位是长度。根据这种解释，$D$ 的单位是长度（例如，cm），而 $\\Sigma_a$ 的单位是长度的倒数（例如，cm$^{-1}$）。这使得偏微分方程中的所有项在量纲上保持一致，并解决了表面上的矛盾。因此，假设这种将“无量纲化”解释为时间变量变换的物理一致性解释，该问题是可解的。\n  2. 问题要求用厘米表示最终答案，但全局格式规则明确禁止在最终答案框中使用单位。作为解决方案，推导将以符号形式进行，并理解如果长度的基本单位是厘米，那么 $\\Delta x$ 的最终表达式自然会以厘米为单位。最终的方框答案将遵守格式规则并省略单位。\n\n- **结论：** 在澄清了对时间变量和单位的理解后，该问题被认为是有效和可解的。\n\n### 求解过程\n\n第一个目标是找到显式向前欧拉格式保持保正性的条件。对于内部节点 $i$ 的格式为：\n$$\n\\phi^{n+1}_{i} \\;=\\; \\phi^{n}_{i} \\;+\\; \\Delta t \\left[ D\\,\\frac{\\phi^{n}_{i+1} - 2\\,\\phi^{n}_{i} + \\phi^{n}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n}_{i} \\;+\\; S^{n}_{i} \\right]\n$$\n为了分析保正性，我们重新整理方程，将 $\\phi^{n+1}_{i}$ 表示为前一时间步 $\\phi^{n}$ 处值的线性组合：\n$$\n\\phi^{n+1}_{i} \\;=\\; \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right) \\phi^{n}_{i-1} \\;+\\; \\left(1 - \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} - \\Sigma_{a}\\,\\Delta t\\right) \\phi^{n}_{i} \\;+\\; \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right) \\phi^{n}_{i+1} \\;+\\; \\Delta t\\,S^{n}_{i}\n$$\n已知在时间步 $n$ 的所有量都是非负的：对所有 $j$ 都有 $\\phi^{n}_{j} \\ge 0$（包括边界值 $\\phi^{n}_{0}=\\phi^{n}_{N}=\\phi_b \\ge 0$），并且 $S^{n}_{i} \\ge 0$。为了保证 $\\phi^{n+1}_{i}$ 非负，上述线性组合中的所有系数都必须是非负的。\n$\\phi^{n}_{i-1}$ 和 $\\phi^{n}_{i+1}$ 的系数是 $\\frac{D\\,\\Delta t}{\\Delta x^{2}}$。由于 $D > 0$, $\\Delta t > 0$, 且 $\\Delta x^{2} > 0$，这些项总是非负的。\n源项的系数是 $\\Delta t$，它也是非负的。\n关键的约束来自于 $\\phi^{n}_{i}$ 的系数：\n$$\n1 - \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} - \\Sigma_{a}\\,\\Delta t \\;\\ge\\; 0\n$$\n这个不等式就是保证保正性的系数条件。这是应用离散极值原理得到的经典结果。\n\n从这个条件，我们可以推导出耦合时间步长 $\\Delta t$ 和网格间距 $\\Delta x$ 的不等式：\n$$\n1 \\;\\ge\\; \\Delta t \\left( \\frac{2\\,D}{\\Delta x^{2}} + \\Sigma_{a} \\right)\n$$\n这可以表示为对时间步长的稳定性限制：\n$$\n\\Delta t \\;\\le\\; \\frac{1}{\\frac{2\\,D}{\\Delta x^{2}} + \\Sigma_{a}}\n$$\n这个不等式表明，对于一个保正的显式格式，其最大允许时间步长受到扩散（依赖于 $\\Delta x^{-2}$）和吸收（一个常数依赖）两方面的限制。\n\n接下来，我们被要求考虑时间步长被选为 $\\Delta t = \\frac{1}{2\\,\\Sigma_{a}}$ 的特定情况。我们将此代入主要的保正性条件中：\n$$\n1 - \\frac{2\\,D}{\\Delta x^{2}} \\left(\\frac{1}{2\\,\\Sigma_{a}}\\right) - \\Sigma_{a} \\left(\\frac{1}{2\\,\\Sigma_{a}}\\right) \\;\\ge\\; 0\n$$\n简化表达式得到：\n$$\n1 - \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}} - \\frac{1}{2} \\;\\ge\\; 0\n$$\n$$\n\\frac{1}{2} - \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}} \\;\\ge\\; 0\n$$\n现在我们可以重新整理这个不等式，以找到对网格尺寸 $\\Delta x$ 的一个界限：\n$$\n\\frac{1}{2} \\;\\ge\\; \\frac{D}{\\Sigma_{a}\\,\\Delta x^{2}}\n$$\n$$\n\\Sigma_{a}\\,\\Delta x^{2} \\;\\ge\\; 2\\,D\n$$\n$$\n\\Delta x^{2} \\;\\ge\\; \\frac{2\\,D}{\\Sigma_{a}}\n$$\n由于 $\\Delta x > 0$，我们可以对两边取平方根，以获得 $\\Delta x$ 的最终界限：\n$$\n\\Delta x \\;\\ge\\; \\sqrt{\\frac{2\\,D}{\\Sigma_{a}}}\n$$\n这个不等式规定了网格尺寸 $\\Delta x$ 的一个**下界**。对于所选的时间步长，如果网格过密（即 $\\Delta x$ 太小），格式将不能保证保持保正性，并可能产生不符合物理实际的负通量值。量 $\\sqrt{D/\\Sigma_{a}}$ 具有长度单位，被称为扩散长度，是反应堆物理学中的一个特征长度尺度。所要求的网格尺寸必须大于一个与此长度成比例的值。\n\n最后，我们解释像向后欧拉这样的全隐式格式如何放宽这个界限。扩散方程的向后欧拉离散化是：\n$$\n\\frac{\\phi^{n+1}_{i} - \\phi^{n}_{i}}{\\Delta t} \\;=\\; D\\,\\frac{\\phi^{n+1}_{i+1} - 2\\,\\phi^{n+1}_{i} + \\phi^{n+1}_{i-1}}{\\Delta x^{2}} \\;-\\; \\Sigma_{a}\\,\\phi^{n+1}_{i} \\;+\\; S^{n+1}_{i}\n$$\n为了求解未知通量 $\\phi^{n+1}$，我们重新整理方程，将所有包含 $\\phi^{n+1}$ 的项放在左侧：\n$$\n-\\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right)\\phi^{n+1}_{i-1} + \\left(1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t\\right)\\phi^{n+1}_{i} - \\left(\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right)\\phi^{n+1}_{i+1} \\;=\\; \\phi^{n}_{i} + \\Delta t\\,S^{n+1}_{i}\n$$\n这个关于未知向量 $\\mathbf{\\phi}^{n+1}$ 的线性方程组可以写成矩阵形式 $\\mathsf{A}\\,\\mathbf{\\phi}^{n+1} = \\mathbf{b}$。\n右侧向量 $\\mathbf{b}$ 的分量为 $b_i = \\phi^n_i + \\Delta t S^{n+1}_i$ 再加上来自边界条件的项。由于我们假设 $\\phi^n_i \\ge 0$, $S^{n+1}_i \\ge 0$, 且 $\\phi_b \\ge 0$，向量 $\\mathbf{b}$ 的所有元素都是非负的，即 $\\mathbf{b} \\ge 0$。\n\n系统矩阵 $\\mathsf{A}$ 是一个三对角矩阵。对于任意行 $i$：\n- 对角元素是 $A_{ii} = 1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t$，对于任何 $\\Delta t > 0$ 和 $\\Delta x > 0$ 都是严格为正的。\n- 非对角元素是 $A_{i, i-1} = A_{i, i+1} = -\\frac{D\\,\\Delta t}{\\Delta x^{2}}$，它们是非正的。\n\n根据所提供的定义，如果一个矩阵的非对角元素非正，并且其逆矩阵的元素都非负，那么这个矩阵就是一个 $\\mathsf{M}$-矩阵。对于一个非对角元素非正的矩阵（Z-矩阵），其成为 $\\mathsf{M}$-矩阵的一个充分条件是它是严格对角占优的。我们来检查严格对角占优性：\n$$\n|A_{ii}| > \\sum_{j \\ne i} |A_{ij}|\n$$\n对于内部的行 $i$，这变成：\n$$\n1 + \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}} + \\Sigma_{a}\\,\\Delta t > \\left|-\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right| + \\left|-\\frac{D\\,\\Delta t}{\\Delta x^{2}}\\right| = \\frac{2\\,D\\,\\Delta t}{\\Delta x^{2}}\n$$\n$$\n1 + \\Sigma_{a}\\,\\Delta t > 0\n$$\n由于 $\\Sigma_a \\ge 0$ 且 $\\Delta t > 0$，这个条件总是满足的。对于矩阵的第一行和最后一行，这种占优性更强，因为它们只有一个非对角元素。\n因此，对于 $\\Delta t > 0$ 和 $\\Delta x > 0$ 的**任意**选择，矩阵 $\\mathsf{A}$ 都是一个严格对角占优的Z-矩阵。这证明了 $\\mathsf{A}$ 是一个 $\\mathsf{M}$-矩阵，因此其逆矩阵 $\\mathsf{A}^{-1}$ 的所有元素都是非负的，即 $\\mathsf{A}^{-1} \\ge 0$。\n\n新时间步的通量解为 $\\mathbf{\\phi}^{n+1} = \\mathsf{A}^{-1}\\mathbf{b}$。由于 $\\mathsf{A}^{-1}$ 和 $\\mathbf{b}$ 的元素都非负，它们的乘积 $\\mathbf{\\phi}^{n+1}$ 也保证是元素非负的。这一点与 $\\Delta t$ 和 $\\Delta x$ 的大小无关。因此，向后欧拉格式是无条件保正的，它完全放宽了向前欧拉格式所要求的对 $\\Delta t$ 和 $\\Delta x$ 的限制性界限。\n\n$\\Delta x$ 的最终界限表达式是为显式格式推导出的下界。如果 $D$ 的单位是 cm 而 $\\Sigma_a$ 的单位是 cm$^{-1}$，那么 $\\Delta x$ 界限的最终单位就是 cm。",
            "answer": "$$\n\\boxed{\\sqrt{\\frac{2D}{\\Sigma_{a}}}}\n$$"
        },
        {
            "introduction": "数值模拟有时会产生非物理结果，例如在真空边界出现负的向外流。本练习提供了一个具体的场景，您必须处理这种伪影。您将应用一个简单的“削波”修正，然后重新计算系统的有效增殖因数 $k'$ 以恢复全局中子平衡，从而展示局部修正如何影响关键的全局参数 。这个实践强调了在纠正数值错误时，维持物理一致性和遵守守恒定律的重要性。",
            "id": "4237630",
            "problem": "在具有真空边界的均匀平板中，一个一维单能群稳态反应堆模拟在左边界附近表现出数值振荡，从而产生了一个小的负出射偏流。对于稳态$k$-本征值问题，基本的中子积分平衡为中子产生率等于中子吸收与净泄漏之和，即\n$$\n\\frac{1}{k}\\int_{V}\\nu\\Sigma_{f}\\phi\\,\\mathrm{d}V \\;=\\; \\int_{V}\\Sigma_{a}\\phi\\,\\mathrm{d}V \\;+\\; L,\n$$\n其中，$k$ 是有效增殖因子，$\\nu\\Sigma_{f}$ 是裂变中子产生截面，$\\Sigma_{a}$ 是吸收截面，$\\phi$ 是标量通量，$V$ 是体积，$L$ 是由中子流的向外面积分定义的净泄漏。该平板具有单位横截面积，因此净泄漏等于两个向外边界偏流之和。\n\n模拟报告了以下修正前的量值：\n- 右边界出射偏流 $J_{\\mathrm{R}}^{\\mathrm{out}} = 1.900$ 中子$\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$。\n- 左边界出射偏流 $J_{\\mathrm{L}}^{\\mathrm{out}} = -0.150$ 中子$\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$。\n- 体积分吸收率 $\\int_{V}\\Sigma_{a}\\phi\\,\\mathrm{d}V = 3.000$ 中子$\\cdot\\mathrm{s}^{-1}$。\n- 体积分裂变产生率 $\\int_{V}\\nu\\Sigma_{f}\\phi\\,\\mathrm{d}V = 5.000$ 中子$\\cdot\\mathrm{s}^{-1}$。\n\n应用了一种边界修正，将左边界的负出射偏流截断为零，即 $J_{\\mathrm{L}}^{\\mathrm{out}}$ 被替换为 $0$，同时保持右边界值不变。使用中子积分平衡和净泄漏的定义，计算重新归一化的有效增殖因子 $k'$，该因子利用截断后的边界流恢复全局平衡，但本身不改变边界流。将 $k'$ 的最终答案表示为一个无量纲数，并保留四位有效数字。",
            "solution": "问题要求在一个一维稳态反应堆系统中，对一个非物理的边界流应用数值修正后，计算重新归一化的有效增殖因子 $k'$。其主导原理是中子积分平衡方程，表示为：\n$$\n\\frac{1}{k}\\int_{V}\\nu\\Sigma_{f}\\phi\\,\\mathrm{d}V \\;=\\; \\int_{V}\\Sigma_{a}\\phi\\,\\mathrm{d}V \\;+\\; L\n$$\n此处，$k$ 是有效增殖因子，$\\int_{V}\\nu\\Sigma_{f}\\phi\\,\\mathrm{d}V$ 是裂变产生的总中子产生率，$\\int_{V}\\Sigma_{a}\\phi\\,\\mathrm{d}V$ 是总中子吸收率，$L$ 是系统中的净中子泄漏率。\n\n让我们将给定的体积分量表示如下：\n-   产生率：$P = \\int_{V}\\nu\\Sigma_{f}\\phi\\,\\mathrm{d}V = 5.000$ 中子$\\cdot\\mathrm{s}^{-1}$。\n-   吸收率：$A = \\int_{V}\\Sigma_{a}\\phi\\,\\mathrm{d}V = 3.000$ 中子$\\cdot\\mathrm{s}^{-1}$。\n\n净泄漏 $L$ 是整个边界表面上出射偏流的总和。对于所描述的具有单位横截面积的一维平板，总泄漏率是左（L）和右（R）边界上出射偏流之和。\n$$\nL = J_{\\mathrm{L}}^{\\mathrm{out}} + J_{\\mathrm{R}}^{\\mathrm{out}}\n$$\n问题提供了模拟中修正前的偏流：\n-   右边界出射偏流：$J_{\\mathrm{R}}^{\\mathrm{out}} = 1.900$ 中子$\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$。\n-   左边界出射偏流：$J_{\\mathrm{L}}^{\\mathrm{out}} = -0.150$ 中子$\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$。\n\n$J_{\\mathrm{L}}^{\\mathrm{out}} = -0.150$ 这个值在物理上是不可能的，因为出射偏流必须是非负的。这是一个数值伪影。应用了一个修正程序，将此负值截断为零。修正后左边界流的新值为：\n$$\nJ_{\\mathrm{L, fixed}}^{\\mathrm{out}} = 0\n$$\n右边界流保持不变：\n$$\nJ_{\\mathrm{R, fixed}}^{\\mathrm{out}} = J_{\\mathrm{R}}^{\\mathrm{out}} = 1.900 \\, \\text{中子}\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\n$$\n使用这些修正后的值，我们可以计算新的净泄漏率 $L'$。由于横截面积为单位面积 ($1 \\, \\mathrm{cm}^2$)，以 中子$\\cdot\\mathrm{s}^{-1}$ 为单位的泄漏率在数值上等于以 中子$\\cdot\\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$ 为单位的偏流之和。\n$$\nL' = J_{\\mathrm{L, fixed}}^{\\mathrm{out}} + J_{\\mathrm{R, fixed}}^{\\mathrm{out}} = 0 + 1.900 = 1.900 \\, \\text{中子}\\cdot\\mathrm{s}^{-1}\n$$\n任务是找到重新归一化的增殖因子 $k'$，以恢复全局中子平衡。这是一个后处理计算，其中我们使用原始的积分产生率和吸收率，但采用新的、修正后的泄漏率来强制执行平衡方程。问题的设定意味着，在此次重新归一化中，积分率 $P$ 和 $A$ 被视为固定值。\n\n新的平衡方程为：\n$$\n\\frac{1}{k'} P = A + L'\n$$\n代入数值：\n$$\n\\frac{1}{k'} (5.000) = 3.000 + 1.900\n$$\n$$\n\\frac{5.000}{k'} = 4.900\n$$\n求解 $k'$：\n$$\nk' = \\frac{5.000}{4.900}\n$$\n$$\nk' \\approx 1.02040816...\n$$\n问题要求最终答案保留四位有效数字。前四位有效数字是 $1$、$0$、$2$ 和 $0$。第五位数字是 $4$，小于 $5$，因此我们不对最后一位有效数字进行进位。\n$$\nk' = 1.020\n$$\n这个重新归一化的 $k'$ 值，为使用了修正后泄漏数据的系统建立了一个数学上一致的全局中子平衡。",
            "answer": "$$\\boxed{1.020}$$"
        },
        {
            "introduction": "实际应用中的修正技术通常涉及可调参数，这些参数需要在强制正定性与引入数值误差之间取得平衡。这个综合性计算练习要求您实现一个二维扩散方程求解器和一个参数化的通量限制器。通过对限制器参数进行敏感性研究，您将量化它们对关键反应堆物理输出（如 $k_{\\text{eff}}$、泄漏率和功率分布）的影响，从而为理解在正定性与准确性之间的关键权衡提供实践性的见解 。",
            "id": "4237649",
            "problem": "考虑一个二维、单群中子扩散 $k$-特征值问题，该问题定义在均匀方格上，并采用真空（零 Dirichlet）边界条件。其控制方程为稳态平衡律\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}),\n$$\n其中 $D$ 是扩散系数，$\\Sigma_a$ 是宏观吸收截面，$\\nu \\Sigma_f$ 是宏观裂变产生截面，$\\phi$ 是标量中子通量，而 $k_{\\text{eff}}$ 是有效增殖因子。真空边界条件意味着在区域边界上 $\\phi=0$。\n\n使用标准的五点有限差分格式，在单元宽度为 $h$ 的 $N_x \\times N_y$ 均匀网格上对此方程进行离散化，其中界面扩散系数采用算术平均。令离散通量向量为 $\\boldsymbol{\\phi} \\in \\mathbb{R}^{N_x N_y}$，离散扩散算子为稀疏矩阵 $\\mathbf{A} \\in \\mathbb{R}^{N \\times N}$（其中 $N=N_x N_y$），该矩阵包含了零 Dirichlet 边界条件。令对角裂变产生算子由非负向量 $\\mathbf{f} \\in \\mathbb{R}^N$ 表示，其元素为 $f_i = \\nu \\Sigma_{f,i}$。离散的 $k$-特征值问题是\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi},\n$$\n其中 $\\odot$ 表示逐元素乘法。\n\n使用以下基于连续裂变源迭代法（即对算子 $\\mathbf{A}^{-1} \\operatorname{diag}(\\mathbf{f})$ 的幂迭代）的基本迭代方案：\n1. 初始化 $k^{(0)}$ 和 $\\boldsymbol{\\phi}^{(0)}$。在第 $m$ 次迭代时，构建裂变源\n$$\n\\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)}.\n$$\n2. 求解线性系统\n$$\n\\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)}.\n$$\n3. 应用一个修正算子，使用强度参数为 $\\alpha \\in [0,1]$ 的限制器和下限 $\\varepsilon > 0$ 来强制非负性：\n$$\n\\phi_i^{(m+1,\\text{fix})} = \n\\begin{cases}\n(1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon,   \\text{若 } \\phi_i^{(m+1)}  \\varepsilon,\\\\\n\\phi_i^{(m+1)},  \\text{其他情况}.\n\\end{cases}\n$$\n4. 通过连续迭代之间总裂变产额的比率来更新有效增殖因子，\n$$\nk^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}},\n$$\n并将通量重新归一化至单位裂变产额，\n$$\n\\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}},\n$$\n使得对于所有 $m \\ge 0$ 都有 $\\sum_i f_i \\, \\phi_i^{(m+1)} = 1$。\n\n对于泄漏，使用真空边界处的离散扩散流近似。对于一个具有向外单位法向量 $\\hat{\\mathbf{n}}$ 的边界表面，法向流为 $J_n = -D \\, \\partial \\phi / \\partial n$。在零 Dirichlet 边界和均匀间距下，近似 $\\partial \\phi / \\partial n \\approx (\\phi_{\\text{ghost}} - \\phi_{\\text{interior}})/h = -\\phi_{\\text{interior}}/h$，因此每个边界表面的向外泄漏为 $J_{\\text{out}} h = D \\, \\phi_{\\text{interior}}$。总泄漏是所有外表面的总和，在均匀网格上，这简化为每个边界单元表面上 $D \\, \\phi$ 的总和。\n\n定义棒功率为 $p_i = f_i \\, \\phi_i$，并报告最大棒功率。在此设置中，所有输出都是无量纲的。\n\n在 $h=1$ 的 $10 \\times 10$ 网格（$N_x=N_y=10$）上构建非均匀材料分布图如下：\n- 占据索引 $i \\in \\{3,4,5,6\\}$ 和 $j \\in \\{3,4,5,6\\}$ 的中心燃料区具有 $D_{\\text{fuel}} = 1.2$，$\\Sigma_{a,\\text{fuel}} = 0.20$，$\\nu\\Sigma_{f,\\text{fuel}} = 0.40$。\n- 其他区域为慢化剂区，具有 $D_{\\text{mod}} = 1.0$，$\\Sigma_{a,\\text{mod}} = 0.08$，$\\nu\\Sigma_{f,\\text{mod}} = 0.0$。\n\n使用每个内表面的算术平均值来构建 $\\mathbf{A}$：对于单元 $i$ 和 $j$ 之间的表面，使用 $D_{\\text{face}} = \\left(D_i + D_j\\right)/2$。对于边界表面，通过在相邻内部单元的对角线上加上 $D_i/h^2$ 并且不设置跨边界的非对角耦合来强制零 Dirichlet 边界条件。\n\n基准参考：通过使用 $\\alpha=0$（无修正）和设置为全一的正初始通量 $\\boldsymbol{\\phi}^{(0)}$（归一化使得 $\\sum_i f_i \\, \\phi_i^{(0)} = 1$）运行迭代来计算参考解。迭代直至 $k_{\\text{eff}}$ 的相对变化和 $\\boldsymbol{\\phi}$ 的相对 $\\ell_2$ 变化均小于 $10^{-9}$，或达到最多 $500$ 次迭代的收敛条件。记录参考的 $k_{\\text{eff}}$、泄漏和通量。\n\n灵敏度实验：对于下面的每个测试案例，从一个带有负分量的、刻意设置的振荡初始通量开始，\n$$\n\\phi_{i,j}^{(0)} = 0.10 + 0.20 \\sin\\left(\\frac{\\pi i}{N_x}\\right) \\cos\\left(\\frac{2 \\pi j}{N_y}\\right) - 0.15 \\cos\\left(\\frac{\\pi i}{N_x}\\right),\n$$\n重塑为向量，并进行缩放以使 $\\sum_i f_i \\, \\phi_i^{(0)} = 1$。使用初始 $k^{(0)}=1.0$，与基准运行相同的收敛准则，并使用指定的 $(\\alpha,\\varepsilon)$ 应用修正步骤。\n\n对于每个测试案例，计算：\n- 收敛后的 $k_{\\text{eff}}$。\n- 总泄漏，即所有边界表面上 $D \\, \\phi$ 的总和。\n- 最大棒功率 $\\max_i p_i$。\n- 相对于基准的 $k_{\\text{eff}}$ 相对误差，$\\left|k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}\\right|/k_{\\text{eff}}^{\\text{ref}}$。\n- 相对于基准的泄漏相对误差，$\\left|L^{\\text{test}} - L^{\\text{ref}}\\right|/L^{\\text{ref}}$。\n- 相对于基准的通量相对 $\\ell_2$ 误差，$\\left\\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2 / \\left\\|\\boldsymbol{\\phi}^{\\text{ref}}\\right\\|_2$。\n\n测试套件（五个探索限制器强度和下限的案例）：\n1. $(\\alpha,\\varepsilon) = (0.0, 10^{-12})$,\n2. $(\\alpha,\\varepsilon) = (0.2, 10^{-8})$,\n3. $(\\alpha,\\varepsilon) = (0.5, 10^{-6})$,\n4. $(\\alpha,\\varepsilon) = (0.8, 10^{-4})$,\n5. $(\\alpha,\\varepsilon) = (1.0, 10^{-3})$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试案例的结果是按以下顺序排列的六个浮点数列表\n$$\n\\left[k_{\\text{eff}}, \\, \\text{leakage}, \\, \\max(p_i), \\, \\text{rel\\_}k\\text{\\_error}, \\, \\text{rel\\_leak\\_error}, \\, \\text{rel\\_flux\\_L2}\\right].\n$$\n例如，最终输出应如下所示\n$$\n\\left[\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right],\\left[\\cdots\\right]\\right].\n$$\n所有值都是无量纲的，不需要物理单位。问题不涉及角度，因此不需要角度单位。所有误差均以小数表示（而非百分比）。",
            "solution": "该问题要求使用幂迭代法求解非均匀方格上的二维、单群中子扩散 $k$-特征值问题，并分析一种负通量修正方案。\n\n### 1. 问题公式化\n连续问题由具有零 Dirichlet 边界条件（在边界 $\\partial \\Omega$ 上 $\\phi=0$）的稳态中子扩散方程控制：\n$$\n-\\nabla \\cdot \\left(D(\\mathbf{r}) \\nabla \\phi(\\mathbf{r})\\right) + \\Sigma_a(\\mathbf{r}) \\phi(\\mathbf{r}) = \\frac{1}{k_{\\text{eff}}} \\, \\nu \\Sigma_f(\\mathbf{r}) \\, \\phi(\\mathbf{r}) \\quad \\text{for } \\mathbf{r} \\in \\Omega\n$$\n使用格点中心有限差分法，在网格间距为 $h$ 的均匀笛卡尔网格上对此方程进行离散化，得到一个矩阵特征值问题：\n$$\n\\mathbf{A}\\boldsymbol{\\phi} = \\frac{1}{k_{\\text{eff}}} \\mathbf{F}\\boldsymbol{\\phi}\n$$\n在这里，$\\boldsymbol{\\phi}$ 是单元平均通量向量，$\\mathbf{A}$ 是代表销毁算子（扩散泄漏加吸收）的稀疏矩阵，$\\mathbf{F}$ 是代表裂变产生算子的对角矩阵，其对角线元素为 $(\\mathbf{F})_{ii} = f_i = (\\nu \\Sigma_f)_i$。问题描述使用了逐元素乘积表示法 $\\mathbf{f} \\odot \\boldsymbol{\\phi}$，它等价于 $\\mathbf{F}\\boldsymbol{\\phi}$。\n\n### 2. 离散化与矩阵构建\n我们为大小为 $N_x \\times N_y$ 的网格构建矩阵 $\\mathbf{A}$。二维单元索引 $(i,j)$ 映射到一维向量索引 $k = i \\cdot N_y + j$。矩阵 $\\mathbf{A}$ 的维度为 $(N_x N_y) \\times (N_x N_y)$。\n\n对于对应于网格位置 $(i,j)$ 的内部单元 $k$，平衡方程在乘以 $h^2$ 后为：\n$$\n\\left( \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} + \\Sigma_{a,k} \\right) \\phi_k - \\sum_{l \\in N(k)} \\frac{D_{k,l}}{h^2} \\phi_l = \\frac{1}{k_{\\text{eff}}} f_k \\phi_k\n$$\n其中 $N(k)$ 是单元 $k$ 的四个相邻邻居的集合，$D_{k,l}$ 是单元 $k$ 和 $l$ 之间界面上的扩散系数。问题指定了算术平均：$D_{k,l} = (D_k + D_l)/2$。当 $h=1$ 时，这会简化。\n\n因此，矩阵 $\\mathbf{A}$ 的元素为：\n- **非对角元素**：对于单元 $k$ 的一个邻居单元 $l$，矩阵元素为 $A_{k,l} = -D_{k,l}/h^2 = -(D_k + D_l)/2$。\n- **对角元素**：对角元素 $A_{k,k}$ 由吸收项和泄漏项组成。\n对于位于 $(i,j)$ 的内部单元 $k$：\n$$\nA_{k,k} = \\Sigma_{a,k} + \\frac{1}{h^2}\\left( D_{k, \\text{north}} + D_{k, \\text{south}} + D_{k, \\text{east}} + D_{k, \\text{west}} \\right)\n$$\n其中 $D_{k, \\text{direction}}$ 是界面平均的扩散系数。\n\n对于边界上的单元 $k$，问题规定，通过为每个边界表面在对角线上添加 $D_k/h^2$ 来强制执行零 Dirichlet 条件。这实际上意味着，对于一个边界表面，相邻通量为零，并且泄漏项被加到对角线上，而不是与外部节点耦合。对于左边界（$i=0$）上的单元 $k=(i,j)$，“西”侧邻居是边界。对对角线的贡献是 $D_k/h^2$，并且该表面没有非对角元素。\n对于 $h=1$ 时位于 $(i,j)$ 的单元 $k$，其对角元素 $A_{k,k}$ 的通用公式为：\n$$\nA_{k,k} = \\Sigma_{a,k} + C_N + C_S + C_E + C_W\n$$\n其中耦合项 $C$ 为：\n- $C_N = \\begin{cases} (D_{i,j}+D_{i,j+1})/2  \\text{若 } j  N_y-1 \\\\ D_{i,j}  \\text{若 } j = N_y-1 \\end{cases}$\n- $C_S = \\begin{cases} (D_{i,j}+D_{i,j-1})/2  \\text{若 } j > 0 \\\\ D_{i,j}  \\text{若 } j = 0 \\end{cases}$\n- $C_E = \\begin{cases} (D_{i,j}+D_{i+1,j})/2  \\text{若 } i  N_x-1 \\\\ D_{i,j}  \\text{若 } i = N_x-1 \\end{cases}$\n- $C_W = \\begin{cases} (D_{i,j}+D_{i-1,j})/2  \\text{若 } i > 0 \\\\ D_{i,j}  \\text{若 } i = 0 \\end{cases}$\n非对角项也相应设置。例如，对于对应于 $(i,j+1)$ 的邻居 $l$，如果 $j  N_y-1$，则 $A_{k,l} = -(D_{i,j}+D_{i,j+1})/2$。\n\n### 3. 数值求解算法\n该特征值问题使用裂变源迭代法（幂迭代）求解。给定特征值 $k^{(0)}$ 和特征向量 $\\boldsymbol{\\phi}^{(0)}$ 的初始猜测，算法按以下步骤进行迭代，其中 $m=0, 1, 2, \\dots$：\n\n1.  **计算裂变源**：使用当前通量和特征值计算下一次通量迭代的源项：\n    $$ \\mathbf{q}^{(m)} = \\frac{1}{k^{(m)}} \\, \\mathbf{f} \\odot \\boldsymbol{\\phi}^{(m)} $$\n\n2.  **求解通量**：通过求解代表扩散和吸收的线性系统来获得新的通量分布，源项为给定源：\n    $$ \\mathbf{A}\\boldsymbol{\\phi}^{(m+1)} = \\mathbf{q}^{(m)} $$\n    由于 $\\mathbf{A}$ 是一个稀疏矩阵，这个求解过程很高效。\n\n3.  **应用非负性修正**：由于数值精度或初始猜测的性质，得到的通量 $\\boldsymbol{\\phi}^{(m+1)}$ 可能包含小的负值。应用一个限制器来强制正性。对于每个单元 $i$：\n    $$ \\phi_i^{(m+1,\\text{fix})} = \\begin{cases} (1-\\alpha)\\,\\phi_i^{(m+1)} + \\alpha \\,\\varepsilon,   \\text{若 } \\phi_i^{(m+1)}  \\varepsilon,\\\\ \\phi_i^{(m+1)},  \\text{其他情况}. \\end{cases} $$\n    参数 $\\alpha$ 控制修正的强度，将计算出的负通量与一个小的正下限 $\\varepsilon$ 进行混合。\n\n4.  **更新特征值并归一化通量**：更新特征值和通量。首先，计算修正后通量的总裂变产额：$P^{(m+1)} = \\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}$。\n    特征值通过裂变产生率的比值进行更新：\n    $$ k^{(m+1)} = k^{(m)} \\, \\frac{\\sum_i f_i \\, \\phi_i^{(m+1,\\text{fix})}}{\\sum_i f_i \\, \\phi_i^{(m)}} $$\n    问题指定通量在每一步都被归一化，使得对于所有 $m \\ge 0$ 都有 $\\sum_i f_i \\, \\phi_i^{(m)} = 1$。这简化了更新过程为：\n    $$ k^{(m+1)} = k^{(m)} \\cdot P^{(m+1)} $$\n    然后为下一次迭代的通量向量重新进行归一化：\n    $$ \\boldsymbol{\\phi}^{(m+1)} = \\frac{\\boldsymbol{\\phi}^{(m+1,\\text{fix})}}{P^{(m+1)}} $$\n\n迭代持续进行，直到 $k_{\\text{eff}}$ 和 $\\boldsymbol{\\phi}$ 的相对变化都低于 $10^{-9}$ 的容差为止。\n\n### 4. 输出量计算\n收敛到 $k_{\\text{eff}}$ 和 $\\boldsymbol{\\phi}$ 后：\n- **总泄漏 ($L$)**：从中子扩散区域的总泄漏是所有边界表面上中子流的总和。对于边界上的一个单元 $k$，通过面积为 $h$ 的边界表面的向外流可近似为 $J_{\\text{out}} h = (D_k \\phi_k/h) h = D_k \\phi_k$。总泄漏是这些项在所有边界表面上的总和：\n$$ L = \\sum_{j=0}^{N_y-1} \\left( D_{0,j}\\phi_{0,j} + D_{N_x-1,j}\\phi_{N_x-1,j} \\right) + \\sum_{i=1}^{N_x-2} \\left( D_{i,0}\\phi_{i,0} + D_{i,N_y-1}\\phi_{i,N_y-1} \\right) $$\n该表达式正确计算了角单元，将其来自两个边界表面的贡献相加。\n- **棒功率 ($p_i$)**：单元 $i$ 中的棒功率是裂变率，$p_i = f_i \\phi_i$。最大棒功率是 $\\max_i(p_i)$。\n- **相对误差**：测试案例的误差是相对于使用 $\\alpha=0$ 和正初始通量获得的基准参考解（$\\text{ref}$）计算的：\n  - $\\text{rel\\_k\\_err} = |k_{\\text{eff}}^{\\text{test}} - k_{\\text{eff}}^{\\text{ref}}| / k_{\\text{eff}}^{\\text{ref}}$\n  - $\\text{rel\\_leak\\_err} = |L^{\\text{test}} - L^{\\text{ref}}| / L^{\\text{ref}}$\n  - $\\text{rel\\_flux\\_L2\\_err} = \\|\\boldsymbol{\\phi}^{\\text{test}} - \\boldsymbol{\\phi}^{\\text{ref}}\\|_2 / \\|\\boldsymbol{\\phi}^{\\text{ref}}\\|_2$\n\n### 5. 执行计划\n将实现一个 Python 脚本来执行以下步骤：\n1.  定义几何形状、材料属性，并创建材料分布图（$D$, $\\Sigma_a$, $f$）。\n2.  根据离散化规则构建稀疏矩阵 $\\mathbf{A}$。\n3.  实现一个执行幂迭代的求解器函数，包括修正步骤。\n4.  **基准运行**：使用 $\\alpha=0$、均匀正初始通量和初始 $k^{(0)}=1.0$ 调用求解器，以获得 $k_{\\text{eff}}^{\\text{ref}}$、$L^{\\text{ref}}$ 和 $\\boldsymbol{\\phi}^{\\text{ref}}$。\n5.  **测试套件运行**：对于五个 $(\\alpha, \\varepsilon)$ 测试案例中的每一个，生成指定的振荡初始通量，对其进行归一化，并调用求解器以获得测试案例结果。\n6.  为每个测试案例计算所需的输出量和相对误差。\n7.  将最终结果格式化为列表的列表并打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve():\n    \"\"\"\n    Solves the 2D neutron diffusion k-eigenvalue problem and analyzes negative flux fixup schemes.\n    \"\"\"\n    # 1. Setup: Problem Parameters and Material Properties\n    Nx, Ny = 10, 10\n    h = 1.0\n    N = Nx * Ny\n    tol = 1e-9\n    max_iter = 500\n\n    # Initialize material property arrays\n    D = np.full((Nx, Ny), 1.0)\n    Sigma_a = np.full((Nx, Ny), 0.08)\n    nuSigma_f = np.zeros((Nx, Ny))\n\n    # Assign fuel properties to central region (indices 3,4,5,6)\n    fuel_indices = slice(3, 7)\n    D[fuel_indices, fuel_indices] = 1.2\n    Sigma_a[fuel_indices, fuel_indices] = 0.20\n    nuSigma_f[fuel_indices, fuel_indices] = 0.40\n\n    # Flatten material properties to 1D vectors\n    D_vec = D.flatten()\n    Sigma_a_vec = Sigma_a.flatten()\n    f_vec = nuSigma_f.flatten()\n\n    # 2. Matrix Construction\n    A = lil_matrix((N, N))\n    for i in range(Nx):\n        for j in range(Ny):\n            k = i * Ny + j\n            \n            # Diagonal term from absorption\n            A[k, k] += Sigma_a_vec[k]\n\n            # Coupling to neighbors\n            # North\n            if j  Ny - 1:\n                l = i * Ny + (j + 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n            \n            # South\n            if j  0:\n                l = i * Ny + (j - 1)\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n\n            # East\n            if i  Nx - 1:\n                l = (i + 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n                \n            # West\n            if i  0:\n                l = (i - 1) * Ny + j\n                D_face = (D_vec[k] + D_vec[l]) / 2.0\n                A[k, k] += D_face / h**2\n                A[k, l] -= D_face / h**2\n            else: # Boundary\n                A[k, k] += D_vec[k] / h**2\n    \n    A_csc = csc_matrix(A)\n\n    def power_iteration(phi0, k0, alpha, epsilon):\n        phi = np.copy(phi0)\n        # Normalize initial flux\n        fission_prod = np.dot(f_vec, phi)\n        if np.abs(fission_prod)  1e-12: # Avoid division by zero\n            phi /= fission_prod\n        \n        k = k0\n\n        for _ in range(max_iter):\n            phi_old = np.copy(phi)\n            k_old = k\n\n            # 1. Fission Source\n            q = (1.0 / k) * (f_vec * phi)\n            \n            # 2. Solve for flux\n            phi_next_unfixed = spsolve(A_csc, q)\n\n            # 3. Apply fixup\n            phi_next_fixed = np.copy(phi_next_unfixed)\n            neg_indices = phi_next_fixed  epsilon\n            phi_next_fixed[neg_indices] = (1.0 - alpha) * phi_next_unfixed[neg_indices] + alpha * epsilon\n            \n            # 4. Update eigenvalue and renormalize flux\n            fission_prod_old = np.dot(f_vec, phi_old)\n            # This should be 1.0 after the first iteration\n            if abs(fission_prod_old)  1e-15: fission_prod_old = 1.0\n            \n            fission_prod_new = np.dot(f_vec, phi_next_fixed)\n\n            k = k_old * (fission_prod_new / fission_prod_old)\n            \n            if np.abs(fission_prod_new)  1e-12:\n                phi = phi_next_fixed / fission_prod_new\n            else: # Fission production collapsed, unlikely but handle\n                phi = np.zeros_like(phi)\n\n            # Convergence check\n            k_rel_err = np.abs(k - k_old) / k if k  0 else 0\n            phi_l2_norm = np.linalg.norm(phi, 2)\n            phi_rel_err = np.linalg.norm(phi - phi_old, 2) / phi_l2_norm if phi_l2_norm  0 else 0\n            \n            if k_rel_err  tol and phi_rel_err  tol:\n                break\n        \n        return k, phi\n\n    def calculate_leakage(phi_vec, D_vec):\n        leakage = 0.0\n        for i in range(Nx):\n            for j in range(Ny):\n                k = i * Ny + j\n                if i == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if i == Nx - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == 0:\n                    leakage += D_vec[k] * phi_vec[k]\n                if j == Ny - 1:\n                    leakage += D_vec[k] * phi_vec[k]\n        return leakage\n\n    # 3. Baseline Reference Calculation\n    phi0_ref = np.ones(N)\n    k0_ref = 1.0\n    k_ref, phi_ref = power_iteration(phi0_ref, k0_ref, alpha=0.0, epsilon=1e-12)\n    leakage_ref = calculate_leakage(phi_ref, D_vec)\n    phi_ref_norm = np.linalg.norm(phi_ref, 2)\n\n    # 4. Sensitivity Experiments\n    test_cases = [\n        (0.0, 1e-12),\n        (0.2, 1e-8),\n        (0.5, 1e-6),\n        (0.8, 1e-4),\n        (1.0, 1e-3),\n    ]\n    results = []\n\n    # Prepare oscillatory initial flux\n    phi0_test_grid = np.zeros((Nx, Ny))\n    for i in range(Nx):\n        for j in range(Ny):\n            phi0_test_grid[i, j] = 0.10 + 0.20 * np.sin(np.pi * i / Nx) * np.cos(2 * np.pi * j / Ny) - 0.15 * np.cos(np.pi * i / Nx)\n    phi0_test = phi0_test_grid.flatten()\n    k0_test = 1.0\n\n    for alpha_test, epsilon_test in test_cases:\n        k_test, phi_test = power_iteration(phi0_test, k0_test, alpha_test, epsilon_test)\n        \n        # Calculate required outputs\n        leakage_test = calculate_leakage(phi_test, D_vec)\n        pin_power_test = f_vec * phi_test\n        max_pin_power = np.max(pin_power_test)\n        \n        # Calculate relative errors\n        rel_k_error = np.abs(k_test - k_ref) / k_ref\n        rel_leak_error = np.abs(leakage_test - leakage_ref) / leakage_ref\n        rel_flux_l2_error = np.linalg.norm(phi_test - phi_ref, 2) / phi_ref_norm\n        \n        case_results = [\n            k_test,\n            leakage_test,\n            max_pin_power,\n            rel_k_error,\n            rel_leak_error,\n            rel_flux_l2_error\n        ]\n        results.append(case_results)\n\n    # 5. Final Output\n    # The output format requires a list of lists.\n    # The map converts each float to string for join, and str() on a list adds spaces.\n    # To get the exact format, we manually build the string representation.\n    output_str = \"[\" + \",\".join([f\"[{','.join(f'{v:.10e}' for v in res)}]\" for res in results]) + \"]\"\n\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}