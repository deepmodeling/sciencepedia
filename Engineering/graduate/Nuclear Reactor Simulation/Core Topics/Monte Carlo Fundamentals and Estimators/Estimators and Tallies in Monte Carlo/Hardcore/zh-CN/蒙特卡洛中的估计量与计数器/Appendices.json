{
    "hands_on_practices": [
        {
            "introduction": "在蒙特卡罗反应堆模拟中，我们得到的原始计数结果（例如，每次反应的率）的物理意义取决于通量的归一化方式。$k$-本征值计算中的一个核心挑战是，本征函数（中子通量）的绝对幅度是任意的，必须通过施加一个约束条件来确定。本练习将探讨两种常见的归一化方案，并推导它们之间的转换关系，这是将模拟原始输出转化为具有明确物理意义的量的关键一步。",
            "id": "4224230",
            "problem": "一个稳态中子输运问题通过蒙特卡罗 $k$-特征值模拟进行求解。该问题针对一个无外部源的均匀反应堆，其中裂变源驱动粒子数代代相传。在此类模拟中，通常使用两种通量归一化方法：每源粒子归一化和每裂变事件归一化。\n\n从稳态中子平衡的 $k$-特征值形式出发，其符号形式可写作：\n$$ \\mathcal{L}\\,\\phi = \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi, $$\n其中 $\\mathcal{L}$ 是流漏算符，$\\mathcal{F}$ 是裂变产生算符（包含每次裂变产生的平均中子数 $\\nu$），$k_{\\text{eff}}$ 是有效中子倍增因子。令总裂变率为 $F \\equiv \\int_{V}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$，总裂变中子产生率为 $P \\equiv \\int_{V}\\nu(\\mathbf{r},E)\\,\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$。令 $R_{r} \\equiv \\int_{V}\\Sigma_{r}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}V\\,\\mathrm{d}E$ 表示某种反应 $r$ 的体积积分反应率。\n\n请解释每源粒子归一化和每裂变事件归一化在 $\\phi$ 的标定方式以及 $F$ 和 $P$ 如何与 $k_{\\text{eff}}$ 相关联方面的概念差异。然后，使用第一性原理定义，推导一个通用表达式，用于将以每源粒子报告的反应率统计值 $R_{r}$ 转换为相应的每裂变事件归一化的反应率。\n\n最后，将您的推导应用于同一次 $k$-特征值模拟中测得的以下统计值（均以每源粒子报告）：\n- 有效倍增因子 $k_{\\text{eff}} = 1.0150$，\n- 体积积分裂变率 $F_{\\text{s}} = 0.4150$，\n- 体积积分裂变中子产生率 $P_{\\text{s}} = 1.0150$，\n- 反应 $r$（吸收材料中一种特定的俘获反应）的体积积分反应率 $R_{r,\\text{s}} = 0.00790$。\n\n计算 $R_{r}$ 的每裂变事件归一化值，并以“每次裂变事件的事件数”为单位表示您的最终结果。将答案四舍五入至四位有效数字。",
            "solution": "所提出的问题具有科学依据，是自洽且适定的。所提供的定义和方程在核反应堆物理和蒙特卡罗方法领域是标准的。数值与理论框架一致，特别是所报告的 $k_{\\text{eff}}$ 与每源粒子的裂变中子产生率之间的等同性，这是所选归一化方法的一个已知结果。因此，该问题被认为是有效的，可以构建一个解决方案。\n\n问题要求三个部分：对两种常用归一化方案的概念性解释，推导它们之间的转换公式，以及将此公式应用于一组特定的统计值。\n\n首先，我们讨论这两种归一化方案之间的概念差异。稳态 $k$-特征值中子平衡方程\n$$ \\mathcal{L}\\,\\phi = \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi $$\n的基本解是本征函数 $\\phi$，它代表中子通量分布。与任何本征函数一样，其绝对幅度是任意的；该方程只决定其形状。为了获得定量的反应率，必须对通量进行归一化。这是通过对通量的某个积分性质施加约束来实现的。\n\n在每源粒子归一化中（通常用于蒙特卡罗 $k$-特征值模拟），通量幅度被标定，使得下一代总源强度为1。在由裂变源驱动的模拟中，第 $n+1$ 代的中子源是第 $n$ 代裂变产生的中子群体。该源的算符是 $\\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}$。让经每源粒子归一化的通量表示为 $\\phi_{\\text{s}}$。总源强度是源项在整个相空间上的积分。因此，归一化条件是：\n$$ \\int_{V}\\int_{E} \\frac{1}{k_{\\text{eff}}}\\,\\mathcal{F}\\,\\phi_{\\text{s}}(\\mathbf{r},E) \\,\\mathrm{d}E\\,\\mathrm{d}V = 1 $$\n根据定义，总裂变中子产生率是 $P_{\\text{s}} = \\int_{V}\\int_{E} \\mathcal{F}\\,\\phi_{\\text{s}}(\\mathbf{r},E) \\,\\mathrm{d}E\\,\\mathrm{d}V$。将此代入归一化条件，得到：\n$$ \\frac{P_{\\text{s}}}{k_{\\text{eff}}} = 1 \\implies P_{\\text{s}} = k_{\\text{eff}} $$\n这个恒等式证实了，在每源粒子归一化的系统中，总裂变中子产生率的统计值在数值上等于有效倍增因子 $k_{\\text{eff}}$。问题陈述中提供了 $k_{\\text{eff}} = 1.0150$ 和 $P_{\\text{s}} = 1.0150$，这与此原理一致。任何反应率统计值 $R_{r,\\text{s}}$ 于是以“每模拟源粒子的 $r$ 类事件数”为单位报告。\n\n在每裂变事件归一化中，通量幅度被标定，使得系统中发生的总裂变事件数为1。让此通量表示为 $\\phi_{\\text{f}}$。总裂变率定义为 $F \\equiv \\int_{V}\\int_{E}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi(\\mathbf{r},E)\\,\\mathrm{d}E\\,\\mathrm{d}V$。因此，归一化条件是：\n$$ F_{\\text{f}} = \\int_{V}\\int_{E}\\Sigma_{f}(\\mathbf{r},E)\\,\\phi_{\\text{f}}(\\mathbf{r},E)\\,\\mathrm{d}E\\,\\mathrm{d}V = 1 $$\n使用这种归一化，反应率统计值 $R_{r,\\text{f}}$ 以“系统中每裂变事件的 $r$ 类事件数”为单位报告。总裂变中子产生率 $P_{\\text{f}}$ 将是每次裂变事件产生的平均中子数，通常表示为 $\\bar{\\nu}$。\n\n接下来，我们推导转换公式。由于 $\\phi_{\\text{s}}$ 和 $\\phi_{\\text{f}}$ 代表相同的基本模态（本征函数），它们必须成比例。我们可以写出：\n$$ \\phi_{\\text{f}} = C \\cdot \\phi_{\\text{s}} $$\n其中 $C$ 是一个常数转换因子。为了求出 $C$，我们使用每裂变事件归一化的定义。\n$$ F_{\\text{f}} = 1 = \\int_{V}\\int_{E}\\Sigma_{f}\\,\\phi_{\\text{f}}\\,\\mathrm{d}E\\,\\mathrm{d}V = \\int_{V}\\int_{E}\\Sigma_{f}\\,(C \\cdot \\phi_{\\text{s}})\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n将常数 $C$ 提出：\n$$ 1 = C \\cdot \\int_{V}\\int_{E}\\Sigma_{f}\\,\\phi_{\\text{s}}\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n右侧的积分根据定义是每源粒子的裂变率 $F_{\\text{s}}$。\n$$ 1 = C \\cdot F_{\\text{s}} \\implies C = \\frac{1}{F_{\\text{s}}} $$\n现在我们可以转换任意反应率 $R_{r}$。每裂变事件的反应率为 $R_{r,\\text{f}}$，每源粒子的反应率为 $R_{r,\\text{s}}$。\n$$ R_{r,\\text{f}} = \\int_{V}\\int_{E}\\Sigma_{r}\\,\\phi_{\\text{f}}\\,\\mathrm{d}E\\,\\mathrm{d}V = \\int_{V}\\int_{E}\\Sigma_{r}\\,\\left(\\frac{1}{F_{\\text{s}}}\\phi_{\\text{s}}\\right)\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n$$ R_{r,\\text{f}} = \\frac{1}{F_{\\text{s}}} \\int_{V}\\int_{E}\\Sigma_{r}\\,\\phi_{\\text{s}}\\,\\mathrm{d}E\\,\\mathrm{d}V $$\n该积分是 $R_{r,\\text{s}}$ 的定义。因此，将反应率统计值从每源粒子转换为每裂变事件的通用表达式为：\n$$ R_{r,\\text{f}} = \\frac{R_{r,\\text{s}}}{F_{\\text{s}}} $$\n这表明，要将任何统计值从每源粒子基准转换为每裂变事件基准，必须将该统计值除以在每源粒子基准上计算出的总裂变率。\n\n最后，我们应用此推导来计算所要求的值。问题提供了以下统计值，均以每源粒子报告：\n- 体积积分裂变率：$F_{\\text{s}} = 0.4150$\n- 反应 $r$ 的体积积分反应率：$R_{r,\\text{s}} = 0.00790$\n\n使用推导出的公式：\n$$ R_{r,\\text{f}} = \\frac{R_{r,\\text{s}}}{F_{\\text{s}}} = \\frac{0.00790}{0.4150} $$\n计算数值：\n$$ R_{r,\\text{f}} \\approx 0.019036144... $$\n输入数据中的有效数字位数，$R_{r,\\text{s}}$ ($0.00790$) 为三位，$F_{\\text{s}}$ ($0.4150$) 为四位。标准的科学实践要求除法运算的结果应以较少的有效数字位数报告，即三位。然而，问题给出了明确的指令“将答案四舍五入至四位有效数字”。遵循这一直接要求，我们将结果四舍五入至四位有效数字。\n$$ R_{r,\\text{f}} \\approx 0.01904 $$\n此值表示反应堆中每次裂变事件发生的反应 $r$ 的事件数。",
            "answer": "$$\\boxed{0.01904}$$"
        },
        {
            "introduction": "蒙特卡罗方法的一个主要缺点是其收敛速度较慢，通常为 $N^{-1/2}$。为了在可接受的计算时间内获得足够精确的结果，必须采用方差缩减技术。本练习通过一个基于碰撞阶数的简化模型，深入探讨了分层抽样这一强大的方差缩减方法，旨在从基本原理上阐明分层抽样为何能减少方差，并推导如何最优地分配样本和组合估计量。",
            "id": "4224231",
            "problem": "考虑一个均匀的各向同性散射介质，其中一个蒙特卡罗 (MC) 粒子历史通过碰撞估计量为吸收反应率统计产生一个单历史得分。令单历史统计得分为随机变量 $X$，并令 $K \\in \\{1,2,3\\}$ 表示对反应贡献进行计分的历史的碰撞次数。无条件目标是每个源历史的反应率 $R = \\mathbb{E}[X]$。假设在自然、非分层抽样的历史中：$\\mathbb{P}(K = 1) = p_{1} = \\frac{1}{2}$，$\\mathbb{P}(K = 2) = p_{2} = \\frac{3}{10}$，$\\mathbb{P}(K = 3) = p_{3} = \\frac{1}{5}$；并且在给定 $K = k$ 时，$X$ 的条件矩为 $\\mathbb{E}[X \\mid K = 1] = \\mu_{1} = \\frac{4}{5}$，$\\mathbb{E}[X \\mid K = 2] = \\mu_{2} = \\frac{1}{2}$，$\\mathbb{E}[X \\mid K = 3] = \\mu_{3} = \\frac{1}{5}$，以及 $\\operatorname{Var}(X \\mid K = 1) = \\sigma_{1}^{2} = 2$，$\\operatorname{Var}(X \\mid K = 2) = \\sigma_{2}^{2} = 1$，$\\operatorname{Var}(X \\mid K = 3) = \\sigma_{3}^{2} = \\frac{1}{2}$。您可以假设各个历史是独立的。\n\n1. 仅使用全期望定律和全方差定律作为基础，推导由 $N$ 个无分层的独立历史构成的 $R$ 的简单随机抽样估计量 $\\bar{X}_{N}$ 的方差。然后，在固定分配 $n_{k}$ 且 $\\sum_{k=1}^{3} n_{k} = N$ 的条件下，推导分层估计量 $\\hat{R}_{\\text{strat}} = \\sum_{k=1}^{3} p_{k} \\bar{X}_{k}$ 的方差，其中 $\\bar{X}_{k}$ 是来自层 $K = k$ 的得分的样本均值。将此结果特化为按比例分配 $n_{k} = N p_{k}$ 的情况，并对于 $N = 900$ 的情况，明确展示按碰撞次数分层相对于简单随机抽样如何减少方差，并量化减少量。\n\n2. 从第一性原理出发，推导在所有满足 $\\sum_{k=1}^{3} n_{k} = N$ 的分配中，使 $\\hat{R}_{\\text{strat}}$ 方差最小的最优分配 $n_{k}$（以 $N$、$p_{k}$ 和 $\\sigma_{k}$ 的封闭形式表达式给出），假设每个层中每个历史的计算成本相等。\n\n3. 现在考虑对同一反应率 $R$ 的三个独立无偏估计量 $\\hat{R}_{1}$、$\\hat{R}_{2}$ 和 $\\hat{R}_{3}$，它们分别通过将历史条件化为恰好在碰撞次数 $K=1$、$K=2$ 和 $K=3$ 时发生碰撞来构建（例如，通过轮盘赌与粒子分裂或路径条件化），因此每个 $\\hat{R}_{k}$ 对 $R$ 都是无偏的，但具有不同的方差 $v_{1} = 2$、$v_{2} = 1$ 和 $v_{3} = \\frac{1}{2}$。推导线性无偏组合 $\\hat{R}_{\\text{comb}} = w_{1} \\hat{R}_{1} + w_{2} \\hat{R}_{2} + w_{3} \\hat{R}_{3}$ 在约束条件 $w_{1} + w_{2} + w_{3} = 1$ 下的最优方差最小化权重 $w_{1}$、$w_{2}$ 和 $w_{3}$，并计算它们的数值。将最终权重表示为一个包含精确分数的三元行向量，且不包含单位。\n\n在可能的情况下，将您需要计算的任何数值四舍五入到精确分数；本问题中不需要按有效数字进行四舍五入。最终报告的答案必须是所要求的行向量。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、定义明确的，并包含足够的信息以获得唯一解。该问题是统计学原理在粒子输运中蒙特卡罗估计量上的标准应用，所有提供的数据都是内部一致的。我们将开始求解。\n\n问题分为三个部分。我们将按顺序解决每个部分。\n\n**第 1 部分：简单随机抽样 (SRS) 与分层抽样的方差**\n\n首先，我们计算单历史得分 $X$ 的无条件均值 $R = \\mathbb{E}[X]$ 和方差 $\\operatorname{Var}(X)$。给定条件是层概率 $p_k = \\mathbb{P}(K=k)$ 以及对于层 $k \\in \\{1, 2, 3\\}$ 的条件矩 $\\mu_k = \\mathbb{E}[X \\mid K=k]$ 和 $\\sigma_k^2 = \\operatorname{Var}(X \\mid K=k)$。\n\n根据全期望定律，无条件均值为：\n$$\nR = \\mathbb{E}[X] = \\sum_{k=1}^{3} \\mathbb{E}[X \\mid K=k] \\mathbb{P}(K=k) = \\sum_{k=1}^{3} \\mu_k p_k\n$$\n代入给定值：\n$$\nR = \\left(\\frac{4}{5}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{3}{10}\\right) + \\left(\\frac{1}{5}\\right)\\left(\\frac{1}{5}\\right) = \\frac{4}{10} + \\frac{3}{20} + \\frac{1}{25} = \\frac{40+15+4}{100} = \\frac{59}{100}\n$$\n\n接下来，我们使用全方差定律来求无条件方差 $\\operatorname{Var}(X)$：\n$$\n\\operatorname{Var}(X) = \\mathbb{E}[\\operatorname{Var}(X \\mid K)] + \\operatorname{Var}(\\mathbb{E}[X \\mid K])\n$$\n第一项是条件方差的期望：\n$$\n\\mathbb{E}[\\operatorname{Var}(X \\mid K)] = \\sum_{k=1}^{3} \\operatorname{Var}(X \\mid K=k) \\mathbb{P}(K=k) = \\sum_{k=1}^{3} \\sigma_k^2 p_k\n$$\n$$\n\\mathbb{E}[\\operatorname{Var}(X \\mid K)] = (2)\\left(\\frac{1}{2}\\right) + (1)\\left(\\frac{3}{10}\\right) + \\left(\\frac{1}{2}\\right)\\left(\\frac{1}{5}\\right) = 1 + \\frac{3}{10} + \\frac{1}{10} = 1 + \\frac{4}{10} = \\frac{14}{10} = \\frac{7}{5}\n$$\n第二项是条件期望的方差：\n$$\n\\operatorname{Var}(\\mathbb{E}[X \\mid K]) = \\mathbb{E}[(\\mathbb{E}[X \\mid K])^2] - (\\mathbb{E}[\\mathbb{E}[X \\mid K]])^2 = \\left(\\sum_{k=1}^{3} \\mu_k^2 p_k\\right) - R^2\n$$\n我们计算平方和：\n$$\n\\sum_{k=1}^{3} \\mu_k^2 p_k = \\left(\\frac{4}{5}\\right)^2\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{2}\\right)^2\\left(\\frac{3}{10}\\right) + \\left(\\frac{1}{5}\\right)^2\\left(\\frac{1}{5}\\right) = \\left(\\frac{16}{25}\\right)\\left(\\frac{1}{2}\\right) + \\left(\\frac{1}{4}\\right)\\left(\\frac{3}{10}\\right) + \\left(\\frac{1}{25}\\right)\\left(\\frac{1}{5}\\right)\n$$\n$$\n\\sum_{k=1}^{3} \\mu_k^2 p_k = \\frac{16}{50} + \\frac{3}{40} + \\frac{1}{125} = \\frac{320+75+8}{1000} = \\frac{403}{1000}\n$$\n因此，条件期望的方差为：\n$$\n\\operatorname{Var}(\\mathbb{E}[X \\mid K]) = \\frac{403}{1000} - \\left(\\frac{59}{100}\\right)^2 = \\frac{4030}{10000} - \\frac{3481}{10000} = \\frac{549}{10000}\n$$\n因此，总方差为：\n$$\n\\operatorname{Var}(X) = \\frac{7}{5} + \\frac{549}{10000} = \\frac{14000}{10000} + \\frac{549}{10000} = \\frac{14549}{10000}\n$$\n对于由 $N$ 个独立历史组成的简单随机抽样估计量 $\\bar{X}_{N} = \\frac{1}{N}\\sum_{i=1}^{N} X_i$，其方差为：\n$$\n\\operatorname{Var}(\\bar{X}_{N}) = \\frac{\\operatorname{Var}(X)}{N} = \\frac{1}{N}\\left(\\frac{14549}{10000}\\right)\n$$\n现在，考虑分层估计量 $\\hat{R}_{\\text{strat}} = \\sum_{k=1}^{3} p_{k} \\bar{X}_{k}$，其中 $\\bar{X}_{k}$ 是来自层 $k$ 的 $n_k$ 个得分的样本均值。来自不同层的样本是独立的，因此方差为：\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{strat}}) = \\operatorname{Var}\\left(\\sum_{k=1}^{3} p_{k} \\bar{X}_{k}\\right) = \\sum_{k=1}^{3} p_{k}^2 \\operatorname{Var}(\\bar{X}_{k})\n$$\n在层 $k$ 中样本均值的方差为 $\\operatorname{Var}(\\bar{X}_{k}) = \\frac{\\operatorname{Var}(X \\mid K=k)}{n_k} = \\frac{\\sigma_k^2}{n_k}$。因此，对于固定分配 $\\{n_k\\}$，分层估计量的方差为：\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{strat}}) = \\sum_{k=1}^{3} \\frac{p_{k}^2 \\sigma_k^2}{n_k}\n$$\n对于按比例分配，我们设置 $n_k = N p_k$。将此代入方差表达式：\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{strat, prop}}) = \\sum_{k=1}^{3} \\frac{p_{k}^2 \\sigma_k^2}{N p_k} = \\frac{1}{N} \\sum_{k=1}^{3} p_k \\sigma_k^2\n$$\n这恰好是层内方差分量，按 $1/N$ 缩放：\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{strat, prop}}) = \\frac{1}{N} \\mathbb{E}[\\operatorname{Var}(X \\mid K)] = \\frac{1}{N}\\left(\\frac{7}{5}\\right)\n$$\n为了量化 $N=900$ 时的方差缩减，我们比较两种方差：\n$$\n\\operatorname{Var}(\\bar{X}_{900}) = \\frac{1}{900}\\left(\\frac{14549}{10000}\\right) = \\frac{14549}{9000000}\n$$\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{strat, prop}}) = \\frac{1}{900}\\left(\\frac{7}{5}\\right) = \\frac{1}{900}\\left(\\frac{14000}{10000}\\right) = \\frac{14000}{9000000}\n$$\n方差的绝对减少量为：\n$$\n\\operatorname{Var}(\\bar{X}_{900}) - \\operatorname{Var}(\\hat{R}_{\\text{strat, prop}}) = \\frac{14549 - 14000}{9000000} = \\frac{549}{9000000}\n$$\n这个减少量恰好是层间方差分量 $\\frac{\\operatorname{Var}(\\mathbb{E}[X \\mid K])}{N}$，按比例分配的分层抽样消除了这一项。\n\n**第 2 部分：分层抽样的最优分配**\n\n我们寻求最小化分层估计量的方差 $V(n_1, n_2, n_3) = \\sum_{k=1}^{3} \\frac{p_{k}^2 \\sigma_k^2}{n_k}$，约束条件为总样本数固定：$g(n_1, n_2, n_3) = \\sum_{k=1}^{3} n_k - N = 0$。我们采用拉格朗日乘数法。拉格朗日函数为：\n$$\nL(n_1, n_2, n_3, \\lambda) = \\sum_{k=1}^{3} \\frac{p_k^2 \\sigma_k^2}{n_k} + \\lambda\\left(\\sum_{k=1}^{3} n_k - N\\right)\n$$\n为求最小值，我们将关于每个 $n_k$ 的偏导数设为零：\n$$\n\\frac{\\partial L}{\\partial n_k} = -\\frac{p_k^2 \\sigma_k^2}{n_k^2} + \\lambda = 0 \\quad \\implies \\quad n_k^2 = \\frac{p_k^2 \\sigma_k^2}{\\lambda}\n$$\n取正平方根，因为样本量必须为正，我们得到 $n_k = \\frac{p_k \\sigma_k}{\\sqrt{\\lambda}}$。\n我们将其代入约束方程以求解 $\\sqrt{\\lambda}$：\n$$\n\\sum_{k=1}^{3} n_k = \\sum_{k=1}^{3} \\frac{p_k \\sigma_k}{\\sqrt{\\lambda}} = \\frac{1}{\\sqrt{\\lambda}} \\sum_{j=1}^{3} p_j \\sigma_j = N\n$$\n这得出 $\\frac{1}{\\sqrt{\\lambda}} = \\frac{N}{\\sum_{j=1}^{3} p_j \\sigma_j}$。\n将其代回 $n_k$ 的表达式，我们得到最优分配，即所谓的奈曼分配 (Neyman allocation)：\n$$\nn_k = N \\frac{p_k \\sigma_k}{\\sum_{j=1}^{3} p_j \\sigma_j}\n$$\n该表达式给出了每个层 $k$ 的最优样本数 $n_k$，作为总样本数 $N$、层概率 $p_k$ 和层标准差 $\\sigma_k$ 的函数。\n\n**第 3 部分：独立估计量的最优组合**\n\n给定三个针对同一量 $R$ 的独立无偏估计量 $\\hat{R}_1, \\hat{R}_2, \\hat{R}_3$，其方差分别为 $v_1, v_2, v_3$。我们构建一个线性组合 $\\hat{R}_{\\text{comb}} = \\sum_{k=1}^{3} w_k \\hat{R}_k$。\n该估计量必须是无偏的，即 $\\mathbb{E}[\\hat{R}_{\\text{comb}}] = R$。\n$$\n\\mathbb{E}\\left[\\sum_{k=1}^{3} w_k \\hat{R}_k\\right] = \\sum_{k=1}^{3} w_k \\mathbb{E}[\\hat{R}_k] = \\sum_{k=1}^{3} w_k R = R \\sum_{k=1}^{3} w_k\n$$\n为了使其等于 $R$，我们必须有约束条件 $\\sum_{k=1}^{3} w_k = 1$。\n由于 $\\hat{R}_k$ 的独立性，组合估计量的方差为：\n$$\n\\operatorname{Var}(\\hat{R}_{\\text{comb}}) = \\operatorname{Var}\\left(\\sum_{k=1}^{3} w_k \\hat{R}_k\\right) = \\sum_{k=1}^{3} w_k^2 \\operatorname{Var}(\\hat{R}_k) = \\sum_{k=1}^{3} w_k^2 v_k\n$$\n我们的目标是在无偏性约束下最小化此方差。我们再次使用拉格朗日乘数法。拉格朗日函数为：\n$$\nL(w_1, w_2, w_3, \\lambda) = \\sum_{k=1}^{3} w_k^2 v_k - \\lambda\\left(\\sum_{k=1}^{3} w_k - 1\\right)\n$$\n将关于每个 $w_k$ 的偏导数设为零：\n$$\n\\frac{\\partial L}{\\partial w_k} = 2 w_k v_k - \\lambda = 0 \\quad \\implies \\quad w_k = \\frac{\\lambda}{2 v_k}\n$$\n这表明最优权重与单个估计量的方差成反比。\n我们将此结果代入约束方程以求得 $\\lambda$：\n$$\n\\sum_{k=1}^{3} w_k = \\sum_{k=1}^{3} \\frac{\\lambda}{2 v_k} = \\frac{\\lambda}{2} \\sum_{j=1}^{3} \\frac{1}{v_j} = 1\n$$\n这得出 $\\frac{\\lambda}{2} = \\left(\\sum_{j=1}^{3} \\frac{1}{v_j}\\right)^{-1}$。\n将其代回 $w_k$ 的表达式，我们得到最优权重：\n$$\nw_k = \\frac{1/v_k}{\\sum_{j=1}^{3} (1/v_j)}\n$$\n现在我们使用给定的方差计算数值：$v_1=2$，$v_2=1$ 和 $v_3=1/2$。\n方差的倒数是：\n$1/v_1 = 1/2$\n$1/v_2 = 1/1 = 1$\n$1/v_3 = 1/(1/2) = 2$\n方差倒数之和为：\n$$\n\\sum_{j=1}^{3} \\frac{1}{v_j} = \\frac{1}{2} + 1 + 2 = \\frac{1+2+4}{2} = \\frac{7}{2}\n$$\n因此，最优权重为：\n$$\nw_1 = \\frac{1/2}{7/2} = \\frac{1}{7}\n$$\n$$\nw_2 = \\frac{1}{7/2} = \\frac{2}{7}\n$$\n$$\nw_3 = \\frac{2}{7/2} = \\frac{4}{7}\n$$\n最终权重为 $(w_1, w_2, w_3) = (1/7, 2/7, 4/7)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{7}  \\frac{2}{7}  \\frac{4}{7} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在反应堆物理中，许多重要的物理量，如有效增殖因数 $k_{\\text{eff}}$ 或转换比，都是通过两个或多个蒙特卡罗计数的比值来估计的。由于这些计数通常源自相同的粒子历史，它们之间存在相关性，这使得不确定性分析变得复杂。本练习将以反照率的估计为例，演示如何处理这类比值估计量，并应用一阶不确定性传播方法（即Delta方法）来正确推导其统计方差。",
            "id": "4224240",
            "problem": "考虑一个平面板中的稳态单速中子输运问题，其中一个平面 $\\mathcal{S}$ 将两个区域分开。令 $\\mathbf{n}$ 为 $\\mathcal{S}$ 上的单位法向量，指向我们关心区域的外部。角通量为 $\\psi(\\mathbf{r},\\mathbf{\\Omega})$，其中 $\\mathbf{r}$ 是位置，$\\mathbf{\\Omega}$ 是方向。通过 $\\mathcal{S}$ 的出射和入射部分流（partial currents）定义如下\n$$\nJ_{+} \\equiv \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} (\\mathbf{\\Omega}\\cdot \\mathbf{n}) \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S,\\qquad\nJ_{-} \\equiv \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} |\\mathbf{\\Omega}\\cdot \\mathbf{n}| \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S.\n$$\n在 $\\mathcal{S}$ 处的反照率是无量纲比值 $A \\equiv J_{+}/J_{-}$。\n\n使用 $N$ 个独立源史进行蒙特卡罗（MC）模拟。由于输运、碰撞以及所使用的任何粒子数控制技术，每个史 $i$ 在 $\\mathcal{S}$ 处生成一组随机加权的粒子穿面事件。对于史 $i$ 中的每个穿面事件 $j$，令 $w_{ij}$ 为穿面时的粒子统计权重，$\\mu_{ij} \\equiv \\mathbf{\\Omega}_{ij}\\cdot \\mathbf{n}$ 为其相对于 $\\mathbf{n}$ 的方向余弦。定义每个史的出射和入射流贡献如下\n$$\nX_{i} \\equiv \\sum_{j \\in \\text{outgoing}} w_{ij}\\, \\mu_{ij},\\qquad\nY_{i} \\equiv \\sum_{j \\in \\text{incoming}} w_{ij}\\, |\\mu_{ij}|.\n$$\n假设对于每个史 $i$，数对 $(X_{i},Y_{i})$ 是一个具有有限一阶矩和二阶矩的平方可积随机向量，并且这些数对在不同史之间是独立同分布的，但由于共享的输运实现和方差缩减操作，在单个史内部可能存在相关性。令 $\\mu_{X} \\equiv \\mathbb{E}[X_{i}]$, $\\mu_{Y} \\equiv \\mathbb{E}[Y_{i}]$, $\\sigma_{X}^{2} \\equiv \\mathrm{Var}(X_{i})$, $\\sigma_{Y}^{2} \\equiv \\mathrm{Var}(Y_{i})$, 以及 $\\sigma_{XY} \\equiv \\mathrm{Cov}(X_{i},Y_{i})$。\n\n定义样本均值 $\\bar{X} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} X_{i}$ 和 $\\bar{Y} \\equiv \\frac{1}{N}\\sum_{i=1}^{N} Y_{i}$，以及反照率的比值估计量 $\\hat{A} \\equiv \\bar{X}/\\bar{Y}$。从 $J_{+}$ 和 $J_{-}$ 的定义以及蒙特卡罗中部分流的无偏穿面流估计量出发，证明当 $N \\to \\infty$ 时，$\\hat{A}$ 是 $A$ 的一个相合估计量，即 $\\hat{A}$ 以 $A$ 为目标。然后，利用 $(\\bar{X},\\bar{Y})$ 的联合渐近正态性以及适用于相关随机变量的一阶不确定性传播，推导出渐近方差 $\\mathrm{Var}(\\hat{A})$ 的闭式解，该解是 $\\mu_{X}$、$\\mu_{Y}$、$\\sigma_{X}^{2}$、$\\sigma_{Y}^{2}$、$\\sigma_{XY}$ 和 $N$ 的函数。\n\n将最终答案表示为单个闭式解析表达式。不需要进行数值舍入，反照率及其不确定性是无量纲的。",
            "solution": "该问题要求得到关于蒙特卡罗反照率估计的两个结果。首先，我们必须证明比值估计量 $\\hat{A} = \\bar{X}/\\bar{Y}$ 是真实反照率 $A = J_{+}/J_{-}$ 的一个相合估计量。其次，我们必须推导出该估计量的渐近方差 $\\mathrm{Var}(\\hat{A})$。\n\n**第一部分：估计量 $\\hat{A}$ 的相合性**\n\n估计量的相合性意味着随着样本数量趋于无穷大，估计量依概率收敛于被估量的真值。在这里，我们必须证明当 $N \\to \\infty$ 时，$\\hat{A} \\xrightarrow{p} A$。\n\n量 $J_{+}$ 和 $J_{-}$ 是真实的出射和入射部分流，定义为角中子通量 $\\psi(\\mathbf{r},\\mathbf{\\Omega})$ 的积分：\n$$J_{+} = \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} (\\mathbf{\\Omega}\\cdot \\mathbf{n}) \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S$$\n$$J_{-} = \\int_{\\mathcal{S}} \\int_{\\mathbf{\\Omega}\\cdot \\mathbf{n}  0} |\\mathbf{\\Omega}\\cdot \\mathbf{n}| \\,\\psi(\\mathbf{r},\\mathbf{\\Omega})\\, \\mathrm{d}\\mathbf{\\Omega}\\, \\mathrm{d}S$$\n真实的反照率是比值 $A = J_{+}/J_{-}$。\n\n在蒙特卡罗模拟中，计分值 $X_{i}$ 和 $Y_{i}$ 分别是每个史的出射流和入射流的记录值。穿面估计量的构造是无偏的。这意味着记录值的期望与我们关心的物理量成正比。设 $\\mu_X = \\mathbb{E}[X_i]$ 和 $\\mu_Y = \\mathbb{E}[Y_i]$ 为每个史的期望计分值。由于穿面估计量的无偏性，这些期望计分值与真实的部分流成正比，具有相同的比例常数 $C$，该常数与源的归一化有关：\n$$ \\mu_X = C J_{+} $$\n$$ \\mu_Y = C J_{-} $$\n因此，期望计分值的比值恰好是反照率：\n$$ \\frac{\\mu_X}{\\mu_Y} = \\frac{C J_{+}}{C J_{-}} = \\frac{J_{+}}{J_{-}} = A $$\n我们假设 $J_{-} \\neq 0$，因此 $\\mu_Y \\neq 0$，这是反照率能够被良好定义的必要条件。\n\n问题陈述，对于 $i=1, \\dots, N$，数对 $(X_i, Y_i)$ 是具有有限一阶矩 $\\mu_X$ 和 $\\mu_Y$ 的独立同分布（i.i.d.）随机向量。样本均值为 $\\bar{X} = \\frac{1}{N}\\sum_{i=1}^{N} X_{i}$ 和 $\\bar{Y} = \\frac{1}{N}\\sum_{i=1}^{N} Y_{i}$。\n\n根据大数定律（LLN），对于具有有限均值的独立同分布随机变量，样本均值依概率收敛于真实均值。将大数定律应用于我们的估计量，我们得到：\n$$ \\bar{X} \\xrightarrow{p} \\mu_X \\quad \\text{as } N \\to \\infty $$\n$$ \\bar{Y} \\xrightarrow{p} \\mu_Y \\quad \\text{as } N \\to \\infty $$\n反照率估计量是 $\\hat{A} = \\bar{X}/\\bar{Y}$。我们可以将其写成函数 $g(\\bar{X}, \\bar{Y})$ 的形式，其中 $g(x,y) = x/y$。函数 $g$ 在所有 $y \\neq 0$ 的点 $(x,y)$ 处是连续的。由于我们假设了 $\\mu_Y \\neq 0$，因此该函数在 $(\\mu_X, \\mu_Y)$ 点是连续的。\n\n根据连续映射定理（Slutsky 定理的一个推论），如果一个随机向量序列依概率收敛于一个常数向量，那么该序列的任何连续函数都依概率收敛于该常数向量的函数。因此：\n$$ \\hat{A} = g(\\bar{X}, \\bar{Y}) \\xrightarrow{p} g(\\mu_X, \\mu_Y) = \\frac{\\mu_X}{\\mu_Y} $$\n既然我们已经确定 $\\mu_X / \\mu_Y = A$，那么可以得出：\n$$ \\hat{A} \\xrightarrow{p} A $$\n这证明了 $\\hat{A}$ 是反照率 $A$ 的一个相合估计量。\n\n**第二部分：$\\hat{A}$ 的渐近方差**\n\n为了求出 $\\hat{A}$ 的渐近方差，我们使用函数 $g(\\bar{X}, \\bar{Y}) = \\bar{X}/\\bar{Y}$ 在均值点 $(\\mu_X, \\mu_Y)$ 附近的一阶泰勒级数展开。这种技术也被称为Delta方法。\n$$ \\hat{A} \\approx g(\\mu_X, \\mu_Y) + \\frac{\\partial g}{\\partial x}\\bigg|_{(\\mu_X, \\mu_Y)} (\\bar{X} - \\mu_X) + \\frac{\\partial g}{\\partial y}\\bigg|_{(\\mu_X, \\mu_Y)} (\\bar{Y} - \\mu_Y) $$\n$g(x,y) = x/y$ 的偏导数是：\n$$ \\frac{\\partial g}{\\partial x} = \\frac{1}{y} \\quad \\implies \\quad \\frac{\\partial g}{\\partial x}\\bigg|_{(\\mu_X, \\mu_Y)} = \\frac{1}{\\mu_Y} $$\n$$ \\frac{\\partial g}{\\partial y} = -\\frac{x}{y^2} \\quad \\implies \\quad \\frac{\\partial g}{\\partial y}\\bigg|_{(\\mu_X, \\mu_Y)} = -\\frac{\\mu_X}{\\mu_Y^2} $$\n将这些代入泰勒展开式得到：\n$$ \\hat{A} \\approx \\frac{\\mu_X}{\\mu_Y} + \\frac{1}{\\mu_Y}(\\bar{X} - \\mu_X) - \\frac{\\mu_X}{\\mu_Y^2}(\\bar{Y} - \\mu_Y) $$\n$\\hat{A}$ 的渐近方差是这个线性近似的方差。由于 $\\mu_X$ 和 $\\mu_Y$ 是常数，方差由下式给出：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\mathrm{Var}\\left( \\frac{1}{\\mu_Y}\\bar{X} - \\frac{\\mu_X}{\\mu_Y^2}\\bar{Y} \\right) $$\n我们使用两个相关随机变量 $U$ 和 $V$ 的线性组合的方差通用公式，$\\mathrm{Var}(aU+bV) = a^2\\mathrm{Var}(U) + b^2\\mathrm{Var}(V) + 2ab\\mathrm{Cov}(U,V)$。这里，$U=\\bar{X}$，$V=\\bar{Y}$，$a=1/\\mu_Y$，$b=-\\mu_X/\\mu_Y^2$。\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\left(\\frac{1}{\\mu_Y}\\right)^2 \\mathrm{Var}(\\bar{X}) + \\left(-\\frac{\\mu_X}{\\mu_Y^2}\\right)^2 \\mathrm{Var}(\\bar{Y}) + 2\\left(\\frac{1}{\\mu_Y}\\right)\\left(-\\frac{\\mu_X}{\\mu_Y^2}\\right)\\mathrm{Cov}(\\bar{X}, \\bar{Y}) $$\n接下来，我们求样本均值的方差和协方差。由于每个史的计分值 $(X_i, Y_i)$ 是独立同分布的，其方差为 $\\sigma_X^2 = \\mathrm{Var}(X_i)$ 和 $\\sigma_Y^2 = \\mathrm{Var}(Y_i)$，协方差为 $\\sigma_{XY} = \\mathrm{Cov}(X_i, Y_i)$：\n$$ \\mathrm{Var}(\\bar{X}) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N} X_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Var}(X_i) = \\frac{N\\sigma_X^2}{N^2} = \\frac{\\sigma_X^2}{N} $$\n$$ \\mathrm{Var}(\\bar{Y}) = \\mathrm{Var}\\left(\\frac{1}{N}\\sum_{i=1}^{N} Y_i\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Var}(Y_i) = \\frac{N\\sigma_Y^2}{N^2} = \\frac{\\sigma_Y^2}{N} $$\n$$ \\mathrm{Cov}(\\bar{X}, \\bar{Y}) = \\mathrm{Cov}\\left(\\frac{1}{N}\\sum_{i=1}^{N} X_i, \\frac{1}{N}\\sum_{j=1}^{N} Y_j\\right) = \\frac{1}{N^2} \\sum_{i=1}^{N} \\mathrm{Cov}(X_i, Y_i) = \\frac{N\\sigma_{XY}}{N^2} = \\frac{\\sigma_{XY}}{N} $$\n在协方差计算中，我们利用了当 $i \\neq j$ 时 $\\mathrm{Cov}(X_i, Y_j) = 0$ 这一事实，因为不同史是独立的。\n\n将这些代入 $\\mathrm{Var}(\\hat{A})$ 的表达式中：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{\\mu_Y^2} \\left(\\frac{\\sigma_X^2}{N}\\right) + \\frac{\\mu_X^2}{\\mu_Y^4} \\left(\\frac{\\sigma_Y^2}{N}\\right) - \\frac{2\\mu_X}{\\mu_Y^3} \\left(\\frac{\\sigma_{XY}}{N}\\right) $$\n我们可以提出因子 $1/N$ 并合并各项：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{N} \\left( \\frac{\\sigma_X^2}{\\mu_Y^2} + \\frac{\\mu_X^2 \\sigma_Y^2}{\\mu_Y^4} - \\frac{2\\mu_X \\sigma_{XY}}{\\mu_Y^3} \\right) $$\n为了得到一个单一的分式，我们将所有项置于公分母 $N \\mu_Y^4$ 之上：\n$$ \\mathrm{Var}(\\hat{A}) \\approx \\frac{1}{N\\mu_Y^4} \\left( \\mu_Y^2 \\sigma_X^2 + \\mu_X^2 \\sigma_Y^2 - 2\\mu_X \\mu_Y \\sigma_{XY} \\right) $$\n这就是反照率估计量 $\\hat{A}$ 的渐近方差的最终闭式表达式。",
            "answer": "$$\\boxed{\\frac{\\mu_Y^2 \\sigma_X^2 + \\mu_X^2 \\sigma_Y^2 - 2\\mu_X \\mu_Y \\sigma_{XY}}{N\\mu_Y^4}}$$"
        }
    ]
}