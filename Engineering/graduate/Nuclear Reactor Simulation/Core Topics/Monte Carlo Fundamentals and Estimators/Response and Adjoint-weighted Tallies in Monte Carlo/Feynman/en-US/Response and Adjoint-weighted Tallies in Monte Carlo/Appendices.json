{
    "hands_on_practices": [
        {
            "introduction": "Before using the adjoint function to accelerate calculations, we must first understand what it represents and how it connects to physical quantities. This practice establishes the fundamental reciprocity theorem, which links a physical source to a detector response via the adjoint function, or \"importance\" . By deriving this relationship from the Boltzmann Transport Equation, you will see how this formal theorem provides the direct theoretical justification for a common and powerful Monte Carlo technique: the point detector estimator.",
            "id": "4246260",
            "problem": "Consider a stationary, monoenergetic neutron field in an infinite, homogeneous medium with no scattering and constant macroscopic total cross section $\\Sigma_{t}$ at energy $E_{0}$. A point, isotropic source of neutrons with strength $S$ (in neutrons per second) is located at position $\\mathbf{r}_{s}$. A point detector is located at position $\\mathbf{r}_{d}$ and its response functional is defined as the scalar flux at the detector position integrated over directions at energy $E_{0}$. The forward transport is governed by the Boltzmann Transport Equation (BTE), and the corresponding adjoint transport equation defines the importance function for adjoint-weighted tallies.\n\nStarting from the stationary, monoenergetic Boltzmann Transport Equation and the definition of the adjoint problem, derive from first principles the reciprocity relation that connects the forward source $q$ to the detector response via the adjoint flux $\\psi^{\\dagger}$, and show how the resulting reciprocity implies the form of the next-event (point detector) estimator in a Monte Carlo simulation. Use your derivation to obtain the closed-form expression for the detector response in this scattering-free medium and evaluate it for the following physically consistent parameters:\n- $\\Sigma_{t} = 0.18 \\ \\text{cm}^{-1}$,\n- $S = 2.0 \\times 10^{7} \\ \\text{s}^{-1}$,\n- $\\mathbf{r}_{s} = (0,0,0) \\ \\text{cm}$,\n- $\\mathbf{r}_{d} = (25.0,0,0) \\ \\text{cm}$.\n\nExpress the final detector response as a scalar flux at $\\mathbf{r}_{d}$ in $\\text{n} \\cdot \\text{cm}^{-2} \\cdot \\text{s}^{-1}$ and round your answer to four significant figures. The final answer must be a single real number.",
            "solution": "The solution involves three parts: deriving the reciprocity relation, connecting it to the next-event estimator, and calculating the detector response for the given parameters.\n\n**Part 1: The Reciprocity Relation**\n\nThe stationary, monoenergetic Boltzmann Transport Equation (BTE) for the angular flux $\\psi(\\mathbf{r}, \\Omega)$ in a non-scattering medium is:\n$$\n\\Omega \\cdot \\nabla \\psi(\\mathbf{r}, \\Omega) + \\Sigma_t \\psi(\\mathbf{r}, \\Omega) = q(\\mathbf{r}, \\Omega)\n$$\nIn operator form, this is $L\\psi = q$, with the transport operator $L \\equiv \\Omega \\cdot \\nabla + \\Sigma_t$. The source is $q(\\mathbf{r}, \\Omega) = \\frac{S}{4\\pi} \\delta(\\mathbf{r} - \\mathbf{r}_s)$.\n\nThe response $R$ is the scalar flux at the detector, $R = \\phi(\\mathbf{r}_d) = \\int_{4\\pi} \\psi(\\mathbf{r}_d, \\Omega) d\\Omega$. Using a phase-space inner product $\\langle f, g \\rangle$, this can be written as $R = \\langle q^\\dagger, \\psi \\rangle$, where the adjoint source (response function) is $q^\\dagger(\\mathbf{r}, \\Omega) = \\delta(\\mathbf{r} - \\mathbf{r}_d)$.\n\nThe adjoint equation is $L^\\dagger \\psi^\\dagger = q^\\dagger$, where $L^\\dagger$ is the adjoint operator. Through integration by parts over an infinite domain (where surface terms vanish), one can show that $L^\\dagger = -\\Omega \\cdot \\nabla + \\Sigma_t$.\n\nThe reciprocity relation follows from the definition of the adjoint operator:\n$$\n\\langle \\psi^\\dagger, L\\psi \\rangle = \\langle L^\\dagger\\psi^\\dagger, \\psi \\rangle\n$$\nSubstituting $L\\psi = q$ and $L^\\dagger\\psi^\\dagger = q^\\dagger$:\n$$\n\\langle \\psi^\\dagger, q \\rangle = \\langle q^\\dagger, \\psi \\rangle\n$$\nThis is the general reciprocity relation. Substituting our specific source and response functions:\n$$\nR = \\langle q^\\dagger, \\psi \\rangle = \\langle \\psi^\\dagger, q \\rangle = \\int dV \\int_{4\\pi} d\\Omega \\, \\psi^\\dagger(\\mathbf{r}, \\Omega) \\left( \\frac{S}{4\\pi}\\delta(\\mathbf{r} - \\mathbf{r}_s) \\right) = \\frac{S}{4\\pi} \\int_{4\\pi} \\psi^\\dagger(\\mathbf{r}_s, \\Omega) d\\Omega\n$$\nThis shows that the response at the detector, $\\phi(\\mathbf{r}_d)$, is proportional to the adjoint scalar flux at the source, $\\phi^\\dagger(\\mathbf{r}_s)$.\n\n**Part 2: Connection to the Next-Event Estimator**\n\nThe reciprocity relation $R = \\langle \\psi^\\dagger, q \\rangle$ expresses the total response as an integral of the source density weighted by the importance function $\\psi^\\dagger$. The next-event (or point detector) estimator in Monte Carlo is a direct statistical evaluation of this integral. At each source particle's birth at $\\mathbf{r}_s$, the estimator scores the value of the importance function $\\psi^\\dagger(\\mathbf{r}_s, \\Omega_d)$, where $\\Omega_d$ is the direction to the detector. This importance is the uncollided flux reaching the detector:\n$$\n\\psi^\\dagger(\\mathbf{r}_s, \\Omega_d) \\propto \\frac{\\exp(-\\Sigma_t |\\mathbf{r}_d - \\mathbf{r}_s|)}{|\\mathbf{r}_d - \\mathbf{r}_s|^2}\n$$\nThe estimator's score is this term multiplied by the particle weight. The reciprocity theorem provides the formal justification for this technique, proving that summing these importance-weighted source contributions yields an unbiased estimate of the detector response $R$.\n\n**Part 3: Closed-Form Expression and Calculation**\n\nWe can calculate the response $R = \\phi(\\mathbf{r}_d)$ directly from the forward problem. For a point isotropic source of strength $S$ in an infinite, purely absorbing medium, the scalar flux at a distance $d$ is given by the point-kernel solution:\n$$\n\\phi(d) = \\frac{S \\exp(-\\Sigma_t d)}{4\\pi d^2}\n$$\nThe distance between the source and detector is $d = |\\mathbf{r}_d - \\mathbf{r}_s| = |(25.0,0,0) - (0,0,0)| = 25.0 \\ \\text{cm}$.\nSubstituting the given values:\n- $S = 2.0 \\times 10^{7} \\ \\text{s}^{-1}$\n- $\\Sigma_{t} = 0.18 \\ \\text{cm}^{-1}$\n- $d = 25.0 \\ \\text{cm}$\n\n$$\nR = \\phi(\\mathbf{r}_d) = \\frac{(2.0 \\times 10^7) \\exp(-(0.18)(25.0))}{4\\pi (25.0)^2}\n$$\n$$\nR = \\frac{2.0 \\times 10^7 \\exp(-4.5)}{4\\pi (625)} = \\frac{2.0 \\times 10^7}{2500\\pi} \\exp(-4.5)\n$$\n$$\nR = \\frac{8000}{\\pi} \\exp(-4.5) \\approx (2546.48)(0.011109) \\approx 28.288 \\ \\text{n} \\cdot \\text{cm}^{-2} \\cdot \\text{s}^{-1}\n$$\nRounding to four significant figures, the response is $28.29 \\ \\text{n} \\cdot \\text{cm}^{-2} \\cdot \\text{s}^{-1}$.",
            "answer": "$$\\boxed{28.29}$$"
        },
        {
            "introduction": "With the theoretical link between source and response established, we now turn to a powerful, practical application in variance reduction. This exercise demonstrates the Consistent Adjoint-Driven Importance Sampling (CADIS) method, a cornerstone of modern shielding calculations . You will derive the importance function for a specific response—particle leakage—and use it to construct a biased source distribution that focuses computational effort on particles most likely to contribute to the final tally.",
            "id": "4246226",
            "problem": "A one-speed, mono-directional, purely absorbing slab of thickness $a$ is considered for a Monte Carlo (MC) neutron transport calculation. Neutrons travel only in the $+x$ direction; the left boundary at $x=0$ admits an external volumetric source, and the right boundary at $x=a$ is a vacuum exit. The total macroscopic cross section is spatially uniform and equal to $\\Sigma_{t}$. The physical source density is $S(x)=S_{0}\\exp(-\\beta x)$ for $0\\le x\\le a$, with $S_{0}>0$ and $\\beta\\ge 0$. The response of interest is the leakage current at the right boundary $x=a$. In the Consistent Adjoint-Driven Importance Sampling (CADIS) method, importance sampling is driven by the solution of the adjoint transport problem and used to construct a biased source Probability Density Function (PDF) for sampling starting locations.\n\nStarting from the forward one-speed, mono-directional, pure absorption transport operator definition and the adjoint identity, derive the adjoint importance function $\\phi^{\\dagger}(x)$ appropriate for the leakage response at $x=a$. Using this adjoint importance, derive the CADIS biased source PDF $p_{b}(x)$ over $x\\in[0,a]$.\n\nThen, for the specific parameter values $a=10\\,\\mathrm{cm}$, $\\Sigma_{t}=0.2\\,\\mathrm{cm}^{-1}$, $\\beta=0.05\\,\\mathrm{cm}^{-1}$, and $x_{0}=4\\,\\mathrm{cm}$, evaluate $p_{b}(x_{0})$. Round your answer to four significant figures and express your final result in $\\mathrm{cm}^{-1}$. The final answer must be a single real number.",
            "solution": "The problem requires the derivation of the adjoint importance function and the Consistent Adjoint-Driven Importance Sampling (CADIS) biased source Probability Density Function (PDF) for a simplified neutron transport problem, followed by a numerical evaluation.\n\nThe physical system is a one-dimensional slab of thickness $a$ with a purely absorbing medium characterized by a total macroscopic cross section $\\Sigma_t$. Neutrons are mono-energetic and travel only in the positive $x$ direction. An external volumetric source $S(x) = S_0 \\exp(-\\beta x)$ exists for $x \\in [0, a]$.\n\nThe forward transport problem is described by the first-order ordinary differential equation for the neutron flux $\\phi(x)$:\n$$ \\frac{d\\phi(x)}{dx} + \\Sigma_t \\phi(x) = S(x) $$\nThe boundary condition is no incoming flux at the left boundary, which implies $\\phi(0) = 0$. In operator form, this is $L\\phi = S$, where the forward operator is $L = \\frac{d}{dx} + \\Sigma_t$.\n\nThe response of interest, $R$, is the leakage current at the right boundary, $x=a$. In this mono-directional case, the current is equal to the flux, so $R = \\phi(a)$. This is a surface response.\n\nTo find the adjoint importance function $\\phi^{\\dagger}(x)$, we first establish the adjoint problem. The adjoint operator $L^{\\dagger}$ is formally derived from the identity $\\langle \\phi^{\\dagger}, L\\phi \\rangle = \\langle L^{\\dagger}\\phi^{\\dagger}, \\phi \\rangle + \\text{boundary terms}$. For the operator $L = \\frac{d}{dx} + \\Sigma_t$, the adjoint operator is $L^{\\dagger} = -\\frac{d}{dx} + \\Sigma_t$.\n\nThe adjoint source $S^{\\dagger}$ is determined by the response function. For a surface response $R = \\phi(a)$, the adjoint problem consists of a homogeneous differential equation within the domain and an inhomogeneous boundary condition. The adjoint equation is:\n$$ L^{\\dagger}\\phi^{\\dagger}(x) = 0 \\implies -\\frac{d\\phi^{\\dagger}(x)}{dx} + \\Sigma_t \\phi^{\\dagger}(x) = 0 \\quad \\text{for } x \\in [0, a) $$\nThe adjoint boundary condition at $x=a$ is derived from the requirement that $\\phi(a) = \\int_0^a S(x)\\phi^{\\dagger}(x)dx$. For a surface response at $x=a$, the importance of a particle at that surface is unity. Formally, this gives the boundary condition $\\phi^{\\dagger}(a) = 1$. The adjoint problem is thus defined by the ODE above and the condition $\\phi^{\\dagger}(a)=1$.\n\nSolving the adjoint differential equation:\n$$ \\frac{d\\phi^{\\dagger}}{\\phi^{\\dagger}} = \\Sigma_t dx $$\nIntegrating yields $\\ln(\\phi^{\\dagger}(x)) = \\Sigma_t x + C'$, or $\\phi^{\\dagger}(x) = C \\exp(\\Sigma_t x)$ for some constant $C$.\nApplying the boundary condition at $x=a$:\n$$ \\phi^{\\dagger}(a) = C \\exp(\\Sigma_t a) = 1 $$\nThis gives the constant $C = \\exp(-\\Sigma_t a)$.\nSubstituting $C$ back, the adjoint importance function is:\n$$ \\phi^{\\dagger}(x) = \\exp(-\\Sigma_t a) \\exp(\\Sigma_t x) = \\exp(-\\Sigma_t(a-x)) $$\nThis function represents the probability that a neutron starting at position $x$ will travel to the boundary at $x=a$ without being absorbed.\n\nNext, we derive the CADIS biased source PDF, $p_b(x)$. This PDF is constructed to sample source particles from a distribution proportional to the product of the physical source density $S(x)$ and the adjoint importance function $\\phi^{\\dagger}(x)$.\n$$ p_b(x) = \\frac{S(x) \\phi^{\\dagger}(x)}{\\int_0^a S(x') \\phi^{\\dagger}(x') dx'} $$\nThe term in the numerator is:\n$$ S(x) \\phi^{\\dagger}(x) = \\left(S_0 \\exp(-\\beta x)\\right) \\left(\\exp(-\\Sigma_t(a-x))\\right) = S_0 \\exp(-\\Sigma_t a) \\exp((\\Sigma_t - \\beta)x) $$\nThe denominator is the normalization integral, $N$:\n$$ N = \\int_0^a S_0 \\exp(-\\Sigma_t a) \\exp((\\Sigma_t - \\beta)x') dx' = S_0 \\exp(-\\Sigma_t a) \\int_0^a \\exp((\\Sigma_t - \\beta)x') dx' $$\nLet $k = \\Sigma_t - \\beta$. The integral depends on whether $k=0$. The problem parameters give $\\Sigma_t = 0.2\\,\\mathrm{cm}^{-1}$ and $\\beta = 0.05\\,\\mathrm{cm}^{-1}$, so $k \\neq 0$.\n$$ \\int_0^a \\exp(kx') dx' = \\left[ \\frac{\\exp(kx')}{k} \\right]_0^a = \\frac{\\exp(ka) - \\exp(0)}{k} = \\frac{\\exp(ka) - 1}{k} $$\nThus, the normalization constant is $N = S_0 \\exp(-\\Sigma_t a) \\frac{\\exp(ka) - 1}{k}$.\nThe biased source PDF $p_b(x)$ is:\n$$ p_b(x) = \\frac{S_0 \\exp(-\\Sigma_t a) \\exp(kx)}{S_0 \\exp(-\\Sigma_t a) \\frac{\\exp(ka) - 1}{k}} = \\frac{k \\exp(kx)}{\\exp(ka) - 1} $$\nSubstituting $k = \\Sigma_t - \\beta$, the final analytical expression for the biased source PDF is:\n$$ p_b(x) = \\frac{(\\Sigma_t - \\beta) \\exp((\\Sigma_t - \\beta)x)}{\\exp((\\Sigma_t - \\beta)a) - 1} $$\nThis expression is valid for $x \\in [0, a]$.\n\nFinally, we evaluate $p_b(x_0)$ for the given parameter values: $a=10\\,\\mathrm{cm}$, $\\Sigma_t = 0.2\\,\\mathrm{cm}^{-1}$, $\\beta = 0.05\\,\\mathrm{cm}^{-1}$, and $x_0 = 4\\,\\mathrm{cm}$.\nFirst, calculate the constant $k$:\n$$ k = \\Sigma_t - \\beta = 0.2\\,\\mathrm{cm}^{-1} - 0.05\\,\\mathrm{cm}^{-1} = 0.15\\,\\mathrm{cm}^{-1} $$\nNext, evaluate the dimensionless arguments of the exponential functions:\n$$ kx_0 = (0.15\\,\\mathrm{cm}^{-1})(4\\,\\mathrm{cm}) = 0.6 $$\n$$ ka = (0.15\\,\\mathrm{cm}^{-1})(10\\,\\mathrm{cm}) = 1.5 $$\nNow, substitute these values into the expression for $p_b(x_0)$:\n$$ p_b(x_0=4) = \\frac{0.15 \\times \\exp(0.6)}{\\exp(1.5) - 1} $$\nUsing numerical values for the exponential functions:\n$$ \\exp(0.6) \\approx 1.8221188 $$\n$$ \\exp(1.5) \\approx 4.4816891 $$\n$$ p_b(4) = \\frac{0.15 \\times 1.8221188}{4.4816891 - 1} = \\frac{0.27331782}{3.4816891} \\approx 0.0784998\\,\\mathrm{cm}^{-1} $$\nRounding the result to four significant figures as requested gives $0.07850\\,\\mathrm{cm}^{-1}$.",
            "answer": "$$\\boxed{0.07850}$$"
        },
        {
            "introduction": "Implementing a variance reduction scheme is only half the battle; we must also be able to quantify its effectiveness and predict the resulting statistical uncertainty. This final practice moves from creating biasing schemes to analyzing their impact on the simulation's statistical quality . By deriving the per-history variance for a source biasing scheme from first principles, you will learn how importance sampling alters the statistical moments of the tally estimator and how to calculate the confidence interval for the mean response.",
            "id": "4246189",
            "problem": "Consider a steady, monoenergetic, fixed-source neutron transport problem in a homogeneous slab partitioned into two spatial cells, $\\mathcal{C}_{1}$ and $\\mathcal{C}_{2}$, with a point detector at the right boundary. The detector response functional is the expected count per independent source history, which in transport theory can be written as the bilinear form of the forward flux and a detector response operator. In importance-based variance reduction (VR), one uses the adjoint solution to the transport equation—the adjoint importance function—to sculpt biased probability densities that preferentially sample phase-space points that are more likely to contribute to the response.\n\nAssume the following simplified, physically motivated model for an adjoint-informed source biasing scheme for Monte Carlo (MC) transport:\n- The analog source distribution is uniform over the two cells, so the analog source-stratum probabilities are $p_{1} = \\frac{1}{2}$ and $p_{2} = \\frac{1}{2}$.\n- The detector has an intrinsic efficiency $\\eta$ (the probability that an incident, tally-eligible particle produces a recorded count), with $\\eta = 0.9$.\n- Conditional on starting in $\\mathcal{C}_{i}$, the probability that a history produces a tally-eligible interaction is $s_{i}$, with $s_{1} = 0.01$ and $s_{2} = 0.04$.\n- An adjoint importance map has been computed and is approximately constant in each cell, with values $I_{1} = 0.2$ and $I_{2} = 0.8$. The VR scheme biases the source-stratum probabilities proportionally to these importances: $b_{i} \\propto I_{i}$, normalized so that $b_{1} + b_{2} = 1$. With the given $I_{i}$, this yields $b_{1} = 0.2$ and $b_{2} = 0.8$.\n- Under importance sampling, each history starting in $\\mathcal{C}_{i}$ is assigned a weight factor $w_{i} = p_{i}/b_{i}$ to preserve unbiasedness. The per-history score is defined as $Y = w_{i} \\,\\eta\\, \\delta_{i}$, where $\\delta_{i}$ is a Bernoulli random variable taking value $1$ if the tally-eligible interaction occurs (with probability $s_{i}$) and $0$ otherwise.\n\nAssume histories are independent and identically distributed under this scheme. Starting from the fundamental definitions of expectation and variance for importance sampling with weights, and treating the above as a two-stratum mixture model induced by the biased source selection, perform the following:\n\n1. Derive a closed-form expression for the per-history variance $\\operatorname{Var}(Y)$ in terms of $p_{i}$, $b_{i}$, $s_{i}$, and $\\eta$ (do not introduce any shortcuts or pre-quoted formulas; derive from first principles of conditional expectation and the law of total variance).\n2. Specialize your expression to the given numerical values and compute the theoretical 95% two-sided normal-based confidence half-width $h$ for the sample mean response when $N = 5 \\times 10^{5}$ independent histories are simulated. Use the standard normal quantile $z = 1.959964$ for the 97.5th percentile. Round your final numerical answer for $h$ to four significant figures. The response is dimensionless; report $h$ without units.\n\nYour final answer must be the single value of $h$.",
            "solution": "The solution proceeds in two parts as requested: first, the derivation of the per-history variance, and second, the numerical computation of the confidence half-width for the sample mean.\n\n**Part 1: Derivation of the Per-History Variance**\n\nThe problem describes a two-stratum mixture model. A history is initiated by sampling a source cell $\\mathcal{C}_{i}$ from a biased probability distribution $\\{b_{1}, b_{2}\\}$. Let $C$ be a discrete random variable representing the chosen cell, so $P(C=i) = b_{i}$ for $i \\in \\{1, 2\\}$.\n\nThe per-history score, $Y$, is a random variable whose value depends on the chosen cell $C$. The score is given by $Y = w_{C} \\eta \\delta_{C}$, where $w_{i} = p_{i}/b_{i}$ is the importance-sampling weight, $\\eta$ is the detector efficiency, and $\\delta_{i}$ is a Bernoulli random variable with success probability $s_{i}$, i.e., $P(\\delta_{i}=1) = s_{i}$ and $P(\\delta_{i}=0) = 1-s_{i}$.\n\nThe variance of the per-history score, $\\operatorname{Var}(Y)$, is defined by the fundamental formula:\n$$\n\\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2\n$$\nWe will compute the first and second moments of $Y$ using the law of total expectation, conditioning on the sampled source cell $C$.\n\nFirst, we compute the expected score, $\\mathbb{E}[Y]$.\n$$\n\\mathbb{E}[Y] = \\sum_{i=1}^{2} \\mathbb{E}[Y | C=i] P(C=i)\n$$\nGiven that the history started in cell $\\mathcal{C}_{i}$ (i.e., $C=i$), the score is $Y_i = w_{i} \\eta \\delta_{i}$. Its conditional expectation is:\n$$\n\\mathbb{E}[Y | C=i] = \\mathbb{E}[w_{i} \\eta \\delta_{i}] = w_{i} \\eta \\mathbb{E}[\\delta_{i}]\n$$\nSince $\\delta_{i}$ is a Bernoulli random variable with parameter $s_{i}$, its expectation is $\\mathbb{E}[\\delta_{i}] = s_{i}$. Therefore:\n$$\n\\mathbb{E}[Y | C=i] = w_{i} \\eta s_{i}\n$$\nSubstituting this into the law of total expectation and using $P(C=i) = b_{i}$:\n$$\n\\mathbb{E}[Y] = \\sum_{i=1}^{2} (w_{i} \\eta s_{i}) b_{i}\n$$\nBy substituting the definition of the weight, $w_{i} = p_{i}/b_{i}$, we confirm that the estimator is unbiased, as it recovers the analog expectation:\n$$\n\\mathbb{E}[Y] = \\sum_{i=1}^{2} \\left(\\frac{p_{i}}{b_{i}} \\eta s_{i}\\right) b_{i} = \\eta \\sum_{i=1}^{2} p_{i} s_{i}\n$$\nNext, we compute the second moment of the score, $\\mathbb{E}[Y^2]$.\n$$\n\\mathbb{E}[Y^2] = \\sum_{i=1}^{2} \\mathbb{E}[Y^2 | C=i] P(C=i)\n$$\nGiven $C=i$, the squared score is $Y_i^2 = (w_{i} \\eta \\delta_{i})^2 = w_{i}^2 \\eta^2 \\delta_{i}^2$. Its conditional expectation is:\n$$\n\\mathbb{E}[Y^2 | C=i] = \\mathbb{E}[w_{i}^2 \\eta^2 \\delta_{i}^2] = w_{i}^2 \\eta^2 \\mathbb{E}[\\delta_{i}^2]\n$$\nFor a Bernoulli variable, $\\delta_{i}^2 = \\delta_{i}$, so $\\mathbb{E}[\\delta_{i}^2] = \\mathbb{E}[\\delta_{i}] = s_{i}$. Thus:\n$$\n\\mathbb{E}[Y^2 | C=i] = w_{i}^2 \\eta^2 s_{i}\n$$\nSubstituting this into the law of total expectation:\n$$\n\\mathbb{E}[Y^2] = \\sum_{i=1}^{2} (w_{i}^2 \\eta^2 s_{i}) b_{i}\n$$\nAgain using $w_{i} = p_{i}/b_{i}$:\n$$\n\\mathbb{E}[Y^2] = \\sum_{i=1}^{2} \\left(\\frac{p_{i}^2}{b_{i}^2} \\eta^2 s_{i}\\right) b_{i} = \\eta^2 \\sum_{i=1}^{2} \\frac{p_{i}^2}{b_{i}} s_{i}\n$$\nFinally, we substitute the expressions for $\\mathbb{E}[Y]$ and $\\mathbb{E}[Y^2]$ into the variance formula:\n$$\n\\operatorname{Var}(Y) = \\left( \\eta^2 \\sum_{i=1}^{2} \\frac{p_{i}^2}{b_{i}} s_{i} \\right) - \\left( \\eta \\sum_{i=1}^{2} p_{i} s_{i} \\right)^2\n$$\nFactoring out $\\eta^2$, we arrive at the desired closed-form expression for the per-history variance:\n$$\n\\operatorname{Var}(Y) = \\eta^2 \\left[ \\left( \\sum_{i=1}^{2} \\frac{p_{i}^2}{b_{i}} s_{i} \\right) - \\left( \\sum_{i=1}^{2} p_{i} s_{i} \\right)^2 \\right]\n$$\n\n**Part 2: Numerical Calculation of the Confidence Half-Width**\n\nThe sample mean score, $\\bar{Y}_N$, from $N$ independent histories is an estimator for $\\mathbb{E}[Y]$. By the Central Limit Theorem, for large $N$, $\\bar{Y}_N$ is approximately normally distributed with a variance of $\\operatorname{Var}(\\bar{Y}_N) = \\frac{\\operatorname{Var}(Y)}{N}$. The $95\\%$ two-sided confidence half-width $h$ is given by:\n$$\nh = z \\sqrt{\\operatorname{Var}(\\bar{Y}_N)} = z \\frac{\\sqrt{\\operatorname{Var}(Y)}}{\\sqrt{N}}\n$$\nwhere $z$ is the $97.5$-th percentile of the standard normal distribution.\n\nWe are given the following numerical values:\n- Analog probabilities: $p_{1} = 0.5$, $p_{2} = 0.5$\n- Biased probabilities: $b_{1} = 0.2$, $b_{2} = 0.8$\n- Conditional tally probabilities: $s_{1} = 0.01$, $s_{2} = 0.04$\n- Detector efficiency: $\\eta = 0.9$\n- Number of histories: $N = 5 \\times 10^{5}$\n- Normal quantile: $z = 1.959964$\n\nFirst, we calculate the components of the variance expression.\nThe sum for the expected value term is:\n$$\n\\sum_{i=1}^{2} p_{i} s_{i} = p_{1}s_{1} + p_{2}s_{2} = (0.5)(0.01) + (0.5)(0.04) = 0.005 + 0.02 = 0.025\n$$\nThe sum for the second moment term is:\n\\begin{align*}\n\\sum_{i=1}^{2} \\frac{p_{i}^2}{b_{i}} s_{i} &= \\frac{p_{1}^2}{b_{1}} s_{1} + \\frac{p_{2}^2}{b_{2}} s_{2} \\\\\n&= \\frac{(0.5)^2}{0.2} (0.01) + \\frac{(0.5)^2}{0.8} (0.04) \\\\\n&= \\frac{0.25}{0.2} (0.01) + \\frac{0.25}{0.8} (0.04) \\\\\n&= (1.25)(0.01) + (0.3125)(0.04) \\\\\n&= 0.0125 + 0.0125 = 0.025\n\\end{align*}\nNow, we can compute $\\operatorname{Var}(Y)$:\n$$\n\\operatorname{Var}(Y) = (0.9)^2 \\left[ 0.025 - (0.025)^2 \\right] = 0.81 [0.025 - 0.000625] = 0.81 [0.024375] = 0.01974375\n$$\nFinally, we compute the confidence half-width $h$:\n$$\nh = 1.959964 \\times \\sqrt{\\frac{0.01974375}{5 \\times 10^{5}}} = 1.959964 \\times \\sqrt{3.94875 \\times 10^{-8}}\n$$\n$$\nh \\approx 1.959964 \\times (1.98714797 \\times 10^{-4}) \\approx 3.894751 \\times 10^{-4}\n$$\nRounding this result to four significant figures gives $3.895 \\times 10^{-4}$.",
            "answer": "$$\\boxed{3.895 \\times 10^{-4}}$$"
        }
    ]
}