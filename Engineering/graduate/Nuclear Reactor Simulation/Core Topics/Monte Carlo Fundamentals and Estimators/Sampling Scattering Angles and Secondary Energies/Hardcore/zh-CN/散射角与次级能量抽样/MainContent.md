## 引言
在核[反应堆物理](@entry_id:158170)和[辐射屏蔽](@entry_id:1130501)等领域，精确预测中子在介质中的行为至关重要。蒙特卡罗方法作为一种高保真[数值模拟](@entry_id:146043)工具，通过追踪大量单个中子的生命史来统计性地重现其宏观[输运现象](@entry_id:147655)。这一过程的准确性在很大程度上取决于对单个物理事件——尤其是散射事件——的精确建模。当一个中子与原子核发生碰撞后，其新的运动方向和能量是如何决定的？这个看似简单的问题是整个模拟可信度的核心，而答案就在于如何从底层的物理规律中正确地抽样次级粒子的[散射角](@entry_id:171822)和能量。

本文旨在系统性地解决这一核心问题，为读者构建一个从物理原理到计算实践的完整知识框架。我们将深入探讨在蒙特卡罗模拟中实现高保真散射物理所必需的理论、模型与算法。文章将分为三个章节，引领读者逐步深入：

*   **原则与机制**：本章将奠定理论基础，阐明如何将物理[截面](@entry_id:154995)数据转化为蒙特卡罗方法所需的概率分布，并详细介绍[弹性散射](@entry_id:152152)、热散射以及基于勒让德展开的[角分布](@entry_id:193827)等关键过程的抽样机制。
*   **应用与跨学科联系**：我们将展示这些抽样技术如何应用于提升模拟的保真度和效率，如何连接微观物理与宏观反应堆行为，并探讨其在聚变能、医学物理和材料科学等交叉学科中的广泛应用。
*   **动手实践**：通过一系列精心设计的编程练习，读者将有机会亲手实现并验证文中所学的抽样算法，将理论知识转化为实际的编程技能。

通过学习本文，读者将不仅掌握次级粒子抽样的具体技术，更能深刻理解这些技术背后的物理内涵及其在现代[科学计算](@entry_id:143987)中的核心作用。现在，让我们从构建抽样算法的基石——物理原则与核心机制——开始。

## 原则与机制

在深入探讨[中子输运模拟](@entry_id:1128710)的具体算法之前，我们必须首先掌握散射事件中次级粒子角度与能量抽样的基本物理原则和核心机制。本章旨在系统性地阐述如何从物理[截面](@entry_id:154995)数据过渡到蒙特卡罗模拟中使用的概率分布，并介绍几种关键散射过程的理论模型与抽样方法。这些内容构成了[精确模拟](@entry_id:749142)中子在反应堆介质中行为的基石。

### 从物理[截面](@entry_id:154995)到概率分布

在蒙特卡罗方法中，任何随机事件的抽样都必须基于一个归一化的概率密度函数 (Probability Density Function, PDF)。对于[中子散射](@entry_id:142835)过程，其物理描述由微观或[宏观截面](@entry_id:1127564)给出。因此，我们的首要任务是建立从物理[截面](@entry_id:154995)到可用 PDF 的桥梁。

#### [角分布](@entry_id:193827)的概率密度函数

散射事件的基本[可观测量](@entry_id:267133)是[微分散射截面](@entry_id:1123684) $\frac{d\sigma}{d\Omega}$，它描述了[粒子散射](@entry_id:152941)到某个立体角元 $d\Omega$ 内的相对可能性。在蒙特卡罗模拟中，我们需要的是一个关于散射方向的 PDF。假设散射过程对于入射方向具有[方位角](@entry_id:164011)对称性，这意味着散射概率仅依赖于极角 $\theta$，而不依赖于[方位角](@entry_id:164011) $\phi$。在这种情况下，我们通常使用极角余弦 $\mu = \cos\theta$作为[随机变量](@entry_id:195330)，其取值范围为 $[-1, 1]$。

一个散射事件进入微元[立体角](@entry_id:154756) $d\Omega$ 的[微分](@entry_id:158422)概率 $dP$ 与[微分截面](@entry_id:137333)成正比：
$$
dP \propto \frac{d\sigma}{d\Omega} d\Omega
$$
考虑到方位角对称性，[微分](@entry_id:158422)[立体角](@entry_id:154756)元可以写作 $d\Omega = d\mu \, d\phi$。因此，关于变量 $\mu$ 和 $\phi$ 的联合 PDF $p(\mu, \phi)$ 满足：
$$
p(\mu, \phi) \, d\mu \, d\phi = C \frac{d\sigma}{d\Omega}(\mu) \, d\mu \, d\phi
$$
其中 $C$ 是一个[归一化常数](@entry_id:752675)。该常数由整个[概率空间](@entry_id:201477)上的积分为 1 的条件确定：
$$
\int_{-1}^{1} \int_{0}^{2\pi} p(\mu, \phi) \, d\phi \, d\mu = C \int_{-1}^{1} \frac{d\sigma}{d\Omega}(\mu) \left( \int_{0}^{2\pi} d\phi \right) d\mu = 2\pi C \int_{-1}^{1} \frac{d\sigma}{d\Omega}(\mu) \, d\mu = 1
$$
这个积分 $\int_{-1}^{1} 2\pi \frac{d\sigma}{d\Omega}(\mu) \, d\mu$ 正是[总散射截面](@entry_id:168963) $\sigma_s$ 的定义。因此，[归一化常数](@entry_id:752675) $C = \frac{1}{\sigma_s} = \frac{1}{2\pi \int_{-1}^{1} \frac{d\sigma}{d\Omega}(\mu) \, d\mu}$。

我们关心的是关于[散射角](@entry_id:171822)余弦 $\mu$ 的[边际概率密度函数](@entry_id:264030) (marginal PDF) $p(\mu)$。这可以通过将联合 PDF 对 $\phi$ 进行积分得到：
$$
p(\mu) = \int_{0}^{2\pi} p(\mu, \phi) \, d\phi = \int_{0}^{2\pi} \frac{1}{\sigma_s} \frac{d\sigma}{d\Omega}(\mu) \, d\phi = \frac{2\pi}{\sigma_s} \frac{d\sigma}{d\Omega}(\mu)
$$
将 $\sigma_s$ 的表达式代入，我们得到最终的归一化 PDF：
$$
p(\mu) = \frac{2\pi \frac{d\sigma}{d\Omega}(\mu)}{2\pi \int_{-1}^{1} \frac{d\sigma}{d\Omega}(\mu') \, d\mu'} = \frac{\frac{d\sigma}{d\Omega}(\mu)}{\int_{-1}^{1} \frac{d\sigma}{d\Omega}(\mu') \, d\mu'}
$$
这个公式是蒙特卡罗方法中从角[微分截面](@entry_id:137333)抽样散射角的基本出发点。它清晰地表明，散射角余弦 $\mu$ 的概率密度与该方向的[微分截面](@entry_id:137333)值成正比。

#### 联合能量-角概率分布

许多散射过程不仅改变中子的方向，也改变其能量。在这种情况下，我们需要一个关于次级能量 $E'$ 和散射角余弦 $\mu$ 的[联合概率密度函数](@entry_id:267139) $p(\mu, E'|E)$，其中 $E$ 是入射中子能量。这个联合 PDF 可以从双[微分散射截面](@entry_id:1123684) $\frac{d^2\Sigma_s(E \to E', \Omega)}{dE' d\Omega}$ 导出。该[截面](@entry_id:154995)描述了能量为 $E$ 的[中子散射](@entry_id:142835)后，能量落在 $E'$ 附近、方向落在 $\Omega$ 附近的概率。

类似于[角分布](@entry_id:193827)的推导，联合 PDF 通过将双[微分截面](@entry_id:137333)除以[总散射截面](@entry_id:168963) $\Sigma_s(E)$ 进行归一化。同样假设[方位角](@entry_id:164011)对称，我们需要对 $\phi$ 积分：
$$
p(\mu, E' | E) = \frac{1}{\Sigma_s(E)} \int_{0}^{2\pi} \frac{d^2\Sigma_s(E \to E', \Omega)}{dE' d\Omega} \, d\phi
$$
通常定义一个仅依赖于 $\mu$ 和 $E'$ 的双[微分截面](@entry_id:137333) $\frac{d^2\Sigma_s(E \to E', \mu)}{dE' d\mu} \equiv \int_{0}^{2\pi} \frac{d^2\Sigma_s(E \to E', \Omega)}{dE' d\Omega} \, d\phi$。于是，联合 PDF 表达式为：
$$
p(\mu, E' | E) = \frac{1}{\Sigma_s(E)} \frac{d^2\Sigma_s(E \to E', \mu)}{dE' d\mu}
$$
一个至关重要的物理概念是**能量-角[度相关性](@entry_id:1123507)**。如果次级能量的分布不依赖于[散射角](@entry_id:171822)（反之亦然），则称能量和角度是统计独立的。在这种情况下，联合 PDF 可以分解为两个边际 PDF 的乘积：
$$
p(\mu, E' | E) = p_\mu(\mu | E) \, p_E(E' | E)
$$
然而，在许多重要的物理过程中，这种独立性并不成立。例如，我们将在下一节看到的[弹性散射](@entry_id:152152)，其能量和角度之间存在严格的运动学约束。判断是否存在相关性的通用准则是检查联合 PDF 是否可以被因子分解。如果不能，则能量和角度是相关的。零协方差仅表示[线性无关](@entry_id:148207)，不能作为判断[统计独立性](@entry_id:150300)的充分条件。

### [弹性散射](@entry_id:152152)：运动学骨架

[弹性散射](@entry_id:152152)是中子与原子核之间最基本的相互作用之一。在此过程中，系统的总[动能守恒](@entry_id:177660)。尽管模型简单，但它揭示了能量与角度之间深刻的内在联系。

#### 静态靶核的[散射运动学](@entry_id:754556)

考虑一个质量为 $m$、实验室系能量为 $E_0$ 的非相对论中子，与一个静止的质量为 $M=Am$ 的靶核发生[弹性碰撞](@entry_id:188584)。分析这种碰撞最简洁的方法是在[质心](@entry_id:138352) (Center-of-Mass, CM) 坐标系中进行。在 CM 系中，总动量为零，[弹性散射](@entry_id:152152)仅改变粒子的运动方向，而不改变其速度大小。

通过伽利略变换，我们可以推导出散射后中子在实验室系的能量 $E'$ 与其在 CM 系的散射角余弦 $\mu_{\text{CM}} = \cos(\theta_{\text{CM}})$ 之间的精确关系。这个关系完全由[动量守恒](@entry_id:149964)和能量守恒定律决定。其结果为：
$$
E' = E_0 \frac{A^2 + 1 + 2A \mu_{\text{CM}}}{(A+1)^2}
$$
其中 $A$ 是靶核与中子的[质量比](@entry_id:167674)。由于 $\mu_{\text{CM}}$ 的物理取值范围是 $[-1, 1]$，对应于从前向散射 ($\theta_{\text{CM}}=0$) 到后向散射 ($\theta_{\text{CM}}=\pi$) 的所有可能情况，我们可以得到次级能量 $E'$ 的范围。
-   当 $\mu_{\text{CM}} = 1$ ([前向散射](@entry_id:191808))，中子能量损失最小， $E'_{max} = E_0$。
-   当 $\mu_{\text{CM}} = -1$ (后向散射)，中子能量损失最大， $E'_{min} = E_0 \left(\frac{A-1}{A+1}\right)^2$。

这个著名的运动学关系式  是中子慢化理论的基石。它揭示了一个核心事实：对于静态靶核的[弹性散射](@entry_id:152152)，次级能量和散射角是**完全确定性相关的**。一旦通过抽样得到了 CM 系的散射角 $\mu_{\text{CM}}$，次级能量 $E'$ 就被唯一确定。反之亦然。因此，在这种情况下，我们只需要对一个变量（通常是 $\mu_{\text{CM}}$）进行抽样。

#### [散射运动学](@entry_id:754556)的验证

上述运动学关系是物理守恒律的直接推论。在开发和验证复杂的抽样算法时，确保其产生的次级能量和角度样本 $(E', \mu)$ 遵守这些基本守恒律至关重要。一个强大的诊断方法是基于相对论[四维动量守恒](@entry_id:200281)。

考虑一个入射中子（动能 $T$，静质 $m_n$）和一个静止靶核（静质 $m_A$）的系统。其总[四动量](@entry_id:264378) $p_{\text{tot}}^\mu$ 是守恒的。对于一个给定的 CM 散射角余弦 $\mu$，我们可以通过[洛伦兹变换](@entry_id:176827)从 CM 系预测出散射后中子在实验室系中的[四动量](@entry_id:264378)，从而得到一个预测动能 $T_{\text{pred}}$。一个物理上相容的样本 $(E', \mu)$ 必须满足 $E' \approx T_{\text{pred}}$。

此外，我们还可以通过总四[动量守恒](@entry_id:149964) $p_A'^\mu = p_{\text{tot}}^\mu - p_n'^\mu$ 来构建反冲核的[四动量](@entry_id:264378) $p_A'^\mu$，其中 $p_n'^\mu$ 是使用样本 $E'$ 和预测方向构建的次级中子[四动量](@entry_id:264378)。然后，我们可以计算反冲核的[不变质量](@entry_id:265871)平方 $(m_A')^2 = p_A'^\mu p_{A'\mu}$。对于[弹性散射](@entry_id:152152)，这个值必须等于靶核的原始静质平方 $m_A^2$。这些检查共同构成了一个全面的运动学验证程序，确保模拟的物理真实性。

### [角分布](@entry_id:193827)的抽样技术

在许多情况下，角[微分截面](@entry_id:137333)以[勒让德多项式](@entry_id:141510)展开的形式给出，这在[核数据库](@entry_id:1128922)中非常普遍。
$$
\frac{d\sigma}{d\Omega}(\mu) = \sum_{l=0}^{L} a_l P_l(\mu)
$$
相应的 PDF 为 $p(\mu) = \frac{1}{2a_0} \sum_{l=0}^{L} a_l P_l(\mu)$。为了从此分布中抽样，最直接的方法是使用[逆变换法](@entry_id:141695) (inverse transform sampling)，这需要我们首先构建[累积分布函数](@entry_id:143135) (Cumulative Distribution Function, CDF) $F(\mu) = \int_{-1}^{\mu} p(t) dt$。

利用[勒让德多项式](@entry_id:141510)的积分性质，特别是[递推关系](@entry_id:189264) $\int P_l(t) dt = \frac{P_{l+1}(t) - P_{l-1}(t)}{2l+1}$ (对于 $l \ge 1$)，我们可以推导出 CDF 的解析表达式 ：
$$
F(\mu) = \frac{\mu+1}{2} + \frac{1}{2a_0} \sum_{l=1}^{L} a_l \frac{P_{l+1}(\mu) - P_{l-1}(\mu)}{2l+1}
$$
有了这个 CDF 表达式后，抽样过程如下：
1.  抽取一个在 $[0,1]$ 上均匀分布的随机数 $\xi$。
2.  求解方程 $F(\mu) = \xi$ 以得到 $\mu$。

由于 $F(\mu)$ 是一个复杂的多项式，直接求逆通常不可行。在实践中，需要使用数值方法（如牛顿法或查表法）来求解该方程。

#### 勒让德展开的物理有效性

一个关键的实际问题是，由勒让德系数 $\lbrace c_l \rbrace$（在归一化的 PDF $p(\mu) = \sum c_l P_l(\mu)$ 中，$c_0=1/2$）定义的 PDF 必须是非负的，即 $p(\mu) \ge 0$ 对所有 $\mu \in [-1, 1]$。然而，截断的[勒让德级数](@entry_id:276646)，特别是高阶展开，可能会因为[吉布斯现象](@entry_id:138701)而在某些 $\mu$ 值处产生负值，这是非物理的。

虽然不存在关于系数 $\lbrace c_l \rbrace$ 的简单充要条件，但我们可以建立一些实用的检查：
-   **一个充分条件**：基于[勒让德多项式](@entry_id:141510)的边界 $|P_l(\mu)| \le 1$，可以证明如果 $\sum_{l=1}^{L} |c_{l}| \le \frac{1}{2}$，则 $p(\mu)$ 保证非负。
-   **两个必要条件**：在区间的端点 $\mu=1$ 和 $\mu=-1$ 处，PDF 必须非负。利用 $P_l(1)=1$ 和 $P_l(-1)=(-1)^l$，这导致：
    $$
    p(1) = \sum_{l=0}^{L} c_l \ge 0 \quad \text{和} \quad p(-1) = \sum_{l=0}^{L} c_l (-1)^l \ge 0
    $$

在实际的输运程序中，如果发现核数据提供的勒让德系数导致了负的 PDF，就必须采取修正措施。常见的策略包括：将负值部分截断为零并重新归一化，或者降低勒让德展开的阶数 $L$ 以获得更平滑、无负值的分布。这些检查和修正是确保模拟稳定性和物理真实性的重要步骤。

### 靶核热运动的模型

到目前为止，我们主要假设靶核是静止的。然而，在反应堆的慢化剂中，特别是在[热中子](@entry_id:270226)能量范围内（约 0.025 eV），靶核的自身热运动不可忽略。这种运动会改变碰撞的相对速度和[质心系](@entry_id:168444)，从而影响次级中子的能量和角度分布，这种现象被称为**多普勒展宽**。

#### 自由气体模型

最简单的热运动模型是**自由气体模型**。它假设介质中的原子核像理想气体一样自由运动，彼此之间以及与束缚它们的[晶格](@entry_id:148274)或分子之间没有相互作用。在温度 $T$ 下，根据经典统计力学，原子核的速度分量 $v_x, v_y, v_z$ 相互独立，并且均服从均值为 0、方差为 $\sigma^2 = k_B T / m_t$ 的正态分布（高斯分布），其中 $k_B$ 是[玻尔兹曼常数](@entry_id:142384)，$m_t$ 是靶核质量。

因此，从这个模型中抽样一个靶核[速度矢量](@entry_id:269648) $\vec{v}_t$ 的方法非常直接 ：
1.  生成三个独立的[标准正态分布](@entry_id:184509)[随机变量](@entry_id:195330) $Z_1, Z_2, Z_3 \sim \mathcal{N}(0,1)$。
2.  构造速度分量：
    $$
    v_{tx} = \sqrt{\frac{k_B T}{m_t}} Z_1, \quad v_{ty} = \sqrt{\frac{k_B T}{m_t}} Z_2, \quad v_{tz} = \sqrt{\frac{k_B T}{m_t}} Z_3
    $$
    得到的[速度矢量](@entry_id:269648) $\vec{v}_t = (v_{tx}, v_{ty}, v_{tz})$ 就是麦克斯韦-玻尔兹曼分布的一个样本。

一旦抽样得到 $\vec{v}_t$，就可以计算中子与靶核的相对速度 $\vec{w} = \vec{v}_n - \vec{v}_t$，然后在以 $\vec{w}$ 定义的[质心系](@entry_id:168444)中处理[散射运动学](@entry_id:754556)。自由气体模型在能量远高于原子[结合能](@entry_id:143405)（通常大于 1 eV）时是很好的近似，但对于[热化](@entry_id:142388)区域的中子，它忽略了[化学键](@entry_id:145092)和晶格振动（声子）的重要影响。

#### 束缚原子模型：$S(\alpha, \beta)$ 形式论

为了精确描述热中子在慢化剂（如水、石墨）中的散射，必须采用基于量子力学和固体物理的**束缚原子模型**。这种模型的全部信息被编码在一个称为**热散射律 (thermal scattering law)** 的函数 $S(\alpha, \beta)$ 中。

这里的 $\alpha$ 和 $\beta$ 是无量纲的动量和能量转移变量：
-   **无量纲动量转移 $\alpha$**：定义为 $\alpha \equiv \frac{E' + E - 2 \sqrt{E E'}\, \mu}{A\, k_{B} T}$，表示传递给自由靶核的反冲能（以 $k_B T$ 为单位）。
-   **无量纲能量转移 $\beta$**：定义为 $\beta \equiv \frac{E' - E}{k_{B} T}$，表示中子获得的能量（以 $k_B T$ 为单位）。$\beta > 0$ 对应**上散射**（能量增加），$\beta  0$ 对应**下散射**（能量减少）。

双[微分截面](@entry_id:137333)与 $S(\alpha, \beta)$ 的关系为：
$$
\frac{d^2\sigma}{dE' d\Omega} \propto \sqrt{\frac{E'}{E}} S(\alpha, \beta)
$$
因此，蒙特卡罗模拟中的抽样正是从这个与 $\sqrt{E'/E} S(\alpha, \beta)$ 成正比的核中进行的。

$S(\alpha, \beta)$ 函数的一个核心性质是**细致平衡 (detailed balance)** 原理。该原理是热力学平衡和[微观可逆性](@entry_id:136535)的要求，它将上散射和下散射过程联系起来。对于标准的（非对称）散射律，[细致平衡条件](@entry_id:265158)表现为：
$$
S(\alpha, \beta) = e^{-\beta} S(\alpha, -\beta)
$$
这个性质保证了在中子与介质[达到热平衡](@entry_id:1132996)后，中子能量谱将趋于麦克斯韦-玻尔兹曼分布。它对[上散射](@entry_id:1133634)和下散射的相对概率施加了严格的约束。考虑能量转移大小为 $|\beta|$ 的事件，[上散射](@entry_id:1133634)（能量转移为 $+\beta$）与下散射（能量转移为 $-\beta$）的[概率密度](@entry_id:175496)之比为：
$$
\frac{p(+\beta)}{p(-\beta)} = e^{-\beta}
$$
这意味着在任何温度下，中子失去能量（下散射）总是比获得相同大小能量（上散射）更容易。这个关系在设计 $S(\alpha, \beta)$ 抽样算法时至关重要，例如，它决定了在抽样得到能量转移大小后，如何以正确的概率（如 $\pi(\beta) = \frac{1}{1+e^{\beta}}$）来决定其符号是正（上散射）还是负（下散射）。

### 连续区出射模型

除了[弹性散射](@entry_id:152152)和热散射，高能中子还可能引起[非弹性散射](@entry_id:138624)、(n,2n)、(n,p) 等反应，这些反应的次级粒子（特别是中子）的能量通常分布在一个连续的谱上。对这些**连续区出射**[过程建模](@entry_id:183557)需要不同于前面讨论的方法。

**Kalbach-Mann 系统学**是一个广泛应用的半唯象模型，用于描述这种情况下的双[微分](@entry_id:158422)概率分布。该模型的基本思想是将联合 PDF $p(\mu, E')$ 分解为一个能量谱[部分和](@entry_id:162077)一个角度分布部分的乘积。
-   **能量谱**：假设粒子是从一个处于[热平衡](@entry_id:157986)的“[复合核](@entry_id:159470)”系统蒸发出来的，其能量谱遵循类似于麦克斯韦分布的形式，正比于 $\exp(-E'/T)$，其中 $T$ 是一个[有效温度](@entry_id:161960)。
-   **角度分布**：假设角向异性不强，可以由一个截断的勒让德展开来近似，通常只保留到一阶项，以描述[前后不对称性](@entry_id:159567)，即正比于 $1 + \xi(E')\mu$。其中 $\xi(E')$ 是一个依赖于能量的**各向异性参数**。

综合起来，该模型的联合 PDF 形式为：
$$
p(\mu, E') \propto \exp\left(-\frac{E'}{T}\right) \left[1 + \xi(E')\mu\right]
$$
为了使其成为一个有效的 PDF，必须进行归一化，并对参数施加物理约束。通过对 $\mu \in [-1, 1]$ 和 $E' \in [0, \infty)$ 进行积分，可以求得[归一化常数](@entry_id:752675)，得到归一化的 PDF 为 ：
$$
p(\mu, E') = \frac{1}{2T} \exp\left(-\frac{E'}{T}\right) \left[1 + \xi(E')\mu\right]
$$
同时，为了保证 PDF 在整个定义域内非负，各向异性参数必须满足 $|\xi(E')| \le 1$。这类模型展示了如何结合统计物理思想和唯象假设来构建适用于蒙特卡罗模拟的、描述复杂核反应的实用工具。