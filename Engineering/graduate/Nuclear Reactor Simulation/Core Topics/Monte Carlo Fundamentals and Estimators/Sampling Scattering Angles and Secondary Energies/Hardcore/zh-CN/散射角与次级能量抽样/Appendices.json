{
    "hands_on_practices": [
        {
            "introduction": "在核反应堆模拟中，许多过程（如中子非弹性散射或裂变）会产生一个处于高激发态的复合核。这个核随后会“蒸发”出一个或多个粒子来退激发。本实践将指导您从统计力学的第一性原理出发，推导描述蒸发中子能量分布的韦斯科普夫-尤因（Weisskopf-Ewing）模型，并探索两种关键的抽样方法。掌握这些方法是精确模拟次级粒子能量分布的基础技能，它将理论物理与蒙特卡洛算法实现紧密联系起来 。",
            "id": "4247135",
            "problem": "考虑在核反应堆模拟中，一个高激发复合核的中子发射，该过程通过魏斯科普夫-尤因（Weisskopf–Ewing）蒸发模型进行建模。假设发射体可被视为温度为 $T$ 的正则系综，并且发射出的中子是非相对论性的，其动能为 $E'$。单位能量的发射概率与相空间因子和玻尔兹曼因子的乘积成正比。对于无势垒的s波发射，其透射系数变化缓慢（因此其能量依赖性在由 $T$ 决定的尺度上可以忽略），相空间因子与连续态密度和粒子速率的乘积成正比。使用统计力学和非相对论运动学的第一性原理：\n\n- 推导发射中子的归一化次级能量谱 $p(E' \\mid T)$。\n- 证明所得分布属于伽马分布族，并确定其形状和尺度参数。\n- 从精确的累积分布函数出发，仅使用标准特殊函数，以闭合形式推导出一个显式的逆累积变换 $E'(u)$，其中 $u \\in (0,1)$ 是一个均匀随机变量。\n- 仔细论证为确保对所有 $u \\in (0,1)$ 都有 $E'(u) \\geq 0$ 所需的特殊函数分支选择。\n- 提出一种无需数值求根即可处理能谱中能量线性因子的高效抽样方法，并用独立的均匀随机变量表示抽样得到的能量。\n\n提供逆累积映射 $E'(u)$ 的最终显式解析表达式，该表达式为一个关于 $u$ 和 $T$ 的单一闭合形式公式。最终能量以兆电子伏特（MeV）为单位表示。无需进行数值代入。最终答案必须是单一的闭合形式解析表达式，且不含不等式。本问题不涉及角度。",
            "solution": "这个问题有科学依据，是适定的，并且包含足够的信息以获得唯一解。这是统计核物理中的一个标准问题，与核应用中次级粒子能量的模拟直接相关。我将进行完整的推导。\n\n问题要求推导次级中子能量谱，确定其属于伽马分布族，推导用于抽样的逆累积分布函数，并提出一种替代的高效抽样算法。最终答案被指定为逆累积变换的闭合形式表达式。\n\n首先，我们推导归一化的次级能量谱 $p(E' \\mid T)$。问题陈述，动能为 $E'$ 的中子，其单位能量的发射概率与相空间因子和玻尔兹曼因子的乘积成正比。\n设未归一化的概率密度函数记为 $f(E')$。根据问题陈述，我们有：\n$$f(E') \\propto (\\text{相空间因子}) \\times (\\text{玻尔兹曼因子})$$\n在温度为 $T$ 的系统中，能量为 $E'$ 的状态的玻尔兹曼因子由 $\\exp(-E'/T)$ 给出。\n相空间因子被陈述为与连续态密度和粒子速率的乘积成正比。对于非相对论性粒子，动能为 $E' = \\frac{p^2}{2m}$，其中 $p$ 是动量，$m$ 是质量。粒子速率为 $v = \\sqrt{2E'/m}$，与 $(E')^{1/2}$ 成正比。动量区间 $dp$ 内的连续态数目与 $p^2 dp$ 成正比。我们可以用能量来表示它：$p = \\sqrt{2mE'}$，所以 $dp = \\sqrt{2m} \\frac{1}{2}(E')^{-1/2} dE'$。因此，单位能量的态密度 $\\frac{dN}{dE'}$ 与 $p^2 \\frac{dp}{dE'} \\propto (E') \\cdot (E')^{-1/2} = (E')^{1/2}$ 成正比。\n因此，相空间因子与 $(\\text{态密度}) \\times (\\text{速率}) \\propto (E')^{1/2} \\times (E')^{1/2} = E'$ 成正比。\n综合这些因子，发射中子能量 $E'$ 的未归一化概率密度为：\n$$f(E') = C \\cdot E' \\exp(-E'/T)$$\n其中 $C$ 是一个归一化常数且 $E' \\ge 0$。为了求出 $C$，我们要求该分布归一化为1：\n$$\\int_{0}^{\\infty} f(E') dE' = 1$$\n$$C \\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = 1$$\n这个积分是伽马函数的一个标准形式，$\\int_{0}^{\\infty} x^n \\exp(-ax) dx = \\frac{\\Gamma(n+1)}{a^{n+1}} = \\frac{n!}{a^{n+1}}$。当 $n=1$ 和 $a=1/T$ 时，该积分的计算结果为：\n$$\\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = \\frac{1!}{(1/T)^{1+1}} = T^2$$\n将此结果代回归一化条件，得到 $C \\cdot T^2 = 1$，所以 $C = 1/T^2$。\n因此，归一化的次级能量谱 $p(E' \\mid T)$ 为：\n$$p(E' \\mid T) = \\frac{1}{T^2} E' \\exp(-E'/T), \\quad \\text{for } E' \\ge 0$$\n这种形式被称为麦克斯韦-裂变谱或瓦特谱。\n\n接下来，我们证明该分布属于伽马分布族。伽马分布的概率密度函数由形状参数 $k$ 和尺度参数 $\\theta$ 定义为：\n$$f(x; k, \\theta) = \\frac{1}{\\Gamma(k)\\theta^k} x^{k-1} \\exp(-x/\\theta)$$\n将其与我们推导的谱 $p(E' \\mid T)$ 进行比较，我们可以通过匹配函数形式来确定参数。令 $x=E'$ 和 $\\theta=T$。我们的谱可以写成：\n$$p(E' \\mid T) = \\frac{1}{1 \\cdot T^2} (E')^{2-1} \\exp(-E'/T)$$\n通过比较能量项的指数，我们发现 $k-1=1$，这给出了形状参数 $k=2$。尺度参数显然是 $\\theta=T$。这个辨识与归一化常数是一致的，因为 $\\Gamma(k) = \\Gamma(2) = (2-1)! = 1! = 1$。归一化因子 $\\frac{1}{\\Gamma(k)\\theta^k}$ 变为 $\\frac{1}{\\Gamma(2)T^2} = \\frac{1}{1 \\cdot T^2} = \\frac{1}{T^2}$，这与我们推导出的常数完全匹配。因此，推导出的中子能量谱是一个形状参数为 $k=2$、尺度参数为 $\\theta=T$ 的伽马分布。\n\n现在，我们推导逆累积变换 $E'(u)$。首先，我们通过对概率密度函数（PDF）从 $0$ 到 $E'$ 进行积分来计算累积分布函数（CDF）$F(E')$：\n$$F(E') = \\int_{0}^{E'} p(\\epsilon \\mid T) d\\epsilon = \\frac{1}{T^2} \\int_{0}^{E'} \\epsilon \\exp(-\\epsilon/T) d\\epsilon$$\n我们使用分部积分法计算该积分，令 $u' = \\epsilon$ 和 $dv = \\exp(-\\epsilon/T)d\\epsilon$。这得到 $du' = d\\epsilon$ 和 $v = -T \\exp(-\\epsilon/T)$。\n$$\\int \\epsilon \\exp(-\\epsilon/T) d\\epsilon = -\\epsilon T \\exp(-\\epsilon/T) - \\int (-T \\exp(-\\epsilon/T)) d\\epsilon$$\n$$ = -\\epsilon T \\exp(-\\epsilon/T) - T^2 \\exp(-\\epsilon/T) = -T(\\epsilon+T)\\exp(-\\epsilon/T)$$\n计算CDF的定积分：\n$$F(E') = \\frac{1}{T^2} \\left[ -T(\\epsilon+T)\\exp(-\\epsilon/T) \\right]_{0}^{E'}$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) - (-T(0+T)\\exp(0)) \\right)$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) + T^2 \\right) = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n为了找到逆变换，我们令 $F(E') = u$，其中 $u \\in (0,1)$ 是一个均匀随机变量，然后解出 $E'$。\n$$u = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n$$1 - u = \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n这个超越方程可以使用朗伯W函数求解，其定义关系为 $z = W(z)\\exp(W(z))$。为了将我们的方程化为此形式，令 $X = -(1 + E'/T)$。则 $1+E'/T = -X$，且 $E'/T = -X-1$，所以 $-E'/T = X+1$。将这些代入方程：\n$$1-u = (-X)\\exp(-(X+1)) = (-X)\\exp(-X)\\exp(-1)$$\n$$-(1-u)\\exp(1) = X \\exp(X)$$\n该方程的形式为 $z = w\\exp(w)$，其中 $z = -(1-u)\\exp(1)$ 且 $w=X$。因此，X的解由朗伯W函数给出：\n$$X = W\\left(-(1-u)\\exp(1)\\right)$$\n代回 $X = -(1 + E'/T)$：\n$$-(1 + E'/T) = W\\left(-(1-u)\\exp(1)\\right)$$\n$$1 + E'/T = -W\\left(-(1-u)\\exp(1)\\right)$$\n$$E'/T = -1 - W\\left(-(1-u)\\exp(1)\\right)$$\n$$E'(u) = -T \\left[ 1 + W\\left(-(1-u)\\exp(1)\\right) \\right]$$\n现在我们必须选择朗伯W函数的适当分支。对于实数自变量 $z \\in [-1/\\exp(1), 0)$，该函数有两个实数分支：值域为 $[-1, \\infty)$ 的主分支 $W_0(z)$ 和值域为 $(-\\infty, -1]$ 的下分支 $W_{-1}(z)$。\n在我们的情况中，自变量为 $z = -(1-u)\\exp(1)$。由于 $u \\in (0,1)$，我们有 $1-u \\in (0,1)$，因此 $z \\in (-\\exp(1), 0)$。然而，朗伯W函数的自变量是 $-(1-u)\\exp(1)$，但在代数运算中出现了一个错误。让我们来修正它。\n从 $1-u = (1+E'/T)\\exp(-E'/T)$ 开始。令 $Y = -(1+E'/T)$。则 $-E'/T = Y+1$。方程变为 $1-u = -Y \\exp(Y+1) = -Y \\exp(Y) \\exp(1)$。这得到 $-(1-u)\\exp(-1) = Y \\exp(Y)$。这是正确的 $z = w \\exp(w)$ 形式，其中 $z = -(1-u)\\exp(-1)$ 且 $w=Y$。解为 $Y = W(z)$。\n$$Y = W(-(1-u)\\exp(-1))$$\n现在代回 $Y = -(1+E'/T)$：\n$$-(1+E'/T) = W(-(1-u)\\exp(-1))$$\n$$E'(u) = -T \\left[ 1 + W(-(1-u)\\exp(-1)) \\right]$$\nW函数的自变量是 $z = -(1-u)\\exp(-1)$。由于 $u \\in (0,1)$，$1-u \\in (0,1)$，所以 $z \\in (-\\exp(-1), 0)$。这个区间在两个实数分支 $W_0$ 和 $W_{-1}$ 的定义域内。\n我们需要一个物理上有意义的解，即 $E'(u) \\ge 0$。由于 $T0$，这意味着 $1 + W(z) \\le 0$，或者 $W(z) \\le -1$。\n主分支 $W_0(z)$ 将区间 $[-\\exp(-1), \\infty)$ 映射到 $[-1, \\infty)$。对于 $z \\in (-\\exp(-1), 0)$，我们有 $W_0(z) \\in (-1, 0)$。这个选择将导致 $1+W_0(z)  0$，从而 $E'  0$，这是非物理的。\n下分支 $W_{-1}(z)$ 将区间 $[-\\exp(-1), 0)$ 映射到 $(-\\infty, -1]$。这个选择保证了 $W_{-1}(z) \\le -1$，这意味着 $1+W_{-1}(z) \\le 0$，从而 $E' \\ge 0$。\n因此，正确的分支是 $W_{-1}$。逆累积变换的最终表达式是：\n$$E'(u) = -T \\left[ 1 + W_{-1}\\left(-(1-u)\\exp(-1)\\right) \\right]$$\n问题还要求一种高效的抽样方法。将能量分布确定为伽马分布Gamma($k=2, \\theta=T$) 提供了一种非常高效的方法。当 $k$ 为整数时，来自伽马分布Gamma($k, \\theta$) 的随机变量可以通过对 $k$ 个来自尺度参数为 $\\theta$ 的指数分布的独立随机变量求和来生成。\n在我们的情况中，$k=2$。尺度为 $\\theta=T$ 的指数分布的概率密度函数（PDF）是 $p_{exp}(y) = (1/T)\\exp(-y/T)$。其累积分布函数（CDF）是 $F_{exp}(y) = 1-\\exp(-y/T)$。对指数分布使用逆变换抽样法，我们设 $F_{exp}(y)=u'$，其中 $u'$ 是一个在 $(0,1)$ 上的均匀变量，这给出 $y = -T \\ln(1-u')$。由于 $1-u'$ 也在 $(0,1)$ 上均匀分布，我们可以写成 $y = -T \\ln(u')$。\n因此，要从我们的分布中抽样一个能量 $E'$，我们生成两个独立的均匀随机变量 $u_1, u_2 \\in (0,1)$，生成两个独立的指数变量 $Y_1 = -T \\ln(u_1)$ 和 $Y_2 = -T \\ln(u_2)$，然后将它们相加：\n$$E' = Y_1 + Y_2 = -T \\ln(u_1) - T \\ln(u_2) = -T \\ln(u_1 u_2)$$\n这种方法避免了对特殊函数的数值计算，并且计算效率非常高，仅使用用于对数的标准库函数。\n\n所要求的最终答案是逆累积映射 $E'(u)$ 的显式解析表达式。温度 $T$ 的单位应理解为MeV。",
            "answer": "$$\n\\boxed{-T \\left( 1 + W_{-1}\\left( -(1-u)\\exp(-1) \\right) \\right)}\n$$"
        },
        {
            "introduction": "尽管像上一节中推导的解析谱在理论上非常完美，但真实的蒙特卡洛程序（如 MCNP 或 Serpent）主要依赖于预先计算并以表格形式存储的截面数据。因此，如何在离散的数据点之间进行插值，成为了一个至关重要的实际问题。本实践将引导您研究不同插值方案（如线性-线性、线性-对数、对数-对数）对模拟结果的系统性影响，通过编程量化这些方案引入的平均能量偏差。这项练习有助于培养对数值方法保真度的批判性思维，这是高级模拟实践者必备的素养 。",
            "id": "4247145",
            "problem": "您的任务是分析在列表化的次级能量概率密度函数中使用的插值方案如何影响蒙特卡洛核反应堆模拟中估算的平均次级能量。考虑一个严格为正的能量域和一个具有指数尾部的物理真实能谱，这与反应堆物理中遇到的热化或非弹性过程一致。您将比较应用于列表化概率密度函数的三种插值方案，并计算每种方案在平均次级能量中引入的偏差。\n\n基于以下基本定义进行推导和计算：\n- 能量域 $E' \\in [E_{\\min}, E_{\\max}]$ 上的概率密度函数 (PDF) $p(E')$ 满足归一化条件：$$\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1.$$\n- 分布的均值为：$$\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'.$$\n- 对于真实的截断指数谱，假设：$$p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}, \\quad E' \\in [E_{\\min}, E_{\\max}],$$ 其中 $T$ 是一个尺度参数，类似于以电子伏特为单位的有效温度。\n\nPDF 在网格点 $\\{E_i\\}_{i=0}^{N-1}$ 上进行列表化，其中 $E_0 = E_{\\min}$ 和 $E_{N-1} = E_{\\max}$，且能量严格递增 $E_{i+1}  E_i$。列表值为 $p_i = p_{\\text{true}}(E_i)$。在每个区间 $[E_i, E_{i+1}]$ 上定义三种插值方案：\n1. $p$ 上关于 $E'$ 线性（线性-线性）：在 $(E_i, p_i)$ 和 $(E_{i+1}, p_{i+1})$ 之间，将 $p(E')$ 作为 $E'$ 的函数进行线性插值。\n2. $p$ 上关于 $\\log E'$ 线性（线性-对数）：在 $(\\log E_i, p_i)$ 和 $(\\log E_{i+1}, p_{i+1})$ 之间，将 $p(E')$ 作为 $\\log E'$ 的函数进行线性插值。这要求 $E_{\\min}  0$。\n3. $\\log p$ 上关于 $\\log E'$ 线性（对数-对数）：在 $(\\log E_i, \\log p_i)$ 和 $(\\log E_{i+1}, \\log p_{i+1})$ 之间，将 $\\log p(E')$ 作为 $\\log E'$ 的函数进行线性插值。这要求 $E_{\\min}  0$ 和 $p_i  0$。\n\n对于每种插值方案，在 $[E_{\\min}, E_{\\max}]$ 上构建一个分段插值函数 $\\tilde{p}(E')$，对其进行重新归一化以满足 $$\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') \\, dE' = 1$$ 从而得到一个有效的 PDF $\\hat{p}(E')$，然后计算近似均值 $$\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'。$$\n将每种方案的偏差定义为 $$\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}},$$ 其中 $\\langle E' \\rangle_{\\text{true}}$ 是 $p_{\\text{true}}(E')$ 在 $[E_{\\min}, E_{\\max}]$ 上的均值。\n\n您的程序必须为以下测试套件实现这些步骤，涵盖典型、粗糙、对数间隔和长尾情况。所有能量和尺度参数 $T$ 都必须以电子伏特 (eV) 为单位，所有报告的偏差也必须以电子伏特 (eV) 为单位。此问题不涉及角度。\n\n测试套件（每个案例是一个元组 $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type})$）：\n- 案例 1（一般情况，线性网格）：$(1.0, 10^{-6}, 10.0, 32, \\text{linear})$。\n- 案例 2（粗网格，线性）：$(1.0, 10^{-6}, 10.0, 4, \\text{linear})$。\n- 案例 3（对数网格，更宽的尾部）：$(0.5, 10^{-6}, 20.0, 32, \\text{log})$。\n- 案例 4（对数网格，长尾）：$(2.0, 10^{-3}, 40.0, 16, \\text{log})$。\n\n网格构建规则：\n- 对于 $\\text{grid\\_type} = \\text{linear}$：$$E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1},\\quad i=0,\\dots,N-1.$$\n- 对于 $\\text{grid\\_type} = \\text{log}$：$$E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}},\\quad i=0,\\dots,N-1.$$\n\n要求：\n- 在每个区间上实现三种插值方案，分段形成 $\\tilde{p}(E')$，重新归一化以获得 $\\hat{p}(E')$，并为每种方案计算 $\\widehat{\\langle E' \\rangle}$。\n- 计算在 $p_{\\text{true}}(E')$ 下的真实均值 $\\langle E' \\rangle_{\\text{true}}$（在 $[E_{\\min}, E_{\\max}]$上）。\n- 对于每个测试案例，以电子伏特 (eV) 为单位输出三种方案的偏差，作为浮点数，四舍五入到八位小数。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个逗号分隔的列表的列表形式的结果，每个内部列表按 [线性-线性, 线性-对数, 对数-对数] 的顺序给出三种偏差，对应四个测试案例。例如：\"[[b11,b12,b13],[b21,b22,b23],[b31,b32,b33],[b41,b42,b43]]\"。\n\n所有能量和偏差都以电子伏特 (eV) 表示，并在最终输出中四舍五入到八位小数。角度不是此任务的一部分；不需要角度单位。",
            "solution": "用户提供的问题在科学上是合理的、适定的，并且需要严谨的数值解。我将首先根据指定标准验证问题陈述，然后着手解决。\n\n### 步骤 1：问题验证\n\n我将首先提取已知条件，然后验证问题。\n\n#### 提取已知条件\n- **概率密度函数 (PDF) 定义**：如果函数 $p(E')$ 在 $E' \\in [E_{\\min}, E_{\\max}]$ 上非负且满足 $\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1$，则它是一个 PDF。\n- **分布的均值**：$\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'$。\n- **真实 PDF**：PDF 的解析形式是一个截断指数函数，由 $p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}$ 给出，其中 $E' \\in [E_{\\min}, E_{\\max}]$。$T$ 是一个以电子伏特 (eV) 为单位的尺度参数。\n- **列表化**：PDF 在 $N$ 个网格点 $\\{E_i\\}_{i=0}^{N-1}$ 上进行采样，其中 $E_0 = E_{\\min}$ 且 $E_{N-1} = E_{\\max}$。列表值为 $p_i = p_{\\text{true}}(E_i)$。\n- **插值方案**：\n    1. **线性-线性**：在每个区间 $[E_i, E_{i+1}]$ 上，$p(E')$ 关于 $E'$ 进行线性插值。\n    2. **线性-对数**：在每个区间 $[E_i, E_{i+1}]$ 上，$p(E')$ 关于 $\\log E'$ 进行线性插值（要求 $E_{\\min}  0$）。\n    3. **对数-对数**：在每个区间 $[E_i, E_{i+1}]$ 上，$\\log p(E')$ 关于 $\\log E'$ 进行线性插值（要求 $E_{\\min}  0$ 和 $p_i  0$）。\n- **计算任务**：\n    1. 对每种方案，构建一个分段插值函数 $\\tilde{p}(E')$。\n    2. 对其重新归一化，得到一个有效的 PDF $\\hat{p}(E')$。\n    3. 计算近似均值 $\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'$。\n    4. 计算偏差：$\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}}$。\n- **网格生成**：\n    - **线性网格**：$E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1}$，对于 $i=0,\\dots,N-1$。\n    - **对数网格**：$E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}}$，对于 $i=0,\\dots,N-1$。\n- **测试套件**：提供了四个案例，形式为元组 $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type})$：\n    - 案例 1：$(1.0, 10^{-6}, 10.0, 32, \\text{linear})$\n    - 案例 2：$(1.0, 10^{-6}, 10.0, 4, \\text{linear})$\n    - 案例 3：$(0.5, 10^{-6}, 20.0, 32, \\text{log})$\n    - 案例 4：$(2.0, 10^{-3}, 40.0, 16, \\text{log})$\n- **输出格式**：一个单行字符串，表示一个列表的列表，其中包含偏差值，例如 `[[b11,b12,b13],[b21,b22,b23],...]`，所有数字四舍五入到八位小数。\n\n#### 验证结论\n- **科学基础**：该问题牢固地植根于计算物理和数值分析。使用截断指数谱是反应堆物理中一个合理的模型，而插值误差的分析是一种标准且重要的实践。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。所有函数、参数和程序都得到了明确的定义。这些定义为每个测试案例导出了一个唯一的、可计算的解。\n- **客观性**：语言是精确和数学化的，没有任何主观性或意见。\n- **完整性与一致性**：问题陈述是自洽的。它提供了所有必要的数据和公式。对数方案的要求（$E_{\\min}  0$，$p_i  0$）由问题的物理性质和具体的测试案例满足。没有矛盾之处。\n\n该问题被认定为**有效**。我现在将继续进行求解。\n\n### 步骤 2：解析与数值公式的推导\n\n问题的核心是计算形如 $\\int f(E') dE'$ 和 $\\int E' f(E') dE'$ 的定积分，其中 $f(E')$ 是真实 PDF 或其中一种插值 PDF。\n\n#### 真实均值 $\\langle E' \\rangle_{\\text{true}}$\n真实 PDF 为 $p_{\\text{true}}(E') = \\frac{1}{C} \\exp(-E'/T)$，其中 $C = T(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T))$ 是归一化常数。真实均值为：\n$$ \\langle E' \\rangle_{\\text{true}} = \\int_{E_{\\min}}^{E_{\\max}} E' p_{\\text{true}}(E') dE' = \\frac{1}{C} \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' $$\n使用分部积分法，$\\int u e^{au} du = (\\frac{u}{a} - \\frac{1}{a^2})e^{au}$，令 $u=E'$ 和 $a=-1/T$：\n$$ \\int E' \\exp(-E'/T) dE' = [-T E' \\exp(-E'/T) - T^2 \\exp(-E'/T)] $$\n计算从 $E_{\\min}$ 到 $E_{\\max}$ 的定积分得到：\n$$ \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left(T E_{\\min} + T^2\\right)\\exp(-E_{\\min}/T) - \\left(T E_{\\max} + T^2\\right)\\exp(-E_{\\max}/T) $$\n除以 $C$ 并化简，我们得到一个计算真实均值的稳定公式：\n$$ \\langle E' \\rangle_{\\text{true}} = T + \\frac{E_{\\min}\\exp(-E_{\\min}/T) - E_{\\max}\\exp(-E_{\\max}/T)}{\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)} $$\n\n#### 近似均值 $\\widehat{\\langle E' \\rangle}$\n对于每种插值方案，近似均值通过在 $N-1$ 个区间上对两个积分求和的比值来计算：\n$$ \\widehat{\\langle E' \\rangle} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E' \\tilde{p}(E') dE'}{\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') dE'} = \\frac{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE'}{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE'} = \\frac{I_1}{I_0} $$\n其中 $\\tilde{p}_i(E')$ 是在 $[E_i, E_{i+1}]$ 上的插值函数。我们必须推导每种方案下这些积分的解析形式。\n\n**1. 线性-线性插值**\n在 $[E_i, E_{i+1}]$ 上，插值函数是一条直线：$\\tilde{p}_i(E') = A_i E' + B_i$，其中 $A_i = \\frac{p_{i+1} - p_i}{E_{i+1} - E_i}$ 且 $B_i = p_i - A_i E_i$。\n零阶矩（面积）是梯形的面积：\n$$ \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE' = \\frac{1}{2}(p_i + p_{i+1})(E_{i+1} - E_i) $$\n一阶矩是：\n$$ \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE' = \\int_{E_i}^{E_{i+1}} (A_i (E')^2 + B_i E') dE' = \\left[ \\frac{A_i}{3}(E')^3 + \\frac{B_i}{2}(E')^2 \\right]_{E_i}^{E_{i+1}} $$\n\n**2. 线性-对数插值**\n插值函数是 $\\tilde{p}_i(E') = A_i \\log E' + B_i$，其中 $A_i = \\frac{p_{i+1} - p_i}{\\log E_{i+1} - \\log E_i}$ 且 $B_i = p_i - A_i \\log E_i$。\n所需的不定积分是：\n- $\\int (A_i \\log E' + B_i) dE' = A_i(E' \\log E' - E') + B_i E'$\n- $\\int E'(A_i \\log E' + B_i) dE' = A_i\\left(\\frac{(E')^2}{2}\\log E' - \\frac{(E')^2}{4}\\right) + B_i\\frac{(E')^2}{2}$\n通过在 $E_{i+1}$ 和 $E_i$ 处计算这些不定积分的值，可以得到定积分。\n\n**3. 对数-对数插值**\n插值函数是一个幂律函数，$\\tilde{p}_i(E') = C_i (E')^{m_i}$，其中指数为 $m_i = \\frac{\\log p_{i+1} - \\log p_i}{\\log E_{i+1} - \\log E_i}$，系数为 $C_i = p_i / E_i^{m_i}$。\n积分结果取决于 $m_i$ 的值。\n零阶矩：\n$$ \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i} dE' = \\begin{cases} \\frac{C_i}{m_i+1} \\left( E_{i+1}^{m_i+1} - E_i^{m_i+1} \\right)  \\text{若 } m_i \\neq -1 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{若 } m_i = -1 \\end{cases} $$\n一阶矩：\n$$ \\int_{E_i}^{E_{i+1}} E' \\cdot C_i (E')^{m_i} dE' = \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i+1} dE' = \\begin{cases} \\frac{C_i}{m_i+2} \\left( E_{i+1}^{m_i+2} - E_i^{m_i+2} \\right)  \\text{若 } m_i \\neq -2 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{若 } m_i = -2 \\end{cases} $$\n通过对每个区间的结果求和来实现这些公式，以找到总积分 $I_0$ 和 $I_1$，从而计算出近似均值和偏差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates and prints the bias in mean secondary energy for three different\n    interpolation schemes applied to a tabulated truncated exponential PDF.\n    \"\"\"\n    # Test Suite (T, E_min, E_max, N, grid_type)\n    test_cases = [\n        (1.0, 1.0e-6, 10.0, 32, 'linear'),\n        (1.0, 1.0e-6, 10.0, 4, 'linear'),\n        (0.5, 1.0e-6, 20.0, 32, 'log'),\n        (2.0, 1.0e-3, 40.0, 16, 'log'),\n    ]\n\n    all_case_biases = []\n\n    for T, E_min, E_max, N, grid_type in test_cases:\n        # Step 1: Generate energy grid\n        if grid_type == 'linear':\n            E_grid = np.linspace(E_min, E_max, N)\n        else:  # 'log'\n            E_grid = np.geomspace(E_min, E_max, N)\n\n        # Step 2: Define true PDF and calculate true mean\n        exp_min = np.exp(-E_min / T)\n        exp_max = np.exp(-E_max / T)\n        \n        # p_true(E') = exp(-E'/T) / C\n        norm_const_C = T * (exp_min - exp_max)\n        p_grid = np.exp(-E_grid / T) / norm_const_C\n        \n        # Analytical true mean using a numerically stable formula\n        true_mean = T + (E_min * exp_min - E_max * exp_max) / (exp_min - exp_max)\n\n        case_biases = []\n        for scheme in ['lin-lin', 'lin-log', 'log-log']:\n            total_I0 = 0.0\n            total_I1 = 0.0\n            \n            for i in range(N - 1):\n                E_i, E_i1 = E_grid[i], E_grid[i+1]\n                p_i, p_i1 = p_grid[i], p_grid[i+1]\n                \n                I0, I1 = 0.0, 0.0\n                \n                if scheme == 'lin-lin':\n                    A = (p_i1 - p_i) / (E_i1 - E_i)\n                    B = p_i - A * E_i\n                    I0 = (A/2) * (E_i1**2 - E_i**2) + B * (E_i1 - E_i)\n                    I1 = (A/3) * (E_i1**3 - E_i**3) + (B/2) * (E_i1**2 - E_i**2)\n                    \n                elif scheme == 'lin-log':\n                    log_E_i, log_E_i1 = np.log(E_i), np.log(E_i1)\n                    if np.abs(log_E_i1 - log_E_i)  1e-15:\n                        A = 0\n                    else:\n                        A = (p_i1 - p_i) / (log_E_i1 - log_E_i)\n                    B = p_i - A * log_E_i\n                    \n                    # Integral of A*log(E) + B\n                    I0_indef = lambda E, logE: A * (E * logE - E) + B * E\n                    I0 = I0_indef(E_i1, log_E_i1) - I0_indef(E_i, log_E_i)\n                    \n                    # Integral of E*(A*log(E) + B)\n                    I1_indef = lambda E, logE: A * (E**2/2 * logE - E**2/4) + B * E**2/2\n                    I1 = I1_indef(E_i1, log_E_i1) - I1_indef(E_i, log_E_i)\n                    \n                elif scheme == 'log-log':\n                    log_E_i, log_E_i1 = np.log(E_i), np.log(E_i1)\n                    log_p_i, log_p_i1 = np.log(p_i), np.log(p_i1)\n                    \n                    if np.abs(log_E_i1 - log_E_i)  1e-15:\n                        m = 0\n                    else:\n                        m = (log_p_i1 - log_p_i) / (log_E_i1 - log_E_i)\n                    C = p_i / (E_i**m)\n                    \n                    if abs(m + 1.0)  1e-9:\n                        I0 = C * (log_E_i1 - log_E_i)\n                    else:\n                        I0 = C / (m + 1.0) * (E_i1**(m + 1.0) - E_i**(m + 1.0))\n                        \n                    if abs(m + 2.0)  1e-9:\n                        I1 = C * (log_E_i1 - log_E_i)\n                    else:\n                        I1 = C / (m + 2.0) * (E_i1**(m + 2.0) - E_i**(m + 2.0))\n            \n                total_I0 += I0\n                total_I1 += I1\n            \n            approx_mean = total_I1 / total_I0\n            bias = approx_mean - true_mean\n            case_biases.append(round(bias, 8))\n            \n        all_case_biases.append(case_biases)\n\n    print(str(all_case_biases).replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "本节我们将挑战一个更高级的应用：为复杂的多粒子出射反应（例如 $(n,2n)$ 反应）建立抽样模型。这类反应在快中子谱反应堆中非常重要，精确建模对中子增殖和能量沉积的计算至关重要。这项实践的核心挑战在于，如何在顺序抽取多个出射粒子能量的同时，严格遵守能量守恒定律。通过本练习，您将学会如何将基础的抽样构建模块（如截断能量谱和非各向同性角分布的抽样）组合起来，构建出符合物理规律的复杂反应道模型 。",
            "id": "4247165",
            "problem": "考虑一个用于核反应堆模拟的简化蒙特卡洛（MC）模型，该模型模拟中子诱发的双中子出射反应，通常表示为 $(n,2n)$。一个动能为 $E_0$ 的入射中子与一个靶核相互作用。该反应需要一个阈能预算 $\\Delta$，用于激发和结合能的消耗，因此发射的次级粒子可用的总动能为 $E_{\\text{avail}} = E_0 - \\Delta$。目标是在实验室坐标系中对两个出射中子的能量 $E'_1$ 和 $E'_2$ 及其极向散射角 $\\theta_1$ 和 $\\theta_2$ 进行抽样，同时强制满足能量守恒，即 $E'_1 + E'_2 \\le E_{\\text{avail}}$。抽样过程是顺序进行的，第二个能量是从被剩余能量预算截断的条件谱中抽样。所有能量必须以兆电子伏特（MeV）表示，所有角度必须以弧度表示。\n\n该问题的基本依据是能量守恒和概率公理，并结合了经过充分检验的发射谱模型和各向异性角分布：\n- 能量守恒意味着 $E'_1 + E'_2 \\le E_{\\text{avail}}$，其中 $E_{\\text{avail}} = E_0 - \\Delta$。如果 $E_{\\text{avail}} \\le 0$，则该反应不可行。\n- 单个出射中子的能谱由蒸发谱建模，具体为一个形状参数 $k=2$ 和尺度参数 $T$ 的伽马分布，即 $f(E) \\propto E \\exp(-E/T)$，其中 $T0$ 是一个类温度谱参数，单位为 MeV。为了强制满足能量预算，$f(E)$ 被截断在区间 $[0, E_{\\max}]$ 上，其中 $E_{\\max}$ 是当前剩余的能量预算。对 $E'_1$ 进行抽样时使用 $E_{\\max} = E_{\\text{avail}}$，然后对 $E'_2$ 进行抽样时使用 $E_{\\max} = E_{\\text{avail}} - E'_1$，这样通过构造即可保证 $E'_1+E'_2 \\le E_{\\text{avail}}$。\n- 极向散射角 $\\theta$ 通过其一阶各向异性分布 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$（其中 $\\mu \\in [-1,1]$）对余弦 $\\mu = \\cos\\theta$ 进行抽样，其中各向异性参数 $\\alpha \\in [-1,1]$。当 $\\alpha=0$ 时，分布是各向同性的。本任务不需要方位角 $\\phi$。\n\n你的任务是实现一个程序，对每个指定的测试用例执行以下步骤：\n1. 计算 $E_{\\text{avail}} = E_0 - \\Delta$。如果 $E_{\\text{avail}} \\le 0$，则返回一个表示反应不可行的结果，并设置 $E'_1 = 0$，$E'_2 = 0$，$\\theta_1 = 0$，$\\theta_2 = 0$。\n2. 如果 $E_{\\text{avail}}  0$，则对截断在 $[0, E_{\\text{avail}}]$ 上的蒸发谱 $f(E) \\propto E \\exp(-E/T)$ 抽样得到 $E'_1$，然后对截断在 $[0, E_{\\text{avail}} - E'_1]$ 上的相同形式的谱抽样得到 $E'_2$。对截断的累积分布使用逆变换采样，以确保精确执行边界 $E'_1+E'_2 \\le E_{\\text{avail}}$，并为边缘情况提供数值保护措施。\n3. 通过对其累积分布函数进行逆运算，从 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ 中独立抽样 $\\mu = \\cos\\theta$ 来得到 $\\theta_1$ 和 $\\theta_2$，然后设置 $\\theta = \\arccos(\\mu)$（单位为弧度）。\n4. 对于每个测试用例，返回一个列表，其中包含一个布尔可行性指示符，后跟抽样值 $E'_1$、$E'_2$、$\\theta_1$ 和 $\\theta_2$。\n\n所有能量单位必须是 MeV，所有角度单位必须是弧度。角度单位的规定是必不可少的：你必须确保输出中的所有角度都以弧度为单位。\n\n你必须使用以下测试套件，其中每个元组为 $(E_0,\\Delta,T,\\alpha,\\text{seed})$，$E_0$ 和 $\\Delta$ 的单位为 MeV，$T$ 的单位为 MeV，$\\alpha$ 是无量纲的，还有一个用于可复现性的伪随机种子：\n- 用例 A（具有中等各向异性的常规路径）：$(14.0, 8.0, 1.0, 0.3, 12345)$。\n- 用例 B（边界情况，可用能量为零）：$(8.0, 8.0, 1.5, 0.0, 222)$。\n- 用例 C（边缘情况，可用能量为负）：$(6.0, 8.0, 1.2, -0.5, 333)$。\n- 用例 D（接近极限的前向峰化各向异性）：$(20.0, 7.0, 2.0, 0.95, 444)$。\n- 用例 E（剩余预算小，后向峰化各向异性）：$(9.2, 8.9, 1.0, -0.8, 555)$。\n\n你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素对应一个测试用例，本身是一个 $[\\text{feasible}, E'_1, E'_2, \\theta_1, \\theta_2]$ 形式的列表。例如，总输出必须类似于 $[[\\dots],[\\dots],[\\dots],[\\dots],[\\dots]]$，且在单行上。每个数值条目必须是浮点数，可行性指示符必须是布尔值。",
            "solution": "问题陈述已经过仔细验证，并被确定为有效。它在科学上基于核物理和蒙特卡洛方法的原理，是良定的，提供了所有必要信息，并以客观、正式的语言表达。不存在科学缺陷、矛盾或歧义。\n\n任务是开发一个计算模型，用于抽样 $(n,2n)$ 反应中发射的两个中子的能量和散射角。解决方案需要为两种不同的概率分布推导并实现逆变换采样算法：一个用于中子能量的截断蒸发谱，以及一个用于散射角余弦的一阶各向异性分布。\n\n**从截断蒸发谱中进行能量抽样**\n\n出射中子的能量 $E'$ 由截断蒸发谱建模。其概率密度函数（PDF）由 $f(E') \\propto E' \\exp(-E'/T)$ 给出，适用于 $E' \\in [0, E_{\\max}]$，其中 $T$ 是谱温度，$E_{\\max}$ 是最大允许能量。\n\n为了执行逆变换采样，我们首先需要累积分布函数（CDF），即 $F(E')$。这需要对 PDF 进行归一化。使用分部积分法可以找到未归一化的不定积分：\n$$\n\\int E' \\exp(-E'/T) dE' = -T(E'+T)\\exp(-E'/T)\n$$\n归一化常数 $C$ 是在允许能量范围 $[0, E_{\\max}]$ 上的定积分：\n$$\nC = \\int_0^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left[-T(E'+T)\\exp(-E'/T)\\right]_0^{E_{\\max}} = T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)\n$$\n因此，对于 $E' \\in [0, E_{\\max}]$ 的 CDF $F(E')$ 为：\n$$\nF(E') = \\frac{\\int_0^{E'} u \\exp(-u/T) du}{C} = \\frac{T^2 - T(E'+T)\\exp(-E'/T)}{T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)}\n$$\n为了抽样能量 $E'$，我们设 $F(E') = \\xi$，其中 $\\xi$ 是从 $[0, 1]$ 上的均匀分布中抽取的随机数。这导出了以下方程：\n$$\n\\xi = \\frac{1 - (E'/T+1)\\exp(-E'/T)}{1 - (E_{\\max}/T+1)\\exp(-E_{\\max}/T)}\n$$\n令 $x = E'/T$ 和 $x_{\\max} = E_{\\max}/T$。重排方程以求解 $x$ 可得：\n$$\n(x+1)\\exp(-x) = 1 - \\xi \\left( 1 - (x_{\\max}+1)\\exp(-x_{\\max}) \\right)\n$$\n这是一个形式为 $z \\exp(-z) = Y$ 的超越方程，可以使用 Lambert W 函数求解。令 $z = x+1$，方程变为 $z \\exp(-(z-1)) = Y$，或 $z \\exp(-z) = Y/\\mathrm{e}$。\n两边乘以 $-1$，我们得到 $(-z)\\exp(-z) = -Y/\\mathrm{e}$。这是 Lambert W 函数的规范形式，$w \\exp(w) = k$，其中 $w = -z$ 且 $k = -Y/\\mathrm{e}$。\n$w$ 的解是 $w = W(k)$。当自变量在 $[-1/\\mathrm{e}, 0)$ 范围内时，Lambert W 函数有两个实数分支：主分支 $W_0(z) \\ge -1$ 和下分支 $W_{-1}(z) \\le -1$。由于 $x=E'/T$ 必须为非负数，所以 $z = x+1$ 必须大于或等于 $1$，这意味着 $w = -z$ 必须小于或等于 $-1$。因此，我们必须使用下分支 $W_{-1}$。\n因此，抽样得到的标度化能量 $x$ 为：\n$$\nx = -1 - W_{-1}\\left( -\\frac{1}{\\mathrm{e}} \\left[ 1 - \\xi \\left(1-(x_{\\max}+1)\\exp(-x_{\\max})\\right) \\right] \\right)\n$$\n最终抽样得到的能量为 $E' = x \\cdot T$。此过程首先用于在 $E_{\\max} = E_{\\text{avail}}$ 的条件下抽样 $E'_1$，然后用于在 $E_{\\max} = E_{\\text{avail}} - E'_1$ 的条件下抽样 $E'_2$。\n\n**从各向异性分布中进行角度抽样**\n\n极向散射角 $\\theta$ 通过其余弦 $\\mu = \\cos\\theta$ 进行抽样。$\\mu$ 的 PDF 由 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ 给出，适用于 $\\mu \\in [-1, 1]$，其中 $\\alpha$ 是各向异性参数，$|\\alpha| \\le 1$。\n\nCDF $P(\\mu)$ 是 PDF 从 $-1$ 到 $\\mu$ 的积分：\n$$\nP(\\mu) = \\int_{-1}^{\\mu} \\frac{1}{2}(1 + \\alpha \\mu') d\\mu' = \\frac{1}{2}\\left[\\mu' + \\frac{\\alpha}{2}(\\mu')^2\\right]_{-1}^{\\mu} = \\frac{1}{2}\\left( (\\mu + \\frac{\\alpha}{2}\\mu^2) - (-1 + \\frac{\\alpha}{2}) \\right)\n$$\n设 $P(\\mu) = \\xi$，其中 $\\xi \\sim U(0,1)$，得到一个关于 $\\mu$ 的二次方程：\n$$\n\\alpha \\mu^2 + 2\\mu + (2 - \\alpha - 4\\xi) = 0\n$$\n使用二次公式求解 $\\mu$ 可得：\n$$\n\\mu = \\frac{-2 \\pm \\sqrt{4 - 4\\alpha(2-\\alpha-4\\xi)}}{2\\alpha} = \\frac{-1 \\pm \\sqrt{1 - \\alpha(2-\\alpha-4\\xi)}}{\\alpha} = \\frac{-1 \\pm \\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi}}{\\alpha}\n$$\n为确保解对所有 $\\xi \\in [0, 1]$ 均有效，并在 $\\alpha \\to 0$ 时保持连续，必须选择正根。得到的公式是：\n$$\n\\mu = \\frac{\\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi} - 1}{\\alpha}\n$$\n对于各向同性散射的特殊情况（$\\alpha=0$），PDF 为 $p(\\mu) = 1/2$，CDF 为 $P(\\mu) = (\\mu+1)/2$。对其求逆可得 $\\mu = 2\\xi - 1$。通用公式在 $|\\alpha|$ 很小时数值不稳定，在该极限情况下应替换为各向同性公式。在实现中，使用一个阈值（如 $|\\alpha|  10^{-8}$）是合适的。\n抽样得到 $\\mu$ 后，通过 $\\theta = \\arccos(\\mu)$ 计算出极向角，其单位将按要求为弧度。\n\n**算法流程**\n\n对于由 $(E_0, \\Delta, T, \\alpha, \\text{seed})$ 指定的每个测试用例：\n1.  使用给定的 `seed` 初始化一个专用的伪随机数生成器，以确保测试用例之间的可复现性和独立性。\n2.  计算总可用动能：$E_{\\text{avail}} = E_0 - \\Delta$。\n3.  执行可行性检查。如果 $E_{\\text{avail}} \\le 0$，则反应不可能发生。结果记录为 `[False, 0.0, 0.0, 0.0, 0.0]`。\n4.  如果 $E_{\\text{avail}}  0$，则反应可行。抽样过程如下：\n    a. 使用 Lambert W 函数方法，在 $E_{\\max} = E_{\\text{avail}}$ 和随机变量 $\\xi_1$ 的条件下，从截断蒸发谱中抽样得到第一个中子的能量 $E'_1$。\n    b. 计算剩余能量预算：$E_{\\text{rem}} = E_{\\text{avail}} - E'_1$。\n    c. 使用新的随机变量 $\\xi_2$，从截断在 $[0, E_{\\text{rem}}]$ 上的相同谱形式中抽样得到第二个中子的能量 $E'_2$。\n    d. 使用二次逆变换方法，在参数 $\\alpha$ 和随机变量 $\\xi_3$ 的条件下，抽样得到第一个散射角的余弦 $\\mu_1$。然后角度为 $\\theta_1 = \\arccos(\\mu_1)$。\n    e. 使用相同方法和随机变量 $\\xi_4$，独立抽样得到第二个散射角的余弦 $\\mu_2$。然后角度为 $\\theta_2 = \\arccos(\\mu_2)$。\n    f. 结果记录为 `[True, E'_1, E'_2, \\theta_1, \\theta_2]`。\n5.  处理完所有测试用例后，将收集到的结果格式化为表示列表的列表的单个字符串，并打印到标准输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lambertw\n\ndef solve():\n    \"\"\"\n    Solves the neutron sampling problem for a given set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E0, Delta, T, alpha, seed)\n        (14.0, 8.0, 1.0, 0.3, 12345),  # Case A\n        (8.0, 8.0, 1.5, 0.0, 222),      # Case B\n        (6.0, 8.0, 1.2, -0.5, 333),     # Case C\n        (20.0, 7.0, 2.0, 0.95, 444),    # Case D\n        (9.2, 8.9, 1.0, -0.8, 555),     # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        E0, Delta, T, alpha, seed = case\n        \n        # Use a dedicated generator for each case for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Step 1: Compute available energy and check feasibility\n        E_avail = E0 - Delta\n\n        if E_avail = 0:\n            feasible = False\n            E1_prime = 0.0\n            E2_prime = 0.0\n            theta1 = 0.0\n            theta2 = 0.0\n        else:\n            feasible = True\n            \n            # Step 2: Sample energies sequentially\n            E1_prime = sample_energy(E_avail, T, rng)\n            E_rem = E_avail - E1_prime\n            E2_prime = sample_energy(E_rem, T, rng)\n\n            # Step 3: Sample angles independently\n            mu1 = sample_mu(alpha, rng)\n            theta1 = np.arccos(mu1) # Output is in radians\n\n            mu2 = sample_mu(alpha, rng)\n            theta2 = np.arccos(mu2) # Output is in radians\n\n        # Step 4: Store the results for the current case\n        results.append([feasible, E1_prime, E2_prime, theta1, theta2])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is required.\n    print(str(results).replace(\" \", \"\"))\n\ndef sample_energy(E_max, T, rng):\n    \"\"\"\n    Samples an energy E from a truncated evaporation spectrum f(E) ~ E*exp(-E/T)\n    on the interval [0, E_max] using the Lambert W function for inversion.\n    \n    Args:\n        E_max (float): Maximum energy for the truncated spectrum (MeV).\n        T (float): Temperature parameter of the spectrum (MeV).\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled energy E' (MeV).\n    \"\"\"\n    if E_max = 1e-12:\n        return 0.0\n\n    xi = rng.random()\n    x_max = E_max / T\n\n    # The normalized integral up to x_max\n    # I_norm = integral from 0 to x_max of x*exp(-x) dx\n    I_norm = 1.0 - (x_max + 1.0) * np.exp(-x_max)\n\n    # This should not happen for T>0, E_max>0, but as a safeguard.\n    if I_norm = 1e-12:\n        return 0.0\n\n    C_prime = xi * I_norm\n    Y = 1.0 - C_prime\n    \n    # Argument for the Lambert W function\n    k = -Y / np.e\n    \n    # Use the lower branch (k=-1) of the Lambert W function.\n    # It returns a complex number, so we take the real part.\n    w = lambertw(k, k=-1).real\n    \n    # The scaled energy x = E/T\n    x = -1.0 - w\n    \n    return x * T\n\ndef sample_mu(alpha, rng):\n    \"\"\"\n    Samples the cosine of the scattering angle, mu, from p(mu) = 0.5*(1 + alpha*mu).\n    \n    Args:\n        alpha (float): Anisotropy parameter.\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled cosine of the angle, mu.\n    \"\"\"\n    xi = rng.random()\n    \n    # Handle isotropic case and numerical stability for small alpha\n    if abs(alpha)  1e-8:\n        mu = 2.0 * xi - 1.0\n    else:\n        term_in_sqrt = (1.0 - alpha)**2 + 4.0 * alpha * xi\n        mu = (np.sqrt(term_in_sqrt) - 1.0) / alpha\n        \n    # Clip to handle potential floating point inaccuracies before arccos\n    return np.clip(mu, -1.0, 1.0)\n\nsolve()\n```"
        }
    ]
}