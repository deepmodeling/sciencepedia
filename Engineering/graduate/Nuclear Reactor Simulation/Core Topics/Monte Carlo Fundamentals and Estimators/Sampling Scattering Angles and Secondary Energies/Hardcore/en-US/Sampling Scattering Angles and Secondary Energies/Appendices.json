{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of modeling secondary particle energies is the ability to sample from physically derived probability distributions. This first exercise takes you back to first principles, using statistical mechanics to derive the evaporation spectrum for a neutron emitted from an excited nucleus. By working through the derivation and developing a sampling algorithm, you will gain a foundational understanding of how theoretical models are translated into practical computational tools for Monte Carlo simulations .",
            "id": "4247135",
            "problem": "Consider neutron emission from a highly excited compound nucleus in a nuclear reactor simulation, modeled by the Weisskopfâ€“Ewing evaporation picture. Assume the emitter can be treated as a canonical reservoir at temperature $T$, and that the emitted neutron is nonrelativistic with kinetic energy $E'$. The emission probability per unit energy is proportional to the product of a phase-space factor and the Boltzmann factor. For barrierless $s$-wave emission with a slowly varying transmission coefficient (so that its energy dependence can be neglected over the scale set by $T$), the phase-space factor is proportional to the product of a continuum density of states and the particle speed. Using first principles of statistical mechanics and nonrelativistic kinematics:\n\n- Derive the normalized secondary-energy spectrum $p(E' \\mid T)$ for the emitted neutron.\n- Show that the resulting distribution lies in the Gamma family and determine its shape and scale parameters.\n- Starting from the exact cumulative distribution function, derive an explicit inverse-cumulative transformation $E'(u)$ in closed form using only standard special functions, where $u \\in (0,1)$ is a uniform random variate. Carefully justify any branch selections required for the special function to ensure $E'(u) \\ge 0$ for all $u \\in (0,1)$.\n- Propose an efficient sampling method that handles the linear-in-energy factor in the spectrum without numerical root finding, and express the sampled energy in terms of independent uniform random variates.\n\nProvide a final explicit analytic expression for the inverse-cumulative mapping $E'(u)$ as a single closed-form formula in terms of $u$ and $T$. Express the final energy in megaelectronvolts (MeV). No numerical substitutions are required. The final answer must be a single closed-form analytic expression and contain no inequalities. Angles are not involved in this problem.",
            "solution": "This problem is scientifically grounded, well-posed, and contains sufficient information for a unique solution. It is a standard problem in statistical nuclear physics, directly relevant to the simulation of secondary particle energies in nuclear applications. I will proceed with a full derivation.\n\nThe problem asks for the derivation of the secondary neutron energy spectrum, its identification as a member of the Gamma family, the derivation of the inverse-cumulative distribution function for sampling, and the proposal of an alternative efficient sampling algorithm. The final answer is specified to be the closed-form expression for the inverse-cumulative transformation.\n\nFirst, we derive the normalized secondary-energy spectrum, $p(E' \\mid T)$. The problem states that the emission probability per unit energy for a neutron of kinetic energy $E'$ is proportional to the product of a phase-space factor and a Boltzmann factor.\nLet the unnormalized probability density function be denoted by $f(E')$. Based on the problem statement, we have:\n$$f(E') \\propto (\\text{Phase-Space Factor}) \\times (\\text{Boltzmann Factor})$$\nThe Boltzmann factor for a state of energy $E'$ in a system at temperature $T$ is given by $\\exp(-E'/T)$.\nThe phase-space factor is stated to be proportional to the product of the continuum density of states and the particle speed. For a nonrelativistic particle, the kinetic energy is $E' = \\frac{p^2}{2m}$, where $p$ is the momentum and $m$ is the mass. The particle speed is $v = \\sqrt{2E'/m}$, which is proportional to $(E')^{1/2}$. The number of continuum states in a momentum interval $dp$ is proportional to $p^2 dp$. We can express this in terms of energy: $p = \\sqrt{2mE'}$, so $dp = \\sqrt{2m} \\frac{1}{2}(E')^{-1/2} dE'$. The density of states per unit energy, $\\frac{dN}{dE'}$, is therefore proportional to $p^2 \\frac{dp}{dE'} \\propto (E') \\cdot (E')^{-1/2} = (E')^{1/2}$.\nThe phase-space factor is thus proportional to $(\\text{density of states}) \\times (\\text{speed}) \\propto (E')^{1/2} \\times (E')^{1/2} = E'$.\nCombining these factors, the unnormalized probability density for the emitted neutron energy $E'$ is:\n$$f(E') = C \\cdot E' \\exp(-E'/T)$$\nwhere $C$ is a normalization constant and $E' \\ge 0$. To find $C$, we require the distribution to be normalized to unity:\n$$\\int_{0}^{\\infty} f(E') dE' = 1$$\n$$C \\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = 1$$\nThis integral is a standard form of the Gamma function, $\\int_{0}^{\\infty} x^n \\exp(-ax) dx = \\frac{\\Gamma(n+1)}{a^{n+1}} = \\frac{n!}{a^{n+1}}$. With $n=1$ and $a=1/T$, the integral evaluates to:\n$$\\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = \\frac{1!}{(1/T)^{1+1}} = T^2$$\nSubstituting this back into the normalization condition gives $C \\cdot T^2 = 1$, so $C = 1/T^2$.\nThe normalized secondary-energy spectrum $p(E' \\mid T)$ is therefore:\n$$p(E' \\mid T) = \\frac{1}{T^2} E' \\exp(-E'/T), \\quad \\text{for } E' \\ge 0$$\nThis form is known as the Maxwell-Fission or Watt spectrum.\n\nNext, we show that this distribution belongs to the Gamma family. The probability density function of a Gamma distribution is defined by a shape parameter $k$ and a scale parameter $\\theta$ as:\n$$f(x; k, \\theta) = \\frac{1}{\\Gamma(k)\\theta^k} x^{k-1} \\exp(-x/\\theta)$$\nComparing this with our derived spectrum $p(E' \\mid T)$, we can identify the parameters by matching the functional forms. Let $x=E'$ and $\\theta=T$. Our spectrum can be written as:\n$$p(E' \\mid T) = \\frac{1}{1 \\cdot T^2} (E')^{2-1} \\exp(-E'/T)$$\nBy comparing the exponents of the energy term, we find $k-1 = 1$, which gives the shape parameter $k=2$. The scale parameter is clearly $\\theta=T$. This identification is consistent with the normalization constant, as $\\Gamma(k) = \\Gamma(2) = (2-1)! = 1! = 1$. The normalization factor $\\frac{1}{\\Gamma(k)\\theta^k}$ becomes $\\frac{1}{\\Gamma(2)T^2} = \\frac{1}{1 \\cdot T^2} = \\frac{1}{T^2}$, which perfectly matches our derived constant. Thus, the derived neutron energy spectrum is a Gamma distribution with shape parameter $k=2$ and scale parameter $\\theta=T$.\n\nNow, we derive the inverse-cumulative transformation $E'(u)$. First, we compute the cumulative distribution function (CDF), $F(E')$, by integrating the PDF from $0$ to $E'$:\n$$F(E') = \\int_{0}^{E'} p(\\epsilon \\mid T) d\\epsilon = \\frac{1}{T^2} \\int_{0}^{E'} \\epsilon \\exp(-\\epsilon/T) d\\epsilon$$\nWe evaluate the integral using integration by parts, with $u' = \\epsilon$ and $dv = \\exp(-\\epsilon/T)d\\epsilon$. This gives $du' = d\\epsilon$ and $v = -T \\exp(-\\epsilon/T)$.\n$$\\int \\epsilon \\exp(-\\epsilon/T) d\\epsilon = -\\epsilon T \\exp(-\\epsilon/T) - \\int (-T \\exp(-\\epsilon/T)) d\\epsilon$$\n$$ = -\\epsilon T \\exp(-\\epsilon/T) - T^2 \\exp(-\\epsilon/T) = -T(\\epsilon+T)\\exp(-\\epsilon/T)$$\nEvaluating the definite integral for the CDF:\n$$F(E') = \\frac{1}{T^2} \\left[ -T(\\epsilon+T)\\exp(-\\epsilon/T) \\right]_{0}^{E'}$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) - (-T(0+T)\\exp(0)) \\right)$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) + T^2 \\right) = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\nTo find the inverse transformation, we set $F(E') = u$, where $u \\in (0,1)$ is a uniform random variate, and solve for $E'$.\n$$u = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n$$1 - u = \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\nThis transcendental equation can be solved using the Lambert W function, which is defined by the relation $z = W(z)\\exp(W(z))$. To cast our equation into this form, let $X = -(1 + E'/T)$. Then $1+E'/T = -X$, and $E'/T = -X-1$, so $-E'/T = X+1$. Substituting these into the equation:\n$$1-u = (-X)\\exp(-(X+1)) = (-X)\\exp(-X)\\exp(-1)$$\n$$-(1-u)\\exp(1) = X \\exp(X)$$\nThis equation is of the form $z = w\\exp(w)$ with $z = -(1-u)\\exp(1)$ and $w=X$. Therefore, the solution for $X$ is given by the Lambert W function:\n$$X = W\\left(-(1-u)\\exp(1)\\right)$$\nSubstituting back $X = -(1 + E'/T)$:\n$$-(1 + E'/T) = W\\left(-(1-u)\\exp(1)\\right)$$\n$$1 + E'/T = -W\\left(-(1-u)\\exp(1)\\right)$$\n$$E'/T = -1 - W\\left(-(1-u)\\exp(1)\\right)$$\n$$E'(u) = -T \\left[ 1 + W\\left(-(1-u)\\exp(1)\\right) \\right]$$\nWe must now select the appropriate branch of the Lambert W function. For a real argument $z \\in [-1/\\exp(1), 0)$, the function has two real branches: the principal branch $W_0(z)$ with range $[-1, \\infty)$ and the lower branch $W_{-1}(z)$ with range $(-\\infty, -1]$.\nIn our case, the argument is $z = -(1-u)\\exp(1)$. Since $u \\in (0,1)$, we have $1-u \\in (0,1)$, and therefore $z \\in (-\\exp(1), 0)$. However, the argument to the Lambert W function was $-(1-u)\\exp(1)$, but a mistake was made in the algebraic manipulation. Let's correct it.\nStarting from $1-u = (1+E'/T)\\exp(-E'/T)$.\nLet $Y = -(1+E'/T)$. Then $-E'/T = Y+1$. The equation becomes $1-u = -Y \\exp(Y+1) = -Y \\exp(Y) \\exp(1)$.\nThis gives $-(1-u)\\exp(-1) = Y \\exp(Y)$.\nThis is the correct form $z = w \\exp(w)$, where $z = -(1-u)\\exp(-1)$ and $w=Y$. The solution is $Y = W(z)$.\n$$Y = W(-(1-u)\\exp(-1))$$\nNow substitute back $Y = -(1+E'/T)$:\n$$-(1+E'/T) = W(-(1-u)\\exp(-1))$$\n$$E'(u) = -T \\left[ 1 + W(-(1-u)\\exp(-1)) \\right]$$\nThe argument of the W function is $z = -(1-u)\\exp(-1)$. Since $u \\in (0,1)$, $1-u \\in (0,1)$, so $z \\in (-\\exp(-1), 0)$. This interval is in the domain of both real branches $W_0$ and $W_{-1}$.\nWe require a physical solution, meaning $E'(u) \\ge 0$. Since $T>0$, this implies that $1 + W(z) \\le 0$, or $W(z) \\le -1$.\nThe principal branch $W_0(z)$ maps the interval $[-\\exp(-1), \\infty)$ to $[-1, \\infty)$. For $z \\in (-\\exp(-1), 0)$, we have $W_0(z) \\in (-1, 0)$. This choice would lead to $1+W_0(z) > 0$ and thus $E'0$, which is unphysical.\nThe lower branch $W_{-1}(z)$ maps the interval $[-\\exp(-1), 0)$ to $(-\\infty, -1]$. This choice guarantees that $W_{-1}(z) \\le -1$, which implies $1+W_{-1}(z) \\le 0$ and thus $E' \\ge 0$.\nTherefore, the correct branch is $W_{-1}$. The final expression for the inverse-cumulative transformation is:\n$$E'(u) = -T \\left[ 1 + W_{-1}\\left(-(1-u)\\exp(-1)\\right) \\right]$$\nThe problem also asks for an efficient sampling method. The identification of the energy distribution as a Gamma($k=2, \\theta=T$) distribution provides a very efficient one. A random variate from a Gamma($k, \\theta$) distribution, where $k$ is an integer, can be generated by summing $k$ independent random variates from an exponential distribution with scale parameter $\\theta$.\nIn our case, $k=2$. The PDF of an exponential distribution with scale $\\theta=T$ is $p_{exp}(y) = (1/T)\\exp(-y/T)$. Its CDF is $F_{exp}(y) = 1-\\exp(-y/T)$. Using inverse transform sampling on the exponential distribution, we set $F_{exp}(y)=u'$, for a uniform variate $u' \\in (0,1)$, which gives $y = -T \\ln(1-u')$. Since $1-u'$ is also uniformly distributed on $(0,1)$, we can write $y = -T \\ln(u')$.\nThus, to sample an energy $E'$ from our distribution, we generate two independent uniform random variates $u_1, u_2 \\in (0,1)$, generate two independent exponential variates $Y_1 = -T \\ln(u_1)$ and $Y_2 = -T \\ln(u_2)$, and sum them:\n$$E' = Y_1 + Y_2 = -T \\ln(u_1) - T \\ln(u_2) = -T \\ln(u_1 u_2)$$\nThis method avoids the numerical evaluation of special functions and is computationally very efficient, using only standard library functions for logarithms.\n\nThe demanded final answer is the explicit analytic expression for the inverse-cumulative mapping $E'(u)$. The temperature $T$ is understood to be in units of MeV.",
            "answer": "$$\n\\boxed{-T \\left( 1 + W_{-1}\\left( -(1-u)\\exp(-1) \\right) \\right)}\n$$"
        },
        {
            "introduction": "While analytical models are invaluable, real-world reactor simulation codes heavily rely on tabulated data for cross sections and secondary distributions. This practice addresses the critical question of how to represent continuous energy spectra using discrete data points without introducing significant error. By implementing and comparing different interpolation schemes, you will investigate how these numerical choices can create biases in key physical quantities, such as the mean secondary energy, providing essential insight into the practical challenges of high-fidelity simulation .",
            "id": "4247145",
            "problem": "You are tasked with analyzing how interpolation schemes used in tabulated secondary energy probability density functions affect the estimated mean secondary energy in a Monte Carlo nuclear reactor simulation. Consider a strictly positive energy domain and a physically realistic spectrum with an exponential tail, consistent with thermalized or inelastic processes encountered in reactor physics. You will compare three interpolation schemes applied to a tabulated probability density function and compute the bias introduced in the mean secondary energy by each scheme.\n\nBase the derivation and computation on the following fundamental definitions:\n- A Probability Density Function (PDF) $p(E')$ over an energy domain $E' \\in [E_{\\min}, E_{\\max}]$ satisfies the normalization condition $$\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1.$$\n- The mean of the distribution is $$\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'.$$\n- For a true truncated exponential spectrum, assume $$p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}, \\quad E' \\in [E_{\\min}, E_{\\max}],$$ where $T$ is a scale parameter analogous to an effective temperature measured in electron-volts.\n\nA tabulation of the PDF is given at grid points $\\{E_i\\}_{i=0}^{N-1}$ with $E_0 = E_{\\min}$ and $E_{N-1} = E_{\\max}$ and strictly increasing energies $E_{i+1}  E_i$. The tabulated values are $p_i = p_{\\text{true}}(E_i)$. Define three interpolation schemes on each interval $[E_i, E_{i+1}]$:\n1. Linear in $E'$ on $p$ (linear-linear): interpolate $p(E')$ linearly as a function of $E'$ between $(E_i, p_i)$ and $(E_{i+1}, p_{i+1})$.\n2. Linear in $\\log E'$ on $p$ (linear-log): interpolate $p(E')$ linearly as a function of $\\log E'$ between $(\\log E_i, p_i)$ and $(\\log E_{i+1}, p_{i+1})$. This requires $E_{\\min}  0$.\n3. Linear in $\\log E'$ on $\\log p$ (log-log): interpolate $\\log p(E')$ linearly as a function of $\\log E'$ between $(\\log E_i, \\log p_i)$ and $(\\log E_{i+1}, \\log p_{i+1})$. This requires $E_{\\min}  0$ and $p_i  0$.\n\nFor each interpolation scheme, construct a piecewise interpolant $\\tilde{p}(E')$ on $[E_{\\min}, E_{\\max}]$, renormalize it to satisfy $$\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') \\, dE' = 1$$ to obtain a valid PDF $\\hat{p}(E')$, and then compute the approximate mean $$\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'.$$\nDefine the bias for each scheme as $$\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}},$$ where $\\langle E' \\rangle_{\\text{true}}$ is the mean of $p_{\\text{true}}(E')$ on $[E_{\\min}, E_{\\max}]$.\n\nYour program must implement these steps for the following test suite, covering typical, coarse, log-spaced, and long-tail cases. All energies and the scale $T$ must be in electron-volts (eV), and all reported biases must be in electron-volts (eV). No angles are involved in this problem.\n\nTest Suite (each case is a tuple $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type})$):\n- Case 1 (general case, linear grid): $(1.0, 10^{-6}, 10.0, 32, \\text{linear})$.\n- Case 2 (coarse grid, linear): $(1.0, 10^{-6}, 10.0, 4, \\text{linear})$.\n- Case 3 (log grid, broader tail): $(0.5, 10^{-6}, 20.0, 32, \\text{log})$.\n- Case 4 (log grid, long tail): $(2.0, 10^{-3}, 40.0, 16, \\text{log})$.\n\nGrid construction rules:\n- For $\\text{grid\\_type} = \\text{linear}$: $$E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1},\\quad i=0,\\dots,N-1.$$\n- For $\\text{grid\\_type} = \\text{log}$: $$E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}},\\quad i=0,\\dots,N-1.$$\n\nRequirements:\n- Implement the three interpolation schemes on each interval, form $\\tilde{p}(E')$ piecewise, renormalize to obtain $\\hat{p}(E')$, and compute $\\widehat{\\langle E' \\rangle}$ for each scheme.\n- Compute the true mean $\\langle E' \\rangle_{\\text{true}}$ under $p_{\\text{true}}(E')$ on $[E_{\\min}, E_{\\max}]$.\n- For each test case, output the biases for the three schemes in electron-volts (eV) as floating-point numbers, rounded to eight decimal places.\n- Final Output Format: Your program should produce a single line of output containing the results as a comma-separated list of lists, with each inner list giving the three biases in the order [linear-linear, linear-log, log-log], for the four test cases. For example: \"[[b11,b12,b13],[b21,b22,b23],[b31,b32,b33],[b41,b42,b43]]\".\n\nExpress all energies and biases in electron-volts (eV) and round to eight decimal places in the final output. Angles are not part of this task; no angle units are required.",
            "solution": "The user has provided a problem that is scientifically sound, well-posed, and requires a rigorous numerical solution. I will first validate the problem statement according to the specified criteria, then proceed to the solution.\n\n### Step 1: Problem Validation\n\nI will begin by extracting the givens and then validating the problem.\n\n#### Extraction of Givens\n- **Probability Density Function (PDF) definition**: A function $p(E')$ on $E' \\in [E_{\\min}, E_{\\max}]$ is a PDF if it is non-negative and satisfies $\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1$.\n- **Mean of the distribution**: $\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'$.\n- **True PDF**: The analytical form of the PDF is a truncated exponential, given by $p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}$ for $E' \\in [E_{\\min}, E_{\\max}]$. $T$ is a scale parameter in electron-volts (eV).\n- **Tabulation**: The PDF is sampled at $N$ grid points $\\{E_i\\}_{i=0}^{N-1}$, where $E_0 = E_{\\min}$ and $E_{N-1} = E_{\\max}$. The tabulated values are $p_i = p_{\\text{true}}(E_i)$.\n- **Interpolation Schemes**:\n    1.  **Linear-linear**: $p(E')$ is interpolated linearly in $E'$ on each interval $[E_i, E_{i+1}]$.\n    2.  **Linear-log**: $p(E')$ is interpolated linearly in $\\log E'$ on each interval $[E_i, E_{i+1}]$ (requires $E_{\\min}  0$).\n    3.  **Log-log**: $\\log p(E')$ is interpolated linearly in $\\log E'$ on each interval $[E_i, E_{i+1}]$ (requires $E_{\\min}  0$ and $p_i  0$).\n- **Computational Task**:\n    1.  For each scheme, construct a piecewise interpolant $\\tilde{p}(E')$.\n    2.  Renormalize it to get a valid PDF $\\hat{p}(E')$.\n    3.  Compute the approximate mean $\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'$.\n    4.  Calculate the bias: $\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}}$.\n- **Grid Generation**:\n    - **Linear grid**: $E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1}$ for $i=0,\\dots,N-1$.\n    - **Logarithmic grid**: $E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}}$ for $i=0,\\dots,N-1$.\n- **Test Suite**: Four cases are provided as tuples $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type})$:\n    - Case 1: $(1.0, 10^{-6}, 10.0, 32, \\text{linear})$\n    - Case 2: $(1.0, 10^{-6}, 10.0, 4, \\text{linear})$\n    - Case 3: $(0.5, 10^{-6}, 20.0, 32, \\text{log})$\n    - Case 4: $(2.0, 10^{-3}, 40.0, 16, \\text{log})$\n- **Output Format**: A single line string representing a list of lists of biases, e.g., `[[b11,b12,b13],[b21,b22,b23],...]`, with all numbers rounded to eight decimal places.\n\n#### Validation Verdict\n- **Scientific Grounding**: The problem is firmly rooted in computational physics and numerical analysis. The use of a truncated exponential spectrum is a plausible model in reactor physics, and the analysis of interpolation errors is a standard, important practice. The problem is scientifically sound.\n- **Well-Posedness**: The problem is well-posed. All functions, parameters, and procedures are defined unambiguously. The definitions lead to a unique, computable solution for each test case.\n- **Objectivity**: The language is precise and mathematical, free of any subjectivity or opinion.\n- **Completeness and Consistency**: The problem statement is self-contained. It provides all necessary data and formulas. The requirements for the logarithmic schemes ($E_{\\min}  0$, $p_i  0$) are met by the physics of the problem and the specific test cases. There are no contradictions.\n\nThe problem is deemed **valid**. I will now proceed with the solution.\n\n### Step 2: Derivation of Analytical and Numerical Formulas\n\nThe core of the problem is to compute definite integrals of the form $\\int f(E') dE'$ and $\\int E' f(E') dE'$ where $f(E')$ is either the true PDF or one of the interpolated PDFs.\n\n#### True Mean $\\langle E' \\rangle_{\\text{true}}$\nThe true PDF is $p_{\\text{true}}(E') = \\frac{1}{C} \\exp(-E'/T)$, where $C = T(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T))$ is the normalization constant. The true mean is:\n$$ \\langle E' \\rangle_{\\text{true}} = \\int_{E_{\\min}}^{E_{\\max}} E' p_{\\text{true}}(E') dE' = \\frac{1}{C} \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' $$\nUsing integration by parts, $\\int u e^{au} du = (\\frac{u}{a} - \\frac{1}{a^2})e^{au}$, with $u=E'$ and $a=-1/T$:\n$$ \\int E' \\exp(-E'/T) dE' = [-T E' \\exp(-E'/T) - T^2 \\exp(-E'/T)] $$\nEvaluating the definite integral from $E_{\\min}$ to $E_{\\max}$ gives:\n$$ \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left(T E_{\\min} + T^2\\right)\\exp(-E_{\\min}/T) - \\left(T E_{\\max} + T^2\\right)\\exp(-E_{\\max}/T) $$\nDividing by $C$ and simplifying, we obtain a stable formula for the true mean:\n$$ \\langle E' \\rangle_{\\text{true}} = T + \\frac{E_{\\min}\\exp(-E_{\\min}/T) - E_{\\max}\\exp(-E_{\\max}/T)}{\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)} $$\n\n#### Approximate Mean $\\widehat{\\langle E' \\rangle}$\nFor each interpolation scheme, the approximate mean is calculated as the ratio of two summed integrals over the $N-1$ intervals:\n$$ \\widehat{\\langle E' \\rangle} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E' \\tilde{p}(E') dE'}{\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') dE'} = \\frac{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE'}{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE'} = \\frac{I_1}{I_0} $$\nwhere $\\tilde{p}_i(E')$ is the interpolant on $[E_i, E_{i+1}]$. We must derive the analytical forms for these integrals for each scheme.\n\n**1. Linear-Linear Interpolation**\nOn $[E_i, E_{i+1}]$, the interpolant is a line: $\\tilde{p}_i(E') = A_i E' + B_i$, where $A_i = \\frac{p_{i+1} - p_i}{E_{i+1} - E_i}$ and $B_i = p_i - A_i E_i$.\nThe zeroth moment (area) is that of a trapezoid:\n$$ \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE' = \\frac{1}{2}(p_i + p_{i+1})(E_{i+1} - E_i) $$\nThe first moment is:\n$$ \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE' = \\int_{E_i}^{E_{i+1}} (A_i (E')^2 + B_i E') dE' = \\left[ \\frac{A_i}{3}(E')^3 + \\frac{B_i}{2}(E')^2 \\right]_{E_i}^{E_{i+1}} $$\n\n**2. Linear-Log Interpolation**\nThe interpolant is $\\tilde{p}_i(E') = A_i \\log E' + B_i$, where $A_i = \\frac{p_{i+1} - p_i}{\\log E_{i+1} - \\log E_i}$ and $B_i = p_i - A_i \\log E_i$.\nThe required antiderivatives are:\n- $\\int (A_i \\log E' + B_i) dE' = A_i(E' \\log E' - E') + B_i E'$\n- $\\int E'(A_i \\log E' + B_i) dE' = A_i\\left(\\frac{(E')^2}{2}\\log E' - \\frac{(E')^2}{4}\\right) + B_i\\frac{(E')^2}{2}$\nThe definite integrals are found by evaluating these antiderivatives at $E_{i+1}$ and $E_i$.\n\n**3. Log-Log Interpolation**\nThe interpolant is a power law, $\\tilde{p}_i(E') = C_i (E')^{m_i}$, where the exponent is $m_i = \\frac{\\log p_{i+1} - \\log p_i}{\\log E_{i+1} - \\log E_i}$ and the coefficient is $C_i = p_i / E_i^{m_i}$.\nThe integrals depend on the value of $m_i$.\nZeroth moment:\n$$ \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i} dE' = \\begin{cases} \\frac{C_i}{m_i+1} \\left( E_{i+1}^{m_i+1} - E_i^{m_i+1} \\right)  \\text{if } m_i \\neq -1 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{if } m_i = -1 \\end{cases} $$\nFirst moment:\n$$ \\int_{E_i}^{E_{i+1}} E' \\cdot C_i (E')^{m_i} dE' = \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i+1} dE' = \\begin{cases} \\frac{C_i}{m_i+2} \\left( E_{i+1}^{m_i+2} - E_i^{m_i+2} \\right)  \\text{if } m_i \\neq -2 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{if } m_i = -2 \\end{cases} $$\nThese formulas are implemented by summing the results for each interval to find the total integrals $I_0$ and $I_1$, from which the approximate mean and bias are computed.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates and prints the bias in mean secondary energy for three different\n    interpolation schemes applied to a tabulated truncated exponential PDF.\n    \"\"\"\n    # Test Suite (T, E_min, E_max, N, grid_type)\n    test_cases = [\n        (1.0, 1.0e-6, 10.0, 32, 'linear'),\n        (1.0, 1.0e-6, 10.0, 4, 'linear'),\n        (0.5, 1.0e-6, 20.0, 32, 'log'),\n        (2.0, 1.0e-3, 40.0, 16, 'log'),\n    ]\n\n    all_case_biases = []\n\n    for T, E_min, E_max, N, grid_type in test_cases:\n        # Step 1: Generate energy grid\n        if grid_type == 'linear':\n            E_grid = np.linspace(E_min, E_max, N)\n        else:  # 'log'\n            E_grid = np.geomspace(E_min, E_max, N)\n\n        # Step 2: Define true PDF and calculate true mean\n        # p_true(E') = exp(-E'/T) / C\n        norm_const_C = T * (np.exp(-E_min / T) - np.exp(-E_max / T))\n        p_grid = np.exp(-E_grid / T) / norm_const_C\n        \n        # Analytical true mean E'_true\n        num = E_min * np.exp(-E_min / T) - E_max * np.exp(-E_max / T)\n        den = np.exp(-E_min / T) - np.exp(-E_max / T)\n        true_mean = T + num / den\n\n        # Step 3: Loop through interpolation schemes and calculate bias\n        case_biases = []\n        schemes = ['lin-lin', 'lin-log', 'log-log']\n        \n        for scheme in schemes:\n            total_I0 = 0.0  # Integral of p_tilde(E')\n            total_I1 = 0.0  # Integral of E' * p_tilde(E')\n\n            for i in range(N - 1):\n                E_i, E_i1 = E_grid[i], E_grid[i+1]\n                p_i, p_i1 = p_grid[i], p_grid[i+1]\n                \n                I0_i = 0.0  # Zeroth moment on interval i\n                I1_i = 0.0  # First moment on interval i\n\n                if scheme == 'lin-lin':\n                    # p(E') = A*E' + B\n                    dE = E_i1 - E_i\n                    if dE == 0: continue\n                    A = (p_i1 - p_i) / dE\n                    B = p_i - A * E_i\n                    \n                    I0_i = (p_i + p_i1) * dE / 2.0\n                    I1_i = (A/3.0)*(E_i1**3 - E_i**3) + (B/2.0)*(E_i1**2 - E_i**2)\n\n                elif scheme == 'lin-log':\n                    # p(E') = A*log(E') + B\n                    log_Ei, log_Ei1 = np.log(E_i), np.log(E_i1)\n                    d_logE = log_Ei1 - log_Ei\n                    if d_logE == 0: continue\n                    A = (p_i1 - p_i) / d_logE\n                    B = p_i - A * log_Ei\n\n                    # Antiderivative for I0: A*(E*logE - E) + B*E\n                    ad0_i = A * (E_i * log_Ei - E_i) + B * E_i\n                    ad0_i1 = A * (E_i1 * log_Ei1 - E_i1) + B * E_i1\n                    I0_i = ad0_i1 - ad0_i\n                    \n                    # Antiderivative for I1: A*(E^2/2*logE - E^2/4) + B*E^2/2\n                    ad1_i = A * (E_i**2/2.0 * log_Ei - E_i**2/4.0) + B * E_i**2/2.0\n                    ad1_i1 = A * (E_i1**2/2.0 * log_Ei1 - E_i1**2/4.0) + B * E_i1**2/2.0\n                    I1_i = ad1_i1 - ad1_i\n                \n                elif scheme == 'log-log':\n                    # p(E') = C * (E')^m\n                    log_Ei, log_Ei1 = np.log(E_i), np.log(E_i1)\n                    log_pi, log_pi1 = np.log(p_i), np.log(p_i1)\n                    d_logE = log_Ei1 - log_Ei\n                    if d_logE == 0: continue\n                    \n                    m = (log_pi1 - log_pi) / d_logE\n                    # C can be found from p_i = C * E_i^m\n                    # Using np.power is safer for fractional exponents on negative bases but not needed here.\n                    C = p_i / (E_i**m) \n                    \n                    # Zeroth moment integral\n                    if abs(m + 1.0)  1e-12:\n                        I0_i = C * d_logE\n                    else:\n                        m_plus_1 = m + 1.0\n                        I0_i = C / m_plus_1 * (E_i1**m_plus_1 - E_i**m_plus_1)\n                    \n                    # First moment integral\n                    if abs(m + 2.0)  1e-12:\n                        I1_i = C * d_logE\n                    else:\n                        m_plus_2 = m + 2.0\n                        I1_i = C / m_plus_2 * (E_i1**m_plus_2 - E_i**m_plus_2)\n\n                total_I0 += I0_i\n                total_I1 += I1_i\n\n            approx_mean = total_I1 / total_I0 if total_I0 != 0 else 0\n            bias = approx_mean - true_mean\n            case_biases.append(round(bias, 8))\n            \n        all_case_biases.append(case_biases)\n\n    # Final Output Formatting\n    str_results = []\n    for biases in all_case_biases:\n        str_biases = [f\"{b:.8f}\" for b in biases]  # Ensure trailing zeros for rounding\n        str_results.append(f\"[{','.join(str_biases)}]\")\n    \n    final_output_str = f\"[{','.join(str_results)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Building on the ability to sample from a single energy distribution, this final practice tackles the more complex scenario of reactions that produce multiple outgoing particles, such as the important $(n,2n)$ reaction. Enforcing fundamental conservation laws in such cases is paramount for the physical realism of a simulation. This exercise demonstrates a powerful and widely used technique: sequential sampling from conditional distributions, where the energy available for each subsequent particle depends on the energy taken by the previous ones, ensuring the total energy budget is strictly conserved .",
            "id": "4247165",
            "problem": "Consider a simplified Monte Carlo (MC) model for a neutron-induced two-neutron emission reaction, commonly denoted as $(n,2n)$, in nuclear reactor simulation. An incident neutron of kinetic energy $E_0$ interacts with a target nucleus. The reaction requires a threshold energy budget $\\Delta$ to be consumed by excitation and binding-energy costs such that the total kinetic energy available to the emitted secondaries is $E_{\\text{avail}} = E_0 - \\Delta$. The goal is to sample two emitted neutron energies $E'_1$ and $E'_2$ and their polar scattering angles $\\theta_1$ and $\\theta_2$ in the laboratory frame, while enforcing energy conservation in the sense $E'_1 + E'_2 \\le E_{\\text{avail}}$, with the sampling proceeding sequentially so that the second energy is sampled from a conditional spectrum truncated by the remaining energy budget. All energies must be expressed in mega-electron-volts (MeV) and all angles must be expressed in radians.\n\nThe fundamental base for this problem is conservation of energy and the axioms of probability, combined with well-tested emission spectrum models and anisotropic angular distributions:\n- Energy conservation implies $E'_1 + E'_2 \\le E_{\\text{avail}}$, where $E_{\\text{avail}} = E_0 - \\Delta$, and the reaction is not feasible if $E_{\\text{avail}} \\le 0$.\n- The individual emitted neutron energy spectrum is modeled by an evaporation spectrum, specifically a Gamma distribution with shape parameter $k=2$ and scale parameter $T$, i.e., $f(E) \\propto E \\exp(-E/T)$, where $T>0$ is a temperature-like spectral parameter in units of MeV. To enforce the energy budget, $f(E)$ is truncated to the interval $[0, E_{\\text{avail}}]$, where $E_{\\max}$ is the current remaining energy budget. Sampling $E'_1$ uses $E_{\\max} = E_{\\text{avail}}$, then $E'_2$ uses $E_{\\max} = E_{\\text{avail}} - E'_1$ so that $E'_1+E'_2 \\le E_{\\text{avail}}$ by construction.\n- The polar scattering angle $\\theta$ is sampled via the cosine $\\mu = \\cos\\theta$ from a first-order anisotropic distribution $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ for $\\mu \\in [-1,1]$, with anisotropy parameter $\\alpha \\in [-1,1]$. For $\\alpha=0$, the distribution is isotropic. The azimuthal angle $\\phi$ is not required for this task.\n\nYour task is to implement a program that, for each specified test case, performs the following steps:\n1. Compute $E_{\\text{avail}} = E_0 - \\Delta$. If $E_{\\text{avail}} \\le 0$, return a result indicating the reaction is not feasible and set $E'_1 = 0$, $E'_2 = 0$, $\\theta_1 = 0$, $\\theta_2 = 0$.\n2. If $E_{\\text{avail}} > 0$, sample $E'_1$ from an evaporation spectrum $f(E) \\propto E \\exp(-E/T)$ truncated to $[0, E_{\\text{avail}}]$, then sample $E'_2$ from the same form truncated to $[0, E_{\\text{avail}} - E'_1]$. Use inverse transform sampling on the truncated cumulative distribution to ensure exact enforcement of the bound $E'_1+E'_2 \\le E_{\\text{avail}}$ with numerical safeguards for edge cases.\n3. Independently sample $\\theta_1$ and $\\theta_2$ from $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ by inversion of its cumulative distribution for $\\mu = \\cos\\theta$, then set $\\theta = \\arccos(\\mu)$ in radians.\n4. Return, for each test case, a list containing a boolean feasibility indicator followed by the sampled values $E'_1$, $E'_2$, $\\theta_1$, and $\\theta_2$.\n\nAll energies must be in MeV and all angles in radians. The angular unit specification is indispensable: you must ensure all angles in the output are in radians.\n\nYou must use the following test suite, where each tuple is $(E_0,\\Delta,T,\\alpha,\\text{seed})$ with $E_0$ and $\\Delta$ in MeV, $T$ in MeV, $\\alpha$ dimensionless, and a pseudorandom seed for reproducibility:\n- Case A (happy path with moderate anisotropy): $(14.0, 8.0, 1.0, 0.3, 12345)$.\n- Case B (boundary case, zero available energy): $(8.0, 8.0, 1.5, 0.0, 222)$.\n- Case C (edge case, negative available energy): $(6.0, 8.0, 1.2, -0.5, 333)$.\n- Case D (forward-peaked anisotropy near the limit): $(20.0, 7.0, 2.0, 0.95, 444)$.\n- Case E (small remaining budget, backward-peaked anisotropy): $(9.2, 8.9, 1.0, -0.8, 555)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of the form $[\\text{feasible}, E'_1, E'_2, \\theta_1, \\theta_2]$. For example, the overall output must look like $[[\\dots],[\\dots],[\\dots],[\\dots],[\\dots]]$ on a single line. Each numeric entry must be a float, and the feasibility indicator must be a boolean.",
            "solution": "The problem statement has been meticulously validated and is determined to be valid. It is scientifically grounded in the principles of nuclear physics and Monte Carlo methods, is well-posed with all necessary information provided, and is expressed in objective, formal language. There are no scientific flaws, contradictions, or ambiguities.\n\nThe task is to develop a computational model to sample the energies and scattering angles of two neutrons emitted from an $(n,2n)$ reaction. The solution requires the derivation and implementation of inverse transform sampling algorithms for two distinct probability distributions: a truncated evaporation spectrum for the neutron energies and a first-order anisotropic distribution for the scattering angle cosines.\n\nThe solution is developed in three parts: first, the derivation for sampling the secondary neutron energies; second, the derivation for sampling their scattering angles; and third, the synthesis of these components into a coherent algorithm.\n\n**Energy Sampling from a Truncated Evaporation Spectrum**\n\nThe energy $E'$ of an emitted neutron is modeled by a truncated evaporation spectrum. The probability density function (PDF) is given by $f(E') \\propto E' \\exp(-E'/T)$ for $E' \\in [0, E_{\\max}]$, where $T$ is the spectrum temperature and $E_{\\max}$ is the maximum allowed energy.\n\nTo perform inverse transform sampling, we first need the cumulative distribution function (CDF), $F(E')$. This requires normalizing the PDF. The un-normalized indefinite integral is found using integration by parts:\n$$\n\\int E' \\exp(-E'/T) dE' = -T(E'+T)\\exp(-E'/T)\n$$\nThe normalization constant, $C$, is the definite integral over the allowed energy range $[0, E_{\\max}]$:\n$$\nC = \\int_0^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left[-T(E'+T)\\exp(-E'/T)\\right]_0^{E_{\\max}} = T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)\n$$\nThe CDF, $F(E')$, for $E' \\in [0, E_{\\max}]$ is then:\n$$\nF(E') = \\frac{\\int_0^{E'} u \\exp(-u/T) du}{C} = \\frac{T^2 - T(E'+T)\\exp(-E'/T)}{T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)}\n$$\nTo sample an energy $E'$, we set $F(E') = \\xi$, where $\\xi$ is a random number drawn from a uniform distribution on $[0, 1]$. This leads to the equation:\n$$\n\\xi = \\frac{1 - (E'/T+1)\\exp(-E'/T)}{1 - (E_{\\max}/T+1)\\exp(-E_{\\max}/T)}\n$$\nLet $x = E'/T$ and $x_{\\max} = E_{\\max}/T$. Rearranging the equation to solve for $x$ yields:\n$$\n(x+1)\\exp(-x) = 1 - \\xi \\left( 1 - (x_{\\max}+1)\\exp(-x_{\\max}) \\right)\n$$\nThis is a transcendental equation of the form $z \\exp(-z) = Y$, which can be solved using the Lambert W function. Let $z = x+1$. The equation becomes $z \\exp(-(z-1)) = Y$, or $z \\exp(-z) = Y/\\mathrm{e}$.\nMultiplying by $-1$, we get $(-z)\\exp(-z) = -Y/\\mathrm{e}$. This is the canonical form for the Lambert W function, $w \\exp(w) = k$, where $w = -z$ and $k = -Y/\\mathrm{e}$.\nThe solution for $w$ is $w = W(k)$. The Lambert W function has two real branches for arguments in $[-1/\\mathrm{e}, 0)$: the principal branch $W_0(z) \\ge -1$ and the lower branch $W_{-1}(z) \\le -1$. Since $x=E'/T$ must be non-negative, $z = x+1$ must be greater than or equal to $1$, which implies $w = -z$ must be less than or equal to $-1$. Therefore, we must use the lower branch, $W_{-1}$.\nThe sampled scaled energy $x$ is thus:\n$$\nx = -1 - W_{-1}\\left( -\\frac{1}{\\mathrm{e}} \\left[ 1 - \\xi \\left(1-(x_{\\max}+1)\\exp(-x_{\\max})\\right) \\right] \\right)\n$$\nThe final sampled energy is $E' = x \\cdot T$. This procedure is used first to sample $E'_1$ with $E_{\\max} = E_{\\text{avail}}$, and then to sample $E'_2$ with $E_{\\max} = E_{\\text{avail}} - E'_1$.\n\n**Angular Sampling from an Anisotropic Distribution**\n\nThe polar scattering angle $\\theta$ is sampled via its cosine, $\\mu = \\cos\\theta$. The PDF for $\\mu$ is given as $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ for $\\mu \\in [-1, 1]$, where $\\alpha$ is the anisotropy parameter, $|\\alpha| \\le 1$.\n\nThe CDF, $P(\\mu)$, is the integral of the PDF from $-1$ to $\\mu$:\n$$\nP(\\mu) = \\int_{-1}^{\\mu} \\frac{1}{2}(1 + \\alpha \\mu') d\\mu' = \\frac{1}{2}\\left[\\mu' + \\frac{\\alpha}{2}(\\mu')^2\\right]_{-1}^{\\mu} = \\frac{1}{2}\\left( (\\mu + \\frac{\\alpha}{2}\\mu^2) - (-1 + \\frac{\\alpha}{2}) \\right)\n$$\nSetting $P(\\mu) = \\xi$, where $\\xi \\sim U(0,1)$, yields a quadratic equation for $\\mu$:\n$$\n\\alpha \\mu^2 + 2\\mu + (2 - \\alpha - 4\\xi) = 0\n$$\nSolving for $\\mu$ using the quadratic formula gives:\n$$\n\\mu = \\frac{-2 \\pm \\sqrt{4 - 4\\alpha(2-\\alpha-4\\xi)}}{2\\alpha} = \\frac{-1 \\pm \\sqrt{1 - \\alpha(2-\\alpha-4\\xi)}}{\\alpha} = \\frac{-1 \\pm \\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi}}{\\alpha}\n$$\nTo ensure the solution is valid for all $\\xi \\in [0, 1]$ and remains continuous as $\\alpha \\to 0$, the positive root must be chosen. The resulting formula is:\n$$\n\\mu = \\frac{\\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi} - 1}{\\alpha}\n$$\nFor the special case of isotropic scattering ($\\alpha=0$), the PDF is $p(\\mu) = 1/2$ and the CDF is $P(\\mu) = (\\mu+1)/2$. Inverting this gives $\\mu = 2\\xi - 1$. The general formula is numerically unstable for small $|\\alpha|$ and should be replaced by the isotropic formula in that limit. For implementation, a threshold such as $|\\alpha|  10^{-8}$ is appropriate.\nAfter sampling $\\mu$, the polar angle is found via $\\theta = \\arccos(\\mu)$, which will be in radians as required.\n\n**Algorithmic Procedure**\n\nFor each test case specified by $(E_0, \\Delta, T, \\alpha, \\text{seed})$:\n1.  A dedicated pseudorandom number generator is initialized with the given `seed` to ensure reproducibility and independence between test cases.\n2.  The total available kinetic energy is computed: $E_{\\text{avail}} = E_0 - \\Delta$.\n3.  A feasibility check is performed. If $E_{\\text{avail}} \\le 0$, the reaction is impossible. The result is recorded as `[False, 0.0, 0.0, 0.0, 0.0]`.\n4.  If $E_{\\text{avail}}  0$, the reaction is feasible. The sampling proceeds:\n    a. The first neutron energy, $E'_1$, is sampled from the truncated evaporation spectrum using the Lambert W function method with $E_{\\max} = E_{\\text{avail}}$ and a random variate $\\xi_1$.\n    b. The remaining energy budget is calculated: $E_{\\text{rem}} = E_{\\text{avail}} - E'_1$.\n    c. The second neutron energy, $E'_2$, is sampled from the same spectral form, but truncated to $[0, E_{\\text{rem}}]$, using a new random variate $\\xi_2$.\n    d. The cosine of the first scattering angle, $\\mu_1$, is sampled using the quadratic inversion method with the parameter $\\alpha$ and a random variate $\\xi_3$. The angle is then $\\theta_1 = \\arccos(\\mu_1)$.\n    e. The cosine of the second scattering angle, $\\mu_2$, is sampled independently using the same method with a random variate $\\xi_4$. The angle is then $\\theta_2 = \\arccos(\\mu_2)$.\n    f. The result is recorded as `[True, E'_1, E'_2, \\theta_1, \\theta_2]`.\n5.  After processing all test cases, the collected results are formatted into a single string representing a list of lists and printed to standard output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lambertw\n\ndef solve():\n    \"\"\"\n    Solves the neutron sampling problem for a given set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E0, Delta, T, alpha, seed)\n        (14.0, 8.0, 1.0, 0.3, 12345),  # Case A\n        (8.0, 8.0, 1.5, 0.0, 222),      # Case B\n        (6.0, 8.0, 1.2, -0.5, 333),     # Case C\n        (20.0, 7.0, 2.0, 0.95, 444),    # Case D\n        (9.2, 8.9, 1.0, -0.8, 555),     # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        E0, Delta, T, alpha, seed = case\n        \n        # Use a dedicated generator for each case for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Step 1: Compute available energy and check feasibility\n        E_avail = E0 - Delta\n\n        if E_avail = 0:\n            feasible = False\n            E1_prime = 0.0\n            E2_prime = 0.0\n            theta1 = 0.0\n            theta2 = 0.0\n        else:\n            feasible = True\n            \n            # Step 2: Sample energies sequentially\n            E1_prime = sample_energy(E_avail, T, rng)\n            E_rem = E_avail - E1_prime\n            E2_prime = sample_energy(E_rem, T, rng)\n\n            # Step 3: Sample angles independently\n            mu1 = sample_mu(alpha, rng)\n            theta1 = np.arccos(mu1) # Output is in radians\n\n            mu2 = sample_mu(alpha, rng)\n            theta2 = np.arccos(mu2) # Output is in radians\n\n        # Step 4: Store the results for the current case\n        results.append([feasible, E1_prime, E2_prime, theta1, theta2])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is required.\n    print(str(results).replace(\" \", \"\"))\n\ndef sample_energy(E_max, T, rng):\n    \"\"\"\n    Samples an energy E from a truncated evaporation spectrum f(E) ~ E*exp(-E/T)\n    on the interval [0, E_max] using the Lambert W function for inversion.\n    \n    Args:\n        E_max (float): Maximum energy for the truncated spectrum (MeV).\n        T (float): Temperature parameter of the spectrum (MeV).\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled energy E' (MeV).\n    \"\"\"\n    if E_max = 0.0:\n        return 0.0\n\n    xi = rng.random()\n    x_max = E_max / T\n\n    # The normalized integral up to x_max\n    # I_norm = integral from 0 to x_max of x*exp(-x) dx\n    I_norm = 1.0 - (x_max + 1.0) * np.exp(-x_max)\n\n    # This should not happen for T0, E_max0, but as a safeguard.\n    if I_norm = 0.0:\n        return 0.0\n\n    C_prime = xi * I_norm\n    Y = 1.0 - C_prime\n    \n    # Argument for the Lambert W function\n    k = -Y / np.e\n    \n    # Use the lower branch (k=-1) of the Lambert W function.\n    # It returns a complex number, so we take the real part.\n    w = lambertw(k, k=-1).real\n    \n    # The scaled energy x = E/T\n    x = -1.0 - w\n    \n    return x * T\n\ndef sample_mu(alpha, rng):\n    \"\"\"\n    Samples the cosine of the scattering angle, mu, from p(mu) = 0.5*(1 + alpha*mu).\n    \n    Args:\n        alpha (float): Anisotropy parameter.\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled cosine of the angle, mu.\n    \"\"\"\n    xi = rng.random()\n    \n    # Handle isotropic case and numerical stability for small alpha\n    if abs(alpha)  1e-8:\n        mu = 2.0 * xi - 1.0\n    else:\n        term_in_sqrt = (1.0 - alpha)**2 + 4.0 * alpha * xi\n        mu = (np.sqrt(term_in_sqrt) - 1.0) / alpha\n        \n    # Clip to handle potential floating point inaccuracies before arccos\n    return np.clip(mu, -1.0, 1.0)\n\nsolve()\n```"
        }
    ]
}