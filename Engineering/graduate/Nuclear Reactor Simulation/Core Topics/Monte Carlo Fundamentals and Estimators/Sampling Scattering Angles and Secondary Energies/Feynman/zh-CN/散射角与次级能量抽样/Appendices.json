{
    "hands_on_practices": [
        {
            "introduction": "蒙特卡洛模拟的核心任务之一是精确地模拟反应后出射粒子的能量。这个练习将引导我们探索一个基本的物理模型——蒸发模型，它描述了受激原子核如何发射中子。通过从统计力学第一性原理出发，你将推导出典型的次级中子能谱，并掌握如何通过逆变换函数法等关键技术对其进行抽样，这是掌握中子输运模拟的基本功。",
            "id": "4247135",
            "problem": "考虑核反应堆模拟中高度激发复合核的中子发射，该过程由 Weisskopf–Ewing 蒸发模型描述。假设发射体可被视为温度为 $T$ 的正则系综，且发射的中子是非相对论性的，其动能为 $E'$。单位能量的发射概率与相空间因子和玻尔兹曼因子的乘积成正比。对于无势垒的 $s$ 波发射，其透射系数变化缓慢（因此其能量依赖性在由 $T$ 设定的尺度上可以忽略不计），相空间因子与连续态密度和粒子速度的乘积成正比。使用统计力学和非相对论运动学的基本原理：\n\n- 推导发射中子的归一化次级能量谱 $p(E' \\mid T)$。\n- 证明所得分布属于伽马分布族，并确定其形状和尺度参数。\n- 从精确的累积分布函数出发，仅使用标准特殊函数，以闭合形式推导出一个显式的逆累积变换 $E'(u)$，其中 $u \\in (0,1)$ 是一个均匀随机变量。仔细论证为确保对所有 $u \\in (0,1)$ 都有 $E'(u) \\geq 0$ 所需的任何特殊函数分支选择。\n- 提出一种有效的抽样方法，该方法无需数值求根即可处理谱中的能量线性因子，并用独立的均匀随机变量表示抽样得到的能量。\n\n提供逆累积映射 $E'(u)$ 的最终显式解析表达式，该表达式为一个关于 $u$ 和 $T$ 的单一闭合形式公式。最终能量以兆电子伏特 (MeV) 为单位表示。不需要进行数值代入。最终答案必须是单一闭合形式的解析表达式，且不包含不等式。此问题不涉及角度。",
            "solution": "此问题具有科学依据，提法明确，并包含足够的信息以获得唯一解。这是统计核物理中的一个标准问题，与核应用中次级粒子能量的模拟直接相关。我将进行完整的推导。\n\n问题要求推导次级中子能量谱，将其识别为伽马分布族的一员，推导用于抽样的逆累积分布函数，并提出一种替代的高效抽样算法。指定的最终答案是逆累积变换的闭合形式表达式。\n\n首先，我们推导归一化的次级能量谱 $p(E' \\mid T)$。问题指出，动能为 $E'$ 的中子，其单位能量的发射概率与相空间因子和玻尔兹曼因子的乘积成正比。\n设未归一化的概率密度函数为 $f(E')$。根据问题陈述，我们有：\n$$f(E') \\propto (\\text{相空间因子}) \\times (\\text{玻尔兹曼因子})$$\n在温度为 $T$ 的系统中，能量为 $E'$ 的状态的玻尔兹曼因子由 $\\exp(-E'/T)$ 给出。\n问题陈述相空间因子与连续态密度和粒子速度的乘积成正比。对于非相对论性粒子，动能为 $E' = \\frac{p^2}{2m}$，其中 $p$ 是动量，$m$ 是质量。粒子速度为 $v = \\sqrt{2E'/m}$，与 $(E')^{1/2}$ 成正比。动量间隔 $dp$ 内的连续态数目与 $p^2 dp$ 成正比。我们可以用能量来表示它：$p = \\sqrt{2mE'}$，所以 $dp = \\sqrt{2m} \\frac{1}{2}(E')^{-1/2} dE'$。因此，单位能量的态密度 $\\frac{dN}{dE'}$ 与 $p^2 \\frac{dp}{dE'} \\propto (E') \\cdot (E')^{-1/2} = (E')^{1/2}$ 成正比。\n因此，相空间因子与 (态密度) $\\times$ (速度) $\\propto (E')^{1/2} \\times (E')^{1/2} = E'$ 成正比。\n综合这些因子，发射中子能量 $E'$ 的未归一化概率密度为：\n$$f(E') = C \\cdot E' \\exp(-E'/T)$$\n其中 $C$ 是归一化常数且 $E' \\ge 0$。为了求出 $C$，我们要求分布归一化为1：\n$$\\int_{0}^{\\infty} f(E') dE' = 1$$\n$$C \\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = 1$$\n这个积分是伽马函数的标准形式，$\\int_{0}^{\\infty} x^n \\exp(-ax) dx = \\frac{\\Gamma(n+1)}{a^{n+1}} = \\frac{n!}{a^{n+1}}$。当 $n=1$ 且 $a=1/T$ 时，该积分的计算结果为：\n$$\\int_{0}^{\\infty} E' \\exp(-E'/T) dE' = \\frac{1!}{(1/T)^{1+1}} = T^2$$\n将此结果代回归一化条件，得到 $C \\cdot T^2 = 1$，所以 $C = 1/T^2$。\n因此，归一化的次级能量谱 $p(E' \\mid T)$ 为：\n$$p(E' \\mid T) = \\frac{1}{T^2} E' \\exp(-E'/T), \\quad \\text{for } E' \\ge 0$$\n这种形式被称为麦克斯韦-裂变谱或瓦特谱。\n\n接下来，我们证明此分布属于伽马分布族。伽马分布的概率密度函数由形状参数 $k$ 和尺度参数 $\\theta$ 定义为：\n$$f(x; k, \\theta) = \\frac{1}{\\Gamma(k)\\theta^k} x^{k-1} \\exp(-x/\\theta)$$\n将此与我们推导的能谱 $p(E' \\mid T)$ 进行比较，我们可以通过匹配函数形式来确定参数。令 $x=E'$ 和 $\\theta=T$。我们的能谱可以写成：\n$$p(E' \\mid T) = \\frac{1}{1 \\cdot T^2} (E')^{2-1} \\exp(-E'/T)$$\n通过比较能量项的指数，我们发现 $k-1 = 1$，这给出了形状参数 $k=2$。尺度参数显然是 $\\theta=T$。这个识别与归一化常数是一致的，因为 $\\Gamma(k) = \\Gamma(2) = (2-1)! = 1! = 1$。归一化因子 $\\frac{1}{\\Gamma(k)\\theta^k}$ 变为 $\\frac{1}{\\Gamma(2)T^2} = \\frac{1}{1 \\cdot T^2} = \\frac{1}{T^2}$，这与我们推导出的常数完全匹配。因此，推导出的中子能谱是形状参数为 $k=2$、尺度参数为 $\\theta=T$ 的伽马分布。\n\n现在，我们推导逆累积变换 $E'(u)$。首先，我们通过对概率密度函数（PDF）从 $0$ 到 $E'$ 积分来计算累积分布函数（CDF）$F(E')$：\n$$F(E') = \\int_{0}^{E'} p(\\epsilon \\mid T) d\\epsilon = \\frac{1}{T^2} \\int_{0}^{E'} \\epsilon \\exp(-\\epsilon/T) d\\epsilon$$\n我们使用分部积分法计算该积分，令 $u' = \\epsilon$ 和 $dv = \\exp(-\\epsilon/T)d\\epsilon$。这得到 $du' = d\\epsilon$ 和 $v = -T \\exp(-\\epsilon/T)$。\n$$\\int \\epsilon \\exp(-\\epsilon/T) d\\epsilon = -\\epsilon T \\exp(-\\epsilon/T) - \\int (-T \\exp(-\\epsilon/T)) d\\epsilon$$\n$$ = -\\epsilon T \\exp(-\\epsilon/T) - T^2 \\exp(-\\epsilon/T) = -T(\\epsilon+T)\\exp(-\\epsilon/T)$$\n计算 CDF 的定积分：\n$$F(E') = \\frac{1}{T^2} \\left[ -T(\\epsilon+T)\\exp(-\\epsilon/T) \\right]_{0}^{E'}$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) - (-T(0+T)\\exp(0)) \\right)$$\n$$F(E') = \\frac{1}{T^2} \\left( -T(E'+T)\\exp(-E'/T) + T^2 \\right) = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n为了求逆变换，我们令 $F(E') = u$，其中 $u \\in (0,1)$ 是一个均匀随机变量，然后解出 $E'$。\n$$u = 1 - \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n$$1 - u = \\left(1 + \\frac{E'}{T}\\right)\\exp(-E'/T)$$\n这个超越方程可以使用朗伯W函数求解，其定义关系为 $z = W(z)\\exp(W(z))$。为了将我们的方程化为此形式，令 $y=E'/T$。则 $1-u = (1+y)\\exp(-y)$。两边乘以 $-e^{-1}$：\n$$-(1-u)e^{-1} = -(1+y)e^{-y}e^{-1} = -(1+y)e^{-(y+1)}$$\n令 $X = -(1+y)$。则 $y = -X-1$ 且 $-(y+1)=-(-X-1+1)=X$。方程变为：\n$$-(1-u)e^{-1} = X e^X$$\n该方程的形式为 $z = w\\exp(w)$，其中 $z = -(1-u)\\exp(-1)$ 且 $w=X$。因此，$X$ 的解由朗伯W函数给出：\n$$X = W\\left(-(1-u)\\exp(-1)\\right)$$\n将 $X = -(1 + E'/T)$ 代回：\n$$-(1 + E'/T) = W\\left(-(1-u)\\exp(-1)\\right)$$\n$$1 + E'/T = -W\\left(-(1-u)\\exp(-1)\\right)$$\n$$E'/T = -1 - W\\left(-(1-u)\\exp(-1)\\right)$$\n$$E'(u) = -T \\left[ 1 + W\\left(-(1-u)\\exp(-1)\\right) \\right]$$\nW函数的自变量为 $z = -(1-u)\\exp(-1)$。由于 $u \\in (0,1)$，$1-u \\in (0,1)$，所以 $z \\in (-\\exp(-1), 0)$。这个区间在两个实数分支 $W_0$ 和 $W_{-1}$ 的定义域内。\n我们需要一个物理上有意义的解，即 $E'(u) \\ge 0$。由于 $T>0$，这意味着 $1 + W(z) \\le 0$，或者 $W(z) \\le -1$。\n主分支 $W_0(z)$ 将区间 $[-\\exp(-1), \\infty)$ 映射到 $[-1, \\infty)$。对于 $z \\in (-\\exp(-1), 0)$，我们有 $W_0(z) \\in (-1, 0)$。这个选择将导致 $1+W_0(z) > 0$，从而 $E' < 0$，这是不符合物理实际的。\n下分支 $W_{-1}(z)$ 将区间 $[-\\exp(-1), 0)$ 映射到 $(-\\infty, -1]$。这个选择保证了 $W_{-1}(z) \\le -1$，这意味着 $1+W_{-1}(z) \\le 0$，从而 $E' \\ge 0$。\n因此，正确的分支是 $W_{-1}$。逆累积变换的最终表达式为：\n$$E'(u) = -T \\left[ 1 + W_{-1}\\left(-(1-u)\\exp(-1)\\right) \\right]$$\n问题还要求一种高效的抽样方法。将能量分布识别为伽马($k=2, \\theta=T$)分布提供了一种非常高效的方法。一个来自伽马($k, \\theta$)分布的随机变量（其中k是整数），可以通过对k个来自尺度参数为$\\theta$的指数分布的独立随机变量求和来生成。\n在我们的例子中，$k=2$。尺度为 $\\theta=T$ 的指数分布的PDF是 $p_{exp}(y) = (1/T)\\exp(-y/T)$。其CDF是 $F_{exp}(y) = 1-\\exp(-y/T)$。对指数分布使用逆变换抽样，我们设 $F_{exp}(y)=u'$，其中 $u' \\in (0,1)$ 是一个均匀变量，这给出 $y = -T \\ln(1-u')$。由于 $1-u'$ 也均匀分布在 $(0,1)$上，我们可以写成 $y = -T \\ln(u')$。\n因此，要从我们的分布中抽样一个能量 $E'$，我们生成两个独立的均匀随机变量 $u_1, u_2 \\in (0,1)$，生成两个独立的指数变量 $Y_1 = -T \\ln(u_1)$ 和 $Y_2 = -T \\ln(u_2)$，并将它们相加：\n$$E' = Y_1 + Y_2 = -T \\ln(u_1) - T \\ln(u_2) = -T \\ln(u_1 u_2)$$\n这种方法避免了特殊函数的数值计算，并且计算效率非常高，仅使用标准库中的对数函数。\n\n要求的最终答案是逆累积映射 $E'(u)$ 的显式解析表达式。温度 $T$ 的单位被理解为 MeV。",
            "answer": "$$\n\\boxed{-T \\left( 1 + W_{-1}\\left( -(1-u)\\exp(-1) \\right) \\right)}\n$$"
        },
        {
            "introduction": "掌握了单个粒子的抽样后，我们将挑战更复杂但普遍存在的多粒子出射反应，例如 $(n,2n)$ 反应。这个高级练习旨在训练你如何在抽样过程中严格执行能量守恒等基本物理定律。你需要实现一个顺序抽样方案，从一个因能量预算而动态变化的截断能谱中抽取能量，这代表了现代模拟程序中处理复杂反应道的一种精密而强大的技术。",
            "id": "4247145",
            "problem": "您的任务是分析在蒙特卡洛核反应堆模拟中，用于列表化次级能量概率密度函数的插值方案如何影响估算的平均次级能量。考虑一个严格为正的能量域和一个具有指数尾部的物理真实能谱，该能谱与反应堆物理学中遇到的热化或非弹性过程一致。您将比较应用于列表化概率密度函数的三种插值方案，并计算每种方案在平均次级能量中引入的偏差。\n\n基于以下基本定义进行推导和计算：\n- 能量域 $E' \\in [E_{\\min}, E_{\\max}]$ 上的概率密度函数 (PDF) $p(E')$ 满足归一化条件 $$\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1.$$\n- 分布的平均值为 $$\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'.$$\n- 对于真实的截断指数谱，假设 $$p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}, \\quad E' \\in [E_{\\min}, E_{\\max}],$$ 其中 $T$ 是一个尺度参数，类似于以电子伏特为单位测量的有效温度。\n\nPDF 在网格点 $\\{E_i\\}_{i=0}^{N-1}$ 处被列表化，其中 $E_0 = E_{\\min}$ 和 $E_{N-1} = E_{\\max}$，且能量严格递增 $E_{i+1} > E_i$。列表值为 $p_i = p_{\\text{true}}(E_i)$。在每个区间 $[E_i, E_{i+1}]$ 上定义三种插值方案：\n1. $p$ 对 $E'$ 线性 (线性-线性)：在 $(E_i, p_i)$ 和 $(E_{i+1}, p_{i+1})$ 之间，将 $p(E')$ 作为 $E'$ 的函数进行线性插值。\n2. $p$ 对 $\\log E'$ 线性 (线性-对数)：在 $(\\log E_i, p_i)$ 和 $(\\log E_{i+1}, p_{i+1})$ 之间，将 $p(E')$ 作为 $\\log E'$ 的函数进行线性插值。这要求 $E_{\\min} > 0$。\n3. $\\log p$ 对 $\\log E'$ 线性 (对数-对数)：在 $(\\log E_i, \\log p_i)$ 和 $(\\log E_{i+1}, \\log p_{i+1})$ 之间，将 $\\log p(E')$ 作为 $\\log E'$ 的函数进行线性插值。这要求 $E_{\\min} > 0$ 且 $p_i > 0$。\n\n对于每种插值方案，在 $[E_{\\min}, E_{\\max}]$ 上构建一个分段插值函数 $\\tilde{p}(E')$，将其重新归一化以满足 $$\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') \\, dE' = 1$$ 从而获得一个有效的 PDF $\\hat{p}(E')$，然后计算近似平均值 $$\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'.$$\n将每种方案的偏差定义为 $$\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}},$$ 其中 $\\langle E' \\rangle_{\\text{true}}$ 是 $p_{\\text{true}}(E')$ 在 $[E_{\\min}, E_{\\max}]$ 上的平均值。\n\n您的程序必须为以下测试套件实现这些步骤，涵盖典型、粗糙、对数间隔和长尾情况。所有能量和尺度 $T$ 都必须以电子伏特 (eV) 为单位，所有报告的偏差也必须以电子伏特 (eV) 为单位。此问题不涉及角度。\n\n测试套件 (每个案例是一个元组 $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type}))$:\n- 案例 1 (一般情况，线性网格): $(1.0, 10^{-6}, 10.0, 32, \\text{linear})$。\n- 案例 2 (粗糙网格，线性): $(1.0, 10^{-6}, 10.0, 4, \\text{linear})$。\n- 案例 3 (对数网格，更宽的尾部): $(0.5, 10^{-6}, 20.0, 32, \\text{log})$。\n- 案例 4 (对数网格，长尾): $(2.0, 10^{-3}, 40.0, 16, \\text{log})$。\n\n网格构建规则：\n- 对于 $\\text{grid\\_type} = \\text{linear}$: $$E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1},\\quad i=0,\\dots,N-1.$$\n- 对于 $\\text{grid\\_type} = \\text{log}$: $$E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}},\\quad i=0,\\dots,N-1.$$\n\n要求：\n- 在每个区间上实现三种插值方案，分段构成 $\\tilde{p}(E')$，重新归一化以获得 $\\hat{p}(E')$，并为每种方案计算 $\\widehat{\\langle E' \\rangle}$。\n- 在 $[E_{\\min}, E_{\\max}]$ 上计算 $p_{\\text{true}}(E')$ 下的真实平均值 $\\langle E' \\rangle_{\\text{true}}$。\n- 对于每个测试案例，以电子伏特 (eV) 为单位输出三种方案的偏差，结果为浮点数，四舍五入到八位小数。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表形式的结果，每个内部列表按 [线性-线性, 线性-对数, 对数-对数] 的顺序给出四种测试案例的三种偏差。例如：\"[[b11,b12,b13],[b21,b22,b23],[b31,b32,b33],[b41,b42,b43]]\"。\n\n在最终输出中，所有能量和偏差都以电子伏特 (eV) 表示，并四舍五入到八位小数。角度不属于此任务的一部分；不需要角度单位。",
            "solution": "用户提供了一个科学上合理、定义明确且需要严谨数值解的问题。我将首先根据指定标准验证问题陈述，然后着手解决。\n\n### 第 1 步：问题验证\n\n我将首先提取已知条件，然后验证问题。\n\n#### 已知条件提取\n- **概率密度函数 (PDF) 定义**：在 $E' \\in [E_{\\min}, E_{\\max}]$ 上的函数 $p(E')$ 如果是非负的并且满足 $\\int_{E_{\\min}}^{E_{\\max}} p(E') \\, dE' = 1$，则它是一个 PDF。\n- **分布的平均值**：$\\langle E' \\rangle = \\int_{E_{\\min}}^{E_{\\max}} E' \\, p(E') \\, dE'$。\n- **真实 PDF**：PDF 的解析形式是一个截断指数函数，由 $p_{\\text{true}}(E') = \\frac{\\exp(-E'/T)}{T\\left(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)\\right)}$ 给出，适用于 $E' \\in [E_{\\min}, E_{\\max}]$。$T$ 是一个以电子伏特 (eV) 为单位的尺度参数。\n- **列表化**：PDF 在 $N$ 个网格点 $\\{E_i\\}_{i=0}^{N-1}$ 处进行采样，其中 $E_0 = E_{\\min}$ 且 $E_{N-1} = E_{\\max}$。列表值为 $p_i = p_{\\text{true}}(E_i)$。\n- **插值方案**：\n    1.  **线性-线性**：在每个区间 $[E_i, E_{i+1}]$ 上，$p(E')$ 对 $E'$ 进行线性插值。\n    2.  **线性-对数**：在每个区间 $[E_i, E_{i+1}]$ 上，$p(E')$ 对 $\\log E'$ 进行线性插值（要求 $E_{\\min} > 0$）。\n    3.  **对数-对数**：在每个区间 $[E_i, E_{i+1}]$ 上，$\\log p(E')$ 对 $\\log E'$ 进行线性插值（要求 $E_{\\min} > 0$ 和 $p_i > 0$）。\n- **计算任务**：\n    1.  对于每种方案，构建一个分段插值函数 $\\tilde{p}(E')$。\n    2.  将其重新归一化以得到一个有效的 PDF $\\hat{p}(E')$。\n    3.  计算近似平均值 $\\widehat{\\langle E' \\rangle} = \\int_{E_{\\min}}^{E_{\\max}} E' \\, \\hat{p}(E') \\, dE'$。\n    4.  计算偏差：$\\text{bias} = \\widehat{\\langle E' \\rangle} - \\langle E' \\rangle_{\\text{true}}$。\n- **网格生成**：\n    - **线性网格**：$E_i = E_{\\min} + i\\frac{E_{\\max} - E_{\\min}}{N - 1}$，其中 $i=0,\\dots,N-1$。\n    - **对数网格**：$E_i = E_{\\min} \\left( \\frac{E_{\\max}}{E_{\\min}} \\right)^{\\frac{i}{N-1}}$，其中 $i=0,\\dots,N-1$。\n- **测试套件**：提供了四个案例，形式为元组 $(T, E_{\\min}, E_{\\max}, N, \\text{grid\\_type})$：\n    - 案例 1: $(1.0, 10^{-6}, 10.0, 32, \\text{linear})$\n    - 案例 2: $(1.0, 10^{-6}, 10.0, 4, \\text{linear})$\n    - 案例 3: $(0.5, 10^{-6}, 20.0, 32, \\text{log})$\n    - 案例 4: $(2.0, 10^{-3}, 40.0, 16, \\text{log})$\n- **输出格式**：一个单行字符串，表示偏差的列表的列表，例如 `[[b11,b12,b13],[b21,b22,b23],...]`，所有数字四舍五入到八位小数。\n\n#### 验证结论\n- **科学基础**：该问题牢固地植根于计算物理和数值分析。使用截断指数谱是反应堆物理学中一个合理的模型，而插值误差的分析是一种标准且重要的实践。该问题在科学上是合理的。\n- **适定性**：该问题是适定的。所有函数、参数和程序都定义明确。这些定义为每个测试案例导出了唯一的、可计算的解决方案。\n- **客观性**：语言精确且数学化，没有任何主观性或意见。\n- **完整性与一致性**：问题陈述是自洽的。它提供了所有必要的数据和公式。对数方案的要求（$E_{\\min} > 0$，$p_i > 0$）由问题的物理特性和具体的测试案例所满足。没有任何矛盾之处。\n\n该问题被认为是 **有效的**。我现在将着手解决。\n\n### 第 2 步：解析和数值公式的推导\n\n问题的核心是计算形式为 $\\int f(E') dE'$ 和 $\\int E' f(E') dE'$ 的定积分，其中 $f(E')$ 是真实 PDF 或插值 PDF 之一。\n\n#### 真实平均值 $\\langle E' \\rangle_{\\text{true}}$\n真实 PDF 为 $p_{\\text{true}}(E') = \\frac{1}{C} \\exp(-E'/T)$，其中 $C = T(\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T))$ 是归一化常数。真实平均值为：\n$$ \\langle E' \\rangle_{\\text{true}} = \\int_{E_{\\min}}^{E_{\\max}} E' p_{\\text{true}}(E') dE' = \\frac{1}{C} \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' $$\n使用分部积分法，$\\int u e^{au} du = (\\frac{u}{a} - \\frac{1}{a^2})e^{au}$，其中 $u=E'$ 且 $a=-1/T$：\n$$ \\int E' \\exp(-E'/T) dE' = [-T E' \\exp(-E'/T) - T^2 \\exp(-E'/T)] $$\n计算从 $E_{\\min}$ 到 $E_{\\max}$ 的定积分得到：\n$$ \\int_{E_{\\min}}^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left(T E_{\\min} + T^2\\right)\\exp(-E_{\\min}/T) - \\left(T E_{\\max} + T^2\\right)\\exp(-E_{\\max}/T) $$\n除以 $C$ 并简化，我们得到一个计算真实平均值的稳定公式：\n$$ \\langle E' \\rangle_{\\text{true}} = T + \\frac{E_{\\min}\\exp(-E_{\\min}/T) - E_{\\max}\\exp(-E_{\\max}/T)}{\\exp(-E_{\\min}/T) - \\exp(-E_{\\max}/T)} $$\n\n#### 近似平均值 $\\widehat{\\langle E' \\rangle}$\n对于每种插值方案，近似平均值是通过在 $N-1$ 个区间上求和的两个积分之比来计算的：\n$$ \\widehat{\\langle E' \\rangle} = \\frac{\\int_{E_{\\min}}^{E_{\\max}} E' \\tilde{p}(E') dE'}{\\int_{E_{\\min}}^{E_{\\max}} \\tilde{p}(E') dE'} = \\frac{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE'}{\\sum_{i=0}^{N-2} \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE'} = \\frac{I_1}{I_0} $$\n其中 $\\tilde{p}_i(E')$ 是在 $[E_i, E_{i+1}]$ 上的插值函数。我们必须为每种方案推导出这些积分的解析形式。\n\n**1. 线性-线性插值**\n在 $[E_i, E_{i+1}]$上，插值函数是一条直线：$\\tilde{p}_i(E') = A_i E' + B_i$，其中 $A_i = \\frac{p_{i+1} - p_i}{E_{i+1} - E_i}$ 且 $B_i = p_i - A_i E_i$。\n零阶矩（面积）是梯形的面积：\n$$ \\int_{E_i}^{E_{i+1}} \\tilde{p}_i(E') dE' = \\frac{1}{2}(p_i + p_{i+1})(E_{i+1} - E_i) $$\n一阶矩为：\n$$ \\int_{E_i}^{E_{i+1}} E' \\tilde{p}_i(E') dE' = \\int_{E_i}^{E_{i+1}} (A_i (E')^2 + B_i E') dE' = \\left[ \\frac{A_i}{3}(E')^3 + \\frac{B_i}{2}(E')^2 \\right]_{E_i}^{E_{i+1}} $$\n\n**2. 线性-对数插值**\n插值函数为 $\\tilde{p}_i(E') = A_i \\log E' + B_i$，其中 $A_i = \\frac{p_{i+1} - p_i}{\\log E_{i+1} - \\log E_i}$ 且 $B_i = p_i - A_i \\log E_i$。\n所需的原函数是：\n- $\\int (A_i \\log E' + B_i) dE' = A_i(E' \\log E' - E') + B_i E'$\n- $\\int E'(A_i \\log E' + B_i) dE' = A_i\\left(\\frac{(E')^2}{2}\\log E' - \\frac{(E')^2}{4}\\right) + B_i\\frac{(E')^2}{2}$\n通过在 $E_{i+1}$ 和 $E_i$ 处计算这些原函数的值来求得定积分。\n\n**3. 对数-对数插值**\n插值函数是一个幂律函数，$\\tilde{p}_i(E') = C_i (E')^{m_i}$，其中指数为 $m_i = \\frac{\\log p_{i+1} - \\log p_i}{\\log E_{i+1} - \\log E_i}$，系数为 $C_i = p_i / E_i^{m_i}$。\n积分取决于 $m_i$ 的值。\n零阶矩：\n$$ \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i} dE' = \\begin{cases} \\frac{C_i}{m_i+1} \\left( E_{i+1}^{m_i+1} - E_i^{m_i+1} \\right)  \\text{if } m_i \\neq -1 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{if } m_i = -1 \\end{cases} $$\n一阶矩：\n$$ \\int_{E_i}^{E_{i+1}} E' \\cdot C_i (E')^{m_i} dE' = \\int_{E_i}^{E_{i+1}} C_i (E')^{m_i+1} dE' = \\begin{cases} \\frac{C_i}{m_i+2} \\left( E_{i+1}^{m_i+2} - E_i^{m_i+2} \\right)  \\text{if } m_i \\neq -2 \\\\ C_i (\\log E_{i+1} - \\log E_i)  \\text{if } m_i = -2 \\end{cases} $$\n通过对每个区间的结果求和来实现这些公式，以找到总积分 $I_0$ 和 $I_1$，从而计算出近似平均值和偏差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates and prints the bias in mean secondary energy for three different\n    interpolation schemes applied to a tabulated truncated exponential PDF for a\n    suite of test cases.\n    \"\"\"\n    \n    def solve_case(T, E_min, E_max, N, grid_type):\n        # Step 1: Generate energy grid and true PDF values\n        if grid_type == 'linear':\n            E_grid = np.linspace(E_min, E_max, N)\n        else:  # 'log'\n            E_grid = np.geomspace(E_min, E_max, N)\n        \n        # Using np.longdouble for higher precision in intermediate calculations\n        T, E_min, E_max = np.longdouble(T), np.longdouble(E_min), np.longdouble(E_max)\n        E_grid = np.longdouble(E_grid)\n\n        # Step 2: Define true PDF and calculate true mean\n        norm_const_C = T * (np.exp(-E_min / T) - np.exp(-E_max / T))\n        if norm_const_C = 0: return [0.0, 0.0, 0.0]\n        \n        p_grid = np.exp(-E_grid / T) / norm_const_C\n        \n        term1 = (T * E_min + T**2) * np.exp(-E_min / T)\n        term2 = (T * E_max + T**2) * np.exp(-E_max / T)\n        true_mean = (term1 - term2) / norm_const_C\n\n        biases = []\n        \n        # Step 3: Loop over interpolation schemes\n        for scheme in ['linear-linear', 'linear-log', 'log-log']:\n            total_moment0 = np.longdouble(0.0)\n            total_moment1 = np.longdouble(0.0)\n            \n            for i in range(N - 1):\n                E1, E2 = E_grid[i], E_grid[i+1]\n                p1, p2 = p_grid[i], p_grid[i+1]\n                \n                if E1 >= E2: continue\n\n                m0, m1 = np.longdouble(0.0), np.longdouble(0.0)\n                \n                if scheme == 'linear-linear':\n                    m0 = 0.5 * (p1 + p2) * (E2 - E1)\n                    A = (p2 - p1) / (E2 - E1)\n                    B = p1 - A * E1\n                    m1 = (A/3)*(E2**3 - E1**3) + (B/2)*(E2**2 - E1**2)\n                \n                elif scheme == 'linear-log':\n                    if E1 = 0: continue\n                    logE1, logE2 = np.log(E1), np.log(E2)\n                    if logE1 == logE2: continue\n                    A = (p2 - p1) / (logE2 - logE1)\n                    B = p1 - A * logE1\n                    \n                    term_ElogE_minus_E = lambda E: E * np.log(E) - E if E > 0 else np.longdouble(0.0)\n                    m0 = A * (term_ElogE_minus_E(E2) - term_ElogE_minus_E(E1)) + B * (E2 - E1)\n                    \n                    term_E2logE_minus_E2_4 = lambda E: (E**2 / 2) * np.log(E) - (E**2 / 4) if E > 0 else np.longdouble(0.0)\n                    m1 = A * (term_E2logE_minus_E2_4(E2) - term_E2logE_minus_E2_4(E1)) + B * (E2**2 - E1**2) / 2\n\n                elif scheme == 'log-log':\n                    if E1 = 0 or p1 = 0 or p2 = 0: continue\n                    logE1, logE2 = np.log(E1), np.log(E2)\n                    logp1, logp2 = np.log(p1), np.log(p2)\n                    if logE1 == logE2: continue\n\n                    m = (logp2 - logp1) / (logE2 - logE1)\n                    C_ = p1 / (E1**m)\n                    \n                    if abs(m + 1.0)  1e-12:\n                        m0 = C_ * (logE2 - logE1)\n                    else:\n                        m0 = C_ / (m + 1.0) * (E2**(m + 1.0) - E1**(m + 1.0))\n                    \n                    if abs(m + 2.0)  1e-12:\n                        m1 = C_ * (logE2 - logE1)\n                    else:\n                        m1 = C_ / (m + 2.0) * (E2**(m + 2.0) - E1**(m + 2.0))\n                \n                total_moment0 += m0\n                total_moment1 += m1\n\n            approx_mean = total_moment1 / total_moment0 if total_moment0 > 0 else np.longdouble(0.0)\n            bias = float(approx_mean - true_mean)\n            biases.append(bias)\n            \n        return biases\n\n    test_cases = [\n        (1.0, 1.0e-6, 10.0, 32, 'linear'),\n        (1.0, 1.0e-6, 10.0, 4, 'linear'),\n        (0.5, 1.0e-6, 20.0, 32, 'log'),\n        (2.0, 1.0e-3, 40.0, 16, 'log'),\n    ]\n\n    all_case_biases = [solve_case(*case) for case in test_cases]\n    \n    # Format the final output string as required\n    formatted_biases = [[f\"{b:.8f}\" for b in case_biases] for case_biases in all_case_biases]\n    final_output_str = str(formatted_biases).replace(\"'\", \"\").replace(\" \", \"\")\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "理论上的解析能谱在实际应用中通常以离散数据点的形式存储在核数据库中。这个练习将理论与实践联系起来，要求你评估在处理这些列表化数据时，不同的插值方法会如何影响模拟结果的准确性。通过亲手计算不同插值格式引入的平均能量偏差，你将深刻理解保证蒙特卡洛模拟高保真度的数值挑战。",
            "id": "4247165",
            "problem": "考虑一个简化的蒙特卡洛（MC）模型，用于模拟核反应堆中的中子诱发双中子出射反应，通常表示为 $(n,2n)$。一个动能为 $E_0$ 的入射中子与一个靶核相互作用。该反应需要消耗阈值能量 $\\Delta$ 用于激发和结合能成本，使得发射的次级粒子可用的总动能为 $E_{\\text{avail}} = E_0 - \\Delta$。目标是抽样两个出射中子的能量 $E'_1$ 和 $E'_2$ 及其在实验室坐标系中的极向散射角 $\\theta_1$ 和 $\\theta_2$，同时强制能量守恒，即 $E'_1 + E'_2 \\le E_{\\text{avail}}$。抽样过程是顺序进行的，第二个中子的能量是从一个被剩余能量预算截断的条件谱中抽样的。所有能量必须以兆电子伏特（MeV）表示，所有角度必须以弧度表示。\n\n该问题的基础是能量守恒和概率公理，结合经过充分检验的发射谱模型和各向异性角分布：\n- 能量守恒意味着 $E'_1 + E'_2 \\le E_{\\text{avail}}$，其中 $E_{\\text{avail}} = E_0 - \\Delta$。如果 $E_{\\text{avail}} \\le 0$，则反应不可行。\n- 单个出射中子的能谱由蒸发谱建模，具体为一个形状参数 $k=2$、标度参数为 $T$ 的伽马分布，即 $f(E) \\propto E \\exp(-E/T)$，其中 $T0$ 是一个单位为 MeV 的类温度谱参数。为强制执行能量预算，$f(E)$ 被截断在区间 $[0, E_{\\max}]$ 上，其中 $E_{\\max}$ 是当前剩余的能量预算。抽样 $E'_1$ 时使用 $E_{\\max} = E_{\\text{avail}}$，然后抽样 $E'_2$ 时使用 $E_{\\max} = E_{\\text{avail}} - E'_1$，从而通过构造确保 $E'_1+E'_2 \\le E_{\\text{avail}}$。\n- 极向散射角 $\\theta$ 是通过其余弦 $\\mu = \\cos\\theta$ 从一阶各向异性分布 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$（其中 $\\mu \\in [-1,1]$）中抽样的，$\\alpha \\in [-1,1]$ 是各向异性参数。当 $\\alpha=0$ 时，分布是各向同性的。本任务不要求方位角 $\\phi$。\n\n你的任务是实现一个程序，对每个指定的测试用例执行以下步骤：\n1. 计算 $E_{\\text{avail}} = E_0 - \\Delta$。如果 $E_{\\text{avail}} \\le 0$，返回一个表示反应不可行的结果，并设置 $E'_1 = 0$，$E'_2 = 0$，$\\theta_1 = 0$，$\\theta_2 = 0$。\n2. 如果 $E_{\\text{avail}}  0$，则从截断在 $[0, E_{\\text{avail}}]$ 上的蒸发谱 $f(E) \\propto E \\exp(-E/T)$ 中抽样 $E'_1$，然后从截断在 $[0, E_{\\text{avail}} - E'_1]$ 上的相同形式谱中抽样 $E'_2$。使用截断累积分布的逆变换采样，并带有针对边界情况的数值保护措施，以确保精确执行边界条件 $E'_1+E'_2 \\le E_{\\text{avail}}$。\n3. 通过对其累积分布函数进行逆变换，从 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ 中独立抽样 $\\theta_1$ 和 $\\theta_2$ 的余弦值 $\\mu = \\cos\\theta$，然后设置 $\\theta = \\arccos(\\mu)$（以弧度为单位）。\n4. 对每个测试用例，返回一个列表，其中包含一个布尔值的可行性指示符，后跟抽样值 $E'_1$、$E'_2$、$\\theta_1$ 和 $\\theta_2$。\n\n所有能量必须以 MeV 为单位，所有角度必须以弧度为单位。角度单位的规定至关重要：你必须确保输出中的所有角度都以弧度为单位。\n\n你必须使用以下测试套件，其中每个元组为 $(E_0,\\Delta,T,\\alpha,\\text{seed})$，$E_0$ 和 $\\Delta$ 的单位为 MeV，$T$ 的单位为 MeV，$\\alpha$ 为无量纲量，以及用于可复现性的伪随机种子：\n- 用例 A（具有中等各向异性的正常路径）：$(14.0, 8.0, 1.0, 0.3, 12345)$。\n- 用例 B（边界情况，可用能量为零）：$(8.0, 8.0, 1.5, 0.0, 222)$。\n- 用例 C（边缘情况，可用能量为负）：$(6.0, 8.0, 1.2, -0.5, 333)$。\n- 用例 D（接近极限的前向峰化各向异性）：$(20.0, 7.0, 2.0, 0.95, 444)$。\n- 用例 E（剩余预算小，后向峰化各向异性）：$(9.2, 8.9, 1.0, -0.8, 555)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试用例，并且本身是 $[\\text{feasible}, E'_1, E'_2, \\theta_1, \\theta_2]$ 形式的列表。例如，总输出必须看起来像 $[[\\dots],[\\dots],[\\dots],[\\dots],[\\dots]]$，位于单行上。每个数值条目必须是浮点数，可行性指示符必须是布尔值。",
            "solution": "问题陈述已经过仔细验证，并被确定为有效。它在科学上基于核物理和蒙特卡洛方法的原理，所提供的信息完备，问题定义良好，并以客观、正式的语言表述。不存在科学缺陷、矛盾或歧义。\n\n任务是开发一个计算模型，用于抽样从 $(n,2n)$ 反应中发射的两个中子的能量和散射角。该解决方案需要推导和实现两种不同概率分布的逆变换采样算法：用于中子能量的截断蒸发谱和用于散射角余弦的一阶各向异性分布。\n\n解决方案分三部分进行：首先，推导次级中子能量的抽样方法；其次，推导其散射角的抽样方法；第三，将这些部分综合成一个连贯的算法。\n\n**从截断蒸发谱中进行能量抽样**\n\n出射中子的能量 $E'$ 由一个截断蒸发谱建模。其概率密度函数 (PDF) 为 $f(E') \\propto E' \\exp(-E'/T)$，适用于 $E' \\in [0, E_{\\max}]$，其中 $T$ 是谱温度，$E_{\\max}$ 是允许的最大能量。\n\n为了执行逆变换采样，我们首先需要累积分布函数 (CDF) $F(E')$。这需要对 PDF 进行归一化。使用分部积分法可以找到不定积分：\n$$\n\\int E' \\exp(-E'/T) dE' = -T(E'+T)\\exp(-E'/T)\n$$\n归一化常数 $C$ 是在允许的能量范围 $[0, E_{\\max}]$ 上的定积分：\n$$\nC = \\int_0^{E_{\\max}} E' \\exp(-E'/T) dE' = \\left[-T(E'+T)\\exp(-E'/T)\\right]_0^{E_{\\max}} = T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)\n$$\n那么，对于 $E' \\in [0, E_{\\max}]$，CDF $F(E')$ 为：\n$$\nF(E') = \\frac{\\int_0^{E'} u \\exp(-u/T) du}{C} = \\frac{T^2 - T(E'+T)\\exp(-E'/T)}{T^2 - T(E_{\\max}+T)\\exp(-E_{\\max}/T)}\n$$\n为了抽样能量 $E'$，我们设 $F(E') = \\xi$，其中 $\\xi$ 是从 $[0, 1]$ 上的均匀分布中抽取的随机数。这导出了方程：\n$$\n\\xi = \\frac{1 - (E'/T+1)\\exp(-E'/T)}{1 - (E_{\\max}/T+1)\\exp(-E_{\\max}/T)}\n$$\n令 $x = E'/T$ 和 $x_{\\max} = E_{\\max}/T$。重新整理方程以求解 $x$ 可得：\n$$\n(x+1)\\exp(-x) = 1 - \\xi \\left( 1 - (x_{\\max}+1)\\exp(-x_{\\max}) \\right)\n$$\n这是一个形如 $z \\exp(-z) = Y$ 的超越方程，可以用朗伯W函数求解。令 $z = x+1$。方程变为 $z \\exp(-(z-1)) = Y$，即 $z \\exp(-z) = Y/\\mathrm{e}$。\n两边乘以 $-1$，得到 $(-z)\\exp(-z) = -Y/\\mathrm{e}$。这是朗伯W函数的标准形式 $w \\exp(w) = k$，其中 $w = -z$ 且 $k = -Y/\\mathrm{e}$。\n$w$ 的解是 $w = W(k)$。朗伯W函数对于区间 $[-1/\\mathrm{e}, 0)$ 内的参数有两个实数分支：主分支 $W_0(z) \\ge -1$ 和下分支 $W_{-1}(z) \\le -1$。由于 $x=E'/T$ 必须为非负数，所以 $z = x+1$ 必须大于或等于 $1$，这意味着 $w = -z$ 必须小于或等于 $-1$。因此，我们必须使用下分支 $W_{-1}$。\n因此，抽样得到的标度化能量 $x$ 为：\n$$\nx = -1 - W_{-1}\\left( -\\frac{1}{\\mathrm{e}} \\left[ 1 - \\xi \\left(1-(x_{\\max}+1)\\exp(-x_{\\max})\\right) \\right] \\right)\n$$\n最终抽样的能量为 $E' = x \\cdot T$。此过程首先用于抽样 $E'_1$（此时 $E_{\\max} = E_{\\text{avail}}$），然后用于抽样 $E'_2$（此时 $E_{\\max} = E_{\\text{avail}} - E'_1$）。\n\n**从各向异性分布中进行角度抽样**\n\n极向散射角 $\\theta$ 是通过其余弦 $\\mu = \\cos\\theta$ 抽样的。$\\mu$ 的 PDF 由 $p(\\mu) = \\frac{1}{2}(1 + \\alpha \\mu)$ 给出，适用于 $\\mu \\in [-1, 1]$，其中 $\\alpha$ 是各向异性参数，$|\\alpha| \\le 1$。\n\nCDF $P(\\mu)$ 是 PDF 从 $-1$ 到 $\\mu$ 的积分：\n$$\nP(\\mu) = \\int_{-1}^{\\mu} \\frac{1}{2}(1 + \\alpha \\mu') d\\mu' = \\frac{1}{2}\\left[\\mu' + \\frac{\\alpha}{2}(\\mu')^2\\right]_{-1}^{\\mu} = \\frac{1}{2}\\left( (\\mu + \\frac{\\alpha}{2}\\mu^2) - (-1 + \\frac{\\alpha}{2}) \\right)\n$$\n设 $P(\\mu) = \\xi$，其中 $\\xi \\sim U(0,1)$，可以得到一个关于 $\\mu$ 的二次方程：\n$$\n\\alpha \\mu^2 + 2\\mu + (2 - \\alpha - 4\\xi) = 0\n$$\n使用二次公式求解 $\\mu$ 得：\n$$\n\\mu = \\frac{-2 \\pm \\sqrt{4 - 4\\alpha(2-\\alpha-4\\xi)}}{2\\alpha} = \\frac{-1 \\pm \\sqrt{1 - \\alpha(2-\\alpha-4\\xi)}}{\\alpha} = \\frac{-1 \\pm \\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi}}{\\alpha}\n$$\n为了确保解对所有 $\\xi \\in [0, 1]$ 都有效，并且在 $\\alpha \\to 0$ 时保持连续，必须选择正根。得到的公式是：\n$$\n\\mu = \\frac{\\sqrt{(1-\\alpha)^2 + 4\\alpha\\xi} - 1}{\\alpha}\n$$\n对于各向同性散射的特殊情况 ($\\alpha=0$)，PDF 为 $p(\\mu) = 1/2$，CDF 为 $P(\\mu) = (\\mu+1)/2$。对其求逆可得 $\\mu = 2\\xi - 1$。通用公式在 $|\\alpha|$ 很小时数值不稳定，在该极限下应替换为各向同性公式。在实现中，使用如 $|\\alpha|  10^{-8}$ 这样的阈值是合适的。\n抽样 $\\mu$ 后，通过 $\\theta = \\arccos(\\mu)$ 计算出极向角，其单位将按要求为弧度。\n\n**算法流程**\n\n对每个由 $(E_0, \\Delta, T, \\alpha, \\text{seed})$ 指定的测试用例：\n1. 使用给定的 `seed` 初始化一个专用的伪随机数生成器，以确保可复现性和测试用例之间的独立性。\n2. 计算可用的总动能：$E_{\\text{avail}} = E_0 - \\Delta$。\n3. 进行可行性检查。如果 $E_{\\text{avail}} \\le 0$，则反应不可能发生。结果记录为 `[False, 0.0, 0.0, 0.0, 0.0]`。\n4. 如果 $E_{\\text{avail}}  0$，则反应可行。抽样过程如下：\n    a. 使用朗伯W函数方法，以 $E_{\\max} = E_{\\text{avail}}$ 和一个随机变量 $\\xi_1$，从截断蒸发谱中抽样第一个中子能量 $E'_1$。\n    b. 计算剩余能量预算：$E_{\\text{rem}} = E_{\\text{avail}} - E'_1$。\n    c. 使用一个新的随机变量 $\\xi_2$，从截断在 $[0, E_{\\text{rem}}]$ 上的相同谱形式中抽样第二个中子能量 $E'_2$。\n    d. 使用参数 $\\alpha$ 和一个随机变量 $\\xi_3$，通过二次方程求逆方法抽样第一个散射角的余弦 $\\mu_1$。然后角度为 $\\theta_1 = \\arccos(\\mu_1)$。\n    e. 使用一个随机变量 $\\xi_4$，通过相同方法独立抽样第二个散射角的余弦 $\\mu_2$。然后角度为 $\\theta_2 = \\arccos(\\mu_2)$。\n    f. 结果记录为 `[True, E'_1, E'_2, \\theta_1, \\theta_2]`。\n5. 处理完所有测试用例后，将收集到的结果格式化为表示列表的列表的单个字符串，并打印到标准输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lambertw\n\ndef solve():\n    \"\"\"\n    Solves the neutron sampling problem for a given set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E0, Delta, T, alpha, seed)\n        (14.0, 8.0, 1.0, 0.3, 12345),  # Case A\n        (8.0, 8.0, 1.5, 0.0, 222),      # Case B\n        (6.0, 8.0, 1.2, -0.5, 333),     # Case C\n        (20.0, 7.0, 2.0, 0.95, 444),    # Case D\n        (9.2, 8.9, 1.0, -0.8, 555),     # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        E0, Delta, T, alpha, seed = case\n        \n        # Use a dedicated generator for each case for reproducibility\n        rng = np.random.default_rng(seed)\n\n        # Step 1: Compute available energy and check feasibility\n        E_avail = E0 - Delta\n\n        if E_avail = 0:\n            feasible = False\n            E1_prime = 0.0\n            E2_prime = 0.0\n            theta1 = 0.0\n            theta2 = 0.0\n        else:\n            feasible = True\n            \n            # Step 2: Sample energies sequentially\n            E1_prime = sample_energy(E_avail, T, rng)\n            E_rem = E_avail - E1_prime\n            E2_prime = sample_energy(E_rem, T, rng)\n\n            # Step 3: Sample angles independently\n            mu1 = sample_mu(alpha, rng)\n            theta1 = np.arccos(mu1) # Output is in radians\n\n            mu2 = sample_mu(alpha, rng)\n            theta2 = np.arccos(mu2) # Output is in radians\n\n        # Step 4: Store the results for the current case\n        results.append([feasible, E1_prime, E2_prime, theta1, theta2])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is required.\n    print(str(results).replace(\" \", \"\"))\n\ndef sample_energy(E_max, T, rng):\n    \"\"\"\n    Samples an energy E from a truncated evaporation spectrum f(E) ~ E*exp(-E/T)\n    on the interval [0, E_max] using the Lambert W function for inversion.\n    \n    Args:\n        E_max (float): Maximum energy for the truncated spectrum (MeV).\n        T (float): Temperature parameter of the spectrum (MeV).\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled energy E' (MeV).\n    \"\"\"\n    if E_max = 0.0:\n        return 0.0\n\n    xi = rng.random()\n    x_max = E_max / T\n\n    # The normalized integral up to x_max\n    # I_norm = integral from 0 to x_max of x*exp(-x) dx\n    I_norm = 1.0 - (x_max + 1.0) * np.exp(-x_max)\n\n    # This should not happen for T>0, E_max>0, but as a safeguard.\n    if I_norm = 0.0:\n        return 0.0\n\n    C_prime = xi * I_norm\n    Y = 1.0 - C_prime\n    \n    # Argument for the Lambert W function\n    k = -Y / np.e\n    \n    # Use the lower branch (k=-1) of the Lambert W function.\n    # It returns a complex number, so we take the real part.\n    w = lambertw(k, k=-1).real\n    \n    # The scaled energy x = E/T\n    x = -1.0 - w\n    \n    return x * T\n\ndef sample_mu(alpha, rng):\n    \"\"\"\n    Samples the cosine of the scattering angle, mu, from p(mu) = 0.5*(1 + alpha*mu).\n    \n    Args:\n        alpha (float): Anisotropy parameter.\n        rng (numpy.random.Generator): Random number generator instance.\n        \n    Returns:\n        float: The sampled cosine of the angle, mu.\n    \"\"\"\n    xi = rng.random()\n    \n    # Handle isotropic case and numerical stability for small alpha\n    if abs(alpha)  1e-8:\n        mu = 2.0 * xi - 1.0\n    else:\n        term_in_sqrt = (1.0 - alpha)**2 + 4.0 * alpha * xi\n        mu = (np.sqrt(term_in_sqrt) - 1.0) / alpha\n        \n    # Clip to handle potential floating point inaccuracies before arccos\n    return np.clip(mu, -1.0, 1.0)\n\nsolve()\n```"
        }
    ]
}