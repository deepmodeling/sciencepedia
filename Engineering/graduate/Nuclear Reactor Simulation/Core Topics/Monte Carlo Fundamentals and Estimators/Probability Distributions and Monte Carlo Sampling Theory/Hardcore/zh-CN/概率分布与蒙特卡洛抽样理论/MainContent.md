## 引言
在核[反应堆物理](@entry_id:158170)的研究与工程设计中，精确模拟中子在复杂系统中的行为至关重要。蒙特卡洛方法，作为一种基于概率统计理论的数值计算方法，已成为反应堆分析的黄金标准，能够以极高的保真度处理复杂的几何形状和能量依赖性。然而，有效运用这一强大工具不仅需要了解“如何操作”，更需要深刻理解其背后的[概率论基础](@entry_id:158925)和统计学原理，这正是许多初学者和实践者所面临的知识鸿沟。

本文旨在系统性地填补这一鸿沟，为读者构建一个从第一性原理到高级应用的完整知识框架。我们将带领读者踏上一场从理论到实践的旅程，深入探索[蒙特卡洛采样](@entry_id:752171)的奥秘。

在 **“原理与机制”** 一章中，我们将追根溯源，从描述单个中子行为的概率分布出发，建立粒子历史的[测度论](@entry_id:139744)框架，并探讨[中心极限定理](@entry_id:143108)等核心理论如何为模拟结果的可靠性提供数学保证。

接着，在 **“应用与跨学科联系”** 一章中，我们将理论付诸实践，剖析一个完整的[中子输运模拟](@entry_id:1128710)流程，包括如何对自由程、碰撞类型和散射角进行抽样，并介绍[临界计算](@entry_id:1123193)、重要性采样和各类减方差技术的具体应用，同时将视野拓展到其他相关学科。

最后，在 **“动手实践”** 一章中，您将通过一系列精心设计的问题，亲手应用所学知识，验证散射模型、比较[估计量效率](@entry_id:165636)、并实现[方差缩减技术](@entry_id:141433)，从而将理论理解转化为解决实际问题的能力。

## 原理与机制

本章旨在为蒙特卡洛[中子输运模拟](@entry_id:1128710)的实践奠定坚实的理论基础。我们将从描述单个中子行为的[概率法则](@entry_id:268260)出发，逐步构建起模拟整个反应堆中粒子历史的复杂[随机过程](@entry_id:268487)。在此基础上，我们将探讨如何利用计算机生成所需的[随机变量](@entry_id:195330)，以及如何从模拟出的粒子历史中提取有意义的物理量并评估其[统计不确定性](@entry_id:267672)。本章内容将使读者不仅知其然，更知其所以然，从而能够深刻理解[蒙特卡洛方法](@entry_id:136978)的威力、局限性以及高级技巧的理论依据。

### [粒子输运](@entry_id:1129401)的[概率论基础](@entry_id:158925)

蒙特卡洛方法的核心是将确定性的[输运方程](@entry_id:174281)转化为等价的[随机过程](@entry_id:268487)。理解这一过程的概率论描述是掌握该方法的关键。

#### 自由程分布与[无记忆性](@entry_id:201790)

我们考虑的最基本事件是中子在均匀介质中的自由飞行。假设在一个无限大的均匀介质中，其宏观总截面为常数 $\Sigma_t$（单位为长度的倒数）。$\Sigma_t$ 的物理意义是单位路径长度上发生相互作用的期望次数。更精确地，一个已经行进了距离 $x$ 而未发生碰撞的中子，在接下来一个无穷小程长 $dx$ 内发生碰撞的条件概率为 $\Sigma_t dx + o(dx)$。

基于此第一性原理，我们可以推导出中子飞行任意距离 $x$ 而不发生碰撞的概率，即**生存概率** $S(x)$。考虑中子飞行 $x+dx$ 的生存概率，这等价于它首先存活了距离 $x$，然后又在接下来的 $dx$ 内继续存活。因此，我们有：
$S(x+dx) = S(x) \times P(\text{在 } dx \text{ 内不碰撞} | \text{已存活 } x)$
$S(x+dx) = S(x) (1 - \Sigma_t dx - o(dx))$

整理上式可得一个关于 $S(x)$ 的[微分](@entry_id:158422)方程：
$\frac{S(x+dx) - S(x)}{dx} = -\Sigma_t S(x)$
在极限 $dx \to 0$ 下，我们得到：
$\frac{dS(x)}{dx} = -\Sigma_t S(x)$

该方程的初始条件是 $S(0) = 1$，因为中子在行程为零时必然存活。求解该[微分](@entry_id:158422)方程，得到生存概率函数：
$S(x) = \exp(-\Sigma_t x)$

这就是著名的**比尔-朗伯定律**。中子自由程长 $X$ 的**[累积分布函数 (CDF)](@entry_id:264700)** $F(x)$ 是指程长小于等于 $x$ 的概率，它与生存概率互补：
$F(x) = P(X \le x) = 1 - S(x) = 1 - \exp(-\Sigma_t x)$

对CDF求导，我们得到自由程长的**[概率密度函数](@entry_id:140610) (PDF)** $f(x)$：
$f(x) = \frac{dF(x)}{dx} = \Sigma_t \exp(-\Sigma_t x)$

这个结果表明，在均匀介质中，中子的自由程长服从参数为 $\Sigma_t$ 的**指数分布**。

指数分布一个至关重要的特性是其**[无记忆性](@entry_id:201790)**。这意味着一个粒子未来的行为与它的过去无关。形式上，对于任意的 $s, t > 0$，我们有：
$P(X > s+t | X > s) = \frac{P(X > s+t \text{ and } X > s)}{P(X > s)} = \frac{P(X > s+t)}{P(X > s)} = \frac{\exp(-\Sigma_t(s+t))}{\exp(-\Sigma_t s)} = \exp(-\Sigma_t t) = P(X>t)$
这个性质极大地简化了[蒙特卡洛模拟](@entry_id:193493)：无论一个中子已经飞了多远，它下一次碰撞前的飞行距离分布始终是同一个[指数分布](@entry_id:273894)。

#### 碰撞的[计数过程](@entry_id:896402)

将中子的一次次碰撞视为一系列事件，我们可以研究单位程长内发生碰撞的次数。由于每次飞行的程长是[独立同分布](@entry_id:169067)的指数[随机变量](@entry_id:195330)，这一系列碰撞事件构成了一个**[更新过程](@entry_id:275714)**。一个深刻的概率论结论是，当更新过程的“事件间期”服从[指数分布](@entry_id:273894)时，其对应的[计数过程](@entry_id:896402)是一个**[齐次泊松过程](@entry_id:263782)**。

具体来说，在总程长 $x$ 内发生碰撞的次数 $N(x)$ 服从一个均值为 $\Sigma_t x$ 的泊松分布：
$P(N(x) = k) = \frac{(\Sigma_t x)^k \exp(-\Sigma_t x)}{k!}$
这个过程具有**[独立增量](@entry_id:262163)**和**[平稳增量](@entry_id:263290)**的特性，即不同程长区间内的碰撞次数相互独立，且碰撞次数的分布只依赖于区间的长度，而与区间的起始位置无关。如果中子以恒定速度 $v$ 运动，那么在时间 $t$ 内的碰撞次数 $N(t)$ 同样服从泊松分布，其均值为 $\Sigma_t v t$。

#### 粒子历史的[概率空间](@entry_id:201477)

虽然单个自由程的描述相对简单，但一次完整的[蒙特卡洛模拟](@entry_id:193493)需要追踪一个粒子从产生到终止（被吸收或泄漏）的完整历史，甚至包括由裂变产生的后代粒子。为了严格地定义概率和期望，我们需要一个形式化的[概率空间](@entry_id:201477) $(\Omega, \mathcal{F}, \mathbb{P})$。

首先，考虑一个不会产生分支的**单粒子历史**。这个历史可以被看作一个事件序列，每个事件由（自由程长 $S_n$，相互作用类型 $I_n$，碰撞后状态 $Z_n$）构成。由于历史的步数是随机的，为了方便建模，我们通常将其嵌入到一个无限序列的空间中。当粒子历史终止（如被吸收），我们引入一个“**墓地态**” $\Delta$ 来填充序列的后续所有项。因此，[样本空间](@entry_id:275301) $\Omega$ 可以被构造为无限维的**乘[积空间](@entry_id:151693)** $\Omega = (\mathbb{R}_+ \times \mathcal{I} \times \mathcal{Z}_\Delta)^{\mathbb{N}}$，其中 $\mathcal{I}$ 是相互作用类型集合，$\mathcal{Z}_\Delta$ 是包含墓地态的相空间。

事件集合 $\mathcal{F}$ 必须是一个**$\sigma$-代数**，即对[补集](@entry_id:161099)和**可数**并集封闭的集合族。对于乘[积空间](@entry_id:151693)，我们通常选择由“[柱集](@entry_id:180956)”（即只对有限个坐标进行约束的事件）生成的最小 $\sigma$-代数，即**乘积 $\sigma$-代数**。这保证了诸如“粒子在前 $n$ 步内泄漏”这类物理上有意义的事件都是可测的。为了追踪信息如何随时间累积，我们还定义一个**滤子**（filtration）$\{\mathcal{F}_n\}_{n \in \mathbb{N}}$，其中 $\mathcal{F}_n$ 是由前 $n$ 次碰撞信息生成的 $\sigma$-代数。粒子历史的终止步数 $T$ 是一个**[停时](@entry_id:261799)**，因为事件 $\{T=n\}$ （即第 $n$ 步发生终止事件）是否发生完全由前 $n$ 步的历史决定。

当模拟包含**裂变**时，情况变得更为复杂。一个源中子可能产生一个随机数量的后代，这些后代又可能继续产生它们自己的后代，形成一个随机的“**宗谱结构**”。此时，单条序列已不足以描述整个历史。[样本空间](@entry_id:275301) $\Omega$ 必须是所有可能的**有根[标记树](@entry_id:274639)**的集合，其中每个节点代表一次碰撞事件，其子节点代表该次碰撞产生的后代。

在这种复杂的[样本空间](@entry_id:275301)上，$\sigma$-代数 $\mathcal{F}$ 的必要性愈发凸显。许多重要的物理事件，例如“粒子家族最终从反应堆中泄漏”，是无穷多个简单事件的并集（例如，$\cup_{n=1}^\infty \{$第 $n$ 代有粒子泄漏$\}$）。只有当 $\mathcal{F}$ [对可数并集封闭](@entry_id:198071)时，我们才能为这类事件赋予确定的概率。

此外，反应率、通量等物理量在模拟中作为“**计数**”（tally）出现，它们是整个随机历史 $\omega \in \Omega$ 的实值函数 $T(\omega)$。这些计数通常是随机数量的路径和事件的积分或求和，可以表示为一系列仅依赖于有限代数历史的[简单函数](@entry_id:137521)的[逐点极限](@entry_id:193549)。根据[测度论](@entry_id:139744)，可测[函数序列的极限](@entry_id:142182)仍然是可测的，但这要求[事件空间](@entry_id:275301)是一个 $\sigma$-代数。只有当计数 $T$ 是一个[可测函数](@entry_id:159040)（即[随机变量](@entry_id:195330)）时，我们才能严格地通过**[勒贝格积分](@entry_id:140189)**来定义其[期望值](@entry_id:150961) $\mathbb{E}[T] = \int_\Omega T(\omega) d\mathbb{P}$。这套基于[测度论](@entry_id:139744)的框架，包括 Ionescu-Tulcea 定理（用于保证在树空间上存在唯一的[概率测度](@entry_id:190821) $\mathbb{P}$），为[蒙特卡洛方法](@entry_id:136978)的正确性和收敛性提供了严谨的数学保障。

### 生成随机性：从理论到实践

理论上的概率分布必须通过计算机算法来具体实现。这一节将探讨如何从最基本的均匀分布出发，生成模拟所需的各种[随机变量](@entry_id:195330)。

#### [伪随机数生成器](@entry_id:145648)

所有蒙特卡洛模拟都始于一个能产生 $(0,1)$ 区间上均匀分布的随机数序列 $\{U_n\}$。在实践中，我们使用的是**[伪随机数生成器](@entry_id:145648) (PRNG)**，它产生的是一个长周期的确定性序列 $\{u_n\}$，用以“模仿”真正的随机序列。一个高质量的PRNG必须满足以下严苛的准则：

1.  **均匀性 (Uniformity)**：从[测度论](@entry_id:139744)的角度，一个[随机变量](@entry_id:195330) $U$ 在 $(0,1)$ 上均匀分布，意味着对于任何波莱尔集 $A \subset (0,1)$，其落入该集合的概率等于该集合的[勒贝格测度](@entry_id:139781)（长度），即 $\mathbb{P}(U \in A) = \lambda(A)$。这等价于其CDF为 $F(u)=u$（对 $u \in (0,1)$）。仅仅满足均值为 $\frac{1}{2}$ 和方差为 $\frac{1}{12}$ 是远远不够的。

2.  **独立性 (Independence)**：一个理想的随机序列 $\{U_n\}$ 应该是相互独立的。这意味着对于任意有限个变量 $U_{n_1}, \dots, U_{n_m}$ 和任意波莱尔集 $A_1, \dots, A_m$，[联合概率](@entry_id:266356)满足 $\mathbb{P}(U_{n_1} \in A_1, \dots, U_{n_m} \in A_m) = \prod_{i=1}^m \mathbb{P}(U_{n_i} \in A_i)$。仅仅满足不相关（协方差为零）是不够的，因为[高阶矩](@entry_id:266936)可能存在相关性。

3.  **长周期 (Long Period)**：PRNG的周期 $P$ 必须远大于模拟所需的总随机数数量 $N_{\text{var}}$，即 $P \gg N_{\text{var}}$。这不仅是为了避免序列重复，更是为了保证在[并行计算](@entry_id:139241)中使用多个子流或以特定步长消耗随机数时，不会出现非预期的相关性或短周期现象。

4.  **高维均匀分布性 (Equidistribution)**：在模拟中，我们经常将连续的随机数组合成 $k$-元组 $(u_n, \dots, u_{n+k-1})$ 来对多变量进行采样（例如，一个用于路径，一个用于反应，一个用于散射角）。因此，这些 $k$-元组必须在 $k$-维[超立方体](@entry_id:273913) $(0,1)^k$ 中表现出良好的均匀分布性。这一性质通过**偏差 (discrepancy)** 来量化，一个好的PRNG应在所有相关维度 $k$ 上都具有低偏差。这是确保模拟结果无偏的关键。

#### [逆变换采样法](@entry_id:142402)

有了高质量的均匀随机数源，我们需要方法将其转换为服从特定物理分布的随机数。最基本、最重要的方法是**[逆变换采样法](@entry_id:142402)**。

该方法适用于任何已知CDF $F(x)$ 的分布。根据概率论，任何CDF $F(x)$ 都是一个非减、右连续的函数，且满足 $F(-\infty)=0$ 和 $F(+\infty)=1$。对于这样的函数，我们可以定义其**[广义逆](@entry_id:140762)函数**（或称**[分位数函数](@entry_id:271351)**）：
$F^{-1}(u) = \inf\{x \in \mathbb{R} : F(x) \ge u\}$
其中 $u \in (0,1)$。[逆变换采样法](@entry_id:142402)的步骤是：
1.  从均匀分布 $U \sim \mathcal{U}(0,1)$ 中抽取一个随机数 $u$。
2.  计算 $x = F^{-1}(u)$。

可以严格证明，如此生成的[随机变量](@entry_id:195330) $X$ 的CDF恰好是 $F(x)$。即 $\mathbb{P}(X \le x_0) = \mathbb{P}(F^{-1}(U) \le x_0) = \mathbb{P}(U \le F(x_0)) = F(x_0)$。

该方法的强大之处在于其普适性。它无需对 $F(x)$ 提任何额外的光滑性或严格单调性要求。
-   如果 $F(x)$ 是连续且严格递增的（如[指数分布](@entry_id:273894)），[广义逆](@entry_id:140762)函数就退化为普通的逆函数。
-   如果 $F(x)$ 存在“平台区”（对应于PDF为零的区域），当 $u$ 落入与平台区对应的 $y$ 轴区间时，$\inf$ 操作会正确地跳过该区域。
-   如果 $F(x)$ 存在“跳跃”（对应于[离散概率](@entry_id:151843)质量点，例如在选择不同反应道时），当 $u$ 落入跳跃所对应的区间 $(F(x_j^-), F(x_j)]$ 时，$\inf$ 操作会精确地返回离散值 $x_j$，且其概率恰好为跳跃的高度 $F(x_j) - F(x_j^-)$。

因此，[逆变换采样法](@entry_id:142402)仅需CDF满足其基本定义，就能精确、无偏地对连续、离散及[混合分布](@entry_id:276506)进行采样，是[蒙特卡洛](@entry_id:144354)工具箱中不可或缺的基石。

### 从单条历史到[统计估计](@entry_id:270031)

[蒙特卡洛模拟](@entry_id:193493)的目标不是复现单条粒子历史，而是通过模拟大量历史来估计宏观物理量的[期望值](@entry_id:150961)。

#### 期望与样本均值

在模拟中，我们感兴趣的物理量，如反应堆某区域的反应率或通量，被建模为一个**计数 (tally)**。从数学上看，这是一个定义在粒子历史[样本空间](@entry_id:275301)上的可测函数（[随机变量](@entry_id:195330)）$X:\Omega \to \mathbb{R}$。我们真正想求的，是这个[随机变量](@entry_id:195330)的**理论期望** $E[X]$。根据[测度论](@entry_id:139744)，这个期望是一个通过[勒贝格积分](@entry_id:140189)定义的**确定性数值**：
$E[X] = \int_{\Omega} X(\omega) d\mathbb{P}(\omega)$

然而，我们无法直接计算这个积分。我们能做的是，通过模拟生成 $n$ 条独立的粒子历史 $\omega_1, \dots, \omega_n$，计算每条历史对应的计数值 $X_1=X(\omega_1), \dots, X_n=X(\omega_n)$，然后构造**样本均值**：
$\bar{X}_n = \frac{1}{n} \sum_{i=1}^n X_i$

与 $E[X]$ 不同，$\bar{X}_n$ 本身是一个**[随机变量](@entry_id:195330)**，它的值依赖于具体生成的 $n$ 条历史。

#### [极限定理](@entry_id:188579)：收敛性与置信区间

样本均值 $\bar{X}_n$ 与理论期望 $E[X]$ 之间的桥梁由[概率论中的极限定理](@entry_id:267447)构建。

**大数定律 (Law of Large Numbers)** 保证了估计的收敛性。Kolmogorov 的**强大数定律 (SLLN)** 指出，如果历史是[独立同分布](@entry_id:169067)的 (i.i.d.)，且期望 $E[|X|]$ 有限，那么当模拟的历史数 $n \to \infty$ 时，样本均值会**[几乎必然](@entry_id:262518)**收敛到理论期望：
$\bar{X}_n \to E[X] \quad (\text{a.s.})$
这是[蒙特卡洛方法](@entry_id:136978)作为一种有效的[数值积分方法](@entry_id:141406)的理论基石。

**中心极限定理 (Central Limit Theorem, CLT)** 描述了[估计误差](@entry_id:263890)的分布特征，是评估统计不确定性的基础。在不同模拟场景下，CLT有不同的形式：

1.  **经典 i.i.d. 情形**：在[固定源问题](@entry_id:1125046)中，每次模拟的粒子历史通常是[独立同分布](@entry_id:169067)的。如果单次历史的计数值 $X_i$ 具有有限的均值 $\mu=E[X]$ 和方差 $\sigma^2 = \operatorname{Var}(X)$，则根据 Lindeberg-Lévy CLT，标准化的样本均值在 $n \to \infty$ 时[依分布收敛](@entry_id:275544)于[标准正态分布](@entry_id:184509)：
    $\sqrt{n}(\bar{X}_n - \mu) \Rightarrow N(0, \sigma^2)$
    这使得我们可以利用样本方差 $S_n^2 = \frac{1}{n-1}\sum_{i=1}^n (X_i - \bar{X}_n)^2$ 来构造近似的 $(1-\alpha)$ **[置信区间](@entry_id:142297)**，如 $\bar{X}_n \pm z_{\alpha/2} \frac{S_n}{\sqrt{n}}$。

2.  **相关序列情形 (MCMC)**：在[临界计算](@entry_id:1123193)（$k_{\text{eff}}$ 计算）中，每一代的中子源都来自于上一代，这导致各代之间的计数值 $Z_m$ 存在[自相关](@entry_id:138991)。此时，$\{{Z_m}\}$ 构成一个马尔可夫链。如果该链满足一定的混合条件（如[几何遍历性](@entry_id:191361)），且 $E[Z_m^2]  \infty$，则CLT仍然成立，但其[渐近方差](@entry_id:269933)变为**长程方差** $\sigma^2_M$：
    $\sqrt{n}(\bar{Z}_n - \mu) \Rightarrow N(0, \sigma^2_M)$
    其中 $\sigma^2_M = \operatorname{Var}(Z_0) + 2\sum_{k=1}^\infty \operatorname{Cov}(Z_0, Z_k)$。这个方差包含了所有[自协方差](@entry_id:270483)项的贡献。在这种情况下，使用简单的样本方差会严重低估真实的不确定性。

3.  **非同分布情形**：在某些自适应算法或复杂的方差缩减方案中，每次历史的计数值 $X_{n,i}$ 可能独立但非同分布。此时，如果满足 Lyapunov 条件，一个更广义的CLT仍然适用，保证了样本均值的[渐近正态性](@entry_id:168464)。

4.  **[无限方差](@entry_id:637427)情形**：如果由于某些不当的[方差缩减技术](@entry_id:141433)导致计数值的方差为无限大，则经典CLT失效。样本均值的[极限分布](@entry_id:174797)不再是正态分布，而是其他类型的[稳定分布](@entry_id:194434)，常规的[置信区间](@entry_id:142297)构造方法也随之失效。

### 高级采样与估计专题

为了提高[计算效率](@entry_id:270255)和处理复杂问题，我们需要更高级的理论工具。

#### 相关数据的[方差估计](@entry_id:268607)：批平均法

如前所述，在 $k_{\text{eff}}$ [临界计算](@entry_id:1123193)中，由于代际相关性，直接使用样本方差公式是错误的。**批平均法 (Batch Means Method)** 是一种有效估计长程方差 $\sigma^2_M$ 的标准技术。

该方法的基本思想是：将总共 $M$ 代的 correlated 数据序列 $\{X_i\}$ 分成 $b$ 个不重叠的、长度为 $m$ 的“批次” ($M=bm$)。然后计算每个批次的均值 $\bar{X}_j = \frac{1}{m}\sum_{i=(j-1)m+1}^{jm} X_i$。如果批次长度 $m$ 足够大（远大于序列的相关长度），那么这些批平均值 $\{\bar{X}_j\}$ 将近似地变得不相关且同分布。

这样，我们就可以将这 $b$ 个批平均值当作一个 i.i.d. 样本，并使用标准统计方法来估计它们的均值（即总均值 $\bar{X}_M$）的方差：
$\hat{\operatorname{Var}}(\bar{X}_M) \approx \frac{s^2_{\bar{X}}}{b} = \frac{1}{b(b-1)} \sum_{j=1}^b (\bar{X}_j - \bar{X}_M)^2$
这个估计量在 $m \to \infty$ 和 $b \to \infty$ 的条件下可以一致地估计出真实的 $\operatorname{Var}(\bar{X}_M)$。批平均法通过将相关性“内化”到每个批次内部，从而在批次之间恢复了独立性，为构造可靠的[置信区间](@entry_id:142297)提供了可能。

#### 改变随机行走：重要性采样与细致平衡

除了处理输出数据，我们还可以主动修改粒子的随机行走过程来提高模拟效率，这类技术统称为**方差缩减**。

**[重要性采样](@entry_id:145704) (Importance Sampling)** 是一种核心的[方差缩减](@entry_id:145496)思想。其原理是，我们不从原始的物理[概率测度](@entry_id:190821) $\mathbb{P}$ 进行采样，而是从一个经过精心设计的、偏置的[概率测度](@entry_id:190821) $\mathbb{Q}$ 进行采样，这个测度会引导粒子更多地进入对我们关心的计数贡献大的相空间区域。为了修正引入的偏置，每当做出一个基于 $\mathbb{Q}$ 的随机选择时，都必须给粒子乘上一个权重因子。对于整个历史 $\omega$，其总权重 $W(\omega)$ 等于原始概率与偏置概率之比，即 Radon-Nikodym 导数 $W = d\mathbb{P}/d\mathbb{Q}$。此时，我们估计的量变为加权样本均值 $\bar{Y}_n = \frac{1}{n} \sum_{i=1}^n W_i X_i$。可以证明，这个加权估计量是无偏的：
$\mathbb{E}_{\mathbb{Q}}[\bar{Y}_n] = \mathbb{E}_{\mathbb{Q}}[WX] = \int_\Omega (WX) d\mathbb{Q} = \int_\Omega X d\mathbb{P} = \mathbb{E}_{\mathbb{P}}[X]$

**粒子分裂 (Splitting)** 与 **[俄罗斯轮盘赌](@entry_id:1131153) (Russian Roulette)** 是[重要性采样](@entry_id:145704)的具体应用。当粒子进入重要区域时，将其分裂成多个权重较低的副本；当粒子进入不重要区域时，以一定概率杀死它，并将其权重赋给存活下来的粒子。只要保证权重的期望守恒，最终的加权计数仍然是无偏的。

**[马尔可夫链蒙特卡洛 (MCMC)](@entry_id:137985)** 与 **[细致平衡](@entry_id:145988) (Detailed Balance)** 为设计更通用的采样算法提供了理论框架。假设我们希望从一个目标概率密度 $S(x)$ 进行采样，但直接采样很困难。MCMC 的思想是构建一个[马尔可夫链](@entry_id:150828)，使其[平稳分布](@entry_id:194199)恰好是 $S(x)$。Metropolis-Hastings 算法是实现这一目标的通用方法。

该算法通过“提议-接受/拒绝”机制来构建转移核 $P(x,y)$。从当前状态 $x$，我们根据一个易于采样的提议核 $q(x,y)$ 提议一个新状态 $y$。然后，以一定的[接受概率](@entry_id:138494) $\alpha(x,y)$ 接受这个转移，否则停留在原状态 $x$。这个[接受概率](@entry_id:138494)被设计为：
$\alpha(x,y) = \min\left\{1, \frac{S(y)q(y,x)}{S(x)q(x,y)}\right\}$

这种构造确保了转移核满足**[细致平衡条件](@entry_id:265158)**：
$S(x)P(x,y) = S(y)P(y,x)$

满足细致平衡是[马尔可夫链](@entry_id:150828)具有[平稳分布](@entry_id:194199) $S(x)$ 的一个充分条件。这为我们设计能够探索复杂相空间并最终收敛到目标物理分布（如[基频](@entry_id:268182)[裂变源分布](@entry_id:1125036)）的高级[采样策略](@entry_id:188482)提供了坚实的理论基础。值得注意的是，标准的[中子输运](@entry_id:159564)幂迭代法本身满足[平稳性条件](@entry_id:191085)，但通常不满足[细致平衡条件](@entry_id:265158)。MCMC 框架则为超越传统方法提供了更广阔的思路。