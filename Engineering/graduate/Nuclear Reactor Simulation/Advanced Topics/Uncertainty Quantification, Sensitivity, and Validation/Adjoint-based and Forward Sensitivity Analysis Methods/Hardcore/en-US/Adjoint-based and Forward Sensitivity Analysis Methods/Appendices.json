{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a direct application of adjoint-based first-order perturbation theory. By using pre-computed forward and adjoint flux solutions, we can focus on the central principle: how the adjoint function acts as an importance-weighted measure to quantify the effect of a local parameter perturbation on a global response. This practice solidifies the physical interpretation of the adjoint flux and the mechanics of evaluating the core sensitivity integral .",
            "id": "4213547",
            "problem": "A one-dimensional steady-state two-group neutron diffusion model is considered on a nondimensional slab domain $x \\in [0,1]$ with vacuum boundary conditions. The neutron balance in each energy group is governed by the multigroup diffusion equations derived from conservation of particles and Fickâ€™s law for diffusion: the loss by leakage and absorption balances the gain from in-scattering and external sources. Specifically, the forward state $\\{\\phi_{g}(x)\\}_{g=1}^{2}$ satisfies a linear operator equation of the form\n$$\n\\mathcal{L}(\\boldsymbol{p})\\,\\boldsymbol{\\phi} = \\boldsymbol{q},\n$$\nwhere $\\boldsymbol{\\phi} = (\\phi_{1},\\phi_{2})^{\\top}$ is the vector of group fluxes, $\\boldsymbol{q} = (q_{1},q_{2})^{\\top}$ is the external source vector, and $\\boldsymbol{p}$ denotes the set of material parameters including the group absorption cross sections $\\Sigma_{a,1}(x)$ and $\\Sigma_{a,2}(x)$, diffusion coefficients $D_{1}(x)$ and $D_{2}(x)$, and scattering cross sections $\\Sigma_{s,1\\to 2}(x)$ and $\\Sigma_{s,2\\to 1}(x)$. The operator $\\mathcal{L}(\\boldsymbol{p})$ encapsulates leakage terms $-\\frac{d}{dx}\\left(D_{g}(x)\\frac{d \\phi_{g}}{dx}\\right)$, absorption terms $\\Sigma_{a,g}(x)\\phi_{g}$, and intergroup scattering terms.\n\nThe performance metric of interest is the nondimensional region-integrated power over a response region $\\Omega_{R} \\subset [0,1]$, defined as\n$$\nP_{R}(\\boldsymbol{\\phi}) = \\int_{\\Omega_{R}} \\sum_{g=1}^{2} \\alpha_{g}\\,\\phi_{g}(x)\\,dx,\n$$\nwhere $\\alpha_{g} > 0$ are fixed group-wise weights proportional to the energy released per fission and effective fission production in group $g$. For this problem, take $\\Omega_{R} = [0.25,0.50]$, $\\alpha_{1} = 0.30$, and $\\alpha_{2} = 1.00$.\n\nA small localized perturbation is applied to the group-$2$ absorption cross section, $\\Sigma_{a,2}(x)$, within the perturbation subregion $\\Omega_{p} = [0.40,0.50]$, while all other material parameters remain fixed. Assume that the forward state $\\boldsymbol{\\phi}$ and the corresponding adjoint state $\\boldsymbol{\\psi} = (\\psi_{1},\\psi_{2})^{\\top}$ associated with the response $P_{R}$ have been solved for the unperturbed configuration and are provided. The adjoint state is defined by the adjoint operator equation\n$$\n\\mathcal{L}^{\\dagger}(\\boldsymbol{p})\\,\\boldsymbol{\\psi} = \\boldsymbol{r},\n$$\nwhere $\\boldsymbol{r}(x)$ is the response weighting vector such that $P_{R}(\\boldsymbol{\\phi}) = \\left\\langle \\boldsymbol{r},\\boldsymbol{\\phi}\\right\\rangle$ with the standard $L^{2}$ inner product over the domain and $\\mathcal{L}^{\\dagger}$ denotes the adjoint of $\\mathcal{L}$ under the same inner product. For the given response, $\\boldsymbol{r}(x)$ has entries $r_{g}(x) = \\alpha_{g}\\,\\chi_{\\Omega_{R}}(x)$, where $\\chi_{\\Omega_{R}}(x)$ is the indicator function of $\\Omega_{R}$.\n\nOn the perturbation subregion $\\Omega_{p}$, the provided nondimensional forward and adjoint solutions are constant and equal to\n$$\n\\phi_{2}(x) = 0.75 \\quad \\text{for all } x \\in \\Omega_{p}, \\qquad \\psi_{2}(x) = 1.80 \\quad \\text{for all } x \\in \\Omega_{p}.\n$$\nOutside $\\Omega_{p}$, the values of $\\phi_{2}(x)$ and $\\psi_{2}(x)$ are not needed for this calculation. The group-$1$ solutions are not required because only $\\Sigma_{a,2}$ is perturbed.\n\nUsing adjoint-based first-order perturbation theory grounded in the linearity of the forward operator and the definition of the adjoint problem for the given response, derive from first principles the sensitivity of the nondimensional region-integrated power $P_{R}$ to a small uniform perturbation $\\delta \\Sigma_{a,2}$ applied only on $\\Omega_{p}$. Then, compute the numerical value of the sensitivity coefficient\n$$\nS_{2} \\equiv \\frac{dP_{R}}{d\\Sigma_{a,2}\\big|_{\\Omega_{p}}},\n$$\nusing the provided forward and adjoint solutions. Report your final numerical answer rounded to four significant figures. The sensitivity is nondimensional due to the nondimensionalization of all variables. Finally, interpret the sign of $S_{2}$ in physical terms, based on the underlying neutron balance.",
            "solution": "The problem requires the derivation and computation of the sensitivity of a region-integrated power response, $P_{R}$, to a localized perturbation in the group-2 absorption cross section, $\\Sigma_{a,2}$, using adjoint-based first-order perturbation theory.\n\nFirst, we derive the general expression for the sensitivity. The system is described by the linear forward operator equation:\n$$\n\\mathcal{L}(\\boldsymbol{p})\\,\\boldsymbol{\\phi} = \\boldsymbol{q}\n$$\nwhere $\\boldsymbol{\\phi}$ is the neutron flux vector, $\\boldsymbol{p}$ is the set of material parameters, $\\boldsymbol{q}$ is the external source vector, and $\\mathcal{L}$ is the two-group neutron diffusion operator. A small perturbation in the parameters, $\\boldsymbol{p} \\to \\boldsymbol{p} + \\delta\\boldsymbol{p}$, induces a change in the operator, $\\mathcal{L} \\to \\mathcal{L} + \\delta\\mathcal{L}$, and a corresponding change in the flux, $\\boldsymbol{\\phi} \\to \\boldsymbol{\\phi} + \\delta\\boldsymbol{\\phi}$. The perturbed system is described by:\n$$\n(\\mathcal{L} + \\delta\\mathcal{L})(\\boldsymbol{\\phi} + \\delta\\boldsymbol{\\phi}) = \\boldsymbol{q}\n$$\nExpanding this equation gives:\n$$\n\\mathcal{L}\\boldsymbol{\\phi} + \\mathcal{L}\\delta\\boldsymbol{\\phi} + \\delta\\mathcal{L}\\boldsymbol{\\phi} + \\delta\\mathcal{L}\\delta\\boldsymbol{\\phi} = \\boldsymbol{q}\n$$\nSubtracting the unperturbed equation $\\mathcal{L}\\boldsymbol{\\phi} = \\boldsymbol{q}$ and neglecting the second-order term $\\delta\\mathcal{L}\\delta\\boldsymbol{\\phi}$ yields the first-order approximation for the flux perturbation:\n$$\n\\mathcal{L}\\delta\\boldsymbol{\\phi} \\approx -\\delta\\mathcal{L}\\boldsymbol{\\phi}\n$$\nThe response of interest is the integrated power $P_{R}$, which is a linear functional of the flux:\n$$\nP_{R}(\\boldsymbol{\\phi}) = \\left\\langle \\boldsymbol{r}, \\boldsymbol{\\phi} \\right\\rangle = \\int_{0}^{1} \\boldsymbol{r}^{\\top}(x)\\boldsymbol{\\phi}(x)\\,dx\n$$\nThe perturbation in the response, $\\delta P_{R}$, is given by:\n$$\n\\delta P_{R} = P_{R}(\\boldsymbol{\\phi} + \\delta\\boldsymbol{\\phi}) - P_{R}(\\boldsymbol{\\phi}) = P_{R}(\\delta\\boldsymbol{\\phi}) = \\left\\langle \\boldsymbol{r}, \\delta\\boldsymbol{\\phi} \\right\\rangle\n$$\nThe adjoint problem is defined by $\\mathcal{L}^{\\dagger}\\boldsymbol{\\psi} = \\boldsymbol{r}$, where $\\mathcal{L}^{\\dagger}$ is the adjoint of $\\mathcal{L}$ with respect to the inner product $\\left\\langle \\cdot, \\cdot \\right\\rangle$. The defining property of the adjoint operator is $\\left\\langle \\mathcal{L}^{\\dagger}\\boldsymbol{u}, \\boldsymbol{v} \\right\\rangle = \\left\\langle \\boldsymbol{u}, \\mathcal{L}\\boldsymbol{v} \\right\\rangle$ for any functions $\\boldsymbol{u}, \\boldsymbol{v}$ in the appropriate space.\nUsing the adjoint equation and this property, we can rewrite $\\delta P_{R}$:\n$$\n\\delta P_{R} = \\left\\langle \\boldsymbol{r}, \\delta\\boldsymbol{\\phi} \\right\\rangle = \\left\\langle \\mathcal{L}^{\\dagger}\\boldsymbol{\\psi}, \\delta\\boldsymbol{\\phi} \\right\\rangle = \\left\\langle \\boldsymbol{\\psi}, \\mathcal{L}\\delta\\boldsymbol{\\phi} \\right\\rangle\n$$\nSubstituting the first-order approximation for $\\mathcal{L}\\delta\\boldsymbol{\\phi}$:\n$$\n\\delta P_{R} \\approx \\left\\langle \\boldsymbol{\\psi}, -\\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle = -\\left\\langle \\boldsymbol{\\psi}, \\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle\n$$\nThis is the general formula from first-order perturbation theory. Now, we must specify the operator perturbation $\\delta\\mathcal{L}$ for the given problem. The perturbation is a uniform change $\\delta\\Sigma_{a,2}$ to the group-2 absorption cross section $\\Sigma_{a,2}(x)$ confined to the subregion $\\Omega_{p} = [0.40, 0.50]$. The absorption term for group $2$ in the forward equation is $\\Sigma_{a,2}(x)\\phi_{2}(x)$. A perturbation $\\delta\\Sigma_{a,2}(x)$ thus changes the operator $\\mathcal{L}$ such that its application to $\\boldsymbol{\\phi}$ results in an added term. The operator perturbation $\\delta\\mathcal{L}$ acts on the flux vector $\\boldsymbol{\\phi}$ as:\n$$\n\\delta\\mathcal{L}\\boldsymbol{\\phi} = \\begin{pmatrix} 0 \\\\ \\delta\\Sigma_{a,2}(x)\\phi_{2}(x) \\end{pmatrix}\n$$\nIn this case, $\\delta\\Sigma_{a,2}(x) = \\delta\\Sigma_{a,2} \\cdot \\chi_{\\Omega_{p}}(x)$, where $\\chi_{\\Omega_{p}}(x)$ is the indicator function for the region $\\Omega_{p}$ and $\\delta\\Sigma_{a,2}$ is the constant magnitude of the perturbation.\n\nWe now evaluate the inner product $\\left\\langle \\boldsymbol{\\psi}, \\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle$:\n$$\n\\left\\langle \\boldsymbol{\\psi}, \\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle = \\int_{0}^{1} \\boldsymbol{\\psi}^{\\top}(x) (\\delta\\mathcal{L}\\boldsymbol{\\phi})(x) \\,dx = \\int_{0}^{1} \\begin{pmatrix} \\psi_{1}(x) & \\psi_{2}(x) \\end{pmatrix} \\begin{pmatrix} 0 \\\\ \\delta\\Sigma_{a,2}(x)\\phi_{2}(x) \\end{pmatrix} \\,dx\n$$\n$$\n\\left\\langle \\boldsymbol{\\psi}, \\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle = \\int_{0}^{1} \\psi_{2}(x) \\phi_{2}(x) \\delta\\Sigma_{a,2}(x) \\,dx = \\int_{\\Omega_{p}} \\psi_{2}(x) \\phi_{2}(x) \\delta\\Sigma_{a,2} \\,dx\n$$\nSince $\\delta\\Sigma_{a,2}$ is constant over $\\Omega_{p}$, we have:\n$$\n\\left\\langle \\boldsymbol{\\psi}, \\delta\\mathcal{L}\\boldsymbol{\\phi} \\right\\rangle = \\delta\\Sigma_{a,2} \\int_{\\Omega_{p}} \\psi_{2}(x) \\phi_{2}(x) \\,dx\n$$\nThe perturbation in the response is therefore:\n$$\n\\delta P_{R} \\approx -\\delta\\Sigma_{a,2} \\int_{\\Omega_{p}} \\psi_{2}(x) \\phi_{2}(x) \\,dx\n$$\nThe sensitivity coefficient $S_{2}$ is defined as the derivative of $P_{R}$ with respect to the perturbation magnitude $\\Sigma_{a,2}$ on $\\Omega_{p}$. This is obtained by dividing $\\delta P_{R}$ by $\\delta\\Sigma_{a,2}$ in the limit that $\\delta\\Sigma_{a,2} \\to 0$:\n$$\nS_{2} \\equiv \\frac{dP_{R}}{d\\Sigma_{a,2}\\big|_{\\Omega_{p}}} = \\lim_{\\delta\\Sigma_{a,2}\\to 0} \\frac{\\delta P_{R}}{\\delta\\Sigma_{a,2}} = - \\int_{\\Omega_{p}} \\psi_{2}(x) \\phi_{2}(x) \\,dx\n$$\nThis is the derived expression for the sensitivity coefficient.\n\nTo compute the numerical value, we use the provided data. On the perturbation subregion $\\Omega_{p} = [0.40, 0.50]$, the forward and adjoint fluxes are constant:\n$$\n\\phi_{2}(x) = 0.75 \\quad \\text{for } x \\in \\Omega_{p}\n$$\n$$\n\\psi_{2}(x) = 1.80 \\quad \\text{for } x \\in \\Omega_{p}\n$$\nSubstituting these values into the expression for $S_{2}$:\n$$\nS_{2} = - \\int_{0.40}^{0.50} (1.80)(0.75) \\,dx\n$$\nSince the integrand is constant, we can pull it out of the integral:\n$$\nS_{2} = - (1.80)(0.75) \\int_{0.40}^{0.50} dx = - (1.80)(0.75) (0.50 - 0.40)\n$$\n$$\nS_{2} = - (1.35)(0.10) = -0.135\n$$\nThe problem requires the answer to be rounded to four significant figures. Thus, $S_{2} = -0.1350$.\n\nFinally, we interpret the sign of $S_{2}$. The sensitivity is negative. This indicates that an increase in the group-$2$ absorption cross section, $\\delta\\Sigma_{a,2} > 0$, will cause a decrease in the integrated power response, $\\delta P_{R}  0$. This is physically consistent. The absorption cross section $\\Sigma_{a,2}$ quantifies the rate at which group-$2$ neutrons are removed from the system by absorption. Increasing this cross section enhances neutron absorption, thereby reducing the population of group-$2$ neutrons, which is measured by the flux $\\phi_2(x)$. The response $P_{R}$ is defined as a positively weighted integral of the fluxes. A decrease in $\\phi_{2}$ (and any other fluxes coupled to it) will therefore lead to a decrease in $P_{R}$. The adjoint flux, $\\psi_{2}(x)$, represents the \"importance\" of a group-$2$ neutron at position $x$ to the response $P_{R}$. Since both the flux and the importance are physically non-negative quantities, their product is non-negative. The negative sign in the sensitivity formula is a direct consequence of absorption being a loss mechanism for neutrons.",
            "answer": "$$\\boxed{-0.1350}$$"
        },
        {
            "introduction": "Theoretical derivations in continuous space often possess elegant symmetries that can be broken by numerical discretization. This exercise demonstrates this crucial concept by examining the discrete operator resulting from an upwind finite-volume scheme, a common choice for transport problems . By deriving the operator matrix and explicitly showing its non-self-adjoint nature, you will gain a deeper understanding of why the discrete adjoint operator is not merely the operator's transpose and how directional physical phenomena are represented in numerical models.",
            "id": "4213510",
            "problem": "Consider a monoenergetic, steady-state, one-dimensional slab transport problem of thickness $L$ with vacuum boundary conditions at $x=0$ and $x=L$. The governing linear Boltzmann transport equation in angle $ \\mu \\in [-1,1] $ is\n$$\n\\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\psi(x,\\mu) = q(x,\\mu),\n$$\nwith total macroscopic cross section $\\Sigma_{t}  0$. There is no scattering. Discretize the angular variable using the two-point $S_2$ Discrete Ordinates ($S_N$) method with ordinates $\\mu_{1} = \\frac{1}{\\sqrt{3}}$, $\\mu_{2} = -\\frac{1}{\\sqrt{3}}$, and quadrature weights $w_{1} = 1$, $w_{2} = 1$. Discretize the spatial domain into $N=2$ uniform cells of width $h = \\frac{L}{2}$, and use a first-order upwind finite-volume scheme for the streaming term with cell-averaged unknowns $\\psi_{i}^{(m)}$ for cell index $i \\in \\{1,2\\}$ and ordinate index $m \\in \\{1,2\\}$.\n\n1. Starting from the finite-volume balance over each cell and enforcing vacuum boundary conditions on incoming angular flux, derive the $4 \\times 4$ discrete operator matrix $L$ that maps the vector of unknowns\n$$\n\\Psi \\equiv \\begin{pmatrix} \\psi_{1}^{(+)} \\\\ \\psi_{2}^{(+)} \\\\ \\psi_{1}^{(-)} \\\\ \\psi_{2}^{(-)} \\end{pmatrix}\n$$\nto the cell-averaged, angle-discrete source vector\n$$\nQ \\equiv \\begin{pmatrix} q_{1}^{(+)} \\\\ q_{2}^{(+)} \\\\ q_{1}^{(-)} \\\\ q_{2}^{(-)} \\end{pmatrix}\n$$\nvia $L \\Psi = Q$, where $(+)$ denotes $\\mu = \\mu_{1} = \\frac{1}{\\sqrt{3}}$ and $(-)$ denotes $\\mu = \\mu_{2} = -\\frac{1}{\\sqrt{3}}$. Express $L$ symbolically in terms of $h$, $\\Sigma_{t}$, and $\\mu$.\n\n2. Define the discrete inner product induced by the Discrete Ordinates ($S_N$) quadrature and finite volumes as\n$$\n\\langle u, v \\rangle_{W} \\equiv u^{\\top} W v, \\quad W \\equiv \\operatorname{diag}(w_{1} h, w_{1} h, w_{2} h, w_{2} h).\n$$\nThe discrete operator $L$ is self-adjoint with respect to $\\langle \\cdot, \\cdot \\rangle_{W}$ if and only if $W L = L^{\\top} W$. Consider the bilinear form\n$$\n\\delta(u,v) \\equiv u^{\\top} (W L - L^{\\top} W) v.\n$$\nChoose $u = e_{2}$ and $v = e_{1}$, where $e_{k}$ is the $k$-th standard basis vector in $\\mathbb{R}^{4}$ aligned with the ordering in $\\Psi$ above. Using the upwind-discretized operator $L$ you derived, compute the scalar $\\delta(u,v)$ for the case $h = 1$ and $\\Sigma_{t} = \\frac{1}{2}$.\n\n3. Briefly explain, based on the sign and magnitude of the computed $\\delta(u,v)$, how upwind discretization yields a non-self-adjoint discrete operator and thereby breaks the equivalence between the continuous adjoint and the discrete adjoint obtained by transposition under the discrete inner product.\n\nGive your final answer as the numerical value of $\\delta(u,v)$ rounded to four significant figures, with no units. The explanation should make clear which specific off-diagonal coupling generated the nonzero value, but only the scalar value is to be reported as the final answer.",
            "solution": "The problem is evaluated to be scientifically sound, well-posed, and objective. It is a standard problem in numerical transport theory that tests the derivation and properties of a discretized operator. We may proceed with the solution.\n\nThe solution is divided into three parts as requested by the problem statement.\n\nPart 1: Derivation of the discrete operator matrix $L$.\n\nThe one-dimensional steady-state linear Boltzmann transport equation is given by:\n$$ \\mu \\frac{\\partial \\psi(x,\\mu)}{\\partial x} + \\Sigma_{t} \\psi(x,\\mu) = q(x,\\mu) $$\nWe discretize this equation using a finite-volume method on a uniform grid with two cells, $i=1$ and $i=2$, of width $h = \\frac{L}{2}$. The cells cover the domains $[0, h]$ and $[h, 2h]$, respectively. Integrating the transport equation over cell $i$ (from $x_{i-1/2}$ to $x_{i+1/2}$) yields the balance equation:\n$$ \\int_{x_{i-1/2}}^{x_{i+1/2}} \\left( \\mu \\frac{\\partial \\psi}{\\partial x} + \\Sigma_{t} \\psi \\right) dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} q \\, dx $$\nApplying the divergence theorem to the streaming term and dividing by the cell width $h$ gives:\n$$ \\frac{\\mu}{h} \\left( \\psi_{i+1/2} - \\psi_{i-1/2} \\right) + \\Sigma_{t} \\psi_{i} = q_{i} $$\nHere, $\\psi_i$ and $q_i$ are the cell-averaged angular flux and source, respectively, and $\\psi_{i\\pm1/2}$ are the angular fluxes at the cell interfaces.\n\nThe first-order upwind scheme approximates the interface flux with the cell-averaged flux from the upwind cell. The direction of \"upwind\" depends on the sign of the angular variable $\\mu$.\n\nAngular discretization is performed using the $S_2$ method with ordinates $\\mu_1 = 1/\\sqrt{3}  0$ and $\\mu_2 = -1/\\sqrt{3}  0$, and weights $w_1=w_2=1$. We use the notation $\\psi^{(+)}$ for the flux in direction $\\mu_1$ and $\\psi^{(-)}$ for the flux in direction $\\mu_2$.\n\nCase 1: Positive ordinate $\\mu = \\mu_1  0$ (direction denoted by $(+)$).\nThe particle flow is from left to right.\nFor cell $i=1$ (domain $[0, h]$):\nThe balance equation is $\\frac{\\mu_1}{h} ( \\psi_{3/2}^{(+)} - \\psi_{1/2}^{(+)} ) + \\Sigma_t \\psi_1^{(+)} = q_1^{(+)}$.\nThe interfaces are at $x_{1/2}=0$ and $x_{3/2}=h$.\nThe upwind approximation for the exiting flux at $x_{3/2}=h$ is $\\psi_{3/2}^{(+)} \\approx \\psi_1^{(+)}$.\nThe vacuum boundary condition at $x=0$ implies zero incoming flux, so $\\psi_{1/2}^{(+)} = 0$.\nSubstituting these into the balance equation gives:\n$$ \\frac{\\mu_1}{h} (\\psi_1^{(+)} - 0) + \\Sigma_t \\psi_1^{(+)} = q_1^{(+)} \\implies \\left(\\frac{\\mu_1}{h} + \\Sigma_t\\right) \\psi_1^{(+)} = q_1^{(+)} $$\n\nFor cell $i=2$ (domain $[h, 2h]$):\nThe balance equation is $\\frac{\\mu_1}{h} ( \\psi_{5/2}^{(+)} - \\psi_{3/2}^{(+)} ) + \\Sigma_t \\psi_2^{(+)} = q_2^{(+)}$.\nThe interfaces are at $x_{3/2}=h$ and $x_{5/2}=2h=L$.\nThe upwind approximation for the exiting flux at $x_{5/2}=L$ is $\\psi_{5/2}^{(+)} \\approx \\psi_2^{(+)}$.\nThe upwind approximation for the incoming flux at $x_{3/2}=h$ is $\\psi_{3/2}^{(+)} \\approx \\psi_1^{(+)}$.\nSubstituting these gives:\n$$ \\frac{\\mu_1}{h} (\\psi_2^{(+)} - \\psi_1^{(+)}) + \\Sigma_t \\psi_2^{(+)} = q_2^{(+)} \\implies -\\frac{\\mu_1}{h} \\psi_1^{(+)} + \\left(\\frac{\\mu_1}{h} + \\Sigma_t\\right) \\psi_2^{(+)} = q_2^{(+)} $$\n\nCase 2: Negative ordinate $\\mu = \\mu_2  0$ (direction denoted by $(-)$).\nThe particle flow is from right to left. Note that $\\mu_2 = -\\mu_1$.\nFor cell $i=2$ (domain $[h, 2h]$):\nThe balance equation is $\\frac{\\mu_2}{h} ( \\psi_{5/2}^{(-)} - \\psi_{3/2}^{(-)} ) + \\Sigma_t \\psi_2^{(-)} = q_2^{(-)}$.\nThe vacuum boundary condition at $x=L=2h$ implies zero incoming flux, so $\\psi_{5/2}^{(-)} = 0$.\nThe upwind approximation for the exiting flux at $x_{3/2}=h$ is $\\psi_{3/2}^{(-)} \\approx \\psi_2^{(-)}$.\nSubstituting these gives:\n$$ \\frac{\\mu_2}{h} (0 - \\psi_2^{(-)}) + \\Sigma_t \\psi_2^{(-)} = q_2^{(-)} \\implies \\left(-\\frac{\\mu_2}{h} + \\Sigma_t\\right) \\psi_2^{(-)} = q_2^{(-)} $$\nUsing $\\mu_2 = -\\mu_1$, this becomes $\\left(\\frac{\\mu_1}{h} + \\Sigma_t\\right) \\psi_2^{(-)} = q_2^{(-)}$.\n\nFor cell $i=1$ (domain $[0, h]$):\nThe balance equation is $\\frac{\\mu_2}{h} ( \\psi_{3/2}^{(-)} - \\psi_{1/2}^{(-)} ) + \\Sigma_t \\psi_1^{(-)} = q_1^{(-)}$.\nThe upwind approximation for incoming flux at $x_{3/2}=h$ is $\\psi_{3/2}^{(-)} \\approx \\psi_2^{(-)}$.\nThe upwind approximation for exiting flux at $x_{1/2}=0$ is $\\psi_{1/2}^{(-)} \\approx \\psi_1^{(-)}$.\nSubstituting these gives:\n$$ \\frac{\\mu_2}{h} (\\psi_2^{(-)} - \\psi_1^{(-)}) + \\Sigma_t \\psi_1^{(-)} = q_1^{(-)} \\implies \\left(-\\frac{\\mu_2}{h} + \\Sigma_t\\right) \\psi_1^{(-)} + \\frac{\\mu_2}{h} \\psi_2^{(-)} = q_1^{(-)} $$\nUsing $\\mu_2 = -\\mu_1$, this becomes $\\left(\\frac{\\mu_1}{h} + \\Sigma_t\\right) \\psi_1^{(-)} - \\frac{\\mu_1}{h} \\psi_2^{(-)} = q_1^{(-)}$.\n\nWe now assemble these four equations into the matrix system $L\\Psi = Q$, with the specified ordering of unknowns $\\Psi = [\\psi_{1}^{(+)}, \\psi_{2}^{(+)}, \\psi_{1}^{(-)}, \\psi_{2}^{(-)}]^{\\top}$ and sources $Q = [q_{1}^{(+)}, q_{2}^{(+)}, q_{1}^{(-)}, q_{2}^{(-)}]^{\\top}$. For clarity, let $\\mu$ represent $\\mu_1$ as suggested by the context of the problem statement. The matrix $L$ is:\n$$\nL = \\begin{pmatrix}\n\\frac{\\mu}{h} + \\Sigma_{t}  0  0  0 \\\\\n-\\frac{\\mu}{h}  \\frac{\\mu}{h} + \\Sigma_{t}  0  0 \\\\\n0  0  \\frac{\\mu}{h} + \\Sigma_{t}  -\\frac{\\mu}{h} \\\\\n0  0  0  \\frac{\\mu}{h} + \\Sigma_{t}\n\\end{pmatrix}\n$$\n\nPart 2: Computation of $\\delta(u,v)$.\n\nThe bilinear form measuring non-self-adjointness is $\\delta(u,v) = u^{\\top} (W L - L^{\\top} W) v$.\nWe are given $u = e_{2} = [0, 1, 0, 0]^{\\top}$ and $v = e_{1} = [1, 0, 0, 0]^{\\top}$.\nThe weight matrix $W$ is defined as $W = \\operatorname{diag}(w_{1} h, w_{1} h, w_{2} h, w_{2} h)$. With $w_1 = 1$ and $w_2 = 1$, this simplifies to $W = \\operatorname{diag}(h, h, h, h) = h I$, where $I$ is the $4 \\times 4$ identity matrix.\n\nThe expression for $\\delta(e_2, e_1)$ is the $(2,1)$ entry of the matrix $WL - L^\\top W$.\nLet's compute this matrix:\n$$ W L = (hI) L = h L $$\n$$ L^\\top W = L^\\top (hI) = h L^\\top $$\nSo, $WL - L^\\top W = h(L - L^\\top)$.\nSubstituting the matrix $L$ from Part 1 (with $\\mu=\\mu_1$):\n$$\nL - L^\\top = \\begin{pmatrix}\nA  0  0  0 \\\\ -B  A  0  0 \\\\ 0  0  A  -B \\\\ 0  0  0  A\n\\end{pmatrix} - \\begin{pmatrix}\nA  -B  0  0 \\\\ 0  A  0  0 \\\\ 0  0  A  0 \\\\ 0  0  -B  A\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  B  0  0 \\\\ -B  0  0  0 \\\\ 0  0  0  -B \\\\ 0  0  B  0\n\\end{pmatrix}\n$$\nwhere $A = \\frac{\\mu}{h} + \\Sigma_{t}$ and $B = \\frac{\\mu}{h}$.\nThen,\n$$ WL - L^\\top W = h(L - L^\\top) = h \\begin{pmatrix}\n0  \\frac{\\mu}{h}  0  0 \\\\ -\\frac{\\mu}{h}  0  0  0 \\\\ 0  0  0  -\\frac{\\mu}{h} \\\\ 0  0  \\frac{\\mu}{h}  0\n\\end{pmatrix}\n= \\begin{pmatrix}\n0  \\mu  0  0 \\\\ -\\mu  0  0  0 \\\\ 0  0  0  -\\mu \\\\ 0  0  \\mu  0\n\\end{pmatrix}\n$$\nThe quantity $\\delta(e_2, e_1)$ is the element in the second row and first column of this matrix, which is $(WL - L^\\top W)_{21}$.\n$$ \\delta(e_2, e_1) = -\\mu = -\\mu_1 $$\nThe calculation is performed for the case where $h=1$ and $\\Sigma_t=1/2$. The result $\\delta(e_2, e_1) = -\\mu_1$ is independent of both $h$ and $\\Sigma_t$.\nGiven $\\mu_1 = \\frac{1}{\\sqrt{3}}$, we have:\n$$ \\delta(e_2, e_1) = -\\frac{1}{\\sqrt{3}} \\approx -0.577350269... $$\nRounding to four significant figures, the value is $-0.5774$.\n\nPart 3: Explanation of non-self-adjointness.\n\nThe discrete operator $L$ is self-adjoint with respect to the inner product $\\langle \\cdot, \\cdot \\rangle_W$ if and only if $\\langle u, Lv \\rangle_W = \\langle Lu, v \\rangle_W$ for all vectors $u, v$. This is equivalent to the matrix condition $WL = L^\\top W$. The bilinear form $\\delta(u,v) = \\langle u, Lv \\rangle_W - \\langle Lu, v \\rangle_W$ is a direct measure of the failure of this condition.\n\nOur calculation in Part 2 yielded $\\delta(e_2, e_1) = -\\mu_1 \\neq 0$. This non-zero result demonstrates that $L$ is not a self-adjoint operator.\n\nThe physical and numerical origin of this non-self-adjointness lies in the upwind discretization of the streaming term $\\mu \\frac{\\partial \\psi}{\\partial x}$. The upwind scheme models the directional nature of particle transport by creating a non-symmetric stencil.\nLet's examine the specific term that produced the non-zero result.\n$\\delta(e_2, e_1) = (WL - L^{\\top}W)_{21} = h(L_{21} - L_{12})$.\nWe found from the derivation of $L$ that $L_{21} = -\\mu/h$ and $L_{12} = 0$.\nThe term $L_{21}$ represents the influence of the flux in cell $1$ ($\\psi_1^{(+)}$) on the particle balance in cell $2$ for the positive direction $\\mu  0$. This coupling arises because particles physically stream from cell $1$ to cell $2$.\nThe term $L_{12}$ would represent the influence of the flux in cell $2$ ($\\psi_2^{(+)}$) on the particle balance in cell $1$ for the same positive direction. The upwind scheme correctly sets this term to zero because, for $\\mu  0$, information does not flow backward from cell $2$ to cell $1$.\n\nThis inherent asymmetry ($L_{21} \\neq L_{12}$) in the discrete operator $L$ is a direct consequence of modeling a directional physical process. A symmetric operator ($L=L^\\top$) would imply that the influence of cell $1$ on cell $2$ is the same as cell $2$ on cell $1$, which contradicts the physics of transport. Since the weighting matrix $W$ is a scalar multiple of the identity ($W=hI$), the non-symmetry of $L$ directly leads to its non-self-adjointness ($L \\neq L^\\top \\implies L \\neq W^{-1}L^\\top W$).\n\nThe continuous adjoint operator for transport, $\\mathcal{L}^\\ast = -\\mu \\frac{\\partial}{\\partial x} + \\Sigma_t$, describes transport in the reverse direction $(-\\mu)$. The discrete adjoint operator $L^\\ast = W^{-1}L^\\top W$ is the correct discretization of this adjoint physics. The fact that $L \\neq L^\\ast$ is a crucial feature, ensuring that the discrete model distinguishes between forward and adjoint transport problems, an equivalence broken by the directional nature of the upwind scheme.\nThe computed value $\\delta(e_2,e_1) = -\\mu_1$ quantifies this broken symmetry for the specific interaction between cells $1$ and $2$ for the forward-streaming flux.",
            "answer": "$$ \\boxed{-0.5774} $$"
        },
        {
            "introduction": "This capstone exercise synthesizes the concepts of forward and adjoint sensitivity analysis into a complete numerical workflow. You will implement both methods from the ground up for a two-dimensional diffusion problem, allowing for a direct comparison of their results and computational demands . This practice provides invaluable experience in translating theoretical sensitivity equations into practical code and highlights important numerical considerations, such as the efficiency gains from reusing matrix factorizations for both the state and adjoint solves.",
            "id": "4213490",
            "problem": "Consider the steady one-group neutron balance in a homogeneous rectangular domain under Dirichlet boundary conditions, written in nondimensional form as a diffusion-drift-absorption equation. When discretized on a uniform Cartesian mesh using second-order central differences for diffusion and first-order upwind for streaming, the resulting algebraic system can be written as\n$$\nA(p)\\,\\phi(p) = q,\n$$\nwhere $A(p) \\in \\mathbb{R}^{n \\times n}$ is the stiffness matrix, $p$ is a scalar parameter representing the absorption cross section, $\\phi(p) \\in \\mathbb{R}^{n}$ is the flux vector, and $q \\in \\mathbb{R}^{n}$ is a fixed source vector. The scalar response of interest is a detector-weighted flux\n$$\nJ(\\phi) = w^\\top \\phi,\n$$\nfor a fixed weight vector $w \\in \\mathbb{R}^{n}$. Assume all quantities are nondimensional.\n\nStarting from the governing neutron balance and the definition of the response $J(\\phi)$, derive expressions for the sensitivity $\\mathrm{d}J/\\mathrm{d}p$ using both the forward sensitivity method and the adjoint-based sensitivity method. In the forward method, differentiate the state equation in $p$ to obtain a linear system for $\\mathrm{d}\\phi/\\mathrm{d}p$ and then express $\\mathrm{d}J/\\mathrm{d}p$ in terms of $\\mathrm{d}\\phi/\\mathrm{d}p$. In the adjoint method, define an adjoint vector $\\lambda$ that satisfies a transposed linear system and express $\\mathrm{d}J/\\mathrm{d}p$ as an inner product involving $\\lambda$, the derivative of the operator, and the state. Work from first principles, beginning with the algebraic form $A(p)\\phi(p)=q$ and the response $J(\\phi)=w^\\top\\phi$, without assuming any shortcut formulas.\n\nYou must implement a program that:\n- Constructs $A(p)$ for each test case using a five-point discrete diffusion operator with diffusion coefficient $D$, an upwind discrete streaming operator with streaming velocity $v$ in the $x$-direction, and a diagonal absorption contribution $p$.\n- Solves for the state $\\phi$ using a single sparse LU factorization of $A(p)$ and reuses that factorization to:\n  1. Solve the forward sensitivity equation for $\\mathrm{d}\\phi/\\mathrm{d}p$.\n  2. Solve the adjoint equation $A(p)^\\top \\lambda = w$ to obtain $\\lambda$ without refactorizing, by using transposed triangular solves with the same LU factors.\n- Computes, for each test case, the following quantities:\n  1. The forward sensitivity $\\mathrm{d}J/\\mathrm{d}p$ as a float.\n  2. The adjoint sensitivity $\\mathrm{d}J/\\mathrm{d}p$ as a float.\n  3. The absolute difference between the forward and adjoint sensitivity results as a float.\n  4. A boolean flag indicating whether $A(p)$ is symmetric (evaluated by comparing $A(p)$ and $A(p)^\\top$ within a numerical tolerance).\n  5. An integer equal to the total number of nonzeros in the LU factors, computed as $\\mathrm{nnz}(L)+\\mathrm{nnz}(U)$ from the reused factorization, to serve as a proxy for memory usage.\n\nThe discrete operator specifications are:\n- Grid: $N_x \\times N_y$ interior points with uniform spacings $h_x$ and $h_y$.\n- Indexing: Let $(i,j)$ denote a grid point with $i \\in \\{0,\\dots,N_x-1\\}$ and $j \\in \\{0,\\dots,N_y-1\\}$. Map $(i,j)$ to a single index $k = i + j N_x$.\n- Diffusion (five-point stencil): For each interior point, the discrete diffusion operator contributes\n  $$\n  \\left( \\frac{2D}{h_x^2} + \\frac{2D}{h_y^2} \\right)\\phi_{i,j} - \\frac{D}{h_x^2}\\left(\\phi_{i-1,j} + \\phi_{i+1,j}\\right) - \\frac{D}{h_y^2}\\left(\\phi_{i,j-1} + \\phi_{i,j+1}\\right),\n  $$\n  and Dirichlet boundary conditions are enforced by omitting terms that would couple to out-of-domain points.\n- Streaming (upwind first derivative in $x$): For $v \\ge 0$, use\n  $$\n  v \\frac{\\phi_{i,j} - \\phi_{i-1,j}}{h_x}.\n  $$\n  For $v  0$, use\n  $$\n  v \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{h_x}.\n  $$\n- Absorption: The parameter $p$ contributes $p\\,\\phi_{i,j}$ to the diagonal.\n- Source: $q$ is uniform with entries equal to $S_0$.\n\nThe sensitivity must be computed with respect to $p$ (the absorption coefficient). All quantities are nondimensional; no physical units are required.\n\nTest Suite:\nProvide results for the following three cases. In all cases, set $h_x = h_y = 1$ and $S_0 = 1$.\n\n- Case 1 (symmetric diffusion): $N_x=10$, $N_y=10$, $D=1.3$, $p=0.25$, $v=0$. The detector weight $w$ equals $0.25$ at the four central cells $\\{(4,4),(4,5),(5,4),(5,5)\\}$ and $0$ elsewhere.\n- Case 2 (non-symmetric drift-diffusion): $N_x=12$, $N_y=8$, $D=0.9$, $p=0.10$, $v=0.5$. The detector weight $w$ is a Gaussian in index space centered at $(i^\\ast,j^\\ast)=(10,4)$ with standard deviation $\\sigma=1.5$, i.e.,\n  $$\n  w_{i,j} \\propto \\exp\\!\\left( -\\frac{(i-i^\\ast)^2+(j-j^\\ast)^2}{2\\sigma^2} \\right),\n  $$\n  normalized so that $\\sum_{i,j} w_{i,j} = 1$.\n- Case 3 (edge case, minimal absorption and opposite drift): $N_x=3$, $N_y=3$, $D=1.0$, $p=0$, $v=-1.0$. The detector weight $w$ equals $1$ at the central cell $(1,1)$ and $0$ elsewhere.\n\nAlgorithmic Requirements:\n- Use one sparse LU factorization per test case for $A(p)$ and reuse it for all required linear solves including the transposed system $A(p)^\\top \\lambda = w$.\n- Compute the boolean symmetry flag by checking whether the infinity norm of $A(p) - A(p)^\\top$ is less than $10^{-12}$.\n- Compute the integer memory proxy as the sum of the number of nonzeros in the $L$ and $U$ factors from the reused LU.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must concatenate, in order for Case 1, Case 2, and Case 3, the five values\n$$\n\\left[ \\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{forward}}, \\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{adjoint}}, \\left| \\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{forward}} - \\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{adjoint}} \\right|, \\text{is\\_symmetric}, \\mathrm{nnz}(L)+\\mathrm{nnz}(U) \\right]\n$$\nfor each case, resulting in a single list of fifteen entries. The booleans and integers must not be quoted; floats must be printed in standard decimal notation.",
            "solution": "### Derivation of Sensitivity Expressions\n\nThe problem starts with a linear algebraic system representing the steady-state neutron balance, dependent on a scalar parameter $p$:\n$$\nA(p)\\,\\phi(p) = q\n$$\nHere, $A(p)$ is the system matrix, $\\phi(p)$ is the state vector (neutron flux), and $q$ is the constant source vector. The response of interest is a linear functional of the state:\n$$\nJ(p) = w^\\top \\phi(p)\n$$\nwhere $w$ is a constant weight vector. The objective is to compute the total derivative of the response with respect to the parameter, $\\frac{\\mathrm{d}J}{\\mathrm{d}p}$. We will derive this using two distinct methods as requested.\n\n#### Forward Sensitivity Method\n\nThe forward sensitivity method directly calculates the sensitivity of the state, $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}$, and then uses it to find the sensitivity of the response, $\\frac{\\mathrm{d}J}{\\mathrm{d}p}$.\n\n1.  **Differentiate the Response:** We apply the chain rule to the response function $J(p) = w^\\top \\phi(p)$. Since $J$ depends on $p$ only implicitly through $\\phi$, we have:\n    $$\n    \\frac{\\mathrm{d}J}{\\mathrm{d}p} = \\frac{\\partial J}{\\partial \\phi} \\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}\n    $$\n    The gradient of the linear response function $J(\\phi) = w^\\top \\phi$ with respect to the vector $\\phi$ is simply $w^\\top$. Thus, the expression for the response sensitivity becomes:\n    $$\n    \\frac{\\mathrm{d}J}{\\mathrm{d}p} = w^\\top \\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}\n    $$\n    The vector $s_\\phi \\equiv \\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}$ is known as the forward sensitivity vector.\n\n2.  **Differentiate the State Equation:** To find $s_\\phi$, we differentiate the governing state equation $A(p)\\,\\phi(p) = q$ with respect to $p$. Applying the product rule for matrix-vector multiplication yields:\n    $$\n    \\frac{\\mathrm{d}}{\\mathrm{d}p}[A(p)\\phi(p)] = \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p) + A(p)\\frac{\\mathrm{d}\\phi}{\\mathrm{d}p} = \\frac{\\mathrm{d}q}{\\mathrm{d}p}\n    $$\n    The source vector $q$ is specified as fixed, so its derivative with respect to $p$ is zero, $\\frac{\\mathrm{d}q}{\\mathrm{d}p}=0$. This gives:\n    $$\n    A(p)\\frac{\\mathrm{d}\\phi}{\\mathrm{d}p} = - \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p)\n    $$\n    This is a linear system of equations for the unknown forward sensitivity vector $s_\\phi$.\n\n3.  **Procedure:**\n    a. Solve the original state equation for the flux: $A(p)\\phi = q$.\n    b. Compute the derivative of the matrix with respect to the parameter, $\\frac{\\mathrm{d}A}{\\mathrm{d}p}$. In this specific problem, the parameter $p$ only appears in the diagonal absorption term $p\\phi_{i,j}$. Therefore, the matrix can be written as $A(p) = A_0 + pI$, where $A_0$ is the part of the matrix independent of $p$ and $I$ is the identity matrix. The derivative is simply $\\frac{\\mathrm{d}A}{\\mathrm{d}p} = I$.\n    c. Form the right-hand side of the sensitivity equation: $-\\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi = -I\\phi = -\\phi$.\n    d. Solve the forward sensitivity equation for $s_\\phi$: $A(p)s_\\phi = -\\phi$.\n    e. Compute the response sensitivity: $\\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{forward}} = w^\\top s_\\phi$.\n    Notice that the linear system for $s_\\phi$ involves the same matrix $A(p)$ as the original state equation, allowing for the reuse of matrix factorizations.\n\n#### Adjoint-Based Sensitivity Method\n\nThe adjoint method provides an alternative route to the same sensitivity value, often with greater computational efficiency when the number of parameters exceeds the number of responses. It avoids the explicit calculation of the state sensitivity vector $s_\\phi$.\n\n1.  **Start from the Total Derivative:** We begin again with the general expressions for the response sensitivity and the state equation derivative:\n    $$\n    \\frac{\\mathrm{d}J}{\\mathrm{d}p} = w^\\top \\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}\n    $$\n    $$\n    \\frac{\\mathrm{d}\\phi}{\\mathrm{d}p} = - A(p)^{-1} \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p)\n    $$\n    Note that this expression for $\\frac{\\mathrm{d}\\phi}{\\mathrm{d}p}$ implicitly involves a linear solve, not a full matrix inversion.\n\n2.  **Introduce the Adjoint Vector:** Substituting the second expression into the first gives:\n    $$\n    \\frac{\\mathrm{d}J}{\\mathrm{d}p} = -w^\\top A(p)^{-1} \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p)\n    $$\n    The key insight of the adjoint method is to reorder the computation. Using the property $(XY)^\\top=Y^\\top X^\\top$ and $(X^{-1})^\\top = (X^\\top)^{-1}$, we can rewrite the term $w^\\top A(p)^{-1}$ as:\n    $$\n    w^\\top A(p)^{-1} = [ (A(p)^{-1})^\\top w ]^\\top\n    $$\n    We then define the adjoint vector, $\\lambda$, as the vector inside the brackets:\n    $$\n    \\lambda = (A(p)^{-1})^\\top w\n    $$\n    This is equivalent to solving the following linear system for $\\lambda$:\n    $$\n    A(p)^\\top \\lambda = w\n    $$\n    This is the adjoint equation. The source term for the adjoint equation is the gradient of the response function with respect to the state, $w = (\\frac{\\partial J}{\\partial \\phi})^\\top$.\n\n3.  **Procedure:**\n    a. Solve the original state equation for the flux: $A(p)\\phi = q$.\n    b. Solve the adjoint equation for the adjoint vector: $A(p)^\\top \\lambda = w$.\n    c. Substitute $\\lambda$ back into the sensitivity expression:\n    $$\n    \\frac{\\mathrm{d}J}{\\mathrm{d}p} = - [ (A(p)^{-1})^\\top w ]^\\top \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p) = - \\lambda^\\top \\frac{\\mathrm{d}A}{\\mathrm{d}p}\\phi(p)\n    $$\n    d. As established previously, $\\frac{\\mathrm{d}A}{\\mathrm{d}p}=I$. Therefore, the response sensitivity is computed by a simple inner product:\n    $$\n    \\left(\\frac{\\mathrm{d}J}{\\mathrm{d}p}\\right)_{\\mathrm{adjoint}} = -\\lambda^\\top \\phi\n    $$\n\nBoth methods are mathematically equivalent and must yield the same numerical result, up to floating-point precision. The following Python code implements this procedure and generates the required output.\n\n```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix, linalg\n\ndef solve_case(Nx, Ny, D, p, v, w_def, hx=1.0, hy=1.0, S0=1.0):\n    n = Nx * Ny\n    A = lil_matrix((n, n), dtype=float)\n\n    for j in range(Ny):\n        for i in range(Nx):\n            k = i + j * Nx\n            \n            diag_val = (2.0 * D / (hx*hx)) + (2.0 * D / (hy*hy))\n            if v >= 0:\n                diag_val += v / hx\n            else:\n                diag_val += -v / hx\n            diag_val += p\n            A[k, k] = diag_val\n            \n            if i > 0:\n                k_L = (i - 1) + j * Nx\n                val = -D / (hx*hx)\n                if v >= 0:\n                    val -= v / hx\n                A[k, k_L] = val\n                \n            if i  Nx - 1:\n                k_R = (i + 1) + j * Nx\n                val = -D / (hx*hx)\n                if v  0:\n                    val += v / hx\n                A[k, k_R] = val\n            \n            if j > 0:\n                k_D = i + (j - 1) * Nx\n                A[k, k_D] = -D / (hy*hy)\n                \n            if j  Ny - 1:\n                k_U = i + (j + 1) * Nx\n                A[k, k_U] = -D / (hy*hy)\n\n    A_csc = A.tocsc()\n    \n    symm_diff = linalg.norm(A_csc - A_csc.T, ord=np.inf)\n    is_symmetric = symm_diff  1e-12\n\n    q = np.full(n, S0, dtype=float)\n    w = np.zeros(n, dtype=float)\n    \n    if w_def['type'] == 'points':\n        for (i, j), val in w_def['points'].items():\n            k = i + j * Nx\n            w[k] = val\n    elif w_def['type'] == 'gaussian':\n        i_star, j_star, sigma = w_def['center_i'], w_def['center_j'], w_def['sigma']\n        w_raw_2d = np.zeros((Ny, Nx))\n        for j in range(Ny):\n            for i in range(Nx):\n                dist_sq = (i - i_star)**2 + (j - j_star)**2\n                w_raw_2d[j, i] = np.exp(-dist_sq / (2.0 * sigma**2))\n        w_flat_raw = w_raw_2d.flatten(order='C')\n        w = w_flat_raw / np.sum(w_flat_raw)\n    elif w_def['type'] == 'center':\n        i, j = w_def['point']\n        k = i + j * Nx\n        w[k] = w_def['value']\n\n    lu = linalg.splu(A_csc)\n    phi = lu.solve(q)\n    s_phi = lu.solve(-phi)\n    dJ_fwd = w.T @ s_phi\n    lam = lu.solve(w, trans='T')\n    dJ_adj = -lam.T @ phi\n    abs_diff = abs(dJ_fwd - dJ_adj)\n    nnz_LU = lu.L.nnz + lu.U.nnz\n\n    return dJ_fwd, dJ_adj, abs_diff, is_symmetric, nnz_LU\n```",
            "answer": "[-1.3323049071060932,-1.332304907106093,2.220446049250313e-16,True,1272,-1.3789438012693994,-1.378943801269399,4.440892098500626e-16,False,1253,-2.316885390776717,-2.316885390776717,0.0,False,33]"
        }
    ]
}