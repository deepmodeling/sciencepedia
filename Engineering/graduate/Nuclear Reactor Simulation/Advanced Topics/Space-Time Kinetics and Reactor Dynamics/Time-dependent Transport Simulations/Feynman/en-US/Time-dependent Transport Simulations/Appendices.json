{
    "hands_on_practices": [
        {
            "introduction": "Before solving complex time-dependent problems, it's crucial to understand the properties of the discrete operators we construct. The spectrum of the streaming operator not only dictates how physical waves propagate in the discrete system but also fundamentally governs the numerical behavior of solution algorithms. This exercise provides a foundational look into the heart of a semi-discretized transport system.\n\nBy performing an exact spectral analysis of a simple but representative discrete transport operator, you will gain direct insight into how discretization choices translate into matrix properties . This practice is vital as it connects abstract linear algebra to the practical performance of the implicit solvers used at every time step, revealing why the condition number is a key metric for computational efficiency.",
            "id": "4257829",
            "problem": "Consider the time-dependent, one-dimensional linear transport equation without collisions, written for the angular flux $\\psi(x,\\mu,t)$ in slab geometry,\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = 0,\n$$\nwhere $x \\in [0,L)$ with periodic boundary conditions, $t \\ge 0$, $\\mu$ is the direction cosine, and $v$ is the constant particle speed. Discretize the angle using the two-angle Discrete Ordinates (SN) method (S2), with abscissae $\\mu_1 = +1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$ and equal weights. Discretize space on a uniform mesh of $N$ cells of width $h=L/N$, and use a first-order upwind finite-volume discretization consistent with periodic boundaries. Denote by $\\boldsymbol{\\psi}_{\\mu}$ the vector of cell-averaged angular fluxes for a given ordinate $\\mu$.\n\nDefine the semi-discrete system in vector form as\n$$\n\\frac{d}{dt}\\,\\boldsymbol{\\psi} + A\\,\\boldsymbol{\\psi} = 0,\\quad \\boldsymbol{\\psi} = \\begin{bmatrix}\\boldsymbol{\\psi}_{\\mu_1} \\\\ \\boldsymbol{\\psi}_{\\mu_2}\\end{bmatrix},\n$$\nwhere $A$ is the block-diagonal discrete streaming operator scaled by the speed $v$,\n$$\nA = \\mathrm{diag}\\left( v\\,D(\\mu_1),\\, v\\,D(\\mu_2) \\right).\n$$\nHere $D(\\mu)$ is the $N \\times N$ upwind discrete derivative matrix with periodic wrap:\n- For $\\mu > 0$, $D(\\mu) = \\frac{\\mu}{h}\\left(I - S^{-1}\\right)$, where $S^{-1}$ shifts a vector down by one index with wrap-around.\n- For $\\mu < 0$, $D(\\mu) = \\frac{\\mu}{h}\\left(S - I\\right)$, where $S$ shifts a vector up by one index with wrap-around.\n\nConsider a single implicit backward Euler timestep of size $\\Delta t$ applied to the homogeneous system,\n$$\n\\left(I + \\Delta t\\,A\\right)\\,\\boldsymbol{\\psi}^{n+1} = \\boldsymbol{\\psi}^{n}.\n$$\nFor a given parameter set $(L, v, N, \\Delta t)$, do the following:\n1. Compute the full spectrum (the multiset of $2N$ eigenvalues) of $A$ exactly by using the known circulant structure induced by periodic boundaries. You must not approximate the spectrum via time-stepping; instead, use the discrete Fourier modes to construct it.\n2. From this spectrum, compute the following three quantitative diagnostics:\n   - The spectral radius of $A$, denoted $\\rho_A$, defined as $\\rho_A = \\max_{\\lambda \\in \\sigma(A)} |\\lambda|$. Report $\\rho_A$ in $\\mathrm{s}^{-1}$.\n   - The $2$-norm condition number of the backward Euler system matrix $M = I + \\Delta t\\,A$, denoted $\\kappa(M)$, which for normal matrices equals $\\kappa(M) = \\dfrac{\\max_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|}{\\min_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|}$. Report $\\kappa(M)$ as a dimensionless number.\n   - The minimal per-timestep modal amplification factor for backward Euler, denoted $g_{\\min}$, defined as $g_{\\min} = \\min_{\\lambda \\in \\sigma(A)} \\left| \\dfrac{1}{1 + \\Delta t\\,\\lambda} \\right|$. Report $g_{\\min}$ as a dimensionless number.\n3. Explain, based on first principles of the discretization and the computed spectra, how the eigenvalue distribution and $\\kappa(M)$ constrain the convergence behavior of iterative implicit solvers applied at each timestep, focusing on the scaling with $\\Delta t$, $v$, and $h$.\n\nUse the following test suite of parameter sets, which together probe a range of spatial and temporal resolutions, including an edge case:\n- Test $1$: $L = 1.0\\,\\mathrm{m}$, $v = 2.0\\times 10^{7}\\,\\mathrm{m/s}$, $N = 8$, $\\Delta t = 1.0\\times 10^{-9}\\,\\mathrm{s}$.\n- Test $2$: $L = 1.0\\,\\mathrm{m}$, $v = 2.0\\times 10^{7}\\,\\mathrm{m/s}$, $N = 32$, $\\Delta t = 1.0\\times 10^{-8}\\,\\mathrm{s}$.\n- Test $3$: $L = 1.0\\,\\mathrm{m}$, $v = 2.0\\times 10^{7}\\,\\mathrm{m/s}$, $N = 64$, $\\Delta t = 1.0\\times 10^{-7}\\,\\mathrm{s}$.\n- Test $4$ (edge case): $L = 1.0\\,\\mathrm{m}$, $v = 2.0\\times 10^{7}\\,\\mathrm{m/s}$, $N = 16$, $\\Delta t = 0.0\\,\\mathrm{s}$.\n\nYour program must:\n- Construct the spectra analytically from the circulant structure using the discrete Fourier mode angles $\\theta_k = 2\\pi k/N$ for $k = 0,1,\\dots,N-1$ and the S2 ordinates $\\mu = \\pm 1/\\sqrt{3}$, without numerical time integration.\n- For each test, compute $(\\rho_A, \\kappa(M), g_{\\min})$ and round each to six digits after the decimal point.\n- Produce a single line of output containing the results as a comma-separated list of lists in the exact format\n$[\\,[\\rho_{A,1},\\kappa(M)_1,g_{\\min,1}],\\,[\\rho_{A,2},\\kappa(M)_2,g_{\\min,2}],\\,[\\rho_{A,3},\\kappa(M)_3,g_{\\min,3}],\\,[\\rho_{A,4},\\kappa(M)_4,g_{\\min,4}]\\,]$,\nwith no additional text.\n\nAll physical quantities must be handled in the specified units: $L$ in $\\mathrm{m}$, $v$ in $\\mathrm{m/s}$, $\\Delta t$ in $\\mathrm{s}$, and $\\rho_A$ in $\\mathrm{s}^{-1}$. Angles arising in the discrete Fourier modes must be treated in radians. The final numerical outputs are dimensionless for $\\kappa(M)$ and $g_{\\min}$ and must be reported as pure decimals without unit symbols.",
            "solution": "The user-provided problem has been analyzed and is deemed valid. It is scientifically grounded, well-posed, and objective. It represents a standard problem in the numerical analysis of transport equations.\n\nThe problem asks for the analysis of a semi-discretized one-dimensional transport equation using the method of lines. The tasks are to compute the exact spectrum of the discrete operator, calculate several diagnostic quantities from this spectrum, and explain the implications for iterative solvers.\n\nThe governing partial differential equation is the collisionless transport equation in slab geometry:\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = 0,\n$$\nfor $x \\in [0,L)$, with periodic boundary conditions. The angle is discretized using the S2 approximation, with ordinates $\\mu_1 = 1/\\sqrt{3}$ and $\\mu_2 = -1/\\sqrt{3}$. Space is discretized into $N$ uniform cells of width $h=L/N$ using a first-order upwind finite-volume scheme.\n\nThe resulting semi-discrete system is given by:\n$$\n\\frac{d}{dt}\\,\\boldsymbol{\\psi} + A\\,\\boldsymbol{\\psi} = 0, \\quad \\text{where} \\quad \\boldsymbol{\\psi} = \\begin{bmatrix}\\boldsymbol{\\psi}_{\\mu_1} \\\\ \\boldsymbol{\\psi}_{\\mu_2}\\end{bmatrix}.\n$$\nThe matrix $A$ is block-diagonal, $A = \\mathrm{diag}\\left( v\\,D(\\mu_1),\\, v\\,D(\\mu_2) \\right)$, where $D(\\mu)$ is the discrete upwind advection operator on the periodic mesh.\n\n**1. Derivation of the Spectrum of $A$**\n\nThe spectrum of the block-diagonal matrix $A$ is the union of the spectra of its diagonal blocks, $\\sigma(A) = \\sigma(v\\,D(\\mu_1)) \\cup \\sigma(v\\,D(\\mu_2))$. The matrices $D(\\mu)$ are $N \\times N$ circulant matrices due to the uniform periodic grid. The eigenvalues of an $N \\times N$ circulant matrix with first row $(c_0, c_1, \\dots, c_{N-1})$ are given by $\\lambda_k = \\sum_{j=0}^{N-1} c_j \\omega_k^j$ for $k=0, 1, \\dots, N-1$, where $\\omega_k = e^{i \\theta_k}$ are the $N$-th roots of unity, with $\\theta_k = 2\\pi k/N$.\n\nCase $\\mu > 0$ (for $\\mu_1 = 1/\\sqrt{3}$):\nThe operator is $D(\\mu_1) = \\frac{\\mu_1}{h}(I - S^{-1})$, where $S^{-1}$ is the circulant permutation matrix for a downward shift. The first row of $(I - S^{-1})$ is $(1, 0, \\dots, 0, -1)$. Thus, $c_0 = 1$ and $c_{N-1}=-1$. The eigenvalues of $(I - S^{-1})$ are:\n$$\n\\lambda_k(I-S^{-1}) = c_0 + c_{N-1}\\omega_k^{N-1} = 1 - \\omega_k^{-1} = 1 - e^{-i\\theta_k}.\n$$\nThe eigenvalues of $v\\,D(\\mu_1)$ are therefore:\n$$\n\\lambda_k^{(1)} = v \\frac{\\mu_1}{h} (1 - e^{-i\\theta_k}), \\quad k = 0, 1, \\dots, N-1.\n$$\n\nCase $\\mu < 0$ (for $\\mu_2 = -1/\\sqrt{3}$):\nThe operator is $D(\\mu_2) = \\frac{\\mu_2}{h}(S - I)$, where $S$ is the circulant permutation matrix for an upward shift. The first row of $(S - I)$ is $(-1, 1, 0, \\dots, 0)$. Thus, $c_0 = -1$ and $c_1=1$. The eigenvalues of $(S - I)$ are:\n$$\n\\lambda_k(S-I) = c_0 + c_1\\omega_k^1 = -1 + \\omega_k = -1 + e^{i\\theta_k}.\n$$\nThe eigenvalues of $v\\,D(\\mu_2)$ are:\n$$\n\\lambda_k^{(2)} = v \\frac{\\mu_2}{h} (-1 + e^{i\\theta_k}), \\quad k = 0, 1, \\dots, N-1.\n$$\nSince $\\mu_2 = -\\mu_1$, we can rewrite this as:\n$$\n\\lambda_k^{(2)} = v \\frac{-\\mu_1}{h} (-1 + e^{i\\theta_k}) = v \\frac{\\mu_1}{h} (1 - e^{i\\theta_k}).\n$$\nThe full spectrum $\\sigma(A)$ consists of $2N$ eigenvalues, $\\{\\lambda_k^{(1)}\\}_{k=0}^{N-1} \\cup \\{\\lambda_k^{(2)}\\}_{k=0}^{N-1}$. Note that $\\lambda_k^{(2)}$ is the complex conjugate of $\\lambda_k^{(1)}$, which is expected as the operator $A$ is real.\n\n**2. Computation of Diagnostic Quantities**\n\nFrom the derived spectrum of $A$, we compute the three requested diagnostics.\n\n**Spectral Radius $\\rho_A$**:\nThe spectral radius is $\\rho_A = \\max_{\\lambda \\in \\sigma(A)} |\\lambda|$. We calculate the magnitude of the eigenvalues:\n$$\n|\\lambda_k^{(1)}| = \\left| v \\frac{\\mu_1}{h} (1 - e^{-i\\theta_k}) \\right| = v \\frac{\\mu_1}{h} \\sqrt{(1-\\cos\\theta_k)^2 + \\sin^2\\theta_k} = v \\frac{\\mu_1}{h} \\sqrt{2 - 2\\cos\\theta_k} = 2v \\frac{\\mu_1}{h} \\left|\\sin\\left(\\frac{\\theta_k}{2}\\right)\\right|.\n$$\nSubstituting $\\theta_k = 2\\pi k/N$, we get $|\\lambda_k^{(1)}| = 2v \\frac{\\mu_1}{h} |\\sin(\\pi k/N)|$. The magnitude is identical for $\\lambda_k^{(2)}$. The maximum value of $|\\sin(\\pi k/N)|$ for $k \\in \\{0, \\dots, N-1\\}$ is $1$, achieved when $N$ is even at $k=N/2$. All test cases use even $N$. Therefore,\n$$\n\\rho_A = \\frac{2v\\mu_1}{h} = \\frac{2vN}{L\\sqrt{3}}.\n$$\n\n**Condition Number $\\kappa(M)$**:\nThe backward Euler system matrix is $M = I + \\Delta t\\, A$. Since $A$ is a normal matrix (its blocks are circulant, hence normal), $M$ is also normal. Its condition number is the ratio of the maximum to minimum magnitude of its eigenvalues. The eigenvalues of $M$ are $\\zeta_k = 1 + \\Delta t\\,\\lambda_k$ for $\\lambda_k \\in \\sigma(A)$. Let $C = \\frac{\\Delta t\\, v\\, \\mu_1}{h}$ be the Courant number for the positive ordinate. The eigenvalues of $M$ are $1 + C(1-e^{\\mp i\\theta_k})$. The squared magnitude is:\n$$\n|1 + C(1 - e^{\\mp i\\theta_k})|^2 = |(1+C) - C(\\cos\\theta_k \\mp i\\sin\\theta_k)|^2 = ((1+C) - C\\cos\\theta_k)^2 + (C\\sin\\theta_k)^2\n$$\n$$\n= (1+C)^2 - 2C(1+C)\\cos\\theta_k + C^2\\cos^2\\theta_k + C^2\\sin^2\\theta_k = 1 + 2C(1+C)(1-\\cos\\theta_k) = 1 + 4C(1+C)\\sin^2(\\pi k/N).\n$$\nThis magnitude is minimized for $k=0$, where $\\sin(0)=0$. The minimum magnitude is $\\min|\\zeta_k| = \\sqrt{1} = 1$. This corresponds to the eigenvalue $\\lambda_0 = 0$ of $A$.\nThe magnitude is maximized for $k=N/2$, where $\\sin(\\pi/2)=1$. The maximum squared magnitude is $1 + 4C(1+C) = (1+2C)^2$. The maximum magnitude is $\\max|\\zeta_k| = 1+2C$.\nThe condition number is:\n$$\n\\kappa(M) = \\frac{\\max_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|}{\\min_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|} = \\frac{1+2C}{1} = 1 + 2C = 1 + \\frac{2\\Delta t\\,vN}{L\\sqrt{3}}.\n$$\n\n**Minimal Amplification Factor $g_{\\min}$**:\nThe modal amplification factor for backward Euler is $g(\\lambda) = 1/(1+\\Delta t\\,\\lambda)$. The minimal amplification factor is:\n$$\ng_{\\min} = \\min_{\\lambda \\in \\sigma(A)} \\left| \\frac{1}{1 + \\Delta t\\,\\lambda} \\right| = \\frac{1}{\\max_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|} = \\frac{1}{\\kappa(M)\\,\\min_{\\lambda \\in \\sigma(A)} |1 + \\Delta t\\,\\lambda|}.\n$$\nSince $\\min |1 + \\Delta t\\,\\lambda| = 1$, we have:\n$$\ng_{\\min} = \\frac{1}{\\kappa(M)} = \\frac{1}{1 + 2C} = \\frac{1}{1 + \\frac{2\\Delta t\\,vN}{L\\sqrt{3}}}.\n$$\n\n**3. Constraints on Iterative Solvers**\n\nAt each implicit time step, one must solve the linear system $M\\boldsymbol{\\psi}^{n+1} = \\boldsymbol{\\psi}^{n}$, where $M = I + \\Delta t\\,A$. For large-scale problems, this system is solved iteratively. The convergence rate of many common iterative solvers (e.g., GMRES, Conjugate Gradient on the normal equations) is adversely affected by a large condition number, $\\kappa(M)$.\n\nOur analysis shows that $\\kappa(M) = 1 + 2C$, where $C = \\frac{\\Delta t\\, v\\, \\mu_1}{h}$ is the Courant number. This reveals how problem parameters control the difficulty of the linear solve:\n- **Scaling with $\\Delta t$**: $\\kappa(M)$ scales linearly with the timestep size $\\Delta t$. This is a classic challenge for implicit methods: while they are unconditionally stable for this problem, allowing for large $\\Delta t$, doing so makes the linear system increasingly ill-conditioned and thus harder to solve.\n- **Scaling with $v$**: $\\kappa(M)$ scales linearly with the particle speed $v$. Faster particles lead to more ill-conditioned systems.\n- **Scaling with $h$**: $\\kappa(M)$ scales inversely with the cell width $h = L/N$. Thus, as the spatial mesh is refined ($h \\to 0$), the condition number grows.\n\nThe quantity $C = v\\Delta t/(\\sqrt{3} h)$ represents the number of cells a particle with speed $v$ and direction $\\mu_1$ would traverse in one timestep $\\Delta t$. A large Courant number $C$ implies that information propagates over many cells in a single step. This creates strong long-range coupling in the matrix $M$, which degrades the performance of iterative solvers that typically rely on local information propagation (like Jacobi or Gauss-Siedel) or polynomial approximants (like Krylov methods). The spread of the eigenvalues of $M$ from $1$ to $1+2C$ directly reflects this coupling. A large spread slows convergence. In practice, this necessitates the use of powerful preconditioners to cluster the eigenvalues and reduce the effective condition number, especially in regimes with large $\\Delta t$ or fine meshes.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes spectral diagnostics for the S2 transport discretization.\n    \"\"\"\n    # S2 ordinate\n    mu1 = 1.0 / np.sqrt(3.0)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, v, N, dt)\n        (1.0, 2.0e7, 8, 1.0e-9),\n        (1.0, 2.0e7, 32, 1.0e-8),\n        (1.0, 2.0e7, 64, 1.0e-7),\n        (1.0, 2.0e7, 16, 0.0),\n    ]\n\n    results = []\n    for L, v, N, dt in test_cases:\n        # Calculate cell width\n        h = L / N\n\n        # 1. Spectral radius of A\n        # rho_A = (2 * v * mu1) / h\n        rho_A = (2.0 * v * N) / (L * np.sqrt(3.0))\n\n        # 2. Condition number of M = I + dt*A\n        # The Courant number C = dt * v * mu1 / h\n        C = (dt * v * mu1) / h\n        # kappa(M) = 1 + 2*C\n        kappa_M = 1.0 + 2.0 * C\n\n        # 3. Minimal modal amplification factor g_min\n        # g_min = 1 / (1 + 2*C) = 1 / kappa_M\n        # Handle the case where kappa_M is zero, although not possible here.\n        if kappa_M == 0:\n            g_min = float('inf')\n        else:\n            g_min = 1.0 / kappa_M\n\n        results.append([rho_A, kappa_M, g_min])\n\n    # Format the output string as a list of lists with numbers formatted to 6 decimal places.\n    case_strings = []\n    for case_result in results:\n        num_strings = [f\"{x:.6f}\" for x in case_result]\n        case_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    final_output_str = f\"[{','.join(case_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Writing a simulation code is one thing; proving that it correctly solves the intended equations is a much more rigorous task. The Method of Manufactured Solutions (MMS) is a powerful and standard verification technique in computational science. The core idea is to choose a smooth analytical function as a \"manufactured\" solution, substitute it into the governing PDE, and derive the source term and boundary conditions required to make the equation hold true exactly.\n\nThis exercise offers hands-on practice with the MMS workflow, a fundamental skill for developing reliable numerical codes . By deriving the necessary components to build a complete verification test, you will learn how to create a benchmark that can be used to precisely measure your code's convergence rate and confirm its order of accuracy.",
            "id": "4257834",
            "problem": "Consider a single energy group $g$ time-dependent linear Boltzmann transport equation in a bounded convex domain $\\mathcal{D} \\subset \\mathbb{R}^{3}$ with outward unit normal $\\mathbf{n}(\\mathbf{r})$ on $\\partial \\mathcal{D}$:\n$$\n\\frac{1}{v_{g}}\\,\\frac{\\partial \\psi_{g}(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega \\cdot \\nabla \\psi_{g}(\\mathbf{r},\\Omega,t) + \\Sigma_{t,g}\\,\\psi_{g}(\\mathbf{r},\\Omega,t) = \\frac{\\Sigma_{s,g}}{4\\pi}\\,\\phi_{g}(\\mathbf{r},t) + S_{g}(\\mathbf{r},\\Omega,t),\n$$\nwhere $\\psi_{g}(\\mathbf{r},\\Omega,t)$ is the angular flux, $v_{g}$ is the particle speed, $\\Omega \\in \\mathbb{S}^{2}$ is the direction unit vector, $\\Sigma_{t,g}$ is the macroscopic total cross section, $\\Sigma_{s,g}$ is the macroscopic isotropic scattering cross section (within-group), and $\\phi_{g}(\\mathbf{r},t) = \\int_{4\\pi} \\psi_{g}(\\mathbf{r},\\Omega,t)\\,d\\Omega$ is the scalar flux. Assume no fission and no fixed sources other than the manufactured source $S_{g}(\\mathbf{r},\\Omega,t)$ to be determined. All material properties are spatially uniform and time independent.\n\nUsing the Method of Manufactured Solutions (MMS), construct a manufactured angular flux that propagates at constant speed $v_{g}$ along each direction $\\Omega$ by taking\n$$\n\\psi_{g}(\\mathbf{r},\\Omega,t) = A_{g} + B_{g}\\,\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right),\n$$\nwhere $A_{g}$ and $B_{g}$ are real constants. Derive from first principles the exact manufactured source $S_{g}(\\mathbf{r},\\Omega,t)$ and the corresponding boundary and initial conditions that make $\\psi_{g}$ an exact solution of the transport equation above.\n\nProvide your final answer as a single closed-form analytic expression for $S_{g}(\\mathbf{r},\\Omega,t)$ in terms of $A_{g}$, $B_{g}$, $\\mathbf{r}$, $\\Omega$, $t$, $v_{g}$, $\\Sigma_{t,g}$, and $\\Sigma_{s,g}$. No numerical evaluation is required. Express the boundary and initial conditions in words and formulas in your derivation, but the final answer should only be the source expression. The answer should not include units. If any simplifications occur due to angular integrations, show them in your derivation. The manufactured solution must be consistent with physically meaningful transport propagation at speed $v_{g}$ along $\\Omega$.\n\nYour final boxed answer must be a single analytic expression, not an equation or inequality and not a set of multiple expressions.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **Governing Equation**: The time-dependent linear Boltzmann transport equation for a single energy group $g$ in a bounded convex domain $\\mathcal{D} \\subset \\mathbb{R}^{3}$:\n$$\n\\frac{1}{v_{g}}\\,\\frac{\\partial \\psi_{g}(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega \\cdot \\nabla \\psi_{g}(\\mathbf{r},\\Omega,t) + \\Sigma_{t,g}\\,\\psi_{g}(\\mathbf{r},\\Omega,t) = \\frac{\\Sigma_{s,g}}{4\\pi}\\,\\phi_{g}(\\mathbf{r},t) + S_{g}(\\mathbf{r},\\Omega,t)\n$$\n- **Manufactured Solution**: The proposed form for the angular flux is:\n$$\n\\psi_{g}(\\mathbf{r},\\Omega,t) = A_{g} + B_{g}\\,\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right)\n$$\n- **Definitions**:\n    - $\\psi_{g}(\\mathbf{r},\\Omega,t)$: angular neutron flux.\n    - $v_{g}$: particle speed (constant).\n    - $\\Omega \\in \\mathbb{S}^{2}$: direction unit vector.\n    - $\\mathbf{r} \\in \\mathcal{D}$: position vector.\n    - $t$: time.\n    - $\\Sigma_{t,g}$: macroscopic total cross section (constant).\n    - $\\Sigma_{s,g}$: macroscopic isotropic scattering cross section (constant).\n    - $\\phi_{g}(\\mathbf{r},t) = \\int_{4\\pi} \\psi_{g}(\\mathbf{r},\\Omega,t)\\,d\\Omega$: scalar flux.\n    - $S_{g}(\\mathbf{r},\\Omega,t)$: manufactured source term to be determined.\n    - $A_{g}, B_{g}$: real constants.\n- **Assumptions**: Spatially uniform and time-independent material properties. No fission. No external fixed sources other than the manufactured source.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is based on the linear Boltzmann transport equation, a cornerstone of reactor physics and transport theory. The Method of Manufactured Solutions (MMS) is a standard, rigorous technique for code verification. The problem is scientifically and mathematically sound.\n- **Well-Posed**: The problem is well-posed in the context of MMS. It asks for the derivation of a source term and corresponding boundary/initial conditions that make a given analytic function an exact solution to the governing PDE. This is the definition of the MMS procedure.\n- **Objective**: The problem is stated using precise mathematical language and established physical terminology. It is free of subjectivity.\n- **Completeness and Consistency**: The problem provides all necessary information (the PDE, the form of the solution, all variable definitions) to derive the requested source term and conditions. The givens are self-consistent.\n\n### Step 3: Verdict and Action\nThe problem is valid. A solution will be provided.\n\nThe Method of Manufactured Solutions (MMS) requires substituting the proposed manufactured solution into the governing partial differential equation and solving for the source term that makes the equality hold. The governing equation can be rearranged to express the source term $S_{g}(\\mathbf{r},\\Omega,t)$ as:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = \\frac{1}{v_{g}}\\,\\frac{\\partial \\psi_{g}}{\\partial t} + \\Omega \\cdot \\nabla \\psi_{g} + \\Sigma_{t,g}\\,\\psi_{g} - \\frac{\\Sigma_{s,g}}{4\\pi}\\,\\phi_{g}\n$$\nWe will evaluate each term on the right-hand side using the manufactured solution $\\psi_{g}(\\mathbf{r},\\Omega,t) = A_{g} + B_{g}\\,\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right)$.\n\nFirst, we compute the time derivative of $\\psi_{g}$:\n$$\n\\frac{\\partial \\psi_{g}}{\\partial t} = \\frac{\\partial}{\\partial t} \\left[ A_{g} + B_{g}\\,\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right) \\right] = B_{g} (-v_{g}) = -B_{g}v_{g}\n$$\nThe first term of the source equation is therefore:\n$$\n\\frac{1}{v_{g}}\\,\\frac{\\partial \\psi_{g}}{\\partial t} = \\frac{1}{v_{g}}(-B_{g}v_{g}) = -B_{g}\n$$\nNext, we compute the gradient of $\\psi_{g}$ with respect to the spatial variable $\\mathbf{r}$:\n$$\n\\nabla \\psi_{g} = \\nabla \\left[ A_{g} + B_{g}\\,\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right) \\right] = B_{g} \\nabla(\\Omega \\cdot \\mathbf{r})\n$$\nThe gradient of the scalar field $\\Omega \\cdot \\mathbf{r}$ is the vector $\\Omega$. Thus,\n$$\n\\nabla \\psi_{g} = B_{g} \\Omega\n$$\nThe streaming term $\\Omega \\cdot \\nabla \\psi_{g}$ becomes:\n$$\n\\Omega \\cdot \\nabla \\psi_{g} = \\Omega \\cdot (B_{g}\\Omega) = B_{g}(\\Omega \\cdot \\Omega)\n$$\nSince $\\Omega$ is a unit vector, $\\Omega \\cdot \\Omega = |\\Omega|^2 = 1$. The streaming term simplifies to:\n$$\n\\Omega \\cdot \\nabla \\psi_{g} = B_{g}\n$$\nThe sum of the first two terms reveals a key property of the manufactured solution:\n$$\n\\frac{1}{v_{g}}\\,\\frac{\\partial \\psi_{g}}{\\partial t} + \\Omega \\cdot \\nabla \\psi_{g} = -B_{g} + B_{g} = 0\n$$\nThis means the manufactured solution is a solution to the sourceless, collisionless transport equation, representing a wave propagating at speed $v_g$ in direction $\\Omega$. The expression for the source term simplifies to:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = \\Sigma_{t,g}\\,\\psi_{g} - \\frac{\\Sigma_{s,g}}{4\\pi}\\,\\phi_{g}\n$$\nNow, we must find the scalar flux $\\phi_{g}(\\mathbf{r},t)$ by integrating the angular flux over all directions:\n$$\n\\phi_{g}(\\mathbf{r},t) = \\int_{4\\pi} \\psi_{g}(\\mathbf{r},\\Omega,t) \\,d\\Omega = \\int_{4\\pi} \\left[ A_{g} + B_{g}\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right) \\right] d\\Omega\n$$\nWe can split the integral:\n$$\n\\phi_{g}(\\mathbf{r},t) = \\int_{4\\pi} A_{g}\\,d\\Omega + \\int_{4\\pi} B_{g}(\\Omega \\cdot \\mathbf{r})\\,d\\Omega - \\int_{4\\pi} B_{g}v_{g}t\\,d\\Omega\n$$\nEvaluating each integral term by term:\n1.  The integral of the constant term is $\\int_{4\\pi} A_{g}\\,d\\Omega = A_{g} \\int_{4\\pi} d\\Omega = 4\\pi A_{g}$.\n2.  The second integral is $\\int_{4\\pi} B_{g}(\\Omega \\cdot \\mathbf{r})\\,d\\Omega = B_{g} \\mathbf{r} \\cdot \\int_{4\\pi} \\Omega \\,d\\Omega$. The integral of the vector $\\Omega$ over the unit sphere $\\mathbb{S}^2$ yields a null vector, $\\int_{4\\pi} \\Omega \\,d\\Omega = \\mathbf{0}$. This is due to symmetry, as for every direction $\\Omega$, there is an opposing direction $-\\Omega$. Thus, this term is zero.\n3.  The third integral is $\\int_{4\\pi} B_{g}v_{g}t\\,d\\Omega = B_{g}v_{g}t \\int_{4\\pi}d\\Omega = 4\\pi B_{g}v_{g}t$.\n\nCombining these results gives the scalar flux:\n$$\n\\phi_{g}(\\mathbf{r},t) = 4\\pi A_{g} + 0 - 4\\pi B_{g}v_{g}t = 4\\pi (A_{g} - B_{g}v_{g}t)\n$$\nSubstituting $\\psi_{g}$ and $\\phi_{g}$ into the simplified expression for $S_{g}$:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = \\Sigma_{t,g} \\left[ A_{g} + B_{g}\\left(\\Omega \\cdot \\mathbf{r} - v_{g}\\,t\\right) \\right] - \\frac{\\Sigma_{s,g}}{4\\pi} \\left[ 4\\pi(A_{g} - B_{g}v_{g}t) \\right]\n$$\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = \\Sigma_{t,g} \\left[ A_{g} + B_{g}(\\Omega \\cdot \\mathbf{r}) - B_{g}v_{g}t \\right] - \\Sigma_{s,g} \\left( A_{g} - B_{g}v_{g}t \\right)\n$$\nExpanding and collecting terms:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = \\Sigma_{t,g}A_{g} + \\Sigma_{t,g}B_{g}(\\Omega \\cdot \\mathbf{r}) - \\Sigma_{t,g}B_{g}v_{g}t - \\Sigma_{s,g}A_{g} + \\Sigma_{s,g}B_{g}v_{g}t\n$$\nGrouping terms with $A_{g}$ and rearrange:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = (\\Sigma_{t,g} - \\Sigma_{s,g})A_{g} + \\Sigma_{t,g}B_{g}(\\Omega \\cdot \\mathbf{r}) - (\\Sigma_{t,g} - \\Sigma_{s,g})B_{g}v_{g}t\n$$\nFactoring common terms yields the final expression for the manufactured source:\n$$\nS_{g}(\\mathbf{r},\\Omega,t) = (\\Sigma_{t,g} - \\Sigma_{s,g})\\left(A_{g} - B_{g}v_{g}t\\right) + \\Sigma_{t,g}B_{g}(\\Omega \\cdot \\mathbf{r})\n$$\nTo complete the MMS problem setup, one must also specify the initial and boundary conditions.\nThe initial condition is obtained by evaluating the manufactured solution at $t=0$:\n$$\n\\psi_{g}(\\mathbf{r},\\Omega,0) = A_{g} + B_{g}(\\Omega \\cdot \\mathbf{r}), \\quad \\forall \\mathbf{r} \\in \\mathcal{D}, \\forall \\Omega \\in \\mathbb{S}^{2}\n$$\nThe boundary condition is a prescribed incoming flux (Dirichlet type) on the boundary $\\partial\\mathcal{D}$. For any point $\\mathbf{r}_{b} \\in \\partial\\mathcal{D}$ with outward normal $\\mathbf{n}(\\mathbf{r}_{b})$, the condition is specified for all incoming directions $\\Omega$ where $\\Omega \\cdot \\mathbf{n}(\\mathbf{r}_{b}) < 0$:\n$$\n\\psi_{g}(\\mathbf{r}_{b},\\Omega,t) = A_{g} + B_{g}(\\Omega \\cdot \\mathbf{r}_{b} - v_{g}t), \\quad \\forall t \\ge 0, \\forall \\mathbf{r}_{b} \\in \\partial\\mathcal{D} \\mid \\Omega \\cdot \\mathbf{n}(\\mathbf{r}_{b}) < 0\n$$\nThe problem asks for the source expression as the final answer.",
            "answer": "$$\n\\boxed{(\\Sigma_{t,g} - \\Sigma_{s,g})(A_{g} - B_{g}v_{g}t) + \\Sigma_{t,g}B_{g}(\\Omega \\cdot \\mathbf{r})}\n$$"
        },
        {
            "introduction": "The choice of time integration scheme has profound implications for simulation accuracy, stability, and computational cost. While implicit methods, as touched upon in , can offer unconditional stability, explicit methods like the classical Runge-Kutta scheme are often simpler to implement and parallelize. However, this simplicity comes at the cost of conditional stability, meaning the time step size $\\Delta t$ is limited.\n\nThis practice explores the stability of explicit methods by linking the spectral properties of the spatial discretization to the stability region of the time integrator . You will derive the maximal stable timestep, which is a specific instance of the famous Courant-Friedrichs-Lewy (CFL) condition. Understanding this limit is a critical aspect of running stable and efficient simulations with explicit time-stepping algorithms.",
            "id": "4257840",
            "problem": "Consider a one-energy-group neutron transport equation in a spatially homogeneous medium with periodic boundary conditions, discretized in angle using the Discrete Ordinates (SN) method and in space using a conservative centered scheme. Under these assumptions, the semi-discrete Method of Lines (MOL) formulation of the streaming term can be written as\n$$\n\\frac{d\\boldsymbol{\\psi}(t)}{dt} = A \\boldsymbol{\\psi}(t),\n$$\nwhere $\\boldsymbol{\\psi}(t)$ is the vector of angular flux unknowns and $A$ is the streaming operator matrix. For the periodic, energy-conserving discretization described, $A$ is skew-Hermitian so that its spectrum lies on the imaginary axis. Let the spectral radius be $\\rho(A) \\equiv \\max_{j} |\\lambda_{j}|$, where $\\lambda_{j}$ are the eigenvalues of $A$.\n\nYou time-advance this system using the classical explicit four-stage, fourth-order Runge–Kutta method defined by its Butcher tableau\n$$\n\\begin{array}{c|cccc}\n0 & 0 & 0 & 0 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{2} & 0 & 0 & 0 \\\\\n\\frac{1}{2} & 0 & \\frac{1}{2} & 0 & 0 \\\\\n1 & 0 & 0 & 1 & 0 \\\\\n\\hline\n & \\frac{1}{6} & \\frac{1}{3} & \\frac{1}{3} & \\frac{1}{6}\n\\end{array}\n$$\napplied to the linear system $\\frac{d\\boldsymbol{\\psi}}{dt}=A\\boldsymbol{\\psi}$.\n\nStarting from the linear stability requirement for a Runge–Kutta method applied to the scalar test equation $\\frac{dy}{dt}=\\lambda y$ and the definition of the stability region in terms of the method’s amplification factor, derive the maximal stable timestep $\\Delta t_{\\max}$ for this method when the eigenvalues of $A$ are purely imaginary, and express your final answer symbolically in terms of $\\rho(A)$. Interpret the result physically in the context of time-dependent transport simulations. Express the timestep in seconds. No numerical rounding is required; provide a closed-form analytic expression as your final answer.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of numerical analysis for partial differential equations, specifically the Method of Lines and linear stability theory for Ordinary Differential Equations (ODEs). It is well-posed, objective, and contains all necessary information to derive a unique, meaningful solution.\n\nThe problem asks for the maximal stable timestep $\\Delta t_{\\max}$ for the time integration of the semi-discrete system $\\frac{d\\boldsymbol{\\psi}(t)}{dt} = A \\boldsymbol{\\psi}(t)$ using the classical fourth-order Runge-Kutta (RK$4$) method. The stability of a numerical method for a linear system is determined by its performance on the scalar test equation $\\frac{dy}{dt} = \\lambda y$, where $\\lambda$ is any eigenvalue of the matrix $A$.\n\nFor a one-step numerical method, the solution at time step $n+1$ is related to the solution at time step $n$ by an amplification factor $R(z)$, such that $y_{n+1} = R(z) y_n$, where $z = \\lambda \\Delta t$. The method is stable if and only if $|R(z)| \\le 1$ for all eigenvalues $\\lambda$ of $A$. The set of complex numbers $z$ for which this condition holds is the region of absolute stability.\n\nFirst, we must determine the stability function $R(z)$ for the given RK$4$ method. The method is defined by the Butcher tableau:\n$$\n\\begin{array}{c|cccc}\n0 & 0 & 0 & 0 & 0 \\\\\n\\frac{1}{2} & \\frac{1}{2} & 0 & 0 & 0 \\\\\n\\frac{1}{2} & 0 & \\frac{1}{2} & 0 & 0 \\\\\n1 & 0 & 0 & 1 & 0 \\\\\n\\hline\n & \\frac{1}{6} & \\frac{1}{3} & \\frac{1}{3} & \\frac{1}{6}\n\\end{array}\n$$\nApplying this method to the test equation $\\frac{dy}{dt} = \\lambda y$ gives the following stages:\n$k_1 = f(y_n) = \\lambda y_n$\n$k_2 = f(y_n + \\Delta t (\\frac{1}{2} k_1)) = \\lambda(y_n + \\frac{\\Delta t}{2} (\\lambda y_n)) = \\lambda y_n (1 + \\frac{\\lambda \\Delta t}{2})$\n$k_3 = f(y_n + \\Delta t (\\frac{1}{2} k_2)) = \\lambda(y_n + \\frac{\\Delta t}{2} (\\lambda y_n (1 + \\frac{\\lambda \\Delta t}{2}))) = \\lambda y_n (1 + \\frac{\\lambda \\Delta t}{2} + \\frac{(\\lambda \\Delta t)^2}{4})$\n$k_4 = f(y_n + \\Delta t (1 \\cdot k_3)) = \\lambda(y_n + \\Delta t (\\lambda y_n (1 + \\frac{\\lambda \\Delta t}{2} + \\frac{(\\lambda \\Delta t)^2}{4}))) = \\lambda y_n (1 + \\lambda \\Delta t + \\frac{(\\lambda \\Delta t)^2}{2} + \\frac{(\\lambda \\Delta t)^3}{4})$\n\nThe solution update is given by $y_{n+1} = y_n + \\Delta t \\sum_{i=1}^{4} b_i k_i$. Let $z = \\lambda \\Delta t$.\n$y_{n+1} = y_n + \\Delta t \\left[ \\frac{1}{6}(\\lambda y_n) + \\frac{1}{3}(\\lambda y_n(1+\\frac{z}{2})) + \\frac{1}{3}(\\lambda y_n(1+\\frac{z}{2}+\\frac{z^2}{4})) + \\frac{1}{6}(\\lambda y_n(1+z+\\frac{z^2}{2}+\\frac{z^3}{4})) \\right]$\n$\\frac{y_{n+1}}{y_n} = 1 + z \\left[ \\frac{1}{6} + \\frac{1}{3}(1+\\frac{z}{2}) + \\frac{1}{3}(1+\\frac{z}{2}+\\frac{z^2}{4}) + \\frac{1}{6}(1+z+\\frac{z^2}{2}+\\frac{z^3}{4}) \\right]$\n$R(z) = 1 + z \\left[ \\frac{1}{6} + \\frac{1}{3} + \\frac{1}{3} + \\frac{1}{6} \\right] + z^2 \\left[ \\frac{1}{6} + \\frac{1}{6} + \\frac{1}{6} \\right] + z^3 \\left[ \\frac{1}{12} + \\frac{1}{12} \\right] + z^4 \\left[ \\frac{1}{24} \\right]$\n$R(z) = 1 + z (1) + z^2 (\\frac{3}{6}) + z^3 (\\frac{2}{12}) + z^4 (\\frac{1}{24})$\n$R(z) = 1 + z + \\frac{z^2}{2} + \\frac{z^3}{6} + \\frac{z^4}{24} = \\sum_{k=0}^{4} \\frac{z^k}{k!}$\nThis is the truncated Taylor series expansion of $\\exp(z)$ of order $4$.\n\nThe problem states that the matrix $A$ is skew-Hermitian, which implies its eigenvalues $\\lambda_j$ are purely imaginary. We can write any such eigenvalue as $\\lambda = i\\omega$, where $\\omega$ is a real number representing a frequency.\nConsequently, $z = \\lambda \\Delta t = i \\omega \\Delta t$. We define a real variable $y = \\omega \\Delta t$, so $z=iy$. The stability condition $|R(z)| \\le 1$ becomes $|R(iy)| \\le 1$.\nSubstituting $z=iy$ into the stability function:\n$R(iy) = 1 + (iy) + \\frac{(iy)^2}{2} + \\frac{(iy)^3}{6} + \\frac{(iy)^4}{24}$\n$R(iy) = 1 + iy - \\frac{y^2}{2} - i\\frac{y^3}{6} + \\frac{y^4}{24}$\nWe group the real and imaginary parts:\n$R(iy) = \\left(1 - \\frac{y^2}{2} + \\frac{y^4}{24}\\right) + i\\left(y - \\frac{y^3}{6}\\right)$\n\nNow we evaluate the squared magnitude, $|R(iy)|^2$:\n$|R(iy)|^2 = \\left(1 - \\frac{y^2}{2} + \\frac{y^4}{24}\\right)^2 + \\left(y - \\frac{y^3}{6}\\right)^2$\nExpanding the terms:\n$|R(iy)|^2 = \\left(1 - y^2 + \\frac{y^4}{4} + \\frac{y^4}{12} - \\frac{y^6}{24} + \\frac{y^8}{576}\\right) + \\left(y^2 - \\frac{y^4}{3} + \\frac{y^6}{36}\\right)$\nCombining like powers of $y$:\n$|R(iy)|^2 = 1 + y^4 \\left(\\frac{1}{4} + \\frac{1}{12} - \\frac{1}{3}\\right) + y^6 \\left(-\\frac{1}{24} + \\frac{1}{36}\\right) + \\frac{y^8}{576}$\nThe coefficient of the $y^4$ term is $\\frac{3+1-4}{12} = 0$, which is expected for a $4$-th order method.\n$|R(iy)|^2 = 1 + y^6 \\left(\\frac{-3+2}{72}\\right) + \\frac{y^8}{576} = 1 - \\frac{y^6}{72} + \\frac{y^8}{576}$\n\nThe boundary of the stability region is found by setting $|R(iy)|=1$, or $|R(iy)|^2=1$.\n$1 - \\frac{y^6}{72} + \\frac{y^8}{576} = 1$\nFor non-trivial solutions where $y \\neq 0$, we can divide by $y^6$:\n$\\frac{y^2}{576} - \\frac{1}{72} = 0$\n$\\frac{y^2}{576} = \\frac{1}{72}$\n$y^2 = \\frac{576}{72} = 8$\n$|y| = \\sqrt{8} = 2\\sqrt{2}$\n\nThis result means that for stability, we require $|y| = |\\omega \\Delta t| \\le 2\\sqrt{2}$. This condition must hold for all eigenvalues $\\lambda_j = i\\omega_j$ of the matrix $A$.\n$|\\omega_j \\Delta t| \\le 2\\sqrt{2} \\quad \\forall j$\nThis is equivalent to:\n$\\Delta t \\cdot \\max_j |\\omega_j| \\le 2\\sqrt{2}$\nThe spectral radius of $A$ is defined as $\\rho(A) = \\max_j |\\lambda_j|$. Since $\\lambda_j = i\\omega_j$, we have $|\\lambda_j| = |i\\omega_j| = |\\omega_j|$. Thus, $\\rho(A) = \\max_j |\\omega_j|$.\nThe stability condition becomes:\n$\\Delta t \\cdot \\rho(A) \\le 2\\sqrt{2}$\nThe maximal stable timestep, $\\Delta t_{\\max}$, corresponds to the equality:\n$\\Delta t_{\\max} = \\frac{2\\sqrt{2}}{\\rho(A)}$\n\nThe problem asks for a physical interpretation. This result is a form of the Courant-Friedrichs-Lewy (CFL) condition. The spectral radius $\\rho(A)$ of the semi-discrete streaming operator is determined by the highest frequency spatial mode supportable by the grid and the particle speed. For a spatial grid with spacing $\\Delta x$ and maximum characteristic speed $v_{\\max}$, $\\rho(A)$ is proportional to $\\frac{v_{\\max}}{\\Delta x}$. Therefore, $\\Delta t_{\\max} \\propto \\frac{\\Delta x}{v_{\\max}}$. This means the timestep must be small enough such that a particle traveling at the maximum speed does not cross more than a certain number of spatial cells in one timestep. The constant of proportionality, $2\\sqrt{2}$, is specific to the stability properties of the RK$4$ method for purely oscillatory systems (as described by skew-Hermitian operators). A different numerical scheme would yield a different constant. The expression provides the answer in seconds, as the units of $\\rho(A)$ are inverse seconds ($s^{-1}$) from the governing equation $\\frac{d\\boldsymbol{\\psi}}{dt} = A\\boldsymbol{\\psi}$.",
            "answer": "$$\n\\boxed{\\frac{2\\sqrt{2}}{\\rho(A)}}\n$$"
        }
    ]
}