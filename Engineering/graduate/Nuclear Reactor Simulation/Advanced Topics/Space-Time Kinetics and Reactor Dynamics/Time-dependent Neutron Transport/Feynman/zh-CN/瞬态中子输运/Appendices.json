{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的数值方法之前，通过一个思想实验来建立对中子输运物理本质的直观理解至关重要。本练习将引导你推导无限均匀介质中玻尔兹曼方程的格林函数（或脉冲响应），完全基于粒子直线飞行和衰减的基本物理原理 。掌握这种从第一性原理出发的分析方法，对于理解和验证更复杂的瞬态模拟结果具有不可估量的价值。",
            "id": "4257675",
            "problem": "考虑在均匀、无限介质中，速度为 $v$ 的单能中子，其宏观总截面为 $\\Sigma_{t}$ 且无散射。角通量 $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)$ 的含时线性 Boltzmann 输运方程为\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)}{\\partial t} + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) + \\Sigma_{t}\\,\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t),\n$$\n其中 $Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t)$ 是一个外源项。设源是位于 $\\mathbf{r}=\\mathbf{0}$ 处的各向同性点源，其时间分布为 $s(t)$，因此有\n$$\nQ(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = \\frac{s(t)}{4\\pi}\\,\\delta^{(3)}(\\mathbf{r}),\n$$\n其中 $\\delta^{(3)}(\\mathbf{r})$ 是三维 Dirac delta 函数。\n\n1. 使用带衰减的直线飞行的第一性原理，推导该系统的角积分脉冲响应（标量通量格林函数）$G(r, t)$。它由关系式 $\\phi(\\mathbf{r}, t) = \\int_{4\\pi} \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)\\,d\\boldsymbol{\\Omega} = S\\,G(r, t)$ 定义，其中 $s(t) = S\\,\\delta(t)$ 且 $r = |\\mathbf{r}|$。\n\n2. 现在考虑一个短时矩形源脉冲，$s(t) = q_{0}$ (当 $0 \\le t \\le \\Delta t$) 且在其他情况下 $s(t) = 0$，其恒定发射率为 $q_{0}$，持续时间为 $\\Delta t$。使用你得到的脉冲响应，预测在距离源 $R$ 处的一点、在时间 $T$ 观测到的标量通量 $\\phi(R, T)$。将你的最终结果表示为单个闭式解析表达式，该表达式可包含 Dirac delta 函数和 Heaviside 阶跃函数 $H(\\cdot)$。\n\n将标量通量以 $\\text{cm}^{-2}\\,\\text{s}^{-1}$ 为单位表示。无需进行数值计算或四舍五入；请提供精确表达式。",
            "solution": "该问题经评估是有效的，因为它在科学上基于线性输运理论的原理，在数学上是适定的，并且陈述客观明确。因此，我们可以着手求解。\n\n该问题分为两部分。首先，我们推导标量通量的脉冲响应，即格林函数。其次，我们利用此响应来确定由有限矩形源脉冲产生的标量通量。\n\n**第一部分：脉冲响应（格林函数）的推导**\n\n题目要求我们使用带衰减的直线飞行的第一性原理来推导角积分脉冲响应 $G(r, t)$。控制方程是在纯吸收（$\\Sigma_s = 0$，因此 $\\Sigma_a = \\Sigma_t$）无限均匀介质中，单能中子的含时 Boltzmann 输运方程：\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)}{\\partial t} + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) + \\Sigma_{t}\\,\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t)\n$$\n对于脉冲响应，源是在时间 $t=0$ 时，于原点处各向同性爆发的 $S$ 个中子：\n$$\nQ(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = \\frac{S\\,\\delta(t)}{4\\pi}\\,\\delta^{(3)}(\\mathbf{r})\n$$\n直线飞行的第一性原理指出，在没有散射的情况下，在时间 $t$、位置 $\\mathbf{r}$ 处探测到的中子必定是从其出发点沿直线飞行而来的。对于给定的源，所有中子都起源于 $\\mathbf{r}'=\\mathbf{0}$。\n\n在位置 $\\mathbf{r}$ 处探测到的中子必定飞行了距离 $r = |\\mathbf{r}|$。由于所有中子都具有速度 $v$，飞行时间唯一确定为 $r/v$。源仅在 $t=0$ 时发射中子。因此，只有在精确的时刻 $t = r/v$ 才能在位置 $\\mathbf{r}$ 处探测到中子。这意味着在 $\\mathbf{r}$ 处的通量的时间依赖性必须与 Dirac delta 函数 $\\delta(t - r/v)$ 成正比。\n\n中子从原点各向同性地发射。中子数随距离减小是由于两个效应：\n1.  **几何展宽**：中子散布在面积为 $4\\pi r^2$ 的球面上。因此，通量必须与 $1/r^2$ 成正比。\n2.  **衰减**：当中子在介质中穿行时，它们会被吸收。根据 Beer-Lambert 定律，中子飞行距离 $r$ 而不被吸收的概率为 $\\exp(-\\Sigma_t r)$。\n\n结合这些物理论证，我们可以构建标量通量 $\\phi(\\mathbf{r}, t)$，它是在 $(\\mathbf{r}, t)$ 处单位时间内穿过单位面积并对所有方向求和的中子数。源发射的中子总数为 $S$。在距离 $r$ 处的时间积分通量（注量）是单位面积上的总中子数，即 $\\frac{S}{4\\pi r^2}\\exp(-\\Sigma_t r)$。由于所有这些中子都在时间 $t=r/v$ 同时到达，瞬时通量就是这个注量乘以一个时间上的 delta 函数。\n$$\n\\phi(\\mathbf{r}, t) = \\frac{S}{4\\pi r^2} \\exp(-\\Sigma_t r) \\delta\\left(t - \\frac{r}{v}\\right)\n$$\n问题通过关系式 $\\phi(\\mathbf{r}, t) = S\\,G(r, t)$ 定义了标量通量格林函数 $G(r, t)$。通过将其与我们推导的 $\\phi(\\mathbf{r}, t)$ 表达式进行比较，我们可以确定格林函数为：\n$$\nG(r, t) = \\frac{1}{4\\pi r^2} \\exp(-\\Sigma_t r) \\delta\\left(t - \\frac{r}{v}\\right)\n$$\n这就是标量通量的脉冲响应。\n\n**第二部分：来自矩形脉冲的标量通量**\n\n我们现在考虑一个具有短时矩形时间分布的源：当 $0 \\le t \\le \\Delta t$ 时，$s(t) = q_{0}$，其他情况下 $s(t) = 0$。这里，$q_{0}$ 是以“中子数/秒”为单位的恒定发射率。我们可以使用 Heaviside 阶跃函数 $H(t)$ 来表示它：\n$$\ns(t) = q_{0} \\left[ H(t) - H(t - \\Delta t) \\right]\n$$\n输运方程是线性的，因此对于一个一般源 $s(t)$ 的解，可以通过将脉冲响应与源的时间分布进行卷积得到。标量通量 $\\phi(\\mathbf{r}, t)$ 由下式给出：\n$$\n\\phi(\\mathbf{r}, t) = \\int_{-\\infty}^{\\infty} s(t') \\, G(r, t - t') \\, dt'\n$$\n我们需要求解在距离 $r=R$、时间 $t=T$ 处的标量通量 $\\phi(R, T)$。代入 $s(t')$ 和 $G(R, T-t')$ 的表达式：\n$$\n\\phi(R, T) = \\int_{-\\infty}^{\\infty} q_{0} \\left[ H(t') - H(t' - \\Delta t) \\right] \\left[ \\frac{1}{4\\pi R^2} \\exp(-\\Sigma_t R) \\delta\\left(T - t' - \\frac{R}{v}\\right) \\right] dt'\n$$\n不依赖于积分变量 $t'$ 的项可以移到积分符号外面：\n$$\n\\phi(R, T) = \\frac{q_0}{4\\pi R^2} \\exp(-\\Sigma_t R) \\int_{-\\infty}^{\\infty} \\left[ H(t') - H(t' - \\Delta t) \\right] \\delta\\left(T - \\frac{R}{v} - t'\\right) dt'\n$$\n我们使用 Dirac delta 函数的筛选性质，$\\int_{-\\infty}^{\\infty} f(x)\\delta(a-x)dx = f(a)$。在我们的例子中，变量是 $t'$，函数是 $f(t') = H(t') - H(t' - \\Delta t)$，求值点是 $a = T - R/v$。\n积分计算结果为：\n$$\n\\int_{-\\infty}^{\\infty} \\left[ H(t') - H(t' - \\Delta t) \\right] \\delta\\left(\\left(T - \\frac{R}{v}\\right) - t'\\right) dt' = H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right)\n$$\n将此结果代回标量通量的表达式中，我们得到最终结果：\n$$\n\\phi(R, T) = \\frac{q_0}{4\\pi R^2} \\exp(-\\Sigma_t R) \\left[ H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right) \\right]\n$$\n这个表达式描述了一个矩形中子脉冲到达探测器的情况。在第一批中子（于 $t=0$ 发射）在时间 $T=R/v$ 到达之前，通量为零。然后通量保持一个恒定值，直到最后一批中子（于 $t=\\Delta t$ 发射）在时间 $T=R/v + \\Delta t$ 到达，此后通量降回零。",
            "answer": "$$\n\\boxed{\\frac{q_{0}}{4\\pi R^{2}} \\exp(-\\Sigma_{t} R) \\left( H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right) \\right)}\n$$"
        },
        {
            "introduction": "中子输运理论的核心变量是角通量 $\\psi$，它描述了中子在特定位置、特定方向上的行为，但在实际应用中，我们更关心的是对所有方向积分得到的标量通量 $\\phi$。本练习旨在连接这两个关键概念，要求你利用离散纵标法 (discrete ordinates method) 中的数值求积法则，从给定的角通量数据计算出标量通量 。这个计算练习是理解和使用输运程序输出结果的一项基本技能。",
            "id": "4257640",
            "problem": "考虑一个一维平面板状反应堆，该反应堆是均匀的，且在横向上无限延伸。设空间坐标为 $x$，其中 $x=0$ 位于中平面。假设关于中平面存在反射对称性，因此在 $x=0$ 处，角通量是方向余弦的偶函数，即对于任意时间 $t$ 和所有 $\\mu \\in [-1,1]$，都有 $\\psi(0,\\mu,t)=\\psi(0,-\\mu,t)$。假设角通量已对能量积分，从而忽略能量依赖性。\n\n从标量通量是角通量在所有立体角上的积分这一定义出发，仅利用平面几何和中平面反射对称性所蕴含的不变性，将相空间角度积分简化为在中平面 $x=0$ 处对方向余弦 $\\mu=\\cos\\theta \\in [0,1]$ 的一维积分。\n\n在时间 $t=t_{0}$ 时，给出了 $x=0$ 处半程角通量的离散纵标表示，其在 $[0,1]$ 上的三个高斯-勒让德求积点如下：\n- 横坐标：$\\mu_{1}=\\dfrac{1-\\sqrt{3/5}}{2}$，$\\mu_{2}=\\dfrac{1}{2}$，$\\mu_{3}=\\dfrac{1+\\sqrt{3/5}}{2}$。\n- 在 $[0,1]$ 上积分的相应权重：$w_{1}=\\dfrac{5}{18}$，$w_{2}=\\dfrac{4}{9}$，$w_{3}=\\dfrac{5}{18}$。\n- 在中平面和时间 $t_{0}$ 时的角通量值（单位：中子 $\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}$）：$\\psi(0,\\mu_{1},t_{0})=1.30\\times 10^{13}$，$\\psi(0,\\mu_{2},t_{0})=1.10\\times 10^{13}$，$\\psi(0,\\mu_{3},t_{0})=0.90\\times 10^{13}$。\n\n仅使用以上信息和与所提供的横坐标和权重一致的求积方法，计算中平面处的标量通量 $\\phi(0,t_{0})$。以中子 $\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ 为单位表示最终结果，并将答案四舍五入到四位有效数字。",
            "solution": "用户提供了一个核反应堆物理领域的问题，具体涉及在一维平面几何中根据角中子通量数据计算标量中子通量。我将首先验证问题陈述，然后提供详细的解答。\n\n### 步骤 1：提取已知条件\n-   **几何**：一维均匀平面板，横向无限。\n-   **空间坐标**：$x$，其中 $x=0$ 位于中平面。\n-   **对称性**：关于中平面的反射对称性：对于 $\\mu \\in [-1,1]$ 和任意时间 $t$，有 $\\psi(0,\\mu,t)=\\psi(0,-\\mu,t)$。\n-   **能量**：忽略能量依赖性（单能模型）。\n-   **标量通量定义**：$\\phi$ 是角通量 $\\psi$ 在所有立体角上的积分。\n-   **方向余弦**：$\\mu = \\cos\\theta$，其中 $\\theta$ 是与 $x$ 轴正向的夹角。\n-   **任务 1**：将标量通量 $\\phi(0, t)$ 的角度积分简化为在 $\\mu \\in [0,1]$ 上的一维积分。\n-   **任务 2**：使用离散纵标法计算中平面处的标量通量 $\\phi(0,t_0)$。\n-   **在 $x=0, t=t_0$ 时的离散纵标数据**：提供了一个用于在区间 $[0,1]$ 上积分的三点高斯-勒让德求积点集：\n    -   横坐标：$\\mu_{1}=\\dfrac{1-\\sqrt{3/5}}{2}$，$\\mu_{2}=\\dfrac{1}{2}$，$\\mu_{3}=\\dfrac{1+\\sqrt{3/5}}{2}$。\n    -   权重：$w_{1}=\\dfrac{5}{18}$，$w_{2}=\\dfrac{4}{9}$，$w_{3}=\\dfrac{5}{18}$。\n    -   角通量值：$\\psi(0,\\mu_{1},t_{0})=1.30\\times 10^{13} \\, \\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\\cdot\\mathrm{sr}^{-1}$，$\\psi(0,\\mu_{2},t_{0})=1.10\\times 10^{13} \\, \\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\\cdot\\mathrm{sr}^{-1}$，$\\psi(0,\\mu_{3},t_{0})=0.90\\times 10^{13} \\, \\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\\cdot\\mathrm{sr}^{-1}$。\n-   **输出要求**：$\\phi(0,t_0)$ 的最终答案必须以 $\\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}$ 为单位，并四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上基于已建立的中子输运理论。角通量、标量通量、反射边界条件以及带高斯-勒让德求积的离散纵标法等概念是核工程中的标准内容。所提供的求积点集是将标准的三点高斯-勒让德求积从区间 $[-1,1]$ 到 $[0,1]$ 的有效变换。给出的角通量物理值是合理的。该问题陈述清晰、客观、自洽且一致。它代表了该领域的标准计算。\n\n### 步骤 3：结论与行动\n该问题被认定为有效。将提供解答。\n\n### 解答\n\n第一步是从标量通量的基本定义出发，推导其在中平面处的表达式。标量通量 $\\phi(x,t)$ 定义为角通量 $\\psi(x, \\vec{\\Omega}, t)$ 在整个 $4\\pi$ 立体角上的积分。\n\n$$\n\\phi(x,t) = \\int_{4\\pi} \\psi(x, \\vec{\\Omega}, t) \\, d\\Omega\n$$\n\n在一维平面几何中，角通量取决于空间位置 $x$、时间 $t$ 以及唯一一个角度变量，即中子方向矢量 $\\vec{\\Omega}$ 与 $x$ 轴夹角 $\\theta$ 的余弦。该余弦记为 $\\mu = \\cos\\theta$。角通量与方位角 $\\varphi$ 无关。因此，$\\psi(x, \\vec{\\Omega}, t) = \\psi(x, \\mu, t)$。\n\n立体角微元 $d\\Omega$ 可以用 $\\mu$ 和 $\\varphi$ 表示为 $d\\Omega = d\\mu \\, d\\varphi$。对所有立体角的积分就变成了对 $\\varphi$ 从 $0$ 到 $2\\pi$ 和对 $\\mu$ 从 $-1$ 到 $1$ 的积分。\n\n$$\n\\phi(x,t) = \\int_{-1}^{1} \\int_{0}^{2\\pi} \\psi(x, \\mu, t) \\, d\\varphi \\, d\\mu\n$$\n\n由于 $\\psi(x, \\mu, t)$ 与 $\\varphi$ 无关，对方位角的积分得到一个因子 $2\\pi$。\n\n$$\n\\phi(x,t) = 2\\pi \\int_{-1}^{1} \\psi(x, \\mu, t) \\, d\\mu\n$$\n\n我们关心的是中平面 $x=0$ 处的标量通量。\n\n$$\n\\phi(0,t) = 2\\pi \\int_{-1}^{1} \\psi(0, \\mu, t) \\, d\\mu\n$$\n\n问题陈述中提到，关于中平面存在反射对称性，这意味着在 $x=0$ 处角通量是 $\\mu$ 的偶函数，即 $\\psi(0, \\mu, t) = \\psi(0, -\\mu, t)$。我们可以利用这个性质来简化积分。我们将区间 $[-1, 1]$ 上的积分分成两部分：\n\n$$\n\\int_{-1}^{1} \\psi(0, \\mu, t) \\, d\\mu = \\int_{-1}^{0} \\psi(0, \\mu, t) \\, d\\mu + \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu\n$$\n\n在右边的第一个积分中，我们进行换元，令 $\\mu' = -\\mu$，这意味着 $d\\mu = -d\\mu'$。积分限从 $\\mu \\in [-1, 0]$ 变为 $\\mu' \\in [1, 0]$。\n\n$$\n\\int_{-1}^{0} \\psi(0, \\mu, t) \\, d\\mu = \\int_{1}^{0} \\psi(0, -\\mu', t) \\, (-d\\mu') = \\int_{0}^{1} \\psi(0, -\\mu', t) \\, d\\mu'\n$$\n\n利用偶对称性 $\\psi(0, -\\mu', t) = \\psi(0, \\mu', t)$，该积分变为：\n\n$$\n\\int_{0}^{1} \\psi(0, \\mu', t) \\, d\\mu'\n$$\n\n由于 $\\mu'$ 是积分哑元，这等于在正半程上的积分。将此结果代入完整积分的表达式中：\n\n$$\n\\int_{-1}^{1} \\psi(0, \\mu, t) \\, d\\mu = \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu + \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu = 2 \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu\n$$\n\n最后，我们将这个结果代入中平面标量通量的表达式中：\n\n$$\n\\phi(0,t) = 2\\pi \\left( 2 \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu \\right) = 4\\pi \\int_{0}^{1} \\psi(0, \\mu, t) \\, d\\mu\n$$\n\n这完成了任务的第一部分，将问题简化为在 $\\mu \\in [0,1]$ 上的一个一维积分。\n\n对于第二部分，我们使用提供的离散纵标求积点集来计算时间 $t_0$ 时的标量通量值。该积分通过在求积横坐标处的函数值的加权和来近似：\n\n$$\n\\int_{0}^{1} \\psi(0, \\mu, t_0) \\, d\\mu \\approx \\sum_{i=1}^{3} w_i \\psi(0, \\mu_i, t_0)\n$$\n\n因此，标量通量近似为：\n\n$$\n\\phi(0,t_0) \\approx 4\\pi \\sum_{i=1}^{3} w_i \\psi(0, \\mu_i, t_0)\n$$\n\n现在，我们代入给定的数值：\n-   $w_{1}=\\dfrac{5}{18}$， $w_{2}=\\dfrac{4}{9}=\\dfrac{8}{18}$， $w_{3}=\\dfrac{5}{18}$\n-   $\\psi(0,\\mu_{1},t_{0})=1.30\\times 10^{13}$\n-   $\\psi(0,\\mu_{2},t_{0})=1.10\\times 10^{13}$\n-   $\\psi(0,\\mu_{3},t_{0})=0.90\\times 10^{13}$\n\n求和项计算如下：\n$$\n\\sum_{i=1}^{3} w_i \\psi(0, \\mu_i, t_0) = \\left(\\frac{5}{18}\\right)(1.30\\times 10^{13}) + \\left(\\frac{8}{18}\\right)(1.10\\times 10^{13}) + \\left(\\frac{5}{18}\\right)(0.90\\times 10^{13})\n$$\n$$\n= \\frac{10^{13}}{18} [5(1.30) + 8(1.10) + 5(0.90)]\n$$\n$$\n= \\frac{10^{13}}{18} [6.5 + 8.8 + 4.5]\n$$\n$$\n= \\frac{10^{13}}{18} [19.8] = 1.1 \\times 10^{13} \\, \\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\\cdot\\mathrm{sr}^{-1}\n$$\n\n现在，我们计算标量通量 $\\phi(0, t_0)$。$\\psi$ 的单位是 中子 $\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}\\,\\mathrm{sr}^{-1}$。对 $4\\pi$ 球面度的立体角进行积分，消除了“每球面度”这一单位，从而得到单位为 中子 $\\mathrm{cm}^{-2}\\,\\mathrm{s}^{-1}$ 的标量通量。\n\n$$\n\\phi(0,t_0) \\approx 4\\pi \\times (1.1 \\times 10^{13}) = 4.4\\pi \\times 10^{13}\n$$\n$$\n\\phi(0,t_0) \\approx 13.82300767... \\times 10^{13} = 1.382300767... \\times 10^{14}\n$$\n\n问题要求答案四舍五入到四位有效数字。\n\n$$\n\\phi(0,t_0) \\approx 1.382 \\times 10^{14} \\, \\text{中子} \\cdot \\mathrm{cm}^{-2}\\cdot\\mathrm{s}^{-1}\n$$",
            "answer": "$$\n\\boxed{1.382 \\times 10^{14}}\n$$"
        },
        {
            "introduction": "特征线法 (Method of Characteristics, MOC) 是求解中子输运方程，尤其是在复杂几何问题中，功能最强大、最精确的数值方法之一。本实践练习将带你进入瞬态输运模拟的核心，通过在一个简化的二维针元模型中实现单时间步的瞬态MOC扫描来计算通量变化 。通过完成这个练习，你将对真实反应堆分析程序中用于处理时间和空间依赖性的复杂算法获得具体而深入的理解。",
            "id": "4257681",
            "problem": "考虑一个轴向无限长的二维燃料棒栅元中的含时中子输运。使用特征线法 (MOC)，在平源近似下，将角通量推进一个时间步。从沿特征线的含时玻尔兹曼输运方程开始，对于单能群和二维平面几何，该方程为\n$$(1/v)\\,\\frac{\\partial \\psi(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega\\cdot\\nabla \\psi(\\mathbf{r},\\Omega,t) + \\Sigma_t(\\mathbf{r},t)\\,\\psi(\\mathbf{r},\\Omega,t) = q(\\mathbf{r},\\Omega,t),$$\n其中 $v$ 是中子速度，$\\psi$ 是角通量，$\\Omega$ 是平面内的方向单位矢量，$\\Sigma_t$ 是总宏观截面，$q$ 是总源（包括散射和裂变）。假设在每个均匀区域和每个径迹段内，材料属性和源是分段常数，并且在所有径迹入口处采用真空边界条件。\n\n您必须在一组给定的特征径迹上实现瞬态 MOC 扫描。使用大小为 $\\Delta t$ 的单个时间步进行后向欧拉时间离散，并根据上述基本方程，对每个区域中的有效衰减和有效源进行一致的建模。将提供的源矩视为二维方位角中的零阶勒让德矩（各向同性矩），并假设上一时刻的角通量矩是各向同性且在区域内为常数。对于每条径迹，顺序遍历其径迹段，并根据该径迹段的入射角通量、有效衰减和有效源来更新出射角通量。然后，通过使用给定的径迹权重对沿径迹段的角通量进行积分，再除以区域面积，来计算新时刻的区域平均标量通量。最后，计算每个区域在新旧时间层之间的标量通量变化。\n\n所有物理单位必须明确且一致地使用：\n- 截面 $\\Sigma_t$ 的单位是 $\\mathrm{cm^{-1}}$。\n- 中子速度 $v$ 的单位是 $\\mathrm{cm/s}$。\n- 时间步长 $\\Delta t$ 的单位是 $\\mathrm{s}$。\n- 径迹段长度 $L$ 的单位是 $\\mathrm{cm}$。\n- 区域面积 $A$ 的单位是 $\\mathrm{cm^2}$。\n- 径迹权重 $w_m$ 的单位是 $\\mathrm{cm\\cdot rad}$，表示方位角求积权重（单位为弧度）与径迹间距（单位为厘米）的乘积。\n- 各向同性源矩 $S$ 的单位是 $\\mathrm{n/(cm^3\\cdot s\\cdot rad)}$。\n- 角通量矩 $\\bar{\\psi}^n$ 的单位是 $\\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n- 每个区域的标量通量变化 $\\Delta \\phi$ 必须以 $\\mathrm{n/(cm^2\\cdot s)}$ 为单位表示。\n\n您的程序必须为每个测试用例生成每个区域的标量通量变化。新时间层的标量通量必须通过对每个径迹段上的角通量进行积分并使用提供的径迹权重进行汇编来计算；上一时刻的标量通量必须通过使用相同的径迹几何和权重对上一时刻的各向同性角通量进行积分来计算。变化量是这两个标量通量之间的差值。\n\n使用以下测试套件。在所有情况下，都有两个区域：区域 $0$ 是燃料，区域 $1$ 是慢化剂。有两个特征径迹族。在每条径迹的起点施加真空边界条件。\n\n- 测试用例 $1$ (正常路径):\n  - 时间步长: $\\Delta t = 1.0\\times 10^{-5}\\ \\mathrm{s}$。\n  - 区域 $0$ (燃料): $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 0.8\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 1.5\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 3.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 区域 $1$ (慢化剂): $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.2\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.5\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 1.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 径迹:\n    - 径迹 $m=0$: 权重 $w_0 = 1.2\\ \\mathrm{cm\\cdot rad}$, 径迹段 $\\{(r=0, L=0.7\\ \\mathrm{cm}),\\ (r=1, L=0.5\\ \\mathrm{cm})\\}$。\n    - 径迹 $m=1$: 权重 $w_1 = 1.6\\ \\mathrm{cm\\cdot rad}$, 径迹段 $\\{(r=0, L=0.3\\ \\mathrm{cm}),\\ (r=1, L=1.1\\ \\mathrm{cm})\\}$。\n- 测试用例 $2$ (小时间步，瞬态主导):\n  - 时间步长: $\\Delta t = 1.0\\times 10^{-7}\\ \\mathrm{s}$。\n  - 区域 $0$: $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 0.8\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 1.2\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 3.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 区域 $1$: $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.2\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.4\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 1.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 径迹: 与测试用例 $1$ 相同。\n- 测试用例 $3$ (材料反差和无源燃料):\n  - 时间步长: $\\Delta t = 5.0\\times 10^{-5}\\ \\mathrm{s}$。\n  - 区域 $0$: $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 2.5\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 0.0\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 2.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 区域 $1$: $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.05\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.2\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 5.0\\times 10^3\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$。\n  - 径迹: 与测试用例 $1$ 相同。\n\n您的程序必须：\n- 实现一个与基本方程和指定离散化一致的瞬态 MOC 扫描。\n- 通过沿每个径迹段使用给定权重对角通量进行积分并除以区域面积，计算 $t^{n+1}$ 时刻的区域平均标量通量。\n- 使用相同的径迹几何和权重，从 $\\bar{\\psi}^n$ 计算上一时刻的标量通量。\n- 对每个测试用例，输出区域 $r=0$ 和 $r=1$ 的标量通量变化 $\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n$，单位为 $\\mathrm{n/(cm^2\\cdot s)}$。\n\n最终输出格式要求：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为 $\\big[\\Delta \\phi_{0}^{(1)}, \\Delta \\phi_{1}^{(1)}, \\Delta \\phi_{0}^{(2)}, \\Delta \\phi_{1}^{(2)}, \\Delta \\phi_{0}^{(3)}, \\Delta \\phi_{1}^{(3)}\\big]$，其中上标表示测试用例索引。每个列表元素必须是浮点数。",
            "solution": "从单能群和二维平面几何中的含时玻尔兹曼输运方程开始，\n$$(1/v)\\,\\frac{\\partial \\psi(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega\\cdot\\nabla \\psi(\\mathbf{r},\\Omega,t) + \\Sigma_t(\\mathbf{r},t)\\,\\psi(\\mathbf{r},\\Omega,t) = q(\\mathbf{r},\\Omega,t),$$\n其中 $v$ 是中子速度，$\\psi$ 是角通量，$\\Omega$ 是平面内的方向单位矢量，$\\Sigma_t$ 是总宏观截面，$q$ 是总源，包括散射和裂变贡献。沿着以弧长 $s$ 为参数、方向为 $\\Omega$ 的直线特征径迹，流项简化为 $\\mathrm{d}\\psi/\\mathrm{d}s$。在大小为 $\\Delta t$ 的单个时间步上应用后向欧拉时间离散，在一个均匀区域内得到，\n$$(1/v)\\,\\frac{\\psi^{n+1}(s) - \\psi^n(s)}{\\Delta t} + \\frac{\\mathrm{d}\\psi^{n+1}(s)}{\\mathrm{d}s} + \\Sigma_t^{n+1}\\,\\psi^{n+1}(s) = q^{n+1},$$\n其中上标 $n$ 和 $n+1$ 分别表示上一时间层和新时间层，并假定在平源近似下，$q^{n+1}$ 在径迹段内是分段常数。\n\n整理各项，我们得到一个关于 $s$ 的、在时间层 $n+1$ 上的一阶线性常微分方程，\n$$\\frac{\\mathrm{d}\\psi^{n+1}(s)}{\\mathrm{d}s} + \\left(\\Sigma_t^{n+1} + \\frac{1}{v\\,\\Delta t}\\right)\\psi^{n+1}(s) = q^{n+1} + \\frac{1}{v\\,\\Delta t}\\,\\psi^n(s).$$\n在与平源假设一致的标准瞬态 MOC 近似下，我们将 $\\psi^n(s)$ 视为区域内常数，并等于该区域给定的各向同性角通量矩 $\\bar{\\psi}^n$。定义该径迹段的有效总衰减和有效源，\n$$\\Sigma_{\\mathrm{eff}} \\equiv \\Sigma_t^{n+1} + \\frac{1}{v\\,\\Delta t}, \\qquad \\tilde{q} \\equiv q^{n+1} + \\frac{1}{v\\,\\Delta t}\\,\\bar{\\psi}^{n}.$$\n在每条径迹的入口处采用真空边界条件，对于长度为 $L$、入射角通量为 $\\psi_{\\mathrm{in}}$ 的径迹段，其解可通过求解该线性常微分方程得到，\n$$\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\,e^{-\\Sigma_{\\mathrm{eff}}\\,L} + \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\left(1 - e^{-\\Sigma_{\\mathrm{eff}}\\,L}\\right).$$\n为了计算对区域平均标量通量的贡献，我们需要径迹段上的线积分角通量，\n$$J \\equiv \\int_{0}^{L} \\psi^{n+1}(s)\\,\\mathrm{d}s = \\left(\\psi_{\\mathrm{in}} - \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\right)\\frac{1 - e^{-\\Sigma_{\\mathrm{eff}}\\,L}}{\\Sigma_{\\mathrm{eff}}} + \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\,L.$$\n对于二维方位角积分，我们通过对所有径迹 $m$ 进行汇集（权重为 $w_m$，单位为 $\\mathrm{cm\\cdot rad}$），然后除以区域面积 $A_r$，来近似计算 $t^{n+1}$ 时刻的区域平均标量通量，\n$$\\phi_r^{n+1} = \\frac{1}{A_r}\\sum_{m} w_m \\sum_{k\\in \\mathcal{K}(r,m)} J_{r,m,k},$$\n其中 $\\mathcal{K}(r,m)$ 索引了径迹 $m$ 中位于区域 $r$ 内的径迹段。对于上一时刻的标量通量，使用假定在区域 $r$ 内为常数的各向同性角通量矩 $\\bar{\\psi}_r^n$，长度为 $L$ 的径迹段的线积分角通量即为 $\\bar{\\psi}_r^n\\,L$，因此 $t^n$ 时刻的区域平均标量通量为\n$$\\phi_r^{n} = \\frac{1}{A_r}\\sum_{m} w_m \\sum_{k\\in \\mathcal{K}(r,m)} \\bar{\\psi}_r^n\\,L_{r,m,k}.$$\n该时间步内标量通量的变化为\n$$\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n.$$\n\n瞬态 MOC 扫描的算法设计：\n- 对每个区域 $r$，计算 $\\Sigma_{\\mathrm{eff},r} = \\Sigma_{t,r}^{n+1} + 1/(v_r\\,\\Delta t)$ 和 $\\tilde{q}_r = S_r^{n+1} + \\bar{\\psi}_r^n/(v_r\\,\\Delta t)$，其中 $S_r^{n+1}$ 是区域 $r$ 的各向同性源矩。\n- 对每条权重为 $w_m$ 的径迹 $m$，初始化入射角通量 $\\psi_{\\mathrm{in}} = 0$ (真空)。沿径迹顺序对每个径迹段 $(r,L)$：\n  - 计算 $e^{-\\Sigma_{\\mathrm{eff},r} L}$。\n  - 使用 $\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\,e^{-\\Sigma_{\\mathrm{eff},r} L} + (\\tilde{q}_r/\\Sigma_{\\mathrm{eff},r})(1 - e^{-\\Sigma_{\\mathrm{eff},r} L})$ 更新出射角通量。\n  - 使用上述表达式计算线积分径迹段贡献 $J$。\n  - 将 $w_m\\,J$ 累加到区域 $r$ 用于计算 $\\phi_r^{n+1}$ 的分子上。\n  - 为径迹中的下一个径迹段设置 $\\psi_{\\mathrm{in}} \\leftarrow \\psi_{\\mathrm{out}}$。\n- 在处理完所有径迹后，将每个区域的累加和除以 $A_r$ 以获得 $\\phi_r^{n+1}$。\n- 使用各向同性矩 $\\bar{\\psi}_r^n$ 计算 $\\phi_r^{n}$：将区域 $r$ 内各径迹段的 $w_m\\,\\bar{\\psi}_r^n\\,L$ 累加起来，然后除以 $A_r$。\n- 计算 $\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n$。\n- 对每个测试用例重复此过程。\n\n此过程与基本输运方程、后向欧拉时间离散和平源近似一致。单位在内部是自洽的：线积分角通量 $J$ 的单位是 $\\mathrm{n/(cm\\cdot s\\cdot rad)}$，乘以 $w_m$ (单位为 $\\mathrm{cm\\cdot rad}$) 得到 $\\mathrm{n/s}$，再除以面积 $A_r$ (单位为 $\\mathrm{cm^2}$) 得到标量通量 (单位为 $\\mathrm{n/(cm^2\\cdot s)}$)。上一时刻的标量通量使用相同的几何加权，确保计算出的变化 $\\Delta \\phi_r$ 的单位是 $\\mathrm{n/(cm^2\\cdot s)}$。\n\n实现直接遵循此过程，编码三个测试用例并按要求格式生成单行输出。",
            "answer": "```python\nimport numpy as np\n\ndef transient_moc_flux_change(regions, tracks, dt):\n    \"\"\"\n    Compute region-wise scalar flux change over one time step using transient MOC.\n    regions: dict of region_id - dict with keys:\n        'A' (area, cm^2),\n        'sigma_t' (total cross section at n+1, cm^-1),\n        'v' (speed, cm/s),\n        'S' (isotropic source at n+1, n/(cm^3*s*rad)),\n        'psi_prev' (isotropic angular flux at n, n/(cm^2*s*rad))\n    tracks: list of dicts, each with keys:\n        'weight' (cm*rad),\n        'segments' (list of tuples (region_id, length_cm)), in sequence along the track\n    dt: time step (s)\n    Returns: list of delta_phi per region, in n/(cm^2*s)\n    \"\"\"\n    region_ids = sorted(regions.keys())\n    # Precompute effective parameters per region\n    sigma_eff = {}\n    q_eff = {}\n    for r in region_ids:\n        v = regions[r]['v']\n        sigma_t = regions[r]['sigma_t']\n        S = regions[r]['S']\n        psi_prev = regions[r]['psi_prev']\n        sigma_eff[r] = sigma_t + 1.0 / (v * dt)\n        q_eff[r] = S + psi_prev / (v * dt)\n\n    # Accumulate numerator for phi^{n+1}\n    phi_num_n1 = {r: 0.0 for r in region_ids}\n    # Also accumulate numerator for phi^{n} using previous angular flux moments\n    phi_num_n = {r: 0.0 for r in region_ids}\n\n    # Sweep tracks for n+1 and accumulate line integrals\n    for track in tracks:\n        w = track['weight']  # cm*rad\n        psi_in = 0.0  # vacuum boundary\n        for (r, L) in track['segments']:\n            sig = sigma_eff[r]\n            qtil = q_eff[r]\n            if L == 0.0:\n                # No propagation; contribute nothing and psi_out = psi_in\n                psi_out = psi_in\n                J = 0.0\n            else:\n                atten = np.exp(-sig * L)\n                psi_out = psi_in * atten + (qtil / sig) * (1.0 - atten)\n                # Line-integrated angular flux over segment\n                J = (psi_in - qtil / sig) * (1.0 - atten) / sig + (qtil / sig) * L\n            phi_num_n1[r] += w * J\n            psi_in = psi_out\n\n    # Accumulate previous-time scalar flux numerators using psi_prev\n    for track in tracks:\n        w = track['weight']\n        for (r, L) in track['segments']:\n            psi_prev = regions[r]['psi_prev']\n            J_prev = psi_prev * L\n            phi_num_n[r] += w * J_prev\n\n    # Compute region-averaged scalar fluxes and change\n    delta_phi = []\n    for r in region_ids:\n        A = regions[r]['A']\n        phi_n1 = phi_num_n1[r] / A\n        phi_n = phi_num_n[r] / A\n        delta_phi.append(phi_n1 - phi_n)\n\n    return delta_phi\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Test Case 1\n    regions1 = {\n        0: {'A': 0.5, 'sigma_t': 0.8, 'v': 2.2e5, 'S': 1.5e5, 'psi_prev': 3.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.2, 'v': 2.2e5, 'S': 0.5e5, 'psi_prev': 1.0e4},\n    }\n    tracks1 = [\n        {'weight': 1.2, 'segments': [(0, 0.7), (1, 0.5)]},\n        {'weight': 1.6, 'segments': [(0, 0.3), (1, 1.1)]},\n    ]\n    dt1 = 1.0e-5\n\n    # Test Case 2\n    regions2 = {\n        0: {'A': 0.5, 'sigma_t': 0.8, 'v': 2.2e5, 'S': 1.2e5, 'psi_prev': 3.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.2, 'v': 2.2e5, 'S': 0.4e5, 'psi_prev': 1.0e4},\n    }\n    tracks2 = tracks1  # same geometry and weights\n    dt2 = 1.0e-7\n\n    # Test Case 3\n    regions3 = {\n        0: {'A': 0.5, 'sigma_t': 2.5, 'v': 2.2e5, 'S': 0.0, 'psi_prev': 2.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.05, 'v': 2.2e5, 'S': 0.2e5, 'psi_prev': 5.0e3},\n    }\n    tracks3 = tracks1\n    dt3 = 5.0e-5\n\n    test_cases = [\n        (regions1, tracks1, dt1),\n        (regions2, tracks2, dt2),\n        (regions3, tracks3, dt3),\n    ]\n\n    results = []\n    for (regions, tracks, dt) in test_cases:\n        delta_phi = transient_moc_flux_change(regions, tracks, dt)\n        # Append in order region 0, region 1\n        results.extend(delta_phi)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}