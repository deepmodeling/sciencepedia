{
    "hands_on_practices": [
        {
            "introduction": "Before diving into complex numerical algorithms, it is essential to build a strong physical intuition for how particles propagate through a medium. This exercise strips the time-dependent transport problem down to its most fundamental form: the response of an infinite, non-scattering medium to an instantaneous burst of neutrons at a single point. By deriving this impulse response, also known as the Green's function, you will see how the core physical phenomena of time-of-flight, geometric spreading, and material attenuation emerge directly from first principles .",
            "id": "4257675",
            "problem": "Consider monoenergetic neutrons of speed $v$ in a homogeneous, infinite medium with macroscopic total cross section $\\Sigma_{t}$ and no scattering. The time-dependent linear Boltzmann transport equation for the angular flux $\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)$ is\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)}{\\partial t} + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) + \\Sigma_{t}\\,\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t),\n$$\nwith $Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t)$ an external source term. Let the source be an isotropic point source located at $\\mathbf{r}=\\mathbf{0}$ with a time profile $s(t)$, so that\n$$\nQ(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = \\frac{s(t)}{4\\pi}\\,\\delta^{(3)}(\\mathbf{r}),\n$$\nwhere $\\delta^{(3)}(\\mathbf{r})$ is the three-dimensional Dirac delta function.\n\n1. Using first principles of straight-line flight with attenuation, derive the angular-integrated impulse response (the scalar-flux Green’s function) $G(r, t)$ for this system, defined by the relation $\\phi(\\mathbf{r}, t) = \\int_{4\\pi} \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)\\,d\\boldsymbol{\\Omega} = S\\,G(r, t)$ when $s(t) = S\\,\\delta(t)$ and $r = |\\mathbf{r}|$.\n\n2. Now consider a short-duration rectangular source pulse, $s(t) = q_{0}$ for $0 \\le t \\le \\Delta t$ and $s(t) = 0$ otherwise, with constant emission rate $q_{0}$ and duration $\\Delta t$. Using your impulse response, predict the scalar flux $\\phi(R, T)$ at a point located a distance $R$ from the source, observed at time $T$. Express your final result as a single closed-form analytic expression that may include the Dirac delta function and the Heaviside step function $H(\\cdot)$.\n\nExpress the scalar flux in units of $\\text{cm}^{-2}\\,\\text{s}^{-1}$. No numerical evaluation or rounding is required; provide the exact expression.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of linear transport theory, is mathematically well-posed, and is stated objectively and unambiguously. We can therefore proceed with a solution.\n\nThe problem is divided into two parts. First, we derive the impulse response, or Green's function, for the scalar flux. Second, we use this response to determine the scalar flux resulting from a finite rectangular source pulse.\n\n**Part 1: Derivation of the Impulse Response (Green's Function)**\n\nWe are asked to derive the angular-integrated impulse response, $G(r, t)$, using first principles of straight-line flight with attenuation. The governing equation is the time-dependent Boltzmann transport equation for monoenergetic neutrons in a purely absorbing ($\\Sigma_s = 0$, so $\\Sigma_a = \\Sigma_t$) infinite homogeneous medium:\n$$\n\\frac{1}{v}\\,\\frac{\\partial \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t)}{\\partial t} + \\boldsymbol{\\Omega} \\cdot \\nabla \\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) + \\Sigma_{t}\\,\\psi(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = Q(\\mathbf{r}, \\boldsymbol{\\Omega}, t)\n$$\nFor the impulse response, the source is an isotropic burst of $S$ neutrons at the origin at time $t=0$:\n$$\nQ(\\mathbf{r}, \\boldsymbol{\\Omega}, t) = \\frac{S\\,\\delta(t)}{4\\pi}\\,\\delta^{(3)}(\\mathbf{r})\n$$\nThe first principle of straight-line flight dictates that in the absence of scattering, neutrons detected at a position $\\mathbf{r}$ at time $t$ must have traveled in a straight line from their point of origin. For the given source, all neutrons originate at $\\mathbf{r}'=\\mathbf{0}$.\n\nA neutron detected at position $\\mathbf{r}$ must have traveled a distance $r = |\\mathbf{r}|$. Since all neutrons have speed $v$, the time of flight is uniquely determined as $r/v$. The source emits neutrons only at $t=0$. Therefore, a neutron can only be detected at position $\\mathbf{r}$ at the precise time $t = r/v$. This implies that the time dependence of the flux at $\\mathbf{r}$ must be proportional to a Dirac delta function, $\\delta(t - r/v)$.\n\nThe neutrons are emitted isotropically from the origin. The number of neutrons decreases with distance due to two effects:\n1.  **Geometric Spreading**: The neutrons spread out over a spherical surface of area $4\\pi r^2$. The flux must therefore be proportional to $1/r^2$.\n2.  **Attenuation**: As neutrons travel through the medium, they are absorbed. The probability that a neutron travels a distance $r$ without being absorbed is given by the Beer-Lambert law, $\\exp(-\\Sigma_t r)$.\n\nCombining these physical arguments, we can construct the scalar flux $\\phi(\\mathbf{r}, t)$, which is the number of neutrons passing through a unit area per unit time at $(\\mathbf{r}, t)$, summed over all directions. The total number of neutrons emitted by the source is $S$. The time-integrated flux (fluence) at a distance $r$ is the total number of neutrons per unit area, which is $\\frac{S}{4\\pi r^2}\\exp(-\\Sigma_t r)$. Since all these neutrons arrive simultaneously at time $t=r/v$, the instantaneous flux is this fluence multiplied by a delta function in time.\n$$\n\\phi(\\mathbf{r}, t) = \\frac{S}{4\\pi r^2} \\exp(-\\Sigma_t r) \\delta\\left(t - \\frac{r}{v}\\right)\n$$\nThe problem defines the scalar-flux Green's function, $G(r, t)$, through the relation $\\phi(\\mathbf{r}, t) = S\\,G(r, t)$. By comparing this with our derived expression for $\\phi(\\mathbf{r}, t)$, we can identify the Green's function as:\n$$\nG(r, t) = \\frac{1}{4\\pi r^2} \\exp(-\\Sigma_t r) \\delta\\left(t - \\frac{r}{v}\\right)\n$$\nThis is the impulse response for the scalar flux.\n\n**Part 2: Scalar Flux from a Rectangular Pulse**\n\nWe now consider a source with a short-duration rectangular time profile:\n$$\ns(t) = q_{0} \\quad \\text{for } 0 \\le t \\le \\Delta t\n$$\nand $s(t) = 0$ otherwise. Here, $q_{0}$ is the constant emission rate in neutrons per second. We can express this using the Heaviside step function $H(t)$:\n$$\ns(t) = q_{0} \\left[ H(t) - H(t - \\Delta t) \\right]\n$$\nThe transport equation is linear, so the solution for a general source $s(t)$ can be found by convolving the impulse response with the source time profile. The scalar flux $\\phi(\\mathbf{r}, t)$ is given by:\n$$\n\\phi(\\mathbf{r}, t) = \\int_{-\\infty}^{\\infty} s(t') \\, G(r, t - t') \\, dt'\n$$\nWe need to find the scalar flux $\\phi(R, T)$ at a distance $r=R$ at time $t=T$. Substituting the expressions for $s(t')$ and $G(R, T-t')$:\n$$\n\\phi(R, T) = \\int_{-\\infty}^{\\infty} q_{0} \\left[ H(t') - H(t' - \\Delta t) \\right] \\left[ \\frac{1}{4\\pi R^2} \\exp(-\\Sigma_t R) \\delta\\left(T - t' - \\frac{R}{v}\\right) \\right] dt'\n$$\nThe terms that do not depend on the integration variable $t'$ can be moved outside the integral:\n$$\n\\phi(R, T) = \\frac{q_0}{4\\pi R^2} \\exp(-\\Sigma_t R) \\int_{-\\infty}^{\\infty} \\left[ H(t') - H(t' - \\Delta t) \\right] \\delta\\left(T - \\frac{R}{v} - t'\\right) dt'\n$$\nWe use the sifting property of the Dirac delta function, $\\int_{-\\infty}^{\\infty} f(x)\\delta(a-x)dx = f(a)$. In our case, the variable is $t'$, the function is $f(t') = H(t') - H(t' - \\Delta t)$, and the point of evaluation is $a = T - R/v$.\nThe integral evaluates to:\n$$\n\\int_{-\\infty}^{\\infty} \\left[ H(t') - H(t' - \\Delta t) \\right] \\delta\\left(\\left(T - \\frac{R}{v}\\right) - t'\\right) dt' = H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right)\n$$\nSubstituting this back into the expression for the scalar flux, we obtain the final result:\n$$\n\\phi(R, T) = \\frac{q_0}{4\\pi R^2} \\exp(-\\Sigma_t R) \\left[ H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right) \\right]\n$$\nThis expression describes the arrival of a rectangular pulse of neutrons at the detector. The flux is zero until the first neutrons (emitted at $t=0$) arrive at time $T=R/v$. The flux then remains at a constant value until the last neutrons (emitted at $t=\\Delta t$) arrive at time $T=R/v + \\Delta t$, after which it drops back to zero.",
            "answer": "$$\n\\boxed{\\frac{q_{0}}{4\\pi R^{2}} \\exp(-\\Sigma_{t} R) \\left( H\\left(T - \\frac{R}{v}\\right) - H\\left(T - \\frac{R}{v} - \\Delta t\\right) \\right)}\n$$"
        },
        {
            "introduction": "Transitioning from continuous physical laws to discrete computational models introduces new challenges, the most critical of which is numerical stability. An explicit time-stepping scheme is only stable if the time step $\\Delta t$ is small enough relative to the spatial grid size $\\Delta x$. This exercise guides you through the derivation of this fundamental constraint, the Courant-Friedrichs-Lewy (CFL) condition, for the free-streaming transport equation, revealing the direct link between the physical propagation speed and the limits of the numerical simulation .",
            "id": "4257680",
            "problem": "Consider a one-dimensional slab representation of the time-dependent linear Boltzmann equation for monoenergetic neutrons with speed $v$, neglecting collisions and sources, so that the streaming term governs the evolution of the angular flux. Let the angular flux be $\\psi(x,\\mu,t)$, where $\\mu$ is the direction cosine in the slab geometry, and consider periodic boundary conditions over a uniform spatial mesh of width $\\Delta x$. The governing equation reduces to the free-streaming form $\\frac{\\partial \\psi}{\\partial t} + v \\mu \\frac{\\partial \\psi}{\\partial x} = 0$. Discretize this equation using an explicit forward Euler method in time and a first-order upwind differencing in space appropriate to the sign of $\\mu$. Starting from these principles alone and employing a standard stability analysis for linear constant-coefficient advection, determine the maximum stable time step $\\Delta t$ that guarantees numerical stability for propagation over the mesh spacing $\\Delta x$ in this explicit streaming discretization. Your final expression must be valid for all propagation directions and reported as a closed-form analytic expression depending only on $\\Delta x$ and $v$. No numerical evaluation is required, and no rounding is necessary. If you elect to evaluate numerically, express time in seconds.",
            "solution": "The user has requested the derivation of the maximum stable time step for a specific numerical discretization of the one-dimensional, time-dependent, monoenergetic, source-free, collisionless neutron transport equation.\n\n### Step 1: Extract Givens\n-   Governing Equation: $\\frac{\\partial \\psi}{\\partial t} + v \\mu \\frac{\\partial \\psi}{\\partial x} = 0$\n-   Dependent Variable: $\\psi(x,\\mu,t)$, the angular neutron flux.\n-   Independent Variables: $x$ (position), $\\mu$ (direction cosine, $\\mu \\in [-1, 1]$), $t$ (time).\n-   Constants: $v$ (monoenergetic neutron speed).\n-   Geometry: One-dimensional slab.\n-   Boundary Conditions: Periodic over the spatial domain.\n-   Discretization:\n    -   Spatial: Uniform mesh of width $\\Delta x$. First-order upwind differencing.\n    -   Temporal: Uniform mesh of width $\\Delta t$. Explicit forward Euler method.\n-   Objective: Determine the maximum stable time step $\\Delta t$ as a closed-form analytic expression depending only on $\\Delta x$ and $v$, valid for all propagation directions $\\mu$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is subjected to validation against the specified criteria.\n-   **Scientifically Grounded**: The problem is based on the linear Boltzmann equation for neutron transport, a cornerstone of nuclear reactor physics. The equation presented is the free-streaming limit, a valid and standard simplification for analysis. The numerical schemes chosen (Forward Euler, first-order upwind) are classical methods for discretizing hyperbolic partial differential equations. The concept of numerical stability and its analysis via the Courant-Friedrichs-Lewy (CFL) condition is a fundamental topic in numerical analysis. The problem is firmly grounded in established principles of physics and applied mathematics.\n-   **Well-Posed**: The problem is clearly defined. It specifies the governing equation, the numerical method, and the quantity to be derived. The use of standard stability analysis on a linear, constant-coefficient partial differential equation ensures that a unique and meaningful solution for the stability criterion exists.\n-   **Objective**: The problem is stated in precise, technical language, free from any subjective or ambiguous terms.\n\nThe problem does not exhibit any of the listed flaws (e.g., scientific unsoundness, incompleteness, contradiction, etc.). It represents a standard, formalizable problem in the numerical analysis of transport phenomena.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. A complete, reasoned solution will be provided.\n\n### Solution Derivation\nThe governing equation is the one-dimensional linear advection equation for the angular flux $\\psi(x,\\mu,t)$:\n$$\n\\frac{\\partial \\psi}{\\partial t} + v \\mu \\frac{\\partial \\psi}{\\partial x} = 0\n$$\nHere, the advection velocity is $c = v\\mu$. The problem specifies an explicit forward Euler discretization in time and a first-order upwind scheme in space. Let $\\psi_j^n$ denote the numerical approximation of $\\psi(x_j, \\mu, t_n)$, where $x_j = j\\Delta x$ and $t_n = n\\Delta t$.\n\nThe forward Euler discretization of the time derivative is:\n$$\n\\frac{\\partial \\psi}{\\partial t} \\approx \\frac{\\psi_j^{n+1} - \\psi_j^n}{\\Delta t}\n$$\n\nThe first-order upwind scheme for the spatial derivative $\\frac{\\partial \\psi}{\\partial x}$ depends on the sign of the advection velocity $c = v\\mu$. Since the neutron speed $v$ is a positive constant, the sign of $c$ is determined by the sign of the direction cosine $\\mu$.\n\n**Case 1: $\\mu  0$ (Propagation in the positive $x$ direction)**\nFor $c = v\\mu  0$, the upwind scheme uses the value from the upstream cell, which is at the location $j-1$.\n$$\n\\frac{\\partial \\psi}{\\partial x} \\approx \\frac{\\psi_j^n - \\psi_{j-1}^n}{\\Delta x}\n$$\nSubstituting these discretizations into the governing equation yields:\n$$\n\\frac{\\psi_j^{n+1} - \\psi_j^n}{\\Delta t} + v\\mu \\left( \\frac{\\psi_j^n - \\psi_{j-1}^n}{\\Delta x} \\right) = 0\n$$\nSolving for $\\psi_j^{n+1}$:\n$$\n\\psi_j^{n+1} = \\psi_j^n - \\frac{v\\mu\\Delta t}{\\Delta x} (\\psi_j^n - \\psi_{j-1}^n) = \\left(1 - \\frac{v\\mu\\Delta t}{\\Delta x}\\right)\\psi_j^n + \\frac{v\\mu\\Delta t}{\\Delta x}\\psi_{j-1}^n\n$$\n\n**Case 2: $\\mu  0$ (Propagation in the negative $x$ direction)**\nFor $c = v\\mu  0$, the upwind scheme uses the value from the upstream cell, which is at the location $j+1$.\n$$\n\\frac{\\partial \\psi}{\\partial x} \\approx \\frac{\\psi_{j+1}^n - \\psi_j^n}{\\Delta x}\n$$\nSubstituting into the governing equation:\n$$\n\\frac{\\psi_j^{n+1} - \\psi_j^n}{\\Delta t} + v\\mu \\left( \\frac{\\psi_{j+1}^n - \\psi_j^n}{\\Delta x} \\right) = 0\n$$\nSolving for $\\psi_j^{n+1}$:\n$$\n\\psi_j^{n+1} = \\psi_j^n - \\frac{v\\mu\\Delta t}{\\Delta x} (\\psi_{j+1}^n - \\psi_j^n) = \\left(1 + \\frac{v\\mu\\Delta t}{\\Delta x}\\right)\\psi_j^n - \\frac{v\\mu\\Delta t}{\\Delta x}\\psi_{j+1}^n\n$$\n\n**Stability Analysis**\nTo determine the stability of these schemes, we employ the von Neumann stability analysis. We consider a single Fourier mode of the solution of the form $\\psi_j^n = G^n e^{i k x_j} = G^n e^{i k j \\Delta x}$, where $k$ is the wave number and $G$ is the amplification factor. For the numerical scheme to be stable, the magnitude of the amplification factor must satisfy $|G| \\leq 1$ for all wave numbers $k$.\n\n**Analysis for $\\mu  0$:**\nSubstituting the Fourier mode into the discretized equation for $\\mu  0$:\n$$\nG^{n+1}e^{ikj\\Delta x} = \\left(1 - \\frac{v\\mu\\Delta t}{\\Delta x}\\right)G^n e^{ikj\\Delta x} + \\frac{v\\mu\\Delta t}{\\Delta x}G^n e^{ik(j-1)\\Delta x}\n$$\nDividing by $G^n e^{ikj\\Delta x}$:\n$$\nG = \\left(1 - \\frac{v\\mu\\Delta t}{\\Delta x}\\right) + \\frac{v\\mu\\Delta t}{\\Delta x} e^{-ik\\Delta x}\n$$\nLet the Courant number be $C = \\frac{v\\mu\\Delta t}{\\Delta x}$. Since $v0$ and $\\mu0$, we have $C  0$.\n$$\nG = 1 - C + C e^{-ik\\Delta x} = 1 - C + C(\\cos(k\\Delta x) - i\\sin(k\\Delta x))\n$$\nThe magnitude squared of the amplification factor is:\n$$\n|G|^2 = (1 - C + C\\cos(k\\Delta x))^2 + (-C\\sin(k\\Delta x))^2\n$$\n$$\n|G|^2 = (1-C)^2 + 2C(1-C)\\cos(k\\Delta x) + C^2\\cos^2(k\\Delta x) + C^2\\sin^2(k\\Delta x)\n$$\n$$\n|G|^2 = (1-C)^2 + 2C(1-C)\\cos(k\\Delta x) + C^2 = 1 + 2C(C-1)(1-\\cos(k\\Delta x))\n$$\nFor stability, $|G|^2 \\leq 1$. This implies $1 + 2C(C-1)(1-\\cos(k\\Delta x)) \\leq 1$, which simplifies to $2C(C-1)(1-\\cos(k\\Delta x)) \\leq 0$. Since $C0$ and $(1-\\cos(k\\Delta x)) \\ge 0$, the condition reduces to $C-1 \\leq 0$, or $C \\leq 1$.\n$$\n\\frac{v\\mu\\Delta t}{\\Delta x} \\leq 1 \\quad \\text{for } \\mu0\n$$\n\n**Analysis for $\\mu  0$:**\nSubstituting the Fourier mode into the discretized equation for $\\mu  0$:\n$$\nG^{n+1}e^{ikj\\Delta x} = \\left(1 + \\frac{v\\mu\\Delta t}{\\Delta x}\\right)G^n e^{ikj\\Delta x} - \\frac{v\\mu\\Delta t}{\\Delta x}G^n e^{ik(j+1)\\Delta x}\n$$\nDividing by $G^n e^{ikj\\Delta x}$:\n$$\nG = \\left(1 + \\frac{v\\mu\\Delta t}{\\Delta x}\\right) - \\frac{v\\mu\\Delta t}{\\Delta x} e^{ik\\Delta x}\n$$\nLet the Courant number be $C = \\frac{v\\mu\\Delta t}{\\Delta x}$. Since $v0$ and $\\mu0$, we have $C  0$.\n$$\nG = 1 + C - C e^{ik\\Delta x} = 1 + C - C(\\cos(k\\Delta x) + i\\sin(k\\Delta x))\n$$\nThe magnitude squared is:\n$$\n|G|^2 = (1 + C - C\\cos(k\\Delta x))^2 + (-C\\sin(k\\Delta x))^2\n$$\n$$\n|G|^2 = (1+C)^2 - 2C(1+C)\\cos(k\\Delta x) + C^2\\cos^2(k\\Delta x) + C^2\\sin^2(k\\Delta x)\n$$\n$$\n|G|^2 = (1+C)^2 - 2C(1+C)\\cos(k\\Delta x) + C^2 = 1 - 2C(-1-C) - 2C(1+C)\\cos(k\\Delta x)\n$$\n$$\n|G|^2 = 1 + 2C(1+C)(1 - \\cos(k\\Delta x))\n$$\nFor stability, $|G|^2 \\leq 1$, which means $2C(1+C)(1-\\cos(k\\Delta x)) \\leq 0$. Since $C0$ and $(1-\\cos(k\\Delta x)) \\ge 0$, the condition reduces to $1+C \\ge 0$, or $C \\ge -1$.\n$$\n\\frac{v\\mu\\Delta t}{\\Delta x} \\ge -1 \\quad \\text{for } \\mu0\n$$\n\n**General Stability Condition**\nCombining the conditions for $\\mu  0$ and $\\mu  0$, we have:\n$$\n-1 \\leq \\frac{v\\mu\\Delta t}{\\Delta x} \\leq 1\n$$\nThis can be expressed compactly using the absolute value:\n$$\n\\left| \\frac{v\\mu\\Delta t}{\\Delta x} \\right| \\leq 1\n$$\nRearranging for $\\Delta t$, we get:\n$$\n\\Delta t \\leq \\frac{\\Delta x}{v|\\mu|}\n$$\nThis result is the well-known Courant-Friedrichs-Lewy (CFL) condition for the first-order upwind scheme.\n\n**Maximum Stable Time Step for All Directions**\nThe problem requires the determination of the maximum stable time step $\\Delta t$ that is valid for *all* propagation directions $\\mu$. The direction cosine $\\mu$ varies in the range $[-1, 1]$. To ensure stability for every possible value of $\\mu$, the time step $\\Delta t$ must satisfy the most restrictive condition. The right-hand side of the inequality, $\\frac{\\Delta x}{v|\\mu|}$, is at its minimum when the denominator, $v|\\mu|$, is at its maximum.\n\nSince $v$ is a constant, the denominator is maximized when $|\\mu|$ is maximized. The maximum value of $|\\mu|$ for $\\mu \\in [-1, 1]$ is $\\max(|\\mu|) = 1$, which corresponds to neutrons traveling purely along the positive or negative $x$-axis.\n\nTherefore, the stability condition must hold for $|\\mu|=1$:\n$$\n\\Delta t \\leq \\frac{\\Delta x}{v(1)}\n$$\nThe maximum value of $\\Delta t$ that satisfies this inequality is:\n$$\n\\Delta t_{\\text{max}} = \\frac{\\Delta x}{v}\n$$\nThis condition has a clear physical interpretation: for stability, a neutron traveling at the maximum possible speed along the grid axis, $v$, must not traverse more than one spatial cell of width $\\Delta x$ in a single time step $\\Delta t$.",
            "answer": "$$ \\boxed{\\frac{\\Delta x}{v}} $$"
        },
        {
            "introduction": "While explicit methods are conceptually simple, their stability constraints can be prohibitively restrictive, especially in optically thick media or when modeling slower transient phenomena. Modern transport codes often rely on implicit time-stepping schemes, which are unconditionally stable and allow for larger time steps. This hands-on problem challenges you to implement a single time step of a transient Method of Characteristics (MOC) solver using the implicit backward Euler method, a technique central to many state-of-the-art reactor analysis tools. You will confront the practical details of defining effective cross sections and sources to account for the time derivative and accurately update the scalar flux .",
            "id": "4257681",
            "problem": "Consider the time-dependent neutron transport in a two-dimensional pin cell that is infinite in the axial direction. Use the Method Of Characteristics (MOC) to advance the angular flux over a single time step under the flat source approximation. Begin from the time-dependent Boltzmann transport equation along characteristic lines, which for a monoenergetic group and two-dimensional planar geometry reads\n$$(1/v)\\,\\frac{\\partial \\psi(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega\\cdot\\nabla \\psi(\\mathbf{r},\\Omega,t) + \\Sigma_t(\\mathbf{r},t)\\,\\psi(\\mathbf{r},\\Omega,t) = q(\\mathbf{r},\\Omega,t),$$\nwhere $v$ is the neutron speed, $\\psi$ is the angular flux, $\\Omega$ is the direction unit vector in the plane, $\\Sigma_t$ is the total macroscopic cross section, and $q$ is the total source (including scattering and fission). Assume piecewise-constant material properties and sources within each homogeneous region and within each track segment, with vacuum boundary conditions at all track entries.\n\nYou must implement a transient MOC sweep over a set of given characteristic tracks. Use a backward Euler time discretization over one time step of size $\\Delta t$, and model the effective attenuation and source in each region consistently with the fundamental equation above. Treat the provided source moments as the zeroth Legendre moment (isotropic moment) in two-dimensional azimuthal angle, and assume the previous-time angular flux moment is isotropic and region-wise constant. For each track, sequentially traverse its segments and update the outgoing angular flux from the incoming angular flux, the effective attenuation, and the effective source for that segment. Then, compute the region-averaged scalar flux at the new time by integrating the angular flux along segments with the given track weights and dividing by the region area. Finally, compute the change in scalar flux between the new and previous time levels for each region.\n\nAll physical units must be used explicitly and consistently:\n- Cross sections $\\Sigma_t$ are in $\\mathrm{cm^{-1}}$.\n- Neutron speeds $v$ are in $\\mathrm{cm/s}$.\n- Time step $\\Delta t$ is in $\\mathrm{s}$.\n- Track segment lengths $L$ are in $\\mathrm{cm}$.\n- Region areas $A$ are in $\\mathrm{cm^2}$.\n- Track weights $w_m$ are in $\\mathrm{cm\\cdot rad}$, representing the product of azimuthal quadrature weight (in radians) and track spacing (in centimeters).\n- Isotropic source moments $S$ are in $\\mathrm{n/(cm^3\\cdot s\\cdot rad)}$.\n- Angular flux moments $\\bar{\\psi}^n$ are in $\\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n- The scalar flux change $\\Delta \\phi$ for each region must be expressed in $\\mathrm{n/(cm^2\\cdot s)}$.\n\nImplement the program to produce the scalar flux change per region for each test case. The scalar flux at the new time level must be computed by integrating the angular flux along each segment and aggregating with the provided track weights; the previous scalar flux must be computed by integrating the previous-time isotropic angular flux along segments with the same track weights. The change is the difference between these two scalar fluxes.\n\nUse the following test suite. In all cases, there are two regions: region $0$ is fuel and region $1$ is moderator. There are two characteristic track families. Vacuum boundary conditions are imposed at the start of each track.\n\n- Test Case $1$ (happy path):\n  - Time step: $\\Delta t = 1.0\\times 10^{-5}\\ \\mathrm{s}$.\n  - Region $0$ (fuel): $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 0.8\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 1.5\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 3.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Region $1$ (moderator): $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.2\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.5\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 1.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Tracks:\n    - Track $m=0$: weight $w_0 = 1.2\\ \\mathrm{cm\\cdot rad}$, segments $\\{(r=0, L=0.7\\ \\mathrm{cm}),\\ (r=1, L=0.5\\ \\mathrm{cm})\\}$.\n    - Track $m=1$: weight $w_1 = 1.6\\ \\mathrm{cm\\cdot rad}$, segments $\\{(r=0, L=0.3\\ \\mathrm{cm}),\\ (r=1, L=1.1\\ \\mathrm{cm})\\}$.\n- Test Case $2$ (small time step, transient dominated):\n  - Time step: $\\Delta t = 1.0\\times 10^{-7}\\ \\mathrm{s}$.\n  - Region $0$: $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 0.8\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 1.2\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 3.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Region $1$: $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.2\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.4\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 1.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Tracks: same as Test Case $1$.\n- Test Case $3$ (material contrast and source-free fuel):\n  - Time step: $\\Delta t = 5.0\\times 10^{-5}\\ \\mathrm{s}$.\n  - Region $0$: $A_0 = 0.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,0}^{n+1} = 2.5\\ \\mathrm{cm^{-1}}$, $v_0 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_0^{n+1} = 0.0\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_0^{n} = 2.0\\times 10^4\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Region $1$: $A_1 = 1.5\\ \\mathrm{cm^2}$, $\\Sigma_{t,1}^{n+1} = 0.05\\ \\mathrm{cm^{-1}}$, $v_1 = 2.2\\times 10^5\\ \\mathrm{cm/s}$, $S_1^{n+1} = 0.2\\times 10^5\\ \\mathrm{n/(cm^3\\cdot s\\cdot rad)}$, $\\bar{\\psi}_1^{n} = 5.0\\times 10^3\\ \\mathrm{n/(cm^2\\cdot s\\cdot rad)}$.\n  - Tracks: same as Test Case $1$.\n\nYour program must:\n- Implement a transient MOC sweep consistent with the fundamental equation and the specified discretization.\n- Compute the region-averaged scalar flux at time $t^{n+1}$ by integrating the angular flux along each segment with the given weights and dividing by region area.\n- Compute the previous-time scalar flux from $\\bar{\\psi}^n$ using the same track geometry and weights.\n- Output the change in scalar flux $\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n$ for regions $r=0$ and $r=1$ in the units $\\mathrm{n/(cm^2\\cdot s)}$ for each test case.\n\nFinal output format requirement: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $\\big[\\Delta \\phi_{0}^{(1)}, \\Delta \\phi_{1}^{(1)}, \\Delta \\phi_{0}^{(2)}, \\Delta \\phi_{1}^{(2)}, \\Delta \\phi_{0}^{(3)}, \\Delta \\phi_{1}^{(3)}\\big]$, where superscripts indicate the test case index. Each list element must be a floating-point number.",
            "solution": "Begin with the time-dependent Boltzmann transport equation in two-dimensional planar geometry for a monoenergetic group,\n$$(1/v)\\,\\frac{\\partial \\psi(\\mathbf{r},\\Omega,t)}{\\partial t} + \\Omega\\cdot\\nabla \\psi(\\mathbf{r},\\Omega,t) + \\Sigma_t(\\mathbf{r},t)\\,\\psi(\\mathbf{r},\\Omega,t) = q(\\mathbf{r},\\Omega,t),$$\nwhere $v$ is the neutron speed, $\\psi$ is the angular flux, $\\Omega$ is the unit direction vector in the plane, $\\Sigma_t$ is the total macroscopic cross section, and $q$ is the total source, including scattering and fission contributions. Along a straight characteristic track parameterized by the arc length $s$ in the direction $\\Omega$, the streaming term reduces to $\\mathrm{d}\\psi/\\mathrm{d}s$. Applying a backward Euler time discretization over one time step of size $\\Delta t$ yields, within a homogeneous region,\n$$(1/v)\\,\\frac{\\psi^{n+1}(s) - \\psi^n(s)}{\\Delta t} + \\frac{\\mathrm{d}\\psi^{n+1}(s)}{\\mathrm{d}s} + \\Sigma_t^{n+1}\\,\\psi^{n+1}(s) = q^{n+1},$$\nwhere the superscripts $n$ and $n+1$ denote the previous and new time levels, respectively, and $q^{n+1}$ is assumed piecewise constant within the segment under the flat source approximation.\n\nRearranging terms, we obtain a first-order linear ordinary differential equation along $s$ at time level $n+1$,\n$$\\frac{\\mathrm{d}\\psi^{n+1}(s)}{\\mathrm{d}s} + \\left(\\Sigma_t^{n+1} + \\frac{1}{v\\,\\Delta t}\\right)\\psi^{n+1}(s) = q^{n+1} + \\frac{1}{v\\,\\Delta t}\\,\\psi^n(s).$$\nUnder the standard transient MOC approximation consistent with the flat source assumption, we treat $\\psi^n(s)$ as region-wise constant and equal to a given isotropic angular flux moment $\\bar{\\psi}^n$ in that region. Define the effective total attenuation and the effective source for the segment,\n$$\\Sigma_{\\mathrm{eff}} \\equiv \\Sigma_t^{n+1} + \\frac{1}{v\\,\\Delta t}, \\qquad \\tilde{q} \\equiv q^{n+1} + \\frac{1}{v\\,\\Delta t}\\,\\bar{\\psi}^{n}.$$\nWith vacuum boundary conditions at the entry of each track, the solution for a segment of length $L$ with incoming angular flux $\\psi_{\\mathrm{in}}$ is obtained by solving the linear ordinary differential equation,\n$$\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\,e^{-\\Sigma_{\\mathrm{eff}}\\,L} + \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\left(1 - e^{-\\Sigma_{\\mathrm{eff}}\\,L}\\right).$$\nTo compute contributions to the region-averaged scalar flux, we require the line-integrated angular flux over the segment,\n$$J \\equiv \\int_{0}^{L} \\psi^{n+1}(s)\\,\\mathrm{d}s = \\left(\\psi_{\\mathrm{in}} - \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\right)\\frac{1 - e^{-\\Sigma_{\\mathrm{eff}}\\,L}}{\\Sigma_{\\mathrm{eff}}} + \\frac{\\tilde{q}}{\\Sigma_{\\mathrm{eff}}}\\,L.$$\nFor two-dimensional azimuthal integration, we approximate the region-averaged scalar flux at time $t^{n+1}$ by aggregating over all tracks $m$, with weights $w_m$ in $\\mathrm{cm\\cdot rad}$, and dividing by the region area $A_r$,\n$$\\phi_r^{n+1} = \\frac{1}{A_r}\\sum_{m} w_m \\sum_{k\\in \\mathcal{K}(r,m)} J_{r,m,k},$$\nwhere $\\mathcal{K}(r,m)$ indexes the segments of track $m$ that lie within region $r$. For the previous-time scalar flux, using the isotropic angular flux moment $\\bar{\\psi}_r^n$ assumed constant in region $r$, the line-integrated angular flux for a segment of length $L$ is simply $\\bar{\\psi}_r^n\\,L$, so the region-averaged scalar flux at time $t^n$ is\n$$\\phi_r^{n} = \\frac{1}{A_r}\\sum_{m} w_m \\sum_{k\\in \\mathcal{K}(r,m)} \\bar{\\psi}_r^n\\,L_{r,m,k}.$$\nThe change in scalar flux over the time step is\n$$\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n.$$\n\nAlgorithmic design for the transient MOC sweep:\n- For each region $r$, compute $\\Sigma_{\\mathrm{eff},r} = \\Sigma_{t,r}^{n+1} + 1/(v_r\\,\\Delta t)$ and $\\tilde{q}_r = S_r^{n+1} + \\bar{\\psi}_r^n/(v_r\\,\\Delta t)$, where $S_r^{n+1}$ is the isotropic source moment for region $r$.\n- For each track $m$ with weight $w_m$, initialize the incoming angular flux $\\psi_{\\mathrm{in}} = 0$ (vacuum). For each segment $(r,L)$ in sequence along the track:\n  - Compute $e^{-\\Sigma_{\\mathrm{eff},r} L}$.\n  - Update the outgoing angular flux using $\\psi_{\\mathrm{out}} = \\psi_{\\mathrm{in}}\\,e^{-\\Sigma_{\\mathrm{eff},r} L} + (\\tilde{q}_r/\\Sigma_{\\mathrm{eff},r})(1 - e^{-\\Sigma_{\\mathrm{eff},r} L})$.\n  - Compute the line-integrated segment contribution $J$ using the expression above.\n  - Accumulate $w_m\\,J$ to the region $r$’s numerator for $\\phi_r^{n+1}$.\n  - Set $\\psi_{\\mathrm{in}} \\leftarrow \\psi_{\\mathrm{out}}$ for the next segment in the track.\n- After all tracks, divide each region’s accumulated sum by $A_r$ to obtain $\\phi_r^{n+1}$.\n- Compute $\\phi_r^{n}$ using the isotropic moment $\\bar{\\psi}_r^n$: accumulate $w_m\\,\\bar{\\psi}_r^n\\,L$ over segments in region $r$ and divide by $A_r$.\n- Compute $\\Delta \\phi_r = \\phi_r^{n+1} - \\phi_r^n$.\n- Repeat for each test case.\n\nThis procedure is consistent with the fundamental transport equation, the backward Euler time discretization, and the flat source approximation. The units are internally consistent: the line-integrated angular flux $J$ has units $\\mathrm{n/(cm\\cdot s\\cdot rad)}$, multiplication by $w_m$ in $\\mathrm{cm\\cdot rad}$ yields $\\mathrm{n/s}$, and division by area $A_r$ in $\\mathrm{cm^2}$ yields the scalar flux in $\\mathrm{n/(cm^2\\cdot s)}$. The previous-time scalar flux uses the same geometric weighting, ensuring that the computed change $\\Delta \\phi_r$ is in $\\mathrm{n/(cm^2\\cdot s)}$.\n\nThe implementation follows directly, encoding the three test cases and producing a single-line output in the required format.",
            "answer": "```python\nimport numpy as np\n\ndef transient_moc_flux_change(regions, tracks, dt):\n    \"\"\"\n    Compute region-wise scalar flux change over one time step using transient MOC.\n    regions: dict of region_id - dict with keys:\n        'A' (area, cm^2),\n        'sigma_t' (total cross section at n+1, cm^-1),\n        'v' (speed, cm/s),\n        'S' (isotropic source at n+1, n/(cm^3*s*rad)),\n        'psi_prev' (isotropic angular flux at n, n/(cm^2*s*rad))\n    tracks: list of dicts, each with keys:\n        'weight' (cm*rad),\n        'segments' (list of tuples (region_id, length_cm)), in sequence along the track\n    dt: time step (s)\n    Returns: list of delta_phi per region, in n/(cm^2*s)\n    \"\"\"\n    region_ids = sorted(regions.keys())\n    # Precompute effective parameters per region\n    sigma_eff = {}\n    q_eff = {}\n    for r in region_ids:\n        v = regions[r]['v']\n        sigma_t = regions[r]['sigma_t']\n        S = regions[r]['S']\n        psi_prev = regions[r]['psi_prev']\n        sigma_eff[r] = sigma_t + 1.0 / (v * dt)\n        q_eff[r] = S + psi_prev / (v * dt)\n\n    # Accumulate numerator for phi^{n+1}\n    phi_num_n1 = {r: 0.0 for r in region_ids}\n    # Also accumulate numerator for phi^{n} using previous angular flux moments\n    phi_num_n = {r: 0.0 for r in region_ids}\n\n    # Sweep tracks for n+1 and accumulate line integrals\n    for track in tracks:\n        w = track['weight']  # cm*rad\n        psi_in = 0.0  # vacuum boundary\n        for (r, L) in track['segments']:\n            sig = sigma_eff[r]\n            qtil = q_eff[r]\n            if L = 0.0:\n                # No propagation; contribute nothing and psi_out = psi_in\n                psi_out = psi_in\n                J = 0.0\n            else:\n                atten = np.exp(-sig * L)\n                psi_out = psi_in * atten + (qtil / sig) * (1.0 - atten)\n                # Line-integrated angular flux over segment\n                J = (psi_in - qtil / sig) * (1.0 - atten) / sig + (qtil / sig) * L\n            phi_num_n1[r] += w * J\n            psi_in = psi_out\n\n    # Accumulate previous-time scalar flux numerators using psi_prev\n    for track in tracks:\n        w = track['weight']\n        for (r, L) in track['segments']:\n            psi_prev = regions[r]['psi_prev']\n            J_prev = psi_prev * L\n            phi_num_n[r] += w * J_prev\n\n    # Compute region-averaged scalar fluxes and change\n    delta_phi = []\n    for r in region_ids:\n        A = regions[r]['A']\n        phi_n1 = phi_num_n1[r] / A\n        phi_n = phi_num_n[r] / A\n        delta_phi.append(phi_n1 - phi_n)\n\n    return delta_phi\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Test Case 1\n    regions1 = {\n        0: {'A': 0.5, 'sigma_t': 0.8, 'v': 2.2e5, 'S': 1.5e5, 'psi_prev': 3.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.2, 'v': 2.2e5, 'S': 0.5e5, 'psi_prev': 1.0e4},\n    }\n    tracks1 = [\n        {'weight': 1.2, 'segments': [(0, 0.7), (1, 0.5)]},\n        {'weight': 1.6, 'segments': [(0, 0.3), (1, 1.1)]},\n    ]\n    dt1 = 1.0e-5\n\n    # Test Case 2\n    regions2 = {\n        0: {'A': 0.5, 'sigma_t': 0.8, 'v': 2.2e5, 'S': 1.2e5, 'psi_prev': 3.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.2, 'v': 2.2e5, 'S': 0.4e5, 'psi_prev': 1.0e4},\n    }\n    tracks2 = tracks1  # same geometry and weights\n    dt2 = 1.0e-7\n\n    # Test Case 3\n    regions3 = {\n        0: {'A': 0.5, 'sigma_t': 2.5, 'v': 2.2e5, 'S': 0.0, 'psi_prev': 2.0e4},\n        1: {'A': 1.5, 'sigma_t': 0.05, 'v': 2.2e5, 'S': 0.2e5, 'psi_prev': 5.0e3},\n    }\n    tracks3 = tracks1\n    dt3 = 5.0e-5\n\n    test_cases = [\n        (regions1, tracks1, dt1),\n        (regions2, tracks2, dt2),\n        (regions3, tracks3, dt3),\n    ]\n\n    results = []\n    for (regions, tracks, dt) in test_cases:\n        delta_phi = transient_moc_flux_change(regions, tracks, dt)\n        # Append in order region 0, region 1\n        results.extend(delta_phi)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}