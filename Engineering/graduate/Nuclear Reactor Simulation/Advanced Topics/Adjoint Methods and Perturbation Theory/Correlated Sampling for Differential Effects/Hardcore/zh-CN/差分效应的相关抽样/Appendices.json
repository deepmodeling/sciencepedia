{
    "hands_on_practices": [
        {
            "introduction": "在将一种数值方法应用于复杂的蒙特卡罗模拟之前，从第一性原理理解其理论基础至关重要。本练习  通过一个简化的中子穿透问题，引导您推导方差缩减因子(VRF)，从而揭示相关抽样的核心数学机制。通过这个推导，您将深刻理解为何以及在多大程度上，共用随机数 (CRN) 技术能够通过引入正相关性来显著降低微分效应估算的方差，从而提高计算效率。",
            "id": "4219745",
            "problem": "考虑一个厚度为 $L$ 的均匀平板中的单能中子输运，中子进行各向同性的直线飞行。到下一次相互作用的自由程 $s$ 服从指数分布，其概率密度函数为 $f(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s)$，其中 $\\Sigma_{t}$ 是宏观总截面。一个从平板一个面入射的中子，不发生相互作用而穿出平板的概率（透射概率）为 $T = \\exp(-\\Sigma_{t} L)$。假设一个微扰系统的宏观总截面为 $\\Sigma_{t}' = \\Sigma_{t} + \\delta \\Sigma$，且 $|\\delta \\Sigma| \\ll \\Sigma_{t}$。将基准系统中的单个历史透射得分定义为 $X = \\mathbf{1}\\{s > L\\}$，微扰系统中的得分定义为 $Y = \\mathbf{1}\\{s' > L\\}$，其中 $s$ 和 $s'$ 是通过逆变换采样方法，分别由独立的标准均匀随机数 $U$ 和 $U'$ 通过 $s = -\\ln(U)/\\Sigma_{t}$ 和 $s' = -\\ln(U')/\\Sigma_{t}'$ 抽样得到。关心的量是透射概率差值 $\\Delta T = T' - T$，通过每个系统中 $n$ 个历史的样本均值之差 $\\widehat{\\Delta T} = \\overline{Y} - \\overline{X}$ 来估计。\n\n考虑两种抽样策略：\n1. 独立抽样：独立地抽取 $\\{U_{i}\\}$ 和 $\\{U_{i}'\\}$，从而产生独立的 $\\{X_{i}\\}$ 和 $\\{Y_{i}\\}$。\n2. 公共随机数（CRN）：使用相同的 $U_{i}$ 来生成 $s_{i}$ 和 $s_{i}'$，从而在 $X_{i}$ 和 $Y_{i}$ 之间引入相关性。\n\n将方差缩减因子（VRF）定义为 $\\mathrm{VRF} = \\mathrm{Var}_{\\text{indep}}(\\widehat{\\Delta T}) / \\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T})$。从方差、协方差和相关性的定义出发，仅利用指数飞行分布和指示函数估计量的性质，推导在微小差异效应（即两个系统中单个历史的得分方差相等）的情况下，方差缩减因子（VRF）作为CRN方法下成对得分之间的单个历史相关系数 $\\rho$ 的函数表达式。然后，计算当 $\\rho = 0.9$ 时 VRF 的数值。明确说明你所需要的任何假设，并确保你推导过程中的每一步都基于第一性原理给出证明。最终的数值答案是无量纲的，并且不需要四舍五入。",
            "solution": "首先根据所需标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n-   **系统**：厚度为 $L$ 的均匀平板中的单能中子输运。\n-   **中子飞行**：各向同性，直线飞行。\n-   **自由程概率密度函数**：$f(s) = \\Sigma_{t} \\exp(-\\Sigma_{t} s)$，其中 $\\Sigma_{t}$ 是宏观总截面。\n-   **基准透射概率**：$T = \\exp(-\\Sigma_{t} L)$。\n-   **微扰系统截面**：$\\Sigma_{t}' = \\Sigma_{t} + \\delta \\Sigma$，且 $|\\delta \\Sigma| \\ll \\Sigma_{t}$。\n-   **单个历史基准得分**：$X = \\mathbf{1}\\{s > L\\}$，一个指示函数。\n-   **单个历史微扰得分**：$Y = \\mathbf{1}\\{s' > L\\}$，一个指示函数。\n-   **抽样**：使用标准均匀随机数 $U$ 和 $U'$ 进行逆变换采样。\n-   **路径长度抽样公式**：$s = -\\ln(U)/\\Sigma_{t}$ 和 $s' = -\\ln(U')/\\Sigma_{t}'$。\n-   **关心量**：$\\Delta T = T' - T$，其中 $T' = \\exp(-\\Sigma_{t}' L)$。\n-   **估计量**：$\\widehat{\\Delta T} = \\overline{Y} - \\overline{X}$，其中 $\\overline{X}$ 和 $\\overline{Y}$ 是 $n$ 个历史的样本均值。\n-   **抽样策略**：\n    1.  独立抽样：$\\{U_{i}\\}$ 和 $\\{U_{i}'\\}$ 是独立的随机数集。\n    2.  公共随机数（CRN）：使用相同的随机数 $U_{i}$ 生成成对的得分 $X_i$ 和 $Y_i$。\n-   **定义**：方差缩减因子，$\\mathrm{VRF} = \\mathrm{Var}_{\\text{indep}}(\\widehat{\\Delta T}) / \\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T})$。\n-   **任务1**：推导 VRF 作为 CRN 方法下成对得分之间的单个历史相关系数 $\\rho$ 的函数表达式。\n-   **条件**：推导需在微小差异效应的情况下进行，此时假定两个系统中单个历史的得分方差相等。\n-   **任务2**：计算当 $\\rho = 0.9$ 时 VRF 的数值。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学和数学上是合理的。它描述了蒙特卡罗粒子输运模拟中一个标准的、尽管有所简化的问题。使用指数分布表示自由程、逆变换采样和指示函数估计量都是该领域的基本概念。使用相关抽样（特别是公共随机数法）研究微分效应是反应堆物理中微扰分析的基石。问题是自洽的，提供了所有必要的定义和条件。对于小微扰，假定方差相等的假设是标准且合理的近似。问题提法得当且客观，能够导出一个唯一且有意义的解。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将提供一个完整的、有理有据的解答。\n\n### 推导\n\n待估计的量是透射概率之差 $\\Delta T = T' - T$。基于 $n$ 个模拟历史，该量的蒙特卡罗估计量为 $\\widehat{\\Delta T} = \\overline{Y} - \\overline{X}$。其中，$\\overline{X} = \\frac{1}{n}\\sum_{i=1}^{n} X_i$ 和 $\\overline{Y} = \\frac{1}{n}\\sum_{i=1}^{n} Y_i$ 分别是基准系统和微扰系统中单个历史得分的样本均值。\n\n该估计量的方差由差的方差通用公式给出：\n$$\n\\mathrm{Var}(\\widehat{\\Delta T}) = \\mathrm{Var}(\\overline{Y} - \\overline{X}) = \\mathrm{Var}(\\overline{Y}) + \\mathrm{Var}(\\overline{X}) - 2\\mathrm{Cov}(\\overline{X}, \\overline{Y})\n$$\n由于单个历史对 $(X_i, Y_i)$ 是独立同分布的，样本均值的方差为 $\\mathrm{Var}(\\overline{X}) = \\frac{\\mathrm{Var}(X)}{n}$ 和 $\\mathrm{Var}(\\overline{Y}) = \\frac{\\mathrm{Var}(Y)}{n}$。类似地，样本均值的协方差为 $\\mathrm{Cov}(\\overline{X}, \\overline{Y}) = \\frac{\\mathrm{Cov}(X, Y)}{n}$。令 $\\sigma_X^2 = \\mathrm{Var}(X)$ 和 $\\sigma_Y^2 = \\mathrm{Var}(Y)$ 表示单个历史的方差。该估计量的方差变为：\n$$\n\\mathrm{Var}(\\widehat{\\Delta T}) = \\frac{1}{n} \\left( \\sigma_Y^2 + \\sigma_X^2 - 2\\mathrm{Cov}(X, Y) \\right)\n$$\n我们现在针对两种指定的抽样策略分析此表达式。\n\n**1. 独立抽样**\n在此策略中，基准系统的得分 $X_i$ 和微扰系统的得分 $Y_i$ 是由独立的随机数生成的。因此，得分 $X$ 和 $Y$ 是统计上独立的随机变量。独立变量的一个基本性质是其协方差为零。\n$$\n\\mathrm{Cov}(X, Y) = 0\n$$\n将此代入通用方差公式，得到独立抽样情况下的方差：\n$$\n\\mathrm{Var}_{\\text{indep}}(\\widehat{\\Delta T}) = \\frac{1}{n} (\\sigma_X^2 + \\sigma_Y^2)\n$$\n\n**2. 公共随机数（CRN）抽样**\n在此策略中，使用相同的随机数 $U_i$ 来生成 $s_i = -\\ln(U_i)/\\Sigma_t$ 和 $s_i' = -\\ln(U_i)/\\Sigma_t'$。这在得分 $X_i$ 和 $Y_i$ 之间引入了统计相关性。因此，它们的协方差 $\\mathrm{Cov}(X, Y)$ 通常不为零。因此，CRN情况下的方差为：\n$$\n\\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T}) = \\frac{1}{n} \\left( \\sigma_X^2 + \\sigma_Y^2 - 2\\mathrm{Cov}(X, Y) \\right)\n$$\n问题将 $\\rho$ 定义为成对得分 $X$ 和 $Y$ 之间的相关系数。根据定义，相关系数与协方差的关系如下：\n$$\n\\rho = \\frac{\\mathrm{Cov}(X, Y)}{\\sqrt{\\sigma_X^2 \\sigma_Y^2}} = \\frac{\\mathrm{Cov}(X, Y)}{\\sigma_X \\sigma_Y}\n$$\n由此，我们可以将协方差表示为 $\\mathrm{Cov}(X, Y) = \\rho \\sigma_X \\sigma_Y$。将其代入CRN的方差表达式，得到：\n$$\n\\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T}) = \\frac{1}{n} \\left( \\sigma_X^2 + \\sigma_Y^2 - 2\\rho \\sigma_X \\sigma_Y \\right)\n$$\n\n**方差缩减因子（VRF）的推导**\n问题要求在单个历史得分方差相等的假设下进行推导，这对于 $|\\delta\\Sigma| \\ll \\Sigma_t$ 的小微扰是一个常见且合理的近似。我们将这个共同的方差表示为 $\\sigma^2$：\n$$\n\\sigma_X^2 = \\sigma_Y^2 = \\sigma^2\n$$\n这意味着 $\\sigma_X = \\sigma_Y = \\sigma$。\n\n我们可以证明这个假设的合理性。得分 $X = \\mathbf{1}\\{s > L\\}$ 是一个伯努利随机变量。其期望值为 $E[X] = P(s > L)$。我们有 $P(s > L) = P(-\\ln(U)/\\Sigma_t > L) = P(\\ln(U)  -\\Sigma_t L) = P(U  \\exp(-\\Sigma_t L))$。由于 $U$ 在 $(0, 1)$ 上均匀分布，对于 $a \\in [0, 1]$，有 $P(U  a) = a$。因此，$E[X] = \\exp(-\\Sigma_t L) = T$。\n成功概率为 $p$ 的伯努利变量的方差为 $p(1-p)$。因此，$\\sigma_X^2 = T(1-T)$。\n类似地，对于微扰系统，$\\sigma_Y^2 = T'(1-T')$。\n条件 $|\\delta\\Sigma| \\ll \\Sigma_t$ 意味着 $T' = \\exp(-(\\Sigma_t+\\delta\\Sigma)L) \\approx T$。由于方差函数 $v(p) = p(1-p)$ 是连续的，$T' \\approx T$ 意味着 $\\sigma_Y^2 \\approx \\sigma_X^2$。因此，在指定的情况下，该假设在物理上和数学上都是合理的。\n\n将假设 $\\sigma_X^2 = \\sigma_Y^2 = \\sigma^2$ 应用于两种抽样方案的方差表达式：\n对于独立抽样：\n$$\n\\mathrm{Var}_{\\text{indep}}(\\widehat{\\Delta T}) = \\frac{1}{n} (\\sigma^2 + \\sigma^2) = \\frac{2\\sigma^2}{n}\n$$\n对于CRN抽样：\n$$\n\\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T}) = \\frac{1}{n} (\\sigma^2 + \\sigma^2 - 2\\rho \\sigma \\sigma) = \\frac{1}{n} (2\\sigma^2 - 2\\rho \\sigma^2) = \\frac{2\\sigma^2(1-\\rho)}{n}\n$$\n方差缩减因子（VRF）定义为这两个方差的比值：\n$$\n\\mathrm{VRF} = \\frac{\\mathrm{Var}_{\\text{indep}}(\\widehat{\\Delta T})}{\\mathrm{Var}_{\\text{CRN}}(\\widehat{\\Delta T})} = \\frac{\\frac{2\\sigma^2}{n}}{\\frac{2\\sigma^2(1-\\rho)}{n}}\n$$\n从分子和分母中消去公因子 $\\frac{2\\sigma^2}{n}$，得到VRF作为 $\\rho$ 的函数的最终表达式：\n$$\n\\mathrm{VRF} = \\frac{1}{1-\\rho}\n$$\n这个结果表明，对于正相关（当使用CRN处理小微扰时，这是预期的情况，即 $\\rho  0$），CRN估计量的方差小于独立抽样估计量的方差，从而导致VRF大于1。随着 $\\rho$ 趋近于1，CRN方法的效率急剧增加。\n\n**数值计算**\n问题要求计算当相关系数为 $\\rho = 0.9$ 时VRF的数值。\n$$\n\\mathrm{VRF} = \\frac{1}{1 - 0.9} = \\frac{1}{0.1} = 10\n$$\n$\\rho=0.9$ 的相关性导致了10的方差缩减因子。这意味着，为了在 $\\Delta T$ 的估计上达到相同的统计精度，独立抽样模拟所需的中子历史数是使用CRN技术的模拟的10倍。",
            "answer": "$$\\boxed{10}$$"
        },
        {
            "introduction": "掌握了理论基础后，下一步便是将其付诸实践。本练习  将带领您从理论走向应用，将相关抽样技术应用于估算反应堆物理中一个更核心的量——有效增殖因子之差 ($\\Delta k_{\\text{eff}}$)。您将通过编写代码实现一个基于共用随机数的估算器，并将其模拟结果与理论预测进行对比，这不仅能巩固您对相关抽样工作原理的理解，还能培养您在计算科学研究中验证代码与模型的关键技能。",
            "id": "4219754",
            "problem": "你的任务是构建一个基于共用随机数（CRN）的估计器，用于估算基准核系统与轻微扰动后的核系统之间有效增殖因子（记为 $\\Delta k_{\\text{eff}}$）的变化量，并分析由共享裂变源抽样引起的协方差。将每个历史的增殖因子贡献建模为共享裂变源随机变量的线性泛函，以反映在不同系统间复用相同的裂变源样本。将基准系统中每个历史的贡献处理为 $X_i = \\mu_0 + \\sigma_0 Z_i$，扰动系统中为 $Y_i = \\mu_1 + \\sigma_1 Z_i$，其中 $i = 1, \\dots, N$，$Z_i$ 是通过逆累积分布变换从共享的均匀随机数生成的独立同分布的标准正态随机变量，以强制实现 CRN。共享 $Z_i$ 的使用模拟了在两个系统中复用裂变源库。有效增殖因子的变化量通过样本均值差 $\\widehat{\\Delta k}_{\\text{eff}} = \\overline{Y} - \\overline{X}$ 来估计。\n\n从基本的 Monte Carlo 定义和概率性质出发：样本均值是期望的无偏估计量、期望的线性性质以及协方差的双线性性质，且独立性假设仅限于驱动随机变量。假设上述一阶线性响应模型对于核数据中的小扰动是有效的，并且 $Z_i$ 是通过将独立同分布的均匀随机变量 $U_i \\sim \\text{Uniform}(0,1)$ 经过标准正态累积分布函数的逆函数映射而构造的标准正态随机变量。\n\n你的程序必须：\n- 使用共用的均匀随机数 $U_i$ 和标准正态累积分布函数的逆函数，为两个系统生成共享的 $Z_i$，使得在每个测试用例中，相同的 $Z_i$ 驱动 $X_i$ 和 $Y_i$。\n- 根据 $N$ 个历史的样本均值，计算基于 CRN 的估计器 $\\widehat{\\Delta k}_{\\text{eff}}$。\n- 使用从共享 $Z_i$ 推导出的无偏样本协方差公式，计算经验协方差 $\\widehat{\\operatorname{Cov}}(X,Y)$。\n- 计算每个历史的差值 $D_i = Y_i - X_i$ 的经验方差（记为 $\\widehat{\\operatorname{Var}}(D)$），并通过将 $\\widehat{\\operatorname{Var}}(D)$ 除以 $N$ 来计算估计器的经验方差 $\\widehat{\\operatorname{Var}}(\\widehat{\\Delta k}_{\\text{eff}})$。\n- 在线性响应模型和共享 $Z_i$ 的条件下，推导并计算由共享裂变源抽样引起的理论协方差，以及 $D_i$ 和 $\\widehat{\\Delta k}_{\\text{eff}}$ 的理论方差。\n- 以无量纲的小数形式报告所有量值，不带百分号。\n\n为确保科学真实性，将 $Z_i$ 解释为裂变源抽样随机性的潜在表示，该随机性在基准系统和扰动系统中被复用；$\\mu_0$、$\\mu_1$ 表示对 $k_{\\text{eff}}$ 的平均每历史贡献；$\\sigma_0$、$\\sigma_1$ 反映了由于固定源模拟中（这些模拟被重新加权以估计 $k_{\\text{eff}}$）的随机粒子历史而产生的随机变化的幅度。\n\n使用以下测试套件，其中每个元组为 $(\\mu_0, \\mu_1, \\sigma_0, \\sigma_1, N, \\text{seed})$：\n- 测试 1：$(0.995, 1.000, 0.050, 0.050, 100000, 314159)$\n- 测试 2：$(0.980, 0.983, 0.060, 0.040, 80000, 271828)$\n- 边界测试 3：$(0.997, 0.9975, 0.000, 0.005, 60000, 161803)$\n\n对于每个测试用例，按顺序输出一个包含以下七个量的列表：$\\widehat{\\Delta k}_{\\text{eff}}$、$\\widehat{\\operatorname{Cov}}(X,Y)$、$\\operatorname{Cov}_{\\text{theory}}(X,Y)$、$\\widehat{\\operatorname{Var}}(D)$、$\\operatorname{Var}_{\\text{theory}}(D)$、$\\widehat{\\operatorname{Var}}(\\widehat{\\Delta k}_{\\text{eff}})$、$\\operatorname{Var}_{\\text{theory}}(\\widehat{\\Delta k}_{\\text{eff}})$。你的程序应生成单行输出，包含用方括号括起来的、以逗号分隔的结果列表，每个测试用例对应一个内部列表，例如 $[[r_{1,1}, \\dots, r_{1,7}], [r_{2,1}, \\dots, r_{2,7}], [r_{3,1}, \\dots, r_{3,7}]]$，其中每个 $r_{i,j}$ 是一个实数。\n\n本问题不涉及角度单位。所有报告的量都是无量纲的。所有答案都以小数形式表示。最终输出格式必须是完全符合规定的一行，包含一个外部列表和三个内部列表。",
            "solution": "问题陈述经评估有效。其科学基础在于 Monte Carlo 模拟和方差缩减技术的原理，具体来说是使用共用随机数（CRN）来估计核系统中的微分效应。该问题提法恰当，提供了清晰的数学模型、所有必要的参数以及一组客观的计算和理论任务。线性响应模型是一种标准且有用的简化，可用于教学目的和分析小扰动。该问题是自洽的、一致的，并且存在唯一可验证的解。\n\n核心任务是分析一个基于 CRN 的估计器，用于估算基准系统与扰动系统之间有效增殖因子 $\\Delta k_{\\text{eff}}$ 的变化。对 $k_{\\text{eff}}$ 的每历史贡献被建模为共享随机变量的线性函数。\n\n设基准系统的每历史贡献为一个随机变量 $X$，扰动系统的为一个随机变量 $Y$。对于第 $i$ 个历史，其实现由下式给出：\n$$X_i = \\mu_0 + \\sigma_0 Z_i$$\n$$Y_i = \\mu_1 + \\sigma_1 Z_i$$\n其中 $i = 1, \\dots, N$。参数 $\\mu_0$ 和 $\\mu_1$ 表示平均每历史贡献，而 $\\sigma_0$ 和 $\\sigma_1$ 表示这些贡献的标准差。变量 $Z_i$ 是独立同分布（i.i.d.）的标准正态随机变量，$Z_i \\sim \\mathcal{N}(0, 1)$。CRN 技术的关键之处在于，同一个随机变量 $Z_i$ 被用于为每个历史生成 $X_i$ 和 $Y_i$，从而在两次模拟之间引入了相关性。这种共享的随机性模拟了在基准计算和扰动计算之间复用裂变源库。$Z_i$ 是通过将标准正态分布的逆累积分布函数（CDF）（记为 $\\Phi^{-1}$）应用于一组独立同分布的均匀随机数 $U_i \\sim \\text{Uniform}(0,1)$ 来生成的。\n\n有效增殖因子变化量的估计器 $\\widehat{\\Delta k}_{\\text{eff}}$ 是样本均值之差：\n$$\\widehat{\\Delta k}_{\\text{eff}} = \\overline{Y} - \\overline{X} = \\frac{1}{N}\\sum_{i=1}^{N} Y_i - \\frac{1}{N}\\sum_{i=1}^{N} X_i$$\n\n首先，我们基于期望、方差和协方差的性质推导所需的理论量。\n\n**1. 理论协方差：$\\operatorname{Cov}_{\\text{theory}}(X,Y)$**\n每历史贡献 $X_i$ 和 $Y_i$ 之间的协方差定义为 $\\operatorname{Cov}(X_i, Y_i) = E[(X_i - E[X_i])(Y_i - E[Y_i])]$。\n期望为 $E[X_i] = E[\\mu_0 + \\sigma_0 Z_i] = \\mu_0 + \\sigma_0 E[Z_i] = \\mu_0$，类似地，由于 $E[Z_i] = 0$，所以 $E[Y_i] = \\mu_1$。\n中心化后的变量为 $X_i - E[X_i] = \\sigma_0 Z_i$ 和 $Y_i - E[Y_i] = \\sigma_1 Z_i$。\n因此，协方差为：\n$$\\operatorname{Cov}(X_i, Y_i) = E[(\\sigma_0 Z_i)(\\sigma_1 Z_i)] = \\sigma_0 \\sigma_1 E[Z_i^2]$$\n对于一个标准正态变量 $Z_i$，其方差为 $\\operatorname{Var}(Z_i) = E[Z_i^2] - (E[Z_i])^2 = 1$。因为 $E[Z_i]=0$，我们有 $E[Z_i^2] = 1$。\n因此，理论协方差为：\n$$\\operatorname{Cov}_{\\text{theory}}(X,Y) = \\sigma_0 \\sigma_1$$\n\n**2. 差值的理论方差：$\\operatorname{Var}_{\\text{theory}}(D)$**\n设 $D_i$ 为每历史差值，$D_i = Y_i - X_i$。\n$$D_i = (\\mu_1 + \\sigma_1 Z_i) - (\\mu_0 + \\sigma_0 Z_i) = (\\mu_1 - \\mu_0) + (\\sigma_1 - \\sigma_0) Z_i$$\n$D_i$ 的方差可以直接计算。因为 $\\mu_1 - \\mu_0$ 是一个常数，它不影响方差。\n$$\\operatorname{Var}(D_i) = \\operatorname{Var}((\\mu_1 - \\mu_0) + (\\sigma_1 - \\sigma_0) Z_i) = (\\sigma_1 - \\sigma_0)^2 \\operatorname{Var}(Z_i) = (\\sigma_1 - \\sigma_0)^2$$\n或者，使用协方差的双线性性质：\n$$\\operatorname{Var}(D_i) = \\operatorname{Var}(Y_i - X_i) = \\operatorname{Var}(Y_i) + \\operatorname{Var}(X_i) - 2\\operatorname{Cov}(Y_i, X_i)$$\n根据 $\\operatorname{Var}(X_i) = \\sigma_0^2 \\operatorname{Var}(Z_i) = \\sigma_0^2$ 和 $\\operatorname{Var}(Y_i) = \\sigma_1^2$，我们得到：\n$$\\operatorname{Var}_{\\text{theory}}(D) = \\sigma_1^2 + \\sigma_0^2 - 2\\sigma_0\\sigma_1 = (\\sigma_1 - \\sigma_0)^2$$\n\n**3. 估计器的理论方差：$\\operatorname{Var}_{\\text{theory}}(\\widehat{\\Delta k}_{\\text{eff}})$**\n该估计器可以改写为用差值 $D_i$ 表示：\n$$\\widehat{\\Delta k}_{\\text{eff}} = \\overline{Y} - \\overline{X} = \\frac{1}{N}\\sum_{i=1}^{N} (Y_i - X_i) = \\frac{1}{N}\\sum_{i=1}^{N} D_i = \\overline{D}$$\n估计器是独立同分布的差值 $D_i$ 的样本均值。$N$ 个独立同分布随机变量的样本均值的方差是单个变量的方差除以 $N$。\n$$\\operatorname{Var}_{\\text{theory}}(\\widehat{\\Delta k}_{\\text{eff}}) = \\operatorname{Var}(\\overline{D}) = \\frac{\\operatorname{Var}(D_i)}{N} = \\frac{(\\sigma_1 - \\sigma_0)^2}{N}$$\n这个结果凸显了 CRN 的强大之处：如果 $\\sigma_1 \\approx \\sigma_0$，估计器的方差可以变得非常小，从而与独立模拟相比，微分效应的估计效率大大提高。\n\n接下来，我们定义用于计算大小为 $N$ 的样本的经验估计值的数值步骤。\n\n**1. 样本生成：**\n对于每个测试用例，我们使用带种子的随机数生成器生成 $N$ 个共享的均匀随机数 $U_1, \\dots, U_N$，以保证可复现性。这些数被转换为标准正态变量 $Z_i = \\Phi^{-1}(U_i)$。然后使用给定的线性模型计算样本 $X_i$ 和 $Y_i$。\n\n**2. 经验估计器：$\\widehat{\\Delta k}_{\\text{eff}}$**\n这直接通过生成的 $X$ 和 $Y$ 样本的样本均值计算得出：$\\widehat{\\Delta k}_{\\text{eff}} = \\text{mean}(Y) - \\text{mean}(X)$。\n\n**3. 经验协方差：$\\widehat{\\operatorname{Cov}}(X,Y)$**\n这使用无偏样本协方差公式计算：\n$$\\widehat{\\operatorname{Cov}}(X,Y) = \\frac{1}{N-1}\\sum_{i=1}^{N} (X_i - \\overline{X})(Y_i - \\overline{Y})$$\n\n**4. 差值的经验方差：$\\widehat{\\operatorname{Var}}(D)$**\n计算出差值样本 $D_i = Y_i - X_i$ 后，计算无偏样本方差：\n$$\\widehat{\\operatorname{Var}}(D) = \\frac{1}{N-1}\\sum_{i=1}^{N} (D_i - \\overline{D})^2$$\n\n**5. 估计器的经验方差：$\\widehat{\\operatorname{Var}}(\\widehat{\\Delta k}_{\\text{eff}})$**\n按照问题中的规定，这是通过将差值的样本方差按 $N$ 缩放得到的：\n$$\\widehat{\\operatorname{Var}}(\\widehat{\\Delta k}_{\\text{eff}}) = \\frac{\\widehat{\\operatorname{Var}}(D)}{N}$$\n\n实现将对每个提供的测试用例执行这些计算，生成七个所需的量：$\\widehat{\\Delta k}_{\\text{eff}}$、$\\widehat{\\operatorname{Cov}}(X,Y)$、$\\operatorname{Cov}_{\\text{theory}}(X,Y)$、$\\widehat{\\operatorname{Var}}(D)$、$\\operatorname{Var}_{\\text{theory}}(D)$、$\\widehat{\\operatorname{Var}}(\\widehat{\\Delta k}_{\\text{eff}})$ 和 $\\operatorname{Var}_{\\text{theory}}(\\widehat{\\Delta k}_{\\text{eff}})$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes theoretical and empirical statistics for a CRN-based estimator\n    of a differential effect in a simplified nuclear reactor simulation model.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (mu0, mu1, sigma0, sigma1, N, seed)\n        (0.995, 1.000, 0.050, 0.050, 100000, 314159),\n        (0.980, 0.983, 0.060, 0.040, 80000, 271828),\n        (0.997, 0.9975, 0.000, 0.005, 60000, 161803),\n    ]\n\n    results = []\n    for case in test_cases:\n        mu0, mu1, sigma0, sigma1, N, seed = case\n        \n        # --- Sample Generation using Common Random Numbers ---\n        # Initialize a random number generator with a specific seed for reproducibility.\n        rng = np.random.default_rng(seed)\n        # Generate N uniform random numbers in the interval (0, 1).\n        u_samples = rng.uniform(size=N)\n        # Transform uniform samples to standard normal samples using inverse transform sampling.\n        # This is the shared random variate Z_i.\n        z_samples = norm.ppf(u_samples)\n        \n        # Generate per-history contributions for the base (X) and perturbed (Y) systems.\n        x_samples = mu0 + sigma0 * z_samples\n        y_samples = mu1 + sigma1 * z_samples\n        \n        # --- Theoretical Calculations ---\n        # 3. Theoretical covariance between X and Y.\n        cov_theory_xy = sigma0 * sigma1\n        \n        # 5. Theoretical variance of the per-history difference D = Y - X.\n        var_theory_d = (sigma1 - sigma0)**2\n        \n        # 7. Theoretical variance of the estimator for Delta k_eff.\n        var_theory_delta_k = var_theory_d / N\n\n        # --- Empirical Calculations ---\n        # 1. CRN-based estimator for Delta k_eff (difference of sample means).\n        delta_k_eff_hat = np.mean(y_samples) - np.mean(x_samples)\n        \n        # 2. Unbiased sample covariance between X and Y.\n        # np.cov with ddof=1 computes the unbiased estimator using (N-1) in the denominator.\n        cov_hat_xy = np.cov(x_samples, y_samples, ddof=1)[0, 1]\n        \n        # 4. Unbiased sample variance of the per-history difference D.\n        d_samples = y_samples - x_samples\n        var_hat_d = np.var(d_samples, ddof=1)\n        \n        # 6. Empirical variance of the estimator for Delta k_eff.\n        var_hat_delta_k = var_hat_d / N\n        \n        # Compile results for the current test case in the specified order.\n        case_results = [\n            delta_k_eff_hat,\n            cov_hat_xy,\n            cov_theory_xy,\n            var_hat_d,\n            var_theory_d,\n            var_hat_delta_k,\n            var_theory_delta_k\n        ]\n        results.append(case_results)\n\n    # --- Final Output Formatting ---\n    # Construct the output string to match the required format: [[r1,r2,...],[s1,s2,...]]\n    outer_list_str = []\n    for res_list in results:\n        # Convert each list of floats to a comma-separated string \"[f1,f2,...]\"\n        inner_list_str = f\"[{','.join(map(str, res_list))}]\"\n        outer_list_str.append(inner_list_str)\n    \n    # Join the inner list strings into the final output format \"[[...],[...]]\"\n    final_output = f\"[{','.join(outer_list_str)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}