{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习旨在巩固维兰特移位加速收敛的核心数学原理。通过推导收缩因子与移位参数之间的关系，您将亲手计算出为达到目标收敛速度所需的最佳移位量。这个练习不仅能加深您对谱变换如何工作的理解，还能为您在实际应用中选择合适的移位参数提供定量依据。",
            "id": "4261247",
            "problem": "在临界反应堆的稳态中子输运中，基模本征问题可以抽象地写为裂变源的算子不动点问题，其中有界线性算子 $\\mathcal{T}$ 将一个归一化的通量迭代值映射到下一代。在迭代值的标准归一化下，$\\mathcal{T}$ 的主导本征值为 $1$，次主导本征值的大小等于优势比 $\\hat{d}$，其中 $0  \\hat{d}  1$。考虑一个受经典 Wielandt 移位启发的加速格式：每次外迭代应用一个由以下方式隐式定义的基于预解式的映射\n$$(\\mathcal{I} - w\\,\\mathcal{T})\\,\\phi^{(m+1)} = \\mathcal{T}\\,\\phi^{(m)},$$\n其中选择标量参数 $w$ 来减小每次外迭代中次主导模式的渐近误差收缩。假设迭代是稳定的，即 $0  w  1/\\hat{d}$，因此 $(\\mathcal{I} - w\\,\\mathcal{T})$ 在相关不变子空间上是可逆的。\n\n从 $\\mathcal{T}$ 的谱性质和上述预解式映射的定义出发，确定使渐近误差收缩因子等于一个给定目标值 $r^{\\ast}$（其中 $0  r^{\\ast}  1$）的 $w$ 值。使用以下数据：$\\hat{d} = 0.9$ 和 $r^{\\ast} = 0.3$。\n\n将你的答案表示为一个无量纲标量，并将结果四舍五入到四位有效数字。",
            "solution": "该问题要求在一个用于中子输运本征问题的 Wielandt 型加速格式中，确定参数 $w$ 的值，使得渐近误差收缩因子等于一个指定值 $r^{\\ast}$。\n\n首先，我们必须将迭代过程形式化，并确定控制误差传播的算子。给定的迭代格式由以下隐式关系定义：\n$$(\\mathcal{I} - w\\,\\mathcal{T})\\,\\phi^{(m+1)} = \\mathcal{T}\\,\\phi^{(m)}$$\n其中 $\\mathcal{I}$ 是单位算子，$\\mathcal{T}$ 是临界系统的裂变源算子，$\\phi^{(m)}$ 是第 $m$ 步的通量迭代值，$w$ 是实值移位参数。\n\n通过形式上对左侧的算子求逆，我们可以定义一个显式迭代算子 $\\mathcal{M}$，它将 $\\phi^{(m)}$ 映射到 $\\phi^{(m+1)}$：\n$$\\phi^{(m+1)} = (\\mathcal{I} - w\\,\\mathcal{T})^{-1}\\mathcal{T}\\,\\phi^{(m)} \\equiv \\mathcal{M}\\,\\phi^{(m)}$$\n逆 $(\\mathcal{I} - w\\,\\mathcal{T})^{-1}$ 的存在性由问题的稳定性条件 $0  w  1/\\hat{d}$ 保证，该条件确保了 $1$ 不是 $w\\mathcal{T}$ 的本征值。\n\n设 $\\lambda_k$ 是算子 $\\mathcal{T}$ 的本征值，$\\psi_k$ 是对应的本征向量，使得 $\\mathcal{T}\\psi_k = \\lambda_k \\psi_k$。$\\mathcal{T}$ 的本征向量也是任何作为 $\\mathcal{T}$ 函数的算子（例如 $\\mathcal{M}$）的本征向量。$\\mathcal{M}$ 的本征值（我们记为 $\\mu_k$）可以通过将 $\\mathcal{M}$ 应用于本征向量 $\\psi_k$ 来找到：\n$$\\mathcal{M}\\psi_k = (\\mathcal{I} - w\\,\\mathcal{T})^{-1}\\mathcal{T}\\psi_k = (\\mathcal{I} - w\\,\\mathcal{T})^{-1}(\\lambda_k \\psi_k) = \\frac{1}{1-w\\lambda_k}(\\lambda_k \\psi_k) = \\frac{\\lambda_k}{1-w\\lambda_k}\\psi_k$$\n因此，迭代算子 $\\mathcal{M}$ 的本征值由映射 $\\mu_k = \\frac{\\lambda_k}{1-w\\lambda_k}$ 给出。\n\n问题指出，对于原始算子 $\\mathcal{T}$，主导本征值为 $\\lambda_1 = 1$，对应于基模解 $\\psi_1$。对于 $k > 1$ 的次主导本征值 $\\lambda_k$ 的大小由优势比 $\\hat{d}$ 界定，即对于所有 $k > 1$ 都有 $|\\lambda_k| \\le \\hat{d}$。\n\n该迭代是一种类幂法，其向基模的收敛速度取决于其他本征模式（误差）相对于基模衰减的速度。设迭代值可分解为 $\\phi^{(m)} = c_1^{(m)}\\psi_1 + \\sum_{k=2}^N c_k^{(m)}\\psi_k$。应用算子 $\\mathcal{M}$ 得到：\n$$\\phi^{(m+1)} = c_1^{(m)}\\mu_1 \\psi_1 + \\sum_{k=2}^N c_k^{(m)}\\mu_k \\psi_k$$\n本征向量 $\\psi_1$ 对应于本征值 $\\mu_1 = \\frac{\\lambda_1}{1-w\\lambda_1} = \\frac{1}{1-w}$。与 $k>1$ 的 $\\psi_k$ 相关联的误差分量被因子 $\\mu_k$ 放大。每次迭代后，解通常会被重新归一化。在幂法的背景下，这意味着误差传播由 $\\mathcal{M}$ 的次主导本征值与 $\\mathcal{M}$ 的主导本征值之比来控制。\n\n因此，渐近误差收缩因子 $r$ 是误差传播算子的谱半径，由下式给出：\n$$r = \\sup_{k>1} \\left| \\frac{\\mu_k}{\\mu_1} \\right| = \\sup_{k>1} \\left| \\frac{\\lambda_k / (1 - w\\lambda_k)}{1 / (1-w)} \\right| = \\sup_{k>1} \\left| \\frac{\\lambda_k(1-w)}{1-w\\lambda_k} \\right|$$\n问题指定 $0  w  1/\\hat{d}$。为使该格式成为一种加速方法，我们期望 $r  \\hat{d}$，这将（如下所示）意味着 $0  w  1$。假设如此，则 $|1-w| = 1-w$。$r$ 的表达式变为：\n$$r = (1-w) \\sup_{k>1} \\left| \\frac{\\lambda_k}{1-w\\lambda_k} \\right|$$\n问题给出了次主导本征值的谱界为 $\\sup_{k>1}|\\lambda_k| = \\hat{d}$。根据解析函数的最大模原理，函数 $|\\lambda / (1-w\\lambda)|$ 在圆盘 $|\\lambda| \\le \\hat{d}$ 上的最大值必定出现在其边界 $|\\lambda|=\\hat{d}$ 上。所以我们需要找到：\n$$r = (1-w) \\max_{|\\lambda|=\\hat{d}} \\left| \\frac{\\lambda}{1-w\\lambda} \\right| = (1-w) \\frac{\\hat{d}}{\\min_{|\\lambda|=\\hat{d}}|1-w\\lambda|}$$\n令 $\\lambda = \\hat{d} e^{i\\theta}$。要最小化的项是 $|1-w\\hat{d}e^{i\\theta}|^2$：\n$$|1-w\\hat{d}e^{i\\theta}|^2 = |(1-w\\hat{d}\\cos\\theta) - i(w\\hat{d}\\sin\\theta)|^2 = (1-w\\hat{d}\\cos\\theta)^2 + (w\\hat{d}\\sin\\theta)^2 = 1 - 2w\\hat{d}\\cos\\theta + w^2\\hat{d}^2$$\n由于 $w > 0$ 和 $\\hat{d} > 0$，当 $\\cos\\theta$ 最大化时，即 $\\cos\\theta=1$ 时，该表达式被最小化。这对应于一个实本征值 $\\lambda = \\hat{d}$。因此 $|1-w\\lambda|$ 的最小值为 $|1-w\\hat{d}|$。给定的稳定性条件 $w  1/\\hat{d}$ 确保了 $w\\hat{d}1$，所以 $1-w\\hat{d} > 0$。\n因此，渐近误差收缩因子为：\n$$r = (1-w) \\frac{\\hat{d}}{1-w\\hat{d}}$$\n我们已知这个因子应等于一个目标值 $r^{\\ast}$。现在我们可以解出 $w$：\n$$r^{\\ast} = \\frac{(1-w)\\hat{d}}{1-w\\hat{d}}$$\n$$r^{\\ast}(1-w\\hat{d}) = \\hat{d}(1-w)$$\n$$r^{\\ast} - r^{\\ast}w\\hat{d} = \\hat{d} - w\\hat{d}$$\n$$w\\hat{d} - r^{\\ast}w\\hat{d} = \\hat{d} - r^{\\ast}$$\n$$w\\hat{d}(1 - r^{\\ast}) = \\hat{d} - r^{\\ast}$$\n$$w = \\frac{\\hat{d} - r^{\\ast}}{\\hat{d}(1 - r^{\\ast})}$$\n问题提供了数值 $\\hat{d} = 0.9$ 和 $r^{\\ast} = 0.3$。将这些值代入 $w$ 的表达式中：\n$$w = \\frac{0.9 - 0.3}{0.9(1 - 0.3)} = \\frac{0.6}{0.9 \\times 0.7} = \\frac{0.6}{0.63}$$\n$$w = \\frac{60}{63} = \\frac{20}{21}$$\n以四舍五入到四位有效数字的小数形式提供答案：\n$$w \\approx 0.95238095...$$\n四舍五入到四位有效数字得到 $0.9524$。\n\n我们验证此结果与我们的假设一致。由于 $0  r^{\\ast}  \\hat{d}  1$，分子 $(\\hat{d}-r^{\\ast})$ 和分母 $\\hat{d}(1-r^{\\ast})$ 都是正数，所以 $w>0$。此外，因为 $\\hat{d}1$ 意味着 $r^{\\ast}/\\hat{d} > r^{\\ast}$，所以 $w = \\frac{1-r^{\\ast}/\\hat{d}}{1-r^{\\ast}}  1$。因此，假设 $0  w  1$ 是正确的。稳定性条件 $w  1/\\hat{d} = 1/0.9 \\approx 1.111$ 也被满足，因为 $0.9524  1.111$。\n最终结果是 $w$ 的数值。",
            "answer": "$$\\boxed{0.9524}$$"
        },
        {
            "introduction": "掌握了理论后，下一个关键步骤是学会如何验证和调试。本练习将您置于一个常见的计算科学场景中：一个数值方法的实现结果与理论预期不符。您需要运用维兰特移位算子的谱理论，通过对比观测到的收敛行为与理论预测，诊断出程序中可能存在的错误。这项实践旨在培养您从第一性原理出发解决实际问题的诊断能力。",
            "id": "4261207",
            "problem": "考虑一个压水反应堆堆芯的二维中子扩散 $k$ 特征值问题，其算子形式写作 $A \\phi = \\frac{1}{k} F \\phi$，其中 $A$ 是损失算子，$F$ 是裂变产生算子。定义传播算子 $T = A^{-1} F$，使得右特征对 $(k_i, v_i)$ 满足 $T v_i = k_i v_i$，且 $k_1  k_2  \\dots  0$。通过算子 $S = (T - \\omega I)^{-1} T$ 实现了一个 Wielandt 移位幂迭代，其中 $\\omega$ 是一个标量移位。\n\n为验证该实现，你测量了迭代向量在前两个右本征模上投影的每次迭代衰减。设双正交伴随（左）特征向量 $(w_i)$ 满足 $w_i^{\\top} v_j = \\delta_{ij}$，并为第 $m$ 次迭代的结果 $\\phi^{(m)}$ 定义模态含量 $a_i^{(m)} = w_i^{\\top} \\phi^{(m)}$。观测到的第二模态相对于第一模态的每次迭代相对衰减因子计算如下\n$$r_{\\mathrm{obs}} \\approx \\frac{a_2^{(m+1)}/a_1^{(m+1)}}{a_2^{(m)}/a_1^{(m)}}.$$\n在一个测试问题中，已知占优和次占优增殖因子（来自一个独立的高精度求解器）分别为 $k_1 = 1.000$ 和 $k_2 = 0.90$，代码中使用的 Wielandt 移位为 $\\omega = 0.99$。验证测量报告显示 $r_{\\mathrm{obs}} \\approx +0.90$，且迭代过程中没有符号交替。\n\n使用线性算子理论的第一性原理和 Wielandt 移位迭代的定义，推导在正确的 Wielandt 移位下第二模态的理论预期相对衰减因子 $r_w$，并将其与观测值进行比较。然后，为这一差异选择最一致的诊断。哪个选项最能解释观测结果？\n\nA. Wielandt 移位未被应用于有效迭代算子；代码实际上是在对 $T$ 执行标准幂迭代，从而得到 $r_{\\mathrm{obs}} \\approx k_2/k_1$ 且无符号交替。\n\nB. 内层线性求解器的容差过大，使得每次迭代的总误差收缩率实际上为 1；观测到的 $r_{\\mathrm{obs}} \\approx 0.90$ 表明接近停滞。\n\nC. 移位被错误地实现为应用 $(T - \\omega I)^{-1}$ 而没有后乘以 $T$，这将得到 $r_{\\mathrm{obs}} \\approx \\left|\\frac{k_1 - \\omega}{k_2 - \\omega}\\right|$。\n\nD. 模态投影诊断使用了一个非双正交的内积，这污染了测得的 $a_i^{(m)}$，即使在 Wielandt 移位被正确实现的情况下也产生了大的系统性偏差。",
            "solution": "用户提供了一个关于核反应堆特征值问题的 Wielandt 移位幂迭代验证的问题陈述。任务是验证该问题，推导理论上预期的收敛行为，将其与观测行为进行比较，并诊断差异所在。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- 特征值问题为 $A \\phi = \\frac{1}{k} F \\phi$，其中 $A$ 是损失算子，$F$ 是裂变产生算子。\n- 传播算子为 $T = A^{-1} F$。\n- 右特征对为 $(k_i, v_i)$，满足 $T v_i = k_i v_i$，特征值排序为 $k_1  k_2  \\dots  0$。\n- Wielandt 移位迭代算子为 $S = (T - \\omega I)^{-1} T$，其中 $\\omega$ 是一个标量移位。\n- 伴随（左）特征向量 $w_i$ 与右特征向量 $v_j$ 是双正交的，即 $w_i^{\\top} v_j = \\delta_{ij}$。\n- 第 $m$ 次迭代结果 $\\phi^{(m)}$ 的模态含量定义为 $a_i^{(m)} = w_i^{\\top} \\phi^{(m)}$。\n- 观测到的每次迭代相对衰减因子为 $r_{\\mathrm{obs}} \\approx \\frac{a_2^{(m+1)}/a_1^{(m+1)}}{a_2^{(m)}/a_1^{(m)}}$。\n- 参考计算得到的已知特征值：$k_1 = 1.000$ 和 $k_2 = 0.90$。\n- 实现中使用的 Wielandt 移位为 $\\omega = 0.99$。\n- 测量结果为 $r_{\\mathrm{obs}} \\approx +0.90$，在迭代之间未观测到符号交替。\n\n**步骤 2：使用提取的已知条件进行验证**\n根据验证标准对问题陈述进行评估。\n- **科学上成立：** 该问题设置在应用于中子扩散理论的数值线性代数的标准数学框架内，这是核工程的一个核心课题。所描述的算子和方法（幂迭代、Wielandt 移位）都是成熟的。此标准得到满足。\n- **提法恰当：** 该问题提供了执行定量分析所需的所有数据（$k_1$、$k_2$、$\\omega$、$r_{\\mathrm{obs}}$）。问题具体，并允许得出唯一的、可推导的答案。此标准得到满足。\n- **客观性：** 该问题使用精确的技术语言，没有主观或模糊的陈述。所有术语要么是该领域的标准术语，要么有明确定义。此标准得到满足。\n- **缺陷清单：**\n    1.  **科学/事实不健全：** 无。\n    2.  **不可形式化/不相关：** 问题与指定主题直接相关，并且是完全可形式化的。\n    3.  **不完整/矛盾的设置：** 设置是完整的且自洽的。\n    4.  **不现实/不可行：** 给定的数值对于反应堆堆芯模拟在物理上和数学上都是合理的。\n    5.  **病态/结构不良：** 问题结构能够导出一个唯一的解析结论。\n    6.  **伪深刻/琐碎：** 问题需要对 Wielandt 移位背后的算子理论有正确的理解，这是一个不平凡的概念。\n    7.  **超出科学可验证性：** 推导基于线性代数的可验证原理。\n\n**步骤 3：结论和行动**\n问题陈述是**有效的**。现在开始求解过程。\n\n### 推导与分析\n\n任务的核心是推导正确实现的 Wielandt 移位的理论相对衰减因子 $r_w$，并将其与观测值 $r_{\\mathrm{obs}}$进行比较。\n\n**1. Wielandt 移位算子的特征值**\n\nWielandt 移位迭代过程为 $\\phi^{(m+1)} \\propto S \\phi^{(m)}$，其中迭代算子为 $S = (T - \\omega I)^{-1} T$。为了理解其收敛性，我们必须求出 $S$ 的特征值。设 $v_i$ 是 $T$ 的一个特征向量，其特征值为 $k_i$，使得 $T v_i = k_i v_i$。\n\n将算子 $S$ 应用于特征向量 $v_i$：\n$$ S v_i = (T - \\omega I)^{-1} T v_i = (T - \\omega I)^{-1} (k_i v_i) $$\n由于 $k_i$ 是一个标量，它可以与算子交换位置：\n$$ S v_i = k_i (T - \\omega I)^{-1} v_i $$\n算子 $(T - \\omega I)$ 作用于 $v_i$ 的结果是 $(T - \\omega I) v_i = T v_i - \\omega v_i = k_i v_i - \\omega v_i = (k_i - \\omega)v_i$。因此，$v_i$ 也是 $(T - \\omega I)$ 的特征向量，其特征值为 $(k_i - \\omega)$。因此，$v_i$ 是逆算子 $(T - \\omega I)^{-1}$ 的特征向量，其特征值为 $(k_i - \\omega)^{-1}$。\n$$ (T - \\omega I)^{-1} v_i = \\frac{1}{k_i - \\omega} v_i $$\n将此结果代回到 $S v_i$ 的表达式中：\n$$ S v_i = k_i \\left( \\frac{1}{k_i - \\omega} v_i \\right) = \\left( \\frac{k_i}{k_i - \\omega} \\right) v_i $$\n因此，算子 $S$ 与 $T$ 具有相同的特征向量 $v_i$，其特征值（我们称之为 $\\lambda_i$）由下式给出：\n$$ \\lambda_i = \\frac{k_i}{k_i - \\omega} $$\n\n**2. 迭代的渐近行为**\n\n初始向量 $\\phi^{(0)}$ 可以在特征向量基上展开：$\\phi^{(0)} = \\sum_i a_i^{(0)} v_i$。经过 $m$ 次迭代后，忽略归一化，向量变为：\n$$ \\phi^{(m)} \\propto S^m \\phi^{(0)} = \\sum_i a_i^{(0)} S^m v_i = \\sum_i a_i^{(0)} \\lambda_i^m v_i $$\n第 $j$ 个模态的含量为 $a_j^{(m)} = w_j^{\\top} \\phi^{(m)}$。由于双正交性，这会投影出第 $j$ 个分量：\n$$ a_j^{(m)} \\propto w_j^{\\top} \\left( \\sum_i a_i^{(0)} \\lambda_i^m v_i \\right) = a_j^{(0)} \\lambda_j^m $$\n第二模态相对于第一模态的相对衰减因子是其模态含量比值的每次迭代变化：\n$$ r_w = \\frac{a_2^{(m+1)}/a_1^{(m+1)}}{a_2^{(m)}/a_1^{(m)}} = \\frac{(a_2^{(0)}\\lambda_2^{m+1})/(a_1^{(0)}\\lambda_1^{m+1})}{(a_2^{(0)}\\lambda_2^{m})/(a_1^{(0)}\\lambda_1^{m})} = \\frac{\\lambda_2}{\\lambda_1} $$\n迭代算子 $S$ 的次占优与占优特征值的这个比值就是理论衰减因子。\n\n**3. 理论衰减因子的计算**\n\n使用给定数据：$k_1 = 1.000$, $k_2 = 0.90$, 和 $\\omega = 0.99$。\n首先，我们计算 $S$ 的占优和次占优特征值：\n$$ \\lambda_1 = \\frac{k_1}{k_1 - \\omega} = \\frac{1.000}{1.000 - 0.99} = \\frac{1.0}{0.01} = 100 $$\n$$ \\lambda_2 = \\frac{k_2}{k_2 - \\omega} = \\frac{0.90}{0.90 - 0.99} = \\frac{0.90}{-0.09} = -10 $$\n理论相对衰减因子 $r_w$ 是它们的比值：\n$$ r_w = \\frac{\\lambda_2}{\\lambda_1} = \\frac{-10}{100} = -0.10 $$\n因此，一个正确的 Wielandt 移位迭代应该表现出 $-0.10$ 的衰减因子。负号意味着比值 $a_2^{(m)}/a_1^{(m)}$ 的符号应该在每次迭代中交替变化。\n\n**4. 与观测结果的比较及选项评估**\n\n观测到的衰减因子是 $r_{\\mathrm{obs}} \\approx +0.90$，没有符号交替。这与理论值 $r_w = -0.10$ 存在明显且显著的差异。我们现在分析每个选项以找到最合理的解释。\n\n**A. Wielandt 移位未被应用于有效迭代算子；代码实际上是在对 $T$ 执行标准幂迭代，从而得到 $r_{\\mathrm{obs}} \\approx k_2/k_1$ 且无符号交替。**\n- 如果代码执行的是标准幂迭代，那么迭代算子就是 $T$。\n- $T$ 的特征值是 $k_i$。\n- 标准幂迭代的衰减因子是 $T$ 的次占优特征值与占优特征值的比值，即 $r_{\\mathrm{PI}} = k_2/k_1$。\n- 使用给定值：$r_{\\mathrm{PI}} = 0.90 / 1.000 = 0.90$。\n- 由于 $k_1$ 和 $k_2$ 都是正数，这个衰减因子是正的，预示着没有符号交替。\n- 计算出的 $r_{\\mathrm{PI}} = +0.90$ 与观测值 $r_{\\mathrm{obs}} \\approx +0.90$ 完全匹配。这表明存在一个编码错误，Wielandt 移位机制被绕过，迭代退化为未加速的幂方法。\n- **结论：正确。** 该选项提供了一个在定量和定性上都与所有可用信息一致的诊断。\n\n**B. 内层线性求解器的容差过大，使得每次迭代的总误差收缩率实际上为 1；观测到的 $r_{\\mathrm{obs}} \\approx 0.90$ 表明接近停滞。**\n- Wielandt 迭代需要在每一步求解一个线性系统 $(F - \\omega A) \\phi^{(m+1)} = F \\phi^{(m)}$。用于此系统的内层求解器容差过大，会阻碍外层幂迭代的收敛。\n- 如果内层求解非常差，外层迭代可能会停滞，意味着 $\\phi^{(m+1)} \\approx \\phi^{(m)}$。在这种情况下，模态含量不会显著改变，所以 $a_i^{(m+1)} \\approx a_i^{(m)}$。\n- 那么相对衰减因子将是 $r_{\\mathrm{obs}} \\approx \\frac{a_2^{(m)}/a_1^{(m)}}{a_2^{(m)}/a_1^{(m)}} = 1$。\n- 该选项声称收缩率“实际上为 1”，但随后将其等同于观测到的衰减率 $r_{\\mathrm{obs}} \\approx 0.90$。这是一个矛盾。$0.90$ 的衰减因子代表一致但缓慢的收敛，而不是停滞（停滞意味着衰减因子为 1）。\n- **结论：不正确。** 该选项内部的推理是自相矛盾的，并且与观测到的数值不符。\n\n**C. 移位被错误地实现为应用 $(T - \\omega I)^{-1}$ 而没有后乘以 $T$，这将得到 $r_{\\mathrm{obs}} \\approx \\left|\\frac{k_1 - \\omega}{k_2 - \\omega}\\right|$。**\n- 这种情况描述的是一个标准的“移位反演”幂迭代，其算子为 $S' = (T - \\omega I)^{-1}$。该方法收敛到 $T$ 的特征向量，该特征向量对应的特征值最接近移位值 $\\omega$。\n- 如前所示，$S'$ 的特征值为 $\\mu_i = (k_i - \\omega)^{-1}$。\n- 这个错误迭代的衰减因子将是其次占优与占优特征值的比值，$r' = \\mu_2 / \\mu_1$。注意 $S'$ 的占优特征值对应于最接近 $\\omega$ 的 $k_i$。此处， $|k_1 - \\omega| = |1.000-0.99| = 0.01$ 且 $|k_2 - \\omega| = |0.90-0.99|=0.09$。所以 $k_1$ 最接近，且 $\\mu_1 = (k_1-\\omega)^{-1}$ 是 $S'$ 的占优特征值。\n- 衰减因子是 $r' = \\frac{\\mu_2}{\\mu_1} = \\frac{(k_2-\\omega)^{-1}}{(k_1-\\omega)^{-1}} = \\frac{k_1-\\omega}{k_2-\\omega} = \\frac{1.000-0.99}{0.90-0.99} = \\frac{0.01}{-0.09} = -\\frac{1}{9} \\approx -0.111$。\n- 这个预测的衰减因子是负数，其大小约为 $0.111$。这与观测到的 $r_{\\mathrm{obs}} \\approx +0.90$ 严重不符。选项中给出的公式 $\\left|\\frac{k_1 - \\omega}{k_2 - \\omega}\\right|$ 给出了大小，但也与观测结果不一致。\n- **结论：不正确。**\n\n**D. 模态投影诊断使用了一个非双正交的内积，这污染了测得的 $a_i^{(m)}$，即使在 Wielandt 移位被正确实现的情况下也产生了大的系统性偏差。**\n- 我们假设 Wielandt 移位工作正常，因此真实的衰减率是 $r_w = -0.10$。这意味着 $v_2$ 分量正在非常迅速地衰减。\n- 几次迭代后，迭代向量被基模强烈主导：$\\phi^{(m)} \\approx C v_1$。\n- 如果诊断中使用的投影向量与特征向量不是真正的双正交，那么测得的第二模态含量 $a_{2, \\text{meas}}^{(m)}$ 将会包含来自占优的第一模态的虚假贡献。这被称为模态串扰（modal cross-talk）。\n- 随着 $m$ 的增加，$\\phi^{(m)}$ 趋近于 $v_1$，测得的两个模态含量 $a_{1, \\text{meas}}^{(m)}$ 和 $a_{2, \\text{meas}}^{(m)}$ 都将与同一个占优分量成正比，导致它们的比值趋于一个常数。\n- 如果 $a_2^{(m)}/a_1^{(m)} \\to \\text{常数}$，那么每次迭代的衰减因子 $r_{\\mathrm{obs}}$ 将趋近于 1。\n- 这样的测量误差系统性地产生恰好为 $0.90$ 这个值的可能性极小，而这个值恰好是另一种完全不同的算法（标准幂迭代）的衰减因子。根据奥卡姆剃刀原理，更简单的解释——即实际上运行的是另一种算法——可能性要大得多。\n- **结论：不正确。** 这是一个远不如选项 A 合理的解释。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "最后的这个练习是一个综合性的编程任务，它将前面学到的所有理论知识融会贯通，构建一个完整的自适应维兰特移位求解器。您将从广义特征值问题出发，实现包括通量归一化、瑞利商更新$k$值以及自适应移位参数$w$控制在内的全部核心算法组件。完成这个练习标志着您从理解理论到能够动手解决实际物理问题的关键一步，它强调了在真实求解器中必须考虑的各种工程细节。",
            "id": "4261212",
            "problem": "您的任务是设计并实现一个完整的、可运行的程序，该程序使用带有自适应移位控制的 Wielandt 移位迭代法，计算反应堆堆芯中简化稳态中子平衡的主导中子增殖因子，即有效增殖因子 $k$。其基本依据是多群扩散离散化下的稳态中子平衡方程，该方程可写成如下广义特征值形式\n$$\n\\mathbf{F}\\,\\boldsymbol{\\phi} \\;=\\; k\\,\\mathbf{A}\\,\\boldsymbol{\\phi},\n$$\n其中 $\\mathbf{A}$ 是损失和散射算子（对称正定），$\\mathbf{F}$ 是裂变产生算子（逐项非负），$\\boldsymbol{\\phi}$ 是中子通量矢量。您的求解器必须使用 Wielandt 移位，在每次迭代中进行通量归一化，并使用瑞利商更新 $k$，同时采用针对 Wielandt 移位参数 $w$ 的自适应控制策略。\n\n从上述广义特征值问题出发作为唯一基础，您必须：\n\n- 实现一个迭代特征值求解器，该求解器将 Wielandt 移位算子映射应用于当前的通量迭代值，并求解以下形式的线性系统：\n$$\n(\\mathbf{F} - w\\,\\mathbf{A})\\,\\mathbf{y} \\;=\\; \\mathbf{F}\\,\\boldsymbol{\\phi}^{(m)}\n$$\n以在归一化后生成下一个通量 $\\boldsymbol{\\phi}^{(m+1)}$。归一化必须在每次迭代中强制执行 $L_1$ 范数缩放，即 $\\sum_i \\phi_i^{(m+1)} = 1$，以表示一致的通量大小。\n- 在每次迭代中，使用适用于广义特征值问题的瑞利商来更新有效增殖因子 $k$ 的估计值。\n- 在每次迭代中，使用中子平衡的残差自适应地更新移位 $w$，同时强制执行严格的安全裕度以保证 $(\\mathbf{F} - w\\,\\mathbf{A})$ 保持非奇异。自适应规则必须确保在所有迭代中 $0  w  k$，并且随着残差的减小而增加 $w$，但绝不允许 $w$ 任意接近 $k$（使用一个分数安全裕度）。\n- 使用基于 $k$ 的相对变化的停止准则进行迭代，直至收敛；具体而言，当 $k$ 的相对变化小于 $10^{-8}$ 时，或当达到最大迭代次数 $1000$ 次时，迭代必须停止。\n\n此问题中的所有量均为无量纲。请使用双精度算术。用严格为正的分量初始化通量 $\\boldsymbol{\\phi}^{(0)}$，并将其归一化至单位 $L_1$ 范数。\n\n您必须为以下三个测试用例实现并运行求解器，每个用例由矩阵 $\\mathbf{A}$ 和 $\\mathbf{F}$ 定义：\n\n- 测试用例 $1$ ($3\\times 3$):\n$$\n\\mathbf{A}_1 \\;=\\;\n\\begin{bmatrix}\n2.5  -0.6  0.0\\\\\n-0.6  2.7  -0.5\\\\\n0.0  -0.5  2.2\n\\end{bmatrix},\n\\quad\n\\mathbf{F}_1 \\;=\\;\n\\begin{bmatrix}\n0.9  0.1  0.0\\\\\n0.05  0.75  0.05\\\\\n0.0  0.1  0.65\n\\end{bmatrix}.\n$$\n\n- 测试用例 $2$ ($4\\times 4$):\n$$\n\\mathbf{A}_2 \\;=\\;\n\\begin{bmatrix}\n2.0  -0.2  0.0  0.0\\\\\n-0.2  2.1  -0.2  0.0\\\\\n0.0  -0.2  2.0  -0.2\\\\\n0.0  0.0  -0.2  2.0\n\\end{bmatrix},\n\\quad\n\\mathbf{F}_2 \\;=\\;\n\\begin{bmatrix}\n0.7  0.05  0.05  0.0\\\\\n0.05  0.68  0.05  0.05\\\\\n0.05  0.05  0.68  0.05\\\\\n0.0  0.05  0.05  0.7\n\\end{bmatrix}.\n$$\n\n- 测试用例 $3$ ($3\\times 3$):\n$$\n\\mathbf{A}_3 \\;=\\;\n\\begin{bmatrix}\n1.8  -0.4  0.0\\\\\n-0.4  1.9  -0.3\\\\\n0.0  -0.3  1.7\n\\end{bmatrix},\n\\quad\n\\mathbf{F}_3 \\;=\\;\n\\begin{bmatrix}\n0.3  0.02  0.0\\\\\n0.02  0.28  0.02\\\\\n0.0  0.02  0.25\n\\end{bmatrix}.\n$$\n\n算法要求：\n\n- 使用与 $k$ 的初始估计值成比例的初始移位 $w$，并在每次迭代中使用中子平衡的残差来调整 $w$，同时保持一个低于 $k$ 的固定分数安全裕度。\n- 在每次迭代中，对通量 $\\boldsymbol{\\phi}$ 进行 $L_1$ 范数归一化。\n- 通过与广义特征值问题相关的瑞利商更新 $k$。\n- 采用基于 $k$ 的相对变化小于 $10^{-8}$ 的停止准则，或在达到 1000 次迭代时终止，以先到者为准。\n- 如果线性系统 $(\\mathbf{F} - w\\,\\mathbf{A})\\,\\mathbf{y} = \\mathbf{F}\\,\\boldsymbol{\\phi}$ 在自适应规则下是病态的，您必须强制执行安全裕度并相应地减小 $w$ 以保持数值稳定性。\n\n您的程序必须计算并报告三个测试用例收敛后的 $k$ 值，以浮点数形式表示，并四舍五入到六位小数。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如 $[k_1,k_2,k_3]$）。输出没有物理单位；它是无量纲的。",
            "solution": "该问题是有效的。它提出了一个适定的数值任务，该任务基于核反应堆物理和数值线性代数的既定原理。所提供的数据和约束是自洽的、一致的且科学上合理的。\n\n问题的核心是求解以下广义特征值问题的最大正实数特征值 $k$，即有效增殖因子：\n$$\n\\mathbf{F}\\,\\boldsymbol{\\phi} \\;=\\; k\\,\\mathbf{A}\\,\\boldsymbol{\\phi}\n$$\n此处，$\\mathbf{F}$ 是裂变产生算子，$\\mathbf{A}$ 是中子损失和散射算子，$\\boldsymbol{\\phi}$ 是与 $k$ 对应的中子通量特征向量。问题指定使用 Wielandt 移位迭代法来求解主导特征对 $(k, \\boldsymbol{\\phi})$。\n\n指定的迭代格式在每次迭代 $m$ 中求解线性系统\n$$\n(\\mathbf{F} - w\\,\\mathbf{A})\\,\\mathbf{y}^{(m+1)} \\;=\\; \\mathbf{F}\\,\\boldsymbol{\\phi}^{(m)}\n$$\n。这是一种反幂法。为了理解这一点，我们可以将方程重写为 $\\mathbf{y}^{(m+1)} = (\\mathbf{F} - w\\,\\mathbf{A})^{-1}\\mathbf{F}\\,\\boldsymbol{\\phi}^{(m)}$。因此，迭代矩阵为 $\\mathbf{T}_w = (\\mathbf{F} - w\\mathbf{A})^{-1}\\mathbf{F}$。原始问题中特征值为 $k_i$ 的特征向量 $\\boldsymbol{\\phi}_i$ 也是 $\\mathbf{T}_w$ 的特征向量。$\\mathbf{T}_w$ 对应的特征值 $\\mu_i$ 由下式给出：\n$$\n\\mathbf{T}_w \\boldsymbol{\\phi}_i = (\\mathbf{F} - w\\mathbf{A})^{-1}\\mathbf{F}\\boldsymbol{\\phi}_i = (\\mathbf{F} - w\\mathbf{A})^{-1}(k_i\\mathbf{A}\\boldsymbol{\\phi}_i)\n$$\n从原始方程，我们有 $(k_i\\mathbf{A} - w\\mathbf{A})\\boldsymbol{\\phi}_i = (\\mathbf{F}-w\\mathbf{A})\\boldsymbol{\\phi}_i$。重新整理得到 $\\mathbf{A}\\boldsymbol{\\phi}_i = \\frac{1}{k_i-w}(\\mathbf{F}-w\\mathbf{A})\\boldsymbol{\\phi}_i$。将此代入前面的表达式可得：\n$$\n\\mathbf{T}_w \\boldsymbol{\\phi}_i = (\\mathbf{F} - w\\mathbf{A})^{-1} \\left( \\frac{k_i}{k_i-w} (\\mathbf{F}-w\\mathbf{A})\\boldsymbol{\\phi}_i \\right) = \\frac{k_i}{k_i-w} \\boldsymbol{\\phi}_i\n$$\n因此，特征值通过 $\\mu_i = \\frac{k_i}{k_i-w}$ 关联。该迭代实质上是幂法，它收敛到与 $\\mathbf{T}_w$ 的最大模特征值相关联的特征向量。通过选择移位 $w$ 接近但严格小于主导特征值 $k_{\\text{dom}}$，$\\mu_{\\text{dom}} = \\frac{k_{\\text{dom}}}{k_{\\text{dom}}-w}$ 的值会变得非常大，而其他的 $\\mu_i$ 则相对较小。这显著加速了收敛。\n\n完整的算法如下：\n\n1.  **初始化**：设 $N$ 为系统维度。\n    - 初始化迭代计数器 $m=0$。\n    - 初始化一个严格为正的通量矢量 $\\boldsymbol{\\phi}^{(0)}$，例如，一个均匀矢量 $\\phi_j^{(0)} = 1/N$ (对所有 $j=1, \\dots, N$)。这自动满足了单位 $L_1$ 范数条件 $||\\boldsymbol{\\phi}^{(0)}||_1 = \\sum_j |\\phi_j^{(0)}| = 1$。\n    - 使用广义瑞利商计算特征值的初始估计值 $k^{(0)}$：\n      $$\n      k^{(0)} = \\frac{{\\boldsymbol{\\phi}^{(0)}}^T \\mathbf{F} \\boldsymbol{\\phi}^{(0)}}{{\\boldsymbol{\\phi}^{(0)}}^T \\mathbf{A} \\boldsymbol{\\phi}^{(0)}}\n      $$\n    - 定义自适应移位 $w$ 以维持一个固定的分数安全裕度 $\\delta$。我们选择 $\\delta=0.02$。移位更新规则为 $w^{(m)} = (1-\\delta)k^{(m)}$。此规则确保 $w$ 始终为正且严格小于 $k$，并且随着 $k$ 的收敛，$w$ 会朝着其最优值增加。\n\n2.  **迭代循环**：对于 $m = 0, 1, 2, \\dots$ 直到最大值 $1000$：\n    - 存储当前特征值估计值：$k_{\\text{prev}} = k^{(m)}$。\n    - 更新当前迭代的自适应移位：$w^{(m)} = (1-\\delta)k^{(m)}$。\n    - 构建移位系统矩阵 $\\mathbf{S}^{(m)} = \\mathbf{F} - w^{(m)}\\mathbf{A}$ 和右侧源项矢量 $\\mathbf{s}^{(m)} = \\mathbf{F}\\boldsymbol{\\phi}^{(m)}$。\n    - 求解线性系统 $\\mathbf{S}^{(m)}\\mathbf{y}^{(m+1)} = \\mathbf{s}^{(m)}$ 以获得未归一化的通量 $\\mathbf{y}^{(m+1)}$。\n    - 使用 $L_1$ 范数对新的通量矢量进行归一化：$\\boldsymbol{\\phi}^{(m+1)} = \\frac{\\mathbf{y}^{(m+1)}}{||\\mathbf{y}^{(m+1)}||_1}$。\n    - 使用新的通量矢量，通过瑞利商更新特征值估计值：\n      $$\n      k^{(m+1)} = \\frac{{\\boldsymbol{\\phi}^{(m+1)}}^T \\mathbf{F} \\boldsymbol{\\phi}^{(m+1)}}{{\\boldsymbol{\\phi}^{(m+1)}}^T \\mathbf{A} \\boldsymbol{\\phi}^{(m+1)}}\n      $$\n\n3.  **终止**：当特征值估计的相对变化低于容差 $10^{-8}$ 时，即\n    $$\n    \\frac{|k^{(m+1)} - k_{\\text{prev}}|}{|k^{(m+1)}|}  10^{-8}\n    $$\n    或当达到最大迭代次数 $1000$ 次时，迭代停止。\n\n自适应移位策略 $w = (1-\\delta)k$ 对数值稳定性至关重要。如果 $w$ 是矩阵束 $(\\mathbf{F}, \\mathbf{A})$ 的一个广义特征值，则矩阵 $\\mathbf{F} - w\\mathbf{A}$ 会变为奇异矩阵。通过将 $w$ 与 $k_{\\text{dom}}$ 的当前估计值绑定并设置一个固定的安全裕度，我们确保当 $k \\to k_{\\text{dom}}$ 时，$w$ 从下方逼近 $k_{\\text{dom}}$ 但永不达到它，从而防止奇异性。所有算术运算都使用双精度浮点数执行。此过程将应用于所提供的三个测试用例中的每一个。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and compute the effective multiplication factor k.\n    \"\"\"\n\n    def compute_k_eff(A, F, tol=1e-8, max_iter=1000, safety_margin=0.02):\n        \"\"\"\n        Computes the dominant eigenvalue k of F*phi = k*A*phi using an adaptive Wielandt shift.\n\n        Args:\n            A (np.ndarray): The loss and scattering operator matrix.\n            F (np.ndarray): The fission production operator matrix.\n            tol (float): The convergence tolerance for the relative change in k.\n            max_iter (int): The maximum number of iterations.\n            safety_margin (float): The fractional margin to keep w below k (w = (1-margin)*k).\n\n        Returns:\n            float: The converged dominant eigenvalue k.\n        \"\"\"\n        n = A.shape[0]\n\n        # 1. Initialization\n        # a) Initial flux: uniform, positive, and L1-normalized\n        phi = np.ones(n, dtype=np.float64) / n\n        \n        # b) Initial k estimate using the Rayleigh quotient\n        k = (phi.T @ F @ phi) / (phi.T @ A @ phi)\n        \n        # Factor for adaptive shift update: w = shift_factor * k\n        shift_factor = 1.0 - safety_margin\n\n        # 2. Iteration Loop\n        for _ in range(max_iter):\n            k_old = k\n\n            # a) Update the adaptive Wielandt shift\n            w = shift_factor * k\n            \n            # b) Form the shifted system matrix and the source term\n            S = F - w * A\n            source = F @ phi\n            \n            # c) Solve the linear system (F - w*A)*y = F*phi\n            try:\n                y = np.linalg.solve(S, source)\n            except np.linalg.LinAlgError:\n                # This should not occur with the chosen adaptive shift strategy,\n                # which keeps w safely away from any eigenvalue.\n                return np.nan\n\n            # d) Normalize the resulting flux vector using the L1-norm\n            phi_norm = np.linalg.norm(y, 1)\n            if phi_norm == 0:\n                return np.nan # Should not happen with non-trivial F matrices\n            phi = y / phi_norm\n            \n            # e) Update k using the Rayleigh quotient with the new flux\n            k = (phi.T @ F @ phi) / (phi.T @ A @ phi)\n            \n            # f) Check for convergence\n            if abs(k)  np.finfo(float).eps: # Avoid division by small k\n                if abs(k - k_old) / abs(k)  tol:\n                    break\n        \n        return k\n\n    # Define the test cases from the problem statement.\n    # All matrices are explicitly defined with double-precision floating-point type.\n    test_cases = [\n        (\n            np.array([[2.5, -0.6, 0.0], [-0.6, 2.7, -0.5], [0.0, -0.5, 2.2]], dtype=np.float64),\n            np.array([[0.9, 0.1, 0.0], [0.05, 0.75, 0.05], [0.0, 0.1, 0.65]], dtype=np.float64)\n        ),\n        (\n            np.array([[2.0, -0.2, 0.0, 0.0], [-0.2, 2.1, -0.2, 0.0], [0.0, -0.2, 2.0, -0.2], [0.0, 0.0, -0.2, 2.0]], dtype=np.float64),\n            np.array([[0.7, 0.05, 0.05, 0.0], [0.05, 0.68, 0.05, 0.05], [0.05, 0.05, 0.68, 0.05], [0.0, 0.05, 0.05, 0.7]], dtype=np.float64)\n        ),\n        (\n            np.array([[1.8, -0.4, 0.0], [-0.4, 1.9, -0.3], [0.0, -0.3, 1.7]], dtype=np.float64),\n            np.array([[0.3, 0.02, 0.0], [0.02, 0.28, 0.02], [0.0, 0.02, 0.25]], dtype=np.float64)\n        )\n    ]\n\n    results = []\n    for A_case, F_case in test_cases:\n        k_eff = compute_k_eff(A_case, F_case)\n        # Format the result to six decimal places as required.\n        results.append(f\"{k_eff:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver.\nsolve()\n```"
        }
    ]
}