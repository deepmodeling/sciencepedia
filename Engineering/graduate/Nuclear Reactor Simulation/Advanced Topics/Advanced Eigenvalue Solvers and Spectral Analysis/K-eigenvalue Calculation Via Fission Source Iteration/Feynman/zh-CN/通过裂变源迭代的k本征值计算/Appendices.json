{
    "hands_on_practices": [
        {
            "introduction": "第一个实践将 $k$ 特征值的概念建立在一个经典的、可解析求解的模型之上。通过将单群扩散近似应用于裸平板反应堆，您将通过“曲率”这一概念，把材料性质和几何形状与有效增殖因数 $k_{\\text{eff}}$ 联系起来。该练习 () 为理解决定反应堆临界状态的中子产生、吸收和泄漏之间的竞争关系，建立了基本的直觉。",
            "id": "4232366",
            "problem": "考虑一个由稳态单能中子扩散近似描述的裸均匀反应堆。未知标量中子通量为 $\\phi(\\mathbf{r})$，扩散系数为 $D$，宏观吸收截面为 $\\Sigma_{a}$，每次裂变产生的平均中子数乘以宏观裂变截面为 $\\nu \\Sigma_{f}$。在 $k$ 特征值表述中，基波模的平衡方程可写为\n$$\n- D \\nabla^{2} \\phi(\\mathbf{r}) + \\Sigma_{a} \\phi(\\mathbf{r}) = \\frac{\\nu \\Sigma_{f}}{k} \\, \\phi(\\mathbf{r}) \\, ,\n$$\n边界条件为真空边界条件，通过设置外推边界上 $\\phi$ 为零来实现。该反应堆是一个以 $x=0$ 为中心、物理厚度为 $L$ 的一维板状堆，其外推边界位于 $x=\\pm L_{e}/2$ 处，其中 $L_{e} = L + 2 z_{\\mathrm{ex}}$，外推距离为 $z_{\\mathrm{ex}} = 2.131 \\, D$。\n\n从扩散近似和空间曲率的概念出发，通过将材料曲率与板状堆的几何曲率联系起来，推导出 $k$ 特征值条件，并将其与裂变源迭代法（FSI）的不动点特性联系起来。裂变源迭代法定义为重复的固定源求解，其中第 $n$ 次迭代的裂变源 $S^{(n)}(\\mathbf{r})$ 为 $S^{(n)}(\\mathbf{r}) = \\left(\\nu \\Sigma_{f} / k^{(n)}\\right) \\phi^{(n)}(\\mathbf{r})$。假设基波几何模式满足真空边界条件，并利用此模式计算所隐含的特征值。\n\n对于具有以下性质的均匀裸板状堆：\n- $L = 100\\,\\mathrm{cm}$，\n- $D = 1.2\\,\\mathrm{cm}$，\n- $\\Sigma_{a} = 0.010\\,\\mathrm{cm}^{-1}$，\n- $\\nu \\Sigma_{f} = 0.011\\,\\mathrm{cm}^{-1}$，\n\n计算其有效增殖因数 $k_{\\mathrm{eff}}$（将 $k_{\\mathrm{eff}}$ 定义为扩散 $k$ 特征值问题的主特征值）。将最终答案表示为一个无量纲标量，并四舍五入至四位有效数字。",
            "solution": "该问题是有效的。这是核反应堆物理导论中一个标准的、适定的问题，基于单群中子扩散模型。所有必要的参数和条件都已给出，问题在科学上是合理的。因此，我们可以着手求解。\n\n出发点是稳态单能中子扩散方程的 $k$ 特征值形式：\n$$\n- D \\nabla^{2} \\phi(\\mathbf{r}) + \\Sigma_{a} \\phi(\\mathbf{r}) = \\frac{1}{k} \\nu \\Sigma_{f} \\phi(\\mathbf{r})\n$$\n其中 $\\phi(\\mathbf{r})$ 是中子通量，$D$ 是扩散系数，$\\Sigma_{a}$ 是宏观吸收截面，$\\nu \\Sigma_{f}$ 是中子产生截面项。参数 $k$ 是特征值，对于基波模，它就是有效增殖因数 $k_{\\mathrm{eff}}$。\n\n我们可以将方程重新整理成类似亥姆霍兹方程的形式。对于均匀介质，材料性质 $D$、$\\Sigma_{a}$ 和 $\\nu\\Sigma_f$ 是常数。\n$$\n- D \\nabla^{2} \\phi(\\mathbf{r}) = \\left(\\frac{\\nu \\Sigma_{f}}{k} - \\Sigma_{a}\\right) \\phi(\\mathbf{r})\n$$\n两边同除以 $D$ 得：\n$$\n\\nabla^{2} \\phi(\\mathbf{r}) + \\frac{1}{D}\\left(\\frac{\\nu \\Sigma_{f}}{k} - \\Sigma_{a}\\right) \\phi(\\mathbf{r}) = 0\n$$\n该方程的形式为 $\\nabla^{2} \\phi(\\mathbf{r}) + B^2 \\phi(\\mathbf{r}) = 0$，其中 $B^2$ 是系统的总曲率。为了使解存在，曲率必须满足两个独立的定义。\n\n首先，**材料曲率** $B_m^2$ 是材料成分的一种属性。它描述了在无限大介质中中子产生和吸收的内在平衡。对于一个增殖因数为 $k$ 的系统，曲率由乘以通量项的系数给出：\n$$\nB^2 = \\frac{\\nu \\Sigma_{f}/k - \\Sigma_{a}}{D}\n$$\n其次，**几何曲率** $B_g^2$ 由反应堆的几何形状和边界条件决定。它表示为满足边界条件所需的中子通量分布的曲率，并且是方程 $\\nabla^{2} \\phi + B_g^2 \\phi = 0$ 的一个特征值。\n\n对于给定的以 $x=0$ 为中心的一维板状堆，算符 $\\nabla^2$ 变为 $\\frac{d^2}{dx^2}$。几何曲率的方程为：\n$$\n\\frac{d^2\\phi(x)}{dx^2} + B_g^2 \\phi(x) = 0\n$$\n通解为 $\\phi(x) = C_1 \\cos(B_g x) + C_2 \\sin(B_g x)$。对于对称区域中的基波模，解必须是对称的，因此我们需要 $C_2 = 0$。这样剩下 $\\phi(x) = C_1 \\cos(B_g x)$。真空边界条件通过将外推边界 $x = \\pm L_e/2$ 处的通量设为零来施加。应用此条件：\n$$\n\\phi(\\pm L_e/2) = C_1 \\cos(B_g L_e/2) = 0\n$$\n为得到非平凡解（$C_1 \\neq 0$），余弦函数的自变量必须是 $\\pi/2$ 的奇数倍。基波模对应于 $B_g$ 的最小正值，因此我们取：\n$$\nB_g \\frac{L_e}{2} = \\frac{\\pi}{2} \\implies B_g = \\frac{\\pi}{L_e}\n$$\n因此，基波模的几何曲率为：\n$$\nB_g^2 = \\left(\\frac{\\pi}{L_e}\\right)^2\n$$\n对于一个稳态临界反应堆，材料性质必须能维持由几何形状决定的通量形状。这要求材料曲率和几何曲率相等，从而导出临界条件。我们令 $B^2 = B_g^2$ 并求解特征值 $k$，记作 $k_{\\mathrm{eff}}$：\n$$\n\\frac{\\nu \\Sigma_{f}/k_{\\mathrm{eff}} - \\Sigma_{a}}{D} = B_g^2\n$$\n求解 $k_{\\mathrm{eff}}$：\n$$\n\\frac{\\nu \\Sigma_{f}}{k_{\\mathrm{eff}}} = \\Sigma_{a} + D B_g^2\n$$\n$$\nk_{\\mathrm{eff}} = \\frac{\\nu \\Sigma_{f}}{\\Sigma_{a} + D B_g^2}\n$$\n这个结果在物理上是直观的：$k_{\\mathrm{eff}}$ 是中子产生率（$\\nu \\Sigma_f \\phi$）与中子损失率之比。分母中的损失项包括吸收（$\\Sigma_a \\phi$）和泄漏，泄漏由项 $D B_g^2 \\phi$ 表示。\n\n裂变源迭代法（FSI）是一种数值幂迭代方法，用于寻找主特征值 $k_{\\mathrm{eff}}$ 及其对应的特征函数（基波通量模）。迭代过程为 $L\\phi^{(n+1)} = \\frac{1}{k^{(n)}} S^{(n)}$，其中 $L$ 是扩散-吸收算符，$S^{(n)} = \\nu \\Sigma_f \\phi^{(n)}$ 是裂变源。当迭代收敛时，通量形状是稳定的（$\\phi^{(n+1)} \\propto \\phi^{(n)}$），这是迭代算符的一个不动点。基波模通量 $\\phi(x) = C_1 \\cos(B_g x)$ 是扩散算符的一个特征函数。当裂变源与此模式成正比时，通过固定源求解得到的通量将具有相同的空间形状。特征值 $k_{\\mathrm{eff}}$ 正是确保这种自洽性的因子，它平衡了该特定空间模式的中子产生和损失。我们推导出的 $k_{\\mathrm{eff}}$ 解析公式正是裂变源迭代法针对此问题收敛到的精确值。\n\n现在，我们使用所提供的数据计算 $k_{\\mathrm{eff}}$ 的数值：\n- 物理厚度: $L = 100\\,\\mathrm{cm}$\n- 扩散系数: $D = 1.2\\,\\mathrm{cm}$\n- 宏观吸收截面: $\\Sigma_{a} = 0.010\\,\\mathrm{cm}^{-1}$\n- 中子产生项: $\\nu \\Sigma_{f} = 0.011\\,\\mathrm{cm}^{-1}$\n\n首先，我们计算外推距离 $z_{\\mathrm{ex}}$：\n$$\nz_{\\mathrm{ex}} = 2.131 \\, D = 2.131 \\times 1.2\\,\\mathrm{cm} = 2.5572\\,\\mathrm{cm}\n$$\n接着，我们计算外推厚度 $L_e$：\n$$\nL_e = L + 2 z_{\\mathrm{ex}} = 100\\,\\mathrm{cm} + 2 \\times 2.5572\\,\\mathrm{cm} = 105.1144\\,\\mathrm{cm}\n$$\n有了 $L_e$，我们可以计算几何曲率 $B_g^2$：\n$$\nB_g^2 = \\left(\\frac{\\pi}{L_e}\\right)^2 = \\left(\\frac{\\pi}{105.1144\\,\\mathrm{cm}}\\right)^2 \\approx 0.000893316\\,\\mathrm{cm}^{-2}\n$$\n现在，我们可以计算 $k_{\\mathrm{eff}}$ 表达式分母中的总损失项：\n$$\n\\Sigma_{a} + D B_g^2 = 0.010\\,\\mathrm{cm}^{-1} + (1.2\\,\\mathrm{cm}) \\times (0.000893316\\,\\mathrm{cm}^{-2})\n$$\n$$\n\\Sigma_{a} + D B_g^2 = 0.010\\,\\mathrm{cm}^{-1} + 0.001071979\\,\\mathrm{cm}^{-1} = 0.011071979\\,\\mathrm{cm}^{-1}\n$$\n最后，我们计算 $k_{\\mathrm{eff}}$：\n$$\nk_{\\mathrm{eff}} = \\frac{\\nu \\Sigma_{f}}{\\Sigma_{a} + D B_g^2} = \\frac{0.011\\,\\mathrm{cm}^{-1}}{0.011071979\\,\\mathrm{cm}^{-1}} \\approx 0.99350005\n$$\n按要求将结果四舍五入至四位有效数字，得到 $0.9935$。",
            "answer": "$$\n\\boxed{0.9935}\n$$"
        },
        {
            "introduction": "本实践从解析解过渡到数值方法，重点关注现代反应堆分析中使用的核心算法。您将实现作为 $k$ 特征值计算主要工具的裂变源迭代 (FSI) 算法，该算法在数学上等同于幂法。通过处理一个小的离散矩阵系统 ()，您将研究该算法数值行为的关键方面，例如初始源猜测的影响以及强制执行源正性的物理必要性。",
            "id": "4232373",
            "problem": "考虑一个均匀反应堆中的稳态中子平衡问题，该问题已被离散化为一个从非负裂变源到其下一代裂变源的有限维线性映射。从增殖形式的线性玻尔兹曼输运方程出发，离散化产生一个非负线性算子，该算子将一个裂变源映射到下一代裂变源。将这个组合的单代映射定义为一个方阵 $\\mathbf{H} \\in \\mathbb{R}^{n \\times n}$，其元素非负，代表了离散的多区域、多能量群状态向量中子输运、散射和裂变发射过程的复合。$k$-特征值问题旨在求解主特征对 $(k, \\mathbf{s})$，其中 $k > 0$ 且 $\\mathbf{s} \\ge 0$，满足 $\\mathbf{H} \\mathbf{s} = k \\mathbf{s}$，$\\mathbf{s}$ 是一个非负的裂变源向量。假设该组合算子是不可约的，根据 Perron–Frobenius 定理，这保证了存在唯一的主特征值和严格为正的特征向量。\n\n实现一个裂变源迭代算法，给定矩阵 $\\mathbf{H}$、一个初始猜测 $\\mathbf{s}^{(0)}$ 和一个正性强制策略 $\\mathcal{P}$，该算法更新裂变源和估计的增殖因子。核心迭代过程如下：应用映射得到原始传播向量，可选择使用 $\\mathcal{P}$ 强制正性，基于诱导向量范数形成更新后的特征值估计，并将裂变源重新归一化到固定范数以防止数值上溢或下溢。持续迭代直至特征值估计收敛。\n\n您必须构建一个完整的程序，该程序：\n- 使用给定的算子 $\\mathbf{H}$，其中 $n = 4$，其元素为\n  $\\mathbf{H} = \\begin{bmatrix}\n  0.35  0.20  0.30  0.10 \\\\\n  0.20  0.40  0.10  0.15 \\\\\n  0.25  0.15  0.45  0.20 \\\\\n  0.10  0.15  0.15  0.50\n  \\end{bmatrix}$。\n- 对每个测试用例，接受一个初始裂变源向量 $\\mathbf{s}^{(0)} \\in \\mathbb{R}^4$ 和一个从以下集合中选择的正性强制策略 $\\mathcal{P}$：\n  1. $\\mathcal{P} = \\text{none}$：不强制正性；原始传播向量按原样使用。\n  2. $\\mathcal{P} = \\text{clip\\_zero}$：用 $0$ 替换负分量。\n  3. $\\mathcal{P} = \\text{abs}$：用其分量的绝对值替换传播向量。\n- 使用 $\\ell_1$-范数来估计第 $m$ 次迭代的特征值，即 $k^{(m+1)} = \\|\\mathbf{y}^{(m)}\\|_1 / \\|\\mathbf{s}^{(m)}\\|_1$，其中 $\\mathbf{y}^{(m)}$ 是归一化之前的传播向量，并重新归一化 $\\mathbf{s}^{(m+1)} = \\mathbf{y}^{(m)} / \\|\\mathbf{y}^{(m)}\\|_1$。\n- 在应用 $\\mathcal{P}$ 之前的任何迭代中，检测原始传播向量 $\\mathbf{y}^{(m)}$ 中是否出现任何负值项。\n- 当 $k$ 的相对变化满足 $|k^{(m+1)} - k^{(m)}| / \\max(k^{(m)}, 1)  10^{-10}$ 或达到最大迭代次数 $5000$ 次时停止。\n- 仅在需要时使用一个小的严格正微扰 $\\varepsilon = 10^{-14}$，以避免在归一化过程中出现零向量。\n- 为每个测试用例生成结果，形式为一对 $[k, \\text{flag}]$，其中 $k$ 是收敛的增殖因子，四舍五入到 $8$ 位小数，$\\text{flag}$ 是一个布尔值，指示在任何迭代中（在强制正性之前）原始传播向量中是否出现过任何负值项。程序必须将所有测试用例的结果输出到单一行中，作为一个用方括号括起来的逗号分隔列表，其中每对结果也用方括号括起来。\n\n您的程序必须实现上述迭代，并在以下测试套件上运行：\n- 测试用例 1（理想路径）：$\\mathbf{s}^{(0)} = [0.25, 0.25, 0.25, 0.25]$ 且 $\\mathcal{P} = \\text{none}$。\n- 测试用例 2（符号缺失的初始猜测）：$\\mathbf{s}^{(0)} = [1.0, -0.5, 0.3, -0.8]$ 且 $\\mathcal{P} = \\text{none}$。\n- 测试用例 3（通过裁剪强制正性）：$\\mathbf{s}^{(0)} = [1.0, -0.5, 0.3, -0.8]$ 且 $\\mathcal{P} = \\text{clip\\_zero}$。\n- 测试用例 4（初始向量为零的边界情况）：$\\mathbf{s}^{(0)} = [0.0, 0.0, 0.0, 0.0]$ 且 $\\mathcal{P} = \\text{clip\\_zero}$。\n\n此计算不涉及物理单位。不使用角度。不使用百分比。您的程序应生成单行输出，其中包含按指定格式获得的结果，即一个逗号分隔的列表，用方括号括起来，每个测试用例的结果是一对 $[k, \\text{flag}]$（例如，`[[1.01234567,True],[…]]`）。",
            "solution": "所提出的问题是有效的。这是一个适定的数值问题，其基础是核反应堆物理学和数值线性代数的既定原理。该问题是自洽的、客观的，并提供了所有必要的数据和约束，以便通过算法确定唯一的解。\n\n该问题要求实现裂变源迭代法（在数学上等同于幂迭代算法），以找到给定矩阵 $\\mathbf{H}$ 的主特征值。这个主特征值用 $k$ 表示，在一个简化的、离散化的核反应堆模型中代表有效中子增殖因子。\n\n控制方程是稳态 $k$-特征值问题：\n$$\n\\mathbf{H} \\mathbf{s} = k \\mathbf{s}\n$$\n这里，$\\mathbf{s}$ 是表示裂变源空间和能量分布的特征向量，而 $k$ 是对应的特征值。在反应堆物理学中，临界系统的特征是 $k=1$。矩阵 $\\mathbf{H} \\in \\mathbb{R}^{n \\times n}$ 是一个线性算子，它将一个世代的裂变源分布映射到下一个世代。该矩阵如下所示：\n$$\n\\mathbf{H} = \\begin{bmatrix}\n0.35  0.20  0.30  0.10 \\\\\n0.20  0.40  0.10  0.15 \\\\\n0.25  0.15  0.45  0.20 \\\\\n0.10  0.15  0.15  0.50\n\\end{bmatrix}\n$$\n问题指出 $\\mathbf{H}$ 是非负且不可约的。事实上，给定矩阵 $\\mathbf{H}$ 的所有元素都是严格为正的，$H_{ij} > 0$，这是一个更强的条件，称为本原性。对于本原矩阵，Perron-Frobenius 定理保证存在一个唯一的特征值 $k$，它是实数、正数，并且其绝对值严格大于所有其他特征值。这就是主特征值，或称 $k$-特征值。其对应的特征向量 $\\mathbf{s}$ 可以被选择为所有分量都严格为正，即 $\\mathbf{s}  0$。\n\n裂变源迭代算法是求解这个主特征对 $(k, \\mathbf{s})$ 的一种数值方法。它是一个迭代过程，从一个初始猜测 $\\mathbf{s}^{(0)}$ 和一个初始特征值估计 $k^{(0)}$ 开始。对于迭代 $m = 0, 1, 2, \\dots$：\n\n1.  **源传播**：通过将算子 $\\mathbf{H}$ 应用于当前源向量 $\\mathbf{s}^{(m)}$，计算出原始的下一代源向量，我将其表示为 $\\mathbf{y'}^{(m)}$：\n    $$\n    \\mathbf{y'}^{(m)} = \\mathbf{H} \\mathbf{s}^{(m)}\n    $$\n\n2.  **正性强制**：对原始向量 $\\mathbf{y'}^{(m)}$ 应用一个可选的正性策略 $\\mathcal{P}$，以生成处理后的向量 $\\mathbf{y}^{(m)}$。这些策略是：\n    -   $\\mathcal{P} = \\text{none}$：$\\mathbf{y}^{(m)} = \\mathbf{y'}^{(m)}$。\n    -   $\\mathcal{P} = \\text{clip\\_zero}$：$y_i^{(m)} = \\max(0, y'_i^{(m)})$。\n    -   $\\mathcal{P} = \\text{abs}$：$y_i^{(m)} = |y'_i^{(m)}|$。\n\n3.  **特征值估计**：使用得到的源向量 $\\mathbf{y}^{(m)}$ 和前一个源向量 $\\mathbf{s}^{(m)}$ 的 $\\ell_1$-范数之比来估计下一步的特征值 $k^{(m+1)}$：\n    $$\n    k^{(m+1)} = \\frac{\\|\\mathbf{y}^{(m)}\\|_1}{\\|\\mathbf{s}^{(m)}\\|_1}\n    $$\n    其中 $\\|\\mathbf{v}\\|_1 = \\sum_i |v_i|$。如果 $\\|\\mathbf{s}^{(m)}\\|_1 = 0$，需要特殊处理，在这种情况下，将 $k^{(m+1)}$ 设为默认值 $1.0$ 是一个合理的选择，因为这只在初始向量为零时发生。\n\n4.  **源归一化**：为下一次迭代，将源向量重新归一化，使其 $\\ell_1$-范数为单位1。这一步对于数值稳定性至关重要。\n    $$\n    \\mathbf{s}^{(m+1)} = \\frac{\\mathbf{y}^{(m)}}{\\|\\mathbf{y}^{(m)}\\|_1}\n    $$\n    如果 $\\mathbf{y}^{(m)}$ 是一个零向量，其范数为 $0$，会导致除零错误。在这种特定情况下，根据问题要求，在归一化之前，向量 $\\mathbf{y}^{(m)}$ 必须被一个小的微扰向量替换。使用一个所有分量都等于 $\\varepsilon = 10^{-14}$ 的向量。\n\n迭代持续进行，直到特征值估计的相对变化低于指定的容差 $10^{-10}$，即 $|k^{(m+1)} - k^{(m)}| / \\max(k^{(m)}, 1)  10^{-10}$，或者直到达到最大迭代次数 $5000$ 次。\n\n在整个过程中，必须使用一个布尔标志来追踪任何原始传播向量 $\\mathbf{y'}^{(m)}$ 在任何时刻是否包含负值项。这一点很重要，因为尽管物理上的裂变源必须是非负的，但中间的数值估计，特别是当初始猜测 $\\mathbf{s}^{(0)}$ 包含正负值时，可能会包含负值。\n\n实现将针对四个指定的测试用例遵循此算法，将矩阵运算与正性策略、收敛检查和零向量边缘情况处理的逻辑相结合。最终收敛的特征值 $k$ 将四舍五入到 $8$ 位小数。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the fission source iteration to find the k-eigenvalue\n    for a given matrix H and a set of test cases.\n    \"\"\"\n    H = np.array([\n        [0.35, 0.20, 0.30, 0.10],\n        [0.20, 0.40, 0.10, 0.15],\n        [0.25, 0.15, 0.45, 0.20],\n        [0.10, 0.15, 0.15, 0.50]\n    ], dtype=float)\n\n    test_cases = [\n        ([0.25, 0.25, 0.25, 0.25], 'none'),\n        ([1.0, -0.5, 0.3, -0.8], 'none'),\n        ([1.0, -0.5, 0.3, -0.8], 'clip_zero'),\n        ([0.0, 0.0, 0.0, 0.0], 'clip_zero'),\n    ]\n\n    results = []\n    max_iter = 5000\n    tol = 1.0e-10\n    eps = 1.0e-14\n\n    for s0_list, policy in test_cases:\n        s = np.array(s0_list, dtype=float)\n        k_old = 1.0\n        neg_flag = False\n        k_new = 0.0\n\n        for m in range(max_iter):\n            s_norm = np.linalg.norm(s, 1)\n\n            # Step 1: Source Propagation\n            y_raw = H @ s\n\n            # Step 2: Negative Entry Detection\n            if np.any(y_raw  0):\n                neg_flag = True\n\n            # Step 3: Positivity Enforcement\n            if policy == 'clip_zero':\n                y = np.maximum(0, y_raw)\n            elif policy == 'abs':\n                y = np.abs(y_raw)\n            else:  # 'none'\n                y = y_raw\n\n            y_norm = np.linalg.norm(y, 1)\n\n            # Step 4: Eigenvalue Estimation\n            if s_norm > 0:\n                k_new = y_norm / s_norm\n            else:\n                # This case only happens for a zero initial vector s0.\n                # k is undefined, so we use a default value for the first step.\n                k_new = 1.0\n\n            # Step 5: Convergence Check\n            # We start checking from the second iteration (m > 0).\n            if m > 0:\n                if abs(k_new - k_old) / max(k_old, 1.0)  tol:\n                    break\n            \n            # Step 6: Source Renormalization (prepare for next iteration)\n            if y_norm == 0:\n                # Avoid division by zero by using a perturbation vector.\n                y = np.full(s.shape, eps, dtype=float)\n                y_norm = np.linalg.norm(y, 1)\n            \n            s = y / y_norm\n            k_old = k_new\n        \n        # If loop finished due to max_iter, k_new holds the last value.\n        final_k = k_new\n        results.append(f\"[{round(final_k, 8)},{neg_flag}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后的这个实践将探讨特征值分析在安全与设计研究中至关重要的一项高级应用。您将使用一阶微扰理论来计算 $k$ 特征值对反应堆材料性质变化的灵敏度。该练习 () 需要计算正向通量和伴随通量（中子重要性），展示了如何利用这些强大的概念来高效地预测反应堆的响应，而无需重新进行完整的模拟计算。",
            "id": "4232367",
            "problem": "考虑通过对Boltzmann方程进行粗网格空间和能量投影得到的单能中子输运$k$特征值问题的广义代数表示。在裂变源迭代法中，基模的不动点形式等价于广义特征问题\n$$\n\\mathbf{F}\\,\\boldsymbol{\\phi} \\;=\\; k\\,\\mathbf{L}\\,\\boldsymbol{\\phi}\n$$\n, 其中，$\\mathbf{L}$是损失算子（流出、吸收和外散射），$\\mathbf{F}$是裂变产生算子，$\\boldsymbol{\\phi}$是正向通量/源状态向量，$k$是有效增殖因子。伴随系统定义为\n$$\n\\mathbf{F}^{\\dagger}\\,\\boldsymbol{\\phi}^{\\dagger} \\;=\\; k\\,\\mathbf{L}^{\\dagger}\\,\\boldsymbol{\\phi}^{\\dagger}\n$$\n, 对于伴随通量/源状态向量$\\boldsymbol{\\phi}^{\\dagger}$和伴随算子$\\mathbf{L}^{\\dagger}$和$\\mathbf{F}^{\\dagger}$。\n\n假设一个两区粗网格模型具有\n$$\n\\mathbf{L} \\;=\\; \\begin{pmatrix}\n0.8  -0.1 \\\\\n-0.05  0.6\n\\end{pmatrix},\n\\qquad\n\\mathbf{F} \\;=\\; \\begin{pmatrix}\n0.7  0 \\\\\n0  0.1\n\\end{pmatrix},\n$$\n所有量都用一致的单位表示，使得$k$是无量纲的。考虑对第一区域的吸收施加一个小的微扰$p$，该微扰仅改变$\\mathbf{L}$的$(1,1)$元：\n$$\n\\mathbf{L}(p) \\;=\\; \\begin{pmatrix}\n0.8 + p  -0.1 \\\\\n-0.05  0.6\n\\end{pmatrix},\n\\qquad\n\\mathbf{F}(p) \\;=\\; \\mathbf{F}.\n$$\n\n从正向和伴随广义特征问题的基本定义以及适用于中子重要性的内积加权（即伴随加权双线性形式）出发，推导在$p=0$时导数$\\frac{dk}{dp}$的一阶微扰表达式。然后，通过计算基模及其伴随并执行所需的双线性形式，对给定的$\\mathbf{L}$和$\\mathbf{F}$进行数值计算。将您的最终数值答案四舍五入到四位有效数字。将最终答案表示为一个纯数（无量纲）。",
            "solution": "该问题要求推导和计算一个广义特征问题的特征值$k$的一阶微扰表达式。\n\n首先，我们推导导数$\\frac{dk}{dp}$的通用公式。受微扰的正向特征问题由下式给出\n$$\n\\mathbf{F}(p)\\,\\boldsymbol{\\phi}(p) \\;=\\; k(p)\\,\\mathbf{L}(p)\\,\\boldsymbol{\\phi}(p)\n$$\n我们将所有受微扰的量在$p=0$附近展开为微扰参数$p$的一阶泰勒级数：\n$$\n\\begin{aligned}\n\\mathbf{L}(p) \\;=\\; \\mathbf{L}_0 + p\\,\\mathbf{L}_1 + \\mathcal{O}(p^2) \\\\\n\\mathbf{F}(p) \\;=\\; \\mathbf{F}_0 + p\\,\\mathbf{F}_1 + \\mathcal{O}(p^2) \\\\\n\\boldsymbol{\\phi}(p) \\;=\\; \\boldsymbol{\\phi}_0 + p\\,\\boldsymbol{\\phi}_1 + \\mathcal{O}(p^2) \\\\\nk(p) \\;=\\; k_0 + p\\,k_1 + \\mathcal{O}(p^2)\n\\end{aligned}\n$$\n其中$\\mathbf{L}_0 = \\mathbf{L}(0)$、$\\mathbf{F}_0 = \\mathbf{F}(0)$、$\\boldsymbol{\\phi}_0 = \\boldsymbol{\\phi}(0)$和$k_0 = k(0)$是未受微扰的量。一阶系数是在$p=0$处求值的导数，例如$k_1 = \\left.\\frac{dk}{dp}\\right|_{p=0}$。\n\n将这些展开式代入特征问题，并收集$p$的同阶项：\n$p^0$阶：\n$$\n\\mathbf{F}_0\\,\\boldsymbol{\\phi}_0 \\;=\\; k_0\\,\\mathbf{L}_0\\,\\boldsymbol{\\phi}_0\n$$\n这是未受微扰的正向特征问题。\n\n$p^1$阶：\n$$\n\\mathbf{F}_0\\,\\boldsymbol{\\phi}_1 + \\mathbf{F}_1\\,\\boldsymbol{\\phi}_0 \\;=\\; k_0\\,\\mathbf{L}_0\\,\\boldsymbol{\\phi}_1 + k_0\\,\\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 + k_1\\,\\mathbf{L}_0\\,\\boldsymbol{\\phi}_0\n$$\n为了分离出$k_1$，我们将该方程与未受微扰的伴随特征向量$\\boldsymbol{\\phi}_0^{\\dagger}$作内积。内积定义为伴随加权双线性形式$\\langle \\mathbf{u}, \\mathbf{v} \\rangle = \\mathbf{u}^{\\dagger T} \\mathbf{v}$。\n$$\n\\boldsymbol{\\phi}_0^{\\dagger T} (\\mathbf{F}_0\\,\\boldsymbol{\\phi}_1) + \\boldsymbol{\\phi}_0^{\\dagger T} (\\mathbf{F}_1\\,\\boldsymbol{\\phi}_0) \\;=\\; k_0\\,\\boldsymbol{\\phi}_0^{\\dagger T}(\\mathbf{L}_0\\,\\boldsymbol{\\phi}_1) + k_0\\,\\boldsymbol{\\phi}_0^{\\dagger T}(\\mathbf{L}_1\\,\\boldsymbol{\\phi}_0) + k_1\\,\\boldsymbol{\\phi}_0^{\\dagger T}(\\mathbf{L}_0\\,\\boldsymbol{\\phi}_0)\n$$\n利用伴随算子的性质$\\mathbf{u}^{\\dagger T}(\\mathbf{A}\\mathbf{v}) = (\\mathbf{A}^{\\dagger}\\mathbf{u})^{\\dagger T}\\mathbf{v}$，我们可以重写等式两边的第一项：\n$$\n(\\mathbf{F}_0^{\\dagger}\\boldsymbol{\\phi}_0^{\\dagger})^{\\dagger T}\\,\\boldsymbol{\\phi}_1 + \\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{F}_1\\,\\boldsymbol{\\phi}_0 \\rangle \\;=\\; k_0\\,(\\mathbf{L}_0^{\\dagger}\\boldsymbol{\\phi}_0^{\\dagger})^{\\dagger T}\\,\\boldsymbol{\\phi}_1 + k_0\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 \\rangle + k_1\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle\n$$\n未受微扰的伴随特征问题是$\\mathbf{F}_0^{\\dagger}\\,\\boldsymbol{\\phi}_0^{\\dagger} = k_0\\,\\mathbf{L}_0^{\\dagger}\\,\\boldsymbol{\\phi}_0^{\\dagger}$。将其代入左边：\n$$\n(k_0\\,\\mathbf{L}_0^{\\dagger}\\,\\boldsymbol{\\phi}_0^{\\dagger})^{\\dagger T}\\,\\boldsymbol{\\phi}_1 + \\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{F}_1\\,\\boldsymbol{\\phi}_0 \\rangle \\;=\\; k_0\\,(\\mathbf{L}_0^{\\dagger}\\boldsymbol{\\phi}_0^{\\dagger})^{\\dagger T}\\,\\boldsymbol{\\phi}_1 + k_0\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 \\rangle + k_1\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle\n$$\n左边的第一项与右边的第一项相消。我们得到：\n$$\n\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{F}_1\\,\\boldsymbol{\\phi}_0 \\rangle \\;=\\; k_0\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 \\rangle + k_1\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle\n$$\n求解$k_1 = \\frac{dk}{dp}|_{p=0}$得到所需的表达式：\n$$\n\\frac{dk}{dp}\\bigg|_{p=0} \\;=\\; \\frac{\\langle \\boldsymbol{\\phi}_0^{\\dagger}, (\\mathbf{F}_1 - k_0\\,\\mathbf{L}_1)\\,\\boldsymbol{\\phi}_0 \\rangle}{\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle}\n$$\n现在我们将此公式应用于给定的问题。未受微扰的算子是：\n$$\n\\mathbf{L}_0 = \\mathbf{L} = \\begin{pmatrix} 0.8  -0.1 \\\\ -0.05  0.6 \\end{pmatrix}, \\qquad \\mathbf{F}_0 = \\mathbf{F} = \\begin{pmatrix} 0.7  0 \\\\ 0  0.1 \\end{pmatrix}\n$$\n微扰仅施加于$\\mathbf{L}$，因此$\\mathbf{F}(p) = \\mathbf{F}$是常数，这意味着$\\mathbf{F}_1 = \\frac{d\\mathbf{F}}{dp} = \\mathbf{0}$。对$\\mathbf{L}$的微扰是$\\mathbf{L}(p) = \\mathbf{L}_0 + p\\,\\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix}$，所以$\\mathbf{L}_1 = \\frac{d\\mathbf{L}}{dp} = \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix}$。\n对于这个特定情况，公式简化为：\n$$\n\\frac{dk}{dp}\\bigg|_{p=0} \\;=\\; \\frac{-k_0\\,\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 \\rangle}{\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle}\n$$\n我们需要找到未受微扰的基模特征值$k_0$以及相应的正向特征向量$\\boldsymbol{\\phi}_0$和伴随特征向量$\\boldsymbol{\\phi}_0^{\\dagger}$。\n\n未受微扰的特征值$k_0$通过求解$\\det(\\mathbf{F}_0 - k_0 \\mathbf{L}_0) = 0$得到。\n$$\n\\det\\left( \\begin{pmatrix} 0.7  0 \\\\ 0  0.1 \\end{pmatrix} - k_0 \\begin{pmatrix} 0.8  -0.1 \\\\ -0.05  0.6 \\end{pmatrix} \\right) \\;=\\; \\det\\begin{pmatrix} 0.7 - 0.8k_0  0.1k_0 \\\\ 0.05k_0  0.1 - 0.6k_0 \\end{pmatrix} \\;=\\; 0\n$$\n$$\n(0.7 - 0.8k_0)(0.1 - 0.6k_0) - (0.1k_0)(0.05k_0) \\;=\\; 0\n$$\n$$\n0.07 - 0.5k_0 + 0.48k_0^2 - 0.005k_0^2 \\;=\\; 0\n$$\n$$\n0.475k_0^2 - 0.5k_0 + 0.07 \\;=\\; 0\n$$\n使用二次方程求根公式，$k_0 = \\frac{0.5 \\pm \\sqrt{(-0.5)^2 - 4(0.475)(0.07)}}{2(0.475)} = \\frac{0.5 \\pm \\sqrt{0.25 - 0.133}}{0.95} = \\frac{0.5 \\pm \\sqrt{0.117}}{0.95}$。\n基模对应于最大的正特征值：\n$$\nk_0 = \\frac{0.5 + \\sqrt{0.117}}{0.95} \\approx 0.886371186\n$$\n正向特征向量$\\boldsymbol{\\phi}_0 = (\\phi_1, \\phi_2)^T$由$(\\mathbf{F}_0 - k_0 \\mathbf{L}_0)\\boldsymbol{\\phi}_0 = \\mathbf{0}$求得。从第一行可得：$(0.7 - 0.8k_0)\\phi_1 + (0.1k_0)\\phi_2 = 0$。以$\\phi_1=1$进行归一化：\n$$\n\\phi_2 = -\\frac{0.7 - 0.8k_0}{0.1k_0} = \\frac{8k_0 - 7}{k_0} \\approx 0.10263158\n$$\n所以，$\\boldsymbol{\\phi}_0 \\approx (1, 0.10263158)^T$。\n\n伴随特征向量$\\boldsymbol{\\phi}_0^{\\dagger} = (\\phi_1^{\\dagger}, \\phi_2^{\\dagger})^T$由$(\\mathbf{F}_0^{\\dagger} - k_0 \\mathbf{L}_0^{\\dagger})\\boldsymbol{\\phi}_0^{\\dagger} = \\mathbf{0}$求得。由于矩阵是实数矩阵，$\\dagger$表示转置。\n$$\n\\left( \\begin{pmatrix} 0.7  0 \\\\ 0  0.1 \\end{pmatrix} - k_0 \\begin{pmatrix} 0.8  -0.05 \\\\ -0.1  0.6 \\end{pmatrix} \\right) \\boldsymbol{\\phi}_0^{\\dagger} = \\begin{pmatrix} 0.7 - 0.8k_0  0.05k_0 \\\\ 0.1k_0  0.1 - 0.6k_0 \\end{pmatrix} \\boldsymbol{\\phi}_0^{\\dagger} = \\mathbf{0}\n$$\n从第一行可得，$(0.7 - 0.8k_0)\\phi_1^{\\dagger} + (0.05k_0)\\phi_2^{\\dagger} = 0$。以$\\phi_1^{\\dagger}=1$进行归一化：\n$$\n\\phi_2^{\\dagger} = -\\frac{0.7 - 0.8k_0}{0.05k_0} = \\frac{8k_0 - 7}{0.5k_0} \\approx 0.20526316\n$$\n所以，$\\boldsymbol{\\phi}_0^{\\dagger} \\approx (1, 0.20526316)^T$。\n\n现在我们计算内积。\n分子项：$\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_1\\,\\boldsymbol{\\phi}_0 \\rangle = \\boldsymbol{\\phi}_0^{\\dagger T} \\mathbf{L}_1 \\boldsymbol{\\phi}_0$\n$$\n\\begin{pmatrix} 1  \\phi_2^{\\dagger} \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\phi_2 \\end{pmatrix} = \\begin{pmatrix} 1  \\phi_2^{\\dagger} \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = 1\n$$\n分母项：$\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle = \\boldsymbol{\\phi}_0^{\\dagger T} \\mathbf{L}_0 \\boldsymbol{\\phi}_0$。我们可以使用恒等式$\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0 \\boldsymbol{\\phi}_0 \\rangle = \\frac{1}{k_0}\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{F}_0 \\boldsymbol{\\phi}_0 \\rangle$。\n$$\n\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{F}_0 \\boldsymbol{\\phi}_0 \\rangle = \\begin{pmatrix} 1  \\phi_2^{\\dagger} \\end{pmatrix} \\begin{pmatrix} 0.7  0 \\\\ 0  0.1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ \\phi_2 \\end{pmatrix} = 0.7(1)(1) + 0.1\\phi_2^{\\dagger}\\phi_2\n$$\n$$\n\\approx 0.7 + 0.1(0.20526316)(0.10263158) \\approx 0.7 + 0.002106648 = 0.702106648\n$$\n所以，分母是$\\frac{1}{k_0}(0.702106648) \\approx \\frac{0.702106648}{0.886371186} \\approx 0.792113158$。\n\n最后，我们计算导数：\n$$\n\\frac{dk}{dp}\\bigg|_{p=0} = \\frac{-k_0 \\times 1}{\\langle \\boldsymbol{\\phi}_0^{\\dagger}, \\mathbf{L}_0\\,\\boldsymbol{\\phi}_0 \\rangle} \\approx \\frac{-0.886371186}{0.792113158} \\approx -1.119000\n$$\n四舍五入到四位有效数字，结果为$-1.119$。",
            "answer": "$$\n\\boxed{-1.119}\n$$"
        }
    ]
}