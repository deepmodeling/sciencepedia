{
    "hands_on_practices": [
        {
            "introduction": "为了真正理解一种方差减小技术的威力，最好的方法是将其性能与传统的模拟方法进行直接比较。本练习将引导你从第一性原理出发，为一个简单的俘获率估计量分别推导模拟吸收（analog absorption）和隐式俘获（survival biasing）两种方案下的方差。通过这个过程，你将揭示隐式俘获在理想化模型中近乎完美的方差减小效益。",
            "id": "4231607",
            "problem": "考虑一个无限、均匀、非增殖介质，其宏观俘获截面为 $\\Sigma_{c} > 0$，宏观散射截面为 $\\Sigma_{s} \\ge 0$，因此宏观总截面为 $\\Sigma_{t} = \\Sigma_{c} + \\Sigma_{s}$。一个中子历史以权重 $1$ 从原点开始，经历一系列的自由飞行和碰撞。自由飞行路径长度服从参数为 $\\Sigma_{t}$ 的指数分布，这反映了蒙特卡洛（MC）粒子输运中的标准相互作用定律。在每次碰撞时，一个模拟历史对反应结果进行抽样：以概率 $p = \\Sigma_{c}/\\Sigma_{t}$ 发生俘获，或以概率 $q = \\Sigma_{s}/\\Sigma_{t}$ 发生散射，且与之前的所有事件独立。相比之下，一个生存偏倚（隐式俘获）历史强制每次碰撞都是散射，同时在每次碰撞时将粒子权重乘以生存因子 $q$。假设散射是各向同性的，没有边界（无限介质），也没有泄漏或裂变。\n\n定义每个源历史的俘获率的碰撞估计量如下：在每次碰撞 $i$ 时，记录得分 $w_{i-1}\\,p$，其中 $w_{i-1}$ 是第 $i$ 次碰撞前的粒子权重。对于模拟吸收，在历史因第一次抽样到俘获而终止之前，$w_{i-1} = 1$；对于生存偏倚（隐式俘获），$w_{i-1} = q^{i-1}$ 且历史无限继续。\n\n仅从指数自由飞行定律和碰撞时反应结果的伯努利选择出发，从第一性原理推导以下两种情况中每个历史的俘获率的碰撞估计量的方差：\n- 模拟吸收，和\n- 生存偏倚（隐式俘获）。\n\n将您的最终答案表示为仅含 $\\Sigma_{c}$ 和 $\\Sigma_{s}$ 的闭式函数。按 $\\left(\\text{隐式},\\,\\text{模拟}\\right)$ 的顺序列出这两个方差，作为一个单行矩阵。最终方框内的答案无需数值四舍五入，也无需报告物理单位。",
            "solution": "该问题要求计算在无限均匀介质中，对于两种不同的蒙特卡洛方案：生存偏倚（隐式俘获）和模拟吸收，每个历史的俘获率的碰撞估计量的方差。代表一个历史总得分的随机变量 $X$ 的方差由 $\\text{Var}(X) = E[X^2] - (E[X])^2$ 给出。我们将对每种情况进行推导。\n\n设 $p = \\frac{\\Sigma_c}{\\Sigma_t}$ 为单次碰撞俘获概率，$q = \\frac{\\Sigma_s}{\\Sigma_t}$ 为单次碰撞生存概率，其中 $\\Sigma_t = \\Sigma_c + \\Sigma_s$。根据定义，$p+q=1$。问题陈述 $\\Sigma_c > 0$，这意味着 $p > 0$ 且 $q  1$。\n\n碰撞估计量在每次碰撞 $i$ 时记录一个值 $w_{i-1}p$，其中 $w_{i-1}$ 是碰撞前的中子权重。一个历史的总得分 $X$ 是该历史中发生的所有碰撞的这些得分之和。\n\n**1. 生存偏倚（隐式俘获）**\n\n在此方案中，每次碰撞都被强制为散射。历史永不终止。每次碰撞时都会调整粒子的权重，以考虑俘获的概率。初始权重为 $w_0 = 1$。第一次碰撞（强制散射）后，新权重为 $w_1 = w_0 q = q$。第二次碰撞后，权重为 $w_2 = w_1 q = q^2$。通常，第 $i$ 次碰撞前的权重为 $w_{i-1} = q^{i-1}$。\n\n第 $i$ 次碰撞贡献的得分为 $w_{i-1}p = q^{i-1}p$。由于历史是无限的，任何给定历史的总得分 $X_{\\text{implicit}}$ 是所有碰撞得分的总和：\n$$X_{\\text{implicit}} = \\sum_{i=1}^{\\infty} w_{i-1}p = \\sum_{i=1}^{\\infty} q^{i-1}p$$\n这是一个确定性量，而不是一个随机变量，因为就其权重乘数序列而言，每个历史都是相同的。这个和是一个几何级数：\n$$X_{\\text{implicit}} = p \\sum_{i=1}^{\\infty} q^{i-1} = p \\sum_{j=0}^{\\infty} q^j$$\n由于 $\\Sigma_c  0$，我们有 $q = \\Sigma_s / (\\Sigma_c + \\Sigma_s)  1$。因此，该几何级数收敛于 $\\frac{1}{1-q}$。\n$$X_{\\text{implicit}} = p \\left(\\frac{1}{1-q}\\right)$$\n使用恒等式 $p = 1-q$，我们发现：\n$$X_{\\text{implicit}} = p \\left(\\frac{1}{p}\\right) = 1$$\n每个历史的得分恰好为 $1$。对于一个常数随机变量 $C$，其方差为 $\\text{Var}(C) = E[(C - E[C])^2] = E[(C-C)^2] = 0$。因此，隐式俘获估计量的方差是：\n$$\\text{Var}(X_{\\text{implicit}}) = 0$$\n\n**2. 模拟吸收**\n\n在此方案中，粒子在整个历史中的权重保持为 $w_i = 1$。在每次碰撞时，对结果进行抽样：以概率 $p$ 发生俘获，或以概率 $q$ 发生散射。历史在第一次抽样到俘获事件时终止。\n\n设 $N$ 是表示历史终止时碰撞次数的随机变量。前 $k-1$ 次碰撞是散射且第 $k$ 次碰撞是俘获的概率由几何概率质量函数给出：\n$$P(N=k) = q^{k-1}p, \\quad \\text{for } k = 1, 2, 3, \\ldots$$\n对于在第 $k$ 次碰撞时终止的历史，总共发生了 $k$ 次碰撞。在每次碰撞前，权重为 $w_{i-1} = 1$。每次碰撞 $i \\in \\{1, \\ldots, k\\}$ 的得分贡献为 $w_{i-1}p = 1 \\cdot p = p$。\n长度为 $k$ 的历史的总得分，我们记为 $X_k$，是这 $k$ 次碰撞的得分之和：\n$$X_k = \\sum_{i=1}^{k} p = kp$$\n由于历史长度 $k$ 是一个随机变量，总得分 $X_{\\text{analog}}$ 是一个随机变量，它以概率 $q^{k-1}p$ 取值 $kp$。\n\n首先，我们计算得分的期望值 $E[X_{\\text{analog}}]$。\n$$E[X_{\\text{analog}}] = \\sum_{k=1}^{\\infty} X_k P(N=k) = \\sum_{k=1}^{\\infty} (kp)(q^{k-1}p) = p^2 \\sum_{k=1}^{\\infty} k q^{k-1}$$\n该求和是几何级数公式 $\\sum_{k=0}^{\\infty} q^k = (1-q)^{-1}$ 的导数：\n$$\\sum_{k=1}^{\\infty} k q^{k-1} = \\frac{d}{dq} \\sum_{k=0}^{\\infty} q^k = \\frac{d}{dq}(1-q)^{-1} = (-1)(1-q)^{-2}(-1) = \\frac{1}{(1-q)^2}$$\n将此代回，并使用 $1-q=p$：\n$$E[X_{\\text{analog}}] = p^2 \\left(\\frac{1}{(1-q)^2}\\right) = p^2 \\left(\\frac{1}{p^2}\\right) = 1$$\n这个结果证实了该估计量是无偏的，因为每个源历史的期望俘获率被正确地计算为 $1$。\n\n接下来，我们计算二阶矩 $E[X_{\\text{analog}}^2]$。\n$$E[X_{\\text{analog}}^2] = \\sum_{k=1}^{\\infty} X_k^2 P(N=k) = \\sum_{k=1}^{\\infty} (kp)^2(q^{k-1}p) = p^3 \\sum_{k=1}^{\\infty} k^2 q^{k-1}$$\n为了计算和 $\\sum k^2 q^{k-1}$，我们可以对恒等式 $\\sum_{k=1}^{\\infty} k q^{k-1} = (1-q)^{-2}$ 求导。两边乘以 $q$ 得到 $\\sum_{k=1}^{\\infty} k q^k = q(1-q)^{-2}$。对 $q$ 求导：\n$$\\sum_{k=1}^{\\infty} k^2 q^{k-1} = \\frac{d}{dq} \\left[q(1-q)^{-2}\\right] = (1)(1-q)^{-2} + q(-2)(1-q)^{-3}(-1) = \\frac{1}{(1-q)^2} + \\frac{2q}{(1-q)^3}$$\n$$= \\frac{1-q+2q}{(1-q)^3} = \\frac{1+q}{(1-q)^3}$$\n将此结果代入二阶矩的表达式中：\n$$E[X_{\\text{analog}}^2] = p^3 \\left(\\frac{1+q}{(1-q)^3}\\right) = p^3 \\left(\\frac{1+q}{p^3}\\right) = 1+q$$\n最后，我们计算方差：\n$$\\text{Var}(X_{\\text{analog}}) = E[X_{\\text{analog}}^2] - (E[X_{\\text{analog}}])^2 = (1+q) - (1)^2 = q$$\n\n模拟估计量的方差为 $q$。用给定的截面表示：\n$$\\text{Var}(X_{\\text{analog}}) = q = \\frac{\\Sigma_s}{\\Sigma_t} = \\frac{\\Sigma_s}{\\Sigma_c + \\Sigma_s}$$\n\n**结果总结**\n\n两种方法的方差为：\n-   生存偏倚（隐式俘获）的方差：$\\text{Var}(X_{\\text{implicit}}) = 0$。\n-   模拟吸收的方差：$\\text{Var}(X_{\\text{analog}}) = q = \\frac{\\Sigma_s}{\\Sigma_c + \\Sigma_s}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  \\frac{\\Sigma_s}{\\Sigma_c + \\Sigma_s}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然隐式俘获能够避免粒子历史过早终止，但它会产生大量低权重粒子，持续追踪这些粒子将耗费巨大的计算资源。本练习将探讨解决此问题的标准方法——俄罗斯轮盘赌（Russian Roulette），并让你亲手推导和量化该方法自身引入的方差。这个实践揭示了在蒙特卡洛模拟中一个核心的权衡：计算效率与统计噪声之间的平衡。",
            "id": "4231626",
            "problem": "在用于核反应堆模拟的蒙特卡洛（MC）中子输运中，隐式俘获通常被用作一种方差减小（VR）技术：每次碰撞都被视为散射，粒子权重乘以散射存活概率（散射宏观截面与总宏观截面之比），从而使权重在没有显式吸收的情况下确定性地减小。为了防止在重复的隐式俘获后低权重粒子的大量增殖，应用了俄罗斯轮盘赌存活偏倚。在一个广泛使用的方案中，一个入射权重为 $w$ 的粒子会经历一次存活概率为 $p$ 的存活试验，其轮盘赌后权重 $w'$ 定义为：以 $1 - p$ 的概率为 $w' = 0$，以 $p$ 的概率为 $w' = \\frac{w}{p}$。该方案的设计目的是在存活偏倚下保持期望权重不变，以维持无偏的统计量。\n\n从期望值 $\\mathbb{E}[X]$ 和方差 $\\mathrm{Var}(X) = \\mathbb{E}[X^{2}] - \\left(\\mathbb{E}[X]\\right)^{2}$ 的定义出发，推导 $\\mathrm{Var}(w')$ 作为存活概率 $p$ 和入射权重 $w$ 的函数的闭式表达式。然后，基于与粒子权重成正比的线性统计量的第一性原理，解释当俄罗斯轮盘赌与隐式俘获结合使用时，$\\mathrm{Var}(w')$ 对 $p$ 的依赖性如何定性地影响统计量方差。\n\n将 $\\mathrm{Var}(w')$ 的最终表达式以完全简化的精确符号形式表示。不需要数值舍入，也不涉及物理单位。",
            "solution": "问题陈述科学上合理、提法恰当且客观。它准确描述了隐式俘获和俄罗斯轮盘赌的原理，这两种方法是蒙特卡洛中子输运模拟中标准的方差减小技术。所有必要的定义和变量都已提供，足以执行所要求的推导和分析。因此，该问题被认为是有效的。\n\n任务是推導轮盘赌后粒子权重方差 $\\mathrm{Var}(w')$ 的闭式表达式，并解释其对统计量方差的影响。设 $w$ 为入射粒子权重，$p$ 为俄罗斯轮盘赌博弈中的存活概率。轮盘赌后权重 $w'$ 是一个离散随机变量。其值以概率 $p$ 为 $\\frac{w}{p}$，以概率 $1-p$ 为 $0$。\n\n随机变量 $X$ 的方差定义为 $\\mathrm{Var}(X) = \\mathbb{E}[X^{2}] - (\\mathbb{E}[X])^{2}$。我们将首先计算期望值（一阶矩）$\\mathbb{E}[w']$ 和二阶矩 $\\mathbb{E}[(w')^{2}]$。\n\n$w'$ 的期望值是其所有可能值按各自概率加权的和：\n$$\n\\mathbb{E}[w'] = \\left(\\frac{w}{p}\\right) \\cdot p + (0) \\cdot (1-p) = w + 0 = w\n$$\n这证实了俄罗斯轮盘赌方案是无偏的，因为粒子的期望权重是守恒的。\n\n$w'$ 的二阶矩是其平方的期望值：\n$$\n\\mathbb{E}[(w')^{2}] = \\left(\\frac{w}{p}\\right)^{2} \\cdot p + (0)^{2} \\cdot (1-p) = \\frac{w^{2}}{p^{2}} \\cdot p = \\frac{w^{2}}{p}\n$$\n现在，我们可以将这些矩代入方差公式中：\n$$\n\\mathrm{Var}(w') = \\mathbb{E}[(w')^{2}] - (\\mathbb{E}[w'])^{2}\n$$\n$$\n\\mathrm{Var}(w') = \\frac{w^{2}}{p} - w^{2}\n$$\n将 $w^{2}$ 项提取出来，我们得到简化的闭式表达式：\n$$\n\\mathrm{Var}(w') = w^{2} \\left(\\frac{1}{p} - 1\\right) = w^{2} \\left(\\frac{1-p}{p}\\right)\n$$\n这就是推导出的轮盘赌后权重的方差表达式。\n\n接下来，我们分析该方差对模拟统计量的影响。在蒙特卡洛方法中，统计量是物理量的估计量，对于线性统计量，粒子贡献的得分与其权重成正比。统计量的总方差是粒子历史中所有随机事件产生的方差的集合。俄罗斯轮盘赌博弈就是这样一个随机事件，它引入了大小为 $\\mathrm{Var}(w')$ 的方差。\n\n推导出的表达式 $\\mathrm{Var}(w') = w^{2} \\frac{1-p}{p}$ 表明，方差是存活概率 $p$ 的函数。鉴于 $p \\in (0, 1]$，对此函数的分析揭示了其行为。$\\frac{1-p}{p}$ 项是 $p$ 的单调递减函数。\n- 当存活概率 $p$ 趋近于 $1$ 时，方差 $\\mathrm{Var}(w')$ 趋近于 $0$。$p=1$ 的值对应于一个确定性博弈，其中粒子总是存活，其权重不变（$w' = w/1 = w$），因此没有增加方差。\n- 当存活概率 $p$ 趋近于 $0$ 时，方差 $\\mathrm{Var}(w')$ 趋近于无穷大。一个非常小的 $p$ 代表一个有很高终止概率（结果为 $0$）和很低存活概率的博弈，但如果粒子存活，其权重将变得极大（$\\frac{w}{p}$）。这种可能结果的巨大差异导致了巨大的方差。\n\n这种关系对模拟的效率至关重要。俄罗斯轮盘赌通过终止低重要性（低权重）的粒子来管理计算资源。然而，存活概率 $p$ 的选择涉及一种权衡。使用一个非常小的 $p$ 会积极地剔除粒子，这可以减少每个粒子历史的计算时间。但是，正如推导所示，一个小的 $p$ 会引入巨大的方差。方差的增加会降低统计量的统计质量，这意味着需要更多的粒子历史才能达到期望的精度水平。蒙特卡洛模拟的总效率通常用一个品质因子（FOM）来衡量，它与方差和计算时间的乘积成反比。由激进的俄罗斯轮盘赌策略引入的过大方差会降低品质因子，使模拟效率降低。因此，必须仔细选择参数 $p$，以平衡粒子数控制的需求与引入统计噪声之间的关系。",
            "answer": "$$\n\\boxed{w^{2} \\frac{1-p}{p}}\n$$"
        },
        {
            "introduction": "隐式俘获的有效性不仅是经验性的，其背后有坚实的统计学原理支撑。本练习将隐式俘获置于更普适的统计框架下进行分析，你将运用全方差公式（Law of Total Variance）来形式化地证明其方差减小特性。通过在一个简化的 k-特征值问题中量化这种方差减益，你将把隐式俘获与更强大的条件蒙特卡洛（Conditional Monte Carlo）方法联系起来，从而深化理解。",
            "id": "4231631",
            "problem": "考虑一个厚度为 $d$ 厘米的高吸收一维材料平板，其中一个单能中子源均匀分布在入射面上，中子沿垂直于该面的直线传播。假设平板内部的散射可忽略不计，因此平板中唯一的相互作用是吸收，其特征为一个恒定的宏观吸收截面 $\\Sigma_a$（单位为 $\\text{cm}^{-1}$）。在平板的远端面有一个薄的裂变产生层，当中子到达时，每个入射中子会确定性地产生 $\\nu$ 个裂变中子。这个简化系统的中子增殖因子（在 k-特征值问题中通常表示为 $k$）可以通过每个源中子产生的预期裂变中子数来逐代估计；该估计值是无量纲的。\n\n目标是在蒙特卡洛（MC）中子输运的背景下，证明隐式俘获（也称为存活偏倚）能够减少高吸收区域中 k-特征值估计量的方差。隐式俘获通过带有衰减统计权重的续迹代替在吸收时中止粒子历史，从而维持那些否则会过早终止的粒子历史。\n\n请基于基本定律和核心定义进行推导：\n- 指数衰减的比尔-朗伯定律，该定律指出，在纯吸收介质中沿长度为 $L$ 的直线路径的存活概率为 $p(L) = e^{-\\Sigma_a L}$。\n- 方差 $\\operatorname{Var}[\\cdot]$ 的定义和全方差公式：对于随机变量 $X$ 和 sigma-代数 $\\mathcal{G}$，恒等式 $\\operatorname{Var}(X) = \\mathbb{E}[\\operatorname{Var}(X \\mid \\mathcal{G})] + \\operatorname{Var}(\\mathbb{E}[X \\mid \\mathcal{G}])$ 成立。\n\n为位于入射面上均匀分布的随机起始位置的源中子，定义两个 k-特征值估计的单粒子贡献估计量：\n1. 模拟估计量：设 $Y$ 为模拟 MC 方案下的单粒子裂变产额，其中中子要么到达裂变产生层并产生 $\\nu$ 个裂变中子，要么在平板中被吸收而产生 $0$ 个。以从起始位置到裂变层的随机径迹长度 $L$ 为条件，$Y \\mid L$ 是一个伯努利随机变量，其成功概率为 $p(L) = e^{-\\Sigma_a L}$，成功时得分为 $\\nu$，因此 $\\mathbb{E}[Y \\mid L] = \\nu p(L)$ 且 $\\operatorname{Var}(Y \\mid L) = \\nu^2 p(L)(1 - p(L))$。\n2. 隐式俘获估计量：设 $Z$ 为存活偏倚下的单粒子裂变产额，其中中子历史被确定性地延续，其衰减后的权重等于到达远端面的存活概率，因此 $Z = \\nu p(L)$。这是 $Y$ 在给定 $L$ 下的条件期望。\n\n任务：\n- 使用全方差公式证明 $\\operatorname{Var}(Z) \\le \\operatorname{Var}(Y)$，且等式仅在 $p(L)$ 为非随机时成立，从而证明隐式俘获带来的方差减少。清晰阐述为什么 $Z = \\mathbb{E}[Y \\mid L]$ 对应于通过衰减权重来续迹，而不是在吸收时终止它们。\n- 将情况特殊化到源位置均匀分布，使得 $L$ 在区间 $[0,d]$ 上均匀分布。推导 $\\mathbb{E}[p(L)]$ 和 $\\mathbb{E}[p(L)^2]$ 的闭式表达式：\n  $$\\mathbb{E}[p(L)] = \\frac{1 - e^{-\\Sigma_a d}}{\\Sigma_a d}, \\quad \\mathbb{E}[p(L)^2] = \\frac{1 - e^{-2 \\Sigma_a d}}{2 \\Sigma_a d}.$$\n  然后推导：\n  $$\\operatorname{Var}(Z) = \\nu^2\\left(\\mathbb{E}[p(L)^2] - \\left(\\mathbb{E}[p(L)]\\right)^2\\right), \\quad \\operatorname{Var}(Y) = \\nu^2 \\mathbb{E}[p(L)]\\left(1 - \\mathbb{E}[p(L)]\\right),$$\n  以及方差减少比\n  $$R = \\frac{\\operatorname{Var}(Y)}{\\operatorname{Var}(Z)} = \\frac{\\mathbb{E}[p(L)]\\left(1 - \\mathbb{E}[p(L)]\\right)}{\\mathbb{E}[p(L)^2] - \\left(\\mathbb{E}[p(L)]\\right)^2}.$$\n  注意，对于所有 $\\Sigma_a  0$ 和 $d  0$，$R \\ge 1$，并量化 $R$ 在高吸收和弱吸收平板极限情况下的行为。\n- 解释为什么以上推导证明了隐式俘获通过将其条件期望替换二元终止结果来减少 k-特征值估计的方差，从而通过权重维持粒子历史而不是终止它们。\n\n您的程序必须计算以下测试套件的方差减少比 $R$，并将结果以浮点数形式输出到单行，格式为方括号内包含逗号分隔的列表：\n- 测试用例 1（一般情况）：$\\Sigma_a = 1.0$ $\\text{cm}^{-1}$，$d = 5.0$ $\\text{cm}$，$\\nu = 2.5$。\n- 测试用例 2（高吸收区域）：$\\Sigma_a = 5.0$ $\\text{cm}^{-1}$，$d = 5.0$ $\\text{cm}$，$\\nu = 2.5$。\n- 测试用例 3（弱吸收区域）：$\\Sigma_a = 0.1$ $\\text{cm}^{-1}$，$d = 5.0$ $\\text{cm}$，$\\nu = 2.5$。\n- 测试用例 4（短平板，高吸收）：$\\Sigma_a = 5.0$ $\\text{cm}^{-1}$，$d = 0.5$ $\\text{cm}$，$\\nu = 2.5$。\n\n所有输出均为无量纲浮点数；输出中不应出现物理单位。您的程序应生成单行输出，其中包含一个列表，格式为“[result1,result2,result3,result4]”。",
            "solution": "问题陈述经评估有效。它提出了一个简化但物理上和数学上合理的模型，用以探讨蒙特卡洛中子输运中通过隐式俘获实现方差减少的概念。该设定是自洽且适定的，源的物理描述中存在一处轻微的模糊之处，但已通过后续对径迹长度分布的精确数学定义得以解决。\n\n解答过程遵循问题中概述的任务进行。\n\n### 第 1 部分：方差减少的证明\n\n我们有两个单粒子裂变产额的估计量：模拟估计量 $Y$ 和隐式俘获估计量 $Z$。中子到达裂变产生层的径迹长度 $L$ 是一个随机变量。\n\n模拟估计量 $Y$ 的定义是，其值以径迹长度 $L$ 为条件时，是一个按裂变产额 $\\nu$ 缩放的伯努利随机变量。一个中子要么以概率 $p(L) = e^{-\\Sigma_a L}$ 存活并走完长度为 $L$ 的路径，产生 $\\nu$ 个裂变中子；要么以概率 $1 - p(L)$ 被吸收，产生 $0$ 个。条件期望和方差由下式给出：\n$$ \\mathbb{E}[Y \\mid L] = \\nu p(L) $$\n$$ \\operatorname{Var}(Y \\mid L) = \\nu^2 p(L)(1 - p(L)) $$\n\n隐式俘获估计量 $Z$ 被定义为当粒子历史总是被延续到裂变层，但其统计权重被存活概率衰减时获得的分数。因此，对于给定的径迹长度 $L$，其分数是确定性的：\n$$ Z = \\nu p(L) $$\n\n通过比较这些定义，我们立即认识到隐式俘获估计量 $Z$ 与模拟估计量 $Y$ 在给定径迹长度 $L$ 下的条件期望相同：\n$$ Z = \\mathbb{E}[Y \\mid L] $$\n这种关系是证明的基础。这种用随机变量的条件期望来替换该随机变量的技术，是一种通用的方差减少方法，称为条件蒙特卡洛。\n\n为了证明 $\\operatorname{Var}(Z) \\le \\operatorname{Var}(Y)$，我们对估计量 $Y$ 应用全方差公式，并以随机变量 $L$ 为条件。该定律表述为：\n$$ \\operatorname{Var}(Y) = \\mathbb{E}[\\operatorname{Var}(Y \\mid L)] + \\operatorname{Var}(\\mathbb{E}[Y \\mid L]) $$\n\n将 $Z$ 和 $\\operatorname{Var}(Y \\mid L)$ 的定义代入此方程，我们得到：\n$$ \\operatorname{Var}(Y) = \\mathbb{E}[\\nu^2 p(L)(1 - p(L))] + \\operatorname{Var}(Z) $$\n\n右边的第一项 $\\mathbb{E}[\\operatorname{Var}(Y \\mid L)]$，代表了源于随机模拟吸收/存活事件的期望方差。我们来分析这一项。存活概率 $p(L) = e^{-\\Sigma_a L}$ 对于任何有限非负路径长度 $L \\ge 0$ 和 $\\Sigma_a \\ge 0$ （假设 $L$ 和 $\\Sigma_a$ 不都为无穷大），满足 $0  p(L) \\le 1$。因此，量 $p(L)(1 - p(L))$ 总是非负的。由于 $\\nu^2$ 也是非负的，条件方差 $\\operatorname{Var}(Y \\mid L) = \\nu^2 p(L)(1 - p(L))$ 是一个非负随机变量。一个非负随机变量的期望必须是非负的：\n$$ \\mathbb{E}[\\operatorname{Var}(Y \\mid L)] \\ge 0 $$\n\n因此，我们已经证明 $\\operatorname{Var}(Y)$ 是 $\\operatorname{Var}(Z)$ 与一个非负项之和：\n$$ \\operatorname{Var}(Y) = \\operatorname{Var}(Z) + \\text{(一个非负量)} $$\n这直接推出了不等式：\n$$ \\operatorname{Var}(Y) \\ge \\operatorname{Var}(Z) $$\n\n等号 $\\operatorname{Var}(Y) = \\operatorname{Var}(Z)$ 成立当且仅当附加项为零：\n$$ \\mathbb{E}[\\operatorname{Var}(Y \\mid L)] = 0 $$\n由于 $\\operatorname{Var}(Y \\mid L)$ 是一个非负随机变量，其期望为零当且仅当该变量本身几乎必然为零。\n$$ \\operatorname{Var}(Y \\mid L) = \\nu^2 p(L)(1 - p(L)) = 0 \\quad (\\text{几乎必然}) $$\n假设 $\\nu \\neq 0$，这要求 $p(L)(1-p(L)) = 0$，意味着 $p(L)$ 的取值必须是 $0$ 或 $1$。如果 $p(L)$ 是非随机的，即为一个常数 $c$，则只有当 $c=0$ 或 $c=1$ 时才满足此条件。非随机的 $p(L)$ 意味着径迹长度 $L$ 是常数或者 $\\Sigma_a=0$。如果 $p(L)$ 是一个非 $0$ 或 $1$ 的常数，等式不成立。因此，问题陈述中等式成立的条件“$p(L)$ 是非随机的”略有不精确，但抓住了核心思想：吸收过程的随机性必须消失，这在存活不可能或必然确定时发生。\n\n### 第 2 部分：均匀径迹长度分布的推导\n\n现在，我们将情况特殊化到径迹长度 $L$ 是一个在区间 $[0, d]$ 上均匀分布的随机变量。其概率密度函数为 $f_L(l) = 1/d$（对于 $l \\in [0, d]$），否则为 $0$。\n\n**$\\mathbb{E}[p(L)]$ 和 $\\mathbb{E}[p(L)^2]$ 的推导**\n\n存活概率 $p(L) = e^{-\\Sigma_a L}$ 的期望值为：\n$$ \\mathbb{E}[p(L)] = \\int_{-\\infty}^{\\infty} p(l) f_L(l) \\, dl = \\int_{0}^{d} e^{-\\Sigma_a l} \\frac{1}{d} \\, dl $$\n$$ \\mathbb{E}[p(L)] = \\frac{1}{d} \\left[ -\\frac{1}{\\Sigma_a} e^{-\\Sigma_a l} \\right]_0^d = \\frac{1}{d} \\left( -\\frac{e^{-\\Sigma_a d}}{\\Sigma_a} - \\left(-\\frac{e^{0}}{\\Sigma_a}\\right) \\right) = \\frac{1 - e^{-\\Sigma_a d}}{\\Sigma_a d} $$\n这证实了第一个表达式。\n\n$p(L)^2 = (e^{-\\Sigma_a L})^2 = e^{-2\\Sigma_a L}$ 的期望值可以类似地求得，即在前一结果中用 $2\\Sigma_a$ 替换 $\\Sigma_a$：\n$$ \\mathbb{E}[p(L)^2] = \\int_{0}^{d} e^{-2\\Sigma_a l} \\frac{1}{d} \\, dl = \\frac{1 - e^{-2\\Sigma_a d}}{2\\Sigma_a d} $$\n这证实了第二个表达式。\n\n**$\\operatorname{Var}(Z)$ 和 $\\operatorname{Var}(Y)$ 的推导**\n\n隐式俘获估计量 $Z = \\nu p(L)$ 的方差为：\n$$ \\operatorname{Var}(Z) = \\operatorname{Var}(\\nu p(L)) = \\nu^2 \\operatorname{Var}(p(L)) $$\n使用标准公式 $\\operatorname{Var}(X) = \\mathbb{E}[X^2] - (\\mathbb{E}[X])^2$，我们有：\n$$ \\operatorname{Var}(Z) = \\nu^2 \\left( \\mathbb{E}[p(L)^2] - (\\mathbb{E}[p(L)])^2 \\right) $$\n这与给定的表达式相匹配。\n\n模拟估计量 $Y$ 的方差可以从其定义推导出来。首先，我们求 $\\mathbb{E}[Y]$ 和 $\\mathbb{E}[Y^2]$。\n根据全期望定律：\n$$ \\mathbb{E}[Y] = \\mathbb{E}[\\mathbb{E}[Y \\mid L]] = \\mathbb{E}[\\nu p(L)] = \\nu \\mathbb{E}[p(L)] $$\n对于二阶矩，我们对 $Y^2$ 应用全期望定律：\n$$ \\mathbb{E}[Y^2] = \\mathbb{E}[\\mathbb{E}[Y^2 \\mid L]] $$\n给定 $L$，$Y$ 以概率 $p(L)$ 取值 $\\nu$，否则取 $0$。因此 $Y^2$ 以概率 $p(L)$ 取值 $\\nu^2$，否则取 $0$。\n$$ \\mathbb{E}[Y^2 \\mid L] = \\nu^2 p(L) \\cdot 1 + 0 \\cdot (1-p(L)) = \\nu^2 p(L) $$\n对 $L$ 取期望：\n$$ \\mathbb{E}[Y^2] = \\mathbb{E}[\\nu^2 p(L)] = \\nu^2 \\mathbb{E}[p(L)] $$\n于是 $Y$ 的方差为：\n$$ \\operatorname{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2 = \\nu^2 \\mathbb{E}[p(L)] - (\\nu \\mathbb{E}[p(L)])^2 $$\n$$ \\operatorname{Var}(Y) = \\nu^2 \\left( \\mathbb{E}[p(L)] - (\\mathbb{E}[p(L)])^2 \\right) = \\nu^2 \\mathbb{E}[p(L)](1 - \\mathbb{E}[p(L)]) $$\n这证实了给定的 $\\operatorname{Var}(Y)$ 表达式。\n\n**方差减少比 $R$ 的推导与分析**\n\n方差减少比 $R$ 是两个方差之比。因子 $\\nu^2$ 被约去，这表明减少比与裂变产额 $\\nu$ 无关。\n$$ R = \\frac{\\operatorname{Var}(Y)}{\\operatorname{Var}(Z)} = \\frac{\\nu^2 \\mathbb{E}[p(L)](1 - \\mathbb{E}[p(L)])}{\\nu^2 \\left(\\mathbb{E}[p(L)^2] - \\left(\\mathbb{E}[p(L)]\\right)^2\\right)} = \\frac{\\mathbb{E}[p(L)](1 - \\mathbb{E}[p(L)])}{\\mathbb{E}[p(L)^2] - \\left(\\mathbb{E}[p(L)]\\right)^2} $$\n这与问题陈述相符。从第一部分我们知道 $\\operatorname{Var}(Y) \\ge \\operatorname{Var}(Z)$，因此 $R \\ge 1$。\n\n让我们通过定义 $x = \\Sigma_a d$ 来分析 $R$ 在两种极限情况下的行为。\n\n1.  **弱吸收极限（$\\Sigma_a d \\to 0$ 或 $x \\to 0^+$）：**\n    对小的 $x$ 使用泰勒级数展开：\n    $e^{-x} = 1 - x + \\frac{x^2}{2} - O(x^3)$\n    $\\mathbb{E}[p(L)] = \\frac{1 - (1 - x + x^2/2 - \\dots)}{x} = 1 - \\frac{x}{2} + O(x^2)$\n    $\\mathbb{E}[p(L)^2] = \\frac{1 - e^{-2x}}{2x} = 1 - x + O(x^2)$\n    $R$ 的分子是：\n    $\\mathbb{E}[p(L)](1 - \\mathbb{E}[p(L)]) \\approx (1 - x/2)(1 - (1 - x/2)) = (1-x/2)(x/2) \\approx x/2$\n    $R$ 的分母，即 $\\operatorname{Var}(p(L))$，可以通过更高阶的展开得到，约为 $x^2/12$。\n    该比值变为：\n    $R(x) \\approx \\frac{x/2}{x^2/12} = \\frac{6}{x} = \\frac{6}{\\Sigma_a d}$\n    当 $x \\to 0^+$ 时，$R \\to \\infty$。这意味着对于存活概率非常高的弱吸收系统，隐式俘获能产生非常大的方差减少。\n\n2.  **高吸收极限（$\\Sigma_a d \\to \\infty$ 或 $x \\to \\infty$）：**\n    在此极限下，$e^{-x} \\to 0$ 且 $e^{-2x} \\to 0$。\n    $\\mathbb{E}[p(L)] = \\frac{1 - e^{-x}}{x} \\approx \\frac{1}{x}$\n    $\\mathbb{E}[p(L)^2] = \\frac{1 - e^{-2x}}{2x} \\approx \\frac{1}{2x}$\n    $R$ 的分子是：\n    $\\mathbb{E}[p(L)](1 - \\mathbb{E}[p(L)]) \\approx \\frac{1}{x}(1 - \\frac{1}{x}) \\approx \\frac{1}{x}$\n    $R$ 的分母是：\n    $\\mathbb{E}[p(L)^2] - (\\mathbb{E}[p(L)])^2 \\approx \\frac{1}{2x} - (\\frac{1}{x})^2 = \\frac{1}{2x} - \\frac{1}{x^2} \\approx \\frac{1}{2x}$\n    该比值变为：\n    $R(x) \\approx \\frac{1/x}{1/(2x)} = 2$\n    当 $x \\to \\infty$ 时，$R \\to 2$。在高吸收系统中，尽管存活概率很低，隐式俘获仍然能提供一个约为 2 的稳定方差减少因子。\n\n### 第 3 部分：方差减少的机制\n\n以上推导证明了隐式俘获减少了 k-特征值估计量的方差。根本原因在于从模拟中消除了一个特定的随机性来源。\n\n在**模拟**蒙特卡洛模拟中，一个中子的历史涉及一系列随机选择。在这个简化问题中，关键的随机选择是中子是在平板内被吸收还是存活到达裂变层。这是一个由伯努利试验建模的二元结果。估计量 $Y$ 的方差包含一个分量 $\\mathbb{E}[\\operatorname{Var}(Y \\mid L)]$，它直接源于此吸收事件的随机性。一个粒子可能“幸运”地存活并走完长路径，贡献一个大的分数（$\\nu$），或“不幸”地被提早吸收，贡献为零。对于给定的径迹长度，这种结果的高度可变性增加了最终估计的整体统计不确定性。\n\n**隐式俘獲**（或存活偏倚）规避了这种二元的随机事件。它不把吸收过程模拟为一个随机选择，而是确定性地考虑其效应。该算法解析地计算存活概率 $p(L)$，并使用此概率作为统计权重。粒子历史从不因吸收而终止；它总是被追踪到裂变层。然而，它对最终统计总量的贡献会通过其权重进行衰减，该权重代表了这样一个粒子系综中能够存活下来的粒子所占的比例。单个粒子的最终分数 $Z = \\nu p(L)$，恰好是模拟分数的条件期望。\n\n通过将随机变量 $Y \\mid L$ 替换为其期望 $\\mathbb{E}[Y \\mid L]$，我们消除了与吸收“掷硬币”相关的方差。隐式俘获估计量 $Z$ 中仅剩的方差来源，是初始随机变量——径迹长度 $L$ 的分布所带来的自然变异。正如全方差公式和 Rao-Blackwell 定理所证明的，这个过程系统性地减少了估计量的方差，从而使模拟更高效，用更少的粒子历史就能达到期望的精度水平。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the variance reduction ratio R for given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (sigma_a, d, nu). The value of nu is not used for R.\n    test_cases = [\n        (1.0, 5.0, 2.5),  # Test case 1 (general case)\n        (5.0, 5.0, 2.5),  # Test case 2 (highly absorbing region)\n        (0.1, 5.0, 2.5),  # Test case 3 (weakly absorbing region)\n        (5.0, 0.5, 2.5),  # Test case 4 (short slab, high absorption)\n    ]\n\n    results = []\n    \n    # A small number to prevent division by zero, though problem constraints ensure this won't happen.\n    epsilon = 1e-12\n\n    for case in test_cases:\n        sigma_a, d, _ = case\n        x = sigma_a * d\n\n        # The parameter x must be greater than 0 based on problem constraints.\n        if x == 0:\n            # In a perfectly transparent medium (x=0), p(L)=1 is non-random,\n            # so Var(Z) = 0, leading to a division by zero.\n            # R would be infinite. We adhere to problem constraints where x > 0.\n            # Using np.inf for this theoretical case.\n            results.append(np.inf)\n            continue\n            \n        # Calculate E[p(L)]\n        # E[p(L)] = (1 - exp(-x)) / x\n        # We use np.expm1(-x) = exp(-x) - 1 for better numerical precision for small x.\n        # So, 1 - exp(-x) = -expm1(-x)\n        e_p = -np.expm1(-x) / x\n\n        # Calculate E[p(L)^2]\n        # E[p(L)^2] = (1 - exp(-2x)) / (2x)\n        e_p2 = -np.expm1(-2 * x) / (2 * x)\n        \n        # Numerator of R: Var(Y) / nu^2 = E[p(L)] * (1 - E[p(L)])\n        # This is the variance of a Bernoulli trial with success probability E[p(L)]\n        numerator_r = e_p * (1.0 - e_p)\n        \n        # Denominator of R: Var(Z) / nu^2 = Var(p(L)) = E[p(L)^2] - (E[p(L)])^2\n        denominator_r = e_p2 - e_p**2\n        \n        # The denominator, being a variance, is non-negative. It is zero only\n        # if p(L) is non-random (i.e., x=0), a case handled above.\n        if denominator_r  epsilon:\n            # This case corresponds to x being very close to 0, R -> infinity.\n            variance_ratio_r = np.inf\n        else:\n            variance_ratio_r = numerator_r / denominator_r\n            \n        results.append(variance_ratio_r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}