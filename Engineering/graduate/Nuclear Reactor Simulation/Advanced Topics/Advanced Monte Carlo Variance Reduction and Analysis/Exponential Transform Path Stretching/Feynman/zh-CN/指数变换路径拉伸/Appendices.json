{
    "hands_on_practices": [
        {
            "introduction": "在应用任何方差缩减技术之前，理解其数学原理至关重要，特别是它如何影响估计量的方差。这项练习将作为一个基础的理论挑战，引导您完整地推导指数变换估计量的方差表达式。更进一步，您将通过求解最优化问题，得到能够使方差最小化的最优偏倚参数，为实际应用中的参数选择提供理论依据。",
            "id": "4224668",
            "problem": "考虑单能中性粒子穿过厚度为 $d$、宏观总截面为 $\\Sigma_{t}0$ 的均匀平整板层。该板层为纯吸收介质（板内无散射，无源）。一个单能、单向的粒子从 $x=0$ 出发，沿着板层的法线方向向 $x=d$ 移动。\n\n需要使用的基本事实：\n- 在均匀吸收介质中，到第一次碰撞的自由程长度 $s$ 服从指数概率密度函数（PDF） $f(s)=\\Sigma_{t}\\exp(-\\Sigma_{t} s)$，其中 $s\\geq 0$。\n- 穿过板层的泄漏（透射）概率是第一次碰撞距离超过 $d$ 的概率，即 $P_{\\mathrm{leak}}=\\exp(-\\Sigma_{t} d)$。\n- 在蒙特卡罗（MC）模拟中，通过重要性抽样进行的方差缩减必须通过似然比来保持无偏性。如果使用有偏的PDF $f_{\\alpha}(s)$ 来抽样 $s$，则任何事件泛函的无偏估计量可以通过将事件指示符乘以似然比 $L(s)=f(s)/f_{\\alpha}(s)$ 来获得。\n\n为了使用指数变换路径拉伸法估计 $P_{\\mathrm{leak}}$，引入一个偏倚参数 $\\alpha$，约束条件为 $\\alpha1$，并将 $f(s)$ 替换为有偏的PDF\n$$\nf_{\\alpha}(s)=(1-\\alpha)\\,\\Sigma_{t}\\,\\exp\\!\\big(-(1-\\alpha)\\,\\Sigma_{t}\\,s\\big), \\quad s\\geq 0,\n$$\n同时使用无偏泄漏估计量\n$$\nY_{\\alpha}=\\mathbf{1}_{\\{sd\\}}\\,L(s), \\quad L(s)=\\frac{f(s)}{f_{\\alpha}(s)}.\n$$\n这里 $\\mathbf{1}_{\\{sd\\}}$ 是抽样的自由程超过板层厚度的事件的指示函数。\n\n仅从上述基本事实和定义出发，不引入任何额外的预推导公式，完成以下任务：\n\n1. 推导方差 $\\mathrm{Var}[Y_{\\alpha}]$ 作为 $\\alpha$、$\\Sigma_{t}$ 和 $d$ 的函数的闭式表达式。\n2. 对于 $\\alpha1$，确定使 $\\mathrm{Var}[Y_{\\alpha}]$ 最小化的值 $\\alpha^{\\star}$。将结果表示为光学厚度 $\\Sigma_{t}d$ 的闭式表达式。\n3. 基于你得到的 $\\alpha^{\\star}$ 表达式，定性解释当 $\\Sigma_{t} d$ 增加时，最优值如何变化，但最终答案只报告 $\\alpha^{\\star}$ 的精确闭式表达式。\n\n将最终答案报告为 $\\alpha^{\\star}$ 的单一闭式解析表达式，不带单位。不要四舍五入。",
            "solution": "该问题要求推导粒子泄漏的蒙特卡罗估计量的方差，优化偏倚参数，并对结果进行定性分析。我们将按顺序解决这三个部分。\n\n首先，必须对问题进行验证。\n**步骤1：提取已知条件**\n- 单能中性粒子输运，均匀平整板层，厚度 $d$，宏观总截面 $\\Sigma_{t}0$。\n- 纯吸收板层（无散射，无内部源）。\n- 单能、单向粒子从 $x=0$ 开始，向 $x=d$ 移动。\n- 自由程长度概率密度函数（PDF）：$f(s)=\\Sigma_{t}\\exp(-\\Sigma_{t} s)$，其中 $s\\geq 0$。\n- 泄漏（透射）概率：$P_{\\mathrm{leak}}=\\exp(-\\Sigma_{t} d)$。\n- 用于重要性抽样的有偏PDF：$f_{\\alpha}(s)=(1-\\alpha)\\,\\Sigma_{t}\\,\\exp(-(1-\\alpha)\\,\\Sigma_{t}\\,s)$，其中 $s\\geq 0$ 且 $\\alpha1$。\n- 无偏泄漏估计量：$Y_{\\alpha}=\\mathbf{1}_{\\{sd\\}}\\,L(s)$，其中 $L(s)=f(s)/f_{\\alpha}(s)$ 是似然比，$\\mathbf{1}_{\\{sd\\}}$ 是事件 $sd$ 的指示函数。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，是粒子输运蒙特卡罗方法理论中的一个标准练习，具体涉及指数变换方差缩减技术。问题提法恰当，为获得唯一的数学解提供了所有必要的定义和约束。语言客观而精确。问题是自洽的，没有矛盾或不科学的前提。\n\n**步骤3：结论与行动**\n问题有效。我们开始求解。\n\n**1. 方差 $\\mathrm{Var}[Y_{\\alpha}]$ 的推导**\n\n随机变量 $Y_{\\alpha}$ 的方差由以下公式给出，其中期望 $\\mathrm{E}_{\\alpha}[\\cdot]$ 是相对于有偏PDF $f_{\\alpha}(s)$ 计算的：\n$$\n\\mathrm{Var}[Y_{\\alpha}] = \\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] - (\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2\n$$\n我们首先计算估计量的均值 $\\mathrm{E}_{\\alpha}[Y_{\\alpha}]$。根据定义，\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{0}^{\\infty} Y_{\\alpha}(s) f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} L(s) f_{\\alpha}(s) \\, ds\n$$\n代入 $L(s) = f(s)/f_{\\alpha}(s)$，我们得到：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} \\frac{f(s)}{f_{\\alpha}(s)} f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} \\mathbf{1}_{\\{sd\\}} f(s) \\, ds\n$$\n指示函数将积分域限制在 $sd$：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}] = \\int_{d}^{\\infty} f(s) \\, ds = \\int_{d}^{\\infty} \\Sigma_{t}\\exp(-\\Sigma_{t} s) \\, ds = \\left[-\\exp(-\\Sigma_{t} s)\\right]_{d}^{\\infty} = 0 - (-\\exp(-\\Sigma_{t} d)) = \\exp(-\\Sigma_{t} d)\n$$\n这证实了估计量是无偏的，即其期望值是真实的泄漏概率 $P_{\\mathrm{leak}}$。因此，均值的平方为 $(\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2 = (\\exp(-\\Sigma_{t} d))^2 = \\exp(-2\\Sigma_{t} d)$。\n\n接下来，我们计算二阶矩 $\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2]$。\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{0}^{\\infty} Y_{\\alpha}^2(s) f_{\\alpha}(s) \\, ds = \\int_{0}^{\\infty} (\\mathbf{1}_{\\{sd\\}} L(s))^2 f_{\\alpha}(s) \\, ds\n$$\n由于 $(\\mathbf{1}_{\\{sd\\}})^2 = \\mathbf{1}_{\\{sd\\}}$，我们有：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{d}^{\\infty} (L(s))^2 f_{\\alpha}(s) \\, ds\n$$\n首先，我们明确写出似然比 $L(s)$ 的表达式：\n$$\nL(s) = \\frac{f(s)}{f_{\\alpha}(s)} = \\frac{\\Sigma_{t}\\exp(-\\Sigma_{t} s)}{(1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s)} = \\frac{1}{1-\\alpha} \\exp(-\\Sigma_{t}s + (1-\\alpha)\\Sigma_{t}s) = \\frac{1}{1-\\alpha} \\exp(-\\alpha\\Sigma_{t}s)\n$$\n现在我们将 $L(s)$ 和 $f_{\\alpha}(s)$ 代入二阶矩的积分中：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\int_{d}^{\\infty} \\left(\\frac{1}{1-\\alpha} \\exp(-\\alpha\\Sigma_{t}s)\\right)^2 \\left((1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s)\\right) \\, ds\n$$\n$$\n= \\int_{d}^{\\infty} \\frac{1}{(1-\\alpha)^2} \\exp(-2\\alpha\\Sigma_{t}s) (1-\\alpha)\\Sigma_{t}\\exp(-(1-\\alpha)\\Sigma_{t}s) \\, ds\n$$\n$$\n= \\frac{\\Sigma_{t}}{1-\\alpha} \\int_{d}^{\\infty} \\exp\\big(-2\\alpha\\Sigma_{t}s - (1-\\alpha)\\Sigma_{t}s\\big) \\, ds\n$$\n指数项化简为 $-2\\alpha\\Sigma_{t}s - \\Sigma_{t}s + \\alpha\\Sigma_{t}s = -(1+\\alpha)\\Sigma_{t}s$。积分变为：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\frac{\\Sigma_{t}}{1-\\alpha} \\int_{d}^{\\infty} \\exp(-(1+\\alpha)\\Sigma_{t}s) \\, ds\n$$\n为使该积分收敛，指数的参数必须为负，这要求 $(1+\\alpha)\\Sigma_{t}  0$。因为 $\\Sigma_{t}0$，我们必须有 $1+\\alpha0$，即 $\\alpha  -1$。计算该积分：\n$$\n\\int_{d}^{\\infty} \\exp(-(1+\\alpha)\\Sigma_{t}s) \\, ds = \\left[ \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}s)}{-(1+\\alpha)\\Sigma_{t}} \\right]_d^{\\infty} = 0 - \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{-(1+\\alpha)\\Sigma_{t}} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1+\\alpha)\\Sigma_{t}}\n$$\n将此结果代回二阶矩的表达式中：\n$$\n\\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] = \\frac{\\Sigma_{t}}{1-\\alpha} \\cdot \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1+\\alpha)\\Sigma_{t}} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{(1-\\alpha)(1+\\alpha)} = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{1-\\alpha^2}\n$$\n最后，我们整合得到方差：\n$$\n\\mathrm{Var}[Y_{\\alpha}] = \\mathrm{E}_{\\alpha}[Y_{\\alpha}^2] - (\\mathrm{E}_{\\alpha}[Y_{\\alpha}])^2 = \\frac{\\exp(-(1+\\alpha)\\Sigma_{t}d)}{1-\\alpha^2} - \\exp(-2\\Sigma_{t}d)\n$$\n\n**2. 最优参数 $\\alpha^{\\star}$ 的确定**\n\n为了找到使 $\\mathrm{Var}[Y_{\\alpha}]$ 最小化的 $\\alpha$ 值，我们将方差对 $\\alpha$ 求导，并令导数等于零。我们记光学厚度为 $T = \\Sigma_{t}d  0$。方差为：\n$$\nV(\\alpha) = \\frac{\\exp(-(1+\\alpha)T)}{1-\\alpha^2} - \\exp(-2T)\n$$\n我们需要求解 $\\frac{dV}{d\\alpha} = 0$。项 $\\exp(-2T)$ 相对于 $\\alpha$ 是常数。\n$$\n\\frac{dV}{d\\alpha} = \\frac{d}{d\\alpha} \\left( \\frac{\\exp(-T - \\alpha T)}{1-\\alpha^2} \\right) = 0\n$$\n使用除法求导法则 $\\frac{d}{dx}(\\frac{u}{v}) = \\frac{u'v - uv'}{v^2}$：\n$$\n\\frac{(-T \\exp(-T-\\alpha T))(1-\\alpha^2) - (\\exp(-T-\\alpha T))(-2\\alpha)}{(1-\\alpha^2)^2} = 0\n$$\n由于 $\\exp(-T-\\alpha T)$ 恒为正，且对于 $\\alpha \\in (-1, 1)$ 分母不为零，我们可以通过将分子设为零来简化方程：\n$$\n-T(1-\\alpha^2) + 2\\alpha = 0\n$$\n$$\n-T + T\\alpha^2 + 2\\alpha = 0 \\implies T\\alpha^2 + 2\\alpha - T = 0\n$$\n这是一个关于 $\\alpha$ 的二次方程。使用二次公式 $\\alpha = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$，其中 $a=T$，$b=2$，$c=-T$：\n$$\n\\alpha = \\frac{-2 \\pm \\sqrt{2^2 - 4(T)(-T)}}{2T} = \\frac{-2 \\pm \\sqrt{4 + 4T^2}}{2T} = \\frac{-2 \\pm 2\\sqrt{1+T^2}}{2T} = \\frac{-1 \\pm \\sqrt{1+T^2}}{T}\n$$\n这给出了两个可能的解：\n$$\n\\alpha_1 = \\frac{-1 + \\sqrt{1+T^2}}{T} \\quad \\text{和} \\quad \\alpha_2 = \\frac{-1 - \\sqrt{1+T^2}}{T}\n$$\n我们必须根据约束条件 $\\alpha  1$ 和 $\\alpha  -1$ 来检查这些解。对于 $T  0$，有 $\\sqrt{1+T^2}  \\sqrt{T^2} = T$ 和 $\\sqrt{1+T^2}  \\sqrt{1+2T+T^2} = 1+T$。\n对于 $\\alpha_1$：分子满足 $0  -1 + \\sqrt{1+T^2}  T$。由于 $T0$，两边同除以 $T$ 得到 $0  \\alpha_1  1$。此解在有效范围内。\n对于 $\\alpha_2$：分子为 $-1 - \\sqrt{1+T^2}  -2$。因此，$\\alpha_2 = \\frac{-1 - \\sqrt{1+T^2}}{T}$ 是负数。进一步分析表明，对于所有 $T0$，都有 $\\alpha_2  -1$。此解位于方差有限的定义域之外。\n二阶导数检验确认 $\\alpha_1$ 对应一个最小值。因此，最优参数为 $\\alpha^{\\star} = \\alpha_1$。代入 $T=\\Sigma_{t}d$：\n$$\n\\alpha^{\\star} = \\frac{-1 + \\sqrt{1 + (\\Sigma_t d)^2}}{\\Sigma_t d}\n$$\n\n**3. $\\alpha^{\\star}$ 的定性行为**\n\n我们分析 $\\alpha^{\\star}$ 作为光学厚度 $T = \\Sigma_{t} d$ 的函数的行为。\n- 当光学厚度变得非常大（$T \\to \\infty$）时，泄漏成为一个稀有事件。我们考察其极限：\n$$\n\\lim_{T\\to\\infty} \\alpha^{\\star} = \\lim_{T\\to\\infty} \\frac{-1 + \\sqrt{1+T^2}}{T} = \\lim_{T\\to\\infty} \\frac{T\\sqrt{1/T^2+1}-1}{T} = \\lim_{T\\to\\infty} \\left(\\sqrt{1/T^2+1} - 1/T\\right) = 1\n$$\n所以，$\\alpha^{\\star}$ 趋近于 $1$。一个接近 $1$ 的 $\\alpha$ 值对应于一个重度偏倚（“拉伸”）的路径长度分布，该分布优先抽样长路径，从而增加了在模拟中观察到稀有泄漏事件的可能性。\n- 当光学厚度变得非常小（$T \\to 0$）时，泄漏是一个非常可能发生的事件。对小的 $x$ 使用泰勒展开 $\\sqrt{1+x} \\approx 1+\\frac{1}{2}x$：\n$$\n\\alpha^{\\star} \\approx \\frac{-1 + (1 + \\frac{1}{2}T^2)}{T} = \\frac{\\frac{1}{2}T^2}{T} = \\frac{1}{2}T\n$$\n所以，$\\alpha^{\\star}$ 趋近于 $0$。一个接近 $0$ 的 $\\alpha$ 值对应于几乎没有偏倚，这在所关注的事件不稀有时是合适的。\n总之，随着板层光学厚度 $\\Sigma_t d$ 的增加，最优偏倚参数 $\\alpha^{\\star}$ 从 $0$ 增加到趋近于 $1$，这反映了需要更强的重要性抽样来有效模拟日益稀有的粒子透射事件。",
            "answer": "$$\\boxed{\\frac{-1 + \\sqrt{1 + (\\Sigma_{t} d)^{2}}}{\\Sigma_{t} d}}$$"
        },
        {
            "introduction": "在完成核心理论推导之后，将指数变换方法置于更广阔的背景中进行理解非常重要。本练习要求您比较和对比指数变换与另一种常见的方差缩减技术——强迫碰撞。通过辨析这两种方法的异同，您将能更深刻地把握指数变换的独特之处，例如它的全局性应用和依赖于路径的权重修正机制。",
            "id": "4224682",
            "problem": "考虑一个初始统计权重为 $w_0$ 的单能中子，进入一个具有恒定宏观总截面 $\\Sigma_t$ 的凸反应堆栅元，并沿固定方向行进，使其飞行路径上到最近边界的直线距离为 $D0$。假设在标准的蒙特卡罗 (MC) 中子输运中，均匀介质中的自由飞行距离遵循比尔-朗伯定律：飞行至距离 $s$ 未发生碰撞的概率为 $e^{-\\Sigma_t s}$，相应的模拟自由飞行概率密度函数 (PDF) 为 $f(s)=\\Sigma_t e^{-\\Sigma_t s}$ (对于 $s\\ge 0$）。正在考虑两种方差减少策略：\n\n1. 一种栅元局域的强迫碰撞方案，该方案以在逃离栅元前发生碰撞为条件。\n2. 一种指数变换 (ET) 径迹拉伸方案，该方案使用偏倚参数 $\\alpha$（其中 $0  \\alpha  \\Sigma_t$）全局地重塑自由飞行分布。\n\n下列陈述中，哪些是对这些方法及其权重调整的正确描述？\n\nA. 在强迫碰撞中，碰撞距离 $s$ 从条件（截断的）指数 PDF $f(s \\mid s  D) = \\frac{\\Sigma_t e^{-\\Sigma_t s}}{1 - e^{-\\Sigma_t D}}$ 中抽样，并且粒子在栅元内（$s  D$）的碰撞权重被修正为 $w_{new} = w_0 (1 - e^{-\\Sigma_t D})$。\n\nB. 在强迫碰撞中，粒子权重保持不变，但会创建一个第二“虚拟”粒子，其权重等于逃逸概率 $e^{-\\Sigma_t D}$，并直接计入泄漏。同时，原始粒子被强迫在栅元内碰撞（$s \\le D$）。\n\nC. 在指数变换中，中子飞行了距离 $s$ 后，其权重被乘以一个与路径相关的因子 $w_{new} = w_{old} \\times \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s}$，而不管它是否在该点碰撞。\n\nD. 在指数变换中，如果粒子未经碰撞而逃离栅元，其权重仅在其逃离边界时（即在 $s=D$ 处）被修正为 $w_{new} = w_0 e^{-\\alpha D}$。",
            "solution": "问题陈述描述了蒙特卡罗中子输运中的一个标准情景，并要求评估关于两种常用方差减少技术（强迫碰撞和指数变换）的陈述的正确性。\n\n### **问题验证**\n\n**步骤 1：提取已知条件**\n- 单能中子的初始统计权重为 $w_0$。\n- 中子进入一个具有恒定宏观总截面 $\\Sigma_t$ 的凸反应堆栅元。\n- 沿其飞行路径到最近边界的直线距离为 $D  0$。\n- 飞行至距离 $s$ 未发生碰撞的模拟概率为 $e^{-\\Sigma_t s}$。\n- 模拟自由飞行概率密度函数 (PDF) 为 $f(s)=\\Sigma_t e^{-\\Sigma_t s}$ (对于 $s \\ge 0$）。\n- 策略 1：栅元局域的强迫碰撞，以逃逸前发生碰撞为条件。\n- 策略 2：使用偏倚参数 $\\alpha$（其中 $0  \\alpha  \\Sigma_t$）的指数变换 (ET) 径迹拉伸。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题在核反应堆物理和蒙特卡罗方法的背景下是定义明确的。\n- **科学依据充分：** 所提出的概念（比尔-朗伯定律、宏观截面、统计权重、强迫碰撞、指数变换）是中子输运理论中的基本和标准概念。PDF 和概率的数学形式是正确的。\n- **适定性：** 问题提供了足够的信息来评估关于指定的方差减少方法的陈述的有效性。\n- **客观性：** 语言技术性强、精确，没有歧义或主观论断。\n- **完整性和一致性：** 已知条件是自洽的。PDF $f(s)$ 是 $1 - P(\\text{飞行至 } s \\text{ 未碰撞}) = 1 - e^{-\\Sigma_t s}$ 的正确导数。ET 的约束条件 $0  \\alpha  \\Sigma_t$ 在物理上是必要的，以确保偏倚截面保持为正，这是一个正确且关键的细节。\n\n**步骤 3：结论和行动**\n问题陈述有效。我将继续进行完整解答。\n\n### **理论推导**\n\n通过偏倚减少方差的基本原理是，如果我们从一个偏倚的 PDF $g(s)$ 而不是其真实的（或“模拟的”）PDF $f(s)$ 中抽样一个事件（如自由飞行距离 $s$），我们必须调整粒子的统计权重，以保持对任何统计量的无偏估计。权重乘以似然比 $R(s) = \\frac{f(s)}{g(s)}$。\n\n**1. 强迫碰撞分析**\n在模拟仿真中，一个在栅元入口处权重为 $w_0$ 的中子在其初始飞行路径上有两种可能的结果：\n- 它在栅元内碰撞，即在距离 $s  D$ 处。此事件的概率为 $P(s  D) = \\int_{0}^{D} f(s) ds = \\int_{0}^{D} \\Sigma_t e^{-\\Sigma_t s} ds = \\left[-e^{-\\Sigma_t s}\\right]_0^D = 1 - e^{-\\Sigma_t D}$。\n- 它未经碰撞逃离栅元，即飞行距离 $s \\ge D$。概率为 $P(s \\ge D) = 1 - P(s  D) = e^{-\\Sigma_t D}$。\n\n强迫碰撞技术消除了这两种结果之间的随机选择。它强迫粒子在栅元内碰撞（即对于 $s  D$）。这意味着我们从一个以事件 $s  D$ 为条件的新分布中抽样。\n因此，偏倚的 PDF $g(s)$ 是条件 PDF：\n$$g(s) = f(s \\mid s  D) = \\frac{f(s)}{P(s  D)} = \\frac{\\Sigma_t e^{-\\Sigma_t s}}{1 - e^{-\\Sigma_t D}}, \\quad \\text{对于 } 0 \\le s  D$$\n且对于 $s \\ge D$，$g(s)=0$。\n\n为了保持模拟的无偏性，必须调整粒子的权重。这里的权重修正不是标准的似然比，因为我们从根本上改变了事件空间。相反，我们可以将其视为一种分裂形式。一个初始权重为 $w_0$ 的粒子被分裂成两个“虚拟”粒子：一个保证会碰撞，另一个保证会逃逸。\n- 碰撞粒子的权重变为 $w_c = w_0 \\times P(s  D) = w_0 (1 - e^{-\\Sigma_t D})$。然后从上面的条件 PDF $g(s)$ 中抽样该粒子的飞行距离 $s$。\n- 逃逸粒子不进行物理模拟。其权重 $w_e = w_0 \\times P(s \\ge D) = w_0 e^{-\\Sigma_t D}$ 直接作为逃逸进行统计，贡献给泄漏统计量。这部分根据实现是可选的，但它代表了逃逸份额的正确权重计算。\n\n**2. 指数变换 (ET) 分析**\nET 方法通过改变宏观截面来修改模拟 PDF $f(s) = \\Sigma_t e^{-\\Sigma_t s}$。总截面 $\\Sigma_t$ 被一个偏倚截面 $\\Sigma_t' = \\Sigma_t - \\alpha$ 所取代。选择参数 $\\alpha$ 来“拉伸”或“收缩”粒子路径。对于深穿透，选择一个正的 $\\alpha$ 来减小有效截面，从而增加平均自由程，使粒子能够行进得更远。\n约束条件 $0  \\alpha  \\Sigma_t$ 确保了 $\\Sigma_t' > 0$，这是 $\\Sigma_t'$ 成为一个物理截面以及由此产生的 PDF 可归一化的必要条件。\n\n偏倚的 PDF $g_\\alpha(s)$ 是一个具有新截面 $\\Sigma_t'$ 的指数分布：\n$$g_\\alpha(s) = \\Sigma_t' e^{-\\Sigma_t' s} = (\\Sigma_t - \\alpha) e^{-(\\Sigma_t - \\alpha)s}, \\quad \\text{对于 } s \\ge 0$$\n从这个偏倚 PDF 中抽样一个距离 $s$ 后，粒子的权重必须乘以似然比 $R(s)$：\n$$R(s) = \\frac{f(s)}{g_\\alpha(s)} = \\frac{\\Sigma_t e^{-\\Sigma_t s}}{(\\Sigma_t - \\alpha) e^{-(\\Sigma_t - \\alpha)s}} = \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{(-\\Sigma_t + (\\Sigma_t - \\alpha))s} = \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s}$$\n这个权重修正在碰撞位置应用。新权重为 $w_{new} = w_{old} \\times R(s)$。\n\n### **逐项分析**\n\n**A. 在强迫碰撞中，碰撞距离 $s$ 从条件（截断的）指数 PDF $f(s \\mid s  D) = \\frac{\\Sigma_t e^{-\\Sigma_t s}}{1 - e^{-\\Sigma_t D}}$ 中抽样，并且粒子在栅元内（$s  D$）的碰撞权重被修正为 $w_{new} = w_0 (1 - e^{-\\Sigma_t D})$。**\n该陈述准确描述了强迫碰撞方法的一个标准实现。从条件 PDF 中进行抽样，并且通过乘以事件的真实概率来调整权重。这是**正确的**。\n\n**B. 在强迫碰撞中，粒子权重保持不变，但会创建一个第二“虚拟”粒子，其权重等于逃逸概率 $e^{-\\Sigma_t D}$，并直接计入泄漏。同时，原始粒子被强迫在栅元内碰撞（$s \\le D$）。**\n这描述了强迫碰撞的另一种观点或实现方式，即粒子分裂。原始粒子被分裂为一个碰撞粒子和一个逃逸粒子。然而，该陈述的关键错误在于它声称原始粒子的“权重保持不变”。这是不正确的。存活并碰撞的粒子的权重必须被设为 $w_0 (1 - e^{-\\Sigma_t D})$。简单地强迫它碰撞而不改变其权重会引入偏差。因此，该陈述是**不正确的**。\n\n**C. 在指数变换中，中子飞行了距离 $s$ 后，其权重被乘以一个与路径相关的因子 $w_{new} = w_{old} \\times \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s}$，而不管它是否在该点碰撞。**\n这准确地陈述了 ET 中权重调整的机制。权重修正是似然比，它依赖于飞行的距离 $s$。这个修正是在飞行结束时、在碰撞物理过程被模拟之前应用的。如果粒子逃逸，则该权重用于统计；如果它碰撞，则这是碰撞前的新权重。该陈述是**正确的**。\n\n**D. 在指数变换中，如果粒子未经碰撞而逃离栅元，其权重仅在其逃离边界时（即在 $s=D$ 处）被修正为 $w_{new} = w_0 e^{-\\alpha D}$。**\n该陈述有几个错误。首先，权重修正不只是 $e^{-\\alpha D}$，它还包括因子 $\\frac{\\Sigma_t}{\\Sigma_t - \\alpha}$。其次，权重调整发生在飞行路径 $s$ 的末端，如果粒子逃逸，则 $s \\ge D$，并且权重修正是基于实际的飞行距离 $s$，而不仅仅是边界距离 $D$。例如，如果粒子被抽样飞行了 $s=D+d$ 的距离，那么权重修正将是 $w_{old} \\times \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha(D+d)}$。因此，该陈述是**不正确的**。\n\n**结论**\n陈述 A 和 C 是正确的。",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "最后的练习旨在连接理论与实际应用，这也是检验学习成果的最终环节。在这个编码练习中，您将为一个经典的屏蔽问题实现指数变换方法。您不仅将亲眼见证方差缩减的强大效果，还将学习一套实用的工作流程：通过试运行（pilot run）寻找近似最优的参数，并使用品质因数（Figure of Merit, FOM）来量化模拟的效率。",
            "id": "4224733",
            "problem": "考虑一个核反应堆模拟中的一维板屏蔽基准问题。一个单能粒子从入口 $x=0$ 开始，沿着 $+x$ 方向穿过一个均匀的纯吸收介质。该介质的宏观总截面为 $\\Sigma_t$，单位为 $\\text{cm}^{-1}$。板的厚度为 $L$，单位为 $\\text{cm}$。我们关心的量是 $x=L$ 处的透射份额（通量），它等于粒子在离开板之前未发生相互作用的概率。\n\n基本原理：\n- 对于纯吸收介质，Beer–Lambert 指数衰减定律指出，穿过路径长度 $s$ 的存活概率为 $\\exp(-\\Sigma_t s)$。\n- 在模拟蒙特卡罗抽样中，根据宏观总截面的定义，自由程 $s$ 从一个速率为 $\\Sigma_t$ 的指数分布中抽样。\n\n指数变换路径拉伸是一种方差缩减技术，它通过降低指数率来偏倚自由程抽样，并用适当的权重进行补偿以保持无偏性。设 $\\alpha$（单位为 $\\text{cm}^{-1}$）为路径拉伸参数，选择该参数使得 $0 \\le \\alpha  \\Sigma_t$，以确保偏倚抽样是良定义的。偏倚抽样率变为 $(\\Sigma_t - \\alpha)$，并且必须使用模拟抽样定律和偏倚抽样定律之间的严格似然比以及透射指示函数来推导透射份额的无偏估计量。此处不提供无偏估计量的简便公式；该估计量必须从上述基本原理出发，通过第一性原理获得。\n\n品质因数（FOM）定义如下。设 $N$ 表示粒子历史数（这是计算量；将其视为以历史数为单位的“时间”），$\\hat{\\mu}$ 为透射份额的样本均值估计量，$\\hat{\\sigma}^2$ 为其无偏样本方差。相对误差为 $R = \\hat{\\sigma}/|\\hat{\\mu}|$。品质因数（FOM）为 $1/(R^2 N)$，并且必须以 $\\text{histories}^{-1}$ 为单位报告。\n\n任务：\n1. 对于给定的 $(\\Sigma_t, L)$，对一组离散的候选 $\\alpha$ 值进行初步研究（pilot study），以估计每个候选值的 FOM。使用初步研究的结果选择能够最大化估计 FOM 的 $\\alpha$。在初步研究的离散化下，该 $\\alpha$ 被视为“最优”的（$\\alpha$ 以 $\\text{cm}^{-1}$ 表示）。\n2. 通过执行生产运行来验证该选择，并比较以下情况的 FOM：\n   - 模拟情况（$\\alpha = 0$），\n   - 初步研究选择的最优 $\\alpha$，\n   - 从初步研究集合中选择一个明显非最优的 $\\alpha$，其初步研究 FOM 严格低于最优选择。\n3. 对于每个测试用例，报告：\n   - 最优 $\\alpha$（单位 $\\text{cm}^{-1}$），\n   - 最优 $\\alpha$ 的生产运行 FOM（单位 $\\text{histories}^{-1}$），\n   - 模拟情况的生产运行 FOM（单位 $\\text{histories}^{-1}$），\n   - 所选非最优 $\\alpha$ 的生产运行 FOM（单位 $\\text{histories}^{-1}$），\n   - 一个布尔值，确认最优 FOM 严格大于模拟 FOM，\n   - 一个布尔值，确认最优 FOM 严格大于非最优 FOM。\n\n估计量和算法要求：\n- 从上述基本原理出发，使用分布变换的似然比结合透射指示函数 $I[s \\ge L]$，推导指数变换路径拉伸下透射份额的无偏估计量。\n- 针对每个候选 $\\alpha$（包括通过设置 $\\alpha = 0$ 的模拟情况），使用从速率为 $(\\Sigma_t - \\alpha)$ 的偏倚指数分布中对自由程 $s$ 进行独立同分布抽样的方法，来实现蒙特卡罗模拟。\n- 对于每次运行，计算样本均值、无偏样本方差、相对误差 $R$ 和品质因数 FOM $1/(R^2 N)$，所有单位均按上文规定。\n\n测试套件：\n为以下测试用例执行您的程序，每个用例都有自己的初步研究和生产运行规模：\n- 测试用例 1：$\\Sigma_t = 1.0\\,\\text{cm}^{-1}$，$L = 10.0\\,\\text{cm}$，$N_{\\text{pilot}} = 20000$ 个历史，$N_{\\text{prod}} = 100000$ 个历史。\n- 测试用例 2：$\\Sigma_t = 0.2\\,\\text{cm}^{-1}$，$L = 5.0\\,\\text{cm}$，$N_{\\text{pilot}} = 20000$ 个历史，$N_{\\text{prod}} = 100000$ 个历史。\n- 测试用例 3：$\\Sigma_t = 2.0\\,\\text{cm}^{-1}$，$L = 1.0\\,\\text{cm}$，$N_{\\text{pilot}} = 20000$ 个历史，$N_{\\text{prod}} = 100000$ 个历史。\n\n初步研究候选集：\n对于每个测试用例，考虑一组离散的五个候选 $\\alpha$ 值，定义为 $\\Sigma_t$ 的分数：$\\{0.0, 0.2, 0.5, 0.8, 0.95\\}\\times \\Sigma_t$。需要注意的是，偏倚率 $(\\Sigma_t - \\alpha)$ 必须为正；如果需要，将 $\\alpha$ 的上限限制在严格小于 $\\Sigma_t$ 的值。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的结果，格式为用方括号括起来的逗号分隔列表，每个测试用例的结果本身也是一个列表，顺序如下：\n$[\\alpha_{\\text{opt}}, \\mathrm{FOM}_{\\text{opt}}, \\mathrm{FOM}_{\\text{analog}}, \\mathrm{FOM}_{\\text{nonopt}}, \\text{opt\\_gt\\_analog}, \\text{opt\\_gt\\_nonopt}]$。\n例如，总的外层列表应显示为 $[[\\cdots],[\\cdots],[\\cdots]]$，包含数值和布尔值，所有 $\\alpha$ 值必须以 $\\text{cm}^{-1}$ 为单位，而所有 FOM 值必须以 $\\text{histories}^{-1}$ 为单位。",
            "solution": "所提出的问题是粒子输运蒙特卡罗方法领域中一个有效且适定的练习。它在科学上基于辐射物理和统计估计的原理，并且所有必要的参数和目标都已明确定义。因此，我们将着手提供一个完整的解决方案。\n\n主要目标是评估指数变换路径拉伸方差缩减技术对于一维纯吸收屏蔽问题的有效性。这涉及推导无偏估计量，实现蒙特卡罗模拟，并用它来找到最优的路径拉伸参数 $\\alpha$。\n\n**1. 无偏估计量的推导**\n\n我们关心的量是透射份额 $\\mu$，即粒子在没有相互作用的情况下行进距离大于或等于板厚 $L$ 的概率。粒子的自由程 $s$ 是一个随机变量。\n\n在模拟（无偏）物理模型中，自由程 $s$ 的概率密度函数（PDF）由指数分布给出：\n$$\np(s) = \\Sigma_t e^{-\\Sigma_t s}, \\quad s \\ge 0\n$$\n其中 $\\Sigma_t$ 是宏观总截面。\n\n透射份额 $\\mu$ 是存活概率 $P(s \\ge L)$。这可以表示为指示函数 $I[s \\ge L]$ 的期望值，当 $s \\ge L$ 时该函数为 1，否则为 0。\n$$\n\\mu = E_p[I[s \\ge L]] = \\int_0^\\infty I[s \\ge L] p(s) ds = \\int_L^\\infty \\Sigma_t e^{-\\Sigma_t s} ds = e^{-\\Sigma_t L}\n$$\n模拟蒙特卡罗方法通过从 $p(s)$ 中抽样 $s_i$ 并对 $I[s_i \\ge L]$ 求平均来估计 $\\mu$。对于 $\\Sigma_t L \\gg 1$ 的深穿透问题，$\\mu$ 非常小，这种模拟方法效率低下，因为大多数历史的得分都为 0。\n\n指数变换技术是一种重要性抽样形式，它偏倚抽样以增加透射的概率。我们从一个偏倚的 PDF $p'(s)$ 中抽样路径长度 $s'$：\n$$\np'(s) = (\\Sigma_t - \\alpha) e^{-(\\Sigma_t - \\alpha)s}, \\quad s \\ge 0\n$$\n其中 $\\alpha$ 是路径拉伸参数，满足 $0 \\le \\alpha  \\Sigma_t$。这个偏倚分布的平均自由程（$1/(\\Sigma_t - \\alpha)$）比模拟分布的（$1/\\Sigma_t$）更大，因此鼓励更长的路径。\n\n为确保估计量保持无偏，我们必须引入一个权重 $w(s')$ 来校正概率测度的变化。期望值重写为：\n$$\n\\mu = \\int_0^\\infty I[s \\ge L] p(s) ds = \\int_0^\\infty I[s \\ge L] \\frac{p(s)}{p'(s)} p'(s) ds = E_{p'}\\left[I[s' \\ge L] \\frac{p(s')}{p'(s')}\\right]\n$$\n期望中的项是从 $p'(s')$ 抽样的单个历史的得分。权重 $w(s')$ 是似然比：\n$$\nw(s') = \\frac{p(s')}{p'(s')} = \\frac{\\Sigma_t e^{-\\Sigma_t s'}}{(\\Sigma_t - \\alpha) e^{-(\\Sigma_t - \\alpha)s'}} = \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-[\\Sigma_t - (\\Sigma_t - \\alpha)]s'} = \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s'}\n$$\n因此，对于每个粒子历史 $i$，我们从 $p'(s')$ 中抽样一个路径长度 $s'_i$。该历史的得分 $X_i$ 是：\n$$\nX_i = \\begin{cases} \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s'_i}  \\text{if } s'_i \\ge L \\\\ 0  \\text{if } s'_i  L \\end{cases}\n$$\n这是单个历史的无偏估计量。在 $N$ 个历史上的样本均值 $\\hat{\\mu} = \\frac{1}{N} \\sum_{i=1}^N X_i$ 是真实透射份额 $\\mu$ 的一个无偏估计量。\n\n**2. 蒙特卡罗算法和品质因数（FOM）**\n\n对于给定的参数集 $(\\Sigma_t, L, \\alpha)$ 和总共 $N$ 个粒子历史，模拟过程如下：\n1. 对于每个历史 $i=1, \\dots, N$，从速率为 $\\Sigma'_t = \\Sigma_t - \\alpha$ 的指数分布中抽样一个路径长度 $s'_i$。\n2. 如果 $s'_i \\ge L$，计算得分 $X_i = \\frac{\\Sigma_t}{\\Sigma_t - \\alpha} e^{-\\alpha s'_i}$。\n3. 如果 $s'_i  L$，得分为 $X_i = 0$。\n\n运行 $N$ 个历史后，我们从得分集 $\\{X_1, X_2, \\dots, X_N\\}$ 中计算以下统计量：\n- **样本均值：** $\\hat{\\mu} = \\frac{1}{N} \\sum_{i=1}^N X_i$\n- **无偏样本方差：** $\\hat{\\sigma}^2 = \\frac{1}{N-1} \\sum_{i=1}^N (X_i - \\hat{\\mu})^2$\n\n根据问题定义，相对误差 $R$ 和品质因数（FOM）定义为：\n- **相对误差：** $R = \\frac{\\hat{\\sigma}}{|\\hat{\\mu}|}$\n- **品质因数：** $\\mathrm{FOM} = \\frac{1}{R^2 N} = \\frac{1}{(\\hat{\\sigma}^2 / \\hat{\\mu}^2) N} = \\frac{\\hat{\\mu}^2}{N \\hat{\\sigma}^2}$\n\nFOM 的单位是 $\\text{histories}^{-1}$，符合要求。更高的 FOM 表示模拟效率更高，意味着达到给定统计精度水平所需的历史数更少。\n\n**3. 参数优化与验证**\n\n指数变换的效能高度依赖于 $\\alpha$ 的选择。找到合适的 $\\alpha$ 并验证其性能的程序是：\n\n1. **初步研究：** 对于给定的测试用例 $(\\Sigma_t, L)$，使用 $N_{\\text{pilot}}$ 个历史对一组离散的候选 $\\alpha$ 值 $\\{0.0, 0.2, 0.5, 0.8, 0.95\\} \\times \\Sigma_t$ 运行模拟。对每个候选值估计 FOM。产生最高估计 FOM 的 $\\alpha$ 值被指定为最优参数 $\\alpha_{\\text{opt}}$。\n\n2. **生产运行与验证：** 为了获得统计上更稳健的结果，使用更多历史数 $N_{\\text{prod}}$ 进行生产运行。计算三种特定情况下的 FOM：\n    - **模拟情况**：$\\alpha = 0$。这代表没有方差缩减时的基线性能。\n    - **最优情况**：$\\alpha = \\alpha_{\\text{opt}}$，由初步研究确定。\n    - **非最优情况**：$\\alpha = \\alpha_{\\text{nonopt}}$。选择初步研究中导致最低 FOM 的候选 $\\alpha$，为不良参数选择提供一个基准。\n\n最后，我们报告关键结果：$\\alpha_{\\text{opt}}$，以及最优、模拟和非最优情况下的生产运行 FOM。我们还确认最优 FOM 严格大于模拟和非最优 FOM，从而证明了优化程序的成功。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_monte_carlo_simulation(sigma_t, L, alpha, N):\n    \"\"\"\n    Performs a Monte Carlo simulation for the 1D shielding problem.\n\n    Args:\n        sigma_t (float): Macroscopic total cross section (cm^-1).\n        L (float): Slab thickness (cm).\n        alpha (float): Path-stretching parameter (cm^-1).\n        N (int): Number of particle histories.\n\n    Returns:\n        tuple: (sample_mean, sample_variance, figure_of_merit)\n    \"\"\"\n    if N  2:\n        return 0.0, 0.0, 0.0\n\n    # For the analog case, alpha=0, the biased rate is the same as the analog\n    # but the logic for weight calculation remains. We handle any floating\n    # point issues if alpha is extremely close to sigma_t.\n    if alpha >= sigma_t:\n        raise ValueError(\"alpha must be strictly less than sigma_t.\")\n\n    biased_rate = sigma_t - alpha\n    \n    # Generate N random path lengths from the biased exponential distribution\n    # scale = 1/lambda, where lambda is the rate.\n    path_lengths = np.random.exponential(scale=1.0/biased_rate, size=N)\n\n    # Identify transmitted particles\n    transmitted_mask = path_lengths >= L\n    transmitted_paths = path_lengths[transmitted_mask]\n\n    # Calculate scores for all histories\n    scores = np.zeros(N)\n    if transmitted_paths.size > 0:\n        # The weight is applied only to transmitted particles\n        weight_factor = sigma_t / biased_rate\n        weights = weight_factor * np.exp(-alpha * transmitted_paths)\n        scores[transmitted_mask] = weights\n\n    # Calculate statistics\n    mu_hat = np.mean(scores)\n\n    # If mu_hat is 0, it means no particles were transmitted (or scores were zero).\n    # In this case, the variance is 0, and the FOM is 0.\n    if mu_hat == 0.0:\n        return 0.0, 0.0, 0.0\n\n    # Unbiased sample variance (ddof=1 for N-1 in denominator)\n    sigma_sq = np.var(scores, ddof=1)\n    \n    # If variance is 0 but mean is not, this implies a perfect estimator (infinite FOM).\n    # This shouldn't happen for this problem with N > 1.\n    if sigma_sq == 0.0:\n        fom = np.inf\n    else:\n        # Relative error squared: R^2 = (sigma/mu)^2 = sigma^2 / mu^2\n        R_sq = sigma_sq / (mu_hat**2)\n        # Figure of Merit: FOM = 1 / (R^2 * N)\n        fom = 1.0 / (R_sq * N)\n\n    return mu_hat, sigma_sq, fom\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    test_cases = [\n        # (Sigma_t, L, N_pilot, N_prod)\n        (1.0, 10.0, 20000, 100000),\n        (0.2, 5.0, 20000, 100000),\n        (2.0, 1.0, 20000, 100000),\n    ]\n\n    alpha_factors = [0.0, 0.2, 0.5, 0.8, 0.95]\n    \n    final_results = []\n\n    for sigma_t, L, n_pilot, n_prod in test_cases:\n        # --- Pilot Study ---\n        pilot_results = {}\n        candidate_alphas = [factor * sigma_t for factor in alpha_factors]\n\n        for alpha in candidate_alphas:\n            _, _, fom = run_monte_carlo_simulation(sigma_t, L, alpha, n_pilot)\n            pilot_results[alpha] = fom\n        \n        # --- Parameter Selection ---\n        # Find optimal alpha (max FOM in pilot run)\n        alpha_opt = max(pilot_results, key=pilot_results.get)\n        \n        # Find a demonstrably non-optimal alpha (min FOM in pilot run)\n        alpha_nonopt = min(pilot_results, key=pilot_results.get)\n\n        # The analog case is always a candidate for comparison\n        alpha_analog = 0.0\n\n        # --- Production Runs ---\n        _, _, fom_opt = run_monte_carlo_simulation(sigma_t, L, alpha_opt, n_prod)\n        _, _, fom_analog = run_monte_carlo_simulation(sigma_t, L, alpha_analog, n_prod)\n        _, _, fom_nonopt = run_monte_carlo_simulation(sigma_t, L, alpha_nonopt, n_prod)\n\n        # --- Validation  Reporting ---\n        opt_gt_analog = fom_opt > fom_analog\n        opt_gt_nonopt = fom_opt > fom_nonopt\n\n        result_for_case = [\n            alpha_opt,\n            fom_opt,\n            fom_analog,\n            fom_nonopt,\n            opt_gt_analog,\n            opt_gt_nonopt\n        ]\n        final_results.append(result_for_case)\n\n    # Format the final output string as specified\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}