{
    "hands_on_practices": [
        {
            "introduction": "Splitting and Russian roulette are the foundational mechanisms for controlling particle populations in Monte Carlo simulations, ensuring computational effort is focused on important regions of the problem space. While these techniques are essential for variance reduction, their application must be carefully designed to avoid introducing excess statistical noise. This practice guides you through the derivation of the optimal parameters for splitting and Russian roulette, revealing the mathematical basis for the standard algorithms used in modern transport codes . By minimizing the variance of the post-event weight, you will prove from first principles why the conventional approach is indeed the most efficient.",
            "id": "4259825",
            "problem": "A neutron of weight $w0$ in a Monte Carlo (MC) reactor core simulation enters a region of higher or lower importance characterized by an importance ratio $m0$ relative to the previous region, defined consistently with the adjoint-weighted flux normalization used in reactor physics. To maintain unbiasedness of tallies after population control, the post-event total weight $W_{\\text{out}}$ must satisfy the constraint $\\mathbb{E}[W_{\\text{out}}]=w$. Consider two variance reduction techniques:\n\n1. Splitting for $m \\geq 1$: The number of offspring $N$ is an integer-valued random variable. Each offspring is assigned weight $w/m$, and the total post-event weight is $W_{\\text{out}}=N\\cdot(w/m)$. The pair $(n,p)$ specifies a two-point distribution for $N$, where $N=n$ with probability $1-p$ and $N=n+1$ with probability $p$, with $n \\in \\mathbb{Z}_{\\ge 0}$ and $p \\in [0,1]$.\n\n2. Russian roulette for $0m1$: The number of offspring $N$ is Bernoulli. The particle is killed with probability $1-p$ or survives as one offspring of weight $w/m$ with probability $p$, giving $W_{\\text{out}}=N\\cdot(w/m)$.\n\nStarting from the unbiasedness requirement $\\mathbb{E}[W_{\\text{out}}]=w$, derive the variance $\\mathrm{Var}(W_{\\text{out}})$ for splitting and for Russian roulette. Then, for a fixed ratio $m0$, determine the optimal pair $(n,p)$ that minimizes the variance of $W_{\\text{out}}$ subject to the unbiasedness constraint. Express the final $(n,p)$ in closed form as a function of $m$. The final answer must be a single analytical expression. No rounding is required and no units are needed.",
            "solution": "The problem requires the derivation of the variance of the post-event weight, $W_{\\text{out}}$, for two variance reduction techniques, splitting and Russian roulette, and the determination of the optimal parameters $(n,p)$ that minimize this variance for any given importance ratio $m0$, subject to an unbiasedness constraint.\n\nFirst, we must validate the problem statement.\n\n**Step 1: Extract Givens**\n- Initial neutron weight: $w0$.\n- Importance ratio: $m0$.\n- Post-event total weight: $W_{\\text{out}} = N \\cdot (w/m)$, where $N$ is the number of offspring.\n- Unbiasedness constraint: $\\mathbb{E}[W_{\\text{out}}]=w$.\n- For both splitting and Russian roulette, the number of offspring $N$ is governed by a two-point probability distribution: $N=n$ with probability $1-p$ and $N=n+1$ with probability $p$.\n- The parameters are constrained: $n \\in \\mathbb{Z}_{\\ge 0}$ and $p \\in [0,1]$.\n- Splitting is the case where $m \\geq 1$.\n- Russian roulette is the case where $0  m  1$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is firmly rooted in the established theory of Monte Carlo methods for particle transport, a core topic in nuclear reactor physics and computational physics. Splitting and Russian roulette are standard, well-documented variance reduction techniques. The use of an unbiased estimator, defined by $\\mathbb{E}[W_{\\text{out}}]=w$, is a fundamental principle.\n- **Well-Posedness**: The problem is clearly stated with all necessary definitions, variables, and constraints. The objective to minimize variance subject to these constraints is a standard optimization problem that leads to a well-defined solution.\n- **Objectivity**: The language is precise and mathematical, free of subjective or ambiguous terminology.\n\nThe problem is scientifically sound, self-contained, and objective. It is a valid, well-posed problem in computational physics.\n\n**Solution Derivation**\nThe problem can be solved by treating splitting and Russian roulette within a single, unified framework defined by the two-point distribution for $N$.\n\n1.  **Imposing the Unbiasedness Constraint**\nThe expectation of the post-event weight is $\\mathbb{E}[W_{\\text{out}}] = \\mathbb{E}[N \\cdot \\frac{w}{m}] = \\frac{w}{m} \\mathbb{E}[N]$.\nThe unbiasedness constraint, $\\mathbb{E}[W_{\\text{out}}] = w$, thus requires that the expected number of offspring be equal to the importance ratio:\n$$ \\mathbb{E}[N] = m $$\nThe number of offspring $N$ follows the distribution $P(N=n)=1-p$ and $P(N=n+1)=p$. The expectation of $N$ is:\n$$ \\mathbb{E}[N] = n \\cdot P(N=n) + (n+1) \\cdot P(N=n+1) = n(1-p) + (n+1)p = n - np + np + p = n+p $$\nEquating this with $m$, we obtain a direct relationship between the parameters $n$, $p$, and the importance ratio $m$:\n$$ n+p = m $$\n\n2.  **Deriving the Variance of $W_{\\text{out}}$**\nThe variance of the post-event weight is given by $\\mathrm{Var}(W_{\\text{out}}) = \\mathrm{Var}(N \\cdot \\frac{w}{m})$. Using the property $\\mathrm{Var}(cX) = c^2\\mathrm{Var}(X)$, we have:\n$$ \\mathrm{Var}(W_{\\text{out}}) = \\left(\\frac{w}{m}\\right)^2 \\mathrm{Var}(N) $$\nTo find $\\mathrm{Var}(N)$, we first compute the second moment, $\\mathbb{E}[N^2]$:\n$$ \\mathbb{E}[N^2] = n^2(1-p) + (n+1)^2 p = n^2 - n^2p + (n^2+2n+1)p = n^2 + 2np + p $$\nThe variance of $N$ is $\\mathrm{Var}(N) = \\mathbb{E}[N^2] - (\\mathbb{E}[N])^2$. Substituting the expressions for $\\mathbb{E}[N^2]$ and $\\mathbb{E}[N]=n+p$:\n$$ \\mathrm{Var}(N) = (n^2 + 2np + p) - (n+p)^2 = (n^2 + 2np + p) - (n^2 + 2np + p^2) = p - p^2 = p(1-p) $$\nThus, the variance of the post-event weight is:\n$$ \\mathrm{Var}(W_{\\text{out}}) = \\left(\\frac{w}{m}\\right)^2 p(1-p) $$\n\n3.  **Minimizing the Variance**\nThe goal is to find the pair $(n,p)$ that minimizes $\\mathrm{Var}(W_{\\text{out}})$ subject to the given constraints:\n1.  $n+p = m$\n2.  $n \\in \\mathbb{Z}_{\\ge 0}$ (i.e., $n$ is a non-negative integer)\n3.  $p \\in [0,1]$ (i.e., $p$ is a valid probability)\n\nFrom constraint (1), we have $p = m - n$. Substituting this into constraint (3), we obtain an inequality for $n$:\n$$ 0 \\le m - n \\le 1 $$\nThis is a compound inequality which can be split into two parts:\n- $m - n \\ge 0 \\implies n \\le m$\n- $m - n \\le 1 \\implies n \\ge m - 1$\n\nCombining these with the constraint that $n$ must be a non-negative integer, we find that $n$ must be a non-negative integer satisfying $m-1 \\le n \\le m$.\n\nLet us analyze the possible integer values for $n$.\n- If $m$ is not an integer, the interval $(m-1, m)$ has a length of $1$ and contains exactly one integer. This integer must be $\\lfloor m \\rfloor$. Therefore, the choice for $n$ is uniquely determined as $n = \\lfloor m \\rfloor$. Consequently, $p$ is also uniquely determined as $p = m - \\lfloor m \\rfloor$. Since this is the only value of $(n,p)$ that satisfies all constraints, it is trivially the optimal solution.\n- If $m$ is an integer, the interval $[m-1, m]$ contains two integers: $n=m-1$ and $n=m$ (assuming $m \\ge 1$, which is true for integer values in the splitting regime).\n    - If we choose $n=m$, then $p = m-m=0$. The variance becomes $\\mathrm{Var}(W_{\\text{out}}) = (\\frac{w}{m})^2 \\cdot 0 \\cdot (1-0) = 0$.\n    - If we choose $n=m-1$, then $p = m-(m-1)=1$. The variance becomes $\\mathrm{Var}(W_{\\text{out}}) = (\\frac{w}{m})^2 \\cdot 1 \\cdot (1-1) = 0$.\nBoth choices yield a variance of $0$, which is the absolute minimum possible. Thus, both are optimal solutions.\n\nThe problem asks for a single analytical expression for the optimal pair $(n,p)$ for any $m0$. The expression $n = \\lfloor m \\rfloor$ provides a valid and optimal choice in all cases. For non-integer $m$, it is the only choice. For integer $m$, it gives $n=m$, which is one of the two zero-variance solutions.\n\nTherefore, the general optimal choice for $n$ is:\n$$ n = \\lfloor m \\rfloor $$\nThe corresponding optimal value for $p$ is determined by the unbiasedness condition $p = m-n$:\n$$ p = m - \\lfloor m \\rfloor $$\nThis single pair of expressions provides the optimal parameters for the entire range $m  0$.\n- For **splittting** ($m \\ge 1$), we have $n = \\lfloor m \\rfloor \\ge 1$.\n- For **Russian roulette** ($0  m  1$), we have $n = \\lfloor m \\rfloor = 0$. This reduces the two-point distribution for $N$ to $P(N=0)=1-p$ and $P(N=1)=p$. With $p=m-0=m$, this becomes $P(N=1)=m$ and $P(N=0)=1-m$, consistent with the standard formulation of Russian roulette where the survival probability is equal to the importance ratio.\n\nThe optimal pair $(n,p)$ is a function of $m$ only.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\lfloor m \\rfloor  m - \\lfloor m \\rfloor \\end{pmatrix} } $$"
        },
        {
            "introduction": "Survival biasing, also known as implicit capture, is a powerful variance reduction technique that prevents the premature termination of particle histories due to absorption. Instead of explicitly removing particles, their statistical weights are reduced, allowing them to contribute to tallies for a longer portion of their simulated lives. This exercise challenges you to analyze the profound impact of survival biasing on the performance of both the collision and track-length estimators . By deriving the variance under both analog transport and survival biasing, you will quantify the efficiency gains and uncover the conditions under which this technique can yield a zero-variance solution for the collision estimator.",
            "id": "4259769",
            "problem": "Consider a one-speed neutron history in an infinite, homogeneous medium characterized by macroscopic absorption cross section $\\Sigma_{a}  0$ and macroscopic scattering cross section $\\Sigma_{s} \\ge 0$, so that the total macroscopic cross section is $\\Sigma_{t} = \\Sigma_{a} + \\Sigma_{s}$. A single neutron of initial statistical weight $1$ is born at an arbitrary location with an isotropic direction. Assume a standard Monte Carlo (MC) free-flight model: segment lengths $\\ell$ are independent and identically distributed with probability density $p(\\ell) = \\Sigma_{t} \\exp(-\\Sigma_{t} \\ell)$, and, in analog transport, each collision is absorption with probability $\\Sigma_{a}/\\Sigma_{t}$ and scattering with probability $\\Sigma_{s}/\\Sigma_{t}$. The scalar flux integrated over all space is tallied using either the collision estimator or the track-length estimator per history, defined as follows:\n\n- Collision estimator: Each collision contributes $w/\\Sigma_{t}$ to the tally, where $w$ is the particle’s current statistical weight at that collision.\n- Track-length estimator: Each free-flight segment contributes $w \\ell$ to the tally, where $w$ is the particle’s current statistical weight during that segment.\n\nNow apply survival biasing (also called implicit capture): at every collision, force a scattering event and reduce the particle’s weight by the factor $c = \\Sigma_{s}/\\Sigma_{t}$, with no termination. Under this scheme, the collision estimator and track-length estimator are modified by the geometric weight sequence $1, c, c^{2}, \\ldots$, applied at successive collisions and the intervening flight segments.\n\nStarting only from the stated free-flight law and event selection probabilities, and using basic probability facts about independent sums and simple discrete distributions, derive for a single history in this infinite medium:\n\n(i) The expectation and variance of the collision estimator and of the track-length estimator under analog transport.\n\n(ii) The expectation and variance of the collision estimator and of the track-length estimator under survival biasing.\n\nThen, form the ratios\n$$\nR_{\\mathrm{TL}} = \\frac{\\operatorname{Var}_{\\mathrm{SB}}(\\Phi_{\\mathrm{TL}})}{\\operatorname{Var}_{\\mathrm{AN}}(\\Phi_{\\mathrm{TL}})}, \n\\qquad\nR_{\\mathrm{C}} = \\frac{\\operatorname{Var}_{\\mathrm{SB}}(\\Phi_{\\mathrm{C}})}{\\operatorname{Var}_{\\mathrm{AN}}(\\Phi_{\\mathrm{C}})},\n$$\nwhere $\\Phi_{\\mathrm{TL}}$ and $\\Phi_{\\mathrm{C}}$ are the per-history track-length and collision flux estimators, respectively, and the subscripts $\\mathrm{SB}$ and $\\mathrm{AN}$ denote survival biasing and analog transport. Express your final answer as a single row matrix whose first entry is $R_{\\mathrm{TL}}$ and whose second entry is $R_{\\mathrm{C}}$, in closed form as analytic functions of $\\Sigma_{a}$ and $\\Sigma_{s}$. No numerical approximation or rounding is required, and no units need be reported.",
            "solution": "The problem statement has been validated and is deemed a well-posed, scientifically grounded problem in the field of Monte Carlo methods for particle transport. We proceed with the derivation.\n\nLet the macroscopic scattering and absorption cross sections be $\\Sigma_s$ and $\\Sigma_a$, respectively. The total cross section is $\\Sigma_t = \\Sigma_a + \\Sigma_s$. The survival probability per collision, which is the probability of scattering, is $c = \\Sigma_s / \\Sigma_t$. The absorption probability is $1-c = \\Sigma_a / \\Sigma_t$. The problem states $\\Sigma_a  0$, which implies $c  1$.\n\nA particle's free-flight segment length, $\\ell$, is a random variable $L$ following an exponential distribution with parameter $\\Sigma_t$. The probability density function is $p(\\ell) = \\Sigma_t \\exp(-\\Sigma_t \\ell)$ for $\\ell \\ge 0$. The expectation and variance of the flight path length are:\n$$\n\\operatorname{E}[L] = \\frac{1}{\\Sigma_t}\n$$\n$$\n\\operatorname{Var}(L) = \\frac{1}{\\Sigma_t^2}\n$$\nFrom this, we can also find the second moment:\n$$\n\\operatorname{E}[L^2] = \\operatorname{Var}(L) + (\\operatorname{E}[L])^2 = \\frac{1}{\\Sigma_t^2} + \\left(\\frac{1}{\\Sigma_t}\\right)^2 = \\frac{2}{\\Sigma_t^2}\n$$\n\n**Part (i): Analog Transport**\n\nIn analog transport, a particle history terminates upon absorption. Let $N$ be the random variable representing the total number of collisions a particle undergoes. The history continues as long as the particle scatters. The probability of scattering at a collision is $c$. The probability of being absorbed at collision $k$ is the probability of surviving the first $k-1$ collisions and then being absorbed at the $k$-th, which is $c^{k-1}(1-c)$.\nThus, $N$ follows a geometric distribution with success parameter $p=1-c$.\nThe probability mass function is $P(N=k) = c^{k-1}(1-c)$ for $k=1, 2, \\ldots$.\nThe expectation and variance of $N$ are:\n$$\n\\operatorname{E}[N] = \\frac{1}{1-c} = \\frac{1}{\\Sigma_a / \\Sigma_t} = \\frac{\\Sigma_t}{\\Sigma_a}\n$$\n$$\n\\operatorname{Var}(N) = \\frac{c}{(1-c)^2} = \\frac{\\Sigma_s / \\Sigma_t}{(\\Sigma_a / \\Sigma_t)^2} = \\frac{\\Sigma_s \\Sigma_t}{\\Sigma_a^2}\n$$\n\n**Analog Collision Estimator ($\\Phi_{\\mathrm{C,AN}}$)**\nIn analog transport, the particle weight $w$ is always $1$. The score from each collision is $1/\\Sigma_t$. For a history with $N$ collisions, the total score is:\n$$\n\\Phi_{\\mathrm{C,AN}} = \\sum_{i=1}^{N} \\frac{1}{\\Sigma_t} = \\frac{N}{\\Sigma_t}\n$$\nThe expectation is:\n$$\n\\operatorname{E}[\\Phi_{\\mathrm{C,AN}}] = \\operatorname{E}\\left[\\frac{N}{\\Sigma_t}\\right] = \\frac{1}{\\Sigma_t} \\operatorname{E}[N] = \\frac{1}{\\Sigma_t} \\frac{\\Sigma_t}{\\Sigma_a} = \\frac{1}{\\Sigma_a}\n$$\nThe variance is:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{C,AN}}) = \\operatorname{Var}\\left(\\frac{N}{\\Sigma_t}\\right) = \\frac{1}{\\Sigma_t^2} \\operatorname{Var}(N) = \\frac{1}{\\Sigma_t^2} \\frac{\\Sigma_s \\Sigma_t}{\\Sigma_a^2} = \\frac{\\Sigma_s}{\\Sigma_t \\Sigma_a^2} = \\frac{\\Sigma_s}{(\\Sigma_a + \\Sigma_s) \\Sigma_a^2}\n$$\n\n**Analog Track-Length Estimator ($\\Phi_{\\mathrm{TL,AN}}$)**\nThe score from each flight segment of length $L_i$ is $w \\ell = \\ell$. A history with $N$ collisions consists of $N$ flight segments $L_1, \\ldots, L_N$. The total score is the sum of these lengths:\n$$\n\\Phi_{\\mathrm{TL,AN}} = \\sum_{i=1}^{N} L_i\n$$\nThis is a sum of a random number of i.i.d. random variables. The expectation is given by Wald's identity:\n$$\n\\operatorname{E}[\\Phi_{\\mathrm{TL,AN}}] = \\operatorname{E}[N] \\operatorname{E}[L] = \\left(\\frac{\\Sigma_t}{\\Sigma_a}\\right) \\left(\\frac{1}{\\Sigma_t}\\right) = \\frac{1}{\\Sigma_a}\n$$\nThe variance is given by the Blackwell-Girshick equation (a consequence of the law of total variance):\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,AN}}) = \\operatorname{E}[N] \\operatorname{Var}(L) + (\\operatorname{E}[L])^2 \\operatorname{Var}(N)\n$$\nSubstituting the known values:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,AN}}) = \\left(\\frac{\\Sigma_t}{\\Sigma_a}\\right) \\left(\\frac{1}{\\Sigma_t^2}\\right) + \\left(\\frac{1}{\\Sigma_t}\\right)^2 \\left(\\frac{\\Sigma_s \\Sigma_t}{\\Sigma_a^2}\\right) = \\frac{1}{\\Sigma_a \\Sigma_t} + \\frac{\\Sigma_s}{\\Sigma_t \\Sigma_a^2}\n$$\nCombining terms with a common denominator $\\Sigma_t \\Sigma_a^2$:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,AN}}) = \\frac{\\Sigma_a}{\\Sigma_t \\Sigma_a^2} + \\frac{\\Sigma_s}{\\Sigma_t \\Sigma_a^2} = \\frac{\\Sigma_a + \\Sigma_s}{\\Sigma_t \\Sigma_a^2} = \\frac{\\Sigma_t}{\\Sigma_t \\Sigma_a^2} = \\frac{1}{\\Sigma_a^2}\n$$\n\n**Part (ii): Survival Biasing**\n\nUnder survival biasing, every collision is forced to be a scatter event, and the particle's weight is reduced. The weight before the $k$-th collision (and during the $k$-th flight segment) is $w_k = c^{k-1}$, starting with $w_1=1$. The history is an infinite sequence of flights and collisions.\n\n**Survival Biasing Collision Estimator ($\\Phi_{\\mathrm{C,SB}}$)**\nThe score at the $k$-th collision is $w_k/\\Sigma_t = c^{k-1}/\\Sigma_t$. The total score is the sum over all (infinite) collisions:\n$$\n\\Phi_{\\mathrm{C,SB}} = \\sum_{k=1}^{\\infty} \\frac{w_k}{\\Sigma_t} = \\sum_{k=1}^{\\infty} \\frac{c^{k-1}}{\\Sigma_t}\n$$\nThis is a deterministic geometric series. As $c  1$, it converges:\n$$\n\\Phi_{\\mathrm{C,SB}} = \\frac{1}{\\Sigma_t} \\sum_{j=0}^{\\infty} c^j = \\frac{1}{\\Sigma_t} \\frac{1}{1-c} = \\frac{1}{\\Sigma_t} \\frac{1}{\\Sigma_a/\\Sigma_t} = \\frac{1}{\\Sigma_a}\n$$\nSince the score for any history is a constant value $1/\\Sigma_a$, the estimator is free of statistical fluctuation.\nThe expectation is:\n$$\n\\operatorname{E}[\\Phi_{\\mathrm{C,SB}}] = \\operatorname{E}\\left[\\frac{1}{\\Sigma_a}\\right] = \\frac{1}{\\Sigma_a}\n$$\nThe variance is:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{C,SB}}) = \\operatorname{Var}\\left(\\frac{1}{\\Sigma_a}\\right) = 0\n$$\n\n**Survival Biasing Track-Length Estimator ($\\Phi_{\\mathrm{TL,SB}}$)**\nThe score from the $k$-th flight segment of length $L_k$ is $w_k L_k = c^{k-1}L_k$. The total score is the sum over all segments:\n$$\n\\Phi_{\\mathrm{TL,SB}} = \\sum_{k=1}^{\\infty} w_k L_k = \\sum_{k=1}^{\\infty} c^{k-1} L_k\n$$\nwhere the $L_k$ are i.i.d. exponential random variables. The expectation is:\n$$\n\\operatorname{E}[\\Phi_{\\mathrm{TL,SB}}] = \\operatorname{E}\\left[\\sum_{k=1}^{\\infty} c^{k-1} L_k\\right] = \\sum_{k=1}^{\\infty} c^{k-1} \\operatorname{E}[L_k] = \\operatorname{E}[L] \\sum_{k=1}^{\\infty} c^{k-1} = \\frac{1}{\\Sigma_t} \\frac{1}{1-c} = \\frac{1}{\\Sigma_a}\n$$\nSince the terms in the sum are independent random variables, the variance of the sum is the sum of the variances:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,SB}}) = \\operatorname{Var}\\left(\\sum_{k=1}^{\\infty} c^{k-1} L_k\\right) = \\sum_{k=1}^{\\infty} \\operatorname{Var}(c^{k-1} L_k) = \\sum_{k=1}^{\\infty} (c^{k-1})^2 \\operatorname{Var}(L_k)\n$$\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,SB}}) = \\operatorname{Var}(L) \\sum_{k=1}^{\\infty} (c^2)^{k-1} = \\frac{1}{\\Sigma_t^2} \\sum_{j=0}^{\\infty} (c^2)^j\n$$\nThe series is a geometric series with ratio $c^2  1$, so it converges:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,SB}}) = \\frac{1}{\\Sigma_t^2} \\frac{1}{1-c^2} = \\frac{1}{\\Sigma_t^2(1 - (\\Sigma_s/\\Sigma_t)^2)} = \\frac{1}{\\Sigma_t^2 - \\Sigma_s^2}\n$$\nUsing $\\Sigma_t = \\Sigma_a + \\Sigma_s$, the denominator becomes:\n$$\n\\Sigma_t^2 - \\Sigma_s^2 = (\\Sigma_a+\\Sigma_s)^2 - \\Sigma_s^2 = \\Sigma_a^2 + 2\\Sigma_a\\Sigma_s + \\Sigma_s^2 - \\Sigma_s^2 = \\Sigma_a^2 + 2\\Sigma_a\\Sigma_s = \\Sigma_a(\\Sigma_a + 2\\Sigma_s)\n$$\nTherefore, the variance is:\n$$\n\\operatorname{Var}(\\Phi_{\\mathrm{TL,SB}}) = \\frac{1}{\\Sigma_a(\\Sigma_a + 2\\Sigma_s)}\n$$\n\n**Part (iii): Variance Ratios**\n\nWe now form the required ratios using the variances derived above.\n\nRatio for the track-length estimator:\n$$\nR_{\\mathrm{TL}} = \\frac{\\operatorname{Var}_{\\mathrm{SB}}(\\Phi_{\\mathrm{TL}})}{\\operatorname{Var}_{\\mathrm{AN}}(\\Phi_{\\mathrm{TL}})} = \\frac{1 / (\\Sigma_a(\\Sigma_a + 2\\Sigma_s))}{1 / \\Sigma_a^2} = \\frac{\\Sigma_a^2}{\\Sigma_a(\\Sigma_a + 2\\Sigma_s)} = \\frac{\\Sigma_a}{\\Sigma_a + 2\\Sigma_s}\n$$\n\nRatio for the collision estimator:\n$$\nR_{\\mathrm{C}} = \\frac{\\operatorname{Var}_{\\mathrm{SB}}(\\Phi_{\\mathrm{C}})}{\\operatorname{Var}_{\\mathrm{AN}}(\\Phi_{\\mathrm{C}})} = \\frac{0}{\\Sigma_s / ((\\Sigma_a + \\Sigma_s) \\Sigma_a^2)}\n$$\nGiven $\\Sigma_a  0$. If $\\Sigma_s  0$, the denominator is non-zero, so $R_{\\mathrm{C}} = 0$. If $\\Sigma_s = 0$, the numerator and denominator are both $0$. However, the expression must apply for all $\\Sigma_s \\ge 0$. As $\\Sigma_s \\to 0^+$, the ratio remains $0$. Thus, we define $R_{\\mathrm{C}} = 0$ for all valid parameters.\n\nThe final results for the ratios are $R_{\\mathrm{TL}} = \\frac{\\Sigma_a}{\\Sigma_a + 2\\Sigma_s}$ and $R_{\\mathrm{C}} = 0$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{\\Sigma_a}{\\Sigma_a + 2\\Sigma_s}  0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Weight windows are a cornerstone of modern variance reduction, providing an automated framework for applying splitting and Russian roulette across a problem's phase space. However, if not carefully configured, they can inadvertently cause statistical instabilities by creating large, correlated families of particles through excessive splitting. This practice frames this issue through the lens of a branching process, a powerful mathematical tool for modeling population dynamics . Your task is to derive a critical stability condition on the weight window's span, providing a practical rule of thumb to prevent such branching explosions and ensure the statistical reliability of your simulation.",
            "id": "4259814",
            "problem": "Consider a neutron transport Monte Carlo (MC) eigenvalue simulation in a heterogeneous reactor core where Weight Windows (WW) are applied to accelerate convergence of tallies in selected regions by controlling particle weights. In each spatial-energy cell, the WW is specified by a minimum allowed weight $w_{\\min}$ and a maximum allowed weight $w_{\\max}$, and the span is $S = w_{\\max}/w_{\\min}$. When a particle’s weight $w$ falls outside the local window, splitting or Russian Roulette (RR) is applied to bring the weight back into the window while conserving expected weight. Assume the target post-adjustment weight in a cell is the geometric mean $w^{*} = \\sqrt{w_{\\min} w_{\\max}}$.\n\nModel the effect of WW-induced splitting along a track as a branching process: when a particle transitions from a cell with target weight $w^{*}_{j}$ to a neighboring cell with target weight $w^{*}_{j+1}$, define the local importance ratio $R = w^{*}_{j}/w^{*}_{j+1}$. If $w_{\\text{in}} = w^{*}_{j}$ is the incoming weight, splitting is triggered in the new cell if $w_{\\text{in}}  w_{\\max,j+1}$, and, when splitting occurs, the expected number of children is $n \\approx w_{\\text{in}}/w^{*}_{j+1} = R$ with each child set to weight $w^{*}_{j+1}$. Otherwise, no splitting occurs and the reproduction is $n = 1$. Assume the MC transport between successive window applications does not alter the weight except through WW operations, and use the Galton–Watson (GW) branching-process heuristic that repeated supercritical reproduction along a path leads to branching explosion and long-tailed autocorrelation in tallies due to sibling genealogies.\n\nLet $b  1$ denote the typical importance jump ratio encountered at window boundaries along dominant contributing paths, i.e., $R \\approx b$ at those boundaries. Derive, from first principles of WW operations and branching-process stability, a condition on the span $S = w_{\\max}/w_{\\min}$ that prevents explosive growth in the number of particle branches and mitigates long-range autocorrelation (interpreted as keeping the effective reproduction at such boundaries at or below $n = 1$). Report the critical span $S_{\\text{crit}}$ as a single closed-form analytic expression in terms of $b$, such that choosing $S \\ge S_{\\text{crit}}$ avoids the branching explosion at boundaries with ratio $R \\approx b$. Express the final answer as a dimensionless analytic expression with no units. No numerical rounding is required.",
            "solution": "The problem requires the derivation of a condition on the weight window span, $S$, to prevent explosive growth in particle branches during a Monte Carlo simulation. This phenomenon is modeled as a branching process, and its mitigation is framed as preventing particle splitting at the boundaries between spatial-energy cells.\n\nWe begin by formalizing the conditions provided in the problem statement.\n\nThe weight window in a given cell is defined by a minimum weight, $w_{\\min}$, and a maximum weight, $w_{\\max}$. The span of this window is given by the ratio:\n$$S = \\frac{w_{\\max}}{w_{\\min}}$$\n\nThe target weight for a particle within this cell, after any weight adjustment (splitting or Russian Roulette), is the geometric mean of the window bounds:\n$$w^{*} = \\sqrt{w_{\\min} w_{\\max}}$$\n\nWe can express the window bounds, $w_{\\min}$ and $w_{\\max}$, in terms of the target weight $w^{*}$ and the span $S$. From the definition of $w^{*}$, we have $(w^{*})^2 = w_{\\min} w_{\\max}$. From the definition of $S$, we have $w_{\\min} = w_{\\max}/S$. Substituting this into the expression for $(w^{*})^2$:\n$$(w^{*})^2 = \\left(\\frac{w_{\\max}}{S}\\right) w_{\\max} = \\frac{w_{\\max}^2}{S}$$\nSolving for $w_{\\max}$ (since weights and spans are positive), we get:\n$$w_{\\max} = w^{*} \\sqrt{S}$$\nSimilarly, we can solve for $w_{\\min}$:\n$$(w^{*})^2 = w_{\\min} (w_{\\min} S) = w_{\\min}^2 S$$\n$$w_{\\min} = \\frac{w^{*}}{\\sqrt{S}}$$\n\nThe problem models a particle transitioning from a cell $j$ to a neighboring cell $j+1$. The particle's weight upon entering cell $j+1$, denoted $w_{\\text{in}}$, is assumed to be the target weight of the previous cell, $w^{*}_{j}$.\n$$w_{\\text{in}} = w^{*}_{j}$$\n\nThe problem states that repeated supercritical reproduction, which leads to branching explosions and long-tailed autocorrelation, is to be avoided. This is interpreted as keeping the effective reproduction number, $n$, at or below $1$. According to the problem's model, reproduction occurs via splitting if the incoming particle's weight exceeds the maximum allowed weight in the new cell. If $w_{\\text{in}}  w_{\\max, j+1}$, splitting occurs and $n \\approx R  1$. If $w_{\\text{in}} \\le w_{\\max, j+1}$, no splitting occurs and $n=1$.\n\nTherefore, to prevent the branching explosion, we must ensure that the condition for splitting is not met. The condition to prevent splitting is:\n$$w_{\\text{in}} \\le w_{\\max, j+1}$$\n\nSubstituting $w_{\\text{in}} = w^{*}_{j}$, the condition becomes:\n$$w^{*}_{j} \\le w_{\\max, j+1}$$\n\nThe problem defines the local importance ratio at the boundary as $R = w^{*}_{j} / w^{*}_{j+1}$. For dominant contributing paths, this ratio is given as $R \\approx b$, where $b  1$. We use this to relate the target weights of the two adjacent cells:\n$$w^{*}_{j} = b \\cdot w^{*}_{j+1}$$\n\nNow, we substitute this expression for $w^{*}_{j}$ into our inequality:\n$$b \\cdot w^{*}_{j+1} \\le w_{\\max, j+1}$$\n\nNext, we express $w_{\\max, j+1}$ in terms of the parameters of cell $j+1$, namely its target weight $w^{*}_{j+1}$ and its span $S$. As derived earlier, the relationship is $w_{\\max, j+1} = w^{*}_{j+1} \\sqrt{S}$. The span $S$ is assumed to be a global parameter or at least the value for the destination cell $j+1$.\n\nSubstituting this into the inequality gives:\n$$b \\cdot w^{*}_{j+1} \\le w^{*}_{j+1} \\sqrt{S}$$\n\nSince $w^{*}_{j+1}$ represents a particle weight, it is a positive quantity, $w^{*}_{j+1}  0$. We can divide both sides of the inequality by $w^{*}_{j+1}$ without changing the direction of the inequality sign:\n$$b \\le \\sqrt{S}$$\n\nThe problem asks for a condition on the span $S$. To isolate $S$, we square both sides of the inequality. Since both $b$ and $\\sqrt{S}$ are positive ($b  1$ is given), this operation is valid and preserves the inequality:\n$$b^2 \\le S$$\nor equivalently,\n$$S \\ge b^2$$\n\nThis inequality represents the condition on the span $S$ that must be satisfied to prevent splitting when a particle traverses a boundary with an importance jump ratio of $b$. The problem asks for the critical span $S_{\\text{crit}}$ such that choosing $S \\ge S_{\\text{crit}}$ avoids the branching explosion. This corresponds to the minimum value of $S$ that satisfies the condition. From the inequality $S \\ge b^2$, the critical value is the lower bound of the acceptable range for $S$.\n\nTherefore, the critical span is:\n$$S_{\\text{crit}} = b^2$$\nChoosing a weight window span $S$ equal to or greater than $b^2$ ensures that a particle with weight $w^{*}_{j}$ entering a cell of higher importance (where the target weight is $w^{*}_{j+1} = w^{*}_{j}/b$) will have a weight below the upper weight bound $w_{\\max, j+1}$ of the new cell, thus avoiding splitting and the associated branching explosion.",
            "answer": "$$\\boxed{b^{2}}$$"
        }
    ]
}