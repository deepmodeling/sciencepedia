{
    "hands_on_practices": [
        {
            "introduction": "The foundation of Variational Nodal Methods (VNM) is the approximation of the continuous neutron flux within a coarse mesh cell, or \"node,\" using a basis of functions, often orthogonal polynomials. This exercise demonstrates the crucial link between the abstract coefficients of a polynomial expansion and the physically meaningful moments of the flux, such as cell-average flux and face-average currents. By working through this problem, you will gain hands-on practice in determining these coefficients from known physical constraints, a fundamental skill in understanding how VNM models the reactor state.",
            "id": "4260107",
            "problem": "Consider a single homogeneous rectangular node in a two-dimensional (2D) one-energy-group (1G) neutron diffusion model, as used in the Variational Nodal Method (VNM). Let the local (dimensionless) spatial coordinates be $x \\in [-1,1]$ and $y \\in [-1,1]$. Within the node, approximate the scalar flux $\\phi(x,y)$ by a quadratic Legendre polynomial expansion truncated to the following separable basis without cross terms:\n$$\n\\phi(x,y) = a_{00} P_{0}(x)P_{0}(y) + a_{10} P_{1}(x)P_{0}(y) + a_{01} P_{0}(x)P_{1}(y) + a_{20} P_{2}(x)P_{0}(y) + a_{02} P_{0}(x)P_{2}(y),\n$$\nwhere $P_{0}(z) = 1$, $P_{1}(z) = z$, and $P_{2}(z) = \\frac{3z^{2} - 1}{2}$ are the first three Legendre polynomials on $[-1,1]$, and $a_{00}$, $a_{10}$, $a_{01}$, $a_{20}$, $a_{02}$ are constant coefficients to be determined.\n\nDefine the cell-average flux by\n$$\n\\bar{\\phi} = \\frac{1}{4} \\int_{-1}^{1}\\int_{-1}^{1} \\phi(x,y)\\,dx\\,dy,\n$$\nand face-averaged fluxes by\n$$\n\\bar{\\phi}_{x\\pm} = \\frac{1}{2} \\int_{-1}^{1} \\phi(\\pm 1, y)\\,dy, \\qquad \\bar{\\phi}_{y\\pm} = \\frac{1}{2} \\int_{-1}^{1} \\phi(x, \\pm 1)\\,dx.\n$$\n\nIn the VNM transverse-integrated 1D equations, the transverse leakage functions are defined by\n$$\nL_{x}(y) = -D \\,\\frac{1}{2}\\int_{-1}^{1} \\frac{\\partial^{2}\\phi(x,y)}{\\partial y^{2}}\\,dx, \\qquad\nL_{y}(x) = -D \\,\\frac{1}{2}\\int_{-1}^{1} \\frac{\\partial^{2}\\phi(x,y)}{\\partial x^{2}}\\,dy,\n$$\nwhere $D$ is the diffusion coefficient. In this node, let $D = 1$ and suppose the transverse leakage functions are specified to be spatially constant and equal to\n$$\nL_{x}(y) = -0.9, \\qquad L_{y}(x) = -0.6.\n$$\n\nYou are given the following data for the flux moments:\n- Cell-average flux: $\\bar{\\phi} = 1.10$.\n- Face-average fluxes: $\\bar{\\phi}_{x+} = 1.45$, $\\bar{\\phi}_{x-} = 1.15$, $\\bar{\\phi}_{y+} = 1.45$, $\\bar{\\phi}_{y-} = 1.35$.\n\nStarting from the definitions above and properties of Legendre polynomials, compute the coefficients $a_{00}$, $a_{10}$, $a_{01}$, $a_{20}$, and $a_{02}$ such that the quadratic Legendre expansion reproduces the given cell-average, face-averages, and the specified transverse leakage functions exactly. Express your final answer as a single row matrix containing the five coefficients in the order $(a_{00}, a_{10}, a_{01}, a_{20}, a_{02})$. Use exact values; no rounding is required.",
            "solution": "The user wants to find the coefficients of a quadratic Legendre polynomial expansion for the neutron flux in a 2D nodal method context. The problem is deemed valid as it is scientifically grounded in nuclear reactor physics, well-posed with a consistent and complete set of data, and uses objective, formal language. The provided data yields a unique solution for the requested coefficients.\n\nWe are given the flux expansion within a single homogeneous node:\n$$\n\\phi(x,y) = a_{00} P_{0}(x)P_{0}(y) + a_{10} P_{1}(x)P_{0}(y) + a_{01} P_{0}(x)P_{1}(y) + a_{20} P_{2}(x)P_{0}(y) + a_{02} P_{0}(x)P_{2}(y)\n$$\nwith Legendre polynomials $P_{0}(z) = 1$, $P_{1}(z) = z$, and $P_{2}(z) = \\frac{3z^{2} - 1}{2}$. Our goal is to determine the coefficients $a_{00}$, $a_{10}$, $a_{01}$, $a_{20}$, and $a_{02}$ using the provided data.\n\nFirst, we establish relationships between the given quantities (cell-average flux, face-average fluxes, and transverse leakages) and the unknown coefficients. We will use the orthogonality property of Legendre polynomials, specifically the integral $\\int_{-1}^{1} P_n(z) dz = \\int_{-1}^{1} P_n(z) P_0(z) dz = 2 \\delta_{n0}$, where $\\delta_{n0}$ is the Kronecker delta.\n\n1.  **Cell-Average Flux $\\bar{\\phi}$**\n    The cell-average flux is defined as:\n    $$\n    \\bar{\\phi} = \\frac{1}{4} \\int_{-1}^{1}\\int_{-1}^{1} \\phi(x,y)\\,dx\\,dy\n    $$\n    Substituting the expansion for $\\phi(x,y)$ and integrating term by term:\n    $$\n    \\bar{\\phi} = \\frac{1}{4} \\sum_{i,j} a_{ij} \\int_{-1}^{1} P_i(x) dx \\int_{-1}^{1} P_j(y) dy\n    $$\n    where the sum is over the pairs $(i,j) \\in \\{(0,0), (1,0), (0,1), (2,0), (0,2)\\}$. The integrals are non-zero only for $i=0$ and $j=0$. Thus, only the $a_{00}$ term survives.\n    $$\n    \\bar{\\phi} = \\frac{1}{4} a_{00} \\left(\\int_{-1}^{1} P_0(x)dx\\right) \\left(\\int_{-1}^{1} P_0(y)dy\\right) = \\frac{1}{4} a_{00} (2)(2) = a_{00}\n    $$\n    Given $\\bar{\\phi} = 1.10$, we have our first coefficient:\n    $$\n    a_{00} = 1.10\n    $$\n\n2.  **Face-Averaged Fluxes $\\bar{\\phi}_{x\\pm}$**\n    The face-averaged fluxes on the faces at $x = \\pm 1$ are:\n    $$\n    \\bar{\\phi}_{x\\pm} = \\frac{1}{2} \\int_{-1}^{1} \\phi(\\pm 1, y)\\,dy\n    $$\n    We evaluate $\\phi(\\pm 1, y)$ using $P_0(\\pm 1)=1$, $P_1(\\pm 1)=\\pm 1$, and $P_2(\\pm 1)=1$:\n    $$\n    \\phi(\\pm 1, y) = a_{00}P_0(y) \\pm a_{10}P_0(y) + a_{01}P_1(y) + a_{20}P_0(y) + a_{02}P_2(y)\n    $$\n    $$\n    \\phi(\\pm 1, y) = (a_{00} \\pm a_{10} + a_{20})P_0(y) + a_{01}P_1(y) + a_{02}P_2(y)\n    $$\n    Integrating over $y \\in [-1,1]$ causes terms with $P_1(y)$ and $P_2(y)$ to vanish:\n    $$\n    \\bar{\\phi}_{x\\pm} = \\frac{1}{2} (a_{00} \\pm a_{10} + a_{20}) \\int_{-1}^{1} P_0(y) dy = \\frac{1}{2} (a_{00} \\pm a_{10} + a_{20}) (2) = a_{00} \\pm a_{10} + a_{20}\n    $$\n    This yields a system of two equations:\n    $$\n    \\bar{\\phi}_{x+} = a_{00} + a_{10} + a_{20} = 1.45\n    $$\n    $$\n    \\bar{\\phi}_{x-} = a_{00} - a_{10} + a_{20} = 1.15\n    $$\n\n3.  **Face-Averaged Fluxes $\\bar{\\phi}_{y\\pm}$**\n    By symmetry, for the faces at $y = \\pm 1$:\n    $$\n    \\bar{\\phi}_{y\\pm} = a_{00} \\pm a_{01} + a_{02}\n    $$\n    This yields another system of two equations:\n    $$\n    \\bar{\\phi}_{y+} = a_{00} + a_{01} + a_{02} = 1.45\n    $$\n    $$\n    \\bar{\\phi}_{y-} = a_{00} - a_{01} + a_{02} = 1.35\n    $$\n\n4.  **Transverse Leakages $L_x(y)$ and $L_y(x)$**\n    The transverse leakage in the $y$-direction is:\n    $$\n    L_y(x) = -D \\frac{1}{2} \\int_{-1}^{1} \\frac{\\partial^2\\phi(x,y)}{\\partial x^2} dy\n    $$\n    First, we find the second derivative of $\\phi$ with respect to $x$. Note that $P_0''(x) = 0$, $P_1''(x)=0$, and $P_2''(x) = \\frac{d^2}{dx^2}(\\frac{3x^2-1}{2}) = 3$.\n    $$\n    \\frac{\\partial^2\\phi}{\\partial x^2} = a_{20} P_2''(x) P_0(y) = 3 a_{20} P_0(y)\n    $$\n    Substituting this into the leakage definition:\n    $$\n    L_y(x) = -D \\frac{3 a_{20}}{2} \\int_{-1}^{1} P_0(y) dy = -D \\frac{3 a_{20}}{2} (2) = -3 D a_{20}\n    $$\n    Given $D=1$ and $L_y(x) = -0.6$, we can find $a_{20}$:\n    $$\n    -0.6 = -3(1)a_{20} \\implies a_{20} = \\frac{0.6}{3} = 0.2\n    $$\n    By symmetry, the transverse leakage in the $x$-direction is:\n    $$\n    L_x(y) = -3 D a_{02}\n    $$\n    Given $L_x(y) = -0.9$, we find $a_{02}$:\n    $$\n    -0.9 = -3(1)a_{02} \\implies a_{02} = \\frac{0.9}{3} = 0.3\n    $$\n\nNow we have determined $a_{00} = 1.10$, $a_{20} = 0.2$, and $a_{02} = 0.3$. We can use these values to find $a_{10}$ and $a_{01}$.\n\nFrom the $\\bar{\\phi}_{x\\pm}$ equations, subtracting the second from the first gives:\n$$\n\\bar{\\phi}_{x+} - \\bar{\\phi}_{x-} = (a_{00} + a_{10} + a_{20}) - (a_{00} - a_{10} + a_{20}) = 2 a_{10}\n$$\n$$\na_{10} = \\frac{\\bar{\\phi}_{x+} - \\bar{\\phi}_{x-}}{2} = \\frac{1.45 - 1.15}{2} = \\frac{0.30}{2} = 0.15\n$$\n\nFrom the $\\bar{\\phi}_{y\\pm}$ equations, a similar subtraction gives:\n$$\n\\bar{\\phi}_{y+} - \\bar{\\phi}_{y-} = (a_{00} + a_{01} + a_{02}) - (a_{00} - a_{01} + a_{02}) = 2 a_{01}\n$$\n$$\na_{01} = \\frac{\\bar{\\phi}_{y+} - \\bar{\\phi}_{y-}}{2} = \\frac{1.45 - 1.35}{2} = \\frac{0.10}{2} = 0.05\n$$\n\nThe five coefficients are therefore:\n$a_{00} = 1.10$\n$a_{10} = 0.15$\n$a_{01} = 0.05$\n$a_{20} = 0.2$\n$a_{02} = 0.3$\n\nThe final answer is the set of these coefficients arranged in a row matrix as specified.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 1.1 & 0.15 & 0.05 & 0.2 & 0.3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "A key strength of nodal methods is their ability to maintain global neutron balance, a property inherited from the underlying transport equation. This exercise delves into the mechanism of nodal coupling using the concept of partial currents, which describe the flow of neutrons into and out of a node across its faces. You will calculate the net leakage from a node and, more importantly, verify that the interface conditions between two adjacent nodes ensure that every neutron leaving one node is perfectly accounted for as it enters the next, guaranteeing conservation.",
            "id": "4260120",
            "problem": "Consider a one-energy-group, steady-state neutron transport model for a Cartesian discretization used in the Variational Nodal Method (VNM) in nuclear reactor simulation. Let a node be a rectangular prism of unit thickness whose four lateral faces have equal area. For each face, define the outward unit normal as $\\mathbf{n}_f$ pointing out of the node, and define the face-averaged half-range (partial) currents\n$$\nj^{+}_{f} \\equiv \\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f > 0} (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi(\\mathbf{r},\\mathbf{\\Omega}) \\,\\mathrm{d}\\Omega\\,\\mathrm{d}A, \\quad\nj^{-}_{f} \\equiv \\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0} |\\mathbf{\\Omega}\\cdot\\mathbf{n}_f|\\,\\psi(\\mathbf{r},\\mathbf{\\Omega}) \\,\\mathrm{d}\\Omega\\,\\mathrm{d}A,\n$$\nwhere $\\psi(\\mathbf{r},\\mathbf{\\Omega})$ is the angular neutron flux, $A_f$ is the face area, and $\\mathbf{\\Omega}$ is the direction unit vector.\n\nYou are given two adjacent nodes, $\\mathcal{N}_1$ and $\\mathcal{N}_2$, that share a vertical face. Each lateral face has area $A_f = 100$ (square centimeters), and the node thickness is $1$ (centimeter), so the face-integrated net current across face $f$ of node $\\mathcal{N}_i$ is $A_f\\left(j^{+}_{i,f} - j^{-}_{i,f}\\right)$ in neutrons per second. For node $\\mathcal{N}_1$, the face-averaged partial currents (in neutrons per square centimeter per second) are specified as:\n$$\nj^{+}_{1,W} = 1.80, \\quad j^{-}_{1,W} = 2.10, \\quad\nj^{+}_{1,E} = 4.20, \\quad j^{-}_{1,E} = 5.00,\n$$\n$$\nj^{+}_{1,N} = 3.50, \\quad j^{-}_{1,N} = 3.40, \\quad\nj^{+}_{1,S} = 2.75, \\quad j^{-}_{1,S} = 2.55.\n$$\nThe shared face is the east face of $\\mathcal{N}_1$ and the west face of $\\mathcal{N}_2$. By interface coupling and consistent orientation, the outgoing partial current from $\\mathcal{N}_1$ across the shared face equals the incoming partial current to $\\mathcal{N}_2$ across that face, and vice versa:\n$$\nj^{+}_{1,E} = j^{-}_{2,W}, \\qquad j^{-}_{1,E} = j^{+}_{2,W}.\n$$\n\nStarting from the steady-state neutron balance and the divergence theorem, derive the expression for the net leakage $L_1$ from node $\\mathcal{N}_1$ in terms of its face-averaged partial currents and areas, then compute $L_1$ using the given data. Next, verify global conservation across the shared interface by computing the interface conservation residual\n$$\nR \\equiv A_f\\Big[\\big(j^{+}_{1,E} - j^{-}_{1,E}\\big) + \\big(j^{+}_{2,W} - j^{-}_{2,W}\\big)\\Big]\n$$\nusing the coupling equalities above.\n\nExpress both $L_1$ and $R$ in neutrons per second. The final answer must be the ordered pair $\\big(L_1,\\,R\\big)$ written as a single row matrix. No rounding is required.",
            "solution": "The problem is validated as self-contained, scientifically grounded, and well-posed. All necessary data and definitions for the one-group, steady-state neutron transport model are provided. The concepts of partial currents, net leakage, and interface coupling are standard in nodal methods for nuclear reactor analysis.\n\nFirst, we derive the expression for the net leakage $L_1$ from node $\\mathcal{N}_1$. The net leakage is defined as the total number of neutrons flowing out of the node's volume per unit time. This is given by the integral of the net current vector $\\mathbf{J}(\\mathbf{r})$ over the entire surface $\\partial V_1$ of the node.\n$$\nL_1 = \\oint_{\\partial V_1} \\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{n} \\, \\mathrm{d}A\n$$\nwhere $\\mathbf{n}$ is the outward unit normal vector on the surface element $\\mathrm{d}A$. The net current vector is defined as the angular integral of the direction vector $\\mathbf{\\Omega}$ weighted by the angular flux $\\psi(\\mathbf{r}, \\mathbf{\\Omega})$:\n$$\n\\mathbf{J}(\\mathbf{r}) = \\int_{4\\pi} \\mathbf{\\Omega} \\psi(\\mathbf{r}, \\mathbf{\\Omega}) \\, \\mathrm{d}\\Omega\n$$\nThe surface integral can be expressed as a sum over the faces of the node. For a one-group, 2D Cartesian model, we consider the four lateral faces: East ($E$), West ($W$), North ($N$), and South ($S$).\n$$\nL_1 = \\sum_{f \\in \\{E,W,N,S\\}} \\int_{A_f} \\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{n}_f \\, \\mathrm{d}A\n$$\nwhere $\\mathbf{n}_f$ is the outward normal for face $f$. The term $\\int_{A_f} \\mathbf{J}(\\mathbf{r}) \\cdot \\mathbf{n}_f \\, \\mathrm{d}A$ is the face-integrated net current across face $f$. Let's relate this to the given face-averaged partial currents, $j^{+}_{f}$ and $j^{-}_{f}$.\n\nThe face-averaged net current for face $f$ is given by:\n$$\n\\bar{J}_f = \\frac{1}{A_f} \\int_{A_f} \\left( \\int_{4\\pi} \\mathbf{\\Omega} \\cdot \\mathbf{n}_f \\psi(\\mathbf{r}, \\mathbf{\\Omega}) \\, \\mathrm{d}\\Omega \\right) \\mathrm{d}A\n$$\nWe can split the angular integral over two hemispheres: one where neutrons move outward ($\\mathbf{\\Omega} \\cdot \\mathbf{n}_f > 0$) and one where they move inward ($\\mathbf{\\Omega} \\cdot \\mathbf{n}_f < 0$).\n$$\n\\bar{J}_f = \\frac{1}{A_f} \\int_{A_f} \\left( \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f > 0} (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi\\,\\mathrm{d}\\Omega + \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0} (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi\\,\\mathrm{d}\\Omega \\right) \\mathrm{d}A\n$$\nThe first term is, by definition, the face-averaged outgoing partial current, $j^{+}_{f}$:\n$$\nj^{+}_{f} = \\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f > 0} (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi(\\mathbf{r},\\mathbf{\\Omega}) \\,\\mathrm{d}\\Omega\\,\\mathrm{d}A\n$$\nThe second term can be related to the face-averaged incoming partial current, $j^{-}_{f}$. The definition given is:\n$$\nj^{-}_{f} = \\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0} |\\mathbf{\\Omega}\\cdot\\mathbf{n}_f|\\,\\psi(\\mathbf{r},\\mathbf{\\Omega}) \\,\\mathrm{d}\\Omega\\,\\mathrm{d}A\n$$\nFor the inward hemisphere where $\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0$, we have $|\\mathbf{\\Omega}\\cdot\\mathbf{n}_f| = -(\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)$. Therefore:\n$$\nj^{-}_{f} = \\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0} -(\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi\\,\\mathrm{d}\\Omega\\,\\mathrm{d}A = -\\frac{1}{A_f} \\int_{A_f} \\int_{\\mathbf{\\Omega}\\cdot\\mathbf{n}_f < 0} (\\mathbf{\\Omega}\\cdot\\mathbf{n}_f)\\,\\psi\\,\\mathrm{d}\\Omega\\,\\mathrm{d}A\n$$\nThus, the second term in the expression for $\\bar{J}_f$ is equal to $-j^{-}_{f}$. The face-averaged net current is:\n$$\n\\bar{J}_f = j^{+}_{f} - j^{-}_{f}\n$$\nThe face-integrated net current across face $f$ is $A_f \\bar{J}_f = A_f(j^{+}_{f} - j^{-}_{f})$. The total net leakage $L_1$ is the sum of these quantities over all four faces of node $\\mathcal{N}_1$:\n$$\nL_1 = A_f(j^{+}_{1,E} - j^{-}_{1,E}) + A_f(j^{+}_{1,W} - j^{-}_{1,W}) + A_f(j^{+}_{1,N} - j^{-}_{1,N}) + A_f(j^{+}_{1,S} - j^{-}_{1,S})\n$$\nThis is the required expression. Now we compute its value using the given data for node $\\mathcal{N}_1$: $A_f = 100$ cm$^2$, and the partial currents are in neutrons/(cm$^2 \\cdot$s).\n\nContribution from each face:\n- East face: $j^{+}_{1,E} - j^{-}_{1,E} = 4.20 - 5.00 = -0.80$\n- West face: $j^{+}_{1,W} - j^{-}_{1,W} = 1.80 - 2.10 = -0.30$\n- North face: $j^{+}_{1,N} - j^{-}_{1,N} = 3.50 - 3.40 = 0.10$\n- South face: $j^{+}_{1,S} - j^{-}_{1,S} = 2.75 - 2.55 = 0.20$\n\nSumming the face-averaged net currents:\n$$\n\\sum_f (j^{+}_{1,f} - j^{-}_{1,f}) = (-0.80) + (-0.30) + (0.10) + (0.20) = -0.80\n$$\nNow, we calculate the total net leakage $L_1$:\n$$\nL_1 = A_f \\sum_f (j^{+}_{1,f} - j^{-}_{1,f}) = 100 \\times (-0.80) = -80\n$$\nThe unit is (cm$^2$) $\\times$ (neutrons/(cm$^2 \\cdot$s)) = neutrons/s. A negative value indicates a net influx of neutrons into the node.\n\nNext, we compute the interface conservation residual $R$. The definition is:\n$$\nR \\equiv A_f\\Big[\\big(j^{+}_{1,E} - j^{-}_{1,E}\\big) + \\big(j^{+}_{2,W} - j^{-}_{2,W}\\big)\\Big]\n$$\nThis quantity represents the sum of the face-integrated net currents from both sides of the shared interface. The term $(j^{+}_{1,E} - j^{-}_{1,E})$ is the net current out of node $\\mathcal{N}_1$ through its east face. The term $(j^{+}_{2,W} - j^{-}_{2,W})$ is the net current out of node $\\mathcal{N}_2$ through its west face. By conservation, the net flow across the interface must be continuous, meaning the flow out of $\\mathcal{N}_1$ should equal the flow into $\\mathcal{N}_2$. Since the outward normals are opposite ($\\mathbf{n}_{1,E} = -\\mathbf{n}_{2,W}$), the sum of outward-flowing net currents from both sides should be zero.\n\nThe problem provides the interface coupling equalities, which enforce this continuity:\n$$\nj^{+}_{1,E} = j^{-}_{2,W}\n$$\n$$\nj^{-}_{1,E} = j^{+}_{2,W}\n$$\nWe substitute these into the expression for $R$:\n$$\nR = A_f\\Big[\\big(j^{+}_{1,E} - j^{-}_{1,E}\\big) + \\big(j^{-}_{1,E} - j^{+}_{1,E}\\big)\\Big]\n$$\nRearranging the terms inside the bracket:\n$$\nR = A_f\\Big[(j^{+}_{1,E} - j^{+}_{1,E}) + (-j^{-}_{1,E} + j^{-}_{1,E})\\Big] = A_f\\Big[0 + 0\\Big] = 0\n$$\nThe residual is identically zero, which confirms that the problem is formulated to ensure global neutron conservation across the nodal interface. The numerical values for the east face currents of $\\mathcal{N}_1$ are not needed to find $R$, as it is zero by the structure of the coupling conditions.\n\nThe final answer is the ordered pair $(L_1, R)$.\n$$\nL_1 = -80 \\text{ neutrons/s}\n$$\n$$\nR = 0 \\text{ neutrons/s}\n$$\nThe ordered pair is $(-80, 0)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-80 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The computational efficiency of VNM often comes from solving a multi-dimensional problem as a set of coupled one-dimensional equations, which requires modeling the neutron leakage in the transverse (orthogonal) directions. This leakage is not uniform and is typically represented by a low-order polynomial. This practical coding exercise shows how to determine the coefficients of this polynomial representation by performing a least-squares fit to discrete current data, a common technique used in modern nodal codes to reconstruct the necessary leakage profiles.",
            "id": "4260085",
            "problem": "Consider a single homogenized rectangular node in a two-dimensional neutron diffusion problem under the framework of the Variational Nodal Method (VNM). Let the node have width $H_x$ (in $\\mathrm{cm}$) along the $x$-axis and height $H_y$ (in $\\mathrm{cm}$) along the $y$-axis. When separating variables to form a one-dimensional nodal balance equation along $x$, the transverse leakage term, averaged over the transverse coordinate $y$, is modeled as a quadratic polynomial in $x$ over the node:\n$$\n\\bar{L}(x) \\approx c_0 + c_1 x + c_2 x^2.\n$$\nHere, $\\bar{L}(x)$ denotes the $y$-average of the divergence of the transverse current along $y$ within the node at axial position $x$. Assume Fick’s Law for the current and mass conservation in steady state so that the divergence theorem applies in the standard form. For any fixed $x$, the $y$-averaged transverse leakage can be expressed purely in terms of the known transverse face-normal currents at the bottom and top faces, $J_{\\text{bottom}}(x)$ and $J_{\\text{top}}(x)$ (in $\\mathrm{n}/(\\mathrm{cm}^2\\cdot \\mathrm{s})$), as\n$$\n\\bar{L}(x) = \\frac{J_{\\text{bottom}}(x) - J_{\\text{top}}(x)}{H_y}.\n$$\nYou are given discrete samples $\\{(x_i, J_{\\text{top}}(x_i), J_{\\text{bottom}}(x_i))\\}_{i=1}^N$ for several $x$-locations across the node. Your task is to compute the least-squares fit of the quadratic polynomial coefficients $\\{c_0,c_1,c_2\\}$ that minimize the sum of squared residuals between $\\bar{L}(x_i)$ and $c_0 + c_1 x_i + c_2 x_i^2$ over the provided sample points.\n\nStarting only from conservation of mass and the divergence theorem, together with the definition of the $y$-averaged transverse leakage in terms of the transverse face-normal currents, derive the least-squares fitting formulation and implement a program that:\n- Computes $\\bar{L}(x_i) = \\big(J_{\\text{bottom}}(x_i) - J_{\\text{top}}(x_i)\\big)/H_y$ for each given sample.\n- Constructs and solves the normal equations for the quadratic least-squares fit, or uses an equivalent numerically stable approach, to determine $\\{c_0,c_1,c_2\\}$.\n- Produces the coefficients rounded to six decimal places.\n\nUnits:\n- $H_x$ and $H_y$ are in $\\mathrm{cm}$.\n- $J_{\\text{top}}(x)$ and $J_{\\text{bottom}}(x)$ are in $\\mathrm{n}/(\\mathrm{cm}^2\\cdot \\mathrm{s})$.\n- $\\bar{L}(x)$ and $c_0$ are in $\\mathrm{n}/(\\mathrm{cm}^3\\cdot \\mathrm{s})$.\n- $c_1$ is in $\\mathrm{n}/(\\mathrm{cm}^4\\cdot \\mathrm{s})$ and $c_2$ is in $\\mathrm{n}/(\\mathrm{cm}^5\\cdot \\mathrm{s})$.\n- All angles, if any, are not applicable here.\n\nTest Suite:\nImplement your program to solve the following three independent test cases. Each case provides $H_x$, $H_y$, the sample locations $\\{x_i\\}$ in $\\mathrm{cm}$, and the corresponding face-normal currents at the top and bottom faces in $\\mathrm{n}/(\\mathrm{cm}^2\\cdot \\mathrm{s})$.\n\n- Test Case $1$ (general quadratic “happy path”):\n  - $H_x = 100.0$, $H_y = 50.0$.\n  - $x$-samples: $[\\,0.0,\\,25.0,\\,50.0,\\,75.0,\\,100.0\\,]$.\n  - $J_{\\text{top}}(x)$ at these $x$-values: $[\\,10.0,\\,22.5,\\,35.0,\\,47.5,\\,60.0\\,]$.\n  - $J_{\\text{bottom}}(x)$ at these $x$-values: $[\\,110.0,\\,113.125,\\,122.5,\\,138.125,\\,160.0\\,]$.\n\n- Test Case $2$ (linear leakage as a special case of quadratic):\n  - $H_x = 60.0$, $H_y = 30.0$.\n  - $x$-samples: $[\\,0.0,\\,20.0,\\,40.0,\\,60.0\\,]$.\n  - $J_{\\text{top}}(x)$ at these $x$-values: $[\\,0.0,\\,0.0,\\,0.0,\\,0.0\\,]$.\n  - $J_{\\text{bottom}}(x)$ at these $x$-values: $[\\,45.0,\\,57.0,\\,69.0,\\,81.0\\,]$.\n\n- Test Case $3$ (constant leakage as a boundary case):\n  - $H_x = 40.0$, $H_y = 20.0$.\n  - $x$-samples: $[\\,0.0,\\,10.0,\\,20.0,\\,30.0,\\,40.0\\,]$.\n  - $J_{\\text{top}}(x)$ at these $x$-values: $[\\,5.0,\\,2.0,\\,-1.0,\\,-4.0,\\,-7.0\\,]$.\n  - $J_{\\text{bottom}}(x)$ at these $x$-values: $[\\,-11.0,\\,-14.0,\\,-17.0,\\,-20.0,\\,-23.0\\,]$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each item is the list of the three fitted coefficients for one test case. For example:\n$$\n[\\,[c_{0,1},c_{1,1},c_{2,1}],\\,[c_{0,2},c_{1,2},c_{2,2}],\\,[c_{0,3},c_{1,3},c_{2,3}]\\,]\n$$\nAll coefficients must be rounded to six decimal places and implicitly carry the units specified above. Do not print any extra text.",
            "solution": "The problem is deemed valid. It is scientifically grounded in the principles of neutron transport and diffusion theory as applied in nuclear reactor analysis, specifically within the context of variational nodal methods. The task is a well-posed mathematical problem of fitting a polynomial to data using the method of least squares. All necessary data and definitions are provided, and there are no internal contradictions.\n\n### Derivation of the Least-Squares Formulation\n\nThe objective is to find the coefficients $\\{c_0, c_1, c_2\\}$ of the quadratic polynomial $P(x) = c_0 + c_1 x + c_2 x^2$ that best approximates the discrete values of the $y$-averaged transverse leakage, $\\bar{L}(x_i)$. The principle of least squares requires minimizing the sum of the squared residuals, $S$, between the model prediction and the observed data.\n\nThe observed data for the transverse leakage, which we denote as $\\bar{L}_i$, is computed at each sample point $x_i$ using the formula provided in the problem statement:\n$$\n\\bar{L}_i = \\bar{L}(x_i) = \\frac{J_{\\text{bottom}}(x_i) - J_{\\text{top}}(x_i)}{H_y}\n$$\nfor a set of $N$ sample points $i = 1, 2, \\dots, N$.\n\nThe sum of squared residuals is given by:\n$$\nS(c_0, c_1, c_2) = \\sum_{i=1}^{N} \\left( \\bar{L}_i - P(x_i) \\right)^2 = \\sum_{i=1}^{N} \\left( \\bar{L}_i - (c_0 + c_1 x_i + c_2 x_i^2) \\right)^2\n$$\nTo minimize $S$ with respect to the coefficients, we must set the partial derivatives of $S$ with respect to each coefficient to zero:\n$$\n\\frac{\\partial S}{\\partial c_0} = 0, \\quad \\frac{\\partial S}{\\partial c_1} = 0, \\quad \\frac{\\partial S}{\\partial c_2} = 0\n$$\nCalculating these derivatives yields:\n$$\n\\frac{\\partial S}{\\partial c_0} = \\sum_{i=1}^{N} 2 (\\bar{L}_i - c_0 - c_1 x_i - c_2 x_i^2)(-1) = 0 \\implies \\sum_{i=1}^{N} (\\bar{L}_i) = \\sum_{i=1}^{N} (c_0 + c_1 x_i + c_2 x_i^2)\n$$\n$$\n\\frac{\\partial S}{\\partial c_1} = \\sum_{i=1}^{N} 2 (\\bar{L}_i - c_0 - c_1 x_i - c_2 x_i^2)(-x_i) = 0 \\implies \\sum_{i=1}^{N} (x_i \\bar{L}_i) = \\sum_{i=1}^{N} (c_0 x_i + c_1 x_i^2 + c_2 x_i^3)\n$$\n$$\n\\frac{\\partial S}{\\partial c_2} = \\sum_{i=1}^{N} 2 (\\bar{L}_i - c_0 - c_1 x_i - c_2 x_i^2)(-x_i^2) = 0 \\implies \\sum_{i=1}^{N} (x_i^2 \\bar{L}_i) = \\sum_{i=1}^{N} (c_0 x_i^2 + c_1 x_i^3 + c_2 x_i^4)\n$$\nRearranging these sums gives a system of three linear equations in the three unknown coefficients $c_0, c_1, c_2$. This system is known as the normal equations:\n$$\n\\begin{cases}\n    (\\sum_{i=1}^{N} 1) c_0 + (\\sum_{i=1}^{N} x_i) c_1 + (\\sum_{i=1}^{N} x_i^2) c_2 = \\sum_{i=1}^{N} \\bar{L}_i \\\\\n    (\\sum_{i=1}^{N} x_i) c_0 + (\\sum_{i=1}^{N} x_i^2) c_1 + (\\sum_{i=1}^{N} x_i^3) c_2 = \\sum_{i=1}^{N} x_i \\bar{L}_i \\\\\n    (\\sum_{i=1}^{N} x_i^2) c_0 + (\\sum_{i=1}^{N} x_i^3) c_1 + (\\sum_{i=1}^{N} x_i^4) c_2 = \\sum_{i=1}^{N} x_i^2 \\bar{L}_i\n\\end{cases}\n$$\nThis system can be written in matrix form as $A^T A \\mathbf{c} = A^T \\mathbf{b}$, where:\n- The vector of unknown coefficients is $\\mathbf{c} = \\begin{pmatrix} c_0 \\\\ c_1 \\\\ c_2 \\end{pmatrix}$.\n- The vector of observed leakage values is $\\mathbf{b} = \\begin{pmatrix} \\bar{L}_1 \\\\ \\bar{L}_2 \\\\ \\vdots \\\\ \\bar{L}_N \\end{pmatrix}$.\n- The design matrix $A$ is given by $A_{ij} = x_i^{j-1}$ for $i=1,\\dots,N$ and $j=1,2,3$:\n$$\nA = \\begin{pmatrix}\n1 & x_1 & x_1^2 \\\\\n1 & x_2 & x_2^2 \\\\\n\\vdots & \\vdots & \\vdots \\\\\n1 & x_N & x_N^2\n\\end{pmatrix}\n$$\nThe matrix $A^T A$ is:\n$$\nA^T A = \\begin{pmatrix}\nN & \\sum x_i & \\sum x_i^2 \\\\\n\\sum x_i & \\sum x_i^2 & \\sum x_i^3 \\\\\n\\sum x_i^2 & \\sum x_i^3 & \\sum x_i^4\n\\end{pmatrix}\n$$\nand the vector $A^T \\mathbf{b}$ is:\n$$\nA^T \\mathbf{b} = \\begin{pmatrix}\n\\sum \\bar{L}_i \\\\\n\\sum x_i \\bar{L}_i \\\\\n\\sum x_i^2 \\bar{L}_i\n\\end{pmatrix}\n$$\nSolving this $3 \\times 3$ linear system yields the desired coefficients $\\mathbf{c}$.\n\n### Algorithmic Implementation\n\nWhile one can explicitly construct and solve the normal equations, this approach can be numerically unstable if the matrix $A^T A$ is ill-conditioned. A more robust method is to solve the original overdetermined system $A\\mathbf{c} \\approx \\mathbf{b}$ directly using a least-squares solver, which typically employs methods like QR decomposition. This avoids the explicit formation of $A^T A$.\n\nThe algorithm implemented in the provided code follows these steps:\n1.  For each test case, the input data ($H_y$, $\\{x_i\\}$, $\\{J_{\\text{top},i}\\}$, $\\{J_{\\text{bottom},i}\\}$) are defined.\n2.  The vector of transverse leakage values, $\\mathbf{b} = [\\bar{L}_1, \\dots, \\bar{L}_N]^T$, is calculated element-wise using the provided formula $\\bar{L}_i = (J_{\\text{bottom},i} - J_{\\text{top},i}) / H_y$.\n3.  The design matrix $A$ is constructed, where each row $i$ is $[1, x_i, x_i^2]$. This is equivalent to a Vandermonde matrix of degree $2$.\n4.  A standard numerical library function for linear least-squares, `numpy.linalg.lstsq`, is used to find the coefficient vector $\\mathbf{c}$ that minimizes the Euclidean norm $\\|A\\mathbf{c} - \\mathbf{b}\\|_2$.\n5.  The resulting coefficients $\\{c_0, c_1, c_2\\}$ are rounded to six decimal places as required.\n6.  The results for all test cases are collected and formatted into the specified string format for the final output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the quadratic least-squares fit coefficients for the transverse\n    leakage term in a variational nodal method context for three test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"Hx\": 100.0,\n            \"Hy\": 50.0,\n            \"x\": [0.0, 25.0, 50.0, 75.0, 100.0],\n            \"Jtop\": [10.0, 22.5, 35.0, 47.5, 60.0],\n            \"Jbottom\": [110.0, 113.125, 122.5, 138.125, 160.0],\n        },\n        {\n            \"Hx\": 60.0,\n            \"Hy\": 30.0,\n            \"x\": [0.0, 20.0, 40.0, 60.0],\n            \"Jtop\": [0.0, 0.0, 0.0, 0.0],\n            \"Jbottom\": [45.0, 57.0, 69.0, 81.0],\n        },\n        {\n            \"Hx\": 40.0,\n            \"Hy\": 20.0,\n            \"x\": [0.0, 10.0, 20.0, 30.0, 40.0],\n            \"Jtop\": [5.0, 2.0, -1.0, -4.0, -7.0],\n            \"Jbottom\": [-11.0, -14.0, -17.0, -20.0, -23.0],\n        },\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Extract data for the current case\n        Hy = case[\"Hy\"]\n        x_samples = np.array(case[\"x\"])\n        J_top_samples = np.array(case[\"Jtop\"])\n        J_bottom_samples = np.array(case[\"Jbottom\"])\n\n        # Step 1: Compute the y-averaged transverse leakage L_bar for each sample point\n        L_bar_samples = (J_bottom_samples - J_top_samples) / Hy\n        \n        # Step 2: Construct the design matrix A for the quadratic fit (c0 + c1*x + c2*x^2)\n        # The columns are for x^0, x^1, x^2\n        A = np.polynomial.polynomial.polyvander(x_samples, 2)\n        \n        # Step 3: Solve the least-squares problem A*c = b for the coefficients c\n        # b is the vector of L_bar_samples\n        # This is a numerically stable way to solve the normal equations.\n        coeffs, _, _, _ = np.linalg.lstsq(A, L_bar_samples, rcond=None)\n        \n        # The coefficients are returned in the order [c0, c1, c2]\n        all_results.append(coeffs)\n\n    # Step 4: Format the output as specified\n    # Rounded to six decimal places, in a list of lists format.\n    result_strings = []\n    for coeffs in all_results:\n        # Round each coefficient to 6 decimal places\n        rounded_coeffs = np.round(coeffs, 6)\n        # Format each coefficient to a string with 6 decimal places\n        coeff_strs = [f\"{c:.6f}\" for c in rounded_coeffs]\n        # Join into the list format '[c0,c1,c2]'\n        result_strings.append(f\"[{','.join(coeff_strs)}]\")\n        \n    # Join all case results into the final format '[[...],[...],...]'\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}