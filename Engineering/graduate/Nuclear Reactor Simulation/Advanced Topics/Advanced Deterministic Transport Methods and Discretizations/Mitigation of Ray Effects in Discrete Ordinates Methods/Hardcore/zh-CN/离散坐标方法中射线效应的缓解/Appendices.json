{
    "hands_on_practices": [
        {
            "introduction": "离散纵标法（Discrete Ordinates method）的核心在于角度的离散化。实践中的$S_N$求积组并非随意选取，而是经过精心设计的，以避免加剧射线效应的特性。本练习将引导你探究“水平对称求积组”（level-symmetric quadrature sets）的结构特性，通过分析其符号化构造，你将理解为何某些设计约束（例如，方向余弦严格避开$0$和$1$）对于从根本上缓解射线效应至关重要。",
            "id": "4235200",
            "problem": "考虑用于核反应堆模拟中子输运的三维离散纵标法（N阶水平对称求积，记作 $S_{N}$）。角向积分在单位球面上进行，使用方向余弦 $(\\mu,\\eta,\\xi)$，满足 $\\mu^{2}+\\eta^{2}+\\xi^{2}=1$，且求积权重为严格正值。一个水平对称求积将第一卦限的方向划分为若干能级，每个能级的成员由一个能级定义三元组的排列生成，并通过符号对称性扩展到整个球面，从而使得完整的求积组具有 $N(N+2)$ 个方向。该构造受到角矩精确到 $N-1$ 阶的约束（等效于与总阶数最高为 $N-1$ 的球谐函数的正交性条件），以及求积的归一化和对称性约束。\n\n你的任务是符号化地构造一个 $S_{12}$ 水平对称求积，列举出第一卦限中明确的方向余弦及其重数，而无需计算数值横坐标或权重。使用以下科学标准结构：\n\n- 令 $L=\\frac{N}{2}=6$ 表示第一卦限中的能级数。\n- 对于其中的 $5$ 个能级（A型），定义形式为 $(\\alpha_{\\ell},\\alpha_{\\ell},\\beta_{\\ell})$ 的三元组，其中 $\\ell\\in\\{1,2,3,4,5\\}$，$\\alpha_{\\ell},\\beta_{\\ell}\\in(0,1)$ 且 $2\\alpha_{\\ell}^{2}+\\beta_{\\ell}^{2}=1$。每个A型能级通过其元素的排列产生 $3$ 个不同的第一卦限方向。\n- 对于其中的 $1$ 个能级（B型），定义一个三元组 $(\\gamma_{1},\\gamma_{2},\\gamma_{3})$，其中 $\\gamma_{1},\\gamma_{2},\\gamma_{3}\\in(0,1)$ 且各不相同，并满足 $\\gamma_{1}^{2}+\\gamma_{2}^{2}+\\gamma_{3}^{2}=1$。B型能级通过所有排列产生 $6$ 个不同的第一卦限方向。\n- 为每个能级分配一个单一权重 $w_{\\ell}>0$，该权重用于该能级中的每个排列。施加矩约束，以确保在球体表面积测度下，对于所有满足 $r+s+t\\leq N-1$ 的单项式 $\\mu^{r}\\eta^{s}\\xi^{t}$ 都是精确的，同时满足由符号改变和排列所蕴含的对称性条件。\n\n应用符号对称性后，此构造产生 $3\\times 5+6=21$ 个第一卦限方向和总共 $N(N+2)=168$ 个方向。\n\n仅使用上述符号构造和水平对称求积的定义约束，确定所构造的任何方向是否与笛卡尔坐标轴对齐（即，是否有任何方向的 $(\\mu,\\eta,\\xi)$ 等于 $(\\pm 1,0,0)$、$(0,\\pm 1,0)$ 或 $(0,0,\\pm 1)$），已知这些方向会加剧离散纵标输运中的射线伪影。\n\n计算所构造的完整 $S_{12}$ 水平对称求积中包含的与坐标轴对齐的方向总数。将最终答案表示为一个不带单位的整数。无需四舍五入。",
            "solution": "目标是确定一个特定构造的 $S_{12}$ 水平对称求积中与坐标轴对齐的方向总数。与坐标轴对齐的方向定义为三个笛卡尔分量中有两个为零的向量。在单位球面上，这些方向是 $(\\pm 1, 0, 0)$、$(0, \\pm 1, 0)$ 和 $(0, 0, \\pm 1)$。总共有 $6$ 个这样的方向。\n\n题目描述了完整求积集的构造过程，该求积集包含 $N(N+2) = 12(12+2) = 168$ 个方向。该集合是由第一卦限中 $21$ 个唯一方向作为基底生成的。生成过程涉及对这些第一卦限方向应用符号对称性。设一个第一卦限方向由方向余弦三元组 $(\\mu_0, \\eta_0, \\xi_0)$ 表示，根据第一卦限的定义，$\\mu_0 \\ge 0$，$\\eta_0 \\ge 0$ 且 $\\xi_0 \\ge 0$。由此单一第一卦限方向生成的完整方向集由集合 $\\{(\\pm \\mu_0, \\pm \\eta_0, \\pm \\xi_0)\\}$ 给出，唯一方向的数量取决于是否有任何分量为零。\n\n对于完整求积集中的一个方向 $(\\mu, \\eta, \\xi)$ 要与坐标轴对齐，例如 $(\\pm 1, 0, 0)$，其分量的绝对值必须为 $(|\\mu|, |\\eta|, |\\xi|) = (1, 0, 0)$。由于分量的绝对值在符号改变下是不变的，这要求相应的第一卦限方向 $(\\mu_0, \\eta_0, \\xi_0)$ 必须是 $(1, 0, 0)$ 的一个排列。因此，问题的核心是确定任何指定的第一卦限方向的分量是否可以等于 $0$ 或 $1$。\n\n第一卦限方向的构造被划分为两种类型的能级。\n\n1.  **A型能级**：有 $5$ 个这样的能级，对于 $\\ell \\in \\{1, 2, 3, 4, 5\\}$。这些能级中任何方向的方向余弦都是三元组 $(\\alpha_{\\ell}, \\alpha_{\\ell}, \\beta_{\\ell})$ 的排列。题目明确说明了对这些值的约束：$\\alpha_{\\ell} \\in (0,1)$ 和 $\\beta_{\\ell} \\in (0,1)$。符号 $(0,1)$ 代表开区间，意味着 $0  \\alpha_{\\ell}  1$ 且 $0  \\beta_{\\ell}  1$。因此，分量 $\\alpha_{\\ell}$ 或 $\\beta_{\\ell}$ 都不能等于 $0$ 或 $1$。所以，从A型能级派生的任何方向都不可能是 $(1,0,0)$ 的排列。\n\n2.  **B型能级**：有 $1$ 个这样的能级。该能级中任何方向的方向余弦都是三元组 $(\\gamma_1, \\gamma_2, \\gamma_3)$ 的排列。题目说明了对这些值的约束：$\\gamma_{1}, \\gamma_{2}, \\gamma_{3} \\in (0,1)$，并且它们各不相同。同样，这意味着对于 $i \\in \\{1, 2, 3\\}$，有 $0  \\gamma_i  1$。与A型能级一样，没有任何分量可以等于 $0$ 或 $1$。因此，从B型能级派生的任何方向都不可能是 $(1,0,0)$ 的排列。\n\n整个第一卦限方向集完全由来自A型和B型能级的方向组成。问题陈述中提供的约束条件 $\\alpha_{\\ell}, \\beta_{\\ell}, \\gamma_i \\in (0,1)$ 是确定性的。它们严格禁止第一卦限方向的任何分量为 $0$ 或 $1$。\n\n设 $(\\mu_0, \\eta_0, \\xi_0)$ 是 $21$ 个第一卦限方向中的任意一个。根据以上分析，我们有 $\\mu_0  0$，$\\eta_0  0$ 且 $\\xi_0  0$。通过应用符号对称性生成完整求积集时，我们得到形如 $(\\pm \\mu_0, \\pm \\eta_0, \\pm \\xi_0)$ 的方向。由于 $\\mu_0, \\eta_0, \\xi_0$ 均不为零，所以这些生成方向的任何分量都不能为零。\n\n一个与坐标轴对齐的方向必须有两个零分量。由于所构造的整个 $S_{12}$ 集合中没有任何方向可以有零分量，因此它们中的任何一个都不可能与坐标轴对齐。在许多现代离散纵标法中，构造分量严格在 $(0,1)$ 内的求积集是刻意为之的，目的就是为了避免将纵标点放置在坐标轴上，从而减轻射线效应。\n\n因此，在指定的 $S_{12}$ 求积中，与坐标轴对齐的方向总数为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "射线效应的缓解不仅依赖于角度离散，空间离散格式的选择同样扮演着关键角色，其影响通常是隐式的。本练习是一个分析性挑战，旨在揭示一种常用数值格式中“隐藏”的缓解机制。通过运用修正方程分析（modified-equation analysis），你将能够量化一阶迎风格式所引入的“数值扩散”（numerical diffusion），并理解它在抑制射线效应所特有的非物理伪影中的作用。",
            "id": "4235151",
            "problem": "考虑一个通过离散纵标 ($S_{N}$) 方法离散化的一维板状几何、单能中子输运问题。令 $x$ 表示空间坐标，并令一个方向余弦为 $0  \\mu\\leq 1$ 的单方向代表流动的方向。连续流动算符为 $ \\mu \\,\\partial \\psi / \\partial x$，其中 $\\psi(x)$ 是角通量。假设空间离散化采用一阶迎风有限体积格式，作用于一个网格宽度为 $h$ 的均匀网格上。\n\n在离散纵标 ($S_{N}$) 方法中，射线效应表现为角度空间中网格尺度的束状伪影，并通过空间离散化进行传播。为了量化所选空间格式如何减轻这些伪影，定义数值扩散长度如下：引入由流动算符的一阶迎风离散化的修正方程分析所隐含的等效人工扩散。然后，对于一个波数为 $k_{\\max}=\\pi/h$ 的网格尺度傅里叶模态，定义数值扩散长度 $\\ell_{\\text{num}}$ 为该模态的振幅仅因人工扩散而减小到 $\\exp(-1)$ 倍时沿 $x$ 轴传播的距离。\n\n从连续流动算符和一阶迎风有限体积离散化的定义出发，并且仅使用基于泰勒级数的修正方程分析和扩散作用下的傅里叶模态衰减，推导出一个用 $h$ 和基本常数表示的 $\\ell_{\\text{num}}$ 的解析表达式。最后，用米来表示 $\\ell_{\\text{num}}$，并以单个闭式表达式的形式给出你的结果。无需四舍五入。",
            "solution": "该问题要求在离散纵标方法的背景下，针对一维流动算符的一阶迎风离散化，推导数值扩散长度 $\\ell_{\\text{num}}$。推导过程分为四个主要步骤：($1$) 离散化连续流动算符，($2$) 进行修正方程分析以识别出人工扩散项，($3$) 在瞬态框架内分析傅里叶模态的衰减，以及 ($4$) 计算最高波数模态衰减到 $\\exp(-1)$ 倍时所对应的特定长度尺度。\n\n步骤1：流动算符的离散化\n\n我们考虑连续的一维流动算符 $\\mu \\frac{\\partial \\psi}{\\partial x}$，其中 $\\psi(x)$ 是角通量，$\\mu  0$ 是方向余弦。我们在此算符的均匀空间网格上进行离散化，网格宽度为 $h$。网格单元由 $i$ 索引，中心位于位置 $x_i$，边界位于 $x_{i \\pm 1/2}$。\n\n使用有限体积法，我们将该算符在单元 $i$ 上进行积分，从 $x_{i-1/2}$ 到 $x_{i+1/2}$：\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} \\mu \\frac{\\partial \\psi}{\\partial x} \\, dx = \\mu [\\psi(x_{i+1/2}) - \\psi(x_{i-1/2})]\n$$\n将其除以网格宽度 $h$，得到单元平均算符：\n$$\n\\frac{1}{h} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\mu \\frac{\\partial \\psi}{\\partial x} \\, dx = \\frac{\\mu}{h} [\\psi(x_{i+1/2}) - \\psi(x_{i-1/2})]\n$$\n对于一阶迎风格式，单元边界上的通量由上游单元的单元平均通量来近似。由于方向余弦 $\\mu$ 为正，中子的流动方向为 $x$ 轴正方向。因此，上游方向是左侧（从单元 $i-1$ 到单元 $i$）。令 $\\psi_i$ 表示单元 $i$ 中的单元平均通量。边界通量的迎风近似为：\n$$\n\\psi(x_{i-1/2}) \\approx \\psi_{i-1}\n$$\n$$\n\\psi(x_{i+1/2}) \\approx \\psi_i\n$$\n将这些近似代入有限体积表达式，得到单元 $i$ 处的离散流动算符：\n$$\n\\left( \\mu \\frac{\\partial \\psi}{\\partial x} \\right)_{\\text{discrete}, i} = \\mu \\frac{\\psi_i - \\psi_{i-1}}{h}\n$$\n\n步骤2：修正方程分析与人工扩散\n\n为了确定离散格式所求解的等效连续方程，我们进行修正方程分析。我们用围绕单元中心 $x_i$ 的泰勒级数展开式来替换离散通量值 $\\psi_i$ 和 $\\psi_{i-1}$。在 $x_{i-1} = x_i - h$ 处的通量 $\\psi_{i-1}$ 展开为：\n$$\n\\psi_{i-1} = \\psi(x_i - h) = \\psi(x_i) - h \\left.\\frac{\\partial \\psi}{\\partial x}\\right|_{x_i} + \\frac{h^2}{2} \\left.\\frac{\\partial^2 \\psi}{\\partial x^2}\\right|_{x_i} - O(h^3)\n$$\n将此展开式代入离散算符，并为了与连续函数在符号上保持一致，将 $\\psi(x_i)$ 记为 $\\psi_i$：\n$$\n\\mu \\frac{\\psi_i - \\psi_{i-1}}{h} = \\frac{\\mu}{h} \\left[ \\psi_i - \\left( \\psi_i - h \\frac{\\partial \\psi}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} - O(h^3) \\right) \\right]\n$$\n$$\n= \\frac{\\mu}{h} \\left[ h \\frac{\\partial \\psi}{\\partial x} - \\frac{h^2}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} + O(h^3) \\right]\n$$\n$$\n= \\mu \\frac{\\partial \\psi}{\\partial x} - \\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2} + O(h^2)\n$$\n这一结果表明，一阶迎风格式近似于原始流动算符加上一个主阶截断误差项 $-\\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2}$。该项具有扩散算符的形式 $-D_{\\text{art}} \\frac{\\partial^2 \\psi}{\\partial x^2}$，其中人工扩散系数为：\n$$\nD_{\\text{art}} = \\frac{\\mu h}{2}\n$$\n问题要求的是仅由这种“人工扩散”引起的衰减。\n\n步骤3：傅里叶模态衰减\n\n为了分析空间模态的衰减，标准做法是考虑一个瞬态平流问题，$\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = 0$。用一阶迎风格式对空间部分进行离散化，得到修正的偏微分方程：\n$$\n\\frac{\\partial \\psi}{\\partial t} + \\mu \\frac{\\partial \\psi}{\\partial x} = D_{\\text{art}} \\frac{\\partial^2 \\psi}{\\partial x^2} = \\frac{\\mu h}{2} \\frac{\\partial^2 \\psi}{\\partial x^2}\n$$\n这是一个平流-扩散方程。我们分析它对单个空间傅里叶模态 $\\psi(x,t) = A(t) \\exp(ikx)$ 的影响，其中 $k$ 是波数。将其代入修正方程得到：\n$$\n\\frac{dA(t)}{dt} \\exp(ikx) + \\mu A(t) (ik) \\exp(ikx) = \\frac{\\mu h}{2} A(t) (ik)^2 \\exp(ikx)\n$$\n两边除以 $\\exp(ikx)$，得到关于振幅 $A(t)$ 的常微分方程：\n$$\n\\frac{dA(t)}{dt} = -ik\\mu A(t) - k^2 \\frac{\\mu h}{2} A(t) = \\left( -ik\\mu - k^2 \\frac{\\mu h}{2} \\right) A(t)\n$$\n解为 $A(t) = A(0) \\exp\\left( \\left( -ik\\mu - k^2 \\frac{\\mu h}{2} \\right) t \\right)$。振幅的模随时间演化如下：\n$$\n|A(t)| = |A(0)| \\left| \\exp(-ik\\mu t) \\exp\\left(-k^2 \\frac{\\mu h}{2} t\\right) \\right| = |A(0)| \\exp\\left(-k^2 \\frac{\\mu h}{2} t\\right)\n$$\n模态的衰减由指数的实部决定，该实部源于人工扩散项。\n\n步骤4：数值扩散长度的计算\n\n问题将 $\\ell_{\\text{num}}$ 定义为一个空间距离。我们可以通过考虑傅里叶模态传播的速度，将时间演化与空间传播联系起来。这由波包的群速度 $v_g$ 给出。对于平流-扩散方程，色散关系为 $\\omega(k) = k\\mu - i k^2 \\frac{\\mu h}{2}$。群速度是 $\\omega$ 的实部对 $k$ 的导数：\n$$\nv_g = \\frac{d(\\text{Re}(\\omega))}{dk} = \\frac{d(k\\mu)}{dk} = \\mu\n$$\n一个波包在时间 $t = x/v_g = x/\\mu$ 内传播距离 $x$。我们可以将振幅衰减表示为传播距离 $x$ 的函数：\n$$\n|A(x)| = |A_0| \\exp\\left(-k^2 \\frac{\\mu h}{2} \\frac{x}{\\mu}\\right) = |A_0| \\exp\\left(-\\frac{k^2 h x}{2}\\right)\n$$\n注意，对方向余弦 $\\mu$ 的依赖性已经消除了。数值扩散长度 $\\ell_{\\text{num}}$ 是振幅减小到 $\\exp(-1)$ 倍时的距离 $x$，即 $|A(\\ell_{\\text{num}})|/|A_0| = \\exp(-1)$。\n$$\n\\exp\\left(-\\frac{k^2 h \\ell_{\\text{num}}}{2}\\right) = \\exp(-1)\n$$\n对两边取自然对数，得到：\n$$\n\\frac{k^2 h \\ell_{\\text{num}}}{2} = 1 \\implies \\ell_{\\text{num}} = \\frac{2}{k^2 h}\n$$\n问题指定我们必须对网格尺度的傅里叶模态进行评估，该模态在网格上具有可能的最大波数 $k_{\\max} = \\pi/h$。将这个 $k$ 值代入：\n$$\n\\ell_{\\text{num}} = \\frac{2}{\\left(\\frac{\\pi}{h}\\right)^2 h} = \\frac{2}{\\frac{\\pi^2}{h^2} h} = \\frac{2h}{\\pi^2}\n$$\n数值扩散长度的表达式用网格宽度 $h$ 和基本数学常数 $\\pi$ 表示。如果 $h$ 以米为单位，则 $\\ell_{\\text{num}}$ 也将以米为单位，符合要求。",
            "answer": "$$\\boxed{\\frac{2h}{\\pi^{2}}}$$"
        },
        {
            "introduction": "在探讨了离散化方法中内蕴的缓解机制后，我们转向一种更明确、更具物理直观性的策略。避免高度局域化的中子源是减弱射线效应最有效的方法之一。本练习是一个计算性实验，通过编程模拟并比较点源与展宽的体源所产生的角通量，你将定量地衡量源的展宽如何平滑角度分布，从而验证这一关键的缓解原理。",
            "id": "4235231",
            "problem": "考虑在均匀无限介质中的稳态单能线性输运方程，该介质为纯吸收（无散射），表示为 $\\boldsymbol{\\Omega}\\cdot\\nabla \\psi(\\mathbf{r},\\boldsymbol{\\Omega}) + \\Sigma_t \\psi(\\mathbf{r},\\boldsymbol{\\Omega}) = q(\\mathbf{r})/(4\\pi)$，其中 $\\psi(\\mathbf{r},\\boldsymbol{\\Omega})$ 是角通量，$\\Sigma_t$ 是总宏观截面，$\\boldsymbol{\\Omega}$ 是单位方向矢量，$q(\\mathbf{r})$ 是各向同性源密度。在离散纵标 ($S_N$) 方法中，射线效应表现为由于将通量集中在有限的一组离散方向上而引起的人为角度条纹。分布式体源通过将方向贡献分散到许多纵标上，可以减轻这些效应。您的任务是通过计算两种源配置下固定观测位置处 $\\psi(\\boldsymbol{\\Omega})$ 的角度方差，来定量地证明这种缓解效果：一种是各向同性点源，另一种是均匀的立方体体源。请在三维空间中进行计算。\n\n基本原理和假设：\n- 使用上述线性输运方程作为基本模型，具有纯吸收、零散射和无限介质的特性。\n- 各向同性点源位于原点，总发射率为 $S_0$（单位：粒子/秒）。\n- 均匀体源占据一个以原点为中心、边长为 $a$ 的立方体，其源强度为 $s_v$（单位：粒子/立方厘米/秒），选择该强度使得总发射率与点源相等，即 $s_v a^3 = S_0$。\n- 观测点位于位置 $\\mathbf{r}_{\\text{obs}}$，且在所有测试案例中均位于立方体外部。\n\n离散近似和算法定义：\n1. 离散纵标求积：\n   - 通过将在 $\\left[-1,1\\right]$ 上的 $\\mu = \\cos\\theta$ 的高斯-勒让德节点（含 $N_\\mu$ 个节点和权重）与在 $\\left[0,2\\pi\\right)$ 上的均匀方位角 $\\phi$（含 $N_\\phi$ 个等间距节点）相结合，构建单位球面上的乘积求积。方向矢量为 $\\boldsymbol{\\Omega}_{n} = (\\sin\\theta_i\\cos\\phi_j,\\,\\sin\\theta_i\\sin\\phi_j,\\,\\mu_i)$，权重为 $w_n = w^{(\\mu)}_i \\cdot \\Delta\\phi$，其中 $\\Delta\\phi = 2\\pi/N_\\phi$，$w^{(\\mu)}_i$ 是高斯-勒让德权重。所有权重之和必须为 $4\\pi$。\n   - 角度必须以弧度为单位。\n\n2. 在 $\\mathbf{r}_{\\text{obs}}$ 处构建角通量：\n   - 对于位于位置 $\\mathbf{r}_s$ 的源点，其对 $\\mathbf{r}_{\\text{obs}}$ 处角通量的贡献大小，沿着视线方向 $\\widehat{\\mathbf{d}} = (\\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s)/\\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$ 和路径长度 $L = \\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$，由沿程衰减和几何稀释给出：$A(\\mathbf{r}_s) = \\left(\\frac{Q_s}{4\\pi}\\right) \\frac{e^{-\\Sigma_t L}}{L^2}$，其中 $Q_s$ 是分配给该源点的发射率（对于点源，$Q_s = S_0$ 且只有一个源点；对于离散为 $M$ 个子点的体源，每个子点的 $Q_s = S_0/M$）。\n   - 在离散纵标近似中，将来自 $\\mathbf{r}_s$ 的贡献分配给与 $\\widehat{\\mathbf{d}}$ 的角分离最小的单个求积方向 $\\boldsymbol{\\Omega}_{n^*}$；等效地，选择 $n^* = \\underset{n}{\\arg\\max}\\, \\boldsymbol{\\Omega}_n\\cdot \\widehat{\\mathbf{d}}$。将 $A(\\mathbf{r}_s)$ 累加到 $\\psi_n$ 中（其中 $n=n^*$）。\n   - 对于点源配置，只有一个 $\\mathbf{r}_s = \\mathbf{0}$。\n   - 对于体源配置，通过一个包含 $M = N^3$ 个点的笛卡尔网格来近似均匀源，这些点位于立方体内部中心，均匀分布，覆盖边长为 $a$ 的立方体。\n\n3. 角度方差度量：\n   - 设 $\\{\\psi_n\\}_{n=1}^N$ 是构建的离散角通量值，$\\{w_n\\}_{n=1}^N$ 是相应的求积权重，且 $\\sum_{n=1}^N w_n = 4\\pi$。\n   - 计算加权平均值 $\\mu_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\psi_n$。\n   - 计算加权方差 $V_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\left(\\psi_n - \\mu_\\psi\\right)^2$。\n   - 报告归一化角度方差（变异系数的平方）$C = \\frac{V_\\psi}{\\mu_\\psi^2}$，此为无量纲量。\n   - 定义方差缩减比 $\\rho = \\frac{C_{\\text{vol}}}{C_{\\text{point}}}$，其中 $C_{\\text{vol}}$ 和 $C_{\\text{point}}$ 分别是体源和点源的归一化方差。$\\rho  1$ 的值表示射线效应得到缓解。\n\n单位和数值细节：\n- 长度单位必须是厘米 (cm)。\n- 截面 $\\Sigma_t$ 的单位必须是反厘米 ($\\text{cm}^{-1}$)。\n- 源发射率 $S_0$ 的单位必须是粒子/秒 ($\\text{s}^{-1}$)，但您应设置 $S_0 = 1$，以使最终输出无量纲且与任意缩放无关。\n- 角度必须以弧度为单位。\n\n测试套件：\n对于每个测试案例，应用上述算法计算给定观测点处的 $\\rho$。使用指定的求积大小和立方体体源参数。将所有测试案例的结果汇总到如下指定的单行输出中。\n\n- 测试案例 1（一般情况，中等吸收，中等求积）：\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$，\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$，\n  - $N_\\mu = 8$, $N_\\phi = 16$，\n  - 立方体边长 $a = 6.0\\,\\text{cm}$，\n  - 体源离散化 $M = 1000$（即每边 $N=10$）。\n\n- 测试案例 2（粗糙求积，预期射线效应更强）：\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$，\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$，\n  - $N_\\mu = 4$, $N_\\phi = 8$，\n  - 立方体边长 $a = 6.0\\,\\text{cm}$，\n  - 体源离散化 $M = 216$（即每边 $N=6$）。\n\n- 测试案例 3（近点体源，边界条件）：\n  - $\\Sigma_t = 0.1\\,\\text{cm}^{-1}$，\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$，\n  - $N_\\mu = 8$, $N_\\phi = 16$，\n  - 立方体边长 $a = 0.5\\,\\text{cm}$，\n  - 体源离散化 $M = 1000$（即每边 $N=10$）。\n\n- 测试案例 4（更高吸收，鲁棒性检查）：\n  - $\\Sigma_t = 0.7\\,\\text{cm}^{-1}$，\n  - $\\mathbf{r}_{\\text{obs}} = (10.0,\\,4.0,\\,2.0)\\,\\text{cm}$，\n  - $N_\\mu = 8$, $N_\\phi = 16$，\n  - 立方体边长 $a = 6.0\\,\\text{cm}$，\n  - 体源离散化 $M = 1000$（即每边 $N=10$）。\n\n最终输出格式：\n- 您的程序应生成单行输出，包含上述四个测试案例的方差缩减比，形式为用方括号括起来的逗号分隔列表，例如 $\\left[\\rho_1,\\rho_2,\\rho_3,\\rho_4\\right]$。每个 $\\rho_i$ 必须是浮点数（无量纲）。程序必须按原样运行，无需用户输入，并且必须按照规定的定义和单位在内部计算所有量。",
            "solution": "求解过程首先构建角度域的离散表示，然后模拟从两种不同源配置到固定观测点的粒子输运。核心思想是表明空间分布源将通量沉积在更广泛的离散角度方向上，从而与高度局域化的点源相比，降低了角度方差。\n\n第一步是将连续的角度变量 $\\boldsymbol{\\Omega}$ 离散化为一组有限的 $N = N_\\mu \\times N_\\phi$ 个方向 $\\{\\boldsymbol{\\Omega}_n\\}$ 及相应的权重 $\\{w_n\\}$。这里采用乘积求积法。极角余弦 $\\mu = \\cos\\theta \\in [-1, 1]$ 使用 $N_\\mu$ 点高斯-勒让德求积进行离散化，得到一组节点 $\\{\\mu_i\\}_{i=1}^{N_\\mu}$ 和权重 $\\{w^{(\\mu)}_i\\}_{i=1}^{N_\\mu}$。那么极角为 $\\theta_i = \\arccos(\\mu_i)$。这些权重之和为 $\\sum_{i=1}^{N_\\mu} w^{(\\mu)}_i = 2$。方位角 $\\phi \\in [0, 2\\pi)$ 被离散为 $N_\\phi$ 个均匀间隔的角度 $\\{\\phi_j\\}_{j=0}^{N_\\phi-1}$，其中 $\\phi_j = j \\cdot \\Delta\\phi$，角度区间宽度为 $\\Delta\\phi = 2\\pi/N_\\phi$。对应于一对 $(\\mu_i, \\phi_j)$ 的离散方向 $\\boldsymbol{\\Omega}_n$ 在笛卡尔坐标系中由下式给出：\n$$ \\boldsymbol{\\Omega}_n = (\\sin\\theta_i\\cos\\phi_j, \\sin\\theta_i\\sin\\phi_j, \\mu_i) = (\\sqrt{1-\\mu_i^2}\\cos\\phi_j, \\sqrt{1-\\mu_i^2}\\sin\\phi_j, \\mu_i) $$\n与此方向相关的权重 $w_n$ 是极角和方位角权重的乘积，$w_n = w^{(\\mu)}_i \\cdot \\Delta\\phi$。所有权重的总和为 $\\sum_{n=1}^{N} w_n = \\sum_{i=1}^{N_\\mu} w^{(\\mu)}_i \\sum_{j=0}^{N_\\phi-1} \\Delta\\phi = 2 \\cdot (N_\\phi \\cdot \\frac{2\\pi}{N_\\phi}) = 4\\pi$，这正确地在单位球面上进行了归一化。\n\n第二步是角通量计算。在观测点 $\\mathbf{r}_{\\text{obs}}$ 处的角通量 $\\psi(\\mathbf{r}_{\\text{obs}}, \\boldsymbol{\\Omega})$ 是通过对所有源位置贡献求和来构建的。对于位于位置 $\\mathbf{r}_s$、强度为 $Q_s$ 的源元，其沿视线的未碰撞通量贡献基于几何上的 $1/L^2$ 稀释和指数衰减。路径长度为 $L = \\lVert \\mathbf{r}_{\\text{obs}} - \\mathbf{r}_s\\rVert$。贡献的量值为：\n$$ A(\\mathbf{r}_s) = \\left(\\frac{Q_s}{4\\pi}\\right) \\frac{e^{-\\Sigma_t L}}{L^2} $$\n在离散纵标方法中，这个沿精确方向 $\\widehat{\\mathbf{d}} = (\\mathbf{r}_{\\text{obs}}-\\mathbf{r}_s)/L$ 传播的连续贡献，被分配给角度上“最接近”的单个离散纵标 $\\boldsymbol{\\Omega}_{n^*}$。这可以通过最大化点积来找到：\n$$ n^* = \\underset{n}{\\arg\\max}\\ (\\boldsymbol{\\Omega}_n \\cdot \\widehat{\\mathbf{d}}) $$\n然后，通过累加这些贡献来更新初始化为零的离散角通量数组 $\\{\\psi_n = 0\\}_{n=1}^N$：$\\psi_{n^*} \\leftarrow \\psi_{n^*} + A(\\mathbf{r}_s)$。对所有源位置重复此过程。考虑两种源模型：\n1.  位于原点 $\\mathbf{r}_s = \\mathbf{0}$ 的单一点源，总强度为 $Q_s = S_0$。这导致对某个特定纵标 $\\psi_{n^*}$ 的单个非零贡献，这是射线效应的特征。\n2.  一个体源，其中边长为 $a$ 的立方体被离散为 $M=N^3$ 个相同的子立方体。每个子立方体由其中心的点源 $\\mathbf{r}_{s_k}$ 表示。总源强度 $S_0$ 在这些点之间平均分配，因此每个点的强度为 $Q_s = S_0/M$。通量是通过对所有 $M$ 个点的贡献求和来计算的。由于每个点 $\\mathbf{r}_{s_k}$ 定义了略微不同的视线方向 $\\widehat{\\mathbf{d}}_k$，总通量被分散到多个离散纵标上，从而缓解了射线效应。\n\n第三步是角度方差的量化。为了量化角通量分布的平滑度，计算一个归一化的方差。给定离散通量值集合 $\\{\\psi_n\\}$ 和权重 $\\{w_n\\}$，计算加权平均角通量（相当于标量通量除以 $4\\pi$）：\n$$ \\mu_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\psi_n $$\n接下来，计算加权方差：\n$$ V_\\psi = \\frac{1}{4\\pi}\\sum_{n=1}^N w_n \\left(\\psi_n - \\mu_\\psi\\right)^2 $$\n最后，无量纲的归一化角度方差，或变异系数的平方，由下式给出：\n$$ C = \\frac{V_\\psi}{\\mu_\\psi^2} $$\n对点源（$C_{\\text{point}}$）和体源（$C_{\\text{vol}}$）都计算此度量 $C$。\n\n最后一步是计算方差缩减比。体源在缓解射线效应方面的有效性通过比率 $\\rho$ 来衡量：\n$$ \\rho = \\frac{C_{\\text{vol}}}{C_{\\text{point}}} $$\n$\\rho  1$ 的值表示体源产生的角通量分布比点源更平滑（相对方差更低），证明了射线效应的缓解。该算法为每个测试案例实施这些步骤以计算相应的 $\\rho_i$。在所有计算中，总源强度设置为 $S_0=1$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\nclass RayEffectMitigationSimulator:\n    \"\"\"\n    Simulates particle transport from different sources to quantify ray effect mitigation.\n    \"\"\"\n    def __init__(self, sigma_t, r_obs, N_mu, N_phi, a, M):\n        \"\"\"\n        Initializes the simulator with parameters for a single test case.\n        \"\"\"\n        self.sigma_t = sigma_t\n        self.r_obs = np.array(r_obs, dtype=float)\n        self.N_mu = N_mu\n        self.N_phi = N_phi\n        self.a = a\n        self.M = M\n        self.S0 = 1.0  # Normalized total source strength, as per problem.\n\n        # Generate the discrete ordinates quadrature set upon initialization.\n        self.omegas, self.weights = self._generate_quadrature_set()\n\n    def _generate_quadrature_set(self):\n        \"\"\"\n        Constructs the product quadrature set (directions and weights).\n        \"\"\"\n        # Get N_mu Gauss-Legendre nodes (mu) and weights (w_mu) on [-1, 1].\n        # The sum of numpy's `leggauss` weights is 2.\n        mu_nodes, mu_weights = leggauss(self.N_mu)\n        \n        # Generate N_phi uniform azimuthal angles on [0, 2*pi).\n        phi_nodes = np.linspace(0.0, 2.0 * np.pi, self.N_phi, endpoint=False)\n        delta_phi = 2.0 * np.pi / self.N_phi\n        \n        num_directions = self.N_mu * self.N_phi\n        omegas = np.zeros((num_directions, 3))\n        weights = np.zeros(num_directions)\n        \n        idx = 0\n        for i in range(self.N_mu):\n            mu = mu_nodes[i]\n            w_mu = mu_weights[i]\n            # sin(theta) = sqrt(1 - cos^2(theta))\n            sin_theta = np.sqrt(1.0 - mu**2)\n            for j in range(self.N_phi):\n                phi = phi_nodes[j]\n                \n                # Convert from spherical to Cartesian coordinates for the direction vector.\n                omegas[idx, 0] = sin_theta * np.cos(phi)\n                omegas[idx, 1] = sin_theta * np.sin(phi)\n                omegas[idx, 2] = mu\n                \n                # The weight for this direction is the product of polar and azimuthal weights.\n                weights[idx] = w_mu * delta_phi\n                idx += 1\n        \n        return omegas, weights\n\n    def _calculate_normalized_variance(self, source_type):\n        \"\"\"\n        Calculates the normalized angular variance for a given source configuration.\n        \"\"\"\n        # 1. Generate source points and their individual strengths.\n        if source_type == 'point':\n            source_points = np.array([[0.0, 0.0, 0.0]])\n            q_s = self.S0\n        elif source_type == 'volumetric':\n            N = int(round(self.M**(1./3.)))\n            if N**3 != self.M:\n                # This check ensures M is a perfect cube as expected.\n                raise ValueError(f\"M={self.M} is not a perfect cube.\")\n            \n            # Create coordinates for sub-source points at the center of each sub-volume.\n            coords1d = np.linspace(-self.a / 2.0 + self.a / (2.0 * N), self.a / 2.0 - self.a / (2.0 * N), N)\n            x, y, z = np.meshgrid(coords1d, coords1d, coords1d, indexing='ij')\n            source_points = np.vstack([x.ravel(), y.ravel(), z.ravel()]).T\n            q_s = self.S0 / self.M\n        else:\n            raise ValueError(\"Invalid source type specified.\")\n\n        # 2. Calculate the discrete angular flux psi_n.\n        num_directions = len(self.weights)\n        psi_n = np.zeros(num_directions)\n\n        for r_s in source_points:\n            d = self.r_obs - r_s\n            L = np.linalg.norm(d)\n            if L == 0.0: continue # Observer is at a source point. Skip.\n            \n            d_hat = d / L\n            \n            # Calculate contribution magnitude: geometric dilution and attenuation.\n            A = (q_s / (4.0 * np.pi)) * np.exp(-self.sigma_t * L) / (L**2)\n\n            # Find the discrete ordinate that best matches the line-of-sight direction.\n            dot_products = self.omegas @ d_hat\n            n_star = np.argmax(dot_products)\n            \n            # Accumulate the contribution to the corresponding angular flux bin.\n            psi_n[n_star] += A\n        \n        # 3. Compute the normalized variance C.\n        # Weighted mean of the angular flux.\n        mu_psi = np.sum(self.weights * psi_n) / (4.0 * np.pi)\n        \n        # According to the problem, C = V / mu^2. If mu is zero, C is undefined.\n        # However, for the given test cases, mu_psi will be non-zero.\n        if mu_psi == 0.0:\n            return np.nan\n\n        # Weighted variance of the angular flux.\n        V_psi = np.sum(self.weights * (psi_n - mu_psi)**2) / (4.0 * np.pi)\n        \n        # Normalized variance (squared coefficient of variation).\n        C = V_psi / (mu_psi**2)\n        \n        return C\n\n    def compute_reduction_ratio(self):\n        \"\"\"\n        Computes the variance reduction ratio rho = C_vol / C_point.\n        \"\"\"\n        C_point = self._calculate_normalized_variance('point')\n        C_vol = self._calculate_normalized_variance('volumetric')\n\n        if C_point == 0.0:\n            return np.nan # C_point should be large and positive, but handle this case.\n\n        rho = C_vol / C_point\n        return rho\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (sigma_t, r_obs, N_mu, N_phi, a, M)\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 6.0, 'M': 1000},\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 4, 'N_phi': 8, 'a': 6.0, 'M': 216},\n        {'sigma_t': 0.1, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 0.5, 'M': 1000},\n        {'sigma_t': 0.7, 'r_obs': (10.0, 4.0, 2.0), 'N_mu': 8, 'N_phi': 16, 'a': 6.0, 'M': 1000},\n    ]\n\n    results = []\n    for params in test_cases:\n        # Instantiate the simulator for the current test case.\n        simulator = RayEffectMitigationSimulator(**params)\n        # Compute the variance reduction ratio.\n        rho = simulator.compute_reduction_ratio()\n        results.append(rho)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}