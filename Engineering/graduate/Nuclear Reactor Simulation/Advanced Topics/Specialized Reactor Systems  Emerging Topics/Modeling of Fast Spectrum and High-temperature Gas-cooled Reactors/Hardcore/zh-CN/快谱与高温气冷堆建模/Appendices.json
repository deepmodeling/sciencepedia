{
    "hands_on_practices": [
        {
            "introduction": "在反应堆物理模拟中，使用多群方法是在计算精度和效率之间取得平衡的关键。直接求解连续能量的玻尔兹曼方程通常计算量过大，因此我们将能量范围划分为若干个“能群”，并在每个群内使用平均化的截面常数。此过程被称为“能群缩并”，其核心在于使用一个合适的“中子能谱”作为权重函数进行平均，以确保在粗群计算中反应率得以守恒。在本实践中 ，您将亲手实现一个从细群到粗群的截面缩并程序，并定量分析使用不恰当的权重谱（例如，将热中子反应堆的能谱用于快中子反应堆）会给计算结果带来多大的误差。",
            "id": "4235457",
            "problem": "一位反应堆物理分析师正在为与高温气冷堆（HTGR）和快堆相关的快谱区准备一个缩减能群库。该分析师必须从反应率和群常数的基本定义出发，使用通量加权平均法将细群微观反应截面缩并到更粗的能群结构中。该分析师还必须量化当所选加权谱不适用于实际快谱时所引入的误差。\n\n从由 Boltzmann 输运方程表示的稳态中子平衡出发，并考虑连续能量下的反应率作为基本定义：对于一个微观截面为 $\\sigma_r(E)$、标量通量为 $\\phi(E)$ 的反应道，每个靶核的反应率为 $R_r = \\int \\phi(E)\\,\\sigma_r(E)\\,\\mathrm{d}E$。多群缩并的目标是得到一个粗群微观截面 $\\bar{\\sigma}_{r,G}$，该截面满足以下条件：当与群积分标量通量一起使用时，它能在该粗群上保持反应率不变。物理上正确的定义是使用在粗群上的通量加权平均。\n\n在您的程序中实现以下离散近似：\n1. 将能量离散为 $8$ 个细群，其边界（单位为电子伏特，eV）由有序序列 $\\{10^5,\\;2\\times 10^5,\\;3.5\\times 10^5,\\;5\\times 10^5,\\;8\\times 10^5,\\;1.2\\times 10^6,\\;2.5\\times 10^6,\\;5\\times 10^6,\\;1\\times 10^7\\}$ 给出。设第 $i$ 个细群的区间为 $[E_i,E_{i+1}]$，宽度为 $\\Delta E_i = E_{i+1}-E_i$，并定义一个代表能量 $E_i^\\star = \\sqrt{E_i\\,E_{i+1}}$。\n2. 提供了两个反应道的细群微观截面，单位为靶（其中 $1$ 靶 $=10^{-24}\\,\\mathrm{cm}^2$）：\n   - 吸收：$\\{\\;0.30,\\;0.28,\\;0.26,\\;0.24,\\;0.22,\\;0.20,\\;0.19,\\;0.18\\;\\}$ 靶。\n   - 裂变：$\\{\\;0.20,\\;0.40,\\;0.70,\\;1.00,\\;1.20,\\;1.30,\\;1.25,\\;1.10\\;\\}$ 靶。\n   在进行任何反应率计算之前，将这些值转换为平方厘米。\n3. 实际的快谱细群通量权重由一个简单的快谱代理 $\\phi_i \\propto \\Delta E_i / E_i^\\star$ 定义，并通过乘以 $S = 10^{13}$ 进行缩放，以产生一个物理上真实的量级。通量单位为中子数/平方厘米·秒（$\\mathrm{n}/\\mathrm{cm}^2\\cdot\\mathrm{s}$）。\n4. 通过细群的连续并集构建三个粗群：\n   - 粗群 $G_1$：细群索引 $i = 0,1,2$。\n   - 粗群 $G_2$：细群索引 $i = 3,4,5$。\n   - 粗群 $G_3$：细群索引 $i = 6,7$。\n5. 定义加权谱 $w_i$ 的粗群缩并算子为\n   $$\\bar{\\sigma}_{r,G}(w) = \\frac{\\sum_{i\\in G} w_i\\,\\sigma_{r,i}}{\\sum_{i\\in G} w_i}\\,,$$\n   其中 $r\\in\\{\\text{吸收},\\text{裂变}\\}$ 且 $G\\in\\{G_1,G_2,G_3\\}$。如果在任何粗群中，由于 $w_i$ 与群能量的极端不匹配导致 $\\sum_{i\\in G} w_i = 0$，则使用后备规则 $\\bar{\\sigma}_{r,G}(w) = \\frac{1}{|G|}\\sum_{i\\in G}\\sigma_{r,i}$（即对 $G$ 中的细群进行简单算术平均）。\n6. 当使用不合适的加权谱 $w_i$ 时，通过将粗群反应率预测值与在实际通量 $\\phi_i$ 下的细群真实值进行比较来量化误差。对于给定的反应道 $r$ 和粗群 $G$，将细群中每个靶核的反应率定义为\n   $$R_{r,G}^{\\text{fine}} = \\sum_{i\\in G} \\phi_i\\,\\sigma_{r,i}\\,,$$\n   并将使用缩并截面（用 $w_i$ 计算）应用于实际群积分通量的粗群预测值定义为\n   $$R_{r,G}^{\\text{coarse}}(w) = \\bar{\\sigma}_{r,G}(w)\\,\\sum_{i\\in G}\\phi_i\\,.$$\n   相对误差是无量纲的小数\n   $$\\varepsilon_{r,G}(w) = \\frac{R_{r,G}^{\\text{coarse}}(w) - R_{r,G}^{\\text{fine}}}{R_{r,G}^{\\text{fine}}}\\,.$$\n\n您的程序必须：\n- 对三种测试用例（加权谱）实现上述缩并和误差计算：\n  1. 用例 A（正确的快谱加权）：$w_i = \\phi_i$。\n  2. 用例 B（平坦加权）：$w_i = \\Delta E_i$（在每个细群内能量上是均匀的）。\n  3. 用例 C（类热谱加权，故意使其不适用于快谱）：$w_i = \\Delta E_i\\,\\exp\\!\\big(-E_i^\\star/E_{\\text{th}}\\big)$，其中 $E_{\\text{th}} = 0.025$ eV。该用例的数值将下溢至极小值，可能触发后备规则。\n- 对于每个用例，计算在所有反应道和所有粗群上的最大绝对相对误差，\n  $$\\max_{r\\in\\{\\text{吸收},\\text{裂变}\\},\\;G\\in\\{G_1,G_2,G_3\\}} \\left|\\varepsilon_{r,G}(w)\\right|\\,.$$\n\n物理和数值单位：\n- 能量必须以电子伏特（eV）处理。\n- 通量单位必须为 $\\mathrm{n}/\\mathrm{cm}^2\\cdot\\mathrm{s}$。\n- 在计算反应率之前，微观截面必须从靶转换为平方厘米。\n- 每个靶核的反应率必须以 $\\mathrm{s}^{-1}$ 计算；报告的误差是无量纲小数。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3\\right]$）。\n- 每个结果必须是表示为小数（而非百分比）的浮点数，并四舍五入到六位小数。\n- 三个结果必须按顺序分别对应于用例 A、用例 B 和用例 C。\n\n测试套件与覆盖范围：\n- 上述三个加权谱构成了测试套件，覆盖了：\n  - 一个“理想路径”用例（用例 A），在精确算术下，根据其构造应产生零误差。\n  - 一个中等不合适的谱（用例 B），用于检验对 $\\sigma_{r,i}$ 中能量依赖性的敏感度。\n  - 一个极端不匹配的用例（用例 C），用于检验数值稳定性以及在粗群中总权重为零时指定的后备规则。\n\n您的任务是编写一个完整、可运行的程序，实现此缩并过程并计算指定的三种用例的误差度量。程序必须是独立的，无需用户输入。最终输出必须严格遵守指定的格式。",
            "solution": "问题陈述已经过仔细验证，并被确定为有效。它在科学上基于核反应堆物理的原理，特别是中子输运的多群方法。该问题是良构的，提供了所有必要的数据、定义和约束，从而能够得到唯一且有意义的解。其语言是客观的，规范是数学上精确的。因此，我们可以着手进行形式化的求解。\n\n主要目标是使用不同的加权谱，计算并比较从细群数据导出的粗群微观截面。给定加权方案的准确性，通过其在预测反应率中引入的、与从细群数据计算出的真实反应率相比的相对误差来量化。\n\n首先，我们建立能量离散化方案。能量范围被划分为 $8$ 个细群，由 $9$ 个能量边界定义，记为有序集 $\\{E_k\\}_{k=0}^8$。边界以电子伏特（$\\mathrm{eV}$）为单位给出：$\\{10^5,\\;2\\times 10^5,\\;3.5\\times 10^5,\\;5\\times 10^5,\\;8\\times 10^5,\\;1.2\\times 10^6,\\;2.5\\times 10^6,\\;5\\times 10^6,\\;1\\times 10^7\\}$。对于 $i \\in \\{0, 1, \\dots, 7\\}$，第 $i$ 个细群跨越区间 $[E_i, E_{i+1}]$。细群 $i$ 的宽度为 $\\Delta E_i = E_{i+1} - E_i$，其代表能量定义为几何平均值 $E_i^\\star = \\sqrt{E_i E_{i+1}}$。\n\n给定了两个反应道——吸收（$\\sigma_{a,i}$）和裂变（$\\sigma_{f,i}$）——的细群微观截面，单位为靶。对于所有的反应率计算，必须使用转换因子 $1\\,\\text{靶} = 10^{-24}\\,\\mathrm{cm}^2$ 将这些值转换为 $\\mathrm{cm}^2$。提供的值如下：\n- 吸收，$\\sigma_{a,i}$：$\\{\\;0.30,\\;0.28,\\;0.26,\\;0.24,\\;0.22,\\;0.20,\\;0.19,\\;0.18\\;\\}$ 靶。\n- 裂变，$\\sigma_{f,i}$：$\\{\\;0.20,\\;0.40,\\;0.70,\\;1.00,\\;1.20,\\;1.30,\\;1.25,\\;1.10\\;\\}$ 靶。\n\n参考或“真实”中子谱由细群积分标量通量 $\\phi_i$ 给出。这些通量源于特征性的 $1/E$ 快谱依赖关系，离散近似为 $\\phi_i \\propto \\Delta E_i / E_i^\\star$。为了达到物理上真实的量级，这些权重通过一个因子 $S = 10^{13}$ 进行缩放，从而得到单位为 $\\mathrm{n}/\\mathrm{cm}^2\\cdot\\mathrm{s}$ 的群通量：\n$$ \\phi_i = S \\frac{\\Delta E_i}{E_i^\\star} $$\n\n问题的核心是将这些细群截面缩并成一个更粗的三群结构。粗群被定义为细群的连续块：\n- 粗群 $G_1$：细群索引 $i \\in \\{0, 1, 2\\}$。\n- 粗群 $G_2$：细群索引 $i \\in \\{3, 4, 5\\}$。\n- 粗群 $G_3$：细群索引 $i \\in \\{6, 7\\}$。\n\n缩并过程取决于用于平均细群截面的加权谱 $w_i$。对于群 $G$ 中的反应 $r$，缩并后的粗群截面 $\\bar{\\sigma}_{r,G}$ 由通量加权公式定义：\n$$ \\bar{\\sigma}_{r,G}(w) = \\frac{\\sum_{i\\in G} w_i\\,\\sigma_{r,i}}{\\sum_{i\\in G} w_i} $$\n该定义确保了如果加权谱 $w_i$ 与真实通量谱 $\\phi_i$ 相同，反应率将得以保持。对于群中总权重为零（$\\sum_{i\\in G} w_i = 0$）的情况，指定了一个特殊的后备规则：缩并截面默认为简单算术平均值 $\\bar{\\sigma}_{r,G}(w) = \\frac{1}{|G|}\\sum_{i\\in G}\\sigma_{r,i}$，其中 $|G|$ 是 $G$ 中的细群数量。\n\n为了量化由任意加权谱 $w$ 引入的误差，我们将使用缩并截面计算的反应率与真实反应率进行比较。在粗群 $G$ 中，每个靶核的真实细群反应率为：\n$$ R_{r,G}^{\\text{fine}} = \\sum_{i\\in G} \\phi_i\\,\\sigma_{r,i} $$\n近似的粗群反应率使用缩并截面和真实的粗群积分通量 $\\Phi_G = \\sum_{i\\in G} \\phi_i$ 来计算：\n$$ R_{r,G}^{\\text{coarse}}(w) = \\bar{\\sigma}_{r,G}(w) \\cdot \\Phi_G $$\n相对误差则定义为：\n$$ \\varepsilon_{r,G}(w) = \\frac{R_{r,G}^{\\text{coarse}}(w) - R_{r,G}^{\\text{fine}}}{R_{r,G}^{\\text{fine}}} $$\n每个用例的最终度量是跨越两个反应道和所有三个粗群的最大绝对相对误差。\n\n我们针对三个测试用例进行评估：\n1.  **用例 A（正确加权）**：$w_i = \\phi_i$。通过将 $w_i = \\phi_i$ 代入 $\\bar{\\sigma}_{r,G}$ 的定义，我们发现 $R_{r,G}^{\\text{coarse}}(w) = (\\frac{\\sum \\phi_i \\sigma_{r,i}}{\\sum \\phi_i})(\\sum \\phi_i) = \\sum \\phi_i \\sigma_{r,i} = R_{r,G}^{\\text{fine}}$。因此，理论误差 $\\varepsilon_{r,G}$ 恒等于零。任何非零结果都可归因于浮点运算的限制。\n\n2.  **用例 B（平坦加权）**：$w_i = \\Delta E_i$。这对应于假设能量通量是平坦的，即在每个细群内 $\\phi(E) = \\text{常数}$。由于真实通量具有 $1/E$ 的形状，该加权谱是一种近似，会引入非零误差，这些误差衡量了缩并截面对群内谱形的敏感性。\n\n3.  **用例 C（类热谱加权）**：$w_i = \\Delta E_i\\,\\exp(-E_i^\\star/E_{\\text{th}})$，其中 $E_{\\text{th}} = 0.025\\,\\mathrm{eV}$。此加权谱是热中子系统的典型特征，对于正在研究的高能快谱（$E_i^\\star \\gg E_{\\text{th}}$）来说极其不合适。指数项 $\\exp(-E_i^\\star/E_{\\text{th}})$ 对于所有细群都将数值下溢为零。因此，对于每个粗群 $G$，总权重 $\\sum_{i \\in G} w_i$ 将为零，从而触发后备规则。缩并截面将变为简单的算术平均值，预计会产生较大的误差。\n\n以下数值实现计算了这三种用例中每一种的最大绝对相对误差。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes condensed cross sections and evaluates the error from using different\n    weighting spectra for a fast-spectrum nuclear reactor problem.\n    \"\"\"\n    \n    # 1. Define Givens: Constants, Data, and Physical Parameters\n    BARN_TO_CM2 = 1e-24\n    E_BOUNDS_EV = np.array([1e5, 2e5, 3.5e5, 5e5, 8e5, 1.2e6, 2.5e6, 5e6, 1e7], dtype=np.float64)\n    \n    # Fine-group microscopic cross sections in barns\n    SIGMA_A_FINE_BARNS = np.array([0.30, 0.28, 0.26, 0.24, 0.22, 0.20, 0.19, 0.18], dtype=np.float64)\n    SIGMA_F_FINE_BARNS = np.array([0.20, 0.40, 0.70, 1.00, 1.20, 1.30, 1.25, 1.10], dtype=np.float64)\n    \n    # Convert cross sections to cm^2 before calculations\n    sigma_a_fine = SIGMA_A_FINE_BARNS * BARN_TO_CM2\n    sigma_f_fine = SIGMA_F_FINE_BARNS * BARN_TO_CM2\n    \n    # Flux scaling factor and thermal energy for Case C\n    S_FLUX_SCALE = 1e13\n    E_TH_EV = 0.025\n\n    # 2. Calculate Energy Group Structure Properties\n    # Fine-group widths (Delta E_i)\n    delta_e = E_BOUNDS_EV[1:] - E_BOUNDS_EV[:-1]\n    # Fine-group representative energies (E_i*)\n    e_star = np.sqrt(E_BOUNDS_EV[1:] * E_BOUNDS_EV[:-1])\n    \n    # Coarse group definitions (mapping from coarse to fine indices)\n    coarse_group_indices = {\n        'G1': [0, 1, 2],\n        'G2': [3, 4, 5],\n        'G3': [6, 7]\n    }\n    \n    # 3. Calculate \"True\" Fast-Spectrum Fine-Group Fluxes\n    # phi_i = S * (Delta E_i / E_i*)\n    phi_true = S_FLUX_SCALE * (delta_e / e_star)\n    \n    # 4. Define Weighting Spectra for the Three Test Cases\n    # Case A (correct fast-spectrum weighting)\n    w_case_A = phi_true\n    \n    # Case B (flat weighting)\n    w_case_B = delta_e\n    \n    # Case C (thermal-like weighting)\n    w_case_C = delta_e * np.exp(-e_star / E_TH_EV)\n\n    weighting_spectra_cases = [w_case_A, w_case_B, w_case_C]\n    \n    final_errors = []\n\n    # 5. Process Each Test Case\n    for w_spectrum in weighting_spectra_cases:\n        max_abs_error_for_case = 0.0\n        \n        # Iterate over all coarse groups\n        for indices in coarse_group_indices.values():\n            \n            # Extract fine-group data relevant to the current coarse group\n            phi_g_true = phi_true[indices]\n            w_g = w_spectrum[indices]\n            \n            # Iterate over the two reaction channels\n            for sigma_r_fine in [sigma_a_fine, sigma_f_fine]:\n                sigma_r_fine_g = sigma_r_fine[indices]\n                \n                # Calculate the condensed cross section (sigma_bar)\n                sum_w_sigma = np.sum(w_g * sigma_r_fine_g)\n                sum_w = np.sum(w_g)\n                \n                if sum_w == 0.0:\n                    # Apply fallback rule: arithmetic average\n                    sigma_r_G_bar = np.mean(sigma_r_fine_g)\n                else:\n                    # Standard flux-weighted average\n                    sigma_r_G_bar = sum_w_sigma / sum_w\n                    \n                # Calculate reaction rates and the relative error\n                \n                # True reaction rate from fine-group data\n                R_fine = np.sum(phi_g_true * sigma_r_fine_g)\n                \n                # Coarse-group integrated flux\n                Phi_G_true = np.sum(phi_g_true)\n                \n                # Predicted reaction rate from coarse-group data\n                R_coarse = sigma_r_G_bar * Phi_G_true\n                \n                # Calculate relative error, guarding against division by zero\n                if R_fine == 0.0:\n                    relative_error = 0.0\n                else:\n                    relative_error = (R_coarse - R_fine) / R_fine\n                \n                # Update the maximum absolute error for the current case\n                max_abs_error_for_case = max(max_abs_error_for_case, abs(relative_error))\n                \n        final_errors.append(max_abs_error_for_case)\n\n    # 6. Format and Print the Final Output\n    # The format must be a list of comma-separated floats, rounded to six decimal places.\n    print(f\"[{','.join([f'{err:.6f}' for err in final_errors])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "获得了多群截面常数后，下一步便是将其应用于反应堆堆芯模型中，以求解临界状态和中子通量密度分布。多群扩散方程是实现这一目标的强大而高效的工具。在本实践中 ，您将从第一性原理出发，构建一个双能群扩散模型，并用它来探究反应堆物理中一个至关重要的问题：中子泄漏如何影响堆芯的临界性 ($k$) 和中子能谱。通过对比真空边界（模拟有限尺寸堆芯）和反射边界（模拟无限大系统）的计算结果，您将直观地理解为何快中子谱反应堆对尺寸和几何形状如此敏感。",
            "id": "4235454",
            "problem": "您将实现一个物理上自洽的双群扩散模型，从第一性原理出发，解释反射边界条件与真空边界条件如何改变中子泄漏，从而改变均匀快谱堆和高温气冷堆堆芯中的中子能谱。从一维平板中的中子平衡和菲克定律出发，推导出一个能将材料效应与泄漏明确分开的均匀 $k$-本征值系统，然后量化由边界条件引起的、泄漏驱动的能谱变化。您的程序必须针对两种边界条件求解所得的代数系统，并报告谱硬度和有效增殖因子如何变化。\n\n从以下基本基础开始：(i) 具有各向同性散射和裂变源的稳态、分群中子平衡，(ii) 带有分群扩散系数的菲克定律，以及 (iii) 具有均匀系数的有限平板中基波空间模的一维亥姆霍兹本征问题。使用零通量表示真空界面，零中子流表示反射界面。从此出发点，通过分离变量法得到一个与一维拉普拉斯算子基波空间本征值平方成正比的泄漏项，并将各能群的泄漏表示为 $D_g B^2$ 形式的附加移出项，其中 $D_g$ 是分群扩散系数，$B^2$ 是几何曲率。对于物理厚度为 $L$、材料属性均匀的平板，使用具有相应边界条件的亥姆霍兹问题的最小非负本征值来定义 $B^2$。对于两端均为反射边界（零中子流），基波曲率为零。对于两端均为真空边界（零通量），使用最小正本征值。角度必须以弧度为单位处理。\n\n假设一个双群模型，并包含以下假设：(a) 均匀材料，(b) 没有从群2到群1的上散射，(c) 在实验室坐标系中散射是各向同性的，(d) 裂变中子以固定的双群能谱产生，以及 (e) 反应堆是厚度为 $L$ 的一维平板。设未知数为分群通量幅值 $\\phi_1$ 和 $\\phi_2$ 以及有效增殖因子 $k$。设已知数据为：单位为 $\\mathrm{cm}$ 的分群扩散系数 $D_1$ 和 $D_2$，单位为 $\\mathrm{cm}^{-1}$ 的吸收截面 $\\Sigma_{a1}$ 和 $\\Sigma_{a2}$，单位为 $\\mathrm{cm}^{-1}$ 的下散射截面 $\\Sigma_{s,1\\to 2}$，单位为 $\\mathrm{cm}^{-1}$ 的分群裂变产生截面 $\\nu \\Sigma_{f1}$ 和 $\\nu \\Sigma_{f2}$，以及裂变谱份额 $\\chi_1$ 和 $\\chi_2$，满足 $\\chi_1 + \\chi_2 = 1$ (无量纲)。平板厚度 $L$ 的单位为 $\\mathrm{cm}$。所有输出（$k$ 和下文定义的谱硬度指标）均为无量纲。\n\n需要执行的任务和报告的量：\n- 推导均匀双群 $k$-本征值系统，该系统通过附加移出项 $D_g B^2$ 包含泄漏，并通过一个由 $1/k$ 缩放的右侧算子表示裂变产生。\n- 对每种边界条件（反射和真空），计算有效增殖因子 $k$ 和谱硬度指标 $H = \\dfrac{\\phi_1}{\\phi_1 + \\phi_2}$。\n- 通过计算差值 $\\Delta H = H_{\\text{reflective}} - H_{\\text{vacuum}}$ 和反应性影响 $\\Delta k = k_{\\text{reflective}} - k_{\\text{vacuum}}$ 来量化泄漏驱动的能谱变化。\n\n物理和数值单位：\n- $L$ 的单位为 $\\mathrm{cm}$，$D_g$ 的单位为 $\\mathrm{cm}$，所有截面的单位为 $\\mathrm{cm}^{-1}$。亥姆霍兹本征值中隐含的角度常数必须以弧度解释。输出量 $H$ 和 $k$ 是无量纲的。\n- 将您的最终数值输出表示为小数点后保留 $6$ 位的小数浮点值。\n\n测试套件：\n为以下三个均匀平板实现您的解决方案，每个平板评估两次（两面分别为反射和真空边界）：\n\n- 情况 1 (快谱、紧凑堆芯)：\n  - $L = 100\\,\\mathrm{cm}$,\n  - $D_1 = 1.3\\,\\mathrm{cm}$, $D_2 = 0.4\\,\\mathrm{cm}$,\n  - $\\Sigma_{a1} = 0.008\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a2} = 0.020\\,\\mathrm{cm}^{-1}$,\n  - $\\Sigma_{s,1\\to 2} = 0.050\\,\\mathrm{cm}^{-1}$,\n  - $\\nu \\Sigma_{f1} = 0.007\\,\\mathrm{cm}^{-1}$, $\\nu \\Sigma_{f2} = 0.001\\,\\mathrm{cm}^{-1}$,\n  - $\\chi_1 = 0.95$, $\\chi_2 = 0.05$.\n- 情况 2 (高温气冷堆，中等尺寸)：\n  - $L = 300\\,\\mathrm{cm}$,\n  - $D_1 = 1.0\\,\\mathrm{cm}$, $D_2 = 0.3\\,\\mathrm{cm}$,\n  - $\\Sigma_{a1} = 0.004\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a2} = 0.070\\,\\mathrm{cm}^{-1}$,\n  - $\\Sigma_{s,1\\to 2} = 0.120\\,\\mathrm{cm}^{-1}$,\n  - $\\nu \\Sigma_{f1} = 0.002\\,\\mathrm{cm}^{-1}$, $\\nu \\Sigma_{f2} = 0.006\\,\\mathrm{cm}^{-1}$,\n  - $\\chi_1 = 0.95$, $\\chi_2 = 0.05$.\n- 情况 3 (高温气冷堆，非常大尺寸的堆芯)：\n  - $L = 1000\\,\\mathrm{cm}$,\n  - $D_1 = 1.0\\,\\mathrm{cm}$, $D_2 = 0.3\\,\\mathrm{cm}$,\n  - $\\Sigma_{a1} = 0.004\\,\\mathrm{cm}^{-1}$, $\\Sigma_{a2} = 0.070\\,\\mathrm{cm}^{-1}$,\n  - $\\Sigma_{s,1\\to 2} = 0.120\\,\\mathrm{cm}^{-1}$,\n  - $\\nu \\Sigma_{f1} = 0.002\\,\\mathrm{cm}^{-1}$, $\\nu \\Sigma_{f2} = 0.006\\,\\mathrm{cm}^{-1}$,\n  - $\\chi_1 = 0.95$, $\\chi_2 = 0.05$.\n\n最终输出格式：\n- 对每种情况，按顺序 $[H_{\\text{reflective}}, H_{\\text{vacuum}}, \\Delta H, k_{\\text{reflective}}, k_{\\text{vacuum}}, \\Delta k]$ 生成一个包含六个浮点数的列表，每个数都四舍五入到小数点后 $6$ 位。\n- 您的程序应生成单行输出，其中包含所有三种情况的结果，格式为由逗号分隔的各情况列表的列表，并用方括号括起来，例如：$[[h_{1r},h_{1v},\\Delta h_1,k_{1r},k_{1v},\\Delta k_1],[h_{2r},h_{2v},\\Delta h_2,k_{2r},k_{2v},\\Delta k_2],[h_{3r},h_{3v},\\Delta h_3,k_{3r},k_{3v},\\Delta k_3]]$。",
            "solution": "分析始于均匀一维平板几何的稳态双群中子扩散方程。两个能群分别为群1（快中子）和群2（热中子）。不存在从群2到群1的上散射。在位置 $x$ 处，群 $g$ 中子通量 $\\phi_g(x)$ 的控制方程源于中子平衡原理。\n\n对于群1，中子损失（吸收、移出散射和泄漏）与产生（裂变）之间的平衡为：\n$$\n-\\frac{d}{dx} J_1(x) + \\Sigma_{R1,mat} \\phi_1(x) = \\frac{1}{k} F_1(x)\n$$\n其中 $J_1(x)$ 是中子流，$k$ 是有效增殖因子，$\\Sigma_{R1,mat} = \\Sigma_{a1} + \\Sigma_{s,1\\rightarrow 2}$ 是群1的材料移出截面（吸收截面 $\\Sigma_{a1}$ 和下散射截面 $\\Sigma_{s,1\\rightarrow 2}$ 之和），$F_1(x)$ 是产生于群1的裂变中子。\n\n对于群2，平衡方程包括一个来自快中子下散射的源项：\n$$\n-\\frac{d}{dx} J_2(x) + \\Sigma_{a2} \\phi_2(x) = \\Sigma_{s,1\\rightarrow 2} \\phi_1(x) + \\frac{1}{k} F_2(x)\n$$\n其中 $\\Sigma_{a2}$ 是群2的吸收截面，$F_2(x)$ 是产生于群2的裂变中子。\n\n总裂变源 $F(x)$ 由下式给出：\n$$\nF(x) = \\nu\\Sigma_{f1} \\phi_1(x) + \\nu\\Sigma_{f2} \\phi_2(x)\n$$\n该源出现在群 $g$ 中的份额是 $\\chi_g$，因此 $F_g(x) = \\chi_g F(x)$。\n\n菲克定律将中子流 $J_g(x)$ 与通量梯度联系起来：\n$$\nJ_g(x) = -D_g \\frac{d\\phi_g(x)}{dx}\n$$\n其中 $D_g$ 是群 $g$ 的扩散系数。对于均匀介质，将菲克定律代入平衡方程，得到：\n$$\n-D_1 \\frac{d^2\\phi_1(x)}{dx^2} + (\\Sigma_{a1} + \\Sigma_{s,1\\rightarrow 2}) \\phi_1(x) = \\frac{1}{k} \\left[ \\chi_1 (\\nu\\Sigma_{f1} \\phi_1(x) + \\nu\\Sigma_{f2} \\phi_2(x)) \\right]\n$$\n$$\n-D_2 \\frac{d^2\\phi_2(x)}{dx^2} + \\Sigma_{a2} \\phi_2(x) = \\Sigma_{s,1\\rightarrow 2} \\phi_1(x) + \\frac{1}{k} \\left[ \\chi_2 (\\nu\\Sigma_{f1} \\phi_1(x) + \\nu\\Sigma_{f2} \\phi_2(x)) \\right]\n$$\n为求解这个耦合微分方程组，我们采用分离变量法，假设通量可以写成空间形状函数 $\\psi(x)$ 和依赖于群的幅值 $\\phi_g$ 的乘积：$\\phi_g(x) = \\phi_g \\psi(x)$。空间形状函数 $\\psi(x)$ 必须满足具有相应边界条件的亥姆霍兹方程：\n$$\n\\frac{d^2\\psi(x)}{dx^2} + B^2 \\psi(x) = 0\n$$\n其中 $B^2$ 是几何曲率，一个代表通量曲率的正常量。这意味着 $\\frac{d^2\\phi_g(x)}{dx^2} = -B^2 \\phi_g \\psi(x) = -B^2 \\phi_g(x)$。项 $-D_g \\frac{d^2\\phi_g(x)}{dx^2}$ 变成一个代数泄漏项 $D_g B^2 \\phi_g(x)$。将此代入扩散方程，并除以公共空间模 $\\psi(x)$，得到关于通量幅值 $\\phi_1$ 和 $\\phi_2$ 的齐次代数系统：\n$$\nD_1 B^2 \\phi_1 + (\\Sigma_{a1} + \\Sigma_{s,1\\rightarrow 2}) \\phi_1 = \\frac{1}{k} (\\chi_1 \\nu\\Sigma_{f1} \\phi_1 + \\chi_1 \\nu\\Sigma_{f2} \\phi_2)\n$$\n$$\nD_2 B^2 \\phi_2 + \\Sigma_{a2} \\phi_2 = \\Sigma_{s,1\\rightarrow 2} \\phi_1 + \\frac{1}{k} (\\chi_2 \\nu\\Sigma_{f1} \\phi_1 + \\chi_2 \\nu\\Sigma_{f2} \\phi_2)\n$$\n这些方程可以表示为 $\\mathbf{A} \\vec{\\phi} = \\frac{1}{k} \\mathbf{F} \\vec{\\phi}$ 形式的矩阵本征值问题，其中 $\\vec{\\phi} = [\\phi_1, \\phi_2]^T$。整理各项得：\n$$\n(\\Sigma_{a1} + \\Sigma_{s,1\\rightarrow 2} + D_1 B^2) \\phi_1 - (0) \\phi_2 = \\frac{1}{k} (\\chi_1 \\nu\\Sigma_{f1} \\phi_1 + \\chi_1 \\nu\\Sigma_{f2} \\phi_2)\n$$\n$$\n-\\Sigma_{s,1\\rightarrow 2} \\phi_1 + (\\Sigma_{a2} + D_2 B^2) \\phi_2 = \\frac{1}{k} (\\chi_2 \\nu\\Sigma_{f1} \\phi_1 + \\chi_2 \\nu\\Sigma_{f2} \\phi_2)\n$$\n损失算子矩阵 $\\mathbf{A}$ 和裂变产生矩阵 $\\mathbf{F}$ 分别为：\n$$\n\\mathbf{A} = \\begin{pmatrix} \\Sigma_{a1} + \\Sigma_{s,1\\rightarrow 2} + D_1 B^2  0 \\\\ -\\Sigma_{s,1\\rightarrow 2}  \\Sigma_{a2} + D_2 B^2 \\end{pmatrix}\n$$\n$$\n\\mathbf{F} = \\begin{pmatrix} \\chi_1 \\nu\\Sigma_{f1}  \\chi_1 \\nu\\Sigma_{f2} \\\\ \\chi_2 \\nu\\Sigma_{f1}  \\chi_2 \\nu\\Sigma_{f2} \\end{pmatrix}\n$$\n这个广义本征值问题通常通过将其转换为标准形式 $\\mathbf{M} \\vec{\\phi} = k \\vec{\\phi}$ 来求解，其中 $\\mathbf{M} = \\mathbf{A}^{-1} \\mathbf{F}$。矩阵 $\\mathbf{M}$ 的最大正本征值是有效增殖因子 $k$，其对应的本征向量 $\\vec{\\phi}$ 给出了通量幅值的比率。\n\n几何曲率 $B^2$ 由厚度为 $L$ 的平板上的边界条件决定。\n1.  **反射边界**: 边界处的净流为零（$J_g(\\pm L/2)=0$），这意味着通量梯度为零。对于这些条件，亥姆霍兹方程的最低非负本征值为 $B^2 = 0$。这对应于空间上平坦的通量分布，并代表一个中子泄漏为零的系统，如同在无限大反应堆中一样。\n2.  **真空边界**: 假设通量在外推边界处为零，对于裸平板，外推边界近似于物理边界（$\\phi_g(\\pm L/2) = 0$）。满足这些条件的亥姆霍兹方程的最低正本征值为 $B^2 = (\\pi/L)^2$。这引入了一个非零的泄漏项 $D_g B^2$，它作为一个额外的移出机制。\n\n通过求解 $B^2=0$（反射）和 $B^2=(\\pi/L)^2$（真空）时的本征值问题，我们可以量化泄漏的影响。泄漏会优先移出更快、更易移动的中子（群1，其 $D_1$ 通常更大）。这种本应慢化到群2的中子数量的减少，导致了快中子通量组分的相对增加。因此，在存在泄漏的情况下，能谱会变“硬”。谱硬度由指标 $H = \\frac{\\phi_1}{\\phi_1 + \\phi_2}$ 来量化。我们预期 $H_{\\text{vacuum}}  H_{\\text{reflective}}$。中子泄漏是一种损失机制，因此它会降低堆芯的总反应性。因此，我们预期 $k_{\\text{vacuum}}  k_{\\text{reflective}}$。物理量 $\\Delta H = H_{\\text{reflective}} - H_{\\text{vacuum}}$ 和 $\\Delta k = k_{\\text{reflective}} - k_{\\text{vacuum}}$ 用于衡量这些效应。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (fast-spectrum, compact core)\n        {\n            \"L\": 100.0, \"D1\": 1.3, \"D2\": 0.4,\n            \"Sa1\": 0.008, \"Sa2\": 0.020, \"Ss12\": 0.050,\n            \"nuf1\": 0.007, \"nuf2\": 0.001,\n            \"chi1\": 0.95, \"chi2\": 0.05\n        },\n        # Case 2 (high-temperature gas-cooled reactor, moderate size)\n        {\n            \"L\": 300.0, \"D1\": 1.0, \"D2\": 0.3,\n            \"Sa1\": 0.004, \"Sa2\": 0.070, \"Ss12\": 0.120,\n            \"nuf1\": 0.002, \"nuf2\": 0.006,\n            \"chi1\": 0.95, \"chi2\": 0.05\n        },\n        # Case 3 (high-temperature gas-cooled reactor, very large core)\n        {\n            \"L\": 1000.0, \"D1\": 1.0, \"D2\": 0.3,\n            \"Sa1\": 0.004, \"Sa2\": 0.070, \"Ss12\": 0.120,\n            \"nuf1\": 0.002, \"nuf2\": 0.006,\n            \"chi1\": 0.95, \"chi2\": 0.05\n        }\n    ]\n\n    all_results = []\n    for params in test_cases:\n        # --- Reflective Case ---\n        # For reflective boundaries, geometric buckling is zero.\n        B2_refl = 0.0\n        k_refl, H_refl = calculate_eigen_solution(B2_refl, params)\n\n        # --- Vacuum Case ---\n        # For vacuum boundaries, geometric buckling is (pi/L)^2.\n        B2_vac = (np.pi / params[\"L\"])**2\n        k_vac, H_vac = calculate_eigen_solution(B2_vac, params)\n\n        # --- Calculate differences ---\n        delta_H = H_refl - H_vac\n        delta_k = k_refl - k_vac\n\n        case_results = [H_refl, H_vac, delta_H, k_refl, k_vac, delta_k]\n        all_results.append(case_results)\n\n    # --- Format the output as specified ---\n    # Example: [[h1r,h1v,dh1,k1r,k1v,dk1],[h2r,h2v,dh2,k2r,k2v,dk2],...]\n    sub_lists_str = []\n    for sub_list in all_results:\n        # Format each number to 6 decimal places and join with commas\n        formatted_nums = [f\"{x:.6f}\" for x in sub_list]\n        sub_lists_str.append(f\"[{','.join(formatted_nums)}]\")\n\n    # Join the sub-lists and enclose in the final brackets\n    final_str = f\"[{','.join(sub_lists_str)}]\"\n    print(final_str)\n\ndef calculate_eigen_solution(B2, params):\n    \"\"\"\n    Solves the 2-group k-eigenvalue problem for a given buckling and material properties.\n\n    Args:\n        B2 (float): Geometric buckling B^2.\n        params (dict): Dictionary of nuclear data.\n\n    Returns:\n        tuple: A tuple containing:\n            - k (float): The effective multiplication factor (dominant eigenvalue).\n            - H (float): The spectral hardness metric.\n    \"\"\"\n    # Unpack parameters for clarity\n    D1, D2 = params[\"D1\"], params[\"D2\"]\n    Sa1, Sa2 = params[\"Sa1\"], params[\"Sa2\"]\n    Ss12 = params[\"Ss12\"]\n    nuf1, nuf2 = params[\"nuf1\"], params[\"nuf2\"]\n    chi1, chi2 = params[\"chi1\"], params[\"chi2\"]\n\n    # Define total removal macroscopic cross sections including leakage\n    # Sigma_R1' = Sigma_a1 + Sigma_s,1-2 + D1*B^2\n    # Sigma_R2' = Sigma_a2 + D2*B^2\n    Sigma_R1_prime = Sa1 + Ss12 + D1 * B2\n    Sigma_R2_prime = Sa2 + D2 * B2\n\n    # Fission matrix F\n    F = np.array([\n        [chi1 * nuf1, chi1 * nuf2],\n        [chi2 * nuf1, chi2 * nuf2]\n    ])\n\n    # Inverse of the loss matrix A\n    # A = [[Sigma_R1', 0], [-Ss12, Sigma_R2']]\n    # A_inv = (1/(det(A))) * [[Sigma_R2', 0], [Ss12, Sigma_R1']]\n    A_inv = np.array([\n        [1.0 / Sigma_R1_prime, 0],\n        [Ss12 / (Sigma_R1_prime * Sigma_R2_prime), 1.0 / Sigma_R2_prime]\n    ])\n    \n    # System matrix M = A_inv * F\n    M = A_inv @ F\n    \n    # Solve the eigenvalue problem M*phi = k*phi\n    eigenvalues, eigenvectors = np.linalg.eig(M)\n\n    # The physical solution corresponds to the largest positive real eigenvalue (k_eff)\n    # and its corresponding eigenvector (the flux shape).\n    # For a non-negative matrix M, Perron-Frobenius theorem guarantees this exists.\n    k_eff_idx = np.argmax(np.real(eigenvalues))\n    k = np.real(eigenvalues[k_eff_idx])\n    \n    # The corresponding eigenvector contains the flux amplitudes phi_1 and phi_2\n    flux_vector = np.real(eigenvectors[:, k_eff_idx])\n    phi1 = flux_vector[0]\n    phi2 = flux_vector[1]\n\n    # Ensure positivity of flux components as per physical convention\n    phi1 = abs(phi1)\n    phi2 = abs(phi2)\n\n    # Calculate spectral hardness H = phi_1 / (phi_1 + phi_2)\n    H = phi1 / (phi1 + phi2) if (phi1 + phi2)  0 else 0.0\n    \n    return k, H\n\nsolve()\n```"
        },
        {
            "introduction": "建立模型并获得计算结果只是反应堆分析任务的一半，同样关键的另一半是验证这些结果的准确性。任何确定论模型（如扩散理论）都基于物理近似，因此必须对照更高保真度的基准进行评估。蒙特卡洛方法通过模拟大量中子的随机游走，能够提供近乎精确的“数值实验”结果，是验证确定论程序代码的“金标准”。在本实践中 ，您将学习如何执行模型验证的关键步骤：利用严格的统计检验（如 $z$-检验和 $\\chi^2$ 检验），定量地比较确定论计算与蒙特卡洛参考解之间的差异，并学会区分系统性偏差与统计不确定性。",
            "id": "4235426",
            "problem": "设计并实现一个完整的程序，该程序针对代表快中子能谱和高温气冷堆（HTGR）堆芯的反应堆构型，使用蒙特卡洛（MC）参考解来验证确定论中子输运计算。您的验证必须基于稳态中子输运本征值问题和反应率定义的基本原理，并且必须使用假设检验来定量地区分统计不一致性与系统性偏差。\n\n从基本概念出发：\n- 对于增殖介质的稳态中子输运本征值问题，引入了有效中子增殖因子 $k_{\\text{eff}}$，其定义为中子产生与损失之间的平衡。\n- 反应率由角通量与相应微观或宏观截面乘积的相空间积分定义；在离散化或统计时，它可以表示为对不同区域或能群的求和或积分近似。\n- 在标准抽样假设下，蒙特卡洛（MC）统计量是无偏估计量，其方差源于基础得分的二阶矩；根据中心极限定理，足够大量粒子历史的总和或平均值近似服从高斯分布。\n- 在具有已知标准差的高斯模型下，可以使用双边 $z$ 分数对标量差异进行假设检验，并且可以使用具有适当自由度的卡方统计量来评估多个可观测量的拟合优度。\n\n您的任务：\n1. 对于下述每个测试用例，计算有效中子增殖因子的差异 $\\Delta k = k_{\\text{eff,det}} - k_{\\text{eff,MC}}$，并以 pcm（per cent mille）为单位报告（其中 $1\\,\\text{pcm} = 10^{-5}$），同时在高斯近似下使用 $z$ 分数进行双边显著性检验。将确定论计算值视为相对于 MC 估计值具有可忽略的统计不确定性，并使用提供的 MC 标准差。使用 $\\alpha = 0.05$ 的显著性水平。\n2. 对于每个用例中的反应率集合，将 MC 参考反应率视为具有给定标准差的独立高斯随机变量，并将确定论反应率视为统计不确定性可忽略的点预测值。计算：\n   - 各分量的相对偏差 $(R_{\\text{det},i} - R_{\\text{MC},i})/R_{\\text{MC},i}$，并报告所有分量中最大的绝对相对偏差。\n   - 使用卡方统计量进行全局拟合优度检验。在该检验中，将一个总体归一化因子（一个乘以所有确定论反应率的单一标量缩放因子）视为一个冗余参数，并通过在高斯模型下最小化加权残差平方和来从数据中估计该参数。使用其最小值处的剖面卡方值，并与自由度为反应率分量数减一、显著性水平为 $\\alpha = 0.05$ 的卡方分布进行比较。\n   - 检验最优归一化因子是否显著不为1。使用从同一高斯模型导出的其标准不确定度，并在显著性水平为 $\\alpha = 0.05$ 下报告一个双边决策。\n3. 将这些指标汇总为每个用例的紧凑结果。\n\n您必须在推导中证明其合理性并在实现中编码的假设和建模细节：\n- $k_{\\text{eff}}$ 的 MC 估计值近似服从具有给定标准差的高斯分布。\n- 反应率的 MC 估计值是具有给定标准差的独立高斯变量。\n- 为了这些检验的目的，确定论预测值相对于 MC 而言，其统计不确定性可忽略不计。\n\n测试套件（所有反应率均采用任意但一致的归一化单位；$k_{\\text{eff}}$ 无量纲；MC 标准差为一倍标准差不确定度）：\n- 用例 A (HTGR-like, prismatic block): $k_{\\text{eff,det}} = 1.04540$, $k_{\\text{eff,MC}} = 1.04550$, $\\sigma_{k,\\text{MC}} = 0.00030$。反应率：\n  - $R_{\\text{MC}} = [1.20,\\,0.85,\\,0.60,\\,0.40,\\,0.25,\\,0.10]$,\n  - $\\sigma_{R} = [0.024,\\,0.017,\\,0.012,\\,0.008,\\,0.005,\\,0.002]$,\n  - $R_{\\text{det}} = [1.206,\\,0.847,\\,0.597,\\,0.402,\\,0.251,\\,0.101]$.\n- 用例 B (fast spectrum, helium-cooled): $k_{\\text{eff,det}} = 1.00400$, $k_{\\text{eff,MC}} = 0.99600$, $\\sigma_{k,\\text{MC}} = 0.00020$。反应率：\n  - $R_{\\text{MC}} = [0.90,\\,0.70,\\,0.50,\\,0.35,\\,0.20]$,\n  - $\\sigma_{R} = [0.0135,\\,0.0105,\\,0.0075,\\,0.00525,\\,0.003]$,\n  - $R_{\\text{det}} = [0.96,\\,0.62,\\,0.55,\\,0.30,\\,0.22]$.\n- 用例 C (normalization mismatch dominant): $k_{\\text{eff,det}} = 1.04580$, $k_{\\text{eff,MC}} = 1.04500$, $\\sigma_{k,\\text{MC}} = 0.00040$。反应率：\n  - $R_{\\text{MC}} = [0.50,\\,0.60,\\,0.55,\\,0.40,\\,0.30,\\,0.25,\\,0.20,\\,0.15]$,\n  - $\\sigma_{R} = [0.010,\\,0.012,\\,0.011,\\,0.008,\\,0.006,\\,0.005,\\,0.004,\\,0.003]$,\n  - $R_{\\text{det}} = [0.51,\\,0.612,\\,0.561,\\,0.408,\\,0.306,\\,0.255,\\,0.204,\\,0.153]$.\n\n每个用例的必需输出，按以下确切顺序排列：\n- 以 pcm 为单位的 $\\Delta k$，浮点数格式，\n- $k_{\\text{eff}}$ 差异的双边 $z$ 分数，浮点数格式，\n- 一个布尔值，指示在 $\\alpha = 0.05$ 水平下 $k_{\\text{eff}}$ 的差异是否具有统计显著性，\n- 各分量中最大的绝对相对反应率偏差，浮点数格式，\n- 最小值处的剖面卡方统计量，浮点数格式，\n- 一个布尔值，指示在 $\\alpha = 0.05$ 水平下剖面卡方是否表明存在统计显著的差异，\n- 最优归一化因子，浮点数格式，\n- 一个布尔值，指示在 $\\alpha = 0.05$ 水平下最优归一化因子是否显著不为1。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含以逗号分隔的各用例结果列表，每个用例的结果本身也是一个按上述顺序排列的列表。例如：$[\\,[\\dots],\\,[\\dots],\\,[\\dots]\\,]$。\n- 所有浮点数必须打印小数点后六位。布尔值必须打印为 $True$ 或 $False$。\n- 以 pcm 为单位表示 $\\Delta k$，并按规定四舍五入到小数点后六位。\n- 反应率相对偏差是无量纲的；报告其最大绝对值时应使用小数形式，而不是百分号。\n\n不应从标准输入读取任何输入。所有需要的数据均已在上方提供，并且必须硬编码到您的程序中。使用显著性水平 $\\alpha = 0.05$，如果出现任何角度，应以弧度为单位进行解释（本问题不使用角度）。",
            "solution": "在尝试任何解决方案之前，需对问题陈述进行验证。\n\n**问题验证**\n\n**步骤1：提取的给定条件**\n从业问题陈述中逐字提取了以下数据、定义和条件。\n- **基本概念：**\n  - 有效中子增殖因子：$k_{\\text{eff}}$。\n  - 反应率定义：角通量和截面的相空间积分。\n  - 蒙特卡洛（MC）统计量是无偏估计量，近似服从高斯分布。\n  - 确定论计算的统计不确定性可忽略不计。\n- **任务和指标：**\n  - $k_{\\text{eff}}$ 的差异：$\\Delta k = k_{\\text{eff,det}} - k_{\\text{eff,MC}}$。\n  - 转换为 pcm（per cent mille）：$1\\,\\text{pcm} = 10^{-5}$。\n  - 使用显著性水平为 $\\alpha = 0.05$ 的 $z$ 分数对 $k_{\\text{eff}}$ 进行双边显著性检验。\n  - 分量相对反应率偏差：$(R_{\\text{det},i} - R_{\\text{MC},i})/R_{\\text{MC},i}$。报告最大绝对值。\n  - 使用剖面卡方统计量对反应率进行全局拟合优度检验，其中一个冗余参数（归一化因子）通过最小化加权残差平方和来估计。自由度 = 分量数 - 1。显著性水平 $\\alpha = 0.05$。\n  - 使用其标准不确定度检验单位归一化因子（$c=1$）。在显著性水平 $\\alpha = 0.05$ 下进行双边决策。\n- **测试用例 A (HTGR-like):**\n  - $k_{\\text{eff,det}} = 1.04540$, $k_{\\text{eff,MC}} = 1.04550$, $\\sigma_{k,\\text{MC}} = 0.00030$。\n  - $R_{\\text{MC}} = [1.20,\\,0.85,\\,0.60,\\,0.40,\\,0.25,\\,0.10]$。\n  - $\\sigma_{R} = [0.024,\\,0.017,\\,0.012,\\,0.008,\\,0.005,\\,0.002]$。\n  - $R_{\\text{det}} = [1.206,\\,0.847,\\,0.597,\\,0.402,\\,0.251,\\,0.101]$。\n- **测试用例 B (Fast Spectrum):**\n  - $k_{\\text{eff,det}} = 1.00400$, $k_{\\text{eff,MC}} = 0.99600$, $\\sigma_{k,\\text{MC}} = 0.00020$。\n  - $R_{\\text{MC}} = [0.90,\\,0.70,\\,0.50,\\,0.35,\\,0.20]$。\n  - $\\sigma_{R} = [0.0135,\\,0.0105,\\,0.0075,\\,0.00525,\\,0.003]$。\n  - $R_{\\text{det}} = [0.96,\\,0.62,\\,0.55,\\,0.30,\\,0.22]$。\n- **测试用例 C (Normalization Mismatch):**\n  - $k_{\\text{eff,det}} = 1.04580$, $k_{\\text{eff,MC}} = 1.04500$, $\\sigma_{k,\\text{MC}} = 0.00040$。\n  - $R_{\\text{MC}} = [0.50,\\,0.60,\\,0.55,\\,0.40,\\,0.30,\\,0.25,\\,0.20,\\,0.15]$。\n  - $\\sigma_{R} = [0.010,\\,0.012,\\,0.011,\\,0.008,\\,0.006,\\,0.005,\\,0.004,\\,0.003]$。\n  - $R_{\\text{det}} = [0.51,\\,0.612,\\,0.561,\\,0.408,\\,0.306,\\,0.255,\\,0.204,\\,0.153]$。\n\n**步骤2：使用提取的给定条件进行验证**\n根据验证标准对问题进行评估。\n- **科学性：** 该问题牢固地植根于核反应堆物理和统计推断的原理。使用蒙特卡洛方法作为参考，对 $k_{\\text{eff}}$ 和反应率的定义，中心极限定理的应用，以及 $z$ 检验和 $\\chi^2$ 拟合优度检验的使用，都是反应堆分析和验证领域中标准且公认的做法。\n- **提法明确：** 问题被完全指定。提供了每个测试用例所需的所有数值数据。明确定义了统计模型和程序（例如，高斯近似，$\\chi^2$ 检验的自由度，冗余参数的处理）。精确地列举了所需的输出。\n- **客观性：** 问题以精确、定量和无偏见的技术语言陈述。它不含主观主张或意见。\n- **无缺陷：** 问题不违反任何指定的无效标准。它在科学上是合理的，可形式化的，完整的，可行的，并且提法明确。该任务是将统计方法应用于物理问题的非平凡应用。\n\n**步骤3：结论与行动**\n问题是**有效的**。将提供完整解决方案。\n\n**理论框架与求解推导**\n\n目标是对确定论计算和随机（蒙特卡洛）参考之间的关键反应堆物理参数进行统计比较。我们系统地处理每个所需的指标。\n\n**1. 有效中子增殖因子 ($k_{\\text{eff}}$) 的分析**\n\n差异定义为 $\\Delta k = k_{\\text{eff,det}} - k_{\\text{eff,MC}}$。问题要求以 pcm（per cent mille）为单位报告，其中 $1\\,\\text{pcm} = 10^{-5}$。因此，$\\Delta k_{\\text{pcm}} = \\Delta k \\times 10^5$。\n\n为检验统计显著性，我们建立原假设 $H_0$，即确定论值是对真实物理值的完美预测，而蒙特卡洛方法估计了这个值。形式上，$H_0: k_{\\text{eff,det}} = E[k_{\\text{eff,MC}}]$。根据中心极限定理，MC 估计近似服从高斯分布：$k_{\\text{eff,MC}} \\sim \\mathcal{N}(E[k_{\\text{eff,MC}}], \\sigma_{k,\\text{MC}}^2)$。确定论值被视为一个不确定性可忽略的常数。因此，在 $H_0$ 下，差异 $\\Delta k$ 的分布是 $\\Delta k \\sim \\mathcal{N}(0, \\sigma_{k,\\text{MC}}^2)$。\n\n检验统计量是 $z$ 分数，它以标准差为单位度量差异：\n$$ z_k = \\frac{k_{\\text{eff,det}} - k_{\\text{eff,MC}}}{\\sigma_{k,\\text{MC}}} = \\frac{\\Delta k}{\\sigma_{k,\\text{MC}}} $$\n对于显著性水平 $\\alpha = 0.05$ 的双边检验，如果观测到的 $|z_k|$ 超过临界值 $z_{\\alpha/2}$，我们拒绝 $H_0$。临界值是标准正态分布的分位数，使得 $P(Z  z_{\\alpha/2}) = \\alpha/2 = 0.025$。该值为 $z_{0.025} \\approx 1.96$。如果 $|z_k|  z_{0.025}$，则认为差异具有统计显著性。\n\n**2. 反应率 ($R$) 的分析**\n\n**2.1. 分量相对偏差**\n对于一组 $N$ 个反应率中的每个分量 $i$，确定论值 $R_{\\text{det},i}$ 相对于 MC 参考值 $R_{\\text{MC},i}$ 的相对偏差为：\n$$ b_i = \\frac{R_{\\text{det},i} - R_{\\text{MC},i}}{R_{\\text{MC},i}} $$\n所需的输出是所有分量中最大的绝对相对偏差，即 $\\max_{i=1,\\dots,N} |b_i|$。\n\n**2.2. 将归一化作为冗余参数的全局拟合优度**\n该检验评估向量 $R_{\\text{det}}$ 的*形状*是否与 MC 数据一致，在允许整体缩放差异之后。被检验的模型是 $E[R_{\\text{MC},i}] = c \\cdot R_{\\text{det},i}$，其中 $c$ 是某个最优归一化常数。MC 测量值被建模为独立的高斯随机变量：$R_{\\text{MC},i} \\sim \\mathcal{N}(E[R_{\\text{MC},i}], \\sigma_{R,i}^2)$。\n\n拟合优度通过 $\\chi^2$ 统计量来衡量，定义为标准化残差的平方和：\n$$ \\chi^2(c) = \\sum_{i=1}^{N} \\left( \\frac{R_{\\text{MC},i} - c \\cdot R_{\\text{det},i}}{\\sigma_{R,i}} \\right)^2 $$\n为了剖析掉冗余参数 $c$，我们找到使此 $\\chi^2(c)$ 最小化的值 $\\hat{c}$。这是一个加权最小二乘问题。对 $c$ 求导并令结果为零，得到最优估计量 $\\hat{c}$：\n$$ \\frac{d\\chi^2}{dc} = \\sum_{i=1}^{N} \\frac{2(R_{\\text{MC},i} - c \\cdot R_{\\text{det},i})(-R_{\\text{det},i})}{\\sigma_{R,i}^2} = 0 \\implies \\hat{c} = \\frac{\\sum_{i=1}^{N} (R_{\\text{MC},i} R_{\\text{det},i} / \\sigma_{R,i}^2)}{\\sum_{i=1}^{N} (R_{\\text{det},i}^2 / \\sigma_{R,i}^2)} $$\n剖面（或最小）卡方统计量为 $\\chi^2_{\\text{prof}} = \\chi^2(\\hat{c})$。在模型正确的原假设下，$\\chi^2_{\\text{prof}}$ 服从自由度为 $\\nu = N - 1$ 的卡方分布。由于估计参数 $c$ 消耗了一个自由度。\n\n如果在显著性水平 $\\alpha=0.05$ 下，$\\chi^2_{\\text{prof}}$ 超过临界值 $\\chi^2_{\\nu, 1-\\alpha}$，则拒绝原假设。$\\chi^2_{\\nu, 1-\\alpha}$ 是自由度为 $\\nu$ 的 $\\chi^2$ 分布的上 $100(1-\\alpha)\\%$ 百分位数。\n\n**2.3. 归一化因子的显著性检验**\n我们检验最优归一化因子 $\\hat{c}$ 是否与1一致的假设，即 $H_0: c_{\\text{true}} = 1$。估计量 $\\hat{c}$ 是独立高斯变量 $R_{\\text{MC},i}$ 的线性组合，因此它也服从高斯分布。其方差通过标准误差传播导出为：\n$$ \\sigma_{\\hat{c}}^2 = \\text{Var}(\\hat{c}) = \\frac{1}{\\sum_{i=1}^{N} (R_{\\text{det},i}^2 / \\sigma_{R,i}^2)} $$\n检验统计量是 $c$ 的 $z$ 分数：\n$$ z_c = \\frac{\\hat{c} - 1}{\\sigma_{\\hat{c}}} $$\n与 $k_{\\text{eff}}$ 的检验类似，我们进行双边检验。如果在 $\\alpha = 0.05$ 水平下 $|z_c|  z_{0.025} \\approx 1.96$，则拒绝原假设 $c_{\\text{true}} = 1$。\n\n**算法流程**\n对于每个测试用例，执行以下计算序列：\n1.  计算 $\\Delta k = k_{\\text{eff,det}} - k_{\\text{eff,MC}}$ 并转换为 pcm：$\\Delta k_{\\text{pcm}} = \\Delta k \\times 10^5$。\n2.  计算 $k_{\\text{eff}}$ 的 $z$ 分数：$z_k = \\Delta k / \\sigma_{k,\\text{MC}}$。\n3.  通过检查 $|z_k|  z_{0.025}$ 来确定 $k_{\\text{eff}}$ 的差异是否显著。\n4.  计算反应率的相对偏差向量，并找到其绝对值的最大值。\n5.  计算 $\\hat{c}$ 所需的总和：$S_1 = \\sum_{i=1}^{N} (R_{\\text{MC},i} R_{\\text{det},i} / \\sigma_{R,i}^2)$ 和 $S_2 = \\sum_{i=1}^{N} (R_{\\text{det},i}^2 / \\sigma_{R,i}^2)$。\n6.  计算最优归一化因子：$\\hat{c} = S_1 / S_2$。\n7.  计算剖面卡方统计量：$\\chi^2_{\\text{prof}} = \\sum_{i=1}^{N} ((R_{\\text{MC},i} - \\hat{c} \\cdot R_{\\text{det},i}) / \\sigma_{R,i})^2$。\n8.  确定自由度 $\\nu = N-1$ 并找到临界值 $\\chi^2_{\\nu, 0.95}$。\n9.  通过检查 $\\chi^2_{\\text{prof}}  \\chi^2_{\\nu, 0.95}$ 来确定形状差异是否显著。\n10. 计算归一化因子的标准不确定度：$\\sigma_{\\hat{c}} = 1 / \\sqrt{S_2}$。\n11. 计算归一化因子的 $z$ 分数：$z_c = (\\hat{c} - 1) / \\sigma_{\\hat{c}}$。\n12. 通过检查 $|z_c|  z_{0.025}$ 来确定归一化因子是否显著不为1。\n13. 按指定顺序为每个用例组装这八个结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm, chi2\n\ndef solve():\n    \"\"\"\n    Main function to process test cases and print results.\n    \"\"\"\n    # Significance level for all hypothesis tests\n    alpha = 0.05\n\n    test_cases = [\n        {\n            \"name\": \"Case A (HTGR-like)\",\n            \"k_det\": 1.04540, \"k_mc\": 1.04550, \"sigma_k\": 0.00030,\n            \"r_mc\": np.array([1.20, 0.85, 0.60, 0.40, 0.25, 0.10]),\n            \"sigma_r\": np.array([0.024, 0.017, 0.012, 0.008, 0.005, 0.002]),\n            \"r_det\": np.array([1.206, 0.847, 0.597, 0.402, 0.251, 0.101]),\n        },\n        {\n            \"name\": \"Case B (fast spectrum)\",\n            \"k_det\": 1.00400, \"k_mc\": 0.99600, \"sigma_k\": 0.00020,\n            \"r_mc\": np.array([0.90, 0.70, 0.50, 0.35, 0.20]),\n            \"sigma_r\": np.array([0.0135, 0.0105, 0.0075, 0.00525, 0.003]),\n            \"r_det\": np.array([0.96, 0.62, 0.55, 0.30, 0.22]),\n        },\n        {\n            \"name\": \"Case C (normalization mismatch)\",\n            \"k_det\": 1.04580, \"k_mc\": 1.04500, \"sigma_k\": 0.00040,\n            \"r_mc\": np.array([0.50, 0.60, 0.55, 0.40, 0.30, 0.25, 0.20, 0.15]),\n            \"sigma_r\": np.array([0.010, 0.012, 0.011, 0.008, 0.006, 0.005, 0.004, 0.003]),\n            \"r_det\": np.array([0.51, 0.612, 0.561, 0.408, 0.306, 0.255, 0.204, 0.153]),\n        }\n    ]\n\n    all_results = []\n    \n    # Critical z-value for two-sided test at alpha significance\n    z_crit = norm.ppf(1 - alpha / 2)\n\n    for case in test_cases:\n        # --- 1. k_eff analysis ---\n        delta_k = case[\"k_det\"] - case[\"k_mc\"]\n        delta_k_pcm = delta_k * 1e5\n        \n        z_k = delta_k / case[\"sigma_k\"]\n        k_is_significant = abs(z_k) > z_crit\n\n        # --- 2. Reaction rate analysis ---\n        r_mc, r_det, sigma_r = case[\"r_mc\"], case[\"r_det\"], case[\"sigma_r\"]\n        \n        # Componentwise relative bias\n        relative_biases = (r_det - r_mc) / r_mc\n        max_abs_rel_bias = np.max(np.abs(relative_biases))\n        \n        # Profiled chi-square goodness-of-fit\n        # Weights for the least squares calculation\n        weights = 1 / (sigma_r**2)\n        \n        # Calculate sums for optimal normalization factor c_hat\n        sum_num_c = np.sum(r_mc * r_det * weights)\n        sum_den_c = np.sum(r_det**2 * weights)\n        c_hat = sum_num_c / sum_den_c\n        \n        # Calculate profiled chi-square statistic\n        residuals = r_mc - c_hat * r_det\n        chi2_prof = np.sum((residuals / sigma_r)**2)\n        \n        # Perform significance test for chi-square\n        dof = len(r_mc) - 1\n        chi2_crit = chi2.ppf(1 - alpha, df=dof)\n        chi2_is_significant = chi2_prof > chi2_crit\n        \n        # Test significance of normalization factor\n        sigma_c_hat = np.sqrt(1 / sum_den_c)\n        z_c = (c_hat - 1) / sigma_c_hat\n        c_is_significant = abs(z_c) > z_crit\n\n        # --- 3. Aggregate results ---\n        case_results = [\n            delta_k_pcm,\n            z_k,\n            k_is_significant,\n            max_abs_rel_bias,\n            chi2_prof,\n            chi2_is_significant,\n            c_hat,\n            c_is_significant,\n        ]\n        all_results.append(case_results)\n\n    # Format output according to problem specification.\n    def format_results(results_list):\n        formatted_list = []\n        for item in results_list:\n            if isinstance(item, float):\n                formatted_list.append(f\"{item:.6f}\")\n            else: # bool\n                formatted_list.append(str(item))\n        return f\"[{','.join(formatted_list)}]\"\n\n    output_str = f\"[{','.join(map(format_results, all_results))}]\"\n\n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}