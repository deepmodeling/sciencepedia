{
    "hands_on_practices": [
        {
            "introduction": "在将中子输运方程中的连续角度变量离散化时，我们首先需要理解离散角度集合的基本结构。这个练习旨在帮助你熟悉切比雪夫-勒让德乘积求积的构建方式，特别是方向的对称分布和权重的归一化。通过完成这个练习，你将能够验证求积集如何正确地表示整个单位球面，并为后续更复杂的分析打下坚实的基础。",
            "id": "4216853",
            "problem": "在用于核反应堆模拟的三维（$3\\text{D}$）中子输运中，使用离散纵标（$S_N$）方法时，单位球面上的角积分通过乘积求积法进行计算。考虑切比雪夫-勒让德乘积求积法，其中极向余弦 $ \\mu = \\cos(\\theta) $ 通过在 $[-1,1]$ 上具有 $N_\\mu$ 个节点和权重 $\\{ \\mu_i, w_{\\mu,i} \\}_{i=1}^{N_\\mu}$ 的高斯-勒让德求积法进行离散化，而方位角 $\\phi$ 则通过在 $[0, 2\\pi)$ 上具有 $N_\\phi$ 个点和相等权重 $\\{ \\phi_j, w_{\\phi,j} \\}_{j=1}^{N_\\phi}$ 的均匀切比雪夫（梯形）法则进行离散化。总角测度为 $4\\pi$ 球面度，卦限由笛卡尔方向余弦的符号定义。\n\n假设 $N_\\mu = 12$ 且 $N_\\phi = 16$，方位角以弧度为单位。仅使用关于高斯-勒让德和均匀切比雪夫求积法的基本事实以及球体的对称性，确定此乘积求积法在每个卦限中生成的唯一方向数，并验证所有卦限的求积权重分布之和为 $4\\pi$。以球面度表示总权重和。\n\n请将您的最终答案以一个二元行矩阵的形式给出，其中包含每个卦限的唯一方向数和所有卦限的总权重和，形式为 $\\begin{pmatrix} \\text{每个卦限的方向数}  \\text{总权重和} \\end{pmatrix}$。",
            "solution": "该问题提法恰当，具有科学依据，并包含足够的信息，可以根据指定求积法则的基本性质得出唯一解。问题背景是计算核工程领域的标准情况，术语精确。因此，该问题被认为是有效的。\n\n该问题要求计算与离散纵标（$S_N$）方法中用于离散化单位球的切比雪夫-勒让德乘积求积法相关的两个量。该离散化由来自高斯-勒让德求积法的 $N_\\mu = 12$ 个极向余弦节点和来自均匀切比雪夫（梯形）法则的 $N_\\phi = 16$ 个方位角节点定义。\n\n首先，我们确定每个卦限的唯一离散方向数。\n单位球面上的一个离散方向由一对 $(\\mu_i, \\phi_j)$ 指定，其中 $\\mu_i$ 是一个极向余弦节点，$\\phi_j$ 是一个方位角节点。唯一的离散方向总数 $N_{total}$ 是每个维度中节点数的乘积：\n$$N_{total} = N_\\mu \\times N_\\phi$$\n给定 $N_\\mu = 12$ 和 $N_\\phi = 16$，总方向数为：\n$$N_{total} = 12 \\times 16 = 192$$\n问题要求确定每个卦限中的这些方向的数量。单位球的一个卦限由三个笛卡尔方向余弦的符号定义：$\\Omega_x = \\sqrt{1-\\mu^2}\\cos(\\phi)$，$\\Omega_y = \\sqrt{1-\\mu^2}\\sin(\\phi)$ 和 $\\Omega_z = \\mu$。求积组的对称性是分配这些方向的关键。\n\n1.  **极向节点 ($\\mu_i$) 的对称性：** 在区间 $[-1, 1]$ 上的高斯-勒让德求积法的节点是勒让德多项式 $P_{N_\\mu}(\\mu)$ 的根。由于 $N_\\mu=12$ 是偶数，多项式 $P_{12}(\\mu)$ 是一个偶函数，即 $P_{12}(-\\mu) = P_{12}(\\mu)$。因此，其根关于 $\\mu=0$ 对称。此外，对于偶数 $N_\\mu$，$\\mu=0$ 不是根，因此没有极向节点位于赤道平面（$\\Omega_z = 0$）上。因此，有 $N_\\mu/2 = 12/2 = 6$ 个节点具有正 $\\mu_i$（上半球），以及 $N_\\mu/2 = 6$ 个节点具有负 $\\mu_i$（下半球）。\n\n2.  **方位角节点 ($\\phi_j$) 的对称性：** 方位角使用在 $[0, 2\\pi)$ 上具有 $N_\\phi=16$ 个点的均匀法则进行离散化。由于 $N_\\phi=16$ 是 $4$ 的倍数，这些节点表现出四重旋转对称性。这意味着节点集在旋转 $\\pi/2$ 后保持不变。这确保了节点在 $xy$ 平面的四个象限中均匀分布。\n\n结合这两种对称性，整个 $N_{total} = 192$ 个方向向量集对称地分布在单位球的 $8$ 个卦限中。在实际的 $S_N$ 实现中，每个离散方向被分配到一个单一的卦限，对于一个对称的求积组，每个卦限包含相同数量的方向。因此，每个卦限的唯一方向数是总方向数除以卦限数（$8$）。\n$$\\text{每个卦限的方向数} = \\frac{N_{total}}{8} = \\frac{192}{8} = 24$$\n\n其次，我们验证所有求积权重之和等于 $4\\pi$。\n函数 $f(\\mu, \\phi)$ 在单位球面上的积分为：\n$$I = \\int_{4\\pi} f(\\vec{\\Omega}) d\\Omega = \\int_{-1}^{1} \\int_{0}^{2\\pi} f(\\mu, \\phi) d\\phi \\, d\\mu$$\n乘积求积法将此积分近似为对所有离散方向的求和：\n$$I \\approx \\sum_{i=1}^{N_\\mu} \\sum_{j=1}^{N_\\phi} f(\\mu_i, \\phi_j) w_{\\mu,i} w_{\\phi,j}$$\n与方向 $(\\mu_i, \\phi_j)$ 相关的权重是各个权重的乘积，$w_{ij} = w_{\\mu,i} w_{\\phi,j}$。总权重和 $W_{total}$ 是所有这些乘积权重之和。\n$$W_{total} = \\sum_{i=1}^{N_\\mu} \\sum_{j=1}^{N_\\phi} w_{\\mu,i} w_{\\phi,j} = \\left(\\sum_{i=1}^{N_\\mu} w_{\\mu,i}\\right) \\left(\\sum_{j=1}^{N_\\phi} w_{\\phi,j}\\right)$$\n任何有效求积法则的一个基本性质是它必须能精确地积分常数函数 $f=1$。在定义域上对 $f=1$ 的积分给出了该定义域的测度。\n\n1.  **极向权重之和：** 在 $[-1, 1]$ 上的高斯-勒让德求积法的权重之和为：\n$$\\sum_{i=1}^{N_\\mu} w_{\\mu,i} = \\int_{-1}^{1} 1 \\, d\\mu = [\\mu]_{-1}^{1} = 1 - (-1) = 2$$\n\n2.  **方位角权重之和：** 在 $[0, 2\\pi)$ 上的均匀求积法则的权重之和为：\n$$\\sum_{j=1}^{N_\\phi} w_{\\phi,j} = \\int_{0}^{2\\pi} 1 \\, d\\phi = [\\phi]_{0}^{2\\pi} = 2\\pi - 0 = 2\\pi$$\n\n将这两个和相乘，得到球面上乘积求积法的总权重和：\n$$W_{total} = (2) \\times (2\\pi) = 4\\pi$$\n这证实了该求积法则是正确归一化的，因为总权重和等于单位球的总立体角，即 $4\\pi$ 球面度。\n\n所要求的两个值是每个卦限的唯一方向数（$24$）和总权重和（$4\\pi$）。",
            "answer": "$$\\boxed{\\begin{pmatrix} 24  4\\pi \\end{pmatrix}}$$"
        },
        {
            "introduction": "理解了求积集的基本结构后，下一个关键问题是如何选择合适的求积阶数。这个练习将理论与实践联系起来，通过一个一维平板几何中的线性各向异性散射问题，揭示了极向求积点数 $N_{\\mu}$ 的选择必须满足能够精确计算特定物理矩的最低要求。这强调了求积阶数并非越高越好，而是需要根据待求解问题的物理特性来确定。",
            "id": "4216823",
            "problem": "在一维平板几何的中子输运问题中，散射源通常以极向余弦 $ \\mu \\in [-1,1]$ 的 Legendre 多项式 $P_{\\ell}(\\mu)$ 展开，并在 $L$ 阶截断，其中 $L=1$ 对应于线性各向异性散射。与散射源各向异性部分相关的一阶角矩涉及 $ \\mu P_{1}(\\mu) $ 对 $ \\mu$ 的积分。考虑 Chebyshev–Legendre (CL) 乘积求积法，其中极向余弦积分使用 $N_{\\mu}$ 点 Gauss–Legendre 求积法在 $ \\mu$ 上进行计算，该求积法具有正权重 $w_{i}$ 和关于 $ \\mu=0$ 对称的节点 $\\mu_{i}$。\n\n从 Legendre 多项式的定义 $P_{0}(\\mu)=1$ 和 $P_{1}(\\mu)=\\mu$ 出发，并仅使用 Gauss–Legendre 求积法的标准性质，完成以下任务：\n- 确定一阶矩积分\n$$\nI \\equiv \\int_{-1}^{1} \\mu P_{1}(\\mu) \\, d\\mu\n$$\n的精确值，并解释为什么该积分代表了在线性各向异性散射 ($L=1$) 条件下捕获一阶矩所需的多项式精确度。\n- 通过使用 $ \\mu$ 上的 $N_{\\mu}=1$ Gauss–Legendre 法则直接计算，证明 CL 近似未能重现 $I$ 的值。\n- 确定最小整数 $N_{\\mu}$，使得 $ \\mu$ 上的 Gauss–Legendre 法则对于任何线性各向异性角相关性（即，对于任何在形成一阶矩时其对 $ \\mu$ 的依赖性不超过 $P_{1}$ 中线性各向异性的被积函数），都能得到 $I$ 的精确值。\n\n将你的最终答案表述为在 CL 近似下进行精确一阶矩积分所需的最小 $N_{\\mu}$。无需四舍五入。",
            "solution": "问题陈述已经过严格评估，被认为是有效的。其科学基础在于中子输运理论和数值分析的原理，问题本身是适定的，具有足够的信息以得到唯一解，并以客观、正式的语言表述。因此，我们可以开始进行解答。\n\n该问题要求我们分析在一维平板几何中，用于计算线性各向异性散射源一阶角矩的 Gauss–Legendre 求积格式的精确性。我们需要处理的积分是：\n$$\nI \\equiv \\int_{-1}^{1} \\mu P_{1}(\\mu) \\, d\\mu\n$$\n其中 $P_1(\\mu) = \\mu$ 是一阶 Legendre 多项式，$\\mu$ 是极角的余弦。\n\n首先，我们确定积分 $I$ 的精确值。将定义 $P_1(\\mu) = \\mu$ 代入积分表达式，我们得到：\n$$\nI = \\int_{-1}^{1} \\mu (\\mu) \\, d\\mu = \\int_{-1}^{1} \\mu^{2} \\, d\\mu\n$$\n这个定积分的计算非常直接：\n$$\nI = \\left[ \\frac{\\mu^{3}}{3} \\right]_{-1}^{1} = \\frac{(1)^{3}}{3} - \\frac{(-1)^{3}}{3} = \\frac{1}{3} - \\left(-\\frac{1}{3}\\right) = \\frac{2}{3}\n$$\n另外，我们也可以使用 Legendre 多项式的正交性，其表述为：\n$$\n\\int_{-1}^{1} P_m(x) P_n(x) \\, dx = \\frac{2}{2n+1} \\delta_{mn}\n$$\n其中 $\\delta_{mn}$ 是 Kronecker delta。由于 $P_1(\\mu) = \\mu$，我们的积分 $I$ 正是 $m=n=1$ 的情况：\n$$\nI = \\int_{-1}^{1} P_1(\\mu) P_1(\\mu) \\, d\\mu = \\frac{2}{2(1)+1} \\delta_{11} = \\frac{2}{3}\n$$\n该积分的重要性在于它与求解输运方程的矩量法的联系。对于具有线性各向异性分量 ($L=1$) 的散射源，其源项的角相关性（我们称之为 $S(\\mu)$）包含直至 $P_1(\\mu)$ 的项。该源的一阶矩由 $\\int_{-1}^{1} \\mu S(\\mu) \\, d\\mu$ 给出。因此，被积函数 $\\mu S(\\mu)$ 将包含直至 $\\mu P_1(\\mu) = \\mu^2$ 的项。积分 $I$ 代表了为保持粒子分布的一阶矩而必须被精确积分的最高阶多项式项的贡献。因此，任何数值求积格式必须能够精确积分至少2次的多项式，才能正确地捕获这一物理矩。\n\n接下来，题目要求我们证明 $N_{\\mu}=1$ 的 Gauss–Legendre 求积法则未能重现 $I$ 的精确值。一个通用的 $N$ 点 Gauss–Legendre 求积法则将积分近似为一个加权和：\n$$\n\\int_{-1}^{1} f(\\mu) \\, d\\mu \\approx \\sum_{i=1}^{N} w_i f(\\mu_i)\n$$\n该法则的一个关键性质是：如果 $f(\\mu)$ 是一个次数至多为 $2N-1$ 的多项式，则该法则是精确的。\n对于 $N_{\\mu}=1$，该法则对次数至多为 $2(1)-1=1$ 的多项式是精确的。我们问题中的被积函数是 $f(\\mu) = \\mu P_1(\\mu) = \\mu^2$，这是一个2次多项式。由于 $2 > 1$，我们不期望 $N_{\\mu}=1$ 法则是精确的，并且我们必须明确地证明这一点。\n\n对于 $N_{\\mu}=1$ 法则，单个节点 $\\mu_1$ 是 Legendre 多项式 $P_1(\\mu)$ 的根。由于 $P_1(\\mu) = \\mu$，根为 $\\mu_1 = 0$。相应的权重是 $w_1 = \\int_{-1}^{1} d\\mu = 2$。\n将此法则应用于我们的积分：\n$$\nI_{N_{\\mu}=1} = w_1 f(\\mu_1) = 2 \\cdot f(0)\n$$\n对于 $f(\\mu) = \\mu^2$，我们有：\n$$\nI_{N_{\\mu}=1} = 2 \\cdot (0)^2 = 0\n$$\n精确值为 $I = \\frac{2}{3}$。由于 $0 \\neq \\frac{2}{3}$，我们已明确证明 $N_{\\mu}=1$ 的 Gauss–Legendre 法则未能精确计算该积分。\n\n最后，我们必须确定使 Gauss–Legendre 法则能够得到 $I$ 的精确值的最小整数 $N_{\\mu}$。如前所述，对于任何线性各向异性源，其一阶矩积分 $\\int_{-1}^{1} \\mu S(\\mu) \\, d\\mu$ 将涉及一个次数至多为2的多项式被积函数。设被积函数为 $g(\\mu) = \\mu (\\alpha P_0(\\mu) + \\beta P_1(\\mu)) = \\alpha\\mu + \\beta\\mu^2$。最高次数为 $d=2$。\n为了使 $N_{\\mu}$ 点 Gauss–Legendre 求积法对所有次数不高于 $d$ 的多项式都精确，条件是：\n$$\n2N_{\\mu} - 1 \\ge d\n$$\n代入 $d=2$：\n$$\n2N_{\\mu} - 1 \\ge 2\n$$\n解出 $N_{\\mu}$：\n$$\n2N_{\\mu} \\ge 3 \\implies N_{\\mu} \\ge 1.5\n$$\n由于求积点数 $N_{\\mu}$ 必须是整数，满足此条件的最小整数值为 $N_{\\mu}=2$。\n对于 $N_{\\mu}=2$，Gauss–Legendre 求积法则对所有次数不高于 $2(2)-1 = 3$ 的多项式都是精确的。由于我们的被积函数是2次的，小于3，所以 $N_{\\mu}=2$ 法则将是精确的。\n为了验证，$N_{\\mu}=2$ 的节点是 $P_2(\\mu) = \\frac{1}{2}(3\\mu^2 - 1)$ 的根，即 $\\mu_{1,2} = \\pm \\frac{1}{\\sqrt{3}}$。权重为 $w_1 = w_2 = 1$。$I$ 的数值计算结果为：\n$$\nI_{N_{\\mu}=2} = w_1 f(\\mu_1) + w_2 f(\\mu_2) = (1) \\left(-\\frac{1}{\\sqrt{3}}\\right)^2 + (1) \\left(\\frac{1}{\\sqrt{3}}\\right)^2 = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3}\n$$\n这与精确值相符。因此，所需的最小整数求积点数是2。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "为了将理论知识转化为实际的计算技能，本练习要求你通过编程实现一个源迭代步骤。你将应用切比雪夫-勒让德求积法来计算一个具有方位角依赖性的散射源，并观察方位角分辨率 $N_{\\phi}$ 对迭代收敛性的影响。这个计算实践将让你亲身体验数值混叠（aliasing）现象，这是在选择离散化参数时必须警惕的一个重要数值陷阱。",
            "id": "4216870",
            "problem": "考虑一个均匀平行平板中的不含时、单能、一维线性玻尔兹曼输运方程，其真空边界下的角通量 $\\,\\psi(x,\\mu,\\phi)\\,$ 表示为\n$$\\mu\\,\\frac{\\partial \\psi(x,\\mu,\\phi)}{\\partial x} + \\Sigma_t\\,\\psi(x,\\mu,\\phi) = \\frac{\\Sigma_s}{4\\pi}\\int_{4\\pi} p\\!\\left(\\phi-\\phi'\\right)\\,\\psi(x,\\mu',\\phi')\\,\\mathrm{d}\\Omega' \\,,$$\n其中 $\\,x\\,$ 是空间坐标，$\\,\\mu=\\cos\\theta\\in[-1,1]\\,$ 是相对于平板法线的方向余弦，$\\,\\phi\\in[0,2\\pi)\\,$ 是以弧度为单位的方位角，$\\,\\Sigma_t>0\\,$ 是总宏观截面，$\\,\\Sigma_s\\in(0,\\Sigma_t)\\,$ 是散射宏观截面，$\\,p(\\phi-\\phi')\\,$ 是一个归一化的方位散射相函数。角积分 $\\,\\int_{4\\pi}\\cdot\\,\\mathrm{d}\\Omega'\\,$ 是在单位方向球面上进行的。\n\n该平板的厚度为 $\\,L\\,$，其无量纲光学厚度为 $\\,T=\\Sigma_t L\\,$。没有外部源。散射相函数取为具有单一方位各向异性模态的形式，\n$$p(\\Delta\\phi) = 1 + a\\,\\cos\\!\\big(m\\,\\Delta\\phi\\big)\\,,$$\n其中各向异性振幅 $\\,a\\in[0,1]\\,$，整数方位模态 $\\,m\\ge 1\\,$，并被归一化以满足 $\\,\\frac{1}{4\\pi}\\int_{4\\pi}p(\\Delta\\phi)\\,\\mathrm{d}\\Omega' = 1\\,$。材料参数满足 $\\,\\Sigma_t=1\\,$ 和 $\\,\\Sigma_s = c\\,\\Sigma_t\\,$，其中 $\\,c\\in(0,1)\\,$。\n\n你将使用乘积型 Chebyshev–Legendre 求积法执行单步源迭代 (SI)，定义如下：\n- 在极角变量 $\\,\\mu\\,$ 上，使用 $\\,N_\\mu\\,$ 点 Gauss–Legendre 求积法，作用于区间 $\\,[-1,1]\\,$，其节点为 $\\,\\{\\mu_j\\}_{j=1}^{N_\\mu}\\,$，权重为 $\\,\\{w_{\\mu,j}\\}_{j=1}^{N_\\mu}\\,$。\n- 在方位角变量 $\\,\\phi\\,$ 上，使用 $\\,N_\\phi\\,$ 点等角 Chebyshev 型求积法，作用于区间 $\\,[0,2\\pi)\\,$，其节点均匀取为 $\\,\\phi_k = \\frac{2\\pi(k-1)}{N_\\phi}\\,$，权重相等，为 $\\,w_\\phi = \\frac{2\\pi}{N_\\phi}\\,$。\n\n从初始角通量猜测（独立于 $\\,x\\,$ 和 $\\,\\mu\\,$）开始\n$$\\psi^{(0)}(\\mu,\\phi) = 1 + \\beta\\,\\cos\\!\\big(m\\,\\phi\\big)\\,,$$\n其中 $\\,\\beta\\in[0,1]\\,$。SI 步骤包括：\n1. 使用 Chebyshev–Legendre 乘积型求积法，在单元层面计算散射源 $\\,S(\\phi)\\,$，\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\sum_{j=1}^{N_\\mu}\\sum_{l=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,p\\!\\big(\\phi_k-\\phi_l\\big)\\,\\psi^{(0)}(\\mu_j,\\phi_l)\\,.$$\n2. 对光学厚度为 $\\,T\\,$ 的单个空间单元执行菱形差分扫描，采用真空流入边界条件，以获得每个离散方向 $\\,(\\mu_j,\\phi_k)\\,$ 上的单元平均更新角通量 $\\,\\psi^{(1)}(\\mu_j,\\phi_k)\\,$，\n$$\\psi^{(1)}(\\mu_j,\\phi_k) = \\frac{S(\\phi_k)}{\\Sigma_t}\\left[1 - \\frac{1 - \\exp\\!\\left(-\\frac{T}{|\\mu_j|}\\right)}{\\frac{T}{|\\mu_j|}}\\right]\\,.$$\n\n定义一个收敛率代理指标 $\\,r(N_\\phi)\\,$，其值为更新的单元平均角通量与初始角通量的求积加权 $\\,L^2\\,$ 范数之比，\n$$r(N_\\phi) = \\frac{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}\\,.$$\n该代理指标量化了 SI 步骤对角通量的收缩程度（值越小意味着收缩越快）。\n\n你必须在单个程序中实现以上步骤，并报告以下测试套件的 $\\,r(N_\\phi)\\,$ 值：\n- 理想路径分辨率：$\\,N_\\phi=12\\,$。\n- 中等分辨率：$\\,N_\\phi=6\\,$。\n- 低分辨率：$\\,N_\\phi=4\\,$。\n- 严重混叠边缘情况：$\\,N_\\phi=3\\,$。\n\n使用固定参数 $\\,N_\\mu=8\\,$, $\\,T=2.0\\,$, $\\,\\Sigma_t=1.0\\,$, $\\,c=0.95\\,$, $\\,a=0.6\\,$, $\\,m=3\\,$, $\\,\\beta=0.7\\,$。所有角度必须以弧度为单位，除了指定的无量纲量外，不需要其他物理单位。你的程序应生成单行输出，其中包含四个测试用例的 $\\,r(N_\\phi)\\,$ 值，以逗号分隔的列表形式包含在方括号内，顺序为 $\\,\\big[N_\\phi=12,\\,N_\\phi=6,\\,N_\\phi=4,\\,N_\\phi=3\\big]\\,$，例如 $\\,\\big[0.123,0.456,0.789,1.012\\big]\\,$。输出必须是浮点数。",
            "solution": "问题陈述已经过严格验证，被认为是具有科学依据、适定、客观且内部一致的。它在粒子输运理论的数值方法领域内提出了一个清晰、可形式化的任务。所有必需的参数、方程和边界条件都已提供，不存在矛盾或歧义。该问题是一个非平凡的数值实验，旨在研究求积分辨率对源迭代步骤准确性的影响，特别是突出了方位离散化中的混叠现象。\n\n解决方案通过为给定的一维输运问题实现指定的单步源迭代 (SI) 来进行。目标是为一组不同的方位求积分辨率 $N_\\phi$ 计算收敛率代理指标 $r(N_\\phi)$。计算过程分为以下几个不同的步骤：\n\n1.  **系统与求积设置**：定义问题陈述中指定的所有物理和数值参数。为极角 $\\mu$ 生成 Gauss–Legendre 求积组，为方位角 $\\phi$ 生成等角求积组。\n2.  **初始通量范数计算**：计算初始角通量猜测 $\\psi^{(0)}(\\mu, \\phi)$ 的离散求积加权 $L^2$ 范数。这将作为比率 $r(N_\\phi)$ 的分母。\n3.  **散射源计算**：在每个离散方位角 $\\phi_k$ 处计算散射源项 $S(\\phi)$。这涉及使用乘积型 Chebyshev–Legendre 求积法执行离散卷积积分。\n4.  **更新通量计算**：使用从单个空间单元上的菱形差分扫描导出的给定公式，为每个离散方向 $(\\mu_j, \\phi_k)$ 计算单元平均的更新角通量 $\\psi^{(1)}(\\mu, \\phi)$。\n5.  **更新通量范数计算**：计算更新角通量 $\\psi^{(1)}(\\mu, \\phi)$ 的离散求积加权 $L^2$ 范数。这将是比率 $r(N_\\phi)$ 的分子。\n6.  **收敛率代理指标**：通过将更新通量的范数除以初始通量的范数来计算最终比率 $r(N_\\phi)$。\n\n现在让我们从数学上详细阐述每个步骤。\n\n**1. 系统与求积设置**\n固定参数如下：\n- 总宏观截面：$\\Sigma_t = 1.0$\n- 散射截面与总截面之比：$c = 0.95$\n- 散射宏观截面：$\\Sigma_s = c\\,\\Sigma_t = 0.95$\n- 平板的光学厚度：$T = 2.0$\n- 相函数各向异性振幅：$a = 0.6$\n- 相函数方位模态：$m = 3$\n- 初始通量各向异性振幅：$\\beta = 0.7$\n- 极角求积点数：$N_\\mu = 8$\n\n对于极角 $\\mu \\in [-1, 1]$，我们使用一个 $N_\\mu$ 点 Gauss–Legendre 求积法，其节点为 $\\{\\mu_j\\}_{j=1}^{N_\\mu}$，权重为 $\\{w_{\\mu,j}\\}_{j=1}^{N_\\mu}$。它们的确定方式使得 $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} f(\\mu_j) \\approx \\int_{-1}^1 f(\\mu) \\,\\mathrm{d}\\mu$。一个关键性质是 $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} = \\int_{-1}^1 1\\,\\mathrm{d}\\mu = 2$。\n\n对于方位角 $\\phi \\in [0, 2\\pi)$，我们使用一个 $N_\\phi$ 点等角求积法，其节点和权重由下式给出：\n- 节点：$\\phi_k = \\frac{2\\pi(k-1)}{N_\\phi}$，对于 $k \\in \\{1, 2, \\dots, N_\\phi\\}$\n- 权重：$w_\\phi = \\frac{2\\pi}{N_\\phi}$\n\n**2. 初始通量范数（分母）**\n初始角通量为 $\\psi^{(0)}(\\mu, \\phi) = 1 + \\beta\\,\\cos(m\\phi)$。在离散角度上，即为 $\\psi^{(0)}(\\mu_j, \\phi_k) = 1 + \\beta\\,\\cos(m\\phi_k)$。注意，它与极角 $\\mu_j$ 无关。\n\n$\\psi^{(0)}$ 的平方、求积加权的 $L^2$ 范数定义为：\n$$D^2 = \\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j, \\phi_k)\\big]^2$$\n由于 $\\psi^{(0)}$ 与 $\\mu_j$ 无关，我们可以分离求和：\n$$D^2 = \\left(\\sum_{j=1}^{N_\\mu} w_{\\mu,j}\\right) \\left(\\sum_{k=1}^{N_\\phi} w_\\phi\\,\\big[1 + \\beta\\,\\cos(m\\phi_k)\\big]^2\\right)$$\n利用性质 $\\sum_{j=1}^{N_\\mu} w_{\\mu,j} = 2$，上式可简化为：\n$$D^2 = 2 \\sum_{k=1}^{N_\\phi} w_\\phi\\,\\big[1 + \\beta\\,\\cos(m\\phi_k)\\big]^2$$\n代理指标 $r(N_\\phi)$ 的分母即为 $D = \\sqrt{D^2}$。\n\n**3. 散射源计算**\n散射源 $S(\\phi_k)$ 是为每个离散方位角 $\\phi_k$ 通过以下公式计算的：\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\sum_{j=1}^{N_\\mu}\\sum_{l=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,p(\\phi_k-\\phi_l)\\,\\psi^{(0)}(\\mu_j, \\phi_l)$$\n其中相函数为 $p(\\Delta\\phi) = 1 + a\\,\\cos(m\\Delta\\phi)$。\n\n同样，由于 $\\psi^{(0)}$ 与 $\\mu$ 无关，可以先对 $j$ 进行求和：\n$$S(\\phi_k) = \\frac{\\Sigma_s}{4\\pi}\\left(\\sum_{j=1}^{N_\\mu} w_{\\mu,j}\\right) \\left(\\sum_{l=1}^{N_\\phi} w_\\phi\\,p(\\phi_k-\\phi_l)\\,\\psi^{(0)}(\\phi_l)\\right)$$\n$$S(\\phi_k) = \\frac{\\Sigma_s}{2\\pi} \\sum_{l=1}^{N_\\phi} w_\\phi\\, \\big[1 + a\\,\\cos(m(\\phi_k-\\phi_l))\\big] \\big[1 + \\beta\\,\\cos(m\\phi_l)\\big]$$\n代入 $w_\\phi = 2\\pi/N_\\phi$：\n$$S(\\phi_k) = \\frac{\\Sigma_s}{N_\\phi} \\sum_{l=1}^{N_\\phi} \\big[1 + a\\,\\cos(m(\\phi_k-\\phi_l))\\big] \\big[1 + \\beta\\,\\cos(m\\phi_l)\\big]$$\n此表达式表示一个离散循环卷积。其准确性取决于 $N_\\phi$ 点等角求积法（梯形法则）对被积函数的解析程度，该被积函数是次数为 $2m$ 的三角多项式。对于 $m=3$，临界分辨率为 $N_\\phi > 2m = 6$。当 $N_\\phi \\le 6$ 时，将出现混叠误差，这正是该问题旨在探讨的内容。\n\n**4. 更新通量计算**\n单元平均的更新角通量 $\\psi^{(1)}$ 是为每个方向 $(\\mu_j, \\phi_k)$ 使用上一步计算的散射源 $S(\\phi_k)$ 和给定的输运扫描公式得到的：\n$$\\psi^{(1)}(\\mu_j,\\phi_k) = \\frac{S(\\phi_k)}{\\Sigma_t}\\left[1 - \\frac{1 - \\exp\\!\\left(-\\frac{T}{|\\mu_j|}\\right)}{\\frac{T}{|\\mu_j|}}\\right]$$\n该公式通过括号中的衰减项，将仅依赖于出射方位角 $\\phi_k$ 的源 $S(\\phi_k)$ 与方向余弦 $\\mu_j$ 耦合起来。由于 Gauss–Legendre 节点 $\\mu_j$ 永远不为零，该表达式是良定义的。\n\n**5. 更新通量范数（分子）**\n更新通量 $\\psi^{(1)}$ 的平方、求积加权的 $L^2$ 范数为：\n$$N^2 = \\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j, \\phi_k)\\big]^2$$\n这个双重求和是对所有离散方向计算的。代理指标 $r(N_\\phi)$ 的分子即为 $N = \\sqrt{N^2}$。\n\n**6. 收敛率代理指标**\n最后，收敛率代理指标按两个范数之比计算：\n$$r(N_\\phi) = \\frac{N}{D} = \\frac{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(1)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}{\\left(\\sum_{j=1}^{N_\\mu}\\sum_{k=1}^{N_\\phi} w_{\\mu,j}\\,w_\\phi\\,\\big[\\psi^{(0)}(\\mu_j,\\phi_k)\\big]^2\\right)^{1/2}}$$\n以下程序为测试套件中的每个 $N_\\phi$ 值实现了这一计算序列。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import leggauss\n\ndef calculate_r(N_phi, N_mu, T, Sigma_t, c, a, m, beta):\n    \"\"\"\n    Calculates the convergence-rate proxy r(N_phi) for a given set of parameters.\n    \"\"\"\n    # 1. System and Quadrature Setup\n    Sigma_s = c * Sigma_t\n    \n    # Polar quadrature (Gauss-Legendre) on [-1, 1]\n    # leggauss returns nodes and weights for the interval [-1, 1]\n    mu_nodes, mu_weights = leggauss(N_mu)\n    \n    # Azimuthal quadrature (equiangular) on [0, 2*pi)\n    phi_nodes = 2 * np.pi * np.arange(N_phi) / N_phi\n    phi_weight = 2 * np.pi / N_phi\n\n    # 2. Initial Flux Norm (Denominator)\n    # psi_0 is independent of mu\n    psi0_k = 1 + beta * np.cos(m * phi_nodes)\n    \n    # The sum of mu_weights is exactly 2.0\n    # D^2 = (sum_j w_mu_j) * (sum_k w_phi * psi0_k^2)\n    # D^2 = 2 * sum_k w_phi * psi0_k^2\n    norm_psi0_sq = 2.0 * phi_weight * np.sum(psi0_k**2)\n    \n    # 3. Scattering Source Calculation\n    # Vectorized calculation of S(phi_k)\n    # S_k = (Sigma_s / N_phi) * sum_l p(phi_k - phi_l) * psi0(phi_l)\n    \n    # Create matrices for vectorized computation\n    # phi_k is a column vector, phi_l is a row vector\n    phi_k_col = phi_nodes.reshape(-1, 1)\n    phi_l_row = phi_nodes.reshape(1, -1)\n    \n    # delta_phi_matrix has elements (phi_k - phi_l)\n    delta_phi_matrix = phi_k_col - phi_l_row\n    \n    # p_matrix has elements p(phi_k - phi_l)\n    p_matrix = 1 + a * np.cos(m * delta_phi_matrix)\n    \n    # Perform the discrete convolution via matrix-vector multiplication\n    S_k = (Sigma_s / N_phi) * (p_matrix @ psi0_k)\n\n    # 4. Updated Flux Calculation\n    # psi_1(mu_j, phi_k) calculation\n    # Define mu-dependent attenuation factor\n    # Use np.abs for |mu_j|. The nodes are symmetric around 0.\n    f_j = T / np.abs(mu_nodes)\n    \n    # Handle potential for f_j being very large (mu_j close to 0)\n    # np.exp(-f_j) will underflow to 0, which is correct.\n    # The expression is numerically stable for mu_j != 0, which is true for Gauss-Legendre.\n    attenuation_factor_j = 1 - (1 - np.exp(-f_j)) / f_j\n    \n    # Use broadcasting to compute psi_1 for all (j, k)\n    # S_k is (N_phi,), reshape to (1, N_phi)\n    # attenuation_factor_j is (N_mu,), reshape to (N_mu, 1)\n    # Resulting psi1_jk is a (N_mu, N_phi) matrix\n    psi1_jk = (S_k.reshape(1, -1) / Sigma_t) * attenuation_factor_j.reshape(-1, 1)\n\n    # 5. Updated Flux Norm (Numerator)\n    # N^2 = sum_j sum_k w_mu_j * w_phi * psi1_jk^2\n    # Create the weight matrix w_jk = w_mu_j * w_phi via broadcasting\n    weight_matrix_jk = mu_weights.reshape(-1, 1) * phi_weight\n    norm_psi1_sq = np.sum(weight_matrix_jk * psi1_jk**2)\n    \n    # 6. Convergence-Rate Proxy\n    # r = sqrt(N^2 / D^2)\n    if norm_psi0_sq == 0:\n        return 0.0 # Avoid division by zero, though unlikely here\n    \n    r = np.sqrt(norm_psi1_sq / norm_psi0_sq)\n    \n    return r\n    \ndef solve():\n    \"\"\"\n    Main solver function to run the test suite and print results.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    N_mu = 8\n    T = 2.0\n    Sigma_t = 1.0\n    c = 0.95\n    a = 0.6\n    m = 3\n    beta = 0.7\n    \n    # Define the test cases for N_phi from the problem statement.\n    test_cases_N_phi = [12, 6, 4, 3]\n\n    results = []\n    for N_phi in test_cases_N_phi:\n        result = calculate_r(N_phi, N_mu, T, Sigma_t, c, a, m, beta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Format each number as a float.\n    print(f\"[{','.join(f'{r:.16f}' for r in results)}]\")\n\nsolve()\n\n```"
        }
    ]
}