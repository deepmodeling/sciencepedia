{
    "hands_on_practices": [
        {
            "introduction": "在着手编写复杂的模拟代码之前，首先必须深入理解其背后的物理原理。一个关键步骤是进行量级分析，以判断哪些物理过程在特定条件下起主导作用。本练习将引导你通过量级分析，比较中子先驱在熔盐中通过对流和扩散两种方式输运的相对重要性，从而为在模拟中简化控制方程提供物理依据。",
            "id": "4236395",
            "problem": "在熔盐反应堆（MSR）的一回路通道中，考虑由特征量级为 $U$、沿着特征长度尺度为 $L$ 的不可压缩速度场 $\\boldsymbol{u}(\\boldsymbol{x},t)$ 携带的单一缓发中子先驱体物种的输运，其浓度场为 $C_{i}(\\boldsymbol{x},t)$。该先驱体进行核衰变，衰变常数为 $\\lambda_{i}$，并通过裂变以源密度 $S_{i}(\\boldsymbol{x},t)$ 的形式进行体积生成。该先驱体在熔盐中的分子扩散系数为 $D_{i}$，假定为常数。先驱体的控制性守恒定律基于物种连续性和菲克扩散，扩散通量为 $\\boldsymbol{J}_{i}=-D_{i}\\nabla C_{i}$。\n\n从这些原理出发，建立一个尺度分析，比较 $C_{i}$ 输运过程中的平流时间尺度 $L/U$ 和扩散时间尺度 $L^{2}/D_{i}$。利用此比较来论证在何种流体动力学和分子条件下，物种平衡中的扩散贡献 $-\\nabla\\cdot(D_{i}\\nabla C_{i})$ 相对于平流可以忽略，并明确指出速度量级、长度尺度和分子扩散系数如何进入该判据。然后，将忽略扩散所引入的相对误差 $\\varepsilon_{i}$ 定义为通过相同尺度分析得到的扩散项特征量级与平流项特征量级之比。\n\n最后，根据以下科学上合理的 MSR 运行参数计算 $\\varepsilon_{i}$：$U=0.40$ m/s，$L=2.0$ m，以及 $D_{i}=3.0\\times 10^{-9}$ m²/s。将 $\\varepsilon_{i}$ 表示为十进制数，并将答案四舍五入至四位有效数字。最终报告值无需物理单位。",
            "solution": "问题要求对熔盐反应堆中缓发中子先驱体物种的输运进行尺度分析，论证在特定条件下忽略扩散的合理性，并计算相对误差。求解过程将首先建立控制性输运方程，然后进行尺度分析，最后计算所要求的数值。\n\n先驱体物种浓度 $C_{i}(\\boldsymbol{x},t)$ 的守恒定律由物种连续性原理给出。控制体积内浓度的变化率由进入该体积的净通量和体积内的净生成率平衡。这可以表示为一个偏微分方程：\n$$\n\\frac{\\partial C_{i}}{\\partial t} + \\nabla \\cdot \\boldsymbol{\\Phi}_{i} = R_{i}\n$$\n其中 $\\boldsymbol{\\Phi}_{i}$ 是物种的总通量，$R_{i}$ 是净体积生产率。\n\n总通量 $\\boldsymbol{\\Phi}_{i}$ 是平流通量 $C_{i}\\boldsymbol{u}$ 和扩散通量 $\\boldsymbol{J}_{i}$ 的和。问题陈述扩散通量由菲克定律给出，即 $\\boldsymbol{J}_{i} = -D_{i}\\nabla C_{i}$。因此，总通量为：\n$$\n\\boldsymbol{\\Phi}_{i} = C_{i}\\boldsymbol{u}(\\boldsymbol{x},t) - D_{i}\\nabla C_{i}(\\boldsymbol{x},t)\n$$\n净体积生产率 $R_{i}$ 是裂变产生项 $S_{i}(\\boldsymbol{x},t)$ 和放射性衰变消耗项 $-\\lambda_{i}C_{i}(\\boldsymbol{x},t)$ 的和。\n$$\nR_{i} = S_{i}(\\boldsymbol{x},t) - \\lambda_{i}C_{i}(\\boldsymbol{x},t)\n$$\n将这些表达式代入守恒定律得到：\n$$\n\\frac{\\partial C_{i}}{\\partial t} + \\nabla \\cdot \\left( C_{i}\\boldsymbol{u} - D_{i}\\nabla C_{i} \\right) = S_{i} - \\lambda_{i}C_{i}\n$$\n速度场 $\\boldsymbol{u}$ 是不可压缩流体的速度场，这意味着 $\\nabla \\cdot \\boldsymbol{u} = 0$。扩散系数 $D_{i}$ 假定为常数。我们可以展开散度项：\n$$\n\\nabla \\cdot \\left( C_{i}\\boldsymbol{u} - D_{i}\\nabla C_{i} \\right) = \\nabla \\cdot (C_{i}\\boldsymbol{u}) - \\nabla \\cdot (D_{i}\\nabla C_{i}) = (\\boldsymbol{u} \\cdot \\nabla C_{i} + C_{i}(\\nabla \\cdot \\boldsymbol{u})) - D_{i}\\nabla^{2}C_{i} = \\boldsymbol{u} \\cdot \\nabla C_{i} - D_{i}\\nabla^{2}C_{i}\n$$\n因此，完整的输运方程为：\n$$\n\\frac{\\partial C_{i}}{\\partial t} + \\boldsymbol{u} \\cdot \\nabla C_{i} = D_{i}\\nabla^{2}C_{i} + S_{i} - \\lambda_{i}C_{i}\n$$\n这是平流-扩散-反应方程。$\\boldsymbol{u} \\cdot \\nabla C_{i}$ 项代表平流输运，$D_{i}\\nabla^{2}C_{i}$ 项代表扩散输运。问题中提到的“扩散贡献”为 $-\\nabla\\cdot(D_{i}\\nabla C_{i}) = -D_i \\nabla^2 C_i$。我们将比较此贡献的量级与平流项的量级。\n\n我们现在进行尺度分析，以比较平流和扩散输运项的量级。设 $L$ 为系统的特征长度尺度，$U$ 为速度场的特征量级，$\\Delta C_{i}$ 为先驱体浓度在长度 $L$ 上的特征变化量。\n导数可以用特征尺度的比值来近似：\n$$\n\\nabla \\sim \\frac{1}{L}, \\quad \\nabla^{2} \\sim \\frac{1}{L^{2}}\n$$\n平流项的特征量级为：\n$$\n\\mathcal{O}(\\boldsymbol{u} \\cdot \\nabla C_{i}) \\sim U \\frac{\\Delta C_{i}}{L}\n$$\n扩散项的特征量级为：\n$$\n\\mathcal{O}(D_{i}\\nabla^{2}C_{i}) \\sim D_{i}\\frac{\\Delta C_{i}}{L^{2}}\n$$\n问题要求比较与这两种输运机制相关的时间尺度。\n平流时间尺度 $\\tau_{adv}$ 是流体元行进距离 $L$ 所需的特征时间。它由下式给出：\n$$\n\\tau_{adv} = \\frac{L}{U}\n$$\n扩散时间尺度 $\\tau_{diff}$ 是物种扩散通过距离 $L$ 的特征时间。对瞬态扩散方程 $\\partial C_{i}/\\partial t \\sim D_{i}\\nabla^2 C_{i}$ 进行简单尺度分析，得出 $\\Delta C_{i}/\\tau_{diff} \\sim D_i \\Delta C_{i}/L^2$。这给出了：\n$$\n\\tau_{diff} = \\frac{L^2}{D_i}\n$$\n为了论证相对于平流可以忽略扩散贡献的合理性，平流输运必须占主导地位。这意味着通过整体流动的输运远快于通过分子扩散的输运。用时间尺度来表示，此条件表示为平流时间尺度远小于扩散时间尺度：\n$$\n\\tau_{adv} \\ll \\tau_{diff}\n$$\n$$\n\\frac{L}{U} \\ll \\frac{L^2}{D_i}\n$$\n重排这个不等式，我们得到一个基于无量纲数群的判据：\n$$\n1 \\ll \\frac{UL^2}{D_i L} \\implies \\frac{UL}{D_i} \\gg 1\n$$\n这个无量纲数群是质量传递佩克莱特数，$Pe = \\frac{UL}{D_i}$。它表示平流速率与扩散速率之比。因此，忽略扩散的条件是佩克莱特数必须远大于1（$Pe \\gg 1$）。\n此判据的组成部分与流体动力学和分子条件的关系如下：\n\\begin{enumerate}\n    \\item 速度量级 $U$：对于高流速，可以忽略扩散。\n    \\item 长度尺度 $L$：在较大的长度尺度上，扩散变得不那么重要。\n    \\item 分子扩散系数 $D_{i}$：对于在介质中扩散系数非常低的物种，可以忽略扩散。\n\\end{enumerate}\n高 $U$、大 $L$ 和小 $D_i$ 都有助于增大佩克莱特数，从而增强平流的主导地位。\n\n忽略扩散所引入的相对误差 $\\varepsilon_{i}$ 定义为扩散项的特征量级与平流项的特征量级之比。使用我们的尺度分析：\n$$\n\\varepsilon_{i} = \\frac{\\mathcal{O}(D_{i}\\nabla^{2}C_{i})}{\\mathcal{O}(\\boldsymbol{u} \\cdot \\nabla C_{i})} = \\frac{D_{i}\\Delta C_{i}/L^2}{U\\Delta C_{i}/L} = \\frac{D_{i}}{UL}\n$$\n这个相对误差是佩克莱特数的倒数，$\\varepsilon_{i} = \\frac{1}{Pe}$。\n\n最后，我们根据给定的 MSR 运行参数计算 $\\varepsilon_{i}$：\n$U = 0.40$ m/s\n$L = 2.0$ m\n$D_{i} = 3.0 \\times 10^{-9}$ m²/s\n\n将这些值代入 $\\varepsilon_{i}$ 的表达式中：\n$$\n\\varepsilon_{i} = \\frac{3.0 \\times 10^{-9}\\ \\text{m}^2/\\text{s}}{(0.40\\ \\text{m/s})(2.0\\ \\text{m})} = \\frac{3.0 \\times 10^{-9}}{0.80}\n$$\n$$\n\\varepsilon_{i} = 3.75 \\times 10^{-9}\n$$\n问题要求将答案四舍五入至四位有效数字。\n$$\n\\varepsilon_{i} = 3.750 \\times 10^{-9}\n$$\n$\\varepsilon_i$ 的这个极小值（或者等效地，一个非常大的佩克莱特数 $Pe = 1/\\varepsilon_i \\approx 2.67 \\times 10^8$）证实，对于这些科学上合理的参数，在MSR一回路的主流区中，忽略先驱体输运方程中的分子扩散是一个极好的近似。",
            "answer": "$$\\boxed{3.750 \\times 10^{-9}}$$"
        },
        {
            "introduction": "在确定了控制方程（如此处的对流-衰变方程）之后，下一步便是选择合适的数值方法进行求解。本练习聚焦于瞬态模拟中的一个核心实际问题：时间步长 $\\Delta t$ 的选择。我们将探讨如何平衡显式格式（用于对流项）的稳定性需求与隐式格式（用于衰变项）的精度需求，以确定一个既能保证计算稳定又能兼顾效率的最优时间步长。",
            "id": "4236405",
            "problem": "一维熔盐反应堆堆芯轴向段中，缓发中子先驱核以均匀且为正的熔盐体速度 $\\boldsymbol{u} = u\\,\\hat{\\boldsymbol{x}}$ (从入口流向出口) 运动。先驱核浓度 $C(x,t)$ 满足包含迁移和放射性衰变的守恒定律：$\\partial C/\\partial t + \\nabla \\cdot (u C) = -\\lambda C + S(x,t)$，其中 $\\lambda$ 是衰变常数，$S$ 是可能随空间和时间变化的源项。在对该段进行有限体积离散化时，其横截面积 $A$ 为常数，控制体积由非均匀的轴向单元长度 $\\{\\Delta x_i\\}$ 和体积 $V_i = A\\,\\Delta x_i$ 定义。考虑对迁移通量项采用一阶迎风显式时间积分，并对衰变项采用后向欧拉隐式更新（由于采用隐式处理，衰变项没有稳定性限制）。\n\n给定：\n- 横截面积 $A = 0.050$ m²。\n- 均匀轴向速度 $u = 2.5$ m/s。\n- 十二个轴向单元的长度，从入口到出口：\n$\\Delta x = \\{0.12,\\,0.09,\\,0.14,\\,0.08,\\,0.11,\\,0.10,\\,0.07,\\,0.15,\\,0.09,\\,0.13,\\,0.06,\\,0.10\\}$ m。\n- 目标 Courant–Friedrichs–Lewy (CFL) 数定义为在单个显式时间步长内从任一控制体积中迁出的物质的比例：$C_{\\text{target}} = 0.90$。\n- 对衰变常数 $\\lambda_{\\max} = 3.01$ s⁻¹ 的最快衰变先驱核组的隐式衰变更新的精度要求：对于这个最快衰变的组，以后向欧拉法计算的每步相对放大误差（相对于精确指数衰变来衡量）不得超过 $\\varepsilon = 0.010$。\n\n从显式迁移的离散守恒原理出发，推导满足给定网格的 CFL 要求的最大稳定显式时间步长 $\\Delta t_{\\text{CFL}}$。另外，从衰变的精确放大因子 $\\exp(-\\lambda \\Delta t)$ 和后向欧拉放大因子 $(1+\\lambda \\Delta t)^{-1}$ 出发，推导满足给定 $\\lambda_{\\max}$ 的每步相对放大误差界限 $\\varepsilon$ 的最大时间步长 $\\Delta t_{\\text{decay}}$。然后，结合这两个结果，确定一个单一的有效时间步长 $\\Delta t_{\\text{eff}}$，用于采用显式方法推进迁移、隐式方法推进衰变的瞬态模拟。\n\n将最终答案 $\\Delta t_{\\text{eff}}$ 四舍五入到四位有效数字，并以秒为单位表示。最终答案必须是单个实数。",
            "solution": "该问题要求为熔盐反应堆中先驱核输运的数值模拟确定一个有效的时间步长 $\\Delta t_{\\text{eff}}$。该模拟方案对迁移项使用显式一阶迎风法，对放射性衰变项使用隐式后向欧拉法。时间步长必须同时满足两个独立的约束条件：一个与迁移相关的稳定性条件和一个与衰变相关的精度条件。\n\n首先，我们根据显式迁移处理推导时间步长约束 $\\Delta t_{\\text{CFL}}$。\n一维迁移的控制方程为 $\\frac{\\partial C}{\\partial t} + u \\frac{\\partial C}{\\partial x} = 0$。\n对于体积为 $V_i = A\\,\\Delta x_i$ 的单元 $i$，并假设速度 $u  0$ 且均匀，其一阶迎风有限体积离散格式为：\n$$ \\frac{C_i^{n+1} - C_i^n}{\\Delta t} V_i + u A (C_i^n - C_{i-1}^n) = 0 $$\n重新整理方程以求解 $C_i^{n+1}$，并代入 $V_i = A \\Delta x_i$：\n$$ A \\Delta x_i \\frac{C_i^{n+1} - C_i^n}{\\Delta t} = -u A (C_i^n - C_{i-1}^n) $$\n$$ C_i^{n+1} = C_i^n - \\frac{u \\Delta t}{\\Delta x_i} (C_i^n - C_{i-1}^n) $$\n项 $\\frac{u \\Delta t}{\\Delta x_i}$ 是单元 $i$ 的 Courant 数。问题将目标 Courant–Friedrichs–Lewy (CFL) 数 $C_{\\text{target}}$ 定义为在单个时间步长内从一个控制体积中迁出的物质的比例。这恰好对应于 Courant 数。这种显式格式的稳定性要求 Courant 数至多为 1。这里，我们给定了一个更严格的目标值 $C_{\\text{target}}$。该条件必须对网格中的所有单元都成立：\n$$ \\frac{u \\Delta t}{\\Delta x_i} \\le C_{\\text{target}} \\quad \\forall i $$\n为满足此不等式对每个单元都成立，时间步长 $\\Delta t$ 必须受施加最严格限制的单元的约束。这发生在长度最小的单元上，即 $\\min(\\Delta x_i)$。\n$$ \\Delta t \\le \\frac{C_{\\text{target}} \\min(\\Delta x_i)}{u} $$\n因此，在此约束下的最大允许时间步长为：\n$$ \\Delta t_{\\text{CFL}} = \\frac{C_{\\text{target}} \\min(\\Delta x_i)}{u} $$\n给定的单元长度为 $\\Delta x = \\{0.12,\\,0.09,\\,0.14,\\,0.08,\\,0.11,\\,0.10,\\,0.07,\\,0.15,\\,0.09,\\,0.13,\\,0.06,\\,0.10\\}$ m。最小长度为 $\\min(\\Delta x_i) = 0.06$ m。\n给定的参数为 $u = 2.5$ m/s 和 $C_{\\text{target}} = 0.90$。\n代入这些值：\n$$ \\Delta t_{\\text{CFL}} = \\frac{0.90 \\times 0.06\\,\\text{m}}{2.5\\,\\text{m/s}} = \\frac{0.054}{2.5}\\,\\text{s} = 0.0216\\,\\text{s} $$\n\n其次，我们根据隐式衰变处理的精度推导时间步长约束 $\\Delta t_{\\text{decay}}$。\n纯放射性衰变的方程为 $\\frac{dC}{dt} = -\\lambda C$。在一个时间步长 $\\Delta t$ 内的精确解为 $C(t+\\Delta t) = C(t) \\exp(-\\lambda \\Delta t)$。精确放大因子为 $G_{\\text{exact}} = \\exp(-\\lambda \\Delta t)$。\n该方程的后向欧拉离散格式为：\n$$ \\frac{C^{n+1} - C^n}{\\Delta t} = -\\lambda C^{n+1} $$\n求解 $C^{n+1}$：\n$$ C^{n+1} (1 + \\lambda \\Delta t) = C^n \\implies C^{n+1} = \\frac{1}{1 + \\lambda \\Delta t} C^n $$\n后向欧拉法的数值放大因子为 $G_{\\text{BE}} = (1 + \\lambda \\Delta t)^{-1}$。\n每步相对放大误差 $\\varepsilon_{\\text{rel}}$ 定义为：\n$$ \\varepsilon_{\\text{rel}} = \\frac{|G_{\\text{BE}} - G_{\\text{exact}}|}{G_{\\text{exact}}} $$\n对于 $\\lambda  0$ 和 $\\Delta t  0$，我们有 $1 + \\lambda \\Delta t > \\exp(\\lambda \\Delta t)$，这意味着 $(1 + \\lambda \\Delta t)^{-1}  \\exp(-\\lambda \\Delta t)$。因此，$G_{\\text{BE}}  G_{\\text{exact}}$，不需要绝对值。\n$$ \\varepsilon_{\\text{rel}} = \\frac{G_{\\text{BE}}}{G_{\\text{exact}}} - 1 = \\frac{(1 + \\lambda \\Delta t)^{-1}}{\\exp(-\\lambda \\Delta t)} - 1 = \\frac{\\exp(\\lambda \\Delta t)}{1 + \\lambda \\Delta t} - 1 $$\n问题要求对于衰变最快的先驱核组（其 $\\lambda_{\\max} = 3.01$ s⁻¹），此误差不超过 $\\varepsilon = 0.010$。\n$$ \\frac{\\exp(\\lambda_{\\max} \\Delta t)}{1 + \\lambda_{\\max} \\Delta t} - 1 \\le \\varepsilon $$\n令 $x = \\lambda_{\\max} \\Delta t$。对于小的 $x$，我们可以使用泰勒级数展开：$\\exp(x) \\approx 1 + x + \\frac{x^2}{2}$ 和 $(1+x)^{-1} \\approx 1$。然而，需要对误差项进行更精确的展开。\n误差项是 $\\frac{\\exp(x)}{1+x} - 1$。\n使用 $\\exp(x) \\approx 1+x+\\frac{x^2}{2} + O(x^3)$ 和 $(1+x)^{-1} \\approx 1-x+x^2 + O(x^3)$:\n$$ \\varepsilon_{\\text{rel}} = (1+x+\\frac{x^2}{2} + \\dots)(1) - 1$$\n这不正确。完整项的展开式是：\n$$ \\varepsilon_{\\text{rel}} = \\frac{1 + x + \\frac{x^2}{2} + O(x^3)}{1+x} - 1 = \\left(1 + \\frac{x^2/2 + O(x^3)}{1+x}\\right) - 1 = \\frac{x^2}{2(1+x)} + O(x^3) $$\n对于小的 $x$，误差近似为 $\\frac{x^2}{2}$。所以我们设：\n$$ \\frac{(\\lambda_{\\max} \\Delta t)^2}{2} \\approx \\varepsilon $$\n求解 $\\Delta t$：\n$$ \\Delta t \\approx \\frac{\\sqrt{2\\varepsilon}}{\\lambda_{\\max}} $$\n这给出了满足精度约束的最大时间步长 $\\Delta t_{\\text{decay}}$。\n$$ \\Delta t_{\\text{decay}} = \\frac{\\sqrt{2 \\times 0.010}}{3.01\\,\\text{s}^{-1}} = \\frac{\\sqrt{0.02}}{3.01}\\,\\text{s} \\approx \\frac{0.14142}{3.01}\\,\\text{s} \\approx 0.04698\\,\\text{s} $$\n\n最后，我们确定可用于瞬态模拟的单一有效时间步长 $\\Delta t_{\\text{eff}}$。由于迁移是显式处理，衰变是隐式处理，因此总时间步长必须同时满足两个约束。\n$$ \\Delta t_{\\text{eff}} \\le \\Delta t_{\\text{CFL}} \\quad \\text{和} \\quad \\Delta t_{\\text{eff}} \\le \\Delta t_{\\text{decay}} $$\n为了通过取尽可能大的有效步长来最大化效率，我们必须选择两个上界中的最小值：\n$$ \\Delta t_{\\text{eff}} = \\min(\\Delta t_{\\text{CFL}}, \\Delta t_{\\text{decay}}) $$\n代入计算出的值：\n$$ \\Delta t_{\\text{eff}} = \\min(0.0216\\,\\text{s}, 0.04698\\,\\text{s}) = 0.0216\\,\\text{s} $$\n题目要求将答案四舍五入到四位有效数字。\n$$ \\Delta t_{\\text{eff}} = 0.02160\\,\\text{s} $$",
            "answer": "$$\\boxed{0.02160}$$"
        },
        {
            "introduction": "最后的这项实践将所有关键概念融为一体，要求你动手实现一个耦合了中子扩散与先驱输运的一维模拟程序。本练习的核心是学习如何正确处理不同物理模型之间的耦合，特别是如何确保在中子学计算和先驱输运计算之间，由先驱衰变产生的中子能够被守恒地传递。这是确保整个多物理场模拟有效性的基本要求。",
            "id": "4236346",
            "problem": "考虑一个带有流动燃料的熔盐反应堆的一维板模型，其中中子和缓发中子先驱体都被输运。空间域为区间 $[0,L]$，长度 $L$ 以米为单位。中子场由稳态下的单群中子扩散方程描述，缓发中子先驱体由平流-衰变-产生输运描述。目标是通过由衰变项的单元积分形成扩散方程的缓发中子源，来实现中子学和先驱体输运之间的保守耦合，并通过全局平衡检查来验证守恒性。\n\n基本出发点：\n- 稳态下的中子平衡由单群中子扩散方程建模，该方程源于中子流、吸收和源的平衡。设中子标量通量为 $\\phi(x)$，单位为 $1/(\\text{m}^2\\cdot\\text{s})$。扩散系数为 $D$，单位为米；宏观吸收截面为 $\\Sigma_a$，单位为 $1/\\mathrm{m}$；宏观裂变产生参数为 $\\nu \\Sigma_f$，单位为 $1/\\mathrm{m}$。裂变中子中缓发中子的份额为 $\\beta = \\sum_{i=1}^{N_g} \\beta_i$，其中 $N_g$ 是缓发中子群的数量，$\\beta_i$ 是第 $i$ 群的份额。缓发中子先驱体的浓度为 $C_i(x,t)$，单位为 $1/\\mathrm{m}^3$；衰变常数为 $\\lambda_i$，单位为 $1/\\mathrm{s}$；并以均匀的燃料速度 $v$（单位为 $\\mathrm{m}/\\mathrm{s}$）进行平流输运。\n- 每个群 $i$ 的先驱体输运由一个守恒定律（一个偏微分方程(PDE)）控制，该定律表达了物质导数加衰变等于产生：$\\partial_t C_i + v \\, \\partial_x C_i = \\beta_i \\nu \\Sigma_f \\phi - \\lambda_i C_i$。\n\n边界条件：\n- 对于中子，施加零流反射边界：$\\partial_x \\phi(0) = 0$ 和 $\\partial_x \\phi(L) = 0$。\n- 对于先驱体，在流入边界使用迎风平流格式，并将流入边界浓度固定为零：如果 $v  0$，则 $C_i(0,t) = 0$；如果 $v  0$，则 $C_i(L,t) = 0$；如果 $v = 0$，则平流项不起作用。\n\n离散化框架：\n- 在 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀控制体上使用有限体积法（FVM），共有 $N$ 个单元。设单元中心的索引为 $j = 0,1,\\dots,N-1$。\n- 使用显式迎风格式对平流项进行离散，并使用前向欧拉法对产生和衰变项进行离散，以离散化先驱体输运方程。使用时间步长 $\\Delta t$（单位为秒）和总步数 $N_t$。确保满足 Courant-Friedrichs-Lewy (CFL) 稳定性条件：当 $v \\neq 0$ 时，对于某个选定的 $\\mathrm{CFL} \\in (0,1]$，有 $\\Delta t \\leq \\mathrm{CFL} \\times \\Delta x / |v|$。\n- 使用与反射边界条件一致的二阶中心差分格式对稳态中子扩散方程进行离散。每个单元 $j$ 中的离散方程形式为 $-D \\, \\partial_{xx} \\phi + \\Sigma_a \\phi = S_{\\mathrm{prompt}} + S_{\\mathrm{delayed}}$，其中瞬发源被建模为 $(1 - \\beta) \\nu \\Sigma_f \\phi$。\n\n保守耦合要求：\n- 使用先驱体衰变的单元积分来构造扩散方程中的缓发中子源项，即，对每个单元 $j$，定义缓发源密度为 $S_{\\mathrm{delayed},j} = \\sum_{i=1}^{N_g} \\lambda_i C_{i,j}$，并将其插入到扩散源向量中。这确保了中子方程中的源项等于每个控制体积中先驱体方程所使用的空间积分衰变项。\n\n全局平衡验证：\n- 在耦合推进到准稳态后，计算扩散求解中使用的缓发源的全局积分，并独立地根据先驱体浓度计算衰变项的全局积分。定义\n$$ I_{\\mathrm{delayed}} = \\sum_{j=0}^{N-1} S_{\\mathrm{delayed},j} \\, \\Delta x, \\quad I_{\\mathrm{decay}} = \\sum_{j=0}^{N-1} \\left( \\sum_{i=1}^{N_g} \\lambda_i C_{i,j} \\right) \\Delta x. $$\n- 计算绝对不平衡量 $E = | I_{\\mathrm{delayed}} - I_{\\mathrm{decay}} |$。报告 $E$ 是否小于容差 $\\varepsilon$。\n\n单位和输出规范：\n- 所有物理输入必须按以下单位解释：$L$ 为米，$D$ 为米，$\\Sigma_a$ 为 $1/\\mathrm{m}$，$\\nu \\Sigma_f$ 为 $1/\\mathrm{m}$，$v$ 为 $\\mathrm{m}/\\mathrm{s}$，$\\lambda_i$ 为 $1/\\mathrm{s}$，$\\Delta t$ 为秒，$C_i$ 为 $1/\\mathrm{m}^3$，$\\phi$ 为 $1/(\\text{m}^2\\cdot\\text{s})$。\n- 以 $1/(\\text{m}^2\\cdot\\text{s})$ 的隐含单位表示最终不平衡量 $E$，并将其报告为浮点数。\n- 使用容差 $\\varepsilon = 10^{-10}$，并报告布尔比较结果 $E  \\varepsilon$。\n\n测试套件：\n对以下四个参数集实施上述算法。对于每种情况，模拟 $N_t$ 个时间步，在每个时间步中执行先驱体更新和中子扩散求解，然后计算 $E$以及 $E  \\varepsilon$ 是否成立。\n\n- 情况1（一般流动燃料）：\n  - $L = 1.0$, $N = 100$, $v = 0.2$, $D = 0.01$, $\\Sigma_a = 0.5$, $\\nu \\Sigma_f = 0.6$, $N_g = 2$, $(\\beta_1,\\beta_2) = (0.004, 0.002)$, $(\\lambda_1,\\lambda_2) = (0.1, 0.05)$, $\\Delta t = 0.008$, $N_t = 200$。\n- 情况2（无平流）：\n  - $L = 1.0$, $N = 50$, $v = 0.0$, $D = 0.02$, $\\Sigma_a = 0.3$, $\\nu \\Sigma_f = 0.4$, $N_g = 2$, $(\\beta_1,\\beta_2) = (0.003, 0.0015)$, $(\\lambda_1,\\lambda_2) = (0.08, 0.02)$, $\\Delta t = 0.01$, $N_t = 200$。\n- 情况3（高平流，小时间步）：\n  - $L = 1.0$, $N = 80$, $v = 3.0$, $D = 0.015$, $\\Sigma_a = 0.4$, $\\nu \\Sigma_f = 0.5$, $N_g = 2$, $(\\beta_1,\\beta_2) = (0.005, 0.0025)$, $(\\lambda_1,\\lambda_2) = (0.12, 0.06)$, $\\Delta t = 0.001$, $N_t = 400$。\n- 情况4（粗网格）：\n  - $L = 1.0$, $N = 4$, $v = 0.1$, $D = 0.01$, $\\Sigma_a = 0.6$, $\\nu \\Sigma_f = 0.7$, $N_g = 2$, $(\\beta_1,\\beta_2) = (0.004, 0.001)$, $(\\lambda_1,\\lambda_2) = (0.1, 0.04)$, $\\Delta t = 0.05$, $N_t = 200$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每种情况，按顺序（情况1到情况4）输出不平衡量 $E$ 和容差检查 $E  \\varepsilon$ 的布尔结果。例如，格式必须是 $[E_1, pass_1, E_2, pass_2, E_3, pass_3, E_4, pass_4]$，其中 $E_k$ 是浮点数，$pass_k$ 是布尔值。",
            "solution": "用户提供了一个问题陈述，要求对熔盐反应堆模型实施并验证耦合数值模拟。验证和解决方案如下所示。\n\n### 问题验证\n\n**步骤1：提取给定信息**\n\n- **模型方程：**\n  - 中子扩散（稳态，单群）：$-D \\frac{d^2\\phi}{dx^2} + \\Sigma_a \\phi = (1 - \\beta) \\nu \\Sigma_f \\phi + \\sum_{i=1}^{N_g} \\lambda_i C_i(x)$\n  - 先驱体输运（瞬态）：$\\partial_t C_i + v \\, \\partial_x C_i = \\beta_i \\nu \\Sigma_f \\phi - \\lambda_i C_i$\n- **域：** $x \\in [0, L]$，一维板。\n- **变量和参数：** $\\phi(x)$（中子通量）、$C_i(x,t)$（先驱体浓度）、$D$（扩散系数）、$\\Sigma_a$（吸收截面）、$\\nu \\Sigma_f$（裂变产生）、$\\beta_i$（缓发中子份额）、$\\lambda_i$（衰变常数）、$v$（燃料速度）、$N_g$（先驱体群数）、$\\beta = \\sum_i \\beta_i$。\n- **边界条件（BCs）：**\n  - 中子：在 $x=0$ 和 $x=L$ 处为反射边界，即 $\\partial_x \\phi(0) = 0, \\partial_x \\phi(L) = 0$。\n  - 先驱体：流入浓度为零。如果 $v  0$，则 $C_i(0,t) = 0$。如果 $v  0$，则 $C_i(L,t) = 0$。\n- **离散化：**\n  - 方法：有限体积法（FVM），具有 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元。\n  - 先驱体：平流项采用显式迎风格式，时间步进采用前向欧拉法。时间步长 $\\Delta t$，总步数 $N_t$。\n  - 中子：扩散算子采用二阶中心差分。\n- **耦合：** 单元 $j$ 中中子学方程的缓发源为 $S_{\\mathrm{delayed},j} = \\sum_{i=1}^{N_g} \\lambda_i C_{i,j}$。\n- **验证：**\n  - 全局源积分：$I_{\\mathrm{delayed}} = \\sum_{j=0}^{N-1} S_{\\mathrm{delayed},j} \\, \\Delta x$。\n  - 全局衰变积分：$I_{\\mathrm{decay}} = \\sum_{j=0}^{N-1} (\\sum_{i=1}^{N_g} \\lambda_i C_{i,j}) \\, \\Delta x$。\n  - 不平衡量：$E = |I_{\\mathrm{delayed}} - I_{\\mathrm{decay}}|$。\n  - 容差检查：$E  \\varepsilon$，其中 $\\varepsilon = 10^{-10}$。\n- **测试用例：** 提供了四组参数，为每次运行指定了所有数值和物理常数。\n\n**步骤2：使用提取的给定信息进行验证**\n\n1.  **科学依据：** 该问题使用了反应堆物理学中标准的、公认的方程（单群扩散和先驱体输运）。这些模型虽然简化，但是该领域的 staple，并且是科学上合理的。**结论：有效。**\n2.  **适定性：** 椭圆型（扩散）和双曲型（输运）偏微分方程（PDEs）的组合，加上指定的边界条件和准静态时间步进方案，构成了一个适定问题。其目标不是找到真正的稳态，而是在固定数量的迭代后检查守恒性质，这是一个明确定义的任务。对于显式输运格式的 CFL 稳定性条件已被确认，并且所有测试用例中的参数都满足该条件。**结论：有效。**\n3.  **客观性：** 该问题以完全的数学和数值精度进行了规定。所有参数、方程和程序都得到了客观的定义。**结论：有效。**\n4.  **不完整或矛盾的设置：** 该问题是自洽的。虽然没有给出 $\\phi$ 和 $C_i$ 的初始条件，但标准选择（例如，浓度为零，通量为均匀分布）是隐含的，并且对于这类模拟是合适的。核心验证任务——比较 $I_{\\mathrm{delayed}}$ 和 $I_{\\mathrm{decay}}$——与初始状态无关。**结论：有效。**\n5.  **同义反复性质：** $I_{\\mathrm{delayed}}$ 和 $I_{\\mathrm{decay}}$ 的定义在代数上是相同的。因此，该问题是对数值实现完整性的验证——确保中子学求解器中使用的源项与从先驱体场计算得出的源项完全一致，没有损坏。在计算科学中，这种形式简单但至关重要的验证测试是代码验证的关键部分。**结论：有效。**\n\n**步骤3：结论与行动**\n\n该问题是**有效的**。这是一个在计算反应堆物理学领域中定义明确的练习，重点是正确实现耦合方案和验证守恒原理。将会开发一个完整的解决方案。\n\n### 基于原理的解决方案\n\n该解决方案涉及一个时间推进模拟，该模拟耦合了先驱体输运方程和中子扩散方程。在每个时间步，我们首先根据当前的中子通量分布推进先驱体浓度，然后根据更新后的先驱体浓度求解新的中子通量分布。\n\n**1. 先驱体输运的离散化**\n\n每个群 $i$ 的先驱体输运方程为：\n$$ \\partial_t C_i + v \\, \\partial_x C_i = \\beta_i \\nu \\Sigma_f \\phi - \\lambda_i C_i $$\n我们在一个包含 $N$ 个单元的网格上使用有限体积法，索引为 $j = 0, \\dots, N-1$。对宽度为 $\\Delta x$ 的单元 $j$（从 $x_{j-1/2}$ 到 $x_{j+1/2}$）进行积分，得到半离散形式：\n$$ \\frac{dC_{i,j}}{dt} \\Delta x + (F_{i, j+1/2} - F_{i, j-1/2}) = (\\beta_i \\nu \\Sigma_f \\phi_j - \\lambda_i C_{i,j}) \\Delta x $$\n其中 $C_{i,j}$ 和 $\\phi_j$ 是单元平均量，$F_{i, j \\pm 1/2}$ 是单元界面处的平流通量。使用显式一阶迎风格式，通量取决于速度 $v$ 的符号：\n- 如果 $v  0$：$F_{i, j+1/2} = v C_{i,j}$\n- 如果 $v  0$：$F_{i, j+1/2} = v C_{i,j+1}$\n\n对时间导数应用前向欧拉格式，$\\frac{dC}{dt} \\approx \\frac{C^{n+1} - C^n}{\\Delta t}$，得到全离散更新方程。对于 $v  0$：\n$$ C_{i,j}^{n+1} = C_{i,j}^n - \\frac{v \\Delta t}{\\Delta x} (C_{i,j}^n - C_{i,j-1}^n) + \\Delta t (\\beta_i \\nu \\Sigma_f \\phi_j^n - \\lambda_i C_{i,j}^n) $$\n对于 $v  0$：\n$$ C_{i,j}^{n+1} = C_{i,j}^n - \\frac{v \\Delta t}{\\Delta x} (C_{i,j+1}^n - C_{i,j}^n) + \\Delta t (\\beta_i \\nu \\Sigma_f \\phi_j^n - \\lambda_i C_{i,j}^n) $$\n对于 $v=0$，平流项消失。零流入边界条件用于虚拟单元（例如，如果 $v0$，则 $C_{i,-1}^n = 0$）。\n\n**2. 中子扩散的离散化**\n\n稳态中子扩散方程被重新整理以分离源项：\n$$ -D \\frac{d^2\\phi}{dx^2} + (\\Sigma_a - (1 - \\beta) \\nu \\Sigma_f) \\phi = \\sum_{i=1}^{N_g} \\lambda_i C_i $$\n令 $\\Sigma_{a,eff} = \\Sigma_a - (1-\\beta)\\nu\\Sigma_f$ 为有效吸收截面。方程变为：\n$$ -D \\frac{d^2\\phi}{dx^2} + \\Sigma_{a,eff} \\phi = S_{\\mathrm{delayed}} $$\n在单元 $j$ 上使用二阶中心差分格式对扩散算子进行离散化，得到：\n$$ -D \\frac{\\phi_{j+1} - 2\\phi_j + \\phi_{j-1}}{(\\Delta x)^2} + \\Sigma_{a,eff} \\phi_j = S_{\\mathrm{delayed},j} $$\n这可以写成一个线性系统 $A\\vec{\\phi} = \\vec{S}$，其中 $A$ 是一个三对角矩阵。$A$ 的元素是：\n- 对角线：$A_{j,j} = \\frac{2D}{(\\Delta x)^2} + \\Sigma_{a,eff}$，对于 $j=1, \\dots, N-2$。\n- 次对角线：$A_{j,j-1} = A_{j,j+1} = -\\frac{D}{(\\Delta x)^2}$。\n\n反射边界条件 $\\partial_x \\phi = 0$ 意味着穿过外部边界的中子流为零。对于FVM，这修改了边界单元（$j=0$ 和 $j=N-1$）的方程：\n- 对于 $j=0$：来自左侧的通量为零，意味着 $\\phi_{-1} = \\phi_0$。对角线元素变为 $A_{0,0} = \\frac{D}{(\\Delta x)^2} + \\Sigma_{a,eff}$，并且与单元-1的连接被移除。\n- 对于 $j=N-1$：向右的通量为零，意味着 $\\phi_{N} = \\phi_{N-1}$。对角线元素变为 $A_{N-1,N-1} = \\frac{D}{(\\Delta x)^2} + \\Sigma_{a,eff}$，并且与单元N的连接被移除。\n这个三对角系统在每个时间步都可以高效地求解 $\\vec{\\phi}$。\n\n**3. 耦合算法与守恒验证**\n\n模拟迭代进行。从初始通量 $\\phi^0$（例如，均匀分布）和零先驱体浓度 $C^0$ 开始，对 $n=0, \\dots, N_t-1$ 重复以下步骤：\n1.  **先驱体更新：** 使用离散输运方程计算新的先驱体浓度 $C^{n+1}$，其源项取决于当前通量 $\\phi^n$。\n2.  **源计算：** 为扩散求解构建缓发中子源向量 $S_{\\mathrm{delayed}}^{n+1}$，其中 $S_{\\mathrm{delayed}, j}^{n+1} = \\sum_{i=1}^{N_g} \\lambda_i C_{i,j}^{n+1}$。\n3.  **中子通量求解：** 求解线性系统 $A \\phi^{n+1} = S_{\\mathrm{delayed}}^{n+1}$ 以找到新的中子通量 $\\phi^{n+1}$。\n\n经过 $N_t$ 个时间步后，我们进行验证。“保守耦合”意味着由缓发先驱体衰变产生的总中子数在中子学计算中被完全计为源。验证测试通过数值方式证实了这一点：\n1.  计算 $I_{\\mathrm{delayed}} = \\sum_{j=0}^{N-1} S_{\\mathrm{delayed},j} \\, \\Delta x$，其中 $S_{\\mathrm{delayed},j}$ 是最终中子学求解中使用的源向量的元素。\n2.  独立地，从最终先驱体浓度场 $C$ 计算 $I_{\\mathrm{decay}} = \\sum_{j=0}^{N-1} \\left( \\sum_{i=1}^{N_g} \\lambda_i C_{i,j} \\right) \\Delta x$。\n3.  计算绝对不平衡量 $E = |I_{\\mathrm{delayed}} - I_{\\mathrm{decay}}|$。根据构造，这两个量由相同的公式定义。任何非零差异纯粹由浮点运算误差引起，应在机器精度的数量级上。检查 $E  10^{-10}$ 验证了耦合的程序实现是正确的。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the MSR simulation for all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (general flowing fuel)\n        {\n            \"L\": 1.0, \"N\": 100, \"v\": 0.2, \"D\": 0.01, \"Sa\": 0.5, \"nu_Sf\": 0.6,\n            \"Ng\": 2, \"betas\": np.array([0.004, 0.002]), \"lambdas\": np.array([0.1, 0.05]),\n            \"dt\": 0.008, \"Nt\": 200\n        },\n        # Case 2 (no advection)\n        {\n            \"L\": 1.0, \"N\": 50, \"v\": 0.0, \"D\": 0.02, \"Sa\": 0.3, \"nu_Sf\": 0.4,\n            \"Ng\": 2, \"betas\": np.array([0.003, 0.0015]), \"lambdas\": np.array([0.08, 0.02]),\n            \"dt\": 0.01, \"Nt\": 200\n        },\n        # Case 3 (high advection, smaller time step)\n        {\n            \"L\": 1.0, \"N\": 80, \"v\": 3.0, \"D\": 0.015, \"Sa\": 0.4, \"nu_Sf\": 0.5,\n            \"Ng\": 2, \"betas\": np.array([0.005, 0.0025]), \"lambdas\": np.array([0.12, 0.06]),\n            \"dt\": 0.001, \"Nt\": 400\n        },\n        # Case 4 (coarse grid)\n        {\n            \"L\": 1.0, \"N\": 4, \"v\": 0.1, \"D\": 0.01, \"Sa\": 0.6, \"nu_Sf\": 0.7,\n            \"Ng\": 2, \"betas\": np.array([0.004, 0.001]), \"lambdas\": np.array([0.1, 0.04]),\n            \"dt\": 0.05, \"Nt\": 200\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        imbalance, pass_check = run_simulation(**params)\n        results.append(imbalance)\n        results.append(pass_check)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(L, N, v, D, Sa, nu_Sf, Ng, betas, lambdas, dt, Nt):\n    \"\"\"\n    Performs one coupled neutronics-precursor simulation and returns the imbalance.\n    \"\"\"\n    dx = L / N\n    beta_total = np.sum(betas)\n\n    # Initial conditions\n    phi = np.ones(N)\n    C = np.zeros((Ng, N))\n    \n    # Pre-build the diffusion matrix A\n    Sa_eff = Sa - (1.0 - beta_total) * nu_Sf\n    d_xx_coeff = D / (dx**2)\n    \n    diag = np.full(N, 2.0 * d_xx_coeff + Sa_eff)\n    upper = np.full(N - 1, -d_xx_coeff)\n    lower = np.full(N - 1, -d_xx_coeff)\n    \n    # Apply reflective boundary conditions\n    diag[0] = d_xx_coeff + Sa_eff\n    diag[N-1] = d_xx_coeff + Sa_eff\n    \n    # Format for scipy's banded solver\n    A_banded = np.zeros((3, N))\n    A_banded[0, 1:] = upper\n    A_banded[1, :] = diag\n    A_banded[2, :-1] = lower\n    \n    # Time-stepping loop\n    for _ in range(Nt):\n        # 1. Update Precursor Concentrations\n        C_new = C.copy()\n        \n        # Reshape for broadcasting\n        lambdas_b = lambdas[:, np.newaxis]\n        betas_b = betas[:, np.newaxis]\n\n        # Production and decay terms\n        production_decay = dt * (betas_b * nu_Sf * phi - lambdas_b * C)\n        C_new += production_decay\n        \n        # Advection term\n        if v != 0.0:\n            courant = v * dt / dx\n            if v > 0:\n                # Upwind scheme for v > 0\n                C_shifted = np.roll(C, 1, axis=1)\n                C_shifted[:, 0] = 0.0  # Inflow boundary condition at x=0\n                advection = -courant * (C - C_shifted)\n                C_new += advection\n            else: # v  0\n                # Upwind scheme for v  0\n                C_shifted = np.roll(C, -1, axis=1)\n                C_shifted[:, -1] = 0.0 # Inflow boundary condition at x=L\n                advection = -courant * (C_shifted - C)\n                C_new += advection\n        \n        C = C_new\n        \n        # 2. Neutron Diffusion Solve\n        # Form delayed neutron source vector from new precursor concentrations\n        S_delayed = np.sum(lambdas_b * C, axis=0)\n        \n        # Solve the linear system A*phi = S_delayed\n        phi = solve_banded((1, 1), A_banded, S_delayed)\n        \n    # Global Balance Verification\n    # 1. Compute I_delayed from the source vector used in the final solve\n    # Note: S_delayed was already computed in the last step of the loop\n    I_delayed = np.sum(S_delayed) * dx\n\n    # 2. Independently compute I_decay from the final precursor concentrations\n    decay_term_from_C = np.sum(lambdas[:, np.newaxis] * C, axis=0)\n    I_decay = np.sum(decay_term_from_C) * dx\n\n    # 3. Compute absolute imbalance E\n    E = abs(I_delayed - I_decay)\n    \n    epsilon = 1e-10\n    pass_check = E  epsilon\n    \n    return E, pass_check\n\nsolve()\n```"
        }
    ]
}