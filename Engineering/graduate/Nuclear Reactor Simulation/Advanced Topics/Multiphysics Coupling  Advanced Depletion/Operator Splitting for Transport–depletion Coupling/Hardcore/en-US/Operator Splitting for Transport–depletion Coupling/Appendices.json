{
    "hands_on_practices": [
        {
            "introduction": "The fundamental challenge in operator splitting arises because the transport and depletion processes do not commute. This first practice goes back to first principles to explore the mathematical origin of this non-commutativity. Using a simplified, linear two-state model, you will directly derive the leading-order splitting error by expanding the matrix exponentials, revealing how it is fundamentally linked to the commutator of the transport and depletion operators . This exercise builds the foundational intuition for all subsequent error analysis.",
            "id": "4240100",
            "problem": "A single homogeneous spatial region in a nuclear reactor is modeled over a short time interval by a linearized, two-state system that couples neutron transport and nuclide depletion. Let the state vector be $\\mathbf{y}(t) = \\begin{pmatrix} \\psi(t) \\\\ N(t) \\end{pmatrix}$, where $\\psi(t)$ is a scalar neutron flux amplitude and $N(t)$ is the number density of a single representative nuclide. Over a small time step $\\Delta t$, assume the evolution is governed by a linear system $\\dot{\\mathbf{y}}(t) = (\\mathbf{T} + \\mathbf{D}) \\mathbf{y}(t)$ with constant operators\n$$\n\\mathbf{T} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix}, \\qquad\n\\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix},\n$$\nwhere $s$, $r$, $p$, and $\\lambda$ are real constants that do not vary during the step and represent, respectively, a linearized neutron transport growth rate, the sensitivity of neutron amplitude to nuclide density, a production coupling from neutrons to nuclide, and a nuclide removal rate. The exact propagator over $\\Delta t$ is $\\exp((\\mathbf{T}+\\mathbf{D}) \\Delta t)$.\n\nIn the Lie–Trotter operator-splitting approximation, two first-order factorizations are commonly used: applying depletion then transport yields $\\mathbf{U}_{D \\to T} = \\exp(\\mathbf{D}\\,\\Delta t)\\,\\exp(\\mathbf{T}\\,\\Delta t)$, while applying transport then depletion yields $\\mathbf{U}_{T \\to D} = \\exp(\\mathbf{T}\\,\\Delta t)\\,\\exp(\\mathbf{D}\\,\\Delta t)$.\n\nStarting only from the power-series definition of the matrix exponential and the definition of the commutator $[\\mathbf{A},\\mathbf{B}] \\equiv \\mathbf{A}\\mathbf{B} - \\mathbf{B}\\mathbf{A}$, derive, retaining terms up to and including order $(\\Delta t)^{2}$, the difference\n$$\n\\Delta \\mathbf{U} \\equiv \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D},\n$$\nand express it in two equivalent ways: first, in terms of the commutator of $\\mathbf{D}$ and $\\mathbf{T}$ and, second, as an explicit $2 \\times 2$ matrix in the parameters $s$, $r$, $p$, $\\lambda$, and $\\Delta t$. Neglect all terms of order $\\mathcal{O}((\\Delta t)^{3})$ and higher. Provide your final answer as the explicit $2 \\times 2$ matrix expression for $\\Delta \\mathbf{U}$ up to order $(\\Delta t)^{2}$. No numerical values are required, and no units are needed. The final answer must be a single analytic expression.",
            "solution": "The problem requires the derivation of the difference between two first-order Lie-Trotter operator-splitting approximations for a given linear system. The difference, $\\Delta \\mathbf{U} \\equiv \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D}$, is to be determined up to and including terms of order $(\\Delta t)^{2}$. We are instructed to start from the power-series definition of the matrix exponential.\n\nThe power-series definition of the exponential of a square matrix $\\mathbf{X}$ is:\n$$\n\\exp(\\mathbf{X}) = \\sum_{k=0}^{\\infty} \\frac{\\mathbf{X}^k}{k!} = \\mathbf{I} + \\mathbf{X} + \\frac{1}{2!}\\mathbf{X}^2 + \\frac{1}{3!}\\mathbf{X}^3 + \\dots\n$$\nwhere $\\mathbf{I}$ is the identity matrix. To solve this problem, we need to expand the exponential terms up to the second order in the time step $\\Delta t$. We neglect all terms of order $\\mathcal{O}((\\Delta t)^{3})$ and higher.\n\nThe two operators in question are $\\mathbf{T}$ and $\\mathbf{D}$. The exponentials we need to expand are $\\exp(\\mathbf{T}\\,\\Delta t)$ and $\\exp(\\mathbf{D}\\,\\Delta t)$:\n$$\n\\exp(\\mathbf{T}\\,\\Delta t) = \\mathbf{I} + (\\mathbf{T}\\,\\Delta t) + \\frac{1}{2}(\\mathbf{T}\\,\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3) = \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\exp(\\mathbf{D}\\,\\Delta t) = \\mathbf{I} + (\\mathbf{D}\\,\\Delta t) + \\frac{1}{2}(\\mathbf{D}\\,\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3) = \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\nNow, we can write out the two splitting approximations by multiplying these series expansions.\n\nFirst, for the \"depletion then transport\" approximation, $\\mathbf{U}_{D \\to T} = \\exp(\\mathbf{D}\\,\\Delta t)\\,\\exp(\\mathbf{T}\\,\\Delta t)$:\n$$\n\\mathbf{U}_{D \\to T} = \\left( \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 \\right) \\left( \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 \\right) + \\mathcal{O}((\\Delta t)^3)\n$$\nWe perform the matrix multiplication, retaining only terms up to order $(\\Delta t)^2$:\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I}(\\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2) + \\mathbf{D}\\Delta t(\\mathbf{I} + \\mathbf{T}\\Delta t) + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2(\\mathbf{I}) + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 + \\mathbf{D}\\Delta t + \\mathbf{D}\\mathbf{T}(\\Delta t)^2 + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\nCollecting terms by powers of $\\Delta t$:\n$$\n\\mathbf{U}_{D \\to T} = \\mathbf{I} + (\\mathbf{D} + \\mathbf{T})\\Delta t + \\left(\\mathbf{D}\\mathbf{T} + \\frac{1}{2}\\mathbf{D}^2 + \\frac{1}{2}\\mathbf{T}^2\\right)(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\nSecond, for the \"transport then depletion\" approximation, $\\mathbf{U}_{T \\to D} = \\exp(\\mathbf{T}\\,\\Delta t)\\,\\exp(\\mathbf{D}\\,\\Delta t)$, we simply swap the roles of $\\mathbf{T}$ and $\\mathbf{D}$ in the expansion above:\n$$\n\\mathbf{U}_{T \\to D} = \\left( \\mathbf{I} + \\mathbf{T}\\Delta t + \\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2 \\right) \\left( \\mathbf{I} + \\mathbf{D}\\Delta t + \\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2 \\right) + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\mathbf{U}_{T \\to D} = \\mathbf{I} + (\\mathbf{T} + \\mathbf{D})\\Delta t + \\left(\\mathbf{T}\\mathbf{D} + \\frac{1}{2}\\mathbf{T}^2 + \\frac{1}{2}\\mathbf{D}^2\\right)(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\n\nNow we find the difference $\\Delta \\mathbf{U} = \\mathbf{U}_{D \\to T} - \\mathbf{U}_{T \\to D}$. The identity terms and the first-order terms in $\\Delta t$ cancel. The terms $\\frac{1}{2}\\mathbf{D}^2(\\Delta t)^2$ and $\\frac{1}{2}\\mathbf{T}^2(\\Delta t)^2$ also cancel.\n$$\n\\Delta \\mathbf{U} = \\left[ \\left(\\mathbf{D}\\mathbf{T} + \\frac{1}{2}\\mathbf{D}^2 + \\frac{1}{2}\\mathbf{T}^2\\right)(\\Delta t)^2 \\right] - \\left[ \\left(\\mathbf{T}\\mathbf{D} + \\frac{1}{2}\\mathbf{T}^2 + \\frac{1}{2}\\mathbf{D}^2\\right)(\\Delta t)^2 \\right] + \\mathcal{O}((\\Delta t)^3)\n$$\n$$\n\\Delta \\mathbf{U} = (\\mathbf{D}\\mathbf{T} - \\mathbf{T}\\mathbf{D})(\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\nUsing the definition of the commutator, $[\\mathbf{A},\\mathbf{B}] \\equiv \\mathbf{A}\\mathbf{B} - \\mathbf{B}\\mathbf{A}$, we arrive at the first required expression:\n$$\n\\Delta \\mathbf{U} = [\\mathbf{D}, \\mathbf{T}](\\Delta t)^2 + \\mathcal{O}((\\Delta t)^3)\n$$\nThis result shows that the difference between the two splitting schemes, which is a measure of the splitting error, is proportional to the commutator of the operators and is of second order in the time step.\n\nFor the second part of the problem, we compute this commutator explicitly using the given matrices:\n$$\n\\mathbf{T} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix}, \\qquad \\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix}\n$$\nWe compute the matrix products $\\mathbf{D}\\mathbf{T}$ and $\\mathbf{T}\\mathbf{D}$:\n$$\n\\mathbf{D}\\mathbf{T} = \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix} \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} (0)(s) + (0)(0)  (0)(r) + (0)(0) \\\\ (p)(s) + (-\\lambda)(0)  (p)(r) + (-\\lambda)(0) \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ ps  pr \\end{pmatrix}\n$$\n$$\n\\mathbf{T}\\mathbf{D} = \\begin{pmatrix} s  r \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 0  0 \\\\ p  -\\lambda \\end{pmatrix} = \\begin{pmatrix} (s)(0) + (r)(p)  (s)(0) + (r)(-\\lambda) \\\\ (0)(0) + (0)(p)  (0)(0) + (0)(-\\lambda) \\end{pmatrix} = \\begin{pmatrix} pr  -r\\lambda \\\\ 0  0 \\end{pmatrix}\n$$\nThe commutator matrix is the difference between these two products:\n$$\n[\\mathbf{D}, \\mathbf{T}] = \\mathbf{D}\\mathbf{T} - \\mathbf{T}\\mathbf{D} = \\begin{pmatrix} 0  0 \\\\ ps  pr \\end{pmatrix} - \\begin{pmatrix} pr  -r\\lambda \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 0-pr  0-(-r\\lambda) \\\\ ps-0  pr-0 \\end{pmatrix} = \\begin{pmatrix} -pr  r\\lambda \\\\ ps  pr \\end{pmatrix}\n$$\nFinally, we substitute this matrix into the expression for $\\Delta \\mathbf{U}$ and neglect terms of higher order, providing the explicit $2 \\times 2$ matrix as requested:\n$$\n\\Delta \\mathbf{U} = [\\mathbf{D}, \\mathbf{T}](\\Delta t)^2 = \\begin{pmatrix} -pr  r\\lambda \\\\ ps  pr \\end{pmatrix} (\\Delta t)^2 = \\begin{pmatrix} -pr (\\Delta t)^2  r\\lambda (\\Delta t)^2 \\\\ ps (\\Delta t)^2  pr (\\Delta t)^2 \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -pr(\\Delta t)^{2}  r\\lambda(\\Delta t)^{2} \\\\ ps(\\Delta t)^{2}  pr(\\Delta t)^{2} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Building on the theoretical origin of splitting error, a practical question emerges: how can we estimate this error during a simulation without knowing the exact solution? This computational exercise explores a powerful technique for local error estimation using a physically-based, multi-nuclide depletion model. By comparing the results of two different splitting orders, you will discover that their difference provides a direct estimate of the local error itself, a cornerstone of adaptive time-stepping algorithms, and test the validity of this estimate for different step sizes .",
            "id": "4240057",
            "problem": "Consider a linearized transport–depletion coupling for nuclide number densities in nuclear reactor simulation. Let the state vector be the nuclide number density vector $y(t) \\in \\mathbb{R}^3$ with components $y_1(t)$ for Uranium-235, $y_2(t)$ for Uranium-238, and $y_3(t)$ for Xenon-135, all in units of $1/\\mathrm{cm}^3$. The coupled system is modeled as the ordinary differential equation (ODE) $y'(t) = (A + B) y(t)$, where $A$ represents non-transport depletion (e.g., radioactive decay) and $B$ represents effective transport-mediated neutron-induced reactions linearized around a steady neutron flux. The exact solution over a time step $\\Delta t$ is $y(\\Delta t) = \\exp(\\Delta t (A+B)) y(0)$, where $\\exp(\\cdot)$ denotes the matrix exponential.\n\nFor a physically plausible, constant-coefficient approximation at steady flux, use the following matrices (units of $A$ and $B$ are $\\mathrm{s}^{-1}$):\n$$\nA = \\begin{bmatrix}\n0  0  0\\\\\n0  0  0\\\\\n0  0  -\\lambda_{\\mathrm{Xe}}\n\\end{bmatrix},\\quad\n\\lambda_{\\mathrm{Xe}} = 2.10\\times 10^{-5},\n$$\n$$\nB = \\begin{bmatrix}\n-k_{1}  0  0\\\\\n0  -k_{2}  0\\\\\nf  0  -k_{3}\n\\end{bmatrix},\\quad\nk_1 = 5.85\\times 10^{-8},\\quad k_2 = 2.70\\times 10^{-10},\\quad k_3 = 3.00\\times 10^{-4},\\quad f = 1.755\\times 10^{-9}.\n$$\nThese values correspond to reasonable orders of magnitude obtained from steady flux and cross-section data: $k_1$ approximates a Uranium-235 fission rate per nucleus, $k_2$ approximates a Uranium-238 capture rate per nucleus, $k_3$ approximates a Xenon-135 neutron absorption rate per nucleus, and $f$ approximates the Xenon-135 production coupling from Uranium-235 fission yield.\n\nDefine two first-order operator-splitting orderings over a single step of size $\\Delta t$:\n1. Transport-then-depletion: $y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$.\n2. Depletion-then-transport: $y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$.\n\nLet the matrix commutator be defined by $[A,B] = AB - BA$. The goal is to estimate the local error of a split ordering by computing a surrogate for the commutator action on $y(0)$ from the two split orderings, and then verify this prediction against the observed difference from the exact solution. Specifically:\n- Compute $y_{\\mathrm{AB}}(\\Delta t)$ and $y_{\\mathrm{BA}}(\\Delta t)$ for the given $A$, $B$, and $y(0)$.\n- Use these two split orderings to construct a surrogate vector for $[A,B]y(0)$ via appropriate normalization based on dimensional analysis of the leading-order behavior in $\\Delta t$.\n- Use that surrogate to predict the leading-order local error of the transport-then-depletion ordering relative to the exact solution and compare it to the observed error $y_{\\mathrm{AB}}(\\Delta t) - \\exp(\\Delta t (A+B)) y(0)$ by computing the relative discrepancy, defined as the ratio of the Euclidean norm of the prediction error to the Euclidean norm of the observed error. The Euclidean norm here is over the density components and thus has unit $1/\\mathrm{cm}^3$, and the relative discrepancy is dimensionless.\n\nThe initial number densities are\n$$\ny(0) = \\begin{bmatrix}\n2.50\\times 10^{21}\\\\\n4.00\\times 10^{22}\\\\\n1.00\\times 10^{15}\n\\end{bmatrix}\\ \\mathrm{cm}^{-3}.\n$$\n\nTest suite (time steps in seconds):\n- Case $1$: $\\Delta t = 0.01$.\n- Case $2$: $\\Delta t = 10.0$.\n- Case $3$: $\\Delta t = 864000.0$ (ten days).\n\nFor each case, compute the relative discrepancy (dimensionless) and decide if the commutator-based prediction is acceptable using the criterion “relative discrepancy $\\leq 0.2$” as a boolean outcome. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases, where each element is the boolean outcome for that case (e.g., `[True,False,True]`). Angles do not appear in this problem. All physical quantities involving number densities must be kept in $1/\\mathrm{cm}^3$, time in $\\mathrm{s}$, and rates in $\\mathrm{s}^{-1}$. Percentages, if any, must be expressed as decimals.",
            "solution": "The user wants me to solve a problem regarding operator splitting in nuclear reactor physics.\n\n### Step 1: Extract Givens\n- **State Vector**: Nuclide number density vector $y(t) \\in \\mathbb{R}^3$, with components $y_1(t)$ (U-235), $y_2(t)$ (U-238), and $y_3(t)$ (Xe-135), in units of $1/\\mathrm{cm}^3$.\n- **Governing Equation**: $y'(t) = (A + B) y(t)$.\n- **Depletion Matrix (A)**: Represents non-transport effects.\n  $$A = \\begin{bmatrix}\n  0  0  0\\\\\n  0  0  0\\\\\n  0  0  -\\lambda_{\\mathrm{Xe}}\n  \\end{bmatrix},\\quad \\lambda_{\\mathrm{Xe}} = 2.10\\times 10^{-5}\\ \\mathrm{s}^{-1}$$\n- **Transport Matrix (B)**: Represents linearized transport-mediated reactions.\n  $$B = \\begin{bmatrix}\n  -k_{1}  0  0\\\\\n  0  -k_{2}  0\\\\\n  f  0  -k_{3}\n  \\end{bmatrix}$$\n  where $k_1 = 5.85\\times 10^{-8}\\ \\mathrm{s}^{-1}$, $k_2 = 2.70\\times 10^{-10}\\ \\mathrm{s}^{-1}$, $k_3 = 3.00\\times 10^{-4}\\ \\mathrm{s}^{-1}$, and $f = 1.755\\times 10^{-9}\\ \\mathrm{s}^{-1}$.\n- **Initial Condition**:\n  $$y(0) = \\begin{bmatrix}\n  2.50\\times 10^{21}\\\\\n  4.00\\times 10^{22}\\\\\n  1.00\\times 10^{15}\n  \\end{bmatrix}\\ \\mathrm{cm}^{-3}$$\n- **Exact Solution over $\\Delta t$**: $y(\\Delta t) = \\exp(\\Delta t (A+B)) y(0)$.\n- **Split Orderings**:\n  1.  Transport-then-depletion: $y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$.\n  2.  Depletion-then-transport: $y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$.\n- **Definitions**:\n  - **Commutator**: $[A,B] = AB - BA$.\n  - **Observed Error**: $y_{\\mathrm{AB}}(\\Delta t) - \\exp(\\Delta t (A+B)) y(0)$.\n  - **Relative Discrepancy**: Ratio of the Euclidean norm of the prediction error to the Euclidean norm of the observed error.\n- **Task**: For each test case, construct a surrogate for the commutator action to predict the local error of the $y_{\\mathrm{AB}}$ ordering. Compare this prediction to the observed error by computing the relative discrepancy.\n- **Test Cases**: $\\Delta t = 0.01\\ \\mathrm{s}$, $\\Delta t = 10.0\\ \\mathrm{s}$, $\\Delta t = 864000.0\\ \\mathrm{s}$.\n- **Acceptance Criterion**: Relative discrepancy $\\leq 0.2$.\n- **Output Format**: A list of boolean outcomes, e.g., `[True,False,True]`.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is validated against the required criteria.\n- **Scientifically Grounded**: The problem describes a linearized, constant-coefficient model of nuclide depletion, which is a standard approach in reactor physics. The matrices $A$ and $B$ correctly represent radioactive decay and neutron-induced reactions, respectively. The given numerical values for the rate constants are physically realistic for a thermal neutron spectrum, as they correspond to known half-lives and reaction cross-sections. For example, $\\lambda_{\\mathrm{Xe}} = 2.10\\times 10^{-5}\\ \\mathrm{s}^{-1}$ corresponds to the known half-life of Xenon-135 (approx. $9.14$ hours). The initial nuclide densities are also of a plausible order of magnitude for nuclear fuel. The problem is a valid, though simplified, representation of a real-world scientific problem.\n- **Well-Posed**: The problem is mathematically well-posed. It involves solving a linear system of ordinary differential equations with constant coefficients. The solution is unique and stable. The tasks are clearly defined, and all necessary data and definitions are provided to compute the required quantities.\n- **Objective**: The problem is stated using precise, unambiguous mathematical and physical language. It is free of subjective or opinion-based claims.\n\n### Step 3: Verdict and Action\nThe problem is **valid** as it is scientifically grounded, well-posed, and objective. I will proceed with a full solution.\n\nThe problem requires an analysis of the local error of a first-order operator splitting method for solving the linear ODE system $y'(t) = (A+B)y(t)$.\n\nThe exact solution over a time step $\\Delta t$ is given by the action of the matrix exponential of the summed operator:\n$$y(\\Delta t) = \\exp(\\Delta t(A+B))y(0)$$\n\nOperator splitting methods approximate this by separating the actions of $A$ and $B$. The two first-order schemes given are:\n1.  $y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$ (transport-then-depletion)\n2.  $y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$ (depletion-then-transport)\n\nThe error in these methods arises because matrix exponentiation does not distribute over a sum unless the matrices commute, i.e., $[A,B] = AB - BA = 0$. In this problem, the matrices do not commute, so the splitting introduces an error.\n\nThe leading term of this local error can be found by expanding the matrix exponentials in a Taylor series for small $\\Delta t$.\nThe exact solution expands as:\n$$ \\exp(\\Delta t(A+B)) = I + \\Delta t(A+B) + \\frac{\\Delta t^2}{2}(A+B)^2 + O(\\Delta t^3) $$\n$$ = I + \\Delta t(A+B) + \\frac{\\Delta t^2}{2}(A^2 + AB+BA + B^2) + O(\\Delta t^3) $$\nThe transport-then-depletion split solution expands as:\n$$ \\exp(\\Delta t A)\\exp(\\Delta t B) = \\left(I+\\Delta t A + \\frac{\\Delta t^2}{2}A^2+...\\right)\\left(I+\\Delta t B + \\frac{\\Delta t^2}{2}B^2+...\\right) $$\n$$ = I + \\Delta t(A+B) + \\frac{\\Delta t^2}{2}(A^2 + 2AB + B^2) + O(\\Delta t^3) $$\nThe local error of the $y_{\\mathrm{AB}}$ scheme, which we denote the \"observed error\" $v_o$, is the difference between the approximate and exact propagators acting on $y(0)$:\n$$ v_o = y_{\\mathrm{AB}}(\\Delta t) - y(\\Delta t) = \\left(\\exp(\\Delta t A)\\exp(\\Delta t B) - \\exp(\\Delta t(A+B))\\right) y(0) $$\nTo leading order in $\\Delta t$, this is:\n$$ v_o \\approx \\left( \\frac{\\Delta t^2}{2}(A^2 + 2AB + B^2) - \\frac{\\Delta t^2}{2}(A^2 + AB+BA + B^2) \\right) y(0) $$\n$$ v_o \\approx \\frac{\\Delta t^2}{2}(AB - BA)y(0) = \\frac{\\Delta t^2}{2}[A,B]y(0) $$\n\nThe problem asks to construct a surrogate for the commutator term $[A,B]y(0)$ using the two split orderings, $y_{\\mathrm{AB}}$ and $y_{\\mathrm{BA}}$. We examine their difference:\n$$ y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t) = (\\exp(\\Delta t A)\\exp(\\Delta t B) - \\exp(\\Delta t B)\\exp(\\Delta t A))y(0) $$\nExpanding this difference to leading order gives:\n$$ y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t) \\approx \\left(\\frac{\\Delta t^2}{2}(2AB) - \\frac{\\Delta t^2}{2}(2BA)\\right)y(0) = \\Delta t^2[A,B]y(0) $$\nThis relation allows us to approximate the action of the commutator on the initial state vector using only the results of the two splitting schemes:\n$$ [A,B]y(0) \\approx \\frac{y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t)}{\\Delta t^2} $$\nSubstituting this into our expression for the leading-order error of $y_{\\mathrm{AB}}$, we obtain a prediction for the error vector, $v_p$:\n$$ v_p = \\frac{1}{2} (y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t)) $$\n\nThe goal is to assess how well this prediction $v_p$ matches the true observed error $v_o$. We define the \"prediction error\" as the vector difference $E_{pred} = v_p - v_o$. The \"relative discrepancy\" is then the ratio of the Euclidean norms of the prediction error and the observed error:\n$$ D_r = \\frac{\\|E_{pred}\\|_2}{\\|v_o\\|_2} = \\frac{\\|v_p - v_o\\|_2}{\\|v_o\\|_2} $$\nFor small $\\Delta t$, the higher-order terms in the Taylor series are negligible, so we expect $v_p \\approx v_o$, leading to a small relative discrepancy. For large $\\Delta t$, the leading-order approximations break down, and we expect a large discrepancy. The criterion for an acceptable prediction is $D_r \\leq 0.2$.\n\nThe computational procedure for each value of $\\Delta t$ is as follows:\n1.  Define the matrices $A$, $B$, and the combined matrix $C = A+B$.\n2.  Define the initial state vector $y(0)$.\n3.  Compute the matrix exponentials $\\exp(\\Delta t A)$, $\\exp(\\Delta t B)$, and $\\exp(\\Delta t C)$.\n4.  Calculate the three propagated state vectors:\n    - $y_{\\mathrm{AB}}(\\Delta t) = \\exp(\\Delta t A)\\exp(\\Delta t B) y(0)$\n    - $y_{\\mathrm{BA}}(\\Delta t) = \\exp(\\Delta t B)\\exp(\\Delta t A) y(0)$\n    - $y(\\Delta t) = \\exp(\\Delta t C) y(0)$\n5.  Calculate the predicted error vector: $v_p = 0.5 \\times (y_{\\mathrm{AB}}(\\Delta t) - y_{\\mathrm{BA}}(\\Delta t))$.\n6.  Calculate the observed error vector: $v_o = y_{\\mathrm{AB}}(\\Delta t) - y(\\Delta t)$.\n7.  Calculate the relative discrepancy $D_r = \\|v_p - v_o\\|_2 / \\|v_o\\|_2$.\n8.  Determine if $D_r \\leq 0.2$.\n\nThis procedure is repeated for all given time steps $\\Delta t$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves the transport-depletion coupling problem by analyzing the error\n    of an operator splitting method.\n    \"\"\"\n    \n    # Define the physical constants and parameters.\n    # All rates are in s^-1.\n    lambda_Xe = 2.10e-5\n    k1 = 5.85e-8\n    k2 = 2.70e-10\n    k3 = 3.00e-4\n    f = 1.755e-9\n\n    # Define the depletion matrix A and the transport/reaction matrix B.\n    # A represents radioactive decay.\n    # B represents neutron-induced reactions.\n    A = np.array([\n        [0.0, 0.0, 0.0],\n        [0.0, 0.0, 0.0],\n        [0.0, 0.0, -lambda_Xe]\n    ], dtype=float)\n\n    B = np.array([\n        [-k1, 0.0, 0.0],\n        [0.0, -k2, 0.0],\n        [f,   0.0, -k3]\n    ], dtype=float)\n\n    # The full system matrix is C = A + B.\n    C = A + B\n\n    # Define the initial number density vector y(0) in cm^-3.\n    # y[0]: U-235, y[1]: U-238, y[2]: Xe-135.\n    y0 = np.array([2.50e21, 4.00e22, 1.00e15], dtype=float)\n\n    # Define the test cases for the time step size dt in seconds.\n    test_cases = [0.01, 10.0, 864000.0]\n\n    results = []\n    for dt in test_cases:\n        # Calculate the matrix exponentials for the propagators.\n        # This is the most computationally intensive step.\n        exp_dtA = expm(dt * A)\n        exp_dtB = expm(dt * B)\n        # The exact solution propagator\n        exp_dtC = expm(dt * C)\n\n        # Propagate the initial state vector using the different methods.\n        # Transport-then-depletion (AB) ordering\n        y_ab = exp_dtA @ exp_dtB @ y0\n        \n        # Depletion-then-transport (BA) ordering\n        y_ba = exp_dtB @ exp_dtA @ y0\n        \n        # Exact solution\n        y_exact = exp_dtC @ y0\n\n        # The predicted local error vector, v_p, is based on the difference\n        # between the two first-order split orderings.\n        # This approximates (dt^2/2) * [A,B] * y(0).\n        v_p = 0.5 * (y_ab - y_ba)\n\n        # The observed local error vector, v_o, is the true difference\n        # between the AB-split solution and the exact solution.\n        v_o = y_ab - y_exact\n        \n        # The 'prediction error' is the difference between the predicted error\n        # vector and the observed error vector.\n        E_pred_vec = v_p - v_o\n        \n        # Calculate the Euclidean norms of the prediction error and observed error.\n        norm_E_pred = np.linalg.norm(E_pred_vec)\n        norm_v_o = np.linalg.norm(v_o)\n\n        # Calculate the relative discrepancy.\n        # This measures how good the leading-order error prediction is.\n        # A small value indicates the error is well-described by the commutator.\n        # Handle division by zero, although norm_v_o should be non-zero\n        # for non-commuting matrices and non-zero dt.\n        if norm_v_o == 0.0:\n            relative_discrepancy = 0.0 if norm_E_pred == 0.0 else float('inf')\n        else:\n            relative_discrepancy = norm_E_pred / norm_v_o\n        \n        # Apply the acceptance criterion.\n        is_acceptable = relative_discrepancy = 0.2\n        results.append(is_acceptable)\n\n    # Format the output as a comma-separated list of boolean values.\n    # Python's str(True) is 'True', which matches the required output format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With an understanding of how to estimate error, we can address the higher-level question of algorithmic choice. This practice compares the first-order Lie-Trotter splitting with the more accurate second-order Strang splitting to evaluate the trade-off between per-step cost and order of accuracy. By analyzing how the local error of each method scales with the time step size $\\Delta t$, you will determine the total computational cost to reach a desired global accuracy. This demonstrates why higher-order methods, despite being more expensive per step, are often more efficient for high-precision simulations .",
            "id": "4240076",
            "problem": "Consider a coupled neutron transport–fuel depletion system in which the state over one time step is advanced by operator splitting. Let the combined generator be written as the sum of two time-independent operators over a single step, the transport operator $\\mathcal{T}$ and the depletion operator $\\mathcal{D}$, so that the exact one-step propagator over a duration $\\Delta t$ is $\\exp\\!\\big(\\Delta t(\\mathcal{T}+\\mathcal{D})\\big)$. In practice, one may use either the Lie–Trotter splitting $\\exp(\\Delta t\\,\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})$ or the Strang (symmetric) splitting $\\exp\\!\\big(\\frac{\\Delta t}{2}\\mathcal{T}\\big)\\,\\exp(\\Delta t\\,\\mathcal{D})\\,\\exp\\!\\big(\\frac{\\Delta t}{2}\\mathcal{T}\\big)$.\n\nAt a particular reactor state, assume the following bounds on operator commutators (all norms are in the induced $\\infty$-norm):\n- $\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| \\leq 2.0~\\mathrm{s}^{-2}$,\n- $\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.6~\\mathrm{s}^{-3}$,\n- $\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.4~\\mathrm{s}^{-3}$.\n\nThe current time step is $\\Delta t = 0.02~\\mathrm{s}$. A step-rejection policy is applied based on a local error tolerance, where a step is rejected if a rigorous leading-order bound on the local error (in a dimensionless relative $\\infty$-norm of the state update) exceeds $\\tau = 5.0 \\times 10^{-4}$. The local error bound is to be obtained from first principles by expanding the split propagators relative to the exact propagator using the Baker–Campbell–Hausdorff (BCH) series and retaining the leading nonvanishing term appropriate to each splitting.\n\nStarting from the definition of the exact and split propagators and the BCH series, derive the leading-order local error bounds for both Lie–Trotter and Strang splitting in terms of $\\Delta t$ and the given commutator norm bounds. Then, evaluate the local error bound at $\\Delta t$ and at $2\\,\\Delta t$ for each method. Compute the multiplicative factor by which the local error bound changes when $\\Delta t$ is doubled for each method, and decide, under the stated policy, whether the doubled step should be rejected for each method.\n\nProvide your final answer as a single row matrix with four entries $(r_{\\mathrm{Lie}},\\, r_{\\mathrm{Str}},\\, I_{\\mathrm{Lie}},\\, I_{\\mathrm{Str}})$, where $r_{\\mathrm{Lie}}$ and $r_{\\mathrm{Str}}$ are the multiplicative factors by which the local error bound increases when $\\Delta t$ is doubled for Lie–Trotter and Strang splitting, respectively, and $I_{\\mathrm{Lie}}$ and $I_{\\mathrm{Str}}$ are indicator values equal to $1$ if the doubled step should be rejected and $0$ if it should be accepted. No rounding is required. The indicators are dimensionless; the intermediate analysis should treat the tolerance as dimensionless as stated.",
            "solution": "The problem requires the derivation and evaluation of local error bounds for Lie–Trotter and Strang operator splitting methods for a coupled transport–depletion system. The decision to accept or reject a doubled time step is then made based on these bounds.\n\nFirst, we establish the theoretical foundation for the error analysis. The state of the system evolves according to the equation $\\frac{d\\psi}{dt} = (\\mathcal{T}+\\mathcal{D})\\psi$, where $\\mathcal{T}$ is the transport operator and $\\mathcal{D}$ is the depletion operator. The exact solution over a time step of duration $\\Delta t$ is given by the propagator $E = \\exp(\\Delta t(\\mathcal{T}+\\mathcal{D}))$.\n\nThe operator splitting methods approximate this exact propagator.\nThe Lie–Trotter splitting propagator is $S_{\\mathrm{Lie}} = \\exp(\\Delta t\\,\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})$.\nThe Strang splitting propagator is $S_{\\mathrm{Str}} = \\exp(\\frac{\\Delta t}{2}\\mathcal{T})\\,\\exp(\\Delta t\\,\\mathcal{D})\\,\\exp(\\frac{\\Delta t}{2}\\mathcal{T})$.\n\nThe local error of these methods is determined by comparing them to the exact propagator. This comparison relies on the Baker–Campbell–Hausdorff (BCH) formula, which for two non-commuting operators $X$ and $Y$ states:\n$$ \\exp(X)\\exp(Y) = \\exp\\left(X+Y+\\frac{1}{2}[X,Y]+\\frac{1}{12}\\big([X,[X,Y]]-[Y,[X,Y]]\\big) + \\mathcal{O}(\\|X,Y\\|^3)\\right) $$\nwhere $[A,B] = AB-BA$ is the commutator.\n\n**Lie–Trotter Splitting Analysis**\n\nLet $X = \\Delta t\\,\\mathcal{T}$ and $Y = \\Delta t\\,\\mathcal{D}$. Applying the BCH formula to $S_{\\mathrm{Lie}}$ gives:\n$$ S_{\\mathrm{Lie}} = \\exp\\left(\\Delta t\\,\\mathcal{T} + \\Delta t\\,\\mathcal{D} + \\frac{1}{2}[\\Delta t\\,\\mathcal{T}, \\Delta t\\,\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)\\right) $$\n$$ S_{\\mathrm{Lie}} = \\exp\\left(\\Delta t(\\mathcal{T}+\\mathcal{D}) + \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)\\right) $$\nThe local error operator, $\\mathcal{E}_{\\mathrm{Lie}} = S_{\\mathrm{Lie}} - E$, can be found by expanding the exponentials. Let $A = \\Delta t(\\mathcal{T}+\\mathcal{D})$ and $B = \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] + \\mathcal{O}((\\Delta t)^3)$.\nThen $\\mathcal{E}_{\\mathrm{Lie}} = \\exp(A+B) - \\exp(A)$. For small $B$, the leading term of this difference is $B$.\nThus, the leading-order local error operator for Lie–Trotter splitting is:\n$$ \\mathcal{E}_{\\mathrm{Lie}} \\approx \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] $$\nThis shows that the Lie–Trotter method is first-order accurate, with a local error of order $\\mathcal{O}((\\Delta t)^2)$. The problem asks for a rigorous local error bound, which we denote as $B_{\\mathrm{Lie}}$. We obtain this by taking the norm and using the provided commutator bound, $\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| \\leq 2.0~\\mathrm{s}^{-2}$:\n$$ B_{\\mathrm{Lie}}(\\Delta t) = \\left\\| \\frac{(\\Delta t)^2}{2}[\\mathcal{T},\\mathcal{D}] \\right\\| \\leq \\frac{(\\Delta t)^2}{2}\\big\\|[\\mathcal{T},\\mathcal{D}]\\big\\| = \\frac{(\\Delta t)^2}{2}(2.0~\\mathrm{s}^{-2}) = (\\Delta t)^2 \\cdot (1.0~\\mathrm{s}^{-2}) $$\n\n**Strang Splitting Analysis**\n\nThe Strang splitting propagator $S_{\\mathrm{Str}}$ is symmetric, meaning $S_{\\mathrm{Str}}(-\\Delta t) = (S_{\\mathrm{Str}}(\\Delta t))^{-1}$. A consequence of this symmetry is that its BCH expansion, $\\log(S_{\\mathrm{Str}}(\\Delta t))$, contains only odd powers of $\\Delta t$. The first-order term is identical to the exact propagator, $\\Delta t(\\mathcal{T}+\\mathcal{D})$. The quadratic term vanishes, which makes the method second-order accurate. The leading error term is therefore of order $\\mathcal{O}((\\Delta t)^3)$.\n\nThe symmetric form of the BCH formula gives the expansion for $S_{\\mathrm{Str}}$ directly:\n$$ S_{\\mathrm{Str}} = \\exp\\left(\\Delta t(\\mathcal{T}+\\mathcal{D}) + \\frac{(\\Delta t)^3}{24}\\left(2[\\mathcal{D},[\\mathcal{D},\\mathcal{T}]] + [\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\right) + \\mathcal{O}((\\Delta t)^5)\\right) $$\nUsing the identity $[\\mathcal{D},[\\mathcal{D},\\mathcal{T}]] = -[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]$, the leading-order local error operator is:\n$$ \\mathcal{E}_{\\mathrm{Str}} \\approx \\frac{(\\Delta t)^3}{24}\\left([\\mathcal{T},[\\mathcal{T},\\mathcal{D}]] - 2[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\right) $$\nTo find the local error bound $B_{\\mathrm{Str}}$, we take the norm and use the triangle inequality along with the given bounds $\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.6~\\mathrm{s}^{-3}$ and $\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\| \\leq 0.4~\\mathrm{s}^{-3}$:\n$$ B_{\\mathrm{Str}}(\\Delta t) = \\left\\| \\mathcal{E}_{\\mathrm{Str}} \\right\\| \\leq \\frac{(\\Delta t)^3}{24}\\left(\\big\\|[\\mathcal{T},[\\mathcal{T},\\mathcal{D}]]\\big\\| + 2\\big\\|[\\mathcal{D},[\\mathcal{T},\\mathcal{D}]]\\big\\|\\right) $$\n$$ B_{\\mathrm{Str}}(\\Delta t) = \\frac{(\\Delta t)^3}{24}\\left(0.6~\\mathrm{s}^{-3} + 2(0.4~\\mathrm{s}^{-3})\\right) = \\frac{(\\Delta t)^3}{24}(1.4~\\mathrm{s}^{-3}) = \\frac{7}{120}(\\Delta t)^3~\\mathrm{s}^{-3} $$\n\n**Numerical Evaluation and Decision**\n\nThe current time step is $\\Delta t = 0.02~\\mathrm{s}$, and the tolerance is $\\tau = 5.0 \\times 10^{-4}$.\n\nFor Lie–Trotter splitting:\nThe error bound is $B_{\\mathrm{Lie}}(\\Delta t) = (1.0) \\cdot (\\Delta t)^2$.\nAt $\\Delta t = 0.02~\\mathrm{s}$, the error bound is $B_{\\mathrm{Lie}}(0.02) = (1.0) \\cdot (0.02)^2 = 4.0 \\times 10^{-4}$.\nAt $2\\Delta t = 0.04~\\mathrm{s}$, the error bound is $B_{\\mathrm{Lie}}(0.04) = (1.0) \\cdot (0.04)^2 = 1.6 \\times 10^{-3}$.\nThe multiplicative factor by which the error bound increases when doubling the step is $r_{\\mathrm{Lie}} = \\frac{B_{\\mathrm{Lie}}(2\\Delta t)}{B_{\\mathrm{Lie}}(\\Delta t)} = \\frac{(2\\Delta t)^2}{(\\Delta t)^2} = 4$.\nTo decide on the doubled step, we compare its error bound to the tolerance: $B_{\\mathrm{Lie}}(0.04) = 1.6 \\times 10^{-3}$.\nSince $1.6 \\times 10^{-3} > 5.0 \\times 10^{-4}$, the step must be rejected. The indicator is $I_{\\mathrm{Lie}} = 1$.\n\nFor Strang splitting:\nThe error bound is $B_{\\mathrm{Str}}(\\Delta t) = \\frac{7}{120}(\\Delta t)^3$.\nAt $\\Delta t = 0.02~\\mathrm{s}$, the error bound is $B_{\\mathrm{Str}}(0.02) = \\frac{7}{120}(0.02)^3 = \\frac{7}{120}(8 \\times 10^{-6}) = \\frac{56}{120} \\times 10^{-6} = \\frac{7}{15} \\times 10^{-6} \\approx 4.67 \\times 10^{-7}$.\nAt $2\\Delta t = 0.04~\\mathrm{s}$, the error bound is $B_{\\mathrm{Str}}(0.04) = \\frac{7}{120}(0.04)^3 = \\frac{7}{120}(64 \\times 10^{-6}) = \\frac{448}{120} \\times 10^{-6} = \\frac{56}{15} \\times 10^{-6} \\approx 3.73 \\times 10^{-6}$.\nThe multiplicative factor is $r_{\\mathrm{Str}} = \\frac{B_{\\mathrm{Str}}(2\\Delta t)}{B_{\\mathrm{Str}}(\\Delta t)} = \\frac{(2\\Delta t)^3}{(\\Delta t)^3} = 8$.\nTo decide on the doubled step, we compare its error bound to the tolerance: $B_{\\mathrm{Str}}(0.04) = \\frac{56}{15} \\times 10^{-6}$.\nSince $\\frac{56}{15} \\times 10^{-6} \\approx 3.73 \\times 10^{-6}$ and $\\tau = 5.0 \\times 10^{-4} = 500 \\times 10^{-6}$, it is clear that $B_{\\mathrm{Str}}(0.04)  \\tau$. Therefore, the step is accepted. The indicator is $I_{\\mathrm{Str}} = 0$.\n\nThe final results are the multiplicative factors $r_{\\mathrm{Lie}}=4$ and $r_{\\mathrm{Str}}=8$, and the rejection indicators $I_{\\mathrm{Lie}}=1$ and $I_{\\mathrm{Str}}=0$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 4  8  1  0 \\end{pmatrix} } $$"
        }
    ]
}