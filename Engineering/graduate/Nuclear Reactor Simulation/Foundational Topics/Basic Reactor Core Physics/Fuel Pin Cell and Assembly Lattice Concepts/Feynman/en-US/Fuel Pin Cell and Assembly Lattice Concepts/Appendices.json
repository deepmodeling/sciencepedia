{
    "hands_on_practices": [
        {
            "introduction": "In reactor physics, simplifying complex geometries into uniform 'homogenized' regions is a necessary step for efficient analysis. This exercise explores one of the most fundamental homogenization techniques: creating an effective 'smeared' density for an annular fuel pellet based on the principle of mass conservation . By deriving this effective density, you will then qualitatively analyze how this simplification impacts resonance self-shielding, a critical phenomenon in neutron transport, providing insight into the trade-offs inherent in lattice physics modeling.",
            "id": "4228069",
            "problem": "A cylindrical fuel pellet in a light water reactor pin cell has a central axial hole of radius $R_{h}$ and an outer fuel radius $R_{f}$, with $R_{h} < R_{f}$. The solid fuel material has a bulk mass density $\\rho_{\\text{bulk}}$ that would be realized if the material filled the entire cylinder without a hole. For neutronics homogenization in an assembly lattice, it is common to replace the annular fuel region by a uniform “smeared” fuel occupying the full radius $R_{f}$, chosen such that the total mass per unit length of fuel is conserved.\n\nStarting from conservation of mass per unit length and fundamental geometric relations for areas of a disk and an annulus, derive the closed-form analytic expression for the effective smeared fuel density $\\rho_{\\text{eff}}$ in terms of $\\rho_{\\text{bulk}}$, $R_{h}$, and $R_{f}$. In your reasoning, explicitly frame the homogenization step as equating the mass per unit length of the actual annulus to that of a uniform disk with density $\\rho_{\\text{eff}}$.\n\nThen, using first principles of neutron transport and macroscopic cross sections, explain qualitatively how replacing the annular fuel by smeared fuel with density $\\rho_{\\text{eff}}$ alters resonance self-shielding in the pin cell when embedded in an assembly lattice, focusing on the role of number density and optical thickness. No numerical evaluation is required for this discussion.\n\nProvide the final answer as a single closed-form analytical expression for $\\rho_{\\text{eff}}$. Do not include units in the final answer box. No rounding is required.",
            "solution": "The problem asks for two parts: first, a derivation of an effective smeared fuel density, $\\rho_{\\text{eff}}$, for an annular fuel pellet; and second, a qualitative explanation of how this homogenization affects resonance self-shielding.\n\nFirst, we address the derivation of the effective smeared fuel density, $\\rho_{\\text{eff}}$. The fundamental principle guiding this homogenization is the conservation of the total mass of fuel per unit length.\n\nLet us consider a section of the fuel pin of unit length. The actual fuel is in the form of an annulus with an inner radius $R_{h}$ and an outer radius $R_{f}$. The fuel material itself has a uniform bulk mass density denoted by $\\rho_{\\text{bulk}}$. The volume of this annular fuel region per unit length is equivalent to its cross-sectional area, $A_{\\text{annulus}}$. The area of an annulus is the area of the outer disk minus the area of the inner disk.\n$$A_{\\text{annulus}} = \\pi R_{f}^{2} - \\pi R_{h}^{2} = \\pi (R_{f}^{2} - R_{h}^{2})$$\nThe mass of the fuel in the annulus per unit length, $m_{\\text{annulus}}$, is the product of its volume per unit length and its density.\n$$m_{\\text{annulus}} = \\rho_{\\text{bulk}} \\times A_{\\text{annulus}} = \\rho_{\\text{bulk}} \\pi (R_{f}^{2} - R_{h}^{2})$$\n\nNext, we consider the homogenized model. In this model, the annular fuel is replaced by a uniform, solid cylindrical disk of fuel with the same outer radius $R_{f}$. The central hole is filled with this \"smeared\" fuel material. This homogenized fuel disk has an effective smeared density $\\rho_{\\text{eff}}$, which we need to determine. The volume of this homogenized fuel disk per unit length is its cross-sectional area, $A_{\\text{smeared}}$.\n$$A_{\\text{smeared}} = \\pi R_{f}^{2}$$\nThe mass of the fuel in this homogenized disk per unit length, $m_{\\text{smeared}}$, is the product of its volume per unit length and its effective density.\n$$m_{\\text{smeared}} = \\rho_{\\text{eff}} \\times A_{\\text{smeared}} = \\rho_{\\text{eff}} \\pi R_{f}^{2}$$\n\nThe core requirement of the homogenization is that the total mass of fuel per unit length is conserved. Therefore, we must equate the mass per unit length of the actual annulus to that of the smeared disk.\n$$m_{\\text{annulus}} = m_{\\text{smeared}}$$\nSubstituting the expressions derived above:\n$$\\rho_{\\text{bulk}} \\pi (R_{f}^{2} - R_{h}^{2}) = \\rho_{\\text{eff}} \\pi R_{f}^{2}$$\nWe can now solve for the effective smeared density, $\\rho_{\\text{eff}}$, by isolating it. The factor of $\\pi$ cancels from both sides.\n$$\\rho_{\\text{eff}} = \\rho_{\\text{bulk}} \\frac{R_{f}^{2} - R_{h}^{2}}{R_{f}^{2}}$$\nThis expression can be simplified to its final form:\n$$\\rho_{\\text{eff}} = \\rho_{\\text{bulk}} \\left(1 - \\frac{R_{h}^{2}}{R_{f}^{2}}\\right) = \\rho_{\\text{bulk}} \\left(1 - \\left(\\frac{R_{h}}{R_{f}}\\right)^{2}\\right)$$\nThis result is physically intuitive. Since the smeared volume is larger than the actual fuel volume, the effective density $\\rho_{\\text{eff}}$ must be less than the bulk material density $\\rho_{\\text{bulk}}$, which is consistent with the factor $\\left(1 - (R_{h}/R_{f})^2\\right)$ being less than $1$ for $R_{h} > 0$.\n\nSecond, we explain qualitatively how this homogenization alters resonance self-shielding. Resonance self-shielding is a critical heterogeneous effect in nuclear reactors. At specific neutron energies known as resonances, the absorption cross section, $\\sigma_{a}$, of fuel isotopes like $^{238}\\text{U}$ becomes extremely large.\n\nIn the actual annular geometry, the fuel material has a high bulk number density, $N_{\\text{bulk}}$, which is directly proportional to the mass density $\\rho_{\\text{bulk}}$. The macroscopic absorption cross section in the fuel, $\\Sigma_{a, \\text{bulk}} = N_{\\text{bulk}} \\sigma_{a}$, is therefore very high at resonance energies. This makes the fuel annulus optically thick. Neutrons entering the fuel from the surrounding moderator or from the central hole are absorbed very near the surface of the fuel region. This creates a significant depression in the neutron flux at these resonance energies within the bulk of the fuel. The nuclei in the interior of the fuel are \"shielded\" from the resonance-energy neutrons by the nuclei at the surface. This reduces the overall effective absorption rate compared to a case where the flux is uniform.\n\nWhen we replace the annular fuel with the smeared model, two key changes occur. First, as we derived, the effective density is reduced: $\\rho_{\\text{eff}} < \\rho_{\\text{bulk}}$. This directly implies that the effective number density of fuel atoms is also reduced: $N_{\\text{eff}} < N_{\\text{bulk}}$. Second, the geometry is changed from a hollow annulus to a solid disk; the central void, which previously allowed neutron streaming, is now filled with a dilute fuel-moderator mixture (in effect).\n\nThe reduction in number density leads to a smaller effective macroscopic cross section, $\\Sigma_{a, \\text{eff}} = N_{\\text{eff}} \\sigma_{a} < \\Sigma_{a, \\text{bulk}}$. A lower macroscopic cross section means the mean free path of neutrons is longer, and the fuel medium becomes more optically transparent. Consequently, the severe flux depression at the fuel surfaces is lessened. Neutrons can penetrate deeper into the fuel region before being absorbed. The homogenization process essentially replaces a strong, spatially localized absorber with a weaker, more diffuse absorber.\n\nBy reducing the optical thickness and smoothing out the material distribution, the homogenization procedure inherently diminishes the self-shielding effect. The model no longer captures the strong surface absorption and internal flux depression characteristic of the heterogeneous system. As a result, the calculated resonance absorption rate in the smeared fuel model will be higher than the actual rate in the annular pin cell, because the model underestimates the self-shielding. From a practical standpoint, reactor analysis codes that use such homogenized models must apply correction factors to account for this underestimation of resonance self-shielding.",
            "answer": "$$\n\\boxed{\\rho_{\\text{bulk}} \\left(1 - \\left(\\frac{R_{h}}{R_{f}}\\right)^{2}\\right)}\n$$"
        },
        {
            "introduction": "Building on the concept of homogenization, this practice moves from the spatial domain to the energy domain, tackling the essential task of group condensation. You will implement the process of collapsing fine-energy-group cross sections into a practical two-group structure, a cornerstone of lattice physics calculations . This hands-on exercise emphasizes the critical role of the weighting spectrum by quantifying how different physical assumptions—an infinite lattice versus a system with neutron leakage—produce different group constants, directly impacting the accuracy of full-core simulations.",
            "id": "4228080",
            "problem": "You are given fine-energy-group data at the pin-cell resolution that represent a single fuel pin within an assembly lattice in a nuclear reactor simulation. The objective is to condense the fine-group macroscopic reaction data from $G=70$ energy groups down to $2$ groups and to quantify the variance in the resulting condensed group constants when two different weighting spectra are used: an infinite-lattice weighting spectrum and a leakage-adjusted weighting spectrum.\n\nStart from the following fundamental definitions:\n- The reaction rate density in group $g$ for a macroscopic reaction with cross section $\\Sigma_{X,g}$ and scalar flux $\\phi_g$ is $R_{X,g}=\\Sigma_{X,g}\\,\\phi_g$. Here $X$ denotes a particular reaction type, specifically absorption and fission production.\n- A condensed $H$-group macroscopic constant $\\overline{\\Sigma}_{X,H}$ is the unique constant that, when multiplied by a suitably weighted average flux in group $H$, reproduces the total reaction rate integrated over all fine groups that belong to $H$. In a discrete multigroup setting, this is achieved by weighting with a spectrum $w_g$ and enforcing reaction-rate preservation, which leads to the discrete flux-weighted average definition $\\overline{\\Sigma}_{X,H}=\\dfrac{\\sum_{g\\in H}\\Sigma_{X,g}\\,w_g}{\\sum_{g\\in H}w_g}$.\n\nTwo weighting spectra are to be used:\n1. Infinite-lattice weighting, defined by $w_g=\\phi_g$.\n2. Leakage-adjusted weighting, defined by $w_g=\\tilde{\\phi}_g$, where $\\tilde{\\phi}_g=\\max\\left(\\phi_g-\\lambda\\,L_g,\\epsilon\\right)$ with a small positive floor $\\epsilon$ to prevent division by zero and with $L_g$ a leakage spectral estimate. The leakage term models spectral softening or hardening induced by net currents in a finite assembly environment.\n\nPartition the $G=70$ fine groups into $2$ condensed groups as follows:\n- Group $H=1$ (fast/epithermal): indices $g=0,1,\\dots,29$.\n- Group $H=2$ (thermalized): indices $g=30,31,\\dots,69$.\n\nYou are provided synthetic but physically plausible pin-resolved fine-group data via parametric generators for the scalar flux $\\phi_g$, the absorption reaction rate density $R_{a,g}$, and the fission production reaction rate density $R_{p,g}$, together with a leakage spectrum $L_g$. For each test case, the following constructions and parameter values must be used to generate the inputs:\n\nCommon construction for all test cases:\n- Let the group index be $g\\in\\{0,1,\\dots,69\\}$, with $g=0$ the highest-energy group and $g=69$ the lowest-energy (thermal) group.\n- Flux decomposition into an epithermal tail and a thermal peak:\n  $$\\phi_g=\\frac{A}{g+1}+B\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s^2}\\right).$$\n- Absorption macroscopic cross section shape:\n  $$\\Sigma_{a,g}=\\sigma_{a,0}+\\sigma_{a,1}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_a^2}\\right)+\\frac{\\sigma_{a,2}}{g+1}.$$\n- Fission production macroscopic term:\n  $$\\nu\\Sigma_{f,g}=\\sigma_{p,0}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_f^2}\\right)+\\frac{\\sigma_{p,1}}{\\sqrt{g+1}}.$$\n- Reaction rate densities:\n  $$R_{a,g}=\\Sigma_{a,g}\\,\\phi_g,\\qquad R_{p,g}=\\nu\\Sigma_{f,g}\\,\\phi_g.$$\n- Leakage spectrum estimator (finite-difference magnitude of within-pin spectral gradient):\n  $$L_g=c_{\\ell}\\,\\left|\\phi_g-\\phi_{g+1}\\right|,\\quad\\text{with}\\quad \\phi_{70}\\equiv\\phi_{69}\\ \\text{for the boundary},$$\n  and the leakage-adjustment floor $\\epsilon=10^{-12}$ to preserve numerical stability in all divisions.\n- Units: $\\phi_g$ is in $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}$, $R_{a,g}$ and $R_{p,g}$ are in $\\text{n}\\,\\text{cm}^{-3}\\,\\text{s}^{-1}$, $\\Sigma_{a,g}$ and $\\nu\\Sigma_{f,g}$ are in $\\text{cm}^{-1}$, and $L_g$ is in $\\text{n}\\,\\text{cm}^{-2}\\,\\text{s}^{-1}$. All condensed macroscopic constants $\\overline{\\Sigma}_{a,H}$ and $\\overline{\\nu\\Sigma}_{f,H}$ are in $\\text{cm}^{-1}$.\n\nDefine the leakage-adjusted spectrum by selecting a nonnegative parameter $\\lambda$ and computing\n$$\\tilde{\\phi}_g=\\max\\left(\\phi_g-\\lambda\\,L_g,\\,\\epsilon\\right).$$\n\nFor each test case, compute the condensed two-group macroscopic absorption and fission production constants using both the infinite-lattice weighting and the leakage-adjusted weighting. Then, for each condensed group $H\\in\\{1,2\\}$ and each reaction type $X\\in\\{a,\\,p\\}$ (where $p$ denotes fission production), compute the variance across the two weighting outcomes,\n$$\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right)=\\frac{1}{2}\\sum_{k\\in\\{\\text{inf},\\text{leak}\\}}\\left(\\overline{\\Sigma}_{X,H}^{(k)}-\\overline{\\Sigma}_{X,H}^{\\text{mean}}\\right)^2,\\quad \\overline{\\Sigma}_{X,H}^{\\text{mean}}=\\frac{\\overline{\\Sigma}_{X,H}^{(\\text{inf})}+\\overline{\\Sigma}_{X,H}^{(\\text{leak})}}{2}.$$\nThe variance unit is $\\left(\\text{cm}^{-1}\\right)^2$.\n\nTest suite with three cases that probe different spectral and leakage regimes:\n- Case $1$ (thermalized pin, moderate leakage):\n  - $A=1.0$, $B=5.0$, $g_t=65$, $s=3.0$,\n  - $\\sigma_{a,0}=0.02$, $\\sigma_{a,1}=0.5$, $s_a=5.0$, $\\sigma_{a,2}=0.01$,\n  - $\\sigma_{p,0}=0.7$, $s_f=4.0$, $\\sigma_{p,1}=0.02$,\n  - $c_{\\ell}=1.0$, $\\lambda=0.05$.\n- Case $2$ (harder spectrum pin, stronger leakage):\n  - $A=3.0$, $B=0.5$, $g_t=60$, $s=5.0$,\n  - $\\sigma_{a,0}=0.01$, $\\sigma_{a,1}=0.2$, $s_a=7.0$, $\\sigma_{a,2}=0.03$,\n  - $\\sigma_{p,0}=0.2$, $s_f=6.0$, $\\sigma_{p,1}=0.05$,\n  - $c_{\\ell}=2.0$, $\\lambda=0.10$.\n- Case $3$ (thermalized pin, no leakage adjustment boundary case):\n  - $A=1.0$, $B=5.0$, $g_t=65$, $s=3.0$,\n  - $\\sigma_{a,0}=0.02$, $\\sigma_{a,1}=0.5$, $s_a=5.0$, $\\sigma_{a,2}=0.01$,\n  - $\\sigma_{p,0}=0.7$, $s_f=4.0$, $\\sigma_{p,1}=0.02$,\n  - $c_{\\ell}=1.0$, $\\lambda=0.00$.\n\nYour program must:\n- For each test case, construct the fine-group arrays $\\phi_g$, $\\Sigma_{a,g}$, $\\nu\\Sigma_{f,g}$, $R_{a,g}$, $R_{p,g}$, and $L_g$ using the formulas and parameters above.\n- Compute the condensed two-group macroscopic absorption and fission production constants for both weighting spectra.\n- Compute, for each test case, the four variances $\\left[\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,2}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,1}\\right),\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right)\\right]$ measured in $\\left(\\text{cm}^{-1}\\right)^2$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered by test case and within each test case in the order listed above. Concretely, the output must be $$\\left[\\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,2}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,1}\\right),\\ \\text{case}_1\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right),\\ \\text{case}_2\\ \\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{a,1}\\right),\\dots,\\ \\text{case}_3\\ \\mathrm{Var}\\!\\left(\\overline{\\nu\\Sigma}_{f,2}\\right)\\right],$$ where each entry is a float in $\\left(\\text{cm}^{-1}\\right)^2$.",
            "solution": "The problem statement has been rigorously validated and is determined to be valid. It is scientifically grounded in the principles of nuclear reactor physics, specifically multigroup neutron transport theory. The problem is well-posed, with all necessary data, formulas, and constraints clearly defined, ensuring a unique and computable solution. The language is objective and the setup is self-consistent and mathematically sound.\n\nThe core task is to perform energy group condensation of macroscopic cross sections, a standard technique in reactor analysis used to reduce computational complexity while preserving essential physics. The fundamental principle is the preservation of reaction rates. The total reaction rate in a coarse energy group $H$ must equal the sum of reaction rates across all fine energy groups $g$ that constitute group $H$.\nGiven a reaction of type $X$, the total reaction rate in coarse group $H$ is $\\sum_{g \\in H} R_{X,g} = \\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g$. We seek a condensed cross section $\\overline{\\Sigma}_{X,H}$ such that this rate is reproduced by $\\overline{\\Sigma}_{X,H}\\,\\overline{\\phi}_H$, where $\\overline{\\phi}_H$ is the total flux in group $H$, defined as $\\overline{\\phi}_H = \\sum_{g \\in H} \\phi_g$. Equating these gives:\n$$\n\\overline{\\Sigma}_{X,H} \\left( \\sum_{g \\in H} \\phi_g \\right) = \\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g \\implies \\overline{\\Sigma}_{X,H} = \\frac{\\sum_{g \\in H} \\Sigma_{X,g}\\,\\phi_g}{\\sum_{g \\in H} \\phi_g}\n$$\nThis is precisely the formula provided in the problem statement for the case where the weighting spectrum $w_g$ is the scalar flux $\\phi_g$ itself. The problem generalizes this concept by introducing an arbitrary weighting spectrum $w_g$, leading to the discrete flux-weighted average definition:\n$$\n\\overline{\\Sigma}_{X,H} = \\frac{\\sum_{g\\in H}\\Sigma_{X,g}\\,w_g}{\\sum_{g\\in H}w_g}\n$$\nThis calculation must be performed for two different choices of weighting spectrum $w_g$:\n1.  **Infinite-lattice weighting**: $w_g = \\phi_g$. This spectrum is characteristic of the neutronic environment in a conceptually infinite, periodic lattice of fuel pins, far from any boundaries or material discontinuities.\n2.  **Leakage-adjusted weighting**: $w_g = \\tilde{\\phi}_g = \\max(\\phi_g - \\lambda L_g, \\epsilon)$. This spectrum is a modification of the infinite-lattice flux, designed to approximate the effects of neutron leakage (net current) in a finite-sized fuel assembly. The parameter $\\lambda$ controls the magnitude of this adjustment, and the floor $\\epsilon$ ensures numerical stability.\n\nThe solution is obtained by following a direct computational procedure for each of the three test cases provided.\n\n**Step 1: Generation of Fine-Group Data**\nFor each test case, we first generate the necessary $G=70$ fine-group neutronic data. The group indices range from $g=0$ to $g=69$.\nThe scalar flux $\\phi_g$, absorption cross section $\\Sigma_{a,g}$, and fission production term $\\nu\\Sigma_{f,g}$ are computed using the given parametric formulas and the specific parameters for the case:\n$$\n\\phi_g = \\frac{A}{g+1} + B\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s^2}\\right)\n$$\n$$\n\\Sigma_{a,g} = \\sigma_{a,0} + \\sigma_{a,1}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_a^2}\\right) + \\frac{\\sigma_{a,2}}{g+1}\n$$\n$$\n\\nu\\Sigma_{f,g} = \\sigma_{p,0}\\,\\exp\\!\\left(-\\frac{(g-g_t)^2}{2\\,s_f^2}\\right) + \\frac{\\sigma_{p,1}}{\\sqrt{g+1}}\n$$\nThe leakage spectrum estimator $L_g$ is calculated as the magnitude of a finite difference of the flux spectrum. For $g \\in \\{0, 1, \\dots, 68\\}$, $L_g = c_{\\ell}|\\phi_g - \\phi_{g+1}|$. For the boundary group $g=69$, the problem specifies $\\phi_{70} \\equiv \\phi_{69}$, which implies $L_{69} = c_{\\ell}|\\phi_{69} - \\phi_{69}| = 0$. The requested reaction rates $R_{a,g}=\\Sigma_{a,g}\\phi_g$ and $R_{p,g}=\\nu\\Sigma_{f,g}\\phi_g$ are also constructed.\n\n**Step 2: Group Condensation**\nThe $70$ fine groups are partitioned into $2$ coarse groups: Group $H=1$ (fast/epithermal, $g \\in \\{0, \\dots, 29\\}$) and Group $H=2$ (thermal, $g \\in \\{30, \\dots, 69\\}$). For each reaction type ($X=a$ for absorption, $X=p$ for fission production) and for each coarse group ($H=1, 2$), we compute the condensed constant using both weighting schemes.\n\nFor the **infinite-lattice weighting**, we use $w_g = \\phi_g$. The condensed cross section for absorption in Group $1$, for example, is:\n$$\n\\overline{\\Sigma}_{a,1}^{(\\text{inf})} = \\frac{\\sum_{g=0}^{29} \\Sigma_{a,g}\\,\\phi_g}{\\sum_{g=0}^{29} \\phi_g}\n$$\nThe other three constants, $\\overline{\\Sigma}_{a,2}^{(\\text{inf})}$, $\\overline{\\nu\\Sigma}_{f,1}^{(\\text{inf})}$, and $\\overline{\\nu\\Sigma}_{f,2}^{(\\text{inf})}$, are calculated analogously by applying the formula to the appropriate cross section data and group indices.\n\nFor the **leakage-adjusted weighting**, we first compute the weighting spectrum $w_g = \\tilde{\\phi}_g = \\max(\\phi_g - \\lambda L_g, \\epsilon)$, where $\\epsilon = 10^{-12}$. The condensed cross section for absorption in Group $1$ is then:\n$$\n\\overline{\\Sigma}_{a,1}^{(\\text{leak})} = \\frac{\\sum_{g=0}^{29} \\Sigma_{a,g}\\,\\tilde{\\phi}_g}{\\sum_{g=0}^{29} \\tilde{\\phi}_g}\n$$\nSimilarly, we compute $\\overline{\\Sigma}_{a,2}^{(\\text{leak})}$, $\\overline{\\nu\\Sigma}_{f,1}^{(\\text{leak})}$, and $\\overline{\\nu\\Sigma}_{f,2}^{(\\text{leak})}$.\n\n**Step 3: Variance Calculation**\nThe final step is to quantify the difference between the results from the two weighting schemes. For each pair of condensed constants ($\\overline{\\Sigma}_{X,H}^{(\\text{inf})}$ and $\\overline{\\Sigma}_{X,H}^{(\\text{leak})}$), the variance is computed. The provided formula, $\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right)=\\frac{1}{2}\\sum_{k}\\left(\\overline{\\Sigma}_{X,H}^{(k)}-\\overline{\\Sigma}_{X,H}^{\\text{mean}}\\right)^2$, simplifies for a population of two to the squared semi-difference:\n$$\n\\mathrm{Var}\\!\\left(\\overline{\\Sigma}_{X,H}\\right) = \\left( \\frac{\\overline{\\Sigma}_{X,H}^{(\\text{inf})} - \\overline{\\Sigma}_{X,H}^{(\\text{leak})}}{2} \\right)^2\n$$\nThis calculation is performed for all four pairs of constants ($X \\in \\{a, p\\}$, $H \\in \\{1, 2\\}$) for each of the three test cases. For Case $3$, where the leakage adjustment parameter $\\lambda=0$, the leakage-adjusted spectrum $\\tilde{\\phi}_g$ becomes identical to the infinite-lattice flux $\\phi_g$ (as $\\phi_g \\gg \\epsilon$), leading to the expectation that $\\overline{\\Sigma}_{X,H}^{(\\text{inf})} = \\overline{\\Sigma}_{X,H}^{(\\text{leak})}$ and all resulting variances are zero. This serves as an important validation check for the numerical implementation.\n\nThe entire procedure is implemented using Python with the `numpy` library, which is well-suited for the required vectorized numerical computations. The results for the three test cases are aggregated into a single list as per the output format requirements.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Solves the group condensation problem for three test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: thermalized pin, moderate leakage\n        {\n            \"A\": 1.0, \"B\": 5.0, \"g_t\": 65.0, \"s\": 3.0,\n            \"sigma_a_0\": 0.02, \"sigma_a_1\": 0.5, \"s_a\": 5.0, \"sigma_a_2\": 0.01,\n            \"sigma_p_0\": 0.7, \"s_f\": 4.0, \"sigma_p_1\": 0.02,\n            \"c_l\": 1.0, \"lambda\": 0.05\n        },\n        # Case 2: harder spectrum pin, stronger leakage\n        {\n            \"A\": 3.0, \"B\": 0.5, \"g_t\": 60.0, \"s\": 5.0,\n            \"sigma_a_0\": 0.01, \"sigma_a_1\": 0.2, \"s_a\": 7.0, \"sigma_a_2\": 0.03,\n            \"sigma_p_0\": 0.2, \"s_f\": 6.0, \"sigma_p_1\": 0.05,\n            \"c_l\": 2.0, \"lambda\": 0.10\n        },\n        # Case 3: thermalized pin, no leakage adjustment\n        {\n            \"A\": 1.0, \"B\": 5.0, \"g_t\": 65.0, \"s\": 3.0,\n            \"sigma_a_0\": 0.02, \"sigma_a_1\": 0.5, \"s_a\": 5.0, \"sigma_a_2\": 0.01,\n            \"sigma_p_0\": 0.7, \"s_f\": 4.0, \"sigma_p_1\": 0.02,\n            \"c_l\": 1.0, \"lambda\": 0.00\n        }\n    ]\n\n    epsilon = 1.0e-12\n    num_groups = 70\n    g = np.arange(num_groups, dtype=np.float64)\n\n    group1_indices = slice(0, 30)\n    group2_indices = slice(30, num_groups)\n\n    all_results = []\n\n    for params in test_cases:\n        # Step 1: Generate fine-group data\n        phi_g = (params[\"A\"] / (g + 1.0) +\n                 params[\"B\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s\"]**2)))\n\n        Sigma_a_g = (params[\"sigma_a_0\"] +\n                     params[\"sigma_a_1\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s_a\"]**2)) +\n                     params[\"sigma_a_2\"] / (g + 1.0))\n\n        nuSigma_f_g = (params[\"sigma_p_0\"] * np.exp(-(g - params[\"g_t\"])**2 / (2.0 * params[\"s_f\"]**2)) +\n                       params[\"sigma_p_1\"] / np.sqrt(g + 1.0))\n\n        # These are requested but not used in the final variance calculation\n        # R_a_g = Sigma_a_g * phi_g\n        # R_p_g = nuSigma_f_g * phi_g\n\n        # Calculate L_g with boundary condition phi_70 = phi_69\n        phi_g_plus_1 = np.append(phi_g[1:], phi_g[-1])\n        L_g = params[\"c_l\"] * np.abs(phi_g - phi_g_plus_1)\n\n        # Step 2: Group Condensation\n        # Define weighting spectra\n        w_inf = phi_g\n        w_leak = np.maximum(phi_g - params[\"lambda\"] * L_g, epsilon)\n\n        def condense(sigma_fine, weight_fine, group_slice):\n            \"\"\"Performs group condensation for a single coarse group.\"\"\"\n            numerator = np.sum(sigma_fine[group_slice] * weight_fine[group_slice])\n            denominator = np.sum(weight_fine[group_slice])\n            return numerator / denominator if denominator != 0.0 else 0.0\n\n        # Condense using infinite-lattice weighting\n        Sigma_a1_inf = condense(Sigma_a_g, w_inf, group1_indices)\n        Sigma_a2_inf = condense(Sigma_a_g, w_inf, group2_indices)\n        nuSigma_f1_inf = condense(nuSigma_f_g, w_inf, group1_indices)\n        nuSigma_f2_inf = condense(nuSigma_f_g, w_inf, group2_indices)\n\n        # Condense using leakage-adjusted weighting\n        Sigma_a1_leak = condense(Sigma_a_g, w_leak, group1_indices)\n        Sigma_a2_leak = condense(Sigma_a_g, w_leak, group2_indices)\n        nuSigma_f1_leak = condense(nuSigma_f_g, w_leak, group1_indices)\n        nuSigma_f2_leak = condense(nuSigma_f_g, w_leak, group2_indices)\n\n        # Step 3: Variance Calculation\n        def calculate_variance(val_inf, val_leak):\n            \"\"\"Calculates variance for a population of two values.\"\"\"\n            return ((val_inf - val_leak) / 2.0)**2\n\n        var_a1 = calculate_variance(Sigma_a1_inf, Sigma_a1_leak)\n        var_a2 = calculate_variance(Sigma_a2_inf, Sigma_a2_leak)\n        var_p1 = calculate_variance(nuSigma_f1_inf, nuSigma_f1_leak)\n        var_p2 = calculate_variance(nuSigma_f2_inf, nuSigma_f2_leak)\n\n        all_results.extend([var_a1, var_a2, var_p1, var_p2])\n\n    # Final print statement in the exact required format.\n    # Using scientific notation to handle potentially very small numbers.\n    print(f\"[{','.join(f'{r:.12e}' for r in all_results)}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "Realistic reactor simulation must account for the evolution of material properties as fuel depletes, or 'burns up,' over time. This advanced exercise integrates burnup physics with homogenization by tasking you with developing a nodal burnup map from detailed pin-power histories . You will derive and apply a reactivity-based weighting scheme, rooted in perturbation theory, to demonstrate how the varying importance of different fuel pins influences the generation of burnup-dependent homogenized cross sections for use in coarse-mesh nodal codes.",
            "id": "4228064",
            "problem": "You are tasked with formulating, from first principles, a method to compute an assembly-level nodal reactivity-weighted burnup map from pin-wise power histories and to use that map to produce burnup-dependent homogenized macroscopic absorption cross sections. The context is a single fuel assembly modeled as a rectangular lattice of identical fuel pins subdivided into nodal regions. The objective is to connect pin-cell physics to assembly lattice homogenization using fundamental definitions and well-tested approximations.\n\nThe assembly contains $N_p = 16$ pins arranged in a $4 \\times 4$ grid. The assembly is subdivided into $N_n = 4$ square nodes in a $2 \\times 2$ pattern, where each node contains a $2 \\times 2$ block of pins. Let the node indices be $n \\in \\{0,1,2,3\\}$, defined by pin index blocks:\n- Node $0$: rows $0$-$1$, columns $0$-$1$,\n- Node $1$: rows $0$-$1$, columns $2$-$3$,\n- Node $2$: rows $2$-$3$, columns $0$-$1$,\n- Node $3$: rows $2$-$3$, columns $2$-$3$.\nAll pins have identical fuel mass $M_p = 0.5\\ \\mathrm{kgU}$ and identical volume $V_p = 400\\ \\mathrm{cm}^3$. Burnup must be expressed in megawatt day per kilogram of Uranium (MWd/kgU).\n\nFundamental base and definitions:\n- The time-discretized pin-wise power history is provided as $P_p(t_i)$ in megawatts, over $N_t = 4$ equal time steps of $\\Delta t = 10\\ \\mathrm{days}$.\n- The pin burnup $B_p$ is defined by the energy per unit fuel mass accumulated by that pin, namely\n$$\nB_p = \\frac{1}{M_p}\\sum_{i=0}^{N_t-1} P_p(t_i)\\,\\Delta t,\n$$\nwhich yields burnup in $\\mathrm{MWd/kgU}$ when $P_p$ is in $\\mathrm{MW}$ and $\\Delta t$ in $\\mathrm{days}$.\n- Homogenized macroscopic absorption cross sections must be computed in inverse centimeters ($\\mathrm{cm}^{-1}$).\n- You must use an importance-weighted definition of nodal burnup based on reactivity worth, motivated by first-order neutron perturbation theory and physically reasonable approximations applicable to light water reactor lattices. The final nodal quantity is the nodal reactivity-weighted burnup $B_n^{\\mathrm{rw}}$.\n- Homogenized cross sections must be obtained by flux-volume weighting of burnup-dependent macroscopic cross sections across pins belonging to each node.\n\nPin-wise macroscopic cross section models:\n- Treat macroscopic fission cross section $\\Sigma_{f,p}(B)$ and macroscopic absorption cross section $\\Sigma_{a,p}(B)$ as linear functions of burnup $B$, with coefficients dependent on whether a pin is an interior pin or an edge/corner pin in the $4 \\times 4$ lattice:\n    - For interior pins (rows $1$-$2$ and columns $1$-$2$):\n        $$\n        \\Sigma_{f,p}(B) = 0.120 - 2.0\\times 10^{-6}\\,B,\\quad \\Sigma_{a,p}(B) = 0.090 + 4.0\\times 10^{-6}\\,B.\n        $$\n    - For edge or corner pins (all other indices):\n        $$\n        \\Sigma_{f,p}(B) = 0.115 - 1.5\\times 10^{-6}\\,B,\\quad \\Sigma_{a,p}(B) = 0.095 + 3.0\\times 10^{-6}\\,B.\n        $$\n  The units of $\\Sigma_{f,p}$ and $\\Sigma_{a,p}$ are $\\mathrm{cm}^{-1}$, and $B$ is in $\\mathrm{MWd/kgU}$.\n\nFlux and weighting approximation:\n- In light water reactor lattice physics, the neutron balance in a single energy group can be represented by diffusion theory, and first-order neutron perturbation theory implies a reactivity importance that is proportional to the product of adjoint flux and the local operator perturbation. For practical assembly-level homogenization, assume equality of forward and adjoint flux shapes, and use the last-time-step pin power $P_p(t_{N_t-1})$ to construct a proxy for the forward flux $\\phi_p$ according to\n$$\n\\phi_p \\propto \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p},\n$$\nwhere the proportionality constant cancels in ratios.\n\nYour program must:\n1. Compute pin burnups $B_p$ for all pins in all test cases in $\\mathrm{MWd/kgU}$.\n2. Derive a reactivity-weighted nodal burnup map $B_n^{\\mathrm{rw}}$ by constructing physically motivated pin importance weights $w_p$ and aggregating to nodes. You must justify and implement a reactivity weighting that is consistent with first-order perturbation theory and the flux approximation above. For the node $n$, compute\n$$\nB_n^{\\mathrm{rw}} = \\frac{\\sum_{p\\in n} w_p\\,B_p}{\\sum_{p\\in n} w_p},\n$$\nand output values in $\\mathrm{MWd/kgU}$ rounded to three decimals.\n3. Using flux-volume weighting and the burnup-dependent macroscopic absorption cross sections, compute for each node a homogenized macroscopic absorption cross section $\\Sigma_{a,n}^{\\mathrm{hom}}$ at the computed nodal burnup. Using the last-time-step flux proxy $\\phi_p$ as above, compute\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\phi_p\\,V_p}{\\sum_{p\\in n} \\phi_p\\,V_p},\n$$\nand output values in $\\mathrm{cm}^{-1}$ rounded to five decimals.\n\nTest suite:\nUse the following three cases of pin-wise power histories (in $\\mathrm{MW}$). For each case $k\\in\\{1,2,3\\}$, $P^{(k)}(t_i)$ is given as a $4\\times 4$ matrix for $i\\in\\{0,1,2,3\\}$.\n\nCase $1$:\n$$\nP^{(1)}(t_0) =\n\\begin{bmatrix}\n0.30  0.35  0.35  0.30\\\\\n0.35  0.45  0.45  0.35\\\\\n0.35  0.45  0.45  0.35\\\\\n0.30  0.35  0.35  0.30\n\\end{bmatrix},\\quad\nP^{(1)}(t_1) =\n\\begin{bmatrix}\n0.28  0.33  0.33  0.28\\\\\n0.34  0.48  0.48  0.34\\\\\n0.34  0.48  0.48  0.34\\\\\n0.28  0.33  0.33  0.28\n\\end{bmatrix},\n$$\n$$\nP^{(1)}(t_2) =\n\\begin{bmatrix}\n0.26  0.31  0.31  0.26\\\\\n0.33  0.50  0.50  0.33\\\\\n0.33  0.50  0.50  0.33\\\\\n0.26  0.31  0.31  0.26\n\\end{bmatrix},\\quad\nP^{(1)}(t_3) =\n\\begin{bmatrix}\n0.25  0.30  0.30  0.25\\\\\n0.32  0.52  0.52  0.32\\\\\n0.32  0.52  0.52  0.32\\\\\n0.25  0.30  0.30  0.25\n\\end{bmatrix}.\n$$\n\nCase $2$:\n$$\nP^{(2)}(t_0) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\\quad\nP^{(2)}(t_1) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\n$$\n$$\nP^{(2)}(t_2) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix},\\quad\nP^{(2)}(t_3) =\n\\begin{bmatrix}\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\\\\\n0.40  0.40  0.40  0.40\n\\end{bmatrix}.\n$$\n\nCase $3$:\n$$\nP^{(3)}(t_0) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.40  0.40  0.30\\\\\n0.30  0.40  0.40  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\\quad\nP^{(3)}(t_1) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.42  0.42  0.30\\\\\n0.30  0.42  0.42  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\n$$\n$$\nP^{(3)}(t_2) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.44  0.44  0.30\\\\\n0.30  0.44  0.44  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix},\\quad\nP^{(3)}(t_3) =\n\\begin{bmatrix}\n0.01  0.30  0.30  0.30\\\\\n0.30  0.46  0.46  0.30\\\\\n0.30  0.46  0.46  0.30\\\\\n0.30  0.30  0.30  0.30\n\\end{bmatrix}.\n$$\n\nAngle units are not applicable. Percentages are not involved; any fractional answers must be expressed as decimals. Your program must process the three cases and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the entry for each case is a list with two lists: the first is the nodal reactivity-weighted burnups in $\\mathrm{MWd/kgU}$ rounded to three decimals, and the second is the corresponding homogenized macroscopic absorption cross sections in $\\mathrm{cm}^{-1}$ rounded to five decimals. For example, the output format must be\n$$\n\\left[\\left[\\left[b_{0},b_{1},b_{2},b_{3}\\right],\\left[\\sigma_{0},\\sigma_{1},\\sigma_{2},\\sigma_{3}\\right]\\right],\\ \\text{case 2 result},\\ \\text{case 3 result}\\right].\n$$",
            "solution": "The user has provided a problem in the domain of nuclear reactor physics, specifically concerning the homogenization of fuel assembly properties from pin-level data. The task is to compute reactivity-weighted nodal burnup and flux-volume weighted nodal macroscopic absorption cross sections.\n\nThe validation of the problem statement confirms that it is scientifically grounded, well-posed, and objective. It contains all necessary data and models to proceed with a solution. The core of the problem lies in the derivation of a suitable reactivity-weighting factor for pin burnup, based on the provided physical context. A rigorous derivation from first principles is formulated below, followed by a step-by-step computational procedure.\n\n**1. Theoretical Formulation**\n\nThe problem requires a multi-step calculation starting from pin-level power histories and culminating in homogenized nodal parameters.\n\n**1.1. Pin Burnup Calculation**\nThe burnup, $B_p$, for each pin $p$ is the total energy produced per unit mass of initial heavy metal. Given the pin-wise power history $P_p(t_i)$ in megawatts ($\\mathrm{MW}$) over $N_t$ time steps of duration $\\Delta t$ in days, and an initial uranium mass $M_p$ in kilograms of Uranium ($\\mathrm{kgU}$), the burnup is calculated as:\n$$\nB_p = \\frac{1}{M_p}\\sum_{i=0}^{N_t-1} P_p(t_i)\\,\\Delta t\n$$\nThe units of $B_p$ will be $\\mathrm{MWd/kgU}$, as specified.\n\n**1.2. Pin-wise Macroscopic Cross Sections**\nThe macroscopic fission ($\\Sigma_{f,p}$) and absorption ($\\Sigma_{a,p}$) cross sections are given as linear functions of pin burnup $B_p$. The coefficients of these linear models depend on the pin's position within the $4 \\times 4$ assembly lattice. The problem distinguishes between \"interior\" pins and \"edge/corner\" pins. Let's denote the burnup-dependent cross sections as $\\Sigma_{f,p}(B_p)$ and $\\Sigma_{a,p}(B_p)$.\n\n**1.3. Derivation of Reactivity Weights $w_p$**\nThe problem mandates the computation of a nodal reactivity-weighted burnup, $B_n^{\\mathrm{rw}}$, using pin-specific importance weights, $w_p$. These weights must be derived from first-order neutron perturbation theory and the provided approximations.\n\nIn reactor physics, the \"importance\" of a neutron is given by the adjoint flux, $\\phi^*$. The overall reactivity of a system is related to the total importance-weighted fission neutron production. The denominator of the first-order perturbation theory expression for reactivity is the term $F = \\langle \\phi^*, \\mathcal{F} \\phi \\rangle = \\int \\phi^*(\\mathbf{r}) \\nu\\Sigma_f(\\mathbf{r}) \\phi(\\mathbf{r}) dV$, where $\\mathcal{F}$ is the fission operator. This term represents the total effectiveness of fission neutrons in sustaining the chain reaction.\n\nA physically motivated weight for any pin-wise quantity can be its contribution to this total effectiveness. The contribution of a single pin $p$ is approximately $(\\phi_p^*)(\\nu\\Sigma_{f,p}\\phi_p V_p)$. The problem states to assume the adjoint flux shape is proportional to the forward flux shape, i.e., $\\phi_p^* \\propto \\phi_p$. Therefore, the contribution of pin $p$ is proportional to $\\phi_p (\\nu\\Sigma_{f,p}\\phi_p V_p) = \\nu\\Sigma_{f,p}\\phi_p^2 V_p$.\n\nThe constant $\\nu$ (neutrons released per fission) is uniform across the assembly and will cancel out in the weighted average formula. Thus, a suitable pin importance weight $w_p$ is:\n$$\nw_p \\propto \\Sigma_{f,p}(B_p)\\,\\phi_p^2\\,V_p\n$$\nThe problem provides a proxy for the forward flux $\\phi_p$ based on the pin power at the final time step, $P_p(t_{N_t-1})$:\n$$\n\\phi_p \\propto \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p}\n$$\nLet the proportionality constant be $C$. Substituting this into the expression for the weight $w_p$:\n$$\nw_p \\propto \\Sigma_{f,p}(B_p) \\left( C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p} \\right)^2 V_p = C^2 \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)\\,V_p}\n$$\nSince the pin volume $V_p$ is identical for all pins and the constant $C^2$ is global, they will both cancel out in the weighted average. The final, simplified expression for the reactivity weight $w_p$ is:\n$$\nw_p = \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}\n$$\nThis weight is dimensionless and represents the reactivity importance of the pin properties.\n\n**1.4. Nodal Reactivity-Weighted Burnup ($B_n^{\\mathrm{rw}}$)**\nWith the weights $w_p$ defined, the reactivity-weighted burnup for a node $n$ is the weighted average of the burnups of the pins within that node:\n$$\nB_n^{\\mathrm{rw}} = \\frac{\\sum_{p\\in n} w_p\\,B_p}{\\sum_{p\\in n} w_p} = \\frac{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}\\,B_p}{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})^2}{\\Sigma_{f,p}(B_p)}}\n$$\n\n**1.5. Homogenized Nodal Macroscopic Absorption Cross Section ($\\Sigma_{a,n}^{\\mathrm{hom}}$)**\nThe homogenized absorption cross section for a node, $\\Sigma_{a,n}^{\\mathrm{hom}}$, is calculated using flux-volume weighting. The formula is given as:\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\phi_p\\,V_p}{\\sum_{p\\in n} \\phi_p\\,V_p}\n$$\nUsing the provided flux proxy, the weighting term $\\phi_p V_p$ becomes:\n$$\n\\phi_p V_p = \\left( C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)\\,V_p} \\right) V_p = C \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}\n$$\nThe constant $C$ cancels in the ratio, leaving the weighting factor for pin $p$ as $W_{FV,p} = \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}$. The formula for the homogenized cross section is thus a weighted average of the pin-wise absorption cross sections $\\Sigma_{a,p}(B_p)$:\n$$\n\\Sigma_{a,n}^{\\mathrm{hom}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,W_{FV,p}}{\\sum_{p\\in n} W_{FV,p}} = \\frac{\\sum_{p\\in n} \\Sigma_{a,p}(B_p)\\,\\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}}{\\sum_{p\\in n} \\frac{P_p(t_{N_t-1})}{\\Sigma_{f,p}(B_p)}}\n$$\n\n**2. Computational Steps**\n\nThe solution is implemented by following the derived formulas for each of the three test cases.\n\n1.  **Constants and Geometry Definition**: Define constants $M_p = 0.5\\ \\mathrm{kgU}$, $\\Delta t = 10\\ \\mathrm{days}$, and $V_p = 400\\ \\mathrm{cm}^3$. A $4 \\times 4$ boolean matrix is used to distinguish interior pins from edge/corner pins. Node boundaries are defined as $2 \\times 2$ slices of the full $4 \\times 4$ pin array.\n\n2.  **Process Each Test Case**: For each case's power history data $P^{(k)}(t_i)$:\n    a.  Calculate the $4 \\times 4$ matrix of pin burnups $B_p$ by summing the power matrices over all time steps and multiplying by $\\Delta t / M_p$.\n    b.  Calculate the $4 \\times 4$ matrices for pin-wise final cross sections, $\\Sigma_{f,p}(B_p)$ and $\\Sigma_{a,p}(B_p)$, using the respective linear models based on the pin-type map and the calculated burnup matrix $B_p$.\n    c.  Calculate the $4 \\times 4$ matrix of reactivity weights $w_p$ using the final time-step power $P_p(t_3)$ and the final fission cross sections $\\Sigma_{f,p}(B_p)$.\n    d.  For each of the four nodes ($n \\in \\{0,1,2,3\\}$):\n        i.  Slice the $B_p$ and $w_p$ matrices to extract the values for the pins in the current node.\n        ii. Compute $B_n^{\\mathrm{rw}}$ using the nodal weighted average formula.\n    e.  For each of the four nodes:\n        i.  Calculate the flux-volume weighting factors $W_{FV,p} = P_p(t_3)/\\Sigma_{f,p}(B_p)$.\n        ii. Slice aformentioned factors and the $\\Sigma_{a,p}(B_p)$ matrix to extract values for the current node.\n        iii. Compute $\\Sigma_{a,n}^{\\mathrm{hom}}$ using the nodal weighted average formula for cross sections.\n    f.  Store the results, rounded to the specified precision: $B_n^{\\mathrm{rw}}$ to three decimal places and $\\Sigma_{a,n}^{\\mathrm{hom}}$ to five decimal places.\n\n3.  **Final Output**: Assemble the results from all three cases into the specified list format and print as a single line.\n\nThis structured approach ensures that all requirements of the problem are met, adhering to the physical principles and mathematical definitions provided.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes nodal reactivity-weighted burnup and homogenized macroscopic absorption\n    cross sections for a fuel assembly based on pin-wise power histories.\n    \"\"\"\n    # Define problem constants\n    M_p = 0.5  # kgU\n    delta_t = 10.0  # days\n    # V_p = 400.0 cm^3, but it cancels out in all calculations\n\n    # Test cases for pin-wise power histories P(t_i) in MW\n    test_cases_power = [\n        # Case 1\n        [\n            np.array([[0.30, 0.35, 0.35, 0.30], [0.35, 0.45, 0.45, 0.35], [0.35, 0.45, 0.45, 0.35], [0.30, 0.35, 0.35, 0.30]]),\n            np.array([[0.28, 0.33, 0.33, 0.28], [0.34, 0.48, 0.48, 0.34], [0.34, 0.48, 0.48, 0.34], [0.28, 0.33, 0.33, 0.28]]),\n            np.array([[0.26, 0.31, 0.31, 0.26], [0.33, 0.50, 0.50, 0.33], [0.33, 0.50, 0.50, 0.33], [0.26, 0.31, 0.31, 0.26]]),\n            np.array([[0.25, 0.30, 0.30, 0.25], [0.32, 0.52, 0.52, 0.32], [0.32, 0.52, 0.52, 0.32], [0.25, 0.30, 0.30, 0.25]]),\n        ],\n        # Case 2\n        [\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n            np.full((4, 4), 0.40),\n        ],\n        # Case 3\n        [\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.40, 0.40, 0.30], [0.30, 0.40, 0.40, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.42, 0.42, 0.30], [0.30, 0.42, 0.42, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.44, 0.44, 0.30], [0.30, 0.44, 0.44, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n            np.array([[0.01, 0.30, 0.30, 0.30], [0.30, 0.46, 0.46, 0.30], [0.30, 0.46, 0.46, 0.30], [0.30, 0.30, 0.30, 0.30]]),\n        ],\n    ]\n\n    # Assembly geometry\n    # A map of pin types: True for Interior, False for Edge/Corner\n    is_interior_map = np.full((4, 4), False)\n    is_interior_map[1:3, 1:3] = True\n\n    # Node definitions (slices for the 4x4 array)\n    node_slices = [\n        np.s_[0:2, 0:2],  # Node 0\n        np.s_[0:2, 2:4],  # Node 1\n        np.s_[2:4, 0:2],  # Node 2\n        np.s_[2:4, 2:4],  # Node 3\n    ]\n\n    # Cross section model coefficients\n    # Coeffs for Sigma(B) = C0 + C1*B\n    # Fission cross section coefficients\n    sf_c0_int, sf_c1_int = 0.120, -2.0e-6\n    sf_c0_edge, sf_c1_edge = 0.115, -1.5e-6\n    # Absorption cross section coefficients\n    sa_c0_int, sa_c1_int = 0.090, 4.0e-6\n    sa_c0_edge, sa_c1_edge = 0.095, 3.0e-6\n\n    def get_sigma_f(B, is_interior):\n        return np.where(is_interior, sf_c0_int + sf_c1_int * B, sf_c0_edge + sf_c1_edge * B)\n\n    def get_sigma_a(B, is_interior):\n        return np.where(is_interior, sa_c0_int + sa_c1_int * B, sa_c0_edge + sa_c1_edge * B)\n\n    # Main processing loop\n    results = []\n    for power_history in test_cases_power:\n        # 1. Compute pin burnups B_p\n        total_energy_per_pin = sum(power_history) * delta_t\n        B_p = total_energy_per_pin / M_p\n\n        # 2. Compute final pin-wise cross sections\n        Sigma_f_p = get_sigma_f(B_p, is_interior_map)\n        Sigma_a_p = get_sigma_a(B_p, is_interior_map)\n        P_p_final = power_history[-1]\n\n        # 3. Compute nodal reactivity-weighted burnup B_n^rw\n        reactivity_weights_w_p = P_p_final**2 / Sigma_f_p\n        \n        nodal_burnups = []\n        for node_slice in node_slices:\n            w_p_node = reactivity_weights_w_p[node_slice]\n            B_p_node = B_p[node_slice]\n            numerator = np.sum(w_p_node * B_p_node)\n            denominator = np.sum(w_p_node)\n            B_n_rw = numerator / denominator if denominator != 0 else 0\n            nodal_burnups.append(round(B_n_rw, 3))\n\n        # 4. Compute homogenized macroscopic absorption cross sections Sigma_a,n^hom\n        flux_volume_weights_W_FVp = P_p_final / Sigma_f_p\n\n        nodal_sigmas = []\n        for node_slice in node_slices:\n            W_FVp_node = flux_volume_weights_W_FVp[node_slice]\n            Sigma_a_p_node = Sigma_a_p[node_slice]\n            numerator = np.sum(Sigma_a_p_node * W_FVp_node)\n            denominator = np.sum(W_FVp_node)\n            Sigma_a_n_hom = numerator / denominator if denominator != 0 else 0\n            nodal_sigmas.append(round(Sigma_a_n_hom, 5))\n        \n        results.append([nodal_burnups, nodal_sigmas])\n\n    # Final print statement in the exact required format\n    # The string conversion here is a bit tricky to match the format precisely.\n    # We avoid spaces after commas within the inner lists.\n    case_strings = []\n    for res in results:\n        b_str = f\"[{','.join(map(str, res[0]))}]\"\n        s_str = f\"[{','.join(map(str, res[1]))}]\"\n        case_strings.append(f\"[{b_str},{s_str}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        }
    ]
}