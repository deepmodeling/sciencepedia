{
    "hands_on_practices": [
        {
            "introduction": "这个练习旨在深入探讨窄共振近似 (NRA) 的核心数学原理。通过首先从第一性原理推导窄共振积分的经典表达式，然后编写一个数值算法来量化此近似与更精确的计算结果之间的偏差，您将对 NRA 背后的关键简化假设——即在共振能量范围内中子通量权重因子 $1/E$ 变化很小——有一个清晰的认识。这个结合了理论推导和数值验证的练习，是掌握 NRA 本质的第一步 ()。",
            "id": "4256177",
            "problem": "考虑热中子谱中重核素的单个孤立吸收共振。在共振峰附近，微观吸收截面可以用单能级洛伦兹（Breit-Wigner）线型来建模，其共振能量为 $E_r$（单位为电子伏特），峰值为 $\\sigma_0$（单位为靶恩），总宽度为 $\\Gamma$（单位为电子伏特）。令 $\\gamma = \\Gamma/2$ 表示半宽度。假设未展宽的能量依赖截面为\n$$\n\\sigma_L(E) = \\sigma_0 \\frac{\\gamma^2}{(E - E_r)^2 + \\gamma^2}.\n$$\n靶核素在绝对温度 $T$（单位为开尔文）下的热运动会产生多普勒展宽，这可以通过将 $\\sigma_L(E)$ 与一个标准差为以下值的高斯核进行卷积来建模：\n$$\nw_D = \\sqrt{\\frac{4 E_r k_B T}{A}},\n$$\n其中 $A$ 是靶核与中子的质量比（无量纲），$k_B$ 是以电子伏特每开尔文表示的玻尔兹曼常数，$k_B = 8.617333262 \\times 10^{-5}$ $\\mathrm{eV/K}$。因此，多普勒展宽截面为\n$$\n\\sigma_D(E) = \\int_{-\\infty}^{+\\infty} \\sigma_L(E') \\frac{1}{w_D \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E - E')^2}{2 w_D^2}\\right) \\, dE'.\n$$\n在勒表示中，计算共振积分的相关通量权重在洛伦兹表示有效的能量区间上使用因子 $1/E$。假设有效区间为对称窗口\n$$\n[E_{\\min}, E_{\\max}] = [\\max(E_r - W, \\varepsilon), E_r + W],\n$$\n其中 $\\varepsilon$ 是为避免除以零而设的一个小的正下界，而 $W$ 是主导宽度尺度的一个选定倍数：\n$$\nW = \\alpha \\cdot \\max(\\gamma, w_D),\n$$\n对于一个指定的乘数 $\\alpha$。那么，数值计算的共振积分是\n$$\nI_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E} \\, dE,\n$$\n其结果必须以靶恩表示。\n\n窄共振近似假定，在共振宽度范围内，$1/E$ 因子的变化可以忽略不计，并可以用其在共振能量处的值来代替。从上述定义和关于与归一化核卷积的经过充分检验的事实出发，推导共振积分 $I_{\\mathrm{NR}}$ 的窄共振近似表达式（以靶恩为单位），并解释为什么任何保持截面轮廓下面积的多普勒展宽都不会改变 $I_{\\mathrm{NR}}$。\n\n然后，设计并实现一个稳健的数值算法来：\n- 使用与高斯的卷积来计算多普勒展宽截面 $\\sigma_D(E)$。为保证计算效率和稳定性，请使用 Voigt 轮廓表示：\n$$\nV(x; w_D, \\gamma) = \\frac{\\Re\\left( w\\!\\left( \\frac{x + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}},\n$$\n其中 $x = E - E_r$，$w(z)$ 是 Faddeeva 函数。多普勒展宽截面可以表示为用洛伦兹面积对 $V$ 进行的保面积缩放，该关系必须从第一性原理推导。\n- 通过在区间 $[E_{\\min}, E_{\\max}]$ 上进行一维数值积分来计算 $I_{\\mathrm{num}}$。\n- 根据你的推导计算窄共振近似 $I_{\\mathrm{NR}}$。\n- 以小数形式报告相对偏差：\n$$\n\\delta = \\frac{I_{\\mathrm{num}} - I_{\\mathrm{NR}}}{I_{\\mathrm{num}}}.\n$$\n对所有测试用例，使用 $\\alpha = 50$ 和 $\\varepsilon = 10^{-8}$ $\\mathrm{eV}$。所有能量必须以 $\\mathrm{eV}$ 处理，温度以 $\\mathrm{K}$ 处理，截面以 $\\mathrm{barns}$ 处理；共振积分 $I_{\\mathrm{num}}$ 和 $I_{\\mathrm{NR}}$ 必须以 $\\mathrm{barns}$ 为单位，最终的相对偏差 $\\delta$ 必须是无量纲小数。\n\n你的程序应为以下参数集 $(E_r, \\sigma_0, \\Gamma, A, T)$ 的测试套件计算 $\\delta$：\n1. 中等温度下的典型窄共振：$(6.67, 1000.0, 0.03, 238.0, 600.0)$。\n2. 较高温度下的较宽共振：$(0.30, 2000.0, 0.50, 239.0, 900.0)$。\n3. 较低温度下的较高能量窄共振：$(20.0, 500.0, 0.02, 232.0, 300.0)$。\n4. 高温下具有中等峰值的极窄共振：$(1.0, 100.0, 0.001, 100.0, 1200.0)$。\n5. 接近零多普勒宽度的边界情况：$(5.0, 800.0, 0.01, 200.0, 1.0)$。\n\n你的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_i$ 是按上述顺序列出的相应测试用例计算出的 $\\delta$ 值（一个小数）。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于核反应堆物理原理，是适定且客观的。为获得唯一解所需的所有必要参数和定义均已提供，并且所要求的任务——推导和数值计算——是共振分析中的标准程序。\n\n### 理论推导与分析\n\n主要任务是推导共振积分的窄共振（NR）近似（表示为 $I_{\\mathrm{NR}}$），并解释其为何独立于多普勒展宽。\n\n数值计算的共振积分定义为：\n$$\nI_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E} \\, dE\n$$\n其中 $\\sigma_D(E)$ 是多普勒展宽截面。\n\n窄共振近似基于一个物理前提，即共振宽度，无论是自然宽度（$\\Gamma$）还是多普勒展宽宽度（$w_D$），与共振能量 $E_r$ 相比都非常小。在此条件下，通量权重项 $1/E$ 在截面 $\\sigma_D(E)$ 显著的能量范围内变化很小。因此，我们可以用其在共振中心的值 $1/E_r$ 来近似 $1/E$，并将这个常数因子从积分中提出：\n$$\nI_{\\mathrm{NR}} = \\int_{E_{\\min}}^{E_{\\max}} \\frac{\\sigma_D(E)}{E_r} \\, dE = \\frac{1}{E_r} \\int_{E_{\\min}}^{E_{\\max}} \\sigma_D(E) \\, dE\n$$\n积分限 $[E_{\\min}, E_{\\max}]$ 由 $W = \\alpha \\cdot \\max(\\gamma, w_D)$ 定义，其中有一个大的乘数 $\\alpha=50$。这确保了该区间几乎覆盖了整个共振轮廓。因此，将积分限扩展到 $(-\\infty, +\\infty)$ 引入的误差可以忽略不计：\n$$\nI_{\\mathrm{NR}} \\approx \\frac{1}{E_r} \\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE\n$$\n积分 $\\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE$ 表示多普勒展宽截面曲线下的总面积。卷积的一个基本性质是，卷积后函数的积分等于原函数积分的乘积。多普勒展宽截面 $\\sigma_D(E)$ 是未展宽的洛伦兹截面 $\\sigma_L(E)$ 与归一化高斯核 $G(E, w_D)$ 的卷积：\n$$\n\\sigma_D(E) = (\\sigma_L * G)(E)\n$$\n根据定义，高斯核是归一化的，即 $\\int_{-\\infty}^{+\\infty} G(E, w_D) \\, dE = 1$。因此，在多普勒展宽过程中，截面轮廓下的面积是守恒的：\n$$\n\\int_{-\\infty}^{+\\infty} \\sigma_D(E) \\, dE = \\left( \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE \\right) \\left( \\int_{-\\infty}^{+\\infty} G(E, w_D) \\, dE \\right) = \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE\n$$\n这就解释了为什么任何保持截面轮廓下面积的多普勒展宽都不会改变 $I_{\\mathrm{NR}}$ 的积分部分的值。展宽效应是将截面的大小重新分布到更宽的能量范围内，使得峰值更低，尾部更宽，但总面积保持不变。\n\n为了求得 $I_{\\mathrm{NR}}$，我们必须计算未展宽洛伦兹轮廓 $\\sigma_L(E)$ 下的面积：\n$$\n\\text{Area}_L = \\int_{-\\infty}^{+\\infty} \\sigma_L(E) \\, dE = \\int_{-\\infty}^{+\\infty} \\sigma_0 \\frac{\\gamma^2}{(E - E_r)^2 + \\gamma^2} \\, dE\n$$\n令 $u = E - E_r$，则 $du = dE$。积分限保持 $(-\\infty, +\\infty)$。\n$$\n\\text{Area}_L = \\sigma_0 \\gamma^2 \\int_{-\\infty}^{+\\infty} \\frac{1}{u^2 + \\gamma^2} \\, du\n$$\n这是一个标准积分。使用反导数 $\\int \\frac{dx}{x^2+a^2} = \\frac{1}{a} \\arctan(\\frac{x}{a})$：\n$$\n\\text{Area}_L = \\sigma_0 \\gamma^2 \\left[ \\frac{1}{\\gamma} \\arctan\\left(\\frac{u}{\\gamma}\\right) \\right]_{u=-\\infty}^{u=+\\infty} = \\sigma_0 \\gamma \\left( \\arctan(+\\infty) - \\arctan(-\\infty) \\right) = \\sigma_0 \\gamma \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\pi \\sigma_0 \\gamma\n$$\n将这个面积代回到 $I_{\\mathrm{NR}}$ 的表达式中：\n$$\nI_{\\mathrm{NR}} = \\frac{1}{E_r} (\\pi \\sigma_0 \\gamma)\n$$\n使用定义 $\\gamma = \\Gamma/2$，其中 $\\Gamma$ 是总宽度，我们得到共振积分的窄共振近似的最终表达式：\n$$\nI_{\\mathrm{NR}} = \\frac{\\pi \\sigma_0 \\Gamma}{2 E_r}\n$$\n该结果与温度 $T$（因此也与多普勒宽度 $w_D$）无关，证实了理论预期。\n\n### 数值算法设计\n\n该算法通过计算两项来计算相对偏差 $\\delta = (I_{\\mathrm{num}} - I_{\\mathrm{NR}}) / I_{\\mathrm{num}}$。\n\n1.  **多普勒展宽截面 $\\sigma_D(E)$**：\n    问题使用 Voigt 函数提供了一种多普勒展宽轮廓的高效表示，该函数是归一化高斯函数和归一化洛伦兹函数的卷积。给定的表达式，\n    $$\n    V(x; w_D, \\gamma) = \\frac{\\Re\\left( w\\!\\left( \\frac{x + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}}\n    $$\n    是归一化的 Voigt 轮廓，意味着它在 $x$ 上从 $-\\infty$ 到 $+\\infty$ 的积分为 $1$。未展宽的截面 $\\sigma_L(E)$ 未经归一化；其面积为 $\\pi \\sigma_0 \\gamma$。\n    由于卷积是线性操作，多普勒展宽截面 $\\sigma_D(E)$ 就是归一化的 Voigt 轮廓乘以原始洛伦兹函数的面积：\n    $$\n    \\sigma_D(E) = (\\text{Area}_L) \\cdot V(E-E_r; w_D, \\gamma) = (\\pi \\sigma_0 \\gamma) \\frac{\\Re\\left( w\\!\\left( \\frac{(E - E_r) + i \\gamma}{w_D \\sqrt{2}} \\right) \\right)}{w_D \\sqrt{2\\pi}}\n    $$\n    该公式将使用 `scipy.special.wofz` 来实现 Faddeeva 函数 $w(z)$。必须处理 $w_D \\to 0$ 的特殊情况，此时轮廓趋向于原始的洛伦兹函数 $\\sigma_L(E)$。然而，鉴于给定的测试用例，$w_D$ 保持为正。\n\n2.  **$I_{\\mathrm{num}}$ 和 $I_{\\mathrm{NR}}$ 的计算**：\n    对于每个参数集 $(E_r, \\sigma_0, \\Gamma, A, T)$：\n    - 计算常数：$\\gamma = \\Gamma/2$ 和 $k_B = 8.617333262 \\times 10^{-5}$ $\\mathrm{eV/K}$。\n    - 计算多普勒宽度标准差：$w_D = \\sqrt{4 E_r k_B T / A}$。\n    - 确定积分窗口：$W = 50 \\cdot \\max(\\gamma, w_D)$。\n    - 设置积分限：$E_{\\min} = \\max(E_r - W, 10^{-8})$ 和 $E_{\\max} = E_r + W$。\n    - 计算窄共振近似积分：$I_{\\mathrm{NR}} = (\\pi \\sigma_0 \\gamma) / E_r$。\n    - 使用 $\\sigma_D(E)$ 的 Voigt 表示来定义被积函数 $f(E) = \\sigma_D(E)/E$。\n    - 使用一个稳健的数值积分例程，例如 `scipy.integrate.quad`，来计算 $I_{\\mathrm{num}} = \\int_{E_{\\min}}^{E_{\\max}} f(E) \\, dE$。\n\n3.  **相对偏差 $\\delta$ 的计算**：\n    - 在计算出 $I_{\\mathrm{num}}$ 和 $I_{\\mathrm{NR}}$ 后，通过以下公式求得相对偏差：\n    $$\n    \\delta = \\frac{I_{\\mathrm{num}} - I_{\\mathrm{NR}}}{I_{\\mathrm{num}}}\n    $$\n    对所有测试用例重复此过程，并收集结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the relative deviation between the numerically evaluated resonance integral\n    and its narrow resonance approximation for a set of test cases.\n    \"\"\"\n    # Define physical and numerical constants from the problem statement.\n    KB_EV_PER_K = 8.617333262e-5  # Boltzmann constant in eV/K\n    ALPHA = 50.0  # Integration window multiplier\n    EPSILON = 1e-8  # Lower energy bound in eV\n\n    # Test suite of parameter sets: (Er, sigma0, Gamma, A, T)\n    # Er: resonance energy [eV]\n    # sigma0: peak cross section [barns]\n    # Gamma: total width [eV]\n    # A: target-to-neutron mass ratio [dimensionless]\n    # T: temperature [K]\n    test_cases = [\n        (6.67, 1000.0, 0.03, 238.0, 600.0),\n        (0.30, 2000.0, 0.50, 239.0, 900.0),\n        (20.0, 500.0, 0.02, 232.0, 300.0),\n        (1.0, 100.0, 0.001, 100.0, 1200.0),\n        (5.0, 800.0, 0.01, 200.0, 1.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters for the current case\n        er, sigma0, gamma_total, mass_ratio_A, temp_T = case\n\n        # 1. Calculate derived parameters\n        gamma = gamma_total / 2.0  # Half-width\n        doppler_width_wd = np.sqrt((4.0 * er * KB_EV_PER_K * temp_T) / mass_ratio_A)\n        \n        # 2. Calculate the narrow resonance approximation integral (I_NR)\n        # I_NR = (pi * sigma0 * gamma) / Er\n        i_nr = (np.pi * sigma0 * gamma) / er\n\n        # 3. Set up for numerical integration\n        # Define the Doppler-broadened cross section using the Voigt profile\n        # sigma_D(E) = (Area_L) * V(E-Er; wD, gamma)\n        lorentzian_area = np.pi * sigma0 * gamma\n        \n        def sigma_doppler_broadened(E, er_val, wd_val, gamma_val):\n            \"\"\"\n            Calculates the Doppler-broadened cross section at energy E.\n            \"\"\"\n            # Handle the case where Doppler width is extremely small to avoid division by zero\n            # The problem's data does not trigger this, but it is good practice\n            if wd_val  1e-15:\n                # Fallback to the unbroadened Lorentzian shape\n                return sigma0 * (gamma_val**2) / ((E - er_val)**2 + gamma_val**2)\n            \n            x = E - er_val\n            z = (x + 1j * gamma_val) / (wd_val * np.sqrt(2.0))\n            \n            # The Voigt profile is proportional to the real part of the Faddeeva function\n            voigt_val = np.real(wofz(z)) / (wd_val * np.sqrt(2.0 * np.pi))\n            \n            return lorentzian_area * voigt_val\n\n        # Define the full integrand for the numerical integral: sigma_D(E) / E\n        def integrand(E, er_val, wd_val, gamma_val):\n            return sigma_doppler_broadened(E, er_val, wd_val, gamma_val) / E\n\n        # Determine integration limits\n        W = ALPHA * max(gamma, doppler_width_wd)\n        emin = max(er - W, EPSILON)\n        emax = er + W\n\n        # 4. Compute the numerical resonance integral (I_num)\n        # quad returns (integral_value, error_estimate)\n        i_num, _ = quad(\n            integrand, \n            emin, \n            emax, \n            args=(er, doppler_width_wd, gamma)\n        )\n\n        # 5. Calculate the relative deviation\n        if i_num == 0:\n            # Avoid division by zero, though unlikely for these parameters\n            delta = 0.0\n        else:\n            delta = (i_num - i_nr) / i_num\n        \n        results.append(delta)\n\n    # Format the final output as a comma-separated list in brackets.\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了窄共振近似 (NRA) 的基本定义后，下一步是将其置于更广阔的理论背景中。NRA 只是用于描述共振现象的几种模型之一，在反应堆物理中，特别是在处理重要的自屏效应时，了解不同模型的适用范围至关重要。本练习将通过计算和比较窄共振 (NR)、宽共振 (WR) 和中间共振 (IR) 近似下的自屏因子，帮助您直观地理解各种模型所对应的物理情境及其预测能力的差异 ()。",
            "id": "4223807",
            "problem": "考虑一个包含稀疏浓度铀-238 (${}^{238}\\text{U}$) 作为共振吸收体的均匀无限介质。在可分辨共振区，使用具有恒定宽度的简化单能级 Breit–Wigner 形式，以洛伦兹记法表示吸收微观截面，来模拟一个中心能量在 $E_{0} = 6.67\\,\\mathrm{eV}$ 的单个孤立 s 波俘获共振，\n$$\n\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}},\n$$\n其中 $\\sigma_{r}$ 是共振峰值，$\\gamma = \\Gamma/2$ 是半宽度。取 $\\sigma_{r} = 2500\\,\\mathrm{b}$ 和 $\\gamma = 0.30\\,\\mathrm{eV}$。使用等效理论表示共振附近的慢化通量凹陷，通过一个恒定的“本底”截面 $\\sigma_{0}$，该截面将几何形状和非共振相互作用合并为一个等效的与能量无关的项，并采用 $\\sigma_{0} = 30\\,\\mathrm{b}$。对通量进行归一化，使得在远离共振区（其中 $\\sigma_{a}(E) \\approx 0$）的地方，通量幅值为1。\n\n将此单个共振的自屏因子 $f$ 定义为在指定通量模型下的共振吸收率与在恒定通量下的未屏蔽吸收率之比：\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}.\n$$\n计算并比较以下三种自屏因子：\n- 窄共振因子 $f_{\\mathrm{NR}}$，取共振区内的 $\\phi(E)$ 为常数。\n- 宽共振因子 $f_{\\mathrm{WR}}$，取 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$。\n- 中间共振因子 $f_{\\mathrm{IR}}$，取 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$，其中 $p = 0.60$。\n\n从给定的定义和模型（洛伦兹截面和上述基于等效理论的通量形式）出发，推导 $f_{\\mathrm{NR}}$、$f_{\\mathrm{WR}}$ 和 $f_{\\mathrm{IR}}$ 的闭式表达式，然后使用给定参数对它们进行数值计算。将能量积分的边界视为延伸至无穷大，其合理性在于共振的宽度相对于勒度网格而言很窄。将 $f_{\\mathrm{NR}}$、$f_{\\mathrm{WR}}$ 和 $f_{\\mathrm{IR}}$ 表示为四舍五入到四位有效数字的无量纲数。最后，通过对其大小进行排序，定量比较它们的预测结果，并评论每种模型所隐含的自屏程度。",
            "solution": "首先验证该问题具有科学依据、提法得当、客观且完整。所有必要的物理模型、定义和数值参数均已提供，并且它们与核反应堆物理学的既定原则，特别是共振吸收理论，是一致的。这个问题是应用等效理论和不同共振近似（窄共振、宽共振、中间共振）的标准练习。因此，我们开始求解。\n\n自屏因子 $f$ 定义为实际（有屏蔽的）共振吸收率与假设的未屏蔽吸收率之比：\n$$\nf \\equiv \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE}\n$$\n该表达式的分母是未屏蔽共振积分，我们将其记为 $I_{unsh}$。使用给定的吸收截面的洛伦兹形式 $\\sigma_{a}(E) = \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}$，我们可以计算这个积分。令 $x = E - E_0$，则 $dx = dE$。积分限保持为 $(-\\infty, \\infty)$。\n$$\nI_{unsh} = \\int_{-\\infty}^{\\infty} \\sigma_{r}\\,\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}\\,dE = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}}\n$$\n这是一个标准积分形式。\n$$\nI_{unsh} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma} \\arctan\\left(\\frac{x}{\\gamma}\\right) \\right]_{-\\infty}^{\\infty} = \\sigma_{r}\\gamma \\left( \\arctan(+\\infty) - \\arctan(-\\infty) \\right) = \\sigma_{r}\\gamma \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right)\n$$\n$$\nI_{unsh} = \\pi \\gamma \\sigma_{r}\n$$\n这个未屏蔽共振积分的结果作为所有三种情况的归一化因子。\n\n现在我们为三种指定的通量模型分别计算自屏因子。\n\n**1. 窄共振 (NR) 因子, $f_{\\mathrm{NR}}$**\n\n窄共振近似假设共振非常窄，以至于在共振区内的任何一次散射碰撞都会将中子移出共振能量范围。因此，共振区内的吸收不会导致通量凹陷，通量保持其渐近值。根据远离共振区通量归一化为1的设定，我们有 $\\phi(E) = 1$。\n$$\nf_{\\mathrm{NR}} = \\frac{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,(1)\\,dE}{\\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,dE} = \\frac{I_{unsh}}{I_{unsh}} = 1\n$$\n解析表达式为 $f_{\\mathrm{NR}} = 1$。其数值为 $1.000$。\n\n**2. 宽共振 (WR) 因子, $f_{\\mathrm{WR}}$**\n\n宽共振近似假设共振非常宽，以至于中子无法通过单次散射碰撞逃离共振区。因此，通量根据稳态慢化方程发生凹陷，在指定的模型条件下，得出 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)}$。因子 $f_{\\mathrm{WR}}$ 的分子是有屏蔽的共振积分 $I_{sh, WR}$：\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E)\\,\\phi(E)\\,dE = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + \\sigma_{a}(E)} dE\n$$\n让我们通过代入 $\\sigma_a(E)$ 的表达式来分析被积函数：\n$$\n\\frac{\\sigma_{a}(E)}{\\sigma_{0} + \\sigma_{a}(E)} = \\frac{\\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}}{\\sigma_{0} + \\sigma_{r}\\frac{\\gamma^{2}}{(E - E_{0})^{2} + \\gamma^{2}}} = \\frac{\\sigma_{r}\\gamma^{2}}{\\sigma_{0}((E-E_{0})^{2} + \\gamma^{2}) + \\sigma_{r}\\gamma^{2}}\n$$\n因此，积分变为：\n$$\nI_{sh, WR} = \\int_{-\\infty}^{\\infty} \\frac{\\sigma_{0}\\sigma_{r}\\gamma^{2}}{\\sigma_{0}(E-E_{0})^{2} + \\sigma_{0}\\gamma^{2} + \\sigma_{r}\\gamma^{2}} dE\n$$\n让我们从被积函数的分母中提出因子 $\\sigma_0$，并令 $x = E - E_0$：\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\int_{-\\infty}^{\\infty} \\frac{dx}{x^{2} + \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})}\n$$\n这又是一个反正切积分形式，其中分母中的常数项对应于 $a^{2} = \\gamma^{2}(1 + \\frac{\\sigma_r}{\\sigma_0})$，所以 $a = \\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}$。\n$$\nI_{sh, WR} = \\sigma_{r}\\gamma^{2} \\left[ \\frac{1}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} \\arctan\\left(\\frac{x}{\\gamma \\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\\right) \\right]_{-\\infty}^{\\infty}\n$$\n$$\nI_{sh, WR} = \\frac{\\sigma_{r}\\gamma}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}} (\\pi) = \\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\n那么自屏因子为：\n$$\nf_{\\mathrm{WR}} = \\frac{I_{sh, WR}}{I_{unsh}} = \\frac{\\frac{\\pi \\gamma \\sigma_r}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}}{\\pi \\gamma \\sigma_r} = \\frac{1}{\\sqrt{1 + \\frac{\\sigma_r}{\\sigma_0}}}\n$$\n使用给定值 $\\sigma_{r} = 2500\\,\\mathrm{b}$ 和 $\\sigma_{0} = 30\\,\\mathrm{b}$：\n$$\nf_{\\mathrm{WR}} = \\frac{1}{\\sqrt{1 + \\frac{2500}{30}}} = \\frac{1}{\\sqrt{1 + \\frac{250}{3}}} = \\frac{1}{\\sqrt{\\frac{253}{3}}} = \\sqrt{\\frac{3}{253}} \\approx 0.108893\n$$\n四舍五入到四位有效数字，得到 $f_{\\mathrm{WR}} = 0.1089$。\n\n**3. 中间共振 (IR) 因子, $f_{\\mathrm{IR}}$**\n\n中间共振模型使用一个插值参数 $p$ 来连接窄共振和宽共振的极限情况，其通量由 $\\phi(E) = \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)}$ 给出。其计算过程在形式上与宽共振情况相同，只需在 $f_{\\mathrm{WR}}$ 的最终解析表达式中将 $\\sigma_r$ 替换为 $p \\sigma_r$。让我们快速验证一下。有屏蔽的积分为：\n$$\nI_{sh, IR} = \\int_{-\\infty}^{\\infty} \\sigma_{a}(E) \\frac{\\sigma_{0}}{\\sigma_{0} + p\\,\\sigma_{a}(E)} dE\n$$\n推导过程与 $f_{\\mathrm{WR}}$ 的完全相同，但对应于 $\\frac{\\sigma_r}{\\sigma_0}$ 的项变为 $p\\frac{\\sigma_r}{\\sigma_0}$。因此，$f_{\\mathrm{IR}}$ 的闭式表达式为：\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + p\\frac{\\sigma_r}{\\sigma_0}}}\n$$\n使用给定值，包括 $p = 0.60$：\n$$\nf_{\\mathrm{IR}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{2500}{30}\\right)}} = \\frac{1}{\\sqrt{1 + (0.60)\\left(\\frac{250}{3}\\right)}} = \\frac{1}{\\sqrt{1 + 50}} = \\frac{1}{\\sqrt{51}} \\approx 0.140028\n$$\n四舍五入到四位有效数字，得到 $f_{\\mathrm{IR}} = 0.1400$。\n\n**比较与排序**\n\n计算出的自屏因子为：\n- $f_{\\mathrm{NR}} = 1.000$\n- $f_{\\mathrm{IR}} = 0.1400$\n- $f_{\\mathrm{WR}} = 0.1089$\n\n按大小排序，我们有：\n$f_{\\mathrm{WR}}  f_{\\mathrm{IR}}  f_{\\mathrm{NR}}$\n自屏因子 $f$ 量化了共振能量处的通量凹陷；接近 1 的值意味着屏蔽效应可以忽略不计，而远小于 1 的值则表示强烈的屏蔽效应。\n- NR 模型 ($f_{\\mathrm{NR}}=1.000$) 假设没有通量凹陷，因此没有屏蔽效应。这是给定共振的理论最大吸收率。\n- WR 模型 ($f_{\\mathrm{WR}}=0.1089$) 假设了最大的通量凹陷，此时通量与总截面成反比。这导致了最强的屏蔽效应，将有效吸收率降低了约 $1/0.1089 \\approx 9.18$ 倍。\n- IR 模型 ($f_{\\mathrm{IR}}=0.1400$) 提供了中等程度的屏蔽，考虑了中子在散射后有一定概率逃离共振区。其屏蔽效应是显著的，将吸收率降低了约 $1/0.1400 \\approx 7.14$ 倍，但不如纯 WR 极限情况那么严重。\n\n$f_{\\mathrm{NR}}$ 与另外两个因子之间的显著差异，凸显了对于像 ${}^{238}\\text{U}$ 中 $6.67\\,\\mathrm{eV}$ 共振这样的强低能共振，考虑自屏效应的关键重要性。NR 近似在这种情况下物理上是不合适的，而 WR 和 IR 模型为被严重抑制的共振吸收提供了更现实的估计。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000  0.1089  0.1400\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "为了更接近真实的反应堆工况，我们必须考虑温度对共振截面的影响，即多普勒展宽效应。最后一个练习探讨了多普勒展宽与共振自屏效应之间的相互作用，这是一个在反应堆安全分析中至关重要的课题。您将通过编程来量化在自屏计算中忽略多普勒展宽所引入的误差，从而深刻理解窄共振近似在不同温度和共振参数下的适用边界 ()。",
            "id": "4245987",
            "problem": "要求您在慢化剂-吸收剂混合物中单个孤立吸收共振的背景下，评估窄共振近似在共振自屏效应方面的影响。请在能量域中进行计算，单位为电子伏特，并使用以下物理上合理的模型假设和定义。\n\n从以下基础出发，这些基础在慢化理论和单能级共振模型中被广泛使用：\n\n- 单能级共振吸收截面可用一个洛伦兹函数近似，该函数以能量 $E_0$ 为中心，半高全宽为 $\\Gamma$，中心高度为 $\\sigma_{\\text{peak}}$（以靶恩为单位）。记 $\\gamma = \\Gamma/2$，未展宽的共振吸收截面为\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}.\n$$\n\n- 靶核的热运动会引入多普勒展宽。将能量上的多普勒核建模为标准差为 $\\sigma_{\\text{D}}$ 的高斯函数，得到的多普勒展宽共振是洛伦兹函数与高斯函数的卷积。最终的线型是 Voigt 函数。令 $x = E - E_0$。面积归一化的 Voigt 函数为\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}},\n$$\n其中 $w(z)$ 是 Fadeeva 函数，$\\Re[\\cdot]$ 表示实部。为保持共振面积不变，将展宽后的吸收截面定义为\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma),\n\\quad\\text{with}\\quad\nA_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}.\n$$\n根据定义，$\\int_{-\\infty}^{\\infty} \\sigma_{\\text{V}}(E)\\, dE = \\int_{-\\infty}^{\\infty} \\sigma_{\\text{L}}(E)\\, dE$，并且在极限情况 $\\sigma_{\\text{D}} \\to 0$ 下，有 $\\sigma_{\\text{V}}(E) \\to \\sigma_{\\text{L}}(E)$。\n\n- 在一个简化的慢化机制中，在包含共振峰的窄能量窗内，本底截面 $\\sigma_{\\text{b}}$（靶恩）为常数，此时局部中子通量与总截面成反比。在共振窗内将总截面近似为 $\\sigma_{\\text{b}} + \\sigma(E)$，则能量区间 $[E_{\\text{low}}, E_{\\text{high}}]$ 上的自屏的、通量加权的有效共振吸收截面定义为\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E)\\, \\phi(E)\\, dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E)\\, dE},\n\\quad\\text{with}\\quad\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}.\n$$\n任何比例常数在比值中都会被消去。这为共振能量范围内的自屏效应提供了一个基于第一性原理、有坚实物理基础的模型。\n\n为本问题之目的，将窄共振近似 (NRA) 定义为忽略多普勒展宽的近似，即使用 $\\sigma(E) = \\sigma_{\\text{L}}(E)$ 来计算 $\\sigma_{\\text{eff}}$。参考的“数值展宽自屏”结果使用 $\\sigma(E) = \\sigma_{\\text{V}}(E)$ 和给定的多普勒宽度 $\\sigma_{\\text{D}}$。\n\n对于下面的每个测试用例，计算窄共振近似相对于展宽后参考值的相对误差，其定义为无量纲量\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}.\n$$\n\n所有能量必须以电子伏特 ($\\mathrm{eV}$) 为单位处理。所有截面必须以靶恩为单位处理。温度以开尔文 ($\\mathrm{K}$) 给出，仅为提供背景信息；多普勒宽度 $\\sigma_{\\text{D}}$ 对每个用例都直接以 $\\mathrm{eV}$ 为单位提供，且必须按给定值使用。本问题不涉及角度。您的程序必须对能量上的所需积分进行数值计算。\n\n测试套件（每个元组为 $(E_0, \\Gamma, \\sigma_{\\text{peak}}, \\sigma_{\\text{b}}, \\sigma_{\\text{D}}, E_{\\text{low}}, E_{\\text{high}}, T)$，单位如前所述）：\n- 用例1（中等自屏，分离共振）：$(6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900)$。\n- 用例2（大本底截面，自屏减弱）：$(6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900)$。\n- 用例3（无多普勒展宽，检验极限行为）：$(20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300)$。\n- 用例4（极窄热共振，强自屏）：$(0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600)$。\n\n您的程序应生成单行输出，其中包含这四个用例的相对误差，形式为一个用方括号括起来的逗号分隔列表，每个浮点数四舍五入到六位小数（例如，$[0.123456,-0.000001,0.000000,0.987654]$）。最终答案是如上文 $\\varepsilon$ 定义的无单位小数。",
            "solution": "该问题已经过验证，是计算核反应堆物理领域一个良构的、有科学依据的练习。它要求对多普勒展宽对共振自屏效应的影响进行数值评估。\n\n### 1. 理论框架\n\n问题的核心在于比较有效共振吸收截面 $\\sigma_{\\text{eff}}$ 的两种模型。该量代表在指定能量范围内的通量加权平均截面，它考虑了自屏现象。\n\n**a. 共振截面线型**\n\n- **洛伦兹（自然）线型：** 单个孤立共振的固有能量依赖吸收截面由单能级 Breit-Wigner 公式描述，其形状为洛伦兹型。它由以下公式给出：\n$$\n\\sigma_{\\text{L}}(E) = \\sigma_{\\text{peak}} \\frac{\\gamma^2}{(E - E_0)^2 + \\gamma^2}\n$$\n其中 $E_0$ 是共振能量，$\\sigma_{\\text{peak}}$ 是截面峰值，$\\gamma = \\Gamma/2$ 是半高半宽。\n\n- **Voigt（多普勒展宽）线型：** 在有限温度的物理介质中，靶核处于热运动状态。这种运动在原子核看来，会引起入射中子表观能量的多普勒频移。对核速度的麦克斯韦分布进行平均，相当于将洛伦兹线型与一个高斯函数进行卷积。得到的形状是 Voigt 线型。问题提供了保持面积的公式：\n$$\n\\sigma_{\\text{V}}(E) = A_{\\text{L}}\\, V(E - E_0; \\sigma_{\\text{D}}, \\gamma)\n$$\n这里，$A_{\\text{L}} = \\pi \\gamma \\sigma_{\\text{peak}}$ 是洛伦兹曲线下的面积，在展宽过程中该面积是守恒的。项 $\\sigma_{\\text{D}}$ 是高斯多普勒核的标准差，$V(x; \\sigma_{\\text{D}}, \\gamma)$ 是面积归一化的 Voigt 函数，使用 Fadeeva 函数 $w(z)$ 定义如下：\n$$\nV(x; \\sigma, \\gamma) = \\frac{\\Re\\!\\left[w\\!\\left(\\frac{x + i \\gamma}{\\sigma \\sqrt{2}}\\right)\\right]}{\\sigma \\sqrt{2\\pi}}\n$$\n在多普勒宽度趋于零（$\\sigma_{\\text{D}} \\to 0$）的极限下，Voigt 线型 $\\sigma_{\\text{V}}(E)$ 收敛于洛伦兹线型 $\\sigma_{\\text{L}}(E)$。\n\n**b. 自屏效应与有效截面**\n\n共振自屏是通量凹陷的结果。在吸收截面 $\\sigma(E)$ 很大的能量处，中子被优先吸收，导致中子通量 $\\phi(E)$ 出现局部下降。在均匀混合物中，描述此效应的一个标准模型是：\n$$\n\\phi(E) \\propto \\frac{1}{\\sigma_{\\text{total}}(E)} \\approx \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)}\n$$\n其中 $\\sigma_{\\text{b}}$ 是每个吸收剂原子的恒定本底截面。\n\n有效截面 $\\sigma_{\\text{eff}}$ 是由这个凹陷的通量加权的 $\\sigma(E)$ 的平均值，以确保总反应率得以保持。它通过两个积分的比值来计算：\n$$\n\\sigma_{\\text{eff}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\sigma(E) \\phi(E) dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\phi(E) dE} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma(E)}{\\sigma_{\\text{b}} + \\sigma(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma(E)} dE}\n$$\n这些积分通常没有闭式解析解，必须进行数值计算。\n\n### 2. 计算步骤\n\n为求得相对误差 $\\varepsilon$，我们必须使用近似截面模型和参考截面模型来计算 $\\sigma_{\\text{eff}}$。\n\n**a. 展宽后的有效截面 ($\\sigma_{\\text{eff}}^{\\text{broadened}}$)**\n这是参考计算，它使用物理上准确的多普勒展宽截面 $\\sigma(E) = \\sigma_{\\text{V}}(E)$。该计算需要数值求解：\n$$\n\\sigma_{\\text{eff}}^{\\text{broadened}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{V}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{V}}(E)} dE}\n$$\n当 $\\sigma_{\\text{D}} = 0$ 时是一个特殊情况，此时我们设 $\\sigma_{\\text{V}}(E) = \\sigma_{\\text{L}}(E)$。\n\n**b. 窄共振近似 ($\\sigma_{\\text{eff}}^{\\text{NRA}}$)**\n此近似（如问题中所定义）忽略了多普勒展宽，因此我们使用自然线型 $\\sigma(E) = \\sigma_{\\text{L}}(E)$。计算如下：\n$$\n\\sigma_{\\text{eff}}^{\\text{NRA}} = \\frac{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{\\sigma_{\\text{L}}(E)}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}{\\int_{E_{\\text{low}}}^{E_{\\text{high}}} \\frac{1}{\\sigma_{\\text{b}} + \\sigma_{\\text{L}}(E)} dE}\n$$\n\n**c. 相对误差 ($\\varepsilon$)**\n最后一步是使用所提供的定义来计算相对误差：\n$$\n\\varepsilon = \\frac{\\sigma_{\\text{eff}}^{\\text{NRA}} - \\sigma_{\\text{eff}}^{\\text{broadened}}}{\\sigma_{\\text{eff}}^{\\text{broadened}}}\n$$\n多普勒展宽会降低共振峰的峰值并加宽其基底。在自屏情况（低 $\\sigma_{\\text{b}}$）下，峰值处的吸收已经饱和。展宽使得共振峰更宽的翼部暴露在更高、凹陷程度较小的通量中，这通常会增加总体的有效吸收。因此，我们预期 $\\sigma_{\\text{eff}}^{\\text{broadened}} > \\sigma_{\\text{eff}}^{\\text{NRA}}$，这将导致一个负的误差 $\\varepsilon$。\n\n### 3. 实现细节\n\n该解决方案将用 Python 实现。\n- 数值积分将使用 `scipy.integrate` 中的 `quad` 函数执行，该函数提供稳健且精确的求积。\n- Voigt 线型所需的 Fadeeva 函数 $w(z)$ 将使用 `scipy.special` 中的 `wofz` 进行计算。\n- 将设计一个通用函数来计算 $\\sigma_{\\text{eff}}$，该函数接受适当的截面函数（$\\sigma_{\\text{L}}$ 或 $\\sigma_{\\text{V}}$）作为参数。\n- 主程序将遍历每个测试用例，执行 $\\sigma_{\\text{eff}}$ 的两次计算，计算相对误差，并存储结果。\n- 将明确处理 $\\sigma_{\\text{D}} = 0$ 的情况，以确保 $\\varepsilon = 0$ 并避免诸如除以零之类的数值问题。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import wofz\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the resonance self-shielding problem by calculating the relative\n    error of the Narrow Resonance Approximation (NRA) with respect to a\n    Doppler-broadened reference calculation.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Format: (E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, T)\n    test_cases = [\n        (6.67, 0.025, 5000.0, 2.0, 0.15, 6.0, 7.5, 900),\n        (6.67, 0.025, 5000.0, 100.0, 0.15, 6.0, 7.5, 900),\n        (20.0, 0.2, 800.0, 5.0, 0.0, 18.0, 22.0, 300),\n        (0.3, 0.001, 12000.0, 0.5, 0.05, 0.1, 0.5, 600),\n    ]\n\n    def sigma_lorentzian(E, E0, gamma, sigma_peak):\n        \"\"\"Calculates the Lorentzian (unbroadened) cross section.\"\"\"\n        return sigma_peak * (gamma**2) / ((E - E0)**2 + gamma**2)\n\n    def sigma_voigt(E, E0, gamma, sigma_peak, sigma_D):\n        \"\"\"Calculates the Voigt (Doppler-broadened) cross section.\"\"\"\n        # Calculate the resonance area to preserve it.\n        area_L = np.pi * gamma * sigma_peak\n        \n        # Argument for the Fadeeva function.\n        z = (E - E0 + 1j * gamma) / (sigma_D * np.sqrt(2.0))\n        \n        # Area-normalized Voigt function V(E-E0; sigma_D, gamma).\n        # V = Re[w(z)] / (sigma_D * sqrt(2*pi))\n        voigt_func_val = np.real(wofz(z)) / (sigma_D * np.sqrt(2.0 * np.pi))\n        \n        return area_L * voigt_func_val\n\n    def calculate_effective_xs(xs_func, E_low, E_high, sigma_b, *xs_args):\n        \"\"\"\n        Calculates the self-shielded effective cross section for a given\n        cross section function (xs_func) over an energy interval.\n        \"\"\"\n        # Define the integrand for the numerator of the sigma_eff expression.\n        def numerator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return xs_val / (sigma_b + xs_val)\n\n        # Define the integrand for the denominator of the sigma_eff expression.\n        def denominator_integrand(E):\n            xs_val = xs_func(E, *xs_args)\n            return 1.0 / (sigma_b + xs_val)\n\n        # Use high-precision numerical integration.\n        num_integral, _ = quad(numerator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n        den_integral, _ = quad(denominator_integrand, E_low, E_high, epsabs=1.49e-12, epsrel=1.49e-12)\n\n        # Avoid division by zero, although physically unlikely for this problem.\n        if abs(den_integral)  1e-15:\n            return 0.0\n        \n        return num_integral / den_integral\n\n    results = []\n    for case in test_cases:\n        E0, Gamma, sigma_peak, sigma_b, sigma_D, E_low, E_high, _ = case\n        gamma = Gamma / 2.0\n\n        # --- 1. Calculate the NRA effective cross section ---\n        xs_args_lor = (E0, gamma, sigma_peak)\n        sigma_eff_nra = calculate_effective_xs(\n            sigma_lorentzian, E_low, E_high, sigma_b, *xs_args_lor\n        )\n\n        # --- 2. Calculate the Broadened effective cross section ---\n        # Handle the limiting case of zero Doppler broadening.\n        # In this limit, the Voigt profile becomes the Lorentzian profile.\n        if sigma_D  1e-9:\n            sigma_eff_broadened = sigma_eff_nra\n        else:\n            xs_args_voigt = (E0, gamma, sigma_peak, sigma_D)\n            sigma_eff_broadened = calculate_effective_xs(\n                sigma_voigt, E_low, E_high, sigma_b, *xs_args_voigt\n            )\n\n        # --- 3. Calculate the relative error ---\n        if abs(sigma_eff_broadened)  1e-12:\n            # If the broadened result is effectively zero, the NRA result\n            # should also be zero, so the error is zero.\n            epsilon = 0.0\n        else:\n            epsilon = (sigma_eff_nra - sigma_eff_broadened) / sigma_eff_broadened\n        \n        results.append(epsilon)\n\n    # Format the final output string as specified.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}