{
    "hands_on_practices": [
        {
            "introduction": "The fundamental task in applying Doppler broadening is the numerical evaluation of the convolution integral. This exercise  provides a hands-on opportunity to implement this core process, starting from tabulated, unbroadened cross section data. You will build a routine that applies a temperature-dependent Gaussian kernel, paying close attention to the physical and numerical subtleties of normalizing the kernel over a physically meaningful domain and ensuring the positivity of the result through robust quadrature.",
            "id": "4222806",
            "problem": "You are given a tabulated non-broadened microscopic absorption cross section $\\sigma_0(E')$ for a single nuclide as a function of incident neutron energy $E'$ in electron-volts (eV). The thermally broadened (Doppler-broadened) cross section $\\sigma_D(E,T)$ at neutron energy $E$ and material temperature $T$ can be modeled by convolving $\\sigma_0(E')$ with the distribution of energy shifts induced by target-nucleus velocities arising from the Maxwell–Boltzmann distribution. Starting from the Maxwell–Boltzmann distribution of the target velocity component along the neutron flight direction and the nonrelativistic Doppler shift for small target speeds relative to the neutron speed, derive a computationally usable convolution integral for $\\sigma_D(E,T)$ that respects the physical domain $E' \\ge 0$, preserves normalization of the broadening kernel on $[0,\\infty)$, and guarantees positivity.\n\nImplement a program that:\n- Accepts no input and uses the following tabulated $\\sigma_0(E')$ data embedded in the code. The units of energy are eV and the units of cross section are barn ($1 \\text{ barn} = 10^{-24} \\text{ cm}^2$).\n- Uses the nonrelativistic neutron speed $v = \\sqrt{2E/m_n}$, the Maxwell–Boltzmann one-dimensional velocity variance $\\sigma_u^2 = k_B T / m_t$, and the small-shift linearization $\\delta E \\approx 2E u/v$ to obtain a Gaussian energy-shift kernel with variance $\\sigma_E^2 = 2 E k_B T / A$, where $A = m_t/m_n$ is the target-to-neutron mass ratio, $m_n$ is the neutron mass, and $m_t$ is the target nucleus mass. Use Boltzmann's constant $k_B = 8.617333262\\times 10^{-5}$ eV/K.\n- Enforces the physical domain $E' \\ge 0$ by normalizing the Gaussian kernel over $[0,\\infty)$ so that the total weight is $1$ on that domain.\n- Computes $\\sigma_D(E,T)$ for each test case using numerically stable quadrature that preserves kernel normalization and positivity of the result.\n\nUse the following tabulated $\\sigma_0(E')$ values for $E' \\in \\{0.01, 0.1, 1.0, 5.0, 6.0, 6.5, 6.67, 6.8, 7.0, 10.0, 20.0\\}$ eV with corresponding $\\sigma_0(E')$ in barn:\n- $E' = 0.01$, $\\sigma_0 = 10.0$\n- $E' = 0.1$, $\\sigma_0 = 9.0$\n- $E' = 1.0$, $\\sigma_0 = 8.0$\n- $E' = 5.0$, $\\sigma_0 = 7.5$\n- $E' = 6.0$, $\\sigma_0 = 50.0$\n- $E' = 6.5$, $\\sigma_0 = 300.0$\n- $E' = 6.67$, $\\sigma_0 = 1200.0$\n- $E' = 6.8$, $\\sigma_0 = 400.0$\n- $E' = 7.0$, $\\sigma_0 = 80.0$\n- $E' = 10.0$, $\\sigma_0 = 7.0$\n- $E' = 20.0$, $\\sigma_0 = 6.5$\n\nRequirements for numerical procedure:\n- For $T = 0$ K, return $\\sigma_D(E,0) = \\sigma_0(E)$ obtained by interpolation on the tabulated values.\n- For $T > 0$, use a Gaussian kernel with standard deviation $\\sigma_E = \\sqrt{2 E k_B T / A}$ and normalize it on $[0,\\infty)$ using the analytic normalization constant for a truncated Gaussian. Ensure integration bounds are chosen to capture the effective support of the kernel without losing mass, and use absolute and relative tolerances tight enough to avoid negative artifacts.\n- Use monotone-preserving or strictly positive interpolation for $\\sigma_0(E')$ (linear interpolation between positive tabulated values is acceptable) and ensure extrapolation outside the tabulated range does not introduce negativity.\n\nTest suite:\nCompute $\\sigma_D(E,T)$ in barn for the following cases, each expressed in the units specified, and round each result to five decimal places:\n1. $E = 6.67$ eV, $T = 900$ K, $A = 238$.\n2. $E = 6.67$ eV, $T = 0$ K, $A = 238$.\n3. $E = 6.67$ eV, $T = 1800$ K, $A = 238$.\n4. $E = 0.01$ eV, $T = 900$ K, $A = 238$.\n5. $E = 20.0$ eV, $T = 900$ K, $A = 238$.\n6. $E = 6.67$ eV, $T = 900$ K, $A = 56$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example $[x_1,x_2,\\dots,x_6]$. Each $x_i$ must be the float result in barn rounded to five decimal places. No additional text may be printed.",
            "solution": "The user-provided problem statement has been analyzed and is found to be valid. It is scientifically grounded in the principles of nuclear reactor physics, well-posed with a clear objective and sufficient data, and free from any of the invalidity criteria outlined in the problem-solving protocol. We may therefore proceed with a full solution.\n\n### Principle-Based Derivation and Algorithmic Design\n\nThe problem requires the calculation of Doppler-broadened microscopic cross sections, $\\sigma_D(E,T)$, from a tabulated non-broadened cross section, $\\sigma_0(E')$. This broadening phenomenon arises from the thermal motion of target nuclei in a material at temperature $T$. An incident neutron with laboratory-frame energy $E$ will see an effective energy $E'$ that is shifted due to the relative motion between the neutron and the target nucleus. The broadened cross section is the average of the non-broadened cross section over the distribution of these effective energies.\n\n**1. Derivation of the Energy Broadening Kernel**\n\nThe velocity of target nuclei in a material at thermal equilibrium is described by the Maxwell-Boltzmann distribution. For the one-dimensional velocity component, $u$, along the direction of the incident neutron, the probability distribution is a Gaussian function:\n$$\nP(u) = \\sqrt{\\frac{m_t}{2\\pi k_B T}} \\exp\\left(-\\frac{m_t u^2}{2 k_B T}\\right)\n$$\nwhere $m_t$ is the mass of the target nucleus, $T$ is the absolute temperature, and $k_B$ is the Boltzmann constant. This is a normal distribution for $u$ with mean $0$ and variance $\\sigma_u^2 = k_B T / m_t$.\n\nThe problem provides a linearization for the non-relativistic Doppler energy shift, $\\delta E = E' - E$, for small target speeds ($u \\ll v$, where $v$ is the neutron speed):\n$$\n\\delta E \\approx 2E \\frac{u}{v}\n$$\nThe neutron's speed $v$ is related to its kinetic energy $E$ by $v = \\sqrt{2E/m_n}$, where $m_n$ is the neutron mass.\n\nSince the energy shift $\\delta E$ is a linear function of the Gaussian-distributed random variable $u$, $\\delta E$ itself follows a Gaussian distribution with a mean of $0$. Its variance, $\\sigma_E^2$, is given by:\n$$\n\\sigma_E^2 = \\text{Var}(\\delta E) = \\left(\\frac{2E}{v}\\right)^2 \\text{Var}(u) = \\left(\\frac{2E}{\\sqrt{2E/m_n}}\\right)^2 \\left(\\frac{k_B T}{m_t}\\right) = (2Em_n) \\left(\\frac{k_B T}{m_t}\\right) = \\frac{2E k_B T}{m_t/m_n}\n$$\nDefining the target-to-neutron mass ratio as $A = m_t/m_n$, the variance becomes:\n$$\n\\sigma_E^2 = \\frac{2 E k_B T}{A}\n$$\nThis confirms the expression given in the problem statement. The effective energy $E' = E + \\delta E$ is thus distributed according to a Gaussian centered at $E$ with variance $\\sigma_E^2$. The unnormalized probability distribution, or kernel, for $E'$ is:\n$$\nG(E') = \\exp\\left(-\\frac{(E' - E)^2}{2\\sigma_E^2}\\right)\n$$\n\n**2. Convolution Integral and Kernel Normalization**\n\nThe Doppler-broadened cross section $\\sigma_D(E,T)$ is the expectation value of $\\sigma_0(E')$ over the distribution of $E'$:\n$$\n\\sigma_D(E, T) = \\int \\sigma_0(E') K(E' \\leftarrow E, T) \\, dE'\n$$\nwhere $K(E' \\leftarrow E, T)$ is the normalized energy-broadening kernel.\n\nA critical physical constraint is that the effective energy $E'$ must be non-negative, i.e., $E' \\ge 0$. Therefore, the kernel must be normalized on the domain $[0, \\infty)$. The normalization constant, $C$, is the integral of the unnormalized kernel over this domain:\n$$\nC = \\int_0^{\\infty} G(E') \\, dE' = \\int_0^{\\infty} \\exp\\left(-\\frac{(E' - E)^2}{2\\sigma_E^2}\\right) \\, dE'\n$$\nTo evaluate this, we use a change of variables, $z = (E' - E) / (\\sqrt{2}\\sigma_E)$, which gives $dE' = \\sqrt{2}\\sigma_E dz$. The integration limits change from $[0, \\infty)$ for $E'$ to $[-E/(\\sqrt{2}\\sigma_E), \\infty)$ for $z$.\n$$\nC = \\sqrt{2}\\sigma_E \\int_{-E/(\\sqrt{2}\\sigma_E)}^{\\infty} e^{-z^2} \\, dz\n$$\nUsing the definition of the complementary error function, $\\text{erfc}(x) = \\frac{2}{\\sqrt{\\pi}}\\int_x^{\\infty} e^{-t^2} dt$, and the identity $\\text{erfc}(x) = 1 - \\text{erf}(x)$, the integral becomes:\n$$\n\\int_a^\\infty e^{-z^2} dz = \\frac{\\sqrt{\\pi}}{2} \\text{erfc}(a)\n$$\nWith $a = -E/(\\sqrt{2}\\sigma_E)$, and using $\\text{erfc}(-x) = 1 - \\text{erf}(-x) = 1 + \\text{erf}(x)$, we find:\n$$\nC = \\sqrt{2}\\sigma_E \\frac{\\sqrt{\\pi}}{2} \\text{erfc}\\left(-\\frac{E}{\\sqrt{2}\\sigma_E}\\right) = \\sqrt{\\frac{\\pi \\sigma_E^2}{2}} \\left[1 + \\text{erf}\\left(\\frac{E}{\\sqrt{2}\\sigma_E}\\right)\\right]\n$$\nThe normalized kernel for $E' \\ge 0$ is $K_N(E') = G(E')/C$. The final convolution integral for $\\sigma_D(E,T)$ is:\n$$\n\\sigma_D(E, T) = \\frac{1}{C} \\int_0^{\\infty} \\sigma_0(E') \\exp\\left(-\\frac{(E' - E)^2}{2\\sigma_E^2}\\right) \\, dE'\n$$\n\n**3. Special Case: T = 0 K**\n\nWhen $T = 0$, the variance $\\sigma_E^2 = 0$. The Gaussian kernel approaches a Dirac delta function, $\\delta(E' - E)$. The convolution integral simplifies to:\n$$\n\\sigma_D(E, 0) = \\int_0^{\\infty} \\sigma_0(E') \\delta(E' - E) \\, dE' = \\sigma_0(E)\n$$\nThus, for zero temperature, the broadened cross section is identical to the non-broadened cross section evaluated at energy $E$.\n\n**4. Numerical Implementation Strategy**\n\n- **Interpolation of $\\sigma_0(E')$**: Since $\\sigma_0(E')$ is provided as a table of discrete values, a continuous representation is needed for the integrand. Linear interpolation between the given points provides a suitable function. For energies outside the tabulated range, constant extrapolation is used, holding the value at the nearest boundary. This ensures the function remains positive definite.\n- **Numerical Quadrature**: The integral is computed numerically. The integrand is significant only where the Gaussian kernel is non-negligible, i.e., within a few standard deviations $\\sigma_E$ of the mean $E$. The integration range can be safely truncated to $[E_{min}, E_{max}]$, where $E_{min} = \\max(0, E - n\\sigma_E)$ and $E_{max} = E + n\\sigma_E$ for a sufficiently large $n$ (e.g., $n=8$) to capture the full weight of the kernel. High-quality adaptive quadrature routines, such as `scipy.integrate.quad`, are employed for accuracy and stability.\n- **Calculation Flow**:\n    1. For a given test case $(E, T, A)$, check if $T = 0$. If so, the result is $\\sigma_0(E)$ obtained via interpolation.\n    2. If $T > 0$, calculate $\\sigma_E = \\sqrt{2 E k_B T / A}$.\n    3. Define the integrand function, which multiplies the interpolated $\\sigma_0(E')$ by the Gaussian factor.\n    4. Compute the definite integral of this function over the truncated range $[E_{min}, E_{max}]$.\n    5. Compute the analytic normalization constant $C$ using the error function, `scipy.special.erf`.\n    6. The final result is the ratio of the integral to the normalization constant. All computations are performed using floating-point arithmetic with sufficient precision.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Computes Doppler-broadened cross sections for a series of test cases.\n    \"\"\"\n    # Define physical constants and tabulated data\n    # Boltzmann's constant in eV/K\n    K_B = 8.617333262e-5\n\n    # Tabulated non-broadened cross section data\n    # Energies E' in eV\n    E_PRIME_DATA = np.array([0.01, 0.1, 1.0, 5.0, 6.0, 6.5, 6.67, 6.8, 7.0, 10.0, 20.0])\n    # Cross sections sigma_0(E') in barn\n    SIGMA_0_DATA = np.array([10.0, 9.0, 8.0, 7.5, 50.0, 300.0, 1200.0, 400.0, 80.0, 7.0, 6.5])\n\n    def get_sigma_0(E_prime):\n        \"\"\"\n        Interpolates the tabulated non-broadened cross section sigma_0(E').\n        Uses linear interpolation within the data range and constant extrapolation\n        outside the range to ensure positivity.\n        \n        Args:\n            E_prime (float or np.ndarray): The energy or energies at which to evaluate sigma_0.\n            \n        Returns:\n            float or np.ndarray: The interpolated cross section value(s).\n        \"\"\"\n        return np.interp(\n            E_prime, \n            E_PRIME_DATA, \n            SIGMA_0_DATA, \n            left=SIGMA_0_DATA[0], \n            right=SIGMA_0_DATA[-1]\n        )\n\n    def calculate_doppler_broadened_xs(E, T, A):\n        \"\"\"\n        Calculates the Doppler-broadened cross section sigma_D(E, T).\n\n        Args:\n            E (float): Incident neutron energy in eV.\n            T (float): Material temperature in Kelvin.\n            A (float): Target-to-neutron mass ratio.\n\n        Returns:\n            float: The Doppler-broadened cross section in barn.\n        \"\"\"\n        # Case T=0 K: Broadened XS is the unbroadened XS evaluated at E\n        if T == 0.0:\n            return get_sigma_0(E)\n\n        # Variance of the Gaussian energy broadening kernel\n        sigma_E_sq = (2 * E * K_B * T) / A\n        \n        # Avoid division by zero if E or T are zero, though T=0 is handled above.\n        if sigma_E_sq <= 0:\n            return get_sigma_0(E)\n            \n        sigma_E = np.sqrt(sigma_E_sq)\n\n        # Integrand for the convolution integral (unnormalized)\n        def integrand(E_prime):\n            return get_sigma_0(E_prime) * np.exp(-(E_prime - E)**2 / (2 * sigma_E_sq))\n\n        # Determine integration range to capture the effective support of the Gaussian kernel\n        # Using 8 standard deviations is a safe choice to ensure negligible truncation error.\n        integration_width = 8.0 * sigma_E\n        lower_bound = max(0.0, E - integration_width)\n        upper_bound = E + integration_width\n\n        # Numerically compute the integral\n        integral_val, _ = quad(integrand, lower_bound, upper_bound, epsabs=1e-12, epsrel=1e-12)\n\n        # Normalization constant for the truncated Gaussian kernel on [0, infinity)\n        arg_erf = E / (np.sqrt(2) * sigma_E)\n        normalization_constant = (np.sqrt(np.pi * sigma_E_sq / 2.0)) * (1.0 + erf(arg_erf))\n        \n        if normalization_constant == 0:\n            # This should not happen for T > 0, but as a safeguard:\n            return get_sigma_0(E)\n\n        return integral_val / normalization_constant\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E in eV, T in K, A)\n        (6.67, 900.0, 238.0),\n        (6.67, 0.0,   238.0),\n        (6.67, 1800.0, 238.0),\n        (0.01, 900.0, 238.0),\n        (20.0, 900.0, 238.0),\n        (6.67, 900.0, 56.0),\n    ]\n\n    results = []\n    for E, T, A in test_cases:\n        result = calculate_doppler_broadened_xs(E, T, A)\n        results.append(result)\n\n    # Format the final output as specified\n    # The f-string format specifier '{r:.5f}' handles rounding to 5 decimal places.\n    output_str = f\"[{','.join(f'{r:.5f}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "In practice, reactor simulation codes must balance accuracy with computational cost, and a key decision is how to obtain temperature-dependent cross sections. This exercise  explores the trade-off between performing a precise \"on-the-fly\" broadening of an analytical resonance profile and using a simple linear interpolation between pre-broadened values from a library. By quantifying the error of the interpolation method, you will develop a practical understanding of its limitations, especially for narrow resonances where the temperature dependence is highly non-linear.",
            "id": "4239879",
            "problem": "A nuclear reactor simulation must compute on-the-fly temperature broadening of neutron cross sections when requested temperatures are not present in tabulated libraries. Consider a single resolved resonance described at zero temperature by the Single-Level Breit-Wigner (SLBW) form. The objective is to compute the Doppler-broadened cross section at a requested temperature and compare it to a naive linear interpolation between two tabulated temperatures. Formulate and implement a program that, for each case in a given test suite, computes the broadened cross section at the resonance energy using the free-gas Doppler kernel and quantifies the deviation from linear interpolation.\n\nStarting point and definitions:\n- The SLBW zero-temperature resonance cross section is modeled as a Lorentzian function\n$$\n\\sigma_0(E) = \\sigma_\\text{peak} \\frac{(\\Gamma/2)^2}{(E - E_r)^2 + (\\Gamma/2)^2},\n$$\nwhere $E$ is energy in electronvolts (eV), $E_r$ is the resonance energy in eV, $\\Gamma$ is the total width in eV, and $\\sigma_\\text{peak}$ is the peak cross section in barns at $E = E_r$.\n- The thermal motion of target nuclei is assumed to obey the Maxwell-Boltzmann distribution, leading to Doppler broadening represented by a Gaussian convolution in the square-root-of-energy (also called $u$-space). Define $u = \\sqrt{E}$, and the free-gas Doppler kernel\n$$\nG(u,u';T,A) = \\frac{1}{\\sqrt{\\pi}\\,\\mu(T,A)} \\exp\\!\\left(-\\frac{(u'-u)^2}{\\mu(T,A)^2}\\right),\n$$\nwhere the kernel width parameter in $u$-space is\n$$\n\\mu(T,A) = \\sqrt{\\frac{\\theta(T)}{A}},\n\\quad\n\\theta(T) = k_B T \\text{ in eV},\n$$\nwith $k_B$ the Boltzmann constant and $A$ the target-to-neutron mass ratio (dimensionless). The broadened cross section at temperature $T$ is then\n$$\n\\sigma(E,T) = \\int_0^\\infty \\sigma_0(u'^2)\\, G(u,u';T,A)\\, \\mathrm{d}u'.\n$$\n- The temperatures considered are $T_1 = 800$ Kelvin (K), $T = 873$ K, and $T_2 = 900$ K. Boltzmann’s constant must be used in electronvolts per Kelvin, $k_B = 8.617333262145\\times 10^{-5}$ eV/K.\n- The energy at which the cross section is to be evaluated is $E = E_r$ for each test case.\n\nTasks to implement:\n1. Using the above fundamental base, compute $\\sigma(E_r, T)$ via on-the-fly Doppler broadening (the Gaussian convolution in $u$-space).\n2. Compute $\\sigma(E_r, T_1)$ and $\\sigma(E_r, T_2)$ similarly.\n3. Compute the linearly interpolated value at $T$ between the two tabulated temperatures:\n$$\n\\sigma_\\text{lin}(E_r, T) = \\sigma(E_r, T_1) + \\frac{T - T_1}{T_2 - T_1}\\left[\\sigma(E_r, T_2) - \\sigma(E_r, T_1)\\right].\n$$\n4. Quantify the difference between the on-the-fly broadened value and the linear interpolation at $E = E_r$ using:\n   - The absolute difference in barns,\n   $$\n   \\Delta_\\text{abs} = \\sigma(E_r, T) - \\sigma_\\text{lin}(E_r, T),\n   $$\n   - The fractional difference as a decimal,\n   $$\n   \\Delta_\\text{frac} = \\frac{\\Delta_\\text{abs}}{\\sigma(E_r, T)}.\n   $$\n\nPhysical units and numerical reporting:\n- Energies $E$, $E_r$, and widths $\\Gamma$ are in electronvolts (eV).\n- Temperature $T$ is in Kelvin (K).\n- Cross sections and differences $\\Delta_\\text{abs}$ are in barns.\n- Fractional differences $\\Delta_\\text{frac}$ must be reported as decimals (no percentage sign).\n- Report all floating-point outputs rounded to six decimal places.\n\nTest suite:\nFor each parameter set, evaluate at $E = E_r$ with the specified $A$, $\\Gamma$, and $\\sigma_\\text{peak}$:\n- Case 1 (heavy nuclide, narrow resonance, high peak): $A = 238$, $E_r = 6.670$ eV, $\\Gamma = 0.030$ eV, $\\sigma_\\text{peak} = 3000.0$ barns.\n- Case 2 (medium mass, moderate width): $A = 56$, $E_r = 2.000$ eV, $\\Gamma = 0.300$ eV, $\\sigma_\\text{peak} = 100.0$ barns.\n- Case 3 (light nuclide, broad resonance): $A = 1$, $E_r = 1.000$ eV, $\\Gamma = 0.500$ eV, $\\sigma_\\text{peak} = 20.0$ barns.\n- Case 4 (heavy nuclide, extremely narrow resonance, very high peak): $A = 238$, $E_r = 0.500$ eV, $\\Gamma = 0.001$ eV, $\\sigma_\\text{peak} = 10000.0$ barns.\n\nAlgorithmic requirements:\n- Implement the Gaussian convolution integral in $u$-space with $u = \\sqrt{E}$ and $\\mu(T,A) = \\sqrt{\\theta(T)/A}$, $\\theta(T) = k_B T$ in eV. Perform the integral over $u' \\in [0,\\infty)$; for numerical stability and efficiency, it is acceptable to truncate the integral to $u' \\in [\\max(0,u-8\\mu), u+8\\mu]$, since the Gaussian tails beyond $\\pm 8\\mu$ are negligible.\n- Use robust numerical integration suitable for smooth Gaussian-weighted Lorentzians.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case contributes a two-element list $[\\Delta_\\text{abs}, \\Delta_\\text{frac}]$ in that order. For example,\n`[[\\Delta_{abs,1},\\Delta_{frac,1}],[\\Delta_{abs,2},\\Delta_{frac,2}],...]`.",
            "solution": "The problem requires the computation of Doppler-broadened neutron cross sections for a single resonance and a comparison against linear temperature interpolation. The process is based on established principles of nuclear reactor physics.\n\nThe foundation of the calculation is the Single-Level Breit-Wigner (SLBW) formula for the cross section of an isolated resonance at absolute zero temperature ($T=0$ K), given by a Lorentzian function:\n$$\n\\sigma_0(E) = \\sigma_\\text{peak} \\frac{(\\Gamma/2)^2}{(E - E_r)^2 + (\\Gamma/2)^2}\n$$\nHere, $E$ is the neutron energy, $E_r$ is the energy at which the resonance is centered, $\\Gamma$ is the total resonance width, and $\\sigma_\\text{peak}$ is the maximum cross section value, occurring at $E = E_r$. All energies are in electronvolts (eV) and the cross section is in barns.\n\nAt finite temperatures, target nuclei are in thermal motion. In the free-gas model, this motion is described by a Maxwell-Boltzmann distribution of velocities. The effect on the observed cross section is a broadening phenomenon, mathematically represented by a convolution of the zero-temperature cross section with a Doppler kernel. This convolution is most conveniently expressed in the square-root-of-energy space, or $u$-space, where $u = \\sqrt{E}$. The broadened cross section $\\sigma(E,T)$ at a temperature $T$ is given by:\n$$\n\\sigma(E,T) = \\int_0^\\infty \\sigma_0(u'^2)\\, G(u,u';T,A)\\, \\mathrm{d}u'\n$$\nThe function $G(u,u';T,A)$ is the free-gas Doppler kernel, which is a Gaussian function in $u$-space:\n$$\nG(u,u';T,A) = \\frac{1}{\\sqrt{\\pi}\\,\\mu(T,A)} \\exp\\!\\left(-\\frac{(u'-u)^2}{\\mu(T,A)^2}\\right)\n$$\nThe width parameter of the Gaussian kernel, $\\mu(T,A)$, encapsulates the physics of thermal motion:\n$$\n\\mu(T,A) = \\sqrt{\\frac{\\theta(T)}{A}}\n$$\nwhere $\\theta(T) = k_B T$ is the thermal energy in eV, $k_B$ is the Boltzmann constant ($8.617333262145\\times 10^{-5}$ eV/K), and $A$ is the ratio of the target nucleus mass to the neutron mass. The variable $u$ in the kernel corresponds to the evaluation energy $E$ (i.e., $u=\\sqrt{E}$), while $u'$ is the integration variable representing the full spectrum of energies over which the convolution is performed.\n\nThe problem requires evaluation at the resonance energy, $E = E_r$. Therefore, we set $u = u_r = \\sqrt{E_r}$. The integral to compute for a given temperature $T$ is:\n$$\n\\sigma(E_r,T) = \\int_0^\\infty \\sigma_0(u'^2)\\, G(u_r,u';T,A)\\, \\mathrm{d}u'\n$$\nSubstituting the expressions for $\\sigma_0$ and $G$, the integrand becomes:\n$$\n\\text{Integrand}(u') = \\left( \\sigma_\\text{peak} \\frac{(\\Gamma/2)^2}{(u'^2 - E_r)^2 + (\\Gamma/2)^2} \\right) \\left( \\frac{1}{\\sqrt{\\pi}\\,\\mu(T,A)} \\exp\\!\\left(-\\frac{(u'-u_r)^2}{\\mu(T,A)^2}\\right) \\right)\n$$\nThis definite integral must be evaluated numerically. A robust method such as adaptive quadrature, provided by `scipy.integrate.quad` in Python, is suitable for this task. The integration is performed over $u'$ from $0$ to $\\infty$. For numerical efficiency, the problem permits truncating the integration range to $[\\max(0, u_r - 8\\mu), u_r + 8\\mu]$, as the Gaussian kernel's contribution is negligible outside this interval.\n\nThe overall algorithm proceeds as follows for each test case:\n1.  For each of the three temperatures, $T_1 = 800$ K, $T = 873$ K, and $T_2 = 900$ K, calculate the corresponding broadened cross section at the resonance peak, $\\sigma(E_r, T_1)$, $\\sigma(E_r, T)$, and $\\sigma(E_r, T_2)$, by numerically solving the convolution integral defined above.\n\n2.  Calculate a linearly interpolated cross section at $T=873$ K using the values computed at the bracketing temperatures $T_1$ and $T_2$:\n$$\n\\sigma_\\text{lin}(E_r, T) = \\sigma(E_r, T_1) + \\frac{T - T_1}{T_2 - T_1}\\left[\\sigma(E_r, T_2) - \\sigma(E_r, T_1)\\right]\n$$\n\n3.  Quantify the error introduced by this linear approximation by calculating the absolute and fractional differences between the accurately broadened value and the interpolated value:\n    -   Absolute difference: $\\Delta_\\text{abs} = \\sigma(E_r, T) - \\sigma_\\text{lin}(E_r, T)$\n    -   Fractional difference: $\\Delta_\\text{frac} = \\frac{\\Delta_\\text{abs}}{\\sigma(E_r, T)}$\n\n4.  The final results, $\\Delta_\\text{abs}$ and $\\Delta_\\text{frac}$, are collected for each test case and reported with a precision of six decimal places. This analysis demonstrates the non-linear dependence of the cross section on temperature and the potential inaccuracies of simple interpolation schemes used in some nuclear simulation contexts.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Solves the Doppler broadening problem for the given test cases.\n    \"\"\"\n    \n    # Define constants and fixed temperatures\n    KB = 8.617333262145e-5  # Boltzmann constant in eV/K\n    T1 = 800.0  # K\n    T = 873.0   # K\n    T2 = 900.0  # K\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (A, Er, Gamma, sigma_peak)\n        (238.0, 6.670, 0.030, 3000.0),\n        (56.0, 2.000, 0.300, 100.0),\n        (1.0, 1.000, 0.500, 20.0),\n        (238.0, 0.500, 0.001, 10000.0),\n    ]\n\n    # List to store the results for all cases\n    all_results = []\n\n    def zero_temp_xs(u_prime_sq, Er, Gamma, sigma_peak):\n        \"\"\"\n        Calculates the zero-temperature SLBW cross section.\n        u_prime_sq is u'^2, which is the energy E.\n        \"\"\"\n        half_gamma_sq = (Gamma / 2.0)**2\n        return sigma_peak * half_gamma_sq / ((u_prime_sq - Er)**2 + half_gamma_sq)\n\n    def calculate_broadened_xs(Er, Gamma, sigma_peak, A, temp):\n        \"\"\"\n        Computes the Doppler-broadened cross section at E=Er for a given temperature.\n        \"\"\"\n        # Thermal energy theta\n        theta = KB * temp\n        \n        # Kernel width parameter mu\n        mu = np.sqrt(theta / A)\n        \n        # u-space evaluation point\n        u_r = np.sqrt(Er)\n        \n        # Define the integrand for the convolution\n        def integrand(u_prime):\n            # Gaussian kernel G(u_r, u_prime; T, A)\n            gaussian_kernel = (1.0 / (np.sqrt(np.pi) * mu)) * np.exp(-((u_prime - u_r)**2) / mu**2)\n            \n            # Zero-temperature cross section sigma_0(u_prime^2)\n            sigma_0_val = zero_temp_xs(u_prime**2, Er, Gamma, sigma_peak)\n            \n            return sigma_0_val * gaussian_kernel\n\n        # Integration limits\n        u_min = max(0.0, u_r - 8.0 * mu)\n        u_max = u_r + 8.0 * mu\n        \n        # Perform numerical integration\n        result, _ = integrate.quad(integrand, u_min, u_max, epsabs=1e-12, epsrel=1e-12)\n        \n        return result\n\n    for case in test_cases:\n        A, Er, Gamma, sigma_peak = case\n        \n        # 1. Compute on-the-fly broadened cross section at T\n        sigma_T = calculate_broadened_xs(Er, Gamma, sigma_peak, A, T)\n        \n        # 2. Compute broadened cross sections at T1 and T2\n        sigma_T1 = calculate_broadened_xs(Er, Gamma, sigma_peak, A, T1)\n        sigma_T2 = calculate_broadened_xs(Er, Gamma, sigma_peak, A, T2)\n        \n        # 3. Compute the linearly interpolated value\n        sigma_lin = sigma_T1 + (T - T1) / (T2 - T1) * (sigma_T2 - sigma_T1)\n        \n        # 4. Quantify the differences\n        delta_abs = sigma_T - sigma_lin\n        delta_frac = delta_abs / sigma_T if sigma_T != 0 else 0.0\n        \n        # Store results rounded to six decimal places\n        all_results.append(f\"[{delta_abs:.6f},{delta_frac:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A deeper look into the physics of Doppler broadening reveals subtle effects that are not immediately obvious from a simplified model. This exercise  guides you through an analytical derivation to uncover one such effect: a systematic shift in the apparent energy of a resonance peak. By carefully considering the energy dependence of the broadening kernel's width—a feature of the correct free-gas model—you will prove that the convolution introduces an asymmetry that shifts the peak to a lower energy, providing a powerful insight into the interplay between the physical model and its mathematical representation.",
            "id": "4239877",
            "problem": "In many reactor physics codes, on-the-fly Doppler broadening is modeled by convolving an intrinsic single-level resonance line shape with a temperature-dependent kernel derived from the Maxwell–Boltzmann velocity distribution of target nuclei. Consider a single isolated resonance centered at energy $E_r$ with intrinsic (zero-temperature) line shape modeled by a Lorentzian with half width at half maximum (HWHM) $\\gamma$,\n$$\nS(E) \\propto \\frac{1}{(E - E_r)^2 + \\gamma^2}.\n$$\nThe Doppler-broadened cross section at temperature $T$ is modeled as the convolution\n$$\n\\sigma_b(E;T) \\;=\\; \\int_{-\\infty}^{\\infty} S(E')\\,K_T(E,E')\\,\\mathrm{d}E',\n$$\nwhere the free-gas kernel is approximated by an energy-centered Gaussian of standard deviation $\\sigma(E)$,\n$$\nK_T(E,E') \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma(E)} \\exp\\!\\left(-\\frac{(E' - E)^2}{2\\,\\sigma(E)^2}\\right),\n$$\nwith energy-dependent variance\n$$\n\\sigma(E)^2 \\;=\\; \\frac{2\\,k_B\\,T}{A}\\,E.\n$$\nHere $k_B$ is the Boltzmann constant and $A$ is the dimensionless mass ratio of the target nucleus to the neutron ($A = M/m_n$). Assume the asymptotic regime where $\\gamma \\ll E_r$ and $\\sigma(E_r) \\ll E_r$, so that $S(E)$ is locally symmetric and slowly varying on the energy scale of $E_r$, and retain only the leading nonvanishing contribution from the energy dependence of $\\sigma(E)$.\n\nCompute, to leading order, the shift $\\delta E_{\\text{peak}} = E_{\\text{peak}} - E_r$ of the apparent peak energy $E_{\\text{peak}}$ of $\\sigma_b(E;T)$ relative to $E_r$ induced by the convolution above, expressed in terms of $k_B$, $T$, and $A$. Additionally, establish the condition under which the Voigt peak (the convolution of a Lorentzian and a Gaussian) is exactly aligned with $E_r$ in this setting. Provide your final answer as a closed-form analytic expression for $\\delta E_{\\text{peak}}$ in terms of $k_B$, $T$, and $A$. You do not need to substitute numerical values; treat $k_B T$ as an energy.",
            "solution": "The problem has been validated and is being solved.\nThe problem statement is scientifically grounded, well-posed, and objective. It describes a standard, albeit advanced, problem in reactor physics concerning the effect of an energy-dependent broadening kernel on resonance line shapes. All necessary information and assumptions are provided. The problem is valid.\n\nThe goal is to find the energy shift $\\delta E_{\\text{peak}} = E_{\\text{peak}} - E_r$ of the peak of the Doppler-broadened cross section $\\sigma_b(E;T)$ relative to the intrinsic resonance energy $E_r$. The peak energy $E_{\\text{peak}}$ is found by solving the equation $\\frac{d\\sigma_b}{dE}\\big|_{E=E_{\\text{peak}}} = 0$.\n\nThe broadened cross section is given by the convolution:\n$$ \\sigma_b(E;T) = \\int_{-\\infty}^{\\infty} S(E') \\, K_T(E, E') \\, \\mathrm{d}E' $$\nwhere $S(E') \\propto \\frac{1}{(E' - E_r)^2 + \\gamma^2}$ is a symmetric Lorentzian function centered at $E_r$, and the kernel $K_T(E, E')$ is a Gaussian in $E'$ centered at $E$ with an energy-dependent variance $\\sigma(E)^2 = \\frac{2k_B T}{A}E$.\n\nTo find the peak, we differentiate $\\sigma_b(E;T)$ with respect to $E$. Since $E$ appears in the kernel $K_T(E, E')$, we must differentiate under the integral sign:\n$$ \\frac{d\\sigma_b}{dE} = \\int_{-\\infty}^{\\infty} S(E') \\frac{\\partial K_T(E, E')}{\\partial E} \\mathrm{d}E' $$\nThe derivative of the kernel $K_T(E, E') = G(E'-E; \\sigma(E))$, where $G$ is a Gaussian, is given by the chain rule:\n$$ \\frac{\\partial K_T(E, E')}{\\partial E} = K_T(E, E') \\left[ \\frac{E' - E}{\\sigma(E)^2} + \\left( \\frac{(E' - E)^2}{\\sigma(E)^2} - 1 \\right) \\frac{d\\ln\\sigma}{dE} \\right] $$\nFrom $\\sigma(E)^2 = \\frac{2k_BT}{A}E$, we have $2\\ln\\sigma(E) = \\ln(\\frac{2k_BT}{A}) + \\ln E$. Differentiating with respect to $E$ gives $2\\frac{d\\ln\\sigma}{dE} = \\frac{1}{E}$, so $\\frac{d\\ln\\sigma}{dE} = \\frac{1}{2E}$.\n\nThe peak shift $\\delta E_{\\text{peak}}$ is assumed to be small, allowing a first-order Taylor expansion of the derivative condition around $E=E_r$:\n$$ \\frac{d\\sigma_b}{dE}\\bigg|_{E_r + \\delta E_{\\text{peak}}} \\approx \\frac{d\\sigma_b}{dE}\\bigg|_{E_r} + \\delta E_{\\text{peak}} \\frac{d^2\\sigma_b}{dE^2}\\bigg|_{E_r} = 0 $$\nSolving for the shift gives:\n$$ \\delta E_{\\text{peak}} \\approx - \\frac{(d\\sigma_b/dE)|_{E=E_r}}{(d^2\\sigma_b/dE^2)|_{E=E_r}} $$\nWe now compute the numerator and denominator.\n\nThe numerator is the first derivative evaluated at $E=E_r$. Let $\\sigma_r = \\sigma(E_r)$.\n$$ \\frac{d\\sigma_b}{dE}\\bigg|_{E=E_r} = \\int S(E') K_T(E_r, E') \\left[ \\frac{E' - E_r}{\\sigma_r^2} + \\left( \\frac{(E' - E_r)^2}{\\sigma_r^2} - 1 \\right) \\frac{1}{2E_r} \\right] \\mathrm{d}E' $$\nLet $x' = E' - E_r$. The functions $S(E_r+x')$ and $K_T(E_r, E_r+x')$ are both even functions of $x'$. The first term in the brackets, $\\frac{x'}{\\sigma_r^2}$, is an odd function. The integral of an odd function times an even function over a symmetric domain is zero. Thus, only the second term contributes:\n$$ \\frac{d\\sigma_b}{dE}\\bigg|_{E=E_r} = \\frac{1}{2E_r} \\int S(E_r+x') K_T(E_r, E_r+x') \\left( \\frac{x'^2}{\\sigma_r^2} - 1 \\right) \\mathrm{d}x' $$\nWe use the identity for the second derivative of a Gaussian: $K_T''(x') = \\frac{1}{\\sigma_r^2}K_T(x')(\\frac{x'^2}{\\sigma_r^2}-1)$. The term in the integral is thus $\\sigma_r^2 K_T''(E_r, E_r+x')$.\n$$ \\frac{d\\sigma_b}{dE}\\bigg|_{E=E_r} = \\frac{\\sigma_r^2}{2E_r} \\int S(E_r+x') \\frac{d^2 K_T(E_r, E_r+x')}{dx'^2} \\mathrm{d}x' $$\nUsing integration by parts twice and noting that the functions and their derivatives vanish at infinity, we can move the derivatives from the kernel to the line shape:\n$$ \\int S(E_r+x') \\frac{d^2K_T}{dx'^2} \\mathrm{d}x' = \\int \\frac{d^2S(E_r+x')}{dx'^2} K_T(E_r, E_r+x') \\mathrm{d}x' $$\nLet's name this integral $I_2$. It is non-zero and represents the curvature of the idealized (constant-width kernel) broadened resonance.\nThe numerator is thus $\\frac{\\sigma_r^2}{2E_r}I_2$.\n\nThe denominator is $\\frac{d^2\\sigma_b}{dE^2}\\big|_{E_r}$. The problem asks for the leading order contribution. The shift itself is a first-order effect caused by the energy dependence of $\\sigma(E)$. The curvature at the peak is a zeroth-order property. We therefore calculate the denominator by assuming $\\sigma(E)$ is constant and equal to $\\sigma_r$.\nFor a constant-width kernel, $\\sigma_b(E)$ is a simple convolution, $\\sigma_b(E) = (S*K_r)(E)$. The second derivative is $\\frac{d^2\\sigma_b}{dE^2} = (S''*K_r)(E)$. At $E=E_r$:\n$$ \\frac{d^2\\sigma_b}{dE^2}\\bigg|_{E_r} = \\int S''(E_r+x') K_r(-x') \\mathrm{d}x' = \\int \\frac{d^2S(E_r+x')}{dx'^2} K_T(E_r, E_r+x') \\mathrm{d}x' = I_2 $$\nThe denominator is simply the integral $I_2$.\n\nNow, we compute the shift:\n$$ \\delta E_{\\text{peak}} \\approx - \\frac{(\\sigma_r^2 / (2E_r)) I_2}{I_2} = - \\frac{\\sigma_r^2}{2E_r} $$\nThe cancellation of the integral $I_2$ makes the result independent of the specific resonance width $\\gamma$.\n\nFinally, we substitute the given expression for $\\sigma(E_r)^2 = \\sigma_r^2$:\n$$ \\sigma_r^2 = \\frac{2k_B T}{A} E_r $$\n$$ \\delta E_{\\text{peak}} = - \\frac{1}{2E_r} \\left( \\frac{2k_B T}{A} E_r \\right) = - \\frac{k_B T}{A} $$\nThis is the required expression for the shift.\n\nFor the second part of the question, the condition for the peak to be aligned with $E_r$ is that the shift $\\delta E_{\\text{peak}}$ must be zero. From our result, $\\delta E_{\\text{peak}} = -k_BT/A$. Since the Boltzmann constant $k_B$ is positive and the mass ratio $A$ is positive, the shift is zero if and only if the temperature $T=0$. Physically, at $T=0$, there is no thermal motion, no Doppler broadening, and thus no associated shift. Mathematically, the shift arises from the energy dependence of the kernel width, represented by the term $\\frac{d\\ln\\sigma}{dE}$. This term is zero only if $\\sigma(E)$ is constant. For the given model, this occurs only at $T=0$.",
            "answer": "$$\\boxed{-\\frac{k_B T}{A}}$$"
        }
    ]
}