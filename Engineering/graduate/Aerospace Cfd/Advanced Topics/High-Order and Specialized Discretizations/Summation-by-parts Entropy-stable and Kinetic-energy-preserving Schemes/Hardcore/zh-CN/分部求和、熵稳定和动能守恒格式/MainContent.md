## 引言
在[计算流体力学](@entry_id:747620)（CFD）的前沿，对[湍流](@entry_id:151300)、[激波-边界层相互作用](@entry_id:182938)和声学等[复杂流动](@entry_id:747569)现象进行高保真模拟，对[高阶数值方法](@entry_id:142601)提出了严苛的要求。传统的[高阶格式](@entry_id:150564)虽然在光滑流动区域能提供优异的精度，但在面对不连续（如激波）或未解析的尺度时，往往会遭遇[数值不稳定性](@entry_id:137058)，导致计算发散。这一核心挑战催生了新一代的数值方法——结构保持格式，其设计理念是将物理定律（如能量守恒、[熵增原理](@entry_id:142282)）直接融入离散的代数结构中，从而获得超乎寻常的鲁棒性。

本文旨在系统地介绍当前CFD领域最重要的一类结构保持格式：基于[分部求和](@entry_id:755630)（Summation-by-Parts, SBP）算子的熵稳定（Entropy-Stable, ES）和[动能守恒](@entry_id:177660)（Kinetic-Energy-Preserving, KEP）格式。我们将填补从抽象数学理论到实用计算代码之间的知识鸿沟，向读者展示如何构建和应用这些先进的数值工具。通过学习本文，你将能够理解这些格式为何以及如何在保持[高阶精度](@entry_id:750325)的同时，还能在最严酷的计算条件下保持稳定。

为实现这一目标，本文组织为三个循序渐进的章节。首先，在“**原理与机制**”一章中，我们将深入剖析SBP算子的代数精髓，揭示其如何模拟[分部积分](@entry_id:136350)，并基于此构建出满足离散能量守恒、[熵稳定性](@entry_id:749023)和[动能守恒](@entry_id:177660)性的格式。接着，在“**应用与跨学科联系**”一章中，我们将理论付诸实践，探讨如何利用这些格式处理复杂的物理边界、粘性效应、[激波捕捉](@entry_id:141726)以及[曲线网格](@entry_id:1123319)等真实工程问题，展示其在不同场景下的强大能力。最后，“**动手实践**”部分将提供一系列精心设计的编程练习，引导你亲手实现这些格式的核心组件，从而将理论知识转化为解决实际问题的技能。

## 原理与机制

本章旨在深入探讨构建稳健高阶数值格式的核心原理与机制，特别关注[分部求和](@entry_id:755630)（Summation-by-Parts, SBP）算子及其在构造熵稳定和[动能守恒格式](@entry_id:1126920)中的应用。我们将从SBP算子的基本代数性质出发，逐步揭示这些性质如何为离散系统赋予类似于连续介质物理定律的守恒性和稳定性。

### [分部求和](@entry_id:755630)（SBP）算子的基本原理

在[数值分析](@entry_id:142637)中，模拟物理守恒律的关键挑战之一是在离散层面复现连续微积分中的基本运算法则，尤其是分部积分（Integration-By-Parts, IBP）。[分部求和](@entry_id:755630)（SBP）算子正是为此目标而设计的[有限差分算子](@entry_id:749379)，它通过一组严格的代数条件，在离散网格上精确地模拟了分部积分。

#### SBP算子的代数定义

考虑一个一维区间 $[a,b]$ 上的 $N$ 个节点网格。一个[一阶导数](@entry_id:749425)的SBP算子由一个三元组 $(D, H, Q)$ 定义，其中：
1.  $D \in \mathbb{R}^{N \times N}$ 是导数矩阵。
2.  $H \in \mathbb{R}^{N \times N}$ 是一个[对称正定](@entry_id:145886)（Symmetric Positive-Definite, SPD）矩阵，它在[离散空间](@entry_id:155685)中定义了一个范数和[内积](@entry_id:750660)。对于任意网格函数（向量）$u, v \in \mathbb{R}^N$，其离散[内积](@entry_id:750660)定义为 $\langle u, v \rangle_H = u^T H v$，诱导的范数平方为 $\|u\|_H^2 = u^T H u$。$H$ 通常被称为 **范数矩阵** 或 **求积矩阵**。
3.  $Q \in \mathbb{R}^{N \times N}$ 是一个辅助矩阵。

这三个矩阵必须满足以下代数关系：
$$
D = H^{-1} Q
$$
$$
Q + Q^T = B
$$
其中 $B = \mathrm{diag}(-1, 0, \dots, 0, 1)$ 是一个边界矩阵，其非零元素仅出现在对应于物理域边界的第一个和最后一个节点上。

这些看似抽象的代数条件，实际上蕴含着深刻的物理和数学意义。它们共同确保了导数算子 $D$ 在 $H$ [内积](@entry_id:750660)下具有离散的分部积分特性。我们可以通过以下推导来证明这一点 ：

考虑[内积](@entry_id:750660) $\langle u, Dv \rangle_H$：
$$
\langle u, Dv \rangle_H = u^T H (Dv) = u^T H (H^{-1} Q) v = u^T Q v
$$
现在，将上式与 $\langle v, Du \rangle_H$ 相加：
$$
\langle u, Dv \rangle_H + \langle v, Du \rangle_H = u^T Q v + v^T H (Du) = u^T Q v + v^T Q u
$$
由于标量的[转置](@entry_id:142115)等于其自身，我们有 $v^T Q u = (v^T Q u)^T = u^T Q^T v$。因此：
$$
\langle u, Dv \rangle_H + \langle v, Du \rangle_H = u^T Q v + u^T Q^T v = u^T (Q + Q^T) v
$$
根据SBP的定义，$Q + Q^T = B$，我们得到核心的 **[分部求和](@entry_id:755630)公式**：
$$
\langle u, Dv \rangle_H + \langle v, Du \rangle_H = u^T B v
$$
或写作：
$$
u^T H D v = -v^T H D u + u^T B v
$$
这个恒等式是连续[分部积分公式](@entry_id:145262) $\int_a^b u (\partial_x v) dx = [uv]_a^b - \int_a^b v (\partial_x u) dx$ 的一个完美离散模拟。其中，$u^T H D v$ 模拟了 $\int u (\partial_x v) dx$，$v^T H D u$ 模拟了 $\int v (\partial_x u) dx$，而边界项 $u^T B v = u_N v_N - u_1 v_1$ 则精确地对应于 $[uv]_a^b$。这种精确的模拟是构造[稳定数值格式](@entry_id:755322)的基石。

#### SBP算子的具体构造

SBP算子并非独一无二，可以根据所需的精度和范数矩阵的结构进行构造。一个关键的区别在于范数矩阵 $H$ 是对角矩阵还是稠密（或带状）矩阵 。

-   **对角范数SBP算子**：这类算子的 $H$ 矩阵是对角阵，这使得[内积](@entry_id:750660)计算和求逆（如果需要）变得非常高效。它们通常与传统的有限差分法有更紧密的联系。例如，一个在4点网格上具有二阶内部精度和一阶边界精度的对角范数SBP算子可以定义为：
    $$
    H_d = h \cdot \mathrm{diag}\left(\frac{1}{2}, 1, 1, \frac{1}{2}\right), \quad D_d = \frac{1}{h}\begin{pmatrix} -1  1  0  0 \\ -\frac{1}{2}  0  \frac{1}{2}  0 \\ 0  -\frac{1}{2}  0  \frac{1}{2} \\ 0  0  -1  1 \end{pmatrix}
    $$
    通过直接计算可以验证，由 $Q_d = H_d D_d$ 定义的矩阵满足 $Q_d + Q_d^T = B$。这种构造的优点是简单直观，但其边界精度低于内部精度。

-   **全范数SBP算子**：为了在边界处也达到高精度，可以构造具有非对角（通常是带状）范数矩阵 $H$ 的算子。这允许在保持SBP性质的同时，在边界上使用更高阶的差分格式。例如，一个在4点网格上具有二阶边界精度的全范数算子可以被构造出来，其 $H_f$ 和 $D_f$ 矩阵更为复杂，但其边界差分格式是二阶的。这类算子通常与谱方法或[间断Galerkin方法](@entry_id:748369)中的[质量矩阵](@entry_id:177093)有关，提供了更高的精度，但牺牲了 $H$ 矩阵的简单性 。

选择对角范数还是全范数算子，是在[计算效率](@entry_id:270255)和边界精度之间的一种权衡。

### SBP框架下的守恒性与稳定性

SBP算子的精妙之处在于，其代数结构直接导出了离散系统的稳定性和守恒性，使得[稳定性分析](@entry_id:144077)从复杂的谱分析转变为代数上的能量估计。

#### 线性问题的能量守恒

考虑一维线性对流方程 $\partial_t u + a \partial_x u = 0$ 的[半离散化](@entry_id:163562)：
$$
\frac{d\boldsymbol{u}}{dt} + a D \boldsymbol{u} = \boldsymbol{0}
$$
其中 $\boldsymbol{u}(t)$ 是网格点上解的向量，$D$ 是一个SBP算子。我们可以考察系统的离散能量 $E(t) = \frac{1}{2} \|\boldsymbol{u}\|_H^2 = \frac{1}{2} \boldsymbol{u}^T H \boldsymbol{u}$ 的时间演化：
$$
\frac{dE}{dt} = \frac{1}{2} \left( \frac{d\boldsymbol{u}^T}{dt} H \boldsymbol{u} + \boldsymbol{u}^T H \frac{d\boldsymbol{u}}{dt} \right) = \boldsymbol{u}^T H \frac{d\boldsymbol{u}}{dt}
$$
代入半离散方程，我们得到：
$$
\frac{dE}{dt} = \boldsymbol{u}^T H (-a D \boldsymbol{u}) = -a (\boldsymbol{u}^T H D \boldsymbol{u})
$$
此时，[分部求和](@entry_id:755630)公式（令 $v=u$）发挥了关键作用 。我们有 $2 \boldsymbol{u}^T H D \boldsymbol{u} = \boldsymbol{u}^T B \boldsymbol{u}$，因此：
$$
\frac{dE}{dt} = -a \left( \frac{1}{2} \boldsymbol{u}^T B \boldsymbol{u} \right) = -\frac{a}{2} (u_N^2 - u_1^2)
$$
这个结果非常优美：它表明离散能量的变化完全由边界处的能量通量决定。对于[周期性边界条件](@entry_id:753346)，边界矩阵 $B=\boldsymbol{0}$，因此 $\frac{dE}{dt}=0$，离散能量被精确守恒。这使得 SBP 格式对于模拟无粘、无耗散的物理过程（如声波传播或理想[湍流](@entry_id:151300)）特别有吸[引力](@entry_id:189550)。这种性质被称为 **[动能守恒](@entry_id:177660)** 或 **能量稳定**。值得注意的是，这种半离散的能量守恒性质是构建非耗散全离散格式的基础 。

#### 全局守恒律

除了能量稳定，SBP算子还能精确地维持全局[守恒量](@entry_id:161475)。对于一个守恒律方程 $\partial_t u + \partial_x f(u) = 0$，其半离散形式为 $\frac{d\boldsymbol{u}}{dt} + D\boldsymbol{f}(\boldsymbol{u}) = \boldsymbol{0}$。我们考察总[守恒量](@entry_id:161475) $U_{total} = \boldsymbol{1}^T H \boldsymbol{u}$ 的变化率，其中 $\boldsymbol{1}$ 是全1向量 。
$$
\frac{dU_{total}}{dt} = \boldsymbol{1}^T H \frac{d\boldsymbol{u}}{dt} = - \boldsymbol{1}^T H D \boldsymbol{f}
$$
要计算 $\boldsymbol{1}^T H D \boldsymbol{f}$，我们利用一个重要的 SBP 性质：如果导数算子是常数一致的，即 $D\boldsymbol{1}=\boldsymbol{0}$，那么可以证明 $\boldsymbol{1}^T H D \boldsymbol{f} = f_N - f_1$。这个证明本身就是对SBP[代数结构](@entry_id:137052)的精彩运用 。因此，我们得到：
$$
\frac{dU_{total}}{dt} = -(f_N - f_1) = f_1 - f_N
$$
这个[离散守恒](@entry_id:1123819)定律表明，总量的变化率精确地等于流入边界的通量减去流出边界的通量，完美地再现了连续积分守恒定律 $\frac{d}{dt}\int_a^b u \, dx = f(a) - f(b)$。

#### 边界条件与同步近似项（SAT）

在[非周期性](@entry_id:275873)问题中，必须施加边界条件。在SBP框架下，**同步近似项（Simultaneous Approximation Term, SAT）**方法是一种常用且能保持稳定性的技术。[SAT方法](@entry_id:754511)通过在方程右端加入惩罚项来弱形式地施加边界条件。例如，对于线性对流方程，带有SAT项的格式如下 ：
$$
\frac{d\boldsymbol{u}}{dt} + a D \boldsymbol{u} = H^{-1} \tau_L \boldsymbol{e}_1 (u_1 - g_L(t))
$$
这里假设入口在左边界 $x=a$，$\boldsymbol{e}_1$ 是只在第一个节点为1的[单位向量](@entry_id:165907)，$g_L(t)$ 是给定的边界数据，$\tau_L$ 是惩罚参数。

通过能量方法分析，可以发现SAT项对能量变化率的贡献为 $\tau_L(u_1 - g_L)u_1$。为了确保整个系统的能量稳定（即能量不增长），需要明智地选择 $\tau_L$。对于 $a>0$ 的[入口边界](@entry_id:187498)，选择 $\tau_L = -a$ 不仅能保证稳定性，还能使格式的全局守恒误差为零，从而使格式在施加边界条件的同时保持守恒性 。

### [非线性系统](@entry_id:168347)的[熵稳定性](@entry_id:749023)

对于像[可压缩欧拉方程](@entry_id:747588)这样的[非线性](@entry_id:637147)[双曲系统](@entry_id:260647)，解可以形成激波。物理上合理的激波必须满足[热力学](@entry_id:172368)第二定律，即熵在穿过激波时不能减少。数值格式必须能够捕捉到这种物理耗散，以避免产生非物理的膨胀激波。[熵稳定格式](@entry_id:749017)正是为此而设计的。

#### 数学熵与物理熵

为了构造[熵稳定格式](@entry_id:749017)，我们引入了 **数学熵** 的概念。一个数学熵对 $(U, F)$ 由一个关于[守恒变量](@entry_id:747720) $u$ 的凸函数 $U(u)$ 和一个熵通量 $F(u)$ 组成，它们满足[相容性条件](@entry_id:637057)。对于[弱解](@entry_id:161732)，它们必须满足[熵不等式](@entry_id:184404)：
$$
\partial_t U(u) + \partial_x F(u) \le 0
$$
这个不等式意味着总熵 $\int U(u) dx$ 是一个不随时间增加的量。为了使这个数学概念与物理现实对齐，我们需要选择一个合适的 $U(u)$。

对于理想气体[欧拉方程](@entry_id:177914)，物理熵密度 $\rho s$ 应该是非减的，即 $\partial_t(\rho s) + \partial_x(\rho s u) \ge 0$。为了将这个物理定律与数学[熵不等式](@entry_id:184404)联系起来，我们必须选择一个与 $\rho s$ 相关的递减函数作为 $U(u)$。标准的选择是 **物理熵的负值**：$U(u) = -\rho s$ 。这个选择至关重要，原因有二：
1.  它将物理上的熵增（$\ge 0$）转换为了数学上的熵耗散（$\le 0$）。
2.  可以证明，$U(u) = -\rho s$ 是守恒变量 $u=(\rho, \rho u, \rho E)^T$ 的一个严格[凸函数](@entry_id:143075)。

[凸性](@entry_id:138568)是构造[熵稳定格式](@entry_id:749017)的数学基石。其他看似合理的选择，如总能量 $\rho E$ 或动能 $\frac{1}{2}\rho u^2$，虽然也是凸函数，但它们对应的[熵不等式](@entry_id:184404)并不等价于[热力学](@entry_id:172368)第二定律，因此不能保证物理正确性 。此外，任何对熵函数的正[线性缩放](@entry_id:197235) $(cU, cF)$ 仍然是一个有效的熵对，并且不会改变格式的[熵稳定性](@entry_id:749023) 。

#### [熵变](@entry_id:138294)量与熵势

基于凸的熵函数 $U(u)$，可以定义 **熵变量** $v = \nabla_u U(u)$。利用这些变量，可以将原始的守恒律方程转换为一个对称的形式。在[熵稳定格式](@entry_id:749017)的构造中，一个核心概念是 **熵势** $\psi(u)$，它由Tadmor的理论定义 ：
$$
\psi(u) = v(u)^T f(u) - F(u)
$$
这个熵势使得一个 **[熵守恒](@entry_id:749018)两点[数值通量](@entry_id:145174)** $f^*(u_L, u_R)$ 的定义成为可能。这样的通量必须满足以下代数关系：
$$
(v_R - v_L)^T f^*(u_L, u_R) = \psi(u_R) - \psi(u_L)
$$
当使用这种通量和一个中心型的SBP算子（例如在周期域上，$Q$ 是反对称的）时，可以证明离散总熵是精确守恒的。对于一维欧拉方程，使用Harten熵 $U = -\frac{\rho s}{\gamma-1}$，可以推导出其熵势是一个非常简洁的表达式 $\psi(u) = m = \rho u$ 。这一优雅的结果是设计[熵守恒](@entry_id:749018)（以及熵稳定）通量的关键。

### [可压缩流](@entry_id:747589)的[动能守恒](@entry_id:177660)

在某些流动中，例如充分发展的[湍流](@entry_id:151300)，物理上粘性效应很小，人们希望数值格式能够最小化人为的[数值耗散](@entry_id:168584)，并尽可能地保持流动的动能。这与熵稳定的目标（在激波处引入正确的物理耗散）有所不同，但两者在光滑流动区域可以共存。

#### [动能守恒](@entry_id:177660)（KEP）条件

[动能守恒](@entry_id:177660)（Kinetic Energy Preserving, KEP）格式旨在离散地模拟连续动能方程的演化。对于可压缩流，动能并非[守恒量](@entry_id:161475)，而是通过压力做功项与内能相互转化。一个KEP格式的目标是确保对流项本身不产生或耗散动能。

在SBP通量差分框架下，可以推导出对流项是KEP的充要条件 。对于任意两个相邻的网格点状态 $i$ 和 $j$，其两点质量通量 $f^{\rho}_{ij}$ 和两点对流[动量通量](@entry_id:199796) $f^{m, \mathrm{conv}}_{ij}$ 必须满足以下代数关系：
$$
f^{m, \mathrm{conv}}_{ij} = \frac{u_i+u_j}{2} f^{\rho}_{ij}
$$
这个条件意味着，对流[动量通量](@entry_id:199796)必须等于两点速度的[算术平均值](@entry_id:165355)乘以质量通量。任何满足此条件的数值通量构造都将产生一个KEP的[对流格式](@entry_id:747850)。例如，选择 $f^{\rho}_{ij} = \frac{1}{2}(\rho_i u_i + \rho_j u_j)$ 和 $f^{m, \mathrm{conv}}_{ij} = \frac{1}{2}(u_i + u_j) \cdot \frac{1}{2}(\rho_i u_i + \rho_j u_j)$ 是一种有效的KEP构造 。

#### 分裂格式的构造

KEP格式通常通过所谓的 **分裂格式**（split form）来实现，即对[非线性](@entry_id:637147)的对流项以一种特殊的方式离散。例如，对于[动量方程](@entry_id:197225)中的对流项 $\partial_x(\rho u^2)$，一个KEP的[半离散化](@entry_id:163562)形式是 ：
$$
\mathcal{C}(\boldsymbol{m}, \boldsymbol{u}) = \frac{1}{2} D(\boldsymbol{m} \circ \boldsymbol{u}) + \frac{1}{2} \mathrm{diag}(\boldsymbol{u}) D \boldsymbol{m} + \frac{1}{2} \mathrm{diag}(\boldsymbol{m}) D \boldsymbol{u}
$$
其中 $\circ$ 表示逐元素乘积。这种形式巧妙地组合了守恒形式和[非守恒形式](@entry_id:1128837)的导数。当使用一个反对称的SBP算子 $D$（例如在周期域上）时，可以证明这个算子对离散动能变化率的贡献精确为零 。这种分裂格式，如Morinishi或Pirozzoli提出的形式，在代数上等价于选择了满足上述KEP代数条件的通量差分形式 。

在等熵欧拉方程这样的简化模型中，[总机械能](@entry_id:167353)可以作为熵函数。在这种特殊情况下，可以找到一种特定的分裂格式（参数 $c=1/2$），它能同时实现[动能守恒](@entry_id:177660)和[熵守恒](@entry_id:749018)，展示了这两种重要性质之间的深刻联系 。

综上所述，SBP算子提供了一个统一而强大的数学框架。通过其内禀的代数性质，我们可以系统地设计出满足[离散守恒](@entry_id:1123819)律、能量稳定、熵稳定和[动能守恒](@entry_id:177660)等关键物理属性的高阶数值格式。这些性质是现代CFD中发展鲁棒和[精确模拟](@entry_id:749142)工具的核心。