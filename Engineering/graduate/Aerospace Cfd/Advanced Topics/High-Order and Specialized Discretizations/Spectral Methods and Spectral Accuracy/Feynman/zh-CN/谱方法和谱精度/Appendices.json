{
    "hands_on_practices": [
        {
            "introduction": "掌握谱方法的第一步是理解其在基础问题上的应用，例如一维周期性问题。本练习将引导你为线性平流方程构建一个傅里叶伪谱格式，并分析其核心性质。通过推导离散色散关系 ，你将亲眼见证傅里叶方法为何以其高精度著称——因为它对已解析的线性波传播不引入任何数值色散误差。",
            "id": "3995720",
            "problem": "在航空航天计算流体动力学（CFD）中，由均匀对流引起的被动标量输运通过线性平流方程 $u_{t} + c\\,u_{x} = 0$ 进行建模。该方程描述了一个在域 $[0,2\\pi]$ 上的空间周期场 $u(x,t)$，具有周期性边界条件和恒定的平流速度 $c>0$。考虑一个在 $N$ 个等距配置点 $x_{j} = \\frac{2\\pi j}{N}$（其中 $j=0,1,\\dots,N-1$）上的傅里叶伪谱构造，其中空间导数通过将节点值映射到傅里叶空间，对所有解析的模态应用精确谱微分，然后映射回物理空间来求值。\n\n从 $[0,2\\pi]$ 上周期函数的基本定义以及复傅里叶模态作为微分算子特征函数的性质出发，为节点值 $u_{j}(t) \\equiv u(x_{j},t)$ 构建半离散傅里叶伪谱格式，不引入任何时间离散化。然后，通过分析单个解析离散傅里叶模态的演化，确定精确的离散色散关系，表示为角频率 $\\omega_{h}$ 与整数空间波数 $\\kappa$ 和速度 $c$ 的函数。\n\n以 $\\omega_{h}$ 关于 $\\kappa$ 和 $c$ 的单一闭式表达式的形式提供您的最终答案。无需四舍五入，表达式中不包含任何物理单位。",
            "solution": "该问题陈述经证实具有科学依据、适定且客观。它代表了使用谱方法进行偏微分方程数值分析的一个基本练习。因此，我们可以开始求解。\n\n问题要求两件事：首先，构建线性平流方程的半离散傅里叶伪谱格式；其次，确定此格式的离散色散关系。\n\n控制方程是线性平流方程：\n$$\nu_{t} + c\\,u_{x} = 0\n$$\n其中 $u(x,t)$ 是域 $x \\in [0, 2\\pi]$ 上的空间周期函数，而 $c>0$ 是一个恒定的平流速度。\n\n傅里叶伪谱法使用 $N$ 个等距配置点 $x_{j} = \\frac{2\\pi j}{N}$（其中 $j=0, 1, \\dots, N-1$）来离散化空间域。在这些点上的解表示为 $u_{j}(t) \\equiv u(x_{j},t)$。该方法的核心是使用离散傅里叶变换（DFT）将物理空间节点值 $\\{u_{j}(t)\\}$ 与一组有限的傅里叶系数 $\\{\\hat{u}_{\\kappa}(t)\\}$ 联系起来。\n\n定义在这些网格点上的函数可以由一个有限傅里叶级数表示，也称为离散傅里叶展开或插值：\n$$\nu_{j}(t) = \\sum_{\\kappa \\in K} \\hat{u}_{\\kappa}(t) \\exp(i\\kappa x_{j})\n$$\n其中 $K$ 是解析的整数波数集合。对于偶数点 $N$，这个集合通常选择为 $K = \\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$。傅里叶系数 $\\hat{u}_{\\kappa}(t)$ 由正向 DFT 给出：\n$$\n\\hat{u}_{\\kappa}(t) = \\frac{1}{N} \\sum_{j=0}^{N-1} u_{j}(t) \\exp(-i\\kappa x_{j})\n$$\n\n问题陈述空间导数 $u_{x}$ 是通过在傅里叶空间中应用精确谱微分来求值的。此过程包括三个步骤：\n1.  使用 DFT 将节点值 $u_{j}(t)$ 变换为其傅里叶系数 $\\hat{u}_{\\kappa}(t)$。\n2.  单个傅里叶模态 $\\exp(i\\kappa x)$ 的精确导数是 $(i\\kappa)\\exp(i\\kappa x)$。因此，谱空间中的微分对应于将每个傅里叶系数 $\\hat{u}_{\\kappa}(t)$ 乘以其对应的因子 $i\\kappa$。设导数的傅里叶系数为 $\\widehat{(u_{x})}_{\\kappa}$。那么，对于每个解析模态 $\\kappa \\in K$，我们有：\n    $$\n    \\widehat{(u_{x})}_{\\kappa}(t) = i\\kappa \\, \\hat{u}_{\\kappa}(t)\n    $$\n3.  使用逆 DFT 将新系数 $\\widehat{(u_{x})}_{\\kappa}(t)$ 变换回物理空间以获得导数的节点值，我们将其表示为 $(u_{x})_{j}$：\n    $$\n    (u_{x})_{j} \\equiv \\frac{\\partial u}{\\partial x}\\bigg|_{x=x_j} \\approx \\sum_{\\kappa \\in K} \\widehat{(u_{x})}_{\\kappa}(t) \\exp(i\\kappa x_{j}) = \\sum_{\\kappa \\in K} (i\\kappa \\, \\hat{u}_{\\kappa}(t)) \\exp(i\\kappa x_{j})\n    $$\n\n这样就完成了空间导数近似的构建。通过将此近似代入每个配置点 $x_{j}$ 处的控制偏微分方程，形成半离散格式：\n$$\n\\frac{d u_{j}(t)}{dt} + c (u_{x})_{j} = 0\n$$\n代入 $(u_{x})_{j}$ 的表达式：\n$$\n\\frac{d u_{j}(t)}{dt} + c \\sum_{\\kappa \\in K} (i\\kappa \\, \\hat{u}_{\\kappa}(t)) \\exp(i\\kappa x_{j}) = 0, \\quad \\text{for } j=0, 1, \\dots, N-1\n$$\n这是一个关于节点值 $u_{j}(t)$ 的 $N$ 个耦合常微分方程（ODEs）组。这就是半离散傅里叶伪谱格式。\n\n接下来，我们通过分析单个解析离散傅里叶模态的演化来确定离散色散关系。我们假设解是具有整数波数 $\\kappa_{0} \\in K$ 的单个模态：\n$$\nu_{j}(t) = A(t) \\exp(i\\kappa_{0} x_{j})\n$$\n其中 $A(t)$ 是一个随时间变化的振幅。为了继续，我们可以完全在傅里叶空间中工作，这简化了分析。对半离散 ODE 系统应用 DFT 可以解耦方程。傅里叶系数 $\\hat{u}_{\\kappa}(t)$ 的时间导数是：\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = \\frac{1}{N} \\sum_{j=0}^{N-1} \\frac{du_{j}(t)}{dt} \\exp(-i\\kappa x_{j})\n$$\n代入 $\\frac{du_{j}(t)}{dt} = -c(u_{x})_{j}$：\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c \\left( \\frac{1}{N} \\sum_{j=0}^{N-1} (u_{x})_{j} \\exp(-i\\kappa x_{j}) \\right)\n$$\n括号中的项根据定义是 $(u_{x})_{j}$ 的正向 DFT，即傅里叶系数 $\\widehat{(u_{x})}_{\\kappa}(t)$。因此，傅里叶空间中的 ODE 系统是：\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c \\, \\widehat{(u_{x})}_{\\kappa}(t)\n$$\n使用关系式 $\\widehat{(u_{x})}_{\\kappa}(t) = i\\kappa \\, \\hat{u}_{\\kappa}(t)$，我们为每个傅里叶系数得到一个解耦的 ODE：\n$$\n\\frac{d\\hat{u}_{\\kappa}(t)}{dt} = -c (i\\kappa) \\hat{u}_{\\kappa}(t) = -ic\\kappa \\, \\hat{u}_{\\kappa}(t)\n$$\n这个方程描述了波数为 $\\kappa$ 的傅里叶模态振幅的演化。这个 ODE 的解是：\n$$\n\\hat{u}_{\\kappa}(t) = \\hat{u}_{\\kappa}(0) \\exp(-ic\\kappa t)\n$$\n一个一般的离散平面波解写成形式 $u_{j}(t) \\propto \\exp(i(\\kappa x_{j} - \\omega_{h} t))$，其中 $\\omega_{h}$ 是离散角频率。相应傅里叶系数的时间演化是 $\\hat{u}_{\\kappa}(t) \\propto \\exp(-i\\omega_{h} t)$。\n\n通过将此一般形式与我们推导的解 $\\hat{u}_{\\kappa}(t) = \\hat{u}_{\\kappa}(0) \\exp(-ic\\kappa t)$ 进行比较，我们可以使含时指数项相等：\n$$\n\\exp(-i\\omega_{h} t) = \\exp(-ic\\kappa t)\n$$\n这意味着 $-i\\omega_{h} t = -ic\\kappa t$。因此，离散色散关系为：\n$$\n\\omega_{h} = c\\kappa\n$$\n这一结果展示了傅里叶谱方法处理线性平流方程的一个关键特性：空间离散化不会引入色散误差。由 $\\frac{\\omega_{h}}{\\kappa}$ 给出的数值相速度，对于所有解析的波数 $\\kappa$，都精确等于物理平流速度 $c$。完整数值解中的任何误差都将仅源于时间积分格式以及未解析模态的混叠（如果它们初始存在或由非线性项产生，而本问题中不存在非线性项）。",
            "answer": "$$\n\\boxed{c\\kappa}\n$$"
        },
        {
            "introduction": "尽管谱方法在处理线性平流问题时表现完美，但真实的流体动力学问题充满了非线性项，这带来了新的挑战。其中最关键的便是“混叠”效应，即未解析的高频分量会污染低频分量的计算结果。本练习  提供了一个对混叠误差进行动手分析的机会，你将通过研究二次非线性项 $u^2$ 来量化此误差，并验证广泛使用的“3/2规则”填充策略在消除混叠方面的有效性。",
            "id": "3995790",
            "problem": "考虑区间 $[0,2\\pi)$ 上的一个一维周期性域，这在计算流体动力学 (CFD) 的高阶谱方法中是标准的。设 $u(x)$ 是一个实值速度场，表示在 $N$ 个等距配置点 $x_{j} = \\frac{2\\pi j}{N}$（$j = 0,1,\\dots,N-1$）上，其中 $N$ 是一个能被 $3$ 整除的偶数。截断傅里叶级数使用的波数指数为 $k \\in \\{-\\frac{N}{2},\\dots,\\frac{N}{2}-1\\}$，离散傅里叶变换 (DFT) 系数定义为 $\\hat{u}_{k} = \\frac{1}{N}\\sum_{j=0}^{N-1}u(x_{j})\\exp(-i k x_{j})$，因此 $u(x_{j}) = \\sum_{k=-N/2}^{N/2-1}\\hat{u}_{k}\\exp(i k x_{j})$ 对采样数据精确成立。\n\n假设场是单模态状态 $u(x) = \\cos(k_{0}x)$，其中 $k_{0} = \\frac{N}{3}$，该波数在可表示频带内。在对二次非线性项 $u^{2}(x)$ 进行伪谱法评估时，我们在物理空间中逐点计算 $u^{2}$，然后使用快速傅里叶变换 (FFT) 返回到傅里叶空间。在没有反混叠处理的情况下，作为 DFT 基础的离散循环卷积会导致由二次乘积产生的高频内容模 $N$ 折回到解析频带内，从而产生混叠。\n\n从傅里叶级数、DFT 和离散卷积定理的基本定义出发，推导 $u^{2}(x)$ 的精确傅里叶系数，并确定在没有任何反混叠处理的情况下，在 $N$ 点网格上形成 $u^{2}$ 时，在波数 $k = \\frac{N}{3}$ 处产生的混叠系数。然后分析 3/2 法则填充策略：将 $u$ 的谱表示零填充到 $M = \\frac{3N}{2}$ 个点（$M$ 为整数），变换到 $M$ 点物理网格，在那里形成 $u^{2}$，然后变换回来，将结果截断至原始频带 $k \\in \\{-\\frac{N}{2},\\dots,\\frac{N}{2}-1\\}$。使用第一性原理，证明填充计算在截断后是否在 $k = \\frac{N}{3}$ 处产生任何非零系数。\n\n报告一个单一的量，即误差减小因子，定义为在波数 $k = \\frac{N}{3}$ 处，填充后的系数幅值与未填充的混叠系数幅值之比。无需四舍五入。以无单位的单个实数形式提供最终答案。",
            "solution": "该问题要求分析伪谱方法中二次非线性项的混叠误差，以及 3/2 法则在反混叠中的有效性。我们首先将验证问题陈述。\n\n### 问题验证\n\n**第一步：提取已知条件**\n- 域：一维，在 $[0, 2\\pi)$ 上周期性。\n- 网格：$N$ 个等距点，$x_{j} = \\frac{2\\pi j}{N}$，其中 $j = 0, 1, \\dots, N-1$。\n- 网格大小 $N$：一个能被 $3$ 整除的偶数。\n- 波数范围：$k \\in \\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$。\n- DFT: $\\hat{u}_{k} = \\frac{1}{N}\\sum_{j=0}^{N-1}u(x_{j})\\exp(-i k x_{j})$。\n- IDFT: $u(x_{j}) = \\sum_{k=-N/2}^{N/2-1}\\hat{u}_{k}\\exp(i k x_{j})$。\n- 场：$u(x) = \\cos(k_{0}x)$，其中 $k_{0} = \\frac{N}{3}$。\n- 非线性项：$u^{2}(x)$。\n- 未填充方法：在 $N$ 点网格上计算 $u^{2}$ 并变换回傅里叶空间。\n- 填充方法（3/2 法则）：将 $u$ 的傅里叶系数填充到 $M = \\frac{3N}{2}$ 个点，变换到 $M$ 点物理网格，计算 $u^2$，变换回来，并截断至原始波数频带。\n- 任务：找出未填充方法在 $k = \\frac{N}{3}$ 处的混叠系数。确定填充方法是否在 $k = \\frac{N}{3}$ 处产生非零系数。计算误差减小因子，即在 $k = \\frac{N}{3}$ 处填充后系数的幅值与未填充系数的幅值之比。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学上成立**：该问题是谱方法理论中的一个经典例子，涉及混叠误差和反混叠技术。它牢固地基于傅里叶分析及其在 CFD 数值方法中的应用。\n- **适定性**：该问题定义明确，提供了所有必要信息。初始条件 $u(x)$、网格、数值程序以及要计算的量都已精确指定。存在唯一解。\n- **客观性**：问题陈述是客观的，并使用了数值分析和应用数学中的标准术语。\n\n**第三步：结论与行动**\n问题有效。我们继续进行求解。\n\n### 未填充伪谱方法的分析\n\n首先，我们确定给定速度场 $u(x) = \\cos(k_{0}x)$（其中 $k_{0} = \\frac{N}{3}$）的离散傅里叶系数 $\\hat{u}_{k}$。使用欧拉公式，我们可以将 $u(x)$ 写成：\n$$\nu(x) = \\cos\\left(\\frac{N}{3}x\\right) = \\frac{1}{2}\\left(\\exp\\left(i\\frac{N}{3}x\\right) + \\exp\\left(-i\\frac{N}{3}x\\right)\\right)\n$$\n由于波数 $k_0 = \\frac{N}{3}$ 和 $-k_0 = -\\frac{N}{3}$ 都在解析频带 $k \\in \\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$ 内（因为 $\\frac{N}{3}  \\frac{N}{2}$），$u(x)$ 在 $N$ 点网格上的离散傅里叶谱由两个非零系数组成：\n$$\n\\hat{u}_{k} =\n\\begin{cases}\n1/2  \\text{如果 } k = \\pm\\frac{N}{3} \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n对二次非线性项 $u^{2}(x)$ 的伪谱评估涉及逐点计算乘积 $u^{2}(x_{j})$，然后应用 DFT。根据离散卷积定理，两个函数乘积的 DFT 是它们各自 DFT 的离散循环卷积。设 $\\widehat{(u^2)}_{k}$ 为 $u^{2}(x)$ 的 DFT 系数。那么：\n$$\n\\widehat{(u^2)}_{k} = (\\hat{u} * \\hat{u})_{k} = \\sum_{p+q \\equiv k \\pmod N} \\hat{u}_{p}\\hat{u}_{q}\n$$\n其中和是对解析频带中所有波数对 $(p, q)$ 进行的。由于 $\\hat{u}_k$ 仅在 $k = \\pm\\frac{N}{3}$ 时非零，我们只需要考虑这些模态之间的相互作用。可能的波数和 $p+q = k_{true}$ 有：\n1. $p = \\frac{N}{3}$，$q = \\frac{N}{3} \\implies k_{true} = \\frac{N}{3} + \\frac{N}{3} = \\frac{2N}{3}$。系数贡献为 $\\hat{u}_{N/3}\\hat{u}_{N/3} = (\\frac{1}{2})(\\frac{1}{2}) = \\frac{1}{4}$。\n2. $p = -\\frac{N}{3}$，$q = -\\frac{N}{3} \\implies k_{true} = -\\frac{N}{3} - \\frac{N}{3} = -\\frac{2N}{3}$。系数贡献为 $\\hat{u}_{-N/3}\\hat{u}_{-N/3} = (\\frac{1}{2})(\\frac{1}{2}) = \\frac{1}{4}$。\n3. $p = \\frac{N}{3}$，$q = -\\frac{N}{3}$（反之亦然）$\\implies k_{true} = \\frac{N}{3} - \\frac{N}{3} = 0$。系数贡献为 $\\hat{u}_{N/3}\\hat{u}_{-N/3} + \\hat{u}_{-N/3}\\hat{u}_{N/3} = (\\frac{1}{2})(\\frac{1}{2}) + (\\frac{1}{2})(\\frac{1}{2}) = \\frac{1}{2}$。\n\n现在，我们必须考虑混叠。波数 $k_{true}$ 必须映射回解析频带 $\\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$。\n- 对于 $k_{true} = \\frac{2N}{3}$：此波数在解析频带之外，因为 $\\frac{2N}{3} > \\frac{N}{2}-1$。混叠波数为 $k_{alias} = \\frac{2N}{3} - N = -\\frac{N}{3}$。这种相互作用错误地贡献给了 $k = -\\frac{N}{3}$ 处的系数。\n- 对于 $k_{true} = -\\frac{2N}{3}$：这也超出了频带。混叠波数为 $k_{alias} = -\\frac{2N}{3} + N = \\frac{N}{3}$。这种相互作用错误地贡献给了 $k = \\frac{N}{3}$ 处的系数。\n- 对于 $k_{true} = 0$：这在频带内，所以此项没有混叠。\n\n在没有反混叠的情况下计算出的 $u^2(x)$ 的离散谱为：\n$$\n\\widehat{(u^2)}_{k} =\n\\begin{cases}\n1/2  \\text{如果 } k = 0 \\\\\n1/4  \\text{如果 } k = N/3 \\text{ (混叠)} \\\\\n1/4  \\text{如果 } k = -N/3 \\text{ (混叠)} \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n因此，在 $k = \\frac{N}{3}$ 处的未填充混叠系数是 $\\frac{1}{4}$。\n\n### 填充（3/2 法则）方法的分析\n\n在填充方法中，我们首先将 $u(x)$ 的谱表示扩展到一个具有 $M = \\frac{3N}{2}$ 个点的网格上。傅里叶系数 $\\hat{u}_k$ 被放置到一个更大的数组 $\\hat{v}_k$ 中，其波数范围对应于 $M$ 个点，即 $k \\in \\{-\\lfloor\\frac{M-1}{2}\\rfloor, \\dots, \\lfloor\\frac{M}{2}\\rfloor\\}$。具体来说，$\\hat{v}_{\\pm N/3} = 1/2$，对于直到原始奈奎斯特极限的所有其他模态，$\\hat{v}_k$ 均为零，而直到新的奈奎斯特极限的新增模态也均为零。\n\n在 $M$ 点网格上形成二次乘积。得到的乘积波数仍然是 $k_{true} = 0, \\pm \\frac{2N}{3}$。我们必须检查这些波数在 $M$ 点网格上是否会发生混叠。如果乘积中产生的最高波数在填充网格的可表示（无混叠）范围内，则反混叠成功。乘积中的最大波数幅值为 $|k_{true}|_{max} = \\frac{2N}{3}$。填充网格的奈奎斯特波数为 $k_{Nyquist, M} = \\lfloor\\frac{M}{2}\\rfloor = \\lfloor \\frac{3N/2}{2} \\rfloor = \\lfloor \\frac{3N}{4} \\rfloor$。\n\n为使反混叠正确工作，我们必须满足 $|k_{true}|_{max}  k_{Nyquist, M}$。\n$$\n\\frac{2N}{3}  \\frac{3N}{4} \\iff 8N  9N\n$$\n对于任何 $N>0$，此不等式都成立。严格不等式确保了最高乘积波数不会恰好落在填充网格的奈奎斯特模上，从而避免了歧义。因此，在 $M$ 点网格上的卷积是没有混叠的。在 $M$ 网格上乘积的系数精确为：\n$$\n\\widehat{(u^2)}_{k, padded} =\n\\begin{cases}\n1/2  \\text{如果 } k = 0 \\\\\n1/4  \\text{如果 } k = 2N/3 \\\\\n1/4  \\text{如果 } k = -2N/3 \\\\\n0  \\text{其他情况}\n\\end{cases}\n$$\n最后一步是将此谱截断回原始波数范围 $k \\in \\{-\\frac{N}{2}, \\dots, \\frac{N}{2}-1\\}$。我们检查产生的波数：\n- $k=0$：这在原始频带内，因此被保留。\n- $k=\\frac{2N}{3}$：此波数在原始频带之外，因为 $\\frac{2N}{3} > \\frac{N}{2}-1$。该分量通过截断被移除。\n- $k=-\\frac{2N}{3}$：此波数也在原始频带之外，因为 $-\\frac{2N}{3}  -\\frac{N}{2}$。该分量也通过截断被移除。\n\n经过完整的填充并截断程序后，唯一的非零系数在 $k=0$ 处。在 $k = \\frac{N}{3}$ 处的系数为 $0$，因为在无混叠的乘积中没有产生这个波数，而未填充计算对此模态的贡献是由于混叠造成的，现在混叠已被消除。在 $k=\\frac{N}{3}$ 处的填充后系数为 $0$。\n\n### 误差减小因子\n\n误差减小因子是在 $k = \\frac{N}{3}$ 处，填充后系数的幅值与未填充的混叠系数的幅值之比。\n- 在 $k = \\frac{N}{3}$ 处未填充的混叠系数的幅值：$|\\frac{1}{4}| = \\frac{1}{4}$。\n- 在 $k = \\frac{N}{3}$ 处填充后的系数的幅值：$|0| = 0$。\n\n比值为：\n$$\n\\text{因子} = \\frac{|0|}{|\\frac{1}{4}|} = \\frac{0}{\\frac{1}{4}} = 0\n$$\n对于这个特定情况，3/2 法则完全消除了混叠误差。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "许多航空航天应用涉及有界区域，这要求我们将傅里叶基函数转换为切比雪夫或勒让德多项式。本练习将处理定义在有限区间上的粘性伯格斯方程，这是包含非线性对流和扩散的计算流体力学（CFD）问题的典型模型。通过编程实现并比较非线性项的对流形式、守恒形式和斜对称形式 ，你将获得关于离散化选择如何影响数值模拟的能量守恒性和稳定性的宝贵实践经验。",
            "id": "3995744",
            "problem": "考虑在闭区间 $[-1,1]$ 上的带齐次 Dirichlet 边界条件的的一维粘性 Burgers 方程，\n$$\nu_t + u u_x = \\nu u_{xx}, \\quad x \\in [-1,1], \\quad t \\ge 0, \\quad u(-1,t) = u(1,t) = 0,\n$$\n以及一个光滑且与边界兼容的初始条件\n$$\nu(x,0) = A \\sin(\\pi x).\n$$\n使用基于 Chebyshev–Gauss–Lobatto 点的 Chebyshev 配置点法对问题进行离散化，并随时间演化。您的任务是实现非线性项 $u u_x$ 的三种不同离散表示，并量化每种表示的能量行为：\n\n1. 平流形式：通过将 $u_x$ 替换为作用于 $u$ 的 Chebyshev 微分矩阵，并对 $u$ 使用逐点乘法，直接对 $u u_x$ 进行离散化。\n2. 守恒形式：将 $u u_x$ 重写为 $(1/2)\\partial_x(u^2)$，并使用作用于 $u^2$ 的 Chebyshev 微分矩阵对空间导数进行离散化。\n3. 斜对称形式：将 $u u_x$ 离散化为平流和守恒离散形式的算术平均值。\n\n数值近似必须符合以下要求：\n\n- 配置点：对 $j=0,1,\\dots,N$ 和 $N \\in \\mathbb{N}$，使用 $N+1$ 个 Chebyshev–Gauss–Lobatto 节点 $x_j = \\cos\\!\\left( \\frac{\\pi j}{N} \\right)$。\n- 微分：构建与这些节点相关联的 Chebyshev 一阶导数矩阵 $D$，并使用 $D^2$ 来表示二阶导数。\n- 求积：使用 Clenshaw–Curtis 求积权重来近似 $[-1,1]$ 上的空间积分。时间 $t$ 的离散能量必须计算为\n$$\nE(t) = \\frac{1}{2}\\sum_{j=0}^N w_j\\,u(x_j,t)^2,\n$$\n其中 $w_j$ 是 Chebyshev–Gauss–Lobatto 节点上 $[-1,1]$ 区间的 Clenshaw–Curtis 权重。\n- 时间积分：使用一种分裂策略将解从 $t=0$ 推进到 $t=T$。该策略通过半步上的精确矩阵指数处理线性扩散部分 $\\nu u_{xx}$，并通过显式 Runge–Kutta 方法处理非线性平流部分。具体来说，在每个完整时间步 $\\Delta t$ 中，首先使用 $\\nu D^2$ 在 $\\Delta t/2$ 上的矩阵指数应用半个扩散步，然后使用经典的四阶 Runge–Kutta 方法对非线性部分进行一个完整的显式步，最后使用相同的矩阵指数再应用另一个半个扩散步。在所有 Runge–Kutta 中间阶段和每个扩散半步之后，强施加 Dirichlet 边界条件。\n- 能量行为度量：对于三种离散非线性形式中的每一种，计算随时间步累积的正能量增量，定义为\n$$\n\\mathcal{D} = \\sum_{n=0}^{M-1} \\max\\!\\left(0,\\,E^{n+1}-E^n\\right),\n$$\n其中 $E^n$ 是第 $n$ 个时间层级的离散能量，$M = \\lfloor T/\\Delta t \\rceil$ 是总时间步数。\n\n使用以下参数集 $(N,\\nu,A,\\Delta t,T)$ 的测试套件，分别代表一般情况、高度扩散情况和无粘性边缘情况。由于问题是无量纲的，因此不需要物理单位。\n\n- 测试 1 (一般情况)：$(N,\\nu,A,\\Delta t,T) = (64,\\,0.01,\\,1.0,\\,2\\times 10^{-4},\\,2\\times 10^{-2})$。\n- 测试 2 (高度扩散)：$(N,\\nu,A,\\Delta t,T) = (32,\\,0.05,\\,1.0,\\,5\\times 10^{-4},\\,5\\times 10^{-2})$。\n- 测试 3 (无粘性边缘)：$(N,\\nu,A,\\Delta t,T) = (128,\\,0.0,\\,0.5,\\,10^{-4},\\,10^{-2})$。\n\n对于每个测试用例，计算平流、守恒和斜对称离散非线性形式的能量单调性缺陷 $\\mathcal{D}$。您的程序应生成单行输出，其中包含九个结果，格式为用方括号括起来的逗号分隔列表，顺序如下：\n$$\n[\\mathcal{D}_{\\text{adv, T1}}, \\mathcal{D}_{\\text{cons, T1}}, \\mathcal{D}_{\\text{skew, T1}}, \\mathcal{D}_{\\text{adv, T2}}, \\mathcal{D}_{\\text{cons, T2}}, \\mathcal{D}_{\\text{skew, T2}}, \\mathcal{D}_{\\text{adv, T3}}, \\mathcal{D}_{\\text{cons, T3}}, \\mathcal{D}_{\\text{skew, T3}}].\n$$\n输出值必须是按指定顺序排列的浮点数，且不应打印任何其他文本。",
            "solution": "用户要求使用 Chebyshev 配置点法求解一维粘性 Burgers 方程，重点是分析非线性项三种不同离散形式的能量行为。该问题在科学和数学上是合理的、适定的，并且所有必要的参数和方法都已指定。我们将进行正式求解。\n\n### 1. 问题表述\n控制偏微分方程 (PDE) 是在空间域 $x \\in [-1, 1]$ 上的粘性 Burgers 方程：\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其齐次 Dirichlet 边界条件为 $u(-1,t) = u(1,t) = 0$，光滑初始条件为 $u(x,0) = A \\sin(\\pi x)$。\n\n### 2. 空间离散化\n我们采用 Chebyshev 配置点法。使用 $N+1$ 个 Chebyshev–Gauss–Lobatto (CGL) 点对区域 $[-1, 1]$ 进行离散化：\n$$\nx_j = \\cos\\left(\\frac{\\pi j}{N}\\right), \\quad j = 0, 1, \\dots, N\n$$\n在这些点上的解 $u(x,t)$ 由向量 $\\mathbf{u}(t) = [u(x_0,t), u(x_1,t), \\dots, u(x_N,t)]^T$ 表示。\n\n空间导数使用 Chebyshev 微分矩阵 $D$ 来近似。$u$ 在配置点处的一阶导数通过矩阵向量乘积 $D\\mathbf{u}$ 近似，二阶导数通过 $D^2\\mathbf{u}$ 近似。$(N+1) \\times (N+1)$ 矩阵 $D$ 的项由公认的公式给出。\n\n这种空间离散化将偏微分方程转换为常微分方程组 (ODEs)：\n$$\n\\frac{d\\mathbf{u}}{dt} = -\\mathcal{N}(\\mathbf{u}) + \\nu D^2 \\mathbf{u}\n$$\n其中 $\\mathcal{N}(\\mathbf{u})$ 代表非线性项 $u u_x$ 的离散近似。\n\n齐次 Dirichlet 边界条件意味着 $u(x_0, t) = u(1, t) = 0$ 和 $u(x_N, t) = u(-1, t) = 0$。这些条件是强施加的，意味着我们只求解 $N-1$ 个内部点，$u_j$ for $j=1, \\dots, N-1$。令 $\\mathbf{u}_{int}(t)=[u(x_1,t), \\dots, u(x_{N-1},t)]^T$。这些内部点的常微分方程组为：\n$$\n\\frac{d\\mathbf{u}_{int}}{dt} = -\\mathcal{N}(\\mathbf{u})_{int} + \\nu (D^2 \\mathbf{u})_{int}\n$$\n其中下标 $int$ 表示对应于内部点的子向量。由于 $\\mathbf{u}$ 在边界处为零，线性项简化为 $\\nu \\tilde{D}^2 \\mathbf{u}_{int}$，其中 $\\tilde{D}^2$ 是 $D^2$ 中对应于内部点的 $(N-1) \\times (N-1)$ 子矩阵。\n\n### 3. 非线性项的离散化\n问题的核心是比较 $\\mathcal{N}(\\mathbf{u})$ 的三种形式：\n\n1.  **平流形式**：这是对 $u u_x$ 的直接离散化。令 $\\text{diag}(\\mathbf{u})$ 为对角线元素来自 $\\mathbf{u}$ 的对角矩阵。则，\n    $$\n    \\mathcal{N}_{\\text{adv}}(\\mathbf{u}) = \\text{diag}(\\mathbf{u}) (D \\mathbf{u})\n    $$\n2.  **守恒形式**：该形式源自守恒表达式 $u u_x = \\frac{1}{2} \\frac{\\partial}{\\partial x}(u^2)$。对其进行离散化得到：\n    $$\n    \\mathcal{N}_{\\text{cons}}(\\mathbf{u}) = \\frac{1}{2} D (\\mathbf{u} \\odot \\mathbf{u})\n    $$\n    其中 $\\odot$ 表示逐元素 (Hadamard) 乘积。\n3.  **斜对称形式**：这是平流形式和守恒形式的算术平均值：\n    $$\n    \\mathcal{N}_{\\text{skew}}(\\mathbf{u}) = \\frac{1}{2} \\left( \\mathcal{N}_{\\text{adv}}(\\mathbf{u}) + \\mathcal{N}_{\\text{cons}}(\\mathbf{u}) \\right) = \\frac{1}{2} \\left( \\text{diag}(\\mathbf{u}) (D \\mathbf{u}) + \\frac{1}{2} D (\\mathbf{u} \\odot \\mathbf{u}) \\right)\n    $$\n    这种形式旨在在离散层面上更好地保持某些积分不变量，如能量。\n\n### 4. 时间积分\n半离散系统具有形式 $\\frac{d\\mathbf{u}_{int}}{dt} = L(\\mathbf{u}_{int}) + N(\\mathbf{u}_{int})$，其中 $L(\\mathbf{u}_{int}) = \\nu \\tilde{D}^2 \\mathbf{u}_{int}$ 是线性扩散部分，$N(\\mathbf{u}_{int}) = -\\mathcal{N}(\\mathbf{u})_{int}$ 是非线性平流部分。我们使用二阶 Strang 分裂格式将解从时间 $t_n$ 推进到 $t_{n+1} = t_n + \\Delta t$：\n$$\n\\mathbf{u}_{int}^{n+1} \\approx \\Phi_L(\\Delta t/2) \\circ \\Phi_N(\\Delta t) \\circ \\Phi_L(\\Delta t/2) (\\mathbf{u}_{int}^n)\n$$\n-   线性流 $\\Phi_L(\\tau)$ 使用矩阵指数精确计算：$\\Phi_L(\\tau)(\\mathbf{v}) = \\exp(\\nu \\tilde{D}^2 \\tau) \\mathbf{v}$。\n-   非线性流 $\\Phi_N(\\Delta t)$ 通过经典的四阶 Runge-Kutta (RK4) 方法的一步来近似。对于一个常微分方程 $\\frac{d\\mathbf{v}}{dt} = N(\\mathbf{v})$，一个 RK4 步为：\n    $$\n    \\begin{align*}\n    \\mathbf{k}_1 = N(\\mathbf{v}^n) \\\\\n    \\mathbf{k}_2 = N(\\mathbf{v}^n + \\frac{\\Delta t}{2} \\mathbf{k}_1) \\\\\n    \\mathbf{k}_3 = N(\\mathbf{v}^n + \\frac{\\Delta t}{2} \\mathbf{k}_2) \\\\\n    \\mathbf{k}_4 = N(\\mathbf{v}^n + \\Delta t \\mathbf{k}_3) \\\\\n    \\mathbf{v}^{n+1} = \\mathbf{v}^n + \\frac{\\Delta t}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)\n    \\end{align*}\n    $$\n在 RK4 计算的每个中间阶段，都用零边界值重构完整的向量 $\\mathbf{u}$，以正确评估非线性项 $N(\\mathbf{u}_{int})$。\n\n### 5. 能量与单调性缺陷\n连续系统的能量 $E_{cont}(t) = \\frac{1}{2} \\int_{-1}^1 u(x,t)^2 dx$ 对于 $\\nu \\ge 0$ 是非增的。我们监控此性质的离散模拟。离散能量使用 Clenshaw-Curtis 求积计算：\n$$\nE(t) = \\frac{1}{2} \\sum_{j=0}^{N} w_j u(x_j, t)^2\n$$\n其中 $w_j$ 是对应于 CGL 节点 $x_j$ 的 Clenshaw-Curtis 求积权重。数值误差可能导致此离散能量在一个时间步内增加。能量单调性缺陷 $\\mathcal{D}$ 量化了整个模拟过程中的总伪能量增益：\n$$\n\\mathcal{D} = \\sum_{n=0}^{M-1} \\max(0, E^{n+1} - E^n)\n$$\n其中 $E^n$ 是在时间 $t_n = n\\Delta t$ 的离散能量，$M = \\lfloor T/\\Delta t \\rceil$ 是总时间步数。$\\mathcal{D}$ 的值越小，表示数值格式的能量行为越好。\n\n该实现将构建必要的矩阵和向量，遍历指定的测试用例，并对每个用例遍历三种非线性形式。在每个子情况下，它将执行时间积分并计算 $\\mathcal{D}$ 的最终值。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef chebyshev_cgl(N):\n    \"\"\"\n    Computes Chebyshev-Gauss-Lobatto nodes and differentiation matrix.\n    Uses the formulas from Trefethen, \"Spectral Methods in MATLAB\".\n    \"\"\"\n    if N == 0:\n        return np.array([0.0]), np.array([[0.0]])\n    \n    x = np.cos(np.pi * np.arange(N + 1) / N)\n    c = np.ones(N + 1)\n    c[0] = 2.0\n    c[N] = 2.0\n    c = c * (-1) ** np.arange(N + 1)\n    \n    X = np.tile(x, (N + 1, 1))\n    dX = X - X.T\n    \n    D = (c[:, None] * (1.0 / c)[None, :]) / (dX + np.eye(N + 1))\n    D = D - np.diag(np.sum(D, axis=1))\n    \n    return x, D\n\ndef clenshaw_curtis_weights(N):\n    \"\"\"\n    Computes Clenshaw-Curtis quadrature weights for CGL nodes.\n    Implementation based on the algorithm in 'clencurt.m' from Trefethen's book.\n    \"\"\"\n    if N == 0:\n        return np.array([2.0])\n    if N == 1:\n        return np.array([1.0, 1.0])\n\n    theta = np.pi * np.arange(N + 1) / N\n    w = np.zeros(N + 1)\n    ii = np.arange(1, N)\n    v = np.ones(N - 1)\n    \n    if N % 2 == 0:\n        w[0] = 1.0 / (N**2 - 1)\n        w[N] = w[0]\n        for k in range(1, N // 2):\n            v = v - 2 * np.cos(2 * k * theta[ii]) / (4 * k**2 - 1)\n        v = v - np.cos(N * theta[ii]) / (N**2 - 1)\n    else:\n        w[0] = 1.0 / N**2\n        w[N] = w[0]\n        for k in range(1, (N - 1) // 2 + 1):\n            v = v - 2 * np.cos(2 * k * theta[ii]) / (4 * k**2 - 1)\n            \n    w[ii] = 2 * v / N\n    return w\n\ndef solve():\n    \"\"\"\n    Main solver function for the 1D viscous Burgers' equation.\n    \"\"\"\n    test_cases = [\n        (64, 0.01, 1.0, 2e-4, 2e-2),\n        (32, 0.05, 1.0, 5e-4, 5e-2),\n        (128, 0.0, 0.5, 1e-4, 1e-2),\n    ]\n\n    results = []\n\n    for N, nu, A, dt, T in test_cases:\n        M = int(np.round(T / dt))\n        \n        # Spatial discretization\n        x, D = chebyshev_cgl(N)\n        D2 = D @ D\n        w = clenshaw_curtis_weights(N)\n        \n        # Slices for interior points\n        interior_indices = slice(1, N)\n        \n        # Initial condition\n        u_ic = A * np.sin(np.pi * x)\n        \n        # Enforce BCs on initial condition\n        u_ic[0] = 0.0\n        u_ic[N] = 0.0\n        \n        u_int_ic = u_ic[interior_indices]\n\n        # Time-stepping operator for linear part\n        if nu > 0:\n            D2_int = D2[interior_indices, interior_indices]\n            L_int = nu * D2_int\n            exp_L_half = expm(L_int * dt / 2.0)\n        else: # Inviscid case\n            exp_L_half = np.eye(N - 1)\n\n        def nonlinear_rhs(u_int_arg, form_type):\n            u_full = np.zeros(N + 1)\n            u_full[interior_indices] = u_int_arg\n            \n            if form_type == 'advective':\n                N_op = u_full * (D @ u_full)\n            elif form_type == 'conservative':\n                N_op = 0.5 * (D @ (u_full**2))\n            elif form_type == 'skew-symmetric':\n                N_adv = u_full * (D @ u_full)\n                N_cons = 0.5 * (D @ (u_full**2))\n                N_op = 0.5 * (N_adv + N_cons)\n            \n            return -N_op[interior_indices]\n\n        forms = ['advective', 'conservative', 'skew-symmetric']\n        \n        for form in forms:\n            u_int = u_int_ic.copy()\n            u_full = u_ic.copy()\n            \n            E_prev = 0.5 * np.sum(w * u_full**2)\n            D_total = 0.0\n\n            for _ in range(M):\n                # Strang Splitting step\n                # 1. Half diffusive step\n                u_int = exp_L_half @ u_int\n\n                # 2. Full nonlinear step (RK4)\n                k1 = nonlinear_rhs(u_int, form)\n                k2 = nonlinear_rhs(u_int + 0.5 * dt * k1, form)\n                k3 = nonlinear_rhs(u_int + 0.5 * dt * k2, form)\n                k4 = nonlinear_rhs(u_int + dt * k3, form)\n                u_int = u_int + (dt / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\n                # 3. Second half diffusive step\n                u_int = exp_L_half @ u_int\n\n                # Update full solution vector and calculate energy\n                u_full_new = np.zeros(N + 1)\n                u_full_new[interior_indices] = u_int\n                E_curr = 0.5 * np.sum(w * u_full_new**2)\n                \n                # Update energy monotonicity defect\n                D_total += max(0, E_curr - E_prev)\n                E_prev = E_curr\n\n            results.append(D_total)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}