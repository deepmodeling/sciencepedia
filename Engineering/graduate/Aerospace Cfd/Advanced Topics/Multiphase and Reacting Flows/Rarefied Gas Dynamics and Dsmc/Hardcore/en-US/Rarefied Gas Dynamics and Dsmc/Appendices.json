{
    "hands_on_practices": [
        {
            "introduction": "A key first step in any Direct Simulation Monte Carlo (DSMC) simulation is establishing the relationship between the vast number of real molecules and the manageable number of of computational particles. This exercise focuses on calculating the particle weight $W$, which defines this relationship, and understanding its implication for particle density within the simulation grid. Mastering this fundamental concept is essential for correctly setting up any DSMC problem. ",
            "id": "3309131",
            "problem": "A cubic domain of side length $L=1\\,\\mathrm{mm}$ is filled with a dilute gas of uniform number density $n=10^{20}\\,\\mathrm{m^{-3}}$. The gas is simulated using the Direct Simulation Monte Carlo (DSMC) method with $N_{\\mathrm{sim}}=10^{6}$ simulator particles under a uniform-weighting scheme, where each simulator particle represents the same number of physical molecules. Starting only from the definition of number density as physical number per unit volume and the DSMC representational premise that the total physical number equals the sum of simulator-particle weights, derive an expression for the simulator particle weight $W$ in terms of $n$, $L$, and $N_{\\mathrm{sim}}$, and compute its numerical value. Then, for a uniform Cartesian grid of $100^{3}$ equal-sized cells covering the domain, estimate the expected average number of simulator particles per cell under the stated uniformity assumptions and compute its numerical value. Express your final answer as a row matrix containing first $W$ and then the average number of simulator particles per cell. Provide exact values with no rounding and do not include units in the final answer.",
            "solution": "### Solution Derivation\nThe problem requires the derivation and calculation of two quantities: the simulator particle weight, $W$, and the expected average number of simulator particles per cell.\n\n**Part 1: Simulator Particle Weight $W$**\n\nThe solution begins from the definition of number density, $n$. The total number of physical gas molecules, $N_{\\mathrm{phys}}$, in a given volume $V$ is defined as:\n$$N_{\\mathrm{phys}} = n V$$\nThe simulation domain is a cube with side length $L$. Its volume $V$ is:\n$$V = L^3$$\nTherefore, the total number of physical molecules in the domain is:\n$$N_{\\mathrm{phys}} = n L^3$$\nBefore calculating the numerical value, we must ensure unit consistency. The side length is given as $L=1\\,\\mathrm{mm}$, which must be converted to meters to match the units of the number density $n$.\n$$L = 1\\,\\mathrm{mm} = 10^{-3}\\,\\mathrm{m}$$\nNow, we can compute the volume in SI units:\n$$V = (10^{-3}\\,\\mathrm{m})^3 = 10^{-9}\\,\\mathrm{m}^3$$\nUsing the given number density $n=10^{20}\\,\\mathrm{m^{-3}}$, the total number of physical molecules is:\n$$N_{\\mathrm{phys}} = (10^{20}\\,\\mathrm{m^{-3}}) \\times (10^{-9}\\,\\mathrm{m}^3) = 10^{11}$$\nThe problem states that the total number of physical molecules is also represented by the sum of the weights of all simulator particles. Since the weighting scheme is uniform, each of the $N_{\\mathrm{sim}}$ simulator particles has the same weight $W$. Thus, the total number of physical molecules can also be expressed as:\n$$N_{\\mathrm{phys}} = W \\times N_{\\mathrm{sim}}$$\nBy equating the two expressions for $N_{\\mathrm{phys}}$, we can derive an expression for the weight $W$:\n$$W N_{\\mathrm{sim}} = n L^3$$\nSolving for $W$ gives the desired symbolic expression:\n$$W = \\frac{n L^3}{N_{\\mathrm{sim}}}$$\nNow, we substitute the given numerical values to compute $W$. We have $n=10^{20}\\,\\mathrm{m^{-3}}$, $L=10^{-3}\\,\\mathrm{m}$, and $N_{\\mathrm{sim}}=10^{6}$.\n$$W = \\frac{10^{20} \\times (10^{-3})^3}{10^{6}} = \\frac{10^{20} \\times 10^{-9}}{10^{6}} = \\frac{10^{11}}{10^{6}} = 10^{5}$$\nThe weight $W=10^{5}$ is a dimensionless quantity representing the number of real gas molecules represented by a single simulator particle.\n\n**Part 2: Average Number of Simulator Particles per Cell**\n\nThe problem asks for the expected average number of simulator particles per cell. Let this quantity be denoted as $\\langle N_{p/c} \\rangle$.\nThe simulation domain is divided into a uniform Cartesian grid of $N_{\\mathrm{cells}}$ cells. The total number of cells is given as:\n$$N_{\\mathrm{cells}} = 100^{3} = (10^2)^3 = 10^6$$\nThe problem states that the gas has a uniform number density and is simulated using a uniform weighting scheme. This implies that the distribution of simulator particles is, on average, spatially uniform throughout the domain.\nTherefore, the expected average number of simulator particles per cell is simply the total number of simulator particles, $N_{\\mathrm{sim}}$, divided by the total number of cells, $N_{\\mathrm{cells}}$.\n$$\\langle N_{p/c} \\rangle = \\frac{N_{\\mathrm{sim}}}{N_{\\mathrm{cells}}}$$\nWe are given $N_{\\mathrm{sim}} = 10^{6}$ and we have calculated $N_{\\mathrm{cells}} = 10^{6}$. Substituting these values:\n$$\\langle N_{p/c} \\rangle = \\frac{10^{6}}{10^{6}} = 1$$\nThe expected average number of simulator particles per cell is $1$.\n\nThe final answer requires a row matrix containing the numerical value of $W$ followed by the numerical value of $\\langle N_{p/c} \\rangle$.\nThe first value is $W = 10^5$.\nThe second value is $\\langle N_{p/c} \\rangle = 1$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 10^{5}  1 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Gas-surface interactions are paramount in rarefied flows, governing phenomena like aerodynamic drag and heat transfer on spacecraft. This practice explores the widely used Maxwell reflection model, a probabilistic description of how molecules reflect from a solid surface. You will derive the velocity distribution for reflected particles and construct an estimator for wall shear stress, connecting the microscopic boundary condition to a macroscopic force. ",
            "id": "3977091",
            "problem": "A plane, stationary wall at $y=0$ bounds a rarefied, monatomic gas occupying $y0$. The gas is modeled with Direct Simulation Monte Carlo (DSMC) within Computational Fluid Dynamics (CFD). Far from the wall, the gas state is spatially uniform with number density $n$, temperature $T_{g}$, and a bulk drift velocity $U$ in the tangential $x$-direction. Molecules have mass $m$. The wall has temperature $T_{w}$ and enforces a Maxwell reflection boundary condition with accommodation coefficient $\\alpha \\in [0,1]$: with probability $\\alpha$, an incident molecule undergoes diffuse reflection to the wall state, and with probability $1-\\alpha$ it undergoes specular reflection.\n\nStarting from the kinetic-theory definitions of molecular fluxes and Maxwellian velocity distributions, perform the following:\n\n1. Derive the normalized probability density $p_{\\mathrm{diff}}(\\mathbf{v}')$ for the velocity $\\mathbf{v}'=(v'_{x},v'_{y},v'_{z})$ of a diffusely reflected molecule leaving the wall, restricted to $v'_{y}0$, suitable for sampling in DSMC. Assume the wall has zero tangential drift.\n\n2. For a realization over an area $A$ and time interval $\\Delta t$, define a Monte Carlo estimator $\\widehat{\\tau}_{x}$ of the tangential wall momentum exchange rate per unit area per unit time (shear stress along $x$) that uses the set of incident molecules that strike the wall in $(A,\\Delta t)$ and their reflected velocities generated by the Maxwell boundary condition with accommodation coefficient $\\alpha$. Your estimator should be unbiased under the stated model assumptions.\n\n3. Under the given uniform gas state (Maxwellian at temperature $T_{g}$ with tangential drift $U$), analytically evaluate the expectation of your estimator and express it in closed form as a function of $n$, $m$, $k_{B}$, $T_{g}$, $U$, and $\\alpha$.\n\nExpress the final expected shear stress in newtons per square meter. No rounding is required.",
            "solution": "### Part 1: Probability Density for Diffuse Reflection\n\nDiffuse reflection from a wall at temperature $T_w$ and zero tangential drift implies that reflected molecules are emitted with velocities sampled from a half-space Maxwellian distribution corresponding to a gas in thermal equilibrium at temperature $T_w$. The velocity distribution function for such a gas is given by\n$$\nf_{\\mathrm{eq}}(\\mathbf{v}') \\propto \\exp\\left(-\\frac{m|\\mathbf{v}'|^2}{2k_B T_w}\\right) = \\exp\\left(-\\frac{m(v_x'^2 + v_y'^2 + v_z'^2)}{2k_B T_w}\\right)\n$$\nwhere $\\mathbf{v}' = (v'_x, v'_y, v'_z)$ is the velocity of the reflected molecule and $m$ is the molecular mass.\n\nThe probability of a molecule with a given velocity $\\mathbf{v}'$ being emitted from the wall surface is proportional not just to the number of molecules having that velocity, but also to its normal velocity component $v'_y$, because molecules with higher normal velocity cross a given area per unit time more frequently. This is a fundamental concept of kinetic theory, often referred to as the cosine law for emission. Thus, the probability density function (PDF) for a diffusely reflected molecule, $p_{\\mathrm{diff}}(\\mathbf{v}')$, is proportional to the number flux $v'_y f_{\\mathrm{eq}}(\\mathbf{v}')$. The domain is restricted to molecules moving away from the wall, so $v'_y > 0$. The unnormalized PDF is:\n$$\np_{\\mathrm{unnorm}}(\\mathbf{v}') = C v'_y \\exp\\left(-\\frac{m(v_x'^2 + v_y'^2 + v_z'^2)}{2k_B T_w}\\right), \\quad \\text{for } v'_y > 0\n$$\nwhere $C$ is a normalization constant. To find $C$, we must enforce the condition that the integral of the PDF over all possible velocities is unity:\n$$\n\\int_{-\\infty}^{\\infty} dv'_x \\int_{0}^{\\infty} dv'_y \\int_{-\\infty}^{\\infty} dv'_z \\ p_{\\mathrm{diff}}(\\mathbf{v}') = 1\n$$\nLet's evaluate the integral of the unnormalized PDF:\n$$\n\\text{Integral} = C \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{m v_x'^2}{2k_B T_w}\\right) dv'_x \\int_{0}^{\\infty} v'_y \\exp\\left(-\\frac{m v_y'^2}{2k_B T_w}\\right) dv'_y \\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{m v_z'^2}{2k_B T_w}\\right) dv'_z\n$$\nThe integrals over $v'_x$ and $v'_z$ are standard Gaussian integrals:\n$$\n\\int_{-\\infty}^{\\infty} \\exp(-ax^2) dx = \\sqrt{\\frac{\\pi}{a}}\n$$\nHere, $a = \\frac{m}{2k_B T_w}$. So,\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{m v_x'^2}{2k_B T_w}\\right) dv'_x = \\sqrt{\\frac{2\\pi k_B T_w}{m}}\n$$\n$$\n\\int_{-\\infty}^{\\infty} \\exp\\left(-\\frac{m v_z'^2}{2k_B T_w}\\right) dv'_z = \\sqrt{\\frac{2\\pi k_B T_w}{m}}\n$$\nThe integral over $v'_y$ is:\n$$\n\\int_{0}^{\\infty} v'_y \\exp\\left(-\\frac{m v_y'^2}{2k_B T_w}\\right) dv'_y\n$$\nUsing the substitution $u = \\frac{m v_y'^2}{2k_B T_w}$, we have $du = \\frac{m v'_y}{k_B T_w} dv'_y$, or $v'_y dv'_y = \\frac{k_B T_w}{m} du$. The limits of integration become $0$ to $\\infty$.\n$$\n\\int_{0}^{\\infty} \\exp(-u) \\left(\\frac{k_B T_w}{m}\\right) du = \\frac{k_B T_w}{m} [-\\exp(-u)]_0^\\infty = \\frac{k_B T_w}{m} (0 - (-1)) = \\frac{k_B T_w}{m}\n$$\nCombining these results, the normalization integral is:\n$$\nC \\left(\\sqrt{\\frac{2\\pi k_B T_w}{m}}\\right) \\left(\\frac{k_B T_w}{m}\\right) \\left(\\sqrt{\\frac{2\\pi k_B T_w}{m}}\\right) = C \\left(\\frac{2\\pi k_B T_w}{m}\\right) \\left(\\frac{k_B T_w}{m}\\right) = C \\cdot 2\\pi \\left(\\frac{k_B T_w}{m}\\right)^2\n$$\nFor this to equal $1$, the normalization constant must be $C = \\frac{1}{2\\pi} \\left(\\frac{m}{k_B T_w}\\right)^2$.\nTherefore, the normalized probability density for a diffusely reflected molecule is:\n$$\np_{\\mathrm{diff}}(\\mathbf{v}') = \\frac{1}{2\\pi} \\left(\\frac{m}{k_B T_w}\\right)^2 v'_y \\exp\\left(-\\frac{m(v_x'^2 + v_y'^2 + v_z'^2)}{2k_B T_w}\\right), \\quad \\text{for } v'_y > 0 \\text{ and } \\mathbf{v}' \\in \\mathbb{R}^3\n$$\n\n### Part 2: Monte Carlo Estimator for Shear Stress\n\nThe tangential shear stress, $\\tau_x$, is the net rate of $x$-directed momentum transferred to the wall per unit area. For a single molecule with mass $m$, incident velocity $\\mathbf{v}$, and reflected velocity $\\mathbf{v}'$, the change in its $x$-momentum is $m(v'_x - v_x)$. By Newton's third law, the momentum transferred to the wall is the negative of this, which is $m(v_x - v'_x)$.\n\nThe Maxwell reflection model dictates the reflected velocity $\\mathbf{v}'$:\n1.  With probability $1-\\alpha$, the reflection is specular. The velocity components are preserved except for the normal one, which is reversed: $\\mathbf{v}'_{\\mathrm{spec}} = (v_x, -v_y, v_z)$. The momentum transfer to the wall is $m(v_x - v_{x, \\mathrm{spec}}') = m(v_x - v_x) = 0$.\n2.  With probability $\\alpha$, the reflection is diffuse. The reflected velocity $\\mathbf{v}'_{\\mathrm{diff}}$ is a random sample drawn from the distribution $p_{\\mathrm{diff}}(\\mathbf{v}')$ derived in Part 1. The momentum transfer to the wall is $m(v_x - v'_{x, \\mathrm{diff}})$.\n\nIn a DSMC simulation over a time interval $\\Delta t$ and wall area $A$, let $N_{\\mathrm{coll}}$ be the total number of molecules that strike the wall. The total $x$-momentum transferred to the wall is the sum of transfers from each collision:\n$$\n\\Delta P_x = \\sum_{i=1}^{N_{\\mathrm{coll}}} m(v_{x,i} - v'_{x,i})\n$$\nwhere $v_{x,i}$ is the incident tangential velocity of the $i$-th molecule and $v'_{x,i}$ is its reflected tangential velocity, determined by the probabilistic Maxwell model.\nThe Monte Carlo estimator for the shear stress, $\\widehat{\\tau}_x$, is the total momentum transferred divided by the area and time interval:\n$$\n\\widehat{\\tau}_x = \\frac{\\Delta P_x}{A \\Delta t} = \\frac{1}{A \\Delta t} \\sum_{i=1}^{N_{\\mathrm{coll}}} m(v_{x,i} - v'_{x,i})\n$$\nThis estimator is unbiased because it is a direct simulation of the physical definition of stress. It can be implemented by generating, for each incident molecule $i$, a random number to decide between specular and diffuse reflection, generating the corresponding $v'_{x,i}$, and summing the contributions.\n\n### Part 3: Expected Shear Stress\n\nTo find the expected value of the estimator, $E[\\widehat{\\tau}_x]$, we calculate the analytical shear stress $\\tau_x$ under the given conditions. The stress is the expected rate of momentum transfer per unit area. This can be found by integrating the momentum transfer for a single particle, weighted by the incident particle flux.\n\nThe incident particle flux with velocities in $d^3\\mathbf{v}$ is given by $|v_y| f_{\\mathrm{inc}}(\\mathbf{v}) d^3\\mathbf{v}$, where $f_{\\mathrm{inc}}(\\mathbf{v})$ is the velocity distribution function of the gas. The expected momentum transfer to the wall for a particle with incident velocity $\\mathbf{v}$ is $m(v_x - E[v'_x|\\mathbf{v}])$. The expectation of the reflected velocity $E[v'_x|\\mathbf{v}]$ is:\n$$\nE[v'_x|\\mathbf{v}] = (1-\\alpha)v'_{x,\\mathrm{spec}} + \\alpha E[v'_{x,\\mathrm{diff}}]\n$$\nFor specular reflection, $v'_{x,\\mathrm{spec}} = v_x$. For diffuse reflection, the reflected velocity is independent of the incident one. The distribution $p_{\\mathrm{diff}}$ is symmetric in $v'_x$ around $0$, so its expectation is $E[v'_{x,\\mathrm{diff}}] = \\int v'_x p_{\\mathrm{diff}}(\\mathbf{v}')d^3\\mathbf{v}' = 0$.\nThus, $E[v'_x|\\mathbf{v}] = (1-\\alpha)v_x$. The expected momentum transfer for a particle with incident velocity $\\mathbf{v}$ is $m(v_x - (1-\\alpha)v_x) = \\alpha m v_x$.\n\nThe total shear stress is the integral of this expected transfer over all incident velocities ($v_y  0$):\n$$\n\\tau_x = E[\\widehat{\\tau}_x] = \\int_{v_y0} (\\alpha m v_x) |v_y| f_{\\mathrm{inc}}(\\mathbf{v}) d^3\\mathbf{v}\n$$\nSince $v_y  0$ for incident molecules, $|v_y| = -v_y$.\nThe gas far from the wall is in a drifting Maxwellian state at number density $n$, temperature $T_g$, and drift velocity $\\mathbf{U} = (U,0,0)$. The distribution function is:\n$$\nf_{\\mathrm{inc}}(\\mathbf{v}) = n \\left(\\frac{m}{2\\pi k_B T_g}\\right)^{3/2} \\exp\\left(-\\frac{m((v_x-U)^2 + v_y^2 + v_z^2)}{2k_B T_g}\\right)\n$$\nSubstituting this into the integral for $\\tau_x$:\n$$\n\\tau_x = -\\alpha m \\int_{-\\infty}^{\\infty} dv_x \\int_{-\\infty}^{0} dv_y \\int_{-\\infty}^{\\infty} dv_z \\ v_x v_y f_{\\mathrm{inc}}(\\mathbf{v})\n$$\n$$\n\\tau_x = -\\alpha m n \\left(\\frac{m}{2\\pi k_B T_g}\\right)^{3/2} \\left[ \\int_{-\\infty}^{\\infty} v_x e^{-\\frac{m(v_x-U)^2}{2k_B T_g}} dv_x \\right] \\left[ \\int_{-\\infty}^{0} v_y e^{-\\frac{m v_y^2}{2k_B T_g}} dv_y \\right] \\left[ \\int_{-\\infty}^{\\infty} e^{-\\frac{m v_z^2}{2k_B T_g}} dv_z \\right]\n$$\nLet's evaluate the three integrals:\n1.  The $v_z$ integral: This is a standard Gaussian integral, $\\sqrt{\\frac{2\\pi k_B T_g}{m}}$.\n2.  The $v_y$ integral: $\\int_{-\\infty}^{0} v_y e^{-\\frac{m v_y^2}{2k_B T_g}} dv_y$. With substitution $u = \\frac{m v_y^2}{2k_B T_g}$, this evaluates to $-\\frac{k_B T_g}{m}$.\n3.  The $v_x$ integral: $\\int_{-\\infty}^{\\infty} v_x e^{-\\frac{m(v_x-U)^2}{2k_B T_g}} dv_x$. Let $w = v_x-U$, then $v_x=w+U$ and $dv_x=dw$.\n    $$\n    \\int_{-\\infty}^{\\infty} (w+U) e^{-\\frac{m w^2}{2k_B T_g}} dw = \\int_{-\\infty}^{\\infty} w e^{-\\frac{m w^2}{2k_B T_g}} dw + U \\int_{-\\infty}^{\\infty} e^{-\\frac{m w^2}{2k_B T_g}} dw\n    $$\n    The first term is an integral of an odd function over a symmetric domain, which is $0$. The second term is $U$ times a Gaussian integral. The result is $U \\sqrt{\\frac{2\\pi k_B T_g}{m}}$.\n\nNow, we multiply all parts together:\n$$\n\\tau_x = -\\alpha m n \\left(\\frac{m}{2\\pi k_B T_g}\\right)^{3/2} \\left(U \\sqrt{\\frac{2\\pi k_B T_g}{m}}\\right) \\left(-\\frac{k_B T_g}{m}\\right) \\left(\\sqrt{\\frac{2\\pi k_B T_g}{m}}\\right)\n$$\n$$\n\\tau_x = \\alpha m n \\left(\\frac{m}{2\\pi k_B T_g}\\right)^{3/2} U \\left(\\frac{2\\pi k_B T_g}{m}\\right) \\left(\\frac{k_B T_g}{m}\\right)\n$$\n$$\n\\tau_x = \\alpha n U k_B T_g \\left(\\frac{m}{2\\pi k_B T_g}\\right)^{1/2}\n$$\n$$\n\\tau_x = \\alpha n U \\sqrt{\\frac{m(k_B T_g)^2}{2\\pi k_B T_g}} = \\alpha n U \\sqrt{\\frac{m k_B T_g}{2\\pi}}\n$$\nThe units are consistent with stress (newtons per square meter, or Pascals).",
            "answer": "$$\n\\boxed{\\alpha n U \\sqrt{\\frac{m k_B T_g}{2\\pi}}}\n$$"
        },
        {
            "introduction": "A DSMC simulation's output is fundamentally a collection of particle data, from which we must extract meaningful macroscopic properties. This practice focuses on computing the pressure tensor $\\mathbf{P}$, a key quantity in fluid mechanics, directly from the peculiar velocities of simulated particles. Through this computational exercise, you will not only implement the kinetic theory definition of stress but also learn to identify non-Newtonian behavior, a hallmark of rarefied flows, by calculating normal stress differences. ",
            "id": "3988872",
            "problem": "You are given a single-cell Direct Simulation Monte Carlo (DSMC) setup intended to estimate the stress tensor of a rarefied gas from particle velocity samples and to quantify non-Newtonian effects via normal stress differences. The task is to implement a complete program that, for several specified test cases, generates particle velocities from prescribed Gaussian velocity distributions, computes the pressure tensor using kinetic theory definitions, and outputs a dimensionless measure of non-Newtonian behavior.\n\nStart from the kinetic theory definition: given a distribution function $f(\\mathbf{x},\\mathbf{v},t)$ and the peculiar velocity $\\mathbf{c} = \\mathbf{v} - \\mathbf{u}$, the pressure tensor (also called the stress tensor in kinetic theory) is defined as\n$$\n\\mathbf{P}(\\mathbf{x},t) = \\int m\\,\\mathbf{c}\\,\\mathbf{c}^{\\top}\\,f(\\mathbf{x},\\mathbf{v},t)\\,\\mathrm{d}\\mathbf{v},\n$$\nwhere $m$ is the molecular mass and $\\mathbf{u}$ is the bulk velocity. In DSMC, this cell-wise integral is estimated by summation over the particles in the cell. For a cell of volume $V$, with $N$ simulated particles having velocities $\\{\\mathbf{v}_k\\}_{k=1}^N$, compute the sample bulk velocity\n$$\n\\hat{\\mathbf{u}} = \\frac{1}{N}\\sum_{k=1}^N \\mathbf{v}_k,\n$$\nthe peculiar velocities $\\mathbf{c}_k = \\mathbf{v}_k - \\hat{\\mathbf{u}}$, and the pressure tensor estimator\n$$\n\\mathbf{P} = \\frac{m}{V}\\sum_{k=1}^N \\mathbf{c}_k \\mathbf{c}_k^{\\top}.\n$$\nFrom $\\mathbf{P}$, compute the isotropic pressure\n$$\np = \\frac{1}{3}\\,\\mathrm{tr}(\\mathbf{P}),\n$$\nand the first normal stress difference\n$$\nN_1 = P_{xx} - P_{yy}.\n$$\nFor a Newtonian fluid in the continuum limit governed by the Navierâ€“Stokes constitutive law, the normal stress differences vanish in simple shear. In rarefied gases, finite Knudsen number effects alter the velocity distribution away from local isotropy, and $N_1 \\neq 0$ can arise; a dimensionless indicator of non-Newtonian behavior is the ratio $N_1/p$.\n\nYour program must:\n- For each test case listed below, generate $N$ particle velocities $\\mathbf{v}_k$ in $\\mathrm{m/s}$ from a multivariate normal distribution with mean $\\mathbf{u}$ and covariance $\\Sigma$ specified by the given parameters. Use the provided random seeds for reproducibility. All quantities must use the following units: mass in $\\mathrm{kg}$, volume in $\\mathrm{m}^3$, velocity in $\\mathrm{m/s}$, and stress/pressure in $\\mathrm{Pa}$.\n- Compute $\\hat{\\mathbf{u}}$, $\\mathbf{c}_k$, $\\mathbf{P}$, $p$, and $N_1$.\n- Output the dimensionless ratios $N_1/p$ for all test cases as a single line containing a comma-separated Python-style list (e.g., \"[result1,result2,result3]\").\n\nConstruct the covariance matrix $\\Sigma$ from the supplied parameters $(\\sigma_x,\\sigma_y,\\sigma_z,\\alpha)$ as follows:\n- The diagonal entries are $\\Sigma_{xx} = \\sigma_x^2$, $\\Sigma_{yy} = \\sigma_y^2$, $\\Sigma_{zz} = \\sigma_z^2$.\n- The off-diagonal entry $\\Sigma_{xy} = \\alpha\\,\\sigma_x\\,\\sigma_y$, with $\\Sigma_{yx} = \\Sigma_{xy}$.\n- All other off-diagonal entries are zero.\n\nTest Suite (use exactly these values):\n1. Case A (near-isotropic, happy path):\n   - Random seed: $123$\n   - Number of particles: $N = 5000$\n   - Molecular mass: $m = 4.65\\times 10^{-26}\\,\\mathrm{kg}$\n   - Cell volume: $V = 1.0\\times 10^{-17}\\,\\mathrm{m^3}$\n   - Mean velocity: $\\mathbf{u} = [50,\\,0,\\,0]\\,\\mathrm{m/s}$\n   - Covariance parameters: $\\sigma_x = 300\\,\\mathrm{m/s}$, $\\sigma_y = 300\\,\\mathrm{m/s}$, $\\sigma_z = 300\\,\\mathrm{m/s}$, $\\alpha = 0$\n2. Case B (anisotropic with positive correlation, non-Newtonian signature):\n   - Random seed: $456$\n   - Number of particles: $N = 5000$\n   - Molecular mass: $m = 4.65\\times 10^{-26}\\,\\mathrm{kg}$\n   - Cell volume: $V = 1.0\\times 10^{-17}\\,\\mathrm{m^3}$\n   - Mean velocity: $\\mathbf{u} = [0,\\,0,\\,0]\\,\\mathrm{m/s}$\n   - Covariance parameters: $\\sigma_x = 350\\,\\mathrm{m/s}$, $\\sigma_y = 250\\,\\mathrm{m/s}$, $\\sigma_z = 300\\,\\mathrm{m/s}$, $\\alpha = 0.2$\n3. Case C (small sample, negative correlation, edge case):\n   - Random seed: $789$\n   - Number of particles: $N = 20$\n   - Molecular mass: $m = 4.65\\times 10^{-26}\\,\\mathrm{kg}$\n   - Cell volume: $V = 1.0\\times 10^{-17}\\,\\mathrm{m^3}$\n   - Mean velocity: $\\mathbf{u} = [0,\\,0,\\,0]\\,\\mathrm{m/s}$\n   - Covariance parameters: $\\sigma_x = 400\\,\\mathrm{m/s}$, $\\sigma_y = 200\\,\\mathrm{m/s}$, $\\sigma_z = 300\\,\\mathrm{m/s}$, $\\alpha = -0.3$\n\nFinal output format:\n- Your program should produce a single line of output containing the three dimensionless ratios $N_1/p$ for Cases A, B, and C, as a comma-separated list enclosed in square brackets, e.g., \"[xA,xB,xC]\". Each entry must be a real number (a float). No other text should be printed.",
            "solution": "The problem is valid as it is scientifically grounded in the kinetic theory of gases and the Direct Simulation Monte Carlo (DSMC) method, possessing a well-posed, objective, and complete definition. The procedure to solve this problem involves a direct application of the provided formulae to numerically generated data. The solution is designed around a step-by-step calculation for each test case, from generating microscopic particle data to computing macroscopic stress properties.\n\nThe primary objective is to compute the dimensionless ratio $N_1/p$, which serves as an indicator of non-Newtonian fluid behavior, for three distinct cases of a rarefied gas in a single simulation cell. The entire computational process relies on the principles of statistical mechanics, where macroscopic quantities are derived from the average behavior of a large ensemble of microscopic particles.\n\nThe first step is to model the state of the gas by generating a statistical ensemble of particles. The problem specifies that the velocities $\\{\\mathbf{v}_k\\}_{k=1}^N$ of the $N$ particles are drawn from a $3$-dimensional multivariate normal (Gaussian) distribution, $\\mathcal{N}(\\mathbf{u}, \\Sigma)$. Here, $\\mathbf{u}$ is the mean velocity of the distribution, representing the macroscopic bulk velocity of the gas, and $\\Sigma$ is the $3 \\times 3$ covariance matrix, which describes the thermal spread and correlation of the velocity components. For each test case, a specific set of parameters $(\\sigma_x, \\sigma_y, \\sigma_z, \\alpha)$ is given to construct the covariance matrix $\\Sigma$ as follows:\n$$\n\\Sigma =\n\\begin{pmatrix}\n\\sigma_x^2  \\alpha \\sigma_x \\sigma_y  0 \\\\\n\\alpha \\sigma_x \\sigma_y  \\sigma_y^2  0 \\\\\n0  0  \\sigma_z^2\n\\end{pmatrix}\n$$\nThe diagonal elements $\\Sigma_{xx} = \\sigma_x^2$, $\\Sigma_{yy} = \\sigma_y^2$, and $\\Sigma_{zz} = \\sigma_z^2$ represent the variance (proportional to temperature) in each spatial direction. The off-diagonal term $\\Sigma_{xy} = \\alpha \\sigma_x \\sigma_y$ introduces a correlation between the $v_x$ and $v_y$ velocity components, which is crucial for modeling shear effects. For reproducibility, a specific random seed is used to initialize the pseudo-random number generator for each case, ensuring that the same set of $N$ velocity vectors $\\mathbf{v}_k$ is generated for a given case.\n\nOnce the particle velocities $\\{\\mathbf{v}_k\\}$ are generated, the next step is to compute the macroscopic properties of the gas. The sample bulk velocity $\\hat{\\mathbf{u}}$ is calculated as the arithmetic mean of the individual particle velocities:\n$$\n\\hat{\\mathbf{u}} = \\frac{1}{N}\\sum_{k=1}^N \\mathbf{v}_k\n$$\nThis $\\hat{\\mathbf{u}}$ is a statistical estimator of the true mean velocity $\\mathbf{u}$ of the distribution. Due to the finite sample size $N$, $\\hat{\\mathbf{u}}$ will generally not be exactly equal to $\\mathbf{u}$.\n\nWith the sample bulk velocity determined, we compute the peculiar velocity $\\mathbf{c}_k$ for each particle by subtracting the sample bulk flow velocity from the particle's absolute velocity:\n$$\n\\mathbf{c}_k = \\mathbf{v}_k - \\hat{\\mathbf{u}}\n$$\nThe peculiar velocity represents the random thermal motion of a particle relative to the coherent motion of the gas. It is these random motions that give rise to pressure and stress.\n\nThe central quantity is the pressure tensor $\\mathbf{P}$, which is estimated from the particle data using the formula from kinetic theory adapted for a discrete set of particles in a cell of volume $V$:\n$$\n\\mathbf{P} = \\frac{m}{V}\\sum_{k=1}^N \\mathbf{c}_k \\mathbf{c}_k^{\\top}\n$$\nHere, $m$ is the mass of a single molecule. The term $\\mathbf{c}_k \\mathbf{c}_k^{\\top}$ is the outer product of the peculiar velocity vector with itself, which yields a $3 \\times 3$ matrix. This operation is summed over all $N$ particles in the cell and scaled by the factor $m/V$. The resulting tensor $\\mathbf{P}$ contains the normal stresses on its diagonal ($P_{xx}, P_{yy}, P_{zz}$) and the shear stresses on its off-diagonal elements ($P_{xy}, P_{xz}, \\dots$). Computationally, the summation $\\sum_{k=1}^N \\mathbf{c}_k \\mathbf{c}_k^{\\top}$ is performed efficiently using a matrix multiplication $C^{\\top}C$, where $C$ is the $N \\times 3$ matrix whose rows are the peculiar velocity vectors $\\mathbf{c}_k^{\\top}$.\n\nFrom the pressure tensor $\\mathbf{P}$, we derive the final quantities of interest. The isotropic pressure, $p$, is the average of the normal stresses and is given by one-third of the trace of the pressure tensor:\n$$\np = \\frac{1}{3}\\,\\mathrm{tr}(\\mathbf{P}) = \\frac{1}{3}(P_{xx} + P_{yy} + P_{zz})\n$$\nThe first normal stress difference, $N_1$, is defined as the difference between the normal stresses in the $x$ and $y$ directions:\n$$\nN_1 = P_{xx} - P_{yy}\n$$\nFor a Newtonian fluid in simple shear flow, $N_1$ would be zero. A non-zero $N_1$ is a key signature of non-Newtonian effects, which are prominent in rarefied gas flows where the velocity distribution function can be significantly anisotropic.\n\nFinally, the dimensionless indicator of this non-Newtonian behavior is calculated as the ratio of the first normal stress difference to the isotropic pressure, $N_1/p$. This ratio is computed for each of the three test cases, and the results are compiled into a single list for output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the DSMC stress tensor estimation for all test cases.\n    \"\"\"\n\n    def calculate_n1_ratio(case_params):\n        \"\"\"\n        Calculates the non-Newtonian stress ratio N1/p for a single test case.\n\n        Args:\n            case_params (tuple): A tuple containing all parameters for the case:\n                (seed, N, m, V, u_mean, sigma_x, sigma_y, sigma_z, alpha).\n\n        Returns:\n            float: The calculated dimensionless ratio N1/p.\n        \"\"\"\n        # Step 1: Unpack parameters and initialize the random number generator\n        seed, N, m, V, u_mean, sigma_x, sigma_y, sigma_z, alpha = case_params\n        rng = np.random.default_rng(seed)\n\n        # Step 2: Construct the covariance matrix\n        cov_matrix = np.array([\n            [sigma_x**2,                alpha * sigma_x * sigma_y, 0.0],\n            [alpha * sigma_x * sigma_y, sigma_y**2,                0.0],\n            [0.0,                       0.0,                       sigma_z**2]\n        ])\n\n        # Step 3: Generate N particle velocities from the multivariate normal distribution\n        # velocities is an (N, 3) shaped array.\n        velocities = rng.multivariate_normal(mean=u_mean, cov=cov_matrix, size=N)\n\n        # Step 4: Compute the sample bulk velocity (u_hat)\n        # u_hat is a (3,) shaped array.\n        u_hat = np.mean(velocities, axis=0)\n\n        # Step 5: Compute peculiar velocities (c_k)\n        # peculiar_velocities is an (N, 3) shaped array.\n        peculiar_velocities = velocities - u_hat\n\n        # Step 6: Compute the pressure tensor (P)\n        # The summation of outer products sum(c_k * c_k^T) is efficiently\n        # calculated as C^T @ C, where C is the matrix of peculiar velocities.\n        # peculiar_velocities.T is (3, N), peculiar_velocities is (N, 3).\n        # The result is a (3, 3) matrix.\n        sum_of_outer_products = peculiar_velocities.T @ peculiar_velocities\n        pressure_tensor = (m / V) * sum_of_outer_products\n\n        # Step 7: Compute the isotropic pressure (p)\n        # p is one-third of the trace of the pressure tensor.\n        isotropic_pressure = (1.0 / 3.0) * np.trace(pressure_tensor)\n\n        # A physical system should have positive pressure. If it's zero,\n        # N1 will also be zero, so the ratio is well-defined as 0.\n        if isotropic_pressure == 0.0:\n            return 0.0\n\n        # Step 8: Compute the first normal stress difference (N1)\n        # N1 = P_xx - P_yy\n        n1 = pressure_tensor[0, 0] - pressure_tensor[1, 1]\n\n        # Step 9: Compute and return the dimensionless ratio N1/p\n        ratio = n1 / isotropic_pressure\n        return ratio\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains: (seed, N, m, V, u, sx, sy, sz, alpha)\n    test_cases = [\n        # Case A: near-isotropic, happy path\n        (123, 5000, 4.65e-26, 1.0e-17, np.array([50.0, 0.0, 0.0]), 300.0, 300.0, 300.0, 0.0),\n\n        # Case B: anisotropic with positive correlation\n        (456, 5000, 4.65e-26, 1.0e-17, np.array([0.0, 0.0, 0.0]), 350.0, 250.0, 300.0, 0.2),\n\n        # Case C: small sample, negative correlation\n        (789, 20, 4.65e-26, 1.0e-17, np.array([0.0, 0.0, 0.0]), 400.0, 200.0, 300.0, -0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_n1_ratio(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}