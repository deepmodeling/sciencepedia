{
    "hands_on_practices": [
        {
            "introduction": "在计算流体力学中，隐式方法的核心在于求解非线性残差方程。本练习旨在建立一个基础性的理解，即如何从守恒定律的有限体积离散化出发，推导出残差向量的具体形式。通过对一个均匀流场进行线性化 ，你将亲手构造出雅可比矩阵的基本构件，并验证离散守恒等基本性质。",
            "id": "3973376",
            "problem": "考虑一维空间中的可压缩欧拉方程，用于比热比为 $\\gamma$ 的理想气体。令守恒状态向量为 $U = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$，其中 $\\rho$ 是密度，$u$ 是速度，$E$ 是比总能。压力由理想气体关系式 $p = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\rho u^{2}\\right)$ 给出。物理通量函数为 $F(U) = \\left(\\rho u, \\rho u^{2} + p, u(\\rho E + p)\\right)^{\\mathsf{T}}$。在一个由索引 $i$ 标记、间距为 $\\Delta x$ 的均匀网格上，定义单元 $i$ 的半离散有限体积残差为 $R_{i}(U) = \\frac{1}{\\Delta x}\\left(\\hat{F}_{i+\\tfrac{1}{2}} - \\hat{F}_{i-\\tfrac{1}{2}}\\right)$，其中 $\\hat{F}_{i+\\tfrac{1}{2}}$ 是根据界面 $i+\\tfrac{1}{2}$ 处的左右状态计算得到的一致性数值通量。使用欧拉方程的局部Lax–Friedrichs (LLF) 迎风数值通量，该通量为具有左状态 $U_{L}$ 和右状态 $U_{R}$ 的界面定义为\n$$\n\\hat{F}(U_{L}, U_{R}) = \\frac{1}{2}\\left(F(U_{L}) + F(U_{R})\\right) - \\frac{1}{2}\\alpha(U_{L}, U_{R})\\left(U_{R} - U_{L}\\right),\n$$\n其中 $\\alpha(U_{L}, U_{R})$ 是在 $(U_{L}, U_{R})$ 处计算的通量雅可比矩阵谱半径的任意上界，例如 $\\alpha(U_{L}, U_{R}) = \\max\\left(|u_{L}| + a_{L}, |u_{R}| + a_{R}\\right)$，其中声速 $a = \\sqrt{\\gamma p / \\rho}$。\n\n任务：\n- 从守恒形式和 LLF 通量定义出发，将均匀网格上的 $R_{i}(U)$ 显式地用 $(U_{i-1}, U_{i}, U_{i+1})$、$F(\\cdot)$ 和 $\\alpha(\\cdot,\\cdot)$ 表示。\n- 对 $R_{i}(U)$ 在均匀常态 $U^{\\ast}$（即对于所有 $j$，$U_{j} \\equiv U^{\\ast}$）附近进行一阶线性化，假设耗散系数冻结在其常数值 $\\alpha^{\\ast} = \\alpha(U^{\\ast}, U^{\\ast})$。将 $U^{\\ast}$ 处的物理通量雅可比矩阵记为 $A^{\\ast} = \\partial F/\\partial U \\big|_{U^{\\ast}}$。推导块三对角雅可比贡献 $\\partial R_{i}/\\partial U_{i-1}$、$\\partial R_{i}/\\partial U_{i}$ 和 $\\partial R_{i}/\\partial U_{i+1}$，用 $A^{\\ast}$、$\\alpha^{\\ast}$ 和 $\\Delta x$ 表示，并验证常数扰动的离散守恒性质。\n- 计算均匀常态 $U^{\\ast}$ 下的 $R_{i}(U^{\\ast})$，并使用 $\\mathrm{pmatrix}$ 环境将结果表示为单个 3 分量行矩阵。\n\n无需进行数值代入。此问题属于计算流体力学（CFD）实践范畴，旨在将守恒律与非线性残差的线性化联系起来。你的最终答案必须是按要求符号化表示的已计算残差向量 $R_{i}(U^{\\ast})$，不带单位。",
            "solution": "该问题提出了关于一维可压缩欧拉方程的半离散有限体积残差的三个任务。我们将依次解决每个任务。\n\n**任务1：残差 $R_i(U)$ 的显式形式**\n\n在间距为 $\\Delta x$ 的均匀网格上，索引为 $i$ 的单元的半离散残差定义为：\n$$\nR_{i}(U) = \\frac{1}{\\Delta x}\\left(\\hat{F}_{i+\\tfrac{1}{2}} - \\hat{F}_{i-\\tfrac{1}{2}}\\right)\n$$\n对于一阶空间格式，单元 $i$ 和 $i+1$ 之间界面 $i+\\frac{1}{2}$ 处的数值通量 $\\hat{F}_{i+\\frac{1}{2}}$ 是单元平均状态 $U_i$ 和 $U_{i+1}$ 的函数。类似地，单元 $i-1$ 和 $i$ 之间界面 $i-\\frac{1}{2}$ 处的通量 $\\hat{F}_{i-\\frac{1}{2}}$ 是 $U_{i-1}$ 和 $U_i$ 的函数。\n\n所提供的局部 Lax–Friedrichs (LLF) 数值通量定义为：\n$$\n\\hat{F}(U_{L}, U_{R}) = \\frac{1}{2}\\left(F(U_{L}) + F(U_{R})\\right) - \\frac{1}{2}\\alpha(U_{L}, U_{R})\\left(U_{R} - U_{L}\\right)\n$$\n其中 $F(\\cdot)$ 是物理通量函数，$\\alpha(\\cdot, \\cdot)$ 是耗散系数。\n\n对于界面 $i+\\frac{1}{2}$，左右状态分别为 $U_L = U_i$ 和 $U_R = U_{i+1}$。相应的数值通量为：\n$$\n\\hat{F}_{i+\\tfrac{1}{2}} = \\hat{F}(U_i, U_{i+1}) = \\frac{1}{2}\\left(F(U_i) + F(U_{i+1})\\right) - \\frac{1}{2}\\alpha(U_i, U_{i+1})\\left(U_{i+1} - U_i\\right)\n$$\n对于界面 $i-\\frac{1}{2}$，左右状态分别为 $U_L = U_{i-1}$ 和 $U_R = U_i$。相应的数值通量为：\n$$\n\\hat{F}_{i-\\tfrac{1}{2}} = \\hat{F}(U_{i-1}, U_i) = \\frac{1}{2}\\left(F(U_{i-1}) + F(U_i)\\right) - \\frac{1}{2}\\alpha(U_{i-1}, U_i)\\left(U_i - U_{i-1}\\right)\n$$\n将这些表达式代入残差 $R_i(U)$ 的定义中，我们得到其作为三单元模板 $(U_{i-1}, U_i, U_{i+1})$ 中状态的函数的显式形式：\n$$\nR_{i}(U) = \\frac{1}{\\Delta x} \\left[ \\left(\\frac{1}{2}\\left(F(U_i) + F(U_{i+1})\\right) - \\frac{1}{2}\\alpha(U_i, U_{i+1})\\left(U_{i+1} - U_i\\right)\\right) - \\left(\\frac{1}{2}\\left(F(U_{i-1}) + F(U_i)\\right) - \\frac{1}{2}\\alpha(U_{i-1}, U_i)\\left(U_i - U_{i-1}\\right)\\right) \\right]\n$$\n通过合并同类项可以简化此表达式：\n$$\nR_{i}(U) = \\frac{F(U_{i+1}) - F(U_{i-1})}{2\\Delta x} - \\frac{1}{2\\Delta x} \\left[ \\alpha(U_i, U_{i+1})\\left(U_{i+1} - U_i\\right) - \\alpha(U_{i-1}, U_i)\\left(U_i - U_{i-1}\\right) \\right]\n$$\n\n**任务2：$R_i(U)$ 的线性化与守恒性验证**\n\n现在我们对 $R_i(U)$ 在均匀常态 $U^*$（其中对所有单元索引 $j$，$U_j \\equiv U^*$）附近进行线性化。问题指定耗散系数 $\\alpha$ 在此均匀状态下应“冻结”于其常数值：$\\alpha(U_L, U_R) \\approx \\alpha(U^*, U^*) \\equiv \\alpha^*$。这意味着不考虑 $\\alpha$ 的导数。令 $A^* = \\frac{\\partial F}{\\partial U}\\big|_{U^*}$ 为状态 $U^*$ 处的物理通量雅可比矩阵。\n\n在冻结系数近似下，残差表达式简化为：\n$$\nR_{i}(U) \\approx \\frac{1}{2\\Delta x} \\left[ F(U_{i+1}) - F(U_{i-1}) - \\alpha^*\\left((U_{i+1} - U_i) - (U_i - U_{i-1})\\right) \\right]\n$$\n$$\nR_{i}(U) \\approx \\frac{1}{2\\Delta x} \\left[ F(U_{i+1}) - F(U_{i-1}) - \\alpha^*\\left(U_{i+1} - 2U_i + U_{i-1}\\right) \\right]\n$$\n我们计算 $R_i$ 关于 $U_{i-1}$、$U_i$ 和 $U_{i+1}$ 的偏导数。为了求导，我们使用恒等式 $\\frac{\\partial F(U_j)}{\\partial U_k}\\big|_{U^*} = \\delta_{jk} A^*$，其中 $\\delta_{jk}$ 是克罗内克 δ。\n\n来自 $U_{i-1}$ 的雅可比贡献为：\n$$\n\\frac{\\partial R_i}{\\partial U_{i-1}}\\bigg|_{U^*} = \\frac{1}{2\\Delta x} \\left[ -\\frac{\\partial F(U_{i-1})}{\\partial U_{i-1}}\\bigg|_{U^*} - \\alpha^*(1) \\frac{\\partial U_{i-1}}{\\partial U_{i-1}}\\bigg|_{U^*} \\right] = \\frac{1}{2\\Delta x} \\left[ -A^* - \\alpha^* I \\right]\n$$\n其中 $I$ 是 $3 \\times 3$ 单位矩阵。\n\n来自 $U_{i+1}$ 的雅可比贡献为：\n$$\n\\frac{\\partial R_i}{\\partial U_{i+1}}\\bigg|_{U^*} = \\frac{1}{2\\Delta x} \\left[ \\frac{\\partial F(U_{i+1})}{\\partial U_{i+1}}\\bigg|_{U^*} - \\alpha^* (1) \\frac{\\partial U_{i+1}}{\\partial U_{i+1}}\\bigg|_{U^*} \\right] = \\frac{1}{2\\Delta x} \\left[ A^* - \\alpha^* I \\right]\n$$\n来自 $U_{i}$ 的雅可比贡献为：\n$$\n\\frac{\\partial R_i}{\\partial U_{i}}\\bigg|_{U^*} = \\frac{1}{2\\Delta x} \\left[ - \\alpha^*(-2) \\frac{\\partial U_i}{\\partial U_i}\\bigg|_{U^*} \\right] = \\frac{1}{2\\Delta x} \\left[ 2\\alpha^* I \\right] = \\frac{\\alpha^*}{\\Delta x} I\n$$\n为验证常数扰动的离散守恒性质，我们将单元 $i$ 在其模板上的雅可比贡献相加：\n$$\n\\sum_{j} \\frac{\\partial R_i}{\\partial U_j} = \\frac{\\partial R_i}{\\partial U_{i-1}} + \\frac{\\partial R_i}{\\partial U_i} + \\frac{\\partial R_i}{\\partial U_{i+1}}\n$$\n$$\n= \\frac{1}{2\\Delta x} \\left( -A^* - \\alpha^* I \\right) + \\frac{\\alpha^*}{\\Delta x} I + \\frac{1}{2\\Delta x} \\left( A^* - \\alpha^* I \\right)\n$$\n$$\n= \\frac{1}{2\\Delta x} \\left[ -A^* - \\alpha^* I + 2\\alpha^* I + A^* - \\alpha^* I \\right]\n$$\n$$\n= \\frac{1}{2\\Delta x} \\left[ (-A^* + A^*) + (-\\alpha^* + 2\\alpha^* - \\alpha^*)I \\right] = 0\n$$\n和为零矩阵，这证实了离散守恒性质。\n\n**任务3：$R_i(U^*)$ 的计算**\n\n最后，我们计算均匀常态 $U^*$ 下的残差 $R_i(U)$，其中 $U_{j} = U^*$，$j \\in \\{i-1, i, i+1\\}$。\n我们从定义开始：\n$$\nR_i(U^*) = \\frac{1}{\\Delta x}\\left(\\hat{F}_{i+\\tfrac{1}{2}} - \\hat{F}_{i-\\tfrac{1}{2}}\\right)\n$$\n界面 $i+\\frac{1}{2}$ 处的数值通量具有相同的左右状态，$U_L=U_R=U^*$：\n$$\n\\hat{F}_{i+\\tfrac{1}{2}} = \\hat{F}(U^*, U^*) = \\frac{1}{2}\\left(F(U^*) + F(U^*)\\right) - \\frac{1}{2}\\alpha(U^*, U^*)\\left(U^* - U^*\\right)\n$$\n$$\n\\hat{F}_{i+\\tfrac{1}{2}} = \\frac{1}{2}\\left(2F(U^*)\\right) - 0 = F(U^*)\n$$\n这是数值通量的一致性性质：$\\hat{F}(U, U) = F(U)$。\n根据同样的逻辑，界面 $i-\\frac{1}{2}$ 处的数值通量也是 $F(U^*)$：\n$$\n\\hat{F}_{i-\\tfrac{1}{2}} = \\hat{F}(U^*, U^*) = F(U^*)\n$$\n将这些代回残差表达式：\n$$\nR_i(U^*) = \\frac{1}{\\Delta x} \\left[ F(U^*) - F(U^*) \\right] = \\frac{1}{\\Delta x} (0) = 0\n$$\n结果是维度为 3 的零向量。这是一个被称为自由流保持（freestream preservation）的基本一致性要求：均匀流必须产生零残差，这表明它是离散方程的稳态解。表示为 3 分量行矩阵的结果是 $(0, 0, 0)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理解单个控制体的雅可比贡献是第一步，但求解器的性能取决于由所有控制体贡献组装而成的全局雅可比矩阵的性质。本练习将你的视角从局部提升到全局，要求你为一个简化的多单元周期性系统构建完整的块循环雅可比矩阵 。通过分析其谱特性（特征值），你将探索离散算子的稳定性，这是评估和设计高效数值方案的关键一步。",
            "id": "3973400",
            "problem": "考虑理想气体的一维无粘欧拉方程，其比热比为 $\\gamma = 1.4$，在计算流体力学 (CFD) 中离散在一个均匀的三单元周期性网格上。设单元 $i$ 中的守恒状态量为 $Q_{i} = (\\rho_{i}, \\rho_{i} u_{i}, \\rho_{i} E_{i})^{\\top}$，并通过界面通量的有限体积散度定义每个单元中的无粘残差，\n$$\nR_{i} = F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}},\n$$\n其中 $F_{i+\\frac{1}{2}}$ 是单元 $i$ 和 $i+1$ 之间界面的数值通量。假设数值通量是由在Roe平均状态下评估的Roe线性化所构造的Roe近似黎曼求解器通量。任意两个状态 $Q_{L}$ 和 $Q_{R}$ 之间的Roe通量定义为\n$$\nF(Q_{L}, Q_{R}) = \\frac{1}{2}\\left(F(Q_{L}) + F(Q_{R})\\right) - \\frac{1}{2} \\left|A(\\tilde{Q})\\right| \\left(Q_{R}-Q_{L}\\right),\n$$\n其中 $A(\\tilde{Q})$ 是在Roe平均状态 $\\tilde{Q}$ 下评估的一维欧拉方程的通量雅可比矩阵，而 $\\left|A(\\tilde{Q})\\right|$ 表示通过相似变换将 $A(\\tilde{Q})$ 的特征值替换为其绝对值所得到的矩阵。网格是包含三个单元 ($i = 1, 2, 3$) 的周期性网格，因此界面索引为 $i+\\frac{1}{2}$ 模 $3$。\n\n假设存在均匀无量纲自由来流，其声速 $a_{\\infty} = 1$，马赫数 $M_{\\infty} = 0.5$，密度 $\\rho_{\\infty} = 1$，压力 $p_{\\infty} = \\frac{1}{\\gamma}$，因此 $u_{\\infty} = M_{\\infty} a_{\\infty} = 0.5$ 且 $a_{\\infty} = \\sqrt{\\gamma p_{\\infty}/\\rho_{\\infty}} = 1$。所有三个单元都在此均匀状态下初始化，因此 $Q_{1} = Q_{2} = Q_{3} = Q_{\\infty}$，并且所有界面上的Roe平均值均等于 $Q_{\\infty}$。\n\n使用上述物理基础，组装残差向量 $R = (R_{1}^{\\top}, R_{2}^{\\top}, R_{3}^{\\top})^{\\top}$ 相对于全局守恒状态向量 $Q = (Q_{1}^{\\top}, Q_{2}^{\\top}, Q_{3}^{\\top})^{\\top}$ 的精确雅可比矩阵 $J \\in \\mathbb{R}^{9 \\times 9}$，并在均匀自由来流状态 $Q_{\\infty}$ 下进行评估。通过利用三单元网格的周期性结构和一维欧拉方程的Roe矩阵的特征分解，计算 $J$ 的特征值。\n\n最后，报告此配置下 $J$ 的谱半径（$J$ 的所有特征值中的最大绝对值）。将最终答案表示为单个闭式解析表达式，无量纲，且不进行四舍五入。",
            "solution": "用户希望求出在三单元周期性网格上离散化的欧拉方程的雅可比矩阵的谱半径。\n\n### 第一步：问题验证\n\n根据指定标准对问题进行审查。\n\n1.  **已知条件提取**:\n    -   **方程**: 一维无粘欧拉方程，理想气体。\n    -   **比热比**: $\\gamma = 1.4$。\n    -   **网格**: 均匀三单元周期性网格 ($i=1, 2, 3$)。\n    -   **状态向量**: $Q_{i} = (\\rho_{i}, \\rho_{i} u_{i}, \\rho_{i} E_{i})^{\\top}$。\n    -   **残差**: $R_{i} = F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}$。\n    -   **通量**: Roe近似黎曼求解器, $F(Q_{L}, Q_{R}) = \\frac{1}{2}\\left(F(Q_{L}) + F(Q_{R})\\right) - \\frac{1}{2} \\left|A(\\tilde{Q})\\right| \\left(Q_{R}-Q_{L}\\right}$。\n    -   **初始状态**: 均匀自由来流 $Q_1 = Q_2 = Q_3 = Q_\\infty$。\n    -   **自由来流性质**: $\\rho_{\\infty} = 1$, $p_{\\infty} = \\frac{1}{\\gamma}$, $a_{\\infty} = 1$, $M_{\\infty} = 0.5$, $u_{\\infty} = 0.5$。\n    -   **Roe平均状态**: 在所有界面上 $\\tilde{Q} = Q_\\infty$。\n    -   **任务**: 在均匀状态 $Q_\\infty$ 下，计算雅可比矩阵 $J = \\frac{\\partial R}{\\partial Q}$ 的谱半径 $\\rho(J)$。\n\n2.  **验证**:\n    -   **科学依据**: 该问题基于计算流体力学 (CFD) 的基本原理，特别是使用Roe求解器对欧拉方程进行有限体积离散化。所有概念都是该领域的标准且成熟的概念。\n    -   **适定性**: 该问题是完全指定的。均匀状态和周期性边界条件构成了一个具有唯一解的明确定义的数学问题。\n    -   **客观性**: 该问题使用精确、客观的数学语言陈述，没有歧义或主观看法。\n\n3.  **结论**: 该问题有效。这是一个在CFD领域中适定且科学上合理的的问题。我现在开始求解。\n\n### 第二步：雅可比矩阵组装\n\n全局残差向量为 $R = (R_1^\\top, R_2^\\top, R_3^\\top)^\\top$，全局状态向量为 $Q = (Q_1^\\top, Q_2^\\top, Q_3^\\top)^\\top$。单元 $i$ 的残差为 $R_i = F_{i+1/2} - F_{i-1/2}$。由于具有3个单元的周期性，索引按模3计算。\n$R_1 = F_{1+1/2} - F_{1-1/2} = F(Q_1, Q_2) - F(Q_3, Q_1)$\n$R_2 = F_{2+1/2} - F_{2-1/2} = F(Q_2, Q_3) - F(Q_1, Q_2)$\n$R_3 = F_{3+1/2} - F_{3-1/2} = F(Q_3, Q_1) - F(Q_2, Q_3)$\n\nRoe通量为 $F(Q_L, Q_R) = \\frac{1}{2}(F(Q_L) + F(Q_R)) - \\frac{1}{2}|A(\\tilde{Q})|(Q_R - Q_L)$。我们在均匀状态 $Q_1=Q_2=Q_3=Q_\\infty$ 下评估雅可比矩阵。在此状态下，Roe平均值 $\\tilde{Q}$ 也为 $Q_\\infty$。令 $A = A(Q_\\infty)$ 为自由来流状态下的欧拉通量雅可比矩阵。Roe通量的“精确”线性化涉及对 $Q_L$ 和 $Q_R$ 求偏导数，其中标准做法是在 $Q_L=Q_R$ 处评估时，将矩阵 $|A(\\tilde{Q})|$ 在微分过程中视为常数。\n$$\n\\frac{\\partial F(Q_L, Q_R)}{\\partial Q_L} \\bigg|_{Q_L=Q_R=Q_\\infty} = \\frac{1}{2} \\frac{\\partial F(Q_L)}{\\partial Q_L} + \\frac{1}{2}|A| = \\frac{1}{2}(A + |A|) \\equiv B_L\n$$\n$$\n\\frac{\\partial F(Q_L, Q_R)}{\\partial Q_R} \\bigg|_{Q_L=Q_R=Q_\\infty} = \\frac{1}{2} \\frac{\\partial F(Q_R)}{\\partial Q_R} - \\frac{1}{2}|A| = \\frac{1}{2}(A - |A|) \\equiv B_R\n$$\n全局雅可比矩阵 $J = \\frac{\\partial R}{\\partial Q}$ 是一个 $3 \\times 3$ 的块矩阵，其中每个块 $J_{ij} = \\frac{\\partial R_i}{\\partial Q_j}$ 是一个 $3 \\times 3$ 的矩阵。\n$$\n\\frac{\\partial R_i}{\\partial Q_j} = \\frac{\\partial}{\\partial Q_j} \\left( F(Q_i, Q_{i+1}) - F(Q_{i-1}, Q_i) \\right)\n$$\n这得到：\n$\\frac{\\partial R_i}{\\partial Q_i} = \\frac{\\partial F(Q_i, Q_{i+1})}{\\partial Q_i} - \\frac{\\partial F(Q_{i-1}, Q_i)}{\\partial Q_i} = B_L - B_R$\n$\\frac{\\partial R_i}{\\partial Q_{i+1}} = \\frac{\\partial F(Q_i, Q_{i+1})}{\\partial Q_{i+1}} = B_R$\n$\\frac{\\partial R_i}{\\partial Q_{i-1}} = -\\frac{\\partial F(Q_{i-1}, Q_i)}{\\partial Q_{i-1}} = -B_L$\n\n雅可比矩阵 $J$ 具有块循环结构：\n$$\nJ = \\begin{pmatrix}\nB_L - B_R  & B_R  & -B_L \\\\\n-B_L  & B_L - B_R  & B_R \\\\\nB_R  & -B_L  & B_L - B_R\n\\end{pmatrix}\n$$\n这是一个块循环矩阵 $J = \\text{circ}(C_0, C_1, C_2)$，其中 $C_0 = B_L-B_R$, $C_1 = B_R$, $C_2 = -B_L$。\n\n### 第三步：特征值分析\n\n一个 $N \\times N$ 块循环矩阵的特征值是 $N$ 个较小矩阵 $\\hat{J}_k$ 的特征值的并集，这些矩阵由块离散傅里叶变换给出：\n$$\n\\hat{J}_k = C_0 + \\omega^k C_1 + \\omega^{2k} C_2, \\quad k=0, 1, 2\n$$\n其中 $\\omega = \\exp(i 2\\pi/3)$ 是单位的3次原根。\n\n对于 $k=0$ ($\\omega^0 = 1$):\n$$\n\\hat{J}_0 = C_0 + C_1 + C_2 = (B_L - B_R) + B_R + (-B_L) = 0\n$$\n零矩阵的特征值全为零。这为 $J$ 提供了三个零特征值。\n\n对于 $k=1$ ($\\omega^1 = \\omega$, $\\omega^2$):\n$$\n\\hat{J}_1 = C_0 + \\omega C_1 + \\omega^2 C_2 = (B_L-B_R) + \\omega B_R + \\omega^2(-B_L) = (1-\\omega^2)B_L + (\\omega-1)B_R\n$$\n对于 $k=2$ ($\\omega^2$, $\\omega^4=\\omega$):\n$$\n\\hat{J}_2 = C_0 + \\omega^2 C_1 + \\omega C_2 = (B_L-B_R) + \\omega^2 B_R + \\omega(-B_L) = (1-\\omega)B_L + (\\omega^2-1)B_R\n$$\n矩阵 $A$ 和 $|A|$ 可交换，因此它们可以同时对角化。因此，$B_L$ 和 $B_R$ 也可以与 $A$ 同时对角化。设 $\\lambda$ 是 $A$ 的一个特征值。那么 $B_L$ 和 $B_R$ 的相应特征值为：\n$\\lambda_{B_L} = \\frac{1}{2}(\\lambda + |\\lambda|)$\n$\\lambda_{B_R} = \\frac{1}{2}(\\lambda - |\\lambda|)$\n\n$\\hat{J}_1$ 的特征值可以通过代入 $B_L$ 和 $B_R$ 的特征值来找到：\n$$\n\\lambda(\\hat{J}_1) = (1-\\omega^2)\\lambda_{B_L} + (\\omega-1)\\lambda_{B_R} = \\frac{1}{2} \\left[ (1-\\omega^2)(\\lambda+|\\lambda|) + (\\omega-1)(\\lambda-|\\lambda|) \\right]\n$$\n$$\n\\lambda(\\hat{J}_1) = \\frac{1}{2} \\left[ ( (1-\\omega^2)+(\\omega-1) )\\lambda + ( (1-\\omega^2)-(\\omega-1) )|\\lambda| \\right]\n$$\n$$\n\\lambda(\\hat{J}_1) = \\frac{1}{2} \\left[ (\\omega-\\omega^2)\\lambda + (2-\\omega-\\omega^2)|\\lambda| \\right]\n$$\n利用性质 $1+\\omega+\\omega^2=0$，我们有 $-\\omega-\\omega^2=1$。并且，$\\omega = -\\frac{1}{2} + i\\frac{\\sqrt{3}}{2}$ 和 $\\omega^2 = -\\frac{1}{2} - i\\frac{\\sqrt{3}}{2}$，所以 $\\omega-\\omega^2 = i\\sqrt{3}$。\n$$\n\\lambda(\\hat{J}_1) = \\frac{1}{2} \\left[ (i\\sqrt{3})\\lambda + 3|\\lambda| \\right]\n$$\n类似地，对于 $\\hat{J}_2$，我们发现 $\\lambda(\\hat{J}_2) = \\frac{1}{2} \\left[ (-i\\sqrt{3})\\lambda + 3|\\lambda| \\right]$，这是 $\\lambda(\\hat{J}_1)$ 的复共轭。\n\n### 第四步：谱半径计算\n\n谱半径 $\\rho(J)$ 是其特征值的最大绝对值。我们需要找到在 $A$ 的所有特征值 $\\lambda$ 上 $|\\lambda(\\hat{J}_{1,2})|$ 的最大值。\n$$\n|\\lambda(\\hat{J}_{1,2})| = \\left| \\frac{1}{2} (3|\\lambda| \\pm i\\sqrt{3}\\lambda) \\right| = \\frac{1}{2} \\sqrt{(3|\\lambda|)^2 + (\\sqrt{3}\\lambda)^2} = \\frac{1}{2} \\sqrt{9\\lambda^2 + 3\\lambda^2} = \\frac{1}{2} \\sqrt{12\\lambda^2} = \\frac{2\\sqrt{3}}{2}|\\lambda| = \\sqrt{3}|\\lambda|\n$$\n问题简化为求自由来流状态下欧拉通量雅可比矩阵 $A$ 的谱半径。一维欧拉方程的 $A$ 的特征值为 $\\lambda = u$、$\\lambda = u+a$ 和 $\\lambda = u-a$。\n给定自由来流的值 $u_\\infty=0.5$ 和 $a_\\infty=1$：\n-   $\\lambda_1 = u_\\infty = 0.5$\n-   $\\lambda_2 = u_\\infty + a_\\infty = 0.5 + 1 = 1.5$\n-   $\\lambda_3 = u_\\infty - a_\\infty = 0.5 - 1 = -0.5$\n\n这些特征值的绝对值为 $|0.5|$、 $|1.5|$ 和 $|-0.5|$，即 $0.5$、$1.5$ 和 $0.5$。A的谱半径是 $\\rho(A) = \\max(0.5, 1.5, 0.5) = 1.5$。\n\n完整雅可比矩阵 $J$ 的谱半径是其所有特征值模的最大值。$J$ 的非零特征值的模为 $|\\lambda_i|\\sqrt{3}$：\n-   对于 $\\lambda_1, \\lambda_3$：模为 $0.5\\sqrt{3} = \\frac{\\sqrt{3}}{2}$\n-   对于 $\\lambda_2$：模为 $1.5\\sqrt{3} = \\frac{3\\sqrt{3}}{2}$\n\n最大模为 $\\frac{3\\sqrt{3}}{2}$。\n因此，矩阵 $J$ 的谱半径为：\n$$\n\\rho(J) = \\max_{i} (|\\lambda_i|\\sqrt{3}) = (\\max_i |\\lambda_i|)\\sqrt{3} = 1.5 \\sqrt{3} = \\frac{3\\sqrt{3}}{2}\n$$",
            "answer": "$$\\boxed{\\frac{3\\sqrt{3}}{2}}$$"
        },
        {
            "introduction": "理论上的线性化最终要服务于实践中的数值求解。本练习将理论与实践相结合，通过一个模拟跨音速翼型流动的编码任务，让你直观地观察雅可比矩阵的精度如何直接影响牛顿法的收敛速度 。通过比较精确雅可比、近似雅可比和冻结雅可比策略下的收敛行为，你将深刻体会到线性化精度在实现快速、鲁棒求解器中的关键作用。",
            "id": "3973418",
            "problem": "考虑围绕跨音速翼型（airfoil）的薄流管（streamtube）内的稳态、无粘、等熵、可压缩流动。在计算流体动力学（CFD）中，此类流动的离散残差可以从质量守恒和等熵热力学得到的面积-马赫数关系构建。从基本定律出发，稳态一维流管的质量守恒意味着 $ \\rho U A = \\text{constant} $，其中 $ \\rho $ 是密度，$ U $ 是轴向速度，$ A $ 是局部横截面积。在等熵条件下，压力-密度关系 $ p/\\rho^\\gamma = \\text{constant} $ 成立，其中 $ \\gamma $ 是比热比。结合这些关系可得到可壓縮流的面积-马赫数关系：\n$$\n\\frac{A}{A^\\ast}(M) \\;=\\; \\frac{1}{M}\\left(\\frac{2}{\\gamma+1}\\left(1+\\frac{\\gamma-1}{2}M^2\\right)\\right)^{\\frac{\\gamma+1}{2(\\gamma-1)}},\n$$\n其中 $ M $ 是马赫数，$ A^\\ast $ 是音速面积。此关系对 $ M > 0 $ 有效，在 $ M = 1 $ 处有最小值 $ A/A^\\ast = 1 $，并在 $ A/A^\\ast > 1 $ 时产生两个分支（亚音速和超音速）。在跨音速翼型的情况下，沿表面坐标 $ s \\in [0,1] $ 的光滑马赫数场 $ M(s) $ 将在 $ M \\approx 1 $ 附近穿过。\n\n对于在均匀间隔的节点 $ s_i \\in [0,1] $ 上的节点马赫数向量 $ \\mathbf{m} = (m_1,\\dots,m_N) $，定义非线性残差为：\n$$\nR_i(\\mathbf{m}) \\;=\\; \\frac{A}{A^\\ast}(m_i) \\;-\\; \\frac{A}{A^\\ast}(M_{\\text{true}}(s_i)),\n$$\n其中 $ M_{\\text{true}}(s) $ 是一个预设的光滑跨音速目标场，\n$$\nM_{\\text{true}}(s) \\;=\\; 0.8 \\;+\\; 0.4 \\exp\\!\\left(-\\frac{(s-0.6)^2}{(0.05)^2}\\right),\n$$\n且 $ \\gamma = 1.4 $。根据构造，$ R_i(\\mathbf{m})=0 $ 的精确解是 $ m_i = M_{\\text{true}}(s_i) $。设初始猜测为\n$$\nm_i^{(0)} \\;=\\; M_{\\text{true}}(s_i) \\;+\\; \\delta \\sin(2\\pi s_i), \\quad \\delta = 0.02.\n$$\n\n牛顿法更新 $ \\mathbf{m}^{(k+1)} = \\mathbf{m}^{(k)} - \\mathbf{J}(\\mathbf{m}^{(k)})^{-1}\\mathbf{R}(\\mathbf{m}^{(k)}) $，其中 $ \\mathbf{J} $ 是雅可比矩阵，其元素为 $ J_{ij} = \\partial R_i / \\partial m_j $。因为 $ R_i $ 仅依赖于 $ m_i $，所以 $ \\mathbf{J} $ 是对角矩阵，其对角元素为 $ J_{ii} = \\frac{d}{dM}\\left(\\frac{A}{A^\\ast}(M)\\right)\\big|_{M=m_i} $。可以通过用近似值替换精确导数来改变线性化精度：\n- 精确雅可比：$ J_{ii} = \\left(\\frac{A}{A^\\ast}\\right)^\\prime(m_i^{(k)}) $。\n- 有限差分雅可比：$ J_{ii} \\approx \\dfrac{\\frac{A}{A^\\ast}(m_i^{(k)}+\\epsilon) - \\frac{A}{A^\\ast}(m_i^{(k)})}{\\epsilon} $，其中 $ \\epsilon > 0 $ 为指定值。\n- 冻结雅可比：$ J_{ii} $ 在 $ m_i^{(0)} $ 处计算一次，并在所有迭代中保持不变。\n\n定义第 $ k $ 次迭代的全局误差为无穷范数\n$$\ne^{(k)} \\;=\\; \\left\\|\\mathbf{m}^{(k)} - \\mathbf{M}_{\\text{true}}\\right\\|_\\infty.\n$$\n使用三个连续的误差估计观测收敛率 $ p $：\n$$\np \\;\\approx\\; \\frac{\\ln\\!\\left(e^{(k+1)}/e^{(k)}\\right)}{\\ln\\!\\left(e^{(k)}/e^{(k-1)}\\right)},\n$$\n此值由固定总迭代次数后的最后三次迭代计算得出。\n\n你的任务是实现一个程序，该程序：\n1. 在 $ [0,1] $ 中构造 $ N = 200 $ 个均匀分布的节点 $ s_i $。\n2. 如上所述，构建 $ M_{\\text{true}}(s_i) $、残差 $ R_i(\\mathbf{m}) $ 并初始化 $ \\mathbf{m}^{(0)} $。\n3. 使用以下各种雅可比线性化策略，运行牛顿迭代固定次数（使用 $ 8 $ 次迭代）：\n   - 精确雅可比。\n   - 有限差分雅可比，其中 $ \\epsilon = 10^{-6} $。\n   - 有限差分雅可比，其中 $ \\epsilon = 10^{-3} $。\n   - 从初始猜测中获取的冻结雅可比。\n4. 对每种策略，使用最后三个误差 $ e^{(k)} $ 计算观测收敛率 $ p $。\n5. 将四个 $ p $ 值汇总到一个列表中。\n\n测试套件：\n- 情况 1：精确雅可比。\n- 情况 2：有限差分雅可比，其中 $ \\epsilon = 10^{-6} $。\n- 情况 3：有限差分雅可比，其中 $ \\epsilon = 10^{-3} $。\n- 情况 4：从初始猜测中获取的冻结雅可比。\n\n你的程序应产生单行输出，包含一个由方括号括起来的逗号分隔列表形式的结果（例如，$ [p_1,p_2,p_3,p_4] $）。输出中的所有数字必须是无单位的普通浮点值。此问题不需要物理单位，所有量均为无量纲。此问题不涉及角度，也不使用百分比。",
            "solution": "该问题涉及求解一个源于流体动力学问题离散化产生的非线性方程组的数值解。具体来说，它关注于寻找满足一组代数方程 $ \\mathbf{R}(\\mathbf{m}) = \\mathbf{0} $ 的马赫数分布 $ \\mathbf{m} $。\n\n**1. 物理与数学基础**\n问题的核心是一维可压缩流动的等熵面积-马赫数关系：\n$$ \\frac{A}{A^\\ast}(M) = \\frac{1}{M}\\left(\\frac{2}{\\gamma+1}\\left(1+\\frac{\\gamma-1}{2}M^2\\right)\\right)^{\\frac{\\gamma+1}{2(\\gamma-1)}} $$\n该方程将局部流马赫数 $ M $ 与局部流管面积 $ A $ 和音速面积 $ A^\\ast $ 的比值联系起来。问题为沿空间坐标 $ s $ 的 $ N $ 个离散点定义了一个非线性残差向量 $ \\mathbf{R} $。残差的第 $ i $ 个分量为：\n$$ R_i(\\mathbf{m}) = \\frac{A}{A^\\ast}(m_i) - \\frac{A}{A^\\ast}(M_{\\text{true}}(s_i)) $$\n这里，$ \\mathbf{m} = \\{m_i\\}_{i=1}^N $ 是未知的节点马赫数向量。$ \\frac{A}{A^\\ast}(M_{\\text{true}}(s_i)) $ 项代表了对应于已知精确解 $ \\mathbf{M}_{\\text{true}} $ 的面积比。目标是求解方程组 $ \\mathbf{R}(\\mathbf{m}) = \\mathbf{0} $，根据构造，其解为 $ m_i = M_{\\text{true}}(s_i) $。\n\n**2. 数值方法：牛顿-拉夫逊法**\n牛顿法是一种用于寻找非线性方程组根的迭代算法。给定一个初始猜测 $ \\mathbf{m}^{(k)} $，下一个迭代值 $ \\mathbf{m}^{(k+1)} $ 通过求解围绕 $ \\mathbf{m}^{(k)} $ 对残差进行一阶泰勒展开得到的线性系统来找到：\n$$ \\mathbf{R}(\\mathbf{m}^{(k+1)}) \\approx \\mathbf{R}(\\mathbf{m}^{(k)}) + \\mathbf{J}(\\mathbf{m}^{(k)})(\\mathbf{m}^{(k+1)} - \\mathbf{m}^{(k)}) = \\mathbf{0} $$\n这导出了更新公式：\n$$ \\mathbf{m}^{(k+1)} = \\mathbf{m}^{(k)} - \\mathbf{J}(\\mathbf{m}^{(k)})^{-1}\\mathbf{R}(\\mathbf{m}^{(k)}) $$\n矩阵 $ \\mathbf{J} $ 是残差向量的雅可比矩阵，其元素为 $ J_{ij} = \\partial R_i / \\partial m_j $。在此问题中，$ R_i $ 仅依赖于 $ m_i $，使得雅可比矩阵成为一个对角矩阵。其对角元素为：\n$$ J_{ii} = \\frac{\\partial R_i}{\\partial m_i} = \\frac{d}{dM}\\left(\\frac{A}{A^\\ast}(M)\\right)\\bigg|_{M=m_i} $$\n解析上，这个导数被求得为：\n$$ \\left(\\frac{A}{A^\\ast}\\right)'(M) = \\frac{A}{A^\\ast}(M) \\frac{M^2-1}{M(1+\\frac{\\gamma-1}{2}M^2)} $$\n\n**3. 雅可比线性化策略与收斂性**\n研究的核心在于如何计算雅可比矩阵 $ \\mathbf{J} $，因为这显著影响收敛速度和计算成本。问题评估了四种策略：\n\n- **精确雅可比**：使用解析导数提供了最准确的线性化。通常，对于简单根，使用精确雅可比的牛顿法表现出二次收敛性，意味着误差 $ e^{(k+1)} $ 与 $ (e^{(k)})^2 $ 成正比，收敛率 $ p $ 为 $ 2 $。\n\n- **有限差分雅可比**：通过数值方法近似导数，例如 $ J_{ii} \\approx (\\frac{A}{A^\\ast}(m_i+\\epsilon) - \\frac{A}{A^\\ast}(m_i))/\\epsilon $，引入了量级为 $ O(\\epsilon) $ 的近似误差。这通常会将收敛性降低为线性（$ p=1 $），即每一步的误差减小变为一个常数。这种线性收敛的速度取决于 $ \\epsilon $ 的大小。\n\n- **冻结雅可比**：仅在初始猜测 $ \\mathbf{m}^{(0)} $ 处计算一次雅可比，并在所有后续迭代中重复使用，这将牛顿法转换为一种拟牛顿法（或弦截法）。这避免了重新评估雅可比的成本，但将收敛率降低到线性（$ p=1 $）。\n\n**4. 跨音速奇点 ($ M=1 $)**\n此问题的一个关键物理和数值特征是流动的跨音速性质，其中马赫数穿过 $ M=1 $。在 $ M=1 $ 时，导数 $ (A/A^\\ast)'(M) $ 为零。对于一个标准的牛顿迭代，如果它收敛到一个根 $ m^* $ 且在该点导数 $ J(m^*) $ 非零，则收敛是二次的。然而，如果 $ J(m^*) = 0 $，收斂性会退化为线性，速率因子为 $ 0.5 $，即 $ p=1 $。\n在此问题中，真实解 $ \\mathbf{M}_{\\text{true}} $ 包含了 $ M_{true}(s_i) \\approx 1 $ 的点。由无穷范数定义的全局误差 $ e^{(k)} = \\max_i |m_i^{(k)} - M_{\\text{true}}(s_i)| $ 将由收敛最慢的节点处的误差主导。由于靠近 $ M=1 $ 的节点表现出线性收敛，而其他节点可能二次收敛，因此对于“精确雅可比”情况，观测到的整体收敛率 $ p $ 预计将接近 $ 1 $，而不是 $ 2 $。其他策略本身就是线性的，所以它们也预计会产生 $ p \\approx 1 $。实现将计算这些观测到的速率。\n\n**5. 实现步骤**\n解决方案将使用 Python 中的 `numpy` 库实现。\n1.  定义常数 $ \\gamma, N, \\delta $ 和迭代次数。\n2.  将域 $ s \\in [0,1] $ 离散化为 $ N=200 $ 个节点。\n3.  实现用于 $ A/A^\\ast(M) $、其导数 $ (A/A^\\ast)'(M) $ 和目标场 $ M_{\\text{true}}(s) $ 的向量化函数。\n4.  计算真实解向量 $ \\mathbf{M}_{\\text{true}} $ 和初始猜测 $ \\mathbf{m}^{(0)} $。\n5.  遍历四种指定的雅可比策略。对于每种策略：\n    a. 将解向量初始化为 $ \\mathbf{m}^{(0)} $。\n    b. 运行牛顿迭代循环 $ 8 $ 步，每步存储误差的无穷范数。\n    c. 根据当前策略（精确、有限差分或冻结）计算雅可比元素 $ J_{ii} $。\n    d. 在每一步中更新解向量 $ \\mathbf{m} $。\n6.  迭代结束后，使用最后三次迭代的误差（$ e^{(6)}, e^{(7)}, e^{(8)} $）为每种策略计算观测到的收敛率 $ p $。\n7.  将四个计算出的速率 $ p $ 收集到一个列表中，并按要求格式化输出。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the nonlinear residual problem for transonic flow using Newton's method\n    with different Jacobian approximations and computes the observed convergence rates.\n    \"\"\"\n    \n    # --- 1. Problem Setup ---\n    N = 200\n    GAMMA = 1.4\n    DELTA = 0.02\n    NUM_ITER = 8\n    \n    # Spatial domain discretization\n    s = np.linspace(0, 1, N)\n\n    # --- 2. Core Physical and Mathematical Functions ---\n    \n    def A_A_star(M, gamma=GAMMA):\n        \"\"\"\n        Calculates the compressible area-Mach number relation A/A*.\n        Vectorized to operate on numpy arrays.\n        \"\"\"\n        # The function is not defined for M = 0, but our M range is safe.\n        # Add a small value to avoid division by zero or log(0) if M=0.\n        M = np.maximum(M, 1e-9)\n\n        gp1 = gamma + 1.0\n        gm1 = gamma - 1.0\n        \n        term1 = 2.0 / gp1\n        term2 = 1.0 + (gm1 / 2.0) * M**2\n        exponent = gp1 / (2.0 * gm1)\n        \n        return (1.0 / M) * (term1 * term2)**exponent\n\n    def dA_A_star_dM(M, gamma=GAMMA):\n        \"\"\"\n        Calculates the exact derivative of the A/A* function with respect to M.\n        Vectorized to operate on numpy arrays.\n        \"\"\"\n        M = np.maximum(M, 1e-9)\n\n        gm1 = gamma - 1.0\n        \n        # A/A*(M) value is needed for the derivative formula\n        val_A_A_star = A_A_star(M, gamma)\n        \n        numerator = M**2 - 1.0\n        denominator = M * (1.0 + (gm1 / 2.0) * M**2)\n        \n        # Avoid division by zero\n        denominator = np.where(np.abs(denominator)  1e-12, 1e-12, denominator)\n        \n        return val_A_A_star * (numerator / denominator)\n\n    def M_true_func(s_val):\n        \"\"\"\n        Calculates the prescribed true Mach number distribution.\n        \"\"\"\n        return 0.8 + 0.4 * np.exp(-((s_val - 0.6)**2) / (0.05**2))\n\n    # Static computations\n    M_true = M_true_func(s)\n    m0 = M_true + DELTA * np.sin(2 * np.pi * s)\n    A_A_star_true = A_A_star(M_true)\n\n    # --- 3. Strategies and Solver ---\n    \n    strategies = [\n        {'type': 'exact'},\n        {'type': 'fd', 'epsilon': 1e-6},\n        {'type': 'fd', 'epsilon': 1e-3},\n        {'type': 'frozen'}\n    ]\n    \n    convergence_rates = []\n\n    for strategy in strategies:\n        m = m0.copy()\n        errors = []\n\n        # Calculate initial error e^(0)\n        initial_error = np.linalg.norm(m - M_true, ord=np.inf)\n        errors.append(initial_error)\n        \n        # Pre-compute frozen Jacobian if needed\n        if strategy['type'] == 'frozen':\n            J_frozen = dA_A_star_dM(m)\n            # Regularize to prevent division by zero at sonic points\n            J_frozen = np.where(np.abs(J_frozen)  1e-12, np.sign(J_frozen) * 1e-12, J_frozen)\n\n        # Newton iteration loop\n        for _ in range(NUM_ITER):\n            # Calculate residual R(m)\n            R = A_A_star(m) - A_A_star_true\n            \n            # Calculate Jacobian J(m) based on strategy\n            if strategy['type'] == 'exact':\n                J = dA_A_star_dM(m)\n            elif strategy['type'] == 'fd':\n                epsilon = strategy['epsilon']\n                J = (A_A_star(m + epsilon) - A_A_star(m)) / epsilon\n            elif strategy['type'] == 'frozen':\n                J = J_frozen\n            \n            # Regularize Jacobian to prevent division by very small numbers near M=1\n            J = np.where(np.abs(J)  1e-12, np.sign(J) * 1e-12, J)\n\n            # Newton update step\n            delta_m = -R / J\n            m = m + delta_m\n            \n            # Store error e^(k)\n            error = np.linalg.norm(m - M_true, ord=np.inf)\n            errors.append(error)\n\n        # --- 4. Convergence Rate Calculation ---\n        e_k_minus_1 = errors[NUM_ITER - 2]\n        e_k = errors[NUM_ITER - 1]\n        e_k_plus_1 = errors[NUM_ITER]\n        \n        # Handle cases where error reduction stops, to avoid log(1) or division by zero\n        # Use a small epsilon to avoid division by zero in log\n        eps = 1e-20\n        log_term_num = np.log((e_k_plus_1 + eps) / (e_k + eps))\n        log_term_den = np.log((e_k + eps) / (e_k_minus_1 + eps))\n\n        if abs(log_term_den)  1e-9:\n            # If there's no error reduction, rate is ill-defined.\n            # Usually implies p=1 if convergence stalled.\n            p = 1.0\n        else:\n            p = log_term_num / log_term_den\n\n        convergence_rates.append(p)\n\n    # --- 5. Output ---\n    result_str = \",\".join(f\"{rate:.8f}\" for rate in convergence_rates)\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}