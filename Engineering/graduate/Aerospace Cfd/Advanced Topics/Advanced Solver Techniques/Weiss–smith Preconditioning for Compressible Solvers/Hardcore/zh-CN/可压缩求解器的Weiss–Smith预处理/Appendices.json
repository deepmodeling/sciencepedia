{
    "hands_on_practices": [
        {
            "introduction": "要真正理解为何Weiss-Smith预处理至关重要，我们必须首先诊断它所解决的问题。这项练习将引导您分析一个标准的可压缩流求解器，揭示其数值耗散在低速下的行为。通过推导人工扩散的尺度规律，您将发现一个根本性缺陷，即在低马赫数极限下，该缺陷会解耦压力和速度，从而阐明了采用更复杂方法的必要性。",
            "id": "4006379",
            "problem": "考虑以守恒变量 $\\boldsymbol{U} = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$ 写出的一维可压缩欧拉方程，并在空间上使用间距为 $\\Delta x$ 的均匀网格，通过 Roe 型近似黎曼求解器进行离散化。界面 $i+\\frac{1}{2}$ 处的数值通量由中心平均项加上一个耗散项构成，该耗散项源自通量雅可比矩阵在 Roe 平均状态下的谱分解。假设存在一个均匀基流，其密度 $\\rho_0$、压力 $p_0$ 和速度 $u_0$ 均为常数，并定义马赫数 $M = u_0/a_0$，其中 $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$ 是声速，$\\gamma$ 是比热比。考虑在该基态附近存在小振幅、光滑变化的等熵扰动。\n\n从可压缩欧拉方程和 Roe 型通量的结构出发，对均匀基态附近的半离散格式进行线性化，并推导由数值耗散为压力扰动 $p'(x,t)$ 引入的主阶等效微分算子。仔细运用泰勒展开将通量差分与空间导数联系起来，并明确指出声学特征速度如何进入出现在线性化系统中的等效人工扩散。在低马赫数极限 $M \\to 0$ 下，确定人工压力扩散系数对 $M$ 的主阶依赖关系。\n\n然后，解释为什么在使用朴素通量分裂（即在耗散中使用未经修正的声学特征值）时，当 $M \\to 0$ 时这种缩放关系会破坏压力-速度耦合，并简要地将其与 Weiss–Smith 预处理的动机联系起来，该预处理方法重新缩放了声学贡献以恢复正确的低马赫数行为。\n\n你的最终任务是，提供由未经预处理的 Roe 型耗散所引起的等效线性化压力演化中，乘以 $\\partial_{xx} p'$ 的主阶人工扩散系数的解析表达式，该表达式需用 $\\Delta x$、$u_0$ 和 $M$ 表示。请用国际单位制单位 $\\mathrm{m}^2/\\mathrm{s}$ 表达你的最终答案。无需进行数值计算。",
            "solution": "分析始于守恒形式的一维可压缩欧拉方程 $\\partial_t \\boldsymbol{U} + \\partial_x \\boldsymbol{F}(\\boldsymbol{U}) = 0$，其中状态向量为 $\\boldsymbol{U} = (\\rho, \\rho u, \\rho E)^{\\mathsf{T}}$，通量向量为 $\\boldsymbol{F}(\\boldsymbol{U}) = (\\rho u, \\rho u^2 + p, u(\\rho E + p))^{\\mathsf{T}}$。单位质量的总能量为 $E = \\frac{p}{\\rho(\\gamma-1)} + \\frac{1}{2}u^2$。\n\n在间距为 $\\Delta x$ 的均匀网格上，使用 Roe 型近似黎曼求解器进行半离散化，得到节点 $i$ 处的以下方程：\n$$\n\\frac{d\\boldsymbol{U}_i}{dt} = -\\frac{1}{\\Delta x}(\\boldsymbol{F}_{i+1/2} - \\boldsymbol{F}_{i-1/2})\n$$\n数值通量 $\\boldsymbol{F}_{i+1/2}$ 由中心平均项和耗散项构成：\n$$\n\\boldsymbol{F}_{i+1/2} = \\frac{1}{2}(\\boldsymbol{F}(\\boldsymbol{U}_i) + \\boldsymbol{F}(\\boldsymbol{U}_{i+1})) - \\frac{1}{2} |\\tilde{\\boldsymbol{A}}_{i+1/2}| (\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i)\n$$\n其中 $\\tilde{\\boldsymbol{A}}_{i+1/2}$ 是在 $\\boldsymbol{U}_i$ 和 $\\boldsymbol{U}_{i+1}$ 之间的 Roe 平均状态下计算的通量雅可比矩阵 $\\partial\\boldsymbol{F}/\\partial\\boldsymbol{U}$。矩阵 $|\\tilde{\\boldsymbol{A}}|$ 通过谱分解 $\\tilde{\\boldsymbol{A}} = \\tilde{\\boldsymbol{R}} \\tilde{\\boldsymbol{\\Lambda}} \\tilde{\\boldsymbol{L}}$ 定义，使得 $|\\tilde{\\boldsymbol{A}}| = \\tilde{\\boldsymbol{R}} |\\tilde{\\boldsymbol{\\Lambda}}| \\tilde{\\boldsymbol{L}}$，其中 $|\\tilde{\\boldsymbol{\\Lambda}}|$ 是 $\\tilde{\\boldsymbol{A}}$ 特征值绝对值构成的对角矩阵。\n\n将通量表达式代入半离散方程，得到：\n$$\n\\frac{d\\boldsymbol{U}_i}{dt} = -\\frac{\\boldsymbol{F}_{i+1} - \\boldsymbol{F}_{i-1}}{2\\Delta x} + \\frac{1}{2\\Delta x} \\left( |\\tilde{\\boldsymbol{A}}_{i+1/2}|(\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i) - |\\tilde{\\boldsymbol{A}}_{i-1/2}|(\\boldsymbol{U}_{i} - \\boldsymbol{U}_{i-1}) \\right)\n$$\n第一项是通量导数的中心差分近似。第二项代表数值耗散。对于均匀基流 $(\\rho_0, u_0, p_0)$ 附近的微小、光滑扰动，任何界面处的 Roe 平均雅可比矩阵 $\\tilde{\\boldsymbol{A}}$ 均可近似为基态处的常数雅可比矩阵 $\\boldsymbol{A}_0$。作用于 $\\boldsymbol{U}_i$ 的耗散项算子则变为：\n$$\n\\boldsymbol{D}_i \\approx \\frac{1}{2\\Delta x} |\\boldsymbol{A}_0| ((\\boldsymbol{U}_{i+1} - \\boldsymbol{U}_i) - (\\boldsymbol{U}_i - \\boldsymbol{U}_{i-1})) = \\frac{1}{2\\Delta x} |\\boldsymbol{A}_0| (\\boldsymbol{U}_{i+1} - 2\\boldsymbol{U}_i + \\boldsymbol{U}_{i-1})\n$$\n使用泰勒级数展开，$(\\boldsymbol{U}_{i+1} - 2\\boldsymbol{U}_i + \\boldsymbol{U}_{i-1})$ 项是 $(\\Delta x)^2 \\partial_{xx}\\boldsymbol{U}$ 的二阶近似。因此，数值耗散的主阶等效微分算子是：\n$$\n\\boldsymbol{D} = \\frac{\\Delta x}{2} |\\boldsymbol{A}_0| \\partial_{xx}\\boldsymbol{U}\n$$\n线性化半离散格式等效于系统 $\\partial_t \\boldsymbol{U}' + \\boldsymbol{A}_0 \\partial_x \\boldsymbol{U}' = \\frac{\\Delta x}{2} |\\boldsymbol{A}_0| \\partial_{xx} \\boldsymbol{U}'$，其中 $\\boldsymbol{U}'$ 表示相对于基态的扰动。\n\n为分析其对压力的影响，我们变换到特征变量。设 $\\boldsymbol{L}_0$ 是 $\\boldsymbol{A}_0$ 的左特征向量矩阵。乘以 $\\boldsymbol{L}_0$ 可将系统对角化，从而得到一组关于特征变量扰动 $\\boldsymbol{W} = \\boldsymbol{L}_0 \\boldsymbol{U}'$ 的解耦的对流-扩散方程：\n$$\n\\partial_t \\boldsymbol{W} + \\boldsymbol{\\Lambda}_0 \\partial_x \\boldsymbol{W} = \\frac{\\Delta x}{2} |\\boldsymbol{\\Lambda}_0| \\partial_{xx} \\boldsymbol{W}\n$$\n此处，$\\boldsymbol{\\Lambda}_0$ 是 $\\boldsymbol{A}_0$ 的特征值对角矩阵，这些特征值即为特征速度：$\\lambda_1 = u_0$（熵波/接触波），$\\lambda_2 = u_0 - a_0$（左行声波），以及 $\\lambda_3 = u_0 + a_0$（右行声波），其中 $a_0 = \\sqrt{\\gamma p_0/\\rho_0}$。\n\n每个特征变量扰动 $w_k$ 遵循以下演化方程：\n$$\n\\partial_t w_k + \\lambda_k \\partial_x w_k = \\frac{\\Delta x}{2} |\\lambda_k| \\partial_{xx} w_k\n$$\n对于等熵扰动，压力变化 $dp$ 和密度变化 $d\\rho$ 通过 $dp = a^2 d\\rho$ 关联。对应于熵波的特征变量是静止的（$dw_1 \\propto dp - a^2 d\\rho = 0$）。声学特征扰动可以用原始变量扰动 $(p', u')$ 定义为 $dw_2 = dp' - \\rho_0 a_0 du'$ 和 $dw_3 = dp' + \\rho_0 a_0 du'$。由此，我们可以将压力扰动表示为 $p' = \\frac{1}{2}(w_2 + w_3)$。\n\n$p'$ 的演化方程通过将 $w_2$ 和 $w_3$ 的方程相加再除以 $2$ 得到。得到的 $p'$ 方程中的扩散部分为：\n$$\nD_{p'} = \\frac{1}{2} \\left( \\frac{\\Delta x}{2}|\\lambda_2| \\partial_{xx}w_2 + \\frac{\\Delta x}{2}|\\lambda_3| \\partial_{xx}w_3 \\right) = \\frac{\\Delta x}{4} \\left( |u_0-a_0|\\partial_{xx}w_2 + |u_0+a_0|\\partial_{xx}w_3 \\right)\n$$\n为求得 $p'$ 的人工扩散系数，我们将 $w_2 = p' - \\rho_0 a_0 u'$ 和 $w_3 = p' + \\rho_0 a_0 u'$ 代入：\n$$\nD_{p'} = \\frac{\\Delta x}{4} \\left( |u_0-a_0|\\partial_{xx}(p' - \\rho_0 a_0 u') + |u_0+a_0|\\partial_{xx}(p' + \\rho_0 a_0 u') \\right)\n$$\n$\\partial_{xx}p'$ 项的系数即为人工压力扩散系数 $\\nu_{pp}$：\n$$\n\\nu_{pp} = \\frac{\\Delta x}{4} \\left( |u_0-a_0| + |u_0+a_0| \\right)\n$$\n在低马赫数极限（$M = u_0/a_0 \\to 0$）下，流动是亚音速的，$u_0  a_0$。因此，$|u_0-a_0| = a_0-u_0$ 且 $|u_0+a_0| = a_0+u_0$。系数简化为：\n$$\n\\nu_{pp} = \\frac{\\Delta x}{4} \\left( (a_0 - u_0) + (a_0 + u_0) \\right) = \\frac{\\Delta x a_0}{2}\n$$\n为用 $M=u_0/a_0$ 表示此式，我们代入 $a_0 = u_0/M$：\n$$\n\\nu_{pp} = \\frac{\\Delta x}{2} \\left(\\frac{u_0}{M}\\right) = \\frac{\\Delta x u_0}{2M}\n$$\n该表达式揭示了朴素可压缩求解器在低速下的核心问题。当 $M \\to 0$ 时，压力的人工扩散系数 $\\nu_{pp}$ 按 $M^{-1}$ 比例缩放，变得过大。低马赫数流动的物理行为趋近于不可压缩流，其中压力和速度通过一个椭圆型约束（$\\nabla^2 p \\sim \\text{source}$）紧密耦合。由大声速 $a_0$ 而非小流速 $u_0$ 来缩放的巨大人工压力扩散，压倒了物理上的压力演化。它有效地将压力场与速度场解耦，从而阻止了格式正确地捕捉不可压缩行为。这导致了严重的收敛性恶化和不准确的解，尤其是在压力场上。\n\nWeiss–Smith 预处理旨在修正这一缺陷。它通过修改系统的时间导数项，从而达到重新缩放系统雅可比矩阵特征值的效果。其目标是使所有特征值在低马赫数极限下处于同一数量级。对于数值通量，这对应于用一个重新缩放的值替换耗散缩放因子 $|\\lambda_k|$。具体来说，声速 $|u_0 \\pm a_0| \\approx a_0$ 被替换为一个与流速同量级的修正速度，即用 $u_0$ 进行缩放。这将人工压力扩散系数从 $O(a_0)$ 降低到 $O(u_0)$，从而恢复了正确的压力-速度耦合，并确保格式具有正确的不可压缩极限。\n\n乘以 $\\partial_{xx}p'$ 的主阶人工扩散系数为 $\\frac{\\Delta x a_0}{2}$。用所要求的变量表示，即为 $\\frac{\\Delta x u_0}{2M}$。",
            "answer": "$$\\boxed{\\frac{\\Delta x u_0}{2M}}$$"
        },
        {
            "introduction": "预处理通过重新调整系统特征值来解决欧拉方程在低速下的刚性问题，但这种修改并非没有代价。本练习探讨了一个关键的权衡：它对显式时间步进格式的数值稳定性的影响。通过von Neumann稳定性分析，您将直接量化预处理参数 $\\beta$ 如何影响最大允许的Courant–Friedrichs–Lewy (CFL) 数，这是瞬态模拟中的一个关键约束。",
            "id": "4006455",
            "problem": "在计算流体动力学（CFD）的背景下，考虑围绕均匀状态的可压缩欧拉方程的一维线性化等熵声学子系统。令原始变量向量为 $q = \\begin{pmatrix} p \\\\ u \\end{pmatrix}$，其中 $p$ 是压力，$u$ 是速度。假设基础密度 $\\rho$ 和声速 $a$ 为常数。该线性化系统可以写为\n$$\n\\frac{\\partial q}{\\partial t} + A \\frac{\\partial q}{\\partial x} = 0,\n$$\n其中通量雅可比矩阵为\n$$\nA = \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}.\n$$\n为了解决低马赫数刚度问题，应用 Weiss–Smith 预处理，使用对角预处理矩阵 $P(\\beta) = \\operatorname{diag}(\\beta, 1)$（其中 $0  \\beta \\leq 1$），得到预处理后的系统\n$$\nP(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0.\n$$\n在间距为 $\\Delta x$ 的均匀网格上，使用时间步长为 $\\Delta t$ 的显式前向欧拉时间步进法，以及应用于预处理算子特征变量的一阶迎风空间离散格式，来离散化该系统。通过考虑单个傅里叶模态 $q_{j}^{n} = \\hat{q}^{n}\\exp(i \\theta j)$（其中 $j$ 是网格点的索引，$n$ 是时间层的索引）进行 von Neumann（傅里叶）分析，以推导放大矩阵及其特征值。然后，根据预处理参数 $\\beta$ 和由下式定义的常规声学 Courant–Friedrichs–Lewy (CFL) 数\n$$\n\\mathrm{CFL}_{a} = \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\n来获得稳定性条件。对于此显式格式，通过将最大允许 $\\mathrm{CFL}_{a}$ 表示为 $\\beta$ 的函数，来确定在 $(\\beta,\\mathrm{CFL}_{a})$ 平面内的稳定区域边界。以 $\\beta$ 表示最大 $\\mathrm{CFL}_{a}$ 的单个闭式解析表达式的形式提供最终答案。无需四舍五入。CFL 数是无量纲的；不要在最终答案中包含单位。",
            "solution": "用户想要找到一个预处理系统的稳定性条件。\n\n### 第 1 步：问题验证\n\n**1.1. 提取已知条件**\n-   偏微分方程组为 $\\frac{\\partial q}{\\partial t} + A \\frac{\\partial q}{\\partial x} = 0$。\n-   原始变量向量为 $q = \\begin{pmatrix} p \\\\ u \\end{pmatrix}$，其中 $p$ 是压力，$u$ 是速度。\n-   通量雅可比矩阵为 $A = \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}$，其中密度 $\\rho$ 和声速 $a$ 为常数。\n-   预处理矩阵为 $P(\\beta) = \\operatorname{diag}(\\beta, 1) = \\begin{pmatrix} \\beta  0 \\\\ 0  1 \\end{pmatrix}$，其中 $0  \\beta \\leq 1$。\n-   预处理后的系统为 $P(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0$。\n-   数值格式为：\n    -   时间积分：显式前向欧拉法。\n    -   空间离散：应用于预处理算子特征变量的一阶迎风格式。\n    -   网格：均匀网格，空间步长为 $\\Delta x$，时间步长为 $\\Delta t$。\n-   分析方法是使用单个模态 $q_{j}^{n} = \\hat{q}^{n}\\exp(i \\theta j)$ 的 von Neumann（傅里叶）分析。\n-   常规声学 Courant–Friedrichs–Lewy (CFL) 数定义为 $\\mathrm{CFL}_{a} = \\frac{a\\,\\Delta t}{\\Delta x}$。\n-   目标是找到作为 $\\beta$ 函数的最大允许 $\\mathrm{CFL}_{a}$。\n\n**1.2. 使用提取的已知条件进行验证**\n-   **科学依据**：该问题设置在计算流体动力学（CFD）的背景下，使用了线性化欧拉方程，这是一种声学的标准模型。Weiss–Smith 预处理是处理低马赫数流动的成熟技术。Von Neumann 稳定性分析是分析数值格式的基本工具。该问题牢固地植根于应用数学和流体动力学的既定原则。\n-   **适定性**：问题定义清晰。它指明了控制方程、预处理、数值方法和分析技术。目标是一个具体的、可推导的量（稳定性边界）。预期会有一个唯一的解。\n-   **客观性**：语言精确、数学化，并且没有任何主观性。\n-   **完整性和一致性**：提供了所有必要的矩阵、参数和定义。问题陈述中没有明显的矛盾。\n\n**1.3. 结论与行动**\n该问题被认为是**有效的**。我将继续进行求解。\n\n### 第 2 步：求解\n\n预处理后的系统由下式给出\n$$\nP(\\beta)\\,\\frac{\\partial q}{\\partial t} + A\\,\\frac{\\partial q}{\\partial x} = 0\n$$\n乘以预处理矩阵的逆矩阵 $P^{-1}(\\beta)$，我们得到一个标准守恒形式的系统：\n$$\n\\frac{\\partial q}{\\partial t} + P^{-1}(\\beta)A\\,\\frac{\\partial q}{\\partial x} = 0\n$$\n我们将预处理后的通量雅可比矩阵 $A'$ 定义为\n$$\nA' = P^{-1}(\\beta)A\n$$\n给定 $P(\\beta) = \\begin{pmatrix} \\beta  0 \\\\ 0  1 \\end{pmatrix}$，其逆矩阵为 $P^{-1}(\\beta) = \\begin{pmatrix} 1/\\beta  0 \\\\ 0  1 \\end{pmatrix}$。\n因此，\n$$\nA' = \\begin{pmatrix} \\frac{1}{\\beta}  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 0  \\rho a^{2} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix} = \\begin{pmatrix} 0  \\frac{\\rho a^{2}}{\\beta} \\\\ \\frac{1}{\\rho}  0 \\end{pmatrix}\n$$\n空间离散是应用于预处理算子 $A'$ 特征变量的一阶迎风格式。为此，我们首先需要找到 $A'$ 的特征值和特征向量，这将使我们能够解耦该系统。\n\n$A'$ 的特征值 $\\lambda'$ 是特征方程 $\\det(A' - \\lambda'I) = 0$ 的根。\n$$\n\\det\\begin{pmatrix} -\\lambda'  \\frac{\\rho a^{2}}{\\beta} \\\\ \\frac{1}{\\rho}  -\\lambda' \\end{pmatrix} = (-\\lambda')^2 - \\left(\\frac{\\rho a^{2}}{\\beta}\\right)\\left(\\frac{1}{\\rho}\\right) = (\\lambda')^2 - \\frac{a^2}{\\beta} = 0\n$$\n代表预处理系统特征速度的特征值为：\n$$\n\\lambda'_{1,2} = \\pm \\frac{a}{\\sqrt{\\beta}}\n$$\n我们可以定义一个到特征变量 $w$ 的变换，使得系统 $\\frac{\\partial q}{\\partial t} + A' \\frac{\\partial q}{\\partial x} = 0$ 成为一组解耦的标量平流方程：\n$$\n\\frac{\\partial w_k}{\\partial t} + \\lambda'_k \\frac{\\partial w_k}{\\partial x} = 0, \\quad k=1, 2\n$$\n问题为这些特征方程指定了一阶迎风空间离散，并结合前向欧拉时间步进。对于一个一般的标量平流方程 $\\frac{\\partial w}{\\partial t} + c \\frac{\\partial w}{\\partial x} = 0$，其格式为：\n$$\n\\frac{w_j^{n+1} - w_j^n}{\\Delta t} + c \\frac{w_j^n - w_{j-1}^n}{\\Delta x} = 0 \\quad \\text{如果 } c > 0\n$$\n$$\n\\frac{w_j^{n+1} - w_j^n}{\\Delta t} + c \\frac{w_{j+1}^n - w_j^n}{\\Delta x} = 0 \\quad \\text{如果 } c  0\n$$\n这里，$j$ 是网格点索引，$n$ 是时间层。\n\n对于我们的第一个特征场，我们有 $\\lambda'_1 = \\frac{a}{\\sqrt{\\beta}} > 0$。离散化方程为：\n$$\nw_{1,j}^{n+1} = w_{1,j}^n - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (w_{1,j}^n - w_{1,j-1}^n)\n$$\n对于我们的第二个特征场，我们有 $\\lambda'_2 = -\\frac{a}{\\sqrt{\\beta}}  0$。离散化方程为：\n$$\nw_{2,j}^{n+1} = w_{2,j}^n - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (w_{2,j+1}^n - w_{2,j}^n)\n$$\n现在我们进行 von Neumann 稳定性分析。我们代入单个傅里叶模态 $w_j^n = \\hat{w}^n e^{i \\theta j}$，其中 $\\theta = k \\Delta x$ 是无量纲波数。\n\n对于第一个方程（其中 $\\lambda'_1 > 0$）：\n$$\n\\hat{w}_1^{n+1} e^{i\\theta j} = \\hat{w}_1^n e^{i\\theta j} - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (\\hat{w}_1^n e^{i\\theta j} - \\hat{w}_1^n e^{i\\theta (j-1)})\n$$\n除以 $\\hat{w}_1^n e^{i\\theta j}$，我们得到放大因子 $g_1 = \\hat{w}_1^{n+1} / \\hat{w}_1^n$：\n$$\ng_1 = 1 - \\frac{\\lambda'_1 \\Delta t}{\\Delta x} (1 - e^{-i\\theta})\n$$\n为保证稳定性，我们要求对于所有 $\\theta$ 都有 $|g_1| \\leq 1$。令 $\\nu_1 = \\frac{\\lambda'_1 \\Delta t}{\\Delta x} = \\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x}$。\n$$\n|g_1|^2 = |1 - \\nu_1(1 - \\cos\\theta + i\\sin\\theta)|^2 = |(1 - \\nu_1 + \\nu_1\\cos\\theta) - i\\nu_1\\sin\\theta|^2\n$$\n$$\n|g_1|^2 = (1 - \\nu_1 + \\nu_1\\cos\\theta)^2 + (\\nu_1\\sin\\theta)^2\n$$\n$$\n|g_1|^2 = (1-\\nu_1)^2 + 2\\nu_1(1-\\nu_1)\\cos\\theta + \\nu_1^2\\cos^2\\theta + \\nu_1^2\\sin^2\\theta\n$$\n$$\n|g_1|^2 = 1 - 2\\nu_1 + \\nu_1^2 + 2\\nu_1(1-\\nu_1)\\cos\\theta + \\nu_1^2\n$$\n$$\n|g_1|^2 = 1 - 2\\nu_1(1-\\nu_1) - 2\\nu_1(1-\\nu_1)\\cos\\theta = 1 + 2\\nu_1(\\nu_1-1)(1-\\cos\\theta)\n$$\n由于 $\\nu_1 > 0$ 且 $1-\\cos\\theta \\ge 0$，要使 $|g_1|^2 \\le 1$，我们必须有 $2\\nu_1(\\nu_1-1) \\le 0$，这意味着 $\\nu_1-1 \\le 0$，即 $\\nu_1 \\le 1$。这是一阶迎风格式的标准 CFL 条件。\n\n对于第二个方程（其中 $\\lambda'_2  0$）：\n$$\n\\hat{w}_2^{n+1} e^{i\\theta j} = \\hat{w}_2^n e^{i\\theta j} - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (\\hat{w}_2^n e^{i\\theta (j+1)} - \\hat{w}_2^n e^{i\\theta j})\n$$\n放大因子 $g_2 = \\hat{w}_2^{n+1} / \\hat{w}_2^n$ 为：\n$$\ng_2 = 1 - \\frac{\\lambda'_2 \\Delta t}{\\Delta x} (e^{i\\theta} - 1)\n$$\n令 $\\nu_2 = \\frac{|\\lambda'_2| \\Delta t}{\\Delta x} = \\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x}$。注意 $\\nu_2 = \\nu_1$。$g_2$ 的表达式变为：\n$$\ng_2 = 1 + \\nu_2 (e^{i\\theta} - 1)\n$$\n对 $|g_2|^2$ 进行类似的计算得到：\n$$\n|g_2|^2 = |(1 - \\nu_2 + \\nu_2\\cos\\theta) + i\\nu_2\\sin\\theta|^2 = 1 + 2\\nu_2(\\nu_2-1)(1-\\cos\\theta)\n$$\n这导致了相同的稳定性要求，$\\nu_2 \\le 1$。\n\n系统的稳定性要求所有特征分量都稳定。由于 $\\nu_1 = \\nu_2$，唯一的条件是：\n$$\n\\frac{a \\Delta t}{\\sqrt{\\beta} \\Delta x} \\le 1\n$$\n问题将常规声学 CFL 数定义为 $\\mathrm{CFL}_{a} = \\frac{a \\Delta t}{\\Delta x}$。将这个定义代入我们的稳定性条件，我们得到：\n$$\n\\frac{\\mathrm{CFL}_{a}}{\\sqrt{\\beta}} \\le 1\n$$\n$$\n\\mathrm{CFL}_{a} \\le \\sqrt{\\beta}\n$$\n这个不等式定义了 $(\\beta,\\mathrm{CFL}_{a})$ 平面内的稳定区域。该区域的边界对应于最大允许 CFL 数。因此，$\\mathrm{CFL}_{a}$ 的最大值由下式给出：\n$$\n\\mathrm{CFL}_{a, \\max} = \\sqrt{\\beta}\n$$\n该表达式表示了作为预处理参数 $\\beta$ 函数的稳定性边界。对于未预处理的情况（$\\beta=1$），我们恢复了标准的声学 CFL 限制，$\\mathrm{CFL}_{a} \\le 1$。对于 $\\beta  1$，预处理收紧了此显式格式的稳定性限制。",
            "answer": "$$\n\\boxed{\\sqrt{\\beta}}\n$$"
        },
        {
            "introduction": "稳态预处理的一个基石原则是，它应在不改变最终物理精确解的情况下加速收敛。这个动手编码练习要求您设计一个验证测试来证实这一原则。通过将数值结果与已知的槽道流解析解进行比较，您将学习如何构建一个健壮的测试，该测试不仅能验证正确实施的预处理，而且足够灵敏以检测常见的实施错误。",
            "id": "4006439",
            "problem": "设计并实现一个自洽的计算验证测试，用于评估在低马赫数下，可压缩求解器中的 Weiss–Smith 预处理方法是否能保持充分发展的管道流中正确的摩擦和压降。该测试必须根据基本定律和经过充分检验的公式来构建，并且必须为一小组参数值生成可量化的、单位一致的输出。\n\n使用以下物理和数学基础来推导验证量：\n\n- 假设流动是等温的，并在高度为 $2H$ 的直通道中充分发展，其性质恒定，并且在低马赫数 $M=0.1$ 时轴向密度变化可忽略不计。\n- 马赫数定义为 $M = U/a$，其中 $U$ 是体速度（截面平均速度），$a$ 是声速，由 $a = \\sqrt{\\gamma R T}$ 给出，其中 $\\gamma$ 是比热比，$R$ 是比气体常数，$T$ 是绝对温度。\n- 气体密度根据理想气体定律计算为 $\\rho = p/(R T)$，其中 $p$ 是静压。\n- 基于水力直径的雷诺数是 $Re = \\frac{\\rho U D_h}{\\mu}$，对于宽平行板通道，水力直径 $D_h = 2H$，动力粘度 $\\mu$ 假定为已知常数。\n- 达西摩擦因子 $f_D$ 通过内部流动的达西-魏斯巴赫关系式由压力梯度定义，\n$$\n\\frac{dp}{dx} = - f_D \\frac{\\rho U^2}{2 D_h}.\n$$\n对于平行板通道中的层流，使用经过充分检验的关系式\n$$\nf_D = \\frac{96}{Re},\n$$\n对于光滑管道中的湍流（使用水力直径作为特征长度），使用 Blasius 关系式\n$$\nf_D = 0.3164 Re^{-0.25},\n$$\n该关系式在通常应用于光滑壁条件的 $Re$ 范围内有效。\n\n- Weiss–Smith 预处理通过缩放在低马赫数下与压力波相关的传播速度来修改可压缩方程。一个常用的预处理参数可以表示为基于以下公式的伪声速缩放：\n$$\n\\beta(M, M_{\\mathrm{cut}}) = \\max(M^2, M_{\\mathrm{cut}}^2),\n$$\n其中 $M_{\\mathrm{cut}}$ 是一个小的正常数截止马赫数，确保当 $M \\to 0$ 时雅可比矩阵是良态的。对于稳态问题，预处理矩阵仅乘以状态向量的时间导数，不改变稳态空间残差。\n\n你必须在代码中实现以下内容：\n\n1.  对于每个测试用例，计算声速 $a = \\sqrt{\\gamma R T}$、体速度 $U = M a$、密度 $\\rho = p/(R T)$、水力直径 $D_h = 2 H$ 和雷诺数 $Re = \\rho U D_h / \\mu$。\n\n2.  使用适当的关系式（如果 $Re \\le Re_{\\mathrm{crit}}$ 则为层流，否则为湍流，其中 $Re_{\\mathrm{crit}} = 2300$），计算达西摩擦因子 $f_D$。\n\n3.  使用达西-魏斯巴赫关系式计算压力梯度 $\\frac{dp}{dx}$，然后计算长度为 $L$ 的总压降 $\\Delta p = \\left|\\frac{dp}{dx}\\right| L$。以 $\\mathrm{Pa}$ 为单位表示 $\\Delta p$。\n\n4.  通过断言摩擦因子和压降不受预处理影响，即“预处理”的预测等于参考预测，来模拟一个物理上正确的稳态预处理情景。\n\n5.  通过错误地使用源自预处理参数的因子（例如 $s_{\\mathrm{bad}} = 1/\\beta(M, M_{\\mathrm{cut}})$）来缩放粘性/摩擦效应，从而模拟一个不正确的预处理情景，并计算由此产生的“不正确”的摩擦因子和压降。这代表了一种常见的实施错误，即稳态残差被不当地修改。\n\n6.  对每个测试用例评估以下验证标准：\n    - 在正确预处理下的不变性：预处理摩擦因子与参考摩擦因子之间的相对差异，以及预处理压降与参考压降之间的相对差异，都必须小于一个容差 $\\varepsilon = 10^{-10}$（无量纲）。\n    - 在不正确预处理下的敏感性：不正确缩放的压降与参考压降之间的相对差异必须至少为 $10^{-3}$（无量纲），表明测试会检测到该错误。\n\n7.  对于每个测试用例，返回一个布尔值：如果不变性标准和不正确预处理的敏感性标准都满足，则为真；否则为假。\n\n使用以下常数和测试套件：\n\n- 物理常数和性质：\n  - 比热比 $\\gamma = 1.4$。\n  - 空气的比气体常数 $R = 287\\,\\mathrm{J/(kg\\,K)}$。\n  - 温度 $T = 300\\,\\mathrm{K}$。\n  - 静压 $p = 101325\\,\\mathrm{Pa}$。\n  - 动力粘度 $\\mu = 1.8\\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$。\n  - 马赫数 $M = 0.1$。\n  - 预处理截止马赫数 $M_{\\mathrm{cut}} = 0.05$。\n  - 临界雷诺数 $Re_{\\mathrm{crit}} = 2300$。\n\n- 测试套件（通道半高 $H$ 和长度 $L$，单位为米）：\n  - 用例 1（层流）：$H = 2.0\\times 10^{-4}$，$L = 2.0$。\n  - 用例 2（近过渡区）：$H = 4.9\\times 10^{-4}$，$L = 3.0$。\n  - 用例 3（湍流）：$H = 2.0\\times 10^{-2}$，$L = 5.0$。\n\n你的程序应该生成一行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，\"[result1,result2,result3]\"），其中每个结果是对应一个测试用例通过/失败的布尔值。压降必须以 $\\mathrm{Pa}$ 为单位计算，所有相对差异均为指定的无量纲小数。此问题不涉及角度。",
            "solution": "目标是为应用于低马赫数可压缩流求解器的 Weiss–Smith 预处理方法设计并实现一个计算验证测试。该测试基于充分发展的等温管道流这一典型问题。其目的有二：首先，验证正确实施的预处理方案不会改变稳态物理场解；其次，证明该测试足够敏感，能够检测出一种常见的实施错误。\n\n此验证测试的基础在于，将模拟求解器的输出与已知的解析解或公认的经验解进行比较。物理系统是气体流经一个全高为 $2H$ 的宽平行板通道。在指定条件下——等温、充分发展、低马赫数（$M=0.1$）——流动性质可以从基本原理确定。\n\n首先，我们建立参考状态。气体性质由给定的状态变量和常数确定。声速 $a$ 由理想气体的公式给出：\n$$a = \\sqrt{\\gamma R T}$$\n其中 $\\gamma$ 是比热比，$R$ 是比气体常数，$T$ 是绝对温度。体速度 $U$ 通过马赫数 $M = U/a$ 定义。气体密度 $\\rho$ 根据理想气体定律计算：\n$$\\rho = \\frac{p}{R T}$$\n其中 $p$ 是静压。\n\n流动状态由基于水力直径 $D_h$ 的雷诺数 $Re$ 来表征。对于宽平行板通道，水力直径为 $D_h = 2H$。因此雷诺数为：\n$$Re = \\frac{\\rho U D_h}{\\mu}$$\n其中 $\\mu$ 是恒定的动力粘度。\n\n沿通道的压降由壁面上的粘性摩擦决定。这种关系由达西-魏斯巴赫方程量化，该方程根据轴向压力梯度 $\\frac{dp}{dx}$ 定义了达西摩擦因子 $f_D$：\n$$\\frac{dp}{dx} = -f_D \\frac{\\rho U^2}{2 D_h}$$\n为了获得摩擦因子的参考值，我们使用依赖于雷诺数的、经过充分验证的关系式。对于层流，此处定义为 $Re \\le Re_{\\mathrm{crit}} = 2300$，通道流的精确解析解为：\n$$f_D = \\frac{96}{Re}$$\n对于光滑通道中的湍流（$Re > 2300$），经验性的 Blasius 关系式提供了一个可靠的近似：\n$$f_D = 0.3164 Re^{-0.25}$$\n一旦使用适当的关系式计算出参考摩擦因子 $f_{D, \\text{ref}}$，就可以计算参考压力梯度。在长度为 $L$ 的通道上的总参考压降，记作 $\\Delta p_{\\text{ref}}$，则为：\n$$\\Delta p_{\\text{ref}} = \\left| \\frac{dp}{dx}_{\\text{ref}} \\right| L$$\n\n接下来，我们根据 Weiss–Smith 预处理的性质构建验证标准。这种数值技术旨在通过修改控制方程的时间相关部分来改善求解器在低马赫数下的收敛速度。该方程组可以抽象地写为 $\\mathbf{\\Gamma} \\frac{\\partial \\mathbf{Q}}{\\partial t} + \\mathcal{R}(\\mathbf{Q}) = 0$，其中 $\\mathbf{Q}$ 是守恒变量的向量，$\\mathcal{R}(\\mathbf{Q})$ 代表通量和源项的空间离散化（稳态残差），而 $\\mathbf{\\Gamma}$ 是预处理矩阵。该方法的一个关键原则是，对于稳态问题（$\\frac{\\partial \\mathbf{Q}}{\\partial t} = 0$），方程简化为 $\\mathcal{R}(\\mathbf{Q}) = 0$。因此，预处理矩阵 $\\mathbf{\\Gamma}$ 对最终收敛的稳态解没有影响。\n\n这个原则直接引出第一个验证标准：**不变性**。一个正确预处理的求解器必须产生与非预处理求解器相同的稳态解。我们通过断言“正确预处理”的摩擦因子 $f_{D, \\text{correct}}$ 和压降 $\\Delta p_{\\text{correct}}$ 与其参考值相同来模拟这一点。测试会检查其相对差异是否低于机器精度容差 $\\varepsilon = 10^{-10}$：\n$$\\frac{|f_{D, \\text{correct}} - f_{D, \\text{ref}}|}{f_{D, \\text{ref}}}  \\varepsilon \\quad \\text{和} \\quad \\frac{|\\Delta p_{\\text{correct}} - \\Delta p_{\\text{ref}}|}{\\Delta p_{\\text{ref}}}  \\varepsilon$$\n\n一个鲁棒的验证测试还必须能够检测错误。我们模拟一个可能的实现缺陷，即预处理矩阵中使用的缩放因子错误地“泄漏”到稳态残差的计算中。Weiss–Smith 预处理参数基于 $\\beta(M, M_{\\mathrm{cut}}) = \\max(M^2, M_{\\mathrm{cut}}^2)$。一个常见的缺陷是错误地将残差中的某一项乘以一个与预处理相关的因子，例如 $s_{\\text{bad}} = 1/\\beta$。我们通过假设粘性/摩擦效应被此因子缩放来模拟这个错误。这导致一个不正确的摩擦因子 $f_{D, \\text{bad}} = f_{D, \\text{ref}} \\cdot s_{\\text{bad}}$，并因此产生一个不正确的压降 $\\Delta p_{\\text{bad}} = \\Delta p_{\\text{ref}} \\cdot s_{\\text{bad}}$。\n\n这引出第二个验证标准：**敏感性**。测试必须足够敏感以标记此错误。我们检查不正确计算的压降与参考值之间的相对差异是否足够大，具体来说要大于 $10^{-3}$ 的阈值：\n$$\\frac{|\\Delta p_{\\text{bad}} - \\Delta p_{\\text{ref}}|}{\\Delta p_{\\text{ref}}} \\ge 10^{-3}$$\n\n对于每个由特定通道几何形状（$H, L$）定义的测试用例，流程如下：\n1.  计算恒定的物理性质 $a, U, \\rho$。\n2.  计算特定用例的 $D_h$ 和 $Re$。\n3.  根据流动状态（层流或湍流）确定 $f_{D, \\text{ref}}$。\n4.  计算参考压降 $\\Delta p_{\\text{ref}}$。\n5.  通过将参考值与自身比较来检查不变性标准，这将产生一个为 $0$ 的相对误差。\n6.  计算不正确缩放的压降 $\\Delta p_{\\text{bad}}$ 并检查敏感性标准。\n7.  当且仅当不变性和敏感性标准都满足时，该测试用例才算通过。这证实了该测试能正确识别真实解，并且能够检测到植入的错误。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Designs and implements a computational verification test for Weiss–Smith\n    preconditioning in a compressible solver at low Mach number.\n    \"\"\"\n\n    # Define physical constants and properties\n    GAMMA = 1.4  # Ratio of specific heats\n    R_GAS = 287.0  # Specific gas constant for air in J/(kg K)\n    TEMP = 300.0  # Temperature in K\n    PRESSURE = 101325.0  # Static pressure in Pa\n    MU = 1.8e-5  # Dynamic viscosity in kg/(m s)\n    MACH = 0.1  # Mach number\n    M_CUT = 0.05  # Preconditioning cutoff Mach number\n    RE_CRIT = 2300.0  # Critical Reynolds number for transition\n\n    # Test suite: (H, L) where H is half-height and L is length, in meters\n    test_cases = [\n        (2.0e-4, 2.0),  # Case 1: Laminar\n        (4.9e-4, 3.0),  # Case 2: Near transition\n        (2.0e-2, 5.0),  # Case 3: Turbulent\n    ]\n\n    # Pre-compute constant fluid properties\n    a = np.sqrt(GAMMA * R_GAS * TEMP)  # Speed of sound\n    U = MACH * a  # Bulk velocity\n    rho = PRESSURE / (R_GAS * TEMP)  # Density\n\n    results = []\n    for h_half, length in test_cases:\n        # Step 1: Compute derived quantities for the specific case\n        d_h = 2.0 * h_half  # Hydraulic diameter\n        reynolds_num = (rho * U * d_h) / MU\n\n        # Step 2: Compute the reference Darcy friction factor\n        if reynolds_num = RE_CRIT:\n            # Laminar flow correlation\n            f_d_ref = 96.0 / reynolds_num\n        else:\n            # Turbulent flow correlation (Blasius)\n            f_d_ref = 0.3164 * (reynolds_num**-0.25)\n        \n        # Step 3: Compute the reference pressure drop\n        dp_dx_ref = -f_d_ref * (rho * U**2) / (2.0 * d_h)\n        delta_p_ref = abs(dp_dx_ref) * length\n\n        # Step 4: Emulate correct preconditioning (no change to steady state)\n        # By definition, the correct preconditioned results are the reference ones.\n        f_d_correct = f_d_ref\n        delta_p_correct = delta_p_ref\n\n        # Step 5: Emulate incorrect preconditioning (residual scaled)\n        beta = max(MACH**2, M_CUT**2)\n        s_bad = 1.0 / beta\n        \n        # The error scales the friction effect, thus scaling the friction factor\n        # and the resulting pressure drop.\n        f_d_bad = f_d_ref * s_bad\n        delta_p_bad = delta_p_ref * s_bad\n\n        # Step 6: Evaluate verification criteria\n        \n        # Invariance under correct preconditioning\n        # The relative differences should be zero (or within machine epsilon).\n        rel_diff_fd_correct = abs(f_d_correct - f_d_ref) / f_d_ref if f_d_ref != 0 else 0\n        rel_diff_dp_correct = abs(delta_p_correct - delta_p_ref) / delta_p_ref if delta_p_ref != 0 else 0\n        \n        invariance_passed = (rel_diff_fd_correct  1e-10) and (rel_diff_dp_correct  1e-10)\n\n        # Sensitivity to incorrect preconditioning\n        # The relative difference must be large enough to be detected.\n        rel_diff_dp_bad = abs(delta_p_bad - delta_p_ref) / delta_p_ref if delta_p_ref != 0 else 0\n        \n        sensitivity_passed = rel_diff_dp_bad >= 1e-3\n\n        # Step 7: Final result for the test case\n        # The test is valid if it passes the correct case and flags the bad one.\n        case_result = invariance_passed and sensitivity_passed\n        results.append(case_result)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}