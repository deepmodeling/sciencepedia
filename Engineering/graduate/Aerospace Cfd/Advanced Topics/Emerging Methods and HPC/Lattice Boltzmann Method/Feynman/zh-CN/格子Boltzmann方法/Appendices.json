{
    "hands_on_practices": [
        {
            "introduction": "格子玻尔兹曼方法（LBM）的核心在于它能够在微观尺度上通过粒子分布函数的演化来模拟宏观流体动力学。本练习将引导你通过Chapman-Enskog展开，从离散的格子玻尔兹曼方程中推导出宏观的Navier-Stokes方程，从而建立微观弛豫时间 $\\tau$ 与宏观运动粘度 $\\nu$ 之间的关键联系。掌握这一推导过程，是确保LBM模拟能够准确再现具有特定物理粘度的流体行为的理论基石。",
            "id": "3971752",
            "problem": "考虑将单弛豫时间 Bhatnagar–Gross–Krook (BGK) 格子玻尔兹曼方法 (LBM) 应用于航空航天计算流体动力学 (CFD) 中使用的三维十九速 ($D3Q19$) 离散速度集上的不可压缩流。离散速度的构造方式使得迁移过程在每个时间步长内将布居数沿每个离散方向推进一个格子间距，并且平衡态的二阶各向同性确保了格子声速的平方 $c_{s}^{2}$ 与 $D3Q19$ 求积格式相符。给定物理运动粘度 $ \\nu_{phys} $（单位为 $L^{2}/T$）、格子间距 $ \\Delta x $（单位为 $L$）和时间步长 $ \\Delta t $（单位为 $T$）。\n\n从带有 BGK 碰撞算子的动理学输运方程、宏观矩的定义以及粘性应力的牛顿本构关系出发，执行 Chapman–Enskog 展开，以在流体动力学极限下为 $D3Q19$ 格子推导出 Navier–Stokes 方程。通过此推导，求出弛豫时间 $ \\tau $ 的解析表达式，该表达式是离散模型在由 $ \\Delta x $ 和 $ \\Delta t $ 表征的给定格子上再现目标物理粘度 $ \\nu_{phys} $ 所必需的。使用 $D3Q19$ 的值 $ c_{s}^{2} = 1/3 $。将你的最终答案表示为关于 $ \\tau $ 的单个闭式表达式。\n\n此外，基于相同的推导，确定确保该方法在低马赫数极限下保持耗散性和精确性的关于 $ \\tau $、$ \\Delta x $ 和 $ \\Delta t $ 的主要数值约束。你对约束的评论必须得到从流体动力学极限中出现的标度关系的支持，但最终报告的答案必须仍然是关于 $ \\tau $ 的单个表达式。不需要进行数值代入。最终答案以无单位形式表示。",
            "solution": "该问题被验证为具有科学依据、适定且客观。它展示了计算流体动力学领域一个标准的、非平凡的推导，特别涉及格子玻尔兹曼方法 (LBM)。所有前提在事实上都是正确的，并且提供了所有必需的信息。\n\n目标是推导 $D3Q19$ 格子上 Bhatnagar–Gross–Krook (BGK) 模型的单弛豫时间 $\\tau$ 与物理运动粘度 $\\nu_{phys}$ 之间的关系。这通过 Chapman–Enskog 展开从离散格子玻尔兹曼方程恢复宏观 Navier–Stokes 方程来实现。\n\n我们从带有 BGK 碰撞算子的离散格子玻尔兹曼方程 (LBE) 开始。为清晰起见，我们将首先在格子单位中进行推导，其中格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$。离散粒子速度用 $\\mathbf{e}_i$ 表示，格子上的光速为 $c=1$。LBE 方程为：\n$$ f_i(\\mathbf{x} + \\mathbf{e}_i, t+1) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)] $$\n其中 $f_i$ 是沿第 $i$ 个方向的粒子分布函数，$\\mathbf{x}$ 和 $t$ 是格子坐标和时间，$\\tau$ 是无量纲弛豫时间。对于低马赫数流，平衡分布函数 $f_i^{eq}$ 是关于宏观速度 $\\mathbf{u}$ 的二阶展开：\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u}^2}{2c_s^2} \\right) $$\n此处，$w_i$是 $D3Q19$ 格子权重，$\\rho$ 是宏观密度，$c_s$ 是格子声速，给定为 $c_s^2 = 1/3$。宏观密度和动量是分布函数的矩：\n$$ \\rho = \\sum_i f_i = \\sum_i f_i^{eq} $$\n$$ \\rho \\mathbf{u} = \\sum_i f_i \\mathbf{e}_i = \\sum_i f_i^{eq} $$\nBGK 碰撞算子守恒质量和动量，这意味着 $\\sum_i (f_i - f_i^{eq}) = 0$ 和 $\\sum_i \\mathbf{e}_i (f_i - f_i^{eq}) = 0$。\n\n为恢复宏观方程，我们进行 Chapman–Enskog 展开。我们引入一个小参数 $\\epsilon$（与 Knudsen 数和马赫数成正比），并假设分布函数以及时间和空间导数可以在多尺度上展开：\n- $f_i = f_i^{(0)} + \\epsilon f_i^{(1)} + \\epsilon^2 f_i^{(2)} + \\mathcal{O}(\\epsilon^3)$\n- $\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}$\n- $\\nabla = \\epsilon \\nabla_1$\n\n我们首先对离散 LBE 在时间步长（在格子单位中为 1）上进行泰勒展开：\n$$ (\\partial_t + \\mathbf{e}_i \\cdot \\nabla)f_i + \\frac{1}{2}(\\partial_t + \\mathbf{e}_i \\cdot \\nabla)^2 f_i + \\mathcal{O}(\\Delta t^3) = -\\frac{1}{\\tau}(f_i - f_i^{eq}) $$\n按照 Chapman-Enskog 过程的惯例，我们强制要求宏观变量完全由平衡分布捕捉，即 $f_i^{(0)} = f_i^{eq}$，并且非平衡部分对质量和动量的贡献为零：对于 $k \\ge 1$，有 $\\sum_i f_i^{(k)}=0$ 和 $\\sum_i \\mathbf{e}_i f_i^{(k)}=0$。\n\n将多尺度展开代入泰勒展开的 LBE 中，并按 $\\epsilon$ 的幂次收集各项：\n\n$\\epsilon^1$ 阶：\n$$ (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(1)} $$\n这给出了一阶非平衡分布的表达式：\n$$ f_i^{(1)} = -\\tau (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha}) f_i^{(0)} $$\n\n$\\epsilon^2$ 阶：\n$$ \\partial_{t_2} f_i^{(0)} + (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(1)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n将 $f_i^{(1)}$ 的表达式代入第二项：\n$$ \\partial_{t_2} f_i^{(0)} - \\tau (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n这简化为：\n$$ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\n现在，我们对这些尺度化的方程取矩，以找到宏观控制方程。对 $\\mathcal{O}(\\epsilon^1)$ 方程取矩得到可压缩欧拉方程（在第一时间尺度上的质量和动量守恒）。此尺度上的动量方程为：\n$$ \\partial_{t_1}(\\rho u_\\beta) + \\partial_{1\\alpha} \\Pi_{\\alpha\\beta}^{(0)} = 0 $$\n其中 $\\Pi_{\\alpha\\beta}^{(0)} = \\sum_i e_{i\\alpha}e_{i\\beta} f_i^{(0)} = \\rho u_\\alpha u_\\beta + p \\delta_{\\alpha\\beta}$ 是平衡动量通量张量，压力 $p = \\rho c_s^2$。\n\n为找到粘性项，我们对 $\\mathcal{O}(\\epsilon^2)$ 方程取一阶矩（乘以 $e_{i\\beta}$ 并对 $i$ 求和）。由于守恒约束，右侧的项 $\\sum_i e_{i\\beta} f_i^{(2)}$ 为零。\n$$ \\sum_i e_{i\\beta} \\left[ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} \\right] = 0 $$\n$$ \\partial_{t_2}(\\rho u_\\beta) - \\left(\\tau - \\frac{1}{2}\\right) \\sum_i e_{i\\beta} (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = 0 $$\n第二项包含粘性贡献。在低马赫数极限下，时间导数是比空间导数更高阶的马赫数项，因此我们近似 $(\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 \\approx (e_{i\\alpha} \\partial_{1\\alpha})^2$。该项变为：\n$$ \\partial_{1\\gamma} \\partial_{1\\delta} \\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} $$\n这是平衡分布三阶矩的导数。对于低马赫数，$\\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} \\approx \\rho c_s^2 (u_\\beta \\delta_{\\gamma\\delta} + u_\\gamma \\delta_{\\beta\\delta} + u_\\delta \\delta_{\\beta\\gamma})$。\n应用导数并假设流体不可压缩（$\\nabla \\cdot \\mathbf{u} = 0$），此项计算结果为 $\\rho c_s^2 \\nabla_1^2 u_\\beta$。那么，$\\mathcal{O}(\\epsilon^2)$ 尺度上的动量方程为：\n$$ \\partial_{t_2}(\\rho u_\\beta) = \\left(\\tau - \\frac{1}{2}\\right) \\rho c_s^2 \\nabla_1^2 u_\\beta $$\n结合来自 $\\epsilon^1$ 和 $\\epsilon^2$ 尺度的动量方程，并恢复到物理尺度导数（$\\partial_t, \\nabla$）：\n$$ \\partial_t(\\rho u_\\beta) + \\partial_\\alpha(\\rho u_\\alpha u_\\beta) = -\\partial_\\beta p + \\rho c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\nabla^2 u_\\beta $$\n这就是不可压缩 Navier–Stokes 方程：\n$$ \\rho(\\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta) = -\\partial_\\beta p + \\mu \\nabla^2 u_\\beta $$\n其中 $\\mu$ 是动力粘度。除以 $\\rho$ 得到用运动粘度 $\\nu = \\mu/\\rho$ 表示的方程：\n$$ \\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta = -\\frac{1}{\\rho}\\partial_\\beta p + \\nu \\nabla^2 u_\\beta $$\n通过比较粘性项，我们确定格子单位下的运动粘度为：\n$$ \\nu_{latt} = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) $$\n这个表达式关联了格子模拟的无量纲参数。为了找到物理粘度 $\\nu_{phys}$，我们必须引入物理格子间距 $\\Delta x$ 和时间步长 $\\Delta t$。运动粘度的单位是 $[L^2/T]$。从格子单位到物理单位的转换因子是：\n$$ \\nu_{phys} = \\nu_{latt} \\frac{\\Delta x^2}{\\Delta t} $$\n将 $\\nu_{latt}$ 的表达式和给定的值 $c_s^2 = 1/3$ 代入：\n$$ \\nu_{phys} = \\frac{1}{3} \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t} $$\n对此方程求解弛豫时间 $\\tau$，得到所需的表达式：\n$$ 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\tau - \\frac{1}{2} $$\n$$ \\tau = 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2} $$\n\n基于此推导，我们可以确定两个关键约束。\n首先，为使方法在物理上是耗散的且在数值上是稳定的，格子粘度必须为正，即 $\\nu_{latt} > 0$。由于 $c_s^2 > 0$，这对弛豫时间施加了一个基本约束：\n$$ \\tau > \\frac{1}{2} $$\n其次，Chapman-Enskog 展开仅在流体动力学极限下有效，在该极限下，平均自由程远小于特征流动长度。在 LBM 中，平均自由程与 $\\nu_{latt} \\propto (\\tau - 1/2)$ 成正比。$\\tau$ 的较大值意味着偏离此极限，从而导致不精确。因此，$\\tau$ 必须保持在 1 的量级，例如 $\\tau \\sim 1$。这对网格参数的选择施加了约束：\n$$ \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\frac{1}{3}\\left(\\tau - \\frac{1}{2}\\right) = \\mathcal{O}(1) $$\n这是 LBM 的扩散标度关系，它要求当网格加密时（$\\Delta x \\to 0$），时间步长必须以平方级减小（$\\Delta t \\propto \\Delta x^2$）以保持 $\\tau$ 不变。这必须与对流标度约束（$\\Delta t \\propto \\Delta x$）相平衡，后者是保持低马赫数和控制可压缩性误差所必需的。",
            "answer": "$$\\boxed{3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2}}$$"
        },
        {
            "introduction": "在建立了理论基础之后，下一步是构建一个有效的求解器并验证其准确性。本练习将指导你模拟泰勒-格林涡（Taylor-Green vortex）的粘性衰减过程，这是一个经典的Navier-Stokes方程解析解。通过将模拟得到的动能衰减率与理论预测值进行比较，你不仅可以验证自己代码的正确性，还能掌握计算流体动力学中代码验证和数据分析的基本技能。",
            "id": "3150861",
            "problem": "您将使用二维九速模型（D2Q9）实现一个二维格子玻尔兹曼方法（LBM），以模拟周期性方形域中泰勒-格林涡的粘性衰减。从基本原理出发，利用低马赫数下 LBM 的宏观极限和泰勒-格林涡的结构，推导出动能的指数衰减规律，然后通过从模拟中提取衰减率来对其进行数值验证。\n\n从以下基本基础开始：\n- 在没有平流和压力梯度的情况下，运动粘度为 $\\nu$ 的不可压缩纳维-斯托克斯方程简化为线性动量扩散，即对于傅里叶模速度场 $\\mathbf{u}$，有 $\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}$。\n- 二维空间中的泰勒-格林涡是一个无散速度场，其分量为 $u_x(x,y,0) = U_0 \\sin(k_x x)\\cos(k_y y)$ 和 $u_y(x,y,0) = -U_0 \\cos(k_x x)\\sin(k_y y)$，其中 $U_0$ 是一个小振幅，$k_x$ 和 $k_y$ 是波数。\n- 采用单松弛时间 Bhatnagar–Gross–Krook (BGK) 碰撞的 D2Q9 格子玻尔兹曼方法，在流体动力学极限下可恢复纳维-斯托克斯方程，其运动粘度 $\\nu$ 与松弛时间 $\\tau$ 的关系为 $\\nu = c_s^2(\\tau - \\tfrac{1}{2})$，其中在格子单位下 $c_s^2 = \\tfrac{1}{3}$。\n\n任务要求：\n1. 在 $N_x \\times N_y$ 的格子上实现一个带有 BGK 碰撞和周期性边界的 LBM D2Q9 求解器，格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$，初始密度 $ \\rho_0 = 1$（所有量均为格子单位）。\n2. 使用 $k_x = \\frac{2\\pi m}{N_x}$ 和 $k_y = \\frac{2\\pi m}{N_y}$ 初始化泰勒-格林涡速度场，其中 $m$ 是一个正整数模数。初始振幅使用 $U_0 = 0.05$（格子单位）。将粒子分布函数初始化为与该速度场和密度相对应的平衡态。\n3. 在每个时间步 $t$，计算单位质量的空间平均动能 $E(t) = \\langle \\tfrac{1}{2}(u_x^2 + u_y^2) \\rangle$，其中 $\\langle \\cdot \\rangle$ 表示在整个域上的平均值。\n4. 从控制扩散方程 $\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}$ 和泰勒-格林涡傅里叶模的结构出发，推导出动能 $E(t)$ 的指数衰减定律，以及其衰减率作为 $\\nu$ 和波数的函数的解析表达式。使用此推导出的表达式为每组参数计算理论衰减率 $\\alpha_{\\mathrm{th}}$。\n5. 通过在初始瞬态之后的一个合适时间窗口内，对 $\\ln E(t)$ 与 $t$ 的关系进行最小二乘线性拟合，来数值估算衰减率 $\\alpha_{\\mathrm{meas}}$。时间 $t$ 使用格子时间单位。\n6. 对于每个测试用例，计算并报告相对误差 $\\varepsilon = \\frac{|\\alpha_{\\mathrm{meas}} - \\alpha_{\\mathrm{th}}|}{\\alpha_{\\mathrm{th}}}$。\n\n使用以下 D2Q9 模型规范：\n- 离散速度 $\\mathbf{c}_i$（对于 $i = 0,\\ldots,8$）：$\\mathbf{c}_0 = (0,0)$，$\\mathbf{c}_1 = (1,0)$，$\\mathbf{c}_2 = (0,1)$，$\\mathbf{c}_3 = (-1,0)$，$\\mathbf{c}_4 = (0,-1)$，$\\mathbf{c}_5 = (1,1)$，$\\mathbf{c}_6 = (-1,1)$，$\\mathbf{c}_7 = (-1,-1)$，$\\mathbf{c}_8 = (1,-1)$。\n- 权重 $w_i$：$w_0 = \\tfrac{4}{9}$，$w_{1,2,3,4} = \\tfrac{1}{9}$，$w_{5,6,7,8} = \\tfrac{1}{36}$。\n- 平衡分布 $f_i^{\\mathrm{eq}} = w_i \\rho \\left[1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2 c_s^2}\\right]$，其中 $c_s^2 = \\tfrac{1}{3}$。\n- BGK 碰撞更新 $f_i^{\\mathrm{post}} = f_i - \\frac{1}{\\tau}\\left(f_i - f_i^{\\mathrm{eq}}\\right)$，然后沿着 $\\mathbf{c}_i$ 进行迁移，并采用周期性边界条件。\n\n所有三角函数的角度单位均为弧度。所有量均采用格子单位；无需进行物理单位转换。\n\n测试套件：\n- 用例 1：$N_x = 64$，$N_y = 64$，$\\tau = 0.8$，$m = 1$，总步数 $T = 400$。\n- 用例 2：$N_x = 64$，$N_y = 64$，$\\tau = 1.0$，$m = 2$，总步数 $T = 300$。\n- 用例 3：$N_x = 32$，$N_y = 32$，$\\tau = 0.8$，$m = 1$，总步数 $T = 400$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，每个条目等于相应案例的相对误差 $\\varepsilon$，并四舍五入到三位小数（例如，$[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3]$）。",
            "solution": "问题陈述已经过验证，被认为是合理的。它提出了一个适定且有科学依据的问题，这是计算流体动力学中用于验证像格子玻尔兹曼方法（LBM）这样的数值方案的标准基准问题。理论推导和数值实现所需的所有必要参数和定义均已提供，并与现有文献一致。\n\n### 动能衰减率的理论推导\n\n目标是推导泰勒-格林涡的空间平均动能 $E(t)$ 的解析衰减率 $\\alpha_{\\mathrm{th}}$。分析始于线性化动量扩散方程，该方程描述了在无显著平流和压力作用下速度场 $\\mathbf{u}$ 的演化：\n$$\n\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}\n$$\n其中 $\\nu$ 是运动粘度。\n\n$t=0$ 时的初始速度场由二维泰勒-格林涡给出：\n$$\nu_x(x,y,0) = U_0 \\sin(k_x x)\\cos(k_y y)\n$$\n$$\nu_y(x,y,0) = -U_0 \\cos(k_x x)\\sin(k_y y)\n$$\n该速度场由单个空间傅里叶模组成。我们来验证它是拉普拉斯算子 $\\nabla^2 = \\partial_{xx} + \\partial_{yy}$ 的一个特征函数。将拉普拉斯算子应用于速度的 x 分量：\n$$\n\\nabla^2 u_x(x,y,0) = \\left(\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}\\right) \\left[ U_0 \\sin(k_x x)\\cos(k_y y) \\right]\n$$\n$$\n= U_0 \\left[ (-k_x^2) \\sin(k_x x)\\cos(k_y y) + (-k_y^2) \\sin(k_x x)\\cos(k_y y) \\right]\n$$\n$$\n= -(k_x^2 + k_y^2) [U_0 \\sin(k_x x)\\cos(k_y y)] = -(k_x^2 + k_y^2) u_x(x,y,0)\n$$\n对 y 分量进行类似计算可得 $\\nabla^2 u_y(x,y,0) = -(k_x^2 + k_y^2) u_y(x,y,0)$。因此，整个速度矢量场是拉普拉斯算子的一个特征函数：\n$$\n\\nabla^2 \\mathbf{u}(x,y,0) = -(k_x^2 + k_y^2) \\mathbf{u}(x,y,0)\n$$\n我们假设扩散方程的解形式为 $\\mathbf{u}(x,y,t) = \\mathbf{u}(x,y,0)T(t)$，初始条件为 $T(0)=1$。将其代入控制方程得到：\n$$\n\\mathbf{u}(x,y,0) \\frac{dT(t)}{dt} = \\nu T(t) \\nabla^2 \\mathbf{u}(x,y,0) = -\\nu (k_x^2 + k_y^2) T(t) \\mathbf{u}(x,y,0)\n$$\n这简化为常微分方程 $\\frac{dT}{dt} = -\\nu(k_x^2 + k_y^2)T$，其解为 $T(t) = \\exp\\left(-\\nu(k_x^2 + k_y^2)t\\right)$。因此，速度场按如下方式衰减：\n$$\n\\mathbf{u}(x,y,t) = \\mathbf{u}(x,y,0) e^{-\\nu(k_x^2 + k_y^2)t}\n$$\n单位质量的空间平均动能定义为 $E(t) = \\langle \\frac{1}{2}\\mathbf{u}(t)\\cdot\\mathbf{u}(t) \\rangle$。代入 $\\mathbf{u}(t)$ 的解：\n$$\nE(t) = \\left\\langle \\frac{1}{2} |\\mathbf{u}(x,y,0)|^2 e^{-2\\nu(k_x^2 + k_y^2)t} \\right\\rangle = e^{-2\\nu(k_x^2 + k_y^2)t} \\left\\langle \\frac{1}{2} |\\mathbf{u}(x,y,0)|^2 \\right\\rangle = E(0) e^{-2\\nu(k_x^2 + k_y^2)t}\n$$\n这表明动能呈指数衰减，$E(t) = E(0)e^{-\\alpha_{\\mathrm{th}}t}$，其理论衰减率 $\\alpha_{\\mathrm{th}}$ 为：\n$$\n\\alpha_{\\mathrm{th}} = 2\\nu(k_x^2 + k_y^2)\n$$\n问题以格子单位指定了 LBM 参数。粘度 $\\nu$ 与松弛时间 $\\tau$ 的关系为 $\\nu = c_s^2(\\tau - \\frac{1}{2})$，格子声速的平方 $c_s^2=\\frac{1}{3}$。波数为 $k_x = \\frac{2\\pi m}{N_x}$ 和 $k_y = \\frac{2\\pi m}{N_y}$。对于所有测试用例，$N_x=N_y=N$，因此 $k_x=k_y=k=\\frac{2\\pi m}{N}$。将这些代入 $\\alpha_{\\mathrm{th}}$ 的表达式，得到用于比较的最终解析公式：\n$$\n\\alpha_{\\mathrm{th}} = 2 \\left[ c_s^2(\\tau - \\frac{1}{2}) \\right] \\left( \\left(\\frac{2\\pi m}{N}\\right)^2 + \\left(\\frac{2\\pi m}{N}\\right)^2 \\right) = 4 c_s^2(\\tau - \\frac{1}{2}) \\left(\\frac{2\\pi m}{N}\\right)^2 = \\frac{4}{3}(\\tau - 0.5) \\frac{4\\pi^2 m^2}{N^2} = \\frac{16\\pi^2 m^2}{3N^2}(\\tau - 0.5)\n$$\n\n### 数值模拟与分析\n\n使用 D2Q9 模型实现了一个二维格子玻尔兹曼模拟，以数值方式求解流动演化。\n\n1.  **初始化**: 模拟域是一个 $N_x \\times N_y$ 的格子。初始密度设为均匀值 $\\rho(x,y,0) = \\rho_0=1$。初始速度场 $\\mathbf{u}(x,y,0)$ 设为振幅 $U_0 = 0.05$ 的泰勒-格林涡剖面。九个粒子分布函数 $f_i$ 被初始化为其对应的平衡值 $f_i^{\\mathrm{eq}}$，这些值是局部密度 $\\rho$ 和速度 $\\mathbf{u}$ 的函数：\n    $$\n    f_i(x,y,0) = f_i^{\\mathrm{eq}}(\\rho(x,y,0), \\mathbf{u}(x,y,0)) = w_i \\rho \\left[1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2 c_s^2}\\right]\n    $$\n\n2.  **时间演化**: 模拟以离散时间步进行。每个时间步包括两个主要操作：\n    *   **碰撞**: 首先，通过对当前分布 $f_i$求和来计算宏观密度 $\\rho$ 和速度 $\\mathbf{u}$：$\\rho = \\sum_i f_i$ 和 $\\mathbf{u} = \\frac{1}{\\rho}\\sum_i f_i \\mathbf{c}_i$。然后，根据 Bhatnagar-Gross-Krook (BGK) 碰撞算子，分布函数向新的局部平衡态 $f_i^{\\mathrm{eq}}(\\rho, \\mathbf{u})$ 松弛：\n      $$\n      f_i^{\\mathrm{post}} = f_i - \\frac{1}{\\tau}\\left(f_i - f_i^{\\mathrm{eq}}\\right)\n      $$\n    *   **迁移**: 碰撞后的分布 $f_i^{\\mathrm{post}}$ 被平流到相邻的格点。这表示为 $f_i(\\mathbf{x}+\\mathbf{c}_i \\Delta t, t+\\Delta t) = f_i^{\\mathrm{post}}(\\mathbf{x},t)$。在 $\\Delta t=1$ 的格子单位中，此步骤通过在分布数组上使用循环移位（`numpy.roll`）来高效实现，以强制执行周期性边界条件。\n\n3.  **测量与分析**: 在每个时间步 $t$，计算出宏观速度场 $\\mathbf{u}(t)$ 后，计算空间平均动能 $E(t) = \\langle \\frac{1}{2}(u_x^2 + u_y^2) \\rangle$。模拟完成后，估算数值衰减率 $\\alpha_{\\mathrm{meas}}$。由于 $E(t) \\propto e^{-\\alpha t}$，其自然对数 $\\ln E(t)$ 是时间 $t$ 的斜率为 $-\\alpha$ 的线性函数。在初始非流体动力学瞬态消退后的一个时间窗口（此处选择为 $t \\in [T/4, T-1]$）内，对 $\\ln E(t)$ 与 $t$ 进行最小二乘线性回归。测得的衰减率是此拟合斜率的负值：$\\alpha_{\\mathrm{meas}} = -\\text{slope}$。\n\n最后，为每个测试用例计算相对误差 $\\varepsilon = \\frac{|\\alpha_{\\mathrm{meas}} - \\alpha_{\\mathrm{th}}|}{\\alpha_{\\mathrm{th}}}$，以量化 LBM 模拟的准确性。",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef run_lbm_simulation(Nx, Ny, tau, m, T):\n    \"\"\"\n    为泰勒-格林涡衰减运行 D2Q9 LBM 模拟。\n\n    Args:\n        Nx (int): x 方向的格子尺寸。\n        Ny (int): y 方向的格子尺寸。\n        tau (float): BGK 松弛时间。\n        m (int): 波数模数。\n        T (int): 总时间步数。\n\n    Returns:\n        np.ndarray: 每个时间步的空间平均动能数组。\n    \"\"\"\n    # D2Q9 model parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1/3\n\n    # Reshape weights and velocities for vectorized operations\n    w_reshaped = w.reshape(9, 1, 1)\n\n    # Lattice grid\n    X, Y = np.meshgrid(np.arange(Nx), np.arange(Ny))\n\n    # Initial conditions\n    rho0 = 1.0\n    U0 = 0.05\n    # For all cases Nx = Ny, so kx = ky = k\n    k = 2 * np.pi * m / Nx\n    \n    ux_init = U0 * np.sin(k * X) * np.cos(k * Y)\n    uy_init = -U0 * np.cos(k * X) * np.sin(k * Y)\n\n    rho = np.full((Ny, Nx), rho0)\n\n    # Initialize distribution functions at equilibrium\n    f = np.zeros((9, Ny, Nx))\n    usq_init = ux_init**2 + uy_init**2\n    \n    # Vectorized equilibrium calculation\n    c_dot_u_init = c[:, 0].reshape(9, 1, 1) * ux_init + c[:, 1].reshape(9, 1, 1) * uy_init\n    f = w_reshaped * rho * (1 + c_dot_u_init/cs2 + c_dot_u_init**2/(2*cs2**2) - usq_init/(2*cs2))\n\n    kinetic_energy = np.zeros(T)\n\n    # Main simulation loop\n    for t in range(T):\n        # Macroscopic quantities\n        rho = np.sum(f, axis=0)\n        ux = np.einsum('i,ixy->xy', c[:,0], f) / rho\n        uy = np.einsum('i,ixy->xy', c[:,1], f) / rho\n\n        # Store kinetic energy (spatially averaged)\n        kinetic_energy[t] = 0.5 * np.mean(ux**2 + uy**2)\n\n        # Collision step (vectorized)\n        usq = ux**2 + uy**2\n        c_dot_u = c[:, 0].reshape(9, 1, 1) * ux + c[:, 1].reshape(9, 1, 1) * uy\n        feq = w_reshaped * rho * (1 + c_dot_u/cs2 + c_dot_u**2/(2*cs2**2) - usq/(2*cs2))\n        f -= (1/tau) * (f - feq)\n\n        # Streaming step\n        for i in range(9):\n            f[i, :, :] = np.roll(f[i, :, :], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n    \n    return kinetic_energy\n\ndef solve():\n    \"\"\"\n    为给定的测试套件求解问题。\n    \"\"\"\n    test_cases = [\n        # (Nx, Ny, tau, m, T)\n        (64, 64, 0.8, 1, 400),\n        (64, 64, 1.0, 2, 300),\n        (32, 32, 0.8, 1, 400),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx, Ny, tau, m, T = case\n        \n        # 1. Theoretical decay rate\n        cs2 = 1/3\n        nu = cs2 * (tau - 0.5)\n        k = 2 * np.pi * m / Nx  # kx = ky = k since Nx=Ny\n        alpha_th = 2 * nu * (k**2 + k**2)\n\n        # 2. Run LBM simulation\n        E = run_lbm_simulation(Nx, Ny, tau, m, T)\n        \n        # 3. Numerical decay rate from linear fit\n        # Use a time window after initial transients (e.g., last 3/4 of simulation)\n        fit_start_time = T // 4\n        time_fit = np.arange(fit_start_time, T)\n        \n        # Filter out any non-positive-definite energy values before taking log\n        valid_indices = E[fit_start_time:] > 0\n        if not np.all(valid_indices):\n            # This case shouldn't happen in a stable simulation but is good practice\n            time_fit = time_fit[valid_indices]\n            log_E_fit = np.log(E[fit_start_time:][valid_indices])\n        else:\n            log_E_fit = np.log(E[fit_start_time:])\n            \n        slope = stats.linregress(time_fit, log_E_fit).slope\n        alpha_meas = -slope\n        \n        # 4. Compute relative error\n        relative_error = np.abs(alpha_meas - alpha_th) / alpha_th\n        results.append(relative_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{res:.3f}' for res in results])}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个优秀的数值方法应确保其计算结果与观察者的惯性参考系无关，这一性质被称为伽利略不变性。尽管连续介质的Navier-Stokes方程具备此特性，但其离散近似（如标准LBM）可能会引入误差。本项高级练习将通过一个数值实验来量化库埃特流（Couette flow）模拟中的伽利略不变性误差，从而揭示该方法的实际局限性，并强调在低马赫数范围内进行模拟的重要性。",
            "id": "3971766",
            "problem": "您的任务是使用计算流体动力学（CFD）中的格子玻尔兹曼方法（LBM）来评估二维 Couette 流中的伽利略不变性误差。目标是量化当在 Couette 流上叠加一个均匀的背景平移速度时，计算出的剪切应力会如何偏离。推导和实现必须基于离散 Boltzmann 方程的第一性原理以及单弛豫时间 Bhatnagar–Gross–Krook (BGK) 碰撞算子。\n\n从以下基本基础开始：格子玻尔兹曼方法（LBM）中带有 BGK 弛豫的离散速度 Boltzmann 方程，其中布居数 $f_i$ 在具有离散速度 $\\mathbf{c}_i$ 和求积权重 $w_i$ 的均匀笛卡尔格子上演化。使用标准的二维九速模型（D2Q9），其中离散速度为 $\\mathbf{c}_0=(0,0)$、$\\mathbf{c}_1=(1,0)$、$\\mathbf{c}_2=(0,1)$、$\\mathbf{c}_3=(-1,0)$、$\\mathbf{c}_4=(0,-1)$、$\\mathbf{c}_5=(1,1)$、$\\mathbf{c}_6=(-1,1)$、$\\mathbf{c}_7=(-1,-1)$、$\\mathbf{c}_8=(1,-1)$，权重为 $w_0=\\frac{4}{9}$、$w_{1,2,3,4}=\\frac{1}{9}$、$w_{5,6,7,8}=\\frac{1}{36}$。等温格子声速为 $c_s^2=\\frac{1}{3}$。平衡分布函数 $f_i^{\\mathrm{eq}}$ 是与离散化一致的二阶 Hermite 展开，弛豫时间 $\\tau$ 通过 $\\nu=c_s^2(\\tau-\\frac{1}{2})$ 与运动粘度相关。宏观密度 $\\rho$ 和速度 $\\mathbf{u}$ 分别通过 $f_i$ 的零阶矩和一阶矩恢复。\n\n建立一个高为 $N_y$ 节点、长为 $N_x$ 节点的二维通道，在流向方向上采用周期性边界条件，在两个水平壁面（$y=0$ 和 $y=N_y-1$）处采用速度边界条件。实施标准的 Zou–He 速度边界条件以施加壁面速度。配置一个 Couette 流，其中底壁以速度 $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$ 移动，顶壁以速度 $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$ 移动，其中 $U_0$ 是一个均匀的背景平移速度，$U_\\mathrm{rel}$ 是产生剪切的相对板速度。用均匀密度 $\\rho_0=1$ 和速度 $\\mathbf{u}=(U_0,0)$ 初始化流体。\n\n根据连续介质 Navier–Stokes 方程中的伽利略不变性，对于 Couette 流中的牛顿流体，剪切应力应仅取决于相对速度 $U_\\mathrm{rel}$ 和通道高度，并且在叠加均匀背景速度 $U_0$ 时不应改变。在格子玻尔兹曼方法中，离散化和截断误差会引入伽利略不变性的违背，当 $U_0\\neq 0$ 时，这表现为计算出的剪切应力的偏差。模拟达到稳态后，将剪切应力 $\\tau_{xy}$ 估计为 $\\tau_{xy}=\\bar{\\rho}\\,\\nu\\,\\frac{du_x}{dy}$，其中 $\\bar{\\rho}$ 是区域平均密度，$\\nu$ 是运动粘度，$\\frac{du_x}{dy}$ 是横跨通道的平均流向速度剖面的斜率。通过对周期性方向上平均的流向速度进行最小二乘线性拟合来计算 $\\frac{du_x}{dy}$，使用内部节点以避免直接的边界效应。\n\n使用 D2Q9 模型和单弛豫时间 BGK 碰撞，在格子单位下实现完整模拟，其中 $\\Delta x=1$ 和 $\\Delta t=1$。在 $x$ 方向使用周期性边界条件，在 $y=0$ 和 $y=N_y-1$ 处使用 Zou–He 速度边界条件。使用 $N_x=64$，$N_y=17$，$\\tau=0.8$，$U_\\mathrm{rel}=0.1$，并运行 $T=1500$ 个时间步。所有量均以无量纲的格子单位表示；无需进行物理单位转换。\n\n设计一个包含四个案例的测试套件，背景速度分别为 $U_0\\in\\{0.0, 0.1, -0.1, 0.3\\}$。对于每个案例，运行模拟并计算稳态剪切应力 $\\tau_{xy}(U_0)$。使用 $U_0=0.0$ 的基准案例来定义归一化绝对偏差 $\\epsilon(U_0)=\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|/\\left|\\tau_{xy}(0.0)\\right|$，这是一个无量纲的小数。每个测试案例的预期结果类型为浮点数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4]”）。序列必须按 $U_0=0.0$、$U_0=0.1$、$U_0=-0.1$ 和 $U_0=0.3$ 的顺序排列。不应打印任何其他文本。",
            "solution": "该问题陈述经评估有效。它在科学上基于计算流体动力学的格子玻尔兹曼方法（LBM）的既定原理，特别是使用了 Bhatnagar–Gross–Krook (BGK) 近似。该设置描述了一个标准的数值实验，旨在研究 LBM 的一个已知的、非平凡的人为现象——缺乏完美的伽利略不变性。该问题是适定的，提供了所有必要的参数、初始条件、边界条件，以及一个清晰、客观的计算所需量的程序。\n\n目标是量化二维 Couette 流的 LBM 模拟中的伽利略不变性误差。在连续介质力学中，Navier-Stokes 方程是伽利略不变的，这意味着流动的物理特性，包括剪切应力，与参考系的恒定速度无关。在流场上叠加一个均匀的平移速度 $\\mathbf{U}_0$ 不应改变其内应力。然而，LBM 的离散特性引入了截断误差，从而破坏了这种不变性，尤其是在马赫数不可忽略的情况下。这种误差表现为计算出的量（如剪切应力）对背景速度 $U_0$ 的依赖性。\n\n我们将模拟一个高为 $N_y$、长为 $N_x$ 的通道中的二维 Couette 流。流体被限制在两个平行板之间。位于 $y=0$ 的底板以速度 $\\mathbf{u}_\\mathrm{bottom}=(U_0,0)$ 移动，而位于 $y=N_y-1$ 的顶板以速度 $\\mathbf{u}_\\mathrm{top}=(U_0+U_\\mathrm{rel},0)$ 移动。所有量均以无量纲的格子单位表示，其中格子间距 $\\Delta x = 1$，时间步长 $\\Delta t = 1$。\n\n模拟由带有单弛豫时间 BGK 碰撞算子的离散速度 Boltzmann 方程控制：\n$$\nf_i(\\mathbf{x}+\\mathbf{c}_i \\Delta t, t+\\Delta t) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\mathbf{x}, t) \\right)\n$$\n其中 $f_i(\\mathbf{x}, t)$ 是在格子点 $\\mathbf{x}$ 和时间 $t$ 处，对应离散速度 $\\mathbf{c}_i$ 的粒子分布函数。$\\tau$ 是弛豫时间，它控制着流体的粘度。LBM 算法分为两个主要步骤：\n\n1.  **碰撞步**：在每个格点上，分布函数 $f_i$ 向局部平衡分布函数 $f_i^{\\mathrm{eq}}$ 弛豫。\n    $$\n    f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x}, t) - \\frac{1}{\\tau} \\left( f_i(\\mathbf{x}, t) - f_i^{\\mathrm{eq}}(\\rho, \\mathbf{u}) \\right)\n    $$\n    其中 $f_i^*$ 是碰撞后的分布函数。宏观密度 $\\rho$ 和速度 $\\mathbf{u}$ 由分布函数的矩计算得出：\n    $$\n    \\rho = \\sum_{i=0}^{8} f_i \\quad \\text{和} \\quad \\rho\\mathbf{u} = \\sum_{i=0}^{8} f_i \\mathbf{c}_i\n    $$\n\n2.  **迁移步**：碰撞后的布居数 $f_i^*$ 根据其离散速度移动到相邻的格点：\n    $$\n    f_i(\\mathbf{x}+\\mathbf{c}_i, t+1) = f_i^*(\\mathbf{x}, t)\n    $$\n    (其中 $\\Delta x=1, \\Delta t=1$）。\n\n模拟使用标准的 D2Q9 格子模型，其离散速度 $\\mathbf{c}_i$ 和权重 $w_i$ 已给出。平衡分布函数 $f_i^{\\mathrm{eq}}$ 是 Maxwell-Boltzmann 速度分布的二阶多项式展开，由下式给出：\n$$\nf_i^{\\mathrm{eq}} = w_i \\rho \\left( 1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u} \\cdot \\mathbf{u}}{2c_s^2} \\right)\n$$\n其中 $c_s=1/\\sqrt{3}$ 是格子声速。运动粘度 $\\nu$ 通过 $\\nu = c_s^2(\\tau - 0.5)$ 与弛豫时间相关。\n\n模拟区域是一个大小为 $N_x=64$ 乘以 $N_y=17$ 的网格。在流向（$x$）方向上边界条件是周期性的。在横向（$y$）方向上，壁面（$y=0$ 和 $y=N_y-1$）处应用 Zou-He 速度边界条件。对于具有指定速度 $\\mathbf{u}_w=(u_{wx}, u_{wy}=0)$ 的壁面节点，未知的传入布居数在迁移步之后被重构。对于底壁（$y=0$），未知量是 $f_2, f_5, f_6$。它们的确定方式如下：\n首先，壁面密度 $\\rho_w$ 由壁面节点上已知的、迁移后的布居数计算得出：\n$$\n\\rho_w = f_0 + f_1 + f_3 + 2(f_4 + f_7 + f_8)\n$$\n然后，使用 $\\rho_w$ 和已知的壁面速度 $u_{wx}$ 计算未知的布居数：\n$$\nf_2 = f_4\n$$\n$$\nf_5 = f_7 - \\frac{1}{2}(f_1-f_3) + \\frac{1}{2}\\rho_w u_{wx}\n$$\n$$\nf_6 = f_8 + \\frac{1}{2}(f_1-f_3) - \\frac{1}{2}\\rho_w u_{wx}\n$$\n对于顶壁（$y=N_y-1$），使用一组对称的关系式。\n\n模拟以均匀密度 $\\rho_0=1$ 和速度 $\\mathbf{u}_{init}=(U_0, 0)$ 进行初始化。模拟运行 $T=1500$ 个时间步，以使流动达到稳态。\n\n达到稳态后，计算剪切应力 $\\tau_{xy}$。首先，沿周期性的 $x$ 方向对流向速度 $u_x$ 进行平均，以获得平均速度剖面 $\\bar{u}_x(y)$。然后对内部节点（$y \\in [1, N_y-2]$）上的该剖面进行线性最小二乘回归，以求得速度梯度 $du_x/dy$。然后使用区域平均密度 $\\bar{\\rho}$ 和运动粘度 $\\nu$ 计算剪切应力：\n$$\n\\tau_{xy} = \\bar{\\rho} \\, \\nu \\, \\frac{du_x}{dy}\n$$\n对每个背景速度 $U_0 \\in \\{0.0, 0.1, -0.1, 0.3\\}$ 重复此过程。$U_0=0.0$ 的情况作为基线，提供参考剪切应力 $\\tau_{xy}(0.0)$。伽利略不变性误差被量化为归一化绝对偏差：\n$$\n\\epsilon(U_0)=\\frac{\\left|\\tau_{xy}(U_0)-\\tau_{xy}(0.0)\\right|}{\\left|\\tau_{xy}(0.0)\\right|}\n$$\n将为四个指定的 $U_0$ 值分别计算 $\\epsilon(U_0)$ 的值。根据定义，$\\epsilon(0.0) = 0$。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Simulates 2D Couette flow using LBM to evaluate Galilean invariance error.\n    \"\"\"\n    \n    # Simulation Parameters\n    NX = 64\n    NY = 17\n    TAU = 0.8\n    U_REL = 0.1\n    T_STEPS = 1500\n    RHO0 = 1.0\n    \n    # D2Q9 model parameters\n    C = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1], \n                  [1, 1], [-1, 1], [-1, -1], [1, -1]])\n    W = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    CS2 = 1/3\n    NU = CS2 * (TAU - 0.5)\n\n    test_cases_U0 = [0.0, 0.1, -0.1, 0.3]\n    tau_xy_results = {}\n\n    def equilibrium_dist(rho, ux, uy):\n        \"\"\"Calculates the equilibrium distribution function.\"\"\"\n        feq = np.zeros((NY, NX, 9))\n        u_dot_u = ux**2 + uy**2\n        for i in range(9):\n            c_dot_u = C[i, 0] * ux + C[i, 1] * uy\n            term1 = c_dot_u / CS2\n            term2 = (c_dot_u**2) / (2 * CS2**2)\n            term3 = u_dot_u / (2 * CS2)\n            feq[:, :, i] = W[i] * rho * (1 + term1 + term2 - term3)\n        return feq\n\n    for u0 in test_cases_U0:\n        # Flow Parameters for the current case\n        u_bottom = u0\n        u_top = u0 + U_REL\n        \n        # Initialization\n        ux_init = np.full((NY, NX), u0)\n        uy_init = np.zeros((NY, NX))\n        rho_init = np.full((NY, NX), RHO0)\n        f = equilibrium_dist(rho_init, ux_init, uy_init)\n\n        # Main simulation loop\n        for t in range(T_STEPS):\n            # Collision\n            rho = np.sum(f, axis=2)\n            ux = np.einsum('ijk,k->ij', f, C[:, 0]) / rho\n            uy = np.einsum('ijk,k->ij', f, C[:, 1]) / rho\n            \n            feq = equilibrium_dist(rho, ux, uy)\n            f = f - (1/TAU) * (f - feq)\n\n            # Streaming\n            for i in range(9):\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 0], axis=1)\n                f[:, :, i] = np.roll(f[:, :, i], C[i, 1], axis=0)\n\n            # Boundary Conditions (Zou-He)\n            # Bottom wall (y=0)\n            rho_w_bottom = f[0, :, 0] + f[0, :, 1] + f[0, :, 3] + 2 * (f[0, :, 4] + f[0, :, 7] + f[0, :, 8])\n            f[0, :, 2] = f[0, :, 4]  # Since u_y = 0\n            f[0, :, 5] = f[0, :, 7] - 0.5 * (f[0, :, 1] - f[0, :, 3]) + 0.5 * rho_w_bottom * u_bottom\n            f[0, :, 6] = f[0, :, 8] + 0.5 * (f[0, :, 1] - f[0, :, 3]) - 0.5 * rho_w_bottom * u_bottom\n\n            # Top wall (y=NY-1)\n            rho_w_top = f[-1, :, 0] + f[-1, :, 1] + f[-1, :, 3] + 2 * (f[-1, :, 2] + f[-1, :, 5] + f[-1, :, 6])\n            f[-1, :, 4] = f[-1, :, 2]  # Since u_y = 0\n            f[-1, :, 7] = f[-1, :, 5] + 0.5 * (f[-1, :, 1] - f[-1, :, 3]) - 0.5 * rho_w_top * u_top\n            f[-1, :, 8] = f[-1, :, 6] - 0.5 * (f[-1, :, 1] - f[-1, :, 3]) + 0.5 * rho_w_top * u_top\n\n        # Post-processing to calculate shear stress\n        rho_final = np.sum(f, axis=2)\n        ux_final = np.einsum('ijk,k->ij', f, C[:, 0]) / rho_final\n        \n        rho_avg = np.mean(rho_final)\n        ux_profile = np.mean(ux_final, axis=1)\n\n        # Linear fit on interior nodes\n        y_interior = np.arange(1, NY - 1)\n        ux_interior = ux_profile[1:-1]\n        \n        # scipy.stats.linregress(x, y)\n        lin_fit = linregress(y_interior, ux_interior)\n        du_dy = lin_fit.slope\n        \n        tau_xy = rho_avg * NU * du_dy\n        tau_xy_results[u0] = tau_xy\n\n    # Calculate normalized deviation\n    tau_xy_base = tau_xy_results[0.0]\n    deviations = []\n    for u0 in test_cases_U0:\n        current_tau_xy = tau_xy_results[u0]\n        if tau_xy_base == 0:\n            deviation = 0.0 if current_tau_xy == 0.0 else float('inf')\n        else:\n            deviation = abs(current_tau_xy - tau_xy_base) / abs(tau_xy_base)\n        deviations.append(deviation)\n    \n    print(f\"[{','.join(map(str, deviations))}]\")\n\nsolve()\n\n```"
        }
    ]
}