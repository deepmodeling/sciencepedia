{
    "hands_on_practices": [
        {
            "introduction": "This first exercise is a focused thought experiment designed to build a solid intuition for the fundamental mechanics of the Lattice Boltzmann Method. By working through a single collide-stream step in a spatially uniform system, you will directly engage with the core two-step process and see the principle of local mass and momentum conservation in action. This practice highlights a key property of the BGK collision operator and clarifies how macroscopic fluid properties emerge from the mesoscopic particle distributions .",
            "id": "3820128",
            "problem": "Consider a single-relaxation-time Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) on the standard two-dimensional nine-velocity lattice (D2Q9). The discrete velocities are\n$$\n\\mathbf{c}_0 = (0,0),\\quad\n\\mathbf{c}_1 = (1,0),\\quad\n\\mathbf{c}_2 = (0,1),\\quad\n\\mathbf{c}_3 = (-1,0),\\quad\n\\mathbf{c}_4 = (0,-1),\\quad\n\\mathbf{c}_5 = (1,1),\\quad\n\\mathbf{c}_6 = (-1,1),\\quad\n\\mathbf{c}_7 = (-1,-1),\\quad\n\\mathbf{c}_8 = (1,-1),\n$$\nwith weights\n$$\nw_0 = \\frac{4}{9},\\quad w_1=w_2=w_3=w_4=\\frac{1}{9},\\quad w_5=w_6=w_7=w_8=\\frac{1}{36}.\n$$\nAssume lattice units with $\\,\\Delta x = \\Delta t = 1\\,$, so the lattice speed is $\\,c=1\\,$ and the isothermal speed of sound satisfies $\\,c_s^2 = \\frac{1}{3}\\,$. The discrete Boltzmann equation with the BGK collision operator is\n$$\nf_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) - f_i(\\mathbf{x},t) = -\\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})\\right],\n$$\nwhere $\\,\\tau\\,$ is the relaxation time and $\\,f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})\\,$ is the second-order equilibrium distribution given by\n$$\nf_i^{\\mathrm{eq}}(\\rho,\\mathbf{u}) = w_i\\,\\rho\\left[1 + \\frac{\\mathbf{c}_i\\cdot\\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i\\cdot\\mathbf{u})^2}{2\\,c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2\\,c_s^2}\\right].\n$$\nThe macroscopic density and velocity are defined by the zeroth and first moments,\n$$\n\\rho(\\mathbf{x},t) = \\sum_{i=0}^{8} f_i(\\mathbf{x},t),\\qquad \\rho(\\mathbf{x},t)\\,\\mathbf{u}(\\mathbf{x},t) = \\sum_{i=0}^{8} f_i(\\mathbf{x},t)\\,\\mathbf{c}_i.\n$$\nLet the relaxation time be $\\,\\tau = 1\\,$ so that $\\,\\omega := \\Delta t/\\tau = 1\\,$. Consider a spatially uniform initial condition across the lattice at time $\\,t_0\\,$, so the following distribution values apply at every lattice node:\n$$\n\\begin{aligned}\nf_0(\\mathbf{x},t_0) = 0.4415778,\\quad f_1(\\mathbf{x},t_0) = 0.1490944,\\quad f_2(\\mathbf{x},t_0) = 0.0920111,\\\\\nf_3(\\mathbf{x},t_0) = 0.0790944,\\quad f_4(\\mathbf{x},t_0) = 0.1306778,\\quad f_5(\\mathbf{x},t_0) = 0.0334528,\\\\\nf_6(\\mathbf{x},t_0) = 0.0116528,\\quad f_7(\\mathbf{x},t_0) = 0.0241194,\\quad f_8(\\mathbf{x},t_0) = 0.0383194.\n\\end{aligned}\n$$\nPerform one full collide–stream time step to obtain $\\,f_i(\\mathbf{x},t_0+\\Delta t)\\,$ at a node. Then update the macroscopic fields $\\,\\rho(\\mathbf{x},t_0+\\Delta t)\\,$ and $\\,\\mathbf{u}(\\mathbf{x},t_0+\\Delta t)\\,$ at that node. Express the final answer as a row matrix containing $\\,\\rho,\\,u_x,\\,u_y\\,$ in lattice units, and round your entries to six significant figures.",
            "solution": "The objective is to determine the macroscopic density $\\rho$ and velocity $\\mathbf{u} = (u_x, u_y)$ at a lattice node at time $t_0+\\Delta t$, after performing one full time step of the Lattice Boltzmann Method (LBM), starting from a given initial state at time $t_0$.\n\nThe LBM algorithm for a single time step consists of two sequential processes: collision and streaming. The evolution of the discrete distribution functions $f_i(\\mathbf{x},t)$ is described by the discrete Boltzmann equation with the BGK collision operator:\n$$ f_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) = f_i(\\mathbf{x},t) - \\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho,\\mathbf{u})\\right] $$\nThis equation can be conceptually split. First, a local collision step at each node $\\mathbf{x}$ calculates the post-collision state, denoted $f_i^*(\\mathbf{x}, t)$:\n$$ f_i^*(\\mathbf{x}, t) = f_i(\\mathbf{x},t) - \\frac{\\Delta t}{\\tau}\\left[f_i(\\mathbf{x},t) - f_i^{\\mathrm{eq}}(\\rho(\\mathbf{x},t),\\mathbf{u}(\\mathbf{x},t))\\right] $$\nSecond, a streaming (or propagation) step follows, where the post-collision populations move to adjacent nodes according to their discrete velocities:\n$$ f_i(\\mathbf{x}+\\mathbf{c}_i\\Delta t, t+\\Delta t) = f_i^*(\\mathbf{x}, t) $$\nTo find the populations $f_i$ at a node $\\mathbf{x}$ at the new time $t_0+\\Delta t$, we must gather the post-collision populations from the neighboring nodes at the previous time $t_0$. This can be expressed as:\n$$ f_i(\\mathbf{x}, t_0+\\Delta t) = f_i^*(\\mathbf{x}-\\mathbf{c}_i\\Delta t, t_0) $$\nThe problem states that the initial condition at time $t_0$ is spatially uniform. This means that the initial distribution functions $f_i(\\mathbf{x}, t_0)$ have the same values at every lattice node $\\mathbf{x}$. Let us denote these uniform initial values as $f_i(t_0)$.\n\nAs a direct consequence of this uniformity, the initial macroscopic fields, density $\\rho(t_0)$ and velocity $\\mathbf{u}(t_0)$, are also constant across the entire lattice. They are calculated from the moments of the initial distributions:\n$$ \\rho(t_0) = \\sum_{i=0}^{8} f_i(t_0) $$\n$$ \\rho(t_0)\\mathbf{u}(t_0) = \\sum_{i=0}^{8} f_i(t_0)\\mathbf{c}_i $$\nSince the collision step is purely local, and the inputs to it ($f_i(t_0)$, $\\rho(t_0)$, and $\\mathbf{u}(t_0)$) are uniform, the post-collision populations $f_i^*(t_0)$ must also be spatially uniform.\n\nWith $f_i^*(t_0)$ being uniform, the streaming step simplifies significantly. The value of $f_i^*(\\mathbf{x}-\\mathbf{c}_i\\Delta t, t_0)$ is the same regardless of the position $\\mathbf{x}-\\mathbf{c}_i\\Delta t$, and is equal to the constant value $f_i^*(t_0)$. Therefore, the populations at any node $\\mathbf{x}$ at the next time step are:\n$$ f_i(\\mathbf{x}, t_0+\\Delta t) = f_i^*(t_0) $$\nThe new macroscopic fields at time $t_0+\\Delta t$ are the moments of these new populations:\n$$ \\rho(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i^*(t_0) $$\n$$ \\rho(\\mathbf{x}, t_0+\\Delta t)\\mathbf{u}(\\mathbf{x}, t_0+\\Delta t) = \\sum_{i=0}^{8} f_i(\\mathbf{x}, t_0+\\Delta t)\\mathbf{c}_i = \\sum_{i=0}^{8} f_i^*(t_0)\\mathbf{c}_i $$\nA fundamental property of the BGK collision operator is that it conserves mass and momentum locally. This means the zeroth and first moments of the post-collision distributions are identical to those of the pre-collision distributions:\n$$ \\sum_{i=0}^{8} f_i^*(t_0) = \\sum_{i=0}^{8} f_i(t_0) = \\rho(t_0) $$\n$$ \\sum_{i=0}^{8} f_i^*(t_0)\\mathbf{c}_i = \\sum_{i=0}^{8} f_i(t_0)\\mathbf{c}_i = \\rho(t_0)\\mathbf{u}(t_0) $$\nThis conservation property holds for any value of the relaxation time $\\tau$.\n\nCombining these facts, we find that the macroscopic fields at time $t_0+\\Delta t$ are identical to those at time $t_0$:\n$$ \\rho(t_0+\\Delta t) = \\rho(t_0) $$\n$$ \\rho(t_0+\\Delta t)\\mathbf{u}(t_0+\\Delta t) = \\rho(t_0)\\mathbf{u}(t_0) $$\nSince the density is non-zero, this implies $\\mathbf{u}(t_0+\\Delta t) = \\mathbf{u}(t_0)$.\nTherefore, for a spatially uniform system, the macroscopic fields are stationary. The problem reduces to calculating the macroscopic fields from the given initial distributions $f_i(t_0)$.\n\nThe initial distributions are:\n$f_0(t_0) = 0.4415778$, $f_1(t_0) = 0.1490944$, $f_2(t_0) = 0.0920111$, $f_3(t_0) = 0.0790944$, $f_4(t_0) = 0.1306778$, $f_5(t_0) = 0.0334528$, $f_6(t_0) = 0.0116528$, $f_7(t_0) = 0.0241194$, $f_8(t_0) = 0.0383194$.\n\nFirst, we calculate the initial density $\\rho(t_0)$:\n$$ \\rho(t_0) = \\sum_{i=0}^{8} f_i(t_0) = 0.4415778 + 0.1490944 + 0.0920111 + 0.0790944 + 0.1306778 + 0.0334528 + 0.0116528 + 0.0241194 + 0.0383194 $$\n$$ \\rho(t_0) = 0.9999999 $$\nNext, we calculate the initial momentum $\\rho(t_0)\\mathbf{u}(t_0) = (\\rho u_x, \\rho u_y)$:\nThe $x$-component of the momentum is:\n$$ \\rho u_x(t_0) = \\sum_{i=0}^{8} f_i(t_0)c_{ix} = f_1 - f_3 + f_5 - f_6 - f_7 + f_8 $$\n$$ \\rho u_x(t_0) = 0.1490944 - 0.0790944 + 0.0334528 - 0.0116528 - 0.0241194 + 0.0383194 $$\n$$ \\rho u_x(t_0) = 0.1060000 $$\nThe $y$-component of the momentum is:\n$$ \\rho u_y(t_0) = \\sum_{i=0}^{8} f_i(t_0)c_{iy} = f_2 - f_4 + f_5 + f_6 - f_7 - f_8 $$\n$$ \\rho u_y(t_0) = 0.0920111 - 0.1306778 + 0.0334528 + 0.0116528 - 0.0241194 - 0.0383194 $$\n$$ \\rho u_y(t_0) = -0.0559999 $$\nFrom these values, we determine the initial macroscopic fields. As $\\rho(t_0) = 0.9999999 \\approx 1.0$, we have:\n$$ u_x(t_0) = \\frac{0.1060000}{0.9999999} \\approx 0.1060000 $$\n$$ u_y(t_0) = \\frac{-0.0559999}{0.9999999} \\approx -0.0559999 $$\nAs established, these macroscopic values are unchanged after one time step. The problem requires the answer to be rounded to six significant figures.\n$\\rho(t_0+\\Delta t) = 0.9999999 \\approx 1.00000$\n$u_x(t_0+\\Delta t) = 0.1060000 \\approx 0.106000$\n$u_y(t_0+\\Delta t) = -0.0559999 \\approx -0.0560000$\n\nThe requested result is the row matrix containing $(\\rho, u_x, u_y)$ at time $t_0+\\Delta t$.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1.00000  0.106000  -0.0560000 \\end{pmatrix} } $$"
        },
        {
            "introduction": "A crucial step in applying LBM to real-world engineering problems is linking the model's parameters to physical fluid properties. This practice guides you through the Chapman-Enskog expansion, the essential mathematical framework that bridges the mesoscopic lattice world and macroscopic continuum fluid dynamics. By performing this derivation, you will not only recover the Navier-Stokes equations from the discrete LBM but also establish the vital relationship between the relaxation time $\\tau$ and the kinematic viscosity $\\nu$, a prerequisite for designing physically accurate simulations .",
            "id": "3971752",
            "problem": "Consider the single-relaxation-time Bhatnagar–Gross–Krook (BGK) Lattice Boltzmann Method (LBM) applied to incompressible flow on the three-dimensional, nineteen-velocity discrete set $D3Q19$ used in aerospace Computational Fluid Dynamics (CFD). The discrete velocities are constructed so that streaming advances populations by one lattice spacing per time step along each discrete direction, and the second-order isotropy of the equilibrium ensures a lattice sound speed squared $c_{s}^{2}$ consistent with the $D3Q19$ quadrature. You are given a physical kinematic viscosity $ \\nu_{phys} $ (with units of $L^{2}/T$), a lattice spacing $ \\Delta x $ (with units of $L$), and a time step $ \\Delta t $ (with units of $T$). \n\nStarting from the kinetic transport equation with a BGK collision operator, the definition of macroscopic moments, and the Newtonian constitutive relation for viscous stress, perform a Chapman–Enskog expansion to recover the Navier–Stokes equations in the hydrodynamic limit for the $D3Q19$ lattice. From this derivation, obtain the analytic expression for the relaxation time $ \\tau $ required for the discrete model to reproduce the target physical viscosity $ \\nu_{phys} $ on the given lattice characterized by $ \\Delta x $ and $ \\Delta t $. Use the $D3Q19$ value $ c_{s}^{2} = 1/3 $. Present your final answer as a single closed-form expression for $ \\tau $.\n\nAdditionally, based on the same derivation, identify the leading numerical constraints on $ \\tau $, $ \\Delta x $, and $ \\Delta t $ that ensure the method remains dissipative and accurate in the low-Mach-number limit. Your commentary on constraints must be supported by the scaling that emerges from the hydrodynamic limit, but the final reported answer must remain the single expression for $ \\tau $. No numerical substitution is required. Express the final answer without units.",
            "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a standard, non-trivial derivation in the field of computational fluid dynamics, specifically concerning the Lattice Boltzmann Method (LBM). All premises are factually correct and all required information is provided.\n\nThe objective is to derive the relationship between the single relaxation time $\\tau$ of the Bhatnagar–Gross–Krook (BGK) model and the physical kinematic viscosity $\\nu_{phys}$ for a $D3Q19$ lattice. This is achieved by recovering the macroscopic Navier–Stokes equations from the discrete lattice Boltzmann equation via a Chapman–Enskog expansion.\n\nWe begin with the discrete lattice Boltzmann equation (LBE) with the BGK collision operator. For clarity, we will first perform the derivation in lattice units, where the lattice spacing $\\Delta x = 1$ and the time step $\\Delta t = 1$. The discrete particle velocities are then denoted by $\\mathbf{e}_i$, and the speed of light on the lattice is $c=1$. The LBE is:\n$$ f_i(\\mathbf{x} + \\mathbf{e}_i, t+1) - f_i(\\mathbf{x}, t) = -\\frac{1}{\\tau} [f_i(\\mathbf{x}, t) - f_i^{eq}(\\mathbf{x}, t)] $$\nwhere $f_i$ is the particle distribution function along the $i$-th direction, $\\mathbf{x}$ and $t$ are lattice coordinates and time, and $\\tau$ is the dimensionless relaxation time. The equilibrium distribution function, $f_i^{eq}$, for low-Mach-number flows is a second-order expansion in the macroscopic velocity $\\mathbf{u}$:\n$$ f_i^{eq} = w_i \\rho \\left( 1 + \\frac{\\mathbf{e}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{e}_i \\cdot \\mathbf{u})^2}{2c_s^4} - \\frac{\\mathbf{u}^2}{2c_s^2} \\right) $$\nHere, $w_i$ are the $D3Q19$ lattice weights, $\\rho$ is the macroscopic density, and $c_s$ is the lattice speed of sound, given as $c_s^2 = 1/3$. The macroscopic density and momentum are moments of the distribution functions:\n$$ \\rho = \\sum_i f_i = \\sum_i f_i^{eq} $$\n$$ \\rho \\mathbf{u} = \\sum_i f_i \\mathbf{e}_i = \\sum_i f_i^{eq} $$\nThe BGK collision operator conserves mass and momentum, which implies $\\sum_i (f_i - f_i^{eq}) = 0$ and $\\sum_i \\mathbf{e}_i (f_i - f_i^{eq}) = 0$.\n\nTo recover the macroscopic equations, we perform a Chapman–Enskog expansion. We introduce a small parameter $\\epsilon$ (proportional to the Knudsen and Mach numbers) and assume that the distribution function and the time and space derivatives can be expanded in multiple scales:\n- $f_i = f_i^{(0)} + \\epsilon f_i^{(1)} + \\epsilon^2 f_i^{(2)} + \\mathcal{O}(\\epsilon^3)$\n- $\\partial_t = \\epsilon \\partial_{t_1} + \\epsilon^2 \\partial_{t_2}$\n- $\\nabla = \\epsilon \\nabla_1$\n\nWe first Taylor-expand the discrete LBE in the time step (which is $1$ in lattice units):\n$$ (\\partial_t + \\mathbf{e}_i \\cdot \\nabla)f_i + \\frac{1}{2}(\\partial_t + \\mathbf{e}_i \\cdot \\nabla)^2 f_i + \\mathcal{O}(\\Delta t^3) = -\\frac{1}{\\tau}(f_i - f_i^{eq}) $$\nBy convention of the Chapman-Enskog procedure, we enforce that the macroscopic variables are fully captured by the equilibrium distribution, meaning $f_i^{(0)} = f_i^{eq}$ and the non-equilibrium parts have zero contribution to mass and momentum: $\\sum_i f_i^{(k)}=0$ and $\\sum_i \\mathbf{e}_i f_i^{(k)}=0$ for $k \\ge 1$.\n\nSubstituting the multi-scale expansions into the Taylor-expanded LBE and collecting terms by powers of $\\epsilon$:\n\nOrder $\\epsilon^1$:\n$$ (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(1)} $$\nThis gives an expression for the first-order non-equilibrium distribution:\n$$ f_i^{(1)} = -\\tau (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha}) f_i^{(0)} $$\n\nOrder $\\epsilon^2$:\n$$ \\partial_{t_2} f_i^{(0)} + (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1) f_i^{(1)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nSubstituting the expression for $f_i^{(1)}$ into the second term:\n$$ \\partial_{t_2} f_i^{(0)} - \\tau (\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} + \\frac{1}{2}(\\partial_{t_1} + \\mathbf{e}_i \\cdot \\nabla_1)^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nThis simplifies to:\n$$ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = -\\frac{1}{\\tau} f_i^{(2)} $$\nNow, we take moments of these scaled equations to find the macroscopic governing equations. Taking moments of the $\\mathcal{O}(\\epsilon^1)$ equation yields the compressible Euler equations (mass and momentum conservation at the first time scale). The momentum equation at this scale is:\n$$ \\partial_{t_1}(\\rho u_\\beta) + \\partial_{1\\alpha} \\Pi_{\\alpha\\beta}^{(0)} = 0 $$\nwhere $\\Pi_{\\alpha\\beta}^{(0)} = \\sum_i e_{i\\alpha}e_{i\\beta} f_i^{(0)} = \\rho u_\\alpha u_\\beta + p \\delta_{\\alpha\\beta}$ is the equilibrium momentum flux tensor, and pressure $p = \\rho c_s^2$.\n\nTo find the viscous term, we take the first moment (multiply by $e_{i\\beta}$ and sum over $i$) of the $\\mathcal{O}(\\epsilon^2)$ equation. The term $\\sum_i e_{i\\beta} f_i^{(2)}$ on the right-hand side is zero due to the conservation constraint.\n$$ \\sum_i e_{i\\beta} \\left[ \\partial_{t_2} f_i^{(0)} - \\left(\\tau - \\frac{1}{2}\\right) (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} \\right] = 0 $$\n$$ \\partial_{t_2}(\\rho u_\\beta) - \\left(\\tau - \\frac{1}{2}\\right) \\sum_i e_{i\\beta} (\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 f_i^{(0)} = 0 $$\nThe second term contains the viscous contribution. In the low-Mach-number limit, time derivatives are of higher order in Mach number than spatial derivatives, so we approximate $(\\partial_{t_1} + e_{i\\alpha} \\partial_{1\\alpha})^2 \\approx (e_{i\\alpha} \\partial_{1\\alpha})^2$. The term becomes:\n$$ \\partial_{1\\gamma} \\partial_{1\\delta} \\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} $$\nThis is a derivative of the third-order moment of the equilibrium distribution. For low Mach numbers, $\\sum_i e_{i\\beta} e_{i\\gamma} e_{i\\delta} f_i^{(0)} \\approx \\rho c_s^2 (u_\\beta \\delta_{\\gamma\\delta} + u_\\gamma \\delta_{\\beta\\delta} + u_\\delta \\delta_{\\beta\\gamma})$.\nApplying the derivatives and assuming an incompressible fluid ($\\nabla \\cdot \\mathbf{u} = 0$), this term evaluates to $\\rho c_s^2 \\nabla_1^2 u_\\beta$. The momentum equation at the $\\mathcal{O}(\\epsilon^2)$ scale is then:\n$$ \\partial_{t_2}(\\rho u_\\beta) = \\left(\\tau - \\frac{1}{2}\\right) \\rho c_s^2 \\nabla_1^2 u_\\beta $$\nCombining the momentum equations from scales $\\epsilon^1$ and $\\epsilon^2$ and reverting to physical-scale derivatives ($\\partial_t, \\nabla$):\n$$ \\partial_t(\\rho u_\\beta) + \\partial_\\alpha(\\rho u_\\alpha u_\\beta) = -\\partial_\\beta p + \\rho c_s^2 \\left(\\tau - \\frac{1}{2}\\right) \\nabla^2 u_\\beta $$\nThis is the incompressible Navier–Stokes equation:\n$$ \\rho(\\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta) = -\\partial_\\beta p + \\mu \\nabla^2 u_\\beta $$\nwhere $\\mu$ is the dynamic viscosity. Dividing by $\\rho$ gives the equation in terms of kinematic viscosity $\\nu = \\mu/\\rho$:\n$$ \\partial_t u_\\beta + u_\\alpha \\partial_\\alpha u_\\beta = -\\frac{1}{\\rho}\\partial_\\beta p + \\nu \\nabla^2 u_\\beta $$\nBy comparing the viscous terms, we identify the kinematic viscosity in lattice units:\n$$ \\nu_{latt} = c_s^2 \\left(\\tau - \\frac{1}{2}\\right) $$\nThis expression relates the dimensionless parameters of the lattice simulation. To find the physical viscosity $\\nu_{phys}$, we must introduce the physical lattice spacing $\\Delta x$ and time step $\\Delta t$. Kinematic viscosity has units of $[L^2/T]$. The conversion factor from lattice units to physical units is:\n$$ \\nu_{phys} = \\nu_{latt} \\frac{\\Delta x^2}{\\Delta t} $$\nSubstituting the expression for $\\nu_{latt}$ and the given value $c_s^2 = 1/3$:\n$$ \\nu_{phys} = \\frac{1}{3} \\left(\\tau - \\frac{1}{2}\\right) \\frac{\\Delta x^2}{\\Delta t} $$\nSolving this equation for the relaxation time $\\tau$ yields the desired expression:\n$$ 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\tau - \\frac{1}{2} $$\n$$ \\tau = 3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2} $$\n\nBased on this derivation, we can identify two critical constraints.\nFirst, for the method to be physically dissipative and numerically stable, the lattice viscosity must be positive, $\\nu_{latt}  0$. Since $c_s^2  0$, this implies a fundamental constraint on the relaxation time:\n$$ \\tau  \\frac{1}{2} $$\nSecond, the Chapman-Enskog expansion is valid only in the hydrodynamic limit, where the mean free path is much smaller than characteristic flow lengths. In LBM, the mean free path is proportional to $\\nu_{latt} \\propto (\\tau - 1/2)$. A large value of $\\tau$ implies a departure from this limit, leading to inaccuracies. Therefore, $\\tau$ must be kept on the order of unity, e.g., $\\tau  2$. This imposes a constraint on the choice of grid parameters:\n$$ \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} = \\frac{1}{3}\\left(\\tau - \\frac{1}{2}\\right) = \\mathcal{O}(1) $$\nThis is the diffusive scaling of LBM, which requires that as the grid is refined ($\\Delta x \\to 0$), the time step must be decreased quadratically ($\\Delta t \\propto \\Delta x^2$) to maintain a constant $\\tau$. This must be balanced with the advective scaling constraint, $\\Delta t \\propto \\Delta x$, required to keep the Mach number low and control compressibility errors.",
            "answer": "$$\\boxed{3 \\frac{\\nu_{phys} \\Delta t}{\\Delta x^2} + \\frac{1}{2}}$$"
        },
        {
            "introduction": "This final practice integrates theory and implementation in a comprehensive validation exercise, a cornerstone of computational science. You will simulate the decay of the Taylor-Green vortex, a classic benchmark case with a known analytical solution for its kinetic energy dissipation. This task requires you to build a complete LBM solver, initialize a complex flow field, and perform post-processing analysis to compare your numerical results against the theoretical prediction, thereby verifying the accuracy of your code and solidifying your understanding of the LBM's connection to physical diffusion processes .",
            "id": "3150861",
            "problem": "You will implement a two-dimensional Lattice Boltzmann Method (LBM) using the two-dimensional, nine-velocity model (D2Q9) to simulate the viscous decay of a Taylor–Green vortex in a periodic square domain. Starting from foundational principles, use the macroscopic limit of the LBM at low Mach number and the structure of the Taylor–Green vortex to derive the exponential decay of the kinetic energy and then verify it numerically by extracting the decay rate from your simulation.\n\nBegin from the following fundamental base:\n- The incompressible Navier–Stokes equations with kinematic viscosity $\\nu$ reduce to linear momentum diffusion in the absence of advection and pressure gradients, namely $\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}$ for a Fourier mode velocity field $\\mathbf{u}$.\n- The Taylor–Green vortex in two spatial dimensions is a divergence-free velocity field with components $u_x(x,y,0) = U_0 \\sin(k_x x)\\cos(k_y y)$ and $u_y(x,y,0) = -U_0 \\cos(k_x x)\\sin(k_y y)$, where $U_0$ is a small amplitude and $k_x$ and $k_y$ are the wavenumbers.\n- The D2Q9 Lattice Boltzmann Method with the single-relaxation-time Bhatnagar–Gross–Krook (BGK) collision recovers the Navier–Stokes equations in the hydrodynamic limit with kinematic viscosity related to the relaxation time $\\tau$ by $\\nu = c_s^2(\\tau - \\tfrac{1}{2})$, where $c_s^2 = \\tfrac{1}{3}$ in lattice units.\n\nTask requirements:\n1. Implement an LBM D2Q9 solver with BGK collision and periodic boundaries on an $N_x \\times N_y$ lattice, with lattice spacing $\\Delta x = 1$, time step $\\Delta t = 1$, and initial density $ \\rho_0 = 1$ (all quantities in lattice units).\n2. Initialize the velocity field with the Taylor–Green vortex using $k_x = \\frac{2\\pi m}{N_x}$ and $k_y = \\frac{2\\pi m}{N_y}$, where $m$ is a positive integer mode number. Use $U_0 = 0.05$ for the initial amplitude (in lattice units). Initialize the particle distribution functions at equilibrium corresponding to this velocity field and density.\n3. At each time step $t$, compute the spatially averaged kinetic energy per unit mass $E(t) = \\langle \\tfrac{1}{2}(u_x^2 + u_y^2) \\rangle$, where $\\langle \\cdot \\rangle$ denotes the average over the domain.\n4. Derive, from the governing diffusion equation $\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}$ and the structure of the Taylor–Green vortex Fourier mode, the exponential decay law for the kinetic energy $E(t)$ and the analytical expression for its decay rate as a function of $\\nu$ and the wavenumbers. Use this derived expression to compute the theoretical decay rate $\\alpha_{\\mathrm{th}}$ for each parameter set.\n5. Numerically estimate the decay rate $\\alpha_{\\mathrm{meas}}$ by performing a least-squares linear fit to $\\ln E(t)$ versus $t$ over a suitable time window after initial transients. Use lattice time units for $t$.\n6. For each test case, compute the relative error $\\varepsilon = \\frac{|\\alpha_{\\mathrm{meas}} - \\alpha_{\\mathrm{th}}|}{\\alpha_{\\mathrm{th}}}$ and report it.\n\nUse the following D2Q9 model specifications:\n- Discrete velocities $\\mathbf{c}_i$ for $i = 0,\\ldots,8$: $\\mathbf{c}_0 = (0,0)$, $\\mathbf{c}_1 = (1,0)$, $\\mathbf{c}_2 = (0,1)$, $\\mathbf{c}_3 = (-1,0)$, $\\mathbf{c}_4 = (0,-1)$, $\\mathbf{c}_5 = (1,1)$, $\\mathbf{c}_6 = (-1,1)$, $\\mathbf{c}_7 = (-1,-1)$, $\\mathbf{c}_8 = (1,-1)$.\n- Weights $w_i$: $w_0 = \\tfrac{4}{9}$, $w_{1,2,3,4} = \\tfrac{1}{9}$, $w_{5,6,7,8} = \\tfrac{1}{36}$.\n- Equilibrium distribution $f_i^{\\mathrm{eq}} = w_i \\rho \\left[1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2 c_s^2}\\right]$ with $c_s^2 = \\tfrac{1}{3}$.\n- BGK collision update $f_i^{\\mathrm{post}} = f_i - \\frac{1}{\\tau}\\left(f_i - f_i^{\\mathrm{eq}}\\right)$, followed by streaming along $\\mathbf{c}_i$ with periodic boundary conditions.\n\nAngle units are radians for all trigonometric functions. All quantities are in lattice units; no physical unit conversion is required.\n\nTest suite:\n- Case $1$: $N_x = 64$, $N_y = 64$, $\\tau = 0.8$, $m = 1$, total steps $T = 400$.\n- Case $2$: $N_x = 64$, $N_y = 64$, $\\tau = 1.0$, $m = 2$, total steps $T = 300$.\n- Case $3$: $N_x = 32$, $N_y = 32$, $\\tau = 0.8$, $m = 1$, total steps $T = 400$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each entry equal to the relative error $\\varepsilon$ for the corresponding case, rounded to three decimals (e.g., $[\\varepsilon_1,\\varepsilon_2,\\varepsilon_3]$).",
            "solution": "The problem statement has been validated and is deemed sound. It presents a well-posed, scientifically grounded problem that is a standard benchmark in computational fluid dynamics for validating numerical schemes like the Lattice Boltzmann Method (LBM). All necessary parameters and definitions for both the theoretical derivation and the numerical implementation are provided and are consistent with established literature.\n\n### Theoretical Derivation of the Kinetic Energy Decay Rate\n\nThe objective is to derive the analytical decay rate, $\\alpha_{\\mathrm{th}}$, for the spatially averaged kinetic energy, $E(t)$, of a Taylor-Green vortex. The analysis begins with the linearized momentum diffusion equation, which describes the evolution of a velocity field $\\mathbf{u}$ in the absence of significant advection and pressure forces:\n$$\n\\partial_t \\mathbf{u} = \\nu \\nabla^2 \\mathbf{u}\n$$\nwhere $\\nu$ is the kinematic viscosity.\n\nThe initial velocity field at $t=0$ is given by the two-dimensional Taylor-Green vortex:\n$$\nu_x(x,y,0) = U_0 \\sin(k_x x)\\cos(k_y y)\n$$\n$$\nu_y(x,y,0) = -U_0 \\cos(k_x x)\\sin(k_y y)\n$$\nThis velocity field consists of a single spatial Fourier mode. Let's verify that it is an eigenfunction of the Laplacian operator, $\\nabla^2 = \\partial_{xx} + \\partial_{yy}$. Applying the Laplacian to the $x$-component of the velocity:\n$$\n\\nabla^2 u_x(x,y,0) = \\left(\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}\\right) \\left[ U_0 \\sin(k_x x)\\cos(k_y y) \\right]\n$$\n$$\n= U_0 \\left[ (-k_x^2) \\sin(k_x x)\\cos(k_y y) + (-k_y^2) \\sin(k_x x)\\cos(k_y y) \\right]\n$$\n$$\n= -(k_x^2 + k_y^2) [U_0 \\sin(k_x x)\\cos(k_y y)] = -(k_x^2 + k_y^2) u_x(x,y,0)\n$$\nA similar calculation for the $y$-component yields $\\nabla^2 u_y(x,y,0) = -(k_x^2 + k_y^2) u_y(x,y,0)$. Therefore, the entire velocity vector field is an eigenfunction of the Laplacian:\n$$\n\\nabla^2 \\mathbf{u}(x,y,0) = -(k_x^2 + k_y^2) \\mathbf{u}(x,y,0)\n$$\nWe assume a solution to the diffusion equation of the form $\\mathbf{u}(x,y,t) = \\mathbf{u}(x,y,0)T(t)$, with the initial condition $T(0)=1$. Substituting this into the governing equation gives:\n$$\n\\mathbf{u}(x,y,0) \\frac{dT(t)}{dt} = \\nu T(t) \\nabla^2 \\mathbf{u}(x,y,0) = -\\nu (k_x^2 + k_y^2) T(t) \\mathbf{u}(x,y,0)\n$$\nThis simplifies to the ordinary differential equation $\\frac{dT}{dt} = -\\nu(k_x^2 + k_y^2)T$, whose solution is $T(t) = \\exp\\left(-\\nu(k_x^2 + k_y^2)t\\right)$. The velocity field thus decays as:\n$$\n\\mathbf{u}(x,y,t) = \\mathbf{u}(x,y,0) e^{-\\nu(k_x^2 + k_y^2)t}\n$$\nThe spatially averaged kinetic energy per unit mass is defined as $E(t) = \\langle \\frac{1}{2}\\mathbf{u}(t)\\cdot\\mathbf{u}(t) \\rangle$. Substituting the solution for $\\mathbf{u}(t)$:\n$$\nE(t) = \\left\\langle \\frac{1}{2} |\\mathbf{u}(x,y,0)|^2 e^{-2\\nu(k_x^2 + k_y^2)t} \\right\\rangle = e^{-2\\nu(k_x^2 + k_y^2)t} \\left\\langle \\frac{1}{2} |\\mathbf{u}(x,y,0)|^2 \\right\\rangle = E(0) e^{-2\\nu(k_x^2 + k_y^2)t}\n$$\nThis shows that the kinetic energy decays exponentially, $E(t) = E(0)e^{-\\alpha_{\\mathrm{th}}t}$, with a theoretical decay rate $\\alpha_{\\mathrm{th}}$ given by:\n$$\n\\alpha_{\\mathrm{th}} = 2\\nu(k_x^2 + k_y^2)\n$$\nThe problem specifies the LBM parameters in lattice units. The viscosity $\\nu$ is related to the relaxation time $\\tau$ by $\\nu = c_s^2(\\tau - \\frac{1}{2})$, with the lattice speed of sound squared $c_s^2=\\frac{1}{3}$. The wavenumbers are $k_x = \\frac{2\\pi m}{N_x}$ and $k_y = \\frac{2\\pi m}{N_y}$. For all test cases, $N_x=N_y=N$, so $k_x=k_y=k=\\frac{2\\pi m}{N}$. Substituting these into the expression for $\\alpha_{\\mathrm{th}}$ yields the final analytical formula used for comparison:\n$$\n\\alpha_{\\mathrm{th}} = 2 \\left[ c_s^2(\\tau - \\frac{1}{2}) \\right] \\left( \\left(\\frac{2\\pi m}{N}\\right)^2 + \\left(\\frac{2\\pi m}{N}\\right)^2 \\right) = 4 c_s^2(\\tau - \\frac{1}{2}) \\left(\\frac{2\\pi m}{N}\\right)^2 = \\frac{4}{3}(\\tau - 0.5) \\frac{4\\pi^2 m^2}{N^2} = \\frac{16\\pi^2 m^2}{3N^2}(\\tau - 0.5)\n$$\n\n### Numerical Simulation and Analysis\n\nA two-dimensional Lattice Boltzmann simulation using the D2Q9 model is implemented to solve for the flow evolution numerically.\n\n1.  **Initialization**: The simulation domain is an $N_x \\times N_y$ lattice. The initial density is set to a uniform value $\\rho(x,y,0) = \\rho_0=1$. The initial velocity field $\\mathbf{u}(x,y,0)$ is set to the Taylor-Green vortex profile with amplitude $U_0 = 0.05$. The nine particle distribution functions $f_i$ are initialized to their corresponding equilibrium values, $f_i^{\\mathrm{eq}}$, which are functions of the local density $\\rho$ and velocity $\\mathbf{u}$:\n    $$\n    f_i(x,y,0) = f_i^{\\mathrm{eq}}(\\rho(x,y,0), \\mathbf{u}(x,y,0)) = w_i \\rho \\left[1 + \\frac{\\mathbf{c}_i \\cdot \\mathbf{u}}{c_s^2} + \\frac{(\\mathbf{c}_i \\cdot \\mathbf{u})^2}{2 c_s^4} - \\frac{\\mathbf{u}\\cdot\\mathbf{u}}{2 c_s^2}\\right]\n    $$\n\n2.  **Time Evolution**: The simulation proceeds in discrete time steps. Each time step consists of two main operations:\n    *   **Collision**: First, the macroscopic density $\\rho$ and velocity $\\mathbf{u}$ are computed from the current distributions $f_i$ by summation: $\\rho = \\sum_i f_i$ and $\\mathbf{u} = \\frac{1}{\\rho}\\sum_i f_i \\mathbf{c}_i$. Then, the distributions relax towards a new local equilibrium $f_i^{\\mathrm{eq}}(\\rho, \\mathbf{u})$ according to the Bhatnagar-Gross-Krook (BGK) collision operator:\n      $$\n      f_i^{\\mathrm{post}} = f_i - \\frac{1}{\\tau}\\left(f_i - f_i^{\\mathrm{eq}}\\right)\n      $$\n    *   **Streaming**: The post-collision distributions $f_i^{\\mathrm{post}}$ are advected to neighboring lattice sites. This is expressed as $f_i(\\mathbf{x}+\\mathbf{c}_i \\Delta t, t+\\Delta t) = f_i^{\\mathrm{post}}(\\mathbf{x},t)$. In lattice units where $\\Delta t=1$, this step is implemented efficiently using cyclic shifts (`numpy.roll`) on the distribution arrays to enforce the periodic boundary conditions.\n\n3.  **Measurement and Analysis**: At each time step $t$, after computing the macroscopic velocity field $\\mathbf{u}(t)$, the spatially averaged kinetic energy $E(t) = \\langle \\frac{1}{2}(u_x^2 + u_y^2) \\rangle$ is calculated. After the simulation completes, the numerical decay rate $\\alpha_{\\mathrm{meas}}$ is estimated. Since $E(t) \\propto e^{-\\alpha t}$, its natural logarithm $\\ln E(t)$ is a linear function of time $t$ with slope $-\\alpha$. A least-squares linear regression is performed on $\\ln E(t)$ versus $t$ over a time window that starts after initial non-hydrodynamic transients have subsided (chosen here as $t \\in [T/4, T-1]$). The measured decay rate is the negative of the slope of this fit: $\\alpha_{\\mathrm{meas}} = -\\text{slope}$.\n\nFinally, the relative error $\\varepsilon = \\frac{|\\alpha_{\\mathrm{meas}} - \\alpha_{\\mathrm{th}}|}{\\alpha_{\\mathrm{th}}}$ is computed for each test case to quantify the accuracy of the LBM simulation.",
            "answer": "```python\nimport numpy as np\nfrom scipy import stats\n\ndef run_lbm_simulation(Nx, Ny, tau, m, T):\n    \"\"\"\n    Runs a D2Q9 LBM simulation for the Taylor-Green vortex decay.\n\n    Args:\n        Nx (int): Lattice size in x-direction.\n        Ny (int): Lattice size in y-direction.\n        tau (float): BGK relaxation time.\n        m (int): Wavenumber mode.\n        T (int): Total number of time steps.\n\n    Returns:\n        np.ndarray: Array of spatially averaged kinetic energy at each time step.\n    \"\"\"\n    # D2Q9 model parameters\n    c = np.array([[0, 0], [1, 0], [0, 1], [-1, 0], [0, -1],\n                  [1, 1], [-1, 1], [-1, -1], [1, -1]], dtype=int)\n    w = np.array([4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36])\n    cs2 = 1/3\n\n    # Reshape weights and velocities for vectorized operations\n    w_reshaped = w.reshape(9, 1, 1)\n\n    # Lattice grid\n    X, Y = np.meshgrid(np.arange(Nx), np.arange(Ny))\n\n    # Initial conditions\n    rho0 = 1.0\n    U0 = 0.05\n    # For all cases Nx = Ny, so kx = ky = k\n    k = 2 * np.pi * m / Nx\n    \n    ux_init = U0 * np.sin(k * X) * np.cos(k * Y)\n    uy_init = -U0 * np.cos(k * X) * np.sin(k * Y)\n\n    rho = np.full((Ny, Nx), rho0)\n\n    # Initialize distribution functions at equilibrium\n    f = np.zeros((9, Ny, Nx))\n    usq_init = ux_init**2 + uy_init**2\n    \n    # Vectorized equilibrium calculation\n    c_dot_u_init = c[:, 0].reshape(9, 1, 1) * ux_init + c[:, 1].reshape(9, 1, 1) * uy_init\n    f = w_reshaped * rho * (1 + c_dot_u_init/cs2 + c_dot_u_init**2/(2*cs2**2) - usq_init/(2*cs2))\n\n    kinetic_energy = np.zeros(T)\n\n    # Main simulation loop\n    for t in range(T):\n        # Macroscopic quantities\n        rho = np.sum(f, axis=0)\n        ux = np.einsum('i,ixy-xy', c[:,0], f) / rho\n        uy = np.einsum('i,ixy-xy', c[:,1], f) / rho\n\n        # Store kinetic energy (spatially averaged)\n        kinetic_energy[t] = 0.5 * np.mean(ux**2 + uy**2)\n\n        # Collision step (vectorized)\n        usq = ux**2 + uy**2\n        c_dot_u = c[:, 0].reshape(9, 1, 1) * ux + c[:, 1].reshape(9, 1, 1) * uy\n        feq = w_reshaped * rho * (1 + c_dot_u/cs2 + c_dot_u**2/(2*cs2**2) - usq/(2*cs2))\n        f -= (1/tau) * (f - feq)\n\n        # Streaming step\n        for i in range(9):\n            f[i, :, :] = np.roll(f[i, :, :], shift=(c[i, 1], c[i, 0]), axis=(0, 1))\n    \n    return kinetic_energy\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite.\n    \"\"\"\n    test_cases = [\n        # (Nx, Ny, tau, m, T)\n        (64, 64, 0.8, 1, 400),\n        (64, 64, 1.0, 2, 300),\n        (32, 32, 0.8, 1, 400),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx, Ny, tau, m, T = case\n        \n        # 1. Theoretical decay rate\n        cs2 = 1/3\n        nu = cs2 * (tau - 0.5)\n        k = 2 * np.pi * m / Nx  # kx = ky = k since Nx=Ny\n        alpha_th = 2 * nu * (k**2 + k**2)\n\n        # 2. Run LBM simulation\n        E = run_lbm_simulation(Nx, Ny, tau, m, T)\n        \n        # 3. Numerical decay rate from linear fit\n        # Use a time window after initial transients (e.g., last 3/4 of simulation)\n        fit_start_time = T // 4\n        time_fit = np.arange(fit_start_time, T)\n        \n        # Filter out any non-positive-definite energy values before taking log\n        valid_indices = E[fit_start_time:]  0\n        if not np.all(valid_indices):\n            # This case shouldn't happen in a stable simulation but is good practice\n            time_fit = time_fit[valid_indices]\n            log_E_fit = np.log(E[fit_start_time:][valid_indices])\n        else:\n            log_E_fit = np.log(E[fit_start_time:])\n            \n        slope = stats.linregress(time_fit, log_E_fit).slope\n        alpha_meas = -slope\n        \n        # 4. Compute relative error\n        relative_error = np.abs(alpha_meas - alpha_th) / alpha_th\n        results.append(relative_error)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{res:.3f}' for res in results])}]\")\n\nsolve()\n```"
        }
    ]
}