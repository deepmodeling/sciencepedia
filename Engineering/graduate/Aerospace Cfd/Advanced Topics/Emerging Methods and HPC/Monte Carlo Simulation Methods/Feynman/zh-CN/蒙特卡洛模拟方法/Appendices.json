{
    "hands_on_practices": [
        {
            "introduction": "在构建复杂的模拟之前，我们必须理解蒙特卡洛积分的核心思想及其收敛特性。本练习要求你计算达到特定精度所需的样本数量，从而将统计误差与样本量直接联系起来，这是任何蒙特卡洛应用的基石 。",
            "id": "2653261",
            "problem": "在平衡态统计力学中，可观测量（observables）的构型平均值（configurational averages）可以表示为关于目标概率密度函数（PDF）的期望。考虑在构型空间 $\\Omega=[0,1]$ 上定义的可观测量 $f(x)=x^{2}$，并假设目标 PDF $\\pi(x)$ 在 $\\Omega$ 上是均匀的，即当 $x \\in [0,1]$ 时 $\\pi(x)=1$。您希望使用基于从 $\\pi(x)$ 进行独立抽样的普通蒙特卡洛（MC）方案来估计积分 $I=\\int_{0}^{1} f(x)\\,dx$。\n\n任务：\n1. 使用从 $[0,1]$ 上的均匀分布中抽取的独立同分布样本 $X_{1},\\dots,X_{N}$，构建 $I$ 的普通蒙特卡洛估计量，并给出其以 $N$ 表示的标准误差。\n2. 仅使用独立性下的期望和方差的第一性原理，确定所需最小整数样本量 $N$，使得估计量的标准误差严格小于 $10^{-3}$。\n\n最终答案只提供最小整数 $N$（无量纲）。最终答案中不应出现任何推导过程。最终答案必须是一个数字。如果需要取整，请报告满足要求的最小整数（不要对该整数应用有效数字规则）。",
            "solution": "该问题要求根据指定的精度，确定蒙特卡洛估计所需的最小样本量。我们首先正式定义问题的各个组成部分。\n\n待估计的积分为 $I = \\int_{0}^{1} f(x) \\, dx$，其中可观测量函数为 $f(x) = x^{2}$，定义在构型空间 $\\Omega = [0,1]$ 上。目标概率密度函数在此区间上是均匀的，即当 $x \\in [0,1]$ 时，$\\pi(x) = 1$。因此，积分 $I$ 等价于 $f(X)$ 的期望，其中 $X$ 是从均匀分布 $U(0,1)$ 中抽取的随机变量。\n$$\nI = \\int_{0}^{1} x^{2} \\cdot \\pi(x) \\, dx = \\mathbb{E}_{\\pi}[f(X)] = \\mathbb{E}[X^{2}]\n$$\n这确立了第一性原理：该积分是一个期望。\n\n$I$ 的普通蒙特卡洛估计量（我们记为 $\\hat{I}_{N}$）是可观测量 $f(x)$ 在从分布 $\\pi(x)$ 中抽取的 $N$ 个独立同分布（i.i.d.）样本 $X_{1}, \\dots, X_{N}$ 上求值的样本均值。\n$$\n\\hat{I}_{N} = \\frac{1}{N} \\sum_{i=1}^{N} f(X_{i}) = \\frac{1}{N} \\sum_{i=1}^{N} X_{i}^{2}\n$$\n这就是任务第一部分的估计量。\n\n任务第一部分的第二项是确定该估计量的标准误差 $\\text{SE}(\\hat{I}_{N})$。标准误差是估计量方差的平方根，即 $\\text{SE}(\\hat{I}_{N}) = \\sqrt{\\text{Var}(\\hat{I}_{N})}$。由于样本是独立同分布的，样本均值的方差等于可观测量在总体中的方差除以样本量 $N$。\n$$\n\\text{Var}(\\hat{I}_{N}) = \\text{Var}\\left(\\frac{1}{N} \\sum_{i=1}^{N} X_{i}^{2}\\right) = \\frac{1}{N^{2}} \\sum_{i=1}^{N} \\text{Var}(X_{i}^{2}) = \\frac{N \\cdot \\text{Var}(X^{2})}{N^{2}} = \\frac{\\text{Var}(X^{2})}{N}\n$$\n这里，$\\text{Var}(X^{2})$ 是可观测量 $f(X) = X^{2}$ 的方差。随机变量 $Y$ 的方差由 $\\text{Var}(Y) = \\mathbb{E}[Y^{2}] - (\\mathbb{E}[Y])^{2}$ 给出。将此公式应用于我们的可观测量 $X^{2}$：\n$$\n\\text{Var}(X^{2}) = \\mathbb{E}\\left[(X^{2})^{2}\\right] - \\left(\\mathbb{E}[X^{2}]\\right)^{2} = \\mathbb{E}[X^{4}] - \\left(\\mathbb{E}[X^{2}]\\right)^{2}\n$$\n为继续进行计算，我们必须计算均匀分布 $U(0,1)$ 的必要矩。随机变量 $X \\sim U(0,1)$ 的 $k$ 阶矩为：\n$$\n\\mathbb{E}[X^{k}] = \\int_{0}^{1} x^{k} \\pi(x) \\, dx = \\int_{0}^{1} x^{k} \\, dx = \\left[ \\frac{x^{k+1}}{k+1} \\right]_{0}^{1} = \\frac{1}{k+1}\n$$\n我们需要二阶矩和四阶矩：\n$$\n\\mathbb{E}[X^{2}] = \\frac{1}{2+1} = \\frac{1}{3}\n$$\n$$\n\\mathbb{E}[X^{4}] = \\frac{1}{4+1} = \\frac{1}{5}\n$$\n将这些结果代回可观测量方差的表达式中：\n$$\n\\text{Var}(X^{2}) = \\frac{1}{5} - \\left(\\frac{1}{3}\\right)^{2} = \\frac{1}{5} - \\frac{1}{9} = \\frac{9 - 5}{45} = \\frac{4}{45}\n$$\n利用这个结果，估计量 $\\hat{I}_{N}$ 的标准误差为：\n$$\n\\text{SE}(\\hat{I}_{N}) = \\sqrt{\\frac{\\text{Var}(X^{2})}{N}} = \\sqrt{\\frac{4/45}{N}} = \\frac{2}{\\sqrt{45N}}\n$$\n这就完成了第一个任务的推导。\n\n第二个任务是找到最小整数样本量 $N$，使得标准误差严格小于 $10^{-3}$。我们建立不等式：\n$$\n\\text{SE}(\\hat{I}_{N})  10^{-3}\n$$\n$$\n\\frac{2}{\\sqrt{45N}}  10^{-3}\n$$\n我们现在解这个关于 $N$ 的不等式。\n$$\n\\sqrt{45N} > \\frac{2}{10^{-3}} = 2 \\times 10^{3} = 2000\n$$\n两边平方得到：\n$$\n45N > (2000)^{2} = 4 \\times 10^{6}\n$$\n$$\nN > \\frac{4 \\times 10^{6}}{45}\n$$\n为了确定 $N$ 的下限，我们计算这个分数：\n$$\n\\frac{4000000}{45} = \\frac{800000}{9} = 88888.888\\dots = 88888.\\overline{8}\n$$\n因此，条件是 $N > 88888.\\overline{8}$。由于样本量 $N$ 必须是整数，满足这个严格不等式的最小整数值是大于 $88888.\\overline{8}$ 的最小整数。\n$$\nN_{\\min} = 88889\n$$\n这就是所需的最小样本量。",
            "answer": "$$\\boxed{88889}$$"
        },
        {
            "introduction": "现实世界中的大多数问题都需要从非均匀分布中抽样，例如在物理现象建模中常见的指数分布和正态分布。这个基于编程的练习将指导你推导并实现两种基本技术——逆变换采样和Box-Muller变换，它们是蒙特卡洛实践者工具箱中的必备工具 。",
            "id": "3977015",
            "problem": "您正在航空航天计算流体动力学（CFD）中对随机涡流寿命和速度脉动进行建模。在许多湍流模型中，涡流的终止被视为一个无记忆事件，其终止前的等待时间由指数随机变量建模，而小尺度的速度脉动在二维情况下可以很好地用独立的标准正态随机变量来近似。您的任务是从第一性原理出发，推导合适的抽样方法，实现这些方法，并计算指定的蒙特卡洛指标。\n\n从基础概率定义出发，使用逆变换抽样法推导一个从指数分布中抽样的算法。具体来说，取一个在开区间 $(0,1)$ 上均匀分布的随机变量 $U$，推导指数分布的累积分布函数及其逆函数，并得到一个用于对速率参数为 $\\lambda$（单位为 $\\mathrm{s}^{-1}$）的指数随机变量 $X$ 进行抽样的表达式。请确保推导从累积分布函数的定义开始，并且不跳过任何中间逻辑步骤。\n\n然后，从一对独立标准正态随机变量 $(Z_1,Z_2)$ 的联合概率密度函数出发，通过适当的变量变换到极坐标，推导一种方法（Box–Muller 变换）从两个在 $(0,1)$ 上的独立均匀随机变量 $(U_1,U_2)$ 生成 $(Z_1,Z_2)$。您的推导必须包括雅可比行列式，并说明为什么最终的角度必须在 $[0,2\\pi)$ 上均匀分布（角度以弧度为单位），以及为什么径向分量的平方服从指数定律。\n\n实现要求：\n- 使用 $(0,1)$ 上的均匀随机数 $U$，为参数为 $\\lambda$ 的指数随机变量 $X$ 实现逆变换抽样算法。\n- 实现 Box–Muller 变换以从 $(U_1,U_2)$ 生成 $(Z_1,Z_2)$，注意当 $U_1$ 的值极其接近 $0$ 时（对数奇异点）的数值稳定性。\n- 通过为每个测试用例设置固定的种子来使用确定性伪随机数生成。\n\n为给定的测试套件计算以下蒙特卡洛指标。所有输出必须是纯数字（不附加单位），角度必须以弧度处理。在适用物理单位的情况下，按指定单位解释数值。\n\n测试套件：\n- 案例 1：涡流寿命的指数抽样，参数 $\\lambda=5.0\\,\\mathrm{s}^{-1}$，样本量 $N=200000$，种子 $20231011$。计算 $X$ 的样本均值，并以浮点数形式报告，单位为 $\\mathrm{s}$。\n- 案例 2：指数生存概率，参数 $\\lambda=5.0\\,\\mathrm{s}^{-1}$，阈值 $T=0.05\\,\\mathrm{s}$，样本量 $N=200000$，种子 $20231012$。计算 $\\mathbb{P}(XT)$ 的蒙特卡洛估计值，并报告此估计值与从第一性原理推导的理论值之间的绝对差，结果为浮点数（无量纲）。\n- 案例 3：Box–Muller 抽样质量，样本量 $N=200000$，种子 $5555$。计算以下五个量的最大绝对偏差：$Z_1$ 和 $Z_2$ 的样本均值，$Z_1$ 和 $Z_2$ 的样本方差与理论值 $1$ 之间的差值，以及 $Z_1$ 和 $Z_2$ 之间的样本相关性。将此最大绝对偏差报告为单个浮点数（无量纲）。\n- 案例 4：极端尺度下的指数抽样，参数 $\\lambda=10^{-4}\\,\\mathrm{s}^{-1}$，样本量 $N=100000$，种子 $7$。计算 $X$ 的样本均值与理论均值的比率，并将此比率报告为单个浮点数（无量纲）。\n- 案例 5：Box–Muller 在对数奇异点附近的行为，样本量 $N=50000$，种子 $8888$。将一个均匀抽样值覆盖为非常接近 $0$ 的数（为一对变量设置 $U_1=10^{-12}$），然后执行变换。报告所有生成的 $Z_1$ 和 $Z_2$ 中的最大绝对值，结果为单个浮点数（无量纲）。\n\n您的程序应生成单行输出，其中包含按案例 1 到 5 的顺序排列的结果，格式为方括号括起来的逗号分隔列表（例如，“[$r_1,r_2,r_3,r_4,r_5$]”）。答案必须由您的代码进行数值计算，并且必须是浮点数。对于涉及时间的量，按指定的 $\\mathrm{s}$ 单位解释数值；对于所有其他量，数值是无量纲的。所有角度都必须使用弧度。",
            "solution": "该问题被评估为有效，因为它在科学上基于概率论和计算统计学，问题阐述清晰，具有明确的目标和约束，语言客观，并且内部一致。它提出了一套与科学计算中的蒙特卡洛方法相关的标准但非平凡的任务。\n\n解决方案首先进行所要求的推导，然后实现算法以计算每个测试用例的指定指标。\n\n**第一部分：指数分布的逆变换抽样法推导**\n\n目标是给定一个来自区间 $(0,1)$ 的均匀随机变量 $U$，生成一个来自速率参数为 $\\lambda > 0$ 的指数分布的随机变量 $X$。\n\n指数随机变量 $X$ 的概率密度函数（PDF）由下式给出：\n$$ f_X(x; \\lambda) = \\begin{cases} \\lambda e^{-\\lambda x}  \\text{if } x \\ge 0 \\\\ 0  \\text{if } x  0 \\end{cases} $$\n累积分布函数（CDF）$F_X(x)$ 是概率 $\\mathbb{P}(X \\le x)$。对于 $x \\ge 0$，CDF 通过将 PDF 从 $0$ 积分到 $x$ 来计算：\n$$ F_X(x) = \\mathbb{P}(X \\le x) = \\int_0^x f_X(t; \\lambda) dt = \\int_0^x \\lambda e^{-\\lambda t} dt $$\n进行积分可得：\n$$ F_X(x) = \\lambda \\left[ -\\frac{1}{\\lambda} e^{-\\lambda t} \\right]_0^x = -[e^{-\\lambda t}]_0^x = -(e^{-\\lambda x} - e^0) = 1 - e^{-\\lambda x} $$\n因此，对于 $x \\ge 0$，CDF 为 $F_X(x) = 1 - e^{-\\lambda x}$。\n\n逆变换抽样法基于这样一个原理：如果 $U$ 是一个在 $(0,1)$ 上均匀分布的随机变量，那么随机变量 $X = F_X^{-1}(U)$ 就具有 CDF $F_X(x)$。要应用此方法，我们必须找到 CDF 的逆函数 $F_X^{-1}(u)$。\n\n设 $u = F_X(x)$，其中 $u \\in (0,1)$。我们以 $u$ 的形式求解 $x$：\n$$ u = 1 - e^{-\\lambda x} $$\n$$ e^{-\\lambda x} = 1 - u $$\n对两边取自然对数：\n$$ -\\lambda x = \\ln(1 - u) $$\n最后，解出 $x$ 得到逆函数：\n$$ x = F_X^{-1}(u) = -\\frac{1}{\\lambda} \\ln(1 - u) $$\n该表达式提供了从指数分布进行抽样的算法。\n\n一个常见的简化方法是利用以下事实：如果 $U \\sim U(0,1)$，那么随机变量 $V = 1 - U$ 也服从 $U(0,1)$ 分布。因此，我们可以在公式中用 $u$ 替换 $1 - u$，从而得到一个计算上等效且更直接的抽样公式：\n$$ X = -\\frac{1}{\\lambda} \\ln(U) $$\n其中 $U$ 是来自 $(0,1)$ 上均匀分布的一个样本。问题陈述中指定 $U$ 在开区间 $(0,1)$ 上，这正确地避免了在 $0$ 处的对数奇异点。\n\n**第二部分：Box-Muller 变换的推导**\n\n目标是从两个来自区间 $(0,1)$ 的独立均匀随机变量 $(U_1, U_2)$ 生成一对独立的标准正态随机变量 $(Z_1, Z_2)$。\n\n标准正态随机变量 $Z$ 的 PDF 为 $\\phi(z) = \\frac{1}{\\sqrt{2\\pi}} e^{-z^2/2}$。由于 $Z_1$ 和 $Z_2$ 是独立的，它们的联合 PDF 是它们各自 PDF 的乘积：\n$$ f_{Z_1, Z_2}(z_1, z_2) = \\phi(z_1) \\phi(z_2) = \\left( \\frac{1}{\\sqrt{2\\pi}} e^{-z_1^2/2} \\right) \\left( \\frac{1}{\\sqrt{2\\pi}} e^{-z_2^2/2} \\right) = \\frac{1}{2\\pi} e^{-\\frac{1}{2}(z_1^2 + z_2^2)} $$\n我们现在进行一次变量变换，从笛卡尔坐标 $(z_1, z_2)$ 变换到极坐标系统 $(r, \\theta)$，其中：\n$$ z_1 = r \\cos(\\theta) $$\n$$ z_2 = r \\sin(\\theta) $$\n其中 $r \\ge 0$ 且 $\\theta \\in [0, 2\\pi)$。项 $z_1^2 + z_2^2$ 变为 $r^2$。\n\n为了变换联合 PDF，我们需要从 $(r, \\theta)$到 $(z_1, z_2)$ 变换的雅可比行列式：\n$$ J = \\det \\begin{pmatrix} \\frac{\\partial z_1}{\\partial r}  \\frac{\\partial z_1}{\\partial \\theta} \\\\ \\frac{\\partial z_2}{\\partial r}  \\frac{\\partial z_2}{\\partial \\theta} \\end{pmatrix} = \\det \\begin{pmatrix} \\cos(\\theta)  -r \\sin(\\theta) \\\\ \\sin(\\theta)  r \\cos(\\theta) \\end{pmatrix} = r \\cos^2(\\theta) - (-r \\sin^2(\\theta)) = r(\\cos^2(\\theta) + \\sin^2(\\theta)) = r $$\n雅可比行列式的绝对值为 $|J| = r$。\n\n在极坐标中的联合 PDF $f_{R, \\Theta}(r, \\theta)$ 与笛卡尔坐标下的 PDF 的关系为 $f_{R, \\Theta}(r, \\theta) = f_{Z_1, Z_2}(z_1, z_2) |J|$。代入 $z_1^2 + z_2^2 = r^2$ 和 $|J| = r$，我们得到：\n$$ f_{R, \\Theta}(r, \\theta) = \\frac{1}{2\\pi} e^{-r^2/2} \\cdot r $$\n这个对于 $r \\in [0, \\infty)$ 和 $\\theta \\in [0, 2\\pi)$ 的联合 PDF 可以分解为两个独立的部分：\n$$ f_{R, \\Theta}(r, \\theta) = \\left( \\frac{1}{2\\pi} \\right) \\cdot \\left( r e^{-r^2/2} \\right) = f_{\\Theta}(\\theta) \\cdot f_R(r) $$\n这种分解表明随机变量 $R$ 和 $\\Theta$ 是独立的。\n\n$\\Theta$ 的边际 PDF 是 $f_{\\Theta}(\\theta) = \\frac{1}{2\\pi}$，其中 $\\theta \\in [0, 2\\pi)$。这是在 $[0, 2\\pi)$ 上的均匀分布的 PDF。因此，我们可以通过变换 $\\Theta = 2\\pi U_2$ 从一个均匀随机变量 $U_2 \\sim U(0,1)$ 生成 $\\Theta$。这直接回答了为什么角度必须是均匀分布的。\n\n$R$ 的边际 PDF 是 $f_R(r) = r e^{-r^2/2}$，其中 $r \\ge 0$。这是一个瑞利分布。我们可以使用逆变换抽样来生成 $R$。首先，我们找到它的 CDF，$F_R(s) = \\mathbb{P}(R \\le s):$\n$$ F_R(s) = \\int_0^s r e^{-r^2/2} dr $$\n使用换元法 $v = r^2/2$，这意味着 $dv = r dr$，积分变为：\n$$ F_R(s) = \\int_0^{s^2/2} e^{-v} dv = [-e^{-v}]_0^{s^2/2} = 1 - e^{-s^2/2} $$\n为了找到抽样公式，我们设 $u_1 = F_R(r) = 1 - e^{-r^2/2}$ 并求解 $r$：\n$$ e^{-r^2/2} = 1 - u_1 \\implies -\\frac{r^2}{2} = \\ln(1 - u_1) \\implies r^2 = -2 \\ln(1-u_1) $$\n使用与指数分布相同的逻辑，我们可以用另一个均匀随机变量 $U_1 \\sim U(0,1)$ 替换 $1-U_1$，得到 $r^2 = -2 \\ln(U_1)$。这表明半径的平方 $R^2$ 服从速率参数为 $\\lambda = 1/2$ 的指数分布。取平方根得到 $R$ 的抽样公式：\n$$ R = \\sqrt{-2 \\ln(U_1)} $$\n这里，$U_1$ 必须在 $(0,1)$ 内以避免对零取对数。\n\n结合这些结果，Box-Muller 变换算法如下：\n1.  生成两个独立的均匀随机变量 $U_1, U_2 \\sim U(0,1)$。\n2.  计算 $R = \\sqrt{-2 \\ln(U_1)}$ 和 $\\Theta = 2\\pi U_2$。\n3.  转换回笛卡尔坐标以获得标准正态变量：\n    $$ Z_1 = R \\cos(\\Theta) = \\sqrt{-2 \\ln(U_1)} \\cos(2\\pi U_2) $$\n    $$ Z_2 = R \\sin(\\Theta) = \\sqrt{-2 \\ln(U_1)} \\sin(2\\pi U_2) $$\n\n这样就完成了从第一性原理出发的所需推导。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the five test cases specified in the problem statement.\n    \"\"\"\n    results = []\n\n    # --- Case 1: Exponential Sample Mean ---\n    lambda_1 = 5.0\n    N_1 = 200000\n    seed_1 = 20231011\n    rng_1 = np.random.default_rng(seed_1)\n    u_1 = rng_1.uniform(low=0.0, high=1.0, size=N_1)\n    # Ensure u_1 is in (0, 1) by replacing any exact 0.0, though highly unlikely.\n    u_1[u_1 == 0] = np.finfo(float).eps\n    x_1 = -1.0 / lambda_1 * np.log(u_1)\n    sample_mean_1 = np.mean(x_1)\n    results.append(sample_mean_1)\n\n    # --- Case 2: Exponential Survival Probability ---\n    lambda_2 = 5.0\n    T_2 = 0.05\n    N_2 = 200000\n    seed_2 = 20231012\n    rng_2 = np.random.default_rng(seed_2)\n    u_2 = rng_2.uniform(low=0.0, high=1.0, size=N_2)\n    u_2[u_2 == 0] = np.finfo(float).eps\n    x_2 = -1.0 / lambda_2 * np.log(u_2)\n    mc_prob_2 = np.sum(x_2 > T_2) / N_2\n    theoretical_prob_2 = np.exp(-lambda_2 * T_2)\n    abs_diff_2 = np.abs(mc_prob_2 - theoretical_prob_2)\n    results.append(abs_diff_2)\n\n    # --- Case 3: Box-Muller Sampling Quality ---\n    N_3 = 200000\n    seed_3 = 5555\n    rng_3 = np.random.default_rng(seed_3)\n    u1_3 = rng_3.uniform(low=0.0, high=1.0, size=N_3)\n    u2_3 = rng_3.uniform(low=0.0, high=1.0, size=N_3)\n    # Handle potential log(0)\n    u1_3[u1_3 == 0] = np.finfo(float).eps\n    \n    R_3 = np.sqrt(-2.0 * np.log(u1_3))\n    Theta_3 = 2.0 * np.pi * u2_3\n    \n    z1_3 = R_3 * np.cos(Theta_3)\n    z2_3 = R_3 * np.sin(Theta_3)\n    \n    mean_z1 = np.mean(z1_3)\n    mean_z2 = np.mean(z2_3)\n    # Use ddof=1 for sample variance, an unbiased estimator of population variance.\n    var_z1 = np.var(z1_3, ddof=1)\n    var_z2 = np.var(z2_3, ddof=1)\n    corr_z1_z2 = np.corrcoef(z1_3, z2_3)[0, 1]\n    \n    devs_3 = [\n        np.abs(mean_z1),\n        np.abs(mean_z2),\n        np.abs(var_z1 - 1.0),\n        np.abs(var_z2 - 1.0),\n        np.abs(corr_z1_z2)\n    ]\n    max_dev_3 = np.max(devs_3)\n    results.append(max_dev_3)\n\n    # --- Case 4: Exponential Sampling Under Scaling Extremes ---\n    lambda_4 = 1e-4\n    N_4 = 100000\n    seed_4 = 7\n    rng_4 = np.random.default_rng(seed_4)\n    u_4 = rng_4.uniform(low=0.0, high=1.0, size=N_4)\n    u_4[u_4 == 0] = np.finfo(float).eps\n    x_4 = -1.0 / lambda_4 * np.log(u_4)\n    sample_mean_4 = np.mean(x_4)\n    theoretical_mean_4 = 1.0 / lambda_4\n    ratio_4 = sample_mean_4 / theoretical_mean_4\n    results.append(ratio_4)\n    \n    # --- Case 5: Box-Muller Behavior Near Singularity ---\n    N_5 = 50000\n    seed_5 = 8888\n    rng_5 = np.random.default_rng(seed_5)\n    u1_5 = rng_5.uniform(low=0.0, high=1.0, size=N_5)\n    u2_5 = rng_5.uniform(low=0.0, high=1.0, size=N_5)\n    \n    # Override one draw to be very close to 0\n    u1_5[0] = 1e-12\n    # Ensure no other values are exactly 0\n    u1_5[u1_5 == 0] = np.finfo(float).eps\n\n    R_5 = np.sqrt(-2.0 * np.log(u1_5))\n    Theta_5 = 2.0 * np.pi * u2_5\n    \n    z1_5 = R_5 * np.cos(Theta_5)\n    z2_5 = R_5 * np.sin(Theta_5)\n    \n    max_abs_z = np.max([np.max(np.abs(z1_5)), np.max(np.abs(z2_5))])\n    results.append(max_abs_z)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "对于计算流体力学和统计力学中的许多高维问题，直接采样是不可行的，这使得马尔可夫链蒙特卡洛 (MCMC) 方法成为必需。本概念性练习通过分析一个“失效”的算法来探讨细致平衡这一关键条件，旨在让你深入思考为何Metropolis-Hastings修正是确保算法收敛到正确目标分布的根本所在 。",
            "id": "2458820",
            "problem": "一个一维系统在逆温度 $\\beta$下的正则目标分布由 $\\pi(x) \\propto \\exp\\!\\left(-\\beta\\,U(x)\\right)$ 给出，其中势能为 $U(x) = \\tfrac{k}{2}\\,x^{2}$ 且 $k0$。为了对 $\\pi(x)$进行采样，一个算法实现了一个马尔可夫链蒙特卡洛 (MCMC) 方案，其提议概率密度为非对称高斯分布\n$$\ng(x \\to x') \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,s}\\,\\exp\\!\\left(-\\frac{(x' - x - \\mu)^{2}}{2 s^{2}}\\right),\n$$\n其中 $\\mu \\neq 0$ 和 $s0$ 是固定常数。所实现的接受概率为\n$$\na(x \\to x') \\;=\\; \\min\\!\\left\\{\\,1,\\; \\exp\\!\\left(-\\beta\\,[\\,U(x') - U(x)\\,]\\right)\\right\\},\n$$\n并且没有对非对称提议使用额外的修正。\n\n关于该算法的长时间行为，下列哪些陈述是正确的？\n\nA. 因为接受概率仅取决于能量差，所以对于任何 $\\mu$，马尔可夫链都满足关于 $\\pi(x)$ 的细致平衡，因此能精确采样玻尔兹曼分布。\n\nB. 对于 $\\mu \\neq 0$，关于 $\\pi(x)$ 的细致平衡被违反；马尔可夫链可能收敛到一个不同于 $\\pi(x)$ 的有偏稳态分布，该分布由 $\\mu$ 和 $s$ 决定。\n\nC. 细致平衡的违反意味着该马尔可夫链不存在稳态分布。\n\nD. 该算法仅在 $\\mu = 0$ 的特殊情况下，或者在接受概率被修改以包含 Hastings 因子 $g(x' \\to x)/g(x \\to x')$ 的情况下，才能精确采样 $\\pi(x)$。\n\nE. 在稳态下，使用朴素接受概率且 $\\mu \\neq 0$ 时，对于某些状态对 $(x,x')$，存在非零的概率流 $J(x,x') = \\pi_{\\mathrm{ss}}(x)\\,P(x \\to x') - \\pi_{\\mathrm{ss}}(x')\\,P(x' \\to x)$，这表明微观可逆性被破坏。\n\nF. 因为 $\\mu  0$，马尔可夫链必然会漂移至 $+\\infty$，并且对于任何 $k$、$\\beta$ 和 $s$ 的值，它都无法满足遍历性。",
            "solution": "问题陈述经过验证，是有效的。它描述了一个定义明确的马尔可夫链蒙特卡洛 (MCMC) 算法，具有指定的目标分布、提议密度和接受规则。问题要求分析该算法的长时间行为，这是计算物理学中的一个标准问题。\n\nMCMC 方法的核心是构建一个马尔可夫链，使其稳态分布为所需的目标分布 $\\pi(x)$。一个充分条件是满足细致平衡条件：\n$$\n\\pi(x) P(x \\to x') = \\pi(x') P(x' \\to x)\n$$\n对于所有状态 $x$ 和 $x'$。这里，$P(x \\to x')$ 是从状态 $x$ 到状态 $x'$ 的转移概率。对于 Metropolis-Hastings 类型的算法，从 $x$ 到 $x' \\neq x$ 的转移概率由提议概率密度 $g(x \\to x')$ 和接受概率 $a(x \\to x')$ 的乘积给出。\n$$\nP(x \\to x') = g(x \\to x') a(x \\to x')\n$$\n确保细致平衡的接受概率的一般形式是 Metropolis-Hastings 规则：\n$$\na_{\\text{MH}}(x \\to x') = \\min\\left\\{1, \\frac{\\pi(x') g(x' \\to x)}{\\pi(x) g(x \\to x')}\\right\\}\n$$\n根据构造，在 $P(x \\to x')$ 的表达式中使用这个接受概率，可以满足关于 $\\pi(x)$ 的细致平衡方程。\n\n问题陈述指出，所实现的算法使用了一个“朴素”的接受概率，这对应于更简单的 Metropolis 规则：\n$$\na(x \\to x') = \\min\\left\\{1, \\frac{\\pi(x')}{\\pi(x)}\\right\\} = \\min\\left\\{1, \\exp(-\\beta [U(x') - U(x)])\\right\\}\n$$\n让我们检验一下这个选择在给定的非对称提议密度下是否满足细致平衡。将实现的 $P(x \\to x')$ 代入细致平衡条件：\n$$\n\\pi(x) g(x \\to x') a(x \\to x') \\stackrel{?}{=} \\pi(x') g(x' \\to x) a(x' \\to x)\n$$\n$$\n\\pi(x) g(x \\to x') \\min\\left\\{1, \\frac{\\pi(x')}{\\pi(x)}\\right\\} \\stackrel{?}{=} \\pi(x') g(x' \\to x) \\min\\left\\{1, \\frac{\\pi(x)}{\\pi(x')}\\right\\}\n$$\n我们可以使用恒等式 $\\min\\{1, A\\} = A \\min\\{1, 1/A\\}$。令 $A = \\pi(x')/\\pi(x)$。方程变为：\n$$\n\\pi(x) g(x \\to x') \\frac{\\pi(x')}{\\pi(x)} \\min\\left\\{1, \\frac{\\pi(x)}{\\pi(x')}\\right\\} \\stackrel{?}{=} \\pi(x') g(x' \\to x) \\min\\left\\{1, \\frac{\\pi(x)}{\\pi(x')}\\right\\}\n$$\n两边同除以非零的 $\\pi(x') \\min\\{1, \\pi(x)/\\pi(x')\\}$，我们发现条件简化为：\n$$\ng(x \\to x') \\stackrel{?}{=} g(x' \\to x)\n$$\n这表明，当且仅当提议密度 $g(x \\to x')$ 是对称的时，所实现的算法才满足细致平衡。\n\n让我们检查给定提议密度的对称性：\n$$\ng(x \\to x') = \\frac{1}{\\sqrt{2\\pi}\\,s}\\,\\exp\\left(-\\frac{(x' - x - \\mu)^{2}}{2 s^{2}}\\right)\n$$\n$$\ng(x' \\to x) = \\frac{1}{\\sqrt{2\\pi}\\,s}\\,\\exp\\left(-\\frac{(x - x' - \\mu)^{2}}{2 s^{2}}\\right) = \\frac{1}{\\sqrt{2\\pi}\\,s}\\,\\exp\\left(-\\frac{(-(x' - x) - \\mu)^{2}}{2 s^{2}}\\right) = \\frac{1}{\\sqrt{2\\pi}\\,s}\\,\\exp\\left(-\\frac{(x' - x + \\mu)^{2}}{2 s^{2}}\\right)\n$$\n要使 $g(x \\to x') = g(x' \\to x)$，指数必须相等：\n$$\n(x' - x - \\mu)^2 = (x' - x + \\mu)^2\n$$\n这意味着 $x' - x - \\mu = \\pm(x' - x + \\mu)$。取正号得到 $-\\mu = \\mu$，即 $\\mu = 0$。取负号得到 $x' - x - \\mu = -(x' - x) - \\mu$，这意味着 $x' = x$，这是一个平凡情况。\n因此，只有当 $\\mu=0$ 时，提议才是对称的。由于问题指定 $\\mu \\neq 0$，所以提议是非对称的，关于 $\\pi(x)$ 的细致平衡条件被违反。\n\n现在我们评估每个陈述：\n\nA. 因为接受概率仅取决于能量差，所以对于任何 $\\mu$，马尔可夫链都满足关于 $\\pi(x)$ 的细致平衡，因此能精确采样玻尔兹曼分布。\n这个陈述是**不正确**的。如上所述，Metropolis 接受规则（仅取决于能量/概率比）仅在提议分布对称时才能确保细致平衡。由于当 $\\mu \\neq 0$ 时，$g(x \\to x')$ 不是对称的，所以细致平衡被违反。\n\nB. 对于 $\\mu \\neq 0$，关于 $\\pi(x)$ 的细致平衡被违反；马尔可夫链可能收敛到一个不同于 $\\pi(x)$ 的有偏稳态分布，该分布由 $\\mu$ 和 $s$ 决定。\n这个陈述是**正确**的。第一部分，即当 $\\mu \\neq 0$ 时细致平衡被违反，如前所述是正确的。当关于目标分布 $\\pi(x)$ 的细致平衡不满足时，马尔可夫链如果收敛，将会收敛到一个不同的稳态分布 $\\pi_{\\mathrm{ss}}(x)$。稳态分布的存在性是有保证的，因为二次势 $U(x) = \\frac{k}{2}x^2$ 是限制性的，确保了马尔可夫链是正常返的，因而是遍历的。得到的分布 $\\pi_{\\mathrm{ss}}(x)$ 是“有偏的”，因为它不是预期的目标分布 $\\pi(x)$。这种偏差的性质由提议分布的参数，即 $\\mu$ 和 $s$ 决定。\n\nC. 细致平衡的违反意味着该马尔可夫链不存在稳态分布。\n这个陈述是**不正确**的。违反细致平衡只意味着马尔可夫链不是可逆的。稳态分布由更弱的全局平衡条件 $\\pi_{\\mathrm{ss}}(y) = \\int \\pi_{\\mathrm{ss}}(x) P(x \\to y) dx$ 保证。对于一个遍历的马尔可夫链，保证存在唯一的稳态分布。如在 B 中所论证的，势的限制性确保了遍历性。\n\nD. 该算法仅在 $\\mu = 0$ 的特殊情况下，或者在接受概率被修改以包含 Hastings 因子 $g(x' \\to x)/g(x \\to x')$ 的情况下，才能精确采样 $\\pi(x)$。\n这个陈述是**正确**的。它准确地描述了修正这个有缺陷算法的两种方法。1. 如果 $\\mu = 0$，提议变为对称的，所实现的 Metropolis 接受规则足以满足细致平衡。该算法能正确采样 $\\pi(x)$。2. 如果将接受概率修改为完整的 Metropolis-Hastings 形式，$a(x \\to x') = \\min\\{1, \\frac{\\pi(x')}{\\pi(x)} \\frac{g(x' \\to x)}{g(x \\to x')}\\}$，它就能正确地解释提议的非对称性。这个修正后的算法根据构造满足细致平衡，并且对于任何 $\\mu$ 都能采样 $\\pi(x)$。该陈述正确地指出了这些是精确采样的条件。\n\nE. 在稳态下，使用朴素接受概率且 $\\mu \\neq 0$ 时，对于某些状态对 $(x,x')$，存在非零的概率流 $J(x,x') = \\pi_{\\mathrm{ss}}(x)\\,P(x \\to x') - \\pi_{\\mathrm{ss}}(x')\\,P(x' \\to x)$，这表明微观可逆性被破坏。\n这个陈述是**正确**的。“稳态”指的是系统从其稳态分布 $\\pi_{\\mathrm{ss}}(x)$ 中采样的状态。微观可逆性等价于稳态分布满足细致平衡条件，即对于所有状态对 $(x,x')$，$J(x,x') = 0$。在没有适当的 Hastings 修正的情况下使用非对称提议，类似于使系统受到一个非保守驱动力。这类驱动系统通常会稳定在一个非平衡稳态 (NESS)，这种状态根本上是不可逆的，其特征是存在持续的概率流。该马尔可夫链不满足关于其自身稳态分布 $\\pi_{\\mathrm{ss}}(x)$ 的细致平衡，因此对于某些状态对 $(x,x')$，$J(x,x')$ 必须为非零。\n\nF. 因为 $\\mu  0$，马尔可夫链必然会漂移至 $+\\infty$，并且对于任何 $k$、$\\beta$ 和 $s$ 的值，它都无法满足遍历性。\n这个陈述是**不正确**的。提议机制引入了一个恒定的漂移偏置 $\\mu$。然而，目标分布具有一个二次势 $U(x) = \\frac{k}{2}x^2$，它提供了一个恢复力 $-dU/dx = -kx$，该力随偏离原点的位移线性增长。对于大的 $|x|$，远离原点的移动会被接受概率强烈抑制，该概率取决于 $\\exp(-\\beta [U(x') - U(x)])$。这种限制势阻止了行走者逃逸到无穷远，确保了链是常返的（特别是正常返的），因而是遍历的。由于漂移，稳态分布的均值会发生偏移，但它将是一个正常的、可归一化的分布。",
            "answer": "$$\\boxed{BDE}$$"
        }
    ]
}