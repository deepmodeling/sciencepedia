{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握Roe平均法的精髓，最好的方法莫过于将其应用于一个经典的流体力学问题。本练习将以Sod激波管问题为背景，这是一个计算流体力学中用于验证数值格式的标准基准测试。通过亲手计算Roe平均速度 $\\tilde{u}$、比焓 $\\tilde{H}$ 和声速 $\\tilde{a}$，你将深入理解这些量的物理意义，并评估在特定情况下熵修正是否被激活 ()。这项实践旨在将抽象的理论公式与具体的数值计算联系起来，从而巩固你对Roe格式核心机制的理解。",
            "id": "3992402",
            "problem": "考虑计算流体力学（CFD）中的无粘性可压缩流的一维欧拉方程，其守恒形式写作状态向量 $U = (\\rho, \\rho u, E)^{\\mathsf{T}}$ 和通量 $F(U) = (\\rho u, \\rho u^{2} + p, u(E + p))^{\\mathsf{T}}$。初始数据对应于 Sod 激波管黎曼问题，对于比热比 $\\gamma = 1.4$ 的理想气体，其左状态为 $U_{L} = (\\rho_{L}, u_{L}, p_{L}) = (1.0, 0, 1.0)$，右状态为 $U_{R} = (\\rho_{R}, u_{R}, p_{R}) = (0.125, 0, 0.1)$。您可以使用理想气体关系式 $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^{2}\\right)$、声速 $a = \\sqrt{\\gamma p / \\rho}$ 以及比总焓 $H = (E + p)/\\rho = \\tfrac{\\gamma}{\\gamma - 1}\\tfrac{p}{\\rho} + \\tfrac{1}{2}u^{2}$。\n\n从控制方程和这些热力学定义出发，推导 $U_{L}$ 和 $U_{R}$ 之间界面的 Roe 线性化。计算 Roe 平均速度 $\\tilde{u}$、比总焓 $\\tilde{H}$ 和声速 $\\tilde{a}$。然后，通过使用 Roe 特征结构将跳跃量 $\\Delta U = U_{R} - U_{L}$ 分解为特征波，构建界面处的 Roe 矩阵特征值和相应的 Roe 通量 $F_{i+1/2}^{\\mathrm{Roe}}$。最后，对左行声场实施 Harten 熵修正，使用阈值\n$$\\delta_{1} = \\max\\!\\big(0,\\, \\lambda_{1,R} - \\lambda_{1,L}\\big),$$\n其中 $\\lambda_{1,L} = u_{L} - a_{L}$ 和 $\\lambda_{1,R} = u_{R} - a_{R}$ 是从物理（非 Roe）状态计算得到的相应左/右声学特征值，并应用修正后的粘性函数\n$$|\\lambda|_{\\mathrm{fix}} = \\begin{cases}\n\\dfrac{1}{2}\\!\\left(\\dfrac{\\lambda^{2}}{\\delta} + \\delta\\right), & \\text{if } |\\lambda| < \\delta, \\\\\n|\\lambda|, & \\text{otherwise,}\n\\end{cases}$$\n其中 $\\lambda$ 等于界面处的 Roe 左行声学特征值。评估此熵修正是否改变了与初始间断处的稀疏扇相关的波速。\n\n作为最终答案，报告界面处左行声学特征速度经熵修正后的大小。将所有量视为无量纲，并将您的最终值四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是有效的。这是一个基于已确立科学原理的计算流体力学中的适定问题。所有必要的数据和定义都已提供，不存在内部矛盾或歧义。\n\n该问题要求使用 Roe 线性化和 Harten 型熵修正，计算 Sod 激波管问题中左行声学特征速度经熵修正后的大小。\n\n一维欧拉方程由 $\\partial_t U + \\partial_x F(U) = 0$ 给出，其中状态向量为 $U = (\\rho, \\rho u, E)^{\\mathsf{T}}$，通量向量为 $F(U) = (\\rho u, \\rho u^{2} + p, u(E + p))^{\\mathsf{T}}$。比热比为 $\\gamma = 1.4$。理想气体的状态方程为 $p = (\\gamma - 1)(E - \\frac{1}{2}\\rho u^2)$。\n\n首先，我们用原始变量和守恒变量来定义左（$L$）和右（$R$）状态。\n初始原始变量为：\n左状态：$\\rho_L = 1.0$, $u_L = 0$, $p_L = 1.0$。\n右状态：$\\rho_R = 0.125$, $u_R = 0$, $p_R = 0.1$。\n\n由此，我们计算每个状态的单位体积总能量 $E$：\n$E_L = \\frac{p_L}{\\gamma - 1} + \\frac{1}{2}\\rho_L u_L^2 = \\frac{1.0}{1.4 - 1} + \\frac{1}{2}(1.0)(0)^2 = \\frac{1.0}{0.4} = 2.5$。\n$E_R = \\frac{p_R}{\\gamma - 1} + \\frac{1}{2}\\rho_R u_R^2 = \\frac{0.1}{1.4 - 1} + \\frac{1}{2}(0.125)(0)^2 = \\frac{0.1}{0.4} = 0.25$。\n\n守恒形式的状态向量为：\n$U_L = (\\rho_L, \\rho_L u_L, E_L)^{\\mathsf{T}} = (1.0, 0, 2.5)^{\\mathsf{T}}$。\n$U_R = (\\rho_R, \\rho_R u_R, E_R)^{\\mathsf{T}} = (0.125, 0, 0.25)^{\\mathsf{T}}$。\n\n接下来，我们计算每个状态的比总焓 $H = (E+p)/\\rho$：\n$H_L = \\frac{E_L + p_L}{\\rho_L} = \\frac{2.5 + 1.0}{1.0} = 3.5$。\n$H_R = \\frac{E_R + p_R}{\\rho_R} = \\frac{0.25 + 0.1}{0.125} = \\frac{0.35}{0.125} = 2.8$。\n\nRoe 平均状态的定义满足属性 $F_R - F_L = \\tilde{A}(U_R - U_L)$，其中 $\\tilde{A}$ 是在 Roe 平均状态下求值的 Roe 矩阵。Roe 平均变量计算如下：\n$\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1.0}(0) + \\sqrt{0.125}(0)}{\\sqrt{1.0} + \\sqrt{0.125}} = 0$。\n$\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1.0}(3.5) + \\sqrt{0.125}(2.8)}{\\sqrt{1.0} + \\sqrt{0.125}}$。\n使用 $\\sqrt{0.125} = \\sqrt{1/8} = 1/(2\\sqrt{2}) = \\frac{\\sqrt{2}}{4}$:\n$\\tilde{H} = \\frac{3.5 + \\frac{\\sqrt{2}}{4}(2.8)}{1 + \\frac{\\sqrt{2}}{4}} = \\frac{4(3.5 + 0.7\\sqrt{2})}{4(1 + \\frac{\\sqrt{2}}{4})} = \\frac{14 + 2.8\\sqrt{2}}{4 + \\sqrt{2}}$。\n分母有理化：\n$\\tilde{H} = \\frac{14 + 2.8\\sqrt{2}}{4 + \\sqrt{2}} \\cdot \\frac{4 - \\sqrt{2}}{4 - \\sqrt{2}} = \\frac{56 - 14\\sqrt{2} + 11.2\\sqrt{2} - 2.8(2)}{16 - 2} = \\frac{50.4 - 2.8\\sqrt{2}}{14} = 3.6 - 0.2\\sqrt{2}$。\n\nRoe 平均声速 $\\tilde{a}$ 由 $\\tilde{a}^2 = (\\gamma - 1)(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2)$ 给出：\n$\\tilde{a}^2 = (1.4 - 1)( (3.6 - 0.2\\sqrt{2}) - \\frac{1}{2}(0)^2) = 0.4(3.6 - 0.2\\sqrt{2}) = 1.44 - 0.08\\sqrt{2}$。\n$\\tilde{a} = \\sqrt{1.44 - 0.08\\sqrt{2}}$。\n\nRoe 矩阵 $\\tilde{A}$ 的特征值为 $\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{a}$，$\\tilde{\\lambda}_2 = \\tilde{u}$ 和 $\\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{a}$。左行声学特征速度为：\n$\\tilde{\\lambda}_1 = 0 - \\sqrt{1.44 - 0.08\\sqrt{2}} = -\\sqrt{1.44 - 0.08\\sqrt{2}}$。\n\n现在我们必须评估 Harten 熵修正是否被激活。如果 $|\\tilde{\\lambda}_1| < \\delta_1$，则应用该修正。阈值 $\\delta_1$ 定义为 $\\delta_1 = \\max(0, \\lambda_{1,R} - \\lambda_{1,L})$。\n首先，我们计算物理（非平均）声速 $a_L$ 和 $a_R$：\n$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{1.4 \\cdot 1.0}{1.0}} = \\sqrt{1.4}$。\n$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{1.4 \\cdot 0.1}{0.125}} = \\sqrt{1.4 \\cdot 0.8} = \\sqrt{1.12}$。\n\n接下来，我们计算物理特征速度 $\\lambda_{1,L}$ 和 $\\lambda_{1,R}$：\n$\\lambda_{1,L} = u_L - a_L = 0 - \\sqrt{1.4} = -\\sqrt{1.4}$。\n$\\lambda_{1,R} = u_R - a_R = 0 - \\sqrt{1.12} = -\\sqrt{1.12}$。\n\n现在，我们计算阈值 $\\delta_1$：\n$\\delta_1 = \\max(0, \\lambda_{1,R} - \\lambda_{1,L}) = \\max(0, -\\sqrt{1.12} - (-\\sqrt{1.4})) = \\max(0, \\sqrt{1.4} - \\sqrt{1.12})$。\n数值上，$\\sqrt{1.4} \\approx 1.1832$ 且 $\\sqrt{1.12} \\approx 1.0583$。由于 $\\sqrt{1.4} > \\sqrt{1.12}$，我们有：\n$\\delta_1 = \\sqrt{1.4} - \\sqrt{1.12} \\approx 0.1249$。\n\n熵修正条件是 $|\\tilde{\\lambda}_1| < \\delta_1$。让我们评估这些量：\n$|\\tilde{\\lambda}_1| = \\sqrt{1.44 - 0.08\\sqrt{2}}$。使用 $\\sqrt{2} \\approx 1.4142$：\n$|\\tilde{\\lambda}_1| \\approx \\sqrt{1.44 - 0.08(1.4142)} = \\sqrt{1.44 - 0.113136} = \\sqrt{1.326864} \\approx 1.1519$。\n\n比较这些值：\n$|\\tilde{\\lambda}_1| \\approx 1.1519$\n$\\delta_1 \\approx 0.1249$\n条件 $|\\tilde{\\lambda}_1| < \\delta_1$ 即 $1.1519 < 0.1249$，这是不成立的。\n\nHarten 熵修正由修正后的粘性函数定义：\n$|\\lambda|_{\\mathrm{fix}} = \\begin{cases} \\frac{1}{2}(\\frac{\\lambda^2}{\\delta} + \\delta), & \\text{if } |\\lambda| < \\delta, \\\\ |\\lambda|, & \\text{otherwise.} \\end{cases}$\n由于条件 $|\\tilde{\\lambda}_1| < \\delta_1$ 不满足，我们属于“否则”的情况。因此，熵修正不改变波速。\n经熵修正的左行声学特征速度的大小为：\n$|\\tilde{\\lambda}_1|_{\\mathrm{fix}} = |\\tilde{\\lambda}_1| = \\sqrt{1.44 - 0.08\\sqrt{2}}$。\n\n问题要求将此值四舍五入到四位有效数字。\n$|\\tilde{\\lambda}_1|_{\\mathrm{fix}} = \\sqrt{1.44 - 0.08\\sqrt{2}} \\approx \\sqrt{1.44 - 0.08(1.41421356)} \\approx \\sqrt{1.44 - 0.11313708} \\approx \\sqrt{1.32686292} \\approx 1.15189536$。\n\n四舍五入到四位有效数字，我们得到 $1.152$。\n\n对熵修正的评估是，在此 Sod 激波管问题中，它不改变左行稀疏波的波速。这是预期的行为，因为该修正旨在主要为跨音速稀疏波（其中特征值穿过零）增加数值耗散，而这里的情况并非如此（$\\lambda_{1,L}$ 和 $\\lambda_{1,R}$ 均为负值）。\n\n最终答案计算：\n需报告的值：$|\\tilde{\\lambda}_1|_{\\mathrm{fix}} = 1.15189536 \\dots$\n四舍五入到四位有效数字：$1.152$。",
            "answer": "$$\\boxed{1.152}$$"
        },
        {
            "introduction": "在掌握了如何应用Roe格式之后，一个更高级的技能是识别其固有的局限性并设计应对策略。本练习探讨了标准Roe求解器的一个关键失效模式：在某些极端情况下，Roe平均过程可能产生一个非物理的中间状态，导致计算出的Roe平均声速的平方 $\\tilde{c}^2$ 为负值 ()。这种情况会破坏控制方程组的“双曲性”，导致数值模拟的崩溃。通过评估不同的解决方案，本练习旨在培养构建健壮、可靠数值格式所必需的批判性思维，让你从一个方法的使用者成长为一个能预见并规避其陷阱的开发者。",
            "id": "3992411",
            "problem": "考虑理想气体的一维可压缩欧拉方程，其比热比为 $\\gamma$，以守恒形式写出密度 $\\rho$、动量 $\\rho u$ 和总能量 $E$。在物理允许的状态下，与这些方程相关的通量雅可比矩阵有三个实特征值：$u-c$、$u$ 和 $u+c$，其中 $u$ 是流体速度，$c$ 是热力学声速，定义为 $c^2 = \\gamma p/\\rho = (\\gamma-1)\\left(H-\\frac{1}{2}u^2\\right)$，其中 $p$ 是压力，$H = (E+p)/\\rho$ 是总比焓。在 Roe 近似黎曼求解器中，根据左、右状态 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$，在一个 Roe 平均状态 $\\tilde{\\boldsymbol{U}}$ 处构建一个线性化，从而得到 Roe 平均速度 $\\tilde{u}$ 和 Roe 平均焓 $\\tilde{H}$，以及一个 Roe 声速，定义为 $\\tilde{c}^2 = (\\gamma-1)\\left(\\tilde{H}-\\frac{1}{2}\\tilde{u}^2\\right)$。\n\n从欧拉方程和理想气体热力学关系出发，分析当 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 < 0$ 时，对 Roe 线性化双曲性的影响。根据 Roe 线性化生成的中间状态及其产生的特征结构，解释此条件的物理和数学意义。基于第一性原理和经过充分检验的数值分析事实，推荐保障措施，以确保在强稀疏波或跨音速膨胀存在的情况下，声速在物理上是允许的，并保持离散化的鲁棒性。\n\n在所述情况下，以下哪种保障措施在科学上是合理的，并且足以维持物理声速和鲁棒的格式？\n\nA. 对 $|u| \\approx \\tilde{c}$ 附近的 Roe 特征值应用 Harten–Hyman 熵修正；仅熵修正本身就能保证对于所有左、右状态，$\\tilde{c}^2 \\ge 0$。\n\nB. 当 Roe 平均声速的平方变为负值（即 $\\tilde{c}^2 < 0$）时，将 Roe 通量替换为保正性的 Harten–Lax–van Leer 族通量（例如 HLL 或 Harten–Lax–van Leer–Einfeldt (HLLE)），或使用一种在保正性传感器下回退到 HLL/HLLE 的混合通量；这能强制保证中间密度和压力为正，从而确保声速为实数。\n\nC. 使用带有总变差减小（Total Variation Diminishing）限制器的原始变量重构和保正性时间步进，以确保重构的界面状态具有正压力和正密度；仅此一项就能保证 Roe 平均的 $\\tilde{c}^2$ 是非负的。\n\nD. 人为地增加 $\\gamma$ 直到 $(\\gamma-1)\\left(\\tilde{H}-\\frac{1}{2}\\tilde{u}^2\\right)$ 变为正值；这可以在不损害守恒性或一致性的情况下维持物理声速。\n\nE. 修改 Roe 平均方法，使用能量一致或基于熵变量的平均（例如，对压力/温度使用对数平均），以保持热力学变量的凸性和正性，从而确保 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 \\ge 0$；这会产生一个具有实特征值的 Roe 线性化，同时保留其迎风特性。\n\n选择所有适用项。",
            "solution": "在进行求解之前，对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- **控制方程**：一维理想气体可压缩欧拉方程。\n- **状态变量（守恒形式）**：密度 $\\rho$、动量 $\\rho u$、总能量 $E$。\n- **比热比**：$\\gamma$。\n- **通量雅可比矩阵特征值**：对于一个物理上允许的状态，通量雅可比矩阵有三个实特征值：$u-c$、$u$ 和 $u+c$。\n- **流体速度**：$u$。\n- **热力学声速**：$c$，定义为 $c^2 = \\gamma p/\\rho = (\\gamma-1)\\left(H-\\frac{1}{2}u^2\\right)$。\n- **压力**：$p$。\n- **总比焓**：$H = (E+p)/\\rho$。\n- **Roe近似黎曼求解器**：根据左、右状态 $(\\rho_L, u_L, p_L)$ 和 $(\\rho_R, u_R, p_R)$，在一个 Roe 平均状态 $\\tilde{\\boldsymbol{U}}$ 处构建一个线性化。\n- **Roe平均量**：Roe平均速度 $\\tilde{u}$ 和 Roe平均焓 $\\tilde{H}$。\n- **Roe平均声速**：$\\tilde{c}$，定义为 $\\tilde{c}^2 = (\\gamma-1)\\left(\\tilde{H}-\\frac{1}{2}\\tilde{u}^2\\right)$。\n- **核心问题**：分析 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 < 0$ 的影响，并推荐保障措施以确保物理上的允许性和鲁棒性。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上和数学上是良定义的。\n- **科学依据**：该问题描述了一维欧拉方程和 Roe 近似黎曼求解器，这些是计算流体力学（CFD）中的经典主题。所讨论的特定失效模式，即 Roe 平均状态变为非物理状态（$\\tilde{c}^2 < 0$），是标准 Roe 求解器一个有充分文献记载的病态问题，尤其是在处理强稀疏波或近真空状态时。在开发鲁棒数值格式时，这是一个真实而重要的问题。\n- **良定性**：该问题是良定的。它要求对一种已知的数值不稳定性进行概念性分析，并评估为缓解该问题而设计的已有技术。\n- **客观性**：所用术语在CFD领域内是精确且标准的。问题陈述没有主观或模糊的语言。\n\n### 步骤3：结论和行动\n问题陈述是**有效的**。这是双曲守恒律数值分析中一个标准的、非平凡的问题。可以继续进行求解过程。\n\n### 问题分析\n欧拉方程的双曲性是其物理性质的基础，代表了信息通过波（声波和熵波/接触波）的传播。通量雅可比矩阵的特征值 $u-c$、$u$ 和 $u+c$ 代表了这些波的速度。为使系统是双曲的，这些特征值必须是实数，这要求声速 $c$ 是一个实数。这意味着 $c^2 = \\gamma p / \\rho \\ge 0$。由于对于任何物理状态，$\\gamma>1$ 且 $\\rho>0$，这等价于要求压力 $p \\ge 0$。\n\nRoe 近似黎曼求解器通过引入一个矩阵 $\\tilde{A}(\\boldsymbol{U}_L, \\boldsymbol{U}_R)$ 来线性化非线性欧拉方程，该矩阵具有两个性质：\n1. 它与真实的雅可比矩阵一致：$\\tilde{A}(\\boldsymbol{U}, \\boldsymbol{U}) = A(\\boldsymbol{U})$。\n2. 它精确地满足跳跃条件：$\\boldsymbol{F}(\\boldsymbol{U}_R) - \\boldsymbol{F}(\\boldsymbol{U}_L) = \\tilde{A}(\\boldsymbol{U}_L, \\boldsymbol{U}_R)(\\boldsymbol{U}_R - \\boldsymbol{U}_L)$。\n\n这个 Roe 矩阵 $\\tilde{A}$ 的特征值是 $\\tilde{u}-\\tilde{c}$、$\\tilde{u}$ 和 $\\tilde{u}+\\tilde{c}$，其中 $\\tilde{u}$ 是 Roe 平均速度，$\\tilde{c}$ 是 Roe 平均声速。为了使数值格式稳定且具有物理意义，这个线性化系统也必须是双曲的，这意味着其特征值必须是实数。这要求 $\\tilde{c}^2 \\ge 0$。\n\n问题集中于该条件失效的情况：$\\tilde{c}^2 < 0$。根据定义 $\\tilde{c}^2 = (\\gamma-1)\\left(\\tilde{H}-\\frac{1}{2}\\tilde{u}^2\\right)$，并注意到对于任何物理气体 $\\gamma-1 > 0$，此失效意味着 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 < 0$。\n对于单个物理状态，项 $H - \\frac{1}{2}u^2$ 等于比内能加上压力密度比：$H - \\frac{1}{2}u^2 = (e+p/\\rho+\\frac{1}{2}u^2) - \\frac{1}{2}u^2 = e + p/\\rho$。对于理想气体，$p = (\\gamma-1)\\rho e$，所以 $p/\\rho = (\\gamma-1)e$。因此，$e+p/\\rho = e+(\\gamma-1)e = \\gamma e$。\n因此，条件 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 < 0$ 表明 Roe 平均状态对应于一个具有等效负内能或负压力的非物理状态。这是因为标准的 Roe 平均公式虽然满足跳跃条件，但并不内在地保持热力学量的正性。\n\n当 $\\tilde{c}^2 < 0$ 时，$\\tilde{c}$ 变为一个虚数。特征值 $\\tilde{u} \\pm \\tilde{c}$ 成为一对共轭复数。具有复数特征值的系统是椭圆的，而不是双曲的。将依赖于实特征值符号来确定信息传播方向的迎风格式应用于一个椭圆系统，会导致该方法的灾难性崩溃和爆炸性的数值不稳定性。\n\n任务是找出防止这种失效的有效保障措施。\n\n### 逐项分析\n\n**A. 对 $|u| \\approx \\tilde{c}$ 附近的 Roe 特征值应用 Harten–Hyman 熵修正；仅熵修正本身就能保证对于所有左、右状态，$\\tilde{c}^2 \\ge 0$。**\n\nHarten-Hyman 熵修正（或简称 Harten 熵修正）旨在解决一个不同的问题。标准的 Roe 求解器可能在跨音速稀疏波中错误地允许非物理的“膨胀激波”出现，此时一个特征速度穿过零（例如，$\\tilde{u}-\\tilde{c} < 0$ 而 $\\tilde{u}+\\tilde{c} > 0$）。熵修正通过增加少量的数值耗散来“抹平”波，确保产生正确的、连续的膨胀扇。它的工作方式是当特征值 $\\lambda$ 的量级 $|\\lambda|$ 非常小时对其进行修改，例如，当 $|\\lambda| < \\delta$ 时，用一个函数如 $\\frac{\\lambda^2+\\delta^2}{2\\delta}$ 来替换 $|\\lambda|$，其中 $\\delta$ 是一个小参数。这个过程预先假定特征值本身是实数。它不会也不能阻止 $\\tilde{c}^2$ 变为负值。声称熵修正*本身*就能保证非负的 $\\tilde{c}^2$ 在事实上是错误的。\n\n**结论：错误。**\n\n**B. 当 Roe 平均声速的平方变为负值（即 $\\tilde{c}^2 < 0$）时，将 Roe 通量替换为保正性的 Harten–Lax–van Leer 族通量（例如 HLL 或 Harten–Lax–van Leer–Einfeldt (HLLE)），或使用一种在保正性传感器下回退到 HLL/HLLE 的混合通量；这能强制保证中间密度和压力为正，从而确保声速为实数。**\n\n这描述了一种被广泛使用且有效的“混合格式”策略。HLL类型的求解器以其鲁棒性而闻名。它们通常比 Roe 求解器更具耗散性，因为它们不能解析所有的特征波，但在合适的 CFL 条件下它们是保正性的。这意味着它们可以被设计成从正的输入数据中永远不会产生负密度或负压力。该策略是默认使用高分辨率的 Roe 求解器，但在每个单元界面检查是否存在病态问题。如果一个传感器（例如条件 $\\tilde{c}^2 < 0$）检测到 Roe 求解器即将失效，该格式会局部地为该界面切换到鲁棒的 HLL 或 HLLE 通量。这种“回退”机制结合了 Roe 在光滑区域的准确性和 HLL 在问题区域的鲁棒性。这是一个科学上合理、实用且充分的保障措施。\n\n**结论：正确。**\n\n**C. 使用带有总变差减小（Total Variation Diminishing）限制器的原始变量重构和保正性时间步进，以确保重构的界面状态具有正压力和正密度；仅此一项就能保证 Roe 平均的 $\\tilde{c}^2$ 是非负的。**\n\n该选项描述了高分辨率有限体积格式的一系列良好实践。重构原始变量（$\\rho, u, p$）通常比重构守恒变量能带来更好的性能。TVD 限制器对于无振荡激波捕捉至关重要。用于重构和时间步进的保正性方法对于确保单元平均状态保持物理性很重要。然而，问题的核心不在于输入到黎曼求解器的左、右状态，而在于 Roe 的*平均过程*本身。标准的 Roe 平均可以取两个完全有效、物理的状态 $(\\boldsymbol{U}_L, \\boldsymbol{U}_R)$，并产生一个非物理的中间状态 $\\tilde{\\boldsymbol{U}}$（即导致 $\\tilde{c}^2 < 0$）。因此，确保输入状态是物理的是一个必要但不充分的条件。这个保障措施本身并不能修复 Roe 平均内部的缺陷。\n\n**结论：错误。**\n\n**D. 人为地增加 $\\gamma$ 直到 $(\\gamma-1)\\left(\\tilde{H}-\\frac{1}{2}\\tilde{u}^2\\right)$ 变为正值；这可以在不损害守恒性或一致性的情况下维持物理声速。**\n\n从科学角度来看，这个提议根本上是不合理的。比热比 $\\gamma$ 是被模拟气体的物理性质（例如，空气的 $\\gamma \\approx 1.4$）。人为地修改一个物理常数构成了对控制方程本身的改变。虽然在某些情况下它可能在数学上“修正”$\\tilde{c}^2$ 的符号，但得到的数值解将不再是原始物理问题的解的近似。它损害了与预期偏微分方程的一致性。守恒性可能对于*修改后的*方程得以维持，但对于原始方程则没有意义。这是一种无原则的“取巧”，违反了模拟的基本目标，即模拟物理现实。\n\n**结论：错误。**\n\n**E. 修改 Roe 平均方法，使用能量一致或基于熵变量的平均（例如，对压力/温度使用对数平均），以保持热力学变量的凸性和正性，从而确保 $\\tilde{H}-\\frac{1}{2}\\tilde{u}^2 \\ge 0$；这会产生一个具有实特征值的 Roe 线性化，同时保留其迎风特性。**\n\n这种方法解决了问题的根本原因：标准代数 Roe 平均的不足之处。Roe 平均的失败与其未能尊重熵函数的凸结构有关。通过基于更基本的物理或数学原理设计一种新的平均过程，可以消除这个问题。已知基于熵变量的平均通过构造可以产生物理上允许的中间状态。同样，对于理想气体，可以通过对热力学变量选择特定的对数平均来构造一个类 Roe 矩阵，该矩阵被保证具有正性属性，从而确保对于任何两个物理输入状态都有 $\\tilde{c}^2 \\ge 0$。这种修改创造了一个既鲁棒（总是双曲的）又准确（完全迎风，解析所有波）的求解器，代表了一种比混合格式更基本、更优雅的解决方案。这是一个科学上合理且充分的保障措施。\n\n**结论：正确。**",
            "answer": "$$\\boxed{BE}$$"
        },
        {
            "introduction": "理论学习的最终目标是能够将其转化为有效的算法。本练习将引导你完成这一关键步骤，通过编写代码来实现一个带有选择性熵修正的Roe格式数值通量 ()。核心任务是精确地只对声波特征族施加数值耗散，同时确保与线性简并场（如接触间断）相关的数值耗散最小化，以保持其清晰度。这项实践将理论与真实世界的CFD代码开发联系起来，让你体验在精度和稳定性之间进行权衡所需的精妙工程决策。",
            "id": "3992404",
            "problem": "您的任务是使用Roe线性化和选择性熵修正策略，为一维气体动力学欧拉方程实现一个单点数值通量。目标是仅对声波族应用熵修正，并验证施加于接触波族的耗散保持最小。\n\n理想气体的一维欧拉方程守恒形式为\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0,\n$$\n其状态向量为\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix},\n$$\n通量向量为\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}.\n$$\n压力由理想气体关系式给出\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right),\n$$\n其中 $\\gamma$ 是比热比。请使用国际单位制（SI单位）：密度单位为 $\\mathrm{kg/m^3}$，速度单位为 $\\mathrm{m/s}$，压力单位为 $\\mathrm{Pa}$。\n\n从守恒律和理想气体关系式出发，推导在分隔左右常数状态的界面上的Roe线性化。定义Roe平均状态、线性化雅可比矩阵的特征值和右特征向量。Roe通量可以表示为一个中心通量加上一个基于特征的耗散项；请推导获得三个特征族的波强度所需的分解。\n\n实现一个仅修改声波族、保持接触波不变的熵修正。使用一个Harten型修正，其特征是阈值与Roe平均声速成正比，阈值为\n$$\n\\delta_i = \\kappa \\tilde{a},\n$$\n仅应用于声波族，其中 $\\tilde{a}$ 是Roe平均声速，$\\kappa$ 是一个小的正常数。如果 $|\\lambda_i| < \\delta_i$，则将 $|\\lambda_i|$ 替换为一个光滑函数以增加数值耗散，从而避免非物理解膨胀激波；否则，保持 $|\\lambda_i|$ 不变。程序必须设置 $\\gamma = 1.4$ 和 $\\kappa = 0.05$。\n\n为量化接触波的耗散，请分离出接触波族对Roe耗散项的贡献。如果耗散向量为\n$$\nD = \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i| \\alpha_i r_i,\n$$\n则将仅接触波耗散的大小定义为接触波族贡献的欧几里得范数，\n$$\nD_{\\text{contact}} = \\left\\|\\frac{1}{2}|\\lambda_2|\\alpha_2 r_2\\right\\|_2,\n$$\n其中 $r_2$ 是接触波特征向量，$\\alpha_2$ 是从特征分解中获得的接触波强度。实现三种策略以进行比较：无熵修正、仅对声波族应用熵修正、以及对所有族应用熵修正。\n\n验证要求：\n- 对于每个测试用例，计算三种策略下的 $D_{\\text{contact}}$，并生成一个布尔值，说明在小的数值容差内，仅声波策略是否使接触波耗散与无修正策略相等，并且在该容差内小于或等于所有族策略。\n- 对于每个测试用例，生成第二个布尔值，说明声波熵修正是否被实际激活（即，是否有任何声波特征值被熵修正所修改）。\n\n测试套件（SI单位）：\n- 测试用例 1：左状态 $(\\rho_L,u_L,p_L) = (1.0,\\,0.1,\\,100000.0)$，右状态 $(\\rho_R,u_R,p_R) = (2.0,\\,0.1,\\,100000.0)$。\n- 测试用例 2：左状态 $(\\rho_L,u_L,p_L) = (1.0,\\,360.0,\\,100000.0)$，右状态 $(\\rho_R,u_R,p_R) = (0.8,\\,390.0,\\,80000.0)$。\n- 测试用例 3：左状态 $(\\rho_L,u_L,p_L) = (1.0,\\,-0.05,\\,120000.0)$，右状态 $(\\rho_R,u_R,p_R) = (3.0,\\,0.05,\\,120000.0)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含两个布尔值的列表 $[b_1,b_2]$，其中 $b_1$ 是接触波最小耗散验证布尔值，$b_2$ 是声波修正激活布尔值。最终输出格式必须为\n$$\n[\\,[b_{1,1},b_{1,2}],\\,[b_{2,1},b_{2,2}],\\,[b_{3,1},b_{3,2}]\\,],\n$$\n其中布尔值以纯文本值形式写入，并且打印的行中没有额外的空白。",
            "solution": "理想气体的一维欧拉方程是一个双曲守恒律系统。基本变量是密度 $\\rho$、速度 $u$ 和总能量 $E$。压力 $p$ 通过理想气体方程与这些变量相关联\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right).\n$$\n守恒变量和通量为\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad F(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}.\n$$\n\n为了构造一个Roe线性化，需要定义一个平均状态，该状态允许在间断面上对通量雅可比矩阵进行线性化。设左右状态为 $U_L$ 和 $U_R$，其原始变量为 $(\\rho_L,u_L,p_L)$ 和 $(\\rho_R,u_R,p_R)$。比焓为\n$$\nH = \\frac{E + p}{\\rho},\n$$\n声速为\n$$\na = \\sqrt{\\frac{\\gamma p}{\\rho}}.\n$$\nRoe平均值通过密度加权平均获得：\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\n$$\n以及Roe平均声速\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)}.\n$$\n这些是通过在通量差的线性化中强制保持一致性而推导出来的，并且代表了计算流体力学中经过充分检验的事实。\n\n在Roe平均状态下，通量相对于守恒变量的雅可比矩阵具有三个实特征值\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a},\n$$\n对应于两个真正非线性的声波族和一个线性退化的接触（熵）波族。欧拉方程（以守恒变量表示）的相关右特征向量可以选择为\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix}.\n$$\n这些特征向量源于欧拉方程在Roe状态附近线性化时的特征结构，可以从通量雅可比矩阵推导得出。\n\n界面处的Roe通量可以表示为\n$$\nF_{\\text{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\,R\\,|\\Lambda|\\,R^{-1}\\,(U_R - U_L),\n$$\n其中 $R = [r_1\\, r_2\\, r_3]$ 是右特征向量矩阵， $|\\Lambda| = \\operatorname{diag}(|\\lambda_1|,|\\lambda_2|,|\\lambda_3|)$ 包含特征速度的绝对值，而 $R^{-1}(U_R - U_L)$ 产生波强度向量\n$$\n\\alpha = \\begin{bmatrix} \\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3 \\end{bmatrix}, \\quad \\text{使得} \\quad (U_R - U_L) = \\sum_{i=1}^3 \\alpha_i r_i.\n$$\n耗散项是\n$$\nD = \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i| \\alpha_i r_i,\n$$\n正是这个耗散的大小和分布决定了间断被捕捉的锐利程度。\n\n引入熵修正以防止非物理解膨胀激波，并确保在特征速度穿过零时对稀疏波进行正确处理。一种广泛使用的方法是Harten熵修正，它将小的特征速度替换为一个增加数值粘性的光滑函数。对于每个族 $i$，定义一个阈值\n$$\n\\delta_i = \\kappa \\tilde{a},\n$$\n其中 $\\kappa$ 是一个小的正常数，$\\tilde{a}$ 是Roe平均声速。修正后的绝对速度为\n$$\n|\\lambda_i|_{\\text{fix}} =\n\\begin{cases}\n\\frac{1}{2}\\left(\\frac{\\lambda_i^2}{\\delta_i} + \\delta_i\\right), & \\text{if } |\\lambda_i| < \\delta_i, \\\\\n|\\lambda_i|, & \\text{otherwise}.\n\\end{cases}\n$$\n为了实现所要求的切换策略，仅将此修正应用于声波族 $i = 1$ 和 $i = 3$，而保持接触波族 $i = 2$ 不变。作为比较，还考虑两个基准：无熵修正（对所有族使用 $|\\lambda_i|$）和所有族熵修正（对 $i = 1,2,3$ 应用修正）。\n\n为了验证在仅声波修正下接触波耗散保持最小，分离出接触波对耗散的贡献：\n$$\nD_{\\text{contact}} = \\left\\|\\frac{1}{2}|\\lambda_2|_{\\star}\\alpha_2 r_2\\right\\|_2,\n$$\n其中 $|\\lambda_2|_{\\star}$ 是所选策略对接触波的绝对速度。对于仅声波策略， $|\\lambda_2|_{\\star} = |\\lambda_2|$，而对于所有族修正，如果 $|\\lambda_2| < \\delta_2$， $|\\lambda_2|_{\\star}$ 可能会增加。验证要求对每个测试用例进行两次检查：\n- 最小性检查： $D_{\\text{contact}}^{\\text{acoustic-only}}$ 在一个小容差内等于 $D_{\\text{contact}}^{\\text{no-fix}}$，并且在相同容差内小于或等于 $D_{\\text{contact}}^{\\text{all-fix}}$。\n- 激活检查：至少有一个声波特征值被熵修正修改（即，与它的绝对值之差大于容差），表明选择性修正实际上已启动。\n\n设置 $\\gamma = 1.4$ 和 $\\kappa = 0.05$。使用国际单位制（SI单位）。\n\n```python\nimport numpy as np\n\ndef primitive_to_conservative(rho, u, p, gamma):\n    E = p / (gamma - 1.0) + 0.5 * rho * u * u\n    return np.array([rho, rho * u, E], dtype=float)\n\ndef roe_averages(rhoL, uL, pL, rhoR, uR, pR, gamma):\n    UL = primitive_to_conservative(rhoL, uL, pL, gamma)\n    UR = primitive_to_conservative(rhoR, uR, pR, gamma)\n    HL = (UL[2] + pL) / rhoL\n    HR = (UR[2] + pR) / rhoR\n    sqL = np.sqrt(rhoL)\n    sqR = np.sqrt(rhoR)\n    u_tilde = (sqL * uL + sqR * uR) / (sqL + sqR)\n    H_tilde = (sqL * HL + sqR * HR) / (sqL + sqR)\n    a_tilde = np.sqrt((gamma - 1.0) * (H_tilde - 0.5 * u_tilde * u_tilde))\n    return UL, UR, u_tilde, H_tilde, a_tilde\n\ndef eigenstructure(u_tilde, H_tilde, a_tilde):\n    lam = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde], dtype=float)\n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde], dtype=float)\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde * u_tilde], dtype=float)\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde], dtype=float)\n    R = np.column_stack((r1, r2, r3))\n    return lam, R\n\ndef harten_fix_abs_lambda(lam, delta):\n    absl = abs(lam)\n    if absl  delta:\n        return 0.5 * (lam * lam / delta + delta)\n    else:\n        return absl\n\ndef apply_entropy_fix(lam, a_tilde, mode, kappa):\n    delta = kappa * a_tilde\n    fixed = np.empty_like(lam)\n    for i in range(3):\n        if mode == 'none':\n            fixed[i] = abs(lam[i])\n        elif mode == 'acoustic':\n            if i in (0, 2):\n                fixed[i] = harten_fix_abs_lambda(lam[i], delta)\n            else:\n                fixed[i] = abs(lam[i])\n        elif mode == 'all':\n            fixed[i] = harten_fix_abs_lambda(lam[i], delta)\n    return fixed\n\ndef contact_dissipation_magnitude(UR, UL, lam_abs, R):\n    deltaU = UR - UL\n    alpha = np.linalg.solve(R, deltaU)\n    i_contact = 1\n    contact_vec = 0.5 * lam_abs[i_contact] * alpha[i_contact] * R[:, i_contact]\n    return float(np.linalg.norm(contact_vec, ord=2))\n\ndef verify_case(case, gamma=1.4, kappa=0.05, tol=1e-10):\n    rhoL, uL, pL, rhoR, uR, pR = case\n    UL, UR, u_tilde, H_tilde, a_tilde = roe_averages(rhoL, uL, pL, rhoR, uR, pR, gamma)\n    lam, R = eigenstructure(u_tilde, H_tilde, a_tilde)\n\n    lam_none = apply_entropy_fix(lam, a_tilde, mode='none', kappa=kappa)\n    D_contact_none = contact_dissipation_magnitude(UR, UL, lam_none, R)\n\n    lam_acoustic = apply_entropy_fix(lam, a_tilde, mode='acoustic', kappa=kappa)\n    D_contact_acoustic = contact_dissipation_magnitude(UR, UL, lam_acoustic, R)\n\n    lam_all = apply_entropy_fix(lam, a_tilde, mode='all', kappa=kappa)\n    D_contact_all = contact_dissipation_magnitude(UR, UL, lam_all, R)\n\n    def close(a, b):\n        return abs(a - b) = tol * (1.0 + max(abs(a), abs(b)))\n\n    minimal = close(D_contact_acoustic, D_contact_none) and (D_contact_acoustic = D_contact_all + tol * (1.0 + D_contact_all))\n\n    mod0 = abs(lam_acoustic[0] - lam_none[0]) > tol * (1.0 + abs(lam_none[0]))\n    mod2 = abs(lam_acoustic[2] - lam_none[2]) > tol * (1.0 + abs(lam_none[2]))\n    activation = mod0 or mod2\n    \n    return [minimal, activation]\n\ndef solve():\n    test_cases = [\n        (1.0, 0.1, 100000.0, 2.0, 0.1, 100000.0),\n        (1.0, 360.0, 100000.0, 0.8, 390.0, 80000.0),\n        (1.0, -0.05, 120000.0, 3.0, 0.05, 120000.0),\n    ]\n    results = []\n    for case in test_cases:\n        res = verify_case(case)\n        results.append(res)\n        \n    def pair_to_str(pair):\n        return f\"[{'True' if pair[0] else 'False'},{'True' if pair[1] else 'False'}]\"\n\n    out = \"[\" + \",\".join(pair_to_str(pair) for pair in results) + \"]\"\n    # This is the string that should be in the answer tag.\n    # print(out)\n```",
            "answer": "[[True,False],[True,True],[True,False]]"
        }
    ]
}