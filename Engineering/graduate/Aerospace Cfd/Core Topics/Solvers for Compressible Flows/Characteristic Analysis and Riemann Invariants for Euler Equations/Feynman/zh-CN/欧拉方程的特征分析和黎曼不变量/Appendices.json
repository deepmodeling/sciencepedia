{
    "hands_on_practices": [
        {
            "introduction": "掌握欧拉方程的特征分析是理解可压缩流动的关键。本练习  将引导你从一维等熵欧拉方程出发，亲手推导黎曼不变量。通过这一过程，你不仅能加深对特征线和相容性关系的理解，还能通过一个直接的计算任务，实践如何利用这些不变量来预测流动状态的变化，从而将抽象的数学理论与具体的物理问题联系起来。",
            "id": "3947229",
            "problem": "在计算流体力学 (CFD) 中，考虑理想气体的一维、非定常、无粘可压缩流动。该流动演化由可压缩欧拉方程控制，该方程已针对一维空间进行了特化，并假设无体力，且在无激波区域内呈等熵行为。从以下基本方程组出发：\n\n- 一维连续性方程：$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$。\n- 一维动量方程：$\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$。\n- 理想气体等熵关系：$p = K \\rho^{\\gamma}$，其中 $K$ 沿一条等熵线为常数，$\\gamma$ 是比热比。\n- 当地声速的定义：$a = \\sqrt{\\gamma \\frac{p}{\\rho}}$。\n\n基于此，对欧拉方程组的拟线性形式进行特征线分析，以确定由 $dx/dt = u \\pm a$ 定义的特征族，并推导适用于理想气体等熵流动的相应相容关系和黎曼不变量。\n\n实现任务：\n- 仅使用上述基本方程，推导沿特征族的相容关系及相关的不变量。然后，设计一个算法，给定流场中某点的初始状态 $(\\rho_0, u_0, p_0)$ 和同一等熵线上的目标压力 $p_1$，计算在与所选特征族（$C^+$ 对应 $dx/dt = u + a$，或 $C^-$ 对应 $dx/dt = u - a$）保持一致的状态 $(\\rho_1, u_1, p_1)$ 下的最终速度 $u_1$。假设过程是等熵的；即，$K = p_0 / \\rho_0^{\\gamma}$ 保持不变，因此 $\\rho_1 = \\left( \\frac{p_1}{K} \\right)^{1/\\gamma}$ 且 $a_1 = \\sqrt{\\gamma \\frac{p_1}{\\rho_1}}$。\n\n- 您的程序必须针对每个测试用例，使用推导出的相容关系和黎曼不变量计算最终速度 $u_1$（单位为米/秒），并将结果四舍五入到六位小数。\n\n- 最终输出格式必须是单行，包含一个用方括号括起来的、由逗号分隔的计算速度列表，例如：$\"[u_1^{(1)},u_1^{(2)},\\dots]\"$。\n\n测试套件：\n使用以下六个测试用例，每个用例由 $(\\gamma,\\rho_0,u_0,p_0,$ family$,p_1)$ 指定，其中 family 参数是 $C^+$ 或 $C^-$。\n\n1. 沿 $C^+$ 的正常路径稀疏波：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$。\n2. 沿 $C^+$ 的缓和压缩：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$。\n3. 沿 $C^-$ 的稀疏波：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$。\n4. 沿 $C^-$ 的近声速初始状态：$(\\gamma = 1.4, \\rho_0 = 1.200 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$。请注意，$u_0$ 必须根据 $a_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}}$ 计算并设为等于 $a_0$。\n5. 沿 $C^+$ 的超声速初始状态：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$。\n6. 沿 $C^+$ 的极小压力变化的边界情况：$(\\gamma = 1.4, \\rho_0 = 1.000 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$。\n\n要求输出：\n- 对每个测试用例，计算 $u_1$（单位为 $\\text{m/s}$）并四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的、由逗号分隔的结果列表，例如：$\"[u_1^{(1)},u_1^{(2)},u_1^{(3)},u_1^{(4)},u_1^{(5)},u_1^{(6)}]\"$。",
            "solution": "用户希望基于一维欧拉方程的特征线分析来解决一个问题。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n- **控制方程**：\n    1.  连续性方程：$\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u \\right) = 0$\n    2.  动量方程：$\\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\rho u^2 + p \\right) = 0$\n- **理想气体等熵状态关系**：\n    1.  压力-密度关系：$p = K \\rho^{\\gamma}$，其中 $K$ 是一个常数。\n    2.  声速定义：$a = \\sqrt{\\gamma \\frac{p}{\\rho}}$\n- **假设**：一维、非定常、无粘、可压缩的理想气体流动；无体力；等熵流动。\n- **问题目标**：\n    1.  进行特征线分析，推导特征族 $dx/dt = u \\pm a$ 的相容关系和黎曼不变量。\n    2.  实现一个算法，在给定初始状态 $(\\rho_0, u_0, p_0)$ 和目标压力 $p_1$ 的情况下，计算在状态 $(\\rho_1, u_1, p_1)$ 下的最终速度 $u_1$，并假设状态变化沿着单个特征线（$C^+$ 或 $C^-$）发生。\n- **测试用例**：\n    1.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 90000.0 \\text{ Pa})$\n    2.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 105000.0 \\text{ Pa})$\n    3.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 120.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^-, p_1 = 95000.0 \\text{ Pa})$\n    4.  $(\\gamma = 1.4, \\rho_0 = 1.2 \\text{ kg/m}^3, u_0 = \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 101325.0 \\text{ Pa}, C^-, p_1 = 100000.0 \\text{ Pa})$\n    5.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 2 \\sqrt{\\gamma \\frac{p_0}{\\rho_0}} \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 95000.0 \\text{ Pa})$\n    6.  $(\\gamma = 1.4, \\rho_0 = 1.0 \\text{ kg/m}^3, u_0 = 100.0 \\text{ m/s}, p_0 = 100000.0 \\text{ Pa}, C^+, p_1 = 99999.0 \\text{ Pa})$\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学基础（关键）**：该问题在根本上是科学合理的。它基于欧拉方程（无粘流体动力学的基石）和特征线法（一种用于双曲型偏微分方程 (PDE) 的标准数学技术）。\n- **适定性**：该问题是适定的。从欧拉方程推导黎曼不变量是气体动力学中的一个标准程序。实现任务定义清晰，每个测试用例都有足够的输入数据以得出唯一解。\n- **客观性（关键）**：该问题使用精确、客观和定量的语言陈述，没有任何主观性或模糊性。\n- 该问题是完全**自洽和一致的**。提供了所有必要的物理定律和数学定义。它没有表现出验证标准中列出的任何缺陷（例如，科学上不合理、不完整、模糊）。\n\n**步骤 3：结论与行动**\n该问题是**有效的**。继续进行求解。\n\n### 相容关系与黎曼不变量的推导\n\n目标是在等熵流假设下，为一维欧拉方程推导相容关系和黎曼不变量。我们从给定的守恒形式方程开始，将其转换为适合特征线分析的非守恒、原始变量形式。\n\n原始变量是密度 $\\rho$ 和速度 $u$。压力 $p$ 通过等熵定律与 $\\rho$ 相关联。\n\n**1. 转换为原始变量**\n\n连续性方程为：\n$$ \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 $$\n使用乘法法则展开空间导数，得到：\n$$ \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0 \\quad (1) $$\n\n动量方程为：\n$$ \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial (\\rho u^2 + p)}{\\partial x} = 0 $$\n展开导数：\n$$ u \\frac{\\partial \\rho}{\\partial t} + \\rho \\frac{\\partial u}{\\partial t} + u^2 \\frac{\\partial \\rho}{\\partial x} + 2\\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n我们可以对项进行分组：\n$$ u \\left( \\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} \\right) + \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n从方程 $(1)$，我们知道 $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} = -\\rho \\frac{\\partial u}{\\partial x}$。将此代入重新排列的动量方程：\n$$ u \\left( -\\rho \\frac{\\partial u}{\\partial x} \\right) + \\rho \\left( \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} \\right) + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n$$ -\\rho u \\frac{\\partial u}{\\partial x} + \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n项 $-\\rho u \\frac{\\partial u}{\\partial x}$ 和 $+\\rho u \\frac{\\partial u}{\\partial x}$ 相互抵消，剩下：\n$$ \\rho \\frac{\\partial u}{\\partial t} + \\rho u \\frac{\\partial u}{\\partial x} + \\frac{\\partial p}{\\partial x} = 0 $$\n两边除以 $\\rho$（因为 $\\rho > 0$）：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} = 0 \\quad (2) $$\n\n**2. 消去压力**\n\n对于等熵过程，$p = K\\rho^\\gamma$，所以压力梯度可以与密度梯度关联起来：\n$$ \\frac{\\partial p}{\\partial x} = \\frac{dp}{d\\rho} \\frac{\\partial \\rho}{\\partial x} $$\n导数 $\\frac{dp}{d\\rho}$ 为：\n$$ \\frac{dp}{d\\rho} = \\frac{d}{d\\rho}(K\\rho^\\gamma) = \\gamma K \\rho^{\\gamma-1} = \\gamma \\frac{K\\rho^\\gamma}{\\rho} = \\gamma \\frac{p}{\\rho} $$\n根据定义，声速的平方是 $a^2 = \\gamma \\frac{p}{\\rho}$。因此，$\\frac{dp}{d\\rho} = a^2$。\n将 $\\frac{\\partial p}{\\partial x} = a^2 \\frac{\\partial \\rho}{\\partial x}$ 代入动量方程 $(2')$：\n$$ \\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} = 0 \\quad (2') $$\n\n现在我们得到一个关于变量 $\\rho$ 和 $u$ 的两个偏微分方程组：\n1.  $\\frac{\\partial \\rho}{\\partial t} + u \\frac{\\partial \\rho}{\\partial x} + \\rho \\frac{\\partial u}{\\partial x} = 0$\n2.  $\\frac{\\partial u}{\\partial t} + \\frac{a^2}{\\rho} \\frac{\\partial \\rho}{\\partial x} + u \\frac{\\partial u}{\\partial x} = 0$\n\n**3. 特征线分析**\n\n我们将方程组写成拟线性矩阵形式 $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$，其中状态向量为 $\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ u \\end{pmatrix}$：\n$$ \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} $$\n雅可比矩阵为 $\\mathbf{A} = \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix}$。特征速度是 $\\mathbf{A}$ 的特征值 $\\lambda$，通过求解 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$ 找到：\n$$ \\det \\begin{pmatrix} u-\\lambda  \\rho \\\\ a^2/\\rho  u-\\lambda \\end{pmatrix} = (u-\\lambda)^2 - \\rho(a^2/\\rho) = (u-\\lambda)^2 - a^2 = 0 $$\n这得出 $\\lambda - u = \\pm a$，因此特征值为 $\\lambda_{\\pm} = u \\pm a$。这些是扰动的传播速度，它们通过 $\\frac{dx}{dt} = u \\pm a$ 定义了 $(x,t)$ 平面上的特征曲线。\n\n为了找到相容关系，我们确定 $\\mathbf{A}$ 的左特征向量 $\\mathbf{l} = [l_1, l_2]$，它满足 $\\mathbf{l} \\mathbf{A} = \\lambda \\mathbf{l}$：\n$$ [l_1, l_2] \\begin{pmatrix} u  \\rho \\\\ a^2/\\rho  u \\end{pmatrix} = \\lambda [l_1, l_2] $$\n这给出了方程组：\n1.  $l_1 u + l_2 (a^2/\\rho) = \\lambda l_1 \\implies l_2 (a^2/\\rho) = (\\lambda - u) l_1$\n2.  $l_1 \\rho + l_2 u = \\lambda l_2 \\implies l_1 \\rho = (\\lambda - u) l_2$\n\n代入 $\\lambda - u = \\pm a$，我们得到 $l_2 (a^2/\\rho) = (\\pm a) l_1$，化简为 $l_2 = \\pm \\frac{\\rho}{a} l_1$。\n因此，对应于 $\\lambda_{\\pm} = u \\pm a$ 的左特征向量与 $\\mathbf{l}^{\\pm} = [1, \\pm a/\\rho]$ 成比例。（我们选择缩放因子 $l_2 = 1$，这给出 $l_1 = \\pm a/\\rho$）。\n\n将原始矩阵系统 $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\mathbf{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{0}$ 从左侧乘以一个特征向量 $\\mathbf{l}^{\\pm}$ 得到：\n$$ \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + (\\mathbf{l}^{\\pm} \\mathbf{A}) \\frac{\\partial \\mathbf{U}}{\\partial x} = \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial t} + \\lambda_{\\pm} \\mathbf{l}^{\\pm} \\frac{\\partial \\mathbf{U}}{\\partial x} = 0 $$\n将其写出，我们得到：\n$$ [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial t} \\\\ \\frac{\\partial u}{\\partial t} \\end{pmatrix} + (u \\pm a) [\\pm a/\\rho, 1] \\begin{pmatrix} \\frac{\\partial \\rho}{\\partial x} \\\\ \\frac{\\partial u}{\\partial x} \\end{pmatrix} = 0 $$\n$$ \\pm \\frac{a}{\\rho} \\left( \\frac{\\partial \\rho}{\\partial t} + (u \\pm a) \\frac{\\partial \\rho}{\\partial x} \\right) + \\left( \\frac{\\partial u}{\\partial t} + (u \\pm a) \\frac{\\partial u}{\\partial x} \\right) = 0 $$\n这等同于沿着特征曲线 $\\frac{dx}{dt} = u \\pm a$ 的全导数：\n$$ \\pm \\frac{a}{\\rho} \\frac{d\\rho}{dt} + \\frac{du}{dt} = 0 $$\n这些就是相容关系。\n\n**4. 黎曼不变量**\n\n为了找到不变量，我们必须对相容关系进行积分。项 $\\frac{a}{\\rho} d\\rho$ 需要表示为单个变量的微分。对于等熵流，$p = K\\rho^\\gamma$，且 $a^2 = \\gamma p/\\rho$，所以 $a = \\sqrt{\\gamma K \\rho^{\\gamma-1}} = \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2}$。\n积分为：\n$$ \\int \\frac{a}{\\rho} d\\rho = \\int \\sqrt{\\gamma K} \\rho^{(\\gamma-3)/2} d\\rho = \\sqrt{\\gamma K} \\frac{\\rho^{(\\gamma-1)/2}}{(\\gamma-1)/2} = \\frac{2}{\\gamma-1} \\left( \\sqrt{\\gamma K} \\rho^{(\\gamma-1)/2} \\right) = \\frac{2a}{\\gamma-1} $$\n所以，$d\\left(\\frac{2a}{\\gamma-1}\\right) = \\frac{a}{\\rho} d\\rho$。\n将此代回相容关系中：\n- 对于 $C^+$ 族（$\\frac{dx}{dt} = u+a$）：\n$$ \\frac{du}{dt} + \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u + \\frac{2a}{\\gamma-1}\\right) = 0 $$\n这意味着量 $J^+ = u + \\frac{2a}{\\gamma-1}$ 沿着 $C^+$ 特征线是常数。\n\n- 对于 $C^-$ 族（$\\frac{dx}{dt} = u-a$）：\n$$ \\frac{du}{dt} - \\frac{d}{dt}\\left(\\frac{2a}{\\gamma-1}\\right) = 0 \\implies \\frac{d}{dt}\\left(u - \\frac{2a}{\\gamma-1}\\right) = 0 $$\n这意味着量 $J^- = u - \\frac{2a}{\\gamma-1}$ 沿着 $C^-$ 特征线是常数。\n\n量 $J^+$ 和 $J^-$ 就是一维等熵流的黎曼不变量。\n\n### 算法设计\n\n任务是给定一个初始状态 $(\\rho_0, u_0, p_0)$ 和一个最终压力 $p_1$，计算最终速度 $u_1$，假设变化是沿着一个特定的特征族发生的。\n设初始状态为 $(\\rho_0, u_0, p_0)$，最终状态为 $(\\rho_1, u_1, p_1)$。\n\n初始声速为 $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$。为了找到最终声速 $a_1$，我们使用等熵关系：\n$$ a = \\sqrt{\\gamma p/\\rho} \\quad \\text{和} \\quad p/\\rho^\\gamma = \\text{const} \\implies p = C\\rho^\\gamma $$\n$$ a^2 = \\gamma p/\\rho = \\gamma (C\\rho^\\gamma)/\\rho = \\gamma C \\rho^{\\gamma-1} $$\n同时，$p^{1/\\gamma} = C^{1/\\gamma} \\rho \\implies \\rho = C^{-1/\\gamma} p^{1/\\gamma}$。\n将 $\\rho$ 代入 $a^2$ 的表达式：\n$$ a^2 = \\gamma C (C^{-1/\\gamma} p^{1/\\gamma})^{\\gamma-1} = \\gamma C^{1- (\\gamma-1)/\\gamma} p^{(\\gamma-1)/\\gamma} = \\gamma C^{1/\\gamma} p^{(\\gamma-1)/\\gamma} $$\n这表明 $a \\propto p^{(\\gamma-1)/(2\\gamma)}$。因此，声速之比为：\n$$ \\frac{a_1}{a_0} = \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} \\implies a_1 = a_0 \\left(\\frac{p_1}{p_0}\\right)^{\\frac{\\gamma-1}{2\\gamma}} $$\n这个关系使我们能够从已知量计算 $a_1$，而无需计算 $K$ 或 $\\rho_1$。\n\n- 如果过程是沿着 $C^+$ 特征线，不变量 $J^+$ 守恒：\n$$ u_0 + \\frac{2a_0}{\\gamma-1} = u_1 + \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1) $$\n\n- 如果过程是沿着 $C^-$ 特征线，不变量 $J^-$ 守恒：\n$$ u_0 - \\frac{2a_0}{\\gamma-1} = u_1 - \\frac{2a_1}{\\gamma-1} \\implies u_1 = u_0 - \\frac{2}{\\gamma-1}(a_0 - a_1) = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0) $$\n\n算法如下：\n1. 对于给定的测试用例 $(\\gamma, \\rho_0, u_0, p_0, \\text{family}, p_1)$：\n2. 计算初始声速 $a_0 = \\sqrt{\\gamma p_0 / \\rho_0}$。处理 $u_0$ 由 $a_0$ 定义的情况。\n3. 计算最终声速 $a_1 = a_0 (p_1/p_0)^{(\\gamma-1)/(2\\gamma)}$。\n4. 如果 `family` 是 $C^+$，计算 $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_0 - a_1)$。\n5. 如果 `family` 是 $C^-$，计算 $u_1 = u_0 + \\frac{2}{\\gamma-1}(a_1 - a_0)$。\n6. 将结果四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes final velocities for 1D isentropic flow problems using Riemann invariants.\n    \"\"\"\n    # The test suite as specified in the problem statement.\n    # Format: (gamma, rho_0, u_0_spec, p_0, family, p_1)\n    # u_0_spec can be a number or a string ('a_0' or '2*a_0')\n    test_cases = [\n        # 1. Happy path rarefaction along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 90000.0),\n        # 2. Gentle compression along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 105000.0),\n        # 3. Rarefaction along C-\n        (1.4, 1.0, 120.0, 100000.0, 'C-', 95000.0),\n        # 4. Near-sonic initial state along C-\n        (1.4, 1.2, 'a_0', 101325.0, 'C-', 100000.0),\n        # 5. Supersonic initial state along C+\n        (1.4, 1.0, '2*a_0', 100000.0, 'C+', 95000.0),\n        # 6. Edge case with extremely small pressure change along C+\n        (1.4, 1.0, 100.0, 100000.0, 'C+', 99999.0),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        gamma, rho_0, u_0_spec, p_0, family, p_1 = case\n        \n        # Step 1: Calculate initial speed of sound a_0\n        a_0 = np.sqrt(gamma * p_0 / rho_0)\n        \n        # Step 2: Determine initial velocity u_0\n        if isinstance(u_0_spec, str):\n            if u_0_spec == 'a_0':\n                u_0 = a_0\n            elif u_0_spec == '2*a_0':\n                u_0 = 2 * a_0\n        else:\n            u_0 = u_0_spec\n        \n        # Step 3: Calculate final speed of sound a_1\n        # Using the relation a1/a0 = (p1/p0)^((gamma-1)/(2*gamma))\n        exponent = (gamma - 1.0) / (2.0 * gamma)\n        a_1 = a_0 * np.power(p_1 / p_0, exponent)\n        \n        # Pre-compute the term 2/(gamma-1)\n        two_over_gamma_minus_1 = 2.0 / (gamma - 1.0)\n        \n        # Step 4: Calculate final velocity u_1 based on the characteristic family\n        u_1 = 0.0\n        if family == 'C+':\n            # Invariant: u + 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a0 - a1)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_0 - a_1)\n        elif family == 'C-':\n            # Invariant: u - 2a/(gamma-1) = const\n            # u1 = u0 + 2/(gamma-1) * (a1 - a0)\n            u_1 = u_0 + two_over_gamma_minus_1 * (a_1 - a_0)\n        \n        # Step 5: Round the result to six decimal places and store\n        results.append(f\"{u_1:.6f}\") # Use format specifier for rounding half up\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了黎曼不变量的基本概念后，我们可以将其应用于求解经典的黎曼问题。这个练习  设置了一个强稀疏波相互作用的场景，挑战你分析并确定流动中出现真空状态的临界条件。更进一步，此练习还将引导你思考，这些从精确解中获得的洞察，如何为设计健壮的近似黎曼求解器（如HLLE格式）提供理论依据，从而确保数值模拟的物理真实性。",
            "id": "3441122",
            "problem": "考虑一个多方理想气体的一维可压缩欧拉方程组，其绝热指数为 $\\gamma$，\n$$\n\\partial_{t}\n\\begin{pmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{pmatrix}\n+\n\\partial_{x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu(E + p)\n\\end{pmatrix}\n= \\mathbf{0},\n$$\n其中 $\\rho$ 是质量密度，$u$ 是速度，$p$ 是压力，$E$ 是总能量，定义为 $E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^{2}$。状态方程为 $p = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^{2}\\right)$，声速为 $a = \\sqrt{\\gamma p / \\rho}$。考虑具有以下初值的黎曼问题：\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}), & x < 0, \\\\\n(\\rho_{R}, u_{R}, p_{R}), & x > 0,\n\\end{cases}\n$$\n对于一个绝热指数为 $\\gamma = \\frac{7}{5}$ 的气体。令左右状态无量纲化为\n$$\n\\rho_{L} = 1, \\quad u_{L} = 0, \\quad p_{L} = \\frac{1}{\\gamma}, \\qquad\n\\rho_{R} = 1, \\quad p_{R} = \\frac{4}{\\gamma},\n$$\n且 $u_{R}$ 待定。仅使用欧拉系统的守恒律结构和特征分析（包括从黎曼不变量导出的稀疏波性质），执行以下操作：\n\n1. 从第一性原理出发，推导速度跳跃 $u_{R} - u_{L}$ 需满足何种条件时，精确解会包含真空状态（即，中间压力趋于 $0$ 且密度趋于 $0$）。\n2. 在这些无量纲变量下，计算保证给定左右状态的精确解中形成真空的 $u_{R} - u_{L}$ 的精确最小正值。用无量纲单位表示你最终的速度阈值。\n3. 在精确解会形成真空的情况下，分析 Harten–Lax–van Leer 类型（HLLE）的保正近似黎曼求解器所需的波速估计条件，以在 Courant–Friedrichs–Lewy (CFL) 数小于等于 $1$ 的单个显式欧拉时间步长内保持 $p \\ge 0$ 和 $\\rho \\ge 0$。你的分析必须基于从守恒律结构和特征速度推导出的不变区域和凸组合论证，而不得调用任何预先包装好的求解器特定公式。\n\n你的最终数值答案应为第2部分中得到的 $u_{R} - u_{L}$ 的精确阈值。无需四舍五入。",
            "solution": "用户提供了一个关于一维可压缩欧拉方程组的三部分问题。在验证问题陈述后，我将依次解决每个部分。\n\n该问题在科学上是适定的，基于双曲守恒律的既定理论，并提供了一套完整且一致的数据和定义。所有给定参数在物理上和数学上都是合理的。因此，问题是有效的，我将着手提供一个完整的解答。\n\n该方程组由 $\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}$ 给出，其中状态向量为 $\\mathbf{U} = (\\rho, \\rho u, E)^T$，通量向量为 $\\mathbf{F}(\\mathbf{U}) = (\\rho u, \\rho u^2+p, u(E+p))^T$。变量为密度 $\\rho$、速度 $u$、压力 $p$ 和单位体积的总能量 $E$。多方理想气体的状态方程是 $p = (\\gamma-1)(E - \\frac{1}{2}\\rho u^2)$。声速是 $a = \\sqrt{\\gamma p / \\rho}$。\n\n黎曼问题由以下初值定义：\n$$\n(\\rho, u, p)(x,0) = \n\\begin{cases}\n(\\rho_{L}, u_{L}, p_{L}), & x < 0, \\\\\n(\\rho_{R}, u_{R}, p_{R}), & x > 0,\n\\end{cases}\n$$\n提供的具体值为 $\\gamma = \\frac{7}{5}$，以及无量纲化的状态：\n左状态：$\\rho_{L} = 1$，$u_{L} = 0$，$p_{L} = \\frac{1}{\\gamma} = \\frac{5}{7}$。\n右状态：$\\rho_{R} = 1$，$u_{R}$ 是可变的，$p_{R} = \\frac{4}{\\gamma} = \\frac{20}{7}$。\n\n**第1部分：真空形成条件的推导**\n\n黎曼问题的解是自相似的，依赖于变量 $\\xi = x/t$。解由常数状态以及分隔这些状态的波（激波或稀疏波）和接触间断组成。在左行波和右行波之间的中间状态以恒定的速度 $u_*$ 和压力 $p_*$ 为特征。\n\n当中间压力和密度趋于零，即 $p_* \\to 0$ 且 $\\rho_* \\to 0$ 时，出现真空状态。当初始状态以足够大的速度相互分离，导致形成两个稀疏波将流体拉开时，会发生这种现象。\n\n我们使用黎曼不变量来分析穿越稀疏波的速度变化。对于欧拉方程组，与特征场 $\\lambda_1 = u-a$、$\\lambda_2 = u$ 和 $\\lambda_3 = u+a$ 相关的黎曼不变量是：\n$R_1 = u - \\frac{2a}{\\gamma-1}$ 在2-波和3-波上是不变的。\n$R_2 = s = p/\\rho^\\gamma$ （熵）在1-波和3-波上是不变的（对于像稀疏波这样的光滑解）。\n$R_3 = u + \\frac{2a}{\\gamma-1}$ 在1-波和2-波上是不变的。\n\n一个1-稀疏波将左状态 $(\\rho_L, u_L, p_L)$ 连接到中间状态 $(\\rho_{*,L}, u_*, p_*)$。穿过此波时，$R_3$ 是常数：\n$$u_L + \\frac{2 a_L}{\\gamma-1} = u_* + \\frac{2 a_{*,L}}{\\gamma-1}$$\n其中 $a_L$ 是左状态的声速，$a_{*,L}$ 是左中间状态的声速。熵也是恒定的，$p_L/\\rho_L^\\gamma = p_*/\\rho_{*,L}^\\gamma$。声速 $a = \\sqrt{\\gamma p/\\rho}$ 与压力和密度的关系为 $a^2 = \\gamma p^{1-1/\\gamma} (p/\\rho^\\gamma)^{1/\\gamma}$。由于在稀疏波中 $p/\\rho^\\gamma$ 是常数，因此 $a \\propto p^{(\\gamma-1)/(2\\gamma)}$。于是，$a_{*,L} = a_L (p_*/p_L)^{(\\gamma-1)/(2\\gamma)}$。\n将此代入 $R_3$ 不变量方程，我们可以将 $u_*$ 表示为 $p_*$ 的函数：\n$$u_* = u_L + \\frac{2a_L}{\\gamma-1} - \\frac{2a_L}{\\gamma-1} \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_L + \\frac{2a_L}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_L}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\n一个3-稀疏波将右状态 $(\\rho_R, u_R, p_R)$ 连接到中间状态 $(\\rho_{*,R}, u_*, p_*)$。穿过此波时，$R_1$ 是常数：\n$$u_R - \\frac{2 a_R}{\\gamma-1} = u_* - \\frac{2 a_{*,R}}{\\gamma-1}$$\n类似地，$a_{*,R} = a_R (p_*/p_R)^{(\\gamma-1)/(2\\gamma)}$。解出 $u_*$：\n$$u_* = u_R - \\frac{2a_R}{\\gamma-1} + \\frac{2a_R}{\\gamma-1} \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}} = u_R - \\frac{2a_R}{\\gamma-1} \\left[1 - \\left(\\frac{p_*}{p_R}\\right)^{\\frac{\\gamma-1}{2\\gamma}}\\right]$$\n\n如果两条关于 $u_*(p_*)$ 的稀疏曲线相交，则存在一个中间压力为 $p_* > 0$ 的解。当 $p_*>0$ 的解不复存在时，在临界点上会发生真空形成。当初始状态被拉开得太快，以至于中间的压力降至零时，就会发生这种情况。我们通过在速度表达式中取极限 $p_* \\to 0$ 来找到这个阈值。\n\n从1-稀疏波来看，流体膨胀进入真空（$p_*\\to 0$）时所能达到的最大速度是：\n$$u_{*,L} = \\lim_{p_*\\to 0} u_*(p_*) = u_L + \\frac{2a_L}{\\gamma-1}$$\n这表示从左侧展开的稀疏扇的尾部速度。\n\n从3-稀疏波来看，流体膨胀进入真空时的最小速度是：\n$$u_{*,R} = \\lim_{p_*\\to 0} u_*(p_*) = u_R - \\frac{2a_R}{\\gamma-1}$$\n这是从右侧展开的稀疏扇的尾部速度。\n\n如果真空区域右边缘的流体比左边缘的流体移动得快，即 $u_{*,R} > u_{*,L}$，则两个状态之间会形成一个真空区域。真空形成的阈值是等式 $u_{*,R} = u_{*,L}$。\n$$u_R - \\frac{2a_R}{\\gamma-1} = u_L + \\frac{2a_L}{\\gamma-1}$$\n重新整理得到真空形成对速度跳跃 $u_R - u_L$ 的条件：\n$$u_R - u_L \\ge \\frac{2}{\\gamma-1}(a_L + a_R)$$\n最小速度跳跃发生在等式成立时。\n\n**第2部分：最小正速度跳跃的计算**\n\n我们使用第1部分推导出的阈值条件，并代入给定的无量纲值。\n绝热指数是 $\\gamma = \\frac{7}{5}$，所以 $\\gamma - 1 = \\frac{2}{5}$。\n左侧的初始速度是 $u_L=0$。\n我们首先计算左右状态的声速。\n对于左状态：$\\rho_L = 1$，$p_L = \\frac{1}{\\gamma} = \\frac{5}{7}$。\n$$a_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{(7/5) \\cdot (5/7)}{1}} = \\sqrt{1} = 1$$\n对于右状态：$\\rho_R = 1$，$p_R = \\frac{4}{\\gamma} = \\frac{20}{7}$。\n$$a_R = \\sqrt{\\frac{\\gamma p_R}{\\rho_R}} = \\sqrt{\\frac{(7/5) \\cdot (20/7)}{1}} = \\sqrt{4} = 2$$\n保证形成真空的最小速度跳跃 $u_R - u_L$ 是：\n$$(u_R - u_L)_{crit} = \\frac{2}{\\gamma-1}(a_L + a_R) = \\frac{2}{2/5}(1 + 2) = 5 \\times 3 = 15$$\n由于 $u_L=0$，所以 $u_R$ 的最小正值是 $15$。所求的量是速度跳跃 $u_R - u_L$。\n\n**第3部分：HLLE求解器的保正条件分析**\n\nHarten–Lax–van Leer (HLLE) 近似黎曼求解器用一个单一的中间状态 $\\mathbf{U}^{HLL}$ 来取代状态 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 之间精确解的详细波结构，该中间状态由两个速度为 $s_L$ 和 $s_R$ 的波分隔。单元平均值 $\\mathbf{U}_j^n$ 的有限体积法更新由下式给出：\n$$\\mathbf{U}_j^{n+1} = \\mathbf{U}_j^n - \\frac{\\Delta t}{\\Delta x}(\\mathbf{F}_{j+1/2} - \\mathbf{F}_{j-1/2})$$\n其中 $\\mathbf{F}_{j+1/2}$ 是在界面 $x_{j+1/2}$ 处的数值通量。\n\n该格式的正性（保持 $\\rho \\ge 0$ 和 $p \\ge 0$）依赖于确保更新后的状态 $\\mathbf{U}_j^{n+1}$ 保持在物理状态的凸集 $G = \\{\\mathbf{U} | \\rho > 0, p > 0\\}$ 之内。Godunov 型格式（HLLE 是其中一个例子）通过在时间 $\\Delta t$ 对近似解在单元 $[x_j-\\Delta x/2, x_j+\\Delta x/2]$ 上进行平均来构造新状态 $\\mathbf{U}_j^{n+1}$。在 Courant-Friedrichs-Lewy (CFL) 条件下，这个平均过程可以表示为前一个时间步状态的凸组合。具体来说，$\\mathbf{U}_j^{n+1}$ 是 $\\mathbf{U}_j^n$ 和来自单元边界处黎曼问题的中间状态 $\\mathbf{U}_{j-1/2}^{HLL}$ 和 $\\mathbf{U}_{j+1/2}^{HLL}$ 的凸组合。\n\n由于 $G$ 是一个凸集，如果初始状态 $\\mathbf{U}_j^n$ 在 $G$ 中，那么只要中间 HLLE 状态 $\\mathbf{U}^{HLL}$ 本身在 $G$ 中，更新后的状态 $\\mathbf{U}_j^{n+1}$ 也将在 $G$ 中。因此，分析的核心是确定波速估计值 $s_L$ 和 $s_R$ 需要满足何种条件才能保证 $\\mathbf{U}^{HLL}$ 的物理可容许性。\n\nHLLE 中间状态可以理解为精确的自相似解 $\\mathbf{U}_{ex}(\\xi)$ 在由估计波速定义的区间上的积分平均值：\n$$ \\mathbf{U}^{HLL} = \\frac{1}{s_R - s_L} \\int_{s_L}^{s_R} \\mathbf{U}_{ex}(\\xi) d\\xi $$\n该公式直接由守恒律 $\\xi \\frac{d\\mathbf{U}}{d\\xi} = \\frac{d\\mathbf{F}}{d\\xi}$ 在 $[s_L, s_R]$ 上积分得到。\n由于欧拉方程的精确解 $\\mathbf{U}_{ex}(\\xi)$ 总是在物理集 $G$ 中（或者在真空情况下在其边界 $\\partial G$ 上），其积分平均值 $\\mathbf{U}^{HLL}$ 由于 $G$ 的凸性，也将在 $G$ 中，前提是平均区间 $[s_L, s_R]$ 包含了精确解的整个波结构。如果区间选择得太窄，平均值可能会取自解的一个不具代表性的部分，从而可能产生一个非物理状态。\n\n精确黎曼解的波结构支撑在自相似速度区间 $[\\lambda_{min}, \\lambda_{max}]$ 上，其中 $\\lambda_{min}$ 和 $\\lambda_{max}$ 是解中出现的最小和最大特征速度。对于欧拉方程组，特征速度为 $u-a$、$u$ 和 $u+a$。整个波扇的最小速度由最左边波的头部决定，最大速度由最右边波的头部决定。这些是由初始状态 $\\mathbf{U}_L$ 和 $\\mathbf{U}_R$ 决定的。\n- 左行波（1-波）头部的速度是 $\\lambda_1(\\mathbf{U}_L) = u_L - a_L$。\n- 右行波（3-波）头部的速度是 $\\lambda_3(\\mathbf{U}_R) = u_R + a_R$。\n\n因此，为确保平均区间包含整个波扇，估计的波速必须满足：\n$$s_L \\le u_L - a_L \\quad \\text{且} \\quad s_R \\ge u_R + a_R$$\n这些不等式是 HLLE 求解器为保持正性而对波速估计的要求。这对任何解结构都成立，包括形成真空的情况。初始数据导致真空形成这一事实，并不会改变 HLLE 格式的鲁棒性和保正性的这一基本要求。",
            "answer": "$$\n\\boxed{15}\n$$"
        },
        {
            "introduction": "特征线分析的理论价值最终体现在其在计算流体力学（CFD）代码中的实际应用上，特别是在构建物理上正确的边界条件时。本练习  模拟了在出口边界处可能遇到的复杂流动情况，例如从超声速到亚声速的局部转换。你将基于特征理论，系统地设计一个混合边界条件处理方案，学会根据局部流动的马赫数 $M_n$ 动态切换边界条件，这是开发可靠CFD求解器的核心技能之一。",
            "id": "3368282",
            "problem": "考虑在具有指向外单位法向量的计算域出口处，对可压缩欧拉方程进行一维特征线分析。设域内邻近出口的原始变量状态为 $(\\rho, u_n, p)$，其中 $\\rho$ 为密度，$u_n$ 为垂直于出口的速度分量（指向域外为正），$p$ 为静压。假设气体为量热完全气体，比热比为 $\\gamma$，并且局部闭合关系为沿特征线的理想气体等熵关系。设声速为 $a = \\sqrt{\\gamma p / \\rho}$，并定义法向马赫数 $M_n = u_n/a$。该一维系统在法向上的特征波速为 $\\lambda_1 = u_n - a$，$\\lambda_2 = u_n$ 和 $\\lambda_3 = u_n + a$。入射特征的数量等于符号为负的 $\\lambda_i$ 的个数。对于名义上的超声速出口，局部可能出现 $M_n$ 略小于 1 的小区域。这些区域会改变所需的边界条件集合。\n\n仅从这些基本原理出发，推导所需标量边界条件的数量作为 $\\lambda_i$ 符号的函数，并构建一个基于 $M_n$ 进行切换的、鲁棒的混合亚/超声速出口处理方法，具体如下：\n- 对于 $M_n \\ge M_{\\text{up}}$ 的出流（严格超声速），不对双曲部分施加任何条件，并从内部外插所有原始变量。\n- 对于 $M_n \\le M_{\\text{low}}$ 的出流（亚声速），通过将静压指定为给定的参考值 $p_{\\text{ref}}$ 来施加一个标量条件，并保持来自内部的熵。使用特征相容性计算边界速度。\n- 对于 $M_{\\text{low}}  M_n  M_{\\text{up}}$，使用切换函数 $s(M_n)$ 在这两个极限之间进行平滑混合。\n- 此外，处理出口处的局部反向流动（通过出口的入流）。对于亚声速入流，有两个特征进入；通过强制使入射特征和熵与静池状态匹配，同时从内部获取出射特征，从而从指定的静池状态提供两个条件。对于超声速入流，有三个特征进入；将边界状态设置为等于静池状态。\n\n使用以下经过充分检验的公式和定义：\n- 等熵常数 $K = p/\\rho^\\gamma$。\n- 等熵流的黎曼不变量，$w^+ = u_n + \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n + a$ 传播，以及 $w^- = u_n - \\dfrac{2a}{\\gamma-1}$ 沿 $\\dfrac{dx}{dt} = u_n - a$ 传播。\n- 对于亚声速出流，从内部获取 $K$ 和 $w^+$，设置 $p = p_{\\text{ref}}$，并相容地恢复 $a$ 和 $u_n$。\n- 对于亚声速入流，从静池获取 $K$ 和 $w^-$，从内部获取 $w^+$，然后相容地恢复 $a$、$u_n$、$\\rho$ 和 $p$。\n- 对于超声速入流，将 $(\\rho, u_n, p)$ 设置为等于静池状态。\n\n您的程序必须实现这种混合处理方法，在近声速区带使用线性切换函数在阈值 $M_{\\text{low}} = 1 - \\delta$ 和 $M_{\\text{up}} = 1 + \\delta$ 之间进行平滑切换，其中 $\\delta$ 为给定值。具体而言，对于出流，定义\n$$\ns(M_n) = \n\\begin{cases}\n1,   M_n \\le M_{\\text{low}}, \\\\[4pt]\n\\dfrac{M_{\\text{up}} - M_n}{M_{\\text{up}} - M_{\\text{low}}},   M_{\\text{low}}  M_n  M_{\\text{up}}, \\\\[6pt]\n0,   M_n \\ge M_{\\text{up}}.\n\\end{cases}\n$$\n然后通过以下方式计算出流的边界状态：\n$$\n\\begin{aligned}\n(\\rho, u_n, p)_{\\text{sup}} = (\\rho, u_n, p)_{\\text{int}},\\\\\np_{\\text{sub}} = p_{\\text{ref}}, \\quad K_{\\text{int}} = \\dfrac{p_{\\text{int}}}{\\rho_{\\text{int}}^\\gamma}, \\quad \\rho_{\\text{sub}} = \\left(\\dfrac{p_{\\text{sub}}}{K_{\\text{int}}}\\right)^{1/\\gamma}, \\\\\na_{\\text{sub}} = \\sqrt{\\dfrac{\\gamma p_{\\text{sub}}}{\\rho_{\\text{sub}}}}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1}, \\quad u_{n,\\text{sub}} = w^+_{\\text{int}} - \\dfrac{2 a_{\\text{sub}}}{\\gamma - 1},\\\\\n(\\rho, u_n, p)_{\\text{bc}} = (1-s)(\\rho, u_n, p)_{\\text{sup}} + s(\\rho, u_n, p)_{\\text{sub}}.\n\\end{aligned}\n$$\n对于通过出口的入流，使用静池状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$:\n- 如果 $|M_n|  1$ 且 $u_n  0$ （亚声速入流），计算\n$$\nK_\\infty = \\dfrac{p_\\infty}{\\rho_\\infty^\\gamma}, \\quad a_\\infty = \\sqrt{\\dfrac{\\gamma p_\\infty}{\\rho_\\infty}}, \\quad w^-_\\infty = u_{n,\\infty} - \\dfrac{2a_\\infty}{\\gamma - 1}, \\quad w^+_{\\text{int}} = u_{n,\\text{int}} + \\dfrac{2a_{\\text{int}}}{\\gamma - 1},\n$$\n然后\n$$\na_{\\text{bc}} = \\dfrac{\\gamma - 1}{4}\\left(w^+_{\\text{int}} - w^-_\\infty\\right), \\quad u_{n,\\text{bc}} = \\dfrac{w^+_{\\text{int}} + w^-_\\infty}{2}, \\quad \n\\rho_{\\text{bc}} = \\left(\\dfrac{a_{\\text{bc}}^2}{\\gamma K_\\infty}\\right)^{\\!\\!1/(\\gamma - 1)}, \\quad p_{\\text{bc}} = K_\\infty \\rho_{\\text{bc}}^\\gamma.\n$$\n- 如果 $|M_n| \\ge 1$ 且 $u_n  0$ （超声速入流），设置 $(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n测试套件。在国际单位制（SI）下使用以下常数和状态：\n- $\\gamma = 1.4$, $\\delta = 0.05$,\n- 出口参考压力 $p_{\\text{ref}} = 101325\\,\\text{Pa}$，\n- 入流静池状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty) = (1.2\\,\\text{kg/m}^3, -200\\,\\text{m/s}, 300000\\,\\text{Pa})$。\n\n定义六个测试案例，其内部状态为 $(\\rho_{\\text{int}}, u_{n,\\text{int}}, p_{\\text{int}})$:\n- 案例 A（严格超声速出流）： $(0.5\\,\\text{kg/m}^3, 600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 案例 B（轻微亚声速出流区域）： $(0.5\\,\\text{kg/m}^3, 0.98\\,a_{\\text{int}}, 100000\\,\\text{Pa})$，其中 $a_{\\text{int}} = \\sqrt{\\gamma p_{\\text{int}}/\\rho_{\\text{int}}}$。\n- 案例 C（近声速出流，$M_n = 1.01$）： $(0.5\\,\\text{kg/m}^3, 1.01\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 案例 D（近声速出流，$M_n = 0.99$）： $(0.5\\,\\text{kg/m}^3, 0.99\\,a_{\\text{int}}, 100000\\,\\text{Pa})$。\n- 案例 E（通过出口的亚声速入流）： $(0.5\\,\\text{kg/m}^3, -100\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n- 案例 F（通过出口的超声速入流）： $(0.5\\,\\text{kg/m}^3, -600\\,\\text{m/s}, 100000\\,\\text{Pa})$。\n\n任务。对每个测试案例，计算：\n- 入射特征的整数数量 $n_{\\text{in}}$，即为负的 $\\lambda_i$ 的个数。\n- 法向马赫数 $M_n$。\n- 上述混合处理方法产生的边界状态 $(\\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}})$。\n\n将 $\\rho_{\\text{bc}}$ 以 $\\text{kg/m}^3$ 表示，$u_{n,\\text{bc}}$ 以 $\\text{m/s}$ 表示，$p_{\\text{bc}}$ 以 $\\text{Pa}$ 表示。将所有浮点输出四舍五入到六位小数。\n\n最终输出格式。您的程序应生成单行输出，其中包含按 A、B、C、D、E、F 顺序连接的六个案例的结果，每个案例贡献一个五元组 $[n_{\\text{in}}, M_n, \\rho_{\\text{bc}}, u_{n,\\text{bc}}, p_{\\text{bc}}]$。将它们聚合到一行的单个列表中，形式为用方括号括起来的逗号分隔列表，例如 $[n_{\\text{in},A}, M_{n,A}, \\rho_{\\text{bc},A}, u_{n,\\text{bc},A}, p_{\\text{bc},A}, \\dots, n_{\\text{in},F}, M_{n,F}, \\rho_{\\text{bc},F}, u_{n,\\text{bc},F}, p_{\\text{bc},F}]$。",
            "solution": "该问题要求在计算流体动力学背景下，为一维出口实现一种混合亚/超声速边界条件处理方法。该分析基于可压缩欧拉方程的特征线理论。\n\n### 基于原理的设计：特征线分析\n\n双曲型偏微分方程（如欧拉方程）的基础是特征线法。对于一维欧拉方程，存在三种在流体中传播信息的特征波。在计算边界处，这种传播的方向决定了是需要来自域外的信息（边界条件），还是状态由域内流动决定。\n\n这些波相对于静止边界的传播速度由系统雅可比矩阵的特征值给出。对于具有指向外法向量的边界，以及流体属性 $(\\rho, u_n, p)$ 分别代表密度、法向速度和压力，这些特征值为：\n- $\\lambda_1 = u_n - a$\n- $\\lambda_2 = u_n$\n- $\\lambda_3 = u_n + a$\n\n此处，$u_n$ 是垂直于出口的速度分量（出流为正），$a = \\sqrt{\\gamma p / \\rho}$ 是局部声速。负特征值（$\\lambda_i  0$）表示特征波传播到计算域内，因此需要提供边界条件。正特征值（$\\lambda_i  0$）表示波从域内传播出去，携带来自内部的信息。因此，所需边界条件的数量 $n_{\\text{in}}$ 就是负特征值的数量。\n\n出口处的流动状态由法向马赫数 $M_n = u_n/a$ 分类。我们分析每种流动状态下特征值的符号：\n\n1.  **超声速出流 ($u_n  0, M_n  1$)**：由于 $u_n  a$，所有三个特征值均为正：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，$\\lambda_3 = u_n + a  0$。所有信息都从域内传播出去。因此，$n_{\\text{in}} = 0$，不施加任何边界条件。边界上的状态完全由内部流动决定，通常通过外插得到。\n\n2.  **亚声速出流 ($u_n  0, 0  M_n  1$)**：由于 $0  u_n  a$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，以及 $\\lambda_3 = u_n + a  0$。一个特征进入域内。因此，$n_{\\text{in}} = 1$，必须提供一个标量边界条件。对于亚声速出口，通常指定静压 $p_{\\text{bc}} = p_{\\text{ref}}$。\n\n3.  **亚声速入流 ($u_n  0, |M_n|  1$)**：由于 $-a  u_n  0$，我们有 $\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，以及 $\\lambda_3 = u_n + a  0$。两个特征进入域内。因此，$n_{\\text{in}} = 2$，需要两个标量条件。这些条件通常从远场或静池状态提供。\n\n4.  **超声速入流 ($u_n  0, |M_n|  1$)**：由于 $u_n  -a$，所有三个特征值均为负：$\\lambda_1 = u_n - a  0$，$\\lambda_2 = u_n  0$，以及 $\\lambda_3 = u_n + a  0$。所有信息都传播到域内。因此，$n_{\\text{in}} = 3$，必须从静池状态指定整个流动状态（$\\rho, u_n, p$）。\n\n### 基于特征线的算法实现\n\n该问题提供了具体的公式，使用称为黎曼不变量（$w^+, w^-$）的特征变量和熵（通过等熵常数 $K = p/\\rho^\\gamma$）来实现这些条件。\n\n**出流 ($u_n \\ge 0$)：**\n一个鲁棒的处理方法必须平滑地处理亚声速和超声速出流之间的过渡。该问题定义了一种混合方法，在跨声速区域 $M_{\\text{low}}  M_n  M_{\\text{up}}$ 使用切换函数 $s(M_n)$，其中 $M_{\\text{low}} = 1 - \\delta$ 且 $M_{\\text{up}} = 1 + \\delta$。\n边界状态 $(\\rho, u_n, p)_{\\text{bc}}$ 是一个加权平均值：\n$$(\\rho, u_n, p)_{\\text{bc}} = (1-s(M_n))(\\rho, u_n, p)_{\\text{sup}} + s(M_n)(\\rho, u_n, p)_{\\text{sub}}$$\n-   超声速状态 $(\\rho, u_n, p)_{\\text{sup}}$ 就是内部外插状态 $(\\rho, u_n, p)_{\\text{int}}$，与 $n_{\\text{in}}=0$ 一致。\n-   亚声速状态 $(\\rho, u_n, p)_{\\text{sub}}$ 是通过施加一个条件（$p_{\\text{sub}} = p_{\\text{ref}}$）并使用来自内部的两个出射特征的信息来计算的。这是通过守恒来自内部状态的黎曼不变量 $w^+ = u_n + \\frac{2a}{\\gamma-1}$ 和等熵常数 $K = p/\\rho^\\gamma$ 来实现的。在已知 $p_{\\text{sub}}$ 和 $K_{\\text{int}}$ 的情况下，可以求出 $\\rho_{\\text{sub}}$ 和 $a_{\\text{sub}}$。然后，从守恒的 $w^+_{\\text{int}}$ 求出 $u_{n,\\text{sub}}$。\n\n**入流 ($u_n  0$)：**\n-   **亚声速入流 ($|M_n|  1$, $n_{\\text{in}}=2$)**：需要两个条件。边界条件是通过从静池状态 $(\\rho_\\infty, u_{n,\\infty}, p_\\infty)$ 获取两个入射特征的属性，并从内部获取一个出射特征的属性来构建的。这意味着入射黎曼不变量 $w^- = u_n - \\frac{2a}{\\gamma-1}$ 和熵（通过 $K$）被设置为其静池值 ($w^-_\\infty, K_\\infty$)。出射黎曼不变量 $w^+$ 从内部获取 ($w^+_{\\text{int}}$)。这提供了一个方程组来求解边界状态 $(\\rho, u_n, p)_{\\text{bc}}$。\n-   **超声速入流 ($|M_n| \\ge 1$, $n_{\\text{in}}=3$)**：所有信息都来自外部。边界状态直接设置为静池状态：$(\\rho, u_n, p)_{\\text{bc}} = (\\rho_\\infty, u_{n,\\infty}, p_\\infty)$。\n\n以下程序为指定的测试案例实现了这一逻辑。它首先计算内部马赫数 $M_n$ 和入射特征数 $n_{\\text{in}}$。然后，它根据 $u_n$ 的符号和 $M_n$ 的值应用适当的逻辑来确定最终的边界状态。",
            "answer": "```python\nimport numpy as np\n\n# Global constants from the problem statement\nGAMMA = 1.4\nDELTA = 0.05\nP_REF = 101325.0\nRHO_INF = 1.2\nU_N_INF = -200.0\nP_INF = 300000.0\n\ndef solve():\n    \"\"\"\n    Solves the mixed supersonic/subsonic outlet boundary condition problem\n    for a series of test cases.\n    \"\"\"\n    \n    m_low = 1.0 - DELTA\n    m_up = 1.0 + DELTA\n\n    # Pre-calculate reservoir properties\n    a_inf = np.sqrt(GAMMA * P_INF / RHO_INF)\n    k_inf = P_INF / (RHO_INF**GAMMA)\n    w_minus_inf = U_N_INF - 2.0 * a_inf / (GAMMA - 1.0)\n    \n    # Define test cases. For cases with u_n defined relative to a_int,\n    # we first calculate a_int and then u_n.\n    p_base_int = 100000.0\n    rho_base_int = 0.5\n    a_base_int = np.sqrt(GAMMA * p_base_int / rho_base_int)\n\n    test_cases = [\n        # Case A (strict supersonic outflow)\n        (rho_base_int, 600.0, p_base_int),\n        # Case B (slightly subsonic outflow pocket)\n        (rho_base_int, 0.98 * a_base_int, p_base_int),\n        # Case C (near-sonic outflow, M_n = 1.01)\n        (rho_base_int, 1.01 * a_base_int, p_base_int),\n        # Case D (near-sonic outflow, M_n = 0.99)\n        (rho_base_int, 0.99 * a_base_int, p_base_int),\n        # Case E (subsonic inflow through the outlet)\n        (rho_base_int, -100.0, p_base_int),\n        # Case F (supersonic inflow through the outlet)\n        (rho_base_int, -600.0, p_base_int),\n    ]\n\n    final_results = []\n\n    for rho_int, u_n_int, p_int in test_cases:\n        a_int = np.sqrt(GAMMA * p_int / rho_int)\n        m_n_int = u_n_int / a_int if a_int != 0 else 0.0\n\n        # Task 1: Calculate the number of incoming characteristics\n        lambda1 = u_n_int - a_int\n        lambda2 = u_n_int\n        lambda3 = u_n_int + a_int\n        n_in = sum(1 for lam in [lambda1, lambda2, lambda3] if lam  0)\n\n        rho_bc, u_n_bc, p_bc = 0.0, 0.0, 0.0\n\n        # Task 3: Compute boundary state based on flow regime\n        if u_n_int >= 0:  # Outflow\n            # Supersonic limit state (extrapolation)\n            rho_sup, u_n_sup, p_sup = rho_int, u_n_int, p_int\n\n            # Subsonic limit state (pressure-based)\n            p_sub = P_REF\n            k_int = p_int / (rho_int**GAMMA)\n            rho_sub = (p_sub / k_int)**(1.0 / GAMMA)\n            a_sub = np.sqrt(GAMMA * p_sub / rho_sub)\n            w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n            u_n_sub = w_plus_int - 2.0 * a_sub / (GAMMA - 1.0)\n            \n            # Blending function s(M_n)\n            s = 0.0\n            if m_n_int = m_low:\n                s = 1.0\n            elif m_low  m_n_int  m_up:\n                s = (m_up - m_n_int) / (m_up - m_low)\n            \n            # Blended boundary state\n            rho_bc = (1.0 - s) * rho_sup + s * rho_sub\n            u_n_bc = (1.0 - s) * u_n_sup + s * u_n_sub\n            p_bc = (1.0 - s) * p_sup + s * p_sub\n            \n        else:  # Inflow (reversed flow)\n            if abs(m_n_int)  1.0: # Subsonic inflow\n                w_plus_int = u_n_int + 2.0 * a_int / (GAMMA - 1.0)\n                \n                a_bc = (GAMMA - 1.0) / 4.0 * (w_plus_int - w_minus_inf)\n                u_n_bc = 0.5 * (w_plus_int + w_minus_inf)\n                rho_bc = (a_bc**2 / (GAMMA * k_inf))**(1.0 / (GAMMA - 1.0))\n                p_bc = k_inf * rho_bc**GAMMA\n            else: # Supersonic inflow\n                rho_bc, u_n_bc, p_bc = RHO_INF, U_N_INF, P_INF\n\n        # Store results for this case, rounded to 6 decimal places\n        final_results.extend([\n            n_in,\n            round(m_n_int, 6),\n            round(rho_bc, 6),\n            round(u_n_bc, 6),\n            round(p_bc, 6)\n        ])\n\n    # Format the final output string as a comma-separated list in brackets\n    output_str = \"[\" + \",\".join(map(str, final_results)) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}