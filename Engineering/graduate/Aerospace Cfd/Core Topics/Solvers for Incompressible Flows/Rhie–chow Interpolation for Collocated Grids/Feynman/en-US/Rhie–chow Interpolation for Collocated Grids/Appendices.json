{
    "hands_on_practices": [
        {
            "introduction": "Why is a special interpolation scheme like the Rhie–Chow method even necessary? This foundational exercise dives into the heart of the problem by exposing a critical flaw in simple collocated grid discretizations. By analyzing a \"checkerboard\" pressure field, you will analytically demonstrate how a standard scheme can fail to produce a corrective velocity field, leading to non-physical pressure oscillations .",
            "id": "3991734",
            "problem": "Consider a two-dimensional, uniform Cartesian, collocated finite-volume discretization used in Computational Fluid Dynamics (CFD) for incompressible flow on an interior cell indexed by $(i,j)$, with uniform spacings $\\Delta x$ and $\\Delta y$. The continuity equation requires the discrete divergence of the face-normal velocities to vanish. Face-normal velocities are obtained by linear interpolation of cell-centered velocities. The momentum equations at the cell centers are discretized with a central-difference approximation for the pressure gradient, and the diagonal coefficient of the discrete momentum operator is a positive constant $a$ (identical for both velocity components). Assume the non-pressure contributions to the predicted cell-centered velocities vanish, so the only driving term is the pressure gradient.\n\nLet the cell-centered pressure field be a checkerboard defined by $p_{i,j} = p_{0} + \\alpha (-1)^{i+j}$, where $p_{0}$ and $\\alpha$ are constants.\n\nUsing only these premises, and taking the face-normal velocities as the arithmetic averages of adjacent cell-centered velocities, derive the exact analytic expression for the discrete divergence at cell $(i,j)$ given by\n$$\n\\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{\\Delta x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{\\Delta y},\n$$\nwhere $u$ and $v$ are the $x$- and $y$-components of velocity. Then evaluate this discrete divergence for the given checkerboard pressure field. Provide the final value as a single real number or a single closed-form expression. If your final result is an exact value, do not round. Explain briefly, from first principles, why this result holds for the stated discretization and pressure field.",
            "solution": "The user has provided a valid problem statement in computational fluid dynamics (CFD). The problem asks to analyze the behavior of a standard collocated-grid finite-volume discretization for incompressible flow when subjected to a checkerboard pressure field. This is a classic pedagogical problem used to demonstrate the phenomenon of pressure-velocity decoupling and motivate the need for specialized interpolation schemes.\n\nThe solution proceeds in three stages as requested:\n1. Derivation of the general analytic expression for the discrete divergence.\n2. Evaluation of this expression for the specified checkerboard pressure field.\n3. Explanation of the result from first principles.\n\n**1. Derivation of the Discrete Divergence Expression**\n\nThe problem states that the non-pressure contributions to the predicted cell-centered velocities vanish. The discrete momentum equations at a cell center $(i,j)$ are driven solely by the pressure gradient, which is approximated by a central-difference scheme. The diagonal coefficient of the momentum operator is a constant $a$.\n\nThe discrete momentum equations are thus:\n$$\na u_{i,j} = - \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\n$$\n$$\na v_{i,j} = - \\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}\n$$\n\nFrom these, we can express the cell-centered velocities directly in terms of the pressure field:\n$$\nu_{i,j} = - \\frac{1}{2a\\Delta x} (p_{i+1,j} - p_{i-1,j})\n$$\n$$\nv_{i,j} = - \\frac{1}{2a\\Delta y} (p_{i,j+1} - p_{i,j-1})\n$$\n\nThe face-normal velocities are obtained by taking the arithmetic average of the adjacent cell-centered velocities. For the faces of the control volume around cell $(i,j)$, these are:\n$$\nu_{i+\\frac{1}{2},j} = \\frac{u_{i,j} + u_{i+1,j}}{2}\n$$\n$$\nu_{i-\\frac{1}{2},j} = \\frac{u_{i-1,j} + u_{i,j}}{2}\n$$\n$$\nv_{i,j+\\frac{1}{2}} = \\frac{v_{i,j} + v_{i,j+1}}{2}\n$$\n$$\nv_{i,j-\\frac{1}{2}} = \\frac{v_{i,j-1} + v_{i,j}}{2}\n$$\n\nNow, we substitute the expressions for the cell-centered velocities into the face velocity definitions. For the $x$-velocities:\n$$\nu_{i+\\frac{1}{2},j} = \\frac{1}{2} \\left[ \\left(-\\frac{p_{i+1,j} - p_{i-1,j}}{2a\\Delta x}\\right) + \\left(-\\frac{p_{i+2,j} - p_{i,j}}{2a\\Delta x}\\right) \\right] = -\\frac{1}{4a\\Delta x} (p_{i+2,j} + p_{i+1,j} - p_{i,j} - p_{i-1,j})\n$$\n$$\nu_{i-\\frac{1}{2},j} = \\frac{1}{2} \\left[ \\left(-\\frac{p_{i,j} - p_{i-2,j}}{2a\\Delta x}\\right) + \\left(-\\frac{p_{i+1,j} - p_{i-1,j}}{2a\\Delta x}\\right) \\right] = -\\frac{1}{4a\\Delta x} (p_{i+1,j} + p_{i,j} - p_{i-1,j} - p_{i-2,j})\n$$\n\nThe difference in $x$-velocities across the cell is:\n$$\nu_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j} = -\\frac{1}{4a\\Delta x} \\left[ (p_{i+2,j} + p_{i+1,j} - p_{i,j} - p_{i-1,j}) - (p_{i+1,j} + p_{i,j} - p_{i-1,j} - p_{i-2,j}) \\right]\n$$\n$$\nu_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j} = -\\frac{1}{4a\\Delta x} (p_{i+2,j} - 2p_{i,j} + p_{i-2,j})\n$$\n\nSimilarly, for the $y$-velocities:\n$$\nv_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}} = -\\frac{1}{4a\\Delta y} (p_{i,j+2} - 2p_{i,j} + p_{i,j-2})\n$$\n\nThe discrete divergence at cell $(i,j)$ is given by $D_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{\\Delta x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{\\Delta y}$. Substituting the expressions for the velocity differences, we obtain the general expression for the discrete divergence:\n$$\nD_{i,j} = \\frac{1}{\\Delta x} \\left( -\\frac{p_{i+2,j} - 2p_{i,j} + p_{i-2,j}}{4a\\Delta x} \\right) + \\frac{1}{\\Delta y} \\left( -\\frac{p_{i,j+2} - 2p_{i,j} + p_{i,j-2}}{4a\\Delta y} \\right)\n$$\n$$\nD_{i,j} = -\\frac{1}{4a} \\left[ \\frac{p_{i+2,j} - 2p_{i,j} + p_{i-2,j}}{(\\Delta x)^2} + \\frac{p_{i,j+2} - 2p_{i,j} + p_{i,j-2}}{(\\Delta y)^2} \\right]\n$$\nThis is the required analytic expression for the discrete divergence in terms of the nodal pressure values.\n\n**2. Evaluation for the Checkerboard Pressure Field**\n\nWe are given the checkerboard pressure field $p_{i,j} = p_0 + \\alpha (-1)^{i+j}$. Let us evaluate the pressure terms in the divergence expression:\nFor the $x$-direction terms:\n$$\np_{i+2,j} = p_0 + \\alpha (-1)^{(i+2)+j} = p_0 + \\alpha (-1)^{i+j} (-1)^2 = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n$$\np_{i-2,j} = p_0 + \\alpha (-1)^{(i-2)+j} = p_0 + \\alpha (-1)^{i+j} (-1)^{-2} = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\nThe numerator of the first term in the divergence expression becomes:\n$$\np_{i+2,j} - 2p_{i,j} + p_{i-2,j} = p_{i,j} - 2p_{i,j} + p_{i,j} = 0\n$$\n\nFor the $y$-direction terms:\n$$\np_{i,j+2} = p_0 + \\alpha (-1)^{i+(j+2)} = p_0 + \\alpha (-1)^{i+j} (-1)^2 = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\n$$\np_{i,j-2} = p_0 + \\alpha (-1)^{i+(j-2)} = p_0 + \\alpha (-1)^{i+j} (-1)^{-2} = p_0 + \\alpha (-1)^{i+j} = p_{i,j}\n$$\nThe numerator of the second term becomes:\n$$\np_{i,j+2} - 2p_{i,j} + p_{i,j-2} = p_{i,j} - 2p_{i,j} + p_{i,j} = 0\n$$\n\nSubstituting these results into the expression for $D_{i,j}$:\n$$\nD_{i,j} = -\\frac{1}{4a} \\left[ \\frac{0}{(\\Delta x)^2} + \\frac{0}{(\\Delta y)^2} \\right] = 0\n$$\n\n**3. Explanation from First Principles**\n\nThe result that the discrete divergence is zero is a direct consequence of pressure-velocity decoupling on a collocated grid with this simple discretization. The explanation is as follows:\n\nFirst, examine the discrete pressure gradient operator used to compute the cell-centered velocities, for example, in the $x$-direction: $\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}$. This operator samples the pressure field at nodes $i-1$ and $i+1$, completely skipping the node $i$ where the velocity is being calculated.\n\nFor the checkerboard field $p_{i,j} = p_0 + \\alpha (-1)^{i+j}$, the values at $i-1$ and $i+1$ are:\n$$\np_{i+1,j} = p_0 + \\alpha (-1)^{i+1+j} = p_0 - \\alpha (-1)^{i+j}\n$$\n$$\np_{i-1,j} = p_0 + \\alpha (-1)^{i-1+j} = p_0 - \\alpha (-1)^{i+j}\n$$\nTherefore, $p_{i+1,j} - p_{i-1,j} = 0$. The central difference operator for the pressure gradient is \"blind\" to the checkerboard pattern, which represents the highest frequency mode that can be represented on the grid.\n\nSince the discrete pressure gradient is zero everywhere for this pressure field, and the velocities are assumed to be driven only by this gradient, it follows that the calculated cell-centered velocities are zero everywhere: $u_{i,j} = 0$ and $v_{i,j} = 0$ for all $(i,j)$.\n\nNext, the face velocities are computed by averaging the adjacent (zero) cell-centered velocities. This naturally results in all face velocities also being zero: $u_{i+\\frac{1}{2},j} = 0$, $u_{i-\\frac{1}{2},j} = 0$, etc.\n\nFinally, the discrete divergence is computed from the differences of these zero-valued face velocities. The result is inevitably zero.\n\nThis illustrates a critical flaw in this particular numerical scheme: a highly oscillatory, non-constant pressure field produces no velocity, yet perfectly satisfies the discrete continuity equation ($\\text{divergence} = 0$). This means that such spurious pressure modes can contaminate the numerical solution without being detected or corrected by the pressure-correction step in an algorithm like SIMPLE. This is why staggered grids were originally introduced, and why modern collocated-grid methods must employ more sophisticated interpolation techniques, such as the Rhie–Chow interpolation, to prevent this decoupling.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "Having analytically proven the existence of decoupling , this hands-on coding practice lets you see the phenomenon—and its solution—in action. You will implement and compare two interpolation strategies to quantify how a naive approach fails to register a checkerboard pressure field, while the Rhie–Chow interpolation correctly generates a non-zero mass imbalance. This exercise solidifies the theoretical concept by translating it into a tangible numerical result .",
            "id": "3939869",
            "problem": "Consider a two-dimensional, incompressible, steady flow on a uniform, collocated grid, where velocity components and pressure are stored at cell centers. The governing equations are the continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and the momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$, with constant density $\\rho$ and dynamic viscosity $\\mu$. In Computational Fluid Dynamics (CFD), it is well known that collocated grids can exhibit spurious pressure oscillations (checkerboarding) unless a stabilization such as the Rhie–Chow interpolation is applied. Your task is to construct a simple discrete test that demonstrates how pressure oscillations arise on a collocated grid without Rhie–Chow interpolation, even when exact uniform boundary conditions are enforced.\n\nFundamental base and discrete setting:\n- Use a uniform, Cartesian grid of size $N_x \\times N_y$, with uniform spacing $\\Delta x = 1$ and $\\Delta y = 1$, and periodic boundary conditions in both directions. Periodic boundaries represent exact continuation of a uniform solution.\n- Assume a base uniform velocity field $\\tilde{u} = U_0$ and $\\tilde{v} = 0$, and a base pressure $p_0$ (constant). All quantities are dimensionless (unitless).\n- Introduce a small, dimensionless checkerboard pressure perturbation of amplitude $\\varepsilon$, superimposed on $p_0$:\n$$\np_{i,j} = p_0 + \\varepsilon (-1)^{i+j},\n$$\nfor cell indices $i \\in \\{0,1,\\dots,N_x-1\\}$ and $j \\in \\{0,1,\\dots,N_y-1\\}$. With periodic boundaries and even $N_x, N_y$, this perturbation is consistent and the base uniform solution remains exact at the boundaries.\n\nDiscrete gradient, velocity update, and face interpolation:\n- Compute the discrete cell-centered pressure gradients using second-order central differences (with periodic wrap):\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2 \\Delta x}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2 \\Delta y}.\n$$\n- Define a dimensionless momentum diagonal coefficient $a_m > 0$ that represents the strength of the implicit momentum operator (the inverse of which scales the pressure-gradient contribution to velocity). Update the cell-centered velocities due to pressure as\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}.\n$$\n\nTwo face-interpolation strategies:\n1. Without Rhie–Chow interpolation (naive collocated interpolation):\n   - Compute face velocities by linear interpolation of neighboring cell-centered velocities:\n   $$\n   u_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n   $$\n   $$\n   v_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n   $$\n   - Compute the discrete divergence at each cell using face differences:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = \\frac{u_{e,i,j} - u_{w,i,j}}{\\Delta x} + \\frac{v_{n,i,j} - v_{s,i,j}}{\\Delta y}.\n   $$\n2. With Rhie–Chow interpolation (stabilized collocated interpolation):\n   - Define the face momentum coefficient $a_f = a_m$.\n   - Augment face velocities with a pressure-difference term across the face:\n   $$\n   u_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad\n   u_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i-1,j}}{\\Delta x},\n   $$\n   $$\n   v_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}, \\quad\n   v_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} \\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}.\n   $$\n   - Compute the discrete divergence:\n   $$\n   (\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y}.\n   $$\n\nQuantitative measure:\n- For each strategy, compute the global discrete $L^2$ norm of the divergence:\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2 = \\left( \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} \\left[ (\\nabla \\cdot \\mathbf{u})_{i,j} \\right]^2 \\right)^{1/2}.\n$$\n- Demonstrate that, for the checkerboard perturbation and periodic boundaries, the naive collocated interpolation yields $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ numerically equal to $0$ (or at machine precision), while the Rhie–Chow interpolation yields a strictly positive $\\|\\nabla \\cdot \\mathbf{u}\\|_2$ proportional to $\\varepsilon$.\n\nTest suite:\n- Use the following parameter sets $(N_x,N_y,U_0,a_m,\\varepsilon)$, all dimensionless:\n  1. $(4,4,1.0,1.0,10^{-3})$\n  2. $(16,16,0.5,1.0,10^{-3})$\n  3. $(8,8,0.0,2.0,10^{-6})$\n  4. $(6,10,3.0,0.5,10^{-4})$\n\nProgram requirements:\n- Implement the above discrete operations with periodic boundary conditions and the two face-interpolation strategies.\n- For each test case, compute and record a pair of floats $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets of these pairs, for example, $[[a,b],[c,d],[e,f],[g,h]]$ where each letter is a float.\n\nAll quantities are dimensionless, so no physical units are required in the output. Angles do not appear. Percentages are not used.",
            "solution": "We begin from the incompressible continuity equation $\\nabla \\cdot \\mathbf{u} = 0$ and steady momentum equations $\\rho (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = - \\nabla p + \\mu \\nabla^2 \\mathbf{u}$. On a collocated grid, velocities $\\mathbf{u}$ and pressure $p$ are stored at the same locations (cell centers). For steady uniform flow with periodic boundaries, an exact solution is $\\mathbf{u} = (U_0, 0)$ and $p = p_0$ constant. We consider a superimposed checkerboard pressure perturbation $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$ to study the numerical response of face-interpolation schemes.\n\nDiscretization choices:\n- We adopt a uniform grid with $\\Delta x = \\Delta y = 1$, periodic boundary conditions, and central differences for cell-centered pressure gradients:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j} = \\frac{p_{i+1,j} - p_{i-1,j}}{2}, \\quad\n\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j} = \\frac{p_{i,j+1} - p_{i,j-1}}{2}.\n$$\nAs shown in the previous problem, for a checkerboard pressure field, this discrete gradient is identically zero. Hence, the cell-centered velocities updated by the pressure gradient,\n$$\nu_{i,j} = \\tilde{u} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}, \\quad\nv_{i,j} = \\tilde{v} - \\frac{1}{a_m} \\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j},\n$$\nsimplify to $u_{i,j} = \\tilde{u} = U_0$ and $v_{i,j} = \\tilde{v} = 0$ everywhere, despite the pressure oscillations.\n\nNaive collocated face interpolation:\n- The naive strategy interpolates cell-centered velocities to faces linearly:\n$$\nu_{e,i,j} = \\frac{u_{i,j} + u_{i+1,j}}{2}, \\quad u_{w,i,j} = \\frac{u_{i,j} + u_{i-1,j}}{2},\n$$\n$$\nv_{n,i,j} = \\frac{v_{i,j} + v_{i,j+1}}{2}, \\quad v_{s,i,j} = \\frac{v_{i,j} + v_{i,j-1}}{2}.\n$$\nSince $u_{i,j} = U_0$ is constant and $v_{i,j} = 0$ is constant, we have $u_{e,i,j} = u_{w,i,j} = U_0$ and $v_{n,i,j} = v_{s,i,j} = 0$. Therefore, the discrete divergence\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{naive}} = (u_{e,i,j} - u_{w,i,j}) + (v_{n,i,j} - v_{s,i,j}) = 0,\n$$\nfor all cells. The global $L^2$ norm $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$ is identically $0$. This reveals the decoupling: the checkerboard pressure oscillation does not induce any corrective mass flux at faces, so the continuity equation is blind to it, allowing spurious pressure modes to persist.\n\nRhie–Chow interpolation:\n- Rhie–Chow interpolation modifies face velocities by adding a pressure-difference term that uses face-centered pressure differences rather than cell-centered gradients:\n$$\nu_{e,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i+1,j}}{2} - \\frac{1}{a_f} (p_{i+1,j} - p_{i,j}), \\quad\nu_{w,i,j}^{\\text{RC}} = \\frac{u_{i,j} + u_{i-1,j}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i-1,j}),\n$$\n$$\nv_{n,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j+1}}{2} - \\frac{1}{a_f} (p_{i,j+1} - p_{i,j}), \\quad\nv_{s,i,j}^{\\text{RC}} = \\frac{v_{i,j} + v_{i,j-1}}{2} - \\frac{1}{a_f} (p_{i,j} - p_{i,j-1}).\n$$\nHere we set $a_f = a_m$ to simplify. The resulting discrete divergence is\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\left[ \\frac{u_{e,i,j}^{\\text{RC}} - u_{w,i,j}^{\\text{RC}}}{\\Delta x} + \\frac{v_{n,i,j}^{\\text{RC}} - v_{s,i,j}^{\\text{RC}}}{\\Delta y} \\right].\n$$\nWith $\\Delta x = \\Delta y = 1$ and $u_{i,j} = U_0$, $v_{i,j} = 0$, the uniform parts cancel, leaving the pressure contribution:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[(p_{i+1,j} - p_{i,j}) - (p_{i,j} - p_{i-1,j}) + (p_{i,j+1} - p_{i,j}) - (p_{i,j} - p_{i,j-1})\\right].\n$$\nRearranging, we get the discrete 5-point Laplacian of pressure:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ (p_{i+1,j} - 2 p_{i,j} + p_{i-1,j}) + (p_{i,j+1} - 2 p_{i,j} + p_{i,j-1}) \\right].\n$$\nNow, substitute $p_{i,j} = p_0 + \\varepsilon (-1)^{i+j}$. The Laplacian operator is linear and annihilates the constant part $p_0$. We only need to consider the oscillatory part.\nFor the $x$-direction component:\n$$\n(p_{i+1,j} - 2p_{i,j} + p_{i-1,j}) = (p_0 - \\varepsilon(-1)^{i+j}) - 2(p_0 + \\varepsilon(-1)^{i+j}) + (p_0 - \\varepsilon(-1)^{i+j}) = -4\\varepsilon(-1)^{i+j}.\n$$\nThe $y$-direction component is identical. Therefore, the sum is $-8\\varepsilon(-1)^{i+j}$.\nSubstituting this back into the divergence expression:\n$$\n(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = - \\frac{1}{a_f} \\left[ -8\\varepsilon(-1)^{i+j} \\right] = \\frac{8 \\varepsilon}{a_f} (-1)^{i+j}.\n$$\nWith $a_f = a_m$, the local divergence is $(\\nabla \\cdot \\mathbf{u})_{i,j}^{\\text{RC}} = \\frac{8 \\varepsilon}{a_m} (-1)^{i+j}$. The global $L^2$ norm is\n$$\n\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} (-1)^{i+j} \\right]^2 \\right)^{1/2} = \\left( \\sum_{i,j} \\left[ \\frac{8 \\varepsilon}{a_m} \\right]^2 \\right)^{1/2} = \\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}.\n$$\nThis nonzero norm quantifies the Rhie–Chow interpolation’s ability to convert the checkerboard pressure oscillation into face flux corrections that do not vanish in the discrete continuity, thereby suppressing the spurious mode.\n\nAlgorithmic design:\n- Implement periodic indexing for central differences and face interpolations.\n- Compute $\\left(\\frac{\\partial p}{\\partial x}\\right)_{i,j}$ and $\\left(\\frac{\\partial p}{\\partial y}\\right)_{i,j}$ with central differences.\n- Update $u_{i,j}$ and $v_{i,j}$ using $a_m$.\n- Compute naive face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}$.\n- Compute Rhie–Chow face velocities and divergence; compute $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$.\n- For the provided test suite $(N_x,N_y,U_0,a_m,\\varepsilon)$, record pairs $[\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}}, \\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}]$.\n- The expected qualitative outcome is that $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{naive}} \\approx 0$ for all cases (to machine precision), while $\\|\\nabla \\cdot \\mathbf{u}\\|_2^{\\text{RC}}$ scales as $\\frac{8 \\varepsilon}{a_m} \\sqrt{N_x N_y}$.\n\nThis demonstration uses fundamental laws and standard central-difference discretizations to reveal the collocated-grid decoupling mechanism and shows how Rhie–Chow interpolation restores coupling between pressure and mass flux at faces, eliminating the checkerboard null space.",
            "answer": "```python\nimport numpy as np\n\ndef periodic_index(i, n):\n    # Return periodic index\n    return i % n\n\ndef compute_gradients(p):\n    nx, ny = p.shape\n    dpdx = np.zeros_like(p)\n    dpdy = np.zeros_like(p)\n    # Central differences with periodic wrap, dx = dy = 1\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            dpdx[i, j] = 0.5 * (p[ip, j] - p[im, j])\n            dpdy[i, j] = 0.5 * (p[i, jp] - p[i, jm])\n    return dpdx, dpdy\n\ndef interpolate_faces_naive(u, v):\n    nx, ny = u.shape\n    # Face velocities at cell i,j: east, west, north, south\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef interpolate_faces_rc(u, v, p, a_f):\n    nx, ny = u.shape\n    u_e = np.zeros_like(u)\n    u_w = np.zeros_like(u)\n    v_n = np.zeros_like(v)\n    v_s = np.zeros_like(v)\n    for i in range(nx):\n        ip = periodic_index(i + 1, nx)\n        im = periodic_index(i - 1, nx)\n        for j in range(ny):\n            jp = periodic_index(j + 1, ny)\n            jm = periodic_index(j - 1, ny)\n            # dx = dy = 1\n            u_e[i, j] = 0.5 * (u[i, j] + u[ip, j]) - (1.0 / a_f) * (p[ip, j] - p[i, j])\n            u_w[i, j] = 0.5 * (u[i, j] + u[im, j]) - (1.0 / a_f) * (p[i, j] - p[im, j])\n            v_n[i, j] = 0.5 * (v[i, j] + v[i, jp]) - (1.0 / a_f) * (p[i, jp] - p[i, j])\n            v_s[i, j] = 0.5 * (v[i, j] + v[i, jm]) - (1.0 / a_f) * (p[i, j] - p[i, jm])\n    return u_e, u_w, v_n, v_s\n\ndef divergence_from_faces(u_e, u_w, v_n, v_s):\n    # dx = dy = 1\n    return (u_e - u_w) + (v_n - v_s)\n\ndef l2_norm(field):\n    return np.sqrt(np.sum(field**2))\n\ndef run_case(nx, ny, U0, a_m, eps):\n    # Construct checkerboard pressure with periodic consistency\n    i_idx = np.arange(nx).reshape(nx, 1)\n    j_idx = np.arange(ny).reshape(1, ny)\n    checker = ((i_idx + j_idx) % 2) * 2 - 1  # values in {-1, +1}\n    p0 = 0.0\n    p = p0 + eps * checker\n\n    # Base velocities\n    u_tilde = np.full((nx, ny), U0)\n    v_tilde = np.zeros((nx, ny))\n\n    # Cell-centered gradients\n    dpdx, dpdy = compute_gradients(p)\n\n    # Update cell-centered velocities\n    u = u_tilde - (1.0 / a_m) * dpdx\n    v = v_tilde - (1.0 / a_m) * dpdy\n\n    # Naive face interpolation and divergence\n    u_e, u_w, v_n, v_s = interpolate_faces_naive(u, v)\n    div_naive = divergence_from_faces(u_e, u_w, v_n, v_s)\n    norm_naive = l2_norm(div_naive)\n\n    # Rhie–Chow face interpolation and divergence\n    u_e_rc, u_w_rc, v_n_rc, v_s_rc = interpolate_faces_rc(u, v, p, a_m)\n    div_rc = divergence_from_faces(u_e_rc, u_w_rc, v_n_rc, v_s_rc)\n    norm_rc = l2_norm(div_rc)\n\n    return [float(norm_naive), float(norm_rc)]\n\ndef solve():\n    test_cases = [\n        (4, 4, 1.0, 1.0, 1e-3),\n        (16, 16, 0.5, 1.0, 1e-3),\n        (8, 8, 0.0, 2.0, 1e-6),\n        (6, 10, 3.0, 0.5, 1e-4),\n    ]\n\n    results = []\n    for nx, ny, U0, a_m, eps in test_cases:\n        results.append(run_case(nx, ny, U0, a_m, eps))\n\n    # Print nested list of [norm_naive, norm_rc] for each case\n    # Ensure single-line output format exactly as specified.\n    print(str(results).replace(\" \", \"\"))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "The effectiveness of a numerical method is often tested at the boundaries of the computational domain. This practice moves from internal grid cells to a fixed-pressure outlet, a common and crucial boundary condition in CFD simulations. You will derive the expression for mass flux at this boundary using Rhie–Chow interpolation, revealing how the method ensures physical behavior where the domain meets its external environment .",
            "id": "3991767",
            "problem": "Consider a one-dimensional, steady, incompressible flow in a duct of constant cross-sectional area within the framework of Computational Fluid Dynamics (CFD) using a collocated variable arrangement. Let the last interior control volume adjacent to the outlet face be denoted by the cell center $P$, and the outlet boundary face be $f$. The outlet boundary imposes a fixed pressure $p_f$ at the face. The face normal points in the positive $x$-direction. The grid is uniform with spacing $\\Delta x$, and the distance from the cell center $P$ to the outlet face $f$ is $d_{Pf} = \\Delta x/2$. The momentum equation has been solved and provides a cell-centered velocity $u_P$ and its diagonal momentum coefficient $a_P$ for cell $P$. The cell volume is $V_P = A \\Delta x$, where $A$ is the duct cross-sectional area. The density $\\rho$ is constant.\n\nStarting from the discrete momentum balance at the cell center $P$, in the form\n$$\nu_P \\;=\\; \\tilde{u}_P \\;-\\; \\left(\\frac{V_P}{a_P}\\right) \\left.\\frac{\\partial p}{\\partial x}\\right|_{P},\n$$\nand using Rhie–Chow interpolation to construct a consistent face-normal velocity at the outlet face $f$, derive the expression for the face-normal mass flux $\\dot{m}_f$ across $f$ that avoids pressure-velocity decoupling. In your derivation, use a one-sided finite difference for the pressure gradient at the boundary face, namely\n$$\n\\left.\\frac{\\partial p}{\\partial x}\\right|_{f} \\;\\approx\\; \\frac{p_f - p_P}{d_{Pf}},\n$$\nand explicitly show how the pressure contribution in the Rhie–Chow interpolation simplifies when the face pressure $p_f$ is prescribed (Dirichlet condition). Then, compute the numerical value of $\\dot{m}_f$ using the following data:\n- $\\rho = 1.225 \\,\\text{kg m}^{-3}$,\n- $A = 0.015 \\,\\text{m}^2$,\n- $\\Delta x = 0.1 \\,\\text{m}$,\n- $a_P = 30 \\,\\text{kg s}^{-1}$,\n- $u_P = 8.0 \\,\\text{m s}^{-1}$,\n- $p_P = 102000 \\,\\text{Pa}$,\n- $p_f = 101000 \\,\\text{Pa}$.\n\nExpress your final answer for the mass flux $\\dot{m}_f$ in $\\text{kg s}^{-1}$ and round to four significant figures.",
            "solution": "The problem asks for the derivation of the mass flux $\\dot{m}_f$ at an outlet face $f$ using Rhie–Chow interpolation for a collocated grid arrangement and then to compute its numerical value. The flow is one-dimensional, steady, and incompressible.\n\nFirst, we begin with the general principle of Rhie–Chow interpolation. The method constructs a face-normal velocity that prevents pressure-velocity decoupling by adding a pressure-dissipative term. The face velocity is constructed not by directly interpolating the cell-centered velocities, but by interpolating the components of the momentum equation to the face.\n\nThe standard expression for the face velocity $u_f$ at a face $f$ derived from the Rhie–Chow interpolation is:\n$$\nu_f = \\overline{u}_f + \\overline{\\left(\\frac{V}{a}\\right)}_f \\left[ \\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f - \\left(\\frac{\\partial p}{\\partial x}\\right)_f \\right]\n$$\nwhere the overbar indicates a value interpolated to the face $f$, and terms without an overbar are evaluated directly at the face.\n\nIn this specific problem, the face $f$ is an outlet boundary face adjacent only to the interior control volume centered at $P$. Therefore, any interpolation to the face $f$ from the interior is an extrapolation from cell $P$. This implies:\n1.  The interpolated velocity is $\\overline{u}_f = u_P$.\n2.  The interpolated momentum coefficient is $\\overline{\\left(\\frac{V}{a}\\right)}_f = \\frac{V_P}{a_P}$.\n3.  The interpolated cell-center pressure gradient is $\\overline{\\left(\\frac{\\partial p}{\\partial x}\\right)}_f = \\left(\\frac{\\partial p}{\\partial x}\\right)_P$.\n\nSubstituting these into the general Rhie–Chow formula gives the expression for the velocity at the boundary face $f$:\n$$\nu_f = u_P + \\left(\\frac{V_P}{a_P}\\right) \\left[ \\left(\\frac{\\partial p}{\\partial x}\\right)_P - \\left(\\frac{\\partial p}{\\partial x}\\right)_f \\right]\n$$\n\nThe problem provides a one-sided finite difference approximation for the pressure gradient at the face $f$, using the known boundary pressure $p_f$ and the adjacent cell-center pressure $p_P$:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_f \\approx \\frac{p_f - p_P}{d_{Pf}}\n$$\n\nThe term $\\left(\\frac{\\partial p}{\\partial x}\\right)_P$ represents the pressure gradient at the cell center $P$ that was used in solving the discrete momentum equation to obtain $u_P$. The problem statement explicitly requires showing how the Rhie–Chow interpolation simplifies for a prescribed pressure boundary. This simplification arises from the treatment of the pressure gradient at the boundary-adjacent cell. For an outlet with a fixed pressure, a common numerical boundary condition applied during the momentum predictor step (which yields $u_P$) is to assume a zero-gradient for pressure, i.e., $\\frac{\\partial p}{\\partial x} = 0$. Applying this condition at the last interior cell center $P$ means we set:\n$$\n\\left(\\frac{\\partial p}{\\partial x}\\right)_P = 0\n$$\nThis assumption is the key simplification. It decouples the momentum prediction for $u_P$ from the boundary pressure, and the Rhie–Chow interpolation then re-establishes the correct pressure-velocity coupling for the continuity equation (or the pressure-correction equation).\n\nSubstituting this assumption and the given face pressure gradient into the expression for $u_f$:\n$$\nu_f = u_P + \\left(\\frac{V_P}{a_P}\\right) \\left[ 0 - \\left(\\frac{p_f - p_P}{d_{Pf}}\\right) \\right]\n$$\n$$\nu_f = u_P - \\left(\\frac{V_P}{a_P}\\right) \\left(\\frac{p_f - p_P}{d_{Pf}}\\right)\n$$\nThis is the derived expression for the face velocity. The mass flux across the face $f$ is given by $\\dot{m}_f = \\rho A u_f$, where $\\rho$ is the density and $A$ is the cross-sectional area.\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\left(\\frac{V_P}{a_P}\\right) \\left(\\frac{p_f - p_P}{d_{Pf}}\\right) \\right]\n$$\nWe are given the cell volume $V_P = A \\Delta x$ and the distance $d_{Pf} = \\frac{\\Delta x}{2}$. Substituting these into the expression for $\\dot{m}_f$:\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\left(\\frac{A \\Delta x}{a_P}\\right) \\left(\\frac{p_f - p_P}{\\frac{\\Delta x}{2}}\\right) \\right]\n$$\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\frac{2 A \\Delta x}{a_P \\Delta x} (p_f - p_P) \\right]\n$$\nThe grid spacing $\\Delta x$ cancels out, yielding the final symbolic expression for the mass flux:\n$$\n\\dot{m}_f = \\rho A \\left[ u_P - \\frac{2 A}{a_P} (p_f - p_P) \\right]\n$$\nNow, we can substitute the given numerical values:\n- $\\rho = 1.225 \\,\\text{kg m}^{-3}$\n- $A = 0.015 \\,\\text{m}^2$\n- $u_P = 8.0 \\,\\text{m s}^{-1}$\n- $a_P = 30 \\,\\text{kg s}^{-1}$\n- $p_f = 101000 \\,\\text{Pa}$\n- $p_P = 102000 \\,\\text{Pa}$\n\nFirst, we compute the pressure difference term:\n$$\np_f - p_P = 101000 - 102000 = -1000 \\,\\text{Pa}\n$$\nNext, we compute the correction term for the velocity:\n$$\n-\\frac{2 A}{a_P} (p_f - p_P) = -\\frac{2 \\times 0.015}{30} (-1000) = -\\frac{0.03}{30} (-1000) = -0.001 \\times (-1000) = 1.0 \\,\\text{m s}^{-1}\n$$\nThe corrected face velocity $u_f$ is:\n$$\nu_f = u_P + 1.0 = 8.0 + 1.0 = 9.0 \\,\\text{m s}^{-1}\n$$\nFinally, we compute the mass flux $\\dot{m}_f$:\n$$\n\\dot{m}_f = \\rho A u_f = 1.225 \\times 0.015 \\times 9.0\n$$\n$$\n\\dot{m}_f = 0.018375 \\times 9.0 = 0.165375 \\,\\text{kg s}^{-1}\n$$\nRounding the result to four significant figures gives:\n$$\n\\dot{m}_f \\approx 0.1654 \\,\\text{kg s}^{-1}\n$$",
            "answer": "$$\n\\boxed{0.1654}\n$$"
        }
    ]
}