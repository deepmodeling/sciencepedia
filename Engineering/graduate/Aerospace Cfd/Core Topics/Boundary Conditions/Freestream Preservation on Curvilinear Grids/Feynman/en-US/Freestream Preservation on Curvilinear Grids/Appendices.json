{
    "hands_on_practices": [
        {
            "introduction": "The foundation of freestream preservation in finite volume methods lies in a simple yet powerful geometric constraint. For any closed control volume, the discrete divergence of a constant vector field must vanish, which translates into the requirement that the sum of the cell's face area vectors must be zero. This practice guides you through a first-principles derivation of this property, often called the discrete Geometric Conservation Law (GCL), for a single, general four-sided cell defined by a bilinear mapping . By performing this fundamental calculation, you will solidify your understanding of the geometric closure condition that underpins all conservative numerical schemes on structured grids.",
            "id": "3961207",
            "problem": "Consider a single four-sided computational cell in the context of Aerospace Computational Fluid Dynamics (CFD), parameterized by computational coordinates $(\\xi,\\eta) \\in [0,1] \\times [0,1]$. The physical coordinates $\\mathbf{r}(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$ are given by a bilinear mapping of the four corner points $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$ in $\\mathbb{R}^2$:\n$$\n\\mathbf{r}(\\xi,\\eta) = (1-\\xi)(1-\\eta)\\,\\mathbf{P}_{00} \\;+\\; \\xi(1-\\eta)\\,\\mathbf{P}_{10} \\;+\\; (1-\\xi)\\eta\\,\\mathbf{P}_{01} \\;+\\; \\xi\\eta\\,\\mathbf{P}_{11}.\n$$\nTreat the four physical edges as the images of the lines $\\eta=0$, $\\xi=1$, $\\eta=1$, and $\\xi=0$, respectively, each traversed counterclockwise around the cell boundary. For each edge, define its outward face-normal-length vector (the area vector in two dimensions) as the line integral of the outward unit normal multiplied by the differential arc length along that edge. Starting only from fundamental geometric and calculus definitions (coordinate mapping, tangent vectors to parametric curves, unit normals in the plane, and line integrals), compute closed-form expressions for the outward face-normal-length vectors of the four edges in terms of $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$, and then compute their sum. In the context of freestream preservation on curvilinear grids, the discrete metric identity requires that this sum vanish for a closed cell.\n\nProvide the final sum as a single row vector in closed form. Express the final answer using a single $\\mathrm{pmatrix}$ row matrix. No numerical rounding is required and no physical units need be included in the final answer.",
            "solution": "The problem statement is valid. It is scientifically grounded in vector calculus and the principles of computational fluid dynamics, is well-posed, objective, and contains all necessary information for a unique solution.\n\nThe problem requires the calculation of the sum of the outward face-normal-length vectors for the four edges of a computational cell defined by a bilinear mapping. This sum is a discrete representation of the surface integral of normal vectors over a closed surface, which is fundamental to the evaluation of conservation laws.\n\nLet the physical coordinates be $\\mathbf{r}(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$ and the four corner points of the cell in physical space be $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$. Let $\\mathbf{P}_{ij} = (x_{ij}, y_{ij})$. The bilinear mapping is given by:\n$$ \\mathbf{r}(\\xi,\\eta) = (1-\\xi)(1-\\eta)\\mathbf{P}_{00} + \\xi(1-\\eta)\\mathbf{P}_{10} + (1-\\xi)\\eta\\mathbf{P}_{01} + \\xi\\eta\\mathbf{P}_{11} $$\n\nThe outward face-normal-length vector, which we shall denote as $\\mathbf{S}$, for an edge is defined by the line integral:\n$$ \\mathbf{S} = \\int_{\\text{edge}} \\mathbf{n} \\, ds $$\nwhere $\\mathbf{n}$ is the outward unit normal vector and $ds$ is the differential element of arc length.\n\nWe first derive a general expression for $\\mathbf{S}$. Let an edge be parameterized by a variable $t$, so its path is described by $\\mathbf{r}(t) = (x(t), y(t))$. The tangent vector to the path is $\\mathbf{r}'(t) = \\frac{d\\mathbf{r}}{dt} = (\\frac{dx}{dt}, \\frac{dy}{dt})$. The differential arc length is $ds = \\|\\mathbf{r}'(t)\\| \\, dt$.\n\nFor a boundary traversed in the counterclockwise direction (as specified), the outward unit normal $\\mathbf{n}$ can be obtained by rotating the unit tangent vector $\\mathbf{T} = \\frac{\\mathbf{r}'(t)}{\\|\\mathbf{r}'(t)\\|}$ clockwise by $\\frac{\\pi}{2}$ radians ($90$ degrees). If $\\mathbf{T} = (T_x, T_y)$, a clockwise rotation yields the vector $(T_y, -T_x)$. Thus, the outward unit normal is:\n$$ \\mathbf{n} = \\frac{1}{\\|\\mathbf{r}'(t)\\|} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) $$\nSubstituting the expressions for $\\mathbf{n}$ and $ds$ into the integral for $\\mathbf{S}$:\n$$ \\mathbf{S} = \\int_{t_{\\text{start}}}^{t_{\\text{end}}} \\left( \\frac{1}{\\|\\mathbf{r}'(t)\\|} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) \\right) \\big( \\|\\mathbf{r}'(t)\\| \\, dt \\big) $$\nThe term $\\|\\mathbf{r}'(t)\\|$ cancels, simplifying the integrand significantly:\n$$ \\mathbf{S} = \\int_{t_{\\text{start}}}^{t_{\\text{end}}} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) dt = \\int_{\\text{start}}^{\\text{end}} (dy, -dx) $$\nLet the starting point of the edge be $\\mathbf{P}_{\\text{start}} = (x_{\\text{start}}, y_{\\text{start}})$ and the ending point be $\\mathbf{P}_{\\text{end}} = (x_{\\text{end}}, y_{\\text{end}})$. Using the Fundamental Theorem of Calculus for each component of the vector integral:\n$$ \\mathbf{S} = \\left( \\int_{y_{\\text{start}}}^{y_{\\text{end}}} dy, -\\int_{x_{\\text{start}}}^{x_{\\text{end}}} dx \\right) = \\left( [y]_{y_{\\text{start}}}^{y_{\\text{end}}}, -[x]_{x_{\\text{start}}}^{x_{\\text{end}}} \\right) $$\n$$ \\mathbf{S} = (y_{\\text{end}} - y_{\\text{start}}, -(x_{\\text{end}} - x_{\\text{start}})) = (y_{\\text{end}} - y_{\\text{start}}, x_{\\text{start}} - x_{\\text{end}}) $$\nThis result demonstrates that the face-normal-length vector depends only on the coordinates of the edge's endpoints. The edges of the cell defined by the bilinear mapping are straight lines, so this formula is exact. We now apply it to each of the four edges, traversed counterclockwise.\n\nEdge 1 (Bottom): $\\eta=0$, $\\xi$ from $0$ to $1$.\nThe path is from $\\mathbf{r}(0,0) = \\mathbf{P}_{00}$ to $\\mathbf{r}(1,0) = \\mathbf{P}_{10}$.\n$$ \\mathbf{S}_1 = (y_{10} - y_{00}, x_{00} - x_{10}) $$\n\nEdge 2 (Right): $\\xi=1$, $\\eta$ from $0$ to $1$.\nThe path is from $\\mathbf{r}(1,0) = \\mathbf{P}_{10}$ to $\\mathbf{r}(1,1) = \\mathbf{P}_{11}$.\n$$ \\mathbf{S}_2 = (y_{11} - y_{10}, x_{10} - x_{11}) $$\n\nEdge 3 (Top): $\\eta=1$, $\\xi$ from $1$ to $0$.\nThe path is from $\\mathbf{r}(1,1) = \\mathbf{P}_{11}$ to $\\mathbf{r}(0,1) = \\mathbf{P}_{01}$.\n$$ \\mathbf{S}_3 = (y_{01} - y_{11}, x_{11} - x_{01}) $$\n\nEdge 4 (Left): $\\xi=0$, $\\eta$ from $1$ to $0$.\nThe path is from $\\mathbf{r}(0,1) = \\mathbf{P}_{01}$ to $\\mathbf{r}(0,0) = \\mathbf{P}_{00}$.\n$$ \\mathbf{S}_4 = (y_{00} - y_{01}, x_{01} - x_{00}) $$\n\nThe problem asks for the sum of these four vectors, $\\mathbf{S}_{\\text{total}} = \\mathbf{S}_1 + \\mathbf{S}_2 + \\mathbf{S}_3 + \\mathbf{S}_4$. We sum the components.\n\nThe first component (x-component) of the sum is:\n$$ S_x = (y_{10} - y_{00}) + (y_{11} - y_{10}) + (y_{01} - y_{11}) + (y_{00} - y_{01}) $$\nRearranging terms demonstrates that they cancel in pairs:\n$$ S_x = (-y_{00} + y_{00}) + (y_{10} - y_{10}) + (y_{01} - y_{01}) + (y_{11} - y_{11}) = 0 $$\n\nThe second component (y-component) of the sum is:\n$$ S_y = (x_{00} - x_{10}) + (x_{10} - x_{11}) + (x_{11} - x_{01}) + (x_{01} - x_{00}) $$\nRearranging terms similarly shows they cancel:\n$$ S_y = (x_{00} - x_{00}) + (-x_{10} + x_{10}) + (-x_{01} + x_{01}) + (-x_{11} + x_{11}) = 0 $$\n\nThus, the sum of the outward face-normal-length vectors for the closed cell is the zero vector.\n$$ \\mathbf{S}_{\\text{total}} = (0, 0) $$\nThis result, often termed the Geometric Conservation Law (GCL), is a necessary condition for a numerical scheme to preserve a uniform flow (freestream) exactly on a curvilinear grid. It is a discrete analogue of the divergence theorem identity $\\oint_S \\mathbf{n} \\, dS = \\mathbf{0}$ for a constant vector field (in this case, position-independent) over a closed surface.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from the discrete world of a single cell to the continuous domain, we find that the GCL has a direct counterpart in the mathematics of coordinate transformations. The reason a freestream is perfectly preserved in the continuous governing equations is due to the exact cancellation of terms, a result of the equality of mixed partial derivatives for any smooth mapping. This analytical exercise asks you to verify this principle for a specific, non-trivial curvilinear coordinate system . By working through the calculus, you will see precisely how the metric identities, such as $\\frac{\\partial^2 y}{\\partial \\xi \\partial \\eta} = \\frac{\\partial^2 y}{\\partial \\eta \\partial \\xi}$, ensure that no artificial sources are generated by the grid curvature itself.",
            "id": "3961213",
            "problem": "Consider a smooth two-dimensional coordinate mapping from computational space $(\\xi,\\eta)$ to physical space $(x,y)$ defined by $x(\\xi,\\eta)=\\xi+\\epsilon\\sin\\xi\\sin\\eta$ and $y(\\xi,\\eta)=\\eta+\\epsilon\\sin\\xi\\sin\\eta$, where $\\epsilon$ is a small, dimensionless parameter with $|\\epsilon|\\ll 1$. In the context of Computational Fluid Dynamics (CFD) on curvilinear grids, freestream preservation requires certain metric identities to hold for the coordinate transformation.\n\nUsing only fundamental definitions from continuum mechanics and differential geometry of mappings, let the Jacobian be defined by $J=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$, and the contravariant metric coefficients be defined by the inverse of the Jacobian matrix, so that\n$$\n\\xi_{x}=\\frac{y_{\\eta}}{J},\\quad \\xi_{y}=-\\frac{x_{\\eta}}{J},\\quad \\eta_{x}=-\\frac{y_{\\xi}}{J},\\quad \\eta_{y}=\\frac{x_{\\xi}}{J}.\n$$\nConsequently, the adjugate components $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ are given by\n$$\nJ\\,\\xi_{x}=y_{\\eta},\\quad J\\,\\xi_{y}=-x_{\\eta},\\quad J\\,\\eta_{x}=-y_{\\xi},\\quad J\\,\\eta_{y}=x_{\\xi}.\n$$\n\nTask:\n1. Compute $x_{\\xi}$, $x_{\\eta}$, $y_{\\xi}$, $y_{\\eta}$, the Jacobian $J$, and then $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ to first order in $\\epsilon$.\n2. Using these results, analytically evaluate the scalar quantity\n$$\nD=\\frac{\\partial}{\\partial \\xi}\\!\\left(J\\,\\xi_{x}\\right)+\\frac{\\partial}{\\partial \\eta}\\!\\left(J\\,\\eta_{x}\\right)\n$$\nto first order in $\\epsilon$ and confirm the metric identity associated with freestream preservation on curvilinear grids.\n\nAnswer specification:\n- Provide your final answer as a single closed-form analytic expression for $D$ to first order in $\\epsilon$.\n- No rounding is required.\n- This quantity is dimensionless; do not include units in the final boxed expression.",
            "solution": "We begin from the given smooth mapping $x(\\xi,\\eta)=\\xi+\\epsilon\\sin\\xi\\sin\\eta$ and $y(\\xi,\\eta)=\\eta+\\epsilon\\sin\\xi\\sin\\eta$. All derivatives are taken with respect to the computational coordinates $(\\xi,\\eta)$, and we work consistently to first order in the small parameter $\\epsilon$.\n\nStep 1: Compute the first derivatives of the mapping.\nThe partial derivatives are\n$$\nx_{\\xi}=\\frac{\\partial x}{\\partial \\xi}=1+\\epsilon\\frac{\\partial}{\\partial \\xi}\\left(\\sin\\xi\\sin\\eta\\right)=1+\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\nx_{\\eta}=\\frac{\\partial x}{\\partial \\eta}=\\epsilon\\frac{\\partial}{\\partial \\eta}\\left(\\sin\\xi\\sin\\eta\\right)=\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\ny_{\\xi}=\\frac{\\partial y}{\\partial \\xi}=\\epsilon\\frac{\\partial}{\\partial \\xi}\\left(\\sin\\xi\\sin\\eta\\right)=\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\ny_{\\eta}=\\frac{\\partial y}{\\partial \\eta}=1+\\epsilon\\frac{\\partial}{\\partial \\eta}\\left(\\sin\\xi\\sin\\eta\\right)=1+\\epsilon\\sin\\xi\\cos\\eta.\n$$\n\nStep 2: Compute the Jacobian $J=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$ to first order in $\\epsilon$.\nWe have\n$$\nJ=\\left(1+\\epsilon\\cos\\xi\\sin\\eta\\right)\\left(1+\\epsilon\\sin\\xi\\cos\\eta\\right)-\\left(\\epsilon\\sin\\xi\\cos\\eta\\right)\\left(\\epsilon\\cos\\xi\\sin\\eta\\right).\n$$\nExpanding in $\\epsilon$ and retaining terms up to first order,\n$$\nJ=1+\\epsilon\\cos\\xi\\sin\\eta+\\epsilon\\sin\\xi\\cos\\eta+\\mathcal{O}(\\epsilon^{2})=1+\\epsilon\\left(\\cos\\xi\\sin\\eta+\\sin\\xi\\cos\\eta\\right)+\\mathcal{O}(\\epsilon^{2}).\n$$\nUsing the trigonometric identity $\\sin(\\xi+\\eta)=\\sin\\xi\\cos\\eta+\\cos\\xi\\sin\\eta$, we can write\n$$\nJ=1+\\epsilon\\sin(\\xi+\\eta)+\\mathcal{O}(\\epsilon^{2}).\n$$\n\nStep 3: Compute the adjugate components $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ to first order in $\\epsilon$.\nBy the adjugate relations,\n$$\nJ\\,\\xi_{x}=y_{\\eta}=1+\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\nJ\\,\\xi_{y}=-x_{\\eta}=-\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\nJ\\,\\eta_{x}=-y_{\\xi}=-\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\nJ\\,\\eta_{y}=x_{\\xi}=1+\\epsilon\\cos\\xi\\sin\\eta.\n$$\nThese are already first-order accurate in $\\epsilon$.\n\nStep 4: Evaluate the scalar quantity $D=\\partial_{\\xi}(J\\,\\xi_{x})+\\partial_{\\eta}(J\\,\\eta_{x})$ to first order in $\\epsilon$.\nUsing the expressions above,\n$$\n\\frac{\\partial}{\\partial \\xi}\\left(J\\,\\xi_{x}\\right)=\\frac{\\partial}{\\partial \\xi}\\left(1+\\epsilon\\sin\\xi\\cos\\eta\\right)=\\epsilon\\cos\\xi\\cos\\eta,\n$$\nand\n$$\n\\frac{\\partial}{\\partial \\eta}\\left(J\\,\\eta_{x}\\right)=\\frac{\\partial}{\\partial \\eta}\\left(-\\epsilon\\cos\\xi\\sin\\eta\\right)=-\\epsilon\\cos\\xi\\cos\\eta.\n$$\nTherefore,\n$$\nD=\\epsilon\\cos\\xi\\cos\\eta-\\epsilon\\cos\\xi\\cos\\eta=0.\n$$\n\nInterpretation and identity:\nThe vanishing of $D$ is not accidental; it is a manifestation of the metric identity that ensures freestream preservation on curvilinear grids. More generally, using the adjugate relationships $J\\,\\xi_{x}=y_{\\eta}$ and $J\\,\\eta_{x}=-y_{\\xi}$, we observe\n$$\nD=\\frac{\\partial y_{\\eta}}{\\partial \\xi}-\\frac{\\partial y_{\\xi}}{\\partial \\eta}=y_{\\eta\\xi}-y_{\\xi\\eta}=0,\n$$\nwhich holds exactly for any sufficiently smooth mapping due to the equality of mixed partial derivatives. Our explicit computation to first order in $\\epsilon$ confirms this identity for the given sinusoidally perturbed mapping.\n\nThus, to first order in $\\epsilon$, the scalar quantity $D$ is zero, validating the metric identity associated with freestream preservation in this case.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "This final practice bridges theory and application, demonstrating the profound numerical consequences of respecting the Geometric Conservation Law in a full CFD simulation. While the continuous equations and consistent discrete schemes preserve a freestream naturally, an improperly designed numerical method can introduce significant errors, even in a uniform flow. This computational exercise tasks you with implementing and comparing two schemes for the compressible Euler equations: one that is \"consistent\" and respects the discrete metric identities, and one that is \"inconsistent\" and violates them . By observing the dramatic difference in the computed residuals, you will gain a practical appreciation for why freestream preservation is a critical validation test for any CFD solver.",
            "id": "3961220",
            "problem": "You are to implement a manufactured solution test for freestream preservation on two-dimensional curvilinear grids in Computational Fluid Dynamics (CFD). The goal is to verify, from first principles, that a constant state of the compressible Euler equations produces a discrete residual equal to numerical round-off (machine zero) when the discrete metric identities are preserved by consistent differencing. Conversely, you will demonstrate loss of freestream preservation when the divergence operator is inconsistent with the operator used to compute the grid metrics.\n\nBase the derivation on the following fundamental laws and core definitions:\n- The two-dimensional compressible Euler equations in conservation form transform under a smooth mapping from physical space variables $(x,y)$ to computational space variables $(\\xi,\\eta)$ as\n$$\n\\frac{\\partial}{\\partial t}\\left(J \\mathbf{U}\\right) + \\frac{\\partial}{\\partial \\xi} \\left(\\widehat{\\mathbf{F}}\\right) + \\frac{\\partial}{\\partial \\eta} \\left(\\widehat{\\mathbf{G}}\\right) = \\mathbf{0},\n$$\nwhere $J$ is the Jacobian determinant of the mapping, $\\mathbf{U}$ is the vector of conserved variables, and $\\widehat{\\mathbf{F}}, \\widehat{\\mathbf{G}}$ are the contravariant fluxes.\n- The contravariant fluxes can be written using the metric identity vectors\n$$\n\\mathbf{a}^{1} = \\left(y_{\\eta},\\, -x_{\\eta}\\right), \\quad \\mathbf{a}^{2} = \\left(-y_{\\xi},\\, x_{\\xi}\\right),\n$$\nas\n$$\n\\widehat{\\mathbf{F}} = y_{\\eta}\\,\\mathbf{F} - x_{\\eta}\\,\\mathbf{G}, \\quad \\widehat{\\mathbf{G}} = -y_{\\xi}\\,\\mathbf{F} + x_{\\xi}\\,\\mathbf{G},\n$$\nwhere $\\mathbf{F}$ and $\\mathbf{G}$ are the physical fluxes in the $x$ and $y$ directions.\n- The metric identities imply\n$$\n\\frac{\\partial \\mathbf{a}^{1}}{\\partial \\xi} + \\frac{\\partial \\mathbf{a}^{2}}{\\partial \\eta} = \\mathbf{0}.\n$$\n- For a constant state $\\mathbf{U}=\\text{const}$, the physical fluxes $\\mathbf{F}, \\mathbf{G}$ are constant, so the continuous residual reduces to the divergence of metric-weighted constants, which vanishes if the metric identities hold.\n\nYou must use a periodic, logically rectangular grid defined by a smooth mapping\n$$\nx(\\xi,\\eta) = \\xi + \\alpha \\sin\\!\\left(2\\pi \\xi\\right)\\sin\\!\\left(2\\pi \\eta\\right), \\quad\ny(\\xi,\\eta) = \\eta + \\beta \\sin\\!\\left(2\\pi \\xi\\right)\\sin\\!\\left(2\\pi \\eta\\right),\n$$\nwith $\\xi,\\eta \\in [0,1)$ and integer grid resolution $N \\times N$ with periodic wraparound. All quantities are nondimensional; no physical units are required.\n\nImplement the following discrete operators and states:\n- Use second-order central differences with periodic wraparound to approximate $\\partial/\\partial \\xi$ and $\\partial/\\partial \\eta$ when computing grid metrics $x_{\\xi}, x_{\\eta}, y_{\\xi}, y_{\\eta}$.\n- Construct the contravariant fluxes $\\widehat{\\mathbf{F}}, \\widehat{\\mathbf{G}}$ from the metric terms and the constant physical fluxes of the compressible Euler equations.\n- For the “consistent” scheme, compute the divergence of the contravariant fluxes using the same central-difference operators used for the metrics.\n- For the “inconsistent” scheme, compute the divergence using one-sided differences (forward in $\\xi$ and backward in $\\eta$), while still computing the metrics using central differences.\n\nDefine the constant state as follows: take a constant density $\\rho = 1$, velocities $u = 0.5$, $v = -0.2$, pressure $p = 1$, and ratio of specific heats $\\gamma = 1.4$. Compute the total energy per unit volume $\\rho E = \\dfrac{p}{\\gamma - 1} + \\dfrac{1}{2}\\rho\\left(u^{2}+v^{2}\\right)$, and from this the conserved vector $\\mathbf{U} = \\left[\\rho,\\, \\rho u,\\, \\rho v,\\, \\rho E\\right]^{\\top}$. The physical fluxes are\n$$\n\\mathbf{F} = \\begin{bmatrix}\n\\rho u\\\\\n\\rho u^{2} + p\\\\\n\\rho u v\\\\\nu(\\rho E + p)\n\\end{bmatrix}, \\quad\n\\mathbf{G} = \\begin{bmatrix}\n\\rho v\\\\\n\\rho u v\\\\\n\\rho v^{2} + p\\\\\nv(\\rho E + p)\n\\end{bmatrix}.\n$$\n\nYour program must compute the discrete residual\n$$\n\\mathcal{R} = D_{\\xi}\\left(\\widehat{\\mathbf{F}}\\right) + D_{\\eta}\\left(\\widehat{\\mathbf{G}}\\right),\n$$\napplied componentwise to each conserved quantity at all grid points, where $D_{\\xi}, D_{\\eta}$ denote the chosen discrete derivative operators. Report, for each test case, the maximum absolute value over all grid points and all conserved variables:\n$$\n\\left\\|\\mathcal{R}\\right\\|_{\\infty} = \\max_{i,j,q} \\left| \\mathcal{R}_{q}(i,j) \\right|.\n$$\n\nTest suite and required outputs:\n- Implement the following four test cases as a fixed test suite inside your program. Each case is specified by the tuple $\\left(N, \\alpha, \\beta, \\text{scheme}\\right)$:\n    - Case $1$: $\\left(N=64,\\, \\alpha=0.2,\\, \\beta=0.1,\\, \\text{scheme}=\\text{consistent}\\right)$.\n    - Case $2$: $\\left(N=64,\\, \\alpha=0.2,\\, \\beta=0.1,\\, \\text{scheme}=\\text{inconsistent}\\right)$.\n    - Case $3$: $\\left(N=32,\\, \\alpha=0.0,\\, \\beta=0.0,\\, \\text{scheme}=\\text{inconsistent}\\right)$.\n    - Case $4$: $\\left(N=50,\\, \\alpha=0.12,\\, \\beta=0.22,\\, \\text{scheme}=\\text{consistent}\\right)$.\n- For each case, compute the single float $\\left\\|\\mathcal{R}\\right\\|_{\\infty}$ as defined above.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\left[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3},\\text{result}_{4}\\right]$). All outputs are nondimensional real numbers.\n\nConstraints and scientific realism:\n- Use periodic boundary conditions consistently for all discrete derivatives.\n- Ensure that the same discrete operators applied in metric evaluation are also used in the divergence for the “consistent” scheme to test geometric conservation and metric identity preservation.\n- Use only algebraically defined operations; do not use any external file input or randomness. The results should be reproducible exactly given double-precision arithmetic.",
            "solution": "The problem statement is a valid and well-posed numerical verification exercise from the field of Computational Fluid Dynamics (CFD). It is scientifically grounded in the principles of continuum mechanics and numerical analysis, specifically concerning the discretization of the compressible Euler equations on curvilinear coordinate systems. All necessary data, equations, and boundary conditions are provided, and no contradictions or ambiguities are present.\n\nThe core principle being tested is that of **freestream preservation**, which is a direct consequence of the **Geometric Conservation Law (GCL)**. A numerical scheme for solving the Euler equations is said to preserve the freestream if it can maintain a uniform flow field (constant density $\\rho$, velocity components $u$ and $v$, and pressure $p$) exactly, to the level of machine precision. This is a fundamental requirement for any reliable CFD solver, as it ensures that no spurious, non-physical sources or sinks are introduced by the grid's curvature or the discretization process itself.\n\nWe begin with the two-dimensional compressible Euler equations in conservative form, transformed from physical coordinates $(x,y)$ to computational coordinates $(\\xi,\\eta)$:\n$$\n\\frac{\\partial}{\\partial t}\\left(J \\mathbf{U}\\right) + \\frac{\\partial}{\\partial \\xi} \\left(\\widehat{\\mathbf{F}}\\right) + \\frac{\\partial}{\\partial \\eta} \\left(\\widehat{\\mathbf{G}}\\right) = \\mathbf{0}\n$$\nHere, $\\mathbf{U} = \\left[\\rho, \\rho u, \\rho v, \\rho E\\right]^{\\top}$ is the vector of conserved variables, and $\\widehat{\\mathbf{F}}$ and $\\widehat{\\mathbf{G}}$ are the contravariant flux vectors. They are related to the physical Cartesian fluxes $\\mathbf{F}$ and $\\mathbf{G}$ through the transformation metrics:\n$$\n\\widehat{\\mathbf{F}} = y_{\\eta}\\,\\mathbf{F} - x_{\\eta}\\,\\mathbf{G}\n$$\n$$\n\\widehat{\\mathbf{G}} = -y_{\\xi}\\,\\mathbf{F} + x_{\\xi}\\,\\mathbf{G}\n$$\nwhere $x_{\\xi} = \\frac{\\partial x}{\\partial \\xi}$, $y_{\\eta} = \\frac{\\partial y}{\\partial \\eta}$, and so on.\n\nFor a steady, uniform freestream, the state vector $\\mathbf{U}$ is constant throughout the domain. Consequently, the physical fluxes $\\mathbf{F}(\\mathbf{U})$ and $\\mathbf{G}(\\mathbf{U})$ are also constant vectors. The steady-state residual of the transformed Euler equations is then:\n$$\n\\mathcal{R}_c = \\frac{\\partial}{\\partial \\xi} \\left(\\widehat{\\mathbf{F}}\\right) + \\frac{\\partial}{\\partial \\eta} \\left(\\widehat{\\mathbf{G}}\\right) = \\frac{\\partial}{\\partial \\xi} \\left(y_{\\eta}\\,\\mathbf{F} - x_{\\eta}\\,\\mathbf{G}\\right) + \\frac{\\partial}{\\partial \\eta} \\left(-y_{\\xi}\\,\\mathbf{F} + x_{\\xi}\\,\\mathbf{G}\\right)\n$$\nSince $\\mathbf{F}$ and $\\mathbf{G}$ are constant, we can apply the product rule and rearrange:\n$$\n\\mathcal{R}_c = \\left( \\frac{\\partial y_{\\eta}}{\\partial \\xi} - \\frac{\\partial y_{\\xi}}{\\partial \\eta} \\right) \\mathbf{F} + \\left( \\frac{\\partial x_{\\xi}}{\\partial \\eta} - \\frac{\\partial x_{\\eta}}{\\partial \\xi} \\right) \\mathbf{G}\n$$\nFor any smooth coordinate transformation $x(\\xi, \\eta), y(\\xi, \\eta)$, the order of differentiation does not matter (Clairaut's Theorem on equality of mixed partials), which implies:\n$$\n\\frac{\\partial^2 y}{\\partial \\xi \\partial \\eta} = \\frac{\\partial^2 y}{\\partial \\eta \\partial \\xi} \\implies \\frac{\\partial y_{\\eta}}{\\partial \\xi} = \\frac{\\partial y_{\\xi}}{\\partial \\eta}\n$$\n$$\n\\frac{\\partial^2 x}{\\partial \\eta \\partial \\xi} = \\frac{\\partial^2 x}{\\partial \\xi \\partial \\eta} \\implies \\frac{\\partial x_{\\xi}}{\\partial \\eta} = \\frac{\\partial x_{\\eta}}{\\partial \\xi}\n$$\nThese are the **metric identities**. Substituting them into the residual expression shows that $\\mathcal{R}_c = \\mathbf{0}$. This confirms that a uniform freestream is an exact solution to the continuous transformed equations.\n\nThe central challenge arises in the discrete domain. Let $D_{\\xi}$ and $D_{\\eta}$ be the discrete operators approximating the partial derivatives in the flux divergence term, and let $d_{\\xi}$ and $d_{\\eta}$ be the discrete operators used to compute the grid metrics. The discrete steady-state residual at a grid point $(i,j)$ is:\n$$\n\\mathcal{R}_{ij} = D_{\\xi}(\\widehat{\\mathbf{F}}_{ij}) + D_{\\eta}(\\widehat{\\mathbf{G}}_{ij})\n$$\nSubstituting the expressions for the discrete fluxes, computed with metrics derived from operators $d_{\\xi}$ and $d_{\\eta}$, we have:\n$$\n\\mathcal{R}_{ij} = D_{\\xi}\\left( (d_{\\eta}y)_{ij}\\,\\mathbf{F} - (d_{\\eta}x)_{ij}\\,\\mathbf{G} \\right) + D_{\\eta}\\left( -(d_{\\xi}y)_{ij}\\,\\mathbf{F} + (d_{\\xi}x)_{ij}\\,\\mathbf{G} \\right)\n$$\nSince $\\mathbf{F}$ and $\\mathbf{G}$ are still constant vectors, this simplifies to:\n$$\n\\mathcal{R}_{ij} = \\left[ D_{\\xi}((d_{\\eta}y)_{ij}) - D_{\\eta}((d_{\\xi}y)_{ij}) \\right] \\mathbf{F} + \\left[ D_{\\eta}((d_{\\xi}x)_{ij}) - D_{\\xi}((d_{\\eta}x)_{ij}) \\right] \\mathbf{G}\n$$\nFor the residual $\\mathcal{R}_{ij}$ to be zero, the terms in the square brackets must vanish. This is the **discrete Geometric Conservation Law (GCL)**:\n$$\nD_{\\xi}(d_{\\eta}y) - D_{\\eta}(d_{\\xi}y) = 0 \\quad \\text{and} \\quad D_{\\eta}(d_{\\xi}x) - D_{\\xi}(d_{\\eta}x) = 0\n$$\nThis law is satisfied if the discrete operators are chosen consistently, i.e., $D_{\\xi} = d_{\\xi}$ and $D_{\\eta} = d_{\\eta}$, and the operators possess a telescoping property, as centered differences do. If the operators are inconsistent (e.g., metrics are computed with central differences, $d_{\\xi, \\eta}$, while the divergence is computed with one-sided differences, $D_{\\xi, \\eta}$), the GCL is violated, and the residual $\\mathcal{R}_{ij}$ will be non-zero, proportional to the truncation error of the GCL expression. This manifest as a freestream preservation error.\n\nThe implementation will proceed as follows:\n1.  For each test case, generate the $N \\times N$ periodic grid coordinates $(x_{ij}, y_{ij})$ from the given mapping functions. The computational grid spacing is $\\Delta\\xi = \\Delta\\eta = 1/N$.\n2.  Define the constant freestream state. Given $\\rho = 1$, $u = 0.5$, $v = -0.2$, $p = 1$, and $\\gamma = 1.4$. The total energy per unit volume is $\\rho E = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho(u^2 + v^2)$. The constant physical flux vectors $\\mathbf{F}$ and $\\mathbf{G}$ are then computed.\n3.  Compute the grid metric terms arrays $(x_{\\xi})_{ij}, (x_{\\eta})_{ij}, (y_{\\xi})_{ij}, (y_{\\eta})_{ij}$ using second-order periodic central differences for all cases.\n    $$\n    (d_{\\xi}f)_{ij} = \\frac{f_{i+1,j} - f_{i-1,j}}{2 \\Delta\\xi}, \\quad (d_{\\eta}f)_{ij} = \\frac{f_{i,j+1} - f_{i,j-1}}{2 \\Delta\\eta}\n    $$\n4.  Compute the contravariant flux arrays $\\widehat{\\mathbf{F}}_{ij}$ and $\\widehat{\\mathbf{G}}_{ij}$ by combining the metric arrays with the constant $\\mathbf{F}$ and $\\mathbf{G}$ vectors.\n5.  Compute the discrete residual $\\mathcal{R}_{ij}$ based on the scheme type:\n    -   **Consistent scheme**: Use the same central difference operators for $D_{\\xi}$ and $D_{\\eta}$.\n    -   **Inconsistent scheme**: Use a periodic forward difference for $D_{\\xi}$ and a periodic backward difference for $D_{\\eta}$.\n        $$\n        (D_{\\xi}f)_{ij} = \\frac{f_{i+1,j} - f_{ij}}{\\Delta\\xi}, \\quad (D_{\\eta}f)_{ij} = \\frac{f_{ij} - f_{i,j-1}}{\\Delta\\eta}\n        $$\n6.  Calculate the infinity norm of the residual, $\\left\\|\\mathcal{R}\\right\\|_{\\infty} = \\max_{i,j,q} \\left| \\mathcal{R}_{q}(i,j) \\right|$, which is the maximum absolute value over all grid points and all four conserved variables.\n\nA special case is the Cartesian grid ($\\alpha = 0, \\beta = 0$), where $x_{ij}=\\xi_i$ and $y_{ij}=\\eta_j$. Here, the metrics are constant: $(x_{\\xi})_{ij}=1, (y_{\\eta})_{ij}=1, (x_{\\eta})_{ij}=0, (y_{\\xi})_{ij}=0$. This leads to $\\widehat{\\mathbf{F}}_{ij}=\\mathbf{F}$ and $\\widehat{\\mathbf{G}}_{ij}=\\mathbf{G}$. Since the contravariant fluxes themselves are constant fields, any consistent differencing scheme (central, forward, or backward) will yield a zero derivative. Thus, even the \"inconsistent\" scheme will preserve the freestream in this specific scenario, as the GCL violation term is multiplied by zero-valued metric derivatives. This is verified in Case 3.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a manufactured solution test for freestream preservation\n    on two-dimensional curvilinear grids in Computational Fluid Dynamics (CFD).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (64, 0.2, 0.1, 'consistent'),\n        (64, 0.2, 0.1, 'inconsistent'),\n        (32, 0.0, 0.0, 'inconsistent'),\n        (50, 0.12, 0.22, 'consistent'),\n    ]\n\n    # Freestream state parameters\n    rho = 1.0\n    u = 0.5\n    v = -0.2\n    p = 1.0\n    gamma = 1.4\n\n    # Compute derived quantities for the freestream state\n    rho_u = rho * u\n    rho_v = rho * v\n    rho_E = p / (gamma - 1.0) + 0.5 * rho * (u**2 + v**2)\n    u_h = rho_E + p # Specific enthalpy u(rho_E+p) uses u, not rho_u\n\n    # Construct the constant physical flux vectors F and G\n    F = np.array([\n        rho_u,\n        rho_u * u + p,\n        rho_u * v,\n        u * (rho_E + p)\n    ])\n\n    G = np.array([\n        rho_v,\n        rho_v * u,\n        rho_v * v + p,\n        v * (rho_E + p)\n    ])\n\n    results = []\n    for N, alpha, beta, scheme in test_cases:\n        # 1. Grid Generation\n        # Computational coordinates xi, eta in [0, 1)\n        xi_1d = np.linspace(0.0, 1.0, N, endpoint=False)\n        eta_1d = np.linspace(0.0, 1.0, N, endpoint=False)\n        # Meshgrid indexing 'ij' ensures that the first index corresponds to xi\n        XI, ETA = np.meshgrid(xi_1d, eta_1d, indexing='ij')\n\n        # Physical coordinates x, y\n        common_term = np.sin(2.0 * np.pi * XI) * np.sin(2.0 * np.pi * ETA)\n        X = XI + alpha * common_term\n        Y = ETA + beta * common_term\n\n        # Grid spacing\n        delta_xi = 1.0 / N\n        delta_eta = 1.0 / N\n\n        # 2. Metric Computation (Second-Order Central Differences)\n        # Use np.roll for periodic boundary conditions\n        # d/dxi ~ (f_{i+1} - f_{i-1}) / (2 * delta_xi)\n        x_xi = (np.roll(X, -1, axis=0) - np.roll(X, 1, axis=0)) / (2.0 * delta_xi)\n        y_xi = (np.roll(Y, -1, axis=0) - np.roll(Y, 1, axis=0)) / (2.0 * delta_xi)\n        \n        # d/deta ~ (f_{j+1} - f_{j-1}) / (2 * delta_eta)\n        x_eta = (np.roll(X, -1, axis=1) - np.roll(X, 1, axis=1)) / (2.0 * delta_eta)\n        y_eta = (np.roll(Y, -1, axis=1) - np.roll(Y, 1, axis=1)) / (2.0 * delta_eta)\n\n        # 3. Contravariant Flux Computation\n        # F_hat = y_eta * F - x_eta * G\n        # G_hat = -y_xi * F + x_xi * G\n        # Use broadcasting to multiply (N, N) metric arrays with (4,) flux vectors\n        # Resulting flux arrays have shape (N, N, 4)\n        F_hat = y_eta[..., np.newaxis] * F - x_eta[..., np.newaxis] * G\n        G_hat = -y_xi[..., np.newaxis] * F + x_xi[..., np.newaxis] * G\n\n        # 4. Residual Calculation\n        if scheme == 'consistent':\n            # Central differences for divergence (same as for metrics)\n            dF_hat_dxi = (np.roll(F_hat, -1, axis=0) - np.roll(F_hat, 1, axis=0)) / (2.0 * delta_xi)\n            dG_hat_deta = (np.roll(G_hat, -1, axis=1) - np.roll(G_hat, 1, axis=1)) / (2.0 * delta_eta)\n        elif scheme == 'inconsistent':\n            # Forward difference in xi, backward difference in eta\n            dF_hat_dxi = (np.roll(F_hat, -1, axis=0) - F_hat) / delta_xi\n            dG_hat_deta = (G_hat - np.roll(G_hat, 1, axis=1)) / delta_eta\n        else:\n            raise ValueError(\"Unknown scheme type\")\n            \n        Residual = dF_hat_dxi + dG_hat_deta\n\n        # 5. Norm Calculation\n        # max absolute value over all grid points and all 4 conserved variables\n        inf_norm = np.max(np.abs(Residual))\n        results.append(inf_norm)\n\n    # Final print statement in the exact required format.\n    # Convert results to string with sufficient precision\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}