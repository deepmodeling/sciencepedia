{
    "hands_on_practices": [
        {
            "introduction": "The principle of freestream preservation is fundamentally geometric, rooted in the properties of a single computational cell. This exercise takes you back to first principles by asking you to verify a discrete form of the divergence theorem for a closed cell . By explicitly calculating the outward-pointing area vectors and showing that their sum is zero, you will prove a foundational requirement of the Geometric Conservation Law (GCL) from the ground up using basic vector calculus.",
            "id": "3961207",
            "problem": "Consider a single four-sided computational cell in the context of Aerospace Computational Fluid Dynamics (CFD), parameterized by computational coordinates $(\\xi,\\eta) \\in [0,1] \\times [0,1]$. The physical coordinates $\\mathbf{r}(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$ are given by a bilinear mapping of the four corner points $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$ in $\\mathbb{R}^2$:\n$$\n\\mathbf{r}(\\xi,\\eta) = (1-\\xi)(1-\\eta)\\,\\mathbf{P}_{00} \\;+\\; \\xi(1-\\eta)\\,\\mathbf{P}_{10} \\;+\\; (1-\\xi)\\eta\\,\\mathbf{P}_{01} \\;+\\; \\xi\\eta\\,\\mathbf{P}_{11}.\n$$\nTreat the four physical edges as the images of the lines $\\eta=0$, $\\xi=1$, $\\eta=1$, and $\\xi=0$, respectively, each traversed counterclockwise around the cell boundary. For each edge, define its outward face-normal-length vector (the area vector in two dimensions) as the line integral of the outward unit normal multiplied by the differential arc length along that edge. Starting only from fundamental geometric and calculus definitions (coordinate mapping, tangent vectors to parametric curves, unit normals in the plane, and line integrals), compute closed-form expressions for the outward face-normal-length vectors of the four edges in terms of $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$, and then compute their sum. In the context of freestream preservation on curvilinear grids, the discrete metric identity requires that this sum vanish for a closed cell.\n\nProvide the final sum as a single row vector in closed form. Express the final answer using a single $\\mathrm{pmatrix}$ row matrix. No numerical rounding is required and no physical units need be included in the final answer.",
            "solution": "The problem statement is valid. It is scientifically grounded in vector calculus and the principles of computational fluid dynamics, is well-posed, objective, and contains all necessary information for a unique solution.\n\nThe problem requires the calculation of the sum of the outward face-normal-length vectors for the four edges of a computational cell defined by a bilinear mapping. This sum is a discrete representation of the surface integral of normal vectors over a closed surface, which is fundamental to the evaluation of conservation laws.\n\nLet the physical coordinates be $\\mathbf{r}(\\xi,\\eta) = (x(\\xi,\\eta), y(\\xi,\\eta))$ and the four corner points of the cell in physical space be $\\mathbf{P}_{00}$, $\\mathbf{P}_{10}$, $\\mathbf{P}_{01}$, and $\\mathbf{P}_{11}$. Let $\\mathbf{P}_{ij} = (x_{ij}, y_{ij})$. The bilinear mapping is given by:\n$$ \\mathbf{r}(\\xi,\\eta) = (1-\\xi)(1-\\eta)\\mathbf{P}_{00} + \\xi(1-\\eta)\\mathbf{P}_{10} + (1-\\xi)\\eta\\mathbf{P}_{01} + \\xi\\eta\\mathbf{P}_{11} $$\n\nThe outward face-normal-length vector, which we shall denote as $\\mathbf{S}$, for an edge is defined by the line integral:\n$$ \\mathbf{S} = \\int_{\\text{edge}} \\mathbf{n} \\, ds $$\nwhere $\\mathbf{n}$ is the outward unit normal vector and $ds$ is the differential element of arc length.\n\nWe first derive a general expression for $\\mathbf{S}$. Let an edge be parameterized by a variable $t$, so its path is described by $\\mathbf{r}(t) = (x(t), y(t))$. The tangent vector to the path is $\\mathbf{r}'(t) = \\frac{d\\mathbf{r}}{dt} = (\\frac{dx}{dt}, \\frac{dy}{dt})$. The differential arc length is $ds = ||\\mathbf{r}'(t)|| \\, dt$.\n\nFor a boundary traversed in the counterclockwise direction (as specified), the outward unit normal $\\mathbf{n}$ can be obtained by rotating the unit tangent vector $\\mathbf{T} = \\frac{\\mathbf{r}'(t)}{||\\mathbf{r}'(t)||}$ clockwise by $\\frac{\\pi}{2}$ radians ($90$ degrees). If $\\mathbf{T} = (T_x, T_y)$, a clockwise rotation yields the vector $(T_y, -T_x)$. Thus, the outward unit normal is:\n$$ \\mathbf{n} = \\frac{1}{||\\mathbf{r}'(t)||} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) $$\nSubstituting the expressions for $\\mathbf{n}$ and $ds$ into the integral for $\\mathbf{S}$:\n$$ \\mathbf{S} = \\int_{t_{\\text{start}}}^{t_{\\text{end}}} \\left( \\frac{1}{||\\mathbf{r}'(t)||} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) \\right) \\big( ||\\mathbf{r}'(t)|| \\, dt \\big) $$\nThe term $||\\mathbf{r}'(t)||$ cancels, simplifying the integrand significantly:\n$$ \\mathbf{S} = \\int_{t_{\\text{start}}}^{t_{\\text{end}}} \\left(\\frac{dy}{dt}, -\\frac{dx}{dt}\\right) dt = \\int_{\\text{start}}^{\\text{end}} (dy, -dx) $$\nLet the starting point of the edge be $\\mathbf{P}_{\\text{start}} = (x_{\\text{start}}, y_{\\text{start}})$ and the ending point be $\\mathbf{P}_{\\text{end}} = (x_{\\text{end}}, y_{\\text{end}})$. Using the Fundamental Theorem of Calculus for each component of the vector integral:\n$$ \\mathbf{S} = \\left( \\int_{y_{\\text{start}}}^{y_{\\text{end}}} dy, -\\int_{x_{\\text{start}}}^{x_{\\text{end}}} dx \\right) = \\left( [y]_{y_{\\text{start}}}^{y_{\\text{end}}}, -[x]_{x_{\\text{start}}}^{x_{\\text{end}}} \\right) $$\n$$ \\mathbf{S} = (y_{\\text{end}} - y_{\\text{start}}, -(x_{\\text{end}} - x_{\\text{start}})) = (y_{\\text{end}} - y_{\\text{start}}, x_{\\text{start}} - x_{\\text{end}}) $$\nThis result demonstrates that the face-normal-length vector depends only on the coordinates of the edge's endpoints. The edges of the cell defined by the bilinear mapping are straight lines, so this formula is exact. We now apply it to each of the four edges, traversed counterclockwise.\n\nEdge 1 (Bottom): $\\eta=0$, $\\xi$ from $0$ to $1$.\nThe path is from $\\mathbf{r}(0,0) = \\mathbf{P}_{00}$ to $\\mathbf{r}(1,0) = \\mathbf{P}_{10}$.\n$$ \\mathbf{S}_1 = (y_{10} - y_{00}, x_{00} - x_{10}) $$\n\nEdge 2 (Right): $\\xi=1$, $\\eta$ from $0$ to $1$.\nThe path is from $\\mathbf{r}(1,0) = \\mathbf{P}_{10}$ to $\\mathbf{r}(1,1) = \\mathbf{P}_{11}$.\n$$ \\mathbf{S}_2 = (y_{11} - y_{10}, x_{10} - x_{11}) $$\n\nEdge 3 (Top): $\\eta=1$, $\\xi$ from $1$ to $0$.\nThe path is from $\\mathbf{r}(1,1) = \\mathbf{P}_{11}$ to $\\mathbf{r}(0,1) = \\mathbf{P}_{01}$.\n$$ \\mathbf{S}_3 = (y_{01} - y_{11}, x_{11} - x_{01}) $$\n\nEdge 4 (Left): $\\xi=0$, $\\eta$ from $1$ to $0$.\nThe path is from $\\mathbf{r}(0,1) = \\mathbf{P}_{01}$ to $\\mathbf{r}(0,0) = \\mathbf{P}_{00}$.\n$$ \\mathbf{S}_4 = (y_{00} - y_{01}, x_{01} - x_{00}) $$\n\nThe problem asks for the sum of these four vectors, $\\mathbf{S}_{\\text{total}} = \\mathbf{S}_1 + \\mathbf{S}_2 + \\mathbf{S}_3 + \\mathbf{S}_4$. We sum the components.\n\nThe first component of the sum is:\n$$ S_x = (y_{10} - y_{00}) + (y_{11} - y_{10}) + (y_{01} - y_{11}) + (y_{00} - y_{01}) $$\nRearranging terms demonstrates that they cancel in pairs:\n$$ S_x = (-y_{00} + y_{00}) + (y_{10} - y_{10}) + (y_{01} - y_{01}) + (y_{11} - y_{11}) = 0 $$\n\nThe second component of the sum is:\n$$ S_y = (x_{00} - x_{10}) + (x_{10} - x_{11}) + (x_{11} - x_{01}) + (x_{01} - x_{00}) $$\nRearranging terms similarly shows they cancel:\n$$ S_y = (x_{00} - x_{00}) + (-x_{10} + x_{10}) + (-x_{01} + x_{01}) + (-x_{11} + x_{11}) = 0 $$\n\nThus, the sum of the outward face-normal-length vectors for the closed cell is the zero vector.\n$$ \\mathbf{S}_{\\text{total}} = (0, 0) $$\nThis result, often termed the Geometric Conservation Law (GCL), is a necessary condition for a numerical scheme to preserve a uniform flow (freestream) exactly on a curvilinear grid. It is a discrete analogue of the divergence theorem identity $\\oint_S \\mathbf{n} \\, dS = 0$ for a constant vector field (in this case, position-independent) over a closed surface.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Moving from the integral view of a cell to the continuous differential formulation, freestream preservation relies on the exact cancellation of metric terms in the transformed governing equations. This cancellation is a direct consequence of the equality of mixed partial derivatives for any smooth coordinate mapping, a key metric identity . This practice provides an opportunity to verify this identity analytically for a specific curvilinear grid, connecting the abstract mathematical principle to a concrete calculation involving the transformation metrics.",
            "id": "3961213",
            "problem": "Consider a smooth two-dimensional coordinate mapping from computational space $(\\xi,\\eta)$ to physical space $(x,y)$ defined by $x(\\xi,\\eta)=\\xi+\\epsilon\\sin\\xi\\sin\\eta$ and $y(\\xi,\\eta)=\\eta+\\epsilon\\sin\\xi\\sin\\eta$, where $\\epsilon$ is a small, dimensionless parameter with $|\\epsilon|\\ll 1$. In the context of Computational Fluid Dynamics (CFD) on curvilinear grids, freestream preservation requires certain metric identities to hold for the coordinate transformation.\n\nUsing only fundamental definitions from continuum mechanics and differential geometry of mappings, let the Jacobian be defined by $J=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$, and the contravariant metric coefficients be defined by the inverse of the Jacobian matrix, so that\n$$\n\\xi_{x}=\\frac{y_{\\eta}}{J},\\quad \\xi_{y}=-\\frac{x_{\\eta}}{J},\\quad \\eta_{x}=-\\frac{y_{\\xi}}{J},\\quad \\eta_{y}=\\frac{x_{\\xi}}{J}.\n$$\nConsequently, the adjugate components $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ are given by\n$$\nJ\\,\\xi_{x}=y_{\\eta},\\quad J\\,\\xi_{y}=-x_{\\eta},\\quad J\\,\\eta_{x}=-y_{\\xi},\\quad J\\,\\eta_{y}=x_{\\xi}.\n$$\n\nTask:\n1. Compute $x_{\\xi}$, $x_{\\eta}$, $y_{\\xi}$, $y_{\\eta}$, the Jacobian $J$, and then $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ to first order in $\\epsilon$.\n2. Using these results, analytically evaluate the scalar quantity\n$$\nD=\\frac{\\partial}{\\partial \\xi}\\!\\left(J\\,\\xi_{x}\\right)+\\frac{\\partial}{\\partial \\eta}\\!\\left(J\\,\\eta_{x}\\right)\n$$\nto first order in $\\epsilon$ and confirm the metric identity associated with freestream preservation on curvilinear grids.\n\nAnswer specification:\n- Provide your final answer as a single closed-form analytic expression for $D$ to first order in $\\epsilon$.\n- No rounding is required.\n- This quantity is dimensionless; do not include units in the final boxed expression.",
            "solution": "We begin from the given smooth mapping $x(\\xi,\\eta)=\\xi+\\epsilon\\sin\\xi\\sin\\eta$ and $y(\\xi,\\eta)=\\eta+\\epsilon\\sin\\xi\\sin\\eta$. All derivatives are taken with respect to the computational coordinates $(\\xi,\\eta)$, and we work consistently to first order in the small parameter $\\epsilon$.\n\nStep 1: Compute the first derivatives of the mapping.\nThe partial derivatives are\n$$\nx_{\\xi}=\\frac{\\partial x}{\\partial \\xi}=1+\\epsilon\\frac{\\partial}{\\partial \\xi}\\left(\\sin\\xi\\sin\\eta\\right)=1+\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\nx_{\\eta}=\\frac{\\partial x}{\\partial \\eta}=\\epsilon\\frac{\\partial}{\\partial \\eta}\\left(\\sin\\xi\\sin\\eta\\right)=\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\ny_{\\xi}=\\frac{\\partial y}{\\partial \\xi}=\\epsilon\\frac{\\partial}{\\partial \\xi}\\left(\\sin\\xi\\sin\\eta\\right)=\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\ny_{\\eta}=\\frac{\\partial y}{\\partial \\eta}=1+\\epsilon\\frac{\\partial}{\\partial \\eta}\\left(\\sin\\xi\\sin\\eta\\right)=1+\\epsilon\\sin\\xi\\cos\\eta.\n$$\n\nStep 2: Compute the Jacobian $J=x_{\\xi}y_{\\eta}-x_{\\eta}y_{\\xi}$ to first order in $\\epsilon$.\nWe have\n$$\nJ=\\left(1+\\epsilon\\cos\\xi\\sin\\eta\\right)\\left(1+\\epsilon\\sin\\xi\\cos\\eta\\right)-\\left(\\epsilon\\sin\\xi\\cos\\eta\\right)\\left(\\epsilon\\cos\\xi\\sin\\eta\\right).\n$$\nExpanding in $\\epsilon$ and retaining terms up to first order,\n$$\nJ=1+\\epsilon\\cos\\xi\\sin\\eta+\\epsilon\\sin\\xi\\cos\\eta+\\mathcal{O}(\\epsilon^{2})=1+\\epsilon\\left(\\cos\\xi\\sin\\eta+\\sin\\xi\\cos\\eta\\right)+\\mathcal{O}(\\epsilon^{2}).\n$$\nUsing the trigonometric identity $\\sin(\\xi+\\eta)=\\sin\\xi\\cos\\eta+\\cos\\xi\\sin\\eta$, we can write\n$$\nJ=1+\\epsilon\\sin(\\xi+\\eta)+\\mathcal{O}(\\epsilon^{2}).\n$$\n\nStep 3: Compute the adjugate components $J\\,\\xi_{x}$, $J\\,\\xi_{y}$, $J\\,\\eta_{x}$, and $J\\,\\eta_{y}$ to first order in $\\epsilon$.\nBy the adjugate relations,\n$$\nJ\\,\\xi_{x}=y_{\\eta}=1+\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\nJ\\,\\xi_{y}=-x_{\\eta}=-\\epsilon\\sin\\xi\\cos\\eta,\n$$\n$$\nJ\\,\\eta_{x}=-y_{\\xi}=-\\epsilon\\cos\\xi\\sin\\eta,\n$$\n$$\nJ\\,\\eta_{y}=x_{\\xi}=1+\\epsilon\\cos\\xi\\sin\\eta.\n$$\nThese are already first-order accurate in $\\epsilon$.\n\nStep 4: Evaluate the scalar quantity $D=\\partial_{\\xi}(J\\,\\xi_{x})+\\partial_{\\eta}(J\\,\\eta_{x})$ to first order in $\\epsilon$.\nUsing the expressions above,\n$$\n\\frac{\\partial}{\\partial \\xi}\\left(J\\,\\xi_{x}\\right)=\\frac{\\partial}{\\partial \\xi}\\left(1+\\epsilon\\sin\\xi\\cos\\eta\\right)=\\epsilon\\cos\\xi\\cos\\eta,\n$$\nand\n$$\n\\frac{\\partial}{\\partial \\eta}\\left(J\\,\\eta_{x}\\right)=\\frac{\\partial}{\\partial \\eta}\\left(-\\epsilon\\cos\\xi\\sin\\eta\\right)=-\\epsilon\\cos\\xi\\cos\\eta.\n$$\nTherefore,\n$$\nD=\\epsilon\\cos\\xi\\cos\\eta-\\epsilon\\cos\\xi\\cos\\eta=0.\n$$\n\nInterpretation and identity:\nThe vanishing of $D$ is not accidental; it is a manifestation of the metric identity that ensures freestream preservation on curvilinear grids. More generally, using the adjugate relationships $J\\,\\xi_{x}=y_{\\eta}$ and $J\\,\\eta_{x}=-y_{\\xi}$, we observe\n$$\nD=\\frac{\\partial y_{\\eta}}{\\partial \\xi}-\\frac{\\partial y_{\\xi}}{\\partial \\eta}=y_{\\eta\\xi}-y_{\\xi\\eta}=0,\n$$\nwhich holds exactly for any sufficiently smooth mapping due to the equality of mixed partial derivatives. Our explicit computation to first order in $\\epsilon$ confirms this identity for the given sinusoidally perturbed mapping.\n\nThus, to first order in $\\epsilon$, the scalar quantity $D$ is zero, validating the metric identity associated with freestream preservation in this case.",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Theory must ultimately be put into practice, and this is where subtle choices in numerical implementation have significant consequences. While the continuous metric identities hold exactly, their discrete analogues are only guaranteed if the numerical operators are chosen with care and consistency . This numerical experiment starkly illustrates the importance of the discrete GCL by tasking you to compare a scheme that preserves it with one that violates it, allowing you to directly observe and quantify the resulting freestream error.",
            "id": "3961177",
            "problem": "Consider the two-dimensional linear advection conservation law in physical coordinates $(x,y)$ with constant velocity components $(a,b)$ and scalar state $u(x,y,t)$, given by the equation $\\partial u/\\partial t + \\partial (a u)/\\partial x + \\partial (b u)/\\partial y = 0$. Let a smooth, periodic curvilinear mapping $(x(\\xi,\\eta), y(\\xi,\\eta))$ be defined on the computational domain $(\\xi,\\eta) \\in [0,1) \\times [0,1)$, where the mapping is specified by $x(\\xi,\\eta) = \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$ and $y(\\xi,\\eta) = \\eta + \\beta \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$ for real parameters $\\alpha$ and $\\beta$. Let $J(\\xi,\\eta) = x_\\xi y_\\eta - x_\\eta y_\\xi$ denote the Jacobian determinant of the mapping, where subscripts denote partial derivatives with respect to $\\xi$ and $\\eta$. In the transformed conservative form, the equation becomes $\\partial (J u)/\\partial t + \\partial \\hat{F}/\\partial \\xi + \\partial \\hat{G}/\\partial \\eta = 0$, where the contravariant fluxes are $\\hat{F} = a u\\, y_\\eta - b u\\, x_\\eta$ and $\\hat{G} = b u\\, x_\\xi - a u\\, y_\\xi$. A constant freestream state is defined as $u(\\xi,\\eta,t) = u_0$ where $u_0$ is a constant independent of $(\\xi,\\eta,t)$, and the exact continuous residual of the spatial operator for this state is zero.\n\nYour task is to implement two discrete spatial residuals for the constant freestream state $u(\\xi,\\eta,t) = u_0$ on the periodic computational grid, and to quantify the difference between them:\n\n- Conservative discretization: Compute the discrete residual $R_{\\mathrm{cons}}(\\xi_i,\\eta_j)$ by first computing the metric derivatives $x_\\xi$, $x_\\eta$, $y_\\xi$, and $y_\\eta$ using second-order centered differences with periodic boundary conditions along each computational direction, then forming $\\hat{F}$ and $\\hat{G}$ using the formulas above with $u_0 = 1$, and finally computing the divergence $\\partial \\hat{F}/\\partial \\xi + \\partial \\hat{G}/\\partial \\eta$ using second-order centered differences with periodic boundary conditions. Use uniform computational spacings $\\Delta \\xi = 1/N_\\xi$ and $\\Delta \\eta = 1/N_\\eta$, where $N_\\xi$ and $N_\\eta$ are the number of grid points in the $\\xi$ and $\\eta$ directions, respectively.\n\n- Non-conservative discretization: Compute the discrete residual $R_{\\mathrm{non}}(\\xi_i,\\eta_j)$ by computing the metric derivatives using first-order one-sided differences with periodic boundary conditions but with inconsistent choices per direction: use a backward difference for $\\partial/\\partial \\xi$ and a forward difference for $\\partial/\\partial \\eta$ when computing $x_\\xi$, $x_\\eta$, $y_\\xi$, and $y_\\eta$. Then form $\\hat{F}$ and $\\hat{G}$ using the same formulas with $u_0 = 1$, and compute the divergence using second-order centered differences with periodic boundary conditions. This inconsistent metric approximation intentionally violates the discrete metric identity and emulates a non-conservative discretization with respect to freestream preservation on the curved grid.\n\nFor both discretizations, quantify the discrete residual using the following measures over all grid points: the root-mean-square norm $L_2 = \\sqrt{\\frac{1}{N_\\xi N_\\eta} \\sum_{i=0}^{N_\\xi-1} \\sum_{j=0}^{N_\\eta-1} R(i,j)^2}$ and the maximum absolute norm $L_\\infty = \\max_{i,j} |R(i,j)|$. In all computations, treat $u_0 = 1$ and $(a,b)$ as given constants. There are no physical units; all quantities are dimensionless.\n\nImplement a program in the specified environment that computes, for each test case, the following three floating-point outputs in order: $(L_{2,\\mathrm{cons}}, L_{2,\\mathrm{non}}, L_{\\infty,\\mathrm{non}})$, where $L_{2,\\mathrm{cons}}$ is the $L_2$ norm of $R_{\\mathrm{cons}}$, $L_{2,\\mathrm{non}}$ is the $L_2$ norm of $R_{\\mathrm{non}}$, and $L_{\\infty,\\mathrm{non}}$ is the $L_\\infty$ norm of $R_{\\mathrm{non}}$.\n\nUse the following test suite, which varies grid resolution, curvature amplitudes, and velocities to probe general behavior, boundary conditions, and an edge case:\n\n- Case $1$ (happy path): $N_\\xi = 64$, $N_\\eta = 64$, $\\alpha = 0.2$, $\\beta = -0.1$, $a = 1.0$, $b = 0.5$.\n- Case $2$ (boundary condition: uniform grid): $N_\\xi = 32$, $N_\\eta = 32$, $\\alpha = 0.0$, $\\beta = 0.0$, $a = 1.0$, $b = 1.0$.\n- Case $3$ (edge case: coarse and highly curved): $N_\\xi = 8$, $N_\\eta = 8$, $\\alpha = 0.3$, $\\beta = 0.25$, $a = 1.0$, $b = -0.4$.\n- Case $4$ (anisotropic resolution): $N_\\xi = 64$, $N_\\eta = 32$, $\\alpha = 0.15$, $\\beta = 0.05$, $a = -0.7$, $b = 1.3$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]\"). The ordering must be exactly the concatenation of the triplets $(L_{2,\\mathrm{cons}}, L_{2,\\mathrm{non}}, L_{\\infty,\\mathrm{non}})$ for Case $1$, then Case $2$, then Case $3$, then Case $4$.",
            "solution": "We begin from the scalar linear advection conservation law in physical coordinates $(x,y)$, given by $\\partial u/\\partial t + \\partial (a u)/\\partial x + \\partial (b u)/\\partial y = 0$, where $(a,b)$ are constant velocity components and $u(x,y,t)$ is the advected scalar. This conservation law is transformed to curvilinear computational coordinates $(\\xi,\\eta)$ via a smooth mapping $(x(\\xi,\\eta),y(\\xi,\\eta))$ with Jacobian determinant $J(\\xi,\\eta) = x_\\xi y_\\eta - x_\\eta y_\\xi$. The well-established transformation into conservative form yields $\\partial (J u)/\\partial t + \\partial \\hat{F}/\\partial \\xi + \\partial \\hat{G}/\\partial \\eta = 0$, where the contravariant fluxes for the linear advection fluxes $f = a u$ and $g = b u$ are $\\hat{F} = f\\, y_\\eta - g\\, x_\\eta = a u\\, y_\\eta - b u\\, x_\\eta$ and $\\hat{G} = -f\\, y_\\xi + g\\, x_\\xi = b u\\, x_\\xi - a u\\, y_\\xi$. These formulas arise from the transformation of divergence operators under a change of variables and constitute a fundamental base widely used in computational fluid dynamics for conservation laws on curvilinear grids.\n\nFor a constant freestream $u(\\xi,\\eta,t) = u_0$ with constant $(a,b)$, the continuous residual of the spatial operator simplifies to $\\partial \\hat{F}/\\partial \\xi + \\partial \\hat{G}/\\partial \\eta = u_0 \\big(a (y_{\\eta\\xi} - y_{\\xi\\eta}) + b (x_{\\xi\\eta} - x_{\\eta\\xi})\\big)$, which vanishes identically because mixed partial derivatives commute, i.e., $y_{\\eta\\xi} = y_{\\xi\\eta}$ and $x_{\\xi\\eta} = x_{\\eta\\xi}$. This exact cancellation is the analytic underpinning of freestream preservation in the continuous setting on any smooth grid.\n\nDiscretely, freestream preservation depends on whether discrete metric identities analogous to the continuous mixed-derivative commutativity hold. Let the computational grid be uniform and periodic with $N_\\xi$ points in $\\xi$ and $N_\\eta$ points in $\\eta$, spacings $\\Delta \\xi = 1/N_\\xi$ and $\\Delta \\eta = 1/N_\\eta$, and indices $(i,j)$ with $0 \\le i \\le N_\\xi-1$ and $0 \\le j \\le N_\\eta-1$. Define the mapping as $x(\\xi,\\eta) = \\xi + \\alpha \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$ and $y(\\xi,\\eta) = \\eta + \\beta \\sin(2\\pi \\xi)\\sin(2\\pi \\eta)$, which is smooth and periodic for any real $\\alpha$ and $\\beta$. To compute discrete derivatives, we adopt standard finite-difference operators with periodic boundary conditions. The second-order centered difference along $\\xi$ is $D_\\xi^{(c)} f_{i,j} = (f_{i+1,j} - f_{i-1,j})/(2 \\Delta \\xi)$, and along $\\eta$ is $D_\\eta^{(c)} f_{i,j} = (f_{i,j+1} - f_{i,j-1})/(2 \\Delta \\eta)$, where indices are wrapped modulo $N_\\xi$ and $N_\\eta$. The first-order one-sided differences along $\\xi$ are $D_\\xi^{(f)} f_{i,j} = (f_{i+1,j} - f_{i,j})/\\Delta \\xi$ and $D_\\xi^{(b)} f_{i,j} = (f_{i,j} - f_{i-1,j})/\\Delta \\xi$, and along $\\eta$ are $D_\\eta^{(f)} f_{i,j} = (f_{i,j+1} - f_{i,j})/\\Delta \\eta$ and $D_\\eta^{(b)} f_{i,j} = (f_{i,j} - f_{i,j-1})/\\Delta \\eta$.\n\nConservative discretization design proceeds by computing the metric derivatives $x_\\xi$, $x_\\eta$, $y_\\xi$, and $y_\\eta$ using the same second-order centered operators along each direction, yielding $x_\\xi \\approx D_\\xi^{(c)} x$, $x_\\eta \\approx D_\\eta^{(c)} x$, $y_\\xi \\approx D_\\xi^{(c)} y$, and $y_\\eta \\approx D_\\eta^{(c)} y$. Then one forms the contravariant fluxes at cell centers for $u_0 = 1$ as $\\hat{F}_{i,j} = a\\, y_{\\eta, i,j} - b\\, x_{\\eta, i,j}$ and $\\hat{G}_{i,j} = b\\, x_{\\xi, i,j} - a\\, y_{\\xi, i,j}$. The discrete conservative residual is then computed as $R_{\\mathrm{cons},i,j} = D_\\xi^{(c)} \\hat{F}_{i,j} + D_\\eta^{(c)} \\hat{G}_{i,j}$. Due to the linearity and shift-invariance of centered differences with periodic boundaries, the discrete operators commute, i.e., $D_\\xi^{(c)} D_\\eta^{(c)} = D_\\eta^{(c)} D_\\xi^{(c)}$, which replicates the continuous mixed-derivative identity at the discrete level. Therefore, for the constant freestream and smooth periodic mapping, $R_{\\mathrm{cons}}$ is expected to vanish up to machine precision.\n\nNon-conservative discretization emulates violation of the discrete metric identity by computing the metric derivatives with inconsistent one-sided differences: use $x_\\xi \\approx D_\\xi^{(b)} x$, $x_\\eta \\approx D_\\eta^{(f)} x$, $y_\\xi \\approx D_\\xi^{(b)} y$, and $y_\\eta \\approx D_\\eta^{(f)} y$, while still forming $\\hat{F}$ and $\\hat{G}$ with the same formulas and computing the divergence with centered differences. In this construction, the mixed derivatives computed as $D_\\xi^{(b)} D_\\eta^{(f)}$ and $D_\\eta^{(f)} D_\\xi^{(b)}$ generally do not commute, producing spurious residuals even for the constant freestream on curved grids. This is a principled way to demonstrate the sensitivity of freestream preservation to discrete metric identities.\n\nTo quantify the residuals, compute the root-mean-square norm $L_2 = \\sqrt{\\frac{1}{N_\\xi N_\\eta} \\sum_{i,j} R_{i,j}^2}$ and the maximum absolute norm $L_\\infty = \\max_{i,j} |R_{i,j}|$. The algorithm for each test case is:\n\n- Construct uniform periodic grids of $\\xi$ and $\\eta$ with $N_\\xi$ and $N_\\eta$ points, respectively, and spacings $\\Delta \\xi = 1/N_\\xi$ and $\\Delta \\eta = 1/N_\\eta$.\n- Evaluate $x(\\xi,\\eta)$ and $y(\\xi,\\eta)$ using the provided mapping with given $\\alpha$ and $\\beta$.\n- Compute metric derivatives $(x_\\xi, x_\\eta, y_\\xi, y_\\eta)$ using centered differences for the conservative discretization and using the specified backward and forward one-sided differences for the non-conservative discretization.\n- Form $\\hat{F}$ and $\\hat{G}$ using $u_0 = 1$ and the given $(a,b)$.\n- Compute the discrete divergence using centered differences to obtain $R_{\\mathrm{cons}}$ and $R_{\\mathrm{non}}$.\n- Compute $L_{2,\\mathrm{cons}}$, $L_{2,\\mathrm{non}}$, and $L_{\\infty,\\mathrm{non}}$.\n\nFor the test suite, we select four cases: Case $1$ with $N_\\xi = 64$, $N_\\eta = 64$, $\\alpha = 0.2$, $\\beta = -0.1$, $a = 1.0$, $b = 0.5$ to represent a typical smooth curved periodic grid; Case $2$ with $N_\\xi = 32$, $N_\\eta = 32$, $\\alpha = 0.0$, $\\beta = 0.0$, $a = 1.0$, $b = 1.0$ to represent a uniform grid where both discretizations should produce near-zero residuals; Case $3$ with $N_\\xi = 8$, $N_\\eta = 8$, $\\alpha = 0.3$, $\\beta = 0.25$, $a = 1.0$, $b = -0.4$ to probe coarse resolution and larger curvature leading to larger non-conservative residuals; and Case $4$ with $N_\\xi = 64$, $N_\\eta = 32$, $\\alpha = 0.15$, $\\beta = 0.05$, $a = -0.7$, $b = 1.3$ to explore anisotropic resolution effects. The final output is the concatenated list of the three measures per case, printed as a single line in the prescribed format.",
            "answer": "```python\nimport numpy as np\n\ndef central_diff(arr, axis, d):\n    \"\"\"\n    Second-order centered difference with periodic boundaries along given axis.\n    \"\"\"\n    roll_plus = np.roll(arr, -1, axis=axis)\n    roll_minus = np.roll(arr, 1, axis=axis)\n    return (roll_plus - roll_minus) / (2.0 * d)\n\ndef forward_diff(arr, axis, d):\n    \"\"\"\n    First-order forward difference with periodic boundaries along given axis.\n    \"\"\"\n    roll_plus = np.roll(arr, -1, axis=axis)\n    return (roll_plus - arr) / d\n\ndef backward_diff(arr, axis, d):\n    \"\"\"\n    First-order backward difference with periodic boundaries along given axis.\n    \"\"\"\n    roll_minus = np.roll(arr, 1, axis=axis)\n    return (arr - roll_minus) / d\n\ndef build_mapping(Nxi, Neta, alpha, beta):\n    \"\"\"\n    Construct periodic computational grid and smooth curved mapping.\n    \"\"\"\n    xi = np.linspace(0.0, 1.0, Nxi, endpoint=False)\n    eta = np.linspace(0.0, 1.0, Neta, endpoint=False)\n    XI, ETA = np.meshgrid(xi, eta, indexing='ij')\n    x = XI + alpha * np.sin(2.0 * np.pi * XI) * np.sin(2.0 * np.pi * ETA)\n    y = ETA + beta  * np.sin(2.0 * np.pi * XI) * np.sin(2.0 * np.pi * ETA)\n    return XI, ETA, x, y\n\ndef residuals_for_case(Nxi, Neta, alpha, beta, a, b):\n    \"\"\"\n    Compute L2 and Linf norms of residuals for conservative and non-conservative discretizations.\n    \"\"\"\n    XI, ETA, x, y = build_mapping(Nxi, Neta, alpha, beta)\n    dxi = 1.0 / Nxi\n    deta = 1.0 / Neta\n\n    # Conservative metrics: centered differences\n    x_xi_c   = central_diff(x, axis=0, d=dxi)\n    x_eta_c  = central_diff(x, axis=1, d=deta)\n    y_xi_c   = central_diff(y, axis=0, d=dxi)\n    y_eta_c  = central_diff(y, axis=1, d=deta)\n\n    # Contravariant fluxes with u0=1\n    F_cons = a * y_eta_c - b * x_eta_c\n    G_cons = b * x_xi_c  - a * y_xi_c\n\n    # Divergence with centered differences\n    divF_cons = central_diff(F_cons, axis=0, d=dxi)\n    divG_cons = central_diff(G_cons, axis=1, d=deta)\n    R_cons = divF_cons + divG_cons\n\n    # Non-conservative metrics: inconsistent one-sided differences\n    x_xi_nc  = backward_diff(x, axis=0, d=dxi)\n    x_eta_nc = forward_diff(x, axis=1, d=deta)\n    y_xi_nc  = backward_diff(y, axis=0, d=dxi)\n    y_eta_nc = forward_diff(y, axis=1, d=deta)\n\n    F_non = a * y_eta_nc - b * x_eta_nc\n    G_non = b * x_xi_nc  - a * y_xi_nc\n\n    divF_non = central_diff(F_non, axis=0, d=dxi)\n    divG_non = central_diff(G_non, axis=1, d=deta)\n    R_non = divF_non + divG_non\n\n    # Norms\n    l2_cons = float(np.sqrt(np.mean(R_cons**2)))\n    l2_non  = float(np.sqrt(np.mean(R_non**2)))\n    linf_non = float(np.max(np.abs(R_non)))\n\n    return l2_cons, l2_non, linf_non\n\ndef solve():\n    test_cases = [\n        # Case 1: Nxi, Neta, alpha, beta, a, b\n        (64, 64, 0.2, -0.1, 1.0, 0.5),\n        # Case 2: uniform grid\n        (32, 32, 0.0, 0.0, 1.0, 1.0),\n        # Case 3: coarse and highly curved\n        (8, 8, 0.3, 0.25, 1.0, -0.4),\n        # Case 4: anisotropic resolution\n        (64, 32, 0.15, 0.05, -0.7, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nxi, Neta, alpha, beta, a, b = case\n        l2c, l2n, linfn = residuals_for_case(Nxi, Neta, alpha, beta, a, b)\n        results.extend([l2c, l2n, linfn])\n\n    # Print single-line, comma-separated list enclosed in square brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}