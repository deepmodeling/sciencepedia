{
    "hands_on_practices": [
        {
            "introduction": "“网格质量”不仅仅是一个定性的概念；它对计算流体动力学求解器的精度和稳定性有着直接的量化影响。本练习旨在通过一个核心的数值操作——梯度重构，来揭示这一联系。你将运用线性代数中的条件数概念，来具体衡量不同网格拓扑结构对计算误差的放大效应，从而深刻理解为何排布良好的单元对于获得可靠的模拟结果至关重要 。",
            "id": "3998372",
            "problem": "考虑一个二维、定常、无粘的标量场 $f(\\boldsymbol{x})$，该场足够光滑，允许在点 $\\boldsymbol{x}_{0}$ 附近进行一阶泰勒展开。假设在 $\\boldsymbol{x}_{0}$ 的邻域内，位于偏移量 $\\boldsymbol{r}_{i} = \\boldsymbol{x}_{i} - \\boldsymbol{x}_{0}$ 处的 $m$ 个相邻点上的值 $f_{i}$ 是已知的。最小二乘梯度重构通过最小化 $\\sum_{i=1}^{m} \\left( b_{i} - \\boldsymbol{g} \\cdot \\boldsymbol{r}_{i} \\right)^{2}$ 来求解 $\\boldsymbol{g} \\approx \\nabla f(\\boldsymbol{x}_{0})$，其中 $b_{i} = f_{i} - f_{0}$ 且 $f_{0} = f(\\boldsymbol{x}_{0})$。这是在计算流体动力学 (Computational Fluid Dynamics, CFD) 中，在非结构化和混合网格上进行梯度估计的标准方法。\n\n定义一个 $m \\times 2$ 的设计矩阵 $A$，其第 $i$ 行为 $\\boldsymbol{r}_{i}^{\\top}$，并考虑使用 2-范数的无权最小二乘问题。其正规方程为 $(A^{\\top} A)\\boldsymbol{g} = A^{\\top} \\boldsymbol{b}$，其中 $\\boldsymbol{b} = [b_{1}, \\dots, b_{m}]^{\\top}$。令 $A$ 的 2-范数条件数为 $\\kappa_{2}(A) = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$，其中 $\\sigma_{\\max}(A)$ 和 $\\sigma_{\\min}(A)$ 分别是 $A$ 的最大和最小奇异值。将 $\\kappa_{2}(A)$ 视为梯度重构的网格质量度量。\n\n从上述泰勒展开和最小二乘公式出发，推导一个范数界，说明 $\\boldsymbol{b}$ 中的扰动 $\\delta \\boldsymbol{b}$ 如何放大为 $\\boldsymbol{g}$ 中的重构误差 $\\delta \\boldsymbol{g}$，并明确证明较大的 $\\kappa_{2}(A)$ 如何导致更大的最坏情况放大因子。然后，对于从不同网格拓扑中提取的、围绕 $\\boldsymbol{x}_{0}$ 的两种局部点分布：\n\n1.  一个分布良好、类似结构化网格的区块，其相邻点的偏移量为\n$$\n\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}.\n$$\n\n2.  一个分布不佳、非结构化/混合网格的区块，其三个相邻点近似共线，一个相邻点近轴向，偏移量为\n$$\n\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{3} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix},\\quad\n\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ \\varepsilon \\end{pmatrix},\n$$\n其中 $\\varepsilon = 0.2$。\n\n假设两个区块中测量噪声的相对水平 $||\\delta \\boldsymbol{b}||_{2}/||\\boldsymbol{b}||_{2}$ 相同，并忽略 $A$ 中的扰动，计算分布不佳区块的梯度重构误差最坏情况范数界与分布良好区块的相应范数界之比。将最终答案表示为一个四舍五入到四位有效数字的实数。无需单位。",
            "solution": "该问题要求我们首先为最小二乘梯度重构问题推导一个范数误差界，然后用它来比较在代表不同网格拓扑的两种不同点分布上重构的数值稳定性。\n\n首先，我们来推导误差界。问题是找到梯度 $\\boldsymbol{g} \\in \\mathbb{R}^2$，使其最小化残差平方和，这可以写成矩阵形式，即最小化 $\\|\\boldsymbol{b} - A\\boldsymbol{g}\\|_2^2$。这里，$A$ 是一个 $m \\times 2$ 的设计矩阵，其行向量为 $\\boldsymbol{r}_i^\\top$，$\\boldsymbol{b}$ 是函数值之差 $f_i - f_0$ 构成的向量。这个最小二乘问题的解由正规方程给出：\n$$ (A^\\top A)\\boldsymbol{g} = A^\\top \\boldsymbol{b} $$\n由于我们处理的是点的空间分布，为了能够重构出有意义的梯度，这些点不能共线。这意味着 $A$ 的列是线性无关的，并且 $2 \\times 2$ 矩阵 $A^\\top A$ 是可逆的。因此，梯度可以如下求得：\n$$ \\boldsymbol{g} = (A^\\top A)^{-1} A^\\top \\boldsymbol{b} $$\n矩阵 $(A^\\top A)^{-1} A^\\top$ 是 $A$ 的 Moore-Penrose 伪逆，记作 $A^+$。\n\n现在，我们考虑测量向量 $\\boldsymbol{b}$ 中的扰动 $\\delta\\boldsymbol{b}$ 的影响。题目要求忽略 $A$ 中的扰动。受扰动的系统产生新的梯度估计 $\\boldsymbol{g} + \\delta\\boldsymbol{g}$：\n$$ \\boldsymbol{g} + \\delta\\boldsymbol{g} = A^+ (\\boldsymbol{b} + \\delta\\boldsymbol{b}) $$\n从该方程中减去未受扰动的解 $\\boldsymbol{g} = A^+ \\boldsymbol{b}$，得到梯度中的误差 $\\delta\\boldsymbol{g}$：\n$$ \\delta\\boldsymbol{g} = A^+ \\delta\\boldsymbol{b} $$\n为了找到这个误差大小的界，我们对两边取向量 2-范数：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 = \\|A^+ \\delta\\boldsymbol{b}\\|_2 $$\n使用诱导矩阵范数的性质，我们有：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 \\le \\|A^+\\|_2 \\|\\delta\\boldsymbol{b}\\|_2 $$\n伪逆的 2-范数 $\\|A^+\\|_2$ 等于 $A$ 的最小奇异值 $\\sigma_{\\min}(A)$ 的倒数。因此，绝对误差界为：\n$$ \\|\\delta\\boldsymbol{g}\\|_2 \\le \\frac{1}{\\sigma_{\\min}(A)} \\|\\delta\\boldsymbol{b}\\|_2 $$\n为了找到相对误差界，我们需要从下方界定 $\\|\\boldsymbol{g}\\|_2$。最小二乘解 $\\boldsymbol{g}$ 将 $\\boldsymbol{b}$ 投影到 $A$ 的列空间上。也就是说，$A\\boldsymbol{g} = \\text{proj}_{\\text{col}(A)}(\\boldsymbol{b})$。由此可知 $\\|A\\boldsymbol{g}\\|_2 \\le \\|\\boldsymbol{b}\\|_2$。根据矩阵范数的定义，我们有 $\\|A\\boldsymbol{g}\\|_2 \\le \\|A\\|_2 \\|\\boldsymbol{g}\\|_2$。$A$ 的 2-范数 $\\|A\\|_2$ 是其最大奇异值 $\\sigma_{\\max}(A)$。所以，\n$$ \\|A\\boldsymbol{g}\\|_2 \\le \\sigma_{\\max}(A) \\|\\boldsymbol{g}\\|_2 \\implies \\|\\boldsymbol{g}\\|_2 \\ge \\frac{\\|A\\boldsymbol{g}\\|_2}{\\sigma_{\\max}(A)} $$\n结合 $\\|\\delta\\boldsymbol{g}\\|_2$ 和 $\\|\\boldsymbol{g}\\|_2$ 的界，我们得到相对误差界：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\le \\frac{\\|\\delta\\boldsymbol{b}\\|_2 / \\sigma_{\\min}(A)}{\\|A\\boldsymbol{g}\\|_2 / \\sigma_{\\max}(A)} = \\frac{\\sigma_{\\max}(A)}{\\sigma_{\\min}(A)} \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|A\\boldsymbol{g}\\|_2} $$\n将 2-范数条件数定义为 $\\kappa_2(A) = \\sigma_{\\max}(A) / \\sigma_{\\min}(A)$，则该界为：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\le \\kappa_2(A) \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|A\\boldsymbol{g}\\|_2} $$\n向量 $A\\boldsymbol{g}$ 是 $\\boldsymbol{b}$ 在 $A$ 的列空间中的分量。一阶泰勒展开给出 $b_i = f_i - f_0 \\approx \\nabla f(\\boldsymbol{x}_0) \\cdot \\boldsymbol{r}_i$。如果高阶项可以忽略不计，那么 $\\boldsymbol{b} \\approx A\\boldsymbol{g}$，这意味着 $\\|A\\boldsymbol{g}\\|_2 \\approx \\|\\boldsymbol{b}\\|_2$。在这种情况下，该界简化为：\n$$ \\frac{\\|\\delta\\boldsymbol{g}\\|_2}{\\|\\boldsymbol{g}\\|_2} \\lesssim \\kappa_2(A) \\frac{\\|\\delta\\boldsymbol{b}\\|_2}{\\|\\boldsymbol{b}\\|_2} $$\n这表明 $\\kappa_2(A)$ 充当了 $\\boldsymbol{b}$ 中的相对误差传播到 $\\boldsymbol{g}$ 中的相对误差时的最坏情况放大因子。较大的 $\\kappa_2(A)$ 意味着问题更病态，即微小的输入误差可能导致巨大的输出误差。因此，假设两个区块的相对噪声水平相同，它们的最坏情况界之比就是它们各自条件数之比。\n\n现在，我们计算两种给定情况下的这个比率。\n\n情况 1：分布良好、类似结构化网格的区块。\n相邻点的偏移量为 $\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，$\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix}$，$\\boldsymbol{r}_{3} = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$，$\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ -1 \\end{pmatrix}$。\n设计矩阵 $A_1$ 为：\n$$ A_1 = \\begin{pmatrix} 1 & 0 \\\\ -1 & 0 \\\\ 0 & 1 \\\\ 0 & -1 \\end{pmatrix} $$\n$A_1$ 的奇异值是 $A_1^\\top A_1$ 的特征值的平方根。\n$$ A_1^\\top A_1 = \\begin{pmatrix} 1 & -1 & 0 & 0 \\\\ 0 & 0 & 1 & -1 \\end{pmatrix} \\begin{pmatrix} 1 & 0 \\\\ -1 & 0 \\\\ 0 & 1 \\\\ 0 & -1 \\end{pmatrix} = \\begin{pmatrix} 1^2 + (-1)^2 & 0 \\\\ 0 & 1^2 + (-1)^2 \\end{pmatrix} = \\begin{pmatrix} 2 & 0 \\\\ 0 & 2 \\end{pmatrix} $$\n$A_1^\\top A_1$ 的特征值为 $\\lambda_1 = 2$ 和 $\\lambda_2 = 2$。\n$A_1$ 的奇异值为 $\\sigma_{\\max}(A_1) = \\sqrt{2}$ 和 $\\sigma_{\\min}(A_1) = \\sqrt{2}$。\n分布良好区块的条件数为：\n$$ \\kappa_2(A_1) = \\frac{\\sigma_{\\max}(A_1)}{\\sigma_{\\min}(A_1)} = \\frac{\\sqrt{2}}{\\sqrt{2}} = 1 $$\n\n情况 2：分布不佳、非结构化/混合网格的区块。\n相邻点的偏移量为 $\\boldsymbol{r}_{1} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$，$\\boldsymbol{r}_{2} = \\begin{pmatrix} -1 \\\\ 0 \\end{pmatrix}$，$\\boldsymbol{r}_{3} = \\begin{pmatrix} 2 \\\\ 0 \\end{pmatrix}$，$\\boldsymbol{r}_{4} = \\begin{pmatrix} 0 \\\\ \\varepsilon \\end{pmatrix}$，其中 $\\varepsilon = 0.2$。\n设计矩阵 $A_2$ 为：\n$$ A_2 = \\begin{pmatrix} 1 & 0 \\\\ -1 & 0 \\\\ 2 & 0 \\\\ 0 & 0.2 \\end{pmatrix} $$\n我们计算 $A_2^\\top A_2$：\n$$ A_2^\\top A_2 = \\begin{pmatrix} 1 & -1 & 2 & 0 \\\\ 0 & 0 & 0 & 0.2 \\end{pmatrix} \\begin{pmatrix} 1 & 0 \\\\ -1 & 0 \\\\ 2 & 0 \\\\ 0 & 0.2 \\end{pmatrix} = \\begin{pmatrix} 1^2 + (-1)^2 + 2^2 & 0 \\\\ 0 & (0.2)^2 \\end{pmatrix} = \\begin{pmatrix} 1+1+4 & 0 \\\\ 0 & 0.04 \\end{pmatrix} = \\begin{pmatrix} 6 & 0 \\\\ 0 & 0.04 \\end{pmatrix} $$\n$A_2^\\top A_2$ 的特征值为 $\\lambda_1 = 6$ 和 $\\lambda_2 = 0.04$。\n$A_2$ 的奇异值为 $\\sigma_{\\max}(A_2) = \\sqrt{6}$ 和 $\\sigma_{\\min}(A_2) = \\sqrt{0.04} = 0.2$。\n分布不佳区块的条件数为：\n$$ \\kappa_2(A_2) = \\frac{\\sigma_{\\max}(A_2)}{\\sigma_{\\min}(A_2)} = \\frac{\\sqrt{6}}{0.2} $$\n\n最后，我们计算分布不佳区块的最坏情况范数界与分布良好区块的相应范数界之比。这个比率就是它们条件数之比。\n$$ \\text{比率} = \\frac{\\kappa_2(A_2)}{\\kappa_2(A_1)} = \\frac{\\sqrt{6} / 0.2}{1} = \\frac{\\sqrt{6}}{0.2} $$\n现在我们计算其数值：\n$$ \\text{比率} \\approx \\frac{2.44948974}{0.2} = 12.2474487 $$\n四舍五入到四位有效数字，该比率为 $12.25$。这个结果定量地证明了，在分布不佳、近似共线的点集上进行的梯度重构，对输入数据中噪声的敏感度，是分布良好、类似正交的点集上的 12 倍以上。",
            "answer": "$$ \\boxed{12.25} $$"
        },
        {
            "introduction": "将理论知识转化为实际的网格生成策略，是航空航天 CFD 工程师的一项关键技能，尤其是在处理复杂的湍流边界层时。本练习将引导你完成一个典型的混合网格设计过程，你需要综合考虑流体物理（如壁面单位 $y^+$）和数值约束（如单元宽高比和增长率）。通过这个实践，你将学会如何为满足特定解析要求的近壁区域精确构建棱柱层网格 。",
            "id": "3998390",
            "problem": "需要为一个光滑平板上、流向位置 $x = 1.0\\,\\mathrm{m}$ 处的不可压缩、零压力梯度湍流边界层（TBL）生成一个先进的计算流体动力学（CFD）混合网格。自由流速度为 $U_{\\infty} = 100\\,\\mathrm{m/s}$，空气密度为 $\\rho = 1.2\\,\\mathrm{kg/m^3}$，动力粘度为 $\\mu = 1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$。近壁区域将使用堆叠的棱柱层进行网格划分，各层的壁面法向厚度遵循几何级数，相邻层之间的增长率 $g$ 为常数。壁面平行方向的离散在棱柱层堆栈内采用均匀的流向间距，其值等于壁面值。\n\n壁面单位的设计目标是 $\\,\\Delta y^{+} = 1.0\\,$ 和 $\\,\\Delta x^{+} = 40\\,$，可接受的最大单元纵横比（定义为壁面平行方向长度除以壁面法向厚度）为 $\\mathrm{AR}_{\\max} = 150$。棱柱层的增长率受限于 $g \\leq g_{\\max}$，其中 $g_{\\max} = 1.20$。棱柱层堆栈的总高度必须覆盖给定 $x$ 位置处当地湍流边界层厚度 $\\,\\delta\\,$ 的 $f = 0.80$。\n\n请使用以下在高雷诺数下零压力梯度湍流平板边界层的广泛接受的经验公式：\n- 表面摩擦系数公式：$C_{f}(x) = 0.026 \\, \\mathrm{Re}_{x}^{-1/7}$，其中 $\\mathrm{Re}_{x} = \\frac{\\rho U_{\\infty} x}{\\mu}$。\n- 边界层厚度公式：$\\frac{\\delta}{x} = 0.37 \\, \\mathrm{Re}_{x}^{-1/5}$。\n\n使用壁面单位的标准定义：$y^{+} = \\frac{y \\, u_{\\tau}}{\\nu}$ 和 $x^{+} = \\frac{x \\, u_{\\tau}}{\\nu}$，其中 $u_{\\tau} = \\sqrt{\\tau_{w}/\\rho}$ 是摩擦速度，$\\nu = \\mu/\\rho$ 是运动粘度。通过 $C_{f} = \\frac{\\tau_{w}}{\\frac{1}{2} \\rho U_{\\infty}^{2}}$ 将 $u_{\\tau}$ 与 $C_{f}$ 关联起来。\n\n假设棱柱层堆栈内的最坏情况纵横比出现在第一层（壁面法向厚度最小），并使用 $g = g_{\\max}$ 以在满足增长率约束的同时最小化层数。计算棱柱层的最小整数层数 $N$，使得：\n- 从由 $\\,\\Delta y^{+}\\,$ 设定的第一层高度开始，对各层厚度按几何级数求和得到的总棱柱层高度 $H_{N}$ 至少为 $f \\, \\delta$。\n- 纵横比约束 $\\mathrm{AR} \\leq \\mathrm{AR}_{\\max}$ 得到满足。\n\n报告最小整数 $N$。不要四舍五入到任何有效位数；只提供整数值。",
            "solution": "该问题要求计算在湍流边界层中，计算流体动力学（CFD）网格所需的最小整数棱柱层数 $N$。求解过程包括计算边界层的物理特性，然后根据指定的约束条件，利用这些特性来确定网格的几何属性。\n\n首先，我们确定在指定位置 $x=1.0\\,\\mathrm{m}$ 处流动的特征无量纲数，即雷诺数。运动粘度 $\\nu$ 是动力粘度 $\\mu$ 与密度 $\\rho$ 的比值。\n给定 $\\rho = 1.2\\,\\mathrm{kg/m^3}$ 和 $\\mu = 1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}$：\n$$ \\nu = \\frac{\\mu}{\\rho} = \\frac{1.8 \\times 10^{-5}\\,\\mathrm{kg/(m\\,s)}}{1.2\\,\\mathrm{kg/m^3}} = 1.5 \\times 10^{-5}\\,\\mathrm{m^2/s} $$\n使用自由流速度 $U_{\\infty} = 100\\,\\mathrm{m/s}$ 计算 $x$ 处的雷诺数 $\\mathrm{Re}_x$：\n$$ \\mathrm{Re}_{x} = \\frac{U_{\\infty} x}{\\nu} = \\frac{(100\\,\\mathrm{m/s})(1.0\\,\\mathrm{m})}{1.5 \\times 10^{-5}\\,\\mathrm{m^2/s}} = \\frac{2}{3} \\times 10^7 \\approx 6.67 \\times 10^6 $$\n\n有了雷诺数，我们可以使用提供的经验公式来计算边界层的属性。\n表面摩擦系数 $C_f$ 为：\n$$ C_{f} = 0.026 \\, \\mathrm{Re}_{x}^{-1/7} = 0.026 \\left(\\frac{2}{3} \\times 10^7\\right)^{-1/7} \\approx 0.0027424 $$\n壁面剪切应力 $\\tau_w$ 通过其定义与 $C_f$ 相关：\n$$ \\tau_{w} = C_{f} \\cdot \\frac{1}{2} \\rho U_{\\infty}^{2} \\approx 0.0027424 \\times \\frac{1}{2} \\times (1.2\\,\\mathrm{kg/m^3}) \\times (100\\,\\mathrm{m/s})^2 \\approx 16.454\\,\\mathrm{Pa} $$\n从 $\\tau_w$ 计算摩擦速度 $u_{\\tau}$：\n$$ u_{\\tau} = \\sqrt{\\frac{\\tau_{w}}{\\rho}} = \\sqrt{\\frac{16.454\\,\\mathrm{Pa}}{1.2\\,\\mathrm{kg/m^3}}} \\approx 3.703\\,\\mathrm{m/s} $$\n\n接下来，我们计算在 $x=1.0\\,\\mathrm{m}$ 处的边界层厚度 $\\delta$：\n$$ \\delta = 0.37 \\, x \\, \\mathrm{Re}_{x}^{-1/5} = 0.37 \\times (1.0\\,\\mathrm{m}) \\times \\left(\\frac{2}{3} \\times 10^7\\right)^{-1/5} \\approx 0.01597\\,\\mathrm{m} $$\n棱柱层堆栈的总高度 $H_{target}$ 必须覆盖该厚度的 $f=0.80$：\n$$ H_{target} = f \\cdot \\delta = 0.80 \\times 0.01597\\,\\mathrm{m} \\approx 0.01278\\,\\mathrm{m} $$\n\n现在，我们确定近壁第一层网格的尺寸。第一层的壁面法向厚度 $\\Delta y_1$ 是根据其壁面单位高度 $\\Delta y^{+}$ 为 $1.0$ 的要求得出的：\n$$ \\Delta y^{+} = \\frac{\\Delta y_1 u_{\\tau}}{\\nu} = 1.0 $$\n$$ \\Delta y_1 = \\frac{1.0 \\cdot \\nu}{u_{\\tau}} = \\frac{1.5 \\times 10^{-5}\\,\\mathrm{m^2/s}}{3.703\\,\\mathrm{m/s}} \\approx 4.051 \\times 10^{-6}\\,\\mathrm{m} $$\n\n我们必须检查纵横比约束 $\\mathrm{AR} \\le \\mathrm{AR}_{\\max} = 150$。壁面平行方向的单元尺寸 $\\Delta x_{cell}$ 由 $\\Delta x^{+} = 40$ 的要求设定：\n$$ \\Delta x^{+} = \\frac{\\Delta x_{cell} u_{\\tau}}{\\nu} = 40 $$\n$$ \\Delta x_{cell} = \\frac{40 \\cdot \\nu}{u_{\\tau}} = 40 \\cdot \\Delta y_1 $$\n第一层的纵横比 $\\mathrm{AR}_1$（假设为最大值）为：\n$$ \\mathrm{AR}_1 = \\frac{\\Delta x_{cell}}{\\Delta y_1} = \\frac{40 \\cdot \\Delta y_1}{\\Delta y_1} = 40 $$\n由于 $40  150$，纵横比约束得到满足。\n\n最后，我们求最小层数 $N$。各层厚度遵循几何级数 $\\Delta y_k = \\Delta y_1 g^{k-1}$，增长率为 $g = 1.20$。$N$ 层的总高度 $H_N$ 是该级数的和：\n$$ H_N = \\sum_{k=1}^{N} \\Delta y_1 g^{k-1} = \\Delta y_1 \\frac{g^N - 1}{g - 1} $$\n我们必须满足条件 $H_N \\geq H_{target}$：\n$$ \\Delta y_1 \\frac{g^N - 1}{g - 1} \\geq f \\delta $$\n代入已计算出的量：\n$$ (4.051 \\times 10^{-6}\\,\\mathrm{m}) \\frac{1.2^N - 1}{1.2 - 1} \\geq 0.01278\\,\\mathrm{m} $$\n$$ \\frac{1.2^N - 1}{0.2} \\geq \\frac{0.01278}{4.051 \\times 10^{-6}} \\approx 3155 $$\n$$ 1.2^N - 1 \\geq 0.2 \\times 3155 = 631 $$\n$$ 1.2^N \\geq 632 $$\n为了求解 $N$，我们对不等式两边取自然对数：\n$$ N \\ln(1.2) \\geq \\ln(632) $$\n$$ N \\geq \\frac{\\ln(632)}{\\ln(1.2)} \\approx \\frac{6.4489}{0.18232} \\approx 35.37 $$\n由于层数 $N$ 必须是整数，我们取大于或等于 $35.37$ 的最小整数，即对结果向上取整。\n$$ N = \\lceil 35.37 \\rceil = 36 $$\n因此，需要最少 36 个棱柱层来满足指定的设计标准。",
            "answer": "$$\\boxed{36}$$"
        },
        {
            "introduction": "一个强大的 CFD 求解器必须能够处理包含多种单元和面类型的复杂混合网格。本练习将带你深入求解器的核心，模拟在混合拓扑结构上执行通量计算的过程。你将从基本守恒定律出发，推导并实现一个统一的通量离散格式，并将其应用于一个包含棱柱和四面体单元的网格上，体验如何编写能够处理混合拓扑的通用面循环算法 。",
            "id": "3998357",
            "problem": "您的任务是为一个混合非结构化网格设计数据结构和算法，该网格由棱柱型边界层单元和四面体核心组成，其中的面具有混合拓扑类型（三角形和四边形）。任务是在所有面上一致地组装扩散通量，并为一个小型的测试套件生成残差范数。该问题必须使用守恒和离散化的第一性原理来解决，不假设任何“黑箱”公式。\n\n基本原理：从由具有恒定扩散系数的守恒定律控制的稳态标量扩散的积分控制体形式出发。对于标量场 $q(\\mathbf{x})$ 和恒定扩散系数 $k$，在控制体 $V_i$ 上的守恒声明为净向外扩散通量为零：\n$$\n\\int_{\\partial V_i} k \\nabla q \\cdot \\mathbf{n} \\, \\mathrm{d}S = 0,\n$$\n其中 $\\partial V_i$ 是 $V_i$ 的边界，$\\mathbf{n}$ 是向外的单位法向量。使用有限体积法（FVM），并推导一个一致的基于面的离散通量，该通量仅使用面多边形的局部几何信息和相邻单元的中心，应用散度定理和法向导数的两点法向差分近似。不要假设任何闭合形式的通量公式；从这些原理中推导出所需的一切。\n\n网格规范。该混合网格包含一个与平面 $z=0$ 相邻的棱柱单元和一个附着在其上方的四面体单元。节点由索引 $0$ 到 $6$ 标记，并具有以下坐标：\n- $0: (0,0,0)$\n- $1: (1,0,0)$\n- $2: (0,1,0)$\n- $3: (0,0,0.2)$\n- $4: (1,0,0.2)$\n- $5: (0,1,0.2)$\n- $6: (0.2,0.2,1.0)$\n\n单元：\n- 单元 $0$（类型：棱柱体）使用节点 $[0,1,2,3,4,5]$。\n- 单元 $1$（类型：四面体）使用节点 $[3,4,5,6]$。\n\n面（每个面以一致的顺序存储其多边形节点索引，以及由左右单元索引表示的邻接关系，其中 $-1$ 表示边界面）：\n- 面 $0$：类型 三角形，节点 $[0,1,2]$，左 $=0$，右 $=-1$（边界面）。\n- 面 $1$：类型 四边形，节点 $[0,1,4,3]$，左 $=0$，右 $=-1$（边界面）。\n- 面 $2$：类型 四边形，节点 $[1,2,5,4]$，左 $=0$，右 $=-1$（边界面）。\n- 面 $3$：类型 四边形，节点 $[2,0,3,5]$，左 $=0$，右 $=-1$（边界面）。\n- 面 $4$：类型 三角形，节点 $[3,4,5]$，左 $=0$，右 $=1$（内面）。\n- 面 $5$：类型 三角形，节点 $[3,4,6]$，左 $=1$，右 $=-1$（边界面）。\n- 面 $6$：类型 三角形，节点 $[4,5,6]$，左 $=1$，右 $=-1$（边界面）。\n- 面 $7$：类型 三角形，节点 $[5,3,6]$，左 $=1$，右 $=-1$（边界面）。\n\n几何要求：\n- 根据每个面的多边形顶点计算其面面积矢量 $\\mathbf{a}_f$；其大小为面面积 $A_f = \\|\\mathbf{a}_f\\|$，其单位法向量为 $\\mathbf{n}_f = \\mathbf{a}_f / A_f$。\n- 对于内面，定向每个面面积矢量，使其从左侧单元中心 $\\mathbf{c}_L$ 指向右侧单元中心 $\\mathbf{c}_R$；对于边界面，通过与从 $\\mathbf{c}_L$ 到面质心的矢量对齐，使其指向左侧单元的外部。\n- 将单元中心 $\\mathbf{c}_i$ 计算为其节点坐标的平均值。\n- 对于内面，将距离 $d_f$ 计算为中心到中心矢量在 $\\mathbf{n}_f$ 上的投影；对于边界面，计算为从左侧中心到面质心的投影，使用 $d_f = |\\left(\\mathbf{p} \\cdot \\mathbf{n}_f\\right)|$，其中 $\\mathbf{p}$ 是相应的位移矢量。\n\n通量组装要求：\n- 推导并实现一个一致的扩散通量两点离散格式，该格式穿过一个面 $f$，取决于 $k$、$A_f$、沿法向的标量值差异以及 $d_f$，且通量方向朝向左侧单元的外部。对于内面，使用与左右单元相关联的标量值 $q_L$ 和 $q_R$。对于具有狄利克雷边界值 $q_b$ 的边界面，使用 $q_b$ 代替右侧状态。\n- 将单元残差 $r_i$ 组装为与单元 $i$ 相邻的所有面上的向外通量贡献之和，并带有适当的符号，确保对于两个单元共享的内面，通量加到左侧单元，并从右侧单元减去。\n\n测试套件。对于以下每组参数 $(k,q_0,q_1,q_b)$，其中 $k$ 是扩散系数，$q_0,q_1$ 是与单元 $0$ 和 $1$ 相关联的标量值，$q_b$ 是边界狄利克雷值，计算残差向量的欧几里得范数 $\\|\\mathbf{r}\\|_2$ 作为浮点数：\n- 情况 $1$：$(1.0, 1.0, 0.0, 0.0)$。\n- 情况 $2$：$(2.0, 3.0, 3.0, 3.0)$。\n- 情况 $3$：$(5.0, 0.0, 0.5, 2.0)$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[x_1,x_2,x_3]$，其中 $x_i$ 是情况 $i$ 的 $\\|\\mathbf{r}\\|_2$ 的值。不应打印其他任何文本。\n- 所有计算都应以纯数学术语进行，使用无量纲量；不使用任何物理单位。",
            "solution": "我们从扩散标量的稳态守恒开始，该守恒规定任何控制体的净向外扩散通量为零。设 $q(\\mathbf{x})$ 为一个标量场，$k$ 为一个恒定的扩散系数。在一个控制体 $V_i$ 上，我们有：\n$$\n\\int_{\\partial V_i} k \\nabla q \\cdot \\mathbf{n} \\, \\mathrm{d}S = 0.\n$$\n这是守恒定律的积分形式。使用有限体积法（FVM），我们将区域离散为单元 $V_i$，并将面积分近似为对面上的求和。对于一个面积为 $A_f$、向外单位法向量为 $\\mathbf{n}_f$（朝向左侧单元外部）的面 $f$，其扩散通量贡献为：\n$$\n\\Phi_f = \\int_{S_f} k \\nabla q \\cdot \\mathbf{n}_f \\, \\mathrm{d}S \\approx k A_f \\left(\\frac{\\partial q}{\\partial n}\\right)_f,\n$$\n其中 $\\left(\\frac{\\partial q}{\\partial n}\\right)_f$ 是在面上的法向导数。为了封闭这个方程，我们采用两点法向差分近似，这是通过将梯度投影到连接单元中心的直线上，并沿法向调用局部一维近似得出的。设 $\\mathbf{c}_L$ 和 $\\mathbf{c}_R$ 分别为内面的左侧和右侧单元的中心，并设 $d_f$ 为投影距离：\n$$\nd_f = \\left|(\\mathbf{c}_R - \\mathbf{c}_L) \\cdot \\mathbf{n}_f \\right|.\n$$\n那么法向导数可近似为：\n$$\n\\left(\\frac{\\partial q}{\\partial n}\\right)_f \\approx \\frac{q_R - q_L}{d_f},\n$$\n这得出了定向的面通量（朝向左侧单元外部）：\n$$\n\\Phi_f = k A_f \\frac{q_R - q_L}{d_f}.\n$$\n扩散遵循菲克定律，通量从高 $q$ 值指向低 $q$ 值。在朝向左侧单元外部的定向中，我们包含标准的负号以与梯度下降对齐：\n$$\n\\Phi_f = -k A_f \\frac{q_R - q_L}{d_f}.\n$$\n对于一个具有狄利克雷数据 $q_b$ 的边界面，我们将其视为与一个在 $q_R = q_b$ 的虚拟状态相邻。我们用面质心 $\\mathbf{x}_f$ 替换 $\\mathbf{c}_R$，使用位移 $\\mathbf{x}_f - \\mathbf{c}_L$ 计算向外方向，并设置：\n$$\nd_f = \\left|(\\mathbf{x}_f - \\mathbf{c}_L) \\cdot \\mathbf{n}_f \\right|,\\quad q_R = q_b,\n$$\n因此：\n$$\n\\Phi_f^{\\text{boundary}} = -k A_f \\frac{q_b - q_L}{d_f}.\n$$\n组装。对于每个单元 $i$，将其残差 $r_i$ 定义为其所有面上的向外通量之和。对于由左右单元共享的内面，其向外通量定义为从左到右，守恒要求我们将 $+\\Phi_f$ 加到左单元的残差上，并将 $-\\Phi_f$ 加到右单元的残差上，以确保在对所有单元求和时，内面上的通量能够抵消：\n$$\nr_L \\mathrel{+}= \\Phi_f, \\quad r_R \\mathrel{+}= -\\Phi_f.\n$$\n对于边界面，只有左侧单元接收向外通量：\n$$\nr_L \\mathrel{+}= \\Phi_f^{\\text{boundary}}.\n$$\n几何。对于一个具有有序顶点 $\\{\\mathbf{v}_0, \\mathbf{v}_1, \\dots, \\mathbf{v}_{m-1}\\}$ 的多边形面，其面积矢量可以通过著名公式获得：\n$$\n\\mathbf{a}_f = \\frac{1}{2} \\sum_{i=0}^{m-1} \\mathbf{v}_i \\times \\mathbf{v}_{i+1}, \\quad \\mathbf{v}_m \\equiv \\mathbf{v}_0,\n$$\n该公式根据顶点顺序同时得出面积和法线方向。面质心可以计算为算术平均值：\n$$\n\\mathbf{x}_f = \\frac{1}{m}\\sum_{i=0}^{m-1} \\mathbf{v}_i.\n$$\n为确保正确的向外方向，我们重新定向 $\\mathbf{a}_f$，使其对于内面从左侧单元中心指向右侧单元中心，即如果 $(\\mathbf{c}_R - \\mathbf{c}_L) \\cdot \\mathbf{a}_f  0$，则翻转 $\\mathbf{a}_f \\leftarrow -\\mathbf{a}_f$。对于边界面，通过在必要时翻转，强制执行 $(\\mathbf{x}_f - \\mathbf{c}_L) \\cdot \\mathbf{a}_f  0$。\n\n单元中心近似为顶点平均值：\n$$\n\\mathbf{c}_i = \\frac{1}{n_i}\\sum_{j=1}^{n_i} \\mathbf{v}_j^{(i)},\n$$\n这在混合非结构化方案中很常见，当一个简单的中心对于两点通量近似已经足够时。\n\n测试套件和输出。对于每组参数 $(k,q_0,q_1,q_b)$：\n- 将 $q_0$ 赋给单元 $0$，将 $q_1$ 赋给单元 $1$。\n- 组装所有面通量和残差 $\\{r_0, r_1\\}$。\n- 报告欧几里得范数：\n$$\n\\|\\mathbf{r}\\|_2 = \\sqrt{r_0^2 + r_1^2}.\n$$\n为以下三种情况计算此值：\n- 情况 $1$：$(1.0, 1.0, 0.0, 0.0)$。\n- 情况 $2$：$(2.0, 3.0, 3.0, 3.0)$。\n- 情况 $3$：$(5.0, 0.0, 0.5, 2.0)$。\n\n最后，打印一行，其中包含 $[\\|\\mathbf{r}\\|_2^{(1)},\\|\\mathbf{r}\\|_2^{(2)},\\|\\mathbf{r}\\|_2^{(3)}]$，值为逗号分隔并用方括号括起。此设计展示了在混合网格中对混合拓扑进行有原则的面迭代，与从第一性原理推导出的守恒和局部几何推理相一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef polygon_area_vector(vertices):\n    \"\"\"\n    Compute the area vector (magnitude equals area, direction is normal)\n    for a planar polygon given by its ordered vertices.\n    Uses 0.5 * sum_{i} v_i x v_{i+1}.\n    \"\"\"\n    acc = np.zeros(3, dtype=float)\n    n = len(vertices)\n    for i in range(n):\n        v_i = vertices[i]\n        v_ip1 = vertices[(i + 1) % n]\n        acc += np.cross(v_i, v_ip1)\n    return 0.5 * acc\n\ndef face_centroid(vertices):\n    return np.mean(vertices, axis=0)\n\ndef unit(vec):\n    nrm = np.linalg.norm(vec)\n    if nrm == 0.0:\n        return vec\n    return vec / nrm\n\ndef build_mesh():\n    # Node coordinates\n    nodes = np.array([\n        [0.0, 0.0, 0.0],   # 0\n        [1.0, 0.0, 0.0],   # 1\n        [0.0, 1.0, 0.0],   # 2\n        [0.0, 0.0, 0.2],   # 3\n        [1.0, 0.0, 0.2],   # 4\n        [0.0, 1.0, 0.2],   # 5\n        [0.2, 0.2, 1.0],   # 6\n    ], dtype=float)\n\n    # Faces: type, nodes, left cell, right cell\n    faces = [\n        {\"type\": \"tri\",  \"nodes\": [0, 1, 2],      \"left\": 0, \"right\": -1},  # bottom prism (boundary)\n        {\"type\": \"quad\", \"nodes\": [0, 1, 4, 3],   \"left\": 0, \"right\": -1},  # side (boundary)\n        {\"type\": \"quad\", \"nodes\": [1, 2, 5, 4],   \"left\": 0, \"right\": -1},  # side (boundary)\n        {\"type\": \"quad\", \"nodes\": [2, 0, 3, 5],   \"left\": 0, \"right\": -1},  # side (boundary)\n        {\"type\": \"tri\",  \"nodes\": [3, 4, 5],      \"left\": 0, \"right\": 1},   # interior shared\n        {\"type\": \"tri\",  \"nodes\": [3, 4, 6],      \"left\": 1, \"right\": -1},  # boundary\n        {\"type\": \"tri\",  \"nodes\": [4, 5, 6],      \"left\": 1, \"right\": -1},  # boundary\n        {\"type\": \"tri\",  \"nodes\": [5, 3, 6],      \"left\": 1, \"right\": -1},  # boundary\n    ]\n\n    # Cells: type, nodes, faces\n    cells = [\n        {\"type\": \"prism\", \"nodes\": [0, 1, 2, 3, 4, 5], \"faces\": [0, 1, 2, 3, 4]},\n        {\"type\": \"tet\",   \"nodes\": [3, 4, 5, 6],       \"faces\": [4, 5, 6, 7]},\n    ]\n\n    # Compute cell centers (simple vertex average)\n    cell_centers = []\n    for c in cells:\n        pts = nodes[np.array(c[\"nodes\"], dtype=int)]\n        cell_centers.append(np.mean(pts, axis=0))\n    cell_centers = np.array(cell_centers)\n\n    return nodes, faces, cells, cell_centers\n\ndef orient_face_and_geom(face, nodes, cell_centers):\n    \"\"\"\n    Compute oriented area vector, area, unit normal, centroid, and distance measure\n    d_f appropriate for interior or boundary faces, ensuring outward orientation from left cell.\n    Returns:\n        area_vector, area, normal_hat, centroid, d_f\n    \"\"\"\n    # Gather vertices\n    verts = nodes[np.array(face[\"nodes\"], dtype=int)]\n    area_vec = polygon_area_vector(verts)\n    centroid = face_centroid(verts)\n\n    left = face[\"left\"]\n    right = face[\"right\"]\n    cL = cell_centers[left]\n    if right != -1:\n        cR = cell_centers[right]\n        # Orient area vector from left to right\n        if np.dot(area_vec, cR - cL)  0.0:\n            area_vec = -area_vec\n        area = np.linalg.norm(area_vec)\n        n_hat = unit(area_vec)\n        d_f = abs(np.dot(cR - cL, n_hat))\n    else:\n        # Boundary: orient area vector outward of left cell, using centroid\n        if np.dot(area_vec, centroid - cL)  0.0:\n            area_vec = -area_vec\n        area = np.linalg.norm(area_vec)\n        n_hat = unit(area_vec)\n        d_f = abs(np.dot(centroid - cL, n_hat))\n    return area_vec, area, n_hat, centroid, d_f\n\ndef assemble_fluxes(k, q_cells, q_boundary):\n    \"\"\"\n    Assemble residuals for all cells using two-point diffusive flux across mixed faces.\n    \"\"\"\n    nodes, faces, cells, cell_centers = build_mesh()\n    residuals = np.zeros(len(cells), dtype=float)\n\n    for f in faces:\n        area_vec, area, n_hat, centroid, d_f = orient_face_and_geom(f, nodes, cell_centers)\n        \n        if d_f  1e-12: continue\n\n        left = f[\"left\"]\n        right = f[\"right\"]\n        qL = q_cells[left]\n        if right != -1:\n            qR = q_cells[right]\n            # Two-point face flux oriented outward of left cell\n            flux = -k * area * (qR - qL) / d_f\n            # Assemble\n            residuals[left] += flux\n            residuals[right] -= flux\n        else:\n            qR = q_boundary\n            flux = -k * area * (qR - qL) / d_f\n            residuals[left] += flux\n\n    return residuals\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (k, q0, q1, qb)\n    test_cases = [\n        (1.0, 1.0, 0.0, 0.0),  # Case 1\n        (2.0, 3.0, 3.0, 3.0),  # Case 2\n        (5.0, 0.0, 0.5, 2.0),  # Case 3\n    ]\n\n    results = []\n    for k, q0, q1, qb in test_cases:\n        q_cells = np.array([q0, q1], dtype=float)\n        residuals = assemble_fluxes(k, q_cells, q_boundary=qb)\n        l2 = float(np.sqrt(np.sum(residuals**2)))\n        results.append(l2)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}