{
    "hands_on_practices": [
        {
            "introduction": "The starting point for any high-order finite volume method is approximating the data's gradient within each computational cell. This exercise walks through the essential process of calculating this gradient using a weighted least-squares approach on an unstructured grid, a technique central to modern CFD solvers (). Mastering this fundamental calculation is key to building accurate and flexible numerical schemes.",
            "id": "3989902",
            "problem": "In a cell-centered Finite Volume Method for Computational Fluid Dynamics (CFD), second-order face reconstruction of a scalar field relies on a local linear approximation derived from the Taylor series expansion about a cell centroid. Consider an unstructured triangular control volume indexed as cell $i$ with centroid coordinates $\\boldsymbol{x}_i = (0, 0)$ and a dimensionless scalar field cell-average $\\phi_i = 2$. The three neighboring cells across each face of cell $i$ have centroids and cell-average values given by\n$$\n\\boldsymbol{x}_{j_1} = (1, 0), \\quad \\phi_{j_1} = 5, \\qquad\n\\boldsymbol{x}_{j_2} = (0, 1), \\quad \\phi_{j_2} = 1, \\qquad\n\\boldsymbol{x}_{j_3} = (-1, -1), \\quad \\phi_{j_3} = 0.\n$$\nTo obtain a consistent linear reconstruction, approximate the gradient at cell $i$ via a weighted least-squares fit to the first-order Taylor expansion,\n$$\n\\phi(\\boldsymbol{x}_i + \\boldsymbol{r}_j) \\approx \\phi_i + \\nabla \\phi_i \\cdot \\boldsymbol{r}_j,\n$$\nwhere $\\boldsymbol{r}_j = \\boldsymbol{x}_j - \\boldsymbol{x}_i$ and the weights are chosen as $w_j = \\frac{1}{\\|\\boldsymbol{r}_j\\|^2}$. Use this gradient to reconstruct the scalar value at the specified face centroid $\\boldsymbol{x}_f = (0.45, -0.1)$ that lies on one of the faces of cell $i$, using the linear relation\n$$\n\\phi_f \\approx \\phi_i + \\nabla \\phi_i \\cdot (\\boldsymbol{x}_f - \\boldsymbol{x}_i).\n$$\nCompute the reconstructed face value $\\phi_f$ explicitly from the given data. Express the final answer as a dimensionless number and round your answer to four significant figures.",
            "solution": "The user has provided a well-defined problem in the field of Computational Fluid Dynamics (CFD), specifically concerning the reconstruction of a scalar value at a cell face using a weighted least-squares gradient approximation. The problem is scientifically grounded, well-posed, and all necessary data for its solution are provided. Therefore, the problem is valid.\n\nThe objective is to compute the reconstructed scalar value $\\phi_f$ at the face centroid $\\boldsymbol{x}_f = (0.45, -0.1)$. This requires a two-step process:\n1.  Compute the gradient of the scalar field at the centroid of cell $i$, $\\nabla \\phi_i$, using a weighted least-squares method.\n2.  Use this gradient in a first-order Taylor series expansion to extrapolate the value from the cell centroid $\\boldsymbol{x}_i$ to the face centroid $\\boldsymbol{x}_f$.\n\nLet the gradient vector at cell $i$ be denoted by $\\nabla \\phi_i = \\boldsymbol{g} = \\begin{pmatrix} g_x \\\\ g_y \\end{pmatrix}$. The first-order Taylor expansion for the scalar value $\\phi_j$ at a neighboring cell centroid $\\boldsymbol{x}_j$ relative to cell $i$ is\n$$\n\\phi_j \\approx \\phi_i + \\nabla \\phi_i \\cdot (\\boldsymbol{x}_j - \\boldsymbol{x}_i)\n$$\nRearranging this gives an expression for the difference in scalar values:\n$$\n\\phi_j - \\phi_i \\approx \\boldsymbol{g} \\cdot \\boldsymbol{r}_j\n$$\nwhere $\\boldsymbol{r}_j = \\boldsymbol{x}_j - \\boldsymbol{x}_i$ is the vector from centroid $i$ to centroid $j$.\n\nThe weighted least-squares method seeks to find the gradient $\\boldsymbol{g}$ that minimizes the sum of the squared, weighted residuals over the set of $N=3$ neighboring cells. The objective function to minimize is:\n$$\nS(g_x, g_y) = \\sum_{j=1}^{N} w_j \\left( (\\phi_j - \\phi_i) - (g_x r_{jx} + g_y r_{jy}) \\right)^2\n$$\nwhere $w_j = \\frac{1}{\\|\\boldsymbol{r}_j\\|^2}$ are the specified weights.\n\nTo minimize $S$, we take the partial derivatives with respect to $g_x$ and $g_y$ and set them to zero:\n$$\n\\frac{\\partial S}{\\partial g_x} = 0, \\quad \\frac{\\partial S}{\\partial g_y} = 0\n$$\nThis leads to the normal equations, which can be expressed in matrix form as $A \\boldsymbol{g} = \\boldsymbol{b}$, where:\n$$\nA = \\begin{pmatrix} \\sum_{j=1}^N w_j r_{jx}^2 & \\sum_{j=1}^N w_j r_{jx} r_{jy} \\\\ \\sum_{j=1}^N w_j r_{jx} r_{jy} & \\sum_{j=1}^N w_j r_{jy}^2 \\end{pmatrix}, \\quad \\boldsymbol{b} = \\begin{pmatrix} \\sum_{j=1}^N w_j (\\phi_j - \\phi_i) r_{jx} \\\\ \\sum_{j=1}^N w_j (\\phi_j - \\phi_i) r_{jy} \\end{pmatrix}\n$$\n\nFirst, we process the given data. The central cell is $i$ with $\\boldsymbol{x}_i = (0, 0)$ and $\\phi_i = 2$. Let $\\Delta\\phi_j = \\phi_j - \\phi_i$.\n\nFor neighbor $j_1$:\n$\\boldsymbol{x}_{j_1} = (1, 0)$, $\\phi_{j_1} = 5$.\n$\\boldsymbol{r}_{j_1} = \\boldsymbol{x}_{j_1} - \\boldsymbol{x}_i = (1, 0)$.\n$\\Delta\\phi_{j_1} = 5 - 2 = 3$.\n$\\|\\boldsymbol{r}_{j_1}\\|^2 = 1^2 + 0^2 = 1$, so $w_{j_1} = \\frac{1}{1} = 1$.\n\nFor neighbor $j_2$:\n$\\boldsymbol{x}_{j_2} = (0, 1)$, $\\phi_{j_2} = 1$.\n$\\boldsymbol{r}_{j_2} = \\boldsymbol{x}_{j_2} - \\boldsymbol{x}_i = (0, 1)$.\n$\\Delta\\phi_{j_2} = 1 - 2 = -1$.\n$\\|\\boldsymbol{r}_{j_2}\\|^2 = 0^2 + 1^2 = 1$, so $w_{j_2} = \\frac{1}{1} = 1$.\n\nFor neighbor $j_3$:\n$\\boldsymbol{x}_{j_3} = (-1, -1)$, $\\phi_{j_3} = 0$.\n$\\boldsymbol{r}_{j_3} = \\boldsymbol{x}_{j_3} - \\boldsymbol{x}_i = (-1, -1)$.\n$\\Delta\\phi_{j_3} = 0 - 2 = -2$.\n$\\|\\boldsymbol{r}_{j_3}\\|^2 = (-1)^2 + (-1)^2 = 2$, so $w_{j_3} = \\frac{1}{2}$.\n\nNow, we assemble matrix $A$:\n$A_{11} = \\sum w_j r_{jx}^2 = (1)(1^2) + (1)(0^2) + (\\frac{1}{2})(-1)^2 = 1 + 0 + \\frac{1}{2} = \\frac{3}{2}$.\n$A_{22} = \\sum w_j r_{jy}^2 = (1)(0^2) + (1)(1^2) + (\\frac{1}{2})(-1)^2 = 0 + 1 + \\frac{1}{2} = \\frac{3}{2}$.\n$A_{12} = A_{21} = \\sum w_j r_{jx} r_{jy} = (1)(1)(0) + (1)(0)(1) + (\\frac{1}{2})(-1)(-1) = 0 + 0 + \\frac{1}{2} = \\frac{1}{2}$.\nSo, the matrix $A$ is:\n$$\nA = \\begin{pmatrix} \\frac{3}{2} & \\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{3}{2} \\end{pmatrix}\n$$\n\nNext, we assemble vector $\\boldsymbol{b}$:\n$b_x = \\sum w_j \\Delta\\phi_j r_{jx} = (1)(3)(1) + (1)(-1)(0) + (\\frac{1}{2})(-2)(-1) = 3 + 0 + 1 = 4$.\n$b_y = \\sum w_j \\Delta\\phi_j r_{jy} = (1)(3)(0) + (1)(-1)(1) + (\\frac{1}{2})(-2)(-1) = 0 - 1 + 1 = 0$.\nSo, the vector $\\boldsymbol{b}$ is:\n$$\n\\boldsymbol{b} = \\begin{pmatrix} 4 \\\\ 0 \\end{pmatrix}\n$$\n\nWe solve the linear system $A \\boldsymbol{g} = \\boldsymbol{b}$:\n$$\n\\begin{pmatrix} \\frac{3}{2} & \\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{3}{2} \\end{pmatrix} \\begin{pmatrix} g_x \\\\ g_y \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ 0 \\end{pmatrix}\n$$\nThis represents the equations:\n1.  $\\frac{3}{2}g_x + \\frac{1}{2}g_y = 4$\n2.  $\\frac{1}{2}g_x + \\frac{3}{2}g_y = 0$\n\nFrom a second equation, we find $g_x = -3g_y$. Substituting this into the first equation:\n$\\frac{3}{2}(-3g_y) + \\frac{1}{2}g_y = 4$\n$-\\frac{9}{2}g_y + \\frac{1}{2}g_y = 4$\n$-\\frac{8}{2}g_y = 4 \\implies -4g_y = 4 \\implies g_y = -1$.\nThen, $g_x = -3(-1) = 3$.\nThe computed gradient is $\\nabla \\phi_i = \\boldsymbol{g} = \\begin{pmatrix} 3 \\\\ -1 \\end{pmatrix}$.\n\nFinally, we reconstruct the value at the face centroid $\\boldsymbol{x}_f = (0.45, -0.1)$ using the linear reconstruction formula:\n$$\n\\phi_f \\approx \\phi_i + \\nabla \\phi_i \\cdot (\\boldsymbol{x}_f - \\boldsymbol{x}_i)\n$$\nSince $\\boldsymbol{x}_i = (0, 0)$, the vector pointing from the cell centroid to the face centroid is $\\boldsymbol{x}_f - \\boldsymbol{x}_i = (0.45, -0.1)$.\nSubstituting the known values:\n$$\n\\phi_f \\approx 2 + \\begin{pmatrix} 3 \\\\ -1 \\end{pmatrix} \\cdot \\begin{pmatrix} 0.45 \\\\ -0.1 \\end{pmatrix}\n$$\n$$\n\\phi_f \\approx 2 + (3)(0.45) + (-1)(-0.1)\n$$\n$$\n\\phi_f \\approx 2 + 1.35 + 0.1\n$$\n$$\n\\phi_f \\approx 3.45\n$$\nThe problem requires the answer to be rounded to four significant figures. The exact result of the calculation is $3.45$. To express this value with four significant figures, we write it as $3.450$.",
            "answer": "$$\\boxed{3.450}$$"
        },
        {
            "introduction": "While linear reconstruction improves accuracy over first-order methods, it can introduce unphysical oscillations near sharp gradients, a significant challenge in shock-capturing schemes. This practice demonstrates a crucial remedy: the slope limiter, which ensures the Total Variation Diminishing (TVD) property (). By applying the Monotonized Central (MC) limiter, you will learn to constrain reconstructed slopes to produce stable and physically plausible solutions.",
            "id": "3989867",
            "problem": "Consider the one-dimensional linear advection of mass density in Computational Fluid Dynamics (CFD), governed by the scalar conservation law $ \\partial_t \\rho + a \\, \\partial_x \\rho = 0 $, where $ \\rho(x,t) $ is the mass density and $ a $ is the constant advection speed. In a conservative finite-volume formulation on a uniform grid, denote cell-averaged densities by $ \\bar{\\rho}_i $ over cells of width $ \\Delta x $. To obtain high-resolution, non-oscillatory face values needed for a consistent numerical flux, employ a piecewise-linear reconstruction with a slope limiter that enforces Total Variation Diminishing (TVD) behavior.\n\nUse the Monotonized Central (MC) limiter, which is a TVD limiter defined via the $\\minmod$ function. For any cell index $ i $, define the limited slope $ \\sigma_i $ by the formula\n$$\n\\sigma_i \\;=\\; \\minmod\\!\\Bigg( \\frac{\\bar{\\rho}_{i+1}-\\bar{\\rho}_{i-1}}{2\\,\\Delta x}, \\; \\frac{2\\,(\\bar{\\rho}_{i+1}-\\bar{\\rho}_i)}{\\Delta x}, \\; \\frac{2\\,(\\bar{\\rho}_i-\\bar{\\rho}_{i-1})}{\\Delta x} \\Bigg),\n$$\nwhere the three-argument $\\minmod$ function is\n$$\n\\minmod(\\alpha,\\beta,\\gamma) \\;=\\;\n\\begin{cases}\n\\mathrm{sign}(\\alpha)\\,\\min\\!\\big(|\\alpha|,|\\beta|,|\\gamma|\\big), & \\text{if } \\mathrm{sign}(\\alpha)=\\mathrm{sign}(\\beta)=\\mathrm{sign}(\\gamma), \\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\nWith piecewise-linear reconstruction, the left and right states at the interface $ x_{i+1/2} $ are\n$$\n\\rho_{i+1/2}^{-} \\;=\\; \\bar{\\rho}_i + \\sigma_i\\,\\frac{\\Delta x}{2}, \n\\qquad\n\\rho_{i+1/2}^{+} \\;=\\; \\bar{\\rho}_{i+1} - \\sigma_{i+1}\\,\\frac{\\Delta x}{2}.\n$$\n\nAssume a uniform mesh with $ \\Delta x = 0.02~\\mathrm{m} $, a constant advection speed $ a = 240~\\mathrm{m/s} $, and cell-averaged densities (in $ \\mathrm{kg/m^3} $)\n$$\n\\bar{\\rho}_{i-2} = 1.24, \\quad \\bar{\\rho}_{i-1} = 1.21, \\quad \\bar{\\rho}_{i} = 1.15, \\quad \\bar{\\rho}_{i+1} = 1.10, \\quad \\bar{\\rho}_{i+2} = 1.095.\n$$\n\nStarting from the conservation law and the finite-volume interpretation of face fluxes, apply the MC limiter to obtain the limited slopes $ \\sigma_i $ and $ \\sigma_{i+1} $, reconstruct the left and right interface states $ \\rho_{i+1/2}^{-} $ and $ \\rho_{i+1/2}^{+} $, and then use the upwind Godunov flux for linear advection to compute the mass flux at $ x_{i+1/2} $:\n$$\nF_{i+1/2} \\;=\\; a \\times \n\\begin{cases}\n\\rho_{i+1/2}^{-}, & \\text{if } a > 0, \\\\\n\\rho_{i+1/2}^{+}, & \\text{if } a < 0.\n\\end{cases}\n$$\n\nProvide the final numerical value of $ F_{i+1/2} $ in $ \\mathrm{kg\\,m^{-2}\\,s^{-1}} $. Round your answer to four significant figures.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in the principles of computational fluid dynamics, specifically the finite-volume method for conservation laws. It is well-posed, objective, self-contained, and free of contradictions or ambiguities. All necessary data and definitions for a unique solution are provided. We may therefore proceed with the solution.\n\nThe objective is to compute the numerical mass flux, $F_{i+1/2}$, at the interface $x_{i+1/2}$ between computational cells $i$ and $i+1$. This requires a high-resolution, piecewise-linear reconstruction of the density field, using the Monotonized Central (MC) limiter to ensure Total Variation Diminishing (TVD) properties. The flux is then determined using the Godunov upwind scheme.\n\nThe steps are as follows:\n1.  Compute the limited slope $\\sigma_i$ for cell $i$.\n2.  Compute the limited slope $\\sigma_{i+1}$ for cell $i+1$.\n3.  Reconstruct the density values at the left and right sides of the interface, $\\rho_{i+1/2}^{-}$ and $\\rho_{i+1/2}^{+}$, respectively.\n4.  Select the upwind density based on the sign of the advection speed $a$.\n5.  Calculate the mass flux $F_{i+1/2}$.\n\nThe provided data are:\n-   Cell-averaged densities: $\\bar{\\rho}_{i-2} = 1.24$, $\\bar{\\rho}_{i-1} = 1.21$, $\\bar{\\rho}_{i} = 1.15$, $\\bar{\\rho}_{i+1} = 1.10$, $\\bar{\\rho}_{i+2} = 1.095$. Note that all units are in $\\mathrm{kg/m^3}$.\n-   Cell width: $\\Delta x = 0.02~\\mathrm{m}$.\n-   Advection speed: $a = 240~\\mathrm{m/s}$.\n\n**Step 1: Calculation of the limited slope $\\sigma_i$**\n\nThe limited slope $\\sigma_i$ is defined by the MC limiter:\n$$\n\\sigma_i = \\minmod(\\alpha_i, \\beta_i, \\gamma_i)\n$$\nwhere the arguments are the centered, forward, and backward difference slopes (with the latter two scaled by a factor of $2$):\n$$\n\\alpha_i = \\frac{\\bar{\\rho}_{i+1}-\\bar{\\rho}_{i-1}}{2\\,\\Delta x}\n$$\n$$\n\\beta_i = \\frac{2\\,(\\bar{\\rho}_{i+1}-\\bar{\\rho}_i)}{\\Delta x}\n$$\n$$\n\\gamma_i = \\frac{2\\,(\\bar{\\rho}_i-\\bar{\\rho}_{i-1})}{\\Delta x}\n$$\nWe compute each argument using the given values:\n-   Centered slope:\n    $$\n    \\alpha_i = \\frac{1.10 - 1.21}{2 \\times 0.02} = \\frac{-0.11}{0.04} = -2.75\n    $$\n-   Forward-biased slope:\n    $$\n    \\beta_i = \\frac{2\\,(1.10 - 1.15)}{0.02} = \\frac{2\\,(-0.05)}{0.02} = -5.0\n    $$\n-   Backward-biased slope:\n    $$\n    \\gamma_i = \\frac{2\\,(1.15 - 1.21)}{0.02} = \\frac{2\\,(-0.06)}{0.02} = -6.0\n    $$\nAll three arguments, $\\alpha_i = -2.75$, $\\beta_i = -5.0$, and $\\gamma_i = -6.0$, are negative. Therefore, their signs are identical. The $\\minmod$ function will return the value with the smallest magnitude, prefixed by the common sign.\n$$\n\\sigma_i = \\mathrm{sign}(-2.75) \\times \\min(|\\!-\\!2.75|, |\\!-\\!5.0|, |\\!-\\!6.0|) = -1 \\times \\min(2.75, 5.0, 6.0) = -2.75\n$$\nSo, the limited slope in cell $i$ is $\\sigma_i = -2.75~\\mathrm{kg\\,m^{-4}}$.\n\n**Step 2: Calculation of the limited slope $\\sigma_{i+1}$**\n\nSimilarly, we compute the arguments for the MC limiter in cell $i+1$:\n$$\n\\alpha_{i+1} = \\frac{\\bar{\\rho}_{i+2}-\\bar{\\rho}_{i}}{2\\,\\Delta x} = \\frac{1.095 - 1.15}{2 \\times 0.02} = \\frac{-0.055}{0.04} = -1.375\n$$\n$$\n\\beta_{i+1} = \\frac{2\\,(\\bar{\\rho}_{i+2}-\\bar{\\rho}_{i+1})}{\\Delta x} = \\frac{2\\,(1.095 - 1.10)}{0.02} = \\frac{2\\,(-0.005)}{0.02} = -0.5\n$$\n$$\n\\gamma_{i+1} = \\frac{2\\,(\\bar{\\rho}_{i+1}-\\bar{\\rho}_{i})}{\\Delta x} = \\frac{2\\,(1.10 - 1.15)}{0.02} = \\frac{2\\,(-0.05)}{0.02} = -5.0\n$$\nAll three arguments, $\\alpha_{i+1} = -1.375$, $\\beta_{i+1} = -0.5$, and $\\gamma_{i+1} = -5.0$, are negative. Their signs are identical.\n$$\n\\sigma_{i+1} = \\mathrm{sign}(-1.375) \\times \\min(|\\!-\\!1.375|, |\\!-\\!0.5|, |\\!-\\!5.0|) = -1 \\times \\min(1.375, 0.5, 5.0) = -0.5\n$$\nThe limited slope in cell $i+1$ is $\\sigma_{i+1} = -0.5~\\mathrm{kg\\,m^{-4}}$.\n\n**Step 3: Reconstruction of interface states**\n\nUsing the piecewise-linear reconstruction formulas, we find the density values at the left and right sides of the interface $x_{i+1/2}$:\n-   Left state (reconstructed from cell $i$):\n    $$\n    \\rho_{i+1/2}^{-} = \\bar{\\rho}_i + \\sigma_i\\,\\frac{\\Delta x}{2} = 1.15 + (-2.75) \\times \\frac{0.02}{2} = 1.15 - 2.75 \\times 0.01 = 1.15 - 0.0275 = 1.1225~\\mathrm{kg/m^3}\n    $$\n-   Right state (reconstructed from cell $i+1$):\n    $$\n    \\rho_{i+1/2}^{+} = \\bar{\\rho}_{i+1} - \\sigma_{i+1}\\,\\frac{\\Delta x}{2} = 1.10 - (-0.5) \\times \\frac{0.02}{2} = 1.10 + 0.5 \\times 0.01 = 1.10 + 0.005 = 1.105~\\mathrm{kg/m^3}\n    $$\n\n**Step 4: Application of the upwind Godunov flux**\n\nThe Godunov flux for linear advection is an upwind flux. The choice of the state at the interface depends on the direction of information propagation, which is determined by the sign of the advection speed $a$.\nThe flux is given by:\n$$\nF_{i+1/2} \\;=\\; a \\times \n\\begin{cases}\n\\rho_{i+1/2}^{-}, & \\text{if } a > 0, \\\\\n\\rho_{i+1/2}^{+}, & \\text{if } a < 0.\n\\end{cases}\n$$\nIn this problem, the advection speed is $a = 240~\\mathrm{m/s}$, which is positive ($a > 0$). Therefore, the information travels from left to right, and the flux is determined by the left state, $\\rho_{i+1/2}^{-}$.\n$$\nF_{i+1/2} = a \\times \\rho_{i+1/2}^{-}\n$$\n\n**Step 5: Final flux computation**\n\nSubstituting the numerical values for $a$ and $\\rho_{i+1/2}^{-}$:\n$$\nF_{i+1/2} = 240~\\mathrm{m/s} \\times 1.1225~\\mathrm{kg/m^3} = 269.4~\\mathrm{kg\\,m^{-2}\\,s^{-1}}\n$$\nThe problem requires the answer to be rounded to four significant figures. The calculated value $269.4$ already has four significant figures.",
            "answer": "$$\\boxed{269.4}$$"
        },
        {
            "introduction": "A cornerstone of developing reliable numerical methods is verification, the process of ensuring that a coded algorithm performs as theory predicts. This comprehensive exercise guides you through designing a numerical experiment to confirm the second-order accuracy of a linear reconstruction scheme (). Performing such a convergence study is a critical skill for validating CFD codes and quantifying their accuracy.",
            "id": "3989859",
            "problem": "You are to design and implement a numerical experiment in one spatial dimension to verify second-order convergence of reconstructed cell-face fluxes for a smooth scalar field using a finite volume viewpoint in Computational Fluid Dynamics (CFD). Your experiment must start from fundamental definitions and proceed without assuming the target convergence result. The mathematical setting is a periodic domain and a smooth conserved quantity, with linear advection flux, and reconstruction of face values from cell-averaged data.\n\nBegin with the scalar conservation law in one spatial dimension on the periodic interval $[0,1]$,\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0,\n$$\nwith constant-speed linear advection flux $f(u) = a\\,u$, where $a$ is a constant. For a finite volume partition, let cell $i$ have edges located at $x_{i-\\frac{1}{2}}$ and $x_{i+\\frac{1}{2}}$, center at $x_i = \\tfrac{1}{2}(x_{i-\\frac{1}{2}} + x_{i+\\frac{1}{2}})$, and width $\\Delta x_i = x_{i+\\frac{1}{2}} - x_{i-\\frac{1}{2}}$. The cell average of $u$ is defined by\n$$\n\\bar{u}_i = \\frac{1}{\\Delta x_i}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x)\\,dx.\n$$\nThe face flux at face $x_{i+\\frac{1}{2}}$ is $f(u(x_{i+\\frac{1}{2}})) = a\\,u(x_{i+\\frac{1}{2}})$. In a reconstruction-based method, one approximates $u(x_{i+\\frac{1}{2}})$ using nearby cell data. In this experiment, reconstruct $u(x_{i+\\frac{1}{2}})$ from cell averages by treating $\\bar{u}_i$ and $\\bar{u}_{i+1}$ as pointwise samples at $x_i$ and $x_{i+1}$, and linearly interpolating to $x_{i+\\frac{1}{2}}$ with geometric weights based on distances between centers and faces. This procedure is expected to yield second-order accurate face values for smooth $u$.\n\nUse the smooth periodic function\n$$\nu(x) = \\sin(2\\pi x) + \\tfrac{1}{2}\\cos(4\\pi x),\n$$\nand choose $a = 1$. To obtain cell averages, use the exact integral formulas over each cell:\n$$\n\\int_{x_L}^{x_R} \\sin(2\\pi x)\\,dx = -\\frac{\\cos(2\\pi x)}{2\\pi}\\Big|_{x_L}^{x_R},\\qquad\n\\int_{x_L}^{x_R} \\tfrac{1}{2}\\cos(4\\pi x)\\,dx = \\frac{\\sin(4\\pi x)}{8\\pi}\\Big|_{x_L}^{x_R},\n$$\nand divide by the cell width to get $\\bar{u}_i$.\n\nGrids to be used:\n- Uniform periodic grid on $[0,1]$ with $N$ cells and faces at $x_j = j/N$ for $j \\in \\{0,1,\\dots,N\\}$.\n- Smoothly stretched periodic grid defined by the monotone mapping $x(s) = \\dfrac{e^{k s} - 1}{e^k - 1}$ with $s \\in [0,1]$, $k = 3$, and faces at $s_j = j/N$, $j \\in \\{0,1,\\dots,N\\}$, mapped to $x_j = x(s_j)$.\n\nFor both grid families, construct the reconstruction at each face $x_{i+\\frac{1}{2}}$ by linear interpolation of the neighboring cell averages at centers $x_i$ and $x_{i+1}$ with weights based on the geometric distances to the face. Impose periodicity consistently when the face lies at $x=1$ (the right boundary), by interpreting the center of cell $0$ as located at $x_0 + 1$ for the purpose of interpolation weights; the pointwise field values remain periodic, i.e., $u(x_0 + 1) = u(x_0)$.\n\nDefine discrete face-based error norms for the flux error $e_j = f(u_{\\text{rec}}(x_j)) - f(u(x_j))$ at faces $\\{x_j\\}_{j=1}^N$:\n$$\n\\|e\\|_{1,\\text{face}} = \\frac{1}{N}\\sum_{j=1}^{N} |e_j|,\\quad\n\\|e\\|_{2,\\text{face}} = \\left(\\frac{1}{N}\\sum_{j=1}^{N} e_j^2\\right)^{1/2},\\quad\n\\|e\\|_{\\infty,\\text{face}} = \\max_{1\\le j\\le N}|e_j|.\n$$\nFor convergence assessment, define the mesh size $h$ as the maximum cell width,\n$$\nh = \\max_{i}\\Delta x_i.\n$$\nGiven a family of grids with sizes $\\{h_m\\}$ and corresponding errors $\\{E_m\\}$ in a chosen norm, compute the observed order $p$ by a least-squares fit of $\\log E_m$ versus $\\log h_m$ using the linear model $\\log E_m \\approx \\alpha + p\\,\\log h_m$.\n\nYour program must:\n- Build the two grid families with $N \\in \\{50, 100, 200, 400\\}$.\n- For each $N$, compute exact cell averages, centers, reconstruct face values by linear interpolation of neighboring cell averages with geometric weights, form fluxes with $a=1$, and evaluate the three discrete face-based error norms.\n- Compute the observed order $p$ for each norm via least-squares using all four $N$ values in each grid family.\n\nTest suite specification:\n- Family $1$ (uniform): $N \\in \\{50, 100, 200, 400\\}$.\n- Family $2$ (stretched with $k=3$): $N \\in \\{50, 100, 200, 400\\}$.\nThe above covers a representative “happy path” (uniform refinement), boundary handling at the periodic wrap, and a significant nonuniformity edge case through stretching.\n\nFinal output format:\nYour program should produce a single line of output containing the six observed orders as a comma-separated list enclosed in square brackets, in the order\n$$\n[\\;p_{1}^{(L1)},\\;p_{1}^{(L2)},\\;p_{1}^{(L\\infty)},\\;p_{2}^{(L1)},\\;p_{2}^{(L2)},\\;p_{2}^{(L\\infty)}\\;],\n$$\nwhere $p_{1}^{(\\cdot)}$ are the observed orders for the uniform grids, and $p_{2}^{(\\cdot)}$ are those for the stretched grids. Each entry must be a floating-point number.",
            "solution": "The user has provided a valid problem statement. The task is to design and execute a numerical experiment to verify the order of convergence for a linear reconstruction method used in finite volume schemes for computational fluid dynamics. The problem is scientifically grounded, well-posed, and objective. It provides a clear definition of the physical and mathematical model, the numerical method, the test cases, and the required analysis.\n\nThe core of the problem is to assess the accuracy of reconstructing point values at cell faces from adjacent cell-averaged data. For a smooth solution, this process is expected to be second-order accurate, meaning the error should decrease proportionally to the square of the mesh size, $h^2$. This will be verified for both uniform and non-uniform (stretched) grids.\n\nThe overall procedure involves the following steps for each grid family (uniform and stretched) and for a sequence of refining grid resolutions ($N \\in \\{50, 100, 200, 400\\}$):\n\n1.  **Grid Generation**: A one-dimensional periodic domain $[0, 1]$ is discretized into $N$ cells. The boundaries of these cells are called \"faces\".\n    *   For the **uniform grid**, the $N+1$ faces are located at $x_j = j/N$ for $j \\in \\{0, 1, \\dots, N\\}$.\n    *   For the **stretched grid**, a mapping $x(s) = \\frac{e^{k s} - 1}{e^k - 1}$ with $k = 3$ is used. The faces are located at $x_j = x(s_j)$ where $s_j = j/N$ for $j \\in \\{0, 1, \\dots, N\\}$.\n    Each cell $i$ (for $i=0, \\dots, N-1$) is the interval $[x_i, x_{i+1}]$. Its width is $\\Delta x_i = x_{i+1} - x_i$, and its center is $c_i = (x_i + x_{i+1})/2$.\n\n2.  **Cell Average Calculation**: The exact cell averages, $\\bar{u}_i$, are computed for the given smooth function $u(x) = \\sin(2\\pi x) + \\frac{1}{2}\\cos(4\\pi x)$. The cell average for cell $i$ is defined as $\\bar{u}_i = \\frac{1}{\\Delta x_i} \\int_{x_i}^{x_{i+1}} u(x) dx$. Using the provided antiderivative of $u(x)$, denoted $U(x)$, this is calculated as $\\bar{u}_i = \\frac{U(x_{i+1}) - U(x_i)}{\\Delta x_i}$.\n\n3.  **Face Value Reconstruction**: The value of the solution at each cell face is approximated using linear interpolation. The problem specifies that the cell average $\\bar{u}_i$ should be treated as a point value at the cell center $c_i$. To find the reconstructed value $u_{\\text{rec}}(x_{i+1})$ at the face between cell $i$ and cell $i+1$, a line is constructed through the points $(c_i, \\bar{u}_i)$ and $(c_{i+1}, \\bar{u}_{i+1})$. The value of this linear interpolant at $x_{i+1}$ is:\n    $$\n    u_{\\text{rec}}(x_{i+1}) = \\bar{u}_i + (\\bar{u}_{i+1} - \\bar{u}_i) \\frac{x_{i+1} - c_i}{c_{i+1} - c_i}\n    $$\n    For the periodic boundary, the reconstruction at the last face $x_N=1$ (which lies between cell $N-1$ and cell $0$) uses the points $(c_{N-1}, \\bar{u}_{N-1})$ and a periodically shifted point for cell $0$, which is $(c_0+1, \\bar{u}_0)$.\n\n4.  **Error Calculation**: The error is computed at each of the $N$ faces located at $x_j$ for $j=1, \\dots, N$. The flux is $f(u) = a u$ with the constant advection speed $a=1$, so the flux error is identical to the error in the reconstructed value $u$. The error at face $j$ is $e_j = u_{\\text{rec}}(x_j) - u(x_j)$. Three discrete norms of this error vector are computed:\n    *   $L_1$ norm: $\\|e\\|_{1,\\text{face}} = \\frac{1}{N}\\sum_{j=1}^{N} |e_j|$\n    *   $L_2$ norm: $\\|e\\|_{2,\\text{face}} = \\left(\\frac{1}{N}\\sum_{j=1}^{N} e_j^2\\right)^{1/2}$\n    *   $L_\\infty$ norm: $\\|e\\|_{\\infty,\\text{face}} = \\max_{1\\le j\\le N}|e_j|$\n\n5.  **Convergence Analysis**: The order of convergence, $p$, is determined by analyzing how the error $E$ scales with the mesh size $h = \\max_i(\\Delta x_i)$. Assuming a power-law relationship $E \\approx C h^p$, we can take the logarithm to obtain a linear equation: $\\log E \\approx \\log C + p \\log h$. By computing the errors for a sequence of grid sizes $N \\in \\{50, 100, 200, 400\\}$, we obtain a set of data points $(\\log h_m, \\log E_m)$. The slope $p$ of the best-fit line through these points gives the observed order of convergence. This is determined via a linear least-squares regression. This process is repeated for each of the three error norms and for both grid families.\nThe expected result for this linear reconstruction scheme applied to a smooth function is second-order convergence, i.e., $p \\approx 2$. The numerical experiment is designed to confirm this theoretical result.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Designs and implements a numerical experiment to verify second-order convergence \n    of reconstructed cell-face fluxes for a smooth scalar field in a finite volume context.\n    \"\"\"\n\n    # --- Function Definitions ---\n\n    def u_exact(x: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Calculates the exact solution for the scalar field u(x).\n        u(x) = sin(2*pi*x) + 0.5*cos(4*pi*x)\n        \"\"\"\n        return np.sin(2.0 * np.pi * x) + 0.5 * np.cos(4.0 * np.pi * x)\n\n    def u_integral(x: np.ndarray) -> np.ndarray:\n        \"\"\"\n        Calculates the definite integral (antiderivative) of u(x).\n        Integral(u(x)dx) = -cos(2*pi*x)/(2*pi) + sin(4*pi*x)/(8*pi)\n        \"\"\"\n        return -np.cos(2.0 * np.pi * x) / (2.0 * np.pi) + np.sin(4.0 * np.pi * x) / (8.0 * np.pi)\n\n    def create_grid(N: int, k: float = None) -> np.ndarray:\n        \"\"\"\n        Generates grid face locations for uniform or stretched grids.\n        \n        Args:\n            N: Number of cells.\n            k: Stretching factor. If None, a uniform grid is created.\n\n        Returns:\n            An array of N+1 face locations.\n        \"\"\"\n        if k is None:  # Uniform grid\n            return np.linspace(0.0, 1.0, N + 1)\n        else:  # Stretched grid\n            s = np.linspace(0.0, 1.0, N + 1)\n            return (np.exp(k * s) - 1.0) / (np.exp(k) - 1.0)\n\n    def run_convergence_study(k: float, N_values: list) -> list:\n        \"\"\"\n        Performs the full convergence study for a given grid family.\n        \n        Args:\n            k: Stretching factor for the grid family (None for uniform).\n            N_values: A list of integers representing the number of cells for each run.\n\n        Returns:\n            A list containing the observed convergence orders [p_L1, p_L2, p_Linf].\n        \"\"\"\n        mesh_sizes = []\n        l1_errors = []\n        l2_errors = []\n        linf_errors = []\n\n        for N in N_values:\n            # 1. Generate grid and compute cell properties\n            faces = create_grid(N, k)\n            cell_widths = faces[1:] - faces[:-1]\n            cell_centers = (faces[1:] + faces[:-1]) / 2.0\n            h = np.max(cell_widths)\n            mesh_sizes.append(h)\n\n            # 2. Compute exact cell averages\n            integrals = u_integral(faces[1:]) - u_integral(faces[:-1])\n            u_bar = integrals / cell_widths\n\n            # 3. Reconstruct values at faces\n            u_rec_at_faces = np.zeros(N)\n            faces_for_recon = faces[1:]  # Faces x_1, ..., x_N\n\n            for i in range(N):\n                # i is the index of the cell to the left of the face at faces[i+1]\n                u_left = u_bar[i]\n                center_left = cell_centers[i]\n\n                # Handle periodic boundary for the right neighbor\n                is_periodic_face = (i == N - 1)\n                u_right = u_bar[0] if is_periodic_face else u_bar[i + 1]\n                center_right = (cell_centers[0] + 1.0) if is_periodic_face else cell_centers[i + 1]\n                \n                x_face = faces_for_recon[i]\n\n                # Linear interpolation of cell-averages treated as point values\n                if np.isclose(center_right, center_left):\n                    u_rec_at_faces[i] = u_left\n                else:\n                    u_rec_at_faces[i] = u_left + (u_right - u_left) * \\\n                                      (x_face - center_left) / (center_right - center_left)\n\n            # 4. Compute errors (a=1, so flux error is value error)\n            u_exact_at_faces = u_exact(faces_for_recon)\n            errors = u_rec_at_faces - u_exact_at_faces\n\n            # 5. Compute and store error norms\n            l1_errors.append(np.mean(np.abs(errors)))\n            l2_errors.append(np.sqrt(np.mean(errors**2)))\n            linf_errors.append(np.max(np.abs(errors)))\n\n        # 6. Compute convergence order via least-squares fit on log-log data\n        log_h = np.log(mesh_sizes)\n        p_l1 = np.polyfit(log_h, np.log(l1_errors), 1)[0]\n        p_l2 = np.polyfit(log_h, np.log(l2_errors), 1)[0]\n        p_linf = np.polyfit(log_h, np.log(linf_errors), 1)[0]\n        \n        return [p_l1, p_l2, p_linf]\n\n    # --- Main Execution ---\n    \n    # Define the test cases from the problem statement.\n    Ns_list = [50, 100, 200, 400]\n    \n    # Family 1 (uniform grid)\n    orders_uniform = run_convergence_study(k=None, N_values=Ns_list)\n    \n    # Family 2 (stretched grid)\n    k_stretched = 3.0\n    orders_stretched = run_convergence_study(k=k_stretched, N_values=Ns_list)\n    \n    # Combine results into a single list\n    final_orders = orders_uniform + orders_stretched\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_orders))}]\")\n\nsolve()\n```"
        }
    ]
}