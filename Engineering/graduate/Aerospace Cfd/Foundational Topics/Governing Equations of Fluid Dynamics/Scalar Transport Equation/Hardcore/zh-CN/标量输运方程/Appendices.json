{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握标量输运，我们必须首先理解其最核心的物理过程。本练习将引导你分析经典的稳态对流-扩散方程 。通过解析求解这个看似简单的问题，你将对流体运动（对流）和分子混合（扩散）之间的竞争关系获得深刻的物理直觉，并亲手推导出在高速流动中至关重要的边界层的厚度。",
            "id": "3993060",
            "problem": "考虑一个无源标量场 $\\phi(x)$，它在一个长度为 $L$ 的通道中，由速度恒为 $U$ 的一维、稳态、不可压缩流输运。该标量具有恒定的分子扩散率 $\\alpha$。边界条件为狄利克雷（Dirichlet）条件：$\\phi(0) = \\phi_{\\mathrm{in}}$ 和 $\\phi(L) = \\phi_{\\mathrm{out}}$。从稳态标量守恒的微分表述（即总通量（对流通量加扩散通量）的散度为零）出发，使用对流通量 $J_{\\mathrm{c}} = U \\,\\phi$ 和扩散通量 $J_{\\mathrm{d}} = - \\alpha \\,\\partial \\phi / \\partial x$ 的本构形式，推导 $\\phi(x)$ 的控制常微分方程，在给定边界条件下精确求解 $\\phi(x)$，然后通过引入无量纲坐标 $\\hat{x} = x/L$ 和佩克莱数 $\\mathrm{Pe} = U L / \\alpha$ 进行无量纲分析。\n\n使用以 $\\mathrm{Pe}$ 表示的精确解，在 $\\mathrm{Pe} \\gg 1$ 的极限下进行匹配标度分析，以确定在域内形成的扩散边界层的位置和厚度。将有量纲的边界层厚度 $\\delta$ 定义为这样一个特征长度：在此长度上 $\\phi(x)$ 从其上游值发生显著偏离（相对于 $\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}$ 为单位量级），并过渡到满足下游边界条件。将您最终的 $\\delta$ 答案（单位为米）表示为仅含 $L$、$U$ 和 $\\alpha$ 的单个闭式表达式。在您的推导中，明确说明对于 $U  0$ 的情况，边界层位于域的哪一侧。\n\n您的最终答案必须是单个解析表达式。无需进行数值计算。",
            "solution": "该问题要求推导并求解一个无源标量 $\\phi(x)$ 的稳态一维对流-扩散方程，然后在高佩克莱数极限下进行匹配标度分析，以确定边界层厚度。\n\n**步骤1：问题验证**\n\n给定条件如下：\n- 标量场：$\\phi(x)$\n- 流动速度：恒为 $U  0$\n- 域：$x \\in [0, L]$\n- 分子扩散率：恒为 $\\alpha$\n- 边界条件 (BCs)：$\\phi(0) = \\phi_{\\mathrm{in}}$，$\\phi(L) = \\phi_{\\mathrm{out}}$\n- 守恒定律：总通量的散度为零。\n- 对流通量：$J_{\\mathrm{c}} = U\\,\\phi$\n- 扩散通量：$J_{\\mathrm{d}} = - \\alpha \\,\\frac{\\partial \\phi}{\\partial x}$\n\n该问题具有科学依据，提出了输运现象的典范模型（稳态对流-扩散方程）。它是一个适定的问题，即一个带有两个指定边界条件的二阶线性常微分方程（ODE），保证了唯一解的存在。术语精确客观。任务可进行数学形式化且自洽。因此，该问题是**有效**的。\n\n**步骤2：控制常微分方程的推导**\n\n总通量 $J_{\\mathrm{total}}$ 是对流通量和扩散通量之和：\n$$J_{\\mathrm{total}}(x) = J_{\\mathrm{c}} + J_{\\mathrm{d}} = U\\,\\phi(x) - \\alpha\\,\\frac{d\\phi}{dx}$$\n问题指出，在稳态下，总通量的散度为零。在一维情况下，这简化为 $\\frac{d}{dx}(J_{\\mathrm{total}}) = 0$。\n$$\\frac{d}{dx}\\left(U\\,\\phi - \\alpha\\,\\frac{d\\phi}{dx}\\right) = 0$$\n由于 $U$ 和 $\\alpha$ 是常数，我们可以进行微分：\n$$U\\,\\frac{d\\phi}{dx} - \\alpha\\,\\frac{d^2\\phi}{dx^2} = 0$$\n重新整理得到具有常系数的齐次、二阶、线性控制常微分方程：\n$$\\alpha\\,\\frac{d^2\\phi}{dx^2} - U\\,\\frac{d\\phi}{dx} = 0$$\n\n**步骤3：常微分方程的精确解**\n\n为求解该常微分方程，我们首先通过代入 $\\phi(x) = \\exp(rx)$ 来找到特征方程：\n$$\\alpha r^2 \\exp(rx) - U r \\exp(rx) = 0$$\n$$\\alpha r^2 - U r = 0 \\implies r(\\alpha r - U) = 0$$\n特征方程的根是 $r_1 = 0$ 和 $r_2 = U/\\alpha$。通解是基本解 $\\exp(r_1 x)$ 和 $\\exp(r_2 x)$ 的线性组合：\n$$\\phi(x) = C_1 \\exp(0 \\cdot x) + C_2 \\exp\\left(\\frac{U}{\\alpha}x\\right) = C_1 + C_2 \\exp\\left(\\frac{Ux}{\\alpha}\\right)$$\n积分常数 $C_1$ 和 $C_2$ 由边界条件确定。\n\n在 $x=0$ 处：\n$$\\phi(0) = \\phi_{\\mathrm{in}} \\implies \\phi_{\\mathrm{in}} = C_1 + C_2 \\exp(0) = C_1 + C_2 \\quad (1)$$\n在 $x=L$ 处：\n$$\\phi(L) = \\phi_{\\mathrm{out}} \\implies \\phi_{\\mathrm{out}} = C_1 + C_2 \\exp\\left(\\frac{UL}{\\alpha}\\right) \\quad (2)$$\n\n由方程(1)，我们得到 $C_1 = \\phi_{\\mathrm{in}} - C_2$。将其代入方程(2)：\n$$\\phi_{\\mathrm{out}} = (\\phi_{\\mathrm{in}} - C_2) + C_2 \\exp\\left(\\frac{UL}{\\alpha}\\right)$$\n$$\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}} = C_2 \\left(\\exp\\left(\\frac{UL}{\\alpha}\\right) - 1\\right)$$\n求解 $C_2$：\n$$C_2 = \\frac{\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}}{\\exp\\left(\\frac{UL}{\\alpha}\\right) - 1}$$\n一种表示最终解的便捷方法是将其归一化。我们可以写出：\n$$\\phi(x) - \\phi_{\\mathrm{in}} = (C_1 - \\phi_{\\mathrm{in}}) + C_2 \\exp\\left(\\frac{Ux}{\\alpha}\\right) = -C_2 + C_2 \\exp\\left(\\frac{Ux}{\\alpha}\\right) = C_2 \\left(\\exp\\left(\\frac{Ux}{\\alpha}\\right) - 1\\right)$$\n将此式除以 $\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}$ 的表达式：\n$$\\frac{\\phi(x) - \\phi_{\\mathrm{in}}}{\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}} = \\frac{C_2 \\left(\\exp\\left(\\frac{Ux}{\\alpha}\\right) - 1\\right)}{C_2 \\left(\\exp\\left(\\frac{UL}{\\alpha}\\right) - 1\\right)}$$\n这就得到了精确解的无量纲形式：\n$$\\frac{\\phi(x) - \\phi_{\\mathrm{in}}}{\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}} = \\frac{\\exp\\left(\\frac{Ux}{\\alpha}\\right) - 1}{\\exp\\left(\\frac{UL}{\\alpha}\\right) - 1}$$\n\n**步骤4：无量纲分析和渐近极限**\n\n我们引入无量纲变量：\n- 无量纲坐标：$\\hat{x} = x/L$\n- 佩克莱数：$\\mathrm{Pe} = UL/\\alpha$，它代表了对流与扩散输运速率之比。\n- 无量纲标量：$\\hat{\\phi}(\\hat{x}) = \\frac{\\phi(x) - \\phi_{\\mathrm{in}}}{\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}}$\n\n解中的指数可以重写为 $\\frac{Ux}{\\alpha} = \\frac{UL}{\\alpha}\\frac{x}{L} = \\mathrm{Pe}\\,\\hat{x}$ 和 $\\frac{UL}{\\alpha} = \\mathrm{Pe}$。\n无量纲形式的精确解为：\n$$\\hat{\\phi}(\\hat{x}) = \\frac{\\exp(\\mathrm{Pe}\\,\\hat{x}) - 1}{\\exp(\\mathrm{Pe}) - 1}$$\n\n我们现在分析对流主导的流动情况，其中 $\\mathrm{Pe} \\gg 1$。在此极限下，$\\exp(\\mathrm{Pe}) \\gg 1$，因此分母可以近似为 $\\exp(\\mathrm{Pe}) - 1 \\approx \\exp(\\mathrm{Pe})$。\n$$\\hat{\\phi}(\\hat{x}) \\approx \\frac{\\exp(\\mathrm{Pe}\\,\\hat{x}) - 1}{\\exp(\\mathrm{Pe})} = \\exp(\\mathrm{Pe}\\,\\hat{x} - \\mathrm{Pe}) - \\exp(-\\mathrm{Pe}) = \\exp(\\mathrm{Pe}(\\hat{x}-1)) - \\exp(-\\mathrm{Pe})$$\n由于 $\\mathrm{Pe} \\gg 1$，$\\exp(-\\mathrm{Pe})$ 这一项极小，可以忽略不计。\n$$\\hat{\\phi}(\\hat{x}) \\approx \\exp(\\mathrm{Pe}(\\hat{x}-1))$$\n\n这个近似解描述了标量场的行为。\n- **外区**：在域的大部分区域，其中 $\\hat{x}$ 不接近 $1$，$\\hat{x}-1$ 这一项是量级为1的负数。由于 $\\mathrm{Pe} \\gg 1$，其参数 $\\mathrm{Pe}(\\hat{x}-1)$ 是一个大的负数，导致 $\\hat{\\phi}(\\hat{x})$ 指数级地接近 $0$。这定义了“外解”，$\\hat{\\phi}_{\\mathrm{outer}} \\approx 0$，对应于 $\\phi(x) \\approx \\phi_{\\mathrm{in}}$。物理上，高速对流将入口浓度 $\\phi_{\\mathrm{in}}$ 输运到域的大部分区域。\n\n- **内区（边界层）**：外解 $\\phi(x) \\approx \\phi_{\\mathrm{in}}$ 未能满足 $x=L$ 处的边界条件，此处 $\\phi(L) = \\phi_{\\mathrm{out}}$。因此在 $x=L$ 附近必须存在一个薄区域，即边界层，在该区域内解从 $\\phi_{\\mathrm{in}}$ 迅速过渡到 $\\phi_{\\mathrm{out}}$。由于 $U  0$，流动方向是从 $x=0$ 到 $x=L$，因此边界层形成于**下游边界 $x=L$** 处。\n\n为了分析该层，我们引入一个边界层坐标 $\\delta_x = L - x$，即距下游壁面的距离。用无量纲形式表示，$1-\\hat{x} = \\delta_x/L$。我们近似解中指数的参数变为 $\\mathrm{Pe}(\\hat{x}-1) = -\\mathrm{Pe}(1-\\hat{x}) = -(\\frac{UL}{\\alpha})(\\frac{\\delta_x}{L}) = -\\frac{U \\delta_x}{\\alpha}$。因此，边界层内的解廓线为：\n$$\\hat{\\phi} = \\frac{\\phi(x) - \\phi_{\\mathrm{in}}}{\\phi_{\\mathrm{out}} - \\phi_{\\mathrm{in}}} \\approx \\exp\\left(-\\frac{U \\delta_x}{\\alpha}\\right)$$\n该表达式表明，归一化标量从壁面处（$\\delta_x=0$）的 $\\hat{\\phi}=1$ 指数衰减到层外的 $\\hat{\\phi} \\approx 0$。问题将边界层厚度 $\\delta$ 定义为该过渡的特征长度尺度。对于形式为 $\\exp(-z/\\lambda)$ 的指数函数，特征长度是 $\\lambda$。在我们的情况下，变量是 $\\delta_x$，参数是 $-\\delta_x / (\\alpha/U)$。因此，这种衰减的特征长度是：\n$$\\delta = \\frac{\\alpha}{U}$$\n这个结果证实了通过平衡控制常微分方程中的对流项和扩散项所得到的标度关系。边界层厚度由扩散和对流的局部平衡决定，并且在 $L \\gg \\delta$ 的条件下，与域的长度 $L$ 无关。",
            "answer": "$$\\boxed{\\frac{\\alpha}{U}}$$"
        },
        {
            "introduction": "在计算流体动力学中，我们将连续的偏微分方程转化为离散的代数方程，这个转换的质量直接决定了仿真的准确性。本练习将带你深入有限体积法的核心，通过泰勒展开分析两种基础的对流格式——一阶迎风格式和二阶中心差分格式——的截断误差 。完成此练习后，你将能从数学上解释为何某些格式会引入数值扩散，而另一些则可能导致非物理振荡。",
            "id": "3993064",
            "problem": "考虑计算流体动力学 (CFD) 中的一维、恒定密度、恒定速度的标量平流问题，该问题由光滑标量场 $\\,\\phi(x)\\,$ 和均匀速度 $\\,u0\\,$ 的标量输运方程的守恒形式描述：\n$$\n\\frac{\\partial \\phi}{\\partial t}+\\frac{\\partial}{\\partial x}\\left(u\\,\\phi\\right)=0.\n$$\n采用一个均匀的有限体积网格，其单元中心位于 $\\,x_i\\,$，单元面位于 $\\,x_{i\\pm \\frac{1}{2}}\\,$, 且具有均匀间距 $\\,\\Delta x\\,$。关注使用有限体积法 (FVM) 对对流项进行空间离散化：单元 $\\,i\\,$ 处的半离散对流算子是面通量之差除以 $\\,\\Delta x\\,$。在每个单元面上使用两种不同的 $\\,\\phi\\,$ 面值重构方法：\n- 与 $\\,u0\\,$ 一致的一阶迎风重构，以及\n- 二阶中心重构，\n从控制体积分形式出发，并使用关于 $\\,x_i\\,$ 的泰勒展开，执行以下任务：\n- 对每种重构方法，推导在单元面 $\\,x_{i\\pm \\frac{1}{2}}\\,$ 处的离散对流通量。\n- 构建单元 $\\,i\\,$ 处相应的半离散对流算子，并通过泰勒展开，确定每种重构方法在 $\\,x_i\\,$ 处的局部空间截断误差的领头阶项，用 $\\,\\phi\\,$ 的导数和 $\\,\\Delta x\\,$ 的幂来表示。\n然后，对于特定的光滑场 $\\,\\phi(x)=\\exp(\\beta x)\\,$（其中 $\\,\\beta0\\,$ 为常数），计算两种重构方法在 $\\,x_i\\,$ 处领头阶截断误差大小的比值 $\\,r\\,$，\n$$\nr \\equiv \\frac{\\left|\\text{leading-order truncation error for first-order upwind at }x_i\\right|}{\\left|\\text{leading-order truncation error for second-order central at }x_i\\right|},\n$$\n并将其简化为一个仅依赖于 $\\,\\beta\\,$ 和 $\\,\\Delta x\\,$ 的闭式解析表达式。将您的最终答案表示为单个简化的解析表达式。请勿四舍五入。",
            "solution": "从宽度为 $\\,\\Delta x\\,$ 的均匀控制体 $[x_{i-\\frac{1}{2}},x_{i+\\frac{1}{2}}]$ 的守恒形式开始。对于恒定密度和速度 $\\,u0\\,$，单元 $\\,i\\,$ 处的有限体积半离散对流算子为\n$$\n\\mathcal{C}_i \\equiv \\frac{1}{\\Delta x}\\left(u\\,\\phi_{i+\\frac{1}{2}}-u\\,\\phi_{i-\\frac{1}{2}}\\right)=\\frac{u}{\\Delta x}\\left(\\phi_{i+\\frac{1}{2}}-\\phi_{i-\\frac{1}{2}}\\right),\n$$\n其中 $\\,\\phi_{i\\pm\\frac{1}{2}}\\,$ 表示根据单元中心数据在面 $\\,x_{i\\pm\\frac{1}{2}}\\,$ 处对 $\\,\\phi\\,$ 的重构值。在 $\\,x_i\\,$ 处的精确对流导数为 $\\,u\\,\\phi_x(x_i)\\,$。因此，在 $\\,x_i\\,$ 处的局部空间截断误差为\n$$\n\\text{TE}_i=\\mathcal{C}_i-u\\,\\phi_x(x_i).\n$$\n\n面值重构：\n\n对于 $\\,u0\\,$：\n- 一阶迎风（取自上游单元的值）：\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{up}}=\\phi_i,\\qquad \\phi_{i-\\frac{1}{2}}^{\\text{up}}=\\phi_{i-1}.\n$$\n因此\n$$\n\\mathcal{C}_i^{\\text{up}}=\\frac{u}{\\Delta x}\\left(\\phi_i-\\phi_{i-1}\\right).\n$$\n- 二阶中心（相邻单元中心值的算术平均）：\n$$\n\\phi_{i+\\frac{1}{2}}^{\\text{cen}}=\\frac{\\phi_{i}+\\phi_{i+1}}{2},\\qquad \\phi_{i-\\frac{1}{2}}^{\\text{cen}}=\\frac{\\phi_{i-1}+\\phi_{i}}{2}.\n$$\n因此\n$$\n\\mathcal{C}_i^{\\text{cen}}=\\frac{u}{\\Delta x}\\left(\\frac{\\phi_{i+1}-\\phi_{i-1}}{2}\\right)=\\frac{u}{2\\Delta x}\\left(\\phi_{i+1}-\\phi_{i-1}\\right).\n$$\n\n为了分析截断误差，我们使用泰勒级数将 $\\,\\phi_{i\\pm 1}\\,$ 在 $\\,x_i\\,$ 附近展开。设导数均在 $\\,x_i\\,$ 处求值，并记 $\\,\\phi^{(m)}(x_i)\\equiv \\frac{d^m \\phi}{dx^m}(x_i)\\,$。则\n$$\n\\phi_{i+1}=\\phi_i+\\Delta x\\,\\phi_x+\\frac{\\Delta x^2}{2}\\phi_{xx}+\\frac{\\Delta x^3}{6}\\phi_{xxx}+\\frac{\\Delta x^4}{24}\\phi_{xxxx}+\\mathcal{O}(\\Delta x^5),\n$$\n$$\n\\phi_{i-1}=\\phi_i-\\Delta x\\,\\phi_x+\\frac{\\Delta x^2}{2}\\phi_{xx}-\\frac{\\Delta x^3}{6}\\phi_{xxx}+\\frac{\\Delta x^4}{24}\\phi_{xxxx}+\\mathcal{O}(\\Delta x^5).\n$$\n\n一阶迎风截断误差：\n\n计算\n$$\n\\frac{\\phi_i-\\phi_{i-1}}{\\Delta x}=\\frac{1}{\\Delta x}\\left[\\phi_i-\\left(\\phi_i-\\Delta x\\,\\phi_x+\\frac{\\Delta x^2}{2}\\phi_{xx}-\\frac{\\Delta x^3}{6}\\phi_{xxx}+\\cdots\\right)\\right]\n=\\phi_x-\\frac{\\Delta x}{2}\\phi_{xx}+\\frac{\\Delta x^2}{6}\\phi_{xxx}+\\mathcal{O}(\\Delta x^3).\n$$\n因此\n$$\n\\mathcal{C}_i^{\\text{up}}=u\\left(\\phi_x-\\frac{\\Delta x}{2}\\phi_{xx}+\\frac{\\Delta x^2}{6}\\phi_{xxx}+\\mathcal{O}(\\Delta x^3)\\right),\n$$\n且局部截断误差为\n$$\n\\text{TE}_i^{\\text{up}}=\\mathcal{C}_i^{\\text{up}}-u\\,\\phi_x=-u\\,\\frac{\\Delta x}{2}\\,\\phi_{xx}+u\\,\\frac{\\Delta x^2}{6}\\,\\phi_{xxx}+\\mathcal{O}(\\Delta x^3).\n$$\n领头阶项为 $\\,\\mathcal{O}(\\Delta x)\\,$：\n$$\n\\text{TE}_i^{\\text{up}}= -\\,u\\,\\frac{\\Delta x}{2}\\,\\phi_{xx}+\\mathcal{O}(\\Delta x^2).\n$$\n\n二阶中心截断误差：\n\n计算\n$$\n\\frac{\\phi_{i+1}-\\phi_{i-1}}{2\\Delta x}=\\frac{1}{2\\Delta x}\\left[\\left(\\phi_i+\\Delta x\\,\\phi_x+\\frac{\\Delta x^2}{2}\\phi_{xx}+\\frac{\\Delta x^3}{6}\\phi_{xxx}+\\cdots\\right)-\\left(\\phi_i-\\Delta x\\,\\phi_x+\\frac{\\Delta x^2}{2}\\phi_{xx}-\\frac{\\Delta x^3}{6}\\phi_{xxx}+\\cdots\\right)\\right]\n=\\phi_x+\\frac{\\Delta x^2}{6}\\phi_{xxx}+\\mathcal{O}(\\Delta x^4).\n$$\n因此\n$$\n\\mathcal{C}_i^{\\text{cen}}=u\\left(\\phi_x+\\frac{\\Delta x^2}{6}\\phi_{xxx}+\\mathcal{O}(\\Delta x^4)\\right),\n$$\n且局部截断误差为\n$$\n\\text{TE}_i^{\\text{cen}}=\\mathcal{C}_i^{\\text{cen}}-u\\,\\phi_x=u\\,\\frac{\\Delta x^2}{6}\\,\\phi_{xxx}+\\mathcal{O}(\\Delta x^4).\n$$\n领头阶项为 $\\,\\mathcal{O}(\\Delta x^2)\\,$：\n$$\n\\text{TE}_i^{\\text{cen}}=u\\,\\frac{\\Delta x^2}{6}\\,\\phi_{xxx}+\\mathcal{O}(\\Delta x^4).\n$$\n\n对于 $\\,\\phi(x)=\\exp(\\beta x)\\,$（其中 $\\,\\beta0\\,$）的特例：\n\n对于该场，\n$$\n\\phi_x=\\beta\\,\\phi,\\qquad \\phi_{xx}=\\beta^2\\,\\phi,\\qquad \\phi_{xxx}=\\beta^3\\,\\phi.\n$$\n因此，在 $\\,x_i\\,$ 处的领头阶截断误差为\n$$\n\\text{TE}_i^{\\text{up}}\\approx -\\,u\\,\\frac{\\Delta x}{2}\\,\\beta^2\\,\\phi(x_i),\\qquad\n\\text{TE}_i^{\\text{cen}}\\approx u\\,\\frac{\\Delta x^2}{6}\\,\\beta^3\\,\\phi(x_i).\n$$\n取其大小（对于此选择，有 $\\,u0\\,$, $\\,\\beta0\\,$ 且 $\\,\\phi(x_i)0\\,$），\n$$\n\\left|\\text{TE}_i^{\\text{up}}\\right|\\approx u\\,\\frac{\\Delta x}{2}\\,\\beta^2\\,\\phi(x_i),\\qquad\n\\left|\\text{TE}_i^{\\text{cen}}\\right|\\approx u\\,\\frac{\\Delta x^2}{6}\\,\\beta^3\\,\\phi(x_i).\n$$\n因此，大小之比为\n$$\nr\\equiv \\frac{\\left|\\text{TE}_i^{\\text{up}}\\right|}{\\left|\\text{TE}_i^{\\text{cen}}\\right|}\n=\\frac{u\\,\\frac{\\Delta x}{2}\\,\\beta^2\\,\\phi(x_i)}{u\\,\\frac{\\Delta x^2}{6}\\,\\beta^3\\,\\phi(x_i)}\n=\\frac{3}{\\beta\\,\\Delta x}.\n$$\n此比值仅依赖于 $\\,\\beta\\,$ 和 $\\,\\Delta x\\,$，并且是无量纲的，符合要求。",
            "answer": "$$\\boxed{\\frac{3}{\\beta\\,\\Delta x}}$$"
        },
        {
            "introduction": "理论和分析最终需要在实践中得到验证。本练习是一个综合性的编程任务，要求你构建一个简单的二维有限体积求解器来模拟标量输运 。其核心目标是验证一个被视为有限体积法基石的属性：离散守恒性。通过编程确保数值通量在单元间的精确抵消，你将体会到为何有限体积法能在复杂的工程仿真中保证质量、动量和能量等物理量的严格守恒。",
            "id": "3993059",
            "problem": "要求您在一个封闭域内，使用有限体积平衡法，验证一个被输运的标量乘以质量密度的积分的离散守恒性。考虑可压缩标量输运，其守恒量 $q = \\rho \\phi$ 的守恒律形式如下，其中 $\\rho$ 是质量密度，单位为 $\\mathrm{kg}/\\mathrm{m}^3$，$\\phi$ 是一个无量纲的被动标量。其控制方程是为 $q$ 编写的可压缩标量输运方程，\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (q \\,\\mathbf{u}) = \\nabla \\cdot (\\Gamma \\nabla \\phi) + \\rho S_\\phi,\n$$\n其中 $\\mathbf{u}$ 是速度场，单位为 $\\mathrm{m}/\\mathrm{s}$，$\\Gamma$ 是有效扩散系数，单位为 $\\mathrm{kg}/(\\mathrm{m}\\cdot \\mathrm{s})$（例如，$\\Gamma = \\rho D$，其中 $D$ 是分子扩散率，单位为 $\\mathrm{m}^2/\\mathrm{s}$），$S_\\phi$ 是源项，单位为 $\\mathrm{s}^{-1}$。我们关心的积分是\n$$\nI(t) = \\int_V \\rho \\phi \\, dV = \\int_V q \\, dV,\n$$\n其中 $V$ 是一个固定的封闭域。有限体积原理指出，在一个时间步长内 $I(t)$ 的变化量，精确地等于穿过边界的面通量之和，以及在 $V$ 上的体积源积分，前提是离散通量被一致地计算并由相邻的控制体积共享。\n\n从局部守恒律和散度定理的基本原理出发，实现一个二维显式有限体积算法，在均匀的矩形单元笛卡尔网格上随时间更新 $q$。设域为一个大小为 $L_x \\times L_y$ 的矩形，离散为 $N_x \\times N_y$ 个均匀的以单元为中心的控制体积。设单元尺寸为 $\\Delta x = L_x / N_x$ 和 $\\Delta y = L_y / N_y$，单元体积为 $V_c = \\Delta x \\Delta y$。对于每个内表面，计算一次对流通量和扩散通量，并将其以等大反号的方式加到两个相邻的单元上。对于垂直于 x 方向的面，使用面面积 $A_x = \\Delta y$；对于垂直于 y 方向的面，使用面面积 $A_y = \\Delta x$。使用标准的显式有限体积更新公式，\n$$\nq_{i,j}^{n+1} = q_{i,j}^{n} - \\frac{\\Delta t}{V_c} \\left(F_{x,i+\\frac{1}{2},j} - F_{x,i-\\frac{1}{2},j} + F_{y,i,j+\\frac{1}{2}} - F_{y,i,j-\\frac{1}{2}} \\right) + \\Delta t \\, \\rho_{i,j} S_{\\phi,i,j},\n$$\n其中对流面通量为 $F_{x,i+\\frac{1}{2},j}^{\\text{adv}} = u_x \\, q_{i+\\frac{1}{2},j} \\, A_x$ 和 $F_{y,i,j+\\frac{1}{2}}^{\\text{adv}} = u_y \\, q_{i,j+\\frac{1}{2}} \\, A_y$，面上的值 $q_{i+\\frac{1}{2},j}$ 和 $q_{i,j+\\frac{1}{2}}$ 通过相邻单元的算术平均来近似。扩散面通量为 $F_{x,i+\\frac{1}{2},j}^{\\text{diff}} = - \\Gamma_{i+\\frac{1}{2},j} \\left( \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{\\Delta x} \\right) A_x$ 和 $F_{y,i,j+\\frac{1}{2}}^{\\text{diff}} = - \\Gamma_{i,j+\\frac{1}{2}} \\left( \\frac{\\phi_{i,j+1} - \\phi_{i,j}}{\\Delta y} \\right) A_y$，其中 $\\Gamma$ 根据给定数据取为常数或面上平均值。总面通量为 $F = F^{\\text{adv}} + F^{\\text{diff}}$。必须指定边界条件以使域是封闭的。您必须支持两种类型：\n- 两个方向均为周期性边界，其中 $i = 0$ 处的面与 $i = N_x$ 处的面连接，$j = 0$ 处的面与 $j = N_y$ 处的面连接，导致穿过域边界的净外部通量为零。\n- 封闭壁面，具有无穿透和零扩散通量条件，即在边界上 $u \\cdot n = 0$ 和 $\\nabla \\phi \\cdot n = 0$，因此边界面的 $F^{\\text{adv}} = 0$ 和 $F^{\\text{diff}} = 0$。\n\n将一个显式时间步 $\\Delta t$ 后的守恒残差定义为\n$$\nR = \\left| \\sum_{i,j} q_{i,j}^{n+1} V_c - \\left( \\sum_{i,j} q_{i,j}^{n} V_c + \\Delta t \\sum_{i,j} \\rho_{i,j} S_{\\phi,i,j} V_c + \\Delta t \\sum_{\\text{boundary faces}} F_{\\text{boundary}} \\right) \\right|.\n$$\n对于周期性边界，边界通量总和根据构造为零，因为边界被视为具有环绕连接性的内部面。对于 $u \\cdot n = 0$ 和 $\\nabla \\phi \\cdot n = 0$ 的封闭壁面，边界通量恒为零。由于当 $\\phi$ 无量纲时 $I(t)$ 的单位是千克，因此请以千克表示 $R$。\n\n实现程序以评估以下四个测试案例的 $R$ 值，每个案例都在单个时间步之后进行。使用指定的物理单位，并确保参数选择的科学真实性。在所有案例中，以浮点数形式报告以千克为单位的 $R$ 值。\n\n- 测试案例 1（周期性对流，无扩散，无源项）：\n  - $N_x = 32$, $N_y = 32$, $L_x = 1$ $\\mathrm{m}$, $L_y = 1$ $\\mathrm{m}$。\n  - $\\rho = 1.3$ $\\mathrm{kg}/\\mathrm{m}^3$ (常数)。\n  - $\\mathbf{u} = (0.7, -0.4)$ $\\mathrm{m}/\\mathrm{s}$ (常数)。\n  - $\\Gamma = 0$。\n  - $S_\\phi = 0$。\n  - 初始标量：$\\phi(x,y) = \\sin(2\\pi x) + 0.5 \\cos(2\\pi y)$，在单元中心处计算。\n  - $\\Delta t = 0.005$ $\\mathrm{s}$。\n  - 边界：在 $x$ 和 $y$ 方向上为周期性。\n\n- 测试案例 2（封闭壁面，仅扩散，无源项）：\n  - $N_x = 16$, $N_y = 17$, $L_x = 1$ $\\mathrm{m}$, $L_y = 0.8$ $\\mathrm{m}$。\n  - $\\rho = 1.0$ $\\mathrm{kg}/\\mathrm{m}^3$ (常数)。\n  - $\\mathbf{u} = (0, 0)$ $\\mathrm{m}/\\mathrm{s}$。\n  - $D = 10^{-3}$ $\\mathrm{m}^2/\\mathrm{s}$，所以 $\\Gamma = \\rho D$。\n  - $S_\\phi = 0$。\n  - 初始标量：$\\phi(x,y) = x + 0.3 \\sin(2\\pi y)$，在单元中心处计算。\n  - $\\Delta t = 0.01$ $\\mathrm{s}$。\n  - 边界：封闭壁面，满足 $u \\cdot n = 0$ 和 $\\nabla \\phi \\cdot n = 0$。\n\n- 测试案例 3（周期性，仅均匀源项）：\n  - $N_x = 8$, $N_y = 9$, $L_x = 0.5$ $\\mathrm{m}$, $L_y = 0.4$ $\\mathrm{m}$。\n  - $\\rho = 1.2$ $\\mathrm{kg}/\\mathrm{m}^3$ (常数)。\n  - $\\mathbf{u} = (0, 0)$ $\\mathrm{m}/\\mathrm{s}$。\n  - $\\Gamma = 0$。\n  - $S_\\phi = 2.5$ $\\mathrm{s}^{-1}$ (均匀)。\n  - 初始标量：$\\phi(x,y) = 0.2 + 0.1 \\cos(\\pi x) \\sin(\\pi y)$。\n  - $\\Delta t = 0.02$ $\\mathrm{s}$。\n  - 边界：在 $x$ 和 $y$ 方向上为周期性。\n\n- 测试案例 4（周期性，可变密度和空间变化源项）：\n  - $N_x = 20$, $N_y = 18$, $L_x = 1$ $\\mathrm{m}$, $L_y = 1$ $\\mathrm{m}$。\n  - $\\rho(x,y) = 1 + 0.2 \\sin(2\\pi x) \\cos(2\\pi y)$ $\\mathrm{kg}/\\mathrm{m}^3$。\n  - $\\mathbf{u} = (0, 0)$ $\\mathrm{m}/\\mathrm{s}$。\n  - $\\Gamma = 0$。\n  - $S_\\phi(x,y) = \\sin(\\pi x)\\cos(\\pi y)$ $\\mathrm{s}^{-1}$。\n  - 初始标量：$\\phi(x,y) = \\sin(2\\pi x) \\sin(2\\pi y)$。\n  - $\\Delta t = 0.01$ $\\mathrm{s}$。\n  - 边界：在 $x$ 和 $y$ 方向上为周期性。\n\n您的程序必须使用指定的有限体积算法，在单个显式时间步后为每个测试案例计算 $R$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 `[r_1,r_2,r_3,r_4]`），其中每个 `r_k` 是测试案例 `k` 的守恒残差，以千克为单位表示。输出中不允许有任何额外的文本或格式。",
            "solution": "该问题是有效的。它在计算流体动力学（CFD）领域内提出了一个清晰、有科学依据且适定的任务。其目标是为可压缩标量输运方程实现一个二维显式有限体积方法，并验证其离散守恒性质。所有必需的参数、方程、初始条件和边界条件都已提供。关于维度（二维与三维单位）的微小模糊之处，通过采用标准的单位深度假设来解决，这在二维CFD中是常见做法，并能保持量纲一致性。\n\n求解过程如下。\n\n### 守恒原理\n\n守恒量 $q = \\rho \\phi$ 的输运控制方程由下式给出：\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (q \\,\\mathbf{u}) = \\nabla \\cdot (\\Gamma \\nabla \\phi) + \\rho S_\\phi\n$$\n此处，$q$ 是单位体积的标量浓度（$\\mathrm{kg}/\\mathrm{m}^3$），$\\rho$ 是流体密度（$\\mathrm{kg}/\\mathrm{m}^3$），$\\phi$ 是无量纲标量，$\\mathbf{u}$ 是速度矢量（$\\mathrm{m}/\\mathrm{s}$），$\\Gamma$ 是扩散系数（$\\mathrm{kg}/(\\mathrm{m}\\cdot \\mathrm{s})$），$S_\\phi$ 是体积源项（$\\mathrm{s}^{-1}$）。\n\n在一个固定的控制体积 $V$ 中，标量的总量为 $I(t) = \\int_V q \\, dV$。$I(t)$ 的变化率可以通过对控制方程在 $V$ 上积分得到：\n$$\n\\frac{dI}{dt} = \\frac{d}{dt} \\int_V q \\, dV = \\int_V \\frac{\\partial q}{\\partial t} \\, dV = \\int_V \\left( -\\nabla \\cdot (q\\mathbf{u}) + \\nabla \\cdot (\\Gamma \\nabla \\phi) + \\rho S_\\phi \\right) dV\n$$\n使用散度定理 $\\int_V \\nabla \\cdot \\mathbf{F} \\, dV = \\oint_{\\partial V} \\mathbf{F} \\cdot \\mathbf{n} \\, dS$（其中 $\\partial V$ 是体积 $V$ 的边界），我们可以将散度的体积积分转换为通量的面积分。设总通量矢量为 $\\mathbf{F} = q\\mathbf{u} - \\Gamma\\nabla\\phi$。则：\n$$\n\\frac{dI}{dt} = - \\oint_{\\partial V} (q\\mathbf{u} - \\Gamma\\nabla\\phi) \\cdot \\mathbf{n} \\, dS + \\int_V \\rho S_\\phi \\, dV\n$$\n此方程表达了积分守恒律：体积内总标量的变化率等于穿过其边界的净通量加上体积内源项生成的总量。\n\n### 有限体积离散化\n\n该域被离散为一个由 $N_x \\times N_y$ 个尺寸为 $\\Delta x \\times \\Delta y$ 的矩形控制体积（单元）组成的网格。我们假设单位深度为 $1 \\, \\mathrm{m}$，因此单元体积为 $V_c = \\Delta x \\Delta y$。单元 $(i,j)$ 内的守恒量近似为 $Q_{i,j} = q_{i,j} V_c$，其中 $q_{i,j}$ 是 $q$ 的单元平均值。\n\n将积分守恒律应用于单个单元 $(i,j)$，并使用步长为 $\\Delta t$ 的显式欧拉法进行时间离散，可得到更新公式：\n$$\n\\frac{Q_{i,j}^{n+1} - Q_{i,j}^{n}}{\\Delta t} = - \\sum_{f \\in \\text{faces}(i,j)} F_f + \\bar{S}_{i,j} V_c\n$$\n其中 $F_f$ 是穿过面 $f$ 的总通量，$\\bar{S}_{i,j} = (\\rho S_\\phi)_{i,j}$ 是单元平均源项。对 $q_{i,j}$ 进行改写，可得到问题中提供的表达式：\n$$\nq_{i,j}^{n+1} = q_{i,j}^{n} - \\frac{\\Delta t}{V_c} \\left(F_{x,i+\\frac{1}{2},j} - F_{x,i-\\frac{1}{2},j} + F_{y,i,j+\\frac{1}{2}} - F_{y,i,j-\\frac{1}{2}} \\right) + \\Delta t \\, \\rho_{i,j} S_{\\phi,i,j}\n$$\n穿过一个面的总通量 $F$ 是对流通量和扩散通量之和，$F = F^{\\text{adv}} + F^{\\text{diff}}$。对于一个面积为 $A$ 的面，它们是：\n$$\nF^{\\text{adv}} = (q \\mathbf{u}) \\cdot \\mathbf{n} \\, A \\quad \\text{和} \\quad F^{\\text{diff}} = -(\\Gamma \\nabla \\phi) \\cdot \\mathbf{n} \\, A\n$$\n\n问题指定了在垂直面 $(i+1/2, j)$ 上的通量的数值近似：\n- 对流通量: $F_{x, i+\\frac{1}{2},j}^{\\text{adv}} = u_x \\, q_{i+\\frac{1}{2},j} \\, A_x$, 其中 $q_{i+\\frac{1}{2},j} = \\frac{1}{2}(q_{i,j} + q_{i+1,j})$ 且面面积为 $A_x = \\Delta y$。\n- 扩散通量: $F_{x, i+\\frac{1}{2},j}^{\\text{diff}} = - \\Gamma_{i+\\frac{1}{2},j} \\frac{\\phi_{i+1,j} - \\phi_{i,j}}{\\Delta x} A_x$, 其中 $\\phi_{i,j}=q_{i,j}/\\rho_{i,j}$。\n类似的表达式也适用于水平面 $(i, j+1/2)$。\n\n### 离散守恒与残差\n\n如果相邻单元间所有数值通量之和恰好抵消，只留下域边界上的通量，则该有限体积格式是离散守恒的。让我们对所有单元 $(i,j)$ 的更新方程求和：\n$$\n\\sum_{i,j} q_{i,j}^{n+1} V_c = \\sum_{i,j} q_{i,j}^{n} V_c - \\Delta t \\sum_{i,j} \\left( F_{x,i+\\frac{1}{2},j} - F_{x,i-\\frac{1}{2},j} + \\dots \\right) + \\Delta t \\sum_{i,j} \\rho_{i,j} S_{\\phi,i,j} V_c\n$$\n通量差之和是一个伸缩求和。对于一个封闭域（其边界通量为零或呈周期性），该和的计算结果恰好为零：\n$$\n\\sum_{i,j} \\left( F_{x,i+\\frac{1}{2},j} - F_{x,i-\\frac{1}{2},j} \\right) = \\sum_j \\left( F_{x, N_x-\\frac{1}{2}, j} - F_{x, -\\frac{1}{2}, j} \\right) = \\text{边界通量之和}\n$$\n问题指定的边界条件（周期性或零通量壁面）使得净边界通量为零。因此，全局守恒方程简化为：\n$$\n\\sum_{i,j} q_{i,j}^{n+1} V_c = \\sum_{i,j} q_{i,j}^{n} V_c + \\Delta t \\sum_{i,j} \\rho_{i,j} S_{\\phi,i,j} V_c\n$$\n守恒残差 $R$ 用来检验这个恒等式：\n$$\nR = \\left| \\sum_{i,j} q_{i,j}^{n+1} V_c - \\left( \\sum_{i,j} q_{i,j}^{n} V_c + \\Delta t \\sum_{i,j} \\rho_{i,j} S_{\\phi,i,j} V_c \\right) \\right|\n$$\n对于一个正确实现的守恒格式，$R$ 应在浮点精度范围内为零。\n\n### 实现策略\n\n该算法使用 NumPy 为每个测试案例实现，以进行高效的数组运算。\n1.  **网格与初始条件**：对于每个案例，我们定义网格（$N_x, N_y, L_x, L_y$）并计算单元尺寸（$\\Delta x, \\Delta y, V_c$）。我们生成以单元为中心的坐标，并初始化场 $\\rho$, $\\phi$, $\\mathbf{u}$, 和 $S_\\phi$ 为二维数组。初始守恒量为 $q^n = \\rho \\phi$。\n2.  **初始状态**：计算并存储初始总守恒量 $\\sum q^n V_c$ 和总源项贡献 $\\Delta t \\sum \\rho S_\\phi V_c$。\n3.  **通量计算**：\n    - 对于**周期性边界**，使用了 `np.roll` 函数。它通过环绕方式移动数组元素，自然地实现了周期性连接。例如，要获取右侧的邻居（索引 $i+1$），我们使用 `np.roll(q_n, -1, axis=0)`。通量在所有面上计算，散度计算为 `Fx - np.roll(Fx, 1, axis=0)`，这正确地表示了 $F_{i+1/2,j} - F_{i-1/2,j}$。\n    - 对于**封闭壁面边界**，对流通量为零。由于 $\\nabla\\phi \\cdot \\mathbf{n}=0$，边界处的扩散通量也为零。这是通过仅在内部面上计算通量来实现的。我们创建大小为 $(N_x+1) \\times N_y$ 的通量数组 `Fx` 和大小为 $N_x \\times (N_y+1)$ 的 `Fy`，将边界值设为零，并计算内部值。单元 $(i,j)$ 的散度则为 `Fx[i+1,j] - Fx[i,j] + Fy[i,j+1] - Fy[i,j]`。\n4.  **时间更新**：使用显式更新公式计算场 $q^{n+1}$。\n5.  **残差计算**：计算最终总守恒量 $\\sum q^{n+1} V_c$，并根据其定义计算残差 $R$。收集所有四个案例的 $R$ 值。\n\n此方法确保每个通量只计算一次，并以相反的符号贡献给它所分隔的两个单元，从而保证在封闭域上的所有通量散度之和在数值上为零。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are imported.\n\ndef run_case(params):\n    \"\"\"\n    Computes the conservation residual for a single test case.\n    \"\"\"\n    Nx, Ny = params['Nx'], params['Ny']\n    Lx, Ly = params['Lx'], params['Ly']\n    dt = params['dt']\n    rho_func = params['rho']\n    u, v = params['u']\n    Gamma_val = params['Gamma']\n    S_phi_func = params['S_phi']\n    phi_func = params['phi']\n    bc_type = params['bc']\n\n    # Grid setup\n    dx, dy = Lx / Nx, Ly / Ny\n    # Assume unit depth of 1m for Vc and face areas to ensure correct units (kg)\n    Vc = dx * dy  # Effective cell volume per unit depth\n    Ax, Ay = dy, dx  # Effective face areas per unit depth\n\n    # Cell-centered coordinates\n    x = np.linspace(dx / 2, Lx - dx / 2, Nx)\n    y = np.linspace(dy / 2, Ly - dy / 2, Ny)\n    xx, yy = np.meshgrid(x, y, indexing='ij')\n\n    # Initialize fields at time n\n    rho_n = rho_func(xx, yy)\n    S_phi_n = S_phi_func(xx, yy)\n    phi_n = phi_func(xx, yy)\n    \n    if isinstance(rho_n, (int, float)):\n        rho_n = np.full((Nx, Ny), rho_n)\n    \n    q_n = rho_n * phi_n\n    \n    # Calculate terms for the residual formula\n    total_q_initial = np.sum(q_n) * Vc\n    total_source_term = np.sum(rho_n * S_phi_n) * Vc * dt\n\n    # --- Calculate flux divergence ---\n    flux_divergence = np.zeros_like(q_n)\n\n    if bc_type == 'periodic':\n        # Advective fluxes\n        if u != 0 or v != 0:\n            q_right = np.roll(q_n, -1, axis=0)\n            q_up = np.roll(q_n, -1, axis=1)\n            \n            q_face_x = (q_n + q_right) / 2.0\n            F_adv_x = u * q_face_x * Ax\n            \n            q_face_y = (q_n + q_up) / 2.0\n            F_adv_y = v * q_face_y * Ay\n            \n            div_F_adv_x = F_adv_x - np.roll(F_adv_x, 1, axis=0)\n            div_F_adv_y = F_adv_y - np.roll(F_adv_y, 1, axis=1)\n            flux_divergence += div_F_adv_x + div_F_adv_y\n        \n        # Diffusive fluxes\n        if Gamma_val != 0:\n            phi_right = np.roll(phi_n, -1, axis=0)\n            phi_up = np.roll(phi_n, -1, axis=1)\n            \n            grad_phi_x = (phi_right - phi_n) / dx\n            F_diff_x = -Gamma_val * grad_phi_x * Ax\n            \n            grad_phi_y = (phi_up - phi_n) / dy\n            F_diff_y = -Gamma_val * grad_phi_y * Ay\n            \n            div_F_diff_x = F_diff_x - np.roll(F_diff_x, 1, axis=0)\n            div_F_diff_y = F_diff_y - np.roll(F_diff_y, 1, axis=1)\n            flux_divergence += div_F_diff_x + div_F_diff_y\n            \n    elif bc_type == 'closed_walls':\n        # Advective flux is zero for walls as u=v=0\n        \n        # Diffusive fluxes with zero-flux walls\n        if Gamma_val != 0:\n            Fx = np.zeros((Nx + 1, Ny))\n            Fy = np.zeros((Nx, Ny + 1))\n\n            # Internal x-fluxes\n            grad_phi_x_internal = (phi_n[1:, :] - phi_n[:-1, :]) / dx\n            Fx[1:-1, :] = -Gamma_val * grad_phi_x_internal * Ax\n\n            # Internal y-fluxes\n            grad_phi_y_internal = (phi_n[:, 1:] - phi_n[:, :-1]) / dy\n            Fy[:, 1:-1] = -Gamma_val * grad_phi_y_internal * Ay\n            \n            div_F_diff_x = Fx[1:, :] - Fx[:-1, :]\n            div_F_diff_y = Fy[:, 1:] - Fy[:, :-1]\n            flux_divergence += div_F_diff_x + div_F_diff_y\n\n    # Update q to time n+1\n    q_np1 = q_n - (dt / Vc) * flux_divergence + dt * rho_n * S_phi_n\n\n    # Calculate final total quantity and residual\n    total_q_final = np.sum(q_np1) * Vc\n    residual = np.abs(total_q_final - (total_q_initial + total_source_term))\n    \n    return residual\n\ndef solve():\n    pi = np.pi\n    test_cases = [\n        {\n            'Nx': 32, 'Ny': 32, 'Lx': 1.0, 'Ly': 1.0,\n            'rho': lambda x, y: 1.3,\n            'u': (0.7, -0.4),\n            'Gamma': 0,\n            'S_phi': lambda x, y: 0.0,\n            'phi': lambda x, y: np.sin(2 * pi * x) + 0.5 * np.cos(2 * pi * y),\n            'dt': 0.005,\n            'bc': 'periodic'\n        },\n        {\n            'Nx': 16, 'Ny': 17, 'Lx': 1.0, 'Ly': 0.8,\n            'rho': lambda x, y: 1.0,\n            'u': (0.0, 0.0),\n            'Gamma': 1.0 * 1e-3, # rho * D\n            'S_phi': lambda x, y: 0.0,\n            'phi': lambda x, y: x + 0.3 * np.sin(2 * pi * y),\n            'dt': 0.01,\n            'bc': 'closed_walls'\n        },\n        {\n            'Nx': 8, 'Ny': 9, 'Lx': 0.5, 'Ly': 0.4,\n            'rho': lambda x, y: 1.2,\n            'u': (0.0, 0.0),\n            'Gamma': 0.0,\n            'S_phi': lambda x, y: 2.5,\n            'phi': lambda x, y: 0.2 + 0.1 * np.cos(pi * x) * np.sin(pi * y),\n            'dt': 0.02,\n            'bc': 'periodic'\n        },\n        {\n            'Nx': 20, 'Ny': 18, 'Lx': 1.0, 'Ly': 1.0,\n            'rho': lambda x, y: 1.0 + 0.2 * np.sin(2 * pi * x) * np.cos(2 * pi * y),\n            'u': (0.0, 0.0),\n            'Gamma': 0.0,\n            'S_phi': lambda x, y: np.sin(pi * x) * np.cos(pi * y),\n            'phi': lambda x, y: np.sin(2 * pi * x) * np.sin(2 * pi * y),\n            'dt': 0.01,\n            'bc': 'periodic'\n        }\n    ]\n\n    results = []\n    for case_params in test_cases:\n        # The diffusion term calculation in the problem requires phi=q/rho, but the provided\n        # python code uses the initial phi_n. This is only correct for constant rho.\n        # Since diffusion is only tested with constant rho (case 2), we use the provided logic.\n        \n        # Renaming Gamma to avoid clash with lambda\n        params = case_params.copy()\n        params['Gamma_val'] = params.pop('Gamma')\n\n        result = run_case(params)\n        results.append(result)\n        \n    print(f\"[{','.join(format(r, '.16e') for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}