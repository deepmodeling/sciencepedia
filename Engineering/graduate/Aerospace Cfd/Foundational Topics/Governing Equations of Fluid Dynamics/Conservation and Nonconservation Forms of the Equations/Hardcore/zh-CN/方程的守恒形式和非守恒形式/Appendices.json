{
    "hands_on_practices": [
        {
            "introduction": "在计算流体力学中，坚持使用守恒形式的控制方程，其最根本的原因在于它们能够正确地捕捉激波等间断。本练习将通过一个直接的、动手实践的推导来展示这一关键原则。通过分析作为对流项模型的一维无粘Burgers方程，你将亲手推导出非守恒离散格式如何导致非物理的激波速度——这在任何空气动力学仿真中都是一个致命的缺陷。",
            "id": "3949772",
            "problem": "考虑一维无粘性伯格斯方程，它被用作无粘性可压缩欧拉方程中平流输运的标量模型，其守恒形式为 $u_{t} + \\partial_{x}\\left(\\frac{1}{2} u^{2}\\right) = 0$。在计算流体力学 (CFD) 的背景下，对于黎曼初始数据 $u(x,0) = u_{L}$（当 $x  0$）和 $u(x,0) = u_{R}$（当 $x > 0$）且 $u_{L} > u_{R}$ 时，会产生激波。\n\n1. 从积分守恒律和弱解的定义出发，通过将源于对 $\\partial_{t}\\int_{x_{1}}^{x_{2}} u \\, dx + \\left[\\frac{1}{2}u^{2}\\right]_{x_{1}}^{x_{2}} = 0$ 进行 Rankine–Hugoniot 分析得出的跳跃条件应用于一个位于 $x_{s}(t)$ 的移动间断，推导守恒形式伯格斯方程的激波速度 $s_{c}$。\n\n2. 现在考虑非守恒平流形式 $u_{t} + u \\, u_{x} = 0$ 在间距为 $\\Delta x$ 的均匀网格上的半离散有限体积离散化，该方法通过双线性形式来近似单元界面处的非守恒积\n$$\n\\frac{d u_{i}}{dt} + \\frac{1}{\\Delta x}\\left[\\widehat{a}_{i+\\frac{1}{2}}\\left(u_{i+1} - u_{i}\\right) - \\widehat{a}_{i-\\frac{1}{2}}\\left(u_{i} - u_{i-1}\\right)\\right] = 0, \n$$\n其中界面平流系数由有偏线性平均值给出\n$$\n\\widehat{a}_{i+\\frac{1}{2}} = \\alpha \\, u_{i} + \\left(1 - \\alpha\\right) u_{i+1}, \\quad \\text{其中 } \\alpha \\in [0,1].\n$$\n对于一个位于常数状态 $u_{L}$（左侧）和 $u_{R}$（右侧）之间的网格界面上的单个移动间断，应用与非守恒积理论一致的跳跃条件分析，推导此非守恒格式预测的激波速度，记为 $s_{nc}$，作为 $\\alpha$、$u_{L}$ 和 $u_{R}$ 的函数。\n\n3. 使用您在第 1 部分和第 2 部分中得到的结果，给出非守恒和守恒激波速度之间的差异 $s_{nc} - s_{c}$ 的闭式符号表达式，作为 $\\alpha$、$u_{L}$ 和 $u_{R}$ 的函数。将您的最终答案表示为单个解析表达式，无需进行数值计算。",
            "solution": "该问题分为三个部分。首先，我们推导一维无粘性伯格斯方程守恒形式的激波速度。其次，我们推导一个特定的非守恒有限体积离散格式的激波速度。第三，我们计算这两个速度之间的差值。\n\n第 1 部分：守恒激波速度 $s_{c}$ 的推导。\n一维无粘性伯格斯方程的守恒形式由下式给出\n$$ u_{t} + \\partial_{x}\\left( f(u) \\right) = 0, \\quad \\text{其中 } f(u) = \\frac{1}{2} u^{2} $$\n该守恒律在固定空间域 $[x_1, x_2]$ 上的积分形式为\n$$ \\frac{d}{dt} \\int_{x_{1}}^{x_{2}} u(x,t) \\, dx + f(u(x_2,t)) - f(u(x_1,t)) = 0 $$\n我们分析一个以单个间断（激波）形式存在的弱解，该间断以恒定速度 $s_{c}$ 移动。激波的位置是 $x_s(t) = s_{c}t$。给定黎曼初始数据，解是分段常数：\n$$ u(x,t) = \\begin{cases} u_{L}  \\text{若 } x  x_s(t) \\\\ u_{R}  \\text{若 } x > x_s(t) \\end{cases} $$\n设我们的控制体积 $[x_1, x_2]$ 是固定的，使得激波最初在其中，并在一段时间内保持在其中。我们可以计算该积分：\n$$ \\int_{x_{1}}^{x_{2}} u(x,t) \\, dx = \\int_{x_{1}}^{x_s(t)} u_{L} \\, dx + \\int_{x_s(t)}^{x_{2}} u_{R} \\, dx = u_{L}(x_s(t) - x_1) + u_{R}(x_2 - x_s(t)) $$\n现在，我们对这个表达式关于时间 $t$ 求导。项 $u_L x_1$ 和 $u_R x_2$ 是常数，它们的导数为零。\n$$ \\frac{d}{dt} \\int_{x_{1}}^{x_{2}} u(x,t) \\, dx = u_{L} \\frac{dx_s}{dt} - u_{R} \\frac{dx_s}{dt} = (u_{L} - u_{R}) s_{c} $$\n积分守恒律中的通量项是 $f(u(x_1,t)) - f(u(x_2,t))$。由于 $x_1$ 在激波的左侧，$x_2$ 在右侧，我们有 $u(x_1,t) = u_{L}$ 和 $u(x_2,t) = u_{R}$。因此，通量差为\n$$ f(u_L) - f(u_R) = \\frac{1}{2}u_{L}^{2} - \\frac{1}{2}u_{R}^{2} $$\n将这些结果代回积分守恒律，我们得到\n$$ (u_{L} - u_{R}) s_{c} + \\left( \\frac{1}{2}u_{R}^{2} - \\frac{1}{2}u_{L}^{2} \\right) = 0 $$\n这可以重新排列为标准的 Rankine-Hugoniot 跳跃条件 $s_{c}[u] = [f(u)]$，其中 $[q] = q_L - q_R$。\n$$ s_{c}(u_{L} - u_{R}) = f(u_{L}) - f(u_R) = \\frac{1}{2}u_{L}^{2} - \\frac{1}{2}u_{R}^{2} $$\n由于存在激波，$u_{L} \\neq u_{R}$，我们可以除以 $(u_L - u_R)$。\n$$ s_{c} = \\frac{\\frac{1}{2}(u_{L}^{2} - u_{R}^{2})}{u_{L} - u_{R}} = \\frac{\\frac{1}{2}(u_{L} - u_{R})(u_{L} + u_R)}{u_{L} - u_{R}} $$\n这得出了守恒激波速度：\n$$ s_{c} = \\frac{1}{2}(u_{L} + u_{R}) $$\n\n第 2 部分：非守恒激波速度 $s_{nc}$ 的推导。\n给定方程的非守恒平流形式 $u_{t} + u u_{x} = 0$，其离散形式为：\n$$ \\frac{d u_{i}}{dt} + \\frac{1}{\\Delta x}\\left[\\widehat{a}_{i+\\frac{1}{2}}\\left(u_{i+1} - u_{i}\\right) - \\widehat{a}_{i-\\frac{1}{2}}\\left(u_{i} - u_{i-1}\\right)\\right] = 0 $$\n其中界面平流系数 $\\widehat{a}_{i+\\frac{1}{2}} = \\alpha u_{i} + (1 - \\alpha) u_{i+1}$。\n乘积 $u u_x$ 是一个非守恒积。弱解，特别是间断的速度，取决于在状态空间中从左状态到右状态所取的路径。非守恒方程的数值格式隐含地定义了这条路径，并因此定义了激波速度。在这种类有限体积格式中，项 $\\widehat{a}_{i+\\frac{1}{2}}$ 表示单元 $i$ 和单元 $i+1$ 之间界面上的数值平流速度。穿过该界面的间断传播速度由这个数值定义的速度决定。\n对于位于界面 $i+\\frac{1}{2}$ 处的单个尖锐间断，与非守恒积理论一致的跳跃条件分析将激波速度 $s_{nc}$ 等同于界面速度 $\\widehat{a}_{i+\\frac{1}{2}}$。该界面左右两侧的状态分别为 $u_i = u_L$ 和 $u_{i+1} = u_R$。\n因此，该非守恒格式预测的激波速度为：\n$$ s_{nc} = \\widehat{a}_{i+\\frac{1}{2}} \\rvert_{u_i=u_L, u_{i+1}=u_R} $$\n代入 $\\widehat{a}_{i+\\frac{1}{2}}$ 的定义：\n$$ s_{nc} = \\alpha u_{L} + (1 - \\alpha) u_{R} $$\n该结果表明，激波速度是左右状态的线性插值，其权重由参数 $\\alpha$ 控制。\n\n第 3 部分：非守恒与守恒激波速度之间的差异。\n我们现在使用前面部分推导出的表达式计算差值 $s_{nc} - s_{c}$。\n$$ s_{nc} - s_{c} = \\left[ \\alpha u_{L} + (1 - \\alpha) u_{R} \\right] - \\left[ \\frac{1}{2}(u_{L} + u_{R}) \\right] $$\n我们将乘以 $u_L$ 和 $u_R$ 的项分组：\n$$ s_{nc} - s_{c} = \\left( \\alpha - \\frac{1}{2} \\right) u_{L} + \\left( 1 - \\alpha - \\frac{1}{2} \\right) u_{R} $$\n$$ s_{nc} - s_{c} = \\left( \\alpha - \\frac{1}{2} \\right) u_{L} + \\left( \\frac{1}{2} - \\alpha \\right) u_{R} $$\n提出公因式 $(\\alpha - \\frac{1}{2})$：\n$$ s_{nc} - s_{c} = \\left( \\alpha - \\frac{1}{2} \\right) u_{L} - \\left( \\alpha - \\frac{1}{2} \\right) u_{R} $$\n这给出了差异的最终闭式表达式：\n$$ s_{nc} - s_{c} = \\left(\\alpha - \\frac{1}{2}\\right)(u_{L} - u_{R}) $$\n该结果表明，只有当 $\\alpha = \\frac{1}{2}$ 时，非守恒格式才能得出正确的激波速度。对于 $\\alpha \\in [0,1]$ 的任何其他值，该格式将产生以不正确速度传播的激波，其误差与激波强度 $(u_L - u_R)$ 和偏置参数 $\\alpha$ 成正比。",
            "answer": "$$ \\boxed{\\left(\\alpha - \\frac{1}{2}\\right)(u_{L} - u_{R})} $$"
        },
        {
            "introduction": "尽管守恒律在笛卡尔坐标系下形式清晰，但在处理复杂几何时，将其应用于曲线坐标网格的数值实现带来了新的挑战：几何守恒律（Geometric Conservation Law, GCL）。本练习将引导你完成一个推导，揭示网格度量的不一致计算如何引入虚假的“源项”，从而破坏对简单均匀流场的保持特性。在此基础上，你将构造出正确的、满足几何守恒律的离散格式。",
            "id": "3949765",
            "problem": "考虑定义在静态曲线网格上的二维可压缩欧拉方程，该网格由从计算坐标 $(\\xi,\\eta)$ 到物理坐标 $(x(\\xi,\\eta), y(\\xi,\\eta))$ 的光滑一一映射定义。令守恒变量为 $\\boldsymbol{Q} = (\\rho, \\rho u, \\rho v, \\rho E)$，其中 $\\rho$ 是密度，$u$ 和 $v$ 是速度分量，$E$ 是比总能。在笛卡尔坐标系中，质量守恒方程为 $\\partial \\rho/\\partial t + \\partial(\\rho u)/\\partial x + \\partial(\\rho v)/\\partial y = 0$。定义雅可比行列式 $J = x_{\\xi} y_{\\eta} - x_{\\eta} y_{\\xi}$，其中下标表示偏导数。\n\n在曲线网格上，通过变量变换可以得到连续性方程的守恒形式，记为 $\\partial (J \\rho)/\\partial t + \\partial \\mathcal{F}^{\\xi}/\\partial \\xi + \\partial \\mathcal{F}^{\\eta}/\\partial \\eta = 0$，其中变换后的通量为 $\\mathcal{F}^{\\xi} = \\rho U^{\\xi}$ 和 $\\mathcal{F}^{\\eta} = \\rho U^{\\eta}$，逆变速度分量为 $U^{\\xi} = u \\, (J \\xi_{x}) + v \\, (J \\xi_{y})$ 和 $U^{\\eta} = u \\, (J \\eta_{x}) + v \\, (J \\eta_{y})$。此处，$J \\xi_{x}$、$J \\xi_{y}$、$J \\eta_{x}$ 和 $J \\eta_{y}$ 是雅可比加权的逆变度量分量。\n\n假设在均匀网格上存在均匀自由来流，其状态为常数 $(\\rho_{\\infty}, u_{\\infty}, v_{\\infty}, E_{\\infty})$，并使用作用于节点值的线性常系数算子 $D_{\\xi}$ 和 $D_{\\eta}$ 对空间导数进行离散化。假设度量是通过可能不同的算子 $\\widehat{D}_{\\xi}$ 和 $\\widehat{D}_{\\eta}$ 以及一个雅可比行列式 $\\widehat{J}$，采用类似链式法则的节点公式进行非守恒计算的：$ \\xi_{x}^{\\mathrm{nc}} = (\\widehat{D}_{\\eta} y)/\\widehat{J}$，$\\xi_{y}^{\\mathrm{nc}} = -(\\widehat{D}_{\\eta} x)/\\widehat{J}$，$\\eta_{x}^{\\mathrm{nc}} = -(\\widehat{D}_{\\xi} y)/\\widehat{J}$ 以及 $\\eta_{y}^{\\mathrm{nc}} = (\\widehat{D}_{\\xi} x)/\\widehat{J}$。然后，变换后的通量散度被离散化为 $D_{\\xi}(\\rho_{\\infty} U^{\\xi}_{\\mathrm{nc}}) + D_{\\eta}(\\rho_{\\infty} U^{\\eta}_{\\mathrm{nc}})$，其中 $U^{\\xi}_{\\mathrm{nc}} = u_{\\infty} \\, (J \\xi_{x}^{\\mathrm{nc}}) + v_{\\infty} \\, (J \\xi_{y}^{\\mathrm{nc}})$ 以及 $U^{\\eta}_{\\mathrm{nc}} = u_{\\infty} \\, (J \\eta_{x}^{\\mathrm{nc}}) + v_{\\infty} \\, (J \\eta_{y}^{\\mathrm{nc}})$。\n\n从物理守恒律和上述离散变换出发，推导在这种非守恒度量计算下，连续性方程的离散自由来流残差表达式。明确展示该残差如何依赖于度量恒等式的离散失效以及 $D_{\\xi}, D_{\\eta}$ 与 $\\widehat{D}_{\\xi}, \\widehat{D}_{\\eta}$ 之间的不匹配，并解释为何这会导致自由来流保持特性的丧失。\n\n然后，针对 $J \\xi_{x}$、$J \\xi_{y}$、$J \\eta_{x}$ 和 $J \\eta_{y}$ 提出一种严格守恒的度量计算方法，该方法使用坐标函数和与通量散度计算中相同的离散算子 $D_{\\xi}$ 和 $D_{\\eta}$，从而使离散度量恒等式得到满足，并且均匀自由来流得以保持。将您提出的守恒的雅可比加权逆变度量表示为 $(J \\xi_{x}, J \\xi_{y}, J \\eta_{x}, J \\eta_{y})$ 顺序的单行矩阵。最终答案必须是单一的封闭形式解析表达式。无需单位。",
            "solution": "此问题探讨了在曲线网格上求解可压缩欧拉方程的数值解法中，自由来流保持这一关键概念。该特性是几何守恒律 (Geometric Conservation Law, GCL) 的一种具体表现，它要求数值格式能够精确保持均匀流场，而均匀流场是连续控制方程的一个平凡解。若未能满足此要求，将引入伪源项，从而污染整个数值解。此分析的关键在于坐标变换所产生的度量恒等式的离散形式。\n\n首先，我们将分析给定的非守恒离散化方法以推导自由来流残差。然后，基于此分析，我们将构建一种能保证残差恒为零的守恒度量计算方法。\n\n在物理笛卡尔坐标 $(x,y)$ 中，连续性方程由下式给出\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial(\\rho u)}{\\partial x} + \\frac{\\partial(\\rho v)}{\\partial y} = 0\n$$\n对于均匀自由来流，变量 $(\\rho_{\\infty}, u_{\\infty}, v_{\\infty})$ 在空间和时间上均为常数。因此，所有偏导数都为零，该方程得到平凡满足。挑战在于确保此特性在曲线网格上离散化后仍能保持。\n\n对于均匀自由来流，连续性方程空间导数项的离散形式表示为残差 $R$：\n$$\nR = D_{\\xi}(\\rho_{\\infty} U^{\\xi}_{\\mathrm{nc}}) + D_{\\eta}(\\rho_{\\infty} U^{\\eta}_{\\mathrm{nc}})\n$$\n其中 $D_{\\xi}$ 和 $D_{\\eta}$ 是用于通量散度的离散算子。由于自由来流状态 $(\\rho_{\\infty}, u_{\\infty}, v_{\\infty})$ 是常数，我们可以将其从离散算子中提取出来：\n$$\nR = \\rho_{\\infty} \\left[ D_{\\xi}(U^{\\xi}_{\\mathrm{nc}}) + D_{\\eta}(U^{\\eta}_{\\mathrm{nc}}) \\right]\n$$\n非守恒的逆变速度由下式给出\n$$\nU^{\\xi}_{\\mathrm{nc}} = u_{\\infty} (J \\xi_{x})_{\\mathrm{nc}} + v_{\\infty} (J \\xi_{y})_{\\mathrm{nc}}\n$$\n$$\nU^{\\eta}_{\\mathrm{nc}} = u_{\\infty} (J \\eta_{x})_{\\mathrm{nc}} + v_{\\infty} (J \\eta_{y})_{\\mathrm{nc}}\n$$\n问题陈述以一种稍微复杂的方式定义了非守恒度量。它定义了 $\\xi_{x}^{\\mathrm{nc}} = (\\widehat{D}_{\\eta} y)/\\widehat{J}$，然后在通量中使用了 $J \\xi_{x}^{\\mathrm{nc}}$ 这一项。这引入了一个模糊的雅可比行列式之比 $J/\\widehat{J}$。为了进行易于处理的分析，我们将采用此问题的标准提法，即假设非守恒的雅可比加权度量是通过使用一组独立的算子 $\\widehat{D}_{\\xi}$ 和 $\\widehat{D}_{\\eta}$ 直接离散化连续恒等式 $J\\xi_x=y_\\eta$、$J\\xi_y=-x_\\eta$ 等来定义的。这些定义是：\n$$\n(J \\xi_{x})_{\\mathrm{nc}} = \\widehat{D}_{\\eta} y\n$$\n$$\n(J \\xi_{y})_{\\mathrm{nc}} = -\\widehat{D}_{\\eta} x\n$$\n$$\n(J \\eta_{x})_{\\mathrm{nc}} = -\\widehat{D}_{\\xi} y\n$$\n$$\n(J \\eta_{y})_{\\mathrm{nc}} = \\widehat{D}_{\\xi} x\n$$\n将这些定义代入残差 $R$ 的表达式中：\n$$\nR = \\rho_{\\infty} \\left[ D_{\\xi} \\left( u_{\\infty} (\\widehat{D}_{\\eta} y) + v_{\\infty} (-\\widehat{D}_{\\eta} x) \\right) + D_{\\eta} \\left( u_{\\infty} (-\\widehat{D}_{\\xi} y) + v_{\\infty} (\\widehat{D}_{\\xi} x) \\right) \\right]\n$$\n由于 $u_{\\infty}$ 和 $v_{\\infty}$ 是常数，它们也可以被提取出来：\n$$\nR = \\rho_{\\infty} u_{\\infty} \\left[ D_{\\xi}(\\widehat{D}_{\\eta} y) + D_{\\eta}(-\\widehat{D}_{\\xi} y) \\right] + \\rho_{\\infty} v_{\\infty} \\left[ D_{\\xi}(-\\widehat{D}_{\\eta} x) + D_{\\eta}(\\widehat{D}_{\\xi} x) \\right]\n$$\n整理各项，得到离散自由来流残差的最终表达式：\n$$\nR = \\rho_{\\infty} u_{\\infty} \\left( D_{\\xi} \\widehat{D}_{\\eta} y - D_{\\eta} \\widehat{D}_{\\xi} y \\right) - \\rho_{\\infty} v_{\\infty} \\left( D_{\\xi} \\widehat{D}_{\\eta} x - D_{\\eta} \\widehat{D}_{\\xi} x \\right)\n$$\n这个残差通常不为零。自由来流保持特性的丧失源于此表达式中明确显示的两个主要原因：\n1.  **离散算子不匹配**：该表达式涉及到用于通量散度的算子 $D_{\\xi}$ 和 $D_{\\eta}$，以及用于度量计算的算子 $\\widehat{D}_{\\xi}$ 和 $\\widehat{D}_{\\eta}$。如果 $D_{\\xi} \\neq \\widehat{D}_{\\xi}$ 或 $D_{\\eta} \\neq \\widehat{D}_{\\eta}$，则没有数学依据可以期望各项会相互抵消。离散运算的应用不一致。\n2.  **度量恒等式的离散失效**：即使算子匹配（即 $\\widehat{D}_{\\xi} = D_{\\xi}$ 且 $\\widehat{D}_{\\eta} = D_{\\eta}$），残差也变为 $R = \\rho_{\\infty} u_{\\infty} (D_{\\xi} D_{\\eta} - D_{\\eta} D_{\\xi})y - \\rho_{\\infty} v_{\\infty} (D_{\\xi} D_{\\eta} - D_{\\eta} D_{\\xi})x$。如果离散算子 $D_{\\xi}$ 和 $D_{\\eta}$ 不可交换，即 $[D_{\\xi}, D_{\\eta}] \\equiv D_{\\xi}D_{\\eta} - D_{\\eta}D_{\\xi} \\neq 0$，则该残差不为零。在连续情况下，相应的度量恒等式，例如 $\\partial_{\\xi}(y_{\\eta}) + \\partial_{\\eta}(-y_{\\xi}) = y_{\\eta\\xi} - y_{\\xi\\eta} = 0$，依赖于混合偏导数的相等性（Schwarz's theorem）。一般的离散差分算子是不可交换的，因此它们的离散形式不会自动满足。这个非零残差充当一个数值源项，违反了 GCL。\n\n为确保自由来流保持，对于任何均匀自由来流状态 $(\\rho_{\\infty}, u_{\\infty}, v_{\\infty})$，残差 $R$ 必须恒为零。这意味着残差表达式中 $u_{\\infty}$ 和 $v_{\\infty}$ 的系数必须各自独立为零。这要求雅可比加权的度量分量 $(J\\xi_x, J\\xi_y, J\\eta_x, J\\eta_y)$ 满足离散度量恒等式（或 GCL）：\n$$\nD_{\\xi}(J\\xi_x) + D_{\\eta}(J\\eta_x) = 0\n$$\n$$\nD_{\\xi}(J\\xi_y) + D_{\\eta}(J\\eta_y) = 0\n$$\n关键步骤是以一种能够*通过构造*满足这些离散恒等式的方式来定义度量项。这可以通过在度量计算和通量散度计算中使用*相同*的离散算子 $D_{\\xi}$ 和 $D_{\\eta}$ 来实现。我们通过直接离散化连续关系式 $J\\xi_x = y_{\\eta}$、$J\\xi_y = -x_{\\eta}$ 等，提出以下守恒的度量计算方法：\n$$\n(J \\xi_x)_{\\mathrm{cons}} = D_{\\eta} y\n$$\n$$\n(J \\xi_y)_{\\mathrm{cons}} = -D_{\\eta} x\n$$\n$$\n(J \\eta_x)_{\\mathrm{cons}} = -D_{\\xi} y\n$$\n$$\n(J \\eta_y)_{\\mathrm{cons}} = D_{\\xi} x\n$$\n让我们将这些定义代入离散度量恒等式中，以验证其有效性。\n对于第一个恒等式：\n$$\nD_{\\xi}((J\\xi_x)_{\\mathrm{cons}}) + D_{\\eta}((J\\eta_x)_{\\mathrm{cons}}) = D_{\\xi}(D_{\\eta} y) + D_{\\eta}(-D_{\\xi} y) = (D_{\\xi}D_{\\eta} - D_{\\eta}D_{\\xi})y\n$$\n对于第二个恒等式：\n$$\nD_{\\xi}((J\\xi_y)_{\\mathrm{cons}}) + D_{\\eta}((J\\eta_y)_{\\mathrm{cons}}) = D_{\\xi}(-D_{\\eta} x) + D_{\\eta}(D_{\\xi} x) = (-D_{\\xi}D_{\\eta} + D_{\\eta}D_{\\xi})x = -(D_{\\xi}D_{\\eta} - D_{\\eta}D_{\\xi})x\n$$\n当且仅当算子 $D_{\\xi}$ 和 $D_{\\eta}$ 可交换时，这些表达式为零。问题陈述指出，这些算子是“线性的、常系数的”并且作用于“均匀网格”上。设一个通用的一维线性常系数算子由模板 $c_k$ 定义：$D_{\\xi} f_{i,j} = \\sum_k c_k f_{i+k, j}$。类似地，$D_{\\eta} f_{i,j} = \\sum_l c'_l f_{i, j+l}$。依次应用这些算子：\n$$\n(D_{\\xi} D_{\\eta}) f_{i,j} = D_{\\xi} \\left( \\sum_l c'_l f_{i, j+l} \\right) = \\sum_k c_k \\left( \\sum_l c'_l f_{i+k, j+l} \\right) = \\sum_{k,l} c_k c'_l f_{i+k, j+l}\n$$\n$$\n(D_{\\eta} D_{\\xi}) f_{i,j} = D_{\\eta} \\left( \\sum_k c_k f_{i+k, j} \\right) = \\sum_l c'_l \\left( \\sum_k c_k f_{i+k, j+l} \\right) = \\sum_{k,l} c'_l c_k f_{i+k, j+l}\n$$\n由于标量乘法是可交换的（$c_k c'_l = c'_l c_k$），我们有 $D_{\\xi} D_{\\eta} = D_{\\eta} D_{\\xi}$。问题陈述中指定的条件保证了算子是可交换的。因此，所提出的度量定义满足离散度量恒等式，并确保自由来流残差恒为零。这就是所要求的严格守恒的度量计算方法。\n\n因此，满足 GCL 的雅可比加权逆变度量分量可以通过将通量散度算子 $D_\\xi$ 和 $D_\\eta$ 应用于物理坐标函数 $x$ 和 $y$ 来得到。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nD_{\\eta} y  -D_{\\eta} x  -D_{\\xi} y  D_{\\xi} x\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在几何守恒律概念的基础上，最后一个练习将带你进入动网格和变形网格的动态世界，即任意拉格朗日-欧拉（Arbitrary Lagrangian-Eulerian, ALE）方法。通过一个动手编程实践，你将实现并比较两种格式：一种正确满足离散GCL，另一种则不满足。这将提供一个鲜明直观的展示，说明为何对网格运动的一致性处理对于获得准确和稳定的仿真结果至关重要。",
            "id": "3949807",
            "problem": "考虑在一维周期性变形网格上，在任意拉格朗日-欧拉 (ALE) 意义下的被动标量守恒律，该问题定义在一个长度为 $L=1$ 的周期性域上：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} f(u) = 0,\n$$\n其物理通量为线性关系 $f(u) = a\\,u$，其中 $a$ 是一个恒定的平流速度。设计算网格随时间变形，其网格面速度 $v_g(x,t)$ 的空间平均值为零，以使总域长度保持为 $L=1$。所有量均为无量纲。\n\n您的任务是推导、实现并比较两种在移动网格上的有限体积时间步进离散化方法，用于恒定状态保持测试。目标概念是离散几何守恒律 (GCL)。待测试的恒定状态是 $u(x,0) = u_0$，一个均匀常数。从移动控制体上的积分守恒律和作为基本依据的 Reynolds Transport Theorem 开始：\n$$\n\\frac{d}{dt}\\int_{\\mathcal{V}(t)} u\\,dx + \\int_{\\partial \\mathcal{V}(t)} \\left( f(u) - u\\,v_g \\right)\\,n\\,dS = 0,\n$$\n将其特化到一维空间，其中 $n$ 是外单位法向量，$v_g$ 是网格面的法向速度。用 $J_i(t)$ 表示单元体积（长度），用 $u_i(t)$ 表示单元平均值。离散 GCL 是一个条件，要求 $J_i$ 的离散更新和离散的面法向网格速度相一致，从而在网格运动下能够保持恒定状态。\n\n您必须：\n1. 构建一个一阶显式有限体积格式，其中 $J_i$ 的离散更新是通过使用与 ALE 数值通量中出现相同的逐面网格速度来更新网格面位置得到的。该格式必须在一维中精确满足离散 GCL，并且对于任何均值为零的网格运动 $v_g(x,t)$，都能保持恒定状态 $u(x,t)=u_0$。\n2. 构建一个对比格式，该格式通过在通量中计算网格贡献时使用与更新网格面所用速度不同的逐面速度（例如，通过平均相邻单元中心的网格速度来获得近似的面速度）来违反离散 GCL。保持网格面运动与第1项中的完全相同，从而只有通量中的网格速度使用是不一致的。\n3. 将两种格式从 $t=0$ 演化到指定的 $t=T$，并报告与初始恒定状态的最大绝对偏差，即对每个格式报告：\n$$\ne_{\\infty} = \\max_i \\left| u_i(T) - u_0 \\right|\n$$\n\n需遵守的实现细节：\n- 使用一个长度为 $L=1$ 的周期性域，初始时有 $N$ 个均匀单元；通过其 $N$ 个面位置来表示网格，并采用周期性索引。单元长度为 $J_i(t)=x_{i+\\frac{1}{2}}(t)-x_{i-\\frac{1}{2}}(t)$ 并具有周期性环绕处理。\n- 使用固定时间步长 $\\Delta t$ 的一阶显式欧拉时间积分，以及基于每个面上相对特征速度符号的一阶迎风数值通量。$j$ 面上的 ALE 面通量必须计算为：\n$$\nF_j = \\left( a - v_{g,j} \\right) u^{\\text{up}}_j,\n$$\n其中 $u^{\\text{up}}_j$ 是由 $a - v_{g,j}$ 的符号决定的迎风状态，$v_{g,j}$ 是如下文所述一致使用的面法向网格速度。\n- 对于满足 GCL 的格式，通过以下方式更新面位置：\n$$\nx_{j}^{n+1} = x_{j}^{n} + \\Delta t\\, v_g\\!\\left(x_j^n,t^n\\right),\n$$\n并从更新后的面位置重新计算单元长度 $J_i^{n+1}$，同时在通量 $F_j$ 中使用相同的面速度值 $v_g\\!\\left(x_j^n,t^n\\right)$。\n- 对于违反 GCL 的格式，面位置的更新方式与满足 GCL 的格式完全相同，但在每个面上构造进入通量的网格速度时，采用不等于实际面速度的不同近似方法（例如，通过平均在相邻单元中心处计算的 $v_g$）。这将破坏离散 GCL，并应在移动网格上对恒定状态产生非零的 $e_{\\infty}$。\n\n取网格面速度为：\n$$\nv_g(x,t) = \\beta \\,\\sin\\!\\left( 2\\pi m x \\right)\\,\\cos\\!\\left( 2\\pi t \\right),\n$$\n对于任何整数 $m \\ge 1$，其空间平均值为零。\n\n所有量均为无量纲；因此答案中不要求物理单位。\n\n测试套件：\n实现程序以运行以下三个测试用例，每个都从均匀常数 $u_0 = 1.2345$ 开始：\n- 测试 1（静态网格，基准）：$N=64$, $a=0.7$, $\\beta=0.0$, $m=1$, $T=0.1$, $\\Delta t = 5.0\\times 10^{-4}$。\n- 测试 2（中等变形）：$N=64$, $a=0.5$, $\\beta=0.2$, $m=1$, $T=0.1$, $\\Delta t = 2.5\\times 10^{-4}$。\n- 测试 3（更强、更高频的变形，纯网格运动）：$N=64$, $a=0.0$, $\\beta=0.3$, $m=2$, $T=0.1$, $\\Delta t = 2.0\\times 10^{-4}$。\n\n对于每个测试用例，计算并记录两个浮点误差：满足 GCL 的格式的 $e_{\\infty}^{\\text{GCL}}$ 和违反 GCL 的格式的 $e_{\\infty}^{\\neg \\text{GCL}}$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试的六个结果，形式为方括号内以逗号分隔的科学记数法浮点数列表，顺序如下：\n$$\n\\left[ e_{\\infty}^{\\text{GCL}}(\\text{Test 1}),\\, e_{\\infty}^{\\neg \\text{GCL}}(\\text{Test 1}),\\, e_{\\infty}^{\\text{GCL}}(\\text{Test 2}),\\, e_{\\infty}^{\\neg \\text{GCL}}(\\text{Test 2}),\\, e_{\\infty}^{\\text{GCL}}(\\text{Test 3}),\\, e_{\\infty}^{\\neg \\text{GCL}}(\\text{Test 3}) \\right].\n$$\n不应打印其他任何文本。",
            "solution": "此问题是有效的。这是一个适定且科学上合理的练习，涉及在移动网格上求解守恒律的数值解法，并探讨了离散几何守恒律（GCL）的基本概念。\n\n起点是一维守恒律在时变控制体 $\\mathcal{V}_i(t) = [x_{i-1/2}(t), x_{i+1/2}(t)]$ 上的积分形式，这是 Reynolds Transport Theorem 的一个应用：\n$$\n\\frac{d}{dt}\\int_{x_{i-1/2}(t)}^{x_{i+1/2}(t)} u\\,dx + F(u, v_g)\\Big|_{x_{i+1/2}(t)} - F(u, v_g)\\Big|_{x_{i-1/2}(t)} = 0\n$$\n此处，$F(u, v_g) = f(u) - u v_g$ 是 ALE 通量，它结合了物理通量 $f(u) = a u$ 和由网格以速度 $v_g$ 运动引起的通量。\n\n定义单元平均值 $u_i(t) = \\frac{1}{J_i(t)} \\int_{x_{i-1/2}(t)}^{x_{i+1/2}(t)} u\\,dx$，其中 $J_i(t) = x_{i+1/2}(t) - x_{i-1/2}(t)$ 是单元体积（长度），则方程可以用守恒量 $J_i u_i$ 来表示：\n$$\n\\frac{d(J_i u_i)}{dt} + F_{i+1/2} - F_{i-1/2} = 0\n$$\n其中 $F_j$ 是在 $j$ 面上近似 $F(u, v_g)$ 的数值 ALE 通量。使用一阶显式欧拉时间积分，全离散更新格式为：\n$$\n(J_i u_i)^{n+1} = (J_i u_i)^{n} - \\Delta t (F_{i+1/2}^n - F_{i-1/2}^n)\n$$\n其中上标 $n$ 表示在时间 $t^n$ 的值。然后通过除以新的单元体积 $J_i^{n+1}$ 来恢复更新后的单元平均值：\n$$\nu_i^{n+1} = \\frac{1}{J_i^{n+1}} \\left[ J_i^n u_i^n - \\Delta t (F_{i+1/2}^n - F_{i-1/2}^n) \\right]\n$$\n新的单元体积 $J_i^{n+1}$ 由其边界面的运动确定。使用显式欧拉方法，面位置更新为 $x_j^{n+1} = x_j^n + \\Delta t \\, v_{g,j}^n$。这导出了一个单元体积更新规则：\n$$\nJ_i^{n+1} = x_{i+1/2}^{n+1} - x_{i-1/2}^{n+1} = (x_{i+1/2}^n + \\Delta t \\, v_{g,i+1/2}^n) - (x_{i-1/2}^n + \\Delta t \\, v_{g,i-1/2}^n) = J_i^n + \\Delta t (v_{g,i+1/2}^n - v_{g,i-1/2}^n)\n$$\n离散几何守恒律 (GCL) 是数值格式在移动网格上为保持恒定状态（例如 $u(x,t) = u_0$）所必须满足的条件。这要求体积更新与数值通量中的网格运动项之间存在特定的一致性。\n\n**1. 满足 GCL 的格式**\n\n该格式的构建旨在满足离散 GCL。\n面位置使用精确的面速度 $v_{g,j}^n = v_g(x_j^n, t^n)$ 进行更新：\n$$\nx_j^{n+1} = x_j^n + \\Delta t \\, v_{g,j}^n\n$$\n关键步骤是在数值通量中使用*完全相同*的速度 $v_{g,j}^n$。问题指定了针对 ALE 平流速度 $a - v_{g,j}$ 的一阶迎风通量。对于所有 $i$ 均为恒定状态 $u_i^n = u_0$ 时，迎风状态就是 $u_0$。因此，在 $j$ 面上的数值通量为：\n$$\nF_j^n = (a - v_{g,j}^n) u_0\n$$\n将此代入 $u_i^{n+1}$ 的更新公式中：\n$$\nu_i^{n+1} = \\frac{1}{J_i^{n+1}} \\left[ J_i^n u_0 - \\Delta t \\left( (a - v_{g,i+1/2}^n)u_0 - (a - v_{g,i-1/2}^n)u_0 \\right) \\right]\n$$\n$$\nu_i^{n+1} = \\frac{u_0}{J_i^{n+1}} \\left[ J_i^n - \\Delta t ( -v_{g,i+1/2}^n + v_{g,i-1/2}^n ) \\right]\n$$\n$$\nu_i^{n+1} = \\frac{u_0}{J_i^{n+1}} \\left[ J_i^n + \\Delta t ( v_{g,i+1/2}^n - v_{g,i-1/2}^n ) \\right]\n$$\n根据上面推导的体积更新规则，方括号中的项恰好是 $J_i^{n+1}$。因此：\n$$\nu_i^{n+1} = \\frac{u_0}{J_i^{n+1}} \\left[ J_i^{n+1} \\right] = u_0\n$$\n该格式满足离散 GCL，因此能够保持恒定状态达到机器精度。对于所有测试用例，预期所得误差 $e_{\\infty}^{\\text{GCL}}$ 都接近于零。\n\n**2. 违反 GCL 的格式**\n\n该格式的构建旨在故意违反离散 GCL。面运动和体积更新与满足 GCL 的格式相同：\n$$\nx_j^{n+1} = x_j^n + \\Delta t \\, v_{g,j}^n \\quad \\text{and} \\quad J_i^{n+1} = J_i^n + \\Delta t (v_{g,i+1/2}^n - v_{g,i-1/2}^n)\n$$\n然而，在数值通量中使用的网格速度，我们称之为 $\\tilde{v}_{g,j}^n$，其计算方式是不一致的。按照问题的建议，我们可以通过平均相邻单元中心的速度来近似面速度。设 $x_{c,i}^n$ 为单元 $i$ 的中心。\n$$\n\\tilde{v}_{g,i+1/2}^n = \\frac{1}{2} \\left( v_g(x_{c,i}^n, t^n) + v_g(x_{c,i+1}^n, t^n) \\right)\n$$\n通常情况下，这个插值得到的速度 $\\tilde{v}_{g,j}^n$ 不等于用来移动网格的真实面速度 $v_{g,j}^n$。对于恒定状态 $u_0$，通量为 $F_j^n = (a - \\tilde{v}_{g,j}^n) u_0$。更新公式变为：\n$$\nu_i^{n+1} = \\frac{u_0}{J_i^{n+1}} \\left[ J_i^n + \\Delta t ( \\tilde{v}_{g,i+1/2}^n - \\tilde{v}_{g,i-1/2}^n ) \\right]\n$$\n代入 $J_i^n = J_i^{n+1} - \\Delta t (v_{g,i+1/2}^n - v_{g,i-1/2}^n)$：\n$$\nu_i^{n+1} = \\frac{u_0}{J_i^{n+1}} \\left[ J_i^{n+1} - \\Delta t (v_{g,i+1/2}^n - v_{g,i-1/2}^n) + \\Delta t (\\tilde{v}_{g,i+1/2}^n - \\tilde{v}_{g,i-1/2}^n) \\right]\n$$\n$$\nu_i^{n+1} = u_0 \\left( 1 + \\frac{\\Delta t}{J_i^{n+1}} \\left[ (\\tilde{v}_{g,i+1/2}^n - v_{g,i+1/2}^n) - (\\tilde{v}_{g,i-1/2}^n - v_{g,i-1/2}^n) \\right] \\right)\n$$\n由于 $\\tilde{v}_g \\neq v_g$，括号中的项非零，产生了一个数值源/汇项，错误地改变了解。因此，$u_i^{n+1} \\neq u_0$。该格式将无法保持恒定状态，当网格运动时（$\\beta \\neq 0$），$e_{\\infty}^{\\neg \\text{GCL}}$ 将显著大于零。对于静态网格（$\\beta = 0$），$v_g = \\tilde{v}_g = 0$，两种格式变得相同，并且对于恒定状态都是精确的。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(N, a, beta, m, T, dt, u0, L=1.0):\n    \"\"\"\n    Runs the simulation for one test case for both GCL-satisfying and GCL-violating schemes.\n    \"\"\"\n    n_steps = int(round(T / dt))\n\n    # ---- GCL-CONSERVING SIMULATION INITIALIZATION ----\n    x_f_gcl = np.linspace(0, L, N, endpoint=False)\n    # Calculate initial volumes from face positions\n    x_f_right_gcl = np.roll(x_f_gcl, -1)\n    x_f_right_gcl[-1] += L\n    J_gcl = x_f_right_gcl - x_f_gcl\n    u_gcl = np.full(N, u0)\n\n    # ---- GCL-VIOLATING SIMULATION INITIALIZATION ----\n    x_f_ngcl = np.copy(x_f_gcl)\n    J_ngcl = np.copy(J_gcl)\n    u_ngcl = np.copy(u_gcl)\n\n    # --- TIME-STEPPING LOOP ---\n    for n in range(n_steps):\n        t = n * dt\n\n        # === GCL-SATISFYING SCHEME UPDATE ===\n        # 1. Calculate face velocities (consistent)\n        v_g_faces_gcl = beta * np.sin(2 * np.pi * m * x_f_gcl) * np.cos(2 * np.pi * t)\n\n        # 2. Calculate ALE fluxes\n        rel_speed_gcl = a - v_g_faces_gcl\n        u_left_gcl = np.roll(u_gcl, 1)  # u_left at face i is u_(i-1)\n        u_up_gcl = np.where(rel_speed_gcl > 0, u_left_gcl, u_gcl)\n        F_gcl = rel_speed_gcl * u_up_gcl\n\n        # 3. Update conserved variable (u*J)\n        Ju_gcl = u_gcl * J_gcl\n        flux_diff_gcl = np.roll(F_gcl, -1) - F_gcl # F_at_right_face - F_at_left_face\n        Ju_gcl_new = Ju_gcl - dt * flux_diff_gcl\n\n        # 4. Update mesh positions\n        x_f_gcl_new = x_f_gcl + dt * v_g_faces_gcl\n\n        # 5. Update cell volumes\n        x_f_right_gcl_new = np.roll(x_f_gcl_new, -1)\n        x_f_right_gcl_new[-1] += L\n        J_gcl_new = x_f_right_gcl_new - x_f_gcl_new\n\n        # 6. Update solution\n        u_gcl_new = Ju_gcl_new / J_gcl_new\n\n        # 7. Advance state for next step\n        x_f_gcl, J_gcl, u_gcl = x_f_gcl_new, J_gcl_new, u_gcl_new\n\n        # === GCL-VIOLATING SCHEME UPDATE ===\n        # 1. Calculate velocities: v_g_motion for moving faces, v_g_tilde for flux\n        v_g_motion = beta * np.sin(2 * np.pi * m * x_f_ngcl) * np.cos(2 * np.pi * t)\n\n        x_f_right_ngcl = np.roll(x_f_ngcl, -1)\n        x_f_right_ngcl[-1] += L\n        x_c_ngcl = (x_f_ngcl + x_f_right_ngcl) / 2.0\n        \n        v_g_cell_centers = beta * np.sin(2 * np.pi * m * x_c_ngcl) * np.cos(2 * np.pi * t)\n        v_g_tilde = (v_g_cell_centers + np.roll(v_g_cell_centers, 1)) / 2.0\n\n        # 2. Calculate ALE fluxes with inconsistent velocity\n        rel_speed_ngcl = a - v_g_tilde\n        u_left_ngcl = np.roll(u_ngcl, 1)\n        u_up_ngcl = np.where(rel_speed_ngcl > 0, u_left_ngcl, u_ngcl)\n        F_ngcl = rel_speed_ngcl * u_up_ngcl\n\n        # 3. Update conserved variable (u*J)\n        Ju_ngcl = u_ngcl * J_ngcl\n        flux_diff_ngcl = np.roll(F_ngcl, -1) - F_ngcl\n        Ju_ngcl_new = Ju_ngcl - dt * flux_diff_ngcl\n\n        # 4. Update mesh (using the *true* face velocities)\n        x_f_ngcl_new = x_f_ngcl + dt * v_g_motion\n\n        # 5. Update cell volumes\n        x_f_right_ngcl_new = np.roll(x_f_ngcl_new, -1)\n        x_f_right_ngcl_new[-1] += L\n        J_ngcl_new = x_f_right_ngcl_new - x_f_ngcl_new\n\n        # 6. Update solution\n        u_ngcl_new = Ju_ngcl_new / J_ngcl_new\n\n        # 7. Advance state for next step\n        x_f_ngcl, J_ngcl, u_ngcl = x_f_ngcl_new, J_ngcl_new, u_ngcl_new\n\n    e_inf_gcl = np.max(np.abs(u_gcl - u0))\n    e_inf_ngcl = np.max(np.abs(u_ngcl - u0))\n\n    return e_inf_gcl, e_inf_ngcl\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run simulations, and print results.\n    \"\"\"\n    test_cases = [\n        # (N, a, beta, m, T, dt)\n        (64, 0.7, 0.0, 1, 0.1, 5.0e-4),  # Test 1: Static mesh\n        (64, 0.5, 0.2, 1, 0.1, 2.5e-4),  # Test 2: Moderate deformation\n        (64, 0.0, 0.3, 2, 0.1, 2.0e-4),  # Test 3: Stronger deformation\n    ]\n    u0 = 1.2345\n\n    results = []\n    for params in test_cases:\n        e_gcl, e_ngcl = run_simulation(*params, u0=u0)\n        results.extend([e_gcl, e_ngcl])\n\n    print(f\"[{','.join(f'{r:.6e}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}