{
    "hands_on_practices": [
        {
            "introduction": "A successful power converter design begins with the proper selection of its core components. In a boost PFC circuit, the inductor is paramount, as it is the primary energy storage element that enables voltage boosting. This exercise  guides you through the fundamental process of sizing this inductor to meet a specific performance target for the inductor current ripple, a critical factor in ensuring the converter operates consistently in continuous conduction mode (CCM).",
            "id": "3829458",
            "problem": "A single-phase boost Power Factor Correction (PFC) pre-regulator operating in Continuous Conduction Mode (CCM) with Average Current Control is supplied from a sinusoidal line of root-mean-square voltage $V_{\\text{rms}}=230$ and regulates a direct-current output voltage $V_{\\text{out}}=400$. The output power is $P_{\\text{out}}=1000$, and the switching frequency is $f_{s}=100000$. Assume ideal components (zero semiconductor voltage drops, lossless inductor and switch, and negligible input filter effects), unity power factor such that the input current is proportional to the instantaneous input voltage, and steady-state operation. The inductor current ripple specification is that the peak-to-peak inductor current ripple $\\Delta i_{L}$ must satisfy $\\Delta i_{L}/I_{L,\\text{avg}}\\leq 0.10$ at the low-line peak of the rectified sinusoid.\n\nUsing only fundamental laws, namely the inductor law $v_{L}=L\\,di_{L}/dt$, volt-second balance over one switching period, and the definition of root-mean-square and peak values for sinusoidal quantities, determine the minimum inductance $L$ that satisfies the ripple criterion at the low-line peak. Express your final inductance in millihenries (mH) and round your answer to four significant figures.",
            "solution": "The problem asks for the minimum inductance $L$ for a continuous-conduction mode (CCM) boost Power Factor Correction (PFC) pre-regulator that satisfies a specific inductor current ripple criterion. The solution will be derived from fundamental principles as requested.\n\nFirst, the givens are extracted and validated.\nInput root-mean-square voltage: $V_{\\text{rms}} = 230 \\, \\text{V}$\nOutput direct-current voltage: $V_{\\text{out}} = 400 \\, \\text{V}$\nOutput power: $P_{\\text{out}} = 1000 \\, \\text{W}$\nSwitching frequency: $f_{s} = 100000 \\, \\text{Hz}$\nRipple criterion: $\\frac{\\Delta i_{L}}{I_{L,\\text{avg}}} \\leq 0.10$ at the low-line peak.\n\nAssumptions: ideal components, unity power factor, steady-state operation. The problem is scientifically sound, well-posed, objective, and contains sufficient information for a unique solution under the interpretation that \"low-line peak\" refers to the peak of the specified sinusoidal input voltage. Thus, the problem is valid.\n\nThe instantaneous input voltage from the line is a sinusoid $v_{\\text{in}}(t) = V_{\\text{pk}} \\sin(\\omega t)$, where the peak voltage $V_{\\text{pk}}$ is related to the RMS voltage by $V_{\\text{pk}} = \\sqrt{2} V_{\\text{rms}}$. The PFC circuit's input is the rectified line voltage, $v_g(t) = |v_{\\text{in}}(t)| = V_{\\text{pk}} |\\sin(\\omega t)|$.\n\nDue to the unity power factor requirement, the average input current (which is the average inductor current, $i_{L, \\text{avg}}(t)$) is in phase with and proportional to the rectified input voltage $v_g(t)$. We can write $i_{L, \\text{avg}}(t) = I_{\\text{pk}} |\\sin(\\omega t)|$, where $I_{\\text{pk}}$ is the peak of the average inductor current envelope.\n\nAssuming an ideal converter (100% efficiency), the average input power $P_{\\text{in}}$ equals the output power $P_{\\text{out}}$. The average input power is the product of the RMS input voltage and RMS input current, $P_{\\text{in}} = V_{\\text{rms}} I_{\\text{rms}}$. The peak input current $I_{\\text{pk}}$ is related to the RMS current by $I_{\\text{pk}} = \\sqrt{2} I_{\\text{rms}}$. We can express $I_{\\text{pk}}$ in terms of the output power and peak voltage:\n$P_{\\text{out}} = P_{\\text{in}} = V_{\\text{rms}} I_{\\text{rms}} = \\frac{V_{\\text{pk}}}{\\sqrt{2}} \\frac{I_{\\text{pk}}}{\\sqrt{2}} = \\frac{V_{\\text{pk}} I_{\\text{pk}}}{2}$.\nSolving for $I_{\\text{pk}}$:\n$$I_{\\text{pk}} = \\frac{2 P_{\\text{out}}}{V_{\\text{pk}}}$$\n\nFor a boost converter operating in CCM, the steady-state voltage conversion ratio over a switching cycle is given by $\\frac{V_{\\text{out}}}{v_g(t)} = \\frac{1}{1 - d(t)}$, where $d(t)$ is the duty cycle of the main switch. This relationship stems directly from the volt-second balance principle on the inductor over one switching period $T_s = 1/f_s$. The duty cycle must vary over the AC line cycle to maintain a constant $V_{\\text{out}}$:\n$$d(t) = 1 - \\frac{v_g(t)}{V_{\\text{out}}}$$\n\nThe peak-to-peak inductor current ripple, $\\Delta i_{L}(t)$, is determined by the inductor voltage and the duration for which it is applied. Using the fundamental inductor law $v_{L} = L \\frac{di_{L}}{dt}$, we can approximate the change in current, $\\Delta i_{L}$, as $\\frac{v_L \\Delta t}{L}$. When the switch is on (for a duration $\\Delta t = d(t) T_s$), the voltage across the inductor is $v_L = v_g(t)$. The current ramps up, and the peak-to-peak ripple is equal to this rise in current:\n$$\\Delta i_{L}(t) = \\frac{v_g(t) d(t) T_s}{L}$$\nSubstituting the expression for $d(t)$:\n$$\\Delta i_{L}(t) = \\frac{v_g(t) T_s}{L} \\left(1 - \\frac{v_g(t)}{V_{\\text{out}}}\\right)$$\nThis equation shows that the ripple magnitude $\\Delta i_{L}(t)$ varies throughout the AC line half-cycle as $v_g(t)$ changes.\n\nThe problem requires us to evaluate the ripple criterion at the \"low-line peak,\" which is the instant when the rectified voltage $v_g(t)$ is at its maximum value, $V_{\\text{pk}}$. At this point:\n$v_g = V_{\\text{pk}} = \\sqrt{2} V_{\\text{rms}}$\n$i_{L, \\text{avg}} = I_{\\text{pk}}$\nThe inductor current ripple at this instant, $\\Delta i_{L, \\text{pk}}$, is:\n$$\\Delta i_{L, \\text{pk}} = \\frac{V_{\\text{pk}} T_s}{L} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n\nThe ripple criterion is $\\frac{\\Delta i_{L}}{I_{L,\\text{avg}}} \\leq 0.10$. At the specified point, this becomes $\\frac{\\Delta i_{L, \\text{pk}}}{I_{\\text{pk}}} \\leq 0.10$. To find the minimum inductance $L$ that satisfies this, we use the equality:\n$$\\frac{\\Delta i_{L, \\text{pk}}}{I_{\\text{pk}}} = 0.10$$\nSubstituting the expressions for $\\Delta i_{L, \\text{pk}}$ and $I_{\\text{pk}}$:\n$$\\frac{\\frac{V_{\\text{pk}} T_s}{L} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)}{\\frac{2 P_{\\text{out}}}{V_{\\text{pk}}}} = 0.10$$\nSolving for $L$:\n$$L = \\frac{V_{\\text{pk}}^2 T_s}{0.10 \\times 2 P_{\\text{out}}} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n$$L = \\frac{V_{\\text{pk}}^2}{0.2 \\cdot P_{\\text{out}} \\cdot f_s} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n\nNow, we substitute the given numerical values:\n$V_{\\text{rms}} = 230 \\, \\text{V}$\n$V_{\\text{out}} = 400 \\, \\text{V}$\n$P_{\\text{out}} = 1000 \\, \\text{W}$\n$f_s = 100000 \\, \\text{Hz}$\n\nFirst, calculate the peak input voltage $V_{\\text{pk}}$:\n$$V_{\\text{pk}} = \\sqrt{2} \\times 230 \\, \\text{V} \\approx 325.269 \\, \\text{V}$$\nThe square of the peak voltage is:\n$$V_{\\text{pk}}^2 = (\\sqrt{2} \\times 230)^2 = 2 \\times 230^2 = 105800 \\, \\text{V}^2$$\n\nNow, substitute all values into the expression for $L$:\n$$L = \\frac{105800}{0.2 \\times 1000 \\times 100000} \\left(1 - \\frac{\\sqrt{2} \\times 230}{400}\\right)$$\n$$L = \\frac{105800}{2 \\times 10^7} \\left(1 - \\frac{325.269...}{400}\\right)$$\n$$L = 5.29 \\times 10^{-3} \\left(1 - 0.81317...\\right)$$\n$$L = 5.29 \\times 10^{-3} \\left(0.186827...\\right)$$\n$$L \\approx 0.000988316 \\, \\text{H}$$\n\nThe problem requires the answer in millihenries (mH), so we multiply by $1000$:\n$$L \\approx 0.988316 \\, \\text{mH}$$\nRounding to four significant figures gives:\n$$L \\approx 0.9883 \\, \\text{mH}$$",
            "answer": "$$\\boxed{0.9883}$$"
        },
        {
            "introduction": "Beyond component selection, a robust PFC design must account for real-world control challenges. A significant challenge occurs near the AC line's zero-crossings, where low input voltage makes it difficult to maintain the desired sinusoidal current shape while staying in continuous conduction mode (CCM). This practice  delves into this issue, requiring the calculation of a minimum current command to prevent a transition into discontinuous mode and prompting an analysis of the crucial design trade-off between operational stability and input current quality, measured by Total Harmonic Distortion (THD).",
            "id": "3829466",
            "problem": "A single-phase continuous-conduction-mode (CCM) boost Power Factor Correction (PFC) rectifier employing average current control is supplied by a sinusoidal input voltage $v_{\\text{in}}(t) = V_{\\text{m}}\\sin(\\omega t)$ and regulates a direct-current (DC) bus at $V_{\\text{o}}$. The inner average current loop commands an input current $i_{\\text{cmd}}(t)$ to shape the input current proportional to the instantaneous input voltage when possible. Near the zero crossing, extremely small $v_{\\text{in}}$ can cause the inductor current to approach zero within a switching cycle due to current ripple, risking transition to discontinuous conduction mode (DCM).\n\nStarting from the inductor voltage law $v_{L} = L\\,\\frac{di_{L}}{dt}$ and the steady-state periodicity of the triangular inductor current ripple in a boost converter, use first principles to derive the instantaneous minimum average current command $i_{\\text{cmd,min}}$ at an input voltage $v_{\\text{in}} = V_{\\epsilon}$ that guarantees CCM, i.e., the inductor valley current remains strictly positive at that instant.\n\nAssume ideal components, steady-state at the instant of interest, and that the duty ratio $D$ is determined by the requirement of zero average inductor voltage over one switching period in CCM. The following parameters are given:\n- Inductance $L = 600\\,\\mu\\text{H}$,\n- Switching frequency $f_{s} = 100\\,\\text{kHz}$,\n- Output bus voltage $V_{\\text{o}} = 400\\,\\text{V}$,\n- Instantaneous input voltage near zero crossing $V_{\\epsilon} = 10\\,\\text{V}$.\n\nCompute the numerical value of $i_{\\text{cmd,min}}$ at $v_{\\text{in}} = V_{\\epsilon}$ that guarantees CCM at that instant. Express the final answer in amperes and round your answer to four significant figures.\n\nAdditionally, briefly explain the design trade-off between enforcing a nonzero $i_{\\text{cmd,min}}$ near zero crossing to maintain CCM and the resulting impact on Total Harmonic Distortion (THD), defined as Total Harmonic Distortion (THD) $= \\sqrt{\\sum_{n\\geq 2} I_{n}^{2}}/I_{1}$, where $I_{n}$ is the root-mean-square value of the $n$-th harmonic of the input current and $I_{1}$ is the root-mean-square value of the fundamental. Do not compute THD numerically; provide a qualitative assessment tied to the derived expression.",
            "solution": "The problem requires the derivation of the minimum average inductor current, $i_{\\text{cmd,min}}$, necessary to ensure continuous conduction mode (CCM) operation for a boost PFC rectifier at a specific low instantaneous input voltage, $V_{\\epsilon}$. Subsequently, a numerical value must be computed, followed by a qualitative discussion of the trade-off involving Total Harmonic Distortion (THD).\n\nThe analysis begins from first principles. For a boost converter operating in CCM, the inductor current $i_L(t)$ consists of an average component, $i_{L,avg}$, and a triangular ripple, $\\Delta i_L$. The instantaneous inductor current at its lowest point during a switching cycle is the valley current, $i_{L,valley}$. It is given by:\n$$i_{L,valley} = i_{L,avg} - \\frac{\\Delta i_L}{2}$$\nThe condition for maintaining CCM is that the inductor current must never fall to zero. Therefore, the valley current must be strictly positive:\n$$i_{L,valley} > 0$$\nSubstituting the expression for the valley current, we get:\n$$i_{L,avg} - \\frac{\\Delta i_L}{2} > 0 \\implies i_{L,avg} > \\frac{\\Delta i_L}{2}$$\nThe minimum average current command, $i_{\\text{cmd,min}}$, corresponds to the boundary condition where the valley current is exactly zero, which is the verge of discontinuous conduction mode (DCM). Thus, we analyze the case for the minimum required current as:\n$$i_{\\text{cmd,min}} = i_{L,avg,min} = \\frac{\\Delta i_L}{2}$$\nTo find $i_{\\text{cmd,min}}$, we must first derive the peak-to-peak inductor current ripple, $\\Delta i_L$. The ripple depends on the operating point, defined by the instantaneous input voltage $v_{\\text{in}}$, the output voltage $V_{\\text{o}}$, the inductance $L$, and the switching frequency $f_s$. The analysis is performed at the instant when $v_{\\text{in}} = V_{\\epsilon}$. We assume that over a single high-frequency switching period $T_s = 1/f_s$, both $v_{\\text{in}}$ and the duty cycle $D$ are constant.\n\nIn steady-state CCM, the average voltage across the inductor over one switching period $T_s$ must be zero. Let $D$ be the duty cycle of the main switch.\n1. When the switch is ON (for a duration $D T_s$), the inductor voltage is $v_L = v_{\\text{in}}$.\n2. When the switch is OFF (for a duration $(1-D) T_s$), the inductor voltage is $v_L = v_{\\text{in}} - V_{\\text{o}}$.\n\nThe volt-second balance equation is:\n$$D \\cdot v_{\\text{in}} + (1-D) \\cdot (v_{\\text{in}} - V_{\\text{o}}) = 0$$\nSolving for the duty cycle $D$:\n$$D v_{\\text{in}} + v_{\\text{in}} - D v_{\\text{in}} - V_{\\text{o}} + D V_{\\text{o}} = 0$$\n$$v_{\\text{in}} - V_{\\text{o}} + D V_{\\text{o}} = 0$$\n$$D = \\frac{V_{\\text{o}} - v_{\\text{in}}}{V_{\\text{o}}} = 1 - \\frac{v_{\\text{in}}}{V_{\\text{o}}}$$\nThe inductor current ripple $\\Delta i_L$ is the change in inductor current during the switch-ON interval. Using the inductor voltage law $v_L = L \\frac{di_L}{dt}$:\n$$\\Delta i_L = \\frac{1}{L} \\int_{0}^{D T_s} v_L(t) \\, dt$$\nSince $v_L = v_{\\text{in}}$ is constant during this interval:\n$$\\Delta i_L = \\frac{v_{\\text{in}} (D T_s)}{L}$$\nSubstituting the expression for $D$ and using $T_s = 1/f_s$:\n$$\\Delta i_L = \\frac{v_{\\text{in}}}{L f_s} \\left(1 - \\frac{v_{\\text{in}}}{V_{\\text{o}}}\\right)$$\nNow we can find the minimum required average current, $i_{\\text{cmd,min}}$, at the specific operating point $v_{\\text{in}} = V_{\\epsilon}$:\n$$i_{\\text{cmd,min}} = \\frac{\\Delta i_L}{2} = \\frac{V_{\\epsilon}}{2 L f_s} \\left(1 - \\frac{V_{\\epsilon}}{V_{\\text{o}}}\\right)$$\nWe are given the following numerical values:\n- Inductance $L = 600\\,\\mu\\text{H} = 600 \\times 10^{-6}\\,\\text{H}$\n- Switching frequency $f_s = 100\\,\\text{kHz} = 100 \\times 10^{3}\\,\\text{Hz}$\n- Output bus voltage $V_{\\text{o}} = 400\\,\\text{V}$\n- Instantaneous input voltage $V_{\\epsilon} = 10\\,\\text{V}$\n\nSubstituting these values into the derived expression:\n$$i_{\\text{cmd,min}} = \\frac{10\\,\\text{V}}{2 \\cdot (600 \\times 10^{-6}\\,\\text{H}) \\cdot (100 \\times 10^{3}\\,\\text{Hz})} \\left(1 - \\frac{10\\,\\text{V}}{400\\,\\text{V}}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{2 \\cdot (6 \\times 10^{-4}) \\cdot (1 \\times 10^{5})} \\left(1 - \\frac{1}{40}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{12 \\times 10^{1}} \\left(\\frac{39}{40}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{120} \\cdot \\frac{39}{40} = \\frac{1}{12} \\cdot \\frac{39}{40} = \\frac{39}{480}\\,\\text{A}$$\n$$i_{\\text{cmd,min}} = \\frac{13}{160}\\,\\text{A} = 0.08125\\,\\text{A}$$\nThe numerical value, rounded to four significant figures, is $0.08125\\,\\text{A}$.\n\nRegarding the design trade-off, an ideal PFC rectifier draws an input current, $i_{\\text{in}}(t)$, that is perfectly sinusoidal and in phase with the input voltage, $v_{\\text{in}}(t)$, resulting in a theoretical Total Harmonic Distortion (THD) of zero. The commanded current would be $i_{\\text{cmd}}(t) \\propto |\\sin(\\omega t)|$. However, to guarantee CCM operation, especially near the AC line voltage zero-crossings where $v_{\\text{in}}$ is very small, a minimum current command $i_{\\text{cmd,min}}$ is enforced. The actual commanded current becomes $i_{\\text{cmd}}(t) = \\text{max}(k|\\sin(\\omega t)|, i_{\\text{cmd,min}})$, where $k$ is a scaling factor.\n\nThis practice, often called \"current clamping\" or setting a \"current floor,\" distorts the input current waveform. Instead of following the sinusoidal shape down to zero, the current waveform flattens out at the value $i_{\\text{cmd,min}}$ for a portion of the AC cycle near the zero-crossings. According to Fourier analysis, any deviation from a pure sinusoid introduces harmonic components. The flattened segments in the current waveform introduce odd harmonics (3rd, 5th, 7th, etc.) into the input current's frequency spectrum.\n\nThe THD is defined as THD $= \\frac{\\sqrt{\\sum_{n\\geq 2} I_{n}^{2}}}{I_{1}}$, where $I_n$ is the RMS value of the n-th harmonic. The introduction of these higher-order harmonics makes the numerator of the THD expression non-zero, thus increasing the THD of the input current. A larger value of $i_{\\text{cmd,min}}$ provides a wider margin for maintaining CCM against variations in parameters or load, but it also prolongs the duration of the current clamp, leading to more significant waveform distortion and a higher THD. The design trade-off is therefore between the robustness and simplicity of operating in CCM (the benefit of a non-zero $i_{\\text{cmd,min}}$) and the need to meet power quality standards that limit input current harmonics (the drawback of increased THD).",
            "answer": "$$\\boxed{0.08125}$$"
        },
        {
            "introduction": "While analytical models are essential for initial design, computational simulation is an indispensable tool for verifying system-level performance and understanding the interplay of various non-idealities. This final practice  transitions from paper-based calculations to hands-on programming, a vital skill for the modern power electronics engineer. By simulating a PFC system's input current, including control loop dynamics and harmonic distortion, you will compute and validate key performance metrics like Power Factor (PF) and Total Harmonic Distortion (THD) against typical industry targets.",
            "id": "3829551",
            "problem": "You are to write a complete, runnable program that simulates the input voltage and current of a single-phase, continuous-conduction boost Power Factor Correction (PFC) stage under average current control, computes the Power Factor (PF) and Total Harmonic Distortion (THD) of the input current from the simulated waveforms using first principles, compares these values against targets, and aggregates pass/fail outcomes across a specified test suite.\n\nStart from the following fundamental base:\n- Instantaneous power is defined by $p(t)=v(t)\\,i(t)$.\n- Root-mean-square (RMS) value over one period $T$ is $x_{\\mathrm{rms}}=\\sqrt{\\frac{1}{T}\\int_{0}^{T} x^{2}(t)\\,dt}$.\n- The real (active) power is $P=\\frac{1}{T}\\int_{0}^{T} v(t)\\,i(t)\\,dt$.\n- Power Factor is $PF=\\dfrac{P}{V_{\\mathrm{rms}}\\,I_{\\mathrm{rms}}}$.\n- For a periodic current $i(t)$ with fundamental angular frequency $\\omega$, define the fundamental component $i_{1}(t)$ and higher-order harmonics $i_{h}(t)$ with $h\\ge 2$. The Total Harmonic Distortion (THD) of current is $THD=\\dfrac{\\sqrt{\\sum_{h=2}^{\\infty} I_{h,\\mathrm{rms}}^{2}}}{I_{1,\\mathrm{rms}}}$, where $I_{h,\\mathrm{rms}}$ is the RMS of the $h$-th harmonic and $I_{1,\\mathrm{rms}}$ is the RMS of the fundamental.\n\nModel assumptions for the PFC stage in continuous conduction with average current control:\n- The input voltage is $v_{g}(t)=V_{m}\\sin(\\omega t)$ with $V_{m}=\\sqrt{2}\\,V_{\\mathrm{rms}}$ and $\\omega=2\\pi f_{\\ell}$.\n- The reference input current for drawing average output power $P_{\\mathrm{out}}$ at near-unity power factor is $i_{\\mathrm{ref}}(t)=I_{1,\\mathrm{ref}}\\sin(\\omega t)$, with $I_{1,\\mathrm{ref}}=\\dfrac{2P_{\\mathrm{out}}}{V_{m}}$ so that the fundamental component of the real power equals $P_{\\mathrm{out}}$ in the ideal, unity-power-factor case.\n- The average current loop dynamics are modeled as a first-order linear time-invariant tracking of $i_{\\mathrm{ref}}(t)$:\n$$\\frac{d}{dt} i_{f}(t)=\\omega_{c}\\bigl(i_{\\mathrm{ref}}(t)-i_{f}(t)\\bigr),$$\nwhere $i_{f}(t)$ is the tracked current and $\\omega_{c}=2\\pi f_{c}$ is the current-loop bandwidth in radians per second.\n- Non-idealities introduce a controlled odd harmonic distortion, modeled here as a third harmonic component added to the tracked current:\n$$i_{3}(t)=I_{3}\\sin(3\\omega t+\\phi_{3}),\\quad I_{3}=\\alpha_{3}\\,I_{1,\\mathrm{track}},$$\nwith $I_{1,\\mathrm{track}}$ defined as the steady-state fundamental amplitude of $i_{f}(t)$ relative to $i_{\\mathrm{ref}}(t)$ under the single-pole tracking model $I_{1,\\mathrm{track}}=\\dfrac{I_{1,\\mathrm{ref}}}{\\sqrt{1+\\left(\\frac{\\omega}{\\omega_{c}}\\right)^{2}}}$, distortion fraction $\\alpha_{3}\\in[0,1)$, and phase $\\phi_{3}$ specified in radians. The simulated input current is $i_{g}(t)=i_{f}(t)+i_{3}(t)$.\n\nDiscrete-time computation requirements:\n- Simulate exactly an integer number of line cycles to avoid leakage in discrete Fourier analysis. Use uniform sampling with sampling frequency $f_{s}$, sample time $\\Delta t=\\dfrac{1}{f_{s}}$, and a total of $N=\\dfrac{f_{s}}{f_{\\ell}}\\,N_{\\mathrm{cyc}}$ samples corresponding to $N_{\\mathrm{cyc}}$ cycles, where $N$ must be an integer.\n- Implement the first-order current loop by the exact discretization of the linear differential equation under zero-order hold:\n$$i_{f}[n]=\\left(1-e^{-\\omega_{c}\\Delta t}\\right)\\,i_{\\mathrm{ref}}[n]+e^{-\\omega_{c}\\Delta t}\\,i_{f}[n-1],\\quad i_{f}[0]=0.$$\n- Compute $V_{\\mathrm{rms}}$, $I_{\\mathrm{rms}}$, and $P$ from the simulated discrete waveforms by replacing integrals with finite averages over the $N$ samples.\n- Compute $THD$ from a discrete Fourier transform by identifying the fundamental bin at frequency $f_{\\ell}$ and harmonics at integer multiples $h f_{\\ell}$, $h=2,\\dots,H$, for a suitably chosen upper harmonic index $H$. Use the standard relationship between discrete Fourier transform magnitudes, sinusoidal amplitude, and RMS values for each harmonic to evaluate the numerator and denominator of the $THD$ definition.\n\nProgram targets and output specification:\n- Targets: $PF\\ge 0.99$ and $THD\\le 0.05$ (note: $THD$ must be expressed as a decimal, not as a percentage).\n- For each test, your program must output a list of three items: the computed $PF$ rounded to six decimal places (dimensionless), the computed $THD$ rounded to six decimal places (dimensionless), and a boolean indicating whether both targets are simultaneously met.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test suite below, where each element is the triple for a test case. For example, a valid structure is $[\\,[0.999000,0.040000,\\mathrm{True}],[\\dots]\\,]$.\n\nTest suite (use these exact parameters):\n- Global parameters (apply to all tests): $V_{\\mathrm{rms}}=230\\,\\mathrm{V}$, $f_{\\ell}=50\\,\\mathrm{Hz}$, $P_{\\mathrm{out}}=1000\\,\\mathrm{W}$, $f_{s}=100000\\,\\mathrm{Hz}$, $N_{\\mathrm{cyc}}=40$, third-harmonic analysis upper index $H=25$, third-harmonic phase unit in radians.\n- Test $1$ (happy path): $f_{c}=2000\\,\\mathrm{Hz}$, $\\alpha_{3}=0.01$, $\\phi_{3}=0$.\n- Test $2$ (PF-limited case): $f_{c}=300\\,\\mathrm{Hz}$, $\\alpha_{3}=0.005$, $\\phi_{3}=0$.\n- Test $3$ (THD-limited case): $f_{c}=2000\\,\\mathrm{Hz}$, $\\alpha_{3}=0.08$, $\\phi_{3}=\\dfrac{\\pi}{6}$.\n- Test $4$ (both PF and THD stressed): $f_{c}=100\\,\\mathrm{Hz}$, $\\alpha_{3}=0.06$, $\\phi_{3}=\\dfrac{\\pi}{3}$.\n\nAngle unit requirement: all angles are specified and must be interpreted in radians.\n\nUnit requirements:\n- Voltages in $\\mathrm{V}$, frequencies in $\\mathrm{Hz}$, power in $\\mathrm{W}$, current in $\\mathrm{A}$, angles in radians. The PF and THD are dimensionless and must be expressed as decimals in the output.\n\nYour program must:\n- Simulate the waveforms per the model and parameters above.\n- Compute $PF$ and $THD$ from the simulated discrete waveforms per the definitions above.\n- Compare to the targets $PF\\ge 0.99$ and $THD\\le 0.05$.\n- Output a single line that is a list of the four per-test triples $[PF,THD,\\mathrm{boolean}]$ in the same order as the test suite, with $PF$ and $THD$ rounded to six decimal places.",
            "solution": "The user has provided a problem that requires the simulation and analysis of a single-phase boost Power Factor Correction (PFC) stage. The first step is to validate the problem statement.\n\n### Step 1: Extract Givens\n\n-   **Fundamental Definitions**:\n    -   Instantaneous power: $p(t)=v(t)\\,i(t)$.\n    -   Root-mean-square (RMS): $x_{\\mathrm{rms}}=\\sqrt{\\frac{1}{T}\\int_{0}^{T} x^{2}(t)\\,dt}$.\n    -   Real (active) power: $P=\\frac{1}{T}\\int_{0}^{T} v(t)\\,i(t)\\,dt$.\n    -   Power Factor: $PF=\\dfrac{P}{V_{\\mathrm{rms}}\\,I_{\\mathrm{rms}}}$.\n    -   Total Harmonic Distortion (THD) of current: $THD=\\dfrac{\\sqrt{\\sum_{h=2}^{\\infty} I_{h,\\mathrm{rms}}^{2}}}{I_{1,\\mathrm{rms}}}$.\n\n-   **Model Assumptions**:\n    -   Input voltage: $v_{g}(t)=V_{m}\\sin(\\omega t)$, with $V_{m}=\\sqrt{2}\\,V_{\\mathrm{rms}}$ and $\\omega=2\\pi f_{\\ell}$.\n    -   Reference current: $i_{\\mathrm{ref}}(t)=I_{1,\\mathrm{ref}}\\sin(\\omega t)$, with $I_{1,\\mathrm{ref}}=\\dfrac{2P_{\\mathrm{out}}}{V_{m}}$.\n    -   Current loop dynamics: $\\frac{d}{dt} i_{f}(t)=\\omega_{c}\\bigl(i_{\\mathrm{ref}}(t)-i_{f}(t)\\bigr)$, where $\\omega_{c}=2\\pi f_{c}$.\n    -   Harmonic distortion model: $i_{3}(t)=I_{3}\\sin(3\\omega t+\\phi_{3})$, with $I_{3}=\\alpha_{3}\\,I_{1,\\mathrm{track}}$.\n    -   Tracked fundamental amplitude: $I_{1,\\mathrm{track}}=\\dfrac{I_{1,\\mathrm{ref}}}{\\sqrt{1+\\left(\\frac{\\omega}{\\omega_{c}}\\right)^{2}}}$.\n    -   Simulated input current: $i_{g}(t)=i_{f}(t)+i_{3}(t)$.\n\n-   **Discrete-time Computation**:\n    -   Simulation over $N_{\\mathrm{cyc}}$ cycles.\n    -   Sampling frequency $f_{s}$, sample time $\\Delta t=1/f_{s}$.\n    -   Total samples: $N=\\dfrac{f_{s}}{f_{\\ell}}\\,N_{\\mathrm{cyc}}$ (must be an integer).\n    -   Discrete filter implementation: $i_{f}[n]=\\left(1-e^{-\\omega_{c}\\Delta t}\\right)\\,i_{\\mathrm{ref}}[n]+e^{-\\omega_{c}\\Delta t}\\,i_{f}[n-1]$ with $i_{f}[0]=0$.\n    -   Discrete metrics: integrals replaced by averages over $N$ samples.\n    -   THD calculation via DFT up to harmonic index $H$.\n\n-   **Targets and Output**:\n    -   Targets: $PF\\ge 0.99$, $THD\\le 0.05$.\n    -   Output Format: A list of triples $[PF, THD, \\text{boolean}]$, each rounded to six decimal places, for each test. The final output is a single-line string representation of a list of these lists.\n\n-   **Test Suite**:\n    -   Global parameters: $V_{\\mathrm{rms}}=230\\,\\mathrm{V}$, $f_{\\ell}=50\\,\\mathrm{Hz}$, $P_{\\mathrm{out}}=1000\\,\\mathrm{W}$, $f_{s}=100000\\,\\mathrm{Hz}$, $N_{\\mathrm{cyc}}=40$, $H=25$.\n    -   Test 1: $f_{c}=2000\\,\\mathrm{Hz}$, $\\alpha_{3}=0.01$, $\\phi_{3}=0$.\n    -   Test 2: $f_{c}=300\\,\\mathrm{Hz}$, $\\alpha_{3}=0.005$, $\\phi_{3}=0$.\n    -   Test 3: $f_{c}=2000\\,\\mathrm{Hz}$, $\\alpha_{3}=0.08$, $\\phi_{3}=\\pi/6$.\n    -   Test 4: $f_{c}=100\\,\\mathrm{Hz}$, $\\alpha_{3}=0.06$, $\\phi_{3}=\\pi/3$.\n\n### Step 2: Validate Using Extracted Givens\n\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically sound. The definitions for power, PF, and THD are standard in electrical engineering. The modeling of the PFC stage, including the first-order approximation of the current loop and the simplified distortion model, are valid and common simplifications used in power electronics analysis. The discretization method for the filter is the exact solution for a zero-order hold input, a correct technique in digital control.\n\n2.  **Non-Formalizable or Irrelevant**: The problem is highly relevant to power electronics design and is specified with sufficient mathematical rigor to be formalized into a simulation program.\n\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. All required parameters are provided for the simulation and analysis. The number of samples $N = \\frac{f_s}{f_\\ell}N_{cyc} = \\frac{100000}{50} \\times 40 = 80000$ is an integer, satisfying the constraint. The highest harmonic frequency being analyzed is $H \\times f_\\ell = 25 \\times 50\\,\\mathrm{Hz} = 1250\\,\\mathrm{Hz}$, which is well below the Nyquist frequency of $f_s/2 = 50\\,\\mathrm{kHz}$, preventing aliasing issues in the THD calculation.\n\n4.  **Unrealistic or Infeasible**: The parameters are realistic. $230\\,\\mathrm{V}$ / $50\\,\\mathrm{Hz}$ is a standard main supply, $1000\\,\\mathrm{W}$ is a typical power level, and the specified sampling and control frequencies are within the normal range for modern digital power control.\n\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed. The simulation is based on a stable linear system with a defined initial condition, guaranteeing a unique solution. The analysis steps are deterministic.\n\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem requires a non-trivial implementation of simulation and signal processing, combining concepts from control theory, signal analysis, and power electronics. It is a substantive engineering problem.\n\n7.  **Outside Scientific Verifiability**: The results can be verified by independent simulation and analytical approximation.\n\n### Step 3: Verdict and Action\n\nThe problem is deemed **valid**. A solution will be provided.\n\n### Principle-Based Design\n\nThe solution will be developed by following the model and computational requirements specified in the problem statement. The core of the solution is a numerical simulation followed by a performance analysis based on fundamental electrical engineering principles.\n\n1.  **Parameter Calculation**: We begin by calculating derived constants from the given parameters. This includes the peak voltage $V_m$, line angular frequency $\\omega$, sampling period $\\Delta t$, total number of samples $N$, and the current loop bandwidth in rad/s, $\\omega_c$.\n\n2.  **Waveform Generation**: The simulation requires time-domain waveforms for the input voltage and the reference current.\n    -   A discrete time vector $t[n] = n\\Delta t$ for $n=0, 1, \\dots, N-1$ is created.\n    -   The input voltage is $v_g[n] = V_m \\sin(\\omega t[n])$.\n    -   The reference current peak amplitude is calculated as $I_{1,\\mathrm{ref}} = 2P_{\\mathrm{out}}/V_m$. This ensures that if the input current were perfectly sinusoidal and in phase with the voltage, the average input power would equal the target output power $P_{\\mathrm{out}}$.\n    -   The reference current waveform is then $i_{\\mathrm{ref}}[n] = I_{1,\\mathrm{ref}} \\sin(\\omega t[n])$.\n\n3.  **Current Loop Simulation**: The average current controller's behavior is modeled as a first-order low-pass filter. The continuous-time differential equation is provided, along with its exact discrete-time equivalent for a zero-order hold.\n    -   The equation is $i_{f}[n]= c_1 i_{\\mathrm{ref}}[n] + c_2 i_{f}[n-1]$, where $c_1 = 1-e^{-\\omega_{c}\\Delta t}$ and $c_2=e^{-\\omega_{c}\\Delta t}$. This is a first-order Infinite Impulse Response (IIR) filter.\n    -   We implement this filter using `scipy.signal.lfilter`, which is computationally efficient for this task. The filter coefficients are `b=[c1]` and `a=[1, -c2]`. The simulation starts from rest, corresponding to the specified initial condition $i_f[0]=0$, which is the default for `lfilter`.\n\n4.  **Distortion Modeling**: A third harmonic current component is added to the filtered current to model non-ideal behavior.\n    -   The amplitude of the fundamental component of the tracked current, $I_{1,\\mathrm{track}}$, is first calculated. This accounts for the gain of the low-pass filter at the line frequency $\\omega$.\n    -   The amplitude of the third harmonic, $I_3$, is then determined as a fraction $\\alpha_3$ of $I_{1,\\mathrm{track}}$.\n    -   The third harmonic waveform is $i_3[n] = I_3 \\sin(3\\omega t[n] + \\phi_3)$.\n    -   The total simulated input current is the sum: $i_g[n] = i_f[n] + i_3[n]$.\n\n5.  **Performance Metrics Calculation**: Using the simulated discrete waveforms $v_g[n]$ and $i_g[n]$, we compute the performance metrics.\n    -   **RMS, Power, and PF**: The RMS values $V_{\\mathrm{rms}}$ and $I_{\\mathrm{rms}}$, and the active power $P$, are calculated by taking the mean of the squared values (for RMS) or the product of the signals (for power) over the $N$ samples. The definitions are discrete versions of the standard integral definitions:\n        -   $V_{\\mathrm{rms,sim}} = \\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} v_g[n]^2}$\n        -   $I_{\\mathrm{rms,sim}} = \\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} i_g[n]^2}$\n        -   $P_{\\mathrm{sim}} = \\frac{1}{N}\\sum_{n=0}^{N-1} v_g[n]i_g[n]$\n        -   The Power Factor is computed as $PF = \\frac{P_{\\mathrm{sim}}}{V_{\\mathrm{rms,sim}} I_{\\mathrm{rms,sim}}}$.\n    -   **THD**: The Total Harmonic Distortion is calculated using the Discrete Fourier Transform (DFT) of the current waveform $i_g[n]$, obtained via `numpy.fft.fft`.\n        -   The frequency resolution of the DFT is $f_s/N = f_\\ell/N_{cyc}$. The fundamental frequency $f_\\ell$ corresponds to the DFT bin index $k_1 = f_\\ell / (f_s/N) = N_{cyc}$. Harmonics appear at integer multiples of this index, $k_h = h \\cdot N_{cyc}$.\n        -   The RMS value of the $h$-th harmonic is calculated from the magnitude of the DFT coefficient at bin $k_h$, $|I_g[k_h]|$, using the relation $I_{h,\\mathrm{rms}} = \\frac{\\sqrt{2}}{N}|I_g[k_h]|$.\n        -   The THD is then computed using its definition, summing the power of harmonics from $h=2$ to the specified upper limit $H=25$: $THD = \\frac{\\sqrt{\\sum_{h=2}^{H} I_{h,\\mathrm{rms}}^2}}{I_{1,\\mathrm{rms}}}$.\n\n6.  **Target Evaluation and Output Formatting**: Finally, the computed $PF$ and $THD$ are compared against their respective targets. The results for each test case—$PF$ and $THD$ rounded to six decimal places and a boolean indicating success—are formatted into the specified string format. This process is repeated for all test cases in the suite.",
            "answer": "```python\nimport numpy as np\nfrom scipy.signal import lfilter\n\ndef solve():\n    \"\"\"\n    Simulates a single-phase boost PFC stage, computes PF and THD,\n    and evaluates against performance targets for a suite of tests.\n    \"\"\"\n\n    # Global parameters applicable to all test cases\n    V_RMS_g_spec = 230.0    # V, specified RMS input voltage\n    f_l = 50.0              # Hz, line frequency\n    P_out = 1000.0          # W, target average output power\n    f_s = 100000.0          # Hz, sampling frequency\n    N_cyc = 40              # Number of line cycles to simulate\n    H = 25                  # Upper harmonic index for THD calculation\n\n    # Test suite parameters: (fc, alpha3, phi3)\n    test_cases = [\n        (2000.0, 0.01, 0.0),                     # Test 1: Happy path\n        (300.0, 0.005, 0.0),                     # Test 2: PF-limited case\n        (2000.0, 0.08, np.pi / 6.0),             # Test 3: THD-limited case\n        (100.0, 0.06, np.pi / 3.0),              # Test 4: Stressed case\n    ]\n\n    # List to store the results for each test case\n    final_results = []\n\n    for fc, alpha3, phi3 in test_cases:\n        # --- 1. Derived Constants and Simulation Setup ---\n        V_m_g = np.sqrt(2) * V_RMS_g_spec    # V, peak input voltage\n        omega_l = 2 * np.pi * f_l            # rad/s, line angular frequency\n        dt = 1.0 / f_s                       # s, sampling time\n        N = int((f_s / f_l) * N_cyc)         # Total number of samples\n        t = np.arange(N) * dt                # Time vector\n\n        # --- 2. Waveform Generation ---\n        # Input grid voltage waveform\n        v_g = V_m_g * np.sin(omega_l * t)\n\n        # Ideal reference current waveform for unity power factor\n        I_1_ref_peak = (2 * P_out) / V_m_g\n        i_ref = I_1_ref_peak * np.sin(omega_l * t)\n\n        # --- 3. Current Loop Simulation ---\n        # The current loop is modeled as a first-order low-pass filter\n        omega_c = 2 * np.pi * fc  # rad/s, current loop bandwidth\n        \n        # Digital filter coefficients for the exact discretization\n        # i_f[n] = (1-exp(-wc*dt))*i_ref[n] + exp(-wc*dt)*i_f[n-1]\n        # This is an IIR filter with b=[1-exp(-wc*dt)], a=[1, -exp(-wc*dt)]\n        c2 = np.exp(-omega_c * dt)\n        c1 = 1 - c2\n        b = [c1]\n        a = [1, -c2]\n        \n        # Apply the filter to the reference an input to get the tracked current\n        i_f = lfilter(b, a, i_ref)\n\n        # --- 4. Distortion Modeling ---\n        # Calculate the amplitude of the fundamental component of the tracked current\n        filter_gain_at_fl = 1.0 / np.sqrt(1 + (omega_l / omega_c)**2)\n        I_1_track_peak = I_1_ref_peak * filter_gain_at_fl\n\n        # Calculate the amplitude of the injected 3rd harmonic\n        I_3_peak = alpha3 * I_1_track_peak\n        \n        # Generate the 3rd harmonic current waveform\n        i_3 = I_3_peak * np.sin(3 * omega_l * t + phi3)\n\n        # The total simulated input current is the sum of tracked and harmonic currents\n        i_g = i_f + i_3\n\n        # --- 5. Performance Metrics Calculation ---\n        # RMS, Power, and Power Factor (PF)\n        V_rms_sim = np.sqrt(np.mean(v_g**2))\n        I_rms_sim = np.sqrt(np.mean(i_g**2))\n        P_sim = np.mean(v_g * i_g)\n        \n        # Avoid division by zero if current is zero for some reason\n        if V_rms_sim * I_rms_sim == 0:\n            pf = 1.0\n        else:\n            pf = P_sim / (V_rms_sim * I_rms_sim)\n\n        # Total Harmonic Distortion (THD)\n        # Perform FFT on the simulated input current\n        I_g_fft = np.fft.fft(i_g)\n        \n        # The fundamental frequency bin is at index N_cyc\n        k1_idx = N_cyc\n        \n        # RMS of the fundamental component\n        I1_rms = np.sqrt(2) * np.abs(I_g_fft[k1_idx]) / N\n\n        # Sum of squares of RMS values for harmonics h=2 to H\n        sum_harm_rms_sq = 0.0\n        for h in range(2, H + 1):\n            kh_idx = h * k1_idx\n            # Ensure the harmonic index is within the valid FFT range\n            if kh_idx < N / 2:\n                Ih_rms = np.sqrt(2) * np.abs(I_g_fft[kh_idx]) / N\n                sum_harm_rms_sq += Ih_rms**2\n        \n        # Calculate THD\n        if I1_rms == 0:\n            thd = 0.0\n        else:\n            thd = np.sqrt(sum_harm_rms_sq) / I1_rms\n\n        # --- 6. Target Evaluation ---\n        pf_target = 0.99\n        thd_target = 0.05\n        passed = (pf >= pf_target) and (thd <= thd_target)\n        \n        # Store the results for this case\n        final_results.append([pf, thd, passed])\n\n    # --- Final Output Formatting ---\n    # Create a list of formatted strings for each result triple\n    output_strings = []\n    for res in final_results:\n        pf_val, thd_val, pass_val = res\n        # Format: [pf (6 dec),thd (6 dec),Boolean] with no spaces\n        output_strings.append(f\"[{pf_val:.6f},{thd_val:.6f},{pass_val}]\")\n\n    # Combine the strings into a single line, as a list of lists.\n    # The format \"[{','.join(...)}}]\" matches the Python code template in the problem spec.\n    print(f\"[{','.join(output_strings)}]\")\n\nsolve()\n```"
        }
    ]
}