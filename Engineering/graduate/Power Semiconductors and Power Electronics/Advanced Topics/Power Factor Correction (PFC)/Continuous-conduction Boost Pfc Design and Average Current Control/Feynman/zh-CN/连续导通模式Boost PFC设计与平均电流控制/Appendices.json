{
    "hands_on_practices": [
        {
            "introduction": "升压电感是 PFC 电路的核心，其值直接决定了电流纹波。第一个实践聚焦于一个基础设计任务：选择电感值以确保转换器在特定的纹波约束下工作在期望的连续导通模式 (CCM) 。掌握这一计算是设计任何稳健的 PFC 功率级的关键第一步。",
            "id": "3829458",
            "problem": "一个工作在连续导通模式 (CCM) 下并采用平均电流控制的单相升压型功率因数校正 (PFC) 预调节器，由均方根电压为 $V_{\\text{rms}}=230\\,\\text{V}$ 的正弦线路供电，并调节一个直流输出电压至 $V_{\\text{out}}=400\\,\\text{V}$。输出功率为 $P_{\\text{out}}=1000\\,\\text{W}$，开关频率为 $f_{s}=100000\\,\\text{Hz}$。假设元件是理想的（零半导体压降、无损电感和开关、以及可忽略的输入滤波器效应），功率因数为单位值（即输入电流与瞬时输入电压成正比），且工作在稳态。电感电流纹波规格要求，在整流后正弦波的线路电压峰值处，峰峰值电感电流纹波 $\\Delta i_{L}$ 必须满足 $\\Delta i_{L}/I_{L,\\text{avg}}\\leq 0.10$。\n\n仅使用基本定律，即电感定律 $v_{L}=L\\,di_{L}/dt$、一个开关周期内的伏秒平衡、以及正弦量的均方根值和峰值的定义，确定在低压线路峰值处满足纹波标准的最小电感 $L$。将最终的电感值以毫亨 (mH) 为单位表示，并将答案四舍五入至四位有效数字。",
            "solution": "该问题要求计算一个满足特定电感电流纹波标准的连续导通模式 (CCM) 升压型功率因数校正 (PFC) 预调节器的最小电感值 $L$。解题过程将按要求从基本原理推导得出。\n\n首先，提取并验证已知条件。\n输入均方根电压：$V_{\\text{rms}} = 230 \\, \\text{V}$\n输出直流电压：$V_{\\text{out}} = 400 \\, \\text{V}$\n输出功率：$P_{\\text{out}} = 1000 \\, \\text{W}$\n开关频率：$f_{s} = 100000 \\, \\text{Hz}$\n纹波标准：在低压线路峰值处 $\\frac{\\Delta i_{L}}{I_{L,\\text{avg}}} \\leq 0.10$。\n\n假设：理想元件、单位功率因数、稳态运行。该问题在科学上是合理的、提法得当、客观，并且在将“低压线路峰值”解释为指定正弦输入电压的峰值的情况下，包含了获得唯一解的充分信息。因此，该问题是有效的。\n\n来自线路的瞬时输入电压是一个正弦波 $v_{\\text{in}}(t) = V_{\\text{pk}} \\sin(\\omega t)$，其中峰值电压 $V_{\\text{pk}}$ 与均方根电压的关系为 $V_{\\text{pk}} = \\sqrt{2} V_{\\text{rms}}$。PFC 电路的输入是整流后的线路电压 $v_g(t) = |v_{\\text{in}}(t)| = V_{\\text{pk}} |\\sin(\\omega t)|$。\n\n由于单位功率因数的要求，平均输入电流（即平均电感电流 $i_{L, \\text{avg}}(t)$）与整流后的输入电压 $v_g(t)$ 同相且成正比。我们可以写出 $i_{L, \\text{avg}}(t) = I_{\\text{pk}} |\\sin(\\omega t)|$，其中 $I_{\\text{pk}}$ 是平均电感电流包络的峰值。\n\n假设转换器是理想的（效率为100%），则平均输入功率 $P_{\\text{in}}$ 等于输出功率 $P_{\\text{out}}$。平均输入功率是输入均方根电压和输入均方根电流的乘积，即 $P_{\\text{in}} = V_{\\text{rms}} I_{\\text{rms}}$。峰值输入电流 $I_{\\text{pk}}$ 与均方根电流的关系为 $I_{\\text{pk}} = \\sqrt{2} I_{\\text{rms}}$。我们可以用输出功率和峰值电压来表示 $I_{\\text{pk}}$：\n$P_{\\text{out}} = P_{\\text{in}} = V_{\\text{rms}} I_{\\text{rms}} = \\frac{V_{\\text{pk}}}{\\sqrt{2}} \\frac{I_{\\text{pk}}}{\\sqrt{2}} = \\frac{V_{\\text{pk}} I_{\\text{pk}}}{2}$。\n求解 $I_{\\text{pk}}$：\n$$I_{\\text{pk}} = \\frac{2 P_{\\text{out}}}{V_{\\text{pk}}}$$\n\n对于在 CCM 下运行的升压转换器，一个开关周期内的稳态电压转换比由 $\\frac{V_{\\text{out}}}{v_g(t)} = \\frac{1}{1 - d(t)}$ 给出，其中 $d(t)$ 是主开关的占空比。此关系直接源于电感在一个开关周期 $T_s = 1/f_s$ 内的伏秒平衡原理。占空比必须在交流线路周期内变化，以维持恒定的 $V_{\\text{out}}$：\n$$d(t) = 1 - \\frac{v_g(t)}{V_{\\text{out}}}$$\n\n峰峰值电感电流纹波 $\\Delta i_{L}(t)$ 由电感电压及其施加的持续时间决定。使用基本电感定律 $v_{L} = L \\frac{di_{L}}{dt}$，我们可以将电流变化量 $\\Delta i_{L}$ 近似为 $\\frac{v_L \\Delta t}{L}$。当开关闭合时（持续时间为 $\\Delta t = d(t) T_s$），电感两端的电压为 $v_L = v_g(t)$。电流线性上升，峰峰值纹波等于此电流上升量：\n$$\\Delta i_{L}(t) = \\frac{v_g(t) d(t) T_s}{L}$$\n代入 $d(t)$ 的表达式：\n$$\\Delta i_{L}(t) = \\frac{v_g(t) T_s}{L} \\left(1 - \\frac{v_g(t)}{V_{\\text{out}}}\\right)$$\n该方程表明，纹波幅值 $\\Delta i_{L}(t)$ 随着 $v_g(t)$ 的变化在整个交流线路半周期内变化。\n\n问题要求我们在“低压线路峰值”处评估纹波标准，即整流后电压 $v_g(t)$ 达到其最大值 $V_{\\text{pk}}$ 的瞬间。在这一点：\n$v_g = V_{\\text{pk}} = \\sqrt{2} V_{\\text{rms}}$\n$i_{L, \\text{avg}} = I_{\\text{pk}}$\n此时的电感电流纹波 $\\Delta i_{L, \\text{pk}}$ 为：\n$$\\Delta i_{L, \\text{pk}} = \\frac{V_{\\text{pk}} T_s}{L} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n\n纹波标准为 $\\frac{\\Delta i_{L}}{I_{L,\\text{avg}}} \\leq 0.10$。在指定点，这变为 $\\frac{\\Delta i_{L, \\text{pk}}}{I_{\\text{pk}}} \\leq 0.10$。为了找到满足此条件的最小电感 $L$，我们使用等式：\n$$\\frac{\\Delta i_{L, \\text{pk}}}{I_{\\text{pk}}} = 0.10$$\n代入 $\\Delta i_{L, \\text{pk}}$ 和 $I_{\\text{pk}}$ 的表达式：\n$$\\frac{\\frac{V_{\\text{pk}} T_s}{L} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)}{\\frac{2 P_{\\text{out}}}{V_{\\text{pk}}}} = 0.10$$\n求解 $L$：\n$$L = \\frac{V_{\\text{pk}}^2 T_s}{0.10 \\times 2 P_{\\text{out}}} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n$$L = \\frac{V_{\\text{pk}}^2}{0.2 \\cdot P_{\\text{out}} \\cdot f_s} \\left(1 - \\frac{V_{\\text{pk}}}{V_{\\text{out}}}\\right)$$\n\n现在，我们代入给定的数值：\n$V_{\\text{rms}} = 230 \\, \\text{V}$\n$V_{\\text{out}} = 400 \\, \\text{V}$\n$P_{\\text{out}} = 1000 \\, \\text{W}$\n$f_s = 100000 \\, \\text{Hz}$\n\n首先，计算峰值输入电压 $V_{\\text{pk}}$：\n$$V_{\\text{pk}} = \\sqrt{2} \\times 230 \\, \\text{V} \\approx 325.269 \\, \\text{V}$$\n峰值电压的平方为：\n$$V_{\\text{pk}}^2 = (\\sqrt{2} \\times 230)^2 = 2 \\times 230^2 = 105800 \\, \\text{V}^2$$\n\n现在，将所有值代入 $L$ 的表达式中：\n$$L = \\frac{105800}{0.2 \\times 1000 \\times 100000} \\left(1 - \\frac{\\sqrt{2} \\times 230}{400}\\right)$$\n$$L = \\frac{105800}{2 \\times 10^7} \\left(1 - \\frac{325.269...}{400}\\right)$$\n$$L = 5.29 \\times 10^{-3} \\left(1 - 0.81317...\\right)$$\n$$L = 5.29 \\times 10^{-3} \\left(0.186827...\\right)$$\n$$L \\approx 0.000988316 \\, \\text{H}$$\n\n题目要求答案以毫亨 (mH) 为单位，所以我们乘以 $1000$：\n$$L \\approx 0.988316 \\, \\text{mH}$$\n四舍五入到四位有效数字，得到：\n$$L \\approx 0.9883 \\, \\text{mH}$$",
            "answer": "$$\\boxed{0.9883}$$"
        },
        {
            "introduction": "即使选择了合适的电感，交流线路电压过零点附近的运行也对维持 CCM 提出了独特的挑战。本练习探讨了为防止转换器进入不连续模式所需的最小电流，这是一种常见的控制策略 。这迫使我们直面一个关键的设计权衡：运行稳定性与由此产生的输入电流失真之间的矛盾，后者会影响总谐波失真 (THD)。",
            "id": "3829466",
            "problem": "一个采用平均电流控制的单相连续导通模式 (CCM) 升压型功率因数校正 (PFC) 整流器，由正弦输入电压 $v_{\\text{in}}(t) = V_{\\text{m}}\\sin(\\omega t)$ 供电，并将直流 (DC) 母线电压稳定在 $V_{\\text{o}}$。内环平均电流环指令一个输入电流 $i_{\\text{cmd}}(t)$，在可能的情况下，使输入电流波形与瞬时输入电压成正比。在过零点附近，由于电流纹波，极小的 $v_{\\text{in}}$ 可能导致电感电流在一个开关周期内接近零，从而存在转换到非连续导通模式 (DCM) 的风险。\n\n从电感电压定律 $v_{L} = L\\,\\frac{di_{L}}{dt}$ 和升压变换器中三角形电感电流纹波的稳态周期性出发，运用第一性原理推导在输入电压 $v_{\\text{in}} = V_{\\epsilon}$ 时，保证CCM运行所需的瞬时最小平均电流指令 $i_{\\text{cmd,min}}$，即在该瞬时电感谷值电流保持严格为正。\n\n假设元件是理想的，在所关注的瞬时处于稳态，并且占空比 $D$ 由 CCM 下一个开关周期内电感平均电压为零的要求确定。给定以下参数：\n- 电感 $L = 600\\,\\mu\\text{H}$，\n- 开关频率 $f_{s} = 100\\,\\text{kHz}$，\n- 输出母线电压 $V_{\\text{o}} = 400\\,\\text{V}$，\n- 过零点附近的瞬时输入电压 $V_{\\epsilon} = 10\\,\\text{V}$。\n\n计算在 $v_{\\text{in}} = V_{\\epsilon}$ 时保证 CCM 的 $i_{\\text{cmd,min}}$ 的数值。最终答案以安培为单位表示，并四舍五入到四位有效数字。\n\n此外，简要解释在过零点附近为维持CCM而强制执行非零 $i_{\\text{cmd,min}}$ 与由此产生的对总谐波失真 (THD) 的影响之间的设计权衡，其定义为总谐波失真 $\\text{THD} = \\sqrt{\\sum_{n\\geq 2} I_{n}^{2}}/I_{1}$，其中 $I_{n}$ 是输入电流第 $n$ 次谐波的有效值，$I_{1}$ 是基波的有效值。无需数值计算 THD，只需结合推导出的表达式进行定性评估。",
            "solution": "该问题要求推导升压型 PFC 整流器在特定的低瞬时输入电压 $V_{\\epsilon}$下，为确保连续导通模式 (CCM) 运行所必需的最小平均电感电流 $i_{\\text{cmd,min}}$。随后，必须计算其数值，并对涉及总谐波失真 (THD) 的权衡进行定性讨论。\n\n分析从第一性原理开始。对于在 CCM 下运行的升压变换器，电感电流 $i_L(t)$ 由一个平均分量 $i_{L,avg}$ 和一个三角形纹波 $\\Delta i_L$ 组成。在一个开关周期内电感电流的最低点是谷值电流 $i_{L,valley}$。它由下式给出：\n$$i_{L,valley} = i_{L,avg} - \\frac{\\Delta i_L}{2}$$\n维持 CCM 的条件是电感电流绝不能降至零。因此，谷值电流必须严格为正：\n$$i_{L,valley} > 0$$\n代入谷值电流的表达式，我们得到：\n$$i_{L,avg} - \\frac{\\Delta i_L}{2} > 0 \\implies i_{L,avg} > \\frac{\\Delta i_L}{2}$$\n最小平均电流指令 $i_{\\text{cmd,min}}$ 对应于谷值电流恰好为零的边界条件，这是进入非连续导通模式 (DCM) 的临界点。因此，我们将所需最小电流的情况分析为：\n$$i_{\\text{cmd,min}} = i_{L,avg,min} = \\frac{\\Delta i_L}{2}$$\n为了求得 $i_{\\text{cmd,min}}$，我们必须首先推导电感的峰峰值电流纹波 $\\Delta i_L$。该纹波取决于由瞬时输入电压 $v_{\\text{in}}$、输出电压 $V_{\\text{o}}$、电感 $L$ 和开关频率 $f_s$ 定义的工作点。分析在 $v_{\\text{in}} = V_{\\epsilon}$ 的瞬时进行。我们假设在单个高频开关周期 $T_s = 1/f_s$ 内，$v_{\\text{in}}$ 和占空比 $D$ 均保持不变。\n\n在稳态 CCM 下，一个开关周期 $T_s$ 内电感上的平均电压必须为零。设 $D$ 为主开关的占空比。\n1. 当开关闭合时（持续时间为 $D T_s$），电感电压为 $v_L = v_{\\text{in}}$。\n2. 当开关断开时（持续时间为 $(1-D) T_s$），电感电压为 $v_L = v_{\\text{in}} - V_{\\text{o}}$。\n\n伏秒平衡方程为：\n$$D \\cdot v_{\\text{in}} + (1-D) \\cdot (v_{\\text{in}} - V_{\\text{o}}) = 0$$\n求解占空比 $D$：\n$$D v_{\\text{in}} + v_{\\text{in}} - D v_{\\text{in}} - V_{\\text{o}} + D V_{\\text{o}} = 0$$\n$$v_{\\text{in}} - V_{\\text{o}} + D V_{\\text{o}} = 0$$\n$$D = \\frac{V_{\\text{o}} - v_{\\text{in}}}{V_{\\text{o}}} = 1 - \\frac{v_{\\text{in}}}{V_{\\text{o}}}$$\n电感电流纹波 $\\Delta i_L$ 是在开关闭合期间电感电流的变化量。根据电感电压定律 $v_L = L \\frac{di_L}{dt}$：\n$$\\Delta i_L = \\frac{1}{L} \\int_{0}^{D T_s} v_L(t) \\, dt$$\n由于在此期间 $v_L = v_{\\text{in}}$ 是恒定的：\n$$\\Delta i_L = \\frac{v_{\\text{in}} (D T_s)}{L}$$\n代入 $D$ 的表达式并使用 $T_s = 1/f_s$：\n$$\\Delta i_L = \\frac{v_{\\text{in}}}{L f_s} \\left(1 - \\frac{v_{\\text{in}}}{V_{\\text{o}}}\\right)$$\n现在我们可以在特定工作点 $v_{\\text{in}} = V_{\\epsilon}$ 处求出所需的最小平均电流 $i_{\\text{cmd,min}}$：\n$$i_{\\text{cmd,min}} = \\frac{\\Delta i_L}{2} = \\frac{V_{\\epsilon}}{2 L f_s} \\left(1 - \\frac{V_{\\epsilon}}{V_{\\text{o}}}\\right)$$\n给定以下数值：\n- 电感 $L = 600\\,\\mu\\text{H} = 600 \\times 10^{-6}\\,\\text{H}$\n- 开关频率 $f_s = 100\\,\\text{kHz} = 100 \\times 10^{3}\\,\\text{Hz}$\n- 输出母线电压 $V_{\\text{o}} = 400\\,\\text{V}$\n- 瞬时输入电压 $V_{\\epsilon} = 10\\,\\text{V}$\n\n将这些值代入推导出的表达式中：\n$$i_{\\text{cmd,min}} = \\frac{10\\,\\text{V}}{2 \\cdot (600 \\times 10^{-6}\\,\\text{H}) \\cdot (100 \\times 10^{3}\\,\\text{Hz})} \\left(1 - \\frac{10\\,\\text{V}}{400\\,\\text{V}}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{2 \\cdot (6 \\times 10^{-4}) \\cdot (1 \\times 10^{5})} \\left(1 - \\frac{1}{40}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{12 \\times 10^{1}} \\left(\\frac{39}{40}\\right)$$\n$$i_{\\text{cmd,min}} = \\frac{10}{120} \\cdot \\frac{39}{40} = \\frac{1}{12} \\cdot \\frac{39}{40} = \\frac{39}{480}\\,\\text{A}$$\n$$i_{\\text{cmd,min}} = \\frac{13}{160}\\,\\text{A} = 0.08125\\,\\text{A}$$\n该数值四舍五入到四位有效数字后为 $0.08125\\,\\text{A}$。\n\n关于设计权衡，一个理想的 PFC 整流器吸取的输入电流 $i_{\\text{in}}(t)$ 与输入电压 $v_{\\text{in}}(t)$ 完全同相且呈完美正弦波形，从而使理论上的总谐波失真 (THD) 为零。指令电流应为 $i_{\\text{cmd}}(t) \\propto |\\sin(\\omega t)|$。然而，为了保证 CCM 运行，特别是在交流线路电压过零点附近（此处 $v_{\\text{in}}$ 非常小），会强制执行一个最小电流指令 $i_{\\text{cmd,min}}$。实际的指令电流变为 $i_{\\text{cmd}}(t) = \\text{max}(k|\\sin(\\omega t)|, i_{\\text{cmd,min}})$，其中 $k$ 是一个比例因子。\n\n这种做法通常被称为“电流钳位”或设置“电流下限”，它会使输入电流波形失真。电流波形不再跟随正弦形状下降到零，而是在靠近过零点的部分交流周期内，在 $i_{\\text{cmd,min}}$ 这个值上变得平坦。根据 Fourier 分析，任何对纯正弦波形的偏离都会引入谐波分量。电流波形中的平坦段会在输入电流的频谱中引入奇次谐波（3次、5次、7次等）。\n\nTHD 定义为 $\\text{THD} = \\frac{\\sqrt{\\sum_{n\\geq 2} I_{n}^{2}}}{I_{1}}$，其中 $I_n$ 是第n次谐波的有效值。这些高次谐波的引入使得THD表达式的分子非零，从而增加了输入电流的THD。一个较大的 $i_{\\text{cmd,min}}$ 值能提供更宽的裕度以应对参数或负载变化来维持CCM，但它也延长了电流钳位的持续时间，导致更显著的波形失真和更高的THD。因此，设计上的权衡在于：在CCM模式下运行的鲁棒性和简便性（非零 $i_{\\text{cmd,min}}$ 的好处）与满足限制输入电流谐波的电能质量标准的需求（THD增加的缺点）之间。",
            "answer": "$$\\boxed{0.08125}$$"
        },
        {
            "introduction": "最终，一项设计的成功与否是通过其在电能质量标准下的实际性能来衡量的。这最后一个实践使用仿真来验证整个系统，同时考虑了控制环路动态和其他非理想因素 。通过对 PFC 转换器进行计算建模，您将计算功率因数 (PF) 和总谐波失真 (THD) 等关键指标，以评估设计是否达到其目标。",
            "id": "3829551",
            "problem": "您需要编写一个完整、可运行的程序，该程序在平均电流控制下，模拟一个单相、连续导通模式的升压型功率因数校正 (PFC) 级的输入电压和电流，根据第一性原理，从仿真波形中计算输入电流的功率因数 (PF) 和总谐波失真 (THD)，将这些值与目标值进行比较，并汇总指定测试套件中的通过/失败结果。\n\n从以下基本原理开始：\n- 瞬时功率定义为 $p(t)=v(t)\\,i(t)$。\n- 一个周期 $T$ 内的均方根 (RMS) 值为 $x_{\\mathrm{rms}}=\\sqrt{\\frac{1}{T}\\int_{0}^{T} x^{2}(t)\\,dt}$。\n- 有功功率为 $P=\\frac{1}{T}\\int_{0}^{T} v(t)\\,i(t)\\,dt$。\n- 功率因数 (Power Factor) 为 $PF=\\dfrac{P}{V_{\\mathrm{rms}}\\,I_{\\mathrm{rms}}}$。\n- 对于基波角频率为 $\\omega$ 的周期性电流 $i(t)$，定义其基波分量为 $i_{1}(t)$，高次谐波为 $i_{h}(t)$（$h\\ge 2$）。电流的总谐波失真 (Total Harmonic Distortion, THD) 为 $THD=\\dfrac{\\sqrt{\\sum_{h=2}^{\\infty} I_{h,\\mathrm{rms}}^{2}}}{I_{1,\\mathrm{rms}}}$，其中 $I_{h,\\mathrm{rms}}$ 是第 $h$ 次谐波的 RMS 值，$I_{1,\\mathrm{rms}}$ 是基波的 RMS 值。\n\n连续导通模式下采用平均电流控制的 PFC 级的模型假设：\n- 输入电压为 $v_{g}(t)=V_{m}\\sin(\\omega t)$，其中 $V_{m}=\\sqrt{2}\\,V_{\\mathrm{rms}}$ 且 $\\omega=2\\pi f_{\\ell}$。\n- 为获得平均输出功率 $P_{\\mathrm{out}}$ 且功率因数接近于 1，参考输入电流为 $i_{\\mathrm{ref}}(t)=I_{1,\\mathrm{ref}}\\sin(\\omega t)$，其中 $I_{1,\\mathrm{ref}}=\\dfrac{2P_{\\mathrm{out}}}{V_{m}}$，以便在理想的单位功率因数情况下，有功功率的基波分量等于 $P_{\\mathrm{out}}$。\n- 平均电流环路动态特性被建模为对 $i_{\\mathrm{ref}}(t)$ 的一阶线性时不变跟踪：\n$$\\frac{d}{dt} i_{f}(t)=\\omega_{c}\\bigl(i_{\\mathrm{ref}}(t)-i_{f}(t)\\bigr),$$\n其中 $i_{f}(t)$ 是跟踪电流，$\\omega_{c}=2\\pi f_{c}$ 是电流环路带宽，单位为弧度/秒。\n- 非理想因素引入了可控的奇次谐波失真，此处建模为在跟踪电流上叠加一个三次谐波分量：\n$$i_{3}(t)=I_{3}\\sin(3\\omega t+\\phi_{3}),\\quad I_{3}=\\alpha_{3}\\,I_{1,\\mathrm{track}},$$\n其中 $I_{1,\\mathrm{track}}$ 定义为在单极点跟踪模型下 $i_{f}(t)$相对于 $i_{\\mathrm{ref}}(t)$ 的稳态基波幅值 $I_{1,\\mathrm{track}}=\\dfrac{I_{1,\\mathrm{ref}}}{\\sqrt{1+\\left(\\frac{\\omega}{\\omega_{c}}\\right)^{2}}}$，失真分数 $\\alpha_{3}\\in[0,1)$，相位 $\\phi_{3}$ 以弧度为单位指定。仿真的输入电流为 $i_{g}(t)=i_{f}(t)+i_{3}(t)$。\n\n离散时间计算要求：\n- 精确仿真整数个线路周期，以避免离散傅里叶分析中的泄漏。使用均匀采样，采样频率为 $f_{s}$，采样时间为 $\\Delta t=\\dfrac{1}{f_{s}}$，总样本数为 $N=\\dfrac{f_{s}}{f_{\\ell}}\\,N_{\\mathrm{cyc}}$，对应 $N_{\\mathrm{cyc}}$ 个周期，其中 $N$ 必须是整数。\n- 通过在零阶保持器下对线性微分方程进行精确离散化，实现一阶电流环路：\n$$i_{f}[n]=\\left(1-e^{-\\omega_{c}\\Delta t}\\right)\\,i_{\\mathrm{ref}}[n]+e^{-\\omega_{c}\\Delta t}\\,i_{f}[n-1],\\quad i_{f}[0]=0.$$\n- 从仿真的离散波形计算 $V_{\\mathrm{rms}}$、$I_{\\mathrm{rms}}$ 和 $P$，通过用 $N$ 个采样点的有限平均值替代积分。\n- 通过离散傅里叶变换计算 $THD$，方法是识别频率为 $f_{\\ell}$ 的基波仓 (bin) 以及频率为整数倍 $h f_{\\ell}$ ($h=2,\\dots,H$) 的谐波，其中 $H$ 是一个适当选择的谐波上限指数。使用离散傅里叶变换幅值、正弦波幅值和各次谐波的 RMS 值之间的标准关系来评估 $THD$ 定义的分子和分母。\n\n程序目标和输出规范：\n- 目标：$PF\\ge 0.99$ 和 $THD\\le 0.05$（注意：$THD$ 必须表示为小数，而不是百分比）。\n- 对于每次测试，您的程序必须输出一个包含三项的列表：计算出的 $PF$（四舍五入到六位小数，无量纲）、计算出的 $THD$（四舍五入到六位小数，无量纲），以及一个布尔值，指示是否同时满足两个目标。\n- 您的程序应生成单行输出，其中包含一个列表，列表内是按照下面测试套件顺序排列的结果。每个元素是用于一次测试的三元组。例如，一个有效的结构是 $[\\,[0.999000,0.040000,\\mathrm{True}],[\\dots]\\,]$。\n\n测试套件（使用这些精确参数）：\n- 全局参数（适用于所有测试）：$V_{\\mathrm{rms}}=230\\,\\mathrm{V}$，$f_{\\ell}=50\\,\\mathrm{Hz}$，$P_{\\mathrm{out}}=1000\\,\\mathrm{W}$，$f_{s}=100000\\,\\mathrm{Hz}$，$N_{\\mathrm{cyc}}=40$，三次谐波分析上限指数 $H=25$，三次谐波相位单位为弧度。\n- 测试 1 (理想情况): $f_{c}=2000\\,\\mathrm{Hz}$，$\\alpha_{3}=0.01$，$\\phi_{3}=0$。\n- 测试 2 (功率因数受限情况): $f_{c}=300\\,\\mathrm{Hz}$，$\\alpha_{3}=0.005$，$\\phi_{3}=0$。\n- 测试 3 (总谐波失真受限情况): $f_{c}=2000\\,\\mathrm{Hz}$，$\\alpha_{3}=0.08$，$\\phi_{3}=\\dfrac{\\pi}{6}$。\n- 测试 4 (功率因数和总谐波失真均受压力情况): $f_{c}=100\\,\\mathrm{Hz}$，$\\alpha_{3}=0.06$，$\\phi_{3}=\\dfrac{\\pi}{3}$。\n\n角度单位要求：所有角度都以弧度指定，并且必须以弧度进行解释。\n\n单位要求：\n- 电压单位为 $\\mathrm{V}$，频率单位为 $\\mathrm{Hz}$，功率单位为 $\\mathrm{W}$，电流单位为 $\\mathrm{A}$，角度单位为弧度。PF 和 THD 是无量纲的，在输出中必须表示为小数。\n\n您的程序必须：\n- 根据上述模型和参数仿真波形。\n- 根据上述定义从仿真的离散波形计算 $PF$ 和 $THD$。\n- 与目标 $PF\\ge 0.99$ 和 $THD\\le 0.05$ 进行比较。\n- 输出单行结果，该行为一个列表，包含四个按测试套件顺序排列的单项测试三元组 $[PF,THD,\\mathrm{boolean}]$，其中 $PF$ 和 $THD$ 四舍五入到六位小数。",
            "solution": "用户提供了一个需要对单相升压型功率因数校正 (PFC) 级进行仿真和分析的问题。第一步是验证问题陈述。\n\n### 步骤 1：提取已知条件\n\n-   **基本定义**:\n    -   瞬时功率: $p(t)=v(t)\\,i(t)$。\n    -   均方根 (RMS): $x_{\\mathrm{rms}}=\\sqrt{\\frac{1}{T}\\int_{0}^{T} x^{2}(t)\\,dt}$。\n    -   有功功率: $P=\\frac{1}{T}\\int_{0}^{T} v(t)\\,i(t)\\,dt$。\n    -   功率因数: $PF=\\dfrac{P}{V_{\\mathrm{rms}}\\,I_{\\mathrm{rms}}}$。\n    -   电流总谐波失真 (THD): $THD=\\dfrac{\\sqrt{\\sum_{h=2}^{\\infty} I_{h,\\mathrm{rms}}^{2}}}{I_{1,\\mathrm{rms}}}$。\n\n-   **模型假设**:\n    -   输入电压: $v_{g}(t)=V_{m}\\sin(\\omega t)$，其中 $V_{m}=\\sqrt{2}\\,V_{\\mathrm{rms}}$ 且 $\\omega=2\\pi f_{\\ell}$。\n    -   参考电流: $i_{\\mathrm{ref}}(t)=I_{1,\\mathrm{ref}}\\sin(\\omega t)$，其中 $I_{1,\\mathrm{ref}}=\\dfrac{2P_{\\mathrm{out}}}{V_{m}}$。\n    -   电流环路动态特性: $\\frac{d}{dt} i_{f}(t)=\\omega_{c}\\bigl(i_{\\mathrm{ref}}(t)-i_{f}(t)\\bigr)$，其中 $\\omega_{c}=2\\pi f_{c}$。\n    -   谐波失真模型: $i_{3}(t)=I_{3}\\sin(3\\omega t+\\phi_{3})$，其中 $I_{3}=\\alpha_{3}\\,I_{1,\\mathrm{track}}$。\n    -   跟踪的基波幅值: $I_{1,\\mathrm{track}}=\\dfrac{I_{1,\\mathrm{ref}}}{\\sqrt{1+\\left(\\frac{\\omega}{\\omega_{c}}\\right)^{2}}}$。\n    -   仿真输入电流: $i_{g}(t)=i_{f}(t)+i_{3}(t)$。\n\n-   **离散时间计算**:\n    -   在 $N_{\\mathrm{cyc}}$ 个周期上进行仿真。\n    -   采样频率 $f_{s}$，采样时间 $\\Delta t=1/f_{s}$。\n    -   总样本数: $N=\\dfrac{f_{s}}{f_{\\ell}}\\,N_{\\mathrm{cyc}}$ (必须为整数)。\n    -   离散滤波器实现: $i_{f}[n]=\\left(1-e^{-\\omega_{c}\\Delta t}\\right)\\,i_{\\mathrm{ref}}[n]+e^{-\\omega_{c}\\Delta t}\\,i_{f}[n-1]$，其中 $i_{f}[0]=0$。\n    -   离散指标: 积分由 $N$ 个样本的平均值代替。\n    -   通过 DFT 计算 THD，最高谐波指数为 $H$。\n\n-   **目标与输出**:\n    -   目标: $PF\\ge 0.99$，$THD\\le 0.05$。\n    -   输出格式: 一个包含三元组 $[PF, THD, \\text{boolean}]$ 的列表，每项四舍五入到六位小数，用于每次测试。最终输出是这些列表的单行字符串表示。\n\n-   **测试套件**:\n    -   全局参数: $V_{\\mathrm{rms}}=230\\,\\mathrm{V}$，$f_{\\ell}=50\\,\\mathrm{Hz}$，$P_{\\mathrm{out}}=1000\\,\\mathrm{W}$，$f_{s}=100000\\,\\mathrm{Hz}$，$N_{\\mathrm{cyc}}=40$，$H=25$。\n    -   测试 1: $f_{c}=2000\\,\\mathrm{Hz}$，$\\alpha_{3}=0.01$，$\\phi_{3}=0$。\n    -   测试 2: $f_{c}=300\\,\\mathrm{Hz}$，$\\alpha_{3}=0.005$，$\\phi_{3}=0$。\n    -   测试 3: $f_{c}=2000\\,\\mathrm{Hz}$，$\\alpha_{3}=0.08$，$\\phi_{3}=\\pi/6$。\n    -   测试 4: $f_{c}=100\\,\\mathrm{Hz}$，$\\alpha_{3}=0.06$，$\\phi_{3}=\\pi/3$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n1.  **科学或事实上的不健全性**: 问题在科学上是健全的。功率、PF 和 THD 的定义是电气工程中的标准定义。PFC 级的建模，包括电流环路的一阶近似和简化的失真模型，是电力电子分析中有效且常用的简化方法。滤波器的离散化方法是零阶保持器输入的精确解，是数字控制中的正确技术。\n\n2.  **无法形式化或不相关**: 问题与电力电子设计高度相关，并且具有足够的数学严谨性，可以形式化为一个仿真程序。\n\n3.  **不完整或矛盾的设置**: 问题是自洽的。为仿真和分析提供了所有必需的参数。样本数 $N = \\frac{f_s}{f_\\ell} N_{\\mathrm{cyc}} = \\frac{100000}{50} \\times 40 = 80000$ 是一个整数，满足约束条件。被分析的最高谐波频率为 $H \\times f_\\ell = 25 \\times 50\\,\\mathrm{Hz} = 1250\\,\\mathrm{Hz}$，远低于奈奎斯特频率 $f_s/2 = 50\\,\\mathrm{kHz}$，从而防止了 THD 计算中的混叠问题。\n\n4.  **不切实际或不可行**: 参数是现实的。$230\\,\\mathrm{V}$ / $50\\,\\mathrm{Hz}$ 是标准的市电供应， $1000\\,\\mathrm{W}$ 是典型的功率水平，指定的采样和控制频率在现代数字功率控制的正常范围内。\n\n5.  **不适定或结构不良**: 问题是适定的。仿真是基于一个具有确定初始条件的稳定线性系统，保证了唯一解。分析步骤是确定性的。\n\n6.  **伪深刻、琐碎或同义反复**: 问题需要对仿真和信号处理进行非平凡的实现，结合了控制理论、信号分析和电力电子学的概念。它是一个实质性的工程问题。\n\n7.  **超出科学可验证范围**: 结果可以通过独立的仿真和解析近似进行验证。\n\n### 步骤 3：结论和行动\n\n问题被判定为**有效**。将提供一个解决方案。\n\n### 基于原理的设计\n\n将遵循问题陈述中指定的模型和计算要求来开发解决方案。解决方案的核心是数值仿真，然后是基于基本电气工程原理的性能分析。\n\n1.  **参数计算**: 我们首先从给定参数计算派生的常数。这包括峰值电压 $V_m$、线路角频率 $\\omega$、采样周期 $\\Delta t$、总样本数 $N$ 以及以 rad/s 为单位的电流环路带宽 $\\omega_c$。\n\n2.  **波形生成**: 仿真需要输入电压和参考电流的时域波形。\n    -   创建一个离散时间向量 $t[n] = n\\Delta t$，其中 $n=0, 1, \\dots, N-1$。\n    -   输入电压为 $v_g[n] = V_m \\sin(\\omega t[n])$。\n    -   参考电流的峰值幅值计算为 $I_{1,\\mathrm{ref}} = 2P_{\\mathrm{out}}/V_m$。这确保了如果输入电流是完美的正弦波并且与电压同相，平均输入功率将等于目标输出功率 $P_{\\mathrm{out}}$。\n    -   然后，参考电流波形为 $i_{\\mathrm{ref}}[n] = I_{1,\\mathrm{ref}} \\sin(\\omega t[n])$。\n\n3.  **电流环路仿真**: 平均电流控制器的行为被建模为一阶低通滤波器。提供了连续时间微分方程及其在零阶保持器下的精确离散时间等效形式。\n    -   方程为 $i_{f}[n]= c_1 i_{\\mathrm{ref}}[n] + c_2 i_{f}[n-1]$，其中 $c_1 = 1-e^{-\\omega_{c}\\Delta t}$ 且 $c_2=e^{-\\omega_{c}\\Delta t}$。这是一个一阶无限脉冲响应 (IIR) 滤波器。\n    -   我们使用 `scipy.signal.lfilter` 来实现这个滤波器，这对该任务来说计算效率很高。滤波器系数为 `b=[c1]` 和 `a=[1, -c2]`。仿真从静止开始，对应于指定的初始条件 $i_f[0]=0$，这是 `lfilter` 的默认设置。\n\n4.  **失真建模**: 将一个三次谐波电流分量添加到滤波后的电流中，以模拟非理想行为。\n    -   首先计算被跟踪电流的基波分量幅值 $I_{1,\\mathrm{track}}$。这考虑了低通滤波器在线路频率 $\\omega$ 处的增益。\n    -   然后，三次谐波的幅值 $I_3$ 被确定为 $I_{1,\\mathrm{track}}$ 的一个分数 $\\alpha_3$。\n    -   三次谐波波形为 $i_3[n] = I_3 \\sin(3\\omega t[n] + \\phi_3)$。\n    -   总的仿真输入电流是两者的和：$i_g[n] = i_f[n] + i_3[n]$。\n\n5.  **性能指标计算**: 使用仿真的离散波形 $v_g[n]$ 和 $i_g[n]$，我们计算性能指标。\n    -   **RMS、功率和 PF**: RMS 值 $V_{\\mathrm{rms}}$ 和 $I_{\\mathrm{rms}}$，以及有功功率 $P$，是通过对 $N$ 个样本的平方值（对于 RMS）或信号乘积（对于功率）取平均值来计算的。这些定义是标准积分定义的离散版本：\n        -   $V_{\\mathrm{rms,sim}} = \\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} v_g[n]^2}$\n        -   $I_{\\mathrm{rms,sim}} = \\sqrt{\\frac{1}{N}\\sum_{n=0}^{N-1} i_g[n]^2}$\n        -   $P_{\\mathrm{sim}} = \\frac{1}{N}\\sum_{n=0}^{N-1} v_g[n]i_g[n]$\n        -   功率因数计算为 $PF = \\frac{P_{\\mathrm{sim}}}{V_{\\mathrm{rms,sim}} I_{\\mathrm{rms,sim}}}$。\n    -   **THD**: 总谐波失真是使用电流波形 $i_g[n]$ 的离散傅里叶变换 (DFT) 计算的，通过 `numpy.fft.fft` 获得。\n        -   DFT 的频率分辨率为 $f_s/N = f_\\ell/N_{cyc}$。基波频率 $f_\\ell$ 对应于 DFT 仓 (bin) 索引 $k_1 = f_\\ell / (f_s/N) = N_{cyc}$。谐波出现在该索引的整数倍处，$k_h = h \\cdot N_{cyc}$。\n        -   第 $h$ 次谐波的 RMS 值是根据仓 $k_h$ 处的 DFT 系数幅值 $|I_g[k_h]|$ 计算的，使用关系式 $I_{h,\\mathrm{rms}} = \\frac{\\sqrt{2}}{N}|I_g[k_h]|$。\n        -   然后使用其定义计算 THD，将从 $h=2$ 到指定的上限 $H=25$ 的谐波功率相加：$THD = \\frac{\\sqrt{\\sum_{h=2}^{H} I_{h,\\mathrm{rms}}^2}}{I_{1,\\mathrm{rms}}}$。\n\n6.  **目标评估和输出格式化**: 最后，将计算出的 $PF$ 和 $THD$ 与其各自的目标进行比较。每个测试用例的结果——四舍五入到六位小数的 $PF$ 和 $THD$ 以及指示成功的布尔值——被格式化为指定的字符串格式。对套件中的所有测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\nfrom scipy.signal import lfilter\n\ndef solve():\n    \"\"\"\n    Simulates a single-phase boost PFC stage, computes PF and THD,\n    and evaluates against performance targets for a suite of tests.\n    \"\"\"\n\n    # Global parameters applicable to all test cases\n    V_RMS_g_spec = 230.0    # V, specified RMS input voltage\n    f_l = 50.0              # Hz, line frequency\n    P_out = 1000.0          # W, target average output power\n    f_s = 100000.0          # Hz, sampling frequency\n    N_cyc = 40              # Number of line cycles to simulate\n    H = 25                  # Upper harmonic index for THD calculation\n\n    # Test suite parameters: (fc, alpha3, phi3)\n    test_cases = [\n        (2000.0, 0.01, 0.0),                     # Test 1: Happy path\n        (300.0, 0.005, 0.0),                     # Test 2: PF-limited case\n        (2000.0, 0.08, np.pi / 6.0),             # Test 3: THD-limited case\n        (100.0, 0.06, np.pi / 3.0),              # Test 4: Stressed case\n    ]\n\n    # List to store the results for each test case\n    final_results = []\n\n    for fc, alpha3, phi3 in test_cases:\n        # --- 1. Derived Constants and Simulation Setup ---\n        V_m_g = np.sqrt(2) * V_RMS_g_spec    # V, peak input voltage\n        omega_l = 2 * np.pi * f_l            # rad/s, line angular frequency\n        dt = 1.0 / f_s                       # s, sampling time\n        N = int((f_s / f_l) * N_cyc)         # Total number of samples\n        t = np.arange(N) * dt                # Time vector\n\n        # --- 2. Waveform Generation ---\n        # Input grid voltage waveform\n        v_g = V_m_g * np.sin(omega_l * t)\n\n        # Ideal reference current waveform for unity power factor\n        I_1_ref_peak = (2 * P_out) / V_m_g\n        i_ref = I_1_ref_peak * np.sin(omega_l * t)\n\n        # --- 3. Current Loop Simulation ---\n        # The current loop is modeled as a first-order low-pass filter\n        omega_c = 2 * np.pi * fc  # rad/s, current loop bandwidth\n        \n        # Digital filter coefficients for the exact discretization\n        # i_f[n] = (1-exp(-wc*dt))*i_ref[n] + exp(-wc*dt)*i_f[n-1]\n        # This is an IIR filter with b=[1-exp(-wc*dt)], a=[1, -exp(-wc*dt)]\n        c2 = np.exp(-omega_c * dt)\n        c1 = 1 - c2\n        b = [c1]\n        a = [1, -c2]\n        \n        # Apply the filter to the reference an input to get the tracked current\n        i_f = lfilter(b, a, i_ref)\n\n        # --- 4. Distortion Modeling ---\n        # Calculate the amplitude of the fundamental component of the tracked current\n        filter_gain_at_fl = 1.0 / np.sqrt(1 + (omega_l / omega_c)**2)\n        I_1_track_peak = I_1_ref_peak * filter_gain_at_fl\n\n        # Calculate the amplitude of the injected 3rd harmonic\n        I_3_peak = alpha3 * I_1_track_peak\n        \n        # Generate the 3rd harmonic current waveform\n        i_3 = I_3_peak * np.sin(3 * omega_l * t + phi3)\n\n        # The total simulated input current is the sum of tracked and harmonic currents\n        i_g = i_f + i_3\n\n        # --- 5. Performance Metrics Calculation ---\n        # RMS, Power, and Power Factor (PF)\n        V_rms_sim = np.sqrt(np.mean(v_g**2))\n        I_rms_sim = np.sqrt(np.mean(i_g**2))\n        P_sim = np.mean(v_g * i_g)\n        \n        # Avoid division by zero if current is zero for some reason\n        if V_rms_sim * I_rms_sim == 0:\n            pf = 1.0\n        else:\n            pf = P_sim / (V_rms_sim * I_rms_sim)\n\n        # Total Harmonic Distortion (THD)\n        # Perform FFT on the simulated input current\n        I_g_fft = np.fft.fft(i_g)\n        \n        # The fundamental frequency bin is at index N_cyc\n        k1_idx = N_cyc\n        \n        # RMS of the fundamental component\n        I1_rms = np.sqrt(2) * np.abs(I_g_fft[k1_idx]) / N\n\n        # Sum of squares of RMS values for harmonics h=2 to H\n        sum_harm_rms_sq = 0.0\n        for h in range(2, H + 1):\n            kh_idx = h * k1_idx\n            # Ensure the harmonic index is within the valid FFT range\n            if kh_idx  N / 2:\n                Ih_rms = np.sqrt(2) * np.abs(I_g_fft[kh_idx]) / N\n                sum_harm_rms_sq += Ih_rms**2\n        \n        # Calculate THD\n        if I1_rms == 0:\n            thd = 0.0\n        else:\n            thd = np.sqrt(sum_harm_rms_sq) / I1_rms\n\n        # --- 6. Target Evaluation ---\n        pf_target = 0.99\n        thd_target = 0.05\n        passed = (pf >= pf_target) and (thd = thd_target)\n        \n        # Store the results for this case\n        final_results.append([pf, thd, passed])\n\n    # --- Final Output Formatting ---\n    # Create a list of formatted strings for each result triple\n    output_strings = []\n    for res in final_results:\n        pf_val, thd_val, pass_val = res\n        # Format: [pf (6 dec),thd (6 dec),Boolean] with no spaces\n        output_strings.append(f\"[{pf_val:.6f},{thd_val:.6f},{pass_val}]\")\n\n    # Combine the strings into a single line, as a list of lists.\n    # The format \"[{','.join(...)}}]\" matches the Python code template in the problem spec.\n    print(f\"[{','.join(output_strings)}]\")\n\nsolve()\n```"
        }
    ]
}