{
    "hands_on_practices": [
        {
            "introduction": "The foundation of Power Factor Correction (PFC) is to make a nonlinear load, like a rectifier, behave like a resistor from the perspective of the AC source. In Critical Conduction Mode (CrCM), this is achieved by controlling the inductor current on a cycle-by-cycle basis. This first practice explores the core principle of CrCM control: by shaping the *peak* of the triangular inductor current to follow the sinusoidal input voltage, the *average* input current naturally follows suit, achieving a high power factor. This exercise will have you derive this fundamental relationship and quantify the ideal performance of such a controller, providing a crucial baseline for understanding its real-world behavior .",
            "id": "3824109",
            "problem": "A single-phase mains Power Factor Correction (PFC) boost converter behind a full-wave diode bridge operates in Critical Conduction Mode (CrCM), also called Boundary Conduction Mode (BCM). In CrCM, the boost inductor current resets to zero each switching cycle. Assume an idealized model in which the boost inductor current in each cycle is a piecewise-linear triangular waveform that starts at zero, rises linearly to a peak, and then decays linearly back to zero, with no delays, no offsets, and no current measurement error. Let the instantaneous input source voltage be $v_{s}(t)=V_{m}\\sin(\\omega t)$ and the rectified voltage magnitude be $|v_{s}(t)|$ at the bridge output.\n\nThe current control loop enforces peak tracking: the inductor peak current at the $k$-th cycle satisfies $i_{\\text{pk}}(t_{k})=\\kappa\\,|v_{s}(t_{k})|$, where $\\kappa$ is a constant design gain and $t_{k}$ is the cycle start time. Let the switching-cycle average input current be $i_{\\text{avg}}(t)$, defined as the triangular waveform average over each cycle, and let the line current seen at the alternating current (AC) source be $i_{\\ell}(t)=\\operatorname{sgn}(\\sin(\\omega t))\\,i_{\\text{avg}}(t)$ due to the diode bridge sign restoration.\n\nStarting only from the inductor law $v_{L}=L\\,di/dt$, the piecewise-linear triangular current model, and the definition of Total Harmonic Distortion (THD) for the line current over the fundamental frequency $\\omega$, where\n$$\n\\mathrm{THD}=\\frac{\\sqrt{\\sum_{n=2}^{\\infty}I_{n}^{2}}}{I_{1}},\n$$\nwith $I_{n}$ denoting the root-mean-square (RMS) magnitude of the $n$-th harmonic of $i_{\\ell}(t)$, perform the following:\n\n1. Derive the ratio $R$ between the enforced peak current and the switching-cycle average current, $R\\equiv \\frac{i_{\\text{pk}}}{i_{\\text{avg}}}$, for the described triangular waveform that resets to zero each cycle, without assuming symmetry of rise and fall slopes.\n\n2. Under the same idealized assumptions (no propagation delays, no minimum on-time limitations, exact peak tracking $i_{\\text{pk}}(t)=\\kappa\\,|v_{s}(t)|$, negligible high-frequency ripple contribution to line-frequency harmonics), determine the resulting line-current THD.\n\nExpress the final answer as a row matrix containing the two quantities $\\big(R,\\ \\mathrm{THD}\\big)$ in that order. Report $R$ as a pure number. Report $\\mathrm{THD}$ as a pure decimal (no percentage sign). No rounding is required, and no units should be included inside the final answer.",
            "solution": "The problem statement has been validated and is deemed valid. It presents a standard, well-posed problem in the field of power electronics, based on established scientific principles and using clear, objective language. The assumptions provided, though ideal, are explicitly stated and form a self-contained basis for a rigorous derivation.\n\nThe solution proceeds in two parts as requested.\n\n**Part 1: Derivation of the Ratio $R \\equiv \\frac{i_{\\text{pk}}}{i_{\\text{avg}}}$.**\n\nThe problem describes the inductor current within a single switching cycle as a piecewise-linear triangular waveform. Let the duration of one switching cycle be $T_{\\text{sw}}$. Let the local time variable within this cycle be $t'$, ranging from $t'=0$ to $t'=T_{\\text{sw}}$.\n\nThe current starts at zero, rises linearly to a peak value $i_{\\text{pk}}$ at time $t'=T_{\\text{on}}$, and then decays linearly back to zero at time $t'=T_{\\text{sw}}$. The duration of the fall time is $T_{\\text{off}} = T_{\\text{sw}} - T_{\\text{on}}$. The problem states that no assumption should be made about the symmetry of rise and fall slopes, which means $T_{\\text{on}}$ is not necessarily equal to $T_{\\text{off}}$.\n\nThe inductor current waveform $i_L(t')$ can be described as:\n$$\ni_L(t') =\n\\begin{cases}\n\\frac{i_{\\text{pk}}}{T_{\\text{on}}} t' & \\text{for } 0 \\leq t' \\leq T_{\\text{on}} \\\\\ni_{\\text{pk}} - \\frac{i_{\\text{pk}}}{T_{\\text{off}}}(t' - T_{\\text{on}}) & \\text{for } T_{\\text{on}} < t' \\leq T_{\\text{sw}}\n\\end{cases}\n$$\nThe problem states that this piecewise-linear behavior results from the inductor law $v_L = L \\frac{di}{dt}$ under the application of piecewise-constant voltages during the on-time and off-time of the boost switch, which is consistent.\n\nThe switching-cycle average current, $i_{\\text{avg}}$, is defined as the average value of this triangular waveform over its period $T_{\\text{sw}}$. This is calculated by finding the area under the $i_L(t')$ curve and dividing by the period $T_{\\text{sw}}$.\n$$\ni_{\\text{avg}} = \\frac{1}{T_{\\text{sw}}} \\int_0^{T_{\\text{sw}}} i_L(t') \\, dt'\n$$\nThe integral represents the area of a triangle with base $T_{\\text{sw}}$ and height $i_{\\text{pk}}$. The area of a triangle is given by $\\frac{1}{2} \\times \\text{base} \\times \\text{height}$.\n$$\n\\text{Area} = \\int_0^{T_{\\text{sw}}} i_L(t') \\, dt' = \\frac{1}{2} T_{\\text{sw}} i_{\\text{pk}}\n$$\nThis geometric result holds regardless of whether the triangle is symmetric ($T_{\\text{on}} = T_{\\text{off}}$) or not. The area calculation does not depend on the position of the peak along the base.\n\nSubstituting this area back into the expression for $i_{\\text{avg}}$:\n$$\ni_{\\text{avg}} = \\frac{1}{T_{\\text{sw}}} \\left( \\frac{1}{2} T_{\\text{sw}} i_{\\text{pk}} \\right) = \\frac{1}{2} i_{\\text{pk}}\n$$\nThe ratio $R$ is defined as $R \\equiv \\frac{i_{\\text{pk}}}{i_{\\text{avg}}}$. Using the relationship derived above:\n$$\nR = \\frac{i_{\\text{pk}}}{\\frac{1}{2} i_{\\text{pk}}} = 2\n$$\nThus, for any triangular current waveform that starts and ends at zero, the ratio of the peak value to the cycle-average value is exactly $2$.\n\n**Part 2: Determination of the Line Current Total Harmonic Distortion (THD).**\n\nThe problem specifies a peak tracking control law where the peak inductor current in the $k$-th cycle, $i_{\\text{pk}}(t_k)$, follows the rectified source voltage magnitude:\n$$\ni_{\\text{pk}}(t_k) = \\kappa |v_{s}(t_k)|\n$$\nwhere $\\kappa$ is a constant gain.\n\nFrom Part 1, we know the relationship between the switching-cycle average current $i_{\\text{avg}}(t_k)$ and the peak current $i_{\\text{pk}}(t_k)$ for that cycle is:\n$$\ni_{\\text{avg}}(t_k) = \\frac{1}{2} i_{\\text{pk}}(t_k)\n$$\nCombining these two equations, we find the cycle-average current as a function of the source voltage:\n$$\ni_{\\text{avg}}(t_k) = \\frac{\\kappa}{2} |v_{s}(t_k)|\n$$\nThe problem assumes that the switching frequency is much greater than the line frequency $\\omega$. This allows us to approximate the discrete sequence of cycle averages $i_{\\text{avg}}(t_k)$ with a continuous-time function $i_{\\text{avg}}(t)$. This function represents the low-frequency component of the current drawn from the DC side of the rectifier.\n$$\ni_{\\text{avg}}(t) = \\frac{\\kappa}{2} |v_{s}(t)|\n$$\nThe source voltage is given as $v_{s}(t) = V_{m}\\sin(\\omega t)$. Substituting this into the expression for $i_{\\text{avg}}(t)$:\n$$\ni_{\\text{avg}}(t) = \\frac{\\kappa}{2} |V_{m}\\sin(\\omega t)| = \\frac{\\kappa V_{m}}{2} |\\sin(\\omega t)|\n$$\nThis current $i_{\\text{avg}}(t)$ is the current drawn from the output of the full-wave rectifier. The line current $i_{\\ell}(t)$ seen at the AC source is formed by the \"unfolding\" action of the diode bridge, which is mathematically described as:\n$$\ni_{\\ell}(t) = \\operatorname{sgn}(\\sin(\\omega t)) \\, i_{\\text{avg}}(t)\n$$\nSubstituting the expression for $i_{\\text{avg}}(t)$:\n$$\ni_{\\ell}(t) = \\operatorname{sgn}(\\sin(\\omega t)) \\left( \\frac{\\kappa V_{m}}{2} |\\sin(\\omega t)| \\right)\n$$\nUsing the mathematical identity $x = \\operatorname{sgn}(x) |x|$, we let $x = \\sin(\\omega t)$. The expression for the line current simplifies to:\n$$\ni_{\\ell}(t) = \\frac{\\kappa V_{m}}{2} \\sin(\\omega t)\n$$\nThis result shows that under the idealized assumptions of the problem, the line current $i_{\\ell}(t)$ is a perfect sinusoid, exactly in phase with the source voltage $v_s(t)$.\n\nThe Total Harmonic Distortion (THD) is defined as:\n$$\n\\mathrm{THD} = \\frac{\\sqrt{\\sum_{n=2}^{\\infty}I_{n}^{2}}}{I_{1}}\n$$\nwhere $I_n$ is the RMS magnitude of the $n$-th harmonic of the current $i_{\\ell}(t)$.\nThe derived line current $i_{\\ell}(t) = \\frac{\\kappa V_{m}}{2} \\sin(\\omega t)$ is a pure sinusoidal waveform at the fundamental frequency $\\omega$. By definition, a pure sinusoid has no harmonic content for $n \\ge 2$. Therefore, the RMS magnitudes of all harmonics are zero:\n$$\nI_n = 0 \\quad \\text{for all } n \\geq 2\n$$\nThe RMS magnitude of the fundamental ($n=1$) is non-zero:\n$$\nI_1 = \\frac{1}{\\sqrt{2}} \\left( \\frac{\\kappa V_m}{2} \\right) \\neq 0\n$$\nSubstituting these values into the THD formula:\n$$\n\\mathrm{THD} = \\frac{\\sqrt{\\sum_{n=2}^{\\infty}0^{2}}}{I_1} = \\frac{0}{I_1} = 0\n$$\nThe resulting line-current THD under these idealized conditions is exactly $0$.\n\nThe final answer requires the two quantities $(R, \\mathrm{THD})$ in a row matrix. We have found $R=2$ and $\\mathrm{THD}=0$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While a successful PFC converter draws a sinusoidal current from the line, the instantaneous input power it consumes pulsates at twice the line frequency. Since the load draws a constant DC power, this power imbalance must be managed by an energy storage element. This next exercise focuses on the output capacitor's role as this energy buffer, guiding you to derive the relationship between the converter's power level, the AC line frequency, and the minimum capacitance needed to keep the output voltage ripple within acceptable limits. This calculation is a cornerstone of PFC converter design, directly linking AC power dynamics to DC bus stability .",
            "id": "3824155",
            "problem": "A single-phase boost Power Factor Correction (PFC) rectifier operating in Critical Conduction Mode (CrCM) supplies a constant direct current load power of $P_o$ while regulating its output voltage to $v_o(t) \\approx V_o$ (average). The alternating current line input is sinusoidal with frequency $f_{\\text{line}}$ and is shaped such that the input current is proportional to the input voltage. Under these conditions, the instantaneous input power oscillates at twice the line frequency, which causes a double-line-frequency ripple in the output capacitor voltage. Neglect switching-frequency ripple, semiconductor losses, and any control-loop bandwidth limitations, and assume the small-ripple condition $|\\tilde{v}(t)| \\ll V_o$ for the output voltage ripple $\\tilde{v}(t)$.\n\nStarting from the definitions of instantaneous power, energy conservation at the output port, and the capacitor constitutive relation, derive an expression for the minimum output capacitance $C_o$ required so that the peak-to-peak output voltage ripple at twice the line frequency does not exceed a specified fraction $r$ of $V_o$, i.e., $\\Delta v_{\\text{pp}} \\le r V_o$. Use the line angular frequency $\\omega_{\\text{line}} = 2 \\pi f_{\\text{line}}$.\n\nThen compute $C_o$ numerically for the following specifications: $P_o = 750 \\ \\text{W}$, $V_o = 400 \\ \\text{V}$, $f_{\\text{line}} = 50 \\ \\text{Hz}$, and $r = 0.03$. Express the final capacitance in microfarads and round your answer to three significant figures.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n**Step 1: Extract Givens**\n- System: Single-phase boost Power Factor Correction (PFC) rectifier.\n- Operating Mode: Critical Conduction Mode (CrCM).\n- Load Power: Constant direct current power, $P_o$.\n- Output Voltage: Regulated to an average value $V_o$, with $v_o(t) \\approx V_o$.\n- Input: Sinusoidal AC line input with frequency $f_{\\text{line}}$ and angular frequency $\\omega_{\\text{line}} = 2 \\pi f_{\\text{line}}$.\n- Input Current: Proportional to input voltage (unity power factor).\n- Output Voltage Ripple: A double-line-frequency ripple $\\tilde{v}(t)$ exists, satisfying the small-ripple condition $|\\tilde{v}(t)| \\ll V_o$.\n- Neglections: Switching-frequency ripple, semiconductor losses, control-loop bandwidth limitations.\n- Constraint: The peak-to-peak output voltage ripple, $\\Delta v_{\\text{pp}}$, must not exceed a fraction $r$ of $V_o$, i.e., $\\Delta v_{\\text{pp}} \\le r V_o$.\n- Task: Derive the expression for the minimum required output capacitance $C_o$ and compute its numerical value.\n- Numerical Values: $P_o = 750 \\ \\text{W}$, $V_o = 400 \\ \\text{V}$, $f_{\\text{line}} = 50 \\ \\text{Hz}$, $r = 0.03$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem describes a standard single-phase PFC converter, a fundamental circuit in power electronics. The analysis is based on the principles of power conservation, sinusoidal AC circuit theory, and capacitor behavior, all of which are well-established. The premise of a double-line-frequency power pulsation is a cornerstone of single-phase AC-DC conversion theory.\n- **Well-Posed:** The problem provides a clear objective and sufficient data to derive a unique solution for the capacitance $C_o$. The use of the small-ripple approximation is a standard engineering simplification that makes the problem analytically tractable.\n- **Objective:** The problem is stated in precise, technical language, free from any subjectivity or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid** as it is scientifically sound, well-posed, and objective. A detailed solution will be provided.\n\n**Derivation**\n\nLet the instantaneous line voltage be $v_{\\text{in}}(t) = V_p \\sin(\\omega_{\\text{line}} t)$, where $V_p$ is the peak voltage. Since the PFC rectifier operates at unity power factor, the instantaneous input current $i_{\\text{in}}(t)$ is in phase with the voltage: $i_{\\text{in}}(t) = I_p \\sin(\\omega_{\\text{line}} t)$, where $I_p$ is the peak current.\n\nThe instantaneous input power, $p_{\\text{in}}(t)$, is the product of the instantaneous input voltage and current:\n$$p_{\\text{in}}(t) = v_{\\text{in}}(t) i_{\\text{in}}(t) = (V_p \\sin(\\omega_{\\text{line}} t))(I_p \\sin(\\omega_{\\text{line}} t)) = V_p I_p \\sin^2(\\omega_{\\text{line}} t)$$\nUsing the trigonometric identity $\\sin^2(\\theta) = \\frac{1}{2}(1 - \\cos(2\\theta))$, we can rewrite the instantaneous power as:\n$$p_{\\text{in}}(t) = \\frac{V_p I_p}{2}(1 - \\cos(2\\omega_{\\text{line}} t))$$\nThe average input power, $P_{\\text{in}}$, is the DC component of this expression:\n$$P_{\\text{in}} = \\frac{V_p I_p}{2}$$\nSince semiconductor losses are neglected, the system is lossless, and the average input power must equal the constant output power delivered to the load, $P_o$. Thus, $P_{\\text{in}} = P_o$. Substituting this back into the expression for instantaneous input power gives:\n$$p_{\\text{in}}(t) = P_o(1 - \\cos(2\\omega_{\\text{line}} t))$$\nThis equation shows that the instantaneous power drawn from the line consists of a constant component $P_o$ that is delivered to the load and an oscillating component $-P_o \\cos(2\\omega_{\\text{line}} t)$ that flows at twice the line frequency. By the principle of conservation of energy, this oscillating power component must be absorbed and supplied by the output capacitor, $C_o$.\n\nThe power flowing into the capacitor, $p_C(t)$, is the difference between the instantaneous input power and the constant output power:\n$$p_C(t) = p_{\\text{in}}(t) - P_o = P_o(1 - \\cos(2\\omega_{\\text{line}} t)) - P_o = -P_o \\cos(2\\omega_{\\text{line}} t)$$\nThe power absorbed by a capacitor is also given by the product of its voltage $v_o(t)$ and current $i_C(t)$:\n$$p_C(t) = v_o(t) i_C(t)$$\nThe capacitor current is related to its voltage by the constitutive relation $i_C(t) = C_o \\frac{dv_o(t)}{dt}$. Substituting this gives:\n$$p_C(t) = C_o v_o(t) \\frac{dv_o(t)}{dt}$$\nThe problem states that the output voltage ripple $\\tilde{v}(t)$ is small compared to the DC component $V_o$, so we can make the approximation $v_o(t) \\approx V_o$ in the term multiplying the derivative. This is a standard small-ripple approximation.\n$$p_C(t) \\approx C_o V_o \\frac{dv_o(t)}{dt}$$\nNow, we equate the two expressions for $p_C(t)$:\n$$C_o V_o \\frac{dv_o(t)}{dt} = -P_o \\cos(2\\omega_{\\text{line}} t)$$\nTo find the voltage variation, we can integrate this equation with respect to time. The voltage $v_o(t)$ is composed of the DC component $V_o$ and the ripple component $\\tilde{v}(t)$, so $v_o(t) = V_o + \\tilde{v}(t)$. Its derivative is $\\frac{dv_o(t)}{dt} = \\frac{d\\tilde{v}(t)}{dt}$. The equation becomes:\n$$C_o V_o \\frac{d\\tilde{v}(t)}{dt} = -P_o \\cos(2\\omega_{\\text{line}} t)$$\nIntegrating to find the ripple voltage $\\tilde{v}(t)$:\n$$\\tilde{v}(t) = \\int \\frac{-P_o}{C_o V_o} \\cos(2\\omega_{\\text{line}} t) \\, dt = -\\frac{P_o}{C_o V_o} \\frac{\\sin(2\\omega_{\\text{line}} t)}{2\\omega_{\\text{line}}} + \\text{constant}$$\nThe ripple voltage is a sinusoidal function with an amplitude (peak value) of:\n$$\\tilde{V}_{\\text{peak}} = \\frac{P_o}{2\\omega_{\\text{line}} C_o V_o}$$\nThe peak-to-peak ripple voltage, $\\Delta v_{\\text{pp}}$, is twice this amplitude:\n$$\\Delta v_{\\text{pp}} = 2 \\tilde{V}_{\\text{peak}} = \\frac{P_o}{\\omega_{\\text{line}} C_o V_o}$$\nThe problem requires that this ripple does not exceed a fraction $r$ of the DC output voltage $V_o$:\n$$\\Delta v_{\\text{pp}} \\le r V_o$$\nSubstituting our expression for $\\Delta v_{\\text{pp}}$:\n$$\\frac{P_o}{\\omega_{\\text{line}} C_o V_o} \\le r V_o$$\nTo satisfy this condition, the capacitance $C_o$ must be greater than or equal to a certain minimum value. We solve for $C_o$:\n$$C_o \\ge \\frac{P_o}{r \\omega_{\\text{line}} V_o^2}$$\nThe minimum required capacitance is therefore:\n$$C_{o, \\text{min}} = \\frac{P_o}{r \\omega_{\\text{line}} V_o^2}$$\nSubstituting $\\omega_{\\text{line}} = 2 \\pi f_{\\text{line}}$ gives the final symbolic expression:\n$$C_{o, \\text{min}} = \\frac{P_o}{2 \\pi f_{\\text{line}} r V_o^2}$$\n\n**Numerical Computation**\n\nWe are given the following values:\n$P_o = 750 \\ \\text{W}$\n$V_o = 400 \\ \\text{V}$\n$f_{\\text{line}} = 50 \\ \\text{Hz}$\n$r = 0.03$\n\nWe substitute these values into the derived expression for the minimum capacitance:\n$$C_o = \\frac{750}{2 \\pi (50) (0.03) (400)^2}$$\n$$C_o = \\frac{750}{100 \\pi (0.03) (160000)}$$\n$$C_o = \\frac{750}{3 \\pi (160000)}$$\n$$C_o = \\frac{750}{480000 \\pi} = \\frac{1}{640 \\pi} \\ \\text{F}$$\nNow, we calculate the numerical value:\n$$C_o \\approx \\frac{1}{640 \\times 3.14159265...} \\approx \\frac{1}{2010.619} \\approx 4.97359 \\times 10^{-4} \\ \\text{F}$$\nThe problem asks for the result in microfarads ($\\mu\\text{F}$):\n$$C_o \\approx (4.97359 \\times 10^{-4}) \\times 10^6 \\ \\mu\\text{F} \\approx 497.359 \\ \\mu\\text{F}$$\nRounding to three significant figures, we get:\n$$C_o \\approx 497 \\ \\mu\\text{F}$$",
            "answer": "$$\\boxed{497}$$"
        },
        {
            "introduction": "Bridging the gap between theory and practice involves translating our continuous-time physical models into a discrete-time algorithm for a digital controller. This final hands-on practice challenges you to do just that for a CrCM PFC converter. By synthesizing the fundamental inductor voltage-current relationships and the peak-to-average current ratio, you will evaluate and identify a correct, step-by-step digital control law. This exercise demonstrates how to implement a predictive controller that measures system variables from one cycle to schedule the switch on-time for the next, a technique central to modern digital power control .",
            "id": "3824110",
            "problem": "A single-phase boost rectifier implementing Power Factor Correction (PFC) operates in Critical Conduction Mode (CrCM), also called Boundary Conduction Mode. The power stage is an ideal boost converter with inductance $L$, input rectified voltage $v_{\\text{in}}(t)$, and output voltage $v_o(t)$. In CrCM, each switching cycle begins at zero inductor current, the inductor current rises linearly during switch on-time and then falls linearly to zero during switch off-time, and the next cycle is triggered at the zero-current detection event. Assume the inductor voltage law $v_L = L \\,\\mathrm{d}i/\\mathrm{d}t$, a negligible output capacitor ripple over a single switching cycle so that $v_o(t)$ is approximately constant within a cycle, and ideal diode and switch. The digital controller samples $v_{\\text{in}}$ and $v_o$ synchronously at switching transitions, measures the off-time $t_{\\text{off},k}$ of cycle $k$, and schedules the next on-time $t_{\\text{on},k+1}$ for cycle $k+1$. An outer voltage loop provides a scalar multiplier $K_k$ such that the desired cycle-averaged input current satisfies $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, where $|v_{\\text{in},k+1}|$ is the magnitude of the input voltage sampled for cycle $k+1$.\n\nStarting from the inductor voltage law and the triangular current assumption in CrCM, determine which of the following digital algorithms correctly uses the measured $t_{\\text{off},k}$ to estimate the peak inductor current $i_{\\text{pk},k}$ of cycle $k$ and schedules the next $t_{\\text{on},k+1}$ to achieve an input current proportional to $|v_{\\text{in}}|$ as specified by the outer loop.\n\nA. At the end of cycle $k$, sample $v_{\\text{in},k}$ and $v_{o,k}$ at turn-off and measure $t_{\\text{off},k}$. Estimate the peak current by $i_{\\text{pk},k} = \\dfrac{(v_{o,k} - v_{\\text{in},k})}{L} \\, t_{\\text{off},k}$. Compute the desired average input current $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, set the commanded peak $i_{\\text{pk},k+1}^\\star = 2 \\, i_{\\text{avg},k+1}^\\star$, and schedule $t_{\\text{on},k+1} = \\dfrac{L}{v_{\\text{in},k+1}} \\, i_{\\text{pk},k+1}^\\star$, initiated at the zero-current detection event for valley switching.\n\nB. At the end of cycle $k$, sample $v_{\\text{in},k}$ and measure $t_{\\text{off},k}$. Estimate the peak current by $i_{\\text{pk},k} = \\dfrac{v_{\\text{in},k}}{L} \\, t_{\\text{off},k}$. Compute the desired average current $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, set $i_{\\text{pk},k+1}^\\star = i_{\\text{avg},k+1}^\\star$, and schedule $t_{\\text{on},k+1} = \\dfrac{L}{v_{\\text{in},k+1}} \\, i_{\\text{pk},k+1}^\\star$ at the next zero-current event.\n\nC. Use the previously measured ratio $\\rho_k = \\dfrac{t_{\\text{off},k}}{t_{\\text{on},k}}$ and assume it remains constant. Schedule $t_{\\text{on},k+1} = \\dfrac{t_{\\text{off},k}}{\\rho_k}$ and set $i_{\\text{pk},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, without using $v_{o,k}$, under the assumption that maintaining $\\rho_k$ yields input current proportional to $|v_{\\text{in}}|$.\n\nD. At the end of cycle $k$, estimate $i_{\\text{pk},k}$ by $i_{\\text{pk},k} = \\dfrac{(v_{o,k} - v_{\\text{in},k})}{L} \\, t_{\\text{off},k}$. For cycle $k+1$, compute $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$ and schedule $t_{\\text{on},k+1}$ to satisfy $i_{\\text{avg},k+1}^\\star = i_{\\text{pk},k+1} \\, \\dfrac{t_{\\text{on},k+1}}{t_{\\text{on},k+1} + t_{\\text{off},k}}$, i.e., $t_{\\text{on},k+1} = \\dfrac{i_{\\text{avg},k+1}^\\star}{i_{\\text{pk},k+1} - i_{\\text{avg},k+1}^\\star} \\, t_{\\text{off},k}$, where $i_{\\text{pk},k+1}$ is set equal to $i_{\\text{pk},k}$ for simplicity.",
            "solution": "The user has provided a problem concerning the digital control of a single-phase boost Power Factor Correction (PFC) rectifier operating in Critical Conduction Mode (CrCM). I will first validate the problem statement and then proceed to a full derivation and evaluation of the options.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **System**: Single-phase boost PFC rectifier.\n- **Operating Mode**: Critical Conduction Mode (CrCM), also known as Boundary Conduction Mode (BCM).\n- **Power Stage Model**: Ideal boost converter with inductance $L$. The switch and diode are ideal.\n- **Variables**: Input rectified voltage $v_{\\text{in}}(t)$, output voltage $v_o(t)$, inductor current $i_L(t)$, on-time $t_{\\text{on}}$, off-time $t_{\\text{off}}$.\n- **CrCM Definition**: The inductor current waveform is triangular, starting at $0$, rising to a peak $i_{\\text{pk}}$, and falling back to $0$ in each switching cycle $T_s = t_{\\text{on}} + t_{\\text{off}}$. The next cycle starts immediately upon the current reaching zero.\n- **Physical Law**: Inductor voltage-current relationship is $v_L = L \\frac{\\mathrm{d}i_L}{\\mathrm{d}t}$.\n- **Approximations**: The output voltage $v_o(t)$ is considered constant within a single switching cycle. By extension, the rectified input voltage $v_{\\text{in}}(t)$ is also considered constant over one high-frequency switching cycle.\n- **Controller Operation**: A digital controller performs the following actions:\n    1. Samples $v_{\\text{in}}$ and $v_o$ at switching transitions. The values for cycle $k$ are denoted $v_{\\text{in},k}$ and $v_{o,k}$.\n    2. Measures the off-time $t_{\\text{off},k}$ of cycle $k$.\n    3. Schedules the on-time $t_{\\text{on},k+1}$ for the subsequent cycle $k+1$.\n- **Control Objective**: An outer voltage loop provides a gain multiplier $K_k$. The controller must regulate the cycle-averaged input current for cycle $k+1$, denoted $i_{\\text{avg},k+1}^\\star$, to be proportional to the magnitude of the sampled input voltage for that cycle, $|v_{\\text{in},k+1}|$. The target relationship is given as $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$.\n\n**Step 2: Validate Using Extracted Givens**\n\n- **Scientifically Grounded**: Yes. The problem describes a standard and widely implemented power electronics circuit (CrCM boost PFC). The governing principles (inductor law) and operating mode are fundamental to the field.\n- **Well-Posed**: Yes. The problem provides a clear objective (derive a control algorithm) and sufficient physical and control parameters to formalize the required relationships. The existence of a unique and stable control law derived from these principles is expected.\n- **Objective**: Yes. The language is technical, precise, and free from subjective or ambiguous statements.\n\n**Step 3: Verdict and Action**\n\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. I will now proceed with the derivation of the solution.\n\n### Derivation of the Control Algorithm\n\nThe analysis is based on a single switching cycle, indexed by $k$. We assume that within this cycle, the input voltage is $v_{\\text{in},k}$ and the output voltage is $v_{o,k}$. Since the input is from a rectifier, $v_{\\text{in},k} \\geq 0$, so $|v_{\\text{in},k}| = v_{\\text{in},k}$.\n\n1.  **Inductor Current during On-Time ($t_{\\text{on},k}$)**:\n    When the main switch is on, the voltage across the inductor $L$ is $v_L = v_{\\text{in},k}$. The inductor current rises linearly from $0$ to its peak value $i_{\\text{pk},k}$.\n    $$ \\frac{\\mathrm{d}i_L}{\\mathrm{d}t} = \\frac{v_{\\text{in},k}}{L} $$\n    Integrating over the on-time interval $[0, t_{\\text{on},k}]$:\n    $$ i_{\\text{pk},k} - 0 = \\frac{v_{\\text{in},k}}{L} t_{\\text{on},k} \\implies i_{\\text{pk},k} = \\frac{v_{\\text{in},k}}{L} t_{\\text{on},k} \\quad (1) $$\n\n2.  **Inductor Current during Off-Time ($t_{\\text{off},k}$)**:\n    When the switch is off, the inductor current flows through the diode to the output. The voltage across the inductor is $v_L = v_{\\text{in},k} - v_{o,k}$. Since this is a boost converter, $v_{o,k} > v_{\\text{in},k}$, so $v_L$ is negative. The current falls linearly from $i_{\\text{pk},k}$ to $0$.\n    $$ \\frac{\\mathrm{d}i_L}{\\mathrm{d}t} = \\frac{v_{\\text{in},k} - v_{o,k}}{L} $$\n    Integrating over the off-time interval $[0, t_{\\text{off},k}]$:\n    $$ 0 - i_{\\text{pk},k} = \\frac{v_{\\text{in},k} - v_{o,k}}{L} t_{\\text{off},k} \\implies i_{\\text{pk},k} = \\frac{v_{o,k} - v_{\\text{in},k}}{L} t_{\\text{off},k} \\quad (2) $$\n    This equation provides a method to estimate the peak current $i_{\\text{pk},k}$ of a completed cycle using the measured values of $v_{\\text{in},k}$, $v_{o,k}$, and $t_{\\text{off},k}$.\n\n3.  **Cycle-Averaged Input Current**:\n    The input current to the boost stage is the inductor current, $i_{\\text{in}}(t) = i_L(t)$. The waveform of $i_L(t)$ over one switching period $T_{s,k} = t_{\\text{on},k} + t_{\\text{off},k}$ is a triangle with height $i_{\\text{pk},k}$ and base $T_{s,k}$. The average value of the input current over this cycle is:\n    $$ i_{\\text{avg},k} = \\frac{1}{T_{s,k}} \\int_0^{T_{s,k}} i_L(t) \\, \\mathrm{d}t = \\frac{\\text{Area of triangle}}{T_{s,k}} = \\frac{\\frac{1}{2} i_{\\text{pk},k} T_{s,k}}{T_{s,k}} = \\frac{1}{2} i_{\\text{pk},k} \\quad (3) $$\n    This establishes a critical relationship: the average current is half the peak current.\n\n4.  **Synthesizing the Predictive Control Law for Cycle $k+1$**:\n    The control objective for the next cycle, $k+1$, is $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$. Using the relationship from (3), the controller must target a specific peak current, $i_{\\text{pk},k+1}^\\star$:\n    $$ i_{\\text{pk},k+1}^\\star = 2 \\, i_{\\text{avg},k+1}^\\star = 2 \\, K_k \\, |v_{\\text{in},k+1}| \\quad (4) $$\n    The controller achieves this peak current by modulating the on-time, $t_{\\text{on},k+1}$. We use equation (1) for cycle $k+1$, assuming the applied voltage will be $v_{\\text{in},k+1}$:\n    $$ i_{\\text{pk},k+1}^\\star = \\frac{|v_{\\text{in},k+1}|}{L} t_{\\text{on},k+1} $$\n    Solving for the required on-time gives the control law:\n    $$ t_{\\text{on},k+1} = \\frac{L}{|v_{\\text{in},k+1}|} i_{\\text{pk},k+1}^\\star \\quad (5) $$\n\nThe complete algorithm, based on the problem statement, should therefore perform the following steps:\n- **Estimation (for cycle $k$)**: Use measured $t_{\\text{off},k}$, $v_{o,k}$, and $v_{\\text{in},k}$ to calculate $i_{\\text{pk},k}$ via equation (2).\n- **Scheduling (for cycle $k+1$)**:\n    a. Determine the target average current $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$.\n    b. Convert this to a target peak current $i_{\\text{pk},k+1}^\\star = 2 \\, i_{\\text{avg},k+1}^\\star$.\n    c. Calculate the necessary on-time $t_{\\text{on},k+1}$ using equation (5).\n\n### Option-by-Option Analysis\n\n**A. At the end of cycle $k$, sample $v_{\\text{in},k}$ and $v_{o,k}$ at turn-off and measure $t_{\\text{off},k}$. Estimate the peak current by $i_{\\text{pk},k} = \\dfrac{(v_{o,k} - v_{\\text{in},k})}{L} \\, t_{\\text{off},k}$. Compute the desired average input current $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, set the commanded peak $i_{\\text{pk},k+1}^\\star = 2 \\, i_{\\text{avg},k+1}^\\star$, and schedule $t_{\\text{on},k+1} = \\dfrac{L}{v_{\\text{in},k+1}} \\, i_{\\text{pk},k+1}^\\star$, initiated at the zero-current detection event for valley switching.**\n\n- The estimation of $i_{\\text{pk},k}$ matches equation (2). This is **Correct**.\n- The definition of $i_{\\text{avg},k+1}^\\star$ is as given in the problem. This is **Correct**.\n- The calculation of the target peak current $i_{\\text{pk},k+1}^\\star = 2 \\, i_{\\text{avg},k+1}^\\star$ matches equation (3). This is **Correct**.\n- The calculation of the required on-time $t_{\\text{on},k+1}$ matches equation (5) (noting $|v_{\\text{in},k+1}|=v_{\\text{in},k+1}$ for rectified voltage). This is **Correct**.\n- The final statement about ZCD initiation is consistent with CrCM operation. This is **Correct**.\nThe algorithm described in this option is a complete and accurate implementation of the required predictive control scheme.\n**Verdict: Correct**\n\n**B. At the end of cycle $k$, sample $v_{\\text{in},k}$ and measure $t_{\\text{off},k}$. Estimate the peak current by $i_{\\text{pk},k} = \\dfrac{v_{\\text{in},k}}{L} \\, t_{\\text{off},k}$. Compute the desired average current $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, set $i_{\\text{pk},k+1}^\\star = i_{\\text{avg},k+1}^\\star$, and schedule $t_{\\text{on},k+1} = \\dfrac{L}{v_{\\text{in},k+1}} \\, i_{\\text{pk},k+1}^\\star$ at the next zero-current event.**\n\n- The estimation of $i_{\\text{pk},k}$ is given as $i_{\\text{pk},k} = \\dfrac{v_{\\text{in},k}}{L} t_{\\text{off},k}$. This formula incorrectly uses the on-time inductor voltage ($v_{\\text{in},k}$) with the off-time duration ($t_{\\text{off},k}$). The correct formula is given by equation (2). This is **Incorrect**.\n- The target peak current is set as $i_{\\text{pk},k+1}^\\star = i_{\\text{avg},k+1}^\\star$. This violates the physical relationship for a triangular waveform, which is $i_{\\text{pk}} = 2 \\, i_{\\text{avg}}$. This is **Incorrect**.\nThis option contains at least two fundamental errors.\n**Verdict: Incorrect**\n\n**C. Use the previously measured ratio $\\rho_k = \\dfrac{t_{\\text{off},k}}{t_{\\text{on},k}}$ and assume it remains constant. Schedule $t_{\\text{on},k+1} = \\dfrac{t_{\\text{off},k}}{\\rho_k}$ and set $i_{\\text{pk},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, without using $v_{o,k}$, under the assumption that maintaining $\\rho_k$ yields input current proportional to $|v_{\\text{in}}|$.**\n\n- The scheduling rule proposed is $t_{\\text{on},k+1} = \\frac{t_{\\text{off},k}}{\\rho_k} = \\frac{t_{\\text{off},k}}{t_{\\text{off},k}/t_{\\text{on},k}} = t_{\\text{on},k}$. This describes a \"constant on-time\" control strategy. While this method can achieve PFC, it is a different control scheme than the one implied by the problem's cycle-by-cycle command $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$, which requires calculating a new on-time for each cycle based on the instantaneous voltage.\n- The option then states \"set $i_{\\text{pk},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$\". This is flawed. The problem defines $K_k \\, |v_{\\text{in},k+1}|$ as the target *average* current, not the *peak* current. This contradicts the given information and the physical relationship $i_{\\text{pk}} = 2 \\, i_{\\text{avg}}$. This is **Incorrect**.\nThe option conflates two different control methods and contains a factual error regarding the target current.\n**Verdict: Incorrect**\n\n**D. At the end of cycle $k$, estimate $i_{\\text{pk},k}$ by $i_{\\text{pk},k} = \\dfrac{(v_{o,k} - v_{\\text{in},k})}{L} \\, t_{\\text{off},k}$. For cycle $k+1$, compute $i_{\\text{avg},k+1}^\\star = K_k \\, |v_{\\text{in},k+1}|$ and schedule $t_{\\text{on},k+1}$ to satisfy $i_{\\text{avg},k+1}^\\star = i_{\\text{pk},k+1} \\, \\dfrac{t_{\\text{on},k+1}}{t_{\\text{on},k+1} + t_{\\text{off},k}}$, i.e., $t_{\\text{on},k+1} = \\dfrac{i_{\\text{avg},k+1}^\\star}{i_{\\text{pk},k+1} - i_{\\text{avg},k+1}^\\star} \\, t_{\\text{off},k}$, where $i_{\\text{pk},k+1}$ is set equal to $i_{\\text{pk},k}$ for simplicity.**\n\n- The formula proposed for the average current, $i_{\\text{avg}} = i_{\\text{pk}} \\frac{t_{\\text{on}}}{t_{\\text{on}} + t_{\\text{off}}}$, is physically incorrect. The correct relationship is $i_{\\text{avg}} = \\frac{1}{2} i_{\\text{pk}}$. The proposed formula actually describes the average current through the switch, not the average input current. This is **Incorrect**.\n- The assumption \"$i_{\\text{pk},k+1}$ is set equal to $i_{\\text{pk},k}$ for simplicity\" is fundamentally incompatible with the goal of PFC. PFC requires the average input current to follow the sinusoidal shape of the input voltage. This means the peak current $i_{\\text{pk}}$ must also vary sinusoidally over the line half-cycle. Assuming a constant peak current from one cycle to the next would result in a constant average input current, leading to a very poor power factor. This is **Incorrect**.\nThis option is based on an incorrect physical formula and an assumption that defeats the purpose of the controller.\n**Verdict: Incorrect**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}