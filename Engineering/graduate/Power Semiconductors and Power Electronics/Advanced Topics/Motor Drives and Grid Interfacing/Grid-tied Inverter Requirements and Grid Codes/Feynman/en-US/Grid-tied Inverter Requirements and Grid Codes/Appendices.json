{
    "hands_on_practices": [
        {
            "introduction": "The first step in designing or analyzing a grid-tied inverter is to translate grid code specifications into tangible engineering values. This exercise focuses on a core competency: converting a fault current injection requirement from the per-unit ($pu$) system, the standard language of power systems, into its physical equivalent in amperes. Mastering this fundamental conversion is crucial for correctly dimensioning components and setting control system references, as demonstrated in this problem .",
            "id": "3844416",
            "problem": "A three-phase grid-tied voltage-source inverter is connected through a transformer to a medium-voltage utility at the Point of Common Coupling (PCC). The grid is modeled by a positive-sequence Thevenin source with open-circuit phase-to-neutral voltage equal to the nominal phase voltage and by sequence Thevenin impedances. Under a single-line-to-ground fault on phase $a$ at the PCC with non-zero fault impedance, the three sequence networks are in series. The inverter follows Low-Voltage Ride-Through (LVRT) requirements and employs a Phase-Locked Loop (PLL) to track the positive-sequence grid voltage phasor. The grid code mandates that, for the duration of the voltage sag, the inverter must inject purely reactive positive-sequence current of prescribed magnitude relative to its rated current.\n\nData:\n- Inverter rated apparent power $S_{\\mathrm{rated}} = 4.0 \\times 10^{6}\\,\\mathrm{VA}$ and nominal line-to-line root-mean-square (RMS) voltage at the PCC $V_{\\mathrm{LL,nom}} = 11.0 \\times 10^{3}\\,\\mathrm{V}$.\n- The grid Thevenin sequence impedances referred to the PCC are $Z_{1} = j\\,0.8\\,\\Omega$, $Z_{2} = j\\,0.8\\,\\Omega$, and $Z_{0} = j\\,2.4\\,\\Omega$.\n- The single-line-to-ground fault impedance is $Z_{\\mathrm{f}} = 0.2\\,\\Omega$ on phase $a$ at the PCC.\n- The Thevenin positive-sequence open-circuit phase voltage magnitude is equal to the nominal phase RMS voltage $E_{1} = V_{\\mathrm{LL,nom}}/\\sqrt{3}$.\n- The inverter’s maximum current capability is $1.5$ per unit (pu), and the grid code requires the inverter to inject $I_{\\mathrm{fault}} = 1.2$ pu of reactive positive-sequence current for $150\\,\\mathrm{ms}$ during the fault, referenced to the inverter’s rated current.\n\nAssume the inverter does not inject zero-sequence current due to transformer connection constraints, and that its current controller can track the commanded magnitude without dynamic error at the timescale considered. Using fundamental definitions of the per-unit system and symmetrical components for a single-line-to-ground fault, determine the commanded fault current magnitude (RMS per phase) that the inverter must inject at the PCC. Express the final current in amperes and round your answer to four significant figures.",
            "solution": "The problem statement has been evaluated and is determined to be valid. It is scientifically grounded in the principles of power system analysis, specifically symmetrical components and per-unit systems. The data provided are self-contained, consistent, and physically realistic. The problem is well-posed, leading to a unique and meaningful solution. While superfluous information is provided, it serves as context for the scenario and does not create contradictions.\n\nThe objective is to determine the magnitude of the commanded positive-sequence fault current, which the inverter must inject at the Point of Common Coupling (PCC), expressed in amperes (RMS).\n\nThe grid code requirement, as stated in the problem, dictates that the inverter must inject a purely reactive positive-sequence current with a specific magnitude during the voltage sag. This magnitude is given in the per-unit (pu) system as:\n$$I_{\\mathrm{fault}} = 1.2\\,\\mathrm{pu}$$\nThis commanded current is referenced to the inverter's rated current. Therefore, to convert this per-unit value into amperes, we must first establish the base current, $I_{\\mathrm{base}}$, for the per-unit system.\n\nThe base current, $I_{\\mathrm{base}}$, is defined as the inverter's rated RMS current, $I_{\\mathrm{rated}}$. This can be calculated from the inverter's three-phase rated apparent power, $S_{\\mathrm{rated}}$, and the nominal line-to-line RMS voltage at the PCC, $V_{\\mathrm{LL,nom}}$. The fundamental relationship for three-phase power is:\n$$S_{\\mathrm{rated}} = \\sqrt{3} \\times V_{\\mathrm{LL,nom}} \\times I_{\\mathrm{rated}}$$\n\nFrom this relationship, we can solve for the rated current, which serves as our base current:\n$$I_{\\mathrm{base}} = I_{\\mathrm{rated}} = \\frac{S_{\\mathrm{rated}}}{\\sqrt{3} V_{\\mathrm{LL,nom}}}$$\n\nThe problem provides the following values:\n- Inverter rated apparent power: $S_{\\mathrm{rated}} = 4.0 \\times 10^{6}\\,\\mathrm{VA}$\n- Nominal line-to-line RMS voltage: $V_{\\mathrm{LL,nom}} = 11.0 \\times 10^{3}\\,\\mathrm{V}$\n\nSubstituting these values into the expression for the base current:\n$$I_{\\mathrm{base}} = \\frac{4.0 \\times 10^{6}}{\\sqrt{3} \\times 11.0 \\times 10^{3}}\\,\\mathrm{A}$$\n$$I_{\\mathrm{base}} = \\frac{4000}{11\\sqrt{3}}\\,\\mathrm{A}$$\n\nNow, we can find the magnitude of the commanded fault current in amperes, which we denote as $I_{\\mathrm{cmd}}$, by multiplying the per-unit value by the base current:\n$$I_{\\mathrm{cmd}} = I_{\\mathrm{fault}} \\times I_{\\mathrm{base}}$$\n\nSubstituting the given per-unit value and the calculated base current:\n$$I_{\\mathrm{cmd}} = 1.2 \\times \\frac{4000}{11\\sqrt{3}}\\,\\mathrm{A}$$\n$$I_{\\mathrm{cmd}} = \\frac{4800}{11\\sqrt{3}}\\,\\mathrm{A}$$\n\nTo obtain the numerical value, we compute the expression:\n$$I_{\\mathrm{cmd}} \\approx \\frac{4800}{11 \\times 1.7320508}\\,\\mathrm{A} \\approx \\frac{4800}{19.0525588}\\,\\mathrm{A} \\approx 251.92097\\,\\mathrm{A}$$\n\nThe problem requires the answer to be rounded to four significant figures.\n$$I_{\\mathrm{cmd}} \\approx 251.9\\,\\mathrm{A}$$\n\nIt is important to note that much of the data provided in the problem statement is contextual and not required for this specific calculation. The sequence impedances ($Z_{1}$, $Z_{2}$, $Z_{0}$), the fault impedance ($Z_{\\mathrm{f}}$), and the fault duration ($150\\,\\mathrm{ms}$) describe the nature of the single-line-to-ground fault that triggers the Low-Voltage Ride-Through (LVRT) response. However, the magnitude of the inverter's response (the commanded current injection) is explicitly defined by the grid code requirement ($1.2\\,\\mathrm{pu}$) and not derived from a dynamic analysis of the fault itself. The inverter's maximum current capability of $1.5\\,\\mathrm{pu}$ simply confirms that the commanded injection of $1.2\\,\\mathrm{pu}$ is within the device's operational limits. The question asks for the commanded current, which is a given parameter, and its conversion to amperes depends only on the inverter's nameplate ratings.",
            "answer": "$$\\boxed{251.9}$$"
        },
        {
            "introduction": "Modern grid codes require inverters to behave predictably even under unbalanced grid voltage conditions. This practice moves from basic calculations to control design, showing how the theory of symmetrical components can be used to engineer an inverter's response. You will determine the necessary level of negative-sequence current suppression needed to maintain compliance, illustrating the direct link between a controller's internal parameters and its external performance requirements .",
            "id": "3844430",
            "problem": "A three-phase grid-tied inverter connected at the Point of Common Coupling (PCC) operates under sinusoidal steady-state and employs a linear dual-sequence current control architecture. Under the principle of symmetrical components, an unbalanced three-phase quantity decomposes into positive-sequence and negative-sequence components that excite decoupled sequence networks in any linear, time-invariant system. The inverter’s closed-loop behavior with respect to small perturbations at the PCC can therefore be modeled for each sequence by an effective admittance mapping from the corresponding sequence voltage to the injected sequence current. Denote the positive-sequence voltage magnitude by $V_{1}$ and the negative-sequence voltage magnitude by $V_{2}$, with the associated injected current magnitudes $I_{1}$ and $I_{2}$, and define the closed-loop sequence admittances $Y_{1}$ and $Y_{2}$ via the relations $I_{1} = Y_{1} V_{1}$ and $I_{2} = Y_{2} V_{2}$. A representative grid code requires the ratio of negative-sequence to positive-sequence current to satisfy $I_{2}/I_{1} < \\delta$ for any admissible operating condition, where $\\delta$ is a prescribed limit.\n\nAssume the grid presents a fixed voltage unbalance at the PCC characterized by $V_{2}/V_{1} = \\epsilon$, with $\\epsilon = 0.03$, and that the compliance requirement is $\\delta = 0.02$. Using the decoupling of sequence networks and the definitions above, derive the minimal negative-sequence current suppression factor $S$, defined as $S \\equiv Y_{1}/Y_{2}$, such that the inverter is guaranteed to meet the requirement $I_{2}/I_{1} < \\delta$ whenever the grid unbalance equals $V_{2}/V_{1} = \\epsilon$. Express your final answer as a dimensionless multiplicative factor. No rounding is required.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n### Step 1: Extract Givens\n-   **System**: A three-phase grid-tied inverter operating in sinusoidal steady-state.\n-   **Control Model**: Decoupled sequence networks based on symmetrical components.\n-   **Positive-Sequence Relation**: The relationship between the positive-sequence injected current magnitude, $I_{1}$, and the positive-sequence voltage magnitude, $V_{1}$, is given by $I_{1} = Y_{1} V_{1}$, where $Y_{1}$ is the magnitude of the closed-loop positive-sequence admittance.\n-   **Negative-Sequence Relation**: The relationship between the negative-sequence injected current magnitude, $I_{2}$, and the negative-sequence voltage magnitude, $V_{2}$, is given by $I_{2} = Y_{2} V_{2}$, where $Y_{2}$ is the magnitude of the closed-loop negative-sequence admittance.\n-   **Grid Code Requirement**: The ratio of negative-sequence to positive-sequence current magnitude must satisfy $\\frac{I_{2}}{I_{1}} < \\delta$.\n-   **Grid Voltage Condition**: The grid exhibits a fixed voltage unbalance at the Point of Common Coupling (PCC) characterized by the ratio $\\frac{V_{2}}{V_{1}} = \\epsilon$.\n-   **Suppression Factor Definition**: The negative-sequence current suppression factor is defined as $S \\equiv \\frac{Y_{1}}{Y_{2}}$.\n-   **Numerical Values**: The prescribed limit for current unbalance is $\\delta = 0.02$. The grid voltage unbalance factor is $\\epsilon = 0.03$.\n-   **Objective**: To derive the minimal value of the suppression factor, $S$, that guarantees the inverter meets the grid code requirement under the specified grid voltage condition.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientific Grounding**: The problem is based on the theory of symmetrical components, a fundamental and standard method for analyzing unbalanced three-phase power systems. The concept of modeling an inverter's closed-loop behavior with sequence admittances is a well-established and correct practice in power electronics and power systems engineering. All concepts are scientifically sound.\n-   **Well-Posedness**: The problem provides clear definitions for all variables and constants. The relationships are linear and algebraically defined, leading to a unique solution for the specified boundary condition. The objective is clearly stated.\n-   **Objectivity**: The problem is stated in precise, technical language, free from any subjectivity or ambiguity.\n-   **Completeness and Consistency**: All necessary data ($\\epsilon$, $\\delta$) and definitions ($Y_1, Y_2, S$) are provided. The definitions are internally consistent and sufficient to solve for the unknown quantity.\n-   **Realism**: The numerical values for voltage unbalance ($\\epsilon = 3\\%$) and the current injection limit ($\\delta = 2\\%$) are realistic and representative of values found in international grid codes and standards for distributed energy resources.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a well-posed, scientifically grounded problem in electrical engineering that tests the understanding of inverter control under unbalanced grid conditions. A rigorous solution can be formulated.\n\n### Solution Derivation\nThe objective is to determine the minimal value of the negative-sequence current suppression factor $S$ that ensures compliance with a grid code requirement under a specific grid voltage unbalance.\n\nThe fundamental relationships between the sequence component magnitudes of voltage and current are given as:\n$$I_{1} = Y_{1} V_{1}$$\n$$I_{2} = Y_{2} V_{2}$$\nHere, $Y_{1}$ and $Y_{2}$ are the magnitudes of the effective admittances for the positive and negative sequences, respectively. These are assumed to be positive real numbers.\n\nThe grid code requirement imposes an upper limit on the ratio of the negative-sequence current magnitude to the positive-sequence current magnitude:\n$$\\frac{I_{2}}{I_{1}} < \\delta$$\n\nTo analyze this requirement, we first express the ratio $\\frac{I_{2}}{I_{1}}$ using the given admittance relationships:\n$$\\frac{I_{2}}{I_{1}} = \\frac{Y_{2} V_{2}}{Y_{1} V_{1}}$$\n\nThis expression can be rearranged to group the ratios of admittances and voltages:\n$$\\frac{I_{2}}{I_{1}} = \\left(\\frac{Y_{2}}{Y_{1}}\\right) \\left(\\frac{V_{2}}{V_{1}}\\right)$$\n\nThe problem defines the negative-sequence current suppression factor as $S \\equiv \\frac{Y_{1}}{Y_{2}}$. Therefore, the ratio of the sequence admittances can be expressed as $\\frac{Y_{2}}{Y_{1}} = \\frac{1}{S}$. The grid's voltage unbalance is given as $\\frac{V_{2}}{V_{1}} = \\epsilon$. Substituting these definitions into the equation for the current ratio yields:\n$$\\frac{I_{2}}{I_{1}} = \\frac{1}{S} \\cdot \\epsilon = \\frac{\\epsilon}{S}$$\n\nNow, we enforce the grid code requirement on this expression:\n$$\\frac{\\epsilon}{S} < \\delta$$\n\nWe need to find the minimal value of $S$ that guarantees this inequality is satisfied. Since $S$, $\\epsilon$, and $\\delta$ are all positive quantities, we can rearrange the inequality without changing its direction:\n$$\\epsilon < S \\cdot \\delta$$\n$$S > \\frac{\\epsilon}{\\delta}$$\n\nThis inequality states that for the inverter to be compliant, the suppression factor $S$ must be strictly greater than the ratio of the voltage unbalance factor $\\epsilon$ to the current unbalance limit $\\delta$. The set of all compliant values for $S$ is the open interval $\\left(\\frac{\\epsilon}{\\delta}, \\infty\\right)$.\n\nThe problem asks for the \"minimal\" value of $S$. In the context of such boundary value problems in science and engineering, \"minimal\" refers to the infimum, or the greatest lower bound, of the set of allowed values. This boundary value represents the threshold for compliance. Therefore, the minimal required suppression factor, which we can denote $S_{min}$, is:\n$$S_{min} = \\frac{\\epsilon}{\\delta}$$\n\nAny value of $S > S_{min}$ will guarantee compliance. The value $S_{min}$ itself represents the critical boundary.\n\nFinally, we substitute the provided numerical values, $\\epsilon = 0.03$ and $\\delta = 0.02$:\n$$S_{min} = \\frac{0.03}{0.02} = \\frac{3}{2} = 1.5$$\n\nThus, the inverter's positive-sequence admittance must be at least $1.5$ times its negative-sequence admittance to ensure that the negative-sequence current injection remains below the $2\\%$ limit when the grid voltage unbalance is $3\\%$.",
            "answer": "$$\\boxed{1.5}$$"
        },
        {
            "introduction": "Real-world inverter control involves more than meeting a single objective; it requires managing multiple, often competing, requirements within strict hardware limits. This capstone practice challenges you to design a comprehensive fault-ride-through algorithm that prioritizes reactive power support while also mitigating voltage unbalance, all without exceeding the inverter's current rating. This exercise  encapsulates the essence of advanced power electronics control design: implementing a robust, prioritized strategy to ensure both grid code compliance and equipment safety.",
            "id": "3844445",
            "problem": "A three-phase grid-tied voltage source converter must comply with voltage dip support requirements specified by grid codes while protecting its power semiconductors and the interfacing transformer from overcurrent. The converter can control positive- and negative-sequence currents independently using sequence-domain controllers. Design and implement an algorithm that, given three-phase voltage phasors and parameter limits, computes sequence-domain current references that (i) inject positive-sequence reactive current according to a slope requirement proportional to the voltage depression and (ii) provide negative-sequence current proportional to the measured negative-sequence voltage, while ensuring that the combined current magnitude respects the available current capability.\n\nThe following foundational facts and definitions apply and must be used to derive the strategy:\n\n- Symmetrical components: For complex phasors $V_a$, $V_b$, $V_c$ representing phase-to-neutral voltages with angles in radians, the operator $a = e^{j \\frac{2\\pi}{3}}$. The positive-sequence voltage is $V_1 = \\frac{1}{3}(V_a + a V_b + a^2 V_c)$ and the negative-sequence voltage is $V_2 = \\frac{1}{3}(V_a + a^2 V_b + a V_c)$. Zero-sequence is neglected due to transformer grounding and converter topology suppression assumptions. All phasors are expressed in per-unit.\n- Complex power for three-phase systems: $S = P + jQ = 3 V I^*$, where $V$ and $I$ are the per-phase phasors of the sequence component considered, $P$ is active power, and $Q$ is reactive power. Reactive support without active power corresponds to current orthogonal to voltage, that is, $I$ rotated by $\\pm \\frac{\\pi}{2}$ relative to $V$.\n- Current capability limit: To avoid overcurrent in both converter and transformer, the available current limit is $I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$, where $I_{\\text{conv,max}}$ is the converter current capability and $I_{\\text{tr,max}}$ is the transformer current capability. The combined positive- and negative-sequence current magnitudes are constrained by the root-sum-square relation $|I_1|^2 + |I_2|^2 \\le I_{\\text{cap}}^2$.\n\nThe strategy must be derived from the above bases and implemented as follows:\n\n1. Compute $V_1$ and $V_2$ from the given $V_a$, $V_b$, and $V_c$.\n2. Positive-sequence reactive current requirement: Define the required positive-sequence reactive current magnitude as $i_{q1}^{\\text{req}} = k_r \\max(0, 1 - |V_1|)$, where $k_r$ is the grid code slope parameter. Set the raw positive-sequence current phasor to be orthogonal to $V_1$ such that it injects reactive power into the grid without active power exchange: $I_1^{\\text{raw}} = -j\\, i_{q1}^{\\text{req}} \\frac{V_1}{|V_1|}$ if $|V_1| > \\epsilon$, and $I_1^{\\text{raw}} = -j\\, i_{q1}^{\\text{req}}$ if $|V_1| \\le \\epsilon$, where $\\epsilon$ is a small positive threshold for numerical stability. Angles are in radians.\n3. Negative-sequence mitigation: Define a virtual negative-sequence admittance $Y_2 = G_2 + j B_2$ and compute the raw negative-sequence current as $I_2^{\\text{raw}} = Y_2 V_2$.\n4. Current allocation under limit: Let $I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$. If $|I_1^{\\text{raw}}| \\ge I_{\\text{cap}}$, scale $I_1 = I_1^{\\text{raw}} \\frac{I_{\\text{cap}}}{|I_1^{\\text{raw}}|}$ and set $I_2 = 0$. Otherwise, set $I_1 = I_1^{\\text{raw}}$ and compute headroom $h = \\sqrt{I_{\\text{cap}}^2 - |I_1|^2}$. If $|I_2^{\\text{raw}}| \\le h$, set $I_2 = I_2^{\\text{raw}}$; else scale $I_2 = I_2^{\\text{raw}} \\frac{h}{|I_2^{\\text{raw}}|}$. Report a boolean flag indicating whether any scaling occurred due to limits.\n\nAll quantities are in per-unit, and all angles are in radians. Your program must implement the above algorithm, operate on the test suite below, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of the form $[|I_1|, |I_2|, \\text{over\\_limit}]$, where $|I_1|$ and $|I_2|$ are the magnitudes of the allocated positive- and negative-sequence current references in per-unit, and $\\text{over\\_limit}$ is a boolean indicating whether any scaling was applied due to current limits.\n\nUse the following test suite with scientifically plausible parameters:\n\n- Case 1 (balanced voltage dip, happy path): $|V_a| = 0.8$, $\\angle V_a = 0$, $|V_b| = 0.8$, $\\angle V_b = -\\frac{2\\pi}{3}$, $|V_c| = 0.8$, $\\angle V_c = +\\frac{2\\pi}{3}$, $k_r = 1.5$, $G_2 = 0.0$, $B_2 = 0.0$, $I_{\\text{conv,max}} = 1.0$, $I_{\\text{tr,max}} = 1.2$.\n- Case 2 (moderate unbalance with negative-sequence support): $|V_a| = 0.7$, $\\angle V_a = 0$, $|V_b| = 1.0$, $\\angle V_b = -\\frac{2\\pi}{3}$, $|V_c| = 1.0$, $\\angle V_c = +\\frac{2\\pi}{3}$, $k_r = 1.5$, $G_2 = 0.5$, $B_2 = 0.0$, $I_{\\text{conv,max}} = 0.8$, $I_{\\text{tr,max}} = 1.0$.\n- Case 3 (deep balanced dip, positive-sequence saturates): $|V_a| = 0.2$, $\\angle V_a = 0$, $|V_b| = 0.2$, $\\angle V_b = -\\frac{2\\pi}{3}$, $|V_c| = 0.2$, $\\angle V_c = +\\frac{2\\pi}{3}$, $k_r = 2.0$, $G_2 = 0.0$, $B_2 = 0.0$, $I_{\\text{conv,max}} = 0.5$, $I_{\\text{tr,max}} = 1.0$.\n- Case 4 (strong unbalance, negative-sequence limited by headroom): $|V_a| = 1.0$, $\\angle V_a = 0$, $|V_b| = 0.6$, $\\angle V_b = -\\frac{2\\pi}{3}$, $|V_c| = 1.0$, $\\angle V_c = +\\frac{2\\pi}{3}$, $k_r = 0.5$, $G_2 = 2.0$, $B_2 = 0.0$, $I_{\\text{conv,max}} = 0.6$, $I_{\\text{tr,max}} = 0.7$.\n- Case 5 (zero voltage edge case): $|V_a| = 0.0$, $\\angle V_a = 0$, $|V_b| = 0.0$, $\\angle V_b = -\\frac{2\\pi}{3}$, $|V_c| = 0.0$, $\\angle V_c = +\\frac{2\\pi}{3}$, $k_r = 1.0$, $G_2 = 1.0$, $B_2 = 0.0$, $I_{\\text{conv,max}} = 0.3$, $I_{\\text{tr,max}} = 0.4$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[[r_{11}, r_{12}, r_{13}], [r_{21}, r_{22}, r_{23}], \\dots]$, where each $r_{ij}$ is one of the requested output components for case $i$.",
            "solution": "The problem statement has been critically examined and is determined to be valid. It is scientifically grounded in the principles of electrical engineering, specifically three-phase power systems and power electronics control. The problem is well-posed, objective, and provides a clear, computationally tractable algorithm with all necessary parameters specified. There are no contradictions, ambiguities, or unrealistic assumptions that would invalidate the problem. Therefore, a solution will be provided.\n\nThe core of the problem is to design a current reference generation algorithm for a grid-tied voltage source converter that simultaneously provides voltage support during grid faults and protects itself from overcurrent. The solution follows the specified four-step procedure. A small numerical stability threshold $\\epsilon = 10^{-6}$ will be used for calculations involving division by voltage magnitude.\n\nFirst, we define the symmetrical component transformation operator $a = e^{j \\frac{2\\pi}{3}}$. All phasors are complex numbers, and all quantities are in per-unit (p.u.) unless stated otherwise.\n\nStep 1: Compute Symmetrical Components of Voltage\nGiven the three-phase-to-neutral voltage phasors $V_a$, $V_b$, and $V_c$, we first convert them from polar form (magnitude and angle) to rectangular form.\n$V_k = |V_k| e^{j \\angle V_k} = |V_k|(\\cos(\\angle V_k) + j \\sin(\\angle V_k))$ for $k \\in \\{a, b, c\\}$.\n\nThe positive-sequence voltage, $V_1$, and negative-sequence voltage, $V_2$, are calculated using the standard symmetrical component transformation formulas. The zero-sequence component is neglected as per the problem statement.\n$$V_1 = \\frac{1}{3}(V_a + a V_b + a^2 V_c)$$\n$$V_2 = \\frac{1}{3}(V_a + a^2 V_b + a V_c)$$\n$V_1$ represents the balanced, positive-sequence (phase order a-b-c) component of the three-phase system, which is the component responsible for useful power transfer in a conventional grid. $V_2$ represents the unbalanced, negative-sequence (phase order a-c-b) component, which arises during asymmetrical faults or with unbalanced loads and can cause issues like torque pulsations in motors and additional heating in equipment.\n\nStep 2: Compute Raw Positive-Sequence Current Reference\nGrid codes mandate that converters support the grid during voltage dips by injecting reactive current. The amount of reactive current is typically proportional to the depth of the voltage dip. The required magnitude of this current, $i_{q1}^{\\text{req}}$, is calculated as:\n$$i_{q1}^{\\text{req}} = k_r \\max(0, 1 - |V_1|)$$\nwhere $k_r$ is the reactive current support gain (slope) and $|V_1|$ is the magnitude of the positive-sequence voltage. The nominal voltage is $1$ p.u., so $(1 - |V_1|)$ represents the voltage dip magnitude.\n\nTo inject purely reactive power, the current phasor must be orthogonal to the voltage phasor. For injecting reactive power into the grid (inductive behavior from the grid's perspective), the current must lag the voltage by $90^\\circ$, which corresponds to multiplication by $-j$. The raw positive-sequence current reference, $I_1^{\\text{raw}}$, is thus oriented along the quadrature axis relative to $V_1$.\nTo obtain a unit vector in the direction of $V_1$, we compute $\\frac{V_1}{|V_1|}$. The current phasor is then:\n$$I_1^{\\text{raw}} = -j \\cdot i_{q1}^{\\text{req}} \\cdot \\frac{V_1}{|V_1|}$$\nA special case must be handled for numerical stability when $|V_1|$ is very small (e.g., during a three-phase short circuit near the converter terminals). If $|V_1| \\le \\epsilon$, where $\\epsilon$ is a small positive threshold (e.g., $10^{-6}$), the direction of $V_1$ is undefined. In this scenario, the problem specifies setting the raw current as:\n$$I_1^{\\text{raw}} = -j \\cdot i_{q1}^{\\text{req}}$$\nThis maintains the magnitude requirement while choosing a conventional phase angle ($ -90^\\circ $ or $ -\\frac{\\pi}{2} $ radians).\n\nStep 3: Compute Raw Negative-Sequence Current Reference\nTo mitigate voltage unbalance, the converter injects a negative-sequence current, $I_2$, that is proportional to the measured negative-sequence voltage, $V_2$. This behavior is modeled by a virtual negative-sequence admittance, $Y_2 = G_2 + j B_2$. The raw negative-sequence current reference, $I_2^{\\text{raw}}$, is calculated using Ohm's law in the sequence domain:\n$$I_2^{\\text{raw}} = Y_2 V_2 = (G_2 + j B_2) V_2$$\nTypically, $G_2 > 0$ and $B_2=0$ is chosen to damp the negative-sequence voltage by drawing a current that emulates a resistive path, thus consuming power associated with the negative-sequence component.\n\nStep 4: Allocate Currents Under Capability Limit\nThe converter's power semiconductors and the interfacing transformer have thermal limits, which translate to a maximum current magnitude. The total capability, $I_{\\text{cap}}$, is the minimum of the converter and transformer limits:\n$$I_{\\text{cap}} = \\min(I_{\\text{conv,max}}, I_{\\text{tr,max}})$$\nThe physical phase currents are the sum of sequence components, and their thermal effect is related to the root-sum-square of the sequence component magnitudes. Therefore, the final current references $I_1$ and $I_2$ must satisfy:\n$$|I_1|^2 + |I_2|^2 \\le I_{\\text{cap}}^2$$\nThe allocation strategy prioritizes positive-sequence reactive support ($I_1$) over negative-sequence mitigation ($I_2$), which is a common requirement in grid codes. A boolean flag, `over_limit`, will track if any current component is scaled down.\n\nFirst, the required positive-sequence current magnitude $|I_1^{\\text{raw}}|$ is compared against the total capability $I_{\\text{cap}}$.\n- If $|I_1^{\\text{raw}}| \\ge I_{\\text{cap}}$: The positive-sequence current demand alone saturates the converter. All available capacity is allocated to it. $I_1$ is scaled down to the limit, and $I_2$ is set to zero. The `over_limit` flag is set to `True`.\n$$I_1 = I_1^{\\text{raw}} \\frac{I_{\\text{cap}}}{|I_1^{\\text{raw}}|}$$\n$$I_2 = 0 + j0$$\n- If $|I_1^{\\text{raw}}| < I_{\\text{cap}}$: The full required positive-sequence current can be supplied.\n$$I_1 = I_1^{\\text{raw}}$$\nThe remaining current capacity, or \"headroom\" $h$, available for the negative-sequence component is calculated from the root-sum-square limit:\n$$h = \\sqrt{I_{\\text{cap}}^2 - |I_1|^2}$$\nNext, the required negative-sequence current $|I_2^{\\text{raw}}|$ is compared against this headroom $h$.\n    - If $|I_2^{\\text{raw}}| \\le h$: There is sufficient capacity for the full negative-sequence current.\n    $$I_2 = I_2^{\\text{raw}}$$\n    In this case, since no scaling of $I_1$ or $I_2$ has occurred, the `over_limit` flag is `False`.\n    - If $|I_2^{\\text{raw}}| > h$: The required negative-sequence current must be scaled down to fit within the available headroom. The `over_limit` flag is set to `True`.\n    $$I_2 = I_2^{\\text{raw}} \\frac{h}{|I_2^{\\text{raw}}|}$$\n\nThe final outputs for each test case are the magnitudes of the allocated currents, $|I_1|$ and $|I_2|$, and the boolean `over_limit` flag.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_current_references(Va_mag, Va_ang, Vb_mag, Vb_ang, Vc_mag, Vc_ang, kr, G2, B2, I_conv_max, I_tr_max):\n    \"\"\"\n    Computes sequence-domain current references based on grid support requirements.\n\n    Args:\n        Va_mag, Vb_mag, Vc_mag (float): Magnitudes of phase voltages (p.u.).\n        Va_ang, Vb_ang, Vc_ang (float): Angles of phase voltages (radians).\n        kr (float): Reactive current support gain.\n        G2 (float): Negative-sequence virtual conductance (p.u.).\n        B2 (float): Negative-sequence virtual susceptance (p.u.).\n        I_conv_max (float): Converter current capability (p.u.).\n        I_tr_max (float): Transformer current capability (p.u.).\n\n    Returns:\n        list: A list containing [|I1|, |I2|, over_limit].\n    \"\"\"\n    epsilon = 1e-6\n    over_limit = False\n\n    # Define symmetrical component operator 'a'\n    a = np.exp(1j * 2 * np.pi / 3)\n\n    # 1. Compute V1 and V2\n    Va = Va_mag * np.exp(1j * Va_ang)\n    Vb = Vb_mag * np.exp(1j * Vb_ang)\n    Vc = Vc_mag * np.exp(1j * Vc_ang)\n\n    V1 = (Va + a * Vb + a**2 * Vc) / 3.0\n    V2 = (Va + a**2 * Vb + a * Vc) / 3.0\n    \n    V1_mag = np.abs(V1)\n\n    # 2. Positive-sequence reactive current requirement\n    i_q1_req = kr * max(0, 1.0 - V1_mag)\n    \n    if V1_mag > epsilon:\n        I1_raw = -1j * i_q1_req * (V1 / V1_mag)\n    else:\n        I1_raw = -1j * i_q1_req\n        \n    I1_raw_mag = np.abs(I1_raw)\n\n    # 3. Negative-sequence mitigation\n    Y2 = G2 + 1j * B2\n    I2_raw = Y2 * V2\n    I2_raw_mag = np.abs(I2_raw)\n\n    # 4. Current allocation under limit\n    I_cap = min(I_conv_max, I_tr_max)\n    \n    # Initialize final currents\n    I1 = 0 + 0j\n    I2 = 0 + 0j\n\n    if I1_raw_mag >= I_cap:\n        # Positive-sequence current alone saturates the converter\n        if I1_raw_mag > 0: # Avoid division by zero\n            I1 = I1_raw * (I_cap / I1_raw_mag)\n        I2 = 0 + 0j\n        over_limit = True\n    else:\n        # Positive-sequence current fits, check headroom for negative-sequence\n        I1 = I1_raw\n        headroom = np.sqrt(I_cap**2 - np.abs(I1)**2)\n        \n        if I2_raw_mag = headroom:\n            # Negative-sequence current also fits\n            I2 = I2_raw\n            # over_limit remains False\n        else:\n            # Negative-sequence current must be scaled down\n            if I2_raw_mag > 0: # Avoid division by zero\n                I2 = I2_raw * (headroom / I2_raw_mag)\n            else:\n                I2 = 0 + 0j\n            over_limit = True\n\n    return [round(np.abs(I1), 6), round(np.abs(I2), 6), over_limit]\n\ndef solve():\n    \"\"\"\n    Main solver function to process all test cases.\n    \"\"\"\n    # Test suite from the problem statement\n    # Format: (Va_mag, Va_ang, Vb_mag, Vb_ang, Vc_mag, Vc_ang, kr, G2, B2, I_conv_max, I_tr_max)\n    test_cases = [\n        # Case 1 (balanced voltage dip, happy path)\n        (0.8, 0, 0.8, -2*np.pi/3, 0.8, 2*np.pi/3, 1.5, 0.0, 0.0, 1.0, 1.2),\n        # Case 2 (moderate unbalance with negative-sequence support)\n        (0.7, 0, 1.0, -2*np.pi/3, 1.0, 2*np.pi/3, 1.5, 0.5, 0.0, 0.8, 1.0),\n        # Case 3 (deep balanced dip, positive-sequence saturates)\n        (0.2, 0, 0.2, -2*np.pi/3, 0.2, 2*np.pi/3, 2.0, 0.0, 0.0, 0.5, 1.0),\n        # Case 4 (strong unbalance, negative-sequence limited by headroom)\n        (1.0, 0, 0.6, -2*np.pi/3, 1.0, 2*np.pi/3, 0.5, 2.0, 0.0, 0.6, 0.7),\n        # Case 5 (zero voltage edge case)\n        (0.0, 0, 0.0, -2*np.pi/3, 0.0, 2*np.pi/3, 1.0, 1.0, 0.0, 0.3, 0.4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_current_references(*case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # str() on a list produces a string '[item1, item2, ...]'\n    # We join these strings with commas and enclose the whole thing in brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}