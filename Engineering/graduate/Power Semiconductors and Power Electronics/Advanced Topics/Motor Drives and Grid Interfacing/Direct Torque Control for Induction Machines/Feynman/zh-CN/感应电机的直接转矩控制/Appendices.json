{
    "hands_on_practices": [
        {
            "introduction": "直接转矩控制（DTC）的核心是定子磁链观测器。一个简单而经典的实现是基于对反电动势的纯积分。本练习将探讨这种纯积分方法的一个关键实际问题：由于定子电阻估计值 $\\hat{R}_s$ 的不准确性（该参数会随温度变化），导致的磁链估计误差随时间累积，即产生积分漂移。通过从第一性原理推导此误差，您将深刻理解基本DTC方案在低速运行时的一个主要限制，并认识到精确参数辨识或高级观测器设计的重要性。",
            "id": "3835342",
            "problem": "考虑一个用于感应电机的静止参考系直接转矩控制 (DTC) 磁链观测器，该观测器在具有固定采样周期的电压源逆变器上实现。在静止$\\alpha\\beta$坐标系中，定子磁链（用矢量 $\\psi_{s}$ 表示）遵循根据定子绕组的基尔霍夫电压定律导出的定子电路方程，\n$$\nv_{s}(t) = R_{s}\\,i_{s}(t) + \\frac{d\\psi_{s}(t)}{dt},\n$$\n其中 $v_{s}(t)$ 是定子电压矢量，$i_{s}(t)$ 是定子电流矢量，$R_{s}$ 是真实的定子电阻。一个前向欧拉离散时间磁链观测器使用测量的 $v_{s}[k]$、$i_{s}[k]$ 和一个估计的定子电阻 $\\hat{R}_{s}$，根据以下公式来递推估计值 $\\hat{\\psi}_{s}[k]$：\n$$\n\\hat{\\psi}_{s}[k] = \\hat{\\psi}_{s}[k-1] + \\big(v_{s}[k] - \\hat{R}_{s}\\,i_{s}[k]\\big)\\,T_{s},\n$$\n其中 $T_{s}$ 是采样周期，$k$ 是离散时间索引。\n\n假设电机处于静止状态，并且由于所施加的逆变器状态，在$\\alpha$轴上存在恒定的直流励磁，从而产生一个恒定的定子电流矢量 $i_{s}[k] = \\begin{pmatrix} i_{0} \\\\ 0 \\end{pmatrix}$（对所有 $k$ 成立，且 $i_{0} > 0$）。在此恒定条件下，定子电压满足 $v_{s}[k] = R_{s}\\,i_{s}[k]$。观测器初始化为 $\\hat{\\psi}_{s}[0] = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n\n从连续时间定子电路方程和上述离散时间观测器的定义出发，根据第一性原理推导磁链估计误差矢量 $\\varepsilon_{\\psi}[k] \\triangleq \\hat{\\psi}_{s}[k] - \\psi_{s}[k]$ 的离散时间演化过程，并获得 $N$ 个采样后 $|\\varepsilon_{\\psi}[N]|$ 关于 $R_{s}$、$\\hat{R}_{s}$、$i_{0}$ 和 $T_{s}$ 的闭式表达式。使用该表达式计算在持续时间 $t = N\\,T_{s}$ 后磁链估计中的数值漂移幅值，参数如下：\n- $R_{s} = 0.87$ $\\Omega$,\n- $\\hat{R}_{s} = 0.75$ $\\Omega$,\n- $i_{0} = 0.15$ $\\mathrm{A}$,\n- $T_{s} = 50 \\times 10^{-6}$ $\\mathrm{s}$,\n- $t = 0.50$ $\\mathrm{s}$。\n\n将最终的磁链漂移幅值以 $\\mathrm{Wb}$ 为单位表示，并将答案四舍五入到四位有效数字。",
            "solution": "问题验证如下。\n\n### 步骤 1：提取已知条件\n- 连续时间定子电路方程：$v_{s}(t) = R_{s}\\,i_{s}(t) + \\frac{d\\psi_{s}(t)}{dt}$\n- 离散时间磁链观测器方程：$\\hat{\\psi}_{s}[k] = \\hat{\\psi}_{s}[k-1] + \\big(v_{s}[k] - \\hat{R}_{s}\\,i_{s}[k]\\big)\\,T_{s}$\n- 变量和常数：\n    - $\\psi_{s}(t)$: 静止$\\alpha\\beta$坐标系中的真实定子磁链矢量\n    - $v_{s}(t)$: 真实定子电压矢量\n    - $i_{s}(t)$: 真实定子电流矢量\n    - $R_{s}$: 真实定子电阻\n    - $\\hat{\\psi}_{s}[k]$: 估计的定子磁链矢量\n    - $\\hat{R}_{s}$: 估计的定子电阻\n    - $T_{s}$: 采样周期\n    - $k$: 离散时间索引\n- 条件：\n    - 电机处于静止状态。\n    - 在$\\alpha$轴上存在恒定的直流励磁。\n    - $i_{s}[k] = \\begin{pmatrix} i_{0} \\\\ 0 \\end{pmatrix}$ 对所有 $k$ 成立，且 $i_{0} > 0$。\n    - $v_{s}[k] = R_{s}\\,i_{s}[k]$。\n- 观测器的初始条件：$\\hat{\\psi}_{s}[0] = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n- 磁链估计误差的定义：$\\varepsilon_{\\psi}[k] \\triangleq \\hat{\\psi}_{s}[k] - \\psi_{s}[k]$。\n- 目标：推导 $\\varepsilon_{\\psi}[k]$ 的离散时间演化过程，找出其在 $N$ 个采样后的漂移幅值 $|\\varepsilon_{\\psi}[N]|$ 的闭式表达式，并对该幅值进行数值计算。\n- 数值参数：\n    - $R_{s} = 0.87$ $\\Omega$\n    - $\\hat{R}_{s} = 0.75$ $\\Omega$\n    - $i_{0} = 0.15$ $\\mathrm{A}$\n    - $T_{s} = 50 \\times 10^{-6}$ $\\mathrm{s}$\n    - $t = 0.50$ $\\mathrm{s}$\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，基于感应电机定子电路和直接转矩控制中离散时间观测器的标准模型。方程源于基本的电气原理。该问题提法明确，提供了所有必要的信息、定义和参数，并且“漂移”被标准地解释为随时间累积的误差分量。所描述的场景（静止状态下的直流励磁）是分析观测器性能的常见且现实的测试条件。语言客观且明确。所提供的参数在物理上是现实的。问题是自洽且内部一致的。关键的一致性在于，条件 $v_{s}[k] = R_{s}\\,i_{s}[k]$ 从连续时间方程中可以推导出 $\\frac{d\\psi_{s}(t)}{dt} = 0$，这意味着真实磁链是恒定的，这与直流稳态条件是一致的。\n\n### 步骤 3：结论和行动\n问题被认为是有效的。将提供完整的解答。\n\n### 推导与求解\n\n目标是确定在时间段 $t$ 内累积的磁链估计误差的幅值。我们首先分析真实定子磁链 $\\psi_{s}(t)$ 和估计定子磁链 $\\hat{\\psi}_{s}[k]$ 的动态特性。\n\n连续时间定子电压方程如下：\n$$\nv_{s}(t) = R_{s}\\,i_{s}(t) + \\frac{d\\psi_{s}(t)}{dt}\n$$\n问题陈述，对于一个恒定的定子电流矢量 $i_{s}(t) = i_{s}$，相应的定子电压为 $v_{s}(t) = R_{s}\\,i_{s}$。将此条件代入电压方程可得：\n$$\nR_{s}\\,i_{s} = R_{s}\\,i_{s} + \\frac{d\\psi_{s}(t)}{dt}\n$$\n这意味着 $\\frac{d\\psi_{s}(t)}{dt} = 0$。因此，在本次分析期间，真实定子磁链矢量 $\\psi_{s}(t)$ 是恒定的。令 $\\psi_{s}[k]$ 表示在时间 $t = k T_s$ 采样的真实磁链。由此可得：\n$$\n\\psi_{s}[k] = \\psi_{s}[k-1]\n$$\n对于所有 $k \\ge 1$。\n\n离散时间磁链观测器由以下递推关系定义：\n$$\n\\hat{\\psi}_{s}[k] = \\hat{\\psi}_{s}[k-1] + \\big(v_{s}[k] - \\hat{R}_{s}\\,i_{s}[k]\\big)\\,T_{s}\n$$\n磁链估计误差矢量定义为 $\\varepsilon_{\\psi}[k] \\triangleq \\hat{\\psi}_{s}[k] - \\psi_{s}[k]$。我们现在推导此误差的离散时间演化过程。从一个采样到下一个采样的误差变化为：\n$$\n\\varepsilon_{\\psi}[k] - \\varepsilon_{\\psi}[k-1] = (\\hat{\\psi}_{s}[k] - \\psi_{s}[k]) - (\\hat{\\psi}_{s}[k-1] - \\psi_{s}[k-1])\n$$\n整理各项，我们得到：\n$$\n\\varepsilon_{\\psi}[k] - \\varepsilon_{\\psi}[k-1] = (\\hat{\\psi}_{s}[k] - \\hat{\\psi}_{s}[k-1]) - (\\psi_{s}[k] - \\psi_{s}[k-1])\n$$\n从观测器方程中，我们代入右侧的第一项。根据我们对真实磁链的分析，第二项为零。\n$$\n\\varepsilon_{\\psi}[k] - \\varepsilon_{\\psi}[k-1] = \\big(v_{s}[k] - \\hat{R}_{s}\\,i_{s}[k]\\big)\\,T_{s} - 0\n$$\n现在，我们使用给定的条件 $v_{s}[k] = R_{s}\\,i_{s}[k]$：\n$$\n\\varepsilon_{\\psi}[k] - \\varepsilon_{\\psi}[k-1] = \\big(R_{s}\\,i_{s}[k] - \\hat{R}_{s}\\,i_{s}[k]\\big)\\,T_{s}\n$$\n这简化为误差演化的递推关系：\n$$\n\\varepsilon_{\\psi}[k] = \\varepsilon_{\\psi}[k-1] + (R_{s} - \\hat{R}_{s})\\,i_{s}[k]\\,T_{s}\n$$\n这是一个一阶差分方程。我们可以通过将递推从 $k=1$ 展开到 $N$ 来求解它：\n$$\n\\varepsilon_{\\psi}[N] = \\varepsilon_{\\psi}[0] + \\sum_{k=1}^{N} (R_{s} - \\hat{R}_{s})\\,i_{s}[k]\\,T_{s}\n$$\n问题陈述定子电流是恒定的，$i_{s}[k] = i_{s} = \\begin{pmatrix} i_{0} \\\\ 0 \\end{pmatrix}$。因此，求和可以简化为：\n$$\n\\varepsilon_{\\psi}[N] = \\varepsilon_{\\psi}[0] + N (R_{s} - \\hat{R}_{s})\\,i_{s}\\,T_{s}\n$$\n项 $\\varepsilon_{\\psi}[0]$ 代表在 $k=0$ 时的初始误差，这是一个常数偏移量。项 $N (R_{s} - \\hat{R}_{s})\\,i_{s}\\,T_{s}$ 代表由于真实电阻 $R_{s}$ 和估计电阻 $\\hat{R}_{s}$ 之间的不匹配，在 $N$ 个采样内累积的误差分量。这个累积的分量就是数值漂移。我们将漂移矢量定义为：\n$$\n\\varepsilon_{\\text{drift}}[N] \\triangleq \\varepsilon_{\\psi}[N] - \\varepsilon_{\\psi}[0] = N (R_{s} - \\hat{R}_{s})\\,i_{s}\\,T_{s}\n$$\n问题要求在时间 $t = N T_s$ 之后此漂移的幅值。我们可以将 $N$ 表示为 $t/T_s$。将其代入漂移方程：\n$$\n\\varepsilon_{\\text{drift}}(t) = \\frac{t}{T_{s}} (R_{s} - \\hat{R}_{s})\\,i_{s}\\,T_{s} = t (R_{s} - \\hat{R}_{s})\\,i_{s}\n$$\n我们已知 $i_{s} = \\begin{pmatrix} i_{0} \\\\ 0 \\end{pmatrix}$。漂移矢量为：\n$$\n\\varepsilon_{\\text{drift}}(t) = t (R_{s} - \\hat{R}_{s}) \\begin{pmatrix} i_{0} \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} t (R_{s} - \\hat{R}_{s}) i_{0} \\\\ 0 \\end{pmatrix}\n$$\n此矢量的幅值，记为 $|\\varepsilon_{\\text{drift}}(t)|$，是其欧几里得范数：\n$$\n|\\varepsilon_{\\text{drift}}(t)| = \\sqrt{\\left(t (R_{s} - \\hat{R}_{s}) i_{0}\\right)^2 + 0^2} = |t (R_{s} - \\hat{R}_{s}) i_{0}|\n$$\n由于时间 $t$ 和电流 $i_{0}$ 均为正，幅值简化为：\n$$\n|\\varepsilon_{\\text{drift}}(t)| = t \\, |R_{s} - \\hat{R}_{s}| \\, i_{0}\n$$\n这就是漂移幅值的闭式表达式。现在我们可以代入给定的数值：\n- $t = 0.50$ $\\mathrm{s}$\n- $R_{s} = 0.87$ $\\Omega$\n- $\\hat{R}_{s} = 0.75$ $\\Omega$\n- $i_{0} = 0.15$ $\\mathrm{A}$\n\n电阻不匹配为 $|R_{s} - \\hat{R}_{s}| = |0.87 - 0.75| = |0.12| = 0.12$ $\\Omega$。\n\n漂移幅值为：\n$$\n|\\varepsilon_{\\text{drift}}(0.50)| = (0.50 \\, \\mathrm{s}) \\times (0.12 \\, \\Omega) \\times (0.15 \\, \\mathrm{A})\n$$\n$$\n|\\varepsilon_{\\text{drift}}(0.50)| = (0.06 \\, \\mathrm{s} \\cdot \\Omega) \\times (0.15 \\, \\mathrm{A})\n$$\n$$\n|\\varepsilon_{\\text{drift}}(0.50)| = 0.009 \\, \\mathrm{s} \\cdot \\Omega \\cdot \\mathrm{A}\n$$\n单位是 $\\mathrm{s} \\cdot (\\mathrm{V/A}) \\cdot \\mathrm{A} = \\mathrm{V} \\cdot \\mathrm{s}$，即韦伯 ($\\mathrm{Wb}$)，是磁通量的单位。因此，漂移幅值为 $0.009$ $\\mathrm{Wb}$。\n\n问题要求答案四舍五入到四位有效数字。\n$$\n0.009 = 0.009000\n$$\n最终的数值漂移幅值为 $0.009000$ $\\mathrm{Wb}$。",
            "answer": "$$\\boxed{0.009000}$$"
        },
        {
            "introduction": "将理论模型转化为数字实现时，会引入新的误差源，其中最基本的一种是来自模数转换器（ADC）的量化误差。本练习要求您不仅要实现一个离散时间转矩估算器，更重要的是要分析来自电流和电压传感器的量化噪声是如何在系统中传播的。您将应用统计学方法，通过一阶不确定性传播来追踪磁链估计的方差，并最终计算出转矩估计的标准差。这项实践将控制算法与硬件限制联系起来，提供了一种量化评估传感器精度如何影响关键状态估计可靠性的方法。",
            "id": "3835329",
            "problem": "要求您为一个采用直接转矩控制 (DTC) 的异步电机实现一个离散时间转矩估算器，并传播由模数转换器 (ADC) 中的量化所产生的不确定性。该估算器必须从基本定律和核心定义出发。此任务必须以纯数学和逻辑的方式解决，并以一致的物理单位表示。最终输出必须能通过确定性程序计算得出。\n\n基本原理：\n- 在静止两轴坐标系中，定子磁链矢量遵循基本的定子电路关系，这是法拉第定律和欧姆定律的结果：$$\\frac{d}{dt}\\boldsymbol{\\psi}_s(t) = \\boldsymbol{v}_s(t) - R_s \\boldsymbol{i}_s(t),$$ 其中 $\\boldsymbol{\\psi}_s(t)$ 是定子磁链，$\\boldsymbol{v}_s(t)$ 是定子电压，$\\boldsymbol{i}_s(t)$ 是定子电流，$R_s$ 是定子电阻。在采样周期为 $T_s$ 的离散时间中，前向欧拉更新为 $$\\boldsymbol{\\psi}_s[k] = \\boldsymbol{\\psi}_s[k-1] + T_s\\left(\\boldsymbol{v}_s[k] - R_s \\boldsymbol{i}_s[k]\\right)。$$\n- 在静止两轴坐标系中，异步电机的电磁转矩定义为 $$T_e[k] = \\frac{3}{2}p\\left(\\psi_{\\alpha}[k] i_{\\beta}[k] - \\psi_{\\beta}[k] i_{\\alpha}[k]\\right),$$ 其中 $p$ 是极对数，$(\\alpha,\\beta)$ 是静止参考系中的分量。\n\n量化模型：\n- ADC 量化被建模为每个测量通道上独立的零均值均匀噪声。如果测量的最低有效位 (LSB) 是 $q$，则量化误差的方差为 $$\\sigma_q^2 = \\frac{q^2}{12}。$$ 设 $q_i$ 是以安培 (A) 为单位的电流测量 LSB，$q_v$ 是以伏特 (V) 为单位的电压测量 LSB。$\\alpha$ 和 $\\beta$ 通道上的量化误差是独立同分布的，其方差分别为 $\\sigma_i^2 = \\frac{q_i^2}{12}$ 和 $\\sigma_v^2 = \\frac{q_v^2}{12}$。\n- 离散时间磁链更新使用测量信号，因此由于量化的电压和电流，磁链估算误差会累积。假设在时间和通道上独立，且初始磁链估算误差为零，则每轴的磁链方差递推公式为 $$\\operatorname{Var}\\left(\\psi_{\\alpha}[k]\\right) = \\operatorname{Var}\\left(\\psi_{\\alpha}[k-1]\\right) + T_s^2\\left(\\sigma_v^2 + R_s^2 \\sigma_i^2\\right),$$ $$\\operatorname{Var}\\left(\\psi_{\\beta}[k]\\right) = \\operatorname{Var}\\left(\\psi_{\\beta}[k-1]\\right) + T_s^2\\left(\\sigma_v^2 + R_s^2 \\sigma_i^2\\right),$$ 初始条件为 $\\operatorname{Var}\\left(\\psi_{\\alpha}[0]\\right) = 0$ 和 $\\operatorname{Var}\\left(\\psi_{\\beta}[0]\\right) = 0$。\n- 转矩是根据最后一个时间步的磁链和电流计算的。使用围绕标称值的一阶不确定性传播（线性化），在最后一个时间步 $k = N$ 的转矩方差为 $$\\operatorname{Var}\\left(T_e[N]\\right) \\approx \\left(\\frac{3}{2}p\\right)^2\\left( i_{\\beta}[N]^2 \\operatorname{Var}\\left(\\psi_{\\alpha}[N]\\right) + i_{\\alpha}[N]^2 \\operatorname{Var}\\left(\\psi_{\\beta}[N]\\right) + \\psi_{\\alpha}[N]^2 \\sigma_i^2 + \\psi_{\\beta}[N]^2 \\sigma_i^2 \\right),$$ 假设磁链估算误差与两轴上的瞬时电流测量误差之间相互独立。转矩平均值使用无量化的标称信号计算。\n\n实现要求：\n- 使用提供的定子电压和电流在静止 $(\\alpha,\\beta)$ 坐标系中的序列，实现离散时间磁链估算器和转矩计算。使用上述量化模型来传播不确定性，并计算转矩标准差（转矩方差的平方根）。\n- 以牛顿·米 (N·m) 为单位表示最终的转矩平均值和标准差，四舍五入至六位小数。\n- 本问题不使用角度，因此不需要角度单位。\n\n测试套件：\n- 使用以下三个测试用例。对于每个用例，$\\boldsymbol{v}_s[k] = \\left(v_{\\alpha}[k], v_{\\beta}[k]\\right)$ 和 $\\boldsymbol{i}_s[k] = \\left(i_{\\alpha}[k], i_{\\beta}[k]\\right)$ 适用于 $k = 1,2,3,4,5$。初始磁链为零：$\\psi_{\\alpha}[0] = 0$ 和 $\\psi_{\\beta}[0] = 0$。\n\n案例 $1$ (一般情况)：\n- 采样周期: $T_s = 0.0001 \\ \\text{s}$\n- 定子电阻: $R_s = 0.5 \\ \\Omega$\n- 极对数: $p = 2$\n- 电流 LSB: $q_i = 0.001 \\ \\text{A}$\n- 电压 LSB: $q_v = 0.01 \\ \\text{V}$\n- 电压序列:\n$$v_{\\alpha}[k] = [ \\ 230.0,\\ 227.0,\\ 225.0,\\ 228.0,\\ 229.0 \\ ]$$\n$$v_{\\beta}[k] = [ \\ 0.0,\\ 20.0,\\ -15.0,\\ 10.0,\\ 5.0 \\ ]$$\n- 电流序列:\n$$i_{\\alpha}[k] = [ \\ 10.0,\\ 10.5,\\ 9.8,\\ 10.2,\\ 10.1 \\ ]$$\n$$i_{\\beta}[k] = [ \\ 0.0,\\ -1.0,\\ 0.5,\\ -0.2,\\ 0.3 \\ ]$$\n\n案例 $2$ (边界情况：无量化)：\n- 采样周期: $T_s = 0.0001 \\ \\text{s}$\n- 定子电阻: $R_s = 0.5 \\ \\Omega$\n- 极对数: $p = 2$\n- 电流 LSB: $q_i = 0.0 \\ \\text{A}$\n- 电压 LSB: $q_v = 0.0 \\ \\text{V}$\n- 电压序列:\n$$v_{\\alpha}[k] = [ \\ 230.0,\\ 227.0,\\ 225.0,\\ 228.0,\\ 229.0 \\ ]$$\n$$v_{\\beta}[k] = [ \\ 0.0,\\ 20.0,\\ -15.0,\\ 10.0,\\ 5.0 \\ ]$$\n- 电流序列:\n$$i_{\\alpha}[k] = [ \\ 10.0,\\ 10.5,\\ 9.8,\\ 10.2,\\ 10.1 \\ ]$$\n$$i_{\\beta}[k] = [ \\ 0.0,\\ -1.0,\\ 0.5,\\ -0.2,\\ 0.3 \\ ]$$\n\n案例 $3$ (边缘情况：较高量化和较长采样周期)：\n- 采样周期: $T_s = 0.0003 \\ \\text{s}$\n- 定子电阻: $R_s = 0.8 \\ \\Omega$\n- 极对数: $p = 3$\n- 电流 LSB: $q_i = 0.005 \\ \\text{A}$\n- 电压 LSB: $q_v = 0.05 \\ \\text{V}$\n- 电压序列:\n$$v_{\\alpha}[k] = [ \\ 240.0,\\ 238.0,\\ 235.0,\\ 239.0,\\ 241.0 \\ ]$$\n$$v_{\\beta}[k] = [ \\ 10.0,\\ -5.0,\\ 15.0,\\ -10.0,\\ 0.0 \\ ]$$\n- 电流序列:\n$$i_{\\alpha}[k] = [ \\ 15.0,\\ 14.8,\\ 15.2,\\ 14.9,\\ 15.1 \\ ]$$\n$$i_{\\beta}[k] = [ \\ -2.0,\\ -1.5,\\ -1.0,\\ -0.5,\\ 0.0 \\ ]$$\n\n程序输出规范：\n- 对于每个测试用例，计算最后一步 $k=5$ 时的转矩平均值 $T_e[5]$ 和转矩标准差 $\\sqrt{\\operatorname{Var}(T_e[5])}$。\n- 您的程序应生成一行输出，其中包含所有案例的结果，形式为一个以逗号分隔的列表，并用方括号括起来。每个案例的结果必须是一个包含两个浮点数的列表 $[T_{\\text{mean}}, T_{\\text{std}}]$，两个值都四舍五入到六位小数，并以 $\\text{N}\\cdot\\text{m}$ 表示。例如，最终输出格式应为 $$[ [ \\ T_{\\text{mean},1},\\ T_{\\text{std},1} \\ ],\\ [ \\ T_{\\text{mean},2},\\ T_{\\text{std},2} \\ ],\\ [ \\ T_{\\text{mean},3},\\ T_{\\text{std},3} \\ ] ]。$$",
            "solution": "用户提供了一个有效且定义明确的问题，该问题在科学上基于电气工程和控制理论的原理。该问题要求实现一个异步电机的离散时间转矩估算器，包括传播由传感器量化引起的不确定性。下面的解决方案遵循一个系统的、基于原理的方法。\n\n### 1. 问题阐述\n核心任务是估算在最后一个离散时间步长 $N$ 时的电磁转矩 $T_e$ 及其相关的不确定性。这涉及两个并行的计算：\n1.  **均值估算**：迭代计算定子磁链矢量 $\\boldsymbol{\\psi}_s$ 的标称值，然后计算标称转矩 $T_e$。\n2.  **不确定性传播**：迭代计算定子磁链分量的方差，然后将此不确定性连同电流测量的不确定性一起传播到最终的转矩计算中。\n\n所有计算都在一个由 $(\\alpha, \\beta)$ 坐标表示的静止两轴参考系中进行。\n\n### 2. 均值估算\n平均转矩的估算依赖于测量信号的标称（无误差）值。\n\n#### 2.1. 定子磁链估算\n控制定子磁链 $\\boldsymbol{\\psi}_s(t)$ 的基本关系源于应用于定子绕组的法拉第电磁感应定律和欧姆定律：\n$$ \\frac{d}{dt}\\boldsymbol{\\psi}_s(t) = \\boldsymbol{v}_s(t) - R_s \\boldsymbol{i}_s(t) $$\n其中 $\\boldsymbol{v}_s(t)$ 是定子电压矢量，$\\boldsymbol{i}_s(t)$ 是定子电流矢量，$R_s$ 是定子电阻。\n\n对于一个采样周期为 $T_s$ 的数字控制系统，这个连续时间微分方程被离散化。问题指定使用前向欧拉法，它为时间步 $k$ 的磁链矢量提供了以下递归更新规则：\n$$ \\boldsymbol{\\psi}_s[k] = \\boldsymbol{\\psi}_s[k-1] + T_s \\left( \\boldsymbol{v}_s[k] - R_s \\boldsymbol{i}_s[k] \\right) $$\n该方程分别应用于 $\\alpha$ 和 $\\beta$ 分量：\n$$ \\psi_{\\alpha}[k] = \\psi_{\\alpha}[k-1] + T_s \\left( v_{\\alpha}[k] - R_s i_{\\alpha}[k] \\right) $$\n$$ \\psi_{\\beta}[k] = \\psi_{\\beta}[k-1] + T_s \\left( v_{\\beta}[k] - R_s i_{\\beta}[k] \\right) $$\n从初始条件 $\\boldsymbol{\\psi}_s[0] = \\boldsymbol{0}$ 开始，这些方程为 $k=1, 2, \\dots, N$ 进行迭代。\n\n#### 2.2. 电磁转矩计算\n电磁转矩 $T_e$ 是定子磁链和定子电流分量的函数。对于一个有 $p$ 个极对的三相电机，在静止参考系中的转矩由下式给出：\n$$ T_e[k] = \\frac{3}{2}p \\left( \\psi_{\\alpha}[k] i_{\\beta}[k] - \\psi_{\\beta}[k] i_{\\alpha}[k] \\right) $$\n最后一步的平均转矩 $T_{e, \\text{mean}}[N]$ 是使用最终估算的磁链值 $\\psi_{\\alpha}[N]$ 和 $\\psi_{\\beta}[N]$ 以及最终测量的电流值 $i_{\\alpha}[N]$ 和 $i_{\\beta}[N]$ 来计算的。\n\n### 3. 不确定性传播\n转矩估算中的不确定性源于模数转换器 (ADC) 对模拟电压和电流信号的量化。\n\n#### 3.1. 量化误差模型\n一个信号的量化误差被建模为一个零均值随机变量，均匀分布在区间 $[-q/2, q/2]$ 上，其中 $q$ 是一个量化步长的宽度，或最低有效位 (LSB)。这种均匀分布的方差是：\n$$ \\sigma_q^2 = \\frac{q^2}{12} $$\n问题提供了电流 $q_i$ 和电压 $q_v$ 的 LSB 值。假设 $\\alpha$ 和 $\\beta$ 通道上的误差是独立同分布的，测量方差为：\n$$ \\sigma_i^2 = \\operatorname{Var}(i_{\\alpha}) = \\operatorname{Var}(i_{\\beta}) = \\frac{q_i^2}{12} $$\n$$ \\sigma_v^2 = \\operatorname{Var}(v_{\\alpha}) = \\operatorname{Var}(v_{\\beta}) = \\frac{q_v^2}{12} $$\n\n#### 3.2. 磁链方差传播\n磁链估算的不确定性随时间累积。在步骤 $k$ 的磁链估算方差取决于前一步骤 $k-1$ 的方差以及在步骤 $k$ 的测量引入的不确定性。从磁链更新方程 $\\boldsymbol{\\psi}_s[k] = \\boldsymbol{\\psi}_s[k-1] + T_s(\\boldsymbol{v}_s[k] - R_s \\boldsymbol{i}_s[k])$，我们可以推导出方差传播。假设 $\\boldsymbol{\\psi}_s[k-1]$ 中的估算误差与 $\\boldsymbol{v}_s[k]$ 和 $\\boldsymbol{i}_s[k]$ 中的测量误差无关，则方差相加：\n$$ \\operatorname{Var}(\\boldsymbol{\\psi}_s[k]) = \\operatorname{Var}(\\boldsymbol{\\psi}_s[k-1]) + T_s^2 \\operatorname{Var}(\\boldsymbol{v}_s[k] - R_s \\boldsymbol{i}_s[k]) $$\n假设电压和电流测量误差之间独立，$\\operatorname{Var}(\\boldsymbol{v}_s[k] - R_s \\boldsymbol{i}_s[k]) = \\operatorname{Var}(\\boldsymbol{v}_s[k]) + R_s^2 \\operatorname{Var}(\\boldsymbol{i}_s[k])$。\n这导致了问题阐述中提供的每轴方差递推：\n$$ \\operatorname{Var}(\\psi_{\\alpha}[k]) = \\operatorname{Var}(\\psi_{\\alpha}[k-1]) + T_s^2\\left(\\sigma_v^2 + R_s^2 \\sigma_i^2\\right) $$\n$$ \\operatorname{Var}(\\psi_{\\beta}[k]) = \\operatorname{Var}(\\psi_{\\beta}[k-1]) + T_s^2\\left(\\sigma_v^2 + R_s^2 \\sigma_i^2\\right) $$\n从初始条件 $\\operatorname{Var}(\\boldsymbol{\\psi}_s[0]) = 0$ 开始，这个迭代计算得到最终的磁链方差分量 $\\operatorname{Var}(\\psi_{\\alpha}[N])$ 和 $\\operatorname{Var}(\\psi_{\\beta}[N])$。请注意，每步的方差增加量 $\\Delta\\sigma_\\psi^2 = T_s^2(\\sigma_v^2 + R_s^2 \\sigma_i^2)$ 是恒定的。因此，经过 $N$ 步后，$\\operatorname{Var}(\\psi_{\\alpha}[N]) = \\operatorname{Var}(\\psi_{\\beta}[N]) = N \\cdot \\Delta\\sigma_\\psi^2$。\n\n#### 3.3. 转矩方差计算\n最终转矩的方差 $\\operatorname{Var}(T_e[N])$ 是使用一阶泰勒级数近似（不确定性传播定律）来估算的。对于一个包含独立随机变量 $x_1, \\dots, x_m$ 的函数 $f(x_1, \\dots, x_m)$，其方差近似为：\n$$ \\operatorname{Var}(f) \\approx \\sum_{j=1}^{m} \\left( \\frac{\\partial f}{\\partial x_j} \\right)^2 \\operatorname{Var}(x_j) $$\n这里，函数是 $T_e = C(\\psi_{\\alpha} i_{\\beta} - \\psi_{\\beta} i_{\\alpha})$，其中 $C = \\frac{3}{2}p$。变量是 $\\psi_{\\alpha}$、$\\psi_{\\beta}$、$i_{\\alpha}$ 和 $i_{\\beta}$。在标称值处计算的偏导数为：\n$$ \\frac{\\partial T_e}{\\partial \\psi_{\\alpha}} = C \\cdot i_{\\beta}, \\quad \\frac{\\partial T_e}{\\partial \\psi_{\\beta}} = -C \\cdot i_{\\alpha}, \\quad \\frac{\\partial T_e}{\\partial i_{\\alpha}} = -C \\cdot \\psi_{\\beta}, \\quad \\frac{\\partial T_e}{\\partial i_{\\beta}} = C \\cdot \\psi_{\\alpha} $$\n将这些代入方差公式，并使用每个变量的相关方差（$\\operatorname{Var}(\\psi_{\\alpha}[N])$、$\\operatorname{Var}(\\psi_{\\beta}[N])$、$\\sigma_i^2$、$\\sigma_i^2$），得到最终的转矩方差表达式：\n$$ \\operatorname{Var}(T_e[N]) \\approx \\left(\\frac{3}{2}p\\right)^2 \\left( i_{\\beta}[N]^2 \\operatorname{Var}(\\psi_{\\alpha}[N]) + i_{\\alpha}[N]^2 \\operatorname{Var}(\\psi_{\\beta}[N]) + \\psi_{\\alpha}[N]^2 \\sigma_i^2 + \\psi_{\\beta}[N]^2 \\sigma_i^2 \\right) $$\n转矩标准差是此方差的平方根：$\\sigma_{T_e}[N] = \\sqrt{\\operatorname{Var}(T_e[N])}$。\n\n### 4. 算法实现\n对于每个测试用例，执行以下步骤：\n\n1.  **初始化**：设置初始磁链 $\\psi_{\\alpha}[0]=0$, $\\psi_{\\beta}[0]=0$。设置初始磁链方差 $\\operatorname{Var}(\\psi_{\\alpha}[0])=0$, $\\operatorname{Var}(\\psi_{\\beta}[0])=0$。\n2.  **预计算常数**：计算测量方差 $\\sigma_i^2 = q_i^2/12$ 和 $\\sigma_v^2 = q_v^2/12$。计算每步恒定的磁链方差增量 $\\Delta\\sigma_\\psi^2 = T_s^2(\\sigma_v^2 + R_s^2 \\sigma_i^2)$。\n3.  **迭代**：对于 $k = 1, 2, \\dots, N=5$ 进行循环。在每次迭代中：\n    a. 从输入序列中读取电压和电流值 $(v_{\\alpha}[k], v_{\\beta}[k])$ 和 $(i_{\\alpha}[k], i_{\\beta}[k])$。\n    b. 使用前向欧拉规则更新平均磁链分量 $\\psi_{\\alpha}[k]$ 和 $\\psi_{\\beta}[k]$。\n    c. 通过加上 $\\Delta\\sigma_\\psi^2$ 来更新磁链方差 $\\operatorname{Var}(\\psi_{\\alpha}[k])$ 和 $\\operatorname{Var}(\\psi_{\\beta}[k])$。\n4.  **最终计算**：循环结束后（在 $k=N=5$ 时）：\n    a. 使用最终的磁链和电流值计算平均转矩 $T_{e, \\text{mean}}[5]$。\n    b. 使用最终的磁链值、最终的电流值、最终的磁链方差和电流测量方差 $\\sigma_i^2$ 计算转矩方差 $\\operatorname{Var}(T_e[5])$。\n    c. 计算转矩标准差 $\\sigma_{T_e}[5] = \\sqrt{\\operatorname{Var}(T_e[5])}$。\n5.  **输出**：存储配对 $[T_{e, \\text{mean}}[5], \\sigma_{T_e}[5]]$，四舍五入到六位小数。\n\n该过程是确定性的，并直接实现了所提供的物理和统计模型。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the induction machine torque estimation and uncertainty propagation problem.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general case)\n        {\n            \"Ts\": 0.0001, \"Rs\": 0.5, \"p\": 2, \"qi\": 0.001, \"qv\": 0.01,\n            \"v_alpha_seq\": [230.0, 227.0, 225.0, 228.0, 229.0],\n            \"v_beta_seq\": [0.0, 20.0, -15.0, 10.0, 5.0],\n            \"i_alpha_seq\": [10.0, 10.5, 9.8, 10.2, 10.1],\n            \"i_beta_seq\": [0.0, -1.0, 0.5, -0.2, 0.3],\n        },\n        # Case 2 (boundary case: no quantization)\n        {\n            \"Ts\": 0.0001, \"Rs\": 0.5, \"p\": 2, \"qi\": 0.0, \"qv\": 0.0,\n            \"v_alpha_seq\": [230.0, 227.0, 225.0, 228.0, 229.0],\n            \"v_beta_seq\": [0.0, 20.0, -15.0, 10.0, 5.0],\n            \"i_alpha_seq\": [10.0, 10.5, 9.8, 10.2, 10.1],\n            \"i_beta_seq\": [0.0, -1.0, 0.5, -0.2, 0.3],\n        },\n        # Case 3 (edge case: higher quantization and longer sampling period)\n        {\n            \"Ts\": 0.0003, \"Rs\": 0.8, \"p\": 3, \"qi\": 0.005, \"qv\": 0.05,\n            \"v_alpha_seq\": [240.0, 238.0, 235.0, 239.0, 241.0],\n            \"v_beta_seq\": [10.0, -5.0, 15.0, -10.0, 0.0],\n            \"i_alpha_seq\": [15.0, 14.8, 15.2, 14.9, 15.1],\n            \"i_beta_seq\": [-2.0, -1.5, -1.0, -0.5, 0.0],\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # Unpack parameters\n        Ts = case[\"Ts\"]\n        Rs = case[\"Rs\"]\n        p = case[\"p\"]\n        qi = case[\"qi\"]\n        qv = case[\"qv\"]\n        v_alpha_seq = case[\"v_alpha_seq\"]\n        v_beta_seq = case[\"v_beta_seq\"]\n        i_alpha_seq = case[\"i_alpha_seq\"]\n        i_beta_seq = case[\"i_beta_seq\"]\n\n        # --- Mean Value and Variance Propagation ---\n\n        # Initialize mean flux and its variance at k=0\n        psi_alpha_k = 0.0\n        psi_beta_k = 0.0\n        var_psi_alpha_k = 0.0\n        var_psi_beta_k = 0.0\n\n        num_steps = len(v_alpha_seq)\n\n        # Calculate constant variances from quantization\n        sigma_i_sq = qi**2 / 12.0\n        sigma_v_sq = qv**2 / 12.0\n\n        # Calculate the per-step increase in flux variance\n        delta_var_psi_sq = Ts**2 * (sigma_v_sq + Rs**2 * sigma_i_sq)\n\n        # Loop from k=1 to N (where N=5)\n        # Python index `k_idx` corresponds to `k-1`\n        for k_idx in range(num_steps):\n            v_alpha = v_alpha_seq[k_idx]\n            v_beta = v_beta_seq[k_idx]\n            i_alpha = i_alpha_seq[k_idx]\n            i_beta = i_beta_seq[k_idx]\n\n            # Update mean flux (nominal values) using forward-Euler\n            psi_alpha_k += Ts * (v_alpha - Rs * i_alpha)\n            psi_beta_k += Ts * (v_beta - Rs * i_beta)\n\n            # Update flux variance by accumulating per-step uncertainty\n            var_psi_alpha_k += delta_var_psi_sq\n            var_psi_beta_k += delta_var_psi_sq\n\n        # The loop finishes at k=N. The variables now hold the final values.\n        psi_alpha_N = psi_alpha_k\n        psi_beta_N = psi_beta_k\n        var_psi_alpha_N = var_psi_alpha_k\n        var_psi_beta_N = var_psi_beta_k\n\n        # Get final current values at k=N\n        i_alpha_N = i_alpha_seq[-1]\n        i_beta_N = i_beta_seq[-1]\n        \n        # --- Final Torque and Uncertainty Calculation ---\n        \n        # Torque constant\n        C = 1.5 * p\n\n        # Calculate mean torque at k=N\n        Te_mean_N = C * (psi_alpha_N * i_beta_N - psi_beta_N * i_alpha_N)\n\n        # Calculate torque variance at k=N using first-order propagation\n        var_term1 = i_beta_N**2 * var_psi_alpha_N\n        var_term2 = i_alpha_N**2 * var_psi_beta_N\n        var_term3 = psi_alpha_N**2 * sigma_i_sq\n        var_term4 = psi_beta_N**2 * sigma_i_sq\n        \n        var_Te_N = C**2 * (var_term1 + var_term2 + var_term3 + var_term4)\n\n        # Calculate torque standard deviation\n        Te_std_N = np.sqrt(var_Te_N)\n\n        # Round results to six decimal places\n        Te_mean_rounded = round(Te_mean_N, 6)\n        Te_std_rounded = round(Te_std_N, 6)\n        \n        results.append([Te_mean_rounded, Te_std_rounded])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "为了克服经典直接转矩控制的局限（如开关频率可变和参数敏感性），学术界与工业界已经发展出更先进的控制策略。本练习将介绍一种现代的、基于模型预测的控制方法。该方法不再使用滞环比较器，而是通过对每个可能的逆变器开关状态，预测系统在下一时刻的状态（磁链和转矩），然后通过最小化一个权衡了磁链和转矩跟踪误差的成本函数来选择最优开关状态。该算法的一个关键组成部分是首先观测直流母线电压 $V_{dc}$，因为它的实际值直接影响预测的准确性。这项实践将带您进入现代电机控制技术的前沿，将状态观测、预测建模和优化等概念融合成一个统一的算法。",
            "id": "3835362",
            "problem": "考虑一台通过三相两电平电压源逆变器 (VSI) 进行直接转矩控制 (DTC) 的鼠笼式感应电机。逆变器的直流母线电压表示为 $V_{dc}$，逆变器可以在静止$\\alpha\\beta$坐标系中施加六个非零空间矢量，每个矢量具有单位方向矢量 $u_k$，其中 $k \\in \\{1,2,3,4,5,6\\}$，角度为 $(k-1)\\pi/3$ 弧度。当选择开关状态 $k$ 时，对应的施加定子电压矢量模型为 $v_{s,k} = \\frac{2}{3} V_{dc} u_k$，忽略了死区时间和器件压降。静止坐标系中的定子电压方程由基本关系式 $v_s = R_s i_s + \\frac{d\\psi_s}{dt}$ 给出，其中 $R_s$ 是定子电阻，$i_s$ 是定子电流矢量，$\\psi_s$ 是定子磁链矢量。DTC 估计中使用的电磁转矩为 $T_e = \\frac{3}{2} p \\left(\\psi_{s\\alpha} i_{s\\beta} - \\psi_{s\\beta} i_{s\\alpha}\\right)$，其中 $p$ 是极对数。\n\n任务：为 $V_{dc}$ 设计一个实时观测器，并将其集成到开关决策中，以保持对定子磁链幅值和电磁转矩的精确控制。观测器必须在每个采样步通过将测得的定子电压矢量估计值 $v_s$ 投影到前一施加的单位矢量 $u_{\\text{prev}}$ 上并对原始估计值进行滤波来估计 $V_{dc}$。具体而言，使用：\n- $v_s = R_s i_s + \\frac{\\psi_s[k]-\\psi_s[k-1]}{T_s}$，其中 $T_s$ 是采样周期，$\\psi_s[k]$ 和 $\\psi_s[k-1]$ 是当前和前一定子磁链矢量。\n- 直流母线电压原始估计值 $V_{dc}^{\\text{raw}} = \\frac{3}{2} \\left(v_s \\cdot u_{\\text{prev}}\\right)$。\n- 一阶滤波观测器更新 $V_{dc}[k] = V_{dc}[k-1] + \\gamma \\left(V_{dc}^{\\text{raw}} - V_{dc}[k-1]\\right)$，滤波器增益为 $\\gamma \\in (0,1]$。\n\n通过使用估计的 $V_{dc}[k]$ 预测每个候选开关状态 $k \\in \\{1,\\dots,6\\}$ 的下一步定子磁链和转矩，将观测器集成到开关决策中：\n- $v_{s,k}^{\\text{est}} = \\frac{2}{3} V_{dc}[k] u_k$，\n- $\\psi_s^{\\text{next}}(k) = \\psi_s[k] + T_s \\left(v_{s,k}^{\\text{est}} - R_s i_s[k]\\right)$，\n- $T_e^{\\text{next}}(k) = \\frac{3}{2} p \\left(\\psi_{s\\alpha}^{\\text{next}}(k) i_{s\\beta}[k] - \\psi_{s\\beta}^{\\text{next}}(k) i_{s\\alpha}[k]\\right)$。\n\n选择下一个开关状态 $k^\\star$，该状态能最小化一个结合了磁链幅值跟踪和转矩跟踪的加权目标：\n- $J(k) = w_\\psi \\left|\\|\\psi_s^{\\text{next}}(k)\\| - \\|\\psi_s^{\\text{ref}}\\|\\right| + w_T \\left|T_e^{\\text{ref}} - T_e^{\\text{next}}(k)\\right|$，\n其中 $\\|\\psi_s^{\\text{ref}}\\|$ 是定子磁链幅值参考值，$T_e^{\\text{ref}}$ 是转矩参考值。使用 $w_\\psi$ 和 $w_T$ 作为正常数权重。\n\n角度量必须以弧度为单位处理。所有物理单位必须明确：$V$ 代表电压，$A$ 代表电流，$\\Omega$ 代表电阻，$Wb$ 代表磁链，$N·m$ 代表转矩，$s$ 代表时间。\n\n您的程序必须实现观测器和开关决策，并将其应用于以下独立的单步案例测试套件。使用 $R_s = 0.5\\,\\Omega$，$p = 2$ 极对数，以及滤波器增益 $\\gamma = 0.3$。使用权重 $w_\\psi = 1.0$ 和 $w_T = 0.01$。\n\n测试套件（每个案例提供 $T_s$、$i_s[k]$、$\\psi_s[k-1]$、$\\psi_s[k]$、$u_{\\text{prev}}$ 的索引 $k_{\\text{prev}}$、前一直流母线电压估计值 $V_{dc}[k-1]$、磁链幅值参考值 $\\|\\psi_s^{\\text{ref}}\\|$ 和转矩参考值 $T_e^{\\text{ref}}$）：\n\n- 案例 1 (标准工况):\n  - $T_s = 50\\times 10^{-6}\\,s$,\n  - $i_s[k] = [10.0\\,A,\\,-5.0\\,A]$,\n  - $\\psi_s[k-1] = [0.700000\\,Wb,\\;0.000000\\,Wb]$,\n  - $\\psi_s[k] = [0.717750\\,Wb,\\;0.000125\\,Wb]$,\n  - $k_{\\text{prev}} = 1$,\n  - $V_{dc}[k-1] = 520.0\\,V$,\n  - $\\|\\psi_s^{\\text{ref}}\\| = 0.800000\\,Wb$,\n  - $T_e^{\\text{ref}} = 30.000000\\,N·m$.\n\n- 案例 2 (扇区边界灵敏度):\n  - $T_s = 50\\times 10^{-6}\\,s$,\n  - $i_s[k] = [8.0\\,A,\\;2.0\\,A]$,\n  - $\\psi_s[k-1] = [0.378700\\,Wb,\\;0.588700\\,Wb]$,\n  - $\\psi_s[k] = [0.387000\\,Wb,\\;0.603372\\,Wb]$,\n  - $k_{\\text{prev}} = 2$,\n  - $V_{dc}[k-1] = 480.0\\,V$,\n  - $\\|\\psi_s^{\\text{ref}}\\| = 0.800000\\,Wb$,\n  - $T_e^{\\text{ref}} = 25.000000\\,N·m$.\n\n- 案例 3 (低 $V_{dc}$，纹波/欠压):\n  - $T_s = 100\\times 10^{-6}\\,s$,\n  - $i_s[k] = [-12.0\\,A,\\;3.0\\,A]$,\n  - $\\psi_s[k-1] = [-0.600000\\,Wb,\\;0.050000\\,Wb]$,\n  - $\\psi_s[k] = [-0.619400\\,Wb,\\;0.049850\\,Wb]$,\n  - $k_{\\text{prev}} = 4$,\n  - $V_{dc}[k-1] = 320.0\\,V$,\n  - $\\|\\psi_s^{\\text{ref}}\\| = 0.700000\\,Wb$,\n  - $T_e^{\\text{ref}} = 10.000000\\,N·m$.\n\n- 案例 4 (零转矩误差，测量扰动):\n  - $T_s = 50\\times 10^{-6}\\,s$,\n  - $i_s[k] = [3.0\\,A,\\;-6.0\\,A]$,\n  - $\\psi_s[k-1] = [0.400000\\,Wb,\\;-0.300000\\,Wb]$,\n  - $\\psi_s[k] = [0.409175\\,Wb,\\;-0.315938\\,Wb]$,\n  - $k_{\\text{prev}} = 6$,\n  - $V_{dc}[k-1] = 550.0\\,V$,\n  - $\\|\\psi_s^{\\text{ref}}\\| = 0.500000\\,Wb$,\n  - $T_e^{\\text{ref}} = -4.521708\\,N·m$.\n\n您的程序必须：\n- 严格按照规定实现观测器和开关决策。\n- 对每个案例，计算滤波后的估计值 $V_{dc}[k]$（单位为 $V$）和所选的下一开关状态索引 $k^\\star \\in \\{1,\\dots,6\\}$。\n- 生成单行输出，其中包含按顺序排列的案例结果列表，每个结果是一个数对 $[V_{dc}[k], k^\\star]$，$V_{dc}[k]$ 四舍五入到六位小数。最终输出格式必须是单行，如 $[[v_1,k_1],[v_2,k_2],[v_3,k_3],[v_4,k_4]]$，逗号后没有空格。",
            "solution": "该问题经评估是有效的，因为它在科学上基于电机控制原理，问题设定良好，具有完整且一致的数据和方程组，并且其表述是客观的。因此，我们将着手提供一个完整的解决方案。\n\n任务是为直接转矩控制 (DTC) 系统设计并实现一个单步算法。这包括两个主要部分：一个用于估计直流母线电压 $V_{dc}$ 的实时观测器，以及一个用于选择最优逆变器电压矢量的预测性开关逻辑。解决方案遵循指定的计算顺序。\n\n该控制方案的基础是感应电机在静止$\\alpha\\beta$参考坐标系中的动态模型。定子电压方程由下式给出：\n$$\nv_s = R_s i_s + \\frac{d\\psi_s}{dt}\n$$\n其中 $v_s$ 是定子电压矢量，$i_s$ 是定子电流矢量，$\\psi_s$ 是定子磁链矢量，$R_s$ 是定子电阻。电磁转矩 $T_e$ 通过矢量叉积计算：\n$$\nT_e = \\frac{3}{2} p \\left(\\psi_{s\\alpha} i_{s\\beta} - \\psi_{s\\beta} i_{s\\alpha}\\right)\n$$\n其中 $p$ 是极对数。\n\n控制动作是由两电平电压源逆变器 (VSI) 生成的离散电压矢量。存在六个非零电压矢量 $v_{s,k}$，其方向由单位矢量 $u_k$ 定义，角度为 $(k-1)\\pi/3$ 弧度（$k \\in \\{1, 2, 3, 4, 5, 6\\}$），其幅值与直流母线电压 $V_{dc}$ 成正比：\n$$\nv_{s,k} = \\frac{2}{3} V_{dc} u_k\n$$\n\n整个算法由在每个采样时刻 $[k]$ 执行的两个顺序阶段组成。\n\n**1. 直流母线电压观测器（$V_{dc}$ 估计）**\n\n第一阶段是基于前一时间步的测量值来估计直流母线电压 $V_{dc}[k]$。这一点至关重要，因为 $V_{dc}$ 的波动会直接影响所施加电压矢量的幅值，从而影响控制精度。\n\n首先，我们估计在时间区间 $[k-1, k]$ 内实际施加的平均定子电压 $v_s$。这是通过使用磁链导数的后向差分来离散化定子电压方程实现的：\n$$\nv_s[k] \\approx R_s i_s[k] + \\frac{\\psi_s[k] - \\psi_s[k-1]}{T_s}\n$$\n这里，$i_s[k]$、$\\psi_s[k]$ 和 $\\psi_s[k-1]$ 是在当前和前一步测量或估计的量，$T_s$ 是采样周期。\n\n在前一区间内施加的理论电压是 $v_{s,\\text{prev}} = \\frac{2}{3} V_{dc} u_{\\text{prev}}$，其中 $u_{\\text{prev}}$ 是在该区间内有效的开关状态 $k_{\\text{prev}}$ 对应的单位矢量。假设我们计算出的 $v_s[k]$ 是这个施加电压的良好近似，我们可以通过将 $v_s[k]$ 投影到 $u_{\\text{prev}}$ 的已知方向上来估计 $V_{dc}$。由于 $u_{\\text{prev}}$ 是一个单位矢量，点积 $v_s[k] \\cdot u_{\\text{prev}}$ 分离出 $v_s[k]$ 沿着施加矢量方向的分量，理想情况下它等于 $\\frac{2}{3} V_{dc}$。反转这个关系可以得出一个直流母线电压的原始估计值：\n$$\nV_{dc}^{\\text{raw}} = \\frac{3}{2} (v_s[k] \\cdot u_{\\text{prev}})\n$$\n为了减轻测量噪声和模型不准确性的影响，这个原始估计值会通过一个一阶低通滤波器。滤波后的估计值 $V_{dc}[k]$ 基于前一个估计值 $V_{dc}[k-1]$ 以及原始估计值与前一个估计值之间的误差进行更新，由滤波器增益 $\\gamma$ 控制：\n$$\nV_{dc}[k] = V_{dc}[k-1] + \\gamma (V_{dc}^{\\text{raw}} - V_{dc}[k-1])\n$$\n\n**2. 预测性开关决策**\n\n第二阶段使用新估计的 $V_{dc}[k]$ 来预测在下一个时间步 $[k, k+1]$ 中应用六个可能的非零电压矢量中每一个的结果，并选择最能满足控制目标的那个。\n\n控制目标是驱动定子磁链幅值 $\\|\\psi_s\\|$ 达到其参考值 $\\|\\psi_s^{\\text{ref}}\\|$，以及电磁转矩 $T_e$ 达到其参考值 $T_e^{\\text{ref}}$。构建一个成本函数 $J(k)$ 来量化每个候选矢量 $k \\in \\{1, \\dots, 6\\}$ 的性能：\n$$\nJ(k) = w_\\psi \\left|\\|\\psi_s^{\\text{next}}(k)\\| - \\|\\psi_s^{\\text{ref}}\\|\\right| + w_T \\left|T_e^{\\text{ref}} - T_e^{\\text{next}}(k)\\right|\n$$\n其中 $w_\\psi$ 和 $w_T$ 是权重因子。\n\n为了评估 $J(k)$，我们必须为每个候选矢量预测下一步的磁链 $\\psi_s^{\\text{next}}(k)$ 和转矩 $T_e^{\\text{next}}(k)$。\n\n对于每个候选 $k$：\na. 使用我们更新的 $V_{dc}[k]$ 计算估计的电压矢量：\n$$\nv_{s,k}^{\\text{est}} = \\frac{2}{3} V_{dc}[k] u_k\n$$\nb. 通过将定子电压方程在一个采样周期 $T_s$ 内向前积分（前向欧拉步），预测下一个定子磁链矢量：\n$$\n\\psi_s^{\\text{next}}(k) = \\psi_s[k] + T_s (v_{s,k}^{\\text{est}} - R_s i_s[k])\n$$\nc. 然后使用预测的磁链矢量 $\\psi_s^{\\text{next}}(k)$ 和*当前*的定子电流矢量 $i_s[k]$（一种常见的简化方法）来预测下一个电磁转矩：\n$$\nT_e^{\\text{next}}(k) = \\frac{3}{2} p (\\psi_{s\\alpha}^{\\text{next}}(k) i_s\\beta[k] - \\psi_{s\\beta}^{\\text{next}}(k) i_{s\\alpha}[k])\n$$\n在计算出预测的磁链幅值 $\\|\\psi_s^{\\text{next}}(k)\\|$ 和转矩 $T_e^{\\text{next}}(k)$ 之后，评估成本 $J(k)$。下一个区间的最佳开关状态 $k^\\star$ 是最小化此成本函数的状态：\n$$\nk^\\star = \\underset{k \\in \\{1,\\dots,6\\}}{\\arg\\min} J(k)\n$$\n此过程针对每个给定的测试案例进行实现，使用指定的电机参数（$R_s = 0.5\\,\\Omega$, $p=2$）、控制参数（$\\gamma=0.3$, $w_\\psi=1.0$, $w_T=0.01$），以及案例特定的初始条件和参考值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a DTC observer and predictive switching logic for an induction machine.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    R_s = 0.5  # Stator resistance in Ohms\n    p = 2      # Number of pole pairs\n    gamma = 0.3  # Vdc observer filter gain\n    w_psi = 1.0  # Flux error weight\n    w_T = 0.01   # Torque error weight\n\n    # --- Define Unit Vectors for VSI states 1-6 ---\n    # Angles are (k-1)*pi/3 for k in {1,...,6}\n    u_vectors = {\n        i: np.array([np.cos((i - 1) * np.pi / 3), np.sin((i - 1) * np.pi / 3)])\n        for i in range(1, 7)\n    }\n\n    # --- Test Suite Data ---\n    test_cases = [\n        # Case 1 (happy path)\n        {\n            \"Ts\": 50e-6,\n            \"i_s_k\": np.array([10.0, -5.0]),\n            \"psi_s_km1\": np.array([0.700000, 0.000000]),\n            \"psi_s_k\": np.array([0.717750, 0.000125]),\n            \"k_prev\": 1,\n            \"V_dc_km1\": 520.0,\n            \"psi_s_ref_mag\": 0.800000,\n            \"T_e_ref\": 30.000000,\n        },\n        # Case 2 (sector boundary sensitivity)\n        {\n            \"Ts\": 50e-6,\n            \"i_s_k\": np.array([8.0, 2.0]),\n            \"psi_s_km1\": np.array([0.378700, 0.588700]),\n            \"psi_s_k\": np.array([0.387000, 0.603372]),\n            \"k_prev\": 2,\n            \"V_dc_km1\": 480.0,\n            \"psi_s_ref_mag\": 0.800000,\n            \"T_e_ref\": 25.000000,\n        },\n        # Case 3 (low Vdc, ripple/undervoltage)\n        {\n            \"Ts\": 100e-6,\n            \"i_s_k\": np.array([-12.0, 3.0]),\n            \"psi_s_km1\": np.array([-0.600000, 0.050000]),\n            \"psi_s_k\": np.array([-0.619400, 0.049850]),\n            \"k_prev\": 4,\n            \"V_dc_km1\": 320.0,\n            \"psi_s_ref_mag\": 0.700000,\n            \"T_e_ref\": 10.000000,\n        },\n        # Case 4 (zero torque error, measurement disturbance)\n        {\n            \"Ts\": 50e-6,\n            \"i_s_k\": np.array([3.0, -6.0]),\n            \"psi_s_km1\": np.array([0.400000, -0.300000]),\n            \"psi_s_k\": np.array([0.409175, -0.315938]),\n            \"k_prev\": 6,\n            \"V_dc_km1\": 550.0,\n            \"psi_s_ref_mag\": 0.500000,\n            \"T_e_ref\": -4.521708,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Stage 1: Vdc Observer ---\n        \n        # Estimate stator voltage from discrete-time model\n        v_s_est = R_s * case[\"i_s_k\"] + (case[\"psi_s_k\"] - case[\"psi_s_km1\"]) / case[\"Ts\"]\n        \n        # Get previously applied unit vector\n        u_prev = u_vectors[case[\"k_prev\"]]\n        \n        # Calculate raw DC-link voltage estimate\n        V_dc_raw = (3.0 / 2.0) * np.dot(v_s_est, u_prev)\n        \n        # Apply first-order filter to get V_dc[k]\n        V_dc_k = case[\"V_dc_km1\"] + gamma * (V_dc_raw - case[\"V_dc_km1\"])\n        \n        # --- Stage 2: Predictive Switching Decision ---\n        \n        costs = []\n        # Test each of the 6 candidate switching states\n        for k_candidate in range(1, 7):\n            u_candidate = u_vectors[k_candidate]\n            \n            # Predict applied stator voltage\n            v_s_k_est = (2.0 / 3.0) * V_dc_k * u_candidate\n            \n            # Predict next stator flux vector\n            psi_s_next = case[\"psi_s_k\"] + case[\"Ts\"] * (v_s_k_est - R_s * case[\"i_s_k\"])\n\n            # Predict next electromagnetic torque\n            psi_s_alpha_next = psi_s_next[0]\n            psi_s_beta_next = psi_s_next[1]\n            i_s_alpha_k = case[\"i_s_k\"][0]\n            i_s_beta_k = case[\"i_s_k\"][1]\n            \n            T_e_next = (3.0 / 2.0) * p * (psi_s_alpha_next * i_s_beta_k - psi_s_beta_next * i_s_alpha_k)\n\n            # Calculate cost function J(k)\n            psi_s_next_mag = np.linalg.norm(psi_s_next)\n            \n            cost = (\n                w_psi * abs(psi_s_next_mag - case[\"psi_s_ref_mag\"]) +\n                w_T * abs(case[\"T_e_ref\"] - T_e_next)\n            )\n            costs.append(cost)\n\n        # Find the index of the minimum cost. Add 1 for 1-based indexing.\n        k_star = np.argmin(costs) + 1\n        \n        results.append([V_dc_k, k_star])\n\n    # --- Format output ---\n    # Example format: [[v1,k1],[v2,k2],[v3,k3],[v4,k4]] with no spaces\n    result_strings = [f\"[{v:.6f},{k}]\" for v, k in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}