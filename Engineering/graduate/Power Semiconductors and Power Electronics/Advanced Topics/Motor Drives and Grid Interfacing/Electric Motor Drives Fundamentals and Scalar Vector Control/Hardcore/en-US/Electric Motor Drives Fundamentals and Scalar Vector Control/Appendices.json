{
    "hands_on_practices": [
        {
            "introduction": "Space Vector Modulation (SVM) is a sophisticated PWM technique that provides optimal use of the DC bus voltage and generates lower harmonic distortion compared to simpler methods. This practice guides you through the core calculations of SVM, from deriving dwell times to selecting a switching sequence that minimizes losses. Mastering these steps  is essential for implementing high-performance vector control for any electric motor drive.",
            "id": "3837777",
            "problem": "You are given a two-level, three-phase Voltage Source Inverter (VSI) driving an electric machine under Space Vector Modulation (SVM). The inverter legs are modeled as ideal switches connected to a Direct Current (DC) bus of voltage $V_{\\mathrm{dc}}$. Each leg $x \\in \\{a,b,c\\}$ has a binary switching state $S_x \\in \\{0,1\\}$, where $S_x=1$ denotes the upper device on and $S_x=0$ denotes the lower device on. The leg pole voltage relative to the DC bus midpoint is $v_{xN} = (2 S_x - 1)\\, V_{\\mathrm{dc}}/2$. The phase terminal voltages $v_a$, $v_b$, and $v_c$ relative to the machine star point satisfy $v_x = v_{xN} - v_{\\mathrm{cm}}$, where the common-mode voltage $v_{\\mathrm{cm}}$ is defined as $v_{\\mathrm{cm}} = (v_{aN} + v_{bN} + v_{cN})/3$. \n\nYou are tasked to compute, for a desired reference stator voltage space-vector trajectory over one switching period, a switching sequence that minimizes the total number of switching transitions, and to quantify the resulting common-mode voltage. The trajectory is specified by the space-vector magnitude $V_{\\mathrm{ref}}$ and electrical angle $\\theta$ in radians; the DC bus voltage $V_{\\mathrm{dc}}$ and switching period $T_s$ are also given. The initial condition is the inverterâ€™s previous end state $s_{\\mathrm{prev}}$, encoded as an integer $s \\in \\{0,1,2,\\dots,7\\}$ with the mapping $s = 4 S_a + 2 S_b + S_c$, where $S_a$, $S_b$, and $S_c$ are the leg states for phases $a$, $b$, and $c$, respectively.\n\nFundamental base and constraints to be used:\n- The Clarke transformation and space-vector representation reduce the three-phase voltages to an $\\alpha\\beta$-plane vector. The feasible inverter space vectors are the six nonzero active vectors of equal magnitude at angles separated by $ \\pi/3 $ radians, and two zero vectors at the origin. \n- Over one switching period $T_s$, the desired average reference vector is produced by dwelling on two adjacent active vectors and possibly the zero vector. Let the sector be the set of angles between two adjacent active vectors. For a desired $V_{\\mathrm{ref}}$ with angle $\\theta$ inside a sector, the two dwell times $T_1$ and $T_2$ for the adjacent active vectors and the remaining zero-vector time $T_0=T_s - T_1 - T_2$ must be derived from first principles by resolving the vector average equation in the $\\alpha\\beta$ plane. No shortcut or pre-tabulated formula may be used in the derivation; you must derive from the geometry and the leg-voltage model stated above.\n- The common-mode voltage levels during each switching state must be determined from $v_{\\mathrm{cm}} = (v_{aN} + v_{bN} + v_{cN})/3$. You must quantify the Root Mean Square (RMS) of the common-mode voltage over the switching period as $V_{\\mathrm{cm,RMS}} = \\sqrt{\\left( \\sum_i t_i\\, v_{\\mathrm{cm},i}^2\\right) / T_s }$, where $t_i$ and $v_{\\mathrm{cm},i}$ are the dwell time and common-mode voltage during the $i$-th subinterval.\n- The switching sequence over one period is restricted to four subintervals in order: start at a zero vector, then dwell on the first active vector, then the second active vector, and finally end at a zero vector. The two active vectors must be the adjacent ones in the identified sector. The zero vector can be either $s=0$ (all lower devices on) or $s=7$ (all upper devices on). The total zero-vector dwell $T_0$ must be split equally at the beginning and end, so each zero-vector subinterval has duration $T_0/2$. Among all such candidate sequences formed by choosing the zero vectors (start and end) and the order of the two active vectors, select the one that minimizes the total number of switching transitions. The total number of transitions is the sum, over all consecutive pairs of states in the period (including the transition from the previous end state $s_{\\mathrm{prev}}$ to the starting zero vector), of the Hamming distance between the three leg-state bits.\n- Angles must be in radians. All voltage answers must be expressed in volts, and time in seconds.\n\nTest suite and required output:\n- Implement a program that, for each test case $(V_{\\mathrm{dc}}, T_s, V_{\\mathrm{ref}}, \\theta, s_{\\mathrm{prev}})$, computes:\n    $1)$ the selected four-state switching sequence as a list of integers $[s_1,s_2,s_3,s_4]$ using the encoding $s = 4 S_a + 2 S_b + S_c$, and\n    $2)$ the common-mode voltage RMS $V_{\\mathrm{cm,RMS}}$ over the switching period in volts.\n- Use the following test cases, each tuple $(V_{\\mathrm{dc}}, T_s, V_{\\mathrm{ref}}, \\theta, s_{\\mathrm{prev}})$:\n    $1)$ $(600,\\; 1.0\\times 10^{-4},\\; 200,\\; 0.3,\\; 0)$,\n    $2)$ $(600,\\; 1.0\\times 10^{-4},\\; 330,\\; \\pi/3 - 10^{-6},\\; 7)$,\n    $3)$ $(600,\\; 1.0\\times 10^{-4},\\; 1,\\; 2.0,\\; 3)$,\n    $4)$ $(600,\\; 1.0\\times 10^{-4},\\; 340,\\; 4.2,\\; 2)$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is a two-element list $[\\,[s_1,s_2,s_3,s_4],\\; V_{\\mathrm{cm,RMS}}\\,]$. For example: $[[[s_1,s_2,s_3,s_4],V_1],[[...],V_2],...]$. The numeric values must be floats or integers, with the RMS expressed in volts.\n\nYour implementation must be fully self-contained, must not read any input, and must not use any external files or network access. Derivations must be based on the leg-voltage model and space-vector geometry stated above and must avoid shortcut formulas in the problem statement.",
            "solution": "The provided problem is valid as it is scientifically grounded in the principles of power electronics and electric motor control, specifically Space Vector Modulation (SVM). The problem is well-posed, objective, and contains all necessary information to derive a unique solution. The numerical values are within realistic ranges for a voltage source inverter drive system. I will proceed with a full derivation and solution.\n\nThe solution process involves several steps:\n1.  Derivation of the inverter's space voltage vectors from the given leg voltage model.\n2.  Derivation of the dwell times for the SVM algorithm from first principles.\n3.  Formulation of the optimization problem to select a switching sequence that minimizes switching transitions.\n4.  Derivation of the Root Mean Square (RMS) common-mode voltage.\n5.  Application of this methodology to the provided test cases.\n\n**1. Inverter Space Vectors**\n\nA two-level three-phase inverter has $2^3 = 8$ possible switching states, defined by the triplet $(S_a, S_b, S_c)$, where $S_x \\in \\{0, 1\\}$. The state is encoded as an integer $s = 4S_a + 2S_b + S_c$. The voltage of each leg's pole with respect to the DC bus midpoint is given by $v_{xN} = (S_x - 1/2)V_{\\mathrm{dc}}$.\n\nThe three-phase voltages are transformed into a two-dimensional space vector $\\mathbf{v} = v_\\alpha + j v_\\beta$ using the amplitude-invariant Clarke transformation:\n$$\nv_\\alpha = \\frac{2}{3}(v_{aN} - \\frac{1}{2}v_{bN} - \\frac{1}{2}v_{cN})\n$$\n$$\nv_\\beta = \\frac{2}{3}\\frac{\\sqrt{3}}{2}(v_{bN} - v_{cN}) = \\frac{1}{\\sqrt{3}}(v_{bN} - v_{cN})\n$$\nSubstituting the expression for $v_{xN}$:\n$$\nv_\\alpha = \\frac{2}{3} V_{\\mathrm{dc}} \\left[ (S_a - \\frac{1}{2}) - \\frac{1}{2}(S_b - \\frac{1}{2}) - \\frac{1}{2}(S_c - \\frac{1}{2}) \\right] = \\frac{V_{\\mathrm{dc}}}{3} (2S_a - S_b - S_c)\n$$\n$$\nv_\\beta = \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}} \\left[ (S_b - \\frac{1}{2}) - (S_c - \\frac{1}{2}) \\right] = \\frac{V_{\\mathrm{dc}}}{\\sqrt{3}} (S_b - S_c)\n$$\nUsing these formulae, the 8 states produce 8 voltage vectors. States $s=0$ $(000)$ and $s=7$ $(111)$ result in zero vectors ($\\mathbf{V}_0 = \\mathbf{V}_7 = 0$). The other 6 states produce active vectors of magnitude $\\frac{2}{3}V_{\\mathrm{dc}}$, with angles separated by $\\pi/3$ radians, forming a hexagon in the $\\alpha\\beta$ plane. The standard active vectors and their corresponding states are:\n- $\\mathbf{V}_1$ (state $s=4, 100$): angle $0$\n- $\\mathbf{V}_2$ (state $s=6, 110$): angle $\\pi/3$\n- $\\mathbf{V}_3$ (state $s=2, 010$): angle $2\\pi/3$\n- $\\mathbf{V}_4$ (state $s=3, 011$): angle $\\pi$\n- $\\mathbf{V}_5$ (state $s=1, 001$): angle $4\\pi/3$\n- $\\mathbf{V}_6$ (state $s=5, 101$): angle $5\\pi/3$\n\n**2. Dwell Time Derivation from First Principles**\n\nSVM synthesizes a reference voltage vector $\\mathbf{V}_{\\mathrm{ref}} = V_{\\mathrm{ref}} e^{j\\theta}$ by averaging two adjacent active vectors and a zero vector over a switching period $T_s$. The averaging principle is:\n$$\n\\mathbf{V}_{\\mathrm{ref}} = \\frac{1}{T_s}(T_1 \\mathbf{V}_k + T_2 \\mathbf{V}_{k+1} + T_0 \\mathbf{V}_{\\mathrm{zero}})\n$$\nwhere $\\mathbf{V}_k$ and $\\mathbf{V}_{k+1}$ are the two active vectors bounding the sector containing $\\mathbf{V}_{\\mathrm{ref}}$, and $T_1$, $T_2$ are their respective dwell times. $T_0$ is the total dwell time for the zero vector. Since $\\mathbf{V}_{\\mathrm{zero}}=0$, the equation simplifies to $T_s \\mathbf{V}_{\\mathrm{ref}} = T_1 \\mathbf{V}_k + T_2 \\mathbf{V}_{k+1}$. The total time is constrained by $T_s = T_1 + T_2 + T_0$.\n\nTo solve for $T_1$ and $T_2$, we project the vector equation onto an orthogonal basis. We define a coordinate system with its u-axis aligned with the first active vector, $\\mathbf{V}_k$. Let the sector index be $k_{sec} \\in \\{0, \\dots, 5\\}$, such that $\\mathbf{V}_{\\mathrm{ref}}$ lies between the vector at angle $k_{sec}\\pi/3$ and $(k_{sec}+1)\\pi/3$. The angle of $\\mathbf{V}_{\\mathrm{ref}}$ within the sector is $\\theta' = \\theta - k_{sec}\\pi/3$.\nIn this rotated frame, the vectors are:\n- $\\mathbf{V}_{\\mathrm{ref}}$: $(V_{\\mathrm{ref}} \\cos \\theta', V_{\\mathrm{ref}} \\sin \\theta')$\n- $\\mathbf{V}_k$: $(V_s, 0)$, where $V_s = \\frac{2}{3}V_{\\mathrm{dc}}$ is the magnitude of active vectors.\n- $\\mathbf{V}_{k+1}$: $(V_s \\cos(\\pi/3), V_s \\sin(\\pi/3)) = (V_s/2, V_s \\sqrt{3}/2)$\n\nThe vector equation decomposes into two scalar equations:\n$$\nT_s V_{\\mathrm{ref}} \\cos \\theta' = T_1 V_s + T_2 (V_s/2)\n$$\n$$\nT_s V_{\\mathrm{ref}} \\sin \\theta' = T_2 (V_s \\sqrt{3}/2)\n$$\nFrom the second equation, we solve for $T_2$:\n$$\nT_2 = \\frac{2 T_s V_{\\mathrm{ref}} \\sin \\theta'}{V_s \\sqrt{3}} = \\frac{2 T_s V_{\\mathrm{ref}} \\sin \\theta'}{(\\frac{2}{3}V_{\\mathrm{dc}}) \\sqrt{3}} = \\frac{\\sqrt{3} T_s V_{\\mathrm{ref}}}{V_{\\mathrm{dc}}} \\sin(\\theta')\n$$\nSubstituting $T_2$ into the first equation to find $T_1$:\n$$\nT_1 = \\frac{T_s V_{\\mathrm{ref}} \\cos \\theta'}{V_s} - \\frac{T_2}{2} = \\frac{T_s V_{\\mathrm{ref}}}{V_s} \\left( \\cos \\theta' - \\frac{\\sin \\theta'}{\\sqrt{3}} \\right) = \\frac{T_s V_{\\mathrm{ref}}}{V_s} \\frac{2}{\\sqrt{3}} \\sin(\\pi/3 - \\theta')\n$$\n$$\nT_1 = \\frac{T_s V_{\\mathrm{ref}}}{(\\frac{2}{3}V_{\\mathrm{dc}})} \\frac{2}{\\sqrt{3}} \\sin(\\pi/3 - \\theta') = \\frac{\\sqrt{3} T_s V_{\\mathrm{ref}}}{V_{\\mathrm{dc}}} \\sin(\\pi/3 - \\theta')\n$$\nThe remaining time is the zero-vector time, $T_0 = T_s - T_1 - T_2$. If $V_{\\mathrm{ref}}$ exceeds the linear modulation range ($T_1+T_2  T_s$), the dwell times are scaled to saturate at $T_s$, resulting in $T_0=0$.\n\n**3. Optimal Switching Sequence**\n\nThe switching sequence is structured as four segments: zero vector, first active vector, second active vector, zero vector. The total zero time $T_0$ is split evenly, so the durations are $(T_0/2, T_{act1}, T_{act2}, T_0/2)$. We must choose the start/end zero vectors ($s_{z1}, s_{z2} \\in \\{0, 7\\}$) and the order of active vectors ($s_{act1}, s_{act2}$) to minimize the total number of switching transitions. The cost is the sum of Hamming distances between consecutive states, starting from the previous state $s_{\\mathrm{prev}}$:\n$$\n\\mathrm{Cost} = H(s_{\\mathrm{prev}}, s_{z1}) + H(s_{z1}, s_{act1}) + H(s_{act1}, s_{act2}) + H(s_{act2}, s_{z2})\n$$\nThe Hamming distance $H(s_i, s_j)$ is the number of differing bits in the binary representations of $s_i$ and $s_j$. Since adjacent active vectors differ by only one bit, $H(s_{act1}, s_{act2})=1$. There are 8 candidate sequences for each operating point, formed by choosing $s_{z1} \\in \\{0,7\\}$, $s_{z2} \\in \\{0,7\\}$, and the order of active vectors. We evaluate the cost for all 8 candidates and select the sequence with the minimum cost.\n\n**4. RMS Common-Mode Voltage**\n\nThe common-mode voltage for a switching state $s=(S_a,S_b,S_c)$ is:\n$$\nv_{\\mathrm{cm}}(s) = \\frac{v_{aN} + v_{bN} + v_{cN}}{3} = \\frac{1}{3} \\sum_{x \\in \\{a,b,c\\}} (S_x - \\frac{1}{2})V_{\\mathrm{dc}} = \\frac{V_{\\mathrm{dc}}}{6} (2(S_a+S_b+S_c) - 3)\n$$\nLet $p(s) = S_a+S_b+S_c$ be the population count of the state's binary representation. Then $v_{\\mathrm{cm}}(s) = \\frac{V_{\\mathrm{dc}}}{6} (2p(s) - 3)$. The possible values for $v_{\\mathrm{cm}}^2$ are:\n- Zero vectors ($s=0, p=0$ or $s=7, p=3$): $v_{\\mathrm{cm}}(0) = -V_{\\mathrm{dc}}/2$, $v_{\\mathrm{cm}}(7) = +V_{\\mathrm{dc}}/2$. So $v_{\\mathrm{cm}}^2 = V_{\\mathrm{dc}}^2/4$.\n- Active vectors (p=1 or p=2): $v_{\\mathrm{cm}}(p=1)=-V_{\\mathrm{dc}}/6$, $v_{\\mathrm{cm}}(p=2)=+V_{\\mathrm{dc}}/6$. So $v_{\\mathrm{cm}}^2 = V_{\\mathrm{dc}}^2/36$.\n\nThe RMS value over the four-segment period $[s_1, s_2, s_3, s_4]$ with durations $[T_0/2, T_{act1}, T_{act2}, T_0/2]$ is:\n$$\nV_{\\mathrm{cm,RMS}}^2 = \\frac{1}{T_s} \\left[ \\frac{T_0}{2} v_{\\mathrm{cm}}(s_1)^2 + T_{act1} v_{\\mathrm{cm}}(s_2)^2 + T_{act2} v_{\\mathrm{cm}}(s_3)^2 + \\frac{T_0}{2} v_{\\mathrm{cm}}(s_4)^2 \\right]\n$$\nSince the squared common-mode voltage is the same for both zero vectors, and for any pair of adjacent active vectors (one has $p=1$, the other $p=2$), the expression simplifies regardless of the chosen sequence:\n$$\nV_{\\mathrm{cm,RMS}}^2 = \\frac{1}{T_s} \\left[ T_0 \\left(\\frac{V_{\\mathrm{dc}}^2}{4}\\right) + (T_1+T_2)\\left(\\frac{V_{\\mathrm{dc}}^2}{36}\\right) \\right]\n$$\nUsing $T_1+T_2 = T_s-T_0$:\n$$\nV_{\\mathrm{cm,RMS}}^2 = \\frac{V_{\\mathrm{dc}}^2}{T_s} \\left[ \\frac{T_0}{4} + \\frac{T_s-T_0}{36} \\right] = \\frac{V_{\\mathrm{dc}}^2}{36 T_s} [9T_0 + T_s - T_0] = \\frac{V_{\\mathrm{dc}}^2}{36 T_s} [8T_0 + T_s]\n$$\n$$\nV_{\\mathrm{cm,RMS}} = \\frac{V_{\\mathrm{dc}}}{6} \\sqrt{8 \\frac{T_0}{T_s} + 1}\n$$\nThis shows that $V_{\\mathrm{cm,RMS}}$ depends only on the DC link voltage and the fraction of the switching period spent in a zero state.\n\n**5. Algorithm and Implementation**\n\nThe algorithm proceeds as follows for each test case:\n1.  Normalize the input angle $\\theta$ to the range $[0, 2\\pi)$.\n2.  Determine the sector index $k_{sec} = \\lfloor \\theta / (\\pi/3) \\rfloor$.\n3.  Identify the two adjacent active states, $S_u$ and $S_v$, for this sector.\n4.  Calculate the angle within the sector, $\\theta' = \\theta - k_{sec}\\pi/3$.\n5.  Compute the dwell times $T_1$ (for $S_u$) and $T_2$ (for $S_v$). Handle saturation if $T_1+T_2  T_s$ by scaling them proportionally so their sum is $T_s$.\n6.  Calculate the total zero time $T_0 = T_s - T_1 - T_2$.\n7.  Generate all 8 candidate switching sequences. For each sequence, calculate the total switching cost (sum of Hamming distances).\n8.  Select the sequence with the minimum cost. In case of a tie, the first one found is chosen.\n9.  Calculate $V_{\\mathrm{cm,RMS}}$ using the derived formula with the final $T_0$.\n10. Store the optimal sequence and the calculated $V_{\\mathrm{cm,RMS}}$.\nThis procedure is implemented in the provided Python code.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the SVM problem for a two-level VSI for a given set of test cases.\n    It computes the optimal switching sequence and the RMS common-mode voltage.\n    \"\"\"\n\n    test_cases = [\n        (600, 1.0e-4, 200, 0.3, 0),\n        (600, 1.0e-4, 330, np.pi/3 - 1e-6, 7),\n        (600, 1.0e-4, 1, 2.0, 3),\n        (600, 1.0e-4, 340, 4.2, 2)\n    ]\n    \n    # Active voltage vectors states keyed by sector index (0-5)\n    # The states correspond to vectors at k*pi/3 and (k+1)*pi/3\n    active_states_by_sector = {\n        0: (4, 6),  # Sector 1: 0 to pi/3\n        1: (6, 2),  # Sector 2: pi/3 to 2pi/3\n        2: (2, 3),  # Sector 3: 2pi/3 to pi\n        3: (3, 1),  # Sector 4: pi to 4pi/3\n        4: (1, 5),  # Sector 5: 4pi/3 to 5pi/3\n        5: (5, 4)   # Sector 6: 5pi/3 to 2pi\n    }\n    \n    def hamming_distance(n1, n2):\n        \"\"\"Calculates the Hamming distance between two integers.\"\"\"\n        return bin(n1 ^ n2).count('1')\n\n    results = []\n    for V_dc, T_s, V_ref, theta, s_prev in test_cases:\n        # Step 1: Normalize angle and find sector\n        theta_norm = np.fmod(theta, 2 * np.pi)\n        if theta_norm  0:\n            theta_norm += 2 * np.pi\n        \n        # Handle edge case where theta is exactly 2*pi\n        if np.isclose(theta_norm, 2 * np.pi):\n            sector_idx = 0\n        else:\n            sector_idx = int(theta_norm / (np.pi / 3))\n\n        theta_prime = theta_norm - sector_idx * (np.pi / 3)\n\n        # Step 2: Calculate dwell times\n        # The constants are derived from the first-principles derivation\n        a = (np.sqrt(3) * T_s * V_ref) / V_dc\n        \n        # T1 is for the first vector of the sector, T2 for the second\n        T1 = a * np.sin(np.pi/3 - theta_prime)\n        T2 = a * np.sin(theta_prime)\n\n        # Step 3: Handle overmodulation (saturation)\n        if T1 + T2  T_s:\n            T_total_active = T1 + T2\n            T1 = T1 * T_s / T_total_active\n            T2 = T2 * T_s / T_total_active\n        \n        T0 = T_s - (T1 + T2)\n        # Ensure T0 is not negative due to floating point inaccuracies\n        T0 = max(0, T0)\n\n        # Step 4: Find optimal switching sequence\n        S_u, S_v = active_states_by_sector[sector_idx]\n        zero_vectors = [0, 7]\n        best_sequence = []\n        min_cost = float('inf')\n\n        # There are 8 candidate sequences to check\n        # (start_zero, active_1, active_2, end_zero)\n        candidates = []\n        for z1 in zero_vectors:\n            for z2 in zero_vectors:\n                # Two possible orderings for active vectors\n                candidates.append((z1, S_u, S_v, z2))\n                candidates.append((z1, S_v, S_u, z2))\n\n        for seq in candidates:\n            s1, s2, s3, s4 = seq\n            cost = (hamming_distance(s_prev, s1) +\n                    hamming_distance(s1, s2) +\n                    hamming_distance(s2, s3) +\n                    hamming_distance(s3, s4))\n            \n            if cost  min_cost:\n                min_cost = cost\n                best_sequence = list(seq)\n        \n        # Step 5: Calculate RMS common-mode voltage\n        # V_cm_rms = (V_dc/6) * sqrt(8 * (T0/T_s) + 1)\n        V_cm_rms = (V_dc / 6.0) * np.sqrt(8 * (T0 / T_s) + 1)\n        \n        # Format the result for this test case\n        seq_str = '[' + ','.join(map(str, best_sequence)) + ']'\n        res_str = '[' + seq_str + ', ' + f'{V_cm_rms:.7f}' + ']'\n        results.append(res_str)\n\n    # Print a single line of output with all results\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A digital Proportional-Integral (PI) controller is the workhorse of motor current control, but its performance is fundamentally limited by the system's sampling time and computational delays. By analyzing the system in the frequency domain, you will derive the maximum achievable closed-loop bandwidth for a given phase margin, a critical skill for tuning high-speed current loops. This exercise  reveals the trade-off between stability and performance in digital control systems.",
            "id": "3837809",
            "problem": "A Permanent Magnet Synchronous Machine (PMSM) phase current inner loop in Field-Oriented Control (FOC) can be modeled, after decoupling and back-electromotive force feedforward, by the electrical dynamics $L \\,\\frac{di(t)}{dt} + R\\, i(t) = v(t)$, where $i(t)$ is the phase current and $v(t)$ is the applied phase voltage. The plant transfer function from control voltage to current is $G_{p}(s) = \\frac{1}{L s + R}$. A digital Proportional-Integral (PI) controller $C(s) = K_{p} + \\frac{K_{i}}{s}$ is implemented via the Bilinear Transform (BT), also known as the Tustin transform, with sampling period $T_{s}$. The digital control loop introduces a one-sample computational delay modeled as $z^{-1}$. Assume the controller zero is placed to cancel the plant pole by choosing $\\omega_{i} \\equiv \\frac{K_{i}}{K_{p}} = \\frac{R}{L}$.\n\nGiven $L = 1.5 \\times 10^{-3} \\,\\text{H}$, $R = 0.2 \\,\\Omega$, and $T_{s} = 100 \\,\\mu\\text{s}$, do the following:\n\n1. Starting from $C(s) = K_{p} + \\frac{K_{i}}{s}$ and the Bilinear Transform mapping $s \\mapsto \\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}$, derive the discrete-time implementation of the PI controller as a causal difference equation relating $u[k]$ and $e[k]$, where $u[k]$ is the control output and $e[k]$ is the current error at sample $k$.\n\n2. Model the one-sample delay as $z^{-1}$ in the forward path and use frequency-domain reasoning on the unit circle $z = \\exp(j \\omega T_{s})$ to determine the maximum achievable closed-loop bandwidth $\\omega_{b}^{\\max}$ such that the phase margin is at least $60$ degrees. You must use radians for all angles in the derivation. Treat the combined plant and PI controller, under the specified pole-zero cancellation, as an effective integrator in the open loop near crossover, and include the phase effect of the one-sample delay.\n\nExpress the final bandwidth in $\\text{rad}\\,\\text{s}^{-1}$ and round your answer to four significant figures.",
            "solution": "The problem is validated as scientifically sound, well-posed, and contains sufficient information to derive a unique solution.\n\n### Part 1: Derivation of the PI Controller Difference Equation\n\nThe continuous-time transfer function of the Proportional-Integral (PI) controller is given by:\n$$\nC(s) = \\frac{U(s)}{E(s)} = K_{p} + \\frac{K_{i}}{s}\n$$\nwhere $E(s)$ is the Laplace transform of the error signal $e(t)$ and $U(s)$ is the Laplace transform of the control output $u(t)$. This can be separated into a proportional part, $U_p(s) = K_p E(s)$, and an integral part, $U_i(s) = \\frac{K_i}{s} E(s)$.\n\nTo obtain the discrete-time implementation, we use the Bilinear Transform (BT), also known as the Tustin transform. The BT mapping is given as:\n$$\ns \\mapsto \\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}\n$$\nwhere $T_s$ is the sampling period.\n\nThe proportional part is purely a gain, so in the discrete domain, it remains $U_p(z) = K_p E(z)$.\n\nThe integral part requires discretizing the integrator term $\\frac{1}{s}$. Applying the BT to the integrator gives:\n$$\n\\frac{1}{s} \\mapsto \\frac{1}{\\frac{2}{T_{s}} \\frac{1 - z^{-1}}{1 + z^{-1}}} = \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}}\n$$\nThus, the z-transform of the integral part of the controller is:\n$$\nU_i(z) = K_i \\left( \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}} \\right) E(z)\n$$\nThe complete discrete-time controller transfer function $C(z) = \\frac{U(z)}{E(z)}$ is the sum of the proportional and integral parts:\n$$\n\\frac{U(z)}{E(z)} = K_p + K_i \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}}\n$$\nTo find the difference equation, we express this relationship in terms of $U(z)$ and $E(z)$:\n$$\nU(z) = \\left( K_p + K_i \\frac{T_s}{2} \\frac{1 + z^{-1}}{1 - z^{-1}} \\right) E(z)\n$$\nMultiplying both sides by $(1 - z^{-1})$ to clear the denominator:\n$$\nU(z)(1 - z^{-1}) = \\left( K_p(1 - z^{-1}) + K_i \\frac{T_s}{2}(1 + z^{-1}) \\right) E(z)\n$$\nExpanding the terms:\n$$\nU(z) - z^{-1}U(z) = \\left( K_p - K_p z^{-1} + K_i \\frac{T_s}{2} + K_i \\frac{T_s}{2} z^{-1} \\right) E(z)\n$$\nGrouping terms by powers of $z^{-1}$:\n$$\nU(z) - z^{-1}U(z) = \\left( K_p + K_i \\frac{T_s}{2} \\right) E(z) + \\left( -K_p + K_i \\frac{T_s}{2} \\right) z^{-1}E(z)\n$$\nThe inverse z-transform ($z^{-k}X(z) \\leftrightarrow x[n-k]$) yields the difference equation relating the current output $u[k]$ to the past output $u[k-1]$ and the current and past error samples, $e[k]$ and $e[k-1]$:\n$$\nu[k] - u[k-1] = \\left( K_p + K_i \\frac{T_s}{2} \\right) e[k] - \\left( K_p - K_i \\frac{T_s}{2} \\right) e[k-1]\n$$\nRearranging to solve for $u[k]$, we get the causal difference equation:\n$$\nu[k] = u[k-1] + \\left( K_p + \\frac{K_i T_s}{2} \\right) e[k] - \\left( K_p - \\frac{K_i T_s}{2} \\right) e[k-1]\n$$\nThis equation represents the discrete-time implementation of the PI controller. The problem specifies the pole-zero cancellation condition $\\frac{K_i}{K_p} = \\frac{R}{L}$. Substituting $K_i = K_p \\frac{R}{L}$ into the equation gives:\n$$\nu[k] = u[k-1] + K_p \\left(1 + \\frac{R T_s}{2 L}\\right) e[k] - K_p \\left(1 - \\frac{R T_s}{2 L}\\right) e[k-1]\n$$\n\n### Part 2: Maximum Closed-Loop Bandwidth Calculation\n\nThe problem asks us to determine the maximum achievable closed-loop bandwidth $\\omega_b^{\\max}$ while maintaining a phase margin (PM) of at least $60$ degrees.\n\nThe open-loop system consists of the PI controller, the plant, and a one-sample computational delay.\nThe plant transfer function is $G_p(s) = \\frac{1}{Ls+R} = \\frac{1/L}{s+R/L}$.\nThe PI controller transfer function is $C(s) = K_p + \\frac{K_i}{s} = K_p \\frac{s + K_i/K_p}{s}$.\nThe problem directs us to use the pole-zero cancellation strategy, where the controller zero at $s = -K_i/K_p$ cancels the plant pole at $s = -R/L$. This implies setting $K_i/K_p = R/L$.\n\nThe combined transfer function of the controller and plant in the continuous domain is:\n$$\nC(s) G_p(s) = \\left(K_p \\frac{s+R/L}{s}\\right) \\left(\\frac{1/L}{s+R/L}\\right) = \\frac{K_p/L}{s}\n$$\nThe problem instructs us to treat this compensated system as an \"effective integrator\". The digital control loop also introduces a one-sample computational delay, modeled as $z^{-1}$.\n\nTo perform a frequency-domain analysis, we evaluate the system on the unit circle, $z = \\exp(j \\omega T_s)$. The frequency response of the total open-loop system is the product of the frequency responses of the effective integrator and the delay.\nThe frequency response of the effective integrator $\\frac{K_p/L}{s}$ at a frequency $\\omega$ is $\\frac{K_p/L}{j\\omega}$. This has a magnitude of $\\frac{K_p}{L\\omega}$ and a constant phase of $-\\frac{\\pi}{2}$ radians.\nThe frequency response of the one-sample delay $z^{-1}$ is $\\exp(-j\\omega T_s)$. This has a magnitude of $1$ and a phase of $-\\omega T_s$ radians.\n\nThe total open-loop frequency response $G_{ol}(j\\omega)$ is therefore approximately:\n$$\nG_{ol}(j\\omega) \\approx \\frac{K_p/L}{j\\omega} \\exp(-j\\omega T_s)\n$$\nThe phase of the open-loop system is the sum of the phases of the integrator and the delay:\n$$\n\\angle G_{ol}(j\\omega) = -\\frac{\\pi}{2} - \\omega T_s\n$$\nThe phase margin (PM) is defined at the gain crossover frequency $\\omega_{gc}$, where $|G_{ol}(j\\omega_{gc})| = 1$. The phase margin is given by:\n$$\n\\text{PM} = \\pi + \\angle G_{ol}(j\\omega_{gc}) = \\pi + \\left( -\\frac{\\pi}{2} - \\omega_{gc} T_s \\right) = \\frac{\\pi}{2} - \\omega_{gc} T_s\n$$\nThe problem requires a phase margin of at least $60^\\circ$, which is $\\frac{\\pi}{3}$ radians.\n$$\n\\text{PM} \\ge \\frac{\\pi}{3} \\implies \\frac{\\pi}{2} - \\omega_{gc} T_s \\ge \\frac{\\pi}{3}\n$$\nSolving for $\\omega_{gc} T_s$:\n$$\n\\omega_{gc} T_s \\le \\frac{\\pi}{2} - \\frac{\\pi}{3} = \\frac{3\\pi - 2\\pi}{6} = \\frac{\\pi}{6}\n$$\nThis inequality sets the upper limit on the achievable gain crossover frequency. To maximize bandwidth, we operate at this limit:\n$$\n\\omega_{gc}^{\\max} = \\frac{\\pi}{6 T_s}\n$$\nFor a well-damped system, which a phase margin of $60^\\circ$ ensures, the closed-loop $-3\\,\\text{dB}$ bandwidth $\\omega_b$ is closely approximated by the gain crossover frequency $\\omega_{gc}$. Therefore, we can state that the maximum achievable closed-loop bandwidth is $\\omega_b^{\\max} \\approx \\omega_{gc}^{\\max}$.\n\nGiven the sampling period $T_s = 100 \\,\\mu\\text{s} = 1.0 \\times 10^{-4} \\,\\text{s}$, we can calculate the numerical value:\n$$\n\\omega_b^{\\max} \\approx \\frac{\\pi}{6 \\times (1.0 \\times 10^{-4} \\,\\text{s})} = \\frac{\\pi}{6} \\times 10^4 \\,\\text{rad}\\,\\text{s}^{-1}\n$$\n$$\n\\omega_b^{\\max} \\approx (0.5235987...) \\times 10^4 \\,\\text{rad}\\,\\text{s}^{-1} \\approx 5235.987... \\,\\text{rad}\\,\\text{s}^{-1}\n$$\nRounding the result to four significant figures as requested:\n$$\n\\omega_b^{\\max} \\approx 5236 \\,\\text{rad}\\,\\text{s}^{-1}\n$$\nThe values for $L = 1.5 \\times 10^{-3} \\,\\text{H}$ and $R = 0.2 \\,\\Omega$ were necessary to justify the pole-zero cancellation method but are not directly required for the bandwidth calculation itself, which depends only on $T_s$ and the desired phase margin.",
            "answer": "$$\n\\boxed{5236}\n$$"
        },
        {
            "introduction": "The voltage available from an inverter is finite, and demanding more voltage than is available leads to overmodulation, a nonlinearity that can degrade performance and cause instability. This exercise  teaches you how to design a current controller that respects these physical limits by calculating a conservative bound for the proportional gain based on worst-case conditions. This proactive design approach ensures stable operation during large transients, a crucial aspect of robust motor drive design.",
            "id": "3837749",
            "problem": "A surface-mounted Permanent Magnet Synchronous Machine (PMSM) is controlled by Field-Oriented Control (FOC) in the synchronous $dq$ frame. The $q$-axis current loop uses a Proportional-Integral (PI) controller to command the $q$-axis inverter voltage. The voltage-source inverter employs Space Vector Pulse Width Modulation (SVPWM). Assume the cross-coupling terms are fully compensated and the back-electromotive force (EMF) feedforward is applied so that the controller output is summed with a feedforward term equal to the back-EMF. The inverter is modeled as an amplitude limiter whose linear modulation region can produce a maximum fundamental voltage magnitude of $V_{\\text{lim}} = V_{\\text{dc}}/\\sqrt{3}$ in the $dq$ frame. Overmodulation beyond this limit introduces nonlinearity that reduces the effective low-frequency gain experienced by the current loop and can destabilize tracking near the modulation limit.\n\nThe PMSM $q$-axis dynamics (under $i_{d} = 0$ and exact cross-coupling compensation) are given by the well-tested electrical model $L \\, \\frac{d i_{q}}{d t} + R \\, i_{q} = v_{q} - \\omega_{e} \\, \\lambda_{f}$, where $L$ is the stator inductance, $R$ is the stator resistance, $\\omega_{e}$ is the electrical angular speed, and $\\lambda_{f}$ is the permanent magnet flux linkage. The PI controller produces a commanded regulation voltage $v_{q}^{\\ast} = K_{p} \\, e_{q} + K_{i} \\int e_{q} \\, dt$, with $e_{q} = i_{q}^{\\text{ref}} - i_{q}$, which is summed with the feedforward $+\\omega_{e} \\, \\lambda_{f}$ to form the inverter reference vector. The inverter saturates whenever the magnitude of the commanded $dq$ voltage vector exceeds $V_{\\text{lim}}$, i.e., whenever $\\left\\| [v_{d}^{\\ast}, v_{q}^{\\ast} + \\omega_{e} \\, \\lambda_{f}] \\right\\| > V_{\\text{lim}}$.\n\nYou are asked to analyze the effect of overmodulation on current tracking and redesign the proportional gain to avoid entering the nonlinear modulation region at the worst-case $q$-axis current step. Consider the following operating point and parameters:\n\n- Direct-current bus voltage $V_{\\text{dc}} = 540 \\ \\mathrm{V}$.\n- Linear modulation limit $V_{\\text{lim}} = V_{\\text{dc}} / \\sqrt{3}$.\n- Electrical speed $\\omega_{e} = 1200 \\ \\mathrm{rad/s}$.\n- Flux linkage $\\lambda_{f} = 0.12 \\ \\mathrm{Wb}$.\n- Stator resistance $R = 0.2 \\ \\Omega$.\n- Stator inductance $L = 0.8 \\ \\mathrm{mH}$.\n- Initial condition $i_{q}(0^{-}) = 0 \\ \\mathrm{A}$ and a step command $i_{q}^{\\text{ref}}$ from $0 \\ \\mathrm{A}$ to $200 \\ \\mathrm{A}$ at $t = 0^{+}$.\n- $i_{d} \\equiv 0 \\ \\mathrm{A}$ throughout.\n\nStarting from the fundamental $q$-axis voltage equation and the definition of the modulation limit, derive a conservative design bound for the proportional gain $K_{p}$ that guarantees the commanded regulation voltage stays strictly within the linear SVPWM region at the instant of the step, so that the loop does not encounter inverter overmodulation at the worst-case transient. Use this bound to compute the redesigned proportional gain $K_{p}^{\\star}$ numerically for the given parameters. Round your answer to three significant figures and express it in $\\mathrm{V/A}$.",
            "solution": "The fundamental starting point is the $q$-axis voltage equation of the surface-mounted Permanent Magnet Synchronous Machine (PMSM) under synchronous frame control with $i_{d} = 0$ and exact cross-coupling compensation, which is a well-tested representation:\n$$\nL \\, \\frac{d i_{q}}{d t} + R \\, i_{q} = v_{q} - \\omega_{e} \\, \\lambda_{f}.\n$$\nIn Field-Oriented Control (FOC), a feedforward term equal to the back-electromotive force (EMF) $\\omega_{e} \\, \\lambda_{f}$ is typically summed with the controller output to linearize the plant seen by the feedback controller. Let the PI controller regulation output be\n$$\nv_{q}^{\\ast}(t) = K_{p} \\, e_{q}(t) + K_{i} \\int_{0}^{t} e_{q}(\\tau) \\, d\\tau,\n$$\nwhere $e_{q}(t) = i_{q}^{\\text{ref}}(t) - i_{q}(t)$. The inverter receives the commanded vector whose $q$-component is $v_{q}^{\\ast}(t) + \\omega_{e} \\, \\lambda_{f}$. The Space Vector Pulse Width Modulation (SVPWM) linear region constraint is modeled by the amplitude limit\n$$\n\\left\\| [v_{d}^{\\ast}(t), \\, v_{q}^{\\ast}(t) + \\omega_{e} \\, \\lambda_{f}] \\right\\| \\leq V_{\\text{lim}}, \\quad \\text{with} \\quad V_{\\text{lim} }= \\frac{V_{\\text{dc}}}{\\sqrt{3}}.\n$$\nSince $i_{d} \\equiv 0$ for a surface-mounted machine and cross-coupling is compensated, we have $v_{d}^{\\ast}(t) \\approx 0$ for regulation. Therefore the magnitude limit reduces to the scalar constraint\n$$\n|v_{q}^{\\ast}(t) + \\omega_{e} \\, \\lambda_{f}| \\leq V_{\\text{lim}}.\n$$\n\nOvermodulation occurs when the commanded magnitude exceeds $V_{\\text{lim}}$ and the inverter clips. In a describing-function sense, the clip introduces an amplitude-dependent effective gain $N(A) = V_{\\text{lim}}/A$ for command amplitude $A  V_{\\text{lim}}$, which reduces the low-frequency loop gain, distorts phase, and can destabilize a current loop designed under linear assumptions. To avoid entering this nonlinear regime during the worst-case transient, we design the proportional gain such that the initial regulation command stays strictly within the linear region at the instant of the step.\n\nAt $t = 0^{+}$ for a step $i_{q}^{\\text{ref}} = \\Delta i_{q}$ with initial $i_{q}(0^{-}) = 0$, the instantaneous error is $e_{q}(0^{+}) = \\Delta i_{q}$. The integrator state has not yet changed, so the initial regulation output is dominated by the proportional term:\n$$\nv_{q}^{\\ast}(0^{+}) \\approx K_{p} \\, \\Delta i_{q}.\n$$\nAdditionally, at the instant of the step, $i_{q}(0^{+}) \\approx 0$, so the resistive drop $R\\,i_{q}$ does not yet consume voltage margin; the back-EMF feedforward $\\omega_{e} \\, \\lambda_{f}$ is present and is a fixed offset that must be accommodated by the inverter. Therefore, the initial commanded voltage presented to the inverter is\n$$\nv_{\\text{cmd}}(0^{+}) = v_{q}^{\\ast}(0^{+}) + \\omega_{e} \\, \\lambda_{f} \\approx K_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\lambda_{f}.\n$$\nTo keep the inverter strictly inside its linear SVPWM region at the worst-case instant, we require\n$$\n|K_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\lambda_{f}| \\leq V_{\\text{lim}}.\n$$\nAll quantities are positive in this scenario, so the absolute value can be dropped and the conservative bound becomes\n$$\nK_{p} \\, \\Delta i_{q} + \\omega_{e} \\, \\lambda_{f} \\leq V_{\\text{lim}} \\quad \\Rightarrow \\quad K_{p} \\leq \\frac{V_{\\text{lim}} - \\omega_{e} \\, \\lambda_{f}}{\\Delta i_{q}}.\n$$\nThus, the redesigned proportional gain that guarantees avoidance of inverter overmodulation at the step is\n$$\nK_{p}^{\\star} = \\frac{V_{\\text{lim}} - \\omega_{e} \\, \\lambda_{f}}{\\Delta i_{q}}.\n$$\n\nWe now compute $K_{p}^{\\star}$ for the given parameters. First, compute the linear SVPWM limit:\n$$\nV_{\\text{lim}} = \\frac{V_{\\text{dc}}}{\\sqrt{3}} = \\frac{540 \\ \\mathrm{V}}{\\sqrt{3}}.\n$$\nThen compute the back-EMF:\n$$\n\\omega_{e} \\, \\lambda_{f} = 1200 \\ \\mathrm{rad/s} \\times 0.12 \\ \\mathrm{Wb} = 144 \\ \\mathrm{V}.\n$$\nThe worst-case step amplitude is\n$$\n\\Delta i_{q} = 200 \\ \\mathrm{A}.\n$$\nTherefore,\n$$\nK_{p}^{\\star} = \\frac{\\frac{540}{\\sqrt{3}} - 144}{200} \\ \\mathrm{\\frac{V}{A}}.\n$$\nEvaluate the numerator:\n$$\n\\frac{540}{\\sqrt{3}} \\approx 311.769145362 \\ \\mathrm{V}, \\quad \\Rightarrow \\quad 311.769145362 - 144 = 167.769145362 \\ \\mathrm{V}.\n$$\nDivide by $\\Delta i_{q}$:\n$$\nK_{p}^{\\star} \\approx \\frac{167.769145362}{200} = 0.83884572681 \\ \\mathrm{\\frac{V}{A}}.\n$$\nRounded to three significant figures as required,\n$$\nK_{p}^{\\star} \\approx 0.839 \\ \\mathrm{\\frac{V}{A}}.\n$$\n\nThis redesign ensures that, at the worst-case step, the controller remains within the linear SVPWM region, preventing the effective loop gain drop and phase distortion associated with overmodulation-induced clipping. With $K_{p}$ limited in this way, standard anti-windup back-calculation can then be employed for the integral term to avoid accumulator windup when other operating conditions transiently approach the limit, but the proportional action itself will not force the loop into the nonlinear regime at the specified operating point.",
            "answer": "$$\\boxed{0.839}$$"
        }
    ]
}