{
    "hands_on_practices": [
        {
            "introduction": "三次谐波注入技术的主要优点是提高直流母线电压利用率，从而在不增加硬件成本的情况下扩大逆变器的输出电压范围。本练习将引导你运用微积分和三角恒等式，从第一性原理出发，推导注入谐波幅值与可实现的最大基波幅值之间的精确关系。通过这个实践，你将深刻理解该技术的理论边界，并为实际应用中的参数选择提供坚实的数学基础。",
            "id": "3886113",
            "problem": "考虑一个三相电压源逆变器（VSI），其对 a 相采用带三次谐波注入的正弦脉宽调制（SPWM）。归一化的相参考电压由下式给出\n$$\nv_a^{*}(t) = m \\sin(\\omega t) + k \\sin(3 \\omega t),\n$$\n其中 $m$ 是基波调制幅值，$k > 0$ 是固定的三次谐波注入幅值，$\\omega$ 是角频率。角度以弧度为单位。归一化的直流（DC）母线电压为单位1，为避免过调制，参考电压必须满足\n$$\n|v_a^{*}(t)| \\leq 1 \\quad \\text{for all } t.\n$$\n从微积分和三角恒等式的基本原理出发，推导以下表达式的闭式解\n$$\n\\max_{t} v_a^{*}(t) \\quad \\text{和} \\quad \\min_{t} v_a^{*}(t),\n$$\n除了 $k > 0$ 外，不假设 $m$ 和 $k$ 之间有任何特殊关系。利用这些极值，求出最大允许基波调制幅值 $m$ 作为 $k$ 的函数的闭式表达式，使得对于所有 $t$ 都有 $|v_a^{*}(t)| \\leq 1$ 成立。将您的最终边界 $m_{\\max}(k)$ 表示为单个解析表达式。最终边界中不需要进行数值四舍五入，也不出现物理单位。",
            "solution": "问题是，在给定的三次谐波注入幅值 $k$ 下，求出最大允许基波调制幅值 $m$，使得归一化相参考电压 $v_a^{*}(t)$ 不超过归一化直流母线电压。\n\n归一化的相参考电压由下式给出\n$$v_a^{*}(t) = m \\sin(\\omega t) + k \\sin(3 \\omega t)$$\n约束条件为\n$$|v_a^{*}(t)| \\leq 1 \\quad \\text{for all } t.$$\n\n这等效于确保 $|v_a^{*}(t)|$ 的全局最大值小于或等于 1。令 $V_{peak} = \\max_t |v_a^{*}(t)|$。我们必须找到 $V_{peak}$ 作为 $m$ 和 $k$ 的函数的表达式，然后找到最大的 $m$（记为 $m_{max}(k)$），使得 $V_{peak} \\leq 1$。\n\n首先，我们推导 $v_a^{*}(t)$ 的最大值和最小值的表达式。令 $x = \\omega t$。由于 $t$ 遍历所有实数，$\\sin(\\omega t)$ 将遍历其完整范围 $[-1, 1]$。我们可以通过令 $s = \\sin(x) = \\sin(\\omega t)$ 来分析该函数，其中 $s \\in [-1, 1]$。使用正弦的三倍角恒等式 $\\sin(3x) = 3\\sin(x) - 4\\sin^3(x)$，我们可以将 $v_a^{*}(t)$ 重写为 $s$ 的函数：\n$$g(s) = m s + k (3s - 4s^3) = (m+3k)s - 4ks^3$$\n我们需要找到 $g(s)$ 在 $s \\in [-1, 1]$ 上的极值。极值可能出现在区间的边界（$s = \\pm 1$）或导数为零的区间内部的临界点。\n\n$g(s)$ 关于 $s$ 的导数是：\n$$g'(s) = \\frac{d}{ds} \\left( (m+3k)s - 4ks^3 \\right) = m+3k - 12ks^2$$\n将导数设为零以找到临界点 $s_c$：\n$$m+3k - 12ks_c^2 = 0 \\implies s_c^2 = \\frac{m+3k}{12k}$$\n为了使这些临界点是实数且在区间 $s \\in [-1, 1]$ 内，我们必须有 $0 \\leq s_c^2 \\leq 1$。\n由于 $m \\geq 0$ 和 $k > 0$，所以 $m+3k > 0$，因此 $s_c^2 > 0$ 总是满足的。\n条件 $s_c^2 \\leq 1$ 意味着：\n$$\\frac{m+3k}{12k} \\leq 1 \\implies m+3k \\leq 12k \\implies m \\leq 9k$$\n\n我们必须基于此条件分析两种情况。\n\n情况 1：$0 \\leq m \\leq 9k$。\n在这种情况下，临界点 $s_c = \\pm\\sqrt{\\frac{m+3k}{12k}}$ 位于区间 $[-1, 1]$ 内。可能的极值是 $g(s)$ 在这些临界点和边界 $s = \\pm 1$ 处的值。\n在临界点处的值：\n$$g(s_c) = (m+3k)s_c - 4ks_c^3 = s_c \\left( (m+3k) - 4ks_c^2 \\right)$$\n$$g(s_c) = s_c \\left( (m+3k) - 4k \\frac{m+3k}{12k} \\right) = s_c \\left( (m+3k) - \\frac{m+3k}{3} \\right) = \\frac{2}{3}(m+3k)s_c$$\n代入 $s_c = \\pm\\sqrt{\\frac{m+3k}{12k}}$：\n$$g(s_c) = \\pm \\frac{2}{3}(m+3k) \\sqrt{\\frac{m+3k}{12k}} = \\pm \\frac{2(m+3k)^{3/2}}{3\\sqrt{12k}} = \\pm \\frac{2(m+3k)^{3/2}}{3 \\cdot 2\\sqrt{3k}} = \\pm \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$$\n在边界处的值：\n$$g(1) = (m+3k) - 4k = m-k$$\n$$g(-1) = -(m+3k) + 4k = -m+k = -(m-k)$$\n为了确定这种情况下的全局最大值，我们比较 $|m-k|$ 和 $\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$。让我们比较它们的平方：\n$$(m-k)^2 \\quad \\text{vs.} \\quad \\left(\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}\\right)^2 = \\frac{(m+3k)^3}{27k}$$\n考虑差值：\n$$\\frac{(m+3k)^3}{27k} - (m-k)^2 = \\frac{1}{27k} \\left[ (m+3k)^3 - 27k(m-k)^2 \\right]$$\n方括号中的项是：\n$$(m^3 + 9km^2 + 27k^2m + 27k^3) - 27k(m^2 - 2mk + k^2) = m^3 - 18km^2 + 81k^2m = m(m^2 - 18km + 81k^2) = m(m-9k)^2$$\n由于 $m \\ge 0$ 且 $(m-9k)^2 \\ge 0$，该差值为非负。因此，对于 $0 \\leq m \\leq 9k$：\n$$\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}} \\geq |m-k|$$\n等式在 $m=0$ 和 $m=9k$ 时成立。\n因此，对于 $0 \\leq m \\leq 9k$，极值为 $\\pm \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}$。\n\n情况 2：$m > 9k$。\n在这种情况下，$s_c^2 = \\frac{m+3k}{12k} > 1$，因此临界点位于区间 $[-1, 1]$ 之外。函数 $g(s)$ 在 $[-1, 1]$ 上是单调的，因为其导数 $g'(s) = m+3k - 12ks^2$ 在 $(-1, 1)$ 上的符号不变。因此，极值必然出现在边界 $s = \\pm 1$ 处。\n值为 $g(1) = m-k$ 和 $g(-1) = k-m$。\n由于 $m > 9k > k$，所以 $m-k$ 是正数，因此最大值是 $m-k$，最小值是 $k-m$。\n\n结合两种情况，我们得到 $v_a^*(t)$ 的最大值和最小值的闭式表达式：\n$$\\max_{t} v_a^{*}(t) = \\begin{cases} \\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}  &\\text{如果 } 0 \\le m \\le 9k \\\\ m-k  &\\text{如果 } m > 9k \\end{cases}$$\n$$\\min_{t} v_a^{*}(t) = -\\max_{t} v_a^{*}(t) = \\begin{cases} -\\frac{(m+3k)^{3/2}}{3\\sqrt{3k}}  &\\text{如果 } 0 \\le m \\le 9k \\\\ k-m  &\\text{如果 } m > 9k \\end{cases}$$\n\n现在我们通过将峰值绝对值设为 1 来求最大允许幅值 $m_{max}(k)$。\n令 $V_{peak}(m, k) = \\max_{t} |v_a^*(t)| = \\max_{t} v_a^{*}(t)$。我们求解方程 $V_{peak}(m, k) = 1$ 以求得 $m$。\n\n我们计算在过渡点 $m=9k$ 处的峰值电压：\n$V_{peak}(9k, k) = 9k-k = 8k$。\n我们可以根据这个过渡值是小于还是大于 1 来区分两种情况。\n\n场景 A：解 $m_{max}$ 满足 $m_{max} > 9k$。\n这发生在 $V_{peak}(9k, k)  1$ 的情况下，即 $8k  1$ 或 $k  1/8$。\n在此范围内，我们求解 $m_{max} - k = 1$，得到 $m_{max} = 1+k$。\n这个解是一致的，因为 $m_{max} = 1+k > 9k \\iff 1 > 8k \\iff k  1/8$。\n所以，对于 $0  k  1/8$，最大幅值为 $m_{max}(k) = 1+k$。\n\n场景 B：解 $m_{max}$ 满足 $0 \\le m_{max} \\le 9k$。\n这发生在 $V_{peak}(9k, k) \\ge 1$ 的情况下，即 $8k \\ge 1$ 或 $k \\ge 1/8$。\n在此范围内，我们求解 $\\frac{(m_{max}+3k)^{3/2}}{3\\sqrt{3k}} = 1$。\n$$(m_{max}+3k)^{3/2} = 3\\sqrt{3k} = (27k)^{1/2}$$\n将两边都提高到 $2/3$ 次方：\n$$m_{max}+3k = \\left((27k)^{1/2}\\right)^{2/3} = (27k)^{1/3} = 3k^{1/3}$$\n$$m_{max} = 3k^{1/3} - 3k$$\n如果该解满足 $0 \\le m_{max} \\le 9k$，则该解是一致的。\n$m_{max} \\le 9k \\implies 3k^{1/3} - 3k \\le 9k \\implies 3k^{1/3} \\le 12k \\implies k^{1/3} \\le 4k \\implies k \\le 64k^3 \\implies 1 \\le 64k^2 \\implies k^2 \\ge 1/64 \\implies k \\ge 1/8$。\n$m_{max} \\ge 0 \\implies 3k^{1/3} - 3k \\ge 0 \\implies k^{1/3} \\ge k \\implies k \\ge k^3 \\implies 1 \\ge k^2 \\implies k \\le 1$。\n所以，对于 $1/8 \\le k \\le 1$，最大幅值为 $m_{max}(k) = 3k^{1/3} - 3k$。对于 $k>1$，$m_{max}$ 将为负值，这意味着没有正数 $m$ 能满足此约束。\n\n综合这些结果，我们得到 $m_{max}(k)$ 的最终表达式，它是一个单一的分段解析函数：\n$$m_{max}(k) = \\begin{cases} 1+k  \\text{如果 } 0  k  \\frac{1}{8} \\\\ 3k^{1/3} - 3k  \\text{如果 } k \\ge \\frac{1}{8} \\end{cases}$$\n问题意味着存在一个对 $m>0$ 有物理意义的解，这要求 $k \\le 1$。该表达式对 $k \\ge 1/8$ 成立。",
            "answer": "$$\n\\boxed{\nm_{\\max}(k) = \\begin{cases} 1+k  \\text{如果 } 0  k  \\frac{1}{8} \\\\ 3k^{1/3} - 3k  \\text{如果 } k \\ge \\frac{1}{8} \\end{cases}\n}\n$$"
        },
        {
            "introduction": "虽然三次谐波注入能有效提升线电压，但它也引入了一个零序分量，即三相共有的电压波动。本练习将通过基本的电路分析（相量法和基尔霍夫定律），演示这个共模电压如何在星形连接的负载中驱动电流流过中性点。理解和计算这个中性点电流对于电机设计、系统接地策略以及避免潜在的电磁干扰问题至关重要。",
            "id": "3886142",
            "problem": "一台平衡三相、星形连接的电机由采用三次谐波注入的电压源逆变器驱动。逆变器施加的相-中性点参考电压为\n$$\nv_{a}(t) = \\hat{V}_{1} \\cos(\\omega t) + \\hat{V}_{3} \\cos(3\\omega t), \\quad\nv_{b}(t) = \\hat{V}_{1} \\cos\\!\\big(\\omega t - \\tfrac{2\\pi}{3}\\big) + \\hat{V}_{3} \\cos(3\\omega t), \\quad\nv_{c}(t) = \\hat{V}_{1} \\cos\\!\\big(\\omega t + \\tfrac{2\\pi}{3}\\big) + \\hat{V}_{3} \\cos(3\\omega t),\n$$\n其中，三次谐波项在所有三相中的幅度和相位都相同。定子为星形连接，其中性点通过中性点阻抗 $Z_{n}$ 接地。在频率 $3\\omega$ 下，每相定子对三次谐波分量呈现相同的线性阻抗，记为 $Z_{s}$。假设系统处于稳态运行，具有线性时不变特性，并且在完美平衡的系统中，基波分量不会产生中性线电流。\n\n在频率为 $3\\omega$ 的相量域中进行分析，设 $V_{3}$ 表示单相三次谐波源相量，设 $V_{n}$ 表示中性点对地电位的相量。设 $I_{n}$ 表示流经 $Z_{n}$ 从中性点到地的电流相量。\n\n仅从基尔霍夫电流定律 (KCL) 和稳态正弦分析的相量定义出发，推导 $V_{n}$ 和 $I_{n}$ 关于 $V_{3}$、$Z_{s}$ 和 $Z_{n}$ 的闭式表达式。请以行矩阵 $(V_{n} \\;\\; I_{n})$ 的形式给出最终答案。无需进行数值计算；请用符号表示您的答案。",
            "solution": "该问题要求在三次谐波频率 $3\\omega$ 的相量域中进行分析。由于基波分量是平衡的，不产生中性线电流，因此在本分析中可以忽略。\n\n三次谐波电压分量在所有三相中都是相同的：$v_{a,3}(t) = v_{b,3}(t) = v_{c,3}(t) = \\hat{V}_{3} \\cos(3\\omega t)$。在相量域中，这些电压由一个对每相都相同的单一相量 $V_{3}$ 表示。这些是零序电压。\n\n我们将系统建模如下：逆变器施加的相电压作用于星形连接电机的端子（$A, B, C$）。这些端子相对于地（$G$）的三次谐波电压为 $V_{AG,3} = V_{3}$、$V_{BG,3} = V_{3}$ 和 $V_{CG,3} = V_{3}$。每相定子绕组是一个阻抗 $Z_{s}$，连接在各自的端子和中性点 $N$ 之间。中性点 $N$ 通过阻抗 $Z_{n}$ 连接到地 $G$。中性点 $N$ 相对于地 $G$ 的电压是 $V_{n}$，流经 $Z_n$ 的电流是 $I_{n}$。\n\n我们的任务是从应用于中性点 $N$ 的基尔霍夫电流定律 (KCL) 出发，求出 $V_{n}$ 和 $I_{n}$。流入节点 $N$ 的电流之和必须等于流出节点 $N$ 的电流。\n\n设 $I_{a,3}$、$I_{b,3}$ 和 $I_{c,3}$ 是从端子 $A$、$B$ 和 $C$ 经定子阻抗 $Z_{s}$ 流向中性点 $N$ 的三次谐波相量电流。根据欧姆定律：\n$$\nI_{a,3} = \\frac{V_{AG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\n$$\nI_{b,3} = \\frac{V_{BG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\n$$\nI_{c,3} = \\frac{V_{CG,3} - V_{n}}{Z_{s}} = \\frac{V_{3} - V_{n}}{Z_{s}}\n$$\n流经阻抗 $Z_{n}$ 从中性点 $N$ 到地 $G$ 的电流 $I_{n}$ 由下式给出：\n$$\nI_{n} = \\frac{V_{n} - V_{G}}{Z_{n}} = \\frac{V_{n}}{Z_{n}}\n$$\n其中地电位 $V_{G}$ 定义为 $0$。\n\n现在，我们在中性点 $N$ 应用KCL。从各相流入 $N$ 的电流之和等于从 $N$ 流向地的电流。\n$$\nI_{a,3} + I_{b,3} + I_{c,3} = I_{n}\n$$\n代入电流的表达式：\n$$\n\\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) + \\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) + \\left(\\frac{V_{3} - V_{n}}{Z_{s}}\\right) = I_{n}\n$$\n这可以简化为：\n$$\n3 \\frac{V_{3} - V_{n}}{Z_{s}} = I_{n}\n$$\n我们现在得到一个包含两个未知数 $V_{n}$ 和 $I_{n}$ 的方程组：\n1.  $3 \\frac{V_{3} - V_{n}}{Z_{s}} = I_{n}$\n2.  $I_{n} = \\frac{V_{n}}{Z_{n}}$\n\n为了求出 $V_{n}$，我们将第二个方程代入第一个方程：\n$$\n3 \\frac{V_{3} - V_{n}}{Z_{s}} = \\frac{V_{n}}{Z_{n}}\n$$\n用代数方法求解 $V_{n}$：\n$$\n3 Z_{n} (V_{3} - V_{n}) = Z_{s} V_{n} \\implies 3 Z_{n} V_{3} - 3 Z_{n} V_{n} = Z_{s} V_{n} \\implies 3 Z_{n} V_{3} = V_{n} (Z_{s} + 3 Z_{n})\n$$\n分离出 $V_{n}$ 得到第一个所需表达式：\n$$\nV_{n} = \\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}}\n$$\n为了求出 $I_{n}$，我们将 $V_{n}$ 的这个表达式代回方程 $I_{n} = V_{n} / Z_{n}$：\n$$\nI_{n} = \\frac{1}{Z_{n}} \\left( \\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}} \\right)\n$$\n分子和分母中的项 $Z_{n}$ 相互抵消，得到第二个所需表达式：\n$$\nI_{n} = \\frac{3 V_{3}}{Z_{s} + 3 Z_{n}}\n$$\n题目要求以行矩阵 $(V_{n} \\;\\; I_{n})$ 的形式给出最终答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3 Z_{n} V_{3}}{Z_{s} + 3 Z_{n}}  \\frac{3 V_{3}}{Z_{s} + 3 Z_{n}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "理论上的调制极限必须转化为实际控制系统中的约束，以确保系统的稳定和高性能运行。本练习将理论与实践相结合，展示如何利用分析得出的电压边界来设定PI电流控制器的抗饱和（anti-windup）极限。通过正确设计这些约束，可以防止调制器饱和，避免积分器饱和现象，从而保证闭环控制系统的动态响应和稳定性。",
            "id": "3886068",
            "problem": "考虑一个三相电压源逆变器，它使用一个调制器，该调制器接受一个归一化的每相参考值 $m(\\theta)$，并在 $|m(\\theta)|$ 超过指定限制 $M_{\\text{lim}}$ 时饱和。采用零序三次谐波注入策略，使得每个相参考值具有以下形式\n$$\nm(\\theta) = M\\big(\\sin(\\theta) + \\beta \\sin(3\\theta)\\big),\n$$\n其中 $M \\ge 0$ 是指令基波幅值，$\\beta \\in \\mathbb{R}$ 是相对于基波的三次谐波注入比，$\\theta$ 是以弧度为单位的角度。如果对于任何 $\\theta \\in \\mathbb{R}$ 都有 $|m(\\theta)|  M_{\\text{lim}}$，则调制器饱和。\n\n一个比例-积分 (Proportional-Integral, PI) 电流控制器在离散时间索引 $k$ 处，使用采样周期 $T_s  0$、比例增益 $K_p  0$ 和积分增益 $K_i  0$ 来计算归一化的电压指令 $u_k$：\n$$\nu_k^{\\text{unsat}} = K_p e_k + i_k,\n$$\n其中 $e_k$ 是电流跟踪误差，$i_k$ 是在时间 $k$ 的积分器状态。抗饱和（Anti-windup）是通过将指令饱和到一个可行边界 $U_{\\max}$，并使用一个反算增益 $K_{\\text{aw}} \\ge 0$ 来校正积分器来实现的：\n$$\nu_k^{\\text{sat}} = \\operatorname{clip}\\left(u_k^{\\text{unsat}}, -U_{\\max}, U_{\\max}\\right),\n$$\n$$\ni_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right).\n$$\n可行边界 $U_{\\max}$ 必须确保对于所选的 $M$ 和 $\\beta$，调制器永不饱和，即对所有 $\\theta$ 都有 $|m(\\theta)| \\le M_{\\text{lim}}$。为普适地强制此条件，$U_{\\max}$ 被用来钳位 $M$（通过 $u_k$），使得 $M \\le U_{\\max}$，其中 $U_{\\max}$ 是从 $\\sin(\\theta) + \\beta \\sin(3\\theta)$ 的最坏情况下的幅值导出的。\n\n你的任务是为一组测试用例实现抗饱和约束的计算和 PI 更新。对于每个测试用例，给定 $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}})$，你必须计算：\n1. $U_{\\max} = \\dfrac{M_{\\text{lim}}}{\\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|}$。\n2. 饱和标志 $s_k$，如果 $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$ 则为 $1$，否则为 $0$。\n3. 饱和后的控制量 $u_k^{\\text{sat}}$。\n4. 下一个积分器状态 $i_{k+1}$。\n\n所有角度均以弧度为单位。所有量均为无量纲和归一化的。将最终结果以浮点数和整数形式数值化表示。\n\n测试套件：\n- 情况1 (一般情况，零序注入典型幅值): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (1/6, 1.0, 0.5, 100.0, 1.0\\times 10^{-4}, 2.0\\times 10^{-2}, 0.0, 5000.0)$。\n- 情况2 (边界附近且饱和): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (1/6, 1.0, 1.0, 50.0, 1.0\\times 10^{-4}, 1.2, 0.1, 2000.0)$。\n- 情况3 (无注入基线): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (0.0, 1.0, 0.2, 200.0, 5.0\\times 10^{-5}, 6.0, 0.0, 3000.0)$。\n- 情况4 (负注入比): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (-0.1, 1.0, 0.4, 120.0, 2.0\\times 10^{-4}, -3.0, 0.5, 1000.0)$。\n- 情况5 (更强的注入和减小的调制器限制): $(\\beta, M_{\\text{lim}}, K_p, K_i, T_s, e_k, i_k, K_{\\text{aw}}) = (0.25, 0.9, 0.8, 80.0, 1.0\\times 10^{-4}, 1.3, -0.5, 1500.0)$。\n\n你的程序应生成单行输出，其中包含五个测试用例的结果，形式为一个用方括号括起来的逗号分隔列表，其中每个元素是按 $[U_{\\max}, s_k, u_k^{\\text{sat}}, i_{k+1}]$ 顺序排列的四个值的列表。例如，格式必须如下所示：\n$$\n[\\,[U_{\\max}^{(1)}, s_k^{(1)}, u_{k,\\text{sat}}^{(1)}, i_{k+1}^{(1)}],\\,\\ldots,\\,[U_{\\max}^{(5)}, s_k^{(5)}, u_{k,\\text{sat}}^{(5)}, i_{k+1}^{(5)}]\\,].\n$$",
            "solution": "可行指令边界源于要求每相调制器输入在所有角度下都保持在其限制范围内。归一化调制器输入为 $m(\\theta) = M\\big(\\sin(\\theta) + \\beta \\sin(3\\theta)\\big)$，可行性要求对所有 $\\theta \\in \\mathbb{R}$ 都有 $|m(\\theta)| \\le M_{\\text{lim}}$。因此，允许的基波幅值必须满足\n$$\nM \\le \\frac{M_{\\text{lim}}}{\\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|}.\n$$\n定义\n$$\nS(\\beta) \\triangleq \\sup_{\\theta \\in \\mathbb{R}} \\left|\\sin(\\theta) + \\beta \\sin(3\\theta)\\right|.\n$$\n那么，普适的抗饱和边界变为\n$$\nU_{\\max} = \\frac{M_{\\text{lim}}}{S(\\beta)}.\n$$\n\n为了从第一性原理计算 $S(\\beta)$，我们利用三角三倍角恒等式，这是一个经过充分检验的公式：\n$$\n\\sin(3\\theta) = 3\\sin(\\theta) - 4\\sin^3(\\theta).\n$$\n将此代入 $S(\\beta)$ 的表达式中可得\n$$\n\\sin(\\theta) + \\beta \\sin(3\\theta) = \\sin(\\theta)\\left(1 + 3\\beta\\right) - 4\\beta \\sin^3(\\theta).\n$$\n令 $y = \\sin(\\theta)$，则 $y \\in [-1,1]$。定义三次多项式\n$$\ng(y) = y\\left(1 + 3\\beta\\right) - 4\\beta y^3,\n$$\n并注意到\n$$\nS(\\beta) = \\sup_{y \\in [-1,1]} |g(y)|.\n$$\n$g(y)$ 在 $[-1,1]$ 上的极值出现在区间内部的驻点或边界 $y = \\pm 1$ 处。其导数为\n$$\ng'(y) = \\left(1 + 3\\beta\\right) - 12\\beta y^2.\n$$\n驻点 $y^\\star$ 满足\n$$\ny^{\\star 2} = \\frac{1 + 3\\beta}{12\\beta},\n$$\n条件是 $\\beta \\ne 0$ 且右侧非负。因此，可行的驻点为\n$$\ny^\\star = \\pm \\sqrt{\\frac{1 + 3\\beta}{12\\beta}},\n$$\n当 $\\frac{1 + 3\\beta}{12\\beta} \\in [0,1]$ 时。否则，极值位于边界 $y = \\pm 1$ 处。对于 $\\beta = 0$ 的情况，函数简化为 $g(y) = y$，上确界显然为 $S(0) = 1$。\n\n因此，为了稳健地计算 $S(\\beta)$：\n- 如果 $\\beta = 0$，则 $S(\\beta) = 1$。\n- 否则，计算 $y^2 = \\frac{1 + 3\\beta}{12\\beta}$，如果 $y^2 \\in [0,1]$，则将 $y^\\star = \\pm \\sqrt{y^2}$ 作为候选点；否则，依赖于边界候选点 $y = \\pm 1$。\n- 在所有候选点处计算 $|g(y)|$ 并取最大值。\n\n在确定 $U_{\\max}$ 后，抗饱和 PI 控制器计算未饱和的控制量\n$$\nu_k^{\\text{unsat}} = K_p e_k + i_k,\n$$\n并应用饱和\n$$\nu_k^{\\text{sat}} = \\begin{cases}\n-U_{\\max},  \\text{if } u_k^{\\text{unsat}}  -U_{\\max},\\\\\nu_k^{\\text{unsat}},  \\text{if } -U_{\\max} \\le u_k^{\\text{unsat}} \\le U_{\\max},\\\\\nU_{\\max},  \\text{if } u_k^{\\text{unsat}}  U_{\\max}.\n\\end{cases}\n$$\n饱和标志在 $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$ 时为 $s_k = 1$，否则为 $s_k = 0$。\n\n对于抗饱和，积分器使用反算进行更新。其基本原理是，当执行器饱和时，施加的有效控制量是 $u_k^{\\text{sat}}$，而不是 $u_k^{\\text{unsat}}$。允许积分器继续累积失配将导致积分饱和（windup）。为防止这种情况，通过反馈施加的控制量与未饱和指令之间的差异来校正积分器动态。一种用于离散时间抗饱和的常见且经过充分检验的结构是\n$$\ni_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right),\n$$\n其中 $K_{\\text{aw}} \\ge 0$ 的选择是为了设定积分器状态与饱和状态相协调的速率。该表达式源于积分器应反映实际施加到被控对象上的控制行为这一原理；因此，当指令饱和时，校正项会消除累积。\n\n每个测试用例的算法总结：\n1. 给定 $\\beta$ 和 $M_{\\text{lim}}$，通过上述候选点评估法计算 $S(\\beta)$，然后计算 $U_{\\max} = M_{\\text{lim}}/S(\\beta)$。\n2. 计算 $u_k^{\\text{unsat}} = K_p e_k + i_k$。\n3. 饱和处理：$u_k^{\\text{sat}} = \\operatorname{clip}\\left(u_k^{\\text{unsat}}, -U_{\\max}, U_{\\max}\\right)$。\n4. 标志：如果 $u_k^{\\text{unsat}} \\ne u_k^{\\text{sat}}$，则 $s_k = 1$，否则为 $0$。\n5. 更新积分器：$i_{k+1} = i_k + K_i T_s e_k + K_{\\text{aw}}\\left(u_k^{\\text{sat}} - u_k^{\\text{unsat}}\\right)$。\n\n该过程独立地应用于每个测试用例。最终程序输出单行，其中包含所有测试用例的结果列表 $[U_{\\max}, s_k, u_k^{\\text{sat}}, i_{k+1}]$，并遵循指定的格式。所有角度均以弧度为单位。所有量均为无量纲和归一化的，因此输出中不需要物理单位。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_S_beta(beta: float) -> float:\n    \"\"\"\n    Compute S(beta) = sup_{theta} |sin(theta) + beta * sin(3 theta)|\n    using the triple-angle identity and analytic candidate evaluation.\n    \"\"\"\n    # Handle the special case beta == 0\n    if np.isclose(beta, 0.0):\n        return 1.0\n\n    # Define g(y) = y*(1 + 3*beta) - 4*beta*y^3, with y in [-1, 1]\n    def g(y):\n        return y * (1.0 + 3.0 * beta) - 4.0 * beta * (y ** 3)\n\n    candidates = [-1.0, 1.0]\n\n    # Compute stationary point candidates y^2 = (1+3*beta)/(12*beta)\n    denom = 12.0 * beta\n    numer = 1.0 + 3.0 * beta\n    \n    # Avoid division by zero, although beta=0 is handled above\n    if np.isclose(denom, 0.0):\n        y2 = np.inf\n    else:\n        y2 = numer / denom\n\n    # Include stationary points if valid and within [-1,1]\n    if y2 >= 0.0:\n        y_star = np.sqrt(y2)\n        if y_star = 1.0:\n            candidates.extend([y_star, -y_star])\n\n    # Evaluate absolute values of g(y) at candidates\n    values = [abs(g(y)) for y in candidates]\n    S = max(values)\n    # Numerical safety: ensure S is positive\n    if S = 0.0:\n        # Fallback to a dense sampling if something went wrong\n        thetas = np.linspace(0.0, 2.0 * np.pi, 10001)\n        vals = np.abs(np.sin(thetas) + beta * np.sin(3.0 * thetas))\n        S = float(np.max(vals))\n    return float(S)\n\ndef anti_windup_PI(beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw):\n    \"\"\"\n    For given parameters, compute U_max, saturation flag s_k,\n    saturated control u_sat, and next integrator state i_{k+1}.\n    \"\"\"\n    # Compute S(beta) and U_max\n    S_beta = compute_S_beta(beta)\n    U_max = M_lim / S_beta\n\n    # PI unsaturated output\n    u_unsat = Kp * e_k + i_k\n\n    # Saturate to [-U_max, U_max]\n    u_sat = max(-U_max, min(U_max, u_unsat))\n\n    # Saturation flag\n    s_k = 1 if not np.isclose(u_unsat, u_sat) else 0\n\n    # Anti-windup integrator update\n    i_next = i_k + Ki * Ts * e_k + K_aw * (u_sat - u_unsat)\n\n    return [U_max, s_k, u_sat, i_next]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw)\n    test_cases = [\n        (1.0/6.0, 1.0, 0.5, 100.0, 1.0e-4, 2.0e-2, 0.0, 5000.0),\n        (1.0/6.0, 1.0, 1.0, 50.0, 1.0e-4, 1.2, 0.1, 2000.0),\n        (0.0, 1.0, 0.2, 200.0, 5.0e-5, 6.0, 0.0, 3000.0),\n        (-0.1, 1.0, 0.4, 120.0, 2.0e-4, -3.0, 0.5, 1000.0),\n        (0.25, 0.9, 0.8, 80.0, 1.0e-4, 1.3, -0.5, 1500.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw = case\n        result = anti_windup_PI(beta, M_lim, Kp, Ki, Ts, e_k, i_k, K_aw)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Ensure floats are printed in a standard Python representation.\n    print(f\"[{','.join([str(r) for r in results])}]\")\n\nsolve()\n```"
        }
    ]
}