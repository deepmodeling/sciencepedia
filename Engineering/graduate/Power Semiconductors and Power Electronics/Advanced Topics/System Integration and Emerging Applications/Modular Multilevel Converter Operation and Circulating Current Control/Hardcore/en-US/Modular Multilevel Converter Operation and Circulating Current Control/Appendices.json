{
    "hands_on_practices": [
        {
            "introduction": "The arm inductors are a foundational component in an MMC, serving as the first line of defense against harmful circulating currents. Before implementing any active control, a designer must ensure the converter can passively withstand the internal voltage harmonics that drive these currents. This practice  focuses on this essential design step, guiding you to derive the minimum required arm inductance $L_{\\text{arm}}$ to keep the dominant second-harmonic circulating current within safe operational limits.",
            "id": "3859410",
            "problem": "A three-phase Modular Multilevel Converter (MMC) operates connected to an alternating current grid of fundamental frequency $f_{\\text{ac}}$, where the arm inductors $L_{\\text{arm}}$ are used to limit the common-mode circulating current driven by internal voltage harmonics created by the submodule energy ripple. In each phase, the circulating-current path includes the upper and lower arm inductors in series. Under worst-case operating conditions without active second-harmonic suppression, the internal common-mode voltage that drives the circulating current is dominated by a second-harmonic component at angular frequency $2\\omega_{\\text{ac}}$, where $\\omega_{\\text{ac}} = 2\\pi f_{\\text{ac}}$. Assume resistive damping is negligible so that the circulating-current path is purely inductive.\n\nLet the worst-case internal second-harmonic voltage be modeled as\n$$\nv_{\\text{int}}(t) = \\hat{V}_{2\\omega} \\cos\\!\\big(2\\omega_{\\text{ac}} t + \\phi\\big),\n$$\nwith peak amplitude $\\hat{V}_{2\\omega}$ known. The design objective is to ensure the peak amplitude of the circulating current at $2\\omega_{\\text{ac}}$, denoted $\\hat{I}_{\\text{circ}}$, does not exceed a specified limit $\\hat{I}_{\\text{lim}}$.\n\nStarting from the inductor voltage-current relation and Kirchhoff's Voltage Law (KVL), derive an analytical expression for the minimum arm inductance $L_{\\text{arm}}$ that guarantees $\\hat{I}_{\\text{circ}} \\le \\hat{I}_{\\text{lim}}$ for the worst-case internal voltage. Then evaluate the result numerically for the following parameters:\n- $f_{\\text{ac}} = 50\\ \\text{Hz}$,\n- $\\hat{V}_{2\\omega} = 10{,}000\\ \\text{V}$,\n- $\\hat{I}_{\\text{lim}} = 200\\ \\text{A}$.\n\nRound your final numerical answer to four significant figures and express it in millihenries (mH). The final answer must be a single real number.",
            "solution": "The problem is evaluated as valid, as it is scientifically grounded, well-posed, objective, and contains all necessary information to derive a unique solution. The model and parameters are consistent with standard engineering practice in the field of power electronics.\n\nThe objective is to determine the minimum arm inductance $L_{\\text{arm}}$ required to limit the peak second-harmonic circulating current $\\hat{I}_{\\text{circ}}$ to a maximum value of $\\hat{I}_{\\text{lim}}$. The analysis begins with the fundamental principles of circuit theory applied to the specific topology of a Modular Multilevel Converter (MMC).\n\nIn a single phase-leg of an MMC, the common-mode circulating current path is driven by the internal common-mode voltage, $v_{\\text{int}}(t)$, and flows through the series combination of the upper and lower arm inductors. According to the problem statement, this path is considered purely inductive. The total inductance in this loop is the sum of the inductances of the upper and lower arms:\n$$\nL_{\\text{total}} = L_{\\text{arm}} + L_{\\text{arm}} = 2 L_{\\text{arm}}\n$$\n\nApplying Kirchhoff's Voltage Law (KVL) to the circulating current loop, the internal driving voltage must equal the voltage drop across the total inductance:\n$$\nv_{\\text{int}}(t) = v_{L, \\text{total}}(t)\n$$\nThe voltage-current relationship for the total inductance is given by:\n$$\nv_{L, \\text{total}}(t) = L_{\\text{total}} \\frac{d i_{\\text{circ}}(t)}{dt} = 2 L_{\\text{arm}} \\frac{d i_{\\text{circ}}(t)}{dt}\n$$\nCombining these equations yields a first-order ordinary differential equation:\n$$\nv_{\\text{int}}(t) = 2 L_{\\text{arm}} \\frac{d i_{\\text{circ}}(t)}{dt}\n$$\nThe problem specifies that the dominant component of the internal voltage is the second harmonic, given as a sinusoidal function:\n$$\nv_{\\text{int}}(t) = \\hat{V}_{2\\omega} \\cos(2\\omega_{\\text{ac}} t + \\phi)\n$$\nwhere $\\omega_{\\text{ac}} = 2\\pi f_{\\text{ac}}$. For sinusoidal steady-state analysis, it is more direct to use the phasor domain. The angular frequency of the second-harmonic component is $\\omega_2 = 2\\omega_{\\text{ac}}$.\n\nThe phasor representation of the internal voltage is $\\mathbf{V}_{\\text{int}}$, with a magnitude equal to its peak amplitude, $|\\mathbf{V}_{\\text{int}}| = \\hat{V}_{2\\omega}$. The impedance of the circulating current path at the angular frequency $\\omega_2$ is purely inductive and is given by:\n$$\nZ_{\\text{circ}}(j\\omega_2) = j \\omega_2 L_{\\text{total}} = j (2\\omega_{\\text{ac}}) (2 L_{\\text{arm}}) = j 4 \\omega_{\\text{ac}} L_{\\text{arm}}\n$$\nThe corresponding circulating current phasor, $\\mathbf{I}_{\\text{circ}}$, is found using Ohm's Law in the frequency domain:\n$$\n\\mathbf{I}_{\\text{circ}} = \\frac{\\mathbf{V}_{\\text{int}}}{Z_{\\text{circ}}(j\\omega_2)}\n$$\nThe peak amplitude of the circulating current, $\\hat{I}_{\\text{circ}}$, is the magnitude of its phasor:\n$$\n\\hat{I}_{\\text{circ}} = |\\mathbf{I}_{\\text{circ}}| = \\frac{|\\mathbf{V}_{\\text{int}}|}{|Z_{\\text{circ}}(j\\omega_2)|} = \\frac{\\hat{V}_{2\\omega}}{|j 4 \\omega_{\\text{ac}} L_{\\text{arm}}|} = \\frac{\\hat{V}_{2\\omega}}{4 \\omega_{\\text{ac}} L_{\\text{arm}}}\n$$\nThe design constraint is that this peak current must not exceed the specified limit $\\hat{I}_{\\text{lim}}$:\n$$\n\\hat{I}_{\\text{circ}} \\le \\hat{I}_{\\text{lim}}\n$$\nSubstituting the expression for $\\hat{I}_{\\text{circ}}$ into the inequality gives:\n$$\n\\frac{\\hat{V}_{2\\omega}}{4 \\omega_{\\text{ac}} L_{\\text{arm}}} \\le \\hat{I}_{\\text{lim}}\n$$\nTo ensure this condition is always met, we must solve for the minimum required value of $L_{\\text{arm}}$. Rearranging the inequality:\n$$\nL_{\\text{arm}} \\ge \\frac{\\hat{V}_{2\\omega}}{4 \\omega_{\\text{ac}} \\hat{I}_{\\text{lim}}}\n$$\nThe minimum arm inductance, $L_{\\text{arm,min}}$, that satisfies the design criterion is therefore:\n$$\nL_{\\text{arm,min}} = \\frac{\\hat{V}_{2\\omega}}{4 \\omega_{\\text{ac}} \\hat{I}_{\\text{lim}}}\n$$\nSubstituting the definition $\\omega_{\\text{ac}} = 2\\pi f_{\\text{ac}}$, we obtain the final analytical expression for the minimum arm inductance:\n$$\nL_{\\text{arm,min}} = \\frac{\\hat{V}_{2\\omega}}{4 (2\\pi f_{\\text{ac}}) \\hat{I}_{\\text{lim}}} = \\frac{\\hat{V}_{2\\omega}}{8 \\pi f_{\\text{ac}} \\hat{I}_{\\text{lim}}}\n$$\nNow, we evaluate this expression numerically using the provided parameters:\n- $f_{\\text{ac}} = 50\\ \\text{Hz}$\n- $\\hat{V}_{2\\omega} = 10{,}000\\ \\text{V}$\n- $\\hat{I}_{\\text{lim}} = 200\\ \\text{A}$\n\nPlugging these values into the derived formula:\n$$\nL_{\\text{arm,min}} = \\frac{10000}{8 \\pi (50) (200)} = \\frac{10000}{80000 \\pi} = \\frac{1}{8\\pi} \\text{ H}\n$$\nCalculating the numerical value in Henries:\n$$\nL_{\\text{arm,min}} \\approx 0.0397887\\ \\text{H}\n$$\nThe problem requires the answer to be expressed in millihenries (mH). To convert from Henries to millihenries, we multiply by $1000$:\n$$\nL_{\\text{arm,min}} \\approx 0.0397887 \\times 1000\\ \\text{mH} = 39.7887\\ \\text{mH}\n$$\nFinally, rounding the result to four significant figures as required:\n$$\nL_{\\text{arm,min}} \\approx 39.79\\ \\text{mH}\n$$",
            "answer": "$$\n\\boxed{39.79}\n$$"
        },
        {
            "introduction": "While passive inductance provides a baseline level of mitigation, active circulating current suppression is key to unlocking high-performance MMC operation. A crucial question for any engineer is to justify the complexity of a control system with tangible benefits. This exercise  directly addresses this by quantifying the impact of circulating current reduction on overall converter efficiency, connecting the abstract control action to real-world power losses in the semiconductor devices.",
            "id": "3859341",
            "problem": "A three-phase Modular Multilevel Converter (MMC) operates under balanced sinusoidal load at an electrical frequency of $f$, delivering an output power of $P_{\\text{out}} = 5\\,\\text{MW}$. Each phase leg consists of an upper arm and a lower arm connected to a common alternating current node. In steady-state, the phase current at the alternating current node is a sinusoid with root-mean-square (RMS) value $I_{\\text{ph,rms}} = 1000\\,\\text{A}$. The converter exhibits a second-harmonic circulating current in each arm with RMS value $I_{\\text{circ,rms}}$, which is independent of the phase current and arises from energy exchange between arms and the direct current bus.\n\nA circulating current controller reduces the circulating current RMS from an initial $I_{\\text{circ,rms,0}} = 400\\,\\text{A}$ to a final $I_{\\text{circ,rms,1}} = 100\\,\\text{A}$. Assume:\n- Each arm is modeled with an equivalent resistive conduction parameter $R_{\\text{eq}} = 0.02\\,\\Omega$ representing the aggregate on-state slope resistance of power semiconductors and copper.\n- The average switching loss per arm at the fixed operating point is empirically observed to be approximately linear in the RMS arm current, modeled as $P_{\\text{sw,arm}} = k_{\\text{sw}}\\,I_{\\text{arm,rms}}$ with $k_{\\text{sw}} = 5\\,\\text{W/A}$.\n- There are six arms in total, and losses across arms add linearly.\n- The alternating current phase current is a pure sinusoid at frequency $f$, while the circulating current is a pure sinusoid at $2f$, and these components are uncorrelated over integer multiples of the fundamental period.\n\nStarting from Kirchhoff’s current law at the alternating current node and the definition of RMS, derive the RMS arm current in terms of $I_{\\text{ph,rms}}$ and $I_{\\text{circ,rms}}$, and then compute the total converter loss before and after circulating current reduction. Finally, compute the efficiency $\\eta = \\dfrac{P_{\\text{out}}}{P_{\\text{out}} + P_{\\text{loss}}}$ in both cases and report the efficiency gain $\\Delta \\eta = \\eta_{\\text{final}} - \\eta_{\\text{initial}}$ as a single decimal fraction. Round your answer to four significant figures. Express the efficiency gain as a decimal fraction without the percent sign.",
            "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of power electronics, specifically the operation of a Modular Multilevel Converter (MMC). The formulation is well-posed, objective, and contains sufficient information for a unique solution. The provided parameters are within a realistic range for high-power applications.\n\nThe objective is to compute the gain in efficiency, $\\Delta \\eta$, resulting from the reduction of circulating currents in a three-phase MMC.\n\nFirst, we must derive the expression for the root-mean-square (RMS) current in a converter arm, $I_{\\text{arm,rms}}$. In an MMC, the current in the upper arm, $i_u(t)$, and the lower arm, $i_l(t)$, of a single phase leg are composed of two components: half of the alternating current (AC) phase current, $i_{\\text{ph}}(t)$, and the circulating current, $i_{\\text{circ}}(t)$.\n\nAccording to Kirchhoff's Current Law at the AC output node, the phase current is the difference between the upper and lower arm currents:\n$$i_{\\text{ph}}(t) = i_u(t) - i_l(t)$$\nThe circulating current is defined as the common-mode current flowing through the phase leg:\n$$i_{\\text{circ}}(t) = \\frac{1}{2}\\left(i_u(t) + i_l(t)\\right)$$\nSolving this system of equations for the arm currents yields:\n$$i_u(t) = i_{\\text{circ}}(t) + \\frac{1}{2} i_{\\text{ph}}(t)$$\n$$i_l(t) = i_{\\text{circ}}(t) - \\frac{1}{2} i_{\\text{ph}}(t)$$\nSince the RMS values for $i_u(t)$ and $i_l(t)$ are identical, we can denote a generic arm current as $i_{\\text{arm}}(t) = i_{\\text{circ}}(t) \\pm \\frac{1}{2}i_{\\text{ph}}(t)$.\n\nThe mean square value of the arm current, $I_{\\text{arm,rms}}^2$, is the time average of its square:\n$$I_{\\text{arm,rms}}^2 = \\left\\langle \\left( i_{\\text{circ}}(t) \\pm \\frac{1}{2}i_{\\text{ph}}(t) \\right)^2 \\right\\rangle$$\nExpanding the squared term gives:\n$$I_{\\text{arm,rms}}^2 = \\left\\langle i_{\\text{circ}}(t)^2 \\right\\rangle + \\left\\langle \\left(\\frac{1}{2}i_{\\text{ph}}(t)\\right)^2 \\right\\rangle \\pm \\left\\langle i_{\\text{circ}}(t) i_{\\text{ph}}(t) \\right\\rangle$$\nThe problem states that the phase current is a pure sinusoid at frequency $f$, and the circulating current is a pure sinusoid at frequency $2f$. For sinusoidal signals of different frequencies, the time average of their product over a period that is an integer multiple of both fundamental periods is zero. They are uncorrelated. Thus, the cross-term $\\left\\langle i_{\\text{circ}}(t) i_{\\text{ph}}(t) \\right\\rangle = 0$.\nThe expression simplifies to the sum of the mean square values of the components:\n$$I_{\\text{arm,rms}}^2 = \\left\\langle i_{\\text{circ}}(t)^2 \\right\\rangle + \\frac{1}{4} \\left\\langle i_{\\text{ph}}(t)^2 \\right\\rangle$$\nBy definition, $\\langle x(t)^2 \\rangle = X_{\\text{rms}}^2$. Therefore, the relationship between the RMS values is:\n$$I_{\\text{arm,rms}}^2 = I_{\\text{circ,rms}}^2 + \\frac{1}{4}I_{\\text{ph,rms}}^2$$\nThis gives the RMS arm current as:\n$$I_{\\text{arm,rms}} = \\sqrt{I_{\\text{circ,rms}}^2 + \\left(\\frac{I_{\\text{ph,rms}}}{2}\\right)^2}$$\n\nNext, we establish the total converter loss, $P_{\\text{loss}}$. The converter has $6$ arms in total. The loss per arm is the sum of conduction loss, $P_{\\text{cond,arm}}$, and switching loss, $P_{\\text{sw,arm}}$.\n$$P_{\\text{cond,arm}} = R_{\\text{eq}} I_{\\text{arm,rms}}^2$$\n$$P_{\\text{sw,arm}} = k_{\\text{sw}} I_{\\text{arm,rms}}$$\nThe total loss for the $6$ arms is:\n$$P_{\\text{loss}} = 6 \\times (P_{\\text{cond,arm}} + P_{\\text{sw,arm}}) = 6 \\left( R_{\\text{eq}} I_{\\text{arm,rms}}^2 + k_{\\text{sw}} I_{\\text{arm,rms}} \\right)$$\n\nWe now compute the losses and efficiency for the initial and final operating conditions. The given parameters are:\n$P_{\\text{out}} = 5 \\times 10^6\\,\\text{W}$\n$I_{\\text{ph,rms}} = 1000\\,\\text{A}$\n$R_{\\text{eq}} = 0.02\\,\\Omega$\n$k_{\\text{sw}} = 5\\,\\text{W/A}$\n\nCase 0: Initial condition with $I_{\\text{circ,rms,0}} = 400\\,\\text{A}$.\nThe initial RMS arm current, $I_{\\text{arm,rms,0}}$, is:\n$$I_{\\text{arm,rms,0}} = \\sqrt{(400\\,\\text{A})^2 + \\left(\\frac{1000\\,\\text{A}}{2}\\right)^2} = \\sqrt{160000 + 250000}\\,\\text{A} = \\sqrt{410000}\\,\\text{A}$$\nThe square of the initial RMS arm current is $I_{\\text{arm,rms,0}}^2 = 410000\\,\\text{A}^2$.\nThe initial total loss, $P_{\\text{loss,0}}$, is:\n$$P_{\\text{loss,0}} = 6 \\left( (0.02\\,\\Omega) (410000\\,\\text{A}^2) + (5\\,\\text{W/A}) (\\sqrt{410000}\\,\\text{A}) \\right)$$\n$$P_{\\text{loss,0}} = 6 \\left( 8200 + 5\\sqrt{410000} \\right)\\,\\text{W} \\approx 68409.37\\,\\text{W}$$\nThe initial efficiency, $\\eta_0$, is:\n$$\\eta_0 = \\frac{P_{\\text{out}}}{P_{\\text{out}} + P_{\\text{loss,0}}} = \\frac{5 \\times 10^6}{5 \\times 10^6 + 68409.37} \\approx 0.98650341$$\n\nCase 1: Final condition with $I_{\\text{circ,rms,1}} = 100\\,\\text{A}$.\nThe final RMS arm current, $I_{\\text{arm,rms,1}}$, is:\n$$I_{\\text{arm,rms,1}} = \\sqrt{(100\\,\\text{A})^2 + \\left(\\frac{1000\\,\\text{A}}{2}\\right)^2} = \\sqrt{10000 + 250000}\\,\\text{A} = \\sqrt{260000}\\,\\text{A}$$\nThe square of the final RMS arm current is $I_{\\text{arm,rms,1}}^2 = 260000\\,\\text{A}^2$.\nThe final total loss, $P_{\\text{loss,1}}$, is:\n$$P_{\\text{loss,1}} = 6 \\left( (0.02\\,\\Omega) (260000\\,\\text{A}^2) + (5\\,\\text{W/A}) (\\sqrt{260000}\\,\\text{A}) \\right)$$\n$$P_{\\text{loss,1}} = 6 \\left( 5200 + 5\\sqrt{260000} \\right)\\,\\text{W} \\approx 46497.06\\,\\text{W}$$\nThe final efficiency, $\\eta_1$, is:\n$$\\eta_1 = \\frac{P_{\\text{out}}}{P_{\\text{out}} + P_{\\text{loss,1}}} = \\frac{5 \\times 10^6}{5 \\times 10^6 + 46497.06} \\approx 0.99078625$$\n\nFinally, the efficiency gain, $\\Delta\\eta$, is the difference between the final and initial efficiencies:\n$$\\Delta\\eta = \\eta_1 - \\eta_0 \\approx 0.99078625 - 0.98650341 \\approx 0.00428284$$\nRounding the result to four significant figures gives $0.004283$.",
            "answer": "$$\\boxed{0.004283}$$"
        },
        {
            "introduction": "An ideal controller can perfectly track its reference, but practical controllers operate within physical constraints. When a circulating current controller saturates, it cannot fully generate the current required to stabilize the internal energy balance of the MMC. This practice  delves into the consequences of such non-ideal behavior, challenging you to analyze how control limitations directly translate into increased voltage ripple on the submodule capacitors, a critical factor affecting component stress and system stability.",
            "id": "3859305",
            "problem": "Consider a balanced three-phase Modular Multilevel Converter (MMC) leg feeding a sinusoidal load. Each arm contains $N$ identical half-bridge submodules with capacitance $C_{sm}$ per submodule. Assume ideal devices, negligible losses, and equal sharing such that all submodule capacitor voltages are equal at any instant. Let the direct current bus voltage be $V_{dc}$, and the average submodule capacitor voltage be $V_{sm0} = \\frac{V_{dc}}{2N}$.\n\nLet the phase-$a$ terminal voltage and current be $v_{a}(t) = V_{m} \\cos(\\omega t)$ and $i_{a}(t) = I_{m} \\cos(\\omega t - \\phi)$, respectively, where $\\phi$ is the power factor angle and $\\omega$ is the fundamental angular frequency. Under standard MMC modulation, the upper- and lower-arm voltages are $v_{u}(t) = \\frac{V_{dc}}{2} + \\frac{v_{a}(t)}{2}$ and $v_{l}(t) = \\frac{V_{dc}}{2} - \\frac{v_{a}(t)}{2}$, and the upper- and lower-arm currents are $i_{u}(t) = i_{z}(t) + \\frac{i_{a}(t)}{2}$ and $i_{l}(t) = i_{z}(t) - \\frac{i_{a}(t)}{2}$, where $i_{z}(t)$ is the leg’s internal circulating current.\n\nThe circulating current controller generates a reference $i_{z,\\mathrm{ref}}(t)$ whose purpose is to eliminate the second-harmonic ($2\\omega$) energy oscillation in the combined energy of the upper and lower arms (i.e., the sum of all submodule capacitor energies in the leg). However, suppose a current limit is reached so that the achieved circulating current is $i_{z}(t) = \\kappa \\, i_{z,\\mathrm{ref}}(t)$ with $0  \\kappa  1$, where $\\kappa$ is a constant saturation factor. Assume that, when unconstrained, $i_{z,\\mathrm{ref}}(t)$ would exactly cancel the $2\\omega$ energy oscillation.\n\nUsing only the fundamental relations $p(t) = v(t)\\,i(t)$ and $\\frac{dE}{dt} = p$ applied to the arms, and the sinusoidal identities for products of sinusoids, derive the resulting increase in the peak amplitude of the submodule capacitor voltage ripple (per submodule) caused solely by the inability to meet the circulating current reference. Express your final answer as a single closed-form analytic expression in terms of $V_{m}$, $I_{m}$, $\\omega$, $C_{sm}$, $V_{dc}$, and $\\kappa$. Do not include units in your final expression. Clearly state the expression for the increase in the peak ripple amplitude, defined as the peak of the additional $2\\omega$ sinusoidal component of the submodule capacitor voltage that remains due to saturation.",
            "solution": "The problem requires the derivation of the increase in the peak amplitude of the submodule (SM) capacitor voltage ripple in a Modular Multilevel Converter (MMC) leg due to the saturation of the second-harmonic circulating current. The solution will proceed by calculating the power flowing into the SM capacitors, identifying the component that causes the ripple, determining the residual ripple power under saturated control, and finally relating this power ripple to the voltage ripple on the SM capacitors.\n\nThe givens are:\n- Phase-$a$ terminal voltage: $v_{a}(t) = V_{m} \\cos(\\omega t)$\n- Phase-$a$ terminal current: $i_{a}(t) = I_{m} \\cos(\\omega t - \\phi)$\n- DC bus voltage: $V_{dc}$\n- Upper-arm voltage: $v_{u}(t) = \\frac{V_{dc}}{2} + \\frac{v_{a}(t)}{2}$\n- Lower-arm voltage: $v_{l}(t) = \\frac{V_{dc}}{2} - \\frac{v_{a}(t)}{2}$\n- Upper-arm current: $i_{u}(t) = i_{z}(t) + \\frac{i_{a}(t)}{2}$\n- Lower-arm current: $i_{l}(t) = i_{z}(t) - \\frac{i_{a}(t)}{2}$\n- Actual circulating current: $i_{z}(t) = \\kappa \\, i_{z,\\mathrm{ref}}(t)$ for $0  \\kappa  1$\n- SM capacitance: $C_{sm}$\n- Number of SMs per arm: $N$\n- Average SM voltage: $V_{sm0} = \\frac{V_{dc}}{2N}$\n\nFirst, we determine the total instantaneous power, $p_{leg}(t)$, flowing into the capacitors of the entire leg. This is the sum of the power entering the upper arm, $p_{u}(t)$, and the lower arm, $p_{l}(t)$.\n$$p_{u}(t) = v_{u}(t) i_{u}(t) = \\left(\\frac{V_{dc}}{2} + \\frac{v_{a}(t)}{2}\\right) \\left(i_{z}(t) + \\frac{i_{a}(t)}{2}\\right)$$\n$$p_{l}(t) = v_{l}(t) i_{l}(t) = \\left(\\frac{V_{dc}}{2} - \\frac{v_{a}(t)}{2}\\right) \\left(i_{z}(t) - \\frac{i_{a}(t)}{2}\\right)$$\nThe total leg power is the sum $p_{leg}(t) = p_{u}(t) + p_{l}(t)$. Expanding the products:\n$$p_{u}(t) = \\frac{V_{dc}}{2} i_{z}(t) + \\frac{V_{dc}}{4} i_{a}(t) + \\frac{v_{a}(t) i_{z}(t)}{2} + \\frac{v_{a}(t) i_{a}(t)}{4}$$\n$$p_{l}(t) = \\frac{V_{dc}}{2} i_{z}(t) - \\frac{V_{dc}}{4} i_{a}(t) - \\frac{v_{a}(t) i_{z}(t)}{2} + \\frac{v_{a}(t) i_{a}(t)}{4}$$\nAdding these two expressions, several terms cancel out:\n$$p_{leg}(t) = V_{dc} i_{z}(t) + \\frac{v_{a}(t) i_{a}(t)}{2}$$\nThis power is responsible for charging and discharging the submodule capacitors. The term $V_{dc} i_{z}(t)$ represents the power exchanged via the circulating current, which is used for control purposes. The term $\\frac{1}{2}v_{a}(t) i_{a}(t)$ represents the power exchanged with the AC side, which is the source of the energy oscillations.\n\nThe energy oscillations are dominated by the second harmonic ($2\\omega$) component of $p_{leg}(t)$. Let's analyze the term $\\frac{1}{2}v_{a}(t) i_{a}(t)$:\n$$v_{a}(t) i_{a}(t) = V_{m} \\cos(\\omega t) \\cdot I_{m} \\cos(\\omega t - \\phi)$$\nUsing the trigonometric identity $\\cos(A)\\cos(B) = \\frac{1}{2}[\\cos(A-B) + \\cos(A+B)]$:\n$$v_{a}(t) i_{a}(t) = \\frac{V_{m} I_{m}}{2} [\\cos(\\phi) + \\cos(2\\omega t - \\phi)]$$\nThis expression contains a DC component, representing average power, and a second-harmonic component. The power component originating from the AC side that creates the second-harmonic energy ripple is:\n$$p_{ac, 2\\omega}(t) = \\left[\\frac{v_{a}(t) i_{a}(t)}{2}\\right]_{2\\omega} = \\frac{1}{2} \\left[ \\frac{V_{m} I_{m}}{2} \\cos(2\\omega t - \\phi) \\right] = \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi)$$\nThe purpose of the reference circulating current $i_{z,\\mathrm{ref}}(t)$ is to generate a power component $V_{dc} i_{z,\\mathrm{ref}}(t)$ that exactly cancels $p_{ac, 2\\omega}(t)$. Therefore, under ideal (unconstrained) conditions:\n$$V_{dc} i_{z,\\mathrm{ref}}(t) + p_{ac, 2\\omega}(t) = 0$$\n$$V_{dc} i_{z,\\mathrm{ref}}(t) = -p_{ac, 2\\omega}(t) = -\\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi)$$\nThis defines the power that the ideal reference current must generate.\n\nHowever, due to saturation, the actual circulating current is $i_{z}(t) = \\kappa i_{z,\\mathrm{ref}}(t)$. The power generated by this actual current is:\n$$p_{z, actual}(t) = V_{dc} i_{z}(t) = V_{dc} (\\kappa i_{z,\\mathrm{ref}}(t)) = \\kappa (V_{dc} i_{z,\\mathrm{ref}}(t)) = -\\kappa \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi)$$\nThe net residual second-harmonic power, $p_{res, 2\\omega}(t)$, flowing into the leg's capacitors is the sum of the contributing AC power and the partially canceling power from the actual circulating current:\n$$p_{res, 2\\omega}(t) = p_{z, actual}(t) + p_{ac, 2\\omega}(t)$$\n$$p_{res, 2\\omega}(t) = -\\kappa \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi) + \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi)$$\n$$p_{res, 2\\omega}(t) = (1-\\kappa) \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi)$$\nThis is the uncanceled power ripple that causes the additional voltage ripple. The peak amplitude of this residual power ripple is:\n$$P_{res, peak} = (1-\\kappa) \\frac{V_{m} I_{m}}{4}$$\nThe corresponding energy fluctuation, $\\Delta E_{leg}(t)$, is the integral of the power fluctuation:\n$$\\Delta E_{leg}(t) = \\int p_{res, 2\\omega}(t) dt = \\int (1-\\kappa) \\frac{V_{m} I_{m}}{4} \\cos(2\\omega t - \\phi) dt$$\n$$\\Delta E_{leg}(t) = (1-\\kappa) \\frac{V_{m} I_{m}}{4} \\frac{\\sin(2\\omega t - \\phi)}{2\\omega} = (1-\\kappa) \\frac{V_{m} I_{m}}{8\\omega} \\sin(2\\omega t - \\phi)$$\nThe peak amplitude of this leg energy fluctuation is:\n$$\\Delta E_{peak} = (1-\\kappa) \\frac{V_{m} I_{m}}{8\\omega}$$\nThis fluctuation in stored energy causes a voltage ripple across the submodule capacitors. The total energy stored in the leg's $2N$ submodules, assuming each has voltage $v_{sm}(t)$, is:\n$$E_{leg}(t) = 2N \\cdot \\frac{1}{2} C_{sm} v_{sm}^{2}(t) = N C_{sm} v_{sm}^{2}(t)$$\nThe SM voltage consists of a large DC component $V_{sm0}$ and a small ripple $\\Delta v_{sm}(t)$, so $v_{sm}(t) = V_{sm0} + \\Delta v_{sm}(t)$.\n$$E_{leg}(t) = N C_{sm} (V_{sm0} + \\Delta v_{sm}(t))^{2} \\approx N C_{sm} (V_{sm0}^{2} + 2 V_{sm0} \\Delta v_{sm}(t))$$\nThe fluctuation in energy is $\\Delta E_{leg}(t) \\approx 2 N C_{sm} V_{sm0} \\Delta v_{sm}(t)$.\nSubstituting the given average voltage $V_{sm0} = \\frac{V_{dc}}{2N}$:\n$$\\Delta E_{leg}(t) \\approx 2 N C_{sm} \\left(\\frac{V_{dc}}{2N}\\right) \\Delta v_{sm}(t) = C_{sm} V_{dc} \\Delta v_{sm}(t)$$\nFrom this linear relationship, the peak amplitude of the voltage ripple, $\\Delta V_{sm, peak}$, is related to the peak amplitude of the energy ripple by:\n$$\\Delta E_{peak} = C_{sm} V_{dc} \\Delta V_{sm, peak}$$\nSolving for the voltage ripple:\n$$\\Delta V_{sm, peak} = \\frac{\\Delta E_{peak}}{C_{sm} V_{dc}}$$\nFinally, substituting the expression for $\\Delta E_{peak}$:\n$$\\Delta V_{sm, peak} = \\frac{(1-\\kappa) \\frac{V_{m} I_{m}}{8\\omega}}{C_{sm} V_{dc}}$$\nThis simplifies to the final expression for the increase in the peak amplitude of the submodule capacitor voltage ripple:\n$$\\Delta V_{sm, peak} = (1-\\kappa) \\frac{V_{m} I_{m}}{8 \\omega C_{sm} V_{dc}}$$\nThis expression represents the peak of the additional $2\\omega$ sinusoidal voltage component that remains due to the saturation of the circulating current controller.",
            "answer": "$$\\boxed{(1-\\kappa) \\frac{V_{m} I_{m}}{8 \\omega C_{sm} V_{dc}}}$$"
        }
    ]
}