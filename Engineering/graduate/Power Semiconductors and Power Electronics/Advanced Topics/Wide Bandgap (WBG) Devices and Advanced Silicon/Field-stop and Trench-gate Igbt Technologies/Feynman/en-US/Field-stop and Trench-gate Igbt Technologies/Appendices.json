{
    "hands_on_practices": [
        {
            "introduction": "The performance of a high-voltage IGBT is fundamentally defined by its ability to block voltage efficiently across its drift region. This exercise delves into the core physics of the \"Field-Stop\" concept, which allows for a more rectangular electric field profile compared to a uniformly doped region. By applying Poisson's equation to a two-layer structure , you will derive the electric field distribution from first principles and appreciate how this engineered doping profile enables a higher breakdown voltage in a thinner, more efficient device.",
            "id": "3839069",
            "problem": "An Insulated Gate Bipolar Transistor (IGBT) in the off-state at high collector–emitter voltage has its vertical blocking capability set by the depleted charge in the lightly doped drift region. Consider a one-dimensional, planar structure composed of two fully depleted, $n$-type layers between a $p$-type base and the collector: a drift layer of thickness $t_{1}$ and donor density $N_{1}$, followed by a field-stop layer of thickness $t_{2}$ and donor density $N_{2}$, with $N_{2} > N_{1}$. The total depleted thickness is $T = t_{1} + t_{2}$. Assume complete depletion of both layers under a high applied collector–emitter voltage $V_{CE}$, negligible space charge outside these layers, and a constant silicon permittivity $\\varepsilon_{s}$.\n\nStarting from Gauss’s law in differential form (Poisson’s equation) and charge neutrality in the depleted $n$-type region, derive the one-dimensional electric field $E(x)$ within the two-layer structure, where $x$ is measured from the metallurgical $p$-base/$n$-drift interface into the $n$ region. Use boundary conditions consistent with reverse bias that ensure the electric field vanishes at the far edge of the depletion region. From your derived $E(x)$:\n- Identify the location $x_{\\max}$ of the maximum electric field and its magnitude $E_{\\max}$ for the two-layer structure.\n- Define an equivalent uniform drift region of thickness $T$ and constant donor density $N_{u}$ that blocks the same voltage $V_{CE}$ under complete depletion. Using first principles, determine the peak field $E_{\\max,u}$ for this uniform case.\n\nFinally, form the ratio $R = E_{\\max} / E_{\\max,u}$ in closed form in terms of $N_{1}$, $N_{2}$, $t_{1}$, and $t_{2}$, and report $x_{\\max}$ measured from the $p$-base/$n$ interface. Express the final answer as a row matrix containing $R$ and $x_{\\max}$. No numerical evaluation is required; provide exact symbolic expressions. Express $x_{\\max}$ in meters.",
            "solution": "The problem requires the analysis of the one-dimensional electric field distribution in a two-layer, fully depleted $n$-type region of an Insulated Gate Bipolar Transistor (IGBT). This analysis is based on Poisson's equation, followed by a comparison with an equivalent uniformly doped structure.\n\nThe foundation of this analysis is Poisson's equation for a semiconductor, which relates the spatial derivative of the electric field $E$ to the local space-charge density $\\rho(x)$:\n$$ \\frac{dE}{dx} = \\frac{\\rho(x)}{\\varepsilon_s} $$\nwhere $\\varepsilon_s$ is the permittivity of silicon. In the depletion approximation for an $n$-type semiconductor, the space charge is due to the ionized donor atoms. Thus, $\\rho(x) = q N_D(x)$, where $q$ is the elementary charge and $N_D(x)$ is the donor concentration profile.\n\nThe structure is defined by two layers:\n1.  A drift layer for $0 \\le x \\le t_1$ with donor density $N_1$.\n2.  A field-stop layer for $t_1 < x \\le T$ with donor density $N_2$, where $T = t_1 + t_2$.\n\nThe corresponding space-charge densities are $\\rho_1 = qN_1$ in the first layer and $\\rho_2 = qN_2$ in the second. The problem specifies that the entire two-layer region is depleted, and the boundary condition at the far end of the depletion region (at the collector side) is that the electric field vanishes. This means $E(T) = E(t_1+t_2) = 0$. The electric field is directed from the higher potential collector towards the lower potential $p$-base, i.e., in the negative $x$ direction.\n\nWe will first derive the electric field profile $E(x)$ by integrating Poisson's equation, starting from the boundary at $x=T$.\n\nFor the field-stop layer ($t_1 < x \\le T$):\n$$ \\frac{dE_2}{dx} = \\frac{qN_2}{\\varepsilon_s} $$\nIntegrating from an arbitrary position $x$ in this layer to the boundary $T$:\n$$ \\int_{E_2(x)}^{E_2(T)} dE = \\int_{x}^{T} \\frac{qN_2}{\\varepsilon_s} dx' $$\n$$ E_2(T) - E_2(x) = \\frac{qN_2}{\\varepsilon_s} (T-x) $$\nSince $E_2(T)=0$, the electric field in the second layer is:\n$$ E_2(x) = -\\frac{qN_2}{\\varepsilon_s} (T-x) = -\\frac{qN_2}{\\varepsilon_s} (t_1 + t_2 - x) $$\n\nThe electric field must be continuous at the interface between the two layers, at $x=t_1$. We find the field at this interface by evaluating $E_2(x)$ at $x=t_1$:\n$$ E_1(t_1) = E_2(t_1) = -\\frac{qN_2}{\\varepsilon_s} (t_1 + t_2 - t_1) = -\\frac{qN_2 t_2}{\\varepsilon_s} $$\n\nNow, for the drift layer ($0 \\le x \\le t_1$):\n$$ \\frac{dE_1}{dx} = \\frac{qN_1}{\\varepsilon_s} $$\nIntegrating from an arbitrary position $x$ in this layer to the interface at $t_1$:\n$$ \\int_{E_1(x)}^{E_1(t_1)} dE = \\int_{x}^{t_1} \\frac{qN_1}{\\varepsilon_s} dx' $$\n$$ E_1(t_1) - E_1(x) = \\frac{qN_1}{\\varepsilon_s} (t_1 - x) $$\nSolving for $E_1(x)$ and substituting the expression for $E_1(t_1)$:\n$$ E_1(x) = E_1(t_1) - \\frac{qN_1}{\\varepsilon_s} (t_1 - x) = -\\frac{qN_2 t_2}{\\varepsilon_s} - \\frac{qN_1}{\\varepsilon_s} (t_1 - x) $$\n\nThe magnitude of the electric field, $|E(x)|$, is largest where the field itself is most negative. The slopes of both $|E_1(x)|$ and $|E_2(x)|$ with respect to $x$ are negative. The function $|E(x)|$ is monotonically decreasing from $x=0$ to $x=T$. Therefore, the maximum electric field magnitude occurs at the $p$-base/$n$-drift metallurgical junction, i.e., at $x=0$.\nThe location of the maximum electric field is $x_{\\max} = 0$, which is $0$ meters from the $p$-base/$n$ interface.\n\nThe magnitude of this maximum field, $E_{\\max}$, is $|E_1(0)|$:\n$$ E_{\\max} = \\left| -\\frac{qN_2 t_2}{\\varepsilon_s} - \\frac{qN_1}{\\varepsilon_s} (t_1 - 0) \\right| = \\frac{q}{\\varepsilon_s} (N_1 t_1 + N_2 t_2) $$\n\nNext, we define an equivalent uniform drift region of total thickness $T = t_1 + t_2$ and constant donor density $N_u$. This structure must block the same total voltage $V_{CE}$ as the two-layer structure. The voltage blocked is the integral of the electric field magnitude across the depletion region.\n\nFirst, we calculate $V_{CE}$ for the two-layer structure:\n$$ V_{CE} = \\int_{0}^{T} |E(x)| dx = \\int_{0}^{t_1} |E_1(x)| dx + \\int_{t_1}^{T} |E_2(x)| dx $$\n$$ V_{CE} = \\int_{0}^{t_1} \\left( \\frac{qN_2 t_2}{\\varepsilon_s} + \\frac{qN_1(t_1 - x)}{\\varepsilon_s} \\right) dx + \\int_{t_1}^{t_1+t_2} \\frac{qN_2(t_1 + t_2 - x)}{\\varepsilon_s} dx $$\n$$ V_{CE} = \\frac{q}{\\varepsilon_s} \\left[ N_2 t_2 x + N_1 t_1 x - \\frac{N_1 x^2}{2} \\right]_{0}^{t_1} + \\frac{qN_2}{\\varepsilon_s} \\left[ (t_1+t_2)x - \\frac{x^2}{2} \\right]_{t_1}^{t_1+t_2} $$\nEvaluating the first integral:\n$$ \\frac{q}{\\varepsilon_s} \\left( N_2 t_1 t_2 + N_1 t_1^2 - \\frac{N_1 t_1^2}{2} \\right) = \\frac{q}{\\varepsilon_s} \\left( \\frac{N_1 t_1^2}{2} + N_2 t_1 t_2 \\right) $$\nEvaluating the second integral:\n$$ \\frac{qN_2}{\\varepsilon_s} \\left( (t_1+t_2)^2 - \\frac{(t_1+t_2)^2}{2} - (t_1+t_2)t_1 + \\frac{t_1^2}{2} \\right) = \\frac{qN_2}{\\varepsilon_s} \\left( \\frac{(t_1+t_2)^2}{2} - t_1^2 - t_1 t_2 + \\frac{t_1^2}{2} \\right) = \\frac{qN_2 t_2^2}{2\\varepsilon_s} $$\nThe total voltage is:\n$$ V_{CE} = \\frac{q}{2\\varepsilon_s} (N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2) $$\n\nFor a uniform drift region of thickness $T$ and doping $N_u$, the electric field profile is a simple triangle, with $|E_u(x)| = \\frac{qN_u}{\\varepsilon_s}(T-x)$. The peak field is $E_{\\max,u} = |E_u(0)| = \\frac{qN_u T}{\\varepsilon_s}$. The voltage blocked is the area of this triangle:\n$$ V_{CE,u} = \\frac{1}{2} \\times \\text{base} \\times \\text{height} = \\frac{1}{2} T E_{\\max,u} $$\nThe problem requires $V_{CE,u} = V_{CE}$. Therefore, we can find the peak field of the equivalent uniform structure, $E_{\\max,u}$, directly from $V_{CE}$:\n$$ E_{\\max,u} = \\frac{2 V_{CE}}{T} = \\frac{2 V_{CE}}{t_1+t_2} $$\nSubstituting our expression for $V_{CE}$:\n$$ E_{\\max,u} = \\frac{2}{t_1+t_2} \\left( \\frac{q}{2\\varepsilon_s} (N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2) \\right) = \\frac{q}{\\varepsilon_s} \\frac{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}{t_1+t_2} $$\n\nFinally, we compute the ratio $R = E_{\\max} / E_{\\max,u}$:\n$$ R = \\frac{\\frac{q}{\\varepsilon_s} (N_1 t_1 + N_2 t_2)}{\\frac{q}{\\varepsilon_s} \\frac{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}{t_1+t_2}} $$\n$$ R = \\frac{(N_1 t_1 + N_2 t_2)(t_1+t_2)}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} $$\nThis expression can be expanded for clarity, though it is not strictly necessary:\n$$ R = \\frac{N_1 t_1^2 + N_1 t_1 t_2 + N_2 t_1 t_2 + N_2 t_2^2}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} = \\frac{N_1 t_1^2 + (N_1+N_2) t_1 t_2 + N_2 t_2^2}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2} $$\n\nThe required results are the ratio $R$ and the location of the maximum field, $x_{\\max}$.\nThe final answers are:\n- $R = \\frac{(N_1 t_1 + N_2 t_2)(t_1+t_2)}{N_1 t_1^2 + 2 N_2 t_1 t_2 + N_2 t_2^2}$\n- $x_{\\max} = 0$\n\nThese are presented as a row matrix.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{(N_{1} t_{1} + N_{2} t_{2})(t_{1} + t_{2})}{N_{1} t_{1}^{2} + 2 N_{2} t_{1} t_{2} + N_{2} t_{2}^{2}} & 0 \\end{pmatrix} } $$"
        },
        {
            "introduction": "Having explored the vertical structure for voltage blocking, we now turn to the lateral design that governs conduction, a key aspect of \"Trench-Gate\" technology. This practice  addresses the critical trade-off inherent in this design: while a smaller cell pitch $p$ increases channel density to reduce conduction loss, it also increases the gate-collector capacitance $C_{\\mathrm{rss}}$, leading to higher switching losses. By formulating a total loss model and finding its minimum, you will learn to balance these competing effects and determine the optimal cell pitch for a specific application.",
            "id": "3839070",
            "problem": "Consider a field-stop, trench-gate Insulated Gate Bipolar Transistor (IGBT) operating in hard-switching conditions. Let the device be laid out as an array of identical unit cells with square cell pitch $p$ (in $\\mathrm{m}$). Assume the following geometry-driven scaling approximations, which are consistent with device physics and widely used in first-order design:\n\n- The total number of cells per fixed die area is proportional to $1/p^2$, so any per-cell quantity that sums over cells scales proportional to $1/p^2$.\n- The effective channel contribution to the on-state resistance scales inversely with total conducting perimeter, hence proportional to $p^2$. Model the resistive part of the conduction as an effective resistance $R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}\\,p^2$, where $R_{\\mathrm{drift}}$ (in $\\Omega$) is a constant drift-region contribution and $k_{\\mathrm{ch}}$ (in $\\Omega/\\mathrm{m}^2$) is a geometry-dependent constant.\n- The reverse transfer (gate-to-collector) capacitance, denoted $C_{\\mathrm{rss}}(p)$ (also referred to as the Miller capacitance), scales proportional to $1/p^2$: $C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$, where $k_{\\mathrm{crss}}$ (in $\\mathrm{F}\\cdot\\mathrm{m}^2$) is a geometry-dependent constant.\n\nLet the device switch a constant load current $I$ (in $\\mathrm{A}$) from a direct current bus voltage $V_{\\mathrm{bus}}$ (in $\\mathrm{V}$), with duty cycle $D$ (unitless, use decimal between $0$ and $1$), at switching frequency $f_{\\mathrm{s}}$ (in $\\mathrm{Hz}$). The gate driver can supply a constant gate current $I_{\\mathrm{g}}$ (in $\\mathrm{A}$) during the Miller plateau. The conduction characteristics include a knee-voltage $V_{\\mathrm{knee}}$ (in $\\mathrm{V}$) representing the bipolar drop in the IGBT.\n\nUsing only fundamental relationships and definitions, derive a total loss model $P_{\\mathrm{tot}}(p)$ (in $\\mathrm{W}$) comprising:\n- Conduction loss due to the resistive component $R_{\\mathrm{eff}}(p)$ under duty $D$ and current $I$.\n- Conduction loss due to the knee-voltage $V_{\\mathrm{knee}}$ under duty $D$ and current $I$.\n- Switching loss due to the Miller overlap energy associated with $C_{\\mathrm{rss}}(p)$, assuming the collector-emitter voltage slews approximately from $V_{\\mathrm{bus}}$ to a low value during turn-on and vice versa during turn-off, and that the Miller plateau current is limited by $I_{\\mathrm{g}}$.\n\nThen, compute the pitch $p_{\\mathrm{opt}}$ (in $\\mathrm{m}$) that minimizes $P_{\\mathrm{tot}}(p)$ and the corresponding minimal total loss $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ (in $\\mathrm{W}$), for each parameter set in the test suite below. Express the optimum pitch in $\\mathrm{m}$ and the minimal total loss in $\\mathrm{W}$.\n\nFoundational relationships you may invoke include:\n- Capacitance as charge-voltage relation $Q = C\\,V$.\n- Energy stored in a capacitor $E_C = \\frac{1}{2} C V^2$.\n- Power as energy per unit time $P = E/t$.\n- Power in resistive conduction $P_R = I^2 R$.\n- The definition of duty cycle as the fraction of time the device conducts at the stated current.\n\nTest suite (each tuple provides $(f_{\\mathrm{s}}, V_{\\mathrm{bus}}, I, D, I_{\\mathrm{g}}, R_{\\mathrm{drift}}, V_{\\mathrm{knee}}, k_{\\mathrm{ch}}, k_{\\mathrm{crss}})$ with units as specified above):\n- Case $1$ (general case): $(20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $2$ (high switching frequency): $(100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $3$ (weak gate driver): $(20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $4$ (lower load current): $(20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n- Case $5$ (low switching frequency, high duty): $(2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0\\times 10^{8}, 3.0\\times 10^{-21})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[ [p_1, P_1], [p_2, P_2], \\dots ]$), where each inner list contains the optimum pitch $p_{\\mathrm{opt}}$ (in $\\mathrm{m}$) and the corresponding minimal total loss $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ (in $\\mathrm{W}$) for the respective test case.",
            "solution": "The user-provided problem is evaluated and found to be valid. It is scientifically grounded in the principles of power semiconductor physics and power electronics, well-posed as a mathematical optimization problem, and all parameters are clearly defined and physically realistic.\n\nThe objective is to derive an expression for the total power loss, $P_{\\mathrm{tot}}(p)$, as a function of the IGBT unit cell pitch, $p$, and to find the optimal pitch, $p_{\\mathrm{opt}}$, that minimizes this loss. The total loss is comprised of conduction losses and switching losses.\n\nFirst, we formulate the expression for the conduction loss, $P_{\\mathrm{cond}}$. The device conducts a current $I$ for a fraction of the switching period determined by the duty cycle $D$. The on-state voltage drop across the IGBT is the sum of a constant knee-voltage $V_{\\mathrm{knee}}$ and a resistive drop. The instantaneous power dissipated during conduction is $P_{\\mathrm{inst, cond}} = V_{\\mathrm{on}} I = (V_{\\mathrm{knee}} + I R_{\\mathrm{eff}}(p)) I$. Averaged over a full switching cycle, the conduction power loss is:\n$$ P_{\\mathrm{cond}}(p) = D \\cdot (V_{\\mathrm{knee}} I + I^2 R_{\\mathrm{eff}}(p)) $$\nThe problem provides the model for the effective resistance as $R_{\\mathrm{eff}}(p) = R_{\\mathrm{drift}} + k_{\\mathrm{ch}}p^2$. Substituting this into the conduction loss equation yields:\n$$ P_{\\mathrm{cond}}(p) = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}} + D I^2 k_{\\mathrm{ch}} p^2 $$\nThe first two terms are independent of the cell pitch $p$, while the third term represents the portion of the conduction loss that increases with $p^2$.\n\nNext, we formulate the expression for the switching loss, $P_{\\mathrm{sw}}$. The problem specifies this loss is due to the Miller overlap energy. This energy is dissipated during the turn-on and turn-off transitions when both substantial voltage and current are present across the device. The model considers the interval where the collector current is at the full load value, $I$, while the collector-emitter voltage, $V_{\\mathrm{ce}}$, slews across the bus voltage, $V_{\\mathrm{bus}}$. This voltage slew is controlled by a constant gate current $I_{\\mathrmg}$ charging or discharging the gate-collector (Miller) capacitance, $C_{\\mathrm{rss}}(p)$.\n\nThe change in charge on the Miller capacitance required to slew the voltage by $V_{\\mathrm{bus}}$ is $\\Delta Q = C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}$. The time taken for this slew, i.e., the duration of the Miller plateau, is $t_{\\mathrm{v,slew}} = \\frac{\\Delta Q}{I_{\\mathrmg}} = \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrmg}}$.\nAssuming a linear voltage slew, the energy dissipated during one such transition (e.g., turn-on) is $E_{\\mathrm{on}} = \\int p(t) dt = \\int V_{\\mathrm{ce}}(t) I dt = \\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$. The total energy dissipated per switching cycle includes both turn-on and turn-off events. Assuming symmetric transitions, the total switching energy is $E_{\\mathrm{sw}} = E_{\\mathrm{on}} + E_{\\mathrm{off}} = 2 \\cdot (\\frac{1}{2} I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}) = I V_{\\mathrm{bus}} t_{\\mathrm{v,slew}}$.\nSubstituting the expression for $t_{\\mathrm{v,slew}}$:\n$$ E_{\\mathrm{sw}}(p) = I V_{\\mathrm{bus}} \\left( \\frac{C_{\\mathrm{rss}}(p) V_{\\mathrm{bus}}}{I_{\\mathrmg}} \\right) = \\frac{I V_{\\mathrm{bus}}^2 C_{\\mathrm{rss}}(p)}{I_{\\mathrmg}} $$\nThe average switching power is an average of this energy over the switching period $T_{\\mathrms} = 1/f_{\\mathrms}$, so $P_{\\mathrm{sw}} = E_{\\mathrm{sw}} \\cdot f_{\\mathrms}$. Using the given model for Miller capacitance, $C_{\\mathrm{rss}}(p) = k_{\\mathrm{crss}}/p^2$:\n$$ P_{\\mathrm{sw}}(p) = f_{\\mathrm{s}} \\frac{I V_{\\mathrm{bus}}^2}{I_{\\mathrmg}} \\frac{k_{\\mathrm{crss}}}{p^2} $$\n\nThe total power loss, $P_{\\mathrm{tot}}(p)$, is the sum of the conduction and switching losses:\n$$ P_{\\mathrm{tot}}(p) = P_{\\mathrm{cond}}(p) + P_{\\mathrm{sw}}(p) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + (D I^2 k_{\\mathrm{ch}}) p^2 + \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrmg}} \\right) \\frac{1}{p^2} $$\nThis equation is of the form $P_{\\mathrm{tot}}(p) = C_0 + C_1 p^2 + C_2 p^{-2}$, where $C_0$, $C_1$, and $C_2$ are positive constants representing the pitch-independent loss, the pitch-dependent conduction loss scaling, and the switching loss scaling, respectively.\n- $C_0 = D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}$\n- $C_1 = D I^2 k_{\\mathrm{ch}}$\n- $C_2 = f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrmg}$\n\nTo find the optimal pitch $p_{\\mathrm{opt}}$ that minimizes $P_{\\mathrm{tot}}(p)$, we take the derivative with respect to $p$ and set it to zero:\n$$ \\frac{d P_{\\mathrm{tot}}}{dp} = 2 C_1 p - 2 C_2 p^{-3} = 0 $$\n$$ 2 C_1 p_{\\mathrm{opt}} = 2 C_2 p_{\\mathrm{opt}}^{-3} \\implies p_{\\mathrm{opt}}^4 = \\frac{C_2}{C_1} $$\nSolving for $p_{\\mathrm{opt}}$ (which must be a positive real number):\n$$ p_{\\mathrm{opt}} = \\left( \\frac{C_2}{C_1} \\right)^{1/4} = \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}} / I_{\\mathrmg}}{D I^2 k_{\\mathrm{ch}}} \\right)^{1/4} = \\left( \\frac{f_{\\mathrms} V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{D I I_{\\mathrmg} k_{\\mathrmch}} \\right)^{1/4} $$\nThe minimal total loss, $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$, is found by substituting $p_{\\mathrm{opt}}$ back into the total loss equation. At the optimum point, the pitch-dependent conduction loss equals the switching loss: $C_1 p_{\\mathrm{opt}}^2 = C_2 p_{\\mathrm{opt}}^{-2} = \\sqrt{C_1 C_2}$.\nTherefore, the minimum total loss is:\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = C_0 + C_1 p_{\\mathrm{opt}}^2 + C_2 p_{\\mathrm{opt}}^{-2} = C_0 + \\sqrt{C_1 C_2} + \\sqrt{C_1 C_2} = C_0 + 2\\sqrt{C_1 C_2} $$\nSubstituting the expressions for $C_0$, $C_1$, and $C_2$:\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = (D I V_{\\mathrm{knee}} + D I^2 R_{\\mathrm{drift}}) + 2 \\sqrt{(D I^2 k_{\\mathrm{ch}}) \\left( \\frac{f_{\\mathrms} I V_{\\mathrm{bus}}^2 k_{\\mathrm{crss}}}{I_{\\mathrmg}} \\right)} $$\n$$ P_{\\mathrm{tot}}(p_{\\mathrm{opt}}) = D I(V_{\\mathrm{knee}} + I R_{\\mathrm{drift}}) + 2 I V_{\\mathrm{bus}} \\sqrt{\\frac{D I f_{\\mathrms} k_{\\mathrm{ch}} k_{\\mathrm{crss}}}{I_{\\mathrmg}}} $$\nThese derived formulas for $p_{\\mathrm{opt}}$ and $P_{\\mathrm{tot}}(p_{\\mathrm{opt}})$ are implemented to process the given test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal IGBT cell pitch and the corresponding minimum total power loss\n    for a series of test cases based on a derived loss model.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple provides (f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss)\n    test_cases = [\n        # Case 1 (general case)\n        (20000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 2 (high switching frequency)\n        (100000.0, 600.0, 50.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 3 (weak gate driver)\n        (20000.0, 600.0, 50.0, 0.5, 0.5, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 4 (lower load current)\n        (20000.0, 600.0, 10.0, 0.5, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n        # Case 5 (low switching frequency, high duty)\n        (2000.0, 600.0, 50.0, 0.9, 2.0, 0.005, 1.5, 1.0e8, 3.0e-21),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_s, V_bus, I, D, I_g, R_drift, V_knee, k_ch, k_crss = case\n\n        # --- Calculate Optimal Pitch (p_opt) ---\n        # The optimal pitch p_opt is derived from d(P_tot)/dp = 0.\n        # p_opt = ( (f_s * V_bus^2 * k_crss) / (D * I * I_g * k_ch) )^(1/4)\n        p_opt_numerator = f_s * V_bus**2 * k_crss\n        p_opt_denominator = D * I * I_g * k_ch\n        p_opt = (p_opt_numerator / p_opt_denominator)**0.25\n\n        # --- Calculate Minimal Total Loss (P_tot_opt) ---\n        # The minimal total loss is P_tot(p_opt) = C0 + 2*sqrt(C1*C2), where:\n        # C0 = D*I*V_knee + D*I^2*R_drift (pitch-independent losses)\n        # C1 = D*I^2*k_ch (pitch-dependent conduction loss coefficient)\n        # C2 = f_s*I*V_bus^2*k_crss / I_g (switching loss coefficient)\n        \n        # Calculate pitch-independent loss component\n        C0 = D * I * (V_knee + I * R_drift)\n        \n        # Calculate pitch-dependent loss coefficients\n        C1 = D * I**2 * k_ch\n        C2 = (f_s * I * V_bus**2 * k_crss) / I_g\n        \n        # Calculate the minimal total loss\n        P_tot_opt = C0 + 2 * np.sqrt(C1 * C2)\n        \n        results.append([p_opt, P_tot_opt])\n\n    # Final print statement in the exact required format.\n    # The default string conversion of the list of lists matches the required output format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "An optimized device design must also ensure reliable operation within a system, a task that requires understanding its thermal behavior. This exercise  challenges you to model the electrothermal feedback loop that can lead to thermal runaway, a risk amplified by the positive temperature coefficient of modern trench-gate IGBTs. By implementing a transient simulation using a convolution-based thermal model, you will gain the skills to distinguish between stable operation and a catastrophic failure mode, a crucial aspect of power electronic system design.",
            "id": "3839091",
            "problem": "Consider a Field-Stop and Trench-Gate Insulated Gate Bipolar Transistor (IGBT) operating under a constant collector current. The electrothermal coupling is modeled from first principles by the product relation $P(T) = V_{CE}(T) \\, I$ and a linear time-invariant thermal network whose impulse-response kernel $Z_{\\theta}(t)$ relates the instantaneous junction temperature $T(t)$ to the past power history as\n$$\nT(t) = T_a + \\int_{0}^{t} P(\\tau)\\, Z_{\\theta}(t - \\tau)\\, d\\tau,\n$$\nwhere $T_a$ is the ambient temperature. In this problem, $Z_{\\theta}(t)$ is the impulse response (not the step response) of the thermal network to a unit power impulse, with units $\\mathrm{K}/(\\mathrm{W}\\cdot \\mathrm{s})$, so that $\\int_{0}^{\\infty} Z_{\\theta}(t)\\, dt = R_{\\theta}$ equals the steady-state thermal resistance in $\\mathrm{K}/\\mathrm{W}$.\n\nAssume the conduction characteristic of the IGBT under high-injection conduction can be captured by the affine form\n$$\nV_{CE}(T) = V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T - T_{\\mathrm{ref}}),\n$$\nwhere $V_{\\mathrm{knee}}$ is the temperature-referenced knee-voltage at $T_{\\mathrm{ref}}$ (in $\\mathrm{V}$), $r_c$ is the effective conduction slope (in $\\Omega$), $I$ is the collector current (in $\\mathrm{A}$), and $\\alpha$ is the temperature coefficient (in $\\mathrm{V}/\\mathrm{K}$). For modern field-stop trench-gate devices, $\\alpha$ tends to be positive at rated currents, while for older punch-through planar technologies at low currents, $\\alpha$ can be slightly negative due to the dominance of bipolar transport with decreased carrier mobility.\n\nThe thermal kernel is parameterized by a sum of exponentials associated with a Cauer-type ladder network,\n$$\nZ_{\\theta}(t) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, H(t),\n$$\nwhere $R_i$ (in $\\mathrm{K}/\\mathrm{W}$) and $\\tau_i$ (in $\\mathrm{s}$) are nonnegative parameters and $H(t)$ is the Heaviside step function. The steady-state thermal resistance is $R_{\\theta} = \\sum_{i=1}^{N} R_i$.\n\nYou must detect thermal runaway risk under a specified cooling boundary and electrical bias. For a constant current $I$ and the linear $V_{CE}(T)$ model above, a necessary condition for a finite steady-state temperature is\n$$\n1 - R_{\\theta}\\, I\\, \\alpha > 0.\n$$\nIf $1 - R_{\\theta}\\, I\\, \\alpha \\le 0$, then no finite fixed point exists under the model and the system presents thermal runaway risk. In addition, even if this inequality is satisfied, the dynamic temperature $T(t)$ may still exceed the maximum allowable junction temperature $T_{j,\\max}$ within a finite horizon due to transient accumulation. Therefore, define the risk flag as true if either of the following holds:\n1. $1 - R_{\\theta}\\, I\\, \\alpha \\le 0$, or\n2. The simulated $T(t)$, computed by numerically evaluating the convolution above, crosses $T_{j,\\max}$ within the simulation time horizon.\n\nNumerically, use a uniform time step $\\Delta t$ and the explicit Euler discretization of the Volterra integral:\n$$\nT[n] = T_a + \\Delta t \\sum_{k=0}^{n} Z_{\\theta}(t_n - t_k)\\, P(T[k]),\n$$\nwith $t_n = n\\, \\Delta t$ and $P(T[k]) = I\\, V_{CE}(T[k])$. For the instantaneous term at $k=n$, use the explicit value $P(T[n-1])$ to maintain causality and avoid solving a nonlinear algebraic loop at each step. Express all temperatures in $\\mathrm{K}$, voltages in $\\mathrm{V}$, currents in $\\mathrm{A}$, time in $\\mathrm{s}$, and power in $\\mathrm{W}$.\n\nImplement a program that, for each test case below, outputs a boolean indicating thermal runaway risk according to the rule above. The final output must be a single line that aggregates the results for all test cases as a comma-separated Python list, for example $[x_1,x_2,x_3,x_4]$, where each $x_i$ is either $True$ or $False$.\n\nTest suite:\n- Case A (field-stop trench-gate, good cooling, expected stable): $T_a = 298\\,\\mathrm{K}$, $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$, $I = 50\\,\\mathrm{A}$, $V_{\\mathrm{knee}} = 1.4\\,\\mathrm{V}$, $r_c = 0.005\\,\\Omega$, $\\alpha = 0.0025\\,\\mathrm{V}/\\mathrm{K}$, $N = 3$, $(R_1,R_2,R_3) = (0.15, 0.15, 0.10)\\,\\mathrm{K}/\\mathrm{W}$, $(\\tau_1,\\tau_2,\\tau_3) = (0.1, 1.0, 5.0)\\,\\mathrm{s}$, $T_{j,\\max} = 423\\,\\mathrm{K}$, simulation horizon $T_{\\mathrm{end}} = 10.0\\,\\mathrm{s}$, time step $\\Delta t = 0.005\\,\\mathrm{s}$.\n- Case B (field-stop trench-gate, poor cooling, expected runaway by fixed-point criterion and transient crossing): $T_a = 300\\,\\mathrm{K}$, $T_{\\mathrm{ref}} = 300\\,\\mathrm{K}$, $I = 300\\,\\mathrm{A}$, $V_{\\mathrm{knee}} = 1.4\\,\\mathrm{V}$, $r_c = 0.005\\,\\Omega$, $\\alpha = 0.0030\\,\\mathrm{V}/\\mathrm{K}$, $N = 3$, $(R_1,R_2,R_3) = (0.50, 0.50, 0.50)\\,\\mathrm{K}/\\mathrm{W}$, $(\\tau_1,\\tau_2,\\tau_3) = (0.2, 2.0, 20.0)\\,\\mathrm{s}$, $T_{j,\\max} = 423\\,\\mathrm{K}$, $T_{\\mathrm{end}} = 4.0\\,\\mathrm{s}$, $\\Delta t = 0.002\\,\\mathrm{s}$.\n- Case C (punch-through planar, negative temperature coefficient at low current, expected stable): $T_a = 298\\,\\mathrm{K}$, $T_{\\mathrm{ref}} = 298\\,\\mathrm{K}$, $I = 15\\,\\mathrm{A}$, $V_{\\mathrm{knee}} = 1.6\\,\\mathrm{V}$, $r_c = 0.004\\,\\Omega$, $\\alpha = -0.0015\\,\\mathrm{V}/\\mathrm{K}$, $N = 3$, $(R_1,R_2,R_3) = (0.10, 0.10, 0.10)\\,\\mathrm{K}/\\mathrm{W}$, $(\\tau_1,\\tau_2,\\tau_3) = (0.05, 0.50, 5.00)\\,\\mathrm{s}$, $T_{j,\\max} = 423\\,\\mathrm{K}$, $T_{\\mathrm{end}} = 8.0\\,\\mathrm{s}$, $\\Delta t = 0.005\\,\\mathrm{s}$.\n- Case D (near-critical field-stop trench-gate, boundary condition at the stability threshold, declare risk): $T_a = 310\\,\\mathrm{K}$, $T_{\\mathrm{ref}} = 310\\,\\mathrm{K}$, $I = 500\\,\\mathrm{A}$, $V_{\\mathrm{knee}} = 1.3\\,\\mathrm{V}$, $r_c = 0.0045\\,\\Omega$, $\\alpha = 0.0025\\,\\mathrm{V}/\\mathrm{K}$, $N = 3$, $(R_1,R_2,R_3) = (0.30, 0.25, 0.25)\\,\\mathrm{K}/\\mathrm{W}$, $(\\tau_1,\\tau_2,\\tau_3) = (0.10, 1.00, 10.00)\\,\\mathrm{s}$, $T_{j,\\max} = 423\\,\\mathrm{K}$, $T_{\\mathrm{end}} = 3.0\\,\\mathrm{s}$, $\\Delta t = 0.002\\,\\mathrm{s}$.\n\nYour program must:\n1. Implement the model described above.\n2. For each case, compute $R_{\\theta} = \\sum_{i=1}^{N} R_i$ and check the fixed-point criterion $1 - R_{\\theta}\\, I\\, \\alpha \\le 0$.\n3. If the fixed-point criterion does not immediately indicate risk, run the explicit convolution until $T_{\\mathrm{end}}$ or until $T(t)$ exceeds $T_{j,\\max}$, whichever happens first.\n4. Return a boolean per case: $True$ if risk is detected, $False$ otherwise.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[True,False,False,True]$). No additional text should be printed. All calculations must adhere to the specified units and the impulse-response interpretation of $Z_{\\theta}(t)$.",
            "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of power-semiconductor electrothermics, well-posed with a complete set of parameters and a clear objective, and formulated using precise, objective language. The models and methods described are standard representations in the field of power electronics engineering. The solution proceeds as follows.\n\nThe problem requires the assessment of thermal runaway risk for a Field-Stop and Trench-Gate Insulated Gate Bipolar Transistor (IGBT) under constant current operation. The risk is determined by two conditions: (1) violation of the steady-state stability criterion, and (2) exceedance of the maximum junction temperature, $T_{j,\\max}$, during a transient simulation.\n\nThe electrothermal behavior is described by a coupled system of equations. The instantaneous power dissipation, $P(T)$, is given by the product of the constant collector current, $I$, and the temperature-dependent collector-emitter voltage, $V_{CE}(T)$:\n$$\nP(T) = V_{CE}(T) \\, I\n$$\nThe collector-emitter voltage is modeled as an affine function of the junction temperature, $T$:\n$$\nV_{CE}(T) = V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T - T_{\\mathrm{ref}})\n$$\nwhere $V_{\\mathrm{knee}}$ is a reference knee voltage, $r_c$ is a resistive slope, $\\alpha$ is the temperature coefficient, and $T_{\\mathrm{ref}}$ is a reference temperature.\n\nThe junction temperature, $T(t)$, is related to the power dissipation history, $P(\\tau)$, through a Volterra integral equation of the first kind, which represents the convolution of the power with the thermal system's impulse response, $Z_{\\theta}(t)$:\n$$\nT(t) = T_a + \\int_{0}^{t} P(T(\\tau))\\, Z_{\\theta}(t - \\tau)\\, d\\tau\n$$\nwhere $T_a$ is the ambient temperature. The thermal impulse-response kernel, $Z_{\\theta}(t)$, is represented by a sum of exponentials, characteristic of a Cauer thermal network model:\n$$\nZ_{\\theta}(t) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, H(t)\n$$\nHere, $R_i$ and $\\tau_i$ are the thermal resistances and time constants of the network, and $H(t)$ is the Heaviside step function.\n\n**1. Steady-State Stability Criterion (Risk Criterion 1)**\n\nThe first check is for the existence of a stable, finite steady-state junction temperature, $T_{ss}$. In steady state ($t \\to \\infty$), the temperature and power are constant, $T_{ss}$ and $P_{ss} = P(T_{ss})$, respectively. The convolution integral simplifies to:\n$$\nT_{ss} = T_a + P_{ss} \\int_{0}^{\\infty} Z_{\\theta}(u)\\, du\n$$\nThe integral of the impulse response over all time is the total steady-state thermal resistance, $R_{\\theta}$:\n$$\nR_{\\theta} = \\int_{0}^{\\infty} Z_{\\theta}(t)\\, dt = \\sum_{i=1}^{N} \\int_{0}^{\\infty} \\frac{R_i}{\\tau_i}\\, e^{-t/\\tau_i}\\, dt = \\sum_{i=1}^{N} R_i\n$$\nSubstituting $P_{ss}$ and $R_{\\theta}$ into the temperature equation gives:\n$$\nT_{ss} = T_a + R_{\\theta} \\, I \\, V_{CE}(T_{ss})\n$$\nSubstituting the expression for $V_{CE}(T_{ss})$:\n$$\nT_{ss} = T_a + R_{\\theta} \\, I \\, [V_{\\mathrm{knee}} + r_c \\, I + \\alpha \\, (T_{ss} - T_{\\mathrm{ref}})]\n$$\nThis is a linear equation for $T_{ss}$. To solve for $T_{ss}$, we rearrange the terms:\n$$\nT_{ss} - R_{\\theta} \\, I \\, \\alpha \\, T_{ss} = T_a + R_{\\theta} \\, I \\, (V_{\\mathrm{knee}} + r_c \\, I - \\alpha \\, T_{\\mathrm{ref}})\n$$\n$$\nT_{ss} (1 - R_{\\theta} \\, I \\, \\alpha) = T_a + R_{\\theta} \\, I \\, (V_{\\mathrm{knee}} + r_c \\, I - \\alpha \\, T_{\\mathrm{ref}})\n$$\nA finite, non-negative solution for $T_{ss}$ that corresponds to a stable system requires the denominator of the solution to be positive. A positive feedback loop is established when the term $R_{\\theta} \\, I \\, \\alpha$ (which represents the loop gain of the electrothermal system) approaches or exceeds $1$. Thus, stability requires:\n$$\n1 - R_{\\theta} \\, I \\, \\alpha > 0\n$$\nIf this condition is not met, i.e., $1 - R_{\\theta} \\, I \\, \\alpha \\le 0$, the system is unstable, and thermal runaway is guaranteed. This constitutes the first risk criterion. For each test case, we first compute $R_{\\theta} = \\sum_{i=1}^{N} R_i$ and check this inequality. If it indicates risk, the flag is set to true, and no further analysis is needed for that case.\n\n**2. Transient Temperature Simulation (Risk Criterion 2)**\n\nIf the steady-state criterion predicts stability, we must still check for transient over-temperature. The junction temperature might temporarily exceed $T_{j,\\max}$ before settling to its steady-state value. This requires a numerical solution of the Volterra integral equation. The problem specifies an explicit Euler discretization:\n$$\nT[n] = T_a + \\Delta t \\sum_{k=0}^{n} Z_{\\theta}(t_n - t_k)\\, P(T[k])\n$$\nwhere $t_n = n \\Delta t$. To maintain an explicit, causal update scheme, the problem states that for the term where $k=n$, the power $P(T[n])$ should be approximated by $P(T[n-1])$. This leads to the following discrete-time update rule for the temperature $T[n] \\equiv T(t_n)$:\n$$\nT[n] = T_a + \\Delta t \\left( \\sum_{k=0}^{n-1} Z_{\\theta}((n-k)\\Delta t) P(T[k]) \\right) + \\Delta t Z_{\\theta}(0) P(T[n-1])\n$$\nThe simulation is initialized with the physically correct condition at time $t=0$, which is $T[0] = T_a$. The temperature at subsequent time steps $T[1], T[2], \\dots, T[N_{\\mathrm{steps}}]$ is calculated iteratively, where $N_{\\mathrm{steps}} = \\lfloor T_{\\mathrm{end}} / \\Delta t \\rfloor$. The term $Z_{\\theta}(0)$ is computed as $Z_{\\theta}(0) = \\sum_{i=1}^{N} \\frac{R_i}{\\tau_i}$.\n\nThe algorithm for the transient analysis is as follows:\nInitialize an array for temperature, $T$, of size $N_{\\mathrm{steps}}+1$, with $T[0]=T_a$.\nIterate for $n$ from $1$ to $N_{\\mathrm{steps}}$:\na. Calculate the convolution sum over past power values: $S_n = \\sum_{k=0}^{n-1} Z_{\\theta}((n-k)\\Delta t) P(T[k])$.\nb. Calculate the power at the previous step, $P_{n-1} = P(T[n-1])$.\nc. Calculate the term for $k=n$: $Z_{\\theta}(0) P_{n-1}$.\nd. Update the temperature: $T[n] = T_a + \\Delta t (S_n + Z_{\\theta}(0) P_{n-1})$.\ne. Check for temperature violation: If $T[n] > T_{j,\\max}$, the risk flag is set to true, and the simulation for the current case is terminated.\n\nIf the simulation completes for the entire time horizon $T_{\\mathrm{end}}$ without $T[n]$ exceeding $T_{j,\\max}$, the device is considered transiently stable for that period, and the risk flag is false.\n\nThe final boolean result for each case is the logical OR of the outcomes from the steady-state and transient checks.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the IGBT thermal runaway problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A: field-stop trench-gate, good cooling, expected stable\n        {\n            \"Ta\": 298.0, \"T_ref\": 298.0, \"I\": 50.0, \"V_knee\": 1.4, \"r_c\": 0.005,\n            \"alpha\": 0.0025, \"N\": 3, \"R_vals\": np.array([0.15, 0.15, 0.10]),\n            \"tau_vals\": np.array([0.1, 1.0, 5.0]), \"Tj_max\": 423.0,\n            \"t_end\": 10.0, \"dt\": 0.005\n        },\n        # Case B: field-stop trench-gate, poor cooling, expected runaway\n        {\n            \"Ta\": 300.0, \"T_ref\": 300.0, \"I\": 300.0, \"V_knee\": 1.4, \"r_c\": 0.005,\n            \"alpha\": 0.0030, \"N\": 3, \"R_vals\": np.array([0.50, 0.50, 0.50]),\n            \"tau_vals\": np.array([0.2, 2.0, 20.0]), \"Tj_max\": 423.0,\n            \"t_end\": 4.0, \"dt\": 0.002\n        },\n        # Case C: punch-through planar, negative tempco, expected stable\n        {\n            \"Ta\": 298.0, \"T_ref\": 298.0, \"I\": 15.0, \"V_knee\": 1.6, \"r_c\": 0.004,\n            \"alpha\": -0.0015, \"N\": 3, \"R_vals\": np.array([0.10, 0.10, 0.10]),\n            \"tau_vals\": np.array([0.05, 0.50, 5.00]), \"Tj_max\": 423.0,\n            \"t_end\": 8.0, \"dt\": 0.005\n        },\n        # Case D: near-critical, boundary condition, declare risk\n        {\n            \"Ta\": 310.0, \"T_ref\": 310.0, \"I\": 500.0, \"V_knee\": 1.3, \"r_c\": 0.0045,\n            \"alpha\": 0.0025, \"N\": 3, \"R_vals\": np.array([0.30, 0.25, 0.25]),\n            \"tau_vals\": np.array([0.10, 1.00, 10.00]), \"Tj_max\": 423.0,\n            \"t_end\": 3.0, \"dt\": 0.002\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        risk = check_runaway_risk(case)\n        results.append(risk)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef check_runaway_risk(params):\n    \"\"\"\n    Checks for thermal runaway risk for a single IGBT case.\n\n    Returns:\n        bool: True if runaway risk is detected, False otherwise.\n    \"\"\"\n    Ta = params[\"Ta\"]\n    T_ref = params[\"T_ref\"]\n    I = params[\"I\"]\n    V_knee = params[\"V_knee\"]\n    r_c = params[\"r_c\"]\n    alpha = params[\"alpha\"]\n    R_vals = params[\"R_vals\"]\n    tau_vals = params[\"tau_vals\"]\n    Tj_max = params[\"Tj_max\"]\n    t_end = params[\"t_end\"]\n    dt = params[\"dt\"]\n\n    # Helper function for power calculation\n    def calculate_power(T, I, V_knee, r_c, alpha, T_ref):\n        V_ce = V_knee + r_c * I + alpha * (T - T_ref)\n        return V_ce * I\n\n    # Helper function for thermal impulse response Z_theta(t)\n    # This is not vectorized for multiple t values to keep the main loop logic simple\n    def calculate_Z_theta(t, R, tau):\n        # H(t) is implicit as we only evaluate for t >= 0\n        return np.sum((R / tau) * np.exp(-t / tau))\n\n    # --- Criterion 1: Steady-State Stability Check ---\n    R_theta = np.sum(R_vals)\n    stability_factor = 1 - R_theta * I * alpha\n    if stability_factor <= 0:\n        return True\n\n    # --- Criterion 2: Transient Simulation Check ---\n    num_steps = int(round(t_end / dt))\n    T = np.zeros(num_steps + 1)\n    T[0] = Ta\n    \n    # Pre-calculated power history array for efficiency\n    P_hist = np.zeros(num_steps + 1)\n    P_hist[0] = calculate_power(T[0], I, V_knee, r_c, alpha, T_ref)\n    \n    # Pre-calculate Z_theta(0)\n    Z0 = calculate_Z_theta(0, R_vals, tau_vals)\n\n    for n in range(1, num_steps + 1):\n        # Implementation of the discrete convolution as specified in the problem:\n        # T[n] = Ta + dt * [ sum_{k=0 to n-1} Z((n-k)dt)P(T[k]) + Z(0)P(T[n-1]) ]\n        \n        # Calculate convolution sum over past states\n        conv_sum_main = 0.0\n        for k in range(n):  # k iterates from 0 to n-1\n            time_diff = (n - k) * dt\n            z_val = calculate_Z_theta(time_diff, R_vals, tau_vals)\n            # P_hist[k] was computed in a previous step or at initialization\n            conv_sum_main += z_val * P_hist[k]\n        \n        # Power at previous timestep for the k=n term\n        # P_hist[n-1] was computed in the (n-1)th iteration\n        p_n_minus_1 = P_hist[n-1]\n        term_k_equals_n = Z0 * p_n_minus_1\n        \n        # Combine terms to find T[n]\n        T[n] = Ta + dt * (conv_sum_main + term_k_equals_n)\n        \n        # Store power at current step for next iteration's history\n        P_hist[n] = calculate_power(T[n], I, V_knee, r_c, alpha, T_ref)\n\n        if T[n] > Tj_max:\n            return True\n\n    return False\n\n# Execute the solver\nsolve()\n```"
        }
    ]
}