{
    "hands_on_practices": [
        {
            "introduction": "第一个练习从基础入手。通过根据给定的各次谐波分量的有效值计算电流总谐波失真（$THD_I$）和畸变因数，您将巩固构成所有电能质量分析核心的基本定义。这项实践对于建立量化波形畸变的坚实基础至关重要。",
            "id": "3887789",
            "problem": "一个非线性负载连接到角频率为 $\\,\\omega_0\\,$ 的理想正弦电压源，其汲取的单相电流仅包含基波、三次和五次谐波分量。这些分量的有效值 (RMS) 大小由 $\\,I_1 = 50\\ \\mathrm{A}$、$\\,I_3 = 10\\ \\mathrm{A}$ 和 $\\,I_5 = 5\\ \\mathrm{A}$ 给出。仅使用有效值的基本定义、不同正弦谐波在整数个周期内的正交性，以及电流总谐波失真和失真因数的标准电能质量定义，确定以下各项的数值：\n- 电流总谐波失真 $\\,THD_I\\,$，根据谐波分量的有效值大小定义，以及\n- 失真因数，定义为基波分量有效值与总电流有效值的比值。\n\n假设给定的幅值 $\\,I_n\\,$ 是各谐波分量的有效值，并且任何谐波相角都是任意但固定的。按 $\\,THD_I\\,$、然后是失真因数的顺序报告你的两个结果，每个结果都应是四舍五入到四位有效数字的无单位小数。不要使用百分号。最终的数值答案必须表示为按该顺序排列的一对数字。",
            "solution": "该问题被评估为有效，因为它科学地基于电力电子学原理，是自洽的、适定的、客观的，并且没有任何指定的缺陷。\n\n非线性负载汲取的瞬时电流 $i(t)$ 由基波分量和各次谐波分量组成。已知仅存在基波、三次和五次谐波。该电流的表达式为：\n$$i(t) = i_1(t) + i_3(t) + i_5(t)$$\n其中 $i_n(t)$ 代表第$n$次谐波分量。已知 $I_n$ 是第$n$次谐波的有效值（RMS）大小，每个分量的瞬时值可以写为：\n$$i_n(t) = \\sqrt{2} I_n \\sin(n\\omega_0 t + \\phi_n)$$\n这里，$\\omega_0$ 是基波分量的角频率，$\\phi_n$ 是第$n$次谐波分量的相角。问题陈述这些相角是任意但固定的。\n\n电流的总有效值 $I_{rms}$ 定义为：\n$$I_{rms} = \\sqrt{\\frac{1}{T} \\int_0^T i(t)^2 dt}$$\n其中 $T = \\frac{2\\pi}{\\omega_0}$ 是基波分量的周期。\n代入 $i(t)$ 的表达式：\n$$I_{rms}^2 = \\frac{1}{T} \\int_0^T \\left( \\sum_{n \\in \\{1,3,5\\}} \\sqrt{2} I_n \\sin(n\\omega_0 t + \\phi_n) \\right)^2 dt$$\n展开和的平方会产生两种类型的项：平方项和交叉乘积项。\n$$I_{rms}^2 = \\frac{1}{T} \\int_0^T \\left( \\sum_{n \\in \\{1,3,5\\}} 2 I_n^2 \\sin^2(n\\omega_0 t + \\phi_n) + \\sum_{\\substack{n, m \\in \\{1,3,5\\} \\\\ n \\neq m}} 2 I_n I_m \\sin(n\\omega_0 t + \\phi_n) \\sin(m\\omega_0 t + \\phi_m) \\right) dt$$\n问题要求使用不同正弦谐波的正交性。该原理指出，对于整数 $n \\neq m$：\n$$\\int_0^T \\sin(n\\omega_0 t + \\phi_n) \\sin(m\\omega_0 t + \\phi_m) dt = 0$$\n因此，所有交叉乘积项的积分为零，$I_{rms}^2$ 的表达式简化为：\n$$I_{rms}^2 = \\sum_{n \\in \\{1,3,5\\}} \\frac{1}{T} \\int_0^T 2 I_n^2 \\sin^2(n\\omega_0 t + \\phi_n) dt$$\n$\\sin^2(\\theta)$ 在一个完整周期内的平均值是 $\\frac{1}{2}$。积分 $\\frac{1}{T} \\int_0^T \\sin^2(n\\omega_0 t + \\phi_n) dt$ 是在谐波的整数个周期上进行的，所以其值为 $\\frac{1}{2}$。\n$$I_{rms}^2 = \\sum_{n \\in \\{1,3,5\\}} 2 I_n^2 \\left(\\frac{1}{2}\\right) = \\sum_{n \\in \\{1,3,5\\}} I_n^2$$\n这从基本原理上证明了，总电流有效值的平方是各个谐波分量有效值平方的和。\n\n给定的有效值大小为 $I_1 = 50 \\ \\mathrm{A}$、$I_3 = 10 \\ \\mathrm{A}$ 和 $I_5 = 5 \\ \\mathrm{A}$。总电流有效值为：\n$$I_{rms} = \\sqrt{I_1^2 + I_3^2 + I_5^2} = \\sqrt{50^2 + 10^2 + 5^2} = \\sqrt{2500 + 100 + 25} = \\sqrt{2625} \\ \\mathrm{A}$$\n\n首先，我们计算电流总谐波失真 $THD_I$。它定义为所有谐波分量（不包括基波）之和的有效值与基波分量有效值的比值。\n$$THD_I = \\frac{\\sqrt{\\sum_{n=2}^{\\infty} I_n^2}}{I_1}$$\n对于本题，这变为：\n$$THD_I = \\frac{\\sqrt{I_3^2 + I_5^2}}{I_1}$$\n代入给定值：\n$$THD_I = \\frac{\\sqrt{10^2 + 5^2}}{50} = \\frac{\\sqrt{100 + 25}}{50} = \\frac{\\sqrt{125}}{50} = \\frac{5\\sqrt{5}}{50} = \\frac{\\sqrt{5}}{10}$$\n数值为：\n$$THD_I \\approx 0.22360679...$$\n四舍五入到四位有效数字，我们得到 $THD_I = 0.2236$。\n\n接下来，我们计算失真因数（$DF$），它定义为基波分量有效值与总电流有效值的比值。\n$$DF = \\frac{I_1}{I_{rms}}$$\n使用 $I_1$ 的值和计算出的 $I_{rms}$：\n$$DF = \\frac{50}{\\sqrt{2625}} = \\frac{50}{\\sqrt{25 \\times 105}} = \\frac{50}{5\\sqrt{105}} = \\frac{10}{\\sqrt{105}}$$\n数值为：\n$$DF \\approx 0.97590007...$$\n四舍五入到四位有效数字，我们得到 $DF = 0.9759$。\n\n按指定顺序（$THD_I$，然后是失真因数）要求的两个值是 $0.2236$ 和 $0.9759$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.2236  0.9759\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "这个练习超越了简单的畸变度量，旨在探索谐波电流对基本功率分量的深远影响。您将为一个由纯正弦电压源供电但具有非正弦电流的负载计算有功功率、无功功率、视在功率和畸变功率。这项练习对于理解谐波如何产生畸变功率（$D$）并增大视在功率（$S$）至关重要，这对系统效率和设备选型具有重要意义。",
            "id": "3887714",
            "problem": "一个单相负载由一个无谐波畸变的理想正弦电压源供电。电压基波方均根值为 $V_1 = 230\\ \\mathrm{V}$。负载电流为非正弦波，但其基波分量明确，其幅值为 $I_1 = 10\\ \\mathrm{A}$，且基波电压与基波电流之间的位移角为 $\\phi = 30^\\circ$。电流的总谐波畸变 (THD) 为 $\\mathrm{THD}_I = 0.4$，其中总谐波畸变 (THD) 定义为所有谐波分量的方均根值与基波分量的比值。假设源电压不含谐波，并且所有不同阶次的谐波相量都是正交的。使用与电气和电子工程师协会 (IEEE) 标准功率术语一致的定义，从基本原理出发计算以下量值：\n- 有功功率 $P$，\n- 无功功率 $Q$，\n- 视在功率 $S$，\n- 以及畸变功率 $D$。\n\n从方均根值的定义、不同谐波的傅里叶正交性以及功率的时间平均定义开始，推导出适用于正弦电压和非正弦电流的表达式。角度以度为单位。\n\n将 $P$ 以 $\\mathrm{kW}$ 表示，$Q$ 以 $\\mathrm{kVAr}$ 表示，$S$ 以 $\\mathrm{kVA}$ 表示，$D$ 以 $\\mathrm{kVAd}$ 表示。将您的最终数值结果四舍五入到四位有效数字。",
            "solution": "对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n- 电源：理想正弦电压源，无谐波畸变。\n- 电压基波方均根幅值：$V_1 = 230\\ \\mathrm{V}$。\n- 电流：非正弦。\n- 电流基波方均根幅值：$I_1 = 10\\ \\mathrm{A}$。\n- 位移角：$\\phi = 30^\\circ$，这是基波电压和基波电流之间的夹角。我们将其记为 $\\phi_1$。因此，$\\phi_1 = 30^\\circ$。\n- 电流总谐波畸变：$\\mathrm{THD}_I = 0.4$。\n- THD 定义：所有谐波分量的方均根值与基波分量的比值。\n- 要求计算：有功功率 $P$、无功功率 $Q$、视在功率 $S$ 和畸变功率 $D$。\n- 要求方法：从基本原理出发，并与 IEEE 标准功率术语保持一致。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题根植于电气工程的基本原理，特别是非正弦条件下的电力系统分析领域。有功功率、无功功率、视在功率、畸变功率和总谐波畸变 (THD) 的概念是电能质量的标准度量。\n- **适定性**：该问题是适定的。它提供了所有必要的参数（$V_1$、$I_1$、$\\phi_1$、$\\mathrm{THD}_I$）和定义，以唯一确定所需的量（$P$、$Q$、$S$、$D$）。\n- **客观性**：问题以精确、客观和量化的方式陈述。\n- **一致性与完整性**：问题是自洽的，没有矛盾。理想正弦电压源为非线性负载供电的情景是电力电子学中使用的标准有效模型。\n\n**步骤 3：结论与行动**\n该问题被认为是**有效的**，因为其科学上合理、适定且明确。将提供解答。\n\n**解题推导**\n我们从时域中各量的定义开始。设瞬时电压为 $v(t)$，瞬时电流为 $i(t)$。由于电压源是理想的正弦波，其波形仅包含基波频率。我们可以将其写为：\n$$v(t) = \\sqrt{2} V_1 \\cos(\\omega t)$$\n其中 $V_1$ 是电压的方均根值，我们任意地将其相角设为 $0$。\n\n负载电流是非正弦的，可以用傅里叶级数表示：\n$$i(t) = \\sum_{h=1}^{\\infty} i_h(t) = \\sum_{h=1}^{\\infty} \\sqrt{2} I_h \\cos(h\\omega t - \\phi_h)$$\n其中 $I_h$ 是电流的第 $h$ 次谐波分量的方均根值，$\\phi_h$ 是其相对于基波电压相位的相角。问题给出的位移角 $\\phi = 30^\\circ$ 是基波分量的相位差，因此 $\\phi_1 = 30^\\circ$。\n\n**1. 有功功率 ($P$)**\n有功功率 $P$ 是瞬时功率 $p(t) = v(t)i(t)$ 在一个基波周期 $T = 2\\pi/\\omega$ 内的时间平均值。\n$$P = \\frac{1}{T} \\int_0^T v(t) i(t) \\,dt$$\n代入 $v(t)$ 和 $i(t)$ 的表达式：\n$$P = \\frac{1}{T} \\int_0^T \\left( \\sqrt{2} V_1 \\cos(\\omega t) \\right) \\left( \\sum_{h=1}^{\\infty} \\sqrt{2} I_h \\cos(h\\omega t - \\phi_h) \\right) \\,dt$$\n$$P = \\frac{2 V_1}{T} \\sum_{h=1}^{\\infty} I_h \\int_0^T \\cos(\\omega t) \\cos(h\\omega t - \\phi_h) \\,dt$$\n由于正弦函数的正交性，只有当频率相等时，即谐波次数 $h=1$ 时，积分才不为零。\n$$ \\int_0^T \\cos(\\omega t) \\cos(h\\omega t - \\phi_h) \\,dt = 0 \\quad \\text{for } h \\neq 1 $$\n因此，只有基波分量对有功功率有贡献。\n$$P = \\frac{2 V_1 I_1}{T} \\int_0^T \\cos(\\omega t) \\cos(\\omega t - \\phi_1) \\,dt$$\n使用积化和差恒等式 $\\cos(A)\\cos(B) = \\frac{1}{2}[\\cos(A-B) + \\cos(A+B)]$：\n$$P = \\frac{2 V_1 I_1}{T} \\int_0^T \\frac{1}{2}[\\cos(\\phi_1) + \\cos(2\\omega t - \\phi_1)] \\,dt$$\n$\\cos(2\\omega t - \\phi_1)$ 在一个周期内的积分为零。\n$$P = \\frac{V_1 I_1}{T} \\int_0^T \\cos(\\phi_1) \\,dt = \\frac{V_1 I_1 \\cos(\\phi_1)}{T} [t]_0^T = V_1 I_1 \\cos(\\phi_1)$$\n代入给定值：\n$$P = (230\\ \\mathrm{V})(10\\ \\mathrm{A}) \\cos(30^\\circ) = 2300 \\times \\frac{\\sqrt{3}}{2} = 1150\\sqrt{3}\\ \\mathrm{W}$$\n$$P \\approx 1991.858\\ \\mathrm{W}$$\n以千瓦表示并四舍五入到四位有效数字，$P = 1.992\\ \\mathrm{kW}$。\n\n**2. 无功功率 ($Q$)**\n根据 IEEE 标准定义，在存在谐波的情况下，总无功功率是各次谐波频率上无功功率的总和：\n$$Q = \\sum_{h=1}^{\\infty} Q_h = \\sum_{h=1}^{\\infty} V_h I_h \\sin(\\theta_{vh} - \\theta_{ih})$$\n这里，$\\theta_{vh}$ 和 $\\theta_{ih}$ 分别是第 $h$ 次电压和电流谐波的相角。相位差为 $\\phi_h = \\theta_{vh} - \\theta_{ih}$。由于电压是纯正弦波，$V_h = 0$ 对所有 $h > 1$ 成立。因此，只有基波分量对无功功率有贡献。\n$$Q = V_1 I_1 \\sin(\\phi_1)$$\n代入给定值：\n$$Q = (230\\ \\mathrm{V})(10\\ \\mathrm{A}) \\sin(30^\\circ) = 2300 \\times \\frac{1}{2} = 1150\\ \\mathrm{VAr}$$\n以千乏表示并四舍五入到四位有效数字，$Q = 1.150\\ \\mathrm{kVAr}$。\n\n**3. 视在功率 ($S$)**\n视在功率 $S$ 定义为总方均根电压 $V_{rms}$ 与总方均根电流 $I_{rms}$ 的乘积。\n$$S = V_{rms} I_{rms}$$\n由于不存在电压谐波，总方均根电压就是 $V_1$：\n$$V_{rms} = \\sqrt{\\sum_{h=1}^{\\infty} V_h^2} = \\sqrt{V_1^2 + 0^2 + \\dots} = V_1 = 230\\ \\mathrm{V}$$\n总方均根电流是其所有谐波分量方均根值平方和的平方根：\n$$I_{rms} = \\sqrt{\\sum_{h=1}^{\\infty} I_h^2} = \\sqrt{I_1^2 + I_2^2 + I_3^2 + \\dots}$$\n电流的总谐波畸变 $\\mathrm{THD}_I$ 定义为谐波分量的方均根值与基波分量的方均根值的比值。设 $I_H$ 为所有谐波电流（$h \\ge 2$）的方均根值：\n$$I_H = \\sqrt{\\sum_{h=2}^{\\infty} I_h^2}$$\n那么，$\\mathrm{THD}_I$ 的定义是：\n$$\\mathrm{THD}_I = \\frac{I_H}{I_1}$$\n我们可以用 $I_1$ 和 $\\mathrm{THD}_I$ 来表示 $I_{rms}$：\n$$I_{rms}^2 = I_1^2 + \\sum_{h=2}^{\\infty} I_h^2 = I_1^2 + I_H^2 = I_1^2 + (I_1 \\cdot \\mathrm{THD}_I)^2 = I_1^2 (1 + \\mathrm{THD}_I^2)$$\n$$I_{rms} = I_1 \\sqrt{1 + \\mathrm{THD}_I^2}$$\n代入 $I_1$ 和 $\\mathrm{THD}_I$ 的给定值：\n$$I_{rms} = (10\\ \\mathrm{A}) \\sqrt{1 + (0.4)^2} = 10 \\sqrt{1.16}\\ \\mathrm{A} \\approx 10.77033\\ \\mathrm{A}$$\n现在，我们可以计算视在功率 $S$：\n$$S = V_1 I_{rms} = (230\\ \\mathrm{V}) \\times (10 \\sqrt{1.16}\\ \\mathrm{A}) = 2300 \\sqrt{1.16}\\ \\mathrm{VA}$$\n$$S \\approx 2477.1758\\ \\mathrm{VA}$$\n以千伏安表示并四舍五入到四位有效数字，$S = 2.477\\ \\mathrm{kVA}$。\n\n**4. 畸变功率 ($D$)**\n视在功率 $S$、有功功率 $P$、无功功率 $Q$ 和畸变功率 $D$ 之间的关系由功率四面体概念给出：\n$$S^2 = P^2 + Q^2 + D^2$$\n这使我们能够求解畸变功率 $D$：\n$$D = \\sqrt{S^2 - P^2 - Q^2}$$\n我们也可以认识到基波视在功率 $S_1$ 与 $P$ 和 $Q$ 的关系为 $S_1^2 = P_1^2 + Q_1^2$。由于电压是正弦的，$P=P_1$ 且 $Q=Q_1$，所以 $S_1^2 = P^2 + Q^2 = (V_1 I_1)^2 (\\cos^2\\phi_1 + \\sin^2\\phi_1) = (V_1 I_1)^2$。\n让我们代入推导出的 $S$、$P$ 和 $Q$ 的表达式：\n$$D^2 = S^2 - (P^2 + Q^2) = (V_{rms} I_{rms})^2 - (V_1 I_1 \\cos\\phi_1)^2 - (V_1 I_1 \\sin\\phi_1)^2$$\n$$D^2 = (V_1 I_{rms})^2 - (V_1 I_1)^2 (\\cos^2\\phi_1 + \\sin^2\\phi_1)$$\n$$D^2 = V_1^2 I_{rms}^2 - V_1^2 I_1^2 = V_1^2 (I_{rms}^2 - I_1^2)$$\n从 $I_{rms}$ 的推导中，我们有 $I_{rms}^2 = I_1^2 + I_H^2$。因此，$I_{rms}^2 - I_1^2 = I_H^2$。\n$$D^2 = V_1^2 I_H^2 \\implies D = V_1 I_H$$\n使用 $I_H = I_1 \\cdot \\mathrm{THD}_I$：\n$$D = V_1 (I_1 \\cdot \\mathrm{THD}_I)$$\n这个表达式表明畸变功率产生于基波电压与谐波电流的相互作用。\n代入给定值：\n$$D = (230\\ \\mathrm{V}) \\times (10\\ \\mathrm{A} \\times 0.4) = 230 \\times 4 = 920\\ \\mathrm{VAd}$$\n以千伏安畸变表示并四舍五入到四位有效数字，$D = 0.9200\\ \\mathrm{kVAd}$。\n\n**结果总结：**\n- 有功功率, $P = 1.992\\ \\mathrm{kW}$\n- 无功功率, $Q = 1.150\\ \\mathrm{kVAr}$\n- 视在功率, $S = 2.477\\ \\mathrm{kVA}$\n- 畸变功率, $D = 0.9200\\ \\mathrm{kVAd}$\n\n这些值将按要求的顺序以矩阵形式呈现在最终答案中。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.992  1.150  2.477  0.9200\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "最后的这项实践将分析提升到系统层面，解决配电网络中的一个常见场景。通过编写程序来模拟谐波在馈线上的传播，您将计算一个中间点的电压总谐波失真，从而展示系统阻抗如何与注入的谐波电流相互作用。这个计算练习将理论概念与实际的电力系统工程联系起来，帮助您深入理解为什么管理谐波畸变对于维持整个网络的电压质量至关重要。",
            "id": "3887669",
            "problem": "给定一个单相辐射式馈线，其模型为一系列串联的、具有频率相关阻抗的线段，并在上游端连接一个理想的正弦电源。下游端的终端用户注入谐波电流。目标是计算馈线上指定母线位置的母线电压总谐波失真 (THD)。计算必须基于基尔霍夫定律、欧姆定律和傅里叶级数定义等基本原理，并且必须将每个谐波视为线性网络中的稳态相量。\n\n假设以下物理和建模前提：\n- 电源是一个理想的正弦电压源，其基波有效值 (RMS) 大小为 $V_{s1}$，相位为零，并串联一个频率相关的电源阻抗。\n- 馈线由 $N$ 个串联线段组成。线段 $i$ 的电阻为 $R_i$（单位 $\\Omega$），电感为 $L_i$（单位 $\\text{H}$）。在角频率 $\\omega$ 下，每个线段的串联阻抗为 $Z_i(\\omega) = R_i + j \\omega L_i$。\n- 在角频率 $\\omega$ 下，电源阻抗为 $Z_s(\\omega) = R_s + j \\omega L_s$，其中 $R_s$ 单位为 $\\Omega$，$L_s$ 单位为 $\\text{H}$。\n- 终端用户注入一组以整数谐波次数 $h \\in \\mathcal{H}$ 为特征的谐波电流；每个谐波电流由一个有效值大小 $|I_h|$（单位 $\\text{A}$）和相位 $\\angle I_h$（单位弧度）给出。用户汲取的基波电流由有效值大小 $|I_1|$（单位 $\\text{A}$）和相位 $\\angle I_1$（单位弧度）给出。角度必须以弧度为单位进行解释。\n- 基波线路频率为 $f_0$（单位 $\\text{Hz}$），因此基波角频率为 $\\omega_0 = 2 \\pi f_0$，第 $h$ 次谐波的角频率为 $\\omega_h = h \\, \\omega_0$。\n- 目标母线位于索引为 $k \\in \\{0,1,\\dots,N\\}$ 的位置，从电源端开始计数，其中 $k=0$ 表示紧邻电源端子（所有线段的上游）的母线，$k=N$ 表示下游端（所有线段之后）的母线。从电源到该母线的上游路径包括电源阻抗和前 $k$ 个线段，从该母线到用户的下游路径包括剩余的 $N-k$ 个线段。\n\n基于这些前提和基本定律（基尔霍夫电压定律、欧姆定律以及傅里叶级数/相量定义），推导出基波下的母线电压相量，推导由注入的谐波电流引起的母线非基波谐波电压相量，并由此获得母线电压的总谐波失真。THD 以纯小数（而非百分比）表示，使用有效值大小，角度单位为弧度。\n\n您的程序必须使用以下步骤为每个测试用例实现计算：\n1. 对于每个角频率 $\\omega$，构建从母线看去的上游等效串联阻抗：\n   $$Z_{\\text{up}}(\\omega) = Z_s(\\omega) + \\sum_{i=0}^{k-1} Z_i(\\omega)。$$\n2. 构建基波电源电压的复相量：$V_{s1}\\angle 0$。计算基波母线电压相量：\n   $$V_1 = V_{s1}\\angle 0 - I_1 \\, Z_{\\text{up}}(\\omega_0),$$\n   其中 $I_1 = |I_1| \\, e^{j \\angle I_1}$。\n3. 对于每个注入的谐波 $h \\in \\mathcal{H}$，计算母线谐波电压相量：\n   $$V_h = - I_h \\, Z_{\\text{up}}(\\omega_h),$$\n   其中 $I_h = |I_h| \\, e^{j \\angle I_h}$。\n4. 使用 $h \\ge 2$ 的 $V_h$ 的有效值大小和 $V_1$ 的有效值大小，计算母线电压的总谐波失真 (THD)。\n\n所有物理量必须明确使用所述单位，角度必须以弧度处理。每个测试用例的最终 THD 必须报告为浮点值。\n\n测试套件：\n实现您的程序，为以下四个测试用例计算 THD。在每个用例中，所有阻抗都是串联元件，所有大小都是有效值，所有角度都以弧度为单位。\n\n- 用例 A（中等上游阻抗，中压馈线）：\n  - $f_0 = 50\\,\\text{Hz}$，$V_{s1} = 11000\\,\\text{V}$。\n  - 电源阻抗：$R_s = 0.1\\,\\Omega$，$L_s = 0.0005\\,\\text{H}$。\n  - 线段（$N=4$）：\n    - 线段 0：$R_0 = 0.2\\,\\Omega$，$L_0 = 0.0015\\,\\text{H}$。\n    - 线段 1：$R_1 = 0.3\\,\\Omega$，$L_1 = 0.0020\\,\\text{H}$。\n    - 线段 2：$R_2 = 0.25\\,\\Omega$，$L_2 = 0.0010\\,\\text{H}$。\n    - 线段 3：$R_3 = 0.35\\,\\Omega$，$L_3 = 0.0025\\,\\text{H}$。\n  - 母线索引：$k=2$。\n  - 基波电流：$|I_1| = 100\\,\\text{A}$，$\\angle I_1 = -0.174532925\\,\\text{rad}$。\n  - 谐波注入：\n    - $h=5$：$|I_5| = 20\\,\\text{A}$，$\\angle I_5 = -0.523598776\\,\\text{rad}$。\n    - $h=7$：$|I_7| = 15\\,\\text{A}$，$\\angle I_7 = 0.785398163\\,\\text{rad}$。\n    - $h=11$：$|I_{11}| = 8\\,\\text{A}$，$\\angle I_{11} = 0.0\\,\\text{rad}$。\n\n- 用例 B（低压刚性电源，母线位于电源端）：\n  - $f_0 = 60\\,\\text{Hz}$，$V_{s1} = 400\\,\\text{V}$。\n  - 电源阻抗：$R_s = 0.01\\,\\Omega$，$L_s = 0.0001\\,\\text{H}$。\n  - 线段（$N=3$）：\n    - 线段 0：$R_0 = 0.05\\,\\Omega$，$L_0 = 0.0003\\,\\text{H}$。\n    - 线段 1：$R_1 = 0.06\\,\\Omega$，$L_1 = 0.0004\\,\\text{H}$。\n    - 线段 2：$R_2 = 0.04\\,\\Omega$，$L_2 = 0.0002\\,\\text{H}$。\n  - 母线索引：$k=0$。\n  - 基波电流：$|I_1| = 200\\,\\text{A}$，$\\angle I_1 = 0.0\\,\\text{rad}$。\n  - 谐波注入：\n    - $h=3$：$|I_3| = 30\\,\\text{A}$，$\\angle I_3 = -0.261799388\\,\\text{rad}$。\n    - $h=5$：$|I_5| = 50\\,\\text{A}$，$\\angle I_5 = 0.34906585\\,\\text{rad}$。\n\n- 用例 C（大上游阻抗，更强失真）：\n  - $f_0 = 50\\,\\text{Hz}$，$V_{s1} = 400\\,\\text{V}$。\n  - 电源阻抗：$R_s = 0.5\\,\\Omega$，$L_s = 0.005\\,\\text{H}$。\n  - 线段（$N=2$）：\n    - 线段 0：$R_0 = 0.8\\,\\Omega$，$L_0 = 0.004\\,\\text{H}$。\n    - 线段 1：$R_1 = 0.4\\,\\Omega$，$L_1 = 0.002\\,\\text{H}$。\n  - 母线索引：$k=1$。\n  - 基波电流：$|I_1| = 150\\,\\text{A}$，$\\angle I_1 = -0.087266463\\,\\text{rad}$。\n  - 谐波注入：\n    - $h=3$：$|I_3| = 25\\,\\text{A}$，$\\angle I_3 = 0.0\\,\\text{rad}$。\n    - $h=5$：$|I_5| = 40\\,\\text{A}$，$\\angle I_5 = 0.261799388\\,\\text{rad}$。\n    - $h=7$：$|I_7| = 35\\,\\text{A}$，$\\angle I_7 = -0.34906585\\,\\text{rad}$。\n\n- 用例 D（无谐波注入，基线THD）：\n  - $f_0 = 50\\,\\text{Hz}$，$V_{s1} = 690\\,\\text{V}$。\n  - 电源阻抗：$R_s = 0.2\\,\\Omega$，$L_s = 0.001\\,\\text{H}$。\n  - 线段（$N=2$）：\n    - 线段 0：$R_0 = 0.1\\,\\Omega$，$L_0 = 0.001\\,\\text{H}$。\n    - 线段 1：$R_1 = 0.2\\,\\Omega$，$L_1 = 0.002\\,\\text{H}$。\n  - 母线索引：$k=2$。\n  - 基波电流：$|I_1| = 100\\,\\text{A}$，$\\angle I_1 = 0.174532925\\,\\text{rad}$。\n  - 谐波注入：无（即 $\\mathcal{H}$ 为空）。\n\n最终输出格式：\n您的程序应生成一行输出，其中包含四个用例的 THD 结果，格式为方括号内以逗号分隔的列表，顺序为 [用例A, 用例B, 用例C, 用例D]，例如“[resultA,resultB,resultC,resultD]”。每个元素必须是一个浮点值，表示与上述定义一致的、无单位的十进制 THD。",
            "solution": "所呈现的问题是在单相电馈线中分析谐波失真的一个恰当定义的练习，这是电力电子学和电力系统工程领域的一个基本课题。在进行求解之前，必须进行严格的验证，以确保问题的科学合理性和逻辑一致性。\n\n### 问题验证\n\n**第1步：提取已知条件**\n\n- **系统模型**：一个单相辐射式馈线，包含一个上游理想正弦电压源、一个串联电源阻抗 $Z_s(\\omega)$、$N$ 个串联馈线线段阻抗 $Z_i(\\omega)$ 以及一个下游用户。\n- **电源**：基波有效值电压为 $V_{s1}$，角度为 $0$。电源阻抗为 $Z_s(\\omega) = R_s + j \\omega L_s$。\n- **馈线线段**：线段 $i$ 的阻抗为 $Z_i(\\omega) = R_i + j \\omega L_i$。\n- **用户**：汲取基波电流 $I_1 = |I_1| e^{j \\angle I_1}$ 并注入谐波电流 $I_h = |I_h| e^{j \\angle I_h}$，其中谐波次数 $h \\in \\mathcal{H}$。\n- **频率**：基波频率 $f_0$，基波角频率 $\\omega_0 = 2 \\pi f_0$，谐波角频率 $\\omega_h = h \\omega_0$。\n- **目标母线**：位于索引 $k \\in \\{0, 1, ..., N\\}$ 的一个中间母线。\n- **要求公式**：\n    1. 上游阻抗：$Z_{\\text{up}}(\\omega) = Z_s(\\omega) + \\sum_{i=0}^{k-1} Z_i(\\omega)$。\n    2. 基波母线电压：$V_1 = V_{s1}\\angle 0 - I_1 \\, Z_{\\text{up}}(\\omega_0)$。\n    3. 谐波母线电压：$V_h = - I_h \\, Z_{\\text{up}}(\\omega_h)$。\n    4. 总谐波失真 (THD)：$\\text{THD} = \\frac{\\sqrt{\\sum_{h \\in \\mathcal{H}, h\\ge 2} |V_h|^2}}{|V_1|}$。\n- **测试数据**：提供了四个具体用例（A, B, C, D），包含上述参数的所有必要数值。\n\n**第2步：已知条件验证**\n\n该问题在科学上基于线性电路理论和傅里叶分析的原理，特别是叠加原理、欧姆定律和基尔霍夫定律在交流电路频域分析（相量分析）中的应用。该模型是电力系统研究中使用的标准简化模型。测试用例中提供的参数在物理上是现实的。\n\n一个需要严格审查的点是用于电压计算的两个公式。问题区分了基波电流被“汲取”和和谐波电流被“注入”。让我们使用叠加原理来分析这一点。\n\n1.  **基波分量 ($h=1$)**：系统有一个有源电源 $V_{s1}$。负载通过总串联阻抗汲取电流 $I_1$。从电源到母线 $k$ 应用基尔霍夫电压定律 (KVL)，母线处的电压 $V_1$ 是电源电压减去由电流 $I_1$ 在上游阻抗 $Z_{\\text{up}}(\\omega_0)$ 上产生的电压降。这得出 $V_1 = V_{s1}\\angle 0 - I_1 Z_{\\text{up}}(\\omega_0)$，与所给公式相符。\n\n2.  **谐波分量 ($h \\in \\mathcal{H}$)**：对于谐波频率，理想电压源是短路，因此其电压为 $0\\,\\text{V}$。负载充当谐波电流的源。短语“注入谐波电流”可以解释为负载充当一个将电流推入馈线的电流源。然而，在电能质量研究中，更标准的模型是将非线性负载视为从电网汲取非正弦电流。这个总电流可以分解为其基波和谐波分量，所有这些分量都是从电网*汲取*的。如果我们采纳这种解释，即 $I_h$ 是从电网*汲取*的第 $h$ 次谐波电流分量的相量，那么根据 KVL，母线 $k$ 处的谐波电压为 $V_h = (\\text{谐波源电压}) - (\\text{电压降}) = 0 - I_h Z_{\\text{up}}(\\omega_h) = -I_h Z_{\\text{up}}(\\omega_h)$。这个推导与所给公式相符。\n\n术语“注入”的潜在歧义通过与术语“汲取”的结合使用得到解决，这表明了负载在产生谐波方面的主动作用和其在基波频率下的被动作用之间的区别。更重要的是，问题明确规定使用给定的公式。这消除了所需计算中的任何歧义，使得在 $I_h$ 代表负载汲取的谐波电流的解释下，问题是恰当定义且内部一致的。\n\n问题的所有其他方面（完整性、客观性、可行性）都是合理的。\n\n**第3步：结论与行动**\n\n问题被判定为**有效**。这些公式与非线性负载产生谐波的标准物理模型一致，并且问题定义清晰，计算上是可行的。将提供一个解决方案。\n\n### 解题推导\n\n该解决方案要求计算指定母线 $k$ 处电压的总谐波失真 (THD)。这是通过对线性馈线网络应用叠加原理来实现的。每个频率分量（基波和谐波）被分开分析，然后将结果组合起来计算 THD。\n\n**1. 上游阻抗计算**\n从理想电源到目标母线（母线 $k$）的路径包括电源阻抗 $Z_s(\\omega)$ 和前 $k$ 个馈线线段的阻抗，即 $Z_0(\\omega)$ 到 $Z_{k-1}(\\omega)$。总上游阻抗 $Z_{\\text{up}}(\\omega)$ 是这些元件的串联组合。\n设 $R_{\\text{up}} = R_s + \\sum_{i=0}^{k-1} R_i$ 和 $L_{\\text{up}} = L_s + \\sum_{i=0}^{k-1} L_i$。\n则频率相关的上游阻抗由下式给出：\n$$Z_{\\text{up}}(\\omega) = R_{\\text{up}} + j\\omega L_{\\text{up}}$$\n对于 $k=0$ 的特殊情况，求和是针对一个空集，因此 $R_{\\text{up}} = R_s$ 且 $L_{\\text{up}} = L_s$。\n\n**2. 基波母线电压 ($V_1$)**\n在基波频率 $\\omega_0 = 2 \\pi f_0$ 下，电路由电源电压 $V_{s1}\\angle 0$ 驱动。用户汲取基波电流 $I_1$。母线 $k$ 处的电压，用相量 $V_1$ 表示，是电源电压减去上游阻抗 $Z_{\\text{up}}(\\omega_0)$ 上的电压降。\n$$V_1 = (V_{s1} + j0) - I_1 Z_{\\text{up}}(\\omega_0)$$\n其中 $I_1$ 是复相量 $|I_1| e^{j \\angle I_1}$，$Z_{\\text{up}}(\\omega_0) = R_{\\text{up}} + j\\omega_0 L_{\\text{up}}$。计算 THD 需要其大小 $|V_1|$。\n\n**3. 谐波母线电压 ($V_h$)**\n对于每个谐波次数 $h \\in \\mathcal{H}$，我们在频率 $\\omega_h = h \\omega_0$ 下分析电路。在这些频率下，理想基波电压源是不活动的（短路）。系统由负载汲取的谐波电流 $I_h$ 驱动。该电流在母线 $k$ 处产生的电压是它在上游阻抗上引起的电压降。\n如验证中所述，母线 $k$ 处的电压相量 $V_h$ 为：\n$$V_h = -I_h Z_{\\text{up}}(\\omega_h)$$\n其中 $I_h = |I_h| e^{j \\angle I_h}$ 且 $Z_{\\text{up}}(\\omega_h) = R_{\\text{up}} + j\\omega_h L_{\\text{up}}$。对于集合 $\\mathcal{H}$ 中的每个谐波，必须重复此计算。\n\n**4. 总谐波失真 (THD) 计算**\n电压波形的总谐波失真定义为其谐波分量之和的均方根 (RMS) 值与其基波分量的均方根值之比。\n$$\\text{THD}_V = \\frac{\\sqrt{\\sum_{h=2}^{\\infty} |V_h|^2}}{|V_1|}$$\n在此问题中，求和是针对指定的谐波集合 $\\mathcal{H}$ 进行的。\n$$\\text{THD} = \\frac{\\sqrt{\\sum_{h \\in \\mathcal{H}} |V_h|^2}}{|V_1|}$$\n如果集合 $\\mathcal{H}$ 为空（无谐波注入），则分子为零，因此 THD 为零。\n\n实现将系统地将这四个步骤应用于提供的每个测试用例。数值计算将使用复数运算执行。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the Total Harmonic Distortion (THD) for a series of test cases\n    based on the provided power system feeder model and harmonic analysis formulas.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"f0\": 50.0, \"Vs1\": 11000.0,\n            \"source_z\": {\"R\": 0.1, \"L\": 0.0005},\n            \"segments\": [\n                {\"R\": 0.2, \"L\": 0.0015},\n                {\"R\": 0.3, \"L\": 0.0020},\n                {\"R\": 0.25, \"L\": 0.0010},\n                {\"R\": 0.35, \"L\": 0.0025},\n            ],\n            \"k\": 2,\n            \"I1\": (100.0, -0.174532925),\n            \"harmonics\": [\n                {\"h\": 5, \"I\": (20.0, -0.523598776)},\n                {\"h\": 7, \"I\": (15.0, 0.785398163)},\n                {\"h\": 11, \"I\": (8.0, 0.0)},\n            ],\n        },\n        # Case B\n        {\n            \"f0\": 60.0, \"Vs1\": 400.0,\n            \"source_z\": {\"R\": 0.01, \"L\": 0.0001},\n            \"segments\": [\n                {\"R\": 0.05, \"L\": 0.0003},\n                {\"R\": 0.06, \"L\": 0.0004},\n                {\"R\": 0.04, \"L\": 0.0002},\n            ],\n            \"k\": 0,\n            \"I1\": (200.0, 0.0),\n            \"harmonics\": [\n                {\"h\": 3, \"I\": (30.0, -0.261799388)},\n                {\"h\": 5, \"I\": (50.0, 0.34906585)},\n            ],\n        },\n        # Case C\n        {\n            \"f0\": 50.0, \"Vs1\": 400.0,\n            \"source_z\": {\"R\": 0.5, \"L\": 0.005},\n            \"segments\": [\n                {\"R\": 0.8, \"L\": 0.004},\n                {\"R\": 0.4, \"L\": 0.002},\n            ],\n            \"k\": 1,\n            \"I1\": (150.0, -0.087266463),\n            \"harmonics\": [\n                {\"h\": 3, \"I\": (25.0, 0.0)},\n                {\"h\": 5, \"I\": (40.0, 0.261799388)},\n                {\"h\": 7, \"I\": (35.0, -0.34906585)},\n            ],\n        },\n        # Case D\n        {\n            \"f0\": 50.0, \"Vs1\": 690.0,\n            \"source_z\": {\"R\": 0.2, \"L\": 0.001},\n            \"segments\": [\n                {\"R\": 0.1, \"L\": 0.001},\n                {\"R\": 0.2, \"L\": 0.002},\n            ],\n            \"k\": 2,\n            \"I1\": (100.0, 0.174532925),\n            \"harmonics\": [],\n        },\n    ]\n\n    def compute_thd(case_params):\n        \"\"\"\n        Computes the THD for a single case.\n        \"\"\"\n        f0 = case_params[\"f0\"]\n        Vs1 = case_params[\"Vs1\"]\n        k = case_params[\"k\"]\n        w0 = 2 * np.pi * f0\n\n        # Step 1: Construct the upstream equivalent series impedance\n        R_up = case_params[\"source_z\"][\"R\"]\n        L_up = case_params[\"source_z\"][\"L\"]\n        for i in range(k):\n            R_up += case_params[\"segments\"][i][\"R\"]\n            L_up += case_params[\"segments\"][i][\"L\"]\n\n        # Step 2: Compute the fundamental bus voltage phasor\n        w1 = w0\n        Z_up_w1 = R_up + 1j * w1 * L_up\n        I1_mag, I1_ang = case_params[\"I1\"]\n        I1_phasor = I1_mag * np.exp(1j * I1_ang)\n        V1_phasor = Vs1 - I1_phasor * Z_up_w1\n        V1_mag = np.abs(V1_phasor)\n        \n        if V1_mag == 0:\n            return float('inf')\n\n        # Step 3: For each injected harmonic, compute the bus harmonic voltage phasor\n        sum_sq_Vh = 0.0\n        for harm in case_params[\"harmonics\"]:\n            h = harm[\"h\"]\n            Ih_mag, Ih_ang = harm[\"I\"]\n            wh = h * w0\n            \n            Z_up_wh = R_up + 1j * wh * L_up\n            Ih_phasor = Ih_mag * np.exp(1j * Ih_ang)\n            \n            Vh_phasor = -Ih_phasor * Z_up_wh\n            sum_sq_Vh += np.abs(Vh_phasor)**2\n\n        # Step 4: Compute the Total Harmonic Distortion (THD)\n        thd = np.sqrt(sum_sq_Vh) / V1_mag\n        return thd\n\n    results = [compute_thd(case) for case in test_cases]\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}