{
    "hands_on_practices": [
        {
            "introduction": "State-space averaging and the averaged switch model are two cornerstone techniques for deriving the small-signal behavior of DC-DC converters. While one is a formal, matrix-based approach and the other is a more intuitive circuit-oriented method, they are built on the same fundamental averaging principle. This exercise guides you through deriving a transfer function using both methods to prove their equivalence, providing you with both the confidence and the flexibility to choose the most convenient tool for future analysis. ",
            "id": "3880509",
            "problem": "Consider an ideal continuous-conduction-mode boost converter with input voltage $V_g$, duty ratio $D \\in (0,1)$, inductor $L$, output capacitor $C$, and resistive load $R$. Assume ideal semiconductor devices (zero voltage drop, zero resistance), a high switching frequency such that averaging over one switching period is valid, and a constant input voltage $V_g$. Let the output voltage be $v_o(t)$ and the inductor current be $i_L(t)$. Use Kirchhoff's Voltage Law (KVL), Kirchhoff's Current Law (KCL), the definition of duty ratio, and first-order perturbation/small-signal linearization about the steady state as the fundamental base.\n\nTasks:\n- Using State-Space Averaging (SSA), derive the small-signal duty-to-output transfer function $G_{vd,\\mathrm{SSA}}(s) = \\hat{v}_o(s)/\\hat{d}(s)$, where $\\hat{v}_o$ and $\\hat{d}$ denote small-signal perturbations of $v_o$ and $D$, respectively.\n- Using the averaged Pulse-Width Modulation (PWM) switch modeling approach, derive the small-signal duty-to-output transfer function $G_{vd,\\mathrm{SW}}(s) = \\hat{v}_o(s)/\\hat{d}(s)$ for the same converter and operating point.\n- Compute the difference $\\Delta(s) = G_{vd,\\mathrm{SSA}}(s) - G_{vd,\\mathrm{SW}}(s)$ in closed form and simplify fully. Provide a brief explanation, grounded in modeling assumptions, of any discrepancy you find.\n\nExpress your final answer as a single simplified analytic expression in terms of $s$, $V_g$, $R$, $L$, $C$, and $D$. No numerical evaluation is required.",
            "solution": "### Part 1: Derivation using State-Space Averaging (SSA)\n\nWe model the ideal boost converter operating in Continuous Conduction Mode (CCM). The state variables are the inductor current $i_L(t)$ and the output capacitor voltage $v_o(t)$. The state vector is $x(t) = \\begin{pmatrix} i_L(t) \\\\ v_o(t) \\end{pmatrix}$. The input is the source voltage $u(t) = V_g$.\n\nThe system has two states corresponding to the switch position.\n\n**State 1: Switch is ON (interval $d T_s$)**\nThe inductor is connected to the input voltage $V_g$, and the diode is reverse-biased. The capacitor discharges into the load $R$.\nThe state equations are:\n$$\nL \\frac{di_L}{dt} = V_g\n$$\n$$\nC \\frac{dv_o}{dt} = -\\frac{v_o}{R}\n$$\nIn matrix form, $\\dot{x} = A_1 x + B_1 u$:\n$$\n\\begin{pmatrix} \\dot{i}_L \\\\ \\dot{v}_o \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  -\\frac{1}{RC} \\end{pmatrix} \\begin{pmatrix} i_L \\\\ v_o \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{L} \\\\ 0 \\end{pmatrix} V_g\n$$\n\n**State 2: Switch is OFF (interval $(1-d) T_s$)**\nThe inductor current flows through the diode to the output.\nThe state equations are:\n$$\nL \\frac{di_L}{dt} = V_g - v_o\n$$\n$$\nC \\frac{dv_o}{dt} = i_L - \\frac{v_o}{R}\n$$\nIn matrix form, $\\dot{x} = A_2 x + B_2 u$:\n$$\n\\begin{pmatrix} \\dot{i}_L \\\\ \\dot{v}_o \\end{pmatrix} = \\begin{pmatrix} 0  -\\frac{1}{L} \\\\ \\frac{1}{C}  -\\frac{1}{RC} \\end{pmatrix} \\begin{pmatrix} i_L \\\\ v_o \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{L} \\\\ 0 \\end{pmatrix} V_g\n$$\nWe note that $B_1 = B_2 = B = \\begin{pmatrix} 1/L \\\\ 0 \\end{pmatrix}$.\n\n**Averaging and Steady-State (DC) Analysis**\nThe averaged state-space model is $\\dot{x} = (D A_1 + (1-D) A_2) x + (D B_1 + (1-D) B_2) u$.\nThe averaged system matrix $A$ is:\n$$\nA = D A_1 + (1-D) A_2 = D \\begin{pmatrix} 0  0 \\\\ 0  -\\frac{1}{RC} \\end{pmatrix} + (1-D) \\begin{pmatrix} 0  -\\frac{1}{L} \\\\ \\frac{1}{C}  -\\frac{1}{RC} \\end{pmatrix} = \\begin{pmatrix} 0  -\\frac{1-D}{L} \\\\ \\frac{1-D}{C}  -\\frac{1}{RC} \\end{pmatrix}\n$$\nThe averaged input matrix is $B$. The averaged model is $\\dot{x} = A x + B u$.\nAt steady state, $\\dot{x}=0$, $x=X=\\begin{pmatrix} I_L \\\\ V_o \\end{pmatrix}$, $u=U=V_g$.\n$$\n0 = A X + B U \\implies -A X = B U\n$$\n$$\n\\begin{pmatrix} 0  \\frac{1-D}{L} \\\\ -\\frac{1-D}{C}  \\frac{1}{RC} \\end{pmatrix} \\begin{pmatrix} I_L \\\\ V_o \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{L} \\\\ 0 \\end{pmatrix} V_g\n$$\nFrom the first row: $\\frac{1-D}{L} V_o = \\frac{V_g}{L} \\implies V_o = \\frac{V_g}{1-D}$.\nFrom the second row: $-\\frac{1-D}{C} I_L + \\frac{V_o}{RC} = 0 \\implies I_L = \\frac{V_o}{(1-D)R} = \\frac{V_g}{(1-D)^2 R}$.\n\n**Small-Signal AC Modeling**\nWe linearize the model by introducing small perturbations: $x(t)=X+\\hat{x}(t)$, $d(t)=D+\\hat{d}(t)$, and $u(t)=U+\\hat{u}(t)$. Given $V_g$ is constant, $\\hat{u}(t)=0$. The linearized state equation is:\n$$\n\\dot{\\hat{x}} = A \\hat{x} + [(A_1 - A_2)X + (B_1 - B_2)U] \\hat{d}\n$$\nSince $B_1 = B_2$, the term $(B_1 - B_2)U$ is zero. We compute $A_1 - A_2$:\n$$\nA_1 - A_2 = \\begin{pmatrix} 0  0 \\\\ 0  -\\frac{1}{RC} \\end{pmatrix} - \\begin{pmatrix} 0  -\\frac{1}{L} \\\\ \\frac{1}{C}  -\\frac{1}{RC} \\end{pmatrix} = \\begin{pmatrix} 0  \\frac{1}{L} \\\\ -\\frac{1}{C}  0 \\end{pmatrix}\n$$\nThe perturbation input matrix is $(A_1 - A_2)X$:\n$$\n(A_1 - A_2)X = \\begin{pmatrix} 0  \\frac{1}{L} \\\\ -\\frac{1}{C}  0 \\end{pmatrix} \\begin{pmatrix} I_L \\\\ V_o \\end{pmatrix} = \\begin{pmatrix} \\frac{V_o}{L} \\\\ -\\frac{I_L}{C} \\end{pmatrix}\n$$\nThe small-signal model is $\\dot{\\hat{x}} = A \\hat{x} + \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix} \\hat{d}$. Taking the Laplace transform:\n$$\ns\\hat{x}(s) = A\\hat{x}(s) + \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix} \\hat{d}(s) \\implies \\hat{x}(s) = (sI-A)^{-1} \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix} \\hat{d}(s)\n$$\nWe need the output $\\hat{v}_o(s)$, which is the second component of $\\hat{x}(s)$. The output equation is $\\hat{v}_o(s) = C_{out} \\hat{x}(s)$ with $C_{out} = \\begin{pmatrix} 0  1 \\end{pmatrix}$.\n$$\nG_{vd,\\mathrm{SSA}}(s) = \\frac{\\hat{v}_o(s)}{\\hat{d}(s)} = \\begin{pmatrix} 0  1 \\end{pmatrix} (sI-A)^{-1} \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix}\n$$\nThe inverse matrix is $(sI-A)^{-1} = \\frac{1}{\\det(sI-A)} \\operatorname{adj}(sI-A)$:\n$$\nsI-A = \\begin{pmatrix} s  \\frac{1-D}{L} \\\\ -\\frac{1-D}{C}  s+\\frac{1}{RC} \\end{pmatrix}\n$$\n$$\n\\det(sI-A) = s(s+\\frac{1}{RC}) + \\frac{(1-D)^2}{LC} = s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}\n$$\n$$\n\\operatorname{adj}(sI-A) = \\begin{pmatrix} s+\\frac{1}{RC}  -\\frac{1-D}{L} \\\\ \\frac{1-D}{C}  s \\end{pmatrix}\n$$\nSubstituting into the expression for $G_{vd,\\mathrm{SSA}}(s)$:\n$$\nG_{vd,\\mathrm{SSA}}(s) = \\frac{1}{\\det(sI-A)} \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} s+\\frac{1}{RC}  -\\frac{1-D}{L} \\\\ \\frac{1-D}{C}  s \\end{pmatrix} \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix}\n$$\n$$\nG_{vd,\\mathrm{SSA}}(s) = \\frac{1}{\\det(sI-A)} \\begin{pmatrix} \\frac{1-D}{C}  s \\end{pmatrix} \\begin{pmatrix} V_o/L \\\\ -I_L/C \\end{pmatrix} = \\frac{\\frac{(1-D)V_o}{LC} - \\frac{sI_L}{C}}{\\det(sI-A)}\n$$\nSubstitute the steady-state values $V_o = \\frac{V_g}{1-D}$ and $I_L = \\frac{V_g}{(1-D)^2 R}$:\n$$\n\\text{Numerator} = \\frac{(1-D)}{LC}\\frac{V_g}{1-D} - \\frac{s}{C}\\frac{V_g}{(1-D)^2 R} = \\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}\n$$\nThus, the transfer function is:\n$$\nG_{vd,\\mathrm{SSA}}(s) = \\frac{\\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}}{s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}}\n$$\n\n### Part 2: Derivation using Averaged PWM Switch Model\n\nThe PWM switch model replaces the transistor and diode with an equivalent circuit representing their averaged behavior. For a boost converter, the model gives the following relationships for the averaged quantities:\n$$\n\\langle v_{sw} \\rangle = (1-d(t)) v_o(t)\n$$\n$$\n\\langle i_{d} \\rangle = (1-d(t)) i_L(t)\n$$\nwhere $\\langle v_{sw} \\rangle$ is the average voltage at the switching node (the common node of the inductor, switch, and diode) and $\\langle i_d \\rangle$ is the average current through the diode. We construct the averaged circuit:\nThe inductor equation is $L \\frac{di_L}{dt} = V_g - \\langle v_{sw} \\rangle$.\nThe capacitor equation is $C \\frac{dv_o}{dt} = \\langle i_d \\rangle - \\frac{v_o}{R}$.\nSubstituting the switch model equations, we get the large-signal averaged nonlinear model:\n$$\nL \\frac{di_L}{dt} = V_g - (1-d(t)) v_o(t)\n$$\n$$\nC \\frac{dv_o}{dt} = (1-d(t)) i_L(t) - \\frac{v_o(t)}{R}\n$$\n\n**Small-Signal AC Modeling**\nWe linearize these two equations around the DC operating point ($D, V_o, I_L$) by introducing small perturbations: $d=D+\\hat{d}$, $v_o=V_o+\\hat{v}_o$, $i_L=I_L+\\hat{i}_L$.\nFor the inductor equation:\n$L \\frac{d(I_L+\\hat{i}_L)}{dt} = V_g - (1-(D+\\hat{d}))(V_o+\\hat{v}_o)$\n$L \\frac{d\\hat{i}_L}{dt} = V_g - [(1-D)-\\hat{d}][V_o+\\hat{v}_o] \\approx V_g - [(1-D)V_o - V_o\\hat{d} + (1-D)\\hat{v}_o]$\nThe DC terms $V_g - (1-D)V_o = 0$ cancel. The first-order AC equation is:\n$L \\frac{d\\hat{i}_L}{dt} = V_o\\hat{d} - (1-D)\\hat{v}_o$.\n\nFor the capacitor equation:\n$C \\frac{d(V_o+\\hat{v}_o)}{dt} = (1-(D+\\hat{d}))(I_L+\\hat{i}_L) - \\frac{V_o+\\hat{v}_o}{R}$\n$C \\frac{d\\hat{v}_o}{dt} \\approx [(1-D)-\\hat{d}][I_L+\\hat{i}_L] - \\frac{V_o}{R} - \\frac{\\hat{v}_o}{R} \\approx [(1-D)I_L - I_L\\hat{d} + (1-D)\\hat{i}_L] - \\frac{V_o}{R} - \\frac{\\hat{v}_o}{R}$\nThe DC terms $(1-D)I_L - \\frac{V_o}{R} = 0$ cancel. The first-order AC equation is:\n$C \\frac{d\\hat{v}_o}{dt} = (1-D)\\hat{i}_L - I_L\\hat{d} - \\frac{\\hat{v}_o}{R}$.\n\nNow, we convert to the Laplace domain:\n$$\nsL \\hat{i}_L(s) = V_o \\hat{d}(s) - (1-D)\\hat{v}_o(s)\n$$\n$$\nsC \\hat{v}_o(s) = (1-D)\\hat{i}_L(s) - I_L \\hat{d}(s) - \\frac{\\hat{v}_o(s)}{R}\n$$\nFrom the first equation, we solve for $\\hat{i}_L(s)$:\n$$\n\\hat{i}_L(s) = \\frac{V_o \\hat{d}(s) - (1-D)\\hat{v}_o(s)}{sL}\n$$\nSubstitute this into the second equation:\n$$\nsC \\hat{v}_o(s) = (1-D) \\left[ \\frac{V_o \\hat{d}(s) - (1-D)\\hat{v}_o(s)}{sL} \\right] - I_L \\hat{d}(s) - \\frac{\\hat{v}_o(s)}{R}\n$$\nGroup terms containing $\\hat{v}_o(s)$ and $\\hat{d}(s)$:\n$$\n\\hat{v}_o(s) \\left( sC + \\frac{1}{R} + \\frac{(1-D)^2}{sL} \\right) = \\hat{d}(s) \\left( \\frac{(1-D)V_o}{sL} - I_L \\right)\n$$\nSolve for the transfer function $G_{vd,\\mathrm{SW}}(s) = \\frac{\\hat{v}_o(s)}{\\hat{d}(s)}$:\n$$\nG_{vd,\\mathrm{SW}}(s) = \\frac{\\frac{(1-D)V_o}{sL} - I_L}{sC + \\frac{1}{R} + \\frac{(1-D)^2}{sL}} = \\frac{(1-D)V_o - sLI_L}{s^2LC + s\\frac{L}{R} + (1-D)^2}\n$$\nDivide numerator and denominator by $LC$:\n$$\nG_{vd,\\mathrm{SW}}(s) = \\frac{\\frac{(1-D)V_o}{LC} - \\frac{sI_L}{C}}{s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}}\n$$\nSubstitute the steady-state values $V_o = \\frac{V_g}{1-D}$ and $I_L = \\frac{V_g}{(1-D)^2 R}$:\n$$\n\\text{Numerator} = \\frac{(1-D)}{LC}\\frac{V_g}{1-D} - \\frac{s}{C}\\frac{V_g}{(1-D)^2 R} = \\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}\n$$\nThus, the transfer function is:\n$$\nG_{vd,\\mathrm{SW}}(s) = \\frac{\\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}}{s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}}\n$$\n\n### Part 3: Difference and Explanation\n\nWe are asked to compute the difference $\\Delta(s) = G_{vd,\\mathrm{SSA}}(s) - G_{vd,\\mathrm{SW}}(s)$.\nFrom Part $1$ and Part $2$, we have found:\n$$\nG_{vd,\\mathrm{SSA}}(s) = \\frac{\\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}}{s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}}\n$$\n$$\nG_{vd,\\mathrm{SW}}(s) = \\frac{\\frac{V_g}{LC} - \\frac{sV_g}{(1-D)^2 RC}}{s^2 + \\frac{s}{RC} + \\frac{(1-D)^2}{LC}}\n$$\nThe two expressions are identical. Therefore, their difference is zero.\n$$\n\\Delta(s) = G_{vd,\\mathrm{SSA}}(s) - G_{vd,\\mathrm{SW}}(s) = 0\n$$\n\n**Explanation:**\nThe result $\\Delta(s) = 0$ is expected. State-Space Averaging (SSA) and the Averaged PWM Switch Model are two different procedural approaches to the same fundamental modeling technique. Both rely on the assumption that the state variables (inductor current and capacitor voltage) change slowly relative to the switching frequency, allowing their dynamics to be averaged over one switching period.\n\n- **State-Space Averaging** is a formal, matrix-based method where the state matrices of the converter's different linear topologies are averaged, and the resulting non-linear averaged state-space model is then linearized.\n- **The PWM Switch Model** is a circuit-oriented method. It replaces the physical switches with a circuit model that represents their averaged terminal voltage and current characteristics. This creates a non-linear averaged circuit, for which circuit laws (KVL, KCL) are written to obtain the same set of non-linear differential equations as in the SSA method. These equations are then linearized.\n\nEssentially, the PWM switch model is a circuit-level implementation of the state-space averaged equations. Since both methods start from the same averaging principle and perform an equivalent linearization, they must yield identical small-signal models for the same converter under the same assumptions. The difference in methodology is one of formalism (matrix algebra vs. circuit analysis), not in the underlying physics or mathematical approximations. Consequently, there is no discrepancy between the transfer functions derived from the two methods.",
            "answer": "$$\n\\boxed{0}\n$$"
        },
        {
            "introduction": "Beyond how the output responds to control inputs, it is critical to understand how it responds to changes in load current. This is characterized by the output impedance, $Z_{\\mathrm{out}}(s)$. This practice focuses on deriving the output impedance for a boost converter, incorporating the practical effects of inductor and capacitor parasitic resistances. It also addresses a crucial point of understanding: why the boost converter's characteristic right-half-plane zero (RHPZ) appears in its control transfer function but not in its output impedance. ",
            "id": "3880511",
            "problem": "Consider a continuous-conduction-mode boost converter with an ideal diode and ideal controlled switch, input source voltage $V_{g}$, inductor $L$ with series resistance $r_{L}$, and an output network consisting of a capacitor $C$ with series equivalent series resistance $r_{C}$ connected to the output node, and a resistive load $R$ tied from the output node to ground. The duty ratio $D$ is constant, and the input source voltage $V_{g}$ does not vary. Assume that the average model is obtained via State-Space Averaging (SSA), and that all parasitic resistances are small but nonzero. Define the small-signal open-loop output impedance $Z_{\\mathrm{out}}(s)$ as the ratio of the small-signal output voltage perturbation $\\hat{v}_{o}(s)$ to a small-signal current injection $\\hat{i}_{\\text{inj}}(s)$ at the output node, with $\\hat{i}_{\\text{inj}}$ taken positive into the output node, while holding the duty ratio and input source at their steady-state values.\n\nStarting only from the fundamental averaged laws implied by Kirchhoff’s Voltage Law (KVL), Kirchhoff’s Current Law (KCL), and the capacitor and inductor constitutive relations, derive the small-signal linearized averaged model and use it to obtain $Z_{\\mathrm{out}}(s)$, fully accounting for $r_{L}$ and $r_{C}$. Express your final answer as a single closed-form analytic expression in terms of $s$, $L$, $r_{L}$, $C$, $r_{C}$, $R$, and $D$ only. Briefly explain, based on your derivation, how the right-half-plane zero typical of the boost converter appears (or does not appear) in the impedance response. No numerical evaluation is required. Provide the expression exactly; no rounding is needed. Units are not required in the final expression.",
            "solution": "The derivation of the small-signal open-loop output impedance, $Z_{\\mathrm{out}}(s)$, for the specified boost converter begins with establishing the averaged model, which describes the circuit's dynamics over time scales longer than a single switching period. We select the inductor current $\\langle i_L \\rangle$ and the voltage across the capacitor proper $\\langle v_C \\rangle$ as our state variables. The output voltage $\\langle v_o \\rangle$ includes the voltage drop across the capacitor's equivalent series resistance (ESR), $r_C$.\n\nThe fundamental averaged equations are derived by applying Kirchhoff's laws to the circuit, averaged over one switching period $T_s$.\n\n1.  **Averaged Inductor Voltage Law:** The average voltage across the inductor $L$ is determined by the switch position.\n    -   When the switch is ON (duration $D T_s$), the voltage applied across the $L-r_L$ series combination is $\\langle v_g \\rangle$.\n    -   When the switch is OFF (duration $(1-D)T_s$), the voltage is $\\langle v_g \\rangle - \\langle v_o \\rangle$.\n    Averaging these gives the equation for the inductor branch:\n    $$L \\frac{d\\langle i_L \\rangle}{dt} + \\langle i_L \\rangle r_L = D \\langle v_g \\rangle + (1-D)(\\langle v_g \\rangle - \\langle v_o \\rangle)$$\n    $$L \\frac{d\\langle i_L \\rangle}{dt} = \\langle v_g \\rangle - \\langle i_L \\rangle r_L - (1-D)\\langle v_o \\rangle$$\n\n2.  **Averaged Output Node Current Law:** The current delivered to the output stage from the switching action is $(1-D)\\langle i_L \\rangle$. This current splits between the load resistor $R$ and the capacitor branch ($C$ in series with $r_C$). To define the output impedance, an external current source $\\langle i_{\\text{inj}} \\rangle$ is injected at the output node.\n    The current into the capacitor branch is $\\langle i_C \\rangle = C \\frac{d\\langle v_C \\rangle}{dt}$. The current into the load is $\\frac{\\langle v_o \\rangle}{R}$. The KCL at the output node is:\n    $$(1-D)\\langle i_L \\rangle + \\langle i_{\\text{inj}} \\rangle = \\frac{\\langle v_o \\rangle}{R} + \\langle i_C \\rangle$$\n    $$C \\frac{d\\langle v_C \\rangle}{dt} = (1-D)\\langle i_L \\rangle - \\frac{\\langle v_o \\rangle}{R} + \\langle i_{\\text{inj}} \\rangle$$\n\n3.  **Output Voltage Relation:** The output voltage $\\langle v_o \\rangle$ is the sum of the voltage across the capacitor, $\\langle v_C \\rangle$, and the voltage across its ESR, $r_C$, which is $r_C \\langle i_C \\rangle$.\n    $$\\langle v_o \\rangle = \\langle v_C \\rangle + r_C \\langle i_C \\rangle = \\langle v_C \\rangle + r_C C \\frac{d\\langle v_C \\rangle}{dt}$$\n\nTo find the small-signal model, we perturb each variable around its DC quiescent point: $\\langle v_g \\rangle = V_g + \\hat{v}_g$, $\\langle i_L \\rangle = I_L + \\hat{i}_L$, $\\langle v_C \\rangle = V_C + \\hat{v}_C$, $\\langle v_o \\rangle = V_o + \\hat{v}_o$, $D = D + \\hat{d}$, and $\\langle i_{\\text{inj}} \\rangle = 0 + \\hat{i}_{\\text{inj}}$. We then linearize the equations by retaining only the first-order (small-signal) terms.\n\nFor the output impedance calculation, the control input and source voltage are held constant, so $\\hat{d}=0$ and $\\hat{v}_g=0$. The linearized AC equations are:\n\n1.  From the inductor voltage equation:\n    $$L \\frac{d\\hat{i}_L}{dt} = -\\hat{i}_L r_L - (1-D)\\hat{v}_o$$\n\n2.  From the output node current equation:\n    $$C \\frac{d\\hat{v}_C}{dt} = (1-D)\\hat{i}_L - \\frac{\\hat{v}_o}{R} + \\hat{i}_{\\text{inj}}$$\n\n3.  From the output voltage relation:\n    $$\\hat{v}_o = \\hat{v}_C + r_C C \\frac{d\\hat{v}_C}{dt}$$\n\nNext, we transform these time-domain differential equations into the Laplace domain by replacing $\\frac{d}{dt}$ with the complex frequency variable $s$.\n\n1.  $sL\\hat{i}_L(s) = -r_L\\hat{i}_L(s) - (1-D)\\hat{v}_o(s)$\n    $$(sL+r_L)\\hat{i}_L(s) = -(1-D)\\hat{v}_o(s) \\implies \\hat{i}_L(s) = -\\frac{1-D}{sL+r_L}\\hat{v}_o(s)$$\n\n2.  $sC\\hat{v}_C(s) = (1-D)\\hat{i}_L(s) - \\frac{\\hat{v}_o(s)}{R} + \\hat{i}_{\\text{inj}}(s)$\n\n3.  $\\hat{v}_o(s) = \\hat{v}_C(s) + sCr_C\\hat{v}_C(s) = (1+sCr_C)\\hat{v}_C(s)$\n    $$\\implies \\hat{v}_C(s) = \\frac{\\hat{v}_o(s)}{1+sCr_C}$$\n\nNow we substitute the expressions for $\\hat{i}_L(s)$ and $\\hat{v}_C(s)$ into the Laplace-transformed KCL equation:\n$$sC \\left( \\frac{\\hat{v}_o(s)}{1+sCr_C} \\right) = (1-D)\\left( -\\frac{1-D}{sL+r_L}\\hat{v}_o(s) \\right) - \\frac{\\hat{v}_o(s)}{R} + \\hat{i}_{\\text{inj}}(s)$$\n\nTo find the output impedance $Z_{\\mathrm{out}}(s) = \\frac{\\hat{v}_o(s)}{\\hat{i}_{\\text{inj}}(s)}$, we rearrange the equation to isolate $\\hat{i}_{\\text{inj}}(s)$:\n$$\\hat{i}_{\\text{inj}}(s) = \\hat{v}_o(s) \\left[ \\frac{sC}{1+sCr_C} + \\frac{(1-D)^2}{sL+r_L} + \\frac{1}{R} \\right]$$\n\nThe output impedance is the reciprocal of the term in the brackets. This shows that $Z_{\\mathrm{out}}(s)$ is the parallel combination of three impedances: the impedance of the capacitor with its ESR ($r_C + \\frac{1}{sC}$), the impedance of the active input stage reflected to the output ($\\frac{sL+r_L}{(1-D)^2}$), and the load resistance $R$.\n\nTo obtain a single closed-form expression, we combine the terms in the admittance expression:\n$$\\frac{1}{Z_{\\mathrm{out}}(s)} = \\frac{ sCR(sL+r_L) + (1-D)^2 R(1+sCr_C) + (sL+r_L)(1+sCr_C) }{R(sL+r_L)(1+sCr_C)}$$\nTaking the reciprocal yields the final expression for the output impedance:\n$$Z_{\\mathrm{out}}(s) = \\frac{R(sL+r_L)(1+sCr_C)}{sCR(sL+r_L) + (1-D)^2 R(1+sCr_C) + (sL+r_L)(1+sCr_C)}$$\nThis can be written in a more structured form by factoring the denominator:\n$$Z_{\\mathrm{out}}(s) = \\frac{R(sL+r_L)(1+sCr_C)}{(sL+r_L)(1+sC(R+r_C)) + (1-D)^2R(1+sCr_C)}$$\n\n**Regarding the Right-Half-Plane Zero (RHPZ):**\nThe RHPZ characteristic of a boost converter appears in its control-to-output transfer function, $G_{vd}(s) = \\hat{v}_o(s)/\\hat{d}(s)$, not in its output impedance $Z_{\\mathrm{out}}(s)$. The physical reason for the RHPZ is the two-stage power transfer: an increase in duty cycle $D$ first lengthens the time the inductor charges from the input, disconnecting it from the output. This causes an initial drop in output voltage before the larger stored energy is delivered to the output, causing a subsequent rise. This non-minimum phase behavior (\"going the wrong way first\") is modeled mathematically as a zero in the right half of the complex s-plane.\n\nIn the derivation of the output impedance $Z_{\\mathrm{out}}(s)$, the duty ratio is held constant ($\\hat{d}=0$). The system's response is solely due to the passive, averaged circuit's reaction to an external current injection. The dynamic behavior that causes the RHPZ—the active modulation of the switch duty cycle—is not present in this scenario.\nThe zeros of $Z_{\\mathrm{out}}(s)$ are found from the numerator of its expression: $R(sL+r_L)(1+sCr_C)=0$. This gives two zeros: $s_1 = -r_L/L$ and $s_2 = -1/(Cr_C)$. Both are located in the left-half plane, as $L, C, r_L, r_C$ are positive physical quantities. Therefore, the output impedance does not exhibit the RHPZ.",
            "answer": "$$\\boxed{\\frac{R(sL+r_L)(1+sCr_C)}{(sL+r_L)(1+sC(R+r_C)) + (1-D)^2R(1+sCr_C)}}$$"
        },
        {
            "introduction": "A key aspect of advanced power electronics design is not just analyzing the effects of non-idealities, but actively using them to improve performance. This practice elevates the analysis of output impedance into a design problem by connecting it to classical filter theory. You will determine the specific values of parasitic resistances in a buck converter's output filter that create a \"maximally flat\" or Butterworth-type response, a highly desirable characteristic for stable and well-behaved power delivery. ",
            "id": "3880489",
            "problem": "Consider a continuous-conduction-mode buck converter power stage in which parasitic resistances are modeled explicitly: the inductor has Direct Current Resistance (DCR) denoted by $R_{\\mathrm{DCR}}$, and the output capacitor has Equivalent Series Resistance (ESR) denoted by $R_{\\mathrm{ESR}}$. Assume an ideal switch network and an ideal input source. Using the standard state-space averaging framework for small-signal modeling, define the small-signal output impedance $Z_{\\mathrm{out}}(s)$ as the ratio of the small-signal output voltage perturbation to a small-signal current injection at the output node, with the duty ratio and input source perturbations suppressed (set to zero).\n\nStarting from the element constitutive relations $v_{L}(t) = L \\, \\frac{di_{L}}{dt}$ with series resistance $R_{\\mathrm{DCR}}$, $i_{C}(t) = C \\, \\frac{dv_{C}}{dt}$ with series resistance $R_{\\mathrm{ESR}}$, and Ohm’s law, along with Kirchhoff’s Current Law (KCL) at the output node, perform the following:\n\n1. Derive the exact small-signal output impedance $Z_{\\mathrm{out}}(s)$ of the passive network seen at the output node when the input source and duty perturbations are suppressed (i.e., the left terminal of the inductor is at small-signal ground). Model the inductor branch impedance as $Z_{L}(s) = R_{\\mathrm{DCR}} + s L$ and the capacitor branch impedance as $Z_{C}(s) = R_{\\mathrm{ESR}} + \\frac{1}{s C}$, and use passive network combination laws to obtain $Z_{\\mathrm{out}}(s)$.\n\n2. Define the natural frequency $\\omega_{0} = \\frac{1}{\\sqrt{L C}}$ and the characteristic impedance $Z_{0} = \\sqrt{\\frac{L}{C}}$. Express the squared magnitude of $Z_{\\mathrm{out}}(j \\omega)$ normalized by $Z_{0}^{2}$ as a rational function of the dimensionless frequency $x = \\frac{\\omega}{\\omega_{0}}$ and the normalized resistances $r_{L} = \\frac{R_{\\mathrm{DCR}}}{Z_{0}}$ and $r_{C} = \\frac{R_{\\mathrm{ESR}}}{Z_{0}}$.\n\n3. In the precise sense that the first and second derivatives of $\\left| Z_{\\mathrm{out}}(j \\omega) \\right|$ with respect to $\\omega$ vanish at $\\omega = \\omega_{0}$, determine the condition on $R_{\\mathrm{ESR}}$ and $R_{\\mathrm{DCR}}$ (expressed in ohms) that yields a maximally flat magnitude response at midband. Provide your final condition as a single pair $(R_{\\mathrm{ESR}}, R_{\\mathrm{DCR}})$ expressed in terms of $L$ and $C$.\n\nNo numerical approximation is required; provide your final condition in closed form. Express both resistances in $\\mathrm{\\Omega}$.",
            "solution": "### Part 1: Small-Signal Output Impedance $Z_{\\mathrm{out}}(s)$\n\nIn the small-signal model of the buck converter, setting the duty cycle perturbation $\\hat{d}(s)$ and the input voltage perturbation $\\hat{v}_g(s)$ to zero effectively connects the input of the $L$-$C$ filter to small-signal ground. The output impedance $Z_{\\mathrm{out}}(s)$ is then the impedance of this passive filter network as seen from the output terminals. This network consists of the inductor branch in parallel with the capacitor branch.\n\nThe impedance of the inductor branch, including its DCR, is given by:\n$$Z_{L}(s) = R_{\\mathrm{DCR}} + s L$$\nThe impedance of the capacitor branch, including its ESR, is given by:\n$$Z_{C}(s) = R_{\\mathrm{ESR}} + \\frac{1}{s C}$$\nThe total output impedance $Z_{\\mathrm{out}}(s)$ is the parallel combination of $Z_{L}(s)$ and $Z_{C}(s)$:\n$$Z_{\\mathrm{out}}(s) = Z_{L}(s) \\parallel Z_{C}(s) = \\frac{Z_{L}(s) Z_{C}(s)}{Z_{L}(s) + Z_{C}(s)}$$\nSubstituting the expressions for $Z_{L}(s)$ and $Z_{C}(s)$:\n$$Z_{\\mathrm{out}}(s) = \\frac{(R_{\\mathrm{DCR}} + s L) (R_{\\mathrm{ESR}} + \\frac{1}{s C})}{R_{\\mathrm{DCR}} + s L + R_{\\mathrm{ESR}} + \\frac{1}{s C}}$$\nThis expression can be expanded into a standard rational function form:\n$$Z_{\\mathrm{out}}(s) = \\frac{(R_{\\mathrm{DCR}} + s L) \\frac{s C R_{\\mathrm{ESR}} + 1}{s C}}{\\frac{s C (R_{\\mathrm{DCR}} + R_{\\mathrm{ESR}}) + s^2 L C + 1}{s C}} = \\frac{s^2 L C R_{\\mathrm{ESR}} + s(L + C R_{\\mathrm{DCR}} R_{\\mathrm{ESR}}) + R_{\\mathrm{DCR}}}{s^2 L C + s C(R_{\\mathrm{DCR}} + R_{\\mathrm{ESR}}) + 1}$$\n\n### Part 2: Normalized Squared Magnitude Response\n\nWe are asked to express $\\frac{|Z_{\\mathrm{out}}(j \\omega)|^2}{Z_{0}^{2}}$ as a function of the normalized variables. Let's start with the impedance ratio $\\frac{Z_{\\mathrm{out}}(s)}{Z_{0}}$. We use the given definitions: $\\omega_{0} = \\frac{1}{\\sqrt{L C}}$, $Z_{0} = \\sqrt{\\frac{L}{C}}$, $x = \\frac{\\omega}{\\omega_{0}}$, $r_{L} = \\frac{R_{\\mathrm{DCR}}}{Z_{0}}$, and $r_{C} = \\frac{R_{\\mathrm{ESR}}}{Z_{0}}$. From these, we can express $L$ and $C$ as $L = \\frac{Z_0}{\\omega_0}$ and $C = \\frac{1}{Z_0 \\omega_0}$.\n\nWe substitute $s = j\\omega = j x \\omega_0$ into the component impedances:\n$$R_{\\mathrm{DCR}} = r_L Z_0$$\n$$R_{\\mathrm{ESR}} = r_C Z_0$$\n$$s L = j x \\omega_0 \\left(\\frac{Z_0}{\\omega_0}\\right) = j x Z_0$$\n$$\\frac{1}{s C} = \\frac{1}{j x \\omega_0 \\left(\\frac{1}{Z_0 \\omega_0}\\right)} = \\frac{Z_0}{j x} = -j \\frac{Z_0}{x}$$\nNow, substitute these into the expression for $Z_{\\mathrm{out}}(s)$:\n$$Z_{\\mathrm{out}}(j\\omega) = Z_0 \\frac{(r_L + j x) (r_C - j \\frac{1}{x})}{(r_L + r_C) + j(x - \\frac{1}{x})}$$\nThe normalized impedance is:\n$$\\frac{Z_{\\mathrm{out}}(j\\omega)}{Z_0} = \\frac{(r_L + j x) (r_C - j \\frac{1}{x})}{(r_L + r_C) + j(x - \\frac{1}{x})}$$\nWe now find the squared magnitude of this complex expression:\n$$\\frac{|Z_{\\mathrm{out}}(j\\omega)|^2}{Z_0^2} = \\frac{|(r_L + j x) (r_C - j \\frac{1}{x})|^2}{|(r_L + r_C) + j(x - \\frac{1}{x})|^2} = \\frac{|r_L + j x|^2 |r_C - j \\frac{1}{x}|^2}{(r_L + r_C)^2 + (x - \\frac{1}{x})^2}$$\nThis simplifies to:\n$$\\frac{|Z_{\\mathrm{out}}(j\\omega)|^2}{Z_0^2} = \\frac{(r_L^2 + x^2) (r_C^2 + \\frac{1}{x^2})}{(r_L + r_C)^2 + (x - \\frac{1}{x})^2}$$\nTo express this as a rational function of $x$, we can expand and multiply the numerator and denominator by $x^2$:\n$$\\frac{|Z_{\\mathrm{out}}(j\\omega)|^2}{Z_0^2} = \\frac{r_L^2 r_C^2 + \\frac{r_L^2}{x^2} + x^2 r_C^2 + 1}{(r_L+r_C)^2 + x^2 - 2 + \\frac{1}{x^2}} = \\frac{r_C^2 x^4 + (r_L^2 r_C^2 + 1)x^2 + r_L^2}{x^4 + ((r_L+r_C)^2 - 2)x^2 + 1}$$\n\n### Part 3: Condition for Maximally Flat Magnitude Response\n\nThe condition for a maximally flat magnitude response at $\\omega=\\omega_0$ (which corresponds to $x=1$) is that the first and second derivatives of $|Z_{\\mathrm{out}}(j\\omega)|$ with respect to $\\omega$ vanish at $\\omega=\\omega_0$. It is mathematically more convenient to work with the squared magnitude. Let $F(x) = \\frac{|Z_{\\mathrm{out}}(j\\omega)|^2}{Z_0^2}$. The condition is equivalent to setting the first and second derivatives of $F(x)$ with respect to $x$ to zero at $x=1$, provided $|Z_{\\mathrm{out}}(j\\omega_0)| \\neq 0$.\n\nLet $F(x) = \\frac{N(x)}{D(x)}$, where:\n$$N(x) = r_L^2 r_C^2 + r_L^2 x^{-2} + r_C^2 x^2 + 1$$\n$$D(x) = (r_L+r_C)^2 + x^2 - 2 + x^{-2}$$\nThe first derivative is $F'(x) = \\frac{N'(x)D(x) - N(x)D'(x)}{D(x)^2}$. For $F'(1)=0$, we need $N'(1)D(1) - N(1)D'(1)=0$.\nFirst, we find the derivatives of $N(x)$ and $D(x)$:\n$$N'(x) = -2 r_L^2 x^{-3} + 2 r_C^2 x \\implies N'(1) = 2(r_C^2 - r_L^2)$$\n$$D'(x) = 2x - 2x^{-3} \\implies D'(1) = 2(1) - 2(1) = 0$$\nAt $x=1$:\n$$D(1) = (r_L+r_C)^2 + 1 - 2 + 1 = (r_L+r_C)^2$$\nThe first derivative condition becomes:\n$$2(r_C^2 - r_L^2)(r_L+r_C)^2 - N(1) \\cdot 0 = 0$$\n$$2(r_C - r_L)(r_C + r_L)(r_L+r_C)^2 = 0$$\nSince resistances are non-negative, $r_L \\ge 0$ and $r_C \\ge 0$. The term $(r_L+r_C)$ can only be zero if both resistances are zero, a trivial case. Thus, we must have $r_C - r_L = 0$, which implies:\n$$r_L = r_C$$\nThis is the first condition. Let's denote the common value by $r$.\n\nNow for the second derivative. The general expression is complex, but at a point where $N'(1)=0$ and $D'(1)=0$, it simplifies.\n$F''(1) = \\frac{N''(1)D(1) - N(1)D''(1)}{D(1)^2}$. For $F''(1)=0$, we need $N''(1)D(1) - N(1)D''(1)=0$.\nLet's compute the second derivatives:\n$$N''(x) = 6 r_L^2 x^{-4} + 2 r_C^2 \\implies N''(1) = 6 r_L^2 + 2 r_C^2$$\n$$D''(x) = 2 + 6x^{-4} \\implies D''(1) = 2 + 6 = 8$$\nWe also need $N(1)$:\n$$N(1) = (r_L^2+1)(r_C^2+1)$$\nSubstituting these into the condition and using $r_L=r_C=r$:\n$$(6r^2+2r^2)(r+r)^2 - (r^2+1)(r^2+1)(8) = 0$$\n$$(8r^2)(2r)^2 - 8(r^2+1)^2 = 0$$\n$$(8r^2)(4r^2) - 8(r^4 + 2r^2 + 1) = 0$$\n$$32r^4 - 8r^4 - 16r^2 - 8 = 0$$\n$$24r^4 - 16r^2 - 8 = 0$$\nDividing by $8$:\n$$3r^4 - 2r^2 - 1 = 0$$\nThis is a quadratic equation for $r^2$. Let $y=r^2$.\n$$3y^2 - 2y - 1 = 0$$\nFactoring this gives:\n$$(3y+1)(y-1) = 0$$\nThe solutions for $y$ are $y = -\\frac{1}{3}$ and $y = 1$. Since $y=r^2$ and $r$ is a real, non-negative quantity, $r^2$ must be non-negative. Therefore, the only physically valid solution is $r^2=1$, which implies $r=1$.\n\nThe condition for the maximally flat magnitude response is $r_L=r_C=1$.\nWe convert this back to the original resistance values:\n$$r_L = \\frac{R_{\\mathrm{DCR}}}{Z_0} = 1 \\implies R_{\\mathrm{DCR}} = Z_0 = \\sqrt{\\frac{L}{C}}$$\n$$r_C = \\frac{R_{\\mathrm{ESR}}}{Z_0} = 1 \\implies R_{\\mathrm{ESR}} = Z_0 = \\sqrt{\\frac{L}{C}}$$\nThus, both the inductor DCR and capacitor ESR must be equal to the characteristic impedance $Z_0$ of the filter.\n\nThe final condition is the pair $(R_{\\mathrm{ESR}}, R_{\\mathrm{DCR}})$ given by $(\\sqrt{\\frac{L}{C}}, \\sqrt{\\frac{L}{C}})$.",
            "answer": "$$\\boxed{\\begin{pmatrix} \\sqrt{\\frac{L}{C}}  \\sqrt{\\frac{L}{C}} \\end{pmatrix}}$$"
        }
    ]
}