## 引言
随机游走是描述网络化系统中动态过程的最基本模型之一，从网页间的链接跳转到分子在细胞内的扩散，其应用无处不在。要精确理解并预测这些过程的长期行为，我们必须掌握其背后的核心数学工具：转移矩阵与[平稳分布](@entry_id:194199)。转移矩阵刻画了系统在每一步的演化规则，而[平稳分布](@entry_id:194199)则揭示了系统在长时间演化后达到的[统计平衡](@entry_id:186577)状态。本文旨在系统性地阐明这些概念，解决从局部转移规则推断全局[稳态](@entry_id:139253)行为这一核心问题。

在接下来的内容中，读者将踏上一段从理论到应用的探索之旅。在“原理与机制”一章中，我们将从第一性原理出发，构建转移矩阵，定义[平稳分布](@entry_id:194199)，并探讨其存在、唯一性和收敛性的条件，如遍历性、可逆性与[细致平衡](@entry_id:145988)。随后，在“应用与跨学科联系”一章，我们将展示这些理论如何在网络科学、[PageRank算法](@entry_id:138392)、[计算生物学](@entry_id:146988)和统计物理学等领域转化为强大的分析工具，揭示复杂系统的结构与功能。最后，通过“动手实践”部分，读者将有机会通过具体的计算练习，将抽象的理论知识内化为解决实际问题的能力。

## 原理与机制

本章旨在深入探讨[随机游走过程](@entry_id:171699)的核心数学工具：转移矩阵与[平稳分布](@entry_id:194199)。我们将从第一性原理出发，构建描述系统动态的数学框架，并逐步揭示其长期行为的深刻规律。本章内容将不仅局限于理论定义，更会通过具体的图网络实例，阐释这些抽象概念在不同系统结构下的具体表现与物理意义。

### 转移矩阵：随机动态的算子

随机游走，作为[马尔可夫链](@entry_id:150828)的一种具体表现形式，其一步动态完全由一个称为**转移矩阵**（transition matrix）的数学对象 $P$ 所刻画。该矩阵的每一个元素 $P_{ij}$ 代表了系统从状态 $i$ 转移到状态 $j$ 的概率。为了确保概率的完备性与非负性，转移矩阵必须满足 $P_{ij} \ge 0$。

在学术文献中，存在两种主流的约定来描述概率分布随时间的演化，这取决于我们将状态的[概率质量函数](@entry_id:265484)（PMF）表示为行向量还是列向量。理解这两种约定的区别至关重要 。

1.  **行随机约定 (Row-Stochastic Convention)**：在此约定下，时刻 $t$ 的概率分布被表示为一个行向量 $\boldsymbol{p}_t^\top = [p_1(t), p_2(t), \dots, p_n(t)]$。系统的演化通过矩阵右乘实现：
    $$
    \boldsymbol{p}_{t+1}^\top = \boldsymbol{p}_t^\top P
    $$
    为了保证总[概率守恒](@entry_id:149166)，即 $\sum_{j=1}^n p_j(t+1) = 1$，我们必须对 $P$ 施加一个约束。将演化方程代入[归一化条件](@entry_id:156486)：
    $$
    \sum_{j=1}^n p_j(t+1) = \sum_{j=1}^n \sum_{i=1}^n p_i(t) P_{ij} = \sum_{i=1}^n p_i(t) \left( \sum_{j=1}^n P_{ij} \right) = 1
    $$
    由于这个等式必须对任意概率分布 $\boldsymbol{p}_t^\top$ 成立（其中 $\sum_i p_i(t) = 1$），唯一的可能是括号内的项对所有 $i$ 都等于 1。因此，我们得到了[行随机矩阵](@entry_id:1131129)的定义：
    $$
    \sum_{j=1}^n P_{ij} = 1, \quad \forall i \in \{1, \dots, n\}
    $$
    即矩阵的**每一行元素之和必须为1**。

2.  **列随机约定 (Column-Stochastic Convention)**：在此约定下，PMF被表示为一个列向量 $\boldsymbol{p}_t$，演化通过矩阵左乘实现：$\boldsymbol{p}_{t+1} = P \boldsymbol{p}_t$。通过类似的推导，可以证明为了保证[概率守恒](@entry_id:149166)，矩阵 $P$ 必须满足**每一列元素之和为1**，即 $\sum_{i=1}^n P_{ij} = 1, \forall j$。

在网络科学和复杂系统的研究中，行随机约定更为常见。因此，**本章后续内容将统一采用行随机约定**。

让我们通过一个核心范例——图上的简单随机游走——来具体构建[转移矩阵](@entry_id:145510)。考虑一个图 $G=(V, E)$，其中 $V$ 是节点集合， $E$ 是[边集](@entry_id:267160)合。

-   **无向无权[图上的随机游走](@entry_id:273358)**：规则是在每个节点上，等概率地选择一个邻居进行跳转。对于一个节点 $i$，其邻居的数量由其**度**（degree）$d_i$ 给出。如果节点 $j$ 是 $i$ 的邻居，则从 $i$ 转移到 $j$ 的概率是 $1/d_i$；否则为 $0$。利用图的[邻接矩阵](@entry_id:151010) $A$（如果 $i$ 和 $j$ 相连，则 $A_{ij}=1$，否则为 $0$），我们可以将转移概率统一写成一个简洁的表达式  ：
    $$
    P_{ij} = \frac{A_{ij}}{d_i}
    $$
    其中 $d_i = \sum_j A_{ij}$。由于图是无向的，$A$ 是对称的。该定义自然满足行随机条件：$\sum_j P_{ij} = \sum_j \frac{A_{ij}}{d_i} = \frac{1}{d_i} \sum_j A_{ij} = \frac{d_i}{d_i} = 1$。对于有权重的[无向图](@entry_id:270905)，定义是类似的，只需将 $A_{ij}$ 解释为权重，$d_i$ 解释为节点 $i$ 的强度（strength），即所有与之相连的边的权重之和。

-   **有向[图上的随机游走](@entry_id:273358)**：规则变为从当前节点 $i$ 等概率地选择一条出边（outgoing edge）进行跳转。因此，转移概率的分母应为节点的**出度**（out-degree）$k_{out}(i)$。例如，考虑一个具有[边集](@entry_id:267160) $\{1\to2, 1\to3, 2\to1, 3\to1, 3\to4, 4\to2\}$ 的[有向图](@entry_id:920596) 。各节点的出度为 $k_{out}(1)=2, k_{out}(2)=1, k_{out}(3)=2, k_{out}(4)=1$。其转移矩阵 $P$ 构造如下：
    $$
    P = \begin{pmatrix}
    0  \frac{1}{2}  \frac{1}{2}  0 \\
    1  0  0  0 \\
    \frac{1}{2}  0  0  \frac{1}{2} \\
    0  1  0  0
    \end{pmatrix}
    $$
    每一行代表一个起始节点，其元素之和为1，符合行随机约定。

### [平稳分布](@entry_id:194199)：一个不变的度量

一个核心问题是：当[随机游走过程](@entry_id:171699)持续进行，系统是否会达到一种[统计平衡](@entry_id:186577)状态？这种平衡状态由**[平稳分布](@entry_id:194199)**（stationary distribution）$\boldsymbol{\pi}^\top$ 描述。[平稳分布](@entry_id:194199)是一个特殊的概率分布，它在转移矩阵的作用下保持不变。

根据我们的行随机约定，不变性意味着：
$$
\boldsymbol{\pi}^\top P = \boldsymbol{\pi}^\top
$$
这个方程表明，[平稳分布](@entry_id:194199) $\boldsymbol{\pi}^\top$ 是转移矩阵 $P$ 的一个**左[特征向量](@entry_id:151813)**（left eigenvector），其对应的特征值为1 。从物理上看，这个方程描述了一种动态平衡：在平稳状态下，对于任何一个状态 $j$，从所有其他状态流入该状态的总[概率通量](@entry_id:907649)，恰好等于从该状态流出的总概率通量 。
$$
\pi_j = \sum_{i=1}^n \pi_i P_{ij}
$$
这保证了在宏观层面，每个状态的概率占比维持恒定。

-   **无向图的[平稳分布](@entry_id:194199)**：对于一个连通的[无向图](@entry_id:270905)上的简单随机游走，其[平稳分布](@entry_id:194199)有一个优美的解析形式：节点 $i$ 的平稳概率与其度 $d_i$ 成正比 。
    $$
    \pi_i = \frac{d_i}{\sum_{k=1}^n d_k}
    $$
    其中分母 $\sum_k d_k = 2|E|$ 是图的总度数。这个结论意味着，在长时间的随机游走后，我们在一个节点上发现“游走者”的概率，正比于该节点的连接数。度越高的节点，越容易被访问到。

这个简单而深刻的结果源于无向图随机游走的一个特殊性质：**可逆性**（reversibility）。一个[马尔可夫链](@entry_id:150828)被称为可逆的，如果它满足**[细致平衡条件](@entry_id:265158)**（detailed balance condition）：
$$
\pi_i P_{ij} = \pi_j P_{ji} \quad \forall i, j
$$
这个条件意味着在平稳状态下，从 $i$ 到 $j$ 的概率流与从 $j$ 到 $i$ 的概率流完全相等。对于无向[图上的随机游走](@entry_id:273358)，我们有 $P_{ij} = A_{ij}/d_i$ 和 $\pi_i \propto d_i$。代入[细致平衡方程](@entry_id:265021)的左边：$\pi_i P_{ij} \propto d_i (A_{ij}/d_i) = A_{ij}$。代入右边：$\pi_j P_{ji} \propto d_j (A_{ji}/d_j) = A_{ji}$。由于邻接矩阵 $A$ 是对称的（$A_{ij}=A_{ji}$），[细致平衡条件](@entry_id:265158)得以满足。

-   **有向图的非[可逆性](@entry_id:143146)与[概率流](@entry_id:907649)**：在有向图上，情况变得更为复杂。通常，[细致平衡条件](@entry_id:265158)不再成立。以上述四节点[有向图](@entry_id:920596)为例 ，通过[求解线性方程组](@entry_id:169069) $\boldsymbol{\pi}^\top P = \boldsymbol{\pi}^\top$ 并归一化，我们得到的唯一[平稳分布](@entry_id:194199)是 $\boldsymbol{\pi}^\top = (\frac{2}{5}, \frac{3}{10}, \frac{1}{5}, \frac{1}{10})$。让我们检验一下节点1和2之间的[细致平衡](@entry_id:145988)：
    -   $\pi_1 P_{12} = \frac{2}{5} \times \frac{1}{2} = \frac{1}{5}$
    -   $\pi_2 P_{21} = \frac{3}{10} \times 1 = \frac{3}{10}$
    显然，$\pi_1 P_{12} \neq \pi_2 P_{21}$。这表明该链是**非可逆的**（non-reversible）。在平稳状态下，从节点1到节点2的概率流（$\frac{1}{5}$）不等于反向的概率流（$\frac{3}{10}$）。

为了量化这种不平衡，我们定义**[稳态概率](@entry_id:276958)流**（steady-state probability current） ：
$$
J_{ij} = \pi_i P_{ij} - \pi_j P_{ji}
$$
$J_{ij}$ 度量了在状态 $i$ 和 $j$ 之间净的[概率流](@entry_id:907649)动方向和大小。对于可逆链，$J_{ij} = 0$ 对所有 $(i,j)$ 成立。对于非可逆链，则存在非零的概率流。例如，在一个三节点循环的[有向图](@entry_id:920596) $1 \to 2 \to 3 \to 1$（并带有自环）中，其[转移矩阵](@entry_id:145510)为 $P = \begin{pmatrix} 0.1  0.9  0 \\ 0  0.1  0.9 \\ 0.9  0  0.1 \end{pmatrix}$。其[平稳分布](@entry_id:194199)是均匀的 $\boldsymbol{\pi}^\top = (\frac{1}{3}, \frac{1}{3}, \frac{1}{3})$。此时，从节点1到2的净概率流为：
$$
J_{12} = \pi_1 P_{12} - \pi_2 P_{21} = \frac{1}{3} \times 0.9 - \frac{1}{3} \times 0 = \frac{3}{10}
$$
这个非零值揭示了在宏观平衡状态下，存在一个持续的、顺时针方向的微观概率环流。

### 收敛至平衡：[遍历定理](@entry_id:261967)

我们已经定义了[平稳分布](@entry_id:194199)，但一个关键问题是：从任意初始状态开始的随机游走，其概率分布是否总会收敛到这个[平稳分布](@entry_id:194199)？答案取决于转移矩阵的结构特性，这些特性可以用图论的语言来描述  。

1.  **不可约性 (Irreducibility)**：一个[马尔可夫链](@entry_id:150828)是不可约的，如果从任何状态 $i$ 出发，都有可能在有限步内到达任何其他状态 $j$。在图论中，这等价于[转移矩阵](@entry_id:145510)对应的有向图是**强连通的**。数学上，$\forall i, j$，存在某个整数 $t \ge 1$ 使得 $(P^t)_{ij} > 0$。

2.  **[非周期性](@entry_id:275873) (Aperiodicity)**：一个状态 $i$ 的**周期** $d(i)$ 是所有从 $i$ 出发再回到 $i$ 的可能路径长度（步数）的[最大公约数](@entry_id:142947)。如果一个链不可约，那么所有状态都具有相同的周期 $d$。如果 $d=1$，则称该链是非周期的。例如，一个简单的[二分图](@entry_id:262451)上的游走是周期的（周期为2），因为所有返回路径的长度都是偶数。而任何带有[自环](@entry_id:274670)（$P_{ii}>0$）的不[可约链](@entry_id:200553)都是非周期的。

一个既不可约又非周期的马尔可夫链被称为**遍历的**（ergodic）。对于遍历链，我们有强大的**[遍历定理](@entry_id:261967)**：

 **[有限马尔可夫链](@entry_id:264809)基本定理**：对于一个具有[转移矩阵](@entry_id:145510) $P$ 的遍历的[有限马尔可夫链](@entry_id:264809)，存在一个唯一的[平稳分布](@entry_id:194199) $\boldsymbol{\pi}^\top$。并且，对于任何初始概率分布 $\boldsymbol{p}_0^\top$，其后续分布将收敛到这个[平稳分布](@entry_id:194199)：
 $$
 \lim_{t \to \infty} \boldsymbol{p}_t^\top = \lim_{t \to \infty} (\boldsymbol{p}_0^\top P^t) = \boldsymbol{\pi}^\top
 $$
 这等价于转移矩阵的幂收敛到一个秩为1的矩阵，该矩阵的每一行都是[平稳分布](@entry_id:194199) $\boldsymbol{\pi}^\top$：
 $$
 \lim_{t \to \infty} P^t = \mathbf{1} \boldsymbol{\pi}^\top
 $$
 其中 $\mathbf{1}$ 是全1的列向量。

这个定理的数学基础是**[Perron-Frobenius定理](@entry_id:138708)** 。对于一个**[本原矩阵](@entry_id:199649)**（primitive matrix）——即存在某个幂 $P^k$ 使其所有元素都为正，这等价于不可约和非周期——该定理保证：
-   矩阵的[谱半径](@entry_id:138984)（最大特征值的模）为1。
-   特征值1是**单重**的（[代数重数](@entry_id:154240)和[几何重数](@entry_id:155584)均为1）。
-   所有其他特征值 $\lambda$ 的模都严格小于1 ($|\lambda|  1$)。
-   对应于特征值1的左[特征向量](@entry_id:151813)是唯一的（在缩放因子内），并且其所有分量都为正。这个归一化后的向量就是[平稳分布](@entry_id:194199) $\boldsymbol{\pi}^\top$。
-   对应于特征值1的右[特征向量](@entry_id:151813)是全1向量 $\mathbf{1}$（这是[行随机矩阵](@entry_id:1131129)的直接结果）。

收敛的速度由**谱隙**（spectral gap）$1 - |\lambda_2|$ 决定，其中 $|\lambda_2|$ 是第二大特征值的模。谱隙越大，收敛越快。

如果链是不可约但**周期性的**（周期 $d>1$），$P^t$ 将不会收敛。它会表现出周期性的振荡行为。然而，其**[切萨罗平均](@entry_id:146967)**（Cesàro mean）仍然会收敛到 $\mathbf{1}\boldsymbol{\pi}^\top$，表明从[时间平均](@entry_id:267915)的角度看，系统依然会趋向[平稳分布](@entry_id:194199) 。

### 可分解系统：[可约链](@entry_id:200553)与[吸收链](@entry_id:144693)

当不可约性假设不成立时，[马尔可夫链](@entry_id:150828)被称为**可约的**（reducible）。这意味着[状态空间](@entry_id:160914)可以被分解为多个部分，其中一些部分之间可能无法相互通信 。

在[可约链](@entry_id:200553)中，[状态空间](@entry_id:160914)可以被划分为**[互通类](@entry_id:267280)**（communicating classes）。
-   一个[互通类](@entry_id:267280)是**闭合的**（closed），如果一旦进入该类，就无法离开。
-   一个状态是**递归的**（recurrent），如果从该状态出发，最终必然会返回。在有限[状态空间](@entry_id:160914)中，一个闭合[互通类](@entry_id:267280)中的所有状态都是递归的。
-   一个状态是**暂态的**（transient），如果从该状态出发，存在非零概率永远不再返回。

对于[可约链](@entry_id:200553)，长期行为由其递归类决定。任何暂态状态 $\pi_i$ 在[平稳分布](@entry_id:194199)中都必须为零。[平稳分布](@entry_id:194199)的全部“质量”都集中在递归类上。
-   如果只有一个闭合递归类，系统最终会进入该类，并达到一个唯一的[平稳分布](@entry_id:194199)，该分布只在该类上非零。
-   如果有多个闭合递归类，那么最终系统会陷入哪个类取决于初始状态。在这种情况下，存在无穷多个[平稳分布](@entry_id:194199)，它们是每个递归类上定义的[平稳分布](@entry_id:194199)的任意[凸组合](@entry_id:635830)。

考虑一个6状态的链，其[状态空间](@entry_id:160914)可分解为两个[互通类](@entry_id:267280) $C_1 = \{1,2,3\}$ 和 $C_2 = \{4,5,6\}$。如果从 $C_1$ 中无法转移到 $C_2$，而从 $C_2$ 中可以转移到 $C_1$（例如 $P_{41} > 0$），那么 $C_1$ 是一个闭合递归类，而 $C_2$ 是一个暂态类。系统最终会离开 $C_2$ 并被“困在” $C_1$ 中。唯一的[平稳分布](@entry_id:194199) $\boldsymbol{\pi}^\top$ 将具有 $\pi_4=\pi_5=\pi_6=0$ 的形式，而 $(\pi_1, \pi_2, \pi_3)$ 则是通过分析 $C_1$ 内部的子链得到的归一化分布 。

**[吸收链](@entry_id:144693) (Absorbing Chains)**

这是[可约链](@entry_id:200553)的一个重要特例，其中一些递归类是单状态的**[吸收态](@entry_id:161036)**（absorbing state），即满足 $P_{ii}=1$ 的状态 。一旦进入[吸收态](@entry_id:161036)，就永远无法离开。

对于[吸收链](@entry_id:144693)，我们通常更关心两个问题：
1.  从某个暂态出发，最终被某个特定[吸收态](@entry_id:161036)吸收的概率是多少？
2.  从某个暂态出发，平均需要多少步才能被吸收？

为了回答这些问题，我们将状态重新排序，把所有 $m$ 个暂态放在前面，所有 $r$ 个[吸收态](@entry_id:161036)放在后面。转移矩阵 $P$ 就可以写成分块形式：
$$
P = \begin{pmatrix} Q  R \\ \mathbf{0}  I \end{pmatrix}
$$
其中 $Q$ 是 $m \times m$ 的暂态到暂态的[转移矩阵](@entry_id:145510)，$R$ 是 $m \times r$ 的暂态到[吸收态](@entry_id:161036)的转移矩阵，$\mathbf{0}$ 是[零矩阵](@entry_id:155836)，$I$ 是 $r \times r$ 的[单位矩阵](@entry_id:156724)。

核心工具是**[基本矩阵](@entry_id:275638)**（fundamental matrix） $N$：
$$
N = (I-Q)^{-1} = I + Q + Q^2 + \dots
$$
$N$ 的每个元素 $N_{ij}$ 给出了从暂态 $i$ 出发，在被吸收之前，平均访问暂态 $j$ 的次数。
-   **[平均吸收时间](@entry_id:276000)**：从暂态 $i$ 出发，到达任意一个[吸收态](@entry_id:161036)的平均步数 $t_i$，等于 $N$ 的第 $i$ 行元素之和：$t_i = \sum_{j=1}^m N_{ij}$。
-   **[吸收概率](@entry_id:265511)**：从暂态 $i$ 出发，最终被[吸收态](@entry_id:161036) $j$ 吸收的概率 $B_{ij}$，由矩阵乘积 $B=NR$ 给出。

例如，对于一个具有暂态 $\{1,2\}$ 和[吸收态](@entry_id:161036) $\{3,4\}$ 的系统，如果我们计算出 $Q = \begin{pmatrix} 0  2/3 \\ 1/2  0 \end{pmatrix}$ 和 $R = \begin{pmatrix} 1/3  0 \\ 0  1/2 \end{pmatrix}$，我们可以求得 $N = \begin{pmatrix} 3/2  1 \\ 3/4  3/2 \end{pmatrix}$。由此可知，从状态1出发，平均需要 $t_1 = 3/2 + 1 = 5/2$ 步才能被吸收。[吸收概率](@entry_id:265511)矩阵为 $B = NR = \begin{pmatrix} 1/2  1/2 \\ 1/4  3/4 \end{pmatrix}$，这告诉我们，从状态2出发，有 $1/4$ 的概率被状态3吸收，有 $3/4$ 的概率被状态4吸收 。