{
    "hands_on_practices": [
        {
            "introduction": "This exercise provides a foundational, step-by-step application of the map equation. By working with a small, tractable network, you will reinforce your understanding of the core components of the description length, including stationary node visit rates, module exit probabilities, and the entropies of the index and module codebooks. Calculating the change in codelength after moving a single node directly illustrates how the map equation evaluates the quality of a partition, a fundamental operation in community detection algorithms. ",
            "id": "4269520",
            "problem": "Consider an undirected, weighted network with node set $\\{A,B,C,D,E,F\\}$ and symmetric edge weights $w_{uv} = w_{vu}$ given by the following nonzero pairs:\n- $w_{AB} = 3$, $w_{AC} = 3$, $w_{BC} = 3$,\n- $w_{DE} = 3$, $w_{DF} = 3$, $w_{EF} = 3$,\n- $w_{CD} = 1$, $w_{BE} = 1$,\nand $w_{uv} = 0$ for all other pairs. Let $k_u = \\sum_{v} w_{uv}$ denote the strength (weighted degree) of node $u$, and let $m = \\sum_{\\{u,v\\}} w_{uv}$ denote the total edge weight over undirected pairs.\n\nAssume a discrete-time, memoryless random walk on this network where, at node $u$, the walker moves to neighbor $v$ with transition probability $P_{uv} = w_{uv}/k_u$. For undirected networks with these dynamics, the stationary visitation probability of node $u$ is $\\pi_u = k_u/(2m)$, and the probability of traversing the directed edge $(u \\to v)$ in stationarity is $\\pi_u P_{uv} = w_{uv}/(2m)$. Use the Shannon source coding theorem (optimal average code length equals the entropy of the source when using base-$2$ logarithms) as your foundational principle for constructing an optimal two-level description of the random walk paths induced by a given partition.\n\nDefine the partition $\\mathcal{M}$ by modules $\\mathcal{M}_1 = \\{A,B,C\\}$ and $\\mathcal{M}_2 = \\{D,E,F\\}$. Consider the two-level coding scheme that uses:\n- a module-index codebook used only when the random walk exits a module, and\n- one within-module codebook per module that includes symbols for the nodes inside the module and an additional symbol for exiting that module.\n\nStarting from the Shannon source coding theorem and the memoryless random walk dynamics specified above, derive the two-level description length $L(\\mathcal{M})$ in bits as a function of the stationary node visitation rates, inter-module exit rates, and the corresponding normalized codebook usage distributions. Evaluate $L(\\mathcal{M})$ numerically for the network and partition specified.\n\nNext, form a new partition $\\mathcal{M}'$ by moving node $C$ from $\\mathcal{M}_1$ to $\\mathcal{M}_2$, so that $\\mathcal{M}_1' = \\{A,B\\}$ and $\\mathcal{M}_2' = \\{C,D,E,F\\}$. Using the same principles, evaluate $L(\\mathcal{M}')$ for this new partition.\n\nCompute the change in description length $\\Delta L = L(\\mathcal{M}') - L(\\mathcal{M})$. Use base-$2$ logarithms and express all code lengths in bits. Round your final value of $\\Delta L$ to four significant figures. The final answer must be a single real number.",
            "solution": "The solution proceeds in four stages:\n1.  Derivation of the general formula for the description length $L(\\mathcal{M})$ from the problem's first principles.\n2.  Calculation of the fundamental properties of the given network.\n3.  Evaluation of $L(\\mathcal{M})$ for the initial partition $\\mathcal{M}$.\n4.  Evaluation of $L(\\mathcal{M}')$ for the new partition $\\mathcal{M}'$ and computation of the difference $\\Delta L = L(\\mathcal{M}') - L(\\mathcal{M})$.\n\n**1. Derivation of the Description Length $L(\\mathcal{M})$**\n\nThe problem asks to find the optimal average code length, in bits, to describe a random walk on the network, given a partition $\\mathcal{M}$ of the nodes into modules $\\{\\mathcal{M}_i\\}$. According to the Shannon source coding theorem, the minimum average code length for a source is equal to its entropy. The base of the logarithm is $2$ for a length in bits.\n\nThe coding scheme is two-level.\nFirst, a module-index codebook is used to describe movements between modules.\nSecond, for each module $\\mathcal{M}_i$, a within-module codebook describes movements inside that module, including an 'exit' symbol for leaving the module.\n\nThe total description length $L(\\mathcal{M})$ is the sum of the entropy contributions from each codebook, weighted by their usage frequency.\n\nLet $\\pi_u$ be the stationary visitation probability of node $u$, and let the probability of traversing the directed edge $(u \\to v)$ in stationarity be $\\frac{w_{uv}}{2m}$.\n\nLet $q_{i \\to}$ be the probability that a random walker, at any given step, moves from a node in module $\\mathcal{M}_i$ to a node in any other module. This is the sum of stationary probabilities of all edges crossing the boundary of $\\mathcal{M}_i$ outwards.\n$$q_{i \\to} = \\sum_{u \\in \\mathcal{M}_i, v \\notin \\mathcal{M}_i} \\frac{w_{uv}}{2m}$$\nThe total rate of inter-module movement, or a walker exiting any module, is $q_{\\text{out}} = \\sum_i q_{i \\to}$. This is the usage frequency of the module-index codebook. The symbols in this codebook correspond to the modules, and their normalized probabilities are $\\frac{q_{i \\to}}{q_{\\text{out}}}$. The entropy of this codebook is $H(\\mathcal{Q}) = - \\sum_i \\frac{q_{i \\to}}{q_{\\text{out}}} \\log_2\\left(\\frac{q_{i \\to}}{q_{\\text{out}}}\\right)$. The contribution to the total description length is:\n$$L_{\\text{inter}} = q_{\\text{out}} H(\\mathcal{Q}) = - \\sum_i q_{i \\to} \\log_2\\left(\\frac{q_{i \\to}}{q_{\\text{out}}}\\right) = q_{\\text{out}}\\log_2(q_{\\text{out}}) - \\sum_i q_{i \\to}\\log_2(q_{i \\to})$$\n\nNext, consider the codebook for a specific module $\\mathcal{M}_i$. The events described by this codebook are visits to nodes $u \\in \\mathcal{M}_i$ and exits from $\\mathcal{M}_i$. The frequency of visiting any node in $\\mathcal{M}_i$ is $p_i = \\sum_{u \\in \\mathcal{M}_i} \\pi_u$. The frequency of exiting $\\mathcal{M}_i$ is $q_{i \\to}$. The total usage rate of this codebook is $p_i + q_{i \\to}$.\nThe symbols in this codebook are a unique codeword for each node $u \\in \\mathcal{M}_i$ and one for the 'exit' event. The normalized probabilities are $\\frac{\\pi_u}{p_i + q_{i \\to}}$ and $\\frac{q_{i \\to}}{p_i + q_{i \\to}}$, respectively. The entropy of this codebook is:\n$$H(\\mathcal{P}_i) = - \\frac{q_{i \\to}}{p_i + q_{i \\to}} \\log_2\\left(\\frac{q_{i \\to}}{p_i + q_{i \\to}}\\right) - \\sum_{u \\in \\mathcal{M}_i} \\frac{\\pi_u}{p_i + q_{i \\to}} \\log_2\\left(\\frac{\\pi_u}{p_i + q_{i \\to}}\\right)$$\nThe contribution to the total description length from this module's codebook is:\n$$L_i = (p_i + q_{i \\to})H(\\mathcal{P}_i) = -q_{i \\to}\\log_2(q_{i \\to}) + (p_i+q_{i \\to})\\log_2(p_i+q_{i \\to}) - \\sum_{u \\in \\mathcal{M}_i} \\pi_u \\log_2(\\pi_u)$$\nThe total description length is $L(\\mathcal{M}) = L_{\\text{inter}} + \\sum_i L_i$.\n$$L(\\mathcal{M}) = \\left(q_{\\text{out}}\\log_2(q_{\\text{out}}) - \\sum_i q_{i \\to}\\log_2(q_{i \\to})\\right) + \\sum_i\\left(-q_{i \\to}\\log_2(q_{i \\to}) + (p_i+q_{i \\to})\\log_2(p_i+q_{i \\to}) - \\sum_{u \\in \\mathcal{M}_i} \\pi_u \\log_2(\\pi_u)\\right)$$\nCombining terms yields the map equation:\n$$L(\\mathcal{M}) = q_{\\text{out}}\\log_2(q_{\\text{out}}) - 2\\sum_i q_{i \\to}\\log_2(q_{i \\to}) + \\sum_i (p_i+q_{i \\to})\\log_2(p_i+q_{i \\to}) - \\sum_u \\pi_u\\log_2(\\pi_u)$$\n\n**2. Network Properties**\n\nFirst, we calculate the network-wide constants. The total edge weight $m$ is:\n$$m = \\sum_{\\{u,v\\}} w_{uv} = 3+3+3+3+3+3+1+1 = 20$$\nSo, $2m = 40$. The node strengths $k_u = \\sum_v w_{uv}$ are:\n- $k_A = w_{AB} + w_{AC} = 3+3 = 6$\n- $k_B = w_{BA} + w_{BC} + w_{BE} = 3+3+1 = 7$\n- $k_C = w_{CA} + w_{CB} + w_{CD} = 3+3+1 = 7$\n- $k_D = w_{DC} + w_{DE} + w_{DF} = 1+3+3 = 7$\n- $k_E = w_{EB} + w_{DE} + w_{EF} = 1+3+3 = 7$\n- $k_F = w_{DF} + w_{EF} = 3+3 = 6$\nThe stationary probabilities $\\pi_u = k_u/(2m)$ are:\n- $\\pi_A = 6/40 = 0.15$\n- $\\pi_B = 7/40 = 0.175$\n- $\\pi_C = 7/40 = 0.175$\n- $\\pi_D = 7/40 = 0.175$\n- $\\pi_E = 7/40 = 0.175$\n- $\\pi_F = 6/40 = 0.15$\n\nThe node entropy term, which is constant for the network, is:\n$H_{\\text{nodes}} = - \\sum_u \\pi_u\\log_2(\\pi_u) = - \\left[2 \\cdot \\frac{6}{40}\\log_2\\left(\\frac{6}{40}\\right) + 4 \\cdot \\frac{7}{40}\\log_2\\left(\\frac{7}{40}\\right)\\right]$\n$H_{\\text{nodes}} = - [0.3 \\log_2(0.15) + 0.7 \\log_2(0.175)] \\approx -[0.3(-2.73697) + 0.7(-2.51457)] \\approx 2.58129$ bits.\n\n**3. Evaluation of $L(\\mathcal{M})$**\n\nFor the partition $\\mathcal{M}$ with modules $\\mathcal{M}_1 = \\{A,B,C\\}$ and $\\mathcal{M}_2 = \\{D,E,F\\}$:\n- $p_1 = \\pi_A + \\pi_B + \\pi_C = \\frac{6+7+7}{40} = \\frac{20}{40} = 0.5$\n- $p_2 = \\pi_D + \\pi_E + \\pi_F = \\frac{7+7+6}{40} = \\frac{20}{40} = 0.5$\nThe inter-module edges are $(C,D)$ and $(B,E)$.\n- $q_{1 \\to} = \\frac{w_{CD} + w_{BE}}{2m} = \\frac{1+1}{40} = \\frac{2}{40} = 0.05$\n- $q_{2 \\to} = \\frac{w_{DC} + w_{EB}}{2m} = \\frac{1+1}{40} = \\frac{2}{40} = 0.05$\n- $q_{\\text{out}} = q_{1 \\to} + q_{2 \\to} = 0.05 + 0.05 = 0.1$\n- $p_1 + q_{1 \\to} = 0.5 + 0.05 = 0.55$\n- $p_2 + q_{2 \\to} = 0.5 + 0.05 = 0.55$\n\nNow we compute $L(\\mathcal{M})$:\n$L(\\mathcal{M}) = [0.1 \\log_2(0.1)] - 2[2 \\cdot (0.05 \\log_2(0.05))] + [2 \\cdot (0.55 \\log_2(0.55))] + H_{\\text{nodes}}$\n$L(\\mathcal{M}) \\approx [-0.33219] - 2[-0.43219] + [-0.94874] + [2.58129]$\n$L(\\mathcal{M}) \\approx -0.33219 + 0.86438 - 0.94874 + 2.58129 \\approx 2.16474$ bits.\n\n**4. Evaluation of $L(\\mathcal{M}')$ and $\\Delta L$**\n\nFor the partition $\\mathcal{M}'$ with modules $\\mathcal{M}'_1 = \\{A,B\\}$ and $\\mathcal{M}'_2 = \\{C,D,E,F\\}$:\n- $p'_1 = \\pi_A + \\pi_B = \\frac{6+7}{40} = \\frac{13}{40} = 0.325$\n- $p'_2 = \\pi_C + \\pi_D + \\pi_E + \\pi_F = \\frac{7+7+7+6}{40} = \\frac{27}{40} = 0.675$\nThe inter-module edges are $(A,C)$, $(B,C)$, and $(B,E)$.\n- $q'_{1 \\to} = \\frac{w_{AC} + w_{BC} + w_{BE}}{2m} = \\frac{3+3+1}{40} = \\frac{7}{40} = 0.175$\n- $q'_{2 \\to} = \\frac{w_{CA} + w_{CB} + w_{EB}}{2m} = \\frac{3+3+1}{40} = \\frac{7}{40} = 0.175$\n- $q'_{\\text{out}} = q'_{1 \\to} + q'_{2 \\to} = 0.175 + 0.175 = 0.35$\n- $p'_1 + q'_{1 \\to} = 0.325 + 0.175 = 0.5$\n- $p'_2 + q'_{2 \\to} = 0.675 + 0.175 = 0.85$\n\nNow we compute $L(\\mathcal{M}')$:\n$L(\\mathcal{M}') = [0.35 \\log_2(0.35)] - 2[2 \\cdot (0.175 \\log_2(0.175))] + [0.5 \\log_2(0.5) + 0.85 \\log_2(0.85)] + H_{\\text{nodes}}$\n$L(\\mathcal{M}') \\approx [-0.53010] - 2[-0.88010] + [-0.5 - 0.19930] + [2.58129]$\n$L(\\mathcal{M}') \\approx -0.53010 + 1.76020 - 0.69930 + 2.58129 \\approx 3.11210$ bits.\n\nFinally, we compute the change in description length, $\\Delta L$:\n$\\Delta L = L(\\mathcal{M}') - L(\\mathcal{M}) \\approx 3.11210 - 2.16474 = 0.94736$\n\nRounding the result to four significant figures gives $0.9474$. A positive $\\Delta L$ indicates that partition $\\mathcal{M}'$ is a poorer description of the network's community structure than $\\mathcal{M}$, requiring more information to describe the random walk. This is intuitive, as $\\mathcal{M}'$ breaks up the tightly-knit clique $\\{A,B,C\\}$.",
            "answer": "$$\\boxed{0.9474}$$"
        },
        {
            "introduction": "The true power of the map equation lies in its ability to capture the dynamics of flow on a network, a feature that is especially critical for directed graphs. This problem contrasts two different partitions of a directed cycle: one that is structurally symmetric and another that is aligned with the directional flow of the random walk. By computing and comparing their respective description lengths, you will gain a deeper intuition for why the map equation is a model of information flow, not merely a static clustering method. ",
            "id": "4310393",
            "problem": "Consider a directed network that exhibits strong directional bias in its flow: a four-node cycle with nodes labeled $1,2,3,4$ and directed edges $1 \\to 2 \\to 3 \\to 4 \\to 1$. Assume a random walk that follows outgoing edges deterministically at each step, and consider the long-run node visit frequencies as the stationary node visit rates. Define two candidate partitions of the network into two modules:\n- A flow-aligned partition $\\mathcal{F}$ with modules $\\{1,2\\}$ and $\\{3,4\\}$.\n- A symmetric structural partition $\\mathcal{S}$ with modules $\\{1,3\\}$ and $\\{2,4\\}$.\n\nUse the following fundamental base:\n- For a stationary random walk on a finite, irreducible directed network, the long-run visit rate $p_{i}$ at node $i$ exists and can be used as the symbol frequency in Shannon coding.\n- The expected optimal code length of a symbol source equals its Shannon entropy in natural logarithm base: for a distribution $\\{r_{j}\\}$, the entropy is $H = -\\sum_{j} r_{j} \\ln r_{j}$, measured in nats.\n- A two-level code describes the path of the random walk as follows: within each module $m$, there is a codebook for node visits in that module augmented by one special exit symbol that is emitted whenever the random walk exits the module; across modules, there is an index codebook that describes which module was exited. The total expected code length per step is the sum of the index codebook entropy weighted by the rate of exit events and the within-module codebook entropies weighted by their overall usage rates.\n\nProceed from these definitions to compute, for each partition $\\mathcal{F}$ and $\\mathcal{S}$:\n1. The stationary visit rates $p_{i}$ for all nodes, the exit event rates $q_{m}$ from each module $m$, the total exit rate $q = \\sum_{m} q_{m}$, and the within-module usage rates $p_{\\circlearrowright}^{m}$ (the sum of the visit rates of nodes in $m$ plus $q_{m}$).\n2. The entropy of the index codebook $H(Q)$, where the distribution is $\\{q_{m}/q\\}$ over modules.\n3. The entropy of each within-module codebook $H(P^{m})$, where the distribution inside module $m$ is the normalized list of the visit rates of the nodes in $m$ and the exit rate $q_{m}$.\n4. The expected code length per step $L(\\mathcal{F})$ and $L(\\mathcal{S})$ as the sum of the index-code contribution $q\\,H(Q)$ and the within-module contributions $\\sum_{m} p_{\\circlearrowright}^{m} H(P^{m})$.\n\nFinally, quantify how the strong directional bias favors flow-aligned modules by computing the codelength difference\n$$\n\\Delta L \\equiv L(\\mathcal{S}) - L(\\mathcal{F})\n$$\nas a closed-form analytical expression in terms of natural logarithms. Express the final codelength difference in nats. No rounding is required; provide the exact expression.",
            "solution": "The solution proceeds by first determining the stationary state of the system, then analyzing each partition ($\\mathcal{F}$ and $\\mathcal{S}$) according to the provided formulas, and finally calculating their difference.\n\n**1. Stationary Node Visit Rates**\nThe network is a simple deterministic cycle $1 \\to 2 \\to 3 \\to 4 \\to 1$. A random walker starting at any node will visit all other nodes in a fixed sequence, repeating the cycle indefinitely. Over a long period, each of the four nodes will be visited with equal frequency. Therefore, the stationary visit rate $p_i$ for each node $i$ is:\n$$\np_1 = p_2 = p_3 = p_4 = \\frac{1}{4}\n$$\n\n**2. Analysis of the Flow-Aligned Partition $\\mathcal{F} = \\{\\{1,2\\}, \\{3,4\\}\\}$**\nLet $M_1 = \\{1,2\\}$ and $M_2 = \\{3,4\\}$.\n\n-   **Exit Rates ($q_m$) and Total Exit Rate ($q$):**\n    An exit from a module occurs when the walker moves from a node inside the module to a node outside.\n    -   For module $M_1$, the only edge leading out is $2 \\to 3$. This transition happens whenever the walker is at node $2$. The rate of this event is thus the visit rate of node $2$.\n        $$\n        q_{M_1} = p_2 = \\frac{1}{4}\n        $$\n    -   For module $M_2$, the only edge leading out is $4 \\to 1$. This transition happens at a rate equal to the visit rate of node $4$.\n        $$\n        q_{M_2} = p_4 = \\frac{1}{4}\n        $$\n    -   The total exit rate for partition $\\mathcal{F}$ is the sum of the individual exit rates:\n        $$\n        q^{(\\mathcal{F})} = q_{M_1} + q_{M_2} = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}\n        $$\n\n-   **Within-Module Usage Rates ($p_{\\circlearrowright}^{m}$):**\n    Following the problem's definition, $p_{\\circlearrowright}^{m} = (\\sum_{i \\in m} p_i) + q_m$.\n    -   For $M_1$: $p_{\\circlearrowright}^{M_1} = (p_1 + p_2) + q_{M_1} = (\\frac{1}{4} + \\frac{1}{4}) + \\frac{1}{4} = \\frac{3}{4}$.\n    -   For $M_2$: $p_{\\circlearrowright}^{M_2} = (p_3 + p_4) + q_{M_2} = (\\frac{1}{4} + \\frac{1}{4}) + \\frac{1}{4} = \\frac{3}{4}$.\n\n-   **Entropies ($H(Q)$ and $H(P^m)$):**\n    -   **Index Codebook Entropy $H(Q^{(\\mathcal{F})})$:** The distribution over modules is $\\{q_{M_1}/q^{(\\mathcal{F})}, q_{M_2}/q^{(\\mathcal{F})}\\} = \\{(\\frac{1}{4})/(\\frac{1}{2}), (\\frac{1}{4})/(\\frac{1}{2})\\} = \\{\\frac{1}{2}, \\frac{1}{2}\\}$.\n        $$\n        H(Q^{(\\mathcal{F})}) = -\\left(\\frac{1}{2}\\ln\\left(\\frac{1}{2}\\right) + \\frac{1}{2}\\ln\\left(\\frac{1}{2}\\right)\\right) = - \\ln\\left(\\frac{1}{2}\\right) = \\ln 2\n        $$\n    -   **Within-Module Codebook Entropies $H(P^{M_1})$ and $H(P^{M_2})$:**\n        For $M_1$, the codebook describes visits to nodes $1$ and $2$, and exits from $M_1$. The unnormalized rates are $\\{p_1, p_2, q_{M_1}\\} = \\{\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4}\\}$. The normalization constant is their sum, $\\frac{3}{4}$. The normalized distribution is $\\{\\frac{1/4}{3/4}, \\frac{1/4}{3/4}, \\frac{1/4}{3/4}\\} = \\{\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3}\\}$.\n        $$\n        H(P^{M_1}) = -\\left(\\frac{1}{3}\\ln\\left(\\frac{1}{3}\\right) + \\frac{1}{3}\\ln\\left(\\frac{1}{3}\\right) + \\frac{1}{3}\\ln\\left(\\frac{1}{3}\\right)\\right) = -\\ln\\left(\\frac{1}{3}\\right) = \\ln 3\n        $$\n        By symmetry, the calculation for $M_2$ is identical: $H(P^{M_2}) = \\ln 3$.\n\n-   **Total Codelength $L(\\mathcal{F})$:**\n    $$\n    L(\\mathcal{F}) = q^{(\\mathcal{F})}H(Q^{(\\mathcal{F})}) + p_{\\circlearrowright}^{M_1}H(P^{M_1}) + p_{\\circlearrowright}^{M_2}H(P^{M_2})\n    $$\n    $$\n    L(\\mathcal{F}) = \\left(\\frac{1}{2}\\right)\\ln 2 + \\left(\\frac{3}{4}\\right)\\ln 3 + \\left(\\frac{3}{4}\\right)\\ln 3 = \\frac{1}{2}\\ln 2 + \\frac{3}{2}\\ln 3\n    $$\n\n**3. Analysis of the Symmetric Partition $\\mathcal{S} = \\{\\{1,3\\}, \\{2,4\\}\\}$**\nLet $N_1 = \\{1,3\\}$ and $N_2 = \\{2,4\\}$.\n\n-   **Exit Rates ($q_m$) and Total Exit Rate ($q$):**\n    -   For module $N_1$, exits occur on edges $1 \\to 2$ and $3 \\to 4$. Both transitions lead to nodes in $N_2$.\n        $$\n        q_{N_1} = p_1 + p_3 = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}\n        $$\n    -   For module $N_2$, exits occur on edges $2 \\to 3$ and $4 \\to 1$. Both transitions lead to nodes in $N_1$.\n        $$\n        q_{N_2} = p_2 + p_4 = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}\n        $$\n    -   The total exit rate for partition $\\mathcal{S}$ is:\n        $$\n        q^{(\\mathcal{S})} = q_{N_1} + q_{N_2} = \\frac{1}{2} + \\frac{1}{2} = 1\n        $$\n        A total exit rate of $1$ means that the walker switches modules at every step.\n\n-   **Within-Module Usage Rates ($p_{\\circlearrowright}^{m}$):**\n    -   For $N_1$: $p_{\\circlearrowright}^{N_1} = (p_1 + p_3) + q_{N_1} = (\\frac{1}{2}) + \\frac{1}{2} = 1$.\n    -   For $N_2$: $p_{\\circlearrowright}^{N_2} = (p_2 + p_4) + q_{N_2} = (\\frac{1}{2}) + \\frac{1}{2} = 1$.\n\n-   **Entropies ($H(Q)$ and $H(P^m)$):**\n    -   **Index Codebook Entropy $H(Q^{(\\mathcal{S})})$:** The distribution is $\\{q_{N_1}/q^{(\\mathcal{S})}, q_{N_2}/q^{(\\mathcal{S})}\\} = \\{(\\frac{1}{2})/1, (\\frac{1}{2})/1\\} = \\{\\frac{1}{2}, \\frac{1}{2}\\}$.\n        $$\n        H(Q^{(\\mathcal{S})}) = \\ln 2\n        $$\n    -   **Within-Module Codebook Entropies $H(P^{N_1})$ and $H(P^{N_2})$:**\n        For $N_1$, the unnormalized rates are $\\{p_1, p_3, q_{N_1}\\} = \\{\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{2}\\}$. The sum is $1$, so this is already the normalized distribution.\n        $$\n        H(P^{N_1}) = -\\left(\\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) + \\frac{1}{4}\\ln\\left(\\frac{1}{4}\\right) + \\frac{1}{2}\\ln\\left(\\frac{1}{2}\\right)\\right)\n        $$\n        $$\n        H(P^{N_1}) = -\\left(2 \\cdot \\frac{1}{4}(-\\ln 4) + \\frac{1}{2}(-\\ln 2)\\right) = -\\left(-\\frac{1}{2}\\ln(2^2) - \\frac{1}{2}\\ln 2\\right) = \\frac{1}{2}(2\\ln 2) + \\frac{1}{2}\\ln 2 = \\frac{3}{2}\\ln 2\n        $$\n        By symmetry, the calculation for $N_2$ is identical: $H(P^{N_2}) = \\frac{3}{2}\\ln 2$.\n\n-   **Total Codelength $L(\\mathcal{S})$:**\n    $$\n    L(\\mathcal{S}) = q^{(\\mathcal{S})}H(Q^{(\\mathcal{S})}) + p_{\\circlearrowright}^{N_1}H(P^{N_1}) + p_{\\circlearrowright}^{N_2}H(P^{N_2})\n    $$\n    $$\n    L(\\mathcal{S}) = (1)\\ln 2 + (1)\\left(\\frac{3}{2}\\ln 2\\right) + (1)\\left(\\frac{3}{2}\\ln 2\\right) = \\ln 2 + 3\\ln 2 = 4\\ln 2\n    $$\n\n**4. Codelength Difference $\\Delta L$**\nThe final step is to compute the difference $\\Delta L = L(\\mathcal{S}) - L(\\mathcal{F})$.\n$$\n\\Delta L = 4\\ln 2 - \\left(\\frac{1}{2}\\ln 2 + \\frac{3}{2}\\ln 3\\right)\n$$\n$$\n\\Delta L = \\left(4 - \\frac{1}{2}\\right)\\ln 2 - \\frac{3}{2}\\ln 3\n$$\n$$\n\\Delta L = \\frac{7}{2}\\ln 2 - \\frac{3}{2}\\ln 3\n$$\nThis positive value indicates that the codelength for the symmetric partition $\\mathcal{S}$ is greater than for the flow-aligned partition $\\mathcal{F}$, confirming that $\\mathcal{F}$ provides a more compressed description of the information flow on the network.",
            "answer": "$$\n\\boxed{\\frac{7}{2}\\ln 2 - \\frac{3}{2}\\ln 3}\n$$"
        },
        {
            "introduction": "Moving from theory to implementation, this practice explores the computational core of map equation-based optimization algorithms. You will first derive the analytical expression for the local change in description length, $\\Delta L$, when a single node is moved between modules, which is the key calculation performed in greedy optimization heuristics like the Louvain method or Infomap. Applying this formula to a concrete example will demonstrate how local, iterative improvements can be used to search for an optimal network partition that minimizes the overall codelength. ",
            "id": "4310301",
            "problem": "Consider a connected, finite network and a memoryless random walk on its nodes. Let $w_{\\alpha\\beta}$ denote the nonnegative weight of the undirected edge between node $\\alpha$ and node $\\beta$, with $w_{\\alpha\\beta} = w_{\\beta\\alpha}$ and $w_{\\alpha\\alpha} = 0$. Define the strength of node $\\alpha$ as $w_{\\alpha} = \\sum_{\\beta} w_{\\alpha\\beta}$ and the total weight $W = \\sum_{\\alpha} w_{\\alpha}$. For the random walk that chooses the next step from node $\\alpha$ proportionally to $\\{w_{\\alpha\\beta}\\}_{\\beta}$, the stationary visit rate is $p_{\\alpha} = w_{\\alpha}/W$. For a given partition of the nodes into modules $\\{M_{i}\\}$, the exit rate from module $i$ is $q_{i} = \\frac{1}{W} \\sum_{\\alpha \\in M_{i}} \\sum_{\\beta \\notin M_{i}} w_{\\alpha\\beta}$, and the usage rate of module $i$â€™s codebook is $p_{i} = q_{i} + \\sum_{\\alpha \\in M_{i}} p_{\\alpha}$. Let $q = \\sum_{i} q_{i}$.\n\nThe two-level Map Equation, which gives the average description length of the random walk under this partition, is $L = q H(Q) + \\sum_{i} p_{i} H(P_{i})$, where $H(Q)$ is the Shannon entropy of the distribution $\\{q_{i}/q\\}$ over module exits, and $H(P_{i})$ is the Shannon entropy of the distribution consisting of the node visit rates $\\{p_{\\alpha}/p_{i}\\}_{\\alpha \\in M_{i}}$ augmented by the exit event $q_{i}/p_{i}$ in module $i$. All logarithms are natural logarithms.\n\nTask 1 (derivation): Starting from the above definitions, derive an exact expression for the local codelength change $\\Delta L$ when moving a single node $x$ from module $i$ to module $j$. Your expression must be written only in terms of the pre-move quantities $q$, $q_{i}$, $q_{j}$, $p_{i}$, $p_{j}$ and their post-move changes $\\Delta q_{i}$, $\\Delta q_{j}$, $\\Delta p_{i}$, $\\Delta p_{j}$, with no dependence on other modules. Clearly express $\\Delta L$ as a closed-form analytic expression.\n\nTask 2 (application and local step design): Consider the undirected weighted network with nodes $\\{a,b,c\\}$ and weights $w_{ab} = 2$, $w_{ac} = 1$, $w_{bc} = 1$ (and $w_{\\alpha\\beta} = 0$ for all other pairs). Initially, the partition is $M_{i} = \\{a,b\\}$ and $M_{j} = \\{c\\}$. Use your derived expression to compute the exact local codelength change $\\Delta L$ when moving node $b$ from module $i$ to module $j$. Based on the sign of $\\Delta L$, explain the local improvement step one would implement to reduce the description length using only node moves. Provide the numerical value of $\\Delta L$ rounded to six significant figures. No physical units are required.",
            "solution": "The solution is divided into two parts as requested: first, the derivation of the change in codelength $\\Delta L$, and second, the application of this formula to a specific network.\n\n### Task 1: Derivation of the Codelength Change $\\Delta L$\n\nThe two-level Map Equation can be expanded from its definition into a form that is more convenient for calculating changes. The full derivation gives:\n$$L = q \\ln q - 2\\sum_k q_k \\ln q_k + \\sum_k p_k \\ln p_k - \\sum_{\\alpha} p_\\alpha \\ln p_\\alpha$$\nThe term $\\sum_{\\alpha} p_\\alpha \\ln p_\\alpha$ is a constant with respect to the partitioning of nodes, as the set of nodes and their stationary visit rates $\\{p_\\alpha\\}$ are fixed. Therefore, when calculating the change in codelength $\\Delta L$, this term will cancel out.\n\nLet $L$ be the codelength for the initial partition and $L'$ be the codelength after moving node $x$ from module $i$ to module $j$. The change in codelength is $\\Delta L = L' - L$. When a single node is moved, only the properties of the source module $i$, the destination module $j$, and the total exit rate $q$ are altered. The properties of all other modules $k \\neq i,j$ remain unchanged, so their terms in the summation cancel out. The change $\\Delta L$ is therefore:\n$$ \\Delta L = (q' \\ln q' - q \\ln q) - 2 \\sum_{k \\in \\{i,j\\}} (q'_k \\ln q'_k - q_k \\ln q_k) + \\sum_{k \\in \\{i,j\\}} (p'_k \\ln p'_k - p_k \\ln p_k) $$\nWe can define the changes as $\\Delta q_k = q'_k - q_k$ and $\\Delta p_k = p'_k - p_k$. The total exit rate change is $\\Delta q = q' - q = \\Delta q_i + \\Delta q_j$. The post-move quantities can be written as $q'_k = q_k + \\Delta q_k$ and $p'_k = p_k + \\Delta p_k$.\n\nSubstituting these into the expression for $\\Delta L$ yields the desired closed-form expression in terms of pre-move quantities and their changes:\n$$ \\Delta L = \\left((q + \\Delta q_i + \\Delta q_j) \\ln(q + \\Delta q_i + \\Delta q_j) - q \\ln q\\right) $$\n$$ - 2\\left((q_i + \\Delta q_i) \\ln(q_i + \\Delta q_i) - q_i \\ln q_i\\right) $$\n$$ - 2\\left((q_j + \\Delta q_j) \\ln(q_j + \\Delta q_j) - q_j \\ln q_j\\right) $$\n$$ + \\left((p_i + \\Delta p_i) \\ln(p_i + \\Delta p_i) - p_i \\ln p_i\\right) $$\n$$ + \\left((p_j + \\Delta p_j) \\ln(p_j + \\Delta p_j) - p_j \\ln p_j\\right) $$\n\n### Task 2: Application and Local Step Design\n\nWe are given a network with nodes $\\{a,b,c\\}$ and weights $w_{ab} = 2$, $w_{ac} = 1$, $w_{bc} = 1$. The initial partition is $M_{i} = \\{a,b\\}$ and $M_{j} = \\{c\\}$. We are to compute $\\Delta L$ for moving node $b$ from $M_i$ to $M_j$.\n\nFirst, we compute the basic network properties:\nNode strengths:\n$w_{a} = w_{ab} + w_{ac} = 2 + 1 = 3$.\n$w_{b} = w_{ba} + w_{bc} = 2 + 1 = 3$.\n$w_{c} = w_{ca} + w_{cb} = 1 + 1 = 2$.\nTotal weight: $W = w_a + w_b + w_c = 3 + 3 + 2 = 8$.\nStationary visit rates:\n$p_{a} = w_a/W = 3/8$.\n$p_{b} = w_b/W = 3/8$.\n$p_{c} = w_c/W = 2/8 = 1/4$.\n\nNext, we compute the pre-move partition-dependent quantities:\n$M_i=\\{a,b\\}$, $M_j=\\{c\\}$.\nExit rate from $M_i$: $q_i = \\frac{1}{W} (w_{ac} + w_{bc}) = \\frac{1}{8}(1+1) = \\frac{2}{8} = \\frac{1}{4}$.\nExit rate from $M_j$: $q_j = \\frac{1}{W} (w_{ca} + w_{cb}) = \\frac{1}{8}(1+1) = \\frac{2}{8} = \\frac{1}{4}$.\nTotal exit rate: $q = q_i + q_j = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}$.\nModule codebook usage rates:\n$p_i = q_i + p_a + p_b = \\frac{1}{4} + \\frac{3}{8} + \\frac{3}{8} = \\frac{2+3+3}{8} = \\frac{8}{8} = 1$.\n$p_j = q_j + p_c = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}$.\n\nNow, we compute the changes resulting from moving node $b$ from $M_i$ to $M_j$. The new partition is $M'_i=\\{a\\}, M'_j=\\{b,c\\}$.\nFirst, we calculate the new partition-dependent quantities:\n$q'_i = (w_{ab} + w_{ac}) / W = (2+1)/8 = 3/8$.\n$q'_j = (w_{ba} + w_{ca}) / W = (2+1)/8 = 3/8$.\n\nFrom these, we find the changes:\n$\\Delta q_i = q'_i - q_i = 3/8 - 1/4 = 1/8$.\n$\\Delta q_j = q'_j - q_j = 3/8 - 1/4 = 1/8$.\n\nThe changes in codebook usage rates follow from the stationary visit rate of the moved node, $p_b = 3/8$:\n$\\Delta p_i = \\Delta q_i - p_b = 1/8 - 3/8 = -2/8 = -1/4$.\n$\\Delta p_j = \\Delta q_j + p_b = 1/8 + 3/8 = 4/8 = 1/2$.\n\nWe now have all the components to calculate $\\Delta L$.\nPre-move values: $q=1/2$, $q_i=1/4$, $q_j=1/4$, $p_i=1$, $p_j=1/2$.\nPost-move values:\n$q' = q + \\Delta q_i + \\Delta q_j = \\frac{1}{2} + \\frac{1}{8} + \\frac{1}{8} = \\frac{3}{4}$.\n$q'_i = q_i + \\Delta q_i = \\frac{1}{4} + \\frac{1}{8} = \\frac{3}{8}$.\n$q'_j = q_j + \\Delta q_j = \\frac{1}{4} + \\frac{1}{8} = \\frac{3}{8}$.\n$p'_i = p_i + \\Delta p_i = 1 - \\frac{1}{4} = \\frac{3}{4}$.\n$p'_j = p_j + \\Delta p_j = \\frac{1}{2} + \\frac{1}{2} = 1$.\n\nSubstitute these into the expression for $\\Delta L$:\n$\\Delta L = (q' \\ln q' - q \\ln q) - 2(q'_i \\ln q'_i - q_i \\ln q_i) - 2(q'_j \\ln q'_j - q_j \\ln q_j) + (p'_i \\ln p'_i - p_i \\ln p_i) + (p'_j \\ln p'_j - p_j \\ln p_j)$\n$\\Delta L = \\left(\\frac{3}{4}\\ln\\frac{3}{4} - \\frac{1}{2}\\ln\\frac{1}{2}\\right) - 2\\left(\\frac{3}{8}\\ln\\frac{3}{8} - \\frac{1}{4}\\ln\\frac{1}{4}\\right) - 2\\left(\\frac{3}{8}\\ln\\frac{3}{8} - \\frac{1}{4}\\ln\\frac{1}{4}\\right) + \\left(\\frac{3}{4}\\ln\\frac{3}{4} - 1\\ln 1\\right) + \\left(1\\ln 1 - \\frac{1}{2}\\ln\\frac{1}{2}\\right)$\nSince $\\ln 1=0$:\n$\\Delta L = 2\\left(\\frac{3}{4}\\ln\\frac{3}{4}\\right) - 2\\left(\\frac{1}{2}\\ln\\frac{1}{2}\\right) - 4\\left(\\frac{3}{8}\\ln\\frac{3}{8}\\right) + 4\\left(\\frac{1}{4}\\ln\\frac{1}{4}\\right)$\n$\\Delta L = \\frac{3}{2}\\ln\\frac{3}{4} - \\ln\\frac{1}{2} - \\frac{3}{2}\\ln\\frac{3}{8} + \\ln\\frac{1}{4}$\nUsing logarithm properties $\\ln(a/b) = \\ln a - \\ln b$ and $\\ln(2^n) = n\\ln 2$:\n$\\Delta L = \\frac{3}{2}(\\ln 3 - \\ln 4) - (-\\ln 2) - \\frac{3}{2}(\\ln 3 - \\ln 8) + (-\\ln 4)$\n$\\Delta L = \\frac{3}{2}\\ln 3 - \\frac{3}{2}(2\\ln 2) + \\ln 2 - \\frac{3}{2}\\ln 3 + \\frac{3}{2}(3\\ln 2) - 2\\ln 2$\n$\\Delta L = \\frac{3}{2}\\ln 3 - 3\\ln 2 + \\ln 2 - \\frac{3}{2}\\ln 3 + \\frac{9}{2}\\ln 2 - 2\\ln 2$\nGrouping the terms:\n$\\Delta L = \\left(\\frac{3}{2} - \\frac{3}{2}\\right)\\ln 3 + \\left(-3+1+\\frac{9}{2}-2\\right)\\ln 2 = 0 + \\left(-4 + \\frac{9}{2}\\right)\\ln 2 = \\frac{1}{2}\\ln 2$.\n\nThe exact codelength change is $\\Delta L = \\frac{1}{2}\\ln 2$. The numerical value is:\n$\\Delta L \\approx \\frac{1}{2} \\times 0.69314718 \\approx 0.34657359$.\nRounded to six significant figures, $\\Delta L \\approx 0.346574$.\n\nRegarding the local improvement step: The goal of community detection with the Map Equation is to find a network partition that minimizes the description length $L$. Optimization algorithms, such as the Louvain method, achieve this by iteratively performing local \"improvement\" steps. An improvement step consists of moving a node from one module to another if and only if the move results in a decrease in $L$, i.e., if $\\Delta L  0$.\n\nIn this case, the calculated change is $\\Delta L \\approx 0.346574 > 0$. This means that moving node $b$ from module $\\{a,b\\}$ to module $\\{c\\}$ increases the codelength, making the description of the random walk less efficient. Therefore, this move is not an improvement. The correct local step to implement is to **reject** this proposed move and retain the original partition $M_i = \\{a,b\\}, M_j = \\{c\\}$. The optimization algorithm would then proceed to test other possible node moves in search of one that yields a negative $\\Delta L$.",
            "answer": "$$\\boxed{0.346574}$$"
        }
    ]
}