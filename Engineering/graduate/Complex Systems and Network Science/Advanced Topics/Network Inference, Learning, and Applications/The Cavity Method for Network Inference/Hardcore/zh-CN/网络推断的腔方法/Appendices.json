{
    "hands_on_practices": [
        {
            "introduction": "本练习是空腔法的基本功。我们将为伊辛（Ising）模型推导贝特（Bethe）自由能，它是置信传播（Belief Propagation）算法试图最小化的变分目标函数。完成此推导有助于巩固对自由能两个关键组成部分的理解：基于局部置信度的平均能量，以及在有环图上经过重叠计数校正的近似熵 。",
            "id": "4308272",
            "problem": "考虑一个无向、局部树状网络（图）$G=(V,E)$，其节点 $i \\in V$ 上有二元伊辛变量 $x_i \\in \\{-1,+1\\}$。其能量是成对贡献和一元贡献之和，其中成对能量为 $E_{ij}(x_i,x_j) = - J_{ij} x_i x_j$（对于 $(i,j) \\in E$），一元能量为 $E_i(x_i) = - h_i x_i$（对于 $i \\in V$），$J_{ij}$ 是对称耦合，$h_i$ 是外场。令 $T$ 表示以能量单位计量的绝对温度（玻尔兹曼常数 $k_B$ 设为 $1$）。\n\n在空穴方法中，贝特近似通过满足归一化和边际一致性的边信念和节点信念来表示平衡分布。令节点信念为 $b_i(x_i)$，边信念为 $b_{ij}(x_i,x_j)$，使得对于所有 $(i,j)\\in E$，都有 $\\sum_{x_i} b_i(x_i)=1$、$\\sum_{x_i,x_j} b_{ij}(x_i,x_j)=1$ 和 $\\sum_{x_j} b_{ij}(x_i,x_j)=b_i(x_i)$。使用节点磁化强度 $m_i = \\sum_{x_i} x_i\\, b_i(x_i)$ 和边相关性 $c_{ij} = \\sum_{x_i,x_j} x_i x_j\\, b_{ij}(x_i,x_j)$ 对信念进行参数化：\n$$\nb_i(x_i) = \\frac{1 + m_i x_i}{2}, \\quad\nb_{ij}(x_i,x_j) = \\frac{1}{4}\\left( 1 + m_i x_i + m_j x_j + c_{ij} x_i x_j \\right).\n$$\n贝特熵通过带有度数校正的边和节点贡献来近似：对于图 $G$ 中节点度为 $d_i$ 的情况，$S_{\\mathrm{Bethe}} \\approx \\sum_{(i,j)\\in E} S[b_{ij}] - \\sum_{i\\in V} (d_i - 1) S[b_i]$，其中 $S[b] = - \\sum p \\ln p$ 是香农熵（自然对数）。\n\n从平衡自由能的基本定义 $F = \\langle E \\rangle - T S$ 和上述贝特熵近似出发，推导出贝特自由能 $F_{\\mathrm{Bethe}}$，使其成为一个关于 $\\{J_{ij}\\}$、$\\{h_i\\}$、$T$、$\\{m_i\\}$ 和 $\\{c_{ij}\\}$ 的单一、显式解析表达式。您的表达式必须通过将信念参数化代入能量项和熵项中，以闭式形式指定所有分量。将对 $x_i$ 和 $(x_i,x_j)$ 的求和显式地表示为对 $x_i = \\pm 1$ 和 $(x_i,x_j) = (\\pm 1, \\pm 1)$ 的求和。不需要进行数值计算或舍入。",
            "solution": "用户希望推导图上伊辛模型的贝特自由能。\n\n### **问题验证**\n\n**1. 提取已知条件：**\n\n*   **系统：** 一个无向、局部树状图 $G=(V,E)$，其每个节点 $i \\in V$ 上有二元伊辛变量 $x_i \\in \\{-1, +1\\}$。\n*   **能量函数：** 总能量为 $E = \\sum_{(i,j) \\in E} E_{ij}(x_i, x_j) + \\sum_{i \\in V} E_i(x_i)$，其中成对能量为 $E_{ij}(x_i,x_j) = - J_{ij} x_i x_j$，一元能量为 $E_i(x_i) = - h_i x_i$。耦合 $J_{ij}$ 是对称的。\n*   **温度：** $T$，玻尔兹曼常数 $k_B=1$。\n*   **信念参数化：**\n    *   节点信念：$b_i(x_i) = \\frac{1 + m_i x_i}{2}$，其中 $m_i$ 是节点磁化强度。\n    *   边信念：$b_{ij}(x_i,x_j) = \\frac{1}{4}\\left( 1 + m_i x_i + m_j x_j + c_{ij} x_i x_j \\right)$，其中 $c_{ij}$ 是边相关性。\n*   **自由能定义：** $F = \\langle E \\rangle - T S$。\n*   **贝特熵近似：** $S_{\\mathrm{Bethe}} \\approx \\sum_{(i,j)\\in E} S[b_{ij}] - \\sum_{i\\in V} (d_i - 1) S[b_i]$，其中 $d_i$ 是节点 $i$ 的度，$S[b] = - \\sum_{k} p_k \\ln p_k$ 是香农熵。\n*   **任务：** 将贝特自由能 $F_{\\mathrm{Bethe}}$ 推导为关于 $\\{J_{ij}\\}, \\{h_i\\}, T, \\{m_i\\}$ 和 $\\{c_{ij}\\}$ 的单一、显式解析表达式，并将所有对自旋态的求和明确写出。\n\n**2. 使用提取的已知条件进行验证：**\n\n*   **科学依据：** 该问题牢固地植根于统计物理学，特别是关于网络上无序系统的研究。伊辛模型、自由能和贝特-派尔斯近似（空穴方法的一个特例）都是该领域中的标准和基本概念。\n*   **适定性：** 问题是适定的。它要求基于所提供的定义和近似进行直接的代数推导。所有必要的组成部分都已给出，并且推导会得出一个唯一的解析表达式。\n*   **客观性：** 问题以精确、客观的数学语言陈述，没有任何主观或模糊的术语。\n*   **缺陷检查清单：**\n    1.  **科学谬误：** 无。该框架是标准的统计力学。\n    2.  **不相关性：** 无。该问题是空穴方法的核心。\n    3.  **不完整/矛盾：** 无。信念参数化是自洽且正确归一化的，因为 $\\sum_{x_i} b_i(x_i) = \\frac{1+m_i}{2} + \\frac{1-m_i}{2} = 1$，并且边际一致性 $\\sum_{x_j} b_{ij}(x_i,x_j) = b_i(x_i)$ 也由给定形式满足。\n    4.  **不可行性：** 无。这是一个标准的理论计算。\n    5.  **不适定性：** 无。可以推导出唯一答案。\n    6.  **无价值（过于简单）：** 无。推导过程不简单，需要仔细的代数操作。\n    7.  **不可验证性：** 无。数学推导是可验证的。\n\n**3. 结论与行动：**\n\n*   **结论：** 问题是**有效的**。\n*   **行动：** 继续推导解决方案。\n\n### **贝特自由能的推导**\n\n贝特自由能 $F_{\\mathrm{Bethe}}$ 定义为：\n$$\nF_{\\mathrm{Bethe}} = \\langle E \\rangle_{\\mathrm{Bethe}} - T S_{\\mathrm{Bethe}}\n$$\n我们将分别计算平均能量 $\\langle E \\rangle_{\\mathrm{Bethe}}$ 和贝特熵 $S_{\\mathrm{Bethe}}$。\n\n**1. 平均能量 $\\langle E \\rangle_{\\mathrm{Bethe}}$**\n\n总能量为 $E = - \\sum_{(i,j) \\in E} J_{ij} x_i x_j - \\sum_{i \\in V} h_i x_i$。平均能量是通过对信念求期望值得到的。局部函数的期望值是使用相应的局部信念计算的。\n\n对于边 $(i, j)$ 的成对能量项的平均值为：\n$$\n\\langle E_{ij} \\rangle = \\sum_{x_i, x_j} E_{ij}(x_i, x_j) b_{ij}(x_i, x_j) = \\sum_{x_i, x_j} (-J_{ij} x_i x_j) b_{ij}(x_i, x_j) = -J_{ij} \\sum_{x_i, x_j} x_i x_j b_{ij}(x_i, x_j)\n$$\n根据定义，边相关性为 $c_{ij} = \\sum_{x_i, x_j} x_i x_j b_{ij}(x_i, x_j)$。因此：\n$$\n\\langle E_{ij} \\rangle = -J_{ij} c_{ij}\n$$\n\n对于节点 $i$ 的一元能量项的平均值为：\n$$\n\\langle E_{i} \\rangle = \\sum_{x_i} E_{i}(x_i) b_{i}(x_i) = \\sum_{x_i} (-h_i x_i) b_{i}(x_i) = -h_i \\sum_{x_i} x_i b_{i}(x_i)\n$$\n根据定义，节点磁化强度为 $m_i = \\sum_{x_i} x_i b_{i}(x_i)$。因此：\n$$\n\\langle E_{i} \\rangle = -h_i m_i\n$$\n\n对所有边和节点求和，总平均能量为：\n$$\n\\langle E \\rangle_{\\mathrm{Bethe}} = - \\sum_{(i,j) \\in E} J_{ij} c_{ij} - \\sum_{i \\in V} h_i m_i\n$$\n\n**2. 贝特熵 $S_{\\mathrm{Bethe}}$**\n\n贝特熵近似由下式给出：\n$$\nS_{\\mathrm{Bethe}} = \\sum_{(i,j)\\in E} S[b_{ij}] - \\sum_{i\\in V} (d_i - 1) S[b_i]\n$$\n其中 $S[b] = - \\sum_{k} p_k \\ln p_k$。\n\n首先，我们计算节点熵 $S[b_i]$。$x_i$ 的两个状态的概率为 $b_i(+1) = \\frac{1+m_i}{2}$ 和 $b_i(-1) = \\frac{1-m_i}{2}$。\n$$\nS[b_i] = - \\sum_{x_i \\in \\{-1, +1\\}} b_i(x_i) \\ln b_i(x_i) = - \\left[ \\left(\\frac{1+m_i}{2}\\right) \\ln\\left(\\frac{1+m_i}{2}\\right) + \\left(\\frac{1-m_i}{2}\\right) \\ln\\left(\\frac{1-m_i}{2}\\right) \\right]\n$$\n\n接下来，我们计算边熵 $S[b_{ij}]$。$(x_i, x_j)$ 的四个状态的概率为：\n$b_{ij}(+1,+1) = \\frac{1}{4}(1 + m_i + m_j + c_{ij})$\n$b_{ij}(+1,-1) = \\frac{1}{4}(1 + m_i - m_j - c_{ij})$\n$b_{ij}(-1,+1) = \\frac{1}{4}(1 - m_i + m_j - c_{ij})$\n$b_{ij}(-1,-1) = \\frac{1}{4}(1 - m_i - m_j + c_{ij})$\n\n边熵为：\n$$\nS[b_{ij}] = - \\sum_{(x_i, x_j) \\in \\{(\\pm 1, \\pm 1)\\}} b_{ij}(x_i, x_j) \\ln b_{ij}(x_i, x_j)\n$$\n具体来说，就是：\n\\begin{align*}\nS[b_{ij}] = - \\Big[  \\left(\\frac{1+m_i+m_j+c_{ij}}{4}\\right) \\ln\\left(\\frac{1+m_i+m_j+c_{ij}}{4}\\right) \\\\\n + \\left(\\frac{1+m_i-m_j-c_{ij}}{4}\\right) \\ln\\left(\\frac{1+m_i-m_j-c_{ij}}{4}\\right) \\\\\n + \\left(\\frac{1-m_i+m_j-c_{ij}}{4}\\right) \\ln\\left(\\frac{1-m_i+m_j-c_{ij}}{4}\\right) \\\\\n + \\left(\\frac{1-m_i-m_j+c_{ij}}{4}\\right) \\ln\\left(\\frac{1-m_i-m_j+c_{ij}}{4}\\right) \\Big]\n\\end{align*}\n\n**3. 组合贝特自由能**\n\n现在我们将 $\\langle E \\rangle_{\\mathrm{Bethe}}$ 和 $S_{\\mathrm{Bethe}}$ 的表达式代入自由能公式：\n$$\nF_{\\mathrm{Bethe}} = \\langle E \\rangle_{\\mathrm{Bethe}} - T \\left( \\sum_{(i,j)\\in E} S[b_{ij}] - \\sum_{i\\in V} (d_i - 1) S[b_i] \\right)\n$$\n$$\nF_{\\mathrm{Bethe}} = \\left( - \\sum_{(i,j) \\in E} J_{ij} c_{ij} - \\sum_{i \\in V} h_i m_i \\right) - T \\sum_{(i,j)\\in E} S[b_{ij}] + T \\sum_{i\\in V} (d_i - 1) S[b_i]\n$$\n代入熵的显式形式，并注意到 $S[b] = - \\sum p \\ln p$：\n\\begin{align*}\nF_{\\mathrm{Bethe}} =  - \\sum_{(i,j) \\in E} J_{ij} c_{ij} - \\sum_{i \\in V} h_i m_i \\\\\n + T \\sum_{(i,j)\\in E} \\left[ \\sum_{(x_i,x_j)} b_{ij}(x_i,x_j) \\ln b_{ij}(x_i,x_j) \\right] \\\\\n - T \\sum_{i\\in V} (d_i - 1) \\left[ \\sum_{x_i} b_{i}(x_i) \\ln b_{i}(x_i) \\right]\n\\end{align*}\n按照要求，写出对自旋构型的求和，即可得到最终表达式。我们可以使用 $\\ln(a/b) = \\ln(a) - \\ln(b)$ 来简化对数项。对于节点项，我们得到 $\\sum b_i \\ln b_i = \\sum b_i (\\ln(2b_i) - \\ln 2) = (\\sum b_i \\ln(2b_i)) - \\ln 2$。类似地，对于边项，$\\sum b_{ij} \\ln b_{ij} = (\\sum b_{ij} \\ln(4b_{ij})) - \\ln 4$。这得到了贝特自由能泛函的以下完整表达式。",
            "answer": "$$\n\\boxed{\n\\begin{aligned}\nF_{\\mathrm{Bethe}} =  - \\sum_{(i,j) \\in E} J_{ij} c_{ij} - \\sum_{i \\in V} h_i m_i \\\\\n + T \\sum_{(i,j) \\in E} \\left( \\frac{1}{4} \\Big[ (1+m_i+m_j+c_{ij})\\ln(1+m_i+m_j+c_{ij}) \\right. \\\\\n \\qquad + (1+m_i-m_j-c_{ij})\\ln(1+m_i-m_j-c_{ij}) \\\\\n \\qquad + (1-m_i+m_j-c_{ij})\\ln(1-m_i+m_j-c_{ij}) \\\\\n \\qquad \\left. + (1-m_i-m_j+c_{ij})\\ln(1-m_i-m_j+c_{ij}) \\Big] - \\ln(4) \\right) \\\\\n - T \\sum_{i \\in V} (d_i - 1) \\left( \\frac{1+m_i}{2}\\ln(1+m_i) + \\frac{1-m_i}{2}\\ln(1-m_i) - \\ln(2) \\right)\n\\end{aligned}\n}\n$$"
        },
        {
            "introduction": "在建立了贝特自由能的表达式后，我们现在将其导出的消息传递方程应用于统计物理学中的一个经典问题。在此练习中 ，我们将分析伊辛模型在随机正则图上的行为，以精确定位相变的临界点。这个练习展示了空腔法在其变为精确解的范畴内所具有的强大预测能力。",
            "id": "4308273",
            "problem": "考虑一个大的、局部树状的、$c$-正则网络（每个节点的度为 $c \\geq 2$）上的二元伊辛模型，每条边上具有均匀的配对耦合 $J$，且外场为零。自旋 $\\{s_{i}\\}_{i=1}^{N}$（其中 $s_{i} \\in \\{-1,+1\\}$）的联合分布由玻尔兹曼形式给出\n$$\nP(\\{s_{i}\\}) \\propto \\exp\\left(\\sum_{(i,j)\\in E} J\\, s_{i} s_{j}\\right).\n$$\n在树上，信念传播 (BP) 是精确的：沿有向边传递的消息概括了空腔边际分布。仅使用上述吉布斯测度所蕴含的因子分解结构和移除一个邻居以形成子树的空腔构造法，推导沿有向边的 logit 参数化 BP 消息的更新关系，并证明存在一个均匀的顺磁不动点。接下来，在 $c$-正则情况下，围绕顺磁不动点线性化此更新，并刻画将消息的扰动映射到其更新的线性算子。确定该算子的最大特征值作为 $c$ 和 $J$ 的函数，并使用不动点的失稳判据来计算顺磁不动点变得不稳定时的精确临界耦合 $J_{c}$。请用 $c$ 和标准函数将最终答案表示为 $J_{c}$ 的闭式解析表达式。无需数值近似或四舍五入。",
            "solution": "该问题要求推导在 $c$-正则随机图上伊辛模型的信念传播 (BP) 更新方程，分析顺磁不动点，并计算该不动点变得不稳定时的临界耦合 $J_c$。假设图是大的且局部树状的，这是 BP（也称为空腔法）能得出精确解的条件。\n\n首先，我们推导由空腔场参数化的消息的 BP 更新方程。消息 $\\mu_{i \\to j}(s_j)$ 表示在一个想象中暂时移除了边 $(i,j)$ 的图中，由于通过节点 $i$ 与其连接的子树的影响，自旋 $s_j$ 的概率分布。在树上，这些消息足以计算精确的边际分布。从节点 $i$ 传递到节点 $j$ 的消息的更新规则由和-积算法给出：\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i \\in \\{-1, +1\\}} P(s_i, s_j) \\prod_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\mu_{k \\to i}(s_i) $$\n其中 $\\mathcal{N}(i)$ 是节点 $i$ 的邻居集合，而 $P(s_i, s_j) = \\exp(J s_i s_j)$ 是与边 $(i,j)$ 相关联的因子。如问题所述，外场为零。\n\n我们将消息（即 $s_k \\in \\{-1, +1\\}$ 上的概率分布）用空腔场或偏置 $u_{k \\to i}$ 进行参数化：\n$$ \\mu_{k \\to i}(s_i) \\propto \\exp(u_{k \\to i} s_i) $$\n此参数 $u_{k \\to i}$ 是对数优势比的一半，即 $u_{k \\to i} = \\frac{1}{2} \\ln(\\mu_{k \\to i}(+1)/\\mu_{k \\to i}(-1))$，在问题中被称为 logit 参数化。\n\n将此参数化代入 BP 更新规则：\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i} \\exp(J s_i s_j) \\prod_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\exp(u_{k \\to i} s_i) $$\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i} \\exp(J s_i s_j) \\exp\\left(s_i \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}\\right) $$\n令 $h_{i \\setminus j} = \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}$ 为作用在自旋 $s_i$ 上来自除 $j$ 之外的所有邻居的总空腔场。方程变为：\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i \\in \\{-1, +1\\}} \\exp(s_i (J s_j + h_{i \\setminus j})) $$\n求和结果为 $2 \\cosh(J s_j + h_{i \\setminus j})$。因此，$\\mu_{i \\to j}(s_j) \\propto \\cosh(J s_j + h_{i \\setminus j})$。\n\n为了找到参数 $u_{i \\to j}$ 的更新规则，我们计算对数优势比：\n$$ \\exp(2 u_{i \\to j}) = \\frac{\\mu_{i \\to j}(+1)}{\\mu_{i \\to j}(-1)} = \\frac{\\cosh(J + h_{i \\setminus j})}{\\cosh(-J + h_{i \\setminus j})} = \\frac{\\cosh(J + h_{i \\setminus j})}{\\cosh(J - h_{i \\setminus j})} $$\n使用恒等式 $\\frac{\\cosh(a+b)}{\\cosh(a-b)} = \\frac{1+\\tanh(a)\\tanh(b)}{1-\\tanh(a)\\tanh(b)}$，我们得到：\n$$ \\exp(2 u_{i \\to j}) = \\frac{1 + \\tanh(J) \\tanh(h_{i \\setminus j})}{1 - \\tanh(J) \\tanh(h_{i \\setminus j})} $$\n取自然对数并除以 $2$：\n$$ u_{i \\to j} = \\frac{1}{2} \\ln\\left(\\frac{1 + \\tanh(J) \\tanh(h_{i \\setminus j})}{1 - \\tanh(J) \\tanh(h_{i \\setminus j})}\\right) $$\n这是反双曲正切函数 $\\operatorname{arctanh}(x) = \\frac{1}{2}\\ln\\left(\\frac{1+x}{1-x}\\right)$ 的定义。因此，我们得到了简洁的更新关系：\n$$ u_{i \\to j} = \\operatorname{arctanh}\\left(\\tanh(J) \\tanh\\left(\\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}\\right)\\right) $$\n\n接下来，我们研究均匀顺磁不动点的存在性。一个均匀不动点假设所有消息都相同，即对于所有有向边，$u_{k \\to i} = u^*$。顺磁态的特征是局部磁化为零，即对于所有 $i$，$\\langle s_i \\rangle = 0$。局部磁化由 $\\langle s_i \\rangle = \\tanh(h_i)$ 给出，其中 $h_i = \\sum_{j \\in \\mathcal{N}(i)} u_{j \\to i}$ 是作用在自旋 $s_i$ 上的总场。对于一个均匀消息 $u^*$，总场为 $h_i = c u^*$。因此，顺磁条件 $\\langle s_i \\rangle = 0$ 意味着 $c u^* = 0$，由于 $c \\ge 2$，这要求 $u^*=0$。\n我们必须验证 $u^*=0$ 是否确实是更新方程的一个不动点。将所有传入消息代入 $u_{k \\to i} = 0$：\n$$ u_{i \\to j} = \\operatorname{arctanh}\\left(\\tanh(J) \\tanh\\left(\\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} 0\\right)\\right) = \\operatorname{arctanh}(\\tanh(J) \\tanh(0)) = \\operatorname{arctanh}(0) = 0 $$\n因此，$u^*=0$ 对于任何 $J$ 和 $c$ 的值都是一个不动点，证实了均匀顺磁解的存在。\n\n为了确定这个不动点的稳定性，我们在 $u=0$ 附近线性化更新方程。令 $u_{k \\to i} = \\delta u_{k \\to i}$ 为一个小扰动。更新方程的形式为 $u' = F(\\sum u_k)$，其中 $F(x) = \\operatorname{arctanh}(\\tanh(J) \\tanh(x))$。我们在 $x=0$ 附近展开 $F(x)$：$F(x) \\approx F(0) + F'(0)x$。\n我们已知 $F(0)=0$。导数为 $F'(x) = \\frac{d}{dx}\\operatorname{arctanh}(\\tanh(J) \\tanh(x))$。\n使用链式法则，$F'(x) = \\frac{\\tanh(J)(1-\\tanh^2(x))}{1 - \\tanh^2(J)\\tanh^2(x)}$。\n在 $x=0$ 处求值：\n$$ F'(0) = \\frac{\\tanh(J)(1-0)}{1-0} = \\tanh(J) $$\n因此，扰动的线性化更新方程为：\n$$ \\delta u_{i \\to j} = \\tanh(J) \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\delta u_{k \\to i} $$\n这个方程描述了扰动如何在网络中传播。我们可以将其写成算子形式 $\\delta\\mathbf{u}' = \\mathbf{T} \\delta\\mathbf{u}$，其中 $\\delta\\mathbf{u}$ 是图上有向边上所有扰动的向量。算子 $\\mathbf{T}$ 的元素为 $T_{(i \\to j, k \\to l)} = \\tanh(J) \\delta_{il} (1-\\delta_{jk})$，即 $\\tanh(J)$ 乘以图的非回溯矩阵 $\\mathbf{B}$。\n\n当算子 $\\mathbf{T}$ 的最大特征值（绝对值）超过 $1$ 时，顺磁不动点变得不稳定。$\\mathbf{T}$ 的特征值是 $\\mathbf{B}$ 的特征值乘以 $\\tanh(J)$。对于一个大的 $c$-正则随机图（其局部为一棵 $(c-1)$-叉树），非回溯矩阵 $\\mathbf{B}$ 的最大特征值是 $c-1$。\n因此，我们的线性算子 $\\mathbf{T}$ 的最大特征值为：\n$$ \\lambda_{\\max} = (c-1) \\tanh(J) $$\n失稳判据是 $|\\lambda_{\\max}| = 1$。假设铁磁相互作用 $J>0$，则 $\\tanh(J)>0$，该条件简化为 $\\lambda_{\\max} = 1$。临界耦合 $J_c$ 通过求解以下方程得到：\n$$ (c-1) \\tanh(J_c) = 1 $$\n这给出：\n$$ \\tanh(J_c) = \\frac{1}{c-1} $$\n为了使解存在，我们需要 $0  \\frac{1}{c-1} \\le 1$，这对于任何整数 $c \\geq 2$ 都成立。对于 $c=2$，我们有 $\\tanh(J_c)=1$，意味着 $J_c \\to \\infty$。这是一维伊辛链的正确结果。对于 $c > 2$，存在有限的临界耦合。\n求解 $J_c$，我们得到：\n$$ J_c = \\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right) $$\n这是 $c$-正则随机图上顺磁-铁磁相变的精确临界耦合。\n此表达式也可以使用 $\\operatorname{arctanh}$ 的对数定义写成：\n$$ J_c = \\frac{1}{2} \\ln\\left(\\frac{1 + \\frac{1}{c-1}}{1 - \\frac{1}{c-1}}\\right) = \\frac{1}{2} \\ln\\left(\\frac{c}{c-2}\\right) $$\n问题要求一个闭式解析表达式，而 $\\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right)$ 就是这样一个表达式。",
            "answer": "$$\n\\boxed{\\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right)}\n$$"
        },
        {
            "introduction": "最后的这个练习通过展示如何使用空腔法进行网络推断，从而在理论和应用之间架起了一座桥梁。通过使用磁化率传播（susceptibility propagation）——一种线性响应理论的形式——来扩展置信传播，我们可以计算模型内的相关性。然后，我们将利用这个理论结果 ，从假设的观测数据中推断出潜在的相互作用强度，这是许多科学领域中的一项核心任务。",
            "id": "4308277",
            "problem": "考虑一个定义在由三个节点构成的链式树结构网络上的二元成对伊辛模型（Ising model），节点标记为 $1$–$2$–$3$。每个自旋 $x_i \\in \\{-1,+1\\}$，其联合分布为\n$$\nP(\\mathbf{x}) = \\frac{1}{Z}\\,\\exp\\!\\left(\\sum_{\\langle i,j\\rangle} J_{ij}\\,x_i x_j + \\sum_{i} h_i\\, x_i \\right),\n$$\n其中 $Z$ 是配分函数，$J_{ij}$ 是边 $\\langle i,j\\rangle$ 上的成对耦合强度，$h_i$ 是外场。假设对所有 $i$ 都有 $h_i=0$，并且耦合为均匀铁磁性耦合 $J_{12}=J_{23}=J>0$。\n\n您将使用空腔方法和信念传播（Belief Propagation, BP）以及磁化率传播（BP消息相对于外场的线性响应）来计算连通成对相关性。从将连通相关性与期望值对场的导数等同起来的基本线性响应恒等式出发，并利用BP在树上的精确性，通过对空腔场的定点BP更新方程求导，来推导磁化率传播方程。\n\n任务：\n- 从第一性原理出发，推导连通相关性满足\n$$\n\\langle x_i x_j \\rangle - \\langle x_i \\rangle \\langle x_j \\rangle = \\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}\\bigg|_{h=0}.\n$$\n- 在链 $1$–$2$–$3$ 上使用磁化率传播，获得连通相关性 $C_{13} \\equiv \\langle x_1 x_3 \\rangle - \\langle x_1 \\rangle \\langle x_3 \\rangle$ 作为 $J$ 的函数的闭式表达式。\n- 现在假设从 $h=0$ 的模型中抽取了 $N$ 个独立同分布的样本 $\\{\\mathbf{x}^{(n)}\\}_{n=1}^{N}$，并且节点 $1$ 和 $3$ 之间的经验连通协方差被发现是\n$$\n\\hat{C}_{13} = \\frac{1}{N}\\sum_{n=1}^{N} x_1^{(n)} x_3^{(n)} = 0.36.\n$$\n根据上面推导的Bethe预测，通过将理论值 $C_{13}$ 与经验值 $\\hat{C}_{13}$ 相等，推断出与 $\\hat{C}_{13}$ 匹配的均匀耦合强度 $J$。将您推断的 $J$ 值四舍五入到四位有效数字。将您的最终答案表示为一个无量纲数。",
            "solution": "首先验证问题，以确保其科学上合理、内容自洽且提法恰当。\n\n### 步骤1：提取已知条件\n- **模型**：3节点链式图（$1$–$2$–$3$）上的二元成对伊辛模型。\n- **自旋**：$x_i \\in \\{-1,+1\\}$ for $i \\in \\{1, 2, 3\\}$。\n- **联合分布**：$P(\\mathbf{x}) = \\frac{1}{Z}\\,\\exp\\!\\left(\\sum_{\\langle i,j\\rangle} J_{ij}\\,x_i x_j + \\sum_{i} h_i\\, x_i \\right)$。\n- **网络结构**：边为 $\\langle 1,2 \\rangle$ 和 $\\langle 2,3 \\rangle$。\n- **耦合强度**：$J_{12} = J_{23} = J > 0$。\n- **外场**：对所有 $i$ 都有 $h_i = 0$。\n- **任务1**：推导线性响应恒等式 $C_{ij} \\equiv \\langle x_i x_j \\rangle - \\langle x_i \\rangle \\langle x_j \\rangle = \\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}\\big|_{h=0}$。\n- **任务2**：使用磁化率传播求出 $C_{13}$ 作为 $J$ 的函数的闭式表达式。\n- **任务3**：给定经验数据 $\\hat{C}_{13} = \\frac{1}{N}\\sum_{n=1}^{N} x_1^{(n)} x_3^{(n)} = 0.36$，通过令理论值 $C_{13}$ 等于经验值 $\\hat{C}_{13}$ 来推断 $J$ 的值。将结果四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它使用了标准的伊辛模型、信念传播（BP）和线性响应形式（磁化率传播），这些都是统计物理和网络科学中的基石概念。该问题提法恰当；图是一个树，对于树而言，BP是精确的，这保证了唯一且正确的解。所有必要的参数和条件（$h=0$, $J>0$, 网络结构）都已给出。任务定义清晰，并且在逻辑上层层递进。为标准的推断任务提供了经验数据点。不存在矛盾或歧义。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将推导完整解。\n\n### 解题推导\n\n**第一部分：线性响应恒等式的推导**\n\n自旋 $x_i$ 的期望值由下式给出\n$$\n\\langle x_i \\rangle = \\sum_{\\mathbf{x}} x_i P(\\mathbf{x}) = \\frac{1}{Z} \\sum_{\\mathbf{x}} x_i \\exp\\left(\\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k\\right)\n$$\n其中 $Z = \\sum_{\\mathbf{x}} \\exp\\left(\\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k\\right)$ 是配分函数。\n\n我们使用商法则对 $\\langle x_i \\rangle$ 关于外场 $h_j$ 求导：\n$$\n\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j} = \\frac{\\partial}{\\partial h_j} \\left( \\frac{\\sum_{\\mathbf{x}} x_i \\exp(\\dots)}{Z} \\right) = \\frac{1}{Z} \\frac{\\partial}{\\partial h_j}\\left(\\sum_{\\mathbf{x}} x_i \\exp(\\dots)\\right) - \\frac{1}{Z^2} \\left(\\frac{\\partial Z}{\\partial h_j}\\right) \\left(\\sum_{\\mathbf{x}} x_i \\exp(\\dots)\\right)\n$$\n我们来计算指数项和 $Z$ 的导数。令 $E(\\mathbf{x}, \\mathbf{h}) = \\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k$。\n$$\n\\frac{\\partial}{\\partial h_j} \\exp(E(\\mathbf{x}, \\mathbf{h})) = \\exp(E(\\mathbf{x}, \\mathbf{h})) \\frac{\\partial}{\\partial h_j} \\left(\\sum_k h_k x_k\\right) = x_j \\exp(E(\\mathbf{x}, \\mathbf{h}))\n$$\n利用此结果，我们求出分子项和 $Z$ 的导数：\n$$\n\\frac{\\partial}{\\partial h_j}\\left(\\sum_{\\mathbf{x}} x_i \\exp(E(\\mathbf{x}, \\mathbf{h}))\\right) = \\sum_{\\mathbf{x}} x_i x_j \\exp(E(\\mathbf{x}, \\mathbf{h})) = Z \\langle x_i x_j \\rangle\n$$\n$$\n\\frac{\\partial Z}{\\partial h_j} = \\sum_{\\mathbf{x}} \\frac{\\partial}{\\partial h_j} \\exp(E(\\mathbf{x}, \\mathbf{h})) = \\sum_{\\mathbf{x}} x_j \\exp(E(\\mathbf{x}, \\mathbf{h})) = Z \\langle x_j \\rangle\n$$\n将这些结果代回到 $\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}$ 的表达式中：\n$$\n\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j} = \\frac{1}{Z} (Z \\langle x_i x_j \\rangle) - \\frac{1}{Z^2} (Z \\langle x_j \\rangle) (Z \\langle x_i \\rangle) = \\langle x_i x_j \\rangle - \\langle x_j \\rangle \\langle x_i \\rangle\n$$\n此恒等式对任意场 $\\mathbf{h}$ 集合都成立。题目要求在 $\\mathbf{h}=0$ 处计算它，但其形式是通用的。至此完成第一个任务。\n\n**第二部分：$C_{13}$ 的磁化率传播**\n\n我们在树上使用信念传播（BP）。对于成对伊辛模型，BP 更新方程可以用“空腔场”来表示。空腔场 $u_{j \\to i}$ 代表节点 $j$ 的邻域（不包括 $i$）对节点 $j$ 的影响。一个常用的公式关联了场的双曲正切：\n$$\n\\tanh(u_{j \\to i}) = \\tanh(J_{ij}) \\tanh\\left(h_j + \\sum_{k \\in \\partial j \\setminus i} u_{k \\to j}\\right)\n$$\n节点 $i$ 的局部磁化强度则由 $\\langle x_i \\rangle = \\tanh(H_i)$ 给出，其中 $H_i = h_i + \\sum_{j \\in \\partial i} u_{j \\to i}$ 是作用在节点 $i$ 上的总有效场。\n\n对于链 $1$–$2$–$3$，其中 $h_i=0$ 且 $J_{12}=J_{23}=J$：\n邻居节点为 $\\partial 1 = \\{2\\}$，$\\partial 2 = \\{1, 3\\}$，$\\partial 3 = \\{2\\}$。\nBP更新方程为：\n1.  $u_{1 \\to 2}$：从叶节点 $1$ 发出。$\\partial 1 \\setminus 2$ 为空。\n    $$ \\tanh(u_{1 \\to 2}) = \\tanh(J_{12}) \\tanh(h_1) = \\tanh(J) \\tanh(h_1) $$\n2.  $u_{3 \\to 2}$：从叶节点 $3$ 发出。$\\partial 3 \\setminus 2$ 为空。\n    $$ \\tanh(u_{3 \\to 2}) = \\tanh(J_{23}) \\tanh(h_3) = \\tanh(J) \\tanh(h_3) $$\n3.  $u_{2 \\to 1}$：\n    $$ \\tanh(u_{2 \\to 1}) = \\tanh(J_{12}) \\tanh(h_2 + u_{3 \\to 2}) = \\tanh(J) \\tanh(h_2 + u_{3 \\to 2}) $$\n4.  $u_{2 \\to 3}$：\n    $$ \\tanh(u_{2 \\to 3}) = \\tanh(J_{23}) \\tanh(h_2 + u_{1 \\to 2}) = \\tanh(J) \\tanh(h_2 + u_{1 \\to 2}) $$\n\n在零场下（$h_1=h_2=h_3=0$），所有空腔场 $u_{i \\to j}$ 均为零。总场 $H_i=0$，因此对所有 $i$，磁化强度 $\\langle x_i \\rangle = \\tanh(0) = 0$。\n这意味着连通相关性等于原始相关性：$C_{13} = \\langle x_1 x_3 \\rangle - \\langle x_1 \\rangle \\langle x_3 \\rangle = \\langle x_1 x_3 \\rangle$。\n\n我们使用线性响应恒等式计算 $C_{13}$：\n$$\nC_{13} = \\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\n我们有 $\\langle x_1 \\rangle = \\tanh(H_1) = \\tanh(h_1 + u_{2 \\to 1})$。应用链式法则：\n$$\n\\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3} = \\frac{d}{dH_1}\\big(\\tanh(H_1)\\big) \\frac{\\partial H_1}{\\partial h_3} = \\left(1 - \\tanh^2(H_1)\\right) \\left(\\frac{\\partial h_1}{\\partial h_3} + \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\right)\n$$\n在 $\\mathbf{h}=0$ 处求值，我们有 $H_1=0$，$\\tanh(H_1)=0$ 和 $\\frac{\\partial h_1}{\\partial h_3}=0$。这可以简化为：\n$$\nC_{13} = \\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = (1-0) \\left(0 + \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\\right) = \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\n这个量就是磁化率，我们可以通过对BP更新方程求导来找到它。我们对 $u_{2 \\to 1}$ 的方程关于 $h_3$ 求导：\n$$\n\\frac{\\partial}{\\partial h_3} \\tanh(u_{2 \\to 1}) = \\frac{\\partial}{\\partial h_3} \\left[ \\tanh(J) \\tanh(h_2 + u_{3 \\to 2}) \\right]\n$$\n$$\n(1 - \\tanh^2(u_{2 \\to 1})) \\frac{\\partial u_{2 \\to 1}}{\\partial h_3} = \\tanh(J) (1 - \\tanh^2(h_2 + u_{3 \\to 2})) \\left(\\frac{\\partial h_2}{\\partial h_3} + \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\right)\n$$\n在 $\\mathbf{h}=0$ 处求值，所有空腔场都为零，因此它们的双曲正切也为零。此外，$\\frac{\\partial h_2}{\\partial h_3}=0$。\n$$\n(1-0) \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) (1-0) \\left(0 + \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\\right)\n$$\n$$\n\\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\n现在我们需要求 $\\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\big|_{\\mathbf{h}=0}$。我们对 $u_{3 \\to 2}$ 的方程求导：\n$$\n\\frac{\\partial}{\\partial h_3} \\tanh(u_{3 \\to 2}) = \\frac{\\partial}{\\partial h_3} [\\tanh(J) \\tanh(h_3)]\n$$\n$$\n(1 - \\tanh^2(u_{3 \\to 2})) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3} = \\tanh(J) (1 - \\tanh^2(h_3)) \\frac{\\partial h_3}{\\partial h_3}\n$$\n在 $\\mathbf{h}=0$ 处求值：\n$$\n(1-0) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) (1-0) (1) \\implies \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J)\n$$\n将此结果代回：\n$$\n\\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) \\cdot \\tanh(J) = \\tanh^2(J)\n$$\n因此，节点 $1$ 和 $3$ 之间的连通相关性是：\n$$\nC_{13} = \\tanh^2(J)\n$$\n\n**第三部分：耦合强度 $J$ 的推断**\n\n问题提供了经验连通协方差 $\\hat{C}_{13} = 0.36$。所提供的 $\\hat{C}_{13}$ 公式是样本二阶矩 $\\frac{1}{N}\\sum x_1^{(n)} x_3^{(n)}$，在真实均值为零的情况下，这是理论相关性 $\\langle x_1 x_3 \\rangle$ 的一个有效估计量。将理论预测与该经验值相等：\n$$\n\\tanh^2(J) = 0.36\n$$\n由于问题陈述 $J>0$，我们取正平方根：\n$$\n\\tanh(J) = \\sqrt{0.36} = 0.6\n$$\n为了求 $J$，我们取反双曲正切：\n$$\nJ = \\text{arctanh}(0.6)\n$$\n使用反双曲正切的对数定义，$\\text{arctanh}(y) = \\frac{1}{2} \\ln\\left(\\frac{1+y}{1-y}\\right)$：\n$$\nJ = \\frac{1}{2} \\ln\\left(\\frac{1+0.6}{1-0.6}\\right) = \\frac{1}{2} \\ln\\left(\\frac{1.6}{0.4}\\right) = \\frac{1}{2} \\ln(4)\n$$\n因为 $\\ln(4) = \\ln(2^2) = 2 \\ln(2)$，我们得到：\n$$\nJ = \\frac{1}{2} (2 \\ln(2)) = \\ln(2)\n$$\n$\\ln(2)$ 的值约等于 $0.69314718...$。四舍五入到四位有效数字，我们得到：\n$$\nJ \\approx 0.6931\n$$",
            "answer": "$$\n\\boxed{0.6931}\n$$"
        }
    ]
}