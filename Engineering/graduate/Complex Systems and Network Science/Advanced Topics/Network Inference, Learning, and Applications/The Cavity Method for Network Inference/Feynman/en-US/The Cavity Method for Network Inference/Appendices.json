{
    "hands_on_practices": [
        {
            "introduction": "The predictive power of the cavity method lies in its ability to analyze collective phenomena on complex networks. This foundational exercise guides you through deriving the Belief Propagation (BP) update equations for the classic Ising model from first principles. By analyzing the stability of the system's paramagnetic state, you will use these equations to predict the exact critical point for a phase transition on a random graph, directly connecting micro-level message-passing dynamics to macro-level system behavior. ",
            "id": "4308273",
            "problem": "Consider a binary Ising model on a large, locally tree-like, $c$-regular network (each node has degree $c \\geq 2$), with uniform pairwise couplings $J$ on every edge and zero external field. The joint distribution of spins $\\{s_{i}\\}_{i=1}^{N}$, where $s_{i} \\in \\{-1,+1\\}$, is given by the Boltzmann form\n$$\nP(\\{s_{i}\\}) \\propto \\exp\\left(\\sum_{(i,j)\\in E} J\\, s_{i} s_{j}\\right).\n$$\nOn a tree, Belief Propagation (BP) is exact: messages passed along directed edges summarize cavity marginals. Using only the factorization structure implied by the above Gibbs measure and the cavity construction that removes one neighbor to form a subtree, derive the update relation for the logit-parameterized BP messages along a directed edge, and show that a homogeneous paramagnetic fixed point exists. Next, linearize this update around the paramagnetic fixed point in the $c$-regular case and characterize the linear operator that maps perturbations of messages to their updates. Determine the largest eigenvalue of this operator as a function of $c$ and $J$, and use the loss-of-stability criterion of the fixed point to compute the exact critical coupling $J_{c}$ at which the paramagnetic fixed point becomes unstable. Express your final answer as a closed-form analytic expression for $J_{c}$ in terms of $c$ and standard functions. No numerical approximation or rounding is required.",
            "solution": "The problem asks for the derivation of the Belief Propagation (BP) update equations for an Ising model on a $c$-regular random graph, the analysis of the paramagnetic fixed point, and the calculation of the critical coupling $J_c$ where this fixed point becomes unstable. The graph is assumed to be large and locally tree-like, which is the condition under which BP, also known as the cavity method, yields an exact solution.\n\nFirst, we derive the BP update equation for messages parameterized by a cavity field. A message $\\mu_{i \\to j}(s_j)$ represents the probability distribution of spin $s_j$ due to the influence of the subtree connected to it via node $i$, in a graph where the edge $(i,j)$ is imagined to be temporarily removed. On a tree, these messages are sufficient to compute exact marginals. The update rule for a message passed from node $i$ to node $j$ is given by the sum-product algorithm:\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i \\in \\{-1, +1\\}} P(s_i, s_j) \\prod_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\mu_{k \\to i}(s_i) $$\nwhere $\\mathcal{N}(i)$ is the set of neighbors of node $i$, and $P(s_i, s_j) = \\exp(J s_i s_j)$ is the factor associated with the edge $(i,j)$. The external field is zero as stated in the problem.\n\nWe parameterize the messages, which are probability distributions over $s_k \\in \\{-1, +1\\}$, by a cavity field or bias $u_{k \\to i}$:\n$$ \\mu_{k \\to i}(s_i) \\propto \\exp(u_{k \\to i} s_i) $$\nThis parameter $u_{k \\to i}$ is half the log-odds ratio, $u_{k \\to i} = \\frac{1}{2} \\ln(\\mu_{k \\to i}(+1)/\\mu_{k \\to i}(-1))$, and is referred to as the logit parameterization in the problem.\n\nSubstituting this parameterization into the BP update rule:\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i} \\exp(J s_i s_j) \\prod_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\exp(u_{k \\to i} s_i) $$\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i} \\exp(J s_i s_j) \\exp\\left(s_i \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}\\right) $$\nLet $h_{i \\setminus j} = \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}$ be the total cavity field acting on spin $s_i$ from all its neighbors except $j$. The equation becomes:\n$$ \\mu_{i \\to j}(s_j) \\propto \\sum_{s_i \\in \\{-1, +1\\}} \\exp(s_i (J s_j + h_{i \\setminus j})) $$\nThe sum evaluates to $2 \\cosh(J s_j + h_{i \\setminus j})$. Therefore, $\\mu_{i \\to j}(s_j) \\propto \\cosh(J s_j + h_{i \\setminus j})$.\n\nTo find the update rule for the parameter $u_{i \\to j}$, we compute the log-odds ratio:\n$$ \\exp(2 u_{i \\to j}) = \\frac{\\mu_{i \\to j}(+1)}{\\mu_{i \\to j}(-1)} = \\frac{\\cosh(J + h_{i \\setminus j})}{\\cosh(-J + h_{i \\setminus j})} = \\frac{\\cosh(J + h_{i \\setminus j})}{\\cosh(J - h_{i \\setminus j})} $$\nUsing the identity $\\frac{\\cosh(a+b)}{\\cosh(a-b)} = \\frac{1+\\tanh(a)\\tanh(b)}{1-\\tanh(a)\\tanh(b)}$, we get:\n$$ \\exp(2 u_{i \\to j}) = \\frac{1 + \\tanh(J) \\tanh(h_{i \\setminus j})}{1 - \\tanh(J) \\tanh(h_{i \\setminus j})} $$\nTaking the natural logarithm and dividing by $2$:\n$$ u_{i \\to j} = \\frac{1}{2} \\ln\\left(\\frac{1 + \\tanh(J) \\tanh(h_{i \\setminus j})}{1 - \\tanh(J) \\tanh(h_{i \\setminus j})}\\right) $$\nThis is the definition of the inverse hyperbolic tangent function, $\\operatorname{arctanh}(x) = \\frac{1}{2}\\ln\\left(\\frac{1+x}{1-x}\\right)$. So, we arrive at the compact update relation:\n$$ u_{i \\to j} = \\operatorname{arctanh}\\left(\\tanh(J) \\tanh\\left(\\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} u_{k \\to i}\\right)\\right) $$\n\nNext, we investigate the existence of a homogeneous paramagnetic fixed point. A homogeneous fixed point assumes all messages are identical, $u_{k \\to i} = u^*$ for all directed edges. A paramagnetic state is characterized by zero local magnetization, $\\langle s_i \\rangle = 0$ for all $i$. The local magnetization is given by $\\langle s_i \\rangle = \\tanh(h_i)$, where $h_i = \\sum_{j \\in \\mathcal{N}(i)} u_{j \\to i}$ is the total field on spin $s_i$. For a homogeneous message $u^*$, the total field is $h_i = c u^*$. Thus, the paramagnetic condition $\\langle s_i \\rangle = 0$ implies $c u^* = 0$, which requires $u^*=0$ since $c \\ge 2$.\nWe must verify if $u^*=0$ is indeed a fixed point of the update equation. Substituting $u_{k \\to i} = 0$ for all incoming messages:\n$$ u_{i \\to j} = \\operatorname{arctanh}\\left(\\tanh(J) \\tanh\\left(\\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} 0\\right)\\right) = \\operatorname{arctanh}(\\tanh(J) \\tanh(0)) = \\operatorname{arctanh}(0) = 0 $$\nThus, $u^*=0$ is a fixed point for any value of $J$ and $c$, confirming the existence of a homogeneous paramagnetic solution.\n\nTo determine the stability of this fixed point, we linearize the update equation around $u=0$. Let $u_{k \\to i} = \\delta u_{k \\to i}$ be a small perturbation. The update equation is of the form $u' = F(\\sum u_k)$ where $F(x) = \\operatorname{arctanh}(\\tanh(J) \\tanh(x))$. We expand $F(x)$ around $x=0$: $F(x) \\approx F(0) + F'(0)x$.\nWe already know $F(0)=0$. The derivative is $F'(x) = \\frac{d}{dx}\\operatorname{arctanh}(\\tanh(J) \\tanh(x))$.\nUsing the chain rule, $F'(x) = \\frac{\\tanh(J)(1-\\tanh^2(x))}{1 - \\tanh^2(J)\\tanh^2(x)}$.\nEvaluating at $x=0$:\n$$ F'(0) = \\frac{\\tanh(J)(1-0)}{1-0} = \\tanh(J) $$\nThe linearized update equation for the perturbations is therefore:\n$$ \\delta u_{i \\to j} = \\tanh(J) \\sum_{k \\in \\mathcal{N}(i) \\setminus \\{j\\}} \\delta u_{k \\to i} $$\nThis equation describes how perturbations propagate through the network. We can write this in operator form as $\\delta\\mathbf{u}' = \\mathbf{T} \\delta\\mathbf{u}$, where $\\delta\\mathbf{u}$ is a vector of all perturbations on the directed edges of the graph. The operator $\\mathbf{T}$ has elements $T_{(i \\to j, k \\to l)} = \\tanh(J) \\delta_{il} (1-\\delta_{jk})$, which is $\\tanh(J)$ times the non-backtracking matrix $\\mathbf{B}$ of the graph.\n\nThe paramagnetic fixed point becomes unstable when the largest eigenvalue (in magnitude) of the operator $\\mathbf{T}$ exceeds $1$. The eigenvalues of $\\mathbf{T}$ are $\\tanh(J)$ times the eigenvalues of $\\mathbf{B}$. For a large $c$-regular random graph (which is locally a $(c-1)$-ary tree), the largest eigenvalue of the non-backtracking matrix $\\mathbf{B}$ is $c-1$.\nTherefore, the largest eigenvalue of our linear operator $\\mathbf{T}$ is:\n$$ \\lambda_{\\max} = (c-1) \\tanh(J) $$\nThe loss-of-stability criterion is $|\\lambda_{\\max}| = 1$. Assuming a ferromagnetic interaction $J>0$, $\\tanh(J)>0$ and the condition simplifies to $\\lambda_{\\max} = 1$. The critical coupling $J_c$ is found by solving:\n$$ (c-1) \\tanh(J_c) = 1 $$\nThis gives:\n$$ \\tanh(J_c) = \\frac{1}{c-1} $$\nFor a solution to exist, we need $0 < \\frac{1}{c-1} \\le 1$, which is true for any integer $c \\geq 2$. For $c=2$, we have $\\tanh(J_c)=1$, implying $J_c \\to \\infty$. This is the correct result for the 1D Ising chain. For $c > 2$, a finite critical coupling exists.\nSolving for $J_c$, we get:\n$$ J_c = \\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right) $$\nThis is the exact critical coupling for the paramagnetic-ferromagnetic phase transition on a $c$-regular random graph.\nThis expression can also be written using the logarithmic definition of $\\operatorname{arctanh}$:\n$$ J_c = \\frac{1}{2} \\ln\\left(\\frac{1 + \\frac{1}{c-1}}{1 - \\frac{1}{c-1}}\\right) = \\frac{1}{2} \\ln\\left(\\frac{c}{c-2}\\right) $$\nThe problem asks for a closed-form analytic expression, and $\\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right)$ is such an expression.",
            "answer": "$$\n\\boxed{\\operatorname{arctanh}\\left(\\frac{1}{c-1}\\right)}\n$$"
        },
        {
            "introduction": "The utility of Belief Propagation extends beyond estimating local magnetizations to the core task of network inference: learning the hidden parameters of a model from data. This practice introduces susceptibility propagation, a powerful linear-response technique that leverages the Belief Propagation (BP) framework to compute pairwise correlations. By mastering this method, you will connect theoretical correlation functions to empirical data, enabling you to infer the underlying coupling strengths of a network. ",
            "id": "4308277",
            "problem": "Consider a binary pairwise Ising model defined on a tree-structured network of three nodes arranged in a chain, with nodes labeled $1$–$2$–$3$. Each spin $x_i \\in \\{-1,+1\\}$ and the joint distribution is\n$$\nP(\\mathbf{x}) = \\frac{1}{Z}\\,\\exp\\!\\left(\\sum_{\\langle i,j\\rangle} J_{ij}\\,x_i x_j + \\sum_{i} h_i\\, x_i \\right),\n$$\nwhere $Z$ is the partition function, $J_{ij}$ are pairwise couplings on edges $\\langle i,j\\rangle$, and $h_i$ are external fields. Assume $h_i=0$ for all $i$, and uniform ferromagnetic couplings $J_{12}=J_{23}=J>0$.\n\nYou will use the cavity method and Belief Propagation (BP) together with susceptibility propagation (linear response of BP messages with respect to external fields) to compute connected pairwise correlations. Begin from the fundamental linear response identity equating connected correlations to derivatives of expectations with respect to fields, and use the exactness of BP on trees to derive the susceptibility propagation equations by differentiating the fixed-point BP update equations for cavity fields.\n\nTasks:\n- Derive, from first principles, that the connected correlation satisfies\n$$\n\\langle x_i x_j \\rangle - \\langle x_i \\rangle \\langle x_j \\rangle = \\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}\\bigg|_{h=0}.\n$$\n- Using susceptibility propagation on the chain $1$–$2$–$3$, obtain a closed-form expression for the connected correlation $C_{13} \\equiv \\langle x_1 x_3 \\rangle - \\langle x_1 \\rangle \\langle x_3 \\rangle$ as a function of $J$.\n- Now suppose $N$ independent and identically distributed samples $\\{\\mathbf{x}^{(n)}\\}_{n=1}^{N}$ are drawn from the model at $h=0$, and the empirical connected covariance between nodes $1$ and $3$ is found to be\n$$\n\\hat{C}_{13} = \\frac{1}{N}\\sum_{n=1}^{N} x_1^{(n)} x_3^{(n)} = 0.36.\n$$\nUnder the Bethe prediction derived above, infer the uniform coupling $J$ that matches $\\hat{C}_{13}$ by equating the theoretical $C_{13}$ to $\\hat{C}_{13}$. Round your inferred $J$ to four significant figures. Express your final answer as a dimensionless number.",
            "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n### Step 1: Extract Givens\n- **Model**: Binary pairwise Ising model on a 3-node chain graph ($1$–$2$–$3$).\n- **Spins**: $x_i \\in \\{-1,+1\\}$ for $i \\in \\{1, 2, 3\\}$.\n- **Joint Distribution**: $P(\\mathbf{x}) = \\frac{1}{Z}\\,\\exp\\!\\left(\\sum_{\\langle i,j\\rangle} J_{ij}\\,x_i x_j + \\sum_{i} h_i\\, x_i \\right)$.\n- **Network Structure**: Edges are $\\langle 1,2 \\rangle$ and $\\langle 2,3 \\rangle$.\n- **Couplings**: $J_{12} = J_{23} = J > 0$.\n- **External Fields**: $h_i = 0$ for all $i$.\n- **Task 1**: Derive the linear response identity $C_{ij} \\equiv \\langle x_i x_j \\rangle - \\langle x_i \\rangle \\langle x_j \\rangle = \\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}\\big|_{h=0}$.\n- **Task 2**: Use susceptibility propagation to find a closed-form expression for $C_{13}$ as a function of $J$.\n- **Task 3**: Given empirical data $\\hat{C}_{13} = \\frac{1}{N}\\sum_{n=1}^{N} x_1^{(n)} x_3^{(n)} = 0.36$, infer the value of $J$ by equating the theoretical $C_{13}$ with $\\hat{C}_{13}$. Round the result to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as it uses the standard Ising model, Belief Propagation (BP), and the linear response formalism (susceptibility propagation), which are cornerstone concepts in statistical physics and network science. The problem is well-posed; the graph is a tree, for which BP is exact, guaranteeing a unique and correct solution. All necessary parameters and conditions ($h=0$, $J>0$, network structure) are provided. The tasks are clearly defined and build upon each other logically. The empirical data point is provided for a standard inference task. No contradictions or ambiguities are present.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be derived.\n\n### Solution Derivation\n\n**Part 1: Derivation of the Linear Response Identity**\n\nThe expectation value of a spin $x_i$ is given by\n$$\n\\langle x_i \\rangle = \\sum_{\\mathbf{x}} x_i P(\\mathbf{x}) = \\frac{1}{Z} \\sum_{\\mathbf{x}} x_i \\exp\\left(\\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k\\right)\n$$\nwhere $Z = \\sum_{\\mathbf{x}} \\exp\\left(\\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k\\right)$ is the partition function.\n\nWe differentiate $\\langle x_i \\rangle$ with respect to an external field $h_j$ using the quotient rule:\n$$\n\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j} = \\frac{\\partial}{\\partial h_j} \\left( \\frac{\\sum_{\\mathbf{x}} x_i \\exp(\\dots)}{Z} \\right) = \\frac{1}{Z} \\frac{\\partial}{\\partial h_j}\\left(\\sum_{\\mathbf{x}} x_i \\exp(\\dots)\\right) - \\frac{1}{Z^2} \\left(\\frac{\\partial Z}{\\partial h_j}\\right) \\left(\\sum_{\\mathbf{x}} x_i \\exp(\\dots)\\right)\n$$\nLet's compute the derivatives of the exponential term and $Z$. Let $E(\\mathbf{x}, \\mathbf{h}) = \\sum_{\\langle k,l \\rangle} J_{kl} x_k x_l + \\sum_k h_k x_k$.\n$$\n\\frac{\\partial}{\\partial h_j} \\exp(E(\\mathbf{x}, \\mathbf{h})) = \\exp(E(\\mathbf{x}, \\mathbf{h})) \\frac{\\partial}{\\partial h_j} \\left(\\sum_k h_k x_k\\right) = x_j \\exp(E(\\mathbf{x}, \\mathbf{h}))\n$$\nUsing this, we find the derivatives of the numerator term and $Z$:\n$$\n\\frac{\\partial}{\\partial h_j}\\left(\\sum_{\\mathbf{x}} x_i \\exp(E(\\mathbf{x}, \\mathbf{h}))\\right) = \\sum_{\\mathbf{x}} x_i x_j \\exp(E(\\mathbf{x}, \\mathbf{h})) = Z \\langle x_i x_j \\rangle\n$$\n$$\n\\frac{\\partial Z}{\\partial h_j} = \\sum_{\\mathbf{x}} \\frac{\\partial}{\\partial h_j} \\exp(E(\\mathbf{x}, \\mathbf{h})) = \\sum_{\\mathbf{x}} x_j \\exp(E(\\mathbf{x}, \\mathbf{h})) = Z \\langle x_j \\rangle\n$$\nSubstituting these back into the expression for $\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j}$:\n$$\n\\frac{\\partial \\langle x_i \\rangle}{\\partial h_j} = \\frac{1}{Z} (Z \\langle x_i x_j \\rangle) - \\frac{1}{Z^2} (Z \\langle x_j \\rangle) (Z \\langle x_i \\rangle) = \\langle x_i x_j \\rangle - \\langle x_j \\rangle \\langle x_i \\rangle\n$$\nThis identity holds for any set of fields $\\mathbf{h}$. The problem asks to evaluate it at $\\mathbf{h}=0$, but the form is general. This completes the first task.\n\n**Part 2: Susceptibility Propagation for $C_{13}$**\n\nWe use Belief Propagation (BP) on the tree. For a pairwise Ising model, BP update equations can be formulated in terms of \"cavity fields\". The cavity field $u_{j \\to i}$ represents the influence of node $j$'s neighborhood, excluding $i$, on node $j$. The BP update rule for cavity fields is:\n$$\nu_{j \\to i} = \\sum_{k \\in \\partial j \\setminus i} \\text{atanh}\\left( \\tanh(J_{jk}) \\tanh(h_k + u_{k \\to j}) \\right)\n$$\nA more common and equivalent formulation, which we will use, relates the hyperbolic tangents of the fields:\n$$\n\\tanh(u_{j \\to i}) = \\tanh(J_{ij}) \\tanh\\left(h_j + \\sum_{k \\in \\partial j \\setminus i} u_{k \\to j}\\right)\n$$\nThe local magnetization at node $i$ is then given by $\\langle x_i \\rangle = \\tanh(H_i)$, where $H_i = h_i + \\sum_{j \\in \\partial i} u_{j \\to i}$ is the total effective field on node $i$.\n\nFor the chain $1$–$2$–$3$ with $h_i=0$ and $J_{12}=J_{23}=J$:\nThe neighbors are $\\partial 1 = \\{2\\}$, $\\partial 2 = \\{1, 3\\}$, $\\partial 3 = \\{2\\}$.\nThe BP update equations are:\n1.  $u_{1 \\to 2}$: from leaf node $1$. $\\partial 1 \\setminus 2$ is empty.\n    $$ \\tanh(u_{1 \\to 2}) = \\tanh(J_{12}) \\tanh(h_1) = \\tanh(J) \\tanh(h_1) $$\n2.  $u_{3 \\to 2}$: from leaf node $3$. $\\partial 3 \\setminus 2$ is empty.\n    $$ \\tanh(u_{3 \\to 2}) = \\tanh(J_{23}) \\tanh(h_3) = \\tanh(J) \\tanh(h_3) $$\n3.  $u_{2 \\to 1}$:\n    $$ \\tanh(u_{2 \\to 1}) = \\tanh(J_{12}) \\tanh(h_2 + u_{3 \\to 2}) = \\tanh(J) \\tanh(h_2 + u_{3 \\to 2}) $$\n4.  $u_{2 \\to 3}$:\n    $$ \\tanh(u_{2 \\to 3}) = \\tanh(J_{23}) \\tanh(h_2 + u_{1 \\to 2}) = \\tanh(J) \\tanh(h_2 + u_{1 \\to 2}) $$\n\nAt zero field ($h_1=h_2=h_3=0$), all cavity fields $u_{i \\to j}$ are zero. The total fields are $H_i=0$, so the magnetizations are $\\langle x_i \\rangle = \\tanh(0) = 0$ for all $i$.\nThis implies the connected correlation is equal to the raw correlation: $C_{13} = \\langle x_1 x_3 \\rangle - \\langle x_1 \\rangle \\langle x_3 \\rangle = \\langle x_1 x_3 \\rangle$.\n\nWe compute $C_{13}$ using the linear response identity:\n$$\nC_{13} = \\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\nWe have $\\langle x_1 \\rangle = \\tanh(H_1) = \\tanh(h_1 + u_{2 \\to 1})$. Applying the chain rule:\n$$\n\\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3} = \\frac{d}{dH_1}\\big(\\tanh(H_1)\\big) \\frac{\\partial H_1}{\\partial h_3} = \\left(1 - \\tanh^2(H_1)\\right) \\left(\\frac{\\partial h_1}{\\partial h_3} + \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\right)\n$$\nEvaluating at $\\mathbf{h}=0$, we have $H_1=0$, $\\tanh(H_1)=0$, and $\\frac{\\partial h_1}{\\partial h_3}=0$. This simplifies to:\n$$\nC_{13} = \\frac{\\partial \\langle x_1 \\rangle}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = (1-0) \\left(0 + \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\\right) = \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\nThis quantity is the susceptibility, which we find by differentiating the BP update equations. Let's differentiate the equation for $u_{2 \\to 1}$ with respect to $h_3$:\n$$\n\\frac{\\partial}{\\partial h_3} \\tanh(u_{2 \\to 1}) = \\frac{\\partial}{\\partial h_3} \\left[ \\tanh(J) \\tanh(h_2 + u_{3 \\to 2}) \\right]\n$$\n$$\n(1 - \\tanh^2(u_{2 \\to 1})) \\frac{\\partial u_{2 \\to 1}}{\\partial h_3} = \\tanh(J) (1 - \\tanh^2(h_2 + u_{3 \\to 2})) \\left(\\frac{\\partial h_2}{\\partial h_3} + \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\right)\n$$\nEvaluating at $\\mathbf{h}=0$, all cavity fields are zero, so their hyperbolic tangents are zero. Also, $\\frac{\\partial h_2}{\\partial h_3}=0$.\n$$\n(1-0) \\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) (1-0) \\left(0 + \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\\right)\n$$\n$$\n\\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0}\n$$\nNow we need to find $\\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\big|_{\\mathbf{h}=0}$. We differentiate the equation for $u_{3 \\to 2}$:\n$$\n\\frac{\\partial}{\\partial h_3} \\tanh(u_{3 \\to 2}) = \\frac{\\partial}{\\partial h_3} [\\tanh(J) \\tanh(h_3)]\n$$\n$$\n(1 - \\tanh^2(u_{3 \\to 2})) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3} = \\tanh(J) (1 - \\tanh^2(h_3)) \\frac{\\partial h_3}{\\partial h_3}\n$$\nEvaluating at $\\mathbf{h}=0$:\n$$\n(1-0) \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) (1-0) (1) \\implies \\frac{\\partial u_{3 \\to 2}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J)\n$$\nSubstituting this result back:\n$$\n\\frac{\\partial u_{2 \\to 1}}{\\partial h_3}\\bigg|_{\\mathbf{h}=0} = \\tanh(J) \\cdot \\tanh(J) = \\tanh^2(J)\n$$\nTherefore, the connected correlation between nodes $1$ and $3$ is:\n$$\nC_{13} = \\tanh^2(J)\n$$\n\n**Part 3: Inference of the Coupling Strength $J$**\n\nThe problem provides the empirical connected covariance $\\hat{C}_{13} = 0.36$. The supplied formula for $\\hat{C}_{13}$ is the sample second moment $\\frac{1}{N}\\sum x_1^{(n)} x_3^{(n)}$, which is a valid estimator for the theoretical correlation $\\langle x_1 x_3 \\rangle$ given that the true means are zero. Equating the theoretical prediction with this empirical value:\n$$\n\\tanh^2(J) = 0.36\n$$\nSince the problem states $J>0$, we take the positive square root:\n$$\n\\tanh(J) = \\sqrt{0.36} = 0.6\n$$\nTo find $J$, we take the inverse hyperbolic tangent:\n$$\nJ = \\text{arctanh}(0.6)\n$$\nUsing the logarithmic definition of the inverse hyperbolic tangent, $\\text{arctanh}(y) = \\frac{1}{2} \\ln\\left(\\frac{1+y}{1-y}\\right)$:\n$$\nJ = \\frac{1}{2} \\ln\\left(\\frac{1+0.6}{1-0.6}\\right) = \\frac{1}{2} \\ln\\left(\\frac{1.6}{0.4}\\right) = \\frac{1}{2} \\ln(4)\n$$\nSince $\\ln(4) = \\ln(2^2) = 2 \\ln(2)$, we get:\n$$\nJ = \\frac{1}{2} (2 \\ln(2)) = \\ln(2)\n$$\nThe value of $\\ln(2)$ is approximately $0.69314718...$. Rounding to four significant figures, we get:\n$$\nJ \\approx 0.6931\n$$",
            "answer": "$$\n\\boxed{0.6931}\n$$"
        },
        {
            "introduction": "The exactness of the cavity method in its simplest form, the Bethe approximation, relies critically on the network being locally tree-like. This practice explores what happens when this assumption is violated by the presence of short loops, using the simplest possible example: a single triangle. By comparing the Bethe approximation to the more general Kikuchi cluster variational method, you will quantify the error introduced by loops and see how higher-order approximations can systematically improve accuracy, even yielding the exact solution. ",
            "id": "4308317",
            "problem": "Consider a binary pairwise Ising model defined on a three-node network that forms a single triangle (three nodes $i \\in \\{1,2,3\\}$ with edges $(1,2)$, $(2,3)$, and $(3,1)$). Each spin $s_i \\in \\{-1,+1\\}$ and there are no local fields. The interaction on each edge is identical and ferromagnetic with coupling $J>0$. Work in dimensionless units where the inverse temperature satisfies $\\beta=1$, so that the Boltzmann weight factor on edge $(i,j)$ is $\\psi_{ij}(s_i,s_j) = \\exp(J s_i s_j)$ and the exact partition function is $Z = \\sum_{\\boldsymbol{s}} \\prod_{(i,j)\\in E} \\psi_{ij}(s_i,s_j)$, where $\\boldsymbol{s}=(s_1,s_2,s_3)$ and $E$ is the set of edges.\n\nYou will compare the Bethe approximation and the Kikuchi approximation from the Cluster Variational Method (CVM) for this clustered graph and quantify the improvement in the free energy approximation. The Bethe approximation is the special case of the Cluster Variational Method (CVM) with regions given by edges and vertices, while the Kikuchi approximation with a triangle plaquette treats the three-spin triangle as a maximal region.\n\nTasks:\n1. Starting from the definition of the partition function and its relation to dimensionless free energy, compute the exact partition function $Z$ for this triangle and the exact free energy $F_{\\mathrm{exact}} = -\\ln Z$.\n2. Using the Bethe approximation, assume the symmetry-consistent Bethe beliefs $b_i(s_i)$ on vertices and $b_{ij}(s_i,s_j)$ on edges that satisfy the standard Bethe marginal consistency and minimize the Bethe free energy for this model. Compute the resulting Bethe free energy $F_{\\mathrm{B}}$ in closed form as a function of $J$.\n3. Using the Kikuchi approximation with the triangle plaquette as the maximal region, compute the Kikuchi free energy $F_{\\mathrm{K}}$ in closed form as a function of $J$. Justify each step from the fundamental definitions, including any counting-number and normalization arguments required by the CVM formalism.\n\nDefine the fractional error-reduction metric\n$$\nR \\equiv 1 - \\frac{|F_{\\mathrm{K}} - F_{\\mathrm{exact}}|}{|F_{\\mathrm{B}} - F_{\\mathrm{exact}}|}.\n$$\nReport the value of $R$ as a single exact number. No rounding is required. The free energies are dimensionless (in units where $\\beta=1$), and no units should be included in your final numerical answer.",
            "solution": "The problem asks for a comparison of the Bethe and Kikuchi approximations for the free energy of a three-node Ising model on a triangular lattice. We will first validate the problem statement.\n\n### Step 1: Extract Givens\n-   **Model**: A binary pairwise Ising model.\n-   **Network**: A three-node network forming a single triangle with nodes $i \\in \\{1,2,3\\}$ and edges $(1,2)$, $(2,3)$, and $(3,1)$.\n-   **Spins**: Each node has a spin $s_i \\in \\{-1,+1\\}$.\n-   **Local Fields**: There are no local fields.\n-   **Couplings**: The interaction on each edge is identical and ferromagnetic with coupling constant $J > 0$.\n-   **Inverse Temperature**: The inverse temperature is $\\beta=1$.\n-   **Boltzmann Weight**: The weight factor for an edge $(i,j)$ is $\\psi_{ij}(s_i,s_j) = \\exp(J s_i s_j)$.\n-   **Partition Function**: The exact partition function is $Z = \\sum_{\\boldsymbol{s}} \\prod_{(i,j)\\in E} \\psi_{ij}(s_i,s_j)$, where $\\boldsymbol{s}=(s_1,s_2,s_3)$ and $E$ is the set of edges.\n-   **Approximations**: The Bethe approximation (clusters are edges and vertices) and the Kikuchi approximation (maximal cluster is the triangle plaquette).\n-   **Metric**: The fractional error-reduction metric is defined as $R \\equiv 1 - \\frac{|F_{\\mathrm{K}} - F_{\\mathrm{exact}}|}{|F_{\\mathrm{B}} - F_{\\mathrm{exact}}|}$.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is set in the context of statistical mechanics, specifically the Ising model and the Cluster Variational Method (CVM). Both are well-established and fundamental concepts in physics and complex systems. The setup is a standard textbook example. This criterion is met.\n-   **Well-Posed**: The problem requests specific, calculable quantities ($F_{\\mathrm{exact}}$, $F_{\\mathrm{B}}$, $F_{\\mathrm{K}}$) and a final metric $R$ derived from them. The problem is structured to lead to a unique, meaningful solution. This criterion is met.\n-   **Objective**: The problem is stated using precise mathematical and physical terminology. There is no subjective or ambiguous language. This criterion is met.\n-   The problem is self-contained, consistent, and scientifically sound. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. We proceed with the solution.\n\n### Task 1: Exact Free Energy\nThe energy of a spin configuration $\\boldsymbol{s}=(s_1, s_2, s_3)$ is given by the Hamiltonian $H(\\boldsymbol{s}) = -J(s_1s_2 + s_2s_3 + s_3s_1)$. With $\\beta=1$, the probability of a configuration is $P(\\boldsymbol{s}) = \\frac{1}{Z}\\exp(-H(\\boldsymbol{s})) = \\frac{1}{Z}\\exp(J(s_1s_2 + s_2s_3 + s_3s_1))$.\nThere are $2^3=8$ possible spin configurations. We can group them by their energy:\n1.  All spins aligned: $(+1,+1,+1)$ and $(-1,-1,-1)$. For these configurations, $s_1s_2=s_2s_3=s_3s_1=1$. The energy is $H = -3J$. There are $2$ such states.\n2.  One spin flipped: e.g., $(+1,+1,-1)$. Here, $s_1s_2=+1$, while $s_2s_3=-1$ and $s_3s_1=-1$. The energy is $H = -J(1-1-1) = +J$. There are $3$ ways to choose one spin to be $+1$ and two to be $-1$, and $3$ ways to choose one spin to be $-1$ and two to be $+1$. So there are $6$ such states in total.\n\nThe partition function $Z$ is the sum of Boltzmann factors over all states:\n$$Z = \\sum_{\\boldsymbol{s}} \\exp(-H(\\boldsymbol{s})) = 2 \\cdot \\exp(3J) + 6 \\cdot \\exp(-J)$$\nThe exact dimensionless free energy $F_{\\mathrm{exact}}$ is:\n$$F_{\\mathrm{exact}} = -\\ln Z = -\\ln(2\\exp(3J) + 6\\exp(-J))$$\n\n### Task 2: Bethe Free Energy\nThe Bethe approximation considers edges as the maximal regions. For a general graph, the Bethe free energy functional is:\n$$F_{\\mathrm{B}} = \\sum_{(i,j) \\in E} \\left( \\sum_{s_i,s_j} b_{ij}(s_i,s_j) \\ln b_{ij}(s_i,s_j) + \\sum_{s_i,s_j} b_{ij}(s_i,s_j) (-J s_i s_j) \\right) - \\sum_{i \\in V} (d_i-1) \\sum_{s_i} b_i(s_i) \\ln b_i(s_i)$$\nwhere $b_{ij}$ and $b_i$ are the beliefs (variational probabilities) on edges and nodes, and $d_i$ is the degree of node $i$. For the triangle graph, all nodes have degree $d_i=2$, so $d_i-1=1$. The graph has $3$ nodes and $3$ edges. By symmetry, the beliefs will be identical for all nodes and all edges.\nLet $b_i(s_i) = b(s)$ and $b_{ij}(s_i,s_j) = b_{edge}(s_i,s_j)$. Due to the absence of an external field, the minimum free energy state will be unmagnetized, so $b(+1)=b(-1)=1/2$. The node entropy term is $\\sum_{s} b(s)\\ln b(s) = 2 \\cdot (\\frac{1}{2}\\ln\\frac{1}{2}) = -\\ln 2$.\nFor the edge belief, let $b_{edge}(+1,+1) = b_{edge}(-1,-1) = p_{++}$ and $b_{edge}(+1,-1) = b_{edge}(-1,+1) = p_{+-}$.\nNormalization requires $2p_{++} + 2p_{+-} = 1$. Marginalization requires $p_{++}+p_{+-} = b(+1) = 1/2$. These are consistent. Let $x = p_{++}$, then $p_{+-} = 1/2-x$.\nThe Bethe free energy for the triangle becomes:\n$$F_{\\mathrm{B}}(x) = 3 \\left( 2x\\ln x + 2(1/2-x)\\ln(1/2-x) \\right) - 3J(4x-1) - 3(-\\ln 2)$$\nThe energy contribution from one edge is $\\sum b_{ij}(-Js_is_j) = -J(p_{++} - p_{+-} - p_{-+} + p_{--}) = -J(2p_{++}-2p_{+-}) = -J(2x - 2(1/2-x)) = -J(4x-1)$.\nThe functional to minimize is:\n$$F_{\\mathrm{B}}(x) = 3 \\left( 2x\\ln x + 2(1/2-x)\\ln(1/2-x) \\right) - 3J(4x-1) + 3\\ln 2$$\nMinimizing with respect to $x$: $\\frac{dF_{\\mathrm{B}}}{dx} = 3(2\\ln x + 2 - 2\\ln(1/2-x) - 2) - 12J = 0$.\n$$6\\ln\\left(\\frac{x}{1/2-x}\\right) - 12J = 0 \\implies \\frac{x}{1/2-x} = \\exp(2J)$$\nSolving for $x$: $x = \\frac{\\exp(2J)}{2(1+\\exp(2J))}$. We can express this using hyperbolic functions. $x=p_{++}=\\frac{e^{J}}{4\\cosh J}$.\nThe standard result for the beliefs on an edge in the Bethe approximation is $b_{ij}(s_i,s_j) \\propto \\exp(Js_is_j)$, which normalized is $b_{ij}(s_i,s_j) = \\frac{\\exp(Js_is_j)}{2\\cosh J + 2\\cosh(-J)} = \\frac{\\exp(Js_is_j)}{4\\cosh J}$. This gives $p_{++} = \\frac{e^J}{4\\cosh J}$ and $p_{+-} = \\frac{e^{-J}}{4\\cosh J}$, consistent with our minimization.\nSubstituting these back into the free energy expression:\nThe average energy is $3 \\times (-J \\tanh J)$.\nThe edge entropy is $3 \\times \\sum_{s_i,s_j} b_{ij}\\ln b_{ij} = 3 \\times \\sum_{s_i,s_j} \\frac{e^{Js_is_j}}{4\\cosh J}(Js_is_j - \\ln(4\\cosh J)) = 3(J \\tanh J - \\ln(4\\cosh J))$.\nThe node entropy is $3 \\times (-\\ln 2)$.\nThe total Bethe free energy is:\n$$F_{\\mathrm{B}} = \\text{(Edge Energy)} + \\text{(Edge Entropy)} - (d-1)\\text{(Node Entropy)}$$\n$$F_{\\mathrm{B}} = 3(-J\\tanh J) + 3(J\\tanh J - \\ln(4\\cosh J)) - 3 \\cdot 1 \\cdot (-\\ln 2)$$\n$$F_{\\mathrm{B}} = -3\\ln(4\\cosh J) + 3\\ln 2 = -3\\ln(2\\cosh J)$$\n\n### Task 3: Kikuchi Free Energy\nThe Kikuchi approximation with the triangle as the maximal region uses the following set of regions for the CVM entropy expansion: the triangle itself $\\{1,2,3\\}$, the three edges $\\{(1,2), (2,3), (3,1)\\}$, and the three nodes $\\{1,2,3\\}$. The Moebius counting numbers $c_R$ for these regions are $c_{123}=1$, $c_{ij}=-1$ for edges, and $c_i=1$ for nodes.\nThe Kikuchi free energy functional is:\n$$F_{\\mathrm{K}} = \\sum_{\\mathbf{s}}b_{123}(\\mathbf{s}) E(\\mathbf{s}) + \\left(\\sum_{\\mathbf{s}}b_{123}\\ln b_{123} - \\sum_{(ij)}\\sum_{s_i,s_j}b_{ij}\\ln b_{ij} + \\sum_i\\sum_{s_i}b_i\\ln b_i\\right)$$\nwhere the lower-level beliefs are marginals of the highest-level belief $b_{123}$ and $E(\\mathbf{s}) = -J(s_1s_2+s_2s_3+s_3s_1)$.\nA fundamental result of the Cluster Variational Method is that if the set of maximal regions contains the entire graph itself (which is the case here, as the triangle is the whole graph), minimizing the variational free energy is equivalent to computing the exact free energy. The variational probability distribution $b_{123}(s_1,s_2,s_3)$ that minimizes the functional is the true Gibbs-Boltzmann distribution $P(\\boldsymbol{s}) = \\frac{1}{Z}\\exp(-E(\\boldsymbol{s}))$.\nThe minimum value of the variational free energy functional is the true free energy of the system.\nTherefore, the Kikuchi free energy is identical to the exact free energy:\n$$F_{\\mathrm{K}} = F_{\\mathrm{exact}} = -\\ln(2\\exp(3J) + 6\\exp(-J))$$\n\n### Final Calculation of the Metric R\nThe fractional error-reduction metric is defined as:\n$$R \\equiv 1 - \\frac{|F_{\\mathrm{K}} - F_{\\mathrm{exact}}|}{|F_{\\mathrm{B}} - F_{\\mathrm{exact}}|}$$\nUsing our finding that $F_{\\mathrm{K}} = F_{\\mathrm{exact}}$, the numerator becomes zero:\n$$|F_{\\mathrm{K}} - F_{\\mathrm{exact}}| = 0$$\nThe denominator is $|F_{\\mathrm{B}} - F_{\\mathrm{exact}}| = |-3\\ln(2\\cosh J) - (-\\ln(2e^{3J} + 6e^{-J}))|$. This term is non-zero for any $J>0$. For instance, in the limit $J \\to \\infty$, $F_{\\mathrm{B}} \\to -3J-3\\ln 2 + 3\\ln 2 = -3J$, while $F_{\\mathrm{exact}} \\to -\\ln(2e^{3J}) = -3J - \\ln 2$. The difference approaches $\\ln 2$. Since $J>0$ is given, the denominator is non-zero.\nSubstituting the values into the definition of $R$:\n$$R = 1 - \\frac{0}{|F_{\\mathrm{B}} - F_{\\mathrm{exact}}|} = 1 - 0 = 1$$\nThe value of $R$ is exactly $1$, which signifies that the Kikuchi approximation for this cluster choice completely eliminates the error of the Bethe approximation, providing the exact result.",
            "answer": "$$\\boxed{1}$$"
        }
    ]
}