{
    "hands_on_practices": [
        {
            "introduction": "此练习旨在探究突变体在图上的初始位置如何影响其演化命运。通过计算和比较在星形图的中心节点与叶节点上引入单个突变体的固着概率，我们可以具体地理解网络异质性如何影响选择过程。该练习为应用初次分析法处理吸收马尔可夫链提供了基础性训练。",
            "id": "4288454",
            "problem": "考虑一个有 $N = 3$ 个顶点的无向星形图：一个度为 $2$ 的中心节点和两个度为 $1$ 的叶节点。在适应度为 $1$ 的常驻体种群中，出现了一个相对适应度为 $r > 0$ 的单个突变体。该种群根据带有出生-死亡（birth-death, Bd）更新规则的图上莫兰过程进行演化：在每个时间步，一个个体以与其适应度成正比的概率被选择进行繁殖，其邻居之一被均匀随机地选择，并由其后代替换。\n\n令 $\\rho_{\\mathrm{hub}}(r)$ 表示当单个突变体被引入中心节点（度最高的节点）时的固定概率。令 $\\rho_{\\mathrm{leaf}}(r)$ 表示当单个突变体被引入叶节点时的固定概率。令 $\\bar{\\rho}(r)$ 表示单个突变体初始位置均匀随机时的平均固定概率，即 $\\bar{\\rho}(r) = \\frac{1}{3} \\left(\\rho_{\\mathrm{hub}}(r) + 2 \\rho_{\\mathrm{leaf}}(r)\\right)$。\n\n仅使用图上莫兰过程与Bd更新的基本定义以及吸收马尔可夫链的首步分析，计算比率\n$$\nR(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)}.\n$$\n给出关于 $r$ 的闭式解析表达式作为最终答案。不需要数值近似或四舍五入。",
            "solution": "**问题验证计划：**\n\n1.  **提取已知条件**：\n    *   图：具有 $N=3$ 个顶点的无向星形图。\n    *   一个中心节点，度为 $k_{hub} = 2$。\n    *   两个叶节点，度为 $k_{leaf} = 1$。\n    *   种群：$N=3$ 个个体。\n    *   类型：突变体和常驻体。\n    *   适应度：突变体适应度为 $r > 0$，常驻体适应度为 $1$。\n    *   初始条件：图上放置一个单个突变体。\n    *   演化动力学：带有出生-死亡（birth-death, Bd）更新规则的图上莫兰过程。\n    *   Bd 更新规则：\n        1.  选择一个个体进行繁殖，概率与其适应度成正比。\n        2.  均匀随机地选择其一个邻居。\n        3.  用后代替换被选中的邻居。\n    *   待计算量：\n        *   $\\rho_{\\mathrm{hub}}(r)$：固定概率，突变体从中心节点开始。\n        *   $\\rho_{\\mathrm{leaf}}(r)$：固定概率，突变体从叶节点开始。\n        *   $\\bar{\\rho}(r)$：均匀初始放置的平均固定概率。\n            $\\bar{\\rho}(r) = \\frac{1}{3} (\\rho_{\\mathrm{hub}}(r) + 2 \\rho_{\\mathrm{leaf}}(r))$\n    *   最终目标：计算比率 $R(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)}$。\n    *   方法论：使用基本定义和吸收马尔可夫链的首步分析。\n\n2.  **使用提取的已知条件进行验证**：\n    *   **科学上是否成立？**：是。图上莫兰过程是演化博弈论和复杂系统中的标准模型。该问题设置是一个教科书式的例子。\n    *   **是否适定？**：是。该问题要求计算有限状态吸收马尔可夫链中的固定概率。这是一个定义明确的数学问题，应该有唯一解。图结构简单且定义明确。\n    *   **是否客观？**：是。语言精确且技术性强。没有主观因素。\n    *   **科学或事实上是否不健全？**：否。该模型是一个标准的科学模型。\n    *   **是否无法形式化或不相关？**：否。该问题直接关于图上的莫兰过程。\n    *   **设置是否不完整或矛盾？**：否。所有必要信息都已提供。$N=3$，图结构已指定（1个中心节点，2个叶节点），更新规则清晰（Bd），适应度值已给出。\n    *   **是否不切实际或不可行？**：否。这是一个理论模型，因此物理真实性不是主要考虑因素，但在其领域内科学上是合理的。\n    *   **是否不适定或结构不良？**：否。应该存在唯一解。\n    *   **是否故作高深、琐碎或同义反复？**：否。它需要进行非平凡的计算，涉及建立并求解从首步分析导出的线性方程组。\n    *   **是否超出科学可验证范围？**：否。结果是一个可以被验证的数学推导。\n\n3.  **结论与行动**：\n    *   问题是**有效的**。\n    *   我将着手解决它。\n\n**解题计划：**\n\n1.  **定义马尔可夫链的状态。**\n    *   状态可以由突变体占据的顶点集合来定义。\n    *   状态 0：没有突变体（吸收）。记为 $S_0$。\n    *   状态 3：全部是突变体（固定）。记为 $S_{Fix}$。\n    *   突变体的数量为 $i \\in \\{0, 1, 2, 3\\}$。\n    *   由于顶点不是同一的，我们需要指明哪些顶点被占据。\n    *   设顶点为 $v_1$ (中心节点), $v_2$ (叶节点), $v_3$ (叶节点)。\n    *   有1个突变体的可能状态：\n        *   $S_{1,h}$：突变体在中心节点 ($v_1$)。\n        *   $S_{1,l}$：突变体在叶节点 (例如 $v_2$)。根据对称性，$v_3$ 的情况是相同的。\n    *   有2个突变体的可能状态：\n        *   $S_{2,hl}$：突变体在中心节点和一个叶节点 (例如 $v_1, v_2$)。\n        *   $S_{2,ll}$：突变体在两个叶节点 ($v_2, v_3$)。\n\n2.  **定义每个状态的固定概率。**\n    *   令 $\\pi_i$ 为从状态 $i$ 开始的固定概率。\n    *   我们想计算 $\\rho_{\\mathrm{hub}}(r) = \\pi_{S_{1,h}}$ 和 $\\rho_{\\mathrm{leaf}}(r) = \\pi_{S_{1,l}}$。\n    *   吸收态：$\\pi_{S_0} = 0$, $\\pi_{S_{Fix}} = 1$。\n\n3.  **使用首步分析建立线性方程组。**\n    *   对于一个瞬时态 $S_i$ 的方程是 $\\pi_i = \\sum_j P_{ij} \\pi_j$，其中 $P_{ij}$ 是从状态 $S_i$ 到 $S_j$ 的转移概率。\n    *   我们需要为 $\\pi_{S_{1,h}}$, $\\pi_{S_{1,l}}$, $\\pi_{S_{2,hl}}$, $\\pi_{S_{2,ll}}$ 建立方程。这看起来像一个4元线性方程组。\n\n4.  **计算转移概率 $P_{ij}$。**\n\n    *   需要计算任何状态下种群的总适应度。\n    *   让我们逐个状态分析。总适应度为 $\\mathcal{F}$。\n\n    *   **从状态 $S_{1,h}$ (突变体在中心节点 $v_1$)**：\n        *   突变体：$\\{v_1\\}$。常驻体：$\\{v_2, v_3\\}$。\n        *   总适应度 $\\mathcal{F} = r + 1 + 1 = r+2$。\n        *   选择突变体进行繁殖的概率：$P(\\text{select } v_1) = r / (r+2)$。\n        *   选择常驻体进行繁殖的概率：$P(\\text{select } v_2) = 1 / (r+2)$，$P(\\text{select } v_3) = 1 / (r+2)$。\n        *   **情况1：突变体 ($v_1$) 繁殖。**\n            *   后代替换一个邻居。$v_1$ 的邻居是 $v_2, v_3$。\n            *   替换 $v_2$：概率为 $1/2$。新状态为突变体在 $\\{v_1, v_2\\}$，即 $S_{2,hl}$。\n            *   替换 $v_3$：概率为 $1/2$。新状态为突变体在 $\\{v_1, v_3\\}$，根据对称性，这也是 $S_{2,hl}$。\n            *   所以，$P(S_{1,h} \\to S_{2,hl}) = \\frac{r}{r+2} \\times (\\frac{1}{2} + \\frac{1}{2}) = \\frac{r}{r+2}$。\n        *   **情况2：常驻体 ($v_2$) 繁殖。**\n            *   $v_2$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。新状态没有突变体。即状态 $S_0$ (吸收)。\n            *   $P(S_{1,h} \\to S_0) = \\frac{1}{r+2} \\times 1 = \\frac{1}{r+2}$。\n        *   **情况3：常驻体 ($v_3$) 繁殖。**\n            *   $v_3$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。新状态没有突变体。状态 $S_0$。\n            *   $P(S_{1,h} \\to S_0) = \\frac{1}{r+2} \\times 1 = \\frac{1}{r+2}$。\n        *   转移到 $S_0$ 的总概率：$P_{S_{1,h} \\to S_0} = \\frac{1}{r+2} + \\frac{1}{r+2} = \\frac{2}{r+2}$。\n        *   没有其他转移是可能的。\n        *   检查总和：$\\frac{r}{r+2} + \\frac{2}{r+2} = 1$。正确。\n        *   **$\\pi_{S_{1,h}}$ 的方程**：\n            $\\pi_{S_{1,h}} = P_{S_{1,h} \\to S_{2,hl}} \\pi_{S_{2,hl}} + P_{S_{1,h} \\to S_0} \\pi_{S_0}$\n            $\\pi_{S_{1,h}} = \\frac{r}{r+2} \\pi_{S_{2,hl}} + \\frac{2}{r+2} \\cdot 0$\n            $\\pi_{S_{1,h}} = \\frac{r}{r+2} \\pi_{S_{2,hl}}$ (方程 1)\n\n    *   **从状态 $S_{1,l}$ (突变体在叶节点 $v_2$)**：\n        *   突变体：$\\{v_2\\}$。常驻体：$\\{v_1, v_3\\}$。\n        *   总适应度 $\\mathcal{F} = 1 + r + 1 = r+2$。\n        *   选择突变体 ($v_2$) 的概率：$r / (r+2)$。\n        *   选择常驻体 ($v_1$) 的概率：$1 / (r+2)$。\n        *   选择常驻体 ($v_3$) 的概率：$1 / (r+2)$。\n        *   **情况1：突变体 ($v_2$) 繁殖。**\n            *   $v_2$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。新状态为突变体在 $\\{v_1, v_2\\}$，即 $S_{2,hl}$。\n            *   $P(S_{1,l} \\to S_{2,hl}) = \\frac{r}{r+2} \\times 1 = \\frac{r}{r+2}$。\n        *   **情况2：常驻体 ($v_1$) 繁殖。**\n            *   $v_1$ 的邻居是 $v_2, v_3$。\n            *   替换 $v_2$：概率 $1/2$。突变体消失。状态 $S_0$。\n            *   $P(S_{1,l} \\to S_0) = \\frac{1}{2(r+2)}$。\n        *   **情况3：常驻体 ($v_3$) 繁殖。**\n            *   $v_3$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。状态不变。（常驻体替换常驻体）。\n        *   所以，我们有到 $S_{2,hl}$、 $S_0$ 的转移和自循环。自循环概率为 $P(\\text{无变化}) = \\frac{1}{r+2} \\times \\frac{1}{2} + \\frac{1}{r+2} \\times 1 = \\frac{3}{2(r+2)}$。\n        *   从 $S_{1,l}$ 出发的总转移概率：\n            *   $P_{S_{1,l} \\to S_{2,hl}} = \\frac{r}{r+2}$\n            *   $P_{S_{1,l} \\to S_0} = \\frac{1}{2(r+2)}$\n            *   $P_{S_{1,l} \\to S_{1,l}} = \\frac{1}{2(r+2)} + \\frac{1}{r+2} = \\frac{3}{2(r+2)}$。\n            *   检查总和：$\\frac{r}{r+2} + \\frac{1}{2(r+2)} + \\frac{3}{2(r+2)} = \\frac{2r+1+3}{2(r+2)} = \\frac{2r+4}{2(r+2)} = 1$。正确。\n        *   **$\\pi_{S_{1,l}}$ 的方程**：\n            $\\pi_{S_{1,l}} = P_{S_{1,l} \\to S_{2,hl}} \\pi_{S_{2,hl}} + P_{S_{1,l} \\to S_0} \\pi_{S_0} + P_{S_{1,l} \\to S_{1,l}} \\pi_{S_{1,l}}$\n            $\\pi_{S_{1,l}} = \\frac{r}{r+2} \\pi_{S_{2,hl}} + 0 + \\frac{3}{2(r+2)} \\pi_{S_{1,l}}$\n            $\\pi_{S_{1,l}} (1 - \\frac{3}{2(r+2)}) = \\frac{r}{r+2} \\pi_{S_{2,hl}}$\n            $\\pi_{S_{1,l}} (\\frac{2r+4-3}{2(r+2)}) = \\frac{r}{r+2} \\pi_{S_{2,hl}}$\n            $\\pi_{S_{1,l}} (\\frac{2r+1}{2(r+2)}) = \\frac{r}{r+2} \\pi_{S_{2,hl}}$\n            $\\pi_{S_{1,l}} = \\frac{2r}{2r+1} \\pi_{S_{2,hl}}$ (方程 2)\n\n    *   **从状态 $S_{2,hl}$ (突变体在中心节点 $v_1$ 和叶节点 $v_2$)**：\n        *   突变体：$\\{v_1, v_2\\}$。常驻体：$\\{v_3\\}$。\n        *   总适应度 $\\mathcal{F} = r + r + 1 = 2r+1$。\n        *   选择突变体 $v_1$ 的概率：$r / (2r+1)$。\n        *   选择突变体 $v_2$ 的概率：$r / (2r+1)$。\n        *   选择常驻体 $v_3$ 的概率：$1 / (2r+1)$。\n        *   **情况1：突变体 ($v_1$) 繁殖。**\n            *   $v_1$ 的邻居是 $v_2, v_3$。\n            *   替换 $v_2$：概率 $1/2$。状态不变（突变体替换突变体）。\n            *   替换 $v_3$：概率 $1/2$。新状态为突变体在 $\\{v_1, v_2, v_3\\}$，即 $S_{Fix}$ (固定)。\n            *   $P(S_{2,hl} \\to S_{Fix}) = \\frac{r}{2(2r+1)}$。\n        *   **情况2：突变体 ($v_2$) 繁殖。**\n            *   $v_2$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。状态不变（突变体替换突变体）。\n        *   **情况3：常驻体 ($v_3$) 繁殖。**\n            *   $v_3$ 的邻居只有 $v_1$。\n            *   后代替换 $v_1$。新状态为突变体在 $\\{v_2\\}$，即 $S_{1,l}$。\n            *   $P(S_{2,hl} \\to S_{1,l}) = \\frac{1}{2r+1} \\times 1 = \\frac{1}{2r+1}$。\n        *   自循环概率：$\\frac{r}{2r+1} \\times \\frac{1}{2} + \\frac{r}{2r+1} \\times 1 = \\frac{3r}{2(2r+1)}$。\n        *   转移：到 $S_{Fix}$，到 $S_{1,l}$，和自循环。\n        *   $P_{S_{2,hl} \\to S_{Fix}} = \\frac{r}{2(2r+1)}$\n        *   $P_{S_{2,hl} \\to S_{1,l}} = \\frac{1}{2r+1}$\n        *   $P_{S_{2,hl} \\to S_{2,hl}} = \\frac{3r}{2(2r+1)}$\n        *   检查总和：$\\frac{r}{2(2r+1)} + \\frac{1}{2r+1} + \\frac{3r}{2(2r+1)} = \\frac{r+2+3r}{2(2r+1)} = \\frac{4r+2}{2(2r+1)} = \\frac{2(2r+1)}{2(2r+1)} = 1$。正确。\n        *   **$\\pi_{S_{2,hl}}$ 的方程**：\n            $\\pi_{S_{2,hl}} = P_{S_{2,hl} \\to S_{Fix}} \\pi_{S_{Fix}} + P_{S_{2,hl} \\to S_{1,l}} \\pi_{S_{1,l}} + P_{S_{2,hl} \\to S_{2,hl}} \\pi_{S_{2,hl}}$\n            $\\pi_{S_{2,hl}} = \\frac{r}{2(2r+1)} \\cdot 1 + \\frac{1}{2r+1} \\pi_{S_{1,l}} + \\frac{3r}{2(2r+1)} \\pi_{S_{2,hl}}$\n            $\\pi_{S_{2,hl}} (1 - \\frac{3r}{2(2r+1)}) = \\frac{r}{2(2r+1)} + \\frac{2}{2(2r+1)} \\pi_{S_{1,l}}$\n            $\\pi_{S_{2,hl}} (\\frac{2(2r+1) - 3r}{2(2r+1)}) = \\frac{r + 2\\pi_{S_{1,l}}}{2(2r+1)}$\n            $\\pi_{S_{2,hl}} (\\frac{4r+2-3r}{2(2r+1)}) = \\frac{r + 2\\pi_{S_{1,l}}}{2(2r+1)}$\n            $\\pi_{S_{2,hl}} (r+2) = r + 2\\pi_{S_{1,l}}$ (方程 3)\n            这似乎是一个关于 $\\pi_{S_{1,l}}$ 和 $\\pi_{S_{2,hl}}$ 的2个方程组。我还没有看到状态 $S_{2,ll}$ 参与其中。让我再检查一下。\n            是的，从 $S_{1,h}$ 或 $S_{1,l}$ 开始，只能到达状态 $S_{2,hl}$。状态 $S_{2,ll}$ (突变体在两个叶节点上) 是从只有一个突变体的状态无法到达的。\n            这极大地简化了问题。我不需要考虑 $\\pi_{S_{2,ll}}$。这意味着我最初的状态空间分解有点太宽泛了，但这不是错误。从单个突变体可达到的瞬时态只有 $\\{S_{1,h}, S_{1,l}, S_{2,hl}\\}$。\n\n5.  **求解方程组。**\n    *   我们有：\n        1.  $\\pi_{S_{1,h}} = \\frac{r}{r+2} \\pi_{S_{2,hl}}$\n        2.  $\\pi_{S_{1,l}} = \\frac{2r}{2r+1} \\pi_{S_{2,hl}}$\n        3.  $(r+2)\\pi_{S_{2,hl}} = r + 2\\pi_{S_{1,l}}$\n\n    *   将 (2) 代入 (3)：\n        $(r+2)\\pi_{S_{2,hl}} = r + 2 \\left( \\frac{2r}{2r+1} \\pi_{S_{2,hl}} \\right)$\n        $(r+2)\\pi_{S_{2,hl}} = r + \\frac{4r}{2r+1} \\pi_{S_{2,hl}}$\n        $\\pi_{S_{2,hl}} \\left( (r+2) - \\frac{4r}{2r+1} \\right) = r$\n        $\\pi_{S_{2,hl}} \\left( \\frac{(r+2)(2r+1) - 4r}{2r+1} \\right) = r$\n        $\\pi_{S_{2,hl}} \\left( \\frac{2r^2 + r + 4r + 2 - 4r}{2r+1} \\right) = r$\n        $\\pi_{S_{2,hl}} \\left( \\frac{2r^2 + r + 2}{2r+1} \\right) = r$\n        $\\pi_{S_{2,hl}} = \\frac{r(2r+1)}{2r^2+r+2}$\n\n    *   现在求 $\\pi_{S_{1,h}}$ 和 $\\pi_{S_{1,l}}$。\n        $\\rho_{\\mathrm{hub}}(r) = \\pi_{S_{1,h}} = \\frac{r}{r+2} \\pi_{S_{2,hl}} = \\frac{r}{r+2} \\frac{r(2r+1)}{2r^2+r+2} = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}$\n        $\\rho_{\\mathrm{leaf}}(r) = \\pi_{S_{1,l}} = \\frac{2r}{2r+1} \\pi_{S_{2,hl}} = \\frac{2r}{2r+1} \\frac{r(2r+1)}{2r^2+r+2} = \\frac{2r^2}{2r^2+r+2}$\n\n6.  **计算平均固定概率 $\\bar{\\rho}(r)$。**\n    *   $\\bar{\\rho}(r) = \\frac{1}{3} (\\rho_{\\mathrm{hub}}(r) + 2 \\rho_{\\mathrm{leaf}}(r))$\n    *   $\\rho_{\\mathrm{hub}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}$\n    *   $2\\rho_{\\mathrm{leaf}}(r) = 2 \\frac{2r^2}{2r^2+r+2} = \\frac{4r^2}{2r^2+r+2}$\n    *   $\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)} + \\frac{4r^2}{2r^2+r+2}$\n    *   公分母是 $(r+2)(2r^2+r+2)$。\n    *   $\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{r^2(2r+1) + 4r^2(r+2)}{(r+2)(2r^2+r+2)}$\n    *   分子：$2r^3 + r^2 + 4r^3 + 8r^2 = 6r^3 + 9r^2 = 3r^2(2r+3)$。\n    *   所以，$\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)}$。\n    *   $\\bar{\\rho}(r) = \\frac{1}{3} \\left( \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)} \\right) = \\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}$。\n\n7.  **计算最终比率 $R(r)$。**\n    *   $R(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)}$\n    *   $R(r) = \\frac{\\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}}{\\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}}$\n    *   公因子 $\\frac{r^2}{(r+2)(2r^2+r+2)}$ 可以消去，假设 $r0$。\n    *   $R(r) = \\frac{2r+1}{2r+3}$。\n\n8.  **最终检查。**\n    *   中性选择下，$r=1$ 时会怎样？\n        *   $\\rho_{\\mathrm{hub}}(1) = \\frac{1^2(2+1)}{(1+2)(2+1+2)} = \\frac{3}{3 \\cdot 5} = \\frac{1}{5}$。\n        *   $\\rho_{\\mathrm{leaf}}(1) = \\frac{2(1^2)}{2+1+2} = \\frac{2}{5}$。\n    *   在中性漂变下，大小为 $N$ 的种群中单个突变体的固定概率是 $1/N$。这里 $N=3$，所以我们期望得到 $1/3$。但这适用于图，所以不一定是 $1/N$。充分混合种群的结果是 $1/N$。\n    *   一个节点 $i$ 的温度是 $T_i = \\sum_{j \\in Nb(i)} \\frac{1}{d_i d_j}$。让我们为我们的图计算一下。\n            *   $d_{hub}=2, d_{leaf}=1$。\n            *   $T_{hub} = \\frac{1}{2 \\cdot 1} + \\frac{1}{2 \\cdot 1} = 1$。\n            *   $T_{leaf} = \\frac{1}{1 \\cdot 2} = \\frac{1}{2}$。\n            *   总温度 $T = \\sum_i T_i = T_{hub} + 2 T_{leaf} = 1 + 2(\\frac{1}{2}) = 2$。\n            *   从中性选择下一个节点 $i$ 的固定概率是 $\\rho_i(1) = T_i / T$。\n            *   $\\rho_{hub}(1) = T_{hub} / T = 1/2$。我的计算得出 $1/5$。这里有错误。\n            *   让我重新检查我的转移概率。\n\n**转移概率的重新评估**\n\n等等，规则是“一个个体被选择进行繁殖...其邻居之一被均匀随机地选择进行替换”。这正是我用的规则。让我再仔细地追溯一遍。温度公式适用于不同的更新规则，通常是“死亡-出生”或“投票者模型”类型的动力学。让我查一下文献中关于图上Bd的内容。\n\n所描述的规则确实是出生-死亡（Bd）。一个个体出生，其亲代根据适应度成比例选择。新的个体替换亲代的一个邻居。\n\n让我们再检查一遍中性情况 $r=1$。所有个体的适应度都是1。总适应度是3。\n任何个体以 $1/3$ 的概率被选择进行繁殖。\n\n*   **从状态 $S_{1,h}$ (突变体在中心节点 $v_1$)**：\n    *   总适应度 = 3。\n    *   选择 $v_1$ (突变体) 的概率 = $1/3$。它替换 $v_2$ 或 $v_3$ (各以 $1/2$ 概率)。新状态有2个突变体 $\\{v_1, v_2\\}$ 或 $\\{v_1, v_3\\}$。两者都是 $S_{2,hl}$。\n        *   $P(S_{1,h} \\to S_{2,hl}) = \\frac{1}{3} \\times 1 = \\frac{1}{3}$。\n    *   选择 $v_2$ (常驻体) 的概率 = $1/3$。它替换其唯一的邻居 $v_1$。新状态没有突变体。$S_0$。\n    *   选择 $v_3$ (常驻体) 的概率 = $1/3$。它替换其唯一的邻居 $v_1$。新状态没有突变体。$S_0$。\n    *   $P(S_{1,h} \\to S_0) = \\frac{1}{3} + \\frac{1}{3} = \\frac{2}{3}$。\n    *   $\\pi_{S_{1,h}}$ 的方程：$\\pi_{S_{1,h}} = \\frac{1}{3} \\pi_{S_{2,hl}} + \\frac{2}{3} \\cdot 0 = \\frac{1}{3} \\pi_{S_{2,hl}}$。\n    *   这与我 $r=1$ 时的通用公式相符：$\\pi_{S_{1,h}} = \\frac{1}{1+2} \\pi_{S_{2,hl}} = \\frac{1}{3} \\pi_{S_{2,hl}}$。检查通过。\n\n*   **从状态 $S_{1,l}$ (突变体在叶节点 $v_2$)**：\n    *   总适应度 = 3。\n    *   选择 $v_2$ (突变体) 的概率 = $1/3$。它替换邻居 $v_1$。新状态是 $\\{v_1, v_2\\}$，即 $S_{2,hl}$。\n        *   $P(S_{1,l} \\to S_{2,hl}) = \\frac{1}{3}$。\n    *   选择 $v_1$ (常驻体) 的概率 = $1/3$。它替换邻居 $v_2$ (概率 $1/2$) 或 $v_3$ (概率 $1/2$)。\n        *   替换 $v_2$：突变体消失。状态 $S_0$。$P(S_{1,l} \\to S_0) = \\frac{1}{3} \\times \\frac{1}{2} = \\frac{1}{6}$。\n        *   替换 $v_3$：常驻体替换常驻体。状态不变。\n    *   选择 $v_3$ (常驻体) 的概率 = $1/3$。它替换邻居 $v_1$。状态不变。\n    *   自循环概率：$\\frac{1}{3}\\times\\frac{1}{2} + \\frac{1}{3}\\times 1 = \\frac{1}{6} + \\frac{2}{6} = \\frac{3}{6} = \\frac{1}{2}$。\n    *   检查总和：$P(S_{1,l} \\to S_{2,hl}) + P(S_{1,l} \\to S_0) + P(\\text{自循环}) = \\frac{1}{3} + \\frac{1}{6} + \\frac{1}{2} = \\frac{2+1+3}{6} = 1$。正确。\n    *   $\\pi_{S_{1,l}}$ 的方程：$\\pi_{S_{1,l}} = \\frac{1}{3}\\pi_{S_{2,hl}} + \\frac{1}{2}\\pi_{S_{1,l}}$。\n        *   $\\frac{1}{2}\\pi_{S_{1,l}} = \\frac{1}{3}\\pi_{S_{2,hl}} \\implies \\pi_{S_{1,l}} = \\frac{2}{3}\\pi_{S_{2,hl}}$。\n    *   这与我 $r=1$ 时的通用公式相符：$\\pi_{S_{1,l}} = \\frac{2(1)}{2(1)+1} \\pi_{S_{2,hl}} = \\frac{2}{3}\\pi_{S_{2,hl}}$。检查通过。\n\n*   **从状态 $S_{2,hl}$ (突变体在 $v_1, v_2$)**：\n    *   总适应度 = 3。\n    *   选择 $v_1$ (突变体) 的概率 = $1/3$。替换邻居 $v_2$ (概率 $1/2$，无变化) 或 $v_3$ (概率 $1/2$，固定)。\n        *   $P(S_{2,hl} \\to S_{Fix}) = \\frac{1}{3} \\times \\frac{1}{2} = \\frac{1}{6}$。\n    *   选择 $v_2$ (突变体) 的概率 = $1/3$。替换邻居 $v_1$ (无变化)。\n    *   选择 $v_3$ (常驻体) 的概率 = $1/3$。替换邻居 $v_1$。新状态只有在 $v_2$ 的突变体。$S_{1,l}$。\n        *   $P(S_{2,hl} \\to S_{1,l}) = \\frac{1}{3}$。\n    *   自循环概率：$\\frac{1}{3}\\times\\frac{1}{2} + \\frac{1}{3} = \\frac{1}{6} + \\frac{2}{6} = \\frac{3}{6} = \\frac{1}{2}$。\n    *   检查总和：$P(S_{2,hl} \\to S_{Fix}) + P(S_{2,hl} \\to S_{1,l}) + P(\\text{自循环}) = \\frac{1}{6} + \\frac{1}{3} + \\frac{1}{2} = \\frac{1+2+3}{6} = 1$。正确。\n    *   $\\pi_{S_{2,hl}}$ 的方程：$\\pi_{S_{2,hl}} = \\frac{1}{6}\\pi_{S_{Fix}} + \\frac{1}{3}\\pi_{S_{1,l}} + \\frac{1}{2}\\pi_{S_{2,hl}}$。\n        *   $\\frac{1}{2}\\pi_{S_{2,hl}} = \\frac{1}{6}(1) + \\frac{1}{3}\\pi_{S_{1,l}}$。\n        *   $3\\pi_{S_{2,hl}} = 1 + 2\\pi_{S_{1,l}}$。\n    *   这与我 $r=1$ 时的通用公式相符：$(1+2)\\pi_{S_{2,hl}} = 1 + 2\\pi_{S_{1,l}} \\implies 3\\pi_{S_{2,hl}} = 1+2\\pi_{S_{1,l}}$。检查通过。\n\n*   **求解 $r=1$ 时的方程组**：\n    1.  $\\pi_{S_{1,h}} = \\frac{1}{3}\\pi_{S_{2,hl}}$\n    2.  $\\pi_{S_{1,l}} = \\frac{2}{3}\\pi_{S_{2,hl}}$\n    3.  $3\\pi_{S_{2,hl}} = 1 + 2\\pi_{S_{1,l}}$\n    *   将 (2) 代入 (3): $3\\pi_{S_{2,hl}} = 1 + 2(\\frac{2}{3}\\pi_{S_{2,hl}}) = 1 + \\frac{4}{3}\\pi_{S_{2,hl}}$。\n    *   $(3 - \\frac{4}{3})\\pi_{S_{2,hl}} = 1 \\implies \\frac{5}{3}\\pi_{S_{2,hl}} = 1 \\implies \\pi_{S_{2,hl}} = \\frac{3}{5}$。\n    *   现在求单个突变体状态的固定概率：\n        *   $\\rho_{\\mathrm{hub}}(1) = \\pi_{S_{1,h}} = \\frac{1}{3} \\pi_{S_{2,hl}} = \\frac{1}{3} \\times \\frac{3}{5} = \\frac{1}{5}$。\n        *   $\\rho_{\\mathrm{leaf}}(1) = \\pi_{S_{1,l}} = \\frac{2}{3} \\pi_{S_{2,hl}} = \\frac{2}{3} \\times \\frac{3}{5} = \\frac{2}{5}$。\n    *   我的计算似乎是正确的。为什么温度公式给出了不同的结果？\n\n我查找了一些评论，$\\rho_i(1) = T_i/T$ 这个公式适用于投票者模型或死亡-出生更新，而不是出生-死亡。例如，在死亡-出生（DB）更新中：1. 随机选择一个个体死亡，2. 其邻居竞争填补空缺（与适应度成正比）。在这种情况下，对于中性选择（$r=1$），任何图结构的固定概率都恰好是 $1/N$。这是一个已知结果。\n\n这个问题中的规则是Bd。我从第一性原理出发的推导对于给定的规则应该是正确的。\n我将相信我的分步推导。与一个已知公式的核对之所以失败，是因为我应用了一个错误更新规则的公式。我的分步推导是基于问题中给定的特定更新规则（Bd）。所以结果 $\\rho_{hub}(1) = 1/5$ 和 $\\rho_{leaf}(1) = 2/5$ 对于这个特定过程是正确的。\n\n让我们继续我的推导结果。\n$\\rho_{\\mathrm{hub}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}$\n$\\rho_{\\mathrm{leaf}}(r) = \\frac{2r^2}{2r^2+r+2}$\n\n让我们检查 $r=1$ 时的平均固定概率。\n$\\bar{\\rho}(1) = \\frac{1}{3} (\\rho_{\\mathrm{hub}}(1) + 2 \\rho_{\\mathrm{leaf}}(1)) = \\frac{1}{3} (\\frac{1}{5} + 2 \\times \\frac{2}{5}) = \\frac{1}{3} (\\frac{1}{5} + \\frac{4}{5}) = \\frac{1}{3} \\times 1 = \\frac{1}{3}$。\n这很有趣。即使是在这个图上的Bd更新，中性选择下的平均固定概率也是 $1/N$。这是一个在顶点传递图上某些过程的已知属性，但星形图不是顶点传递的。所以这可能是一个巧合，或者是一个我不知道的更普适的属性。\n让我们检查我的 $\\bar{\\rho}(r)$ 公式：\n$\\bar{\\rho}(r) = \\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}$\n对于 $r=1$，这给出 $\\bar{\\rho}(1) = \\frac{1^2(2+3)}{(1+2)(2+1+2)} = \\frac{5}{3 \\cdot 5} = \\frac{1}{3}$。它通过了检验。\n\n所以，我推导出的公式是自洽的，并且通过了平均概率的中性选择检验。我现在对我的推导有信心了。\n最终结果是比率：\n$R(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)} = \\frac{2r+1}{2r+3}$。\n\n让我快速重新检查一下代数运算。\n$\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)} + \\frac{4r^2(r+2)}{(r+2)(2r^2+r+2)}$\n$= \\frac{r^2(2r+1) + 4r^2(r+2)}{(r+2)(2r^2+r+2)}$\n分子：$2r^3 + r^2 + 4r^3 + 8r^2 = 6r^3 + 9r^2 = 3r^2(2r+3)$。正确。\n和为 $\\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)}$。\n$\\bar{\\rho}(r) = \\frac{1}{3} \\times \\text{和} = \\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}$。正确。\n$R(r) = \\frac{\\rho_{hub}(r)}{\\bar{\\rho}(r)} = \\frac{r^2(2r+1)/((r+2)(2r^2+r+2))}{r^2(2r+3)/((r+2)(2r^2+r+2))}$。\n因为 $r0$，$r^2 \\neq 0$。\n分母 $(r+2)(2r^2+r+2)$ 对 $r0$ 也非零。二次项 $2r^2+r+2$ 的判别式是 $\\Delta = 1^2 - 4(2)(2) = 1-16 = -15  0$，所以它总是正的。\n可以有效约分。\n$R(r) = \\frac{2r+1}{2r+3}$。\n代数运算是正确的。线性方程组的推导是正确的。线性方程组的解是正确的。最终计算是正确的。\n\n让我正式写下解答。\n\n1.  **引言**：定义图、状态和目标。\n    *   图 $G=(V, E)$，其中 $V=\\{v_c, v_{l1}, v_{l2}\\}$，$v_c$ 是中心节点，$v_{l1}, v_{l2}$ 是叶节点。\n    *   度：$k_c = 2$, $k_{l1} = k_{l2} = 1$。总种群大小 $N=3$。\n    *   适应度：突变体为 $f_M = r$，常驻体为 $f_R = 1$。\n    *   系统状态由突变体占据的顶点集合给出。总共有 $2^3 = 8$ 种可能的构型。\n    *   $0$个突变体（灭绝）和$3$个突变体（固定）的状态是吸收态。\n    *   我们感兴趣的是从只有一个突变体的状态 $S$ 开始的固定概率 $\\pi_S$。\n    *   根据对称性，有两个不同的单突变体起始状态：\n        *   $S_{1,h}$：突变体在中心节点 $v_c$。固定概率为 $\\rho_{\\mathrm{hub}}(r)$。\n        *   $S_{1,l}$：突变体在叶节点，例如 $v_{l1}$。固定概率为 $\\rho_{\\mathrm{leaf}}(r)$。\n    *   我们使用首步分析。$\\pi_S = \\sum_{S'} P_{S \\to S'} \\pi_{S'}$。\n\n2.  **状态空间与转移**：\n    *   从单突变体状态可达的相关瞬时态是：\n        *   $S_{1,h} = \\{v_c\\}$\n        *   $S_{1,l} = \\{v_{l1}\\}$ (或 $\\{v_{l2}\\}$)\n        *   $S_{2,hl} = \\{v_c, v_{l1}\\}$ (或 $\\{v_c, v_{l2}\\}$)\n        *   状态 $S_{2,ll} = \\{v_{l1}, v_{l2}\\}$ 是从任何单突变体状态无法到达的。叶节点 $v_{l1}$ 的突变体只能在 $v_c$ 放置后代。中心节点 $v_c$ 的突变体可以在 $v_{l1}$ 或 $v_{l2}$ 放置后代。在任何一种情况下，如果突变体数量从1增加到2，其中一个必然是中心节点。\n    *   令 $\\pi_{1h} = \\rho_{\\mathrm{hub}}(r)$, $\\pi_{1l} = \\rho_{\\mathrm{leaf}}(r)$，以及 $\\pi_{2hl}$ 为从这些状态开始的固定概率。令吸收态的概率为 $\\pi_0 = 0$ (灭绝) 和 $\\pi_3=1$ (固定)。\n\n3.  **推导线性方程组**：\n    *   对状态 $S_{1,h}$：总适应度是 $r+1+1 = r+2$。\n        *   选择突变体 (概率 $\\frac{r}{r+2}$)：繁殖到邻居（叶节点）。突变体数量变为2。状态变为 $S_{2,hl}$。概率 = $\\frac{r}{r+2} \\times (\\frac{1}{2}+\\frac{1}{2}) = \\frac{r}{r+2}$。\n        *   选择一个常驻体叶节点 (每个概率 $\\frac{1}{r+2}$)：繁殖到其唯一的邻居（中心节点）。突变体消失。状态变为 $S_0$。总概率 = $2 \\times \\frac{1}{r+2} = \\frac{2}{r+2}$。\n        *   方程：$\\pi_{1h} = \\frac{r}{r+2}\\pi_{2hl} + \\frac{2}{r+2}\\pi_0 \\implies \\pi_{1h} = \\frac{r}{r+2}\\pi_{2hl}$。\n\n    *   对状态 $S_{1,l}$：总适应度是 $r+1+1 = r+2$。\n        *   选择突变体 (概率 $\\frac{r}{r+2}$)：繁殖到其唯一的邻居（中心节点）。状态变为 $S_{2,hl}$。概率 = $\\frac{r}{r+2}$。\n        *   选择常驻体中心节点 (概率 $\\frac{1}{r+2}$)：繁殖到邻居。\n            *   替换突变体叶节点 (概率 $1/2$)：突变体消失。状态 $S_0$。概率 = $\\frac{1}{r+2}\\frac{1}{2} = \\frac{1}{2(r+2)}$。\n            *   替换另一个常驻体叶节点 (概率 $1/2$)：无变化。自循环。\n        *   选择另一个常驻体叶节点 (概率 $\\frac{1}{r+2}$)：繁殖到其邻居（中心节点）。无变化。自循环。\n        *   方程：$\\pi_{1l} = \\frac{r}{r+2}\\pi_{2hl} + \\frac{1}{2(r+2)}\\pi_0 + (\\frac{1}{2(r+2)} + \\frac{1}{r+2})\\pi_{1l}$\n            $\\pi_{1l} = \\frac{r}{r+2}\\pi_{2hl} + \\frac{3}{2(r+2)}\\pi_{1l}$\n            $\\pi_{1l}(1 - \\frac{3}{2(r+2)}) = \\frac{r}{r+2}\\pi_{2hl}$\n            $\\pi_{1l}(\\frac{2r+4-3}{2(r+2)}) = \\frac{r}{r+2}\\pi_{2hl}$\n            $\\pi_{1l} = \\frac{2r}{2r+1}\\pi_{2hl}$。\n\n    *   对状态 $S_{2,hl}$：总适应度是 $r+r+1 = 2r+1$。\n        *   选择突变体中心节点 (概率 $\\frac{r}{2r+1}$)：繁殖到邻居。\n            *   替换突变体叶节点 (概率 $1/2$)：无变化。自循环。\n            *   替换常驻体叶节点 (概率 $1/2$)：全部是突变体。固定。状态 $S_3$。概率 = $\\frac{r}{2(2r+1)}$。\n        *   选择突变体叶节点 (概率 $\\frac{r}{2r+1}$)：繁殖到其唯一的邻居（中心节点）。无变化。自循环。\n        *   选择常驻体叶节点 (概率 $\\frac{1}{2r+1}$)：繁殖到其唯一的邻居（中心节点）。一个突变体消失。状态变为 $S_{1,l}$。概率 = $\\frac{1}{2r+1}$。\n        *   方程：$\\pi_{2hl} = \\frac{r}{2(2r+1)}\\pi_3 + \\frac{1}{2r+1}\\pi_{1l} + (\\frac{r}{2(2r+1)} + \\frac{r}{2r+1})\\pi_{2hl}$\n            $\\pi_{2hl} = \\frac{r}{2(2r+1)} + \\frac{1}{2r+1}\\pi_{1l} + \\frac{3r}{2(2r+1)}\\pi_{2hl}$\n            $\\pi_{2hl}(1 - \\frac{3r}{2(2r+1)}) = \\frac{r}{2(2r+1)} + \\frac{2}{2(2r+1)}\\pi_{1l}$\n            $\\pi_{2hl}(\\frac{4r+2-3r}{2(2r+1)}) = \\frac{r+2\\pi_{1l}}{2(2r+1)}$\n            $\\pi_{2hl}(r+2) = r+2\\pi_{1l}$。\n\n4.  **求解固定概率**：\n    *   将 $\\pi_{1l} = \\frac{2r}{2r+1}\\pi_{2hl}$ 代入第三个方程：\n        $\\pi_{2hl}(r+2) = r+2(\\frac{2r}{2r+1}\\pi_{2hl}) = r + \\frac{4r}{2r+1}\\pi_{2hl}$\n        $\\pi_{2hl}(r+2 - \\frac{4r}{2r+1}) = r$\n        $\\pi_{2hl}(\\frac{(r+2)(2r+1) - 4r}{2r+1}) = r$\n        $\\pi_{2hl}(\\frac{2r^2+5r+2-4r}{2r+1}) = r$\n        $\\pi_{2hl}(\\frac{2r^2+r+2}{2r+1}) = r \\implies \\pi_{2hl} = \\frac{r(2r+1)}{2r^2+r+2}$。\n    *   $\\rho_{\\mathrm{hub}}(r) = \\pi_{1h} = \\frac{r}{r+2}\\pi_{2hl} = \\frac{r}{r+2}\\frac{r(2r+1)}{2r^2+r+2} = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}$。\n    *   $\\rho_{\\mathrm{leaf}}(r) = \\pi_{1l} = \\frac{2r}{2r+1}\\pi_{2hl} = \\frac{2r}{2r+1}\\frac{r(2r+1)}{2r^2+r+2} = \\frac{2r^2}{2r^2+r+2}$。\n\n5.  **计算最终比率**：\n    *   $\\bar{\\rho}(r) = \\frac{1}{3}(\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r))$。\n    *   $\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)} + 2 \\frac{2r^2}{2r^2+r+2}$\n        $= \\frac{r^2(2r+1)+4r^2(r+2)}{(r+2)(2r^2+r+2)}$\n        $= \\frac{2r^3+r^2+4r^3+8r^2}{(r+2)(2r^2+r+2)} = \\frac{6r^3+9r^2}{(r+2)(2r^2+r+2)} = \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)}$。\n    *   $\\bar{\\rho}(r) = \\frac{1}{3} \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)} = \\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}$。\n    *   $R(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)} = \\frac{\\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}}{\\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}}$。\n    *   因为 $r>0$，我们可以约去公因子得到 $R(r) = \\frac{2r+1}{2r+3}$。",
            "answer": "$$\n\\boxed{\\frac{2r+1}{2r+3}}\n$$"
        },
        {
            "introduction": "在直接计算固着概率的基础上，本问题深入到弱选择情景中，以推导一个关键的概括性统计量：结构系数 $\\sigma$。通过在一个简单的聚类图（三角形）上精确枚举状态转移，您将看到网络拓扑对演化博弈结果的复杂影响如何能被一个单一参数所捕捉。这项实践对于理解图结构如何系统性地支持或抑制某些策略至关重要。",
            "id": "4288429",
            "problem": "考虑在弱选择机制下，图上的莫兰过程采用出生-死亡（Bd）更新规则。设相互作用图为一个三角形，即一个有三个节点、度为$2$的正则图，其聚类系数为$1$。两种类型，$A$和$B$，在边上进行一个对称的 $2 \\times 2$ 博弈，其收益由矩阵条目给出：当$A$与$A$相遇时收益为$a$，当$A$与$B$相遇时收益为$b$，当$B$与$A$相遇时收益为$c$，当$B$与$B$相遇时收益为$d$。每个个体的适应度为 $f_i = 1 + w P_i$，其中 $P_i$ 是其从邻居处获得的总博弈收益，$w \\ge 0$ 是选择强度。在出生-死亡（Bd）更新规则下，每次更新时，一个个体以与其适应度成正比的概率被选择进行繁殖；其后代将替换一个均匀随机选择的邻居。\n\n从上述基本定义出发，对该三角形的替换事件和状态转移进行精确枚举，并对 $w$ 精确到一阶。设 $\\rho_A$ 为单个 $A$ 突变体在其余全为 $B$ 的群体中的固定概率，设 $\\rho_B$ 为单个 $B$ 突变体在其余全为 $A$ 的群体中的固定概率。证明 $\\rho_A - \\rho_B$ 的符号可以写成“结构系数”形式，即 $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ 的符号，其中 $K$ 是一个不依赖于 $a, b, c, d$ 的正常数，并确定在该出生-死亡（Bd）更新规则下，此三角形的结构系数 $\\sigma$。\n\n你的最终答案必须是 $\\sigma$ 的值，以单个精确数的形式给出。不需要四舍五入，也不涉及单位。",
            "solution": "首先根据指定标准验证问题陈述。\n\n### 步骤1：提取已知条件\n-   **过程**：图上的莫兰过程。\n-   **更新规则**：出生-死亡（Bd）：一个个体以与其适应度成正比的概率被选择进行繁殖；其后代替换一个均匀随机选择的邻居。\n-   **选择机制**：弱选择，选择强度为 $w$。\n-   **相互作用图**：一个三角形，即一个有 $3$ 个节点、度为 $2$ 的正则图，聚类系数为 $1$。\n-   **群体**：两种类型，$A$ 和 $B$，总大小为 $N=3$。\n-   **博弈论**：在边上进行一个对称的 $2 \\times 2$ 博弈。收益矩阵条目为：($A$, $A$) 为 $a$，($A$, $B$) 为 $b$，($B$, $A$) 为 $c$，($B$, $B$) 为 $d$。\n-   **适应度函数**：$f_i = 1 + w P_i$，其中 $P_i$ 是个体 $i$ 从其邻居处获得的总博弈收益。\n-   **关注量**：单个 $A$ 突变体在 $B$ 群体中的固定概率 $\\rho_A$，以及单个 $B$ 突变体在 $A$ 群体中的固定概率 $\\rho_B$。\n-   **目标**：证明 $\\rho_A - \\rho_B$ 的符号等价于 $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ 的符号，其中 $K$ 是一个不依赖于收益的正常数，并确定结构系数 $\\sigma$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，是良定且客观的。它描述了图上演化博弈论中的一个标准模型。问题设定是自洽的，并且在数学上是一致的。计算所需的所有参数和定义均已提供。图结构简单且定义明确。适应度函数和更新规则是文献中的标准形式。目标是精确的，并要求一个具体、可推导的量。该问题是有效的。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n\n系统的状态由 $A$ 类型个体的数量定义，记为 $i \\in \\{0, 1, 2, 3\\}$。状态 $i=0$ 和 $i=3$ 是吸收态（分别表示 $B$ 和 $A$ 的固定）。我们需要计算瞬态 $i=1$ 和 $i=2$ 的转移概率 $T_{i \\to i+1}$ 和 $T_{i \\to i-1}$。分析对选择强度 $w$ 精确到一阶。\n\n**状态 $i=1$：一个 $A$ 突变体，两个 $B$ 个体。**\n设节点标记为 $1, 2, 3$。设 $A$ 突变体位于节点 $1$，$B$ 个体位于节点 $2$ 和 $3$。由于图是三角形，每个节点都与其他两个节点相互作用。\n-   节点 $1$ 处 $A$ 个体的收益 $P_A$：它与两个 $B$ 个体相互作用。$P_A = b + b = 2b$。\n-   一个 $B$ 个体（例如节点 $2$ 处）的收益 $P_B$：它与一个 $A$（节点 $1$）和一个 $B$（节点 $3$）相互作用。$P_B = c + d$。节点 $3$ 处的 $B$ 个体收益相同。\n-   适应度值：\n    $f_A = 1 + w P_A = 1 + 2bw$\n    $f_B = 1 + w P_B = 1 + w(c+d)$\n-   群体总适应度：$F_1 = f_A + 2f_B = (1+2bw) + 2(1+w(c+d)) = 3 + w(2b+2c+2d)$。\n\n转移 $i=1 \\to i=2$（$A$ 增加）发生在该 $A$ 个体繁殖且其后代替换一个 $B$ 邻居时。\n-   $A$ 个体被选择繁殖的概率为 $f_A / F_1$。\n-   它的两个邻居都是 $B$ 类型，所以它替换 $B$ 的概率是 $1/2$。由于有两个这样的邻居，总替换概率是 $1/2+1/2=1$。\n-   $T_{1,2} = \\frac{f_A}{F_1}$。\n\n转移 $i=1 \\to i=0$（$A$ 减少）发生在一个 $B$ 个体繁殖且其后代替换那个 $A$ 邻居时。\n-   一个特定的 $B$ 个体（例如节点 $2$ 处）被选择的概率为 $f_B / F_1$。\n-   它的邻居是一个 $A$（节点 $1$）和一个 $B$（节点 $3$）。它替换 $A$ 的概率为 $1/2$。\n-   由于有两个 $B$ 个体，总概率为 $T_{1,0} = \\frac{f_B}{F_1} \\times \\frac{1}{2} + \\frac{f_B}{F_1} \\times \\frac{1}{2} = \\frac{f_B}{F_1}$。\n\n转移概率之比 $\\gamma_1 = T_{1,0} / T_{1,2}$ 为：\n$$ \\gamma_1 = \\frac{f_B/F_1}{f_A/F_1} = \\frac{f_B}{f_A} = \\frac{1 + w(c+d)}{1 + 2bw} $$\n对 $w$ 取一阶近似，使用近似式 $(1+x)/(1+y) \\approx 1+x-y$：\n$$ \\gamma_1 \\approx 1 + w(c+d) - 2bw = 1 + w(c+d-2b) $$\n\n**状态 $i=2$：两个 $A$ 个体，一个 $B$ 个体。**\n设 $A$ 个体位于节点 $1, 2$，$B$ 个体位于节点 $3$。\n-   一个 $A$ 个体（例如节点 $1$ 处）的收益 $P_A$：它与一个 $A$（节点 $2$）和一个 $B$（节点 $3$）相互作用。$P_A = a+b$。节点 $2$ 处的 $A$ 个体收益相同。\n-   节点 $3$ 处 $B$ 个体的收益 $P_B$：它与两个 $A$ 个体相互作用。$P_B = c+c = 2c$。\n-   适应度值：\n    $f_A = 1 + w P_A = 1 + w(a+b)$\n    $f_B = 1 + w P_B = 1 + 2cw$\n-   群体总适应度：$F_2 = 2f_A + f_B = 2(1+w(a+b)) + (1+2cw) = 3 + w(2a+2b+2c)$。\n\n转移 $i=2 \\to i=3$（$A$ 增加）发生在一个 $A$ 个体繁殖且其后代替换那个 $B$ 邻居时。\n-   一个特定的 $A$ 个体（例如节点 $1$ 处）被选择的概率为 $f_A/F_2$。\n-   它的邻居是一个 $A$（节点 $2$）和一个 $B$（节点 $3$）。它替换 $B$ 的概率为 $1/2$。\n-   由于有两个 $A$ 个体，总概率为 $T_{2,3} = \\frac{f_A}{F_2} \\times \\frac{1}{2} + \\frac{f_A}{F_2} \\times \\frac{1}{2} = \\frac{f_A}{F_2}$。\n\n转移 $i=2 \\to i=1$（$A$ 减少）发生在那个 $B$ 个体繁殖且其后代替换一个 $A$ 邻居时。\n-   $B$ 个体被选择的概率为 $f_B/F_2$。\n-   它的两个邻居都是 $A$ 类型，所以它替换 $A$ 的概率为 $1/2$。由于有两个 $A$ 邻居，总替换概率是 $1/2+1/2=1$。\n-   $T_{2,1} = \\frac{f_B}{F_2}$。\n\n转移概率之比 $\\gamma_2 = T_{2,1} / T_{2,3}$ 为：\n$$ \\gamma_2 = \\frac{f_B/F_2}{f_A/F_2} = \\frac{f_B}{f_A} = \\frac{1 + 2cw}{1 + w(a+b)} $$\n对 $w$ 取一阶近似：\n$$ \\gamma_2 \\approx 1 + 2cw - w(a+b) = 1 + w(2c-a-b) $$\n\n对于从大小为 $N$ 的群体中开始的单个突变体，其固定概率 $\\rho_A$ 由一维生死过程的公式给出：\n$$ \\rho_A = \\frac{1}{1 + \\sum_{k=1}^{N-1} \\prod_{j=1}^{k} \\gamma_j} $$\n对于 $N=3$，该公式为：\n$$ \\rho_A = \\frac{1}{1 + \\gamma_1 + \\gamma_1 \\gamma_2} $$\n代入 $\\gamma_1$ 和 $\\gamma_2$ 的一阶近似：\n$$ \\gamma_1 \\gamma_2 = (1 + w(c+d-2b))(1 + w(2c-a-b)) \\approx 1 + w(c+d-2b) + w(2c-a-b) = 1 + w(3c+d-a-3b) $$\n分母变为：\n$$ 1 + (1 + w(c+d-2b)) + (1 + w(3c+d-a-3b)) = 3 + w(c+d-2b + 3c+d-a-3b) = 3 + w(-a-5b+4c+2d) $$\n因此，固定概率为：\n$$ \\rho_A = \\frac{1}{3 + w(-a-5b+4c+2d)} = \\frac{1}{3} \\left( \\frac{1}{1 + \\frac{w}{3}(-a-5b+4c+2d)} \\right) $$\n对 $w$ 取一阶近似，使用 $(1+x)^{-1} \\approx 1-x$：\n$$ \\rho_A \\approx \\frac{1}{3} \\left( 1 - \\frac{w}{3}(-a-5b+4c+2d) \\right) = \\frac{1}{3} + \\frac{w}{9}(a+5b-4c-2d) $$\n单个 $B$ 突变体在 $A$ 群体中的固定概率 $\\rho_B$ 可以通过交换 $A$ 和 $B$ 的角色来找到。这对应于收益矩阵中的变换 $a \\leftrightarrow d$ 和 $b \\leftrightarrow c$。将这些变换应用于 $\\rho_A$ 的表达式：\n$$ \\rho_B \\approx \\frac{1}{3} + \\frac{w}{9}(d+5c-4b-2a) $$\n我们关心 $\\rho_A - \\rho_B$ 的符号：\n$$ \\rho_A - \\rho_B \\approx \\left( \\frac{1}{3} + \\frac{w}{9}(a+5b-4c-2d) \\right) - \\left( \\frac{1}{3} + \\frac{w}{9}(d+5c-4b-2a) \\right) $$\n$$ \\rho_A - \\rho_B \\approx \\frac{w}{9} \\left( (a+5b-4c-2d) - (d+5c-4b-2a) \\right) $$\n$$ \\rho_A - \\rho_B \\approx \\frac{w}{9} (a+5b-4c-2d - d-5c+4b+2a) $$\n$$ \\rho_A - \\rho_B \\approx \\frac{w}{9} (3a + 9b - 9c - 3d) $$\n$$ \\rho_A - \\rho_B \\approx \\frac{3w}{9} (a + 3b - 3c - d) = \\frac{w}{3} (a + 3b - 3c - d) $$\n问题陈述该表达式的符号可以写成一个正常数 $K$ 乘以 $w \\left( \\sigma a + b - c - \\sigma d \\right)$ 的符号。假设 $w > 0$，我们比较两个表达式的符号：\n$$ \\mathrm{sign}(a + 3b - 3c - d) = \\mathrm{sign}(\\sigma a + b - c - \\sigma d) $$\n为使此式对任意 $a,b,c,d$ 都成立，必须存在一个正常数 $C$ 使得：\n$$ a + 3b - 3c - d = C (\\sigma a + b - c - \\sigma d) $$\n$$ a + 3b - 3c - d = C \\sigma a + Cb - Cc - C\\sigma d $$\n通过比较两边收益参数的系数：\n-   $b$ 的系数：$3 = C$\n-   $c$ 的系数：$-3 = -C \\implies C=3$\n值 $C=3$ 是一致的且为正。\n-   $a$ 的系数：$1 = C\\sigma = 3\\sigma \\implies \\sigma = \\frac{1}{3}$\n-   $d$ 的系数：$-1 = -C\\sigma = -3\\sigma \\implies \\sigma = \\frac{1}{3}$\n值 $\\sigma = 1/3$ 也是一致的。\n因此，在出生-死亡更新规则下，三角形图的结构系数为 $\\sigma = 1/3$。\n$\\rho_A - \\rho_B$ 的完整表达式可以写为：\n$$ \\rho_A - \\rho_B = \\frac{w}{3} \\left( a + 3b - 3c - d \\right) = \\frac{w}{3} \\cdot 3 \\left( \\frac{1}{3}a + b - c - \\frac{1}{3}d \\right) = w \\left( \\frac{1}{3}a + b - c - \\frac{1}{3}d \\right) $$\n这与 $K=1$ 和 $\\sigma=1/3$ 时的形式 $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ 相匹配。",
            "answer": "$$\n\\boxed{\\frac{1}{3}}\n$$"
        },
        {
            "introduction": "前面的练习涉及针对特定小图的手动计算。这最后一个练习要求您将此过程推广为一个计算算法。通过将问题表述为一个线性方程组并实现一个求解器，您将开发一个能够计算任何小图上固着概率的工具，从而搭建起从理论分析到计算网络科学的桥梁。",
            "id": "4288406",
            "problem": "考虑一个有限、无向、简单图 $G = (V,E)$，其中 $|V| = n$。我们研究图上的莫兰过程（Moran process）的出生-死亡（birth-death, Bd）更新版本。每个顶点上有一个个体。一个子集 $S \\subseteq V$ 表示适应度为 $r > 0$ 的突变体所在的位置，而正常体的适应度为 $1$。在每个离散时间步，首先以与其适应度成正比的概率选择一个顶点 $i \\in V$ 进行繁殖，然后从其邻居中 $j \\in N(i)$ 随机均匀选择一个，用 $i$ 的后代替换之，该后代继承 $i$ 的类型。该过程有两个吸收态：$S = \\varnothing$（灭绝）和 $S = V$（固定）。对于任何非吸收态 $S$（一个瞬态），定义 $x(S)$ 为固定概率，即从状态 $S$ 开始的过程最终到达状态 $V$ 而非状态 $\\varnothing$ 的概率。\n\n仅从莫兰过程的出生-死亡更新版本的核心定义和基本的全概率定律出发，完成以下任务：\n\n1.  推导在瞬态空间上 $x(S)$ 满足的线性系统。具体来说，设 $x$ 是一个由所有瞬态 $S \\subset V$（其中 $S \\neq \\varnothing$ 且 $S \\neq V$）索引的向量。证明 $x$ 满足一个由单步全概率定律得到的线性系统，其边界条件为 $x(\\varnothing) = 0$ 和 $x(V) = 1$。将此系统表示为以下形式：\n    $$\n    (I - Q)\\,x = b,\n    $$\n    其中 $Q$ 是在出生-死亡更新下，限制在瞬态到瞬态转移的转移矩阵，而 $b$ 编码了从瞬态直接转移到固定态 $V$ 的单步转移。\n\n2.  概述一个适用于小 $n$ 值的精确算法。该算法通过枚举除 $\\varnothing$ 和 $V$ 之外的所有 $V$ 的子集，计算出生-死亡更新下的所有单步转移概率，从而从 $G$、$r$ 和瞬态集合构建 $Q$ 和 $b$，并通过求解线性系统 $(I - Q)\\,x = b$ 来获得任何初始瞬态集 $S$ 的 $x(S)$。\n\n3.  将此算法实现为一个完整的、可运行的程序。对于每个指定的测试用例，程序需要构建相应的矩阵，并计算给定初始集 $S_0$ 的固定概率 $x(S_0)$。您的实现必须遵守以下规定：\n\n    *   状态表示必须是纯粹基于 $V$ 的子集的组合表示；不允许进行随机模拟。\n    *   图由边列表指定。您可以假设图是连通的，并且没有孤立顶点，以避免除以零的错误。\n    *   所有计算必须在精确算术下完成，直到浮点线性代数求解阶段；不允许进行蒙特卡洛采样。\n\n测试套件：\n\n使用以下由图、适应度值和初始集组成的测试套件。每个图由其顶点集 $V = \\{0,1,\\dots,n-1\\}$ 和无向边列表 $E$ 给出。\n\n*   测试 $1$（边图 $K_2$）：$n = 2$，$E = \\{(0,1)\\}$，$r = 2.0$，$S_0 = \\{0\\}$。\n*   测试 $2$（完全图 $K_3$）：$n = 3$，$E = \\{(0,1),(1,2),(0,2)\\}$，$r = 2.0$，$S_0 = \\{0\\}$。\n*   测试 $3$（路径图 $P_3$）：$n = 3$，$E = \\{(0,1),(1,2)\\}$，$r = 0.5$，$S_0 = \\{1\\}$。\n*   测试 $4$（环图 $C_4$）：$n = 4$，$E = \\{(0,1),(1,2),(2,3),(3,0)\\}$，$r = 1.0$，$S_0 = \\{0,1\\}$。\n*   测试 $5$（5个顶点的星形图）：$n = 5$，$E = \\{(0,1),(0,2),(0,3),(0,4)\\}$，$r = 3.0$，$S_0 = \\{0\\}$。\n\n要求的最终输出格式：\n\n您的程序应生成一行输出，其中包含测试1到测试5的固定概率，按顺序排列，形式为一个用方括号括起来的逗号分隔列表。每个概率必须四舍五入到10位小数。例如，一个包含两个结果的输出应如下所示：$[0.1234567890,0.0987654321]$。\n\n不涉及物理单位。所有角度（如有）均不相关。所有结果必须是实数。唯一可接受的输出类型是按规定聚合到单个列表中的浮点数。",
            "solution": "该问题要求推导并求解一个线性系统，用于计算图上出生-死亡（Bd）莫兰过程中的固定概率。我们首先验证问题陈述，然后进行完整的推导和算法概述。\n\n### 问题验证\n\n**第一步：提取已知条件**\n\n*   **图：** 一个有限、无向、简单图 $G = (V,E)$，其中 $|V| = n$。\n*   **过程：** 出生-死亡（Bd）更新莫兰过程。\n*   **类型：** 相对适应度为 $r > 0$ 的突变体和适应度为 $1$ 的正常体。\n*   **状态：** $S \\subseteq V$，被突变体占据的顶点集合。\n*   **动态过程：**\n    1.  以与其适应度成正比的概率选择一个顶点 $i \\in V$ 进行繁殖。\n    2.  从其邻居中 $j \\in N(i)$ 随机均匀选择一个。\n    3.  位于 $j$ 的个体被 $i$ 的后代所取代。\n*   **吸收态：** $S = \\varnothing$（灭绝）和 $S = V$（固定）。\n*   **瞬态：** 所有满足 $S \\neq \\varnothing$ 且 $S \\neq V$ 的子集 $S$。\n*   **固定概率：** $x(S)$ 是从状态 $S$ 开始的过程达到固定的概率。\n*   **边界条件：** $x(\\varnothing) = 0$ 且 $x(V) = 1$。\n*   **任务1：** 推导线性系统 $(I - Q)x = b$。\n*   **任务2：** 概述一个构建并求解该系统的精确算法。\n*   **任务3：** 为指定的测试用例实现该算法。\n*   **测试用例：**\n    1.  $G=K_2, n=2, E=\\{(0,1)\\}, r=2.0, S_0=\\{0\\}$。\n    2.  $G=K_3, n=3, E=\\{(0,1),(1,2),(0,2)\\}, r=2.0, S_0=\\{0\\}$。\n    3.  $G=P_3, n=3, E=\\{(0,1),(1,2)\\}, r=0.5, S_0=\\{1\\}$。\n    4.  $G=C_4, n=4, E=\\{(0,1),(1,2),(2,3),(3,0)\\}, r=1.0, S_0=\\{0,1\\}$。\n    5.  $G=S_5$（星形图），$n=5, E=\\{(0,1),(0,2),(0,3),(0,4)\\}, r=3.0, S_0=\\{0\\}$。\n\n**第二步：使用提取的已知条件进行验证**\n\n该问题具有科学依据，是演化图论中的一个标准问题。该问题是适定的，因为对于有限状态吸收马尔可夫链，固定概率是唯一定义的，并且可以通过求解从全概率定律推导出的线性系统来找到。问题陈述是客观的，并提供了所有必要信息，包括图是连通的假设，这确保了吸收态的可达性。该问题是非平凡的，需要进行形式化推导和实现，没有违反任何无效性标准。\n\n**第三步：结论与行动**\n\n问题是**有效的**。我们将继续进行解答。\n\n### 推导与算法\n\n图上的莫兰过程定义了一个有限状态马尔可夫链。状态空间 $\\mathcal{S}$ 是顶点集 $V$ 的幂集，即 $\\mathcal{S} = 2^V$。这些状态可划分为两个吸收态，$\\varnothing$（全为正常体，灭绝）和 $V$（全为突变体，固定），以及一个瞬态集合 $\\mathcal{T} = \\{S \\subseteq V \\mid S \\neq \\varnothing \\text{ and } S \\neq V\\}$。\n\n我们关心的是任何状态 $S \\in \\mathcal{S}$ 的固定概率 $x(S)$。根据定义，我们有以下边界条件：\n$$\nx(\\varnothing) = 0 \\\\\nx(V) = 1\n$$\n对于任何瞬态 $S \\in \\mathcal{T}$，其固定概率 $x(S)$ 可以与单步可达状态的固定概率联系起来。对下一状态 $S'$ 使用全概率定律（或全期望定律），我们有：\n$$\nx(S) = \\sum_{S' \\in \\mathcal{S}} P(S \\to S') x(S')\n$$\n其中 $P(S \\to S')$ 是从状态 $S$ 到状态 $S'$ 的单步转移概率。我们可以将求和分为对瞬态和吸收态的求和：\n$$\nx(S) = \\sum_{S' \\in \\mathcal{T}} P(S \\to S') x(S') + P(S \\to V) x(V) + P(S \\to \\varnothing) x(\\varnothing)\n$$\n代入边界条件 $x(V)=1$ 和 $x(\\varnothing)=0$：\n$$\nx(S) = \\sum_{S' \\in \\mathcal{T}} P(S \\to S') x(S') + P(S \\to V)\n$$\n此方程对每个瞬态 $S \\in \\mathcal{T}$ 都成立。设瞬态的数量为 $M = |\\mathcal{T}| = 2^n - 2$。我们可以将这些状态的未知固定概率表示为一个大小为 $M$ 的向量 $x$。设瞬态从 $1$ 到 $M$ 索引。上述方程组可以写成矩阵形式：\n$$\nx = Qx + b\n$$\n在这里，$x$ 是固定概率的列向量 $[x(S_1), x(S_2), \\dots, x(S_M)]^T$。矩阵 $Q$ 是一个 $M \\times M$ 矩阵，其元素是瞬态到瞬态的转移概率，$Q_{ij} = P(S_i \\to S_j)$，其中 $S_i, S_j \\in \\mathcal{T}$。向量 $b$ 是一个大小为 $M$ 的列向量，其中 $b_i = P(S_i \\to V)$。重新整理该方程，得到所求的线性系统：\n$$\n(I - Q)x = b\n$$\n其中 $I$ 是 $M \\times M$ 的单位矩阵。\n\n为了构建 $Q$ 和 $b$，我们必须首先推导转移概率 $P(S \\to S')$。\n突变体的适应度为 $r$，正常体的适应度为 $1$。对于状态 $S$，突变体数量为 $|S|$，正常体数量为 $n - |S|$。种群的总适应度为 $F(S) = |S|r + (n - |S|)(1) = |S|(r-1) + n$。\n选择位于顶点 $i \\in S$ 的突变体进行繁殖的概率是 $\\frac{r}{F(S)}$。\n选择位于顶点 $i \\in V \\setminus S$ 的正常体进行繁殖的概率是 $\\frac{1}{F(S)}$。\n选择顶点 $i$ 的个体进行繁殖后，从其邻居 $j \\in N(i)$ 中随机均匀选择一个进行替换。选择特定邻居 $j$ 的概率是 $\\frac{1}{d_i}$，其中 $d_i = |N(i)|$ 是顶点 $i$ 的度。\n\n状态转移 $S \\to S'$ 仅当一个类型的个体替换了不同类型的个体时才会发生。这意味着 $|S'|$ 只能是 $|S|+1$ 或 $|S|-1$。\n\n1.  **突变体数量增加：** 对于某个 $j \\in V \\setminus S$，$S' = S \\cup \\{j\\}$。这发生在突变体繁殖且其后代替换了位于顶点 $j$ 的正常体。亲代突变体必须是 $j$ 的邻居，即 $i \\in S \\cap N(j)$。对所有可能的亲代突变体求和：\n    $$\n    P(S \\to S \\cup \\{j\\}) = \\sum_{i \\in S \\cap N(j)} \\left( \\frac{r}{F(S)} \\cdot \\frac{1}{d_i} \\right) = \\frac{r}{F(S)} \\sum_{i \\in S \\cap N(j)} \\frac{1}{d_i}\n    $$\n    如果 $|S| = n-1$ 且 $V \\setminus S = \\{j\\}$，这个转移导致固定，$S' = V$。因此，对于这样的状态 $S$，$b_S = P(S \\to V) = P(S \\to S \\cup \\{j\\})$。如果 $|S|  n-1$，这会贡献到 $Q$ 矩阵的一个元素中。\n\n2.  **突变体数量减少：** 对于某个 $j \\in S$，$S' = S \\setminus \\{j\\}$。这发生在正常体繁殖且其后代替换了位于顶点 $j$ 的突变体。亲代正常体必须是 $j$ 的邻居，即 $i \\in (V \\setminus S) \\cap N(j)$。对所有可能的亲代正常体求和：\n    $$\n    P(S \\to S \\setminus \\{j\\}) = \\sum_{i \\in (V \\setminus S) \\cap N(j)} \\left( \\frac{1}{F(S)} \\cdot \\frac{1}{d_i} \\right) = \\frac{1}{F(S)} \\sum_{i \\in (V \\setminus S) \\cap N(j)} \\frac{1}{d_i}\n    $$\n    如果 $|S|=1$ 且 $S=\\{j\\}$，这个转移导致灭绝，$S'=\\varnothing$。这个概率不会出现在 $x$ 的系统中。对于 $|S|>1$，这会贡献到 $Q$ 矩阵的一个元素中。\n\n3.  **种群数量不变：** $S' = S$。这发生在突变体替换突变体或正常体替换正常体时。该概率由全概率法则给出：\n    $$\n    P(S \\to S) = 1 - \\sum_{j \\in V \\setminus S} P(S \\to S \\cup \\{j\\}) - \\sum_{j \\in S} P(S \\to S \\setminus \\{j\\})\n    $$\n    这个概率构成了矩阵 $Q$ 的对角线元素。\n\n### 算法概述\n\n1.  **输入：** 图参数（$n$、边列表 $E$）、适应度 $r$ 和初始突变体集合 $S_0$。\n2.  **状态空间索引：**\n    *   $2^n-2$ 个瞬态由整数（位掩码）从 $1$ 到 $2^n-2$ 表示。\n    *   对应于位掩码 $m$ 的状态 $S$ 映射到矩阵索引 $k = m-1$。\n3.  **图的预计算：**\n    *   构建图 $G$ 的邻接表表示。\n    *   计算每个顶点 $i \\in V$ 的度 $d_i$。\n4.  **矩阵构建：**\n    *   初始化一个 $M \\times M$ 的零矩阵 $Q$ 和一个 $M$ 元素的零向量 $b$，其中 $M=2^n-2$。\n    *   遍历从 $0$ 到 $M-1$ 的每个瞬态索引 $k$。\n        *   确定对应的状态 $S$（根据其位掩码 $m=k+1$）。\n        *   计算总适应度 $F(S) = |S|(r-1) + n$。\n        *   计算所有 $S' \\neq S$ 的单步转移概率 $P(S \\to S')$：\n            *   对于每个正常体 $j \\in V \\setminus S$，计算 $p_{inc} = P(S \\to S \\cup \\{j\\})$。新状态是 $S' = S \\cup \\{j\\}$。如果 $S' = V$，则将 $p_{inc}$ 加到 $b_k$。否则，找到 $S'$ 的索引 $k'$ 并将 $p_{inc}$ 加到 $Q_{k,k'}$。\n            *   对于每个突变体 $j \\in S$，计算 $p_{dec} = P(S \\to S \\setminus \\{j\\})$。新状态是 $S' = S \\setminus \\{j\\}$。如果 $S' = \\varnothing$，这个概率会被记录但不会在系统中使用。否则，找到 $S'$ 的索引 $k'$ 并将 $p_{dec}$ 加到 $Q_{k,k'}$。\n        *   计算对角线元素 $Q_{k,k} = P(S \\to S)$，其值为 $1$ 减去所有到不同状态（$S' \\neq S$）的出射概率之和。\n5.  **求解系统：**\n    *   构建矩阵 $A = I - Q$。\n    *   求解线性系统 $Ax = b$，得到固定概率向量 $x$。\n6.  **输出：**\n    *   找到初始状态 $S_0$ 对应的索引 $k_0$。\n    *   结果是解向量 $x$ 的第 $k_0$ 个元素。\n该算法通过枚举整个瞬态空间并求解得到的线性方程组来提供精确解。其复杂度主要由状态空间的大小决定，因此适用于较小的 $n$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\nfrom itertools import chain, combinations\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test 1 (K2)\n        {\"n\": 2, \"edges\": [(0, 1)], \"r\": 2.0, \"S0\": {0}},\n        # Test 2 (K3)\n        {\"n\": 3, \"edges\": [(0, 1), (1, 2), (0, 2)], \"r\": 2.0, \"S0\": {0}},\n        # Test 3 (P3)\n        {\"n\": 3, \"edges\": [(0, 1), (1, 2)], \"r\": 0.5, \"S0\": {1}},\n        # Test 4 (C4)\n        {\"n\": 4, \"edges\": [(0, 1), (1, 2), (2, 3), (3, 0)], \"r\": 1.0, \"S0\": {0, 1}},\n        # Test 5 (Star on 5 vertices)\n        {\"n\": 5, \"edges\": [(0, 1), (0, 2), (0, 3), (0, 4)], \"r\": 3.0, \"S0\": {0}},\n    ]\n\n    results = []\n    for case in test_cases:\n        prob = calculate_fixation_probability(\n            case[\"n\"], case[\"edges\"], case[\"r\"], case[\"S0\"]\n        )\n        results.append(f\"{prob:.10f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_fixation_probability(n, edges, r, S0):\n    \"\"\"\n    Calculates the fixation probability for a given graph, fitness, and initial state.\n    \n    This function implements the exact algorithm based on solving the linear system\n    derived from the Moran process master equation.\n    \"\"\"\n    \n    # 1. Graph pre-computation\n    adj = [set() for _ in range(n)]\n    degrees = np.zeros(n, dtype=int)\n    for u, v in edges:\n        adj[u].add(v)\n        adj[v].add(u)\n        degrees[u] += 1\n        degrees[v] += 1\n\n    # 2. State space setup\n    num_transient = 2**n - 2\n    if num_transient == 0: # Handle trivial cases n=0, n=1\n        return 1.0 if len(S0) == n else 0.0\n\n    # state_mask -> matrix_index mapping is (mask - 1)\n    # matrix_index -> state_mask mapping is (index + 1)\n\n    # 3. Matrix construction\n    Q = np.zeros((num_transient, num_transient), dtype=float)\n    b = np.zeros(num_transient, dtype=float)\n    \n    all_vertices = set(range(n))\n    full_mask = 2**n - 1\n\n    for k_idx in range(num_transient):\n        s_mask = k_idx + 1\n        \n        s_set = set()\n        for i in range(n):\n            if (s_mask >> i)  1:\n                s_set.add(i)\n        \n        s_cardinality = len(s_set)\n        total_fitness = s_cardinality * r + (n - s_cardinality)\n        \n        # This will hold sum of probabilities of transitions to any S' != S\n        total_outgoing_prob = 0.0\n\n        # Case 1: Mutant expansion\n        complement_s = all_vertices - s_set\n        for j_resident in complement_s:\n            prob_inc = 0.0\n            neighbors_of_j = adj[j_resident]\n            mutant_neighbors = s_set.intersection(neighbors_of_j)\n            \n            for i_mutant in mutant_neighbors:\n                if degrees[i_mutant] > 0:\n                    prob_inc += (r / total_fitness) / degrees[i_mutant]\n            \n            if prob_inc > 0:\n                total_outgoing_prob += prob_inc\n                s_prime_mask = s_mask | (1  j_resident)\n                \n                if s_prime_mask == full_mask: # Transition to fixation\n                    b[k_idx] += prob_inc\n                else: # Transition to another transient state\n                    s_prime_idx = s_prime_mask - 1\n                    Q[k_idx, s_prime_idx] += prob_inc\n\n        # Case 2: Mutant contraction\n        for j_mutant in s_set:\n            prob_dec = 0.0\n            neighbors_of_j = adj[j_mutant]\n            resident_neighbors = complement_s.intersection(neighbors_of_j)\n            \n            for i_resident in resident_neighbors:\n                if degrees[i_resident] > 0:\n                    prob_dec += (1.0 / total_fitness) / degrees[i_resident]\n\n            if prob_dec > 0:\n                total_outgoing_prob += prob_dec\n                s_prime_mask = s_mask  ~(1  j_mutant)\n\n                if s_prime_mask == 0: # Transition to extinction\n                    pass # This does not contribute to Q or b\n                else: # Transition to another transient state\n                    s_prime_idx = s_prime_mask - 1\n                    Q[k_idx, s_prime_idx] += prob_dec\n        \n        # Diagonal element of Q: P(S -> S)\n        Q[k_idx, k_idx] = 1.0 - total_outgoing_prob\n\n    # 4. Solve the linear system (I - Q)x = b\n    A = np.identity(num_transient) - Q\n    try:\n        x = linalg.solve(A, b, assume_a='gen')\n    except linalg.LinAlgError:\n        # Fallback to a least-squares solver if the matrix is singular,\n        # which can happen in fringe cases but shouldn't for connected graphs.\n        x, _, _, _ = linalg.lstsq(A, b)\n\n    # 5. Extract the result for the initial state S0\n    s0_mask = 0\n    for i in S0:\n        s0_mask |= (1  i)\n    \n    # Check if S0 is absorbing\n    if s0_mask == 0: # Extinction\n        return 0.0\n    if s0_mask == full_mask: # Fixation\n        return 1.0\n\n    s0_idx = s0_mask - 1\n    return x[s0_idx]\n\n# Execute the solver\nsolve()\n\n```"
        }
    ]
}