{
    "hands_on_practices": [
        {
            "introduction": "To truly master the Moran process, it is essential to move from abstract formulas to concrete calculations. This first exercise provides an opportunity to derive a fundamental result from first principles. You will analyze the process on a simple triangle graph, a structure that, despite its size, introduces the crucial effect of clustering.\n\nBy performing an exact enumeration of state transitions under weak selection, this practice  demonstrates how to calculate the structure coefficient $\\sigma$, a key parameter that quantifies how a graph's topology modulates the impact of game-theoretic payoffs on evolutionary success. This hands-on calculation builds a deep, foundational understanding of the interplay between game theory and network structure.",
            "id": "4288429",
            "problem": "Consider the Moran process on graphs under the Birth–death (Bd) update in the weak selection regime. Let the interaction graph be a triangle, that is, a three-node, degree-$2$ regular graph with clustering coefficient $1$. Two types, $A$ and $B$, play a symmetric $2 \\times 2$ game on edges with payoffs given by the matrix entries: when $A$ meets $A$ the payoff is $a$, when $A$ meets $B$ the payoff is $b$, when $B$ meets $A$ the payoff is $c$, and when $B$ meets $B$ the payoff is $d$. Every individual’s fitness is $f_i = 1 + w P_i$, where $P_i$ is the sum of game payoffs from its neighbors and $w \\ge 0$ is the selection intensity. Under Bd, at each update one individual is chosen for reproduction with probability proportional to its fitness; its offspring replaces a uniformly random neighbor.\n\nStarting from the fundamental definitions above, perform an exact enumeration of replacement events and state transitions for this triangle to first order in $w$. Let $\\rho_A$ be the fixation probability of a single $A$ mutant in an otherwise all-$B$ population, and let $\\rho_B$ be the fixation probability of a single $B$ mutant in an otherwise all-$A$ population. Show that the sign of $\\rho_A - \\rho_B$ can be written in the “structure coefficient” form as the sign of $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ for some positive constant $K$ that does not depend on $a$, $b$, $c$, and $d$, and identify the structure coefficient $\\sigma$ for this triangle under Bd.\n\nYour final answer must be the value of $\\sigma$ as a single exact number. No rounding is required and no units are involved.",
            "solution": "The problem statement is first validated against the specified criteria.\n\n### Step 1: Extract Givens\n-   **Process**: Moran process on a graph.\n-   **Update Rule**: Birth–death (Bd): an individual is chosen for reproduction with probability proportional to its fitness; its offspring replaces a uniformly random neighbor.\n-   **Selection Regime**: Weak selection, with selection intensity $w$.\n-   **Interaction Graph**: A triangle, which is a $3$-node, degree-$2$ regular graph with clustering coefficient $1$.\n-   **Population**: Two types, $A$ and $B$, with total size $N=3$.\n-   **Game Theory**: A symmetric $2 \\times 2$ game is played on edges. Payoff matrix entries are: $a$ for ($A$, $A$), $b$ for ($A$, $B$), $c$ for ($B$, $A$), and $d$ for ($B$, $B$).\n-   **Fitness Function**: $f_i = 1 + w P_i$, where $P_i$ is the sum of game payoffs for individual $i$ from its neighbors.\n-   **Quantities of Interest**: Fixation probability $\\rho_A$ of a single $A$ mutant in a $B$ population, and $\\rho_B$ of a single $B$ mutant in an $A$ population.\n-   **Objective**: Show that the sign of $\\rho_A - \\rho_B$ is equivalent to the sign of $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ for a positive constant $K$ independent of payoffs, and determine the structure coefficient $\\sigma$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard model from evolutionary game theory on graphs. The setup is self-contained and mathematically consistent. All required parameters and definitions for the calculation are provided. The graph structure is simple and well-defined. The fitness function and update rule are standard in the literature. The objective is precise and requires a specific, derivable quantity. The problem is valid.\n\n### Step 3: Verdict and Action\nThe problem is valid. A full solution will be provided.\n\n### Solution Derivation\n\nThe state of the system is defined by the number of individuals of type $A$, denoted by $i \\in \\{0, 1, 2, 3\\}$. States $i=0$ and $i=3$ are absorbing states (fixation of $B$ and $A$, respectively). We need to calculate the transition probabilities $T_{i \\to i+1}$ and $T_{i \\to i-1}$ for the transient states $i=1$ and $i=2$. The analysis is performed to the first order in the selection intensity $w$.\n\n**State $i=1$: One $A$ mutant, two $B$ residents.**\nLet the nodes be labeled $1, 2, 3$. Let the $A$ mutant be at node $1$ and the $B$ residents at nodes $2$ and $3$. Since the graph is a triangle, each node interacts with the other two.\n-   Payoff for the $A$ individual at node $1$, $P_A$: it interacts with two $B$ individuals. $P_A = b + b = 2b$.\n-   Payoff for a $B$ individual (e.g., at node $2$), $P_B$: it interacts with one $A$ (node $1$) and one $B$ (node $3$). $P_B = c + d$. This is the same for the $B$ at node $3$.\n-   Fitness values:\n    $f_A = 1 + w P_A = 1 + 2bw$\n    $f_B = 1 + w P_B = 1 + w(c+d)$\n-   Total fitness in the population: $F_1 = f_A + 2f_B = (1+2bw) + 2(1+w(c+d)) = 3 + w(2b+2c+2d)$.\n\nThe transition $i=1 \\to i=2$ (increase in $A$) occurs if the $A$ individual reproduces and its offspring replaces a $B$ neighbor.\n-   The $A$ individual is chosen for reproduction with probability $f_A / F_1$.\n-   Both of its neighbors are of type $B$, so replacement of a $B$ occurs with probability $1$.\n-   $T_{1,2} = \\frac{f_A}{F_1}$.\n\nThe transition $i=1 \\to i=0$ (decrease in $A$) occurs if a $B$ individual reproduces and its offspring replaces the $A$ neighbor.\n-   A specific $B$ individual (e.g., at node $2$) is chosen with probability $f_B / F_1$.\n-   Its neighbors are one $A$ (node $1$) and one $B$ (node $3$). It replaces the $A$ with probability $1/2$.\n-   Since there are two $B$ individuals, the total probability is $T_{1,0} = \\frac{f_B}{F_1} \\times \\frac{1}{2} + \\frac{f_B}{F_1} \\times \\frac{1}{2} = \\frac{f_B}{F_1}$.\n\nThe ratio of transition probabilities $\\gamma_1 = T_{1,0} / T_{1,2}$ is:\n$$ \\gamma_1 = \\frac{f_B/F_1}{f_A/F_1} = \\frac{f_B}{f_A} = \\frac{1 + w(c+d)}{1 + 2bw} $$\nTo first order in $w$, using the approximation $(1+x)/(1+y) \\approx 1+x-y$:\n$$ \\gamma_1 \\approx 1 + w(c+d) - 2bw = 1 + w(c+d-2b) $$\n\n**State $i=2$: Two $A$ individuals, one $B$ resident.**\nLet the $A$ individuals be at nodes $1, 2$ and the $B$ resident at node $3$.\n-   Payoff for an $A$ individual (e.g., at node $1$), $P_A$: it interacts with one $A$ (node $2$) and one $B$ (node $3$). $P_A = a+b$. This is the same for the $A$ at node $2$.\n-   Payoff for the $B$ individual at node $3$, $P_B$: it interacts with two $A$ individuals. $P_B = c+c = 2c$.\n-   Fitness values:\n    $f_A = 1 + w P_A = 1 + w(a+b)$\n    $f_B = 1 + w P_B = 1 + 2cw$\n-   Total fitness in the population: $F_2 = 2f_A + f_B = 2(1+w(a+b)) + (1+2cw) = 3 + w(2a+2b+2c)$.\n\nThe transition $i=2 \\to i=3$ (increase in $A$) occurs if an $A$ individual reproduces and its offspring replaces the $B$ neighbor.\n-   A specific $A$ individual (e.g., at node $1$) is chosen with probability $f_A/F_2$.\n-   Its neighbors are one $A$ (node $2$) and one $B$ (node $3$). It replaces the $B$ with probability $1/2$.\n-   Since there are two $A$ individuals, the total probability is $T_{2,3} = \\frac{f_A}{F_2} \\times \\frac{1}{2} + \\frac{f_A}{F_2} \\times \\frac{1}{2} = \\frac{f_A}{F_2}$.\n\nThe transition $i=2 \\to i=1$ (decrease in $A$) occurs if the $B$ individual reproduces and its offspring replaces an $A$ neighbor.\n-   The $B$ individual is chosen with probability $f_B/F_2$.\n-   Both of its neighbors are of type $A$, so replacement of an $A$ occurs with probability $1$.\n-   $T_{2,1} = \\frac{f_B}{F_2}$.\n\nThe ratio of transition probabilities $\\gamma_2 = T_{2,1} / T_{2,3}$ is:\n$$ \\gamma_2 = \\frac{f_B/F_2}{f_A/F_2} = \\frac{f_B}{f_A} = \\frac{1 + 2cw}{1 + w(a+b)} $$\nTo first order in $w$:\n$$ \\gamma_2 \\approx 1 + 2cw - w(a+b) = 1 + w(2c-a-b) $$\n\nThe fixation probability $\\rho_A$ for a single mutant starting in a population of size $N$ is given by the formula for a one-dimensional birth-death process:\n$$ \\rho_A = \\frac{1}{1 + \\sum_{k=1}^{N-1} \\prod_{j=1}^{k} \\gamma_j} $$\nFor $N=3$, this is:\n$$ \\rho_A = \\frac{1}{1 + \\gamma_1 + \\gamma_1 \\gamma_2} $$\nSubstituting the first-order approximations for $\\gamma_1$ and $\\gamma_2$:\n$$ \\gamma_1 \\gamma_2 = (1 + w(c+d-2b))(1 + w(2c-a-b)) \\approx 1 + w(c+d-2b) + w(2c-a-b) = 1 + w(3c+d-a-3b) $$\nThe denominator becomes:\n$$ 1 + (1 + w(c+d-2b)) + (1 + w(3c+d-a-3b)) = 3 + w(c+d-2b + 3c+d-a-3b) = 3 + w(4c+2d-a-5b) $$\nSo, the fixation probability is:\n$$ \\rho_A = \\frac{1}{3 + w(4c+2d-a-5b)} = \\frac{1}{3} \\left( \\frac{1}{1 + \\frac{w}{3}(4c+2d-a-5b)} \\right) $$\nTo first order in $w$, using $(1+x)^{-1} \\approx 1-x$:\n$$ \\rho_A \\approx \\frac{1}{3} \\left( 1 - \\frac{w}{3}(4c+2d-a-5b) \\right) = \\frac{1}{3} + \\frac{w}{9}(a+5b-4c-2d) $$\nThe fixation probability $\\rho_B$ of a single $B$ mutant in an $A$ population is found by swapping the roles of $A$ and $B$. This corresponds to the transformations $a \\leftrightarrow d$ and $b \\leftrightarrow c$ in the payoff matrix. Applying these to the expression for $\\rho_A$:\n$$ \\rho_B = \\frac{1}{3} + \\frac{w}{9}(d+5c-4b-2a) $$\nWe are interested in the sign of $\\rho_A - \\rho_B$:\n$$ \\rho_A - \\rho_B = \\left( \\frac{1}{3} + \\frac{w}{9}(a+5b-4c-2d) \\right) - \\left( \\frac{1}{3} + \\frac{w}{9}(d+5c-4b-2a) \\right) $$\n$$ \\rho_A - \\rho_B = \\frac{w}{9} \\left( (a+5b-4c-2d) - (d+5c-4b-2a) \\right) $$\n$$ \\rho_A - \\rho_B = \\frac{w}{9} (a+5b-4c-2d - d-5c+4b+2a) $$\n$$ \\rho_A - \\rho_B = \\frac{w}{9} (3a + 9b - 9c - 3d) $$\n$$ \\rho_A - \\rho_B = \\frac{3w}{9} (a + 3b - 3c - d) = \\frac{w}{3} (a + 3b - 3c - d) $$\nThe problem states that the sign of this expression can be written as the sign of $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ for a positive constant $K$. Assuming $w > 0$, we are comparing the signs of two expressions:\n$$ \\mathrm{sign}(a + 3b - 3c - d) = \\mathrm{sign}(\\sigma a + b - c - \\sigma d) $$\nFor this to hold for any choice of $a,b,c,d$, there must be a positive constant $C$ such that:\n$$ a + 3b - 3c - d = C (\\sigma a + b - c - \\sigma d) $$\n$$ a + 3b - 3c - d = C \\sigma a + Cb - Cc - C\\sigma d $$\nBy comparing the coefficients of the payoff parameters on both sides:\n-   Coefficient of $b$: $3 = C$\n-   Coefficient of $c$: $-3 = -C \\implies C=3$\nThe value $C=3$ is consistent and positive.\n-   Coefficient of $a$: $1 = C\\sigma = 3\\sigma \\implies \\sigma = \\frac{1}{3}$\n-   Coefficient of $d$: $-1 = -C\\sigma = -3\\sigma \\implies \\sigma = \\frac{1}{3}$\nThe value $\\sigma = 1/3$ is also consistent.\nThus, the structure coefficient for the triangle graph under Birth-death update is $\\sigma = 1/3$.\nThe full expression for $\\rho_A - \\rho_B$ can be written as:\n$$ \\rho_A - \\rho_B = \\frac{w}{3} \\left( a + 3b - 3c - d \\right) = \\frac{w}{3} \\cdot 3 \\left( \\frac{1}{3}a + b - c - \\frac{1}{3}d \\right) = w \\left( \\frac{1}{3}a + b - c - \\frac{1}{3}d \\right) $$\nThis matches the form $K w \\left( \\sigma a + b - c - \\sigma d \\right)$ with $K=1$ and $\\sigma=1/3$.",
            "answer": "$$\n\\boxed{\\frac{1}{3}}\n$$"
        },
        {
            "introduction": "Real-world networks are rarely as uniform as circles or complete graphs; they are typically heterogeneous, with nodes of varying degrees and strategic importance. This practice explores this crucial aspect by examining the Moran process on a star graph, a canonical example of a heterogeneous network with a central hub and peripheral leaves.\n\nBy calculating and comparing the fixation probability for a mutant starting at the high-degree hub versus a low-degree leaf , you will gain a tangible understanding of how a node's position can dramatically amplify or suppress its evolutionary potential. This exercise highlights a core lesson of evolutionary graph theory: in structured populations, not all positions are created equal.",
            "id": "4288454",
            "problem": "Consider an undirected star graph with $N = 3$ vertices: one central hub of degree $2$ and two leaves of degree $1$. A single mutant with relative fitness $r > 0$ arises in a population of residents with fitness $1$. The population evolves according to the Moran process on graphs with birth-death (Bd) updating: at each time step, one individual is chosen for reproduction with probability proportional to its fitness, and one of its neighbors is chosen uniformly at random to be replaced by the offspring.\n\nLet $\\rho_{\\mathrm{hub}}(r)$ denote the fixation probability when the single mutant is introduced at the central hub (the highest-degree node). Let $\\rho_{\\mathrm{leaf}}(r)$ denote the fixation probability when the single mutant is introduced at a leaf. Let $\\bar{\\rho}(r)$ denote the average fixation probability over a uniformly random initial placement of the single mutant, i.e., $\\bar{\\rho}(r) = \\frac{1}{3} \\left(\\rho_{\\mathrm{hub}}(r) + 2 \\rho_{\\mathrm{leaf}}(r)\\right)$.\n\nUsing only the fundamental definitions of the Moran process on graphs with Bd updating and first-step analysis of absorbing Markov chains, compute the ratio\n$$\nR(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)}.\n$$\nGive your final answer as a closed-form analytic expression in $r$. No numerical approximation or rounding is required.",
            "solution": "The problem requires a first-step analysis of an absorbing Markov chain. Let the vertices be $v_c$ (hub) and $v_l, v_{l'}$ (leaves). The state of the process is the set of vertices occupied by mutants.\n\n### 1. Define States and Fixation Probabilities\nThe state space consists of all subsets of $\\{v_c, v_l, v_{l'}\\}$. The absorbing states are $\\varnothing$ (extinction) and $\\{v_c, v_l, v_{l'}\\}$ (fixation). Let $\\pi_S$ be the fixation probability starting from state $S$. We have boundary conditions $\\pi_{\\varnothing} = 0$ and $\\pi_{\\{v_c, v_l, v_{l'}\\}} = 1$.\n\nBy symmetry, the transient states group into three classes:\n-   $S_{1,h} = \\{v_c\\}$: Single mutant on the hub. Fixation probability is $\\rho_{\\mathrm{hub}}(r)$.\n-   $S_{1,l} = \\{v_l\\}$: Single mutant on a leaf. Fixation probability is $\\rho_{\\mathrm{leaf}}(r)$.\n-   $S_{2,hl} = \\{v_c, v_l\\}$: Mutants on the hub and one leaf. Let its fixation probability be $\\pi_{2,hl}$.\n\nThe state with mutants on both leaves, $\\{v_l, v_{l'}\\}$, is not reachable from a single-mutant state under Bd updating.\n\n### 2. Derive the System of Linear Equations\nFor any transient state $S$, the law of total probability gives $\\pi_S = \\sum_{S'} P(S \\to S') \\pi_{S'}$.\n\n**State $S_{1,h} = \\{v_c\\}$**:\nTotal fitness is $\\mathcal{F} = r+1+1 = r+2$.\n-   A mutant at $v_c$ is chosen (prob. $\\frac{r}{r+2}$). Its offspring replaces a leaf. The new state is $S_{2,hl}$. This happens with probability $1$. Transition probability is $P(S_{1,h} \\to S_{2,hl}) = \\frac{r}{r+2}$.\n-   A resident at a leaf is chosen (prob. $\\frac{1}{r+2}$). Its offspring replaces the hub $v_c$. The mutant is lost. This happens for both leaves. Transition probability to extinction is $P(S_{1,h} \\to \\varnothing) = 2 \\times \\frac{1}{r+2} = \\frac{2}{r+2}$.\nThe equation is: $\\rho_{\\mathrm{hub}}(r) = \\frac{r}{r+2} \\pi_{2,hl} + \\frac{2}{r+2} \\cdot 0 \\implies \\rho_{\\mathrm{hub}}(r) = \\frac{r}{r+2} \\pi_{2,hl}$.\n\n**State $S_{1,l} = \\{v_l\\}$**:\nTotal fitness is $\\mathcal{F} = r+1+1 = r+2$.\n-   A mutant at $v_l$ is chosen (prob. $\\frac{r}{r+2}$). Its offspring replaces the hub $v_c$. The new state is $S_{2,hl}$. Transition probability is $P(S_{1,l} \\to S_{2,hl}) = \\frac{r}{r+2}$.\n-   The resident hub $v_c$ is chosen (prob. $\\frac{1}{r+2}$). It can replace the mutant leaf $v_l$ (prob. $1/2$) leading to extinction, or the other leaf (prob. $1/2$), which is a self-loop. The probability of transition to extinction is $\\frac{1}{r+2} \\cdot \\frac{1}{2} = \\frac{1}{2(r+2)}$.\n-   The other resident leaf is chosen (prob. $\\frac{1}{r+2}$). It replaces the hub, which is a self-loop.\nThe self-loop probability is $P(S_{1,l} \\to S_{1,l}) = \\frac{1}{2(r+2)} + \\frac{1}{r+2} = \\frac{3}{2(r+2)}$.\nThe equation is: $\\rho_{\\mathrm{leaf}}(r) = \\frac{r}{r+2} \\pi_{2,hl} + \\frac{3}{2(r+2)} \\rho_{\\mathrm{leaf}}(r)$.\nSolving for $\\rho_{\\mathrm{leaf}}(r)$: $\\rho_{\\mathrm{leaf}}(r) \\left(1 - \\frac{3}{2(r+2)}\\right) = \\frac{r}{r+2} \\pi_{2,hl} \\implies \\rho_{\\mathrm{leaf}}(r) = \\frac{2r}{2r+1} \\pi_{2,hl}$.\n\n**State $S_{2,hl} = \\{v_c, v_l\\}$**:\nTotal fitness is $\\mathcal{F} = r+r+1 = 2r+1$.\n-   The mutant hub $v_c$ is chosen (prob. $\\frac{r}{2r+1}$). It can replace the resident leaf $v_{l'}$ (prob. $1/2$), leading to fixation. Transition probability is $P(S_{2,hl} \\to V) = \\frac{r}{2(2r+1)}$.\n-   The resident leaf $v_{l'}$ is chosen (prob. $\\frac{1}{2r+1}$). It replaces the hub $v_c$. The new state is $S_{1,l}$. Transition probability is $P(S_{2,hl} \\to S_{1,l}) = \\frac{1}{2r+1}$.\nThe equation for $\\pi_{2,hl}$ can be found by considering only transitions to different states. The total probability of moving to a different state is $\\frac{r}{2(2r+1)} + \\frac{1}{2r+1} = \\frac{r+2}{2(2r+1)}$.\n$\\pi_{2,hl} = \\frac{P(S_{2,hl} \\to V)\\cdot 1 + P(S_{2,hl} \\to S_{1,l}) \\rho_{\\mathrm{leaf}}(r)}{P(\\text{total transition to different state})}$. This leads to:\n$(r+2)\\pi_{2,hl} = r + 2\\rho_{\\mathrm{leaf}}(r)$.\n\n### 3. Solve the System and Compute the Ratio\nWe have a system of three equations for $\\rho_{\\mathrm{hub}}(r)$, $\\rho_{\\mathrm{leaf}}(r)$, and $\\pi_{2,hl}$.\n1.  $\\rho_{\\mathrm{hub}}(r) = \\frac{r}{r+2} \\pi_{2,hl}$\n2.  $\\rho_{\\mathrm{leaf}}(r) = \\frac{2r}{2r+1} \\pi_{2,hl}$\n3.  $(r+2)\\pi_{2,hl} = r + 2\\rho_{\\mathrm{leaf}}(r)$\n\nSubstitute (2) into (3):\n$(r+2)\\pi_{2,hl} = r + 2 \\left( \\frac{2r}{2r+1} \\pi_{2,hl} \\right)$\n$\\pi_{2,hl} \\left( (r+2) - \\frac{4r}{2r+1} \\right) = r$\n$\\pi_{2,hl} \\left( \\frac{(r+2)(2r+1) - 4r}{2r+1} \\right) = r \\implies \\pi_{2,hl} \\left( \\frac{2r^2+r+2}{2r+1} \\right) = r$\n$\\pi_{2,hl} = \\frac{r(2r+1)}{2r^2+r+2}$.\n\nNow we find the fixation probabilities:\n$\\rho_{\\mathrm{hub}}(r) = \\frac{r}{r+2} \\left( \\frac{r(2r+1)}{2r^2+r+2} \\right) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}$\n$\\rho_{\\mathrm{leaf}}(r) = \\frac{2r}{2r+1} \\left( \\frac{r(2r+1)}{2r^2+r+2} \\right) = \\frac{2r^2}{2r^2+r+2}$\n\nFinally, compute the average fixation probability $\\bar{\\rho}(r)$:\n$\\bar{\\rho}(r) = \\frac{1}{3} \\left(\\rho_{\\mathrm{hub}}(r) + 2 \\rho_{\\mathrm{leaf}}(r)\\right)$\n$\\rho_{\\mathrm{hub}}(r) + 2\\rho_{\\mathrm{leaf}}(r) = \\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)} + \\frac{4r^2(r+2)}{(r+2)(2r^2+r+2)}$\n$= \\frac{2r^3+r^2 + 4r^3+8r^2}{(r+2)(2r^2+r+2)} = \\frac{6r^3+9r^2}{(r+2)(2r^2+r+2)} = \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)}$\n$\\bar{\\rho}(r) = \\frac{1}{3} \\left( \\frac{3r^2(2r+3)}{(r+2)(2r^2+r+2)} \\right) = \\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}$.\n\nThe required ratio is:\n$R(r) = \\frac{\\rho_{\\mathrm{hub}}(r)}{\\bar{\\rho}(r)} = \\frac{\\frac{r^2(2r+1)}{(r+2)(2r^2+r+2)}}{\\frac{r^2(2r+3)}{(r+2)(2r^2+r+2)}} = \\frac{2r+1}{2r+3}$.",
            "answer": "$$\n\\boxed{\\frac{2r+1}{2r+3}}\n$$"
        },
        {
            "introduction": "While manual calculations on small graphs are invaluable for building intuition, they are not scalable. To analyze more complex structures, we must turn to computational methods. This final practice guides you in transforming the theoretical framework into a general-purpose tool for solving the Moran process on any small graph.\n\nHere, you will translate the first-step analysis method into a complete computational algorithm . This involves programmatically enumerating the state space, constructing the transition matrix from the graph's structure and the process rules, and solving the resulting system of linear equations to find exact fixation probabilities. This task bridges the gap between theoretical derivation and practical, automated problem-solving.",
            "id": "4288406",
            "problem": "Consider a finite, undirected, simple graph $G = (V,E)$ with $|V| = n$ and the Birth-death (Bd) updating version of the Moran process on graphs. Each vertex hosts a single individual. A subset $S \\subseteq V$ denotes the locations of mutants with relative fitness $r > 0$, and residents have fitness $1$. At each discrete time step, one vertex $i \\in V$ is selected for reproduction with probability proportional to its fitness, and then a uniformly random neighbor $j \\in N(i)$ is selected to be replaced by the offspring of $i$, adopting the type of $i$. The two absorbing states are $S = \\varnothing$ (extinction) and $S = V$ (fixation). For any non-absorbing state $S$ (a transient state), define $x(S)$ as the fixation probability, i.e., the probability that the process starting from $S$ eventually reaches $V$ rather than $\\varnothing$.\n\nStarting only from the core definitions of the Moran process with Bd updating and basic probability conservation, perform the following tasks:\n\n1. Derive the linear system satisfied by $x(S)$ over the transient state space. Specifically, let $x$ be the vector indexed by all transient states $S \\subset V$ with $S \\neq \\varnothing$ and $S \\neq V$. Show that $x$ satisfies a linear system obtained from the one-step law of total probability, with boundary conditions $x(\\varnothing) = 0$ and $x(V) = 1$. Express this in the form\n$$\n(I - Q)\\,x = b,\n$$\nwhere $Q$ is the transition matrix restricted to transient-to-transient moves under Bd updating, and $b$ encodes the one-step transitions from transient states directly into fixation $V$.\n\n2. Outline an exact algorithm, suitable for small $n$, that constructs $Q$ and $b$ from $G$, $r$, and the set of transient states by enumerating all subsets of $V$ except $\\varnothing$ and $V$, computing all one-step transition probabilities under Bd updating, and solving the linear system $(I - Q)\\,x = b$ to obtain $x(S)$ for any initial transient set $S$.\n\n3. Implement this algorithm as a complete, runnable program that, for each specified test case, constructs the appropriate matrices and computes the fixation probability $x(S_0)$ for the given initial set $S_0$. Your implementation must adhere to the following:\n\n- State representation must be purely combinatorial over subsets of $V$; no stochastic simulation is permitted.\n- The graph is specified by an edge list. You may assume the graph is connected and has no isolated vertices to avoid division by zero.\n- All computations must be done in exact arithmetic up to floating-point linear algebra; no Monte Carlo sampling is allowed.\n\nTest Suite:\n\nUse the following test suite of graphs, fitness values, and initial sets. Each graph is given by its vertex set $V = \\{0,1,\\dots,n-1\\}$ and undirected edge list $E$.\n\n- Test $1$ (edge graph $K_2$): $n = 2$, $E = \\{(0,1)\\}$, $r = 2.0$, $S_0 = \\{0\\}$.\n- Test $2$ (complete graph $K_3$): $n = 3$, $E = \\{(0,1),(1,2),(0,2)\\}$, $r = 2.0$, $S_0 = \\{0\\}$.\n- Test $3$ (path $P_3$): $n = 3$, $E = \\{(0,1),(1,2)\\}$, $r = 0.5$, $S_0 = \\{1\\}$.\n- Test $4$ (cycle $C_4$): $n = 4$, $E = \\{(0,1),(1,2),(2,3),(3,0)\\}$, $r = 1.0$, $S_0 = \\{0,1\\}$.\n- Test $5$ (star on $5$ vertices): $n = 5$, $E = \\{(0,1),(0,2),(0,3),(0,4)\\}$, $r = 3.0$, $S_0 = \\{0\\}$.\n\nRequired final output format:\n\nYour program should produce a single line of output containing the fixation probabilities for Tests $1$ through $5$ in order, as a comma-separated list enclosed in square brackets. Each probability must be rounded to $10$ decimal places. For example, an output with two results should look like $[0.1234567890,0.0987654321]$.\n\nNo physical units are involved. All angles, if any, are irrelevant. All results must be real numbers. The only acceptable output types are floating-point numbers aggregated into a single list as specified.",
            "solution": "The problem requires the derivation and solution of a linear system for calculating fixation probabilities in a Birth-death (Bd) Moran process on a graph. We begin by validating the problem statement and then proceed to the full derivation and algorithmic outline.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Graph:** A finite, undirected, simple graph $G = (V,E)$ with $|V| = n$.\n- **Process:** Birth-death (Bd) updating Moran process.\n- **Types:** Mutants with relative fitness $r > 0$, residents with fitness $1$.\n- **State:** $S \\subseteq V$, the set of vertices occupied by mutants.\n- **Dynamics:**\n    1. Select a vertex $i \\in V$ for reproduction with probability proportional to its fitness.\n    2. Select a neighbor $j \\in N(i)$ uniformly at random.\n    3. The individual at $j$ is replaced by an offspring of the individual at $i$.\n- **Absorbing States:** $S = \\varnothing$ (extinction) and $S = V$ (fixation).\n- **Transient States:** All subsets $S$ such that $S \\neq \\varnothing$ and $S \\neq V$.\n- **Fixation Probability:** $x(S)$ is the probability that a process starting in state $S$ reaches fixation.\n- **Boundary Conditions:** $x(\\varnothing) = 0$ and $x(V) = 1$.\n- **Task 1:** Derive the linear system $(I - Q)x = b$.\n- **Task 2:** Outline an exact algorithm to construct and solve this system.\n- **Task 3:** Implement the algorithm for specified test cases.\n- **Test Cases:**\n    1. $G=K_2, n=2, E=\\{(0,1)\\}, r=2.0, S_0=\\{0\\}$.\n    2. $G=K_3, n=3, E=\\{(0,1),(1,2),(0,2)\\}, r=2.0, S_0=\\{0\\}$.\n    3. $G=P_3, n=3, E=\\{(0,1),(1,2)\\}, r=0.5, S_0=\\{1\\}$.\n    4. $G=C_4, n=4, E=\\{(0,1),(1,2),(2,3),(3,0)\\}, r=1.0, S_0=\\{0,1\\}$.\n    5. $G=S_5 (star), n=5, E=\\{(0,1),(0,2),(0,3),(0,4)\\}, r=3.0, S_0=\\{0\\}$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is scientifically grounded, being a standard problem in evolutionary graph theory. It is well-posed, as the fixation probability for a finite-state absorbing Markov chain is uniquely defined and can be found by solving a linear system derived from the law of total probability. The problem statement is objective and provides all necessary information, including the assumption of a connected graph, which ensures reachability of absorbing states. The problem is non-trivial and requires a formal derivation and implementation, violating none of the invalidity criteria.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. We will proceed with the solution.\n\n### Derivation and Algorithm\n\nThe Moran process on a graph defines a finite-state Markov chain. The state space $\\mathcal{S}$ is the power set of the vertex set $V$, i.e., $\\mathcal{S} = 2^V$. The states partition into two absorbing states, $\\varnothing$ (all residents, extinction) and $V$ (all mutants, fixation), and a set of transient states $\\mathcal{T} = \\{S \\subseteq V \\mid S \\neq \\varnothing \\text{ and } S \\neq V\\}$.\n\nWe are interested in the fixation probability $x(S)$ for any state $S \\in \\mathcal{S}$. By definition, we have the boundary conditions:\n$$\nx(\\varnothing) = 0 \\\\\nx(V) = 1\n$$\nFor any transient state $S \\in \\mathcal{T}$, the fixation probability $x(S)$ can be related to the fixation probabilities of the states reachable in one time step. Using the law of total probability (or total expectation) on the next state $S'$, we have:\n$$\nx(S) = \\sum_{S' \\in \\mathcal{S}} P(S \\to S') x(S')\n$$\nwhere $P(S \\to S')$ is the one-step transition probability from state $S$ to state $S'$. We can separate the sum over transient and absorbing states:\n$$\nx(S) = \\sum_{S' \\in \\mathcal{T}} P(S \\to S') x(S') + P(S \\to V) x(V) + P(S \\to \\varnothing) x(\\varnothing)\n$$\nSubstituting the boundary conditions $x(V)=1$ and $x(\\varnothing)=0$:\n$$\nx(S) = \\sum_{S' \\in \\mathcal{T}} P(S \\to S') x(S') + P(S \\to V)\n$$\nThis equation holds for every transient state $S \\in \\mathcal{T}$. Let the number of transient states be $M = |\\mathcal{T}| = 2^n - 2$. We can represent the unknown fixation probabilities for these states as a vector $x$ of size $M$. Let the transient states be indexed from $1$ to $M$. The above set of equations can be written in matrix form:\n$$\nx = Qx + b\n$$\nHere, $x$ is the column vector of fixation probabilities $[x(S_1), x(S_2), \\dots, x(S_M)]^T$. The matrix $Q$ is an $M \\times M$ matrix whose elements are the transient-to-transient transition probabilities, $Q_{ij} = P(S_i \\to S_j)$ for $S_i, S_j \\in \\mathcal{T}$. The vector $b$ is a column vector of size $M$ where $b_i = P(S_i \\to V)$. Rearranging the equation gives the desired linear system:\n$$\n(I - Q)x = b\n$$\nwhere $I$ is the $M \\times M$ identity matrix.\n\nTo construct $Q$ and $b$, we must first derive the transition probabilities $P(S \\to S')$.\nThe fitness of a mutant is $r$ and of a resident is $1$. For a state $S$, the number of mutants is $|S|$ and the number of residents is $n - |S|$. The total fitness of the population is $F(S) = |S|r + (n - |S|)(1) = |S|(r-1) + n$.\nThe probability of selecting a mutant at vertex $i \\in S$ for reproduction is $\\frac{r}{F(S)}$.\nThe probability of selecting a resident at vertex $i \\in V \\setminus S$ for reproduction is $\\frac{1}{F(S)}$.\nAfter selecting an individual at vertex $i$ to reproduce, one of its neighbors $j \\in N(i)$ is chosen uniformly at random to be replaced. The probability of choosing a specific neighbor $j$ is $\\frac{1}{d_i}$, where $d_i = |N(i)|$ is the degree of vertex $i$.\n\nA state transition $S \\to S'$ occurs only if an individual of one type replaces an individual of a different type. This means $|S'|$ can only be $|S|+1$ or $|S|-1$.\n\n1.  **Mutant population increases:** $S' = S \\cup \\{j\\}$ for some $j \\in V \\setminus S$. This occurs if a mutant reproduces and its offspring replaces a resident at vertex $j$. The parent mutant must be a neighbor of $j$, i.e., $i \\in S \\cap N(j)$. Summing over all possible parent mutants:\n    $$\n    P(S \\to S \\cup \\{j\\}) = \\sum_{i \\in S \\cap N(j)} \\left( \\frac{r}{F(S)} \\cdot \\frac{1}{d_i} \\right) = \\frac{r}{F(S)} \\sum_{i \\in S \\cap N(j)} \\frac{1}{d_i}\n    $$\n    If $|S| = n-1$ and $V \\setminus S = \\{j\\}$, this transition leads to fixation, $S' = V$. Thus, for such a state $S$, $b_S = P(S \\to V) = P(S \\to S \\cup \\{j\\})$. If $|S| < n-1$, this contributes to an entry in the $Q$ matrix.\n\n2.  **Mutant population decreases:** $S' = S \\setminus \\{j\\}$ for some $j \\in S$. This occurs if a resident reproduces and its offspring replaces the mutant at vertex $j$. The parent resident must be a neighbor of $j$, i.e., $i \\in (V \\setminus S) \\cap N(j)$. Summing over all possible parent residents:\n    $$\n    P(S \\to S \\setminus \\{j\\}) = \\sum_{i \\in (V \\setminus S) \\cap N(j)} \\left( \\frac{1}{F(S)} \\cdot \\frac{1}{d_i} \\right) = \\frac{1}{F(S)} \\sum_{i \\in (V \\setminus S) \\cap N(j)} \\frac{1}{d_i}\n    $$\n    If $|S|=1$ and $S=\\{j\\}$, this transition leads to extinction, $S'=\\varnothing$. This probability does not appear in the system for $x$. For $|S|>1$, this contributes to an entry in the $Q$ matrix.\n\n3.  **No change in population:** $S' = S$. This occurs if a mutant replaces a mutant or a resident replaces a resident. The probability is given by the total probability rule:\n    $$\n    P(S \\to S) = 1 - \\sum_{j \\in V \\setminus S} P(S \\to S \\cup \\{j\\}) - \\sum_{j \\in S} P(S \\to S \\setminus \\{j\\})\n    $$\n    This probability forms the diagonal elements of the matrix $Q$.\n\n### Algorithmic Outline\n\n1.  **Input:** Graph parameters ($n$, edge list $E$), fitness $r$, and initial mutant set $S_0$.\n2.  **State Space Indexing:**\n    - The $2^n-2$ transient states are represented by integers (bitmasks) from $1$ to $2^n-2$.\n    - A state $S$ corresponding to a bitmask $m$ is mapped to a matrix index $k = m-1$.\n3.  **Graph Pre-computation:**\n    - Construct an adjacency list representation of the graph $G$.\n    - Compute the degree $d_i$ for every vertex $i \\in V$.\n4.  **Matrix Construction:**\n    - Initialize an $M \\times M$ matrix $Q$ and an $M$-element vector $b$ with zeros, where $M=2^n-2$.\n    - Iterate through each transient state index $k$ from $0$ to $M-1$.\n        - Determine the corresponding state $S$ (from its bitmask $m=k+1$).\n        - Calculate the total fitness $F(S) = |S|(r-1) + n$.\n        - Calculate all one-step transition probabilities $P(S \\to S')$ for $S' \\neq S$:\n            - For each resident $j \\in V \\setminus S$, calculate $p_{inc} = P(S \\to S \\cup \\{j\\})$. The new state is $S' = S \\cup \\{j\\}$. If $S' = V$, add $p_{inc}$ to $b_k$. Otherwise, find the index $k'$ for $S'$ and add $p_{inc}$ to $Q_{k,k'}$.\n            - For each mutant $j \\in S$, calculate $p_{dec} = P(S \\to S \\setminus \\{j\\})$. The new state is $S' = S \\setminus \\{j\\}$. If $S' = \\varnothing$, this probability is noted but not used in the system. Otherwise, find the index $k'$ for $S'$ and add $p_{dec}$ to $Q_{k,k'}$.\n        - Calculate the diagonal element $Q_{k,k} = P(S \\to S)$ as $1$ minus the sum of all outgoing probabilities to different states ($S' \\neq S$).\n5.  **Solve System:**\n    - Construct the matrix $A = I - Q$.\n    - Solve the linear system $Ax = b$ for the vector of fixation probabilities $x$.\n6.  **Output:**\n    - Find the index $k_0$ corresponding to the initial state $S_0$.\n    - The result is the $k_0$-th element of the solution vector $x$.\nThis algorithm provides an exact solution by enumerating the entire transient state space and solving the resulting system of linear equations. Its complexity is dominated by the size of the state space, making it suitable for small $n$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import linalg\nfrom itertools import chain, combinations\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Test 1 (K2)\n        {\"n\": 2, \"edges\": [(0, 1)], \"r\": 2.0, \"S0\": {0}},\n        # Test 2 (K3)\n        {\"n\": 3, \"edges\": [(0, 1), (1, 2), (0, 2)], \"r\": 2.0, \"S0\": {0}},\n        # Test 3 (P3)\n        {\"n\": 3, \"edges\": [(0, 1), (1, 2)], \"r\": 0.5, \"S0\": {1}},\n        # Test 4 (C4)\n        {\"n\": 4, \"edges\": [(0, 1), (1, 2), (2, 3), (3, 0)], \"r\": 1.0, \"S0\": {0, 1}},\n        # Test 5 (Star on 5 vertices)\n        {\"n\": 5, \"edges\": [(0, 1), (0, 2), (0, 3), (0, 4)], \"r\": 3.0, \"S0\": {0}},\n    ]\n\n    results = []\n    for case in test_cases:\n        prob = calculate_fixation_probability(\n            case[\"n\"], case[\"edges\"], case[\"r\"], case[\"S0\"]\n        )\n        results.append(f\"{prob:.10f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_fixation_probability(n, edges, r, S0):\n    \"\"\"\n    Calculates the fixation probability for a given graph, fitness, and initial state.\n    \n    This function implements the exact algorithm based on solving the linear system\n    derived from the Moran process master equation.\n    \"\"\"\n    \n    # 1. Graph pre-computation\n    adj = [set() for _ in range(n)]\n    degrees = np.zeros(n, dtype=int)\n    for u, v in edges:\n        adj[u].add(v)\n        adj[v].add(u)\n        degrees[u] += 1\n        degrees[v] += 1\n\n    # 2. State space setup\n    num_transient = 2**n - 2\n    if num_transient = 0: # Handle trivial cases n=0, n=1\n        return 1.0 if len(S0) == n else 0.0\n\n    # state_mask -> matrix_index mapping is (mask - 1)\n    # matrix_index -> state_mask mapping is (index + 1)\n\n    # 3. Matrix construction\n    Q = np.zeros((num_transient, num_transient), dtype=float)\n    b = np.zeros(num_transient, dtype=float)\n    \n    all_vertices = set(range(n))\n    full_mask = 2**n - 1\n\n    for k_idx in range(num_transient):\n        s_mask = k_idx + 1\n        \n        s_set = set()\n        for i in range(n):\n            if (s_mask >> i)  1:\n                s_set.add(i)\n        \n        s_cardinality = len(s_set)\n        total_fitness = s_cardinality * r + (n - s_cardinality)\n        \n        # This will hold sum of probabilities of transitions to any S' != S\n        total_outgoing_prob = 0.0\n\n        # Case 1: Mutant expansion\n        complement_s = all_vertices - s_set\n        for j_resident in complement_s:\n            prob_inc = 0.0\n            neighbors_of_j = adj[j_resident]\n            mutant_neighbors = s_set.intersection(neighbors_of_j)\n            \n            for i_mutant in mutant_neighbors:\n                if degrees[i_mutant] > 0:\n                    prob_inc += (r / total_fitness) / degrees[i_mutant]\n            \n            if prob_inc > 0:\n                total_outgoing_prob += prob_inc\n                s_prime_mask = s_mask | (1  j_resident)\n                \n                if s_prime_mask == full_mask: # Transition to fixation\n                    b[k_idx] += prob_inc\n                else: # Transition to another transient state\n                    s_prime_idx = s_prime_mask - 1\n                    Q[k_idx, s_prime_idx] += prob_inc\n\n        # Case 2: Mutant contraction\n        for j_mutant in s_set:\n            prob_dec = 0.0\n            neighbors_of_j = adj[j_mutant]\n            resident_neighbors = complement_s.intersection(neighbors_of_j)\n            \n            for i_resident in resident_neighbors:\n                if degrees[i_resident] > 0:\n                    prob_dec += (1.0 / total_fitness) / degrees[i_resident]\n\n            if prob_dec > 0:\n                total_outgoing_prob += prob_dec\n                s_prime_mask = s_mask  ~(1  j_mutant)\n\n                if s_prime_mask == 0: # Transition to extinction\n                    pass # This does not contribute to Q or b\n                else: # Transition to another transient state\n                    s_prime_idx = s_prime_mask - 1\n                    Q[k_idx, s_prime_idx] += prob_dec\n        \n        # Diagonal element of Q: P(S -> S)\n        Q[k_idx, k_idx] = 1.0 - total_outgoing_prob\n\n    # 4. Solve the linear system (I - Q)x = b\n    A = np.identity(num_transient) - Q\n    try:\n        x = linalg.solve(A, b, assume_a='gen')\n    except linalg.LinAlgError:\n        # Fallback to a least-squares solver if the matrix is singular,\n        # which can happen in fringe cases but shouldn't for connected graphs.\n        x, _, _, _ = linalg.lstsq(A, b)\n\n    # 5. Extract the result for the initial state S0\n    s0_mask = 0\n    for i in S0:\n        s0_mask |= (1  i)\n    \n    # Check if S0 is absorbing\n    if s0_mask == 0: # Extinction\n        return 0.0\n    if s0_mask == full_mask: # Fixation\n        return 1.0\n\n    s0_idx = s0_mask - 1\n    return x[s0_idx]\n\n# Execute the solver\nsolve()\n\n```"
        }
    ]
}