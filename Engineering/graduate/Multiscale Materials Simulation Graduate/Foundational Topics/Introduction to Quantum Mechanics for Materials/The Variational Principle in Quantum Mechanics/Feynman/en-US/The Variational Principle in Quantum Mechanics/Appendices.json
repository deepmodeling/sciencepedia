{
    "hands_on_practices": [
        {
            "introduction": "Many powerful basis sets in quantum chemistry and materials science are not orthogonal, which introduces unique numerical challenges. This exercise  explores the immediate consequences by asking you to analyze the overlap matrix $S$ for a simple two-state system. By deriving its condition number $\\kappa_{2}(S)$, a key indicator of numerical stability, you will see how near-linear dependence in the basis can undermine the reliability of calculations involving the generalized eigenproblem $H c = E S c$.",
            "id": "3852559",
            "problem": "In atomistic-to-continuum multiscale materials simulation, nonorthogonal localized basis sets are widely used to represent quantum states, for example in Kohn–Sham Density Functional Theory (DFT) and tight-binding models. Consider a minimal model of two spatially localized, normalized basis functions $\\{\\phi_{1},\\phi_{2}\\}$ with nonzero mutual overlap, where the overlap integral $s \\equiv \\langle \\phi_{1} \\mid \\phi_{2} \\rangle$ satisfies $0 < s < 1$. The overlap matrix is the Gram matrix\n$$\nS \\equiv \\begin{pmatrix}\n1 & s \\\\\ns & 1\n\\end{pmatrix},\n$$\nwhich is real symmetric and positive definite. The system Hamiltonian in this basis is represented by a Hermitian matrix $H \\in \\mathbb{C}^{2 \\times 2}$, and stationary states solve the generalized Hermitian eigenproblem $H c = E S c$.\n\nStarting from core definitions only (Gram matrices, eigenvalues of symmetric positive definite matrices, and induced matrix norms), do the following:\n\n- Derive the $2$-norm spectral condition number of the overlap matrix $S$ as a function of $s$.\n\n- Quantify, to first order in small Hermitian perturbations $\\Delta H$ and $\\Delta S$ with $\\|\\Delta H\\|_{2} \\ll \\|H\\|_{2}$ and $\\|\\Delta S\\|_{2} \\ll \\|S\\|_{2}$, how nonorthogonality (measured by $s$) impacts the stability of a simple eigenvalue $E$ of the generalized problem $H c = E S c$. Use only the linear algebraic structure of generalized eigenpairs and the fact that normalized generalized eigenvectors can be chosen to satisfy $c^{*} S c = 1$. Your analysis should make explicit the dependence on $s$ through the overlap matrix and should conclude how the sensitivity behaves as $s \\to 1^{-}$.\n\nReport only the closed-form analytic expression for the $2$-norm condition number $\\kappa_{2}(S)$ as a function of $s$ as your final answer. No numerical evaluation or rounding is required, and no physical units are needed.",
            "solution": "The problem presents two tasks: first, to derive the spectral condition number of a specific $2 \\times 2$ overlap matrix $S$, and second, to analyze the stability of the generalized eigenvalue problem $H c = E S c$ with respect to small perturbations in $H$ and $S$.\n\nThe problem is validated as sound. It is scientifically grounded in the principles of quantum mechanics and linear algebra as applied to computational materials science. The setup is well-posed, objective, and contains all necessary information to derive a unique solution for both parts.\n\nFirst, I will derive the $2$-norm spectral condition number, $\\kappa_{2}(S)$, of the overlap matrix $S$. The matrix is given by:\n$$\nS = \\begin{pmatrix}\n1 & s \\\\\ns & 1\n\\end{pmatrix}\n$$\nwhere $0 < s < 1$. By definition, the $2$-norm spectral condition number of a matrix $A$ is $\\kappa_{2}(A) = \\|A\\|_{2} \\|A^{-1}\\|_{2}$. For a real symmetric positive-definite matrix like $S$, the $2$-norm is its largest eigenvalue, $\\|S\\|_{2} = \\lambda_{\\max}(S)$, and the $2$-norm of its inverse is the reciprocal of its smallest eigenvalue, $\\|S^{-1}\\|_{2} = 1/\\lambda_{\\min}(S)$. Therefore, the condition number is the ratio of the largest to the smallest eigenvalue:\n$$\n\\kappa_{2}(S) = \\frac{\\lambda_{\\max}(S)}{\\lambda_{\\min}(S)}\n$$\nTo find the eigenvalues of $S$, we solve the characteristic equation $\\det(S - \\lambda I) = 0$, where $I$ is the $2 \\times 2$ identity matrix.\n$$\n\\det \\begin{pmatrix}\n1-\\lambda & s \\\\\ns & 1-\\lambda\n\\end{pmatrix} = 0\n$$\nThis gives $(1-\\lambda)^{2} - s^{2} = 0$. Taking the square root of both sides, we get $1-\\lambda = \\pm s$, which yields the two eigenvalues:\n$$\n\\lambda = 1 \\mp s\n$$\nThe two eigenvalues are $\\lambda_{1} = 1+s$ and $\\lambda_{2} = 1-s$. Since the problem specifies that $0 < s < 1$, both eigenvalues are positive, confirming that $S$ is positive-definite. The largest and smallest eigenvalues are:\n$$\n\\lambda_{\\max}(S) = 1+s\n$$\n$$\n\\lambda_{\\min}(S) = 1-s\n$$\nSubstituting these into the formula for the condition number gives:\n$$\n\\kappa_{2}(S) = \\frac{1+s}{1-s}\n$$\n\nSecond, I will analyze how non-orthogonality impacts the stability of a simple eigenvalue $E$. We start with the unperturbed generalized eigenvalue problem $H c = E S c$ and the perturbed problem $(H + \\Delta H)(c + \\Delta c) = (E + \\Delta E)(S + \\Delta S)(c + \\Delta c)$. We expand the perturbed equation and retain only terms of first order in the small perturbations $\\Delta H$, $\\Delta S$, $\\Delta c$, and $\\Delta E$:\n$$\nHc + H\\Delta c + \\Delta H c + \\mathcal{O}(\\delta^{2}) = (ESc + ES\\Delta c + E\\Delta S c + \\Delta E S c) + \\mathcal{O}(\\delta^{2})\n$$\nUsing the unperturbed equation $Hc = ESc$, we can cancel terms from both sides:\n$$\nH\\Delta c + \\Delta H c \\approx ES\\Delta c + E\\Delta S c + \\Delta E S c\n$$\nTo find the first-order change in the eigenvalue, $\\Delta E$, we left-multiply by the adjoint of the unperturbed eigenvector, $c^{*}$:\n$$\nc^{*}H\\Delta c + c^{*}\\Delta H c \\approx c^{*}ES\\Delta c + c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\nSince $H$ is Hermitian, $H=H^{*}$, and the eigenvalue $E$ of a Hermitian generalized eigenproblem is real ($E=E^{*}$). Thus, we can take the adjoint of the unperturbed equation: $(Hc)^{*} = (ESc)^{*}$, which gives $c^{*}H^{*} = c^{*}E^{*}S^{*}$, and so $c^{*}H = E c^{*}S$. Using this relationship, the term $c^{*}H\\Delta c$ on the left-hand side is equal to $E c^{*}S\\Delta c$, which is equivalent to the first term on the right-hand side, $c^{*}ES\\Delta c$. These terms cancel, yielding:\n$$\nc^{*}\\Delta H c \\approx c^{*}E\\Delta S c + c^{*}\\Delta E S c\n$$\nRearranging to solve for $\\Delta E$ gives $\\Delta E \\, c^{*} S c \\approx c^{*}\\Delta H c - E \\, c^{*}\\Delta S c$. The problem states that the generalized eigenvectors can be chosen to satisfy the normalization condition $c^{*} S c = 1$. Applying this normalization simplifies the expression for the first-order change in the eigenvalue to:\n$$\n\\Delta E \\approx c^{*}\\Delta H c - E c^{*}\\Delta S c = c^{*}(\\Delta H - E \\Delta S)c\n$$\nTo quantify the sensitivity, we take the magnitude of both sides and apply the Cauchy-Schwarz inequality and properties of induced matrix norms:\n$$\n|\\Delta E| \\approx |c^{*}(\\Delta H - E \\Delta S)c| \\le \\|c\\|_{2}^{2} \\|\\Delta H - E \\Delta S\\|_{2} \\le \\|c\\|_{2}^{2} (\\|\\Delta H\\|_{2} + |E| \\|\\Delta S\\|_{2})\n$$\nThe sensitivity of the eigenvalue $E$ is thus amplified by the factor $\\|c\\|_{2}^{2}$. We can relate this factor to the non-orthogonality parameter $s$ via the properties of the overlap matrix $S$. From the normalization condition $c^{*} S c = 1$ and the Rayleigh-Ritz theorem, we have:\n$$\n\\lambda_{\\min}(S) \\|c\\|_{2}^{2} \\le c^{*} S c \\le \\lambda_{\\max}(S) \\|c\\|_{2}^{2}\n$$\nSubstituting $c^{*} S c = 1$ and $\\lambda_{\\min}(S) = 1-s$ gives:\n$$\n(1-s) \\|c\\|_{2}^{2} \\le 1 \\implies \\|c\\|_{2}^{2} \\le \\frac{1}{1-s}\n$$\nThis inequality shows that the amplification factor $\\|c\\|_{2}^{2}$ is bounded above by $(1-s)^{-1}$. The stability of the eigenvalue $E$ against perturbations is therefore directly affected by the non-orthogonality. As $s \\to 1^{-}$, the basis functions become nearly linearly dependent, $\\lambda_{\\min}(S) \\to 0$, and the matrix $S$ becomes singular. Consequently, the condition number $\\kappa_{2}(S) = \\frac{1+s}{1-s}$ diverges. This ill-conditioning is reflected in the eigenvalue sensitivity, as the upper bound on the amplification factor $\\|c\\|_{2}^{2}$ diverges as $(1-s)^{-1}$. Therefore, increasing non-orthogonality (i.e., $s \\to 1^{-}$) can lead to severe numerical instability in the calculated eigenvalues.",
            "answer": "$$\n\\boxed{\\frac{1+s}{1-s}}\n$$"
        },
        {
            "introduction": "This practice  puts the variational principle to work in a core task for solid-state physics: calculating the total energy of a crystal. You will implement a numerical scheme to sample the Brillouin zone using a Monkhorst-Pack grid and solve for the ground-state energy of a tight-binding model. This exercise demonstrates how continuous integrals in quantum theory are replaced by discrete sums in computational practice and introduces the critical concept of convergence with respect to k-point sampling density.",
            "id": "3852574",
            "problem": "You are to implement, analyze, and test a variational Brillouin Zone (BZ) sampling scheme using Monkhorst-Pack (MP) grids for a spin-degenerate, non-interacting, single-band tight-binding model on a two-dimensional square lattice, and to quantify the convergence of the ground-state total energy per electron with respect to the k-point density. All trigonometric functions must use radians. All energies must be expressed in electronvolts (eV). The lattice constant must be expressed in angstroms (Å).\n\nStart from the following fundamental base:\n- The Rayleigh-Ritz variational principle for quantum mechanics: for any trial state in a subspace of the full Hilbert space, the expectation value of the Hamiltonian provides an upper bound to the exact ground-state energy.\n- The tight-binding Hamiltonian on a two-dimensional square Bravais lattice with one orbital per site and nearest-neighbor hopping amplitude $t$ leads to a single-particle dispersion relation\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\nwhere $a$ is the lattice constant, $\\mathbf{k}=(k_x,k_y)$ is the crystal momentum in the first Brillouin Zone (BZ), and the cosine arguments are angles measured in radians.\n- The first Brillouin Zone (BZ) of the square lattice of lattice constant $a$ is the square $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$ in reciprocal space, spanned by reciprocal lattice vectors $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ and $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$.\n- For non-interacting, spin-degenerate ($g_s=2$) electrons at zero temperature, the many-electron ground state is obtained by occupying single-particle states in order of increasing energy, subject to the Pauli exclusion principle. In the continuum, with a normalized measure over the BZ, the total energy per unit cell is the integral of $\\varepsilon(\\mathbf{k})$ with an occupation function $f(\\mathbf{k})\\in[0,1]$ per spin, under the constraint that the average occupation equals the electron count per spin.\n\nFormulate a discrete variational problem by replacing the BZ integral with a Riemann sum over a Monkhorst-Pack (MP) grid. Define an $N\\times N$ MP grid in fractional coordinates by the set of points\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\nand map to reciprocal space via\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i \\,\\mathbf{b}_1 + v_j \\,\\mathbf{b}_2.\n$$\nAssign each point an equal weight $w=\\frac{1}{N^2}$ so that $\\sum_{i,j} w = 1$. For a given number of electrons per unit cell $n_e\\in[0,2]$ (with $2$ being full filling of the single band due to spin degeneracy $g_s=2$), define discrete occupations $f_{ij}\\in[0,1]$ per spin, and minimize the discrete total energy per electron\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}\n$$\nsubject to the constraint $\\sum_{i,j} w \\, f_{ij} \\,=\\, \\frac{n_e}{g_s}$ and the box constraints $0\\le f_{ij}\\le 1$.\n\nYour program must:\n- Construct the $N\\times N$ MP grid for each test case.\n- Solve the stated discrete variational problem to obtain the discrete ground-state total energy per electron $E_N$ in electronvolts (eV). You must determine the occupations $f_{ij}$ that minimize the energy given the constraints.\n- For a prescribed large reference grid size $N_{\\mathrm{ref}}$ (common to all test cases), compute the corresponding reference variational energy $E_{N_{\\mathrm{ref}}}$ for each test case using the same procedure.\n- Quantify the convergence by computing the absolute error $\\Delta E = \\lvert E_N - E_{N_{\\mathrm{ref}}}\\rvert$ in electronvolts (eV).\n\nUse the following test suite, where each test case is a quadruple ($t, a, n_e, N$):\n- Test 1: ($t=1.0$ eV, $a=1.0$ Å, $n_e=1.0$, $N=5$).\n- Test 2: ($t=1.0$ eV, $a=1.0$ Å, $n_e=1.0$, $N=9$).\n- Test 3: ($t=1.0$ eV, $a=1.0$ Å, $n_e=0.5$, $N=7$).\n- Test 4: ($t=1.0$ eV, $a=1.0$ Å, $n_e=2.0$, $N=7$).\n- Test 5: ($t=2.5$ eV, $a=3.0$ Å, $n_e=1.3$, $N=11$).\n\nUse a single common reference grid size $N_{\\mathrm{ref}}=181$ for all cases. All energies must be reported in electronvolts (eV). Angles in all trigonometric functions are in radians.\n\nFinal output format:\n- Your program should produce a single line of output containing the absolute errors $\\Delta E$ for the five test cases, in electronvolts (eV), as a comma-separated list enclosed in square brackets, in the same order as the test suite. For example, a valid output format is\n$[x_1,x_2,x_3,x_4,x_5]$,\nwhere each $x_i$ is a floating-point number in electronvolts (eV).",
            "solution": "We begin from the Rayleigh-Ritz variational principle in quantum mechanics: for any normalized trial state $\\lvert\\psi\\rangle$, the expectation value $\\langle\\psi\\lvert \\hat{H} \\rvert\\psi\\rangle$ is an upper bound to the exact ground-state energy $E_0$. In a non-interacting electron system, the many-body ground state is a Slater determinant of the lowest-energy single-particle eigenstates. At zero temperature with spin degeneracy $g_s=2$, the ground-state occupancy is to fill single-particle states in order of increasing single-particle energy, subject to the Pauli exclusion principle.\n\nIn a periodic crystal, the single-particle eigenstates are Bloch waves characterized by crystal momentum $\\mathbf{k}$ in the first Brillouin Zone (BZ). For the square-lattice tight-binding model with nearest-neighbor hopping amplitude $t$ and a single orbital per site, the single-particle energies are given by\n$$\n\\varepsilon(\\mathbf{k}) \\;=\\; -2t\\left(\\cos(k_x a) + \\cos(k_y a)\\right),\n$$\nwhere $a$ is the lattice constant and the arguments of the cosine are angles measured in radians. The first Brillouin Zone (BZ) is the square $\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]\\times\\left[-\\frac{\\pi}{a},\\frac{\\pi}{a}\\right]$ spanned by reciprocal lattice vectors $\\mathbf{b}_1=\\frac{2\\pi}{a}\\hat{\\mathbf{x}}$ and $\\mathbf{b}_2=\\frac{2\\pi}{a}\\hat{\\mathbf{y}}$.\n\nThe total energy per unit cell for $n_e$ electrons per unit cell (counting both spins) at zero temperature is, in the continuum, the integral\n$$\nE \\;=\\; \\frac{g_s \\int_{\\mathrm{BZ}} \\varepsilon(\\mathbf{k}) \\, f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k})}{n_e},\n$$\nwhere $g_s=2$ is the spin degeneracy, $f(\\mathbf{k})\\in[0,1]$ is the occupation function per spin, and $\\mathrm{d}\\mu(\\mathbf{k})$ is a normalized measure over the BZ such that $\\int_{\\mathrm{BZ}}\\mathrm{d}\\mu(\\mathbf{k})=1$. The electron number constraint is\n$$\n\\int_{\\mathrm{BZ}} f(\\mathbf{k}) \\,\\mathrm{d}\\mu(\\mathbf{k}) \\;=\\; \\frac{n_e}{g_s}.\n$$\nThe variational principle dictates that the minimizing $f(\\mathbf{k})$ is a projector onto the set of lowest-energy states up to a Fermi contour, i.e., $f(\\mathbf{k})=\\Theta(\\varepsilon_F-\\varepsilon(\\mathbf{k}))$ with an appropriate Fermi energy $\\varepsilon_F$; the minimizer fills lower-energy states first, which follows from rearrangement inequalities for linear functionals under box constraints.\n\nTo compute numerically, we approximate the BZ integral by a Riemann sum over a Monkhorst-Pack (MP) grid. The two-dimensional $N\\times N$ MP grid in fractional coordinates is given by\n$$\nu_i \\;=\\; \\frac{2i - N - 1}{2N},\\quad v_j \\;=\\; \\frac{2j - N - 1}{2N},\\quad i,j\\in\\{1,2,\\dots,N\\},\n$$\nand the associated crystal momenta are\n$$\n\\mathbf{k}_{ij} \\;=\\; u_i\\,\\mathbf{b}_1 + v_j\\,\\mathbf{b}_2,\n$$\nwith equal weights $w=\\frac{1}{N^2}$ so that $\\sum_{i,j} w=1$. Note that the angles entering the cosine in $\\varepsilon(\\mathbf{k})$ are $k_x a = 2\\pi u_i$ and $k_y a = 2\\pi v_j$, which are in radians. The discrete variational problem is then\n$$\n\\min_{\\{f_{ij}\\}} \\; \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij}) \\;\\;\\text{subject to}\\;\\; \\sum_{i,j} w \\, f_{ij} \\;=\\; \\frac{n_e}{g_s},\\;\\; 0\\le f_{ij}\\le 1,\n$$\nand the discrete total energy per electron is\n$$\nE_N \\;=\\; \\frac{g_s \\sum_{i,j} w \\, f_{ij} \\, \\varepsilon(\\mathbf{k}_{ij})}{n_e}.\n$$\n\nSolution structure and justification:\n- The objective is linear in the variables $\\{f_{ij}\\}$, with box constraints and a linear equality constraint on their average. This is a continuous knapsack problem. By the rearrangement inequality and the fact that the feasible set is a polymatroid, the minimizer is obtained by sorting $\\varepsilon(\\mathbf{k}_{ij})$ in ascending order and setting $f_{ij}=1$ for the lowest-energy points until the constraint is nearly saturated, with at most one partially occupied point to satisfy the constraint exactly. Specifically, let $\\{\\varepsilon_\\ell\\}_{\\ell=1}^{N^2}$ be the sorted list in ascending order, with common weight $w=\\frac{1}{N^2}$, and let $x=\\frac{n_e}{g_s}\\in[0,1]$ be the required average occupation per spin. Define $m=\\left\\lfloor \\frac{x}{w}\\right\\rfloor$ and the residual $r=x-mw\\in[0,w)$. The minimizing occupations are $f_\\ell=1$ for $\\ell\\in\\{1,\\dots,m\\}$, $f_{m+1}=\\frac{r}{w}$ if $r>0$, and $f_\\ell=0$ for all larger $\\ell$. The discrete energy per electron is then\n$$\nE_N \\;=\\; \\frac{g_s}{n_e} \\left( w \\sum_{\\ell=1}^{m} \\varepsilon_\\ell \\;+\\; r \\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{r>0\\}} \\right).\n$$\nThis is the direct discrete analogue of zero-temperature Fermi filling and is itself a Rayleigh-Ritz variational minimization within the subspace of states representable on the chosen MP grid.\n- The convergence with respect to the k-point density arises because the MP Riemann sums converge to the integral as $N\\to\\infty$, and the discrete variational minimizer converges to the continuum minimizer. Therefore, the absolute error $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$ with a large reference $N_{\\mathrm{ref}}$ quantifies the sampling error.\n\nAlgorithmic plan:\n- For each grid size $N$, build the fractional MP coordinates $u_i$ and $v_j$, compute $\\varepsilon(\\mathbf{k}_{ij})=-2t\\left(\\cos(2\\pi u_i)+\\cos(2\\pi v_j)\\right)$ in electronvolts, flatten and sort ascending, and set $w=\\frac{1}{N^2}$.\n- For a given electron count per unit cell $n_e\\in[0,2]$, set $x=\\frac{n_e}{g_s}$ with $g_s=2$. Compute $m=\\min\\left(\\left\\lfloor \\frac{x}{w}\\right\\rfloor,N^2\\right)$ and residual $r=\\max\\left(0,\\,x-mw\\right)$. Compute\n$$\nE_N \\;=\\; \\frac{g_s}{n_e}\\left(w\\sum_{\\ell=1}^{m}\\varepsilon_\\ell + r\\,\\varepsilon_{m+1}\\,\\mathbf{1}_{\\{m<N^2 \\wedge r>0\\}}\\right).\n$$\n- For each test case $(t,a,n_e,N)$ in the suite, compute $E_N$ and $E_{N_{\\mathrm{ref}}}$ with a common large $N_{\\mathrm{ref}}=181$, then compute $\\Delta E=\\lvert E_N-E_{N_{\\mathrm{ref}}}\\rvert$ in electronvolts.\n- Report the list $[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5]$ in a single line.\n\nEdge cases and coverage rationale:\n- Test 1 and 2 compare two different k-point densities at half-filling $n_e=1.0$, showing reduction of $\\Delta E$ with increased $N$.\n- Test 3 uses quarter-filling $n_e=0.5$, exercising fractional last-occupation behavior in the discrete scheme.\n- Test 4 uses full filling $n_e=2.0$, where the entire band is occupied. For this symmetric dispersion the exact BZ average is zero, so $E_N$ equals the MP average and $\\Delta E$ should be near zero, probing symmetry and averaging behavior.\n- Test 5 changes both the hopping $t$ and the electron count $n_e$, verifying correct energy scaling with $t$ and generality across fillings.\n\nAll energies are in electronvolts (eV) and all angles are in radians. The final program must produce a single line containing the five absolute errors as a comma-separated list enclosed in square brackets.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef mp_energies_sorted(N: int, t_ev: float, a_angstrom: float) -> tuple[np.ndarray, float]:\n    \"\"\"\n    Generate an N x N Monkhorst-Pack grid for a square lattice and return\n    the sorted single-particle energies in eV along with the uniform weight w = 1/N^2.\n\n    Parameters:\n        N (int): divisions along each reciprocal lattice direction.\n        t_ev (float): nearest-neighbor hopping amplitude t in eV.\n        a_angstrom (float): lattice constant a in angstroms (Å).\n\n    Returns:\n        energies_sorted (np.ndarray): sorted energies (ascending), shape (N*N,)\n        w (float): uniform weight = 1/(N^2)\n    \"\"\"\n    # Fractional MP coordinates u_i, v_j in [-0.5, 0.5), centered.\n    i = np.arange(1, N + 1, dtype=float)\n    u = (2.0 * i - N - 1.0) / (2.0 * N)  # shape (N,)\n    # Create meshgrid of fractional coordinates\n    U, V = np.meshgrid(u, u, indexing='ij')  # shape (N,N)\n\n    # For square lattice: kx * a = 2*pi*U, ky * a = 2*pi*V. Angles are in radians.\n    kxa = 2.0 * np.pi * U\n    kya = 2.0 * np.pi * V\n\n    # Tight-binding dispersion: epsilon(k) = -2 t [cos(kx a) + cos(ky a)]\n    # Energies are in eV if t_ev is in eV.\n    eps = -2.0 * t_ev * (np.cos(kxa) + np.cos(kya))  # shape (N,N)\n\n    energies_sorted = np.sort(eps.ravel())\n    w = 1.0 / (N * N)\n    return energies_sorted, w\n\ndef variational_energy_per_electron_from_sorted(energies_sorted: np.ndarray,\n                                                w: float,\n                                                n_e: float,\n                                                g_s: float = 2.0) -> float:\n    \"\"\"\n    Compute the discrete variational ground-state total energy per electron (in eV)\n    for a given sorted list of single-particle energies and uniform weight.\n\n    Parameters:\n        energies_sorted (np.ndarray): sorted ascending energies, length K = N^2\n        w (float): uniform weight = 1/K\n        n_e (float): number of electrons per unit cell (including both spins), 0 <= n_e <= 2\n        g_s (float): spin degeneracy (default 2)\n\n    Returns:\n        E_per_e (float): total energy per electron in eV\n    \"\"\"\n    if n_e <= 0.0:\n        # No electrons -> energy per electron undefined; not used by the given test suite.\n        return 0.0\n\n    K = energies_sorted.size\n    x = n_e / g_s  # required average occupation per spin in [0,1]\n    # Compute number of fully occupied k-points and residual fractional occupation.\n    # Add a small epsilon to guard against floating-point representation issues.\n    m = int(np.floor(x / w + 1e-14))\n    if m > K:\n        m = K\n    # Residual fraction toward the next state\n    residual = x - m * w\n    if residual < 0.0:\n        residual = 0.0\n\n    # Sum energies of the lowest m states\n    energy_sum = 0.0\n    if m > 0:\n        energy_sum += w * float(np.sum(energies_sorted[:m]))\n    # Add fractional occupation of the (m+1)-th state if needed and available\n    if (m < K) and (residual > 1e-18):\n        energy_sum += residual * float(energies_sorted[m])\n\n    # Total energy per electron\n    E_per_cell = g_s * energy_sum  # energy per unit cell (both spins)\n    E_per_e = E_per_cell / n_e\n    return E_per_e\n\ndef compute_error_for_case(t_ev: float, a_angstrom: float, n_e: float,\n                           N_small: int, N_ref: int) -> float:\n    \"\"\"\n    Compute the absolute error |E_N - E_Nref| in eV for a given test case.\n\n    Parameters:\n        t_ev (float): hopping parameter t in eV\n        a_angstrom (float): lattice constant a in angstroms (Å)\n        n_e (float): electrons per unit cell (0 <= n_e <= 2)\n        N_small (int): small MP grid size\n        N_ref (int): reference MP grid size (large)\n\n    Returns:\n        abs_error (float): absolute error in eV\n    \"\"\"\n    # Small grid energy\n    e_small_sorted, w_small = mp_energies_sorted(N_small, t_ev, a_angstrom)\n    E_small = variational_energy_per_electron_from_sorted(e_small_sorted, w_small, n_e, g_s=2.0)\n\n    # Reference grid energy\n    e_ref_sorted, w_ref = mp_energies_sorted(N_ref, t_ev, a_angstrom)\n    E_ref = variational_energy_per_electron_from_sorted(e_ref_sorted, w_ref, n_e, g_s=2.0)\n\n    return abs(E_small - E_ref)\n\ndef solve():\n    # Define the test cases from the problem statement: (t [eV], a [Å], n_e, N_small)\n    test_cases = [\n        (1.0, 1.0, 1.0, 5),\n        (1.0, 1.0, 1.0, 9),\n        (1.0, 1.0, 0.5, 7),\n        (1.0, 1.0, 2.0, 7),\n        (2.5, 3.0, 1.3, 11),\n    ]\n    # Common reference grid size\n    N_ref = 181\n\n    results = []\n    for t_ev, a_angstrom, n_e, N_small in test_cases:\n        err = compute_error_for_case(t_ev, a_angstrom, n_e, N_small, N_ref)\n        # Format with a reasonable precision to ensure a clean single-line output\n        results.append(f\"{err:.12f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "A correct calculation is not enough; it must also be efficient. This exercise  delves into the theoretical underpinnings of convergence, exploring how the smoothness of the wavefunction dictates how fast our variational energy approaches the exact value as the basis set grows. By comparing a smooth potential to one with a Coulomb cusp, you will gain a deep appreciation for why methods like the pseudopotential approximation are essential for practical plane-wave calculations.",
            "id": "3852634",
            "problem": "In periodic multiscale materials simulations, a common discretization of the single-particle Schrödinger operator is the Rayleigh–Ritz projection onto a truncated plane-wave space. Consider a nonrelativistic electron in a cubic cell of side $L$, with Hamiltonian $H = -\\tfrac{1}{2}\\Delta + V(\\mathbf{r})$ under periodic boundary conditions. Let $V(\\mathbf{r})$ be real-valued and periodic with the cell, and denote by $E$ the exact lowest eigenvalue and by $E_M$ the lowest Rayleigh–Ritz eigenvalue obtained by restricting trial states to the span of plane waves with reciprocal vectors $\\mathbf{G}$ satisfying $\\lvert \\mathbf{G} \\rvert \\le G_{\\max}$. Denote the basis size by $M$, which scales proportionally to the number of reciprocal lattice points inside the sphere of radius $G_{\\max}$, i.e., $M \\asymp G_{\\max}^3$. The associated kinetic energy cutoff is $E_{\\mathrm{cut}} \\propto G_{\\max}^2$.\n\nCompare the asymptotic convergence of the variational energy error $\\delta E_M := E_M - E$ with respect to $M$ in the following two settings:\n- Case (i): a smooth periodic pseudopotential, $V \\in C^{\\infty}$, for which the exact eigenfunction is periodic and analytic;\n- Case (ii): a Coulombic all-electron potential with point nuclei at Bravais lattice sites, which induces Kato cusps in the exact eigenfunction at nuclear positions.\n\nUsing only the variational characterization of eigenvalues and basic approximation theory of Fourier series, identify which of the following statements are correct in the limit $M \\to \\infty$:\n\nA. In case (i), the variational energy error $\\delta E_M$ decays exponentially in $M^{1/3}$, i.e., there exist positive constants $C$ and $\\alpha$ such that $\\delta E_M \\le C \\exp\\!\\big(-\\alpha\\, M^{1/3}\\big)$ for all sufficiently large $M$.\n\nB. In case (ii), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-1}$.\n\nC. In case (ii), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-2}$.\n\nD. In case (i), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-2}$.\n\nE. In case (ii), when expressed in terms of the kinetic energy cutoff $E_{\\mathrm{cut}}$, the energy error obeys $\\delta E_M = \\mathcal{O}\\!\\big(E_{\\mathrm{cut}}^{-3/2}\\big)$.\n\nF. The variational principle implies $\\delta E_M \\ge 0$ and, up to constants that may depend on spectral gaps and stability, $\\delta E_M$ is bounded above by the square of the best-approximation error of the exact eigenfunction in the $H^1$-type energy norm associated with $H$.",
            "solution": "The problem asks for an analysis of the convergence rate of the variational energy error, $\\delta E_M = E_M - E$, for a single-particle Schrödinger operator discretized using a plane-wave basis. The convergence is to be compared for two cases: a smooth potential and a singular Coulomb potential.\n\nThe analysis hinges on two fundamental principles:\n1.  The **Rayleigh–Ritz variational principle**, which states that the ground state energy $E$ of a Hamiltonian $H$ is the minimum of the Rayleigh quotient $\\langle \\psi | H | \\psi \\rangle / \\langle \\psi | \\psi \\rangle$ over all possible trial wavefunctions $\\psi$. The eigenvalue $E_M$ obtained from a calculation restricted to a linear subspace $\\mathcal{S}_M$ is an upper bound to the true ground state energy $E$. Therefore, $E_M \\ge E$, and the energy error $\\delta E_M = E_M - E \\ge 0$.\n2.  **Approximation theory of Fourier series**, which dictates that the rate of convergence of a truncated Fourier series approximation to a function depends on the smoothness of that function. For a function $f$ whose Fourier coefficients are $\\hat{f}(\\mathbf{G})$, the error in approximating it with a truncated series up to a cutoff $G_{\\max}$ is related to the decay rate of $|\\hat{f}(\\mathbf{G})|$ for $|\\mathbf{G}| > G_{\\max}$.\n\nThe convergence of the energy error $\\delta E_M$ is determined by how well the trial eigenfunction can approximate the true eigenfunction $\\psi$. A standard result from the theory of the Rayleigh-Ritz method is that the error in the eigenvalue is bounded by the square of the error in the eigenfunction approximation in the energy norm. For the given Hamiltonian $H = -\\frac{1}{2}\\Delta + V$, this norm is closely related to the Sobolev $H^1$ norm. The error is dominated by the kinetic energy of the plane-wave components excluded from the basis set:\n$$ \\delta E_M \\approx \\sum_{|\\mathbf{G}| > G_{\\max}} \\frac{1}{2} |\\mathbf{G}|^2 |\\hat{\\psi}(\\mathbf{G})|^2 $$\nwhere $\\hat{\\psi}(\\mathbf{G})$ are the Fourier coefficients of the exact ground state eigenfunction $\\psi$.\n\nWe now analyze the two cases based on the smoothness of $\\psi$ and the resulting decay of its Fourier coefficients.\n\n**Case (i): Smooth Periodic Pseudopotential**\nThe potential $V(\\mathbf{r})$ is taken to be infinitely differentiable, $V \\in C^{\\infty}$, and periodic. The problem states the exact eigenfunction $\\psi$ is analytic. For a periodic, analytic function in three dimensions, the Fourier coefficients $\\hat{\\psi}(\\mathbf{G})$ decay exponentially with the magnitude of the reciprocal lattice vector:\n$$ |\\hat{\\psi}(\\mathbf{G})| \\le C_1 \\exp(-c |\\mathbf{G}|) $$\nfor some positive constants $C_1$ and $c$. This rapid, \"spectral\" decay of the coefficients leads to an equally rapid convergence of the energy error. The error $\\delta E_M$ will be dominated by the first neglected term at the cutoff boundary, $|\\mathbf{G}| \\approx G_{\\max}$, resulting in an exponential decay with respect to $G_{\\max}$:\n$$ \\delta E_M \\le C_2 \\exp(-\\alpha' G_{\\max}) $$\nThe problem defines the basis size $M$ as the number of reciprocal lattice points within a sphere of radius $G_{\\max}$. In three dimensions, this volume scales as $G_{\\max}^3$, so $M \\asymp G_{\\max}^3$, which implies $G_{\\max} \\asymp M^{1/3}$. Substituting this into the error bound gives:\n$$ \\delta E_M \\le C_2 \\exp(-\\alpha' c' M^{1/3}) = C \\exp(-\\alpha M^{1/3}) $$\nThis shows that for a smooth potential, the error decays exponentially with the cube root of the basis size $M$.\n\n**Case (ii): Coulombic All-Electron Potential**\nThe potential $V(\\mathbf{r})$ contains Coulomb singularities of the form $-Z/|\\mathbf{r}-\\mathbf{R}|$ at the nuclear positions $\\mathbf{R}$. This singularity fundamentally alters the smoothness of the eigenfunction $\\psi$. According to Kato's cusp condition, $\\psi$ is continuous but has a cusp (a discontinuity in the gradient) at each nucleus. This limits the smoothness of $\\psi$.\nTo determine the decay of the Fourier coefficients, we consider the Schrödinger equation in Fourier space.\n$$ H\\psi = E\\psi \\implies -\\frac{1}{2}\\Delta\\psi = (E-V)\\psi $$\nThe Fourier transform of the Laplacian is $\\mathcal{F}[\\Delta\\psi](\\mathbf{G}) = -|\\mathbf{G}|^2 \\hat{\\psi}(\\mathbf{G})$. For large $|\\mathbf{G}|$, the behavior of $\\hat{\\psi}(\\mathbf{G})$ is determined by the most singular parts of $(E-V)\\psi$. Near a nucleus at the origin, $V(\\mathbf{r}) \\sim -Z/r$. Since $\\psi(\\mathbf{r})$ is approximately constant near $r=0$, the term $V\\psi$ has a $1/r$ singularity. The 3D Fourier transform of $1/r$ is proportional to $1/|\\mathbf{G}|^2$. Thus, we have the asymptotic relation:\n$$ -|\\mathbf{G}|^2 \\hat{\\psi}(\\mathbf{G}) \\sim |\\mathbf{G}|^{-2} \\implies \\hat{\\psi}(\\mathbf{G}) \\sim |\\mathbf{G}|^{-4} $$\nThe energy error is estimated by integrating the contribution from the high-frequency components:\n$$ \\delta E_M \\propto \\int_{|\\mathbf{G}| > G_{\\max}} |\\mathbf{G}|^2 |\\hat{\\psi}(\\mathbf{G})|^2 \\, d^3\\mathbf{G} $$\nChanging to spherical coordinates in reciprocal space (with $K = |\\mathbf{G}|$), the volume element is $4\\pi K^2 dK$.\n$$ \\delta E_M \\propto \\int_{G_{\\max}}^{\\infty} K^2 \\cdot \\left(K^{-4}\\right)^2 \\cdot K^2 \\, dK = \\int_{G_{\\max}}^{\\infty} K^4 \\cdot K^{-8} \\, dK = \\int_{G_{\\max}}^{\\infty} K^{-4} \\, dK $$\nEvaluating the integral gives:\n$$ \\delta E_M \\propto \\left[ -\\frac{1}{3}K^{-3} \\right]_{G_{\\max}}^{\\infty} \\propto G_{\\max}^{-3} $$\nUsing the relationships $M \\asymp G_{\\max}^3$ and $E_{\\mathrm{cut}} \\propto G_{\\max}^2$, we can express this algebraic decay in terms of $M$ or $E_{\\mathrm{cut}}$.\nIn terms of $M$: $G_{\\max} \\asymp M^{1/3} \\implies \\delta E_M \\propto (M^{1/3})^{-3} = M^{-1}$.\nIn terms of $E_{\\mathrm{cut}}$: $G_{\\max} \\propto E_{\\mathrm{cut}}^{1/2} \\implies \\delta E_M \\propto (E_{\\mathrm{cut}}^{1/2})^{-3} = E_{\\mathrm{cut}}^{-3/2}$.\n\nNow we evaluate each option.\n\n**A. In case (i), the variational energy error $\\delta E_M$ decays exponentially in $M^{1/3}$, i.e., there exist positive constants $C$ and $\\alpha$ such that $\\delta E_M \\le C \\exp\\!\\big(-\\alpha\\, M^{1/3}\\big)$ for all sufficiently large $M$.**\nOur analysis for Case (i) showed that for an analytic eigenfunction, $\\delta E_M \\sim \\exp(-\\alpha G_{\\max})$. With $G_{\\max} \\asymp M^{1/3}$, this becomes $\\delta E_M \\sim \\exp(-\\alpha' M^{1/3})$. This statement is a correct description of spectral convergence for this problem.\n**Verdict: Correct.**\n\n**B. In case (ii), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-1}$.**\nOur analysis for Case (ii) showed that the presence of a Coulomb cusp leads to an energy error decay of $\\delta E_M \\propto G_{\\max}^{-3}$. Given $M \\asymp G_{\\max}^3$, this implies $\\delta E_M \\propto M^{-1}$.\n**Verdict: Correct.**\n\n**C. In case (ii), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-2}$.**\nThis contradicts the derived rate of $M^{-1}$. A rate of $M^{-2}$ would imply a smoother eigenfunction than one with a cusp.\n**Verdict: Incorrect.**\n\n**D. In case (i), with a plane-wave basis, $\\delta E_M$ decays algebraically as $M^{-2}$.**\nThis is incorrect. The convergence for the smooth potential case is exponential, which is substantially faster than any algebraic rate of decay.\n**Verdict: Incorrect.**\n\n**E. In case (ii), when expressed in terms of the kinetic energy cutoff $E_{\\mathrm{cut}}$, the energy error obeys $\\delta E_M = \\mathcal{O}\\!\\big(E_{\\mathrm{cut}}^{-3/2}\\big)$.**\nOur analysis for Case (ii) showed $\\delta E_M \\propto G_{\\max}^{-3}$. Using the relation $E_{\\mathrm{cut}} \\propto G_{\\max}^2$, which means $G_{\\max} \\propto E_{\\mathrm{cut}}^{1/2}$, we find $\\delta E_M \\propto (E_{\\mathrm{cut}}^{1/2})^{-3} = E_{\\mathrm{cut}}^{-3/2}$. The statement is a correct re-expression of the convergence rate in terms of the energy cutoff.\n**Verdict: Correct.**\n\n**F. The variational principle implies $\\delta E_M \\ge 0$ and, up to constants that may depend on spectral gaps and stability, $\\delta E_M$ is bounded above by the square of the best-approximation error of the exact eigenfunction in the $H^1$-type energy norm associated with $H$.**\nThis statement makes two claims. First, `The variational principle implies $\\delta E_M \\ge 0$`. As established by the Rayleigh-Ritz principle, the variational energy $E_M$ is always an upper bound to the true ground state energy $E$, so $E_M - E = \\delta E_M \\ge 0$. This is correct.\nSecond, `$\\delta E_M$ is bounded above by the square of the best-approximation error of the exact eigenfunction in the $H^1$-type energy norm`. This is a statement of a standard theorem in the numerical analysis of eigenvalue problems (e.g., the Rayleigh-Ritz method or finite element method). Specifically, $|E_M - E| \\le C \\inf_{\\chi \\in \\mathcal{S}_M} \\|\\psi - \\chi\\|_{H^1}^2$. The term $\\inf_{\\chi \\in \\mathcal{S}_M} \\|\\psi - \\chi\\|_{H^1}$ is precisely the best-approximation error of $\\psi$ from the subspace $\\mathcal{S}_M$ in the $H^1$ norm. The energy form $\\langle u, Hu \\rangle$ induces a norm equivalent to the $H^1$ norm (for functions orthogonal to the kernel of $H$, on a suitable domain), hence the phrasing \"$H^1$-type energy norm\" is appropriate. This part of the statement is also a cornerstone of the theory.\n**Verdict: Correct.**",
            "answer": "$$\\boxed{ABEF}$$"
        }
    ]
}