{
    "hands_on_practices": [
        {
            "introduction": "Before tackling complex interactions, it is crucial to understand the baseline case of non-interacting particles. This foundational exercise guides you through constructing the exact ground-state wavefunction for a system of fermions, governed solely by the Pauli exclusion principle. By solving the many-body Schrödinger equation for this idealized Fermi gas in a one-dimensional box, you will build a concrete understanding of how single-particle states combine to form a many-body state and how the total energy emerges from this construction .",
            "id": "5303426",
            "problem": "Consider $N$ identical spinless fermions of mass $m$ confined to a one-dimensional infinite square well of length $L$ with hard-wall boundary conditions. The many-body Hamiltonian is\n$$\n\\hat{H} \\;=\\; \\sum_{i=1}^{N}\\left[-\\frac{\\hbar^{2}}{2m}\\frac{\\partial^{2}}{\\partial x_{i}^{2}} + V(x_{i})\\right],\n$$\nwhere $V(x)$ is $0$ for $0xL$ and $+\\infty$ otherwise. The many-body Schrödinger equation is\n$$\n\\hat{H}\\,\\Psi(x_{1},x_{2},\\dots,x_{N}) \\;=\\; E\\,\\Psi(x_{1},x_{2},\\dots,x_{N}),\n$$\nwith the fermionic ground state required to be fully antisymmetric under particle exchange and to satisfy $\\Psi=0$ whenever any $x_{i}\\notin(0,L)$.\n\nStarting from first principles appropriate to computational many-body physics and the many-body Schrödinger equation, do the following:\n\n- Construct the exact, normalized ground-state many-body wavefunction $\\Psi_{0}(x_{1},\\dots,x_{N})$ in terms of single-particle eigenfunctions consistent with the boundary conditions and fermionic antisymmetry. Provide a form that makes its normalization explicit.\n- Using your construction, determine the exact closed-form expression for the total ground-state energy $E_{0}(N,L)$ as a function of $N$ and $L$, keeping $\\hbar$ and $m$ explicit.\n\nExpress the final energy as a symbolic expression in terms of $\\hbar$, $m$, $L$, and $N$. No numerical evaluation or rounding is required, and no units need be reported in the final expression.",
            "solution": "The many-body Hamiltonian $\\hat{H}$ is a sum of single-particle Hamiltonians $\\hat{h}_i$:\n$$\n\\hat{H} = \\sum_{i=1}^{N} \\hat{h}_i, \\quad \\text{where} \\quad \\hat{h}_i = -\\frac{\\hbar^{2}}{2m}\\frac{\\partial^{2}}{\\partial x_{i}^{2}} + V(x_{i})\n$$\nSince the particles are non-interacting, the many-body wavefunction can be constructed from the solutions of the single-particle Schrödinger equation:\n$$\n\\hat{h}\\phi(x) = \\epsilon\\phi(x)\n$$\nFor a one-dimensional infinite square well of length $L$, the potential is $V(x)=0$ for $x \\in (0, L)$ and infinite otherwise. The single-particle Hamiltonian inside the well is $\\hat{h} = -\\frac{\\hbar^2}{2m}\\frac{d^2}{dx^2}$. The boundary conditions are $\\phi(0) = 0$ and $\\phi(L) = 0$.\n\nThe solutions to this single-particle problem are the well-known normalized eigenfunctions and their corresponding energy eigenvalues:\n$$\n\\phi_{n}(x) = \\sqrt{\\frac{2}{L}} \\sin\\left(\\frac{n\\pi x}{L}\\right)\n$$\n$$\n\\epsilon_{n} = \\frac{\\hbar^{2}k_{n}^{2}}{2m} = \\frac{\\hbar^{2}\\pi^{2}n^{2}}{2mL^{2}}\n$$\nwhere $n=1, 2, 3, \\dots$ is the principal quantum number.\n\nThe problem concerns $N$ identical spinless fermions. According to the Pauli exclusion principle, no two identical fermions can occupy the same quantum state. Since the fermions are spinless, their state is defined solely by the quantum number $n$. Therefore, each fermion must occupy a different single-particle orbital $\\phi_n$.\n\nTo find the ground state of the $N$-particle system, we must fill the lowest-energy single-particle states. These correspond to the quantum numbers $n=1, 2, \\dots, N$.\n\nThe many-body wavefunction for fermions must be completely antisymmetric with respect to the exchange of any two particle coordinates. For a system of non-interacting fermions, the correctly normalized, antisymmetric wavefunction is given by the Slater determinant of the occupied single-particle orbitals.\n\nFor the ground state, the occupied orbitals are $\\{\\phi_1, \\phi_2, \\dots, \\phi_N\\}$. The ground-state many-body wavefunction $\\Psi_{0}(x_{1},\\dots,x_{N})$ is therefore:\n$$\n\\Psi_{0}(x_{1},x_{2},\\dots,x_{N}) = \\frac{1}{\\sqrt{N!}}\n\\begin{vmatrix}\n\\phi_1(x_1)  \\phi_2(x_1)  \\cdots  \\phi_N(x_1) \\\\\n\\phi_1(x_2)  \\phi_2(x_2)  \\cdots  \\phi_N(x_2) \\\\\n\\vdots       \\vdots       \\ddots  \\vdots      \\\\\n\\phi_1(x_N)  \\phi_2(x_N)  \\cdots  \\phi_N(x_N)\n\\end{vmatrix}\n$$\nwhere each $\\phi_n(x_i)$ is given by $\\phi_{n}(x_{i}) = \\sqrt{\\frac{2}{L}} \\sin\\left(\\frac{n\\pi x_{i}}{L}\\right)$. The prefactor $\\frac{1}{\\sqrt{N!}}$ ensures that the many-body wavefunction is normalized, since the single-particle orbitals $\\{\\phi_n\\}$ form an orthonormal set, i.e., $\\int_{0}^{L} \\phi_{n}^{*}(x)\\phi_{m}(x)dx = \\delta_{nm}$. This is the required construction of the ground-state wavefunction.\n\nNext, we determine the total ground-state energy $E_0$. Since the Hamiltonian is a sum of single-particle operators and the particles are non-interacting, the total energy is the sum of the energies of the occupied single-particle states:\n$$\nE_{0} = \\sum_{n=1}^{N} \\epsilon_{n}\n$$\nSubstituting the expression for the single-particle energy eigenvalues $\\epsilon_n$:\n$$\nE_{0}(N,L) = \\sum_{n=1}^{N} \\frac{\\hbar^{2}\\pi^{2}n^{2}}{2mL^{2}}\n$$\nWe can factor out the constants that do not depend on the summation index $n$:\n$$\nE_{0}(N,L) = \\frac{\\hbar^{2}\\pi^{2}}{2mL^{2}} \\sum_{n=1}^{N} n^{2}\n$$\nThe sum of the first $N$ squares is given by the well-known closed-form expression (Faulhaber's formula):\n$$\n\\sum_{n=1}^{N} n^{2} = \\frac{N(N+1)(2N+1)}{6}\n$$\nSubstituting this sum back into the expression for the ground-state energy gives:\n$$\nE_{0}(N,L) = \\frac{\\hbar^{2}\\pi^{2}}{2mL^{2}} \\left( \\frac{N(N+1)(2N+1)}{6} \\right)\n$$\nCombining the numerical factors, we arrive at the final exact closed-form expression for the ground-state energy:\n$$\nE_{0}(N,L) = \\frac{\\hbar^{2}\\pi^{2}N(N+1)(2N+1)}{12mL^{2}}\n$$\nThis expression gives the total ground-state energy as a function of the number of particles $N$, the length of the well $L$, the particle mass $m$, and Planck's constant $\\hbar$.",
            "answer": "$$\n\\boxed{\\frac{\\hbar^{2}\\pi^{2}N(N+1)(2N+1)}{12mL^{2}}}\n$$"
        },
        {
            "introduction": "Real materials are defined by the intricate dance of electron-electron interactions, which are absent in the simple Fermi gas model. This practice introduces the Hubbard model, a cornerstone for understanding strongly correlated systems, in its most minimal form: the two-site \"dimer\" . By exactly diagonalizing the Hamiltonian, you will explore the competition between electron hopping ($t$) and on-site Coulomb repulsion ($U$), and derive the energy splitting between singlet and triplet states, a key concept in magnetism.",
            "id": "5303435",
            "problem": "Consider the two-site Hubbard model (Hubbard dimer) with two electrons. The time-independent many-body Schrödinger equation states that a stationary state $\\lvert \\Psi \\rangle$ satisfies $H \\lvert \\Psi \\rangle = E \\lvert \\Psi \\rangle$. The second-quantized Hubbard dimer Hamiltonian is\n$$\nH \\;=\\; -\\,t \\sum_{\\sigma \\in \\{\\uparrow,\\downarrow\\}} \\left( c_{1\\sigma}^{\\dagger} c_{2\\sigma} + c_{2\\sigma}^{\\dagger} c_{1\\sigma} \\right) \\;+\\; U \\sum_{i=1}^{2} n_{i\\uparrow} n_{i\\downarrow},\n$$\nwhere $t$ is the nearest-neighbor hopping amplitude, $U$ is the on-site interaction, $c_{i\\sigma}^{\\dagger}$ creates an electron of spin $\\sigma$ on site $i$, and $n_{i\\sigma} = c_{i\\sigma}^{\\dagger} c_{i\\sigma}$.\n\nStarting from the many-body Schrödinger equation and the above Hamiltonian, work in the sector of two electrons at half filling and use symmetry considerations of total spin to block-diagonalize the Hamiltonian into singlet and triplet sectors. Perform an exact diagonalization of the resulting blocks, and define the singlet-triplet energy splitting as $\\Delta_{ST} = E_{T} - E_{S}$, where $E_{T}$ is the lowest triplet energy and $E_{S}$ is the lowest singlet energy. Express your final answer for $\\Delta_{ST}$ as a closed-form analytic expression in terms of the dimensionless ratio $U/t$. Do not invoke any limiting approximations; provide the exact expression. No numerical rounding is required, and report the final expression without units.",
            "solution": "The goal is to find the singlet-triplet energy splitting $\\Delta_{ST} = E_{T} - E_{S}$ for the two-electron, two-site Hubbard model. We will diagonalize the Hamiltonian by separating the Hilbert space into sectors of definite total spin.\n\n**1. Constructing the Basis**\nFor two electrons on two sites, there are four available spin-orbitals: $(1,\\uparrow), (1,\\downarrow), (2,\\uparrow), (2,\\downarrow)$. The total number of two-electron states is $\\binom{4}{2} = 6$. These states can be categorized by the total spin projection $S_z$ and the number of doubly occupied sites.\n\n**2. The Triplet Sector ($S=1$)**\nThe triplet states are symmetric under spin exchange and must have an antisymmetric spatial part. This requires single occupancy of each site.\nThe three triplet states are:\n-   $|T_+\\rangle = c_{1\\uparrow}^{\\dagger} c_{2\\uparrow}^{\\dagger} |0\\rangle$ with $S_z = +1$.\n-   $|T_-\\rangle = c_{1\\downarrow}^{\\dagger} c_{2\\downarrow}^{\\dagger} |0\\rangle$ with $S_z = -1$.\n-   $|T_0\\rangle = \\frac{1}{\\sqrt{2}} (c_{1\\uparrow}^{\\dagger} c_{2\\downarrow}^{\\dagger} + c_{1\\downarrow}^{\\dagger} c_{2\\uparrow}^{\\dagger}) |0\\rangle$ with $S_z = 0$.\n\nThe on-site interaction term $U \\sum_i n_{i\\uparrow}n_{i\\downarrow}$ gives zero when acting on these states, as there is no double occupancy. The hopping term also gives zero. For example, $H_{kin} |T_+\\rangle = -t (c_{1\\uparrow}^\\dagger c_{2\\uparrow} + c_{2\\uparrow}^\\dagger c_{1\\uparrow}) c_{1\\uparrow}^\\dagger c_{2\\uparrow}^\\dagger |0\\rangle = 0$ due to the Pauli exclusion principle (an electron cannot hop to an already occupied spin-orbital).\nThus, all three triplet states are degenerate eigenstates with energy $E=0$. The lowest triplet energy is $E_T = 0$.\n\n**3. The Singlet Sector ($S=0$)**\nThe remaining $6-3=3$ states must be singlets ($S=0$). These states are antisymmetric under spin exchange and must have a symmetric spatial part. A convenient basis for the singlet sector can be formed by considering states with a definite number of doubly occupied sites:\n-   One state with one electron on each site: $|S_{so}\\rangle = \\frac{1}{\\sqrt{2}} (c_{1\\uparrow}^{\\dagger} c_{2\\downarrow}^{\\dagger} - c_{1\\downarrow}^{\\dagger} c_{2\\uparrow}^{\\dagger}) |0\\rangle$.\n-   Two states with double occupancy: $|\\psi_{D1}\\rangle = c_{1\\uparrow}^{\\dagger} c_{1\\downarrow}^{\\dagger} |0\\rangle$ and $|\\psi_{D2}\\rangle = c_{2\\uparrow}^{\\dagger} c_{2\\downarrow}^{\\dagger} |0\\rangle$.\n\nA symmetric basis that simplifies the Hamiltonian matrix is:\n1.  $|S_1\\rangle = |S_{so}\\rangle$\n2.  $|S_2\\rangle = \\frac{1}{\\sqrt{2}}(|\\psi_{D1}\\rangle + |\\psi_{D2}\\rangle)$\n3.  $|S_3\\rangle = \\frac{1}{\\sqrt{2}}(|\\psi_{D1}\\rangle - |\\psi_{D2}\\rangle)$\n\nThe Hamiltonian does not couple $|S_3\\rangle$ to the other two singlet states. Acting with the Hamiltonian:\n$H |S_3\\rangle = \\frac{U}{\\sqrt{2}} (|\\psi_{D1}\\rangle - |\\psi_{D2}\\rangle) = U |S_3\\rangle$. So, $|S_3\\rangle$ is an eigenstate with energy $U$.\n\nThe states $|S_1\\rangle$ and $|S_2\\rangle$ mix. We calculate the matrix elements of $H$ in this basis:\n-   $H_{11} = \\langle S_1 | H | S_1 \\rangle = 0$, as there is no double occupancy.\n-   $H_{22} = \\langle S_2 | H | S_2 \\rangle = \\frac{1}{2} \\langle \\psi_{D1} + \\psi_{D2} | U(n_{1\\uparrow}n_{1\\downarrow} + n_{2\\uparrow}n_{2\\downarrow}) | \\psi_{D1} + \\psi_{D2} \\rangle = \\frac{1}{2}(U+U) = U$.\n-   $H_{12} = \\langle S_1 | H | S_2 \\rangle = \\langle S_1 | H_{kin} | S_2 \\rangle$. A detailed calculation shows this matrix element is $-2t$.\n\nThe Hamiltonian in the $\\{|S_1\\rangle, |S_2\\rangle\\}$ basis is $H_{singlet} = \\begin{pmatrix} 0  -2t \\\\ -2t  U \\end{pmatrix}$.\n\n**4. Diagonalization and Energy Splitting**\nThe eigenvalues of this matrix are found by solving the characteristic equation $\\lambda(\\lambda-U) - 4t^2 = 0$, which gives $\\lambda^2 - U\\lambda - 4t^2 = 0$.\nThe solutions are $\\lambda = \\frac{U \\pm \\sqrt{U^2 + 16t^2}}{2}$.\nThe three singlet energies are therefore $E=U$ and $E = \\frac{U \\pm \\sqrt{U^2+16t^2}}{2}$. Assuming $U, t > 0$, the lowest singlet energy is the ground state energy:\n$$E_S = \\frac{U - \\sqrt{U^2 + 16t^2}}{2}$$\nThe singlet-triplet splitting is defined as $\\Delta_{ST} = E_T - E_S$.\n$$\\Delta_{ST} = 0 - \\left( \\frac{U - \\sqrt{U^2 + 16t^2}}{2} \\right) = \\frac{\\sqrt{U^2 + 16t^2} - U}{2}$$\nTo express this in terms of the ratio $U/t$, we factor out $t$:\n$$\\Delta_{ST} = \\frac{\\sqrt{t^2\\left((\\frac{U}{t})^2 + 16\\right)} - t\\frac{U}{t}}{2} = \\frac{t}{2} \\left[ \\sqrt{\\left(\\frac{U}{t}\\right)^2 + 16} - \\frac{U}{t} \\right]$$\nThis is the final expression.",
            "answer": "$$\\boxed{\\frac{t}{2} \\left[ \\sqrt{\\left(\\frac{U}{t}\\right)^2 + 16} - \\frac{U}{t} \\right]}$$"
        },
        {
            "introduction": "The analytical solutions for simple models are invaluable, but the vast majority of realistic many-body systems are too large for exact diagonalization. This computational practice bridges the gap between theory and modern simulation by having you implement the Lanczos algorithm, a powerful iterative method for finding extremal eigenvalues of large, sparse Hamiltonians . Mastering this technique provides a practical tool for tackling the \"curse of dimensionality\" and approximating the ground state properties of complex quantum spin models.",
            "id": "5303433",
            "problem": "Consider the time-independent many-body Schrödinger equation $H \\lvert \\Psi \\rangle = E \\lvert \\Psi \\rangle$ in a finite-dimensional Hilbert space for a lattice of $L$ spin-$\\frac{1}{2}$ degrees of freedom. The computational problem reduces to the spectral analysis of a real symmetric (Hermitian) matrix $H$ acting on a vector space of dimension $N = 2^L$. In this setting, Krylov subspace methods generate a sequence of low-dimensional projections of $H$ whose extremal eigenvalues approximate those of $H$. The Lanczos algorithm constructs an orthonormal basis of a Krylov subspace and produces a symmetric tridiagonal representation of $H$ in that basis.\n\nYour tasks are:\n- Starting from the definitions of a Hermitian operator, the Krylov subspace generated by a nonzero vector $\\lvert v_1 \\rangle$, and the Gram–Schmidt orthogonalization process, derive the existence of a unique sequence of real scalars and orthonormal vectors that enforce a three-term recurrence leading to a symmetric tridiagonal representation of $H$ on the Krylov basis. Your derivation must explicitly state the assumptions on $H$, the orthonormality conditions of the basis vectors, and the orthogonality properties implied by Hermiticity that constrain the structure of the recurrence. Do not invoke any pre-compiled formulas; derive the structure from first principles.\n- Implement a program that applies the Lanczos algorithm with full reorthogonalization to approximate the smallest and largest eigenvalues of $H$ for several many-body spin models. The program must:\n  - Construct $H$ as a sparse matrix for each model listed in the test suite below, with open boundary conditions.\n  - Use a reproducible random initial vector to generate the Krylov subspace.\n  - Build the symmetric tridiagonal projection and extract the extremal Ritz values as approximations to the extremal eigenvalues of $H$.\n  - For verification, compute the exact smallest and largest eigenvalues of $H$ by dense diagonalization and report the absolute errors between the Lanczos approximations and the exact values. All energies are dimensionless and measured in units where the exchange coupling $J$ equals $1$.\n- Numerical details and constraints:\n  - All constructed Hamiltonians must be real symmetric.\n  - Angles (if any appear in intermediate reasoning) should be expressed in radians, but the models given below do not involve explicit angle parameters.\n  - The absolute error returned for each extremal eigenvalue must be a floating-point number.\n\nModels and operators:\n- Let $\\sigma^x, \\sigma^y, \\sigma^z$ denote the Pauli matrices, and $S^\\mu = \\frac{1}{2} \\sigma^\\mu$ ($\\mu \\in \\{x,y,z\\}$). Open boundary conditions imply that nearest-neighbor sums run from site $i = 1$ to site $i = L-1$.\n- Three models will be used:\n  - Heisenberg model: $H = J \\sum_{i=1}^{L-1} \\left( S_i^x S_{i+1}^x + S_i^y S_{i+1}^y + S_i^z S_{i+1}^z \\right)$.\n  - Transverse-field Ising model: $H = - J \\sum_{i=1}^{L-1} \\sigma_i^z \\sigma_{i+1}^z - g \\sum_{i=1}^{L} \\sigma_i^x$.\n  - Anisotropic XXZ model: $H = J \\sum_{i=1}^{L-1} \\left( S_i^x S_{i+1}^x + S_i^y S_{i+1}^y + \\Delta S_i^z S_{i+1}^z \\right)$.\n- Use $J = 1$ in all cases. The energies must be treated as dimensionless numbers in these units.\n\nTest suite:\n- Case $1$ (happy path, exact tri-diagonalization): Heisenberg model with $L = 4$ and $J = 1$. Use a Lanczos subspace dimension equal to $N = 2^L$.\n- Case $2$ (approximate subspace, non-integrable field): Transverse-field Ising model with $L = 6$, $J = 1$, and $g = 1.1$. Use a Lanczos subspace dimension of $m = 50$.\n- Case $3$ (anisotropy, exact tri-diagonalization): XXZ model with $L = 5$, $J = 1$, and $\\Delta = 0.5$. Use a Lanczos subspace dimension equal to $N = 2^L$.\n- Case $4$ (boundary-size chain): Heisenberg model with $L = 2$ and $J = 1$. Use a Lanczos subspace dimension equal to $N = 2^L$.\n\nAnswer specification:\n- For each case, compute two absolute errors: the absolute difference between the smallest Ritz value and the exact smallest eigenvalue, and the absolute difference between the largest Ritz value and the exact largest eigenvalue. Both must be reported as floating-point numbers.\n- Your program must produce a single line of output containing the results as a comma-separated list of floating-point numbers enclosed in square brackets, ordered as $[\\text{err}_{\\min}^{(1)}, \\text{err}_{\\max}^{(1)}, \\text{err}_{\\min}^{(2)}, \\text{err}_{\\max}^{(2)}, \\text{err}_{\\min}^{(3)}, \\text{err}_{\\max}^{(3)}, \\text{err}_{\\min}^{(4)}, \\text{err}_{\\max}^{(4)}]$. No other text should be printed.\n- No user input is permitted; all parameters are fixed by the test suite above.",
            "solution": "The task is to derive the Lanczos three-term recurrence from first principles and then implement the algorithm to find the extremal eigenvalues of several quantum spin Hamiltonians.\n\n### Part 1: Derivation of the Lanczos Recurrence\n\nWe are given a real symmetric (and therefore Hermitian) operator $H$ acting on a finite-dimensional real vector space $V$ of dimension $N$, equipped with an inner product $\\langle v \\mid w \\rangle = v^T w$. The goal is to find an orthonormal basis for the Krylov subspace $\\mathcal{K}_m(H, \\lvert v_1 \\rangle)$ in which the representation of $H$ is a symmetric tridiagonal matrix.\n\n**Definitions and Assumptions:**\n1.  **Hermitian Operator**: $H$ is a linear operator on $V$ such that $\\langle H v \\mid w \\rangle = \\langle v \\mid H w \\rangle$ for all $\\lvert v \\rangle, \\lvert w \\rangle \\in V$. Since we are told $H$ is real symmetric, this condition is satisfied with the standard real inner product, i.e., $(H v)^T w = v^T H^T w = v^T H w$.\n2.  **Krylov Subspace**: For a given nonzero starting vector $\\lvert v_1 \\rangle$, the $m$-th Krylov subspace is defined as\n    $$\n    \\mathcal{K}_m(H, \\lvert v_1 \\rangle) = \\text{span}\\{ \\lvert v_1 \\rangle, H\\lvert v_1 \\rangle, H^2\\lvert v_1 \\rangle, \\dots, H^{m-1}\\lvert v_1 \\rangle \\}\n    $$\n    We assume $m$ is less than or equal to the grade of $\\lvert v_1 \\rangle$ with respect to $H$, so the vectors $\\{\\lvert v_1 \\rangle, \\dots, H^{m-1}\\lvert v_1 \\rangle\\}$ are linearly independent and $\\dim(\\mathcal{K}_m) = m$.\n3.  **Gram-Schmidt Process**: An algorithm to construct an orthonormal basis from a set of linearly independent vectors.\n\n**Derivation:**\nOur aim is to construct an orthonormal basis $\\{\\lvert q_1 \\rangle, \\lvert q_2 \\rangle, \\dots, \\lvert q_m \\rangle\\}$ for $\\mathcal{K}_m$ via a procedure resembling the Gram-Schmidt process. Let this basis be denoted by the columns of a matrix $Q_m = [\\lvert q_1 \\rangle, \\lvert q_2 \\rangle, \\dots, \\lvert q_m \\rangle]$. The orthonormality condition is $\\langle q_i \\mid q_j \\rangle = \\delta_{ij}$, or $Q_m^T Q_m = I_m$. The representation of $H$ projected onto this subspace is the $m \\times m$ matrix $T_m = Q_m^T H Q_m$. The elements of this matrix are $(T_m)_{ij} = \\langle q_i \\mid H \\mid q_j \\rangle$.\n\nLet's construct the basis $\\{\\lvert q_j \\rangle\\}$ step by step.\n\n**Step 1: Initialization**\nStart by normalizing the given vector $\\lvert v_1 \\rangle$.\n$$\n\\lvert q_1 \\rangle = \\frac{\\lvert v_1 \\rangle}{\\lVert \\lvert v_1 \\rangle \\rVert}\n$$\nBy construction, $\\langle q_1 \\mid q_1 \\rangle = 1$ and $\\text{span}\\{\\lvert q_1 \\rangle\\} = \\text{span}\\{\\lvert v_1 \\rangle\\} = \\mathcal{K}_1$.\n\n**Step 2: The First Recurrence Relation**\nConsider the vector $H \\lvert q_1 \\rangle$. This vector is an element of $\\mathcal{K}_2 = \\text{span}\\{\\lvert v_1 \\rangle, H\\lvert v_1 \\rangle\\} = \\text{span}\\{\\lvert q_1 \\rangle, H\\lvert q_1 \\rangle\\}$. We can decompose $H \\lvert q_1 \\rangle$ into a component parallel to $\\lvert q_1 \\rangle$ and a component orthogonal to it.\nThe parallel component is given by the projection of $H \\lvert q_1 \\rangle$ onto $\\lvert q_1 \\rangle$:\n$$\n\\lvert w_{\\parallel} \\rangle = \\langle q_1 \\mid H \\mid q_1 \\rangle \\lvert q_1 \\rangle\n$$\nLet's define the scalar coefficient $\\alpha_1 = \\langle q_1 \\mid H \\mid q_1 \\rangle$. Note that since $H$ is real symmetric, $\\alpha_1$ is real.\nThe orthogonal component is then:\n$$\n\\lvert r_1 \\rangle = H \\lvert q_1 \\rangle - \\alpha_1 \\lvert q_1 \\rangle\n$$\nThis vector $\\lvert r_1 \\rangle$ is orthogonal to $\\lvert q_1 \\rangle$ by construction: $\\langle q_1 \\mid r_1 \\rangle = \\langle q_1 \\mid H \\mid q_1 \\rangle - \\alpha_1 \\langle q_1 \\mid q_1 \\rangle = \\alpha_1 - \\alpha_1 = 0$.\nTo obtain the next orthonormal basis vector, we normalize $\\lvert r_1 \\rangle$:\n$$\n\\lvert q_2 \\rangle = \\frac{\\lvert r_1 \\rangle}{\\beta_1}, \\quad \\text{where} \\quad \\beta_1 = \\lVert \\lvert r_1 \\rangle \\rVert = \\sqrt{\\langle r_1 \\mid r_1 \\rangle}\n$$\nIf $\\beta_1 = 0$, the algorithm terminates, implying $\\mathcal{K}_2 = \\mathcal{K}_1$. Assuming $\\beta_1 > 0$, we have found a second orthonormal vector $\\lvert q_2 \\rangle$. The set $\\{\\lvert q_1 \\rangle, \\lvert q_2 \\rangle\\}$ is an orthonormal basis for $\\mathcal{K}_2$.\nRearranging the definitions, we get our first recurrence relation:\n$$\nH \\lvert q_1 \\rangle = \\alpha_1 \\lvert q_1 \\rangle + \\beta_1 \\lvert q_2 \\rangle\n$$\n\n**Step 3: The General Three-Term Recurrence**\nLet's generalize this. Assume we have constructed an orthonormal set $\\{\\lvert q_1 \\rangle, \\dots, \\lvert q_j \\rangle\\}$ that forms a basis for $\\mathcal{K}_j$. The vector $\\lvert q_j \\rangle$ is a polynomial of degree $j-1$ in $H$ applied to $\\lvert q_1 \\rangle$. Therefore, $H\\lvert q_j \\rangle$ is a polynomial of degree $j$ in $H$ applied to $\\lvert q_1 \\rangle$, which means $H\\lvert q_j \\rangle \\in \\mathcal{K}_{j+1}$.\nWe can express $H \\lvert q_j \\rangle$ as:\n$$\nH \\lvert q_j \\rangle = \\sum_{k=1}^{j+1} c_k \\lvert q_k \\rangle\n$$\nThe coefficients $c_k$ are found by taking the inner product with $\\lvert q_k \\rangle$: $c_k = \\langle q_k \\mid H \\mid q_j \\rangle$. These are precisely the elements of the matrix $T_m$. Let's analyze these coefficients using the Hermiticity of $H$.\n\nThe vector $H \\lvert q_k \\rangle$ lies in $\\mathcal{K}_{k+1} = \\text{span}\\{\\lvert q_1 \\rangle, \\dots, \\lvert q_{k+1} \\rangle\\}$. Consequently, $H \\lvert q_k \\rangle$ is orthogonal to any $\\lvert q_i \\rangle$ for $i > k+1$.\n$$\n\\langle q_i \\mid H \\mid q_k \\rangle = 0 \\quad \\text{for} \\quad i > k+1\n$$\nUsing the Hermiticity of $H$, $\\langle q_i \\mid H \\mid q_k \\rangle = \\langle H q_i \\mid q_k \\rangle$. This means $\\langle q_k \\mid H \\mid q_i \\rangle = 0$ for $k > i+1$.\nCombining these, the matrix element $(T_m)_{ik} = \\langle q_i \\mid H \\mid q_k \\rangle$ is zero if $|i-k| > 1$. This proves that the matrix $T_m$ is tridiagonal.\n\nSince $T_m$ is tridiagonal, the expansion of $H \\lvert q_j \\rangle$ simplifies greatly. The only non-zero coefficients $c_k = \\langle q_k \\mid H \\mid q_j \\rangle$ are for $k \\in \\{j-1, j, j+1\\}$. So, the expansion is a three-term recurrence:\n$$\nH \\lvert q_j \\rangle = \\langle q_{j-1} \\mid H \\mid q_j \\rangle \\lvert q_{j-1} \\rangle + \\langle q_j \\mid H \\mid q_j \\rangle \\lvert q_j \\rangle + \\langle q_{j+1} \\mid H \\mid q_j \\rangle \\lvert q_{j+1} \\rangle\n$$\nLet's define the coefficients in the standard way:\n1.  Diagonal elements: $\\alpha_j = \\langle q_j \\mid H \\mid q_j \\rangle$. Since $H$ is real symmetric and the basis vectors $\\lvert q_j \\rangle$ are real, $\\alpha_j$ is real.\n2.  Off-diagonal elements: Let $\\beta_j = \\langle q_{j+1} \\mid H \\mid q_j \\rangle$.\n\nNow, we need to show that this structure is consistent. From the $(j-1)$-th step, we have the relation:\n$$\nH \\lvert q_{j-1} \\rangle = \\beta_{j-2} \\lvert q_{j-2} \\rangle + \\alpha_{j-1} \\lvert q_{j-1} \\rangle + \\beta_{j-1} \\lvert q_j \\rangle\n$$\nwhere we have defined $\\beta_{j-1} = \\langle q_j \\mid H \\mid q_{j-1} \\rangle$. By Hermiticity, $\\langle q_{j-1} \\mid H \\mid q_j \\rangle = \\langle H q_{j-1} \\mid q_j \\rangle = \\langle q_j \\mid H \\mid q_{j-1} \\rangle^*$. Since $H$ is real symmetric and vectors are real, $\\langle q_{j-1} \\mid H \\mid q_j \\rangle = \\langle q_j \\mid H \\mid q_{j-1} \\rangle = \\beta_{j-1}$. This confirms that the tridiagonal matrix $T_m$ is symmetric.\n\nThe resulting three-term recurrence relation is:\n$$\nH \\lvert q_j \\rangle = \\beta_{j-1} \\lvert q_{j-1} \\rangle + \\alpha_j \\lvert q_j \\rangle + \\beta_j \\lvert q_{j+1} \\rangle\n$$\nHere we define $\\lvert q_0 \\rangle = 0$ and $\\beta_0 = 0$.\n\nThis recurrence relation provides a constructive algorithm (the Lanczos algorithm).\nGiven $\\lvert q_j \\rangle$ and $\\lvert q_{j-1} \\rangle$:\n1.  Compute $\\lvert w_j \\rangle = H \\lvert q_j \\rangle$.\n2.  Compute the diagonal element $\\alpha_j = \\langle q_j \\mid w_j \\rangle$.\n3.  Construct the residual vector $\\lvert r_j \\rangle = \\lvert w_j \\rangle - \\alpha_j \\lvert q_j \\rangle - \\beta_{j-1} \\lvert q_{j-1} \\rangle$.\n4.  Compute the norm $\\beta_j = \\lVert \\lvert r_j \\rangle \\rVert$.\n5.  If $\\beta_j \\approx 0$, the process terminates. Otherwise, normalize to get the next basis vector: $\\lvert q_{j+1} \\rangle = \\lvert r_j \\rangle / \\beta_j$.\n\nThe sequence of real scalars $(\\alpha_1, \\dots, \\alpha_m)$ and $(\\beta_1, \\dots, \\beta_{m-1})$ and orthonormal vectors $(\\lvert q_1 \\rangle, \\dots, \\lvert q_m \\rangle)$ is uniquely determined (up to phases, which are fixed to $+1$ for real vectors) by the choice of $\\lvert v_1 \\rangle$. This process generates the symmetric tridiagonal matrix $T_m$:\n$$\nT_m = \\begin{pmatrix}\n\\alpha_1  \\beta_1  0  \\dots  0 \\\\\n\\beta_1  \\alpha_2  \\beta_2  \\dots  0 \\\\\n0  \\beta_2  \\alpha_3  \\ddots  \\vdots \\\\\n\\vdots  \\vdots  \\ddots  \\ddots  \\beta_{m-1} \\\\\n0  0  \\dots  \\beta_{m-1}  \\alpha_m\n\\end{pmatrix}\n$$\nThe eigenvalues of $T_m$, called Ritz values, provide approximations to the eigenvalues of $H$. Specifically, the extremal Ritz values are excellent approximations to the extremal eigenvalues of $H$.\n\n### Part 2: Implementation Details\n\nThe implementation will construct the specified spin Hamiltonians as sparse matrices and then apply the Lanczos algorithm with full reorthogonalization. Full reorthogonalization is a numerical stability enhancement where each newly generated vector is explicitly made orthogonal to all previously generated basis vectors to counteract the loss of orthogonality from floating-point arithmetic.\n\n**Hamiltonian Construction:**\nThe Hilbert space for $L$ spin-$\\frac{1}{2}$ particles has a basis of $N=2^L$ states, which can be mapped to integers from $0$ to $N-1$. Operators are constructed using tensor products (`scipy.sparse.kron`). The spin-exchange term $S_i^x S_{i+1}^x + S_i^y S_{i+1}^y$ is implemented as $\\frac{1}{2}(S_i^+ S_{i+1}^- + S_i^- S_{i+1}^+)$, where $S^{\\pm}$ are the sparse, real raising/lowering operators. This ensures the resulting Hamiltonians are real and symmetric.\n\n**Lanczos Algorithm with Full Reorthogonalization:**\nThe core algorithm proceeds iteratively. In step $j$, it generates $\\lvert q_{j+1} \\rangle$ and the matrix elements $\\alpha_j$ and $\\beta_j$. The crucial part is that after computing the new vector, it is explicitly orthogonalized against all previous vectors $\\{\\lvert q_1 \\rangle, \\dots, \\lvert q_j \\rangle\\}$ via a Gram-Schmidt-like correction before being normalized. This increases computational cost but is essential for accuracy, especially for many iterations.\n\n**Verification:**\nThe Lanczos results (Ritz values) are compared against the exact eigenvalues of a dense version of the Hamiltonian, obtained with `numpy.linalg.eighvals`. When the Lanczos dimension $m$ equals the full Hilbert space dimension $N$, the Ritz values must match the exact eigenvalues up to floating-point precision, providing a strong check on the implementation.",
            "answer": "```python\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.linalg import eigh_tridiagonal, eigh\nfrom functools import reduce\n\ndef build_op_on_site(op, i, L):\n    \"\"\"\n    Constructs a sparse operator acting on site i of a chain of length L.\n    The operator is built as I ⊗ ... ⊗ I ⊗ op ⊗ I ⊗ ... ⊗ I.\n    \"\"\"\n    ident = sparse.identity(2, format='csr')\n    op_list = [ident] * L\n    if i  0 or i = L:\n        raise ValueError(\"Site index i is out of bounds.\")\n    op_list[i] = op\n    # Use reduce with a starting value of 1 for the case L=0\n    return reduce(sparse.kron, op_list, sparse.csr_matrix([[1]]))\n\ndef build_heisenberg(L, J=1.0):\n    \"\"\"Builds the Heisenberg model Hamiltonian for a spin-1/2 chain.\"\"\"\n    N = 2**L\n    H = sparse.csr_matrix((N, N), dtype=np.float64)\n    \n    s_p = sparse.csr_matrix([[0, 1], [0, 0]], dtype=np.float64)\n    s_m = sparse.csr_matrix([[0, 0], [1, 0]], dtype=np.float64)\n    s_z = sparse.csr_matrix([[0.5, 0], [0, -0.5]], dtype=np.float64)\n\n    for i in range(L - 1):\n        # S_i^x S_{i+1}^x + S_i^y S_{i+1}^y = 0.5 * (S_i^+ S_{i+1}^- + S_i^- S_{i+1}^+)\n        sp_i = build_op_on_site(s_p, i, L)\n        sm_i1 = build_op_on_site(s_m, i + 1, L)\n        sm_i = build_op_on_site(s_m, i, L)\n        sp_i1 = build_op_on_site(s_p, i + 1, L)\n        H += 0.5 * J * (sp_i @ sm_i1 + sm_i @ sp_i1)\n\n        # S_i^z S_{i+1}^z\n        sz_i = build_op_on_site(s_z, i, L)\n        sz_i1 = build_op_on_site(s_z, i + 1, L)\n        H += J * (sz_i @ sz_i1)\n    return H\n\ndef build_tfi(L, J=1.0, g=1.0):\n    \"\"\"Builds the Transverse-Field Ising model Hamiltonian.\"\"\"\n    N = 2**L\n    H = sparse.csr_matrix((N, N), dtype=np.float64)\n\n    sigma_z = sparse.csr_matrix([[1, 0], [0, -1]], dtype=np.float64)\n    sigma_x = sparse.csr_matrix([[0, 1], [1, 0]], dtype=np.float64)\n\n    # Interaction term: -J * sum(sigma_z_i * sigma_z_{i+1})\n    for i in range(L - 1):\n        sz_i = build_op_on_site(sigma_z, i, L)\n        sz_i1 = build_op_on_site(sigma_z, i + 1, L)\n        H += -J * (sz_i @ sz_i1)\n    \n    # Field term: -g * sum(sigma_x_i)\n    for i in range(L):\n        sx_i = build_op_on_site(sigma_x, i, L)\n        H += -g * sx_i\n    return H\n\ndef build_xxz(L, J=1.0, Delta=1.0):\n    \"\"\"Builds the anisotropic XXZ model Hamiltonian.\"\"\"\n    N = 2**L\n    H = sparse.csr_matrix((N, N), dtype=np.float64)\n\n    s_p = sparse.csr_matrix([[0, 1], [0, 0]], dtype=np.float64)\n    s_m = sparse.csr_matrix([[0, 0], [1, 0]], dtype=np.float64)\n    s_z = sparse.csr_matrix([[0.5, 0], [0, -0.5]], dtype=np.float64)\n    \n    for i in range(L - 1):\n        # S_i^x S_{i+1}^x + S_i^y S_{i+1}^y = 0.5 * (S_i^+ S_{i+1}^- + S_i^- S_{i+1}^+)\n        sp_i = build_op_on_site(s_p, i, L)\n        sm_i1 = build_op_on_site(s_m, i + 1, L)\n        sm_i = build_op_on_site(s_m, i, L)\n        sp_i1 = build_op_on_site(s_p, i + 1, L)\n        H += 0.5 * J * (sp_i @ sm_i1 + sm_i @ sp_i1)\n\n        # Delta * S_i^z S_{i+1}^z\n        sz_i = build_op_on_site(s_z, i, L)\n        sz_i1 = build_op_on_site(s_z, i + 1, L)\n        H += J * Delta * (sz_i @ sz_i1)\n    return H\n\ndef lanczos_reorth(H, v_start, m):\n    \"\"\"\n    Performs the Lanczos algorithm with full reorthogonalization.\n    \"\"\"\n    N = H.shape[0]\n    \n    # Ensure m is not larger than matrix dimension\n    m = min(m, N)\n    \n    Q = np.zeros((N, m))\n    alphas = np.zeros(m)\n    betas = np.zeros(m - 1)\n    \n    # Initialize first vector\n    q = v_start / np.linalg.norm(v_start)\n    Q[:, 0] = q\n    \n    w_prime = H @ q\n    alphas[0] = q.T @ w_prime\n    w = w_prime - alphas[0] * q\n    \n    for j in range(1, m):\n        beta = np.linalg.norm(w)\n        \n        if beta  1e-12:\n            m_eff = j\n            alphas_trunc = alphas[:m_eff]\n            betas_trunc = betas[:m_eff-1]\n            eigvals, _ = eigh_tridiagonal(alphas_trunc, betas_trunc, select='a')\n            return min(eigvals), max(eigvals)\n            \n        betas[j-1] = beta\n        \n        q_prev = q\n        q = w / beta\n        \n        # Full reorthogonalization against all previous vectors\n        for i_reorth in range(j):\n            q = q - (Q[:, i_reorth].T @ q) * Q[:, i_reorth]\n        # Renormalize after correction\n        q = q / np.linalg.norm(q)\n        \n        Q[:, j] = q\n        \n        w_prime = H @ q\n        alphas[j] = q.T @ w_prime\n        w = w_prime - alphas[j] * q - betas[j-1] * q_prev\n\n    eigvals, _ = eigh_tridiagonal(alphas, betas, select='a')\n    return min(eigvals), max(eigvals)\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases.\n    \"\"\"\n    test_cases = [\n        {'model': 'heisenberg', 'L': 4, 'params': {'J': 1.0}, 'm': 16},\n        {'model': 'tfi', 'L': 6, 'params': {'J': 1.0, 'g': 1.1}, 'm': 50},\n        {'model': 'xxz', 'L': 5, 'params': {'J': 1.0, 'Delta': 0.5}, 'm': 32},\n        {'model': 'heisenberg', 'L': 2, 'params': {'J': 1.0}, 'm': 4},\n    ]\n\n    results = []\n    # Use a fixed seed for the random initial vector for reproducibility\n    rng = np.random.default_rng(seed=12345)\n\n    for case in test_cases:\n        L = case['L']\n        m = case['m']\n        N = 2**L\n        \n        if case['model'] == 'heisenberg':\n            H_sparse = build_heisenberg(L, **case['params'])\n        elif case['model'] == 'tfi':\n            H_sparse = build_tfi(L, **case['params'])\n        elif case['model'] == 'xxz':\n            H_sparse = build_xxz(L, **case['params'])\n        \n        # Generate reproducible random initial vector\n        v_start = rng.random(size=N, dtype=np.float64)\n\n        # Lanczos calculation\n        min_ritz, max_ritz = lanczos_reorth(H_sparse, v_start, m)\n\n        # Exact diagonalization for verification\n        H_dense = H_sparse.toarray()\n        exact_eigvals = eigh(H_dense, eigvals_only=True)\n        exact_min, exact_max = exact_eigvals[0], exact_eigvals[-1]\n\n        # Calculate absolute errors\n        err_min = abs(min_ritz - exact_min)\n        err_max = abs(max_ritz - exact_max)\n        \n        results.extend([err_min, err_max])\n\n    # Format output as a list of floating-point numbers\n    output_str = f\"[{','.join(f'{r:.15e}' for r in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}