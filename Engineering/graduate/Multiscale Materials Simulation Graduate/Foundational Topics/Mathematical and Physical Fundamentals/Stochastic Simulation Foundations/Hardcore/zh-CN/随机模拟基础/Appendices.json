{
    "hands_on_practices": [
        {
            "introduction": "在多尺度材料模拟中，许多关键过程，如原子扩散、吸附或化学反应，最好被理解为一系列离散的随机事件。本练习将带您回到第一性原理，推导随机模拟算法（Gillespie算法）的核心。通过从泊松过程的基本属性出发，您将亲自构建用于模拟这些随机跳跃事件发生的时间以及确定哪个事件发生的数学框架 ()。",
            "id": "3841418",
            "problem": "考虑一个多尺度材料体系的介观模型，其中晶格上的稀有事件（如吸附、解吸、扩散跳跃或键重排）被表示为由 $i \\in \\{1, \\dots, M\\}$ 索引的反应通道。假设在系统的某一给定状态下，每个通道 $i$ 是一个独立的泊松过程，其速率（也称为倾向）为常数 $r_i  0$。该演化过程被建模为连续时间马尔可夫跳跃过程。你的任务是在随机模拟的基础上，推导用于确定下一事件时间增量和下一个发生通道的抽样方案。\n\n仅从以下基本依据出发：\n- 对于速率为 $r0$ 的齐次泊松过程，到下一个事件的等待时间服从指数分布，其概率密度函数为 $f(t) = r \\exp(-r t)$（$t \\geq 0$），且该过程是无记忆的，即对所有 $s, t \\geq 0$ 都有 $P(T  s + t \\,|\\, T  s) = P(T  t)$。\n- 独立的泊松过程叠加后形成一个新的泊松过程，其速率等于各过程速率之和。\n- 逆变换采样法：若 $U$ 在 $(0,1)$ 上均匀分布，且 $F$ 是一个连续的累积分布函数，则 $F^{-1}(U)$ 是一个来自累积分布函数为 $F$ 的分布的样本。\n\n仅使用这些依据和基本概率法则，推导：\n1. 到下一个事件的等待时间增量 $\\Delta t$ 的闭式表达式，用从 $(0,1)$ 均匀分布中抽取的单个样本 $u$ 和速率集合 $\\{r_i\\}_{i=1}^{M}$ 表示。\n2. 下一个事件是通道 $k \\in \\{1, \\dots, M\\}$ 的概率的闭式表达式，用速率集合 $\\{r_i\\}_{i=1}^{M}$ 表示。\n\n你的推导必须援引指数等待时间的无记忆性和通道的独立性。以闭式形式表达你的最终结果。不需要进行数值计算，并且在问题陈述中不允许使用任何中间捷径公式。提供的最终表达式不带单位。",
            "solution": "该问题陈述经评估是科学上合理、适定、客观且自洽的，因此满足一个有效问题的所有标准。该问题要求从第一性原理出发，推导 Gillespie 随机模拟算法 (SSA) 的核心组成部分，这是材料科学及相关领域中研究随机过程的一项基本任务。\n\n设 $M$ 个反应通道的集合由 $i \\in \\{1, \\dots, M\\}$ 索引。每个通道 $i$ 被建模为一个独立的齐次泊松过程，其速率（倾向）为常数 $r_i  0$。令 $T_i$ 为表示通道 $i$ 中下一个事件发生前的等待时间的随机变量。\n\n根据提供的第一个依据，该过程是无记忆的，单个通道 $i$ 的等待时间服从指数分布。$T_i$ 的概率密度函数 (PDF) 为 $p_i(t) = r_i \\exp(-r_i t)$（$t \\ge 0$）。无记忆性至关重要，因为它证明了从系统的任意状态开始，可以用此分布来建模到下一个事件发生的时间，而无需考虑其历史。$T_i$ 的累积分布函数 (CDF) 为 $F_i(t) = P(T_i \\le t) = \\int_{0}^{t} r_i \\exp(-r_i \\tau) d\\tau = 1 - \\exp(-r_i t)$。因此，生存函数为 $S_i(t) = P(T_i  t) = 1 - F_i(t) = \\exp(-r_i t)$。\n\n**1. 等待时间增量 $\\Delta t$ 的推导**\n\n整个系统中的下一个事件是在所有可能通道中首先发生的那个先验未知事件。因此，到下一个系统事件的等待时间，记为 $\\Delta t$，是所有通道各自等待时间的最小值：\n$$\n\\Delta t = \\min(T_1, T_2, \\dots, T_M)\n$$\n为了求出 $\\Delta t$ 的分布，我们首先推导其生存函数 $S_{\\Delta t}(t) = P(\\Delta t  t)$。条件 $\\Delta t  t$ 成立当且仅当所有单个等待时间 $T_i$ 都大于 $t$。\n$$\nP(\\Delta t  t) = P(\\min(T_1, \\dots, T_M)  t) = P(T_1  t, T_2  t, \\dots, T_M  t)\n$$\n由于问题陈述通道是独立的过程，联合概率是各个概率的乘积：\n$$\nP(\\Delta t  t) = \\prod_{i=1}^{M} P(T_i  t)\n$$\n代入每个指数分布的生存函数 $P(T_i  t) = \\exp(-r_i t)$：\n$$\nP(\\Delta t  t) = \\prod_{i=1}^{M} \\exp(-r_i t) = \\exp\\left(-\\sum_{i=1}^{M} r_i t\\right)\n$$\n令总速率为 $R = \\sum_{i=1}^{M} r_i$。$\\Delta t$ 的生存函数为 $S_{\\Delta t}(t) = \\exp(-R t)$。这个结果证明了提供的第二个依据：独立泊松过程的叠加产生一个新的泊松过程，其速率等于各个速率之和。因此，随机变量 $\\Delta t$ 服从速率为 $R$ 的指数分布。\n\n$\\Delta t$ 的累积分布函数为 $F_{\\Delta t}(t) = 1 - S_{\\Delta t}(t) = 1 - \\exp(-R t)$。\n\n为生成 $\\Delta t$ 的一个样本，我们使用第三个依据中指定的逆变换采样法。设 $u$ 是从 $(0,1)$ 上的均匀分布中抽取的一个随机数，记为 $U \\sim (0,1)$。我们令 $F_{\\Delta t}(\\Delta t) = u$：\n$$\nu = 1 - \\exp(-R \\Delta t)\n$$\n现在我们求解 $\\Delta t$：\n$$\n\\exp(-R \\Delta t) = 1 - u\n$$\n$$\n-R \\Delta t = \\ln(1 - u)\n$$\n$$\n\\Delta t = -\\frac{1}{R} \\ln(1 - u)\n$$\n由于 $u$ 是在 $(0,1)$ 上均匀分布的随机变量，变量 $u' = 1-u$ 也在 $(0,1)$ 上均匀分布。因此，我们可以通过将 $1-u$ 替换为一个新的均匀分布随机变量来简化表达式，不失一般性地，我们仍可称之为 $u$。\n$$\n\\Delta t = -\\frac{1}{R} \\ln(u) = -\\frac{\\ln(u)}{\\sum_{i=1}^{M} r_i}\n$$\n这就是等待时间增量的闭式表达式。\n\n**2. 通道 $k$ 下一个发生的概率的推导**\n\n我们希望求出特定通道 $k \\in \\{1, \\dots, M\\}$ 是下一个发生的通道的概率 $P_k$。这是其等待时间 $T_k$ 在所有等待时间中是最小值的概率：\n$$\nP_k = P(T_k = \\min(T_1, \\dots, T_M)) = P(T_k \\le T_i \\text{ for all } i \\in \\{1, \\dots, M\\})\n$$\n为了计算这个概率，我们可以对 $T_k$ 的值进行条件化，并对其所有可能的等待时间 $t$ 进行积分。总概率是在 $t_k \\le t_i$ (对所有 $i$) 的区域上对联合概率密度函数的积分。一个更直接的方法是使用全概率公式：\n$$\nP_k = \\int_{0}^{\\infty} P(T_k \\le T_i \\text{ for all } i \\ne k \\mid T_k = t) \\cdot p_k(t) dt\n$$\n如果 $T_k = t$，条件变为对所有 $i \\ne k$ 都有 $t \\le T_i$。由于通道的独立性，条件概率就是事件本身的概率：\n$$\nP(T_i \\ge t \\text{ for all } i \\ne k \\mid T_k = t) = P(T_i \\ge t \\text{ for all } i \\ne k) = \\prod_{i \\ne k} P(T_i \\ge t)\n$$\n使用生存函数 $P(T_i \\ge t) = \\exp(-r_i t)$，这个乘积变为：\n$$\n\\prod_{i \\ne k} \\exp(-r_i t) = \\exp\\left(-t \\sum_{i \\ne k} r_i\\right)\n$$\n现在，我们将此结果以及 $T_k$ 的概率密度函数 $p_k(t) = r_k \\exp(-r_k t)$ 代回到积分中：\n$$\nP_k = \\int_{0}^{\\infty} \\left[ \\exp\\left(-t \\sum_{i \\ne k} r_i\\right) \\right] \\cdot [r_k \\exp(-r_k t)] dt\n$$\n合并指数项：\n$$\nP_k = \\int_{0}^{\\infty} r_k \\exp\\left(-t \\left(\\sum_{i \\ne k} r_i + r_k\\right)\\right) dt\n$$\n指数中的和是总速率 $R = \\sum_{i=1}^{M} r_i$。\n$$\nP_k = r_k \\int_{0}^{\\infty} \\exp(-R t) dt\n$$\n计算该定积分：\n$$\nP_k = r_k \\left[ -\\frac{1}{R} \\exp(-R t) \\right]_{t=0}^{t=\\infty} = r_k \\left( -\\frac{1}{R} \\lim_{t \\to \\infty}\\exp(-R t) - \\left(-\\frac{1}{R} \\exp(0)\\right) \\right)\n$$\n由于 $R = \\sum r_i  0$，极限为 $0$。\n$$\nP_k = r_k \\left( 0 - \\left(-\\frac{1}{R}\\right) \\right) = \\frac{r_k}{R}\n$$\n因此，通道 $k$ 是下一个发生的概率是其速率除以所有速率的总和：\n$$\nP_k = \\frac{r_k}{\\sum_{i=1}^{M} r_i}\n$$\n这是第二个所要求的闭式表达式。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\ln(u)}{\\sum_{i=1}^{M} r_i} \\\\ \\frac{r_k}{\\sum_{i=1}^{M} r_i} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "当系统演化是连续的时，例如一个原子在其势阱中的振动，我们使用随机微分方程（SDEs）来描述其动态。然而，计算机模拟必须将时间离散化，这引入了与所选时间步长 $\\Delta t$ 相关的系统性误差或“偏差”。本练习  探讨了如何量化这种由欧拉-丸山法（Euler-Maruyama method）产生的偏差，并介绍了一种通过外推法来消除主要误差项的强大技术，这对于确保模拟结果的准确性至关重要。",
            "id": "3841416",
            "problem": "考虑一维谐振子势阱（奥恩斯坦-乌伦贝克 (OU) 过程）的过阻尼朗之万随机微分方程 (SDE)\n$$\n\\mathrm{d}X_{t} \\,=\\, -\\lambda X_{t}\\,\\mathrm{d}t \\,+\\, \\sqrt{2D}\\,\\mathrm{d}W_{t},\n$$\n其中摩擦参数为 $\\lambda0$，扩散系数为 $D0$，$W_{t}$ 为标准维纳过程。其唯一不变分布是均值为零、方差为 $D/\\lambda$ 的高斯分布。您使用时间步长 $\\Delta t0$ 的欧拉-丸山 (EM) 方法对此 SDE 进行离散化，\n$$\nX_{n+1} \\,=\\, X_{n} \\,-\\, \\lambda X_{n}\\,\\Delta t \\,+\\, \\sqrt{2D\\,\\Delta t}\\,\\xi_{n},\n$$\n其中 $\\xi_{n}$ 是独立同分布的标准正态随机变量。假设马尔可夫链从其不变分布开始，运行总物理时间 $T0$，产生 $N = T/\\Delta t$ 个样本。考虑二次可观测量 $\\varphi(x)=x^{2}$ 的时间平均估计量，\n$$\n\\widehat{A}_{T}(\\Delta t) \\,=\\, \\frac{1}{N}\\sum_{n=1}^{N} X_{n}^{2}.\n$$\n\n仅使用随机过程、马尔可夫链和高斯微积分的基本定义（不使用任何预先引用的弱误差公式），完成以下任务：\n\na) 推导在无穷时间极限下时间平均的离散化偏差，定义为\n$$\nb(\\Delta t) \\,:=\\, \\lim_{T\\to\\infty} \\mathbb{E}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] \\,-\\, \\mathbb{E}_{\\pi}\\!\\left[X^{2}\\right],\n$$\n其中 $\\pi$ 表示连续时间 SDE 的不变分布。将 $b(\\Delta t)$ 表示为 $\\Delta t$、$\\lambda$ 和 $D$ 的闭式解函数。\n\nb) 推导在固定 $\\Delta t0$ 时，时间平均的领头阶大-$T$ 方差，\n$$\n\\mathrm{Var}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right],\n$$\n将其表示为 $\\Delta t$、$\\lambda$、$D$ 和 $T$ 的显式函数，方法是将其与可观测量 $X_{n}^{2}$ 的平稳 EM 马尔可夫链的积分自相关联系起来。\n\nc) 提出一种一阶外推策略，该策略使用总物理时间同为 $T$、时间步长分别为 $\\Delta t$ 和 $\\Delta t/2$ 的两次独立模拟来消除 $\\Delta t\\to 0$ 时的领头 $\\mathcal{O}(\\Delta t)$ 偏差。将得到的外推估计量明确写成两个时间平均 $\\widehat{A}_{T}(\\Delta t)$ 和 $\\widehat{A}_{T}(\\Delta t/2)$ 的线性组合。\n\n您的最终答案必须包含 a)、b) 和 c) 部分的三个闭式表达式。无需单位。无需四舍五入。",
            "solution": "所提供的问题陈述是自洽的，在随机微分方程和数值分析理论中具有科学依据，并以客观的数学语言提出。因此，它被认为是一个有效的问题。我们按要求分三部分进行解答。\n\n对于 (a) 部分，我们被要求求出无穷时间极限下时间平均估计量的离散化偏差。问题陈述指明马尔可夫链从其不变分布开始，这意味着状态序列 $\\{X_n\\}$ 是平稳的。因此，时间平均估计量的期望为\n$$\n\\mathbb{E}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] = \\mathbb{E}\\!\\left[\\frac{1}{N}\\sum_{n=1}^{N} X_{n}^{2}\\right] = \\frac{1}{N}\\sum_{n=1}^{N} \\mathbb{E}[X_{n}^{2}].\n$$\n由于平稳性，$\\mathbb{E}[X_{n}^{2}]$ 与 $n$ 无关，等于离散欧拉-丸山 (EM) 过程不变分布的二阶矩，我们将其记为 $V_{\\Delta t} = \\mathbb{E}_{\\pi_{\\Delta t}}[X^2]$。这里，$\\pi_{\\Delta t}$ 是 EM 马尔可夫链的不变测度。因此，\n$$\n\\lim_{T\\to\\infty} \\mathbb{E}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] = V_{\\Delta t}.\n$$\n偏差定义为 $b(\\Delta t) = V_{\\Delta t} - \\mathbb{E}_{\\pi}[X^2]$。连续奥恩斯坦-乌伦贝克 (OU) 过程的精确不变分布 $\\pi$ 是均值为零、方差为 $\\mathbb{E}_{\\pi}[X^2] = D/\\lambda$ 的高斯分布。我们现在必须求出 $V_{\\Delta t}$。\nEM 更新规则由下式给出\n$$\nX_{n+1} = (1 - \\lambda \\Delta t) X_n + \\sqrt{2D\\Delta t}\\,\\xi_n,\n$$\n其中 $\\xi_n \\sim N(0, 1)$ 是独立同分布的标准正态随机变量。在平稳状态下，方差是恒定的，所以 $\\mathbb{E}[X_{n+1}^2] = \\mathbb{E}[X_n^2] = V_{\\Delta t}$。将更新规则平方并取期望，得到\n$$\n\\mathbb{E}[X_{n+1}^2] = \\mathbb{E}\\!\\left[ \\left( (1 - \\lambda \\Delta t) X_n + \\sqrt{2D\\Delta t}\\,\\xi_n \\right)^2 \\right].\n$$\n展开平方项，我们得到\n$$\nV_{\\Delta t} = \\mathbb{E}\\!\\left[ (1 - \\lambda \\Delta t)^2 X_n^2 + 2(1 - \\lambda \\Delta t)\\sqrt{2D\\Delta t} X_n \\xi_n + 2D\\Delta t\\,\\xi_n^2 \\right].\n$$\n根据期望的线性性，并注意到 $X_n$ 与未来的噪声 $\\xi_n$ 独立，交叉项消失：$\\mathbb{E}[X_n \\xi_n] = \\mathbb{E}[X_n]\\mathbb{E}[\\xi_n] = 0$，因为平稳分布的均值必须为零。使用 $\\mathbb{E}[X_n^2] = V_{\\Delta t}$ 和 $\\mathbb{E}[\\xi_n^2] = 1$，我们得到\n$$\nV_{\\Delta t} = (1 - \\lambda \\Delta t)^2 V_{\\Delta t} + 2D\\Delta t.\n$$\n我们求解 $V_{\\Delta t}$（假设 $2 - \\lambda\\Delta t \\neq 0$，这是稳定性条件）：\n$$\nV_{\\Delta t} \\left( 1 - (1 - \\lambda \\Delta t)^2 \\right) = 2D\\Delta t\n$$\n$$\nV_{\\Delta t} \\left( 1 - (1 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2) \\right) = 2D\\Delta t\n$$\n$$\nV_{\\Delta t} \\left( 2\\lambda\\Delta t - \\lambda^2\\Delta t^2 \\right) = 2D\\Delta t.\n$$\n两边同除以 $\\Delta t$（对于 $\\Delta t  0$），\n$$\nV_{\\Delta t} (2\\lambda - \\lambda^2\\Delta t) = 2D \\implies V_{\\Delta t} = \\frac{2D}{2\\lambda - \\lambda^2\\Delta t} = \\frac{D}{\\lambda(1 - \\frac{\\lambda \\Delta t}{2})}.\n$$\n那么偏差 $b(\\Delta t)$ 是\n$$\nb(\\Delta t) = V_{\\Delta t} - \\frac{D}{\\lambda} = \\frac{D}{\\lambda(1 - \\frac{\\lambda \\Delta t}{2})} - \\frac{D}{\\lambda} = \\frac{D}{\\lambda}\\left(\\frac{1 - (1 - \\frac{\\lambda \\Delta t}{2})}{1 - \\frac{\\lambda \\Delta t}{2}}\\right) = \\frac{D}{\\lambda}\\left(\\frac{\\frac{\\lambda \\Delta t}{2}}{1 - \\frac{\\lambda \\Delta t}{2}}\\right) = \\frac{D\\Delta t}{2 - \\lambda\\Delta t}.\n$$\n\n对于 (b) 部分，我们推导 $\\widehat{A}_{T}(\\Delta t)$ 的大 $T$ 方差。对于一个平稳过程，时间平均 $\\frac{1}{N}\\sum_{n=1}^N \\varphi_n$ 的方差由 $\\frac{1}{N^2}\\sum_{n,m}\\mathrm{Cov}(\\varphi_n, \\varphi_m)$ 给出。对于大的 $N=T/\\Delta t$，这近似为\n$$\n\\mathrm{Var}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] \\approx \\frac{1}{N} \\sum_{k=-\\infty}^{\\infty} c_k = \\frac{\\Delta t}{T} \\sum_{k=-\\infty}^{\\infty} c_k,\n$$\n其中 $c_k = \\mathrm{Cov}(X_0^2, X_k^2)$ 是平稳离散过程中可观测量 $X^2$ 的自协方差函数。由于过程 $\\{X_n\\}$ 是一个零均值平稳高斯过程，我们可以使用伊塞利斯定理来计算 $c_k$：\n$$\nc_k = \\mathbb{E}[X_0^2 X_k^2] - (\\mathbb{E}[X_0^2])^2 = \\left( \\mathbb{E}[X_0^2]\\mathbb{E}[X_k^2] + 2(\\mathbb{E}[X_0 X_k])^2 \\right) - (\\mathbb{E}[X_0^2])^2 = 2(\\mathbb{E}[X_0 X_k])^2.\n$$\n我们需要时间相关函数 $C(k) = \\mathbb{E}[X_0 X_k]$。令 $\\alpha = 1 - \\lambda \\Delta t$。通过将 EM 格式迭代 k 次，我们有 $X_k = \\alpha^k X_0 + \\sum_{j=0}^{k-1} \\alpha^j \\sqrt{2D\\Delta t} \\xi_{k-1-j}$。由于 $X_0$ 与 $m \\geq 0$ 的噪声 $\\xi_m$ 不相关，我们有\n$$\nC(k) = \\mathbb{E}[X_0 X_k] = \\mathbb{E}[X_0(\\alpha^k X_0)] = \\alpha^k \\mathbb{E}[X_0^2] = \\alpha^k V_{\\Delta t}.\n$$\n因此，对于 $k \\ge 0$，$c_k = 2(C(k))^2 = 2 V_{\\Delta t}^2 \\alpha^{2k}$。根据对称性，对任意整数 $k$，$c_k = 2 V_{\\Delta t}^2 \\alpha^{2|k|}$。该和为\n$$\n\\sum_{k=-\\infty}^{\\infty} c_k = \\sum_{k=-\\infty}^{\\infty} 2V_{\\Delta t}^2 \\alpha^{2|k|} = 2V_{\\Delta t}^2 \\left( 1 + 2\\sum_{k=1}^{\\infty} (\\alpha^2)^k \\right).\n$$\n几何级数和为 $\\sum_{k=1}^{\\infty} r^k = r/(1-r)$，其中 $|r|1$。这里 $r=\\alpha^2  1$。\n$$\n\\sum_{k=-\\infty}^{\\infty} c_k = 2V_{\\Delta t}^2 \\left( 1 + \\frac{2\\alpha^2}{1-\\alpha^2} \\right) = 2V_{\\Delta t}^2 \\frac{1+\\alpha^2}{1-\\alpha^2}.\n$$\n代入 $\\alpha = 1 - \\lambda \\Delta t$：\n$1 - \\alpha^2 = 1 - (1-\\lambda\\Delta t)^2 = 2\\lambda\\Delta t - \\lambda^2\\Delta t^2 = \\lambda\\Delta t(2 - \\lambda\\Delta t)$.\n$1 + \\alpha^2 = 1 + (1-\\lambda\\Delta t)^2 = 2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2$.\n于是方差为\n$$\n\\mathrm{Var}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] \\approx \\frac{\\Delta t}{T} \\left( 2V_{\\Delta t}^2 \\frac{2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2}{\\lambda\\Delta t(2 - \\lambda\\Delta t)} \\right) = \\frac{2V_{\\Delta t}^2}{T} \\frac{2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2}{\\lambda(2 - \\lambda\\Delta t)}.\n$$\n代入 $V_{\\Delta t} = \\frac{2D}{\\lambda(2 - \\lambda\\Delta t)}$，我们得到\n$$\n\\mathrm{Var}\\!\\left[\\widehat{A}_{T}(\\Delta t)\\right] \\approx \\frac{2}{T} \\left(\\frac{4D^2}{\\lambda^2(2 - \\lambda\\Delta t)^2}\\right) \\frac{2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2}{\\lambda(2 - \\lambda\\Delta t)} = \\frac{8D^2}{\\lambda^3 T} \\frac{2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2}{(2 - \\lambda\\Delta t)^3}.\n$$\n\n对于 (c) 部分，我们提出一种一阶外推，这是理查森外推的一种形式。估计量的期望值 $A(\\Delta t) = \\mathbb{E}[\\widehat{A}_{T}(\\Delta t)]$ 的偏差可以展开为 $\\Delta t$ 的幂级数。从 (a) 部分可知：\n$$\nA(\\Delta t) = V_{\\Delta t} = \\frac{D/\\lambda}{1 - \\lambda\\Delta t/2} = \\frac{D}{\\lambda} \\left(1 + \\frac{\\lambda\\Delta t}{2} + \\left(\\frac{\\lambda\\Delta t}{2}\\right)^2 + \\dots \\right) = A_\\infty + C_1 \\Delta t + C_2 \\Delta t^2 + \\dots,\n$$\n其中 $A_\\infty = D/\\lambda$ 且 $C_1 = D/2$。误差是关于 $\\Delta t$ 的一阶。我们希望找到一个线性组合 $\\widehat{A}_{\\text{ext}} = c_1 \\widehat{A}_{T}(\\Delta t) + c_2 \\widehat{A}_{T}(\\Delta t/2)$，使其期望具有更小的偏差。其期望值为\n$$\n\\mathbb{E}[\\widehat{A}_{\\text{ext}}] = c_1 A(\\Delta t) + c_2 A(\\Delta t/2) \\approx c_1(A_\\infty + C_1\\Delta t) + c_2(A_\\infty + C_1 \\frac{\\Delta t}{2}).\n$$\n为了获得 $A_\\infty$ 的估计量并消去领头误差项，我们建立以下方程组：\n1. $c_1 + c_2 = 1$ (为了恢复 $A_\\infty$)\n2. $c_1 \\Delta t + c_2 \\frac{\\Delta t}{2} = 0 \\implies c_1 + \\frac{c_2}{2} = 0$ (为了消去 $\\mathcal{O}(\\Delta t)$ 项)\n解此方程组可得 $c_2 = 2$ 和 $c_1 = -1$。得到的外推估计量为\n$$\n\\widehat{A}_{\\text{ext}} = 2\\widehat{A}_{T}(\\Delta t/2) - \\widehat{A}_{T}(\\Delta t).\n$$\n这个新估计量的偏差为 $\\mathcal{O}(\\Delta t^2)$ 阶，从而有效地消除了领头阶误差。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{D \\Delta t}{2 - \\lambda\\Delta t} \\\\ \\frac{8 D^2}{\\lambda^3 T} \\frac{2 - 2\\lambda\\Delta t + \\lambda^2\\Delta t^2}{(2 - \\lambda\\Delta t)^3} \\\\ 2\\widehat{A}_{T}(\\Delta t/2) - \\widehat{A}_{T}(\\Delta t) \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "从分子动力学或其他随机模拟中获得长轨迹只是第一步，正确分析这些数据同样重要。由于系统的“记忆”，沿轨迹连续记录的样本点并非相互独立，而是存在时间相关性。本练习  介绍了一个核心概念——有效样本量（effective sample size），它量化了在存在自相关的情况下，您的数据中真正包含了多少独立信息。掌握这个概念对于计算可靠的统计平均值和置信区间至关重要，能防止您低估计算属性的统计不确定性。",
            "id": "3841383",
            "problem": "一个分子尺度的可观测量 $A$（例如，剪切应力）从一个纳米晶体金属的长时分子动力学（MD）轨迹中以等时间间隔 $t_{k}=k\\,\\Delta t$（其中 $\\Delta t=1\\,\\mathrm{fs}$）记录，得到 $n=2\\times 10^{5}$ 个样本。假设过程 $\\{A_{k}\\}$ 是严格平稳的，具有有限方差 $\\sigma^{2}=\\gamma(0)$ 和归一化自相关函数 $\\rho(k)=\\gamma(k)/\\gamma(0)$，其中 $\\gamma(k)$ 是自协方差函数。自相关被建模为一个具有物理动机的双时间尺度混合模型，\n$$\n\\rho(k)=a\\,\\exp\\!\\left(-\\frac{k\\,\\Delta t}{\\tau_{1}}\\right)+\\left(1-a\\right)\\,\\exp\\!\\left(-\\frac{k\\,\\Delta t}{\\tau_{2}}\\right),\n$$\n参数为 $a=0.4$，$\\tau_{1}=3\\,\\mathrm{fs}$ 和 $\\tau_{2}=20\\,\\mathrm{fs}$。\n\n从第一性原理出发，即样本均值方差以自协方差表示的定义，\n$$\n\\operatorname{Var}\\!\\left(\\bar{A}\\right)=\\operatorname{Var}\\!\\left(\\frac{1}{n}\\sum_{k=1}^{n}A_{k}\\right)=\\frac{1}{n^{2}}\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\gamma(|i-j|),\n$$\n推导一个大 $n$ 条件下以 $\\rho(k)$ 表示的积分自相关时间 $\\tau_{\\mathrm{int}}$（无量纲，单位为采样步长）的表达式，并由此推导有效样本量 $n_{\\mathrm{eff}}$ 的公式，其定义为将 $\\operatorname{Var}(\\bar{A})$ 等同于 $n_{\\mathrm{eff}}$ 个独立样本的方差。然后，使用给定的 $\\rho(k)$，根据指定的 $n$ 和参数计算 $n_{\\mathrm{eff}}$ 的数值。\n\n最后，简要解释计算出的 $n_{\\mathrm{eff}}$ 相对于 $n$ 个独立样本的情况，如何改变 $A$ 均值的正态近似置信区间的半宽，并明确其与 $n_{\\mathrm{eff}}$ 的标度关系。\n\n将 $n_{\\mathrm{eff}}$ 的最终数值结果四舍五入至四位有效数字。$n_{\\mathrm{eff}}$ 不需要单位。",
            "solution": "该问题经评估是有效的，因为它在科学上基于分子模拟时间序列的统计分析，问题陈述清晰且提供了所有必要信息，并以客观、正式的语言表达。因此，我们可以着手解答。\n\n出发点是平稳时间序列 $\\{A_k\\}$ 样本均值 $\\bar{A}$ 的方差定义：\n$$\n\\operatorname{Var}(\\bar{A}) = \\operatorname{Var}\\left(\\frac{1}{n}\\sum_{k=1}^{n}A_{k}\\right) = \\frac{1}{n^2}\\operatorname{Cov}\\left(\\sum_{i=1}^{n}A_{i}, \\sum_{j=1}^{n}A_{j}\\right) = \\frac{1}{n^2}\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\operatorname{Cov}(A_i, A_j).\n$$\n对于平稳过程，自协方差函数 $\\gamma(k) = \\operatorname{Cov}(A_i, A_{i+k})$ 仅依赖于时间延迟 $k$。因此，$\\operatorname{Cov}(A_i, A_j) = \\gamma(|i-j|)$。给定的表达式得以重现：\n$$\n\\operatorname{Var}(\\bar{A}) = \\frac{1}{n^2}\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\gamma(|i-j|).\n$$\n为简化双重求和，我们将具有相同延迟 $k = |i-j|$ 的项分组。对于给定的延迟 $k \\in \\{1, 2, \\dots, n-1\\}$，求和中有 $2(n-k)$ 对 $(i, j)$ 使得 $|i-j|=k$。对于 $k=0$，有 $n$ 对 $(i,i)$。该求和可以重写为：\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{n}\\gamma(|i-j|) = n\\gamma(0) + \\sum_{k=1}^{n-1} 2(n-k)\\gamma(k).\n$$\n将此代入 $\\operatorname{Var}(\\bar{A})$ 的表达式，并使用定义 $\\sigma^2 = \\gamma(0)$ 和 $\\rho(k) = \\gamma(k)/\\gamma(0)$：\n$$\n\\operatorname{Var}(\\bar{A}) = \\frac{1}{n^2} \\left[ n\\sigma^2 + \\sum_{k=1}^{n-1} 2(n-k)\\sigma^2\\rho(k) \\right] = \\frac{\\sigma^2}{n} \\left[ 1 + \\frac{2}{n}\\sum_{k=1}^{n-1}(n-k)\\rho(k) \\right].\n$$\n$$\n\\operatorname{Var}(\\bar{A}) = \\frac{\\sigma^2}{n} \\left[ 1 + 2\\sum_{k=1}^{n-1}\\left(1-\\frac{k}{n}\\right)\\rho(k) \\right].\n$$\n对于大样本量 $n$ 以及衰减足够快的自相关函数 $\\rho(k)$，在 $\\rho(k)$ 显著不为零的 $k$ 值处，$k/n$ 项可以忽略不计。此外，求和的上限可以从 $n-1$ 扩展到 $\\infty$，误差可以忽略不计。这得出了大 $n$ 近似：\n$$\n\\operatorname{Var}(\\bar{A}) \\approx \\frac{\\sigma^2}{n} \\left[ 1 + 2\\sum_{k=1}^{\\infty}\\rho(k) \\right].\n$$\n问题要求我们推导无量纲的积分自相关时间 $\\tau_{\\mathrm{int}}$（以采样步长为单位）的表达式。在此背景下的一个标准定义是：\n$$\n\\tau_{\\mathrm{int}} \\equiv \\sum_{k=1}^{\\infty}\\rho(k).\n$$\n根据这个定义，方差变为：\n$$\n\\operatorname{Var}(\\bar{A}) \\approx \\frac{\\sigma^2}{n} (1 + 2\\tau_{\\mathrm{int}}).\n$$\n有效样本量 $n_{\\mathrm{eff}}$ 的定义是将此方差等同于 $n_{\\mathrm{eff}}$ 个独立同分布样本均值的方差，即 $\\sigma^2/n_{\\mathrm{eff}}$。\n$$\n\\frac{\\sigma^2}{n_{\\mathrm{eff}}} = \\frac{\\sigma^2}{n} (1 + 2\\tau_{\\mathrm{int}}).\n$$\n解出 $n_{\\mathrm{eff}}$ 得到所求公式：\n$$\nn_{\\mathrm{eff}} = \\frac{n}{1 + 2\\tau_{\\mathrm{int}}}.\n$$\n现在，我们计算 $n_{\\mathrm{eff}}$ 的数值。首先，我们必须使用给定的 $\\rho(k)$ 模型计算 $\\tau_{\\mathrm{int}}$：\n$$\n\\rho(k) = a\\,\\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_1}\\right) + (1-a)\\,\\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_2}\\right).\n$$\n我们计算和 $\\tau_{\\mathrm{int}} = \\sum_{k=1}^{\\infty}\\rho(k)$：\n$$\n\\tau_{\\mathrm{int}} = \\sum_{k=1}^{\\infty} \\left[ a\\,\\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_1}\\right) + (1-a)\\,\\exp\\left(-\\frac{k\\,\\Delta t}{\\tau_2}\\right) \\right].\n$$\n这是两个等比数列的和。令 $r_1 = \\exp(-\\Delta t/\\tau_1)$ 和 $r_2 = \\exp(-\\Delta t/\\tau_2)$。等比数列 $\\sum_{k=1}^{\\infty} q^k$ 的和是 $\\frac{q}{1-q}$，其中 $|q|1$。\n$$\n\\tau_{\\mathrm{int}} = a \\left(\\sum_{k=1}^{\\infty} r_1^k\\right) + (1-a) \\left(\\sum_{k=1}^{\\infty} r_2^k\\right) = a \\frac{r_1}{1-r_1} + (1-a) \\frac{r_2}{1-r_2}.\n$$\n这也可以写成：\n$$\n\\tau_{\\mathrm{int}} = a \\frac{\\exp(-\\Delta t/\\tau_1)}{1-\\exp(-\\Delta t/\\tau_1)} + (1-a) \\frac{\\exp(-\\Delta t/\\tau_2)}{1-\\exp(-\\Delta t/\\tau_2)} = a \\frac{1}{\\exp(\\Delta t/\\tau_1)-1} + (1-a) \\frac{1}{\\exp(\\Delta t/\\tau_2)-1}.\n$$\n我们代入给定的参数值：$a=0.4$，$\\tau_1=3\\,\\mathrm{fs}$，$\\tau_2=20\\,\\mathrm{fs}$，以及 $\\Delta t=1\\,\\mathrm{fs}$。\n$$\n\\frac{\\Delta t}{\\tau_1} = \\frac{1}{3}, \\quad \\frac{\\Delta t}{\\tau_2} = \\frac{1}{20} = 0.05.\n$$\n$$\n\\tau_{\\mathrm{int}} = 0.4 \\left( \\frac{1}{\\exp(1/3)-1} \\right) + 0.6 \\left( \\frac{1}{\\exp(0.05)-1} \\right).\n$$\n现在我们计算数值：\n$$\n\\exp(1/3) \\approx 1.3956124 \\\\\n\\exp(0.05) \\approx 1.0512711 \\\\\n$$\n$$\n\\tau_{\\mathrm{int}} \\approx 0.4 \\left( \\frac{1}{1.3956124 - 1} \\right) + 0.6 \\left( \\frac{1}{1.0512711 - 1} \\right) \\\\\n\\tau_{\\mathrm{int}} \\approx 0.4 \\left( \\frac{1}{0.3956124} \\right) + 0.6 \\left( \\frac{1}{0.0512711} \\right) \\\\\n\\tau_{\\mathrm{int}} \\approx 0.4 (2.527723) + 0.6 (19.504221) \\\\\n\\tau_{\\mathrm{int}} \\approx 1.011089 + 11.702533 \\approx 12.713622.\n$$\n现在我们用 $n = 2 \\times 10^5$ 计算 $n_{\\mathrm{eff}}$：\n$$\nn_{\\mathrm{eff}} = \\frac{n}{1 + 2\\tau_{\\mathrm{int}}} \\approx \\frac{2 \\times 10^5}{1 + 2(12.713622)} = \\frac{2 \\times 10^5}{1 + 25.427244} = \\frac{2 \\times 10^5}{26.427244} \\approx 7567.9228.\n$$\n四舍五入到四位有效数字，我们得到 $n_{\\mathrm{eff}} = 7568$。\n\n最后，我们解释其对 $A$ 均值的置信区间的影响。根据相关过程的中心极限定理，对于大 $n$，样本均值 $\\bar{A}$ 的抽样分布近似为正态分布，其均值为 $\\mu=E[A]$，方差为 $\\operatorname{Var}(\\bar{A})$。均值的标准误差为 $SE(\\bar{A}) = \\sqrt{\\operatorname{Var}(\\bar{A})}$。\n对于相关样本，我们有 $SE(\\bar{A}) = \\sqrt{\\sigma^2/n_{\\mathrm{eff}}} = \\sigma/\\sqrt{n_{\\mathrm{eff}}}$。\n如果错误地假设 $n$ 个样本是独立的，标准误差将被计算为 $SE_{\\mathrm{naive}}(\\bar{A}) = \\sigma/\\sqrt{n}$。\n正态近似置信区间的半宽 $W$ 与标准误差成正比，例如 $W = z_{\\alpha/2} SE(\\bar{A})$。\n正相关（$\\tau_{\\mathrm{int}}  0$）的存在导致 $n_{\\mathrm{eff}}  n$。这意味着真实的标准误差大于朴素的估计值。半宽的标度关系是 $n_{\\mathrm{eff}}^{-1/2}$。\n正确半宽与朴素半宽的比值为：\n$$\n\\frac{W_{\\mathrm{correct}}}{W_{\\mathrm{naive}}} = \\frac{z_{\\alpha/2} \\sigma / \\sqrt{n_{\\mathrm{eff}}}}{z_{\\alpha/2} \\sigma / \\sqrt{n}} = \\sqrt{\\frac{n}{n_{\\mathrm{eff}}}} = \\sqrt{1 + 2\\tau_{\\mathrm{int}}}.\n$$\n在本问题中，这个因子是 $\\sqrt{26.427...} \\approx 5.14$。这意味着忽略时间相关性会导致统计误差和置信区间宽度被低估超过 5 倍。半宽按 $n_{\\mathrm{eff}}^{-1/2}$ 标度，而不是独立数据所期望的 $n^{-1/2}$ 标度。",
            "answer": "$$\\boxed{7568}$$"
        }
    ]
}