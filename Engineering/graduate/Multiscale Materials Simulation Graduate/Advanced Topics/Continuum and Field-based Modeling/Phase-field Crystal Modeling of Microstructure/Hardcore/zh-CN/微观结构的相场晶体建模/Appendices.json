{
    "hands_on_practices": [
        {
            "introduction": "为了有效地研究和模拟相场晶体（PFC）模型，我们首先需要将其控制方程转化为普适的无量纲形式。该练习将引导您完成基本的无量纲化过程，这是一项至关重要的技能，它通过将物理常数组合为关键的无量纲参数来简化模型。掌握这一过程将使您能够在一个统一的框架内理解和比较不同材料体系的结果。",
            "id": "3831665",
            "problem": "考虑一个用于标量序参量场$\\psi(\\mathbf{r},t)$的相场晶体（PFC）模型，该模型在扩散时间尺度上，通过一个粗粒化的自由能描述来捕捉原子尺度的周期性。有量纲的自由能泛函为\n$$\nF[\\psi] \\;=\\; \\int d^d r \\,\\left\\{ \\frac{A}{2}\\,\\psi^2 \\;+\\; \\frac{C}{2}\\,\\psi\\,\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2\\,\\psi \\;+\\; \\frac{G}{3}\\,\\psi^3 \\;+\\; \\frac{U}{4}\\,\\psi^4 \\right\\},\n$$\n其中$A$、$C$、$G$和$U$是与材料相关的常数，$q_0$设定了主导的晶体波数，$d$是空间维度，$\\nabla_{\\mathbf{r}}^2$是关于$\\mathbf{r}$的拉普拉斯算子。质量守恒的弛豫动力学由下式给出\n$$\n\\frac{\\partial \\psi}{\\partial t} \\;=\\; M \\,\\nabla_{\\mathbf{r}}^2 \\,\\mu, \\quad \\mu \\;=\\; \\frac{\\delta F}{\\delta \\psi},\n$$\n其中$M$是迁移率系数，$\\mu$是化学势。\n\n您的任务是基于第一性原理进行严格的无量纲化。定义一个标度化的长度$\\mathbf{x} = q_0\\,\\mathbf{r}$，一个标度化的场$\\psi(\\mathbf{r},t) = \\psi_0\\,n(\\mathbf{x},t)$（其中常数$\\psi_0$的选择是为了实现一个正则的无量纲形式），以及一个标度化的时间$t' = t/t_0$（其中特征时间$t_0$用$M$、$C$和$q_0$表示）。仅从给定的有量纲表达式以及泛函导数和微分算子的标准定义出发，构建无量纲自由能$F^*[n]$和关于$n(\\mathbf{x},t')$的无量纲动力学方程，并施加正则归一化条件，使得$F^*$的被积函数中$n\\,\\big(1+\\nabla_{\\mathbf{x}}^2\\big)^2\\,n$的系数为$1/2$，四次项系数为$1$。\n\n最后，提供无量纲线性控制参数$r$（即$F^*$的被积函数中$n^2$的系数）关于$A$、$C$和$q_0$的闭式解析表达式。最终答案必须是单一的解析表达式。不要计算任何数值。不需要四舍五入。最终答案中不需要物理单位。",
            "solution": "我们从给定的有量纲自由能泛函开始\n$$\nF[\\psi] \\;=\\; \\int d^d r \\,\\left\\{ \\frac{A}{2}\\,\\psi^2 \\;+\\; \\frac{C}{2}\\,\\psi\\,\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2\\,\\psi \\;+\\; \\frac{G}{3}\\,\\psi^3 \\;+\\; \\frac{U}{4}\\,\\psi^4 \\right\\}.\n$$\n相应的化学势由泛函导数定义\n$$\n\\mu \\;=\\; \\frac{\\delta F}{\\delta \\psi} \\;=\\; A\\,\\psi \\;+\\; C\\,\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2\\,\\psi \\;+\\; G\\,\\psi^2 \\;+\\; U\\,\\psi^3,\n$$\n这里我们使用了泛函导数的线性和$\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2$的自伴性。该守恒动力学是B模型类型：\n$$\n\\frac{\\partial \\psi}{\\partial t} \\;=\\; M\\,\\nabla_{\\mathbf{r}}^2 \\,\\mu.\n$$\n\n我们引入无量纲变量。定义无量纲位置$\\mathbf{x} = q_0\\,\\mathbf{r}$，因此导数变换如下\n$$\n\\nabla_{\\mathbf{r}} \\;=\\; q_0\\,\\nabla_{\\mathbf{x}}, \\qquad \\nabla_{\\mathbf{r}}^2 \\;=\\; q_0^2\\,\\nabla_{\\mathbf{x}}^2,\n$$\n测度变换为$d^d r = d^d x \\, q_0^{-d}$。定义一个标度化的场$\\psi(\\mathbf{r},t) = \\psi_0\\,n(\\mathbf{x},t)$，其中常数振幅标度$\\psi_0$待定。有了这些，自由能变为\n\\begin{align*}\nF[\\psi] = \\int d^d r \\left\\{ \\frac{A}{2}\\,\\psi^2 + \\frac{C}{2}\\,\\psi\\,\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2\\,\\psi + \\frac{G}{3}\\,\\psi^3 + \\frac{U}{4}\\,\\psi^4 \\right\\} \\\\\n= \\int d^d x \\, q_0^{-d} \\left\\{ \\frac{A}{2}\\,\\psi_0^2\\,n^2 + \\frac{C}{2}\\,\\psi_0^2\\,\\big(q_0^2 + q_0^2 \\nabla_{\\mathbf{x}}^2\\big)^2 \\, n^2 + \\frac{G}{3}\\,\\psi_0^3\\,n^3 + \\frac{U}{4}\\,\\psi_0^4\\,n^4 \\right\\}.\n\\end{align*}\n使用$\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2 = \\big(q_0^2 + q_0^2 \\nabla_{\\mathbf{x}}^2\\big)^2 = q_0^4 \\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2$，第二项简化为$\\frac{C}{2}\\,\\psi_0^2\\,q_0^4\\,n\\,\\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n$。我们现在提出一个能量标度\n$$\nF_0 \\;=\\; C\\,\\psi_0^2\\,q_0^{4-d},\n$$\n因此无量纲自由能$F^* = F/F_0$可写为\n\\begin{align*}\nF^*[n] = \\int d^d x \\left\\{ \\frac{1}{2}\\,n\\,\\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n \\;+\\; \\frac{A}{2\\,C\\,q_0^4}\\,n^2 \\;+\\; \\frac{G\\,\\psi_0}{3\\,C\\,q_0^4}\\,n^3 \\;+\\; \\frac{U\\,\\psi_0^2}{4\\,C\\,q_0^4}\\,n^4 \\right\\}.\n\\end{align*}\n这实现了正则归一化，其中$n\\,\\big(1+\\nabla_{\\mathbf{x}}^2\\big)^2\\,n$的系数为$\\frac{1}{2}$，且与$d$无关。为了完成正则形式，我们选择$\\psi_0$以将四次项系数固定为$1$，即\n$$\n\\frac{U\\,\\psi_0^2}{4\\,C\\,q_0^4} \\;=\\; 1 \\quad \\Rightarrow \\quad \\psi_0 \\;=\\; \\sqrt{\\frac{4\\,C\\,q_0^4}{U}}\\,\\cdot \\frac{1}{2} \\;=\\; \\sqrt{\\frac{C\\,q_0^4}{U}}.\n$$\n通过这个选择，无量纲自由能变为\n$$\nF^*[n] \\;=\\; \\int d^d x \\left\\{ \\frac{1}{2}\\,n\\,\\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n \\;+\\; \\frac{A}{2\\,C\\,q_0^4}\\,n^2 \\;+\\; \\frac{G}{3}\\,\\frac{\\psi_0}{C\\,q_0^4}\\,n^3 \\;+\\; n^4 \\right\\},\n$$\n因此无量纲系数为\n$$\nr \\;=\\; \\frac{A}{C\\,q_0^4}, \\qquad v \\;=\\; \\frac{G\\,\\psi_0}{C\\,q_0^4} \\;=\\; \\frac{G}{\\sqrt{U\\,C\\,q_0^4}}, \\qquad u \\;=\\; 1.\n$$\n\n我们现在对动力学方程进行无量纲化。化学势的标度关系如下\n\\begin{align*}\n\\mu = A\\,\\psi + C\\,\\big(q_0^2 + \\nabla_{\\mathbf{r}}^2\\big)^2\\,\\psi + G\\,\\psi^2 + U\\,\\psi^3 \\\\\n= \\psi_0 \\left[ A\\,n + C\\,q_0^4\\,\\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n + G\\,\\psi_0\\,n^2 + U\\,\\psi_0^2\\,n^3 \\right].\n\\end{align*}\n引入一个化学势标度$\\mu_0 = C\\,\\psi_0\\,q_0^4$，得到\n$$\n\\frac{\\mu}{\\mu_0} \\;=\\; r\\,n \\;+\\; \\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n \\;+\\; v\\,n^2 \\;+\\; u\\,n^3.\n$$\n动力学方程变为\n\\begin{align*}\n\\frac{\\partial \\psi}{\\partial t} = M\\,\\nabla_{\\mathbf{r}}^2 \\,\\mu \\;=\\; M\\,q_0^2\\,\\nabla_{\\mathbf{x}}^2 \\,\\mu \\\\\n\\Rightarrow \\quad \\psi_0\\,\\frac{\\partial n}{\\partial t} = M\\,q_0^2\\,\\nabla_{\\mathbf{x}}^2 \\,\\mu_0 \\left[ r\\,n + \\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n + v\\,n^2 + u\\,n^3 \\right] \\\\\n\\Rightarrow \\quad \\frac{\\partial n}{\\partial t} = \\big(M\\,C\\,q_0^6\\big)\\,\\nabla_{\\mathbf{x}}^2 \\left[ r\\,n + \\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n + v\\,n^2 + u\\,n^3 \\right],\n\\end{align*}\n这里我们使用了$\\mu_0 = C\\,\\psi_0\\,q_0^4$并消去了$\\psi_0$。定义特征时间$t_0$为\n$$\nt_0 \\;=\\; \\frac{1}{M\\,C\\,q_0^6}, \\qquad t' \\;=\\; \\frac{t}{t_0}.\n$$\n于是无量纲动力学方程可写为\n$$\n\\frac{\\partial n}{\\partial t'} \\;=\\; \\nabla_{\\mathbf{x}}^2 \\left[ r\\,n + \\big(1 + \\nabla_{\\mathbf{x}}^2\\big)^2\\,n + v\\,n^2 + u\\,n^3 \\right],\n$$\n其中$r$、$v$和$u$如上所述，与指定的正则归一化一致。\n\n因此，所要求的无量纲线性控制参数$r$可从二次项的无量纲化直接获得：\n$$\nr \\;=\\; \\frac{A}{C\\,q_0^4}.\n$$\n这是一个仅依赖于$A$、$C$和$q_0$的闭式解析表达式。",
            "answer": "$$\\boxed{\\frac{A}{C\\,q_0^4}}$$"
        },
        {
            "introduction": "建立了无量纲的PFC方程后，下一步是进行数值求解以模拟微观结构的演化。这个动手编程练习将指导您实现一种强大的伪谱方法，该方法非常适用于晶体系统的周期性。通过验证总质量守恒，您不仅能构建一个稳健的求解器，还能更深入地理解模型的物理和数值完整性。",
            "id": "3831730",
            "problem": "给定周期性域中守恒序参量场$\\psi(\\mathbf{r}, t)$的无量纲相场晶体 (PFC) 动力学。其热力学驱动力是粗粒化自由能的泛函导数。考虑自由能\n$$\nF[\\psi] = \\int_{\\Omega} \\left[ \\frac{1}{2}\\,\\psi\\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\frac{1}{4}\\,\\psi^4 \\right]\\, d\\mathbf{r},\n$$\n其中$\\Omega$是一个$d$维周期域，$r \\in \\mathbb{R}$是一个控制参数，所有量均为无量纲。化学势为$\\mu = \\delta F/\\delta \\psi$，演化方程是一个守恒梯度流\n$$\n\\frac{\\partial \\psi}{\\partial t} = \\nabla^2 \\mu,\n$$\n并满足$\\Omega$上的周期性边界条件。总质量定义为\n$$\nM(t) = \\int_{\\Omega} \\psi(\\mathbf{r}, t)\\, d\\mathbf{r}.\n$$\n\n从第一性原理和核心定义出发，实现一个数值求解器，该求解器在具有周期性边界的均匀网格上，使用傅里叶空间中的伪谱方法来对$\\psi$进行时间演化。您的求解器必须：\n- 在尺寸为$L_x \\times L_y$的矩形域上使用具有$N_x \\times N_y$个节点的均匀网格，并采用周期性边界条件。\n- 通过具有波矢量$\\mathbf{k} = (k_x, k_y)$的傅里叶模式来表示空间导数，其中傅里叶微分映射为$\\nabla^2 \\mapsto -|\\mathbf{k}|^2$。\n- 在与守恒梯度流和周期性一致的一阶精度时间积分中，对线性项进行隐式处理，对非线性项进行显式处理。不要使用任何混叠校正。\n- 至少在初始和最终时刻，通过均匀网格的梯形法则计算总质量$M(t)$，在这种周期性和均匀网格的设置下，这恰好是矩形法则：\n$$\nM(t) = \\left(\\sum_{i=1}^{N_x}\\sum_{j=1}^{N_y} \\psi_{i,j}(t)\\right)\\, \\Delta x\\, \\Delta y,\n$$\n其中$\\Delta x = L_x/N_x$且$\\Delta y = L_y/N_y$。\n- 对于每个测试用例，以浮点数形式报告绝对差值$\\Delta M = |M(t_{\\text{final}}) - M(0)|$。所有报告的数字都是无单位的。\n\n设计一个独立的程序（无用户输入），运行以下测试套件，并在一行中输出包含四个结果的列表$[\\Delta M_1, \\Delta M_2, \\Delta M_3, \\Delta M_4]$，格式为方括号内以逗号分隔的列表。初始条件在实空间中指定如下，其中$x \\in [0, L_x)$且$y \\in [0, L_y)$：\n- 测试用例 1（正常情况随机平均场）：\n  - $N_x = 32$, $N_y = 32$, $L_x = 32$, $L_y = 32$, $r = -0.25$, $\\Delta t = 0.1$, $n_{\\text{steps}} = 50$.\n  - 初始条件$\\psi(\\mathbf{r},0) = m + a \\,\\xi(\\mathbf{r})$，其中$m = 0.1$，$a = 0.01$，且$\\xi$是一个在$[-0.5, 0.5]$区间内取独立值的可复现伪随机场（使用固定的种子）。\n- 测试用例 2（结构化正弦模式）：\n  - $N_x = 64$, $N_y = 64$, $L_x = 64$, $L_y = 64$, $r = -0.5$, $\\Delta t = 0.05$, $n_{\\text{steps}} = 20$.\n  - 初始条件$\\psi(\\mathbf{r},0) = m + a\\left[ \\cos\\left( \\frac{2\\pi m_x x}{L_x} \\right)\\cos\\left( \\frac{2\\pi m_y y}{L_y} \\right) \\right]$，其中$m = 0$，$a = 0.1$，$m_x = 3$，$m_y = 2$。\n- 测试用例 3（边界情况，恒定场）：\n  - $N_x = 16$, $N_y = 16$, $L_x = 16$, $L_y = 16$, $r = -0.25$, $\\Delta t = 0.5$, $n_{\\text{steps}} = 5$.\n  - 初始条件$\\psi(\\mathbf{r},0) = m$，其中$m = 0.2$。\n- 测试用例 4（边缘情况，线性驱动参数为零）：\n  - $N_x = 48$, $N_y = 48$, $L_x = 48$, $L_y = 48$, $r = 0$, $\\Delta t = 0.2$, $n_{\\text{steps}} = 10$.\n  - 初始条件$\\psi(\\mathbf{r},0) = m + a \\,\\xi(\\mathbf{r})$，其中$m = -0.02$，$a = 0.02$，且$\\xi$是一个与测试用例 1 中类似的可复现伪随机场（使用不同的固定种子）。\n\n您的程序必须：\n- 仅从上述定义出发，实现与守恒 PFC 动力学和周期性边界条件一致的伪谱时间步进法。\n- 对每个测试用例，计算定义的$\\Delta M$并将其存储为浮点数。\n- 生成单行输出，包含以方括号括起、逗号分隔的结果列表，例如$[\\Delta M_1,\\Delta M_2,\\Delta M_3,\\Delta M_4]$。\n- 所有量均为无量纲；报告无单位的数字。\n\n注意：\n- 算法的选择必须确保零波矢量模式的处理与周期性守恒一致，从而使$M(t)$在数值舍入误差范围内保持不变。\n- 报告的$\\Delta M$值应该很小（接近机器精度），但您必须报告原始计算值，而不应用阈值或转换为布尔值。",
            "solution": "该问题是有效的，因为它在科学上基于已建立的相场晶体 (PFC) 方法论，问题设定良好，具有完整且一致的参数集，并以客观、正式的语言表述。我们开始求解。\n\n问题的核心是在二维周期域$\\Omega$上求解守恒序参量场$\\psi(\\mathbf{r}, t)$的PFC演化方程。其动力学由从粗粒化自由能泛函$F[\\psi]$导出的守恒梯度流控制。\n\n自由能泛函由下式给出：\n$$\nF[\\psi] = \\int_{\\Omega} \\left[ \\frac{1}{2}\\,\\psi\\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\frac{1}{4}\\,\\psi^4 \\right]\\, d\\mathbf{r}\n$$\n这里，$r$是一个控制参数，$\\nabla^2$是拉普拉斯算子。项$(1 + \\nabla^2)^2$惩罚偏离特征长度尺度的行为，从而导致周期性（晶体）结构。$\\psi^4$项是稳定场的标准双阱势。\n\n化学势$\\mu$是自由能相对于场$\\psi$的泛函导数：\n$$\n\\mu = \\frac{\\delta F}{\\delta \\psi}\n$$\n为了计算这个导数，我们考虑一个小变分$\\delta\\psi$：\n$$\n\\delta F = \\int_{\\Omega} \\left[ \\frac{1}{2}\\,\\delta\\psi\\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\frac{1}{2}\\,\\psi\\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\delta\\psi + \\psi^3 \\delta\\psi \\right]\\, d\\mathbf{r}\n$$\n在周期性边界条件下，算子$r + (1 + \\nabla^2)^2$是自伴的。因此，被积函数中的前两项是相同的。这导致：\n$$\n\\delta F = \\int_{\\Omega} \\left[ \\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\psi^3 \\right] \\delta\\psi \\, d\\mathbf{r}\n$$\n根据泛函导数的定义，我们确定化学势为：\n$$\n\\mu(\\mathbf{r}, t) = \\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\psi^3\n$$\n\n$\\psi$的演化遵循Cahn-Hilliard类型的守恒动力学方程：\n$$\n\\frac{\\partial \\psi}{\\partial t} = \\nabla^2 \\mu = \\nabla^2 \\left[ \\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\psi^3 \\right]\n$$\n这可以分为线性和非线性部分：\n$$\n\\frac{\\partial \\psi}{\\partial t} = \\nabla^2 \\left( r + \\left(1 + \\nabla^2\\right)^2 \\right)\\psi + \\nabla^2(\\psi^3)\n$$\n\n为了数值求解这个偏微分方程，我们采用伪谱方法，该方法对于具有周期性边界条件的问题非常高效。该方法涉及将方程变换到傅里叶空间。设$\\hat{\\psi}(\\mathbf{k}, t) = \\mathcal{F}\\{\\psi(\\mathbf{r}, t)\\}$是$\\psi(\\mathbf{r}, t)$的傅里叶变换，其中$\\mathbf{k}=(k_x, k_y)$是波矢量。在傅里叶空间中，拉普拉斯算子变成简单的乘法：$\\mathcal{F}\\{\\nabla^2 f\\} = -|\\mathbf{k}|^2 \\hat{f}$，其中$|\\mathbf{k}|^2 = k_x^2 + k_y^2$。\n\n对演化方程应用傅里叶变换得到：\n$$\n\\frac{\\partial \\hat{\\psi}}{\\partial t} = -|\\mathbf{k}|^2 \\left[ \\left( r + (1 - |\\mathbf{k}|^2)^2 \\right)\\hat{\\psi} + \\mathcal{F}\\{\\psi^3\\} \\right]\n$$\n我们可以将其写为：\n$$\n\\frac{\\partial \\hat{\\psi}}{\\partial t} = L(\\mathbf{k}) \\hat{\\psi} + N(\\psi)\n$$\n其中线性部分是$L(\\mathbf{k}) = -|\\mathbf{k}|^2\\left(r + (1 - |\\mathbf{k}|^2)^2\\right)$，非线性部分是$N(\\psi) = -|\\mathbf{k}|^2\\mathcal{F}\\{\\psi^3\\}$。\n\n问题指定了一个一阶时间积分方案，其中线性项被隐式处理，非线性项被显式处理。这是一个半隐式欧拉（或前向-后向欧拉）方案。对于时间步长$\\Delta t$，我们将方程离散化为：\n$$\n\\frac{\\hat{\\psi}^{n+1} - \\hat{\\psi}^n}{\\Delta t} = L(\\mathbf{k}) \\hat{\\psi}^{n+1} + N(\\psi^n)\n$$\n其中上标$n$和$n+1$分别表示当前和下一个时间层级。重新整理以求解$\\hat{\\psi}^{n+1}$：\n$$\n\\hat{\\psi}^{n+1}(1 - \\Delta t L(\\mathbf{k})) = \\hat{\\psi}^n + \\Delta t N(\\psi^n)\n$$\n$$\n\\hat{\\psi}^{n+1}(\\mathbf{k}) = \\frac{\\hat{\\psi}^n(\\mathbf{k}) + \\Delta t N(\\psi^n)}{1 - \\Delta t L(\\mathbf{k})}\n$$\n代入$L(\\mathbf{k})$和$N(\\psi^n)$的表达式：\n$$\n\\hat{\\psi}^{n+1}(\\mathbf{k}) = \\frac{\\hat{\\psi}^n(\\mathbf{k}) - \\Delta t |\\mathbf{k}|^2 \\mathcal{F}\\{(\\psi^n)^3\\}}{1 + \\Delta t |\\mathbf{k}|^2 \\left(r + (1-|\\mathbf{k}|^2)^2\\right)}\n$$\n这是傅里叶空间中场的更新规则。\n\n该方案的一个关键特征是其对质量守恒的处理。总质量$M(t) = \\int_{\\Omega} \\psi(\\mathbf{r}, t) d\\mathbf{r}$与零波矢量傅里叶模式$\\hat{\\psi}(\\mathbf{k}=\\mathbf{0})$成正比。对于$\\mathbf{k}=\\mathbf{0}$模式，$|\\mathbf{k}|^2=0$。更新方程简化为：\n$$\n\\hat{\\psi}^{n+1}(\\mathbf{0}) = \\frac{\\hat{\\psi}^n(\\mathbf{0}) - \\Delta t \\cdot 0 \\cdot \\mathcal{F}\\{(\\psi^n)^3\\}(\\mathbf{0})}{1 + \\Delta t \\cdot 0 \\cdot (\\dots)} = \\hat{\\psi}^n(\\mathbf{0})\n$$\n这表明$\\mathbf{k}=\\mathbf{0}$模式被数值方案精确守恒。总质量的任何变化（计算为$M(t) = (\\sum_{i,j} \\psi_{i,j}(t)) \\Delta x \\Delta y$）将仅由浮点舍入误差引起，并预期接近机器精度。\n\n每个测试用例的数值算法如下：\n1. 初始化参数：$N_x, N_y, L_x, L_y, r, \\Delta t, n_{\\text{steps}}$。\n2. 定义实空间网格坐标$x, y$和网格间距$\\Delta x = L_x/N_x, \\Delta y = L_y/N_y$。\n3. 定义傅里叶空间波矢量分量$k_x, k_y$，并构建二维波矢量网格$\\mathbf{k}=(k_x, k_y)$和模长平方网格$|\\mathbf{k}|^2$。\n4. 在实空间网格上生成初始条件$\\psi(\\mathbf{r}, 0)$。\n5. 使用提供的求和公式计算初始质量$M(0)$。\n6. 循环$n_{\\text{steps}}$次：\n    a. 计算当前场的傅里叶变换，$\\hat{\\psi}^n = \\mathcal{F}\\{\\psi^n\\}$。\n    b. 在实空间中计算非线性项$(\\psi^n)^3$，并对其进行傅里叶变换，$\\mathcal{F}\\{(\\psi^n)^3\\}$。\n    c. 在傅里叶空间中应用半隐式更新公式计算$\\hat{\\psi}^{n+1}$。\n    d. 通过傅里叶逆变换计算新的实空间场，$\\psi^{n+1} = \\mathcal{F}^{-1}\\{\\hat{\\psi}^{n+1}\\}$。结果应为实数，因此我们取其实部以丢弃由舍入误差产生的可忽略的虚部。\n7. 循环结束后，计算最终质量$M(t_{\\text{final}})$。\n8. 计算测试用例的最终结果$\\Delta M = |M(t_{\\text{final}}) - M(0)|$。\n\n对提供的四个测试用例均实施此程序。",
            "answer": "```python\nimport numpy as np\n\ndef run_simulation(Nx, Ny, Lx, Ly, r, dt, n_steps, initial_condition_func):\n    \"\"\"\n    Runs a single Phase-Field Crystal simulation.\n\n    Args:\n        Nx (int): Number of grid points in x.\n        Ny (int): Number of grid points in y.\n        Lx (float): Domain size in x.\n        Ly (float): Domain size in y.\n        r (float): Control parameter.\n        dt (float): Time step size.\n        n_steps (int): Number of time steps.\n        initial_condition_func (function): A function that returns the initial psi field.\n\n    Returns:\n        float: The absolute difference between final and initial total mass.\n    \"\"\"\n    # Grid and wavevector setup\n    dx = Lx / Nx\n    dy = Ly / Ny\n    \n    # Create wavevectors in the order numpy.fft expects them\n    kx_vals = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n    ky_vals = 2 * np.pi * np.fft.fftfreq(Ny, d=dy)\n    kx, ky = np.meshgrid(kx_vals, ky_vals, indexing='ij')\n    k2 = kx**2 + ky**2\n    \n    # Initial condition\n    psi = initial_condition_func(Nx, Ny, Lx, Ly)\n    \n    # Calculate initial mass\n    mass_initial = np.sum(psi) * dx * dy\n    \n    # Pre-compute the denominator for the time-stepping update rule\n    # Denominator: 1 + dt * |k|^2 * (r + (1 - |k|^2)^2)\n    denominator = 1 + dt * k2 * (r + (1 - k2)**2)\n    # Avoid division by zero, though for k=0, denominator is 1\n    # For very large k, denominator can be huge, which is fine\n    \n    # Time-stepping loop\n    psi_hat = np.fft.fft2(psi)\n\n    for _ in range(n_steps):\n        # Compute nonlinear term in real space and transform\n        psi_cubed = psi**3\n        psi_cubed_hat = np.fft.fft2(psi_cubed)\n        \n        # Update rule in Fourier space\n        # Numerator: psi_hat - dt * |k|^2 * FFT(psi^3)\n        numerator = psi_hat - dt * k2 * psi_cubed_hat\n        \n        psi_hat = numerator / denominator\n        \n        # Transform back to real space for the next iteration's nonlinear term\n        # The result of ifft2 on a field with appropriate symmetry will be real.\n        # Taking .real discards negligible imaginary parts due to roundoff.\n        psi = np.fft.ifft2(psi_hat).real\n\n    # Calculate final mass\n    mass_final = np.sum(psi) * dx * dy\n    \n    # Compute the absolute difference in mass\n    delta_mass = abs(mass_final - mass_initial)\n    \n    return delta_mass\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite for the PFC simulation.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (happy path random mean field)\n        {\n            \"params\": {\"Nx\": 32, \"Ny\": 32, \"Lx\": 32, \"Ly\": 32, \"r\": -0.25, \"dt\": 0.1, \"n_steps\": 50},\n            \"ic_func\": lambda Nx, Ny, Lx, Ly: (\n                0.1 + 0.01 * (np.random.default_rng(seed=42).uniform(-0.5, 0.5, size=(Nx, Ny)))\n            ),\n        },\n        # Test case 2 (structured sinusoidal mode)\n        {\n            \"params\": {\"Nx\": 64, \"Ny\": 64, \"Lx\": 64, \"Ly\": 64, \"r\": -0.5, \"dt\": 0.05, \"n_steps\": 20},\n            \"ic_func\": lambda Nx, Ny, Lx, Ly: (\n                (lambda m, a, mx, my: (\n                    m + a * (np.cos(2 * np.pi * mx * np.linspace(0, Lx, Nx, endpoint=False) / Lx)[:, np.newaxis]) *\n                           (np.cos(2 * np.pi * my * np.linspace(0, Ly, Ny, endpoint=False) / Ly)[np.newaxis, :])\n                ))(m=0.0, a=0.1, mx=3, my=2)\n            ),\n        },\n        # Test case 3 (boundary case, constant field)\n        {\n            \"params\": {\"Nx\": 16, \"Ny\": 16, \"Lx\": 16, \"Ly\": 16, \"r\": -0.25, \"dt\": 0.5, \"n_steps\": 5},\n            \"ic_func\": lambda Nx, Ny, Lx, Ly: 0.2 * np.ones((Nx, Ny)),\n        },\n        # Test case 4 (edge case, zero linear driving parameter)\n        {\n            \"params\": {\"Nx\": 48, \"Ny\": 48, \"Lx\": 48, \"Ly\": 48, \"r\": 0.0, \"dt\": 0.2, \"n_steps\": 10},\n            \"ic_func\": lambda Nx, Ny, Lx, Ly: (\n                -0.02 + 0.02 * (np.random.default_rng(seed=1337).uniform(-0.5, 0.5, size=(Nx, Ny)))\n            ),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_m = run_simulation(\n            Nx=case[\"params\"][\"Nx\"],\n            Ny=case[\"params\"][\"Ny\"],\n            Lx=case[\"params\"][\"Lx\"],\n            Ly=case[\"params\"][\"Ly\"],\n            r=case[\"params\"][\"r\"],\n            dt=case[\"params\"][\"dt\"],\n            n_steps=case[\"params\"][\"n_steps\"],\n            initial_condition_func=case[\"ic_func\"]\n        )\n        results.append(delta_m)\n\n    # Format the final output as specified\n    # The meshgrid indexing was changed from 'xy' (default) to 'ij' to match fft ordering.\n    # The test case 2 IC needed to be adjusted for meshgrid's output shape (Nx, Ny) not (Ny, Nx).\n    # Correcting the IC for test case 2.\n    # Let's re-run with correct IC setup.\n    # Original IC for TC2:\n    # (np.cos(2*pi*mx*np.linspace(0,Lx,Nx,endpoint=False)/Lx)[np.newaxis, :]) * (np.cos(2*pi*my*np.linspace(0,Ly,Ny,endpoint=False)/Ly)[:, np.newaxis])\n    # x vector is (1, Nx), y vector is (Ny, 1), result is (Ny, Nx).\n    # If meshgrid uses ij, x is (Nx, Ny) and y is (Nx, Ny). My code's IC creation needs to match the grid.\n    # The linspace method is more direct.\n    \n    # Correcting TC 2 IC logic within the lambda\n    test_cases[1][\"ic_func\"] = lambda Nx, Ny, Lx, Ly: (\n        (lambda m, a, mx, my: (\n            m + a * (\n                np.cos(2 * np.pi * mx * np.linspace(0, Lx, Nx, endpoint=False) / Lx)[:, np.newaxis] *\n                np.cos(2 * np.pi * my * np.linspace(0, Ly, Ny, endpoint=False) / Ly)[np.newaxis, :]\n            )\n        ))(m=0.0, a=0.1, mx=3, my=2)\n    )\n\n    final_results = []\n    for case in test_cases:\n        delta_m = run_simulation(\n            Nx=case[\"params\"][\"Nx\"],\n            Ny=case[\"params\"][\"Ny\"],\n            Lx=case[\"params\"][\"Lx\"],\n            Ly=case[\"params\"][\"Ly\"],\n            r=case[\"params\"][\"r\"],\n            dt=case[\"params\"][\"dt\"],\n            n_steps=case[\"params\"][\"n_steps\"],\n            initial_condition_func=case[\"ic_func\"]\n        )\n        final_results.append(delta_m)\n\n\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个强大的模拟只有当其结果能够与物理世界相关联时才真正有用。最后的这个练习旨在解决校准PFC模型的关键任务，展示如何通过将模拟输出与实验数据或更高保真度的模拟结果相匹配来确定物理长度和能量尺度。通过执行这种映射，您将学会如何弥合无量纲模拟与定量的、真实世界材料属性之间的鸿沟。",
            "id": "3831643",
            "problem": "考虑一个标量密度偏差场$n(\\mathbf{r})$的无量纲相场晶体（PFC）自由能泛函，其标准形式为\n$$\nF_{\\mathrm{PFC}}[n] = \\int_{\\Omega} \\mathrm{d}\\mathbf{r}\\,\\left[\\frac{1}{2}\\,n\\,\\left(r + \\left(1 + \\nabla^{2}\\right)^{2}\\right)n + \\frac{v}{3}\\,n^{3} + \\frac{w}{4}\\,n^{4}\\right],\n$$\n其中$\\mathbf{r}$是无量纲空间坐标，$r$、$v$和$w$是无量纲参数，$\\Omega$是一个三维无量纲区域。设相应的有量纲物理自由能泛函为$F_{\\mathrm{phys}}[n_{\\mathrm{phys}}] = \\int_{\\Omega_{\\mathrm{phys}}} \\mathrm{d}\\mathbf{x}\\, f_{\\mathrm{phys}}$，其中$\\mathbf{x}$是物理空间坐标，$f_{\\mathrm{phys}}$是物理自由能密度（单位为$\\mathrm{J}/\\mathrm{m}^{3}$），$\\Omega_{\\mathrm{phys}}$是物理区域。\n\n你需要仅使用基本定义和尺度变换来构建PFC单位与物理单位之间的映射关系。定义单一长度尺度$L_{0}$使得$\\mathbf{x} = L_{0}\\,\\mathbf{r}$，以及单一能量密度尺度$E_{0}$使得$f_{\\mathrm{phys}} = E_{0}\\,f_{\\mathrm{PFC}}$。假设 PFC 弹性常数由无量纲自由能密度对均匀应变的二阶导数得到，而固液界面能则作为一维平面界面单位面积的过剩自由能得到。\n\n从这些定义出发：\n1. 推导物理弹性常数$C_{ijkl}^{\\mathrm{phys}}$与PFC 弹性常数$C_{ijkl}^{\\mathrm{PFC}}$之间的关系。\n2. 推导物理固液界面能$\\gamma_{sl}^{\\mathrm{phys}}$与PFC 界面能$\\gamma_{sl}^{\\mathrm{PFC}}$之间的关系。\n\n然后，通过匹配单个弹性常数和固液界面能，使用分子动力学（MD）或实验值以及 PFC 的输出来确定$E_{0}$和$L_{0}$的数值。具体而言，取值如下：\n- $C_{11}^{\\mathrm{phys}} = 185 \\times 10^{9}\\ \\mathrm{Pa}$，\n- $\\gamma_{sl}^{\\mathrm{phys}} = 0.200\\ \\mathrm{J}/\\mathrm{m}^{2}$，\n- $C_{11}^{\\mathrm{PFC}} = 37.0$ (无量纲)，\n- $\\gamma_{sl}^{\\mathrm{PFC}} = 0.250$ (无量纲，即单位无量纲面积的过剩能量)。\n\n请分别以$\\mathrm{J}/\\mathrm{m}^{3}$和$\\mathrm{m}$为单位，报告你的两个尺度因子$E_{0}$ (能量密度尺度) 和$L_{0}$ (长度单位)。将两个数值均四舍五入至四位有效数字。以行的形式提供最终的数值对，第一个条目为$E_{0}$，第二个条目为$L_{0}$。",
            "solution": "问题陈述已经过验证，被认为是科学上合理、良定且自洽的。它为确定相场晶体（PFC）模型的尺度因子提供了明确的目标、所有必要的定义和一致的数据。因此，我们可以开始求解。\n\n问题要求我们首先推导弹性常数和固液界面能的尺度关系，然后使用所提供的数据计算能量密度尺度$E_{0}$和长度尺度$L_{0}$的数值。\n\n基本尺度关系如下：\n$\\mathbf{x} = L_{0}\\,\\mathbf{r}$，其中$\\mathbf{x}$是物理坐标，$\\mathbf{r}$是无量纲PFC坐标。\n$f_{\\mathrm{phys}} = E_{0}\\,f_{\\mathrm{PFC}}$，其中$f_{\\mathrm{phys}}$是物理自由能密度，而$f_{\\mathrm{PFC}}$是无量纲PFC自由能密度。\n\n首先，我们推导弹性常数$C_{ijkl}$的尺度关系。\n弹性常数定义为自由能密度$f$对应变张量$\\epsilon_{kl}$各分量的二阶偏导数。\n$$\nC_{ijkl} = \\frac{\\partial^{2}f}{\\partial \\epsilon_{ij} \\partial \\epsilon_{kl}}\n$$\n应变张量$\\epsilon_{ij}$根据位移场梯度定义，其本身是无量纲的。因此，其值与长度尺度的选择无关，即$\\epsilon_{ij}^{\\mathrm{phys}} = \\epsilon_{ij}^{\\mathrm{PFC}}$。我们将其简记为$\\epsilon_{ij}$。\n\n物理弹性常数$C_{ijkl}^{\\mathrm{phys}}$从物理自由能密度$f_{\\mathrm{phys}}$推导而来：\n$$\nC_{ijkl}^{\\mathrm{phys}} = \\frac{\\partial^{2}f_{\\mathrm{phys}}}{\\partial \\epsilon_{ij} \\partial \\epsilon_{kl}}\n$$\n使用给定的尺度关系$f_{\\mathrm{phys}} = E_{0}\\,f_{\\mathrm{PFC}}$，我们可以将其代入$C_{ijkl}^{\\mathrm{phys}}$的表达式中：\n$$\nC_{ijkl}^{\\mathrm{phys}} = \\frac{\\partial^{2}\\left(E_{0}\\,f_{\\mathrm{PFC}}\\right)}{\\partial \\epsilon_{ij} \\partial \\epsilon_{kl}}\n$$\n由于$E_{0}$是一个常数尺度因子，可以将其从导数中提出：\n$$\nC_{ijkl}^{\\mathrm{phys}} = E_{0}\\,\\frac{\\partial^{2}f_{\\mathrm{PFC}}}{\\partial \\epsilon_{ij} \\partial \\epsilon_{kl}}\n$$\n根据定义，$\\frac{\\partial^{2}f_{\\mathrm{PFC}}}{\\partial \\epsilon_{ij} \\partial \\epsilon_{kl}}$项就是无量纲 PFC 弹性常数$C_{ijkl}^{\\mathrm{PFC}}$。因此，我们得到第一个尺度关系：\n$$\nC_{ijkl}^{\\mathrm{phys}} = E_{0}\\,C_{ijkl}^{\\mathrm{PFC}} \\quad (1)\n$$\n这个关系在量纲上是一致的。$C_{ijkl}^{\\mathrm{phys}}$的单位是能量/体积（例如$\\mathrm{J}/\\mathrm{m}^{3}$或$\\mathrm{Pa}$），$E_{0}$的单位是能量/体积，而$C_{ijkl}^{\\mathrm{PFC}}$是无量纲的。\n\n接下来，我们推导固液界面能$\\gamma_{sl}$的尺度关系。\n界面能定义为单位界面面积$A$上的过剩总自由能$F_{\\mathrm{excess}}$。\n$$\n\\gamma_{sl} = \\frac{F_{\\mathrm{excess}}}{A}\n$$\n总自由能$F$是自由能密度$f$在体积$V$上的积分。我们必须将总物理自由能$F_{\\mathrm{phys}}$与总无量纲自由能$F_{\\mathrm{PFC}}$联系起来。\n体积微元通过长度尺度$L_{0}$相关联：\n$$\n\\mathrm{d}\\mathbf{x} = \\mathrm{d}(L_{0}\\,r_{1})\\,\\mathrm{d}(L_{0}\\,r_{2})\\,\\mathrm{d}(L_{0}\\,r_{3}) = L_{0}^{3}\\,\\mathrm{d}\\mathbf{r}\n$$\n现在，我们可以关联总自由能：\n$$\nF_{\\mathrm{phys}} = \\int_{\\Omega_{\\mathrm{phys}}} f_{\\mathrm{phys}}\\,\\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\left(E_{0}\\,f_{\\mathrm{PFC}}\\right)\\,\\left(L_{0}^{3}\\,\\mathrm{d}\\mathbf{r}\\right) = E_{0}\\,L_{0}^{3}\\,\\int_{\\Omega} f_{\\mathrm{PFC}}\\,\\mathrm{d}\\mathbf{r} = E_{0}\\,L_{0}^{3}\\,F_{\\mathrm{PFC}}\n$$\n这种尺度关系适用于任何总自由能，包括界面的过剩自由能$F_{\\mathrm{excess}}$。因此：\n$$\nF_{\\mathrm{excess}}^{\\mathrm{phys}} = E_{0}\\,L_{0}^{3}\\,F_{\\mathrm{excess}}^{\\mathrm{PFC}}\n$$\n界面面积也通过长度尺度$L_{0}$相关联。对于一个平面界面，物理面积$A_{\\mathrm{phys}}$和无量纲面积$A_{\\mathrm{PFC}}$通过以下关系相关联：\n$$\nA_{\\mathrm{phys}} = L_{0}^{2}\\,A_{\\mathrm{PFC}}\n$$\n现在我们可以写出物理界面能$\\gamma_{sl}^{\\mathrm{phys}}$：\n$$\n\\gamma_{sl}^{\\mathrm{phys}} = \\frac{F_{\\mathrm{excess}}^{\\mathrm{phys}}}{A_{\\mathrm{phys}}} = \\frac{E_{0}\\,L_{0}^{3}\\,F_{\\mathrm{excess}}^{\\mathrm{PFC}}}{L_{0}^{2}\\,A_{\\mathrm{PFC}}}\n$$\n化简此表达式可得：\n$$\n\\gamma_{sl}^{\\mathrm{phys}} = E_{0}\\,L_{0}\\,\\left(\\frac{F_{\\mathrm{excess}}^{\\mathrm{PFC}}}{A_{\\mathrm{PFC}}}\\right)\n$$\n括号中的项是无量纲 PFC 界面能$\\gamma_{sl}^{\\mathrm{PFC}}$的定义。这给出了我们的第二个尺度关系：\n$$\n\\gamma_{sl}^{\\mathrm{phys}} = E_{0}\\,L_{0}\\,\\gamma_{sl}^{\\mathrm{PFC}} \\quad (2)\n$$\n这个关系在量纲上也是一致的。$\\gamma_{sl}^{\\mathrm{phys}}$的单位是能量/面积（例如$\\mathrm{J}/\\mathrm{m}^{2}$），$E_{0}$是能量/体积，$L_{0}$是长度，而$\\gamma_{sl}^{\\mathrm{PFC}}$是无量纲的。乘积$(E_{0}\\,L_{0})$的单位是$(\\mathrm{J}/\\mathrm{m}^{3})\\cdot\\mathrm{m} = \\mathrm{J}/\\mathrm{m}^{2}$。\n\n推导出这两个尺度关系后，我们现在可以使用提供的数值数据来求出$E_{0}$和$L_{0}$。数据如下：\n- $C_{11}^{\\mathrm{phys}} = 185 \\times 10^{9}\\ \\mathrm{Pa} = 185 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}$\n- $\\gamma_{sl}^{\\mathrm{phys}} = 0.200\\ \\mathrm{J}/\\mathrm{m}^{2}$\n- $C_{11}^{\\mathrm{PFC}} = 37.0$\n- $\\gamma_{sl}^{\\mathrm{PFC}} = 0.250$\n\n根据关系式 (1)，我们可以解出$E_{0}$：\n$$\nE_{0} = \\frac{C_{11}^{\\mathrm{phys}}}{C_{11}^{\\mathrm{PFC}}} = \\frac{185 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}}{37.0} = 5.0 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}\n$$\n题目要求四舍五入到四位有效数字。由于结果是一个精确整数，我们将其表示为：\n$$\nE_{0} = 5.000 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}\n$$\n\n现在，使用关系式 (2)，我们可以解出$L_{0}$：\n$$\nL_{0} = \\frac{\\gamma_{sl}^{\\mathrm{phys}}}{E_{0}\\,\\gamma_{sl}^{\\mathrm{PFC}}}\n$$\n代入已知值：\n$$\nL_{0} = \\frac{0.200\\ \\mathrm{J}/\\mathrm{m}^{2}}{\\left(5.000 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}\\right) \\times 0.250}\n$$\n首先，计算分母：\n$$\nE_{0}\\,\\gamma_{sl}^{\\mathrm{PFC}} = (5.000 \\times 10^{9}) \\times 0.250 = 1.250 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}\n$$\n然后，进行除法运算：\n$$\nL_{0} = \\frac{0.200}{1.250 \\times 10^{9}}\\ \\mathrm{m} = 0.16 \\times 10^{-9}\\ \\mathrm{m} = 1.6 \\times 10^{-10}\\ \\mathrm{m}\n$$\n按要求四舍五入到四位有效数字：\n$$\nL_{0} = 1.600 \\times 10^{-10}\\ \\mathrm{m}\n$$\n确定的尺度因子为$E_{0} = 5.000 \\times 10^{9}\\ \\mathrm{J}/\\mathrm{m}^{3}$和$L_{0} = 1.600 \\times 10^{-10}\\ \\mathrm{m}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.000 \\times 10^{9}  & 1.600 \\times 10^{-10}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}