{
    "hands_on_practices": [
        {
            "introduction": "本练习是掌握攀爬像微扰弹性带（CI-NEB）方法的基础。通过在一个简化的二维势能面上手动执行一个完整的攀爬像更新步骤，你将亲身体验力如何被分解为平行和垂直分量，以及“攀爬”修正如何精确地驱动能量最高的构像（像）沿能量梯度上升，最终朝向过渡态鞍点。这个练习  对于理解算法的底层数学和物理原理至关重要。",
            "id": "3437606",
            "problem": "考虑一个二维势能面，作为扩散势垒的简化模型，由标量场 $V(x,y) = (x^{2} - 1)^{2} + y^{2}$ 定义，单位为电子伏特 (eV)。两个极小值点位于 $(-1,0)$ 和 $(1,0)$，由一个位于 $(0,0)$ 的一阶鞍点分隔。极小值点之间的一条离散路径由五个映像点 $\\{\\mathbf{r}_{0},\\mathbf{r}_{1},\\mathbf{r}_{2},\\mathbf{r}_{3},\\mathbf{r}_{4}\\}$ 表示，其固定端点为 $\\mathbf{r}_{0} = (-1,0)$ 和 $\\mathbf{r}_{4} = (1,0)$，当前的内部位置为\n$\\mathbf{r}_{1} = (-0.4, 0.2)$、$\\mathbf{r}_{2} = (0.0, 0.1)$ 和 $\\mathbf{r}_{3} = (0.3, -0.1)$。\n您需要从第一性原理和核心定义出发，对能量最高的映像点执行一次微动弹性带方法的爬山映像点变体（Climbing-Image Nudged Elastic Band, CI-NEB）的迭代。\n\n假设以下建模条件：\n- 内部映像点 $i$ 处的路径切线是通过归一化连接其两个相邻点的弦向量得到的单位向量，$\\hat{\\boldsymbol{\\tau}}_{i} = \\dfrac{\\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}}{\\lVert \\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}\\rVert}$。\n- 由势能产生的真实力为 $-\\nabla V$。\n- 平行和垂直于单位方向 $\\hat{\\boldsymbol{\\tau}}$ 的矢量分量通过正交投影定义：对于任意矢量 $\\mathbf{A}$，$\\mathbf{A}^{\\parallel} = (\\mathbf{A}\\cdot \\hat{\\boldsymbol{\\tau}})\\hat{\\boldsymbol{\\tau}}$ 且 $\\mathbf{A}^{\\perp} = \\mathbf{A} - \\mathbf{A}^{\\parallel}$。\n\n将具有最高势能的内部映像点视为爬山映像点。对于该映像点，构建真实力的平行和垂直分量，并根据方法的定义应用爬山映像点修正。然后使用步长参数 $h = 0.5$ 对爬山映像点执行单次显式欧拉位置更新：\n$\\mathbf{r}_{i}^{\\text{new}} = \\mathbf{r}_{i}^{\\text{old}} + h\\,\\mathbf{F}_{i}^{\\text{CI}}$，\n其中 $\\mathbf{F}_{i}^{\\text{CI}}$ 是您根据上述原理构建的总爬山映像点力。\n\n从给定的位置开始，对能量最高的映像点 $i$ 执行以下步骤：\n1. 通过计算内部映像点的势能 $V(\\mathbf{r}_{i})$，确定爬山映像点的索引 $i$。\n2. 根据其相邻点计算切线 $\\hat{\\boldsymbol{\\tau}}_{i}$。\n3. 在 $\\mathbf{r}_{i}$ 处计算梯度 $\\nabla V$，然后使用上述投影定义将真实力 $-\\nabla V$ 分解为 $\\mathbf{F}_{i}^{\\parallel}$ 和 $\\mathbf{F}_{i}^{\\perp}$。\n4. 根据爬山映像点修正，为该映像点构建爬山映像点力 $\\mathbf{F}_{i}^{\\text{CI}}$。\n5. 使用给定的欧拉步长更新爬山映像点的位置。\n6. 计算更新后的能量 $V(\\mathbf{r}_{i}^{\\text{new}})$。\n\n报告爬山映像点更新后的能量 $V(\\mathbf{r}_{i}^{\\text{new}})$（单位 eV）作为您的最终答案。将您的答案四舍五入到四位有效数字。最终能量以 eV 表示。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤1：提取已知条件\n-   势能面：$V(x,y) = (x^{2} - 1)^{2} + y^{2}$，单位为电子伏特 (eV)。\n-   离散路径映像点：$\\{\\mathbf{r}_{0},\\mathbf{r}_{1},\\mathbf{r}_{2},\\mathbf{r}_{3},\\mathbf{r}_{4}\\}$。\n-   固定端点：$\\mathbf{r}_{0} = (-1,0)$，$\\mathbf{r}_{4} = (1,0)$。\n-   内部映像点位置：$\\mathbf{r}_{1} = (-0.4, 0.2)$，$\\mathbf{r}_{2} = (0.0, 0.1)$，$\\mathbf{r}_{3} = (0.3, -0.1)$。\n-   路径切线定义：$\\hat{\\boldsymbol{\\tau}}_{i} = \\dfrac{\\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}}{\\lVert \\mathbf{r}_{i+1} - \\mathbf{r}_{i-1}\\rVert}$。\n-   真实力定义：$-\\nabla V$。\n-   力分量定义：$\\mathbf{A}^{\\parallel} = (\\mathbf{A}\\cdot \\hat{\\boldsymbol{\\tau}})\\hat{\\boldsymbol{\\tau}}$ 且 $\\mathbf{A}^{\\perp} = \\mathbf{A} - \\mathbf{A}^{\\parallel}$。\n-   爬山映像点识别：具有最高势能的内部映像点。\n-   位置更新规则：$\\mathbf{r}_{i}^{\\text{new}} = \\mathbf{r}_{i}^{\\text{old}} + h\\,\\mathbf{F}_{i}^{\\text{CI}}$。\n-   步长参数：$h = 0.5$。\n-   目标：计算爬山映像点更新后的能量 $V(\\mathbf{r}_{i}^{\\text{new}})$，并四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题描述了爬山映像点微动弹性带 (CI-NEB) 方法，这是一种在计算化学和材料科学中用于寻找过渡态的标准且广泛使用的算法。势能 $V(x,y)$ 是一个经典的双阱势，是此类问题的常用模型系统。切线、力以及更新规则的定义与 CI-NEB 方法的既定公式一致。该问题具有科学合理性。\n-   **适定性**：所有必要信息均已提供：势能函数、所有映像点的初始坐标、所有计算量（切线、力）的定义，以及更新步骤的参数 ($h$)。目标陈述清晰，可利用给定数据实现。问题是自洽且明确的。\n-   **客观性**：问题以精确的数学语言表述，不含主观或基于观点的陈述。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将按照规定的步骤提供解答。\n\n解答过程遵循问题陈述中概述的六个步骤。\n\n**1. 确定爬山映像点**\n为每个内部映像点 $\\mathbf{r}_i = (x_i, y_i)$ 计算势能 $V(\\mathbf{r}_i)$。\n势能函数为 $V(x,y) = (x^{2} - 1)^{2} + y^{2}$。\n\n对于映像点 $\\mathbf{r}_{1} = (-0.4, 0.2)$：\n$$V(\\mathbf{r}_{1}) = ((-0.4)^{2} - 1)^{2} + (0.2)^{2} = (0.16 - 1)^{2} + 0.04 = (-0.84)^{2} + 0.04 = 0.7056 + 0.04 = 0.7456 \\, \\text{eV}$$\n\n对于映像点 $\\mathbf{r}_{2} = (0.0, 0.1)$：\n$$V(\\mathbf{r}_{2}) = ((0.0)^{2} - 1)^{2} + (0.1)^{2} = (-1)^{2} + 0.01 = 1 + 0.01 = 1.01 \\, \\text{eV}$$\n\n对于映像点 $\\mathbf{r}_{3} = (0.3, -0.1)$：\n$$V(\\mathbf{r}_{3}) = ((0.3)^{2} - 1)^{2} + (-0.1)^{2} = (0.09 - 1)^{2} + 0.01 = (-0.91)^{2} + 0.01 = 0.8281 + 0.01 = 0.8381 \\, \\text{eV}$$\n\n比较能量，$V(\\mathbf{r}_2) > V(\\mathbf{r}_3) > V(\\mathbf{r}_1)$。势能最高的映像点是 $\\mathbf{r}_{2}$。因此，爬山映像点是映像点 $i=2$。\n\n**2. 计算切线 $\\hat{\\boldsymbol{\\tau}}_{2}$**\n$\\mathbf{r}_2$ 处的切线由其相邻点 $\\mathbf{r}_1$ 和 $\\mathbf{r}_3$ 确定。\n$$\\mathbf{r}_{3} - \\mathbf{r}_{1} = (0.3 - (-0.4), -0.1 - 0.2) = (0.7, -0.3)$$\n该向量的范数为：\n$$\\lVert \\mathbf{r}_{3} - \\mathbf{r}_{1} \\rVert = \\sqrt{(0.7)^{2} + (-0.3)^{2}} = \\sqrt{0.49 + 0.09} = \\sqrt{0.58}$$\n单位切向量为：\n$$\\hat{\\boldsymbol{\\tau}}_{2} = \\frac{\\mathbf{r}_{3} - \\mathbf{r}_{1}}{\\lVert \\mathbf{r}_{3} - \\mathbf{r}_{1} \\rVert} = \\frac{1}{\\sqrt{0.58}}(0.7, -0.3)$$\n\n**3. 计算梯度并分解真实力**\n势能 $V(x,y) = (x^2-1)^2+y^2 = x^4-2x^2+1+y^2$ 的梯度为：\n$$\\nabla V = \\left( \\frac{\\partial V}{\\partial x}, \\frac{\\partial V}{\\partial y} \\right) = (4x^{3} - 4x, 2y)$$\n在爬山映像点的位置 $\\mathbf{r}_{2} = (0.0, 0.1)$ 处：\n$$\\nabla V |_{\\mathbf{r}_2} = (4(0.0)^{3} - 4(0.0), 2(0.1)) = (0, 0.2)$$\n真实力为 $\\mathbf{F}_{\\text{true}} = -\\nabla V |_{\\mathbf{r}_2}$：\n$$\\mathbf{F}_{\\text{true}} = (0, -0.2)$$\n该力被分解为平行于切线 $\\hat{\\boldsymbol{\\tau}}_{2}$ 的分量（$\\mathbf{F}_{2}^{\\parallel}$）和垂直于切线的分量（$\\mathbf{F}_{2}^{\\perp}$）。下一步我们只需要平行分量。\n$$\\mathbf{F}_{2}^{\\parallel} = (\\mathbf{F}_{\\text{true}} \\cdot \\hat{\\boldsymbol{\\tau}}_{2}) \\hat{\\boldsymbol{\\tau}}_{2}$$\n首先，计算点积：\n$$\\mathbf{F}_{\\text{true}} \\cdot \\hat{\\boldsymbol{\\tau}}_{2} = (0, -0.2) \\cdot \\frac{1}{\\sqrt{0.58}}(0.7, -0.3) = \\frac{1}{\\sqrt{0.58}} [0 \\cdot (0.7) + (-0.2) \\cdot (-0.3)] = \\frac{0.06}{\\sqrt{0.58}}$$\n现在，构建平行力向量：\n$$\\mathbf{F}_{2}^{\\parallel} = \\left(\\frac{0.06}{\\sqrt{0.58}}\\right) \\left(\\frac{1}{\\sqrt{0.58}}(0.7, -0.3)\\right) = \\frac{0.06}{0.58}(0.7, -0.3) = \\frac{6}{58}(0.7, -0.3) = \\frac{3}{29}(0.7, -0.3)$$\n$$\\mathbf{F}_{2}^{\\parallel} = \\left(\\frac{2.1}{29}, -\\frac{0.9}{29}\\right)$$\n\n**4. 构建爬山映像点力 $\\mathbf{F}_{2}^{\\text{CI}}$**\n对于爬山映像点，修正力以移除沿切线方向的弹簧力分量，并反转沿切线方向的真实力分量，从而驱动映像点沿势能面攀升至鞍点。该力由 $\\mathbf{F}_{i}^{\\text{CI}} = \\mathbf{F}_{\\text{true}} - 2 \\mathbf{F}_{i}^{\\parallel}$ 给出。\n$$\\mathbf{F}_{2}^{\\text{CI}} = (0, -0.2) - 2 \\left(\\frac{2.1}{29}, -\\frac{0.9}{29}\\right) = (0, -0.2) - \\left(\\frac{4.2}{29}, -\\frac{1.8}{29}\\right)$$\n$$\\mathbf{F}_{2}^{\\text{CI}} = \\left(-\\frac{4.2}{29}, -0.2 + \\frac{1.8}{29}\\right) = \\left(-\\frac{4.2}{29}, -\\frac{5.8}{29} + \\frac{1.8}{29}\\right) = \\left(-\\frac{4.2}{29}, -\\frac{4.0}{29}\\right)$$\n\n**5. 更新爬山映像点的位置**\n使用显式欧拉步长法，$h=0.5$，更新位置。\n$$\\mathbf{r}_{2}^{\\text{new}} = \\mathbf{r}_{2}^{\\text{old}} + h\\,\\mathbf{F}_{2}^{\\text{CI}}$$\n$$\\mathbf{r}_{2}^{\\text{new}} = (0.0, 0.1) + 0.5 \\left(-\\frac{4.2}{29}, -\\frac{4.0}{29}\\right) = (0, 0.1) + \\left(-\\frac{2.1}{29}, -\\frac{2.0}{29}\\right)$$\n新坐标为：\n$$x_{2}^{\\text{new}} = -\\frac{2.1}{29}$$\n$$y_{2}^{\\text{new}} = 0.1 - \\frac{2.0}{29} = \\frac{1}{10} - \\frac{2}{29} = \\frac{29 - 20}{290} = \\frac{9}{290}$$\n所以，新位置为 $\\mathbf{r}_{2}^{\\text{new}} = \\left(-\\frac{2.1}{29}, \\frac{9}{290}\\right)$。\n\n**6. 计算更新后的能量 $V(\\mathbf{r}_{2}^{\\text{new}})$**\n计算新位置的能量：\n$$V(\\mathbf{r}_{2}^{\\text{new}}) = \\left( \\left(x_{2}^{\\text{new}}\\right)^{2} - 1 \\right)^{2} + \\left(y_{2}^{\\text{new}}\\right)^{2}$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) = \\left( \\left(-\\frac{2.1}{29}\\right)^{2} - 1 \\right)^{2} + \\left(\\frac{9}{290}\\right)^{2}$$\n数值计算各项：\n$$x_{2}^{\\text{new}} = -\\frac{2.1}{29} \\approx -0.07241379$$\n$$y_{2}^{\\text{new}} = \\frac{9}{290} \\approx 0.03103448$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx ((-0.07241379)^{2} - 1)^{2} + (0.03103448)^{2}$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx (0.00524376 - 1)^{2} + 0.00096314$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx (-0.99475624)^{2} + 0.00096314$$\n$$V(\\mathbf{r}_{2}^{\\text{new}}) \\approx 0.98954002 + 0.00096314 = 0.99050316 \\, \\text{eV}$$\n将结果四舍五入至四位有效数字，得到 $0.9905$。",
            "answer": "$$\n\\boxed{0.9905}\n$$"
        },
        {
            "introduction": "在掌握了基本力学之后，我们来探讨一个更精细但至关重要的方面：路径切线的定义。NEB方法的准确性和稳定性在很大程度上取决于如何估计离散路径的局部切线方向。这个练习  将通过一个具体的“扭结”路径构型，展示朴素的切线定义为何可能导致计算失败，并让你定量地计算和理解一个考虑能量权重的改进切线如何提供更稳定、更物理的路径描述。",
            "id": "3845749",
            "problem": "考虑在微动弹性带 (Nudged Elastic Band, NEB) 方法及其爬山像 (Climbing-Image Nudged Elastic Band, CI-NEB) 改进方法的背景下，势能面上的一条离散化路径。三个连续的像点位于位置 $\\mathbf{R}_{i-1}$、$\\mathbf{R}_{i}$、$\\mathbf{R}_{i+1}$，其相应的能量为 $E_{i-1}$、$E_{i}$、$E_{i+1}$。在 NEB 和 CI-NEB 中，每个像点上的力被分解为平行于和垂直于离散路径切线方向 $\\hat{\\tau}_{i}$ 的分量。在尖角处（相邻路径段之间的方向变化很大），不恰当的切线定义可能导致错误的力分解。\n\n给定以下旨在在像点 $i$ 处产生一个尖角的特定构型：\n- 二维坐标：$\\mathbf{R}_{i-1} = (1, 2)$，$\\mathbf{R}_{i} = (3, 1)$，$\\mathbf{R}_{i+1} = (4, 3)$。\n- 能量：$E_{i-1} = 0.38\\,\\mathrm{eV}$，$E_{i} = 0.55\\,\\mathrm{eV}$，$E_{i+1} = 0.52\\,\\mathrm{eV}$。\n\n定义前向差分向量为 $\\Delta \\mathbf{R}_{i}^{+} = \\mathbf{R}_{i+1} - \\mathbf{R}_{i}$，后向差分向量为 $\\Delta \\mathbf{R}_{i}^{-} = \\mathbf{R}_{i} - \\mathbf{R}_{i-1}$。令相应的单位切向量为 $\\hat{\\tau}_{i}^{+} = \\Delta \\mathbf{R}_{i}^{+} / \\|\\Delta \\mathbf{R}_{i}^{+}\\|$ 和 $\\hat{\\tau}_{i}^{-} = \\Delta \\mathbf{R}_{i}^{-} / \\|\\Delta \\mathbf{R}_{i}^{-}\\|.$。\n\n首先，计算 $\\hat{\\tau}_{i}^{+}$ 和 $\\hat{\\tau}_{i}^{-}$ 之间的夹角 $\\theta_{\\mathrm{fb}}$。\n\n接下来，在尖角像点 $i$ 处构建一个能量加权切线，该切线是通过对前向和后向单位切向量进行归一化线性组合得到的，其权重与到相邻像点的绝对能量差成正比：\n- $w^{+} = |E_{i+1} - E_{i}|$，\n- $w^{-} = |E_{i-1} - E_{i}|$，\n并定义未归一化的加权切向量 $\\mathbf{t}_{w} = w^{+}\\,\\hat{\\tau}_{i}^{+} + w^{-}\\,\\hat{\\tau}_{i}^{-}$ 和相应的单位向量 $\\hat{\\tau}_{w} = \\mathbf{t}_{w} / \\|\\mathbf{t}_{w}\\|$。\n\n使用这个能量加权切线，计算 $\\hat{\\tau}_{w}$ 和 $\\hat{\\tau}_{i}^{-}$ 之间的夹角 $\\theta_{w-}$。将减小的角度 $\\Delta \\theta = \\theta_{\\mathrm{fb}} - \\theta_{w-}$ 解读为能量加权在用于 NEB 力分解的切线方向上引入的平滑度的定量度量。\n\n您的任务是为给定的构型提供标量值 $\\Delta \\theta$。最终结果用弧度表示，并四舍五入到四位有效数字。请清楚地陈述从离散切线和能量加权的基本定义到最终得出 $\\Delta \\theta$ 的步骤。",
            "solution": "微动弹性带 (Nudged Elastic Band, NEB) 方法及其爬山像 (Climbing-Image Nudged Elastic Band, CI-NEB) 改进方法通过弛豫一组由弹簧连接的离散像点来计算势能面上的最小能量路径。像点 $i$ 上的力被分解为垂直于和平行于切线 $\\hat{\\tau}_{i}$ 的分量，该切线近似于局部路径方向。在尖角处，使用朴素的切线可能导致力的错误投影；能量加权切线通过将切线偏向极值点附近能量较高的路径段来缓解此问题，从而提供一个更平滑且物理上一致的方向。\n\n我们从离散的前向和后向差分切线的基本定义开始。对于给定的位置，\n\n$$\n\\Delta \\mathbf{R}_{i}^{+} = \\mathbf{R}_{i+1} - \\mathbf{R}_{i} = (4, 3) - (3, 1) = (1, 2),\n$$\n\n\n$$\n\\Delta \\mathbf{R}_{i}^{-} = \\mathbf{R}_{i} - \\mathbf{R}_{i-1} = (3, 1) - (1, 2) = (2, -1).\n$$\n\n它们的模是\n\n$$\n\\|\\Delta \\mathbf{R}_{i}^{+}\\| = \\sqrt{1^{2} + 2^{2}} = \\sqrt{5}, \\quad \\|\\Delta \\mathbf{R}_{i}^{-}\\| = \\sqrt{2^{2} + (-1)^{2}} = \\sqrt{5}.\n$$\n\n因此，单位切向量为\n\n$$\n\\hat{\\tau}_{i}^{+} = \\frac{(1, 2)}{\\sqrt{5}}, \\quad \\hat{\\tau}_{i}^{-} = \\frac{(2, -1)}{\\sqrt{5}}.\n$$\n\n$\\hat{\\tau}_{i}^{+}$ 与 $\\hat{\\tau}_{i}^{-}$ 之间的夹角 $\\theta_{\\mathrm{fb}}$ 可由点积公式得出\n\n$$\n\\hat{\\tau}_{i}^{+} \\cdot \\hat{\\tau}_{i}^{-} = \\|\\hat{\\tau}_{i}^{+}\\|\\,\\|\\hat{\\tau}_{i}^{-}\\|\\,\\cos(\\theta_{\\mathrm{fb}}) = \\cos(\\theta_{\\mathrm{fb}}).\n$$\n\n计算点积：\n\n$$\n\\hat{\\tau}_{i}^{+} \\cdot \\hat{\\tau}_{i}^{-} = \\frac{1}{\\sqrt{5}}\\frac{2}{\\sqrt{5}} + \\frac{2}{\\sqrt{5}}\\frac{(-1)}{\\sqrt{5}} = \\frac{2 - 2}{5} = 0,\n$$\n\n所以\n\n$$\n\\cos(\\theta_{\\mathrm{fb}}) = 0 \\quad \\Rightarrow \\quad \\theta_{\\mathrm{fb}} = \\frac{\\pi}{2}.\n$$\n\n这证实了前向和后向离散切线之间存在一个直角，即一个尖角。\n\n我们现在推导能量加权切线。能量为\n\n$$\nE_{i-1} = 0.38\\,\\mathrm{eV}, \\quad E_{i} = 0.55\\,\\mathrm{eV}, \\quad E_{i+1} = 0.52\\,\\mathrm{eV}.\n$$\n\n绝对能量差为\n\n$$\nw^{+} = |E_{i+1} - E_{i}| = |0.52 - 0.55| = 0.03,\n$$\n\n\n$$\nw^{-} = |E_{i-1} - E_{i}| = |0.38 - 0.55| = 0.17.\n$$\n\n定义未归一化的加权切向量\n\n$$\n\\mathbf{t}_{w} = w^{+}\\,\\hat{\\tau}_{i}^{+} + w^{-}\\,\\hat{\\tau}_{i}^{-}.\n$$\n\n因为 $\\hat{\\tau}_{i}^{+}$ 和 $\\hat{\\tau}_{i}^{-}$ 是单位向量且相互正交（如其点积为零所示），$\\mathbf{t}_{w}$ 的模为\n\n$$\n\\|\\mathbf{t}_{w}\\| = \\sqrt{(w^{+})^{2}\\|\\hat{\\tau}_{i}^{+}\\|^{2} + (w^{-})^{2}\\|\\hat{\\tau}_{i}^{-}\\|^{2}} = \\sqrt{(w^{+})^{2} + (w^{-})^{2}} = \\sqrt{0.03^{2} + 0.17^{2}} = \\sqrt{0.0298}.\n$$\n\n那么单位能量加权切线为\n\n$$\n\\hat{\\tau}_{w} = \\frac{\\mathbf{t}_{w}}{\\|\\mathbf{t}_{w}\\|}.\n$$\n\n我们要求解 $\\hat{\\tau}_{w}$ 和 $\\hat{\\tau}_{i}^{-}$ 之间的夹角 $\\theta_{w-}$。使用点积，\n\n$$\n\\cos(\\theta_{w-}) = \\hat{\\tau}_{w} \\cdot \\hat{\\tau}_{i}^{-} = \\frac{\\mathbf{t}_{w}}{\\|\\mathbf{t}_{w}\\|} \\cdot \\hat{\\tau}_{i}^{-} = \\frac{w^{+}(\\hat{\\tau}_{i}^{+} \\cdot \\hat{\\tau}_{i}^{-}) + w^{-}(\\hat{\\tau}_{i}^{-} \\cdot \\hat{\\tau}_{i}^{-})}{\\|\\mathbf{t}_{w}\\|}.\n$$\n\n由于 $\\hat{\\tau}_{i}^{+} \\cdot \\hat{\\tau}_{i}^{-} = 0$ 且 $\\hat{\\tau}_{i}^{-} \\cdot \\hat{\\tau}_{i}^{-} = 1$，上式可简化为\n\n$$\n\\cos(\\theta_{w-}) = \\frac{w^{-}}{\\sqrt{(w^{+})^{2} + (w^{-})^{2}}}.\n$$\n\n等价地，利用正交性，该角度可以表示为\n\n$$\n\\theta_{w-} = \\arctan\\!\\left(\\frac{w^{+}}{w^{-}}\\right) = \\arctan\\!\\left(\\frac{0.03}{0.17}\\right) = \\arctan\\!\\left(\\frac{3}{17}\\right).\n$$\n\n这个表达式的由来是因为 $\\mathbf{t}_{w}$ 可以在正交基 $\\{\\hat{\\tau}_{i}^{-}, \\hat{\\tau}_{i}^{+}\\}$ 中表示为分量 $(w^{-}, w^{+})$，因此其与 $\\hat{\\tau}_{i}^{-}$ 轴的夹角是 $\\arctan(w^{+}/w^{-})$。\n\n由能量加权引起的角度减小量，它量化了用于力分解的切线方向上的平滑程度，为\n\n$$\n\\Delta \\theta = \\theta_{\\mathrm{fb}} - \\theta_{w-} = \\frac{\\pi}{2} - \\arctan\\!\\left(\\frac{3}{17}\\right).\n$$\n\n我们现在对此量进行数值计算，并以弧度为单位四舍五入到四位有效数字。首先，计算\n\n$$\n\\arctan\\!\\left(\\frac{3}{17}\\right) \\approx 0.1746731751\\,\\text{rad},\n$$\n\n所以\n\n$$\n\\Delta \\theta \\approx \\frac{\\pi}{2} - 0.1746731751 \\approx 1.3961231517\\,\\text{rad}.\n$$\n\n四舍五入到四位有效数字，所求值为\n\n$$\n\\Delta \\theta \\approx 1.396\\,\\text{rad}.\n$$\n\n这表明能量加权切线将尖角从 $\\pi/2$ 大幅减小到相对于主导路径段（偏向能量差较大的一侧）的一个小角度，从而平滑了在 CI-NEB 力分解中使用的切线方向。",
            "answer": "$$\\boxed{1.396}$$"
        },
        {
            "introduction": "最后，我们将视角从单个“像”的物理计算扩展到整个反应路径的有效计算。实际的CI-NEB模拟通常涉及大量构像和复杂的势能面，计算成本高昂，因此必须在高性能计算集群上并行执行。这个练习  深入探讨了该方法的计算科学层面，要求你分析不同的并行化方案（即将构像分布到多个处理器上）如何影响节点间的通信开销，这是决定大规模模拟效率的关键。",
            "id": "3845801",
            "problem": "考虑在微动弹性带 (Nudged Elastic Band, NEB) 方法及其变体爬山微动弹性带 (Climbing-Image Nudged Elastic Band, CI-NEB) 中的一个离散化过渡路径，该路径由一系列映象（构型）$\\{\\mathbf{r}_i\\}_{i=0}^{N-1}$ 表示，其中 $N \\geq 2$，端点 $i=0$ 和 $i=N-1$ 固定，内部映象为 $i \\in \\{1,\\dots,N-2\\}$。每个映象 $i$ 有一个位置向量 $\\mathbf{r}_i \\in \\mathbb{R}^d$，具有 $d \\geq 1$ 个自由度，以及一个标量能量 $E_i \\in \\mathbb{R}$。映象 $i$ 的弹簧力取决于其相邻映象 $\\mathbf{r}_{i-1}$ 和 $\\mathbf{r}_{i+1}$ 的位置，而映象 $i$ 处的切线取决于相邻能量 $E_{i-1}$ 和 $E_{i+1}$ 的相对顺序。在爬山微动弹性带 (CI-NEB) 方法中，能量最高的映象会修改其力的投影，但计算弹簧力和切线时对相邻映象的数据依赖性仍然是局部的，并且仅限于最近邻。\n\n假设一个分布式内存并行计算环境，有 $P \\geq 1$ 个计算节点，以及一个分配映射 $a:\\{0,\\dots,N-1\\} \\rightarrow \\{0,\\dots,P-1\\}$，该映射将每个映象索引 $i$ 映射到拥有它的节点 $a(i)$。仅当 $a(j) \\neq a(j+1)$ 且 $j$ 或 $j+1$ 中至少有一个是内部映象索引时，才需要在相邻映象边界 $(j,j+1)$（其中 $j \\in \\{0,\\dots,N-2\\}$）上进行通信。对于 $N \\leq 2$ 的情况，没有内部映象，因此不需要通信。对于 $N \\geq 3$ 的情况，每个相邻边界 $(j,j+1)$ 都至少接触一个内部映象，因此任何跨节点的邻接都需要通信。\n\n我们考虑两种映象分布方案：\n\n- 连续块分布，记为 $\\mathcal{D}_\\text{contig}$：将索引集 $\\{0,\\dots,N-1\\}$ 划分为 $K=\\min(P,N)$ 个连续且大小近似相等的块，并将块 $k$ 分配给节点 $k$（其中 $k \\in \\{0,\\dots,K-1\\}$）。所有映象都只属于一个块，并且这些块连续无重叠地覆盖整个链。\n\n- 轮询分布，记为 $\\mathcal{D}_\\text{rr}$：对所有 $i \\in \\{0,\\dots,N-1\\}$，分配 $a(i)=i \\bmod P$。\n\n假设每次迭代进行一次最近邻“幽灵交换”（ghost-exchange），即对于每个跨节点的相邻边界 $(j,j+1)$，在每个方向上发送一条消息，其中包含邻居为其内部映象评估弹簧力和切线所需的最小有效载荷。假设每条消息的有效载荷包括邻居的位置向量 $\\mathbf{r}$ 和标量能量 $E$，均以双精度表示。每条消息的有效载荷大小为 $B_\\text{msg}=8(d+1)$ 字节，因为 $d$ 个位置分量和标量能量都是 $8$ 字节的双精度数。忽略报头和协议开销，每次迭代的总消息数为 $M=2C$，其中 $C$ 是至少接触一个内部映象的跨节点相邻边界的数量。那么每次迭代的总字节数为 $B = M \\cdot B_\\text{msg} = 2C \\cdot 8(d+1)$。\n\n你的任务是实现一个程序，对下面的每个测试用例计算：\n- 整数 $C$，即如上文所定义的需要通信的跨节点相邻边界的数量。\n- 整数 $M=2C$，即每次迭代的半双工消息数。\n- 整数 $B=2C \\cdot 8(d+1)$，即每次迭代通信的总字节数。\n\n要实现的分布方案细节：\n- 对于 $\\mathcal{D}_\\text{contig}$：令 $K=\\min(P,N)$，并令 $q=\\left\\lfloor \\frac{N}{K} \\right\\rfloor$ 和 $r=N \\bmod K$。前 $r$ 个节点接收 $q+1$ 个连续映象，其余 $K-r$ 个节点接收 $q$ 个连续映象，形成对 $\\{0,\\dots,N-1\\}$ 的连续划分。\n- 对于 $\\mathcal{D}_\\text{rr}$：对所有 $i$，令 $a(i)=i \\bmod P$。\n\n通信计数规则：\n- 如果 $N \\leq 2$，则设 $C=0$。\n- 如果 $N \\geq 3$，则设 $C$ 为满足 $a(j) \\neq a(j+1)$ 的索引 $j \\in \\{0,\\dots,N-2\\}$ 的数量。\n\n测试套件参数集 $(N,P,d,\\text{scheme})$：\n1. $(16,4,3,\\mathcal{D}_\\text{contig})$。\n2. $(16,4,3,\\mathcal{D}_\\text{rr})$。\n3. $(5,10,2,\\mathcal{D}_\\text{contig})$。\n4. $(2,5,3,\\mathcal{D}_\\text{rr})$。\n5. $(64,1,6,\\mathcal{D}_\\text{contig})$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例的结果是一个包含三个整数 $[C,M,B]$ 的列表，顺序与测试套件相同。例如，包含两个用例的输出将类似于 $[[C_1,M_1,B_1],[C_2,M_2,B_2]]$。",
            "solution": "用户旨在确定在两种不同的数据分布方案下，爬山微动弹性带 (Climbing-Image Nudged Elastic Band, CI-NEB) 方法并行实现的通信成本，具体包括跨节点边界数 $C$、消息数 $M$ 和总传输字节数 $B$。该问题定义明确，并基于高性能科学计算的标准实践。\n\n过渡路径被离散化为 $N$ 个映象，索引从 $i=0$ 到 $i=N-1$。这些映象分布在 $P$ 个计算节点上。映象 $i$ 到节点的分配由映射 $a(i) \\in \\{0, \\dots, P-1\\}$ 给出。每个映象的自由度由 $d$ 给出。\n\n所需的通信指标定义如下：\n- $C$：跨节点相邻边界的数量。问题规定，对于 $N \\leq 2$，没有内部映象，因此 $C=0$。对于 $N \\geq 3$，每个边界 $(j, j+1)$（其中 $j \\in \\{0, \\dots, N-2\\}$）都与至少一个内部映象相邻，因此当且仅当相邻映象位于不同节点上时才需要通信。因此，对于 $N \\geq 3$，$C$ 是满足 $a(j) \\neq a(j+1)$ 的索引 $j \\in \\{0, \\dots, N-2\\}$ 的数量。\n- $M$：每次迭代的总消息数。由于每个跨节点边界都需要一次“幽灵交换”（ghost-exchange）（每个方向一条消息），所以 $M = 2C$。\n- $B$：每次迭代通信的总字节数。每条消息的有效载荷由一个位置向量 $\\mathbf{r}_i \\in \\mathbb{R}^d$ 和一个标量能量 $E_i \\in \\mathbb{R}$ 组成，两者都表示为 $8$ 字节的双精度数。每条消息的大小为 $B_{\\text{msg}} = 8(d+1)$ 字节。总字节数为 $B = M \\cdot B_{\\text{msg}} = 2C \\cdot 8(d+1) = 16C(d+1)$。\n\n现在我们为每种分布方案推导 $C$ 的公式。\n\n**1. 连续块分布 ($\\mathcal{D}_\\text{contig}$)**\n\n在此方案中，$N$ 个映象被划分为 $K = \\min(P, N)$ 个连续块。前 $K$ 个节点（索引为 $0, \\dots, K-1$）各接收一个块。如果 $P > N$，剩余的 $P-K$ 个节点处于空闲状态。\n分配映射 $a(i)$ 是分段常数，仅在两个连续块的边界处改变值。共有 $K$ 个块，因此它们之间有 $K-1$ 个边界。这些边界中的每一个都分开了分配给不同节点（例如，节点 $k$ 和节点 $k+1$）的映象。\n因此，跨节点边界的数量 $C$ 就是块边界的数量。\n- 如果 $K=1$（当 $P=1$ 或 $N \\leq 1$ 时发生），所有映象都在单个节点上，没有块边界，所以 $C = 1-1=0$。\n- 如果 $K > 1$，则有 $K-1$ 个边界。\n\n结合关于 $N$ 的一般规则：\n- 如果 $N \\leq 2$，$C=0$。\n- 如果 $N \\geq 3$，$C = K-1 = \\min(P, N) - 1$。\n请注意，对于 $N=2$，该公式给出 $\\min(P,2)-1$，如果 $P \\geq 2$，该值可能为 $1$。因此，我们必须严格遵守 $N \\le 2$ 时 $C=0$ 的规则。推导出的公式 $C = \\min(P,N)-1$ 仅对 $N \\geq 3$ 有效。\n\n**2. 轮询分布 ($\\mathcal{D}_\\text{rr}$)**\n\n在此方案中，分配映射由 $a(i) = i \\bmod P$ 给出。我们需要计算满足 $a(j) \\neq a(j+1)$ 的索引 $j \\in \\{0, \\dots, N-2\\}$ 的数量。\n这等同于计算满足 $j \\bmod P \\neq (j+1) \\bmod P$ 的 $j$ 的数量。\n\n- 情况 $P=1$：对于任何映象 $i$，$a(i) = i \\bmod 1 = 0$。所有映象都分配给节点 $0$。因此，对所有 $j$ 都有 $a(j) = a(j+1)$，所以 $C=0$。\n\n- 情况 $P>1$：让我们考虑何时 $j \\bmod P = (j+1) \\bmod P$。设此公共值为 $k$。这意味着对于某些整数 $q_1, q_2$，有 $j = q_1 P + k$ 和 $j+1 = q_2 P + k$。用第二个方程减去第一个方程得到 $1 = (q_2 - q_1)P$。由于 $P$ 是大于 $1$ 的整数，此方程没有整数解 $(q_2-q_1)$。因此，对于 $P>1$，$j \\bmod P \\neq (j+1) \\bmod P$ 总是成立。\n这意味着对于 $P>1$，每对相邻映象 $(i, i+1)$ 都被分配到不同的节点对。\n跨节点边界的数量 $C$ 是映象之间相邻边界的总数，即 $N-1$。\n\n结合关于 $N$ 的一般规则：\n- 如果 $N \\leq 2$，$C=0$。\n- 如果 $N \\geq 3$：\n    - 如果 $P=1$，$C=0$。\n    - 如果 $P>1$，$C=N-1$。\n\n我们现在将这些推导出的公式应用于每个测试用例。\n\n**测试用例 1: $(N,P,d,\\text{scheme}) = (16, 4, 3, \\mathcal{D}_\\text{contig})$**\n- $N=16$, $P=4$, $d=3$。因为 $N=16 \\geq 3$，我们应用 $\\mathcal{D}_\\text{contig}$ 的公式：\n- $C = \\min(P, N) - 1 = \\min(4, 16) - 1 = 4 - 1 = 3$。\n- $M = 2C = 2 \\cdot 3 = 6$。\n- $B = 16 C (d+1) = 16 \\cdot 3 \\cdot (3+1) = 48 \\cdot 4 = 192$。\n- 结果: $[3, 6, 192]$。\n\n**测试用例 2: $(N,P,d,\\text{scheme}) = (16, 4, 3, \\mathcal{D}_\\text{rr})$**\n- $N=16$, $P=4$, $d=3$。因为 $N=16 \\geq 3$ 且 $P=4 > 1$，我们应用 $\\mathcal{D}_\\text{rr}$ 的公式：\n- $C = N - 1 = 16 - 1 = 15$。\n- $M = 2C = 2 \\cdot 15 = 30$。\n- $B = 16 C (d+1) = 16 \\cdot 15 \\cdot (3+1) = 240 \\cdot 4 = 960$。\n- 结果: $[15, 30, 960]$。\n\n**测试用例 3: $(N,P,d,\\text{scheme}) = (5, 10, 2, \\mathcal{D}_\\text{contig})$**\n- $N=5$, $P=10$, $d=2$。因为 $N=5 \\geq 3$，我们应用 $\\mathcal{D}_\\text{contig}$ 的公式：\n- $C = \\min(P, N) - 1 = \\min(10, 5) - 1 = 5 - 1 = 4$。\n- $M = 2C = 2 \\cdot 4 = 8$。\n- $B = 16 C (d+1) = 16 \\cdot 4 \\cdot (2+1) = 64 \\cdot 3 = 192$。\n- 结果: $[4, 8, 192]$。\n\n**测试用例 4: $(N,P,d,\\text{scheme}) = (2, 5, 3, \\mathcal{D}_\\text{rr})$**\n- $N=2$, $P=5$, $d=3$。因为 $N=2 \\leq 2$，规则规定不需要通信。\n- $C = 0$。\n- $M = 0$。\n- $B = 0$。\n- 结果: $[0, 0, 0]$。\n\n**测试用例 5: $(N,P,d,\\text{scheme}) = (64, 1, 6, \\mathcal{D}_\\text{contig})$**\n- $N=64$, $P=1$, $d=6$。因为 $N=64 \\geq 3$，我们应用 $\\mathcal{D}_\\text{contig}$ 的公式：\n- $C = \\min(P, N) - 1 = \\min(1, 64) - 1 = 1 - 1 = 0$。\n- $M = 2C = 0$。\n- $B = 16 C (d+1) = 0$。\n- 这是预期的，因为只有一个处理器（$P=1$）时，不可能存在跨节点通信。\n- 结果: $[0, 0, 0]$。",
            "answer": "[[3,6,192],[15,30,960],[4,8,192],[0,0,0],[0,0,0]]"
        }
    ]
}