{
    "hands_on_practices": [
        {
            "introduction": "Understanding how microscopic properties give rise to macroscopic phenomena is a central theme in materials science. This first practice provides a foundational link between the polarizability of individual molecules, $\\alpha$, and the bulk dielectric permittivity, $\\epsilon_r$. By working through the classic Lorentz local-field model, you will derive the celebrated Clausius-Mossotti relation and quantitatively assess the importance of local-field corrections compared to a naive mean-field approach .",
            "id": "3801742",
            "problem": "Consider a homogeneous, isotropic, non-conducting fluid composed of identical, non-interacting polarizable molecules at temperature low enough that thermal agitation does not alter the static linear response. Each molecule has a permanent dipole operator $\\hat{\\mathbf{d}}$ and a static molecular polarizability $\\alpha$ defined by linear response to a time-independent, spatially uniform external electric field. Model the interaction with the external field by the time-independent perturbation to the molecular Hamiltonian $\\hat{H} = \\hat{H}_{0} - \\hat{\\mathbf{d}} \\cdot \\mathbf{E}_{\\mathrm{loc}}$, and define the induced dipole moment by $\\mathbf{p} = \\alpha \\,\\mathbf{E}_{\\mathrm{loc}}$ in the static limit, where $\\mathbf{E}_{\\mathrm{loc}}$ is the local electric field experienced by a molecule.\n\nLet the bulk polarization be $\\mathbf{P} = N\\,\\mathbf{p}$, where $N$ is the number density of molecules, and the macroscopic constitutive relation be $\\mathbf{D} = \\epsilon_{0}\\,\\epsilon_{r}\\,\\mathbf{E}$, where $\\epsilon_{0}$ is the vacuum permittivity and $\\epsilon_{r}$ is the bulk relative permittivity. In an isotropic medium, use the spherical cavity construction for the local field and assume the Lorentz cavity result $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E} + \\mathbf{P}/(3\\,\\epsilon_{0})$.\n\nYou are given that each molecule can be modeled as a hard sphere of radius $r$ and occupies an exclusion volume $v_{m} = \\frac{4}{3}\\pi r^{3}$, and that the packing fraction $\\phi$ is defined by $\\phi = N\\,v_{m}$. The fluid has:\n- hard-sphere radius $r = 1.50 \\times 10^{-10}$ m,\n- packing fraction $\\phi = 0.40$,\n- static molecular polarizability $\\alpha = 1.00 \\times 10^{-40}$ F m$^{2}$.\n\nStarting from the above foundations, derive the self-consistent relationship between $\\epsilon_{r}$ and $N$ and $\\alpha$ implied by the presence of the local-field term, and contrast it with the naive mean-field relation obtained by ignoring the local-field correction (i.e., setting $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E}$ before coarse-graining). Then, using the provided parameters, compute the ratio of the corrected bulk relative permittivity to the uncorrected mean-field value. Round your final ratio to four significant figures. Express the answer as a dimensionless number (no units).",
            "solution": "The problem requires the derivation and comparison of two models for the bulk relative permittivity, $\\epsilon_r$, of a dielectric fluid, followed by a numerical calculation of their ratio. The first model incorporates the Lorentz local field correction, while the second, naive model, neglects it.\n\nThe analysis begins with the fundamental relationships provided for the material. The bulk polarization $\\mathbf{P}$ is the total dipole moment per unit volume, given by the product of the number density of molecules $N$ and the average induced dipole moment $\\mathbf{p}$ of a single molecule:\n$$\n\\mathbf{P} = N\\,\\mathbf{p}\n$$\nThe induced dipole moment $\\mathbf{p}$ is linearly proportional to the local electric field $\\mathbf{E}_{\\mathrm{loc}}$ that a molecule experiences, with the constant of proportionality being the static molecular polarizability $\\alpha$:\n$$\n\\mathbf{p} = \\alpha\\,\\mathbf{E}_{\\mathrm{loc}}\n$$\nCombining these two equations gives a direct relationship between the bulk polarization and the local field:\n$$\n\\mathbf{P} = N\\,\\alpha\\,\\mathbf{E}_{\\mathrm{loc}}\n$$\n\nFirst, we derive the corrected relative permittivity, $\\epsilon_{r, \\text{corr}}$, which accounts for the local field correction. The problem states that the local field is described by the Lorentz cavity model for an isotropic medium:\n$$\n\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E} + \\frac{\\mathbf{P}}{3\\,\\epsilon_{0}}\n$$\nwhere $\\mathbf{E}$ is the macroscopic electric field and $\\epsilon_{0}$ is the vacuum permittivity. Substituting this expression for $\\mathbf{E}_{\\mathrm{loc}}$ into the equation for $\\mathbf{P}$:\n$$\n\\mathbf{P} = N\\,\\alpha\\,\\left(\\mathbf{E} + \\frac{\\mathbf{P}}{3\\,\\epsilon_{0}}\\right)\n$$\nThis equation is a self-consistent relation for the polarization $\\mathbf{P}$. We can solve for $\\mathbf{P}$ in terms of the macroscopic field $\\mathbf{E}$:\n$$\n\\mathbf{P} - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\\,\\mathbf{P} = N\\,\\alpha\\,\\mathbf{E}\n$$\n$$\n\\mathbf{P}\\,\\left(1 - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\\right) = N\\,\\alpha\\,\\mathbf{E}\n$$\n$$\n\\mathbf{P} = \\frac{N\\,\\alpha}{1 - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}}\\,\\mathbf{E}\n$$\nThe macroscopic electric susceptibility $\\chi_e$ is defined by the constitutive relation $\\mathbf{P} = \\epsilon_{0}\\,\\chi_e\\,\\mathbf{E}$. Comparing this with our derived expression for $\\mathbf{P}$, we can identify the susceptibility for the corrected model, $\\chi_{e, \\text{corr}}$:\n$$\n\\epsilon_{0}\\,\\chi_{e, \\text{corr}} = \\frac{N\\,\\alpha}{1 - \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}} \\implies \\chi_{e, \\text{corr}} = \\frac{N\\,\\alpha/\\epsilon_{0}}{1 - N\\,\\alpha/(3\\,\\epsilon_{0})}\n$$\nThe bulk relative permittivity is related to the susceptibility by $\\epsilon_r = 1 + \\chi_e$. Therefore, the corrected permittivity is:\n$$\n\\epsilon_{r, \\text{corr}} = 1 + \\chi_{e, \\text{corr}} = 1 + \\frac{N\\,\\alpha/\\epsilon_{0}}{1 - N\\,\\alpha/(3\\,\\epsilon_{0})}\n$$\nAn equivalent and more common form is the Clausius-Mossotti relation, obtained by substituting the macroscopic relation $\\mathbf{P} = \\epsilon_0(\\epsilon_r - 1)\\mathbf{E}$ into the local field expression first. This gives $\\mathbf{E}_{\\mathrm{loc}} = (\\frac{\\epsilon_r+2}{3})\\mathbf{E}$. Substituting this into $\\mathbf{P} = N\\alpha\\mathbf{E}_{\\mathrm{loc}}$ yields $\\epsilon_0(\\epsilon_r-1)\\mathbf{E} = N\\alpha(\\frac{\\epsilon_r+2}{3})\\mathbf{E}$, which simplifies to the well-known form:\n$$\n\\frac{\\epsilon_{r, \\text{corr}} - 1}{\\epsilon_{r, \\text{corr}} + 2} = \\frac{N\\,\\alpha}{3\\,\\epsilon_{0}}\n$$\n\nNext, we derive the uncorrected, naive mean-field permittivity, $\\epsilon_{r, \\text{uncorr}}$. This model is obtained by ignoring the local field correction, which is equivalent to setting $\\mathbf{E}_{\\mathrm{loc}} = \\mathbf{E}$.\nIn this case, the induced dipole moment is simply $\\mathbf{p} = \\alpha\\,\\mathbf{E}$. The bulk polarization becomes:\n$$\n\\mathbf{P} = N\\,\\mathbf{p} = N\\,\\alpha\\,\\mathbf{E}\n$$\nComparing this directly with the definition $\\mathbf{P} = \\epsilon_{0}\\,\\chi_{e, \\text{uncorr}}\\,\\mathbf{E}$, we find the uncorrected susceptibility:\n$$\n\\chi_{e, \\text{uncorr}} = \\frac{N\\,\\alpha}{\\epsilon_{0}}\n$$\nThe uncorrected relative permittivity is therefore:\n$$\n\\epsilon_{r, \\text{uncorr}} = 1 + \\chi_{e, \\text{uncorr}} = 1 + \\frac{N\\,\\alpha}{\\epsilon_{0}}\n$$\nThe contrast between the two models is now clear. The naive model predicts a simple linear relationship between $(\\epsilon_r-1)$ and the number density $N$, whereas the Clausius-Mossotti relation shows a more complex, non-linear dependence that accounts for dipole-dipole interactions through the mean-field local field correction. The corrected model predicts a stronger dielectric response that can lead to a divergence (ferroelectric catastrophe) as the term $N\\alpha/(3\\epsilon_0)$ approaches $1$.\n\nTo compute the ratio of the two permittivities, we define the dimensionless quantity $Y = \\frac{N\\,\\alpha}{\\epsilon_{0}}$.\nIn terms of $Y$, the two permittivities are:\n$$\n\\epsilon_{r, \\text{uncorr}} = 1 + Y\n$$\n$$\n\\epsilon_{r, \\text{corr}} = \\frac{1 + 2\\,Y/3}{1 - Y/3} = \\frac{3+2Y}{3-Y}\n$$\nThe required ratio $R$ is:\n$$\nR = \\frac{\\epsilon_{r, \\text{corr}}}{\\epsilon_{r, \\text{uncorr}}} = \\frac{\\left(\\frac{3+2Y}{3-Y}\\right)}{1 + Y} = \\frac{3+2Y}{(1+Y)(3-Y)}\n$$\nWe must now calculate the numerical value of $Y$ using the provided data. The number density $N$ is not given directly but can be found from the packing fraction $\\phi$ and the hard-sphere radius $r$. The packing fraction is $\\phi = N\\,v_m$, where $v_m = \\frac{4}{3}\\pi r^3$ is the molecular volume.\n$$\nN = \\frac{\\phi}{v_m} = \\frac{\\phi}{\\frac{4}{3}\\pi r^3} = \\frac{3\\phi}{4\\pi r^3}\n$$\nSubstituting this into the expression for $Y$:\n$$\nY = \\frac{N\\,\\alpha}{\\epsilon_{0}} = \\left(\\frac{3\\phi}{4\\pi r^3}\\right)\\frac{\\alpha}{\\epsilon_{0}} = \\frac{3\\phi\\alpha}{4\\pi\\epsilon_0 r^3}\n$$\nThe provided parameters are:\n- Packing fraction $\\phi = 0.40$\n- Static molecular polarizability $\\alpha = 1.00 \\times 10^{-40} \\, \\text{F m}^2$\n- Hard-sphere radius $r = 1.50 \\times 10^{-10} \\, \\text{m}$\n\nThe term $k_e = \\frac{1}{4\\pi\\epsilon_0}$ is the Coulomb constant, which is approximately $8.98755 \\times 10^9 \\, \\text{N m}^2 \\text{C}^{-2}$. The expression for $Y$ can be written as $Y = \\frac{3\\phi (\\alpha/ (4\\pi\\epsilon_0))}{r^3}$. Let's calculate the polarizability volume, $\\alpha' = \\alpha/(4\\pi\\epsilon_0)$:\n$$\n\\alpha' = \\frac{\\alpha}{4\\pi\\epsilon_0} = (1.00 \\times 10^{-40} \\, \\text{F m}^2) \\times (8.98755 \\times 10^9 \\, \\text{N m}^2 \\text{C}^{-2}) \\approx 8.98755 \\times 10^{-31} \\, \\text{m}^3\n$$\nNote that the units work out, as $\\text{F} \\cdot \\text{N m}^2 \\text{C}^{-2} = (\\text{C}/\\text{V}) \\cdot (\\text{J}/\\text{C}) \\cdot \\text{m} \\cdot (\\text{C}^{-1}) = (\\text{C}/\\text{V}) \\cdot (\\text{V}\\cdot\\text{m}) \\cdot \\text{C}^{-1} = \\text{m}^3$.\nNow we compute $Y$:\n$$\nr^3 = (1.50 \\times 10^{-10} \\, \\text{m})^3 = 3.375 \\times 10^{-30} \\, \\text{m}^3\n$$\n$$\nY = \\frac{3 \\times 0.40 \\times (8.98755 \\times 10^{-31} \\, \\text{m}^3)}{3.375 \\times 10^{-30} \\, \\text{m}^3} = \\frac{1.2 \\times 8.98755 \\times 10^{-31}}{3.375 \\times 10^{-30}} \\approx 0.319557\n$$\nFinally, we calculate the ratio $R$:\n$$\nR = \\frac{3 + 2Y}{(1+Y)(3-Y)} = \\frac{3 + 2(0.319557)}{(1+0.319557)(3-0.319557)} = \\frac{3 + 0.639114}{1.319557 \\times 2.680443} = \\frac{3.639114}{3.536955} \\approx 1.02888\n$$\nRounding the result to four significant figures as requested gives $1.029$.",
            "answer": "$$\\boxed{1.029}$$"
        },
        {
            "introduction": "Having explored local fields in a classical continuum model, we now advance to the quantum mechanical description of periodic crystals. In this framework, the dielectric response is encoded in a microscopic matrix, $\\boldsymbol{\\epsilon}_{\\mathbf{G}\\mathbf{G}'}(\\omega)$, where the off-diagonal elements ($\\mathbf{G} \\neq \\mathbf{G}'$) contain the local-field effects. This exercise uses a simplified yet powerful $2 \\times 2$ model to analytically derive how these off-diagonal couplings modify the macroscopic optical spectrum, making the abstract concept of the inverse dielectric matrix tangible .",
            "id": "3801730",
            "problem": "Consider a periodic insulating crystal in the long-wavelength optical limit, where the perturbing field has crystal momentum $\\mathbf{q}$ satisfying $|\\mathbf{q}|\\to 0$. Within Linear Response Theory (LRT) and the Random Phase Approximation (RPA), the material’s microscopic dielectric response to an external scalar potential is encoded in the frequency-dependent dielectric matrix $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ in reciprocal lattice space. In a simplified multiscale treatment that captures local-field effects, truncate the reciprocal-lattice basis to the two channels $\\mathbf{G}=\\mathbf{0}$ and $\\mathbf{G}=\\mathbf{G}_{1}$, so that $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ is a $2\\times 2$ matrix in the set $\\{\\mathbf{0},\\mathbf{G}_{1}\\}$.\n\nAssume the following physically motivated model for the dielectric matrix elements at fixed $\\mathbf{q}$ in the optical limit:\n$$\n\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)=\n\\begin{pmatrix}\n\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)  \\epsilon_{\\mathbf{0}\\mathbf{G}_{1}}(\\omega) \\\\\n\\epsilon_{\\mathbf{G}_{1}\\mathbf{0}}(\\omega)  \\epsilon_{\\mathbf{G}_{1}\\mathbf{G}_{1}}(\\omega)\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1-\\alpha\\,p(\\omega)  -\\gamma\\,p(\\omega) \\\\\n-\\gamma\\,p(\\omega)  1-\\beta\\,p(\\omega)\n\\end{pmatrix},\n$$\nwhere $p(\\omega)$ is a real-valued scalar function representing the independent-particle polarizability at frequency $\\omega$ projected onto the truncated basis, and $\\alpha$, $\\beta$, and $\\gamma$ are positive, frequency-independent, dimensionless parameters that encode the Coulomb-weighted screening strength of the head, body, and wing couplings, respectively. This model is consistent with the Dyson equation structure and retains symmetry between $\\mathbf{G}=\\mathbf{0}$ and $\\mathbf{G}=\\mathbf{G}_{1}$ wings in nonmagnetic crystals.\n\nThe macroscopic optical response is governed by the relationship between the external perturbation and the averaged microscopic field; neglecting local-field effects corresponds to using only the head element $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)$, whereas properly accounting for local-field effects requires using the inverse dielectric matrix $\\boldsymbol{\\epsilon}^{-1}(\\mathbf{q},\\omega)$.\n\nDefine the local-field impact measure\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) \\equiv \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega),\n$$\nwhere $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ denotes the macroscopic dielectric response that results from including local-field effects via the inverse dielectric matrix in the truncated model. Starting from fundamental definitions in LRT and the matrix structure given above, derive a closed-form analytic expression for $\\Delta_{\\mathrm{LF}}(\\omega)$ in terms of $\\alpha$, $\\beta$, $\\gamma$, and $p(\\omega)$.\n\nExpress your final answer as a single analytic expression. No numerical evaluation or rounding is required, and no units are involved because $\\Delta_{\\mathrm{LF}}(\\omega)$ is dimensionless.",
            "solution": "The problem states a valid, well-posed query within the standard theoretical framework of solid-state physics. It is scientifically sound, self-contained, and calls for a rigorous derivation based on established principles of linear response theory. All provided definitions and parameters are standard in the context of multiscale modeling of dielectric properties.\n\nThe objective is to derive an analytic expression for the local-field impact measure, $\\Delta_{\\mathrm{LF}}(\\omega)$, which is defined as:\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) \\equiv \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)\n$$\nHere, $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega)$ is the head element of the dielectric matrix, representing the response without local-field effects. $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ is the macroscopic dielectric function that includes local-field effects.\n\nIn linear response theory, the macroscopic dielectric function is obtained from the microscopic dielectric matrix $\\boldsymbol{\\epsilon}(\\mathbf{q},\\omega)$ by considering the total response to a purely macroscopic external potential. This corresponds to inverting the full dielectric matrix and taking the inverse of its head-head ($\\mathbf{G}=\\mathbf{0}$, $\\mathbf{G}'=\\mathbf{0}$) element. In the long-wavelength limit ($|\\mathbf{q}| \\to 0$), the definition is:\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{1}{\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}}}\n$$\nThe problem provides the $2 \\times 2$ model for the dielectric matrix $\\boldsymbol{\\epsilon}(\\omega)$:\n$$\n\\boldsymbol{\\epsilon}(\\omega) =\n\\begin{pmatrix}\n1-\\alpha\\,p(\\omega)  -\\gamma\\,p(\\omega) \\\\\n-\\gamma\\,p(\\omega)  1-\\beta\\,p(\\omega)\n\\end{pmatrix}\n$$\nOur first step is to compute the inverse of this matrix. For a general $2 \\times 2$ matrix $\\mathbf{A} = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$, the inverse is given by $\\mathbf{A}^{-1} = \\frac{1}{ad-bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}$.\n\nFirst, we compute the determinant of $\\boldsymbol{\\epsilon}(\\omega)$:\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = \\big(1-\\alpha\\,p(\\omega)\\big)\\big(1-\\beta\\,p(\\omega)\\big) - \\big(-\\gamma\\,p(\\omega)\\big)\\big(-\\gamma\\,p(\\omega)\\big)\n$$\nExpanding the terms yields:\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = 1 - \\alpha\\,p(\\omega) - \\beta\\,p(\\omega) + \\alpha\\beta\\,\\left[p(\\omega)\\right]^2 - \\gamma^2\\,\\left[p(\\omega)\\right]^2\n$$\n$$\n\\det(\\boldsymbol{\\epsilon}(\\omega)) = 1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2\n$$\nNow, we can write the inverse matrix $\\boldsymbol{\\epsilon}^{-1}(\\omega)$:\n$$\n\\boldsymbol{\\epsilon}^{-1}(\\omega) = \\frac{1}{\\det(\\boldsymbol{\\epsilon}(\\omega))}\n\\begin{pmatrix}\n1-\\beta\\,p(\\omega)  \\gamma\\,p(\\omega) \\\\\n\\gamma\\,p(\\omega)  1-\\alpha\\,p(\\omega)\n\\end{pmatrix}\n$$\nFrom this, we identify the head-head element, which is the $(\\mathbf{0},\\mathbf{0})$ component:\n$$\n\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}} = \\frac{1-\\beta\\,p(\\omega)}{\\det(\\boldsymbol{\\epsilon}(\\omega))} = \\frac{1-\\beta\\,p(\\omega)}{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}\n$$\nUsing the definition of the macroscopic dielectric function, we find $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$:\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{1}{\\left[\\boldsymbol{\\epsilon}^{-1}(\\omega)\\right]_{\\mathbf{0}\\mathbf{0}}} = \\frac{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\nWe can now compute the local-field impact measure $\\Delta_{\\mathrm{LF}}(\\omega)$. We are given $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = 1-\\alpha\\,p(\\omega)$.\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = \\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) - \\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = \\frac{1 - (\\alpha + \\beta)\\,p(\\omega) + (\\alpha\\beta - \\gamma^2)\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)} - \\big(1-\\alpha\\,p(\\omega)\\big)\n$$\nTo simplify, we can rewrite the expression for $\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega)$ by substituting the definition of the determinant:\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{\\big(1-\\alpha p(\\omega)\\big)\\big(1-\\beta p(\\omega)\\big) - \\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\frac{\\big(1-\\alpha p(\\omega)\\big)\\big(1-\\beta p(\\omega)\\big)}{1-\\beta\\,p(\\omega)} - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\n$$\n\\epsilon_{\\mathrm{macro}}^{\\mathrm{LF}}(\\omega) = \\big(1-\\alpha p(\\omega)\\big) - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\nRecognizing that $\\epsilon_{\\mathbf{0}\\mathbf{0}}(\\omega) = 1-\\alpha\\,p(\\omega)$, we substitute this back into the definition of $\\Delta_{\\mathrm{LF}}(\\omega)$:\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = \\left( \\big(1-\\alpha p(\\omega)\\big) - \\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)} \\right) - \\big(1-\\alpha\\,p(\\omega)\\big)\n$$\nThe term $1-\\alpha\\,p(\\omega)$ cancels out, leaving the final expression:\n$$\n\\Delta_{\\mathrm{LF}}(\\omega) = -\\frac{\\gamma^2\\,\\left[p(\\omega)\\right]^2}{1-\\beta\\,p(\\omega)}\n$$\nThis result demonstrates that the local-field correction is driven by the off-diagonal coupling $\\gamma$, is second-order in the system's polarizability $p(\\omega)$, and is screened by the response in the non-macroscopic channel, which is captured by the term $1-\\beta p(\\omega)$.",
            "answer": "$$\n\\boxed{-\\frac{\\gamma^2 \\left[p(\\omega)\\right]^2}{1-\\beta p(\\omega)}}\n$$"
        },
        {
            "introduction": "Theoretical derivations provide insight, but computational implementation is where theory meets practical prediction. This final practice challenges you to build the microscopic dielectric matrix from the ground up for a model of a periodic crystal, putting the concepts from the previous exercises into code. You will implement the Lindhard function to model the electron gas polarizability and test the crucial concept of convergence with respect to the plane-wave basis set cutoff, a fundamental skill in modern materials simulation .",
            "id": "3801733",
            "problem": "Consider a periodic, weakly inhomogeneous electron system on a simple cubic lattice modeled in Hartree atomic units (electron mass $m=1$, reduced Planck constant $\\hbar=1$, electron charge squared $e^2=1$). Let the lattice constant be $a$ and the fundamental reciprocal lattice vector be $\\mathbf{G}_0 = \\frac{2\\pi}{a}\\hat{\\mathbf{x}}$. Within linear response theory, the microscopic dielectric matrix in reciprocal space is defined by plane-wave components indexed by reciprocal vectors $\\mathbf{G}$ and $\\mathbf{G}'$. The microscopic dielectric matrix depends on the wave vector $\\mathbf{q}$ and frequency $\\omega$. In this problem, focus on the static limit $\\omega=0$ and construct the plane-wave-expanded microscopic dielectric matrix $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ using a truncated set of reciprocal lattice vectors with $|\\mathbf{G}| \\leq G_{\\mathrm{max}}$, and evaluate convergence with respect to the cutoff $G_{\\mathrm{max}}$.\n\nUse the following context-appropriate fundamental base:\n\n- Linear response theory relates the induced density to the external perturbation via the density-density response function (polarizability) $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},\\omega)$.\n- The independent-particle (noninteracting) polarizability in a homogeneous electron gas has a well-tested static limit in three dimensions (the Lindhard function). Denote the Fermi wave vector by $k_{\\mathrm{F}}$, and the static noninteracting polarizability by $\\chi_0(k,0)$ as a function of the magnitude $k$ of a wave vector.\n- Coulomb interactions in reciprocal space are represented by the kernel $v(k) = \\frac{4\\pi}{k^2}$.\n\nTo model local-field effects arising from weak periodic inhomogeneity, consider a first-order perturbation due to a sinusoidal modulation of the potential $V(\\mathbf{r}) = V_0 \\cos(\\mathbf{G}_0 \\cdot \\mathbf{r})$. Let $\\alpha$ be a small, dimensionless parameter proportional to $V_0$ that characterizes the strength of local-field coupling. In the plane-wave basis, this modulation couples $\\mathbf{G}$ components separated by $\\pm \\mathbf{G}_0$. Construct a perturbative model polarizability $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ that includes:\n- The diagonal homogeneous-gas contribution proportional to $\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0)$.\n- First-order off-diagonal couplings between $\\mathbf{G}'$ and $\\mathbf{G}'\\pm \\mathbf{G}_0$ scaled by $\\alpha$ and symmetrized in the magnitudes $|\\mathbf{q}+\\mathbf{G}|$ and $|\\mathbf{q}+\\mathbf{G}'|$.\n\nThen form the microscopic dielectric matrix using the Coulomb kernel and the model $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ constructed above. From the microscopic matrix, compute a macroscopic dielectric response consistent with linear response theory by appropriately processing the $\\mathbf{G}=\\mathbf{0}$ component. Evaluate the convergence of this macroscopic dielectric quantity with respect to increasing $G_{\\mathrm{max}}$ using a sequence of cutoffs.\n\nAll quantities must be treated as dimensionless in Hartree atomic units. Angles are not involved. Your program must:\n\n1. Generate the plane-wave basis of reciprocal vectors $\\mathbf{G} = h\\mathbf{G}_0 + k\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ where $h,k,\\ell$ are integers such that $|\\mathbf{G}| \\leq G_{\\mathrm{max}}$.\n2. Construct the model $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ as described, using the static Lindhard function $\\chi_0(k,0)$ for the homogeneous component.\n3. Assemble the microscopic dielectric matrix $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ in the plane-wave basis.\n4. Extract a macroscopic dielectric quantity from the microscopic matrix in a mathematically consistent way.\n5. For a sequence of increasing cutoffs $G_{\\mathrm{max}}$, compute the change in the macroscopic dielectric quantity between the last two successive cutoffs as a measure of convergence. Report this change as a nonnegative real number.\n\nImplement the static three-dimensional Lindhard function for the homogeneous electron gas at zero temperature in Hartree atomic units, expressed as a function of $k = |\\mathbf{k}|$ and $k_{\\mathrm{F}}$:\n$$\n\\chi_0(k,0) = -\\frac{k_{\\mathrm{F}}}{\\pi^2}\\left[1 + \\frac{1 - x^2}{2x}\\ln\\left|\\frac{1+x}{1-x}\\right|\\right], \\quad x = \\frac{k}{2k_{\\mathrm{F}}}.\n$$\nThis expression is real for all $k \\geq 0$.\n\nDefine the perturbative local-field model for the polarizability as follows. For reciprocal vectors indexed by integers $(h,k,\\ell)$ and $(h',k',\\ell')$:\n- Diagonal homogeneous contribution:\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'}\\,\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0).\n$$\n- First-order local-field couplings that only connect $\\mathbf{G}'$ to $\\mathbf{G}'\\pm \\mathbf{G}_0$ (i.e., $h = h'\\pm 1$ with $k=k'$ and $\\ell=\\ell'$):\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0) = \\frac{\\alpha}{2}\\left[\\delta_{h,h'+1}\\delta_{k,k'}\\delta_{\\ell,\\ell'} + \\delta_{h,h'-1}\\delta_{k,k'}\\delta_{\\ell,\\ell'}\\right]\\left(\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0) + \\chi_0(|\\mathbf{q}+\\mathbf{G}'|,0)\\right).\n$$\n- Total model:\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) + \\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0).\n$$\n\nUse the Coulomb kernel to form the microscopic dielectric matrix:\n$$\n\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'} - v(|\\mathbf{q}+\\mathbf{G}|)\\,\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0), \\quad v(k) = \\frac{4\\pi}{k^2}.\n$$\n\nFrom the microscopic dielectric matrix, extract a macroscopic dielectric quantity using the $\\mathbf{G}=\\mathbf{0}$ component through an operation that is consistent with linear response theory and accounts for local-field effects.\n\nTest Suite and Output Specification:\n\nUse the following three test cases, each processed with the sequence of cutoffs $G_{\\mathrm{max}} \\in \\{|\\mathbf{G}_0|, 2|\\mathbf{G}_0|, 3|\\mathbf{G}_0|\\}$, and report for each case the absolute change in the macroscopic dielectric quantity between $G_{\\mathrm{max}}=2|\\mathbf{G}_0|$ and $G_{\\mathrm{max}}=3|\\mathbf{G}_0|$ as a single real number:\n\n- Case 1 (general case): $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.2$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$.\n- Case 2 (boundary case with no local-field effects): $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.0$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$.\n- Case 3 (edge case near a Bragg condition): $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.3$, $\\mathbf{q}=0.95\\,\\mathbf{G}_0$.\n\nAll quantities are dimensionless in Hartree atomic units. Your program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\").",
            "solution": "We begin from linear response theory, where a weak external perturbation induces a change in electronic density that is related to the perturbing potential via the density-density response function (polarizability). In reciprocal space for a periodic system, one expands all fields in plane waves indexed by reciprocal lattice vectors. The microscopic dielectric matrix $\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},\\omega)$ connects Fourier components of the total field and the external field, embodying screening and local-field effects at the scale of the unit cell.\n\nConstructing the dielectric matrix in a plane-wave basis proceeds from the fundamental ingredients:\n\n1. The independent-particle density response function for a homogeneous electron gas in three dimensions at zero temperature is the Lindhard function in the static limit, denoted $\\chi_0(k,0)$. In Hartree atomic units, this is\n$$\n\\chi_0(k,0) = -\\frac{k_{\\mathrm{F}}}{\\pi^2}\\left[1 + \\frac{1 - x^2}{2x}\\ln\\left|\\frac{1+x}{1-x}\\right|\\right],\\quad x=\\frac{k}{2k_{\\mathrm{F}}},\n$$\nwith $k_{\\mathrm{F}}$ the Fermi wave vector. This function encodes the response of a uniform electron gas to a static perturbation of wave vector magnitude $k$ and shows characteristic nonanalytic behavior at $k=2k_{\\mathrm{F}}$.\n\n2. The Coulomb interaction in reciprocal space is diagonal in plane waves and given by the kernel $v(k)=\\frac{4\\pi}{k^2}$, where $k=|\\mathbf{k}|$ is the magnitude of the wave vector.\n\n3. In a periodic, weakly inhomogeneous system, local-field effects arise because Fourier components of the induced density at different reciprocal lattice vectors couple to each other even for a given macroscopic $\\mathbf{q}$. In first-order perturbation theory for a sinusoidal modulation $V(\\mathbf{r})=V_0\\cos(\\mathbf{G}_0\\cdot\\mathbf{r})$, the plane-wave components with indices differing by $\\pm \\mathbf{G}_0$ are coupled. We model this by introducing a small dimensionless parameter $\\alpha$ proportional to $V_0$ and constructing a perturbative polarizability:\n- Diagonal homogeneous-gas contribution\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'}\\,\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0).\n$$\n- Off-diagonal first-order local-field couplings\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0) = \\frac{\\alpha}{2}\\left[\\delta_{h,h'+1}\\delta_{k,k'}\\delta_{\\ell,\\ell'} + \\delta_{h,h'-1}\\delta_{k,k'}\\delta_{\\ell,\\ell'}\\right]\\left(\\chi_0(|\\mathbf{q}+\\mathbf{G}|,0) + \\chi_0(|\\mathbf{q}+\\mathbf{G}'|,0)\\right),\n$$\nwhere $\\mathbf{G} = h\\mathbf{G}_0 + k\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ and $\\mathbf{G}' = h'\\mathbf{G}_0 + k'\\frac{2\\pi}{a}\\hat{\\mathbf{y}} + \\ell'\\frac{2\\pi}{a}\\hat{\\mathbf{z}}$ are indexed by integers $(h,k,\\ell)$ and $(h',k',\\ell')$, respectively. This form captures the leading-order mixing between neighboring reciprocal lattice vectors along $\\mathbf{G}_0$ and symmetrizes the coupling to maintain Hermiticity in the static limit.\n\nThe total model polarizability is then\n$$\n\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\chi_{\\mathbf{G}\\mathbf{G}'}^{(0)}(\\mathbf{q},0) + \\chi_{\\mathbf{G}\\mathbf{G}'}^{\\mathrm{LF}}(\\mathbf{q},0).\n$$\n\n4. The microscopic dielectric matrix in the plane-wave basis under the independent-particle Random Phase Approximation (RPA) is formed by combining the Coulomb kernel with the polarizability:\n$$\n\\epsilon_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0) = \\delta_{\\mathbf{G}\\mathbf{G}'} - v(|\\mathbf{q}+\\mathbf{G}|)\\,\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0),\\quad v(k)=\\frac{4\\pi}{k^2}.\n$$\nThis structure reflects that the Coulomb kernel multiplies the rows of the response function by a factor depending on the incoming wave vector $\\mathbf{q}+\\mathbf{G}$.\n\n5. The macroscopic dielectric response for given $\\mathbf{q}$ is obtained by properly accounting for local-field effects and extracting the screening of the $\\mathbf{G}=\\mathbf{0}$ component. In linear response theory for periodic systems, the macroscopic dielectric function consistent with local-field effects is given by\n$$\n\\epsilon_{\\mathrm{M}}(\\mathbf{q},0) = \\frac{1}{\\left[\\epsilon^{-1}(\\mathbf{q},0)\\right]_{\\mathbf{0}\\mathbf{0}}},\n$$\nwhere $\\left[\\epsilon^{-1}(\\mathbf{q},0)\\right]_{\\mathbf{0}\\mathbf{0}}$ is the $\\mathbf{G}=\\mathbf{G}'=\\mathbf{0}$ element of the inverse microscopic dielectric matrix. This definition reduces to the standard homogeneous result in the absence of local-field couplings and incorporates microscopic mixing when present.\n\nAlgorithmic steps aligned with the above principles:\n\n- Generate the plane-wave basis by enumerating integer triplets $(h,k,\\ell)$ such that the magnitude $|\\mathbf{G}|$ is less than or equal to $G_{\\mathrm{max}}$. For a simple cubic lattice with lattice constant $a$, we have\n$$\n\\mathbf{G} = \\frac{2\\pi}{a}(h,k,\\ell),\\quad |\\mathbf{G}| = \\frac{2\\pi}{a}\\sqrt{h^2 + k^2 + \\ell^2}.\n$$\n- For a given $\\mathbf{q}$ along $\\hat{\\mathbf{x}}$ with magnitude $q$, compute $k_i = |\\mathbf{q}+\\mathbf{G}_i|$ for each basis vector $\\mathbf{G}_i$.\n- Assemble the polarizability matrix $\\chi_{\\mathbf{G}\\mathbf{G}'}(\\mathbf{q},0)$ using $\\chi_0(k,0)$ for the diagonal and the local-field coupling form given above for off-diagonals between integer indices that differ by $\\pm 1$ along $h$ only (with $k,k'$ and $\\ell,\\ell'$ equal).\n- Form the microscopic dielectric matrix via\n$$\n\\epsilon_{ij} = \\delta_{ij} - v(k_i)\\,\\chi_{ij},\\quad v(k_i) = \\frac{4\\pi}{k_i^2}.\n$$\n- Invert $\\epsilon$ numerically and extract the macroscopic dielectric via\n$$\n\\epsilon_{\\mathrm{M}} = \\frac{1}{\\left(\\epsilon^{-1}\\right)_{i_0,i_0}},\n$$\nwhere $i_0$ is the index of $(h,k,\\ell)=(0,0,0)$ in the basis.\n- For a sequence of cutoffs $G_{\\mathrm{max}} \\in \\{|\\mathbf{G}_0|,2|\\mathbf{G}_0|,3|\\mathbf{G}_0|\\}$, compute $\\epsilon_{\\mathrm{M}}$ at each cutoff and report the absolute change between the last two, i.e.,\n$$\n\\Delta = \\left|\\epsilon_{\\mathrm{M}}(G_{\\mathrm{max}}=3|\\mathbf{G}_0|) - \\epsilon_{\\mathrm{M}}(G_{\\mathrm{max}}=2|\\mathbf{G}_0|)\\right|.\n$$\n\nTest cases:\n\n- Case 1: $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.2$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$. This tests a moderate local-field strength with a nonzero $\\mathbf{q}$.\n- Case 2: $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.0$, $\\mathbf{q}=0.4\\,\\mathbf{G}_0$. With $\\alpha=0$, there are no off-diagonal couplings; convergence should be rapid and the change ideally zero within numerical precision.\n- Case 3: $a=10$, $k_{\\mathrm{F}}=1.0$, $\\alpha=0.3$, $\\mathbf{q}=0.95\\,\\mathbf{G}_0$. Near a Bragg-like condition, local-field effects are stronger due to enhanced coupling between adjacent $h$ indices, testing slower convergence.\n\nThe program implements these steps, computes $\\Delta$ for each case, and prints the three results as a single comma-separated list enclosed in square brackets. All quantities are dimensionless in Hartree atomic units, and the static limit ensures real-valued outputs. Numerical safeguards avoid divisions by zero by not selecting $\\mathbf{q}$ that exactly cancels any $\\mathbf{G}$ to produce $|\\mathbf{q}+\\mathbf{G}|=0$; the chosen test parameters satisfy this condition.",
            "answer": "```python\nimport numpy as np\n\n# Hartree atomic units throughout (dimensionless).\n# Implement static 3D Lindhard function chi0(k, 0) at T=0.\ndef chi0_static(k, kF):\n    # Avoid division by zero in x near zero\n    x = k / (2.0 * kF)\n    # Handle x=0 separately: limit x-0 gives chi0 = -(kF/pi^2) * (1 + 1) = -(2 kF / pi^2)\n    if np.isclose(x, 0.0):\n        return -(2.0 * kF) / (np.pi**2)\n    # Use the standard static expression\n    # For numerical stability, clip arguments of log away from 1\n    # But the expression with absolute value is real-valued for all k = 0\n    num = 1.0 + x\n    den = 1.0 - x\n    # To avoid log(0), add a tiny epsilon if needed\n    eps = 1e-12\n    den_adj = den if not np.isclose(den, 0.0) else (eps if den = 0.0 else -eps)\n    val = -(kF / (np.pi**2)) * (1.0 + ((1.0 - x**2) / (2.0 * x)) * np.log(np.abs(num / den_adj)))\n    return val\n\n# Generate reciprocal lattice vectors G = (2*pi/a) * (h, k, l) within |G| = Gmax\ndef generate_G_vectors(a, Gmax):\n    g0 = 2.0 * np.pi / a\n    # Max integer such that |G| = Gmax, i.e., g0 * sqrt(h^2 + k^2 + l^2) = Gmax\n    H = int(np.floor(Gmax / g0))  # upper bound for |h|,|k|,|l|\n    G_list = []\n    idx_list = []\n    for h in range(-H, H + 1):\n        for k in range(-H, H + 1):\n            for l in range(-H, H + 1):\n                G_vec = g0 * np.array([h, k, l], dtype=float)\n                if np.linalg.norm(G_vec) = Gmax + 1e-12:\n                    G_list.append(G_vec)\n                    idx_list.append((h, k, l))\n    # Ensure sorted order with (h,k,l) to make index deterministic\n    order = np.argsort(\n        [abs(h) + abs(k) + abs(l) + 0.1 * np.linalg.norm(g0 * np.array([h, k, l])) for (h, k, l) in idx_list]\n    )\n    G_sorted = [G_list[i] for i in order]\n    idx_sorted = [idx_list[i] for i in order]\n    # Map from index triple to position\n    idx_map = {idx_sorted[i]: i for i in range(len(idx_sorted))}\n    return np.array(G_sorted), idx_sorted, idx_map\n\n# Build polarizability matrix chi_GG'(q, 0) with local-field coupling parameter alpha\ndef build_chi_matrix(a, q_vec, G_vectors, idx_tuples, kF, alpha):\n    N = len(G_vectors)\n    chi = np.zeros((N, N), dtype=float)\n    # Precompute k magnitudes and chi0 on diagonals\n    k_mags = np.linalg.norm(G_vectors + q_vec, axis=1)\n    chi0_vals = np.array([chi0_static(k, kF) for k in k_mags])\n    # Diagonal\n    for i in range(N):\n        chi[i, i] = chi0_vals[i]\n    # Local-field couplings: only between h and h±1 with same k,l\n    # Symmetrized by average of chi0 at (i) and (j)\n    # Map from (h,k,l) to position\n    idx_map = {idx_tuples[i]: i for i in range(N)}\n    for j in range(N):\n        h, k, l = idx_tuples[j]\n        for dh in (-1, 1):\n            neighbor = (h + dh, k, l)\n            if neighbor in idx_map:\n                i = idx_map[neighbor]\n                chi[i, j] += 0.5 * alpha * (chi0_vals[i] + chi0_vals[j])\n    return chi, k_mags\n\n# Build microscopic dielectric matrix epsilon = I - V * chi, with V diagonal in incoming index i\ndef build_epsilon_matrix(chi, k_mags):\n    N = chi.shape[0]\n    epsilon = np.eye(N, dtype=float)\n    # Coulomb kernel v(k) = 4*pi / k^2\n    # Avoid division by zero by ensuring k_mags  0 via problem setup\n    v_diag = 4.0 * np.pi / (k_mags**2)\n    for i in range(N):\n        epsilon[i, :] -= v_diag[i] * chi[i, :]\n    return epsilon\n\n# Compute macroscopic dielectric epsilon_M = 1 / (epsilon^{-1})_{00}\ndef compute_macroscopic_epsilon(epsilon, idx_tuples):\n    # Find index of G=(0,0,0)\n    if (0, 0, 0) not in {t for t in idx_tuples}:\n        raise RuntimeError(\"Basis does not include G=(0,0,0). Increase cutoff.\")\n    i0 = idx_tuples.index((0, 0, 0))\n    eps_inv = np.linalg.inv(epsilon)\n    epsM = 1.0 / eps_inv[i0, i0]\n    return float(epsM)\n\n# Evaluate convergence: difference between epsM at last two cutoffs\ndef evaluate_convergence(a, kF, alpha, q_ratio):\n    g0_mag = 2.0 * np.pi / a\n    q_vec = np.array([q_ratio * g0_mag, 0.0, 0.0], dtype=float)\n    cutoffs = [g0_mag, 2.0 * g0_mag, 3.0 * g0_mag]\n    epsM_values = []\n    for Gmax in cutoffs:\n        G_vectors, idx_tuples, idx_map = generate_G_vectors(a, Gmax)\n        chi, k_mags = build_chi_matrix(a, q_vec, G_vectors, idx_tuples, kF, alpha)\n        epsilon = build_epsilon_matrix(chi, k_mags)\n        epsM = compute_macroscopic_epsilon(epsilon, idx_tuples)\n        epsM_values.append(epsM)\n    # Return absolute change between last two\n    return abs(epsM_values[-1] - epsM_values[-2])\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Parameters: a, kF, alpha, q_ratio (q = q_ratio * |G0|)\n    test_cases = [\n        (10.0, 1.0, 0.2, 0.4),   # Case 1: general case\n        (10.0, 1.0, 0.0, 0.4),   # Case 2: boundary case (no LF)\n        (10.0, 1.0, 0.3, 0.95),  # Case 3: edge case near Bragg\n    ]\n\n    results = []\n    for a, kF, alpha, q_ratio in test_cases:\n        delta = evaluate_convergence(a, kF, alpha, q_ratio)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}