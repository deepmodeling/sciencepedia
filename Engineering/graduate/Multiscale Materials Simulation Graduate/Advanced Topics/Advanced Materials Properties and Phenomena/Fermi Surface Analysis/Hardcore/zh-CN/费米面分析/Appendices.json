{
    "hands_on_practices": [
        {
            "introduction": "在费米面分析中，一个核心任务是将费米面的几何特征与可测量的物理量联系起来。摆动质量（cyclotron mass）$m_c$ 是一个可以通过量子振荡实验（如德哈斯-范阿尔芬效应）直接探测的关键参数。本练习将指导你通过一个具体的例子，推导摆动质量与费米面极端轨道截面积对能量的导数之间的深刻联系，即昂萨格关系（Onsager relation）。这个实践不仅加深了对半经典模型下电子动力学的理解，也揭示了费米面几何如何决定了材料的宏观电子响应。",
            "id": "3808119",
            "problem": "考虑一个三维晶体，其化学势附近的导带可以很好地用一个各向异性抛物色散关系来描述。在有效质量近似下，单电子能量作为晶体动量的函数为\n$$\nE(\\mathbf{k}) = \\frac{\\hbar^{2}}{2}\\left(\\frac{k_{x}^{2}}{m_{x}} + \\frac{k_{y}^{2}}{m_{y}} + \\frac{k_{z}^{2}}{m_{z}}\\right),\n$$\n其中 $m_{x}$、$m_{y}$ 和 $m_{z}$ 是有效质量张量沿笛卡尔坐标轴的主分量。施加一个均匀磁场 $\\mathbf{B}$，其单位方向矢量 $\\hat{\\mathbf{n}}$ 位于 $x$–$z$ 平面内，$\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$，其中 $\\theta$ 是与 $z$ 轴的夹角。关注由等能面与垂直于 $\\hat{\\mathbf{n}}$ 的平面的交线所定义的极值回旋轨道。\n\n从一个有效的基础出发——即磁场中闭合轨道的半经典 Bohr–Sommerfeld 量子化以及将朗道能级指数与极值截面积联系起来的 Onsager 关系——推导回旋有效质量与在化学势处计算的极值轨道面积对能量的导数之间的一般关系。然后，对于上述给定的各向异性抛物能带，计算极值截面积 $A(E)$ 作为能量和 $\\theta$ 的函数，并求出相应的回旋有效质量 $m_{c}(\\theta)$。最后，通过用 $m_{c}$、温度 $T$、磁场大小 $B = |\\mathbf{B}|$ 和基本常数表示振荡磁化强度的热阻尼因子，将您的结果与量子振荡的 Lifshitz–Kosevich (LK) 理论联系起来，并明确指出控制该阻尼的无量纲参数。\n\n将最终结果报告为无量纲比值 $m_{c}(\\theta)/m_{e}$ 的闭合形式解析表达式，其中 $m_{e}$ 是自由电子质量。用无量纲主质量比 $\\tilde{m}_{x} = m_{x}/m_{e}$、$\\tilde{m}_{y} = m_{y}/m_{e}$ 和 $\\tilde{m}_{z} = m_{z}/m_{e}$ 以及角度 $\\theta$ 来表示您的答案。不需要进行数值计算。最终答案必须是单一的闭合形式解析表达式。由于所求比值为无量纲，因此无需报告物理单位。",
            "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **能量色散关系：** 单电子能量作为晶体动量 $\\mathbf{k} = (k_x, k_y, k_z)$ 的函数由各向异性抛物色散关系给出：\n$$E(\\mathbf{k}) = \\frac{\\hbar^{2}}{2}\\left(\\frac{k_{x}^{2}}{m_{x}} + \\frac{k_{y}^{2}}{m_{y}} + \\frac{k_{z}^{2}}{m_{z}}\\right)$$\n其中 $m_{x}$、$m_{y}$ 和 $m_{z}$ 是有效质量张量的主分量。\n- **磁场：** 施加一个均匀磁场 $\\mathbf{B}$。其大小为 $B = |\\mathbf{B}|$，方向由单位矢量 $\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$ 给出，该矢量位于 $x$–$z$ 平面内，与 $z$ 轴成 $\\theta$ 角。\n- **任务：**\n  1. 推导回旋有效质量 $m_c$ 与在化学势处计算的极值轨道面积 $A$ 对能量的导数之间的一般关系。\n  2. 对于给定的色散关系，计算极值截面积 $A(E)$ 作为能量 $E$ 和角度 $\\theta$ 的函数。\n  3. 求出相应的回旋有效质量 $m_{c}(\\theta)$。\n  4. 通过用 $m_{c}$、温度 $T$、磁场大小 $B$ 和基本常数表示热阻尼因子，将结果与 Lifshitz–Kosevich (LK) 理论联系起来，并确定起控制作用的无量纲参数。\n  5. 将最终结果报告为无量纲比值 $m_{c}(\\theta)/m_{e}$ 的闭合形式解析表达式，其中 $m_e$ 是自由电子质量，用无量纲质量比 $\\tilde{m}_{x} = m_{x}/m_{e}$、$\\tilde{m}_{y} = m_{y}/m_{e}$ 和 $\\tilde{m}_{z} = m_{z}/m_{e}$ 以及角度 $\\theta$ 表示。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学依据：** 该问题牢固地植根于固体中电子的半经典理论，这是凝聚态物理学的基石。它利用了有效质量近似、k 空间轨道的 Bohr-Sommerfeld 量子化（Onsager 关系）以及量子振荡的 Lifshitz-Kosevich 理论等既定概念。所有前提在事实上和科学上都是合理的。\n- **适定性：** 该问题结构清晰，引导解答者完成一系列逻辑推导。它要求一个特定的解析表达式，并且所提供的信息足以推导出一个唯一且有意义的解。\n- **客观性：** 该问题以精确、无偏见且正式的科学语言陈述，不含任何主观性或观点。\n- **其他缺陷：** 该问题没有表现出任何其他缺陷。它不是不完整的、矛盾的、不切实际的或不适定的。这些概念是高等固体物理课程中的标准内容，并且与指定的费米面分析主题相关。\n\n### 步骤 3：结论与行动\n问题是**有效的**。将提供完整解答。\n\n### 解答推导\n解答是按照问题陈述中概述的步骤构建的。\n\n首先，我们推导回旋有效质量 $m_c$ 和等能面极值截面积 $A$ 之间的一般关系。在磁场 $\\mathbf{B}$ 中，电子在 k 空间中的轨道的半经典量子化由 Onsager-Bohr-Sommerfeld 法则给出。垂直于 $\\mathbf{B}$ 的平面内轨道所包围的面积 $A$ 是量子化的：\n$$A_n = (n + \\gamma) \\frac{2\\pi e B}{\\hbar}$$\n其中 $n$ 是表示朗道能级指数的整数，$e$ 是基本电荷，$\\hbar$ 是约化普朗克常数，$B$ 是磁场大小，$\\gamma$ 是一个相位因子（通常为 $1/2$）。这些量子化能级的能量用 $E_n$ 表示。相邻朗道能级之间的能量间隔为 $\\Delta E = E_{n+1} - E_n$。对于大的 $n$，我们可以将此间隔近似为 $\\Delta E \\approx \\frac{dE}{dn}$。根据量子化规则，相邻能级之间的面积变化为 $\\Delta A = A_{n+1} - A_n = \\frac{2\\pi e B}{\\hbar}$。使用链式法则，我们可以写出 $\\frac{dE}{dn} = \\frac{dE}{dA} \\frac{dA}{dn}$。用差分近似导数，我们得到 $\\Delta E \\approx \\frac{dE}{dA} \\Delta A$。\n代入 $\\Delta A$ 的表达式：\n$$\\Delta E \\approx \\frac{dE}{dA} \\left(\\frac{2\\pi e B}{\\hbar}\\right)$$\n回旋共振频率 $\\omega_c$ 由朗道能级的能量间隔定义：$\\hbar\\omega_c = \\Delta E$。回旋有效质量 $m_c$ 通过此频率定义为 $\\omega_c = \\frac{eB}{m_c}$。代入这些定义，我们有：\n$$\\hbar \\left(\\frac{eB}{m_c}\\right) = \\frac{2\\pi e B}{\\hbar} \\frac{dE}{dA}$$\n解出 $m_c$，我们得到回旋质量的基本 Onsager 关系：\n$$m_c = \\frac{\\hbar^2}{2\\pi} \\frac{dA}{dE}$$\n这个关系将回旋质量与费米面（或任何等能面）的极值截面积相对于能量的变化率联系起来。\n\n接下来，我们计算给定各向异性抛物能带的极值截面积 $A(E)$。等能面 $E(\\mathbf{k}) = E$ 是 k 空间中的一个椭球，由方程描述：\n$$\\frac{k_x^2}{m_x} + \\frac{k_y^2}{m_y} + \\frac{k_z^2}{m_z} = \\frac{2E}{\\hbar^2}$$\n这可以重写为椭球的标准形式 $\\frac{k_x^2}{a^2} + \\frac{k_y^2}{b^2} + \\frac{k_z^2}{c^2} = 1$，其半轴为：\n$$a = \\frac{\\sqrt{2m_x E}}{\\hbar}, \\quad b = \\frac{\\sqrt{2m_y E}}{\\hbar}, \\quad c = \\frac{\\sqrt{2m_z E}}{\\hbar}$$\n对于椭球形费米面，极值轨道对应于中心截面，即椭球与一个穿过 k 空间原点且垂直于磁场 $\\mathbf{B}$ 的平面的交集。该平面的法线是磁场的方向，$\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$。上述椭球被一个法线为 $\\hat{\\mathbf{n}} = (n_x, n_y, n_z)$ 的平面所截的中心截面面积由以下公式给出：\n$$A = \\frac{\\pi abc}{\\sqrt{a^2 n_x^2 + b^2 n_y^2 + c^2 n_z^2}}$$\n在我们的例子中，$n_x = \\sin\\theta$，$n_y = 0$，$n_z = \\cos\\theta$。代入半轴和法向量分量的表达式：\n$$A(E, \\theta) = \\frac{\\pi \\left(\\frac{\\sqrt{2m_x E}}{\\hbar}\\right)\\left(\\frac{\\sqrt{2m_y E}}{\\hbar}\\right)\\left(\\frac{\\sqrt{2m_z E}}{\\hbar}\\right)}{\\sqrt{\\left(\\frac{2m_x E}{\\hbar^2}\\right)\\sin^2\\theta + \\left(\\frac{2m_y E}{\\hbar^2}\\right)(0)^2 + \\left(\\frac{2m_z E}{\\hbar^2}\\right)\\cos^2\\theta}}$$\n$$A(E, \\theta) = \\frac{\\pi \\frac{(2E)^{3/2}\\sqrt{m_x m_y m_z}}{\\hbar^3}}{\\frac{\\sqrt{2E}}{\\hbar}\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\n简化此表达式，得到极值面积作为能量和角度的函数：\n$$A(E, \\theta) = \\frac{2\\pi E}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\n我们观察到，对于抛物能带，面积 $A$ 与能量 $E$ 成正比。\n\n现在，我们可以使用 Onsager 关系计算回旋有效质量 $m_c(\\theta)$。我们需要 $A(E, \\theta)$ 对 $E$ 的导数：\n$$\\frac{dA}{dE} = \\frac{d}{dE}\\left[\\left(\\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}\\right) E\\right] = \\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\n将此导数代入 $m_c$ 的公式中：\n$$m_c(\\theta) = \\frac{\\hbar^2}{2\\pi} \\left(\\frac{dA}{dE}\\right) = \\frac{\\hbar^2}{2\\pi} \\left(\\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}\\right)$$\n这简化为与角度相关的回旋质量的表达式：\n$$m_c(\\theta) = \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\n\n问题的第四部分将此结果与金属磁化强度中量子振荡的 Lifshitz–Kosevich (LK) 理论联系起来。在有限温度下，这些振荡的振幅会因一个热阻尼因子 $R_T$ 而减小，该因子由下式给出：\n$$R_T = \\frac{X_T}{\\sinh(X_T)}$$\n参数 $X_T$ 是一个无量纲参数，它量化了相对于朗道能级间距的费米-狄拉克分布的热弥散。其定义为：\n$$X_T = \\frac{2\\pi^2 k_B T}{\\hbar \\omega_c}$$\n其中 $k_B$ 是玻尔兹曼常数，$T$ 是温度。控制阻尼的无量纲参数是 $X_T$。我们通过代入 $\\omega_c = eB/m_c$ 将其用回旋质量 $m_c$ 表示：\n$$X_T = \\frac{2\\pi^2 k_B T}{\\hbar (eB/m_c)} = \\frac{2\\pi^2 k_B T m_c}{\\hbar e B}$$\n该参数直接包含了我们刚刚计算出的回旋质量 $m_c$。高的回旋质量会导致量子振荡更强的热阻尼。\n\n最后，我们根据无量纲主质量比 $\\tilde{m}_{x} = m_{x}/m_{e}$、$\\tilde{m}_{y} = m_{y}/m_{e}$ 和 $\\tilde{m}_{z} = m_{z}/m_{e}$ 计算所要求的无量纲比值 $m_c(\\theta)/m_e$。我们从 $m_c(\\theta)$ 的表达式开始，并代入 $m_i = \\tilde{m}_i m_e$（对于 $i=x, y, z$）：\n$$\\frac{m_c(\\theta)}{m_e} = \\frac{1}{m_e} \\frac{\\sqrt{(m_e\\tilde{m}_x)(m_e\\tilde{m}_y)(m_e\\tilde{m}_z)}}{\\sqrt{(m_e\\tilde{m}_x)\\sin^2\\theta + (m_e\\tilde{m}_z)\\cos^2\\theta}}$$\n提出自由电子质量 $m_e$：\n$$\\frac{m_c(\\theta)}{m_e} = \\frac{1}{m_e} \\frac{m_e^{3/2}\\sqrt{\\tilde{m}_x\\tilde{m}_y\\tilde{m}_z}}{\\sqrt{m_e}\\sqrt{\\tilde{m}_x\\sin^2\\theta + \\tilde{m}_z\\cos^2\\theta}} = \\frac{m_e^{3/2}\\sqrt{\\tilde{m}_x\\tilde{m}_y\\tilde{m}_z}}{m_e^{3/2}\\sqrt{\\tilde{m}_x\\sin^2\\theta + \\tilde{m}_z\\cos^2\\theta}}$$\n这简化为最终的无量纲表达式：\n$$\\frac{m_c(\\theta)}{m_e} = \\sqrt{\\frac{\\tilde{m}_x \\tilde{m}_y \\tilde{m}_z}{\\tilde{m}_x \\sin^2\\theta + \\tilde{m}_z \\cos^2\\theta}}$$",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\tilde{m}_{x} \\tilde{m}_{y} \\tilde{m}_{z}}{\\tilde{m}_{x} \\sin^{2}\\theta + \\tilde{m}_{z} \\cos^{2}\\theta}}}$$"
        },
        {
            "introduction": "费米面的拓扑结构对材料的电子性质有着决定性的影响。当费米能级 $E_F$ 穿过能带结构中的鞍点（saddle point）时，费米面的连通性可能发生改变，这种现象被称为利夫希茨相变（Lifshitz transition）。本练习聚焦于这种拓扑相变，要求你分析在相变点附近，极端轨道及其对应的摆动质量如何随费米能级的微小变化而发生剧烈改变 。通过这个练习，你将亲身体会到费米面拓扑是如何成为调控材料物理性质（如输运和热力学性质）的关键因素。",
            "id": "3808117",
            "problem": "考虑一个三维金属，其导带在布里渊区的一个鞍点附近可以很好地用一个各向异性的有效质量色散关系来近似\n$$\nE(\\mathbf{k}) \\equiv E(k_x,k_y,k_z) = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right),\n$$\n其中 $m_{\\perp} > 0$ 和 $m_z > 0$ 是常数有效质量，$\\hbar$ 是约化普朗克常数，$E_c$ 是鞍点能量。设费米能为 $E_F = E_c + \\varepsilon$，其中能量偏移 $\\varepsilon$ 可以在零附近调节（一个颈部断裂的 Lifshitz 相变）。假设沿 $z$ 轴施加一个匀强磁场，使得半经典回旋轨道位于与磁场正交的平面内，并仅关注由上述色散关系决定的局域费米面几何（忽略布里渊区边界以及鞍点以外的任何附加能带特征）。\n\n从磁场中布洛赫电子的半经典动力学和朗道量子化条件出发，推导当 $\\varepsilon > 0$ 时（颈部连接区域）的极值 k 空间轨道面积 $A_{\\mathrm{ext}}(\\varepsilon)$（等能面被垂直于磁场的平面所截的极值截面积）以及相关的回旋有效质量 $m_c(\\varepsilon)$。然后，在上述局域二次模型的有效范围内，确定当 $\\varepsilon  0$ 时（颈部断裂区域）这个极值轨道会发生什么，并相应地给出 $\\varepsilon  0$ 时的 $A_{\\mathrm{ext}}(\\varepsilon)$ 和 $m_c(\\varepsilon)$。\n\n将极值轨道面积以 $\\mathrm{m}^{-2}$ 为单位表示，回旋质量以千克为单位表示。将你的最终答案以一个行矩阵的形式报告，该矩阵按顺序包含四个条目\n$$\nA_{\\mathrm{ext}}^{+}(\\varepsilon) \\quad \\ \\quad m_c^{+}(\\varepsilon) \\quad \\ \\quad A_{\\mathrm{ext}}^{-}(\\varepsilon) \\quad \\ \\quad m_c^{-}(\\varepsilon),\n$$\n其中上标 $+$ 和 $-$ 分别表示 $\\varepsilon > 0$ 和 $\\varepsilon  0$。不需要进行数值计算；请提供封闭形式的表达式。在你的最终方框答案中不要包含单位。为清晰起见，如果在局域二次模型中，当 $\\varepsilon  0$ 时在 $k_z = 0$ 附近不存在明确定义的极值轨道，请在您报告的矩阵中将 $A_{\\mathrm{ext}}^{-}(\\varepsilon)$ 和 $m_c^{-}(\\varepsilon)$ 设为 $0$。",
            "solution": "此问题需要经过验证。\n\n### 步骤1：提取已知条件\n-   色散关系：$E(\\mathbf{k}) \\equiv E(k_x, k_y, k_z) = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right)$\n-   有效质量参数：$m_{\\perp} > 0$ 和 $m_z > 0$\n-   常数：$\\hbar$ (约化普朗克常数), $E_c$ (鞍点能量)\n-   费米能：$E_F = E_c + \\varepsilon$\n-   磁场：匀强，沿 $z$ 轴施加\n-   假设：布洛赫电子的半经典动力学；分析局限于鞍点附近，忽略布里渊区边界。\n-   任务：推导两种情况下的极值 k 空间轨道面积 $A_{\\mathrm{ext}}(\\varepsilon)$ 和回旋有效质量 $m_c(\\varepsilon)$：$\\varepsilon > 0$ (用上标 $+$ 表示) 和 $\\varepsilon  0$ (用上标 $-$ 表示)。\n-   条件：如果对于 $\\varepsilon  0$ 的情况，在 $k_z = 0$ 附近不存在与 $\\varepsilon > 0$ 情况对应的明确定义的极值轨道，则必须将 $A_{\\mathrm{ext}}^{-}(\\varepsilon)$ 和 $m_c^{-}(\\varepsilon)$ 报告为 $0$。\n-   最终答案格式：一个包含四个有序结果的行矩阵：$A_{\\mathrm{ext}}^{+}(\\varepsilon)$、 $m_c^{+}(\\varepsilon)$、 $A_{\\mathrm{ext}}^{-}(\\varepsilon)$ 和 $m_c^{-}(\\varepsilon)$。\n\n### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题牢固地植根于金属的半经典理论。色散关系是电子能带结构在鞍点（一个双曲临界点）附近的标准二次近似。Lifshitz 相变的概念，即费米面拓扑结构在费米能穿过态密度奇点时发生变化，是凝聚态物理学中一个公认的现象。\n2.  **问题的适定性：** 该问题提供了所有必要的信息和明确的目标。给定的色散关系、参数和物理背景允许对所要求的量进行唯一的推导。关于如何处理 $\\varepsilon  0$ 情况的说明消除了任何模糊性。\n3.  **客观性：** 该问题使用固态物理学中精确、标准的术语进行描述，不含主观或非科学性语言。\n\n### 步骤3：结论与行动\n该问题是有效的，因为它具有科学合理性、适定性和客观性。将提供完整的解答。\n\n等能面由条件 $E(\\mathbf{k}) = E_F$ 定义。代入给定的表达式，我们有：\n$$\nE_c + \\varepsilon = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right)\n$$\n这可以简化为费米面方程：\n$$\n\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z} = \\frac{2\\varepsilon}{\\hbar^2}\n$$\n在半经典模型中，电子在匀强磁场 $\\mathbf{B} = B\\hat{\\mathbf{z}}$ 下于 $\\mathbf{k}$ 空间中的轨迹由布洛赫波的洛伦兹力定律 $\\hbar \\frac{d\\mathbf{k}}{dt} = -e\\mathbf{v}_{\\mathbf{k}} \\times \\mathbf{B}$ 决定。这意味着电子在 $\\mathbf{k}$ 空间中的运动被限制在等能面与垂直于磁场的平面的交线上。由于 $\\mathbf{B}$ 沿 $z$ 轴，这些平面由一个恒定的 $k_z$ 定义。\n\n在给定 $k_z$ 下，费米面的截面积是 $k_x$-$k_y$ 平面中轨道的面积。重新排列费米面方程来描述这个轨道，我们得到：\n$$\nk_x^2 + k_y^2 = m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}\\right)\n$$\n这是一个半径平方为 $r_k^2 = k_x^2 + k_y^2$ 的圆的方程。这个圆形轨道的面积 $A(k_z, \\varepsilon)$ 是 $\\pi r_k^2$：\n$$\nA(k_z, \\varepsilon) = \\pi m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}\\right)\n$$\n主导量子振荡现象的极值轨道出现在面积为驻值的 $k_z$ 处，即 $\\frac{\\partial A}{\\partial k_z} = 0$。\n$$\n\\frac{\\partial A}{\\partial k_z} = \\pi m_{\\perp}\\left(\\frac{2k_z}{m_z}\\right) = \\frac{2\\pi m_{\\perp} k_z}{m_z}\n$$\n将此导数设为零得到 $k_z = 0$。这对应一个极值轨道。该极值的性质取决于二阶导数的符号，$\\frac{\\partial^2 A}{\\partial k_z^2} = \\frac{2\\pi m_{\\perp}}{m_z}$。因为 $m_{\\perp} > 0$ 且 $m_z > 0$，所以这个二阶导数为正，表明在 $k_z = 0$ 处的极值是一个极小值。\n\n我们现在分析 $\\varepsilon$ 符号的两种情况。\n\n**情况1：$\\varepsilon > 0$ (颈部连接区域)**\n当 $\\varepsilon > 0$ 时，费米面是一个单叶双曲面。在 $k_z = 0$ 处的极值轨道是这个双曲面的“颈”。要使一个真实的轨道存在，其面积必须为正。由于 $\\varepsilon > 0$，对于任何实数 $k_z$，$\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}$ 这一项总是正的。极值面积 $A_{\\mathrm{ext}}(\\varepsilon)$ 是在 $k_z = 0$ 处的面积：\n$$\nA_{\\mathrm{ext}}^{+}(\\varepsilon) = A(k_z=0, \\varepsilon) = \\pi m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2}\\right) = \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}\n$$\n回旋有效质量 $m_c$ 由 Onsager 关系定义，$m_c = \\frac{\\hbar^2}{2\\pi}\\frac{\\partial A_{\\mathrm{ext}}}{\\partial E_F}$。由于 $E_F = E_c + \\varepsilon$，我们有 $\\frac{\\partial}{\\partial E_F} = \\frac{\\partial}{\\partial \\varepsilon}$。\n$$\n\\frac{\\partial A_{\\mathrm{ext}}^{+}}{\\partial \\varepsilon} = \\frac{\\partial}{\\partial \\varepsilon}\\left(\\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}\\right) = \\frac{2\\pi m_{\\perp}}{\\hbar^2}\n$$\n将此代入回旋质量的定义中：\n$$\nm_c^{+}(\\varepsilon) = \\frac{\\hbar^2}{2\\pi}\\left(\\frac{2\\pi m_{\\perp}}{\\hbar^2}\\right) = m_{\\perp}\n$$\n\n**情况2：$\\varepsilon  0$ (颈部断裂区域)**\n对于 $\\varepsilon  0$，我们定义 $\\varepsilon = -|\\varepsilon|$。费米面方程变为：\n$$\n\\frac{k_z^2}{m_z} - \\frac{k_x^2 + k_y^2}{m_{\\perp}} = \\frac{2|\\varepsilon|}{\\hbar^2}\n$$\n这是一个双叶双曲面的方程。费米面的拓扑结构已经改变。在 $\\varepsilon=0$ 处发生了一个 Lifshitz 相变。轨道截面的方程是：\n$$\nk_x^2 + k_y^2 = m_{\\perp}\\left(\\frac{k_z^2}{m_z} - \\frac{2|\\varepsilon|}{\\hbar^2}\\right)\n$$\n要使一个真实的轨道存在（即半径平方为非负），我们需要：\n$$\n\\frac{k_z^2}{m_z} \\ge \\frac{2|\\varepsilon|}{\\hbar^2} \\implies |k_z| \\ge \\frac{\\sqrt{2 m_z |\\varepsilon|}}{\\hbar}\n$$\n这表明在 $k_z = 0$ 附近的 $\\mathbf{k}$ 空间中存在一个没有轨道的间隙。在 $\\varepsilon > 0$ 时于 $k_z=0$ 处找到的极值轨道已经消失。当费米能降低穿过 $E_c$ 时，颈部轨道在 $\\varepsilon = 0$ 时收缩到零面积，然后在 $\\varepsilon  0$ 时消失。\n问题询问的是*这个*特定的极值轨道发生了什么。由于当 $\\varepsilon  0$ 时它不存在，并且在“$k_z=0$ 附近”不再有极值，我们遵循问题陈述中给出的明确指示。我们必须将该区域的极值面积和相关的回旋质量设为零。\n因此：\n$$\nA_{\\mathrm{ext}}^{-}(\\varepsilon) = 0\n$$\n$$\nm_c^{-}(\\varepsilon) = 0\n$$\n在这个局域模型中，新的轨道存在于 $|k_z| > \\frac{\\sqrt{2 m_z |\\varepsilon|}}{\\hbar}$ 处，但这些轨道与 $\\varepsilon > 0$ 情况下的中心极值轨道无关，并且它们的最小面积（在存在边界处）为零。在朗道量子化的背景下，零面积轨道没有物理意义，并且无论如何都会导致零回旋质量。\n\n总而言之，所要求的四个量是：\n1.  对于 $\\varepsilon > 0$：$A_{\\mathrm{ext}}^{+}(\\varepsilon) = \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}$\n2.  对于 $\\varepsilon > 0$：$m_c^{+}(\\varepsilon) = m_{\\perp}$\n3.  对于 $\\varepsilon  0$：$A_{\\mathrm{ext}}^{-}(\\varepsilon) = 0$\n4.  对于 $\\varepsilon  0$：$m_c^{-}(\\varepsilon) = 0$\n这些将以一个行矩阵的形式呈现。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}  m_{\\perp}  0  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论分析通常依赖于简化的解析模型，但在真实的材料研究中，复杂的能带结构和费米面必须通过数值方法处理。本练习将引导你从解析推导转向计算实践，这是现代材料模拟的核心技能。你将学习如何为一个给定的能带结构生成费米面的三角化网格，并利用该网格来计算费米面上的表面积分 。掌握这些计算工具是精确预测和理解材料的电导率、态密度和其它重要物理性质的基础。",
            "id": "3808146",
            "problem": "考虑晶体中的单电子能带，其能量色散是晶体动量的光滑函数。费米面（FS）是能带能量等于费米能量的动量点集合。设能带能量表示为 $E(\\mathbf{k})$，其中 $\\mathbf{k} \\in \\mathbb{R}^3$。费米能量为 $E_{\\mathrm{F}}$。费米面是由 $E(\\mathbf{k}) = E_{\\mathrm{F}}$ 定义的等值面。群速度由经过充分检验的公式 $\\,\\mathbf{v}(\\mathbf{k}) = \\frac{1}{\\hbar} \\nabla_{\\mathbf{k}} E(\\mathbf{k})\\,$ 定义。在此处使用的无量纲单位中，取 $\\hbar = 1$。对于由隐式方程 $f(\\mathbf{k}) = E(\\mathbf{k}) - E_{\\mathrm{F}} = 0$ 定义的费米面，其外向单位法向量为 $\\,\\mathbf{n}(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} f(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} f(\\mathbf{k})\\|} = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}\\,$。这些定义是计算费米面上费米速度和法向量的基本依据。\n\n你的任务是编写一个完整的程序，该程序能够：\n- 使用球面角（以弧度为单位）参数化方法，构建三种不同费米面的三角化近似。\n- 使用给定的 $E(\\mathbf{k})$ 的解析梯度，计算网格顶点处的费米速度矢量和外向单位法向量。\n- 通过对所有三角形的贡献求和，近似计算三个费米面上的曲面积分。\n\n所有工作均在无量纲单位下进行，其中 $\\hbar = 1$。角度必须以弧度处理。不需要物理单位。\n\n三角化方案：\n- 使用球面角 $(\\theta, \\phi)$ 对方向进行参数化，其中 $\\theta \\in [0, \\pi]$ 且 $\\phi \\in [0, 2\\pi)$。\n- 构建一个均匀间隔的矩形网格 $\\{\\theta_i\\}_{i=0}^{N_\\theta-1}$ 和 $\\{\\phi_j\\}_{j=0}^{N_\\phi-1}$。\n- 对于每个网格点，将 $(\\theta_i, \\phi_j)$ 映射到费米面上的一个点 $\\mathbf{k}_{i,j}$。映射方式取决于具体情况，如下所述。\n- 通过将每个网格单元分割成两个三角形来对曲面进行三角剖分：$(i,j) \\rightarrow (i+1,j) \\rightarrow (i+1,j+1)$ 和 $(i,j) \\rightarrow (i+1,j+1) \\rightarrow (i,j+1)$，其中 $\\phi$ 方向的索引进行循环处理，且 $i = 0,\\dots,N_\\theta-2$，$j = 0,\\dots,N_\\phi-1$。\n\n通过三角形求和进行数值计算的曲面积分：\n- 设 $dS$ 为 $\\mathbf{k}$ 空间中费米面上的面积元，$\\|\\mathbf{v}(\\mathbf{k})\\|$ 为速率。\n- 定义三个被积函数：\n    1. $g_1(\\mathbf{k}) = \\frac{1}{\\|\\mathbf{v}(\\mathbf{k})\\|}$。\n    2. $g_2(\\mathbf{k}) = \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|}$。\n    3. $g_3(\\mathbf{k}) = \\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}}$，其中 $\\hat{\\mathbf{z}} = (0,0,1)$。\n- 通过对所有网格三角形 $T$ 求和来近似积分：对于每个顶点为 $\\mathbf{k}_a, \\mathbf{k}_b, \\mathbf{k}_c$ 的三角形，计算其面积 $A_T = \\frac{1}{2}\\|(\\mathbf{k}_b-\\mathbf{k}_a) \\times (\\mathbf{k}_c-\\mathbf{k}_a)\\|$ 和被积函数的平均值 $\\bar{g}_m(T)$（即 $g_m$ 在三个顶点处值的算术平均值）。则对于 $m \\in \\{1,2,3\\}$，有 $\\,\\int g_m(\\mathbf{k})\\,dS \\approx \\sum_T A_T\\,\\bar{g}_m(T)\\,$。\n\n测试套件（三种情况）：\n- 情况 A（各向同性抛物线能带；球形费米面）：\n    - 能量：$E(\\mathbf{k}) = \\frac{1}{2} \\|\\mathbf{k}\\|^2$。\n    - 费米能量：$E_{\\mathrm{F}} = 1$。\n    - 球面映射：半径 $r = \\sqrt{2 E_{\\mathrm{F}}}$；$\\mathbf{k}(\\theta,\\phi) = r \\,(\\sin\\theta\\cos\\phi,\\ \\sin\\theta\\sin\\phi,\\ \\cos\\theta)$。\n    - 网格：$N_\\theta = 20$，$N_\\phi = 40$。\n- 情况 B（各向异性抛物线能带；椭球形费米面）：\n    - 能量：$E(\\mathbf{k}) = \\frac{1}{2}\\left(\\frac{k_x^2}{m_x} + \\frac{k_y^2}{m_y} + \\frac{k_z^2}{m_z}\\right)$，其中 $(m_x,m_y,m_z) = (1,2,3)$。\n    - 费米能量：$E_{\\mathrm{F}} = 1$。\n    - 椭球映射：主半轴 $r_x = \\sqrt{2 m_x E_{\\mathrm{F}}}$, $r_y = \\sqrt{2 m_y E_{\\mathrm{F}}}$, $r_z = \\sqrt{2 m_z E_{\\mathrm{F}}}$；$\\mathbf{k}(\\theta,\\phi) = (r_x \\sin\\theta\\cos\\phi,\\ r_y \\sin\\theta\\sin\\phi,\\ r_z \\cos\\theta)$。\n    - 网格：$N_\\theta = 24$，$N_\\phi = 48$。\n- 情况 C（具有四次各向异性的扭曲星形费米面）：\n    - 能量：$E(\\mathbf{k}) = \\alpha \\|\\mathbf{k}\\|^2 + \\beta\\left(k_x^4 + k_y^4 + k_z^4\\right)$，其中 $\\alpha = \\frac{1}{2}$ 且 $\\beta = 0.05$。\n    - 费米能量：$E_{\\mathrm{F}} = 1$。\n    - 映射：对于每个方向单位矢量 $\\hat{\\mathbf{n}}(\\theta,\\phi) = (\\sin\\theta\\cos\\phi,\\ \\sin\\theta\\sin\\phi,\\ \\cos\\theta)$，使用稳健的一维求根方法沿 $r$ 方向求解 $E\\!\\left(r \\hat{\\mathbf{n}}(\\theta,\\phi)\\right) = E_{\\mathrm{F}}$，找到半径 $r(\\theta,\\phi) > 0$，然后设置 $\\mathbf{k}(\\theta,\\phi) = r(\\theta,\\phi)\\,\\hat{\\mathbf{n}}(\\theta,\\phi)$。\n    - 网格：$N_\\theta = 32$，$N_\\phi = 64$。\n\n速度和法向量的计算：\n- 对于每种情况，解析地计算 $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$：\n    - 情况 A：$\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = \\mathbf{k}$。\n    - 情况 B：$\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = \\left(\\frac{k_x}{m_x}, \\frac{k_y}{m_y}, \\frac{k_z}{m_z}\\right)$。\n    - 情况 C：$\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = 2\\alpha\\,\\mathbf{k} + 4\\beta\\,(k_x^3, k_y^3, k_z^3)$。\n- 使用 $\\mathbf{v}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k})$ 和 $\\mathbf{n}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k}) / \\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|$。\n\n每种情况需要生成的数值输出：\n- $I_1 = \\int_{\\mathrm{FS}} \\frac{dS}{\\|\\mathbf{v}(\\mathbf{k})\\|}$ 的数值近似值。\n- 绝对差 $|I_2 - S|$，其中 $I_2 = \\int_{\\mathrm{FS}} \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|}\\, dS$，而 $S = \\int_{\\mathrm{FS}} dS$ 是通过对三角形面积求和计算出的总表面积。\n- 绝对值 $|I_3|$，其中 $I_3 = \\int_{\\mathrm{FS}} \\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}} \\, dS$。\n\n最终输出格式：\n- 你的程序应生成单行输出，包含九个浮点数，按 $[I_1^{(A)}, |I_2^{(A)} - S^{(A)}|, |I_3^{(A)}|, I_1^{(B)}, |I_2^{(B)} - S^{(B)}|, |I_3^{(B)}|, I_1^{(C)}, |I_2^{(C)} - S^{(C)}|, |I_3^{(C)}|]$ 的顺序排列，形式为方括号内的逗号分隔列表，不含任何其他文本。\n\n测试套件覆盖范围和边界情况：\n- 情况 A 是一个对称的费米面，其中 $\\mathbf{v}(\\mathbf{k})$ 是径向的；它用于检验基本算法。\n- 情况 B 增加了各向异性，用以测试对费米面上非均匀曲率和速率的处理。\n- 情况 C 对每个方向使用求根方法，以测试在扭曲的星形（而非简单的椭球体）费米面上的稳健性。\n\n你的程序必须是自包含的，无需任何输入。所有角度均以弧度为单位。所有计算都应在指定的无量纲单位下完成。",
            "solution": "问题陈述已经过严格验证，并被确定为是合理可靠的。它在科学上基于固体物理学原理，在数学上是适定的，并为数值计算提供了一套完整且一致的规范。所有的定义、参数和步骤都得到了清晰的阐述，构成了一个非平凡但可解的计算任务。\n\n该问题的核心是在三种不同的费米面（$FS$）模型上计算三个独立的曲面积分。$FS$ 是动量空间中电子能量色散 $E(\\mathbf{k})$ 的一个等值面，由 $E(\\mathbf{k}) = E_{\\mathrm{F}}$ 定义，其中 $E_{\\mathrm{F}}$ 是费米能量。\n\n基本的物理量是群速度 $\\mathbf{v}(\\mathbf{k})$ 和外向单位法向量 $\\mathbf{n}(\\mathbf{k})$。根据给定的约定 $\\hbar = 1$，它们是：\n$$\n\\mathbf{v}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k})\n$$\n$$\n\\mathbf{n}(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}\n$$\n问题要求为每种情况计算 $FS$ 上的三个积分：\n1.  $I_1 = \\int_{\\mathrm{FS}} g_1(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} \\frac{1}{\\|\\mathbf{v}(\\mathbf{k})\\|} \\,dS$\n2.  $I_2 = \\int_{\\mathrm{FS}} g_2(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|} \\,dS$\n3.  $I_3 = \\int_{\\mathrm{FS}} g_3(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} (\\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}}) \\,dS$，其中 $\\hat{\\mathbf{z}} = (0,0,1)$\n\n一个关键的观察可以简化被积函数 $g_2(\\mathbf{k})$。通过代入 $\\mathbf{v}(\\mathbf{k})$ 和 $\\mathbf{n}(\\mathbf{k})$ 的定义：\n$$\ng_2(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k}) \\cdot \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = \\frac{\\frac{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|^2}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = \\frac{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = 1\n$$\n只要在 $FS$ 上 $\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\| \\neq 0$，此式就成立。对于所提供的所有三种能量色散关系，梯度 $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$ 仅在 $\\mathbf{k}=\\mathbf{0}$ 处为零。由于在所有情况中 $E(\\mathbf{0}) = 0$ 且 $E_{\\mathrm{F}} = 1$，原点不在费米面上。因此，在整个 $FS$ 上 $g_2(\\mathbf{k}) = 1$。因此，积分 $I_2$ 解析地等于总表面积 $S = \\int_{\\mathrm{FS}} dS$。所要求的输出 $|I_2 - S|$ 可作为对数值积分方案一致性的验证，因为 $\\int_{\\mathrm{FS}} 1 \\, dS$ 的数值计算结果应与用于近似 $S$ 的所有三角形面积之和相匹配。\n\n此外，积分 $I_3$ 可以使用 $\\mathbf{k}$ 空间中的散度定理进行分析。对于矢量场 $\\mathbf{F}(\\mathbf{k}) = \\hat{\\mathbf{z}}$，我们有 $\\int_{V} (\\nabla_{\\mathbf{k}} \\cdot \\mathbf{F}) \\, d^3k = \\oint_{\\partial V} (\\mathbf{F} \\cdot \\mathbf{n}) \\, dS$。这里的边界 $\\partial V$ 是闭合的费米面。由于 $\\mathbf{F}$ 是一个恒定矢量，其散度为 $\\nabla_{\\mathbf{k}} \\cdot \\hat{\\mathbf{z}} = 0$。因此，该曲面积分必须为零：\n$$\nI_3 = \\int_{\\mathrm{FS}} \\hat{\\mathbf{z}} \\cdot \\mathbf{n}(\\mathbf{k}) \\,dS = 0\n$$\n$|I_3|$ 的数值计算结果预计会是一个很小的值，这反映了三角剖分的精度以及来自曲面不同部分贡献的相互抵消。\n\n数值方法将按如下方式实现：\n\n1.  **网格生成：** 对于每种情况，生成费米面上的点网格 $\\mathbf{k}_{i,j}$。创建一个尺寸为 $N_\\theta \\times N_\\phi$ 的球面角网格 $(\\theta_i, \\phi_j)$，其中 $\\theta_i \\in [0, \\pi]$ 且 $\\phi_j \\in [0, 2\\pi)$。\n    -   对于情况 A（球面）和 B（椭球），从 $(\\theta, \\phi)$ 到 $\\mathbf{k}$ 的映射由直接的参数公式给出。\n    -   对于情况 C，对于每个方向 $\\hat{\\mathbf{n}}(\\theta, \\phi)$，通过求解 $E(r\\hat{\\mathbf{n}}) = E_{\\mathrm{F}}$ 来确定半径 $r > 0$。能量函数 $E(\\mathbf{k}) = \\alpha \\|\\mathbf{k}\\|^2 + \\beta(k_x^4 + k_y^4 + k_z^4)$ 导出了一个关于 $r^2$ 的二次方程：$\\beta(n_x^4+n_y^4+n_z^4) r^4 + \\alpha r^2 - E_{\\mathrm{F}} = 0$。$r$ 的唯一正根可以解析地找到，从而避免了使用数值求根程序。\n\n2.  **顶点求值：** 在每个生成的顶点 $\\mathbf{k}_{i,j}$ 处，使用提供的 $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$ 的解析公式计算物理量 $\\mathbf{v}(\\mathbf{k})$、$\\|\\mathbf{v}(\\mathbf{k})\\|$、$\\mathbf{n}(\\mathbf{k})$ 以及被积函数 $g_1, g_2, g_3$。\n\n3.  **数值积分：** 费米面由一组三角形近似。对于参数网格中的每个矩形单元 $(i,j)$，由顶点 $\\{\\mathbf{k}_{i,j}, \\mathbf{k}_{i+1,j}, \\mathbf{k}_{i+1,j+1}, \\mathbf{k}_{i,j+1}\\}$ 构成两个三角形。积分通过对这些三角形求和来近似：$\\sum_T A_T \\bar{g}_m(T)$。\n    -   $A_T$ 是顶点为 $\\mathbf{k}_a, \\mathbf{k}_b, \\mathbf{k}_c$ 的三角形的面积，计算公式为 $A_T = \\frac{1}{2} \\|(\\mathbf{k}_b - \\mathbf{k}_a) \\times (\\mathbf{k}_c - \\mathbf{k}_a)\\|$。\n    -   $\\bar{g}_m(T)$ 是被积函数 $g_m$ 在三角形 $T$ 的三个顶点处值的平均值。\n整个过程——包括顶点生成、物理量评估以及对所有三角形的求和——都使用 `numpy` 库以矢量化方法实现，以提高计算效率。这种方法通过对顶点、矢量和面积的数组进行操作，避免了对三角形的显式循环。极点（$\\theta=0$ 和 $\\theta=\\pi$）处的三角剖分和 $\\phi$ 方向的周期性边界条件通过这种矢量化方法得到自然处理，因为极点处的退化三角形贡献的面积为零。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the calculation for all three test cases and print the final results.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"N_theta\": 20,\n            \"N_phi\": 40,\n            \"E_F\": 1.0,\n            \"params\": {},\n            \"grad_E_func\": lambda k, p: k,\n        },\n        {\n            \"name\": \"B\",\n            \"N_theta\": 24,\n            \"N_phi\": 48,\n            \"E_F\": 1.0,\n            \"params\": {\"m\": np.array([1.0, 2.0, 3.0])},\n            \"grad_E_func\": lambda k, p: k / p[\"m\"],\n        },\n        {\n            \"name\": \"C\",\n            \"N_theta\": 32,\n            \"N_phi\": 64,\n            \"E_F\": 1.0,\n            \"params\": {\"alpha\": 0.5, \"beta\": 0.05},\n            \"grad_E_func\": lambda k, p: 2 * p[\"alpha\"] * k + 4 * p[\"beta\"] * (k**3),\n        },\n    ]\n\n    final_results = []\n    for case_spec in test_cases:\n        results = calculate_integrals_for_case(case_spec)\n        final_results.extend(results)\n\n    # Use a format that provides sufficient precision for floating-point numbers.\n    print(f\"[{','.join(f'{res:.12e}' for res in final_results)}]\")\n\n\ndef calculate_integrals_for_case(spec):\n    \"\"\"\n    Performs the full calculation for a single case: mesh generation, vertex evaluation, and integration.\n    \"\"\"\n    # 1. Generate angular grid\n    N_theta, N_phi = spec[\"N_theta\"], spec[\"N_phi\"]\n    E_F = spec[\"E_F\"]\n    params = spec[\"params\"]\n    \n    # Create uniform grids in theta and phi\n    theta = np.linspace(0, np.pi, N_theta)\n    phi = np.linspace(0, 2 * np.pi, N_phi, endpoint=False)\n    THETA, PHI = np.meshgrid(theta, phi, indexing='ij')\n\n    # 2. Generate Fermi Surface mesh vertices (k_points)\n    n_hat_x = np.sin(THETA) * np.cos(PHI)\n    n_hat_y = np.sin(THETA) * np.sin(PHI)\n    n_hat_z = np.cos(THETA)\n    n_hat = np.stack([n_hat_x, n_hat_y, n_hat_z], axis=-1)\n\n    if spec[\"name\"] == \"A\":\n        r = np.sqrt(2 * E_F)\n        k_points = r * n_hat\n    elif spec[\"name\"] == \"B\":\n        m = params[\"m\"]\n        radii = np.sqrt(2 * E_F * m)\n        k_points = radii * n_hat\n    elif spec[\"name\"] == \"C\":\n        alpha, beta = params[\"alpha\"], params[\"beta\"]\n        # Solve E(r*n_hat) = E_F, which is a quadratic equation in r^2\n        # beta * C4 * r^4 + alpha * r^2 - E_F = 0, where C4 = sum(n_i^4)\n        c4 = np.sum(n_hat**4, axis=-1)\n        \n        # Denominator of quadratic formula solution for r^2\n        den = 2 * beta * c4\n        # a safe way to handle the case where beta or c4 is zero (although not for given params)\n        # if den is close to zero, it's the simple r^2=E_F/alpha case\n        is_degenerate = np.abs(den)  1e-15\n        r_sq = np.zeros_like(den)\n        \n        # Standard quadratic case\n        r_sq[~is_degenerate] = (-alpha + np.sqrt(alpha**2 + 4 * E_F * beta * c4[~is_degenerate])) / den[~is_degenerate]\n        # Degenerate case (alpha*r^2 = E_F)\n        if np.any(is_degenerate) and alpha > 0:\n            r_sq[is_degenerate] = E_F / alpha\n\n        r = np.sqrt(r_sq)\n        k_points = r[..., np.newaxis] * n_hat\n    \n    # 3. Evaluate physical quantities at each vertex\n    grad_E_func = spec[\"grad_E_func\"]\n    grad_E = grad_E_func(k_points, params)\n    \n    v_norm = np.linalg.norm(grad_E, axis=-1, keepdims=True)\n    # Prevent division by zero, though not expected on the FS\n    v_norm[v_norm  1e-16] = 1e-16\n    \n    n_vec = grad_E / v_norm\n\n    # 4. Compute integrands g1, g2, g3 at vertices\n    g1_vals = 1.0 / v_norm.squeeze(axis=-1)\n    \n    # As derived, g2 is analytically 1. Using this is more stable.\n    g2_vals = np.ones((N_theta, N_phi))\n    \n    g3_vals = n_vec[..., 2]\n\n    # 5. Vectorized summation over triangles\n    # Define vertex arrays for all triangles\n    k_ij = k_points[:-1, :, :]\n    k_ip1j = k_points[1:, :, :]\n    k_ijp1 = np.roll(k_ij, shift=-1, axis=1)\n    k_ip1jp1 = np.roll(k_ip1j, shift=-1, axis=1)\n\n    # Areas of the two types of triangles in each grid cell\n    # Triangle 1: (i, j), (i+1, j), (i+1, j+1)\n    area1 = 0.5 * np.linalg.norm(np.cross(k_ip1j - k_ij, k_ip1jp1 - k_ij), axis=-1)\n    # Triangle 2: (i, j), (i+1, j+1), (i, j+1)\n    area2 = 0.5 * np.linalg.norm(np.cross(k_ip1jp1 - k_ij, k_ijp1 - k_ij), axis=-1)\n    \n    S_total = np.sum(area1) + np.sum(area2)\n\n    # Helper to compute integral for any integrand g\n    def compute_integral(g_vals):\n        g_ij = g_vals[:-1, :]\n        g_ip1j = g_vals[1:, :]\n        g_ijp1 = np.roll(g_ij, shift=-1, axis=1)\n        g_ip1jp1 = np.roll(g_ip1j, shift=-1, axis=1)\n\n        # Average integrand over triangle vertices\n        g_bar1 = (g_ij + g_ip1j + g_ip1jp1) / 3.0\n        g_bar2 = (g_ij + g_ip1jp1 + g_ijp1) / 3.0\n\n        # Sum contributions\n        integral = np.sum(area1 * g_bar1) + np.sum(area2 * g_bar2)\n        return integral\n\n    I1 = compute_integral(g1_vals)\n    I2 = compute_integral(g2_vals)\n    I3 = compute_integral(g3_vals)\n\n    # 6. Return the required numerical outputs\n    return I1, abs(I2 - S_total), abs(I3)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}