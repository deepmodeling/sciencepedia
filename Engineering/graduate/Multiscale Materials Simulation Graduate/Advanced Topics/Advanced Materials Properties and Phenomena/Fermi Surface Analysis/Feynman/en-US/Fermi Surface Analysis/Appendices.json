{
    "hands_on_practices": [
        {
            "introduction": "A central theme in Fermi surface analysis is connecting the geometry of the Fermi surface to experimentally measurable quantities. This foundational exercise guides you through the derivation of the cyclotron effective mass ($m_c$) from the energy derivative of the extremal cross-sectional area ($A$) of the Fermi surface . Mastering this connection is crucial for interpreting quantum oscillation experiments, such as de Haas-van Alphen and Shubnikov-de Haas effects, which provide powerful probes of a material's electronic structure.",
            "id": "3808119",
            "problem": "Consider a three-dimensional crystal whose conduction band near the chemical potential is well described by an anisotropic parabolic dispersion. In the effective mass approximation, the single-electron energy as a function of crystal momentum is\n$$\nE(\\mathbf{k}) = \\frac{\\hbar^{2}}{2}\\left(\\frac{k_{x}^{2}}{m_{x}} + \\frac{k_{y}^{2}}{m_{y}} + \\frac{k_{z}^{2}}{m_{z}}\\right),\n$$\nwhere $m_{x}$, $m_{y}$, and $m_{z}$ are the principal components of the effective mass tensor along the Cartesian axes. A uniform magnetic field $\\mathbf{B}$ is applied, with unit direction vector $\\hat{\\mathbf{n}}$ lying in the $x$–$z$ plane, $\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$, where $\\theta$ is the angle with respect to the $z$ axis. Focus on the extremal cyclotron orbit defined by the intersection of the constant-energy surface with the plane perpendicular to $\\hat{\\mathbf{n}}$.\n\nStarting from a valid fundamental base—namely, semiclassical Bohr–Sommerfeld quantization of closed orbits in a magnetic field and the Onsager relation connecting Landau level indices to extremal cross-sectional areas—derive the general link between the cyclotron effective mass and the energy derivative of the extremal orbit area evaluated at the chemical potential. Then, for the anisotropic parabolic band given above, compute the extremal cross-sectional area $A(E)$ as a function of energy and $\\theta$, and obtain the corresponding cyclotron effective mass $m_{c}(\\theta)$. Finally, connect your result to the Lifshitz–Kosevich (LK) theory of quantum oscillations by expressing the thermal damping factor for oscillatory magnetization in terms of $m_{c}$, temperature $T$, magnetic field magnitude $B = |\\mathbf{B}|$, and fundamental constants, clearly identifying the dimensionless parameter controlling the damping.\n\nReport the final result as the closed-form analytic expression for the dimensionless ratio $m_{c}(\\theta)/m_{e}$, where $m_{e}$ is the free-electron mass. Express your answer in terms of the dimensionless principal mass ratios $\\tilde{m}_{x} = m_{x}/m_{e}$, $\\tilde{m}_{y} = m_{y}/m_{e}$, and $\\tilde{m}_{z} = m_{z}/m_{e}$, and the angle $\\theta$. No numerical evaluation is required. The final answer must be a single closed-form analytic expression. Since the requested ratio is dimensionless, no physical units are to be reported.",
            "solution": "The problem is subjected to validation before a solution is attempted.\n\n### Step 1: Extract Givens\n- **Energy Dispersion:** The single-electron energy as a function of crystal momentum $\\mathbf{k} = (k_x, k_y, k_z)$ is given by the anisotropic parabolic dispersion:\n$$E(\\mathbf{k}) = \\frac{\\hbar^{2}}{2}\\left(\\frac{k_{x}^{2}}{m_{x}} + \\frac{k_{y}^{2}}{m_{y}} + \\frac{k_{z}^{2}}{m_{z}}\\right)$$\nwhere $m_{x}$, $m_{y}$, and $m_{z}$ are the principal components of the effective mass tensor.\n- **Magnetic Field:** A uniform magnetic field $\\mathbf{B}$ is applied. Its magnitude is $B = |\\mathbf{B}|$ and its direction is given by the unit vector $\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$, lying in the $x$-$z$ plane at an angle $\\theta$ with the $z$ axis.\n- **Task:**\n  1. Derive the general link between the cyclotron effective mass $m_c$ and the energy derivative of the extremal orbit area $A$, evaluated at the chemical potential.\n  2. For the given dispersion, compute the extremal cross-sectional area $A(E)$ as a function of energy $E$ and angle $\\theta$.\n  3. Obtain the corresponding cyclotron effective mass $m_{c}(\\theta)$.\n  4. Connect the result to the Lifshitz-Kosevich (LK) theory by expressing the thermal damping factor in terms of $m_{c}$, temperature $T$, magnetic field magnitude $B$, and fundamental constants, identifying the controlling dimensionless parameter.\n  5. Report the final result as the closed-form analytic expression for the dimensionless ratio $m_{c}(\\theta)/m_{e}$, where $m_e$ is the free-electron mass, in terms of dimensionless mass ratios $\\tilde{m}_{x} = m_{x}/m_{e}$, $\\tilde{m}_{y} = m_{y}/m_{e}$, $\\tilde{m}_{z} = m_{z}/m_{e}$, and the angle $\\theta$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is firmly rooted in the semiclassical theory of electrons in solids, a cornerstone of condensed matter physics. It utilizes established concepts like the effective mass approximation, Bohr-Sommerfeld quantization of k-space orbits (the Onsager relation), and the Lifshitz-Kosevich theory for quantum oscillations. All premises are factually and scientifically sound.\n- **Well-Posed:** The problem is clearly structured, guiding the solver through a logical sequence of derivations. It requests a specific analytical expression, and the provided information is sufficient to derive a unique and meaningful solution.\n- **Objective:** The problem is stated in precise, unbiased, and formal scientific language, free of any subjectivity or opinion.\n- **Other Flaws:** The problem does not exhibit any other flaws. It is not incomplete, contradictory, unrealistic, or ill-posed. The concepts are standard in advanced solid-state physics curricula and relevant to the specified topic of Fermi surface analysis.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A full solution will be provided.\n\n### Solution Derivation\nThe solution is constructed by following the steps outlined in the problem statement.\n\nFirst, we derive the general relationship between the cyclotron effective mass $m_c$ and the extremal cross-sectional area $A$ of a constant-energy surface. The semiclassical quantization of an electron's orbit in k-space in a magnetic field $\\mathbf{B}$ is given by the Onsager-Bohr-Sommerfeld rule. The area $A$ enclosed by the orbit in the plane perpendicular to $\\mathbf{B}$ is quantized:\n$$A_n = (n + \\gamma) \\frac{2\\pi e B}{\\hbar}$$\nwhere $n$ is an integer representing the Landau level index, $e$ is the elementary charge, $\\hbar$ is the reduced Planck constant, $B$ is the magnetic field magnitude, and $\\gamma$ is a phase factor (typically $1/2$). The energy of these quantized levels is denoted by $E_n$. The energy separation between adjacent Landau levels is $\\Delta E = E_{n+1} - E_n$. For large $n$, we can approximate this separation as $\\Delta E \\approx \\frac{dE}{dn}$. From the quantization rule, the change in area between adjacent levels is $\\Delta A = A_{n+1} - A_n = \\frac{2\\pi e B}{\\hbar}$. Using the chain rule, we can write $\\frac{dE}{dn} = \\frac{dE}{dA} \\frac{dA}{dn}$. Approximating the derivatives with differences, we get $\\Delta E \\approx \\frac{dE}{dA} \\Delta A$.\nSubstituting the expression for $\\Delta A$:\n$$\\Delta E \\approx \\frac{dE}{dA} \\left(\\frac{2\\pi e B}{\\hbar}\\right)$$\nThe cyclotron resonance frequency $\\omega_c$ is defined by the energy spacing of Landau levels: $\\hbar\\omega_c = \\Delta E$. The cyclotron effective mass $m_c$ is defined via this frequency as $\\omega_c = \\frac{eB}{m_c}$. Substituting these definitions, we have:\n$$\\hbar \\left(\\frac{eB}{m_c}\\right) = \\frac{2\\pi e B}{\\hbar} \\frac{dE}{dA}$$\nSolving for $m_c$, we obtain the fundamental Onsager relation for the cyclotron mass:\n$$m_c = \\frac{\\hbar^2}{2\\pi} \\frac{dA}{dE}$$\nThis relation connects the cyclotron mass to the rate of change of the extremal cross-sectional area of the Fermi surface (or any constant-energy surface) with respect to energy.\n\nNext, we compute the extremal cross-sectional area $A(E)$ for the given anisotropic parabolic band. The constant-energy surface $E(\\mathbf{k}) = E$ is an ellipsoid in k-space described by the equation:\n$$\\frac{k_x^2}{m_x} + \\frac{k_y^2}{m_y} + \\frac{k_z^2}{m_z} = \\frac{2E}{\\hbar^2}$$\nThis can be rewritten in the standard form of an ellipsoid, $\\frac{k_x^2}{a^2} + \\frac{k_y^2}{b^2} + \\frac{k_z^2}{c^2} = 1$, with semi-axes:\n$$a = \\frac{\\sqrt{2m_x E}}{\\hbar}, \\quad b = \\frac{\\sqrt{2m_y E}}{\\hbar}, \\quad c = \\frac{\\sqrt{2m_z E}}{\\hbar}$$\nThe extremal orbit for an ellipsoidal Fermi surface corresponds to the central cross-section, which is the intersection of the ellipsoid with a plane passing through the origin of k-space and oriented perpendicular to the magnetic field $\\mathbf{B}$. The normal to this plane is the direction of the magnetic field, $\\hat{\\mathbf{n}} = (\\sin\\theta, 0, \\cos\\theta)$. The area of a central cross-section of the ellipsoid given above by a plane with normal $\\hat{\\mathbf{n}} = (n_x, n_y, n_z)$ is given by the formula:\n$$A = \\frac{\\pi abc}{\\sqrt{a^2 n_x^2 + b^2 n_y^2 + c^2 n_z^2}}$$\nIn our case, $n_x = \\sin\\theta$, $n_y = 0$, and $n_z = \\cos\\theta$. Substituting the expressions for the semi-axes and the components of the normal vector:\n$$A(E, \\theta) = \\frac{\\pi \\left(\\frac{\\sqrt{2m_x E}}{\\hbar}\\right)\\left(\\frac{\\sqrt{2m_y E}}{\\hbar}\\right)\\left(\\frac{\\sqrt{2m_z E}}{\\hbar}\\right)}{\\sqrt{\\left(\\frac{2m_x E}{\\hbar^2}\\right)\\sin^2\\theta + \\left(\\frac{2m_y E}{\\hbar^2}\\right)(0)^2 + \\left(\\frac{2m_z E}{\\hbar^2}\\right)\\cos^2\\theta}}$$\n$$A(E, \\theta) = \\frac{\\pi \\frac{(2E)^{3/2}\\sqrt{m_x m_y m_z}}{\\hbar^3}}{\\frac{\\sqrt{2E}}{\\hbar}\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\nSimplifying this expression yields the extremal area as a function of energy and angle:\n$$A(E, \\theta) = \\frac{2\\pi E}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\nWe observe that for a parabolic band, the area $A$ is directly proportional to the energy $E$.\n\nNow, we can compute the cyclotron effective mass $m_c(\\theta)$ using the Onsager relation. We need the derivative of $A(E, \\theta)$ with respect to $E$:\n$$\\frac{dA}{dE} = \\frac{d}{dE}\\left[\\left(\\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}\\right) E\\right] = \\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\nSubstituting this derivative into the formula for $m_c$:\n$$m_c(\\theta) = \\frac{\\hbar^2}{2\\pi} \\left(\\frac{dA}{dE}\\right) = \\frac{\\hbar^2}{2\\pi} \\left(\\frac{2\\pi}{\\hbar^2} \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}\\right)$$\nThis simplifies to the expression for the angle-dependent cyclotron mass:\n$$m_c(\\theta) = \\frac{\\sqrt{m_x m_y m_z}}{\\sqrt{m_x \\sin^2\\theta + m_z \\cos^2\\theta}}$$\n\nThe fourth part of the problem connects this result to the Lifshitz-Kosevich (LK) theory of quantum oscillations in the magnetization of a metal. The amplitude of these oscillations is reduced at finite temperatures by a thermal damping factor, $R_T$, given by:\n$$R_T = \\frac{X_T}{\\sinh(X_T)}$$\nThe argument $X_T$ is a dimensionless parameter that quantifies the thermal smearing of the Fermi-Dirac distribution relative to the Landau level spacing. It is defined as:\n$$X_T = \\frac{2\\pi^2 k_B T}{\\hbar \\omega_c}$$\nwhere $k_B$ is the Boltzmann constant and $T$ is the temperature. The dimensionless parameter controlling the damping is $X_T$. We express it in terms of the cyclotron mass $m_c$ by substituting $\\omega_c = eB/m_c$:\n$$X_T = \\frac{2\\pi^2 k_B T}{\\hbar (eB/m_c)} = \\frac{2\\pi^2 k_B T m_c}{\\hbar e B}$$\nThis parameter directly incorporates the cyclotron mass $m_c$, which we have just calculated. High cyclotron masses lead to stronger thermal damping of the quantum oscillations.\n\nFinally, we compute the required dimensionless ratio $m_c(\\theta)/m_e$ in terms of the dimensionless principal mass ratios $\\tilde{m}_{x} = m_{x}/m_{e}$, $\\tilde{m}_{y} = m_{y}/m_{e}$, and $\\tilde{m}_{z} = m_{z}/m_{e}$. We start with the expression for $m_c(\\theta)$ and substitute $m_i = \\tilde{m}_i m_e$ for $i=x, y, z$:\n$$\\frac{m_c(\\theta)}{m_e} = \\frac{1}{m_e} \\frac{\\sqrt{(m_e\\tilde{m}_x)(m_e\\tilde{m}_y)(m_e\\tilde{m}_z)}}{\\sqrt{(m_e\\tilde{m}_x)\\sin^2\\theta + (m_e\\tilde{m}_z)\\cos^2\\theta}}$$\nFactoring out the free-electron mass $m_e$:\n$$\\frac{m_c(\\theta)}{m_e} = \\frac{1}{m_e} \\frac{m_e^{3/2}\\sqrt{\\tilde{m}_x\\tilde{m}_y\\tilde{m}_z}}{\\sqrt{m_e}\\sqrt{\\tilde{m}_x\\sin^2\\theta + \\tilde{m}_z\\cos^2\\theta}} = \\frac{m_e^{3/2}\\sqrt{\\tilde{m}_x\\tilde{m}_y\\tilde{m}_z}}{m_e^{3/2}\\sqrt{\\tilde{m}_x\\sin^2\\theta + \\tilde{m}_z\\cos^2\\theta}}$$\nThis simplifies to the final dimensionless expression:\n$$\\frac{m_c(\\theta)}{m_e} = \\sqrt{\\frac{\\tilde{m}_x \\tilde{m}_y \\tilde{m}_z}{\\tilde{m}_x \\sin^2\\theta + \\tilde{m}_z \\cos^2\\theta}}$$",
            "answer": "$$\\boxed{\\sqrt{\\frac{\\tilde{m}_{x} \\tilde{m}_{y} \\tilde{m}_{z}}{\\tilde{m}_{x} \\sin^{2}\\theta + \\tilde{m}_{z} \\cos^{2}\\theta}}}$$"
        },
        {
            "introduction": "The topology of a Fermi surface is not always static; it can undergo dramatic changes, known as Lifshitz transitions, as external parameters like pressure, strain, or chemical doping are varied. This practice problem focuses on a classic example: a neck-disrupting transition occurring at a saddle point in the band structure . By analyzing the Fermi surface geometry and associated cyclotron mass as the Fermi energy crosses the critical point, you will gain a concrete understanding of how these topological changes manifest and impact electronic properties.",
            "id": "3808117",
            "problem": "Consider a three-dimensional metal whose conduction band near a saddle point in the Brillouin zone is well approximated by an anisotropic effective-mass dispersion\n$$\nE(\\mathbf{k}) \\equiv E(k_x,k_y,k_z) = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right),\n$$\nwhere $m_{\\perp} > 0$ and $m_z > 0$ are constant effective masses, $\\hbar$ is the reduced Planck constant, and $E_c$ is the saddle-point energy. Let the Fermi energy be $E_F = E_c + \\varepsilon$ with energy offset $\\varepsilon$ that can be tuned across zero (a neck-disrupting Lifshitz transition). Assume a uniform magnetic field is applied along the $z$-axis, so that semiclassical cyclotron orbits lie in planes orthogonal to the field, and focus exclusively on the local Fermi surface geometry controlled by the above dispersion (ignore Brillouin-zone boundaries and any additional band features away from the saddle).\n\nStarting from semiclassical dynamics of Bloch electrons in a magnetic field and the Landau quantization condition, derive the extremal $k$-space orbit area $A_{\\mathrm{ext}}(\\varepsilon)$ (the extremal cross-sectional area of the constant-energy surface intersected by planes normal to the magnetic field) and the associated cyclotron effective mass $m_c(\\varepsilon)$ for $\\varepsilon > 0$ (the connected-neck regime). Then determine what happens to this extremal orbit when $\\varepsilon < 0$ (the neck-disrupted regime) within the validity of the local quadratic model above, and provide $A_{\\mathrm{ext}}(\\varepsilon)$ and $m_c(\\varepsilon)$ for $\\varepsilon < 0$ accordingly.\n\nExpress the extremal orbit area in units of $\\mathrm{m}^{-2}$ and the cyclotron mass in kilograms. Report your final answer as a single row matrix containing four entries in the order\n$$\nA_{\\mathrm{ext}}^{+}(\\varepsilon) \\quad \\& \\quad m_c^{+}(\\varepsilon) \\quad \\& \\quad A_{\\mathrm{ext}}^{-}(\\varepsilon) \\quad \\& \\quad m_c^{-}(\\varepsilon),\n$$\nwhere the superscripts $+$ and $-$ denote $\\varepsilon > 0$ and $\\varepsilon < 0$, respectively. No numerical evaluation is required; provide closed-form expressions. Do not include units inside your final boxed answer. For clarity, if within the local quadratic model there is no well-defined extremal orbit for $\\varepsilon < 0$ near $k_z = 0$, set $A_{\\mathrm{ext}}^{-}(\\varepsilon)$ and $m_c^{-}(\\varepsilon)$ to $0$ in your reported matrix.",
            "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n-   Dispersion relation: $E(\\mathbf{k}) \\equiv E(k_x, k_y, k_z) = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right)$\n-   Effective mass parameters: $m_{\\perp} > 0$ and $m_z > 0$\n-   Constants: $\\hbar$ (reduced Planck constant), $E_c$ (saddle-point energy)\n-   Fermi energy: $E_F = E_c + \\varepsilon$\n-   Magnetic field: Uniform, applied along the $z$-axis\n-   Assumptions: Semiclassical dynamics of Bloch electrons; analysis is local to the saddle point, ignoring Brillouin-zone boundaries.\n-   Task: Derive the extremal $k$-space orbit area $A_{\\mathrm{ext}}(\\varepsilon)$ and the cyclotron effective mass $m_c(\\varepsilon)$ for two regimes: $\\varepsilon > 0$ (denoted by superscript $+$) and $\\varepsilon < 0$ (denoted by superscript $-$).\n-   Condition: If, for $\\varepsilon < 0$, a well-defined extremal orbit corresponding to the one for $\\varepsilon > 0$ does not exist near $k_z = 0$, then $A_{\\mathrm{ext}}^{-}(\\varepsilon)$ and $m_c^{-}(\\varepsilon)$ must be reported as $0$.\n-   Final Answer Format: A row matrix containing the four ordered results: $A_{\\mathrm{ext}}^{+}(\\varepsilon)$, $m_c^{+}(\\varepsilon)$, $A_{\\mathrm{ext}}^{-}(\\varepsilon)$, and $m_c^{-}(\\varepsilon)$.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded:** The problem is firmly rooted in the semiclassical theory of metals. The dispersion relation is a standard quadratic approximation for an electronic band structure near a saddle point (a hyperbolic critical point). The concept of a Lifshitz transition, where the Fermi surface topology changes as the Fermi energy crosses a singularity in the density of states, is a well-established phenomenon in condensed matter physics.\n2.  **Well-Posed:** The problem provides all necessary information and a clear objective. The given dispersion, parameters, and physical context allow for a unique derivation of the requested quantities. The instruction on how to handle the $\\varepsilon < 0$ case removes any ambiguity.\n3.  **Objective:** The problem is described using precise, standard terminology from solid-state physics and is free from subjective or non-scientific language.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, well-posed, and objective. A complete solution will be provided.\n\nThe constant-energy surface is defined by the condition $E(\\mathbf{k}) = E_F$. Substituting the given expressions, we have:\n$$\nE_c + \\varepsilon = E_c + \\frac{\\hbar^2}{2}\\left(\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z}\\right)\n$$\nThis simplifies to the equation for the Fermi surface:\n$$\n\\frac{k_x^2 + k_y^2}{m_{\\perp}} - \\frac{k_z^2}{m_z} = \\frac{2\\varepsilon}{\\hbar^2}\n$$\nIn the semiclassical model, the trajectory of an electron in $\\mathbf{k}$-space under a uniform magnetic field $\\mathbf{B} = B\\hat{\\mathbf{z}}$ is determined by the Lorentz force law for Bloch waves, $\\hbar \\frac{d\\mathbf{k}}{dt} = -e\\mathbf{v}_{\\mathbf{k}} \\times \\mathbf{B}$. This implies that the electron's motion in $\\mathbf{k}$-space is confined to the intersection of a constant-energy surface and a plane perpendicular to the magnetic field. Since $\\mathbf{B}$ is along the $z$-axis, these planes are defined by a constant $k_z$.\n\nThe cross-sectional area of the Fermi surface at a given $k_z$ is the area of the orbit in the $k_x$-$k_y$ plane. Rearranging the Fermi surface equation to describe this orbit, we get:\n$$\nk_x^2 + k_y^2 = m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}\\right)\n$$\nThis is the equation of a circle of radius squared $r_k^2 = k_x^2 + k_y^2$. The area of this circular orbit, $A(k_z, \\varepsilon)$, is $\\pi r_k^2$:\n$$\nA(k_z, \\varepsilon) = \\pi m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}\\right)\n$$\nExtremal orbits, which dominate quantum oscillation phenomena, occur at values of $k_z$ where the area is stationary, i.e., $\\frac{\\partial A}{\\partial k_z} = 0$.\n$$\n\\frac{\\partial A}{\\partial k_z} = \\pi m_{\\perp}\\left(\\frac{2k_z}{m_z}\\right) = \\frac{2\\pi m_{\\perp} k_z}{m_z}\n$$\nSetting this derivative to zero yields $k_z = 0$. This corresponds to an extremal orbit. The nature of this extremum depends on the sign of the second derivative, $\\frac{\\partial^2 A}{\\partial k_z^2} = \\frac{2\\pi m_{\\perp}}{m_z}$. Since $m_{\\perp} > 0$ and $m_z > 0$, this second derivative is positive, indicating that the extremum at $k_z = 0$ is a minimum.\n\nWe now analyze the two cases for the sign of $\\varepsilon$.\n\n**Case 1: $\\varepsilon > 0$ (Connected-neck regime)**\nFor $\\varepsilon > 0$, the Fermi surface is a hyperboloid of one sheet. The extremal orbit at $k_z = 0$ is the \"neck\" of this hyperboloid. For a real orbit to exist, the area must be positive. Since $\\varepsilon > 0$, the term $\\frac{2\\varepsilon}{\\hbar^2} + \\frac{k_z^2}{m_z}$ is always positive for any real $k_z$. The extremal area $A_{\\mathrm{ext}}(\\varepsilon)$ is the area at $k_z = 0$:\n$$\nA_{\\mathrm{ext}}^{+}(\\varepsilon) = A(k_z=0, \\varepsilon) = \\pi m_{\\perp}\\left(\\frac{2\\varepsilon}{\\hbar^2}\\right) = \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}\n$$\nThe cyclotron effective mass $m_c$ is defined by the Onsager relation, $m_c = \\frac{\\hbar^2}{2\\pi}\\frac{\\partial A_{\\mathrm{ext}}}{\\partial E_F}$. Since $E_F = E_c + \\varepsilon$, we have $\\frac{\\partial}{\\partial E_F} = \\frac{\\partial}{\\partial \\varepsilon}$.\n$$\n\\frac{\\partial A_{\\mathrm{ext}}^{+}}{\\partial \\varepsilon} = \\frac{\\partial}{\\partial \\varepsilon}\\left(\\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}\\right) = \\frac{2\\pi m_{\\perp}}{\\hbar^2}\n$$\nSubstituting this into the definition of the cyclotron mass:\n$$\nm_c^{+}(\\varepsilon) = \\frac{\\hbar^2}{2\\pi}\\left(\\frac{2\\pi m_{\\perp}}{\\hbar^2}\\right) = m_{\\perp}\n$$\n\n**Case 2: $\\varepsilon  0$ (Neck-disrupted regime)**\nFor $\\varepsilon  0$, let us define $\\varepsilon = -|\\varepsilon|$. The Fermi surface equation becomes:\n$$\n\\frac{k_z^2}{m_z} - \\frac{k_x^2 + k_y^2}{m_{\\perp}} = \\frac{2|\\varepsilon|}{\\hbar^2}\n$$\nThis is the equation of a hyperboloid of two sheets. The topology of the Fermi surface has changed. A Lifshitz transition has occurred at $\\varepsilon=0$. The equation for an orbital cross-section is:\n$$\nk_x^2 + k_y^2 = m_{\\perp}\\left(\\frac{k_z^2}{m_z} - \\frac{2|\\varepsilon|}{\\hbar^2}\\right)\n$$\nFor a real orbit to exist (i.e., for the radius squared to be non-negative), we require:\n$$\n\\frac{k_z^2}{m_z} \\ge \\frac{2|\\varepsilon|}{\\hbar^2} \\implies |k_z| \\ge \\frac{\\sqrt{2 m_z |\\varepsilon|}}{\\hbar}\n$$\nThis shows that there is a gap in $\\mathbf{k}$-space around $k_z = 0$ where no orbits exist. The extremal orbit found at $k_z=0$ for the $\\varepsilon > 0$ case has vanished. As the Fermi energy was lowered through $E_c$, the neck orbit shrank to zero area at $\\varepsilon = 0$ and then disappeared for $\\varepsilon  0$.\nThe problem asks what happens to *this* specific extremal orbit. Since it does not exist for $\\varepsilon  0$, and there is no longer an extremum \"near $k_z=0$\", we follow the explicit instruction provided in the problem statement. We must set the extremal area and associated cyclotron mass to zero for this regime.\nTherefore:\n$$\nA_{\\mathrm{ext}}^{-}(\\varepsilon) = 0\n$$\n$$\nm_c^{-}(\\varepsilon) = 0\n$$\nWithin this local model, new orbits exist at $|k_z| > \\frac{\\sqrt{2 m_z |\\varepsilon|}}{\\hbar}$, but these are not related to the central extremal orbit from the $\\varepsilon > 0$ case, and their minimum area (at the boundary of existence) is zero. A zero-area orbit has no physical meaning in the context of Landau quantization and would lead to a zero cyclotron mass anyway.\n\nIn summary, the four requested quantities are:\n1.  For $\\varepsilon > 0$: $A_{\\mathrm{ext}}^{+}(\\varepsilon) = \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}$\n2.  For $\\varepsilon > 0$: $m_c^{+}(\\varepsilon) = m_{\\perp}$\n3.  For $\\varepsilon  0$: $A_{\\mathrm{ext}}^{-}(\\varepsilon) = 0$\n4.  For $\\varepsilon  0$: $m_c^{-}(\\varepsilon) = 0$\nThese are to be presented in a single row matrix.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{2\\pi m_{\\perp} \\varepsilon}{\\hbar^2}  m_{\\perp}  0  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While analytical models are invaluable for building intuition, real materials often feature Fermi surfaces with intricate geometries that require numerical methods for analysis. This computational practice bridges the gap between theory and simulation by tasking you with building a program to analyze triangulated Fermi surfaces . You will implement methods to calculate key properties like Fermi velocities and surface normals, and use them to compute physical quantities through numerical integration, a core competency in modern materials modeling.",
            "id": "3808146",
            "problem": "Consider a single-electron band in crystalline solids where the energy dispersion is a smooth function of crystal momentum. The Fermi Surface (FS) is the set of momenta on which the band energy equals the Fermi energy. Let the band energy be denoted by $E(\\mathbf{k})$ with $\\mathbf{k} \\in \\mathbb{R}^3$. The Fermi energy is $E_{\\mathrm{F}}$. The FS is the level set defined by $E(\\mathbf{k}) = E_{\\mathrm{F}}$. The group velocity is defined by the well-tested formula $\\mathbf{v}(\\mathbf{k}) = \\frac{1}{\\hbar} \\nabla_{\\mathbf{k}} E(\\mathbf{k})$. In the dimensionless units used here, take $\\hbar = 1$. For the FS defined by an implicit equation $f(\\mathbf{k}) = E(\\mathbf{k}) - E_{\\mathrm{F}} = 0$, the outward unit normal is $\\mathbf{n}(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} f(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} f(\\mathbf{k})\\|} = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}$. These definitions are the fundamental base for computing Fermi velocities and normals on the FS.\n\nYour task is to write a complete program that:\n- Constructs triangulated approximations of three distinct Fermi Surfaces using spherical-angle parameterization in radians.\n- Computes the Fermi velocity vectors and outward unit normals at the mesh vertices using analytic gradients of the given $E(\\mathbf{k})$.\n- Approximates three FS surface integrals by summing contributions over triangles.\n\nWork entirely in dimensionless units with $\\hbar = 1$. Angles must be treated in radians. No physical units are required.\n\nTriangulation scheme:\n- Parameterize directions by spherical angles $(\\theta, \\phi)$ with $\\theta \\in [0, \\pi]$ and $\\phi \\in [0, 2\\pi)$.\n- Construct a rectangular grid $\\{\\theta_i\\}_{i=0}^{N_\\theta-1}$ and $\\{\\phi_j\\}_{j=0}^{N_\\phi-1}$ uniformly spaced.\n- For each grid point, map $(\\theta_i, \\phi_j)$ to a point on the FS $\\mathbf{k}_{i,j}$. The mapping is case-dependent as specified below.\n- Triangulate the surface by splitting each grid cell into two triangles: $(i,j) \\rightarrow (i+1,j) \\rightarrow (i+1,j+1)$ and $(i,j) \\rightarrow (i+1,j+1) \\rightarrow (i,j+1)$, with index wrap in $\\phi$ and using $i = 0,\\dots,N_\\theta-2$ and $j = 0,\\dots,N_\\phi-1$.\n\nSurface integrals to compute numerically via triangle summation:\n- Let $dS$ be the area element on the FS in $\\mathbf{k}$-space and $\\|\\mathbf{v}(\\mathbf{k})\\|$ the speed.\n- Define the three integrands:\n    1. $g_1(\\mathbf{k}) = \\frac{1}{\\|\\mathbf{v}(\\mathbf{k})\\|}$.\n    2. $g_2(\\mathbf{k}) = \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|}$.\n    3. $g_3(\\mathbf{k}) = \\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}}$, where $\\hat{\\mathbf{z}} = (0,0,1)$.\n- Approximate the integrals by summing over all mesh triangles $T$: for each triangle with vertices $\\mathbf{k}_a,\\mathbf{k}_b,\\mathbf{k}_c$, compute the triangle area $A_T = \\frac{1}{2}\\|(\\mathbf{k}_b-\\mathbf{k}_a) \\times (\\mathbf{k}_c-\\mathbf{k}_a)\\|$ and the average integrand value $\\bar{g}_m(T)$ as the arithmetic mean of $g_m$ at the three vertices. Then $\\int g_m(\\mathbf{k})\\,dS \\approx \\sum_T A_T\\,\\bar{g}_m(T)$ for $m \\in \\{1,2,3\\}$.\n\nTest suite (three cases):\n- Case A (isotropic parabolic band; spherical FS):\n    - Energy: $E(\\mathbf{k}) = \\frac{1}{2} \\|\\mathbf{k}\\|^2$.\n    - Fermi energy: $E_{\\mathrm{F}} = 1$.\n    - Spherical mapping: radius $r = \\sqrt{2 E_{\\mathrm{F}}}$; $\\mathbf{k}(\\theta,\\phi) = r \\,(\\sin\\theta\\cos\\phi,\\ \\sin\\theta\\sin\\phi,\\ \\cos\\theta)$.\n    - Grid: $N_\\theta = 20$, $N_\\phi = 40$.\n- Case B (anisotropic parabolic band; ellipsoidal FS):\n    - Energy: $E(\\mathbf{k}) = \\frac{1}{2}\\left(\\frac{k_x^2}{m_x} + \\frac{k_y^2}{m_y} + \\frac{k_z^2}{m_z}\\right)$ with $(m_x,m_y,m_z) = (1,2,3)$.\n    - Fermi energy: $E_{\\mathrm{F}} = 1$.\n    - Ellipsoidal mapping: principal radii $r_x = \\sqrt{2 m_x E_{\\mathrm{F}}}$, $r_y = \\sqrt{2 m_y E_{\\mathrm{F}}}$, $r_z = \\sqrt{2 m_z E_{\\mathrm{F}}}$; $\\mathbf{k}(\\theta,\\phi) = (r_x \\sin\\theta\\cos\\phi,\\ r_y \\sin\\theta\\sin\\phi,\\ r_z \\cos\\theta)$.\n    - Grid: $N_\\theta = 24$, $N_\\phi = 48$.\n- Case C (warped star-shaped FS with quartic anisotropy):\n    - Energy: $E(\\mathbf{k}) = \\alpha \\|\\mathbf{k}\\|^2 + \\beta\\left(k_x^4 + k_y^4 + k_z^4\\right)$ with $\\alpha = \\frac{1}{2}$ and $\\beta = 0.05$.\n    - Fermi energy: $E_{\\mathrm{F}} = 1$.\n    - Mapping: for each direction unit vector $\\hat{\\mathbf{n}}(\\theta,\\phi) = (\\sin\\theta\\cos\\phi,\\ \\sin\\theta\\sin\\phi,\\ \\cos\\theta)$, find radius $r(\\theta,\\phi)  0$ solving $E\\!\\left(r \\hat{\\mathbf{n}}(\\theta,\\phi)\\right) = E_{\\mathrm{F}}$ using a robust one-dimensional root search along $r$, then set $\\mathbf{k}(\\theta,\\phi) = r(\\theta,\\phi)\\,\\hat{\\mathbf{n}}(\\theta,\\phi)$.\n    - Grid: $N_\\theta = 32$, $N_\\phi = 64$.\n\nVelocity and normal evaluation:\n- For each case, compute $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$ analytically:\n    - Case A: $\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = \\mathbf{k}$.\n    - Case B: $\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = \\left(\\frac{k_x}{m_x}, \\frac{k_y}{m_y}, \\frac{k_z}{m_z}\\right)$.\n    - Case C: $\\nabla_{\\mathbf{k}} E(\\mathbf{k}) = 2\\alpha\\,\\mathbf{k} + 4\\beta\\,(k_x^3, k_y^3, k_z^3)$.\n- Use $\\mathbf{v}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k})$ and $\\mathbf{n}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k}) / \\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|$.\n\nNumerical outputs to produce for each case:\n- The numerical approximation of $I_1 = \\int_{\\mathrm{FS}} \\frac{dS}{\\|\\mathbf{v}(\\mathbf{k})\\|}$.\n- The absolute difference $|I_2 - S|$, where $I_2 = \\int_{\\mathrm{FS}} \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|}\\, dS$ and $S = \\int_{\\mathrm{FS}} dS$ is the surface area computed by summing triangle areas.\n- The absolute value $|I_3|$, where $I_3 = \\int_{\\mathrm{FS}} \\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}} \\, dS$.\n\nFinal output format:\n- Your program should produce a single line of output containing nine floats ordered as $[I_1^{(A)}, |I_2^{(A)} - S^{(A)}|, |I_3^{(A)}|, I_1^{(B)}, |I_2^{(B)} - S^{(B)}|, |I_3^{(B)}|, I_1^{(C)}, |I_2^{(C)} - S^{(C)}|, |I_3^{(C)}|]$ as a comma-separated list enclosed in square brackets, with no additional text.\n\nTest suite coverage and edge cases:\n- Case A is a symmetric FS where $\\mathbf{v}(\\mathbf{k})$ is radial; it exercises the basic algorithm.\n- Case B adds anisotropy to test handling of nonuniform curvature and speeds across the FS.\n- Case C uses root-finding per direction to test robustness on a warped FS that is star-shaped but not simply an ellipsoid.\n\nYour program must be self-contained and require no input. All angles are in radians. All computations are to be done in the specified dimensionless units.",
            "solution": "The problem statement has been rigorously validated and is determined to be sound. It is scientifically grounded in the principles of solid-state physics, mathematically well-posed, and provides a complete and consistent set of specifications for a numerical computation. All definitions, parameters, and procedures are clearly articulated, forming a non-trivial but solvable computational task.\n\nThe core of the problem is to compute three distinct surface integrals over three different models of a Fermi surface ($FS$). The $FS$ is a level set of the electron energy dispersion $E(\\mathbf{k})$ in momentum space, defined by $E(\\mathbf{k}) = E_{\\mathrm{F}}$, where $E_{\\mathrm{F}}$ is the Fermi energy.\n\nThe fundamental physical quantities are the group velocity $\\mathbf{v}(\\mathbf{k})$ and the outward unit normal vector $\\mathbf{n}(\\mathbf{k})$. With the given convention $\\hbar = 1$, these are:\n$$\n\\mathbf{v}(\\mathbf{k}) = \\nabla_{\\mathbf{k}} E(\\mathbf{k})\n$$\n$$\n\\mathbf{n}(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}\n$$\nThe problem requires computing three integrals over the $FS$ for each case:\n1.  $I_1 = \\int_{\\mathrm{FS}} g_1(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} \\frac{1}{\\|\\mathbf{v}(\\mathbf{k})\\|} \\,dS$\n2.  $I_2 = \\int_{\\mathrm{FS}} g_2(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} \\frac{\\mathbf{v}(\\mathbf{k}) \\cdot \\mathbf{n}(\\mathbf{k})}{\\|\\mathbf{v}(\\mathbf{k})\\|} \\,dS$\n3.  $I_3 = \\int_{\\mathrm{FS}} g_3(\\mathbf{k}) \\,dS = \\int_{\\mathrm{FS}} (\\mathbf{n}(\\mathbf{k}) \\cdot \\hat{\\mathbf{z}}) \\,dS$, where $\\hat{\\mathbf{z}} = (0,0,1)$\n\nA key observation simplifies the integrand $g_2(\\mathbf{k})$. By substituting the definitions of $\\mathbf{v}(\\mathbf{k})$ and $\\mathbf{n}(\\mathbf{k})$:\n$$\ng_2(\\mathbf{k}) = \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k}) \\cdot \\frac{\\nabla_{\\mathbf{k}} E(\\mathbf{k})}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = \\frac{\\frac{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|^2}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = \\frac{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|}{\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\|} = 1\n$$\nThis holds provided $\\|\\nabla_{\\mathbf{k}} E(\\mathbf{k})\\| \\neq 0$ on the $FS$. For all three energy dispersions provided, the gradient $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$ is zero only at $\\mathbf{k}=\\mathbf{0}$. Since $E(\\mathbf{0}) = 0$ and $E_{\\mathrm{F}} = 1$ in all cases, the origin is not on the Fermi surface. Thus, $g_2(\\mathbf{k}) = 1$ everywhere on the $FS$. Consequently, the integral $I_2$ is analytically equal to the total surface area $S = \\int_{\\mathrm{FS}} dS$. The required output $|I_2 - S|$ serves as a verification of the numerical integration scheme's consistency, as the numerical evaluation of $\\int_{\\mathrm{FS}} 1 \\, dS$ should match the sum of the triangle areas used to approximate $S$.\n\nFurthermore, the integral $I_3$ can be analyzed using the Divergence Theorem in $\\mathbf{k}$-space. For a vector field $\\mathbf{F}(\\mathbf{k}) = \\hat{\\mathbf{z}}$, we have $\\int_{V} (\\nabla_{\\mathbf{k}} \\cdot \\mathbf{F}) \\, d^3k = \\oint_{\\partial V} (\\mathbf{F} \\cdot \\mathbf{n}) \\, dS$. Here, the boundary $\\partial V$ is the closed Fermi surface. Since $\\mathbf{F}$ is a constant vector, its divergence is $\\nabla_{\\mathbf{k}} \\cdot \\hat{\\mathbf{z}} = 0$. Therefore, the surface integral must be zero:\n$$\nI_3 = \\int_{\\mathrm{FS}} \\hat{\\mathbf{z}} \\cdot \\mathbf{n}(\\mathbf{k}) \\,dS = 0\n$$\nThe numerical computation of $|I_3|$ is expected to be a small value, reflecting the accuracy of the triangulation and the cancellation of contributions from different parts of the surface.\n\nThe numerical approach will be implemented as follows:\n\n1.  **Mesh Generation:** For each case, a grid of points on the Fermi surface, $\\mathbf{k}_{i,j}$, is generated. A grid of spherical angles $(\\theta_i, \\phi_j)$ of size $N_\\theta \\times N_\\phi$ is created, where $\\theta_i \\in [0, \\pi]$ and $\\phi_j \\in [0, 2\\pi)$.\n    -   For Cases A (sphere) and B (ellipsoid), the mapping from $(\\theta, \\phi)$ to $\\mathbf{k}$ is given by a direct parametric formula.\n    -   For Case C, for each direction $\\hat{\\mathbf{n}}(\\theta, \\phi)$, the radius $r  0$ is determined by solving $E(r\\hat{\\mathbf{n}}) = E_{\\mathrm{F}}$. The energy function $E(\\mathbf{k}) = \\alpha \\|\\mathbf{k}\\|^2 + \\beta(k_x^4 + k_y^4 + k_z^4)$ leads to a quadratic equation for $r^2$: $\\beta(n_x^4+n_y^4+n_z^4) r^4 + \\alpha r^2 - E_{\\mathrm{F}} = 0$. The unique positive root for $r$ is found analytically, avoiding the need for a numerical root-finding routine.\n\n2.  **Vertex Evaluation:** At each generated vertex $\\mathbf{k}_{i,j}$, the physical quantities $\\mathbf{v}(\\mathbf{k})$, $\\|\\mathbf{v}(\\mathbf{k})\\|$, $\\mathbf{n}(\\mathbf{k})$ and the integrands $g_1, g_2, g_3$ are calculated using the provided analytical formulae for $\\nabla_{\\mathbf{k}} E(\\mathbf{k})$.\n\n3.  **Numerical Integration:** The Fermi surface is approximated by a set of triangles. For each rectangular cell $(i,j)$ in the parameter grid, two triangles are formed from the vertices $\\{\\mathbf{k}_{i,j}, \\mathbf{k}_{i+1,j}, \\mathbf{k}_{i+1,j+1}, \\mathbf{k}_{i,j+1}\\}$. The integrals are approximated as a sum over these triangles: $\\sum_T A_T \\bar{g}_m(T)$.\n    -   $A_T$ is the area of a triangle with vertices $\\mathbf{k}_a, \\mathbf{k}_b, \\mathbf{k}_c$, computed as $A_T = \\frac{1}{2} \\|(\\mathbf{k}_b - \\mathbf{k}_a) \\times (\\mathbf{k}_c - \\mathbf{k}_a)\\|$.\n    -   $\\bar{g}_m(T)$ is the average of the integrand $g_m$ evaluated at the three vertices of triangle $T$.\n    The entire process—including vertex generation, evaluation of physical quantities, and summation over all triangles—is implemented using a vectorized approach with the `numpy` library for computational efficiency. This avoids explicit loops over triangles by operating on arrays of vertices, vectors, and areas. The triangulation at the poles ($\\theta=0$ and $\\theta=\\pi$) and the periodic boundary condition in $\\phi$ are handled naturally by this vectorized method, as degenerate triangles at the poles contribute zero area.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the calculation for all three test cases and print the final results.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"N_theta\": 20,\n            \"N_phi\": 40,\n            \"E_F\": 1.0,\n            \"params\": {},\n            \"grad_E_func\": lambda k, p: k,\n        },\n        {\n            \"name\": \"B\",\n            \"N_theta\": 24,\n            \"N_phi\": 48,\n            \"E_F\": 1.0,\n            \"params\": {\"m\": np.array([1.0, 2.0, 3.0])},\n            \"grad_E_func\": lambda k, p: k / p[\"m\"],\n        },\n        {\n            \"name\": \"C\",\n            \"N_theta\": 32,\n            \"N_phi\": 64,\n            \"E_F\": 1.0,\n            \"params\": {\"alpha\": 0.5, \"beta\": 0.05},\n            \"grad_E_func\": lambda k, p: 2 * p[\"alpha\"] * k + 4 * p[\"beta\"] * (k**3),\n        },\n    ]\n\n    final_results = []\n    for case_spec in test_cases:\n        results = calculate_integrals_for_case(case_spec)\n        final_results.extend(results)\n\n    # Use a format that provides sufficient precision for floating-point numbers.\n    print(f\"[{','.join(f'{res:.12e}' for res in final_results)}]\")\n\n\ndef calculate_integrals_for_case(spec):\n    \"\"\"\n    Performs the full calculation for a single case: mesh generation, vertex evaluation, and integration.\n    \"\"\"\n    # 1. Generate angular grid\n    N_theta, N_phi = spec[\"N_theta\"], spec[\"N_phi\"]\n    E_F = spec[\"E_F\"]\n    params = spec[\"params\"]\n    \n    # Create uniform grids in theta and phi\n    theta = np.linspace(0, np.pi, N_theta)\n    phi = np.linspace(0, 2 * np.pi, N_phi, endpoint=False)\n    THETA, PHI = np.meshgrid(theta, phi, indexing='ij')\n\n    # 2. Generate Fermi Surface mesh vertices (k_points)\n    n_hat_x = np.sin(THETA) * np.cos(PHI)\n    n_hat_y = np.sin(THETA) * np.sin(PHI)\n    n_hat_z = np.cos(THETA)\n    n_hat = np.stack([n_hat_x, n_hat_y, n_hat_z], axis=-1)\n\n    if spec[\"name\"] == \"A\":\n        r = np.sqrt(2 * E_F)\n        k_points = r * n_hat\n    elif spec[\"name\"] == \"B\":\n        m = params[\"m\"]\n        radii = np.sqrt(2 * E_F * m)\n        k_points = radii * n_hat\n    elif spec[\"name\"] == \"C\":\n        alpha, beta = params[\"alpha\"], params[\"beta\"]\n        # Solve E(r*n_hat) = E_F, which is a quadratic equation in r^2\n        # beta * C4 * r^4 + alpha * r^2 - E_F = 0, where C4 = sum(n_i^4)\n        c4 = np.sum(n_hat**4, axis=-1)\n        \n        # Denominator of quadratic formula solution for r^2\n        den = 2 * beta * c4\n        # a safe way to handle the case where beta or c4 is zero (although not for given params)\n        # if den is close to zero, it's the simple r^2=E_F/alpha case\n        is_degenerate = np.abs(den)  1e-15\n        r_sq = np.zeros_like(den)\n        \n        # Standard quadratic case\n        r_sq[~is_degenerate] = (-alpha + np.sqrt(alpha**2 + 4 * E_F * beta * c4[~is_degenerate])) / den[~is_degenerate]\n        # Degenerate case (alpha*r^2 = E_F)\n        if np.any(is_degenerate) and alpha  0:\n            r_sq[is_degenerate] = E_F / alpha\n\n        r = np.sqrt(r_sq)\n        k_points = r[..., np.newaxis] * n_hat\n    \n    # 3. Evaluate physical quantities at each vertex\n    grad_E_func = spec[\"grad_E_func\"]\n    grad_E = grad_E_func(k_points, params)\n    \n    v_norm = np.linalg.norm(grad_E, axis=-1, keepdims=True)\n    # Prevent division by zero, though not expected on the FS\n    v_norm[v_norm  1e-16] = 1e-16\n    \n    n_vec = grad_E / v_norm\n\n    # 4. Compute integrands g1, g2, g3 at vertices\n    g1_vals = 1.0 / v_norm.squeeze(axis=-1)\n    \n    # As derived, g2 is analytically 1. Using this is more stable.\n    g2_vals = np.ones((N_theta, N_phi))\n    \n    g3_vals = n_vec[..., 2]\n\n    # 5. Vectorized summation over triangles\n    # Define vertex arrays for all triangles\n    k_ij = k_points[:-1, :, :]\n    k_ip1j = k_points[1:, :, :]\n    k_ijp1 = np.roll(k_ij, shift=-1, axis=1)\n    k_ip1jp1 = np.roll(k_ip1j, shift=-1, axis=1)\n\n    # Areas of the two types of triangles in each grid cell\n    # Triangle 1: (i, j), (i+1, j), (i+1, j+1)\n    area1 = 0.5 * np.linalg.norm(np.cross(k_ip1j - k_ij, k_ip1jp1 - k_ij), axis=-1)\n    # Triangle 2: (i, j), (i+1, j+1), (i, j+1)\n    area2 = 0.5 * np.linalg.norm(np.cross(k_ip1jp1 - k_ij, k_ijp1 - k_ij), axis=-1)\n    \n    S_total = np.sum(area1) + np.sum(area2)\n\n    # Helper to compute integral for any integrand g\n    def compute_integral(g_vals):\n        g_ij = g_vals[:-1, :]\n        g_ip1j = g_vals[1:, :]\n        g_ijp1 = np.roll(g_ij, shift=-1, axis=1)\n        g_ip1jp1 = np.roll(g_ip1j, shift=-1, axis=1)\n\n        # Average integrand over triangle vertices\n        g_bar1 = (g_ij + g_ip1j + g_ip1jp1) / 3.0\n        g_bar2 = (g_ij + g_ip1jp1 + g_ijp1) / 3.0\n\n        # Sum contributions\n        integral = np.sum(area1 * g_bar1) + np.sum(area2 * g_bar2)\n        return integral\n\n    I1 = compute_integral(g1_vals)\n    I2 = compute_integral(g2_vals)\n    I3 = compute_integral(g3_vals)\n\n    # 6. Return the required numerical outputs\n    return I1, abs(I2 - S_total), abs(I3)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}