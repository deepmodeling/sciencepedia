{
    "hands_on_practices": [
        {
            "introduction": "本练习探讨了流体动力学区域中的动态结构因子，在该区域中，涨落的时空尺度远大于微观相互作用的尺度。此时，流体的集体行为占主导地位，产生了被称为瑞利-布里渊三重峰的独特光谱特征。通过分析线性化的流体动力学方程，您将把宏观输运系数与 $S(k, \\omega)$ 的形状联系起来，从而深入理解散射实验如何探测声波和热扩散等集体模式 。",
            "id": "3794908",
            "problem": "考虑一个简单的可压缩牛顿流体，在长波长、低频率的流体动力学范围内，其密度和动量涨落由守恒定律和线性不可逆热力学所支配。目标是推导和计算动态结构因子（DSF），定义为 $S(\\mathbf{k},\\omega)$，它对应于波矢为 $\\mathbf{k}$、角频率为 $\\omega$ 的密度涨落，并识别瑞利-布里渊三重峰的出现：一个与热扩散相关的中心峰和两个与声传播相关的对称位移的侧峰。\n\n从以下基本且广为接受的基础出发：\n- 质量守恒（连续性方程）：$\\partial_t \\rho + \\nabla \\cdot (\\rho \\mathbf{v}) = 0$，在均匀平衡态附近进行线性化。\n- 动量守恒（牛顿流体的线性化纳维-斯托克斯方程）：$\\rho_0 \\partial_t \\mathbf{v} = -\\nabla p + \\eta \\nabla^2 \\mathbf{v} + \\left(\\zeta + \\frac{\\eta}{3}\\right)\\nabla (\\nabla \\cdot \\mathbf{v})$，其中 $\\rho_0$ 是平衡质量密度，$p$ 是压力，$\\eta$ 是剪切粘度，$\\zeta$ 是体粘度。\n- 能量守恒和傅里叶热传导定律，经线性化后可得到温度涨落的热扩散动力学，其热扩散率为 $D_T$。\n- 联系压力、密度和温度涨落的热力学关系，包括比热比 $\\gamma = c_p/c_v$ 和绝热声速 $c_s = \\sqrt{\\left(\\frac{\\partial p}{\\partial \\rho}\\right)_s}$。\n\n将动态结构因子（DSF）定义为频域中的密度涨落谱，\n$$\nS(\\mathbf{k},\\omega) = \\frac{1}{2\\pi N}\\int_{-\\infty}^{\\infty} dt\\, e^{i\\omega t} \\left\\langle \\delta \\rho_{\\mathbf{k}}(t)\\, \\delta \\rho_{-\\mathbf{k}}(0) \\right\\rangle,\n$$\n其中 $N$ 是粒子数，$\\delta \\rho_{\\mathbf{k}}(t)$ 是波矢为 $\\mathbf{k}$ 的密度涨落的空间傅里叶分量。在流体动力学极限 $|\\mathbf{k}|\\to 0$ 且 $|\\omega|$ 相对于微观频率很小的情况下，证明 $S(\\mathbf{k},\\omega)$ 由三种线型组成，分别对应于一个扩散热模式和两个传播声模式。使用上述基本原理，推导它们的中心、宽度和相对权重，用 $|\\mathbf{k}|$、$\\gamma$、$c_s$、$D_T$ 和纵向运动粘度 $\\nu_L = \\dfrac{4\\eta/3 + \\zeta}{\\rho_0}$ 表示。\n\n然后，设计一个算法，为给定的参数集 $(|\\mathbf{k}|, \\gamma, c_s, D_T, \\nu_L)$ 计算以下七个定量输出，并使用指定的精确单位：\n1. 中心瑞利峰的半高全宽（FWHM），单位为 $\\text{rad}\\,\\text{s}^{-1}$。\n2. 每个布里渊侧峰的半高全宽（FWHM），单位为 $\\text{rad}\\,\\text{s}^{-1}$。\n3. 布里渊峰中心角频率 $|\\omega_B|$，单位为 $\\text{rad}\\,\\text{s}^{-1}$。\n4. 中心瑞利峰的无量纲积分权重（面积分数）。\n5. 单个布里渊侧峰的无量纲积分权重（面积分数）。\n6. 归一化DSF在 $\\omega=0$（瑞利峰中心）处的峰值，表示为一个无量纲浮点数，其中DSF被归一化，使其在所有 $\\omega$ 上的积分等于 $1$。\n7. 归一化DSF在 $\\omega=+\\omega_B$（右侧布里渊峰中心）处的峰值，表示为一个无量纲浮点数，使用与上述相同的归一化方式。\n\n您的程序必须实现这个算法，并为以下参数集的测试套件生成结果。请精确使用给定的数值，并将 $|\\mathbf{k}|$ 的单位视为 $\\text{m}^{-1}$，$\\gamma$ 无量纲，$c_s$ 的单位视为 $\\text{m}\\,\\text{s}^{-1}$，$D_T$ 的单位视为 $\\text{m}^2\\,\\text{s}^{-1}$，$\\nu_L$ 的单位视为 $\\text{m}^2\\,\\text{s}^{-1}$：\n- 测试用例1（典型的类液体，中等 $|\\mathbf{k}|$）：$|\\mathbf{k}| = 1.0\\times 10^{7}$，$\\gamma = 1.01$，$c_s = 1500.0$，$D_T = 1.4\\times 10^{-7}$，$\\nu_L = 2.0\\times 10^{-6}$。\n- 测试用例2（边界小波数）：$|\\mathbf{k}| = 1.0\\times 10^{3}$，$\\gamma = 1.01$，$c_s = 1500.0$，$D_T = 1.4\\times 10^{-7}$，$\\nu_L = 2.0\\times 10^{-6}$。\n- 测试用例3（类单原子气体参数）：$|\\mathbf{k}| = 1.0\\times 10^{5}$，$\\gamma = 5.0/3.0$，$c_s = 343.0$，$D_T = 2.2\\times 10^{-5}$，$\\nu_L = 2.5\\times 10^{-5}$。\n- 测试用例4（$\\gamma \\to 1$ 的等温极限，以抑制瑞利峰权重）：$|\\mathbf{k}| = 5.0\\times 10^{6}$，$\\gamma = 1.0$，$c_s = 2000.0$，$D_T = 1.0\\times 10^{-7}$，$\\nu_L = 1.0\\times 10^{-6}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的七个输出被分组到一个子列表中。最终输出格式必须是：\n$[ [r_1, r_2, r_3, r_4, r_5, r_6, r_7], [\\dots], [\\dots], [\\dots] ]$\n其中，对于每个测试用例，$r_1$ 到 $r_7$ 是按上述顺序排列的浮点数。",
            "solution": "所提供的物理问题是统计力学和凝聚态物理中的一个标准练习。它在科学上是合理的、适定的和完整的。所有必要的物理定律、定义和参数都已提供，以推导出一个唯一且有意义的解。该问题没有任何说明中列出的无效缺陷。因此，该问题被认为是有效的，并将提供完整的解决方案。\n\n目标是计算动态结构因子 $S(\\mathbf{k},\\omega)$，它描述了流体中自发密度涨落的谱。在流体动力学极限（小波矢 $|\\mathbf{k}|=k$ 和小角频率 $\\omega$）下，动力学由质量、动量和能量守恒的线性化方程控制。对这些耦合线性方程组的分析揭示了流体的集体模式，这些模式在 $S(k,\\omega)$ 中表现为不同的峰。\n\n推导从密度（$\\delta\\rho_{\\mathbf{k}}$）、纵向速度（$v_{\\mathbf{k}}$）和温度（$\\delta T_{\\mathbf{k}}$）涨落的傅里叶变换后的线性化流体动力学方程开始。该代数方程组只有在其系数矩阵的行列式为零时才有非平凡解。该特征方程的根决定了流体动力学模式的色散关系 $\\omega(k)$。对于一个简单的可压缩流体，可以找到三种这样的模式：\n\n1. 一对反向传播的阻尼声模式。这些模式源于压力和惯性的相互作用。它们对应于谱中的布里渊峰。它们的色散关系近似为：\n$$ \\omega = \\pm c_s k - i\\Gamma_S k^2 $$\n这里，$c_s$ 是绝热声速，它给出了峰位在 $\\omega_B = \\pm c_s k$。虚部描述了声波的阻尼，其半高半宽（HWHM）$\\Gamma_S$ 由下式给出：\n$$ \\Gamma_S = \\frac{1}{2} \\left[ \\nu_L + (\\gamma - 1) D_T \\right] $$\n其中 $\\nu_L$ 是纵向运动粘度，$D_T$ 是热扩散率，$\\gamma = c_p/c_v$ 是比热比。阻尼源于粘性损失（通过 $\\nu_L$）和热弛豫（通过 $D_T$）。\n\n2. 一个非传播的扩散热模式。该模式描述了在恒定压力下熵（或温度）涨落的扩散。它对应于中心的瑞利峰。其色散关系为：\n$$ \\omega = -i\\Gamma_R k^2 $$\n该峰位于 $\\omega = 0$ 处，其半高半宽 $\\Gamma_R$ 由下式给出：\n$$ \\Gamma_R = D_T $$\n该峰的宽度完全由热扩散决定。\n\n动态结构因子 $S(k,\\omega)$ 是这些模式光谱特征的总和。假设峰值是良好分离的（$c_s k \\gg \\Gamma_S, \\Gamma_R$），$S(k,\\omega)$ 可以建模为三个洛伦兹函数的和。将总积分强度归一化（$\\int_{-\\infty}^{\\infty} S(k, \\omega) d\\omega = 1$），DSF由下式给出：\n$$ S_{norm}(k, \\omega) = \\frac{1}{\\pi} \\left[ \\left(1 - \\frac{1}{\\gamma}\\right) \\frac{\\Gamma_R k^2}{\\omega^2 + (\\Gamma_R k^2)^2} + \\frac{1}{2\\gamma} \\left( \\frac{\\Gamma_S k^2}{(\\omega - c_s k)^2 + (\\Gamma_S k^2)^2} + \\frac{\\Gamma_S k^2}{(\\omega + c_s k)^2 + (\\Gamma_S k^2)^2} \\right) \\right] $$\n前置因子 $(1 - 1/\\gamma)$ 和 $1/(2\\gamma)$ 分别是中心峰和单个侧峰的积分权重。它们的和为 $(1 - 1/\\gamma) + 2(1/(2\\gamma)) = 1$。中心峰积分强度与总布里渊峰积分强度之比为 $(\\gamma-1)$，这一结果被称为朗道-普拉切克比。\n\n基于这一理论基础，我们可以为给定的参数集（$k, \\gamma, c_s, D_T, \\nu_L$）推导出七个所需的量。设 $k = |\\mathbf{k}|$。\n\n1. 瑞利峰的半高全宽（FWHM）$W_R$ 是其半高半宽 $\\Gamma_R k^2$ 的两倍：\n$$ W_R = 2 \\Gamma_R k^2 = 2 D_T k^2 $$\n\n2. 每个布里渊峰的半高全宽（FWHM）$W_S$ 是其半高半宽 $\\Gamma_S k^2$ 的两倍：\n$$ W_S = 2 \\Gamma_S k^2 = \\left( \\nu_L + (\\gamma - 1) D_T \\right) k^2 $$\n\n3. 布里渊峰中心角频率 $|\\omega_B|$ 由声色散决定：\n$$ |\\omega_B| = c_s k $$\n\n4. 中心瑞利峰的无量纲积分权重 $I_R$ 是瑞利洛伦兹函数的前置因子：\n$$ I_R = 1 - \\frac{1}{\\gamma} $$\n\n5. 单个布里渊侧峰的无量纲积分权重 $I_S$ 是单个布里渊洛伦兹函数的前置因子：\n$$ I_S = \\frac{1}{2\\gamma} $$\n\n6. 归一化DSF在 $\\omega=0$ 处的峰值是通过将 $\\omega=0$ 代入 $S_{norm}(k, \\omega)$ 的完整表达式得到的。这包括瑞利分量的峰值以及布里渊分量尾部的贡献：\n$$ S_{norm}(k, 0) = \\frac{1}{\\pi} \\left[ \\left(1 - \\frac{1}{\\gamma}\\right) \\frac{1}{\\Gamma_R k^2} + \\frac{1}{\\gamma} \\frac{\\Gamma_S k^2}{(c_s k)^2 + (\\Gamma_S k^2)^2} \\right] $$\n\n7. 归一化DSF在 $\\omega = \\omega_B = c_s k$ 处的峰值是通过将 $\\omega = c_s k$ 代入 $S_{norm}(k, \\omega)$ 的完整表达式得到的。这包括一个布里渊分量的峰值以及瑞利分量和另一个布里渊分量尾部的贡献：\n$$ S_{norm}(k, c_s k) = \\frac{1}{\\pi} \\left[ \\left(1 - \\frac{1}{\\gamma}\\right) \\frac{\\Gamma_R k^2}{(c_s k)^2 + (\\Gamma_R k^2)^2} + \\frac{1}{2\\gamma} \\left( \\frac{1}{\\Gamma_S k^2} + \\frac{\\Gamma_S k^2}{(2 c_s k)^2 + (\\Gamma_S k^2)^2} \\right) \\right] $$\n\n最终答案中实现的算法使用了这些精确的公式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the properties of the dynamic structure factor for given test cases.\n    \"\"\"\n\n    # Test cases parameters:\n    # (|k| [m^-1], gamma, c_s [m/s], D_T [m^2/s], nu_L [m^2/s])\n    test_cases = [\n        (1.0e7, 1.01, 1500.0, 1.4e-7, 2.0e-6),\n        (1.0e3, 1.01, 1500.0, 1.4e-7, 2.0e-6),\n        (1.0e5, 5.0/3.0, 343.0, 2.2e-5, 2.5e-5),\n        (5.0e6, 1.0, 2000.0, 1.0e-7, 1.0e-6),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = calculate_dsf_properties(case)\n        all_results.append(result)\n\n    # Format the final output string as per problem specification.\n    # e.g., [[r1,r2,...],[...],...]\n    sublist_strings = []\n    for res in all_results:\n        sublist_strings.append(f\"[{','.join(map(str, res))}]\")\n    final_output = f\"[{','.join(sublist_strings)}]\"\n\n    print(final_output)\n\ndef calculate_dsf_properties(params):\n    \"\"\"\n    Calculates the seven specified quantitative outputs for the DSF.\n\n    Args:\n        params (tuple): A tuple containing the physical parameters:\n                        (k_val, gamma, c_s, D_T, nu_L)\n\n    Returns:\n        list: A list of seven float values corresponding to the required outputs.\n    \"\"\"\n    k_val, gamma, c_s, D_T, nu_L = params\n    k_sq = k_val**2\n\n    # Calculate Half-Width at Half-Maximum (HWHM) for Rayleigh and Brillouin peaks\n    hwhm_R = D_T * k_sq\n    hwhm_S = 0.5 * (nu_L + (gamma - 1.0) * D_T) * k_sq\n\n    # 1. FWHM of the central Rayleigh peak\n    fwhm_R = 2.0 * hwhm_R\n\n    # 2. FWHM of each Brillouin side peak\n    fwhm_S = 2.0 * hwhm_S\n\n    # 3. Brillouin peak center angular frequency\n    omega_B = c_s * k_val\n\n    # Handle the gamma = 1 case to avoid division by zero in weight calculation\n    # and to ensure the formula remains physically meaningful (isothermal limit).\n    if gamma == 1.0:\n        weight_R = 0.0\n    else:\n        # 4. Integrated weight of the central Rayleigh peak\n        weight_R = 1.0 - 1.0 / gamma\n    \n    # 5. Integrated weight of one Brillouin side peak\n    weight_S = 1.0 / (2.0 * gamma)\n\n    # 6. On-peak value of the normalized DSF at omega = 0\n    # S_norm(k, 0) = (1/pi) * [ (1-1/gamma)/hwhm_R + (1/gamma) * hwhm_S / (omega_B^2 + hwhm_S^2) ]\n    # This must handle the case where gamma = 1, in which case the first term is 0.\n    # It must also handle the case where hwhm_R = 0, which can happen if D_T=0.\n    # The problem has D_T > 0, so hwhm_R > 0 except for k=0.\n    \n    term1_peak_R = 0.0\n    if weight_R > 0 and hwhm_R > 0:\n        term1_peak_R = weight_R / hwhm_R\n        \n    term2_peak_R = (2.0 * weight_S) * hwhm_S / (omega_B**2 + hwhm_S**2)\n    peak_val_R = (1.0 / np.pi) * (term1_peak_R + term2_peak_R)\n\n    # 7. On-peak value of the normalized DSF at omega = +omega_B\n    # S_norm(k, omega_B) = (1/pi) * [ (1-1/gamma)*hwhm_R/(omega_B^2+hwhm_R^2) + \n    #                                (1/(2gamma))*(1/hwhm_S + hwhm_S/((2*omega_B)^2+hwhm_S^2)) ]\n    \n    term1_peak_S = 0.0\n    if weight_R > 0:\n        term1_peak_S = weight_R * hwhm_R / (omega_B**2 + hwhm_R**2)\n\n    term2_peak_S_main = 0.0\n    if hwhm_S > 0:\n        term2_peak_S_main = 1.0 / hwhm_S\n        \n    term2_peak_S_tail = hwhm_S / ((2.0 * omega_B)**2 + hwhm_S**2)\n    \n    peak_val_S = (1.0 / np.pi) * (term1_peak_S + weight_S * (term2_peak_S_main + term2_peak_S_tail))\n\n    return [fwhm_R, fwhm_S, omega_B, weight_R, weight_S, peak_val_R, peak_val_S]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "与长波长下的集体行为相反，高动量转移极限使我们能够探测单个粒子的动力学。本练习深入研究了脉冲近似，其中散射事件非常迅速，以至于粒子被视为自由反冲，从而揭示其初始动量。您将推导出该区域中的 $S(q, \\omega)$ 如何直接与麦克斯韦-玻尔兹曼速度分布相关，从而基本上提供了粒子热运动的快照 。",
            "id": "3794892",
            "problem": "考虑一个处于平衡状态的稀薄单原子经典气体，其温度为 $T$（单位为 $\\mathrm{K}$），由质量为 $m$（单位为 $\\mathrm{kg}$）的粒子组成。设 $\\mathbf{q}$ 为散射波矢量，其大小为 $q$（单位为 $\\mathrm{m}^{-1}$），$\\omega$ 为角频率（单位为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$）。动态结构因子 $S(q,\\omega)$ 定义为中间散射函数的时间傅里叶变换，而中间散射函数本身基于系统中的密度-密度相关性。在高 $q$ 极限下，脉冲近似适用：散射事件足够短暂，以至于粒子在散射时间内的运动可视为弹道运动，并且事件期间的相互作用可以忽略不计。使用以下基本原理：\n\n- 中间散射函数 $F(q,t)$ 根据密度场定义为经典轨迹上相位因子的系综平均，动态结构因子 $S(q,\\omega)$ 是 $F(q,t)$ 关于角频率 $\\omega$ 的时间傅里叶变换。\n- 对于平衡状态下的稀薄气体，粒子速度遵循 Maxwell–Boltzmann 分布，该分布是各向同性的，并通过玻尔兹曼常数 $k_{\\mathrm{B}}$ 依赖于质量 $m$ 和温度 $T$。\n\n从这些基本原理出发，在经典高 $q$ 脉冲近似范围内，推导 $S(q,\\omega)$ 关于 $q$、$\\omega$、$m$、$T$ 和 $k_{\\mathrm{B}}$ 的表达式。您的推导必须从第一性原理出发，不得假定任何 $S(q,\\omega)$ 的闭式表达式。\n\n推导出表达式后，请实现一个程序，对以下每个测试用例进行 $S(q,\\omega)$ 的数值计算。使用玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J}\\,\\mathrm{K}^{-1}$。程序必须以国际单位制处理所有物理量，其中 $\\omega$ 单位为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$，$q$ 单位为 $\\mathrm{m}^{-1}$，$m$ 单位为 $\\mathrm{kg}$，$T$ 单位为 $\\mathrm{K}$，并且必须以 $\\mathrm{s}$ 为单位输出 $S(q,\\omega)$。您必须为以下测试套件生成数值结果：\n\n- 情况 1 (正常路径)：$m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$，$T = 3.00 \\times 10^{2}\\,\\mathrm{K}$，$q = 8.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$，$\\omega = 0.00\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n- 情况 2 (频率尾部)：$m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$，$T = 3.00 \\times 10^{2}\\,\\mathrm{K}$，$q = 8.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$，$\\omega = 1.00 \\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n- 情况 3 (低 q 边界检查)：$m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$，$T = 3.00 \\times 10^{2}\\,\\mathrm{K}$，$q = 1.00 \\times 10^{8}\\,\\mathrm{m}^{-1}$，$\\omega = 1.00 \\times 10^{9}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n- 情况 4 (重粒子低温气体)：$m = 1.00 \\times 10^{-25}\\,\\mathrm{kg}$，$T = 5.00 \\times 10^{1}\\,\\mathrm{K}$，$q = 5.00 \\times 10^{10}\\,\\mathrm{m}^{-1}$，$\\omega = 2.00 \\times 10^{12}\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n- 情况 5 (极高 q 标度)：$m = 6.63 \\times 10^{-26}\\,\\mathrm{kg}$，$T = 3.00 \\times 10^{2}\\,\\mathrm{K}$，$q = 2.00 \\times 10^{11}\\,\\mathrm{m}^{-1}$，$\\omega = 0.00\\,\\mathrm{rad}\\,\\mathrm{s}^{-1}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，$[result1,result2,result3]$）。每个 $result$ 都必须是一个浮点数，表示相应测试用例的 $S(q,\\omega)$ 值（单位为 $\\mathrm{s}$），该值使用您推导的表达式计算得出。",
            "solution": "用户要求推导稀薄单原子经典气体在脉冲近似下的动态结构因子 $S(q, \\omega)$，并进行数值实现。\n\n### 问题验证\n**步骤 1：提取已知条件**\n- 系统：处于平衡状态的稀薄单原子经典气体。\n- 温度：$T$ (单位为 $\\mathrm{K}$)。\n- 粒子质量：$m$ (单位为 $\\mathrm{kg}$)。\n- 散射波矢量：$\\mathbf{q}$ (大小为 $q$，单位为 $\\mathrm{m^{-1}}$)。\n- 角频率：$\\omega$ (单位为 $\\mathrm{rad\\,s^{-1}}$)。\n- 近似：高 $q$ 脉冲近似（弹道粒子运动，散射期间相互作用可忽略）。\n- 基本原理 1：中间散射函数 $F(q,t)$ 根据密度场定义为系综平均。动态结构因子 $S(q,\\omega)$ 是 $F(q,t)$ 的时间傅里叶变换。\n- 基本原理 2：粒子速度遵循 Maxwell–Boltzmann 分布，该分布依赖于 $m$ 和 $T$。\n- 常数：玻尔兹曼常数 $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23}\\,\\mathrm{J}\\,\\mathrm{K}^{-1}$。\n- 任务：推导 $S(q, \\omega)$ 的表达式，并对五个测试用例进行数值实现。\n- 输出格式：单行输出，包含用方括号括起来的 $S(q,\\omega)$（单位为秒）的数值结果，结果之间用逗号分隔。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题是统计力学和凝聚态物理中的一个标准练习。动态结构因子、脉冲近似和 Maxwell-Boltzmann 分布等概念都是基础且完善的科学原理。\n- **良态问题**：问题陈述清晰，提供了唯一推导和后续数值计算所需的所有物理量、常数和理论约束。\n- **客观性**：问题以精确、无偏见的科学语言陈述。\n\n该问题没有任何科学上不合理、信息缺失或含糊不清等缺陷。这是一个有效且良态的物理学问题。\n\n**步骤 3：结论与行动**\n该问题有效。下面将给出推导和求解过程。\n\n### 动态结构因子 $S(q, \\omega)$ 的推导\n\n动态结构因子 $S(q, \\omega)$ 定义为中间散射函数 $F(q, t)$ 的时间傅里叶变换。我们首先在指定条件下推导 $F(q, t)$ 的形式。\n\n1. 对于一个包含 $N$ 个粒子的系统，中间散射函数 $F(\\mathbf{q}, t)$ 定义为微观密度涨落的自相关函数：\n$$\nF(\\mathbf{q}, t) = \\frac{1}{N} \\left\\langle \\sum_{j=1}^{N} \\sum_{k=1}^{N} e^{-i \\mathbf{q} \\cdot \\mathbf{r}_j(0)} e^{i \\mathbf{q} \\cdot \\mathbf{r}_k(t)} \\right\\rangle\n$$\n其中 $\\mathbf{r}_j(t)$ 是第 $j$ 个粒子在时间 $t$ 的位置，$\\langle \\dots \\rangle$ 表示系综平均。\n\n2. 对于稀薄气体，不同粒子的位置和速度是不相关的。因此，双重求和中的交叉项（$j \\neq k$）的平均值为零。该函数主要由“自”部（$j = k$）决定，该部分描述单个粒子的运动。由于所有粒子都是相同的，我们可以考虑一个有代表性的粒子：\n$$\nF(q, t) \\approx F_s(q, t) = \\left\\langle e^{i \\mathbf{q} \\cdot (\\mathbf{r}(t) - \\mathbf{r}(0))} \\right\\rangle\n$$\n由于气体的各向同性，该函数仅依赖于大小 $q=|\\mathbf{q}|$。\n\n3. 现在我们应用脉冲近似，该近似在高 $q$ 极限下有效。此极限对应于在极短的时间和长度尺度上探测系统。在此类尺度上，粒子的运动可有效视为弹道运动，且不受原子间势能的影响。其轨迹由下式给出：\n$$\n\\mathbf{r}(t) = \\mathbf{r}(0) + \\mathbf{v}t\n$$\n其中 $\\mathbf{v}$ 是粒子的初始速度，在短暂的散射持续时间内保持恒定。将此代入 $F_s(q,t)$ 的表达式中：\n$$\nF_s(q, t) = \\left\\langle e^{i \\mathbf{q} \\cdot (\\mathbf{v}t)} \\right\\rangle = \\left\\langle e^{i t (\\mathbf{q} \\cdot \\mathbf{v})} \\right\\rangle\n$$\n\n4. 系综平均变成了对粒子速度分布的平均。对于处于温度 $T$ 热平衡状态的经典气体，该分布是 Maxwell-Boltzmann 分布，$P(\\mathbf{v})$：\n$$\nP(\\mathbf{v}) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{3/2} \\exp\\left(-\\frac{m |\\mathbf{v}|^2}{2 k_{\\mathrm{B}} T}\\right)\n$$\n于是中间散射函数为：\n$$\nF_s(q, t) = \\int d^3v \\, P(\\mathbf{v}) \\, e^{i t (\\mathbf{q} \\cdot \\mathbf{v})}\n$$\n\n5. 为计算此积分，我们调整坐标系，使波矢量 $\\mathbf{q}$ 与 $z$ 轴平行，即 $\\mathbf{q} = (0, 0, q)$。于是，$\\mathbf{q} \\cdot \\mathbf{v} = q v_z$。积分可分解为：\n$$\nF_s(q, t) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{3/2} \\int dv_x e^{-\\frac{m v_x^2}{2 k_{\\mathrm{B}} T}} \\int dv_y e^{-\\frac{m v_y^2}{2 k_{\\mathrm{B}} T}} \\int dv_z e^{-\\frac{m v_z^2}{2 k_{\\mathrm{B}} T}} e^{i t q v_z}\n$$\n对 $v_x$ 和 $v_y$ 的积分是标准的高斯积分，与前面的系数一起，对这两个分量进行归一化，各自得到 $\\sqrt{2\\pi k_{\\mathrm{B}} T/m}$。我们剩下对 $v_z$ 的积分：\n$$\nF_s(q, t) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{1/2} \\int_{-\\infty}^{\\infty} dv_z \\, \\exp\\left(-\\frac{m v_z^2}{2 k_{\\mathrm{B}} T}\\right) e^{i (tq) v_z}\n$$\n这是 $v_z$ 的高斯函数的傅里叶变换。其结果是变换变量 $tq$ 的高斯函数。使用标准积分结果 $\\int_{-\\infty}^{\\infty} e^{-ax^2+bx} dx = \\sqrt{\\pi/a} e^{b^2/4a}$，其中 $x=v_z$，$a = \\frac{m}{2k_{\\mathrm{B}}T}$，$b = itq$：\n$$\nF_s(q, t) = \\left(\\frac{m}{2\\pi k_{\\mathrm{B}} T}\\right)^{1/2} \\sqrt{\\frac{2\\pi k_{\\mathrm{B}} T}{m}} \\exp\\left(\\frac{(itq)^2}{4(m/2k_{\\mathrm{B}}T)}\\right) = \\exp\\left(-\\frac{q^2 t^2 k_{\\mathrm{B}} T}{2m}\\right)\n$$\n\n6. 最后，我们通过对 $F_s(q, t)$ 进行时间傅里叶变换来得到动态结构因子 $S(q, \\omega)$。问题要求输出单位为秒，这意味着变换约定为 $S(q,\\omega) = \\int_{-\\infty}^{\\infty} F(q,t)e^{-i\\omega t}dt$。\n$$\nS(q, \\omega) = \\int_{-\\infty}^{\\infty} dt \\, \\exp\\left(-\\frac{q^2 k_{\\mathrm{B}} T}{2m} t^2\\right) e^{-i \\omega t}\n$$\n这同样是一个高斯函数的傅里叶变换。我们使用相同的积分恒等式，但现在的变量是 $t$，$a = \\frac{q^2 k_{\\mathrm{B}} T}{2m}$，$b = -i\\omega$：\n$$\nS(q, \\omega) = \\sqrt{\\frac{\\pi}{a}} \\exp\\left(\\frac{(-i\\omega)^2}{4a}\\right) = \\sqrt{\\frac{\\pi}{\\frac{q^2 k_{\\mathrm{B}} T}{2m}}} \\exp\\left(\\frac{-\\omega^2}{4 \\left(\\frac{q^2 k_{\\mathrm{B}} T}{2m}\\right)}\\right)\n$$\n简化此表达式可得最终结果：\n$$\nS(q, \\omega) = \\sqrt{\\frac{2\\pi m}{q^2 k_{\\mathrm{B}} T}} \\exp\\left(-\\frac{m \\omega^2}{2 q^2 k_{\\mathrm{B}} T}\\right)\n$$\n该表达式给出了动态结构因子，它是以 $\\omega=0$ 为中心的高斯函数，其宽度由热运动引起的多普勒展宽决定。振幅与 $q$ 成反比。这就是需要进行数值实现的表达式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the dynamic structure factor S(q, ω) for a series of test cases\n    based on the derived formula for a dilute gas in the impulse approximation.\n    \"\"\"\n\n    # Define the Boltzmann constant in SI units (J/K)\n    k_B = 1.380649e-23\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (m, T, q, omega) in SI units.\n    # m: kg, T: K, q: m^-1, omega: rad/s\n    test_cases = [\n        # Case 1 (happy path)\n        (6.63e-26, 3.00e2, 8.00e10, 0.00),\n        # Case 2 (frequency tail)\n        (6.63e-26, 3.00e2, 8.00e10, 1.00e12),\n        # Case 3 (low-q boundary check)\n        (6.63e-26, 3.00e2, 1.00e8, 1.00e9),\n        # Case 4 (heavy and cold gas)\n        (1.00e-25, 5.00e1, 5.00e10, 2.00e12),\n        # Case 5 (very high-q scaling)\n        (6.63e-26, 3.00e2, 2.00e11, 0.00),\n    ]\n\n    def calculate_S_q_omega(m, T, q, omega):\n        \"\"\"\n        Computes S(q, ω) using the derived formula:\n        S(q, ω) = sqrt(2*pi*m / (k_B*T*q^2)) * exp(-m*ω^2 / (2*k_B*T*q^2))\n        \n        Args:\n            m (float): Particle mass in kg.\n            T (float): Temperature in K.\n            q (float): Wavevector magnitude in m^-1.\n            omega (float): Angular frequency in rad/s.\n        \n        Returns:\n            float: The value of S(q, ω) in seconds.\n        \"\"\"\n        # Ensure q is non-zero to avoid division by zero.\n        if q == 0.0:\n            return np.inf\n\n        # Common denominator term to simplify calculation and improve clarity\n        denominator_term = k_B * T * q**2\n\n        # Calculate the prefactor (the term under the square root)\n        prefactor_arg = (2 * np.pi * m) / denominator_term\n        prefactor = np.sqrt(prefactor_arg)\n\n        # Calculate the argument of the exponential function\n        exponent_arg = -(m * omega**2) / (2 * denominator_term)\n        \n        # Calculate the exponential term\n        exp_term = np.exp(exponent_arg)\n\n        # The final result is the product of the prefactor and the exponential term\n        s_q_omega = prefactor * exp_term\n        \n        return s_q_omega\n\n    results = []\n    for case in test_cases:\n        m, T, q, omega = case\n        result = calculate_S_q_omega(m, T, q, omega)\n        results.append(f\"{result:.6e}\") # Format to standard scientific notation\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "$S(q, \\omega)$ 的理论表达式通常假设在一个无限大的系统中进行无限长时间的观测，但真实的计算机模拟是有限的。本练习通过研究有限的系统尺寸 ($L$) 和有限的观测时间 ($T$) 如何在计算出的光谱中引入人为结果，从而弥合了理论与计算之间的鸿沟。使用简化的谐振子晶体模型，您将量化诸如谱峰展宽和振幅调制等效应，从而获得解释任何数值模拟数据所必需的关键技能 。",
            "id": "3794900",
            "problem": "考虑一个一维谐振子晶体，由$N$个质量为$m$的相同质点组成，这些质点由刚度系数为$K$、晶格间距为$a$的线性弹簧连接，排列在总长度为$L = N a$的环上，并满足周期性边界条件。位于$x_j = j a$处的原子$j$的纵向位移记为$u_j(t)$。其运动方程由牛顿第二定律和最近邻胡克相互作用给出，其简正模为平面波，角频率色散关系可从线性化动力学推得。\n\n您将从第一性原理计算动态结构因子$S(q,\\omega)$，针对无量纲单位下的单个受激发的简正模，重点关注有限尺寸（$N$）和有限时间（$T$）效应。所有角度必须以弧度处理，所有角频率的单位为弧度/时间单位。最终的数值输出必须是无量纲的，并表示为浮点数。\n\n基本原理：\n- 一维谐振子链的简正模色散关系由线性化运动方程导出，其形式为\n$$\n\\omega(q) = 2 \\sqrt{\\frac{K}{m}} \\left| \\sin\\left( \\frac{q a}{2} \\right) \\right|.\n$$\n- 在波数为$q$的傅里叶空间中，微观密度为 $n_q(t) = \\sum_{j=0}^{N-1} \\exp\\!\\big( i q x_j(t) \\big)$，其中$x_j(t) = x_j + u_j(t)$。\n- 相干中间散射函数定义为\n$$\nF(q,t) = \\frac{1}{N} \\left\\langle n_q(t) \\, n_{-q}(0) \\right\\rangle,\n$$\n动态结构因子是其时间傅里叶变换，\n$$\nS(q,\\omega) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\mathrm{d}t \\, e^{i \\omega t} \\, F(q,t).\n$$\n- 在小振幅、长波长纵向极限下，密度涨落通过连续性关系与简正模位移坐标线性相关。具体来说，定义简正模坐标为\n$$\nQ(q,t) = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} u_j(t) \\, e^{-i q x_j},\n$$\n可以得到傅里叶空间中领头阶的纵向密度涨落\n$$\n\\delta n_q(t) \\propto q \\, Q(q,t).\n$$\n这种正比关系确保了$Q(q,t)$的频率成分决定了$S(q,\\omega)$的峰值位置，仅相差一个依赖于$q$的整体标度因子。\n\n情景与数值构造：\n- 考虑在$q^*$处的一个受激发的简正模。确定性地构造位移场为\n$$\nu_j(t) = A \\cos(q^* x_j) \\cos\\big( \\omega(q^*) t \\big),\n$$\n其中$A$是一个小振幅。到测量波数$q$上的投影由有限尺寸重叠决定\n$$\nO(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}.\n$$\n于是，简正模坐标具有以下确定性形式\n$$\nQ(q,t) = \\frac{A}{\\sqrt{N}} \\, O(q,q^*) \\, \\cos\\big( \\omega(q^*) t \\big).\n$$\n- 在总时长$T_{\\text{obs}} = M \\Delta t$内以大小为$\\Delta t$的时间步进行$M$次有限时间采样，并使用时间窗$w(t)$，将得到$Q(q,t)$的离散时间加窗变换，其功率谱$| \\mathcal{F}\\{ w(t) Q(q,t) \\} |^2$在$\\omega(q^*)$处呈现一个主峰，其宽度由窗的谱响应决定。矩形窗产生一个狄利克雷核，其主瓣宽度尺度为$O(2\\pi/T_{\\text{obs}})$，而汉宁窗则会减小旁瓣并略微加宽主瓣。\n\n您的任务：\n- 使用以上定义且仅使用提供的基本关系，实现一个程序，为指定的测试套件计算：\n  1. 测量的峰值角频率（$Q(q,t)$的加窗离散傅里叶变换中最大谱功率的位置）与解析解$\\omega(q^*)$之间的绝对误差。\n  2. 矩形窗情况下主谱峰的半峰全宽（FWHM），通过在离散谱中定位峰值两侧的半功率交叉点并在需要时在相邻频率仓之间进行线性插值来计算。\n  3. 有限尺寸重叠比\n     $$\n     R = \\frac{|O(q,q^*)|}{|O(q^*,q^*)|},\n     $$\n     该比率量化了当测量波数$q$与受激发的模$q^*$不匹配时，有限尺寸采样对测量振幅的抑制程度。\n\n所有量都以无量纲单位报告。角度单位为弧度，角频率单位为弧度/时间单位。\n\n算法约束：\n- 直接根据位移场和有限尺寸重叠构造$Q(q,t)$。使用$Q(q,t)$通过快速傅里叶变换（FFT）生成加窗离散谱。仅处理时间序列$Q(q,t)$，不要显式计算$n_q(t)$。\n- 对于FFT，当时间序列为实值时，使用单边实数变换，并通过乘以$2\\pi$将频率仓映射到角频率。\n\n测试套件：\n- 情况1（理想路径）：$N = 128$，$m = 1$，$K = 1$，$a = 1$，$\\Delta t = 0.005$，$M = 8192$，$A = 0.01$，$q^* = \\pi/4$，测量波数$q = \\pi/4$，窗$w(t)$为汉宁窗。输出绝对峰值频率误差（浮点数）。\n- 情况2（有限时间边界）：$N = 128$，$m = 1$，$K = 1$，$a = 1$，$\\Delta t = 0.005$，$M = 512$，$A = 0.01$，$q^* = \\pi/4$，测量波数$q = \\pi/4$，窗$w(t)$为矩形窗。输出FWHM（浮点数）。\n- 情况3（有限尺寸失配）：$N = 32$，$m = 1$，$K = 1$，$a = 1$，$\\Delta t = 0.005$，$M = 8192$，$A = 0.01$，$q^* = \\pi/4$，测量波数$q = \\pi/3$，窗$w(t)$为汉宁窗。输出有限尺寸重叠比$R$（浮点数）。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含三个测试用例的结果，按上面列出的顺序，以逗号分隔的列表形式并用方括号括起来。例如，输出必须采用以下形式\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3].\n$$\n所有三个结果都必须是浮点数。不应打印任何附加文本。",
            "solution": "该问题要求基于单个受激简正模的简化确定性模型，计算与一维谐振子晶体动力学相关的三个不同物理量。分析将首先根据所给定的条件建立理论框架，然后详细说明三个测试用例中每个用例的算法步骤。\n\n该系统是一个一维链，由$N$个质量为$m$的质点组成，弹簧常数为$K$，晶格间距为$a$。原子由$j \\in \\{0, 1, \\dots, N-1\\}$索引，其平衡位置为$x_j = j a$。纵向位移为$u_j(t)$。动力学由简正模色散关系决定：\n$$\n\\omega(q) = 2 \\sqrt{\\frac{K}{m}} \\left| \\sin\\left( \\frac{q a}{2} \\right) \\right|\n$$\n其中$q$是波数。\n\n问题的核心是分析简正模坐标$Q(q,t)$的谱成分，它被定义为位移场$u_j(t)$在平面波$e^{-i q x_j}$上的投影：\n$$\nQ(q,t) = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} u_j(t) \\, e^{-i q x_j}\n$$\n问题考虑了波数为$q^*$的单个简正模被激发的情景，产生一个确定性的驻波位移场：\n$$\nu_j(t) = A \\cos(q^* x_j) \\cos\\big( \\omega(q^*) t \\big)\n$$\n其中$A$是一个小振幅，$\\omega(q^*)$是根据色散关系得到的解析频率。将此位移场代入$Q(q,t)$的定义中，得到：\n$$\nQ(q,t) = \\frac{1}{\\sqrt{N}} \\sum_{j=0}^{N-1} \\left[ A \\cos(q^* x_j) \\cos\\big( \\omega(q^*) t \\big) \\right] e^{-i q x_j}\n$$\n含时项$\\cos(\\omega(q^*)t)$可以从对$j$的求和中提出，从而得到问题陈述中提供的形式：\n$$\nQ(q,t) = \\frac{A}{\\sqrt{N}} \\, O(q,q^*) \\, \\cos\\big( \\omega(q^*) t \\big)\n$$\n其中$O(q,q^*)$是复数值的有限尺寸重叠因子：\n$$\nO(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}\n$$\n$Q(q,t)$的分析在频域中进行。我们在时长$T_{\\text{obs}} = M \\Delta t$内，以时间步$t_k = k \\Delta t$（$k \\in \\{0, 1, \\dots, M-1\\}$）生成$Q(q,t)$的离散时间序列。然后将此时间序列乘以一个窗函数$w(t_k)$，并使用快速傅里叶变换（FFT）计算其功率谱。问题指定，当$Q(q,t)$是实值时间序列时，应使用单边实数FFT（`rfft`）。当且仅当重叠因子$O(q,q^*)$为实数时，该时间序列才是实值的。这种情况发生在$q = q^*$且$q^*$是与晶格相称的波数时（即，对于某个整数$n$，$q^* = 2\\pi n / (Na)$），情况1和2就是如此。对于情况3，重叠必须显式地计算为复数。得到的FFT频率仓通过$\\omega_k = 2 \\pi f_k = 2\\pi \\frac{k}{M \\Delta t}$转换为物理角频率$\\omega$。\n\n每个任务的算法步骤如下：\n\n**任务1：绝对峰值频率误差**\n对于情况1，其中$N = 128$，$q = q^* = \\pi/4$，且$a=1$，波数$q^*$与晶格相称（$q^* = 16 \\cdot \\frac{2\\pi}{128}$）。这使得$O(q^*, q^*)$为实数，因此$Q(q^*,t)$是一个实值时间序列。\n1.  使用色散关系计算解析频率$\\omega(q^*)$。\n2.  构造实值时间序列$Q(q^*, t_k)$。\n3.  对时间序列应用汉宁窗$w(t_k) = 0.5(1 - \\cos(2\\pi k / (M-1)))$。\n4.  使用`rfft`计算加窗时间序列的功率谱。\n5.  确定谱中最大功率对应的角频率$\\omega_{\\text{meas}}$。\n6.  结果是绝对误差$|\\omega_{\\text{meas}} - \\omega(q^*)|$。\n\n**任务2：半峰全宽（FWHM）**\n对于情况2，参数与情况1相似，但时间持续较短（$M=512$）并使用矩形窗（$w(t_k)=1$）。同样，$Q(q^*,t)$是一个实值时间序列。\n1.  使用`rfft`计算未加窗时间序列$Q(q^*,t)$的功率谱。\n2.  找到峰值功率$P_{\\text{max}}$及其角频率$\\omega_{\\text{peak}}$。\n3.  计算半峰值功率，$P_{\\text{half}} = P_{\\text{max}}/2$。\n4.  从$\\omega_{\\text{peak}}$开始向低频搜索，找到功率谱穿过$P_{\\text{half}}$的点$\\omega_{\\text{left}}$。该点通过在跨越交叉点的两个离散频率仓之间进行线性插值找到。\n5.  类似地，从$\\omega_{\\text{peak}}$开始向高频搜索，找到插值得到的交叉点$\\omega_{\\text{right}}$。\n6.  FWHM计算为$\\omega_{\\text{right}} - \\omega_{\\text{left}}$。\n\n**任务3：有限尺寸重叠比**\n此任务涉及对情况3的直接、不依赖于时间的计算，其中测量波数$q=\\pi/3$与受激模波数$q^*=\\pi/4$不同，系统尺寸为$N=32$。\n1.  通过对所有$j=0, \\dots, N-1$求和，数值计算复数重叠因子$O(q,q^*)$：\n    $$\n    O(q,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q x_j}\n    $$\n2.  数值计算参考重叠因子$O(q^*,q^*)$：\n    $$\n    O(q^*,q^*) = \\sum_{j=0}^{N-1} \\cos(q^* x_j) \\, e^{-i q^* x_j}\n    $$\n    对于给定的相称波数$q^*$，此值计算为一个实数，$N/2=16$。\n3.  结果是模的比值：\n    $$\n    R = \\frac{|O(q,q^*)|}{|O(q^*,q^*)|}\n    $$\n以下程序为指定的测试套件实现了这些计算。",
            "answer": "```python\nimport numpy as np\n\ndef calculate_quantities(params):\n    \"\"\"\n    Calculates the required physical quantity based on the provided parameters.\n\n    The function handles three distinct tasks specified by the 'task' parameter:\n    1. 'peak_error': Computes the absolute error between the measured and analytical peak frequency.\n    2. 'fwhm': Computes the Full Width at Half Maximum of the spectral peak.\n    3. 'ratio': Computes the finite-size overlap ratio R.\n    \"\"\"\n    N, m, K, a, dt, M, A, q_star, q, window_type, task = params\n\n    # Common parameters and analytical calculations\n    x_j = a * np.arange(N)\n    omega_analytical = 2 * np.sqrt(K / m) * np.abs(np.sin(q_star * a / 2))\n\n    # Task 3: Overlap Ratio R. This is a static calculation.\n    if task == 'ratio':\n        O_q_qstar = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q * x_j))\n        O_qstar_qstar = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q_star * x_j))\n        return np.abs(O_q_qstar) / np.abs(O_qstar_qstar)\n\n    # For tasks 1 and 2, perform time-domain analysis.\n    t = dt * np.arange(M)\n    O_q_qstar_val = np.sum(np.cos(q_star * x_j) * np.exp(-1j * q * x_j))\n\n    # Construct the time series for Q(q,t).\n    # Since q=q* for cases 1  2 and q* is commensurate, O_q_qstar_val is real.\n    # We can safely take the real part of the resulting series.\n    Q_qt_series = (A / np.sqrt(N)) * O_q_qstar_val * np.cos(omega_analytical * t)\n    Q_qt_series_real = np.real(Q_qt_series)\n\n    # Apply windowing if specified. 'rectangular' means no windowing.\n    if window_type == 'hann':\n        window = np.hanning(M)\n        Q_qt_series_real *= window\n\n    # Perform one-sided real FFT and compute power spectrum\n    fft_vals = np.fft.rfft(Q_qt_series_real)\n    freqs = np.fft.rfftfreq(M, d=dt)\n    power = np.abs(fft_vals)**2\n    angular_freqs = 2 * np.pi * freqs\n\n    # Task 1: Absolute peak frequency error\n    if task == 'peak_error':\n        peak_idx = np.argmax(power)\n        omega_measured = angular_freqs[peak_idx]\n        return np.abs(omega_measured - omega_analytical)\n    \n    # Task 2: Full Width at Half Maximum (FWHM)\n    if task == 'fwhm':\n        peak_idx = np.argmax(power)\n        peak_power = power[peak_idx]\n        half_power = peak_power / 2.0\n\n        # Find left crossing using linear interpolation\n        omega_left = None\n        for i in range(peak_idx - 1, -1, -1):\n            if power[i] = half_power:\n                p1, p2 = power[i], power[i+1]\n                w1, w2 = angular_freqs[i], angular_freqs[i+1]\n                omega_left = w1 + (w2 - w1) * (half_power - p1) / (p2 - p1)\n                break\n        \n        # Find right crossing using linear interpolation\n        omega_right = None\n        for i in range(peak_idx + 1, len(power)):\n            if power[i] = half_power:\n                p1, p2 = power[i-1], power[i]\n                w1, w2 = angular_freqs[i-1], angular_freqs[i]\n                omega_right = w1 + (w2 - w1) * (half_power - p1) / (p2 - p1)\n                break\n        \n        if omega_left is not None and omega_right is not None:\n            return omega_right - omega_left\n        else:\n            # Should not occur for the given problem parameters\n            return 0.0\n\ndef solve():\n    \"\"\"\n    Defines the test suite and orchestrates the calculation for each case.\n    \"\"\"\n    # Define test cases as tuples of parameters.\n    # (N, m, K, a, dt, M, A, q_star, q, window_type, task)\n    test_cases = [\n        # Case 1: happy path -> absolute peak frequency error\n        (128, 1.0, 1.0, 1.0, 0.005, 8192, 0.01, np.pi/4, np.pi/4, 'hann', 'peak_error'),\n        # Case 2: finite-time boundary -> FWHM\n        (128, 1.0, 1.0, 1.0, 0.005, 512, 0.01, np.pi/4, np.pi/4, 'rectangular', 'fwhm'),\n        # Case 3: finite-size mismatch -> overlap ratio R\n        (32, 1.0, 1.0, 1.0, 0.005, 8192, 0.01, np.pi/4, np.pi/3, 'hann', 'ratio'),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_quantities(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}