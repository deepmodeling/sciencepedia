{
    "hands_on_practices": [
        {
            "introduction": "To build intuition, we begin with the simplest possible scenario that gives rise to a ghost force. This exercise  asks you to consider a one-dimensional chain of atoms where the interface between the atomistic and continuum regions is modeled by simply deleting a single bond. By applying a uniform strain and calculating the resulting forces, you will directly compute the non-physical \"ghost force\" and understand its origin as an unbalanced interaction at the interface.",
            "id": "3812134",
            "problem": "Consider an infinite one-dimensional atomic chain with reference lattice spacing $a>0$ and atoms labeled by indices $i\\in\\mathbb{Z}$. Each pair of nearest neighbors $(i,i+1)$ interacts via a harmonic spring with stiffness $k>0$ and rest length $a$. The total atomistic potential energy for a configuration with deformed positions $y_i$ is\n$$\n\\mathcal{E}_{\\mathrm{atom}}(y)=\\sum_{i\\in\\mathbb{Z}}\\frac{k}{2}\\left(\\left(y_{i+1}-y_i\\right)-a\\right)^{2}.\n$$\nIn a naive atomistic–continuum coupling construction mimicking an abrupt interface, suppose that all bonds that cross the interface between atoms $i=0$ and $i=1$ are deleted (i.e., the nearest-neighbor bond $(0,1)$ is removed), while all other bonds remain unchanged. There are no external forces. Adopt the quasi-static setting so that forces derive from the gradient of the potential energy with respect to positions.\n\nNow impose the uniform affine displacement field $u_i=\\epsilon\\, i\\, a$ for a fixed small strain $\\epsilon\\in\\mathbb{R}$, so the deformed configuration is $y_i=x_i+u_i=(1+\\epsilon)\\,i\\,a$, where $x_i=i\\,a$ are the reference positions. Define the internal nodal force $f_i(y)$ as the negative gradient of the total energy with respect to $y_i$.\n\nUsing only the definitions above and standard principles of mechanics (force as negative energy gradient; Hooke’s law for harmonic springs), construct this counterexample explicitly and compute the exact residual internal force at the interface node $i=0$ that results from the cut bond. Specify the sign of the force using the convention that positive force acts in the positive lattice direction (from smaller $i$ to larger $i$). Express your final answer as a closed-form symbolic expression in terms of $k$, $a$, and $\\epsilon$. If you were to assign units, take $k$ in Newtons per meter (N/m), $a$ in meters (m), and note that $\\epsilon$ is dimensionless, so the force would be in Newtons (N). Do not substitute numerical values.",
            "solution": "The user wants me to solve a problem regarding the calculation of a \"ghost force\" in a simplified one-dimensional atomistic model.\n\n### Step 1: Problem Validation\n\nFirst, I will validate the problem statement according to the user's instructions.\n\n#### Extraction of Givens\n\n*   **System**: An infinite one-dimensional atomic chain with atoms indexed by $i \\in \\mathbb{Z}$.\n*   **Reference Configuration**: Reference lattice spacing is $a > 0$, and reference positions are $x_i = i a$.\n*   **Potential Energy**: For a full (uncut) chain, the atomistic potential energy is $\\mathcal{E}_{\\mathrm{atom}}(y)=\\sum_{i\\in\\mathbb{Z}}\\frac{k}{2}\\left(\\left(y_{i+1}-y_i\\right)-a\\right)^{2}$. The interaction is through nearest-neighbor harmonic springs with stiffness $k > 0$ and rest length $a$.\n*   **Model Modification**: The nearest-neighbor bond $(0,1)$ is deleted. All other bonds are unchanged. This defines the system for which the force is to be calculated.\n*   **Mechanical Conditions**: There are no external forces. The system is in a quasi-static setting.\n*   **Displacement Field**: A uniform affine displacement $u_i=\\epsilon\\, i\\, a$ is imposed for a constant strain $\\epsilon \\in \\mathbb{R}$.\n*   **Deformed Configuration**: The atomic positions are given by $y_i = x_i + u_i = (1+\\epsilon)\\,i\\,a$.\n*   **Force Definition**: The internal nodal force on atom $i$ is $f_i(y) = -\\frac{\\partial \\mathcal{E}}{\\partial y_i}$, where $\\mathcal{E}$ is the total potential energy of the modified system.\n*   **Objective**: Compute the residual internal force at the interface node $i=0$.\n*   **Sign Convention**: A positive force acts in the positive lattice direction (increasing $i$).\n*   **Output Format**: The answer should be a closed-form symbolic expression in terms of $k$, $a$, and $\\epsilon$.\n\n#### Validation using Extracted Givens\n\n1.  **Scientific Grounding**: The problem is scientifically sound. It employs a standard harmonic potential for a one-dimensional lattice, a fundamental model in solid-state physics. The concept of creating an interface by deleting bonds and calculating the resulting spurious \"ghost forces\" under a uniform deformation is a well-established topic in the field of multiscale materials simulation, particularly in the context of the Quasicontinuum (QC) method. The principles used (potential energy, force as the negative gradient of energy) are cornerstones of classical mechanics.\n\n2.  **Well-Posedness**: The problem is well-posed. It provides a complete description of the system's potential energy (after modification), the specific configuration of atoms, and the precise definition of the quantity to be calculated (the force on atom $0$). All necessary parameters ($k$, $a$, $\\epsilon$) are defined. The calculation leads to a unique and meaningful result.\n\n3.  **Objectivity**: The problem is stated in precise, objective, and mathematical language, free from any subjective or ambiguous terminology.\n\n4.  **Flaw Checklist**: The problem does not exhibit any of the listed flaws. It is not scientifically unsound, irrelevant, incomplete, contradictory, unrealistic, ill-posed, or trivial. It is a standard, solvable problem designed to illustrate a specific physical artifact in a computational model.\n\n#### Verdict\n\nThe problem is **valid**. I will now proceed with the solution.\n\n### Step 2: Solution Derivation\n\nThe total potential energy of the system, $\\mathcal{E}_{\\text{cut}}$, is defined by the sum over all existing bonds. Since the bond between atoms $i=0$ and $i=1$ is deleted, the term corresponding to this bond is removed from the total energy sum. The energy is:\n$$\n\\mathcal{E}_{\\text{cut}}(y) = \\sum_{j \\in \\mathbb{Z}, j \\neq 0} \\frac{k}{2} \\left( (y_{j+1} - y_j) - a \\right)^2\n$$\nThis sum can be split into two parts: one for the semi-infinite chain to the left of the cut and one for the semi-infinite chain to the right:\n$$\n\\mathcal{E}_{\\text{cut}}(y) = \\sum_{j=-\\infty}^{-1} \\frac{k}{2} \\left( (y_{j+1} - y_j) - a \\right)^2 + \\sum_{j=1}^{\\infty} \\frac{k}{2} \\left( (y_{j+1} - y_j) - a \\right)^2\n$$\nThe internal force on atom $i=0$ is defined as the negative gradient of the total potential energy with respect to the position $y_0$:\n$$\nf_0 = -\\frac{\\partial \\mathcal{E}_{\\text{cut}}}{\\partial y_0}\n$$\nTo compute this derivative, we must identify all terms in the energy expression $\\mathcal{E}_{\\text{cut}}$ that depend on $y_0$. Examining the summation, the position $y_0$ only appears in the bond connecting atom $i=-1$ and atom $i=0$. This corresponds to the term where the index $j$ is such that $j+1=0$, which is $j=-1$. The term for the bond $(0,1)$, which would have corresponded to $j=0$ and also involved $y_0$, has been explicitly removed from the sum.\n\nTherefore, only the $j=-1$ term contributes to the derivative with respect to $y_0$:\n$$\nf_0 = -\\frac{\\partial}{\\partial y_0} \\left[ \\frac{k}{2} \\left( (y_0 - y_{-1}) - a \\right)^2 \\right]\n$$\nApplying the chain rule for differentiation, we get:\n$$\nf_0 = - \\frac{k}{2} \\cdot 2 \\left( (y_0 - y_{-1}) - a \\right) \\cdot \\frac{\\partial}{\\partial y_0} \\left( y_0 - y_{-1} - a \\right)\n$$\n$$\nf_0 = -k \\left( (y_0 - y_{-1}) - a \\right) \\cdot (1)\n$$\n$$\nf_0 = -k \\left( y_0 - y_{-1} - a \\right)\n$$\nNow, we substitute the given deformed positions $y_i = (1+\\epsilon)ia$ into this force expression.\nFor atom $i=0$:\n$$\ny_0 = (1+\\epsilon)(0)a = 0\n$$\nFor atom $i=-1$:\n$$\ny_{-1} = (1+\\epsilon)(-1)a = -(1+\\epsilon)a\n$$\nSubstituting these values back into the expression for $f_0$:\n$$\nf_0 = -k \\left( 0 - (-(1+\\epsilon)a) - a \\right)\n$$\n$$\nf_0 = -k \\left( (1+\\epsilon)a - a \\right)\n$$\n$$\nf_0 = -k \\left( a + \\epsilon a - a \\right)\n$$\n$$\nf_0 = -k (\\epsilon a)\n$$\nThus, the final expression for the residual force on atom $i=0$ is:\n$$\nf_0 = -k a \\epsilon\n$$\nThis non-zero force is an artifact of the naive coupling scheme. In a perfect, un-cut lattice under the same uniform strain, the force on any atom would be zero, as the forces from the left and right neighbor bonds would perfectly cancel. By cutting the bond $(0,1)$, we remove the force that atom $1$ would exert on atom $0$, leaving an unbalanced force from atom $-1$. For a positive strain $\\epsilon > 0$, the spring $(-1,0)$ is stretched, and it pulls atom $0$ in the negative direction, consistent with the negative sign in the final result.",
            "answer": "$$\n\\boxed{-k a \\epsilon}\n$$"
        },
        {
            "introduction": "Ghost forces are more than just artifacts of cut bonds; they are symptoms of a deeper failure in the numerical scheme to respect fundamental physical principles. This practice  explores the concept of rigid-body invariance, which demands that a uniform translation of the system must not generate any internal forces. You will derive the mathematical condition for this invariance and see how its violation directly produces a quantifiable ghost force, even without considering strain.",
            "id": "3812118",
            "problem": "Consider a one-dimensional crystalline chain with reference positions $X_i = i a$ and nearest-neighbor interactions described by a harmonic pair potential with stiffness $k$. Let $u = \\{u_i\\}_{i=1}^{N}$ denote the displacement field. The purely atomistic energy is defined by $E^{\\text{a}}(u) = \\frac{1}{2} k \\sum_{i=1}^{N-1} (u_{i+1} - u_i)^2$, so that atomistic forces are obtained by $F^{\\text{a}}_j(u) = -\\frac{\\partial E^{\\text{a}}}{\\partial u_j}$. In an Atomistic-to-Continuum (A/C) coupling, the force operator is modified in an interface set $\\mathcal{I} \\subset \\{2,\\dots,N-1\\}$ by a linear discrete operator with node-dependent coefficients,\n$$\nF^{\\text{couple}}_j(u) = k \\left( a_j u_j - b_j u_{j-1} - c_j u_{j+1} \\right), \\quad j \\in \\mathcal{I},\n$$\nwhile outside $\\mathcal{I}$ the atomistic operator $F^{\\text{a}}_j(u)$ is retained. Assume $a_j$, $b_j$, and $c_j$ are positive and vary smoothly with $j$ across $\\mathcal{I}$ due to blending with a Cauchy–Born finite element surrogate.\n\nStarting from fundamental principles, namely that rigid-body translations leave the physical energy invariant and forces must vanish under $u_i = \\alpha$ for any constant $\\alpha$ (rigid-body invariance), derive the necessary and sufficient condition on the coefficients $a_j$, $b_j$, and $c_j$ such that $F_j^{\\text{couple}}(\\alpha \\mathbf{1}) = 0$ for all $j \\in \\mathcal{I}$ and all $\\alpha \\in \\mathbb{R}$, where $\\mathbf{1}$ denotes the all-ones vector. Then, consider a specific interface node $j^{\\star} \\in \\mathcal{I}$ with coefficients $a_{j^{\\star}} = 2.05$, $b_{j^{\\star}} = 1.00$, $c_{j^{\\star}} = 1.00$, stiffness $k = 100$ in $\\text{N}/\\text{m}$, and a uniform translation $u_i = \\alpha$ with $\\alpha = 1.0 \\times 10^{-2}$ in $\\text{m}$. Compute the ghost force $F_{j^{\\star}}^{\\text{ghost}}$ at $j^{\\star}$ induced by the violation of rigid-body invariance, and express the result in $\\text{N}$. Round your answer to four significant figures.",
            "solution": "The user wants me to solve a problem about ghost forces in atomistic-to-continuum coupling.\n\n**Part 1: Problem Validation**\n\nFirst, I must validate the problem statement.\n\n**Step 1: Extract Givens**\n- **System:** A one-dimensional crystalline chain with reference positions $X_i = i a$.\n- **Interaction:** Nearest-neighbor harmonic pair potential with stiffness $k$.\n- **Displacement field:** $u = \\{u_i\\}_{i=1}^{N}$.\n- **Atomistic energy:** $E^{\\text{a}}(u) = \\frac{1}{2} k \\sum_{i=1}^{N-1} (u_{i+1} - u_i)^2$.\n- **Atomistic force definition:** $F^{\\text{a}}_j(u) = -\\frac{\\partial E^{\\text{a}}}{\\partial u_j}$.\n- **Interface set:** $\\mathcal{I} \\subset \\{2,\\dots,N-1\\}$.\n- **Coupled force operator:** For $j \\in \\mathcal{I}$, $F^{\\text{couple}}_j(u) = k \\left( a_j u_j - b_j u_{j-1} - c_j u_{j+1} \\right)$.\n- **Force outside interface:** For $j \\notin \\mathcal{I}$, the force is $F^{\\text{a}}_j(u)$.\n- **Coefficient properties:** $a_j$, $b_j$, and $c_j$ are positive and vary smoothly with $j$ across $\\mathcal{I}$.\n- **Governing principle:** Rigid-body invariance requires that forces vanish for a constant displacement field, $u_i = \\alpha$ for any constant $\\alpha$. This is expressed as $F_j(\\alpha \\mathbf{1}) = 0$.\n- **Task 1:** Derive the necessary and sufficient condition on $a_j$, $b_j$, $c_j$ such that $F_j^{\\text{couple}}(\\alpha \\mathbf{1}) = 0$ for all $j \\in \\mathcal{I}$ and all $\\alpha \\in \\mathbb{R}$.\n- **Specific node data:** At a node $j^{\\star} \\in \\mathcal{I}$, the coefficients are $a_{j^{\\star}} = 2.05$, $b_{j^{\\star}} = 1.00$, $c_{j^{\\star}} = 1.00$.\n- **Specific parameters:** Stiffness $k = 100 \\text{ N/m}$ and uniform translation $\\alpha = 1.0 \\times 10^{-2} \\text{ m}$.\n- **Task 2:** Compute the ghost force $F_{j^{\\star}}^{\\text{ghost}}$ at $j^{\\star}$ and round the result to four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded within the field of computational materials science, specifically multiscale modeling. The concept of a ghost force arising from a violation of rigid-body invariance (also known as the patch test) in an atomistic-to-continuum coupling scheme is a standard and critical topic. The mathematical model, a one-dimensional harmonic chain, is a common and appropriate model system for illustrating fundamental principles. The problem is well-posed, objective, and self-contained, providing all necessary definitions and data for both the derivation and the subsequent calculation. There are no contradictions, ambiguities, or reliance on pseudoscience. The problem directly addresses a core concept and is neither trivial nor artificially complex.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the solution.\n\n**Part 2: Solution**\n\nThe first part of the problem requires deriving the condition on the coefficients $a_j$, $b_j$, and $c_j$ that ensures rigid-body invariance. The principle of rigid-body invariance states that a uniform translation of the entire system should not induce any internal forces. Mathematically, this means the force on any atom $j$ must be zero when the displacement field is constant, i.e., $u_i = \\alpha$ for all $i$, where $\\alpha$ is an arbitrary constant.\n\nFor a node $j \\in \\mathcal{I}$, the force is given by the coupled operator:\n$$\nF^{\\text{couple}}_j(u) = k \\left( a_j u_j - b_j u_{j-1} - c_j u_{j+1} \\right)\n$$\nWe apply the rigid-body invariance condition by substituting $u_{j-1} = \\alpha$, $u_j = \\alpha$, and $u_{j+1} = \\alpha$ into this expression. The force under this condition, which we denote as $F_j^{\\text{couple}}(\\alpha \\mathbf{1})$, must be zero.\n$$\nF_j^{\\text{couple}}(\\alpha \\mathbf{1}) = k \\left( a_j (\\alpha) - b_j (\\alpha) - c_j (\\alpha) \\right)\n$$\nFactoring out the constant displacement $\\alpha$, we get:\n$$\nF_j^{\\text{couple}}(\\alpha \\mathbf{1}) = k \\alpha (a_j - b_j - c_j)\n$$\nFor this force to be zero for any arbitrary constant displacement $\\alpha \\in \\mathbb{R}$ and for a non-zero stiffness $k > 0$, the term in the parentheses must be identically zero. Therefore, the necessary and sufficient condition on the coefficients is:\n$$\na_j - b_j - c_j = 0 \\quad \\text{or} \\quad a_j = b_j + c_j\n$$\nThis condition is a specific instance of a first-order consistency requirement, ensuring that the numerical scheme can exactly reproduce constant displacement fields without generating spurious forces.\n\nThe second part of the problem asks for the computation of the \"ghost force\" at a specific interface node $j^{\\star}$ where this condition is violated. A ghost force is the non-zero, unphysical force generated by a numerical scheme when a fundamental consistency condition, such as rigid-body invariance, is not met. It is precisely the force calculated for a uniform translation when the scheme fails this test.\n\nThe given data for the node $j^{\\star}$ are:\n- $a_{j^{\\star}} = 2.05$\n- $b_{j^{\\star}} = 1.00$\n- $c_{j^{\\star}} = 1.00$\n- $k = 100 \\text{ N/m}$\n- $\\alpha = 1.0 \\times 10^{-2} \\text{ m}$\n\nFirst, we check if the invariance condition is satisfied at $j^{\\star}$:\n$$\na_{j^{\\star}} \\stackrel{?}{=} b_{j^{\\star}} + c_{j^{\\star}}\n$$\n$$\n2.05 \\neq 1.00 + 1.00 = 2.00\n$$\nSince the condition is not satisfied, a non-zero ghost force will be generated under the uniform translation $u_i = \\alpha$. The ghost force, $F_{j^{\\star}}^{\\text{ghost}}$, is calculated using the general force expression for a constant displacement:\n$$\nF_{j^{\\star}}^{\\text{ghost}} = k \\alpha (a_{j^{\\star}} - b_{j^{\\star}} - c_{j^{\\star}})\n$$\nSubstituting the given numerical values:\n$$\nF_{j^{\\star}}^{\\text{ghost}} = (100 \\text{ N/m}) \\times (1.0 \\times 10^{-2} \\text{ m}) \\times (2.05 - 1.00 - 1.00)\n$$\n$$\nF_{j^{\\star}}^{\\text{ghost}} = (1 \\text{ N}) \\times (2.05 - 2.00)\n$$\n$$\nF_{j^{\\star}}^{\\text{ghost}} = (1 \\text{ N}) \\times (0.05)\n$$\n$$\nF_{j^{\\star}}^{\\text{ghost}} = 0.05 \\text{ N}\n$$\nThe problem requires the answer to be rounded to four significant figures. The calculated value $0.05$ can be written as $5.000 \\times 10^{-2}$, so expressing it with four significant figures gives $0.05000$.",
            "answer": "$$\n\\boxed{0.05000}\n$$"
        },
        {
            "introduction": "Moving from one-dimensional theory to more realistic scenarios, this final practice  challenges you to design and implement a numerical \"patch test\" for a two-dimensional quasicontinuum (QC) model. You will compute key metrics like nodal residuals and interface traction jumps to quantify ghost forces under both stretch and shear deformations. This exercise demonstrates how to diagnose and correct for ghost forces in a practical simulation environment, highlighting the difference between a naive coupling and a physically consistent one.",
            "id": "3812139",
            "problem": "Consider a two-dimensional triangular Bravais lattice with primitive vectors $d_1 = (a,0)$ and $d_2 = \\left(\\frac{a}{2}, \\frac{\\sqrt{3}a}{2}\\right)$. The lattice sites are indexed by integer pairs $(i,j)$ with positions $x_{i,j} = i\\,d_1 + j\\,d_2$. Each atom interacts with its six nearest neighbors via a central pair potential $\\phi(r) = \\frac{k}{2}(r - a)^2$, where $r$ is the deformed bond length, $a$ is the reference bond length, and $k$ is a stiffness. A homogeneous deformation $F \\in \\mathbb{R}^{2 \\times 2}$ maps reference bond vectors $b$ to deformed bond vectors $v = F\\,b$. The force transmitted along a bond under $F$ is the central force $f(F,b) = k\\left(\\lVert F\\,b \\rVert - a\\right)\\frac{F\\,b}{\\lVert F\\,b \\rVert}$ acting on the origin atom in the direction of its deformed neighbor.\n\nDefine the six nearest-neighbor offsets in lattice index space as $\\Delta = \\{(1,0),(0,1),(-1,1),(-1,0),(0,-1),(1,-1)\\}$, corresponding to the reference bond vectors $b(\\delta) = \\delta_1\\,d_1 + \\delta_2\\,d_2$ for $\\delta = (\\delta_1,\\delta_2) \\in \\Delta$.\n\nWe design a quasicontinuum (QC) coupling on a finite rectangular lattice with $N_x$ columns and $N_y$ rows, with periodic boundary conditions in the $j$-direction and free boundaries in the $i$-direction. Let the atomistic region $\\mathcal{A}$ be defined by the index condition $i  I$, and the continuum region $\\mathcal{C}$ by $i \\ge I$, where $I$ is an integer interface index with $1 \\le I \\le N_x - 1$. We consider two QC coupling variants:\n\n1. Naive energy-based mixing (QCE-like): Bonds that would connect an atom in $\\mathcal{A}$ to an atom in $\\mathcal{C}$ are dropped. That is, for any atom $(i,j) \\in \\mathcal{A}$ and neighbor offset $\\delta \\in \\Delta$, if $(i+\\delta_1,j+\\delta_2) \\in \\mathcal{C}$, then the bond force contribution $f(F,b(\\delta))$ is omitted.\n\n2. Patch-test consistent correction: For each dropped bond crossing $\\mathcal{A}$ to $\\mathcal{C}$, an external correction force equal to $f(F,b(\\delta))$ is applied to the atom $(i,j) \\in \\mathcal{A}$. Under homogeneous $F$, this mimics the Cauchy–Born traction from $\\mathcal{C}$ and restores force balance.\n\nDefine the nodal residual at an atom $(i,j)$ as $R_{i,j} = \\sum_{\\delta \\in \\Delta} \\mathcal{W}_{i,j}(\\delta)$, where $\\mathcal{W}_{i,j}(\\delta)$ equals $f(F,b(\\delta))$ if $(i+\\delta_1,j+\\delta_2) \\in \\mathcal{A}$, equals $0$ if the neighbor index $(i+\\delta_1)$ is outside $[0,N_x-1]$, and for bonds crossing into $\\mathcal{C}$ equals $0$ in the naive mixing variant or equals $f(F,b(\\delta))$ in the patch-test consistent correction variant. The residual is only evaluated for atoms $(i,j) \\in \\mathcal{A}$ with $i = I - 1$ (the atomistic column adjacent to the interface), and periodicity implies indices $j+\\delta_2$ are taken modulo $N_y$.\n\nDefine the interface traction jump for the naive mixing variant under homogeneous $F$ as the magnitude of the net missing traction per unit interface length. Let $\\mathcal{B}_{\\mathrm{cut}}$ be the set of bonds that would cross from atoms $(i,j) \\in \\mathcal{A}$ with $i=I-1$ to neighbors in $\\mathcal{C}$. Then the traction jump is\n$$\nT = \\frac{\\left\\lVert \\sum_{(i,j)\\in \\mathcal{A},\\, i=I-1}\\; \\sum_{\\delta \\in \\Delta:\\, i+\\delta_1 \\ge I} f(F,b(\\delta)) \\right\\rVert}{L_{\\mathrm{int}}},\n$$\nwhere $L_{\\mathrm{int}} = N_y\\,\\lVert d_2 \\rVert$ is the physical length of the interface segment parallel to $d_2$. For the patch-test consistent correction, $T=0$ by construction; for the pure atomistic lattice (no continuum region), $T=0$ and all residuals vanish under homogeneous $F$.\n\nAll quantities in this problem are dimensionless. Your task is to implement a numerical patch test for this setup and compute two observable metrics for each test case:\n- The maximum nodal residual magnitude among atoms in the interface-adjacent atomistic column, i.e., $\\max_{j} \\lVert R_{I-1,j} \\rVert$.\n- The interface traction jump magnitude $T$ as defined above.\n\nStart the derivation from Newton’s laws and central-force interactions, and use the homogeneity of $F$ and the lattice symmetry to argue the expected behavior in pure atomistic and corrected QC cases.\n\nYour program should evaluate the metrics for the following test suite of parameters $(N_x,N_y,I,k,a,F,\\text{mode})$, where $\\text{mode} \\in \\{\\text{atomistic},\\text{naive},\\text{corrected}\\}$:\n\n- Test 1 (happy path, pure atomistic): $(20,20,10,1.0,1.0,$ $F=\\begin{pmatrix}1.050\\\\01.05\\end{pmatrix},\\text{atomistic})$.\n- Test 2 (ghost force present, naive mixing under isotropic stretch): $(20,20,10,1.0,1.0,$ $F=\\begin{pmatrix}1.050\\\\01.05\\end{pmatrix},\\text{naive})$.\n- Test 3 (ghost force corrected, isotropic stretch): $(20,20,10,1.0,1.0,$ $F=\\begin{pmatrix}1.050\\\\01.05\\end{pmatrix},\\text{corrected})$.\n- Test 4 (boundary case, identity deformation): $(20,20,10,1.0,1.0,$ $F=\\begin{pmatrix}10\\\\01\\end{pmatrix},\\text{naive})$.\n- Test 5 (shear deformation, ghost force present): $(30,12,15,1.0,1.0,$ $F=\\begin{pmatrix}10.1\\\\01\\end{pmatrix},\\text{naive})$.\n- Test 6 (shear deformation, ghost force corrected): $(30,12,15,1.0,1.0,$ $F=\\begin{pmatrix}10.1\\\\01\\end{pmatrix},\\text{corrected})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[\\text{res}_1,\\text{trac}_1,\\text{res}_2,\\text{trac}_2,\\dots,\\text{res}_6,\\text{trac}_6]$, where $\\text{res}_t$ is the maximum nodal residual magnitude for test $t$ and $\\text{trac}_t$ is the traction jump magnitude for test $t$, each expressed as a float.",
            "solution": "The problem requires the computation of two metrics—the maximum nodal residual and the interface traction jump—for a quasicontinuum (QC) model of a two-dimensional triangular lattice under homogeneous deformation. The analysis is performed for three coupling variants: a fully atomistic model, a naive energy-based QC coupling, and a patch-test consistent corrected QC coupling.\n\n### 1. Fundamental Principles: Equilibrium and Central Forces\n\nAccording to Newton's first law, for a body to be in static equilibrium, the net force acting on any of its constituent particles must be zero. In our lattice system, each atom indexed by $\\alpha$ interacts with its neighbors $\\beta$ via central pair forces $f_{\\alpha\\beta}$. The total force on atom $\\alpha$ is the vector sum over its neighbors:\n$$\nF_{\\alpha} = \\sum_{\\beta} f_{\\alpha\\beta}\n$$\nFor a static configuration, or one undergoing a uniform velocity motion (which includes homogeneous deformation), this net force $F_{\\alpha}$ must be zero for every atom $\\alpha$ not subject to external body forces.\n\nThe force exerted on an atom at the origin by a neighbor, whose reference position is described by the bond vector $b$, under a homogeneous deformation gradient $F$, is given by:\n$$\nf(F,b) = k\\left(\\lVert F\\,b \\rVert - a\\right)\\frac{F\\,b}{\\lVert F\\,b \\rVert}\n$$\nHere, $k$ is the bond stiffness, $a$ is the reference bond length (equal to the nearest-neighbor distance in the reference configuration), and $F\\,b$ is the deformed bond vector.\n\n### 2. The Patch Test and the Perfect Lattice\n\nA fundamental consistency check for any multiscale method is the \"patch test\". It asserts that if the entire system is subjected to a deformation state that should be exactly representable by the coarse-grained (continuum) model, the coupled method must reproduce this state without error. For atomistics-to-continuum coupling, the simplest such state is a homogeneous deformation $F$.\n\nIn a perfect, infinite lattice subjected to a homogeneous deformation $F$, the atomic positions are mapped according to the continuum deformation, a concept known as the Cauchy-Born rule. The net force on any atom is the sum of forces from all its neighbors:\n$$\nF_{total} = \\sum_{\\delta \\in \\Delta} f(F, b(\\delta))\n$$\nwhere $\\Delta$ is the set of index offsets for the six nearest neighbors. The set of reference bond vectors $\\{b(\\delta) | \\delta \\in \\Delta\\}$ for the triangular lattice is centrosymmetric. This means that for every bond vector $b$ in the set, its negative $-b$ is also in the set. Specifically, the neighbors come in three opposing pairs: $(\\delta_1,\\delta_2)$ and $(-\\delta_1,-\\delta_2)$. For instance, $\\delta=(1,0)$ is paired with $\\delta=(-1,0)$. The force function has the property $f(F,-b) = -f(F,b)$, because $\\lVert F(-b) \\rVert = \\lVert F b \\rVert$. Consequently, the sum of forces over a centrosymmetric neighborhood vanishes:\n$$\nF_{total} = \\sum_{k=1}^{3} \\left[ f(F, b_k) + f(F, -b_k) \\right] = \\sum_{k=1}^{3} \\left[ f(F, b_k) - f(F, b_k) \\right] = 0\n$$\nTherefore, in a fully `atomistic` computational domain, any atom sufficiently far from the free boundaries (an \"interior\" atom) experiences zero net force, and its nodal residual is zero. This passes the patch test trivially.\n\n### 3. The Quasicontinuum Interface and Ghost Forces\n\nThe QC method partitions the system into an atomistic region $\\mathcal{A}$ and a continuum region $\\mathcal{C}$. The `naive` (QCE-like) coupling scheme handles the interface by simply discarding interactions (bonds) that cross from an atom in $\\mathcal{A}$ to a neighbor in $\\mathcal{C}$.\n\nConsider an atom $(i,j)$ at the interface boundary, with $i=I-1$. Its neighborhood is no longer complete; the sum of forces is taken only over neighbors that are also in $\\mathcal{A}$ (or outside the physical domain, which contribute zero force).\n$$\nR_{i,j} = \\sum_{\\delta: (i+\\delta_1, j+\\delta_2) \\in \\mathcal{A}} f(F, b(\\delta))\n$$\nSince the summation is now over an incomplete, non-centrosymmetric set of neighbors, the sum is generally non-zero. This non-zero nodal residual, $R_{i,j}$, is a spurious artifact of the inconsistent coupling scheme known as a \"ghost force\". It represents a violation of mechanical equilibrium at the interface and indicates that the naive method fails the patch test.\n\nThe `interface traction jump` $T$ quantifies the magnitude of this inconsistency. It is the net force from all the discarded bonds, normalized by the interface length $L_{\\mathrm{int}} = N_y \\lVert d_2 \\rVert = N_y a$.\n$$\nT = \\frac{\\left\\lVert \\sum_{\\text{cut bonds}} f(F,b(\\delta)) \\right\\rVert}{L_{\\mathrm{int}}}\n$$\nThe sum of the ghost forces on the interface atoms is precisely the negative of the sum of forces from the cut bonds, as the total force from all bonds (cut and uncut) must be zero.\n\n### 4. Patch-Test Consistent Correction\n\nThe `corrected` QC scheme remedies the ghost force problem. For each bond from an atom in $\\mathcal{A}$ to a neighbor in $\\mathcal{C}$ that is removed in the `naive` scheme, an external force equal to the force $f(F,b(\\delta))$ that this bond would have carried is applied to the atom in $\\mathcal{A}$. This correction force precisely mimics the traction that the continuum region should exert on the atomistic region according to the Cauchy-Born rule.\n\nWith this correction, the nodal residual for an interface atom $(i,j)$ becomes:\n$$\nR_{i,j} = \\left( \\sum_{\\delta: \\text{neighbor in } \\mathcal{A}} f(F, b(\\delta)) \\right) + \\left( \\sum_{\\delta: \\text{neighbor in } \\mathcal{C}} f(F, b(\\delta)) \\right) = \\sum_{\\delta \\in \\Delta} f(F, b(\\delta)) = 0\n$$\nThe force balance is perfectly restored, the ghost forces are eliminated, the nodal residuals are zero, and the `corrected` method passes the patch test. By construction, the `traction jump` $T$ is also zero.\n\n### 5. Algorithmic Design\n\nThe numerical implementation proceeds by directly applying the definitions. For each test case, we set the parameters $(N_x, N_y, I, k, a, F, \\text{mode})$. Due to the homogeneity of the deformation and the periodicity in the $j$-direction, the nodal residual $R_{I-1,j}$ and the set of missing bond forces are identical for all interface atoms $j \\in [0, N_y-1]$. This allows for a significant simplification: we can compute the residual and the missing force for a single representative atom (e.g., at $j=0$) and scale the result for the traction jump by $N_y$.\n\nThe algorithm for a single test case is as follows:\n1.  Initialize the nodal residual vector and the missing-force-per-atom vector to zero.\n2.  Define the primitive lattice vectors $d_1, d_2$ and construct the set of six nearest-neighbor reference bond vectors $\\{b(\\delta)\\}$.\n3.  Iterate through each of the six neighbor offsets $\\delta \\in \\Delta$.\n    a. Calculate the force vector $f(F,b(\\delta))$ this bond would carry under the given deformation $F$.\n    b. Determine the location of the neighbor atom relative to the interface index $I$.\n    c. Apply the logic corresponding to the simulation `mode` (`atomistic`, `naive`, or `corrected`) to determine the force contribution to add to the nodal residual.\n    d. For the `naive` mode, if a bond is cut (i.e., its force contribution is set to zero), add the calculated force vector $f(F,b(\\delta))$ to the missing-force-per-atom accumulator.\n4.  After looping through all six neighbors, the magnitude of the final nodal residual vector is the first metric.\n5.  For the `naive` mode, the second metric, the traction jump $T$, is calculated as the magnitude of the missing-force-per-atom vector, divided by the reference bond length $a$. For `atomistic` and `corrected` modes, $T$ is zero.\n\nThis procedure is executed for each test case to generate the required output. For `atomistic` and `corrected` modes, the calculated residual should be zero (or within machine precision), validating the theoretical analysis.",
            "answer": "```python\nimport numpy as np\n\ndef compute_qc_metrics(Nx, Ny, I, k, a, F_matrix, mode):\n    \"\"\"\n    Computes the maximum nodal residual and interface traction jump for a given test case.\n    \n    Args:\n        Nx (int): Number of columns in the lattice.\n        Ny (int): Number of rows in the lattice.\n        I (int): Interface index.\n        k (float): Bond stiffness.\n        a (float): Reference bond length.\n        F_matrix (list of lists): The 2x2 deformation gradient matrix.\n        mode (str): The simulation mode ('atomistic', 'naive', 'corrected').\n\n    Returns:\n        tuple: A tuple containing (max_residual_norm, traction_jump).\n    \"\"\"\n    F = np.array(F_matrix)\n    d1 = np.array([a, 0.0])\n    d2 = np.array([a / 2.0, a * np.sqrt(3) / 2.0])\n    \n    # Offsets in lattice index space for a triangular lattice with primitive vectors d1, d2\n    delta_list = [(1, 0), (0, 1), (-1, 1), (-1, 0), (0, -1), (1, -1)]\n    b_vectors = {delta: delta[0] * d1 + delta[1] * d2 for delta in delta_list}\n\n    # Due to homogeneity and periodicity, the residual is the same for all interface atoms.\n    # We can compute it for a single representative atom.\n    i_atom = I - 1\n    \n    nodal_residual = np.zeros(2)\n    missing_force_per_atom = np.zeros(2)\n\n    for delta in delta_list:\n        d1_idx, _ = delta\n        \n        b = b_vectors[delta]\n        v = F @ b\n        r = np.linalg.norm(v)\n\n        # Calculate the central force vector for the bond\n        force_vec = np.zeros(2)\n        if r  1e-15:\n            force_vec = k * (r - a) * v / r\n\n        force_contribution = np.zeros(2)\n        i_neighbor = i_atom + d1_idx\n\n        # Check for free boundaries in the i-direction\n        if not (0 = i_neighbor  Nx):\n            # Neighbor is outside the simulation grid, force contribution is zero\n            force_contribution = np.zeros(2)\n        else:\n            # Neighbor is inside the simulation grid. Apply QC coupling rules.\n            is_neighbor_in_C = (i_neighbor = I)\n            \n            if mode == 'atomistic':\n                # 'atomistic' mode means no A/C partition. All on-grid bonds are active.\n                force_contribution = force_vec\n            \n            elif mode == 'naive':\n                if is_neighbor_in_C:\n                    # Naively cut bond crossing into the continuum region.\n                    force_contribution = np.zeros(2)\n                    missing_force_per_atom += force_vec\n                else: # Neighbor is in the atomistic region\n                    force_contribution = force_vec\n\n            elif mode == 'corrected':\n                # Force is always included, either as a real bond force (neighbor in A)\n                # or as a correction force (neighbor in C).\n                force_contribution = force_vec\n\n        nodal_residual += force_contribution\n    \n    max_residual_norm = np.linalg.norm(nodal_residual)\n    \n    traction_jump = 0.0\n    if mode == 'naive':\n        # The total missing force is Ny * missing_force_per_atom.\n        # The interface length L_int is Ny * ||d2|| = Ny * a.\n        # T = ||Ny * missing_force_per_atom|| / (Ny * a) = ||missing_force_per_atom|| / a\n        # Added a check for a  0 to avoid division by zero.\n        if a  1e-15:\n            traction_jump = np.linalg.norm(missing_force_per_atom) / a\n\n    return max_residual_norm, traction_jump\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Test 1 (happy path, pure atomistic)\n        (20, 20, 10, 1.0, 1.0, [[1.05, 0], [0, 1.05]], 'atomistic'),\n        # Test 2 (ghost force present, naive mixing under isotropic stretch)\n        (20, 20, 10, 1.0, 1.0, [[1.05, 0], [0, 1.05]], 'naive'),\n        # Test 3 (ghost force corrected, isotropic stretch)\n        (20, 20, 10, 1.0, 1.0, [[1.05, 0], [0, 1.05]], 'corrected'),\n        # Test 4 (boundary case, identity deformation)\n        (20, 20, 10, 1.0, 1.0, [[1.0, 0], [0, 1.0]], 'naive'),\n        # Test 5 (shear deformation, ghost force present)\n        (30, 12, 15, 1.0, 1.0, [[1.0, 0.1], [0, 1.0]], 'naive'),\n        # Test 6 (shear deformation, ghost force corrected)\n        (30, 12, 15, 1.0, 1.0, [[1.0, 0.1], [0, 1.0]], 'corrected')\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, I, k, a, F_matrix, mode = case\n        res, trac = compute_qc_metrics(Nx, Ny, I, k, a, F_matrix, mode)\n        results.extend([res, trac])\n\n    # Format the final output string as specified\n    output_str = '[' + ','.join(f\"{x:.12f}\" for x in results) + ']'\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}