{
    "hands_on_practices": [
        {
            "introduction": "A fundamental principle in multiscale modeling is that macroscopic properties emerge from the average behavior of the microscopic constituents. This practice grounds this abstract idea by having you compute the macroscopic stress tensor directly from a microscopic stress field within a Representative Volume Element (RVE) . By numerically verifying the Hill-Mandel energy consistency condition, you will gain hands-on experience with the core linkage between scales in continuum mechanics.",
            "id": "3817161",
            "problem": "Consider a two-dimensional periodic Representative Volume Element (RVE) domain $\\Omega = [0,L_x] \\times [0,L_y]$ with $L_x = L_y = 1\\,\\mathrm{m}$. The microscopic kinematics are small-strain, and the material is homogeneous, linear elastic, isotropic, and in plane-stress. Let the microscopic displacement field be decomposed as $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$, where $\\mathbf{E}$ is the prescribed macroscopic small-strain tensor (symmetric) and $\\tilde{\\mathbf{u}}(\\mathbf{x})$ is a periodic fluctuation field with zero-mean gradient over $\\Omega$. The microscopic small-strain tensor is $\\boldsymbol{\\varepsilon}(\\mathbf{x}) = \\tfrac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}}\\right)$, and the microscopic Cauchy stress is $\\boldsymbol{\\sigma}(\\mathbf{x})$ given by the plane-stress constitutive law for a homogeneous, isotropic solid with Young’s modulus $E_\\mathrm{Y}$ and Poisson’s ratio $\\nu$.\n\nStarting from the Hill–Mandel macro-homogeneity principle (the equality between the volume average of microscopic stress power and the macroscopic stress power under admissible boundary conditions) and the properties of periodic fields, derive a computable expression for the macroscopic stress tensor $\\boldsymbol{\\Sigma}$ in terms of $\\boldsymbol{\\sigma}(\\mathbf{x})$ and the RVE domain. Then, design a numerical procedure that:\n- constructs $\\boldsymbol{\\varepsilon}(\\mathbf{x})$ from $\\mathbf{u}(\\mathbf{x})$,\n- evaluates $\\boldsymbol{\\sigma}(\\mathbf{x})$ from $\\boldsymbol{\\varepsilon}(\\mathbf{x})$ via plane-stress linear elasticity,\n- computes $\\boldsymbol{\\Sigma}$ over $\\Omega$ by numerical integration, and\n- verifies the Hill–Mandel equality by computing the absolute gap between the volume-averaged microscopic power $\\langle \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\rangle$ and the macroscopic power $\\boldsymbol{\\Sigma} : \\mathbf{E}$.\n\nIn all cases, distances are in $\\mathrm{m}$, stress in $\\mathrm{Pa}$, and strains are dimensionless. The verification metric must be the absolute Hill–Mandel power gap in $\\mathrm{Pa}$.\n\nFor numerical implementation, use a uniform tensor-product grid with $N \\times N$ points and evaluate integrals by uniform averaging over the grid. Use the following fluctuation field family with integer wavenumbers $n_x, n_y$:\n- $\\tilde{u}_x(x,y) = A \\cos\\!\\left(2\\pi n_x x/L_x\\right)\\,\\sin\\!\\left(2\\pi n_y y/L_y\\right)$,\n- $\\tilde{u}_y(x,y) = B \\sin\\!\\left(2\\pi n_x x/L_x\\right)\\,\\cos\\!\\left(2\\pi n_y y/L_y\\right)$,\nwith amplitudes $A, B$ in $\\mathrm{m}$.\n\nAdopt the plane-stress constitutive mapping for isotropic linear elasticity:\n- $\\sigma_{xx} = \\dfrac{E_\\mathrm{Y}}{1-\\nu^2}\\left(\\varepsilon_{xx} + \\nu\\,\\varepsilon_{yy}\\right)$,\n- $\\sigma_{yy} = \\dfrac{E_\\mathrm{Y}}{1-\\nu^2}\\left(\\nu\\,\\varepsilon_{xx} + \\varepsilon_{yy}\\right)$,\n- $\\sigma_{xy} = \\dfrac{E_\\mathrm{Y}}{1+\\nu}\\,\\varepsilon_{xy}$,\nwhere $\\varepsilon_{xy} = \\tfrac{1}{2}\\left(\\partial u_x/\\partial y + \\partial u_y/\\partial x\\right)$.\n\nYour program must implement the above for the following test suite of four cases. In each case, set $L_x=L_y=1\\,\\mathrm{m}$ and use a uniform grid with $N=256$ points per direction. For each case, compute and report:\n- the macroscopic stress components $\\Sigma_{xx}$, $\\Sigma_{xy}$, $\\Sigma_{yy}$ in $\\mathrm{Pa}$, and\n- the absolute Hill–Mandel power gap $g = \\left|\\langle \\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon} \\rangle - \\boldsymbol{\\Sigma}:\\mathbf{E}\\right|$ in $\\mathrm{Pa}$.\n\nTest cases:\n- Case $1$ (general nonzero macrostrain and fluctuations): $E_\\mathrm{Y} = 2.10\\times 10^{11}\\,\\mathrm{Pa}$, $\\nu = 0.3$, $\\mathbf{E} = \\begin{bmatrix}1.0\\times 10^{-3} & 2.0\\times 10^{-4} \\\\ 2.0\\times 10^{-4} & -5.0\\times 10^{-4}\\end{bmatrix}$, $A = 1.0\\times 10^{-6}\\,\\mathrm{m}$, $B = -5.0\\times 10^{-7}\\,\\mathrm{m}$, $n_x = 1$, $n_y = 2$.\n- Case $2$ (pure fluctuation, zero macrostrain): $E_\\mathrm{Y} = 7.0\\times 10^{10}\\,\\mathrm{Pa}$, $\\nu = 0.33$, $\\mathbf{E} = \\begin{bmatrix}0 & 0 \\\\ 0 & 0\\end{bmatrix}$, $A = 2.0\\times 10^{-6}\\,\\mathrm{m}$, $B = 1.5\\times 10^{-6}\\,\\mathrm{m}$, $n_x = 3$, $n_y = 4$.\n- Case $3$ (no fluctuations, nonzero macrostrain): $E_\\mathrm{Y} = 1.10\\times 10^{11}\\,\\mathrm{Pa}$, $\\nu = 0.25$, $\\mathbf{E} = \\begin{bmatrix}3.0\\times 10^{-4} & -1.0\\times 10^{-4} \\\\ -1.0\\times 10^{-4} & 2.0\\times 10^{-4}\\end{bmatrix}$, $A = 0\\,\\mathrm{m}$, $B = 0\\,\\mathrm{m}$, $n_x = 1$, $n_y = 1$.\n- Case $4$ (higher wavenumber fluctuations, pure macroscopic shear): $E_\\mathrm{Y} = 5.0\\times 10^{10}\\,\\mathrm{Pa}$, $\\nu = 0.20$, $\\mathbf{E} = \\begin{bmatrix}0 & 1.0\\times 10^{-4} \\\\ 1.0\\times 10^{-4} & 0\\end{bmatrix}$, $A = 1.0\\times 10^{-7}\\,\\mathrm{m}$, $B = -1.0\\times 10^{-7}\\,\\mathrm{m}$, $n_x = 10$, $n_y = 7$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing a list of lists, one per test case, where each inner list is $[\\Sigma_{xx}, \\Sigma_{xy}, \\Sigma_{yy}, g]$. For example, an output with two cases would look like $[[\\Sigma_{xx}^{(1)},\\Sigma_{xy}^{(1)},\\Sigma_{yy}^{(1)},g^{(1)}],[\\Sigma_{xx}^{(2)},\\Sigma_{xy}^{(2)},\\Sigma_{yy}^{(2)},g^{(2)}]]$.\n- Express $\\Sigma_{xx}$, $\\Sigma_{xy}$, $\\Sigma_{yy}$ and $g$ in $\\mathrm{Pa}$ as floating-point numbers.",
            "solution": "**Problem Validation**\n\n**Step 1: Extract Givens**\n-   Domain: 2D periodic RVE $\\Omega = [0,L_x] \\times [0,L_y]$ with $L_x = L_y = 1\\,\\mathrm{m}$.\n-   Kinematics: Small-strain. Microscopic displacement $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$.\n-   Macroscopic Strain: $\\mathbf{E}$ is a prescribed symmetric tensor.\n-   Fluctuation Field: $\\tilde{\\mathbf{u}}(\\mathbf{x})$ is a periodic fluctuation field with zero-mean gradient over $\\Omega$, $\\langle \\nabla \\tilde{\\mathbf{u}} \\rangle = \\mathbf{0}$.\n-   Microscopic Strain: $\\boldsymbol{\\varepsilon}(\\mathbf{x}) = \\tfrac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\mathsf{T}}\\right)$.\n-   Material Law: Homogeneous, linear elastic, isotropic, plane-stress with Young’s modulus $E_\\mathrm{Y}$ and Poisson’s ratio $\\nu$.\n    -   $\\sigma_{xx} = \\dfrac{E_\\mathrm{Y}}{1-\\nu^2}\\left(\\varepsilon_{xx} + \\nu\\,\\varepsilon_{yy}\\right)$\n    -   $\\sigma_{yy} = \\dfrac{E_\\mathrm{Y}}{1-\\nu^2}\\left(\\nu\\,\\varepsilon_{xx} + \\varepsilon_{yy}\\right)$\n    -   $\\sigma_{xy} = \\dfrac{E_\\mathrm{Y}}{1+\\nu}\\,\\varepsilon_{xy}$\n-   Hill–Mandel Principle: $\\langle \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\rangle = \\boldsymbol{\\Sigma} : \\mathbf{E}$.\n-   Fluctuation Field Form:\n    -   $\\tilde{u}_x(x,y) = A \\cos\\!\\left(2\\pi n_x x/L_x\\right)\\,\\sin\\!\\left(2\\pi n_y y/L_y\\right)$\n    -   $\\tilde{u}_y(x,y) = B \\sin\\!\\left(2\\pi n_x x/L_x\\right)\\,\\cos\\!\\left(2\\pi n_y y/L_y\\right)$\n    for integer wavenumbers $n_x, n_y$.\n-   Numerical Method: Uniform $N \\times N$ grid with $N=256$. Integrals evaluated by uniform averaging.\n-   Verification Metric: Absolute gap $g = \\left|\\langle \\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon} \\rangle - \\boldsymbol{\\Sigma}:\\mathbf{E}\\right|$.\n-   Test Cases: Four sets of parameters ($E_\\mathrm{Y}$, $\\nu$, $\\mathbf{E}$, $A$, $B$, $n_x$, $n_y$) are provided.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientifically Grounded**: The problem is formulated within the well-established framework of first-order computational homogenization for linear elastic materials. All principles, definitions, and equations (displacement decomposition, small-strain tensor, plane-stress constitutive law, Hill-Mandel principle) are standard in continuum mechanics and materials science.\n-   **Well-Posed**: The problem is fully specified. The displacement field $\\mathbf{u}(\\mathbf{x})$ is explicitly given for any point $\\mathbf{x} \\in \\Omega$. The strain field $\\boldsymbol{\\varepsilon}(\\mathbf{x})$ is uniquely obtained by differentiation. The stress field $\\boldsymbol{\\sigma}(\\mathbf{x})$ is a unique function of the strain field via the given constitutive law. The macroscopic stress $\\boldsymbol{\\Sigma}$ and the Hill-Mandel gap $g$ are computed through well-defined integration (averaging) operations. This guarantees the existence of a unique, stable, and meaningful solution.\n-   **Objective**: The problem is stated using precise mathematical and physical language, free of ambiguity or subjective claims.\n-   **Completeness and Consistency**: All required parameters for each case are provided. The condition that $\\tilde{\\mathbf{u}}(\\mathbf{x})$ has a zero-mean gradient is satisfied by the chosen trigonometric functions for any non-zero integer wavenumbers $n_x, n_y$ over the periodic domain, ensuring consistency with the theoretical premises of homogenization. The units are consistent.\n\n**Step 3: Verdict and Action**\nThe problem is valid as it is scientifically sound, well-posed, complete, and consistent. A solution will be developed.\n\n**Derivation and Numerical Procedure**\n\nThe objective is to compute the macroscopic stress tensor $\\boldsymbol{\\Sigma}$ and verify the Hill-Mandel macro-homogeneity condition.\n\n**1. Expression for Macroscopic Stress $\\boldsymbol{\\Sigma}$**\nIn first-order homogenization theory, the macroscopic stress $\\boldsymbol{\\Sigma}$ is defined as the volume average of the microscopic stress tensor $\\boldsymbol{\\sigma}(\\mathbf{x})$ over the Representative Volume Element (RVE) $\\Omega$:\n$$ \\boldsymbol{\\Sigma} = \\langle \\boldsymbol{\\sigma}(\\mathbf{x}) \\rangle = \\frac{1}{|\\Omega|} \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{x}) \\, dV $$\nIn our two-dimensional case with $|\\Omega| = L_x L_y$, this becomes:\n$$ \\boldsymbol{\\Sigma} = \\frac{1}{L_x L_y} \\int_0^{L_y} \\int_0^{L_x} \\boldsymbol{\\sigma}(x,y) \\, dx \\, dy $$\nThis definition is consistent with the Hill-Mandel principle under the imposed kinematic boundary conditions. The total strain is $\\boldsymbol{\\varepsilon} = \\mathbf{E} + \\tilde{\\boldsymbol{\\varepsilon}}$, where $\\tilde{\\boldsymbol{\\varepsilon}} = \\text{sym}(\\nabla\\tilde{\\mathbf{u}})$. The average of the total strain is $\\langle \\boldsymbol{\\varepsilon} \\rangle = \\langle \\mathbf{E} + \\tilde{\\boldsymbol{\\varepsilon}} \\rangle = \\mathbf{E} + \\langle \\tilde{\\boldsymbol{\\varepsilon}} \\rangle$. Since $\\tilde{\\mathbf{u}}$ is periodic, the Divergence Theorem implies $\\langle \\nabla \\tilde{\\mathbf{u}} \\rangle = \\mathbf{0}$, thus $\\langle \\tilde{\\boldsymbol{\\varepsilon}} \\rangle = \\mathbf{0}$ and $\\langle \\boldsymbol{\\varepsilon} \\rangle = \\mathbf{E}$. The Hill-Mandel principle $\\langle \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\rangle = \\boldsymbol{\\Sigma} : \\mathbf{E}$ can be rewritten, using $\\boldsymbol{\\Sigma} = \\langle \\boldsymbol{\\sigma} \\rangle$, as $\\langle \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\rangle = \\langle \\boldsymbol{\\sigma} \\rangle : \\langle \\boldsymbol{\\varepsilon} \\rangle$. This is the formal statement of the principle. The problem asks us to compute the discrepancy, or gap, from this ideal energy consistency, which will be non-zero if the microscopic stress field is not self-equilibrated (i.e., $\\nabla \\cdot \\boldsymbol{\\sigma} \\neq \\mathbf{0}$).\n\n**2. Numerical Procedure**\nWe will implement a numerical procedure on a uniform $N \\times N$ grid of points $(x_i, y_j)$, where $x_i = i L_x/N$ and $y_j = j L_y/N$ for $i, j \\in \\{0, 1, \\dots, N-1\\}$. Volume averages are approximated by averaging over all grid points.\n\n**Step 2a: Construct the Microscopic Strain Field $\\boldsymbol{\\varepsilon}(x,y)$**\nFirst, we find the gradient of the displacement field $\\mathbf{u}(\\mathbf{x}) = \\mathbf{E}\\,\\mathbf{x} + \\tilde{\\mathbf{u}}(\\mathbf{x})$. Let $k_x = 2\\pi n_x/L_x$ and $k_y = 2\\pi n_y/L_y$. The components of the displacement gradient $\\nabla\\mathbf{u}$ are:\n$$ \\frac{\\partial u_x}{\\partial x} = E_{xx} + \\frac{\\partial \\tilde{u}_x}{\\partial x} = E_{xx} - A k_x \\sin(k_x x) \\sin(k_y y) $$\n$$ \\frac{\\partial u_x}{\\partial y} = E_{xy} + \\frac{\\partial \\tilde{u}_x}{\\partial y} = E_{xy} + A k_y \\cos(k_x x) \\cos(k_y y) $$\n$$ \\frac{\\partial u_y}{\\partial x} = E_{yx} + \\frac{\\partial \\tilde{u}_y}{\\partial x} = E_{yx} + B k_x \\cos(k_x x) \\cos(k_y y) $$\n$$ \\frac{\\partial u_y}{\\partial y} = E_{yy} + \\frac{\\partial \\tilde{u}_y}{\\partial y} = E_{yy} - B k_y \\sin(k_x x) \\sin(k_y y) $$\nThe components of the symmetric small-strain tensor $\\boldsymbol{\\varepsilon} = \\tfrac{1}{2}(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^\\mathsf{T})$ are then:\n$$ \\varepsilon_{xx}(x,y) = E_{xx} - A k_x \\sin(k_x x) \\sin(k_y y) $$\n$$ \\varepsilon_{yy}(x,y) = E_{yy} - B k_y \\sin(k_x x) \\sin(k_y y) $$\n$$ \\varepsilon_{xy}(x,y) = \\frac{1}{2}\\left(\\frac{\\partial u_x}{\\partial y} + \\frac{\\partial u_y}{\\partial x}\\right) = E_{xy} + \\frac{1}{2}(A k_y + B k_x) \\cos(k_x x) \\cos(k_y y) $$\nwhere we have used the symmetry of the macroscopic strain tensor, $E_{xy} = E_{yx}$.\n\n**Step 2b: Evaluate the Microscopic Stress Field $\\boldsymbol{\\sigma}(x,y)$**\nUsing the given plane-stress constitutive relations, we compute the stress components at each grid point from the strain components computed in the previous step:\n$$ \\sigma_{xx} = \\frac{E_\\mathrm{Y}}{1-\\nu^2}(\\varepsilon_{xx} + \\nu \\varepsilon_{yy}) $$\n$$ \\sigma_{yy} = \\frac{E_\\mathrm{Y}}{1-\\nu^2}(\\nu \\varepsilon_{xx} + \\varepsilon_{yy}) $$\n$$ \\sigma_{xy} = \\frac{E_\\mathrm{Y}}{1+\\nu} \\varepsilon_{xy} $$\n\n**Step 2c: Compute the Macroscopic Stress $\\boldsymbol{\\Sigma}$**\nThe macroscopic stress components are computed by averaging the corresponding microscopic stress components over the $N \\times N$ grid:\n$$ \\Sigma_{xx} = \\langle \\sigma_{xx} \\rangle \\approx \\frac{1}{N^2} \\sum_{i,j} \\sigma_{xx}(x_i, y_j) $$\n$$ \\Sigma_{yy} = \\langle \\sigma_{yy} \\rangle \\approx \\frac{1}{N^2} \\sum_{i,j} \\sigma_{yy}(x_i, y_j) $$\n$$ \\Sigma_{xy} = \\langle \\sigma_{xy} \\rangle \\approx \\frac{1}{N^2} \\sum_{i,j} \\sigma_{xy}(x_i, y_j) $$\n\n**Step 2d: Verify the Hill-Mandel Equality**\nThe absolute Hill-Mandel power gap is defined as $g = |\\langle \\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon} \\rangle - \\boldsymbol{\\Sigma}:\\mathbf{E}|$. We can simplify this expression:\n$$ g = |\\langle \\boldsymbol{\\sigma}:\\boldsymbol{\\varepsilon} \\rangle - \\langle\\boldsymbol{\\sigma}\\rangle:\\mathbf{E}| = |\\langle \\boldsymbol{\\sigma}:(\\mathbf{E} + \\tilde{\\boldsymbol{\\varepsilon}}) \\rangle - \\langle\\boldsymbol{\\sigma}\\rangle:\\mathbf{E}| $$\n$$ g = | \\langle \\boldsymbol{\\sigma}:\\mathbf{E} \\rangle + \\langle \\boldsymbol{\\sigma}:\\tilde{\\boldsymbol{\\varepsilon}} \\rangle - \\langle\\boldsymbol{\\sigma}\\rangle:\\mathbf{E} | $$\nSince $\\mathbf{E}$ is constant, $\\langle \\boldsymbol{\\sigma}:\\mathbf{E} \\rangle = \\langle\\boldsymbol{\\sigma}\\rangle:\\mathbf{E}$. This leads to a simplified expression for the gap:\n$$ g = |\\langle \\boldsymbol{\\sigma}:\\tilde{\\boldsymbol{\\varepsilon}} \\rangle| $$\nThe microscopic power term $\\boldsymbol{\\sigma}:\\tilde{\\boldsymbol{\\varepsilon}}$ is calculated as:\n$$ \\boldsymbol{\\sigma}:\\tilde{\\boldsymbol{\\varepsilon}} = \\sigma_{xx}\\tilde{\\varepsilon}_{xx} + \\sigma_{yy}\\tilde{\\varepsilon}_{yy} + 2\\sigma_{xy}\\tilde{\\varepsilon}_{xy} $$\nwhere the fluctuation strain components are:\n$$ \\tilde{\\varepsilon}_{xx} = -A k_x \\sin(k_x x) \\sin(k_y y) $$\n$$ \\tilde{\\varepsilon}_{yy} = -B k_y \\sin(k_x x) \\sin(k_y y) $$\n$$ \\tilde{\\varepsilon}_{xy} = \\frac{1}{2}(A k_y + B k_x) \\cos(k_x x) \\cos(k_y y) $$\nThe gap $g$ is then the absolute value of the average of $\\boldsymbol{\\sigma}:\\tilde{\\boldsymbol{\\varepsilon}}$ over the grid. This formulation avoids the numerical subtraction of two potentially large, nearly equal numbers.\n\nThis completes the theoretical and numerical design. The following program implements this procedure for the specified test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multiscale homogenization problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1\n        {\n            \"E_Y\": 2.10e11, \"nu\": 0.3, \n            \"E_mat\": np.array([[1.0e-3, 2.0e-4], [2.0e-4, -5.0e-4]]),\n            \"A\": 1.0e-6, \"B\": -5.0e-7, \"nx\": 1, \"ny\": 2\n        },\n        # Case 2\n        {\n            \"E_Y\": 7.0e10, \"nu\": 0.33,\n            \"E_mat\": np.array([[0.0, 0.0], [0.0, 0.0]]),\n            \"A\": 2.0e-6, \"B\": 1.5e-6, \"nx\": 3, \"ny\": 4\n        },\n        # Case 3\n        {\n            \"E_Y\": 1.10e11, \"nu\": 0.25,\n            \"E_mat\": np.array([[3.0e-4, -1.0e-4], [-1.0e-4, 2.0e-4]]),\n            \"A\": 0.0, \"B\": 0.0, \"nx\": 1, \"ny\": 1\n        },\n        # Case 4\n        {\n            \"E_Y\": 5.0e10, \"nu\": 0.20,\n            \"E_mat\": np.array([[0.0, 1.0e-4], [1.0e-4, 0.0]]),\n            \"A\": 1.0e-7, \"B\": -1.0e-7, \"nx\": 10, \"ny\": 7\n        }\n    ]\n\n    results = []\n    \n    # RVE and Grid parameters\n    L_x = 1.0  # m\n    L_y = 1.0  # m\n    N = 256\n\n    # Create grid coordinates. Use endpoint=False for periodic domain.\n    x_coords = np.linspace(0, L_x, N, endpoint=False)\n    y_coords = np.linspace(0, L_y, N, endpoint=False)\n    X, Y = np.meshgrid(x_coords, y_coords)\n\n    for case in test_cases:\n        # Unpack parameters\n        E_Y = case[\"E_Y\"]\n        nu = case[\"nu\"]\n        E_mat = case[\"E_mat\"]\n        A = case[\"A\"]\n        B = case[\"B\"]\n        nx = case[\"nx\"]\n        ny = case[\"ny\"]\n\n        E_xx, E_xy = E_mat[0, 0], E_mat[0, 1]\n        E_yy = E_mat[1, 1]\n\n        # Wavenumbers\n        k_x = 2.0 * np.pi * nx / L_x\n        k_y = 2.0 * np.pi * ny / L_y\n\n        # --- Step 1: Construct Microscopic Strain Field ---\n        \n        # Fluctuation strain components (tilde_eps)\n        sin_kxX_sin_kyY = np.sin(k_x * X) * np.sin(k_y * Y)\n        cos_kxX_cos_kyY = np.cos(k_x * X) * np.cos(k_y * Y)\n\n        eps_tilde_xx = -A * k_x * sin_kxX_sin_kyY\n        eps_tilde_yy = -B * k_y * sin_kxX_sin_kyY\n        eps_tilde_xy = 0.5 * (A * k_y + B * k_x) * cos_kxX_cos_kyY\n\n        # Total strain components (eps)\n        eps_xx = E_xx + eps_tilde_xx\n        eps_yy = E_yy + eps_tilde_yy\n        eps_xy = E_xy + eps_tilde_xy\n\n        # --- Step 2: Evaluate Microscopic Stress Field ---\n        \n        # Plane-stress constitutive matrix components\n        C1 = E_Y / (1.0 - nu**2)\n        C2 = nu * E_Y / (1.0 - nu**2)\n        C3 = E_Y / (1.0 + nu)\n\n        # Microscopic stress components (sigma)\n        sigma_xx = C1 * eps_xx + C2 * eps_yy\n        sigma_yy = C2 * eps_xx + C1 * eps_yy\n        sigma_xy = C3 * eps_xy\n\n        # --- Step 3: Compute Macroscopic Stress ---\n        \n        # Average sigma over the grid\n        Sigma_xx = np.mean(sigma_xx)\n        Sigma_yy = np.mean(sigma_yy)\n        Sigma_xy = np.mean(sigma_xy)\n\n        # --- Step 4: Verify Hill-Mandel Equality ---\n        \n        # The term <sigma : tilde_eps>\n        sigma_dot_eps_tilde = (sigma_xx * eps_tilde_xx + \n                               sigma_yy * eps_tilde_yy + \n                               2.0 * sigma_xy * eps_tilde_xy)\n        \n        # The gap g = |<sigma : tilde_eps>|\n        g = np.abs(np.mean(sigma_dot_eps_tilde))\n\n        results.append([Sigma_xx, Sigma_xy, Sigma_yy, g])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "While passing information between scales is essential, doing so naively can introduce non-physical artifacts, such as 'ghost forces' at the interface between atomistic and continuum regions. This exercise guides you through diagnosing this common problem in concurrent multiscale simulations by identifying the source of the ghost force and implementing a corrective measure based on the Cauchy-Born rule . Mastering this concept through the implementation of a patch test is crucial for building stable and accurate hybrid models.",
            "id": "3817127",
            "problem": "Consider a one-dimensional crystalline chain with $N$ atoms, indexed by $i \\in \\{0,1,\\dots,N-1\\}$, with nearest-neighbor interactions only. The reference lattice spacing is $a_0$, and a uniform macroscopic strain $\\varepsilon$ is applied so that the deformed nearest-neighbor spacing is $a = (1+\\varepsilon)a_0$. The atomistic energy is defined as a sum of identical pair potentials $\\varphi(r)$ over all nearest-neighbor bonds, where $r$ is the bond length. The force on atom $j$ is the negative gradient of the total energy with respect to its position, and consistency of force transmission across scales requires that, under a uniform deformation, interior forces vanish. In a naive atomistic–continuum coupling that replaces the right half of the chain by a continuum model and omits any explicit treatment of bonds crossing the atomistic–continuum interface, a nonzero residual force can arise at the interface under uniform strain, known as a “ghost force.”\n\nStarting from the following fundamental base:\n- The total potential energy $E$ of the system is the sum of pairwise nearest-neighbor energies $E = \\sum \\varphi(r)$ evaluated on each bond in the atomistic region.\n- The force on atom $j$ is $f_j = -\\partial E / \\partial x_j$, with $x_j$ the position of atom $j$.\n- The Cauchy-Born rule defines the continuum energy density $W(F)$ for deformation gradient $F$ by mapping the microscopic pair interactions to a macroscopic energy density; for nearest-neighbor interactions in one dimension under the Cauchy-Born rule, $W(F)$ is taken as $W(F) = \\varphi(F a_0)/a_0$, and the first Piola–Kirchhoff stress $P(F)$ is $P(F) = \\mathrm{d}W/\\mathrm{d}F$.\n\nYou will:\n1. Define a naive coupling with an interface at index $I$ such that all bonds strictly inside the atomistic region are included in $E$, but any bond that crosses from atom $I$ to atom $I+1$ is not included in $E$ (that is, it is dropped). Consider only the uniform strain configuration in which all atomistic bond lengths equal $a$, so interior atomistic forces would cancel if no bond were dropped.\n2. Compute the ghost force error at the interface as the magnitude of the residual force on atom $I$ under uniform strain in this naive coupling.\n3. Derive a patch-test-consistent interface traction based on the Cauchy-Born stress that, when applied to atom $I$, should cancel the ghost force under uniform strain. Implement this correction and compute the corrected interface force.\n4. Implement a “patch test” diagnostic that returns a boolean indicating whether the corrected interface force magnitude is less than or equal to a specified tolerance $\\tau$.\n\nYour program must implement the above for the following well-tested pair potentials and parameter sets (use nondimensional units; no physical units are required):\n- Harmonic potential: $\\varphi(r) = \\frac{1}{2} k (r - a_0)^2$ with derivative $\\varphi'(r) = k (r - a_0)$.\n- Lennard–Jones potential: $\\varphi(r) = 4 \\epsilon \\left[ \\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6 \\right]$ with derivative $\\varphi'(r) = 4 \\epsilon \\left( -12 \\frac{\\sigma^{12}}{r^{13}} + 6 \\frac{\\sigma^6}{r^7} \\right)$.\n\nDefine the patch-test-consistent interface traction using the Cauchy-Born rule under uniform strain $F = 1+\\varepsilon$ by $W(F) = \\varphi(F a_0)/a_0$ and $P(F) = \\mathrm{d}W/\\mathrm{d}F$. Use this traction to correct the interface force.\n\nTest suite (each test case is a tuple `(potential, N, I, a0, epsilon, params, tau)` with `params` containing potential-specific parameters):\n- Case 1: `('harmonic', 50, 25, 1.0, 0.02, {'k': 100.0}, 1e-12)`\n- Case 2 (boundary condition with zero strain): `('harmonic', 30, 15, 1.0, 0.0, {'k': 10.0}, 1e-12)`\n- Case 3: `('lennard-jones', 100, 60, 1.0, 0.05, {'epsilon': 1.0, 'sigma': 2**(-1/6)}, 1e-12)` where $a_0 = 1.0$ equals the Lennard–Jones minimum $r_0 = 2^{1/6}\\sigma$, so $\\sigma = a_0 / 2^{1/6} = 2^{-1/6}$.\n- Case 4 (compressive strain): `('harmonic', 40, 20, 1.0, -0.01, {'k': 50.0}, 1e-12)`\n\nYour program should, for each test case, compute:\n- The naive ghost force magnitude at the interface before correction (a float).\n- The corrected interface force magnitude after applying the patch-test-consistent traction (a float).\n- A boolean indicating whether the patch test passes, defined as whether the corrected magnitude is less than or equal to $\\tau$.\n\nFinal output format: Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets and flattened in the order $[\\text{gf}_1^{\\text{before}}, \\text{gf}_1^{\\text{after}}, \\text{pass}_1, \\text{gf}_2^{\\text{before}}, \\text{gf}_2^{\\text{after}}, \\text{pass}_2, \\dots]$, where each $\\text{gf}$ is a float and each $\\text{pass}$ is a boolean. Angles are not used. Percentages are not used. Use nondimensional units for all quantities.",
            "solution": "The problem requires an analysis of the \"ghost force\" phenomenon at a naive atomistic–continuum interface and the implementation of a corrective measure based on the Cauchy–Born rule. The process involves deriving the expressions for the uncorrected and corrected forces on an interface atom and then implementing these calculations for specific interatomic potentials.\n\nFirst, we formalize the system and the force calculation. The system is a one-dimensional chain of atoms with positions $x_j$. The total atomistic potential energy $E$ in the naively coupled system is defined as the sum of pair potentials $\\varphi(r)$ over all bonds residing entirely within the atomistic region. The atomistic region is specified to include atoms with indices $j \\in \\{0, 1, \\dots, I\\}$. Consequently, the bonds included in the energy calculation are $(j, j+1)$ for $j=0, 1, \\dots, I-1$. The bond $(I, I+1)$, which crosses the interface, is explicitly excluded. The total energy is:\n$$ E = \\sum_{j=0}^{I-1} \\varphi(x_{j+1} - x_j) $$\nThe force on atom $I$ is given by $f_I = -\\frac{\\partial E}{\\partial x_I}$. Examining the sum for $E$, the position $x_I$ only appears in the final term, corresponding to the bond between atom $I-1$ and atom $I$, i.e., $\\varphi(x_I - x_{I-1})$. All other terms are independent of $x_I$. Therefore, the force on atom $I$ is:\n$$ f_I = -\\frac{\\partial}{\\partial x_I} \\left[ \\varphi(x_I - x_{I-1}) \\right] = -\\varphi'(r_{I-1,I}) $$\nwhere $r_{I-1,I} = x_I - x_{I-1}$ is the length of the bond $(I-1, I)$ and $\\varphi'(r)$ is the first derivative of the pair potential with respect to its argument.\n\nThis force, $f_I$, is the uncorrected residual force at the interface, commonly known as the \"ghost force.\" In a full atomistic chain, the force on atom $I$ would be $f_I^{\\text{full}} = -\\varphi'(x_I - x_{I-1}) + \\varphi'(x_{I+1} - x_I)$. By dropping the bond $(I, I+1)$, the term $+\\varphi'(x_{I+1} - x_I)$ is lost, leaving an unbalanced force.\n\nThe problem considers a state of uniform macroscopic strain $\\varepsilon$. In this configuration, all atomic bond lengths are identical: $r_{j, j+1} = a = (1+\\varepsilon)a_0$ for all $j$. Substituting this into the force expression, the ghost force on atom $I$ is:\n$$ f_I^{\\text{ghost}} = -\\varphi'(a) = -\\varphi'((1+\\varepsilon)a_0) $$\nThe magnitude of this ghost force, which is the first required output for each test case, is $|f_I^{\\text{ghost}}| = |-\\varphi'(a)| = |\\varphi'(a)|$.\n\nNext, we derive the corrective traction force using the Cauchy–Born rule. This rule provides a link between the microscopic atomic interactions and the macroscopic continuum response. The continuum strain energy density $W$ for a deformation gradient $F$ is given by homogenizing the energy of a single representative bond over its reference volume. For a 1D chain with reference spacing $a_0$, this is:\n$$ W(F) = \\frac{\\varphi(Fa_0)}{a_0} $$\nThe first Piola–Kirchhoff stress $P$, which represents the force per reference area (in 1D, just force), is the derivative of the energy density with respect to the deformation gradient:\n$$ P(F) = \\frac{dW}{dF} = \\frac{d}{dF} \\left( \\frac{\\varphi(Fa_0)}{a_0} \\right) = \\frac{1}{a_0} \\cdot \\varphi'(Fa_0) \\cdot \\frac{d(Fa_0)}{dF} = \\frac{1}{a_0} \\cdot \\varphi'(Fa_0) \\cdot a_0 = \\varphi'(Fa_0) $$\nFor a uniform strain $\\varepsilon$, the deformation gradient is $F=1+\\varepsilon$. The continuum stress is therefore $P(1+\\varepsilon) = \\varphi'((1+\\varepsilon)a_0) = \\varphi'(a)$. This stress represents the force that the continuum region (to the right of the interface) exerts on the atomistic region. This force must be applied to the boundary atom, atom $I$, as a corrective traction force, $f_{\\text{corr}}$.\n$$ f_{\\text{corr}} = P(F) = \\varphi'(a) $$\nThe total corrected force on atom $I$ is the sum of the original ghost force and the applied corrective traction:\n$$ f_I^{\\text{corrected}} = f_I^{\\text{ghost}} + f_{\\text{corr}} = -\\varphi'(a) + \\varphi'(a) = 0 $$\nThe magnitude of the corrected force is $|f_I^{\\text{corrected}}| = |0| = 0$. This result demonstrates that the Cauchy–Born stress provides the exact traction needed to cancel the ghost force under uniform deformation. This is the condition for passing the \"patch test.\"\n\nThe patch test diagnostic is a boolean check to verify this cancellation. It passes if the magnitude of the corrected force is less than or equal to a numerical tolerance $\\tau$:\n$$ |f_I^{\\text{corrected}}| \\le \\tau $$\nSince our analytical result is exactly $0$, this test should pass for any non-negative tolerance $\\tau$.\n\nFinally, we apply these general formulas to the specific potentials provided.\n\nFor the harmonic potential, $\\varphi(r) = \\frac{1}{2} k (r - a_0)^2$, the derivative is $\\varphi'(r) = k (r - a_0)$.\nThe ghost force magnitude is $|\\varphi'(a)| = |k (a - a_0)| = |k ((1+\\varepsilon)a_0 - a_0)| = |k \\varepsilon a_0|$.\nThe corrected force magnitude is $0$.\n\nFor the Lennard-Jones potential, $\\varphi(r) = 4 \\epsilon [ (\\frac{\\sigma}{r})^{12} - (\\frac{\\sigma}{r})^6 ]$, the derivative is $\\varphi'(r) = 4 \\epsilon [ -12 \\frac{\\sigma^{12}}{r^{13}} + 6 \\frac{\\sigma^6}{r^7} ]$.\nThe ghost force magnitude is $|\\varphi'(a)| = |4 \\epsilon [ -12 \\frac{\\sigma^{12}}{a^{13}} + 6 \\frac{\\sigma^6}{a^7} ]|$, where $a=(1+\\varepsilon)a_0$.\nThe corrected force magnitude is again $0$.\n\nThe implementation will consist of functions that compute $\\varphi'(a)$ for each potential, calculate the ghost force magnitude $|\\varphi'(a)|$ and the corrected force magnitude (which is always $0$ in this idealized case), and then perform the boolean check against the tolerance $\\tau$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes ghost forces, corrected forces, and patch test results for\n    atomistic-continuum coupling test cases.\n    \"\"\"\n\n    def phi_prime_harmonic(r, a0, k):\n        \"\"\"\n        Derivative of the harmonic potential: phi'(r) = k * (r - a0).\n        \"\"\"\n        return k * (r - a0)\n\n    def phi_prime_lennard_jones(r, a0, epsilon, sigma):\n        \"\"\"\n        Derivative of the Lennard-Jones potential: \n        phi'(r) = 4 * eps * [-12*(sig/r)^13/sig + 6*(sig/r)^7/sig].\n        The a0 parameter is not used by the potential itself but is part of\n        the problem's physical setup. It's kept for signature consistency.\n        \"\"\"\n        # Note: r is the deformed bond length 'a' in the main logic.\n        # The potential is defined purely by r, epsilon, and sigma.\n        # The equation for phi'(r) can be written as:\n        # phi'(r) = (24*epsilon/r) * ( (sigma/r)^6 - 2*(sigma/r)^12 )\n        r_ratio_6 = (sigma / r)**6\n        r_ratio_12 = r_ratio_6**2\n        return (24 * epsilon / r) * (r_ratio_6 - 2 * r_ratio_12)\n\n    # Test suite from the problem statement\n    # Each case: (potential_name, N, I, a0, epsilon_strain, params_dict, tau)\n    test_cases = [\n        (\"harmonic\", 50, 25, 1.0, 0.02, {'k': 100.0}, 1e-12),\n        (\"harmonic\", 30, 15, 1.0, 0.0, {'k': 10.0}, 1e-12),\n        (\"lennard-jones\", 100, 60, 1.0, 0.05, {'epsilon': 1.0, 'sigma': 2**(-1/6)}, 1e-12),\n        (\"harmonic\", 40, 20, 1.0, -0.01, {'k': 50.0}, 1e-12),\n    ]\n\n    # Map potential names to their derivative functions\n    potential_derivatives = {\n        \"harmonic\": phi_prime_harmonic,\n        \"lennard-jones\": phi_prime_lennard_jones,\n    }\n\n    results = []\n    for case in test_cases:\n        potential_name, N, I, a0, epsilon_strain, params, tau = case\n\n        # 1. Calculate the deformed bond length 'a' under uniform strain\n        a = (1.0 + epsilon_strain) * a0\n\n        # 2. Get the appropriate potential derivative function\n        phi_prime_func = potential_derivatives[potential_name]\n\n        # 3. Calculate phi'(a), the derivative of the potential at the deformed length\n        #    Note: For LJ, the function signature includes a0 for consistency,\n        #    but the derivative itself only depends on r, epsilon, and sigma.\n        phi_prime_val = phi_prime_func(r=a, a0=a0, **params)\n        \n        # 4. Compute the naive ghost force and its magnitude\n        #    f_ghost = -phi'(a)\n        f_ghost = -phi_prime_val\n        gf_before = abs(f_ghost)\n        \n        # 5. Compute the corrected force and its magnitude\n        #    The correction is the Cauchy-Born traction, f_corr = P(F) = phi'(a)\n        #    f_corrected = f_ghost + f_corr = -phi'(a) + phi'(a) = 0\n        f_corrected = 0.0  # Analytically zero\n        gf_after = abs(f_corrected)\n\n        # 6. Perform the patch test\n        patch_test_passed = gf_after <= tau\n\n        # 7. Append results to the list\n        results.extend([gf_before, gf_after, patch_test_passed])\n\n    # Format and print the final output\n    # Convert booleans to strings ('True'/'False') and floats to strings\n    formatted_results = [str(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "How can we quantitatively determine if a coarse-grained model is a faithful representation of the underlying atomistic reality? This practice introduces the Kullback-Leibler (KL) divergence, or relative entropy, as a powerful tool from information theory to measure the information lost when one probability distribution is used to approximate another . You will apply this concept to compare different effective potentials against a known 'ground truth' model, a common and essential task in model selection and parameterization.",
            "id": "3817164",
            "problem": "Consider a one-dimensional coarse-grained coordinate $X$ obtained from an atomistic material model by marginalizing over fast degrees of freedom to obtain a Potential of Mean Force (PMF) $W(X)$. Assume temperature-scaled units where Boltzmann's constant times temperature is set to $k_B T = 1$, so that all energies are dimensionless and probability densities are expressed in natural units (nats). The atomistic coarse distribution is defined by the Boltzmann law $p_{\\text{atom}}(X) = Z_{\\text{atom}}^{-1} \\exp(-W(X))$, where $Z_{\\text{atom}} = \\int_{-\\infty}^{\\infty} \\exp(-W(X))\\,dX$ is the partition function. A candidate effective coarse model has a parametric potential $U_{\\text{eff}}(X;\\theta)$ that induces the distribution $p_{\\text{eff}}(X;\\theta) = Z_{\\text{eff}}(\\theta)^{-1} \\exp(-U_{\\text{eff}}(X;\\theta))$, where $Z_{\\text{eff}}(\\theta) = \\int_{-\\infty}^{\\infty} \\exp(-U_{\\text{eff}}(X;\\theta))\\,dX$.\n\nInformation passing across scales can be quantified by the Kullback-Leibler (KL) divergence (also called relative entropy) from $p_{\\text{atom}}$ to $p_{\\text{eff}}$, defined as\n$$\n\\mathcal{R}(\\theta) = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) \\log\\left(\\frac{p_{\\text{atom}}(X)}{p_{\\text{eff}}(X;\\theta)}\\right)\\,dX.\n$$\nThis quantity measures the information loss when the effective model replaces the atomistic description at the coarse scale. Lower values of $\\mathcal{R}(\\theta)$ indicate better information transfer.\n\nWork in the following scientifically realistic, self-consistent setting:\n- The atomistic PMF is the double-well quartic\n$$\nW(X) = a X^4 - b X^2,\n$$\nwith $a = 3$ and $b = 6$.\n- The inverse temperature is $\\beta = 1$ (dimensionless).\n- Two functional families of effective models are considered:\n  1. Quartic family: $U_{\\text{eff}}(X;\\theta) = \\alpha X^4 - \\beta_2 X^2$, with parameters $\\theta = (\\alpha,\\beta_2)$.\n  2. Harmonic family: $U_{\\text{eff}}(X;\\theta) = \\frac{1}{2} k (X - \\mu)^2$, with parameters $\\theta = (k,\\mu)$.\n\nStarting from the fundamental definitions above, derive an implementable expression for $\\mathcal{R}(\\theta)$ that makes no use of shortcut formulas. Compute $\\mathcal{R}(\\theta)$ by numerical integration over $X \\in (-\\infty,\\infty)$ for the following test suite of parameter values (each test case is a distinct $\\theta$):\n- Test case $1$ (happy path, exact-match): Quartic with $(\\alpha,\\beta_2) = (3,6)$.\n- Test case $2$ (near miss): Quartic with $(\\alpha,\\beta_2) = (2.8,5.7)$.\n- Test case $3$ (edge case, very stiff unimodal): Harmonic with $(k,\\mu) = (25,0)$.\n- Test case $4$ (edge case, very soft unimodal): Harmonic with $(k,\\mu) = (0.5,0)$.\n\nAll quantities are dimensionless; report $\\mathcal{R}(\\theta)$ in nats. Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, with each value rounded to $6$ decimal places (for example, $[\\text{r}_1,\\text{r}_2,\\text{r}_3,\\text{r}_4]$). The numerical integration must evaluate the required integrals over the entire real line $(-\\infty,\\infty)$ to ensure correct normalization and expectations. The final answers for each test case must be floats (nats).",
            "solution": "The objective is to compute the Kullback-Leibler (KL) divergence, $\\mathcal{R}(\\theta)$, from a reference atomistic probability distribution $p_{\\text{atom}}(X)$ to a parametric effective model distribution $p_{\\text{eff}}(X;\\theta)$. This quantity measures the information lost when approximating the detailed atomistic model with a simpler effective one.\n\nThe fundamental definition of the KL divergence is given by:\n$$\n\\mathcal{R}(\\theta) = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) \\log\\left(\\frac{p_{\\text{atom}}(X)}{p_{\\text{eff}}(X;\\theta)}\\right)\\,dX\n$$\nTo create an implementable numerical algorithm, we must first expand this definition. Using the properties of the logarithm, we can separate the term inside the integral:\n$$\n\\mathcal{R}(\\theta) = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) \\left[ \\log(p_{\\text{atom}}(X)) - \\log(p_{\\text{eff}}(X;\\theta)) \\right]\\,dX\n$$\n$$\n\\mathcal{R}(\\theta) = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) \\log(p_{\\text{atom}}(X))\\,dX - \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) \\log(p_{\\text{eff}}(X;\\theta))\\,dX\n$$\nThe problem defines the probability distributions according to the principles of statistical mechanics, via the Boltzmann law, with the inverse temperature $\\beta = 1$:\n$$\np_{\\text{atom}}(X) = \\frac{1}{Z_{\\text{atom}}} \\exp(-W(X))\n$$\n$$\np_{\\text{eff}}(X;\\theta) = \\frac{1}{Z_{\\text{eff}}(\\theta)} \\exp(-U_{\\text{eff}}(X;\\theta))\n$$\nHere, $W(X)$ is the atomistic Potential of Mean Force (PMF), $U_{\\text{eff}}(X;\\theta)$ is the effective potential with parameters $\\theta$, and $Z_{\\text{atom}}$ and $Z_{\\text{eff}}(\\theta)$ are their respective partition functions (normalization constants). Taking the natural logarithm of these expressions gives:\n$$\n\\log(p_{\\text{atom}}(X)) = -W(X) - \\log(Z_{\\text{atom}})\n$$\n$$\n\\log(p_{\\text{eff}}(X;\\theta)) = -U_{\\text{eff}}(X;\\theta) - \\log(Z_{\\text{eff}}(\\theta))\n$$\nSubstituting these into the expanded expression for $\\mathcal{R}(\\theta)$:\n$$\n\\mathcal{R}(\\theta) = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) [-W(X) - \\log(Z_{\\text{atom}})]\\,dX - \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) [-U_{\\text{eff}}(X;\\theta) - \\log(Z_{\\text{eff}}(\\theta))]\\,dX\n$$\nWe can express this using the expectation operator $\\langle f(X) \\rangle_{\\text{atom}} = \\int_{-\\infty}^{\\infty} p_{\\text{atom}}(X) f(X) dX$. Since $\\int p_{\\text{atom}}(X) dX = 1$:\n$$\n\\mathcal{R}(\\theta) = [-\\langle W(X) \\rangle_{\\text{atom}} - \\log(Z_{\\text{atom}})] - [-\\langle U_{\\text{eff}}(X;\\theta) \\rangle_{\\text{atom}} - \\log(Z_{\\text{eff}}(\\theta))]\n$$\nRearranging the terms yields a common and physically intuitive form of the KL divergence in this context:\n$$\n\\mathcal{R}(\\theta) = \\langle U_{\\text{eff}}(X;\\theta) \\rangle_{\\text{atom}} - \\langle W(X) \\rangle_{\\text{atom}} + \\log(Z_{\\text{eff}}(\\theta)) - \\log(Z_{\\text{atom}})\n$$\nThis expression can be interpreted as the sum of the average difference in potential energy (averaged over the true atomistic distribution) and the difference in the free energies (since $F = -k_B T \\log Z$, and $k_B T = 1$, so $F = -\\log Z$).\n\nFor numerical computation, it is advantageous to combine the expectation terms:\n$$\n\\mathcal{R}(\\theta) = \\langle U_{\\text{eff}}(X;\\theta) - W(X) \\rangle_{\\text{atom}} + \\log(Z_{\\text{eff}}(\\theta)) - \\log(Z_{\\text{atom}})\n$$\nWriting out the expectation and the partition functions explicitly as integrals gives the final form for implementation:\n$$\n\\mathcal{R}(\\theta) = \\frac{\\int_{-\\infty}^{\\infty} [U_{\\text{eff}}(X;\\theta) - W(X)] \\exp(-W(X)) dX}{\\int_{-\\infty}^{\\infty} \\exp(-W(X)) dX} + \\log\\left(\\int_{-\\infty}^{\\infty} \\exp(-U_{\\text{eff}}(X;\\theta)) dX\\right) - \\log\\left(\\int_{-\\infty}^{\\infty} \\exp(-W(X)) dX\\right)\n$$\nThis formulation requires the computation of three one-dimensional integrals over the domain $(-\\infty, \\infty)$:\n1.  The atomistic partition function, $Z_{\\text{atom}} = \\int_{-\\infty}^{\\infty} \\exp(-W(X)) dX$.\n2.  The effective model partition function, $Z_{\\text{eff}}(\\theta) = \\int_{-\\infty}^{\\infty} \\exp(-U_{\\text{eff}}(X;\\theta)) dX$.\n3.  The numerator of the expectation, $I_{\\text{num}}(\\theta) = \\int_{-\\infty}^{\\infty} [U_{\\text{eff}}(X;\\theta) - W(X)] \\exp(-W(X)) dX$.\n\nThe final computation is then $\\mathcal{R}(\\theta) = \\frac{I_{\\text{num}}(\\theta)}{Z_{\\text{atom}}} + \\log(Z_{\\text{eff}}(\\theta)) - \\log(Z_{\\text{atom}})$. These integrals will be evaluated numerically using a standard quadrature method.\n\nThe specific potentials are:\n- Atomistic PMF: $W(X) = 3X^4 - 6X^2$.\n- Quartic effective model: $U_{\\text{eff}}(X;\\alpha,\\beta_2) = \\alpha X^4 - \\beta_2 X^2$.\n- Harmonic effective model: $U_{\\text{eff}}(X;k,\\mu) = \\frac{1}{2} k (X - \\mu)^2$.\n\nFor test case $1$, where $(\\alpha, \\beta_2) = (3, 6)$, the effective potential $U_{\\text{eff}}$ is identical to the atomistic potential $W$. In this scenario, $U_{\\text{eff}}(X;\\theta) - W(X) = 0$, making $I_{\\text{num}}(\\theta) = 0$. Also, $Z_{\\text{eff}}(\\theta) = Z_{\\text{atom}}$. Consequently, $\\mathcal{R}(\\theta) = 0 + \\log(Z_{\\text{atom}}) - \\log(Z_{\\text{atom}}) = 0$. This provides an exact analytical result that serves as a robust validation for the method. For the other cases, numerical integration is necessary.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the Kullback-Leibler (KL) divergence for different effective models\n    relative to a reference atomistic model.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (model_type, parameters)\n    test_cases = [\n        ('quartic', {'alpha': 3.0, 'beta2': 6.0}),      # Test case 1\n        ('quartic', {'alpha': 2.8, 'beta2': 5.7}),      # Test case 2\n        ('harmonic', {'k': 25.0, 'mu': 0.0}),           # Test case 3\n        ('harmonic', {'k': 0.5, 'mu': 0.0}),            # Test case 4\n    ]\n\n    results = []\n\n    # Define the atomistic Potential of Mean Force (PMF) W(X)\n    # W(X) = a*X^4 - b*X^2 with a=3, b=6\n    a_atom, b_atom = 3.0, 6.0\n    def W_func(x):\n        return a_atom * x**4 - b_atom * x**2\n\n    # Integrand for the atomistic partition function Z_atom\n    def integrand_Z_atom(x):\n        return np.exp(-W_func(x))\n\n    # Compute Z_atom and log(Z_atom) once, as they are constant for all test cases.\n    Z_atom_val, _ = quad(integrand_Z_atom, -np.inf, np.inf)\n    log_Z_atom = np.log(Z_atom_val)\n\n    # Process each test case\n    for model_type, params in test_cases:\n        \n        # Test case 1: Exact match, KL divergence is analytically 0.\n        if model_type == 'quartic' and params['alpha'] == a_atom and params['beta2'] == b_atom:\n            results.append(0.0)\n            continue\n\n        # Define the effective potential U_eff(X; theta) based on the test case\n        if model_type == 'quartic':\n            alpha_eff, beta2_eff = params['alpha'], params['beta2']\n            def U_eff_func(x):\n                return alpha_eff * x**4 - beta2_eff * x**2\n        elif model_type == 'harmonic':\n            k_eff, mu_eff = params['k'], params['mu']\n            def U_eff_func(x):\n                return 0.5 * k_eff * (x - mu_eff)**2\n        \n        # 1. Compute the effective partition function Z_eff(theta)\n        def integrand_Z_eff(x):\n            return np.exp(-U_eff_func(x))\n        \n        Z_eff_val, _ = quad(integrand_Z_eff, -np.inf, np.inf)\n        log_Z_eff = np.log(Z_eff_val)\n\n        # 2. Compute the numerator of the expectation term\n        # I_num = integral [U_eff - W] * exp(-W) dx\n        def integrand_I_num(x):\n            energy_diff = U_eff_func(x) - W_func(x)\n            return energy_diff * np.exp(-W_func(x))\n            \n        I_num_val, _ = quad(integrand_I_num, -np.inf, np.inf)\n\n        # 3. Compute the KL divergence R(theta)\n        # R = I_num/Z_atom + log(Z_eff) - log(Z_atom)\n        kl_divergence = (I_num_val / Z_atom_val) + log_Z_eff - log_Z_atom\n        \n        results.append(round(kl_divergence, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}