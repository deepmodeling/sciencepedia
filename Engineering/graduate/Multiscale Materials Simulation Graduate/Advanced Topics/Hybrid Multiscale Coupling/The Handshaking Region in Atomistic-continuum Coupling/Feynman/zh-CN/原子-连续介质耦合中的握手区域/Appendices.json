{
    "hands_on_practices": [
        {
            "introduction": "在多尺度耦合中，一个最基本的要求是“斑块测试”（patch test）的一致性。这个测试检验了耦合模型能否精确再现一个简单的均匀变形场，这是确保数值方法收敛的必要条件。本练习将通过一个具体的例子，展示一个不恰当的力基耦合方案如何在该测试中失败并产生伪力（ghost force），并引导你推导出恢复一致性所需的修正。",
            "id": "3846756",
            "problem": "考虑一个一维谐振原子链，用于模拟具有最近邻相互作用的均匀结晶固体。原子由整数 $i \\in \\mathbb{Z}$ 索引，并占据参考位置 $X_{i} = i a$，其中 $a > 0$ 是晶格间距。变形后的位置为 $x_{i} = X_{i} + u_{i}$，其中 $u_{i}$ 是位移。相邻原子对由刚度为 $k > 0$ 的线性弹簧连接，原子能量定义为\n$$\nE_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} \\left( x_{i+1} - x_{i} - a \\right)^{2}.\n$$\n假设存在均匀的宏观应变 $ \\epsilon $，使得位移场为 $u_{i} = \\epsilon X_{i} = \\epsilon i a$。那么，每个原子上的精确原子内力为零。\n\n您希望通过一个由原子 $i=0$ 和 $i=1$ 之间的跨界相互作用组成的握手区，将原子区域（$X \\leq 0$）与连续介质区域（$X \\geq a$）耦合起来。在连续介质区域中，您使用从原子能量推导出的 Cauchy-Born 假设对材料进行建模。单位参考长度的连续介质能量密度为\n$$\nW(F) = \\frac{k a}{2} (F - 1)^{2},\n$$\n其中 $F = \\frac{d x}{d X}$ 是一维变形梯度。第一 Piola 应力（在一维情况下等于 Cauchy 应力）为\n$$\n\\sigma(F) = \\frac{d W}{d F} = k a (F - 1) = k a \\epsilon.\n$$\n\n在一个朴素的基于力的耦合中，跨界键 $(0,1)$ 从原子力的计算中移除，并在原子 $i=0$ 上施加一个连续介质牵引力，以表示与连续介质侧的相互作用。然而，由于一个不正确的握手区公式，施加的连续介质牵引力被一个因子 $\\alpha = \\frac{1}{2}$ 缩放，因此使用的牵引力是 $\\alpha \\sigma(F)$ 而不是 $\\sigma(F)$。左侧相邻的键 $( -1, 0 )$ 保持原子性。\n\n使用第一性原理，推导在均匀应变分片检验下原子 $i=0$ 上的残余（伪）力。然后，通过引入一个修正乘子 $\\gamma$ 来修改握手区公式，该乘子重新缩放握手区中的连续介质牵引力，以恢复分片检验的一致性（即，对于任何均匀应变，伪力为零）。使用具体的材料参数 $a = 0.25\\,\\mathrm{nm}$ 和 $k = 100\\,\\mathrm{N/m}$，并假设一个小的均匀应变 $\\epsilon = 0.01$。将您的最终答案表示为无量纲修正乘子 $\\gamma$ 的单一值。无需四舍五入，最终答案不应使用单位。",
            "solution": "用户希望解决一个关于一维谐振原子链的原子-连续介质耦合问题。\n\n### 步骤 1：提取给定信息\n-   **系统**：具有最近邻相互作用的一维谐振原子链。\n-   **参考位置**：$X_i = i a$，其中原子由 $i \\in \\mathbb{Z}$ 索引，晶格间距 $a > 0$。\n-   **变形后位置**：$x_i = X_i + u_i$，其中 $u_i$ 是位移。\n-   **原子能量**：$E_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} ( x_{i+1} - x_{i} - a )^{2}$，其中弹簧刚度 $k > 0$。\n-   **测试条件**：均匀宏观应变 $\\epsilon$，导致位移 $u_i = \\epsilon X_i = \\epsilon i a$。\n-   **耦合区域**：原子区域为 $X \\leq 0$ (即 $i \\leq 0$)，连续介质区域为 $X \\geq a$ (即 $i \\geq 1$)。\n-   **握手区**：原子 $i=0$ 和原子 $i=1$ 之间的跨界相互作用。\n-   **连续介质模型**：由 Cauchy-Born 假设推导得出。\n-   **连续介质能量密度**：$W(F) = \\frac{ka}{2} (F-1)^2$，其中 $F = \\frac{dx}{dX}$ 是变形梯度。\n-   **连续介质应力**：$\\sigma(F) = \\frac{dW}{dF} = ka(F-1) = ka\\epsilon$。\n-   **不正确的耦合公式**：\n    -   从原子力总和中移除键 $(0,1)$。\n    -   在原子 $i=0$ 上施加一个牵引力。\n    -   该施加的牵引力大小为 $\\alpha \\sigma(F)$，其中 $\\alpha = \\frac{1}{2}$。\n-   **目标**：\n    1.  推导原子 $i=0$ 上的残余（伪）力。\n    2.  找到一个修正乘子 $\\gamma$，重新缩放施加的连续介质牵引力，以确保伪力为零（分片检验一致性）。\n-   **给定参数**：$a = 0.25\\,\\mathrm{nm}$，$k = 100\\,\\mathrm{N/m}$，$\\epsilon = 0.01$。\n\n### 步骤 2：使用提取的给定信息进行验证\n该问题具有科学依据，提法明确且客观。它描述了一个标准的分片检验（\"patch test\"）分析，这是多尺度方法的一个基本一致性检查。一维谐振原子链是用于此目的的典型模型系统。能量、力、Cauchy-Born 应力和耦合方案的数学定义是标准的、清晰的和一致的。问题是自洽的，并提供了推导无量纲乘子 $\\gamma$ 所需的所有信息。所提供的数值参数在物理上是合理的，并且，如下所示，推导 $\\gamma$ 并不需要它们的具体值，这考验了对概念的基本理解。该问题是有效的。\n\n### 步骤 3：推导与求解\n该问题要求满足“分片检验”，这是多尺度方法收敛的必要条件。分片检验验证了对于任何均匀应变场，耦合的原子-连续介质模型都能重现精确的解析解。在这种情况下，精确解是所有原子都处于平衡状态，意味着每个原子上的合力为零。\n\n在完整的原子模型中，原子 $i$ 上的合力由 $f_i = -\\frac{\\partial E_{\\mathrm{atom}}}{\\partial x_i}$ 给出。根据所提供的能量表达式，这变为：\n$$\nf_i = -\\frac{\\partial}{\\partial x_i} \\left[ \\frac{k}{2}(x_i - x_{i-1} - a)^2 + \\frac{k}{2}(x_{i+1} - x_i - a)^2 \\right] = k(x_{i+1} - 2x_i + x_{i-1})\n$$\n在均匀应变 $\\epsilon$ 下，变形后的位置为 $x_i = ia(1+\\epsilon)$。将此代入力的表达式中：\n$$\nf_i = k \\left[ (i+1)a(1+\\epsilon) - 2ia(1+\\epsilon) + (i-1)a(1+\\epsilon) \\right] = k a(1+\\epsilon) [ (i+1) - 2i + (i-1) ] = 0\n$$\n这证实了在完整的原子模型中，每个原子上的合力都为零，与问题陈述一致。\n\n现在，我们分析混合模型。重点是位于界面上的原子 $i=0$。它的左邻原子 $i=-1$ 以原子方式处理，而其与右侧的相互作用被连续介质牵引力所取代。在混合模型中，原子 $i=0$ 上的合力 $f_0^{\\mathrm{hyb}}$ 是来自左侧键 $(-1,0)$ 的力和来自右侧施加的牵引力的总和。\n$$\nf_0^{\\mathrm{hyb}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}}\n$$\n原子 $-1$ 对原子 $0$ 的力由涉及键 $(-1,0)$ 的势能项导出：\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -\\frac{\\partial}{\\partial x_0} \\left[ \\frac{k}{2}(x_0 - x_{-1} - a)^2 \\right] = -k(x_0 - x_{-1} - a)\n$$\n代入均匀应变下的位置 $x_0 = 0$ 和 $x_{-1} = -a(1+\\epsilon)$，我们得到：\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -k(0 - [-a(1+\\epsilon)] - a) = -k(a + a\\epsilon - a) = -ka\\epsilon\n$$\n问题陈述，由于一个不正确的公式，施加的牵引力为 $f^{\\mathrm{traction}} = \\alpha \\sigma(F)$，其中 $\\alpha = \\frac{1}{2}$ 且 $\\sigma(F) = ka\\epsilon$。\n$$\nf^{\\mathrm{traction}} = \\frac{1}{2} ka\\epsilon\n$$\n原子 $0$ 上的最终合力，即残余或“伪”力，是：\n$$\nf_0^{\\mathrm{ghost}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}} = -ka\\epsilon + \\frac{1}{2} ka\\epsilon = -\\frac{1}{2} ka\\epsilon\n$$\n这就是有缺陷的耦合方案下的伪力。\n\n为了恢复分片检验的一致性，我们必须修改方案，使原子 $0$ 上的合力为零。这通过引入一个修正乘子 $\\gamma$ 来实现，该乘子重新缩放不正确公式化的牵引力。修正后的牵引力是：\n$$\nf^{\\mathrm{corrected}} = \\gamma f^{\\mathrm{traction}} = \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right)\n$$\n分片检验一致性的条件是原子 $0$ 上的新总力必须为零：\n$$\nf_0^{\\mathrm{new}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{corrected}} = 0\n$$\n代入力的表达式：\n$$\n-ka\\epsilon + \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right) = 0\n$$\n为了使分片检验对任何均匀应变 $\\epsilon \\neq 0$ 都有效，并且考虑到 $k>0$ 和 $a>0$，我们可以将整个方程除以 $ka\\epsilon$：\n$$\n-1 + \\frac{\\gamma}{2} = 0\n$$\n求解无量纲乘子 $\\gamma$：\n$$\n\\frac{\\gamma}{2} = 1 \\implies \\gamma = 2\n$$\n$\\gamma$ 的值与具体的材料参数 $a$ 和 $k$ 以及应变 $\\epsilon$ 无关。因此，最终答案不需要给定的数值。修正乘子必须为 $\\gamma=2$，以抵消初始的错误因子 $\\alpha=\\frac{1}{2}$，并确保施加的牵引力正确地代表了被移除的原子键所产生的力。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "在原子-连续介质耦合中，一个核心挑战是如何在两种不同分辨率的描述之间传递信息。将连续介质场的位移通过插值映射到原子位置是常用方法，但这会引入误差，也是“伪力”的主要来源之一。本练习将引导你从第一性原理出发，推导这种插值误差的解析表达式，从而深刻理解误差与变形波长及网格尺寸之间的关系。",
            "id": "3846699",
            "problem": "在一个用于原子-连续介质耦合的一维握手区中，一个连续介质位移场由 $u_{c}(x) = A \\sin(k x)$ 给出，其中 $A$ 是振幅，$k$ 是波数。该连续介质子域通过节点间距为 $h$ 的均匀网格进行离散，并且假设重叠（握手）区域中的原子位于连续介质单元的中点，即对于每个满足 $x_{j+1} - x_{j} = h$ 的单元 $\\left[x_{j}, x_{j+1}\\right]$，原子位置在 $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$。原子位移是通过使用来自两个相邻连续介质节点的线性有限元插值，将连续介质场映射到原子位置来指定的，即 $u_{a}(x_{m}) = N_{1}(x_{m}) u_{c}(x_{j}) + N_{2}(x_{m}) u_{c}(x_{j+1})$，其中 $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ 且 $N_{2}(x) = \\frac{x - x_{j}}{h}$。\n\n将中点处的归一化插值误差定义为\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{\\left| u_{c}(x_{m}) - u_{a}(x_{m}) \\right|}{A}.\n$$\n从基本定义（线性插值映射的定义和 $u_{c}$ 的三角函数形式）出发，推导 $E_{\\mathrm{rel}}(h)$ 作为 $k$ 和 $h$ 的函数的闭式解析表达式。然后，基于同样的出发点进行渐近推理，确定在小网格极限 $k h \\to 0$ 下，$E_{\\mathrm{rel}}(h)$ 如何随着网格细化而减小。提供 $E_{\\mathrm{rel}}(h)$ 的精确闭式表达式；不需要进行数值计算。答案必须是无量纲的，因此请报告归一化误差 $E_{\\mathrm{rel}}(h)$（无单位）。",
            "solution": "我们考虑一个一维握手区，其中连续介质单元中点的原子通过线性有限元插值继承位移。连续介质位移为 $u_{c}(x) = A \\sin(k x)$。在一个满足 $x_{j+1} - x_{j} = h$ 的单元 $\\left[x_{j}, x_{j+1}\\right]$ 上，中点为 $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$。根据使用形函数 $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ 和 $N_{2}(x) = \\frac{x - x_{j}}{h}$ 的线性插值映射的定义，中点处的映射原子位移为\n$$\nu_{a}(x_{m}) = \\frac{1}{2} u_{c}(x_{j}) + \\frac{1}{2} u_{c}(x_{j+1}) = \\frac{A}{2} \\left[ \\sin(k x_{j}) + \\sin(k x_{j+1}) \\right].\n$$\n中点处的精确连续介质位移为\n$$\nu_{c}(x_{m}) = A \\sin\\!\\left( k \\frac{x_{j} + x_{j+1}}{2} \\right) = A \\sin\\!\\left( \\frac{k x_{j} + k x_{j+1}}{2} \\right).\n$$\n引入相位 $\\varphi = k x_{j}$ 和无量纲单元相位增量 $s = k h$，因此 $k x_{j+1} = \\varphi + s$ 且 $k x_{m} = \\varphi + \\frac{s}{2}$。于是\n$$\nu_{a}(x_{m}) = \\frac{A}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right], \\quad u_{c}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right).\n$$\n使用三角恒等式 $\\sin(\\alpha) + \\sin(\\beta) = 2 \\sin\\!\\left( \\frac{\\alpha + \\beta}{2} \\right) \\cos\\!\\left( \\frac{\\alpha - \\beta}{2} \\right)$，并设 $\\alpha = \\varphi$ 和 $\\beta = \\varphi + s$，我们得到\n$$\n\\frac{1}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right] = \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right).\n$$\n因此，单元 $j$ 中点处的插值误差为\n$$\ne_{j} = u_{c}(x_{m}) - u_{a}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) - A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\left[ 1 - \\cos\\!\\left( \\frac{s}{2} \\right) \\right].\n$$\n用 $A$ 进行归一化，并对所有单元 $j$（等效于对所有相位 $\\varphi$）取上确界，注意到 $\\left| \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\right| \\leq 1$ 且等号可以取到。因此，整个重叠区域中点处的最坏情况下的归一化插值误差为\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{|e_{j}|}{A} = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right).\n$$\n为确定网格细化如何减小此误差，我们考虑小网格极限 $k h \\to 0$。使用泰勒展开式 $\\cos(z) = 1 - \\frac{z^{2}}{2} + \\frac{z^{4}}{24} - \\cdots$，我们得到\n$$\n1 - \\cos\\!\\left( \\frac{k h}{2} \\right) = \\frac{1}{2} \\left( \\frac{k h}{2} \\right)^{2} - \\frac{1}{24} \\left( \\frac{k h}{2} \\right)^{4} + \\cdots = \\frac{k^{2} h^{2}}{8} - \\frac{k^{4} h^{4}}{384} + \\cdots.\n$$\n因此，在网格细化下，握手区中的主导阶标度是 $h$ 的二次方：当 $h \\to 0$ 时，$E_{\\mathrm{rel}}(h) \\sim \\frac{k^{2} h^{2}}{8}$。精确的闭式表达式为 $E_{\\mathrm{rel}}(h) = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right)$，该值随着网格细化单调递减至零。",
            "answer": "$$\\boxed{1 - \\cos\\!\\left(\\frac{k h}{2}\\right)}$$"
        },
        {
            "introduction": "理论分析为我们提供了耦合方案误差的预期收敛阶，但最终的验证必须通过数值实验来完成。本练习将让你亲手实现一个基于能量混合的原子-连续介质耦合方案，并通过改变重叠区域的大小来系统地研究其数值精度。通过对计算结果进行拟合分析，你将能够验证该方案的收敛速度是否与理论预测相符，这是多尺度方法开发中的一个标准验证流程。",
            "id": "3846703",
            "problem": "考虑一个用于模拟晶体棒的一维谐振链，它由 $N+1$ 个格点组成，索引为 $i=0,1,2,\\dots,N$，晶格间距为 $a$。设格点 $i$ 的位移为 $u_i$。原子模型包括最近邻和次近邻线性弹簧，其刚度分别为 $k_1$ 和 $k_2$。连续介质模型是 Cauchy-Born 近似，对于均匀应变，它简化为在相同晶格上定义的局部二阶差分算子，其有效刚度为 $k_{\\mathrm{eff}} = k_1 + 4 k_2$。系统在分布体力 $f(x)$ 作用下处于准静态平衡状态，并满足狄利克雷边界条件 $u_0 = 0$ 和 $u_N = 0$。所有量均已无量纲化；报告的相对误差是无量纲的。\n\n根据标准弹簧组装规则，定义完整的原子刚度矩阵 $\\mathbf{K}^{\\mathrm{a}} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$：对于连接 $(i,i+1)$ 的每个最近邻弹簧，在行和列 $(i,i+1)$ 处添加 $2\\times 2$ 的贡献 $\\begin{pmatrix} k_1 & -k_1 \\\\ -k_1 & k_1 \\end{pmatrix}$；对于连接 $(i,i+2)$ 的每个次近邻弹簧，在行和列 $(i,i+2)$ 处添加 $2\\times 2$ 的贡献 $\\begin{pmatrix} k_2 & -k_2 \\\\ -k_2 & k_2 \\end{pmatrix}$。类似地，仅使用刚度为 $k_{\\mathrm{eff}}$ 的最近邻弹簧来定义连续介质刚度矩阵 $\\mathbf{K}^{\\mathrm{c}} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$。\n\n令自由索引集为 $\\mathcal{F} = \\{1,2,\\dots,N-1\\}$，具有相应的缩减矩阵 $\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}}$ 和 $\\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}$，以及缩减体力向量 $\\mathbf{f}_{\\mathcal{F}}$，其分量为 $f_i a$（对于 $i \\in \\mathcal{F}$），其中 $f_i = f(x_i)$ 且 $x_i = i a$。原子参考解 $\\mathbf{u}^{\\mathrm{ref}} \\in \\mathbb{R}^{N-1}$ 是以下方程的唯一解\n$$\n\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{ref}} = \\mathbf{f}_{\\mathcal{F}}.\n$$\n现在，使用以链中点为中心、半宽度为 $w$（以晶格间距为单位）的握手重叠区域来耦合原子模型和连续介质模型。令 $\\ell = \\lfloor N/2 \\rfloor$，并通过 $L = \\max(1, \\ell - w)$ 和 $R = \\min(N-1, \\ell + w)$ 在自由集中定义一个重叠索引区间 $[L,R]$。通过以下公式为每个自由索引 $i \\in \\mathcal{F}$ 定义一个逐行混合权重 $w^{\\mathrm{a}}_i$\n$$\nw^{\\mathrm{a}}_i = \n\\begin{cases}\n1, & i \\le L \\\\\n\\dfrac{R - i}{R - L}, & L < i < R \\\\\n0, & i \\ge R\n\\end{cases}\n\\quad\\text{以及}\\quad\nw^{\\mathrm{c}}_i = 1 - w^{\\mathrm{a}}_i.\n$$\n引入尺寸为 $(N-1)\\times(N-1)$ 的对角矩阵 $\\mathbf{W}^{\\mathrm{a}} = \\mathrm{diag}(w^{\\mathrm{a}}_i)$ 和 $\\mathbf{W}^{\\mathrm{c}} = \\mathrm{diag}(w^{\\mathrm{c}}_i)$，并通过逐行混合定义耦合算子：\n$$\n\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} = \\mathbf{W}^{\\mathrm{a}} \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} + \\mathbf{W}^{\\mathrm{c}} \\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}.\n$$\n耦合解 $\\mathbf{u}^{\\mathrm{couple}}(w)$ 定义为以下方程的唯一解\n$$\n\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{couple}}(w) = \\mathbf{f}_{\\mathcal{F}}.\n$$\n对于每个重叠半宽度 $w$，定义相对 $L^2$ 位移误差\n$$\n\\varepsilon(w) = \\frac{\\left\\| \\mathbf{u}^{\\mathrm{couple}}(w) - \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}}{\\left\\| \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}},\n\\quad\\text{其中}\\quad\n\\left\\| \\mathbf{v} \\right\\|_{L^2} = \\left( \\sum_{i \\in \\mathcal{F}} a\\, v_i^2 \\right)^{1/2}.\n$$\n假设在此设置中线性混合的理论预测是一阶的，即对于足够大的 $w$，$\\varepsilon(w) \\approx C w^{-p}$，其中 $p_{\\mathrm{th}} = 1$，$C$ 与 $w$ 无关，但取决于模型参数。\n\n您的任务是编写一个完整、可运行的程序，该程序：\n- 按所述构建 $\\mathbf{K}^{\\mathrm{a}}$ 和 $\\mathbf{K}^{\\mathrm{c}}$，施加 $u_0 = 0$ 和 $u_N = 0$，并在 $\\mathcal{F}$ 上形成缩减系统。\n- 计算原子参考解 $\\mathbf{u}^{\\mathrm{ref}}$。\n- 对于每个指定的重叠半宽度 $w$，构建耦合算子，求解 $\\mathbf{u}^{\\mathrm{couple}}(w)$，并评估 $\\varepsilon(w)$。\n- 通过对 $\\log \\varepsilon(w)$ 与 $\\log w$ 进行线性回归，将观测到的收敛速率 $p$ 拟合到模型 $\\varepsilon(w) \\approx C w^{-p}$，并返回 $p$。\n- 将拟合的 $p$ 与 $p_{\\mathrm{th}} = 1$ 进行比较。\n\n使用以下参数集测试套件，它探讨了不同的色散和重叠情况：\n- 测试用例 A（正常路径）：$N = 200$, $a = 1$, $k_1 = 1$, $k_2 = 0.25$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{\\pi x}{L} \\right)$ 其中 $L = N a$，重叠半宽度 $w \\in \\{2,4,8,16\\}$。\n- 测试用例 B（边界情况：最小重叠和更高频率的载荷）：$N = 160$, $a = 1$, $k_1 = 1$, $k_2 = 0.05$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{2\\pi x}{L} \\right)$ 其中 $L = N a$，重叠半宽度 $w \\in \\{1,2,4,8\\}$。\n- 测试用例 C（边界情况：强非局域性）：$N = 240$, $a = 1$, $k_1 = 1$, $k_2 = 0.5$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{\\pi x}{L} \\right)$ 其中 $L = N a$，重叠半宽度 $w \\in \\{4,8,12,16\\}$。\n\n对于每个测试用例，计算拟合指数 $p$，并确定其是否在 $0.2$ 的容差范围内与理论预测一致，即报告 $|p - p_{\\mathrm{th}}| \\le 0.2$ 是否成立。\n\n最终输出格式：您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表。该列表必须按顺序包含：测试用例 A 的 $p$（四舍五入到三位小数）和一致性布尔值；测试用例 B 的 $p$（四舍五入到三位小数）和一致性布尔值；以及测试用例 C 的 $p$（四舍五入到三位小数）和一致性布尔值。例如，输出必须如下所示\n$$\n\\left[ p_{\\mathrm{A}}, \\mathrm{ok}_{\\mathrm{A}}, p_{\\mathrm{B}}, \\mathrm{ok}_{\\mathrm{B}}, p_{\\mathrm{C}}, \\mathrm{ok}_{\\mathrm{C}} \\right],\n$$\n其中每个 $p_{\\mathrm{(\\cdot)}}$ 是一个浮点数，每个 $\\mathrm{ok}_{\\mathrm{(\\cdot)}}$ 是一个布尔值。不应打印任何其他文本。",
            "solution": "该问题要求对一维谐振晶体的原子-连续介质耦合方案进行数值研究。该分析涉及将耦合模型的解与完全解析的原子参考解进行比较，并确定耦合误差相对于重叠区域大小的收敛速率。\n\n首先，我们定义物理系统和数学模型。该系统是由位于格点 $i=0, 1, \\dots, N$ 处的 $N+1$ 个离散质量组成的链，晶格间距为 $a$。每个质量偏离其平衡位置的位移是 $u_i$。链的两端是固定的，施加狄利克雷边界条件 $u_0 = 0$ 和 $u_N = 0$。\n\n原子模型基于具有最近邻（NN）和次近邻（NNN）相互作用的谐波势，其特征分别为弹簧刚度 $k_1$ 和 $k_2$。对于给定的位移场 $\\mathbf{u}$，总势能是存储在弹簧中的能量之和。准静态平衡方程是通过将每个自由原子（即 $i \\in \\mathcal{F} = \\{1, 2, \\dots, N-1\\}$）上的力设置为零来导出的。这会得到一个线性方程组：\n$$ \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{ref}} = \\mathbf{f}_{\\mathcal{F}} $$\n此处，$\\mathbf{u}^{\\mathrm{ref}}$ 是自由原子的位移向量，$\\mathbf{f}_{\\mathcal{F}}$ 是从分布体力 $f(x)$ 导出的相应节点力向量，即 $(f_{\\mathcal{F}})_i = f(i a) \\cdot a$，而 $\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}}$ 是缩减的原子刚度矩阵。矩阵 $\\mathbf{K}^{\\mathrm{a}}$ 是通过遍历所有 NN 和 NNN 弹簧并将其各自的刚度贡献添加到适当的条目中来组装的。对于连接格点 $i$ 和 $j$ 的刚度为 $k$ 的弹簧，将一个块矩阵 $k \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$ 添加到对应于行和列 $(i, j)$ 的子矩阵中。\n\n连续介质模型是基于 Cauchy-Born 规则的局域近似。对于一维链，这将 NNN 原子模型简化为有效的 NN 模型。有效刚度 $k_{\\mathrm{eff}} = k_1 + 4 k_2$ 确保了在均匀应变下，连续介质模型具有与原子模型相同的应变能密度。连续介质刚度矩阵 $\\mathbf{K}^{\\mathrm{c}}$ 的构建方式与 $\\mathbf{K}^{\\mathrm{a}}$ 类似，但仅使用刚度为 $k_{\\mathrm{eff}}$ 的 NN 弹簧。缩减的连续介质矩阵为 $\\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}$。\n\n问题的核心在于耦合方案，它混合了原子模型和连续介质模型。在链的中点 $\\ell = \\lfloor N/2 \\rfloor$ 周围定义了一个半宽度为 $w$ 的重叠区域。此重叠区域内的自由索引由区间 $[L, R]$ 给出，其中 $L = \\max(1, \\ell - w)$ 且 $R = \\min(N-1, \\ell + w)$。为每个自由格点 $i \\in \\mathcal{F}$ 定义了一个线性混合函数 $w^{\\mathrm{a}}_i$。在纯原子区域（$i \\le L$）中，权重 $w^{\\mathrm{a}}_i$ 为 $1$；在纯连续介质区域（$i \\ge R$）中为 $0$；在 $L < i < R$ 区域内从 $1$ 线性过渡到 $0$。连续介质权重为 $w^{\\mathrm{c}}_i = 1 - w^{\\mathrm{a}}_i$。\n\n耦合刚度矩阵由原子矩阵和连续介质矩阵的逐行混合形成：\n$$ \\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} = \\mathbf{W}^{\\mathrm{a}} \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} + \\mathbf{W}^{\\mathrm{c}} \\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}} $$\n其中 $\\mathbf{W}^{\\mathrm{a}}$ 和 $\\mathbf{W}^{\\mathrm{c}}$ 是包含混合权重的对角矩阵。耦合解 $\\mathbf{u}^{\\mathrm{couple}}(w)$ 是通过求解线性系统 $\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{couple}}(w) = \\mathbf{f}_{\\mathcal{F}}$ 得到的。这种混合方案很简单，但会导致非对称的 $\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}}$，这是被称为“伪力”（ghost forces）的数值伪影的已知来源，尽管该系统仍然是可解的。\n\n为了评估耦合方案的准确性，我们将相对 $L^2$ 误差 $\\varepsilon(w)$ 计算为重叠半宽度 $w$ 的函数：\n$$ \\varepsilon(w) = \\frac{\\left\\| \\mathbf{u}^{\\mathrm{couple}}(w) - \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}}{\\left\\| \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}} $$\n问题定义了 $\\left\\| \\mathbf{v} \\right\\|_{L^2} = (\\sum_{i \\in \\mathcal{F}} a\\, v_i^2)^{1/2}$。在 $\\varepsilon(w)$ 的比率中，比例因子 $\\sqrt{a}$ 会抵消，因此可以使用标准的欧几里得向量范数进行计算。\n\n误差的理论收敛由 $\\varepsilon(w) \\approx C w^{-p}$ 给出，预期速率为 $p_{\\mathrm{th}} = 1$。为了数值确定观测到的速率 $p$，我们对该关系取对数，得到一个线性方程：$\\log \\varepsilon(w) = \\log C - p \\log w$。这表明 $\\log \\varepsilon(w)$ 与 $\\log w$ 的关系图应该是一条斜率为 $-p$ 的直线。我们将为每个测试用例中指定的 $w$ 值计算 $(\\log w, \\log \\varepsilon(w))$ 对，并执行线性回归以找到斜率，从而提取 $p$。\n\n该实现将对三个不同的测试用例执行整个过程。关键步骤包括：构建刚度矩阵，使用 `numpy.linalg.solve` 求解参考解和耦合解的线性系统，计算每个 $w$ 的误差，最后使用 `scipy.stats.linregress` 拟合收敛速率 $p$。然后将拟合的 $p$ 与理论值 $p_{\\mathrm{th}}=1$进行比较，以检查其是否在 $0.2$ 的容差范围内一致。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef assemble_stiffness_matrix(N, k1, k2):\n    \"\"\"\n    Assembles the full (N+1)x(N+1) stiffness matrix for a 1D chain.\n\n    Args:\n        N (int): Number of intervals in the chain (total N+1 sites).\n        k1 (float): Nearest-neighbor spring stiffness.\n        k2 (float): Next-nearest-neighbor spring stiffness.\n\n    Returns:\n        np.ndarray: The (N+1)x(N+1) stiffness matrix.\n    \"\"\"\n    size = N + 1\n    K = np.zeros((size, size))\n\n    # Add nearest-neighbor contributions\n    if k1 != 0:\n        for i in range(N):\n            K[i, i] += k1\n            K[i+1, i+1] += k1\n            K[i, i+1] -= k1\n            K[i+1, i] -= k1\n\n    # Add next-nearest-neighbor contributions\n    if k2 != 0:\n        for i in range(N - 1):\n            K[i, i] += k2\n            K[i+2, i+2] += k2\n            K[i, i+2] -= k2\n            K[i+2, i] -= k2\n    \n    return K\n\ndef solve_case(N, a, k1, k2, f0, f_wave_num, ws):\n    \"\"\"\n    Solves a single test case for the atomistic-continuum coupling problem.\n\n    Args:\n        N (int): Number of intervals.\n        a (float): Lattice spacing.\n        k1 (float): Nearest-neighbor stiffness.\n        k2 (float): Next-nearest-neighbor stiffness.\n        f0 (float): Amplitude of the body force.\n        f_wave_num (int): Wavenumber multiple for the sinusoidal force.\n        ws (list of int): List of overlap half-widths to test.\n\n    Returns:\n        tuple: A tuple containing the fitted convergence rate p (float) and\n               the agreement boolean (bool).\n    \"\"\"\n    # System size for free DOFs\n    M = N - 1\n    p_th = 1.0\n    tolerance = 0.2\n\n    # Define grid and body force for free DOFs\n    x_free = a * np.arange(1, N)\n    L_domain = N * a\n    f_func = lambda x: f0 * np.sin(f_wave_num * np.pi * x / L_domain)\n    f_F = a * f_func(x_free)\n\n    # 1. Construct stiffness matrices and get reduced versions\n    K_a_full = assemble_stiffness_matrix(N, k1, k2)\n    \n    k_eff = k1 + 4 * k2\n    K_c_full = assemble_stiffness_matrix(N, k_eff, 0.0)\n\n    K_a_ff = K_a_full[1:N, 1:N]\n    K_c_ff = K_c_full[1:N, 1:N]\n\n    # 2. Compute reference solution\n    u_ref = np.linalg.solve(K_a_ff, f_F)\n    norm_u_ref = np.linalg.norm(u_ref)\n\n    # 3. Loop over overlap widths to compute errors\n    log_ws = []\n    log_epsilons = []\n\n    for w in ws:\n        # Define blending region\n        ell = N // 2\n        L_blend = max(1, ell - w)\n        R_blend = min(N - 1, ell + w)\n\n        # Define blending weights\n        indices = np.arange(1, N) # Physical indices 1 to N-1\n        wa_vec = np.ones(M, dtype=float)\n        \n        if L_blend < R_blend:\n            mask_blend = (indices > L_blend) & (indices < R_blend)\n            blend_indices = indices[mask_blend]\n            wa_vec[mask_blend] = (R_blend - blend_indices) / (R_blend - L_blend)\n        \n        wa_vec[indices >= R_blend] = 0.0\n        \n        W_a = np.diag(wa_vec)\n        W_c = np.eye(M) - W_a\n        \n        # Construct and solve coupled system\n        K_couple_ff = W_a @ K_a_ff + W_c @ K_c_ff\n        u_couple = np.linalg.solve(K_couple_ff, f_F)\n\n        # Calculate and store error\n        error = np.linalg.norm(u_couple - u_ref) / norm_u_ref\n        log_ws.append(np.log(w))\n        log_epsilons.append(np.log(error))\n\n    # 4. Fit convergence rate\n    # log(error) = log(C) - p * log(w)\n    # slope of log(error) vs log(w) is -p\n    slope, _, _, _, _ = linregress(log_ws, log_epsilons)\n    p_fit = -slope\n    \n    # 5. Compare with theoretical prediction\n    agreement = abs(p_fit - p_th) <= tolerance\n\n    return round(p_fit, 3), agreement\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Test Case A\n        {'N': 200, 'a': 1, 'k1': 1, 'k2': 0.25, 'f0': 1, 'f_wave_num': 1, 'ws': [2, 4, 8, 16]},\n        # Test Case B\n        {'N': 160, 'a': 1, 'k1': 1, 'k2': 0.05, 'f0': 1, 'f_wave_num': 2, 'ws': [1, 2, 4, 8]},\n        # Test Case C\n        {'N': 240, 'a': 1, 'k1': 1, 'k2': 0.5, 'f0': 1, 'f_wave_num': 1, 'ws': [4, 8, 12, 16]},\n    ]\n\n    results = []\n    for case in test_cases:\n        p, ok = solve_case(**case)\n        results.append(p)\n        results.append(ok)\n    \n    # Final print statement in the exact required format.\n    # The map(str,...) ensures booleans are correctly converted to \"True\"/\"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}