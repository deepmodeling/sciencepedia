{
    "hands_on_practices": [
        {
            "introduction": "The patch test is the most fundamental consistency check for any multiscale method, verifying that the coupled model can exactly reproduce a constant strain field without generating spurious \"ghost\" forces at the interface. This exercise challenges you to diagnose and correct a flawed force-based coupling that fails this basic test . Mastering this concept is crucial, as it highlights the absolute necessity of precise force and energy accounting at the atomistic-continuum boundary.",
            "id": "3846756",
            "problem": "Consider a one-dimensional harmonic atomic chain modeling a homogeneous crystalline solid with nearest-neighbor interactions. Atoms are indexed by integers $i \\in \\mathbb{Z}$ and occupy reference positions $X_{i} = i a$, where $a > 0$ is the lattice spacing. The deformed positions are $x_{i} = X_{i} + u_{i}$, where $u_{i}$ is the displacement. Neighbor pairs are connected by linear springs of stiffness $k > 0$, and the atomistic energy is defined by\n$$\nE_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} \\left( x_{i+1} - x_{i} - a \\right)^{2}.\n$$\nAssume a uniform macroscopic strain $ \\epsilon $ so that the displacement field is $u_{i} = \\epsilon X_{i} = \\epsilon i a$. Then the exact atomistic internal force at each atom is zero.\n\nYou wish to couple an atomistic region ($X \\leq 0$) to a continuum region ($X \\geq a$) through a handshaking region consisting of the cross-boundary interaction between atoms $i=0$ and $i=1$. In the continuum region, you model the material using the Cauchy-Born hypothesis derived from the atomistic energy. The continuum energy density per unit reference length is\n$$\nW(F) = \\frac{k a}{2} (F - 1)^{2},\n$$\nwhere $F = \\frac{d x}{d X}$ is the one-dimensional deformation gradient. The first Piola stress (which equals the Cauchy stress in one dimension) is\n$$\n\\sigma(F) = \\frac{d W}{d F} = k a (F - 1) = k a \\epsilon.\n$$\n\nIn a naive force-based coupling, the cross-boundary bond $(0,1)$ is removed from the atomistic force computation, and a continuum traction is applied to atom $i=0$ to represent the interaction with the continuum side. However, due to an incorrect handshaking formulation, the applied continuum traction is scaled by a factor $\\alpha = \\frac{1}{2}$, so that the traction used is $\\alpha \\sigma(F)$ instead of $\\sigma(F)$. The left neighbor bond $( -1, 0 )$ remains atomistic.\n\nUsing first principles, derive the resulting residual (ghost) force at atom $i=0$ under the uniform strain patch test. Then, modify the handshaking formulation by introducing a corrective multiplier $\\gamma$ that rescales the continuum traction in the handshaking region to recover patch-test consistency (i.e., zero ghost force for any uniform strain). Use the specific material parameters $a = 0.25\\,\\mathrm{nm}$ and $k = 100\\,\\mathrm{N/m}$ and assume a small uniform strain $\\epsilon = 0.01$. Express your final answer as the single value of the dimensionless corrective multiplier $\\gamma$. No rounding is required, and no units should be used for the final answer.",
            "solution": "The user wants to solve a problem in atomistic-continuum coupling for a 1D harmonic chain.\n\n### Step 1: Extract Givens\n-   **System**: One-dimensional harmonic atomic chain with nearest-neighbor interactions.\n-   **Reference Positions**: $X_i = i a$ for atoms indexed by $i \\in \\mathbb{Z}$, with lattice spacing $a > 0$.\n-   **Deformed Positions**: $x_i = X_i + u_i$, where $u_i$ is the displacement.\n-   **Atomistic Energy**: $E_{\\mathrm{atom}}(x) = \\frac{k}{2} \\sum_{i \\in \\mathbb{Z}} ( x_{i+1} - x_{i} - a )^{2}$, with spring stiffness $k > 0$.\n-   **Test Condition**: Uniform macroscopic strain $\\epsilon$, leading to displacements $u_i = \\epsilon X_i = \\epsilon i a$.\n-   **Coupling Regions**: Atomistic for $X \\leq 0$ (i.e., $i \\leq 0$), continuum for $X \\geq a$ (i.e., $i \\geq 1$).\n-   **Handshaking**: The interaction across the boundary between atom $i=0$ and atom $i=1$.\n-   **Continuum Model**: Derived from the Cauchy-Born hypothesis.\n-   **Continuum Energy Density**: $W(F) = \\frac{ka}{2} (F-1)^2$, where $F = \\frac{dx}{dX}$ is the deformation gradient.\n-   **Continuum Stress**: $\\sigma(F) = \\frac{dW}{dF} = ka(F-1) = ka\\epsilon$.\n-   **Incorrect Coupling Formulation**:\n    -   The bond $(0,1)$ is removed from the atomistic force sum.\n    -   A traction force is applied to atom $i=0$.\n    -   The magnitude of this applied traction is $\\alpha \\sigma(F)$, with $\\alpha = \\frac{1}{2}$.\n-   **Objective**:\n    1.  Derive the residual (ghost) force at atom $i=0$.\n    2.  Find a corrective multiplier $\\gamma$ that rescales the applied continuum traction to ensure zero ghost force (patch-test consistency).\n-   **Given Parameters**: $a = 0.25\\,\\mathrm{nm}$, $k = 100\\,\\mathrm{N/m}$, $\\epsilon = 0.01$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It describes a standard \"patch test\" analysis, which is a fundamental consistency check for multiscale methods. The 1D harmonic chain is a canonical model system for this purpose. The mathematical definitions of energy, force, Cauchy-Born stress, and the coupling scheme are standard, clear, and consistent. The problem is self-contained and provides all necessary information to derive the dimensionless multiplier $\\gamma$. The numerical parameters provided are physically plausible and, as will be shown, their specific values are not required for the derivation of $\\gamma$, which tests the fundamental understanding of the concept. The problem is valid.\n\n### Step 3: Derivation and Solution\nThe problem requires satisfying the \"patch test,\" a necessary condition for the convergence of a multiscale method. The patch test verifies that for any uniform strain field, the coupled atomistic-continuum model reproduces the exact analytical solution. In this case, the exact solution is that all atoms are in equilibrium, meaning the net force on every atom is zero.\n\nThe net force on an atom $i$ in the full atomistic model is given by $f_i = -\\frac{\\partial E_{\\mathrm{atom}}}{\\partial x_i}$. From the provided energy expression, this becomes:\n$$\nf_i = -\\frac{\\partial}{\\partial x_i} \\left[ \\frac{k}{2}(x_i - x_{i-1} - a)^2 + \\frac{k}{2}(x_{i+1} - x_i - a)^2 \\right] = k(x_{i+1} - 2x_i + x_{i-1})\n$$\nUnder a uniform strain $\\epsilon$, the deformed positions are $x_i = ia(1+\\epsilon)$. Substituting this into the force expression:\n$$\nf_i = k \\left[ (i+1)a(1+\\epsilon) - 2ia(1+\\epsilon) + (i-1)a(1+\\epsilon) \\right] = k a(1+\\epsilon) [ (i+1) - 2i + (i-1) ] = 0\n$$\nThis confirms that in the full atomistic model, the net force on every atom is zero, as stated in the problem.\n\nNow, we analyze the hybrid model. The focus is on atom $i=0$, which sits at the interface. Its left neighbor, atom $i=-1$, is treated atomistically, while its interaction with the right side is replaced by a continuum traction. The net force on atom $i=0$ in the hybrid model, $f_0^{\\mathrm{hyb}}$, is the sum of the force from the left bond $(-1,0)$ and the applied traction force from the right side.\n$$\nf_0^{\\mathrm{hyb}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}}\n$$\nThe force on atom $0$ from atom $-1$ is derived from the potential term involving the bond $(-1,0)$:\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -\\frac{\\partial}{\\partial x_0} \\left[ \\frac{k}{2}(x_0 - x_{-1} - a)^2 \\right] = -k(x_0 - x_{-1} - a)\n$$\nSubstituting the positions under uniform strain, $x_0 = 0$ and $x_{-1} = -a(1+\\epsilon)$, we get:\n$$\nf_{0 \\leftarrow -1}^{\\mathrm{atom}} = -k(0 - [-a(1+\\epsilon)] - a) = -k(a + a\\epsilon - a) = -ka\\epsilon\n$$\nThe problem states that due to an incorrect formulation, the applied traction force is $f^{\\mathrm{traction}} = \\alpha \\sigma(F)$, where $\\alpha = \\frac{1}{2}$ and $\\sigma(F) = ka\\epsilon$.\n$$\nf^{\\mathrm{traction}} = \\frac{1}{2} ka\\epsilon\n$$\nThe resulting net force on atom $0$, which is the residual or \"ghost\" force, is:\n$$\nf_0^{\\mathrm{ghost}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{traction}} = -ka\\epsilon + \\frac{1}{2} ka\\epsilon = -\\frac{1}{2} ka\\epsilon\n$$\nThis is the ghost force under the flawed coupling scheme.\n\nTo restore patch-test consistency, we must modify the scheme so that the net force on atom $0$ is zero. This is achieved by introducing a corrective multiplier $\\gamma$ that rescales the incorrectly formulated traction. The corrected traction is:\n$$\nf^{\\mathrm{corrected}} = \\gamma f^{\\mathrm{traction}} = \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right)\n$$\nThe condition for patch-test consistency is that the new total force on atom $0$ must be zero:\n$$\nf_0^{\\mathrm{new}} = f_{0 \\leftarrow -1}^{\\mathrm{atom}} + f^{\\mathrm{corrected}} = 0\n$$\nSubstituting the expressions for the forces:\n$$\n-ka\\epsilon + \\gamma \\left( \\frac{1}{2} ka\\epsilon \\right) = 0\n$$\nFor the patch test to be valid for any uniform strain $\\epsilon \\neq 0$, and given that $k>0$ and $a>0$, we can divide the entire equation by $ka\\epsilon$:\n$$\n-1 + \\frac{\\gamma}{2} = 0\n$$\nSolving for the dimensionless multiplier $\\gamma$:\n$$\n\\frac{\\gamma}{2} = 1 \\implies \\gamma = 2\n$$\nThe value of $\\gamma$ is independent of the specific material parameters $a$ and $k$, and the strain $\\epsilon$. Therefore, the given numerical values are not needed for the final answer. The corrective multiplier must be $\\gamma=2$ to cancel the initial error factor of $\\alpha=\\frac{1}{2}$ and ensure the applied traction correctly represents the force from the removed atomistic bond.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "Once a model passes the patch test, the next question is its accuracy for non-uniform deformations, which is governed by how information is passed from the coarse continuum to the fine atomistic scale. This practice involves analytically calculating the error introduced when a smooth continuum displacement field is interpolated onto discrete atomic positions . This exercise provides a quantitative understanding of how the continuum mesh size limits the resolution of short-wavelength features, a key source of error in coupled simulations.",
            "id": "3846699",
            "problem": "In a one-dimensional handshaking region used for atomisticâ€“continuum coupling, a continuum displacement field is prescribed by $u_{c}(x) = A \\sin(k x)$, where $A$ is the amplitude and $k$ is the wavenumber. The continuum subdomain is discretized by a uniform mesh with nodal spacing $h$, and atoms in the overlap (handshaking) region are assumed to lie at the midpoints of the continuum elements, i.e., at positions $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$ for each element $\\left[x_{j}, x_{j+1}\\right]$ with $x_{j+1} - x_{j} = h$. The atomistic displacement is assigned by mapping the continuum field to the atomic positions using linear finite element interpolation from the two neighboring continuum nodes, that is, $u_{a}(x_{m}) = N_{1}(x_{m}) u_{c}(x_{j}) + N_{2}(x_{m}) u_{c}(x_{j+1})$ with $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ and $N_{2}(x) = \\frac{x - x_{j}}{h}$.\n\nDefine the normalized interpolation error at midpoints by\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{\\left| u_{c}(x_{m}) - u_{a}(x_{m}) \\right|}{A}.\n$$\nStarting from first principles (the definition of the linear interpolation mapping and the trigonometric form of $u_{c}$), derive a closed-form analytic expression for $E_{\\mathrm{rel}}(h)$ as a function of $k$ and $h$. Then, by asymptotic reasoning from the same base, determine how $E_{\\mathrm{rel}}(h)$ decreases with mesh refinement in the small-mesh limit $k h \\to 0$. Provide the exact closed-form expression for $E_{\\mathrm{rel}}(h)$; no numerical evaluation is required. The answer must be dimensionless, so report the normalized error $E_{\\mathrm{rel}}(h)$ (no units).",
            "solution": "We consider the one-dimensional handshaking region in which atoms at midpoints of continuum elements inherit displacements via linear finite element interpolation. The continuum displacement is $u_{c}(x) = A \\sin(k x)$. On an element $\\left[x_{j}, x_{j+1}\\right]$ with $x_{j+1} - x_{j} = h$, the midpoint is $x_{m} = \\frac{x_{j} + x_{j+1}}{2}$. By the definition of the linear interpolation mapping with shape functions $N_{1}(x) = 1 - \\frac{x - x_{j}}{h}$ and $N_{2}(x) = \\frac{x - x_{j}}{h}$, the mapped atomistic displacement at the midpoint is\n$$\nu_{a}(x_{m}) = \\frac{1}{2} u_{c}(x_{j}) + \\frac{1}{2} u_{c}(x_{j+1}) = \\frac{A}{2} \\left[ \\sin(k x_{j}) + \\sin(k x_{j+1}) \\right].\n$$\nThe exact continuum displacement at the midpoint is\n$$\nu_{c}(x_{m}) = A \\sin\\!\\left( k \\frac{x_{j} + x_{j+1}}{2} \\right) = A \\sin\\!\\left( \\frac{k x_{j} + k x_{j+1}}{2} \\right).\n$$\nIntroduce the phase $\\varphi = k x_{j}$ and the dimensionless element phase increment $s = k h$, so $k x_{j+1} = \\varphi + s$ and $k x_{m} = \\varphi + \\frac{s}{2}$. Then\n$$\nu_{a}(x_{m}) = \\frac{A}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right], \\quad u_{c}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right).\n$$\nUsing the trigonometric identity $\\sin(\\alpha) + \\sin(\\beta) = 2 \\sin\\!\\left( \\frac{\\alpha + \\beta}{2} \\right) \\cos\\!\\left( \\frac{\\alpha - \\beta}{2} \\right)$ with $\\alpha = \\varphi$ and $\\beta = \\varphi + s$, we obtain\n$$\n\\frac{1}{2} \\left[ \\sin(\\varphi) + \\sin(\\varphi + s) \\right] = \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right).\n$$\nTherefore, the interpolation error at the midpoint of element $j$ is\n$$\ne_{j} = u_{c}(x_{m}) - u_{a}(x_{m}) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) - A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\cos\\!\\left( \\frac{s}{2} \\right) = A \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\left[ 1 - \\cos\\!\\left( \\frac{s}{2} \\right) \\right].\n$$\nNormalize by $A$ and take the supremum over all elements $j$ (equivalently, over all phases $\\varphi$), noting that $\\left| \\sin\\!\\left( \\varphi + \\frac{s}{2} \\right) \\right| \\leq 1$ with equality attainable. Thus, the worst-case normalized interpolation error at midpoints across the overlap is\n$$\nE_{\\mathrm{rel}}(h) = \\sup_{j} \\frac{|e_{j}|}{A} = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right).\n$$\nTo determine how mesh refinement reduces this error, consider the small-mesh limit $k h \\to 0$. Using the Taylor expansion $\\cos(z) = 1 - \\frac{z^{2}}{2} + \\frac{z^{4}}{24} - \\cdots$, we obtain\n$$\n1 - \\cos\\!\\left( \\frac{k h}{2} \\right) = \\frac{1}{2} \\left( \\frac{k h}{2} \\right)^{2} - \\frac{1}{24} \\left( \\frac{k h}{2} \\right)^{4} + \\cdots = \\frac{k^{2} h^{2}}{8} - \\frac{k^{4} h^{4}}{384} + \\cdots.\n$$\nTherefore, the leading-order scaling in the handshaking region under mesh refinement is quadratic in $h$: $E_{\\mathrm{rel}}(h) \\sim \\frac{k^{2} h^{2}}{8}$ as $h \\to 0$. The exact closed-form expression is $E_{\\mathrm{rel}}(h) = 1 - \\cos\\!\\left( \\frac{k h}{2} \\right)$, which monotonically decreases to zero with mesh refinement.",
            "answer": "$$\\boxed{1 - \\cos\\!\\left(\\frac{k h}{2}\\right)}$$"
        },
        {
            "introduction": "This practice bridges theory and computation by guiding you through the implementation of a complete atomistic-continuum model, moving from analytical principles to numerical validation. You will build a coupled system by blending a non-local atomistic model with its local continuum approximation and then perform a numerical study to measure how the simulation error converges as the size of the handshaking region increases . This hands-on coding experience will solidify your understanding of how to construct and validate a multiscale simulation, connecting theoretical error estimates to practical performance.",
            "id": "3846703",
            "problem": "Consider a one-dimensional harmonic chain used to model a crystalline bar, composed of $N+1$ sites with indices $i=0,1,2,\\dots,N$ and lattice spacing $a$. Let the displacement of site $i$ be $u_i$. The atomistic model includes nearest-neighbor and next-nearest-neighbor linear springs with stiffnesses $k_1$ and $k_2$, respectively. The continuum model is the Cauchy-Born approximation, which for homogeneous strain reduces to a local second-difference operator with effective stiffness $k_{\\mathrm{eff}} = k_1 + 4 k_2$ defined on the same lattice. The system is in quasi-static equilibrium under a distributed body force $f(x)$, with Dirichlet boundary conditions $u_0 = 0$ and $u_N = 0$. All quantities are nondimensionalized; the relative error reported is nondimensional.\n\nDefine the full atomistic stiffness matrix $\\mathbf{K}^{\\mathrm{a}} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ by the standard spring assembly rule: for each nearest-neighbor spring connecting $(i,i+1)$ add the $2\\times 2$ contribution $\\begin{pmatrix} k_1 & -k_1 \\\\ -k_1 & k_1 \\end{pmatrix}$ at rows and columns $(i,i+1)$; and for each next-nearest-neighbor spring connecting $(i,i+2)$ add the $2\\times 2$ contribution $\\begin{pmatrix} k_2 & -k_2 \\\\ -k_2 & k_2 \\end{pmatrix}$ at rows and columns $(i,i+2)$. Define the continuum stiffness matrix $\\mathbf{K}^{\\mathrm{c}} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ analogously using only nearest-neighbor springs of stiffness $k_{\\mathrm{eff}}$.\n\nLet the free set of indices be $\\mathcal{F} = \\{1,2,\\dots,N-1\\}$ with corresponding reduced matrices $\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}}$ and $\\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}$, and reduced body force vector $\\mathbf{f}_{\\mathcal{F}}$ with entries $f_i a$ for $i \\in \\mathcal{F}$, where $f_i = f(x_i)$ and $x_i = i a$. The atomistic reference solution $\\mathbf{u}^{\\mathrm{ref}} \\in \\mathbb{R}^{N-1}$ is the unique solution of\n$$\n\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{ref}} = \\mathbf{f}_{\\mathcal{F}}.\n$$\nNow couple the atomistic and continuum models using a handshaking overlap region centered at the chain midpoint with half-width $w$ (in number of lattice spacings). Let $\\ell = \\lfloor N/2 \\rfloor$, and define an overlap index interval $[L,R]$ in the free set by $L = \\max(1, \\ell - w)$ and $R = \\min(N-1, \\ell + w)$. Define a row-wise blending weight $w^{\\mathrm{a}}_i$ for each free index $i \\in \\mathcal{F}$ by\n$$\nw^{\\mathrm{a}}_i = \n\\begin{cases}\n1, & i \\le L, \\\\[4pt]\n\\frac{R - i}{R - L}, & L < i < R, \\\\[8pt]\n0, & i \\ge R,\n\\end{cases}\n\\quad\\text{and}\\quad\nw^{\\mathrm{c}}_i = 1 - w^{\\mathrm{a}}_i.\n$$\nIntroduce the diagonal matrices $\\mathbf{W}^{\\mathrm{a}} = \\mathrm{diag}(w^{\\mathrm{a}}_i)$ and $\\mathbf{W}^{\\mathrm{c}} = \\mathrm{diag}(w^{\\mathrm{c}}_i)$ of size $(N-1)\\times(N-1)$, and define the coupled operator by row-wise blending:\n$$\n\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} = \\mathbf{W}^{\\mathrm{a}} \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} + \\mathbf{W}^{\\mathrm{c}} \\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}.\n$$\nThe coupled solution $\\mathbf{u}^{\\mathrm{couple}}(w)$ is defined as the unique solution of\n$$\n\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{couple}}(w) = \\mathbf{f}_{\\mathcal{F}}.\n$$\nFor each overlap half-width $w$, define the relative $L^2$ displacement error\n$$\n\\varepsilon(w) = \\frac{\\left\\| \\mathbf{u}^{\\mathrm{couple}}(w) - \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}}{\\left\\| \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}},\n\\quad\\text{where}\\quad\n\\left\\| \\mathbf{v} \\right\\|_{L^2} = \\left( \\sum_{i \\in \\mathcal{F}} a\\, v_i^2 \\right)^{1/2}.\n$$\nAssume the theoretical prediction for linear blending in this setting is first-order, i.e., $\\varepsilon(w) \\approx C w^{-p}$ with $p_{\\mathrm{th}} = 1$ for sufficiently large $w$, where $C$ is independent of $w$ but depends on model parameters.\n\nYour task is to write a complete, runnable program that:\n- Constructs $\\mathbf{K}^{\\mathrm{a}}$ and $\\mathbf{K}^{\\mathrm{c}}$ as described, imposes $u_0 = 0$ and $u_N = 0$, and forms the reduced systems on $\\mathcal{F}$.\n- Computes the atomistic reference solution $\\mathbf{u}^{\\mathrm{ref}}$.\n- For each specified overlap half-width $w$, constructs the coupled operator, solves for $\\mathbf{u}^{\\mathrm{couple}}(w)$, and evaluates $\\varepsilon(w)$.\n- Fits the observed convergence rate $p$ by linear regression of $\\log \\varepsilon(w)$ versus $\\log w$ to the model $\\varepsilon(w) \\approx C w^{-p}$, returning $p$.\n- Compares the fitted $p$ to $p_{\\mathrm{th}} = 1$.\n\nUse the following test suite of parameter sets, which explores different dispersion and overlap regimes:\n- Test Case A (happy path): $N = 200$, $a = 1$, $k_1 = 1$, $k_2 = 0.25$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{\\pi x}{L} \\right)$ with $L = N a$, overlap half-widths $w \\in \\{2,4,8,16\\}$.\n- Test Case B (edge case: minimal overlap and higher frequency load): $N = 160$, $a = 1$, $k_1 = 1$, $k_2 = 0.05$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{2\\pi x}{L} \\right)$ with $L = N a$, overlap half-widths $w \\in \\{1,2,4,8\\}$.\n- Test Case C (edge case: strong nonlocality): $N = 240$, $a = 1$, $k_1 = 1$, $k_2 = 0.5$, $f_0 = 1$, $f(x) = f_0 \\sin\\left( \\dfrac{\\pi x}{L} \\right)$ with $L = N a$, overlap half-widths $w \\in \\{4,8,12,16\\}$.\n\nFor each test case, compute the fitted exponent $p$ and determine whether it agrees with the theoretical prediction within a tolerance of $0.2$, i.e., report whether $|p - p_{\\mathrm{th}}| < 0.2$.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain, in order, for Test Case A, $p$ rounded to three decimals and the agreement boolean; for Test Case B, $p$ rounded to three decimals and the agreement boolean; and for Test Case C, $p$ rounded to three decimals and the agreement boolean. For example, the output must look like\n$$\n\\left[ p_{\\mathrm{A}}, \\mathrm{ok}_{\\mathrm{A}}, p_{\\mathrm{B}}, \\mathrm{ok}_{\\mathrm{B}}, p_{\\mathrm{C}}, \\mathrm{ok}_{\\mathrm{C}} \\right],\n$$\nwhere each $p_{\\mathrm{(\\cdot)}}$ is a float and each $\\mathrm{ok}_{\\mathrm{(\\cdot)}}$ is a boolean. No other text should be printed.",
            "solution": "The problem requires a numerical investigation of an atomistic-continuum coupling scheme for a one-dimensional harmonic crystal. The analysis involves comparing the solution from a coupled model to a fully resolved atomistic reference solution and determining the convergence rate of the coupling error with respect to the size of the overlap region.\n\nFirst, we define the physical system and the mathematical models. The system is a chain of $N+1$ discrete masses at sites $i=0, 1, \\dots, N$ with lattice spacing $a$. The displacement of each mass from its equilibrium position is $u_i$. The ends of the chain are fixed, imposing Dirichlet boundary conditions $u_0 = 0$ and $u_N = 0$.\n\nThe atomistic model is based on a harmonic potential with nearest-neighbor (NN) and next-nearest-neighbor (NNN) interactions, characterized by spring stiffnesses $k_1$ and $k_2$, respectively. For a given displacement field $\\mathbf{u}$, the total potential energy is the sum of energies stored in the springs. The quasi-static equilibrium equations are derived by setting the force on each free atom (i.e., for $i \\in \\mathcal{F} = \\{1, 2, \\dots, N-1\\}$) to zero. This results in a system of linear equations:\n$$ \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{ref}} = \\mathbf{f}_{\\mathcal{F}} $$\nHere, $\\mathbf{u}^{\\mathrm{ref}}$ is the vector of displacements for the free atoms, $\\mathbf{f}_{\\mathcal{F}}$ is the corresponding nodal force vector derived from the distributed body force $f(x)$ as $(f_{\\mathcal{F}})_i = f(i a) \\cdot a$, and $\\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}}$ is the reduced atomistic stiffness matrix. The matrix $\\mathbf{K}^{\\mathrm{a}}$ is assembled by iterating through all NN and NNN springs and adding their respective stiffness contributions to the appropriate entries. For a spring of stiffness $k$ connecting sites $i$ and $j$, a block matrix $k \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$ is added to the submatrix corresponding to rows and columns $(i, j)$.\n\nThe continuum model is a local approximation based on the Cauchy-Born rule. For a 1D chain, this simplifies the NNN atomistic model to an effective NN model. The effective stiffness $k_{\\mathrm{eff}} = k_1 + 4 k_2$ ensures that the continuum model has the same strain energy density as the atomistic model under uniform strain. The continuum stiffness matrix, $\\mathbf{K}^{\\mathrm{c}}$, is constructed like $\\mathbf{K}^{\\mathrm{a}}$ but only with NN springs of stiffness $k_{\\mathrm{eff}}$. The reduced continuum matrix is $\\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}}$.\n\nThe core of the problem lies in the coupling scheme, which blends the atomistic and continuum models. An overlap region of half-width $w$ is defined around the chain's midpoint $\\ell = \\lfloor N/2 \\rfloor$. The free indices within this overlap are given by the interval $[L, R]$, where $L = \\max(1, \\ell - w)$ and $R = \\min(N-1, \\ell + w)$. A linear blending function $w^{\\mathrm{a}}_i$ is defined for each free site $i \\in \\mathcal{F}$. The weight $w^{\\mathrm{a}}_i$ is $1$ in the purely atomistic domain ($i \\le L$), $0$ in the purely continuum domain ($i \\ge R$), and transitions linearly from $1$ to $0$ for $L < i < R$. The continuum weight is $w^{\\mathrm{c}}_i = 1 - w^{\\mathrm{a}}_i$.\n\nThe coupled stiffness matrix is formed by a row-wise blending of the atomistic and continuum matrices:\n$$ \\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} = \\mathbf{W}^{\\mathrm{a}} \\mathbf{K}^{\\mathrm{a}}_{\\mathcal{F}\\mathcal{F}} + \\mathbf{W}^{\\mathrm{c}} \\mathbf{K}^{\\mathrm{c}}_{\\mathcal{F}\\mathcal{F}} $$\nwhere $\\mathbf{W}^{\\mathrm{a}}$ and $\\mathbf{W}^{\\mathrm{c}}$ are diagonal matrices holding the blending weights. The coupled solution $\\mathbf{u}^{\\mathrm{couple}}(w)$ is obtained by solving the linear system $\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}} \\mathbf{u}^{\\mathrm{couple}}(w) = \\mathbf{f}_{\\mathcal{F}}$. This blending scheme is simple but results in a non-symmetric $\\mathbf{K}^{\\mathrm{couple}}_{\\mathcal{F}\\mathcal{F}}$, which is a known source of numerical artifacts called \"ghost forces\", though the system remains solvable.\n\nTo evaluate the coupling scheme's accuracy, we compute the relative $L^2$ error $\\varepsilon(w)$ as a function of the overlap half-width $w$:\n$$ \\varepsilon(w) = \\frac{\\left\\| \\mathbf{u}^{\\mathrm{couple}}(w) - \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}}{\\left\\| \\mathbf{u}^{\\mathrm{ref}} \\right\\|_{L^2}} $$\nThe problem defines $\\left\\| \\mathbf{v} \\right\\|_{L^2} = (\\sum_{i \\in \\mathcal{F}} a\\, v_i^2)^{1/2}$. In the ratio for $\\varepsilon(w)$, the scaling factor $\\sqrt{a}$ cancels, so the calculation can be performed using standard Euclidean vector norms.\n\nThe theoretical convergence of the error is given by $\\varepsilon(w) \\approx C w^{-p}$, with an expected rate of $p_{\\mathrm{th}} = 1$. To numerically determine the observed rate $p$, we take the logarithm of this relation, which yields a linear equation: $\\log \\varepsilon(w) = \\log C - p \\log w$. This shows that a plot of $\\log \\varepsilon(w)$ versus $\\log w$ should be a straight line with slope $-p$. We will compute $(\\log w, \\log \\varepsilon(w))$ pairs for the specified values of $w$ in each test case and perform a linear regression to find the slope, from which we extract $p$.\n\nThe implementation will carry out this entire procedure for three distinct test cases. Key steps include: constructing the stiffness matrices, solving the linear systems for the reference and coupled solutions using `numpy.linalg.solve`, calculating the error for each $w$, and finally using `scipy.stats.linregress` to fit the convergence rate $p$. The fitted $p$ is then compared against the theoretical value $p_{\\mathrm{th}}=1$ to check for agreement within a tolerance of $0.2$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef assemble_stiffness_matrix(N, k1, k2):\n    \"\"\"\n    Assembles the full (N+1)x(N+1) stiffness matrix for a 1D chain.\n\n    Args:\n        N (int): Number of intervals in the chain (total N+1 sites).\n        k1 (float): Nearest-neighbor spring stiffness.\n        k2 (float): Next-nearest-neighbor spring stiffness.\n\n    Returns:\n        np.ndarray: The (N+1)x(N+1) stiffness matrix.\n    \"\"\"\n    size = N + 1\n    K = np.zeros((size, size))\n\n    # Add nearest-neighbor contributions\n    if k1 != 0:\n        for i in range(N):\n            K[i, i] += k1\n            K[i+1, i+1] += k1\n            K[i, i+1] -= k1\n            K[i+1, i] -= k1\n\n    # Add next-nearest-neighbor contributions\n    if k2 != 0:\n        for i in range(N - 1):\n            K[i, i] += k2\n            K[i+2, i+2] += k2\n            K[i, i+2] -= k2\n            K[i+2, i] -= k2\n    \n    return K\n\ndef solve_case(N, a, k1, k2, f0, f_wave_num, ws):\n    \"\"\"\n    Solves a single test case for the atomistic-continuum coupling problem.\n\n    Args:\n        N (int): Number of intervals.\n        a (float): Lattice spacing.\n        k1 (float): Nearest-neighbor stiffness.\n        k2 (float): Next-nearest-neighbor stiffness.\n        f0 (float): Amplitude of the body force.\n        f_wave_num (int): Wavenumber multiple for the sinusoidal force.\n        ws (list of int): List of overlap half-widths to test.\n\n    Returns:\n        tuple: A tuple containing the fitted convergence rate p (float) and\n               the agreement boolean (bool).\n    \"\"\"\n    # System size for free DOFs\n    M = N - 1\n    p_th = 1.0\n    tolerance = 0.2\n\n    # Define grid and body force for free DOFs\n    x_free = a * np.arange(1, N)\n    L_domain = N * a\n    f_func = lambda x: f0 * np.sin(f_wave_num * np.pi * x / L_domain)\n    f_F = a * f_func(x_free)\n\n    # 1. Construct stiffness matrices and get reduced versions\n    K_a_full = assemble_stiffness_matrix(N, k1, k2)\n    \n    k_eff = k1 + 4 * k2\n    K_c_full = assemble_stiffness_matrix(N, k_eff, 0.0)\n\n    K_a_ff = K_a_full[1:N, 1:N]\n    K_c_ff = K_c_full[1:N, 1:N]\n\n    # 2. Compute reference solution\n    u_ref = np.linalg.solve(K_a_ff, f_F)\n    norm_u_ref = np.linalg.norm(u_ref)\n\n    # 3. Loop over overlap widths to compute errors\n    log_ws = []\n    log_epsilons = []\n\n    for w in ws:\n        # Define blending region\n        ell = N // 2\n        L_blend = max(1, ell - w)\n        R_blend = min(N - 1, ell + w)\n\n        # Define blending weights\n        indices = np.arange(1, N) # Physical indices 1 to N-1\n        wa_vec = np.ones(M, dtype=float)\n        \n        if L_blend < R_blend:\n            mask_blend = (indices > L_blend) & (indices < R_blend)\n            blend_indices = indices[mask_blend]\n            wa_vec[mask_blend] = (R_blend - blend_indices) / (R_blend - L_blend)\n        \n        wa_vec[indices >= R_blend] = 0.0\n        \n        W_a = np.diag(wa_vec)\n        W_c = np.eye(M) - W_a\n        \n        # Construct and solve coupled system\n        K_couple_ff = W_a @ K_a_ff + W_c @ K_c_ff\n        u_couple = np.linalg.solve(K_couple_ff, f_F)\n\n        # Calculate and store error\n        error = np.linalg.norm(u_couple - u_ref) / norm_u_ref\n        log_ws.append(np.log(w))\n        log_epsilons.append(np.log(error))\n\n    # 4. Fit convergence rate\n    # log(error) = log(C) - p * log(w)\n    # slope of log(error) vs log(w) is -p\n    slope, _, _, _, _ = linregress(log_ws, log_epsilons)\n    p_fit = -slope\n    \n    # 5. Compare with theoretical prediction\n    agreement = abs(p_fit - p_th) < tolerance\n\n    return round(p_fit, 3), agreement\n\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Test Case A\n        {'N': 200, 'a': 1, 'k1': 1, 'k2': 0.25, 'f0': 1, 'f_wave_num': 1, 'ws': [2, 4, 8, 16]},\n        # Test Case B\n        {'N': 160, 'a': 1, 'k1': 1, 'k2': 0.05, 'f0': 1, 'f_wave_num': 2, 'ws': [1, 2, 4, 8]},\n        # Test Case C\n        {'N': 240, 'a': 1, 'k1': 1, 'k2': 0.5, 'f0': 1, 'f_wave_num': 1, 'ws': [4, 8, 12, 16]},\n    ]\n\n    results = []\n    for case in test_cases:\n        p, ok = solve_case(**case)\n        results.append(p)\n        results.append(ok)\n    \n    # Final print statement in the exact required format.\n    # The map(str,...) ensures booleans are correctly converted to \"True\"/\"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}