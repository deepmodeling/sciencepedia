{
    "hands_on_practices": [
        {
            "introduction": "格子玻尔兹曼方法（Lattice Boltzmann Method, LBM）的一个关键挑战在于如何设置介观弛豫时间 $\\tau$ 以再现所需的宏观流体属性，例如通过雷诺数 $Re$ 所表征的粘度。本练习将引导你完成这一基本映射过程，从而连接仿真参数与物理现实。这是任何LBM实践者都必须掌握的基础技能。",
            "id": "3824269",
            "problem": "考虑在二维九速 (D2Q9) 晶格上，使用等温、单松弛时间的 Bhatnagar–Gross–Krook 晶格玻尔兹曼方法 (BGK-LBM) 来模拟高度为 $L_{\\mathrm{phys}}$ 的直微通道中的稳态层流。晶格声速为 $c_{s}$，晶格速度为 $c$，松弛时间为 $\\tau$。假设标准 D2Q9 关系式为 $c_{s}^{2} = c^{2}/3$，其中 $c = \\delta x / \\delta t$，$\\delta x$ 为晶格间距，$\\delta t$ 为物理时间步长。在等温条件下，从 BGK-LBM 模型中得到的流体运动粘度 $\\nu$ 通过下式与 $\\tau$ 相关：\n$$\n\\nu = c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right) \\delta t.\n$$\n您希望匹配一个由常规连续介质关系定义的目标雷诺数 $\\mathrm{Re}$：\n$$\n\\mathrm{Re} = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\nu},\n$$\n其中 $U_{\\mathrm{phys}}$ 是特征物理速度，$L_{\\mathrm{phys}}$ 是特征物理长度（取通道高度为特征长度）。为了控制压缩性误差，您选择物理时间步长 $\\delta t$ 以使得无量纲晶格速度\n$$\nU_{\\mathrm{latt}} = \\frac{U_{\\mathrm{phys}} \\, \\delta t}{\\delta x}\n$$\n等于 $0.05$。通道高度被离散为 $N_{x}$ 个格点，因此 $\\delta x = L_{\\mathrm{phys}} / N_{x}$。\n\n从上述定义和关系式出发，推导一个用 $U_{\\mathrm{latt}}$、$L_{\\mathrm{phys}}$、$\\delta x$ 和 $\\mathrm{Re}$ 表示的 $\\tau$ 的表达式。然后，根据以下数值\n$$\nL_{\\mathrm{phys}} = 1.0 \\times 10^{-3} \\ \\mathrm{m}, \\quad U_{\\mathrm{phys}} = 1.0 \\ \\mathrm{m/s}, \\quad N_{x} = 256, \\quad \\mathrm{Re} = 120, \\quad U_{\\mathrm{latt}} = 0.05,\n$$\n计算 $\\tau$ 的值。将您的最终答案表示为一个无量纲数，并四舍五入到四位有效数字。",
            "solution": "本题要求推导 BGK-LBM 模拟中单松弛时间参数 $\\tau$ 的表达式，并针对一个特定案例计算其数值。验证过程确认了该问题在科学上是合理的、提法得当，并且包含了所有必要且一致的信息。\n\n首先，我们从建立宏观流体性质与介观模拟参数之间的联系开始。目标宏观系统由雷诺数 $\\mathrm{Re}$ 定义：\n$$\n\\mathrm{Re} = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\nu}\n$$\n其中 $U_{\\mathrm{phys}}$ 是特征物理速度，$L_{\\mathrm{phys}}$ 是特征物理长度（通道高度），$\\nu$ 是流体的运动粘度。我们可以从这个连续介质关系式中将运动粘度表示为：\n$$\n\\nu = \\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\mathrm{Re}}\n$$\n这是模拟必须再现的粘度值。\n\n接下来，我们使用从 BGK-LBM 模型中得到的运动粘度表达式。对于 D2Q9 晶格，该表达式由下式给出：\n$$\n\\nu = c_{s}^{2} \\left(\\tau - \\frac{1}{2}\\right) \\delta t\n$$\n其中 $c_{s}$ 是晶格声速，$\\tau$ 是松弛时间，$\\delta t$ 是物理时间步长。题目指明了 D2Q9 晶格的标准关系式：$c_{s}^{2} = c^{2}/3$ 和 $c = \\delta x / \\delta t$，其中 $c$ 是晶格速度，$\\delta x$ 是晶格间距。\n\n将这些关系式代入 $\\nu$ 的表达式中：\n$$\n\\nu = \\frac{c^2}{3} \\left(\\tau - \\frac{1}{2}\\right) \\delta t = \\frac{1}{3} \\left(\\frac{\\delta x}{\\delta t}\\right)^2 \\left(\\tau - \\frac{1}{2}\\right) \\delta t\n$$\n化简此表达式，得到以晶格参数表示的介观粘度：\n$$\n\\nu = \\frac{(\\delta x)^2}{3 \\delta t} \\left(\\tau - \\frac{1}{2}\\right)\n$$\n为确保模拟与目标物理系统相匹配，我们将运动粘度的宏观表达式与介观表达式相等：\n$$\n\\frac{U_{\\mathrm{phys}} L_{\\mathrm{phys}}}{\\mathrm{Re}} = \\frac{(\\delta x)^2}{3 \\delta t} \\left(\\tau - \\frac{1}{2}\\right)\n$$\n我们的目标是推导 $\\tau$ 的表达式。我们重排该方程，以求解含有 $\\tau$ 的项：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 U_{\\mathrm{phys}} L_{\\mathrm{phys}} \\delta t}{\\mathrm{Re} (\\delta x)^2}\n$$\n题目陈述为无量纲晶格速度 $U_{\\mathrm{latt}}$ 提供了定义，$U_{\\mathrm{latt}} = \\frac{U_{\\mathrm{phys}} \\delta t}{\\delta x}$。我们可以使用此定义来简化表达式。对右侧进行因式分解，我们得到：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 L_{\\mathrm{phys}}}{\\delta x} \\left(\\frac{U_{\\mathrm{phys}} \\delta t}{\\delta x}\\right) \\frac{1}{\\mathrm{Re}}\n$$\n代入 $U_{\\mathrm{latt}}$ 可得：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 L_{\\mathrm{phys}}}{\\delta x} \\frac{U_{\\mathrm{latt}}}{\\mathrm{Re}}\n$$\n此外，题目说明通道高度 $L_{\\mathrm{phys}}$ 被离散为 $N_{x}$ 个晶格点，这意味着 $L_{\\mathrm{phys}} = N_{x} \\delta x$，或等价地，$N_{x} = L_{\\mathrm{phys}} / \\delta x$。将此代入方程：\n$$\n\\tau - \\frac{1}{2} = \\frac{3 N_{x} U_{\\mathrm{latt}}}{\\mathrm{Re}}\n$$\n最后，解出 $\\tau$，我们得到所需的表达式：\n$$\n\\tau = \\frac{3 N_{x} U_{\\mathrm{latt}}}{\\mathrm{Re}} + \\frac{1}{2}\n$$\n此表达式将 LBM 松弛时间 $\\tau$ 与无量纲数 $N_x$、$U_{\\mathrm{latt}}$ 和 $\\mathrm{Re}$ 相关联。任务的第一部分到此完成。\n\n对于第二部分，我们使用给定的数据计算 $\\tau$ 的数值：\n$N_{x} = 256$\n$U_{\\mathrm{latt}} = 0.05$\n$\\mathrm{Re} = 120$\n\n将这些值代入推导出的 $\\tau$ 公式中：\n$$\n\\tau = \\frac{3 \\times 256 \\times 0.05}{120} + \\frac{1}{2}\n$$\n我们首先计算分数部分的值：\n$$\n\\frac{3 \\times 256 \\times 0.05}{120} = \\frac{768 \\times 0.05}{120} = \\frac{38.4}{120} = 0.32\n$$\n现在，我们加上剩下的项：\n$$\n\\tau = 0.32 + 0.5 = 0.82\n$$\n题目要求答案四舍五入到四位有效数字。因此，我们将结果表示为：\n$$\n\\tau = 0.8200\n$$\n该值为无量纲数，符合要求。它也满足 BGK 模型的稳定性条件 $\\tau > 0.5$。",
            "answer": "$$\n\\boxed{0.8200}\n$$"
        },
        {
            "introduction": "与LBM类似，耗散粒子动力学（Dissipative Particle Dynamics, DPD）也需要精细的参数化来模拟真实流体。本练习将进行更深入的探讨，展示如何从维里定理（virial theorem）和格林-久保公式（Green-Kubo formulas）等基本热力学与输运关系中推导出DPD相互作用参数（$a$、$\\gamma$ 和 $\\sigma$）。这项实践阐明了如何系统地构建粗粒化模型以表征特定的物理系统。",
            "id": "3824322",
            "problem": "考虑一个通过耗散粒子动力学 (DPD) 建模的粗粒化流体，其中粒子通过三个成对的相互作用项进行相互作用：保守力、耗散力和随机力。在三维空间中进行计算，使用 DPD 约化单位，其中粒子质量为 $m=1$，截断距离为 $r_c$（每个案例中会明确提供），并且长度、能量和时间与 $r_c$、$m$ 和热能 $k_B T$ 一致地进行无量纲化。假设流体是均匀、各向同性的，其数密度为 $\\rho$，并且在 $0 \\le r \\le r_c$ 范围内对径向分布函数为 $g(r)=1$。\n\n您必须将 DPD 模型参数——保守力振幅 $a$、耗散系数 $\\gamma$ 和随机力振幅 $\\sigma$——进行映射，以匹配指定的目标热力学和输运性质：目标热能 $k_B T$、目标等温压缩率 $\\kappa_T$ 和目标剪切粘度 $\\eta$。该映射必须从第一性原理推导得出，并实现为一个可运行的程序，该程序能为一小组测试套件输出计算得到的 $a$、$\\gamma$ 和 $\\sigma$。\n\n您的推导和算法必须基于以下基本定律和核心定义，不得引入任何简化公式：\n- 基于成对力和径向分布 $g(r)$ 的状态方程的维里表达式。\n- 基于恒定温度下状态方程的等温压缩率 $\\kappa_T$ 的定义。\n- 作为平衡剪切应力自相关函数时间积分的剪切粘度 Green–Kubo 关系。\n- 在温度 $T$ 下，将 DPD 中的随机力和耗散力振幅联系起来的涨落-耗散关系。\n\n使用以下 DPD 相互作用结构：\n- 保守力权重函数 $w_C(r)$ 在 $0 \\le r \\le r_c$ 时满足 $w_C(r)=1-r/r_c$，在 $rr_c$ 时满足 $w_C(r)=0$，保守力与 $a\\,w_C(r)$ 成正比，并沿着粒子对的连线方向作用。\n- 耗散力权重函数 $w_D(r)$ 在 $0 \\le r \\le r_c$ 时满足 $w_D(r)=1-r/r_c$，在 $rr_c$ 时满足 $w_D(r)=0$，耗散力与 $\\gamma\\,w_D^2(r)$ 乘以粒子对相对速度在粒子对轴线上的投影成正比。\n- 随机力振幅 $\\sigma$ 必须满足在温度 $T$ 下 DPD 的涨落-耗散约束。\n\n假设 $g(r)=1$ 并且在这些参数范围内，耗散贡献在 Green–Kubo 评估中主导剪切粘度。在这些假设下：\n1. 使用维里表达式为指定的权重函数获得压力状态方程 $p(\\rho, T, a)$。\n2. 使用等温压缩率 $\\kappa_T$ 的定义，求解在给定 $\\rho$ 和 $T$ 下实现目标 $\\kappa_T$ 的保守力振幅 $a$。\n3. 使用专门针对耗散应力贡献的 Green–Kubo 关系，获得剪切粘度 $\\eta(\\rho, \\gamma)$，并求解在给定 $\\rho$ 下实现目标 $\\eta$ 的耗散系数 $\\gamma$。\n4. 使用涨落-耗散关系从 $\\gamma$ 和 $T$ 计算 $\\sigma$。\n\n所有答案必须使用与给定的 $r_c$ 值、单位质量 $m=1$ 和指定的 $k_B T$ 一致的 DPD 约化单位表示；不需要进行物理单位转换。此问题不涉及角度。不涉及百分比。\n\n实现一个程序，对于下面列出的每个测试案例，计算并返回三元组 $[a,\\gamma,\\sigma]$ 作为浮点数。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试案例结果本身也表示为一个用方括号括起来的逗号分隔三元组。例如：\"[[a_1,\\gamma_1,\\sigma_1],[a_2,\\gamma_2,\\sigma_2],...]\"。使用测试套件中给出的确切参数值。\n\n测试套件（所有量均为 DPD 约化单位）：\n- 案例 1（正常路径）：$r_c=1.0$, $\\rho=3.0$, $k_B T=1.0$, $\\kappa_T=0.2$, $\\eta=0.5$。\n- 案例 2（边界条件，理想气体压缩率）：$r_c=1.0$, $\\rho=3.0$, $k_B T=1.0$, $\\kappa_T = 1/(\\rho\\,k_B T)$, $\\eta=0.1$。\n- 案例 3（更高的密度和温度，更小的截断距离）：$r_c=0.9$, $\\rho=4.0$, $k_B T=1.2$, $\\kappa_T=0.15$, $\\eta=1.2$。\n- 案例 4（更低的密度和温度，更大的截断距离）：$r_c=1.1$, $\\rho=2.5$, $k_B T=0.8$, $\\kappa_T=0.25$, $\\eta=0.2$。\n\n您的程序必须为每个案例计算 $a$、$\\gamma$ 和 $\\sigma$，然后以确切要求的格式打印单行结果：\"[[a_1,\\gamma_1,\\sigma_1],[a_2,\\gamma_2,\\sigma_2],[a_3,\\gamma_3,\\sigma_3],[a_4,\\gamma_4,\\sigma_4]]\"。结果必须是浮点数。",
            "solution": "将耗散粒子动力学 (DPD) 模型的微观参数映射到宏观流体性质是介观模拟中的一项基础任务。其目标是确定保守力振幅 $a$、耗散系数 $\\gamma$ 和随机力振幅 $\\sigma$，以再现给定数密度 $\\rho$ 的流体的目标热能 $k_B T$、等温压缩率 $\\kappa_T$ 和剪切粘度 $\\eta$。推导将按照指定要求从第一性原理出发，在所提供的建模假设下，利用维里定理、压缩率的定义、粘度的 Green-Kubo 关系和涨落-耗散定理进行。所有计算都在一套一致的 DPD 约化单位中进行，其中粒子质量 $m=1$，截断距离为 $r_c$。\n\n推导过程分为三个不同步骤，依次确定 $a$、$\\gamma$ 和 $\\sigma$。\n\n**步骤 1：保守力参数 $a$ 的推导**\n\n保守参数 $a$ 决定了平衡结构和热力学性质，如状态方程。我们从目标等温压缩率 $\\kappa_T$ 推导其值。\n\n对于一个通过成对力相互作用的粒子系统，其压力 $p$ 由维里定理给出。在三维空间中，它是理想气体（动能）贡献和超额（相互作用）贡献之和：\n$$ p = \\rho k_B T + p_{ex} $$\n超额压力 $p_{ex}$ 源于粒子间的相互作用力。对于中心力系统，它可以写成一个积分表达式：\n$$ p_{ex} = \\frac{\\rho^2}{6} \\int_V \\mathbf{r} \\cdot \\mathbf{F}^C(\\mathbf{r}) g(r) \\, d\\mathbf{r} = \\frac{\\rho^2}{6} \\int_0^{r_c} r F^C(r) g(r) 4\\pi r^2 \\, dr $$\n其中 $g(r)$ 是径向分布函数。问题假设 $g(r)=1$，保守力为 $F^C(r) = a\\,w_C(r) = a(1-r/r_c)$。代入这些条件：\n$$ p_{ex} = \\frac{2\\pi \\rho^2 a}{3} \\int_0^{r_c} r \\left(1 - \\frac{r}{r_c}\\right) r^2 \\, dr = \\frac{2\\pi \\rho^2 a}{3} \\int_0^{r_c} (r^3 - \\frac{r^4}{r_c}) \\, dr $$\n计算积分：\n$$ p_{ex} = \\frac{2\\pi \\rho^2 a}{3} \\left[ \\frac{r^4}{4} - \\frac{r^5}{5r_c} \\right]_0^{r_c} = \\frac{2\\pi \\rho^2 a}{3} \\left( \\frac{r_c^4}{4} - \\frac{r_c^4}{5} \\right) = \\frac{2\\pi \\rho^2 a}{3} \\left( \\frac{r_c^4}{20} \\right) = \\frac{\\pi \\rho^2 a r_c^4}{30} $$\n因此，状态方程为 $p(\\rho, T, a) = \\rho k_B T + \\frac{\\pi \\rho^2 a r_c^4}{30}$。\n\n等温压缩率的定义为 $\\kappa_T = \\frac{1}{\\rho} \\left(\\frac{\\partial \\rho}{\\partial p}\\right)_T$，但使用其倒数 $\\kappa_T^{-1} = \\rho \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_T$ 更为方便。对压力表达式求导：\n$$ \\left(\\frac{\\partial p}{\\partial \\rho}\\right)_T = k_B T + \\frac{2\\pi \\rho a r_c^4}{30} = k_B T + \\frac{\\pi \\rho a r_c^4}{15} $$\n因此，压缩率的倒数为：\n$$ \\kappa_T^{-1} = \\rho k_B T + \\frac{\\pi \\rho^2 a r_c^4}{15} $$\n从这个方程中解出 $a$：\n$$ a = \\left( \\frac{1}{\\kappa_T} - \\rho k_B T \\right) \\frac{15}{\\pi \\rho^2 r_c^4} $$\n\n**步骤 2：耗散系数 $\\gamma$ 的推导**\n\n耗散系数 $\\gamma$ 控制着流体的输运性质，特别是剪切粘度 $\\eta$。问题假设粘度主要由耗散力贡献主导。对于具有指定相互作用（耗散力与 $\\gamma w_D^2(r)$ 成正比，其中 $w_D(r) = 1-r/r_c$）的 DPD 流体，其剪切粘度的解析表达式可以通过 Green-Kubo 关系推导得出。根据标准文献（如 Groot and Warren, 1997），在这些假设下，粘度的耗散部分近似为：\n$$ \\eta \\approx \\frac{2\\pi \\rho^2 \\gamma r_c^5}{1575} $$\n这个公式是基于对耗散应力自相关函数的积分，并假设了特定的权重函数形式，与问题描述一致。从这个关系中，我们可以直接解出 $\\gamma$：\n$$ \\gamma = \\frac{1575 \\, \\eta}{2\\pi \\rho^2 r_c^5} $$\n\n**步骤 3：随机力振幅 $\\sigma$ 的推导**\n\n随机力振幅 $\\sigma$ 不是一个独立的参数，而是由涨落-耗散定理（Fluctuation-Dissipation Theorem, FDT）决定的。该定理确保耗散力引入的能量耗散与随机力注入的能量相平衡，从而使系统能够维持在恒定的温度 $T$。对于 DPD，该定理给出了耗散系数和随机力振幅之间的简单关系：\n$$ \\sigma^2 = 2 \\gamma k_B T $$\n因此，$\\sigma$ 可以由已求出的 $\\gamma$ 和给定的 $k_B T$ 计算得出：\n$$ \\sigma = \\sqrt{2 \\gamma k_B T} $$\n这完成了从宏观目标性质到微观 DPD 参数的映射。该逻辑被实现在提供的 Python 代码中，用于计算每个测试案例的 $[a, \\gamma, \\sigma]$ 三元组。",
            "answer": "```python\n# The complete and runnable Python 3 code for solving the DPD parameterization problem.\n# This code adheres to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes DPD parameters (a, gamma, sigma) from target macroscopic properties\n    (compressibility, viscosity, temperature) based on first-principles derivations.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (r_c, rho, k_B*T, kappa_T, eta)\n    test_cases = [\n        (1.0, 3.0, 1.0, 0.2, 0.5),\n        (1.0, 3.0, 1.0, 1.0 / (3.0 * 1.0), 0.1),\n        (0.9, 4.0, 1.2, 0.15, 1.2),\n        (1.1, 2.5, 0.8, 0.25, 0.2),\n    ]\n\n    results = []\n    for case in test_cases:\n        rc, rho, kBT, kappa_T, eta = case\n\n        # Step 1: Calculate the conservative force amplitude 'a' from isothermal compressibility.\n        # Formula: a = (15 / (pi * rho^2 * rc^4)) * (1/kappa_T - rho * kBT)\n        a_numerator = 15.0 * (1.0 / kappa_T - rho * kBT)\n        a_denominator = np.pi * rho**2 * rc**4\n        # Handle the case where the denominator might be zero, although unlikely with given inputs.\n        a = a_numerator / a_denominator if a_denominator != 0 else 0.0\n\n        # Step 2: Calculate the dissipative coefficient 'gamma' from shear viscosity.\n        # Formula: gamma = (1575 * eta) / (2 * pi * rho^2 * rc^5)\n        gamma_numerator = 1575.0 * eta\n        gamma_denominator = 2.0 * np.pi * rho**2 * rc**5\n        gamma = gamma_numerator / gamma_denominator if gamma_denominator != 0 else 0.0\n        \n        # Step 3: Calculate the random force amplitude 'sigma' using the fluctuation-dissipation theorem.\n        # Formula: sigma = sqrt(2 * gamma * kBT)\n        # Ensure the argument to sqrt is non-negative.\n        sigma_arg = 2.0 * gamma * kBT\n        sigma = np.sqrt(sigma_arg) if sigma_arg >= 0 else 0.0\n\n        # Format the result for this test case as a string \"[a,gamma,sigma]\".\n        results.append(f\"[{a},{gamma},{sigma}]\")\n\n    # Final print statement in the exact required format: \"[[...],[...],...]\".\n    # The `join` method concatenates the list of formatted strings.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the main function.\nsolve()\n```"
        },
        {
            "introduction": "除了建立模型，计算科学中的一项关键技能是验证其正确性并理解其精度。本练习聚焦于光滑粒子流体动力学（Smoothed Particle Hydrodynamics, SPH），引导你完成一次数值收敛性研究。通过实现不同的光滑核函数并测量近似误差，你将凭经验确定该方法的精度阶数，这是验证数值代码的标准程序。",
            "id": "3824285",
            "problem": "考虑一维周期性域 $[0,1]$ 和一个光滑的周期性测试函数 $f(x) = \\sin(2\\pi x) + \\tfrac{1}{2}\\sin(6\\pi x)$，其中角度应以弧度解释。光滑粒子流体动力学 (SPH) 通过核函数加权的粒子求和来近似一个函数。对于具有 $N$ 个粒子的均匀粒子分布，粒子位置为 $x_j = \\tfrac{j}{N}$，间距为 $\\Delta x = \\tfrac{1}{N}$，两点之间的周期性距离定义为 $d(x,y) = \\min(|x-y|, 1 - |x-y|)$。函数 $f(x)$ 的连续 SPH 近似为\n$$\nf_h(x) = \\int_{\\mathbb{R}} f(y)\\, W(|x-y|, h)\\, \\mathrm{d}y,\n$$ \n其中 $W(r,h)$ 是一个特征长度为 $h$ 的光滑核函数，满足归一化条件 $\\int_{\\mathbb{R}} W(r,h)\\, \\mathrm{d}r = 1$，并且是非负、径向对称的，且随 $r/h$ 衰减。在均匀周期性格点上的离散 SPH 插值为\n$$\nf_h^{\\Delta x}(x_i) = \\sum_{j=0}^{N-1} f(x_j)\\, W\\!\\left(d(x_i,x_j),\\, h\\right)\\, \\Delta x,\n$$ \n其中 $x_i = \\tfrac{i}{N}$，$i=0,\\ldots,N-1$。SPH 插值的误差通过离散网格上的 $L^2$ 范数和 $L^\\infty$ 范数来衡量：\n$$\n\\|e\\|_{L^2} = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( f(x_i) - f_h^{\\Delta x}(x_i) \\right)^2 \\right)^{1/2}, \\quad \\|e\\|_{L^\\infty} = \\max_{0 \\le i \\le N-1} \\left| f(x_i) - f_h^{\\Delta x}(x_i) \\right|.\n$$\n在本问题中，使用三种核函数实现 SPH 近似：\n- 高斯核 (Gaussian kernel)：$W_{\\mathrm{G}}(r,h) = \\dfrac{1}{\\sqrt{\\pi}\\, h}\\, \\exp\\!\\left( -\\left(\\dfrac{r}{h}\\right)^2 \\right)$，\n- 三次样条核 (Cubic spline kernel)（紧支集 $2h$）：\n$$\nW_{\\mathrm{CS}}(r,h) = \\frac{2}{3h}\n\\begin{cases}\n1 - \\tfrac{3}{2}q^2 + \\tfrac{3}{4}q^3,  0 \\le q  1,\\\\\n\\tfrac{1}{4}(2 - q)^3,  1 \\le q  2,\\\\\n0,  q \\ge 2,\n\\end{cases}\n\\quad \\text{其中 } q = \\dfrac{r}{h},\n$$\n- Wendland $C^2$ 核（紧支集 $2h$），在一维中归一化：\n$$\nW_{\\mathrm{W2}}(r,h) = \\frac{3}{4h} \\left(1 - \\frac{q}{2}\\right)^4 (1 + 2q) \\quad \\text{对于 } 0 \\le q \\le 2, \\text{ 否则为 } 0, \\quad q = \\dfrac{r}{h}.\n$$\n对于每种核函数，通过 $h = \\alpha\\, \\Delta x$ 将光滑长度 $h$ 选为与粒子间距成正比，其中 $\\alpha$ 是每个测试用例的固定比率。通过对误差与 $\\Delta x$ 的对数-对数关系进行线性拟合来测量经验收敛阶 $p$：\n$$\n\\log \\|e\\| \\approx p \\log \\Delta x + \\log C,\n$$\n因此斜率 $p$ 是估计的收敛阶。对 $\\left( \\log \\Delta x, \\log \\|e\\| \\right)$ 数据对使用最小二乘线性回归。\n\n你的任务是：\n1. 使用离散公式，在周期性域 $[0,1]$ 上为上述三种核函数实现 SPH 插值。\n2. 对于下方的每个测试用例，在四种分辨率 $N \\in \\{50, 100, 200, 400\\}$ 下，使用 $h = \\alpha \\Delta x$ 计算 $L^2$ 和 $L^\\infty$ 误差，并使用对数上的最小二乘线性回归，分别估计 $L^2$ 和 $L^\\infty$ 范数的收敛阶 $p_{2}$ 和 $p_{\\infty}$。\n3. 将估计的收敛阶报告为四舍五入到三位小数的无量纲浮点数。\n\n测试套件（每个元素是一个对 $(\\text{kernel}, \\alpha)$）：\n- 用例 A：$(\\text{Gaussian}, 1.0)$，\n- 用例 B：$(\\text{CubicSpline}, 1.2)$，\n- 用例 C：$(\\text{WendlandC2}, 1.5)$，\n- 用例 D（边缘情况，欠解析光滑）：$(\\text{Gaussian}, 0.7)$。\n\n最终输出格式：\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素是对应于上述测试用例顺序的双元素列表 $[p_2, p_{\\infty}]$。例如，输出应如下所示：\n$$\n\\texttt{[[p2\\_A,pinf\\_A],[p2\\_B,pinf\\_B],[p2\\_C,pinf\\_C],[p2\\_D,pinf\\_D]]}.\n$$\n所有报告的值必须四舍五入到三位小数，并且是无量纲的。",
            "solution": "该问题要求在一个一维周期性域中，实现并分析用于函数逼近的光滑粒子流体动力学 (SPH) 方法。目标是通过进行数值实验，确定三种不同光滑核函数的经验收敛阶。\n\n过程结构如下：\n1.  离散化域并定义 SPH 近似。\n2.  实现指定的平滑核函数。\n3.  计算一系列空间分辨率下的近似误差。\n4.  使用误差与分辨率的对数-对数图上的线性回归来估计收敛阶。\n\n**1. SPH 公式与离散化**\n\n问题定义在一个长度为 $L=1$ 的一维周期性域上，具体为 $[0,1]$。该域使用 $N$ 个均匀分布的粒子进行离散化。第 $j$ 个粒子的位置由 $x_j = j/N$ 给出，其中 $j = 0, 1, \\ldots, N-1$。均匀粒子间距为 $\\Delta x = 1/N$。\n\n在粒子位置 $x_i$ 处，函数 $f(x)$ 的 SPH 近似是所有粒子的加权和，权重由光滑核函数 $W$ 给出。离散 SPH 插值的公式为：\n$$\nf_h^{\\Delta x}(x_i) = \\sum_{j=0}^{N-1} f(x_j)\\, W(d(x_i, x_j), h)\\, \\Delta x\n$$\n这里，$f(x_j)$ 是函数在粒子 $x_j$ 处的精确值。项 $\\Delta x$ 表示与每个粒子相关的一维体积。函数 $d(x,y)$ 计算周期性距离，这对周期性域上的问题至关重要，定义为：\n$$\nd(x, y) = \\min(|x - y|, 1 - |x - y|)\n$$\n光滑长度 $h$ 决定了核函数的影响范围，并被设置为与粒子间距成正比，即 $h = \\alpha \\Delta x$，其中 $\\alpha$ 是一个给定的常数。\n\n待逼近的目标函数是 $f(x) = \\sin(2\\pi x) + \\frac{1}{2}\\sin(6\\pi x)$。\n\n**2. 光滑核函数**\n\n问题指定了三种不同的光滑核函数，每种在光滑性和支集方面都有其自身属性。\n\n- **高斯核 (Gaussian Kernel)**：此核函数无限可微 ($C^\\infty$) 且具有无限支集。其一维形式为：\n$$\nW_{\\mathrm{G}}(r, h) = \\frac{1}{\\sqrt{\\pi}\\, h}\\, \\exp\\left( -\\left(\\frac{r}{h}\\right)^2 \\right)\n$$\n\n- **三次样条核 (Cubic Spline Kernel)**：此核函数是一个具有半径为 $2h$ 的紧支集的分段多项式。它是 SPH 中的标准选择，在计算成本和准确性之间提供了平衡。设 $q = r/h$，其定义为：\n$$\nW_{\\mathrm{CS}}(r, h) = \\frac{2}{3h}\n\\begin{cases}\n1 - \\frac{3}{2}q^2 + \\frac{3}{4}q^3,  0 \\le q  1, \\\\\n\\frac{1}{4}(2 - q)^3,  1 \\le q  2, \\\\\n0,  q \\ge 2\n\\end{cases}\n$$\n\n- **Wendland $C^2$ 核 (Wendland $C^2$ Kernel)**：这是一个紧支集多项式核，为具有特定光滑度（在此情况下为 $C^2$ 连续）而专门构造。其一维形式为：\n$$\nW_{\\mathrm{W2}}(r, h) = \\frac{3}{4h} \\left(1 - \\frac{q}{2}\\right)^4 (1 + 2q), \\quad \\text{对于 } 0 \\le q \\le 2, \\text{ 否则为 } 0, \\text{ 其中 } q = \\frac{r}{h}\n$$\n\n**3. 误差估计**\n\n为了量化 SPH 近似的准确性，我们计算每个粒子位置的误差 $e_i = f(x_i) - f_h^{\\Delta x}(x_i)$。总体误差使用两种离散范数来衡量：\n\n- **$L^2$ 范数**：此范数计算网格上的均方根误差。\n$$\n\\|e\\|_{L^2} = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( f(x_i) - f_h^{\\Delta x}(x_i) \\right)^2 \\right)^{1/2}\n$$\n\n- **$L^\\infty$ 范数**：此范数测量网格上任意点的最大绝对误差。\n$$\n\\|e\\|_{L^\\infty} = \\max_{0 \\le i \\le N-1} \\left| f(x_i) - f_h^{\\Delta x}(x_i) \\right|\n$$\n\n**4. 收敛性分析**\n\n收敛阶 $p$ 描述了当粒子间距 $\\Delta x$ 趋近于零时，误差 $\\|e\\|$ 如何减小。这种关系通常是幂律形式，$\\|e\\| \\approx C (\\Delta x)^p$，其中 $C$ 是一个常数。通过对该关系取对数，我们得到一个线性方程：\n$$\n\\log \\|e\\| \\approx p \\log \\Delta x + \\log C\n$$\n这表明收敛阶 $p$ 是误差与粒子间距的对数-对数图中的直线斜率。\n\n为了估计 $p$，我们计算一系列分辨率 $N \\in \\{50, 100, 200, 400\\}$ 下的误差，这些分辨率对应于粒子间距 $\\Delta x \\in \\{1/50, 1/100, 1/200, 1/400\\}$。然后，我们对数据对 $(\\log \\Delta x, \\log \\|e\\|)$ 执行最小二乘线性回归。所得回归线的斜率提供了估计的收敛阶，即 $L^2$ 范数的 $p_2$ 和 $L^\\infty$ 范数的 $p_{\\infty}$。\n\n**5. 实现策略**\n\n对四个测试用例 $(\\text{kernel}, \\alpha)$ 中的每一个都实施数值程序。\n对于给定的测试用例和分辨率 $N$：\n1.  计算粒子位置 $x_j$ 和精确函数值 $f(x_j)$。\n2.  构建一个距离矩阵 $D$，其中 $D_{ij} = d(x_i, x_j)$。为提高效率使用向量化操作：给定位置向量 $x$，形成绝对差矩阵 $|x_i - x_j|$，然后通过取该矩阵与 $1$ 减去该矩阵的逐元素最小值来找到周期性距离。\n3.  将核函数 $W$ 应用于距离矩阵 $D$ 和光滑长度 $h = \\alpha \\Delta x$，以生成核函数矩阵 $W_{ij} = W(D_{ij}, h)$。\n4.  SPH 近似 $f_h^{\\Delta x}$ 通过矩阵-向量积计算：$f_h^{\\Delta x} = (W \\cdot f) \\Delta x$，其中 $f$ 是精确函数值的向量。\n5.  计算误差并将其对数与 $\\Delta x$ 的对数一起存储。\n\n在遍历一个测试用例的所有分辨率后，使用 `numpy.polyfit`（阶数为1）进行线性回归并提取斜率，从而得到收敛阶 $p_2$ 和 $p_{\\infty}$。然后收集所有测试用例的结果，并按照指定格式进行格式化。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the SPH convergence problem.\n    \"\"\"\n\n    # Define the smooth, periodic test function\n    def f_exact(x):\n        return np.sin(2 * np.pi * x) + 0.5 * np.sin(6 * np.pi * x)\n\n    # --- Kernel Function Implementations ---\n\n    def gaussian_kernel(r, h):\n        \"\"\"Gaussian smoothing kernel.\"\"\"\n        return 1.0 / (np.sqrt(np.pi) * h) * np.exp(-(r / h)**2)\n\n    def cubic_spline_kernel(r, h):\n        \"\"\"Cubic Spline (M4) smoothing kernel.\"\"\"\n        q = r / h\n        factor = 2.0 / (3.0 * h)\n        \n        # Initialize result array\n        res = np.zeros_like(q)\n        \n        # Mask for 0 = q  1\n        mask1 = q  1\n        q1 = q[mask1]\n        res[mask1] = 1.0 - 1.5 * q1**2 + 0.75 * q1**3\n        \n        # Mask for 1 = q  2\n        mask2 = (q >= 1)  (q  2)\n        q2 = q[mask2]\n        res[mask2] = 0.25 * (2.0 - q2)**3\n        \n        return factor * res\n\n    def wendland_c2_kernel(r, h):\n        \"\"\"Wendland C2 smoothing kernel, normalized in 1D.\"\"\"\n        q = r / h\n        factor = 3.0 / (4.0 * h)\n        \n        # Initialize result array\n        res = np.zeros_like(q)\n\n        # Mask for 0 = q = 2\n        mask = q = 2\n        q_masked = q[mask]\n        \n        term1 = (1.0 - q_masked / 2.0)**4\n        term2 = (1.0 + 2.0 * q_masked)\n        res[mask] = term1 * term2\n        \n        return factor * res\n\n    # --- Problem Setup ---\n\n    # Test suite: (kernel_name, alpha)\n    test_cases = [\n        ('gaussian', 1.0),\n        ('cubicspline', 1.2),\n        ('wendlandc2', 1.5),\n        ('gaussian', 0.7)\n    ]\n\n    kernel_map = {\n        'gaussian': gaussian_kernel,\n        'cubicspline': cubic_spline_kernel,\n        'wendlandc2': wendland_c2_kernel\n    }\n    \n    # Resolutions for convergence study\n    resolutions = np.array([50, 100, 200, 400])\n    \n    final_results = []\n\n    # --- Main Loop over Test Cases ---\n    for kernel_name, alpha in test_cases:\n        kernel_func = kernel_map[kernel_name]\n        \n        log_delta_x = []\n        log_l2_errors = []\n        log_linf_errors = []\n\n        # Loop over resolutions to gather error data\n        for N in resolutions:\n            delta_x = 1.0 / N\n            h = alpha * delta_x\n            \n            # Create particle grid and evaluate exact function\n            x = np.arange(N) / N\n            f_vals = f_exact(x)\n            \n            # --- SPH Approximation Calculation ---\n            \n            # Construct periodic distance matrix using broadcasting\n            x_col = x[:, np.newaxis]\n            x_row = x[np.newaxis, :]\n            abs_diff = np.abs(x_col - x_row)\n            d_matrix = np.minimum(abs_diff, 1.0 - abs_diff)\n            \n            # Evaluate kernel on the distance matrix\n            W_matrix = kernel_func(d_matrix, h)\n            \n            # Compute SPH sum via matrix-vector product\n            f_sph = np.dot(W_matrix, f_vals) * delta_x\n            \n            # --- Error Calculation ---\n            \n            error = f_vals - f_sph\n            \n            # L2 norm of the error\n            l2_error = np.sqrt(delta_x * np.sum(error**2))\n            \n            # L-infinity norm of the error\n            linf_error = np.max(np.abs(error))\n            \n            # Store log of values for regression\n            log_delta_x.append(np.log(delta_x))\n            log_l2_errors.append(np.log(l2_error))\n            log_linf_errors.append(np.log(linf_error))\n\n        # --- Convergence Order Estimation ---\n        \n        # Use numpy.polyfit to perform linear regression (degree 1)\n        # The slope (first element of the returned array) is the convergence order\n        p2, _ = np.polyfit(log_delta_x, log_l2_errors, 1)\n        p_inf, _ = np.polyfit(log_delta_x, log_linf_errors, 1)\n\n        # Append results for this test case\n        final_results.append([p2, p_inf])\n\n    # --- Format and Print Final Output ---\n    \n    # Build the output string to match the specified format precisely\n    # e.g., [[p2_A,pinf_A],[p2_B,pinf_B],...] with no spaces\n    results_str_list = [f\"[{p2:.3f},{pinf:.3f}]\" for p2, pinf in final_results]\n    output_str = f\"[{','.join(results_str_list)}]\"\n    \n    print(output_str)\n\nsolve()\n\n```"
        }
    ]
}