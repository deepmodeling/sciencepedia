{
    "hands_on_practices": [
        {
            "introduction": "掌握赫尔曼-费曼定理最直接的方式之一是通过一个简单的有限维系统。这个练习使用一个 $2 \\times 2$ 矩阵哈密顿量，让你能够精确计算能量本征值如何随参数 $\\lambda$ 变化。通过将定理的预测结果与直接对解析解求导得到的结果进行比较，你可以清晰地验证该定理的有效性，并理解其在非简并情况下的应用前提。",
            "id": "2814495",
            "problem": "一个作用于有限维希尔伯特空间上的参数哈密顿量 $H(\\lambda)$ 具有瞬时本征对 $\\{E_{n}(\\lambda),\\,|\\psi_{n}(\\lambda)\\rangle\\}$，它们满足不含时薛定谔方程 $H(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle$ 和归一化条件 $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$。假设对于一个固定的本征值标签 $n$，$E_{n}(\\lambda)$ 是非简并的，并且映射 $\\lambda\\mapsto H(\\lambda)$ 在所关心的开区间内是可微的。\n\n从这些基本关系出发，并且不引用任何外部定理，首先推导一个关于能量的参数导数 $dE_{n}(\\lambda)/d\\lambda$ 的普遍恒等式，用 $|\\psi_{n}(\\lambda)\\rangle$ 和 $\\partial H(\\lambda)/\\partial\\lambda$ 来表示。然后，特别考虑一个两能级哈密顿量\n$$\nH(\\lambda)=\\begin{pmatrix}\\Delta  \\lambda\\\\ \\lambda  -\\Delta\\end{pmatrix},\n$$\n其中 $\\Delta\\in\\mathbb{R}$ 是一个固定参数，$\\lambda\\in\\mathbb{R}$ 是控制参数，并为其两个本征值 $E_{\\pm}(\\lambda)$ 计算 $dE_{\\pm}(\\lambda)/d\\lambda$。为了使您的计算明确，您可以构造 $H(\\lambda)$ 的归一化本征矢量，并计算出现的任何内积。\n\n另外，解析地对角化 $H(\\lambda)$ 以获得 $E_{\\pm}(\\lambda)$ 的闭式表达式，并直接对它们关于 $\\lambda$ 求导。将结果与您之前的结果进行比较，并简要解释您推导的恒等式在此模型下成立或可能失效的条件。\n\n将您的最终答案以有序对 $\\big(dE_{+}(\\lambda)/d\\lambda,\\,dE_{-}(\\lambda)/d\\lambda\\big)$ 的形式，作为一个单一的闭式解析表达式报告。无需单位。不要对答案进行四舍五入。",
            "solution": "所提出的问题是量子力学微扰理论中的一个标准练习，并且定义明确。它具有科学依据、自成体系且客观。我们将着手进行解答。\n\n首先，我们推导能量本征值的参数导数的普遍恒等式，这被称为 Hellmann-Feynman 定理。我们从非简并本征态 $|\\psi_{n}(\\lambda)\\rangle$ 的不含时薛定谔方程开始：\n$$\nH(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle=E_{n}(\\lambda)\\,|\\psi_{n}(\\lambda)\\rangle\n$$\n鉴于归一化条件 $\\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle=1$，能量本征值 $E_{n}(\\lambda)$ 可以表示为哈密顿量在该状态下的期望值：\n$$\nE_{n}(\\lambda) = \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle\n$$\n现在我们对这个表达式关于参数 $\\lambda$ 求导，应用微分学的乘法法则：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\frac{d}{d\\lambda} \\Big( \\langle\\psi_{n}(\\lambda)|H(\\lambda)|\\psi_{n}(\\lambda)\\rangle \\Big)\n$$\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) H(\\lambda) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| H(\\lambda) \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\n由于哈密顿量 $H(\\lambda)$ 是厄米的，我们可以让它作用在左矢或右矢上。使用薛定谔方程 $H(\\lambda) |\\psi_{n}(\\lambda)\\rangle = E_n(\\lambda)|\\psi_{n}(\\lambda)\\rangle$ 及其厄米共轭 $\\langle\\psi_{n}(\\lambda)| H(\\lambda) = \\langle\\psi_{n}(\\lambda)| E_n(\\lambda) = E_n(\\lambda)\\langle\\psi_{n}(\\lambda)|$。将这些代入表达式得到：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle + E_{n}(\\lambda) \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right)\n$$\n提出标量能量本征值 $E_{n}(\\lambda)$：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = E_{n}(\\lambda) \\left[ \\left(\\frac{d\\langle\\psi_{n}(\\lambda)|}{d\\lambda}\\right) |\\psi_{n}(\\lambda)\\rangle + \\langle\\psi_{n}(\\lambda)| \\left(\\frac{d|\\psi_{n}(\\lambda)\\rangle}{d\\lambda}\\right) \\right] + \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\n方括号中的项恰好是归一化条件的导数：\n$$\n\\frac{d}{d\\lambda} \\langle\\psi_{n}(\\lambda)|\\psi_{n}(\\lambda)\\rangle = \\frac{d}{d\\lambda}(1) = 0\n$$\n因此，第一项为零，我们得到以下恒等式：\n$$\n\\frac{dE_{n}(\\lambda)}{d\\lambda} = \\left\\langle\\psi_{n}(\\lambda)\\left|\\frac{\\partial H(\\lambda)}{\\partial\\lambda}\\right|\\psi_{n}(\\lambda)\\right\\rangle\n$$\n这就是 Hellmann-Feynman 定理。\n\n接下来，我们特别考虑给定的两能级哈密顿量：\n$$\nH(\\lambda) = \\begin{pmatrix} \\Delta  \\lambda \\\\ \\lambda  -\\Delta \\end{pmatrix}\n$$\n哈密顿量关于 $\\lambda$ 的导数是显而易见的：\n$$\n\\frac{\\partial H(\\lambda)}{\\partial\\lambda} = \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix}\n$$\n为应用所推导的恒等式，我们需要 $H(\\lambda)$ 的本征矢量。首先，我们从特征方程 $\\det(H(\\lambda) - E I) = 0$ 中求出本征值 $E_{\\pm}(\\lambda)$：\n$$\n(\\Delta - E)(-\\Delta - E) - \\lambda^{2} = 0 \\implies -(\\Delta^{2} - E^{2}) - \\lambda^{2} = 0 \\implies E^{2} = \\Delta^{2} + \\lambda^{2}\n$$\n两个本征值为 $E_{+}(\\lambda) = \\sqrt{\\Delta^{2} + \\lambda^{2}}$ 和 $E_{-}(\\lambda) = -\\sqrt{\\Delta^{2} + \\lambda^{2}}$。\n\n现在我们求对应的本征矢量 $|\\psi_{\\pm}(\\lambda)\\rangle = \\begin{pmatrix} a \\\\ b \\end{pmatrix}$。对于一个给定的本征值 $E$，其分量满足 $(\\Delta-E)a + \\lambda b = 0$。我们可以将未归一化的本征矢量表示为 $\\begin{pmatrix} \\lambda \\\\ E-\\Delta \\end{pmatrix}$。\n归一化常数 $N$ 可由 $N^{-2} = |\\lambda|^{2} + |E-\\Delta|^{2}$ 求得。让我们计算这个归一化因子：\n$$\n|\\lambda|^{2} + |E_{\\pm}-\\Delta|^{2} = \\lambda^{2} + (E_{\\pm}-\\Delta)^{2} = \\lambda^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} + \\Delta^{2}\n$$\n代入 $E_{\\pm}^{2} = \\Delta^{2} + \\lambda^{2}$，我们得到：\n$$\n= (\\lambda^{2}+\\Delta^{2}) + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = E_{\\pm}^{2} + E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}^{2} - 2\\Delta E_{\\pm} = 2E_{\\pm}(E_{\\pm}-\\Delta)\n$$\n因此，归一化的本征矢量为 $|\\psi_{\\pm}(\\lambda)\\rangle = \\frac{1}{\\sqrt{2E_{\\pm}(E_{\\pm}-\\Delta)}} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}$。\n\n现在我们计算期望值 $\\langle\\psi_{\\pm}|\\frac{\\partial H}{\\partial\\lambda}|\\psi_{\\pm}\\rangle$：\n$$\n\\frac{dE_{\\pm}}{d\\lambda} = \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda  E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix} \\begin{pmatrix} \\lambda \\\\ E_{\\pm}-\\Delta \\end{pmatrix}\n$$\n$$\n= \\frac{1}{2E_{\\pm}(E_{\\pm}-\\Delta)} \\begin{pmatrix} \\lambda  E_{\\pm}-\\Delta \\end{pmatrix} \\begin{pmatrix} E_{\\pm}-\\Delta \\\\ \\lambda \\end{pmatrix}\n$$\n$$\n= \\frac{\\lambda(E_{\\pm}-\\Delta) + (E_{\\pm}-\\Delta)\\lambda}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{2\\lambda(E_{\\pm}-\\Delta)}{2E_{\\pm}(E_{\\pm}-\\Delta)} = \\frac{\\lambda}{E_{\\pm}}\n$$\n代入 $E_{\\pm}(\\lambda)$ 的表达式：\n$$\n\\frac{dE_{+}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{+}(\\lambda)} = \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n$$\n\\frac{dE_{-}(\\lambda)}{d\\lambda} = \\frac{\\lambda}{E_{-}(\\lambda)} = \\frac{\\lambda}{-\\sqrt{\\Delta^{2}+\\lambda^{2}}} = -\\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n这就完成了使用 Hellmann-Feynman 定理的计算。\n\n为了独立验证，我们直接对本征值求导。\n$$\nE_{\\pm}(\\lambda) = \\pm\\sqrt{\\Delta^{2} + \\lambda^{2}}\n$$\n$$\n\\frac{dE_{\\pm}(\\lambda)}{d\\lambda} = \\pm \\frac{1}{2\\sqrt{\\Delta^{2}+\\lambda^{2}}} \\cdot (2\\lambda) = \\pm \\frac{\\lambda}{\\sqrt{\\Delta^{2}+\\lambda^{2}}}\n$$\n这证实了我们之前的结果。\n\n最后，我们讨论 Hellmann-Feynman 定理的有效性条件。推导过程假设本征态 $|\\psi_{n}(\\lambda)\\rangle$ 关于 $\\lambda$ 是可微的。在版本征值发生简并的点，这个条件可能会失效。对于给定的哈密顿量，$E_{+}(\\lambda) = E_{-}(\\lambda)$ 当且仅当 $\\sqrt{\\Delta^{2}+\\lambda^{2}} = -\\sqrt{\\Delta^{2}+\\lambda^{2}}$，这意味着 $\\Delta^{2}+\\lambda^{2} = 0$。由于 $\\Delta$ 和 $\\lambda$ 是实数，这只在 $\\Delta=0$ 且 $\\lambda=0$ 时发生。\n情况1：$\\Delta \\neq 0$。对于任何实数 $\\lambda$，本征值 $E_{+}(\\lambda)$ 和 $E_{-}(\\lambda)$ 永不相等。谱在各处都是非简并的。该定理对所有 $\\lambda \\in \\mathbb{R}$ 都有效。\n情况2：$\\Delta = 0$。哈密顿量为 $H(\\lambda) = \\lambda \\begin{pmatrix} 0  1 \\\\ 1  0 \\end{pmatrix}$，本征值为 $E_{\\pm}(\\lambda) = \\pm\\sqrt{\\lambda^{2}} = \\pm|\\lambda|$。在 $\\lambda=0$ 处，本征值发生简并，$E_{+}(0) = E_{-}(0) = 0$。函数 $|\\lambda|$ 在 $\\lambda=0$ 处不可微。因此，Hellmann-Feynman 恒等式的左侧 $dE_{\\pm}/d\\lambda$ 在 $\\lambda=0$ 处没有定义。因此，对于 $\\Delta = 0$，该定理在简并点 $\\lambda=0$ 处失效。对于任何 $\\lambda \\neq 0$，本征值是非简并的，定理成立。",
            "answer": "$$\n\\boxed{\\begin{pmatrix}\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}  -\\frac{\\lambda}{\\sqrt{\\Delta^{2} + \\lambda^{2}}}\\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在前一个练习的基础上，我们将抽象的双能级模型置于一个具体的物理情景中：分子中电子势能面的规避交叉。这个实践将引导你应用赫尔曼-费曼定理来计算原子核感受到的“力”，从而将该定理与化学动力学中的核心概念——势能面——联系起来。通过分析非绝热耦合，你还将深入理解玻恩-奥本海默（Born-Oppenheimer）近似在其失效区域的局限性。",
            "id": "2814509",
            "problem": "考虑一维核坐标 $R$ 和一个由透热基态 $\\{\\,|1\\rangle, |2\\rangle\\,\\}$ 张成的双能级电子子空间。在固定的 $R$ 下，电子哈密顿量为\n$$\n\\hat{H}_{e}(R)=\n\\begin{pmatrix}\nk\\,R  \\Delta \\\\\n\\Delta  -k\\,R\n\\end{pmatrix},\n$$\n其中 $k>0$ 和 $\\Delta>0$ 为常数。完整的分子哈密顿量是核动能算符与 $\\hat{H}_{e}(R)$ 之和，但您只需在固定 $R$ 的参数化电子本征问题层面上进行研究。绝热电子态 $\\{\\,|\\phi_{+}(R)\\rangle, |\\phi_{-}(R)\\rangle\\,\\}$ 及其绝热能量 $\\{\\,E_{+}(R), E_{-}(R)\\,\\}$ 由不含时电子薛定谔方程 $\\hat{H}_{e}(R)|\\phi_{\\pm}(R)\\rangle=E_{\\pm}(R)|\\phi_{\\pm}(R)\\rangle$ 定义，且满足 $\\langle \\phi_{\\pm}(R) | \\phi_{\\pm}(R) \\rangle=1$。\n\n从不含时薛定谔方程、绝热势能面上的核力定义（即相应绝热能量对 $R$ 的负梯度），以及标准的微分和内积法则出发，完成以下任务：\n\n1. 对角化 $\\hat{H}_{e}(R)$，以获得 $E_{\\pm}(R)$ 和归一化的 $|\\phi_{\\pm}(R)\\rangle$ 的解析表达式，用一个由透热基的平滑旋转所定义的混合角 $\\theta(R)$ 来表示。除此处给出的基本定义外，不要假定任何其他结果。\n\n2. 仅利用上述定义，并通过对电子本征值方程关于 $R$ 的仔细微分，导出每个绝热势能面上的力的 Hellmann-Feynman 表达式，并计算出作为 $R$、$k$ 和 $\\Delta$ 的函数的显式解析力 $F_{\\pm}(R)$。\n\n3. 计算非绝热导数耦合 $d_{+-}(R)=\\langle \\phi_{+}(R) | \\partial / \\partial R | \\phi_{-}(R) \\rangle$（用 $\\theta(R)$ 表示），指出其在何处达到最大值，并确定其在 $|R|\\to \\infty$ 时的渐近标度。基于这些结果以及绝热表象中核动能算符的结构，解释为什么 Born-Oppenheimer (BO) 近似在避免交叉点附近变得不可靠。\n\n您的最终答案必须是 Hellmann-Feynman 力对 $F_{+}(R)$ 和 $F_{-}(R)$ 的单一、闭合形式解析表达式，并写成一个行矩阵。最终的方框答案中不要包含单位。不需要进行数值计算。",
            "solution": "所给问题是理论化学中的一个标准且定义明确的练习，具体涉及电子态在避免交叉点附近的行为。该问题具有科学依据，内容自洽，没有任何逻辑或事实上的不一致。因此，我们可以着手求解。\n\n问题分为三个部分。我们将按顺序逐一解答。\n\n第一部分：电子哈密顿量的对角化。\n\n在透热基 $\\{|1\\rangle, |2\\rangle\\}$ 中，电子哈密顿量由下式给出\n$$\n\\hat{H}_{e}(R) = \\begin{pmatrix} kR  \\Delta \\\\ \\Delta  -kR \\end{pmatrix}\n$$\n其中 $k>0$ 和 $\\Delta>0$ 是实常数。绝热能量 $E_{\\pm}(R)$ 是该矩阵的本征值。它们通过求解特征方程 $\\det(\\hat{H}_{e}(R) - E \\mathbf{I}) = 0$ 得到。\n$$\n\\det \\begin{pmatrix} kR-E  \\Delta \\\\ \\Delta  -kR-E \\end{pmatrix} = (kR-E)(-kR-E) - \\Delta^2 = 0\n$$\n$$\n-(kR)^2 - kRE + kRE + E^2 - \\Delta^2 = 0\n$$\n$$\nE^2 = (kR)^2 + \\Delta^2\n$$\n由此得到两个绝热能量面：\n$$\nE_{\\pm}(R) = \\pm \\sqrt{(kR)^2 + \\Delta^2}\n$$\n按照惯例，$E_{+}(R)$ 是较高能量面，$E_{-}(R)$ 是较低能量面。\n\n接下来，我们确定相应的归一化本征矢量，即绝热电子态 $|\\phi_{\\pm}(R)\\rangle$。我们将其表示为透热基通过混合角 $\\theta(R)$ 的旋转：\n$$\n|\\phi_{+}(R)\\rangle = \\cos\\theta(R)|1\\rangle + \\sin\\theta(R)|2\\rangle = \\begin{pmatrix} \\cos\\theta(R) \\\\ \\sin\\theta(R) \\end{pmatrix}\n$$\n$$\n|\\phi_{-}(R)\\rangle = -\\sin\\theta(R)|1\\rangle + \\cos\\theta(R)|2\\rangle = \\begin{pmatrix} -\\sin\\theta(R) \\\\ \\cos\\theta(R) \\end{pmatrix}\n$$\n这种选择确保了这些态是标准正交的：$\\langle\\phi_+|\\phi_-\\rangle=0$ 且 $\\langle\\phi_{\\pm}|\\phi_{\\pm}\\rangle=1$。\n为了求出混合角 $\\theta(R)$，我们将 $|\\phi_{+}(R)\\rangle$ 和 $E_{+}(R)$ 代入不含时薛定谔方程 $\\hat{H}_{e}(R)|\\phi_{+}(R)\\rangle=E_{+}(R)|\\phi_{+}(R)\\rangle$ 中：\n$$\n\\begin{pmatrix} kR  \\Delta \\\\ \\Delta  -kR \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix} = E_{+} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix}\n$$\n这给出了一个由两个方程组成的方程组：\n1. $kR\\cos\\theta + \\Delta\\sin\\theta = E_{+}\\cos\\theta$\n2. $\\Delta\\cos\\theta - kR\\sin\\theta = E_{+}\\sin\\theta$\n由第一个方程，我们得到 $\\Delta\\sin\\theta = (E_{+} - kR)\\cos\\theta$，这导致\n$$\n\\tan\\theta(R) = \\frac{E_{+}(R) - kR}{\\Delta}\n$$\n或者，由第二个方程，$\\Delta\\cos\\theta = (E_{+} + kR)\\sin\\theta$，这给出\n$$\n\\tan\\theta(R) = \\frac{\\Delta}{E_{+}(R) + kR}\n$$\n为了获得 $\\theta(R)$ 的显式关系，我们可以使用倍角公式。将第一个方程乘以 $\\cos\\theta$，第二个方程乘以 $\\sin\\theta$，然后相加，得到：\n$$\nkR(\\cos^2\\theta - \\sin^2\\theta) + 2\\Delta\\sin\\theta\\cos\\theta = E_{+}(\\cos^2\\theta + \\sin^2\\theta)\n$$\n$$\nE_{+}(R) = kR\\cos(2\\theta) + \\Delta\\sin(2\\theta)\n$$\n将此结果与 $E_{+}(R) = \\sqrt{(kR)^2+\\Delta^2}$ 进行比较，我们可以确定\n$$\n\\cos(2\\theta(R)) = \\frac{kR}{\\sqrt{(kR)^2+\\Delta^2}} \\quad \\text{和} \\quad \\sin(2\\theta(R)) = \\frac{\\Delta}{\\sqrt{(kR)^2+\\Delta^2}}\n$$\n这通过以下关系定义了平滑的混合角 $\\theta(R)$\n$$\n\\tan(2\\theta(R)) = \\frac{\\Delta}{kR}\n$$\n一个合适的平滑函数选择是 $2\\theta(R) = \\arccot(kR/\\Delta)$，它将 $R \\in (-\\infty, \\infty)$ 映射到 $2\\theta \\in (0, \\pi)$。\n\n第二部分：Hellmann-Feynman 力。\n\n绝热势能面上的力定义为 $F_{\\pm}(R) = -\\frac{dE_{\\pm}(R)}{dR}$。首先，我们推导 Hellmann-Feynman 定理。我们从薛定谔方程 $\\hat{H}_{e}(R)|\\phi_{\\pm}(R)\\rangle = E_{\\pm}(R)|\\phi_{\\pm}(R)\\rangle$ 开始，并对 $R$ 求导：\n$$\n\\frac{\\partial \\hat{H}_{e}}{\\partial R}|\\phi_{\\pm}\\rangle + \\hat{H}_{e}\\frac{\\partial |\\phi_{\\pm}\\rangle}{\\partial R} = \\frac{dE_{\\pm}}{dR}|\\phi_{\\pm}\\rangle + E_{\\pm}\\frac{\\partial |\\phi_{\\pm}\\rangle}{\\partial R}\n$$\n然后，我们与 $\\langle\\phi_{\\pm}(R)|$ 作内积：\n$$\n\\langle\\phi_{\\pm}|\\frac{\\partial \\hat{H}_{e}}{\\partial R}|\\phi_{\\pm}\\rangle + \\langle\\phi_{\\pm}|\\hat{H}_{e}|\\frac{\\partial \\phi_{\\pm}}{\\partial R}\\rangle = \\frac{dE_{\\pm}}{dR}\\langle\\phi_{\\pm}|\\phi_{\\pm}\\rangle + E_{\\pm}\\langle\\phi_{\\pm}|\\frac{\\partial \\phi_{\\pm}}{\\partial R}\\rangle\n$$\n由于 $\\hat{H}_{e}$ 是厄米算符，所以 $\\langle\\phi_{\\pm}|\\hat{H}_{e} = \\langle\\hat{H}_{e}\\phi_{\\pm}| = \\langle E_{\\pm}\\phi_{\\pm}| = E_{\\pm}\\langle\\phi_{\\pm}|$。将此代入左侧第二项，得到：\n$$\n\\langle\\phi_{\\pm}|\\frac{\\partial \\hat{H}_{e}}{\\partial R}|\\phi_{\\pm}\\rangle + E_{\\pm}\\langle\\phi_{\\pm}|\\frac{\\partial \\phi_{\\pm}}{\\partial R}\\rangle = \\frac{dE_{\\pm}}{dR} + E_{\\pm}\\langle\\phi_{\\pm}|\\frac{\\partial \\phi_{\\pm}}{\\partial R}\\rangle\n$$\n包含波函数导数的项相互抵消，从而得到能量梯度的 Hellmann-Feynman 定理：\n$$\n\\frac{dE_{\\pm}(R)}{dR} = \\left\\langle\\phi_{\\pm}(R)\\left|\\frac{\\partial \\hat{H}_{e}(R)}{\\partial R}\\right|\\phi_{\\pm}(R)\\right\\rangle\n$$\n现在，我们为给定系统计算这个量。哈密顿量的导数为：\n$$\n\\frac{\\partial \\hat{H}_{e}}{\\partial R} = \\frac{\\partial}{\\partial R}\\begin{pmatrix} kR  \\Delta \\\\ \\Delta  -kR \\end{pmatrix} = \\begin{pmatrix} k  0 \\\\ 0  -k \\end{pmatrix}\n$$\n较高能量面上的力 $F_+(R)$ 为：\n$$\nF_{+}(R) = - \\langle\\phi_{+}|\\frac{\\partial \\hat{H}_{e}}{\\partial R}|\\phi_{+}\\rangle = - \\begin{pmatrix} \\cos\\theta  \\sin\\theta \\end{pmatrix} \\begin{pmatrix} k  0 \\\\ 0  -k \\end{pmatrix} \\begin{pmatrix} \\cos\\theta \\\\ \\sin\\theta \\end{pmatrix}\n$$\n$$\nF_{+}(R) = - (k\\cos^2\\theta - k\\sin^2\\theta) = -k\\cos(2\\theta)\n$$\n较低能量面上的力 $F_-(R)$ 为：\n$$\nF_{-}(R) = - \\langle\\phi_{-}|\\frac{\\partial \\hat{H}_{e}}{\\partial R}|\\phi_{-}\\rangle = - \\begin{pmatrix} -\\sin\\theta  \\cos\\theta \\end{pmatrix} \\begin{pmatrix} k  0 \\\\ 0  -k \\end{pmatrix} \\begin{pmatrix} -\\sin\\theta \\\\ \\cos\\theta \\end{pmatrix}\n$$\n$$\nF_{-}(R) = - (k\\sin^2\\theta - k\\cos^2\\theta) = k\\cos(2\\theta)\n$$\n代入在第一部分中找到的 $\\cos(2\\theta)$ 的表达式：\n$$\nF_{+}(R) = -k \\frac{kR}{\\sqrt{(kR)^2 + \\Delta^2}} = -\\frac{k^2 R}{\\sqrt{k^2 R^2 + \\Delta^2}}\n$$\n$$\nF_{-}(R) = k \\frac{kR}{\\sqrt{(kR)^2 + \\Delta^2}} = \\frac{k^2 R}{\\sqrt{k^2 R^2 + \\Delta^2}}\n$$\n这个结果可以通过直接对 $E_{\\pm}(R) = \\pm\\sqrt{(kR)^2 + \\Delta^2}$ 求导来验证。\n\n第三部分：非绝热耦合与 Born-Oppenheimer 近似的失效。\n\n非绝热导数耦合为 $d_{+-}(R) = \\langle \\phi_{+}(R) | \\frac{\\partial}{\\partial R} | \\phi_{-}(R) \\rangle$。由于透热基 $\\{|1\\rangle, |2\\rangle\\}$ 与 $R$ 无关，导数仅作用于系数：\n$$\n\\frac{\\partial}{\\partial R}|\\phi_{-}(R)\\rangle = \\frac{\\partial}{\\partial R}(-\\sin\\theta(R)|1\\rangle + \\cos\\theta(R)|2\\rangle) = -\\frac{d\\theta}{dR}(\\cos\\theta|1\\rangle + \\sin\\theta|2\\rangle) = -\\frac{d\\theta}{dR}|\\phi_{+}(R)\\rangle\n$$\n因此，该耦合简化为：\n$$\nd_{+-}(R) = \\left\\langle\\phi_{+}(R) \\left| \\left(-\\frac{d\\theta}{dR}\\right) \\right|\\phi_{+}(R)\\right\\rangle = -\\frac{d\\theta}{dR}\\langle\\phi_{+}|\\phi_{+}\\rangle = -\\frac{d\\theta}{dR}\n$$\n为了求出 $\\frac{d\\theta}{dR}$，我们对关系式 $\\tan(2\\theta) = \\Delta/(kR)$ 求导：\n$$\n\\sec^2(2\\theta) \\cdot 2\\frac{d\\theta}{dR} = -\\frac{\\Delta}{kR^2} \\implies \\frac{d\\theta}{dR} = -\\frac{\\Delta}{2kR^2 \\sec^2(2\\theta)} = -\\frac{\\Delta \\cos^2(2\\theta)}{2kR^2}\n$$\n使用 $\\cos^2(2\\theta) = \\frac{(kR)^2}{(kR)^2+\\Delta^2}$：\n$$\n\\frac{d\\theta}{dR} = -\\frac{\\Delta}{2kR^2} \\frac{k^2R^2}{k^2R^2+\\Delta^2} = -\\frac{k\\Delta}{2(k^2R^2+\\Delta^2)}\n$$\n因此，非绝热耦合为：\n$$\nd_{+-}(R) = -\\left(-\\frac{k\\Delta}{2(k^2R^2+\\Delta^2)}\\right) = \\frac{k\\Delta}{2(k^2R^2+\\Delta^2)}\n$$\n该表达式是关于 $R$ 的洛伦兹函数，在 $R=0$ 处达到其最大值。最大值为 $d_{+-}(0) = \\frac{k\\Delta}{2\\Delta^2} = \\frac{k}{2\\Delta}$。当 $|R| \\to \\infty$ 时，耦合渐近消失，其行为如同 $d_{+-}(R) \\sim \\frac{k\\Delta}{2k^2R^2} = \\frac{\\Delta}{2kR^2}$，即它按 $R^{-2}$ 的标度变化。\n\nBorn-Oppenheimer (BO) 近似假设核运动与电子运动是可分离的。这等同于在绝热电子基中表示时，忽略核动能算符的非对角元。这些非对角元正是非绝热耦合，例如 $d_{+-}(R)$。当这些耦合很小时，该近似是有效的。\n\n在避免交叉点（$R \\approx 0$）附近，两个条件共同导致 BO 近似失效：\n1.  绝热态之间的能隙 $\\Delta E(R) = E_{+}(R)-E_{-}(R) = 2\\sqrt{(kR)^2 + \\Delta^2}$ 达到其最小值 $\\Delta E(0) = 2\\Delta$。小的能隙使得态间跃迁更有可能发生。\n2.  非绝热耦合 $d_{+-}(R)$ 在 $R=0$ 处达到其最大值。大的耦合强度直接促进了绝热态之间的跃迁。\n\n在核坐标 $R$ 的同一区域，最小能隙和最大耦合强度的同时出现，导致核运动引起绝热电子态的强烈混合。因此，一个在某个绝热势能面上演化的量子系统，有很高的概率跃迁到另一个势能面上。这使得 BO 近似的核心原则——即系统保持在单一的绝热势能面上——失效。因此，BO 近似在 $R=0$ 处的避免交叉点附近变得不可靠。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{k^{2} R}{\\sqrt{k^{2} R^{2} + \\Delta^{2}}}  \\frac{k^{2} R}{\\sqrt{k^{2} R^{2} + \\Delta^{2}}} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "本练习旨在连接解析理论与实际计算，指导你如何在一个简化的平面波框架内实现赫尔曼-费曼力的计算，这是现代材料模拟中的一项核心技术。通过这个实践，你将探讨变分一致性和数值精度等关键问题，例如实空间网格分辨率如何影响力的计算准确性。理解这些对于在真实的电子结构计算中获得可靠结果至关重要。",
            "id": "2814531",
            "problem": "设计并实现一个完整、可运行的程序，在一个与理论化学相关的简化一维平面波框架中，演示、验证和压力测试基于 Hellmann-Feynman 定理的力的实现。从以下基本基础开始：由原子核坐标 $R$ 参数化的电子哈密顿量的定态薛定谔方程、归一化本征态的变分原理，以及周期性超胞中平面波基组的定义。不要使用或假设任何预先推导出的力表达式。相反，您需要推导出必须计算什么，其有效性的原因，以及它如何从这些基本原理中得出。您的程序应实现一个带光滑局域赝势的最小化一维平面波模型，并评估在不同数值网格分辨率下 Hellmann-Feynman 力的变分一致性。完全在原子单位（长度单位为玻尔，能量单位为哈特里，力的单位为哈特里/玻尔）下进行计算，并以布尔值的形式返回最终结果，指示指定的数值一致性检查是否在给定容差内通过。\n\n您必须在以下物理上和数值上合理的假设下进行，这些假设在此作为您将实现和测试的模型定义的一部分进行陈述：\n\n- 电子哈密顿量依赖于长度为 $L$ 的周期性晶胞中的单个原子核位置 $R$，在 $\\Gamma$ 点使用平面波基组 $\\{\\lvert G \\rangle\\}$。动能算符在平面波基组中是对角的，其矩阵元为 $T_{GG'}=\\frac{1}{2}G^2 \\,\\delta_{GG'}$，其中 $G=\\frac{2\\pi}{L}n$ 且 $n\\in\\mathbb{Z}$ 受动能截断 $G_{\\text{cut}}$ 的限制，即 $\\lvert G \\rvert \\le G_{\\text{cut}}$。\n- 外部局域赝势是一个以 $R$ 为中心、振幅为 $V_0>0$、宽度为 $\\sigma>0$ 的光滑周期性高斯梳，\n  $$V(x;R) = -V_0 \\sum_{m\\in\\mathbb{Z}} \\exp\\!\\left(-\\frac{(x-R-mL)^2}{2\\sigma^2}\\right),$$\n  这导致其傅里叶系数绝对收敛，并对波矢 $q$ 以 $\\exp(-\\sigma^2 q^2/2)$ 的形式衰减。\n- 在平面波离散傅里叶变换（DFT，指数值意义上的变换，而非密度泛函理论）中，局域势矩阵元 $V_{GG'}(R)$ 既可以使用解析傅里叶系数在倒易空间中精确构建，也可以通过在具有 $N$ 个点的实空间网格上采样来近似构建，\n  $$V_{GG'}(R) \\approx \\frac{L}{N}\\sum_{j=0}^{N-1} V(x_j;R)\\,e^{-i(G-G')x_j},\\quad x_j=\\frac{jL}{N},$$\n  如果网格的奈奎斯特波数 $G_{\\text{Nyq}}=\\pi N/L$ 未能覆盖平面波哈密顿量所需的所有重要傅里叶分量（特别是对于差值 $G-G'$ 高达 $2G_{\\text{cut}}$ 的支持，以及局域势傅里叶谱的尾部），则会产生混叠效应。这体现了控制平面波实现中变分一致性的数值网格考量。\n\n您的程序必须实现以下内容，并严格遵守基于原理的推导和数值构建：\n\n1. 从 $L$ 和 $G_{\\text{cut}}$ 构建平面波基组 $\\{G\\}$。\n2. 以两种方式构建哈密顿矩阵 $H(R)=T+V(R)$：\n   - 倒易空间路径：使用周期性高斯梳的解析傅里叶表示，确保对 $H(R)$ 中使用的任何截断都是无混叠的构建。\n   - 实空间网格路径：通过在晶胞中的 $N$ 个网格点上对 $V(x;R)$ 进行采样，并通过离散傅里叶求和来组装 $V_{GG'}(R)$。\n3. 求解厄米本征问题 $H(R)\\lvert \\psi(R)\\rangle = E(R)\\lvert \\psi(R)\\rangle$，得到基态能量 $E(R)$ 和在平面波基组中的归一化本征矢量系数 $c_G(R)$。\n4. 计算 Hellmann-Feynman 力，其定义为总电子能量对原子核坐标 $R$ 的负导数，通过使用哈密顿量对 $R$ 的导数来评估，即仅使用算符导数和在 $R$ 处的归一化本征矢量。基组必须被视为与 $R$ 无关（这与固定晶胞中的平面波一致），因此该模型中不会出现 Pulay 项。\n5. 使用中心差分独立计算能量导数的有限差分估计，\n   $$\\frac{dE}{dR}\\bigg\\rvert_{R} \\approx \\frac{E(R+h)-E(R-h)}{2h},$$\n   其中 $h$ 是一个小的位移。\n6. 对于指定的测试用例，使用相同或不同的哈密顿量构建路径，比较 Hellmann-Feynman 力与中心差分导数，以评估网格分辨率变化下的变分一致性。为每个用例返回一个布尔值，报告其绝对差值是否低于指定的容差。\n\n作为您的推导和实现计划的一部分，您必须确保以下概念的覆盖，即使您的数值模型只包含局域势：\n- 列举在一个通用的平面波 Kohn-Sham 密度泛函理论（DFT）代码中对力有贡献的各项，以展示对完备性的理解：局域赝势、可分离的非局域赝势投影算子、Hartree 能量贡献、交换关联能量贡献，以及离子-离子相互作用（例如，通过 Ewald 求和）。说明在使用固定平面波基组时 Pulay 项在何处消失，并解释在诸如投影缀加波（PAW）方法或超软赝势等方法中缀加项的作用。\n- 解释为确保能量及其导数一致所需的数值网格考量，包括网格需要能够表示算符乘积中高达约 $2G_{\\text{cut}}$ 的傅里叶分量，以及来自外部势谱的任何附加尾部。将其与常见的实用规则联系起来，例如密度网格截断和用于混叠控制的所谓 $3/2$ 规则启发式方法。\n\n使用以下参数值作为测试套件。如上所述，所有输入均为原子单位且无量纲，不使用角度。您的代码必须在内部设置这些参数并无需任何用户输入即可产生输出。\n\n- 晶胞长度：$L=20$。\n- 平面波截断：$G_{\\text{cut}}=2.5$。\n- 高斯赝势参数：$V_0=2.0$, $\\sigma=1.0$。\n- 原子核位置：$R_0=5.3$。\n- 中心差分步长：$h=10^{-4}$。\n- 用于测试的实空间网格尺寸：\n  - 情况 A（参考，仅倒易空间）：Hellmann-Feynman 力和能量导数均由倒易空间哈密顿量构建，无实空间采样。\n  - 情况 B（网格，充分解析）：Hellmann-Feynman 力和能量导数均由 $N=128$ 的实空间采样构建，这应足以表示高达约 $2G_{\\text{cut}}$ 的差异以及 $\\sigma=1.0$ 的高斯尾部。\n  - 情况 C（不匹配，有意不一致）：Hellmann-Feynman 力由 $N=32$ 的实空间网格构建，而能量导数由倒易空间构建。这种不匹配预计会破坏变分一致性。\n  - 情况 D（网格，欠采样但内部一致）：Hellmann-Feynman 力和能量导数均由 $N=32$ 的实空间网格构建。虽然表示可能不准确，但内部一致性应保持。\n\n每种情况的数值接受标准：\n- 如果 $\\lvert F_{\\text{HF}} - \\frac{E(R+h)-E(R-h)}{2h} \\rvert  \\tau$，则生成布尔值 True，否则为 False，其中 $\\tau=10^{-5}$。\n\n您的程序应生成一行输出，其中包含按 $[\\text{情况 A}, \\text{情况 B}, \\text{情况 C}, \\text{情况 D}]$ 顺序排列、用方括号括起来的逗号分隔列表的结果。最终输出必须与此确切格式匹配，例如 $[\\text{True},\\text{True},\\text{False},\\text{True}]$（确切的布尔值必须由您的计算确定）。",
            "solution": "所提出的问题是计算理论化学中一个有效且适定的练习。它要求在一个简化的一维平面波模型中，演示 Hellmann-Feynman 定理并分析其数值-变分一致性。所有必要的物理参数、数学定义和数值约束都已提供，从而可以得到一个唯一且可验证的解。该问题在科学上植根于量子力学和电子结构理论的标准数值技术。我将进行完整的推导和实现。\n\n此分析的基础是电子系统的定态薛定谔方程，其中哈密顿量 $H(\\lambda)$ 依赖于参数 $\\lambda$。在我们的例子中，$\\lambda$ 是原子核坐标，我们用 $R$ 表示。该方程为：\n$$ H(R) |\\psi(R)\\rangle = E(R) |\\psi(R)\\rangle $$\n其中 $|\\psi(R)\\rangle$ 是一个本征态，对应的能量本征值为 $E(R)$。我们考虑基态，其能量为最小值，且波函数是归一化的，$\\langle \\psi(R) | \\psi(R) \\rangle = 1$。\n\n能量可以表示为哈密顿量的期望值：\n$$ E(R) = \\langle \\psi(R) | H(R) | \\psi(R) \\rangle $$\n在位置 $R$ 的原子核所受的力定义为总能量的负梯度，$F(R) = -\\frac{dE(R)}{dR}$。为了推导 Hellmann-Feynman 定理，我们使用乘法法则对能量表达式关于 $R$ 求导：\n$$ \\frac{dE}{dR} = \\left\\langle \\frac{d\\psi}{dR} \\right| H | \\psi \\rangle + \\left\\langle \\psi \\left| \\frac{\\partial H}{\\partial R} \\right| \\psi \\right\\rangle + \\left\\langle \\psi \\right| H \\left| \\frac{d\\psi}{dR} \\right\\rangle $$\n由于 $|\\psi\\rangle$ 是一个本征态，因此 $H|\\psi\\rangle = E|\\psi\\rangle$。第一项变为 $E\\langle \\frac{d\\psi}{dR} | \\psi \\rangle$。利用哈密顿量的厄米性 $H^\\dagger=H$，最后一项变为 $\\langle H\\psi | \\frac{d\\psi}{dR} \\rangle = \\langle E\\psi | \\frac{d\\psi}{dR} \\rangle = E^* \\langle \\psi | \\frac{d\\psi}{dR} \\rangle$。由于厄米算符的能量本征值是实数，所以 $E^*=E$。第一项和最后一项的和是：\n$$ E \\left( \\left\\langle \\frac{d\\psi}{dR} | \\psi \\right\\rangle + \\left\\langle \\psi | \\frac{d\\psi}{dR} \\right\\rangle \\right) = E \\frac{d}{dR} \\langle \\psi | \\psi \\rangle $$\n因为波函数是归一化的，$\\langle \\psi | \\psi \\rangle = 1$，其导数为零。因此，这两项相互抵消，得到 Hellmann-Feynman 定理：\n$$ \\frac{dE}{dR} = \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n因此，力由哈密顿量导数的期望值给出：\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial H(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n该定理在 $|\\psi(R)\\rangle$ 是 $H(R)$ 的精确本征态时有效。变分原理确保了它对于通过变分计算获得的波函数也成立，这是诸如 Hartree-Fock 和密度泛函理论（DFT）等方法的基石。\n\n在我们的平面波模型中，哈密顿量是 $H(R) = T + V(R)$。动能算符 $T$ 和平面波基函数 $\\{|G\\rangle\\}$ 与原子核位置 $R$ 无关。由 $\\langle x | G \\rangle = (1/\\sqrt{L})e^{iGx}$ 给出的基函数相对于模拟晶胞是固定的。因此，哈密顿量中唯一依赖于 $R$ 的部分是势算符 $V(R)$。力的表达式简化为：\n$$ F_{\\text{HF}}(R) = - \\left\\langle \\psi(R) \\left| \\frac{\\partial V(R)}{\\partial R} \\right| \\psi(R) \\right\\rangle $$\n\n在平面波基组中展开基态波函数 $|\\psi\\rangle = \\sum_G c_G |G\\rangle$，力可以用矩阵形式计算：\n$$ F_{\\text{HF}} = - \\sum_{G, G'} c_{G'}^* \\left\\langle G' \\left| \\frac{\\partial V(R)}{\\partial R} \\right| G \\right\\rangle c_G = - \\mathbf{c}^\\dagger \\left( \\frac{\\partial \\mathbf{V}}{\\partial R} \\right) \\mathbf{c} $$\n其中 $\\mathbf{c}$ 是系数 $c_G$ 的列向量，而 $\\frac{\\partial \\mathbf{V}}{\\partial R}$ 是势导数算符的矩阵。\n\n该问题要求对完整平面波 DFT 计算中的力进行更广泛的概念性讨论。作用在离子上的总力是几个贡献的总和：\n1.  **局域赝势**：与本问题中相应的项。它是赝势局域部分导数的期望值。\n2.  **非局域赝势**：大多数现代赝势都包含非局域投影算子。其力的贡献涉及这些投影算子对原子位置的导数。\n3.  **Hartree 势**：电子的经典静电能量的导数。它依赖于电子密度对原子核坐标的导数。\n4.  **交换关联（XC）**：该力项源于 XC 能量泛函对原子核位置的导数，这也通过链式法则经由电子密度及其梯度进行计算。\n5.  **离子-离子相互作用**：原子核之间的直接经典库仑力，对于周期性体系通常通过 Ewald 求和计算。\n\n如前所推导，Hellmann-Feynman 定理假设基组与微分参数 $R$ 无关。在平面波基组中，基矢量与模拟晶胞绑定，而不是与原子绑定，因此它们确实与 $R$ 无关。这意味着不存在 **Pulay 力**（也称为 Pulay 修正）。Pulay 力出现在使用原子中心基组（如高斯型轨道）的方法中，其中基函数随原子移动。这些力是解释基组本身变化的修正项。在诸如投影缀加波（PAW）等先进方法中，附加的力项源于局域在原子上的缀加电荷的导数，必须小心处理。\n\n数值实现的一个关键方面是**变分一致性**。Hellmann-Feynman 定理的有效性依赖于波函数是用到的*精确*哈密顿量的本征态。在数值计算中，如果我们使用一个近似的哈密顿量 $\\tilde{H}$（例如，在粗糙的实空间网格上构建），计算出的力 $F_{\\text{HF}} = -\\langle \\tilde{\\psi} | \\partial \\tilde{H}/\\partial R | \\tilde{\\psi} \\rangle$ 只有在两次计算都使用*相同*的近似方案 $\\tilde{H}$ 时，才会与有限差分力 $F_{\\text{FD}} = -(\\tilde{E}(R+h)-\\tilde{E}(R-h))/(2h)$ 一致。如果方案不匹配，例如对 $F_{\\text{HF}}$ 使用粗糙网格而对 $F_{\\text{FD}}$ 使用精确公式，就会破坏这种变分一致性并导致差异。\n\n这种一致性主要由用于表示算符的实空间网格的分辨率决定。两个基函数的乘积 $\\langle G'|...|G \\rangle$ 包含诸如 $e^{-i(G-G')x}$ 之类的项。在平面波截断为 $G_{\\text{cut}}$ 的情况下，差分矢量 $G-G'$ 的大小可以达到 $2G_{\\text{cut}}$。对于势矩阵元 $\\langle G'|V|G\\rangle = \\int V(x) e^{-i(G-G')x} dx$，网格必须足够精细，以便在没有显著混叠的情况下表示高达 $2G_{\\text{cut}}$ 的振荡以及势 $V(x)$ 的傅里叶分量。网格的奈奎斯特频率 $G_{\\text{Nyq}} = \\pi N/L$ 必须大于被变换量的最大频率成分。一个常见的经验法则是使用能够表示密度的网格，这涉及高达 $2G_{\\text{cut}}$ 的频率。有时，对于具有尖锐特征的势，需要更密集的网格。“$3/2$ 规则”是在某些情况下使用的一种启发式方法，用于在 FFT 之前填充数组，以完全消除二次量的混叠。在这个问题中，我们将直接测试这个原理。\n\n现在，我们着手实现，它被构造成四个测试用例来验证这些概念。\n\n- **情况 A（参考）**：两次力的计算都使用解析的、无混叠的倒易空间哈密顿量。预计这将是一致的。\n- **情况 B（足够网格）**：两次计算都使用精细的实空间网格（$N=128$），这足以准确地表示哈密顿量。预计将保持一致性。\n- **情况 C（不匹配）**：Hellmann-Feynman 力使用粗糙网格（$N=32$），而能量导数使用精确的倒易空间哈密顿量。变分一致性被破坏，预计会出现不匹配。\n- **情况 D（一致但粗糙）**：两次计算都使用相同的粗糙网格（$N=32$）。虽然绝对结果可能不准确，但这两种计算力的方法应该彼此一致。\n\n实现将根据问题定义构建哈密顿矩阵，求解所得的本征问题以获得基态，并为每种情况计算力以验证这些预测。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to demonstrate and test the Hellmann-Feynman theorem.\n    \"\"\"\n    \n    # --- Model Parameters (atomic units) ---\n    L = 20.0       # Cell length\n    G_cut = 2.5    # Plane-wave kinetic energy cutoff\n    V0 = 2.0       # Pseudopotential amplitude\n    sigma = 1.0    # Pseudopotential width\n    R0 = 5.3       # Nuclear position\n    h = 1.0e-4     # Central-difference step\n    tau = 1.0e-5   # Tolerance for comparison\n\n    # --- Test Case Definitions ---\n    # (N_hf, N_fd): Grid points for Hellmann-Feynman and Finite-Difference calculations.\n    # None indicates using the exact reciprocal-space representation.\n    test_cases_params = [\n        ('Case A (reciprocal only)', None, None),\n        ('Case B (grid, adequately resolved)', 128, 128),\n        ('Case C (mismatched, inconsistent)', 32, None),\n        ('Case D (grid, undersampled but consistent)', 32, 32),\n    ]\n\n    # --- Generate Plane-Wave Basis ---\n    n_max = int(np.floor(G_cut * L / (2.0 * np.pi)))\n    G_vec = (2.0 * np.pi / L) * np.arange(-n_max, n_max + 1)\n    T_matrix = 0.5 * np.diag(G_vec**2)\n    \n    # --- Helper Functions ---\n\n    def _get_periodic_potential(x_grid, R):\n        \"\"\"Calculates V(x;R) on a grid, handling periodic images of the potential.\"\"\"\n        # Find the distance to the nearest periodic image of R for each x\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        return -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n\n    def _get_periodic_potential_derivative(x_grid, R):\n        \"\"\"Calculates dV(x;R)/dR on a grid.\"\"\"\n        dist = x_grid - R\n        dist_periodic = dist - L * np.round(dist / L)\n        V_val = -V0 * np.exp(-dist_periodic**2 / (2.0 * sigma**2))\n        # d/dR = -d/dx\n        # d/dR exp(-(x-R)^2 / 2*sigma^2) = exp(...) * -(x-R)/sigma^2 * (-1)\n        # So it is V(x;R) * (x_periodic - R) / sigma^2, but our x is x_grid, R is R.\n        # The relevant distance is dist_periodic = x_grid - R_eff\n        # So dV/dR = V * (x - R_eff) / sigma^2 is incorrect. Chain rule:\n        # d/dR V(x;R) = -(-1/sigma^2)(x-R_eff) * V(x;R) = V(x;R) * (x-R_eff)/sigma^2\n        # where R_eff is the periodic image of R closest to x. So x-R_eff = dist_periodic\n        return V_val * dist_periodic / sigma**2\n        \n    def build_hamiltonian(R, N):\n        \"\"\"Constructs the Hamiltonian matrix H(R) = T + V(R).\"\"\"\n        num_basis = len(G_vec)\n        V_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        # Create a mesh of q = G - G' vectors\n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # For a single Gaussian per cell, Fourier transform is V(q) = -V0 * sqrt(2*pi*sigma^2) * exp(-sigma^2*q^2/2)\n            # The potential V(x;R) is a sum of Gaussians (a Gaussian comb).\n            # Its Fourier transform is a comb of Gaussians in reciprocal space.\n            # V(q) = (2pi/L) * sum_G' V_G' delta(q-G')\n            # V_G = (1/L) * Integral[ V(x)exp(-iGx) ] dx\n            # V_G for a single Gaussian at R: (1/L) * [-V0 * sqrt(2*pi*sigma^2) * exp(-iGR) * exp(-sigma^2*G^2/2)]\n            # Here V_GG' is the FT of V(x) evaluated at q = G-G'\n            # Let's use the FT of a single Gaussian potential located at R:\n            # I_V(q) = Integral[ -V0*exp(-(x-R)^2/(2*sigma^2)) * exp(-iqx) ] dx\n            # = -V0 * exp(-iqR) * Integral[ exp(-u^2/(2*sigma^2)) * exp(-iqu) ] du, u=x-R\n            # = -V0 * exp(-iqR) * sqrt(2*pi*sigma^2) * exp(-sigma^2*q^2/2)\n            # In a periodic cell, the potential matrix element is (1/L) * this value if we sum over reciprocal lattice vectors.\n            # The problem asks for V_GG' for the comb, which is the sum over m.\n            # This is equivalent to sampling the single-gaussian FT at q=G-G'.\n            # The problem's real-space formula gives V_GG' = (1/L) * I_V(q). The code should match this convention.\n            v_analytic_single_gauss = -V0 * np.sqrt(2 * np.pi * sigma**2) * np.exp(-1j * q_mesh * R) * \\\n                                      np.exp(-0.5 * sigma**2 * q_mesh**2)\n            V_matrix = (1 / L) * v_analytic_single_gauss\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            v_real = _get_periodic_potential(x_grid, R)\n            \n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            v_fourier = exp_term @ v_real\n            V_matrix = (1 / N) * v_fourier.reshape(num_basis, num_basis)\n            \n        return T_matrix + V_matrix\n\n    def get_ground_state(H):\n        \"\"\"Solves the eigenproblem for the ground state.\"\"\"\n        eigvals, eigvecs = np.linalg.eigh(H)\n        ground_energy = eigvals[0]\n        ground_state_vec = eigvecs[:, 0]\n        return ground_energy, ground_state_vec\n\n    def compute_hf_force(R, c_vec, N):\n        \"\"\"Computes the Hellmann-Feynman force.\"\"\"\n        num_basis = len(G_vec)\n        dV_dR_matrix = np.zeros((num_basis, num_basis), dtype=np.complex128)\n        \n        G_prime_mesh, G_mesh = np.meshgrid(G_vec, G_vec)\n        q_mesh = G_mesh - G_prime_mesh\n        \n        if N is None: # Reciprocal-space route\n            # dV_GG'/dR = -iq * V_GG'\n            v_analytic_single_gauss = -V0 * np.sqrt(2 * np.pi * sigma**2) * np.exp(-1j * q_mesh * R) * \\\n                                      np.exp(-0.5 * sigma**2 * q_mesh**2)\n            dV_dR_matrix = (1 / L) * (-1j * q_mesh * v_analytic_single_gauss)\n        else: # Real-space grid route\n            x_grid = np.linspace(0, L, N, endpoint=False)\n            dv_dr_real = _get_periodic_potential_derivative(x_grid, R)\n            \n            exp_term = np.exp(-1j * np.outer(q_mesh.flatten(), x_grid))\n            dv_dr_fourier = exp_term @ dv_dr_real\n            dV_dR_matrix = (1 / N) * dv_dr_fourier.reshape(num_basis, num_basis)\n\n        force = -np.vdot(c_vec, dV_dR_matrix @ c_vec)\n        return force.real\n\n    def run_case(N_hf, N_fd):\n        \"\"\"Runs a single test case comparing HF and FD forces.\"\"\"\n        # 1. Compute Hellmann-Feynman force at R0\n        H_hf = build_hamiltonian(R0, N_hf)\n        _, c0 = get_ground_state(H_hf)\n        f_hf = compute_hf_force(R0, c0, N_hf)\n        \n        # 2. Compute Finite Difference force around R0\n        H_plus = build_hamiltonian(R0 + h, N_fd)\n        E_plus, _ = get_ground_state(H_plus)\n        \n        H_minus = build_hamiltonian(R0 - h, N_fd)\n        E_minus, _ = get_ground_state(H_minus)\n        \n        f_fd = -(E_plus - E_minus) / (2.0 * h)\n        \n        # 3. Compare and return boolean\n        is_consistent = np.abs(f_hf - f_fd)  tau\n        return is_consistent\n\n    # --- Execute Test Cases ---\n    results = []\n    for _, N_hf, N_fd in test_cases_params:\n        # Correcting problem description's DFT normalization factor in code\n        # The problem states V_GG' approx (L/N)*sum(...). So I used (L/N) originally.\n        # However, the standard discrete Fourier transform for matrix elements is (1/N)*sum(...)\n        # if the potential is defined on the cell volume L.\n        # Let's check consistency. The analytic V_GG' is (1/L)*Integral, and Integral approx L/N * sum. So V_GG' approx (1/N) * sum.\n        # The python code was adjusted to reflect this standard (1/N) convention for consistency.\n        result = run_case(N_hf, N_fd)\n        results.append(str(result))\n        \n    print(f\"[{','.join(results)}]\")\n\n# There was a slight ambiguity in the normalization factor (L/N vs 1/N) in the problem statement's\n# approximation for V_GG'. The code uses the standard (1/N) convention for constructing matrix elements\n# from real-space grids, which is consistent with the analytic (1/L)*Integral form in the limit.\n# The `solve()` function is defined but not called, so it can be imported. To run standalone,\n# we add the following:\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}