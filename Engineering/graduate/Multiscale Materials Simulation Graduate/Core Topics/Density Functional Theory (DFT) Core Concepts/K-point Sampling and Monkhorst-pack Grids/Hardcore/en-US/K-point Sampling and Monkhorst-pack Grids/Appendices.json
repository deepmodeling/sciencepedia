{
    "hands_on_practices": [
        {
            "introduction": "The first step in any electronic structure calculation for a periodic solid is the transition from the real-space crystal lattice to its reciprocal-space counterpart, which forms the domain for Brillouin zone integration. This fundamental exercise () bridges this gap by tasking you with deriving the reciprocal lattice vectors for a hexagonal system, a common and important crystal structure. By then constructing a Monkhorst-Pack grid from first principles, you will solidify your understanding of how these uniform sampling meshes are defined and generated.",
            "id": "3818403",
            "problem": "Consider a three-dimensional hexagonal Bravais lattice with conventional cell parameters given by lengths $a$, $a$, and $c$ along lattice vectors $\\mathbf{a}_{1}$, $\\mathbf{a}_{2}$, and $\\mathbf{a}_{3}$, respectively, and interaxial angles $(90^\\circ, 90^\\circ, 120^\\circ)$. Take a Cartesian embedding in which the direct-space primitive vectors are\n$$\n\\mathbf{a}_{1} = a\\,(1,0,0),\\quad \\mathbf{a}_{2} = a\\left(\\frac{1}{2}, \\frac{\\sqrt{3}}{2}, 0\\right),\\quad \\mathbf{a}_{3} = c\\,(0,0,1).\n$$\nStarting from the fundamental definition of the reciprocal lattice, namely that the reciprocal primitive vectors $\\mathbf{b}_{i}$ satisfy $\\mathbf{a}_{i}\\cdot \\mathbf{b}_{j} = 2\\pi\\,\\delta_{ij}$, perform the following:\n\n1) Derive the reciprocal lattice primitive vectors $\\mathbf{b}_{1}$, $\\mathbf{b}_{2}$, and $\\mathbf{b}_{3}$ in Cartesian components.\n\n2) Using first principles for uniform sampling in the Brillouin zone with inversion symmetry and periodic boundary conditions, explicitly construct the fractional-coordinate set for a $6\\times 6\\times 4$ Monkhorst-Pack (MP) grid. Here, “fractional coordinates” means coefficients $(u_{1},u_{2},u_{3})$ in the expansion $\\mathbf{k}=u_{1}\\mathbf{b}_{1}+u_{2}\\mathbf{b}_{2}+u_{3}\\mathbf{b}_{3}$. Provide the one-dimensional fractional lists along each reciprocal basis direction and specify that the full grid is their Cartesian product; you do not need to enumerate all points individually.\n\n3) Let $V_{\\text{BZ}}$ denote the Brillouin-zone volume of the primitive reciprocal cell and let $N_{k}=6\\times 6\\times 4$. Assuming uniform weights over the MP grid, compute the per-$\\mathbf{k}$ integration weight $w$ defined by $w = V_{\\text{BZ}}/N_{k}$, expressed symbolically in terms of $a$ and $c$. Express your final answer for $w$ in units of inverse cubic length (if $a$ and $c$ are in $\\text{\\AA}$, then $w$ is in $\\text{\\AA}^{-3}$). No numerical values are to be substituted. Provide the final answer as a single simplified analytic expression. Do not round.",
            "solution": "We begin from the definition of the reciprocal lattice. For a set of direct-space primitive vectors $\\{\\mathbf{a}_{1},\\mathbf{a}_{2},\\mathbf{a}_{3}\\}$, the reciprocal primitive vectors $\\{\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3}\\}$ are defined by the relations\n$$\n\\mathbf{a}_{i}\\cdot \\mathbf{b}_{j}=2\\pi\\,\\delta_{ij}.\n$$\nA constructive expression is\n$$\n\\mathbf{b}_{1} = 2\\pi\\,\\frac{\\mathbf{a}_{2}\\times \\mathbf{a}_{3}}{\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times \\mathbf{a}_{3})},\\quad\n\\mathbf{b}_{2} = 2\\pi\\,\\frac{\\mathbf{a}_{3}\\times \\mathbf{a}_{1}}{\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times \\mathbf{a}_{3})},\\quad\n\\mathbf{b}_{3} = 2\\pi\\,\\frac{\\mathbf{a}_{1}\\times \\mathbf{a}_{2}}{\\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times \\mathbf{a}_{3})}.\n$$\nFirst compute the cell volume $ \\Omega $:\n$$\n\\Omega = \\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times \\mathbf{a}_{3}).\n$$\nUsing the given vectors,\n$$\n\\mathbf{a}_{2}\\times \\mathbf{a}_{3} = a\\left(\\frac{1}{2}, \\frac{\\sqrt{3}}{2}, 0\\right)\\times c(0,0,1) = \\left(\\frac{\\sqrt{3}\\,a c}{2}, -\\frac{a c}{2}, 0\\right),\n$$\nso\n$$\n\\Omega = \\mathbf{a}_{1}\\cdot(\\mathbf{a}_{2}\\times \\mathbf{a}_{3}) = a(1,0,0)\\cdot \\left(\\frac{\\sqrt{3}\\,a c}{2}, -\\frac{a c}{2}, 0\\right) = \\frac{\\sqrt{3}}{2}\\,a^{2}c.\n$$\nTherefore,\n$$\n\\mathbf{b}_{1} = 2\\pi\\,\\frac{\\left(\\frac{\\sqrt{3}\\,a c}{2}, -\\frac{a c}{2}, 0\\right)}{\\frac{\\sqrt{3}}{2}\\,a^{2}c} = \\frac{2\\pi}{a}\\left(1, -\\frac{1}{\\sqrt{3}}, 0\\right).\n$$\nNext,\n$$\n\\mathbf{a}_{3}\\times \\mathbf{a}_{1} = c(0,0,1)\\times a(1,0,0) = (0, c a, 0),\n$$\nso\n$$\n\\mathbf{b}_{2} = 2\\pi\\,\\frac{(0, c a, 0)}{\\frac{\\sqrt{3}}{2}\\,a^{2}c} = \\left(0, \\frac{4\\pi}{\\sqrt{3}\\,a}, 0\\right).\n$$\nFinally,\n$$\n\\mathbf{a}_{1}\\times \\mathbf{a}_{2} = a(1,0,0)\\times a\\left(\\frac{1}{2}, \\frac{\\sqrt{3}}{2},0\\right) = \\left(0,0,\\frac{\\sqrt{3}}{2}\\,a^{2}\\right),\n$$\ngiving\n$$\n\\mathbf{b}_{3} = 2\\pi\\,\\frac{\\left(0,0,\\frac{\\sqrt{3}}{2}\\,a^{2}\\right)}{\\frac{\\sqrt{3}}{2}\\,a^{2}c} = \\left(0,0,\\frac{2\\pi}{c}\\right).\n$$\nThus the reciprocal primitive vectors in Cartesian components are\n$$\n\\mathbf{b}_{1} = \\frac{2\\pi}{a}\\left(1, -\\frac{1}{\\sqrt{3}}, 0\\right),\\quad\n\\mathbf{b}_{2} = \\left(0, \\frac{4\\pi}{\\sqrt{3}\\,a}, 0\\right),\\quad\n\\mathbf{b}_{3} = \\left(0, 0, \\frac{2\\pi}{c}\\right).\n$$\n\nWe now construct the fractional-coordinate sets for a Monkhorst-Pack grid of size $6\\times 6\\times 4$. A uniform, inversion-symmetric sampling along a single reciprocal-lattice direction with an even number $N$ of points is obtained by centering the $N$ points symmetrically about the origin at evenly spaced positions that avoid the $\\Gamma$ point. The resulting one-dimensional fractional coordinates $\\{u_{m}\\}$ (defined by $k=u\\,b$ along that direction) are\n$$\nu_{m}=\\frac{2 m - N - 1}{2 N},\\quad m=1,2,\\dots,N.\n$$\nFor $N=6$, this yields\n$$\n\\left\\{-\\frac{5}{12},\\,-\\frac{3}{12},\\,-\\frac{1}{12},\\,\\frac{1}{12},\\,\\frac{3}{12},\\,\\frac{5}{12}\\right\\}\n=\n\\left\\{-\\frac{5}{12},\\,-\\frac{1}{4},\\,-\\frac{1}{12},\\,\\frac{1}{12},\\,\\frac{1}{4},\\,\\frac{5}{12}\\right\\}.\n$$\nFor $N=4$, this yields\n$$\n\\left\\{-\\frac{3}{8},\\,-\\frac{1}{8},\\,\\frac{1}{8},\\,\\frac{3}{8}\\right\\}.\n$$\nTherefore, the $6\\times 6\\times 4$ Monkhorst-Pack grid in fractional coordinates $(u_{1},u_{2},u_{3})$ relative to $(\\mathbf{b}_{1},\\mathbf{b}_{2},\\mathbf{b}_{3})$ is the Cartesian product of the three lists\n$$\nu_{1}\\in \\left\\{-\\frac{5}{12},\\,-\\frac{1}{4},\\,-\\frac{1}{12},\\,\\frac{1}{12},\\,\\frac{1}{4},\\,\\frac{5}{12}\\right\\},\\quad\nu_{2}\\in \\left\\{-\\frac{5}{12},\\,-\\frac{1}{4},\\,-\\frac{1}{12},\\,\\frac{1}{12},\\,\\frac{1}{4},\\,\\frac{5}{12}\\right\\},\\quad\nu_{3}\\in \\left\\{-\\frac{3}{8},\\,-\\frac{1}{8},\\,\\frac{1}{8},\\,\\frac{3}{8}\\right\\}.\n$$\n\nFinally, we compute the per-$\\mathbf{k}$ integration weight $w$. The Brillouin-zone volume for a primitive cell is given by the standard formula\n$$\nV_{\\text{BZ}}=\\frac{(2\\pi)^{3}}{\\Omega},\n$$\nwhere $\\Omega$ is the primitive direct-cell volume. We already found $\\Omega = \\frac{\\sqrt{3}}{2}\\,a^{2}c$. With $N_{k}=6\\times 6\\times 4=144$ uniformly weighted points,\n$$\nw=\\frac{V_{\\text{BZ}}}{N_{k}} = \\frac{(2\\pi)^{3}}{\\Omega\\,N_{k}} = \\frac{8\\pi^{3}}{\\left(\\frac{\\sqrt{3}}{2}\\,a^{2}c\\right)\\cdot 144}.\n$$\nSimplifying,\n$$\nw = \\frac{8\\pi^{3}}{72\\sqrt{3}\\,a^{2}c} = \\frac{\\pi^{3}}{9\\sqrt{3}\\,a^{2}c}.\n$$\nThis $w$ is the reciprocal-space volume associated with each $\\mathbf{k}$-point. If $a$ and $c$ are expressed in $\\text{\\AA}$, then $w$ is in $\\text{\\AA}^{-3}$.",
            "answer": "$$\\boxed{\\frac{\\pi^{3}}{9\\sqrt{3}\\,a^{2}c}}$$"
        },
        {
            "introduction": "Once the method for constructing a k-point grid is established, the next critical question is how to choose its density for optimal efficiency. A common mistake is to apply an isotropic grid (e.g., $N \\times N \\times N$) to a system with an anisotropic crystal lattice. This practice exercise () provides a rigorous analytical framework to understand why this approach is inefficient, allowing you to derive the leading-order integration error and see precisely how it is dominated by the poorest-sampled direction in an anisotropic Brillouin zone.",
            "id": "3818373",
            "problem": "Consider an orthorhombic crystal with primitive direct lattice constants $a_{x}$, $a_{y}$, and $a_{z}$, which generate reciprocal lattice vector magnitudes $G_{x} = \\frac{2\\pi}{a_{x}}$, $G_{y} = \\frac{2\\pi}{a_{y}}$, and $G_{z} = \\frac{2\\pi}{a_{z}}$. The first Brillouin Zone (BZ) is taken as the rectangular domain $[-G_{x}/2,G_{x}/2] \\times [-G_{y}/2,G_{y}/2] \\times [-G_{z}/2,G_{z}/2]$. In electronic-structure calculations such as those in Density Functional Theory (DFT), integrals over the BZ of smooth periodic observables are approximated using a uniform Monkhorst-Pack (MP) grid, which in its simplest form coincides with the composite midpoint rule on the BZ.\n\nAssume the BZ integrand is dominated by its second-order Taylor expansion near the $\\Gamma$ point (i.e., $\\mathbf{k} = \\mathbf{0}$), and is isotropically smooth but anisotropic in curvature:\n$$\nf(\\mathbf{k}) \\approx c + \\alpha_{x} k_{x}^{2} + \\alpha_{y} k_{y}^{2} + \\alpha_{z} k_{z}^{2},\n$$\nwhere $c$, $\\alpha_{x}$, $\\alpha_{y}$, and $\\alpha_{z}$ are constants, and $\\mathbf{k} = (k_{x},k_{y},k_{z})$ ranges over the BZ. The exact integral $I$ of $f(\\mathbf{k})$ over the BZ is defined by\n$$\nI = \\int_{-G_{x}/2}^{G_{x}/2} \\int_{-G_{y}/2}^{G_{y}/2} \\int_{-G_{z}/2}^{G_{z}/2} f(\\mathbf{k}) \\, \\mathrm{d}k_{x}\\,\\mathrm{d}k_{y}\\,\\mathrm{d}k_{z}.\n$$\n\nNow approximate $I$ using an $N \\times N \\times N$ Monkhorst-Pack grid with the same $N$ along each direction, i.e., a composite midpoint rule with step sizes $\\Delta k_{x} = G_{x}/N$, $\\Delta k_{y} = G_{y}/N$, and $\\Delta k_{z} = G_{z}/N$, and grid points located at\n$$\nk_{x,i} = -\\frac{G_{x}}{2} + \\left(i + \\frac{1}{2}\\right)\\Delta k_{x}, \\quad\nk_{y,j} = -\\frac{G_{y}}{2} + \\left(j + \\frac{1}{2}\\right)\\Delta k_{y}, \\quad\nk_{z,\\ell} = -\\frac{G_{z}}{2} + \\left(\\ell + \\frac{1}{2}\\right)\\Delta k_{z},\n$$\nfor $i,j,\\ell \\in \\{0,1,\\dots,N-1\\}$. Denote this numerical approximation by $I_{N}$:\n$$\nI_{N} = \\Delta k_{x}\\Delta k_{y}\\Delta k_{z} \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} \\sum_{\\ell=0}^{N-1} f(k_{x,i},k_{y,j},k_{z,\\ell}).\n$$\n\nStarting from the definition of the integral, the grid, and the composite midpoint rule, derive the leading-order integration error $E_{N} = I - I_{N}$ in closed form as a function of $G_{x}$, $G_{y}$, $G_{z}$, $N$, $\\alpha_{x}$, $\\alpha_{y}$, $\\alpha_{z}$, and $c$. Show explicitly how using the same $N$ along all reciprocal directions leads to uneven resolution when $G_{x}$, $G_{y}$, and $G_{z}$ are highly anisotropic, and quantify this anisotropy in the final error expression.\n\nProvide your final answer as a single closed-form analytic expression for $E_{N}$. No numerical rounding is required, and no units are needed.",
            "solution": "The integration error is defined as $E_{N} = I - I_{N}$. The derivation proceeds by first calculating the exact integral $I$, then the numerical approximation $I_{N}$, and finally their difference.\n\n**1. Calculation of the Exact Integral $I$**\n\nThe integrand is $f(\\mathbf{k}) = c + \\alpha_{x} k_{x}^{2} + \\alpha_{y} k_{y}^{2} + \\alpha_{z} k_{z}^{2}$. The integral $I$ over the BZ is separable:\n$$\nI = \\int_{BZ} (c + \\alpha_{x} k_{x}^{2} + \\alpha_{y} k_{y}^{2} + \\alpha_{z} k_{z}^{2}) \\, \\mathrm{d}^{3}k\n$$\nWe can evaluate each term separately. The integral of the constant $c$ over the BZ volume $V_{BZ} = G_{x}G_{y}G_{z}$ is:\n$$\n\\int_{BZ} c \\, \\mathrm{d}^{3}k = c V_{BZ} = c G_{x}G_{y}G_{z}\n$$\nThe integral of the term $\\alpha_{x} k_{x}^{2}$ is:\n$$\n\\int_{BZ} \\alpha_{x} k_{x}^{2} \\, \\mathrm{d}^{3}k = \\alpha_{x} \\left( \\int_{-G_{x}/2}^{G_{x}/2} k_{x}^{2} \\, \\mathrm{d}k_{x} \\right) \\left( \\int_{-G_{y}/2}^{G_{y}/2} \\mathrm{d}k_{y} \\right) \\left( \\int_{-G_{z}/2}^{G_{z}/2} \\mathrm{d}k_{z} \\right)\n$$\nThe 1D integral of $k_{x}^{2}$ is:\n$$\n\\int_{-G_{x}/2}^{G_{x}/2} k_{x}^{2} \\, \\mathrm{d}k_{x} = \\left[\\frac{k_{x}^{3}}{3}\\right]_{-G_{x}/2}^{G_{x}/2} = \\frac{1}{3} \\left( \\left(\\frac{G_{x}}{2}\\right)^{3} - \\left(-\\frac{G_{x}}{2}\\right)^{3} \\right) = \\frac{1}{3} \\left( \\frac{G_{x}^{3}}{8} + \\frac{G_{x}^{3}}{8} \\right) = \\frac{G_{x}^{3}}{12}\n$$\nThus, the integral of the $\\alpha_{x} k_{x}^{2}$ term is $\\alpha_{x} (\\frac{G_{x}^{3}}{12}) G_{y} G_{z}$. By symmetry, the integrals for the $y$ and $z$ components are analogous. Summing all terms, the exact integral $I$ is:\n$$\nI = c G_{x}G_{y}G_{z} + \\frac{\\alpha_{x} G_{x}^{3} G_{y} G_{z}}{12} + \\frac{\\alpha_{y} G_{x} G_{y}^{3} G_{z}}{12} + \\frac{\\alpha_{z} G_{x} G_{y} G_{z}^{3}}{12}\n$$\n$$\nI = G_{x}G_{y}G_{z} \\left( c + \\frac{1}{12}(\\alpha_{x} G_{x}^{2} + \\alpha_{y} G_{y}^{2} + \\alpha_{z} G_{z}^{2}) \\right)\n$$\n\n**2. Calculation of the Numerical Approximation $I_{N}$**\n\nThe numerical integral $I_{N}$ is given by:\n$$\nI_{N} = \\Delta k_{x}\\Delta k_{y}\\Delta k_{z} \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} \\sum_{\\ell=0}^{N-1} f(k_{x,i}, k_{y,j}, k_{z,\\ell})\n$$\nThe volume element is $\\Delta k_{x}\\Delta k_{y}\\Delta k_{z} = (\\frac{G_{x}}{N})(\\frac{G_{y}}{N})(\\frac{G_{z}}{N}) = \\frac{G_{x}G_{y}G_{z}}{N^{3}}$. Substituting the expression for $f(\\mathbf{k})$:\n$$\n\\sum_{i,j,\\ell} f = \\sum_{i,j,\\ell} (c + \\alpha_{x} k_{x,i}^{2} + \\alpha_{y} k_{y,j}^{2} + \\alpha_{z} k_{z,\\ell}^{2})\n$$\nThe sum is also separable. The sum over the constant term $c$ is $\\sum_{i,j,\\ell} c = c \\sum_{i=0}^{N-1} 1 \\sum_{j=0}^{N-1} 1 \\sum_{\\ell=0}^{N-1} 1 = c N^{3}$.\nThe contribution to $I_{N}$ from the constant term is $(\\frac{G_{x}G_{y}G_{z}}{N^{3}}) (c N^{3}) = c G_{x}G_{y}G_{z}$. This is identical to the corresponding term in $I$, as the midpoint rule integrates constant functions exactly.\n\nNow consider the $\\alpha_{x}k_{x}^{2}$ term. Its contribution to the sum is:\n$$\n\\sum_{i,j,\\ell} \\alpha_{x} k_{x,i}^{2} = \\alpha_{x} \\left(\\sum_{i=0}^{N-1} k_{x,i}^{2}\\right) \\left(\\sum_{j=0}^{N-1} 1\\right) \\left(\\sum_{\\ell=0}^{N-1} 1\\right) = \\alpha_{x} N^{2} \\sum_{i=0}^{N-1} k_{x,i}^{2}\n$$\nTo evaluate this, we need the sum $\\sum_{i=0}^{N-1} k_{x,i}^{2}$. The grid points are $k_{x,i} = -\\frac{G_{x}}{2} + (i + \\frac{1}{2})\\frac{G_{x}}{N} = \\frac{G_{x}}{2N}(-N + 2i + 1)$.\nThe sum of squares is:\n$$\n\\sum_{i=0}^{N-1} k_{x,i}^{2} = \\sum_{i=0}^{N-1} \\left( \\frac{G_{x}}{2N} \\right)^{2} (-N + 1 + 2i)^{2} = \\frac{G_{x}^{2}}{4N^{2}} \\sum_{i=0}^{N-1} (-N+1+2i)^{2}\n$$\nThe sum is over the squares of an arithmetic progression. Let's evaluate this sum:\n$$\n\\sum_{i=0}^{N-1} (-N+1+2i)^{2} = \\sum_{i=0}^{N-1} ((-N+1)^{2} + 4i(-N+1) + 4i^{2})\n$$\n$$\n= N(-N+1)^{2} + 4(-N+1)\\sum_{i=0}^{N-1} i + 4\\sum_{i=0}^{N-1} i^{2}\n$$\nUsing the standard formulas for sums of powers, $\\sum_{i=0}^{N-1} i = \\frac{(N-1)N}{2}$ and $\\sum_{i=0}^{N-1} i^{2} = \\frac{(N-1)N(2N-1)}{6}$:\n$$\n= N(N-1)^{2} + 4(1-N)\\frac{N(N-1)}{2} + 4\\frac{(N-1)N(2N-1)}{6}\n$$\n$$\n= N(N-1)^{2} - 2N(N-1)^{2} + \\frac{2N(N-1)(2N-1)}{3} = -N(N-1)^{2} + \\frac{2N(N-1)(2N-1)}{3}\n$$\n$$\n= N(N-1)\\left[-(N-1) + \\frac{2(2N-1)}{3}\\right] = N(N-1)\\left[\\frac{-3N+3+4N-2}{3}\\right]\n$$\n$$\n= N(N-1)\\frac{N+1}{3} = \\frac{N(N^{2}-1)}{3}\n$$\nSubstituting this back, we get:\n$$\n\\sum_{i=0}^{N-1} k_{x,i}^{2} = \\frac{G_{x}^{2}}{4N^{2}} \\frac{N(N^{2}-1)}{3} = \\frac{G_{x}^{2}(N^{2}-1)}{12N}\n$$\nThe total contribution to $I_{N}$ from the $\\alpha_{x}$ term is:\n$$\n(\\frac{G_{x}G_{y}G_{z}}{N^{3}}) \\left(\\alpha_{x} N^{2} \\frac{G_{x}^{2}(N^{2}-1)}{12N}\\right) = \\frac{\\alpha_{x} G_{x}^{3} G_{y} G_{z} (N^{2}-1)}{12N^{2}}\n$$\nSumming up all terms for $I_{N}$:\n$$\nI_{N} = c G_{x}G_{y}G_{z} + \\frac{\\alpha_{x} G_{x}^{3} G_{y} G_{z} (N^{2}-1)}{12N^{2}} + \\frac{\\alpha_{y} G_{x} G_{y}^{3} G_{z} (N^{2}-1)}{12N^{2}} + \\frac{\\alpha_{z} G_{x} G_{y} G_{z}^{3} (N^{2}-1)}{12N^{2}}\n$$\n$$\nI_{N} = G_{x}G_{y}G_{z} \\left( c + \\frac{N^{2}-1}{12N^{2}}(\\alpha_{x} G_{x}^{2} + \\alpha_{y} G_{y}^{2} + \\alpha_{z} G_{z}^{2}) \\right)\n$$\n\n**3. Calculation of the Integration Error $E_{N}$**\n\nThe error is the difference $E_{N} = I - I_{N}$:\n$$\nE_{N} = G_{x}G_{y}G_{z} \\left( c + \\frac{1}{12} \\sum_{j=x,y,z} \\alpha_{j}G_{j}^{2} \\right) - G_{x}G_{y}G_{z} \\left( c + \\frac{N^{2}-1}{12N^{2}} \\sum_{j=x,y,z} \\alpha_{j}G_{j}^{2} \\right)\n$$\nThe constant term $c$ cancels. The remaining terms give:\n$$\nE_{N} = \\frac{G_{x}G_{y}G_{z}}{12} \\left( \\sum_{j=x,y,z} \\alpha_{j}G_{j}^{2} \\right) \\left( 1 - \\frac{N^{2}-1}{N^{2}} \\right)\n$$\n$$\nE_{N} = \\frac{G_{x}G_{y}G_{z}}{12} \\left( \\alpha_{x}G_{x}^{2} + \\alpha_{y}G_{y}^{2} + \\alpha_{z}G_{z}^{2} \\right) \\left( \\frac{N^{2} - (N^{2}-1)}{N^{2}} \\right)\n$$\n$$\nE_{N} = \\frac{G_{x}G_{y}G_{z}}{12N^{2}} (\\alpha_{x} G_{x}^{2} + \\alpha_{y} G_{y}^{2} + \\alpha_{z} G_{z}^{2})\n$$\n\n**4. Analysis of the Error Term and Anisotropy**\n\nThe final error expression is $E_{N} = \\frac{V_{BZ}}{12N^{2}} \\sum_{j=x,y,z} \\alpha_{j}G_{j}^{2}$. This expression explicitly quantifies how the choice of a uniform grid with $N$ points in each direction interacts with the anisotropy of the Brillouin zone.\n\nThe step sizes along each reciprocal axis are $\\Delta k_{x} = G_{x}/N$, $\\Delta k_{y} = G_{y}/N$, and $\\Delta k_{z} = G_{z}/N$. If the reciprocal lattice is anisotropic (e.g., $G_{x} \\gg G_{y}$), then the step sizes will also be anisotropic ($\\Delta k_{x} \\gg \\Delta k_{y}$). This signifies an \"uneven resolution\": the sampling is much coarser in the direction with the larger reciprocal lattice vector magnitude.\n\nThis uneven resolution is directly reflected in the error formula. The total error $E_{N}$ is a sum of contributions from each direction, where the contribution from direction $j$ is proportional to $\\alpha_{j}G_{j}^{2}$. The $G_{j}^{2}$ dependence means that the error is highly sensitive to the largest dimension of the Brillouin zone. If one dimension, say $G_{x}$, is significantly larger than the others, its corresponding term, $\\frac{V_{BZ}}{12N^{2}}\\alpha_{x}G_{x}^{2}$, will dominate the total error. Therefore, the integration accuracy is limited by the sampling along the \"longest\" BZ direction. This demonstrates that using an equal number of k-points $N$ in each direction is an inefficient strategy for anisotropic systems, as the error is controlled by the worst-sampled direction. A more efficient scheme would involve choosing the number of points in each direction ($N_{x}, N_{y}, N_{z}$) such that the step sizes are approximately equal, which implies $N_{j} \\propto G_{j}$.",
            "answer": "$$\n\\boxed{\\frac{G_x G_y G_z}{12 N^2}(\\alpha_x G_x^2 + \\alpha_y G_y^2 + \\alpha_z G_z^2)}\n$$"
        },
        {
            "introduction": "Achieving convergence with respect to k-point sampling is a nuanced goal, as different physical properties can exhibit vastly different convergence rates. Quantities that are derivatives of the total energy, such as forces and stresses, are often more sensitive to the fine details of the electronic structure and thus converge more slowly. This numerical experiment () allows you to directly investigate this phenomenon, comparing the convergence of total energy against a stress proxy to gain practical insight into why calculating derivatives often requires a significantly denser k-point mesh.",
            "id": "3818436",
            "problem": "Consider a two-dimensional square Brillouin zone with side length $2\\pi$ (angles measured in radians). In the independent-electron picture consistent with Bloch's theorem, the total energy per primitive cell can be expressed as a Brillouin-zone average of the occupied band energies. Sampling this average with a uniform reciprocal-space grid is standard; the Monkhorst-Pack (MP) grid assigns $N$ points per direction with coordinates given by $k_i = 2\\pi\\left(\\frac{2n - N - 1}{2N}\\right)$ for $n = 1, 2, \\dots, N$, ensuring symmetry and equal weights. For a tight-binding model with an anisotropic hopping perturbation representing a homogeneous strain, define the band dispersion\n$$\n\\varepsilon(\\mathbf{k}; s) = -2t(1+s)\\cos(k_x) - 2t(1-s)\\cos(k_y) + d\\left[\\cos(2k_x) - \\cos(2k_y)\\right],\n$$\nwhere $t$ is the baseline nearest-neighbor hopping, $d$ is a smaller next-nearest harmonic term that breaks square symmetry, and $s$ is a dimensionless strain-like parameter that perturbs the hopping anisotropically along $x$ and $y$. Occupations are given by a finite-temperature Fermi-Dirac function\n$$\nf_T\\left(\\varepsilon; E_F, T\\right) = \\frac{1}{1 + \\exp\\left(\\frac{\\varepsilon - E_F}{T}\\right)},\n$$\nwith Fermi energy $E_F$ and temperature $T$, both dimensionless in the chosen units. Using these definitions, the total energy per cell is approximated on an $N \\times N$ MP grid as the uniform average\n$$\n\\mathcal{E}(N; s) = \\left\\langle \\varepsilon(\\mathbf{k}; s)\\,f_T\\left(\\varepsilon(\\mathbf{k}; s); E_F, T\\right) \\right\\rangle_{N\\times N},\n$$\nand a stress proxy aligned with the $x$-direction is defined by the symmetric finite-difference derivative with respect to $s$,\n$$\n\\tilde{\\sigma}_{xx}(N) = \\frac{\\mathcal{E}(N; s) - \\mathcal{E}(N; -s)}{2s}.\n$$\nThis quantity is proportional to the derivative of the energy with respect to a homogeneous anisotropic strain and serves as a dimensionless proxy for a stress component. It is known in practical electronic-structure calculations that stresses can converge more slowly with respect to $k$-point sampling than energies, especially in metallic systems, because derivatives accentuate $k$-space features near the Fermi surface.\n\nYour task is to design and implement a convergence test that compares the $k$-point convergence of the total energy at zero strain and the stress proxy defined above. Use the following scientifically plausible parameter values: $t = 1$, $d = 0.3$, $E_F = 0$, $T = 0.02$, and $s = 0.01$. All quantities are dimensionless. Angles must be treated in radians. For the MP grid, use the coordinate formula above for each direction. Compute two quantities on each test grid $N \\times N$:\n- $E_0(N) = \\mathcal{E}(N; 0)$,\n- $\\tilde{\\sigma}_{xx}(N)$ as given.\n\nDefine a high-resolution reference computed on a dense grid with $N_{\\text{ref}} = 401$ in each direction:\n- $E_0^{\\text{ref}} = \\mathcal{E}(N_{\\text{ref}}; 0)$,\n- $\\tilde{\\sigma}_{xx}^{\\text{ref}} = \\tilde{\\sigma}_{xx}(N_{\\text{ref}})$.\n\nFor each test grid size $N$ in the set $\\{1, 4, 8, 16, 32\\}$, calculate the absolute errors\n$$\n\\Delta E(N) = \\left|E_0(N) - E_0^{\\text{ref}}\\right|, \\quad \\Delta \\sigma(N) = \\left|\\tilde{\\sigma}_{xx}(N) - \\tilde{\\sigma}_{xx}^{\\text{ref}}\\right|.\n$$\nFor each $N$, output a boolean indicating whether the stress proxy error strictly exceeds the energy error, i.e., whether $\\Delta \\sigma(N) > \\Delta E(N)$.\n\nTest Suite and Coverage:\n- Include $N = 1$ to represent the boundary case of a single $k$-point at the zone center.\n- Include $N = 4$ and $N = 8$ as coarse grids.\n- Include $N = 16$ and $N = 32$ as progressively finer grids.\nThese cases probe the \"happy path\" of systematic refinement, a boundary case, and intermediate coarse sampling where metallic features are under-resolved.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with entries ordered by $N$ ascending, e.g., $[b_1,b_2,b_3,b_4,b_5]$, where each $b_i$ is either $True$ or $False$. No other text should be printed. All computations are to be carried out in the dimensionless system specified above; no physical units appear in the output.",
            "solution": "The solution involves a numerical implementation of the model described. For each grid size $N$ in the test set $\\{1, 4, 8, 16, 32\\}$ and for a high-density reference grid ($N_{\\text{ref}}=401$), the following steps are performed:\n1.  A $N \\times N$ Monkhorst-Pack k-point grid is generated in the 2D Brillouin zone using the specified formula.\n2.  For each point on the grid, the band energy $\\varepsilon(\\mathbf{k}; s)$ is calculated using the given tight-binding formula for strain values $s=0, s=0.01,$ and $s=-0.01$.\n3.  The occupation of each state is determined using the Fermi-Dirac distribution with the specified Fermi energy $E_F$ and temperature $T$.\n4.  The total energy per cell, $\\mathcal{E}(N; s)$, is computed by averaging the product of the band energy and its occupation over all points on the grid.\n5.  The zero-strain energy $E_0(N)$ is simply $\\mathcal{E}(N; s=0)$. The stress proxy $\\tilde{\\sigma}_{xx}(N)$ is calculated from $\\mathcal{E}(N; s=0.01)$ and $\\mathcal{E}(N; s=-0.01)$ using the provided finite-difference formula.\n6.  The absolute errors, $\\Delta E(N)$ and $\\Delta \\sigma(N)$, are calculated by comparing the results for each test grid $N$ against the high-resolution reference values.\n7.  Finally, for each $N$, the boolean condition $\\Delta \\sigma(N) > \\Delta E(N)$ is evaluated to determine if the stress proxy error is larger than the energy error.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of comparing the k-point convergence of total energy and a stress proxy\n    for a 2D tight-binding model.\n    \"\"\"\n\n    # Define the physical and numerical parameters from the problem statement.\n    t = 1.0\n    d = 0.3\n    E_F = 0.0\n    T = 0.02\n    s = 0.01\n\n    # Define the set of N values for the test grids and the reference grid.\n    test_N_values = [1, 4, 8, 16, 32]\n    N_ref = 401\n    \n    def generate_k_grid(N):\n        \"\"\"Generates a 2D Monkhorst-Pack k-point grid.\"\"\"\n        if N == 0:\n            return np.array([]), np.array([])\n        n_vals = np.arange(1, N + 1, dtype=np.float64)\n        k_1d = 2.0 * np.pi * (2.0 * n_vals - N - 1.0) / (2.0 * N)\n        kx, ky = np.meshgrid(k_1d, k_1d)\n        return kx, ky\n\n    def calculate_total_energy(N, s_val, t_p, d_p, EF_p, T_p):\n        \"\"\"\n        Calculates the total energy per primitive cell on an N x N MP grid\n        for a given strain parameter s_val.\n        \"\"\"\n        if N == 0:\n            return 0.0\n        \n        kx, ky = generate_k_grid(N)\n        \n        # Calculate band dispersion epsilon(k; s)\n        cos_kx = np.cos(kx)\n        cos_ky = np.cos(ky)\n        cos_2kx = np.cos(2 * kx)\n        cos_2ky = np.cos(2 * ky)\n        \n        eps = -2.0 * t_p * (1.0 + s_val) * cos_kx - 2.0 * t_p * (1.0 - s_val) * cos_ky \\\n              + d_p * (cos_2kx - cos_2ky)\n\n        # Calculate Fermi-Dirac occupation f_T(epsilon)\n        # Using np.float64 for precision and to handle large exponents safely.\n        exponent = (eps - EF_p) / T_p\n        fd = 1.0 / (1.0 + np.exp(exponent))\n\n        # Calculate the Brillouin zone average of epsilon * f_T\n        integrand = eps * fd\n        total_energy = np.mean(integrand)\n        \n        return total_energy\n\n    # --- Reference Calculation ---\n    # Calculate reference energy E_0^ref = E(N_ref; 0)\n    E0_ref = calculate_total_energy(N_ref, 0.0, t, d, E_F, T)\n    \n    # Calculate quantities for reference stress proxy\n    E_plus_s_ref = calculate_total_energy(N_ref, s, t, d, E_F, T)\n    E_minus_s_ref = calculate_total_energy(N_ref, -s, t, d, E_F, T)\n    sigma_xx_ref = (E_plus_s_ref - E_minus_s_ref) / (2.0 * s)\n\n    results = []\n    \n    # --- Loop over Test Grids ---\n    for N in test_N_values:\n        # Calculate energy E_0(N) = E(N; 0)\n        E0_N = calculate_total_energy(N, 0.0, t, d, E_F, T)\n\n        # Calculate stress proxy sigma_xx(N)\n        E_plus_s_N = calculate_total_energy(N, s, t, d, E_F, T)\n        E_minus_s_N = calculate_total_energy(N, -s, t, d, E_F, T)\n        sigma_xx_N = (E_plus_s_N - E_minus_s_N) / (2.0 * s)\n\n        # Calculate absolute errors\n        delta_E = abs(E0_N - E0_ref)\n        delta_sigma = abs(sigma_xx_N - sigma_xx_ref)\n        \n        # Compare errors and store boolean result\n        results.append(delta_sigma > delta_E)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}