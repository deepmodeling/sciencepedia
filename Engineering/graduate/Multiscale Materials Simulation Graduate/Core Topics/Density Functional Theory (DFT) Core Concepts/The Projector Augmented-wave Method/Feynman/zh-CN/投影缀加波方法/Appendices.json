{
    "hands_on_practices": [
        {
            "introduction": "任何基于密度泛函理论的计算，其结果的可靠性都至关重要。本练习旨在介绍一套系统且科学严谨的方案，用于测试PAW计算中关键数值参数（如平面波截断能和$k$点采样）的收敛性。掌握这套流程是确保模拟数据可复现性和准确性的基础，是每位计算材料学研究者的必备技能 。",
            "id": "3850301",
            "problem": "一个面心立方铝晶体在周期性边界条件下，采用密度泛函理论 (DFT) 和投影缀加波 (PAW) 方法进行模拟。Kohn-Sham (KS) 总能泛函 $E[n]$ 通过对单粒子轨道进行最小化，这些轨道由在波函数截断能 $E_{\\mathrm{cut}}$ 处截断的平面波基组表示。布里渊区 (BZ) 积分通过在一个均匀的 Monkhorst-Pack k点网格上进行离散求和来近似，电荷密度 $n(\\mathbf{r})$ 和势在间距为 $\\Delta x$ 的快速傅里叶变换 (FFT) 实空间网格上表示，这等效于一个与网格分辨率相关的密度截断能 $E_{\\mathrm{den}}$。对于金属体系，分数占据通过宽度为 $\\sigma$ 的展宽处理，在比较计算以分离积分误差时，该值必须保持不变。\n\n要求您针对平面波截断能 $E_{\\mathrm{cut}}$、k点取样密度和 FFT 网格密度（或 $E_{\\mathrm{den}}$），为总能 $E$、Hellmann-Feynman 力 $\\mathbf{F}_i$ 和柯西应力张量 $\\boldsymbol{\\sigma}$ 设计一个系统且科学上合理的收敛性研究。目标容差为：每个原子的总能收敛到 $1 \\mathrm{meV}/\\mathrm{atom}$ 以内，任何原子上的最大力分量在 $0.01 \\text{eV}/\\text{\\AA}$ 以内，以及每个应力分量在 $0.05 \\mathrm{GPa}$ 以内。在收敛性测试期间，晶胞形状和原子位置保持固定，以避免与几何形状变化的耦合，并且假定 PAW 数据集是固定的和可移植的。\n\n从第一性原理出发，考虑以下几点：\n\n- 平面波基组的完备性随 $E_{\\mathrm{cut}}$ 的增加而增加，且 $E(E_{\\mathrm{cut}})$ 相对于轨道所张成的子空间是变分的，而在平面波基组中，力不含 Pulay 项，因为基组不依赖于原子位置。相反，$\\boldsymbol{\\sigma} = \\frac{1}{\\Omega}\\frac{\\partial E}{\\partial \\boldsymbol{\\epsilon}}$ 依赖于应变 $\\boldsymbol{\\epsilon}$，并且会受到 Pulay 应力的影响，因为平面波基组依赖于晶胞度规。\n- 对 $\\mathbf{k}$ 的布里渊区积分是一个数值积分；对于金属，在固定的展宽 $\\sigma$ 下，被积函数足够光滑，因此积分误差会随着 k 点网格的加密而减小。\n- 实空间 FFT 网格决定了 $n(\\mathbf{r})$ 和势的分辨率。由于 $n(\\mathbf{r})$ 包含轨道的乘积，其傅里叶谱延伸到大约两倍的轨道截断频率。在 PAW 方法中，额外的在位（on-site）缀加密度变化剧烈，需要更精细的网格来避免混叠效应。由网格分辨率不足引起的误差不是严格变分的，并且会以非单调的方式影响 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$。\n\n在对金属铝进行的 PAW 计算中，哪种方案能够最稳健且偏差最小地评估 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$ 相对于 $E_{\\mathrm{cut}}$、k点取样和 FFT 网格密度的收敛性？\n\nA. 固定展宽宽度 $\\sigma$，选择一个初始较高的实空间密度截断能 $E_{\\mathrm{den}}$，以使网格至少能表示两倍的波函数带宽，然后：\n- 首先，在一个足够大的 $E_{\\mathrm{cut}}$ 和固定的 $E_{\\mathrm{den}}$下，通过增加均匀的 Monkhorst-Pack 网格 $N\\times N\\times N$来收敛k点网格，监测每个原子的 $\\Delta E$、最大 $|\\mathbf{F}_i|$ 以及 $\\boldsymbol{\\sigma}$ 的每个分量，直到所有量都满足容差要求。\n- 其次，在已收敛的 k 点网格和固定的 $E_{\\mathrm{den}}$下收敛 $E_{\\mathrm{cut}}$，利用 $E(E_{\\mathrm{cut}})$ 的变分行为，并通过将 $E_{\\mathrm{cut}}$ 推得足够高，使 $\\boldsymbol{\\sigma}$ 的变化落在容差范围内，从而减少 Pulay 应力，同时验证力的收敛性（在平面波中没有 Pulay 力）。\n- 最后，在已收敛的 k 点网格和 $E_{\\mathrm{cut}}$下，通过独立于 $E_{\\mathrm{cut}}$ 增加 $E_{\\mathrm{den}}$来收敛 FFT 网格密度，确保缀加电荷和补偿密度得到很好的解析。确认尽管网格混叠具有非变分性质，但 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$ 的变化仍在容差范围内。通过同时略微增加所有三个参数进行最终检查；如果所有量都保持在容差内，则接受这些设置。\n\nB. 通过一个共同的百分比步长（例如，每次迭代将每个参数增加 $10\\%$）同时改变 $E_{\\mathrm{cut}}$、k点密度和 FFT 网格密度，将得到的 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$ 拟合到经验收敛曲线，并在拟合预测达到目标容差时停止。允许展宽宽度 $\\sigma$ 随着 k 点网格的细化而增加，以保持部分占据态的数量固定。\n\nC. 首先仅使用 $\\Gamma$ 点取样来收敛 $E_{\\mathrm{cut}}$以降低计算成本，然后将 $E_{\\mathrm{cut}}$ 固定在该值，并通过设置 $E_{\\mathrm{den}} = E_{\\mathrm{cut}}$ 来收敛 FFT 网格。最后，引入 k 点，并在 k 点网格较粗时增加展宽宽度 $\\sigma$，随着 k 点网格变密而减小 $\\sigma$，当自由能 $F = E - \\sigma S$ 在容差范围内时接受收敛，并假设力和应力会随之收敛。\n\nD. 首先通过设置 $E_{\\mathrm{den}}$ 等于波函数截断能 $E_{\\mathrm{cut}}$并进行细化直到总能稳定来收敛 FFT 网格密度，然后在将 $E_{\\mathrm{cut}}$ 保持在一个适中值以避免 Pulay 应力的同时收敛 k 点网格。最后，在细化 $E_{\\mathrm{cut}}$ 的同时，允许晶胞体积轻微变化，以使平面波的数量大致保持不变，这可以减少应力评估过程中的基组变化。\n\n选择在金属体系的 PAW 平面波计算中，科学上合理且最有可能在指定容差内为 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$ 产生无偏收敛的选项。",
            "solution": "该问题要求在金属铝的投影缀加波 (PAW) 密度泛函理论 (DFT) 计算中，找到一个最稳健且偏差最小的方案，来对总能 $E$、Hellmann-Feynman 力 $\\mathbf{F}_i$ 和柯西应力张量 $\\boldsymbol{\\sigma}$ 进行收敛性研究。需要收敛的参数是平面波截断能 $E_{\\mathrm{cut}}$、k点取样密度，以及由截断能 $E_{\\mathrm{den}}$ 表示的快速傅里叶变换 (FFT) 网格密度。\n\n一个科学上合理的收敛方案必须系统地分离每个数值参数的误差贡献。这通常通过改变一个参数，同时将其他参数固定在足够高的值上以确保它们自身的相关误差可以忽略不计来实现。测试参数的顺序以及与每个计算量（$E$、$\\mathbf{F}_i$、$\\boldsymbol{\\sigma}$）相关的具体挑战至关重要。\n\n让我们建立收敛每个参数的核心原则：\n$1$. **平面波截断能 ($E_{\\mathrm{cut}}$)**: 该参数决定了用于表示 Kohn-Sham 轨道的平面波基组的大小和完备性。根据变分原理，对于给定的哈密顿量，总能 $E$ 是真实基态能量的一个上界，并随着 $E_{\\mathrm{cut}}$ 的增加而单调减小。因此，$E(E_{\\mathrm{cut}})$ 从上方平滑收敛。力 $\\mathbf{F}_i = -\\frac{\\partial E}{\\partial \\mathbf{R}_i}$ 在平面波基组中不受 Pulay 项的影响，因为基函数不依赖于原子位置 $\\mathbf{R}_i$。然而，应力张量 $\\boldsymbol{\\sigma} = \\frac{1}{\\Omega}\\frac{\\partial E}{\\partial \\boldsymbol{\\epsilon}}$（其中 $\\Omega$ 是晶胞体积，$\\boldsymbol{\\epsilon}$ 是应变张量）会受到显著的 Pulay 应力影响。这是因为对晶胞施加应变会改变倒格矢，这反过来又会改变在固定 $E_{\\mathrm{cut}}$ 下包含的平面波集合。这导致应力相对于 $E_{\\mathrm{cut}}$ 的收敛是非单调且缓慢的，通常需要比 $E$ 或 $\\mathbf{F}_i$ 收敛高得多的 $E_{\\mathrm{cut}}$ 才能使 $\\boldsymbol{\\sigma}$ 收敛。\n\n$2$. **k点取样**: 该参数控制对布里渊区 (BZ) 积分的数值近似。对于像铝这样的金属体系，费米面与多个能带相交，使得对占据态的精确积分至关重要。布里渊区积分的误差通常随着 k 点网格密度的增加而减小。对于固定的展宽宽度 $\\sigma > 0$，被积函数被平滑化，从而导致系统性的收敛。对于金属，相对于 k 点的收敛可能会很慢。\n\n$3$. **FFT 网格密度 ($E_{\\mathrm{den}}$)**: FFT 网格用于在实空间中表示电荷密度 $n(\\mathbf{r})$ 和势。由于电荷密度是两个轨道的乘积，$n(\\mathbf{r}) = \\sum_i |\\psi_i(\\mathbf{r})|^2$，其傅里葉表示需要高达轨道频率两倍的分量。用动能来表示，这意味着如果轨道的能量达到 $k_{\\text{max}}^2$，网格必须支持至少 $(2k_{\\text{max}})^2$ 的截斷能。在 PAW 方法中，局域的在位（on-site）缀加电荷密度和补偿电荷的存在（这些对于在原子核附近重建全电子密度是必需的），引入了非常高频的分量。这些尖锐的特征要求比轨道基组截断能 $E_{\\mathrm{cut}}$ 所建议的更精细的 FFT 网格（更高的 $E_{\\mathrm{den}}$），以避免混叠误差。这些误差不是变分的，并且会以不受控制的方式影响 $E$、$\\mathbf{F}_i$ 和 $\\boldsymbol{\\sigma}$。因此，这个参数必须独立收敛，并且在测试其他参数时使用非常密集的网格是最安全的。\n\n$4$. **展宽宽度 ($\\sigma$)**: 这是一个物理参数，它引入一个有效的电子温度以方便对金属进行布里渊区积分。为了研究数值参数（$E_{\\mathrm{cut}}$、k点、$E_{\\mathrm{den}}$）的收敛性，$\\sigma$ 必须保持恒定。改变 $\\sigma$ 会改变被最小化的自由能泛函，从而混淆对数值误差的分析。\n\n基于这些原则，一个稳健的方案涉及顺序的、解耦的收敛性测试。一种常见且有效的策略是从将不太敏感或潜在有污染影响的参数固定在较高的值开始。\n\n**选项评估**\n\n**A.** 该选项提出了一个顺序且系统的方案。\n- 它正确地从固定展宽宽度 $\\sigma$ 和选择一个高的初始密度截断能 $E_{\\mathrm{den}}$ 开始，以最小化混叠误差，从而有效地将 FFT 网格误差与其他测试解耦。\n- 它接着首先收敛 k 点网格，此时使用一个大的（但不一定是最终的）$E_{\\mathrm{cut}}$。这对金属而言是一个稳健的策略，因为布里渊区积分通常是误差的主要来源。\n- 接下来，在使用已收敛的 k 点网格的情况下，它收敛 $E_{\\mathrm{cut}}$。该方案正确地指出，由于 Pulay 贡献，需要将 $E_{\\mathrm{cut}}$ 推到很高的值来收敛应力张量，同时也要监测能量和力。\n- 最后，它使用已经收敛的 $E_{\\mathrm{cut}}$ 和 k 点网格，对 FFT 网格密度 ($E_{\\mathrm{den}}$) 进行专门的收敛性测试。这对于 PAW 至关重要，并确保初始的“高”值确实足够。\n- 最后的检查步骤，即同时增加所有参数，确认了所选收敛设置的稳定性。\n这个过程细致地分离了每个参数，并解决了金属 PAW 计算的特定挑战，例如 Pulay 应力和 FFT 网格要求。\n**结论：正确**\n\n**B.** 该选项建议同时改变所有参数并拟合结果到一个经验曲线。\n- 同时改变 $E_{\\mathrm{cut}}$、k点密度和 $E_{\\mathrm{den}}$ 使得无法区分它们各自的误差贡献。这些参数的收敛速率和误差的函数形式是不同的，因此单一的组合“收敛曲线”在物理上是无意义的，也不会得到可靠的收敛结果。这违反了变量分离原则。\n- 允许展宽宽度 $\\sigma$ 随 k 点网格密度变化是一个致命缺陷。这将物理模型（电子温度）的变化与数值积分参数的收敛混为一谈，使得用于分离布里渊区积分误差的测试无效。\n**结论：错误**\n\n**C.** 该选项提出了一系列对于金属体系而言根本上存在缺陷的步骤。\n- 仅使用 $\\Gamma$ 点来收敛金属铝的 $E_{\\mathrm{cut}}$ 在科学上是不合理的。单个 k 点无法描述金属的费米面或电子占据，会导致完全错误的电子结构和无意义的“收敛的” $E_{\\mathrm{cut}}$。\n- 设置 $E_{\\mathrm{den}} = E_{\\mathrm{cut}}$ 是导致严重混叠误差的“良方”。电荷密度包含的傅里叶分量至少达到波函数频率的2倍，而 PAW 缀加电荷需要更精细的网格。$E_{\\mathrm{den}}$ 必须显著大于 $E_{\\mathrm{cut}}$。\n- 像选项 B 那样随 k 点网格改变 $\\sigma$ 是错误的。\n- 假设力和应力会简单地“跟随”自由能的收敛是天真且危险的，特别是对应力而言，众所周知它随 $E_{\\mathrm{cut}}$ 的收敛要慢得多。\n**结论：错误**\n\n**D.** 该选项包含多个误解和不正确的程序。\n- “首先通过设置 $E_{\\mathrm{den}}$ 等于波函数截断能 $E_{\\mathrm{cut}}$ 并进行细化来收敛 FFT 网格密度”的程序是荒谬的。它混淆了两个独立的参数，并使用了一个已知不充分的关系（$E_{\\mathrm{den}} = E_{\\mathrm{cut}}$）。\n- 使用“适中值”的 $E_{\\mathrm{cut}}$ 以“避免 Pulay 应力”的理由是颠倒的。Pulay 应力是由有限的 $E_{\\mathrm{cut}}$ 引起的误差；它是通过使用非常*高*的 $E_{\\mathrm{cut}}$ 而非适中的值来最小化的。\n- 最后一步改变晶胞体积以保持平面波数量恒定是一种有时用于可变晶胞弛豫的技术。然而，它违反了问题中“在收敛性测试期间，晶胞形状和原子位置保持固定”的明确约束。基组收敛性测试必须在固定的几何结构下进行。\n**结论：错误**\n\n总而言之，选项 A 描述了所有选项中唯一科学有效、稳健且无偏的方案。它正确地识别并解决了金属 DFT/PAW 计算中的关键数值挑战，尊重了参数的层级关系及其特定的收敛行为。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在掌握了收敛性测试的基本策略后，本练习将引导你通过一个量化模型来加深理解。通过构建一个简化的误差模型，你将探索在给定的精度要求下，如何在计算成本与准确性之间做出权衡，并寻找最优的参数组合。这个练习能让你对不同参数如何影响总误差有一个具体的、定量的认识 。",
            "id": "3850302",
            "problem": "考虑投影缀加波（Projector Augmented-Wave, PAW）方法。该方法使用局域投影子和原子球内的缀加部分波，从平滑的赝波函数重构全电子价波函数。在基于平面波的PAW方法中，两个数值分辨率参数控制着完备性和准确性：波函数的平面波动能截断值，记为 $E_{\\mathrm{wfc}}$（单位为 $\\mathrm{eV}$），以及电荷密度（或缀加）截断值，记为 $E_{\\rho}$（单位为 $\\mathrm{eV}$）。根据 Rayleigh-Ritz 变分原理，随着基组的扩大，近似的基态能量会单调地向精确能量收敛。根据带有 Pulay 修正的 Hellmann-Feynman 定理，残余的力误差源于基组和缀加表示的不完备性，这两者都会随着截断值的增大而改善。一个广泛使用且科学上合理的截断误差替代模型是，平滑量随基组大小呈代数收敛。具体而言，假设存在以下依赖于材料的参数化误差模型：\n$$\\Delta E_{\\mathrm{atom}}(E_{\\mathrm{wfc}}, E_{\\rho}) = A_E E_{\\mathrm{wfc}}^{-p_E} + B_E E_{\\rho}^{-q_E} \\quad \\text{in } \\mathrm{eV/atom},$$\n$$\\Delta F(E_{\\mathrm{wfc}}, E_{\\rho}) = A_F E_{\\mathrm{wfc}}^{-p_F} + B_F E_{\\rho}^{-q_F} \\quad \\text{in } \\text{eV}/\\text{\\AA},$$\n其中 $A_E, B_E, A_F, B_F > 0$ 和 $p_E, q_E, p_F, q_F > 0$ 依赖于材料和赝势的构造。此外，为保证PAW的稳定性和准确性，需强制执行推荐的比例约束 $E_{\\rho} \\ge r E_{\\mathrm{wfc}}$，其中 $r > 0$。你的任务是，对于下面测试套件中的每种材料情况，在指定的 $\\mathrm{eV}$ 网格上确定满足两个目标容差的字典序最小对 $(E_{\\mathrm{wfc}}, E_{\\rho})$：\n- 能量收敛阈值：$\\Delta E_{\\mathrm{atom}} \\le \\epsilon_E = 0.001 \\ \\mathrm{eV/atom}$（等于 $1$ $\\mathrm{meV/atom}$）。\n- 力收敛阈值：$\\Delta F \\le \\epsilon_F = 0.010 \\ \\text{eV}/\\text{\\AA}$（等于 $10$ $\\mathrm{meV}/\\text{\\AA}$）。\n受限于以下边界和网格约束：\n- $E_{\\mathrm{wfc}} \\in [E_{\\mathrm{wfc}}^{\\min}, E_{\\mathrm{wfc}}^{\\max}]$ 和 $E_{\\rho} \\in [r E_{\\mathrm{wfc}}, E_{\\rho}^{\\max}]$,\n- $E_{\\mathrm{wfc}}$ 和 $E_{\\rho}$ 都必须是特定于材料的步长 $s$（单位为 $\\mathrm{eV}$）的整数倍。\n\n形式化的最小性要求：在所有满足容差和约束的数对中，选择 $E_{\\mathrm{wfc}}$ 最小的数对；如果存在多个这样的数对，则选择其中 $E_{\\rho}$ 最小的那个。如果在边界内不存在可行的数对，则输出哨兵对 $[-1.0,-1.0]$。\n\n你必须实现一个算法，该算法根据每种材料的参数，在允许的网格上进行搜索，并返回所需的数对 $(E_{\\mathrm{wfc}}, E_{\\rho})$（单位为 $\\mathrm{eV}$）。\n\n测试套件（每个案例指定了 $(A_E, p_E, B_E, q_E, A_F, p_F, B_F, q_F, r, s, E_{\\mathrm{wfc}}^{\\min}, E_{\\mathrm{wfc}}^{\\max}, E_{\\rho}^{\\max})$，其中所有能量单位为 $\\mathrm{eV}$，力单位为 $\\text{eV}/\\text{\\AA}$）：\n- 案例 $1$（类共价半导体）：\n  - $A_E = 50.0$, $p_E = 2.5$, $B_E = 5.0$, $q_E = 2.0$, $A_F = 150.0$, $p_F = 2.0$, $B_F = 40.0$, $q_F = 2.0$, $r = 3.5$, $s = 10.0$, $E_{\\mathrm{wfc}}^{\\min} = 200.0$, $E_{\\mathrm{wfc}}^{\\max} = 600.0$, $E_{\\rho}^{\\max} = 3000.0$。\n- 案例 $2$（类过渡金属）：\n  - $A_E = 120.0$, $p_E = 1.8$, $B_E = 40.0$, $q_E = 1.5$, $A_F = 300.0$, $p_F = 1.8$, $B_F = 150.0$, $q_F = 1.5$, $r = 4.0$, $s = 20.0$, $E_{\\mathrm{wfc}}^{\\min} = 200.0$, $E_{\\mathrm{wfc}}^{\\max} = 800.0$, $E_{\\rho}^{\\max} = 5000.0$。\n- 案例 $3$（具有半芯层敏感性的氧化物）：\n  - $A_E = 30.0$, $p_E = 2.2$, $B_E = 2.0$, $q_E = 1.5$, $A_F = 200.0$, $p_F = 1.7$, $B_F = 50.0$, $q_F = 1.5$, $r = 5.0$, $s = 25.0$, $E_{\\mathrm{wfc}}^{\\min} = 250.0$, $E_{\\mathrm{wfc}}^{\\max} = 700.0$, $E_{\\rho}^{\\max} = 5000.0$。\n- 案例 $4$（软势，比例约束主导）：\n  - $A_E = 0.8$, $p_E = 2.0$, $B_E = 0.4$, $q_E = 2.0$, $A_F = 5.0$, $p_F = 2.0$, $B_F = 3.0$, $q_F = 2.0$, $r = 2.0$, $s = 10.0$, $E_{\\mathrm{wfc}}^{\\min} = 100.0$, $E_{\\mathrm{wfc}}^{\\max} = 300.0$, $E_{\\rho}^{\\max} = 2000.0$。\n- 案例 $5$（边界内不可行）：\n  - $A_E = 800.0$, $p_E = 1.0$, $B_E = 600.0$, $q_E = 1.0$, $A_F = 1500.0$, $p_F = 1.0$, $B_F = 1200.0$, $q_F = 1.0$, $r = 4.0$, $s = 50.0$, $E_{\\mathrm{wfc}}^{\\min} = 300.0$, $E_{\\mathrm{wfc}}^{\\max} = 500.0$, $E_{\\rho}^{\\max} = 4000.0$。\n\n你的程序必须为每个案例计算出字典序最小的 $(E_{\\mathrm{wfc}}, E_{\\rho})$（单位为 $\\mathrm{eV}$），该数对需满足 $\\Delta E_{\\mathrm{atom}} \\le 0.001 \\ \\mathrm{eV/atom}$ 和 $\\Delta F \\le 0.010 \\ \\text{eV}/\\text{\\AA}$、比例约束 $E_{\\rho} \\ge r E_{\\mathrm{wfc}}$ 以及边界条件。如果不存在可行的数对，则为该案例输出 $[-1.0,-1.0]$。\n\n最终输出格式：你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个结果本身是一个数对 $[E_{\\mathrm{wfc}},E_{\\rho}]$。例如，输出应类似于 $[[x_1,y_1],[x_2,y_2],\\dots]$，所有条目单位均为 $\\mathrm{eV}$。不应打印任何其他文本。",
            "solution": "问题要求找到一组字典序最小的数值参数对 $(E_{\\mathrm{wfc}}, E_{\\rho})$，这组参数要满足使用投影缀加波（PAW）方法进行材料模拟时指定的收敛容差。这是一个定义在离散二维网格上的约束优化问题。\n\n需要优化的量是波函数的平面波动能截断值 $E_{\\mathrm{wfc}}$ 和相应的电荷密度截断值 $E_{\\rho}$。目标是找到数对 $(E_{\\mathrm{wfc}}, E_{\\rho})$，使其首先最小化 $E_{\\mathrm{wfc}}$，然后在选定的 $E_{\\mathrm{wfc}}$ 下最小化 $E_{\\rho}$。\n\n该问题受一组约束条件控制。其中两个是基于性能的，要求每个原子的总能量截断误差 $\\Delta E_{\\mathrm{atom}}$ 和原子间力的截断误差 $\\Delta F$ 分别低于给定的阈值 $\\epsilon_E$ 和 $\\epsilon_F$。误差由以下参数化模型描述：\n$$\n\\Delta E_{\\mathrm{atom}}(E_{\\mathrm{wfc}}, E_{\\rho}) = A_E E_{\\mathrm{wfc}}^{-p_E} + B_E E_{\\rho}^{-q_E} \\le \\epsilon_E = 0.001 \\ \\mathrm{eV/atom}\n$$\n$$\n\\Delta F(E_{\\mathrm{wfc}}, E_{\\rho}) = A_F E_{\\mathrm{wfc}}^{-p_F} + B_F E_{\\rho}^{-q_F} \\le \\epsilon_F = 0.010 \\ \\text{eV}/\\text{\\AA}\n$$\n其中，系数 $A_E, B_E, A_F, B_F$ 和指数 $p_E, q_E, p_F, q_F$ 是正的、依赖于材料的参数。这种正定性确保了 $\\Delta E_{\\mathrm{atom}}$ 和 $\\Delta F$ 相对于 $E_{\\mathrm{wfc}}$ 和 $E_{\\rho}$ 都是单调递减函数。这种单调性是变分原理和基组收敛理论的直接结果，也是设计高效搜索算法的关键。\n\n搜索空间还施加了额外的约束：\n1.  线性约束：$E_{\\rho} \\ge r E_{\\mathrm{wfc}}$，对于给定的比率 $r > 0$。这是PAW计算中的标准做法，以防止混叠误差。\n2.  边界约束：$E_{\\mathrm{wfc}} \\in [E_{\\mathrm{wfc}}^{\\min}, E_{\\mathrm{wfc}}^{\\max}]$ 且 $E_{\\rho} \\le E_{\\rho}^{\\max}$。\n3.  离散化约束：$E_{\\mathrm{wfc}}$ 和 $E_{\\rho}$ 都必须是指定网格步长 $s$ 的整数倍。\n\n字典序最小化目标要求特定的搜索顺序。我们必须按升序迭代 $E_{\\mathrm{wfc}}$ 的可能值，从其允许网格上的最小值开始。对于每个 $E_{\\mathrm{wfc}}$，我们再确定满足所有约束的最小 $E_{\\rho}$。我们成功找到的第一个这样的数对 $(E_{\\mathrm{wfc}}, E_{\\rho})$，根据构造，即为字典序最小解。\n\n每个测试用例的搜索过程如下：\n首先，我们为 $E_{\\mathrm{wfc}}$ 建立离散搜索网格。最小的有效值是 $\\lceil E_{\\mathrm{wfc}}^{\\min} / s \\rceil \\cdot s$。然后，我们从这个起始点开始，以 $s$ 为增量，向上迭代到 $E_{\\mathrm{wfc}}^{\\max}$。\n\n对于 $E_{\\mathrm{wfc}}$ 的每个候选值，我们确定所需的最小 $E_{\\rho}$。首先，我们评估是否有可能满足容差。由于 $B_E E_{\\rho}^{-q_E} > 0$ 且 $B_F E_{\\rho}^{-q_F} > 0$，满足误差不等式的一个必要条件是，仅依赖于 $E_{\\mathrm{wfc}}$ 的项必须小于各自的容差：\n$$\nA_E E_{\\mathrm{wfc}}^{-p_E}  \\epsilon_E \\quad \\text{and} \\quad A_F E_{\\mathrm{wfc}}^{-p_F}  \\epsilon_F\n$$\n如果任一条件被违反，则没有任何 $E_{\\rho}$ 值可以满足容差，我们必须继续处理下一个更大的 $E_{\\mathrm{wfc}}$ 值。\n\n如果两个条件都满足，我们可以重新排列误差不等式，以找到由收敛标准施加于 $E_{\\rho}$ 的下界：\n$$\nE_{\\rho} \\ge \\left( \\frac{B_E}{\\epsilon_E - A_E E_{\\mathrm{wfc}}^{-p_E}} \\right)^{1/q_E} \\equiv E_{\\rho, \\text{min}}^{(E)}\n$$\n$$\nE_{\\rho} \\ge \\left( \\frac{B_F}{\\epsilon_F - A_F E_{\\mathrm{wfc}}^{-p_F}} \\right)^{1/q_F} \\equiv E_{\\rho, \\text{min}}^{(F)}\n$$\n我们还有来自比例约束的下界：\n$$\nE_{\\rho} \\ge r \\cdot E_{\\mathrm{wfc}} \\equiv E_{\\rho, \\text{min}}^{(r)}\n$$\n为了同时满足所有条件，$E_{\\rho}$ 必须大于或等于这三个下界中的最大值：\n$$\nE_{\\rho, \\text{min\\_req}} = \\max\\left(E_{\\rho, \\text{min}}^{(E)}, E_{\\rho, \\text{min}}^{(F)}, E_{\\rho, \\text{min}}^{(r)}\\right)\n$$\n在离散网格上，$E_{\\rho}$ 的最小有效值（我们记为 $E_{\\rho, \\text{cand}}$）是通过取此连续下界并向上取整到 $s$ 的最近整数倍来找到的：\n$$\nE_{\\rho, \\text{cand}} = \\lceil E_{\\rho, \\text{min\\_req}} / s \\rceil \\cdot s\n$$\n最后，我们检查此候选值是否遵守上界，$E_{\\rho, \\text{cand}} \\le E_{\\rho}^{\\max}$。如果遵守，则数对 $(E_{\\mathrm{wfc}}, E_{\\rho, \\text{cand}})$ 是找到的第一个有效解，因此是字典序最小解。搜索可以终止，该数对即为结果。\n\n如果对所有有效 $E_{\\mathrm{wfc}}$ 值的迭代完成而没有找到合适的 $E_{\\rho}$，则意味着在指定的边界和给定的网格内没有数对能满足所有约束。在这种情况下，问题是不可行的，并返回指定的哨兵对 $[-1.0, -1.0]$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    \n    # Tolerances are fixed for all test cases as per the problem statement.\n    eps_E = 0.001  # eV/atom\n    eps_F = 0.010  # eV/Angstrom\n\n    test_cases = [\n        # Case 1 (covalent semiconductor-like): (A_E, p_E, B_E, q_E, A_F, p_F, B_F, q_F, r, s, E_wfc_min, E_wfc_max, E_rho_max)\n        (50.0, 2.5, 5.0, 2.0, 150.0, 2.0, 40.0, 2.0, 3.5, 10.0, 200.0, 600.0, 3000.0),\n        # Case 2 (transition metal-like)\n        (120.0, 1.8, 40.0, 1.5, 300.0, 1.8, 150.0, 1.5, 4.0, 20.0, 200.0, 800.0, 5000.0),\n        # Case 3 (oxide with semicore sensitivity)\n        (30.0, 2.2, 2.0, 1.5, 200.0, 1.7, 50.0, 1.5, 5.0, 25.0, 250.0, 700.0, 5000.0),\n        # Case 4 (soft potential, ratio-bound regime)\n        (0.8, 2.0, 0.4, 2.0, 5.0, 2.0, 3.0, 2.0, 2.0, 10.0, 100.0, 300.0, 2000.0),\n        # Case 5 (infeasible within bounds)\n        (800.0, 1.0, 600.0, 1.0, 1500.0, 1.0, 1200.0, 1.0, 4.0, 50.0, 300.0, 500.0, 4000.0),\n    ]\n\n    def solve_case(params):\n        \"\"\"\n        Solves for a single material case to find the lexicographically minimal (E_wfc, E_rho).\n        \"\"\"\n        A_E, p_E, B_E, q_E, A_F, p_F, B_F, q_F, r, s, E_wfc_min, E_wfc_max, E_rho_max = params\n        \n        # A small tolerance for floating point comparisons to ensure robust grid generation\n        # and ceiling operations.\n        TOL = 1e-9\n\n        # Generate the grid of E_wfc values to search, starting from the lowest multiple\n        # of s that is = E_wfc_min.\n        start_E_wfc = np.ceil((E_wfc_min - TOL) / s) * s\n        E_wfc_grid = np.arange(start_E_wfc, E_wfc_max + TOL, s)\n\n        for E_wfc in E_wfc_grid:\n            # Check if the tolerances can be met at all for this E_wfc.\n            # The E_wfc-dependent term of the error model alone must be less than the tolerance.\n            E_wfc_term_E = A_E * (E_wfc ** -p_E)\n            if E_wfc_term_E = eps_E:\n                continue\n\n            E_wfc_term_F = A_F * (E_wfc ** -p_F)\n            if E_wfc_term_F = eps_F:\n                continue\n\n            # If possible, calculate the minimum continuous E_rho required by each criterion.\n            \n            # From energy tolerance inequality\n            E_rho_min_from_E = (B_E / (eps_E - E_wfc_term_E)) ** (1.0 / q_E)\n            \n            # From force tolerance inequality\n            E_rho_min_from_F = (B_F / (eps_F - E_wfc_term_F)) ** (1.0 / q_F)\n            \n            # From ratio constraint\n            E_rho_min_from_ratio = r * E_wfc\n            \n            # The actual minimum E_rho must satisfy all three lower bounds.\n            E_rho_min_req = max(E_rho_min_from_E, E_rho_min_from_F, E_rho_min_from_ratio)\n            \n            # Find the smallest grid point for E_rho that is = E_rho_min_req.\n            E_rho_cand = np.ceil((E_rho_min_req - TOL) / s) * s\n\n            # Check if this candidate is within the allowed upper bound.\n            if E_rho_cand = E_rho_max:\n                # We found the lexicographically smallest pair because we are iterating\n                # E_wfc upwards and calculating the minimum possible E_rho for each.\n                return [E_wfc, E_rho_cand]\n\n        # If the loop completes without returning, no solution was found within the bounds.\n        return [-1.0, -1.0]\n\n    results = [solve_case(case) for case in test_cases]\n\n    # The final print statement must produce only the specified single-line format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "PAW方法中的参数并非孤立的数字，它们与所模拟系统的物理性质密切相关。本练习将挑战你从第一性原理出发，推导物理系统（如晶格压缩）的变化如何影响PAW参数（如缀加半径$r_c$）以及相应的计算设置（如截断能$E_{\\mathrm{cut}}$）。通过这个实践，你将建立起对PAW方法更深层次的物理直觉，从而在面对非常规体系时也能做出明智的判断 。",
            "id": "3850348",
            "problem": "考虑一个单原子面心立方固体，使用投影缀加波（PAW）方法在密度泛函理论（DFT）的框架下进行建模。在环境条件下，晶格常数为 $a_0 = 3.60 \\text{\\AA}$，PAW数据集使用的缀加球面半径 $r_c^0$ 的选择方式是，在乘以一个安全因子 $\\beta = 0.90$ 后，保证球面不发生重叠。在静水压缩至高压相时，晶格常数均匀地缩放为 $a = s a_0$，其中 $s = 0.85$。环境条件下的数据集在使用平面波动能截断值 $E_{\\mathrm{cut},0} = 400 \\text{eV}$ 时能够可靠地收敛。\n\n从Kohn-Sham轨道的定态薛定谔方程及其平面波表示出发，依据第一性原理和经过充分检验的事实，推断在压缩条件下必须如何调整PAW缀加半径 $r_c^a$，以避免缀加球面重叠，并保持投影函数和分波特征的分辨率。使用面心立方晶格的最近邻距离 $d$ 和非重叠准则，在两种压力下使用相同的安全因子 $\\beta$ 来设定 $r_c^a$。然后，利用实空间特征尺寸与表示它所需的最大倒易空间矢量之间的关系，推导出所需的平面波截断能 $E_{\\mathrm{cut}}$ 如何随调整后的 $r_c^a$ 变化。\n\n计算压缩相的调整后缀加半径 $r_c'$ 和新的截断能 $E_{\\mathrm{cut}}'$。将两个最终数值结果四舍五入至四位有效数字。将 $r_c'$ 以埃（\\AA）为单位表示，将 $E_{\\mathrm{cut}}'$ 以电子伏特（eV）为单位表示。你的最终答案必须以单行矩阵的形式呈现两个值，顺序为 $r_c'$ 和 $E_{\\mathrm{cut}}'$。",
            "solution": "此问题要求确定一个在静水压缩下的单原子面心立方（FCC）固体调整后的投影缀加波（PAW）缀加半径及相应的平面波截断能。解决方案是从固态物理的第一性原理和平面波密度泛函理论的形式体系中推导出来的。\n\n首先，我们确定压缩相的调整后PAW缀加半径，记为 $r_c'$。该半径受到相邻原子上的缀加球面不重叠的条件约束。在晶格常数为 $a$ 的FCC晶格中，位于原点的原子的最近邻位于 $(\\frac{a}{2}, \\frac{a}{2}, 0)$ 等位置。这些最近邻之间的距离 $d$ 为：\n$$d = \\sqrt{\\left(\\frac{a}{2}\\right)^2 + \\left(\\frac{a}{2}\\right)^2 + 0^2} = \\sqrt{\\frac{a^2}{2}} = \\frac{a}{\\sqrt{2}}$$\n为使球面不重叠，球体的半径 $r_c$ 必须小于或等于最近邻距离的一半，即 $r_c \\le \\frac{d}{2}$。问题指明，半径的选择带有一个乘法安全因子 $\\beta = 0.90$。这将半径设定为最大可能非重叠半径的一个分数 $\\beta$：\n$$r_c = \\beta \\left(\\frac{d}{2}\\right) = \\beta \\left(\\frac{a}{2\\sqrt{2}}\\right) = \\frac{\\beta a}{2\\sqrt{2}}$$\n此方程建立了缀加半径 $r_c$ 与晶格常数 $a$ 之间的正比关系。\n\n在环境条件下，晶格常数为 $a_0 = 3.60 \\text{\\AA}$。在压缩下，晶格常数被均匀缩放为 $a' = s a_0$，其中缩放因子为 $s=0.85$。问题要求压缩相中的新缀加半径 $r_c'$ 遵守相同的非重叠准则和相同的安全因子 $\\beta$。因此，$r_c'$ 由新的晶格常数 $a'$ 决定：\n$$r_c' = \\frac{\\beta a'}{2\\sqrt{2}} = \\frac{\\beta (s a_0)}{2\\sqrt{2}}$$\n代入给定的数值：\n$$r_c' = \\frac{0.90 \\times 0.85 \\times 3.60 \\text{ \\AA}}{2\\sqrt{2}} = \\frac{2.754}{2\\sqrt{2}} \\text{ \\AA} \\approx 0.973693 \\text{ \\AA}$$\n将结果四舍五入到四位有效数字，我们得到调整后的缀加半径：\n$$r_c' = 0.9737 \\text{ \\AA}$$\n\n接下来，我们确定新的平面波动能截断值 $E_{\\mathrm{cut}}'$。定态Kohn-Sham方程通过将轨道展开为一组平面波基矢 $e^{i\\mathbf{G}\\cdot\\mathbf{r}}$ 来求解。一个平面波的动能由 $T = \\frac{\\hbar^2 |\\mathbf{G}|^2}{2m_e}$ 给出。基组被截断，只包含动能最高达到截断值 $E_{\\mathrm{cut}}$ 的平面波，这意味着 $|\\mathbf{G}| \\le G_{\\mathrm{cut}}$，其中 $E_{\\mathrm{cut}} = \\frac{\\hbar^2 G_{\\mathrm{cut}}^2}{2m_e}$。最大波矢 $G_{\\mathrm{cut}}$ 决定了基组的实空间分辨率。能够被精确表示的最小特征尺寸 $\\Delta x$ 与 $G_{\\mathrm{cut}}$ 成反比，即 $\\Delta x \\propto 1/G_{\\mathrm{cut}}$。\n\n在PAW方法中，平面波基用于表示平滑的赝波函数和投影函数。PAW数据集的“硬度”，以及因此所需的 $E_{\\mathrm{cut}}$，主要由缀加半径 $r_c$ 决定。一个更小的半径 $r_c$ 要求赝波函数在更靠近原子核的地方匹配真实的全电子波函数，而在该区域波函数的振荡更为迅速。这使得赝波函数和投影函数需要具有更尖锐的特征。这些特征的特征长度尺度与 $r_c$ 成正比。因此，所需的空间分辨率 $\\Delta x$ 必须与 $r_c$ 成比例：\n$$\\Delta x \\propto r_c$$\n结合这些关系，我们发现 $G_{\\mathrm{cut}}$ 如何依赖于 $r_c$：\n$$G_{\\mathrm{cut}} \\propto \\frac{1}{\\Delta x} \\propto \\frac{1}{r_c}$$\n由于 $E_{\\mathrm{cut}} \\propto G_{\\mathrm{cut}}^2$，我们得到了截断能与缀加半径之间的平方反比关系：\n$$E_{\\mathrm{cut}} \\propto \\frac{1}{r_c^2}$$\n这是在实际DFT计算中一个标准且经过充分检验的原则。利用这种标度关系，我们可以找到相对于初始截断能 $E_{\\mathrm{cut},0} = 400 \\text{ eV}$ 的新截断能 $E_{\\mathrm{cut}}'$。我们可以将该标度关系表示为一个比率：\n$$\\frac{E_{\\mathrm{cut}}'}{E_{\\mathrm{cut},0}} = \\left(\\frac{r_{c,0}}{r_c'}\\right)^2$$\n其中 $r_{c,0}$ 是环境条件下的半径。从半径的计算中，我们知道 $r_c$ 与晶格常数 $a$ 呈线性关系。因此，$r_{c,0} \\propto a_0$ 且 $r_c' \\propto a' = s a_0$。这给出了半径的比率：\n$$\\frac{r_{c,0}}{r_c'} = \\frac{a_0}{s a_0} = \\frac{1}{s}$$\n将此代入能量标度关系中：\n$$\\frac{E_{\\mathrm{cut}}'}{E_{\\mathrm{cut},0}} = \\left(\\frac{1}{s}\\right)^2 = \\frac{1}{s^2}$$\n因此，新的截断能为：\n$$E_{\\mathrm{cut}}' = \\frac{E_{\\mathrm{cut},0}}{s^2}$$\n代入给定的数值 $E_{\\mathrm{cut},0} = 400 \\text{ eV}$ 和 $s=0.85$：\n$$E_{\\mathrm{cut}}' = \\frac{400 \\text{ eV}}{(0.85)^2} = \\frac{400 \\text{ eV}}{0.7225} \\approx 553.633218 \\text{ eV}$$\n将结果四舍五入到四位有效数字，我们得到新的截断能：\n$$E_{\\mathrm{cut}}' = 553.6 \\text{ eV}$$\n压缩相的调整后缀加半径为 $0.9737 \\text{\\AA}$，新的所需平面波截断能为 $553.6 \\text{ eV}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9737  553.6\n\\end{pmatrix}\n}\n$$"
        }
    ]
}