{
    "hands_on_practices": [
        {
            "introduction": "A molecular dynamics simulation typically begins by assigning initial velocities to all particles. While these can be drawn from a statistical distribution, a direct velocity rescaling is often performed to set a precise starting kinetic temperature. This practice  provides hands-on experience with this fundamental initialization technique. You will calculate the exact scalar factor needed to adjust a system's instantaneous temperature to a target value, a crucial first step before beginning the equilibration process.",
            "id": "3840160",
            "problem": "You are initializing an atomistic subdomain for a concurrent multiscale simulation in materials modeling. The atomistic region consists of four particles in three spatial dimensions, with equal mass $m = 2.00 \\times 10^{-26}~\\mathrm{kg}$ for each particle. The initial velocities (in $\\mathrm{m}\\,\\mathrm{s}^{-1}$) are\n$$\n\\mathbf{v}_1 = (100,~0,~0),\\quad\n\\mathbf{v}_2 = (0,~200,~0),\\quad\n\\mathbf{v}_3 = (-100,~0,~50),\\quad\n\\mathbf{v}_4 = (0,~-200,~-50).\n$$\nBefore computing the instantaneous kinetic temperature, you remove the center-of-mass translational motion. The system is subject to three independent holonomic constraints (two fixed bond lengths and one fixed bond angle) enforced by a constraint algorithm, which reduce the number of kinetic quadratic degrees of freedom.\n\nStarting only from the following fundamental base:\n- The total kinetic energy $K$ of $N$ point particles with masses $\\{m_i\\}$ and velocities $\\{\\mathbf{v}_i\\}$ after removal of center-of-mass motion is $K = \\frac{1}{2}\\sum_{i=1}^{N} m_i |\\mathbf{v}_i|^2$.\n- The equipartition theorem states that for $f$ quadratic degrees of freedom, the kinetic temperature $T_{\\mathrm{current}}$ satisfies $K = \\frac{f}{2} k_B T_{\\mathrm{current}}$, where $k_B$ is the Boltzmann constant.\n- A uniform rescaling of velocities $\\mathbf{v}_i \\mapsto \\lambda \\mathbf{v}_i$ changes the kinetic energy by a multiplicative factor $\\lambda^2$.\n\nDerive the scalar rescaling factor $\\lambda$ required to adjust the instantaneous kinetic temperature to a specified target temperature $T = 300~\\mathrm{K}$, and then compute its numerical value using the provided data. Take the Boltzmann constant to be $k_B = 1.380\\,649 \\times 10^{-23}~\\mathrm{J}\\,\\mathrm{K}^{-1}$.\n\nExpress your final numerical answer for $\\lambda$ as a dimensionless number rounded to four significant figures.",
            "solution": "The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution. I will proceed with the derivation and calculation.\n\nThe objective is to find a scalar rescaling factor $\\lambda$ that adjusts the velocities of a system of particles to match a target temperature $T$. The relationship between the initial state (before rescaling) and the target state (after rescaling) is established through the provided fundamental principles: the definition of kinetic energy, the equipartition theorem, and the effect of velocity rescaling.\n\nLet the initial velocities in the laboratory frame be denoted by $\\{\\mathbf{v}_i^{\\text{lab}}\\}$. The problem states that the center-of-mass (COM) translational motion must be removed before computing the kinetic temperature. The velocity of the center of mass, $\\mathbf{V}_{\\text{CM}}$, for a system of $N$ particles with equal mass $m$ is given by:\n$$\n\\mathbf{V}_{\\text{CM}} = \\frac{\\sum_{i=1}^{N} m \\mathbf{v}_i^{\\text{lab}}}{\\sum_{i=1}^{N} m} = \\frac{1}{N} \\sum_{i=1}^{N} \\mathbf{v}_i^{\\text{lab}}\n$$\nThe system consists of $N=4$ particles. Using the provided velocity data:\n$$\n\\mathbf{v}_1^{\\text{lab}} = (100, 0, 0)~\\mathrm{m}\\,\\mathrm{s}^{-1} \\\\\n\\mathbf{v}_2^{\\text{lab}} = (0, 200, 0)~\\mathrm{m}\\,\\mathrm{s}^{-1} \\\\\n\\mathbf{v}_3^{\\text{lab}} = (-100, 0, 50)~\\mathrm{m}\\,\\mathrm{s}^{-1} \\\\\n\\mathbf{v}_4^{\\text{lab}} = (0, -200, -50)~\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\nThe sum of these velocities is:\n$$\n\\sum_{i=1}^{4} \\mathbf{v}_i^{\\text{lab}} = (100+0-100+0, 0+200+0-200, 0+0+50-50) = (0, 0, 0)~\\mathrm{m}\\,\\mathrm{s}^{-1}\n$$\nTherefore, the center-of-mass velocity is $\\mathbf{V}_{\\text{CM}} = \\mathbf{0}$. This signifies that the system has no net translational motion. The velocities in the center-of-mass frame, $\\mathbf{v}_i = \\mathbf{v}_i^{\\text{lab}} - \\mathbf{V}_{\\text{CM}}$, are identical to the given laboratory-frame velocities, i.e., $\\mathbf{v}_i = \\mathbf{v}_i^{\\text{lab}}$.\n\nThe current kinetic energy of the system, $K_{\\text{current}}$, is calculated using the velocities relative to the center of mass. Based on the provided formula:\n$$\nK_{\\text{current}} = \\frac{1}{2} \\sum_{i=1}^{N} m |\\mathbf{v}_i|^2 = \\frac{1}{2} m \\sum_{i=1}^{N} |\\mathbf{v}_i|^2\n$$\nWe compute the squared magnitudes of the velocities:\n$$\n|\\mathbf{v}_1|^2 = 100^2 + 0^2 + 0^2 = 10000~\\mathrm{m}^2\\,\\mathrm{s}^{-2} \\\\\n|\\mathbf{v}_2|^2 = 0^2 + 200^2 + 0^2 = 40000~\\mathrm{m}^2\\,\\mathrm{s}^{-2} \\\\\n|\\mathbf{v}_3|^2 = (-100)^2 + 0^2 + 50^2 = 10000 + 2500 = 12500~\\mathrm{m}^2\\,\\mathrm{s}^{-2} \\\\\n|\\mathbf{v}_4|^2 = 0^2 + (-200)^2 + (-50)^2 = 40000 + 2500 = 42500~\\mathrm{m}^2\\,\\mathrm{s}^{-2}\n$$\nThe sum of the squared magnitudes is:\n$$\n\\sum_{i=1}^{4} |\\mathbf{v}_i|^2 = 10000 + 40000 + 12500 + 42500 = 105000~\\mathrm{m}^2\\,\\mathrm{s}^{-2}\n$$\nWith the given mass $m = 2.00 \\times 10^{-26}~\\mathrm{kg}$, the current kinetic energy is:\n$$\nK_{\\text{current}} = \\frac{1}{2} (2.00 \\times 10^{-26}~\\mathrm{kg}) (105000~\\mathrm{m}^2\\,\\mathrm{s}^{-2}) = 1.05 \\times 10^{-21}~\\mathrm{J}\n$$\nNext, we determine the number of kinetic quadratic degrees of freedom, $f$. For $N=4$ particles in $3$ spatial dimensions, there are $3N = 12$ total degrees of freedom. The removal of the COM's translational motion subtracts $3$ degrees of freedom. Additionally, the problem specifies $N_c = 3$ independent holonomic constraints. These further reduce the number of degrees of freedom. Thus,\n$$\nf = 3N - 3 - N_c = 3(4) - 3 - 3 = 12 - 6 = 6\n$$\nThe equipartition theorem connects the target kinetic energy, $K_{\\text{target}}$, to the target temperature, $T$:\n$$\nK_{\\text{target}} = \\frac{f}{2} k_B T\n$$\nWhen the velocities are rescaled by a factor $\\lambda$ ($\\mathbf{v}_i \\mapsto \\lambda \\mathbf{v}_i$), the new kinetic energy, which we set to be $K_{\\text{target}}$, is related to the current kinetic energy, $K_{\\text{current}}$, by:\n$$\nK_{\\text{target}} = \\frac{1}{2} \\sum_{i=1}^{N} m |\\lambda\\mathbf{v}_i|^2 = \\lambda^2 \\left( \\frac{1}{2} \\sum_{i=1}^{N} m |\\mathbf{v}_i|^2 \\right) = \\lambda^2 K_{\\text{current}}\n$$\nBy equating the two expressions for $K_{\\text{target}}$, we can solve for $\\lambda$:\n$$\n\\lambda^2 K_{\\text{current}} = \\frac{f}{2} k_B T\n$$\n$$\n\\lambda^2 = \\frac{f k_B T}{2 K_{\\text{current}}}\n$$\n$$\n\\lambda = \\sqrt{\\frac{f k_B T}{2 K_{\\text{current}}}}\n$$\nThis is the symbolic expression for the required rescaling factor. Now, we substitute the numerical values:\n$f = 6$\n$k_B = 1.380649 \\times 10^{-23}~\\mathrm{J}\\,\\mathrm{K}^{-1}$\n$T = 300~\\mathrm{K}$\n$K_{\\text{current}} = 1.05 \\times 10^{-21}~\\mathrm{J}$\n\nPlugging these values into the expression for $\\lambda$:\n$$\n\\lambda = \\sqrt{\\frac{6 \\times (1.380649 \\times 10^{-23}~\\mathrm{J}\\,\\mathrm{K}^{-1}) \\times (300~\\mathrm{K})}{2 \\times (1.05 \\times 10^{-21}~\\mathrm{J})}}\n$$\n$$\n\\lambda = \\sqrt{\\frac{2.4851682 \\times 10^{-20}~\\mathrm{J}}{2.10 \\times 10^{-21}~\\mathrm{J}}}\n$$\n$$\n\\lambda = \\sqrt{11.834134...}\n$$\n$$\n\\lambda \\approx 3.440077...\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\lambda \\approx 3.440\n$$\nThe trailing zero is significant and must be included.",
            "answer": "$$\\boxed{3.440}$$"
        },
        {
            "introduction": "Once a simulation is initialized, it must run for a period to allow it to reach thermodynamic equilibrium. A critical question for any practitioner is: how do we know when the system is properly equilibrated? This exercise  explores a powerful diagnostic tool based on the fluctuation-dissipation theorem. By deriving and applying the relationship between volume fluctuations in an NPT ensemble and the material's isothermal compressibility, you will learn how to quantitatively validate that your simulation is not only stable but is also correctly sampling the desired statistical ensemble.",
            "id": "3840214",
            "problem": "A multiscale workflow couples a mesoscale coarse-grained Molecular Dynamics (MD) model of a polymer melt to continuum constitutive data. You are asked to set up an isothermalâ€“isobaric constant Number of particles, Pressure and Temperature (NPT) simulation and define a quantitative equilibration diagnostic based on equilibrium volume fluctuations.\n\nStarting only from fundamental ensemble definitions and thermodynamic response functions, derive an expression for the equilibrium variance of the simulation box volume, $\\langle (V - \\langle V \\rangle)^2 \\rangle$, in the NPT ensemble in terms of the Boltzmann constant $k_{B}$, the absolute temperature $T$, the isothermal compressibility $\\kappa_{T}$, and the mean volume $\\langle V \\rangle$. Use the definition of isothermal compressibility $\\kappa_{T}$ and the isothermalâ€“isobaric ensemble probability density; do not invoke any result that is not justified by these foundations.\n\nThen, for a coarse-grained polymer melt at $T = 450\\,\\mathrm{K}$ with isothermal compressibility $\\kappa_{T} = 1.5 \\times 10^{-9}\\,\\mathrm{Pa}^{-1}$ and mean simulation box volume $\\langle V \\rangle = 500\\,\\mathrm{nm}^{3}$, compute the expected equilibrium variance of the volume. Use $k_{B} = 1.380\\,649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$. Express your final result for the variance in $\\mathrm{m}^{6}$ and round your numerical answer to four significant figures.\n\nFinally, explain, in the context of simulation initialization and thermal equilibration, how comparing the measured volume variance from the NPT trajectory to the theoretically expected value you derived serves as a diagnostic for equilibration and correct barostat operation. Focus on the reasoning from first principles rather than procedural details.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of statistical mechanics, well-posed with a unique and meaningful solution, and objective in its formulation. It requests a standard derivation, a numerical computation, and an explanation of a core concept in molecular simulation, all of which are appropriate for the specified context.\n\nThe first step is to derive the expression for the variance of the volume in the isothermal-isobaric (NPT) ensemble. The probability density $P(V)$ of finding a system with volume $V$ in the NPT ensemble is proportional to $\\exp(-\\beta G(V))$, where $\\beta = (k_B T)^{-1}$ and $G(V) = A(N,V,T) + PV$. Here, $A(N,V,T)$ is the Helmholtz free energy, $P$ is the pressure, and $T$ is the temperature. The NPT partition function, $\\Delta(N,P,T)$, is the normalization constant:\n$$ \\Delta(N,P,T) = C \\int_0^\\infty dV \\, \\exp(-\\beta(A(N,V,T) + PV)) $$\nwhere $C$ is a constant prefactor. The expectation value of any volume-dependent quantity $X(V)$ is given by:\n$$ \\langle X \\rangle = \\frac{C \\int_0^\\infty dV \\, X(V) \\exp(-\\beta(A(V) + PV))}{C \\int_0^\\infty dV \\, \\exp(-\\beta(A(V) + PV))} = \\frac{\\int_0^\\infty dV \\, X(V) \\exp(-\\beta(A(V) + PV))}{\\int_0^\\infty dV \\, \\exp(-\\beta(A(V) + PV))} $$\n\nWe can find the mean volume $\\langle V \\rangle$ and the mean squared volume $\\langle V^2 \\rangle$ by taking derivatives of the partition function $\\Delta$ with respect to the pressure $P$ at constant $N$ and $T$. Let us for simplicity absorb the constant $C$ and the integration over microstates for a given volume into a term $Q(V,T) = \\exp(-\\beta A(V,T))$, so the partition function is $\\Delta(P,T) = \\int dV \\, Q(V,T) \\exp(-\\beta PV)$.\n\nThe first derivative of $\\Delta$ with respect to $P$ is:\n$$ \\left(\\frac{\\partial \\Delta}{\\partial P}\\right)_{T} = \\int dV \\, Q(V,T) (-\\beta V) \\exp(-\\beta PV) $$\nDividing by $\\Delta$ gives us a relationship for the mean volume $\\langle V \\rangle$:\n$$ \\frac{1}{\\Delta} \\left(\\frac{\\partial \\Delta}{\\partial P}\\right)_{T} = \\frac{\\int dV \\, (-\\beta V) Q(V,T) \\exp(-\\beta PV)}{\\int dV \\, Q(V,T) \\exp(-\\beta PV)} = -\\beta \\langle V \\rangle $$\nThis can be rewritten as:\n$$ \\langle V \\rangle = -\\frac{1}{\\beta} \\frac{1}{\\Delta} \\left(\\frac{\\partial \\Delta}{\\partial P}\\right)_{T} = -k_B T \\left(\\frac{\\partial \\ln \\Delta}{\\partial P}\\right)_{T} $$\n\nTo find the variance, we require $\\langle V^2 \\rangle$, which can be obtained from the second derivative of $\\Delta$ with respect to $P$:\n$$ \\left(\\frac{\\partial^2 \\Delta}{\\partial P^2}\\right)_{T} = \\frac{\\partial}{\\partial P} \\left( \\int dV \\, Q(V,T) (-\\beta V) \\exp(-\\beta PV) \\right) = \\int dV \\, Q(V,T) (-\\beta V)^2 \\exp(-\\beta PV) = \\beta^2 \\int dV \\, V^2 Q(V,T) \\exp(-\\beta PV) $$\nDividing by $\\Delta$ gives an expression for $\\langle V^2 \\rangle$:\n$$ \\frac{1}{\\Delta} \\left(\\frac{\\partial^2 \\Delta}{\\partial P^2}\\right)_{T} = \\frac{\\beta^2 \\int dV \\, V^2 Q(V,T) \\exp(-\\beta PV)}{\\int dV \\, Q(V,T) \\exp(-\\beta PV)} = \\beta^2 \\langle V^2 \\rangle $$\n\nThe variance of the volume is $\\sigma_V^2 = \\langle (V - \\langle V \\rangle)^2 \\rangle = \\langle V^2 \\rangle - \\langle V \\rangle^2$. We can relate this to the derivatives of $\\ln \\Delta$:\n$$ \\left(\\frac{\\partial^2 \\ln \\Delta}{\\partial P^2}\\right)_{T} = \\frac{\\partial}{\\partial P} \\left(\\frac{1}{\\Delta} \\frac{\\partial \\Delta}{\\partial P}\\right)_{T} = -\\frac{1}{\\Delta^2} \\left(\\frac{\\partial \\Delta}{\\partial P}\\right)_{T}^2 + \\frac{1}{\\Delta} \\left(\\frac{\\partial^2 \\Delta}{\\partial P^2}\\right)_{T} $$\nSubstituting the expressions we found for the first and second derivatives:\n$$ \\left(\\frac{\\partial^2 \\ln \\Delta}{\\partial P^2}\\right)_{T} = -(-\\beta \\langle V \\rangle)^2 + (\\beta^2 \\langle V^2 \\rangle) = \\beta^2 (\\langle V^2 \\rangle - \\langle V \\rangle^2) = \\beta^2 \\sigma_V^2 $$\nWe also have another way to express the second derivative of $\\ln \\Delta$ by differentiating our expression for $\\langle V \\rangle$:\n$$ \\left(\\frac{\\partial^2 \\ln \\Delta}{\\partial P^2}\\right)_{T} = \\frac{\\partial}{\\partial P} \\left(-\\beta \\langle V \\rangle\\right) = -\\beta \\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T} $$\nEquating the two expressions for the second derivative of $\\ln \\Delta$:\n$$ \\beta^2 \\sigma_V^2 = -\\beta \\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T} $$\n$$ \\sigma_V^2 = -\\frac{1}{\\beta} \\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T} = -k_B T \\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T} $$\nThe problem provides the definition of isothermal compressibility, $\\kappa_T$:\n$$ \\kappa_T = -\\frac{1}{\\langle V \\rangle} \\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T,N} $$\nRearranging this definition gives $\\left(\\frac{\\partial \\langle V \\rangle}{\\partial P}\\right)_{T,N} = -\\kappa_T \\langle V \\rangle$. Substituting this into our expression for the variance yields the final result:\n$$ \\sigma_V^2 = \\langle (V - \\langle V \\rangle)^2 \\rangle = -k_B T (-\\kappa_T \\langle V \\rangle) = k_B T \\kappa_T \\langle V \\rangle $$\n\nNext, we compute the numerical value for the variance using the provided data.\nGiven:\n$T = 450\\,\\mathrm{K}$\n$\\kappa_{T} = 1.5 \\times 10^{-9}\\,\\mathrm{Pa}^{-1}$\n$\\langle V \\rangle = 500\\,\\mathrm{nm}^{3}$\n$k_{B} = 1.380\\,649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$\n\nFirst, we must ensure all units are in the SI base system. The volume must be converted from $\\mathrm{nm}^3$ to $\\mathrm{m}^3$.\nSince $1\\,\\mathrm{nm} = 10^{-9}\\,\\mathrm{m}$, we have $1\\,\\mathrm{nm}^3 = (10^{-9})^3\\,\\mathrm{m}^3 = 10^{-27}\\,\\mathrm{m}^3$.\nTherefore, $\\langle V \\rangle = 500 \\times 10^{-27}\\,\\mathrm{m}^3 = 5 \\times 10^{-25}\\,\\mathrm{m}^3$.\nThe units of the calculation are $(\\mathrm{J\\,K^{-1}}) \\cdot (\\mathrm{K}) \\cdot (\\mathrm{Pa}^{-1}) \\cdot (\\mathrm{m}^3)$. Since $1\\,\\mathrm{J} = 1\\,\\mathrm{Pa} \\cdot \\mathrm{m}^3$, the final unit is $(\\mathrm{Pa} \\cdot \\mathrm{m}^3) \\cdot (\\mathrm{Pa}^{-1}) \\cdot (\\mathrm{m}^3) = \\mathrm{m}^6$, which is correct for a variance of volume.\n\nNow, we substitute the numerical values into the derived expression:\n$$ \\sigma_V^2 = (1.380\\,649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) \\times (450\\,\\mathrm{K}) \\times (1.5 \\times 10^{-9}\\,\\mathrm{Pa}^{-1}) \\times (5 \\times 10^{-25}\\,\\mathrm{m}^3) $$\n$$ \\sigma_V^2 = (1.380\\,649 \\times 450 \\times 1.5 \\times 5) \\times (10^{-23} \\times 10^{-9} \\times 10^{-25})\\,\\mathrm{m}^6 $$\n$$ \\sigma_V^2 = (4659.675375) \\times (10^{-57})\\,\\mathrm{m}^6 $$\nExpressing this in standard scientific notation and rounding to four significant figures:\n$$ \\sigma_V^2 = 4.659675375 \\times 10^3 \\times 10^{-57}\\,\\mathrm{m}^6 = 4.659675375 \\times 10^{-54}\\,\\mathrm{m}^6 $$\n$$ \\sigma_V^2 \\approx 4.660 \\times 10^{-54}\\,\\mathrm{m}^6 $$\n\nFinally, we explain the role of this relationship as a diagnostic for equilibration and barostat operation.\nThe derived equation, $\\langle (V - \\langle V \\rangle)^2 \\rangle = k_B T \\kappa_T \\langle V \\rangle$, is a specific instance of the fluctuation-dissipation theorem. It establishes a fundamental connection between a microscopic quantity, the equilibrium fluctuations (variance) of the volume, and a macroscopic thermodynamic response function, the isothermal compressibility $\\kappa_T$. This equation is a rigorous result of statistical mechanics and is valid only for a system at thermodynamic equilibrium in the NPT ensemble.\n\nThis provides a powerful quantitative diagnostic for a simulation. During an NPT simulation, one monitors the time series of the simulation box volume, $V(t)$. Once the system is presumed to be equilibrated (i.e., when the running average of the volume, $\\langle V \\rangle$, and its variance, $\\sigma_V^2$, have ceased to drift and are stable), one can perform a quantitative check. The mean volume $\\langle V \\rangle_{sim}$ and volume variance $\\sigma_{V,sim}^2$ are calculated from the simulation trajectory. The theoretical variance is then calculated using the simulated mean volume $\\langle V \\rangle_{sim}$ and an independently known (e.g., from experiment or pre-existing data) isothermal compressibility $\\kappa_T$ for the material at the simulation's temperature $T$ and pressure $P$.\n\nIf the measured variance from the simulation, $\\sigma_{V,sim}^2$, matches the theoretically expected value, $k_B T \\kappa_T \\langle V \\rangle_{sim}$, it provides strong evidence for two critical points:\n$1$. The system is properly equilibrated. The simulation has run long enough for the system to sample the volume probability distribution $P(V)$ characteristic of the equilibrium state, and the measured fluctuations are therefore statistically meaningful.\n$2$. The barostat (the algorithm controlling pressure) is correctly implementing the NPT ensemble. Some barostats, like the Berendsen barostat, are known to control the average pressure correctly but fail to generate the correct volume fluctuations. A match confirms that the chosen barostat (e.g., Parrinello-Rahman, Martyna-Tuckerman-Klein) is rigorously sampling the statistical-mechanical ensemble.\n\nConversely, a significant discrepancy between the measured and theoretical variance indicates a problem. It could mean the simulation is not yet equilibrated, the barostat is not correctly sampling the NPT ensemble, its parameters are suboptimal, or the underlying force field of the model does not accurately reproduce the experimental compressibility of the material. Thus, this check is a crucial step in validating the simulation setup and ensuring the physical realism of the results.",
            "answer": "$$ \\boxed{4.660 \\times 10^{-54}} $$"
        },
        {
            "introduction": "After confirming that a simulation has reached equilibrium, the next step is to analyze the trajectory data to compute average properties. A frequent oversight is to treat successive data points as statistically independent, which leads to a significant underestimation of the true uncertainty. This practice  delves into the proper statistical analysis of correlated time-series data. You will explore the theoretical basis for the block averaging method and compute the statistical inefficiency, $g$, which quantifies the reduction in effective sample size due to time correlations, ensuring your results are reported with robust and meaningful error bars.",
            "id": "3840223",
            "problem": "You are initializing and equilibrating an atomistic subsystem in a multiscale materials simulation to provide thermodynamic targets for a coarse-grained model. During an equilibrated segment of Molecular Dynamics (MD), you record a time series of the instantaneous kinetic temperature estimator, sampled uniformly every $\\Delta t = 5$ femtoseconds. The total number of recorded samples is $N = 40000$. The subsystem contains $N_{\\text{atoms}} = 1000$ atoms and a global translational constraint has been applied so that the number of quadratic momentum degrees of freedom is $f = 3N_{\\text{atoms}} - 3$. Prior analysis indicates the normalized autocorrelation function of the temperature is well approximated by a single-exponential decay, $\\rho(k) = \\exp\\!\\big(-k \\Delta t / \\tau\\big)$, with correlation time $\\tau = 40$ femtoseconds.\n\nStarting from fundamental statistical mechanics and time series definitions, derive a principled block averaging procedure to estimate the equilibrium mean temperature and its uncertainty from a correlated time series. Your derivation must:\n- Use the equipartition theorem to construct the instantaneous kinetic temperature estimator and its variance under canonical sampling.\n- Use the definition of the variance of the sample mean for a stationary correlated process in terms of its autocovariance and normalized autocorrelation functions.\n- Motivate block averaging by showing how sufficiently long, contiguous blocks yield approximately independent block means and connect the block-mean variance to the variance of the overall mean.\n- Identify the statistical inefficiency $g$ and the effective sample size $N_{\\text{eff}}$ that control the uncertainty of the mean.\n\nThen, using the given exponential autocorrelation model, compute the statistical inefficiency $g$ for the specified $\\Delta t$ and $\\tau$. Round your final numerical answer for $g$ to four significant figures. The answer is dimensionless; do not include any units in your final answer.",
            "solution": "The problem requires a two-part response: first, a derivation of the block averaging procedure for estimating the mean and uncertainty from a correlated time series, grounded in statistical mechanics; second, a calculation of the statistical inefficiency $g$ using a provided model.\n\n### Part 1: Derivation of the Block Averaging Procedure\n\n**1. Instantaneous Kinetic Temperature and its Variance**\n\nIn classical statistical mechanics, the total kinetic energy of a system of $N_{\\text{atoms}}$ particles is given by $K = \\sum_{j=1}^{N_{\\text{atoms}}} \\frac{\\mathbf{p}_j^2}{2m_j}$, where $\\mathbf{p}_j$ and $m_j$ are the momentum and mass of particle $j$. The equipartition theorem states that for a system in thermal equilibrium at temperature $T$, the average energy associated with each quadratic degree of freedom is $\\frac{1}{2} k_B T$, where $k_B$ is the Boltzmann constant.\n\nGiven a system with $f$ quadratic momentum degrees of freedom, the mean kinetic energy is:\n$$\n\\langle K \\rangle = \\frac{f}{2} k_B T\n$$\nThe problem specifies $f = 3N_{\\text{atoms}} - 3$, accounting for a constraint on the center-of-mass momentum.\n\nThis relationship is used to define an instantaneous kinetic temperature estimator, $T_i$, from the instantaneous kinetic energy, $K_i$, at a given time step $i$:\n$$\nT_i = \\frac{2 K_i}{f k_B}\n$$\nThe mean of this estimator, $\\langle T_i \\rangle$, is the true equilibrium temperature $T$.\n\nTo find the uncertainty in the mean, we first need the variance of the instantaneous temperature, $\\sigma_T^2 = \\text{Var}(T_i)$. This variance is related to the variance of the kinetic energy, $\\text{Var}(K)$. For a system described by the canonical (NVT) ensemble, fluctuations in kinetic energy are well-defined. For degrees of freedom that are quadratic in momentum and independent (as in an ideal gas, a common reference system), the variance of the kinetic energy is:\n$$\n\\text{Var}(K) = \\langle (K - \\langle K \\rangle)^2 \\rangle = \\frac{f}{2} (k_B T)^2\n$$\nUsing this, we can find the variance of the instantaneous temperature estimator:\n$$\n\\sigma_T^2 = \\text{Var}(T_i) = \\text{Var}\\left(\\frac{2 K_i}{f k_B}\\right) = \\left(\\frac{2}{f k_B}\\right)^2 \\text{Var}(K_i) = \\frac{4}{f^2 k_B^2} \\left(\\frac{f}{2} (k_B T)^2\\right) = \\frac{2}{f} T^2\n$$\nThis fundamental result shows that the variance of the instantaneous temperature is inversely proportional to the number of degrees of freedom.\n\n**2. Variance of the Sample Mean for a Correlated Process**\n\nThe sample mean, $\\bar{T}$, of a time series of $N$ temperature measurements $\\{T_1, T_2, \\dots, T_N\\}$ is:\n$$\n\\bar{T} = \\frac{1}{N} \\sum_{i=1}^N T_i\n$$\nThe variance of this sample mean is:\n$$\n\\text{Var}(\\bar{T}) = \\text{Var}\\left(\\frac{1}{N} \\sum_{i=1}^N T_i\\right) = \\frac{1}{N^2} \\text{Cov}\\left(\\sum_{i=1}^N T_i, \\sum_{j=1}^N T_j\\right) = \\frac{1}{N^2} \\sum_{i=1}^N \\sum_{j=1}^N \\text{Cov}(T_i, T_j)\n$$\nFor a stationary process, the covariance depends only on the time lag $k = |i-j|$, i.e., $\\text{Cov}(T_i, T_j) = C(k)$. The variance of the process is $C(0) = \\sigma_T^2$. The double summation can be rewritten by grouping terms with the same lag $k$:\n$$\n\\text{Var}(\\bar{T}) = \\frac{1}{N^2} \\left[ N C(0) + 2 \\sum_{k=1}^{N-1} (N-k) C(k) \\right]\n$$\nFactoring out $C(0)/N$ and introducing the normalized autocorrelation function (ACF), $\\rho(k) = C(k)/C(0)$, we get:\n$$\n\\text{Var}(\\bar{T}) = \\frac{\\sigma_T^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{N-1} \\left(1-\\frac{k}{N}\\right) \\rho(k) \\right]\n$$\nIn many practical situations, the number of samples $N$ is much larger than the correlation length of the process. In this limit, where $\\rho(k) \\to 0$ for $k \\ll N$, we can make two approximations: $(1 - k/N) \\approx 1$ and the sum can be extended to infinity. This yields the asymptotic formula:\n$$\n\\text{Var}(\\bar{T}) \\approx \\frac{\\sigma_T^2}{N} \\left[ 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) \\right]\n$$\n\n**3. Statistical Inefficiency ($g$) and Effective Sample Size ($N_{\\text{eff}}$)**\n\nThe expression for the variance highlights the effect of correlations. We define the **statistical inefficiency**, $g$, as the factor by which the variance is increased compared to an uncorrelated series:\n$$\ng = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k)\n$$\nThe variance of the mean can then be written compactly as:\n$$\n\\text{Var}(\\bar{T}) \\approx \\frac{g \\sigma_T^2}{N}\n$$\nFor an uncorrelated series, $g=1$. For a positively correlated series (typical in MD), $g > 1$, which means our estimate of the mean is less certain than if the samples were independent.\n\nThis leads to the concept of the **effective sample size**, $N_{\\text{eff}}$. We define $N_{\\text{eff}}$ as the number of truly independent samples that would yield the same variance of the mean.\n$$\n\\frac{\\sigma_T^2}{N_{\\text{eff}}} = \\frac{g \\sigma_T^2}{N} \\implies N_{\\text{eff}} = \\frac{N}{g}\n$$\nEffectively, the $N$ correlated data points provide the same statistical power as only $N/g$ independent points.\n\n**4. Block Averaging Motivation and Procedure**\n\nIn a real simulation, the true ACF $\\rho(k)$ and thus $g$ are unknown. The block averaging method is a robust, non-parametric procedure to estimate $\\text{Var}(\\bar{T})$ directly from the time series data.\n\nThe procedure is as follows:\n1. Divide the total time series of $N$ data points into $N_b$ non-overlapping, contiguous blocks, each of length $M$. Thus, $N = N_b M$.\n2. For each block $j \\in \\{1, \\dots, N_b\\}$, calculate the block mean:\n   $$\n   \\bar{T}_j^{(M)} = \\frac{1}{M} \\sum_{i=(j-1)M+1}^{jM} T_i\n   $$\n3. The overall mean of the data is the mean of these block means: $\\bar{T} = \\frac{1}{N_b} \\sum_{j=1}^{N_b} \\bar{T}_j^{(M)}$.\n4. The central assumption is that if the block length $M$ is chosen to be sufficiently large such that the block duration, $M \\Delta t$, is much greater than the correlation time $\\tau$ of the data ($M \\Delta t \\gg \\tau$), then the block means $\\bar{T}_j^{(M)}$ will be approximately uncorrelated.\n5. Treating the $N_b$ block means as a set of independent, identically distributed random variables, the variance of their mean (which is $\\bar{T}$) can be estimated using the standard formula for the standard error of the mean:\n   $$\n   \\hat{\\text{Var}}(\\bar{T}) = \\frac{s_{\\text{block}}^2}{N_b}\n   $$\n   where $s_{\\text{block}}^2$ is the sample variance of the block means:\n   $$\n   $s_{\\text{block}}^2 = \\frac{1}{N_b-1} \\sum_{j=1}^{N_b} \\left(\\bar{T}_j^{(M)} - \\bar{T}\\right)^2$\n   $$\nThe uncertainty (standard error) of the equilibrium mean temperature is then $\\sigma_{\\bar{T}} \\approx \\sqrt{\\hat{\\text{Var}}(\\bar{T})}$. This procedure directly estimates the variance of the mean without needing to first compute the ACF and $g$. It implicitly accounts for the correlations by grouping them within blocks.\n\n### Part 2: Calculation of Statistical Inefficiency ($g$)\n\nGiven the normalized autocorrelation function $\\rho(k) = \\exp(-k \\Delta t / \\tau)$, we can compute the statistical inefficiency $g$ using its definition.\n\nThe statistical inefficiency is given by:\n$$\ng = 1 + 2 \\sum_{k=1}^{\\infty} \\rho(k) = 1 + 2 \\sum_{k=1}^{\\infty} \\exp\\left(-\\frac{k \\Delta t}{\\tau}\\right)\n$$\nLet the constant ratio be $a = \\exp(-\\Delta t/\\tau)$. The summation is an infinite geometric series:\n$$\n\\sum_{k=1}^{\\infty} a^k = \\frac{a}{1-a}\n$$\nThis series converges because $\\Delta t > 0$ and $\\tau > 0$, ensuring that $0 < a < 1$.\nSubstituting the sum back into the expression for $g$:\n$$\ng = 1 + 2 \\left(\\frac{a}{1-a}\\right) = \\frac{1-a+2a}{1-a} = \\frac{1+a}{1-a}\n$$\nSubstituting back $a = \\exp(-\\Delta t/\\tau)$:\n$$\ng = \\frac{1+\\exp(-\\Delta t/\\tau)}{1-\\exp(-\\Delta t/\\tau)}\n$$\nThis expression is equivalent to the hyperbolic cotangent function:\n$$\ng = \\coth\\left(\\frac{\\Delta t}{2\\tau}\\right)\n$$\nWe are given the values $\\Delta t = 5$ femtoseconds and $\\tau = 40$ femtoseconds. We compute the argument of the $\\coth$ function:\n$$\n\\frac{\\Delta t}{2\\tau} = \\frac{5 \\text{ fs}}{2 \\times 40 \\text{ fs}} = \\frac{5}{80} = \\frac{1}{16}\n$$\nTherefore, the statistical inefficiency is:\n$$\ng = \\coth\\left(\\frac{1}{16}\\right)\n$$\nNumerically evaluating this expression:\n$$\ng = \\coth(0.0625) = \\frac{\\exp(0.0625) + \\exp(-0.0625)}{\\exp(0.0625) - \\exp(-0.0625)} \\approx \\frac{1.0644944 + 0.9394131}{1.0644944 - 0.9394131} \\approx \\frac{2.0039075}{0.1250813} \\approx 16.020849\n$$\nRounding the result to four significant figures as requested gives $16.02$.",
            "answer": "$$\\boxed{16.02}$$"
        }
    ]
}