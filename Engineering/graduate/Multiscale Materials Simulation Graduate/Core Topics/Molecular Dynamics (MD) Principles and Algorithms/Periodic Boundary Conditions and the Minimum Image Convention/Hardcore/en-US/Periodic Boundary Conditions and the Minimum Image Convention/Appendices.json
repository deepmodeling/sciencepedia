{
    "hands_on_practices": [
        {
            "introduction": "Mastering molecular simulation begins with correctly calculating the distance between particles. This first exercise  provides a foundational test of your understanding of the Minimum Image Convention (MIC) in a standard orthorhombic cell. You will apply the core principle of 'wrapping' the displacement vector to find the true shortest distance, a skill that underpins every pair interaction calculation in periodic systems.",
            "id": "3830822",
            "problem": "Consider a three-dimensional orthorhombic simulation cell with Periodic Boundary Conditions (PBC), meaning that the cell is conceptually replicated in all directions so that any point $\\mathbf{r}$ is physically equivalent to $\\mathbf{r} + n_{x} L_{x} \\hat{\\mathbf{x}} + n_{y} L_{y} \\hat{\\mathbf{y}} + n_{z} L_{z} \\hat{\\mathbf{z}}$ for any integers $n_{x}$, $n_{y}$, and $n_{z}$. The Minimum Image Convention (MIC) states that for evaluating a short-ranged pairwise interaction, the relevant displacement between two particles is the vector of minimum Euclidean norm among all periodic images. Let the cell edge lengths be $L_{x} = 3.6\\,\\mathrm{nm}$, $L_{y} = 4.2\\,\\mathrm{nm}$, and $L_{z} = 5.0\\,\\mathrm{nm}$. Two particles are located at Cartesian positions $\\mathbf{r}_{1} = (0.5\\,\\mathrm{nm},\\, 3.9\\,\\mathrm{nm},\\, 4.8\\,\\mathrm{nm})$ and $\\mathbf{r}_{2} = (3.4\\,\\mathrm{nm},\\, 0.6\\,\\mathrm{nm},\\, 0.4\\,\\mathrm{nm})$ within the primary cell. Assume a pair potential truncated at a cutoff radius $r_{c} = 1.30\\,\\mathrm{nm}$, so that the particles interact if and only if their MIC distance is less than or equal to $r_{c}$.\n\nStarting only from the definitions of PBC, the Euclidean norm, and MIC as the selection of the shortest periodic displacement, derive the minimum image displacement vector $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$ and its magnitude $r_{\\mathrm{MIC}}$, and determine the interaction indicator $I$ defined by $I = 1$ if $r_{\\mathrm{MIC}} \\le r_{c}$ and $I = 0$ otherwise. Round all components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$ and $r_{\\mathrm{MIC}}$ to five significant figures. Express the displacement components and the distance in nanometers. Provide your final answer as a single row matrix containing, in order, the three components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$, the scalar distance $r_{\\mathrm{MIC}}$, and the indicator $I$.",
            "solution": "The problem requires the calculation of the minimum image displacement vector, its magnitude, and an interaction indicator for two particles in a three-dimensional orthorhombic simulation cell with periodic boundary conditions (PBC).\n\nFirst, the given parameters are extracted from the problem statement:\nThe simulation cell edge lengths are $L_{x} = 3.6\\,\\mathrm{nm}$, $L_{y} = 4.2\\,\\mathrm{nm}$, and $L_{z} = 5.0\\,\\mathrm{nm}$.\nThe positions of the two particles are $\\mathbf{r}_{1} = (0.5,\\, 3.9,\\, 4.8)\\,\\mathrm{nm}$ and $\\mathbf{r}_{2} = (3.4,\\, 0.6,\\, 0.4)\\,\\mathrm{nm}$.\nThe interaction cutoff radius is $r_{c} = 1.30\\,\\mathrm{nm}$.\nThe interaction indicator is $I=1$ if the minimum image distance $r_{\\mathrm{MIC}} \\le r_{c}$ and $I=0$ otherwise.\n\nThe displacement vector from particle $1$ to particle $2$ in the primary cell is calculated as $\\Delta \\mathbf{r} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$.\nLet the components of $\\mathbf{r}_{1}$ be $(x_1, y_1, z_1)$ and the components of $\\mathbf{r}_{2}$ be $(x_2, y_2, z_2)$.\nThe components of the displacement vector $\\Delta \\mathbf{r} = (\\Delta x, \\Delta y, \\Delta z)$ are:\n$$\n\\Delta x = x_{2} - x_{1} = 3.4\\,\\mathrm{nm} - 0.5\\,\\mathrm{nm} = 2.9\\,\\mathrm{nm}\n$$\n$$\n\\Delta y = y_{2} - y_{1} = 0.6\\,\\mathrm{nm} - 3.9\\,\\mathrm{nm} = -3.3\\,\\mathrm{nm}\n$$\n$$\n\\Delta z = z_{2} - z_{1} = 0.4\\,\\mathrm{nm} - 4.8\\,\\mathrm{nm} = -4.4\\,\\mathrm{nm}\n$$\nSo, the initial displacement vector is $\\Delta \\mathbf{r} = (2.9,\\, -3.3,\\, -4.4)\\,\\mathrm{nm}$.\n\nDue to PBC, particle $2$ has an infinite number of periodic images at positions $\\mathbf{r}_{2, \\mathbf{n}} = \\mathbf{r}_{2} + n_{x} L_{x} \\hat{\\mathbf{x}} + n_{y} L_{y} \\hat{\\mathbf{y}} + n_{z} L_{z} \\hat{\\mathbf{z}}$, where $n_x, n_y, n_z$ are any integers. The displacement vector from particle $1$ to any of these images is $\\Delta \\mathbf{r}_{\\mathbf{n}} = \\mathbf{r}_{2, \\mathbf{n}} - \\mathbf{r}_{1} = \\Delta \\mathbf{r} + (n_x L_x, n_y L_y, n_z L_z)$. The Minimum Image Convention (MIC) mandates that we find the vector $\\Delta \\mathbf{r}_{\\mathbf{n}}$ that has the minimum Euclidean norm. The squared norm is $\\|\\Delta \\mathbf{r}_{\\mathbf{n}}\\|^2 = (\\Delta x + n_x L_x)^2 + (\\Delta y + n_y L_y)^2 + (\\Delta z + n_z L_z)^2$. Since the terms are independent, we can minimize each component's contribution separately.\n\nFor each component $\\alpha \\in \\{x, y, z\\}$, the minimum image displacement component $\\Delta \\alpha_{\\mathrm{MIC}}$ must satisfy the condition $|\\Delta \\alpha_{\\mathrm{MIC}}| \\le \\frac{L_{\\alpha}}{2}$. This is achieved by adding or subtracting the cell length $L_{\\alpha}$ as many times as needed to bring the component into the range $[-\\frac{L_{\\alpha}}{2}, \\frac{L_{\\alpha}}{2}]$. A common implementation of this for a component $\\Delta \\alpha$ is:\n- If $\\Delta \\alpha > \\frac{L_{\\alpha}}{2}$, then $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha - L_{\\alpha}$.\n- If $\\Delta \\alpha < -\\frac{L_{\\alpha}}{2}$, then $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha + L_{\\alpha}$.\n- Otherwise, $\\Delta \\alpha_{\\mathrm{MIC}} = \\Delta \\alpha$.\n\nLet's apply this to each component of $\\Delta \\mathbf{r}$.\n\nFor the $x$-component:\nThe half-box length is $\\frac{L_{x}}{2} = \\frac{3.6}{2} = 1.8\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta x = 2.9\\,\\mathrm{nm}$.\nSince $\\Delta x = 2.9\\,\\mathrm{nm} > 1.8\\,\\mathrm{nm}$, we subtract $L_x$.\n$$\n\\Delta x_{\\mathrm{MIC}} = \\Delta x - L_{x} = 2.9 - 3.6 = -0.7\\,\\mathrm{nm}\n$$\n\nFor the $y$-component:\nThe half-box length is $\\frac{L_{y}}{2} = \\frac{4.2}{2} = 2.1\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta y = -3.3\\,\\mathrm{nm}$.\nSince $\\Delta y = -3.3\\,\\mathrm{nm} < -2.1\\,\\mathrm{nm}$, we add $L_y$.\n$$\n\\Delta y_{\\mathrm{MIC}} = \\Delta y + L_{y} = -3.3 + 4.2 = 0.9\\,\\mathrm{nm}\n$$\n\nFor the $z$-component:\nThe half-box length is $\\frac{L_{z}}{2} = \\frac{5.0}{2} = 2.5\\,\\mathrm{nm}$.\nThe displacement component is $\\Delta z = -4.4\\,\\mathrm{nm}$.\nSince $\\Delta z = -4.4\\,\\mathrm{nm} < -2.5\\,\\mathrm{nm}$, we add $L_z$.\n$$\n\\Delta z_{\\mathrm{MIC}} = \\Delta z + L_{z} = -4.4 + 5.0 = 0.6\\,\\mathrm{nm}\n$$\n\nThus, the minimum image displacement vector is $\\Delta \\mathbf{r}_{\\mathrm{MIC}} = (-0.7,\\, 0.9,\\, 0.6)\\,\\mathrm{nm}$. Rounding these components to five significant figures gives $\\Delta x_{\\mathrm{MIC}} = -0.70000\\,\\mathrm{nm}$, $\\Delta y_{\\mathrm{MIC}} = 0.90000\\,\\mathrm{nm}$, and $\\Delta z_{\\mathrm{MIC}} = 0.60000\\,\\mathrm{nm}$.\n\nNext, we calculate the magnitude of this vector, which is the minimum image distance $r_{\\mathrm{MIC}}$.\n$$\nr_{\\mathrm{MIC}} = \\|\\Delta \\mathbf{r}_{\\mathrm{MIC}}\\| = \\sqrt{(\\Delta x_{\\mathrm{MIC}})^2 + (\\Delta y_{\\mathrm{MIC}})^2 + (\\Delta z_{\\mathrm{MIC}})^2}\n$$\n$$\nr_{\\mathrm{MIC}} = \\sqrt{(-0.7)^2 + (0.9)^2 + (0.6)^2} = \\sqrt{0.49 + 0.81 + 0.36} = \\sqrt{1.66}\\,\\mathrm{nm}\n$$\nNumerically, $r_{\\mathrm{MIC}} \\approx 1.28840987... \\,\\mathrm{nm}$.\nRounding to five significant figures, we get $r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$.\n\nFinally, we determine the interaction indicator $I$ by comparing $r_{\\mathrm{MIC}}$ with the cutoff radius $r_{c} = 1.30\\,\\mathrm{nm}$.\nThe condition for interaction is $r_{\\mathrm{MIC}} \\le r_{c}$.\nWe have $r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$ and $r_{c} = 1.30\\,\\mathrm{nm}$. Since $1.2884 \\le 1.30$, the condition is satisfied.\nTherefore, the interaction indicator is $I = 1$.\n\nThe required results are the components of $\\Delta \\mathbf{r}_{\\mathrm{MIC}}$, its magnitude $r_{\\mathrm{MIC}}$, and the indicator $I$.\n$\\Delta x_{\\mathrm{MIC}} = -0.70000\\,\\mathrm{nm}$\n$\\Delta y_{\\mathrm{MIC}} = 0.90000\\,\\mathrm{nm}$\n$\\Delta z_{\\mathrm{MIC}} = 0.60000\\,\\mathrm{nm}$\n$r_{\\mathrm{MIC}} = 1.2884\\,\\mathrm{nm}$\n$I = 1$\nThese are to be presented in a single row matrix.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.70000 & 0.90000 & 0.60000 & 1.2884 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The power of the Minimum Image Convention is tied to a crucial constraint: the interaction cutoff radius ($r_c$) must not exceed half the box length in any dimension. In this practice problem , you will construct a scenario where this rule is violated, leading to an unphysical 'double counting' of interactions. By quantifying the resulting spurious energy, you will gain a concrete appreciation for why this condition is fundamental to the physical validity of a simulation.",
            "id": "3830813",
            "problem": "Consider a three-dimensional orthorhombic simulation cell with Periodic Boundary Conditions (PBC) of side lengths $L_x$, $L_y$, and $L_z$. The Minimum Image Convention (MIC) requires that, for any pair of particles, only the single nearest periodic image be used to compute pair interactions. In molecular simulations, pairwise interactions are often truncated at a cutoff distance $r_c$ to make computations tractable. In this problem, you will construct a counterexample that demonstrates how choosing $r_c > \\min(L_x,L_y,L_z)/2$ can lead to double counting of neighbors, violating the MIC, and you will quantify the resulting spurious energy contribution.\n\nAssume a pairwise Lennard–Jones (LJ) interaction between identical particles with the potential\n$$\nV(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6\\right],\n$$\ntruncated (but not shifted) at $r_c$, and ignore long-range tail corrections. Consider a cell with dimensions $L_x = 6$, $L_y = 10$, and $L_z = 12$ (all lengths in units of $\\sigma$). Place particle $A$ at position $\\mathbf{r}_A = (0,0,0)$ and particle $B$ at $\\mathbf{r}_B = (2.8,0,0)$. Choose a cutoff $r_c = 3.5$.\n\nTasks:\n- Using only the definitions of PBC and MIC, show that both the direct image separation along the $x$-axis and the image shifted by $-L_x$ lie within the cutoff $r_c$, thereby producing two distinct neighbor entries for the same physical pair when $r_c > L_x/2$.\n- Compute the erroneous additional contribution to the total potential energy arising from counting the second image in addition to the nearest image. That is, compute the spurious extra energy relative to the MIC-consistent total (which would count only the nearest image), in units of $\\epsilon$.\n\nRound your final numerical answer to four significant figures. Express the final energy in units of $\\epsilon$.",
            "solution": "The problem asks us to demonstrate a violation of the Minimum Image Convention (MIC) under specific conditions and to quantify the resulting spurious energy contribution. The problem is valid as it is scientifically grounded, well-posed, and objective.\n\nThe given parameters are:\n- Orthorhombic cell dimensions: $L_x = 6$, $L_y = 10$, and $L_z = 12$. All lengths are in units of the Lennard-Jones parameter $\\sigma$.\n- Position of particle A: $\\mathbf{r}_A = (0, 0, 0)$.\n- Position of particle B: $\\mathbf{r}_B = (2.8, 0, 0)$.\n- Cutoff radius for interactions: $r_c = 3.5$.\n- Pair potential: The Lennard-Jones (LJ) potential, $V(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6\\right]$.\n\nFirst, we address the task of showing that a naive neighbor-finding algorithm that does not adhere strictly to the MIC can lead to \"double counting\" of interactions for the pair (A, B). This occurs when the cutoff radius $r_c$ is larger than half the smallest box dimension, which in this case is $L_x/2 = 6/2 = 3$. Given $r_c = 3.5$, the condition $r_c > L_x/2$ is satisfied.\n\nWe calculate the distance between particle A and the primary image of particle B, which is located at $\\mathbf{r}_B$. The separation vector is:\n$$\n\\Delta\\mathbf{r}_0 = \\mathbf{r}_B - \\mathbf{r}_A = (2.8, 0, 0) - (0, 0, 0) = (2.8, 0, 0)\n$$\nThe distance is the magnitude of this vector:\n$$\nr_0 = |\\Delta\\mathbf{r}_0| = \\sqrt{2.8^2 + 0^2 + 0^2} = 2.8\n$$\nSince $r_0 = 2.8 < r_c = 3.5$, this interaction is within the cutoff and would be included in the energy calculation.\n\nNext, we consider a periodic image of particle B. Due to the Periodic Boundary Conditions (PBC), particle B has images at positions $\\mathbf{r}_B + n_x L_x \\hat{\\mathbf{i}} + n_y L_y \\hat{\\mathbf{j}} + n_z L_z \\hat{\\mathbf{k}}$ for all integer triplets $(n_x, n_y, n_z)$. Let's examine the image corresponding to $(n_x, n_y, n_z) = (-1, 0, 0)$. The position of this image, $\\mathbf{r}_B'$, is:\n$$\n\\mathbf{r}_B' = \\mathbf{r}_B - L_x \\hat{\\mathbf{i}} = (2.8, 0, 0) - (6, 0, 0) = (-3.2, 0, 0)\n$$\nThe separation vector between particle A and this image is:\n$$\n\\Delta\\mathbf{r}_{-1} = \\mathbf{r}_B' - \\mathbf{r}_A = (-3.2, 0, 0) - (0, 0, 0) = (-3.2, 0, 0)\n$$\nThe distance to this image is:\n$$\nr_{-1} = |\\Delta\\mathbf{r}_{-1}| = \\sqrt{(-3.2)^2 + 0^2 + 0^2} = 3.2\n$$\nSince $r_{-1} = 3.2 < r_c = 3.5$, this interaction is also within the cutoff radius.\n\nThus, we have shown that two images of particle B are within the cutoff distance $r_c$ of particle A: the primary image at a distance of $2.8$ and the periodic image shifted by $-L_x$ at a distance of $3.2$. A faulty algorithm that simply checks all images within $r_c$ without first applying the MIC would count both, violating the principle that only the single nearest image should be considered for any pair interaction.\n\nThe second task is to compute the erroneous additional contribution to the total potential energy. The Minimum Image Convention requires us to find the shortest distance between particle A and any image of particle B. The various distances along the $x$-direction are $|2.8 + n_x L_x|$ for $n_x \\in \\mathbb{Z}$. For $n_x=0$, the distance is $2.8$. For $n_x=-1$, the distance is $3.2$. For other integer values of $n_x$, the distances are larger. The minimum image distance is therefore $r_{mic} = \\min(2.8, 3.2, \\dots) = 2.8$.\n\nThe correct potential energy for the pair (A, B) according to the MIC is $V(r_{mic}) = V(2.8)$. The faulty calculation, however, would sum the contributions from all images within the cutoff, resulting in a calculated energy of $V(r_0) + V(r_{-1}) = V(2.8) + V(3.2)$.\n\nThe erroneous additional contribution, or spurious energy, is the energy from the non-nearest image that was incorrectly included. This is:\n$$\nE_{\\text{spurious}} = V(r_{-1}) = V(3.2)\n$$\nWe compute this value using the Lennard-Jones potential. Since all lengths are given in units of $\\sigma$, we can set $\\sigma=1$ in the calculation. We want the final energy in units of $\\epsilon$.\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} = 4 \\left[ \\left(\\frac{1}{r_{-1}/\\sigma}\\right)^{12} - \\left(\\frac{1}{r_{-1}/\\sigma}\\right)^6 \\right]\n$$\nSubstituting $r_{-1}/\\sigma = 3.2$:\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} = 4 \\left[ \\left(\\frac{1}{3.2}\\right)^{12} - \\left(\\frac{1}{3.2}\\right)^6 \\right]\n$$\nWe calculate the terms:\n$$\n\\left(\\frac{1}{3.2}\\right)^6 = (0.3125)^6 \\approx 0.00093132257\n$$\n$$\n\\left(\\frac{1}{3.2}\\right)^{12} = \\left((0.3125)^6\\right)^2 \\approx (0.00093132257)^2 \\approx 8.673617 \\times 10^{-7}\n$$\nNow, substitute these values back into the energy expression:\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} \\approx 4 \\left( 8.673617 \\times 10^{-7} - 0.00093132257 \\right)\n$$\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} \\approx 4 ( -0.00093045521 )\n$$\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} \\approx -0.00372182084\n$$\nRounding the result to four significant figures as requested:\n$$\n\\frac{E_{\\text{spurious}}}{\\epsilon} \\approx -0.003722\n$$\nThis negative value indicates a spurious attractive contribution to the total energy of the system.",
            "answer": "$$\n\\boxed{-0.003722}\n$$"
        },
        {
            "introduction": "While the Minimum Image Convention is conceptually simple in orthogonal boxes, its application in general triclinic (skewed) cells reveals a common pitfall. This advanced problem  demonstrates why a naive, component-wise wrapping in Cartesian coordinates fails and leads to incorrect distances. By working through the correct procedure using a transformation to fractional coordinates, you will master the robust, general algorithm required for accurate simulations in arbitrary cell geometries.",
            "id": "2793940",
            "problem": "Consider a three-dimensional periodic simulation cell defined by a triclinic Bravais lattice with cell matrix $\\mathbf{H}$ whose columns are the lattice vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$ in Cartesian coordinates. Let\n$$\n\\mathbf{a}=\\begin{pmatrix}10 \\\\ 0 \\\\ 0\\end{pmatrix},\\quad\n\\mathbf{b}=\\begin{pmatrix}9.8 \\\\ 1.0 \\\\ 0\\end{pmatrix},\\quad\n\\mathbf{c}=\\begin{pmatrix}9.8 \\\\ 0.2 \\\\ 1.0\\end{pmatrix} \\text{ (all components in \\AA)}.\n$$\nTwo particles have fractional (also called reduced) coordinates $\\mathbf{s}_{1}=\\begin{pmatrix}0 \\\\ 0 \\\\ 0\\end{pmatrix}$ and $\\mathbf{s}_{2}=\\begin{pmatrix}0.02 \\\\ 0.6 \\\\ 0\\end{pmatrix}$ with respect to $\\mathbf{H}$, so their Cartesian positions are $\\mathbf{r}_{i}=\\mathbf{H}\\,\\mathbf{s}_{i}$. Under periodic boundary conditions, the minimum image of a separation vector $\\mathbf{r}=\\mathbf{r}_{2}-\\mathbf{r}_{1}$ is defined from first principles as\n$$\n\\mathbf{r}_{\\mathrm{mic}}=\\operatorname*{arg\\,min}_{\\mathbf{n}\\in\\mathbb{Z}^{3}}\\left\\|\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}\\right\\|_{2},\n$$\nthat is, the unique member of the set $\\{\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}:\\mathbf{n}\\in\\mathbb{Z}^{3}\\}$ with minimal Euclidean length.\n\nA commonly used but incorrect heuristic in skewed cells is to “wrap” in Cartesian coordinates by component-wise rounding using the diagonal lengths $L_{x},L_{y},L_{z}$ obtained from the upper-triangular form of $\\mathbf{H}$, namely $L_{x}=a_{x}$, $L_{y}=b_{y}$, $L_{z}=c_{z}$. In this cell, $L_{x}=10$, $L_{y}=1$, and $L_{z}=1$ (in \\AA). This naive Cartesian wrapping maps a Cartesian vector $\\mathbf{r}=(r_{x},r_{y},r_{z})^{\\top}$ to\n$$\n\\mathbf{r}_{\\mathrm{naive}}=\\begin{pmatrix}\nr_{x}-L_{x}\\,\\mathrm{nint}\\!\\left(\\frac{r_{x}}{L_{x}}\\right) \\\\\nr_{y}-L_{y}\\,\\mathrm{nint}\\!\\left(\\frac{r_{y}}{L_{y}}\\right) \\\\\nr_{z}-L_{z}\\,\\mathrm{nint}\\!\\left(\\frac{r_{z}}{L_{z}}\\right)\n\\end{pmatrix},\n$$\nwhere $\\mathrm{nint}(\\cdot)$ denotes rounding to the nearest integer.\n\nStarting only from the definitions above, do the following:\n\n1) Derive the correct triclinic minimum-image mapping by expressing $\\mathbf{r}$ in fractional coordinates $\\mathbf{s}=\\mathbf{H}^{-1}\\mathbf{r}$, reducing $\\mathbf{s}$ to the central cell by component-wise nearest-integer subtraction to obtain $\\mathbf{s}'=\\mathbf{s}-\\mathrm{nint}(\\mathbf{s})$, and mapping back to Cartesian via $\\mathbf{r}_{\\mathrm{mic}}=\\mathbf{H}\\,\\mathbf{s}'$.\n\n2) Compute the explicit Cartesian vectors $\\mathbf{r}$, $\\mathbf{r}_{\\mathrm{mic}}$, and their Euclidean lengths for the given $\\mathbf{H}$ and $\\mathbf{s}_{1},\\mathbf{s}_{2}$.\n\n3) Compute the naive Cartesian-wrapped vector $\\mathbf{r}_{\\mathrm{naive}}$ and its Euclidean length using the prescription above with $L_{x}=10$, $L_{y}=1$, $L_{z}=1$.\n\n4) Explain why $\\mathbf{r}_{\\mathrm{naive}}$ is not guaranteed to equal $\\mathbf{r}-\\mathbf{H}\\,\\mathbf{n}$ for any $\\mathbf{n}\\in\\mathbb{Z}^{3}$ when $\\mathbf{H}$ is skewed, and verify explicitly for this example that the true minimizer over $\\mathbf{n}\\in\\mathbb{Z}^{3}$ is attained by the choice prescribed in step $1)$.\n\n5) Define the distance error $\\delta=\\|\\mathbf{r}_{\\mathrm{naive}}\\|_{2}-\\|\\mathbf{r}_{\\mathrm{mic}}\\|_{2}$. Compute $\\delta$ for this case.\n\nExpress your final answer for $\\delta$ in \\AA\\ and round your answer to four significant figures.",
            "solution": "The posed problem is scientifically grounded, well-posed, and objective. It addresses a fundamental and non-trivial aspect of computational methods in theoretical chemistry and condensed matter physics, namely the correct implementation of the minimum image convention for general triclinic simulation cells. All data and definitions required for a unique solution are provided, and there are no internal contradictions or logical flaws. The problem is therefore valid, and I shall proceed with its solution.\n\nThe solution is structured into the five parts requested by the problem statement.\n\n1) Derivation of the correct triclinic minimum-image mapping.\nThe minimum image convention seeks to find the shortest vector connecting two particles, considering all their periodic images. The separation vector between particle $2$ and particle $1$ is $\\mathbf{r} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$. The set of all periodic images of this separation vector is given by $\\{\\mathbf{r} - \\mathbf{H}\\mathbf{n} : \\mathbf{n} \\in \\mathbb{Z}^3\\}$, where $\\mathbf{H}$ is the cell matrix and $\\mathbf{n}$ is a vector of three integers. The minimum image vector, $\\mathbf{r}_{\\mathrm{mic}}$, is the unique vector in this set with the minimum Euclidean norm.\n\nThe correct procedure avoids direct operations in Cartesian coordinates, which are not adapted to the lattice periodicity unless the cell is orthorhombic. Instead, one must work in the space of fractional coordinates, where the periodicity is simple.\n\nLet $\\mathbf{s} = \\mathbf{H}^{-1}\\mathbf{r}$ be the separation vector expressed in fractional coordinates. The components of $\\mathbf{s}$, denoted $s_i$, represent the displacement along the lattice vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$.\nIn this fractional space, the periodic images of the origin are located at all integer coordinates $\\mathbf{n} \\in \\mathbb{Z}^3$. To find the image of $\\mathbf{s}$ closest to the origin, we simply find the nearest integer for each component of $\\mathbf{s}$. This operation is denoted by the nearest integer function, $\\mathrm{nint}(\\cdot)$.\nLet $\\mathbf{n}_{\\mathrm{mic}} = \\mathrm{nint}(\\mathbf{s})$, where the function is applied component-wise. This integer vector $\\mathbf{n}_{\\mathrm{mic}}$ defines the translation required to bring $\\mathbf{s}$ into the central simulation cell, which is typically configured as the Wigner-Seitz cell of the fractional lattice, $[ -0.5, 0.5 )^3$.\nThe reduced fractional vector is $\\mathbf{s}' = \\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}}$. By construction, each component $s'_i$ of $\\mathbf{s}'$ lies in the interval $[-0.5, 0.5)$.\n\nFinally, this reduced fractional vector $\\mathbf{s}'$ is mapped back to Cartesian coordinates to obtain the minimum image vector:\n$$\n\\mathbf{r}_{\\mathrm{mic}} = \\mathbf{H}\\mathbf{s}' = \\mathbf{H}(\\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}}) = \\mathbf{H}(\\mathbf{H}^{-1}\\mathbf{r} - \\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r})) = \\mathbf{r} - \\mathbf{H}\\,\\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r}).\n$$\nThis is the correct general mapping for a triclinic cell. The integer vector that minimizes the distance is $\\mathbf{n} = \\mathrm{nint}(\\mathbf{H}^{-1}\\mathbf{r})$.\n\n2) Computation of $\\mathbf{r}$, $\\mathbf{r}_{\\mathrm{mic}}$, and their lengths.\nThe givens are the cell matrix $\\mathbf{H}$ composed of column vectors $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$:\n$$\n\\mathbf{H} = \\begin{pmatrix} 10 & 9.8 & 9.8 \\\\ 0 & 1.0 & 0.2 \\\\ 0 & 0 & 1.0 \\end{pmatrix}\n$$\nand the fractional coordinates $\\mathbf{s}_{1} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$ and $\\mathbf{s}_{2} = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$.\n\nThe initial separation vector in Cartesian coordinates is $\\mathbf{r} = \\mathbf{r}_2 - \\mathbf{r}_1$. Since $\\mathbf{s}_1$ is the origin, $\\mathbf{r}_1 = \\mathbf{H}\\mathbf{s}_1 = \\mathbf{0}$, and thus $\\mathbf{r} = \\mathbf{r}_2$.\n$$\n\\mathbf{r} = \\mathbf{H}\\mathbf{s}_2 = \\begin{pmatrix} 10 & 9.8 & 9.8 \\\\ 0 & 1.0 & 0.2 \\\\ 0 & 0 & 1.0 \\end{pmatrix} \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix} = 0.02\\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} + 0.6\\begin{pmatrix} 9.8 \\\\ 1.0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.2 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 5.88 \\\\ 0.6 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 6.08 \\\\ 0.6 \\\\ 0 \\end{pmatrix}.\n$$\nThe squared Euclidean length of $\\mathbf{r}$ is $\\|\\mathbf{r}\\|_2^2 = 6.08^2 + 0.6^2 + 0^2 = 36.9664 + 0.36 = 37.3264$.\nThe length is $\\|\\mathbf{r}\\|_2 = \\sqrt{37.3264} \\approx 6.1095\\ \\text{\\AA}$.\n\nTo compute $\\mathbf{r}_{\\mathrm{mic}}$, we follow the procedure from part 1. The fractional separation vector is $\\mathbf{s} = \\mathbf{s}_2 - \\mathbf{s}_1 = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$.\nWe find the nearest integer vector: $\\mathbf{n}_{\\mathrm{mic}} = \\mathrm{nint}(\\mathbf{s}) = \\begin{pmatrix} \\mathrm{nint}(0.02) \\\\ \\mathrm{nint}(0.6) \\\\ \\mathrm{nint}(0) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\nThe reduced fractional vector is $\\mathbf{s}' = \\mathbf{s} - \\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0.02 \\\\ 0.6 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$.\nFinally, we map $\\mathbf{s}'$ back to Cartesian coordinates:\n$$\n\\mathbf{r}_{\\mathrm{mic}} = \\mathbf{H}\\mathbf{s}' = \\begin{pmatrix} 10 & 9.8 & 9.8 \\\\ 0 & 1.0 & 0.2 \\\\ 0 & 0 & 1.0 \\end{pmatrix} \\begin{pmatrix} 0.02 \\\\ -0.4 \\\\ 0 \\end{pmatrix} = 0.02\\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix} - 0.4\\begin{pmatrix} 9.8 \\\\ 1.0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.2 \\\\ 0 \\\\ 0 \\end{pmatrix} - \\begin{pmatrix} 3.92 \\\\ 0.4 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -3.72 \\\\ -0.4 \\\\ 0 \\end{pmatrix}.\n$$\nThe squared Euclidean length is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2^2 = (-3.72)^2 + (-0.4)^2 + 0^2 = 13.8384 + 0.16 = 13.9984$.\nThe length is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2 = \\sqrt{13.9984} \\approx 3.7414\\ \\text{\\AA}$.\n\n3) Computation of the naive Cartesian-wrapped vector $\\mathbf{r}_{\\mathrm{naive}}$ and its length.\nThe naive method uses the diagonal elements of the upper-triangular cell matrix, $L_x=10$, $L_y=1$, $L_z=1$. It wraps the Cartesian vector $\\mathbf{r} = \\begin{pmatrix} 6.08 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$ component-wise.\n$$\nr_{\\mathrm{naive}, x} = r_x - L_x\\,\\mathrm{nint}\\!\\left(\\frac{r_x}{L_x}\\right) = 6.08 - 10\\,\\mathrm{nint}\\!\\left(\\frac{6.08}{10}\\right) = 6.08 - 10\\,\\mathrm{nint}(0.608) = 6.08 - 10(1) = -3.92.\n$$\n$$\nr_{\\mathrm{naive}, y} = r_y - L_y\\,\\mathrm{nint}\\!\\left(\\frac{r_y}{L_y}\\right) = 0.6 - 1\\,\\mathrm{nint}\\!\\left(\\frac{0.6}{1}\\right) = 0.6 - 1\\,\\mathrm{nint}(0.6) = 0.6 - 1(1) = -0.4.\n$$\n$$\nr_{\\mathrm{naive}, z} = r_z - L_z\\,\\mathrm{nint}\\!\\left(\\frac{r_z}{L_z}\\right) = 0 - 1\\,\\mathrm{nint}\\!\\left(\\frac{0}{1}\\right) = 0 - 1(0) = 0.\n$$\nThus, $\\mathbf{r}_{\\mathrm{naive}} = \\begin{pmatrix} -3.92 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$.\nThe squared Euclidean length is $\\|\\mathbf{r}_{\\mathrm{naive}}\\|_2^2 = (-3.92)^2 + (-0.4)^2 + 0^2 = 15.3664 + 0.16 = 15.5264$.\nThe length is $\\|\\mathbf{r}_{\\mathrm{naive}}\\|_2 = \\sqrt{15.5264} \\approx 3.9404\\ \\text{\\AA}$.\n\n4) Explanation of the flaw in the naive method and verification.\nThe fundamental flaw in the naive Cartesian wrapping is that the vector subtracted from $\\mathbf{r}$ is not, in general, a lattice vector of the form $\\mathbf{H}\\mathbf{n}$ for $\\mathbf{n} \\in \\mathbb{Z}^3$. A vector $\\mathbf{v}$ is a valid periodic image of $\\mathbf{r}$ only if $\\mathbf{v} = \\mathbf{r} - \\mathbf{H}\\mathbf{n}$ for some integer vector $\\mathbf{n}$.\nIn the naive method, the subtracted vector is $\\mathbf{v}_{\\mathrm{sub}} = \\begin{pmatrix} L_x\\,\\mathrm{nint}(r_x/L_x) \\\\ L_y\\,\\mathrm{nint}(r_y/L_y) \\\\ L_z\\,\\mathrm{nint}(r_z/L_z) \\end{pmatrix}$. For this example, this is $\\mathbf{v}_{\\mathrm{sub}} = \\begin{pmatrix} 10(1) \\\\ 1(1) \\\\ 1(0) \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\nFor $\\mathbf{v}_{\\mathrm{sub}}$ to be a valid lattice vector, there must exist an integer vector $\\mathbf{n}$ such that $\\mathbf{H}\\mathbf{n} = \\mathbf{v}_{\\mathrm{sub}}$. Solving for $\\mathbf{n}$ gives $\\mathbf{n} = \\mathbf{H}^{-1}\\mathbf{v}_{\\mathrm{sub}}$. The matrix $\\mathbf{H}$ is upper triangular, so its inverse is also upper triangular:\n$$\n\\mathbf{H}^{-1} = \\begin{pmatrix} 0.1 & -0.98 & -0.784 \\\\ 0 & 1 & -0.2 \\\\ 0 & 0 & 1 \\end{pmatrix}.\n$$\nLet us compute $\\mathbf{n}$:\n$$\n\\mathbf{n} = \\begin{pmatrix} 0.1 & -0.98 & -0.784 \\\\ 0 & 1 & -0.2 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.1(10) - 0.98(1) \\\\ 1(1) \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 - 0.98 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ 1 \\\\ 0 \\end{pmatrix}.\n$$\nSince this $\\mathbf{n}$ is not an integer vector, the vector $\\begin{pmatrix} 10 \\\\ 1 \\\\ 0 \\end{pmatrix}$ is not a lattice vector, and therefore $\\mathbf{r}_{\\mathrm{naive}}$ is not a valid periodic image of $\\mathbf{r}$. This Cartesian wrapping procedure produces a vector outside the set $\\{\\mathbf{r} - \\mathbf{H}\\mathbf{n}\\}$.\n\nTo verify that the method from part 1 yields the true minimizer, we examine the integer vector $\\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$. The corresponding squared distance is $\\|\\mathbf{r}_{\\mathrm{mic}}\\|_2^2 = 13.9984$. We must check if other integer vectors $\\mathbf{n}$ yield a smaller distance.\n\\begin{itemize}\n    \\item For $\\mathbf{n} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$: $\\|\\mathbf{r} - \\mathbf{H}\\mathbf{n}\\|^2 = \\|\\mathbf{r}\\|^2 = 37.3264$.\n    \\item For $\\mathbf{n} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$: $\\mathbf{H}\\mathbf{n} = \\mathbf{a} = \\begin{pmatrix} 10 \\\\ 0 \\\\ 0 \\end{pmatrix}$. The image is $\\mathbf{r} - \\mathbf{a} = \\begin{pmatrix} -3.92 \\\\ 0.6 \\\\ 0 \\end{pmatrix}$. Squared length is $(-3.92)^2 + 0.6^2 = 15.3664 + 0.36 = 15.7264$.\n    \\item For $\\mathbf{n} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$: $\\mathbf{H}\\mathbf{n} = \\mathbf{b}-\\mathbf{a} = \\begin{pmatrix} -0.2 \\\\ 1.0 \\\\ 0 \\end{pmatrix}$. Image is $\\mathbf{r} - (\\mathbf{b}-\\mathbf{a}) = \\begin{pmatrix} 6.28 \\\\ -0.4 \\\\ 0 \\end{pmatrix}$. Squared length is $6.28^2 + (-0.4)^2 = 39.4384 + 0.16 = 39.5984$.\n\\end{itemize}\nAll neighboring integer vectors $\\mathbf{n}$ result in a larger squared distance than for $\\mathbf{n}_{\\mathrm{mic}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$. This confirms that the procedure of reducing fractional coordinates yields the correct minimum image for this case.\n\n5) Computation of the distance error $\\delta$.\nThe error in the calculated distance is defined as $\\delta = \\|\\mathbf{r}_{\\mathrm{naive}}\\|_2 - \\|\\mathbf{r}_{\\mathrm{mic}}\\|_2$.\nUsing the values computed previously:\n$$\n\\delta = \\sqrt{15.5264} - \\sqrt{13.9984}\n$$\n$$\n\\delta \\approx 3.9403553 - 3.7414436 = 0.1989117\n$$\nRounding to four significant figures, the distance error is $\\delta \\approx 0.1989\\ \\text{\\AA}$. This error demonstrates that the naive Cartesian wrapping not only produces a physically incorrect image vector but also overestimates the minimum distance between the particles.",
            "answer": "$$\n\\boxed{0.1989}\n$$"
        }
    ]
}