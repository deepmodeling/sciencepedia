{
    "hands_on_practices": [
        {
            "introduction": "理解算法的最佳方式之一是亲手实现它。本练习将指导您为一个经典的双粒子系统编写速度Verlet算法，该系统通过Lennard-Jones势相互作用。通过模拟这个系统，您将直接观察到辛积分器在长期模拟中卓越的能量守恒特性，正是这一特性使其在分子动力学中不可或缺 ()。",
            "id": "3828000",
            "problem": "考虑一个使用简约单位的双粒子系统，该系统代表了多尺度材料模拟中使用的粗粒化原子相互作用。两个质量为 $m$ 的相同粒子通过 Lennard-Jones 对势 $U(r)=4\\epsilon\\left[(\\sigma/r)^{12}-(\\sigma/r)^6\\right]$ 相互作用，其中 $r$ 是标量分离距离（径向坐标），$\\epsilon$ 设定能量尺度，$\\sigma$ 设定长度尺度。在适用于两个相同质量的相对坐标描述中，动力学简化为由约化质量 $\\mu = m/2$ 的牛顿第二定律所控制的单自由度系统，\n$$\n\\mu\\,\\ddot{r}(t) = -\\frac{dU}{dr}(r(t)),\n$$\n其中 $r(t)>0$。总能量为\n$$\nE(t) = \\frac{1}{2}\\mu\\,\\dot{r}(t)^2 + U(r(t))。\n$$\n从上述基本定律以及长时间材料模拟中时间可逆性和相空间体积守恒的要求出发，推导此单自由度系统的速度 Verlet 积分器，并实现一个显式时间步进更新，将 $(r,v)$（其中 $v=\\dot{r}$）推进一个时间步长 $h$。使用此积分器，在指定的多个时间步长 $h$ 下，估算经过 $N=10^6$ 步后的长时间能量漂移。\n\n使用以下在简约 Lennard-Jones 单位下科学上合理且自洽的设置：\n- 参数：$m=1$，$\\mu = 1/2$，$\\epsilon=1$，$\\sigma=1$。\n- 初始条件：$r(0)=1.3\\,\\sigma$ 且 $v(0)=0$。\n- 来自势的力：$F(r) = -\\frac{dU}{dr}(r)$，沿径向作用；使用从给定的 $U(r)$ 推导出的 $F(r)=24\\,\\epsilon\\left[2\\,\\sigma^{12}r^{-13}-\\sigma^6 r^{-7}\\right]$。\n- 监控的能量：如上定义的 $E(t)$。\n\n任务：\n1. 从牛顿第二定律和给定的势能出发，推导速度 Verlet 方法对 $(r,v)$ 的更新规则，并解释为何对于可分离的哈密顿量，该方法是辛几何和时间可逆的。\n2. 实现一个速度 Verlet 更新，并将其迭代使用 $N=10^6$ 步来推进系统。\n3. 对于测试套件中提供的每个时间步长，计算能量漂移 $\\Delta E = E(Nh) - E(0)$，并以 $\\epsilon$ 为单位，将其报告为浮点数。\n\n测试套件：\n- 情况 1 (理想情况): $h=0.002$。\n- 情况 2 (较大步长，接近此设置的稳定性边界): $h=0.02$。\n\n角度单位在此不适用。能量漂移值以 $\\epsilon$ 为单位，表示为十进制浮点数。您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，“[result1,result2]”）。结果的顺序应与上面列出的测试套件情况相对应。",
            "solution": "我们从约化坐标下的二体问题的牛顿第二定律开始。对于两个质量为 $m$ 的相同粒子，质心运动解耦，相对坐标 $r$ 的演化由约化质量 $\\mu=m/2$ 决定。其控制方程为\n$$\n\\mu\\,\\ddot{r}(t) = -\\frac{dU}{dr}(r(t)),\n$$\n其中 Lennard-Jones 势为\n$$\nU(r) = 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^6\\right].\n$$\n对 $r$ 求导得到径向力\n$$\nF(r) = -\\frac{dU}{dr}(r) = 24\\epsilon\\left[2 \\frac{\\sigma^{12}}{r^{13}} - \\frac{\\sigma^6}{r^7}\\right],\n$$\n加速度 $a(r)$ 满足\n$$\na(r) = \\ddot{r} = \\frac{F(r)}{\\mu}.\n$$\n总能量，作为精确动力学的一个运动常数，其表达式为\n$$\nE(t) = \\frac{1}{2}\\mu\\,\\dot{r}(t)^2 + U(r(t)).\n$$\n\n为了设计在材料模拟中具有长时间稳定性的数值积分器，我们依赖于基本的哈密顿原理。对于形式为 $H(p,q) = T(p) + V(q)$ 的可分离哈密顿量，其中 $T(p) = p^2/(2\\mu)$ 和 $V(q) = U(q)$，精确流保持辛二形式并且是时间可逆的。一种尊重这些性质的方法通常能避免能量的长期增长。速度 Verlet 方法是通过将半步动量更新与全步位置更新相结合而推导出来的，这是将哈密顿量分解为动能和势能部分并应用 Lie-Trotter 或 Strang 分解的结果。具体来说，记 $r_n \\approx r(t_n)$ 和 $v_n \\approx \\dot{r}(t_n)$，且 $t_{n+1} = t_n + h$。速度 Verlet 的更新规则是\n$$\nr_{n+1} = r_n + h\\,v_n + \\frac{h^2}{2} a(r_n),\n$$\n$$\na_{n} = \\frac{F(r_n)}{\\mu}, \\quad a_{n+1} = \\frac{F(r_{n+1})}{\\mu},\n$$\n$$\nv_{n+1} = v_n + \\frac{h}{2}\\left[a(r_n) + a(r_{n+1})\\right].\n$$\n这个方案是时间可逆的：如果使用 $h$ 进行一次更新，然后反转速度并使用 $-h$ 进行更新，系统将恢复到原始状态。它是辛几何的，因为它可以被解释为在 $T(p)$ 和 $V(q)$ 下的精确流的组合，而这两个流本身都是辛的，这种组合保持了辛性。对于光滑势，该方法对状态的全局误差为 $\\mathcal{O}(h^2)$，并且表现出有界的振荡能量误差，这与后向误差分析一致：数值轨迹精确地守恒一个修正的哈密顿量 $H_h$，它与原始哈密顿量 $H$ 相差 $\\mathcal{O}(h^2)$。\n\n算法实现如下：\n1. 在简约单位中初始化参数：$m=1$，因此 $\\mu=1/2$，$\\epsilon=1$，$\\sigma=1$。选择初始条件 $r(0)=1.3\\sigma$ 和 $v(0)=0$，这位于势能最小值 $r_m = 2^{1/6}\\sigma$ 附近，同时避免了在非常小的 $r$ 处的强排斥核心。\n2. 计算初始加速度 $a_0 = F(r_0)/\\mu$ 和初始能量 $E_0 = \\frac{1}{2}\\mu v_0^2 + U(r_0)$。\n3. 对于给定的时间步长 $h$，迭代速度 Verlet 更新 $N=10^6$ 步：\n   - 使用 $r_n$、$v_n$ 和 $a_n$ 更新 $r_{n+1}$。\n   - 计算 $a_{n+1} = F(r_{n+1})/\\mu$。\n   - 使用平均加速度更新 $v_{n+1}$。\n4. 计算最终能量 $E_N = \\frac{1}{2}\\mu v_N^2 + U(r_N)$ 和能量漂移 $\\Delta E = E_N - E_0$。\n5. 对测试套件中的时间步长 $h=0.002$ 和 $h=0.02$ 重复以上步骤。\n\n由于速度 Verlet 方法是辛几何和时间可逆的，只要 $h$ 低于由操作区域附近 $U(r)$ 的局部刚度（曲率）设定的稳定性阈值，长时间内的 $\\Delta E$ 预计会很小，并表现为有界振荡，而不是系统性漂移。较大的时间步长测试了系统对该阈值的接近程度，在此情况下，能量偏差会增加，但如果保持稳定，则应保持有界。\n\n计算注意事项：\n- 每一步的操作是恒定的：在简约单位中，计算 $F(r)$ 和 $U(r)$ 包括几次乘法和通过重复乘法实现的幂运算，避免了昂贵的函数调用。\n- 对于 $N=10^6$ 步，在紧凑循环中迭代更新对于两个测试用例是可行的。\n- 所有报告的能量漂移都是无量纲的，以 $\\epsilon$ 为单位。\n- 程序实现了所描述的算法，并输出一行，其中包含按给定顺序排列的、针对指定 $h$ 值的能量漂移，并用方括号括起来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef lennard_jones_force(r, epsilon=1.0, sigma=1.0):\n    \"\"\"\n    Compute the radial Lennard-Jones force F(r) = -dU/dr for r > 0.\n    F(r) = 24*epsilon * [ 2*(sigma^12)/r^13 - (sigma^6)/r^7 ].\n    Uses reduced units by default: epsilon = 1, sigma = 1.\n    \"\"\"\n    # Guard against non-positive r to avoid division by zero; reflect minimally.\n    if r = 0.0:\n        # If r is non-positive due to numerical error, gently push it positive.\n        r = abs(r) if r != 0.0 else np.finfo(float).tiny\n    inv_r = 1.0 / r\n    s_over_r = sigma * inv_r\n    s_over_r2 = s_over_r * s_over_r\n    s_over_r6 = s_over_r2 * s_over_r2 * s_over_r2  # (sigma/r)^6\n    s_over_r12 = s_over_r6 * s_over_r6             # (sigma/r)^12\n    # F = 24*epsilon * ( 2*s_over_r12/r - s_over_r6/r )\n    return 24.0 * epsilon * inv_r * (2.0 * s_over_r12 - s_over_r6)\n\ndef lennard_jones_potential(r, epsilon=1.0, sigma=1.0):\n    \"\"\"\n    Compute the Lennard-Jones potential U(r) = 4*epsilon * [ (sigma/r)^12 - (sigma/r)^6 ].\n    \"\"\"\n    if r = 0.0:\n        r = abs(r) if r != 0.0 else np.finfo(float).tiny\n    inv_r = 1.0 / r\n    s_over_r = sigma * inv_r\n    s_over_r2 = s_over_r * s_over_r\n    s_over_r6 = s_over_r2 * s_over_r2 * s_over_r2\n    s_over_r12 = s_over_r6 * s_over_r6\n    return 4.0 * epsilon * (s_over_r12 - s_over_r6)\n\ndef simulate_energy_drift(h_values, N_steps, r0, v0, m=1.0, epsilon=1.0, sigma=1.0):\n    \"\"\"\n    Simulate the relative-coordinate LJ system for each time step in h_values\n    using velocity Verlet for N_steps, and return a list of energy drifts\n    DeltaE = E_final - E_initial in units of epsilon.\n    \"\"\"\n    mu = 0.5 * m  # reduced mass for two identical particles\n\n    # Initialize states and accelerations for each h\n    states = []\n    for h in h_values:\n        r = float(r0)\n        v = float(v0)\n        a = lennard_jones_force(r, epsilon, sigma) / mu\n        E0 = 0.5 * mu * v * v + lennard_jones_potential(r, epsilon, sigma)\n        states.append([h, r, v, a, E0])\n\n    # Tight integration loop\n    for _ in range(N_steps):\n        # Update each state using velocity Verlet\n        # Unroll loop for performance when small number of h_values\n        if len(states) == 1:\n            h, r, v, a, E0 = states[0]\n            r_new = r + h * v + 0.5 * h * h * a\n            a_new = lennard_jones_force(r_new, epsilon, sigma) / mu\n            v_new = v + 0.5 * h * (a + a_new)\n            states[0][1] = r_new\n            states[0][2] = v_new\n            states[0][3] = a_new\n        elif len(states) == 2:\n            # First state\n            h0, r0s, v0s, a0s, E00 = states[0]\n            r0_new = r0s + h0 * v0s + 0.5 * h0 * h0 * a0s\n            a0_new = lennard_jones_force(r0_new, epsilon, sigma) / mu\n            v0_new = v0s + 0.5 * h0 * (a0s + a0_new)\n            states[0][1] = r0_new\n            states[0][2] = v0_new\n            states[0][3] = a0_new\n            # Second state\n            h1, r1s, v1s, a1s, E01 = states[1]\n            r1_new = r1s + h1 * v1s + 0.5 * h1 * h1 * a1s\n            a1_new = lennard_jones_force(r1_new, epsilon, sigma) / mu\n            v1_new = v1s + 0.5 * h1 * (a1s + a1_new)\n            states[1][1] = r1_new\n            states[1][2] = v1_new\n            states[1][3] = a1_new\n        else:\n            # General case\n            for i in range(len(states)):\n                h, r, v, a, E0 = states[i]\n                r_new = r + h * v + 0.5 * h * h * a\n                a_new = lennard_jones_force(r_new, epsilon, sigma) / mu\n                v_new = v + 0.5 * h * (a + a_new)\n                states[i][1] = r_new\n                states[i][2] = v_new\n                states[i][3] = a_new\n\n    # Compute energy drifts\n    drifts = []\n    for h, r, v, a, E0 in states:\n        E_final = 0.5 * mu * v * v + lennard_jones_potential(r, epsilon, sigma)\n        drifts.append(E_final - E0)\n    return drifts\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Two time steps to test: happy path and near-stability boundary.\n    h_values = [0.002, 0.02]\n    N_steps = 1_000_000\n    # Initial conditions in reduced units\n    r0 = 1.3  # sigma = 1\n    v0 = 0.0  # starting at rest\n    # Run simulation and collect energy drifts in units of epsilon.\n    results = simulate_energy_drift(h_values, N_steps, r0, v0, m=1.0, epsilon=1.0, sigma=1.0)\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在实践中观察了速度Verlet算法的效果后，理解其理论局限性至关重要。本练习使用谐振子这一原子振动的基本模型，来进行线性稳定性分析。通过推导稳定性条件，您将明白为何时间步长的选择并非随意的，而是受到系统最高频率的严格限制 ()。",
            "id": "3828011",
            "problem": "在多尺度材料模拟的原子尺度部分中，围绕平衡位置的晶格振动通常被建模为谐振子，并使用像速度Verlet这样的辛格式进行积分，以保持其几何结构。考虑一个由牛顿第二定律 $\\ddot{q}(t) + \\omega^{2} q(t) = 0$ 支配的一维谐振子，其中 $q(t)$ 是位移，$\\omega$ 是与势阱局部曲率相关的角频率。应用速度Verlet方法，使用恒定的时间步长 $h$，通过标准的三个子步骤将状态 $(q_{n}, v_{n})$ 推进到 $(q_{n+1}, v_{n+1})$：半步速度更新、全步位置更新以及最后的半步速度更新，其中加速度由谐势 $V(q) = \\frac{1}{2} \\omega^{2} q^{2}$ 产生的力以及单位质量给出。从牛顿第二定律和速度Verlet的定义出发，推导相空间中的单步线性更新，其形式为一个 $2 \\times 2$ 的放大矩阵，该矩阵将此线性系统在时间 $t_{n}$ 的状态映射到 $t_{n+1}$。对该放大矩阵进行线性稳定性分析，并确定无量纲步长 $z = h \\omega$ 的集合，使得所有特征值都位于单位圆上，这与有界振荡传播相一致。利用此分析，报告出对于谐振子，能使速度Verlet方法保持线性稳定的无量纲步长 $z$ 的上确界 $z_{\\max}$。将最终答案表示为单个实数。不包含单位。",
            "solution": "该问题要求推导一维谐振子的速度Verlet积分的线性稳定性极限。分析过程主要分为三个阶段：首先，将单步速度Verlet更新表示为矩阵运算；其次，求出该矩阵的特征值；第三，确定在何种条件下这些特征值能导致稳定（非发散）的演化。\n\n谐振子的运动方程为 $\\ddot{q}(t) + \\omega^{2} q(t) = 0$。在单位质量（$m=1$）下，根据牛顿第二定律 $F = ma$，力为 $F(q) = -\\omega^{2} q$。因此，加速度为 $a(q) = -\\omega^{2} q$。系统在离散时间步 $t_n$ 的状态由相空间矢量 $(q_n, v_n) = (q(t_n), \\dot{q}(t_n))$ 给出。\n\n速度Verlet算法通过三个顺序更新，在一个时间步长 $h$ 内将状态从 $(q_n, v_n)$ 推进到 $(q_{n+1}, v_{n+1})$：\n\n1.  **半步速度更新**：使用当前位置 $q_n$ 处的加速度来将速度推进半步。加速度为 $a_n = a(q_n) = -\\omega^2 q_n$。\n    $$v_{n+1/2} = v_n + \\frac{h}{2} a_n = v_n - \\frac{h^2 \\omega^2}{2} q_n$$\n\n2.  **全步位置更新**：使用半步速度 $v_{n+1/2}$ 来将位置推进一个完整的时间步。\n    $$q_{n+1} = q_n + h v_{n+1/2}$$\n    代入第一步中 $v_{n+1/2}$ 的表达式：\n    $$q_{n+1} = q_n + h \\left(v_n - \\frac{h \\omega^2}{2} q_n\\right) = \\left(1 - \\frac{h^2 \\omega^2}{2}\\right) q_n + h v_n$$\n\n3.  **最终半步速度更新**：使用新位置 $q_{n+1}$ 处的加速度来将速度再推进半步。加速度为 $a_{n+1} = a(q_{n+1}) = -\\omega^2 q_{n+1}$。\n    $$v_{n+1} = v_{n+1/2} + \\frac{h}{2} a_{n+1} = v_{n+1/2} - \\frac{h \\omega^2}{2} q_{n+1}$$\n    代入 $v_{n+1/2}$ 和 $q_{n+1}$ 的表达式：\n    $$v_{n+1} = \\left(v_n - \\frac{h \\omega^2}{2} q_n\\right) - \\frac{h \\omega^2}{2} \\left[ \\left(1 - \\frac{h^2 \\omega^2}{2}\\right) q_n + h v_n \\right]$$\n    我们按 $q_n$ 和 $v_n$ 对各项进行分组：\n    $$v_{n+1} = \\left(-\\frac{h \\omega^2}{2} - \\frac{h \\omega^2}{2}\\left(1 - \\frac{h^2 \\omega^2}{2}\\right)\\right) q_n + \\left(1 - \\frac{h^2 \\omega^2}{2}\\right) v_n$$\n    $$v_{n+1} = \\left(-h \\omega^2 + \\frac{h^3 \\omega^4}{4}\\right) q_n + \\left(1 - \\frac{h^2 \\omega^2}{2}\\right) v_n$$\n    $$v_{n+1} = -h \\omega^2 \\left(1 - \\frac{h^2 \\omega^2}{4}\\right) q_n + \\left(1 - \\frac{h^2 \\omega^2}{2}\\right) v_n$$\n\n现在，我们可以将单步更新写成一个矩阵方程，这定义了放大矩阵 $\\mathbf{A}$：\n$$\n\\begin{pmatrix} q_{n+1} \\\\ v_{n+1} \\end{pmatrix} =\n\\begin{pmatrix}\n1 - \\frac{h^2 \\omega^2}{2}  h \\\\\n-h \\omega^2 \\left(1 - \\frac{h^2 \\omega^2}{4}\\right)  1 - \\frac{h^2 \\omega^2}{2}\n\\end{pmatrix}\n\\begin{pmatrix} q_n \\\\ v_n \\end{pmatrix}\n= \\mathbf{A} \\begin{pmatrix} q_n \\\\ v_n \\end{pmatrix}\n$$\n\n对于线性稳定性分析，我们研究放大矩阵 $\\mathbf{A}$ 的特征值。系统稳定的充分必要条件是所有特征值的模都小于或等于1。对于像谐振子这样的保守系统，稳定性要求特征值位于复平面的单位圆上，即 $|\\lambda| = 1$。\n\n我们引入无量纲步长 $z = h \\omega$。矩阵 $\\mathbf{A}$ 可以用 $z$ 表示为：\n$$\n\\mathbf{A} =\n\\begin{pmatrix}\n1 - \\frac{z^2}{2}  \\frac{z}{\\omega} \\\\\n-\\omega z \\left(1 - \\frac{z^2}{4}\\right)  1 - \\frac{z^2}{2}\n\\end{pmatrix}\n$$\n特征值 $\\lambda$ 是特征方程 $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$ 的根。特征多项式为 $\\lambda^2 - \\mathrm{Tr}(\\mathbf{A})\\lambda + \\det(\\mathbf{A}) = 0$。\n\n我们来计算 $\\mathbf{A}$ 的迹和行列式：\n$$\\mathrm{Tr}(\\mathbf{A}) = \\left(1 - \\frac{z^2}{2}\\right) + \\left(1 - \\frac{z^2}{2}\\right) = 2 - z^2$$\n$$\n\\det(\\mathbf{A}) = \\left(1 - \\frac{z^2}{2}\\right)^2 - \\left(\\frac{z}{\\omega}\\right) \\left(-\\omega z \\left(1 - \\frac{z^2}{4}\\right)\\right)\n= \\left(1 - z^2 + \\frac{z^4}{4}\\right) + z^2 \\left(1 - \\frac{z^2}{4}\\right)\n= 1 - z^2 + \\frac{z^4}{4} + z^2 - \\frac{z^4}{4} = 1\n$$\n$\\det(\\mathbf{A})=1$ 的事实是像速度Verlet这类辛积分器的一个标志，因为它意味着线性系统的相空间面积守恒。\n\n特征方程为：\n$$\\lambda^2 - (2 - z^2)\\lambda + 1 = 0$$\n根（特征值）由二次求根公式给出：\n$$\\lambda = \\frac{(2 - z^2) \\pm \\sqrt{(2 - z^2)^2 - 4}}{2}$$\n为了使特征值位于单位圆上，它们必须是复共轭对（或为实数且等于 $\\pm 1$）。这要求该二次方程的判别式为非正数：\n$$\\Delta = (2 - z^2)^2 - 4 \\le 0$$\n这个不等式可以对 $z$ 求解：\n$$(2 - z^2)^2 \\le 4$$\n两边取平方根得到：\n$$|2 - z^2| \\le 2$$\n这等价于复合不等式：\n$$-2 \\le 2 - z^2 \\le 2$$\n我们分别分析这两个部分：\n1.  $2 - z^2 \\le 2 \\implies -z^2 \\le 0 \\implies z^2 \\ge 0$。这对实数 $z$ 总是成立的。\n2.  $-2 \\le 2 - z^2 \\implies z^2 \\le 4$。\n\n由于 $z = h \\omega$ 代表物理上的时间步长和频率，我们必须有 $z \\ge 0$。因此，稳定性的条件是 $0 \\le z \\le 2$。该积分格式对于闭区间 $[0, 2]$ 内的所有无量纲步长 $z$ 都是线性稳定的。\n\n问题要求的是这组无量纲步长的上确界 $z_{\\max}$。区间 $[0, 2]$ 的上确界是 $2$。在边界 $z=2$ 处，特征值为 $\\lambda = \\frac{(2-4) \\pm \\sqrt{0}}{2} = -1$，该值位于单位圆上，但在实践中可能导致振荡不稳定性。对于任何 $z  2$，特征值会变为实数，其中一个的模大于 $1$，从而导致指数增长和数值不稳定性。\n\n因此，保持线性稳定的无量纲步长的上确界是 $2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "虽然二阶的速度Verlet方法很稳健，但许多应用场景要求更高的精度。这个高级练习将探索如何利用复合方法（一种几何积分中的强大技术）来构建一个四阶辛积分器。通过推导这个高阶方案的系数，您将学习到如何从简单的积分器出发，构建出更复杂、更精确的算法 ()。",
            "id": "3828038",
            "problem": "考虑一个多尺度材料模拟中的原子级子问题，该子问题由一个可分离的哈密顿量 $H(q,p) = T(p) + V(q)$ 控制，其中 $q \\in \\mathbb{R}^{d}$ 是位置，$p \\in \\mathbb{R}^{d}$ 是动量，$d$ 是一个正整数。令 $\\mathcal{L}_{A}$ 和 $\\mathcal{L}_{B}$ 分别表示与 $T$ 和 $V$ 相关联的刘维尔算子，由正则泊松括号定义，使得在时间 $h0$ 内的精确流分别为 $\\exp(h \\mathcal{L}_{A})$ 和 $\\exp(h \\mathcal{L}_{B})$。一个对称的二阶（$2$nd-order）Strang 分裂法由 $\\exp\\!\\big(\\frac{h}{2}\\mathcal{L}_{A}\\big)\\exp(h\\mathcal{L}_{B})\\exp\\!\\big(\\frac{h}{2}\\mathcal{L}_{A}\\big)$ 给出。通过以回文排列方式组合三个缩放副本，构造此对称二阶方法的一个四阶辛组合，使得步长 $h$ 上的总单步映射具有以下形式\n$$\n\\Phi_{h} \\;=\\; \\exp(a_{1} h\\,\\mathcal{L}_{A})\\,\\exp(b_{1} h\\,\\mathcal{L}_{B})\\,\\exp(a_{2} h\\,\\mathcal{L}_{A})\\,\\exp(b_{2} h\\,\\mathcal{L}_{B})\\,\\exp(a_{3} h\\,\\mathcal{L}_{A})\\,\\exp(b_{3} h\\,\\mathcal{L}_{B})\\,\\exp(a_{4} h\\,\\mathcal{L}_{A}),\n$$\n其回文结构 $a_{1}=a_{4}$、$a_{2}=a_{3}$ 和 $b_{1}=b_{3}$ 保证了时间可逆性。从流的基本定义和 Baker–Campbell–Hausdorff (BCH) 公式出发，推导系数 $\\{a_{i}\\}_{i=1}^{4}$ 和 $\\{b_{i}\\}_{i=1}^{3}$ 为达到四阶精度所必须满足的阶条件，并解析地求解这些条件。明确验证您的系数满足四阶精度所需的一致性条件和抵消条件，并且在修正生成元中的主导局部误差项为 $\\mathcal{O}(h^{5})$。以封闭形式提供系数 $\\{a_{i}\\}_{i=1}^{4}$ 和 $\\{b_{i}\\}_{i=1}^{3}$ 作为您的最终答案。不需要四舍五入，系数也没有单位。将您的最终答案表示为按 $(a_{1}, a_{2}, a_{3}, a_{4}, b_{1}, b_{2}, b_{3})$ 顺序排列的单行矩阵。",
            "solution": "所提出的问题要求为可分离哈密顿系统构建并验证一个四阶辛积分器。该积分器由与哈密顿量的动能和势能部分相关的流的特定回文组合定义。任务是推导该组合的系数为达到四阶精度所需满足的条件，并求解这些系数。\n\n该问题在科学上是适定的。它涉及哈密顿力学中几何数值积分的一个标准课题，即通过组合低阶对称方法来创建高阶方法。刘维尔算子、Baker-Campbell-Hausdorff (BCH) 公式以及阶条件概念的使用是该领域的核心和恰当方法。所提供的积分器结构是四阶对称组合的一种著名形式。因此，我们着手求解。\n\n设哈密顿量为 $H(q,p) = T(p) + V(q)$。相应的运动方程由刘维尔算子 $\\mathcal{L}_H = \\{ \\cdot, H \\}$ 生成，其中 $\\{ \\cdot, \\cdot \\}$ 是泊松括号。由于可分离性，$\\mathcal{L}_H = \\mathcal{L}_T + \\mathcal{L}_V$。我们记 $\\mathcal{L}_A = \\mathcal{L}_T$ 且 $\\mathcal{L}_B = \\mathcal{L}_V$。在步长 $h0$ 上的精确时间演化由流 $\\exp(h(\\mathcal{L}_A+\\mathcal{L}_B))$ 给出。\n\n数值积分器的目标是逼近此精确流。问题提出了一个形式如下的对称单步映射：\n$$\n\\Phi_{h} \\;=\\; \\exp(a_{1} h\\,\\mathcal{L}_{A})\\,\\exp(b_{1} h\\,\\mathcal{L}_{B})\\,\\exp(a_{2} h\\,\\mathcal{L}_{A})\\,\\exp(b_{2} h\\,\\mathcal{L}_{B})\\,\\exp(a_{3} h\\,\\mathcal{L}_{A})\\,\\exp(b_{3} h\\,\\mathcal{L}_{B})\\,\\exp(a_{4} h\\,\\mathcal{L}_{A})\n$$\n具有回文约束 $a_{1}=a_{4}$、$a_{2}=a_{3}$ 和 $b_{1}=b_{3}$。这种对称性确保了该方法是时间可逆的，即 $\\Phi_h^{-1} = \\Phi_{-h}$。对称性的一个关键推论（可从 Baker-Campbell-Hausdorff (BCH) 公式推导）是，生成该映射的有效刘维尔算子 $\\mathcal{L}_{\\text{eff}}$（其中 $\\Phi_h = \\exp(h \\mathcal{L}_{\\text{eff}})$）在其误差项中只包含 $h$ 的偶数次幂：\n$$\n\\mathcal{L}_{\\text{eff}} = (\\mathcal{L}_A + \\mathcal{L}_B) + \\mathcal{O}(h^2)\n$$\n为达到四阶精度，我们必须确保 $\\mathcal{L}_{\\text{eff}} = (\\mathcal{L}_A + \\mathcal{L}_B) + \\mathcal{O}(h^4)$，这意味着 $\\mathcal{O}(h^2)$ 的误差项必须消失。\n\n问题指出，此方法是一个对称二阶方法的组合。指定的二阶方法是 Strang 分裂法：$S_2(h) = \\exp(\\frac{h}{2}\\mathcal{L}_{A})\\exp(h\\mathcal{L}_{B})\\exp(\\frac{h}{2}\\mathcal{L}_{A})$。$S_2(h)$ 的三个缩放副本的一般对称组合形式为 $\\Phi_h = S_2(\\gamma_1 h) S_2(\\gamma_2 h) S_2(\\gamma_1 h)$，其中 $\\gamma_1, \\gamma_2$ 是某些缩放因子。展开此组合可得：\n$$\n\\Phi_h = \\left[\\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right) \\exp(\\gamma_1 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right)\\right] \\left[\\exp\\left(\\frac{\\gamma_2 h}{2}\\mathcal{L}_{A}\\right) \\exp(\\gamma_2 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_2 h}{2}\\mathcal{L}_{A}\\right)\\right] \\left[\\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right) \\exp(\\gamma_1 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right)\\right]\n$$\n通过合并涉及 $\\mathcal{L}_A$ 的相邻项，我们得到：\n$$\n\\Phi_h = \\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right) \\exp(\\gamma_1 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_1+\\gamma_2}{2}h\\mathcal{L}_{A}\\right) \\exp(\\gamma_2 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_1+\\gamma_2}{2}h\\mathcal{L}_{A}\\right) \\exp(\\gamma_1 h\\mathcal{L}_{B}) \\exp\\left(\\frac{\\gamma_1 h}{2}\\mathcal{L}_{A}\\right)\n$$\n此表达式与问题陈述中给出的结构相匹配。通过比较系数，我们建立以下关系：\n$a_1 = \\frac{\\gamma_1}{2}$，$b_1 = \\gamma_1$，$a_2 = \\frac{\\gamma_1+\\gamma_2}{2}$，$b_2 = \\gamma_2$。\n回文约束 $a_3=a_2$、$a_4=a_1$、$b_3=b_1$ 在此构造下自动满足。\n\n我们现在推导 $\\gamma_1$ 和 $\\gamma_2$ 的阶条件。从 BCH 公式可知，二阶 Strang 分裂法 $S_2(h)$ 的有效刘维尔算子为：\n$$\n\\mathcal{L}_{\\text{eff}, S2}(h) = (\\mathcal{L}_A + \\mathcal{L}_B) + h^2 \\mathcal{E}_3 + h^4 \\mathcal{E}_5 + \\dots\n$$\n其中 $\\mathcal{E}_3$ 是一个涉及 $\\mathcal{L}_A$ 和 $\\mathcal{L}_B$ 的对易子的非零项，具体为 $\\mathcal{E}_3 = \\frac{1}{12}[\\mathcal{L}_A,[\\mathcal{L}_B,\\mathcal{L}_A]] + \\frac{1}{24}[\\mathcal{L}_B,[\\mathcal{L}_B,\\mathcal{L}_A]]$。由于组合方法指数中的算子都与 $h$ 成正比，它们的对易子至少为 $\\mathcal{O}(h^2)$。为了推导高达四阶的条件，我们可以将和的指数近似为有效刘维尔算子指数的和。因此，$\\Phi_h$ 的有效刘维尔算子是其各分量有效刘维尔算子的和：\n$$\nh \\mathcal{L}_{\\text{eff}, \\Phi} \\approx h \\mathcal{L}_{\\text{eff}, S2}(\\gamma_1 h) + h \\mathcal{L}_{\\text{eff}, S2}(\\gamma_2 h) + h \\mathcal{L}_{\\text{eff}, S2}(\\gamma_1 h)\n$$\n代入 $\\mathcal{L}_{\\text{eff}, S2}$ 的展开式：\n$$\n\\mathcal{L}_{\\text{eff}, \\Phi} \\approx \\gamma_1 ((\\mathcal{L}_A + \\mathcal{L}_B) + (\\gamma_1 h)^2 \\mathcal{E}_3) + \\gamma_2 ((\\mathcal{L}_A + \\mathcal{L}_B) + (\\gamma_2 h)^2 \\mathcal{E}_3) + \\gamma_1 ((\\mathcal{L}_A + \\mathcal{L}_B) + (\\gamma_1 h)^2 \\mathcal{E}_3) + \\mathcal{O}(h^4)\n$$\n按 $h$ 的幂次收集项：\n$$\n\\mathcal{L}_{\\text{eff}, \\Phi} = (2\\gamma_1 + \\gamma_2)(\\mathcal{L}_A + \\mathcal{L}_B) + (2\\gamma_1^3 + \\gamma_2^3)h^2 \\mathcal{E}_3 + \\mathcal{O}(h^4)\n$$\n要使 $\\Phi_h$ 成为一个四阶积分器，其有效刘维尔算子必须与精确算子匹配到 $\\mathcal{O}(h^4)$。这产生了两个条件：\n1.  **一致性（一阶）：** $(\\mathcal{L}_A + \\mathcal{L}_B)$ 的系数必须为 $1$。\n    $$2\\gamma_1 + \\gamma_2 = 1$$\n2.  **三阶误差的抵消（为达到四阶）：** $h^2 \\mathcal{E}_3$ 项的系数必须为零。\n    $$2\\gamma_1^3 + \\gamma_2^3 = 0$$\n\n我们求解这个非线性方程组。由第一个方程，我们有 $\\gamma_2 = 1 - 2\\gamma_1$。将其代入第二个方程：\n$$\n2\\gamma_1^3 + (1 - 2\\gamma_1)^3 = 0\n$$\n这可以写成 $2\\gamma_1^3 = -(1 - 2\\gamma_1)^3 = (2\\gamma_1 - 1)^3$。对两边取实数立方根得到：\n$$\n2^{1/3} \\gamma_1 = 2\\gamma_1 - 1\n$$\n求解 $\\gamma_1$：\n$$\n1 = 2\\gamma_1 - 2^{1/3}\\gamma_1 = \\gamma_1(2 - 2^{1/3}) \\implies \\gamma_1 = \\frac{1}{2 - 2^{1/3}}\n$$\n然后，我们求 $\\gamma_2$：\n$$\n\\gamma_2 = 1 - 2\\gamma_1 = 1 - \\frac{2}{2 - 2^{1/3}} = \\frac{(2 - 2^{1/3}) - 2}{2 - 2^{1/3}} = \\frac{-2^{1/3}}{2 - 2^{1/3}}\n$$\n在确定了 $\\gamma_1$ 和 $\\gamma_2$ 后，我们可以求出系数 $\\{a_i\\}$ 和 $\\{b_i\\}$：\n$a_1 = a_4 = \\frac{\\gamma_1}{2} = \\frac{1}{2(2 - 2^{1/3})}$\n$b_1 = b_3 = \\gamma_1 = \\frac{1}{2 - 2^{1/3}}$\n$b_2 = \\gamma_2 = \\frac{-2^{1/3}}{2 - 2^{1/3}}$\n$a_2 = a_3 = \\frac{\\gamma_1+\\gamma_2}{2} = \\frac{1}{2}(\\gamma_1 + 1 - 2\\gamma_1) = \\frac{1-\\gamma_1}{2} = \\frac{1}{2}\\left(1 - \\frac{1}{2 - 2^{1/3}}\\right) = \\frac{1}{2}\\left(\\frac{1 - 2^{1/3}}{2 - 2^{1/3}}\\right) = \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})}$\n\n我们验证这些系数是否满足所需条件。一致性条件要求 $\\sum a_i = 1$ 和 $\\sum b_i = 1$。\n$\\sum a_i = 2a_1 + 2a_2 = 2\\left(\\frac{1}{2(2-2^{1/3})}\\right) + 2\\left(\\frac{1-2^{1/3}}{2(2-2^{1/3})}\\right) = \\frac{1}{2-2^{1/3}} + \\frac{1-2^{1/3}}{2-2^{1/3}} = \\frac{1+1-2^{1/3}}{2-2^{1/3}} = \\frac{2-2^{1/3}}{2-2^{1/3}} = 1$。\n$\\sum b_i = 2b_1 + b_2 = 2\\left(\\frac{1}{2-2^{1/3}}\\right) + \\frac{-2^{1/3}}{2-2^{1/3}} = \\frac{2-2^{1/3}}{2-2^{1/3}} = 1$。\n一致性条件得到满足。四阶的抵消条件 $2\\gamma_1^3 + \\gamma_2^3 = 0$ 通过构造得到满足。这确保了修正生成元 $\\mathcal{L}_{\\text{eff}}$ 中的 $\\mathcal{O}(h^2)$ 项为零。因此，生成元中的主导误差项为 $\\mathcal{O}(h^4)$，这意味着方法 $\\Phi_h$ 的单步误差为 $\\mathcal{O}(h^5)$。该方法确实是四阶的。\n\n最终的系数为：\n$a_1 = a_4 = \\frac{1}{2(2 - 2^{1/3})}$\n$a_2 = a_3 = \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})}$\n$b_1 = b_3 = \\frac{1}{2 - 2^{1/3}}$\n$b_2 = \\frac{-2^{1/3}}{2 - 2^{1/3}}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2(2 - 2^{1/3})},  \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})},  \\frac{1 - 2^{1/3}}{2(2 - 2^{1/3})},  \\frac{1}{2(2 - 2^{1/3})},  \\frac{1}{2 - 2^{1/3}},  \\frac{-2^{1/3}}{2 - 2^{1/3}},  \\frac{1}{2 - 2^{1/3}} \\end{pmatrix}}\n$$"
        }
    ]
}