{
    "hands_on_practices": [
        {
            "introduction": "Metropolis 算法的核心在于其用于接受或拒绝系统状态变化的概率准则。为了直观地理解这一点，我们从一个简单的物理模型开始：一个在一维晶格上运动的粒子，其中某些位置存在能垒。通过比较粒子进入能垒（能量“上坡”）和离开能垒（能量“下坡”）的两种移动，我们将巩固对接受概率 $P_{\\text{acc}} = \\min(1, \\exp(-\\beta \\Delta E))$ 的理解，并体会温度和能量变化如何共同决定系统的演化。",
            "id": "2006008",
            "problem": "一个粒子被限制在一个由10个格点组成的一维晶格中，格点索引为 $i = 0, 1, 2, \\dots, 9$。该晶格采用周期性边界条件，这意味着格点 $i=9$ 与格点 $i=0$ 相邻。粒子的能量 $E(i)$ 取决于其在晶格上的位置。具体来说，对于格点 $i \\in \\{3, 4, 5\\}$，能量是一个正常数 $\\epsilon$；对于所有其他格点，能量为零。\n\n系统维持在恒定温度 $T$ 下，并使用 Metropolis 算法进行模拟。在此模拟中，该算法提议将粒子移动到相邻格点。提议分布是对称的，这意味着从格点 $i$ 提议移动到相邻格点 $j$ 的概率与从 $j$ 提议移动到 $i$ 的概率相同。\n\n我们考虑两个特定的基本移动：\n1.  **移动 A**：粒子尝试从其当前位置格点 $i_A = 2$ 移动到相邻格点 $j_A = 3$。\n2.  **移动 B**：粒子尝试从其当前位置格点 $i_B = 5$ 移动到相邻格点 $j_B = 6$。\n\n根据 Metropolis 接受准则，设 $P_A$ 为移动 A 的接受概率，$P_B$ 为移动 B 的接受概率。\n\n求解比率 $\\frac{P_B}{P_A}$，并用 $\\epsilon$、$T$ 和玻尔兹曼常数 $k_B$ 表示其解析表达式。",
            "solution": "对于具有对称提议分布的 Metropolis 更新，从格点 $i$ 移动到格点 $j$ 的接受概率为\n$$\nP_{\\text{acc}}(i\\to j)=\\min\\left(1,\\exp\\left(-\\beta\\left[E(j)-E(i)\\right]\\right)\\right),\n$$\n其中 $\\beta=\\frac{1}{k_{B}T}$。\n\n晶格上的能量为：对于 $i\\in\\{3,4,5\\}$，$E(i)=\\epsilon$；其他情况下 $E(i)=0$。\n\n对于移动 A：$i_{A}=2$ 且 $j_{A}=3$。则 $E(2)=0$ 且 $E(3)=\\epsilon$，所以\n$$\n\\Delta E_{A}=E(3)-E(2)=\\epsilon.\n$$\n因此，\n$$\nP_{A}=\\min\\left(1,\\exp\\left(-\\beta\\epsilon\\right)\\right)=\\exp\\left(-\\frac{\\epsilon}{k_{B}T}\\right),\n$$\n因为 $\\epsilon>0$ 意味着 $\\exp(-\\beta\\epsilon)<1$。\n\n对于移动 B：$i_{B}=5$ 且 $j_{B}=6$。则 $E(5)=\\epsilon$ 且 $E(6)=0$，所以\n$$\n\\Delta E_{B}=E(6)-E(5)=-\\epsilon.\n$$\n因此，\n$$\nP_{B}=\\min\\left(1,\\exp\\left(-\\beta(-\\epsilon)\\right)\\right)=\\min\\left(1,\\exp\\left(\\beta\\epsilon\\right)\\right)=1.\n$$\n\n因此，该比率为\n$$\n\\frac{P_{B}}{P_{A}}=\\frac{1}{\\exp\\left(-\\frac{\\epsilon}{k_{B}T}\\right)}=\\exp\\left(\\frac{\\epsilon}{k_{B}T}\\right).\n$$",
            "answer": "$$\\boxed{\\exp\\left(\\frac{\\epsilon}{k_{B}T}\\right)}$$"
        },
        {
            "introduction": "理解了单步的接受准则后，下一步是观察这些独立的决策如何串联起来，形成一条完整的模拟轨迹。本练习将引导您手动执行一次“Metropolis行走”，模拟一个在双势阱中的粒子，这是研究具有多个稳定态的系统的经典模型。通过追踪粒子在几个预设步骤中的位置变化，您将对算法的运作机制获得具体感受，特别是能量变化和随机数在决策过程中的关键作用。",
            "id": "2005950",
            "problem": "一位纳米技术专家正在研究一种分子开关，其状态可以用一个粒子的一维位置 $x$ 来表示。该粒子的势能（以任意单位计）由双阱势函数 $U(x) = \\alpha x^4 - \\gamma x^2$ 描述，其中常数 $\\alpha = 1.0$ 和 $\\gamma = 8.0$。该粒子与一个热浴接触，其行为可以通过基于Metropolis算法的蒙特卡洛模拟来建模。该系统的特征是一个恒定的逆温度 $\\beta = \\frac{1}{k_B T} = 2.0$。\n\n模拟以离散步长进行。在每一步中，通过将粒子的当前位置 $x_{current}$ 改变到一个新位置 $x_{trial} = x_{current} + \\Delta x$ 来提出一个尝试移动。位移 $\\Delta x$ 是一个预先确定的随机值。然后根据Metropolis判据接受或拒绝这个提议的移动：\n1. 如果能量变化 $\\Delta U = U(x_{trial}) - U(x_{current})$ 小于或等于零，则该移动总是被接受。\n2. 如果 $\\Delta U > 0$，则该移动以概率 $P_{accept} = \\exp(-\\beta \\Delta U)$ 被接受。为了实现这一点，从 $[0,1)$ 上的均匀分布中抽取一个随机数 $r$。如果 $r  P_{accept}$，则接受该移动；否则，拒绝该移动。\n3. 如果一个移动被接受，新位置就是 $x_{trial}$。如果被拒绝，粒子保持在 $x_{current}$。\n\n粒子最初被放置在与势能函数 $U(x)$ 的*负值*局部极小值对应的位置。你需要计算经过整整5个Metropolis步骤后粒子的位置。\n\n提供给你以下两个包含5个预先确定的随机数的序列：\n- 提议的步长位移序列，$\\Delta x$: $\\{0.30, -0.40, 0.10, 0.20, -0.25\\}$\n- 用于接受检查的随机数序列，$r$: $\\{0.51, 0.12, 0.65, 0.83, 0.47\\}$\n\n计算这5个步骤后粒子的最终位置。以数值形式报告你的答案，并四舍五入到三位有效数字。",
            "solution": "势能由 $U(x)=\\alpha x^{4}-\\gamma x^{2}$ 给出，其中 $\\alpha=1$ 和 $\\gamma=8$，所以 $U(x)=x^{4}-8x^{2}$。驻点满足 $U'(x)=4x^{3}-16x=4x(x^{2}-4)=0$，解得 $x=0, \\pm 2$。二阶导数 $U''(x)=12x^{2}-16$ 得出 $U''(0)=-160$（一个局部极大值）和 $U''(\\pm 2)=320$（局部极小值）。粒子从负值的极小值点开始，所以 $x_0=-2$。$U(-2)=-16$。\n在每个Metropolis步骤中，对于提议的位移 $\\Delta x$，尝试位置为 $x_{\\text{trial}}=x_{\\text{current}}+\\Delta x$，能量变化为 $\\Delta U=U(x_{\\text{trial}})-U(x_{\\text{current}})$。如果 $\\Delta U\\leq 0$，或者在 $\\Delta U>0$ 的情况下随机数 $r  \\exp(-\\beta\\Delta U)$（其中 $\\beta=2$），则接受移动。\n\n步骤 1：$x_{\\text{current}}=-2$，$\\Delta x=0.30$。$x_{\\text{trial}}=-1.70$。\n$U(-1.7) = -14.7679$，$\\Delta U=1.2321 > 0$。$P_{\\text{accept}}=\\exp(-2 \\cdot 1.2321) \\approx 0.085$。\n$r=0.51 > P_{\\text{accept}}$，拒绝。$x_1=-2$。\n\n步骤 2：$x_{\\text{current}}=-2$，$\\Delta x=-0.40$。$x_{\\text{trial}}=-2.40$。\n$U(-2.4) = -12.9024$，$\\Delta U=3.0976 > 0$。$P_{\\text{accept}}=\\exp(-2 \\cdot 3.0976) \\approx 0.002$。\n$r=0.12 > P_{\\text{accept}}$，拒绝。$x_2=-2$。\n\n步骤 3：$x_{\\text{current}}=-2$，$\\Delta x=0.10$。$x_{\\text{trial}}=-1.90$。\n$U(-1.9) = -15.8479$，$\\Delta U=0.1521 > 0$。$P_{\\text{accept}}=\\exp(-2 \\cdot 0.1521) \\approx 0.738$。\n$r=0.65  P_{\\text{accept}}$，接受。$x_3=-1.90$。\n\n步骤 4：$x_{\\text{current}}=-1.90$，$\\Delta x=0.20$。$x_{\\text{trial}}=-1.70$。\n$U(-1.9) = -15.8479$。$U(-1.7) = -14.7679$。$\\Delta U=1.08 > 0$。$P_{\\text{accept}}=\\exp(-2 \\cdot 1.08) \\approx 0.115$。\n$r=0.83 > P_{\\text{accept}}$，拒绝。$x_4=-1.90$。\n\n步骤 5：$x_{\\text{current}}=-1.90$，$\\Delta x=-0.25$。$x_{\\text{trial}}=-2.15$。\n$U(-1.9) = -15.8479$。$U(-2.15) = (-2.15)^4 - 8(-2.15)^2 \\approx -15.6124$。$\\Delta U \\approx 0.2355 > 0$。$P_{\\text{accept}}=\\exp(-2 \\cdot 0.2355) \\approx 0.624$。\n$r=0.47  P_{\\text{accept}}$，接受。$x_5=-2.15$。\n\n经过5个步骤后，粒子的最终位置是 $-2.15$。",
            "answer": "$$\\boxed{-2.15}$$"
        },
        {
            "introduction": "一次成功的模拟不仅仅是让系统状态发生变化，更关键的是要高效地探索整个相空间。我们能控制的一个关键参数是建议移动的步长。最后一个练习将我们的视角从单个步骤提升到算法的整体效率，并用“期望接受率”这一指标来衡量。我们将分析最大步长 $\\Delta x_{\\max}$ 的选择如何影响接受率，从而揭示蒙特卡洛模拟中一个根本性的权衡与优化问题。",
            "id": "2005960",
            "problem": "一个经典粒子被限制在从 $x=0$ 到 $x=L$ 的一维区域内。在此区域内，它受到一个线性势 $V(x) = \\alpha x$ 的作用，其中 $\\alpha$ 是一个正常数。在该区域之外，势能为无穷大。该系统与一个温度为 $T$ 的热库处于热接触状态。\n\n采用 Metropolis Monte Carlo 模拟，根据玻尔兹曼分布（Boltzmann distribution）对粒子的位置进行采样。在模拟的每一步中，都会提议一个从当前位置 $x_i$ 到新位置 $x_p = x_i + \\delta$ 的尝试性移动。步长 $\\delta$ 是一个从区间 $[-\\Delta x_{max}, \\Delta x_{max}]$ 上的均匀概率分布中抽取的随机变量。\n\n假设粒子当前位于盒子的正中心，$x_i = L/2$。最大步长设置为 $\\Delta x_{max} = L/4$。系统的物理参数和温度满足无量纲量 $\\beta \\alpha \\Delta x_{max} = 2.0$，其中 $\\beta = 1/(k_B T)$，$k_B$ 是玻尔兹曼常数（Boltzmann constant）。\n\n计算这一下次提议移动的期望接受率，该期望值是对所有可能生成的步长 $\\delta$ 进行平均得到的。结果以小数形式表示，并四舍五入到四位有效数字。",
            "solution": "在正则系综中，对于一个对称的提议，从 $x_{i}$ 移动到 $x_{p}=x_{i}+\\delta$ 的 Metropolis 接受概率为\n$$\nA(\\delta)=\\min\\left(1,\\exp\\left[-\\beta\\left(V(x_{p})-V(x_{i})\\right)\\right]\\right).\n$$\n当 $V(x)=\\alpha x$ 且 $x_{i}=L/2$ 时，能量变化为\n$$\n\\Delta E=V(x_{i}+\\delta)-V(x_{i})=\\alpha\\delta,\n$$\n所以\n$$\nA(\\delta)=\\min\\left(1,\\exp(-\\beta\\alpha\\,\\delta)\\right).\n$$\n因为 $\\Delta x_{\\max}=L/4$ 且 $x_{i}=L/2$，所以提议的位置 $x_{p}\\in[L/4,3L/4]\\subset[0,L]$，因此不会有因边界条件而拒绝移动的情况。步长 $\\delta$ 在 $[-\\Delta,\\Delta]$（其中 $\\Delta=\\Delta x_{\\max}$）上均匀分布，因此期望接受率为\n$$\nR=\\frac{1}{2\\Delta}\\int_{-\\Delta}^{\\Delta}A(\\delta)\\,d\\delta\n=\\frac{1}{2\\Delta}\\left(\\int_{-\\Delta}^{0}1\\,d\\delta+\\int_{0}^{\\Delta}\\exp(-\\beta\\alpha\\,\\delta)\\,d\\delta\\right).\n$$\n计算积分为，\n$$\n\\int_{-\\Delta}^{0}1\\,d\\delta=\\Delta,\\qquad\n\\int_{0}^{\\Delta}\\exp(-\\beta\\alpha\\,\\delta)\\,d\\delta=\\frac{1}{\\beta\\alpha}\\left(1-\\exp(-\\beta\\alpha\\Delta)\\right).\n$$\n因此，\n$$\nR=\\frac{1}{2\\Delta}\\left[\\Delta+\\frac{1}{\\beta\\alpha}\\left(1-\\exp(-\\beta\\alpha\\Delta)\\right)\\right].\n$$\n引入 $s=\\beta\\alpha\\Delta$，可得\n$$\nR=\\frac{1}{2}\\left[1+\\frac{1}{s}\\left(1-\\exp(-s)\\right)\\right].\n$$\n给定 $s=\\beta\\alpha\\Delta x_{\\max}=2.0$，上式变为\n$$\nR=\\frac{1}{2}\\left[1+\\frac{1}{2}\\left(1-\\exp(-2)\\right)\\right].\n$$\n数值上，$\\exp(-2)\\approx 0.135335283$，所以\n$$\nR\\approx \\frac{1}{2}\\left[1+0.5\\times(1-0.135335283)\\right]\n=\\frac{1}{2}\\left[1+0.4323323585\\right]\n\\approx 0.7161661792.\n$$\n四舍五入到四位有效数字，期望接受率为 $0.7162$。",
            "answer": "$$\\boxed{0.7162}$$"
        }
    ]
}