{
    "hands_on_practices": [
        {
            "introduction": "许多校准任务的本质是将线性模型拟合到数据。本练习将指导您从第一性原理出发，为一个简化的遥感场景推导普通最小二乘（OLS）估计量。掌握这一基本推导过程，是理解更复杂的自动化校准算法工作原理的坚实概念基础。",
            "id": "3827328",
            "problem": "考虑一个单波段辐射定标场景：一个星载光学传感器在固定的光照几何条件下，对一个均质、近似朗伯体的地表进行观测，且采集期间的大气变化可忽略不计。假设表观地表反射率被建模为传感器入瞳辐射亮度的零截距线性函数，并带有代表测量和建模误差的加性噪声。具体而言，假设模型为 $y = \\theta x + \\epsilon$，其中 $y$ 是无量纲反射率，$x$ 是传感器入瞳光谱辐射亮度，$\\theta$ 是一个未知的标量灵敏度参数，代表从辐射亮度到反射率的线性传感器响应（增益），而 $\\epsilon$ 是一个零均值随机误差。\n\n使用以下在同一目标上采集的配对观测值 $\\{(x_i,y_i)\\}_{i=1}^{n}$ 合成数据集，该数据集通过改变光照强度以覆盖一定范围的辐射亮度：\n- $x_1 = 5.0$ 且 $y_1 = 0.071$\n- $x_2 = 8.0$ 且 $y_2 = 0.122$\n- $x_3 = 12.0$ 且 $y_3 = 0.177$\n- $x_4 = 15.0$ 且 $y_4 = 0.2265$\n- $x_5 = 18.0$ 且 $y_5 = 0.264$\n- $x_6 = 22.0$ 且 $y_6 = 0.3335$\n- $x_7 = 26.0$ 且 $y_7 = 0.385$\n- $x_8 = 30.0$ 且 $y_8 = 0.454$\n\n所有 $x_i$ 的单位均为瓦特每平方米每球面度每微米 ($\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$)；所有 $y_i$ 均为无量纲。反射率模型 $y=\\theta x+\\epsilon$ 的合理性在于，在固定几何条件下，经过充分验证的朗伯关系表明，反射率与辐射亮度成正比，比例系数为一个与波段相关的常数。\n\n任务：\n1. 从普通最小二乘法 (OLS) 的定义出发，根据第一性原理推导零截距线性模型 $y=\\theta x+\\epsilon$ 的 OLS 估计量 $\\hat{\\theta}$ 的闭式表达式。\n2. 使用推导出的表达式和上述数据集，计算 $\\hat{\\theta}$ 的数值。将您的答案四舍五入至六位有效数字。$\\hat{\\theta}$ 的单位为“反射率/($\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$)”，但不要在最终的方框答案中包含单位。\n3. 简要解释在朗伯假设下 $\\hat{\\theta}$ 在传感器响应方面的物理意义，并讨论自动化的基于梯度的定标方法如何得到与手动推导 OLS 相同的解。\n\n你的最终回答在最后的方框答案中必须仅包含 $\\hat{\\theta}$ 的单一数值，并按要求四舍五入至六位有效数字。",
            "solution": "本问题要求推导和计算一个零截距线性模型的普通最小二乘法 (OLS) 估计量，然后在遥感背景下对结果进行解释。\n\n任务1：OLS 估计量 $\\hat{\\theta}$ 的推导\n\n关联表观地表反射率 $y$ 和传感器入瞳光谱辐射亮度 $x$ 的模型由下式给出：\n$$y = \\theta x + \\epsilon$$\n其中 $\\theta$ 是未知的灵敏度参数，$\\epsilon$ 是零均值随机误差。对于一组 $n$ 个观测值 $\\{(x_i, y_i)\\}_{i=1}^{n}$，OLS 方法旨在找到 $\\theta$ 的值，记为 $\\hat{\\theta}$，以最小化残差平方和。第 $i$ 个观测值的残差是观测值 $y_i$与模型预测值 $\\hat{y}_i = \\theta x_i$ 之间的差值。\n$$e_i = y_i - \\hat{y}_i = y_i - \\theta x_i$$\n残差平方和 $S(\\theta)$ 是需要最小化的目标函数：\n$$S(\\theta) = \\sum_{i=1}^{n} e_i^2 = \\sum_{i=1}^{n} (y_i - \\theta x_i)^2$$\n为了找到使 $S(\\theta)$ 最小化的 $\\theta$ 值，我们必须通过求 $S(\\theta)$ 相对于 $\\theta$ 的一阶导数并将其设为零来找到临界点。\n$$\\frac{dS}{d\\theta} = \\frac{d}{d\\theta} \\sum_{i=1}^{n} (y_i - \\theta x_i)^2$$\n利用微分的线性和链式法则：\n$$\\frac{dS}{d\\theta} = \\sum_{i=1}^{n} \\frac{d}{d\\theta} (y_i - \\theta x_i)^2 = \\sum_{i=1}^{n} 2(y_i - \\theta x_i) \\cdot \\frac{d}{d\\theta}(y_i - \\theta x_i)$$\n$$\\frac{dS}{d\\theta} = \\sum_{i=1}^{n} 2(y_i - \\theta x_i)(-x_i) = -2 \\sum_{i=1}^{n} (y_i x_i - \\theta x_i^2)$$\n将导数设为零以求得估计量 $\\hat{\\theta}$：\n$$-2 \\sum_{i=1}^{n} (y_i x_i - \\hat{\\theta} x_i^2) = 0$$\n$$\\sum_{i=1}^{n} (y_i x_i - \\hat{\\theta} x_i^2) = 0$$\n$$\\sum_{i=1}^{n} y_i x_i - \\sum_{i=1}^{n} \\hat{\\theta} x_i^2 = 0$$\n由于 $\\hat{\\theta}$ 相对于求和索引 $i$ 是一个常数，因此可以将其提取出来：\n$$\\sum_{i=1}^{n} y_i x_i = \\hat{\\theta} \\sum_{i=1}^{n} x_i^2$$\n求解 $\\hat{\\theta}$ 即可得到零截距线性模型的 OLS 估计量的闭式表达式：\n$$\\hat{\\theta} = \\frac{\\sum_{i=1}^{n} x_i y_i}{\\sum_{i=1}^{n} x_i^2}$$\n为了确认这对应于一个最小值，我们计算 $S(\\theta)$ 的二阶导数：\n$$\\frac{d^2S}{d\\theta^2} = \\frac{d}{d\\theta} \\left(-2 \\sum_{i=1}^{n} (y_i x_i - \\theta x_i^2)\\right) = -2 \\sum_{i=1}^{n} (-x_i^2) = 2 \\sum_{i=1}^{n} x_i^2$$\n由于辐射亮度值 $x_i$ 是实数且非负，并且并非所有 $x_i$ 都为零，因此总和 $\\sum_{i=1}^{n} x_i^2$ 严格为正。因此，$\\frac{d^2S}{d\\theta^2} > 0$，这证实了 $\\hat{\\theta}$ 使残差平方和最小化。\n\n任务2：$\\hat{\\theta}$ 的计算\n\n使用推导出的公式和给定的数据集，我们必须计算两个量：$\\sum_{i=1}^{8} x_i y_i$ 和 $\\sum_{i=1}^{8} x_i^2$。\n\n首先，我们计算乘积 $x_i y_i$ 和平方 $x_i^2$：\n- $i=1$: $x_1 y_1 = 5.0 \\times 0.071 = 0.355$; $x_1^2 = 5.0^2 = 25$\n- $i=2$: $x_2 y_2 = 8.0 \\times 0.122 = 0.976$; $x_2^2 = 8.0^2 = 64$\n- $i=3$: $x_3 y_3 = 12.0 \\times 0.177 = 2.124$; $x_3^2 = 12.0^2 = 144$\n- $i=4$: $x_4 y_4 = 15.0 \\times 0.2265 = 3.3975$; $x_4^2 = 15.0^2 = 225$\n- $i=5$: $x_5 y_5 = 18.0 \\times 0.264 = 4.752$; $x_5^2 = 18.0^2 = 324$\n- $i=6$: $x_6 y_6 = 22.0 \\times 0.3335 = 7.337$; $x_6^2 = 22.0^2 = 484$\n- $i=7$: $x_7 y_7 = 26.0 \\times 0.385 = 10.01$; $x_7^2 = 26.0^2 = 676$\n- $i=8$: $x_8 y_8 = 30.0 \\times 0.454 = 13.62$; $x_8^2 = 30.0^2 = 900$\n\n接下来，我们计算总和：\n$$\\sum_{i=1}^{8} x_i y_i = 0.355 + 0.976 + 2.124 + 3.3975 + 4.752 + 7.337 + 10.01 + 13.62 = 42.5715$$\n$$\\sum_{i=1}^{8} x_i^2 = 25 + 64 + 144 + 225 + 324 + 484 + 676 + 900 = 2842$$\n现在，我们可以计算 $\\hat{\\theta}$：\n$$\\hat{\\theta} = \\frac{42.5715}{2842} \\approx 0.014979415904$$\n按要求四舍五入到六位有效数字，我们得到：\n$$\\hat{\\theta} \\approx 0.0149794$$\n\n任务3：解释与讨论\n\n在物理上，参数 $\\hat{\\theta}$ 代表在给定观测条件下，传感器系统对特定光谱波段的估计辐射增益。它量化了将传感器入瞳辐射亮度转换为表观地表反射率的线性响应。较高的 $\\hat{\\theta}$ 值意味着产生给定反射率值所需的辐射亮度较小，表明灵敏度更高。$\\hat{\\theta}$ 的单位是辐射亮度的倒数，即 $(\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}})^{-1}$。在朗伯假设下，地表出射辐射亮度 $L$ 通过 $\\rho = \\frac{\\pi L}{E}$ 与入射辐照度 $E$ 和反射率 $\\rho$ 相关。传感器入瞳辐射亮度 $x$ 是 $L$ 和大气特性的函数。在这个简化模型中，$\\hat{\\theta}$ 包含了因子 $\\frac{\\pi}{E}$ 以及任何假设呈线性比例关系的大气衰减或路径辐射效应的综合影响。\n\n一个自动化的基于梯度的定标程序会使用迭代算法来寻求最小化相同的目标函数 $S(\\theta) = \\sum_{i=1}^{n} (y_i - \\theta x_i)^2$。例如，梯度下降法从一个初始猜测值 $\\theta_0$ 开始，并根据规则 $\\theta_{k+1} = \\theta_k - \\eta \\nabla S(\\theta_k)$ 对其进行更新，其中 $\\eta$ 是学习率，$\\nabla S$ 是梯度。如前所推导，梯度为 $\\frac{dS}{d\\theta} = -2\\sum (y_i - \\theta x_i) x_i$。该算法在与梯度相反的方向上迭代调整 $\\theta$，从而有效地沿着误差曲面“下降”至最小值。当梯度接近于零时，即当 $\\sum (y_i - \\theta x_i) x_i \\approx 0$ 时，该过程终止。这与手动 OLS 推导为求得精确最小值而解析求解的条件是相同的。因为目标函数 $S(\\theta)$ 是关于 $\\theta$ 的一个简单二次函数，它描述了一个具有唯一全局最小值的凸抛物线。因此，一个配置得当的基于梯度的优化算法保证会收敛到从 OLS 闭式表达式推导出的同一个唯一解。手动推导通过一个代数步骤提供了精确解，而自动化方法则通过数值迭代找到该解。",
            "answer": "$$\\boxed{0.0149794}$$"
        },
        {
            "introduction": "在实际应用中，简单的线性回归假设（如加性误差）并非总能得到满足；例如，在遥感数据中，乘性噪声就十分常见。本练习将展示一种强大的策略——对数变换，它能将一个具有乘性误差的模型转化为一个具有加性误差的等价模型，从而可以使用最大似然估计等标准方法进行求解。这种方法凸显了巧妙地重构问题是制定有效校准策略的关键一环。",
            "id": "3827331",
            "problem": "一台推扫式成像光谱仪正在使用野外标准板观测数据进行校准，以反演地表反射率。对于给定的光谱波段，辐射传输正向模型预测场景 $i$ 的模拟地表反射率为 $s_i \\in (0,1)$，而仪器报告的表观反射率为 $y_i \\in (0,1)$。一个增益参数 $a>0$ 用于解释由于飞行前校准不完善而导致的模拟反射率与测量反射率之间的残余乘性尺度差异。采集噪声主要是乘性的，这是由残余的双向反射分布函数和光照效应引起的，可以很好地用对数正态误差来近似。假设随机数据生成模型为\n$$\ny_i \\;=\\; a\\,s_i\\,\\varepsilon_i,\\quad \\varepsilon_i \\stackrel{\\text{i.i.d.}}{\\sim} \\text{Lognormal}(0,\\sigma^2),\n$$\n其中不同 $i$ 之间相互独立，且对于某个未知的 $\\sigma^2>0$，有 $\\ln \\varepsilon_i \\sim \\mathcal{N}(0,\\sigma^2)$。在手动校准中，分析师会调整 $a$，直到 $\\{(s_i,y_i)\\}$ 的散点图接近 1:1 线，这实际上是在对数尺度上操作；在自动校准中，增益 $a$ 是通过最大似然估计（MLE）来估计的。\n\n从对数正态和正态概率密度函数的定义以及独立似然的乘积法则出发，执行以下步骤。\n\n1. 证明对 $y_i$ 取对数可将乘性误差模型转换为如下形式的加性高斯误差模型\n$$\n\\ln y_i \\;=\\; \\ln a \\;+\\; \\ln s_i \\;+\\; e_i,\\quad e_i \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0,\\sigma^2).\n$$\n\n2. 使用转换后的模型，在不假设 $\\sigma^2$ 已知的情况下，写出联合样本 $\\{(s_i,y_i)\\}_{i=1}^n$ 的负对数似然函数，该函数是关于参数 $\\theta=\\ln a$ 和 $\\sigma^2$ 的函数。然后，通过对 $\\theta$ 进行最小化，同时将 $\\sigma^2$ 作为待排除的滋扰参数，推导出仅用 $\\{s_i,y_i\\}$ 表示的 MLE $\\hat{a}$ 的闭式表达式。\n\n3. 对包含六个场景的校准数据集计算 $\\hat{a}$ 的数值\n$$\n(s_i,y_i) \\in \\{(0.05,0.063),\\; (0.10,0.114),\\; (0.15,0.198),\\; (0.20,0.216),\\; (0.30,0.3672),\\; (0.45,0.54)\\}.\n$$\n将你最终报告的 $\\hat{a}$ 值四舍五入到 5 位有效数字。将最终值表示为无量纲量。",
            "solution": "**第1部分：转换为加性误差模型**\n\n给定场景 $i$ 的随机数据生成模型：\n$$\ny_i = a s_i \\varepsilon_i\n$$\n其中 $y_i$ 是表观反射率，$s_i$ 是模拟的地表反射率，$a$ 是一个正增益参数 ($a > 0$)，$\\varepsilon_i$ 是一个乘性误差项。所有量 $y_i, s_i, a$ 均为正数，这使得可以应用自然对数。\n\n对等式两边取自然对数，我们得到：\n$$\n\\ln(y_i) = \\ln(a s_i \\varepsilon_i)\n$$\n利用对数性质 $\\ln(xyz) = \\ln(x) + \\ln(y) + \\ln(z)$，该方程变为：\n$$\n\\ln(y_i) = \\ln(a) + \\ln(s_i) + \\ln(\\varepsilon_i)\n$$\n问题指出，误差项 $\\varepsilon_i$ 是独立同分布（i.i.d.）的，遵循对数正态分布，具体为 $\\varepsilon_i \\sim \\text{Lognormal}(0, \\sigma^2)$。根据对数正态分布的定义，这意味着该随机变量的对数遵循正态分布。在本例中，给定 $\\ln(\\varepsilon_i) \\sim \\mathcal{N}(0, \\sigma^2)$。\n\n我们定义一个新的误差变量 $e_i = \\ln(\\varepsilon_i)$。根据给定信息，这些新的误差项分布如下：\n$$\ne_i \\sim \\mathcal{N}(0, \\sigma^2)\n$$\n由于原始误差项 $\\varepsilon_i$ 是独立同分布的，所以转换后的误差项 $e_i$ 也是独立同分布的。\n\n将 $e_i$ 代入对数模型，我们得到所需的加性高斯误差模型：\n$$\n\\ln(y_i) = \\ln(a) + \\ln(s_i) + e_i, \\quad e_i \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0, \\sigma^2)\n$$\n这完成了推导的第一部分，证明了原始空间中的乘性对数正态误差对应于对数空间中的加性高斯误差。\n\n**第2部分：$a$ 的最大似然估计量的推导**\n\n我们从第1部分推导出的转换模型开始。让我们重新整理它以分离出误差项 $e_i$：\n$$\ne_i = \\ln(y_i) - \\ln(s_i) - \\ln(a) = \\ln\\left(\\frac{y_i}{s_i}\\right) - \\ln(a)\n$$\n我们将感兴趣的参数定义为 $\\theta = \\ln(a)$。那么 $e_i = \\ln(y_i/s_i) - \\theta$。\n对于均值为 $0$、方差为 $\\sigma^2$ 的单个正态分布误差项 $e_i$，其概率密度函数（PDF）为：\n$$\np(e_i | \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{e_i^2}{2\\sigma^2}\\right)\n$$\n因此，观测到单个数据点 $(s_i, y_i)$ 的似然是相应误差项 $e_i = \\ln(y_i/s_i) - \\theta$ 发生的概率。使用变量替换，给定 $s_i$ 和参数 $\\theta, \\sigma^2$ 时观测值 $y_i$ 的概率密度函数为：\n$$\nL_i(\\theta, \\sigma^2) = p(\\ln(y_i/s_i) | \\theta, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{\\left(\\ln(y_i/s_i) - \\theta\\right)^2}{2\\sigma^2}\\right)\n$$\n由于观测是独立的，联合样本 $\\{(s_i, y_i)\\}_{i=1}^n$ 的总似然是各个似然的乘积：\n$$\nL(\\theta, \\sigma^2) = \\prod_{i=1}^n L_i(\\theta, \\sigma^2) = \\prod_{i=1}^n \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{\\left(\\ln(y_i/s_i) - \\theta\\right)^2}{2\\sigma^2}\\right)\n$$\n$$\nL(\\theta, \\sigma^2) = \\left(\\frac{1}{2\\pi\\sigma^2}\\right)^{n/2} \\exp\\left(-\\frac{1}{2\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\theta\\right)^2\\right)\n$$\n对数似然 $\\mathcal{L}(\\theta, \\sigma^2) = \\ln(L(\\theta, \\sigma^2))$ 为：\n$$\n\\mathcal{L}(\\theta, \\sigma^2) = -\\frac{n}{2}\\ln(2\\pi) - \\frac{n}{2}\\ln(\\sigma^2) - \\frac{1}{2\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\theta\\right)^2\n$$\n问题要求的是负对数似然 $NLL(\\theta, \\sigma^2) = -\\mathcal{L}(\\theta, \\sigma^2)$：\n$$\nNLL(\\theta, \\sigma^2) = \\frac{n}{2}\\ln(2\\pi) + \\frac{n}{2}\\ln(\\sigma^2) + \\frac{1}{2\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\theta\\right)^2\n$$\n为了找到 $\\theta$ 的最大似然估计（MLE），记为 $\\hat{\\theta}$，我们必须最小化关于 $\\theta$ 的 $NLL$。这等同于最大化对数似然 $\\mathcal{L}$。我们通过将其关于 $\\theta$ 的偏导数设为零来找到最小值。请注意，$\\sigma^2$ 的值不影响关于 $\\theta$ 的最小值的位置。\n$$\n\\frac{\\partial}{\\partial\\theta}NLL(\\theta, \\sigma^2) = \\frac{\\partial}{\\partial\\theta} \\left[ \\frac{1}{2\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\theta\\right)^2 \\right]\n$$\n$$\n\\frac{\\partial}{\\partial\\theta}NLL(\\theta, \\sigma^2) = \\frac{1}{2\\sigma^2}\\sum_{i=1}^n 2\\left(\\ln(y_i/s_i) - \\theta\\right)(-1) = -\\frac{1}{\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\theta\\right)\n$$\n将导数设为零以找到估计量 $\\hat{\\theta}$：\n$$\n-\\frac{1}{\\sigma^2}\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\hat{\\theta}\\right) = 0\n$$\n由于 $\\sigma^2 > 0$，所以和必须为零：\n$$\n\\sum_{i=1}^n \\left(\\ln(y_i/s_i) - \\hat{\\theta}\\right) = 0 \\implies \\sum_{i=1}^n \\ln(y_i/s_i) - \\sum_{i=1}^n \\hat{\\theta} = 0\n$$\n$$\n\\sum_{i=1}^n \\ln(y_i/s_i) - n\\hat{\\theta} = 0\n$$\n解出 $\\hat{\\theta}$：\n$$\n\\hat{\\theta} = \\frac{1}{n} \\sum_{i=1}^n \\ln\\left(\\frac{y_i}{s_i}\\right)\n$$\n现在我们代回 $\\hat{\\theta} = \\ln(\\hat{a})$ 来求 $a$ 的 MLE：\n$$\n\\ln(\\hat{a}) = \\frac{1}{n} \\sum_{i=1}^n \\ln\\left(\\frac{y_i}{s_i}\\right)\n$$\n利用对数性质 $\\sum \\ln(x_i) = \\ln(\\prod x_i)$ 和 $c \\ln(x) = \\ln(x^c)$：\n$$\n\\ln(\\hat{a}) = \\frac{1}{n} \\ln\\left(\\prod_{i=1}^n \\frac{y_i}{s_i}\\right) = \\ln\\left[\\left(\\prod_{i=1}^n \\frac{y_i}{s_i}\\right)^{1/n}\\right]\n$$\n通过对两边取指数，我们得到 MLE $\\hat{a}$ 的闭式表达式：\n$$\n\\hat{a} = \\left(\\prod_{i=1}^n \\frac{y_i}{s_i}\\right)^{1/n}\n$$\n这表明增益 $a$ 的 MLE 是表观反射率与模拟反射率之比的几何平均值。\n\n**第3部分：$\\hat{a}$ 的数值计算**\n\n给定一个包含 $n=6$ 个场景的数据集：\n$$\n\\{(0.05, 0.063), (0.10, 0.114), (0.15, 0.198), (0.20, 0.216), (0.30, 0.3672), (0.45, 0.54)\\}\n$$\n首先，我们计算每个场景 $i=1, \\dots, 6$ 的比率 $r_i = y_i / s_i$：\n$r_1 = \\frac{0.063}{0.05} = 1.26$\n$r_2 = \\frac{0.114}{0.10} = 1.14$\n$r_3 = \\frac{0.198}{0.15} = 1.32$\n$r_4 = \\frac{0.216}{0.20} = 1.08$\n$r_5 = \\frac{0.3672}{0.30} = 1.224$\n$r_6 = \\frac{0.54}{0.45} = 1.20$\n\n现在，我们计算这些比率的乘积：\n$$\n\\prod_{i=1}^6 r_i = 1.26 \\times 1.14 \\times 1.32 \\times 1.08 \\times 1.224 \\times 1.20 \\approx 3.0077085\n$$\n最后，我们计算这个乘积的 6 次方根来求得 $\\hat{a}$：\n$$\n\\hat{a} = \\left(\\prod_{i=1}^6 r_i\\right)^{1/6} \\approx (3.0077085)^{1/6}\n$$\n$$\n\\hat{a} \\approx 1.2014529\n$$\n将结果四舍五入到 5 位有效数字，我们看前 6 位数字：$1.20145$。由于第六位是 $5$，我们将第五位向上取整。\n$$\n\\hat{a} \\approx 1.2015\n$$\n这个值是无量纲的，因为它是反射率的比值。",
            "answer": "$$\\boxed{1.2015}$$"
        },
        {
            "introduction": "环境建模中的一个常见挑战是模型参数常受到物理约束，例如土壤含水量必须在 $0$ 和 $1$ 之间。这项高级计算练习将引导您完成一个标准土壤模型的完整校准工作流程，其中使用 logit 变换将有界参数映射到无约束空间。这项技术不仅使得强大的梯度优化算法得以应用，还能改善校准过程的数值稳定性，这是复杂自动化系统中的一个关键考量。",
            "id": "3827300",
            "problem": "您的任务是实现并分析一个与遥感和环境建模相关的土壤湿度模型的校准策略。目标是构建一个科学合理、参数受约束的模型，实现手动和自动两种校准策略，通过 logit 变换对受约束的参数进行重参数化以实现无约束优化，并在变换前后比较模型灵敏度矩阵的数值条件，所有这些都在一个可复现的、输出可量化结果的计算练习中完成。\n\n考虑将 van Genuchten 土壤持水关系作为一个经过充分检验的本构模型，它将压力水头与体积含水量联系起来。体积土壤湿度 $\\theta$ 作为土壤压力水头 $h$ 的函数定义为\n$$\n\\theta(h;\\theta_r,\\theta_s,\\alpha,n) \\;=\\; \\theta_r + \\left(\\theta_s - \\theta_r\\right)\\left[1 + \\left(\\alpha\\lvert h\\rvert\\right)^n\\right]^{-m},\n$$\n其中 $\\theta_r$ 是残余含水量（无量纲分数），$\\theta_s$ 是饱和含水量（无量纲分数），$\\alpha$ 是一个单位为 $\\text{m}^{-1}$ 的毛细管长度尺度的倒数，$n > 1$ 是一个形状参数，且 $m = 1 - 1/n$。压力水头 $h$ 以米（m）为单位，在非饱和条件下为负值。在将原位水文状态与近地表土壤湿度的遥感反演联系起来时，会遇到这个模型。\n\n您将使用已知的“真实”参数和加性确定性扰动 $\\epsilon_i$（以模拟反演噪声），通过上述模型在指定的压力水头 $h_i$ 处生成合成观测值 $\\theta_i^{\\text{obs}}$。然后，您将通过最小化模型预测与合成观测值之间的残差平方和来校准参数，使用以下方法：\n\n- 手动策略：在合理的参数范围内进行粗略的网格搜索，以选择一个物理上一致的初始猜测值。\n- 自动策略：通过基于梯度的方法，特别是信赖域反射 (TRF) 方法，求解非线性最小二乘法 (NLS)，利用残差相对于参数的解析雅可比矩阵来加速收敛。\n\n为处理参数约束 $\\theta_r, \\theta_s \\in (0,1)$，使用 logit 变换实现无约束重参数化。定义\n$$\n\\phi_r \\;=\\; \\operatorname{logit}(\\theta_r) \\;=\\; \\ln\\!\\left(\\frac{\\theta_r}{1-\\theta_r}\\right),\\qquad\n\\phi_s \\;=\\; \\operatorname{logit}(\\theta_s) \\;=\\; \\ln\\!\\left(\\frac{\\theta_s}{1-\\theta_s}\\right),\n$$\n其逆映射为\n$$\n\\theta_r \\;=\\; \\sigma(\\phi_r) \\;=\\; \\frac{1}{1 + e^{-\\phi_r}},\\qquad\n\\theta_s \\;=\\; \\sigma(\\phi_s) \\;=\\; \\frac{1}{1 + e^{-\\phi_s}}.\n$$\n\n设残差向量为\n$$\n\\mathbf{r}(\\theta_r,\\theta_s) \\;=\\; \\left[\\theta(h_1;\\theta_r,\\theta_s,\\alpha,n) - \\theta_1^{\\text{obs}},\\,\\dots,\\,\\theta(h_N;\\theta_r,\\theta_s,\\alpha,n) - \\theta_N^{\\text{obs}}\\right]^\\top,\n$$\n并令 $J_p \\in \\mathbb{R}^{N\\times 2}$ 表示 $\\mathbf{r}$ 相对于原始参数 $p = [\\theta_r,\\theta_s]^\\top$ 的雅可比矩阵。使用链式法则，定义相对于 logit 变换后的参数 $\\phi = [\\phi_r,\\phi_s]^\\top$ 的雅可比矩阵为\n$$\nJ_\\phi \\;=\\; J_p \\, \\mathrm{diag}\\!\\left(\\theta_r(1-\\theta_r),\\,\\theta_s(1-\\theta_s)\\right).\n$$\n对于数值条件，使用通过奇异值分解 (SVD) 计算的 $2$-范数条件数，即\n$$\n\\kappa(J) \\;=\\; \\frac{\\sigma_{\\max}(J)}{\\sigma_{\\min}(J)},\n$$\n其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是 $J$ 的最大和最小奇异值。在校准解处比较 $\\kappa(J_p)$ 和 $\\kappa(J_\\phi)$，以评估 logit 变换对条件数的影响。\n\n必须明确遵守物理单位：压力水头 $h$ 的值以米（m）为单位，$\\alpha$ 以 $\\text{m}^{-1}$ 为单位，体积含水量 $\\theta$ 是无量纲分数。下面要求的所有输出都是无量纲的浮点数或布尔值；表示它们时不要带任何单位符号。\n\n实现以下三个案例的测试套件。在每个案例中，使用相同的固定形状参数 $\\alpha = 1.8\\,\\text{m}^{-1}$ 和 $n = 1.8$（因此 $m = 1 - 1/1.8$）。扰动是确定性的 $\\epsilon_i = 0.001\\sin(i)$，其中索引 $i = 1,2,\\dots,N$。合成观测值通过以下方式生成\n$$\n\\theta_i^{\\text{obs}} \\;=\\; \\theta(h_i;\\theta_r^{\\text{true}},\\theta_s^{\\text{true}},\\alpha,n) + \\epsilon_i.\n$$\n\n- 案例 A (常规“顺利”路径)：$\\theta_r^{\\text{true}} = 0.06$, $\\theta_s^{\\text{true}} = 0.46$, $h_i$ 在 ${-0.05}$ 到 ${-2.5}$ 之间线性间隔，$N = 60$。\n- 案例 B (近退化的可识别性：含水量几乎相等)：$\\theta_r^{\\text{true}} = 0.12$, $\\theta_s^{\\text{true}} = 0.14$, $h_i$ 在 ${-0.2}$ 到 ${-10.0}$ 之间线性间隔，$N = 60$。\n- 案例 C (激励有限：$h$ 范围窄)：$\\theta_r^{\\text{true}} = 0.08$, $\\theta_s^{\\text{true}} = 0.38$, $h_i$ 在 ${-0.25}$ 到 ${-0.15}$ 之间线性间隔，$N = 30$。\n\n每个案例所需的步骤：\n- 根据指定的 $h_i$, $\\theta_r^{\\text{true}}$ 和 $\\theta_s^{\\text{true}}$，使用固定的 $\\alpha$ 和 $n$，再加上 $\\epsilon_i$，生成 $\\theta_i^{\\text{obs}}$。\n- 手动校准：在 $\\theta_r \\in [0.01,\\,0.20]$（增量为 $0.01$）和 $\\theta_s \\in [0.30,\\,0.60]$（增量为 $0.05$）上进行粗略的网格搜索，选择使残差平方和最小化的初始猜测值，同时丢弃违反 $\\theta_s \\le \\theta_r$ 的候选值。\n- 自动校准：从通过 logit 变换映射到 $\\phi$ 的手动初始猜测值开始，使用基于梯度的方法和解析雅可比矩阵求解 $\\phi$ 的 NLS 问题。然后，通过 logit 逆变换将校准解映射回 $\\theta_r$ 和 $\\theta_s$。\n- 计算在原始空间中校准参数下的误差平方和\n$$\n\\mathrm{SSE} \\;=\\; \\sum_{i=1}^{N} \\left(\\theta(h_i;\\hat{\\theta}_r,\\hat{\\theta}_s,\\alpha,n) - \\theta_i^{\\text{obs}}\\right)^2\n$$\n- 在校准解处使用解析雅可比矩阵计算 $\\kappa(J_p)$ 和 $\\kappa(J_\\phi)$，并报告条件数是否改善，定义为布尔值 $\\kappa(J_\\phi)  \\kappa(J_p)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一个测试案例，并且本身是一个包含四个条目的列表：$[\\mathrm{SSE},\\,\\kappa(J_p),\\,\\kappa(J_\\phi),\\,\\text{improved}]$。例如，输出格式应类似于 $[[sse_A,condp_A,condphi_A,flag_A],[sse_B,condp_B,condphi_B,flag_B],[sse_C,condp_C,condphi_C,flag_C]]$，所有数值条目表示为无量纲浮点数，标志表示为布尔值。除了这一行之外，不应打印任何其他文本。",
            "solution": "该问题要求为 van Genuchten 土壤持水模型实现并分析校准策略。这涉及生成合成数据，执行手动网格搜索以获得初始参数猜测，使用自动非线性最小二乘 (NLS) 算法优化此猜测，并评估 logit 参数变换对问题数值条件的影响。\n\nvan Genuchten 模型提供了作为土壤压力水头 $h$ 函数的体积土壤湿度 $\\theta$：\n$$\n\\theta(h;\\theta_r,\\theta_s,\\alpha,n) \\;=\\; \\theta_r + \\left(\\theta_s - \\theta_r\\right)\\left[1 + \\left(\\alpha\\lvert h\\rvert\\right)^n\\right]^{-m}\n$$\n待校准的参数是残余含水量 $\\theta_r$ 和饱和含水量 $\\theta_s$。参数 $\\alpha$ 和 $n$ 固定为 $\\alpha = 1.8\\,\\text{m}^{-1}$ 和 $n=1.8$，这意味着 $m = 1 - 1/n = 1 - 1/1.8$。对于一组压力水头 $h_i$，使用已知的真实参数 ($\\theta_r^{\\text{true}}$, $\\theta_s^{\\text{true}}$) 和一个确定性扰动 $\\epsilon_i = 0.001\\sin(i)$（其中 $i=1, \\dots, N$）来生成合成观测值 $\\theta_i^{\\text{obs}}$。\n\n校准旨在找到最小化误差平方和 (SSE) 目标函数的参数 $(\\hat{\\theta}_r, \\hat{\\theta}_s)$：\n$$\n\\mathrm{SSE}(\\theta_r, \\theta_s) \\;=\\; \\sum_{i=1}^{N} r_i^2 \\;=\\; \\sum_{i=1}^{N} \\left(\\theta(h_i;\\theta_r,\\theta_s,\\alpha,n) - \\theta_i^{\\text{obs}}\\right)^2\n$$\n其中 $r_i$ 是残差向量 $\\mathbf{r}$ 的分量。\n\n校准分两个阶段进行：\n$1$. **手动校准**：在一个合理的参数空间上进行粗略的网格搜索：$\\theta_r \\in [0.01, 0.20]$ 和 $\\theta_s \\in [0.30, 0.60]$。在此网格上产生最小 SSE 的参数对 $(\\theta_r, \\theta_s)$ 被选为自动阶段的初始猜测值。物理约束 $\\theta_s > \\theta_r$ 得到遵守。对于指定的网格范围，此条件始终满足。\n\n$2$. **自动校准**：采用基于梯度的 NLS 求解器来优化初始猜测。参数 $\\theta_r$ 和 $\\theta_s$ 在物理上被约束在区间 $(0, 1)$ 内。为了处理这些约束，我们使用 logit 变换对它们进行重参数化，该变换将有界区间 $(0, 1)$ 映射到无界实数轴 $(-\\infty, \\infty)$：\n$$\n\\phi_r = \\ln\\left(\\frac{\\theta_r}{1-\\theta_r}\\right), \\qquad \\phi_s = \\ln\\left(\\frac{\\theta_s}{1-\\theta_s}\\right)\n$$\n逆变换是 sigmoid (或 logistic) 函数，$\\sigma(z) = (1 + e^{-z})^{-1}$：\n$$\n\\theta_r = \\sigma(\\phi_r), \\qquad \\theta_s = \\sigma(\\phi_s)\n$$\nNLS 优化在 $\\phi = [\\phi_r, \\phi_s]^\\top$ 的无约束空间中执行。我们使用 `scipy.optimize.least_squares` 中可用的信赖域反射 (TRF) 算法，该算法需要残差相对于优化变量的雅可比矩阵。\n\n残差向量 $\\mathbf{r}$ 相对于原始参数 $p = [\\theta_r, \\theta_s]^\\top$ 的雅可比矩阵记为 $J_p \\in \\mathbb{R}^{N\\times 2}$。其条目为 $(J_p)_{ij} = \\partial r_i / \\partial p_j$。设 $S(h) = [1 + (\\alpha|h|)^n]^{-m}$。模型的偏导数为：\n$$\n\\frac{\\partial \\theta(h)}{\\partial \\theta_r} = 1 - S(h) \\qquad \\text{和} \\qquad \\frac{\\partial \\theta(h)}{\\partial \\theta_s} = S(h)\n$$\n由于 $r_i = \\theta(h_i) - \\theta_i^{\\text{obs}}$，$J_p$ 的列分别是元素为 $\\partial r_i / \\partial \\theta_r$ 和 $\\partial r_i / \\partial \\theta_s$ 的向量。\n\n对于变换后的参数 $\\phi = [\\phi_r, \\phi_s]^\\top$，雅可比矩阵 $J_\\phi = \\partial \\mathbf{r} / \\partial \\phi$ 可通过链式法则求得：$J_\\phi = (\\partial \\mathbf{r} / \\partial p) (\\partial p / \\partial \\phi)$。矩阵 $\\partial p / \\partial \\phi$ 是对角矩阵，因为 $\\theta_r$ 仅依赖于 $\\phi_r$，$\\theta_s$ 仅依赖于 $\\phi_s$。sigmoid 函数的导数是 $\\sigma'(z) = \\sigma(z)(1-\\sigma(z))$。因此：\n$$\n\\frac{\\partial p}{\\partial \\phi} = \\begin{pmatrix} \\frac{d\\theta_r}{d\\phi_r}  0 \\\\ 0  \\frac{d\\theta_s}{d\\phi_s} \\end{pmatrix} = \\begin{pmatrix} \\theta_r(1-\\theta_r)  0 \\\\ 0  \\theta_s(1-\\theta_s) \\end{pmatrix}\n$$\n这证实了为变换后的雅可比矩阵提供的公式：$J_\\phi = J_p \\, \\mathrm{diag}(\\theta_r(1-\\theta_r), \\theta_s(1-\\theta_s))$。这个解析雅可比矩阵 $J_\\phi$ 被提供给 NLS 求解器，以确保准确性和效率。\n\n最后，我们通过计算 2-范数条件数 $\\kappa(J) = \\sigma_{\\max}(J) / \\sigma_{\\min}(J)$ 来分析问题的数值条件，其中 $\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是雅可比矩阵 $J$ 的最大和最小奇异值。我们在最终校准解处比较 $\\kappa(J_p)$ 和 $\\kappa(J_\\phi)$，以确定 logit 变换是否改善了条件数，由 $\\kappa(J_\\phi)  \\kappa(J_p)$ 表示。\n\n每个测试案例的算法如下：\n$1$. 生成压力水头向量 $h_i$ 和相应的合成观测值 $\\theta_i^{\\text{obs}}$。\n$2$. 执行网格搜索以找到初始猜测值 $(\\theta_{r,0}, \\theta_{s,0})$。\n$3-4$. 将初始猜测值转换为 $(\\phi_{r,0}, \\phi_{s,0})$，并使用 `scipy.optimize.least_squares` 和解析雅可比矩阵 $J_\\phi$ 求解 $\\hat{\\phi}$ 的 NLS 问题。\n$5$. 将最优的 $\\hat{\\phi}$ 变换回原始参数空间，以获得最终的校准估计值 $(\\hat{\\theta}_r, \\hat{\\theta}_s)$。\n$6-8$. 计算最终的 SSE、解处的雅可比矩阵 $J_p$ 和 $J_\\phi$ 以及它们各自的条件数 $\\kappa(J_p)$ 和 $\\kappa(J_\\phi)$。\n$9$. 报告 SSE、两个条件数以及一个指示条件数是否改善的布尔标志。\n此过程应用于所有三个指定的测试案例。",
            "answer": "[[2.9463283281358984e-05,10.630604113220464,1.8601704285810237,True],[8.885633005852579e-06,207.24357731761603,28.875691456985474,True],[3.801691316666199e-06,12502.58983946399,235.0336214371425,True]]"
        }
    ]
}