{
    "hands_on_practices": [
        {
            "introduction": "要从卫星数据中准确提取地表信息，我们必须首先理解传感器记录的信号构成。本练习 () 从辐射传输方程 ($RTE$) 这一基本物理原理出发，引导你推导出大气层顶 ($TOA$) 辐射亮度的核心模型。通过将 $TOA$ 信号分解为经大气衰减的地表反射分量和大气自身的路径辐射分量，你将掌握大气校正的理论基石，这是理解大气如何影响并“污染”地表真实信号的关键第一步。",
            "id": "3797692",
            "problem": "一台星载成像光谱仪在一个近红外大气窗口内，以波长 $\\lambda$ 观测一个水平且空间均匀的陆地表面。大气是水平均匀的，并且是平行平面的。该表面表现为一个朗伯反射体，其光谱反射率为 $\\rho(\\lambda)$。光照主要由太阳直射光束主导；漫射天空光和地表-大气间的多次反射可以忽略不计。在给定的波长 $\\lambda$ 处，热辐射可以忽略不计。卫星进行天底观测，邻近效应可以忽略不计。角度以度为单位。\n\n从沿传感器视线的上行比辐射亮度 $L(\\lambda, s)$ 的标量辐射传输方程出发，\n$$\n\\frac{dL(\\lambda,s)}{ds} = -\\kappa(\\lambda,s)\\,L(\\lambda,s) + j(\\lambda,s),\n$$\n并根据朗伯反射率的定义（离开表面的辐射亮度等于入射辐照度除以 $\\pi$ 再乘以 $\\rho(\\lambda)$），推导出大气层顶 (TOA) 辐射亮度 $L_{\\mathrm{sat}}(\\lambda)$ 的表达式，该表达式为一个经衰减的地表出射项与一个大气路径辐射亮度项之和。假设地表的直射下行辐照度可以用大气外太阳光谱辐照度 $E_{0}(\\lambda)$、太阳天顶角 $\\theta_{0}$ 和向下（太阳到地表）大气透过率 $\\tau_{\\mathrm{sun}}(\\lambda)$ 来表示，而向上（地表到传感器）的衰减由上行透过率 $\\tau_{\\mathrm{up}}(\\lambda)$ 表示。将沿上行路径累积的路径辐射亮度记为 $L_{p}(\\lambda)$。\n\n使用以下光谱分辨的、与大气窗口一致的数值：\n- 波长: $\\lambda = 0.86\\,\\mu\\mathrm{m}$。\n- 大气外太阳光谱辐照度: $E_{0}(\\lambda) = 1.500 \\times 10^{3}\\ \\mathrm{W\\,m^{-2}\\,\\mu m^{-1}}$。\n- 太阳天顶角: $\\theta_{0} = 60^{\\circ}$。\n- 向下透过率: $\\tau_{\\mathrm{sun}}(\\lambda) = 0.80$。\n- 向上透过率: $\\tau_{\\mathrm{up}}(\\lambda) = 0.85$。\n- 朗伯反射率: $\\rho(\\lambda) = 0.300$。\n- 路径辐射亮度: $L_{p}(\\lambda) = 2.000\\ \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$。\n\n计算 TOA 辐射亮度 $L_{\\mathrm{sat}}(\\lambda)$，单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$。将最终数值答案四舍五入至四位有效数字。",
            "solution": "该问题要求推导大气层顶 (TOA) 辐射亮度 $L_{\\mathrm{sat}}(\\lambda)$，并根据所提供的参数进行计算。\n\n出发点是沿传感器视线路径 $s$ 的上行比辐射亮度 $L(\\lambda, s)$ 的标量辐射传输方程 (RTE)：\n$$\n\\frac{dL(\\lambda,s)}{ds} = -\\kappa(\\lambda,s)\\,L(\\lambda,s) + j(\\lambda,s)\n$$\n此处，$\\kappa(\\lambda,s)$ 是体消光系数，$j(\\lambda,s)$ 是表示散射入视线的辐射的源函数。为方便标记，在接下来的推导中，对波长 $\\lambda$ 的依赖关系将是隐式的。\n\n这是一个一阶线性常微分方程。对于位于大气层顶（路径位置 $s=S$）的卫星传感器处的辐射亮度，给定地表（路径位置 $s=0$）的辐射亮度，其形式解可以写为：\n$$\nL(S) = L(0) \\exp\\left(-\\int_{0}^{S} \\kappa(s') ds'\\right) + \\int_{0}^{S} j(s') \\exp\\left(-\\int_{s'}^{S} \\kappa(s'') ds''\\right) ds'\n$$\n我们可以将这个通解中的各项与问题陈述中定义的物理量对应起来：\n$1$. 传感器处的辐射亮度是 TOA 辐射亮度：$L_{\\mathrm{sat}} = L(S)$。\n$2$. 地表处的辐射亮度是地表出射辐射亮度：$L_{\\mathrm{surf}} = L(0)$。\n$3$. 项 $\\exp\\left(-\\int_{0}^{S} \\kappa(s') ds'\\right)$ 表示辐射亮度沿从地表到传感器路径的总衰减。这被定义为上行透过率 $\\tau_{\\mathrm{up}}$。\n$4$. 积分项 $\\int_{0}^{S} j(s') \\exp\\left(-\\int_{s'}^{S} \\kappa(s'') ds''\\right) ds'$ 表示沿路径散射入视线的辐射亮度的积分贡献，其中每个贡献在到达传感器的途中都会被衰减。这就是路径辐射亮度 $L_p$ 的定义。\n\n代入这些对应关系，RTE 的解简化为所需的形式：\n$$\nL_{\\mathrm{sat}}(\\lambda) = L_{\\mathrm{surf}}(\\lambda)\\,\\tau_{\\mathrm{up}}(\\lambda) + L_p(\\lambda)\n$$\n这个表达式正确地显示了 TOA 辐射亮度是经衰减的地表出射辐射亮度与大气路径辐射亮度之和。\n\n接下来，我们必须找到地表出射辐射亮度 $L_{\\mathrm{surf}}(\\lambda)$ 的表达式。地表被描述为一个朗伯反射体。根据给出的定义，离开地表的辐射亮度与地表的总下行光谱辐照度 $E_{\\mathrm{down}}(\\lambda)$ 和地表光谱反射率 $\\rho(\\lambda)$ 的关系如下：\n$$\nL_{\\mathrm{surf}}(\\lambda) = \\frac{\\rho(\\lambda)\\,E_{\\mathrm{down}}(\\lambda)}{\\pi}\n$$\n问题陈述中说明，光照主要由太阳直射光束主导，而漫射天空光的贡献可以忽略。因此，$E_{\\mathrm{down}}(\\lambda)$ 仅由到达地表的太阳直射辐照度组成。大气外太阳光谱辐照度 $E_0(\\lambda)$ 是垂直于太阳光线平面上的通量。对于水平表面，该通量会因一个因子 $\\cos(\\theta_0)$ 而减少，其中 $\\theta_0$ 是太阳天顶角。当该光束穿过大气层时，它会被向下大气透过率 $\\tau_{\\mathrm{sun}}(\\lambda)$ 衰减。到达地表的最终辐照度是：\n$$\nE_{\\mathrm{down}}(\\lambda) = E_0(\\lambda)\\,\\cos(\\theta_0)\\,\\tau_{\\mathrm{sun}}(\\lambda)\n$$\n将此式代入 $L_{\\mathrm{surf}}(\\lambda)$ 的方程中：\n$$\nL_{\\mathrm{surf}}(\\lambda) = \\frac{\\rho(\\lambda)\\,E_0(\\lambda)\\,\\cos(\\theta_0)\\,\\tau_{\\mathrm{sun}}(\\lambda)}{\\pi}\n$$\n最后，将这个 $L_{\\mathrm{surf}}(\\lambda)$ 的表达式代入 $L_{\\mathrm{sat}}(\\lambda)$ 的方程中，得到在给定假设下 TOA 辐射亮度的完整模型：\n$$\nL_{\\mathrm{sat}}(\\lambda) = \\left( \\frac{\\rho(\\lambda)\\,E_0(\\lambda)\\,\\cos(\\theta_0)\\,\\tau_{\\mathrm{sun}}(\\lambda)}{\\pi} \\right) \\tau_{\\mathrm{up}}(\\lambda) + L_p(\\lambda)\n$$\n现在我们将提供的数值代入该表达式来计算 TOA 辐射亮度。这些数值是：\n- $E_{0}(\\lambda) = 1.500 \\times 10^{3}\\ \\mathrm{W\\,m^{-2}\\,\\mu m^{-1}}$\n- $\\theta_{0} = 60^{\\circ}$\n- $\\tau_{\\mathrm{sun}}(\\lambda) = 0.80$\n- $\\tau_{\\mathrm{up}}(\\lambda) = 0.85$\n- $\\rho(\\lambda) = 0.300$\n- $L_p(\\lambda) = 2.000\\ \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$\n\n首先，我们计算太阳天顶角的余弦值：\n$$\n\\cos(60^{\\circ}) = 0.5\n$$\n接下来，我们计算经衰减的地表反射项：\n$$\nL_{\\mathrm{surf, att}}(\\lambda) = \\frac{\\rho(\\lambda)\\,E_0(\\lambda)\\,\\cos(\\theta_0)\\,\\tau_{\\mathrm{sun}}(\\lambda)\\,\\tau_{\\mathrm{up}}(\\lambda)}{\\pi}\n$$\n$$\nL_{\\mathrm{surf, att}}(\\lambda) = \\frac{(0.300) \\times (1.500 \\times 10^3) \\times (0.5) \\times (0.80) \\times (0.85)}{\\pi}\n$$\n分子计算结果为：\n$$\n0.300 \\times 1500 \\times 0.5 \\times 0.80 \\times 0.85 = 153\n$$\n因此，经衰减的地表反射辐射亮度为：\n$$\nL_{\\mathrm{surf, att}}(\\lambda) = \\frac{153}{\\pi} \\ \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}\n$$\n总 TOA 辐射亮度是该分量与路径辐射亮度的和：\n$$\nL_{\\mathrm{sat}}(\\lambda) = \\frac{153}{\\pi} + 2.000\n$$\n$$\nL_{\\mathrm{sat}}(\\lambda) \\approx 48.698312 + 2.000 = 50.698312\\ \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}\n$$\n按要求将最终结果四舍五入至四位有效数字：\n$$\nL_{\\mathrm{sat}}(\\lambda) \\approx 50.70\\ \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}\n$$",
            "answer": "$$ \\boxed{50.70} $$"
        },
        {
            "introduction": "简单的辐射传输模型通常假设传感器视场内的每个像元都是独立的，但这在现实中并非完全成立。本练习 () 将探讨一个更复杂的现象——邻近效应，即大气散射会将邻近地物的光“混合”到目标像元的信号中。你将使用一个大气点扩散函数 ($PSF$) 来量化这一效应，计算明亮的周围环境如何错误地增加暗目标的表观反射率，这对于理解高空间分辨率遥感影像中的误差来源至关重要。",
            "id": "3797715",
            "problem": "一颗卫星在一个大气窗口内测量陆地场景的大气层顶辐亮度，波长为 $\\lambda = 0.865\\,\\mu\\text{m}$。在该窗口内，分子吸收可以忽略不计，气溶胶散射占主导地位。考虑一个半径为 $a = 20\\,\\text{m}$ 的圆形暗湖，其具有空间均匀的朗伯表面反射率 $\\rho_{d} = 0.02$，该湖嵌入在一个具有反射率 $\\rho_{b} = 0.36$ 的无限、空间均匀的明亮朗伯地表中。地表下行光谱辐照度为 $E_{d} = 900\\,\\text{W}\\,\\text{m}^{-2}\\,\\mu\\text{m}^{-1}$，从地表到传感器的上行透射率为 $T_{u} = 0.88$，大气程辐射亮度为 $L_{p} = 1.2\\,\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$。\n\n假设以下基于物理的建模假设，并将其作为您推导的基本依据：\n\n- 表面是朗伯体，因此离地辐亮度满足 $L_{\\text{surf}}(\\boldsymbol{x}) = \\frac{E_{d}}{\\pi}\\,\\rho(\\boldsymbol{x})$。\n- 在大气窗口中，受气溶胶单次散射影响，传感器视线方向上的大气层顶辐亮度可以分解为一个附加的程辐射亮度，加上离地辐亮度的衰减贡献，其中一部分上行表面辐亮度经历小角度散射，将能量横向重新分配。通过一个归一化的、径向对称的大气点扩散函数 (PSF) 对这种横向重新分配进行建模，使得上行表面辐亮度场的一部分（比例为 $\\eta$）根据与 PSF 的卷积在平面上重新分布，而剩余部分（比例为 $1-\\eta$）则在视线方向上无散射地传播。\n- 大气点扩散函数是高斯函数，$G(r) = \\frac{1}{2\\pi s^{2}}\\exp\\!\\big(-\\frac{r^{2}}{2 s^{2}}\\big)$，其标准差为 $s = 40\\,\\text{m}$，并且是归一化的，使得 $\\int_{\\mathbb{R}^{2}} G(\\|\\boldsymbol{r}\\|)\\,\\text{d}^{2}\\boldsymbol{r} = 1$。邻近效应强度为 $\\eta = 0.20$。\n\n一个简化的反射率反演算法通过假设没有邻近效应来反演传感器测量的辐亮度，即在视线方向上设 $\\rho_{\\text{app}} = \\frac{\\pi\\,[L_{\\text{sat}} - L_{p}]}{T_{u}\\,E_{d}}$。从上述假设和第一性原理出发，推导湖中心表观反射率 $\\rho_{\\text{app}}$ 的显式表达式，然后评估由明亮周围环境的邻近效应引起的反射率误差 $\\Delta \\rho = \\rho_{\\text{app}} - \\rho_{d}$。将您最终的数值答案 $\\Delta \\rho$ 四舍五入到四位有效数字。将最终答案表示为无量纲的反射率（小数形式）。",
            "solution": "该问题要求推导由于大气邻近效应，在一个被明亮地貌环绕的暗湖中心产生的表观反射率误差。推导必须从所提供的第一性原理和模型出发。\n\n首先，我们为卫星在地面位置 $\\boldsymbol{x}$ 处测量到的大气层顶 (TOA) 辐亮度 $L_{\\text{sat}}$ 建立表达式。根据问题陈述，TOA 辐亮度是三个分量的总和：\n1.  大气程辐射亮度，$L_p$。\n2.  来自点 $\\boldsymbol{x}$ 的直接透射的表面辐亮度，它是无散射传播的上行辐亮度的一部分（比例为 $1-\\eta$）。\n3.  邻近或环境贡献，它是来自整个表面的上行辐亮度场的一部分（比例为 $\\eta$），被散射到传感器的视线中。该分量通过离地辐亮度场与大气点扩散函数 (PSF) $G$ 的卷积进行建模。\n\n对于朗伯表面，其离地辐亮度场 $L_{\\text{surf}}(\\boldsymbol{x}')$ 由 $L_{\\text{surf}}(\\boldsymbol{x}') = \\frac{E_d}{\\pi} \\rho(\\boldsymbol{x}')$ 给出，其中 $\\rho(\\boldsymbol{x}')$ 是位置 $\\boldsymbol{x}'$ 处的表面反射率。\n\n因此，位置 $\\boldsymbol{x}$ 处的 TOA 辐亮度为：\n$$L_{\\text{sat}}(\\boldsymbol{x}) = L_p + (1-\\eta) T_u L_{\\text{surf}}(\\boldsymbol{x}) + \\eta T_u \\left( L_{\\text{surf}} * G \\right)(\\boldsymbol{x})$$\n其中 $*$ 表示二维卷积运算：\n$$\\left( L_{\\text{surf}} * G \\right)(\\boldsymbol{x}) = \\int_{\\mathbb{R}^2} L_{\\text{surf}}(\\boldsymbol{x}') G(\\boldsymbol{x} - \\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n代入 $L_{\\text{surf}}$ 的表达式：\n$$L_{\\text{sat}}(\\boldsymbol{x}) = L_p + (1-\\eta) T_u \\frac{E_d}{\\pi} \\rho(\\boldsymbol{x}) + \\eta T_u \\int_{\\mathbb{R}^2} \\frac{E_d}{\\pi} \\rho(\\boldsymbol{x}') G(\\boldsymbol{x} - \\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n$$L_{\\text{sat}}(\\boldsymbol{x}) = L_p + \\frac{T_u E_d}{\\pi} \\left[ (1-\\eta) \\rho(\\boldsymbol{x}) + \\eta \\int_{\\mathbb{R}^2} \\rho(\\boldsymbol{x}') G(\\boldsymbol{x} - \\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}' \\right]$$\n\n简化的反演算法通过反演简化的辐射传输方程 $L_{\\text{sat}} = L_p + \\frac{T_u E_d}{\\pi} \\rho_{\\text{app}}$ 来计算表观反射率 $\\rho_{\\text{app}}$，得出：\n$$\\rho_{\\text{app}}(\\boldsymbol{x}) = \\frac{\\pi [L_{\\text{sat}}(\\boldsymbol{x}) - L_p]}{T_u E_d}$$\n将我们推导的 $L_{\\text{sat}}(\\boldsymbol{x})$ 表达式代入此定义，项 $L_p$、$T_u$ 和 $E_d$ 会被消去，从而得到表观反射率场和真实反射率场之间的直接关系：\n$$\\rho_{\\text{app}}(\\boldsymbol{x}) = (1-\\eta) \\rho(\\boldsymbol{x}) + \\eta \\int_{\\mathbb{R}^2} \\rho(\\boldsymbol{x}') G(\\boldsymbol{x} - \\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n\n我们需要计算湖中心处的值。令原点 $\\boldsymbol{x} = \\boldsymbol{0}$ 为湖的中心。在该点，真实表面反射率是暗湖的反射率，即 $\\rho(\\boldsymbol{0}) = \\rho_d$。表面反射率场由以下分段函数描述：\n$$\n\\rho(\\boldsymbol{x}') =\n\\begin{cases}\n\\rho_d  &\\text{if } \\|\\boldsymbol{x}'\\| \\le a \\\\\n\\rho_b  &\\text{if } \\|\\boldsymbol{x}'\\| > a\n\\end{cases}\n$$\nPSF $G$ 是径向对称的，所以 $G(\\boldsymbol{0} - \\boldsymbol{x}') = G(-\\boldsymbol{x}') = G(\\boldsymbol{x}')$。湖中心表观反射率的表达式变为：\n$$\\rho_{\\text{app}}(\\boldsymbol{0}) = (1-\\eta) \\rho_d + \\eta \\int_{\\mathbb{R}^2} \\rho(\\boldsymbol{x}') G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n我们将积分拆分为两个区域（湖泊和周围陆地）：\n$$\\int_{\\mathbb{R}^2} \\rho(\\boldsymbol{x}') G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}' = \\int_{\\|\\boldsymbol{x}'\\| \\le a} \\rho_d G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}' + \\int_{\\|\\boldsymbol{x}'\\| > a} \\rho_b G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n$$ = \\rho_d \\int_{\\|\\boldsymbol{x}'\\| \\le a} G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}' + \\rho_b \\int_{\\|\\boldsymbol{x}'\\| > a} G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$$\n让我们定义 $I_a = \\int_{\\|\\boldsymbol{x}'\\| \\le a} G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}'$，这是半径为 $a$ 的圆盘内所包含的 PSF 能量的比例。由于 PSF 是归一化的，使得 $\\int_{\\mathbb{R}^2} G(\\boldsymbol{x}')\\,\\text{d}^2\\boldsymbol{x}' = 1$，因此对周围陆地的积分是 $\\int_{\\|\\boldsymbol{x}'\\| > a} G(\\boldsymbol{x}') \\, \\text{d}^2\\boldsymbol{x}' = 1 - I_a$。\n卷积积分的计算结果为 $\\rho_d I_a + \\rho_b(1-I_a)$。\n\n将此结果代回 $\\rho_{\\text{app}}(\\boldsymbol{0})$ 的表达式：\n$$\\rho_{\\text{app}}(\\boldsymbol{0}) = (1-\\eta) \\rho_d + \\eta [\\rho_d I_a + \\rho_b(1-I_a)]$$\n$$\\rho_{\\text{app}}(\\boldsymbol{0}) = \\rho_d - \\eta \\rho_d + \\eta \\rho_d I_a + \\eta \\rho_b (1-I_a)$$\n$$\\rho_{\\text{app}}(\\boldsymbol{0}) = \\rho_d - \\eta \\rho_d (1-I_a) + \\eta \\rho_b (1-I_a)$$\n$$\\rho_{\\text{app}}(\\boldsymbol{0}) = \\rho_d + (\\rho_b - \\rho_d) \\eta (1-I_a)$$\n\n反射率误差为 $\\Delta \\rho = \\rho_{\\text{app}}(\\boldsymbol{0}) - \\rho_d$。从上述表达式，我们得到：\n$$\\Delta \\rho = (\\rho_b - \\rho_d) \\eta (1-I_a)$$\n\n现在，我们必须为给定的高斯 PSF 计算 $I_a$，$G(r) = \\frac{1}{2\\pi s^2} \\exp\\left(-\\frac{r^2}{2s^2}\\right)$。我们转换到极坐标 $(r, \\theta)$，其中 $\\text{d}^2\\boldsymbol{x}' = r\\,\\text{d}r\\,\\text{d}\\theta$。\n$$I_a = \\int_0^{2\\pi} \\int_0^a \\frac{1}{2\\pi s^2} \\exp\\left(-\\frac{r^2}{2s^2}\\right) r\\,\\text{d}r\\,\\text{d}\\theta$$\n被积函数与 $\\theta$ 无关，因此角度积分会产生一个因子 $2\\pi$：\n$$I_a = \\frac{2\\pi}{2\\pi s^2} \\int_0^a r \\exp\\left(-\\frac{r^2}{2s^2}\\right) \\text{d}r = \\frac{1}{s^2} \\int_0^a r \\exp\\left(-\\frac{r^2}{2s^2}\\right) \\text{d}r$$\n使用换元法，令 $u = \\frac{r^2}{2s^2}$，则有 $\\text{d}u = \\frac{r}{s^2}\\text{d}r$。积分的上下限变为：当 $r=0$ 时，$u=0$；当 $r=a$ 时，$u = \\frac{a^2}{2s^2}$。\n$$I_a = \\int_0^{a^2/(2s^2)} \\exp(-u) \\, \\text{d}u = \\left[-\\exp(-u)\\right]_0^{a^2/(2s^2)} = -\\exp\\left(-\\frac{a^2}{2s^2}\\right) - (-\\exp(0))$$\n$$I_a = 1 - \\exp\\left(-\\frac{a^2}{2s^2}\\right)$$\n因此，误差表达式中的项 $(1-I_a)$ 简化为：\n$$1 - I_a = \\exp\\left(-\\frac{a^2}{2s^2}\\right)$$\n将此结果代入 $\\Delta\\rho$ 的表达式：\n$$\\Delta \\rho = (\\rho_b - \\rho_d) \\eta \\exp\\left(-\\frac{a^2}{2s^2}\\right)$$\n这就是反射率误差的最终解析表达式。\n\n最后，我们代入给定的数值：\n$\\rho_d = 0.02$\n$\\rho_b = 0.36$\n$\\eta = 0.20$\n$a = 20\\,\\text{m}$\n$s = 40\\,\\text{m}$\n\n首先，计算指数部分：\n$$\\frac{a^2}{2s^2} = \\frac{(20)^2}{2(40)^2} = \\frac{400}{2(1600)} = \\frac{400}{3200} = \\frac{1}{8} = 0.125$$\n接下来，计算反射率差：\n$$\\rho_b - \\rho_d = 0.36 - 0.02 = 0.34$$\n现在，计算 $\\Delta \\rho$：\n$$\\Delta \\rho = (0.34) (0.20) \\exp(-0.125)$$\n$$\\Delta \\rho = 0.068 \\exp(-0.125)$$\n使用计算器，$\\exp(-0.125) \\approx 0.8824969025...$\n$$\\Delta \\rho \\approx 0.068 \\times 0.8824969025 \\approx 0.06000978937$$\n按照要求，四舍五入到四位有效数字：\n$$\\Delta \\rho \\approx 0.06001$$\n\n误差为正，这符合预期，因为暗目标（$\\rho_d=0.02$）被一个更亮的表面（$\\rho_b=0.36$）所包围，导致来自周围环境的散射光错误地增加了目标的表观辐亮度，从而增加了反演得到的反射率。",
            "answer": "$$\\boxed{0.06001}$$"
        },
        {
            "introduction": "最后的实践 () 将引导你从单点、单波段的计算，跃升至构建一个完整的光谱大气校正模型。这个编程练习旨在综合运用包括瑞利散射、气溶胶散射、气体吸收以及观测几何在内的各项知识，编写一个类似于6S模型的正向与反向辐射传输工具。通过这一过程，你将把理论知识转化为能够解决实际问题的代码，并深刻体会不同大气参数对地表反射率反演精度的影响。",
            "id": "3797706",
            "problem": "一台星载辐射计用于测量大气传输窗口内部及附近的离散波长处的大气层顶光谱辐亮度 $L_{\\mathrm{sat}}(\\lambda)$。其目标是通过明确地考虑由分子和气溶胶散射以及水汽和臭氧吸收引起的大气路径辐亮度和双向透射率，来反演朗伯表面光谱反射率 $\\rho(\\lambda)$。您将编写的程序应借鉴 Second Simulation of the Satellite Signal in the Solar Spectrum (6S) 的思想，实现一个物理上合理的、单次散射、平面平行大气模型，但不使用任何预先计算的系数表。\n\n使用的基本原理：\n- 用于透射率的 Beer–Lambert 定律：如果沿路径的光学厚度为 $\\tau$，则沿方向余弦为 $\\mu$ 的斜路径的透射率为 $\\exp(-\\tau / \\mu)$。\n- 总光学厚度分解为可加分量：$\\tau(\\lambda) = \\tau_{\\mathrm{Rayleigh}}(\\lambda) + \\tau_{\\mathrm{aerosol}}(\\lambda) + \\tau_{\\mathrm{gas}}(\\lambda)$，其中 $\\tau_{\\mathrm{gas}}$ 综合了水汽和臭氧的吸收。\n- 路径辐亮度的概念：由太阳直射光束经大气散射进入传感器视线而产生的大气层顶辐亮度，与地表无关。\n- 朗伯表面反射率：地表的上行辐亮度等于 $\\rho(\\lambda)/\\pi$ 乘以地表的下行辐照度。\n- 大气层顶的大气层外太阳光谱辐照度 $E_{0}(\\lambda)$ 的定义。\n- 对于接近 $P_{0} = 1013\\,\\mathrm{hPa}$ 的海平面气压 $P$，Rayleigh 散射光学厚度可以用已知的波长依赖关系来近似。\n- 通过 Ångström 定律描述的气溶胶光学厚度光谱依赖性：$\\tau_{\\mathrm{aerosol}}(\\lambda) = \\mathrm{AOD}_{\\lambda_{0}}\\left(\\dfrac{\\lambda_{0}}{\\lambda}\\right)^{\\alpha}$，其中 $\\mathrm{AOD}_{\\lambda_{0}}$ 是在 $\\lambda_{0} = 0.55\\,\\mu\\mathrm{m}$ 处指定的值，$\\alpha$ 是由气溶胶类型决定的 Ångström 指数。\n- Rayleigh 散射的单次散射反照率近似为 $1$，而气溶胶的单次散射反照率取决于气溶胶类型。\n\n采用的建模假设：\n- 平面平行、水平均一的大气层。\n- 对于路径辐亮度项，采用各向同性相函数的单次散射。\n- 朗伯表面（双向反射分布函数等于常数 $\\rho(\\lambda)/\\pi$）。\n- 解耦的气体吸收，建模为水汽和臭氧的有效光学厚度沿太阳-地表-传感器斜路径的总和。\n\n使用太阳天顶角 $\\theta_{0}$ 和观测天顶角 $\\theta$ 定义几何关系，其中 $\\mu_{0} = \\cos(\\theta_{0})$ 且 $\\mu = \\cos(\\theta)$。角度必须以度为单位提供，并在内部转换为弧度。\n\n光谱网格和常数（必须完全按照给定值使用）：\n- 波长 $\\lambda$（单位：微米）：$[0.55,\\,0.65,\\,0.76,\\,0.86,\\,0.94,\\,1.64,\\,2.20]$。\n- 大气层外太阳光谱辐照度 $E_{0}(\\lambda)$（单位：$\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$）：$[1820,\\,1650,\\,1500,\\,1360,\\,1200,\\,900,\\,650]$。\n- 地表反射率真值向量（无单位）：$\\rho_{\\mathrm{gt}}(\\lambda) = [0.08,\\,0.06,\\,0.05,\\,0.42,\\,0.38,\\,0.25,\\,0.20]$。\n- 在波长 $\\lambda$（单位：$\\mu\\mathrm{m}$）和气压 $P \\approx 1013\\,\\mathrm{hPa}$ 条件下的海平面 Rayleigh 光学厚度模型：使用经验近似公式 $\\tau_{\\mathrm{Rayleigh}}(\\lambda) = 0.008569\\,\\lambda^{-4}\\left(1 + 0.0113\\,\\lambda^{-2} + 0.00013\\,\\lambda^{-4}\\right)$。\n- 带有 Ångström 指数 $\\alpha$ 和单次散射反照率 $\\omega_{\\mathrm{aer}}$ 的气溶胶类型：\n  - 大陆型：$\\alpha = 1.30$，$\\omega_{\\mathrm{aer}} = 0.95$。\n  - 海洋型：$\\alpha = 0.70$，$\\omega_{\\mathrm{aer}} = 0.99$。\n  - 城市型：$\\alpha = 1.00$，$\\omega_{\\mathrm{aer}} = 0.90$。\n- 每单位柱含量的气体吸收有效系数：\n  - 水汽吸收系数 $k_{\\mathrm{wv}}(\\lambda)$，每厘米可降水量：$[0.002,\\,0.003,\\,0.005,\\,0.010,\\,0.500,\\,0.070,\\,0.200]\\,\\mathrm{cm}^{-1}$。\n  - 臭氧吸收系数 $k_{\\mathrm{oz}}(\\lambda)$，每大气厘米：$[0.020,\\,0.015,\\,0.010,\\,0.005,\\,0.001,\\,0.000,\\,0.000]\\,(\\mathrm{atm\\mbox{-}cm})^{-1}$。\n\n程序要求：\n- 实现一个正向算子，该算子结合散射和吸收，从输入 $(\\mathrm{aerosol\\ type},\\,\\mathrm{AOD}_{0.55},\\,W,\\,U,\\,\\theta_{0},\\,\\theta,\\,\\rho_{\\mathrm{gt}})$ 合成 $L_{\\mathrm{sat}}(\\lambda)$，其中 $W$ 是单位为厘米的水汽柱含量，$U$ 是单位为大气厘米的臭氧含量。\n- 实现反演算子，使用您推导的单次散射模型从合成的 $L_{\\mathrm{sat}}(\\lambda)$ 中反演 $\\rho(\\lambda)$。\n- 通过计算在给定光谱网格上，反演的 $\\rho(\\lambda)$ 与 $\\rho_{\\mathrm{gt}}(\\lambda)$ 之间的均方根误差（RMSE）来验证反演结果。RMSE 必须计算为无单位浮点数。\n\n单位和数值约定：\n- 辐亮度单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$，辐照度单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu\\mathrm{m}^{-1}$，反射率为无单位量。\n- 角度以度为单位提供，在内部必须转换为弧度以用于三角函数计算；输出中不报告任何角度。\n- 最终的 RMSE 值为无单位浮点数。\n\n测试套件：\n提供三个测试用例以测试大气窗口和路径辐亮度效应：\n- 用例 $1$（通用“理想路径”）：气溶胶类型 $\\mathrm{continental}$，$\\mathrm{AOD}_{0.55} = 0.20$，$W = 2.00\\,\\mathrm{cm}$，$U = 0.30\\,\\mathrm{atm\\mbox{-}cm}$，$\\theta_{0} = 30^{\\circ}$，$\\theta = 0^{\\circ}$。\n- 用例 $2$（低 AOD 边界）：气溶胶类型 $\\mathrm{maritime}$，$\\mathrm{AOD}_{0.55} = 0.02$，$W = 0.50\\,\\mathrm{cm}$，$U = 0.25\\,\\mathrm{atm\\mbox{-}cm}$，$\\theta_{0} = 10^{\\circ}$，$\\theta = 0^{\\circ}$。\n- 用例 $3$（强路径辐亮度与吸收边）：气溶胶类型 $\\mathrm{urban}$，$\\mathrm{AOD}_{0.55} = 1.00$，$W = 4.00\\,\\mathrm{cm}$，$U = 0.35\\,\\mathrm{atm\\mbox{-}cm}$，$\\theta_{0} = 60^{\\circ}$，$\\theta = 30^{\\circ}$。\n\n程序中要实现的算法任务：\n- 对每个测试用例，使用提供的经验公式计算 $\\tau_{\\mathrm{Rayleigh}}(\\lambda)$。\n- 使用测试用例的 $\\mathrm{AOD}_{0.55}$ 和气溶胶类型的 $\\alpha$，根据 Ångström 定律计算 $\\tau_{\\mathrm{aerosol}}(\\lambda)$。\n- 计算有效气体光学厚度 $\\tau_{\\mathrm{gas}}(\\lambda) = k_{\\mathrm{wv}}(\\lambda)\\,W + k_{\\mathrm{oz}}(\\lambda)\\,U$。\n- 使用 $\\mu_{0} = \\cos(\\theta_{0})$ 和 $\\mu = \\cos(\\theta)$（角度以度为单位）。\n- 从第一性原理出发（不使用查表捷径），构建物理上一致的单次散射路径辐亮度和双向透射率，并对其进行反演以得到 $\\rho(\\lambda)$。\n- 对每个用例，通过比较反演的 $\\rho(\\lambda)$ 和 $\\rho_{\\mathrm{gt}}(\\lambda)$ 来计算整个光谱网格上的 RMSE。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的 RMSE 结果，格式为方括号内以逗号分隔的列表，例如，“[r1,r2,r3]”。每个元素必须是标准 Python 字符串格式的浮点数（无单位，无额外文本）。",
            "solution": "该问题要求开发和验证一个简化的大气校正模型。该过程包括两个主要阶段：首先，构建一个正向模型，根据已知的地表和大气特性合成大气层顶（TOA）光谱辐亮度 $L_{\\mathrm{sat}}(\\lambda)$。其次，推导并实现一个反演模型，从合成的 TOA 辐亮度中反演地表光谱反射率 $\\rho(\\lambda)$。验证通过闭合测试进行，其中将反演得到的反射率与正向模拟中使用的地表反射率真值进行比较。差异通过均方根误差（RMSE）进行量化。该模型基于平面平行、水平均一的大气中的单次散射原理。\n\n解决方案的核心是在指定的简化条件下构建辐射传输方程。卫星传感器测量到的 TOA 辐亮度 $L_{\\mathrm{sat}}(\\lambda)$ 是两个分量的总和：大气路径辐亮度 $L_{\\mathrm{path}}(\\lambda)$ 和源自地表并透过大气传输到传感器的辐亮度 $L_{\\mathrm{ground}}(\\lambda)$。\n\n$$L_{\\mathrm{sat}}(\\lambda) = L_{\\mathrm{path}}(\\lambda) + L_{\\mathrm{ground}}(\\lambda)$$\n\n推导过程是基于第一性原理和给定的建模假设来构建每一项。\n\n首先，我们将总大气光学厚度 $\\tau(\\lambda)$ 定义为其组成成分光学厚度的线性总和：Rayleigh 散射（$\\tau_R$）、气溶胶散射和吸收（$\\tau_{aer}$）以及气体吸收（$\\tau_{gas}$）。\n\n$$\\tau(\\lambda) = \\tau_R(\\lambda) + \\tau_{aer}(\\lambda) + \\tau_{gas}(\\lambda)$$\n\n各个光学厚度的计算如下：\n-   Rayleigh 光学厚度 $\\tau_R(\\lambda)$ 由经验公式给出：\n    $$\\tau_R(\\lambda) = 0.008569\\,\\lambda^{-4}\\left(1 + 0.0113\\,\\lambda^{-2} + 0.00013\\,\\lambda^{-4}\\right)$$\n-   气溶胶光学厚度 $\\tau_{aer}(\\lambda)$ 由 Ångström 定律确定：\n    $$\\tau_{aer}(\\lambda) = \\mathrm{AOD}_{\\lambda_{0}}\\left(\\frac{\\lambda_{0}}{\\lambda}\\right)^{\\alpha}$$\n    其中 $\\lambda_0 = 0.55\\,\\mu\\mathrm{m}$。\n-   气体吸收光学厚度 $\\tau_{gas}(\\lambda)$ 是水汽（$W$）和臭氧（$U$）贡献的总和：\n    $$\\tau_{gas}(\\lambda) = k_{\\mathrm{wv}}(\\lambda)W + k_{\\mathrm{oz}}(\\lambda)U$$\n\n路径辐亮度 $L_{\\mathrm{path}}(\\lambda)$ 表示未经地表相互作用、由大气散射进入传感器视线的太阳辐射。对于一个具有各向同性相函数（$P(\\Phi)=1$）的单次散射模型，路径辐亮度通过对沿观测路径的单次散射太阳光子的贡献进行积分而得到。这种散射光的来源是直射太阳光束，它在到达散射点的路径上发生衰减。这得出：\n\n$$L_{\\mathrm{path}}(\\lambda) = \\int_0^{\\tau(\\lambda)} J(t) e^{-t/\\mu} \\frac{dt}{\\mu}$$\n\n其中 $J(t)$ 是光学厚度 $t$ 处的源函数，$\\mu = \\cos(\\theta)$ 是观测天顶角的余弦。单次散射源函数为 $J(t) = \\frac{\\omega_{tot}(\\lambda)}{4\\pi} E_0(\\lambda) e^{-t/\\mu_0}$，其中 $\\mu_0 = \\cos(\\theta_0)$ 是太阳天顶角的余弦，$E_0(\\lambda)$ 是大气层外太阳辐照度，$\\omega_{tot}(\\lambda)$ 是大气柱的总单次散射反照率。该反照率是总散射光学厚度与总消光光学厚度的比值：\n\n$$\\omega_{tot}(\\lambda) = \\frac{\\tau_R(\\lambda)\\omega_R + \\tau_{aer}(\\lambda)\\omega_{aer}}{\\tau(\\lambda)} = \\frac{\\tau_R(\\lambda) + \\tau_{aer}(\\lambda)\\omega_{aer}}{\\tau_R(\\lambda) + \\tau_{aer}(\\lambda) + \\tau_{gas}(\\lambda)}$$\n\n在此，Rayleigh 散射的单次散射反照率 $\\omega_R$ 取为 $1$。对路径辐亮度方程进行积分，得到最终表达式：\n\n$$L_{\\mathrm{path}}(\\lambda) = \\frac{\\omega_{tot}(\\lambda) E_0(\\lambda)}{4\\pi\\mu} \\int_0^{\\tau(\\lambda)} e^{-t(1/\\mu_0 + 1/\\mu)} dt = \\frac{\\omega_{tot}(\\lambda) E_0(\\lambda) \\mu_0}{4\\pi(\\mu_0 + \\mu)} \\left[1 - e^{-\\tau(\\lambda)(1/\\mu_0 + 1/\\mu)}\\right]$$\n\n地表反射分量 $L_{\\mathrm{ground}}(\\lambda)$ 是在朗伯表面的假设下构建的。地表的下行太阳辐照度近似为衰减后的太阳直射光束，$E_{\\mathrm{down}}(\\lambda) = E_0(\\lambda)\\mu_0 e^{-\\tau(\\lambda)/\\mu_0}$。地表反射此能量，产生一个上行辐亮度 $L_{\\mathrm{up}, \\mathrm{sfc}}(\\lambda) = \\frac{\\rho(\\lambda)}{\\pi} E_{\\mathrm{down}}(\\lambda)$。这个上行辐亮度在到达传感器的路径上被因子 $e^{-\\tau(\\lambda)/\\mu}$ 衰减。最终在传感器处得到的辐亮度为：\n\n$$L_{\\mathrm{ground}}(\\lambda) = \\frac{\\rho(\\lambda)}{\\pi} \\left(E_0(\\lambda)\\mu_0 e^{-\\tau(\\lambda)/\\mu_0}\\right) e^{-\\tau(\\lambda)/\\mu} = \\frac{\\rho(\\lambda)}{\\pi} E_0(\\lambda)\\mu_0 e^{-\\tau(\\lambda)(1/\\mu_0 + 1/\\mu)}$$\n\n结合这些项，便得到 $L_{\\mathrm{sat}}(\\lambda)$ 的完整正向模型。对于问题的模拟部分，我们使用地表反射率真值 $\\rho_{\\mathrm{gt}}(\\lambda)$ 来合成 TOA 辐亮度。\n\n下一步是推导用于反演地表反射率 $\\rho(\\lambda)$ 的反演模型。这可以通过对正向模型方程进行代数重排来实现：\n\n$$L_{\\mathrm{sat}}(\\lambda) - L_{\\mathrm{path}}(\\lambda) = \\frac{\\rho(\\lambda)}{\\pi} E_0(\\lambda)\\mu_0 e^{-\\tau(\\lambda)(1/\\mu_0 + 1/\\mu)}$$\n\n解出 $\\rho(\\lambda)$：\n\n$$\\rho(\\lambda) = \\frac{\\pi (L_{\\mathrm{sat}}(\\lambda) - L_{\\mathrm{path}}(\\lambda))}{E_0(\\lambda)\\mu_0 e^{-\\tau(\\lambda)(1/\\mu_0 + 1/\\mu)}}$$\n\n每个测试用例的计算步骤如下：\n1.  定义大气状态（$\\mathrm{AOD}_{0.55}$、气溶胶类型、$W$、$U$）和观测几何（$\\theta_0, \\theta$）的输入参数。\n2.  对于给定光谱网格中的每个波长 $\\lambda$，计算各分量光学厚度和总光学厚度（$\\tau_R, \\tau_{aer}, \\tau_{gas}, \\tau$）以及总单次散射反照率（$\\omega_{tot}$）。\n3.  使用地表反射率真值 $\\rho_{\\mathrm{gt}}(\\lambda)$，通过正向模型计算合成的 TOA 辐亮度 $L_{\\mathrm{sat}}(\\lambda)$。\n4.  使用合成的 $L_{\\mathrm{sat}}(\\lambda)$ 和相同的大气参数，通过反演模型反演地表反射率 $\\rho_{\\mathrm{retrieved}}(\\lambda)$。\n5.  处理完所有波长后，计算反演的反射率向量 $\\vec{\\rho}_{\\mathrm{retrieved}}$ 与真值向量 $\\vec{\\rho}_{\\mathrm{gt}}$ 之间的 RMSE：\n    $$\\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} \\left(\\rho_{\\mathrm{retrieved}}(\\lambda_i) - \\rho_{\\mathrm{gt}}(\\lambda_i)\\right)^2}$$\n    其中 $N=7$ 是光谱波段的数量。\n\n由于反演模型是正向模型的精确代数逆运算，反演得到的反射率 $\\rho_{\\mathrm{retrieved}}(\\lambda)$ 应与地表反射率真值 $\\rho_{\\mathrm{gt}}(\\lambda)$ 完全相同，因此得到的 RMSE 应为零（或因有限浮点精度而为一个非常小的数）。这证实了所推导模型及其实现的正确性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the atmospheric correction problem by implementing a forward and inverse\n    single-scattering model, and validates it via a closure test.\n    \"\"\"\n    \n    # --- Spectral Grid and Constants ---\n    lambdas = np.array([0.55, 0.65, 0.76, 0.86, 0.94, 1.64, 2.20]) # micrometers\n    E0 = np.array([1820., 1650., 1500., 1360., 1200., 900., 650.]) # W m^-2 um^-1\n    rho_gt = np.array([0.08, 0.06, 0.05, 0.42, 0.38, 0.25, 0.20]) # unitless\n    \n    # Gas absorption coefficients\n    k_wv = np.array([0.002, 0.003, 0.005, 0.010, 0.500, 0.070, 0.200]) # cm^-1\n    k_oz = np.array([0.020, 0.015, 0.010, 0.005, 0.001, 0.000, 0.000]) # (atm-cm)^-1\n\n    # Aerosol properties\n    aerosol_props = {\n        'continental': {'alpha': 1.30, 'omega_aer': 0.95},\n        'maritime': {'alpha': 0.70, 'omega_aer': 0.99},\n        'urban': {'alpha': 1.00, 'omega_aer': 0.90}\n    }\n    \n    # --- Test Suite ---\n    test_cases = [\n        {'aerosol_type': 'continental', 'aod_550': 0.20, 'W': 2.00, 'U': 0.30, 'theta0': 30., 'theta': 0.},\n        {'aerosol_type': 'maritime', 'aod_550': 0.02, 'W': 0.50, 'U': 0.25, 'theta0': 10., 'theta': 0.},\n        {'aerosol_type': 'urban', 'aod_550': 1.00, 'W': 4.00, 'U': 0.35, 'theta0': 60., 'theta': 30.}\n    ]\n\n    rmse_results = []\n\n    for case in test_cases:\n        # --- Unpack case parameters ---\n        props = aerosol_props[case['aerosol_type']]\n        alpha = props['alpha']\n        omega_aer = props['omega_aer']\n        aod_550 = case['aod_550']\n        W = case['W']\n        U = case['U']\n        theta0_deg = case['theta0']\n        theta_deg = case['theta']\n\n        # --- Geometric calculations ---\n        mu0 = np.cos(np.deg2rad(theta0_deg))\n        mu = np.cos(np.deg2rad(theta_deg))\n\n        # --- Calculate Optical Depths per wavelength ---\n        # 1. Rayleigh optical depth\n        tau_R = 0.008569 * lambdas**-4 * (1 + 0.0113 * lambdas**-2 + 0.00013 * lambdas**-4)\n\n        # 2. Aerosol optical depth (Ångström law)\n        lambda0 = 0.55\n        tau_aer = aod_550 * (lambda0 / lambdas)**alpha\n\n        # 3. Gas absorption optical depth\n        tau_gas = k_wv * W + k_oz * U\n\n        # 4. Total optical depth\n        tau = tau_R + tau_aer + tau_gas\n\n        # --- Calculate total single-scattering albedo ---\n        # Rayleigh single scattering albedo is 1. We must handle tau=0 to avoid division by zero.\n        # However, tau is the sum of three non-negative terms, and tau_R is always > 0 for these wavelengths.\n        # So tau will not be zero.\n        omega_tot = (tau_R * 1.0 + tau_aer * omega_aer) / tau\n\n        # --- Forward Model: Synthesize L_sat ---\n        geom_factor = 1.0 / mu0 + 1.0 / mu\n        two_way_transmittance = np.exp(-tau * geom_factor)\n        \n        # Path radiance for isotropic single scattering\n        L_path = (omega_tot * E0 * mu0) / (4.0 * np.pi * (mu0 + mu)) * (1.0 - two_way_transmittance)\n\n        # Ground-reflected radiance\n        # Here we need the transmittance of the direct beam + diffuse light.\n        # The simple model stated uses a single transmittance for the entire path.\n        # So we model ground radiance as reflected direct+diffuse flux, transmitted to sensor.\n        # The problem text is simplified and only considers direct beam for ground illumination.\n        # L_ground = rho_gt/pi * E_down * T_up\n        # E_down = E0*mu0*T_down. The model uses the same tau for up and down.\n        # So we use the two_way_transmittance derived from the combined geometric path.\n        L_ground = (rho_gt / np.pi) * E0 * mu0 * two_way_transmittance\n        \n        # Total TOA radiance\n        L_sat = L_path + L_ground\n        \n        # --- Inverse Model: Retrieve rho ---\n        \n        # Denominator of the reflectance equation\n        denominator = (E0 * mu0 / np.pi) * two_way_transmittance\n        \n        # Retrieve reflectance\n        # We must avoid division by zero if the denominator is zero (e.g., if transmittance is zero)\n        # However, with the given parameters, this is not expected.\n        rho_retrieved = np.zeros_like(rho_gt)\n        # Avoid division by zero, although not expected here\n        valid_indices = denominator > 1e-9\n        rho_retrieved[valid_indices] = (L_sat[valid_indices] - L_path[valid_indices]) / denominator[valid_indices]\n\n        # --- Validation: Compute RMSE ---\n        rmse = np.sqrt(np.mean((rho_retrieved - rho_gt)**2))\n        rmse_results.append(rmse)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, rmse_results))}]\")\n\nsolve()\n```"
        }
    ]
}