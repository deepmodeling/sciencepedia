{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of thermal remote sensing is understanding how an object's temperature dictates the wavelength of its peak radiation. This practice () guides you through a fundamental derivation from Planck's law to establish this relationship, known as Wien's displacement law. By calculating this peak for a typical terrestrial temperature, you will connect this core principle to the practical design of thermal sensors.",
            "id": "3836453",
            "problem": "A homogeneous, opaque surface is isothermal at temperature $T = 320\\,\\text{K}$ and has spectral emissivity equal to $1$ across the thermal band. Assume negligible atmospheric attenuation so that the surface-emitted spectral radiance at the top of the atmosphere equals the blackbody spectral radiance. Starting from the Planck spectral radiance for wavelength, and using only fundamental constants and operations, derive the necessary condition that determines the wavelength at which the spectral radiance with respect to wavelength attains its maximum for a given temperature. Use that condition to compute the peak emission wavelength for $T = 320\\,\\text{K}$. For numerical evaluation, use $h = 6.62607015 \\times 10^{-34}\\,\\text{J}\\,\\text{s}$, $c = 2.99792458 \\times 10^{8}\\,\\text{m}\\,\\text{s}^{-1}$, and $k_{B} = 1.380649 \\times 10^{-23}\\,\\text{J}\\,\\text{K}^{-1}$. Express the final wavelength in micrometers and round your answer to four significant figures. Then, based on standard atmospheric transmission characteristics, state whether the resulting wavelength lies within the primary Thermal Infrared (TIR) atmospheric window commonly characterized in the range `$8–12$` micrometers, or in the `$3–5$` micrometers mid-wave region. Report only the wavelength as your final numerical answer as instructed, with the interpretive classification included in your reasoning.",
            "solution": "The appropriate fundamental base is Planck’s law for the spectral radiance of a blackbody expressed per unit wavelength. The spectral radiance as a function of wavelength $\\lambda$ and temperature $T$ is\n$$\nB_{\\lambda}(\\lambda,T) \\;=\\; \\frac{2 h c^{2}}{\\lambda^{5}}\\,\\frac{1}{\\exp\\!\\left(\\frac{h c}{\\lambda k_{B} T}\\right) - 1}.\n$$\nFor an isothermal, unit-emissivity surface with negligible atmospheric attenuation, the emitted spectral radiance equals $B_{\\lambda}(\\lambda,T)$. The peak emission wavelength with respect to $\\lambda$ is obtained by solving\n$$\n\\frac{\\partial B_{\\lambda}}{\\partial \\lambda} \\;=\\; 0.\n$$\nIt is algebraically convenient to set the derivative of the logarithm to zero, because $B_{\\lambda}  0$ implies that extremizers of $B_{\\lambda}$ coincide with extremizers of $\\ln B_{\\lambda}$:\n$$\n\\frac{\\partial}{\\partial \\lambda}\\ln B_{\\lambda} \\;=\\; 0.\n$$\nWrite\n$$\n\\ln B_{\\lambda} \\;=\\; \\ln(2 h c^{2}) \\;-\\;5 \\ln \\lambda \\;-\\; \\ln\\!\\Big(\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big) - 1\\Big).\n$$\nDifferentiate with respect to $\\lambda$:\n$$\n\\frac{\\partial}{\\partial \\lambda}\\ln B_{\\lambda}\n\\;=\\;\n-\\frac{5}{\\lambda}\n\\;-\\;\n\\frac{1}{\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big)-1}\n\\cdot\n\\exp\\!\\Big(\\frac{h c}{\\lambda k_{B} T}\\Big)\\cdot\n\\frac{\\partial}{\\partial \\lambda}\\!\\Big(\\frac{h c}{\\lambda k_{B} T}\\Big).\n$$\nSince\n$$\n\\frac{\\partial}{\\partial \\lambda}\\!\\Big(\\frac{h c}{\\lambda k_{B} T}\\Big)\n\\;=\\;\n-\\frac{h c}{k_{B} T}\\,\\frac{1}{\\lambda^{2}},\n$$\nwe have\n$$\n\\frac{\\partial}{\\partial \\lambda}\\ln B_{\\lambda}\n\\;=\\;\n-\\frac{5}{\\lambda}\n\\;+\\;\n\\frac{h c}{k_{B} T}\\,\\frac{1}{\\lambda^{2}}\\,\n\\frac{\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big)}{\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big)-1}.\n$$\nSetting this equal to zero and multiplying by $\\lambda$ yields\n$$\n-5 \\;+\\; \\frac{h c}{k_{B} T}\\,\\frac{1}{\\lambda}\\,\n\\frac{\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big)}{\\exp\\!\\big(\\tfrac{h c}{\\lambda k_{B} T}\\big)-1}\n\\;=\\; 0.\n$$\nIntroduce the dimensionless variable\n$$\nx \\;\\equiv\\; \\frac{h c}{\\lambda k_{B} T}.\n$$\nThen the stationarity condition becomes\n$$\n-5 \\;+\\; x\\,\\frac{\\exp(x)}{\\exp(x)-1} \\;=\\; 0,\n$$\nwhich can be rearranged to the classical transcendental form\n$$\n5\\big(1 - \\exp(-x)\\big) \\;=\\; x.\n$$\nThis equation has a unique positive solution $x^{\\star}$, which can be found numerically, for example by Newton–Raphson iteration applied to $f(x) = 5(1-\\exp(-x)) - x$. The derivative is $f'(x) = 5\\exp(-x) - 1$. With an initial guess $x_{0} = 5$, iteration\n$$\nx_{n+1} \\;=\\; x_{n} - \\frac{f(x_{n})}{f'(x_{n})}\n$$\nconverges rapidly to\n$$\nx^{\\star} \\;\\approx\\; 4.9651142317.\n$$\nOnce $x^{\\star}$ is known, the peak wavelength follows from\n$$\n\\lambda_{\\max} \\;=\\; \\frac{h c}{k_{B} T}\\,\\frac{1}{x^{\\star}}.\n$$\nDefine the second radiation constant\n$$\nc_{2} \\;\\equiv\\; \\frac{h c}{k_{B}}.\n$$\nUsing the provided fundamental constants,\n$$\nc_{2} \\;=\\; \\frac{\\big(6.62607015 \\times 10^{-34}\\big)\\,\\big(2.99792458 \\times 10^{8}\\big)}{1.380649 \\times 10^{-23}}\n\\;\\text{m}\\cdot\\text{K}\n\\;\\approx\\;\n1.438776877 \\times 10^{-2}\\;\\text{m}\\cdot\\text{K}.\n$$\nTherefore,\n$$\n\\lambda_{\\max} \\;=\\; \\frac{c_{2}}{x^{\\star} T}\n\\;=\\;\n\\frac{1.438776877 \\times 10^{-2}}{\\big(4.9651142317\\big)\\,\\big(320\\big)}\\;\\text{m}.\n$$\nNumerically,\n$$\n\\lambda_{\\max} \\;\\approx\\; 9.055537359 \\times 10^{-6}\\;\\text{m}\n\\;=\\; 9.055537359\\;\\text{micrometers}.\n$$\nRounded to four significant figures and expressed in micrometers, this is\n$$\n\\lambda_{\\max} \\;\\approx\\; 9.056\\;\\text{micrometers}.\n$$\nInterpretation for atmospheric windows: the primary Thermal Infrared (TIR) atmospheric window is commonly characterized in the range `$8–12$` micrometers (sometimes extended to about `$8–14$` micrometers depending on atmospheric state), whereas the mid-wave region with a transmission window is around `$3–5$` micrometers. The computed peak at approximately $9.056$ micrometers lies squarely within the `$8–12$` micrometers TIR window. While there is a known ozone absorption feature near $9.6$ micrometers, typical clear-sky transmission remains high across most of `$8–12$` micrometers, so the peak emission for a surface near $320\\,\\text{K}$ aligns with the principal TIR window used in terrestrial thermal remote sensing.",
            "answer": "$$\\boxed{9.056}$$"
        },
        {
            "introduction": "Real-world surfaces are not perfect blackbodies, and their emissivity significantly impacts radiance measurements. This exercise () demonstrates the critical sensitivity of temperature retrievals to errors in assumed emissivity. You will quantify the bias in retrieved brightness temperature that arises from a small but realistic emissivity error, revealing a core challenge in thermal remote sensing.",
            "id": "3836437",
            "problem": "A single-band thermal infrared retrieval at wavelength $\\lambda=11\\,\\mu\\text{m}$ is performed over a homogeneous, Lambertian land surface. After perfect atmospheric correction, the at-surface spectral radiance is modeled as $L_{\\lambda}=\\epsilon_{\\lambda}\\,B_{\\lambda}(T)$, where $\\epsilon_{\\lambda}$ is the spectral emissivity, $T$ is the true kinetic temperature, and $B_{\\lambda}(T)$ is the blackbody spectral radiance given by Planck’s law,\n$$\nB_{\\lambda}(T)=\\frac{2hc^{2}}{\\lambda^{5}}\\frac{1}{\\exp\\!\\left(\\frac{hc}{\\lambda k_{B}T}\\right)-1}.\n$$\nBrightness Temperature (BT) $T_{b}$ is defined as the temperature that, when inserted into Planck’s law, reproduces the observed radiance under the emissivity assumed in the retrieval.\n\nAssume the true emissivity is $\\epsilon_{\\lambda}^{\\text{true}}=0.98$ and the true kinetic temperature is $T=300\\,\\text{K}$. The retrieval uses an emissivity that is biased by $\\Delta\\epsilon=+0.02$ (so the assumed emissivity is $\\epsilon_{\\lambda}^{\\text{assumed}}=\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon$). Treat $\\Delta\\epsilon$ as small and neglect reflected downwelling radiance and any atmospheric path terms. Starting from the fundamental relations above and without introducing any empirical shortcut formulas, derive the first-order bias in brightness temperature $\\Delta T_{b}=T_{b}-T$ caused by the emissivity bias and then evaluate it numerically at $\\lambda=11\\,\\mu\\text{m}$ and $T=300\\,\\text{K}$.\n\nUse the following physical constants in SI units: Planck’s constant $h=6.62607015\\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$, speed of light in vacuum $c=2.99792458\\times 10^{8}\\,\\text{m}\\cdot\\text{s}^{-1}$, and Boltzmann’s constant $k_{B}=1.380649\\times 10^{-23}\\,\\text{J}\\cdot\\text{K}^{-1}$. Express the final brightness temperature bias in Kelvin and round your answer to three significant figures.",
            "solution": "The physically corrected at-surface spectral radiance from the scene is\n$$\nL_{\\lambda}=\\epsilon_{\\lambda}^{\\text{true}}\\,B_{\\lambda}(T).\n$$\nIn a single-band retrieval, the brightness temperature $T_{b}$ is obtained by solving\n$$\nL_{\\lambda}=\\epsilon_{\\lambda}^{\\text{assumed}}\\,B_{\\lambda}(T_{b}),\n$$\nwith $\\epsilon_{\\lambda}^{\\text{assumed}}=\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon$. Equating the two expressions for $L_{\\lambda}$ gives\n$$\n\\epsilon_{\\lambda}^{\\text{true}}\\,B_{\\lambda}(T)=\\left(\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon\\right)\\,B_{\\lambda}(T_{b}).\n$$\nDefine the brightness temperature bias $\\Delta T_{b}=T_{b}-T$. For small $\\Delta\\epsilon$, we linearize $B_{\\lambda}(T_{b})$ around $T$:\n$$\nB_{\\lambda}(T_{b})\\approx B_{\\lambda}(T)+\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}\\,\\Delta T_{b}.\n$$\nSubstitute this into the equality:\n$$\n\\epsilon_{\\lambda}^{\\text{true}}\\,B_{\\lambda}(T)=\\left(\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon\\right)\\left[B_{\\lambda}(T)+\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}\\,\\Delta T_{b}\\right].\n$$\nExpand and retain only first-order terms in $\\Delta\\epsilon$ and $\\Delta T_{b}$:\n$$\n\\epsilon_{\\lambda}^{\\text{true}}\\,B_{\\lambda}(T)\\approx \\left(\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon\\right)B_{\\lambda}(T)+\\left(\\epsilon_{\\lambda}^{\\text{true}}+\\Delta\\epsilon\\right)\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}\\,\\Delta T_{b}.\n$$\nSubtract $\\epsilon_{\\lambda}^{\\text{true}}\\,B_{\\lambda}(T)$ from both sides and neglect the product $\\Delta\\epsilon\\,\\Delta T_{b}$:\n$$\n0\\approx \\Delta\\epsilon\\,B_{\\lambda}(T)+\\epsilon_{\\lambda}^{\\text{true}}\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}\\,\\Delta T_{b}.\n$$\nSolve for the brightness temperature bias:\n$$\n\\Delta T_{b}\\approx -\\frac{\\Delta\\epsilon}{\\epsilon_{\\lambda}^{\\text{true}}}\\,\\frac{B_{\\lambda}(T)}{\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}}.\n$$\nTo simplify $\\frac{B_{\\lambda}(T)}{\\partial B_{\\lambda}/\\partial T}$, start from Planck’s law\n$$\nB_{\\lambda}(T)=\\frac{2hc^{2}}{\\lambda^{5}}\\frac{1}{\\exp(x)-1},\\quad x=\\frac{hc}{\\lambda k_{B}T},\n$$\nand compute the derivative. Write $x=\\frac{A}{T}$, where $A=\\frac{hc}{\\lambda k_{B}}$. Then\n$$\n\\frac{\\partial B_{\\lambda}}{\\partial T}=\\frac{2hc^{2}}{\\lambda^{5}}\\left[-\\frac{\\exp(x)}{(\\exp(x)-1)^{2}}\\right]\\frac{\\partial x}{\\partial T}.\n$$\nSince $\\frac{\\partial x}{\\partial T}=-\\frac{A}{T^{2}}=-\\frac{x}{T}$, we obtain\n$$\n\\frac{\\partial B_{\\lambda}}{\\partial T}=\\frac{2hc^{2}}{\\lambda^{5}}\\frac{x\\,\\exp(x)}{T\\,(\\exp(x)-1)^{2}}.\n$$\nForm the ratio\n$$\n\\frac{B_{\\lambda}(T)}{\\left.\\frac{\\partial B_{\\lambda}}{\\partial T}\\right|_{T}}=\\frac{\\frac{2hc^{2}}{\\lambda^{5}}\\frac{1}{\\exp(x)-1}}{\\frac{2hc^{2}}{\\lambda^{5}}\\frac{x\\,\\exp(x)}{T\\,(\\exp(x)-1)^{2}}}=\\frac{T}{x}\\,\\frac{\\exp(x)-1}{\\exp(x)}= \\frac{T}{x}\\left(1-\\exp(-x)\\right).\n$$\nTherefore, the first-order bias is\n$$\n\\Delta T_{b}\\approx -\\frac{\\Delta\\epsilon}{\\epsilon_{\\lambda}^{\\text{true}}}\\,\\frac{T}{x}\\left(1-\\exp(-x)\\right),\\quad x=\\frac{hc}{\\lambda k_{B}T}.\n$$\nThis expression shows that a positive emissivity bias ($\\Delta\\epsilon0$) yields a negative brightness temperature bias, consistent with physical intuition: if one assumes a larger emissivity, a smaller temperature is needed to reproduce the same radiance.\n\nWe now evaluate numerically at $\\lambda=11\\,\\mu\\text{m}$, $T=300\\,\\text{K}$, $\\epsilon_{\\lambda}^{\\text{true}}=0.98$, and $\\Delta\\epsilon=+0.02$, using $h=6.62607015\\times 10^{-34}\\,\\text{J}\\cdot\\text{s}$, $c=2.99792458\\times 10^{8}\\,\\text{m}\\cdot\\text{s}^{-1}$, and $k_{B}=1.380649\\times 10^{-23}\\,\\text{J}\\cdot\\text{K}^{-1}$.\n\nCompute\n$$\nx=\\frac{hc}{\\lambda k_{B}T}=\\frac{6.62607015\\times 10^{-34}\\cdot 2.99792458\\times 10^{8}}{(11\\times 10^{-6})\\cdot 1.380649\\times 10^{-23}\\cdot 300}\\approx 4.362.\n$$\nThen\n$$\n1-\\exp(-x)\\approx 1-\\exp(-4.362)\\approx 0.987,\n$$\nand\n$$\n\\frac{T}{x}\\left(1-\\exp(-x)\\right)\\approx \\frac{300}{4.362}\\times 0.987\\approx 67.9.\n$$\nFinally,\n$$\n\\Delta T_{b}\\approx -\\frac{0.02}{0.98}\\times 67.9\\approx -1.39\\,\\text{K}.\n$$\nRounded to three significant figures, the brightness temperature bias is $-1.39\\,\\text{K}$.",
            "answer": "$$\\boxed{-1.39}$$"
        },
        {
            "introduction": "To overcome the challenges of imperfect and unknown emissivity, advanced algorithms are required. This capstone practice () guides you in building an iterative algorithm to solve the ill-posed problem of simultaneously retrieving temperature and emissivity. You will implement a professional-grade solution that combines radiative transfer physics with statistical constraints.",
            "id": "3836392",
            "problem": "You are tasked with designing and implementing an iterative Land Surface Temperature (LST) retrieval that jointly estimates the surface temperature $T_s$ and band-dependent emissivities $\\epsilon_\\lambda$ using a prior on emissivity and constraints from multi-band Thermal Infrared (TIR) radiance. Your implementation must be a complete, runnable program that computes the solution for a specified test suite and outputs the results in the exact required format.\n\nThe retrieval must be derived from fundamental principles of thermal remote sensing and radiative transfer. Use the following physically-founded base:\n\n- The spectral radiance of a blackbody at wavelength $\\lambda$ and temperature $T$ is given by Planck’s law:\n$$\nB_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\left(\\frac{h c}{\\lambda k T}\\right) - 1},\n$$\nwhere $h$ is Planck’s constant, $c$ is the speed of light, and $k$ is Boltzmann’s constant. The spectral radiance must be expressed per unit wavelength; for compatibility with typical satellite radiance units, convert results to per micrometer by multiplying the per-meter form by $10^{-6}$ so that $B_\\lambda(T)$ is in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$ when $\\lambda$ is in meters.\n\n- The top-of-atmosphere (TOA) spectral radiance at wavelength $\\lambda$ for a surface with spectral emissivity $\\epsilon_\\lambda$ and surface temperature $T_s$ in a plane-parallel atmosphere is modeled as:\n$$\nL_{\\mathrm{toa},\\lambda} = \\tau_\\lambda \\left[\\epsilon_\\lambda B_\\lambda(T_s) + (1 - \\epsilon_\\lambda) L_{\\downarrow,\\lambda}\\right] + L_{\\uparrow,\\lambda},\n$$\nwhere $\\tau_\\lambda$ is atmospheric transmittance, $L_{\\downarrow,\\lambda}$ is downwelling atmospheric radiance at the surface, and $L_{\\uparrow,\\lambda}$ is upwelling path radiance. All radiances must be treated in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$ and temperature in $\\mathrm{K}$.\n\n- The joint estimation must incorporate a Gaussian prior on emissivity:\n$$\n\\epsilon_\\lambda \\sim \\mathcal{N}(\\mu_{\\epsilon,\\lambda}, \\sigma_{\\epsilon,\\lambda}^2),\n$$\nand assume Gaussian measurement noise on TOA radiance with known standard deviation $\\sigma_{L,\\lambda}$. The retrieval should minimize the negative log-posterior equivalent to a weighted least-squares data misfit plus a quadratic prior penalty on emissivity:\n$$\nJ(T_s, \\{\\epsilon_\\lambda\\}) = \\sum_{\\lambda} \\frac{\\left(L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}} - \\tau_\\lambda \\left[\\epsilon_\\lambda B_\\lambda(T_s) + (1-\\epsilon_\\lambda) L_{\\downarrow,\\lambda}\\right] - L_{\\uparrow,\\lambda}\\right)^2}{\\sigma_{L,\\lambda}^2} + \\sum_{\\lambda} \\frac{\\left(\\epsilon_\\lambda - \\mu_{\\epsilon,\\lambda}\\right)^2}{\\sigma_{\\epsilon,\\lambda}^2}.\n$$\n\nConstraints:\n- Enforce physical bounds $0.7 \\le \\epsilon_\\lambda \\le 1.0$.\n- Enforce a reasonable bound on $T_s$ suitable for terrestrial surfaces, e.g., $250\\,\\mathrm{K} \\le T_s \\le 350\\,\\mathrm{K}$.\n\nAlgorithmic requirements:\n- Implement an iterative scheme that alternates between updating $\\{\\epsilon_\\lambda\\}$ given the current $T_s$ and updating $T_s$ given the current $\\{\\epsilon_\\lambda\\}$, until convergence. The update for $\\{\\epsilon_\\lambda\\}$ should exploit the linearity of the forward model in $\\epsilon_\\lambda$ for fixed $T_s$ and incorporate the prior. The update for $T_s$ must be obtained by minimizing the sum of weighted squared residuals over $T_s$ for fixed $\\{\\epsilon_\\lambda\\}$, respecting the specified bounds.\n- Convergence should be declared when the change in $T_s$ is less than $10^{-6}\\,\\mathrm{K}$ and the maximum change in any $\\epsilon_\\lambda$ is less than $10^{-8}$, or when a maximum of $50$ iterations is reached.\n- Use physically accurate constants: $h = 6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}$, $c = 299792458\\,\\mathrm{m\\,s^{-1}}$, $k = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$.\n- All wavelengths provided in micrometers must be converted to meters in the Planck function.\n\nTest suite specification:\nFor each test case, you are given effective wavelengths, atmospheric parameters, observed TOA radiances, measurement noise levels, and emissivity priors. Your program must solve for $T_s$ and $\\{\\epsilon_\\lambda\\}$ for each case and produce the output as specified.\n\nCase $1$ (typical clear land surface):\n- Effective wavelengths (micrometers): $[10.8, 12.0, 8.7]$.\n- Atmospheric transmittance: $[\\ 0.90,\\ 0.88,\\ 0.92\\ ]$.\n- Downwelling atmospheric radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 3.0,\\ 3.2,\\ 2.7\\ ]$.\n- Upwelling path radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 1.0,\\ 1.1,\\ 0.9\\ ]$.\n- Observed TOA radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 8.965,\\ 8.064,\\ 10.309\\ ]$.\n- Measurement noise standard deviation $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 0.15,\\ 0.15,\\ 0.15\\ ]$.\n- Emissivity prior means: $[\\ 0.95,\\ 0.96,\\ 0.94\\ ]$.\n- Emissivity prior standard deviations: $[\\ 0.02,\\ 0.02,\\ 0.02\\ ]$.\n- Bounds: $T_s \\in [250, 350]\\,\\mathrm{K}$, $\\epsilon_\\lambda \\in [0.7, 1.0]$.\n\nCase $2$ (humid atmosphere, lower emissivity surface):\n- Effective wavelengths (micrometers): $[10.8, 12.0, 8.7]$.\n- Atmospheric transmittance: $[\\ 0.65,\\ 0.60,\\ 0.70\\ ]$.\n- Downwelling atmospheric radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 4.0,\\ 4.5,\\ 3.5\\ ]$.\n- Upwelling path radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 1.5,\\ 1.8,\\ 1.2\\ ]$.\n- Observed TOA radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 7.645,\\ 6.874,\\ 8.821\\ ]$.\n- Measurement noise standard deviation $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 0.20,\\ 0.20,\\ 0.20\\ ]$.\n- Emissivity prior means: $[\\ 0.90,\\ 0.90,\\ 0.90\\ ]$.\n- Emissivity prior standard deviations: $[\\ 0.05,\\ 0.05,\\ 0.05\\ ]$.\n- Bounds: $T_s \\in [250, 350]\\,\\mathrm{K}$, $\\epsilon_\\lambda \\in [0.7, 1.0]$.\n\nCase $3$ (cool, high-emissivity surface):\n- Effective wavelengths (micrometers): $[10.8, 12.0, 8.7]$.\n- Atmospheric transmittance: $[\\ 0.95,\\ 0.94,\\ 0.96\\ ]$.\n- Downwelling atmospheric radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 2.5,\\ 2.4,\\ 2.6\\ ]$.\n- Upwelling path radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 0.7,\\ 0.8,\\ 0.6\\ ]$.\n- Observed TOA radiance $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 8.435,\\ 7.544,\\ 9.369\\ ]$.\n- Measurement noise standard deviation $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$: $[\\ 0.10,\\ 0.10,\\ 0.10\\ ]$.\n- Emissivity prior means: $[\\ 0.98,\\ 0.98,\\ 0.98\\ ]$.\n- Emissivity prior standard deviations: $[\\ 0.01,\\ 0.01,\\ 0.01\\ ]$.\n- Bounds: $T_s \\in [250, 350]\\,\\mathrm{K}$, $\\epsilon_\\lambda \\in [0.7, 1.0]$.\n\nImplementation and output requirements:\n- Use only the fundamental laws and definitions provided. Do not use or assume any shortcut retrieval formula.\n- Express $T_s$ in $\\mathrm{K}$ and emissivities in unitless decimals.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of the retrieved values in the form $[T_s,\\epsilon_{\\lambda_1},\\epsilon_{\\lambda_2},\\epsilon_{\\lambda_3}]$, where $T_s$ is rounded to three decimal places and emissivities are rounded to four decimal places. The overall output must thus be a single list of three lists, for example: $[[T_1,\\epsilon_{1,1},\\epsilon_{1,2},\\epsilon_{1,3}],[T_2,\\epsilon_{2,1},\\epsilon_{2,2},\\epsilon_{2,3}],[T_3,\\epsilon_{3,1},\\epsilon_{3,2},\\epsilon_{3,3}]]$.",
            "solution": "The user has provided a well-defined problem in the field of thermal remote sensing. The task is to design and implement an algorithm to jointly retrieve Land Surface Temperature ($T_s$) and band-dependent surface emissivities ($\\{\\epsilon_\\lambda\\}$) from multi-band thermal infrared radiance measurements.\n\n### 1. Problem Validation\n\nFirst, I will validate the problem statement against the required criteria.\n\n**Step 1: Extract Givens**\n\n-   **Physical Model - Planck's Law**: $B_\\lambda(T) = \\frac{2 h c^2}{\\lambda^5} \\frac{1}{\\exp\\left(\\frac{h c}{\\lambda k T}\\right) - 1}$. The result must be converted to units of $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$ by multiplying the SI result (per meter) by $10^{-6}$. In the formula, $\\lambda$ must be in meters.\n-   **Physical Model - Radiative Transfer Equation (RTE)**: The top-of-atmosphere (TOA) spectral radiance is given by $L_{\\mathrm{toa},\\lambda} = \\tau_\\lambda \\left[\\epsilon_\\lambda B_\\lambda(T_s) + (1 - \\epsilon_\\lambda) L_{\\downarrow,\\lambda}\\right] + L_{\\uparrow,\\lambda}$.\n-   **Statistical Model - Cost Function**: The retrieval minimizes the negative log-posterior, which is equivalent to the cost function:\n    $$\n    J(T_s, \\{\\epsilon_\\lambda\\}) = \\sum_{\\lambda} \\frac{\\left(L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}} - L_{\\mathrm{toa},\\lambda}^{\\mathrm{model}}(T_s, \\epsilon_\\lambda)\\right)^2}{\\sigma_{L,\\lambda}^2} + \\sum_{\\lambda} \\frac{\\left(\\epsilon_\\lambda - \\mu_{\\epsilon,\\lambda}\\right)^2}{\\sigma_{\\epsilon,\\lambda}^2}\n    $$\n-   **Constraints**: $0.7 \\le \\epsilon_\\lambda \\le 1.0$ and $250\\,\\mathrm{K} \\le T_s \\le 350\\,\\mathrm{K}$.\n-   **Algorithm**: An iterative scheme alternating between updating $\\{\\epsilon_\\lambda\\}$ (for fixed $T_s$) and updating $T_s$ (for fixed $\\{\\epsilon_\\lambda\\}$).\n-   **Convergence Criteria**: Iteration stops if $\\Delta T_s  10^{-6}\\,\\mathrm{K}$ and $\\max(|\\Delta\\epsilon_\\lambda|)  10^{-8}$, or after a maximum of $50$ iterations.\n-   **Physical Constants**: $h = 6.62607015 \\times 10^{-34}\\,\\mathrm{J\\,s}$, $c = 299792458\\,\\mathrm{m\\,s^{-1}}$, $k = 1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$.\n-   **Test Data**: Three distinct test cases are provided, each with a complete set of parameters: effective wavelengths, atmospheric parameters ($\\tau_\\lambda, L_{\\downarrow,\\lambda}, L_{\\uparrow,\\lambda}$), observed TOA radiances ($L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}}$), measurement noise ($\\sigma_{L,\\lambda}$), and emissivity priors ($\\mu_{\\epsilon,\\lambda}, \\sigma_{\\epsilon,\\lambda}$).\n-   **Output Format**: A single-line string representing a list of lists: `[[T_s1, eps1_1, eps1_2, eps1_3], [T_s2, ...], ...]` with $T_s$ rounded to three decimal places and $\\epsilon_\\lambda$ to four.\n\n**Step 2: Validate Using Extracted Givens**\n\n-   **Scientifically Grounded**: The problem is fundamentally sound. It is based on established principles of radiative transfer (Planck's law, plane-parallel atmosphere RTE) and Bayesian statistics (maximum a posteriori estimation). This approach is standard in geophysical parameter retrieval.\n-   **Well-Posed**: The problem is well-posed. The simultaneous retrieval of temperature and emissivity is a known ill-posed problem, as a change in one can be compensated by a change in the other. The problem statement correctly addresses this by incorporating a prior on emissivity, which regularizes the inversion and makes a stable solution attainable.\n-   **Objective**: The problem is stated with complete objectivity, using precise mathematical formulations and providing all necessary numerical data. It is free from ambiguity and subjective claims.\n-   **Completeness and Consistency**: The problem is self-contained. All equations, constants, data, and constraints required for a solution are provided. There are no contradictions in the setup.\n-   **Realism**: The provided data values (atmospheric transmittances, radiances, etc.) are physically realistic for terrestrial remote sensing conditions.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a well-defined, scientifically sound, and solvable task in computational physics and remote sensing. I will proceed to design and implement the solution.\n\n### 2. Algorithmic Design and Derivation\n\nThe core of the problem is to minimize the cost function $J(T_s, \\{\\epsilon_\\lambda\\})$ using an alternating iterative scheme. We must derive the update rules for each step.\n\n**Initial State**: The iteration starts with an initial guess. We will use a reasonable temperature $T_s^{(0)} = 300\\,\\mathrm{K}$ and set the initial emissivities $\\{\\epsilon_\\lambda^{(0)}\\}$ to their prior means $\\{\\mu_{\\epsilon,\\lambda}\\}$.\n\n**Iterative Step k+1**: Given the current estimates $T_s^{(k)}$ and $\\{\\epsilon_\\lambda^{(k)}\\}$.\n\n**Part A: Update Emissivities $\\{\\epsilon_\\lambda\\}$**\n\nFor a fixed temperature $T_s = T_s^{(k)}$, the cost function $J$ is a sum of independent quadratic terms in each $\\epsilon_\\lambda$. We can minimize for each $\\epsilon_\\lambda$ separately. The part of the cost function dependent on a single $\\epsilon_\\lambda$ is:\n$$\nJ_\\lambda(\\epsilon_\\lambda) = \\frac{\\left(L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}} - (\\tau_\\lambda \\left[\\epsilon_\\lambda B_\\lambda(T_s) + (1 - \\epsilon_\\lambda) L_{\\downarrow,\\lambda}\\right] + L_{\\uparrow,\\lambda})\\right)^2}{\\sigma_{L,\\lambda}^2} + \\frac{\\left(\\epsilon_\\lambda - \\mu_{\\epsilon,\\lambda}\\right)^2}{\\sigma_{\\epsilon,\\lambda}^2}\n$$\nTo find the minimum, we set the derivative $\\frac{\\partial J_\\lambda}{\\partial \\epsilon_\\lambda}$ to zero. The TOA radiance model is linear in $\\epsilon_\\lambda$:\n$$L_{\\mathrm{toa},\\lambda}^{\\mathrm{model}} = \\epsilon_\\lambda \\tau_\\lambda (B_\\lambda(T_s) - L_{\\downarrow,\\lambda}) + (\\tau_\\lambda L_{\\downarrow,\\lambda} + L_{\\uparrow,\\lambda})$$\nSetting the derivative to zero yields a linear equation in $\\epsilon_\\lambda$, which can be solved analytically. Let us define:\n-   Weight from measurement: $w_{L,\\lambda} = 1 / \\sigma_{L,\\lambda}^2$\n-   Weight from prior: $w_{\\epsilon,\\lambda} = 1 / \\sigma_{\\epsilon,\\lambda}^2$\n-   Radiance term: $D_\\lambda = \\tau_\\lambda (B_\\lambda(T_s) - L_{\\downarrow,\\lambda})$\n-   Residual radiance: $R_\\lambda = L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}} - \\tau_\\lambda L_{\\downarrow,\\lambda} - L_{\\uparrow,\\lambda}$\n\nThe derivative $\\frac{\\partial J_\\lambda}{\\partial \\epsilon_\\lambda} = 0$ simplifies to:\n$$\n\\epsilon_\\lambda (D_\\lambda^2 w_{L,\\lambda} + w_{\\epsilon,\\lambda}) = R_\\lambda D_\\lambda w_{L,\\lambda} + \\mu_{\\epsilon,\\lambda} w_{\\epsilon,\\lambda}\n$$\nSolving for $\\epsilon_\\lambda$ gives the update rule:\n$$\n\\epsilon_\\lambda^{\\mathrm{new}} = \\frac{R_\\lambda D_\\lambda w_{L,\\lambda} + \\mu_{\\epsilon,\\lambda} w_{\\epsilon,\\lambda}}{D_\\lambda^2 w_{L,\\lambda} + w_{\\epsilon,\\lambda}}\n$$\nThis result is then clipped to the physical bounds $[0.7, 1.0]$. This update is performed for all wavelengths $\\lambda$ to get the new set $\\{\\epsilon_\\lambda^{(k+1)}\\}$.\n\n**Part B: Update Temperature $T_s$**\n\nFor a fixed set of emissivities $\\{\\epsilon_\\lambda\\} = \\{\\epsilon_\\lambda^{(k+1)}\\}$, we need to find the temperature $T_s$ that minimizes the data misfit term of the cost function (the prior term is constant with respect to $T_s$):\n$$\nJ(T_s) = \\sum_{\\lambda} \\frac{\\left(L_{\\mathrm{toa},\\lambda}^{\\mathrm{obs}} - L_{\\mathrm{toa},\\lambda}^{\\mathrm{model}}(T_s, \\epsilon_\\lambda^{(k+1)})\\right)^2}{\\sigma_{L,\\lambda}^2}\n$$\nThe dependence on $T_s$ is highly non-linear due to Planck's function $B_\\lambda(T_s)$. A numerical minimization is required. We will use a bounded scalar optimization routine (`scipy.optimize.minimize_scalar` with `method='bounded'`) to find the $T_s$ that minimizes $J(T_s)$ within the specified range $[250\\,\\mathrm{K}, 350\\,\\mathrm{K}]$. This yields the updated temperature $T_s^{(k+1)}$.\n\n**Convergence**: The process repeats, alternating between Part A and Part B, until the change in $T_s$ and the maximum change in any $\\epsilon_\\lambda$ fall below the specified tolerance thresholds, or the maximum number of iterations is reached.\n\n### 3. Implementation Strategy\n\nThe logic will be implemented in Python using the `numpy` and `scipy` libraries.\n1.  **Constants**: Define the physical constants $h, c, k$ and the derived Planck constants $c_1 = 2hc^2$ and $c_2 = hc/k$.\n2.  **Planck Function**: A function `planck_function(T, lam)` will calculate the blackbody radiance. It will take temperature $T$ in Kelvin and an array of wavelengths `lam` in meters and return an array of radiances in $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,\\mu m^{-1}}$.\n3.  **Retrieval Function**: A function `retrieve_lst_case` will encapsulate the entire iterative algorithm for a single test case.\n    - It will accept all parameters for one case.\n    - Wavelengths in micrometers are converted to meters for physical calculations.\n    - $T_s$ and $\\{\\epsilon_\\lambda\\}$ are initialized.\n    - The main loop implements the alternating updates and convergence checks. The update for $\\{\\epsilon_\\lambda\\}$ will be a vectorized `numpy` calculation. The update for $T_s$ will involve defining a cost function and passing it to `scipy.optimize.minimize_scalar`.\n4.  **Main Execution Block**: A `solve` function will define the data for the three test cases, iterate through them calling the retrieval function, collect the results, format them according to the output specifications (rounding included), and print the final formatted string.\n\nThis structured approach ensures correctness, modularity, and adherence to all problem requirements.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Main function to run the LST retrieval for all test cases and print the final result.\n    \"\"\"\n    # Physical Constants\n    H = 6.62607015e-34  # Planck's constant (J*s)\n    C = 299792458.0      # Speed of light (m/s)\n    K = 1.380649e-23     # Boltzmann's constant (J/K)\n    C1 = 2.0 * H * C**2\n    C2 = H * C / K\n\n    def planck_function(T, lam):\n        \"\"\"\n        Calculates Planck's law radiance for given temperature(s) and wavelength(s).\n        \n        Args:\n            T (float or np.ndarray): Temperature in Kelvin.\n            lam (float or np.ndarray): Wavelength in meters.\n            \n        Returns:\n            np.ndarray: Spectral radiance in W m^-2 sr^-1 um^-1.\n        \"\"\"\n        radiance_per_m = C1 / (lam**5 * (np.exp(C2 / (lam * T)) - 1.0))\n        return radiance_per_m * 1e-6  # Convert to per-micrometer units\n\n    def retrieve_lst_case(params):\n        \"\"\"\n        Performs the iterative retrieval of LST and emissivity for a single case.\n        \"\"\"\n        # Unpack parameters\n        lams_um, tau, l_down, l_up, l_toa_obs, sigma_l, mu_eps, sigma_eps = params\n\n        # Convert inputs to numpy arrays\n        lams = np.array(lams_um) * 1e-6  # Wavelengths in meters\n        tau = np.array(tau)\n        l_down = np.array(l_down)\n        l_up = np.array(l_up)\n        l_toa_obs = np.array(l_toa_obs)\n        sigma_l = np.array(sigma_l)\n        mu_eps = np.array(mu_eps)\n        sigma_eps = np.array(sigma_eps)\n\n        # Pre-calculate weights\n        w_l = 1.0 / sigma_l**2\n        w_eps = 1.0 / sigma_eps**2\n\n        # Initial guesses\n        T_s = 300.0\n        eps = np.copy(mu_eps)\n        \n        # Iteration parameters\n        max_iter = 50\n        tol_T = 1e-6\n        tol_eps = 1e-8\n\n        for i in range(max_iter):\n            T_s_old = T_s\n            eps_old = np.copy(eps)\n\n            # --- Step A: Update Emissivities {eps_lambda} ---\n            # Calculate terms for the analytical epsilon update\n            B_lam_Ts = planck_function(T_s, lams)\n            D_lam = tau * (B_lam_Ts - l_down)\n            R_lam = l_toa_obs - tau * l_down - l_up\n            \n            numerator = R_lam * D_lam * w_l + mu_eps * w_eps\n            denominator = D_lam**2 * w_l + w_eps\n            \n            # Avoid division by zero if denominator is too small\n            # Not strictly necessary with given data but good practice\n            eps = np.divide(numerator, denominator, out=np.full_like(denominator, 0.95), where=denominator!=0)\n\n            # Apply physical bounds on emissivity\n            eps = np.clip(eps, 0.7, 1.0)\n            \n            # --- Step B: Update Temperature T_s ---\n            # Define cost function for T_s minimization\n            def cost_func_T(T, current_eps):\n                l_toa_model = tau * (current_eps * planck_function(T, lams) + (1.0 - current_eps) * l_down) + l_up\n                residuals = l_toa_obs - l_toa_model\n                return np.sum((residuals**2) * w_l)\n\n            # Minimize the cost function w.r.t. T_s\n            res = minimize_scalar(\n                cost_func_T, \n                args=(eps,),\n                bounds=(250.0, 350.0), \n                method='bounded'\n            )\n            T_s = res.x\n            \n            # --- Step C: Check for convergence ---\n            delta_T = abs(T_s - T_s_old)\n            max_delta_eps = np.max(np.abs(eps - eps_old))\n\n            if delta_T  tol_T and max_delta_eps  tol_eps:\n                break\n        \n        return [T_s, *eps]\n\n    # Test suite data\n    test_cases = [\n        # Case 1\n        ([10.8, 12.0, 8.7],  # wavelengths (um)\n         [0.90, 0.88, 0.92],  # transmittance\n         [3.0, 3.2, 2.7],    # downwelling radiance\n         [1.0, 1.1, 0.9],    # upwelling radiance\n         [8.965, 8.064, 10.309], # observed TOA radiance\n         [0.15, 0.15, 0.15], # measurement noise std\n         [0.95, 0.96, 0.94], # emissivity prior means\n         [0.02, 0.02, 0.02]),# emissivity prior stds\n        # Case 2\n        ([10.8, 12.0, 8.7],\n         [0.65, 0.60, 0.70],\n         [4.0, 4.5, 3.5],\n         [1.5, 1.8, 1.2],\n         [7.645, 6.874, 8.821],\n         [0.20, 0.20, 0.20],\n         [0.90, 0.90, 0.90],\n         [0.05, 0.05, 0.05]),\n        # Case 3\n        ([10.8, 12.0, 8.7],\n         [0.95, 0.94, 0.96],\n         [2.5, 2.4, 2.6],\n         [0.7, 0.8, 0.6],\n         [8.435, 7.544, 9.369],\n         [0.10, 0.10, 0.10],\n         [0.98, 0.98, 0.98],\n         [0.01, 0.01, 0.01])\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = retrieve_lst_case(case)\n        all_results.append(result)\n\n    # Format output string\n    formatted_cases = []\n    for case_result in all_results:\n        T_s_str = f\"{case_result[0]:.3f}\"\n        eps_strs = [f\"{e:.4f}\" for e in case_result[1:]]\n        formatted_cases.append(f\"[{T_s_str},{','.join(eps_strs)}]\")\n    \n    final_output = f\"[{','.join(formatted_cases)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}