{
    "hands_on_practices": [
        {
            "introduction": "在高光谱传感器设计中，一个根本性的挑战是如何平衡信噪比（SNR）与光谱分辨率之间的权衡。本练习将探讨光谱合并（spectral binning），这是一种通过牺牲光谱细节来提高信噪比的常用技术。通过从第一性原理出发进行推导，您将对这一影响传感器设计和数据处理策略的关键权衡获得定量的理解 。",
            "id": "3835489",
            "problem": "一台具有均匀间隔光谱通道的推扫式高光谱成像光谱仪被用于观测一个在小波长间隔内辐射亮度近似恒定的目标。每个光谱通道具有顶帽光谱响应，其半峰全宽等于一个用 $\\Delta \\lambda_{1}$ 表示的带宽，且各通道不重叠。对于单个通道，探测到的期望信号（以光电子为单位）为 $S$，噪声为零均值，标准差为 $\\sigma$，其中不同通道间的噪声贡献不相关。信噪比 (SNR) 定义为 $\\mathrm{SNR} \\equiv \\text{平均信号} \\,/\\, \\text{噪声标准差}$。光谱合并是通过在后处理中对 $n$ 个相邻通道求和来形成一个输出波段来实现的。\n\n仅从 $\\mathrm{SNR}$ 的定义和独立随机变量求和的方差加法法则出发，推导以下表达式：\n- 相对于未合并的单通道 $\\mathrm{SNR}$，当合并 $n$ 个相邻通道时 $\\mathrm{SNR}$ 变化的因子。\n- 有效光谱分辨率下降的因子，量化为合并后的有效带宽 $\\Delta \\lambda_{n}$ 与原始带宽 $\\Delta \\lambda_{1}$ 的比值，此推导基于上述顶帽响应和通道不重叠的假设，并假定目标辐射亮度在 $n$ 个被合并的通道上是恒定的。\n\n然后，计算当 $n=3$ 时这两个因子。将 $\\mathrm{SNR}$ 变化因子和光谱分辨率下降因子作为无量纲量报告。不要近似；请提供精确值。最终的数值对必须以无单位形式报告。如果进行任何中间舍入，仅将最终值舍入到四位有效数字；否则，保留其精确形式。",
            "solution": "该问题提法清晰且有科学依据。我们将基于给定的条件和原理进行推导。\n\n设 $S$ 为单个未合并光谱通道的平均信号（以光电子为单位），$\\sigma$ 为相关零均值噪声的标准差。单通道信噪比（表示为 $\\mathrm{SNR}_{1}$）定义为：\n$$ \\mathrm{SNR}_{1} = \\frac{S}{\\sigma} $$\n\n问题陈述光谱合并是通过对 $n$ 个相邻、不重叠的通道求和来执行的。我们需要推导合并后通道的新信噪比 $\\mathrm{SNR}_{n}$ 以及光谱分辨率的相应变化。\n\n**1. 信噪比变化因子的推导**\n\n设 $S_{i}$ 为第 $i$ 个通道的信号随机变量，其中 $i=1, 2, \\dots, n$。问题陈述目标辐射亮度在 $n$ 个被合并的通道上是恒定的。由于通道是相同的（均匀间隔，相同带宽），这意味着每个通道的期望信号是相同的。设 $\\mathbb{E}[S_{i}] = S$。合并后通道的总信号 $S_{n}$ 是 $n$ 个独立通道信号的总和：\n$$ S_{n} = \\sum_{i=1}^{n} S_{i} $$\n合并后信号的均值是各个均值的总和：\n$$ \\text{mean}(S_{n}) = \\mathbb{E}[S_{n}] = \\mathbb{E}\\left[\\sum_{i=1}^{n} S_{i}\\right] = \\sum_{i=1}^{n} \\mathbb{E}[S_{i}] = \\sum_{i=1}^{n} S = nS $$\n\n设 $N_{i}$ 为第 $i$ 个通道的噪声随机变量。问题陈述噪声为零均值，标准差为 $\\sigma$。因此，$\\mathbb{E}[N_i] = 0$，标准差为 $\\mathrm{StdDev}(N_i) = \\sigma$。单个通道噪声的方差为 $\\mathrm{Var}(N_i) = \\sigma^2$。\n\n合并后通道的总噪声 $N_{n}$ 是 $n$ 个独立通道噪声的总和：\n$$ N_{n} = \\sum_{i=1}^{n} N_{i} $$\n问题指明不同通道间的噪声贡献不相关。根据不相关随机变量的方差加法法则，这些变量之和的方差是它们方差的总和。因此，合并后噪声的方差 $\\mathrm{Var}(N_{n})$ 为：\n$$ \\mathrm{Var}(N_{n}) = \\mathrm{Var}\\left(\\sum_{i=1}^{n} N_{i}\\right) = \\sum_{i=1}^{n} \\mathrm{Var}(N_{i}) $$\n由于每个通道的噪声标准差相同，其方差也相同，为 $\\sigma^2$。\n$$ \\mathrm{Var}(N_{n}) = \\sum_{i=1}^{n} \\sigma^2 = n\\sigma^2 $$\n合并后噪声的标准差 $\\sigma_{n}$ 是其方差的平方根：\n$$ \\sigma_{n} = \\sqrt{\\mathrm{Var}(N_{n})} = \\sqrt{n\\sigma^2} = \\sqrt{n}\\,\\sigma $$\n合并后通道的信噪比 $\\mathrm{SNR}_{n}$ 是合并后信号的均值与合并后噪声的标准差之比：\n$$ \\mathrm{SNR}_{n} = \\frac{\\text{mean}(S_{n})}{\\sigma_{n}} = \\frac{nS}{\\sqrt{n}\\,\\sigma} = \\frac{\\sqrt{n}\\,S}{\\sigma} $$\nSNR 变化的因子是 $\\mathrm{SNR}_{n}$ 与 $\\mathrm{SNR}_{1}$ 的比值：\n$$ \\text{Factor}_{\\mathrm{SNR}} = \\frac{\\mathrm{SNR}_{n}}{\\mathrm{SNR}_{1}} = \\frac{\\frac{\\sqrt{n}\\,S}{\\sigma}}{\\frac{S}{\\sigma}} = \\sqrt{n} $$\n\n**2. 光谱分辨率下降因子的推导**\n\n光谱分辨率与光谱通道的带宽有关。单个通道的初始带宽给定为 $\\Delta\\lambda_{1}$。通道被描述为具有顶帽光谱响应且不重叠。合并是通过对 $n$ 个相邻通道求和来执行的。\n\n考虑一组 $n$ 个相邻、不重叠的通道，每个通道都具有宽度为 $\\Delta\\lambda_{1}$ 的顶帽响应。由于它们相邻且不重叠，它们覆盖的总光谱区间是它们各自宽度的总和。因此，合并后通道的有效带宽 $\\Delta\\lambda_{n}$ 是 $n$ 个组成通道的带宽之和：\n$$ \\Delta\\lambda_{n} = \\sum_{i=1}^{n} \\Delta\\lambda_{1,i} $$\n其中 $\\Delta\\lambda_{1,i}$ 是第 $i$ 个通道的带宽。由于所有通道具有相同的带宽 $\\Delta\\lambda_1$，这可以简化为：\n$$ \\Delta\\lambda_{n} = n \\Delta\\lambda_{1} $$\n光谱分辨率的下降由因子 $\\frac{\\Delta\\lambda_{n}}{\\Delta\\lambda_{1}}$ 量化：\n$$ \\text{Factor}_{\\text{Res}} = \\frac{\\Delta\\lambda_{n}}{\\Delta\\lambda_{1}} = \\frac{n \\Delta\\lambda_{1}}{\\Delta\\lambda_{1}} = n $$\n\n**3. 对 $n=3$ 的情况进行计算**\n\n我们现在必须为合并 $n=3$ 个相邻通道的情况计算这两个推导出的因子。问题要求提供精确值。\n\n信噪比变化因子为 $\\sqrt{n}$。对于 $n=3$，此因子为：\n$$ \\text{Factor}_{\\mathrm{SNR}} = \\sqrt{3} $$\n光谱分辨率下降因子为 $n$。对于 $n=3$，此因子为：\n$$ \\text{Factor}_{\\text{Res}} = 3 $$\n这两个因子是无量纲量。所要求的数值对（按顺序：信噪比变化因子，光谱分辨率下降因子）是 $(\\sqrt{3}, 3)$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\sqrt{3}  3 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "传感器并非在无限小的波长点上测量光谱，而是在由其仪器线形函数（Instrument Line Spread Function, ILS）定义的特定光谱范围内积分能量。本练习将演示ILS的形状如何与目标的光谱特征相互作用，从而产生最终的测量信号。您将分析简化ILS模型所引入的偏差，从而揭示精确传感器表征对于定量分析的重要性 。",
            "id": "3835466",
            "problem": "高光谱推扫式传感器通过由仪器线扩展函数 (ILS) 描述的有限光谱响应来采样上行地表反射光谱。假设系统响应是线性的且在整个光谱响应范围内能量守恒，在波段中心波长 $\\lambda_{0}$ 处的测量反射率被建模为高分辨率光谱库光谱 $R(\\lambda)$ 与 ILS 的卷积。设 $R(\\lambda)$ 在 $\\lambda_{0}$ 附近是局部平滑的，并考虑其二阶泰勒展开 $R(\\lambda) = R_{0} + a(\\lambda - \\lambda_{0}) + b(\\lambda - \\lambda_{0})^{2}$，其中 $R_{0}$、$a$ 和 $b$ 是常数。假设真实的 ILS 是高斯函数，由下式给出\n$$\nI_{G}(\\Delta\\lambda) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{\\Delta\\lambda^{2}}{2\\sigma^{2}}\\right),\n$$\n其半峰全宽为 $\\mathrm{FWHM}_{G} = 2\\sqrt{2\\ln 2}\\,\\sigma$。考虑一种近似处理方法，该方法用具有相同半峰全宽的矩形 ILS 替换高斯 ILS，\n$$\nI_{R}(\\Delta\\lambda) = \\begin{cases}\n\\frac{1}{W},  |\\Delta\\lambda| \\leq \\frac{W}{2}, \\\\\n0,  \\text{其它},\n\\end{cases}\n$$\n其中 $W = \\mathrm{FWHM}_{G}$。\n\n从高光谱传感的测量模型（即 $R(\\lambda)$ 与归一化 ILS 的卷积）出发，使用给定的 $R(\\lambda)$ 的局部二次表示，推导高斯 ILS 和矩形 ILS 在 $\\lambda_{0}$ 处的测量反射率。然后，对两种 ILS 模型使用相同的 $\\mathrm{FWHM}$，推导由矩形近似引入的偏差 $\\Delta R = R_{\\mathrm{meas},R}(\\lambda_{0}) - R_{\\mathrm{meas},G}(\\lambda_{0})$ 的解析表达式。最后，对以下参数进行偏差的数值计算：\n- $\\lambda_{0} = 650\\,\\mathrm{nm}$，\n- $R_{0} = 0.35$ (无量纲反射率)，\n- $a = -1.2 \\times 10^{-3}\\,\\mathrm{nm}^{-1}$，\n- $b = 8.0 \\times 10^{-6}\\,\\mathrm{nm}^{-2}$，\n- $\\mathrm{FWHM}_{G} = 6.0\\,\\mathrm{nm}$。\n\n假设两个 ILS 函数都完全归一化（面积为1）并以 $\\lambda_{0}$ 为中心。将最终偏差 $\\Delta R$ 表示为一个无量纲数，并将您的答案四舍五入到四位有效数字。提供最终答案时不要带百分号或任何单位。",
            "solution": "该问题要求推导并计算当用具有相同半峰全宽（FWHM）的矩形仪器线扩展函数（ILS）近似高斯 ILS 时所引入的偏差。\n\n首先，我们形式化测量模型。在特定波段中心波长 $\\lambda_{0}$ 处的测量反射率，记为 $R_{\\mathrm{meas}}(\\lambda_{0})$，是真实地表反射光谱 $R(\\lambda)$ 与仪器 ILS $I(\\Delta\\lambda)$ 的卷积，其中 $\\Delta\\lambda = \\lambda - \\lambda_{0}$。在 $\\lambda_{0}$ 处的卷积由下式给出：\n$$\nR_{\\mathrm{meas}}(\\lambda_{0}) = \\int_{-\\infty}^{\\infty} R(\\lambda') I(\\lambda_{0} - \\lambda') \\,d\\lambda'\n$$\n我们进行变量替换，令 $\\Delta\\lambda = \\lambda' - \\lambda_{0}$，因此 $\\lambda' = \\lambda_{0} + \\Delta\\lambda$ 且 $d\\lambda' = d(\\Delta\\lambda)$。ILS 的自变量变为 $\\lambda_{0} - (\\lambda_{0} + \\Delta\\lambda) = -\\Delta\\lambda$。由于所提供的高斯和矩形 ILS 模型都是偶函数，所以 $I(-\\Delta\\lambda) = I(\\Delta\\lambda)$。积分变为：\n$$\nR_{\\mathrm{meas}}(\\lambda_{0}) = \\int_{-\\infty}^{\\infty} R(\\lambda_{0} + \\Delta\\lambda) I(\\Delta\\lambda) \\,d(\\Delta\\lambda)\n$$\n问题给出了真实光谱 $R(\\lambda)$ 在 $\\lambda_{0}$ 附近的局部二次近似：\n$$\nR(\\lambda_0 + \\Delta\\lambda) = R_{0} + a(\\Delta\\lambda) + b(\\Delta\\lambda)^{2}\n$$\n将此代入测量方程可得：\n$$\nR_{\\mathrm{meas}}(\\lambda_{0}) = \\int_{-\\infty}^{\\infty} [R_{0} + a(\\Delta\\lambda) + b(\\Delta\\lambda)^{2}] I(\\Delta\\lambda) \\,d(\\Delta\\lambda)\n$$\n根据积分的线性性质，我们可以分离各项：\n$$\nR_{\\mathrm{meas}}(\\lambda_{0}) = R_{0} \\int_{-\\infty}^{\\infty} I(\\Delta\\lambda) \\,d(\\Delta\\lambda) + a \\int_{-\\infty}^{\\infty} \\Delta\\lambda \\, I(\\Delta\\lambda) \\,d(\\Delta\\lambda) + b \\int_{-\\infty}^{\\infty} (\\Delta\\lambda)^{2} I(\\Delta\\lambda) \\,d(\\Delta\\lambda)\n$$\n这些积分代表 ILS 分布的矩。\n第一个积分 $\\int_{-\\infty}^{\\infty} I(\\Delta\\lambda) \\,d(\\Delta\\lambda)$ 是零阶矩（总面积）。问题说明 ILS 是归一化的，所以这个积分等于 $1$。\n第二个积分 $\\int_{-\\infty}^{\\infty} \\Delta\\lambda \\, I(\\Delta\\lambda) \\,d(\\Delta\\lambda)$ 是一阶原点矩（均值）。问题说明 ILS 以 $\\lambda_{0}$ 为中心，意味着其关于 $\\Delta\\lambda$ 的分布的均值为 $0$。\n第三个积分 $\\int_{-\\infty}^{\\infty} (\\Delta\\lambda)^{2} I(\\Delta\\lambda) \\,d(\\Delta\\lambda)$ 是二阶原点矩。由于均值为 $0$，这也是二阶中心矩，即方差，我们将其记为 $M_{2}$。\n\n因此，测量反射率的通用表达式简化为：\n$$\nR_{\\mathrm{meas}}(\\lambda_{0}) = R_{0} \\cdot 1 + a \\cdot 0 + b \\cdot M_{2} = R_{0} + b M_{2}\n$$\n该表达式表明，对于对称的 ILS，测量反射率是在波段中心的真实反射率 $R_{0}$，加上一个与光谱曲率 $b$ 和 ILS 的方差 $M_{2}$ 成正比的项。\n\n现在，我们计算每种 ILS 模型的方差。\n\n对于高斯 ILS，$I_{G}(\\Delta\\lambda) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp(-\\frac{\\Delta\\lambda^{2}}{2\\sigma^{2}})$。这是一个均值为 $0$、方差为 $\\sigma^{2}$ 的正态分布。所以，$M_{2,G} = \\sigma^{2}$。给出的 FWHM 为 $\\mathrm{FWHM}_{G} = 2\\sqrt{2\\ln 2}\\,\\sigma$。我们求解 $\\sigma^{2}$：\n$$\n\\sigma = \\frac{\\mathrm{FWHM}_{G}}{2\\sqrt{2\\ln 2}} \\implies M_{2,G} = \\sigma^{2} = \\frac{\\mathrm{FWHM}_{G}^{2}}{(2\\sqrt{2\\ln 2})^{2}} = \\frac{\\mathrm{FWHM}_{G}^{2}}{8\\ln 2}\n$$\n因此，使用高斯 ILS 测得的反射率为：\n$$\nR_{\\mathrm{meas},G}(\\lambda_{0}) = R_{0} + b \\frac{\\mathrm{FWHM}_{G}^{2}}{8\\ln 2}\n$$\n对于矩形 ILS，$I_{R}(\\Delta\\lambda)$ 是在区间 $[-\\frac{W}{2}, \\frac{W}{2}]$ 上的一个均匀分布，其中宽度 $W$ 被设定为等于 $\\mathrm{FWHM}_{G}$。在 $[c, d]$ 上的均匀分布的方差 $M_{2,R}$ 是 $\\frac{(d-c)^2}{12}$。这里，$c = -\\frac{W}{2}$ 且 $d = \\frac{W}{2}$，所以方差是：\n$$\nM_{2,R} = \\frac{(\\frac{W}{2} - (-\\frac{W}{2}))^{2}}{12} = \\frac{W^{2}}{12}\n$$\n或者，通过直接积分：\n$$\nM_{2,R} = \\int_{-W/2}^{W/2} (\\Delta\\lambda)^{2} \\left(\\frac{1}{W}\\right) d(\\Delta\\lambda) = \\frac{1}{W} \\left[\\frac{(\\Delta\\lambda)^{3}}{3}\\right]_{-W/2}^{W/2} = \\frac{1}{3W} \\left[\\left(\\frac{W}{2}\\right)^{3} - \\left(-\\frac{W}{2}\\right)^{3}\\right] = \\frac{1}{3W} \\left(\\frac{W^3}{8} + \\frac{W^3}{8}\\right) = \\frac{W^{2}}{12}\n$$\n由于 $W = \\mathrm{FWHM}_{G}$，我们有 $M_{2,R} = \\frac{\\mathrm{FWHM}_{G}^{2}}{12}$。\n使用矩形 ILS 测得的反射率为：\n$$\nR_{\\mathrm{meas},R}(\\lambda_{0}) = R_{0} + b \\frac{\\mathrm{FWHM}_{G}^{2}}{12}\n$$\n偏差 $\\Delta R$ 是使用矩形近似测得的反射率与使用真实高斯 ILS 测得的反射率之差：\n$$\n\\Delta R = R_{\\mathrm{meas},R}(\\lambda_{0}) - R_{\\mathrm{meas},G}(\\lambda_{0}) = \\left(R_{0} + b \\frac{\\mathrm{FWHM}_{G}^{2}}{12}\\right) - \\left(R_{0} + b \\frac{\\mathrm{FWHM}_{G}^{2}}{8\\ln 2}\\right)\n$$\n化简后，我们得到偏差的解析表达式：\n$$\n\\Delta R = b \\, \\mathrm{FWHM}_{G}^{2} \\left(\\frac{1}{12} - \\frac{1}{8\\ln 2}\\right)\n$$\n现在，我们代入给定的数值：\n$b = 8.0 \\times 10^{-6}\\,\\mathrm{nm}^{-2}$\n$\\mathrm{FWHM}_{G} = 6.0\\,\\mathrm{nm}$\n\n首先，计算 $\\mathrm{FWHM}_{G}^{2}$：\n$$\n\\mathrm{FWHM}_{G}^{2} = (6.0\\,\\mathrm{nm})^{2} = 36.0\\,\\mathrm{nm}^{2}\n$$\n接下来，计算括号中的常数因子：\n$$\n\\frac{1}{12} - \\frac{1}{8\\ln 2} \\approx \\frac{1}{12} - \\frac{1}{8 \\times 0.693147} \\approx 0.083333 - \\frac{1}{5.545177} \\approx 0.083333 - 0.180337 = -0.097004\n$$\n最后，计算 $\\Delta R$：\n$$\n\\Delta R = (8.0 \\times 10^{-6}\\,\\mathrm{nm}^{-2}) \\times (36.0\\,\\mathrm{nm}^{2}) \\times \\left(\\frac{1}{12} - \\frac{1}{8\\ln 2}\\right)\n$$\n$$\n\\Delta R = (2.88 \\times 10^{-4}) \\times (-0.097004) \\approx -0.000027937152\n$$\n$$\n\\Delta R \\approx -2.7937152 \\times 10^{-5}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\n\\Delta R \\approx -2.794 \\times 10^{-5}\n$$\n结果是一个无量纲量，正如预期。负号表示对于正的光谱曲率（$b0$，即向上凹的光谱），与真实的高斯 ILS 相比，矩形 ILS 近似会导致测量的反射率值更低。",
            "answer": "$$\n\\boxed{-2.794 \\times 10^{-5}}\n$$"
        },
        {
            "introduction": "高光谱成像的一个主要目标是通过光谱解混等方法，提取定量的亚像元信息，例如不同物质的丰度。这些衍生产品的可靠性直接取决于传感器的噪声特性。本高级练习将指导您如何将测量噪声传播到丰度估算的最终不确定性中，为评估分析结果的可信度提供一个严谨的框架 。",
            "id": "3835479",
            "problem": "考虑一个高光谱成像（HSI）线性混合模型，其中一个具有 $M = 4$ 个光谱带的测量反射光谱 $\\mathbf{y} \\in \\mathbb{R}^{M}$ 表示为 $\\mathbf{y} = \\mathbf{E}\\mathbf{a} + \\mathbf{n}$。这里，$\\mathbf{E} \\in \\mathbb{R}^{4 \\times 3}$ 是一个具有 $p = 3$ 个端元的已知端元矩阵，$\\mathbf{a} \\in \\mathbb{R}^{3}$ 是丰度向量，$\\mathbf{n} \\in \\mathbb{R}^{4}$ 是零均值测量噪声，其协方差矩阵为 $\\mathbf{C} \\in \\mathbb{R}^{4 \\times 4}$。丰度向量满足和为一约束 $\\mathbf{1}^{\\top}\\mathbf{a} = 1$，其中 $\\mathbf{1} \\in \\mathbb{R}^{3}$ 表示全一向量。假设丰度的非负性约束在解的邻域内不活跃（即，解位于内部，因此不等式约束不影响局部灵敏度）。\n\n丰度估计值 $\\widehat{\\mathbf{a}}$ 是通过等式约束加权最小二乘法得到的，其中使用噪声协方差的逆作为权重，即通过最小化二次型 $(\\mathbf{y} - \\mathbf{E}\\mathbf{a})^{\\top}\\mathbf{C}^{-1}(\\mathbf{y} - \\mathbf{E}\\mathbf{a})$，并满足约束 $\\mathbf{1}^{\\top}\\mathbf{a} = 1$。\n\n从第一性原理出发，使用等式约束问题的 Karush–Kuhn–Tucker (KKT) 最优性条件来：\n- 推导约束最小二乘解相对于测量值 $\\mathbf{y}$ 的雅可比矩阵 $\\mathbf{J} = \\frac{\\partial \\widehat{\\mathbf{a}}}{\\partial \\mathbf{y}}$，\n- 然后通过线性误差传播法则将测量噪声协方差 $\\mathbf{C}$ 传播到丰度估计器的协方差。\n\n使用以下具体的、科学上一致的规范：\n- 端元矩阵为\n$$\n\\mathbf{E} = \\begin{pmatrix}\n\\frac{1}{2}  \\frac{1}{\\sqrt{2}}  0 \\\\\n\\frac{1}{2}  -\\frac{1}{\\sqrt{2}}  0 \\\\\n\\frac{1}{2}  0  \\frac{1}{\\sqrt{2}} \\\\\n\\frac{1}{2}  0  -\\frac{1}{\\sqrt{2}}\n\\end{pmatrix}.\n$$\n- 噪声协方差是各向同性的：$\\mathbf{C} = \\sigma^{2}\\mathbf{I}_{4}$，其中 $\\sigma^{2} = 10^{-3}$。\n\n计算此传播所隐含的第一个丰度分量 $\\widehat{a}_{1}$ 的方差，并将您的最终结果表示为一个纯数（无单位）。将您的答案四舍五入到四位有效数字。",
            "solution": "问题要求解第一个丰度分量 $\\widehat{a}_{1}$ 的方差，该方差是通过约束加权最小二乘估计推导出来的。该过程首先需要推导丰度估计器协方差矩阵的一般表达式，然后代入所提供的具体数值。\n\n该问题经检验在科学上是合理的、适定的和客观的。这是应用于高光谱成像的线性估计理论中的一个标准问题。所有必要的信息都已提供，且没有矛盾之处。\n\n优化问题是最小化目标函数 $f(\\mathbf{a}) = (\\mathbf{y} - \\mathbf{E}\\mathbf{a})^{\\top}\\mathbf{C}^{-1}(\\mathbf{y} - \\mathbf{E}\\mathbf{a})$，并满足等式约束 $\\mathbf{1}^{\\top}\\mathbf{a} = 1$。非负性约束被假设为不活跃，这意味着它们在解处不产生约束作用，因此可以在此局部分析中被忽略。\n\n为了解决这个约束优化问题，我们使用拉格朗日乘子法。拉格朗日函数 $\\mathcal{L}(\\mathbf{a}, \\lambda)$ 为：\n$$\n\\mathcal{L}(\\mathbf{a}, \\lambda) = (\\mathbf{y} - \\mathbf{E}\\mathbf{a})^{\\top}\\mathbf{C}^{-1}(\\mathbf{y} - \\mathbf{E}\\mathbf{a}) + \\lambda(\\mathbf{1}^{\\top}\\mathbf{a} - 1)\n$$\n其中 $\\lambda$ 是与和为一约束相关的拉格朗日乘子。\n\nKarush–Kuhn–Tucker (KKT) 最优性条件要求拉格朗日函数对 $\\mathbf{a}$ 和 $\\lambda$ 的梯度为零。首先，我们计算关于 $\\mathbf{a}$ 的梯度：\n$$\n\\nabla_{\\mathbf{a}} \\mathcal{L} = \\nabla_{\\mathbf{a}} (\\mathbf{y}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - 2\\mathbf{y}^{\\top}\\mathbf{C}^{-1}\\mathbf{E}\\mathbf{a} + \\mathbf{a}^{\\top}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E}\\mathbf{a} + \\lambda\\mathbf{1}^{\\top}\\mathbf{a} - \\lambda)\n$$\n使用向量微积分的标准法则（例如，对于对称矩阵 $\\mathbf{A}$，$\\nabla_{\\mathbf{x}} (\\mathbf{b}^{\\top}\\mathbf{x}) = \\mathbf{b}$ 和 $\\nabla_{\\mathbf{x}} (\\mathbf{x}^{\\top}\\mathbf{A}\\mathbf{x}) = 2\\mathbf{A}\\mathbf{x}$），并注意到 $\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E}$ 是对称的，我们得到：\n$$\n\\nabla_{\\mathbf{a}} \\mathcal{L} = -2\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} + 2(\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E})\\mathbf{a} + \\lambda\\mathbf{1}\n$$\n对于最优丰度向量 $\\widehat{\\mathbf{a}}$，将梯度设为零，我们得到第一个 KKT 条件：\n$$\n-2\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} + 2(\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E})\\widehat{\\mathbf{a}} + \\lambda\\mathbf{1} = \\mathbf{0}\n$$\n第二个 KKT 条件就是原始的约束：\n$$\n\\mathbf{1}^{\\top}\\widehat{\\mathbf{a}} = 1\n$$\n我们定义矩阵 $\\mathbf{M} = \\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E}$。第一个条件可以重写为：\n$$\n2\\mathbf{M}\\widehat{\\mathbf{a}} = 2\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - \\lambda\\mathbf{1}\n$$\n假设 $\\mathbf{M}$ 是可逆的，我们可以解出 $\\widehat{\\mathbf{a}}$：\n$$\n\\widehat{\\mathbf{a}} = \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - \\frac{\\lambda}{2}\\mathbf{M}^{-1}\\mathbf{1}\n$$\n现在，将此表达式代入约束条件 $\\mathbf{1}^{\\top}\\widehat{\\mathbf{a}} = 1$：\n$$\n\\mathbf{1}^{\\top}(\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - \\frac{\\lambda}{2}\\mathbf{M}^{-1}\\mathbf{1}) = 1\n$$\n求解 $\\frac{\\lambda}{2}$：\n$$\n\\frac{\\lambda}{2}(\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}) = \\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - 1\n$$\n$$\n\\frac{\\lambda}{2} = \\frac{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - 1}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}}\n$$\n将其代回 $\\widehat{\\mathbf{a}}$ 的表达式中：\n$$\n\\widehat{\\mathbf{a}} = \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - \\mathbf{M}^{-1}\\mathbf{1} \\left( \\frac{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{y} - 1}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right)\n$$\n我们可以重新整理这个式子，以将依赖于 $\\mathbf{y}$ 的项与常数项分开：\n$$\n\\widehat{\\mathbf{a}} = \\left( \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right)\\mathbf{y} + \\frac{\\mathbf{M}^{-1}\\mathbf{1}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}}\n$$\n估计器 $\\widehat{\\mathbf{a}}$ 相对于测量值 $\\mathbf{y}$ 的雅可比矩阵是乘以 $\\mathbf{y}$ 的那个矩阵：\n$$\n\\mathbf{J} = \\frac{\\partial \\widehat{\\mathbf{a}}}{\\partial \\mathbf{y}} = \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}}\n$$\n$$\n\\mathbf{J} = \\left( \\mathbf{I} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right) \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\n$$\n这完成了所需推导的第一部分。\n\n接下来，我们通过此线性关系传播测量噪声协方差 $\\mathbf{C}$。估计器 $\\widehat{\\mathbf{a}}$ 是 $\\mathbf{y}$ 的一个仿射变换，$\\widehat{\\mathbf{a}} = \\mathbf{J}\\mathbf{y} + \\mathbf{k}$，其中 $\\mathbf{k}$ 是一个常数向量。$\\widehat{\\mathbf{a}}$ 的协方差，记为 $\\mathbf{C}_{\\widehat{\\mathbf{a}}}$，由线性误差传播法则给出：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\mathbf{J}\\text{Cov}(\\mathbf{y})\\mathbf{J}^{\\top} = \\mathbf{J}\\mathbf{C}\\mathbf{J}^{\\top}\n$$\n代入 $\\mathbf{J}$ 的表达式：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\left[ \\left( \\mathbf{I} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right) \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1} \\right] \\mathbf{C} \\left[ \\left( \\mathbf{I} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right) \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1} \\right]^{\\top}\n$$\n利用转置的性质以及 $\\mathbf{C}^{-1}$ 和 $\\mathbf{M}^{-1}$ 的对称性：\n$$\n\\mathbf{J}^{\\top} = \\mathbf{C}^{-1}\\mathbf{E}\\mathbf{M}^{-1} \\left( \\mathbf{I} - \\frac{\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}} \\right)\n$$\n我们定义一个类投影算子 $\\mathbf{P}_{\\text{constr}} = \\mathbf{I} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}}$。\n那么 $\\mathbf{J} = \\mathbf{P}_{\\text{constr}} \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}$。\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = (\\mathbf{P}_{\\text{constr}} \\mathbf{M}^{-1}\\mathbf{E}^{\\top}\\mathbf{C}^{-1}) \\mathbf{C} (\\mathbf{C}^{-1}\\mathbf{E}\\mathbf{M}^{-1} \\mathbf{P}_{\\text{constr}}^{\\top}) = \\mathbf{P}_{\\text{constr}} \\mathbf{M}^{-1}(\\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E})\\mathbf{M}^{-1} \\mathbf{P}_{\\text{constr}}^{\\top}\n$$\n因为 $\\mathbf{M} = \\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E}$，这可以简化为：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\mathbf{P}_{\\text{constr}} \\mathbf{M}^{-1}\\mathbf{M}\\mathbf{M}^{-1} \\mathbf{P}_{\\text{constr}}^{\\top} = \\mathbf{P}_{\\text{constr}} \\mathbf{M}^{-1} \\mathbf{P}_{\\text{constr}}^{\\top}\n$$\n展开这个表达式：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\left(\\mathbf{I} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}}{c}\\right) \\mathbf{M}^{-1} \\left(\\mathbf{I} - \\frac{\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c}\\right), \\quad \\text{其中 } c = \\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}\n$$\n$$\n= \\left(\\mathbf{M}^{-1} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c}\\right) \\left(\\mathbf{I} - \\frac{\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c}\\right)\n$$\n$$\n= \\mathbf{M}^{-1} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbfM^{-1}}{c} + \\frac{(\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1})(\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1})}{c^2}\n$$\n最后一项的分子包含 $\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1} = c$：\n$$\n\\frac{\\mathbf{M}^{-1}\\mathbf{1}(\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1})\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c^2} = \\frac{\\mathbf{M}^{-1}\\mathbf{1}c\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c^2} = \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{c}\n$$\n因此，协方差矩阵的表达式简化为：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\mathbf{M}^{-1} - \\frac{\\mathbf{M}^{-1}\\mathbf{1}\\mathbf{1}^{\\top}\\mathbf{M}^{-1}}{\\mathbf{1}^{\\top}\\mathbf{M}^{-1}\\mathbf{1}}\n$$\n现在我们代入给定的数值。噪声协方差为 $\\mathbf{C} = \\sigma^2 \\mathbf{I}_{4}$，其中 $\\sigma^2 = 10^{-3}$，所以其逆矩阵为 $\\mathbf{C}^{-1} = \\frac{1}{\\sigma^2}\\mathbf{I}_{4}$。\n矩阵 $\\mathbf{M}$ 是：\n$$\n\\mathbf{M} = \\mathbf{E}^{\\top}\\mathbf{C}^{-1}\\mathbf{E} = \\mathbf{E}^{\\top}(\\frac{1}{\\sigma^2}\\mathbf{I}_{4})\\mathbf{E} = \\frac{1}{\\sigma^2}\\mathbf{E}^{\\top}\\mathbf{E}\n$$\n我们来计算 $\\mathbf{E}^{\\top}\\mathbf{E}$。$\\mathbf{E}$ 的列向量是 $\\mathbf{e}_1 = (\\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2}, \\frac{1}{2})^{\\top}$、$\\mathbf{e}_2 = (\\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}}, 0, 0)^{\\top}$ 和 $\\mathbf{e}_3 = (0, 0, \\frac{1}{\\sqrt{2}}, -\\frac{1}{\\sqrt{2}})^{\\top}$。\n$$\n\\mathbf{e}_1^{\\top}\\mathbf{e}_1 = 4(\\frac{1}{2})^2 = 1, \\quad \\mathbf{e}_2^{\\top}\\mathbf{e}_2 = (\\frac{1}{\\sqrt{2}})^2 + (-\\frac{1}{\\sqrt{2}})^2 = 1, \\quad \\mathbf{e}_3^{\\top}\\mathbf{e}_3 = (\\frac{1}{\\sqrt{2}})^2 + (-\\frac{1}{\\sqrt{2}})^2 = 1\n$$\n$$\n\\mathbf{e}_1^{\\top}\\mathbf{e}_2 = \\frac{1}{2\\sqrt{2}} - \\frac{1}{2\\sqrt{2}} = 0, \\quad \\mathbf{e}_1^{\\top}\\mathbf{e}_3 = \\frac{1}{2\\sqrt{2}} - \\frac{1}{2\\sqrt{2}} = 0, \\quad \\mathbf{e}_2^{\\top}\\mathbf{e}_3 = 0\n$$\n由于 $\\mathbf{E}$ 的列向量是标准正交的，所以 $\\mathbf{E}^{\\top}\\mathbf{E} = \\mathbf{I}_{3}$。\n这极大地简化了 $\\mathbf{M}$：\n$$\n\\mathbf{M} = \\frac{1}{\\sigma^2}\\mathbf{I}_{3} \\quad \\implies \\quad \\mathbf{M}^{-1} = \\sigma^2\\mathbf{I}_{3}\n$$\n我们将此代入 $\\mathbf{C}_{\\widehat{\\mathbf{a}}}$ 的公式中：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\sigma^2\\mathbf{I}_{3} - \\frac{(\\sigma^2\\mathbf{I}_{3})\\mathbf{1}\\mathbf{1}^{\\top}(\\sigma^2\\mathbf{I}_{3})}{\\mathbf{1}^{\\top}(\\sigma^2\\mathbf{I}_{3})\\mathbf{1}} = \\sigma^2\\mathbf{I}_{3} - \\frac{\\sigma^4 \\mathbf{1}\\mathbf{1}^{\\top}}{\\sigma^2 \\mathbf{1}^{\\top}\\mathbf{1}}\n$$\n因为 $\\mathbf{1} \\in \\mathbb{R}^3$，所以 $\\mathbf{1}^{\\top}\\mathbf{1} = 1^2 + 1^2 + 1^2 = 3$。\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\sigma^2\\mathbf{I}_{3} - \\frac{\\sigma^2}{3}\\mathbf{1}\\mathbf{1}^{\\top}\n$$\n以矩阵形式表示：\n$$\n\\mathbf{C}_{\\widehat{\\mathbf{a}}} = \\sigma^2 \\left( \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} - \\frac{1}{3} \\begin{pmatrix} 1  1  1 \\\\ 1  1  1 \\\\ 1  1  1 \\end{pmatrix} \\right) = \\sigma^2 \\begin{pmatrix} 2/3  -1/3  -1/3 \\\\ -1/3  2/3  -1/3 \\\\ -1/3  -1/3  2/3 \\end{pmatrix}\n$$\n第一个丰度分量的方差 $\\text{Var}(\\widehat{a}_1)$ 是 $\\mathbf{C}_{\\widehat{\\mathbf{a}}}$ 的第一个对角线元素：\n$$\n\\text{Var}(\\widehat{a}_1) = (\\mathbf{C}_{\\widehat{\\mathbf{a}}})_{11} = \\frac{2}{3}\\sigma^2\n$$\n给定 $\\sigma^2 = 10^{-3}$，其数值为：\n$$\n\\text{Var}(\\widehat{a}_1) = \\frac{2}{3} \\times 10^{-3} = 0.0006666...\n$$\n四舍五入到四位有效数字得到 $0.0006667$。",
            "answer": "$$\\boxed{0.0006667}$$"
        }
    ]
}