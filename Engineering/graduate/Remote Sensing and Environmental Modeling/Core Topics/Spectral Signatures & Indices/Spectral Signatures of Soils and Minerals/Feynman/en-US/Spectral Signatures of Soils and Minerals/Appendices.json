{
    "hands_on_practices": [
        {
            "introduction": "A mineral's spectral signature is shaped by both its chemical composition and its physical structure. This exercise explores one of the most critical physical factors: grain size. By applying a simplified model based on the Beer–Lambert law, you will derive and quantify how reflectance changes as mineral grains get larger. This practice builds fundamental intuition about the relationship between photon path length, absorption, and the resulting spectral features we observe in remote sensing data .",
            "id": "3854166",
            "problem": "A hyperspectral sensor observing a dry, granular mineral soil in the near-infrared records a decrease in reflectance as the mean grain diameter increases, consistent with increased photon path lengths and stronger absorption in larger grains. Consider a particulate bed whose grains can be idealized as homogeneous, plane-parallel slabs of thickness equal to the mean grain diameter $d$, with negligible internal scattering. Assume that photons contributing to the observed reflectance undergo a single specular reflection at the far interface of a grain and traverse the slab twice (in and out) before emerging. Let the absorption of the material at the wavelength of interest be characterized by the absorption coefficient $\\alpha$ (units of $\\mathrm{cm}^{-1}$), and assume that any Fresnel reflection factors and geometric collection constants are independent of $d$.\n\nStarting from the Beer–Lambert law and the definition of reflectance as the ratio of emergent to incident radiant power, derive an expression for the reflectance $R(d)$ as a function of $d$ and $\\alpha$ under the stated assumptions. Then, compute the reflectance change expressed as the ratio $R(200\\,\\mu\\mathrm{m})/R(100\\,\\mu\\mathrm{m})$ for a mineral with $\\alpha = 100\\,\\mathrm{cm}^{-1}$ when the mean grain diameter doubles from $100\\,\\mu\\mathrm{m}$ to $200\\,\\mu\\mathrm{m}$. Carefully account for unit conversions when substituting numerical values. Express your final result as a dimensionless number and round your answer to four significant figures.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- The system is a dry, granular mineral soil idealized as a particulate bed of homogeneous, plane-parallel slabs.\n- The thickness of each slab is equal to the mean grain diameter, $d$.\n- Internal scattering within the grains is negligible.\n- Observed photons undergo a single specular reflection at the far interface of a grain.\n- The total path length of a photon inside a grain is twice the slab thickness.\n- The absorption coefficient of the material is $\\alpha$, with units of $\\mathrm{cm}^{-1}$.\n- Fresnel reflection factors and geometric collection constants are independent of $d$.\n- The task is to derive the reflectance $R(d)$ as a function of $d$ and $\\alpha$.\n- A second task is to compute the ratio $R(d_2)/R(d_1)$ for $d_1 = 100\\,\\mu\\mathrm{m}$ and $d_2 = 200\\,\\mu\\mathrm{m}$.\n- The value of the absorption coefficient is given as $\\alpha = 100\\,\\mathrm{cm}^{-1}$.\n- The final numerical result must be rounded to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is based on the Beer-Lambert law, a fundamental principle of absorption spectroscopy. The model, although simplified (plane-parallel slabs, no scattering), is a common and valid idealization for introducing the concept of photon path length in particulate media, a cornerstone of more advanced models like Hapke theory in planetary remote sensing. The premise that reflectance decreases with increasing grain size for absorbing materials is factually correct.\n- **Well-Posed:** The problem provides a clear set of assumptions and sufficient information to derive the required expression and compute the numerical ratio. A unique, stable, and meaningful solution exists.\n- **Objective:** The problem is stated in precise, quantitative, and unbiased language.\n- **Completeness and Consistency:** The problem is self-contained. The assumptions, such as the path length being $2d$ and other factors being independent of $d$, are explicitly stated and create a consistent framework for a solution.\n- **Realism:** The given values for grain size ($100\\,\\mu\\mathrm{m}$ to $200\\,\\mu\\mathrm{m}$, corresponding to fine sand) and absorption coefficient ($\\alpha = 100\\,\\mathrm{cm}^{-1}$) are physically realistic for minerals in the near-infrared portion of the spectrum.\n- **Conclusion:** The problem is scientifically sound, well-posed, and contains no apparent flaws or inconsistencies.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A solution will be provided.\n\n### Solution Derivation and Calculation\nThe problem requires the derivation of an expression for reflectance, $R(d)$, based on the Beer-Lambert law and a simplified model of light interaction with a mineral grain.\n\nThe Beer-Lambert law describes the attenuation of radiant power as it traverses an absorbing medium. The radiant power $P(x)$ after traveling a distance $x$ through a medium with absorption coefficient $\\alpha$ is given by:\n$$P(x) = P_0 \\exp(-\\alpha x)$$\nwhere $P_0$ is the initial radiant power entering the medium.\n\nAccording to the problem statement, the photons contributing to the measured reflectance traverse the grain of thickness $d$ twice (once on the way in to the far interface, and once on the way out after reflection). Therefore, the total path length of the light within the absorbing medium is $x = 2d$.\n\nLet $P_{inc}$ be the incident radiant power on the sensor's field of view, and let $P_{emerge}(d)$ be the emergent radiant power that is collected by the sensor. Reflectance is defined as the ratio of these two quantities:\n$$R(d) = \\frac{P_{emerge}(d)}{P_{inc}}$$\n\nThe process for a photon contributing to $P_{emerge}(d)$ involves several stages:\n1. Incident light must enter the grain.\n2. It propagates a distance $d$ to the far interface, undergoing absorption.\n3. It reflects specularly at the far interface.\n4. It propagates a distance $d$ back to the front interface, undergoing further absorption.\n5. It exits the grain and is collected by the sensor.\n\nThe radiant power is attenuated by the factor $\\exp(-\\alpha \\cdot 2d)$ due to absorption over the total path length $2d$. All other factors—such as the fraction of light that initially enters the grain, the reflectivity of the far interface, the fraction that exits the grain, and any geometric factors related to collection efficiency—are explicitly stated to be independent of the grain diameter $d$. We can group these factors into a single constant, $C_0$.\nThus, the emergent power can be written as:\n$$P_{emerge}(d) = C_0 \\cdot P_{inc} \\cdot \\exp(-2\\alpha d)$$\nwhere $C_0$ is a dimensionless proportionality constant that encapsulates all $d$-independent optical and geometric effects.\n\nSubstituting this into the definition of reflectance, we get:\n$$R(d) = \\frac{C_0 \\cdot P_{inc} \\cdot \\exp(-2\\alpha d)}{P_{inc}} = C_0 \\exp(-2\\alpha d)$$\nThis is the desired expression for reflectance as a function of $d$ and $\\alpha$.\n\nNext, we must compute the ratio $\\frac{R(200\\,\\mu\\mathrm{m})}{R(100\\,\\mu\\mathrm{m})}$. Let $d_1 = 100\\,\\mu\\mathrm{m}$ and $d_2 = 200\\,\\mu\\mathrm{m}$.\nUsing our derived expression for $R(d)$:\n$$R(d_1) = C_0 \\exp(-2\\alpha d_1)$$\n$$R(d_2) = C_0 \\exp(-2\\alpha d_2)$$\nThe ratio is:\n$$\\frac{R(d_2)}{R(d_1)} = \\frac{C_0 \\exp(-2\\alpha d_2)}{C_0 \\exp(-2\\alpha d_1)} = \\exp(-2\\alpha d_2 - (-2\\alpha d_1)) = \\exp(-2\\alpha(d_2-d_1))$$\nThe constant $C_0$ cancels, as expected.\n\nNow we substitute the numerical values:\n$\\alpha = 100\\,\\mathrm{cm}^{-1}$\n$d_1 = 100\\,\\mu\\mathrm{m}$\n$d_2 = 200\\,\\mu\\mathrm{m}$\n\nThe product $\\alpha d$ must be dimensionless, so we must use consistent units. We convert the grain diameters from micrometers ($\\mu\\mathrm{m}$) to centimeters ($\\mathrm{cm}$) to match the units of $\\alpha$.\nWe know that $1\\,\\mathrm{cm} = 10^4\\,\\mu\\mathrm{m}$, or $1\\,\\mu\\mathrm{m} = 10^{-4}\\,\\mathrm{cm}$.\n$$d_1 = 100\\,\\mu\\mathrm{m} = 100 \\times 10^{-4}\\,\\mathrm{cm} = 1 \\times 10^{-2}\\,\\mathrm{cm}$$\n$$d_2 = 200\\,\\mu\\mathrm{m} = 200 \\times 10^{-4}\\,\\mathrm{cm} = 2 \\times 10^{-2}\\,\\mathrm{cm}$$\nThe difference in path length is:\n$$d_2 - d_1 = (2 \\times 10^{-2} - 1 \\times 10^{-2})\\,\\mathrm{cm} = 1 \\times 10^{-2}\\,\\mathrm{cm}$$\nNow, we calculate the exponent:\n$$-2\\alpha(d_2-d_1) = -2 \\cdot (100\\,\\mathrm{cm}^{-1}) \\cdot (1 \\times 10^{-2}\\,\\mathrm{cm}) = -2 \\cdot 100 \\cdot 10^{-2} = -2$$\nThe exponent is dimensionless, as required.\n\nThe reflectance ratio is therefore:\n$$\\frac{R(200\\,\\mu\\mathrm{m})}{R(100\\,\\mu\\mathrm{m})} = \\exp(-2)$$\nCalculating the numerical value and rounding to four significant figures:\n$$\\exp(-2) \\approx 0.13533528...$$\nRounded to four significant figures, the result is $0.1353$.",
            "answer": "$$\\boxed{0.1353}$$"
        },
        {
            "introduction": "Moving from physical principles to practical analysis, a key task in remote sensing is to extract specific information from a reflectance spectrum. This hands-on exercise challenges you to design a spectral index for detecting the Mg–OH absorption feature, a hallmark of certain minerals. By implementing the robust continuum-removal technique, you will learn to quantify an absorption feature's depth while mitigating confounding effects from illumination and background spectral slope, a core skill in hyperspectral analysis .",
            "id": "3854175",
            "problem": "You are tasked with designing a detection index for the Magnesium hydroxyl (Mg–OH) absorption feature centered near $2.31\\,\\mu\\mathrm{m}$ in the Short-Wave Infrared (SWIR) region of the electromagnetic spectrum. The goal is to quantify the depth of the Mg–OH absorption feature while minimizing interference from the strong water absorption band near $1.90\\,\\mu\\mathrm{m}$ by using only adjacent spectral bands that are not affected by water. Your program must implement an index derived from first principles of reflectance spectroscopy that is robust to multiplicative illumination or moisture scaling and local spectral slope, and that uses only bands adjacent to the target feature.\n\nFundamental base:\n- The Beer–Lambert law states that transmitted irradiance through an absorbing medium at wavelength $\\lambda$ is $I(\\lambda) = I_0(\\lambda)\\exp(-k(\\lambda) L)$, where $k(\\lambda)$ is the absorption coefficient and $L$ is the optical path length. Surface reflectance $R(\\lambda)$ is the ratio $R(\\lambda) = I_\\mathrm{out}(\\lambda)/I_\\mathrm{in}(\\lambda)$ and exhibits diagnostic absorption features where $k(\\lambda)$ is large.\n- In mineral reflectance spectroscopy, an absorption feature can be modeled as a local multiplicative dip in reflectance. A widely used practice to quantify feature depth while mitigating continuum slope is local continuum removal via a linear continuum between shoulder bands.\n\nDesign constraints:\n- Use only wavelengths in the vicinity of the Mg–OH feature, specifically adjacent bands $\\lambda_L$ and $\\lambda_R$ that flank the center $\\lambda_C$ near $2.31\\,\\mu\\mathrm{m}$.\n- Explicitly avoid bands impacted by the $1.90\\,\\mu\\mathrm{m}$ water absorption by working in the interval $[2.29\\,\\mu\\mathrm{m}, 2.34\\,\\mu\\mathrm{m}]$.\n- The detection index must be dimensionless, derived from the ratio of measured reflectance at $\\lambda_C$ to a locally estimated continuum at $\\lambda_C$ computed from $\\lambda_L$ and $\\lambda_R$.\n\nMathematical model for synthetic test spectra:\nFor each test case, the reflectance function is defined on $\\lambda \\in \\{\\lambda_L, \\lambda_C, \\lambda_R\\}$ by\n$$\nR(\\lambda) = g \\cdot \\left(b + s\\cdot(\\lambda - \\lambda_0)\\right) \\cdot \\left(1 - a_{\\mathrm{Mg}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{Mg}})^2}{2\\sigma_{\\mathrm{Mg}}^2}\\right)\\right) \\cdot \\left(1 - a_{\\mathrm{side}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{side}})^2}{2\\sigma_{\\mathrm{side}}^2}\\right)\\right) \\cdot \\left(1 - a_{\\mathrm{H_2O}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{H_2O}})^2}{2\\sigma_{\\mathrm{H_2O}}^2}\\right)\\right),\n$$\nwhere:\n- $g$ is a global multiplicative factor (e.g., due to illumination or moisture film),\n- $b$ is a baseline reflectance at $\\lambda_0$,\n- $s$ is a local spectral slope in units of reflectance per micrometer,\n- $(a_{\\mathrm{Mg}}, \\lambda_{\\mathrm{Mg}}, \\sigma_{\\mathrm{Mg}})$ parameterize the Mg–OH absorption as a Gaussian dip,\n- $(a_{\\mathrm{side}}, \\lambda_{\\mathrm{side}}, \\sigma_{\\mathrm{side}})$ parameterize a possible adjacent interfering absorption feature,\n- $(a_{\\mathrm{H_2O}}, \\lambda_{\\mathrm{H_2O}}, \\sigma_{\\mathrm{H_2O}})$ parameterize the broad water absorption centered at $\\lambda_{\\mathrm{H_2O}}$,\n- $\\lambda_0$ is a reference wavelength used to define $b$ and $s$.\n\nIndex definition requirements:\n- Compute the local linear continuum at $\\lambda_C$ as\n$$\nC(\\lambda_C) = R(\\lambda_L) + \\left(R(\\lambda_R) - R(\\lambda_L)\\right)\\cdot \\frac{\\lambda_C - \\lambda_L}{\\lambda_R - \\lambda_L}.\n$$\n- Define the Mg–OH detection index, the continuum-removed band depth, as\n$$\n\\mathrm{BD}_{\\mathrm{Mg}} = 1 - \\frac{R(\\lambda_C)}{C(\\lambda_C)}.\n$$\nThis index is dimensionless and must be reported as a decimal number.\n\nPhysical and numerical units:\n- Wavelengths must be treated in micrometers (i.e., $\\mu\\mathrm{m}$).\n- Reflectance is dimensionless.\n- The final reported index values must be dimensionless decimal numbers rounded to $6$ decimal places.\n\nBand selection:\n- Use $\\lambda_L = 2.295\\,\\mu\\mathrm{m}$, $\\lambda_C = 2.315\\,\\mu\\mathrm{m}$, $\\lambda_R = 2.335\\,\\mu\\mathrm{m}$.\n- Use $\\lambda_0 = 2.315\\,\\mu\\mathrm{m}$ and $\\lambda_{\\mathrm{Mg}} = 2.315\\,\\mu\\mathrm{m}$.\n- Use $\\lambda_{\\mathrm{H_2O}} = 1.900\\,\\mu\\mathrm{m}$.\n\nTest suite:\nYour program must evaluate $\\mathrm{BD}_{\\mathrm{Mg}}$ for the following four test cases, each specified by parameters $(g, b, s, a_{\\mathrm{Mg}}, \\sigma_{\\mathrm{Mg}}, a_{\\mathrm{side}}, \\lambda_{\\mathrm{side}}, \\sigma_{\\mathrm{side}}, a_{\\mathrm{H_2O}}, \\sigma_{\\mathrm{H_2O}})$:\n\n- Test case $1$ (strong Mg–OH absorption, moderate slope, dry baseline):\n  - $g = 1.0$, $b = 0.5$, $s = 0.12$, $a_{\\mathrm{Mg}} = 0.35$, $\\sigma_{\\mathrm{Mg}} = 0.008$, $a_{\\mathrm{side}} = 0.0$, $\\lambda_{\\mathrm{side}} = 2.340$, $\\sigma_{\\mathrm{side}} = 0.006$, $a_{\\mathrm{H_2O}} = 0.2$, $\\sigma_{\\mathrm{H_2O}} = 0.05$.\n- Test case $2$ (no Mg–OH absorption, flat spectrum):\n  - $g = 1.0$, $b = 0.4$, $s = 0.0$, $a_{\\mathrm{Mg}} = 0.0$, $\\sigma_{\\mathrm{Mg}} = 0.008$, $a_{\\mathrm{side}} = 0.0$, $\\lambda_{\\mathrm{side}} = 2.340$, $\\sigma_{\\mathrm{side}} = 0.006$, $a_{\\mathrm{H_2O}} = 0.2$, $\\sigma_{\\mathrm{H_2O}} = 0.05$.\n- Test case $3$ (wet soil with global attenuation and shallow Mg–OH absorption):\n  - $g = 0.7$, $b = 0.6$, $s = 0.05$, $a_{\\mathrm{Mg}} = 0.10$, $\\sigma_{\\mathrm{Mg}} = 0.010$, $a_{\\mathrm{side}} = 0.0$, $\\lambda_{\\mathrm{side}} = 2.340$, $\\sigma_{\\mathrm{side}} = 0.006$, $a_{\\mathrm{H_2O}} = 0.3$, $\\sigma_{\\mathrm{H_2O}} = 0.06$.\n- Test case $4$ (Mg–OH absorption with adjacent interfering feature near $2.34\\,\\mu\\mathrm{m}$):\n  - $g = 1.0$, $b = 0.5$, $s = 0.10$, $a_{\\mathrm{Mg}} = 0.25$, $\\sigma_{\\mathrm{Mg}} = 0.010$, $a_{\\mathrm{side}} = 0.15$, $\\lambda_{\\mathrm{side}} = 2.340$, $\\sigma_{\\mathrm{side}} = 0.006$, $a_{\\mathrm{H_2O}} = 0.25$, $\\sigma_{\\mathrm{H_2O}} = 0.05$.\n\nAlgorithmic task:\n- For each test case, compute $R(\\lambda_L)$, $R(\\lambda_C)$, and $R(\\lambda_R)$ using the model above.\n- Compute $C(\\lambda_C)$ and then $\\mathrm{BD}_{\\mathrm{Mg}}$.\n- Report the four $\\mathrm{BD}_{\\mathrm{Mg}}$ values as a single line containing a comma-separated list enclosed in square brackets, with each value rounded to $6$ decimal places, e.g., $\\left[\\mathrm{bd}_1,\\mathrm{bd}_2,\\mathrm{bd}_3,\\mathrm{bd}_4\\right]$.\n\nFinal output format:\nYour program should produce exactly one line of output containing the results as a comma-separated list enclosed in square brackets, with each value rounded to $6$ decimal places (e.g., $[0.123456,0.000000,0.045678,0.234567]$).",
            "solution": "The problem is valid as it is scientifically grounded in the principles of reflectance spectroscopy, is mathematically well-posed, and provides a complete and consistent set of definitions, models, and data for a solvable computational task. The objective is to calculate a spectroscopic index, the continuum-removed band depth for a Magnesium-hydroxyl (Mg–OH) absorption feature, for four synthetic test cases.\n\nThe solution proceeds by first implementing the provided mathematical model for spectral reflectance and then using this model to compute the band depth index for each given parameter set.\n\nThe spectral reflectance $R(\\lambda)$ at a given wavelength $\\lambda$ is modeled as a product of four components: a global multiplicative factor $g$, a local linear continuum, and three Gaussian-shaped absorption features. The equation is:\n$$\nR(\\lambda) = g \\cdot \\left(b + s\\cdot(\\lambda - \\lambda_0)\\right) \\cdot \\left(1 - a_{\\mathrm{Mg}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{Mg}})^2}{2\\sigma_{\\mathrm{Mg}}^2}\\right)\\right) \\cdot \\left(1 - a_{\\mathrm{side}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{side}})^2}{2\\sigma_{\\mathrm{side}}^2}\\right)\\right) \\cdot \\left(1 - a_{\\mathrm{H_2O}} \\exp\\left(-\\frac{(\\lambda - \\lambda_{\\mathrm{H_2O}})^2}{2\\sigma_{\\mathrm{H_2O}}^2}\\right)\\right)\n$$\nThe parameters are provided for each test case. The fixed wavelengths are specified as $\\lambda_0 = 2.315\\,\\mu\\mathrm{m}$, $\\lambda_{\\mathrm{Mg}} = 2.315\\,\\mu\\mathrm{m}$, and $\\lambda_{\\mathrm{H_2O}} = 1.900\\,\\mu\\mathrm{m}$.\n\nThe algorithm involves a sequence of calculations for three specific wavelengths, which define the shoulders and center of the absorption feature:\n- Left shoulder: $\\lambda_L = 2.295\\,\\mu\\mathrm{m}$\n- Feature center: $\\lambda_C = 2.315\\,\\mu\\mathrm{m}$\n- Right shoulder: $\\lambda_R = 2.335\\,\\mu\\mathrm{m}$\n\nThe process for each test case is as follows:\n\nStep 1: Calculate Reflectance at Key Wavelengths\nUsing the reflectance model $R(\\lambda)$ and the given parameters for a specific test case, we compute the reflectance values at the three key wavelengths: $R(\\lambda_L)$, $R(\\lambda_C)$, and $R(\\lambda_R)$.\n\nStep 2: Estimate the Continuum\nA linear continuum is constructed between the two shoulder bands, $\\lambda_L$ and $\\lambda_R$. The value of this continuum at the feature's center wavelength, $\\lambda_C$, is estimated by linear interpolation:\n$$\nC(\\lambda_C) = R(\\lambda_L) + \\left(R(\\lambda_R) - R(\\lambda_L)\\right)\\cdot \\frac{\\lambda_C - \\lambda_L}{\\lambda_R - \\lambda_L}\n$$\nGiven the specified wavelengths, the fractional distance is $(\\lambda_C - \\lambda_L) / (\\lambda_R - \\lambda_L) = (2.315 - 2.295) / (2.335 - 2.295) = 0.020 / 0.040 = 0.5$. Thus, the continuum at $\\lambda_C$ simplifies to the arithmetic mean of the shoulder reflectances:\n$$\nC(\\lambda_C) = \\frac{R(\\lambda_L) + R(\\lambda_R)}{2}\n$$\n\nStep 3: Compute the Band Depth Index\nThe Mg–OH detection index, $\\mathrm{BD}_{\\mathrm{Mg}}$, is defined as the normalized depth of the reflectance at $\\lambda_C$ relative to the estimated continuum value $C(\\lambda_C)$. This is a standard formulation for continuum-removed band depth:\n$$\n\\mathrm{BD}_{\\mathrm{Mg}} = 1 - \\frac{R(\\lambda_C)}{C(\\lambda_C)}\n$$\nThis index is dimensionless. The global multiplicative factor $g$ in the reflectance model cancels out in the ratio $R(\\lambda_C) / C(\\lambda_C)$, making the index robust to variations in illumination.\n\nThis three-step procedure is applied to each of the four test cases. The resulting four $\\mathrm{BD}_{\\mathrm{Mg}}$ values are then collected and formatted as a comma-separated list, with each value rounded to $6$ decimal places.\n\nFor example, performing the calculation for Test Case 1:\n- Parameters: $(g, b, s, a_{\\mathrm{Mg}}, \\sigma_{\\mathrm{Mg}}, \\dots) = (1.0, 0.5, 0.12, 0.35, 0.008, \\dots)$\n- Compute reflectances: $R(\\lambda_L) \\approx 0.490041$, $R(\\lambda_C) \\approx 0.325000$, $R(\\lambda_R) \\approx 0.494727$. The water absorption term has a negligible effect as the wavelengths are far from its center.\n- Compute continuum: $C(\\lambda_C) = (0.490041 + 0.494727) / 2 \\approx 0.492384$.\n- Compute band depth: $\\mathrm{BD}_{\\mathrm{Mg}} = 1 - (0.325000 / 0.492384) \\approx 1 - 0.660054 \\approx 0.339946$.\n\nThe same calculation is systematically repeated for the remaining three test cases to generate the final list of results.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the Mg-OH band depth index for four test cases.\n    \"\"\"\n\n    # --- Fixed physical and numerical constants from the problem statement ---\n    lambda_L = 2.295  # Left shoulder wavelength in micrometers\n    lambda_C = 2.315  # Feature center wavelength in micrometers\n    lambda_R = 2.335  # Right shoulder wavelength in micrometers\n    lambda_0 = 2.315  # Reference wavelength for slope calculation\n    lambda_Mg = 2.315  # Center of Mg-OH absorption\n    lambda_H2O = 1.900  # Center of water absorption\n\n    # --- Test suite from the problem statement ---\n    # Parameters: (g, b, s, a_Mg, sigma_Mg, a_side, lambda_side, sigma_side, a_H2O, sigma_H2O)\n    test_cases = [\n        # Test case 1: strong Mg-OH absorption, moderate slope, dry baseline\n        (1.0, 0.5, 0.12, 0.35, 0.008, 0.0, 2.340, 0.006, 0.2, 0.05),\n        # Test case 2: no Mg-OH absorption, flat spectrum\n        (1.0, 0.4, 0.0, 0.0, 0.008, 0.0, 2.340, 0.006, 0.2, 0.05),\n        # Test case 3: wet soil with global attenuation and shallow Mg-OH absorption\n        (0.7, 0.6, 0.05, 0.10, 0.010, 0.0, 2.340, 0.006, 0.3, 0.06),\n        # Test case 4: Mg-OH absorption with adjacent interfering feature\n        (1.0, 0.5, 0.10, 0.25, 0.010, 0.15, 2.340, 0.006, 0.25, 0.05),\n    ]\n\n    def calculate_reflectance(lambda_val, params):\n        \"\"\"\n        Calculates the synthetic reflectance for a given wavelength and parameter set.\n        \n        Args:\n            lambda_val (float): The wavelength in micrometers.\n            params (tuple): A tuple containing the 10 model parameters.\n            \n        Returns:\n            float: The calculated reflectance value.\n        \"\"\"\n        g, b, s, a_Mg, sigma_Mg, a_side, lambda_side, sigma_side, a_H2O, sigma_H2O = params\n\n        # 1. Linear continuum base\n        continuum_base = g * (b + s * (lambda_val - lambda_0))\n\n        # 2. Mg-OH absorption feature\n        mg_term = 1.0 - a_Mg * np.exp(-((lambda_val - lambda_Mg)**2) / (2.0 * sigma_Mg**2))\n\n        # 3. Adjacent interfering absorption feature\n        side_term = 1.0 - a_side * np.exp(-((lambda_val - lambda_side)**2) / (2.0 * sigma_side**2))\n        \n        # 4. Water absorption feature\n        h2o_term = 1.0 - a_H2O * np.exp(-((lambda_val - lambda_H2O)**2) / (2.0 * sigma_H2O**2))\n        \n        return continuum_base * mg_term * side_term * h2o_term\n\n    results = []\n    for case_params in test_cases:\n        # Step 1: Calculate reflectance at key wavelengths\n        R_L = calculate_reflectance(lambda_L, case_params)\n        R_C = calculate_reflectance(lambda_C, case_params)\n        R_R = calculate_reflectance(lambda_R, case_params)\n\n        # Step 2: Estimate the continuum at the feature center\n        # Since lambda_C is exactly halfway between lambda_L and lambda_R,\n        # the interpolated continuum is the average of the shoulder reflectances.\n        C_at_lambda_C = R_L + (R_R - R_L) * (lambda_C - lambda_L) / (lambda_R - lambda_L)\n        \n        # Step 3: Compute the Band Depth index\n        if C_at_lambda_C == 0:\n             # Avoid division by zero, although not expected with given parameters\n            bd_mg = 0.0\n        else:\n            bd_mg = 1.0 - (R_C / C_at_lambda_C)\n\n        results.append(bd_mg)\n\n    # Format the results as a comma-separated list, rounded to 6 decimal places.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world soils and rocks are rarely composed of a single mineral but are instead intimate mixtures. This advanced practice moves beyond simple systems to the complex challenge of modeling mixed materials. You will implement two distinct but powerful radiative transfer theories—the Hapke and Shkuratov models—to predict the reflectance of a two-component mineral mixture. This exercise provides deep insight into how different physical models account for complex phenomena like multiple scattering and inter-grain light interactions, a crucial step toward quantitative remote sensing of planetary surfaces .",
            "id": "3854203",
            "problem": "You are to implement two physically grounded predictive models for the reflectance of an intimate mixture of two minerals, hematite and quartz, at a wavelength of $0.8\\,\\mu\\mathrm{m}$, and to compare their outputs. The first model is the Hapke radiative transfer framework specialized to isotropic scattering in a semi-infinite medium without surface roughness or opposition surge. The second model is the Shkuratov two-stream framework for semi-infinite particulate media, implemented in the classical two-flux form, and augmented by an explicit intergrain coupling parameter that modulates the effective scattering. You must compute both predictions for specified mixtures and interpret the differences in how intergrain coupling is treated.\n\nYour derivation and implementation must be based on the following foundational physical laws and well-tested definitions:\n- Beer–Lambert law for absorption in a homogeneous medium: if a material has an imaginary refractive index $\\kappa$ at wavelength $\\lambda$, then the absorption coefficient is $\\alpha = \\dfrac{4\\pi\\kappa}{\\lambda}$, expressed per unit length in the same unit system as $\\lambda$.\n- Geometric cross-section reasoning for scattering in packed spherical grains: for spherical particles of diameter $D$ packed at a packing fraction $p$ (solid volume fraction), the number density is $N = \\dfrac{6p}{\\pi D^{3}}$. The macroscopic scattering coefficient per unit length for one component can be approximated as $s = N Q_{s} \\pi \\left(\\dfrac{D}{2}\\right)^{2}$, where $Q_{s}$ is a dimensionless scattering efficiency factor representative of Mie scattering for size parameters comparable to or larger than the wavelength, typically of order $\\mathcal{O}(1)$.\n- Single scattering albedo as a ratio of scattering to extinction: if the mixture has effective scattering coefficient $S$ and absorption coefficient $K$, then the single scattering albedo is $w = \\dfrac{S}{S + K}$.\n- Semi-infinite, isotropically scattering half-space reflectance for Hapke-style multiple scattering: the mapping from single scattering albedo to the emergent reflectance of a semi-infinite isotropic medium is monotonic and depends only on $w$ under the stated assumptions.\n- Two-stream (Kubelka–Munk) reflectance mapping for a semi-infinite layer: the reflectance depends on the ratio $K/S$ for the medium.\n\nThe minerals and optical parameters at $0.8\\,\\mu\\mathrm{m}$ are to be treated as follows (all values are to be used as given; they are representative and physically plausible):\n- Hematite: real refractive index $n_{\\mathrm{h}} = 3.0$, imaginary refractive index $\\kappa_{\\mathrm{h}} = 0.02$, dimensionless scattering efficiency $Q_{s,\\mathrm{h}} = 0.7$.\n- Quartz: real refractive index $n_{\\mathrm{q}} = 1.55$, imaginary refractive index $\\kappa_{\\mathrm{q}} = 1.0\\times10^{-7}$, dimensionless scattering efficiency $Q_{s,\\mathrm{q}} = 1.0$.\n\nGlobal medium parameters and units:\n- Wavelength $\\lambda = 0.8\\,\\mu\\mathrm{m}$ (use $\\mu\\mathrm{m}$ consistently for all length quantities).\n- Packing fraction $p = 0.6$ (dimensionless).\n- Grain diameters $D$ must be provided in $\\mu\\mathrm{m}$ and used consistently.\n- All reflectances are dimensionless and should be output as raw decimal numbers (no percentage sign).\n\nMixture construction and model mapping:\n- Consider an intimate mixture with hematite volume fraction $f_{\\mathrm{h}}$ and quartz volume fraction $f_{\\mathrm{q}} = 1 - f_{\\mathrm{h}}$.\n- For each component $i \\in \\{\\mathrm{h}, \\mathrm{q}\\}$, compute its absorption coefficient using Beer–Lambert: $\\alpha_{i} = \\dfrac{4\\pi \\kappa_{i}}{\\lambda}$ in $\\mu\\mathrm{m}^{-1}$.\n- For each component $i$, compute its macroscopic scattering coefficient $s_{i}$ via geometric cross-section with packing fraction and scattering efficiency, and weight by its volume fraction: $$s_{i} = \\dfrac{3}{2}\\,p\\,f_{i}\\,\\dfrac{Q_{s,i}}{D_{i}}\\quad\\text{in }\\mu\\mathrm{m}^{-1}.$$\n- For absorption in the mixture, use path fraction reasoning: the macroscopic absorption coefficient is $$K = p\\left(f_{\\mathrm{h}}\\alpha_{\\mathrm{h}} + f_{\\mathrm{q}}\\alpha_{\\mathrm{q}}\\right)\\quad\\text{in }\\mu\\mathrm{m}^{-1}.$$\n- The total scattering coefficient is $$S = s_{\\mathrm{h}} + s_{\\mathrm{q}}\\quad\\text{in }\\mu\\mathrm{m}^{-1}.$$\n- The single scattering albedo is $$w = \\dfrac{S}{S + K}.$$\n- Hapke-style semi-infinite isotropic reflectance mapping: use the standard isotropic half-space reflectance function of $w$ in dimensionless form.\n- Shkuratov two-stream mapping with coupling: define an intergrain coupling parameter $C \\ge 0$ that increases the effective scattering to $$S_{\\mathrm{eff}} = S\\,(1 + C),$$ and compute two-stream reflectance from the ratio $K/S_{\\mathrm{eff}}$ in dimensionless form.\n\nYour program must implement the above and produce the Hapke and Shkuratov predictions for the following test suite of cases, each specified as $(f_{\\mathrm{h}}, D_{\\mathrm{h}}, D_{\\mathrm{q}}, C)$ with diameters in $\\mu\\mathrm{m}$ and coupling parameter dimensionless:\n1. $(0.0, 50.0, 100.0, 0.0)$\n2. $(1.0, 50.0, 100.0, 0.0)$\n3. $(0.5, 50.0, 100.0, 0.0)$\n4. $(0.5, 50.0, 100.0, 0.6)$\n5. $(0.25, 10.0, 100.0, 0.0)$\n6. $(0.75, 200.0, 50.0, 0.3)$\n\nFinal output format specification:\n- For each test case, output a two-element list $[R_{\\mathrm{H}}, R_{\\mathrm{S}}]$ where $R_{\\mathrm{H}}$ is the Hapke-style reflectance and $R_{\\mathrm{S}}$ is the Shkuratov two-stream reflectance, both dimensionless floating-point numbers.\n- Aggregate all test case results into a single list and print exactly one line containing this list-of-lists with no extra text, in the format: $[[r_{1,\\mathrm{H}},r_{1,\\mathrm{S}}],[r_{2,\\mathrm{H}},r_{2,\\mathrm{S}}],\\dots]$.\n\nYour implementation must be a complete, runnable program that takes no input and uses the specified constants. The geometry is fixed as semi-infinite, isotropic scattering; no angles are required, and no additional parameters beyond the test suite are to be used.",
            "solution": "The problem requires the implementation and comparison of two distinct physically-grounded models for the spectral reflectance of an intimate mixture of hematite and quartz particles. The first model is a simplified form of the Hapke radiative transfer theory, specialized for isotropic scattering in a semi-infinite medium. The second is the Shkuratov two-stream model, based on the classical Kubelka–Munk framework, which is augmented with a parameter to account for intergrain light coupling. The objective is to compute the reflectance predicted by each model for a suite of specified mixture compositions, grain sizes, and coupling parameters.\n\nThe solution is predicated on a series of foundational principles from optics and radiative transfer theory. First, the absorption of light within a material is governed by the Beer–Lambert law, which relates the intrinsic absorption coefficient, $\\alpha$, to the material's imaginary index of refraction, $\\kappa$, at a given wavelength, $\\lambda$. The specified relationship is $\\alpha = \\dfrac{4\\pi\\kappa}{\\lambda}$. Second, the scattering of light by particles is modeled using geometric optics principles, where the macroscopic scattering coefficient, $s$, for a component is derived from its dimensionless scattering efficiency $Q_s$, grain diameter $D$, and the packing fraction $p$ of the medium.\n\nThese intrinsic properties are combined to describe the bulk optical behavior of the intimate mixture. The problem specifies linear mixing models for the macroscopic absorption coefficient, $K$, and the total scattering coefficient, $S$. For a mixture of hematite (h) and quartz (q) with respective volume fractions $f_{\\mathrm{h}}$ and $f_{\\mathrm{q}} = 1 - f_{\\mathrm{h}}$, these are defined as:\n$$K = p\\left(f_{\\mathrm{h}}\\alpha_{\\mathrm{h}} + f_{\\mathrm{q}}\\alpha_{\\mathrm{q}}\\right)$$\n$$S = s_{\\mathrm{h}} + s_{\\mathrm{q}}$$\nwhere $s_{i} = \\dfrac{3}{2}\\,p\\,f_{i}\\,\\dfrac{Q_{s,i}}{D_{i}}$ is the contribution of component $i$ to the total scattering coefficient.\n\nFrom these bulk properties, the two models diverge in their calculation of reflectance.\n\nThe Hapke model utilizes the single scattering albedo, $w$, which is the ratio of the scattering coefficient to the total extinction coefficient (scattering plus absorption). It represents the probability that a photon, upon interacting with a particle, is scattered rather than absorbed.\n$$w = \\dfrac{S}{S + K}$$\nThe problem states to use the standard reflectance function for a semi-infinite, isotropically scattering medium. This corresponds to the exact solution derived by S. Chandrasekhar, which is a cornerstone of radiative transfer theory. For normal incidence and observation, its simplified form, widely used in Hapke's framework, gives the reflectance $R_{\\mathrm{H}}$ as:\n$$R_{\\mathrm{H}}(w) = \\dfrac{1 - \\sqrt{1 - w}}{1 + \\sqrt{1 - w}}$$\nThis function maps the single scattering albedo $w \\in [0, 1]$ to a reflectance value $R_{\\mathrm{H}} \\in [0, 1]$.\n\nThe Shkuratov model is a variant of two-stream theory, for which the fundamental parameter is the ratio of the absorption coefficient to the scattering coefficient. The problem specifies an extension where the basal scattering coefficient $S$ is enhanced by an intergrain coupling parameter $C \\ge 0$, yielding an effective scattering coefficient $S_{\\mathrm{eff}}$:\n$$S_{\\mathrm{eff}} = S(1 + C)$$\nThe reflectance is then calculated using the classical two-flux (Kubelka–Munk) equation for a semi-infinite layer. This equation provides the reflectance $R_{\\mathrm{S}}$ as a function of the ratio $K/S_{\\mathrm{eff}}$:\n$$R_{\\mathrm{S}}\\left(\\frac{K}{S_{\\mathrm{eff}}}\\right) = 1 + \\frac{K}{S_{\\mathrm{eff}}} - \\sqrt{\\left(\\frac{K}{S_{\\mathrm{eff}}}\\right)^2 + 2\\frac{K}{S_{\\mathrm{eff}}}}$$\nThis formulation provides a distinct mapping from the bulk optical properties to the macroscopic reflectance. The parameter $C$ explicitly models how interactions between grains can enhance the overall scattering of the medium, a phenomenon not explicitly captured in the simplified Hapke model presented.\n\nThe computational procedure for each test case $(f_{\\mathrm{h}}, D_{\\mathrm{h}}, D_{\\mathrm{q}}, C)$ is as follows:\n1.  Define the global and material-specific constants: wavelength $\\lambda = 0.8\\,\\mu\\mathrm{m}$; packing fraction $p = 0.6$; hematite properties ($n_{\\mathrm{h}} = 3.0$, $\\kappa_{\\mathrm{h}} = 0.02$, $Q_{s,\\mathrm{h}} = 0.7$); and quartz properties ($n_{\\mathrm{q}} = 1.55$, $\\kappa_{\\mathrm{q}} = 1.0\\times10^{-7}$, $Q_{s,\\mathrm{q}} = 1.0$).\n2.  For a given $f_{\\mathrm{h}}$, determine the quartz fraction $f_{\\mathrm{q}} = 1 - f_{\\mathrm{h}}$.\n3.  Calculate the intrinsic absorption coefficients $\\alpha_{\\mathrm{h}}$ and $\\alpha_{\\mathrm{q}}$ using the Beer–Lambert law formula.\n4.  Calculate the macroscopic absorption coefficient of the mixture, $K$.\n5.  Calculate the scattering contributions $s_{\\mathrm{h}}$ and $s_{\\mathrm{q}}$ using the provided formula involving $p$, $f_i$, $Q_{s,i}$, and $D_i$. Sum them to find the total scattering coefficient $S$.\n6.  For the Hapke model, compute the single scattering albedo $w$ and subsequently the reflectance $R_{\\mathrm{H}}$.\n7.  For the Shkuratov model, compute the effective scattering coefficient $S_{\\mathrm{eff}}$ using the coupling parameter $C$, then calculate the ratio $K/S_{\\mathrm{eff}}$ and finally the reflectance $R_{\\mathrm{S}}$.\n8.  Collect the pair of reflectance values $[R_{\\mathrm{H}}, R_{\\mathrm{S}}]$ for each test case.\n\nThis process is repeated for all specified test cases, and the results are aggregated into a final list of lists as per the output specification.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares Hapke and Shkuratov reflectance models for mineral mixtures.\n    \"\"\"\n    \n    # Define global parameters and constants, all in consistent units (micrometers).\n    # Wavelength in micrometers\n    LAMBDA = 0.8 \n    # Packing fraction (dimensionless)\n    PACKING_FRACTION = 0.6\n\n    # Optical properties at lambda = 0.8 um\n    # Hematite\n    KAPPA_H = 0.02\n    Q_S_H = 0.7\n    # Quartz\n    KAPPA_Q = 1.0e-7\n    Q_S_Q = 1.0\n\n    def calculate_reflectances(f_h, D_h, D_q, C):\n        \"\"\"\n        Computes Hapke and Shkuratov reflectances for a given mixture.\n        \n        Args:\n            f_h (float): Volume fraction of hematite.\n            D_h (float): Diameter of hematite grains in micrometers.\n            D_q (float): Diameter of quartz grains in micrometers.\n            C (float): Shkuratov intergrain coupling parameter (dimensionless).\n            \n        Returns:\n            list: A list containing [R_hapke, R_shkuratov].\n        \"\"\"\n        f_q = 1.0 - f_h\n\n        # Step 1: Calculate intrinsic absorption coefficients (alpha_i) in um^-1\n        alpha_h = (4.0 * np.pi * KAPPA_H) / LAMBDA\n        alpha_q = (4.0 * np.pi * KAPPA_Q) / LAMBDA\n\n        # Step 2: Calculate macroscopic absorption coefficient (K) in um^-1\n        K = PACKING_FRACTION * (f_h * alpha_h + f_q * alpha_q)\n\n        # Step 3: Calculate component scattering coefficients (s_i) in um^-1\n        s_h = 0.0\n        if f_h > 0.0:\n            s_h = (1.5 * PACKING_FRACTION * f_h * Q_S_H) / D_h\n\n        s_q = 0.0\n        if f_q > 0.0:\n            s_q = (1.5 * PACKING_FRACTION * f_q * Q_S_Q) / D_q\n        \n        # Step 4: Calculate total scattering coefficient (S) in um^-1\n        S = s_h + s_q\n\n        # A non-scattering medium (S=0) reflects no light in these models.\n        if S == 0.0:\n            return [0.0, 0.0]\n\n        # --- Hapke Model Calculation ---\n        # Calculate single scattering albedo (w)\n        w = S / (S + K)\n        \n        # Calculate Hapke reflectance for a semi-infinite isotropic medium\n        # R_H = (1 - sqrt(1-w)) / (1 + sqrt(1-w))\n        sqrt_1_minus_w = np.sqrt(1.0 - w)\n        R_H = (1.0 - sqrt_1_minus_w) / (1.0 + sqrt_1_minus_w)\n\n        # --- Shkuratov Model Calculation ---\n        # Calculate effective scattering coefficient (S_eff)\n        S_eff = S * (1.0 + C)\n        \n        # Handle case where S_eff is zero\n        if S_eff == 0.0:\n            R_S = 0.0\n        else:\n            # Calculate K/S_eff for the Kubelka-Munk formula\n            k_over_s_eff = K / S_eff\n            # Calculate Shkuratov reflectance using the Kubelka-Munk solution\n            # R_S = 1 + k_s_ratio - sqrt(k_s_ratio^2 + 2*k_s_ratio)\n            R_S = 1.0 + k_over_s_eff - np.sqrt(k_over_s_eff**2 + 2.0 * k_over_s_eff)\n            \n        return [R_H, R_S]\n\n    # Test cases defined as (f_h, D_h, D_q, C)\n    test_cases = [\n        (0.0, 50.0, 100.0, 0.0),\n        (1.0, 50.0, 100.0, 0.0),\n        (0.5, 50.0, 100.0, 0.0),\n        (0.5, 50.0, 100.0, 0.6),\n        (0.25, 10.0, 100.0, 0.0),\n        (0.75, 200.0, 50.0, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_h, D_h, D_q, C = case\n        result_pair = calculate_reflectances(f_h, D_h, D_q, C)\n        results.append(result_pair)\n\n    # Format the final output string to exactly match the specification:\n    # [[r1_H,r1_S],[r2_H,r2_S],...] with no whitespace.\n    output_str = str(results).replace(' ', '')\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}