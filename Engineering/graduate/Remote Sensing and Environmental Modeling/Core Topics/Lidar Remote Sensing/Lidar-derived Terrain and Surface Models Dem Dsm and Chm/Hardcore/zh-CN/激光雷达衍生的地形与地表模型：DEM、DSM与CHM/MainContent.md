## 引言
[激光雷达](@entry_id:192841)（LiDAR）技术已成为精确捕获地球表面三维信息的革命性工具。通过发射[激光脉冲](@entry_id:261861)并分析其回波，LiDAR能够生成密集的、地理参考的三维点云，为我们理解和量化我们的世界提供了前所未有的数据基础。然而，原始的点云数据本身是非结构化的，要将其转化为可供分析和建模使用的信息，需要经过一系列处理步骤，生成如[数字高程模型](@entry_id:1123727)（DEM）、数字表面模型（DSM）和冠层高度模型（CHM）等关键数据产品。这些模型是无数地理空间应用的基石。

本文旨在系统性地填补从原始LiDAR测量到高级应用分析之间的知识鸿沟，为读者提供一份关于DEM、DSM和CHM生成与应用的全面指南。通过阅读本文，您将深入理解这些重要数据产品背后的科学与技术。

文章的结构安排如下：
- **原则与机制** 章节将深入探讨LiDAR测量的物理基础，解析从[飞行时间](@entry_id:159471)到三维点云的转换过程，并详细介绍点云分类、地面滤波及插值等生成DEM、DSM和CHM的核心算法。
- **应用与跨学科联系** 章节将通过在[地貌学](@entry_id:182022)、水文学、林业和城市分析等领域的真实案例，展示这些模型如何被用于解决实际科学问题，并讨论数据质量控制与[误差分析](@entry_id:142477)的重要性。
- **动手实践** 章节将提供一系列具体的计算问题，帮助读者巩固前两章学到的理论知识和方法，并将其应用于实践操作中。

现在，让我们从LiDAR[数据采集](@entry_id:273490)的根本原理出发，开启对这些强大地理空间产品的探索之旅。

## 原则与机制

本章旨在深入阐述从激光雷达（LiDAR）原始测量数据生成数字高程模型（DEM）、数字表面模型（DSM）和冠层高度模型（CHM）的核心科学原则与关键技术机制。我们将从LiDAR测量的物理基础出发，逐步[解析信号](@entry_id:190094)的特性、数据产品的定义，并最终探讨实现这些产品所依赖的关键算法流程。

### LiDAR测量的基本原理

要理解LiDAR衍生产品的本质，我们必须首先掌握其[数据采集](@entry_id:273490)的根本原理。这包括其作为主动传感器的独特优势，以及将时间测量转换为三维空间坐标的核心过程。

#### 主动遥感与被动遥感

LiDAR是一种**主动遥感**技术，这意味着它通过发射自身的[电磁辐射](@entry_id:152916)（激光脉冲）并探测其回波来获取信息。这与依赖外部光源（主要是太阳）的**被动遥感**技术（如传统光学摄影）形成了根本区别。

LiDAR的这一主动特性赋予了它在数据采集中无与伦比的优势，尤其是在光照条件不佳的环境下。考虑一个地形复杂、森林茂密的区域，其中存在因山体遮挡而处于深度阴影中的北坡或山谷。对于被动光学传感器而言，这些阴影区域接收到的太阳辐射极其微弱，导致地表反射的信号非常弱。尽管可以通过延长积分时间来尝试捕获更多光子，但这通常会受到平台运动导致图像模糊的限制，最终导致[数据质量](@entry_id:185007)严重下降或完全缺失。

相比之下，LiDAR系统的回波信号强度主要由其自身发射的脉冲能量、目标的后向散射特性以及仪器几何参数决定，而与环境光照无关。在阴影区域或夜间作业时，环境光辐射的减弱实际上降低了背景噪声，而LiDAR信号的强度保持不变。这使得[信噪比](@entry_id:271861)（SNR）得以维持在较高水平，从而确保了在各种光照条件下都能获得一致且可靠的距离测量。因此，LiDAR能够生成在阳光照射区和阴影区之间无缝过渡、覆盖完整的地形和地表模型，极大地减少了由阴影引起的数据空洞，为精确生成DEM、DSM及CHM提供了坚实基础 。

#### [飞行时间测距](@entry_id:925541)

LiDAR系统的核心测量原理是**飞行时间（Time-of-Flight, ToF）**。系统发射一束短暂而高能量的[激光脉冲](@entry_id:261861)，该脉冲以光速在介质（大气）中传播，击中目标（如地面、植被叶片或建筑物表面）后，一部分能量被后向散射回传感器。传感器通过精确记录从脉冲发射到接收到回波信号之间所经过的时间 $\Delta t$ 来计算距离。

由于激光脉冲完成了一次往返（two-way）行程，因此传感器到目标表面的单程距离（即**斜距**，$R$）为总路程的一半。该关系式可表示为：

$$
R = \frac{c \cdot \Delta t}{2}
$$

在此公式中，$c$ 代表激光在传播介质（通常是空气）中的速度，它略小于[真空中的光速](@entry_id:272753)。$\Delta t$ 则是精确测量的双程[飞行时间](@entry_id:159471)。这个简单的物理关系是所有后续三维空间信息获取的基石 。

#### 从距离到三维点云

仅有距离信息不足以确定目标的三维空间位置。为了构建一个地理参考坐标系下的三维点云，LiDAR系统必须将每次的距离测量与传感器自身在测量瞬间的精确位置和姿态相结合。这一过程称为**直接地理参考（Direct Georeferencing）**。

一个典型的机载LiDAR系统集成了以下关键组件：
1.  **全球导航卫星系统（GNSS）**：提供传感器在特定世界坐标系（如[WGS84](@entry_id:1134054)）中的高精度三维位置向量 $\mathbf{x}_s = (x_s, y_s, z_s)$。
2.  **惯性测量单元（IMU）**：记录传感器的高频姿态变化，即俯仰（pitch）、滚转（roll）和偏航（yaw）。这些姿态信息可以表示为一个[旋转矩阵](@entry_id:140302) $\mathbf{C}_{ws}$，它能够将一个在传感器自身坐标系中定义的向量转换到[世界坐标系](@entry_id:171029)中。
3.  **扫描系统**：通过控制反射镜的运动，使激光束以预定的模式扫描地表。扫描系统会记录每个脉冲发射时在传感器坐标系中的指向角，通常表示为方位角 $\theta$ 和天顶角（或高程角）$\phi$。

结合这些信息，我们可以从一次回波测量中计算出一个地理参考点的三维坐标 $\mathbf{p}_w$。其步骤如下 ：
1.  **计算传感器坐标系中的点向量**：首先，根据扫描角度 $(\theta, \phi)$ 构建一个单位[方向向量](@entry_id:169562) $\hat{\mathbf{u}}_s$。然后，将该[方向向量](@entry_id:169562)与测得的斜距 $R$ 相乘，得到目标点相对于传感器的位置向量 $\mathbf{p}_s$：
    $$
    \mathbf{p}_s = R \cdot \hat{\mathbf{u}}_s = R \cdot \begin{pmatrix} \cos\phi \cos\theta \\ \cos\phi \sin\theta \\ \sin\phi \end{pmatrix}
    $$
2.  **转换到[世界坐标系](@entry_id:171029)**：利用[旋转矩阵](@entry_id:140302) $\mathbf{C}_{ws}$ 将向量 $\mathbf{p}_s$ 从传感器坐标系旋转到世界坐标系，然后加上传感器自身的位置向量 $\mathbf{x}_s$，即可得到目标点的最终三维坐标 $\mathbf{p}_w$：
    $$
    \mathbf{p}_w = \mathbf{x}_s + \mathbf{C}_{ws} \mathbf{p}_s
    $$

通过在飞行过程中以极高的频率（通常是数十万至数百万次每秒）重复这一过程，LiDAR系统便能采集到覆盖整个测区、由数以亿计的地理参考点组成的密集**点云（Point Cloud）**。这个点云是所有后续地形和地表模型产品的基础。

### 表征LiDAR信号：回波与波形

当一个激光脉冲与复杂的三维场景（如森林）相互作用时，其能量并非只被单一表面反射。脉冲可能首先与冠层顶部的一些叶片作用，部分能量穿透后又与中层枝叶作用，最终可能到达地面。这种连续的相互作用导致传感器可以接收到一系列的回波信号。LiDAR系统记录这些信号的方式主要有两种：离散回波和全波形。

#### 离散回波

大多数商业LiDAR系统采用**离散回波（Discrete-Return）**记录模式。在这种模式下，探测器只在接收到的回波功率超过一个预设阈值时，才记录一个“回波事件”。对于单个发射脉冲，系统可以记录多次这样的事件，形成多个回波。这些回波通常被标记为：
-   **首次回波（First Return）**：时间上最早探测到的回波，通常对应于[激光脉冲](@entry_id:261861)沿其路径遇到的第一个显著障碍物，如树冠顶部、建筑物屋顶或开阔地上的地面。
-   **末次回波（Last Return）**：时间上最晚探测到的回波。在植被覆盖区，它通常被期望来自地面，但也可能来自浓密的下层植被。
-   **中间回波（Intermediate Returns）**：介于首次和末次回波之间的所有其他回波，对应于冠层内部的枝叶结构。

#### 冠层穿透与回波选择

在植被冠层中，激光脉冲的能量会随着穿透深度的增加而衰减。脉冲能够成功穿透整个冠层到达地面的概率（即**间隙率**）与叶面积指数（LAI）、叶倾[角分布](@entry_id:193827)以及激光的入射角等因素密切相关。这个过程可以近似地用比尔-朗伯定律来描述，即穿透概率随路径上遇到的叶面积呈指数级下降。在茂密的森林中（例如，[叶面积指数](@entry_id:188310) $L=4$），能够到达地面的脉冲比例可能很低（例如，只有约12%），这意味着许多末次回波实际上可能并非来自地面，而是来自无法穿透的低矮浓密灌木或倒木，从而对后续的地面点提取构成挑战 。

因此，回波的选择对于生成不同的数据产品至关重要：
-   **首次回波**由于其代表了地表的最高特征，是构建**数字表面模型（DSM）**的首选数据源。
-   **末次回波**由于其最有可能来自地面，是提取地面点以构建**数字高程模型（DEM）**的基础。然而，如上所述，简单地将所有末次回波都视为地面点可能会在茂密植被区引入正向高程偏差。

#### 离散回波与全波形LiDAR

**全波形（Full-Waveform）**LiDAR系统提供了更丰富的信息。它不对信号进行阈值判断，而是以极高的[时间分辨率](@entry_id:194281)（如1纳秒）连续数字化并记录下整个返回的能量-时间剖面。1纳秒的采样间隔对应约0.15米的沿路径距离分辨率，使得波形数据能够精细地描绘出激光脉冲与植被冠层垂直结构的相互作用过程 。

全波形数据相对于离散回波数据的优势在于：
1.  **弱信号探测**：离散回波系统依赖于一个固定的探测阈值。如果冠层顶部的反射信号非常微弱（例如，来自稀疏的针叶），其峰值功率可能低于探测阈值。在这种情况下，离散系统的“首次回波”将来自冠层内部更深、更密集的部分，从而导致对冠层高度的显著低估。而全波形系统记录了完整的信号，即使是微弱的冠层顶部信号也能被捕获和分析，从而可以更精确地确定DSM 。
2.  **更精细的[结构分析](@entry_id:153861)**：通过对返回波形进行数学分解（如高斯分解），可以提取出比传统离散回波系统更丰富、更精确的垂直结构信息，例如区分非常接近的多个散射体，这对于精细的植被结构研究和更准确的地面探测都至关重要。

### 从点云到地表模型：定义与派生

原始的[LiDAR点云](@entry_id:1127195)是三维空间中离散点的集合。为了便于分析和应用，需要将这些点云转换为连续的、栅格化的表面模型。最核心的三种产品是数字表面模型（DSM）、数字高程模型（DEM）和冠层高度模型（CHM）。

#### 核心数据产品定义

-   **数字表面模型（Digital Surface Model, DSM）**：DSM是一个表示地球表面（包括其上的所有物体）顶部高程的栅格模型。它描绘的是我们从上空直接“看到”的表面，包含了植被冠层、建筑物屋顶、桥梁等所有地物的顶面高程。在生成DSM时，通常会对每个栅格单元内的所有LiDAR点进行聚合，选择**最高的高程值**作为该单元的DSM值。这些最高点通常来源于LiDAR的首次回波  。

-   **[数字高程模型](@entry_id:1123727)（Digital Elevation Model, DEM）**：DEM，有时也称为[数字地形模型](@entry_id:1123737)（DTM），是一个表示**裸露地表**高程的栅格模型。它移除了所有地表之上的物体（如植被和建筑物），只保留了纯粹的地形起伏。生成DEM是LiDAR数据处理中最具挑战性的步骤之一，它需要通过复杂的算法将点云分类为“地面点”和“非地面点”，然后仅使用地面点进行插值，生成连续的裸地表面 。

-   **冠层高度模型（Canopy Height Model, CHM）**：CHM，也常被称为归一化DSM（nDSM），表示地[物相](@entry_id:196677)对于其下方地面的高度。它通过将DSM与DEM相减得到：
    $$
    CHM(x,y) = DSM(x,y) - DEM(x,y)
    $$
    例如，在某点 $(x_0, y_0)$，如果DSM高程为25.8米，DEM高程为19.7米，那么该点的CHM值就是6.1米，代表了该处的树木或建筑物高度。CHM是[植被生物量估算](@entry_id:1133749)、[森林结构](@entry_id:1125240)分析、城市建筑分析等众多应用的核心数据产品 。

要使上述减法运算具有物理意义，DSM和DEM必须满足两个基本条件：它们必须在水平方向上精确**共[配准](@entry_id:1122567)（co-registered）**，并且必须使用相同的**垂直基准（vertical datum）**。任何水平错位或垂直基准不一致都会引入系统性误差，甚至可能在植被覆盖区域产生无意义的负高度值 。

#### 点云分类的关键作用

从上述定义可以看出，要从混合的点云中准确地生成DEM和有意义的CHM，**点云分类**是不可或缺的步骤。这是将每个点标记为其所属地物类别（如地面、植被、建筑等）的过程。

为了促进数据交换和处理流程的标准化，行业内制定了**LAS文件格式**。这是由美国摄影测量与遥感学会（ASPRS）定义的标准二进制格式，用于存储[LiDAR点云](@entry_id:1127195)数据。每个点除了记录三维坐标（通常是缩放后的整型以节省空间）外，还可以存储强度、回波编号以及一个关键的“分类”代码。**LAZ格式**是LAS格式的[无损压缩](@entry_id:271202)版本，它使用LASzip算法显著减小文件体积，便于存储和传输，同时保证解压后数据与原始LAS文件完全一致 。

ASPRS LAS 1.4标准定义了一套详细的分类代码，其中与DEM/DSM/CHM生成最相关的包括：
-   **类别 2**: **地面（Ground）**
-   **类别 3**: **低植被（Low Vegetation）**
-   **类别 4**: **中等植被（Medium Vegetation）**
-   **类别 5**: **高植被（High Vegetation）**
-   **类别 6**: **建筑物（Building）**

在自动化工作流中，这些分类代码是实现精确模型生成的关键。例如，要生成DEM，算法会筛选出所有类别为2的点。要生成一个只反映植被高度的CHM，就必须将建筑物（类别6）从计算中排除，以避免将建筑高度错误地计为冠层高度。这可以通过在计算CHM之前，利用[土地覆盖](@entry_id:1127047)分类对非植被区域进行掩膜处理来实现  。

### 模型生成的关键算法步骤

从分类后的点云到最终的栅格化模型，还需要经过两个关键的算法步骤：地面滤波和插值。

#### 地面滤波算法

**地面滤波（Ground Filtering）**是从原始点云中分离出地面点的过程，这是生成高质量DEM的核心技术。目前已发展出多种算法，它们基于不同的假设，适用于不同的地形条件。

-   **渐进式三角网加密（Progressive TIN Densification）**：这类算法采用“自下而上”的策略。首先，选择一些确定无疑的地面点（如局部最低点）构建一个稀疏的初始不规则三角网（TIN）。然后，算法迭代地考察其余的点，如果一个候选点到其下方TIN面的[垂直距离](@entry_id:176279)和角度等参数在设定的阈值之内，该点就被接受为地面点并加入TIN中进行加密。这种方法能够很好地适应坡度变化，并能精确地保留地形中的**断裂线（breaklines）**（如山脊、沟谷、路缘），因此在地形崎岖的山区和具有复杂人造结构（如建筑物和道路）的城市地区表现优异 。

-   **布料模拟滤波（Cloth Simulation Filtering, CSF）**：这是一种基于物理模型的、非常直观的算法。首先，它将整个点云在Z轴方向上进行反转，这样原来的地面就变成了“[天花](@entry_id:920451)板”，而树木和建筑物则变成了向下的“凹坑”。然后，算法模拟一块具有一定硬度（由[质量-弹簧系统](@entry_id:267496)定义）的虚拟“布料”在重力作用下覆盖在这个反转的表面上。布料的刚度使其能够“跨越”由树木和建筑物形成的较深的凹坑，而只贴合在代表地面的较平缓的表面上。最后，将布料的位置反转回来，即可得到近似的地面。CSF算法对地形坡度不敏感，并且能有效处理植被覆盖下地面点稀疏的区域，因此在森林和坡地区域表现非常稳健 。

-   **[形态学滤波](@entry_id:897949)（Morphological Filtering）**：这类算法在栅格化的点云表面上操作。其核心是数学[形态学](@entry_id:273085)中的**开运算（opening）**，即先进行腐蚀（erosion）后进行膨胀（dilation）。腐蚀操作会移除比结构元素小的突起对象（如树木和小型建筑），而随后的膨胀操作则恢复被腐蚀的地面，但已移除的对象不会被恢复。该方法的性能严重依赖于所选**结构元素（structuring element）**的大小。传统的[形态学滤波](@entry_id:897949)在坡地区域可能会错误地“切削”掉自然斜坡，因此它最适用于地形相对平坦、地物尺寸较为均一的区域 。

#### 栅格化与插值方法

地面滤波（或最高点选择）之后得到的是一组离散的点，需要通过**插值（Interpolation）**将它们转换为连续的栅格表面。选择何种插值方法会影响最终DEM/DSM的精度和视觉效果，不同的方法基于不同的数学假设。

-   **不规则三角网（Triangulated Irregular Network, TIN）**：这不仅是一种滤波方法，也是一种插值方法。它通过连接数据点形成一个由三角形面片组成的连续表面。其假设是地表在相邻数据点之间是局部平面的。TIN插值的优点是保留了原始数据点的精度，并且能很好地处理断裂线，但计算成本较高 。

-   **反距离权重（Inverse Distance Weighting, IDW）**：这是一种简单而常用的方法。待插值点的值由其周围邻近数据点的加权平均决定，权重与距离的幂成反比。IDW假设一个点的影响力随距离增加而各向同性地衰减。它的优点是计算简单直观，但缺点是没有考虑数据点的[空间分布](@entry_id:188271)格局，可能会被聚集的点过度影响，并且不能表达各向异性的空间结构 。

-   **克里金（Kriging）**：这是一种基于地统计学的先进插值方法。它不仅考虑了距离，还通过**[半变异函数](@entry_id:1131466)（semivariogram）**来显式地模拟数据的[空间自相关](@entry_id:177050)结构。普通克里金假设数据在一个局部邻域内均值恒定，并能通过各向异性的半变异函数模型来处理方[向性](@entry_id:144651)的空间变异。此外，它还能通过“块金效应”（nugget effect）来考虑测量误差，提供最优线性无偏估计和[预测误差](@entry_id:753692)图。克里金方法理论上最严谨，但需要复杂的[前期](@entry_id:170157)变异函数拟合 。

-   **[样条](@entry_id:143749)函数（Spline）**：[样条插值](@entry_id:147363)（如薄板[样条](@entry_id:143749)）旨在生成通过所有数据点的最光滑的曲面（最小化曲率）。这使得它能产生视觉上非常平滑的表面，但在处理具有尖锐断裂线的地表（如建筑边缘）时表现不佳，容易产生不自然的过冲和下冲现象 。

综上所述，从LiDAR脉冲的发射与接收，到三维点云的生成，再到通过分类、滤波和插值等一系列复杂的算法流程，最终得到DSM、DEM和CHM等高精度地理空间产品。这一过程的每一步都建立在坚实的物理原理和数学模型之上，理解这些原则与机制是有效应用LiDAR数据、进行精确环境分析与建模的先决条件。