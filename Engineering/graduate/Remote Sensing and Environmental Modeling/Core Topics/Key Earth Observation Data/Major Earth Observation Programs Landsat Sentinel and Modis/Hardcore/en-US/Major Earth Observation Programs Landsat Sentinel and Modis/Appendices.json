{
    "hands_on_practices": [
        {
            "introduction": "A raw satellite image is a grid of digital numbers (DNs), which are not direct physical measurements. To perform quantitative analysis, we must first convert these DNs into at-sensor spectral radiance ($L_{\\lambda}$) and then into top-of-atmosphere (TOA) reflectance ($\\rho$). This foundational exercise  walks you through this essential radiometric calibration process for Landsat data and introduces the critical skill of propagating measurement uncertainties from the calibration coefficients into the final reflectance product.",
            "id": "3825717",
            "problem": "A Level-1 scene from the Landsat 8 Operational Land Imager (OLI) provides a pixel in the red band with Digital Number (DN). Level-1 radiance rescaling for Landsat is a linear mapping from DN to at-sensor spectral radiance based on metadata-provided multiplicative and additive radiance rescaling coefficients. Top-of-atmosphere (TOA) bidirectional reflectance is defined, under a Lambertian assumption, by the ratio of reflected radiance to the incident exoatmospheric solar irradiance, accounting for Earth–Sun distance and the solar zenith geometry.\n\nStarting from these foundations:\n- The Level-1 linear radiometric calibration definition connecting DN to spectral radiance.\n- The radiometric definition of TOA reflectance for a Lambertian target under solar zenith angle.\n\nderive the expressions needed to convert from DN to spectral radiance $L_{\\lambda}$ and then to TOA reflectance $\\rho$, and propagate uncertainty from the radiance rescaling coefficients only using first-order (Gaussian) uncertainty propagation. Assume all other quantities are exact and neglect atmospheric path terms.\n\nFor a specific pixel in Landsat 8 OLI Band 4 (red), you are given:\n- Digital Number (DN): $Q = 12000$.\n- Radiance multiplicative rescaling coefficient: $M_{L} = 6.000 \\times 10^{-3} \\, \\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}\\,\\text{DN}^{-1}$ with standard uncertainty $u(M_{L}) = 1.5 \\times 10^{-4} \\, \\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}\\,\\text{DN}^{-1}$.\n- Radiance additive rescaling coefficient: $A_{L} = 2.0 \\times 10^{-1} \\, \\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$ with standard uncertainty $u(A_{L}) = 1.0 \\times 10^{-1} \\, \\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$.\n- Mean solar exoatmospheric irradiance for Landsat 8 OLI Band 4 (exospheric solar constant in band): $E_{\\text{SUN}} = 1.570 \\times 10^{3} \\, \\text{W}\\,\\text{m}^{-2}\\,\\mu\\text{m}^{-1}$.\n- Earth–Sun distance in astronomical units (AU): $d = 1.005$.\n- Solar zenith angle: $\\theta_{s} = 30^\\circ$.\n\nAssumptions:\n- Treat $Q$, $E_{\\text{SUN}}$, $d$, and $\\theta_{s}$ as constants with negligible uncertainty.\n- Treat $M_{L}$ and $A_{L}$ as independent (uncorrelated) random variables with the given standard uncertainties.\n- Use first-order (Gaussian) uncertainty propagation.\n- Express angles in degrees; trigonometric functions should be evaluated accordingly.\n- TOA reflectance is dimensionless; express it as a decimal (no percent sign).\n\nCompute the standard uncertainty of the TOA reflectance, $u(\\rho)$, due solely to $u(M_{L})$ and $u(A_{L})$. Round your final result to three significant figures. Report only the final numerical value of $u(\\rho)$ (unitless).",
            "solution": "The problem is deemed valid as it is scientifically grounded in the principles of remote sensing radiometry, well-posed with sufficient information for a unique solution, and objective in its formulation.\n\nThe task is to derive the expression for top-of-atmosphere (TOA) reflectance, $\\rho$, as a function of the Digital Number ($Q$) and other parameters, and then to calculate the standard uncertainty of this reflectance, $u(\\rho)$, arising from the uncertainties in the radiance rescaling coefficients, $M_L$ and $A_L$.\n\nFirst, we establish the relationship between the raw Digital Number ($Q$) from the sensor and the at-sensor spectral radiance, $L_{\\lambda}$. As stated, this is a linear transformation defined by a multiplicative rescaling factor, $M_L$, and an additive rescaling factor, $A_L$.\n$$L_{\\lambda} = M_{L} Q + A_{L}$$\nwhere $L_{\\lambda}$ is the spectral radiance in units of $\\text{W}\\,\\text{m}^{-2}\\,\\text{sr}^{-1}\\,\\mu\\text{m}^{-1}$.\n\nNext, we define the TOA reflectance, $\\rho$. Under a Lambertian assumption, the reflectance is the ratio of the total reflected energy to the total incident energy. In terms of radiance, the TOA reflectance is given by:\n$$\\rho = \\frac{\\pi L_{\\lambda}}{E_{\\text{incident}}}$$\nwhere $L_{\\lambda}$ is the reflected radiance observed by the sensor, and $E_{\\text{incident}}$ is the total solar irradiance incident on a horizontal surface at the top of the atmosphere. The factor of $\\pi$ accounts for the solid angle integration over a hemisphere for an ideal Lambertian surface.\n\nThe incident solar irradiance, $E_{\\text{incident}}$, must be calculated from the mean solar exoatmospheric irradiance, $E_{\\text{SUN}}$, by correcting for two factors: the solar zenith angle, $\\theta_s$, and the Earth–Sun distance, $d$ (in astronomical units, AU). The cosine of the solar zenith angle accounts for the projection of the incoming solar flux onto a horizontal surface. The inverse square law, proportional to $1/d^2$, accounts for the variation in solar irradiance due to the Earth's elliptical orbit.\n$$E_{\\text{incident}} = \\frac{E_{\\text{SUN}} \\cos(\\theta_s)}{d^2}$$\n\nSubstituting the expression for $E_{\\text{incident}}$ into the equation for $\\rho$, we get:\n$$\\rho = \\frac{\\pi L_{\\lambda} d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}$$\n\nNow, we substitute the first equation for $L_{\\lambda}$ into this expression to obtain the full model for TOA reflectance as a function of the input DN and sensor/scene parameters:\n$$\\rho(Q, M_L, A_L, E_{\\text{SUN}}, d, \\theta_s) = \\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)} (M_{L} Q + A_{L})$$\n\nThe problem requires calculating the standard uncertainty in $\\rho$, $u(\\rho)$, due solely to the uncertainties in $M_L$ and $A_L$. All other variables ($Q$, $E_{\\text{SUN}}$, $d$, $\\theta_s$) are treated as exact constants. We are given that $M_L$ and $A_L$ are independent. The formula for first-order (Gaussian) uncertainty propagation for a function $f(x, y)$ with independent variables $x$ and $y$ is:\n$$u(f)^2 = \\left(\\frac{\\partial f}{\\partial x}\\right)^2 u(x)^2 + \\left(\\frac{\\partial f}{\\partial y}\\right)^2 u(y)^2$$\nApplying this to our function $\\rho(M_L, A_L)$:\n$$u(\\rho)^2 = \\left(\\frac{\\partial \\rho}{\\partial M_L}\\right)^2 u(M_L)^2 + \\left(\\frac{\\partial \\rho}{\\partial A_L}\\right)^2 u(A_L)^2$$\n\nWe compute the partial derivatives of $\\rho$ with respect to $M_L$ and $A_L$:\n$$\\frac{\\partial \\rho}{\\partial M_L} = \\frac{\\partial}{\\partial M_L} \\left[ \\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)} (M_{L} Q + A_{L}) \\right] = \\frac{\\pi Q d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}$$\n$$\\frac{\\partial \\rho}{\\partial A_L} = \\frac{\\partial}{\\partial A_L} \\left[ \\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)} (M_{L} Q + A_{L}) \\right] = \\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}$$\n\nSubstituting these derivatives into the uncertainty propagation formula:\n$$u(\\rho)^2 = \\left(\\frac{\\pi Q d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}\\right)^2 u(M_L)^2 + \\left(\\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}\\right)^2 u(A_L)^2$$\nWe can factor out the common term:\n$$u(\\rho)^2 = \\left(\\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}\\right)^2 \\left[ (Q u(M_L))^2 + u(A_L)^2 \\right]$$\n\nNow we substitute the provided numerical values:\n- $Q = 12000$\n- $u(M_{L}) = 1.5 \\times 10^{-4}$\n- $u(A_{L}) = 1.0 \\times 10^{-1}$\n- $E_{\\text{SUN}} = 1.570 \\times 10^{3}$\n- $d = 1.005$\n- $\\theta_{s} = 30^\\circ$\n\nFirst, calculate the terms inside the brackets:\n$$(Q u(M_L))^2 = (12000 \\times 1.5 \\times 10^{-4})^2 = (1.8)^2 = 3.24$$\n$$u(A_L)^2 = (1.0 \\times 10^{-1})^2 = 0.01$$\n\nThe sum of these squared terms is:\n$$(Q u(M_L))^2 + u(A_L)^2 = 3.24 + 0.01 = 3.25$$\n\nNext, calculate the squared pre-factor. We use $\\cos(30^\\circ) = \\frac{\\sqrt{3}}{2}$.\n$$\\left(\\frac{\\pi d^2}{E_{\\text{SUN}} \\cos(\\theta_s)}\\right)^2 = \\left(\\frac{\\pi (1.005)^2}{(1.570 \\times 10^{3}) \\times \\frac{\\sqrt{3}}{2}}\\right)^2$$\n$$\\left(\\frac{\\pi \\times 1.010025}{1359.6601...}\\right)^2 \\approx (0.00233370...)^2 \\approx 5.44614 \\times 10^{-6}$$\n\nNow, multiply the two parts to find $u(\\rho)^2$:\n$$u(\\rho)^2 \\approx (5.44614 \\times 10^{-6}) \\times 3.25 \\approx 1.769996 \\times 10^{-5}$$\n\nFinally, take the square root to find the standard uncertainty $u(\\rho)$:\n$$u(\\rho) = \\sqrt{1.769996 \\times 10^{-5}} \\approx 0.00420713$$\n\nRounding the result to three significant figures as requested:\n$$u(\\rho) \\approx 0.00421$$",
            "answer": "$$\\boxed{0.00421}$$"
        },
        {
            "introduction": "Fusing data from different sensors, such as Landsat and Sentinel-2, often requires resampling one dataset to match the spatial grid of another. The choice of resampling algorithm—be it nearest-neighbor, bilinear, or cubic convolution—can introduce specific artifacts and biases, especially near sharp environmental gradients like shorelines. This practice  provides a framework for deriving and quantifying the impact of these common resampling methods on a scientifically vital product, the Normalized Difference Water Index (NDWI).",
            "id": "3825805",
            "problem": "Consider a cross-sensor harmonization task across Landsat, Copernicus Sentinel-2, and Moderate Resolution Imaging Spectroradiometer (MODIS), where a shoreline boundary separates open water from vegetated land. Assume the reflectance field is a one-dimensional, piecewise-constant step function along the horizontal coordinate $x$, with the boundary at $x=0$, water for $x<0$, and land for $x\\geq 0$. Let the water endmember have green- and near-infrared (NIR) surface reflectances $R_{g}^{w}=0.05$ and $R_{n}^{w}=0.01$, and the land endmember (dense vegetation) have $R_{g}^{\\ell}=0.08$ and $R_{n}^{\\ell}=0.45$. Define the Normalized Difference Water Index (NDWI) as $I=\\frac{R_{g}-R_{n}}{R_{g}+R_{n}}$, which is commonly used across Landsat, Sentinel-2, and MODIS for water detection.\n\nYou are resampling Sentinel-2 green and NIR reflectances from their native grid ($10\\,\\mathrm{m}$ sample spacing) to a Landsat target grid ($30\\,\\mathrm{m}$) at the target pixel center located at $x=0$. Due to typical cross-sensor geolocation discrepancies, the Sentinel-2 sample centers are offset by $\\Delta=5\\,\\mathrm{m}$ relative to the shoreline, so that sample centers lie at $x_{k}=\\Delta+10k$ with $k\\in\\mathbb{Z}$. Thus, the four nearest Sentinel-2 samples to $x=0$ occur at $x=-15\\,\\mathrm{m}$, $x=-5\\,\\mathrm{m}$ (water side) and $x=+5\\,\\mathrm{m}$, $x=+15\\,\\mathrm{m}$ (land side).\n\nStarting from the definitions of sampling and interpolation operators and the NDWI definition, derive how nearest-neighbor, bilinear (in one dimension), and cubic convolution resampling (Keys kernel with parameter $a=-\\frac{1}{2}$) alter edge contrast for this step edge at $x=0$. Then, using those operators, compute the NDWI bias at the shoreline target location for each method, defined as\n$$\nB=\\left(\\frac{R_{g}^{\\mathrm{res}}-R_{n}^{\\mathrm{res}}}{R_{g}^{\\mathrm{res}}+R_{n}^{\\mathrm{res}}}\\right)-\\left(\\frac{R_{g}^{w}-R_{n}^{w}}{R_{g}^{w}+R_{n}^{w}}\\right),\n$$\nwhere $R_{g}^{\\mathrm{res}}$ and $R_{n}^{\\mathrm{res}}$ are the resampled green and NIR reflectances at $x=0$ produced by each method.\n\nAssume ideal point sampling at pixel centers (neglect point-spread functions and subpixel mixing other than the resampling weights) and that reflectances are spectrally and spatially constant within each endmember. Use the Keys cubic convolution kernel:\n$$\nh(t)=\n\\begin{cases}\n(a+2)|t|^{3}-(a+3)|t|^{2}+1, & 0\\leq |t|<1,\\\\\na|t|^{3}-5a|t|^{2}+8a|t|-4a, & 1\\leq |t|<2,\\\\\n0, & |t|\\geq 2,\n\\end{cases}\n\\quad a=-\\frac{1}{2}.\n$$\n\nProvide the three NDWI biases $B_{\\mathrm{NN}}$, $B_{\\mathrm{BL}}$, and $B_{\\mathrm{CC}}$ corresponding to nearest-neighbor, bilinear, and cubic convolution, respectively. Express the final biases as decimals (unitless) and round your answer to four significant figures.",
            "solution": "The problem is valid as it is scientifically grounded in remote sensing principles, well-posed with all necessary information, and free of contradictions or ambiguities.\n\nThe one-dimensional reflectance field $R(x)$ for a given spectral band is a piecewise-constant step function with a discontinuity at $x=0$.\n$$\nR(x) =\n\\begin{cases}\nR^{w} & \\text{if } x < 0 \\\\\nR^{\\ell} & \\text{if } x \\ge 0\n\\end{cases}\n$$\nThe endmember reflectances are given for the green ($g$) and near-infrared ($n$) bands:\nWater (w): $R_{g}^{w}=0.05$, $R_{n}^{w}=0.01$.\nLand ($\\ell$): $R_{g}^{\\ell}=0.08$, $R_{n}^{\\ell}=0.45$.\n\nThe source Sentinel-2 samples are located at positions $x_k = \\Delta + S \\cdot k = 5 + 10k$ for $k \\in \\mathbb{Z}$, where the sample spacing is $S=10\\,\\mathrm{m}$.\nFor $k \\le -1$, $x_k < 0$, so the samples have water reflectance, $R(x_k)=R^w$.\nFor $k \\ge 0$, $x_k > 0$, so the samples have land reflectance, $R(x_k)=R^\\ell$.\n\nWe are resampling to a target location $x_{\\mathrm{target}}=0$. The resampled reflectance, $R^{\\mathrm{res}}$, is a weighted sum of the source samples:\n$$\nR^{\\mathrm{res}}(x_{\\mathrm{target}}) = \\sum_{k \\in \\mathbb{Z}} R(x_k) h\\left(\\frac{x_{\\mathrm{target}} - x_k}{S}\\right)\n$$\nwhere $h(t)$ is the resampling kernel. With $x_{\\mathrm{target}}=0$ and $S=10$, the argument to the kernel is $t_k = -x_k/10 = -(5+10k)/10 = -0.5-k$.\n\nThe resampling kernels have finite support, so we only need to consider samples near $x=0$. The four nearest samples are at:\n$x_{-2} = -15\\,\\mathrm{m}$ (water), with $t_{-2} = 1.5$\n$x_{-1} = -5\\,\\mathrm{m}$ (water), with $t_{-1} = 0.5$\n$x_{0} = 5\\,\\mathrm{m}$ (land), with $t_{0} = -0.5$\n$x_{1} = 15\\,\\mathrm{m}$ (land), with $t_{1} = -1.5$\n\nWe will now compute the resampled green ($R_g^{\\mathrm{res}}$) and NIR ($R_n^{\\mathrm{res}}$) reflectances for each method.\n\n**1. Nearest-Neighbor (NN) Resampling**\nThis method assigns the value of the nearest source sample to the target location. The target $x_{\\mathrm{target}}=0$ is equidistant from $x_{-1}=-5\\,\\mathrm{m}$ and $x_0=5\\,\\mathrm{m}$. An ambiguity exists in this tie-breaking case. A physically consistent choice is to use the an endmember type corresponding to the target location's classification. Since $x=0$ is defined as land ($x \\ge 0$), we assign the land reflectance values.\n$$\nR^{\\mathrm{res, NN}} = R(x_0) = R^{\\ell}\n$$\nTherefore, the resampled reflectances are:\n$R_{g}^{\\mathrm{NN}} = R_{g}^{\\ell} = 0.08$\n$R_{n}^{\\mathrm{NN}} = R_{n}^{\\ell} = 0.45$\nThis method perfectly preserves the endmember spectral signature but shifts the perceived location of the boundary.\n\n**2. Bilinear (1D Linear) Resampling**\nThe 1D linear interpolation kernel is $h(t) = \\max(0, 1-|t|)$, with support on $|t|<1$. Only samples for which $|t_k|<1$ will contribute. These are $x_{-1}$ ($t_{-1}=0.5$) and $x_0$ ($t_0=-0.5$).\nThe weights are:\n$w_{-1} = h(t_{-1}) = h(0.5) = 1 - 0.5 = 0.5$\n$w_0 = h(t_0) = h(-0.5) = 1 - |-0.5| = 0.5$\nThe resampled reflectance is the weighted average:\n$R^{\\mathrm{res, BL}} = w_{-1}R(x_{-1}) + w_0R(x_0) = 0.5 R^w + 0.5 R^\\ell$.\nFor each band:\n$R_{g}^{\\mathrm{BL}} = 0.5 R_{g}^{w} + 0.5 R_{g}^{\\ell} = 0.5(0.05) + 0.5(0.08) = 0.025 + 0.04 = 0.065$\n$R_{n}^{\\mathrm{BL}} = 0.5 R_{n}^{w} + 0.5 R_{n}^{\\ell} = 0.5(0.01) + 0.5(0.45) = 0.005 + 0.225 = 0.23$\nThis method blurs the edge by creating a mixed pixel with reflectance exactly halfway between the two endmembers.\n\n**3. Cubic Convolution (CC) Resampling**\nThe Keys kernel with $a=-1/2$ is given by:\n$$\nh(t)=\n\\begin{cases}\n1.5|t|^{3}-2.5|t|^{2}+1, & 0\\leq |t|<1\\\\\n-0.5|t|^{3}+2.5|t|^{2}-4|t|+2, & 1\\leq |t|<2\\\\\n0, & |t|\\geq 2\n\\end{cases}\n$$\nThe kernel has support on $|t|<2$, so the four nearest samples ($x_{-2}, x_{-1}, x_0, x_1$) contribute.\nThe weights are calculated for $t_{-2}=1.5$, $t_{-1}=0.5$, $t_0=-0.5$, $t_1=-1.5$. Due to kernel symmetry, $h(t)=h(-t)$.\nFor $|t|=0.5$ (applies to $t_{-1}, t_0$):\n$w_{-1} = w_0 = h(0.5) = 1.5(0.5)^3 - 2.5(0.5)^2 + 1 = 1.5(0.125) - 2.5(0.25) + 1 = 0.1875 - 0.625 + 1 = 0.5625$.\nFor $|t|=1.5$ (applies to $t_{-2}, t_1$):\n$w_{-2} = w_1 = h(1.5) = -0.5(1.5)^3 + 2.5(1.5)^2 - 4(1.5) + 2 = -0.5(3.375) + 2.5(2.25) - 6 + 2 = -1.6875 + 5.625 - 4 = -0.0625$.\nThe resampled reflectance is:\n$R^{\\mathrm{res, CC}} = w_{-2}R(x_{-2}) + w_{-1}R(x_{-1}) + w_0R(x_0) + w_1R(x_1)$\n$R^{\\mathrm{res, CC}} = w_{-2}R^w + w_{-1}R^w + w_0R^\\ell + w_1R^\\ell = (w_{-2}+w_{-1})R^w + (w_0+w_1)R^\\ell$.\nThe total weight on the water endmember is $w_{-2}+w_{-1} = -0.0625 + 0.5625 = 0.5$.\nThe total weight on the land endmember is $w_0+w_1 = 0.5625 - 0.0625 = 0.5$.\nSo, $R^{\\mathrm{res, CC}} = 0.5R^w + 0.5R^\\ell$.\nThis demonstrates that for this perfectly symmetric configuration, the cubic convolution yields the exact same result as bilinear interpolation.\n$R_{g}^{\\mathrm{CC}} = R_{g}^{\\mathrm{BL}} = 0.065$\n$R_{n}^{\\mathrm{CC}} = R_{n}^{\\mathrm{BL}} = 0.23$\n\n**NDWI Bias Calculation**\nThe NDWI is $I = \\frac{R_g-R_n}{R_g+R_n}$. The bias is defined as $B = I^{\\mathrm{res}} - I^w$.\nFirst, we compute the reference NDWI for water:\n$$\nI^w = \\frac{R_{g}^{w}-R_{n}^{w}}{R_{g}^{w}+R_{n}^{w}} = \\frac{0.05 - 0.01}{0.05 + 0.01} = \\frac{0.04}{0.06} = \\frac{2}{3}\n$$\nNow we compute the bias for each resampling method.\n\nBias for NN ($B_{\\mathrm{NN}}$):\n$I_{\\mathrm{NN}} = \\frac{R_{g}^{\\mathrm{NN}}-R_{n}^{\\mathrm{NN}}}{R_{g}^{\\mathrm{NN}}+R_{n}^{\\mathrm{NN}}} = \\frac{0.08 - 0.45}{0.08 + 0.45} = \\frac{-0.37}{0.53}$\n$B_{\\mathrm{NN}} = \\frac{-0.37}{0.53} - \\frac{2}{3} \\approx -0.698113 - 0.666667 = -1.36478\\dots$\nRounding to four significant figures, $B_{\\mathrm{NN}} \\approx -1.365$.\n\nBias for Bilinear ($B_{\\mathrm{BL}}$):\n$I_{\\mathrm{BL}} = \\frac{R_{g}^{\\mathrm{BL}}-R_{n}^{\\mathrm{BL}}}{R_{g}^{\\mathrm{BL}}+R_{n}^{\\mathrm{BL}}} = \\frac{0.065 - 0.23}{0.065 + 0.23} = \\frac{-0.165}{0.295}$\n$B_{\\mathrm{BL}} = \\frac{-0.165}{0.295} - \\frac{2}{3} \\approx -0.559322 - 0.666667 = -1.225989\\dots$\nRounding to four significant figures, $B_{\\mathrm{BL}} \\approx -1.226$.\n\nBias for Cubic Convolution ($B_{\\mathrm{CC}}$):\nSince the resampled reflectances are identical to the bilinear case, the NDWI and the bias are also identical.\n$I_{\\mathrm{CC}} = I_{\\mathrm{BL}}$, so $B_{\\mathrm{CC}} = B_{\\mathrm{BL}} \\approx -1.226$.\nThe biases show that the choice of resampling algorithm significantly impacts the derived index value at a sharp boundary, which is a critical consideration in cross-sensor harmonization and feature extraction.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} -1.365 & -1.226 & -1.226 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Time-series analysis of satellite data from programs like MODIS is fundamental to monitoring global environmental change, but its accuracy is often compromised by undetected cloud contamination. This simulation exercise  challenges you to model this real-world problem by quantifying how errors in a cloud mask propagate into a Normalized Difference Vegetation Index (NDVI) time series. By simulating the effects of subpixel cloud cover, you will gain insight into the magnitude and seasonality of anomalies that can arise from imperfect data screening.",
            "id": "3825815",
            "problem": "You are tasked with building a complete, runnable program that quantifies how errors in cloud masking propagate into Normalized Difference Vegetation Index (NDVI) time series anomalies for major Earth Observation programs. Use a principled model rooted in fundamental definitions to derive and implement the computation. Your program must adhere to the following mathematical model and produce the specified output.\n\nAssumptions and definitions:\n- Normalized Difference Vegetation Index (NDVI) is defined by $ \\mathrm{NDVI} = \\dfrac{\\rho_{\\mathrm{NIR}} - \\rho_{\\mathrm{Red}}}{\\rho_{\\mathrm{NIR}} + \\rho_{\\mathrm{Red}}} $, where $ \\rho_{\\mathrm{NIR}} $ and $ \\rho_{\\mathrm{Red}} $ are apparent reflectances in the near-infrared and red bands, respectively. NDVI is dimensionless.\n- Subpixel linear mixing of reflectance is assumed for cloud contamination: when a pixel labeled as clear is actually contaminated by clouds, the apparent reflectance at wavelength $ \\lambda $ is modeled as a linear combination of the true surface reflectance and a cloud reflectance spectrum. All reflectances are dimensionless.\n- A cloud mask misclassification rate $ r \\in [0,1] $ is the fraction of acquisitions that are actually contaminated but labeled as clear. A per-observation contamination fraction $ \\alpha \\in [0,1] $ is the fraction of the pixel area covered by cloud within each contaminated observation. Both $ r $ and $ \\alpha $ are dimensionless fractions expressed as decimals.\n- The cloud reflectance spectrum $ \\rho_{\\mathrm{cloud}}(\\lambda) $ is specified by the function\n$$\n\\rho_{\\mathrm{cloud}}(\\lambda) = 0.55 + 0.10 \\tanh\\!\\left(\\dfrac{\\lambda - 0.6}{0.2}\\right) - 0.08 \\exp\\!\\left(-\\dfrac{(\\lambda - 0.94)^2}{2 \\cdot 0.02^2}\\right),\n$$\nwhere $ \\lambda $ is the wavelength in micrometers. This function is used to evaluate the red and near-infrared cloud reflectances at instrument-specific band center wavelengths.\n- The true surface reflectances evolve seasonally over $ T = 12 $ months according to\n$$\n\\rho_{\\mathrm{NIR,true}}(t) = 0.40 + 0.15 \\sin\\!\\left(\\dfrac{2\\pi (t-1)}{12}\\right),\n\\quad\n\\rho_{\\mathrm{Red,true}}(t) = 0.08 - 0.03 \\sin\\!\\left(\\dfrac{2\\pi (t-1)}{12}\\right),\n$$\nfor $ t \\in \\{1,2,\\dots,12\\} $. The arguments of the sine function are in radians.\n\nTask:\n- For each test case, treat the instrument band responses as delta functions at the specified band center wavelengths. For a given misclassification rate $ r $ and contamination fraction $ \\alpha $, compute the expected apparent reflectances in the red and near-infrared bands under the assumption of subpixel linear mixing and random occurrence of contamination across the time series. Then compute the observed NDVI time series and the anomaly time series defined by\n$$\n\\Delta \\mathrm{NDVI}(t) = \\mathrm{NDVI}_{\\mathrm{obs}}(t) - \\mathrm{NDVI}_{\\mathrm{true}}(t),\n$$\nfor $ t \\in \\{1,2,\\dots,12\\} $. Finally, summarize the anomalies with the following metrics:\n1. Root-mean-square anomaly $ \\mathrm{RMSA} = \\sqrt{\\dfrac{1}{T} \\sum_{t=1}^{T} \\left(\\Delta \\mathrm{NDVI}(t)\\right)^2} $,\n2. Mean anomaly $ \\overline{\\Delta \\mathrm{NDVI}} = \\dfrac{1}{T}\\sum_{t=1}^{T} \\Delta \\mathrm{NDVI}(t) $,\n3. Maximum absolute anomaly $ \\max_{t} \\left|\\Delta \\mathrm{NDVI}(t)\\right| $.\nAll three metrics are dimensionless.\n\nInstrument band centers (wavelengths in micrometers) for the major programs:\n- Landsat 8 Operational Land Imager (OLI): $ \\lambda_{\\mathrm{Red}} = 0.655 $, $ \\lambda_{\\mathrm{NIR}} = 0.865 $.\n- Sentinel-2 Multispectral Instrument (MSI): $ \\lambda_{\\mathrm{Red}} = 0.665 $, $ \\lambda_{\\mathrm{NIR}} = 0.842 $.\n- Moderate Resolution Imaging Spectroradiometer (MODIS): $ \\lambda_{\\mathrm{Red}} = 0.645 $, $ \\lambda_{\\mathrm{NIR}} = 0.858 $.\n\nTest suite:\n- Case $1$ (Landsat $8$ OLI): $ \\lambda_{\\mathrm{Red}} = 0.655 $, $ \\lambda_{\\mathrm{NIR}} = 0.865 $, $ r = 0.3 $, $ \\alpha = 0.5 $.\n- Case $2$ (Sentinel-$2$ MSI): $ \\lambda_{\\mathrm{Red}} = 0.665 $, $ \\lambda_{\\mathrm{NIR}} = 0.842 $, $ r = 0.1 $, $ \\alpha = 0.3 $.\n- Case $3$ (MODIS, boundary $r=0$): $ \\lambda_{\\mathrm{Red}} = 0.645 $, $ \\lambda_{\\mathrm{NIR}} = 0.858 $, $ r = 0.0 $, $ \\alpha = 0.7 $.\n- Case $4$ (MODIS, extreme $r=1$ and full contamination): $ \\lambda_{\\mathrm{Red}} = 0.645 $, $ \\lambda_{\\mathrm{NIR}} = 0.858 $, $ r = 1.0 $, $ \\alpha = 1.0 $.\n\nRequired output:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must itself be a list of three floats $ [\\mathrm{RMSA}, \\overline{\\Delta \\mathrm{NDVI}}, \\max|\\Delta \\mathrm{NDVI}|] $, with each float rounded to $6$ decimal places. The final printed string must therefore look like\n$ [[a_{11},a_{12},a_{13}],[a_{21},a_{22},a_{23}],[a_{31},a_{32},a_{33}],[a_{41},a_{42},a_{43}]] $,\nwhere each $ a_{ij} $ is a float with $6$ decimal places. NDVI and all derived quantities are unitless; wavelengths must be treated in micrometers.",
            "solution": "We begin from fundamental definitions and assumptions common to optical remote sensing. The Normalized Difference Vegetation Index (NDVI) is defined as $ \\mathrm{NDVI} = \\dfrac{\\rho_{\\mathrm{NIR}} - \\rho_{\\mathrm{Red}}}{\\rho_{\\mathrm{NIR}} + \\rho_{\\mathrm{Red}}} $, where $ \\rho_{\\mathrm{NIR}} $ and $ \\rho_{\\mathrm{Red}} $ are apparent reflectances measured by the sensor. NDVI is dimensionless.\n\nSubpixel linear mixing is an extensively used and well-tested approximation for reflectances in heterogeneous pixels. When a pixel labeled clear contains cloud contamination with fraction $ \\alpha \\in [0,1] $, the apparent reflectance at wavelength $ \\lambda $ in such a contaminated observation is\n$$\n\\rho_{\\mathrm{cont}}(t,\\lambda) = (1 - \\alpha)\\,\\rho_{\\mathrm{true}}(t,\\lambda) + \\alpha \\,\\rho_{\\mathrm{cloud}}(\\lambda),\n$$\nwhere $ \\rho_{\\mathrm{true}}(t,\\lambda) $ is the true surface reflectance and $ \\rho_{\\mathrm{cloud}}(\\lambda) $ is the cloud reflectance spectrum. A cloud mask misclassification rate $ r \\in [0,1] $ means that with probability $ r $ an acquisition that is labeled clear is actually contaminated, and with probability $ 1-r $ it is truly clear. The expected apparent reflectance for the stream of clear-labeled observations at time $ t $ is then\n$$\n\\mathbb{E}[\\rho_{\\mathrm{obs}}(t,\\lambda)]\n= (1-r)\\,\\rho_{\\mathrm{true}}(t,\\lambda) + r\\,\\rho_{\\mathrm{cont}}(t,\\lambda)\n= \\rho_{\\mathrm{true}}(t,\\lambda) + r\\,\\alpha\\left(\\rho_{\\mathrm{cloud}}(\\lambda) - \\rho_{\\mathrm{true}}(t,\\lambda)\\right).\n$$\nThis follows from linearity of expectation and linear mixing, with no additional approximations. Denote this expectation by $ \\rho_{\\mathrm{eff}}(t,\\lambda) $:\n$$\n\\rho_{\\mathrm{eff}}(t,\\lambda) = \\rho_{\\mathrm{true}}(t,\\lambda) + r\\,\\alpha\\left(\\rho_{\\mathrm{cloud}}(\\lambda) - \\rho_{\\mathrm{true}}(t,\\lambda)\\right)\n= (1 - r\\alpha)\\,\\rho_{\\mathrm{true}}(t,\\lambda) + r\\alpha\\,\\rho_{\\mathrm{cloud}}(\\lambda).\n$$\n\nFor each instrument, we treat the band spectral response as a delta function at the band center wavelengths $ \\lambda_{\\mathrm{Red}} $ and $ \\lambda_{\\mathrm{NIR}} $ (a standard simplifying assumption for analytical work). Therefore, the true red and near-infrared reflectances at time $ t $ are\n$$\n\\rho_{\\mathrm{Red,true}}(t) = \\rho_{\\mathrm{true}}(t,\\lambda_{\\mathrm{Red}}),\n\\qquad\n\\rho_{\\mathrm{NIR,true}}(t) = \\rho_{\\mathrm{true}}(t,\\lambda_{\\mathrm{NIR}}),\n$$\nand the effective reflectances are\n$$\n\\rho_{\\mathrm{Red,eff}}(t) = \\rho_{\\mathrm{Red,true}}(t) + r\\,\\alpha\\left(\\rho_{\\mathrm{cloud}}(\\lambda_{\\mathrm{Red}}) - \\rho_{\\mathrm{Red,true}}(t)\\right),\n$$\n$$\n\\rho_{\\mathrm{NIR,eff}}(t) = \\rho_{\\mathrm{NIR,true}}(t) + r\\,\\alpha\\left(\\rho_{\\mathrm{cloud}}(\\lambda_{\\mathrm{NIR}}) - \\rho_{\\mathrm{NIR,true}}(t)\\right).\n$$\n\nThe true surface reflectances embody seasonal variation over $ T = 12 $ months via\n$$\n\\rho_{\\mathrm{NIR,true}}(t) = 0.40 + 0.15 \\sin\\!\\left(\\dfrac{2\\pi (t-1)}{12}\\right),\n\\qquad\n\\rho_{\\mathrm{Red,true}}(t) = 0.08 - 0.03 \\sin\\!\\left(\\dfrac{2\\pi (t-1)}{12}\\right),\n$$\nwith the argument of the sine function in radians. These values are dimensionless and reflect typical vegetation optics: larger near-infrared reflectance and lower red reflectance during peak greenness.\n\nThe cloud reflectance spectrum at micrometer wavelength $ \\lambda $ is specified by\n$$\n\\rho_{\\mathrm{cloud}}(\\lambda) = 0.55 + 0.10 \\tanh\\!\\left(\\dfrac{\\lambda - 0.6}{0.2}\\right) - 0.08 \\exp\\!\\left(-\\dfrac{(\\lambda - 0.94)^2}{2 \\cdot 0.02^2}\\right).\n$$\nThis functional form captures a gently increasing background reflectance with wavelength and a weak absorption depression near $ \\lambda = 0.94 $.\n\nFor each month $ t \\in \\{1,\\dots,12\\} $, we compute the true NDVI,\n$$\n\\mathrm{NDVI}_{\\mathrm{true}}(t) = \\dfrac{\\rho_{\\mathrm{NIR,true}}(t) - \\rho_{\\mathrm{Red,true}}(t)}{\\rho_{\\mathrm{NIR,true}}(t) + \\rho_{\\mathrm{Red,true}}(t)},\n$$\nand the expected observed NDVI under cloud mask error,\n$$\n\\mathrm{NDVI}_{\\mathrm{obs}}(t) = \\dfrac{\\rho_{\\mathrm{NIR,eff}}(t) - \\rho_{\\mathrm{Red,eff}}(t)}{\\rho_{\\mathrm{NIR,eff}}(t) + \\rho_{\\mathrm{Red,eff}}(t)}.\n$$\nThe anomaly at time $ t $ is\n$$\n\\Delta \\mathrm{NDVI}(t) = \\mathrm{NDVI}_{\\mathrm{obs}}(t) - \\mathrm{NDVI}_{\\mathrm{true}}(t).\n$$\n\nWe then summarize the anomalies by three scalar metrics:\n1. Root-mean-square anomaly:\n$$\n\\mathrm{RMSA} = \\sqrt{\\dfrac{1}{T} \\sum_{t=1}^{T} \\left(\\Delta \\mathrm{NDVI}(t)\\right)^2}.\n$$\n2. Mean anomaly:\n$$\n\\overline{\\Delta \\mathrm{NDVI}} = \\dfrac{1}{T} \\sum_{t=1}^{T} \\Delta \\mathrm{NDVI}(t).\n$$\n3. Maximum absolute anomaly:\n$$\n\\max_{t} \\left|\\Delta \\mathrm{NDVI}(t)\\right|.\n$$\n\nBoundary and edge-case checks validate the derivation:\n- If $ r = 0 $, then $ \\rho_{\\mathrm{eff}}(t,\\lambda) = \\rho_{\\mathrm{true}}(t,\\lambda) $ for all $ t $ and $ \\lambda $, so $ \\Delta \\mathrm{NDVI}(t) = 0 $ for all $ t $. Consequently, $ \\mathrm{RMSA} = 0 $, $ \\overline{\\Delta \\mathrm{NDVI}} = 0 $, and $ \\max |\\Delta \\mathrm{NDVI}| = 0 $.\n- If $ r = 1 $ and $ \\alpha = 1 $, then $ \\rho_{\\mathrm{eff}}(t,\\lambda) = \\rho_{\\mathrm{cloud}}(\\lambda) $ for all $ t $, so $ \\mathrm{NDVI}_{\\mathrm{obs}}(t) $ is constant in time and determined solely by the cloud reflectances at the instrument’s $ \\lambda_{\\mathrm{Red}} $ and $ \\lambda_{\\mathrm{NIR}} $. The anomalies reflect the difference between this cloud-only NDVI and the seasonally varying true NDVI.\n\nAlgorithmic implementation computes $ \\rho_{\\mathrm{cloud}}(\\lambda_{\\mathrm{Red}}) $ and $ \\rho_{\\mathrm{cloud}}(\\lambda_{\\mathrm{NIR}}) $ for each instrument, the monthly $ \\rho_{\\mathrm{Red,true}}(t) $ and $ \\rho_{\\mathrm{NIR,true}}(t) $, the effective reflectances $ \\rho_{\\mathrm{Red,eff}}(t) $ and $ \\rho_{\\mathrm{NIR,eff}}(t) $, and then the anomaly metrics. The final output must be a single line containing a list of four lists (one per test case), each inner list holding three floats $ [\\mathrm{RMSA}, \\overline{\\Delta \\mathrm{NDVI}}, \\max|\\Delta \\mathrm{NDVI}|] $ rounded to $ 6 $ decimal places, printed without any additional text.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef cloud_reflectance(lam_um: float) -> float:\n    \"\"\"\n    Cloud reflectance spectrum rho_cloud(lambda) in micrometers.\n    rho_cloud(λ) = 0.55 + 0.10 * tanh((λ - 0.6)/0.2) - 0.08 * exp(- (λ - 0.94)^2 / (2 * 0.02^2))\n    \"\"\"\n    base = 0.55\n    slope = 0.10 * np.tanh((lam_um - 0.6) / 0.2)\n    dip = 0.08 * np.exp(-((lam_um - 0.94) ** 2) / (2.0 * (0.02 ** 2)))\n    return float(base + slope - dip)\n\ndef seasonal_surface_reflectances(T: int = 12):\n    \"\"\"\n    Generate true surface reflectance time series for Red and NIR over T months (t=1..T).\n    rho_NIR_true(t) = 0.40 + 0.15 * sin(2*pi*(t-1)/12)\n    rho_Red_true(t) = 0.08 - 0.03 * sin(2*pi*(t-1)/12)\n    Sine arguments are in radians.\n    \"\"\"\n    t = np.arange(1, T + 1, dtype=float)\n    arg = 2.0 * np.pi * (t - 1.0) / 12.0\n    rho_nir_true = 0.40 + 0.15 * np.sin(arg)\n    rho_red_true = 0.08 - 0.03 * np.sin(arg)\n    return rho_red_true, rho_nir_true\n\ndef ndvi(rho_red: np.ndarray, rho_nir: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Compute NDVI = (NIR - Red) / (NIR + Red) with safe handling to avoid division by zero.\n    \"\"\"\n    denom = rho_nir + rho_red\n    # Small epsilon to avoid numerical issues if denom is extremely small (not expected here).\n    eps = 1e-12\n    return (rho_nir - rho_red) / np.where(np.abs(denom) < eps, np.sign(denom) * eps + (denom == 0) * eps, denom)\n\ndef simulate_anomaly_metrics(lambda_red: float, lambda_nir: float, r: float, alpha: float):\n    \"\"\"\n    For given band center wavelengths (micrometers) and cloud mask parameters (r, alpha),\n    compute anomaly metrics [RMSA, mean_anom, max_abs_anom].\n    \"\"\"\n    # True surface reflectances over 12 months\n    rho_red_true, rho_nir_true = seasonal_surface_reflectances(T=12)\n\n    # Cloud reflectances at band centers\n    rho_cloud_red = cloud_reflectance(lambda_red)\n    rho_cloud_nir = cloud_reflectance(lambda_nir)\n\n    # Effective reflectances under expected contamination\n    # rho_eff = rho_true + r*alpha*(rho_cloud - rho_true) = (1 - r*alpha)*rho_true + r*alpha*rho_cloud\n    factor = r * alpha\n    rho_red_eff = (1.0 - factor) * rho_red_true + factor * rho_cloud_red\n    rho_nir_eff = (1.0 - factor) * rho_nir_true + factor * rho_cloud_nir\n\n    # NDVI time series\n    ndvi_true = ndvi(rho_red_true, rho_nir_true)\n    ndvi_obs = ndvi(rho_red_eff, rho_nir_eff)\n\n    # Anomalies\n    delta = ndvi_obs - ndvi_true\n\n    # Metrics\n    rmsa = float(np.sqrt(np.mean(delta ** 2)))\n    mean_anom = float(np.mean(delta))\n    max_abs_anom = float(np.max(np.abs(delta)))\n\n    return [rmsa, mean_anom, max_abs_anom]\n\ndef format_results(list_of_triplets):\n    \"\"\"\n    Format as a single-line string: [[a11,a12,a13],[a21,a22,a23],...]\n    Each float rounded to 6 decimal places.\n    \"\"\"\n    def fmt_triplet(trip):\n        return \"[\" + \",\".join(f\"{x:.6f}\" for x in trip) + \"]\"\n    return \"[\" + \",\".join(fmt_triplet(trip) for trip in list_of_triplets) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (lambda_red [um], lambda_nir [um], r, alpha)\n    test_cases = [\n        (0.655, 0.865, 0.3, 0.5),   # Case 1: Landsat 8 OLI\n        (0.665, 0.842, 0.1, 0.3),   # Case 2: Sentinel-2 MSI\n        (0.645, 0.858, 0.0, 0.7),   # Case 3: MODIS, r=0 boundary\n        (0.645, 0.858, 1.0, 1.0),   # Case 4: MODIS, extreme\n    ]\n\n    results = []\n    for lam_r, lam_n, r, alpha in test_cases:\n        metrics = simulate_anomaly_metrics(lam_r, lam_n, r, alpha)\n        results.append(metrics)\n\n    # Final print statement in the exact required format.\n    print(format_results(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}