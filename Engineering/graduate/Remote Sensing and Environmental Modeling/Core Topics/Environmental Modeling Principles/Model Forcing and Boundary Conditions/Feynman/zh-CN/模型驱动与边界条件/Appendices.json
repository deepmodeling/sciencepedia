{
    "hands_on_practices": [
        {
            "introduction": "本练习探讨了控制双曲型方程（如平流方程）边界条件的基本原理。我们将运用特征线法来理解为何必须在流入边界指定条件，而在流出边界则不能，从而将信息流动的物理过程与数学公式直接联系起来。通过求解一个经典的示踪剂输运问题，你将亲身体验这一核心概念。",
            "id": "3828052",
            "problem": "一个一维被动示踪场 $u(x,t)$ 沿长度为 $L$ 的平直海岸段演变，其模型是在时空域 $x \\in [0,L]$, $t \\ge 0$ 上的线性平流方程 $u_t + c\\,u_x = 0$。恒定的沿岸流速 $c$ 由现场流速计测得，一个卫星派生的时间序列提供了在该海岸段上游端的边界强迫。在用于环境模拟和遥感数据同化的双曲型偏微分方程背景下，模型强迫是通过适当的特征变量施加在边界上的，对于标量平流方程，这些特征变量与黎曼不变量重合。\n\n从守恒律形式和基本定义出发，通过识别和指定入射的黎曼不变量，推导在流入边界上施加的正确边界条件。利用特征结构和依赖域，论证为什么在流出边界上不需要边界条件。\n\n然后，考虑具体情况：$L = 3000\\ \\mathrm{m}$，$c = 1.5\\ \\mathrm{m\\,s^{-1}}$，初始条件为 $u(x,0) = \\exp\\!\\big(-\\frac{(x-600\\ \\mathrm{m})^2}{2\\,(150\\ \\mathrm{m})^2}\\big)$（对于 $x \\in [0,L]$），流入边界 $x=0$ 处的边界强迫为 $u(0,t) = 2\\cos\\!\\big(\\frac{\\pi}{400}\\,t\\big)$（对于 $t \\ge 0$）。将 $u$ 视为无量纲量。计算在查询点 $(x^\\ast,t^\\ast) = (1800\\ \\mathrm{m}, 2000\\ \\mathrm{s})$ 处的 $u$ 值。\n\n提供 $u(x^\\ast,t^\\ast)$ 的最终值，该值应为无单位的纯数。如果决定近似计算，请四舍五入到四位有效数字。",
            "solution": "该问题陈述具有科学依据，是适定且客观的。它描述了一个一维线性平流方程的标准初边值问题，这是输运现象中的一个基本模型。所有参数和函数都定义清晰且一致。因此，我们可以进行完整求解。\n\n该问题分为两部分：关于双曲型方程边界条件的一般理论推导，以及基于给定数据的具体计算。\n\n**第一部分：边界条件和特征线的一般理论**\n\n被动示踪剂浓度 $u(x,t)$ 的控制偏微分方程(PDE)是线性平流方程：\n$$u_t + c\\,u_x = 0$$\n其中 $u_t = \\frac{\\partial u}{\\partial t}$，$u_x = \\frac{\\partial u}{\\partial x}$。这是一个一阶双曲型偏微分方程。此类方程的行为由信息沿特征曲线的传播所决定。\n\n特征曲线是 $(x,t)$ 平面中的一条路径，沿此路径，偏微分方程可以简化为常微分方程(ODE)。如果我们将一条曲线用参数 $s$ 表示为 $(x(s), t(s))$，那么 $u$ 沿此曲线的全导数为：\n$$\\frac{du}{ds} = \\frac{\\partial u}{\\partial t}\\frac{dt}{ds} + \\frac{\\partial u}{\\partial x}\\frac{dx}{ds}$$\n与偏微分方程进行比较，我们可以选择特征方程为：\n$$\\frac{dt}{ds} = 1, \\quad \\frac{dx}{ds} = c, \\quad \\frac{du}{ds} = 0$$\n从前两个方程，我们得到 $(x,t)$ 平面中特征曲线的斜率：\n$$\\frac{dx}{dt} = c$$\n由于 $c$ 是常数，这些曲线是直线。对该方程积分可得：\n$$x - ct = k$$\n其中 $k$ 是标记每条独立特征线的常数。第三个特征方程 $\\frac{du}{ds} = 0$ 表明，解 $u$ 沿着这些特征线是恒定的。因此，由 $u$ 的值所代表的信息，是沿着这些线传播的。\n\n对于双曲型系统，黎曼不变量是一个沿特征曲线保持不变的量。对于标量平流方程，解 $u$ 本身是唯一的黎曼不变量。\n\n边界条件的设定取决于信息传播相对于区域边界的方向。问题陈述中 $c$ 是一个正常数，代表沿岸流。因此，我们可以不失一般性地假设 $c > 0$。这意味着特征线 $x = ct + k$ 在 $(t,x)$ 平面中具有正斜率（或在 $(x,t)$ 平面中为 $1/c$），表明信息沿 $x$ 增大的方向传播。\n\n考虑空间域 $x \\in [0,L]$。\n1.  **流入边界 ($x=0$)：** 在此边界，特征线 $x = c(t-t_0)$（始于 $(0, t_0)$）进入区域。沿任意一条此类特征线的 $u$ 值由其进入区域那一点的值决定。为了在区域内求解该问题，必须在 $t > 0$ 的所有时刻指定此边界上的 $u$ 值。这在物理上等同于知道被水流带入区域的示踪剂浓度。因此，需要一个形如 $u(0,t) = g(t)$ 的边界条件。指定 $u(0,t)$ 的行为，正是在流入边界上指定入射的黎曼不变量（$u$）。\n\n2.  **流出边界 ($x=L$)：** 在此边界，特征线离开区域。区域内部任意点 $(x,t)$ 的依赖域由其特征线起源的边界上的单个点构成。对于 $c > 0$，这个起源点总是在 $x_0 \\le x$ 和 $t_0 \\le t$ 的位置。具体来说，穿过任意点 $(x,t)$ 的特征线可以追溯到初始线（$t=0$ 处的点 $x_0 = x - ct > 0$）或流入边界（$x=0$ 处的时刻 $t_0 = t - x/c > 0$）。在这两种情况下，依赖域都不包含 $x=L$ 处的流出边界。流出边界上 $u$ 的值是由从区域内部传播过来的值决定的。在 $x=L$ 处施加一个条件将是试图指定一个已经被确定的值，这通常会过度约束系统，导致解不存在或不连续。因此，在流出边界上不需要也不允许有任何边界条件。\n\n**第二部分：具体计算**\n\n我们得到以下具体情况：\n-   海岸段长度: $L = 3000 \\ \\mathrm{m}$\n-   流速: $c = 1.5 \\ \\mathrm{m\\,s^{-1}}$\n-   初始条件: $u(x,0) = \\exp\\left(-\\frac{(x-600)^2}{2 \\cdot 150^2}\\right)$，对于 $x \\in [0, 3000]$\n-   流入边界 ($x=0$) 处的边界条件: $u(0,t) = 2\\cos\\left(\\frac{\\pi}{400}t\\right)$，对于 $t \\ge 0$\n-   查询点: $(x^\\ast, t^\\ast) = (1800 \\ \\mathrm{m}, 2000 \\ \\mathrm{s})$\n\n我们需要求出 $u(x^\\ast, t^\\ast)$ 的值。如前所述，$u$ 的值沿着穿过点 $(x^\\ast, t^\\ast)$ 的特征线是恒定的。该特征线的方程为 $x - ct = k$，其中常数 $k$ 由查询点确定：\n$$k = x^\\ast - c t^\\ast = 1800 - (1.5)(2000) = 1800 - 3000 = -1200$$\n所以，特征线方程是 $x - 1.5t = -1200$。\n\n为了找到这条线上的 $u$ 值，我们必须将其追溯到它在解域边界（即 $t=0$ 或 $x=0$ 处）的起点。\n-   与初始线 ($t=0$) 的交点：\n    $$x - 1.5(0) = -1200 \\implies x = -1200 \\ \\mathrm{m}$$\n    此点在空间域 $x \\in [0, 3000]$ 之外，因此查询点的值不是由初始条件决定的。\n\n-   与流入边界 ($x=0$) 的交点：\n    $$0 - 1.5t = -1200 \\implies 1.5t = 1200 \\implies t = \\frac{1200}{1.5} = 800 \\ \\mathrm{s}$$\n    交点是 $(0, 800)$。此点位于指定了边界条件的流入边界上。\n\n由于 $u$ 的值沿特征线守恒，查询点 $(1800, 2000)$ 的值必须与边界点 $(0, 800)$ 的值相同。\n$$u(1800, 2000) = u(0, 800)$$\n我们使用给定的边界强迫函数 $u(0,t) = 2\\cos\\left(\\frac{\\pi}{400}t\\right)$，并在 $t = 800$ 处求值：\n$$u(0, 800) = 2\\cos\\left(\\frac{\\pi}{400} \\cdot 800\\right) = 2\\cos(2\\pi)$$\n$2\\pi$ 的余弦值为 $1$。因此：\n$$u(1800, 2000) = 2 \\times 1 = 2$$\n在指定点和时刻，示踪场的值恰好为 $2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "从理论转向实践，本练习将处理如何使用有限差分法对抛物型方程（如扩散方程）的边界条件进行数值处理。你将学习并实现“幽灵单元”这一处理导数边界条件（诺伊曼条件）的通用技术。此外，我们将利用“人造解方法”(Method of Manufactured Solutions) 来验证我们的代码实现是否达到了预期的精度，这是确保数值模型可靠性的关键一步。",
            "id": "3828127",
            "problem": "考虑一维热方程（一种线性抛物型偏微分方程 (PDE)），其定义在区域 $[0,L]$ 上，具有恒定的扩散系数 $D$，由 $u_t = D\\,u_{xx}$ 给出。在环境建模中，边界条件代表在区域边界上的模型驱动（例如，来自遥感的表面温度对应狄利克雷条件，或来自能量平衡的表面通量对应诺伊曼条件）。您必须实现 $u_{xx}$ 的二阶有限差分 (FD) 空间离散化，并使用“幽灵单元”(ghost cells)来施加边界条件。然后，使用一个构造的光滑、无量纲的解析解 $u(x)$，推导并验证边界节点上的截断误差。\n\n您将使用由网格节点 $i$ 处的标准二阶中心差分定义的半离散空间算子（离散拉普拉斯算子）：\n$$\n\\mathcal{L}_h[u]_i \\equiv \\frac{u_{i+1} - 2u_i + u_{i-1}}{\\Delta x^2},\n$$\n网格是均匀的，$x_i = i\\,\\Delta x$，$i=0,1,\\dots,N$，且 $\\Delta x = L/N$。对于边界处理，使用位于 $i=-1$ 和 $i=N+1$ 处编码了边界条件的幽灵单元。\n\n使用幽灵单元实现边界条件：\n- 在 $x=0$ 处的狄利克雷条件：$u(0,t) = g_L(t)$。为在内部节点计算 $\\mathcal{L}_h$，使用精确的边界值 $u_0 = g_L(t)$；在 $i=1$ 处计算 $\\mathcal{L}_h$ 不需要幽灵单元。类似地，在 $x=L$ 处的狄利克雷条件：$u(L,t) = g_R(t)$ 意味着 $u_N = g_R(t)$；在 $i=N-1$ 处计算 $\\mathcal{L}_h$ 不需要幽灵单元。\n- 在 $x=0$ 处的诺伊曼条件：$u_x(0,t) = q_L(t)$。使用一个左侧幽灵单元，通过二阶中心差分导数来施加此条件：\n$$\n\\frac{u_1 - u_{-1}}{2\\,\\Delta x} = q_L(t) \\quad \\Rightarrow \\quad u_{-1} = u_1 - 2\\,\\Delta x\\,q_L(t).\n$$\n使用这个 $u_{-1}$ 在边界节点 $i=0$ 处计算 $\\mathcal{L}_h$。\n- 在 $x=L$ 处的诺伊曼条件：$u_x(L,t) = q_R(t)$。使用一个右侧幽灵单元来施加此条件：\n$$\n\\frac{u_{N+1} - u_{N-1}}{2\\,\\Delta x} = q_R(t) \\quad \\Rightarrow \\quad u_{N+1} = u_{N-1} + 2\\,\\Delta x\\,q_R(t).\n$$\n使用这个 $u_{N+1}$ 在边界节点 $i=N$ 处计算 $\\mathcal{L}_h$。\n\n用于验证的构造解析解（无量纲）：\n$$\nu(x) = e^{x} + \\sin(2x), \\quad u_x(x) = e^{x} + 2\\cos(2x), \\quad u_{xx}(x) = e^{x} - 4\\sin(2x).\n$$\n这一致地定义了边界驱动：对于狄利克雷条件，$g_L(t) = u(0)$ 或 $g_R(t) = u(L)$；对于诺伊曼条件，$q_L(t) = u_x(0)$ 或 $q_R(t) = u_x(L)$。\n\n目标：对于每种指定的边界情景，通过将精确解 $u(x)$ 代入离散算子，计算指定边界相关节点上离散拉普拉斯算子的局部截断误差：\n$$\n\\text{TE}(x_i; \\Delta x) \\equiv \\mathcal{L}_h[u]_i - u_{xx}(x_i).\n$$\n您将通过计算比率来凭经验验证收敛阶：\n$$\nR \\equiv \\frac{\\big|\\text{TE}(x_i; \\Delta x)\\big|}{\\big|\\text{TE}(x_i; \\Delta x/2)\\big|}.\n$$\n对于二阶精度的截断误差，$R$ 应趋近于 $4$；对于一阶精度的截断误差，$R$ 应趋近于 $2$。\n\n单位：在此验证任务中，所有量都是无量纲的。正弦和余弦函数中的角度以弧度为单位。\n\n测试套件规范（每个测试用例返回一个浮点数 $R$）：\n- 测试用例 1（左狄利克雷，右狄利克雷）：$L = 1$, $N_{\\text{coarse}} = 20$, $N_{\\text{fine}} = 40$。在左边界相邻节点 $i=1$ 处计算 $\\text{TE}$。\n- 测试用例 2（左诺伊曼，右狄利克雷）：$L = 1$, $N_{\\text{coarse}} = 20$, $N_{\\text{fine}} = 40$。使用由 $q_L$ 构成的幽灵单元 $u_{-1}$ 在左边界节点 $i=0$ 处计算 $\\text{TE}$。\n- 测试用例 3（左狄利克雷，右诺伊曼）：$L = 1$, $N_{\\text{coarse}} = 20$, $N_{\\text{fine}} = 40$。使用由 $q_R$ 构成的幽灵单元 $u_{N+1}$ 在右边界节点 $i=N$ 处计算 $\\text{TE}$。\n\n您的程序必须：\n- 实现上述离散算子和幽灵单元边界条件。\n- 对每个测试用例，计算定义的比率 $R$。\n- 生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，“[$r_1,$ $r_2,$ $r_3$]”）。\n\n不允许外部输入；将上述参数硬编码。最终输出必须是数值浮点数。",
            "solution": "用户提供了一个来自数值分析领域的有效、适定的问题陈述，具体涉及偏微分方程有限差分格式的验证。\n\n目标是确定拉普拉斯算子 ($u_{xx}$) 的二阶中心差分近似在一维区域边界处及附近的精度阶。这是通过计算已知解析函数（即构造解法）的局部截断误差 (TE) 来实现的。然后通过计算在连续加密的网格上的截断误差之比，来凭经验验证收敛阶。\n\n构造的解析解及其导数如下：\n$$\nu(x) = e^{x} + \\sin(2x)\n$$\n$$\nu_x(x) = e^{x} + 2\\cos(2x)\n$$\n$$\nu_{xx}(x) = e^{x} - 4\\sin(2x)\n$$\n在网格节点 $x_i = i\\Delta x$ 处的离散拉普拉斯算子是：\n$$\n\\mathcal{L}_h[u]_i = \\frac{u_{i+1} - 2u_i + u_{i-1}}{\\Delta x^2}\n$$\n局部截断误差定义为将精确解代入有限差分格式时产生的余项：\n$$\n\\text{TE}(x_i; \\Delta x) = \\mathcal{L}_h[u(x)]_i - u_{xx}(x_i)\n$$\n用于验证收敛阶 $p$ 的比率 $R$（其中 $\\text{TE} \\propto (\\Delta x)^p$）是：\n$$\nR = \\frac{|\\text{TE}(x_i; \\Delta x)|}{|\\text{TE}(x_i; \\Delta x/2)|} \\approx \\frac{|C(\\Delta x)^p|}{|C(\\Delta x/2)^p|} = 2^p\n$$\n对于一阶精度方法 ($p=1$)，我们预期 $R \\approx 2$。对于二阶精度方法 ($p=2$)，我们预期 $R \\approx 4$。\n\n现在我们来分析每个测试用例。\n\n**测试用例 1：狄利克雷-狄利克雷边界条件，在内部节点 $i=1$ 处求值。**\n截断误差在节点 $x_1 = \\Delta x$ 处计算，该节点与左边界 $x_0=0$ 相邻。离散算子为：\n$$\n\\mathcal{L}_h[u]_1 = \\frac{u_2 - 2u_1 + u_0}{\\Delta x^2}\n$$\n由于这是一个使用解析解的验证练习，我们在网格点上使用精确的函数值：$u_j = u(x_j)$。通过使用 $u_0 = u(x_0)$，在 $x_0=0$ 处的狄利克雷条件被隐式满足。\n为了找到截断误差，我们在点 $x_1$ 周围对 $u(x_2) = u(x_1 + \\Delta x)$ 和 $u(x_0) = u(x_1 - \\Delta x)$ 进行泰勒级数展开：\n$$\nu(x_1 \\pm \\Delta x) = u(x_1) \\pm u_x(x_1)\\Delta x + \\frac{u_{xx}(x_1)}{2!}\\Delta x^2 \\pm \\frac{u_{xxx}(x_1)}{3!}\\Delta x^3 + \\frac{u^{(4)}(x_1)}{4!}\\Delta x^4 \\pm \\dots\n$$\n将这些代入 $\\mathcal{L}_h[u]_1$ 的表达式中：\n$$\n\\mathcal{L}_h[u]_1 = \\frac{1}{\\Delta x^2} \\left[ (u(x_1) + u_x(x_1)\\Delta x + \\dots) - 2u(x_1) + (u(x_1) - u_x(x_1)\\Delta x + \\dots) \\right]\n$$\n奇次幂项相互抵消，剩下：\n$$\n\\mathcal{L}_h[u]_1 = \\frac{1}{\\Delta x^2} \\left[ 2\\left(\\frac{u_{xx}(x_1)\\Delta x^2}{2}\\right) + 2\\left(\\frac{u^{(4)}(x_1)\\Delta x^4}{24}\\right) + \\mathcal{O}(\\Delta x^6) \\right] = u_{xx}(x_1) + \\frac{u^{(4)}(x_1)}{12}\\Delta x^2 + \\mathcal{O}(\\Delta x^4)\n$$\n截断误差是：\n$$\n\\text{TE}(x_1; \\Delta x) = \\mathcal{L}_h[u]_1 - u_{xx}(x_1) = \\frac{u^{(4)}(x_1)}{12}\\Delta x^2 + \\mathcal{O}(\\Delta x^4)\n$$\n这是一个二阶精度的近似，$\\text{TE} = \\mathcal{O}(\\Delta x^2)$。因此，我们预期比率 $R_1$ 约等于 $4$。\n\n**测试用例 2：左边界诺伊曼条件，在边界节点 $i=0$ 处求值。**\n在 $x_0=0$ 处的离散算子需要一个幽灵单元值 $u_{-1}$：\n$$\n\\mathcal{L}_h[u]_0 = \\frac{u_1 - 2u_0 + u_{-1}}{\\Delta x^2}\n$$\n诺伊曼条件 $u_x(0) = q_L$ 通过一个涉及幽灵单元的二阶中心差分来施加：\n$$\n\\frac{u_1 - u_{-1}}{2\\Delta x} = q_L \\implies u_{-1} = u_1 - 2\\Delta x q_L\n$$\n将幽灵单元值代入离散拉普拉斯算子：\n$$\n\\mathcal{L}_h[u]_0 = \\frac{u_1 - 2u_0 + (u_1 - 2\\Delta x q_L)}{\\Delta x^2} = \\frac{2u_1 - 2u_0 - 2\\Delta x q_L}{\\Delta x^2}\n$$\n为了验证，我们使用精确解：$u_1=u(x_1)=u(\\Delta x)$，$u_0=u(x_0)=u(0)$，以及 $q_L=u_x(0)$。\n$$\n\\mathcal{L}_h[u]_0 = \\frac{2u(\\Delta x) - 2u(0) - 2\\Delta x u_x(0)}{\\Delta x^2}\n$$\n我们在 $x=0$ 周围将 $u(\\Delta x)$ 展开为泰勒级数：\n$$\nu(\\Delta x) = u(0) + u_x(0)\\Delta x + \\frac{u_{xx}(0)}{2}\\Delta x^2 + \\frac{u_{xxx}(0)}{6}\\Delta x^3 + \\mathcal{O}(\\Delta x^4)\n$$\n将此代入算子：\n$$\n\\mathcal{L}_h[u]_0 = \\frac{2(u(0) + u_x(0)\\Delta x + \\frac{u_{xx}(0)}{2}\\Delta x^2 + \\frac{u_{xxx}(0)}{6}\\Delta x^3 + \\mathcal{O}(\\Delta x^4)) - 2u(0) - 2\\Delta x u_x(0)}{\\Delta x^2}\n$$\n$$\n\\mathcal{L}_h[u]_0 = \\frac{ u_{xx}(0)\\Delta x^2 + \\frac{u_{xxx}(0)}{3}\\Delta x^3 + \\mathcal{O}(\\Delta x^4) }{\\Delta x^2} = u_{xx}(0) + \\frac{u_{xxx}(0)}{3}\\Delta x + \\mathcal{O}(\\Delta x^2)\n$$\n截断误差是：\n$$\n\\text{TE}(x_0; \\Delta x) = \\mathcal{L}_h[u]_0 - u_{xx}(0) = \\frac{u_{xxx}(0)}{3}\\Delta x + \\mathcal{O}(\\Delta x^2)\n$$\n这个近似只是一阶精度的，$\\text{TE} = \\mathcal{O}(\\Delta x)$。我们预期比率 $R_2$ 约等于 $2$。\n\n**测试用例 3：右边界诺伊曼条件，在边界节点 $i=N$ 处求值。**\n分析与案例 2 对称。在 $x_N=L$ 处的算子使用一个幽灵单元 $u_{N+1}$：\n$$\n\\mathcal{L}_h[u]_N = \\frac{u_{N+1} - 2u_N + u_{N-1}}{\\Delta x^2}\n$$\n诺伊曼条件 $u_x(L) = q_R$ 给出幽灵单元值：\n$$\n\\frac{u_{N+1} - u_{N-1}}{2\\Delta x} = q_R \\implies u_{N+1} = u_{N-1} + 2\\Delta x q_R\n$$\n代入拉普拉斯算子并使用精确值 ($u_j = u(x_j)=u(L+(j-N)\\Delta x)$, $q_R=u_x(L)$)：\n$$\n\\mathcal{L}_h[u]_N = \\frac{2u(L-\\Delta x) - 2u(L) + 2\\Delta x u_x(L)}{\\Delta x^2}\n$$\n在 $x=L$ 周围展开 $u(L-\\Delta x)$：\n$$\nu(L-\\Delta x) = u(L) - u_x(L)\\Delta x + \\frac{u_{xx}(L)}{2}\\Delta x^2 - \\frac{u_{xxx}(L)}{6}\\Delta x^3 + \\mathcal{O}(\\Delta x^4)\n$$\n将此代入算子：\n$$\n\\mathcal{L}_h[u]_N = \\frac{2(u(L) - u_x(L)\\Delta x + \\frac{u_{xx}(L)}{2}\\Delta x^2 - \\frac{u_{xxx}(L)}{6}\\Delta x^3 + \\dots) - 2u(L) + 2\\Delta x u_x(L)}{\\Delta x^2}\n$$\n$$\n\\mathcal{L}_h[u]_N = \\frac{ u_{xx}(L)\\Delta x^2 - \\frac{u_{xxx}(L)}{3}\\Delta x^3 + \\mathcal{O}(\\Delta x^4) }{\\Delta x^2} = u_{xx}(L) - \\frac{u_{xxx}(L)}{3}\\Delta x + \\mathcal{O}(\\Delta x^2)\n$$\n截断误差是：\n$$\n\\text{TE}(x_N; \\Delta x) = \\mathcal{L}_h[u]_N - u_{xx}(L) = -\\frac{u_{xxx}(L)}{3}\\Delta x + \\mathcal{O}(\\Delta x^2)\n$$\n这个近似也是一阶精度的，$\\text{TE} = \\mathcal{O}(\\Delta x)$。我们预期比率 $R_3$ 约等于 $2$。\n\nPython 代码将实现这些计算，以找到 $R_1, R_2, R_3$ 的数值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# --- Manufactured Analytic Solution and its Derivatives ---\ndef u_analytic(x):\n    \"\"\"Analytic solution u(x).\"\"\"\n    return np.exp(x) + np.sin(2 * x)\n\ndef ux_analytic(x):\n    \"\"\"First derivative u_x(x).\"\"\"\n    return np.exp(x) + 2 * np.cos(2 * x)\n\ndef uxx_analytic(x):\n    \"\"\"Second derivative u_xx(x).\"\"\"\n    return np.exp(x) - 4 * np.sin(2 * x)\n\ndef calculate_te(L, N, case_type):\n    \"\"\"\n    Calculates the local truncation error for a given case configuration.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of grid intervals.\n        case_type (int): The test case number (1, 2, or 3).\n\n    Returns:\n        float: The calculated local truncation error.\n    \"\"\"\n    dx = L / N\n\n    if case_type == 1:\n        # Case 1: Dirichlet-Dirichlet, TE at i=1\n        # Grid points needed: x_0, x_1, x_2\n        # The node of interest is x_1\n        i = 1\n        x_i = i * dx\n        x_im1 = (i - 1) * dx\n        x_ip1 = (i + 1) * dx\n\n        # Values of u from the analytic solution\n        u_i = u_analytic(x_i)\n        u_im1 = u_analytic(x_im1) # This is the boundary value u(0)\n        u_ip1 = u_analytic(x_ip1)\n\n        # Discrete and exact Laplacians\n        lap_h = (u_ip1 - 2 * u_i + u_im1) / (dx**2)\n        lap_exact = uxx_analytic(x_i)\n\n        return lap_h - lap_exact\n\n    elif case_type == 2:\n        # Case 2: Neumann-Left, TE at i=0\n        # The node of interest is x_0\n        i = 0\n        x_i = i * dx # x_0 = 0\n        x_ip1 = (i + 1) * dx # x_1\n\n        # Values of u from the analytic solution\n        u_i = u_analytic(x_i)\n        u_ip1 = u_analytic(x_ip1)\n\n        # Neumann boundary condition value q_L = u_x(0)\n        q_L = ux_analytic(x_i)\n\n        # Ghost cell value u_{-1}\n        u_im1_ghost = u_ip1 - 2 * dx * q_L\n\n        # Discrete and exact Laplacians at x_0\n        lap_h = (u_ip1 - 2 * u_i + u_im1_ghost) / (dx**2)\n        lap_exact = uxx_analytic(x_i)\n\n        return lap_h - lap_exact\n\n    elif case_type == 3:\n        # Case 3: Neumann-Right, TE at i=N\n        # The node of interest is x_N = L\n        i = N\n        x_i = i * dx # x_N = L\n        x_im1 = (i - 1) * dx # x_{N-1}\n\n        # Values of u from the analytic solution\n        u_i = u_analytic(x_i)\n        u_im1 = u_analytic(x_im1)\n\n        # Neumann boundary condition value q_R = u_x(L)\n        q_R = ux_analytic(x_i)\n\n        # Ghost cell value u_{N+1}\n        u_ip1_ghost = u_im1 + 2 * dx * q_R\n        \n        # Discrete and exact Laplacians at x_N\n        lap_h = (u_ip1_ghost - 2 * u_i + u_im1) / (dx**2)\n        lap_exact = uxx_analytic(x_i)\n\n        return lap_h - lap_exact\n    \n    else:\n        raise ValueError(\"Invalid case_type specified.\")\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N_coarse, N_fine, case_type)\n        (1.0, 20, 40, 1), # Case 1: D-D, at i=1\n        (1.0, 20, 40, 2), # Case 2: N-D, at i=0\n        (1.0, 20, 40, 3)  # Case 3: D-N, at i=N\n    ]\n\n    results = []\n    for L, N_coarse, N_fine, case_type in test_cases:\n        # Calculate truncation error for coarse grid\n        te_coarse = calculate_te(L, N_coarse, case_type)\n        \n        # Calculate truncation error for fine grid\n        te_fine = calculate_te(L, N_fine, case_type)\n        \n        # Calculate the ratio R. Handle potential division by zero.\n        if abs(te_fine)  1e-15:\n             # If fine error is virtually zero, ratio is effectively infinite or undefined.\n             # This shouldn't happen for this problem, but is good practice.\n            R = float('inf') \n        else:\n            R = abs(te_coarse) / abs(te_fine)\n        \n        results.append(R)\n\n    # Final print statement in the exact required format.\n    print(_format_results(results))\n\ndef _format_results(results):\n    \"\"\"\n    Formats the list of float results into the required string format \"[r1,r2,r3]\".\n    e.g., [4.000001,2.000001,2.000001]\n    Note: The problem's example `[r1, r2, r3]` has spaces, while other parts of the\n    template imply no spaces. Adhering to the no-space format which is more\n    common for programmatic output.\n    \"\"\"\n    return f\"[{','.join(map(str, results))}]\"\n\nsolve()\n```"
        },
        {
            "introduction": "最后的练习介绍了一种被广泛应用的数值框架——有限体积法，该方法的核心优势在于其内在的守恒性。你将学习如何将诺伊曼边界条件转化为边界界面上协调的数值通量。此过程需要精确地处理平流和扩散这两个输运过程，以保证模型在物理上是守恒的。",
            "id": "3828100",
            "problem": "考虑在有限体积法（FVM, Finite Volume Method）中，一个标量浓度场的一维守恒输运。其中，计算域被离散为宽度为 $\\Delta x$ 的均匀控制体，左边界位于 $x=0$。未知量是单元平均浓度 $u$，单位为 $\\mathrm{kg}/\\mathrm{m}^3$。总物理通量 $F(u)$（单位为 $\\mathrm{kg}/(\\mathrm{m}^2\\cdot\\mathrm{s})$）是结合了对流和扩散的通量，由一个对流项和一个扩散项相加而成。对流速度 $a$ 的单位是 $\\mathrm{m}/\\mathrm{s}$，扩散系数 $\\kappa$ 的单位是 $\\mathrm{m}^2/\\mathrm{s}$。在左边界上给定了一个诺伊曼 (Neumann) 边界条件，指定了在 $x=0$ 处的空间导数 $\\partial u/\\partial x$，记为 $g$，单位为 $\\mathrm{kg}/\\mathrm{m}^4$。\n\n从积分守恒律和面上通量连续性的定义出发，推导一个在第一个单元的左边界上保证守恒的一致性数值通量 $\\hat{F}(u)$。请使用以下建模和离散化假设：\n\n- 控制方程是一个标准的守恒律，写为在一个控制体上的积分形式，其法向通量必须通过计算来确保守恒。\n- 诺伊曼 (Neumann) 边界条件指定了边界上的 $\\partial u/\\partial x$；请从物理上将其解释为对通量扩散分量的约束。\n- 对于扩散项，通过构建一个与边界相邻的虚拟单元状态，并使用与给定导数一致的边界上梯度的二阶中心近似，来施加诺伊曼 (Neumann) 边界条件。\n- 对于对流项，根据对流速度 $a$ 的符号，在边界面上使用一阶迎风格式数值通量。需要认识到上游状态可能位于计算域之外，当左边界处 $a0$ 时，必须用虚拟单元来表示。\n- 边界面上的总数值通量是对流数值通量和扩散数值通量之和，方向为正 $x$ 方向。\n\n您的程序必须实现所推导的数值通量函数，并计算下述每个测试案例的 $\\hat{F}(u)$。将每个最终通量以 $\\mathrm{kg}/(\\mathrm{m}^2\\cdot\\mathrm{s})$ 为单位表示，并四舍五入到六位小数。\n\n测试套件：\n- 案例 A (理想情况，纯扩散): $u_1=1.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $\\Delta x=10\\,\\mathrm{m}$, $a=0.0\\,\\mathrm{m}/\\mathrm{s}$, $\\kappa=5\\times 10^{-3}\\,\\mathrm{m}^2/\\mathrm{s}$, $g=2.0\\times 10^{-2}\\,\\mathrm{kg}/\\mathrm{m}^4$。\n- 案例 B (入流对流扩散，小负梯度): $u_1=3.0\\times 10^{-1}\\,\\mathrm{kg}/\\mathrm{m}^3$, $\\Delta x=5.0\\times 10^{2}\\,\\mathrm{m}$, $a=5.0\\times 10^{-2}\\,\\mathrm{m}/\\mathrm{s}$, $\\kappa=1.0\\times 10^{-4}\\,\\mathrm{m}^2/\\mathrm{s}$, $g=-1.0\\times 10^{-5}\\,\\mathrm{kg}/\\mathrm{m}^4$。\n- 案例 C (出流对流扩散，正梯度): $u_1=2.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $\\Delta x=1.0\\times 10^{2}\\,\\mathrm{m}$, $a=-1.0\\times 10^{-1}\\,\\mathrm{m}/\\mathrm{s}$, $\\kappa=2.0\\times 10^{-3}\\,\\mathrm{m}^2/\\mathrm{s}$, $g=1.0\\times 10^{-3}\\,\\mathrm{kg}/\\mathrm{m}^4$。\n- 案例 D (零梯度，入流对流): $u_1=0.0\\,\\mathrm{kg}/\\mathrm{m}^3$, $\\Delta x=1.0\\,\\mathrm{m}$, $a=1.0\\,\\mathrm{m}/\\mathrm{s}$, $\\kappa=1.0\\times 10^{-2}\\,\\mathrm{m}^2/\\mathrm{s}$, $g=0.0\\,\\mathrm{kg}/\\mathrm{m}^4$。\n- 案例 E (仅对流入流，零扩散): $u_1=5.0\\times 10^{-1}\\,\\mathrm{kg}/\\mathrm{m}^3$, $\\Delta x=2.0\\times 10^{1}\\,\\mathrm{m}$, $a=2.0\\times 10^{-1}\\,\\mathrm{m}/\\mathrm{s}$, $\\kappa=0.0\\,\\mathrm{m}^2/\\mathrm{s}$, $g=1.0\\times 10^{-2}\\,\\mathrm{kg}/\\mathrm{m}^4$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$\\left[\\text{result}_A,\\text{result}_B,\\text{result}_C,\\text{result}_D,\\text{result}_E\\right]$），每个 $\\text{result}$ 是相应测试案例的四舍五入后的数值通量，单位为 $\\mathrm{kg}/(\\mathrm{m}^2\\cdot\\mathrm{s})$。",
            "solution": "该问题陈述经评估是科学上合理、适定、客观和完整的。所有提供的数据和约束条件都是一致的，并且在物理和数学上是合理的。因此，我们可以进行推导和求解。\n\n目标是推导在一维有限体积法 (FVM) 网格左边界上的数值通量 $\\hat{F}_{1/2}$。该边界位于 $x=0$。计算域被离散为宽度均匀的单元 $\\Delta x$。第一个单元，索引为 $i=1$，覆盖区间 $[0, \\Delta x]$，其单元平均浓度 $u_1$ 的中心位于 $x_1 = \\Delta x/2$。为了处理边界条件，我们引入一个虚拟单元，索引为 $i=0$，其中心位于 $x_0 = -\\Delta x/2$。边界面本身位于 $x_{1/2}=0$，分隔了虚拟单元和第一个内部单元。\n\n总物理通量 $F(u)$ 是对流通量 $F_{adv} = au$ 和扩散通量 $F_{diff} = -\\kappa \\frac{\\partial u}{\\partial x}$ 的和。在单元界面上的总数值通量 $\\hat{F}$ 是数值对流通量 $\\hat{F}_{adv}$ 和数值扩散通量 $\\hat{F}_{diff}$ 的和：\n$$\n\\hat{F}_{1/2} = \\hat{F}_{adv, 1/2} + \\hat{F}_{diff, 1/2}\n$$\n我们将根据问题的具体要求分别推导每个分量。\n\n首先，我们处理扩散通量分量 $\\hat{F}_{diff, 1/2}$。问题在 $x=0$ 处指定了一个诺伊曼 (Neumann) 边界条件，由 $\\frac{\\partial u}{\\partial x} \\big|_{x=0} = g$ 给出。指令要求通过使用边界面上梯度的二阶中心差分近似来强制执行此条件。该近似涉及相邻单元的单元平均值，即 $u_0$（虚拟单元）和 $u_1$（第一个单元）：\n$$\n\\frac{\\partial u}{\\partial x} \\bigg|_{x=0} \\approx \\frac{u_1 - u_0}{x_1 - x_0} = \\frac{u_1 - u_0}{\\Delta x}\n$$\n将此近似值与给定的梯度 $g$ 相等，我们可以定义虚拟单元的状态：\n$$\n\\frac{u_1 - u_0}{\\Delta x} = g \\implies u_0 = u_1 - g \\Delta x\n$$\n这个关于 $u_0$ 的表达式是构建对流通量所必需的，如下所示。对于扩散通量本身，问题陈述要求将诺伊曼 (Neumann) 条件解释为对扩散通量的直接约束。边界上的物理扩散通量为 $F_{diff} \\big|_{x=0} = -\\kappa \\frac{\\partial u}{\\partial x} \\big|_{x=0}$。通过代入给定的边界条件，我们直接得到界面上的数值扩散通量：\n$$\n\\hat{F}_{diff, 1/2} = -\\kappa g\n$$\n该方法是一致的，并直接强制执行了指定的通量条件。如果使用虚拟单元模板来定义一个梯度 $\\frac{u_1-u_0}{\\Delta x}$，然后将其用于通量公式 $-\\kappa\\frac{u_1-u_0}{\\Delta x}$，将得到相同的结果 $-\\kappa g$，这证实了该方法的正确性。\n\n接下来，我们推导对流通量分量 $\\hat{F}_{adv, 1/2}$。问题要求使用一阶迎风格式。该格式选择“迎风”方向的单元平均值来计算通量。方向由对流速度 $a$ 的符号决定。\n- 如果 $a \\ge 0$，流动方向为从左到右（正 $x$ 方向），这是左边界上的入流条件。迎风状态是位于界面 $x_{1/2}=0$ 左侧的状态，即虚拟单元的值 $u_0$。因此，对流通量为：\n  $$\n  \\hat{F}_{adv, 1/2} = a u_0 \\quad (\\text{for } a \\ge 0)\n  $$\n- 如果 $a  0$，流动方向为从右到左（负 $x$ 方向），这是左边界上的出流条件。迎风状态是位于界面右侧的状态，即第一个内部单元的值 $u_1$。对流通量为：\n  $$\n  \\hat{F}_{adv, 1/2} = a u_1 \\quad (\\text{for } a  0)\n  $$\n\n最后，我们将对流和扩散分量相加，综合得到总数值通量 $\\hat{F}_{1/2}$。\n\n情况1：入流 ($a \\ge 0$)\n总通量是入流对流通量和扩散通量之和。我们将虚拟单元值 $u_0 = u_1 - g \\Delta x$ 的表达式代入对流通量项。\n$$\n\\hat{F}_{1/2} = \\hat{F}_{adv, 1/2} + \\hat{F}_{diff, 1/2} = a u_0 - \\kappa g = a(u_1 - g \\Delta x) - \\kappa g\n$$\n\n情况2：出流 ($a  0$)\n总通量是出流对流通量和扩散通量之和。\n$$\n\\hat{F}_{1/2} = \\hat{F}_{adv, 1/2} + \\hat{F}_{diff, 1/2} = a u_1 - \\kappa g\n$$\n\n总之，左边界面上数值通量的完整公式为：\n$$\n\\hat{F}(u_1, \\Delta x, a, \\kappa, g) = \\begin{cases} a (u_1 - g \\Delta x) - \\kappa g  \\text{if } a \\ge 0 \\\\ a u_1 - \\kappa g  \\text{if } a  0 \\end{cases}\n$$\n现在将实施该公式来计算给定测试案例的通量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the numerical flux at the left boundary of a 1D FVM domain\n    for a series of test cases, based on a derived formula for a\n    Neumann boundary condition.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (u1, delta_x, a, kappa, g)\n    test_cases = [\n        # Case A: happy path, pure diffusion\n        (1.0, 10.0, 0.0, 5e-3, 2e-2),\n        # Case B: inflow advection-diffusion, small negative gradient\n        (3.0e-1, 5.0e2, 5.0e-2, 1.0e-4, -1.0e-5),\n        # Case C: outflow advection-diffusion, positive gradient\n        (2.0, 1.0e2, -1.0e-1, 2.0e-3, 1.0e-3),\n        # Case D: zero gradient, inflow advection\n        (0.0, 1.0, 1.0, 1.0e-2, 0.0),\n        # Case E: advective-only inflow, zero diffusion\n        (5.0e-1, 2.0e1, 2.0e-1, 0.0, 1.0e-2),\n    ]\n\n    results = []\n    for case in test_cases:\n        u1, delta_x, a, kappa, g = case\n\n        # The numerical flux at the left boundary is derived as:\n        # F_hat = a * u_upwind - kappa * g\n        # where u_upwind is determined by the sign of 'a'.\n        # For a = 0 (inflow): u_upwind is the ghost cell value u0.\n        #    u0 is defined by the Neumann BC: (u1 - u0) / delta_x = g\n        #    = u0 = u1 - g * delta_x\n        # For a  0 (outflow): u_upwind is the first cell value u1.\n\n        if a >= 0:\n            # Inflow or zero advection case\n            # Flux = a * (u1 - g * delta_x) - kappa * g\n            flux = a * (u1 - g * delta_x) - kappa * g\n        else:\n            # Outflow case\n            # Flux = a * u1 - kappa * g\n            flux = a * u1 - kappa * g\n        \n        results.append(flux)\n\n    # Format the results to 6 decimal places and join into the final string.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    final_output = f\"[{','.join(formatted_results)}]\"\n\n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}