{
    "hands_on_practices": [
        {
            "introduction": "在我们能够对土地利用变化进行建模之前，我们必须首先拥有一种稳健的方法来量化景观的状态。本练习介绍了两种基本描述符：类别比例向量 $p_k$，它定义了景观的构成；以及香农熵 $H$，它为景观的多样性或异质性提供了单一的度量。通过完成这个计算，您将对原始遥感数据如何转化为驱动动态模型的状态变量有一个切实的理解。",
            "id": "3824215",
            "problem": "一幅遥感生成的土地利用和土地覆盖 (LULC) 栅格数据被用来定义景观的组分状态，以进行动态土地变化建模。考虑一个单一图块，它包含一个 $105 \\times 100$ 像素的网格，空间分辨率为 $30\\,\\text{m}$。一个质量控制掩膜将 $500$ 个像素标记为无效 (NoData)，这些像素必须从所有计算中排除。剩余的有效像素被标记为 $K=4$ 个LULC类别，各类别的像素数如下：耕地 $4000$，森林 $3000$，城市 $2000$，水体 $1000$。假设每个有效像素代表相等的面积。将类别比例 $\\{p_{k}\\}_{k=1}^{K}$ 视为这些类别上的一个离散概率质量函数，并将在土地利用和土地覆盖变化建模框架中，把 $\\{p_{k}\\}$ 和使用自然对数计算的相关香农熵都解释为状态描述符。请计算类别比例 $p_{k}$ 和该分布的香农熵（使用自然对数的标准公式），并讨论它们作为离散状态模型的状态描述符的解释。仅报告熵值 $H$，四舍五入到四位有效数字，单位为奈特 (nats)。",
            "solution": "问题陈述已经过验证，是自洽的、科学上合理的且定义明确的。所有提供的数值在内部是一致的。任务是计算给定土地利用和土地覆盖 (LULC) 分布的类别比例和相关的香农熵，并讨论其在土地变化建模框架中的解释。\n\n首先，我们确定栅格图块中有效像素的总数 $N$。该网格的尺寸为 $105 \\times 100$ 像素，总共有 $105 \\times 100 = 10500$ 个像素。问题陈述中提到有 $500$ 个像素被标记为无效 (NoData)。因此，有效像素的数量为：\n$$\nN = 10500 - 500 = 10000\n$$\n问题提供了 $K=4$ 个LULC类别的像素数：$n_1 = 4000$ (耕地)，$n_2 = 3000$ (森林)，$n_3 = 2000$ (城市)，以及 $n_4 = 1000$ (水体)。一致性检查确认这些类别像素数的总和等于有效像素的总数：\n$$\n\\sum_{k=1}^{4} n_k = 4000 + 3000 + 2000 + 1000 = 10000 = N\n$$\n这证实了数据是一致的。\n\n问题要求将类别比例 $\\{p_k\\}_{k=1}^{K}$ 视为一个离散概率质量函数。每个类别 $k$ 的比例计算为该类别中的像素数 $n_k$ 与有效像素总数 $N$ 的比值。\n$$\np_k = \\frac{n_k}{N}\n$$\n我们计算每个类别的比例：\n对于耕地 ($k=1$):\n$$\np_1 = \\frac{4000}{10000} = 0.4\n$$\n对于森林 ($k=2$):\n$$\np_2 = \\frac{3000}{10000} = 0.3\n$$\n对于城市 ($k=3$):\n$$\np_3 = \\frac{2000}{10000} = 0.2\n$$\n对于水体 ($k=4$):\n$$\np_4 = \\frac{1000}{10000} = 0.1\n$$\n根据概率质量函数的要求，这些比例的总和为1：$\\sum_{k=1}^{4} p_k = 0.4 + 0.3 + 0.2 + 0.1 = 1$。\n\n这些比例 $\\{p_k\\}$ 构成一个状态向量 $S = [p_1, p_2, p_3, p_4] = [0.4, 0.3, 0.2, 0.1]$，它描述了观测时刻景观的组分状态。在动态土地变化模型中，该向量代表系统在时间 $t$ 的状态。模型随后将根据一组转移规则模拟该向量向未来状态 $S(t+\\Delta t)$ 的演变。\n\n接下来，我们计算该分布的香农熵 $H$。香农熵衡量由概率分布描述的系统的不确定性或信息复杂性。对于一个有 $K$ 个状态的离散系统，使用自然对数（单位为奈特 nats）的公式是：\n$$\nH = - \\sum_{k=1}^{K} p_k \\ln(p_k)\n$$\n将计算出的比例代入此方程：\n$$\nH = - \\left( p_1 \\ln(p_1) + p_2 \\ln(p_2) + p_3 \\ln(p_3) + p_4 \\ln(p_4) \\right)\n$$\n$$\nH = - \\left( 0.4 \\ln(0.4) + 0.3 \\ln(0.3) + 0.2 \\ln(0.2) + 0.1 \\ln(0.1) \\right)\n$$\n现在我们计算各项的值：\n$$\n0.4 \\ln(0.4) \\approx 0.4 \\times (-0.91629073) \\approx -0.36651629\n$$\n$$\n0.3 \\ln(0.3) \\approx 0.3 \\times (-1.20397280) \\approx -0.36119184\n$$\n$$\n0.2 \\ln(0.2) \\approx 0.2 \\times (-1.60943791) \\approx -0.32188758\n$$\n$$\n0.1 \\ln(0.1) \\approx 0.1 \\times (-2.30258509) \\approx -0.23025851\n$$\n将这些值相加：\n$$\n\\sum p_k \\ln(p_k) \\approx -0.36651629 - 0.36119184 - 0.32188758 - 0.23025851 \\approx -1.27985422\n$$\n因此，熵为：\n$$\nH = -(-1.27985422) \\approx 1.27985422 \\, \\text{nats}\n$$\n作为状态描述符，香农熵 $H$ 提供了一个单一的、标量形式的景观组分多样性度量。它量化了从景观中随机选择一个像素时，预测其LULC类别的不确定性程度。$H=0$ 的值意味着一个完全同质的景观（只有一个类别，$p_k=1$）。对于 $K=4$ 个类别，当所有类别等可能（$p_k = 1/4 = 0.25$）时，熵达到最大可能值，即 $H_{\\text{max}} = \\ln(K) = \\ln(4) \\approx 1.386$ 奈特。计算出的值 $H \\approx 1.280$ 接近此最大值，表明景观具有高度的组分异质性，没有哪个单一类别占绝对主导地位。在动态建模中，追踪 $H(t)$ 可以分析景观层面的趋势，例如多样性增加（破碎化）或多样性减少（均质化）。\n\n问题要求熵值 $H$ 四舍五入到四位有效数字。\n$$\nH \\approx 1.280 \\, \\text{nats}\n$$",
            "answer": "$$\n\\boxed{1.280}\n$$"
        },
        {
            "introduction": "在描述了景观状态之后，建模的下一步是量化状态之间的变化动态。一阶马尔可夫模型是完成此任务的基石，它依赖于一个过渡概率矩阵 $T$。本练习  将引导您完成从观测数据中推导这些概率的基本统计过程，展示最大似然原理如何为基于历史变化校准模型提供一种严谨的方法。",
            "id": "3824196",
            "problem": "一位遥感分析师正在对同一空间域内于时间 $t$ 和 $t+1$ 获取的两幅分类栅格图之间的土地利用和土地覆盖 (LULC) 转换进行建模。假设在时间 $t$ 有 $C$ 个类别，索引为 $i \\in \\{1,\\dots,C\\}$，在时间 $t+1$ 也有 $C$ 个类别，索引为 $j \\in \\{1,\\dots,C\\}$。在一个齐次一阶马尔可夫模型下，转移概率由一个矩阵 $T \\in \\mathbb{R}^{C \\times C}$ 表示，其元素为 $T_{ij}$，其中 $T_{ij}$ 表示一个在时间 $t$ 属于类别 $i$ 的像素在时间 $t+1$ 转换到类别 $j$ 的概率。假设如下：\n- 在给定时间 $t$ 的类别条件下，像素之间是条件独立的。\n- 对于每个源类别 $i$，通过叠加两幅地图得到的向目标类别转移的计数向量 $(N_{i1},\\dots,N_{iC})$，服从一个多项分布，其参数为 $(T_{i1},\\dots,T_{iC})$ 和总数 $N_{i+} = \\sum_{j=1}^{C} N_{ij}$。\n- 分类误差可以忽略不计，且空间域对齐是精确的。\n\n仅使用这些建模假设和多项似然的定义，推导 $T$ 的最大似然估计 (MLE)，并满足约束条件：对于每个 $i$，$\\sum_{j=1}^{C} T_{ij} = 1$ 且 $T_{ij} \\ge 0$。将您的最终结果表示为关于观测计数 $N_{ij}$ 的通用元素 $T_{ij}^{\\star}$ 的单个闭式解析表达式。同时，在您的推导中解释行和为一的约束是如何强制执行的，以及在何种计数条件下估计量不是唯一确定的。最终答案必须是单个解析表达式；不要在最终答案框中包含任何单位或额外评论。",
            "solution": "该问题要求在一组指定的建模假设下，推导转移概率矩阵 $T$ 的元素 $T_{ij}$ 的最大似然估计 (MLE)。矩阵 $T$ 描述了两个时间点 $t$ 和 $t+1$ 之间土地利用和土地覆盖 (LULC) 变化的概率。\n\n推导过程是通过在给定的概率 $T_{ij}$ 约束条件下，最大化观测到的转移计数 $N_{ij}$ 的似然函数。\n\n首先，我们建立似然函数。问题陈述，对于每个源类别 $i \\in \\{1, \\dots, C\\}$，观测到的向所有目标类别 $j \\in \\{1, \\dots, C\\}$ 转移的计数向量，记为 $(N_{i1}, \\dots, N_{iC})$，服从一个多项分布。该分布的参数是该源类别的转移概率向量 $(T_{i1}, \\dots, T_{iC})$，以及源类别中的像素总数 $N_{i+} = \\sum_{j=1}^{C} N_{ij}$。\n\n单独一行 $i$ 的计数的概率质量函数由多项分布公式给出：\n$$ P(N_{i1}, \\dots, N_{iC} | T_{i1}, \\dots, T_{iC}) = \\frac{N_{i+}!}{\\prod_{j=1}^{C} N_{ij}!} \\prod_{j=1}^{C} T_{ij}^{N_{ij}} $$\n像素在给定时间 $t$ 的类别下是条件独立的这一假设，意味着来自不同源类别的转移是独立事件。因此，总似然函数 $L(T | N)$ 是从 $1$ 到 $C$ 的每个源类别 $i$ 的似然的乘积：\n$$ L(T | N) = \\prod_{i=1}^{C} \\left( \\frac{N_{i+}!}{\\prod_{j=1}^{C} N_{ij}!} \\prod_{j=1}^{C} T_{ij}^{N_{ij}} \\right) $$\n为求得 MLE，我们必须就参数 $T_{ij}$ 对 $L(T|N)$ 进行最大化，同时满足约束条件：对于每个类别 $i$，$\\sum_{j=1}^{C} T_{ij} = 1$ 且对于所有 $j \\in \\{1, \\dots, C\\}$，$T_{ij} \\ge 0$。\n\n在数学上，最大化似然函数的自然对数，即对数似然 $\\mathcal{L} = \\ln(L)$，更为方便，因为对数是一个单调递增函数，它会产生相同的最大化参数。\n$$ \\mathcal{L}(T|N) = \\ln(L(T|N)) = \\sum_{i=1}^{C} \\ln\\left( \\frac{N_{i+}!}{\\prod_{j=1}^{C} N_{ij}!} \\right) + \\sum_{i=1}^{C} \\sum_{j=1}^{C} N_{ij} \\ln(T_{ij}) $$\n为了对 $T_{ij}$ 进行最大化，涉及阶乘的项是一个常数，可以忽略。因此，我们寻求最大化：\n$$ \\mathcal{L}'(T) = \\sum_{i=1}^{C} \\sum_{j=1}^{C} N_{ij} \\ln(T_{ij}) $$\n关键在于，目标函数 $\\mathcal{L}'(T)$ 是各项之和，其中每一项 $\\sum_{j=1}^{C} N_{ij} \\ln(T_{ij})$ 仅依赖于矩阵 $T$ 的单一行 $i$ 的参数。同样，约束条件 $\\sum_{j=1}^{C} T_{ij} = 1$ 独立地应用于每一行。这意味着整个优化问题可以解耦为 $C$ 个独立的优化问题，每个源类别 $i$ 对应一个。\n\n对于每一行 $i$，我们必须在约束条件 $g_i = \\sum_{j=1}^{C} T_{ij} - 1 = 0$ 下最大化 $\\mathcal{L}_i = \\sum_{j=1}^{C} N_{ij} \\ln(T_{ij})$。这个约束优化问题使用拉格朗日乘数法来解决。因此，通过为 $C$ 个约束中的每一个引入一个拉格朗日乘子 $\\lambda_i$ 来强制执行行和为一的约束。第 $i$ 行的拉格朗日函数是：\n$$ \\Lambda_i(T_{i1}, \\dots, T_{iC}, \\lambda_i) = \\sum_{j=1}^{C} N_{ij} \\ln(T_{ij}) - \\lambda_i \\left( \\sum_{j=1}^{C} T_{ij} - 1 \\right) $$\n为了找到驻点，我们将 $\\Lambda_i$ 对每个变量 $T_{ij}$ (对于 $j=1, \\dots, C$) 和乘子 $\\lambda_i$ 求偏导数，并令它们为零。对于一个通用的 $T_{ij}$：\n$$ \\frac{\\partial \\Lambda_i}{\\partial T_{ij}} = \\frac{N_{ij}}{T_{ij}} - \\lambda_i = 0 $$\n解出 $T_{ij}$ 可得：\n$$ T_{ij} = \\frac{N_{ij}}{\\lambda_i} $$\n这必须对所有的 $j \\in \\{1, \\dots, C\\}$ 成立。这个结果表明，估计的概率 $T_{ij}$ 与观测到的计数 $N_{ij}$ 成正比。对于一个给定的源类别 $i$，比例常数 $1/\\lambda_i$ 对所有目标类别 $j$ 都是相同的。\n\n为了确定 $\\lambda_i$，我们将这个 $T_{ij}$ 的表达式代回约束方程 $\\sum_{j=1}^{C} T_{ij} = 1$ 中：\n$$ \\sum_{j=1}^{C} \\frac{N_{ij}}{\\lambda_i} = 1 $$\n$$ \\frac{1}{\\lambda_i} \\sum_{j=1}^{C} N_{ij} = 1 $$\n总和 $\\sum_{j=1}^{C} N_{ij}$ 是最初属于类别 $i$ 的像素总数，我们已将其记为 $N_{i+}$。因此：\n$$ \\frac{N_{i+}}{\\lambda_i} = 1 \\implies \\lambda_i = N_{i+} $$\n现在，我们将这个 $\\lambda_i$ 的值代回到 $T_{ij}$ 的表达式中，以获得最大似然估计量，我们将其记为 $T_{ij}^{\\star}$：\n$$ T_{ij}^{\\star} = \\frac{N_{ij}}{N_{i+}} = \\frac{N_{ij}}{\\sum_{k=1}^{C} N_{ik}} $$\n在这里，我们在分母的求和中使用索引 $k$，以避免与特定项 $N_{ij}$ 中的索引 $j$ 混淆。非负性约束 $T_{ij} \\ge 0$ 是满足的，因为计数 $N_{ij}$ 及其总和 $N_{i+}$ 本身就是非负的。\n\n$T_{ij}^{\\star}$ 的估计量只有在分母不为零时才是唯一确定的。分母是 $N_{i+} = \\sum_{k=1}^{C} N_{ik}$。如果对于一个给定的源类别 $i$，$N_{i+} = 0$，这意味着类别 $i$ 在时间 $t$ 的栅格图中不存在。在这种情况下，数据没有提供关于类别 $i$ 转移行为的任何信息。第 $i$ 行的似然贡献将是 $\\prod_j T_{ij}^{0} = 1$，而与 $T_{ij}$ 的值无关（只要它们非零，或者我们定义 $0^0=1$）。任何和为 $1$ 的概率向量 $(T_{i1}, \\dots, T_{iC})$ 都会使这个常数似然项最大化。因此，如果在时间 $t$ 没有观测到类别 $i$ 的像素，那么转移矩阵第 $i$ 行的 MLE 不是唯一确定的。",
            "answer": "$$ \\boxed{\\frac{N_{ij}}{\\sum_{k=1}^{C} N_{ik}}} $$"
        },
        {
            "introduction": "许多土地利用和土地覆盖变化（LULCC）框架的最终目标是模拟未来的情景。本练习  将状态、动态和空间驱动因素等概念融合到一个统一的元胞自动机（CA）模型中。通过实现一个贪婪分配算法，您将着手解决综合需求、适宜性、邻域效应和硬约束等实际挑战，以生成土地覆盖变化的空间显式预测。",
            "id": "3824230",
            "problem": "给定一个土地覆盖图的离散栅格网格表示、一组类别数量的目标净变化量（需求）、特定类别的适宜性场、一个编码了禁止变化的硬约束的排除掩码，以及一个允许转移矩阵。您的任务是实现一个基于遥感和环境建模原理的元胞自动机 (CA) 分配程序，用于土地利用和土地覆盖 (LULC) 变化。该程序迭代选择元胞进行转移，以满足需求，同时遵守约束并最大化局部定义的转移倾向。\n\n从以下基本基础开始：\n\n- 元胞自动机 (CA) 是格网上的一个空间显式模型，其中每个元胞的状态根据局部规则和邻域影响演化。\n- 在 LULC 变化建模中，每个元胞属于 $K$ 个离散类别之一。转移受限于允许的起始-目标对和硬性排除。需求指定了目标年份各类别总数的变化量，并且必须满足总元胞数量守恒。\n- 邻域影响可以用在有限核上定义的局部统计量来表示，适宜性是一个特定类别的标量场，反映了与位置相关的吸引力。\n\n定义：\n\n- 设网格形状为 $H \\times W$，其中 $H = 5$ 且 $W = 5$。设类别由 $k \\in \\{0,1,2\\}$（$K = 3$）索引。\n- 设初始土地覆盖图为一个整数数组 $M \\in \\{0,1,2\\}^{H \\times W}$，其中 $M_{i,j}$ 是元胞 $(i,j)$ 的类别。所有测试用例的地图如下：\n  - 第 $0$ 行：$[2,2,1,0,0]$\n  - 第 $1$ 行：$[2,2,1,1,0]$\n  - 第 $2$ 行：$[2,0,0,1,1]$\n  - 第 $3$ 行：$[2,2,0,0,1]$\n  - 第 $4$ 行：$[0,0,0,2,2]$\n- 设排除掩码为 $E \\in \\{0,1\\}^{H \\times W}$，其中 $E_{i,j} = 1$ 表示禁止在 $(i,j)$ 发生任何变化；$E_{i,j} = 0$ 表示允许变化。\n- 设允许转移矩阵为 $T \\in \\{0,1\\}^{K \\times K}$，其中 $T_{o,k} = 1$ 表示从源类别 $o$ 到目标类别 $k$ 的转移是允许的，否则 $T_{o,k} = 0$。不允许自我转移，因此对所有 $k$ 都有 $T_{k,k} = 0$。使用：\n  - $T$ 的行（源 $0, 1, 2$）到列（目标 $0, 1, 2$）：\n    - 源 $0$：$[0,1,0]$\n    - 源 $1$：$[1,0,0]$\n    - 源 $2$：$[1,1,0]$\n- 设适宜性场为 $S \\in \\mathbb{R}^{K \\times H \\times W}$，其中 $S_{k,i,j} \\in [0,1]$ 编码了元胞 $(i,j)$ 对目标类别 $k$ 的位置相关适宜性。使用：\n  - $S_{0}$ 行：\n    - 第 $0$ 行：$[0.4,0.3,0.2,0.6,0.5]$\n    - 第 $1$ 行：$[0.3,0.2,0.3,0.5,0.4]$\n    - 第 $2$ 行：$[0.2,0.4,0.5,0.3,0.2]$\n    - 第 $3$ 行：$[0.3,0.3,0.4,0.6,0.6]$\n    - 第 $4$ 行：$[0.5,0.5,0.4,0.3,0.2]$\n  - $S_{1}$ 行：\n    - 第 $0$ 行：$[0.7,0.6,0.8,0.3,0.2]$\n    - 第 $1$ 行：$[0.6,0.5,0.7,0.4,0.3]$\n    - 第 $2$ 行：$[0.5,0.6,0.7,0.5,0.4]$\n    - 第 $3$ 行：$[0.4,0.5,0.6,0.7,0.6]$\n    - 第 $4$ 行：$[0.3,0.4,0.5,0.6,0.7]$\n  - $S_{2}$ 行：\n    - 第 $0$ 行：$[0.2,0.3,0.4,0.6,0.7]$\n    - 第 $1$ 行：$[0.3,0.4,0.5,0.6,0.7]$\n    - 第 $2$ 行：$[0.4,0.5,0.6,0.5,0.4]$\n    - 第 $3$ 行：$[0.5,0.6,0.5,0.4,0.3]$\n    - 第 $4$ 行：$[0.6,0.7,0.6,0.5,0.4]$\n- 设邻域核为排除中心的 $3 \\times 3$ 摩尔 (Moore) 核 $K$：\n  - $K = \\begin{bmatrix}1  1  1 \\\\ 1  0  1 \\\\ 1  1  1\\end{bmatrix}$。\n- 设元胞 $(i,j)$ 处目标类别 $k$ 的邻域分数为 $N_{k,i,j}$，定义为 $(i,j)$ 周围类别为 $k$ 的邻居数量除以 $(i,j)$ 处由 $K$ 指示的有效邻居数量，使用边界感知的归一化，使得边缘元胞除以实际在边界内的邻居数量。\n- 设转移倾向为适宜性和邻域分数的凸组合：对于元胞 $(i,j)$ 的目标类别 $k$，$P_{k,i,j} = w_s \\, S_{k,i,j} + w_n \\, N_{k,i,j}$，权重为 $w_s = 0.7$ 和 $w_n = 0.3$。\n\n分配规则：\n\n- 设需求向量为 $d \\in \\mathbb{Z}^{K}$，其中 $d_k$ 是类别 $k$ 数量所需的净变化。总元胞数量守恒意味着 $\\sum_{k=0}^{K-1} d_k = 0$。正的 $d_k$ 意味着类别 $k$ 必须增加 $d_k$ 个元胞；负的 $d_k$ 意味着类别 $k$ 必须减少 $|d_k|$ 个元胞。\n- 硬约束：一个元胞 $(i,j)$ 若其 $E_{i,j} = 1$ 则不能改变类别。一个从源类别 $o$ 到目标类别 $k$ 的提议转移仅在 $T_{o,k} = 1$ 时被允许。\n- 迭代贪心选择：当存在 $d_k > 0$ 的 $k$ 时，选择一个元胞 $(i,j)$ 变为类别 $k$，使得：\n  - 该元胞当前属于某个源类别 $o \\neq k$，且 $d_o < 0$（只从必须减少元胞的类别中抽取）。\n  - $E_{i,j} = 0$ 且 $T_{o,k} = 1$。\n  - 在所有合格的 $(k,i,j)$ 三元组中，选择使 $P_{k,i,j}$ 最大化的那一个。如果出现平局，则按较小的目标类别索引 $k$ 打破平局，然后按较小的行主序索引 $(i,j)$ 打破平局。\n  - 应用变化：设置 $M_{i,j} \\leftarrow k$，更新 $d_k \\leftarrow d_k - 1$ 和 $d_o \\leftarrow d_o + 1$。\n- 终止条件：当所有 $d_k \\le 0$（即所有正需求都得到满足）或没有满足约束的合格元胞时终止。在后一种情况下，部分需求未得到满足。\n\n测试套件：\n\n实现上述算法，并将其应用于以下三个参数集：\n\n- 测试用例 1（正常路径）：\n  - 需求 $d = [0,4,-4]$。\n  - 排除掩码 $E$ 的各行：\n    - 第 $0$ 行：$[0,0,0,0,0]$\n    - 第 $1$ 行：$[0,1,0,0,0]$\n    - 第 $2$ 行：$[0,0,0,1,0]$\n    - 第 $3$ 行：$[0,0,0,0,0]$\n    - 第 $4$ 行：$[0,0,1,0,0]$\n- 测试用例 2（边界情况：零需求）：\n  - 需求 $d = [0,0,0]$。\n  - 排除掩码 $E$ 与测试用例 1 相同。\n- 测试用例 3（边缘情况：需求超过约束下的合格供应）：\n  - 需求 $d = [0,10,-10]$。\n  - 排除掩码 $E$ 的各行：\n    - 第 $0$ 行：$[1,1,0,0,0]$\n    - 第 $1$ 行：$[1,1,1,0,0]$\n    - 第 $2$ 行：$[0,0,0,0,0]$\n    - 第 $3$ 行：$[1,1,0,0,0]$\n    - 第 $4$ 行：$[0,0,0,1,1]$\n\n输出规范：\n\n- 对每个测试用例，计算分配后的最终类别计数，格式为列表 $[c_0,c_1,c_2]$，其中 $c_k$ 是最终地图中类别 $k$ 的计数。同时计算一个布尔值，指示所有正需求是否已完全满足。\n- 您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表。每个元素是测试用例的结果列表 $[c_0,c_1,c_2,b]$，其中 $b$ 是表示需求是否完全满足的布尔值。例如，输出格式类似于 $[[c_{0}^{(1)},c_{1}^{(1)},c_{2}^{(1)},b^{(1)}],[c_{0}^{(2)},c_{1}^{(2)},c_{2}^{(2)},b^{(2)}],[c_{0}^{(3)},c_{1}^{(3)},c_{2}^{(3)},b^{(3)}]]$。",
            "solution": "此问题要求实现一个受约束的元胞自动机（CA）分配算法。该模型的核心是一个迭代过程，在每一步中，算法都会贪心地选择“最佳”的元胞进行类别转换，直到满足需求或无法再进行更多有效的转换为止。算法的实现步骤如下：\n\n1.  **初始化**：算法从初始土地覆盖图 $M$ 和需求向量 $d$ 开始。主循环持续进行，只要存在任何正的需求（即 $\\sum_{k \\text{ s.t. } d_k > 0} d_k > 0$）。\n\n2.  **计算转移倾向**：在每次迭代中，必须为每个可能的转移（即每个元胞 $(i,j)$ 变为每个目标类别 $k$）计算一个“转移倾向”分数 $P_{k,i,j}$。该分数是静态适宜性 $S_{k,i,j}$ 和动态邻域影响 $N_{k,i,j}$ 的加权和：\n    $$P_{k,i,j} = w_s S_{k,i,j} + w_n N_{k,i,j}$$\n    邻域分数 $N_{k,i,j}$ 定义为元胞 $(i,j)$ 的邻居中属于类别 $k$ 的比例。由于土地覆盖图在每次迭代中都会改变，因此该分数需要动态更新。这可以通过对每个类别的二进制地图与指定的摩尔核进行二维卷积来高效完成。\n\n3.  **识别和选择最佳候选转移**：\n    *   **候选者过滤**：算法首先识别所有有效的转移。一个从源类别 $o$ 到目标类别 $k$ 的转移是有效的，当且仅当它满足所有“硬”约束：(a) 目标类别 $k$ 必须有正需求（$d_k > 0$）；(b) 源类别 $o$ 必须有负需求（$d_o  0$）；(c) 转移矩阵允许该转换（$T_{o,k} = 1$）；(d) 该元胞未被排除掩码锁定（$E_{i,j} = 0$）。\n    *   **贪心选择**：在所有有效的候选转移中，算法选择使转移倾向 $P_{k,i,j}$ 最大化的那一个。为了确保结果的唯一性，采用了严格的平局打破规则：首先选择倾向值最高的，如果打平，则选择目标类别索引 $k$ 较小的，如果仍然打平，则选择行主序索引较小的元胞。\n\n4.  **状态更新和终止**：\n    *   **更新**：一旦确定了最佳转移（例如，元胞 $(i^*, j^*)$ 从 $o^*$ 变为 $k^*$），算法将更新土地覆盖图（$M_{i^*,j^*} \\leftarrow k^*$）并相应地调整需求向量（$d_{k^*} \\leftarrow d_{k^*} - 1$，$d_{o^*} \\leftarrow d_{o^*} + 1$）。\n    *   **终止**：当所有正需求都得到满足（即所有 $d_k \\le 0$）或在一次迭代中找不到任何有效的候选转移时，主循环终止。后一种情况意味着由于约束或源元胞耗尽，需求无法完全满足。\n\n5.  **输出结果**：循环终止后，计算并报告修改后地图 $M$ 中每个类别的最终元胞计数，以及一个布尔标志，指示是否所有正需求都已完全满足。",
            "answer": "[[11,9,5,true],[11,5,9,true],[11,6,8,false]]"
        }
    ]
}