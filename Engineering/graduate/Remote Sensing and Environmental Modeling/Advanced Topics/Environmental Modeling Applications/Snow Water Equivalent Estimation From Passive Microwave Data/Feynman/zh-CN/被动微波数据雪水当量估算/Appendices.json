{
    "hands_on_practices": [
        {
            "introduction": "理解积雪的物理特性如何转化为卫星观测到的信号，是遥感科学的基石。本练习将指导您从基本原理出发，构建一个“正向模型”。通过实现微波在雪中吸收和发射的物理过程，您将计算出在给定的积雪和地面条件下，传感器会观测到的亮度温度。这项实践能加深您对地球物理状态（如雪水当量 $SWE$、密度等）与辐射测量之间联系的理解。",
            "id": "3847393",
            "problem": "您的任务是使用基本的辐射传输原理和基于物理的本构关系，设计并实现一个用于观测雪盖地表微波亮温 (BT) 的正向模型。目标是为一组指定的条件（由一个小型测试套件表示）计算大气层顶部的向上亮温。建模的场景是一个覆盖在土壤上方的平面平行、水平均匀的干雪层，在指定的微波频率和观测角下进行观测。\n\n使用以下基本原理和定义来推导您将要实现的模型：\n\n- 平面平行吸收介质中的辐射传输：在吸收系数为 $\\kappa_a$、源函数由瑞利-金斯近似给出的介质中，沿路径坐标 $s$ 的比辐射强度由以下微分方程控制\n$$\\frac{dI}{ds} = -\\kappa_a I + \\kappa_a B(T),$$\n其中 $B(T)$ 是普朗克函数，在微波频率下由瑞利-金斯表达式近似。\n\n- 亮温 (BT) 定义：在微波频率下，瑞利-金斯近似允许将辐射强度表示为 $I = \\alpha(f) T$，其中 $\\alpha(f)$ 是一个已知的频率相关常数。在此近似下，测量量等效地表示为亮温 $T_B$，因此有效发射与 $T_B$ 成正比，辐射传输方程可以直接用 $T_B$ 写为\n$$\\frac{d T_B}{ds} = -\\kappa_a T_B + \\kappa_a T(s),$$\n对于温度为 $T(s) = T_{\\text{snow}}$ 的均匀介质。\n\n- 雪-地界面的边界条件：土壤的特征是地表发射率 $e_g$ 和物理温度 $T_{\\text{ground}}$，因此雪层底部的向上边界条件是\n$$T_{B,\\text{ground}} = e_g \\, T_{\\text{ground}}.$$\n\n- 被动微波辐射计 (PMR) 观测几何：对于一个观测角 $\\theta$（从天顶方向测量），穿过物理厚度为 $h$ 的层路径长度为 $h / \\cos(\\theta)$。\n\n- 雪水当量 (SWE) 与厚度：雪水当量 (SWE) 定义为如果雪融化并均匀铺开后所形成的液态水的厚度。设雪密度为 $\\rho_s$，液态水密度为 $\\rho_w$。利用单位面积质量守恒，从给定的 SWE 和 $\\rho_s$ 推导出物理雪层厚度 $h$。\n\n- 电磁衰减与介电特性：对于一个复相对介电常数为 $\\varepsilon = \\varepsilon' + i \\varepsilon''$ 的非磁性、弱损耗介电材料，在低损耗极限下，其复折射率为 $n = \\sqrt{\\varepsilon} \\approx \\sqrt{\\varepsilon'} + i \\left(\\frac{\\varepsilon''}{2\\sqrt{\\varepsilon'}}\\right)$。功率衰减系数（单位为 $\\text{m}^{-1}$）为\n$$\\alpha(f) = \\frac{2\\pi f}{c} \\, \\operatorname{Im}(n) \\approx \\frac{\\pi f}{c} \\frac{\\varepsilon''}{\\sqrt{\\varepsilon'}},$$\n其中 $f$ 是以 $\\text{Hz}$ 为单位的频率，$c$ 是真空中的光速。\n\n- 干雪有效介电常数参数化：使用冰相体积分数来模拟干雪的有效介电常数。设 $\\rho_i$ 表示纯冰的密度。定义冰体积分数 $\\phi = \\rho_s / \\rho_i$。在微波频率下使用以下干雪参数化方案：\n$$\\varepsilon' = 1 + a \\, \\phi, \\quad \\varepsilon'' = b \\, \\phi \\, f_{\\text{GHz}},$$\n其中 $f_{\\text{GHz}}$ 是以 $\\text{GHz}$ 为单位表示的频率，常数 $a = 1.7$，$b = 5 \\times 10^{-4}$。\n\n使用的常数：\n- 光速：$c = 2.99792458 \\times 10^8 \\, \\text{m}\\,\\text{s}^{-1}$。\n- 水密度：$\\rho_w = 1000 \\, \\text{kg}\\,\\text{m}^{-3}$。\n- 冰密度：$\\rho_i = 917 \\, \\text{kg}\\,\\text{m}^{-3}$。\n\n采用的假设：\n- 在所考虑的频率下，雪层是等温的，且以吸收为主。散射被忽略。\n- 空气-雪界面的反射被忽略；模型仅考虑层内吸收和地表发射率的贡献。\n- 瑞利-金斯近似在指定的微波频率下有效。\n\n任务：\n- 从上述基础出发，推导出一个计算雪层顶部向上亮温 $T_{B,\\text{top}}$ 的正向模型，并实现它以计算每个测试用例的 $T_{B,\\text{top}}$。\n- 所有角度均以度为单位指定；根据需要转换为弧度，并一致地使用 $\\cos(\\theta)$。\n- 最终亮温值以 $\\text{K}$ 为单位表示，四舍五入到三位小数。\n\n测试套件：\n为以下五个案例计算 $T_{B,\\text{top}}$，每个案例定义为一个元组 $(f_{\\text{GHz}}, \\theta_{\\text{deg}}, \\text{SWE}_{\\text{m}}, \\rho_s, T_{\\text{snow}}, T_{\\text{ground}}, e_g)$，单位如注：\n\n1. $(19.35, 0, 0.15, 300, 263, 273, 0.90)$\n2. $(19.35, 0, 0.00, 300, 268, 270, 0.95)$\n3. $(37.00, 0, 0.40, 400, 258, 265, 0.85)$\n4. $(19.35, 0, 0.25, 350, 260, 273, 0.60)$\n5. $(37.00, 50, 0.20, 300, 265, 272, 0.92)$\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，“[result1,result2,result3,result4,result5]”）。每个结果必须是对应测试用例的亮温值（单位为 $\\text{K}$），并四舍五入到三位小数。",
            "solution": "该问题要求推导并实现一个用于计算从干雪层覆盖的土壤向上发射的微波亮温的正向模型。问题陈述在科学上是合理的、适定的且自洽的，提供了所有必要的物理原理、本构关系、参数和常数。因此，它被认为是一个有效的问题。\n\n推导过程如下。\n\n**第一步：根据雪水当量 (SWE) 确定物理雪层厚度**\n雪水当量 $\\text{SWE}$ 表示雪层融化后形成的水层高度。单位面积的雪质量由雪密度 $\\rho_s$ 和雪层厚度 $h$ 的乘积给出。该质量必须等于等效水柱的质量，即水密度 $\\rho_w$ 和 $\\text{SWE}$ 的乘积。\n$$ \\text{mass per unit area} = \\rho_s h = \\rho_w \\text{SWE} $$\n根据这个质量守恒定律，我们可以将物理雪层厚度 $h$ 表示为：\n$$ h = \\text{SWE} \\frac{\\rho_w}{\\rho_s} $$\n\n**第二步：表征雪层的介电与吸收特性**\n干雪的电磁特性由其有效复介电常数 $\\varepsilon = \\varepsilon' + i \\varepsilon''$ 决定。问题提供了一个基于冰体积分数 $\\phi$ 的参数化方案。\n冰体积分数是雪密度 $\\rho_s$ 与纯冰密度 $\\rho_i$ 的比值：\n$$ \\phi = \\frac{\\rho_s}{\\rho_i} $$\n有效介电常数的实部 ($\\varepsilon'$) 和虚部 ($\\varepsilon''$) 由以下公式给出：\n$$ \\varepsilon' = 1 + a \\phi $$\n$$ \\varepsilon'' = b \\phi f_{\\text{GHz}} $$\n其中 $f_{\\text{GHz}}$ 是以吉赫兹（GHz）为单位的微波频率，$a=1.7$ 和 $b=5 \\times 10^{-4}$ 是经验常数。\n\n微波在雪中的吸收由功率吸收系数 $\\kappa_a$ 控制。对于弱损耗介电介质，这与复折射率 $n = \\sqrt{\\varepsilon}$ 的虚部有关。吸收系数由以下公式给出：\n$$ \\kappa_a = \\frac{\\pi f}{c} \\frac{\\varepsilon''}{\\sqrt{\\varepsilon'}} $$\n这里，$f$ 是以赫兹（Hz）为单位的频率（$f = f_{\\text{GHz}} \\times 10^9$），$c$ 是真空中的光速。\n\n**第三步：求解辐射传输方程 (RTE)**\n该问题通过忽略散射并假设雪层为温度 $T_{\\text{snow}}$ 的等温层来简化辐射传输过程。亮温 $T_B$ 沿路径坐标 $s$ 的辐射传输方程 (RTE) 如下：\n$$ \\frac{dT_B}{ds} = -\\kappa_a T_B + \\kappa_a T_{\\text{snow}} $$\n这是一个一阶线性常微分方程。我们可以通过定义一个坐标系来求解它，其中 $s=0$ 在雪-地界面，并沿观测路径向上增加。路径与天顶方向成 $\\theta$ 角，因此穿过厚度为 $h$ 的雪层的总路径长度 $L$ 为 $L = h / \\cos(\\theta)$。\n\nRTE 的通解为：\n$$ T_B(s) = T_{\\text{snow}} + C e^{-\\kappa_a s} $$\n其中 $C$ 是一个积分常数，由雪层底部（$s=0$）的边界条件确定。\n\n雪-地界面的边界条件是来自地表的向上发射亮温 $T_{B,\\text{ground}}$，由下式给出：\n$$ T_B(0) = T_{B,\\text{ground}} = e_g T_{\\text{ground}} $$\n其中 $e_g$ 是地表发射率，$T_{\\text{ground}}$ 是地表的物理温度。\n\n将此边界条件应用于 $s=0$ 处的通解：\n$$ T_B(0) = T_{\\text{snow}} + C e^{-\\kappa_a (0)} = T_{\\text{snow}} + C $$\n$$ \\implies C = T_B(0) - T_{\\text{snow}} = e_g T_{\\text{ground}} - T_{\\text{snow}} $$\n将 $C$ 代回通解，得到雪层内的亮温分布：\n$$ T_B(s) = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a s} $$\n\n**第四步：计算雪-气界面的向上亮温**\n所求量是雪层顶部的向上亮温 $T_{B,\\text{top}}$，对应于 $T_B(s=L)$。我们将 $s=L$ 代入方程：\n$$ T_{B,\\text{top}} = T_B(L) = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a L} $$\n代入 $L = h / \\cos(\\theta)$，我们得到：\n$$ T_{B,\\text{top}} = T_{\\text{snow}} + (e_g T_{\\text{ground}} - T_{\\text{snow}}) e^{-\\kappa_a h / \\cos(\\theta)} $$\n令雪层的透射率为 $\\tau(\\theta) = e^{-\\kappa_a h / \\cos(\\theta)}$。该方程可以重排为一个更符合物理直觉的形式：\n$$ T_{B,\\text{top}} = T_{\\text{snow}} (1 - e^{-\\kappa_a h / \\cos(\\theta)}) + (e_g T_{\\text{ground}}) e^{-\\kappa_a h / \\cos(\\theta)} $$\n$$ T_{B,\\text{top}} = T_{\\text{snow}}(1-\\tau(\\theta)) + T_{B,\\text{ground}} \\tau(\\theta) $$\n这个表达式表明，观测到的亮温是两个分量的和：雪层自身的发射，$T_{\\text{snow}}(1-\\tau(\\theta))$，以及来自下方地表的发射 $T_{B,\\text{ground}}$ 经雪层衰减后的部分，$\\tau(\\theta)$。项 $(1-\\tau(\\theta))$ 代表雪层的有效发射率。\n\n因此，完整的正向模型是通过依次计算 $h$、$\\phi$、$\\varepsilon'$、$\\varepsilon''$、$\\kappa_a$，最后使用推导出的表达式计算 $T_{B,\\text{top}}$ 来构建的。对于 $\\text{SWE} = 0$ 的特殊情况，雪层厚度 $h=0$，路径长度 $L=0$，透射率 $\\tau(\\theta)=1$，模型正确地简化为 $T_{B,\\text{top}} = e_g T_{\\text{ground}}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the upward brightness temperature (BT) at the top of a snow layer\n    for a given set of environmental and observational parameters.\n    \"\"\"\n\n    # Define physical and model constants\n    C_LIGHT = 2.99792458e8  # Speed of light in vacuum, m/s\n    RHO_WATER = 1000.0      # Density of liquid water, kg/m^3\n    RHO_ICE = 917.0         # Density of pure ice, kg/m^3\n    A_PERMITTIVITY = 1.7    # Empirical constant for real part of permittivity\n    B_PERMITTIVITY = 5.0e-4 # Empirical constant for imaginary part of permittivity\n\n    # Test suite: (f_GHz, theta_deg, SWE_m, rho_s, T_snow, T_ground, e_g)\n    test_cases = [\n        (19.35, 0, 0.15, 300, 263, 273, 0.90),\n        (19.35, 0, 0.00, 300, 268, 270, 0.95),\n        (37.00, 0, 0.40, 400, 258, 265, 0.85),\n        (19.35, 0, 0.25, 350, 260, 273, 0.60),\n        (37.00, 50, 0.20, 300, 265, 272, 0.92),\n    ]\n\n    results = []\n    for case in test_cases:\n        f_ghz, theta_deg, swe_m, rho_s, t_snow, t_ground, e_g = case\n\n        # Handle the trivial case of no snow\n        if swe_m == 0.0:\n            tb_top = e_g * t_ground\n            results.append(round(tb_top, 3))\n            continue\n\n        # Step 1: Calculate physical snow thickness (h) from SWE\n        # rho_s * h = rho_w * SWE  =>  h = SWE * (rho_w / rho_s)\n        h = swe_m * (RHO_WATER / rho_s)\n\n        # Step 2: Characterize snowpack dielectric and absorption properties\n        # Ice volume fraction\n        phi = rho_s / RHO_ICE\n\n        # Real and imaginary parts of relative permittivity\n        eps_prime = 1 + A_PERMITTIVITY * phi\n        eps_double_prime = B_PERMITTIVITY * phi * f_ghz\n\n        # Absorption coefficient (kappa_a) in Np/m\n        f_hz = f_ghz * 1e9\n        kappa_a = (np.pi * f_hz / C_LIGHT) * (eps_double_prime / np.sqrt(eps_prime))\n\n        # Step 3  4: Calculate final brightness temperature at the top\n        # Convert viewing angle to radians\n        theta_rad = np.deg2rad(theta_deg)\n        \n        # Calculate cos(theta). Handle theta=90 to avoid division by zero, though not in test cases.\n        cos_theta = np.cos(theta_rad)\n        if cos_theta == 0:\n            # Path length is infinite, so transmissivity is zero\n            transmissivity = 0.0\n        else:\n            # Optical depth along the slant path\n            optical_depth = kappa_a * h / cos_theta\n            \n            # Transmissivity of the snowpack\n            transmissivity = np.exp(-optical_depth)\n\n        # Brightness temperature from the ground\n        tb_ground_up = e_g * t_ground\n\n        # Final brightness temperature at the top of the snowpack\n        # T_B_top = T_snow * (1 - tau) + T_B_ground * tau\n        tb_top = t_snow * (1 - transmissivity) + tb_ground_up * transmissivity\n\n        results.append(round(tb_top, 3))\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) is robust for different number types\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了正向问题之后，我们现在来解决逆向挑战：即从亮度温度测量值中估算雪水当量（$SWE$）。本练习介绍了一种经典而强大的双通道反演算法。您将推导并应用一个光谱指数，它巧妙地利用了两个频率之间的差异来分离出积雪信号，同时消除了来自地表发射的未知变量的影响。",
            "id": "3847383",
            "problem": "一个星载被动微波辐射计在吸收主导、散射可忽略的条件下，以两个频率观测一个干到微湿的季节性雪堆。假设一个物理温度为 $T_{s}$ 的水平均匀、平面平行、等温的雪层覆盖在物理温度为 $T_{g}$ 的土壤之上。在瑞利-金斯极限下，雪层顶部的上行亮温 $T_{B}(\\nu)$（频率为 $\\nu$）遵循一维、天底观测、非散射的微波辐射传输模型：\n- 雪层进行热发射，并以光学厚度 $\\tau_{\\nu}$ 衰减地面发射。\n- 地面以发射率 $\\varepsilon_{g}$ 进行热贡献，该发射率在感兴趣的频段内实际上与频率无关。\n\n在这些假设下，雪层顶部的出射亮温可以表示为雪层的透射率 $\\exp(-\\tau_{\\nu})$、雪层温度 $T_{s}$ 和地面贡献 $\\varepsilon_{g} T_{g}$ 的函数。光学厚度随频率呈平方幂律关系，随雪量变化如下：\n$$\n\\tau_{\\nu} \\;=\\; \\kappa_{0}\\,\\left(\\frac{\\nu}{\\nu_{0}}\\right)^{2}\\,\\frac{W}{100},\n$$\n其中，$W$ 是雪水当量（SWE），单位为 $\\mathrm{mm}$，$\\nu_{0} = 37\\,\\mathrm{GHz}$ 是参考频率，$\\kappa_{0}$ 是在 $\\nu_{0}$ 频率下每 $100\\,\\mathrm{mm}$ SWE 的无量纲光学厚度系数。取 $\\kappa_{0} = 1.0$。\n\n以下地球物理和辐射测量条件成立：\n- 雪的有效物理温度：$T_{s} = 258\\,\\mathrm{K}$。\n- 在 $\\nu_{1} = 18.7\\,\\mathrm{GHz}$ 时的亮温：$T_{B}(\\nu_{1}) = 246\\,\\mathrm{K}$。\n- 在 $\\nu_{2} = 36.5\\,\\mathrm{GHz}$ 时的亮温：$T_{B}(\\nu_{2}) = 252\\,\\mathrm{K}$。\n\n从分层的、非散射的辐射传输模型和给定的 $\\tau_{\\nu}$ 频率标度关系出发，通过组合这两个频率，推导出一个能消除未知地面发射率 $\\varepsilon_{g}$ 的光谱指数反演方法。然后用它来计算雪水当量 $W$。最终答案以 $\\mathrm{mm}$ 为单位，并四舍五入到三位有效数字。",
            "solution": "该物理过程由非散射、等温层的一维辐射传输方程建模。频率为 $\\nu$ 的上行亮温 $T_{B}(\\nu)$ 是雪层自身发射与经雪层衰减后的地面发射之和。\n物理温度为 $T_{s}$ 的雪层，其发射率为 $1 - \\exp(-\\tau_{\\nu})$，其中 $\\tau_{\\nu}$ 是光学厚度。因此其发射为 $(1 - \\exp(-\\tau_{\\nu})) T_{s}$。\n地面的特征是有效亮温 $T_{BG} = \\varepsilon_{g} T_{g}$，其中 $\\varepsilon_g$ 是发射率， $T_g$ 是地面的物理温度。该发射被雪层的透射率 $\\exp(-\\tau_{\\nu})$ 衰减。因此，衰减后的地面贡献为 $T_{BG} \\exp(-\\tau_{\\nu})$。\n总亮温由下式给出：\n$$ T_{B}(\\nu) = (1 - \\exp(-\\tau_{\\nu})) T_{s} + T_{BG} \\exp(-\\tau_{\\nu}) $$\n这个方程包含两个未知数：雪水当量 $W$（内嵌于 $\\tau_{\\nu}$ 中）和地表项 $T_{BG}$。\n\n为便于消去 $T_{BG}$，我们重新整理方程：\n$$ T_{B}(\\nu) = T_{s} - T_{s} \\exp(-\\tau_{\\nu}) + T_{BG} \\exp(-\\tau_{\\nu}) $$\n$$ T_{s} - T_{B}(\\nu) = (T_{s} - T_{BG}) \\exp(-\\tau_{\\nu}) $$\n这表示亮温相对于雪的物理温度的降低量。\n\n我们有两个频率的测量值，$\\nu_{1} = 18.7\\,\\mathrm{GHz}$ 和 $\\nu_{2} = 36.5\\,\\mathrm{GHz}$。我们可以为每个频率写出方程：\n$$ T_{s} - T_{B}(\\nu_{1}) = (T_{s} - T_{BG}) \\exp(-\\tau_{\\nu_{1}}) \\quad (1) $$\n$$ T_{s} - T_{B}(\\nu_{2}) = (T_{s} - T_{BG}) \\exp(-\\tau_{\\nu_{2}}) \\quad (2) $$\n$(T_{s} - T_{BG})$ 项是两个方程共有的。假设 $T_{s} - T_{B}(\\nu_1) \\neq 0$ 和 $T_s - T_{BG} \\neq 0$，我们可以通过将方程(2)除以方程(1)来消去此项：\n$$ \\frac{T_{s} - T_{B}(\\nu_{2})}{T_{s} - T_{B}(\\nu_{1})} = \\frac{(T_{s} - T_{BG}) \\exp(-\\tau_{\\nu_{2}})}{(T_{s} - T_{BG}) \\exp(-\\tau_{\\nu_{1}})} = \\exp(\\tau_{\\nu_{1}} - \\tau_{\\nu_{2}}) $$\n这个推导出的光谱指数方程将测量的亮温与光学厚度的差异联系起来，从而消除了未知的地面贡献。\n\n接下来，我们代入给定的光学厚度表达式，$\\tau_{\\nu} = \\kappa_{0}\\,\\left(\\frac{\\nu}{\\nu_{0}}\\right)^{2}\\,\\frac{W}{100}$。\n光学厚度的差异是：\n$$ \\tau_{\\nu_{1}} - \\tau_{\\nu_{2}} = \\kappa_{0} \\frac{W}{100} \\left( \\left(\\frac{\\nu_1}{\\nu_0}\\right)^2 - \\left(\\frac{\\nu_2}{\\nu_0}\\right)^2 \\right) $$\n将此代入指数函数：\n$$ \\frac{T_{s} - T_{B}(\\nu_{2})}{T_{s} - T_{B}(\\nu_{1})} = \\exp\\left[ \\kappa_{0} \\frac{W}{100} \\left( \\left(\\frac{\\nu_1}{\\nu_0}\\right)^2 - \\left(\\frac{\\nu_2}{\\nu_0}\\right)^2 \\right) \\right] $$\n\n为了求解 $W$，我们对两边取自然对数：\n$$ \\ln\\left( \\frac{T_{s} - T_{B}(\\nu_{2})}{T_{s} - T_{B}(\\nu_{1})} \\right) = \\kappa_{0} \\frac{W}{100} \\left( \\left(\\frac{\\nu_1}{\\nu_0}\\right)^2 - \\left(\\frac{\\nu_2}{\\nu_0}\\right)^2 \\right) $$\n分离 $W$ 得到双通道SWE反演的最终解析表达式：\n$$ W = \\frac{100}{\\kappa_{0}} \\frac{\\ln\\left( \\frac{T_{s} - T_{B}(\\nu_{2})}{T_{s} - T_{B}(\\nu_{1})} \\right)}{\\left(\\frac{\\nu_{1}}{\\nu_{0}}\\right)^2 - \\left(\\frac{\\nu_{2}}{\\nu_{0}}\\right)^2} $$\n\n现在，我们代入给定的数值：\n- $T_{s} = 258\\,\\mathrm{K}$\n- 在 $\\nu_{1} = 18.7\\,\\mathrm{GHz}$ 时 $T_{B}(\\nu_{1}) = 246\\,\\mathrm{K}$\n- 在 $\\nu_{2} = 36.5\\,\\mathrm{GHz}$ 时 $T_{B}(\\nu_{2}) = 252\\,\\mathrm{K}$\n- $\\kappa_{0} = 1.0$\n- $\\nu_{0} = 37\\,\\mathrm{GHz}$\n\n温差为：\n$T_{s} - T_{B}(\\nu_{2}) = 258\\,\\mathrm{K} - 252\\,\\mathrm{K} = 6\\,\\mathrm{K}$\n$T_{s} - T_{B}(\\nu_{1}) = 258\\,\\mathrm{K} - 246\\,\\mathrm{K} = 12\\,\\mathrm{K}$\n\n对数的参数是 $\\frac{6}{12} = 0.5$。\n分母中的频率项是：\n$$ \\left(\\frac{18.7}{37}\\right)^2 - \\left(\\frac{36.5}{37}\\right)^2 $$\n\n将这些值代入 $W$ 的表达式中：\n$$ W = \\frac{100}{1.0} \\frac{\\ln(0.5)}{\\left(\\frac{18.7}{37}\\right)^2 - \\left(\\frac{36.5}{37}\\right)^2} $$\n$$ W = 100 \\frac{-\\ln(2)}{\\frac{18.7^2 - 36.5^2}{37^2}} = 100 \\frac{-\\ln(2)}{\\frac{349.69 - 1332.25}{1369}} $$\n$$ W = 100 \\frac{-\\ln(2)}{\\frac{-982.56}{1369}} = 100 \\times \\ln(2) \\times \\frac{1369}{982.56} $$\n使用 $\\ln(2) \\approx 0.693147$：\n$$ W \\approx 100 \\times 0.693147 \\times \\frac{1369}{982.56} \\approx 96.5761\\,\\mathrm{mm} $$\n四舍五入到三位有效数字，雪水当量为 $96.6\\,\\mathrm{mm}$。",
            "answer": "$$\\boxed{96.6}$$"
        },
        {
            "introduction": "在现代地球科学中，我们很少只依赖单一的观测，而是将来自多个来源的信息进行最优化组合。这个高级实践将介绍一种一维变分（1D-Var）数据同化方案，这是一种在业务化的天气和气候模型中广泛使用的技术。您将学习如何将一个背景雪水当量估算值（例如，来自模型的预测）与卫星观测数据进行正式融合，并严谨地考虑两者中的不确定性，从而生成一个更优的“分析”估算结果。",
            "id": "3847379",
            "problem": "您的任务是使用一个简单的陆面雪模型，为一个单一陆地像元实现一维变分数据同化，以根据两个频率的被动微波亮度温度（BT）观测值估算雪水当量（SWE）。该估算应基于微波遥感在晴空天底观测条件下的第一性原理和经过充分检验的辐射传输公式。\n\n基本出发点：\n- 对于平面平行、非发射大气和天底观测条件，频率为 $f$ 的观测微波亮度温度（BT），记为 $T_{B,f}$，可近似为 $T_{B,f} \\approx \\epsilon_f T_s$，其中 $\\epsilon_f$ 是频率 $f$ 下的有效表面发射率，$T_s$ 是积雪表层的整体物理温度。\n- 对于干雪，体积散射会随着光程的增加而降低有效发射率。一个与光程和散射相关的关键状态变量是雪水当量（SWE），记为 $x$，单位为毫米（$\\mathrm{mm}$）。在参考背景值 $x_b$ 附近，频率 $f$ 下的发射率可以使用一阶泰勒展开进行线性化，即 $\\epsilon_f(x) \\approx \\epsilon_{0,f} - k_f x$，其中 $\\epsilon_{0,f} \\in (0,1)$ 是零雪水当量时的发射率，$k_f > 0$ 是一个散射斜率系数，单位为 $\\mathrm{mm}^{-1}$。\n\n模型与数据同化框架：\n- 将 SWE $x$ 映射到两个微波频率 $f_1$ 和 $f_2$ 上的 BT 的观测算子是一个向量函数 $H(x)$，其第 $i$ 个分量为 $H_i(x) = T_s \\epsilon_{f_i}(x)$，其中 $\\epsilon_{f_i}(x)$ 通过上述线性化方法近似。\n- 分析过程被表述为一个一维变分（1D-Var）问题。设背景 SWE 为 $x_b$，其背景误差方差为 $B > 0$；观测到的 BT 为 $y = [y_1, y_2]^T$，其观测误差协方差为 $R = \\mathrm{diag}(\\sigma_{y_1}^2, \\sigma_{y_2}^2)$，其中 $\\sigma_{y_i}^2 > 0$。假设误差为高斯分布，需要最小化的代价函数是\n$$\nJ(x) = (x - x_b)^2 B^{-1} + (y - H(x))^T R^{-1} (y - H(x)).\n$$\n- 您必须根据给定的物理基础和定义，推导出标量 $x$ 的梯度 $\\nabla J(x)$ 和 Hessian 矩阵，并在线性化观测算子下获得 $x$ 的闭式解分析。您必须实现后验平均 SWE（分析值）$x_a$ 的计算，并施加其非负性物理约束（即，如果需要，通过投影强制 $x_a \\geq 0$）。您不需要输出后验方差，但推导过程应与所提出的统计模型保持一致。\n\n单位与输出：\n- 所有亮度温度 $T_{B,f}$ 和物理温度 $T_s$ 的单位均为开尔文 $\\mathrm{K}$。\n- 雪水当量 $x$ 必须以毫米 $\\mathrm{mm}$ 为单位表示。\n- 您的程序应生成单行输出，其中包含每个测试用例的后验 SWE 估算值 $x_a$（单位为 $\\mathrm{mm}$），四舍五入到三位小数，并以方括号括起来的逗号分隔列表形式呈现（例如 `[12.345,67.890,0.000]`）。\n\n测试套件：\n为以下五个测试用例实现您的解决方案。每个用例都指定了 $T_s$、发射率参数 $\\epsilon_{0,f}$、散射斜率 $k_f$、观测到的 BT $y$、背景值 $x_b$、背景方差 $B$ 以及两个通道的观测误差方差。\n\n- 案例1（理想路径，中等SWE，中等误差）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - 频率：$f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [241.1\\,\\mathrm{K}, 227.4\\,\\mathrm{K}]$\n  - $x_b = 100\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 案例2（接近零的SWE，相对可靠的背景和观测）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [246.8\\,\\mathrm{K}, 238.8\\,\\mathrm{K}]$\n  - $x_b = 20\\,\\mathrm{mm}$，$B = 400\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 4.0\\,\\mathrm{K}^2)$\n\n- 案例3（高SWE，较大的背景不确定性和中等观测误差）：\n  - $T_s = 260\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.95$，$\\epsilon_{0,f_2} = 0.92$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [235.1\\,\\mathrm{K}, 216.2\\,\\mathrm{K}]$\n  - $x_b = 250\\,\\mathrm{mm}$，$B = 1600\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(9.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 案例4（较冷地表，中等SWE，混合观测误差）：\n  - $T_s = 240\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.96$，$\\epsilon_{0,f_2} = 0.93$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [226.1\\,\\mathrm{K}, 214.7\\,\\mathrm{K}]$\n  - $x_b = 130\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 9.0\\,\\mathrm{K}^2)$\n\n- 案例5（较暖地表，中高SWE，第二通道高度不确定）：\n  - $T_s = 265\\,\\mathrm{K}$\n  - $f_1 = 19\\,\\mathrm{GHz}$，$f_2 = 37\\,\\mathrm{GHz}$\n  - $\\epsilon_{0,f_1} = 0.94$，$\\epsilon_{0,f_2} = 0.91$\n  - $k_{f_1} = 1.5 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$，$k_{f_2} = 3.0 \\times 10^{-4}\\,\\mathrm{mm}^{-1}$\n  - $y = [241.9\\,\\mathrm{K}, 226.9\\,\\mathrm{K}]$\n  - $x_b = 160\\,\\mathrm{mm}$，$B = 900\\,\\mathrm{mm}^2$\n  - $R = \\mathrm{diag}(4.0\\,\\mathrm{K}^2, 25.0\\,\\mathrm{K}^2)$\n\n实现要求：\n- 从上述辐射传输基础出发，使用指定的观测算子和线性化假设，从代价函数 $J(x)$ 推导出后验均值 $x_a$ 的解析表达式。\n- 为每个测试用例实现 $x_a$ 的计算，并在必要时通过投影到可行集上来强制 $x_a \\geq 0$。\n- 您的程序必须生成单行输出，其中包含五个测试用例的后验 SWE 估算值（单位为 $\\mathrm{mm}$），四舍五入到三位小数，并以方括号括起来的逗号分隔列表形式呈现。",
            "solution": "该问题已经过验证，被认为是具有科学依据、适定、客观且完整的。它构成了基于雪的微波辐射传输物理学，使用线性观测算子的一维变分数据同化（1D-Var）的标准练习。所有必要的参数和条件都已提供，以获得唯一解。\n\n目标是找到雪水当量（SWE），由标量状态变量 $x$ 表示，该值能够最小化以下代价函数 $J(x)$：\n$$\nJ(x) = (x - x_b)^2 B^{-1} + (y - H(x))^T R^{-1} (y - H(x))\n$$\n其中 $x_b$ 是 SWE 的背景估计，其误差方差为 $B$；$y$ 是两个频率上观测到的亮度温度（BT）向量；$R$ 是对角观测误差协方差矩阵；$H(x)$ 是将状态 $x$ 映射到观测空间的观测算子。\n\n首先，我们必须明确定义观测算子 $H(x)$ 及其雅可比矩阵。问题陈述，频率 $f$ 下的 BT，$T_{B,f}$，可近似为 $T_{B,f} \\approx \\epsilon_f T_s$，其中 $T_s$ 是物理雪温，$\\epsilon_f$ 是发射率。发射率相对于 SWE $x$ 线性化为 $\\epsilon_f(x) \\approx \\epsilon_{0,f} - k_f x$。\n对于两个频率 $f_1$ 和 $f_2$，向量观测算子 $H(x)$ 为：\n$$\nH(x) = \\begin{pmatrix} T_s (\\epsilon_{0,f_1} - k_{f_1} x) \\\\ T_s (\\epsilon_{0,f_2} - k_{f_2} x) \\end{pmatrix}\n$$\n这是关于 $x$ 的线性算子。我们可以将其表示为 $H(x) = \\mathbf{h}_0 - \\mathbf{h}x$ 的形式，其中：\n$$\n\\mathbf{h}_0 = T_s \\begin{pmatrix} \\epsilon_{0,f_1} \\\\ \\epsilon_{0,f_2} \\end{pmatrix} \\quad \\text{and} \\quad \\mathbf{h} = T_s \\begin{pmatrix} k_{f_1} \\\\ k_{f_2} \\end{pmatrix}\n$$\n$\\mathbf{h}_0$ 代表零积雪（$x=0$）时的 BT，向量 $\\mathbf{h}$ 代表 BT 对 SWE 的敏感度。\n\n为找到代价函数 $J(x)$ 的最小值，我们必须计算其关于 $x$ 的梯度并将其设为零。\n$$\nJ(x) = B^{-1}(x - x_b)^2 + (y - (\\mathbf{h}_0 - \\mathbf{h}x))^T R^{-1} (y - (\\mathbf{h}_0 - \\mathbf{h}x))\n$$\n让我们定义新息向量（在 $x=0$ 时的观测值减去预报值）为 $\\mathbf{d} = y - \\mathbf{h}_0$。代价函数变为：\n$$\nJ(x) = B^{-1}(x - x_b)^2 + (\\mathbf{d} + \\mathbf{h}x)^T R^{-1} (\\mathbf{d} + \\mathbf{h}x)\n$$\n展开观测项：\n$$\n(\\mathbf{d} + \\mathbf{h}x)^T R^{-1} (\\mathbf{d} + \\mathbf{h}x) = \\mathbf{d}^T R^{-1} \\mathbf{d} + \\mathbf{d}^T R^{-1} \\mathbf{h}x + x\\mathbf{h}^T R^{-1} \\mathbf{d} + x^2\\mathbf{h}^T R^{-1} \\mathbf{h}\n$$\n由于所有项都是标量，且 $R^{-1}$ 是对称的，因此 $\\mathbf{d}^T R^{-1} \\mathbf{h}x = x\\mathbf{h}^T R^{-1} \\mathbf{d}$。表达式简化为：\n$$\nJ(x) = B^{-1}(x^2 - 2x_b x + x_b^2) + \\mathbf{d}^T R^{-1} \\mathbf{d} + 2x(\\mathbf{h}^T R^{-1} \\mathbf{d}) + x^2(\\mathbf{h}^T R^{-1} \\mathbf{h})\n$$\n关于 $x$ 的梯度（一阶导数）是：\n$$\n\\frac{dJ}{dx} = 2B^{-1}(x - x_b) + 2(\\mathbf{h}^T R^{-1} \\mathbf{d}) + 2x(\\mathbf{h}^T R^{-1} \\mathbf{h})\n$$\n将梯度设为 $0$ 以求最小值：\n$$\nB^{-1}(x_a - x_b) + \\mathbf{h}^T R^{-1} \\mathbf{d} + x_a(\\mathbf{h}^T R^{-1} \\mathbf{h}) = 0\n$$\n其中 $x_a$ 是 $x$ 的分析（最优）值。我们求解 $x_a$：\n$$\nx_a(B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}) = x_b B^{-1} - \\mathbf{h}^T R^{-1} \\mathbf{d}\n$$\n将 $\\mathbf{d} = y - \\mathbf{h}_0$ 代回方程：\n$$\nx_a(B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}) = x_b B^{-1} - \\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0)\n$$\n这给出了分析 SWE $x_a$ 的闭式解：\n$$\nx_a = \\frac{x_b B^{-1} - \\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0)}{B^{-1} + \\mathbf{h}^T R^{-1} \\mathbf{h}}\n$$\n二阶导数（Hessian矩阵）为 $\\frac{d^2J}{dx^2} = 2(B^{-1} + \\mathbf{h}^T R^{-1}\\mathbf{h})$。由于 $B > 0$ 且 $R$ 是一个正定协方差矩阵，因此 $R^{-1}$ 也是正定的。项 $\\mathbf{h}^T R^{-1}\\mathbf{h}$ 是一个非负的二次型，并且如果 $\\mathbf{h} \\neq 0$（由于 $k_f > 0$ 这是成立的），则为正。因此，Hessian 矩阵为正，证实我们的解对应于一个唯一的最小值。\n\n公式中的各项可以明确写出。给定 $R = \\mathrm{diag}(\\sigma_{y_1}^2, \\sigma_{y_2}^2)$，其逆为 $R^{-1} = \\mathrm{diag}(1/\\sigma_{y_1}^2, 1/\\sigma_{y_2}^2)$。标量积为：\n$$\n\\mathbf{h}^T R^{-1} \\mathbf{h} = \\frac{(T_s k_{f_1})^2}{\\sigma_{y_1}^2} + \\frac{(T_s k_{f_2})^2}{\\sigma_{y_2}^2}\n$$\n$$\n\\mathbf{h}^T R^{-1} (y - \\mathbf{h}_0) = \\frac{T_s k_{f_1}}{\\sigma_{y_1}^2}(y_1 - T_s \\epsilon_{0,f_1}) + \\frac{T_s k_{f_2}}{\\sigma_{y_2}^2}(y_2 - T_s \\epsilon_{0,f_2})\n$$\n因此，用于实现的最终方程是：\n$$\nx_a = \\frac{\\frac{x_b}{B} - \\left[ \\frac{T_s k_{f_1}(y_1 - T_s \\epsilon_{0,f_1})}{\\sigma_{y_1}^2} + \\frac{T_s k_{f_2}(y_2 - T_s \\epsilon_{0,f_2})}{\\sigma_{y_2}^2} \\right]}{\\frac{1}{B} + \\frac{(T_s k_{f_1})^2}{\\sigma_{y_1}^2} + \\frac{(T_s k_{f_2})^2}{\\sigma_{y_2}^2}}\n$$\n最后，由于 SWE 在物理上必须是非负的，结果被投影到可行集上：\n$$\nx_a \\leftarrow \\max(0, x_a)\n$$\n此过程应用于每个测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves for the posterior Snow Water Equivalent (SWE) using a 1D-Var assimilation scheme.\n    \"\"\"\n\n    # Test cases are provided as tuples with the following structure:\n    # (Ts, e0_f1, e0_f2, k_f1, k_f2, y1, y2, xb, B, R11, R22)\n    test_cases = [\n        # Case 1\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 241.1, 227.4, 100.0, 900.0, 4.0, 9.0),\n        # Case 2\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 246.8, 238.8, 20.0, 400.0, 4.0, 4.0),\n        # Case 3\n        (260.0, 0.95, 0.92, 1.5e-4, 3.0e-4, 235.1, 216.2, 250.0, 1600.0, 9.0, 9.0),\n        # Case 4\n        (240.0, 0.96, 0.93, 1.5e-4, 3.0e-4, 226.1, 214.7, 130.0, 900.0, 4.0, 9.0),\n        # Case 5\n        (265.0, 0.94, 0.91, 1.5e-4, 3.0e-4, 241.9, 226.9, 160.0, 900.0, 4.0, 25.0)\n    ]\n\n    results = []\n\n    for case in test_cases:\n        Ts, e0_f1, e0_f2, k_f1, k_f2, y1, y2, xb, B, sy1_sq, sy2_sq = case\n\n        # Numerator calculation for the analysis SWE formula\n        # Numerator = xb*B^-1 - h^T * R^-1 * (y - h0)\n        \n        # Background term in numerator\n        num_bg_term = xb / B\n\n        # h^T * R^-1 * (y - h0) term\n        # First component: h1 * R11^-1 * (y1 - h0_1)\n        h0_1 = Ts * e0_f1\n        h1 = Ts * k_f1\n        innov_term1 = (h1 * (y1 - h0_1)) / sy1_sq\n        \n        # Second component: h2 * R22^-1 * (y2 - h0_2)\n        h0_2 = Ts * e0_f2\n        h2 = Ts * k_f2\n        innov_term2 = (h2 * (y2 - h0_2)) / sy2_sq\n        \n        # Full numerator\n        numerator = num_bg_term - (innov_term1 + innov_term2)\n\n        # Denominator calculation for the analysis SWE formula\n        # Denominator = B^-1 + h^T * R^-1 * h\n        \n        # Background term in denominator\n        den_bg_term = 1.0 / B\n        \n        # h^T * R^-1 * h term\n        hRh_term = (h1**2 / sy1_sq) + (h2**2 / sy2_sq)\n        \n        # Full denominator\n        denominator = den_bg_term + hRh_term\n\n        # Calculate analysis SWE (xa)\n        if denominator == 0:\n            # This case shouldn't happen with the given problem constraints\n            # (B > 0, R positive definite, k_f > 0)\n            xa_unconstrained = 0.0\n        else:\n            xa_unconstrained = numerator / denominator\n\n        # Apply non-negativity constraint by projection\n        xa = max(0.0, xa_unconstrained)\n        \n        results.append(f\"{xa:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        }
    ]
}