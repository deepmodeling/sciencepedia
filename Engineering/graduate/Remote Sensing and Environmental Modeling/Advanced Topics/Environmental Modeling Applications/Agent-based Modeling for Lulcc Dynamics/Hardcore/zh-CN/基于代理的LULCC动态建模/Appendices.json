{
    "hands_on_practices": [
        {
            "introduction": "智能体决策规则是构建智能体模型（ABM）的微观基础和核心。本练习探讨了两种常见的决策模型——随机效用模型（Random Utility Models, RUM）和阈值启发式规则——之间的理论联系。通过推导两者在特定条件下的近似关系，你将更深入地理解模型选择如何影响智能体行为的表征，并掌握评估模型简化对结果影响的分析技巧。",
            "id": "3795616",
            "problem": "一个用于土地利用和土地覆被变化（LULCC）的保护规划代理人基模型（ABM）使用随机效用模型（RUM）来表示地块级别的土地转换决策。每个代理人比较“转换”与“不转换”两种行为的效用。设效用差异的确定性部分用 $\\Delta \\in \\mathbb{R}$ 表示，它通过一个线性指数汇集了遥感衍生的协变量（例如，植被指数，到道路的距离）。效用差异的随机性部分被建模为独立同分布的I型极值误差（Gumbel分布），这是一个经过充分检验的假设，它意味着转换行为遵循逻辑斯蒂选择概率。将逻辑斯蒂函数表示为 $\\sigma(x) = \\frac{1}{1 + \\exp(-x)}$。\n\n在随机效用模型（RUM）中，对于给定的 $\\Delta$，转换的概率为 $p(\\Delta) = \\sigma(\\alpha \\Delta)$，其中斜率参数 $\\alpha > 0$ 反映了特质噪声相对于确定性效用的尺度。作为一种计算上更简单的启发式方法，一个基于阈值的决策规则形式为 $d(\\Delta) = \\mathbb{I}(\\Delta \\ge 0)$，其中 $\\mathbb{I}(\\cdot)$ 是指示函数。\n\n假设在所有地块中，确定性效用差异 $\\Delta$ 服从均值为 $0$、尺度参数为 $s > 0$ 的逻辑斯蒂分布，其概率密度函数为 $f(\\Delta) = \\frac{1}{s} \\cdot \\frac{\\exp(-\\Delta/s)}{\\left(1 + \\exp(-\\Delta/s)\\right)^{2}}$。考虑用阈值规则 $d(\\Delta)$ 来近似逻辑斯蒂选择规则 $p(\\Delta)$。\n\n1. 给出一个包含 $\\alpha$ 和 $s$ 的无量纲条件，在该条件下，阈值模型是逻辑斯蒂选择规则在决策边界附近的一阶近似，其意义在于 $p(\\Delta)$ 的陡峭程度与各地块间 $\\Delta$ 的变化尺度相匹配。\n\n2. 在该条件下，计算期望绝对近似误差\n$$\nE = \\mathbb{E}\\left[\\,\\left|\\,\\mathbb{I}(\\Delta \\ge 0) - \\sigma(\\alpha \\Delta)\\,\\right|\\,\\right]\n$$\n其中期望是关于上面给出的 $\\Delta$ 的逻辑斯蒂分布计算的。将最终答案表示为一个精确的实数。不需要四舍五入，且 $E$ 是无量纲的，没有物理单位。",
            "solution": "该问题提出了关于逻辑斯蒂选择模型与一个更简单的土地转换决策阈值模型之间关系的两个任务。首先，我们必须建立一个关联参数 $\\alpha$ 和 $s$ 的条件。其次，在该条件下，我们必须计算两个模型之间的期望绝对近似误差。\n\n第1部分：无量纲条件\n问题要求找到一个条件，使得阈值模型 $d(\\Delta) = \\mathbb{I}(\\Delta \\ge 0)$ 成为逻辑斯蒂选择规则 $p(\\Delta) = \\sigma(\\alpha \\Delta)$ 的一阶近似，其意义在于“$p(\\Delta)$ 的陡峭程度与 $\\Delta$ 的变化尺度相匹配”。\n\n决策边界位于 $\\Delta=0$ 处，在该点，代理人基于确定性效用对于转换与不转换是无差异的。概率选择函数 $p(\\Delta)$ 在此边界的“陡峭程度”由其在 $\\Delta=0$ 处的导数给出。该函数为 $p(\\Delta) = \\sigma(\\alpha \\Delta)$，其中 $\\sigma(x) = (1 + \\exp(-x))^{-1}$。\n\n逻辑斯蒂函数的导数是 $\\sigma'(x) = \\sigma(x)(1-\\sigma(x))$。使用链式法则，$p(\\Delta)$ 的导数是：\n$$ p'(\\Delta) = \\frac{d}{d\\Delta} \\sigma(\\alpha \\Delta) = \\alpha \\cdot \\sigma'(\\alpha \\Delta) = \\alpha \\cdot \\sigma(\\alpha \\Delta) (1 - \\sigma(\\alpha \\Delta)) $$\n在决策边界 $\\Delta=0$ 处计算该导数：\n$$ p'(0) = \\alpha \\cdot \\sigma(0) (1-\\sigma(0)) $$\n由于 $\\sigma(0) = (1 + \\exp(0))^{-1} = \\frac{1}{2}$，陡峭程度为：\n$$ p'(0) = \\alpha \\cdot \\frac{1}{2} \\cdot \\left(1-\\frac{1}{2}\\right) = \\frac{\\alpha}{4} $$\n量 $p'(0)$ 的单位是效用的倒数（$\\Delta^{-1}$）。\n\n问题陈述效用差异 $\\Delta$ 服从均值为 $0$、尺度参数为 $s > 0$ 的逻辑斯蒂分布。其概率密度函数（PDF）给出为：\n$$ f(\\Delta) = \\frac{1}{s} \\cdot \\frac{\\exp(-\\Delta/s)}{\\left(1 + \\exp(-\\Delta/s)\\right)^{2}} $$\n“$\\Delta$ 的变化尺度”这个短语指的是参数 $s$，它描述了这个分布的宽度。为了构建一个“匹配”陡峭程度与该尺度的无量纲条件，我们必须比较具有相同物理量纲的量。PDF $f(\\Delta)$ 的单位是概率密度，也就是效用的倒数（$\\Delta^{-1}$），与 $p'(\\Delta)$ 的单位相同。一个自然且具有物理意义的匹配条件解释是，将响应函数在决策边界处的陡峭程度与效用差异在同一点的概率密度相等同。这确保了在最常见的效用值（$\\Delta=0$）处，选择概率的敏感性与该值出现的可能性直接相关。\n\n因此，我们令 $p'(0) = f(0)$：\n$$ \\frac{\\alpha}{4} = \\frac{1}{s} \\cdot \\frac{\\exp(-0/s)}{\\left(1 + \\exp(-0/s)\\right)^{2}} = \\frac{1}{s} \\cdot \\frac{1}{(1+1)^2} = \\frac{1}{4s} $$\n这个等式简化为 $\\alpha = \\frac{1}{s}$，或者等价地，无量纲条件是：\n$$ \\alpha s = 1 $$\n\n第2部分：期望绝对近似误差\n我们被要求在条件 $\\alpha s = 1$ 下计算期望绝对近似误差 $E$。误差定义为：\n$$ E = \\mathbb{E}\\left[\\,\\left|\\,\\mathbb{I}(\\Delta \\ge 0) - \\sigma(\\alpha \\Delta)\\,\\right|\\,\\right] $$\n期望是关于 $\\Delta$ 的分布计算的，所以我们必须计算积分：\n$$ E = \\int_{-\\infty}^{\\infty} \\left|\\,\\mathbb{I}(\\Delta \\ge 0) - \\sigma(\\alpha \\Delta)\\,\\right|\\, f(\\Delta) \\,d\\Delta $$\n我们必须根据指示函数 $\\mathbb{I}(\\Delta \\ge 0)$ 的定义将积分分成两部分。\n当 $\\Delta  0$ 时，$\\mathbb{I}(\\Delta \\ge 0) = 0$。绝对值内的项是 $-\\sigma(\\alpha \\Delta)$。由于 $\\alpha > 0$ 且 $\\Delta  0$，则 $\\alpha \\Delta  0$，这意味着 $0  \\sigma(\\alpha \\Delta)  \\frac{1}{2}$。因此， $|-\\sigma(\\alpha \\Delta)| = \\sigma(\\alpha \\Delta)$。\n当 $\\Delta \\ge 0$ 时，$\\mathbb{I}(\\Delta \\ge 0) = 1$。绝对值内的项是 $1 - \\sigma(\\alpha \\Delta)$。由于 $\\alpha > 0$ 且 $\\Delta \\ge 0$，则 $\\alpha \\Delta \\ge 0$，这意味着 $\\frac{1}{2} \\le \\sigma(\\alpha \\Delta)  1$。因此，$1 - \\sigma(\\alpha \\Delta) \\ge 0$，绝对值是不必要的。\n\n因此，$E$ 的积分可以写成：\n$$ E = \\int_{-\\infty}^{0} \\sigma(\\alpha \\Delta) f(\\Delta) \\,d\\Delta + \\int_{0}^{\\infty} (1 - \\sigma(\\alpha \\Delta)) f(\\Delta) \\,d\\Delta $$\n现在，我们应用第1部分中导出的条件 $\\alpha = \\frac{1}{s}$。将此代入被积函数中得到：\n$$ E = \\int_{-\\infty}^{0} \\sigma(\\Delta/s) f(\\Delta) \\,d\\Delta + \\int_{0}^{\\infty} (1 - \\sigma(\\Delta/s)) f(\\Delta) \\,d\\Delta $$\n我们可以通过认识到PDF $f(\\Delta)$ 是 $\\Delta$ 的累积分布函数（CDF）的导数来简化此式。对于均值为 $0$、尺度参数为 $s$ 的逻辑斯蒂分布，其CDF为 $F(\\Delta) = \\sigma(\\Delta/s)$。因此，$f(\\Delta) = \\frac{d}{d\\Delta} \\sigma(\\Delta/s)$。\n\n让我们进行变量替换。令 $u = \\sigma(\\Delta/s)$。那么 $du = \\left(\\frac{d}{d\\Delta} \\sigma(\\Delta/s)\\right) d\\Delta = f(\\Delta) d\\Delta$。我们还必须变换积分的上下限：\n当 $\\Delta \\to -\\infty$ 时，$u \\to \\sigma(-\\infty) = 0$。\n当 $\\Delta \\to 0$ 时，$u \\to \\sigma(0) = \\frac{1}{2}$。\n当 $\\Delta \\to \\infty$ 时，$u \\to \\sigma(\\infty) = 1$。\n\n代入 $E$ 的表达式中：\n$$ E = \\int_{0}^{1/2} u \\,du + \\int_{1/2}^{1} (1-u) \\,du $$\n这些都是基本积分。我们计算它们：\n$$ \\int_{0}^{1/2} u \\,du = \\left[ \\frac{u^2}{2} \\right]_{0}^{1/2} = \\frac{(1/2)^2}{2} - 0 = \\frac{1/4}{2} = \\frac{1}{8} $$\n$$ \\int_{1/2}^{1} (1-u) \\,du = \\left[ u - \\frac{u^2}{2} \\right]_{1/2}^{1} = \\left(1 - \\frac{1^2}{2}\\right) - \\left(\\frac{1}{2} - \\frac{(1/2)^2}{2}\\right) = \\left(\\frac{1}{2}\\right) - \\left(\\frac{1}{2} - \\frac{1}{8}\\right) = \\frac{1}{2} - \\frac{3}{8} = \\frac{4-3}{8} = \\frac{1}{8} $$\n总期望绝对误差是这两个结果的和：\n$$ E = \\frac{1}{8} + \\frac{1}{8} = \\frac{2}{8} = \\frac{1}{4} $$\n期望绝对误差是一个精确的实数，并且如要求的那样是无量纲的。",
            "answer": "$$\\boxed{\\frac{1}{4}}$$"
        },
        {
            "introduction": "在理解了单个智能体的决策机制后，下一步是将其整合到一个完整的空间动态模型中。这个实践任务要求你从零开始，通过编程实现一个用于土地利用和土地覆被变化（LULCC）的智能体模型。你将学习如何融合遥感数据代理（如NDVI）、平衡经济与生态目标的效用函数，以及邻域效应，亲手体验这些不同尺度的组件如何相互作用，最终涌现出宏观的景观格局。",
            "id": "3795634",
            "problem": "考虑一个基于网格的土地利用和土地覆盖变化 (LULCC) 的主体基模型，其中每个网格单元由一个代表性主体控制，该主体选择一种土地利用方式以最大化一个整合了私人利润和生态系统服务估值的效用函数。主体面临转换成本和破碎化惩罚。模型参数和更新规则使用基本的微观经济学和环境建模原理来定义。\n\n网格和索引：\n- 设网格大小为 $N \\times N$，其中 $N=5$，索引为 $(i,j)$，其中 $i,j \\in \\{0,1,2,3,4\\}$。\n- 定义中心坐标为 $(i_c,j_c) = \\left(\\frac{N-1}{2},\\frac{N-1}{2}\\right) = (2,2)$。\n\n遥感代理：\n- 归一化植被指数 (NDVI) 代理 $v_{i,j}$：$$v_{i,j} = 0.2 + 0.8 \\cdot \\frac{i + j}{2(N - 1)}.$$\n- 坡度代理 $r_{i,j}$：$$r_{i,j} = \\frac{|i - j|}{N - 1}.$$\n- 可达性代理 $H_{i,j}$，使用到中心的归一化欧几里得距离：\n  $$d_{i,j} = \\sqrt{(i - i_c)^2 + (j - j_c)^2}, \\quad d_{\\max} = \\sqrt{2}\\cdot\\frac{N-1}{2}, \\quad H_{i,j} = 1 - \\frac{d_{i,j}}{d_{\\max}}.$$\n\n土地利用类型：\n- 土地利用类型集合为 $\\{A,F,U\\}$，其中 $A$ 代表农业，$F$ 代表林业，$U$ 代表城市。\n\n各地块 $(i,j)$ 每种土地利用类型 $L \\in \\{A,F,U\\}$ 的私人利润组成部分：\n- 农业：产量 $Y_{i,j} = y_0 \\cdot v_{i,j}$ 和利润 $\\pi^A_{i,j} = P_A \\cdot Y_{i,j}$。\n- 林业：木材代理 $T_{i,j} = t_0 \\cdot v_{i,j}$ 和利润 $\\pi^F_{i,j} = P_F \\cdot T_{i,j}$。\n- 城市：可达性驱动的利润 $\\pi^U_{i,j} = P_U \\cdot H_{i,j}$。\n- 使用归一化系数 $y_0 = 1.0$，$t_0 = 0.8$，$P_A = 1.0$，$P_F = 0.7$，$P_U = 1.5$。\n\n生态系统服务估值（社会效益）组成部分：\n- 农业：侵蚀外部性 $b^A_{i,j} = -\\alpha \\cdot r_{i,j}$。\n- 林业：碳固存 $b^F_{i,j} = \\beta \\cdot v_{i,j}$。\n- 城市：服务损失 $b^U_{i,j} = -\\gamma \\cdot v_{i,j}$。\n- 使用系数 $\\alpha = 0.5$，$\\beta = 1.2$，$\\gamma = 1.0$。\n\n主体效用、转换成本和破碎化惩罚：\n- 令 $w \\in [0,1]$ 表示主体效用中的生态系统服务权重。\n- 令 $c \\ge 0$ 表示如果主体在时间步之间改变土地利用类型时所应用的转换成本。\n- 令 $\\phi \\ge 0$ 表示破碎化惩罚系数。对于一个候选土地利用类型 $L$ 和当前的邻域配置，定义\n  $$\\Delta_{i,j}(L) = \\frac{1}{4} \\sum_{(p,q) \\in \\mathcal{N}_{i,j}} \\mathbf{1}\\{L \\ne L_{p,q}^{\\text{prev}}\\},$$\n  其中 $\\mathcal{N}_{i,j}$ 是 $(i,j)$ 的最多四个正交邻居（上、下、左、右）的集合，而 $L_{p,q}^{\\text{prev}}$ 是邻居之前的土地利用类型。\n- 地块 $(i,j)$ 选择土地利用类型 $L$ 而其之前的土地利用类型为 $L_{i,j}^{\\text{prev}}$ 时的效用为\n  $$U_{i,j}(L) = (1 - w) \\cdot \\pi^L_{i,j} + w \\cdot b^L_{i,j} - c \\cdot \\mathbf{1}\\{L \\ne L_{i,j}^{\\text{prev}}\\} - \\phi \\cdot \\Delta_{i,j}(L).$$\n\n决策规则和动态：\n- 时间是离散的，时间范围为 $T = 3$。在每个时间步 $t \\in \\{1,2,3\\}$，主体通过选择最大化 $U_{i,j}(L)$ 的 $L \\in \\{A,F,U\\}$ 来同步更新土地利用，该效用是使用前一步的配置计算的。\n- 如果不同土地利用的效用值出现平局，则按照 $F \\succ A \\succ U$ 的确定性优先顺序打破平局（林业优于农业，农业优于城市）。\n\n初始化：\n- 初始土地利用 $L_{i,j}^{(0)}$ 根据代理变量确定性地分配：\n  $$L_{i,j}^{(0)} = \n  \\begin{cases}\n  U  \\text{如果 } H_{i,j} \\ge 0.75,\\\\\n  F  \\text{否则，如果 } v_{i,j} \\ge 0.6,\\\\\n  A  \\text{其他情况。}\n  \\end{cases}$$\n\n输出：\n- 在 $T = 3$ 个时间步后，为最终配置计算：\n  - 农业、林业和城市地块的比例：$f_A$、$f_F$、$f_U$，每个都以 $[0,1]$ 区间内的小数表示。\n  - 总私人利润 $\\Pi_{\\text{tot}} = \\sum_{i,j} \\pi^{L_{i,j}^{(T)}}_{i,j}$（无量纲的归一化货币指数）。\n  - 总社会效益 $B_{\\text{tot}} = \\sum_{i,j} b^{L_{i,j}^{(T)}}_{i,j}$（无量纲的生态系统服务估值指数）。\n\n测试套件：\n- 对于每个测试用例，参数 $(w,c,\\phi)$ 分别为：\n  1. $(0.0, 0.0, 0.0)$，纯私人利润且无成本的边界情况。\n  2. $(0.5, 0.2, 0.1)$，具有中等成本和破碎化惩罚的平衡权衡。\n  3. $(0.8, 0.2, 0.1)$，偏重社会效益且有中等成本的权重。\n  4. $(1.0, 0.0, 0.1)$，纯社会效益，无转换成本。\n  5. $(0.25, 0.5, 0.2)$，偏向利润的权重，具有高转换成本和更高的破碎化惩罚。\n\n最终输出格式：\n- 你的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个测试用例的结果本身是一个由方括号括起来的逗号分隔列表，包含五个保留六位小数的十进制数，顺序为 $[f_A,f_F,f_U,\\Pi_{\\text{tot}},B_{\\text{tot}}]$。例如：$[[0.20,0.60,0.20,10.000000,5.000000],[\\dots],\\dots]$。",
            "solution": "该模型基于微观经济学的效用最大化，并整合了生态系统服务估值，结合了环境经济学和遥感代理的成熟概念。控制一个地块的每个主体选择一种土地利用方式，以最大化一个在转换成本和破碎化惩罚的约束下，平衡私人盈利能力和社会效益的效用函数。\n\n基础和代理：\n- 归一化植被指数 (NDVI) 代理 $v_{i,j}$ 作为生物量和潜在生产力的指标，适合作为农业产量和林业木材潜力的标量乘数。所选函数形式 $v_{i,j} = 0.2 + 0.8 \\cdot \\frac{i + j}{2(N - 1)}$ 是网格上的确定性梯度，确保值在 $[0.2,1.0]$ 区间内。\n- 坡度代理 $r_{i,j} = \\frac{|i - j|}{N - 1}$ 捕捉了沿对角线排列的简单地形梯度，这与坡度越高侵蚀风险越大的概念一致。\n- 可达性 $H_{i,j} = 1 - \\frac{d_{i,j}}{d_{\\max}}$ 使用到网格中心的归一化欧几里得距离，作为交通和市场准入的代理，其中 $H_{i,j} \\in [0,1]$。\n\n私人利润建模：\n- 农业利润为 $\\pi^A_{i,j} = P_A \\cdot y_0 \\cdot v_{i,j}$，其中 $P_A = 1.0$ 和 $y_0 = 1.0$，反映了与 $v_{i,j}$ 成正比的生产力。\n- 林业利润为 $\\pi^F_{i,j} = P_F \\cdot t_0 \\cdot v_{i,j}$，其中 $P_F = 0.7$ 和 $t_0 = 0.8$，低于农业，因为假设其市场回报和生产强度较低。\n- 城市利润为 $\\pi^U_{i,j} = P_U \\cdot H_{i,j}$，其中 $P_U = 1.5$，由可达性驱动。\n\n生态系统服务估值：\n- 农业外部性 $b^A_{i,j} = -\\alpha \\cdot r_{i,j}$ 惩罚侵蚀风险，其中 $\\alpha = 0.5$。\n- 林业效益 $b^F_{i,j} = \\beta \\cdot v_{i,j}$ 评估碳和栖息地服务，其中 $\\beta = 1.2$。\n- 城市外部性 $b^U_{i,j} = -\\gamma \\cdot v_{i,j}$ 惩罚植被服务的损失，其中 $\\gamma = 1.0$。\n\n效用整合与权衡：\n- 效用定义为\n  $$U_{i,j}(L) = (1 - w) \\cdot \\pi^L_{i,j} + w \\cdot b^L_{i,j} - c \\cdot \\mathbf{1}\\{L \\ne L_{i,j}^{\\text{prev}}\\} - \\phi \\cdot \\Delta_{i,j}(L),$$\n  其中 $w \\in [0,1]$ 是社会价值相对于私人利润的权重。这直接编码了权衡关系：较高的 $w$ 增加了生态系统服务的影响，可能有利于林业；较低的 $w$ 有利于私人利润，可能有利于城市或农业，具体取决于 $H_{i,j}$ 和 $v_{i,j}$。\n\n破碎化惩罚：\n- 破碎化项 $\\Delta_{i,j}(L) = \\frac{1}{4} \\sum_{(p,q) \\in \\mathcal{N}_{i,j}} \\mathbf{1}\\{L \\ne L_{p,q}^{\\text{prev}}\\}$ 惩罚与紧邻区域不一致的选择，通过鼓励空间上连贯的土地利用集群来减少景观破碎化。除以 $4$ 将惩罚归一化到 $[0,1]$ 范围内。\n\n动态与决策规则：\n- 主体在 $T = 3$ 个步骤内同步更新，在计算 $\\Delta_{i,j}(L)$ 时使用邻居在前一步的土地利用。这种同步更新反映了主体基模型中的一种常见设计，即决策基于先前的配置。\n- 打破平局使用确定性顺序 $F \\succ A \\succ U$ 以确保可复现性并避免随机结果。\n\n初始化理由：\n- 初始土地利用 $L_{i,j}^{(0)}$ 使用了与经验直觉一致的阈值：高可达性地块 ($H_{i,j} \\ge 0.75$) 初始化为城市；否则，高 NDVI ($v_{i,j} \\ge 0.6$) 初始化为林业；其余地块初始化为农业。这会产生一个具有合理空间结构的混合初始景观。\n\n每个测试用例 $(w,c,\\phi)$ 的算法步骤：\n1. 计算所有地块 $(i,j)$ 的 $v_{i,j}$、$r_{i,j}$ 和 $H_{i,j}$。\n2. 基于阈值规则初始化 $L_{i,j}^{(0)}$。\n3. 对于每个时间步 $t = 1,2,3$：\n   - 对于每个地块 $(i,j)$，使用 $\\pi^L_{i,j}$、$b^L_{i,j}$、相对于 $L_{i,j}^{(t-1)}$ 的转换成本，以及基于邻居在时间 $t-1$ 的土地利用的破碎化惩罚 $\\Delta_{i,j}(L)$，来计算效用 $U_{i,j}(A)$、$U_{i,j}(F)$ 和 $U_{i,j}(U)$。\n   - 选择效用最高的土地利用类型 $L$。如果出现平局，则根据 $F \\succ A \\succ U$ 选择。\n   - 同步更新所有 $L_{i,j}^{(t)}$。\n4. 在 $t = 3$ 之后，计算：\n   - 通过计算每种土地利用类型的出现次数并除以 $N^2$ 来得到比例 $f_A$、$f_F$、$f_U$。\n   - 总私人利润 $\\Pi_{\\text{tot}} = \\sum_{i,j} \\pi^{L_{i,j}^{(3)}}_{i,j}$。\n   - 总社会效益 $B_{\\text{tot}} = \\sum_{i,j} b^{L_{i,j}^{(3)}}_{i,j}$。\n5. 将每个输出值四舍五入到六位小数，并按指定顺序报告。\n\n测试套件覆盖范围：\n- $(w,c,\\phi) = (0.0, 0.0, 0.0)$ 测试主体仅在没有调整成本的情况下最大化私人利润的边界情况。\n- $(w,c,\\phi) = (0.5, 0.2, 0.1)$ 测试具有中等转换成本和破碎化惩罚的平衡权重。\n- $(w,c,\\phi) = (0.8, 0.2, 0.1)$ 测试对社会效益的高度重视，这应该有利于 $v_{i,j}$ 值高的林地利用。\n- $(w,c,\\phi) = (1.0, 0.0, 0.1)$ 测试决策完全由生态系统服务驱动的极端情况；破碎化仍然会抑制分散的变化。\n- $(w,c,\\phi) = (0.25, 0.5, 0.2)$ 测试在偏向利润的机制下，由于高转换成本和更强的破碎化惩罚而产生的对变化的抵抗力。\n\n最终输出格式：\n- 打印的单行必须是一个由方括号括起来的、逗号分隔的列表，其中包含每个测试用例的方括号括起来的结果，没有空格，每个子列表包含 $[f_A,f_F,f_U,\\Pi_{\\text{tot}},B_{\\text{tot}}]$，四舍五入到六位小数，例如：$[[0.240000,0.520000,0.240000,12.345678,3.210987],[\\dots],\\dots]$。\n\n该公式遵循第一性原理下的效用最大化决策，并整合了生态系统服务估值，从而可以透明地分析不同参数机制下私人利润与社会福利之间的权衡。",
            "answer": "```python\n# Python 3.12\n# Libraries: numpy 1.23.5, scipy 1.11.4 (not used)\nimport numpy as np\n\n# Land use labels\nA = 0  # Agriculture\nF = 1  # Forest\nU = 2  # Urban\n\ndef compute_proxies(N):\n    # NDVI proxy v, slope proxy r, accessibility proxy H\n    v = np.zeros((N, N), dtype=float)\n    r = np.zeros((N, N), dtype=float)\n    H = np.zeros((N, N), dtype=float)\n    ic = (N - 1) / 2.0\n    jc = (N - 1) / 2.0\n    dmax = np.sqrt(2.0) * (N - 1) / 2.0\n    for i in range(N):\n        for j in range(N):\n            v[i, j] = 0.2 + 0.8 * ((i + j) / (2.0 * (N - 1)))\n            r[i, j] = abs(i - j) / (N - 1)\n            di = np.sqrt((i - ic)**2 + (j - jc)**2)\n            H[i, j] = 1.0 - (di / dmax)\n    return v, r, H\n\ndef initialize_land_use(v, H):\n    # Threshold-based initialization:\n    # U if H = 0.75, else F if v = 0.6, else A\n    N = v.shape[0]\n    L0 = np.zeros((N, N), dtype=int)\n    for i in range(N):\n        for j in range(N):\n            if H[i, j] = 0.75:\n                L0[i, j] = U\n            elif v[i, j] = 0.6:\n                L0[i, j] = F\n            else:\n                L0[i, j] = A\n    return L0\n\ndef compute_profits_and_benefits(v, r, H, params):\n    # params contains y0, t0, P_A, P_F, P_U, alpha, beta, gamma\n    y0, t0, P_A, P_F, P_U, alpha, beta, gamma = params\n    pi_A = P_A * (y0 * v)\n    pi_F = P_F * (t0 * v)\n    pi_U = P_U * H\n\n    b_A = -alpha * r\n    b_F = beta * v\n    b_U = -gamma * v\n\n    return pi_A, pi_F, pi_U, b_A, b_F, b_U\n\ndef neighbors(i, j, N):\n    # Return list of neighbor indices (up to 4-neighborhood)\n    neigh = []\n    if i  0:\n        neigh.append((i - 1, j))\n    if i  N - 1:\n        neigh.append((i + 1, j))\n    if j  0:\n        neigh.append((i, j - 1))\n    if j  N - 1:\n        neigh.append((i, j + 1))\n    return neigh\n\ndef simulate(N, T, w, c, phi, v, r, H, profits_benefits, L0):\n    # Unpack profits and benefits\n    pi_A, pi_F, pi_U, b_A, b_F, b_U = profits_benefits\n\n    # Tie-breaker priority: F  A  U\n    priority = {F: 2, A: 1, U: 0}\n\n    L_prev = L0.copy()\n    for t in range(1, T + 1):\n        L_next = np.zeros_like(L_prev)\n        for i in range(N):\n            for j in range(N):\n                # Fragmentation penalty computed using neighbors from previous step\n                neigh_idxs = neighbors(i, j, N)\n\n                # Candidate land uses\n                candidates = [A, F, U]\n                utilities = []\n                for L in candidates:\n                    # Private profit and social benefit for chosen L\n                    if L == A:\n                        pi = pi_A[i, j]\n                        b = b_A[i, j]\n                    elif L == F:\n                        pi = pi_F[i, j]\n                        b = b_F[i, j]\n                    else:  # U\n                        pi = pi_U[i, j]\n                        b = b_U[i, j]\n\n                    # Switching cost if change from previous\n                    switch = 1.0 if L != L_prev[i, j] else 0.0\n\n                    # Fragmentation penalty: fraction of neighbors not matching L divided by 4\n                    mismatch = 0.0\n                    for (p, q) in neigh_idxs:\n                        if L != L_prev[p, q]:\n                            mismatch += 1.0\n                    delta = mismatch / 4.0\n\n                    UijL = (1.0 - w) * pi + w * b - c * switch - phi * delta\n                    utilities.append((UijL, priority[L], L))\n\n                # Choose max utility, tie-breaking by priority\n                # Sort by utility then priority\n                utilities.sort(key=lambda tup: (tup[0], tup[1]), reverse=True)\n                chosen_L = utilities[0][2]\n                L_next[i, j] = chosen_L\n        L_prev = L_next\n\n    # Compute final fractions and totals\n    total_cells = float(N * N)\n    fA = float(np.sum(L_prev == A)) / total_cells\n    fF = float(np.sum(L_prev == F)) / total_cells\n    fU = float(np.sum(L_prev == U)) / total_cells\n\n    # Totals\n    Pi_tot = 0.0\n    B_tot = 0.0\n    for i in range(N):\n        for j in range(N):\n            L = L_prev[i, j]\n            if L == A:\n                Pi_tot += pi_A[i, j]\n                B_tot += b_A[i, j]\n            elif L == F:\n                Pi_tot += pi_F[i, j]\n                B_tot += b_F[i, j]\n            else:\n                Pi_tot += pi_U[i, j]\n                B_tot += b_U[i, j]\n\n    return fA, fF, fU, Pi_tot, B_tot\n\ndef format_result_list(results):\n    # Results is a list of tuples/lists of floats.\n    # Produce string like [[a,b,c,d,e],[...],...], with values rounded to 6 decimals and no spaces.\n    def fmt(vals):\n        return \"[\" + \",\".join(f\"{x:.6f}\" for x in vals) + \"]\"\n    return \"[\" + \",\".join(fmt(res) for res in results) + \"]\"\n\ndef solve():\n    N = 5\n    T = 3\n\n    # Base parameters\n    y0 = 1.0\n    t0 = 0.8\n    P_A = 1.0\n    P_F = 0.7\n    P_U = 1.5\n    alpha = 0.5\n    beta = 1.2\n    gamma = 1.0\n    params = (y0, t0, P_A, P_F, P_U, alpha, beta, gamma)\n\n    # Compute proxies\n    v, r, H = compute_proxies(N)\n\n    # Initialize land use\n    L0 = initialize_land_use(v, H)\n\n    # Compute profits and benefits (constant across test cases)\n    profits_benefits = compute_profits_and_benefits(v, r, H, params)\n\n    # Test cases: (w, c, phi)\n    test_cases = [\n        (0.0, 0.0, 0.0),  # Pure private profit, no costs\n        (0.5, 0.2, 0.1),  # Balanced trade-off, moderate costs\n        (0.8, 0.2, 0.1),  # Social-benefit-heavy\n        (1.0, 0.0, 0.1),  # Pure social benefit\n        (0.25, 0.5, 0.2), # Profit-leaning, high switching  fragmentation cost\n    ]\n\n    results = []\n    for (w, c, phi) in test_cases:\n        fA, fF, fU, Pi_tot, B_tot = simulate(N, T, w, c, phi, v, r, H, profits_benefits, L0)\n        results.append((fA, fF, fU, Pi_tot, B_tot))\n\n    # Final print statement in the exact required format.\n    print(format_result_list(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "构建模型只是第一步，更关键的是如何利用模型进行科学探究。ABM可以被看作一个虚拟实验室，而严谨的实验设计是获得可靠结论的保障。本练习聚焦于ABM的实验设计与统计分析，要求你应用因子设计原理来确定需要多少次模拟运行，才能以足够的精度估计关键驱动因素及其交互作用对森林砍伐的影响。这能训练你规划模型敏感性分析和参数探索的关键技能。",
            "id": "3795628",
            "problem": "一个土地利用和土地覆被变化（LULCC）的基于主体的模型（ABM）被用来在一个从遥感土地覆被图派生出的空间网格上模拟十年间的森林砍伐动态。输出响应是在模拟期末 $T$ 时剩余的森林覆盖率，记为 $Y \\in [0,1]$。基于遥感产品和环境经济驱动因素，选择了三个科学上显著的驱动因素进行实验操作：道路影响衰减长度尺度（记为 $\\lambda$）、政策执行强度（记为 $\\eta$）和全球商品需求压力（记为 $\\phi$）。每个驱动因素在两个水平上进行研究，编码为-1（低）和+1（高），构成一个具有 $2^{3}$ 个独特设置的全因子设计。对于每个设置，由于内在的主体级别随机性，进行了 $r$ 次独立的随机ABM运行，从而产生一个总运行次数为 $N = 2^{3} r$ 的平衡重复设计。\n\n假设采用以下研究设计和统计模型：\n- 拟合ABM输出的线性模型包括一个截距、所有三个主效应以及所有三个双因素交互作用；为了保持简约性，排除了三因素交互作用。设计矩阵对因子及其交互作用使用正交的 $\\{-1,+1\\}$ 编码。\n- ABM运行级别的误差是独立同分布的，均值为零，方差为 $\\sigma^{2}$，且方差不依赖于设计设置（方差齐性）。一项在固定设置下的初步研究得出，单次运行的标准差估计值为 $\\sigma = 0.10$（对于 $Y$）。\n- 置信区间使用学生t分布在置信水平为0.95时构建。\n\n您的任务是构建 $2^{3}$ 因子设计，并确定所需的ABM最小总运行次数 $N$，以使得拟合模型中任何双因素交互作用系数的双边置信区间的半宽最多为 $h = 0.02$（以森林覆盖率为单位）。将您的答案表示为设计所隐含的最小整数 $N$。不需要按有效数字进行四舍五入；报告最小的有效整数 $N$。",
            "solution": "用户希望我找到为达到交互作用系数估计的特定精度所需的基于主体的模型（ABM）的最小总运行次数 $N$。\n\n首先，我将验证问题陈述。\n\n### 步骤1：提取给定条件\n- **模型类型**：用于土地利用和土地覆被变化（LULCC）的基于主体的模型（ABM）。\n- **响应变量**：剩余森林覆盖率，$Y \\in [0,1]$。\n- **因子**：3个因子（$\\lambda$, $\\eta$, $\\phi$），每个因子2个水平，编码为-1和+1。\n- **实验设计**：全因子 $2^3$ 设计，每个设置有 $r$ 次重复。\n- **总运行次数**：$N = 2^3 r = 8r$。\n- **统计模型**：一个线性模型，包含一个截距、3个主效应和所有3个双因素交互作用。三因素交互作用被排除。设计矩阵使用正交的 $\\{-1, +1\\}$ 编码。\n- **误差假设**：误差是独立同分布的（i.i.d.），均值为0，方差为常数 $\\sigma^2$。\n- **方差估计**：单次运行的标准差估计为 $\\sigma = 0.10$。\n- **置信区间**：基于学生t分布，置信水平为0.95。\n- **精度要求**：任何双因素交互作用系数的双边置信区间的半宽必须最多为 $h = 0.02$。\n\n### 步骤2：使用提取的给定条件进行验证\n- **科学依据**：该问题设置在环境建模（LULCC）的背景下，并使用标准统计方法进行模拟实验的设计和分析（因子设计、线性回归）。这是一种成熟的科学实践。该问题在科学上是合理的。\n- **定义明确**：问题表述清晰。它提供了一个具体的目标（找到最小的 $N$）和解决该问题所需的所有信息（模型结构、误差方差、期望精度、置信水平）。可以推导出一个唯一的、有意义的解。\n- **客观性**：问题使用精确、正式、客观的语言陈述，没有任何主观或模棱两可的术语。\n- **额外检查**：问题不违反任何其他有效性标准。它是可形式化的、完整的、一致的并且是科学上可验证的。\n\n### 步骤3：结论与行动\n问题是**有效的**。我将继续进行解答。\n\n单次运行的响应 $Y$ 的线性模型由下式给出：\n$$Y_i = \\beta_0 + \\beta_1 x_{i1} + \\beta_2 x_{i2} + \\beta_3 x_{i3} + \\beta_{12} x_{i,12} + \\beta_{13} x_{i,13} + \\beta_{23} x_{i,23} + \\epsilon_i$$\n其中 $x_{i1}, x_{i2}, x_{i3}$ 是第 $i$ 次运行中三个主因子的编码水平（-1或+1）。交互作用项是主效应项的乘积，例如 $x_{i,12} = x_{i1}x_{i2}$。项 $\\epsilon_i$ 代表第 $i$ 次运行的随机误差，$\\epsilon_i \\sim \\text{i.i.d. } \\mathcal{N}(0, \\sigma^2)$。该模型有 $p=7$ 个待估参数（一个截距，三个主效应，三个双因素交互作用）。\n\n总运行次数为 $N = 2^3 r = 8r$，其中 $r$ 是8个独特实验设置中每个设置的重复次数。该模型的设计矩阵 $X$ 是一个 $N \\times p$ 的矩阵。对于一个具有 $\\{-1, +1\\}$ 编码和 $r$ 次重复的 $2^k$ 因子设计，设计矩阵的所有列（包括全为+1的截距列）是相互正交的。$X$ 中任何一列元素的平方和等于 $N$。\n这种正交性意味着矩阵 $X^T X$ 是一个对角矩阵：\n$$X^T X = \\text{diag}(N, N, N, N, N, N, N) = N \\cdot I_p$$\n其中 $I_p$ 是 $p \\times p$ 的单位矩阵，$p=7$。\n\n估计系数的向量由 $\\hat{\\boldsymbol{\\beta}} = (X^T X)^{-1} X^T \\mathbf{Y}$ 给出。这些估计的方差-协方差矩阵是：\n$$\\text{Var}(\\hat{\\boldsymbol{\\beta}}) = (X^T X)^{-1} \\sigma^2 = (N \\cdot I_p)^{-1} \\sigma^2 = \\frac{\\sigma^2}{N} I_p$$\n这个结果表明，任何估计系数 $\\hat{\\beta}_j$（无论是主效应还是交互作用）的方差都是相同的：\n$$\\text{Var}(\\hat{\\beta}_j) = \\frac{\\sigma^2}{N}$$\n因此，任何系数估计的标准误（SE）是：\n$$\\text{SE}(\\hat{\\beta}_j) = \\sqrt{\\frac{\\sigma^2}{N}} = \\frac{\\sigma}{\\sqrt{N}}$$\n系数 $\\beta_j$ 的双边置信区间构建为 $\\hat{\\beta}_j \\pm h$，其中 $h$ 是半宽，由下式给出：\n$$h = t_{\\alpha/2, \\nu} \\cdot \\text{SE}(\\hat{\\beta}_j)$$\n这里，置信水平为 $0.95$，所以 $\\alpha = 1 - 0.95 = 0.05$，$\\alpha/2 = 0.025$。误差项的自由度 $\\nu$ 是总运行次数减去估计参数的数量：$\\nu = N - p = N - 7$。\n\n给定要求半宽 $h$ 最多为 $0.02$。同时给定估计值 $\\sigma = 0.10$。我们现在可以建立一个不等式来求解 $N$：\n$$t_{0.025, N-7} \\cdot \\frac{\\sigma}{\\sqrt{N}} \\le h$$\n$$t_{0.025, N-7} \\cdot \\frac{0.10}{\\sqrt{N}} \\le 0.02$$\n重新整理不等式以求解 $N$：\n$$\\frac{\\sqrt{N}}{t_{0.025, N-7}} \\ge \\frac{0.10}{0.02}$$\n$$\\sqrt{N} \\ge 5 \\cdot t_{0.025, N-7}$$\n这个不等式必须对 $N$ 求解。由于 $N$ 同时显式出现并作为t分布自由度的一部分，我们必须使用迭代方法或测试候选值。我们还有一个约束条件，$N$ 必须是 $2^3=8$ 的整数倍，因为 $N=8r$。\n\n对于大的 $N$，学生t分布趋近于标准正态分布，其临界值 $z_{0.025}$ 约等于 $1.96$。我们用这个值来初步估计 $N$：\n$$\\sqrt{N} \\approx 5 \\times 1.96 = 9.8$$\n$$N \\approx (9.8)^2 = 96.04$$\n由于 $N$ 必须是8的倍数，大于96.04的最小的8的倍数是104。我们来检验一下 $N=104$ 是否满足不等式。我们还需要检查 $N=96$ 是否可能足够，因为我们的初步估计使用了近似值。\n\n测试 $N=96$：\n对于 $N=96$，重复次数 $r = 96/8 = 12$。自由度 $\\nu = 96 - 7 = 89$。临界值是 $t_{0.025, 89} \\approx 1.9870$。\n我们检验不等式：$\\sqrt{96} \\ge 5 \\cdot t_{0.025, 89}$\n$$9.798 \\ge 5 \\times 1.9870$$\n$$9.798 \\ge 9.935$$\n这个陈述是错误的。因此，$N=96$ 次运行是不够的。\n\n测试 $N=104$：\n对于 $N=104$，重复次数 $r = 104/8 = 13$。自由度 $\\nu = 104 - 7 = 97$。临界值是 $t_{0.025, 97} \\approx 1.9847$。\n我们检验不等式：$\\sqrt{104} \\ge 5 \\cdot t_{0.025, 97}$\n$$10.198 \\ge 5 \\times 1.9847$$\n$$10.198 \\ge 9.9235$$\n这个陈述是正确的。因此，$N=104$ 次运行是足够的。\n\n由于 $N$ 必须是8的倍数，且 $N=96$ 不足而 $N=104$ 足够，因此所需的最小ABM总运行次数是104。",
            "answer": "$$\\boxed{104}$$"
        }
    ]
}