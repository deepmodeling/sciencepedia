{
    "hands_on_practices": [
        {
            "introduction": "为了有效地应用SCS-CN方法，理解其基本原理至关重要。第一个练习  将指导你从质量守恒和模型关键的比例假设这两个基本原则出发，推导出核心的径流方程。通过完成这个基础计算，你将巩固对降水如何被划分为径流和抽象（损失）量的理解。",
            "id": "3844595",
            "problem": "一个中型流域已使用多光谱卫星影像和数字土壤图进行了划分。监督土地覆盖分类结合水文土壤组信息得出的加权综合曲线数 (CN) 在前期土壤湿度条件II (AMC II) 下为 $78$。考虑一次空间均匀的暴雨，其在整个流域的总降水量 $P=60$ 毫米。对于水土保持局 (SCS) 曲线数法，潜在最大持留量 $S$（单位：毫米）可以通过曲线数参数化为 $S=\\dfrac{25400}{CN}-254$，初损 $I_{a}$ 参数化为 $I_{a}=0.2\\,S$。假设采用标准的SCS概念化模型，即在满足初损后，累积实际持留量与潜在最大持留量成正比，累积直接径流与有效降雨成正比。\n\n仅使用质量守恒和上述比例假设，推导径流深 $Q$ 作为 $P$、$I_{a}$ 和 $S$ 的函数，然后计算当 $CN=78$ 且 $P=60$ 毫米时的 $Q$ 值。最后，根据计算出的 $Q$，将径流比解释为等于 $Q/P$ 的无量纲小数（无百分号），并简要评论这对本次事件中径流和总损失之间的分配意味着什么。将您最终的 $Q$ 数值四舍五入至四位有效数字，并以毫米为单位表示。解释性讨论不需要四舍五入。",
            "solution": "该问题陈述经评估有效。它科学地基于地表水水文学中的标准经验模型——水土保持局 (SCS) 曲线数 (CN) 法的既定原则。该问题提法得当、内容自洽且客观，提供了所有必要的数据（$CN=78$，$P=60 \\text{ mm}$）、定义（$S$ 和 $I_a$ 的参数化）以及概念关系（质量守恒和比例假设），从而能够明确无误地推导出唯一解。\n\n主要任务是推导并应用SCS径流方程。该推导基于总降水量 $P$ 超过初损 $I_a$ 的降水事件的两个基本原则。\n\n首先，质量守恒原则决定了事件的水量平衡。总降水量 $P$ 被分为三个部分：初损 $I_a$（不产生径流的水量，如植被截留、洼地蓄水和径流开始前的入渗）、直接径流 $Q$ 和径流开始后的累积入渗（或实际持留量），记为 $F$。质量平衡方程为：\n$$P = I_a + F + Q \\quad (\\text{对于 } P > I_a)$$\n如果 $P \\le I_a$，则不产生径流，因此 $Q = 0$。对于产生径流的情况，我们可以将实际持留量 $F$ 表示为：\n$$F = P - I_a - Q$$\n\n其次，SCS方法的核心概念假设建立了一个比例关系。它假设实际直接径流 $Q$ 与潜在最大径流量之比等于实际持留量 $F$ 与潜在最大持留量 $S$ 之比。潜在最大径流量是有效降雨，即满足初损后可用于径流或持续入渗的降水量，即 $P - I_a$。因此，该比例关系写作：\n$$\\frac{Q}{P - I_a} = \\frac{F}{S}$$\n\n为了推导径流深 $Q$ 作为 $P$、$I_a$ 和 $S$ 的函数，我们将质量平衡方程中 $F$ 的表达式代入比例方程：\n$$\\frac{Q}{P - I_a} = \\frac{P - I_a - Q}{S}$$\n现在我们解此方程求 $Q$。两边同乘以 $S$ 和 $(P - I_a)$ 得：\n$$Q \\cdot S = (P - I_a)(P - I_a - Q)$$\n$$Q \\cdot S = (P - I_a)^2 - Q(P - I_a)$$\n为了分离出 $Q$，我们将所有包含 $Q$ 的项集中到方程的一边：\n$$Q \\cdot S + Q(P - I_a) = (P - I_a)^2$$\n提出 $Q$：\n$$Q(S + P - I_a) = (P - I_a)^2$$\n最后，除以括号中的项，得到径流深 $Q$ 的显式公式：\n$$Q = \\frac{(P - I_a)^2}{P - I_a + S}$$\n此方程在 $P > I_a$ 时有效。对于 $P \\le I_a$，$Q=0$。\n\n现在，我们根据给定条件计算 $Q$。\n首先，根据给定的曲线数 $CN=78$ 计算潜在最大持留量 $S$：\n$$S = \\frac{25400}{CN} - 254 = \\frac{25400}{78} - 254$$\n$$S \\approx 325.6410256 - 254 = 71.6410256 \\text{ mm}$$\n接下来，根据标准参数化 $I_a = 0.2S$ 计算初损 $I_a$：\n$$I_a = 0.2 \\times S \\approx 0.2 \\times 71.6410256 = 14.3282051 \\text{ mm}$$\n给定的总降水量为 $P=60 \\text{ mm}$。我们必须通过比较 $P$ 和 $I_a$ 来检查是否会产生径流：\n$$P = 60 \\text{ mm} > I_a \\approx 14.33 \\text{ mm}$$\n由于 $P > I_a$，会产生径流，我们可以使用推导出的 $Q$ 公式。代入 $P$、$I_a$ 和 $S$ 的值：\n$$Q = \\frac{(60 - 14.3282051)^2}{60 - 14.3282051 + 71.6410256}$$\n$$Q = \\frac{(45.6717949)^2}{45.6717949 + 71.6410256} = \\frac{2085.91130}{117.3128205}$$\n$$Q \\approx 17.78084 \\text{ mm}$$\n按要求将结果四舍五入至四位有效数字：\n$$Q \\approx 17.78 \\text{ mm}$$\n\n最后，我们解释径流比 $Q/P$。\n$$ \\frac{Q}{P} = \\frac{17.78084}{60} \\approx 0.2963 $$\n约等于 $0.296$ 的径流比意味着，在这次暴雨事件中，大约有 $29.6\\%$ 的总降水量转化为了地表直接径流。大部分降雨，约 $1 - 0.296 = 0.704$ 或 $70.4\\%$，在径流过程中被作为总损失扣除。这些总损失由初损 $I_a \\approx 14.33$ mm（约占 $P$ 的 $23.9\\%$）和径流开始后的持续入渗 $F = P - I_a - Q \\approx 60 - 14.33 - 17.78 = 27.89$ mm（约占 $P$ 的 $46.5\\%$）组成。这表明了一种流域状况和暴雨特性，其中大部分降雨主要通过渗入土壤被保留在流域内，而不是迅速从地表流失。",
            "answer": "$$\n\\boxed{17.78}\n$$"
        },
        {
            "introduction": "真实世界的流域由不同的土地覆盖和土壤类型拼接而成，每种组合都有其独特的径流潜力。本练习  旨在解决这种复杂性，教你如何为一个非均质流域计算综合曲线数。这种面积加权技术是利用遥感衍生的土地覆盖数据来参数化集总式水文模型的一个基本步骤。",
            "id": "3844533",
            "problem": "一个流域已被划定，其土地覆盖比例已通过监督多光谱卫星分类绘制出来。得到的水文同质响应单元的分数分别为：$0.4$ 为良好覆盖的森林，$0.3$ 为中等覆盖的牧场，以及 $0.3$ 为差覆盖的行栽作物。整个流域位于水文土壤组 (HSG) $B$ 上。在前期土壤湿度条件 (AMC) $II$ 下，这些土地覆盖-土壤组组合对应的列表曲线数 ($CN$) 分别为 $55$ (良好森林, $B$)，$69$ (中等牧场, $B$) 和 $78$ (差行栽作物, $B$)。使用美国农业部土壤保持局 (USDA-SCS) 径流框架将该流域参数化为一个集总单元。\n\n从水量平衡概念和导出 USDA-SCS 径流关系的定义出发，并仅使用经过充分检验的曲线数与潜在最大蓄持量之间的关系，推导如何：\n- 从已绘制的土地覆盖分数和列表中的 $CN$ 值计算复合曲线数 $CN_{\\text{comp}}$；\n- 从 $CN_{\\text{comp}}$ 获得复合潜在最大蓄持量 $S_{\\text{comp}}$ (单位：毫米)；\n- 假设在 USDA-SCS 框架中使用标准初始抽象比，计算总降水量为 $P=50$ mm 的暴雨事件的直接径流深度 $Q$ (单位：毫米)。\n\n对给定的分数和 $CN$ 值进行计算，并提供 $S_{\\text{comp}}$ (毫米)、$CN_{\\text{comp}}$ (无量纲) 和 $Q$ (毫米) 的数值。将所有三个报告值四舍五入到四位有效数字。用毫米表示 $S_{\\text{comp}}$ 和 $Q$。",
            "solution": "美国农业部土壤保持局 (USDA-SCS) 径流法基于暴雨事件的概念性水量平衡，\n$$\nP = I_{a} + F + Q,\n$$\n其中 $P$ 是降水深度，$I_{a}$ 是初始抽象（径流开始前的所有损失），$F$ 是事件期间的实际入渗/蓄持量，$Q$ 是直接径流深度。该方法假设，成为径流的超额降水 $P$ 的比例由一个特定于集水区的潜在最大蓄持量 $S$ 控制，其本构假设为\n- 一旦径流开始，实际蓄持量与潜在蓄持量成比例，\n- 初始抽象与潜在最大蓄持量之间存在固定比率，$I_{a} = \\lambda S$，在 USDA-SCS 方法中标准选择为 $\\lambda = 0.2$，\n从而导出经过充分检验的径流关系\n$$\nQ = \n\\begin{cases}\n\\displaystyle \\frac{\\left(P - I_{a}\\right)^{2}}{P + S - I_{a}},  P > I_{a} \\\\[6pt]\n0,  P \\leq I_{a}\n\\end{cases}\n$$\n潜在最大蓄持量 $S$ 通过一个最初以英制单位推导的一一映射与曲线数 $CN$ 相关联，\n$$\nS_{\\text{in}} = \\frac{1000}{CN} - 10 \\quad \\text{(英寸)},\n$$\n使用 $1$ 英寸 $=25.4$ 毫米进行单位换算后，得到公制关系\n$$\nS_{\\text{mm}} = 25.4\\,S_{\\text{in}} = 25.4\\left(\\frac{1000}{CN} - 10\\right) = \\frac{25400}{CN} - 254 \\quad \\text{(毫米)}.\n$$\n\n遥感提供了土地覆盖类别的面积分数，这些分数与水文土壤组 (HSG) 和覆盖条件一起，映射到列表中的曲线数。对于集总参数化，一个标准且广泛使用的聚合方法是面积加权的曲线数，\n$$\nCN_{\\text{comp}} = \\sum_{i} w_{i}\\,CN_{i},\n$$\n其中 $w_{i}$ 是面积分数，$CN_{i}$ 是在相同 AMC 和 HSG 条件下特定类别的曲线数。\n\n给定数据：\n- 分数 $w_{\\text{forest}} = 0.4$，$w_{\\text{pasture}} = 0.3$，$w_{\\text{row crop}} = 0.3$，\n- $CN_{\\text{forest}} = 55$，$CN_{\\text{pasture}} = 69$，$CN_{\\text{row crop}} = 78$，\n我们计算\n$$\nCN_{\\text{comp}} = 0.4\\cdot 55 + 0.3\\cdot 69 + 0.3\\cdot 78.\n$$\n计算每一项：\n$$\n0.4\\cdot 55 = 22,\\quad 0.3\\cdot 69 = 20.7,\\quad 0.3\\cdot 78 = 23.4,\n$$\n因此\n$$\nCN_{\\text{comp}} = 22 + 20.7 + 23.4 = 66.1.\n$$\n\n接下来，使用公制的 $CN$–$S$ 映射来获得 $S_{\\text{comp}}$：\n$$\nS_{\\text{comp}} = \\frac{25400}{CN_{\\text{comp}}} - 254 = \\frac{25400}{66.1} - 254.\n$$\n计算商 $\\frac{25400}{66.1}$：\n$$\n\\frac{25400}{66.1} \\approx 384.2662,\n$$\n所以\n$$\nS_{\\text{comp}} \\approx 384.2662 - 254 = 130.2662 \\quad \\text{mm}.\n$$\n\n对于径流，采用标准初始抽象比 $\\lambda = 0.2$ 和 $P=50$ mm。首先检查是否 $P  I_{a}$：\n$$\nI_{a} = \\lambda S_{\\text{comp}} = 0.2 \\times 130.2662 \\approx 26.0532 \\quad \\text{mm},\n$$\n并且 $P - I_{a} \\approx 50 - 26.0532 = 23.9468$ mm $ 0$，所以会产生径流。然后\n$$\nQ = \\frac{\\left(P - I_{a}\\right)^{2}}{P + S_{\\text{comp}} - I_{a}} = \\frac{\\left(50 - 0.2\\,S_{\\text{comp}}\\right)^{2}}{50 + S_{\\text{comp}} - 0.2\\,S_{\\text{comp}}} = \\frac{\\left(50 - 26.0532\\right)^{2}}{50 + 130.2662 - 26.0532}.\n$$\n计算分母：\n$$\n50 + 130.2662 - 26.0532 = 154.2130,\n$$\n和分子：\n$$\n\\left(23.9468\\right)^{2} \\approx 573.4471.\n$$\n因此，\n$$\nQ \\approx \\frac{573.4471}{154.2130} \\approx 3.7185 \\quad \\text{mm}.\n$$\n\n最后，应用四舍五入规则（四位有效数字）：\n- $CN_{\\text{comp}} = 66.10$,\n- $S_{\\text{comp}} = 130.3$ mm,\n- $Q = 3.719$ mm.\n\n要求的输出按顺序为 $S_{\\text{comp}}$ (毫米)、$CN_{\\text{comp}}$ (无量纲) 和 $Q$ (毫米)。",
            "answer": "$$\\boxed{\\begin{pmatrix}130.3  66.10  3.719\\end{pmatrix}}$$"
        },
        {
            "introduction": "将遥感数据整合到模型中，可以动态地表征环境条件。这最后一个编程练习  将挑战你构建一个完整的工作流程，从处理月度NDVI时间序列，到参数化季节性变化的曲线数，再到模拟两年的径流过程。这个实践充分展示了遥感如何将SCS-CN方法从一个静态工具转变为一个能够捕捉植被物候对水文过程关键影响的动态模型。",
            "id": "3844573",
            "problem": "给定一个针对水文土壤组（Hydrologic Soil Group, HSG）C上的农田绘制的月度标准化植被指数（NDVI）气候学时间序列。目标是根据土地覆盖参数化月度土壤保持局（SCS；现为自然资源保护局）径流曲线数值，计算给定为期两年的设计暴雨深度序列的事件径流，然后评估径流系数的季节性。请构建一个程序，为多个参数集执行这些步骤，并将结果汇总为单行输出格式。\n\n请从基本关系和经过充分检验的事实出发，不要假定或使用任何给定的快捷公式。使用以下基本依据：\n- 基于遥感反射率的植被指数定义：标准化植被指数（NDVI）由光谱反射率定义为 $$\\mathrm{NDVI} = \\frac{\\rho_{\\mathrm{NIR}} - \\rho_{\\mathrm{R}}}{\\rho_{\\mathrm{NIR}} + \\rho_{\\mathrm{R}}}$$ 其中 $\\rho_{\\mathrm{NIR}}$ 是近红外反射率，$\\rho_{\\mathrm{R}}$ 是红光反射率。在典型的农田条件下，NDVI是绿色植被数量和植被覆盖度的单调指标。\n- 水文损失框架：事件水平衡可以概念化为 $$P = I_{\\mathrm{a}} + F + Q$$ 其中 $P$ 是降水深度，$I_{\\mathrm{a}}$ 是初损，$F$ 是实际入渗及其他损失，$Q$ 是直接径流深度。根据SCS径流曲线数法，最大潜在滞蓄量和初损与土地覆盖和土壤性质相关。采用标准初损系数 $\\lambda$ 等于 $0.2$。\n- 基于土地覆盖的参数化原理：植被覆盖度可以通过NDVI进行估算，采用一种物理上一致的线性映射，该映射由农田的代表性最小和最大NDVI界定。使用 $\\mathrm{NDVI}_{\\min} = 0.15$ 和 $\\mathrm{NDVI}_{\\max} = 0.85$。将NDVI映射到一个限制在区间 $[0,1]$ 内的植被覆盖度，并使用该植被覆盖度在HSG C上农田的休眠季和生长季参考径流曲线数之间进行线性插值，以得到月度径流曲线数。\n- HSG C上农田在前期土壤湿润条件II（AMC II）下的参考径流曲线数：使用休眠季径流曲线数 $CN_{\\mathrm{d}} = 82$ 和生长季径流曲线数 $CN_{\\mathrm{g}} = 74$。\n\n对于每个参数集，完成以下任务：\n1. 使用指定的边界将月度NDVI气候学转换为月度植被覆盖度，然后使用植被覆盖度在 $CN_{\\mathrm{d}}$ 和 $CN_{\\mathrm{g}}$ 之间进行线性插值，参数化HSG C上农田的月度径流曲线数。确保得到的月度径流曲线数在HSG C农田的物理合理范围内。\n2. 对于两年序列中的每个月度设计暴雨深度，使用SCS径流曲线数法在AMC II条件下计算事件径流深度，单位为毫米。如果某个事件根据该方法的条件不产生径流，则该事件的径流返回零。所有事件径流深度以 $\\mathrm{mm}$ 表示，四舍五入到三位小数。\n3. 计算每个事件的径流系数为 $Q/P$（无量纲），并通过NDVI的阈值评估季节性。如果月度NDVI大于或等于 $0.5$，则将月份分类为生长季，否则为休眠季。将季节性指数定义为所有属于生长季的事件的平均径流系数减去所有属于休眠季的事件的平均径流系数。将此季节性指数四舍五入到三位小数。\n4. 对于每个参数集，按顺序输出以下内容：$12$ 个月度径流曲线数（四舍五入到一位小数），$24$ 个事件径流深度（单位为 $\\mathrm{mm}$，四舍五入到三位小数），以及单个季节性指数（四舍五入到三位小数）。\n\n物理单位和四舍五入要求：\n- 降水深度 $P$ 和径流深度 $Q$ 必须以 $\\mathrm{mm}$ 为单位。\n- 月度径流曲线数必须四舍五入到一位小数。\n- 事件径流深度必须四舍五入到三位小数。\n- 季节性指数必须四舍五入到三位小数。\n\n测试套件和参数集：\n使用三个参数集，代表不同的农田NDVI气候学和为期两年的月度设计暴雨序列。每个参数集提供一个为期 $12$ 个月的NDVI气候学和一个包含 $24$ 个事件的月度降水深度序列（连续两年）。\n\n参数集A（夏季行栽作物气候学）：\n- 月度NDVI（无量纲）：$[0.20,0.22,0.30,0.50,0.65,0.75,0.80,0.78,0.70,0.50,0.35,0.25]$。\n- 两年期月度降水深度（单位 $\\mathrm{mm}$）：$[10,20,35,60,90,120,80,70,60,40,25,15,12,18,30,55,95,110,85,65,50,38,22,16]$。\n\n参数集B（植被较稀疏，暴雨强度更大）：\n- 月度NDVI（无量纲）：$[0.15,0.18,0.20,0.30,0.45,0.55,0.60,0.58,0.50,0.35,0.25,0.18]$。\n- 两年期月度降水深度（单位 $\\mathrm{mm}$）：$[5,25,50,80,120,160,140,100,90,60,40,20,8,30,45,85,130,170,150,110,95,70,45,25]$。\n\n参数集C（冬季作物气候学）：\n- 月度NDVI（无量纲）：$[0.60,0.62,0.58,0.50,0.40,0.35,0.30,0.28,0.30,0.40,0.50,0.55]$。\n- 两年期月度降水深度（单位 $\\mathrm{mm}$）：$[20,25,30,40,70,90,80,60,50,40,30,25,22,28,32,38,75,95,85,62,52,42,32,26]$。\n\n您的程序应生成单行输出，其中包含一个由方括号括起的逗号分隔列表。该列表应恰好包含三个元素，每个元素对应一个参数集（A、B、C）。每个元素本身必须是一个包含三个元素的列表：$12$ 个四舍五入后的月度径流曲线数、$24$ 个四舍五入后的事件径流深度（单位 $\\mathrm{mm}$）以及四舍五入后的季节性指数。例如，结构类似于 $[[\\text{CNs}_A,\\text{Qs}_A,\\text{SI}_A],[\\text{CNs}_B,\\text{Qs}_B,\\text{SI}_B],[\\text{CNs}_C,\\text{Qs}_C,\\text{SI}_C]]$，并根据上述计算填入实际数值。",
            "solution": "该问题是有效的。其科学基础扎根于遥感和水文学的既定原则，提法明确，拥有一套完整且一致的数据和指令，并以客观、正式的语言表述。所提供的参数和关系，例如标准化植被指数（NDVI）、土壤保持局径流曲线数（SCS-CN）方法以及它们之间的参数化联系，在环境建模中都是标准且被广泛接受的。满足了一个有效问题的所有条件。\n\n解决方案需要对每个参数集进行系统的、多步骤的计算，整合了遥感、土地覆盖特征描述和降雨径流建模的概念。详细过程如下。\n\n**第一部分：月径流曲线数（$CN$）的参数化**\n\n第一步是从给定的月度NDVI气候学中推导出月度径流曲线数（$CN_i$）的气候学。这通过一个两步过程实现：将NDVI转换为植被覆盖度（$f_v$），然后基于$f_v$插值计算径流曲线数。\n\n1.  **从NDVI到植被覆盖度（$f_v$）**：问题假设NDVI与$f_v$之间存在线性关系。给定对应于裸土的最小NDVI值（$\\mathrm{NDVI}_{\\min} = 0.15$）和对应于完全植被覆盖的最大NDVI值（$\\mathrm{NDVI}_{\\max} = 0.85$），给定月份 $i$ 的覆盖度 $f_{v,i}$ 计算如下：\n    $$f_{v,i} = \\frac{\\mathrm{NDVI}_i - \\mathrm{NDVI}_{\\min}}{\\mathrm{NDVI}_{\\max} - \\mathrm{NDVI}_{\\min}}$$\n    代入给定常数，方程变为：\n    $$f_{v,i} = \\frac{\\mathrm{NDVI}_i - 0.15}{0.85 - 0.15} = \\frac{\\mathrm{NDVI}_i - 0.15}{0.70}$$\n    问题规定 $f_{v,i}$ 必须限制在区间 $[0, 1]$ 内。所有测试用例提供的NDVI数据都落在 $[\\mathrm{NDVI}_{\\min}, \\mathrm{NDVI}_{\\max}]$ 范围内，因此计算出的 $f_v$ 将自然落在 $[0, 1]$ 内，无需显式截断。\n\n2.  **从植被覆盖度到径流曲线数（$CN$）**：月度径流曲线数 $CN_i$ 是通过在参考的休眠季径流曲线数（$CN_{\\mathrm{d}} = 82$）和生长季径流曲线数（$CN_{\\mathrm{g}} = 74$）之间进行线性插值确定的。植被覆盖度 $f_{v,i}$ 作为插值权重。休眠季对应 $f_v = 0$，生长季高峰对应 $f_v = 1$。插值公式为：\n    $$CN_i = CN_{\\mathrm{d}} (1 - f_{v,i}) + CN_{\\mathrm{g}} f_{v,i} = CN_{\\mathrm{d}} + f_{v,i} (CN_{\\mathrm{g}} - CN_{\\mathrm{d}})$$\n    代入水文土壤组（HSG）C上农田的参考值：\n    $$CN_i = 82 + f_{v,i} (74 - 82) = 82 - 8 f_{v,i}$$\n    此方程反映了一个事实：对于指定的农田，增加的植被覆盖（更高的 $f_v$）导致更低的径流曲线数，意味着更高的入渗和更低的径流潜力。最终输出时，将得到的 $12$ 个月度 $CN_i$ 值四舍五入到一位小数。\n\n**第二部分：事件径流深度（$Q$）的计算**\n\n有了月度 $CN_i$ 气候学，就可以使用SCS-CN方法为给定的 $24$ 个月度降水事件（$P_j$）序列计算事件径流深度（$Q_j$）。\n\n1.  **最大潜在滞蓄量（$S$）**：径流曲线数是一个指数，它与最大潜在土壤水分滞蓄量 $S$ 有函数关系。标准公式中，$S$ 以英寸为单位，为 $S = \\frac{1000}{CN} - 10$。由于降水量以毫米为单位给出，我们必须使用转换因子 $1 \\text{ 英寸} = 25.4 \\text{ 毫米}$ 将 $S$ 转换为毫米。\n    $$S_i \\text{ [mm]} = 25.4 \\left( \\frac{1000}{CN_i} - 10 \\right)$$\n    此计算对 $12$ 个月度径流曲线数中的每一个进行，使用未四舍五入的 $CN_i$ 值以保持精度。这12个月的 $S_i$ 气候学用于降水序列的两年。\n\n2.  **初损（$I_a$）**：在径流发生之前，必须满足初损（$I_a$），包括截留、地表蓄水和初始入渗。$I_a$ 被建模为 $S$ 的一个分数。\n    $$I_{a,i} = \\lambda S_i$$\n    问题指定了一个标准初损系数 $\\lambda = 0.2$。\n\n3.  **径流深度（$Q$）**：SCS-CN方程从降水量 $P$ 计算直接径流深度 $Q$。只有当降水量超过初损时，即 $P  I_a$，才会产生径流。\n    $$Q_j = \\begin{cases} \\frac{(P_j - I_{a,i})^2}{P_j - I_{a,i} + S_i}  \\text{if } P_j > I_{a,i} \\\\ 0  \\text{if } P_j \\le I_{a,i} \\end{cases}$$\n    其中，对于一个以1为基数的事件 $j \\in \\{1, ..., 24\\}$，$i = (j-1) \\pmod{12}$。代入 $I_{a,i} = 0.2 S_i$：\n    $$Q_j = \\frac{(P_j - 0.2 S_i)^2}{P_j + 0.8 S_i} \\quad \\text{for } P_j  0.2 S_i$$\n    此计算对 $24$ 个降水事件中的每一个进行，使用与该事件月份相对应的 $S_i$ 值。得到的 $24$ 个径流深度 $Q_j$ 四舍五入到三位小数。\n\n**第三部分：季节性指数（$SI$）的计算**\n\n最后的任务是量化径流响应的季节性差异。\n\n1.  **径流系数（$R$）**：对于每个事件，径流系数 $R_j$ 是变为径流的降水量的无量纲分数：\n    $$R_j = \\frac{Q_j}{P_j}$$\n    此计算对所有 $24$ 个事件进行。\n\n2.  **季节分类**：根据月份的NDVI值进行分类。\n    -   生长季：如果 $\\mathrm{NDVI}_i \\ge 0.5$\n    -   休眠季：如果 $\\mathrm{NDVI}_i  0.5$\n\n3.  **季节性指数（$SI$）**：$SI$ 是所有生长季事件的平均径流系数与所有休眠季事件的平均径流系数之差。\n    设 $G_E$ 为发生在生长季月份的事件的径流系数集合，而 $D_E$ 为发生在休眠季月份的事件的径流系数集合。\n    $$\\overline{R}_{\\text{growing}} = \\frac{1}{|G_E|} \\sum_{R_j \\in G_E} R_j$$\n    $$\\overline{R}_{\\text{dormant}} = \\frac{1}{|D_E|} \\sum_{R_j \\in D_E} R_j$$\n    则季节性指数为：\n    $$SI = \\overline{R}_{\\text{growing}} - \\overline{R}_{\\text{dormant}}$$\n    这个最终值四舍五入到三位小数。\n\n这个全面的程序将应用于所提供的三个参数集中的每一个，并将结果编译成指定的输出格式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process all parameter sets and print the final output.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"ndvi_climatology\": [0.20, 0.22, 0.30, 0.50, 0.65, 0.75, 0.80, 0.78, 0.70, 0.50, 0.35, 0.25],\n            \"precipitation_2yr\": [10, 20, 35, 60, 90, 120, 80, 70, 60, 40, 25, 15, 12, 18, 30, 55, 95, 110, 85, 65, 50, 38, 22, 16],\n        },\n        {\n            \"name\": \"B\",\n            \"ndvi_climatology\": [0.15, 0.18, 0.20, 0.30, 0.45, 0.55, 0.60, 0.58, 0.50, 0.35, 0.25, 0.18],\n            \"precipitation_2yr\": [5, 25, 50, 80, 120, 160, 140, 100, 90, 60, 40, 20, 8, 30, 45, 85, 130, 170, 150, 110, 95, 70, 45, 25],\n        },\n        {\n            \"name\": \"C\",\n            \"winter_crop\": True,\n            \"ndvi_climatology\": [0.60, 0.62, 0.58, 0.50, 0.40, 0.35, 0.30, 0.28, 0.30, 0.40, 0.50, 0.55],\n            \"precipitation_2yr\": [20, 25, 30, 40, 70, 90, 80, 60, 50, 40, 30, 25, 22, 28, 32, 38, 75, 95, 85, 62, 52, 42, 32, 26],\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = process_case(\n            case[\"ndvi_climatology\"],\n            case[\"precipitation_2yr\"]\n        )\n        all_results.append(result)\n\n    # Format the final output string to be compact, without spaces within lists.\n    results_str_list = []\n    for res in all_results:\n        cn_str = f\"[{','.join(map(str, res[0]))}]\"\n        qs_str = f\"[{','.join(map(str, res[1]))}]\"\n        si_str = str(res[2])\n        case_str = f\"[{cn_str},{qs_str},{si_str}]\"\n        results_str_list.append(case_str)\n    \n    final_output_str = f\"[{','.join(results_str_list)}]\"\n    print(final_output_str)\n\n\ndef process_case(ndvi_climatology, precipitation_2yr):\n    \"\"\"\n    Processes a single parameter set to calculate CNs, runoff depths, and seasonality index.\n    \"\"\"\n    # --- Constants and Lookups ---\n    NDVI_MIN = 0.15\n    NDVI_MAX = 0.85\n    CN_D = 82.0  # Dormant-season CN for cropland, HSG C, AMC II\n    CN_G = 74.0  # Growing-season CN for cropland, HSG C, AMC II\n    LAMBDA_IA = 0.2  # Initial abstraction coefficient\n    MM_PER_INCH = 25.4\n\n    # Use numpy arrays for vectorized operations\n    ndvi_array = np.array(ndvi_climatology)\n    precip_array = np.array(precipitation_2yr)\n    \n    # --- Task 1: Parameterize Monthly Curve Numbers (CN) ---\n    \n    # Calculate fractional vegetation cover (fv) from NDVI\n    # fv = (NDVI - NDVI_min) / (NDVI_max - NDVI_min)\n    # The problem data for NDVI is within [NDVI_MIN, NDVI_MAX], so no clipping is needed.\n    fv = (ndvi_array - NDVI_MIN) / (NDVI_MAX - NDVI_MIN)\n    \n    # Linearly interpolate to get monthly CN\n    # CN = CN_d + fv * (CN_g - CN_d)\n    cn_monthly_unrounded = CN_D + fv * (CN_G - CN_D)\n    \n    # Round CNs to one decimal place for output\n    cn_monthly_rounded = [round(cn, 1) for cn in cn_monthly_unrounded]\n\n    # --- Task 2: Compute Event Runoff (Q) ---\n    \n    # Calculate potential maximum retention (S) in mm for each month\n    # S_inches = 1000/CN - 10\n    # S_mm = S_inches * 25.4\n    # Using unrounded CN for precision\n    s_monthly_mm = MM_PER_INCH * (1000.0 / cn_monthly_unrounded - 10.0)\n\n    # Calculate initial abstraction (Ia) in mm for each month\n    ia_monthly_mm = LAMBDA_IA * s_monthly_mm\n\n    runoff_depths_q = []\n    runoff_ratios = []\n\n    for i in range(24):\n        month_idx = i % 12\n        P = precip_array[i]\n        S = s_monthly_mm[month_idx]\n        Ia = ia_monthly_mm[month_idx]\n        \n        Q = 0.0\n        if P > Ia:\n            Q = (P - Ia)**2 / (P - Ia + S)\n        \n        runoff_depths_q.append(round(Q, 3))\n        \n        if P > 0:\n            runoff_ratios.append(Q / P)\n        else:\n            runoff_ratios.append(0.0)\n\n    # --- Task 3: Compute Seasonality Index (SI) ---\n\n    # Classify months and events by season\n    growing_season_ratios = []\n    dormant_season_ratios = []\n    \n    for i in range(24):\n        month_idx = i % 12\n        if ndvi_array[month_idx] >= 0.5:\n            growing_season_ratios.append(runoff_ratios[i])\n        else:\n            dormant_season_ratios.append(runoff_ratios[i])\n            \n    # Calculate mean runoff ratios for each season\n    mean_growing_ratio = np.mean(growing_season_ratios) if growing_season_ratios else 0.0\n    mean_dormant_ratio = np.mean(dormant_season_ratios) if dormant_season_ratios else 0.0\n\n    # Calculate Seasonality Index (SI) and round\n    seasonality_index = round(mean_growing_ratio - mean_dormant_ratio, 3)\n\n    return [cn_monthly_rounded, runoff_depths_q, seasonality_index]\n\nsolve()\n```"
        }
    ]
}