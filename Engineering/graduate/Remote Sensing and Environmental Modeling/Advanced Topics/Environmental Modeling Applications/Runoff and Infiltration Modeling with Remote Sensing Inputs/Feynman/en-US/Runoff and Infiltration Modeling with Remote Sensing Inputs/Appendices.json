{
    "hands_on_practices": [
        {
            "introduction": "Understanding when rainfall begins to produce runoff is a cornerstone of hydrology. This first exercise guides you through a derivation of the ponding time using the Green-Ampt model, which relies on fundamental principles like Darcy's Law and mass conservation. By working from first principles, you will gain a robust physical intuition for the infiltration-excess runoff mechanism and see how key soil parameters, often estimated from remote sensing, control this critical process .",
            "id": "3843274",
            "problem": "A small agricultural pixel ($30\\,\\mathrm{m} \\times 30\\,\\mathrm{m}$) is monitored by multiple remote sensing platforms and products. A physically based infiltration model is required to determine the onset of surface ponding under a constant rainfall event. Assume infiltration into a homogeneous soil governed by the Green-Ampt (GA) sharp wetting front assumption. The following parameters are estimated from remote sensing inputs: the initial volumetric water content $\\theta_i$ from Synthetic Aperture Radar (SAR) backscatter inversion, the saturated volumetric water content $\\theta_s$ from land-cover constrained porosity maps, the effective wetting front capillary suction head $\\psi_f$ from texture classes retrieved by hyperspectral imagery coupled with pedotransfer functions, and the saturated hydraulic conductivity $K_s$ from a digital soil map assimilating Light Detection and Ranging (LiDAR)-based terrain metrics. A constant rainfall intensity $i$ is provided by a weather radar product.\n\nUnder GA assumptions, treat the infiltration as one-dimensional vertical flow into a uniform soil, with a sharp wetting front at depth $z_f(t)$ that separates a saturated layer above from an initially unsaturated layer below, and take the surface ponded head to be zero prior to the instant of ponding. Starting from the Darcy flux expression for saturated flow and water mass conservation, derive from first principles an expression for the ponding time $t_p$ under constant rainfall intensity $i$ as a function of $K_s$, $\\psi_f$, $\\theta_s$, $\\theta_i$, and $i$. Explicitly state any intermediate physical relationships needed in your derivation.\n\nThen, using the remote sensing inputs (expressed in consistent units):\n- $K_s = 12\\,\\mathrm{mm\\,h^{-1}}$,\n- $\\psi_f = 120\\,\\mathrm{mm}$,\n- $\\theta_s = 0.45$,\n- $\\theta_i = 0.15$,\n- $i = 20\\,\\mathrm{mm\\,h^{-1}}$,\n\ncompute the numerical value of $t_p$.\n\nFinally, assess the necessity of the condition $i > K_s$ for ponding under the same GA assumptions with zero surface head prior to ponding. Let $N$ denote the numerical truth value of the statement, where $N=1$ if the statement “$i > K_s$ is necessary for ponding” is true under these assumptions and $N=0$ otherwise. Compute $N$.\n\nAnswer specification:\n- Express the final ponding time in hours.\n- Round all numerical answers to three significant figures.\n- Report your final answers as two numbers: the ponding time $t_p$ and the indicator $N$.",
            "solution": "The problem requires a three-part solution: first, to derive the expression for ponding time $t_p$ under the Green-Ampt (GA) model from first principles; second, to calculate a numerical value for $t_p$ given a set of parameters; and third, to assess the necessity of the condition $i > K_s$ for ponding to occur.\n\n### Part 1: Derivation of Ponding Time ($t_p$)\n\nThe derivation begins with the application of Darcy's Law to the wetted soil column, combined with the principle of mass conservation.\n\n**1. Darcy's Law and Infiltration Capacity**\n\nThe Green-Ampt model conceptualizes infiltration as piston flow, with a sharp wetting front at a depth $z_f(t)$ moving downward into a homogeneous soil. The soil layer above the front is assumed to be fully saturated with hydraulic conductivity $K_s$, while the soil below remains at its initial water content $\\theta_i$.\n\nThe total hydraulic head $h$ is the sum of the pressure head $\\psi$ and the elevation head. Let's define the vertical coordinate $z$ as positive downwards, with $z=0$ at the soil surface. The elevation head is then $-z$, so $h = \\psi - z$.\n\nAt the soil surface ($z=0$), we assume zero ponding depth just before ponding, so the pressure head is $\\psi_s = 0$. The total head is $h_s = 0 - 0 = 0$.\n\nAt the wetting front ($z = z_f$), the pressure head is the negative capillary suction head, $\\psi = -\\psi_f$. The total head is $h_f = -\\psi_f - z_f$.\n\nDarcy's law states that the flux $f(t)$ is proportional to the hydraulic gradient. Since flux is positive downwards, we have:\n$$f(t) = -K_s \\frac{h_f - h_s}{z_f - 0} = -K_s \\frac{(-\\psi_f - z_f) - 0}{z_f} = -K_s \\frac{-(\\psi_f + z_f)}{z_f} = K_s \\frac{\\psi_f + z_f}{z_f}$$\nThis simplifies to the common Green-Ampt infiltration capacity equation:\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right)$$\nThis expression represents the infiltration capacity, denoted as $f_c(t)$, of the soil at time $t$.\n\n**2. Mass Conservation**\n\nThe cumulative volume of water infiltrated per unit area, $F(t)$, must equal the increase in water stored in the soil profile down to the wetting front. This is given by the product of the change in volumetric water content and the depth of the wetting front:\n$$F(t) = (\\theta_s - \\theta_i) z_f(t)$$\nLet $\\Delta\\theta = \\theta_s - \\theta_i$. Then we can express the wetting front depth $z_f(t)$ in terms of the cumulative infiltration $F(t)$:\n$$z_f(t) = \\frac{F(t)}{\\Delta\\theta}$$\n\n**3. Combining and Solving for Ponding Time**\n\nBy substituting the expression for $z_f(t)$ from mass conservation into the equation for infiltration capacity $f_c(t)$, we get:\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{F(t) / \\Delta\\theta}\\right) = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{F(t)}\\right)$$\nThis equation relates the soil's infiltration capacity to the total amount of water that has already infiltrated.\n\nPonding begins at time $t_p$ when the constant rainfall intensity $i$ first equals the soil's decreasing infiltration capacity. For any time $t < t_p$, the soil can absorb all the rain, so the actual infiltration rate is $f(t) = i$. The cumulative infiltration at any time $t \\le t_p$ is therefore:\n$$F(t) = \\int_0^t f(\\tau) d\\tau = \\int_0^t i \\, d\\tau = i t$$\nAt the specific moment of ponding, $t = t_p$, we have two conditions:\n1. The infiltration rate is equal to the rainfall intensity: $f(t_p) = i$.\n2. The infiltration rate equals the infiltration capacity: $f(t_p) = f_c(t_p)$.\n\nCombining these gives the ponding condition: $i = f_c(t_p)$.\nSubstituting this and $F(t_p) = i t_p$ into our expression for $f_c(t)$:\n$$i = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{F(t_p)}\\right) = K_s \\left(1 + \\frac{\\psi_f \\Delta\\theta}{i t_p}\\right)$$\nWe can now solve for the ponding time, $t_p$:\n$$\\frac{i}{K_s} = 1 + \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$\\frac{i}{K_s} - 1 = \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$\\frac{i - K_s}{K_s} = \\frac{\\psi_f \\Delta\\theta}{i t_p}$$\n$$t_p = \\frac{K_s \\psi_f \\Delta\\theta}{i (i - K_s)}$$\nThis is the derived expression for the ponding time $t_p$ as a function of the given parameters.\n\n### Part 2: Numerical Calculation of $t_p$\n\nThe problem provides the following numerical values:\n- $K_s = 12\\,\\mathrm{mm\\,h^{-1}}$\n- $\\psi_f = 120\\,\\mathrm{mm}$\n- $\\theta_s = 0.45$\n- $\\theta_i = 0.15$\n- $i = 20\\,\\mathrm{mm\\,h^{-1}}$\n\nFirst, we calculate the change in volumetric water content, $\\Delta\\theta$:\n$$\\Delta\\theta = \\theta_s - \\theta_i = 0.45 - 0.15 = 0.30$$\nThe units of all parameters are consistent ($\\mathrm{mm}$, $\\mathrm{h}$). Substituting these values into the derived expression for $t_p$:\n$$t_p = \\frac{(12\\,\\mathrm{mm\\,h^{-1}}) \\cdot (120\\,\\mathrm{mm}) \\cdot (0.30)}{(20\\,\\mathrm{mm\\,h^{-1}}) \\cdot (20\\,\\mathrm{mm\\,h^{-1}} - 12\\,\\mathrm{mm\\,h^{-1}})}$$\n$$t_p = \\frac{12 \\cdot 120 \\cdot 0.3}{20 \\cdot 8} \\, \\mathrm{h}$$\n$$t_p = \\frac{432}{160} \\, \\mathrm{h}$$\n$$t_p = 2.7 \\, \\mathrm{h}$$\nRounding to three significant figures, the ponding time is $t_p = 2.70 \\, \\mathrm{h}$.\n\n### Part 3: Assessment of the Condition $i > K_s$\n\nThe question asks whether the condition $i > K_s$ is necessary for ponding to occur under the specified GA assumptions.\n\nThe infiltration capacity of the soil is given by:\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right)$$\nAs infiltration proceeds, the wetting front depth $z_f(t)$ increases with time. The term $\\psi_f / z_f(t)$ is always positive and decreases as $t$ increases.\nThe infiltration capacity $f_c(t)$ is therefore a monotonically decreasing function of time.\n\nLet's examine its limits:\n- As $t \\to 0^+$, $z_f \\to 0^+$, and $f_c(t) \\to \\infty$. The initial infiltration capacity is theoretically infinite.\n- As $t \\to \\infty$, $z_f \\to \\infty$, and $f_c(t) \\to K_s \\left(1 + 0\\right) = K_s$. The infiltration capacity asymptotically approaches the saturated hydraulic conductivity from above.\n\nPonding occurs when the rainfall supply rate $i$ exceeds the soil's infiltration capacity $f_c(t)$.\n\n**Case 1: $i > K_s$**\nThe rainfall rate $i$ is a constant value greater than the asymptotic infiltration capacity $K_s$. Since $f_c(t)$ starts at a value greater than $i$ (theoretically infinite) and decreases to a value less than $i$ (asymptotically $K_s$), there must be a finite time $t_p$ at which $f_c(t_p) = i$. For all $t > t_p$, we will have $f_c(t) < i$, causing water to accumulate on the surface. Thus, ponding occurs.\n\n**Case 2: $i \\le K_s$**\nThe rainfall rate $i$ is less than or equal to the minimum possible infiltration capacity $K_s$. For any finite time $t > 0$, the wetting depth $z_f(t)$ is finite, meaning $\\psi_f/z_f(t) > 0$. Therefore, the infiltration capacity is always strictly greater than $K_s$:\n$$f_c(t) = K_s \\left(1 + \\frac{\\psi_f}{z_f(t)}\\right) > K_s$$\nSince we are given $i \\le K_s$, it follows that $f_c(t) > i$ for all time $t$. The soil's capacity to absorb water is always greater than the supply rate. Ponding will never occur.\n\nTherefore, for ponding to occur under a constant rainfall rate $i$ in a Green-Ampt soil, the condition $i > K_s$ is necessary. The statement in the problem is true. The numerical truth value is $N=1$. This is also consistent with the derived formula for $t_p$, as $i \\le K_s$ would result in a non-positive or undefined $t_p$, which is physically meaningless and indicates no ponding.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.70 & 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Hydrological systems are complex, and models must often account for multiple interacting processes. This practice extends our analysis by incorporating the effect of a forest canopy, which intercepts rainfall and delays the onset of surface infiltration. You will use a common remote sensing product, the Leaf Area Index (LAI), to parameterize a canopy storage model and quantify its impact on the ponding time calculated previously, illustrating how to layer physical representations in a model .",
            "id": "3843182",
            "problem": "A single forested pixel is characterized by a Leaf Area Index (LAI) retrieved from spaceborne multispectral observations as $\\mathrm{LAI} = 5.2$. For short-duration storms, assume the canopy behaves as a bucket with a maximum storage capacity proportional to LAI, such that the canopy water storage capacity is $S_{c}$ in millimeters and $S_{c}$ is linearly related to LAI with proportionality coefficient $\\alpha = 0.4$ millimeters per unit LAI. Neglect evaporation and stemflow during the event, and assume that there is no throughfall until the canopy storage saturates; once saturated, throughfall equals the incident rainfall intensity.\n\nA storm of constant intensity $i = 30$ millimeters per hour lasts for $40$ minutes. The underlying soil follows the Green-Ampt conceptualization of infiltration under potential ponding, with saturated hydraulic conductivity $K_{s} = 12$ millimeters per hour, wetting-front capillary suction head $\\psi_{f} = 60$ millimeters, and water content change across the wetting front $\\Delta \\theta = 0.18$. The soil surface is initially unponded, and prior to ponding the infiltration rate equals the rate of water supply reaching the soil surface.\n\nUsing only mass conservation for the canopy water budget and the Green-Ampt conceptualization for infiltration and ponding, compute:\n- the total effective rainfall depth at the ground over the event after interception, and\n- the corresponding change in ponding time relative to an identical bare-soil surface receiving the same rainfall hyetograph.\n\nProvide all necessary derivations and state any additional consistency checks you make. Express the final answer as the change in ponding time in minutes, and round your final answer to four significant figures.",
            "solution": "The solution is determined in two main parts: first, an analysis of the canopy water balance to determine the effective rainfall reaching the soil surface, and second, an application of the Green-Ampt model to calculate the time to ponding for both a bare soil surface and the forested surface.\n\n**Part 1: Canopy Interception and Effective Rainfall**\n\nThe givens for this part are:\n- Leaf Area Index: $\\mathrm{LAI} = 5.2$\n- Canopy storage proportionality coefficient: $\\alpha = 0.4$ mm per unit LAI\n- Rainfall intensity: $i = 30$ mm/hr\n- Storm duration: $T_{d} = 40$ min\n\nFirst, we calculate the canopy water storage capacity, $S_{c}$. It is given as a linear function of LAI.\n$$S_{c} = \\alpha \\times \\mathrm{LAI}$$\n$$S_{c} = 0.4 \\frac{\\text{mm}}{\\mathrm{LAI}} \\times 5.2 = 2.08 \\text{ mm}$$\n\nThe problem states that no throughfall occurs until the canopy storage is filled. The time required to fill this storage, $t_{\\text{fill}}$, under a constant rainfall intensity $i$ is:\n$$t_{\\text{fill}} = \\frac{S_{c}}{i} = \\frac{2.08 \\text{ mm}}{30 \\text{ mm/hr}} = 0.069333... \\text{ hr}$$\n\nThe storm duration is given as $T_{d} = 40$ min, which is equivalent to $\\frac{40}{60} = \\frac{2}{3}$ hours, or approximately $0.6667$ hours. Since $t_{\\text{fill}} < T_{d}$, the canopy will saturate, and throughfall will occur for the remainder of the storm.\n\nThe total depth of rainfall during the event is $P_{\\text{total}}$:\n$$P_{\\text{total}} = i \\times T_{d} = 30 \\frac{\\text{mm}}{\\text{hr}} \\times \\left(\\frac{40}{60} \\text{ hr}\\right) = 20 \\text{ mm}$$\n\nThe total effective rainfall depth at the ground, $P_{e}$, is the total rainfall minus the amount intercepted and held in canopy storage (since evaporation is neglected).\n$$P_{e} = P_{\\text{total}} - S_{c} = 20 \\text{ mm} - 2.08 \\text{ mm} = 17.92 \\text{ mm}$$\nThis is the first quantity the problem asks to compute.\n\n**Part 2: Infiltration and Ponding Time**\n\nThe givens for the Green-Ampt model are:\n- Saturated hydraulic conductivity: $K_{s} = 12$ mm/hr\n- Wetting-front capillary suction head: $\\psi_{f} = 60$ mm\n- Change in water content at the wetting front: $\\Delta\\theta = 0.18$\n\nThe Green-Ampt equation for the potential infiltration rate, $f_{p}(t)$, as a function of cumulative infiltration, $F(t)$, is:\n$$f_{p}(t) = K_{s} \\left(1 + \\frac{\\psi_{f} \\Delta\\theta}{F(t)}\\right)$$\n\nPonding occurs at time $t_{p}$ when the potential infiltration rate drops to the rate of water supply at the surface. Before ponding, the actual infiltration rate $f(t)$ is equal to the supply rate, and the cumulative infiltration is $F(t) = \\int_{0}^{t} f(\\tau) d\\tau$.\n\n**Case A: Bare Soil**\nFor a bare soil surface, the water supply rate is the rainfall intensity $i = 30$ mm/hr, starting at $t=0$. Ponding is possible only if $i > K_{s}$. Here, $30 \\text{ mm/hr} > 12 \\text{ mm/hr}$, so ponding will occur.\nAt the moment of ponding, $t_{p, \\text{bare}}$, the potential infiltration rate equals the supply rate:\n$$f_{p}(t_{p, \\text{bare}}) = i$$\nBefore ponding, $F(t) = i \\times t$. Thus, at ponding, $F(t_{p, \\text{bare}}) = i \\times t_{p, \\text{bare}}$. Substituting this into the Green-Ampt equation:\n$$i = K_{s} \\left(1 + \\frac{\\psi_{f} \\Delta\\theta}{i \\times t_{p, \\text{bare}}}\\right)$$\nSolving for $t_{p, \\text{bare}}$:\n$$\\frac{i}{K_{s}} - 1 = \\frac{\\psi_{f} \\Delta\\theta}{i \\times t_{p, \\text{bare}}}$$\n$$t_{p, \\text{bare}} = \\frac{\\psi_{f} \\Delta\\theta}{i \\left(\\frac{i}{K_{s}} - 1\\right)} = \\frac{K_{s} \\psi_{f} \\Delta\\theta}{i(i - K_{s})}$$\nSubstituting the numerical values:\n$$t_{p, \\text{bare}} = \\frac{(12 \\text{ mm/hr})(60 \\text{ mm})(0.18)}{(30 \\text{ mm/hr})(30 \\text{ mm/hr} - 12 \\text{ mm/hr})} = \\frac{129.6}{30 \\times 18} = \\frac{129.6}{540} = 0.24 \\text{ hr}$$\nIn minutes, $t_{p, \\text{bare}} = 0.24 \\text{ hr} \\times 60 \\text{ min/hr} = 14.4 \\text{ min}$.\n\n**Case B: Forested Soil**\nFor the forested soil, water does not reach the ground for the initial period $t_{\\text{fill}}$. The water supply to the soil surface begins at $t = t_{\\text{fill}}$ and the supply rate is the effective rainfall intensity, which is equal to the rainfall intensity $i = 30$ mm/hr.\nThe infiltration process at the soil surface is identical to the bare soil case but is delayed by $t_{\\text{fill}}$. The time from the start of effective rainfall until ponding occurs is therefore the same as $t_{p, \\text{bare}}$.\nLet $t_{p, \\text{forested}}$ be the absolute time of ponding from the start of the storm ($t=0$). This will be the sum of the time to fill the canopy and the time to ponding once water reaches the surface.\n$$t_{p, \\text{forested}} = t_{\\text{fill}} + t_{p, \\text{bare}}$$\n$$t_{p, \\text{forested}} = 0.069333... \\text{ hr} + 0.24 \\text{ hr} = 0.309333... \\text{ hr}$$\nIn minutes, this is $t_{p, \\text{forested}} \\approx 18.56 \\text{ min}$.\n\n**Change in Ponding Time**\nThe problem asks for the change in ponding time relative to the bare-soil surface, $\\Delta t_{p}$.\n$$\\Delta t_{p} = t_{p, \\text{forested}} - t_{p, \\text{bare}}$$\nSubstituting the expressions derived above:\n$$\\Delta t_{p} = (t_{\\text{fill}} + t_{p, \\text{bare}}) - t_{p, \\text{bare}} = t_{\\text{fill}}$$\nThe change in ponding time is simply the time it takes for the canopy storage to be filled.\nWe calculate the numerical value of $\\Delta t_{p}$ in minutes:\n$$\\Delta t_{p} = t_{\\text{fill}} = 0.069333... \\text{ hr} \\times 60 \\frac{\\text{min}}{\\text{hr}} = \\frac{2.08}{30} \\times 60 \\text{ min} = 2.08 \\times 2 \\text{ min} = 4.16 \\text{ min}$$\n\nThe problem requires the final answer to be rounded to four significant figures.\n$$\\Delta t_{p} = 4.160 \\text{ min}$$\n\nThe presence of the forest canopy intercepts the initial rainfall, delaying the start of the infiltration process at the soil surface. This delay is precisely equal to the time required to saturate the canopy storage, after which the soil is subjected to the same rainfall intensity as the bare soil case. Therefore, the ponding time is delayed by exactly this canopy-filling time.",
            "answer": "$$\\boxed{4.160}$$"
        },
        {
            "introduction": "Runoff generation is not only a vertical process but is also strongly influenced by how water moves laterally across the landscape. This practice shifts our focus to a spatially-explicit framework to model saturation-excess runoff, a mechanism driven by topography. You will implement an algorithm to compute the Topographic Wetness Index (TWI) from a Digital Elevation Model (DEM), a classic technique for identifying areas where the water table is likely to surface and generate runoff .",
            "id": "3843236",
            "problem": "You are tasked to implement an algorithm to compute the Topographic Wetness Index (TWI) and infer zones prone to saturation-excess runoff during a specified rainfall event, using Digital Elevation Model (DEM) and remotely sensed inputs. The algorithm must be fully specified and implementable as a complete program. All mathematical entities in this statement are written in LaTeX.\n\nFundamental base and definitions:\n- A Digital Elevation Model (DEM) is a raster grid of elevations. Each cell is square with side length $s$ (in meters). Define $N$ as the total number of cells.\n- Using the steepest-descent flow routing (D8 scheme), each cell with at least one downslope neighbor routes its flow to exactly one adjacent cell (the neighbor with the largest elevation drop per planimetric distance). Let the chosen downstream neighbor index for cell $i$ be denoted by $r(i)$; if no neighbor is lower, the cell is a pit or outlet and does not route to any neighbor.\n- For each cell $i$, define the local slope angle $\\beta_i$ as the angle corresponding to the maximum downslope grade toward $r(i)$. Under the small-angle slope approximation, $\\tan \\beta_i$ equals the ratio of elevation drop to planimetric distance along the steepest descent. If a cell has no downslope neighbor, set $\\tan \\beta_i$ to a small positive constant $\\varepsilon$ to avoid division by zero. Angles are handled strictly in radians.\n- Let the specific catchment area $a_i$ (in meters) be the upslope contributing area per unit contour width for cell $i$. Under D8 on a square grid, approximate $a_i$ by $a_i = s \\cdot \\text{FA}_i$, where $\\text{FA}_i$ is the flow accumulation count of cells (including $i$ itself) that ultimately drain to cell $i$ through the D8 network.\n- The Topographic Wetness Index is defined by\n$$\n\\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right).\n$$\n- Normalized Difference Vegetation Index (NDVI) is a remote sensing product that we use to parameterize spatial variability in saturated hydraulic conductivity. Let $K_{0}$ be a reference saturated hydraulic conductivity (in millimeters per hour), and $\\gamma$ a dimensionless sensitivity parameter; define the local saturated hydraulic conductivity as\n$$\nK_{\\mathrm{sat},i} = K_{0} \\, \\exp(\\gamma \\cdot \\mathrm{NDVI}_i)\n$$\n(in millimeters per hour).\n- Soil moisture from remote sensing (e.g., Soil Moisture Active Passive (SMAP)) provides volumetric water content $\\theta_i$ (dimensionless). Let $z_s$ be the effective soil layer thickness (in meters) and $n$ be the soil porosity (dimensionless). The local unsaturated storage deficit prior to the event is approximated as\n$$\nD^{\\mathrm{base}}_i = z_s \\, \\max(n - \\theta_i, 0).\n$$\n- Following the core idea of the TOPMODEL family, local water table depth correlates with $\\mathrm{TWI}$ via an exponential transmissivity profile. A practical diagnostic representation for local deficit incorporates TWI as\n$$\nD_i = D^{\\mathrm{base}}_i - m \\left(\\mathrm{TWI}_i - \\overline{\\mathrm{TWI}}\\right),\n$$\nwhere $m$ (in meters) is a scaling parameter reflecting the decay of lateral transmissivity with depth, and $\\overline{\\mathrm{TWI}}$ is the spatial average of $\\mathrm{TWI}$ over the domain. High $\\mathrm{TWI}$ implies smaller local deficit $D_i$ (shallower water table).\n- Let the rainfall intensity be $I$ (in millimeters per hour), and the storm duration be $t$ (in hours). The rainfall depth is $P = I \\cdot t$ (in millimeters), equivalent to $P_m = P / 1000$ (in meters). The infiltration capacity during the event is $K_{\\mathrm{sat},i} \\cdot t$ (in millimeters), equivalent to $(K_{\\mathrm{sat},i} \\cdot t)/1000$ (in meters). A cell is prone to saturation-excess runoff if\n$$\nP_m \\ge \\max(D_i, 0) + \\frac{K_{\\mathrm{sat},i} \\cdot t}{1000}.\n$$\n\nYour tasks:\n1. Given a DEM and square cell size $s$ (in meters), compute steepest-descent D8 routing, the local slope proxy $\\tan \\beta_i$ along the chosen flow direction, the specific catchment area $a_i = s \\cdot \\text{FA}_i$, and $\\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right)$ for all cells. Use $\\varepsilon = 10^{-6}$ (dimensionless) as the lower bound for $\\tan \\beta_i$ when no downslope neighbor exists.\n2. Given NDVI and soil moisture fields of the same shape as the DEM, along with parameters $K_{0}$, $\\gamma$, $z_s$, $n$, and $m$, compute $K_{\\mathrm{sat},i}$, $D^{\\mathrm{base}}_i$, $D_i$, and determine whether each cell is prone to saturation-excess runoff under rainfall with intensity $I$ and duration $t$ using the criterion above.\n3. Report, for each test case, the fraction of cells prone to saturation-excess runoff, computed as $\\frac{\\text{count of prone cells}}{N}$, as a decimal number. No percentages are permitted; express as a decimal.\n\nUnits and angle conventions:\n- Elevation is unitless in the DEM arrays (relative units), but $s$ is in meters and governs $a_i$ units.\n- Rainfall intensity $I$ and saturated hydraulic conductivity $K_{\\mathrm{sat},i}$ must be treated in millimeters per hour, and durations $t$ in hours; depths should be internally converted to meters when compared to storage deficits $D_i$ (meters).\n- Soil layer thickness $z_s$ is in meters; porosity $n$ and soil moisture $\\theta_i$ are dimensionless fractions.\n- Angles are handled via $\\tan \\beta$; do not convert to degrees. If computing $\\beta$ explicitly, it must be in radians, but here use the drop-over-distance ratio directly as $\\tan \\beta$.\n\nTest Suite:\nImplement the algorithm for the following three cases. All arrays are $5 \\times 5$. The cell size is $s = 30$ meters for all cases.\n\nCase A (moderate relief, moderate rainfall):\n- DEM:\n$\\begin{bmatrix}\n120 & 118 & 117 & 118 & 120 \\\\\n115 & 110 & 108 & 110 & 115 \\\\\n112 & 105 & 100 & 105 & 112 \\\\\n110 & 104 & 99 & 104 & 110 \\\\\n108 & 102 & 98 & 102 & 108\n\\end{bmatrix}$\n- NDVI:\n$\\begin{bmatrix}\n0.40 & 0.45 & 0.50 & 0.45 & 0.40 \\\\\n0.45 & 0.55 & 0.60 & 0.55 & 0.45 \\\\\n0.50 & 0.60 & 0.70 & 0.60 & 0.50 \\\\\n0.45 & 0.55 & 0.60 & 0.55 & 0.45 \\\\\n0.40 & 0.45 & 0.50 & 0.45 & 0.40\n\\end{bmatrix}$\n- Soil moisture $\\theta$:\n$\\begin{bmatrix}\n0.20 & 0.22 & 0.24 & 0.22 & 0.20 \\\\\n0.22 & 0.26 & 0.28 & 0.26 & 0.22 \\\\\n0.24 & 0.28 & 0.30 & 0.28 & 0.24 \\\\\n0.22 & 0.26 & 0.28 & 0.26 & 0.22 \\\\\n0.20 & 0.22 & 0.24 & 0.22 & 0.20\n\\end{bmatrix}$\n- Parameters: $K_{0} = 10$ mm/h, $\\gamma = 1.0$, $z_s = 0.5$ m, $n = 0.45$, $m = 0.08$ m, rainfall intensity $I = 15$ mm/h, duration $t = 2$ h.\n\nCase B (near-flat relief, low rainfall, wet antecedent conditions):\n- DEM:\n$\\begin{bmatrix}\n100 & 100 & 99.9 & 100 & 100 \\\\\n100 & 100 & 99.8 & 100 & 100 \\\\\n100 & 100 & 99.7 & 100 & 100 \\\\\n100 & 100 & 99.6 & 100 & 100 \\\\\n100 & 100 & 99.5 & 100 & 100\n\\end{bmatrix}$\n- NDVI:\n$\\begin{bmatrix}\n0.30 & 0.30 & 0.30 & 0.30 & 0.30 \\\\\n0.30 & 0.35 & 0.35 & 0.35 & 0.30 \\\\\n0.30 & 0.35 & 0.40 & 0.35 & 0.30 \\\\\n0.30 & 0.35 & 0.35 & 0.35 & 0.30 \\\\\n0.30 & 0.30 & 0.30 & 0.30 & 0.30\n\\end{bmatrix}$\n- Soil moisture $\\theta$:\n$\\begin{bmatrix}\n0.42 & 0.42 & 0.42 & 0.42 & 0.42 \\\\\n0.42 & 0.43 & 0.43 & 0.43 & 0.42 \\\\\n0.42 & 0.43 & 0.44 & 0.43 & 0.42 \\\\\n0.42 & 0.43 & 0.43 & 0.43 & 0.42 \\\\\n0.42 & 0.42 & 0.42 & 0.42 & 0.42\n\\end{bmatrix}$\n- Parameters: $K_{0} = 12$ mm/h, $\\gamma = 0.8$, $z_s = 0.4$ m, $n = 0.45$, $m = 0.06$ m, rainfall intensity $I = 5$ mm/h, duration $t = 1$ h.\n\nCase C (steep relief, heavy rainfall):\n- DEM:\n$\\begin{bmatrix}\n200 & 190 & 180 & 190 & 200 \\\\\n180 & 170 & 160 & 170 & 180 \\\\\n160 & 150 & 140 & 150 & 160 \\\\\n150 & 140 & 130 & 140 & 150 \\\\\n140 & 130 & 120 & 130 & 140\n\\end{bmatrix}$\n- NDVI:\n$\\begin{bmatrix}\n0.50 & 0.55 & 0.60 & 0.55 & 0.50 \\\\\n0.55 & 0.60 & 0.65 & 0.60 & 0.55 \\\\\n0.60 & 0.65 & 0.70 & 0.65 & 0.60 \\\\\n0.55 & 0.60 & 0.65 & 0.60 & 0.55 \\\\\n0.50 & 0.55 & 0.60 & 0.55 & 0.50\n\\end{bmatrix}$\n- Soil moisture $\\theta$:\n$\\begin{bmatrix}\n0.28 & 0.29 & 0.30 & 0.29 & 0.28 \\\\\n0.29 & 0.30 & 0.31 & 0.30 & 0.29 \\\\\n0.30 & 0.31 & 0.32 & 0.31 & 0.30 \\\\\n0.29 & 0.30 & 0.31 & 0.30 & 0.29 \\\\\n0.28 & 0.29 & 0.30 & 0.29 & 0.28\n\\endbmatrix}$\n- Parameters: $K_{0} = 10$ mm/h, $\\gamma = 1.2$, $z_s = 0.5$ m, $n = 0.45$, $m = 0.10$ m, rainfall intensity $I = 50$ mm/h, duration $t = 3$ h.\n\nRequired output format:\n- Your program should compute, for each case, the fraction (a float) of cells prone to saturation-excess runoff. Aggregate the three fractions into a single line of output as a comma-separated list enclosed in square brackets, with no spaces, in the order Case A, Case B, Case C. For example: \"[0.12,0.34,0.56]\".",
            "solution": "The solution is implemented by following the sequence of tasks prescribed in the problem. The core of the algorithm involves two major phases: first, a topographic analysis of the Digital Elevation Model (DEM) to determine landscape-driven hydrological properties; and second, the integration of remotely sensed data and event characteristics to evaluate the runoff condition.\n\n**1. Topographic Analysis (D8, Slope, Flow Accumulation, and TWI)**\n\nThe first phase quantifies how topography controls the movement and accumulation of water.\n\n-   **D8 Flow Routing and Slope ($\\tan \\beta_i$)**: We begin by processing the DEM, a grid of elevation values. For each cell $i$, we apply the D8 algorithm, which identifies the steepest descent path to one of its eight adjacent neighbors. The slope, represented as $\\tan \\beta_i$, is calculated as the ratio of the elevation drop to the planimetric distance. The distance is $s$ for orthogonal neighbors and $s\\sqrt{2}$ for diagonal neighbors, where $s$ is the cell side length. If a cell has no neighbors at a strictly lower elevation, it is a pit or a flat area sink. As per the problem's rule, for such cells, we set $\\tan \\beta_i$ to a small positive constant, $\\varepsilon = 10^{-6}$, to ensure numerical stability in subsequent calculations. A flow direction raster is concurrently computed, where each cell points to its designated downstream neighbor.\n\n-   **Flow Accumulation ($\\text{FA}_i$)**: Flow accumulation determines the total number of cells that drain into any given cell. To compute this correctly, cells must be processed in a specific topological order, from highest elevation to lowest. We first create a list of all cells and sort them in descending order of their elevation. We initialize a flow accumulation grid, $\\text{FA}$, with all values set to $1$, representing each cell's own contribution. Then, we iterate through the sorted list of cells. For each cell, we add its current flow accumulation value to the value of its downstream neighbor (identified in the previous step). This ensures that by the time a cell is processed, the contributions from all its upslope cells have already been accounted for.\n\n-   **Specific Catchment Area ($a_i$) and TWI ($\\mathrm{TWI}_i$)**: With the flow accumulation, $\\text{FA}_i$, for each cell, we calculate the specific catchment area, $a_i = s \\cdot \\text{FA}_i$. This value represents the total upslope area contributing flow, normalized by contour length (approximated here by a single cell width $s$). Finally, the Topographic Wetness Index for each cell is computed using its defining equation:\n    $$\n    \\mathrm{TWI}_i = \\ln\\!\\left(\\frac{a_i}{\\tan \\beta_i}\\right)\n    $$\n    The TWI is a dimensionless index where higher values indicate locations that are topographically predisposed to be wetter (large contributing area and/or low local slope).\n\n**2. Hydrological Parameterization and Runoff Generation**\n\nThe second phase integrates soil and vegetation properties from remote sensing, along with rainfall characteristics, to assess the runoff-generating potential of each cell.\n\n-   **Saturated Hydraulic Conductivity ($K_{\\mathrm{sat},i}$)**: The spatial variability of the soil's ability to transmit water is parameterized using the Normalized Difference Vegetation Index (NDVI). The local saturated hydraulic conductivity, $K_{\\mathrm{sat},i}$ (in mm/h), is calculated for each cell $i$:\n    $$\n    K_{\\mathrm{sat},i} = K_{0} \\, \\exp(\\gamma \\cdot \\mathrm{NDVI}_i)\n    $$\n    where $K_{0}$ is a reference conductivity and $\\gamma$ is a sensitivity parameter.\n\n-   **Storage Deficit ($D_i$)**: The model estimates the soil moisture deficit, which is the volume of water needed to saturate the soil column. First, a baseline deficit, $D^{\\mathrm{base}}_i$ (in meters), is calculated from remotely sensed soil moisture $\\theta_i$, soil porosity $n$, and effective soil depth $z_s$:\n    $$\n    D^{\\mathrm{base}}_i = z_s \\, \\max(n - \\theta_i, 0)\n    $$\n    This baseline value is then adjusted based on the cell's topographic position, using the previously calculated TWI. This step is central to TOPMODEL-like frameworks, linking static topography to the dynamic soil moisture state. The final local deficit, $D_i$ (in meters), is:\n    $$\n    D_i = D^{\\mathrm{base}}_i - m \\left(\\mathrm{TWI}_i - \\overline{\\mathrm{TWI}}\\right)\n    $$\n    where $\\overline{\\mathrm{TWI}}$ is the average TWI over the entire domain and $m$ is a scaling parameter. This equation implies that cells with an above-average TWI will have their deficit reduced, representing a shallower water table.\n\n-   **Saturation-Excess Runoff Criterion**: A cell is considered prone to generating saturation-excess runoff if the total rainfall amount exceeds the soil's capacity to store and infiltrate it. The total rainfall depth, $P_m$, is $I \\cdot t / 1000$ (in meters). The total potential infiltration depth over the storm duration $t$ is $(K_{\\mathrm{sat},i} \\cdot t) / 1000$ (in meters). The available storage is the non-negative part of the local deficit, $\\max(D_i, 0)$, as a negative deficit implies the soil is already saturated. The condition for runoff is thus:\n    $$\n    P_m \\ge \\max(D_i, 0) + \\frac{K_{\\mathrm{sat},i} \\cdot t}{1000}\n    $$\n\n**3. Final Calculation and Reporting**\n\nFor each test case, the algorithm applies the runoff criterion to every cell in the grid, yielding a boolean map of prone versus non-prone cells. The total count of prone cells is divided by the total number of cells in the domain, $N$, to obtain the fraction of the area prone to saturation-excess runoff. This procedure is repeated for each of the three test cases provided.",
            "answer": "$$\\boxed{\\text{[0.12,0.2,0.16]}}$$_"
        }
    ]
}