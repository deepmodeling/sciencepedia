{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在揭示元胞自动机模型中空间相互作用项的核心价值。通过推导在移除邻域效应（即 $\\theta_{N} = 0$）后模型与像素级逻辑回归模型的等价性，我们能更深刻地理解空间依赖性是如何驱动城市增长模拟中复杂模式涌现的。这项实践强调了元胞自动机作为一种真正的“空间”模型的本质。",
            "id": "3863809",
            "problem": "考虑一个用于模拟城市增长的二元状态元胞自动机 (CA)，该模型建立在栅格网格上。在时间 $t$，每个像素 $i$ 的状态为 $S_{i}^{t} \\in \\{0,1\\}$，分别表示非城市和城市。假设该 CA 是一个一阶马尔可夫过程：$S_{i}^{t+1}$ 的分布仅取决于当前状态 $S^{t}$ 和一组像素级别的外生协变量 $\\mathbf{x}_{i} = (x_{i1}, x_{i2}, \\dots, x_{ip})$。这些协变量源自遥感数据（例如，道路可达性、地形坡度以及到中心商务区的距离）。令 $N(i)$ 表示像素 $i$ 的邻域，$w_{ij} \\geq 0$ 表示对于 $j \\in N(i)$ 的空间权重。\n\n基本假设：\n- 每个 $S_{i}^{t+1}$ 是以 $\\left(S^{t}, \\mathbf{x}_{i}\\right)$ 为条件的伯努利随机变量。\n- 该 CA 使用伯努利族的典范广义线性模型 (GLM) 结构，并采用 logit 连接函数：转移的条件优势比是线性预测器的指数函数。\n- 邻域交互作用通过邻域的线性泛函 $\\sum_{j \\in N(i)} w_{ij} S_{j}^{t}$ 来表示。\n\n在这些假设下，下一时间步城市化的条件对数优势比为\n$$\n\\ln\\left(\\frac{\\mathbb{P}\\left(S_{i}^{t+1}=1 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}{\\mathbb{P}\\left(S_{i}^{t+1}=0 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}\\right)\n= \\theta_{0} + \\sum_{k=1}^{p} \\theta_{k} x_{ik} + \\theta_{N} \\sum_{j \\in N(i)} w_{ij} S_{j}^{t},\n$$\n其中 $\\theta_{0}$, $\\theta_{1},\\dots,\\theta_{p}$ 和 $\\theta_{N}$ 是待从历史数据中估计的未知参数。\n\n任务：\n1. 从上述基本假设和伯努利响应的 logit 连接函数定义出发，推导当移除空间交互项（即 $\\theta_{N} = 0$）时，此 CA 模型与一个对每个像素 $i$ 独立应用、以 $\\mathbf{x}_{i}$ 为特征的像素级逻辑斯蒂回归模型之间的等价性。您的推导必须明确展示在 $\\theta_{N}=0$ 的情况下联合似然函数如何跨像素进行因子分解，并阐明为何最大似然估计会解耦为对每个像素的独立逻辑斯蒂回归。\n2. 使用 $\\theta_{N}=0$ 的设定，考虑单个像素，其标准化遥感协变量为 $x_{1} = 1.5$（值越高表示道路可达性越好）、$x_{2} = 0.7$（地形坡度指数，值越高表示地形越陡峭）和 $x_{3} = -0.6$（标准化的到中心距离，值越低表示中心性越强）。假设模型参数为 $\\theta_{0} = -1.0$、$\\theta_{1} = 1.2$、$\\theta_{2} = -0.8$ 和 $\\theta_{3} = 0.5$。计算该像素的单步城市化概率 $\\mathbb{P}\\left(S^{t+1}=1 \\,\\middle|\\, \\mathbf{x}\\right)$，结果以小数表示，并四舍五入到四位有效数字。\n3. 提供一个简明的定性分析，说明当移除空间交互作用（即设置 $\\theta_{N} = 0$）时，模型会损失哪些动态特性。分析应侧重于集聚、蔓延、空间自相关以及表示路径依赖的城市增长过程的能力。您的分析必须基于您在任务1中推导出的数学结构。\n\n答案规格：\n- 任务2的最终数值答案必须是一个以小数表示的实数，并四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于空间统计学和元胞自动机建模的原理，问题设定清晰完整、形式良定，并以客观、正式的语言表述。各项任务均可根据所提供的信息解决。\n\n### 任务1：与像素级逻辑斯蒂回归的等价性\n\n分析始于像素 $i$ 在时间 $t+1$ 城市化的条件对数优势比的一般形式：\n$$\n\\ln\\left(\\frac{\\mathbb{P}\\left(S_{i}^{t+1}=1 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}{\\mathbb{P}\\left(S_{i}^{t+1}=0 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}\\right) = \\theta_{0} + \\sum_{k=1}^{p} \\theta_{k} x_{ik} + \\theta_{N} \\sum_{j \\in N(i)} w_{ij} S_{j}^{t}\n$$\n该任务要求考察移除空间交互项的情况，这对应于设置参数 $\\theta_{N} = 0$。当 $\\theta_{N} = 0$ 时，方程简化为：\n$$\n\\ln\\left(\\frac{\\mathbb{P}\\left(S_{i}^{t+1}=1 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}{\\mathbb{P}\\left(S_{i}^{t+1}=0 \\,\\middle|\\, S^{t}, \\mathbf{x}_{i}\\right)}\\right) = \\theta_{0} + \\sum_{k=1}^{p} \\theta_{k} x_{ik}\n$$\n该方程的右侧，即线性预测器，现在仅依赖于像素 $i$ 的外生协变量 $\\mathbf{x}_{i}$ 和全局参数 $(\\theta_{0}, \\dots, \\theta_{p})$。它不再依赖于系统的状态 $S^{t}$。因此，像素 $i$ 的城市化条件概率也独立于 $S^{t}$。我们可以将像素 $i$ 的城市化概率（记为 $P_i$）写成仅以其自身协变量 $\\mathbf{x}_i$ 为条件的形式：\n$$\nP_{i} \\equiv \\mathbb{P}\\left(S_{i}^{t+1}=1 \\,\\middle|\\, \\mathbf{x}_{i}\\right)\n$$\n对数优势比方程可以用 logit 函数表示法重写为：\n$$\n\\text{logit}(P_{i}) = \\ln\\left(\\frac{P_{i}}{1-P_{i}}\\right) = \\theta_{0} + \\sum_{k=1}^{p} \\theta_{k} x_{ik}\n$$\n这正是一个以 $\\mathbf{x}_{i}$ 为预测变量、以二元结果 $S_{i}^{t+1}$ 为目标的逻辑斯蒂回归模型的数学形式。\n\n为了从参数估计的角度证明其等价性，我们考虑在给定所有协变量集合 $\\mathbf{X} = (\\mathbf{x}_1, \\dots, \\mathbf{x}_M)$ 的条件下，观测到网格中所有 $M$ 个像素的特定城市配置 $s^{t+1} = (s_{1}^{t+1}, s_{2}^{t+1}, \\dots, s_{M}^{t+1})$ 的联合似然。在完整模型（$\\theta_{N} \\neq 0$）中，像素 $i$ 的转移概率依赖于其邻域像素的状态 $S_{j}^{t}$，这在整个网格上造成了复杂的依赖结构。联合似然函数无法分解为独立项的简单乘积，这是马尔可夫随机场的一个标志，需要使用如伪似然等特定的估计技术。\n\n然而，当 $\\theta_{N} = 0$ 时，在给定各自协变量的条件下，像素 $i$ 的状态 $S_{i}^{t+1}$ 与任何其他像素 $j \\neq i$ 的状态 $S_{j}^{t+1}$ 条件独立。这种条件独立性使得联合概率分布可以分解为每个像素的单个边际概率的乘积：\n$$\n\\mathbb{P}\\left(S^{t+1}=s^{t+1} \\,\\middle|\\, \\mathbf{X}\\right) = \\prod_{i=1}^{M} \\mathbb{P}\\left(S_{i}^{t+1}=s_{i}^{t+1} \\,\\middle|\\, \\mathbf{x}_{i}\\right)\n$$\n参数向量 $\\boldsymbol{\\theta} = (\\theta_{0}, \\dots, \\theta_{p})$ 的似然函数 $L$ 由该乘积给出，其中每一项是成功概率为 $P_i$ 的伯努利变量的概率质量函数：\n$$\nL(\\boldsymbol{\\theta} \\,\\middle|\\, s^{t+1}, \\mathbf{X}) = \\prod_{i=1}^{M} P_{i}^{s_{i}^{t+1}} (1 - P_{i})^{1 - s_{i}^{t+1}}\n$$\n其中 $P_i$ 是 $\\boldsymbol{\\theta}$ 和 $\\mathbf{x}_i$ 的函数。对数似然函数 $\\ell(\\boldsymbol{\\theta})$ 是每个像素的单个对数似然贡献之和：\n$$\n\\ell(\\boldsymbol{\\theta}) = \\ln L(\\boldsymbol{\\theta}) = \\sum_{i=1}^{M} \\left[ s_{i}^{t+1} \\ln(P_{i}) + (1 - s_{i}^{t+1}) \\ln(1 - P_{i}) \\right]\n$$\n这正是一个标准逻辑斯蒂回归的对数似然函数，其中每个像素 $i$ 被视为一个独立的观测，其二元结果为 $s_i^{t+1}$，特征向量为 $\\mathbf{x}_i$。最大似然估计 (MLE) 旨在找到使该函数最大化的参数向量 $\\boldsymbol{\\theta}$。因为该函数是独立项的总和，所以估计过程将所有像素的集合视为一个由独立样本组成的单一数据集。因此，$\\theta_{N}=0$ 的元胞自动机模型在方法论上等同于将单个逻辑斯蒂回归模型应用于全体像素，其中每个像素都是一个独立的数据点。\n\n### 任务2：城市化概率的计算\n\n根据 $\\theta_{N}=0$ 的设定，我们使用给定的协变量和参数计算指定像素的线性预测器 $\\eta$。\n协变量为 $x_{1} = 1.5$、$x_{2} = 0.7$ 和 $x_{3} = -0.6$。\n参数为 $\\theta_{0} = -1.0$、$\\theta_{1} = 1.2$、$\\theta_{2} = -0.8$ 和 $\\theta_{3} = 0.5$。\n\n线性预测器 $\\eta$ 为：\n$$\n\\eta = \\theta_{0} + \\theta_{1} x_{1} + \\theta_{2} x_{2} + \\theta_{3} x_{3}\n$$\n代入数值：\n$$\n\\eta = -1.0 + (1.2)(1.5) + (-0.8)(0.7) + (0.5)(-0.6)\n$$\n$$\n\\eta = -1.0 + 1.8 - 0.56 - 0.30\n$$\n$$\n\\eta = 0.8 - 0.56 - 0.30 = 0.24 - 0.30 = -0.06\n$$\n城市化概率 $\\mathbb{P}\\left(S^{t+1}=1 \\,\\middle|\\, \\mathbf{x}\\right)$ 由 logistic 函数（logit 连接函数的反函数）给出：\n$$\nP = \\frac{\\exp(\\eta)}{1 + \\exp(\\eta)}\n$$\n代入 $\\eta = -0.06$：\n$$\nP = \\frac{\\exp(-0.06)}{1 + \\exp(-0.06)} \\approx \\frac{0.9417645}{1 + 0.9417645} \\approx \\frac{0.9417645}{1.9417645} \\approx 0.4850021\n$$\n将结果四舍五入到四位有效数字，得到 $0.4850$。\n\n### 任务3：损失的动态特性定性分析\n\n将空间交互参数 $\\theta_{N}$ 设置为 $0$ 从根本上改变了模型的性质，剥夺了其模拟城市增长所固有的关键空间动态过程的能力。该分析基于任务1中推导出的数学结构，在该结构中建立了像素间的条件独立性。\n\n1.  **集聚与蔓延**：损失的主要动态特性是对空间蔓延的显式建模。$\\theta_{N} \\sum_{j \\in N(i)} w_{ij} S_{j}^{t}$ 项代表了一种局部反馈机制。如果 $\\theta_{N} > 0$，像素邻域中存在城市单元会增加其自身变为城市的概率。这导致了集聚且连片的城市斑块的出现，反映了现实中城市通常从现有建成区向外扩张（即蔓延式扩张）的方式。当 $\\theta_{N} = 0$ 时，该机制被消除。城市化完全成为由协变量 $\\mathbf{x}_i$ 定义的静态场址适宜性的函数。模型将预测出一种“椒盐”式的新增长模式，其中像素的城市化仅基于其内在特征，而不管其与现有城市中心的邻近性。生成空间上连贯的城市形态的能力丧失了。\n\n2.  **空间自相关**：$\\theta_{N} \\neq 0$ 的模型是一个自逻辑斯蒂模型，其设计旨在解释因变量（城市用地格局）中的空间自相关。通过设置 $\\theta_{N} = 0$，我们强加了一个条件空间独立性的假设。如任务1所示，似然函数可以因子分解，这意味着在给定协变量 $\\mathbf{x}$ 的情况下，一个像素的状态不提供关于另一个像素状态的任何信息。这忽略了 Tobler 地理学第一定律的原则，即“万物皆有联系，但邻近的事物比遥远的事物联系更紧密”。现实世界的城市增长表现出强烈的空间自相关性；而 $\\theta_{N}=0$ 的模型未能捕捉到过程本身的这一基本属性。\n\n3.  **路径依赖**：包含邻域状态 $S^t$ 为系统的演化引入了路径依赖。时间 $t$ 的城市景观空间格局——即所有先前增长的结果——直接影响到时间 $t+1$ 的增长模式。两种不同的城市化空间模式，即使城市土地总量相同，也会沿着不同的未来轨迹演化。当 $\\theta_{N} = 0$ 时，这种路径依赖被移除。增长过程变得非历史性的，并且仅在一种平凡的意义上是马尔可夫的；未来状态仅依赖于静态的外生因素。模型失去了对其所创造的空间结构的“记忆”。它不再是一个真正的元胞自动机（其中单元状态通过局部交互作用演化），而更像是一个在每个时间步都重新评估的简单的适宜性映射。",
            "answer": "$$\n\\boxed{0.4850}\n$$"
        },
        {
            "introduction": "一个强大的城市增长模型必须能融合真实的地理环境因素。本练习将引导你推导出一个基于广义线性模型（GLM）框架的转换规则，该规则能够量化地形坡度等外生变量对城市化概率的影响。通过这项实践，你将学会如何将遥感数据衍生的地理空间变量（如坡度）整合进元胞自动机的动态核心，从而建立更具现实意义的预测模型。",
            "id": "3863758",
            "problem": "在一个关于城市增长的Slope, Land use, Exclusion, Urban extent, Transportation, Hillshade (SLEUTH)元胞自动机的随机模型中，考虑单个时间步和一个候选元胞，其地形坡度（坡度角）用 $\\theta$ 表示，单位为度。设向城市转变的事件被建模为一个伯努利试验，其概率为 $p(\\theta)$，且必须服从两个基本约束：(i) 对于所有允许的 $\\theta$，$p(\\theta)$ 严格介于 $0$ 和 $1$ 之间；(ii) 增加 $\\theta$ 会单調降低城市化的趋势。进一步假设，独立因素对转移概率的影响在适当的变换尺度上是可加的，因此转移优势比的乘性效应源于预测变量中的加性贡献。利用概率论和广义线性模型的这些基本要求，推导 $p(\\theta)$ 的一个函数形式，其中一个非负的坡度阻力参数 $\\rho$ 对转移的对数优势比施加一个关于 $\\theta$ 的线性惩罚。用零坡度时的基准优势比 $O_{0}$ 和参数 $\\rho$ 来表示 $p(\\theta)$。\n\n然后，使用您推导出的形式，计算当坡度角从 $\\theta_{1} = 5^{\\circ}$ 变为 $\\theta_{2} = 15^{\\circ}$ 时所隐含的优势比率，并将其表示为仅含 $\\rho$ 的闭式解析表达式。报告在 $\\theta_{2}$ 相对于 $\\theta_{1}$ 时的转移优势比率。角度单位为度。最终答案必须是单个符号表达式。请勿在最终的方框答案中包含任何单位。",
            "solution": "问题要求推导城市化概率 $p(\\theta)$ 的函数形式，并计算坡度变化时的优势比率。推导基于广义线性模型（特别是逻辑斯谛回归）的原理。\n\n首先，我们建立事件概率 $p$、事件优势比 $O$ 和事件对数优势比 (logit) $L$ 之间的关系。优势比定义为事件发生的概率与事件不发生的概率之比。\n$$\nO = \\frac{p}{1-p}\n$$\n对数优势比是优势比的自然对数：\n$$\nL = \\ln(O) = \\ln\\left(\\frac{p}{1-p}\\right)\n$$\n问题指出，独立因素的影响在变换尺度上（具体来说是对数优势比尺度）是可加的，从而导致对优势比的乘性效应。问题进一步指明，一个非负的坡度阻力参数 $\\rho$ 对转移的对数优势比施加一个关于坡度角 $\\theta$ 的线性惩罚。\n\n设 $L(\\theta)$ 为坡度为 $\\theta$ 的元胞的城市化对数优势比。所描述的模型可以表示为 $L(\\theta)$ 和 $\\theta$ 之间的线性关系。\n设 $L_0$ 为坡度为零（即 $\\theta=0$）时的基准对数优势比。线性惩罚意味着随着 $\\theta$ 的增加，对数优势比从这个基准线性下降。这给出了方程：\n$$\nL(\\theta) = L_0 - \\rho \\theta\n$$\n问题引入了零坡度时的基准优势比 $O_0$。$L_0$ 和 $O_0$ 之间的关系是 $L_0 = \\ln(O_0)$。将此代入 $L(\\theta)$ 的方程中：\n$$\n\\ln(O(\\theta)) = \\ln(O_0) - \\rho \\theta\n$$\n为了求出作为 $\\theta$ 函数的优势比 $O(\\theta)$，我们对等式两边取指数：\n$$\n\\exp(\\ln(O(\\theta))) = \\exp(\\ln(O_0) - \\rho \\theta)\n$$\n$$\nO(\\theta) = \\exp(\\ln(O_0)) \\exp(-\\rho \\theta)\n$$\n$$\nO(\\theta) = O_0 \\exp(-\\rho \\theta)\n$$\n这个方程显示了对优势比的乘性效应，符合要求。\n\n现在我们推导概率 $p(\\theta)$ 的函数形式。我们从优势比的定义 $O(\\theta) = \\frac{p(\\theta)}{1-p(\\theta)}$ 出发，解出 $p(\\theta)$：\n$$\nO(\\theta) (1 - p(\\theta)) = p(\\theta)\n$$\n$$\nO(\\theta) - O(\\theta) p(\\theta) = p(\\theta)\n$$\n$$\nO(\\theta) = p(\\theta) + O(\\theta) p(\\theta)\n$$\n$$\nO(\\theta) = p(\\theta) (1 + O(\\theta))\n$$\n$$\np(\\theta) = \\frac{O(\\theta)}{1 + O(\\theta)}\n$$\n代入我们推导出的 $O(\\theta)$ 表达式：\n$$\np(\\theta) = \\frac{O_0 \\exp(-\\rho \\theta)}{1 + O_0 \\exp(-\\rho \\theta)}\n$$\n这就是所要求的 $p(\\theta)$ 的函数形式，它是一个标准的逻辑斯谛函数。该形式满足给定的约束条件：对于 $\\rho \\geq 0$，$\\theta \\ge 0$ 和物理上有意义的优势比 $O_0 > 0$，我们有 $0  p(\\theta)  1$，并且 $p(\\theta)$ 是 $\\theta$ 的单调非增函数。\n\n接下来，我们要计算坡度角从 $\\theta_{1} = 5^{\\circ}$ 变为 $\\theta_{2} = 15^{\\circ}$ 时的优势比率。优势比率是在 $\\theta_2$ 时的优势比与在 $\\theta_1$ 时的优势比之比。我们用 $OR$ 表示优势比率。\n$$\nOR = \\frac{O(\\theta_2)}{O(\\theta_1)}\n$$\n使用我们的表达式 $O(\\theta) = O_0 \\exp(-\\rho \\theta)$：\n$$\nOR = \\frac{O_0 \\exp(-\\rho \\theta_2)}{O_0 \\exp(-\\rho \\theta_1)}\n$$\n基准优势比 $O_0$ 被消掉：\n$$\nOR = \\frac{\\exp(-\\rho \\theta_2)}{\\exp(-\\rho \\theta_1)} = \\exp(-\\rho \\theta_2 - (-\\rho \\theta_1)) = \\exp(-\\rho (\\theta_2 - \\theta_1))\n$$\n问题提供了值 $\\theta_1 = 5$ 和 $\\theta_2 = 15$。角度以度为单位，这是此类模型中坡度的常规单位。参数 $\\rho$ 的单位应理解为度的倒数，以使指数函数的参数无量纲。\n我们计算差值 $\\Delta\\theta = \\theta_2 - \\theta_1$：\n$$\n\\Delta\\theta = 15 - 5 = 10\n$$\n将该值代入优势比率的表达式中：\n$$\nOR = \\exp(-\\rho \\times 10) = \\exp(-10\\rho)\n$$\n这就是用坡度阻力参数 $\\rho$ 表示的优势比率的最终闭式解析表达式。",
            "answer": "$$\n\\boxed{\\exp(-10\\rho)}\n$$"
        },
        {
            "introduction": "模型的准确性评估是建模流程中不可或缺的一环，尤其对于空间模型而言，传统的评估指标可能过于严苛。本练习介绍了一种更精细的评估方法——模糊Kappa系数，它能够“宽容”地对待那些“差一点就对”的预测（例如，模拟的城市像元紧邻着真实的城市像元）。通过从基本原理出发推导并计算模糊Kappa，你将掌握一种更适合评估空间模拟结果的验证工具，从而能更公正地判断模型的表现。",
            "id": "3863773",
            "problem": "考虑评估一个由元胞自动机（CA）模拟生成的二元城市地图与一个源自遥感的参考城市地图。设二元类别为“城市”和“非城市”。CA预测和参考地图定义在一个由 $N$ 个像元组成的一维格网上，像元索引为 $i \\in \\{1,2,\\dots,N\\}$，其中邻接关系是此格网上的标准曼哈顿距离。评估应基于分类一致性的模糊泛化，其中参考的“城市”类别被表示为一个模糊集，其隶属度函数随与观测到的城市像元的距离增加而下降，而CA预测则保持清晰（非模糊）。\n\n从以下基本基础出发：\n- 二元分类一致性指数所使用的思想是，观测到的一致性是两个地图都分配相同类别的概率在所有像元上的平均值，而随机机会下的期望一致性是根据两个地图类别在地图间相互独立的假设下，从各自的边际比例计算得出的。\n- “城市”的模糊集由每个像元 $i$ 上的隶属度函数 $u(i) \\in [0,1]$ 表示，其中 $u(i)$ 解释为属于“城市”的隶属度。\n- 距离衰减隶属度函数 $w(d)$ 是曼哈顿距离 $d$ 的一个非增函数，它赋值 $u(i) = \\max_{j \\in R_{\\text{urban}}} w(d(i,j))$，其中 $R_{\\text{urban}}$ 是观测到的城市像元的集合。\n\n推导模糊卡帕系数的闭式表达式，该系数定义为二元情况下经机会校正的模糊一致性，其中模糊性仅通过上述的 $u(i)$ 引入到参考地图上，而CA预测在每个像元上对城市类别具有清晰的隶属度 $p(i) \\in \\{0,1\\}$。推导像元级一致性、总体观测一致性以及在随机机会下的期望一致性，仅使用这些基本基础和机会的独立性假设。\n\n然后，为以下简单的错位示例计算模糊卡帕系数：\n- 格网大小 $N=5$，像元 $i \\in \\{1,2,3,4,5\\}$。\n- 参考地图在 $i=3$ 处有一个单一的观测城市像元。\n- CA预测在 $i=4$ 处有一个单一的城市像元（一个像元的错位）。\n- 距离衰减隶属度为 $w(d) = \\exp(-\\beta d)$，其中 $\\beta = \\ln\\!\\big(\\frac{3}{2}\\big)$，因此 $w(0)=1$，$w(1)=\\frac{2}{3}$，以及 $w(2)=\\frac{4}{9}$。\n\n将最终答案表示为一个精确的有理数。无需四舍五入。",
            "solution": "此问题被评估为有效，因为它具有科学依据、问题设定良好且客观。它基于模糊集理论和空间统计学（特别是卡帕系数）的既定原则，并为形式化推导和后续计算提供了一套完整、一致的定义和数据。\n\n我们首先在指定条件下推导模糊卡帕系数（$\\kappa_f$）的一般公式：一个清晰的二元预测地图和一个模糊的二元参考地图。卡帕系数是衡量机会校正后一致性的指标，定义为：\n$$ \\kappa_f = \\frac{P_o - P_e}{1 - P_e} $$\n其中 $P_o$ 是观测一致性，$P_e$ 是随机机会下的期望一致性。\n\n设一维格网有 $N$ 个像元，索引为 $i \\in \\{1, 2, \\dots, N\\}$。\nCA预测是一个清晰地图，其中对于每个像元 $i$，其在“城市”类别中的隶属度由 $p(i) \\in \\{0, 1\\}$ 给出。因此，其在“非城市”类别中的隶属度是 $1-p(i)$。\n参考地图是模糊的。像元 $i$ 在“城市”类别中的隶属度是 $u(i) \\in [0, 1]$。因此，其在“非城市”类别中的隶属度是 $1-u(i)$。\n\n**1. 像元级一致性与观测一致性 ($P_o$)**\n\n单个像元 $i$ 上的一致性是两个地图将该像元分类相同的程度。这是一致性在“城市”类别上和“非城市”类别上的总和。根据概率解释所建议的，使用模糊集交集的乘积法则，对“城市”类别的一致性为 $p(i) \\cdot u(i)$，对“非城市”类别的一致性为 $(1-p(i)) \\cdot (1-u(i))$。\n\n在像元 $i$ 上的总一致性，记为 $a(i)$，是这两个分量的和：\n$$ a(i) = p(i)u(i) + (1-p(i))(1-u(i)) $$\n总体观测一致性 $P_o$ 是这些像元级一致性在所有 $N$ 个像元上的平均值：\n$$ P_o = \\frac{1}{N} \\sum_{i=1}^{N} a(i) = \\frac{1}{N} \\sum_{i=1}^{N} [p(i)u(i) + (1-p(i))(1-u(i))] $$\n\n**2. 期望一致性 ($P_e$)**\n\n期望一致性是基于每个地图中各类别的边际比例计算的，并假设两个地图之间统计独立。\n\n首先，我们确定每个地图“城市”和“非城市”类别的边际比例。\n对于清晰的CA预测地图：\n- “城市”比例：$P_{\\text{pred, urban}} = \\frac{1}{N} \\sum_{i=1}^{N} p(i)$\n- “非城市”比例：$P_{\\text{pred, non-urban}} = \\frac{1}{N} \\sum_{i=1}^{N} (1-p(i)) = 1 - P_{\\text{pred, urban}}$\n\n对于模糊参考地图，一个类别的比例是隶属度值之和除以 $N$：\n- “城市”比例：$P_{\\text{ref, urban}} = \\frac{1}{N} \\sum_{i=1}^{N} u(i)$\n- “非城市”比例：$P_{\\text{ref, non-urban}} = \\frac{1}{N} \\sum_{i=1}^{N} (1-u(i)) = 1 - P_{\\text{ref, urban}}$\n\n随机机会下的期望一致性 $P_e$ 是每个类别随机一致的概率之和。\n$P_e = (\\text{两者皆为城市的概率}) + (\\text{两者皆为非城市的概率})$\n$$ P_e = (P_{\\text{pred, urban}})(P_{\\text{ref, urban}}) + (P_{\\text{pred, non-urban}})(P_{\\text{ref, non-urban}}) $$\n代入比例的表达式：\n$$ P_e = \\left(\\frac{1}{N} \\sum_{i=1}^{N} p(i)\\right) \\left(\\frac{1}{N} \\sum_{j=1}^{N} u(j)\\right) + \\left(\\frac{1}{N} \\sum_{i=1}^{N} (1-p(i))\\right) \\left(\\frac{1}{N} \\sum_{j=1}^{N} (1-u(j))\\right) $$\n至此完成了所需闭式表达式的推导。\n\n**3. 具体示例的计算**\n\n现在我们将这些公式应用于给定的案例：\n- 格网大小：$N=5$。\n- 参考地图：在 $i=3$ 处有一个单一的城市像元。\n- CA预测地图：在 $i=4$ 处有一个单一的城市像元。\n- 距离衰减函数：$w(d) = \\exp(-\\beta d)$，其中 $\\beta = \\ln(3/2)$。\n\n**步骤A：定义预测地图和参考地图**\n清晰的预测地图 $p$ 满足 $p(4)=1$ 且对于 $i \\neq 4$ 有 $p(i)=0$。其向量为：\n$$ p = (0, 0, 0, 1, 0) $$\n模糊参考地图的隶属度函数 $u(i)$ 由 $u(i) = \\max_{j \\in \\{3\\}} w(|i-j|) = w(|i-3|)$ 给出。\n衰减函数为 $w(d) = \\exp(-\\ln(3/2) \\cdot d) = (\\exp(\\ln(3/2)))^{-d} = (3/2)^{-d} = (2/3)^d$。\n我们计算 $i \\in \\{1, 2, 3, 4, 5\\}$ 的隶属度值 $u(i)$：\n- $u(1) = w(|1-3|) = w(2) = (2/3)^2 = 4/9$\n- $u(2) = w(|2-3|) = w(1) = (2/3)^1 = 2/3$\n- $u(3) = w(|3-3|) = w(0) = (2/3)^0 = 1$\n- $u(4) = w(|4-3|) = w(1) = (2/3)^1 = 2/3$\n- $u(5) = w(|5-3|) = w(2) = (2/3)^2 = 4/9$\n模糊隶属度向量为：\n$$ u = (4/9, 2/3, 1, 2/3, 4/9) $$\n\n**步骤B：计算观测一致性 ($P_o$)**\n$$ P_o = \\frac{1}{5} \\sum_{i=1}^{5} [p(i)u(i) + (1-p(i))(1-u(i))] $$\n求和项为：\n- $i=1: (1-0)(1 - 4/9) = 5/9$\n- $i=2: (1-0)(1 - 2/3) = 1/3$\n- $i=3: (1-0)(1 - 1) = 0$\n- $i=4: (1)(2/3) + (1-1)(1 - 2/3) = 2/3$\n- $i=5: (1-0)(1 - 4/9) = 5/9$\n$$ \\sum_{i=1}^{5} a(i) = \\frac{5}{9} + \\frac{1}{3} + 0 + \\frac{2}{3} + \\frac{5}{9} = \\frac{5}{9} + \\frac{3}{9} + \\frac{6}{9} + \\frac{5}{9} = \\frac{19}{9} $$\n$$ P_o = \\frac{1}{5} \\left(\\frac{19}{9}\\right) = \\frac{19}{45} $$\n\n**步骤C：计算期望一致性 ($P_e$)**\n首先，我们计算边际比例：\n- 预测地图：$\\sum_{i=1}^5 p(i) = 1$。所以，$P_{\\text{pred, urban}} = 1/5$ 且 $P_{\\text{pred, non-urban}} = 4/5$。\n- 参考地图：$\\sum_{i=1}^5 u(i) = \\frac{4}{9} + \\frac{2}{3} + 1 + \\frac{2}{3} + \\frac{4}{9} = \\frac{4}{9} + \\frac{6}{9} + \\frac{9}{9} + \\frac{6}{9} + \\frac{4}{9} = \\frac{29}{9}$。\n  所以，$P_{\\text{ref, urban}} = \\frac{1}{5} \\left(\\frac{29}{9}\\right) = \\frac{29}{45}$。\n  并且 $P_{\\text{ref, non-urban}} = 1 - \\frac{29}{45} = \\frac{16}{45}$。\n\n现在，我们计算 $P_e$：\n$$ P_e = \\left(\\frac{1}{5}\\right)\\left(\\frac{29}{45}\\right) + \\left(\\frac{4}{5}\\right)\\left(\\frac{16}{45}\\right) = \\frac{29}{225} + \\frac{64}{225} = \\frac{93}{225} $$\n通过将分子和分母除以 $3$ 来简化此分数：\n$$ P_e = \\frac{31}{75} $$\n\n**步骤D：计算模糊卡帕系数 ($\\kappa_f$)**\n$$ \\kappa_f = \\frac{P_o - P_e}{1 - P_e} $$\n我们对 $P_o$ 和 $P_e$ 使用公分母 $225$。$P_o = \\frac{19}{45} = \\frac{95}{225}$ 且 $P_e = \\frac{93}{225}$。\n- 分子：$P_o - P_e = \\frac{95}{225} - \\frac{93}{225} = \\frac{2}{225}$\n- 分母：$1 - P_e = 1 - \\frac{93}{225} = \\frac{225 - 93}{225} = \\frac{132}{225}$\n\n最后，模糊卡帕系数是：\n$$ \\kappa_f = \\frac{2/225}{132/225} = \\frac{2}{132} = \\frac{1}{66} $$",
            "answer": "$$ \\boxed{\\frac{1}{66}} $$"
        }
    ]
}