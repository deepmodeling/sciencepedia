{
    "hands_on_practices": [
        {
            "introduction": "在光能利用率（LUE）模型中，冠层吸收的光合有效辐射（APAR）是驱动光合作用的直接能量来源。本练习旨在巩固 APAR、总光合有效辐射（PAR）和其吸收分数（$f_{\\text{APAR}}$）之间的基本关系 。通过一个假设情景，您将练习如何计算 APAR 的不确定性，特别是当输入变量（PAR 和 $f_{\\text{APAR}}$）的误差存在相关性时——这在遥感反演中是常见情况。",
            "id": "3829405",
            "problem": "基于卫星的冠层碳吸收评估需要根据明确的物理定义和假设，从遥感量计算吸收的光合有效辐射（APAR），然后在计算中传播不确定性，包括相关误差。从适用于冠层顶部的光谱定义开始：在$400$–$700 \\ \\mathrm{nm}$区间内的光合有效辐射（PAR）定义为向下光谱辐照度的积分，$$\\mathrm{PAR} \\equiv \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda,$$ 而APAR定义为在同一区间内吸收的向下光谱辐照度的积分，$$\\mathrm{APAR} \\equiv \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} a(\\lambda) \\, E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda,$$ 其中 $E_{\\downarrow}(\\lambda)$ 是冠层顶部的向下光谱辐照度，$a(\\lambda)$ 是冠层光谱吸收率。吸收的光合有效辐射分数（$f_{\\text{APAR}}$）定义为 $$f_{\\text{APAR}} \\equiv \\frac{\\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} a(\\lambda) \\, E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}{\\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}.$$ 假设在PAR光谱区间内，冠层吸收率实际上与波长无关，因此在$400$–$700 \\ \\mathrm{nm}$范围内 $a(\\lambda) \\approx a_{0}$，并且对于感兴趣的时间窗口，$E_{\\downarrow}(\\lambda)$ 的光谱形状可以由一个标量PAR充分表示。在这些假设下，推导$\\mathrm{APAR}$、$\\mathrm{PAR}$和$f_{\\text{APAR}}$之间的乘积关系，并用它来计算均匀冠层上以下瞬时反演的$\\mathrm{APAR}$：\n\n- $\\mathrm{PAR} = 480 \\ \\mathrm{W \\, m^{-2}}$，其单标准差不确定度为 $u(\\mathrm{PAR}) = 36 \\ \\mathrm{W \\, m^{-2}}$，\n- $f_{\\text{APAR}} = 0.68$，其单标准差不确定度为 $u(f_{\\text{APAR}}) = 0.05$。\n\n由于共同的大气状态（例如，气溶胶光学厚度）同时影响$\\mathrm{PAR}$估算和基于反射率的$f_{\\text{APAR}}$反演，反演误差是部分相关的。用$\\mathrm{PAR}$和$f_{\\text{APAR}}$误差之间的相关系数 $\\rho = 0.25$ 来表示这种相关性。\n\n使用基于微分分析的一阶不确定性传播方法，并包含相关项，计算推导出的$\\mathrm{APAR}$的组合单标准差不确定度$u(\\mathrm{APAR})$。将最终的$u(\\mathrm{APAR})$以$\\mathrm{W \\, m^{-2}}$为单位表示，并将您的答案四舍五入到四位有效数字。",
            "solution": "问题陈述被验证为具有科学依据、提法恰当且客观。它提供了一套完整的定义、假设和数据，以推导出唯一且有意义的解。在植被遥感的背景下，这些物理量及其不确定性是现实的。该任务涉及物理定义和统计不确定性传播的标准应用。\n\n第一步是推导吸收的光合有效辐射（$\\mathrm{APAR}$）、光合有效辐射（$\\mathrm{PAR}$）和吸收的PAR分数（$f_{\\text{APAR}}$）之间的简化乘积关系。\n\n$f_{\\text{APAR}}$的定义为：\n$$f_{\\text{APAR}} \\equiv \\frac{\\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} a(\\lambda) \\, E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}{\\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}$$\n其中 $a(\\lambda)$ 是冠层光谱吸收率，$E_{\\downarrow}(\\lambda)$ 是向下光谱辐照度。\n\n问题陈述假设冠层吸收率在PAR光谱区间（$400$–$700 \\ \\mathrm{nm}$）内实际上与波长无关，因此 $a(\\lambda) \\approx a_{0}$，其中 $a_{0}$ 是一个常数。应用这个假设，$a_{0}$ 可以从分子中的积分中提出来：\n$$f_{\\text{APAR}} \\approx \\frac{a_{0} \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}{\\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda}$$\n分子和分母中的积分项相同且非零，因此它们可以消掉，得到：\n$$f_{\\text{APAR}} \\approx a_{0}$$\n\n接下来，我们研究$\\mathrm{APAR}$的定义：\n$$\\mathrm{APAR} \\equiv \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} a(\\lambda) \\, E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda$$\n应用相同的假设（$a(\\lambda) \\approx a_{0}$）：\n$$\\mathrm{APAR} \\approx a_{0} \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda$$\n根据定义，此表达式中的积分是$\\mathrm{PAR}$：\n$$\\mathrm{PAR} \\equiv \\int_{400 \\ \\mathrm{nm}}^{700 \\ \\mathrm{nm}} E_{\\downarrow}(\\lambda) \\, \\mathrm{d}\\lambda$$\n将此定义代入$\\mathrm{APAR}$的表达式中，得到：\n$$\\mathrm{APAR} \\approx a_{0} \\cdot \\mathrm{PAR}$$\n最后，将 $f_{\\text{APAR}} \\approx a_{0}$ 代入上述关系式，我们得到了所需的乘积形式，根据问题的指示，我们将在后续计算中将其视为等式：\n$$\\mathrm{APAR} = f_{\\text{APAR}} \\cdot \\mathrm{PAR}$$\n\n问题要求基于$f_{\\text{APAR}}$和$\\mathrm{PAR}$的不确定性及其相关性，计算$\\mathrm{APAR}$的不确定度，记为$u(\\mathrm{APAR})$。我们使用一阶泰勒级数展开进行不确定性传播。对于一个具有相关输入的函数 $Y = F(X_1, X_2)$，组合标准不确定度的平方，$u^2(Y)$，由下式给出：\n$$u^2(Y) \\approx \\left(\\frac{\\partial F}{\\partial X_1}\\right)^2 u^2(X_1) + \\left(\\frac{\\partial F}{\\partial X_2}\\right)^2 u^2(X_2) + 2 \\left(\\frac{\\partial F}{\\partial X_1}\\right) \\left(\\frac{\\partial F}{\\partial X_2}\\right) u(X_1, X_2)$$\n其中 $u(X_1, X_2)$ 是 $X_1$ 和 $X_2$ 之间的协方差。协方差通过 $u(X_1, X_2) = \\rho(X_1, X_2) u(X_1) u(X_2)$ 与相关系数 $\\rho(X_1, X_2)$ 相关联。\n\n在我们的例子中，函数是 $\\mathrm{APAR} = f_{\\text{APAR}} \\cdot \\mathrm{PAR}$。令 $A = \\mathrm{APAR}$，$f = f_{\\text{APAR}}$，$P = \\mathrm{PAR}$。函数为 $A(f, P) = f \\cdot P$。\n偏导数是：\n$$\\frac{\\partial A}{\\partial P} = f$$\n$$\\frac{\\partial A}{\\partial f} = P$$\n将这些偏导数代入通用不确定性公式，得到我们问题的特定公式：\n$$u^2(\\mathrm{APAR}) \\approx (f)^2 u^2(\\mathrm{PAR}) + (P)^2 u^2(f_{\\text{APAR}}) + 2 (f)(P) \\rho \\, u(\\mathrm{PAR}) u(f_{\\text{APAR}})$$\n其中 $\\rho$ 是$\\mathrm{PAR}$和$f_{\\text{APAR}}$误差之间的相关系数。\n\n我们给出了以下数值：\n$\\mathrm{PAR} = 480 \\ \\mathrm{W \\, m^{-2}}$\n$u(\\mathrm{PAR}) = 36 \\ \\mathrm{W \\, m^{-2}}$\n$f_{\\text{APAR}} = 0.68$\n$u(f_{\\text{APAR}}) = 0.05$\n$\\rho = 0.25$\n\n我们现在将这些值代入不确定性传播方程。\n第一项（来自$\\mathrm{PAR}$不确定性的贡献）是：\n$$(f_{\\text{APAR}})^2 u^2(\\mathrm{PAR}) = (0.68)^2 (36)^2 = (0.4624)(1296) = 599.2704$$\n第二项（来自$f_{\\text{APAR}}$不确定性的贡献）是：\n$$(\\mathrm{PAR})^2 u^2(f_{\\text{APAR}}) = (480)^2 (0.05)^2 = (230400)(0.0025) = 576$$\n第三项（来自误差相关的贡献）是：\n$$2 (f_{\\text{APAR}})(\\mathrm{PAR}) \\rho \\, u(\\mathrm{PAR}) u(f_{\\text{APAR}}) = 2 (0.68)(480)(0.25)(36)(0.05)$$\n$$= 2 \\cdot 0.68 \\cdot 480 \\cdot 0.25 \\cdot 36 \\cdot 0.05 = 293.76$$\n组合方差是这三项之和：\n$$u^2(\\mathrm{APAR}) \\approx 599.2704 + 576 + 293.76 = 1469.0304$$\n组合单标准差不确定度，$u(\\mathrm{APAR})$，是方差的平方根：\n$$u(\\mathrm{APAR}) = \\sqrt{1469.0304} \\approx 38.3279326 \\ \\mathrm{W \\, m^{-2}}$$\n问题要求最终答案四舍五入到四位有效数字。\n$$u(\\mathrm{APAR}) \\approx 38.33 \\ \\mathrm{W \\, m^{-2}}$$\n$\\mathrm{APAR}$的名义值将是 $\\mathrm{APAR} = 480 \\times 0.68 = 326.4 \\ \\mathrm{W \\, m^{-2}}$。因此，最终结果是 $\\mathrm{APAR} = 326.4 \\pm 38.33 \\ \\mathrm{W \\, m^{-2}}$。问题只要求不确定度 $u(\\mathrm{APAR})$。",
            "answer": "$$\\boxed{38.33}$$"
        },
        {
            "introduction": "GPP 的遥感建模准确性不仅取决于模型结构，还严重依赖于输入数据的质量。本练习将引导您构建一个完整的误差预算，追踪大气校正后残留的气溶胶和云污染如何通过反射率、植被指数（NDVI）、$f_{\\text{APAR}}$，最终影响到 GPP 的估算 。掌握这种基于一阶线性化的误差传播分析，对于诊断模型偏差来源和理解遥感产品的不确定性至关重要。",
            "id": "3829413",
            "problem": "考虑一个植被覆盖的地表，由一个多光谱卫星传感器观测，该传感器提供红光波段和近红外波段的地表反射率时间序列。设基线红光反射率为 $R_{0} = 0.06$，基线近红外反射率为 $N_{0} = 0.48$，代表茂密健康的植被冠层。经过标准筛选和大气校正后，残留的气溶胶和薄云污染仍然存在，可以建模为地表反射率的微小附加偏差。在特定的一天，假设存在以下残留偏差：\n- 气溶胶残留：$\\Delta R_{\\mathrm{a}} = +0.012$, $\\Delta N_{\\mathrm{a}} = +0.007$。\n- 云残留：$\\Delta R_{\\mathrm{c}} = +0.020$, $\\Delta N_{\\mathrm{c}} = +0.015$。\n\n归一化植被指数 (NDVI) 定义为\n$$\\mathrm{NDVI} = \\frac{N - R}{N + R},$$\n其中 $R$ 是红光反射率，$N$ 是近红外反射率。吸收光合有效辐射分数 ($f_{\\text{APAR}}$) 通过一个线性的、由经验支持的映射与 NDVI 相关，\n$$f_{\\text{APAR}} = \\alpha\\,\\mathrm{NDVI} + \\beta,$$\n其中 $\\alpha = 1.1$ 且 $\\beta = 0.05$。总初级生产力 (GPP) 使用光能利用率范式进行估算，\n$$\\mathrm{GPP} = \\epsilon \\, f_{\\text{APAR}} \\, Q,$$\n其中 $\\epsilon$ 是光能利用率（单位为克碳/摩尔光子），$Q$ 是入射光合有效辐射 (PAR)（单位为摩尔光子/平方米/天）。在这一天，取 $\\epsilon = 0.30$ 且 $Q = 35$。\n\n假设残留偏差足够小，可以进行一阶线性化。从给定的定义出发，并使用误差传播的基本原理，分别推导与气溶胶残留和云残留相关的一阶 $\\mathrm{NDVI}$ 偏差，将这些偏差传播到 $f_{\\text{APAR}}$ 的偏差，并进一步传播到 $\\mathrm{GPP}$ 的偏差。然后，通过将气溶胶和云的贡献相加，构建组合误差预算，以获得当天 $\\mathrm{GPP}$ 的总偏差。\n\n将最终答案表示为 $\\mathrm{GPP}$ 的总偏差，单位为克碳/平方米/天 ($\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$)。将最终数值答案四舍五入到四位有效数字。",
            "solution": "本问题要求基于一阶线性化（泰勒级数一阶展开）来估算总初级生产力（GPP）的总偏差，该偏差源于红光（R）和近红外（N）反射率中的残留偏差。误差的传播遵循一个依赖链：反射率的偏差（$\\Delta R, \\Delta N$）导致归一化植被指数（$\\Delta\\mathrm{NDVI}$）的偏差，接着引起吸收光合有效辐射分数（$\\Delta f_{\\text{APAR}}$）的偏差，并最终导致GPP（$\\Delta\\mathrm{GPP}$）的偏差。\n\n首先，我们推导$\\mathrm{NDVI}$关于$N$和$R$的一阶偏差的通用公式。对于函数 $\\mathrm{NDVI}(N, R) = \\frac{N - R}{N + R}$，其全微分为：\n$$ \\Delta\\mathrm{NDVI} \\approx \\frac{\\partial \\mathrm{NDVI}}{\\partial N} \\Delta N + \\frac{\\partial \\mathrm{NDVI}}{\\partial R} \\Delta R $$\n我们计算在基线值 $R_0$ 和 $N_0$ 处的偏导数：\n$$ \\frac{\\partial \\mathrm{NDVI}}{\\partial N} = \\frac{(1)(N+R) - (N-R)(1)}{(N+R)^2} = \\frac{2R}{(N+R)^2} $$\n$$ \\frac{\\partial \\mathrm{NDVI}}{\\partial R} = \\frac{(-1)(N+R) - (N-R)(1)}{(N+R)^2} = \\frac{-2N}{(N+R)^2} $$\n因此，$\\mathrm{NDVI}$的偏差可以表示为：\n$$ \\Delta\\mathrm{NDVI} \\approx \\frac{2R_0}{(N_0+R_0)^2} \\Delta N - \\frac{2N_0}{(N_0+R_0)^2} \\Delta R = \\frac{2}{(N_0+R_0)^2}(R_0 \\Delta N - N_0 \\Delta R) $$\n\n接下来，我们将此偏差传播到 $f_{\\text{APAR}}$。由于关系是线性的 $f_{\\text{APAR}} = \\alpha\\,\\mathrm{NDVI} + \\beta$，其偏差为：\n$$ \\Delta f_{\\text{APAR}} = \\alpha \\, \\Delta\\mathrm{NDVI} $$\n\n最后，我们将 $\\Delta f_{\\text{APAR}}$ 传播到 $\\mathrm{GPP}$。关系 $\\mathrm{GPP} = \\epsilon \\, f_{\\text{APAR}} \\, Q$ 也是线性的（$\\epsilon$ 和 $Q$ 为常数），因此其偏差为：\n$$ \\Delta\\mathrm{GPP} = \\epsilon \\, Q \\, \\Delta f_{\\text{APAR}} $$\n\n将以上三步结合，我们得到 $\\mathrm{GPP}$ 偏差的最终表达式：\n$$ \\Delta\\mathrm{GPP} = \\epsilon Q \\alpha (\\Delta\\mathrm{NDVI}) = \\frac{2 \\epsilon Q \\alpha}{(N_0+R_0)^2}(R_0 \\Delta N - N_0 \\Delta R) $$\n\n由于一阶近似是线性的，总偏差是来自各个独立来源（气溶胶和云）偏差的总和。因此，我们首先计算反射率的总偏差：\n$$ \\Delta R_{\\mathrm{total}} = \\Delta R_{\\mathrm{a}} + \\Delta R_{\\mathrm{c}} = 0.012 + 0.020 = 0.032 $$\n$$ \\Delta N_{\\mathrm{total}} = \\Delta N_{\\mathrm{a}} + \\Delta N_{\\mathrm{c}} = 0.007 + 0.015 = 0.022 $$\n\n现在，我们代入所有给定的数值进行计算：\n- 基线反射率: $R_0 = 0.06$, $N_0 = 0.48$\n- 模型参数: $\\epsilon = 0.30$, $Q = 35$, $\\alpha = 1.1$\n\n计算表达式中的各个部分：\n- 分母项: $(N_0+R_0)^2 = (0.48 + 0.06)^2 = (0.54)^2 = 0.2916$\n- 分子中的常数因子: $2 \\epsilon Q \\alpha = 2 \\times 0.30 \\times 35 \\times 1.1 = 23.1$\n- 括号内的反射率项: $R_0 \\Delta N_{\\mathrm{total}} - N_0 \\Delta R_{\\mathrm{total}} = (0.06)(0.022) - (0.48)(0.032) = 0.00132 - 0.01536 = -0.01404$\n\n最后，将这些部分组合起来计算 $\\mathrm{GPP}$ 的总偏差：\n$$ \\Delta\\mathrm{GPP}_{\\mathrm{total}} = \\frac{23.1}{0.2916} \\times (-0.01404) \\approx 79.2181 \\times (-0.01404) \\approx -1.11222... $$\n\n根据题目要求，将最终数值答案四舍五入到四位有效数字：\n$$ \\Delta\\mathrm{GPP}_{\\mathrm{total}} \\approx -1.112 $$\n单位为克碳/平方米/天 ($\\mathrm{g}\\,\\mathrm{C}\\,\\mathrm{m}^{-2}\\,\\mathrm{d}^{-1}$)。",
            "answer": "$$\\boxed{-1.112}$$"
        },
        {
            "introduction": "GPP 的遥感建模并非只有一种方法，而是涵盖了从经验统计模型到半机理模型的多种范式。本综合练习模拟了一个真实的研究场景，您将实现并比较三种有代表性的 GPP 模型：经验机器学习模型、基于 LUE 的机理模型和基于太阳诱导叶绿素荧光（SIF）的代理模型 。通过实施交叉验证和计算关键性能指标，您将学会如何严格评估不同模型的预测能力及其在特定环境条件下的系统性偏差。",
            "id": "3829406",
            "problem": "您需要实现并比较三种遥感模型，使用固定的数据集和k-折交叉验证来估算总初级生产力（GPP）。此比较必须基于第一性原理，并由陆地光合作用和遥感领域公认的定义来证明其合理性。\n\n基本原理：\n- 总初级生产力（GPP）是植物通过光合作用固定碳的速率，通常以微摩尔二氧化碳每平方米每秒（$\\mu\\text{mol}\\ \\text{CO}_2\\ \\text{m}^{-2}\\ \\text{s}^{-1}$）表示。\n- 光合有效辐射（PAR）是指在 $400$–$700$ nm 波段可用于光合作用的入射光子通量，单位为微摩尔光子每平方米每秒（$\\mu\\text{mol}\\ \\text{photons}\\ \\text{m}^{-2}\\ \\text{s}^{-1}$）。\n- 光能利用率（LUE）概念模型指出：$$\\text{GPP} = \\text{APAR} \\cdot \\varepsilon,$$ 其中 $\\text{APAR} = \\text{PAR} \\cdot f_{\\text{APAR}}$，$f_{\\text{APAR}}$ 是冠层吸收的PAR的分数。效率 $\\varepsilon$ 受环境标量因子调节，特别是温度和饱和水汽压差。\n- 太阳诱导叶绿素荧光（SIF）是叶绿素重新发射的一小部分吸收能量，与吸收的光成正比，并与光合电子传递相关；在相似的胁迫条件下，经常观察到SIF和GPP之间存在线性关系。\n\n需要实现模型：\n1.  经验性机器学习（ML）线性回归：一个多元线性模型，将遥感特征和气象数据映射到GPP，\n    $$\\widehat{\\text{GPP}}_{\\text{ML}} = w_0 + w_1 \\cdot \\text{PAR} + w_2 \\cdot \\text{NDVI} + w_3 \\cdot T + w_4 \\cdot \\text{VPD} + w_5 \\cdot \\text{SIF},$$\n    其中归一化植被指数（NDVI）是无单位的，$T$ 是空气温度，单位为摄氏度（°C），饱和水汽压差（VPD）单位为千帕（kPa），SIF单位为毫瓦每平方米每纳米每球面度（$\\text{mW}\\ \\text{m}^{-2}\\ \\text{nm}^{-1}\\ \\text{sr}^{-1}$）。通过在训练折上使用普通最小二乘法来估计系数 $\\{w_i\\}$。\n2.  机理LUE模型：从以下公式开始\n    $$\\widehat{\\text{GPP}}_{\\text{LUE}} = \\varepsilon_{\\max} \\cdot \\text{PAR} \\cdot f_{\\text{APAR}}(\\text{NDVI}) \\cdot s_T(T) \\cdot s_{\\text{VPD}}(\\text{VPD}),$$\n    其中 $f_{\\text{APAR}}(\\text{NDVI})$ 近似为一个仿射函数 $f_{\\text{APAR}}(\\text{NDVI}) \\approx \\alpha \\cdot \\text{NDVI} + \\beta$，胁迫标量因子为\n    $$s_T(T) = \\exp\\left(-\\frac{1}{2}\\left(\\frac{T - T_{\\text{opt}}}{\\sigma}\\right)^2\\right), \\quad s_{\\text{VPD}}(\\text{VPD}) = \\frac{1}{1 + \\text{VPD}/VPD_0}.$$\n    使用 $T_{\\text{opt}} = 25\\ \\text{°C}$，$\\sigma = 10\\ \\text{°C}$ 和 $VPD_0 = 1.5\\ \\text{kPa}$ 作为固定常数。通过最小二乘法校准线性参数，使得模型在其拟合系数上保持线性。\n3.  基于SIF的模型：采用SIF和GPP之间的线性关系，\n    $$\\widehat{\\text{GPP}}_{\\text{SIF}} = \\gamma_0 + \\gamma_1 \\cdot \\text{SIF},$$\n    通过在训练折上使用普通最小二乘法来估计。\n\n交叉验证：\n- 使用 $K=4$ 折。在每一折中，在 $K-1$ 个分区上训练模型，并在留出的分区上进行评估。汇总所有留出分区的预测值和观测值，以计算性能指标。\n\n指标：\n- 对每个模型的聚合交叉验证预测结果计算三个指标：\n  1.  均方根误差（RMSE），单位为 $\\mu\\text{mol}\\ \\text{CO}_2\\ \\text{m}^{-2}\\ \\text{s}^{-1}$，\n      $$\\text{RMSE} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^N\\left(\\widehat{y}_i - y_i\\right)^2}.$$\n  2.  平均偏差（平均有符号误差），单位为 $\\mu\\text{mol}\\ \\text{CO}_2\\ \\text{m}^{-2}\\ \\text{s}^{-1}$，\n      $$\\text{Bias} = \\frac{1}{N}\\sum_{i=1}^N\\left(\\widehat{y}_i - y_i\\right).$$\n  3.  残差 $r_i = \\widehat{y}_i - y_i$ 与VPD之间的皮尔逊相关性，\n      $$\\rho_{r,\\text{VPD}} = \\frac{\\operatorname{Cov}(r,\\text{VPD})}{\\sigma_r \\sigma_{\\text{VPD}}},$$\n      此值为无量纲。如果任一标准差为零，则将相关性设置为 $0$。\n\n测试套件（观测数据集）：\n- 提供以下 $N=12$ 个观测值，每个观测值由 $(\\text{PAR}, \\text{NDVI}, T, \\text{VPD}, \\text{SIF}, \\text{GPP})$ 组成，单位如上所述：\n  - $(1500,\\ 0.85,\\ 24,\\ 1.0,\\ 2.2,\\ 30.0)$\n  - $(1300,\\ 0.80,\\ 26,\\ 1.2,\\ 2.0,\\ 27.5)$\n  - $(500,\\ 0.60,\\ 15,\\ 0.8,\\ 0.9,\\ 12.0)$\n  - $(1000,\\ 0.40,\\ 35,\\ 2.5,\\ 1.1,\\ 10.5)$\n  - $(200,\\ 0.50,\\ 10,\\ 0.6,\\ 0.3,\\ 4.5)$\n  - $(800,\\ 0.70,\\ 25,\\ 0.7,\\ 1.5,\\ 20.0)$\n  - $(1200,\\ 0.75,\\ 30,\\ 1.8,\\ 1.8,\\ 22.0)$\n  - $(300,\\ 0.35,\\ 5,\\ 0.9,\\ 0.2,\\ 3.5)$\n  - $(50,\\ 0.30,\\ 20,\\ 3.0,\\ 0.05,\\ 1.0)$\n  - $(1600,\\ 0.90,\\ 27,\\ 1.0,\\ 2.6,\\ 32.0)$\n  - $(900,\\ 0.65,\\ 22,\\ 1.4,\\ 1.2,\\ 18.0)$\n  - $(1400,\\ 0.82,\\ 18,\\ 0.8,\\ 2.1,\\ 26.0)$\n\n覆盖性设计：\n- 数据集包含多种条件以探究不同方面：高和低的 $\\text{PAR}$，高和低的 $\\text{NDVI}$，低于和高于 $T_{\\text{opt}}$ 的温度，高和低的 $\\text{VPD}$，以及SIF值范围从接近零到相对较高。边界情况包括极低的 $\\text{PAR}$ 和高的 $\\text{VPD}$，以测试模型在胁迫下的行为。\n\n算法要求：\n- 通过矩阵正规方程实现普通最小二乘法；使用一个小的岭回归项（$\\lambda = 10^{-8}$）进行正则化，以确保数值稳定性。\n- 对于机理LUE模型，保持 $T_{\\text{opt}}$, $\\sigma$, 和 $VPD_0$ 固定，并且只拟合与仿射函数 $f_{\\text{APAR}}$ 假设一致的线性系数。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含九个用逗号分隔的浮点数，并用方括号括起来，顺序如下：\n  $$[\\text{RMSE}_{\\text{ML}},\\ \\text{Bias}_{\\text{ML}},\\ \\rho_{r,\\text{VPD},\\text{ML}},\\ \\text{RMSE}_{\\text{LUE}},\\ \\text{Bias}_{\\text{LUE}},\\ \\rho_{r,\\text{VPD},\\text{LUE}},\\ \\text{RMSE}_{\\text{SIF}},\\ \\text{Bias}_{\\text{SIF}},\\ \\rho_{r,\\text{VPD},\\text{SIF}}].$$\n- RMSE和Bias必须以 $\\mu\\text{mol}\\ \\text{CO}_2\\ \\text{m}^{-2}\\ \\text{s}^{-1}$ 为单位表示，相关性是无量纲的。不应打印任何额外文本。",
            "solution": "问题陈述已经过验证，被认为是合理、自洽且有科学依据的。它在环境建模领域提出了一个明确定义的任务，遵循遥感和陆地光合作用的既定原则。数据集、模型结构和评估协议都以足够的精度进行了规定，以允许一个唯一且可验证的解。\n\n目标是实现并比较三种不同的模型来估算总初级生产力（GPP），这些模型来自给定的遥感和气象变量数据集。比较使用 $K$-折交叉验证框架进行，以确保对每个模型在未见数据上的预测性能进行稳健的评估。这些模型代表了一系列方法：纯经验统计模型、基于生物物理原理的半机理模型，以及利用一种新型代理变量（太阳诱导荧光，SIF）的简单经验模型。\n\n解决方案的核心在于应用线性回归来拟合每个模型的参数。参数是通过最小化模型预测值与训练数据中观测到的GPP值之间的平方差之和来确定的。这是通过普通最小二乘法（OLS）实现的，具体来说是通过正规方程组。对于形如 $\\mathbf{y} = \\mathbf{X}\\mathbf{w}$ 的线性模型，其中 $\\mathbf{y}$ 是观测值向量，$\\mathbf{X}$ 是预测变量的设计矩阵，$\\mathbf{w}$ 是模型系数向量，$\\mathbf{w}$ 的OLS解由以下公式给出：\n$$ \\mathbf{w} = (\\mathbf{X}^T \\mathbf{X})^{-1} \\mathbf{X}^T \\mathbf{y} $$\n为了增强数值稳定性，特别是在处理小数据集或预测变量之间存在多重共线性时，会添加一个小的岭正则化项 $\\lambda$。这将解修改为：\n$$ \\mathbf{w} = (\\mathbf{X}^T \\mathbf{X} + \\lambda \\mathbf{I})^{-1} \\mathbf{X}^T \\mathbf{y} $$\n其中 $\\mathbf{I}$ 是单位矩阵，$\\lambda$ 设置为一个很小的值 $10^{-8}$。\n\n实现过程遵循以下步骤：\n\n1.  **交叉验证设置**：将包含 $N=12$ 个观测值的数据集划分为 $K=4$ 折，每折包含 $3$ 个观测值。该过程迭代 $4$ 次。在每次迭代中，一折作为测试集，其余三折（$9$ 个观测值）合并形成训练集。这确保了每个数据点都只被用作一次测试。将所有12个点的预测值聚合起来，为每个模型形成一个完整的样本外预测集。\n\n2.  **模型实现与训练**：在每次交叉验证迭代中，三个模型都在训练数据上进行训练。关键是为每个模型构建合适的设计矩阵 $\\mathbf{X}$。假设训练数据包含 $m$ 个观测值。\n\n    *   **模型1：经验性ML线性回归**：\n        该模型是一个直接的多元线性回归。预测变量是 $\\text{PAR}$、$\\text{NDVI}$、$T$、$\\text{VPD}$ 和 $\\text{SIF}$，外加一个截距项。设计矩阵 $\\mathbf{X}_{\\text{ML}}$ 是一个 $m \\times 6$ 的矩阵：\n        $$ \\mathbf{X}_{\\text{ML}} = \\begin{bmatrix} 1  \\text{PAR}_1  \\text{NDVI}_1  T_1  \\text{VPD}_1  \\text{SIF}_1 \\\\ 1  \\text{PAR}_2  \\text{NDVI}_2  T_2  \\text{VPD}_2  \\text{SIF}_2 \\\\ \\vdots  \\vdots  \\vdots  \\vdots  \\vdots  \\vdots \\\\ 1  \\text{PAR}_m  \\text{NDVI}_m  T_m  \\text{VPD}_m  \\text{SIF}_m \\end{bmatrix} $$\n        待求解的系数向量是 $\\mathbf{w}_{\\text{ML}} = [w_0, w_1, w_2, w_3, w_4, w_5]^T$。\n\n    *   **模型2：机理LUE模型**：\n        该模型 $\\widehat{\\text{GPP}}_{\\text{LUE}} = \\varepsilon_{\\max} \\cdot \\text{PAR} \\cdot (\\alpha \\cdot \\text{NDVI} + \\beta) \\cdot s_T(T) \\cdot s_{\\text{VPD}}(\\text{VPD})$，必须对其可拟合参数进行线性化。通过定义新的复合预测变量，我们可以将其重新表述为线性模型。首先计算固定的标量函数：\n        $$ s_T(T) = \\exp\\left(-\\frac{1}{2}\\left(\\frac{T - 25}{10}\\right)^2\\right), \\quad s_{\\text{VPD}}(\\text{VPD}) = \\frac{1}{1 + \\text{VPD}/1.5} $$\n        模型方程重新整理为：\n        $$ \\widehat{\\text{GPP}}_{\\text{LUE}} = (\\varepsilon_{\\max}\\alpha) \\cdot [\\text{PAR} \\cdot \\text{NDVI} \\cdot s_T(T) \\cdot s_{\\text{VPD}}(\\text{VPD})] + (\\varepsilon_{\\max}\\beta) \\cdot [\\text{PAR} \\cdot s_T(T) \\cdot s_{\\text{VPD}}(\\text{VPD})] $$\n        这是一个无截距的线性模型 $\\widehat{y} = c_1 X_1 + c_2 X_2$，其中系数为 $c_1 = \\varepsilon_{\\max}\\alpha$ 和 $c_2 = \\varepsilon_{\\max}\\beta$，预测变量为 $X_1 = \\text{PAR} \\cdot \\text{NDVI} \\cdot s_T \\cdot s_{\\text{VPD}}$ 和 $X_2 = \\text{PAR} \\cdot s_T \\cdot s_{\\text{VPD}}$。设计矩阵 $\\mathbf{X}_{\\text{LUE}}$ 是一个 $m \\times 2$ 的矩阵：\n        $$ \\mathbf{X}_{\\text{LUE}} = \\begin{bmatrix} X_{1,1}  X_{2,1} \\\\ X_{1,2}  X_{2,2} \\\\ \\vdots  \\vdots \\\\ X_{1,m}  X_{2,m} \\end{bmatrix} $$\n        待求解的系数向量是 $\\mathbf{w}_{\\text{LUE}} = [c_1, c_2]^T$。\n\n    *   **模型3：基于SIF的模型**：\n        这是一个带截距的简单线性回归。预测变量是 $\\text{SIF}$。设计矩阵 $\\mathbf{X}_{\\text{SIF}}$ 是一个 $m \\times 2$ 的矩阵：\n        $$ \\mathbf{X}_{\\text{SIF}} = \\begin{bmatrix} 1  \\text{SIF}_1 \\\\ 1  \\text{SIF}_2 \\\\ \\vdots  \\vdots \\\\ 1  \\text{SIF}_m \\end{bmatrix} $$\n        系数向量是 $\\mathbf{w}_{\\text{SIF}} = [\\gamma_0, \\gamma_1]^T$。\n\n3.  **预测与评估**：对于每一折，在从训练集估计出每个模型的系数后，使用这些系数为留出的测试集生成GPP预测。这些预测值被存储起来。在处理完所有 $K$ 折后，我们为每个模型都得到了一套完整的包含 $N=12$ 个样本外预测的数据集，可以与真实的观测GPP值进行比较。\n\n4.  **指标计算**：基于聚合的预测值 $(\\widehat{y}_i)$ 和观测值 $(y_i)$ 为每个模型计算三个性能指标：\n    *   **均方根误差（RMSE）**：$\\sqrt{\\frac{1}{N}\\sum(\\widehat{y}_i - y_i)^2}$。这衡量了预测误差的典型量级，单位为GPP单位。\n    *   **平均偏差**：$\\frac{1}{N}\\sum(\\widehat{y}_i - y_i)$。这表明模型是否存在系统性的高估或低估倾向。\n    *   **残差-VPD相关性（$\\rho_{r,\\text{VPD}}$）**：这是模型残差 $r_i = \\widehat{y}_i - y_i$ 与饱和水汽压差（VPD）之间的皮尔逊相关性。非零相关性表明模型的误差与水分胁迫系统相关，这意味着对VPD对光合作用影响的表示不完整或不正确。这是一个强大的模型评估诊断工具。皮尔逊相关性计算为 $\\rho = \\frac{\\operatorname{Cov}(r, \\text{VPD})}{\\sigma_r \\sigma_{\\text{VPD}}}$。根据问题规定，如果任一标准差 $\\sigma_r$ 或 $\\sigma_{\\text{VPD}}$ 为零，则相关性取为零。\n\n通过遵循这一严谨的程序，我们获得了对这三种建模范式的公平且有原则的比较。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and compares three GPP models using k-fold cross-validation.\n    \"\"\"\n    # Observational dataset (PAR, NDVI, T, VPD, SIF, GPP)\n    data = np.array([\n        [1500, 0.85, 24, 1.0, 2.2, 30.0],\n        [1300, 0.80, 26, 1.2, 2.0, 27.5],\n        [500, 0.60, 15, 0.8, 0.9, 12.0],\n        [1000, 0.40, 35, 2.5, 1.1, 10.5],\n        [200, 0.50, 10, 0.6, 0.3, 4.5],\n        [800, 0.70, 25, 0.7, 1.5, 20.0],\n        [1200, 0.75, 30, 1.8, 1.8, 22.0],\n        [300, 0.35, 5, 0.9, 0.2, 3.5],\n        [50, 0.30, 20, 3.0, 0.05, 1.0],\n        [1600, 0.90, 27, 1.0, 2.6, 32.0],\n        [900, 0.65, 22, 1.4, 1.2, 18.0],\n        [1400, 0.82, 18, 0.8, 2.1, 26.0]\n    ])\n\n    # Parameters\n    N = data.shape[0]\n    K = 4\n    fold_size = N // K\n    lambda_reg = 1e-8\n    \n    # LUE model constants\n    T_opt = 25.0\n    sigma = 10.0\n    VPD0 = 1.5\n\n    # Arrays to store out-of-sample predictions\n    y_true = data[:, 5]\n    y_pred_ml = np.zeros(N)\n    y_pred_lue = np.zeros(N)\n    y_pred_sif = np.zeros(N)\n\n    def solve_ols(X, y, lambda_val):\n        \"\"\"Solves Ridge Regression using the normal equations.\"\"\"\n        I = np.identity(X.shape[1])\n        # w = (X^T*X + lambda*I)^{-1} * X^T * y\n        try:\n            weights = np.linalg.inv(X.T @ X + lambda_val * I) @ X.T @ y\n        except np.linalg.LinAlgError:\n            # Fallback to pseudo-inverse if inversion fails despite regularization\n            weights = np.linalg.pinv(X.T @ X + lambda_val * I) @ X.T @ y\n        return weights\n\n    # K-fold cross-validation loop\n    for k in range(K):\n        # Define train and test indices\n        test_indices = np.arange(k * fold_size, (k + 1) * fold_size)\n        train_indices = np.setdiff1d(np.arange(N), test_indices)\n\n        # Split data\n        train_data = data[train_indices]\n        test_data = data[test_indices]\n        \n        y_train = train_data[:, 5]\n\n        # --- Model 1: Empirical ML ---\n        X_train_ml = np.c_[np.ones(train_data.shape[0]), train_data[:, :5]]\n        w_ml = solve_ols(X_train_ml, y_train, lambda_reg)\n        X_test_ml = np.c_[np.ones(test_data.shape[0]), test_data[:, :5]]\n        y_pred_ml[test_indices] = X_test_ml @ w_ml\n\n        # --- Model 2: Mechanistic LUE ---\n        # Calculate environmental scalars\n        s_T_train = np.exp(-0.5 * ((train_data[:, 2] - T_opt) / sigma)**2)\n        s_VPD_train = 1.0 / (1.0 + train_data[:, 3] / VPD0)\n        s_T_test = np.exp(-0.5 * ((test_data[:, 2] - T_opt) / sigma)**2)\n        s_VPD_test = 1.0 / (1.0 + test_data[:, 3] / VPD0)\n\n        # Form design matrix\n        X1_train = train_data[:, 0] * train_data[:, 1] * s_T_train * s_VPD_train\n        X2_train = train_data[:, 0] * s_T_train * s_VPD_train\n        X_train_lue = np.c_[X1_train, X2_train]\n        \n        w_lue = solve_ols(X_train_lue, y_train, lambda_reg)\n\n        X1_test = test_data[:, 0] * test_data[:, 1] * s_T_test * s_VPD_test\n        X2_test = test_data[:, 0] * s_T_test * s_VPD_test\n        X_test_lue = np.c_[X1_test, X2_test]\n        y_pred_lue[test_indices] = X_test_lue @ w_lue\n        \n        # --- Model 3: SIF-based ---\n        X_train_sif = np.c_[np.ones(train_data.shape[0]), train_data[:, 4]]\n        w_sif = solve_ols(X_train_sif, y_train, lambda_reg)\n        X_test_sif = np.c_[np.ones(test_data.shape[0]), test_data[:, 4]]\n        y_pred_sif[test_indices] = X_test_sif @ w_sif\n\n    def calculate_metrics(y_pred, y_true_vals, vpd_vals):\n        \"\"\"Computes RMSE, Bias, and residual-VPD correlation.\"\"\"\n        residuals = y_pred - y_true_vals\n        rmse = np.sqrt(np.mean(residuals**2))\n        bias = np.mean(residuals)\n        \n        # Check for zero std dev before calculating correlation\n        if np.std(residuals) == 0.0 or np.std(vpd_vals) == 0.0:\n            rho_r_vpd = 0.0\n        else:\n            rho_r_vpd = np.corrcoef(residuals, vpd_vals)[0, 1]\n            \n        return rmse, bias, rho_r_vpd\n\n    vpd_all = data[:, 3]\n    metrics_ml = calculate_metrics(y_pred_ml, y_true, vpd_all)\n    metrics_lue = calculate_metrics(y_pred_lue, y_true, vpd_all)\n    metrics_sif = calculate_metrics(y_pred_sif, y_true, vpd_all)\n\n    # Combine all 9 metrics for the final output\n    all_metrics = list(metrics_ml) + list(metrics_lue) + list(metrics_sif)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{m:.8f}' for m in all_metrics)}]\")\n\nsolve()\n```"
        }
    ]
}