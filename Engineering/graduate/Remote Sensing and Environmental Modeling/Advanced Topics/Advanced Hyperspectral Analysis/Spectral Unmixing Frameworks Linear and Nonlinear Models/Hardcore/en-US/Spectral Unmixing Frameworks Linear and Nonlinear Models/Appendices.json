{
    "hands_on_practices": [
        {
            "introduction": "To truly master a model, one must understand its foundations. This first exercise guides you in building the widely used Linear Mixing Model (LMM) from the ground up, starting with the physical principles of radiance and reflectance for idealized Lambertian surfaces. By deriving the relationship between a pixel's mixed reflectance and the fractional coverages of its components, you will solidify your understanding of the physical assumptions underpinning the LMM and the origin of its fundamental sum-to-one constraint .",
            "id": "3855555",
            "problem": "Consider a nadir-viewing, atmospherically corrected multispectral sensor observing a single image pixel whose footprint contains two distinct, non-interacting horizontal surface patches composed of Lambertian materials. Let the Bidirectional Reflectance Distribution Function (BRDF) be constant for Lambertian surfaces, so that the outgoing radiance is independent of view direction and proportional to the incident irradiance. Assume spatially uniform downwelling irradiance, identical illumination and viewing geometries across the sub-pixel patches, negligible adjacency effects, and no interfacial multiple scattering. The materials have band-specific reflectances $r_1=0.3$ and $r_2=0.6$ and occupy fractional areal coverages $f_1=0.4$ and $f_2=0.6$, respectively. Starting from the core definitions of radiance and reflectance for Lambertian surfaces and the additivity of radiance over disjoint areas under uniform illumination, derive the linear areal mixing expression for the pixelâ€™s band reflectance and then compute the mixed reflectance for the given values. In your derivation, explain how conservation of area leads to the implicit sum-to-one constraint on fractional coverages, and identify the conditions under which this constraint is violated and what term would then be required in the mixing model. Express your final reflectance as a dimensionless decimal rounded to four significant figures.",
            "solution": "The problem statement is parsed and validated as scientifically sound, well-posed, and internally consistent. It is based on established principles of remote sensing and radiative transfer, specifically the linear mixing model. The provided data are sufficient and appropriate for the requested derivation and calculation. We may therefore proceed with the solution.\n\nThe problem requires the derivation of the linear mixing model for pixel reflectance, starting from the fundamental principles of radiance and reflectance for Lambertian surfaces. We will then use this derived model to compute the mixed reflectance for the given parameters. Explanations regarding the sum-to-one constraint on fractional coverages are also required.\n\nLet $L$ represent the radiance, which is the radiant flux per unit solid angle per unit projected source area, with units of $\\text{W} \\cdot \\text{m}^{-2} \\cdot \\text{sr}^{-1}$. Let $E$ be the downwelling irradiance, the radiant flux incident upon a surface per unit area, with units of $\\text{W} \\cdot \\text{m}^{-2}$. A Lambertian surface is an ideal diffuse reflector, meaning it reflects incident radiation isotropically. The Bidirectional Reflectance Distribution Function (BRDF), denoted $f_r$, is constant for a Lambertian surface. The reflected radiance, $L_r$, from a Lambertian surface is proportional to the incident irradiance and is given by:\n$$L_r = f_r E$$\nThe hemispherical reflectance, $r$, is the dimensionless ratio of the total reflected radiant flux to the total incident radiant flux. For a Lambertian surface, the reflectance is related to the BRDF by $r = \\pi f_r$. Substituting $f_r = r/\\pi$ into the radiance equation, we obtain the expression for the radiance reflected from a Lambertian surface with reflectance $r$ under uniform irradiance $E$:\n$$L_r = \\frac{r}{\\pi} E$$\nThe problem considers a single sensor pixel of total area $A$. This area is composed of two distinct, non-interacting horizontal surface patches of materials $1$ and $2$. Let their respective areas be $A_1$ and $A_2$, and their Lambertian reflectances be $r_1$ and $r_2$. The fractional areal coverages are defined as $f_1 = A_1 / A$ and $f_2 = A_2 / A$.\n\nThe total radiant flux, $\\Phi_{pix}$, exiting the pixel in the direction of the sensor is the sum of the fluxes from each patch, as radiance is additive over disjoint areas. The sensor measures an average radiance for the entire pixel, $L_{pix}$. Under the assumption of a nadir-viewing sensor and horizontal patches, the projected area is the physical area. The total radiance is the area-weighted average of the radiances of the individual patches:\n$$L_{pix} = \\frac{L_1 A_1 + L_2 A_2}{A}$$\nwhere $L_1$ and $L_2$ are the radiances of patch $1$ and patch $2$, respectively. By substituting the definitions of fractional coverages, $A_1 = f_1 A$ and $A_2 = f_2 A$, we get:\n$$L_{pix} = \\frac{L_1 (f_1 A) + L_2 (f_2 A)}{A} = f_1 L_1 + f_2 L_2$$\nThis equation represents the linear mixing of radiances.\n\nThe problem states that illumination is spatially uniform across the sub-pixel patches. Therefore, both patches are subject to the same downwelling irradiance $E$. Using the Lambertian radiance-reflectance relationship, the radiances of the two patches are:\n$$L_1 = \\frac{r_1}{\\pi} E$$\n$$L_2 = \\frac{r_2}{\\pi} E$$\nThe entire pixel is observed as a single entity with an effective, or mixed, reflectance, $r_{pix}$. The radiance measured from the pixel, $L_{pix}$, can be expressed in terms of this effective reflectance:\n$$L_{pix} = \\frac{r_{pix}}{\\pi} E$$\nNow, we substitute the expressions for $L_{pix}$, $L_1$, and $L_2$ into the linear radiance mixing equation:\n$$\\frac{r_{pix}}{\\pi} E = f_1 \\left(\\frac{r_1}{\\pi} E\\right) + f_2 \\left(\\frac{r_2}{\\pi} E\\right)$$\nAssuming non-zero irradiance ($E > 0$), we can cancel the term $E/\\pi$ from all terms in the equation. This yields the linear areal mixing expression for the pixel's band reflectance:\n$$r_{pix} = f_1 r_1 + f_2 r_2$$\nThis derivation can be generalized to $N$ constituent materials (endmembers), resulting in the standard linear mixing model:\n$$r_{pix} = \\sum_{i=1}^{N} f_i r_i$$\n\nNext, we address the sum-to-one constraint on fractional coverages. The fractional cover $f_i$ is defined as the ratio of the area occupied by material $i$, $A_i$, to the total pixel area $A$, so $f_i = A_i/A$. The principle of conservation of area requires that, if the set of $N$ materials exhaustively partitions the pixel area, the sum of the sub-areas must equal the total area:\n$$\\sum_{i=1}^{N} A_i = A$$\nDividing this entire equation by the total area $A$ (which is non-zero) yields:\n$$\\frac{\\sum_{i=1}^{N} A_i}{A} = \\frac{A}{A}$$\n$$\\sum_{i=1}^{N} \\frac{A_i}{A} = 1$$\nBy the definition of fractional cover, this becomes the sum-to-one constraint:\n$$\\sum_{i=1}^{N} f_i = 1$$\nThis constraint is an implicit consequence of the assumption that the chosen endmembers fully account for the entire surface area within the pixel.\n\nThis constraint is violated if the set of endmembers used in the model is incomplete. For example, if a portion of the pixel is covered by a third material, or is in shadow, but the model only includes endmembers for materials $1$ and $2$, then the true sum of areas $A_1+A_2$ would be less than $A$. This means $f_1 + f_2 < 1$. In practical unmixing applications, if the sum-to-one constraint is not enforced, the resulting fractions may not sum to $1$, indicating the presence of unmodeled components. To correct this, the model must be extended. The required term would be an additional product $f_k r_k$ for each unmodeled component $k$. A common example is introducing a \"shade endmember\" ($r_{shade} \\approx 0$) with fraction $f_{shade}$. The model would then be $r_{pix} = \\sum_{i=1}^{N} f_i r_i + f_{shade} r_{shade}$, and the constraint would become $\\sum_{i=1}^{N} f_i + f_{shade} = 1$.\n\nFinally, we compute the mixed reflectance for the given values: $r_1 = 0.3$, $r_2 = 0.6$, $f_1 = 0.4$, and $f_2 = 0.6$. Note that $f_1 + f_2 = 0.4 + 0.6 = 1.0$, satisfying the sum-to-one constraint, consistent with the problem statement that the pixel contains only these two materials.\nUsing the derived formula:\n$$r_{pix} = f_1 r_1 + f_2 r_2$$\n$$r_{pix} = (0.4)(0.3) + (0.6)(0.6)$$\n$$r_{pix} = 0.12 + 0.36$$\n$$r_{pix} = 0.48$$\nThe problem asks for the result to be expressed as a dimensionless decimal rounded to four significant figures. Therefore, we express $0.48$ as $0.4800$.",
            "answer": "$$\n\\boxed{0.4800}\n$$"
        },
        {
            "introduction": "With the linear model $x = M a$ established, a tempting approach is to solve for the abundance vector $a$ using direct algebraic inversion. This exercise explores this Unconstrained Least Squares (ULS) solution, demonstrating how a mathematically straightforward method can lead to physically nonsensical results that violate the model's core constraints. This practice is crucial for appreciating why constrained optimization methods are not just an option, but a necessity in spectral unmixing .",
            "id": "3855536",
            "problem": "Consider the Linear Mixing Model (LMM) of spectral unmixing in remote sensing: an observed spectrum $x \\in \\mathbb{R}^{L}$ is expressed as a linear combination of $P$ endmember spectra collected in the matrix $M \\in \\mathbb{R}^{L \\times P}$, so that $x = M a + n$, where $a \\in \\mathbb{R}^{P}$ is the abundance vector and $n \\in \\mathbb{R}^{L}$ is the measurement noise. In the absence of constraints, the Unconstrained Least Squares (ULS) abundance estimate minimizes the squared reconstruction error $\\|x - M a\\|_{2}^{2}$.\n\nA hyperspectral pixel is measured over $L = 3$ bands with $P = 3$ candidate endmembers. The endmember matrix and the pixel spectrum are given by\n$$\nM =\n\\begin{bmatrix}\n0.2 & 0.7 & 0.1 \\\\\n0.3 & 0.1 & 0.6 \\\\\n0.5 & 0.2 & 0.4\n\\end{bmatrix},\n\\quad\nx =\n\\begin{bmatrix}\n0.35 \\\\\n0.25 \\\\\n0.4\n\\end{bmatrix},\n\\quad\nn = 0.\n$$\nStarting from the definition of the ULS problem under the LMM and without invoking any abundance constraints, derive the normal equations and compute the ULS abundance estimate $\\hat{a} \\in \\mathbb{R}^{3}$. Then, using the standard physical abundance constraints for linear spectral unmixing (nonnegativity and sum-to-one), determine whether $\\hat{a}$ violates any of these constraints and quantify any violation as a decimal. Round the entries of $\\hat{a}$ to $4$ significant figures, and express them as decimals. The final answer must be the abundance vector only (no units).",
            "solution": "The problem is first validated against the specified criteria.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Model**: Linear Mixing Model (LMM), $x = M a + n$.\n*   $x \\in \\mathbb{R}^{L}$ is the observed spectrum.\n*   $M \\in \\mathbb{R}^{L \\times P}$ is the endmember matrix.\n*   $a \\in \\mathbb{R}^{P}$ is the abundance vector.\n*   $n \\in \\mathbb{R}^{L}$ is the measurement noise.\n*   **Estimator**: Unconstrained Least Squares (ULS), which minimizes the cost function $J(a) = \\|x - M a\\|_{2}^{2}$.\n*   **Dimensionality**: Number of spectral bands $L=3$, number of endmembers $P=3$.\n*   **Endmember Matrix**:\n    $$\n    M =\n    \\begin{bmatrix}\n    0.2 & 0.7 & 0.1 \\\\\n    0.3 & 0.1 & 0.6 \\\\\n    0.5 & 0.2 & 0.4\n    \\end{bmatrix}\n    $$\n*   **Observed Spectrum**:\n    $$\n    x =\n    \\begin{bmatrix}\n    0.35 \\\\\n    0.25 \\\\\n    0.4\n    \\end{bmatrix}\n    $$\n*   **Noise Vector**: $n = 0$.\n*   **Tasks**:\n    1.  Derive the normal equations.\n    2.  Compute the ULS abundance estimate $\\hat{a}$.\n    3.  Check for violations of non-negativity ($a_i \\ge 0$) and sum-to-one ($\\sum a_i = 1$) constraints.\n    4.  Quantify any violations.\n    5.  Round the entries of $\\hat{a}$ to $4$ significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded**: The problem is a standard application of linear algebra in the field of remote sensing, specifically hyperspectral unmixing. The LMM and ULS are fundamental and widely used concepts. The problem is scientifically sound.\n*   **Well-Posed**: The problem requires solving a system of linear equations. Since the endmember matrix $M$ is a square matrix ($L=P=3$), a unique solution for the abundance vector $a$ exists if and only if $M$ is invertible. The determinant of $M$ is $\\det(M) = 0.2(0.1 \\cdot 0.4 - 0.6 \\cdot 0.2) - 0.7(0.3 \\cdot 0.4 - 0.6 \\cdot 0.5) + 0.1(0.3 \\cdot 0.2 - 0.1 \\cdot 0.5) = 0.2(-0.08) - 0.7(-0.18) + 0.1(0.01) = -0.016 + 0.126 + 0.001 = 0.111$. Since $\\det(M) \\neq 0$, the matrix $M$ is invertible, and a unique solution exists. The problem is well-posed.\n*   **Objective**: The problem is stated using precise mathematical language and definitions, free of any subjectivity or ambiguity.\n*   **Other Flaws**: The problem does not violate any other criteria. It is self-contained, consistent, and scientifically formalizable.\n\n**Step 3: Verdict and Action**\n\nThe problem is **valid**. A full solution will be provided.\n\n### Solution\n\nThe Unconstrained Least Squares (ULS) problem is defined as finding the abundance vector $\\hat{a}$ that minimizes the squared Euclidean norm of the residual error:\n$$\n\\hat{a} = \\arg\\min_{a} \\|x - Ma\\|_{2}^{2}\n$$\nThe cost function to be minimized is $J(a) = \\|x - Ma\\|_{2}^{2}$. We can expand this expression:\n$$\nJ(a) = (x - Ma)^{T}(x - Ma) = (x^T - a^T M^T)(x - Ma) = x^T x - x^T Ma - a^T M^T x + a^T M^T M a\n$$\nSince $x^T Ma$ is a scalar, it is equal to its transpose, $(x^T Ma)^T = a^T M^T x$. Thus, the cost function simplifies to:\n$$\nJ(a) = x^T x - 2a^T M^T x + a^T M^T M a\n$$\nTo find the minimum, we compute the gradient of $J(a)$ with respect to $a$ and set it to zero:\n$$\n\\nabla_{a} J(a) = \\nabla_{a} (x^T x - 2a^T M^T x + a^T M^T M a) = 0 - 2M^T x + 2M^T M a\n$$\nSetting the gradient to zero gives:\n$$\n2M^T M a = 2M^T x\n$$\nThis leads to the **normal equations**:\n$$\nM^T M a = M^T x\n$$\nThe general solution for the ULS estimate is $\\hat{a} = (M^T M)^{-1} M^T x$.\n\nIn this specific problem, we are given that the noise term $n$ is zero, and the matrix $M$ is square ($3 \\times 3$) and invertible. The model $x = Ma + n$ simplifies to $x = Ma$. We can solve for $a$ directly by pre-multiplying by the inverse of $M$:\n$$\n\\hat{a} = M^{-1}x\n$$\nThis is equivalent to solving the normal equations when $M$ is invertible: $M^T M a = M^T x \\implies (M^T)^{-1}M^T M a = (M^T)^{-1}M^T x \\implies Ma = x \\implies a = M^{-1}x$.\n\nWe proceed to calculate $M^{-1}$. The inverse of a matrix $M$ is given by $M^{-1} = \\frac{1}{\\det(M)}\\text{adj}(M)$, where $\\text{adj}(M)$ is the adjugate matrix of $M$.\nThe determinant was previously calculated as $\\det(M) = 0.111$.\nThe matrix of cofactors, $C$, is:\n$$\nC_{11} = +(0.1 \\cdot 0.4 - 0.6 \\cdot 0.2) = -0.08 \\\\\nC_{12} = -(0.3 \\cdot 0.4 - 0.6 \\cdot 0.5) = 0.18 \\\\\nC_{13} = +(0.3 \\cdot 0.2 - 0.1 \\cdot 0.5) = 0.01 \\\\\nC_{21} = -(0.7 \\cdot 0.4 - 0.1 \\cdot 0.2) = -0.26 \\\\\nC_{22} = +(0.2 \\cdot 0.4 - 0.1 \\cdot 0.5) = 0.03 \\\\\nC_{23} = -(0.2 \\cdot 0.2 - 0.7 \\cdot 0.5) = 0.31 \\\\\nC_{31} = +(0.7 \\cdot 0.6 - 0.1 \\cdot 0.1) = 0.41 \\\\\nC_{32} = -(0.2 \\cdot 0.6 - 0.1 \\cdot 0.3) = -0.09 \\\\\nC_{33} = +(0.2 \\cdot 0.1 - 0.7 \\cdot 0.3) = -0.19\n$$\nSo, the cofactor matrix is $C = \\begin{bmatrix} -0.08 & 0.18 & 0.01 \\\\ -0.26 & 0.03 & 0.31 \\\\ 0.41 & -0.09 & -0.19 \\end{bmatrix}$.\nThe adjugate matrix is the transpose of the cofactor matrix, $\\text{adj}(M) = C^T$:\n$$\n\\text{adj}(M) = \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix}\n$$\nThe inverse matrix is:\n$$\nM^{-1} = \\frac{1}{0.111} \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix}\n$$\nNow we compute the abundance vector $\\hat{a} = M^{-1}x$:\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} -0.08 & -0.26 & 0.41 \\\\ 0.18 & 0.03 & -0.09 \\\\ 0.01 & 0.31 & -0.19 \\end{bmatrix} \\begin{bmatrix} 0.35 \\\\ 0.25 \\\\ 0.4 \\end{bmatrix}\n$$\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} (-0.08)(0.35) + (-0.26)(0.25) + (0.41)(0.4) \\\\ (0.18)(0.35) + (0.03)(0.25) + (-0.09)(0.4) \\\\ (0.01)(0.35) + (0.31)(0.25) + (-0.19)(0.4) \\end{bmatrix}\n$$\n$$\n\\hat{a} = \\frac{1}{0.111} \\begin{bmatrix} -0.028 - 0.065 + 0.164 \\\\ 0.063 + 0.0075 - 0.036 \\\\ 0.0035 + 0.0775 - 0.076 \\end{bmatrix} = \\frac{1}{0.111} \\begin{bmatrix} 0.071 \\\\ 0.0345 \\\\ 0.005 \\end{bmatrix} = \\begin{bmatrix} \\frac{0.071}{0.111} \\\\ \\frac{0.0345}{0.111} \\\\ \\frac{0.005}{0.111} \\end{bmatrix}\n$$\nEvaluating the components:\n$$\n\\hat{a}_1 = 0.63963963... \\\\\n\\hat{a}_2 = 0.31081081... \\\\\n\\hat{a}_3 = 0.04504504...\n$$\nRounding to $4$ significant figures, we get:\n$$\n\\hat{a} \\approx \\begin{bmatrix} 0.6396 \\\\ 0.3108 \\\\ 0.04505 \\end{bmatrix}\n$$\n\nNext, we check for violations of the physical abundance constraints.\n1.  **Non-negativity constraint (ANC)**: $a_i \\ge 0$ for all $i=1, 2, 3$.\n    *   $\\hat{a}_1 \\approx 0.6396 > 0$\n    *   $\\hat{a}_2 \\approx 0.3108 > 0$\n    *   $\\hat{a}_3 \\approx 0.04505 > 0$\n    This constraint is satisfied for all components. There is no violation of non-negativity.\n\n2.  **Sum-to-one constraint (ASC)**: $\\sum_{i=1}^{3} a_i = 1$.\n    Using the unrounded values for better precision, the sum is:\n    $$\n    \\sum_{i=1}^{3} \\hat{a}_i = \\frac{0.071 + 0.0345 + 0.005}{0.111} = \\frac{0.1105}{0.111} \\approx 0.995495...\n    $$\n    The sum is not equal to $1$. This constraint is violated.\n    The violation is the difference between the sum and $1$:\n    $$\n    \\text{Violation} = \\sum_{i=1}^{3} \\hat{a}_i - 1 = \\frac{0.1105}{0.111} - 1 = \\frac{0.1105 - 0.111}{0.111} = \\frac{-0.0005}{0.111} \\approx -0.0045045...\n    $$\n    The sum of abundances is approximately $0.9955$, representing a deficit of approximately $0.0045$ with respect to the sum-to-one requirement.\n\nThe final answer requested is the abundance vector $\\hat{a}$ with its entries rounded to $4$ significant figures.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.6396 \\\\\n0.3108 \\\\\n0.04505\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Theoretical models provide a clean framework, but real-world data introduces complexities. This practice tackles a common challenge in remote sensing: the presence of residual atmospheric path radiance, which adds an offset to the observed signal. You will first quantify how this artifact corrupts abundance estimates and leads to a violation of the sum-to-one constraint, and then apply a practical correction method using dark pixels to restore the physical validity of the results .",
            "id": "3855570",
            "problem": "In a narrow visible spectral window from $0.65\\,\\mu\\mathrm{m}$ to $0.70\\,\\mu\\mathrm{m}$ where atmospheric residual path radiance is approximately band-invariant, consider a three-band pixel and a three-endmember library under the Linear Mixing Model (LMM). The LMM assumes that the observed reflectance without atmospheric residual is a linear combination of endmember reflectances, with abundances that are nonnegative and sum to one. Specifically, let the endmember reflectance matrix $M \\in \\mathbb{R}^{3 \\times 3}$ have columns corresponding to vegetation, soil, and water:\n$$\nM \\;=\\; \\begin{pmatrix}\n0.12 & 0.32 & 0.01 \\\\\n0.10 & 0.28 & 0.01 \\\\\n0.11 & 0.26 & 0.01\n\\end{pmatrix}.\n$$\nAssume the true water endmember reflectance is $w = \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix}$ in this window. Two dark pixels, visually identified as deep water, are observed with at-sensor reflectance vectors\n$$\ny^{(1)}_{\\mathrm{dark}} = \\begin{pmatrix}0.044 \\\\ 0.043 \\\\ 0.045\\end{pmatrix}, \n\\quad\ny^{(2)}_{\\mathrm{dark}} = \\begin{pmatrix}0.042 \\\\ 0.043 \\\\ 0.041\\end{pmatrix}.\n$$\nA target pixel has observed at-sensor reflectance \n$$\ny_{\\mathrm{obs}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}.\n$$\nIn this spectral window, residual atmospheric path radiance adds an offset $c \\in \\mathbb{R}$ equally to each band, so the observed reflectance relates to the true reflectance by\n$$\ny_{\\mathrm{obs}} \\;=\\; y_{\\mathrm{true}} + c\\,\\mathbf{1},\n$$\nwhere $\\mathbf{1} = \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix}$ and $y_{\\mathrm{true}} = M a_{\\mathrm{true}}$ for some abundance vector $a_{\\mathrm{true}}$ with entries that sum to one under the LMM.\n\nStarting from the core definitions of the LMM and a least-squares estimation of $c$ using the dark pixels and the known water reflectance $w$, carry out the following:\n\n1. Derive and compute the least-squares estimate $\\hat{c}$ of the scalar atmospheric offset $c$ using the two dark pixels and $w$.\n\n2. Using the linear mixing with no offset removal (i.e., naively inverting $M$ against $y_{\\mathrm{obs}}$), determine the sum of the abundances obtained for the target pixel, and explain why this violates the LMM sum-to-one constraint.\n\n3. Demonstrate, conceptually and quantitatively, that subtracting the estimated offset $\\hat{c}\\,\\mathbf{1}$ prior to unmixing restores the sum-to-one property for the abundances.\n\nYour final reported quantity must be the sum of the abundances for the target pixel when unmixing is performed naively on $y_{\\mathrm{obs}}$ without offset removal. Express this final quantity as a dimensionless decimal fraction and round your answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and contains all necessary information for a unique solution. The underlying model is a standard application of the Linear Mixing Model (LMM) in remote sensing with a simplified atmospheric correction. We can therefore proceed with the solution.\n\nThe problem requires a three-part analysis. We will address each part in sequence.\n\nFirst, we derive and compute the least-squares estimate $\\hat{c}$ for the atmospheric path radiance offset $c$. The problem states that this offset is a band-invariant scalar. The model for an observed reflectance vector $y_{\\mathrm{obs}}$ is given by $y_{\\mathrm{obs}} = y_{\\mathrm{true}} + c\\,\\mathbf{1}$, where $y_{\\mathrm{true}}$ is the true surface reflectance and $\\mathbf{1}$ is a vector of ones. The two dark pixels, $y^{(1)}_{\\mathrm{dark}}$ and $y^{(2)}_{\\mathrm{dark}}$, are identified as deep water. This implies that their true surface reflectance is the water endmember spectrum, $w = \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix}$. Thus, for these pixels, the model is $y^{(i)}_{\\mathrm{dark}} = w + c\\,\\mathbf{1} + \\epsilon^{(i)}$, where $\\epsilon^{(i)}$ is a random error vector for the $i$-th pixel observation.\n\nTo find the least-squares estimate $\\hat{c}$, we seek to minimize the sum of squared errors over all available measurements from the dark pixels. The error for a single band $j$ of a single dark pixel $i$ is $(y^{(i)}_{\\mathrm{dark}, j} - (w_j + c))$. The total sum of squared errors, $S(c)$, over both pixels (each with $3$ bands) is:\n$$\nS(c) = \\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j - c \\right)^2\n$$\nTo minimize $S(c)$, we take the derivative with respect to $c$ and set it to zero:\n$$\n\\frac{dS}{dc} = \\sum_{i=1}^{2} \\sum_{j=1}^{3} 2 \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j - c \\right) (-1) = 0\n$$\n$$\n\\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j \\right) = \\sum_{i=1}^{2} \\sum_{j=1}^{3} c = 6c\n$$\nThis gives the estimator $\\hat{c}$ as the average of the differences between the observed dark pixel reflectances and the known water reflectance:\n$$\n\\hat{c} = \\frac{1}{6} \\sum_{i=1}^{2} \\sum_{j=1}^{3} \\left( y^{(i)}_{\\mathrm{dark}, j} - w_j \\right)\n$$\nLet's compute the differences $d^{(i)} = y^{(i)}_{\\mathrm{dark}} - w$:\n$$\nd^{(1)} = y^{(1)}_{\\mathrm{dark}} - w = \\begin{pmatrix}0.044 \\\\ 0.043 \\\\ 0.045\\end{pmatrix} - \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix} = \\begin{pmatrix}0.034 \\\\ 0.033 \\\\ 0.035\\end{pmatrix}\n$$\n$$\nd^{(2)} = y^{(2)}_{\\mathrm{dark}} - w = \\begin{pmatrix}0.042 \\\\ 0.043 \\\\ 0.041\\end{pmatrix} - \\begin{pmatrix}0.01 \\\\ 0.01 \\\\ 0.01\\end{pmatrix} = \\begin{pmatrix}0.032 \\\\ 0.033 \\\\ 0.031\\end{pmatrix}\n$$\nThe sum of all components of $d^{(1)}$ and $d^{(2)}$ is $0.034 + 0.033 + 0.035 + 0.032 + 0.033 + 0.031 = 0.198$.\nTherefore, the least-squares estimate for $c$ is:\n$$\n\\hat{c} = \\frac{0.198}{6} = 0.033\n$$\n\nSecond, we determine the sum of abundances for the target pixel by naively applying the LMM to the observed reflectance $y_{\\mathrm{obs}}$ without atmospheric correction. This approach incorrectly assumes $y_{\\mathrm{obs}} = M a_{\\mathrm{naive}}$, where $a_{\\mathrm{naive}}$ is the vector of \"naive\" abundances. The solution is $a_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}}$. The endmember matrix is given as:\n$$\nM = \\begin{pmatrix}\n0.12 & 0.32 & 0.01 \\\\\n0.10 & 0.28 & 0.01 \\\\\n0.11 & 0.26 & 0.01\n\\end{pmatrix}\n$$\nThe determinant of $M$ is $\\det(M) = 8 \\times 10^{-6}$, so the matrix is invertible. The inverse is:\n$$\nM^{-1} = \\frac{1}{8 \\times 10^{-6}} \\begin{pmatrix}\n0.0002 & -0.0006 & 0.0004 \\\\\n0.0001 & 0.0001 & -0.0002 \\\\\n-0.0048 & 0.0040 & 0.0016\n\\end{pmatrix} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix}\n$$\nWe now compute the naive abundance vector $a_{\\mathrm{naive}}$ using $y_{\\mathrm{obs}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}$:\n$$\na_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix}\n$$\n$$\na_{\\mathrm{naive}} = \\begin{pmatrix}\n25(0.242) - 75(0.214) + 50(0.208) \\\\\n12.5(0.242) + 12.5(0.214) - 25(0.208) \\\\\n-600(0.242) + 500(0.214) + 200(0.208)\n\\end{pmatrix} = \\begin{pmatrix}\n6.05 - 16.05 + 10.4 \\\\\n3.025 + 2.675 - 5.2 \\\\\n-145.2 + 107 + 41.6\n\\end{pmatrix} = \\begin{pmatrix}0.4 \\\\ 0.5 \\\\ 3.4\\end{pmatrix}\n$$\nThe sum of these abundances is $0.4 + 0.5 + 3.4 = 4.3$. The LMM requires that abundances sum to one ($\\sum_k a_k = 1$). A sum of $4.3$ is a clear violation of this fundamental constraint, rendering the naive result physically meaningless. This discrepancy arises from ignoring the atmospheric additive term $c\\mathbf{1}$.\n\nThird, we demonstrate that subtracting the estimated offset restores the sum-to-one property. The correct model for the observed reflectance is $y_{\\mathrm{obs}} = M a_{\\mathrm{true}} + c\\,\\mathbf{1}$. Applying the naive inversion gives:\n$$\na_{\\mathrm{naive}} = M^{-1} y_{\\mathrm{obs}} = M^{-1} (M a_{\\mathrm{true}} + c\\,\\mathbf{1}) = M^{-1} M a_{\\mathrm{true}} + c M^{-1} \\mathbf{1} = a_{\\mathrm{true}} + c M^{-1} \\mathbf{1}\n$$\nThe sum of the naive abundances, let $\\mathbf{1}_R = \\begin{pmatrix}1 & 1 & 1\\end{pmatrix}$, is:\n$$\n\\mathbf{1}_R a_{\\mathrm{naive}} = \\mathbf{1}_R a_{\\mathrm{true}} + c (\\mathbf{1}_R M^{-1} \\mathbf{1})\n$$\nBy definition, $\\mathbf{1}_R a_{\\mathrm{true}} = 1$. The deviation from unity is the term $c (\\mathbf{1}_R M^{-1} \\mathbf{1})$. Let's compute this term:\n$$\nM^{-1} \\mathbf{1} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}0 \\\\ 0 \\\\ 100\\end{pmatrix}\n$$\n$$\n\\mathbf{1}_R M^{-1} \\mathbf{1} = \\begin{pmatrix}1 & 1 & 1\\end{pmatrix} \\begin{pmatrix}0 \\\\ 0 \\\\ 100\\end{pmatrix} = 100\n$$\nThus, the sum of naive abundances is theoretically $1 + 100c$. Using our estimate $\\hat{c} = 0.033$, the expected sum is $1 + 100(0.033) = 1 + 3.3 = 4.3$. This exactly matches our numerical result, confirming the conceptual framework.\n\nTo restore the sum-to-one property, one must first correct the observed reflectance by subtracting the estimated atmospheric contribution: $y_{\\mathrm{corr}} = y_{\\mathrm{obs}} - \\hat{c}\\,\\mathbf{1}$. Unmixing is then performed on $y_{\\mathrm{corr}}$:\n$$\ny_{\\mathrm{corr}} = \\begin{pmatrix}0.242 \\\\ 0.214 \\\\ 0.208\\end{pmatrix} - 0.033 \\begin{pmatrix}1 \\\\ 1 \\\\ 1\\end{pmatrix} = \\begin{pmatrix}0.209 \\\\ 0.181 \\\\ 0.175\\end{pmatrix}\n$$\nThe corrected abundance vector $a_{\\mathrm{corr}}$ is:\n$$\na_{\\mathrm{corr}} = M^{-1} y_{\\mathrm{corr}} = \\begin{pmatrix}\n25 & -75 & 50 \\\\\n12.5 & 12.5 & -25 \\\\\n-600 & 500 & 200\n\\end{pmatrix} \\begin{pmatrix}0.209 \\\\ 0.181 \\\\ 0.175\\end{pmatrix} = \\begin{pmatrix}\n5.225 - 13.575 + 8.75 \\\\\n2.6125 + 2.2625 - 4.375 \\\\\n-125.4 + 90.5 + 35\n\\end{pmatrix} = \\begin{pmatrix}0.4 \\\\ 0.5 \\\\ 0.1\\end{pmatrix}\n$$\nThe sum of the corrected abundances is $0.4 + 0.5 + 0.1 = 1.0$. This demonstrates quantitatively that removing the estimated atmospheric offset restores the physical consistency of the LMM by satisfying the sum-to-one constraint.\n\nThe specific quantity requested as the final answer is the sum of abundances from the naive unmixing.\nSum of naive abundances = $4.3$.\nRounding to four significant figures gives $4.300$.",
            "answer": "$$\\boxed{4.300}$$"
        }
    ]
}