{
    "hands_on_practices": [
        {
            "introduction": "像素纯度指数（PPI）算法通过将数据投影到大量随机方向上来识别端元。这个练习将深入探讨支撑这一过程的数学原理。你将推导生成均匀单位向量的标准方法，并应用它来计算单个像素的投影得分，从而揭示PPI算法的概率基础。",
            "id": "3808886",
            "problem": "考虑高光谱解混中使用的线性光谱混合模型，其中每个观测到的像素向量 $\\mathbf{x}_i \\in \\mathbb{R}^{L}$ 被建模为端元光谱的凸组合与加性噪声之和。\n\n诸如像素纯度指数（PPI）、N-FINDR 和顶点成分分析（VCA）等端元提取算法，旨在识别光谱空间中数据云的极值点。PPI的一个关键步骤是在$\\mathbb{R}^{L}$的单位球面上均匀地选择随机方向，并计算每个像素在该方向上的标量投影得分，以评估其极端性。\n\n从基本的概率论和线性代数原理出发——具体来说，即多元正态分布的旋转不变性以及有限维实向量空间中内积的定义——推导出一个在数学上有效的方法，用于生成在$\\mathbb{R}^{L}$的单位球面上均匀分布的随机单位方向。然后，利用内积结构，推导将像素向量在给定单位方向上的标量投影作为PPI使用的得分。\n\n完成这些推导后，计算以下特定情况的标量投影得分，该情况代表了在一个 $L=4$ 波段的高光谱图像中的单次PPI试验。设像素为 $\\mathbf{x}_i = \\begin{bmatrix}4 \\\\ -1 \\\\ 0 \\\\ 3\\end{bmatrix}$，随机向量为 $\\mathbf{z} = \\begin{bmatrix}2 \\\\ -1 \\\\ 2 \\\\ 1\\end{bmatrix}$，其中 $\\mathbf{z}$ 是根据您推导的随机单位方向生成过程构建的。使用您的推导将 $\\mathbf{z}$ 转换为一个单位方向，然后计算 $\\mathbf{x}_i$ 在该方向上的标量得分。\n\n将您的答案四舍五入至$5$位有效数字。以纯标量（无单位）形式表示您的最终答案。",
            "solution": "该问题要求推导与高光谱解混的像素纯度指数（PPI）算法相关的两个基本组成部分，然后进行一次具体计算。我将首先验证问题陈述的有效性。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   **模型：** 线性光谱混合模型，其中每个像素 $\\mathbf{x}_i \\in \\mathbb{R}^{L}$ 是端元的凸组合与加性噪声之和。\n-   **背景：** 端元提取算法（PPI, N-FINDR, VCA）识别数据云的极值点。\n-   **PPI流程要素：** 在 $\\mathbb{R}^{L}$ 的单位球面上均匀选择随机方向，并计算标量投影得分。\n-   **推导任务1：** 基于多元正态分布的旋转不变性和内积，推导一个在 $\\mathbb{R}^{L}$ 单位球面上生成均匀随机单位方向的过程。\n-   **推导任务2：** 推导像素向量在给定单位方向上的标量投影。\n-   **计算任务：** 根据以下数据，为单次PPI试验计算标量投影得分：\n    -   波段数（维度）：$L=4$。\n    -   像素向量：$\\mathbf{x}_i = \\begin{bmatrix}4 \\\\ -1 \\\\ 0 \\\\ 3\\end{bmatrix}$。\n    -   随机向量（待归一化）：$\\mathbf{z} = \\begin{bmatrix}2 \\\\ -1 \\\\ 2 \\\\ 1\\end{bmatrix}$。\n-   **取整要求：** 最终答案必须四舍五入至$5$位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据。它正确地引用了高光谱分析中的线性混合模型和标准算法（PPI, N-FINDR, VCA）。核心数学任务依赖于一种公认的在球面上生成均匀分布随机向量的方法——对一组独立同分布的高斯随机变量组成的向量进行归一化。该方法直接由题目所要求的多元正态分布的旋转对称性来证明其合理性。标量投影（内积）的使用是线性代数和PPI操作原理的基础。该问题提法恰当，为最终计算提供了所有必要的数据。术语精确客观。该问题未违反任何无效性标准。\n\n**步骤3：结论与行动**\n问题有效。我现在开始进行解答。\n\n### 推导与求解\n\n#### 第1部分：生成均匀随机单位方向的过程\n目标是生成一个随机向量 $\\mathbf{u} \\in \\mathbb{R}^{L}$，使其方向在单位超球面 $S^{L-1} = \\{ \\mathbf{v} \\in \\mathbb{R}^{L} : ||\\mathbf{v}|| = 1 \\}$ 上均匀分布。推导从多元标准正态分布的旋转不变性这一性质出发。\n\n设 $\\mathbf{z} = [Z_1, Z_2, \\dots, Z_L]^T$ 是 $\\mathbb{R}^L$ 中的一个随机向量，其中每个分量 $Z_j$ 是从标准正态分布 $Z_j \\sim \\mathcal{N}(0, 1)$ 中抽取的独立同分布（i.i.d.）随机变量。每个 $Z_j$ 的概率密度函数（PDF）为 $p(z_j) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-\\frac{z_j^2}{2})$。\n\n由于独立性，向量 $\\mathbf{z}$ 的联合概率密度函数是各分量概率密度函数的乘积：\n$$ f(\\mathbf{z}) = \\prod_{j=1}^{L} p(z_j) = \\prod_{j=1}^{L} \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{z_j^2}{2}\\right) $$\n可简化为：\n$$ f(\\mathbf{z}) = \\left(\\frac{1}{2\\pi}\\right)^{L/2} \\exp\\left(-\\frac{1}{2} \\sum_{j=1}^{L} z_j^2\\right) $$\n指数中的求和项是向量 $\\mathbf{z}$ 的欧几里得范数的平方，也即它与自身的内积：$\\sum_{j=1}^{L} z_j^2 = \\mathbf{z}^T\\mathbf{z} = ||\\mathbf{z}||^2$。因此，联合概率密度函数可以写为：\n$$ f(\\mathbf{z}) = (2\\pi)^{-L/2} \\exp\\left(-\\frac{1}{2} ||\\mathbf{z}||^2\\right) $$\n这个函数 $f(\\mathbf{z})$ 仅取决于 $\\mathbf{z}$ 的大小（范数），而与其方向无关。具有此性质的分布称为球对称或旋转不变分布。因此，向量 $\\mathbf{z}$ 的方向（由单位向量 $\\mathbf{u} = \\frac{\\mathbf{z}}{||\\mathbf{z}||}$ 表示）在 $\\mathbb{R}^L$ 中的所有可能方向上是均匀分布的。\n\n这导出了以下在数学上有效的方法：\n1.  从标准正态分布 $\\mathcal{N}(0, 1)$ 中生成一组 $L$ 个独立样本 $\\{z_1, z_2, \\dots, z_L\\}$。\n2.  构造向量 $\\mathbf{z} = [z_1, z_2, \\dots, z_L]^T$。该向量为非零向量的概率为 $1$。\n3.  计算 $\\mathbf{z}$ 的欧几里得范数：$||\\mathbf{z}|| = \\sqrt{\\sum_{j=1}^L z_j^2}$。\n4.  将向量归一化以获得随机单位方向：$\\mathbf{u} = \\frac{\\mathbf{z}}{||\\mathbf{z}||}$。该向量 $\\mathbf{u}$ 在单位球面 $S^{L-1}$ 上均匀分布。\n\n#### 第2部分：标量投影得分的推导\n在配备了标准内积（点积）的有限维实向量空间 $\\mathbb{R}^L$ 中，一个向量到另一个向量上的投影是一个基本概念。设 $\\mathbf{x}$ 是一个像素向量，$\\mathbf{u}$ 是一个单位方向向量，两者都在 $\\mathbb{R}^L$ 中。\n\n$\\mathbf{x}$ 和 $\\mathbf{u}$ 的内积定义为：\n$$ \\langle \\mathbf{x}, \\mathbf{u} \\rangle = \\mathbf{x}^T \\mathbf{u} = \\sum_{j=1}^{L} x_j u_j $$\n在几何上，该内积也由以下关系给出：\n$$ \\langle \\mathbf{x}, \\mathbf{u} \\rangle = ||\\mathbf{x}|| \\cdot ||\\mathbf{u}|| \\cos(\\theta) $$\n其中 $\\theta$ 是向量 $\\mathbf{x}$ 和 $\\mathbf{u}$ 之间的夹角。\n\n$\\mathbf{x}$ 在 $\\mathbf{u}$ 方向上的标量投影是 $\\mathbf{x}$ 到由 $\\mathbf{u}$ 张成的直线上的正交投影的有符号大小。该量由 $||\\mathbf{x}|| \\cos(\\theta)$ 给出。\n\n由于 $\\mathbf{u}$ 根据构造是单位向量，其范数为 $||\\mathbf{u}|| = 1$。将此代入内积的几何定义中，可得：\n$$ \\langle \\mathbf{x}, \\mathbf{u} \\rangle = ||\\mathbf{x}|| \\cdot (1) \\cdot \\cos(\\theta) = ||\\mathbf{x}|| \\cos(\\theta) $$\n因此，PPI中用于衡量像素 $\\mathbf{x}$ 沿方向 $\\mathbf{u}$ 的“极端性”的标量投影得分，恰好是 $\\mathbf{x}$ 和 $\\mathbf{u}$ 的内积。\n$$ \\text{得分} = \\langle \\mathbf{x}, \\mathbf{u} \\rangle = \\mathbf{x}^T \\mathbf{u} $$\n\n#### 第3部分：具体计算\n对于一个 $L=4$ 波段图像中的特定PPI试验，我们有以下数据：\n-   像素向量：$\\mathbf{x}_i = \\begin{bmatrix}4 \\\\ -1 \\\\ 0 \\\\ 3\\end{bmatrix}$\n-   随机向量实现：$\\mathbf{z} = \\begin{bmatrix}2 \\\\ -1 \\\\ 2 \\\\ 1\\end{bmatrix}$\n\n首先，我们必须应用第1部分推导出的过程，将给定的随机向量 $\\mathbf{z}$ 转换为单位方向向量 $\\mathbf{u}$。我们计算 $\\mathbf{z}$ 的欧几里得范数：\n$$ ||\\mathbf{z}|| = \\sqrt{2^2 + (-1)^2 + 2^2 + 1^2} = \\sqrt{4 + 1 + 4 + 1} = \\sqrt{10} $$\n那么单位方向向量 $\\mathbf{u}$ 是：\n$$ \\mathbf{u} = \\frac{\\mathbf{z}}{||\\mathbf{z}||} = \\frac{1}{\\sqrt{10}} \\begin{bmatrix}2 \\\\ -1 \\\\ 2 \\\\ 1\\end{bmatrix} $$\n接下来，我们使用第2部分推导的公式计算标量投影得分。该得分是像素向量 $\\mathbf{x}_i$ 和单位方向向量 $\\mathbf{u}$ 的内积：\n$$ \\text{得分} = \\langle \\mathbf{x}_i, \\mathbf{u} \\rangle = \\mathbf{x}_i^T \\mathbf{u} $$\n$$ \\text{得分} = \\begin{bmatrix}4 & -1 & 0 & 3\\end{bmatrix} \\left( \\frac{1}{\\sqrt{10}} \\begin{bmatrix}2 \\\\ -1 \\\\ 2 \\\\ 1\\end{bmatrix} \\right) $$\n我们可以提出标量项 $\\frac{1}{\\sqrt{10}}$：\n$$ \\text{得分} = \\frac{1}{\\sqrt{10}} \\left[ (4)(2) + (-1)(-1) + (0)(2) + (3)(1) \\right] $$\n$$ \\text{得分} = \\frac{1}{\\sqrt{10}} [8 + 1 + 0 + 3] = \\frac{12}{\\sqrt{10}} $$\n为了获得最终的数值，我们计算结果并四舍五入至$5$位有效数字：\n$$ \\text{得分} = \\frac{12}{\\sqrt{10}} \\approx \\frac{12}{3.16227766} \\approx 3.79473319... $$\n四舍五入至$5$位有效数字得到 $3.7947$。",
            "answer": "$$ \\boxed{3.7947} $$"
        },
        {
            "introduction": "N-FINDR 算法旨在寻找一组能最大化其所构成单形体体积的端元，这在几何上是一个直观而强大的思想。然而，直接使用格拉姆行列式计算体积在数值上可能不稳定，尤其是在端元共线性较强时。本练习将引导你实现一种基于 QR 分解的稳健体积计算方法，这对于构建可靠的算法至关重要。",
            "id": "3808949",
            "problem": "考虑在线性混合模型下的高光谱解混，其中每个像元光谱被建模为一组有限端元光谱的凸组合。设光谱波段数为 $L$，端元数量为 $p$，端元光谱表示为 $\\mathbb{R}^L$ 中的列向量。在 N-FINDR（N-FINDR 是一种端元提取算法，它选择一组端元，使其形成的单纯形体积最大化）框架中，由一组 $p$ 个端元光谱张成的单纯形体积是指导选择的核心量。基于行列式的体积计算通常通过构造端元光谱的差分矩阵并将体积与一个行列式相关联来执行，但对于病态矩阵，朴素的行列式求值可能在数值上不稳定。本任务是使用正交三角分解（QR分解）实现一种数值稳定的体积计算方法，以避免这种不稳定性。\n\n从适用于高光谱解混的线性代数基本原理出发，完成以下操作：\n\n1. 给定 $p$ 个端元光谱 $e_1, e_2, \\dots, e_p \\in \\mathbb{R}^L$，定义一个 $L \\times (p-1)$ 矩阵 $B$，其列为 $i = 2, \\dots, p$ 时的差值 $e_i - e_1$。仅使用基本定义，将单纯形体积计算为矩阵 $B$ 和 $(p-1)$ 的阶乘的函数。\n\n2. 实现两种计算单纯形体积的方法：\n   - 一种朴素的基于行列式的方法，该方法直接计算格拉姆矩阵 $B^\\top B$ 的行列式，然后使用该行列式计算体积。\n   - 一种数值稳定的方法，该方法使用QR分解获得 $B$ 的正交-上三角分解，然后从上三角因子计算体积。\n\n3. 您的实现必须能处理高矩阵情况（$L > p-1$）和方阵情况（$L = p-1$），并且必须在 $B$ 的列近似线性相关时确保鲁棒行为。对于朴素方法中由浮点误差产生的、绝对值小于 $10^{-16}$ 的任何负行列式，在取平方根之前应将其截断为 $0$。\n\n4. 使用以下端元集测试套件。对于每种情况，都指定了 $L$ 和 $p$，以及显式的端元光谱。所有值都是无量纲的，应被视为实数。\n\n   - 情况1（通用情况，中等条件数）：$L = 4$, $p = 3$，其中\n     $e_1 = [\\,0.90,\\,0.20,\\,0.10,\\,0.00\\,]$,\n     $e_2 = [\\,0.80,\\,0.30,\\,0.15,\\,0.05\\,]$,\n     $e_3 = [\\,0.85,\\,0.25,\\,0.05,\\,0.02\\,]$。\n   - 情况2（近共线边界）：$L = 3$, $p = 3$，其中\n     $e_1 = [\\,1.000000,\\,0.000000,\\,0.000000\\,]$,\n     $e_2 = [\\,0.999999,\\,0.000001,\\,0.000000\\,]$,\n     $e_3 = [\\,0.999998,\\,0.000002,\\,0.000000\\,]$。\n   - 情况3（高矩阵，波段间极端动态范围）：$L = 6$, $p = 4$，其中\n     $e_1 = [\\,0.90,\\,0.01,\\,0.000001,\\,0.50,\\,0.20,\\,0.000003\\,]$,\n     $e_2 = [\\,0.91,\\,0.015,\\,0.0000015,\\,0.49,\\,0.19,\\,0.0000032\\,]$,\n     $e_3 = [\\,0.89,\\,0.012,\\,0.0000009,\\,0.51,\\,0.21,\\,0.0000028\\,]$,\n     $e_4 = [\\,0.92,\\,0.02,\\,0.0000012,\\,0.48,\\,0.18,\\,0.0000035\\,]$。\n   - 情况4（方阵，已知参考体积）：$L = 3$, $p = 4$，其中\n     $e_1 = [\\,0.00,\\,0.00,\\,0.00\\,]$,\n     $e_2 = [\\,1.00,\\,0.00,\\,0.00\\,]$,\n     $e_3 = [\\,0.00,\\,1.00,\\,0.00\\,]$,\n     $e_4 = [\\,0.00,\\,0.00,\\,1.00\\,]$。\n\n5. 对每种情况，计算两个浮点数：基于QR的体积和朴素的基于行列式的体积，每个都四舍五入到 $12$ 位小数。最终输出为无量纲数。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（无空格），按情况排序为 $[\\,V^{\\mathrm{QR}}_1, V^{\\mathrm{naive}}_1, V^{\\mathrm{QR}}_2, V^{\\mathrm{naive}}_2, V^{\\mathrm{QR}}_3, V^{\\mathrm{naive}}_3, V^{\\mathrm{QR}}_4, V^{\\mathrm{naive}}_4\\,]$，其中每个 $V$ 是一个四舍五入到 $12$ 位小数的浮点数。例如，格式应如下所示：$[\\,0.123456789012,0.123456789012,0.000000000000,0.000000000000, \\dots\\,]$。",
            "solution": "在尝试任何解决方案之前，问题陈述都经过了严格的验证过程。\n\n### 第1步：提取已知条件\n从问题陈述中逐字提取的已知条件如下：\n- **模型**：线性混合模型下的高光谱解混。每个像元是端元光谱的凸组合。\n- **变量**：$L$ 是光谱波段数。$p$ 是端元数量。端元光谱是列向量 $e_1, e_2, \\dots, e_p \\in \\mathbb{R}^L$。\n- **算法背景**：N-FINDR（N-FINDR 是一种端元提取算法，它选择一组端元，使其形成的单纯形体积最大化）。\n- **矩阵定义**：$B$ 是一个 $L \\times (p-1)$ 矩阵，其列为 $i = 2, \\dots, p$ 时的 $e_i - e_1$。\n- **任务1**：仅使用基本定义，将单纯形体积计算为矩阵 $B$ 和 $(p-1)$ 的阶乘的函数。\n- **任务2**：实现两种计算体积的方法：\n    1. 一种使用格拉姆矩阵 $B^\\top B$ 行列式的朴素方法。\n    2. 一种使用 $B$ 的QR分解的数值稳定方法。\n- **任务3（约束）**：\n    - 实现必须能处理高矩阵（$L > p-1$）和方阵（$L = p-1$）的情况。\n    - 对于朴素方法，如果行列式为负且其绝对值小于 $10^{-16}$，则必须将其截断为 $0$。\n- **任务4（测试套件）**：\n    - **情况1**：$L = 4$, $p = 3$, $e_1 = [\\,0.90,\\,0.20,\\,0.10,\\,0.00\\,]$, $e_2 = [\\,0.80,\\,0.30,\\,0.15,\\,0.05\\,]$, $e_3 = [\\,0.85,\\,0.25,\\,0.05,\\,0.02\\,]$。\n    - **情况2**：$L = 3$, $p = 3$, $e_1 = [\\,1.000000,\\,0.000000,\\,0.000000\\,]$, $e_2 = [\\,0.999999,\\,0.000001,\\,0.000000\\,]$, $e_3 = [\\,0.999998,\\,0.000002,\\,0.000000\\,]$。\n    - **情况3**：$L = 6$, $p = 4$, $e_1 = [\\,0.90,\\,0.01,\\,0.000001,\\,0.50,\\,0.20,\\,0.000003\\,]$, $e_2 = [\\,0.91,\\,0.015,\\,0.0000015,\\,0.49,\\,0.19,\\,0.0000032\\,]$, $e_3 = [\\,0.89,\\,0.012,\\,0.0000009,\\,0.51,\\,0.21,\\,0.0000028\\,]$, $e_4 = [\\,0.92,\\,0.02,\\,0.0000012,\\,0.48,\\,0.18,\\,0.0000035\\,]$。\n    - **情况4**：$L = 3$, $p = 4$, $e_1 = [\\,0.00,\\,0.00,\\,0.00\\,]$, $e_2 = [\\,1.00,\\,0.00,\\,0.00\\,]$, $e_3 = [\\,0.00,\\,1.00,\\,0.00\\,]$, $e_4 = [\\,0.00,\\,0.00,\\,1.00\\,]$。\n- **任务5（输出格式）**：对每种情况，计算两个浮点数（QR体积，朴素体积），四舍五入到 $12$ 位小数。最终输出为单行：$[\\,V^{\\mathrm{QR}}_1, V^{\\mathrm{naive}}_1, V^{\\mathrm{QR}}_2, V^{\\mathrm{naive}}_2, \\dots\\,]$。\n\n### 第2步：使用提取的已知条件进行验证\n根据既定标准对问题进行评估：\n- **科学依据**：该问题根植于成熟的高光谱遥感领域，并利用了标准的线性代数原理。线性混合模型、N-FINDR算法、单纯形体积计算、格拉姆行列式和QR分解都是标准且有效的科学概念。\n- **适定性**：该问题是适定的。它提供了所有必要的输入（端元光谱、维度），明确定义了要计算的量，指定了要实现的算法，并给出了明确的输出格式。对于给定的顶点集，单纯形体积的存在性和唯一性是有保证的。\n- **客观性**：问题以精确、客观和数学化的语言陈述，没有任何主观或带偏见的措辞。\n- **完整性和一致性**：问题是自洽的。提供了所有测试用例的数据和参数。维度 $L$ 和 $p$ 与一般情况下非退化单纯形的要求 $L \\ge p-1$ 一致，或适当地定义了一个方阵系统。处理小负行列式的特殊情况解决了实际的数值问题，使问题规范更加鲁棒。情况4提供了体积已知的著名几何对象（标准单纯形），可用于验证。\n- **无其他缺陷**：该问题没有表现出任何其他列举的缺陷，如无法形式化、不切实际、不适定、琐碎或不可验证。朴素数值方法与稳定数值方法之间的比较是计算科学中一个经典且重要的课题。\n\n### 第3步：结论与行动\n问题是 **有效的**。将提供解决方案。\n\n### 解决方案推导\n\n#### 1. 单纯形体积公式\n$\\mathbb{R}^L$中的一个单纯形是 $p$ 个仿射无关点（即其顶点）的凸包。在此问题中，顶点是端元光谱 $e_1, e_2, \\dots, e_p \\in \\mathbb{R}^L$。这样一个单纯形是一个 $(p-1)$ 维对象。\n\n为计算其体积，我们首先考虑由从一个公共顶点发出的边向量所定义的 $(p-1)$ 维平行多面体。我们选择 $e_1$ 作为参考顶点。边向量则为 $v_i = e_{i+1} - e_1$，其中 $i = 1, \\dots, p-1$。这些向量是问题中定义的矩阵 $B$ 的列，其中 $B$ 是一个 $L \\times (p-1)$ 矩阵：\n$$\nB = [\\, e_2 - e_1 \\mid e_3 - e_1 \\mid \\dots \\mid e_p - e_1 \\,]\n$$\n由 $B$ 的列张成的平行多面体的体积平方由格拉姆矩阵 $B^\\top B$ 的行列式给出。这是线性代数中的一个基本结果，称为格拉姆行列式。\n$$\nV_{\\text{parallelotope}}^2 = \\det(B^\\top B)\n$$\n一个 $k$-单纯形的体积与由相同边向量张成的 $k$ 维平行多面体的体积相关，其关系因子为 $1/k!$。在我们的情况下，$k = p-1$。因此，单纯形的体积 $V_{\\text{simplex}}$ 是：\n$$\nV_{\\text{simplex}} = \\frac{1}{(p-1)!} V_{\\text{parallelotope}} = \\frac{1}{(p-1)!} \\sqrt{\\det(B^\\top B)}\n$$\n这个公式提供了单纯形体积、矩阵 $B$ 和 $(p-1)$ 的阶乘之间的所需关系。\n\n#### 2. 计算方法\n\n##### 朴素的基于行列式的方法\n该方法直接实现了上面推导出的公式。\n1.  根据给定的端元构造 $L \\times (p-1)$ 矩阵 $B$。\n2.  计算 $(p-1) \\times (p-1)$ 的格拉姆矩阵 $G = B^\\top B$。\n3.  计算行列式 $d = \\det(G)$。\n4.  理论上，$G$ 是一个半正定矩阵，因此其行列式必须为非负数。然而，当矩阵是奇异或接近奇异时，浮点误差可能导致小的负值。根据问题规范，如果 $d  0$ 且 $|d|  10^{-16}$，我们设 $d = 0$。\n5.  按 $V_{\\text{naive}} = \\frac{\\sqrt{d}}{(p-1)!}$ 计算体积。\n\n该方法的主要缺点是其数值不稳定性。$B^\\top B$ 的条件数是 $B$ 的条件数的平方，即 $\\kappa(B^\\top B) = (\\kappa(B))^2$。如果 $B$ 是病态的（即其列近似线性相关），构造 $B^\\top B$ 会导致显著的精度损失，使得计算出的行列式非常不准确。\n\n##### 数值稳定的基于QR的方法\n该方法通过使用正交三角分解来避免显式构造格拉姆矩阵 $B^\\top B$。\n1.  构造 $L \\times (p-1)$ 矩阵 $B$。\n2.  对 $B$ 进行 QR分解，使得 $B = QR$。这里，$Q$ 是一个 $L \\times (p-1)$ 的矩阵，具有标准正交列（$Q^\\top Q = I_{p-1}$，其中 $I_{p-1}$ 是 $(p-1) \\times (p-1)$ 的单位矩阵），$R$ 是一个 $(p-1) \\times (p-1)$ 的上三角矩阵。这种分解可以使用像Householder变换或Givens旋转这样的方法来稳定地计算。\n3.  将 $B = QR$ 代入格拉姆行列式表达式：\n    $$\n    \\det(B^\\top B) = \\det((QR)^\\top(QR)) = \\det(R^\\top Q^\\top Q R)\n    $$\n4.  使用属性 $Q^\\top Q = I_{p-1}$，上式简化为：\n    $$\n    \\det(B^\\top B) = \\det(R^\\top I_{p-1} R) = \\det(R^\\top R) = \\det(R^\\top) \\det(R) = (\\det(R))^2\n    $$\n5.  现在，将此结果代回体积公式：\n    $$\n    V_{\\text{simplex}} = \\frac{1}{(p-1)!} \\sqrt{(\\det(R))^2} = \\frac{1}{(p-1)!} |\\det(R)|\n    $$\n6.  由于 $R$ 是一个上三角矩阵，其行列式是其对角元素的乘积：$\\det(R) = \\prod_{i=1}^{p-1} R_{ii}$。\n7.  最终，数值稳定的体积计算公式为：\n    $$\n    V_{\\text{QR}} = \\frac{1}{(p-1)!} \\left| \\prod_{i=1}^{p-1} R_{ii} \\right|\n    $$\n这种方法在数值上更优越，因为QR分解算法是后向稳定的，并且计算过程避免了对条件数进行平方。对于病态矩阵 $B$，$R$ 的对角元素之积通常比直接计算 $\\det(B^\\top B)$ 要准确得多。\n\n实现将把这两种方法应用于所提供的四个测试用例，这些用例旨在探究算法在各种条件下的性能和稳定性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import factorial\n\ndef solve():\n    \"\"\"\n    Computes simplex volumes using two different methods for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"L\": 4,\n            \"p\": 3,\n            \"endmembers\": np.array([\n                [0.90, 0.20, 0.10, 0.00],\n                [0.80, 0.30, 0.15, 0.05],\n                [0.85, 0.25, 0.05, 0.02],\n            ]),\n        },\n        {\n            \"case_id\": 2,\n            \"L\": 3,\n            \"p\": 3,\n            \"endmembers\": np.array([\n                [1.000000, 0.000000, 0.000000],\n                [0.999999, 0.000001, 0.000000],\n                [0.999998, 0.000002, 0.000000],\n            ]),\n        },\n        {\n            \"case_id\": 3,\n            \"L\": 6,\n            \"p\": 4,\n            \"endmembers\": np.array([\n                [0.90, 0.01, 0.000001, 0.50, 0.20, 0.000003],\n                [0.91, 0.015, 0.0000015, 0.49, 0.19, 0.0000032],\n                [0.89, 0.012, 0.0000009, 0.51, 0.21, 0.0000028],\n                [0.92, 0.02, 0.0000012, 0.48, 0.18, 0.0000035],\n            ]),\n        },\n        {\n            \"case_id\": 4,\n            \"L\": 3,\n            \"p\": 4,\n            \"endmembers\": np.array([\n                [0.00, 0.00, 0.00],\n                [1.00, 0.00, 0.00],\n                [0.00, 1.00, 0.00],\n                [0.00, 0.00, 1.00],\n            ]),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        p = case[\"p\"]\n        endmembers = case[\"endmembers\"]\n\n        # Step 1: Form the matrix B of difference vectors\n        # Endmembers are rows in the input array, so we transpose them to be column vectors\n        e = endmembers.T  # Shape: (L, p)\n        e1 = e[:, 0].reshape(-1, 1)  # Reference endmember\n        \n        if p > 1:\n            B = e[:, 1:] - e1\n        else:\n            # If p=1, the simplex is a point or empty, volume is 0\n            # B would be empty, handle this gracefully\n            vol_qr = 0.0\n            vol_naive = 0.0\n            results.extend([vol_qr, vol_naive])\n            continue\n        \n        # Denominator for the volume formula\n        fact_p_minus_1 = factorial(p - 1)\n\n        # Approach 1: Naive determinant-based method\n        gram_matrix = B.T @ B\n        det_gram = np.linalg.det(gram_matrix)\n        \n        # Clip small negative determinants due to floating point error\n        if det_gram  0 and abs(det_gram)  1e-16:\n            det_gram = 0.0\n\n        if det_gram  0:\n            # Should not happen for a Gram matrix in theory, but handle it.\n            # Could indicate severe numerical issues. Volume is ill-defined. Report 0 or NaN.\n            # For this problem, we can assume non-negativity after clipping.\n            vol_naive = 0.0\n        else:\n            vol_naive = np.sqrt(det_gram) / fact_p_minus_1\n\n        # Approach 2: Numerically stable QR-based method\n        # numpy.linalg.qr returns Q and R. R is (min(L, p-1), p-1).\n        # We need the \"reduced\" QR decomposition, which is the default.\n        # Q will be L x (p-1), R will be (p-1) x (p-1)\n        _Q, R = np.linalg.qr(B)\n        \n        # Determinant of R is the product of its diagonal elements\n        # The absolute value handles potential negative diagonal elements\n        # that can arise from QR implementation details.\n        abs_det_R = np.abs(np.prod(np.diag(R)))\n        \n        vol_qr = abs_det_R / fact_p_minus_1\n\n        results.append(\"{:.12f}\".format(vol_qr))\n        results.append(\"{:.12f}\".format(vol_naive))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "顶点成分分析（VCA）通过识别数据云的顶点来提取端元，但其性能会受到各向异性（即“有色”）噪声的严重影响。本练习将探讨噪声白化和子空间投影这两个关键的预处理步骤。你将学习如何通过变换数据来消除噪声的几何失真，并分离出信号主导的维度，从而为 VCA 的成功应用奠定基础。",
            "id": "3808939",
            "problem": "一个高光谱场景由线性混合模型建模，其中每个观测到的像素向量 $x \\in \\mathbb{R}^{d}$ 由 $x = M a + n$ 给出，其中 $M \\in \\mathbb{R}^{d \\times p}$ 是端元矩阵，$a \\in \\mathbb{R}^{p}$ 是满足非负性和和为一约束的丰度向量，$n \\in \\mathbb{R}^{d}$ 是一个均值为零且协方差 $C_{n} \\in \\mathbb{R}^{d \\times d}$ 已知的加性噪声。$x$ 的观测样本协方差为 $S_{x} \\approx S_{s} + C_{n}$，其中 $S_{s}$ 是混合信号 $M a$ 的协方差。噪声白化使用一个满足 $W C_{n} W^{\\top} = I$ 的矩阵 $W \\in \\mathbb{R}^{d \\times d}$，白化后的协方差为 $S_{w} = W S_{x} W^{\\top}$。白化空间中的信号子空间由 $S_{w}$ 的大于1的特征值来确定，因为白化使噪声协方差变为单位矩阵。\n\n考虑一个具有 $d = 3$ 个光谱带的高光谱传感器。已知的噪声协方差为\n$$\nC_{n} = \\begin{pmatrix}\n4  0  0 \\\\\n0  1  0 \\\\\n0  0  9\n\\end{pmatrix},\n$$\n观测数据的样本协方差为\n$$\nS_{x} = \\begin{pmatrix}\n64  0  0 \\\\\n0  4  0 \\\\\n0  0  9\n\\end{pmatrix}.\n$$\n\n任务：\n1) 基于基础线性代数，构造一个满足 $W C_{n} W^{\\top} = I$ 的噪声白化矩阵 $W$，并计算白化协方差 $S_{w} = W S_{x} W^{\\top}$。\n2) 使用 $S_{w}$ 的特征分解，在特征值严格大于1表示信号的准则下，确定白化信号子空间的维度 $r$，并写出该白化信号子空间的一个标准正交基。\n3) 从线性混合和凸几何的角度，解释为什么在有色噪声存在的情况下，白化和子空间投影对顶点成分分析 (VCA) 是有益的，重点关注白化如何影响噪声的几何形状以及与端元对应的极点的检测。\n4) 令 $P_{r}$ 表示到你所确定的白化信号子空间上的正交投影算子。计算标量诊断值\n$$\n\\det\\!\\big(P_{r} \\,(S_{w} - I)\\, P_{r}\\big),\n$$\n它等于限制在信号子空间上的纯白化信号协方差的行列式。给出无单位的精确值作为最终答案。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于高光谱信号处理的原理，问题提出得当，提供了所有必要信息，并且表述客观。我们可以开始解答。\n\n该问题要求在给定特定协方差矩阵的情况下，对一个高光谱信号模型进行四部分分析。\n\n**1) 噪声白化矩阵和白化协方差**\n\n噪声白化变换矩阵 $W$ 由属性 $W C_{n} W^{\\top} = I$ 定义，其中 $I$ 是单位矩阵。当 $C_{n}$ 是正定矩阵时，一个常见且直接的选择是 $W = C_{n}^{-1/2}$。由于给定的噪声协方差矩阵 $C_{n}$ 是对角矩阵，其逆和平方根很容易计算。\n\n噪声协方差矩阵是：\n$$\nC_{n} = \\begin{pmatrix}\n4  0  0 \\\\\n0  1  0 \\\\\n0  0  9\n\\end{pmatrix}\n$$\n$C_n$ 的平方根是：\n$$\nC_{n}^{1/2} = \\begin{pmatrix}\n\\sqrt{4}  0  0 \\\\\n0  \\sqrt{1}  0 \\\\\n0  0  \\sqrt{9}\n\\end{pmatrix} = \\begin{pmatrix}\n2  0  0 \\\\\n0  1  0 \\\\\n0  0  3\n\\end{pmatrix}\n$$\n$C_{n}^{1/2}$ 的逆矩阵即为白化矩阵 $W$：\n$$\nW = C_{n}^{-1/2} = \\begin{pmatrix}\n1/2  0  0 \\\\\n0  1  0 \\\\\n0  0  1/3\n\\end{pmatrix}\n$$\n我们可以验证这个选择：$W C_{n} W^{\\top} = C_{n}^{-1/2} C_{n} (C_{n}^{-1/2})^{\\top} = C_{n}^{-1/2} C_{n} C_{n}^{-1/2} = C_{n}^{-1/2} C_{n}^{1/2} = I$。\n\n接下来，我们计算白化数据协方差矩阵 $S_{w} = W S_{x} W^{\\top}$。观测数据协方差 $S_{x}$ 如下：\n$$\nS_{x} = \\begin{pmatrix}\n64  0  0 \\\\\n0  4  0 \\\\\n0  0  9\n\\end{pmatrix}\n$$\n执行矩阵乘法：\n$$\nS_{w} = \\begin{pmatrix}\n1/2  0  0 \\\\\n0  1  0 \\\\\n0  0  1/3\n\\end{pmatrix}\n\\begin{pmatrix}\n64  0  0 \\\\\n0  4  0 \\\\\n0  0  9\n\\end{pmatrix}\n\\begin{pmatrix}\n1/2  0  0 \\\\\n0  1  0 \\\\\n0  0  1/3\n\\end{pmatrix}\n$$\n$$\nS_{w} = \\begin{pmatrix}\n(1/2)(64)(1/2)  0  0 \\\\\n0  (1)(4)(1)  0 \\\\\n0  0  (1/3)(9)(1/3)\n\\end{pmatrix} = \\begin{pmatrix}\n16  0  0 \\\\\n0  4  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n\n**2) 白化信号子空间的维度和基**\n\n白化信号子空间的维度 $r$ 由 $S_{w}$ 严格大于1的特征值的数量决定。由于 $S_{w}$ 是一个对角矩阵，其特征值是其对角线元素，其特征向量是标准基向量。\n$S_{w}$ 的特征值为 $\\lambda_1 = 16$，$\\lambda_2 = 4$ 和 $\\lambda_3 = 1$。\n对应的特征向量是：\n$$\nv_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad v_2 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad v_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n应用准则 $\\lambda > 1$：\n- $\\lambda_1 = 16 > 1$，表示一个信号分量。\n- $\\lambda_2 = 4 > 1$，表示一个信号分量。\n- $\\lambda_3 = 1$，不严格大于1，表示该维度只包含白化噪声。\n\n因此，白化信号子空间的维度是 $r=2$。该子空间的一个标准正交基由对应于信号特征值的特征向量 $v_1$ 和 $v_2$ 构成。\n基为 $\\{u_1, u_2\\}$，其中：\n$$\nu_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad u_2 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n这个基已经是标准正交的。\n\n**3) 白化和投影对VCA的益处**\n\n顶点成分分析 (VCA) 是一种用于端元提取的几何算法。它基于一个假设：观测到的像素向量是少数纯端元向量的凸组合，在数据空间中形成一个单纯形。VCA通过找到这个单纯形的顶点来识别端元。VCA的有效性高度依赖于这个单纯形的几何纯度。\n\n- **有色噪声的影响**：在原始数据空间中，噪声是“有色的”，其协方差为 $C_n = \\mathrm{diag}(4, 1, 9)$。这意味着噪声不是各向同性的；它在每个光谱带的方差都不同（方差分别为 $4$，$1$ 和 $9$）。从几何上看，这对应于任何数据点周围的噪声云是一个与坐标轴对齐的椭球体，其半轴长分别为 $\\sqrt{4}=2$，$\\sqrt{1}=1$ 和 $\\sqrt{9}=3$。这种各向异性的噪声会扭曲观测到的数据单纯形，沿不同轴向拉伸和压缩它。因此，带噪数据云的顶点可能不对应于真实的端元，从而影响了VCA通过投影数据和识别极点来找到它们的能力。\n\n- **白化的影响**：白化变换 $y=Wx$ 将数据重新映射到一个新的空间，在该空间中噪声协方差变为单位矩阵（$W C_n W^\\top = I$）。这种白化后的噪声是各向同性（在所有方向上具有单位方差）且不相关的。从几何上看，噪声云变成了一个球面。通过消除噪声的方向性偏差，白化恢复了信号单纯形的底层几何结构。在这个白化空间中，数据云的顶点更有可能是真实的端元，因为所有数据点都受到均匀、球形方式的噪声扰动。这使得像VCA这样的几何算法更加鲁棒和准确。\n\n- **子空间投影的影响**：白化后，对白化协方差 $S_w$ 进行特征分解，可以将由信号主导的维度（特征值 $1$）与由噪声主导的维度（特征值 $\\approx 1$）分离开来。将白化数据投影到信号子空间上（在本例中是二维子空间），有效地移除了仅包含噪声的维度。这有两个好处：（i）通过丢弃纯噪声维度，进一步提高了信噪比，从而得到更干净的数据集；（ii）它降低了问题的维度，使得VCA后续搜索顶点的计算效率更高。\n\n总而言之，白化规范了噪声的几何形状，而子空间投影隔离了富含信号的维度，为VCA准确提取端元创造了更有利的问​​题结构。\n\n**4) 标量诊断值的计算**\n\n任务是计算 $\\det(P_{r} \\,(S_{w} - I)\\, P_{r})$，它代表限制在信号子空间上的纯白化信号协方差的行列式。\n\n令 $A = P_{r} \\,(S_{w} - I)\\, P_{r}$。算子 $P_{r}$ 是到维度为 $r=2$ 的信号子空间上的正交投影算子，该子空间由标准正交基 $\\{u_1, u_2\\}$ 张成。投影算子可以写为 $P_r = u_1 u_1^\\top + u_2 u_2^\\top$。\n用矩阵形式表示，$U = [u_1 | u_2]$，则 $P_r = U U^\\top$。\n$$\nU = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix} \\implies P_r = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix} \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  0 \\end{pmatrix}\n$$\n算子 $A$ 是 $\\mathbb{R}^3$ 中的一个秩为2的算子。短语“限制在信号子空间上”意味着我们应该找到该算子在那个子空间内作用的行列式。受限算子的特征值是 $A$ 的非零特征值的乘积。\n\n让我们找出 $A$ 的特征值。向量 $u_1$、$u_2$ 和 $u_3=v_3$ 构成了 $P_r$ 和 $S_w - I$ 的一个特征基。\n对于 $u_1$，$S_w$ 的一个特征向量，其特征值为 $\\lambda_1=16$：\n$A u_1 = P_r (S_w - I) P_r u_1$。由于 $u_1$ 在信号子空间中，所以 $P_r u_1 = u_1$。\n$A u_1 = P_r (S_w u_1 - u_1) = P_r (\\lambda_1 u_1 - u_1) = (\\lambda_1 - 1) P_r u_1 = (\\lambda_1 - 1) u_1 = (16-1) u_1 = 15 u_1$。\n对应于 $u_1$ 的 $A$ 的特征值是 $15$。\n\n对于 $u_2$，$S_w$ 的一个特征向量，其特征值为 $\\lambda_2=4$：\n$A u_2 = P_r (S_w - I) P_r u_2 = (\\lambda_2 - 1) u_2 = (4-1) u_2 = 3 u_2$。\n对应于 $u_2$ 的 $A$ 的特征值是 $3$。\n\n对于 $u_3$，它张成了 $P_r$ 的零空间：\n$A u_3 = P_r (S_w - I) P_r u_3 = P_r (S_w - I) (0) = 0$。\n对应于 $u_3$ 的 $A$ 的特征值是 $0$。\n\n矩阵 $A$ 的特征值为 $15$，$3$ 和 $0$。$A$ 作为 $\\mathbb{R}^{3 \\times 3}$ 中矩阵的行列式是 $15 \\times 3 \\times 0 = 0$。然而，限制在信号子空间上的算子的行列式是其在该子空间上的特征值的乘积。对应于信号子空间的特征值是 $15$ 和 $3$。\n\n因此，所需的标量诊断值是这些特征值的乘积：\n$$\n\\det\\nolimits_{\\text{restricted}} = 15 \\times 3 = 45\n$$\n或者，可以计算该算子限制在子空间上的矩阵表示 $U^\\top (S_w - I) U$，并求其行列式。\n$$\nU^\\top (S_w - I) U = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\end{pmatrix} \\left( \\begin{pmatrix} 16  0  0 \\\\ 0  4  0 \\\\ 0  0  1 \\end{pmatrix} - \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} \\right) \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\end{pmatrix} \\begin{pmatrix} 15  0  0 \\\\ 0  3  0 \\\\ 0  0  0 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 0  0 \\end{pmatrix} = \\begin{pmatrix} 15  0 \\\\ 0  3 \\end{pmatrix}\n$$\n这个 $2 \\times 2$ 矩阵的行列式是 $\\det \\begin{pmatrix} 15  0 \\\\ 0  3 \\end{pmatrix} = (15)(3) - (0)(0) = 45$。",
            "answer": "$$\n\\boxed{45}\n$$"
        }
    ]
}