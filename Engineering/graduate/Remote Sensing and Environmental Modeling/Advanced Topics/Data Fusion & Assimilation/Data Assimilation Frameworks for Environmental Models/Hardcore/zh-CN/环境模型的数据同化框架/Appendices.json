{
    "hands_on_practices": [
        {
            "introduction": "为了巩固基础，我们的第一个实践从数据同化中最经典的算法——卡尔曼滤波器（Kalman Filter）开始。这个练习将引导你为一个简单的标量系统（如河流的水位）从贝叶斯定理的第一性原理出发，推导出卡尔曼滤波器的预测和更新步骤。通过亲手计算一个完整的滤波循环并分析其稳态行为 ，你将不仅学会如何应用公式，更能深刻理解滤波器如何在模型预测的不确定性（由$Q$代表）和观测数据的不确定性（由$R$代表）之间取得动态平衡。",
            "id": "3804790",
            "problem": "一段河段由卫星测高法进行监测，提供河流水位的遥感测量数据。考虑一个以米为单位的河流水位的标量离散时间线性高斯状态空间模型，其中状态 $x_k$ 表示在时间步 $k$ 的真实水位，受随机游走动态和带有噪声的直接测量控制：\n$$\nx_k = x_{k-1} + w_{k-1}, \\quad w_{k-1} \\sim \\mathcal{N}(0, Q),\n$$\n$$\ny_k = x_k + v_k, \\quad v_k \\sim \\mathcal{N}(0, R),\n$$\n已知参数 $A=1$，$H=1$，$Q=0.1\\ \\mathrm{m}^2$ 以及 $R=0.5\\ \\mathrm{m}^2$。假设在 $k=0$ 时的初始后验（分析）为 $\\hat{x}_0^{+} = 2.00\\ \\mathrm{m}$ 和 $P_0^{+} = 1.00\\ \\mathrm{m}^2$。在 $k=1$ 时，接收到单个测高观测值 $y_1 = 2.30\\ \\mathrm{m}$。\n\n从线性高斯状态空间模型的定义和高斯随机变量的贝叶斯法则出发，推导用于均值和方差的标量卡尔曼滤波器（KF）的预测和更新步骤，不要使用任何预先记忆的公式。在 $k=1$ 时执行一个完整的KF周期，以获得 $\\hat{x}_1^{-}$，$P_1^{-}$，卡尔曼增益 $K_1$ 以及更新后的 $\\hat{x}_1^{+}$ 和 $P_1^{+}$。\n\n然后，仅使用此模型所蕴含的协方差递推关系（且独立于任何特定的测量值），评估后验方差 $P_k^{+}$ 是否在 $k \\to \\infty$ 时收敛到一个稳态。如果收敛，导出稳态后验方差 $P^{*}$ 作为 $Q$ 和 $R$ 的函数的闭式解，并对给定的 $Q$ 和 $R$ 进行数值计算。\n\n以 $\\mathrm{m}^2$ 为单位表示最终的稳态后验方差，并将您的答案四舍五入到四位有效数字。",
            "solution": "问题陈述已经过验证，被认为是合理的。它在科学上基于标准估计理论（卡尔曼滤波），问题设定良好，具有唯一且有意义的解，是客观且自洽的。因此，有必要提供完整的解答。\n\n该问题要求从第一性原理出发，为一个线性高斯状态空间模型推导标量卡尔曼滤波器（KF）方程，执行滤波器的单步计算，并对后验协方差进行稳态分析。\n\n状态空间模型由以下公式给出：\n状态（过程）模型：\n$$x_k = x_{k-1} + w_{k-1}, \\quad w_{k-1} \\sim \\mathcal{N}(0, Q)$$\n测量模型：\n$$y_k = x_k + v_k, \\quad v_k \\sim \\mathcal{N}(0, R)$$\n其中 $x_k$ 是时间步 $k$ 的真实状态，$y_k$ 是测量值，$w_k$ 和 $v_k$ 分别是方差为 $Q$ 和 $R$ 的独立的零均值高斯噪声过程。\n\nKF在一个两步循环中运行：预测和更新。我们从时间 $k-1$ 的后验分布开始，这是一个高斯分布：$p(x_{k-1} | y_{1:k-1}) = \\mathcal{N}(x_{k-1}; \\hat{x}_{k-1}^{+}, P_{k-1}^{+})$，其中 $\\hat{x}_{k-1}^{+}$ 是后验均值（分析估计）而 $P_{k-1}^{+}$ 是后验方差。\n\n**1. 预测（时间更新）步骤的推导**\n\n预测步骤的目标是计算在时间 $k$ 的状态的先验分布，以截至时间 $k-1$ 的所有测量为条件，即 $p(x_k | y_{1:k-1})$。这可以通过对 $x_{k-1}$ 进行边缘化来找到：\n$$p(x_k | y_{1:k-1}) = \\int p(x_k | x_{k-1}, y_{1:k-1}) p(x_{k-1} | y_{1:k-1}) dx_{k-1}$$\n考虑到系统的马尔可夫性，$p(x_k | x_{k-1}, y_{1:k-1}) = p(x_k | x_{k-1})$。状态模型给出此分布为 $p(x_k | x_{k-1}) = \\mathcal{N}(x_k; x_{k-1}, Q)$。\n该积分表示两个高斯分布的卷积：$p(x_k | y_{1:k-1})$ 是两个独立随机变量之和的分布，这两个变量是 $x_{k-1} \\sim \\mathcal{N}(\\hat{x}_{k-1}^{+}, P_{k-1}^{+})$ 和 $w_{k-1} \\sim \\mathcal{N}(0, Q)$。\n和的均值是均值的和，和的方差是方差的和。\n结果分布是一个高斯分布，$p(x_k | y_{1:k-1}) = \\mathcal{N}(x_k; \\hat{x}_k^{-}, P_k^{-})$，其中 $\\hat{x}_k^{-}$ 是先验均值（预测估计），$P_k^{-}$ 是先验方差。\n\n先验均值为：\n$$\\hat{x}_k^{-} = \\mathbb{E}[x_k | y_{1:k-1}] = \\mathbb{E}[x_{k-1} + w_{k-1} | y_{1:k-1}] = \\mathbb{E}[x_{k-1} | y_{1:k-1}] + \\mathbb{E}[w_{k-1}] = \\hat{x}_{k-1}^{+} + 0$$\n$$\\hat{x}_k^{-} = \\hat{x}_{k-1}^{+}$$\n先验方差为：\n$$P_k^{-} = \\text{Var}(x_k | y_{1:k-1}) = \\text{Var}(x_{k-1} + w_{k-1} | y_{1:k-1}) = \\text{Var}(x_{k-1} | y_{1:k-1}) + \\text{Var}(w_{k-1}) = P_{k-1}^{+} + Q$$\n$$P_k^{-} = P_{k-1}^{+} + Q$$\n\n**2. 更新（测量更新）步骤的推导**\n\n更新步骤结合了新的测量值 $y_k$ 来修正先验估计，计算后验分布 $p(x_k | y_{1:k})$。使用贝叶斯法则：\n$$p(x_k | y_{1:k}) = p(x_k | y_k, y_{1:k-1}) \\propto p(y_k | x_k, y_{1:k-1}) p(x_k | y_{1:k-1})$$\n第一项是似然，$p(y_k | x_k) = \\mathcal{N}(y_k; x_k, R)$，第二项是先验，$p(x_k | y_{1:k-1}) = \\mathcal{N}(x_k; \\hat{x}_k^{-}, P_k^{-})$。\n两个高斯概率密度函数的乘积与另一个高斯函数成正比。我们可以通过处理对数似然来找到其参数：\n$$\\ln p(x_k | y_{1:k}) = C - \\frac{1}{2R}(y_k - x_k)^2 - \\frac{1}{2P_k^{-}}(x_k - \\hat{x}_k^{-})^2$$\n展开 $x_k$ 的二次项：\n$$\\ln p(x_k | y_{1:k}) = C' - \\frac{1}{2} \\left[ x_k^2 \\left(\\frac{1}{R} + \\frac{1}{P_k^{-}}\\right) - 2x_k \\left(\\frac{y_k}{R} + \\frac{\\hat{x}_k^{-}}{P_k^{-}}\\right) \\right]$$\n后验分布为 $p(x_k | y_{1:k}) = \\mathcal{N}(x_k; \\hat{x}_k^{+}, P_k^{+})$，其对数形式为 $C'' - \\frac{1}{2P_k^{+}}(x_k - \\hat{x}_k^{+})^2 = C'' - \\frac{1}{2} \\left(\\frac{x_k^2}{P_k^{+}} - \\frac{2x_k \\hat{x}_k^{+}}{P_k^{+}}\\right)$。\n通过比较 $x_k^2$ 的系数：\n$$\\frac{1}{P_k^{+}} = \\frac{1}{R} + \\frac{1}{P_k^{-}} \\implies P_k^{+} = \\left( (P_k^{-})^{-1} + R^{-1} \\right)^{-1} = \\frac{P_k^{-} R}{P_k^{-} + R}$$\n通过比较 $x_k$ 的系数：\n$$\\frac{\\hat{x}_k^{+}}{P_k^{+}} = \\frac{y_k}{R} + \\frac{\\hat{x}_k^{-}}{P_k^{-}} \\implies \\hat{x}_k^{+} = P_k^{+} \\left(\\frac{y_k}{R} + \\frac{\\hat{x}_k^{-}}{P_k^{-}}\\right)$$\n$$\\hat{x}_k^{+} = \\frac{P_k^{-} R}{P_k^{-} + R} \\left(\\frac{y_k P_k^{-} + \\hat{x}_k^{-} R}{R P_k^{-}}\\right) = \\frac{y_k P_k^{-} + \\hat{x}_k^{-} R}{P_k^{-} + R}$$\n为了得到标准形式，我们重新整理：\n$$\\hat{x}_k^{+} = \\frac{\\hat{x}_k^{-}(P_k^{-} + R) - \\hat{x}_k^{-} P_k^{-} + y_k P_k^{-}}{P_k^{-} + R} = \\hat{x}_k^{-} + \\frac{P_k^{-}}{P_k^{-} + R}(y_k - \\hat{x}_k^{-})$$\n我们定义卡尔曼增益 $K_k = \\frac{P_k^{-}}{P_k^{-} + R}$。更新方程变为：\n$$\\hat{x}_k^{+} = \\hat{x}_k^{-} + K_k (y_k - \\hat{x}_k^{-})$$\n$$P_k^{+} = (1 - K_k)P_k^{-}$$\n推导到此完成。\n\n**3. 在 $k=1$ 时执行一个KF周期**\n\n已知：$\\hat{x}_0^{+} = 2.00$，$P_0^{+} = 1.00$，$Q = 0.1$，$R = 0.5$ 以及 $y_1 = 2.30$。\n\n**预测步骤：**\n$$\\hat{x}_1^{-} = \\hat{x}_0^{+} = 2.00$$\n$$P_1^{-} = P_0^{+} + Q = 1.00 + 0.1 = 1.10$$\n\n**更新步骤：**\n卡尔曼增益：\n$$K_1 = \\frac{P_1^{-}}{P_1^{-} + R} = \\frac{1.10}{1.10 + 0.5} = \\frac{1.10}{1.60} = \\frac{11}{16} = 0.6875$$\n更新后的均值：\n$$\\hat{x}_1^{+} = \\hat{x}_1^{-} + K_1(y_1 - \\hat{x}_1^{-}) = 2.00 + 0.6875(2.30 - 2.00) = 2.00 + 0.6875(0.30) = 2.00 + 0.20625 = 2.20625$$\n更新后的方差：\n$$P_1^{+} = (1 - K_1)P_1^{-} = (1 - 0.6875)(1.10) = (0.3125)(1.10) = 0.34375$$\n\n第一个周期的结果是：$\\hat{x}_1^{-} = 2.00\\ \\mathrm{m}$，$P_1^{-} = 1.10\\ \\mathrm{m}^2$，$K_1=0.6875$，$\\hat{x}_1^{+}=2.20625\\ \\mathrm{m}$ 以及 $P_1^{+}=0.34375\\ \\mathrm{m}^2$。\n\n**4. 稳态分析**\n\n后验方差 $P_k^{+}$ 根据一个与测量值无关的递推关系演化：\n$$P_k^{-} = P_{k-1}^{+} + Q$$\n$$P_k^{+} = \\frac{R P_k^{-}}{P_k^{-} + R}$$\n将第一个方程代入第二个方程，得到关于 $P_k^{+}$ 的单一递推关系：\n$$P_k^{+} = \\frac{R(P_{k-1}^{+} + Q)}{(P_{k-1}^{+} + Q) + R}$$\n这是一个收敛序列，因为对于非负的 $p$、$Q$ 和 $R$，映射函数 $f(p) = \\frac{R(p+Q)}{p+Q+R}$ 是一个压缩映射。因此，后验方差收敛到一个稳态值 $P^{*} = \\lim_{k \\to \\infty} P_k^{+}$。\n在稳态时，$P_k^{+} = P_{k-1}^{+} = P^{*}$。我们求解以下关于 $P^{*}$ 的方程：\n$$P^{*} = \\frac{R(P^{*} + Q)}{P^{*} + Q + R}$$\n$$P^{*}(P^{*} + Q + R) = R(P^{*} + Q)$$\n$$(P^{*})^2 + P^{*}Q + P^{*}R = P^{*}R + RQ$$\n$$(P^{*})^2 + Q P^{*} - QR = 0$$\n这是一个关于 $P^{*}$ 的二次方程。使用二次公式 $P^{*} = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$，其中 $a=1$，$b=Q$，$c=-QR$：\n$$P^{*} = \\frac{-Q \\pm \\sqrt{Q^2 - 4(1)(-QR)}}{2} = \\frac{-Q \\pm \\sqrt{Q^2 + 4QR}}{2}$$\n由于方差必须是非负量 ($P^{*} \\ge 0$)，我们必须取正根：\n$$P^{*} = \\frac{-Q + \\sqrt{Q^2 + 4QR}}{2}$$\n\n**稳态方差的数值计算**\n\n将给定值 $Q=0.1\\ \\mathrm{m}^2$ 和 $R=0.5\\ \\mathrm{m}^2$ 代入 $P^{*}$ 的闭式表达式中：\n$$P^{*} = \\frac{-0.1 + \\sqrt{(0.1)^2 + 4(0.5)(0.1)}}{2}$$\n$$P^{*} = \\frac{-0.1 + \\sqrt{0.01 + 0.2}}{2}$$\n$$P^{*} = \\frac{-0.1 + \\sqrt{0.21}}{2}$$\n$$P^{*} = \\frac{-0.1 + 0.458257569...}{2}$$\n$$P^{*} = \\frac{0.358257569...}{2}$$\n$$P^{*} = 0.17912878... \\ \\mathrm{m}^2$$\n四舍五入到四位有效数字，稳态后验方差为 $0.1791\\ \\mathrm{m}^2$。",
            "answer": "$$\n\\boxed{0.1791}\n$$"
        },
        {
            "introduction": "在掌握了单变量时间序列的滤波后，下一个挑战是将这些概念扩展到空间多维度的环境模型中。本练习模拟了一个典型的三维变分（3D-Var）同化场景，即利用一个聚合观测来校正包含多个网格单元的模型状态 。此实践的核心在于理解背景误差协方差矩阵 $B$ 的关键作用：它描述了模型状态变量之间的空间相关性，并使得单个观测的信息能够被合理地分配到多个相关的状态分量上，从而产生一个空间上协调一致的分析场。",
            "id": "3804738",
            "problem": "一个粗分辨率的微波辐射计观测一个像素的总地表水当量，该像素包含两个子网格单元。设环境模型状态为二维向量 $x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix}$，其中 $x_{1}$ 和 $x_{2}$ 表示两个子网格单元的地表水当量，单位为千克每平方米 ($\\mathrm{kg}\\ \\mathrm{m}^{-2}$)。一个背景估计值 $x^{b} = \\begin{pmatrix} 10 \\\\ 5 \\end{pmatrix}$ 已知，其背景误差协方差矩阵为\n$$\nB = \\begin{pmatrix}\n4  2 \\\\\n2  3\n\\end{pmatrix},\n$$\n矩阵元素的单位为 $\\mathrm{kg}^{2}\\ \\mathrm{m}^{-4}$。辐射计的观测算子是返回像素总和的线性映射 $H = \\begin{pmatrix} 1  1 \\end{pmatrix}$，单个观测值为 $y = 28$，单位为 $\\mathrm{kg}\\ \\mathrm{m}^{-2}$。观测误差方差为 $R = 1$，单位为 $\\mathrm{kg}^{2}\\ \\mathrm{m}^{-4}$。\n\n使用三维变分 (3D-Var) 数据同化的贝叶斯线性高斯框架，从高斯先验、线性观测模型和二次代价函数的定义出发，推导分析增量 $\\delta x^{a} = x^{a} - x^{b}$ 和分析误差协方差 $A$。然后计算由下式定义的总误差方差的减少分数\n$$\n\\text{reduction} \\;=\\; \\frac{\\operatorname{tr}(B) - \\operatorname{tr}(A)}{\\operatorname{tr}(B)},\n$$\n其中 $\\operatorname{tr}(\\cdot)$ 表示矩阵的迹。\n\n请提供精确值（不要四舍五入）。分析增量分量的单位为 $\\mathrm{kg}\\ \\mathrm{m}^{-2}$，方差减少量以小数或不带百分号的分数表示。您的最终答案必须是一个单行矩阵，按顺序包含 $\\delta x^{a}_{1}$、$\\delta x^{a}_{2}$ 和方差减少量。",
            "solution": "首先将根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤 1：提取给定条件**\n\n从问题陈述中逐字提取的给定条件如下：\n-   模型状态向量：$x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix}$，其中 $x_{1}$ 和 $x_{2}$ 是地表水当量。\n-   背景估计值：$x^{b} = \\begin{pmatrix} 10 \\\\ 5 \\end{pmatrix}$，单位为 $\\mathrm{kg}\\ \\mathrm{m}^{-2}$。\n-   背景误差协方差矩阵：$B = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix}$，单位为 $\\mathrm{kg}^{2}\\ \\mathrm{m}^{-4}$。\n-   观测算子：$H = \\begin{pmatrix} 1  1 \\end{pmatrix}$。\n-   观测值：$y = 28$，单位为 $\\mathrm{kg}\\ \\mathrm{m}^{-2}$。\n-   观测误差方差：$R = 1$，单位为 $\\mathrm{kg}^{2}\\ \\mathrm{m}^{-4}$。\n-   要求输出：分析增量 $\\delta x^{a} = x^{a} - x^{b}$，分析误差协方差 $A$，以及总误差方差的减少分数 $\\frac{\\operatorname{tr}(B) - \\operatorname{tr}(A)}{\\operatorname{tr}(B)}$。\n\n**步骤 2：使用提取的给定条件进行验证**\n\n对问题的有效性进行评估：\n-   **科学依据**：该问题描述了三维变分 (3D-Var) 数据同化的一个标准应用，这是环境建模和地球科学中的一项基本技术。所涉及的量、单位和数学框架都是标准的，并且在科学上是正确的。\n-   **适定性**：该问题是适定的。所有必要的输入（$x^b$、$B$、$H$、$y$、$R$）都已提供。背景误差协方差矩阵 $B$ 是对称的，具有正行列式（$\\det(B) = 4 \\times 3 - 2 \\times 2 = 8 > 0$）和正对角元素，因此是正定的。观测误差方差 $R=1$ 也是正的。这些条件确保了 3D-Var 代价函数是一个严格凸的二次函数，从而保证了存在唯一的最小值，对应于唯一的分析状态 $x^a$。\n-   **客观性**：问题陈述使用了精确、定量且无偏见的语言。\n-   **完整性**：问题提供了推导所求量所需的全部信息。没有缺失的参数或矛盾的约束。\n\n**步骤 3：结论与行动**\n\n该问题是有效的。它是数据同化领域一个标准的、定义明确的问题。我将继续提供完整的解决方案。\n\n###\n### 推导与求解\n\n三维变分 (3D-Var) 数据同化的核心是最小化一个代价函数 $J(x)$，该函数平衡了与背景估计值 $x^b$ 的距离和与观测值 $y$ 的距离，并由它们各自的误差协方差进行加权。代价函数定义为：\n$$\nJ(x) = J_b(x) + J_o(x) = \\frac{1}{2}(x - x^b)^T B^{-1} (x - x^b) + \\frac{1}{2}(y - Hx)^T R^{-1} (y - Hx)\n$$\n分析状态 $x^a$ 是使 $J(x)$ 最小化的状态向量 $x$。为了找到这个最小值，我们计算 $J(x)$ 关于 $x$ 的梯度并将其设为零。使用标准矩阵微积分法则：\n$$\n\\nabla_x J(x) = B^{-1}(x - x^b) - H^T R^{-1}(y - Hx)\n$$\n将 $x = x^a$ 处的梯度设为零：\n$$\n\\nabla_x J(x^a) = B^{-1}(x^a - x^b) - H^T R^{-1}(y - Hx^a) = 0\n$$\n问题要求的是分析增量 $\\delta x^a = x^a - x^b$。将 $x^a = x^b + \\delta x^a$ 代入方程：\n$$\nB^{-1}\\delta x^a - H^T R^{-1}(y - H(x^b + \\delta x^a)) = 0\n$$\n$$\nB^{-1}\\delta x^a - H^T R^{-1}(y - Hx^b - H\\delta x^a) = 0\n$$\n重新整理各项以求解 $\\delta x^a$：\n$$\n(B^{-1} + H^T R^{-1} H)\\delta x^a = H^T R^{-1}(y - Hx^b)\n$$\n一个代数上等价且通常在计算上更方便的公式是通过卡尔曼增益矩阵 $K$ 来表示。分析增量由下式给出：\n$$\n\\delta x^a = K (y - Hx^b)\n$$\n其中卡尔曼增益 $K$ 定义为：\n$$\nK = B H^T (H B H^T + R)^{-1}\n$$\n相应的分析误差协方差矩阵 $A$ 由下式给出：\n$$\nA = (I - KH)B\n$$\n我们现在使用所提供的数据计算这些量。\n\n首先，我们计算新息（也称为离差）$d = y - Hx^b$：\n$$\nHx^b = \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} 10 \\\\ 5 \\end{pmatrix} = 1 \\cdot 10 + 1 \\cdot 5 = 15\n$$\n$$\nd = y - Hx^b = 28 - 15 = 13\n$$\n\n接下来，我们计算卡尔曼增益 $K$：\n观测算子的转置为 $H^T = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。\n我们计算 $B H^T$ 项：\n$$\nB H^T = \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 4+2 \\\\ 2+3 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 5 \\end{pmatrix}\n$$\n现在我们计算 $H B H^T$ 项：\n$$\nH B H^T = \\begin{pmatrix} 1  1 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 5 \\end{pmatrix} = 6+5 = 11\n$$\n由于观测是标量，所以这个量也是一个标量。现在我们可以计算 $(H B H^T + R)^{-1}$：\n$$\n(H B H^T + R)^{-1} = (11 + 1)^{-1} = 12^{-1} = \\frac{1}{12}\n$$\n最后，我们可以计算卡尔曼增益矩阵 $K$：\n$$\nK = B H^T (H B H^T + R)^{-1} = \\begin{pmatrix} 6 \\\\ 5 \\end{pmatrix} \\left( \\frac{1}{12} \\right) = \\begin{pmatrix} 6/12 \\\\ 5/12 \\end{pmatrix} = \\begin{pmatrix} 1/2 \\\\ 5/12 \\end{pmatrix}\n$$\n\n利用卡尔曼增益和新息，我们计算分析增量 $\\delta x^a$：\n$$\n\\delta x^a = K d = \\begin{pmatrix} 1/2 \\\\ 5/12 \\end{pmatrix} (13) = \\begin{pmatrix} 13/2 \\\\ 65/12 \\end{pmatrix}\n$$\n因此，分析增量的分量为 $\\delta x^a_1 = \\frac{13}{2}$ 和 $\\delta x^a_2 = \\frac{65}{12}$。\n\n接下来，我们推导并计算分析误差协方差矩阵 $A$：\n$$\nA = (I - KH)B\n$$\n首先，我们计算乘积 $KH$：\n$$\nKH = \\begin{pmatrix} 1/2 \\\\ 5/12 \\end{pmatrix} \\begin{pmatrix} 1  1 \\end{pmatrix} = \\begin{pmatrix} 1/2  1/2 \\\\ 5/12  5/12 \\end{pmatrix}\n$$\n接下来，我们计算 $I - KH$：\n$$\nI - KH = \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} - \\begin{pmatrix} 1/2  1/2 \\\\ 5/12  5/12 \\end{pmatrix} = \\begin{pmatrix} 1 - 1/2  -1/2 \\\\ -5/12  1 - 5/12 \\end{pmatrix} = \\begin{pmatrix} 1/2  -1/2 \\\\ -5/12  7/12 \\end{pmatrix}\n$$\n最后，我们通过右乘 $B$ 来计算 $A$：\n$$\nA = (I - KH)B = \\begin{pmatrix} 1/2  -1/2 \\\\ -5/12  7/12 \\end{pmatrix} \\begin{pmatrix} 4  2 \\\\ 2  3 \\end{pmatrix}\n$$\n$$\nA = \\begin{pmatrix}\n\\frac{1}{2}(4) - \\frac{1}{2}(2)  \\frac{1}{2}(2) - \\frac{1}{2}(3) \\\\\n-\\frac{5}{12}(4) + \\frac{7}{12}(2)  -\\frac{5}{12}(2) + \\frac{7}{12}(3)\n\\end{pmatrix}\n= \\begin{pmatrix}\n2 - 1  1 - \\frac{3}{2} \\\\\n-\\frac{20}{12} + \\frac{14}{12}  -\\frac{10}{12} + \\frac{21}{12}\n\\end{pmatrix}\n= \\begin{pmatrix}\n1  -1/2 \\\\\n-6/12  11/12\n\\end{pmatrix}\n$$\n简化非对角项：\n$$\nA = \\begin{pmatrix} 1  -1/2 \\\\ -1/2  11/12 \\end{pmatrix}\n$$\n\n最后一步是计算总误差方差的减少分数。总方差是误差协方差矩阵的迹。\n总背景误差方差是 $\\operatorname{tr}(B)$：\n$$\n\\operatorname{tr}(B) = 4 + 3 = 7\n$$\n总分析误差方差是 $\\operatorname{tr}(A)$：\n$$\n\\operatorname{tr}(A) = 1 + \\frac{11}{12} = \\frac{12}{12} + \\frac{11}{12} = \\frac{23}{12}\n$$\n总误差方差的减少分数为：\n$$\n\\text{reduction} = \\frac{\\operatorname{tr}(B) - \\operatorname{tr}(A)}{\\operatorname{tr}(B)} = \\frac{7 - \\frac{23}{12}}{7} = \\frac{\\frac{84 - 23}{12}}{7} = \\frac{61/12}{7} = \\frac{61}{12 \\times 7} = \\frac{61}{84}\n$$\n需要报告的量是 $\\delta x_1^a = \\frac{13}{2}$、$\\delta x_2^a = \\frac{65}{12}$ 和方差减少量 $\\frac{61}{84}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{13}{2}  \\frac{65}{12}  \\frac{61}{84} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最终，我们将时间和空间维度结合起来，探索四维变分（4D-Var）数据同化的强大功能，这是许多现代业务化预报系统的核心。这个练习设定在一个简化的线性平流模型上，要求你寻找一个最优的初始状态，使得模型从该状态出发所产生的轨迹在整个时间窗口内与观测数据最为吻合 。通过解决这个优化问题，你将直观地体会到模型动力学 $M$ 如何充当连接不同时刻状态的“桥梁”，以及如何利用未来的观测信息来修正当前的初始条件，从而实现对整个系统演化过程的优化估计。",
            "id": "3804743",
            "problem": "考虑一个一维、周期性的线性平流模型，该模型建立在具有 $N$ 个格点的离散网格上，其状态向量为 $\\mathbf{x}_k \\in \\mathbb{R}^N$（在离散时间 $t_k$，$k \\in \\{0,1,2\\}$ 时）。其动力学是确定性和线性的，具有一个恒定的库朗数 (Courant number) $\\alpha \\in [0,1]$，由下式给出：\n$$\n\\mathbf{x}_{k+1} = \\mathbf{M}\\,\\mathbf{x}_k, \\quad \\text{其中} \\quad \\mathbf{M} = (1-\\alpha)\\,\\mathbf{I} + \\alpha\\,\\mathbf{S}.\n$$\n此处，$\\mathbf{I}$ 是 $N \\times N$ 的单位矩阵，$\\mathbf{S}$ 是 $N \\times N$ 的循环右移矩阵，其定义为 $(\\mathbf{S}\\mathbf{x})_i = x_{(i-1)\\bmod N}$（对于每个分量索引 $i \\in \\{0,\\dots,N-1\\}$），这强制执行了周期性边界条件。初始状态 $\\mathbf{x}_0$ 的背景（先验）分布是高斯分布，其均值为 $\\mathbf{x}_b \\in \\mathbb{R}^N$，协方差为 $\\mathbf{B} = \\sigma_b^2\\,\\mathbf{I}$，其中 $\\sigma_b^2 > 0$。在时间 $t_2$ 有一个标量观测值 $y \\in \\mathbb{R}$，它根据以下公式测量模型在网格索引 $j \\in \\{0,\\dots,N-1\\}$ 处的状态：\n$$\ny = \\mathbf{H}\\,\\mathbf{x}_2 + \\varepsilon, \\quad \\varepsilon \\sim \\mathcal{N}(0, \\sigma_o^2),\n$$\n其中 $\\mathbf{H}$ 是一个 $1 \\times N$ 的观测算子，用于提取索引 $j$ 处的分量，即 $\\mathbf{H} = \\mathbf{e}_j^\\top$（$\\mathbf{e}_j$ 是 $\\mathbb{R}^N$ 中的第 $j$ 个标准基向量），$\\sigma_o^2 > 0$ 是观测误差方差。四维变分同化 (4D-Var) 分析旨在给定 $\\mathbf{x}_b$ 和 $y$ 的条件下，寻求初始状态 $\\mathbf{x}_0$ 的最大后验估计 $\\mathbf{x}_0^a$，然后得到分析轨迹 $\\mathbf{x}_1^a = \\mathbf{M}\\,\\mathbf{x}_0^a$ 和 $\\mathbf{x}_2^a = \\mathbf{M}\\,\\mathbf{x}_1^a$。\n\n请从上述确定性线性模型中的线性高斯先验和似然的定义出发，并使用由 $\\alpha$、$\\mathbf{I}$ 和 $\\mathbf{S}$ 按规定方式构造的周期性线性平流算子 $\\mathbf{M}$，推导出分析初始状态 $\\mathbf{x}_0^a$ 的表达式，并为以下每个独立的测试案例计算分析后的初始状态和轨迹 $(\\mathbf{x}_0^a,\\mathbf{x}_1^a,\\mathbf{x}_2^a)$。所有数值输入都是无量纲的，不需要物理单位。不涉及角度。所有输出均以十进制浮点数表示。\n\n测试套件定义（每个案例指定 $(N,\\alpha,\\mathbf{x}_b,\\sigma_b^2,j,y,\\sigma_o^2)$）：\n- 案例 1：$N=5$, $\\alpha=0.4$, $\\mathbf{x}_b = (0.2, 0.0, 1.0, 0.0, 0.0)^\\top$, $\\sigma_b^2 = 0.09$, $j=2$, $y=0.7$, $\\sigma_o^2=0.01$。\n- 案例 2：$N=5$, $\\alpha=0.0$, $\\mathbf{x}_b = (0.0, 0.5, 0.0, 0.0, 0.0)^\\top$, $\\sigma_b^2 = 0.04$, $j=1$, $y=0.6$, $\\sigma_o^2=0.01$。\n- 案例 3：$N=5$, $\\alpha=1.0$, $\\mathbf{x}_b = (0.0, 0.0, 0.0, 1.0, 0.0)^\\top$, $\\sigma_b^2 = 0.09$, $j=0$, $y=0.3$, $\\sigma_o^2=0.04$。\n- 案例 4：$N=5$, $\\alpha=0.6$, $\\mathbf{x}_b = (0.0, 0.0, 0.2, 0.0, 0.8)^\\top$, $\\sigma_b^2 = 0.16$, $j=4$, $y=0.1$, $\\sigma_o^2=25.0$。\n\n您的程序必须为每个案例构造 $\\mathbf{S}$ 和 $\\mathbf{M}$，计算 $\\mathbf{M}^2$，使用适当的线性高斯最大后验条件推导并求解 $\\mathbf{x}_0^a$，然后计算 $\\mathbf{x}_1^a$ 和 $\\mathbf{x}_2^a$。每个案例的最终输出必须是一个长度为 $3N$ 的列表，该列表由按顺序连接的 $\\mathbf{x}_0^a$、$\\mathbf{x}_1^a$ 和 $\\mathbf{x}_2^a$ 组成，其中每个条目都格式化为小数点后保留六位的小数浮点数。\n\n最终输出格式：您的程序应生成单行输出，其中包含所有四个案例的结果，格式为一个逗号分隔的 Python 风格的列表的列表，例如 $[r_1,r_2,r_3,r_4]$，其中每个 $r_i$ 是案例 $i$ 的长度为 $3N$ 的列表，并且每个 $r_i$ 中的每个标量都打印为小数点后恰好有六位数字。",
            "solution": "用户希望我为一个一维线性平流模型解决一个 4D-Var 数据同化问题。\n\n### 第 1 步：问题验证\n\n我将首先验证问题陈述。\n\n#### 第 1.1 步：提取给定信息\n\n-   **模型**：一维、周期性、离散网格上的线性平流。\n-   **网格点**：$N$。\n-   **状态向量**：在离散时间 $t_k$，$k \\in \\{0, 1, 2\\}$ 时的 $\\mathbf{x}_k \\in \\mathbb{R}^N$。\n-   **模型动力学**：$\\mathbf{x}_{k+1} = \\mathbf{M}\\,\\mathbf{x}_k$。\n-   **模型算子**：$\\mathbf{M} = (1-\\alpha)\\,\\mathbf{I} + \\alpha\\,\\mathbf{S}$，其中 $\\alpha \\in [0,1]$ 是库朗数。\n-   **单位矩阵**：$\\mathbf{I}$ 是 $N \\times N$ 的单位矩阵。\n-   **移位矩阵**：$\\mathbf{S}$ 是 $N \\times N$ 的循环右移矩阵，定义为 $(\\mathbf{S}\\mathbf{x})_i = x_{(i-1)\\bmod N}$（对于分量索引 $i \\in \\{0,\\dots,N-1\\}$）。\n-   **先验分布**：初始状态 $\\mathbf{x}_0$ 具有高斯先验，$\\mathbf{x}_0 \\sim \\mathcal{N}(\\mathbf{x}_b, \\mathbf{B})$。\n-   **背景状态（先验均值）**：$\\mathbf{x}_b \\in \\mathbb{R}^N$。\n-   **背景误差协方差**：$\\mathbf{B} = \\sigma_b^2\\,\\mathbf{I}$，其中 $\\sigma_b^2 > 0$。\n-   **观测**：在时间 $t_2$ 有一个标量观测值 $y \\in \\mathbb{R}$。\n-   **观测方程**：$y = \\mathbf{H}\\,\\mathbf{x}_2 + \\varepsilon$。\n-   **观测误差**：$\\varepsilon \\sim \\mathcal{N}(0, \\sigma_o^2)$，其中 $\\sigma_o^2 > 0$。\n-   **观测算子**：$\\mathbf{H} = \\mathbf{e}_j^\\top$，一个 $1 \\times N$ 的行向量，用于选择网格索引 $j \\in \\{0,\\dots,N-1\\}$ 处的分量。\n-   **目标**：找到初始状态的最大后验 (MAP) 估计 $\\mathbf{x}_0^a$，以及相应的分析轨迹 $\\mathbf{x}_1^a = \\mathbf{M}\\,\\mathbf{x}_0^a$ 和 $\\mathbf{x}_2^a = \\mathbf{M}\\,\\mathbf{x}_1^a$。\n-   **测试案例**：\n    1.  $(N,\\alpha,\\mathbf{x}_b,\\sigma_b^2,j,y,\\sigma_o^2) = (5, 0.4, (0.2, 0.0, 1.0, 0.0, 0.0)^\\top, 0.09, 2, 0.7, 0.01)$。\n    2.  $(N,\\alpha,\\mathbf{x}_b,\\sigma_b^2,j,y,\\sigma_o^2) = (5, 0.0, (0.0, 0.5, 0.0, 0.0, 0.0)^\\top, 0.04, 1, 0.6, 0.01)$。\n    3.  $(N,\\alpha,\\mathbf{x}_b,\\sigma_b^2,j,y,\\sigma_o^2) = (5, 1.0, (0.0, 0.0, 0.0, 1.0, 0.0)^\\top, 0.09, 0, 0.3, 0.04)$。\n    4.  $(N,\\alpha,\\mathbf{x}_b,\\sigma_b^2,j,y,\\sigma_o^2) = (5, 0.6, (0.0, 0.0, 0.2, 0.0, 0.8)^\\top, 0.16, 4, 0.1, 25.0)$。\n\n#### 第 1.2 步：使用提取的给定信息进行验证\n\n-   **科学基础**：该问题描述了一个线性系统的 4D-Var 数据同化问题。模型 $\\mathbf{x}_{k+1} = ((1-\\alpha)\\mathbf{I} + \\alpha\\mathbf{S})\\mathbf{x}_k$ 是线性平流方程的标准一阶迎风格式，这是偏微分方程数值方法中的一个基本概念。4D-Var 框架是现代数据同化的基石，基于贝叶斯概率论。使用高斯分布表示误差是标准做法。所有方面都牢固地建立在成熟的数学和计算科学之上。\n-   **适定性**：该问题寻求最大后验估计。由于模型是线性的，且先验和观测误差分布是高斯的，因此后验分布也是高斯的。需要最小化的成本函数是二次且凸的，保证了唯一最小值的存在。因此，存在一个唯一的、稳定的、有意义的解。\n-   **客观性**：该问题完全由数学方程和数值定义。没有主观、模糊或基于意见的陈述。\n-   **完整性和一致性**：所有必要的参数（$N, \\alpha, \\mathbf{x}_b, \\sigma_b^2, j, y, \\sigma_o^2$）和定义（$\\mathbf{M}, \\mathbf{S}, \\mathbf{H}$）都已提供。没有矛盾之处。\n\n#### 第 1.3 步：结论与行动\n\n问题是有效的。我将继续进行求解。\n\n### 第 2 步：求解推导\n\n目标是找到在给定背景状态 $\\mathbf{x}_b$ 和观测值 $y$ 的情况下，最大化后验概率密度的初始状态 $\\mathbf{x}_0^a$。对于高斯分布，这等同于最小化 4D-Var 成本函数 $J(\\mathbf{x}_0)$：\n$$\nJ(\\mathbf{x}_0) = J_b(\\mathbf{x}_0) + J_o(\\mathbf{x}_0) = \\frac{1}{2} (\\mathbf{x}_0 - \\mathbf{x}_b)^\\top \\mathbf{B}^{-1} (\\mathbf{x}_0 - \\mathbf{x}_b) + \\frac{1}{2} (d(\\mathbf{x}_0))^\\top \\mathbf{R}^{-1} (d(\\mathbf{x}_0))\n$$\n这里，新息 $d(\\mathbf{x}_0)$ 是观测值 $y$ 与模型对观测值的预测之间的差值。状态从初始状态 $\\mathbf{x}_0$ 演变两个时间步长到达观测时间 $t_2$：\n$$\n\\mathbf{x}_2 = \\mathbf{M} \\mathbf{x}_1 = \\mathbf{M} (\\mathbf{M} \\mathbf{x}_0) = \\mathbf{M}^2 \\mathbf{x}_0\n$$\n然后将观测算子 $\\mathbf{H}$ 应用于 $\\mathbf{x}_2$。因此，模型对观测的预测是 $\\mathbf{H} \\mathbf{M}^2 \\mathbf{x}_0$。新息是一个标量：\n$$\nd(\\mathbf{x}_0) = y - \\mathbf{H} \\mathbf{M}^2 \\mathbf{x}_0\n$$\n背景和观测误差协方差分别给定为 $\\mathbf{B} = \\sigma_b^2 \\mathbf{I}$ 和 $\\mathbf{R} = \\sigma_o^2$（一个标量），所以它们的逆矩阵是 $\\mathbf{B}^{-1} = \\frac{1}{\\sigma_b^2} \\mathbf{I}$ 和 $\\mathbf{R}^{-1} = \\frac{1}{\\sigma_o^2}$。\n成本函数变为：\n$$\nJ(\\mathbf{x}_0) = \\frac{1}{2\\sigma_b^2} \\|\\mathbf{x}_0 - \\mathbf{x}_b\\|^2_2 + \\frac{1}{2\\sigma_o^2} (y - \\mathbf{H} \\mathbf{M}^2 \\mathbf{x}_0)^2\n$$\n为了找到最小值，我们计算 $J$ 相对于 $\\mathbf{x}_0$ 的梯度并将其设为零。令 $\\mathcal{H} = \\mathbf{H} \\mathbf{M}^2$ 为将初始状态映射到观测空间的广义观测算子。$\\mathcal{H}$ 是一个 $1 \\times N$ 的行向量。\n$$\n\\nabla_{\\mathbf{x}_0} J = \\frac{1}{\\sigma_b^2} (\\mathbf{x}_0 - \\mathbf{x}_b) - \\frac{1}{\\sigma_o^2} \\mathcal{H}^\\top (y - \\mathcal{H} \\mathbf{x}_0)\n$$\n设 $\\nabla_{\\mathbf{x}_0} J(\\mathbf{x}_0^a) = \\mathbf{0}$：\n$$\n\\left( \\frac{1}{\\sigma_b^2} \\mathbf{I} + \\frac{1}{\\sigma_o^2} \\mathcal{H}^\\top \\mathcal{H} \\right) \\mathbf{x}_0^a = \\frac{1}{\\sigma_b^2} \\mathbf{x}_b + \\frac{1}{\\sigma_o^2} \\mathcal{H}^\\top y\n$$\n这是一个关于 $\\mathbf{x}_0^a$ 的线性系统。然而，使用等效的卡尔曼增益公式更为高效。分析状态 $\\mathbf{x}_0^a$ 由对背景状态的更新给出：\n$$\n\\mathbf{x}_0^a = \\mathbf{x}_b + \\mathbf{K} (y - \\mathcal{H} \\mathbf{x}_b)\n$$\n项 $(y - \\mathcal{H} \\mathbf{x}_b)$ 是新息，代表来自观测的新信息。卡尔曼增益 $\\mathbf{K}$ 是一个 $N \\times 1$ 的向量，由下式给出：\n$$\n\\mathbf{K} = \\mathbf{B} \\mathcal{H}^\\top (\\mathcal{H} \\mathbf{B} \\mathcal{H}^\\top + \\mathbf{R})^{-1}\n$$\n代入我们特定的协方差矩阵：\n$$\n\\mathbf{K} = (\\sigma_b^2 \\mathbf{I}) \\mathcal{H}^\\top (\\mathcal{H} (\\sigma_b^2 \\mathbf{I}) \\mathcal{H}^\\top + \\sigma_o^2)^{-1}\n$$\n$$\n\\mathbf{K} = \\sigma_b^2 \\mathcal{H}^\\top (\\sigma_b^2 (\\mathcal{H} \\mathcal{H}^\\top) + \\sigma_o^2)^{-1}\n$$\n项 $\\mathcal{H}\\mathcal{H}^\\top$ 是一个标量，是行向量 $\\mathcal{H}$ 与自身的内积，即 $\\|\\mathcal{H}\\|_2^2$。因此，其逆是一个标量的倒数。\n最终算法如下：\n1.  构造矩阵 $\\mathbf{I}$、$\\mathbf{S}$、$\\mathbf{M} = (1-\\alpha)\\mathbf{I} + \\alpha\\mathbf{S}$ 和 $\\mathbf{M}^2$。\n2.  构造广义观测算子 $\\mathcal{H} = \\mathbf{e}_j^\\top \\mathbf{M}^2$。这是 $\\mathbf{M}^2$ 的第 $j$ 行。\n3.  计算增益的标量分母：$s = \\sigma_b^2 (\\mathcal{H} \\mathcal{H}^\\top) + \\sigma_o^2$。\n4.  计算增益向量：$\\mathbf{K} = \\frac{\\sigma_b^2}{s} \\mathcal{H}^\\top$。\n5.  计算新息：$d = y - \\mathcal{H} \\mathbf{x}_b$。\n6.  计算分析初始状态：$\\mathbf{x}_0^a = \\mathbf{x}_b + \\mathbf{K} d$。\n7.  计算分析轨迹：$\\mathbf{x}_1^a = \\mathbf{M} \\mathbf{x}_0^a$ 和 $\\mathbf{x}_2^a = \\mathbf{M} \\mathbf{x}_1^a$。\n8.  连接并格式化结果。",
            "answer": "```\n[[0.225352,0.010141,0.672535,-0.122394,-0.049296,0.147887,0.006085,0.884507,0.066479,-0.029577,0.091549,0.088732,0.858310,0.221690,0.017746],[0.000000,0.580000,0.000000,0.000000,0.000000,0.000000,0.580000,0.000000,0.000000,0.000000,0.000000,0.580000,0.000000,0.000000,0.000000],[-0.437500,0.000000,0.000000,0.312500,0.000000,0.000000,-0.437500,0.000000,0.000000,0.312500,0.312500,0.000000,-0.437500,0.000000,0.000000],[0.000109,-0.000118,0.199834,0.000212,0.799963,0.000083,0.000018,0.120063,0.000127,0.679710,0.000059,0.000057,0.072076,0.000095,0.407713]]\n```"
        }
    ]
}