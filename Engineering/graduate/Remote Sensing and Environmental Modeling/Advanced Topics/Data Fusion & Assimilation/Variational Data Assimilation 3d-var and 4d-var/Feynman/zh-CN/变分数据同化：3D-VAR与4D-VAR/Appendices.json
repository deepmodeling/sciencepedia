{
    "hands_on_practices": [
        {
            "introduction": "变分资料同化的核心在于，在给定预报（背景场）和新的测量（观测）的情况下，寻找最可能的状态。在这个基础练习中 ，你将从贝叶斯原理出发，为最简单的情形——单个状态变量——推导其解析解。这个过程将揭示3D-Var如何通过各自的不确定性来对信息进行加权，从而实现最优融合。",
            "id": "3864732",
            "problem": "考虑一个单网格单元的环境状态变量 $x$，它表示遥感和环境建模系统中分析时刻的柱平均示踪剂浓度。您正在使用一次卫星观测执行三维变分 (3D-Var) 数据同化，这是四维变分 (4D-Var) 数据同化的时间无关极限。假设一个线性观测算子 $H=1$，因此观测模型为 $y=Hx+\\epsilon$，其中 $\\epsilon$ 是附加的零均值高斯仪器噪声。先验（背景）状态被建模为一个均值为 $x_b$、方差为 $B$ 的高斯随机变量。观测误差是高斯分布的，方差为 $R$。在这些假设下，最大后验 (MAP) 估计等于从线性高斯模型的贝叶斯定理推导出的二次 3D-Var 代价函数的最小值点。\n\n从高斯先验 $p(x)$ 和高斯似然 $p(y\\mid x)$ 的定义出发，并使用贝叶斯定理构建后验 $p(x\\mid y)$，推导当 $H=1$ 时的标量 MAP 估计量 $x_a$ 和相关的分析方差 $\\sigma_a^2$。然后，对于 $x_b=2$，$B=4$，$y=5$，$H=1$ 和 $R=1$ 的情况，计算您推导出的表达式的值。\n\n将最终答案以单行矩阵 $\\begin{pmatrix}x_a  \\sigma_a^2\\end{pmatrix}$ 的形式报告。数值需为精确值，无需四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、适定性、客观性，并包含获得唯一解所需的所有信息。它代表了贝叶斯推断在数据同化背景下的标准应用。\n\n目标是推导最大后验 (MAP) 估计，记为分析状态 $x_a$，以及相应的分析方差 $\\sigma_a^2$。推导从贝叶斯定理开始，该定理将给定观测 $y$ 的状态 $x$ 的后验概率与状态的先验概率以及给定状态的观测似然联系起来：\n\n$$p(x \\mid y) = \\frac{p(y \\mid x) p(x)}{p(y)}$$\n\n项 $p(y)$ 是一个归一化常数，与 $x$ 无关。因此，为了找到使后验概率最大化的 $x$ 值，我们可以写成：\n\n$$p(x \\mid y) \\propto p(y \\mid x) p(x)$$\n\n问题指定状态变量 $x$ 的先验分布为高斯分布，均值为 $x_b$（背景状态），方差为 $B$。其概率密度函数 (PDF) 为：\n\n$$p(x) = \\frac{1}{\\sqrt{2\\pi B}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x_b)^2}{B}\\right)$$\n\n观测模型给定为 $y = Hx + \\epsilon$，其中 $H=1$，观测误差 $\\epsilon$ 服从均值为零、方差为 $R$ 的高斯分布。这就将似然函数 $p(y \\mid x)$ 定义为一个以 $Hx=x$ 为中心、方差为 $R$ 的关于 $y$ 的高斯分布：\n\n$$p(y \\mid x) = \\frac{1}{\\sqrt{2\\pi R}} \\exp\\left(-\\frac{1}{2} \\frac{(y - x)^2}{R}\\right)$$\n\n将先验和似然的 PDF 代入后验的比例关系中，得到：\n\n$$p(x \\mid y) \\propto \\left[ \\frac{1}{\\sqrt{2\\pi R}} \\exp\\left(-\\frac{1}{2} \\frac{(y - x)^2}{R}\\right) \\right] \\left[ \\frac{1}{\\sqrt{2\\pi B}} \\exp\\left(-\\frac{1}{2} \\frac{(x - x_b)^2}{B}\\right) \\right]$$\n\n合并指数项并忽略常数系数，我们得到：\n\n$$p(x \\mid y) \\propto \\exp\\left(-\\frac{1}{2} \\left[ \\frac{(x - x_b)^2}{B} + \\frac{(y - x)^2}{R} \\right]\\right)$$\n\nMAP 估计 $x_a$ 是使这个后验概率最大化的 $x$ 值。最大化 $p(x \\mid y)$ 等价于最小化其自然对数的负数。这定义了 3D-Var 代价函数 $J(x)$：\n\n$$J(x) = \\frac{1}{2} \\left[ \\frac{(x - x_b)^2}{B} + \\frac{(y - x)^2}{R} \\right]$$\n\n为了找到 $J(x)$ 的最小值，我们计算它关于 $x$ 的一阶导数并令其为零：\n\n$$\\frac{dJ}{dx} = \\frac{1}{2} \\left[ \\frac{2(x - x_b)}{B} + \\frac{2(y - x)(-1)}{R} \\right] = \\frac{x - x_b}{B} - \\frac{y - x}{R}$$\n\n在 $x = x_a$ 处将导数设为零：\n\n$$\\frac{x_a - x_b}{B} - \\frac{y - x_a}{R} = 0$$\n\n$$\\frac{x_a - x_b}{B} = \\frac{y - x_a}{R}$$\n\n求解 $x_a$：\n\n$$R(x_a - x_b) = B(y - x_a)$$\n$$Rx_a - Rx_b = By - Bx_a$$\n$$Rx_a + Bx_a = By + Rx_b$$\n$$x_a(R + B) = By + Rx_b$$\n\n这就得出了分析状态 $x_a$ 的 MAP 估计量：\n\n$$x_a = \\frac{By + Rx_b}{B+R}$$\n\n后验分布 $p(x \\mid y)$ 本身也是高斯分布，因为它与两个高斯函数的乘积成正比。这个后验分布的方差就是分析方差 $\\sigma_a^2$。在变分数据同化中，分析（后验）协方差是代价函数在最小值点处的海森矩阵的逆。对于这个标量问题，分析方差是 $J(x)$ 的二阶导数的倒数。\n\n代价函数的二阶导数是：\n\n$$\\frac{d^2 J}{dx^2} = \\frac{d}{dx} \\left( \\frac{x - x_b}{B} - \\frac{y - x}{R} \\right) = \\frac{1}{B} + \\frac{1}{R}$$\n\n分析方差 $\\sigma_a^2$ 是这个表达式的倒数：\n\n$$\\sigma_a^2 = \\left(\\frac{d^2 J}{dx^2}\\right)^{-1} = \\left(\\frac{1}{B} + \\frac{1}{R}\\right)^{-1} = \\left(\\frac{R + B}{BR}\\right)^{-1} = \\frac{BR}{B+R}$$\n\n现在我们使用给定的数值来计算这些表达式的值：$x_b=2$，$B=4$，$y=5$ 和 $R=1$。\n\n分析状态 $x_a$ 是：\n\n$$x_a = \\frac{(4)(5) + (1)(2)}{4+1} = \\frac{20 + 2}{5} = \\frac{22}{5}$$\n\n分析方差 $\\sigma_a^2$ 是：\n\n$$\\sigma_a^2 = \\frac{(4)(1)}{4+1} = \\frac{4}{5}$$\n\n最终答案是数对 $(x_a, \\sigma_a^2)$，以行矩阵的形式呈现。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{22}{5}  \\frac{4}{5} \\end{pmatrix}}$$"
        },
        {
            "introduction": "真实世界中的环境系统本质上是非线性的，这是简单线性模型无法捕捉的挑战。增量4D-Var通过在当前状态估计附近对复杂模型进行线性化来解决这个问题，这个过程被称为切线性近似。本练习  让你能够探索这一核心技术，计算由此产生的线性化误差，并应用一个实用准则来判断线性近似在特定情况下是否可以接受。",
            "id": "3864651",
            "problem": "在增量三维变分同化（3D-Var）和四维变分同化（4D-Var）中，观测算子围绕当前迭代点进行线性化，以构建内循环的二次子问题。考虑一个标量状态变量 $x$（无量纲）和一个标量观测算子 $\\mathcal{H}(x)$，它代表一种简化的非线性，类似于遥感辐射模型中的饱和现象。设 $\\mathcal{H}(x) = \\sin(x)$，其中角度以弧度为单位。在当前迭代点 $x^{i} = 0.2$ 处，假设真实状态有一个已知的增量 $\\delta x = 0.5$，因此真实状态为 $x^{i} + \\delta x$。使用基本原理（泰勒定理和变分资料同化中使用的切线性近似的定义），计算观测算子在 $x^{i}$ 附近对增量 $\\delta x$ 的绝对线性化误差。假设观测误差标准差为 $\\sigma_{o} = 0.05$（无量纲），并使用“如果绝对线性化误差小于 $\\sigma_{o}$，则切线性假设是可接受的”这一准则来评估其可接受性。将您的最终答案（绝对线性化误差）四舍五入至四位有效数字，并以无量纲单位表示。",
            "solution": "对问题陈述的有效性进行分析。\n\n**步骤1：提取已知条件**\n- 标量状态变量：$x$（无量纲）\n- 标量观测算子：$\\mathcal{H}(x) = \\sin(x)$\n- 状态变量的当前迭代值：$x^{i} = 0.2$\n- 状态变量的增量：$\\delta x = 0.5$\n- 真实状态：$x^{i} + \\delta x$\n- 观测误差标准差：$\\sigma_{o} = 0.05$\n- 切线性假设可接受的准则：绝对线性化误差 $ < \\sigma_{o}$\n- 要求计算：计算绝对线性化误差并四舍五入至四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题基于变分资料同化的基本原理，特别是使用泰勒级数展开对非线性算子进行线性化，这构成了增量3D-Var和4D-Var中切线性模型的基础。算子 $\\mathcal{H}(x) = \\sin(x)$ 是一个用于教学目的的简单、光滑、非线性函数的标准示例。\n- **适定性**：该问题是适定的。它提供了计算唯一数值解所需的所有数据和定义。目标陈述清晰。\n- **客观性**：该问题以精确、客观和定量的术语表述。\n\n**步骤3：结论与行动**\n问题被认为是有效的，因为它是科学合理的、自洽的且适定的。将推导解答。\n\n核心任务是计算绝对线性化误差。线性化误差定义为在真实状态下评估的完整非线性观测算子与其在当前迭代点展开的切线性近似之间的差值。\n\n设真实状态为 $x_{t} = x^{i} + \\delta x$。真实观测值为 $\\mathcal{H}(x_{t}) = \\mathcal{H}(x^{i} + \\delta x)$。\n\n$\\mathcal{H}(x)$ 在点 $x^{i}$ 附近的切线性近似由一阶泰勒展开给出：\n$$ \\mathcal{H}(x^{i} + \\delta x) \\approx \\mathcal{H}(x^{i}) + \\mathbf{H} \\delta x $$\n其中 $\\mathbf{H}$ 是切线性算子，定义为 $\\mathcal{H}$ 对 $x$ 的导数，在线性化点 $x^{i}$ 处求值：\n$$ \\mathbf{H} = \\frac{d\\mathcal{H}}{dx}\\bigg|_{x=x^{i}} $$\n线性化误差，我们记为 $\\epsilon_{L}$，是真实值与近似值之间的差：\n$$ \\epsilon_{L} = \\mathcal{H}(x^{i} + \\delta x) - \\left( \\mathcal{H}(x^{i}) + \\mathbf{H} \\delta x \\right) $$\n问题要求的是绝对线性化误差 $|\\epsilon_{L}|$。\n\n我们已知具体的观测算子为 $\\mathcal{H}(x) = \\sin(x)$。\n首先，我们计算切线性算子 $\\mathbf{H}$：\n$$ \\mathbf{H} = \\frac{d}{dx}(\\sin(x))\\bigg|_{x=x^{i}} = \\cos(x^{i}) $$\n代入给定值 $x^{i} = 0.2$：\n$$ \\mathbf{H} = \\cos(0.2) $$\n现在，我们可以使用给定的算子和值写出线性化误差 $\\epsilon_{L}$ 的表达式：\n$$ \\epsilon_{L} = \\sin(x^{i} + \\delta x) - \\left( \\sin(x^{i}) + \\cos(x^{i}) \\delta x \\right) $$\n代入数值 $x^{i} = 0.2$ 和 $\\delta x = 0.5$：\n$$ \\epsilon_{L} = \\sin(0.2 + 0.5) - \\left( \\sin(0.2) + \\cos(0.2) \\times 0.5 \\right) $$\n$$ \\epsilon_{L} = \\sin(0.7) - \\sin(0.2) - 0.5 \\cos(0.2) $$\n现在我们计算此表达式的数值，确保计算器处于弧度模式：\n$$ \\sin(0.7) \\approx 0.6442176872 $$\n$$ \\sin(0.2) \\approx 0.1986693308 $$\n$$ \\cos(0.2) \\approx 0.9800665778 $$\n将这些值代入 $\\epsilon_{L}$ 的表达式中：\n$$ \\epsilon_{L} \\approx 0.6442176872 - (0.1986693308 + 0.5 \\times 0.9800665778) $$\n$$ \\epsilon_{L} \\approx 0.6442176872 - (0.1986693308 + 0.4900332889) $$\n$$ \\epsilon_{L} \\approx 0.6442176872 - 0.6887026197 $$\n$$ \\epsilon_{L} \\approx -0.0444849325 $$\n绝对线性化误差是 $\\epsilon_{L}$ 的绝对值：\n$$ |\\epsilon_{L}| = |-0.0444849325| = 0.0444849325 $$\n题目要求将此值四舍五入到四位有效数字。\n$$ |\\epsilon_{L}| \\approx 0.04448 $$\n最后，我们使用给定准则评估切线性假设的可接受性：绝对线性化误差 $< \\sigma_{o}$。\n给定 $\\sigma_{o} = 0.05$。\n我们检查 $0.04448 < 0.05$ 是否成立。此不等式为真。因此，根据所提供的准则，对于此增量和状态，切线性假设是可接受的。\n\n最终答案是按要求四舍五入的计算出的绝对线性化误差。",
            "answer": "$$\\boxed{0.04448}$$"
        },
        {
            "introduction": "标准的3D-Var公式假定观测误差服从高斯分布，这使其对异常值或“坏”数据非常敏感。为了构建一个更具韧性的系统，我们可以采用稳健的统计方法。本练习  深入探讨了这一高级主题，要求你比较标准的二次代价函数与Huber和 $\\ell_{1}$ 等稳健损失函数。通过此练习，你将了解这些替代方法在处理大的、意外的创新（innovation）时的有效性。",
            "id": "3864653",
            "problem": "考虑一个标量环境状态变量 $x$（例如，整层土壤湿度），使用三维变分（3D-Var）数据同化进行分析。假设背景先验为高斯分布，其均值为 $x_{b}$，方差为 $b$；并有对同一变量的单个卫星观测 $y$，其观测算子为单位算子 $H=1$。令新息为 $d = y - x_{b}$，观测尺度参数为 $\\sigma$（因此归一化残差为 $u = (y - x)/\\sigma$）。分析场 $x_{a}$ 定义为后验代价函数\n$$\nJ(x) = \\frac{1}{2}\\frac{(x - x_{b})^{2}}{b} + \\rho\\!\\left(\\frac{y - x}{\\sigma}\\right),\n$$\n的最小化子，其中 $\\rho$ 是一个损失函数，代表观测误差的负对数似然。考虑 $\\rho$ 的三种选择：\n- 二次损失：$\\rho_{q}(u) = \\frac{1}{2}u^{2}$，\n- Huber 损失：$\\rho_{H}(u) = \\begin{cases}\\frac{1}{2}u^{2},  |u| \\le c,\\\\ c\\left(|u| - \\frac{1}{2}c\\right),  |u| > c,\\end{cases}$，其中 $c=1$，\n- $\\ell_{1}$ 损失：$\\rho_{1}(u) = |u|$。\n\n假设以下符合科学实际的设置：\n- 新息为 $d = 5\\sigma$（这是一个大的新息，代表遥感辐射率中可能存在的离群值）。\n- 背景方差等于观测尺度参数的平方，$b = \\sigma^{2}$。\n\n使用第一性原理（在指定的先验和损失函数下的贝叶斯最大后验估计），通过施加一阶优性条件并自洽地求解 $\\Delta$，推导每种损失选择下的分析增量 $\\Delta = x_{a} - x_{b}$。然后，计算每种情况下的归一化分析增量 $\\Delta/\\sigma$。\n\n使用 $\\mathrm{pmatrix}$ 环境将最终答案表示为一个行矩阵，顺序为 $[\\text{二次}, \\text{Huber}, \\ell_{1}]$。无需四舍五入，并将答案表示为 $\\sigma$ 的倍数（即，提供无量纲值 $\\Delta/\\sigma$）。",
            "solution": "分析增量为 $\\Delta = x_{a} - x_{b}$。我们可以用这个增量来表示状态变量 $x$，即 $x = x_{b} + \\Delta$。将其代入代价函数 $J(x)$ 中得到：\n$$\nJ(\\Delta) = \\frac{1}{2}\\frac{((x_{b} + \\Delta) - x_{b})^{2}}{b} + \\rho\\!\\left(\\frac{y - (x_{b} + \\Delta)}{\\sigma}\\right) = \\frac{1}{2}\\frac{\\Delta^{2}}{b} + \\rho\\!\\left(\\frac{d - \\Delta}{\\sigma}\\right)\n$$\n其中我们使用了新息的定义 $d = y - x_{b}$。\n\n为了找到最小化该代价函数的分析增量 $\\Delta$，我们通过将 $J(\\Delta)$ 对 $\\Delta$ 的导数设为零来施加一阶最优性条件：\n$$\n\\frac{\\mathrm{d}J}{\\mathrm{d}\\Delta} = \\frac{\\Delta}{b} + \\frac{\\mathrm{d}}{\\mathrm{d}\\Delta}\\rho\\!\\left(\\frac{d - \\Delta}{\\sigma}\\right) = \\frac{\\Delta}{b} + \\psi\\!\\left(\\frac{d - \\Delta}{\\sigma}\\right) \\cdot \\left(-\\frac{1}{\\sigma}\\right) = 0\n$$\n其中 $\\psi(u) = \\rho'(u)$ 是损失函数的导数，通常称为影响函数。\n整理后得到关于 $\\Delta$ 的一般最优性条件：\n$$\n\\Delta = \\frac{b}{\\sigma}\\psi\\!\\left(\\frac{d - \\Delta}{\\sigma}\\right)\n$$\n给定设置为 $b = \\sigma^2$ 和 $d = 5\\sigma$。将它们代入最优性条件，得到我们在每种情况下必须求解的方程：\n$$\n\\Delta = \\frac{\\sigma^2}{\\sigma}\\psi\\!\\left(\\frac{5\\sigma - \\Delta}{\\sigma}\\right) \\implies \\Delta = \\sigma\\psi\\!\\left(5 - \\frac{\\Delta}{\\sigma}\\right)\n$$\n\n现在我们针对三种损失函数中的每一种来求解这个自洽方程。\n\n**1. 二次损失：** $\\rho_{q}(u) = \\frac{1}{2}u^{2}$\n其导数为 $\\psi_{q}(u) = u$。最优性条件变为：\n$$\n\\Delta = \\sigma\\left(5 - \\frac{\\Delta}{\\sigma}\\right) = 5\\sigma - \\Delta\n$$\n求解 $\\Delta$：\n$$\n2\\Delta = 5\\sigma \\implies \\Delta = \\frac{5}{2}\\sigma\n$$\n归一化分析增量为 $\\Delta/\\sigma = \\frac{5}{2}$。\n\n**2. Huber 损失：** $\\rho_{H}(u) = \\begin{cases}\\frac{1}{2}u^{2},  |u| \\le 1,\\\\ |u| - \\frac{1}{2},  |u| > 1\\end{cases}$ （当 $c=1$ 时）\n其导数为 $\\psi_{H}(u) = \\begin{cases} u,  |u| \\le 1, \\\\ \\mathrm{sgn}(u),  |u| > 1. \\end{cases}$ 最优性条件为：\n$$\n\\Delta = \\sigma\\psi_{H}\\!\\left(5 - \\frac{\\Delta}{\\sigma}\\right)\n$$\n考虑到新息很大，我们可以假设 $\\psi_H$ 的参数的绝对值大于 1。由于 $d=5\\sigma$ 为正，我们期望 $0 < \\Delta < d$，这意味着 $5 - \\Delta/\\sigma > 0$。因此，我们假设 $|5 - \\Delta/\\sigma| > 1$ 且其为正。\n这导致 $\\psi_{H}(5 - \\Delta/\\sigma) = \\mathrm{sgn}(5 - \\Delta/\\sigma) = 1$。方程变为：\n$$\n\\Delta = \\sigma \\cdot 1 = \\sigma\n$$\n我们必须检查自洽性。如果 $\\Delta = \\sigma$，则参数为 $5 - \\Delta/\\sigma = 5 - 1 = 4$。由于 $|4| > 1$，我们的假设是正确的。\n归一化分析增量为 $\\Delta/\\sigma = 1$。\n\n**3. $\\ell_{1}$ 损失：** $\\rho_{1}(u) = |u|$\n其导数（对于 $u\\neq 0$）为 $\\psi_{1}(u) = \\mathrm{sgn}(u)$。最优性条件为：\n$$\n\\Delta = \\sigma\\psi_{1}\\!\\left(5 - \\frac{\\Delta}{\\sigma}\\right) = \\sigma \\, \\mathrm{sgn}\\left(5 - \\frac{\\Delta}{\\sigma}\\right)\n$$\n与 Huber 损失的情况类似，我们假设参数非零且为正，所以 $\\mathrm{sgn}(5 - \\Delta/\\sigma) = 1$。方程变为：\n$$\n\\Delta = \\sigma \\cdot 1 = \\sigma\n$$\n检查自洽性：如果 $\\Delta = \\sigma$，则参数为 $5 - \\Delta/\\sigma = 5-1=4$。由于 $4 \\ne 0$，使用 sgn 函数是有效的。\n归一化分析增量为 $\\Delta/\\sigma = 1$。\n\n汇总这三个归一化分析增量，得到最终结果：$[\\frac{5}{2}, 1, 1]$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{5}{2}  1  1 \\end{pmatrix}}\n$$"
        }
    ]
}