{
    "hands_on_practices": [
        {
            "introduction": "在利用极化干涉技术测量森林高度之前，我们必须首先理解干涉相位与高程之间的基本关系，以及由相位缠绕引起的内在模糊性。这项练习将引导你推导垂直波数（$k_z$）的概念，并计算最大无模糊高度，它定义了任何干涉SAR系统的操作限制。通过这个计算，你将掌握将干涉测量值与实际物理高度联系起来的核心原理。",
            "id": "3834633",
            "problem": "一项极化干涉合成孔径雷达 (PolInSAR) 实验通过两次由一条垂直基线隔开的合成孔径雷达 (SAR) 采集来进行。在植被区，通过利用散射机制的极化分离，可以将干涉相位参考到地面，从而利用植被体和地面之间的相对相位来估算植被高度。从干涉测量的基本原理出发，考虑以下任务：\n\n1.  定义干涉测量中的相位缠绕，并解释其对任何测量的干涉相位的影响。\n2.  利用干涉相位与路径差之间的关系，推导垂直波数 $k_{z}$，该波数通过 $\\Delta \\varphi \\approx k_{z} \\Delta h$ 将高度的微小变化 $\\Delta h$ 与相应的干涉相位变化 $\\Delta \\varphi$ 联系起来。用雷达波长 $\\lambda$、垂直基线 $B_{\\perp}$、斜距 $R$ 和入射角 $\\theta$ 表示 $k_{z}$。\n3.  鉴于干涉相位是模 $2\\pi$ 缠绕的，从基本原理出发论证无模糊高度区间必须用 $k_{z}$ 如何表示，并说明在已知地面相位的情况下，唯一反演植被高度的条件。\n4.  对于一个PolInSAR系统，其参数为 $\\lambda = 0.24 \\ \\mathrm{m}$，$B_{\\perp} = 30 \\ \\mathrm{m}$，$R = 25{,}000 \\ \\mathrm{m}$，以及 $\\theta = 40^\\circ$，计算你所推导的条件所隐含的最大无模糊冠层高度 $H_{\\max}$。将最终数值结果四舍五入至四位有效数字，并以米为单位表示。角度必须以度为单位处理。",
            "solution": "该问题陈述被评估为具有科学依据、提法恰当、客观且自成体系。它描述了极化干涉合成孔径雷达 (PolInSAR) 在植被高度估算中的一个标准应用。这些任务涉及基本定义、标准推导、基于基本原理的逻辑推理，以及使用实际参数的最终计算。因此，该问题被认为是有效的。\n\n解答过程按顺序处理四个任务。\n\n1.  干涉测量中的相位缠繞\n\n雷达干涉测量中测得的量是干涉相位 $\\varphi$，它是复值干涉图的辐角。干涉图是通过将一幅SAR图像中的一个像素 $s_1$ 与第二幅SAR图像中对应像素的复共轭 $s_2^*$ 相乘形成的。相位是使用反正切函数（通常是 `atan2`）计算的，该函数将输出限制在一个主值区间内，通常是 $(-\\pi, \\pi]$ 或 $[0, 2\\pi)$。\n\n这个过程被称为相位缠绕。真实的干涉相位 $\\varphi_{\\text{true}}$与路径差成正比，可以是任何实数。然而，测量的相位 $\\varphi_{\\text{wrapped}}$被缠绕在主值区间内。真实相位和缠绕相位之间的关系由下式给出：\n$$ \\varphi_{\\text{true}} = \\varphi_{\\text{wrapped}} + 2 \\pi n $$\n其中 $n$ 是一个未知整数，表示完整的 $2\\pi$ 周期的数量。\n\n相位缠绕的后果是测量的相位具有固有的模糊性。例如，一个测量的相位 $\\frac{\\pi}{4}$ 可能对应于真实的相位 $\\frac{\\pi}{4}$、$\\frac{9\\pi}{4}$、$-\\frac{7\\pi}{4}$ 等等。为了恢复整个场景的绝对相位差，需要一个称为相位解缠的过程，该过程旨在为每个像素估算相对于其邻近像素的正确整数 $n$。\n\n2.  垂直波数 $k_z$ 的推导\n\n我们从干涉SAR几何学的基本原理开始。干涉相位 $\\varphi$ 与两次雷达采集的双程传播路径差 $\\Delta R$ 直接成正比：\n$$ \\varphi = \\frac{2\\pi}{\\lambda} (2 \\Delta R) = \\frac{4\\pi}{\\lambda} \\Delta R $$\n其中 $\\lambda$ 是雷达波长。因子 $4\\pi$ 源于雷达信号的双程传播（到目标并返回）。\n\n在一个侧视SAR几何构型中，对于一个距离传感器为 $R$、入射角为 $\\theta$ 的目标，其离参考地面的高度 $h$ 会引起路径差的微小变化。在基线 $B$ 远小于斜距 $R$ 的情况下，对于一个点散射体，其高度 $h$ 引起的干涉相位 $\\varphi$ 在干涉测量文献中被推导为：\n$$ \\varphi \\approx \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} h $$\n其中 $B_\\perp$ 是垂直于视线方向的基线分量。这个公式直接将可测量的相位与目标的物理高度联系起来。\n\n垂直波数 $k_z$ 定义为相位随高度的变化率：\n$$ k_z = \\frac{d\\varphi}{dh} = \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} $$\n因此，对于高度的微小变化 $\\Delta h$，相位变化 $\\Delta \\varphi$ 近似为：\n$$ \\Delta \\varphi \\approx k_z \\Delta h $$\n\n3.  无模糊高度区间\n\n如第1部分所述，任何测量的干涉相位都被缠绕在 $(-\\pi, \\pi]$ 或 $[0, 2\\pi)$ 的范围内。这意味着相位差仅在模 $2\\pi$ 的意义下是已知的。关系式 $\\Delta \\varphi \\approx k_z \\Delta h$ 将高度差与相位差联系起来。如果整个植被高度 $H_{\\text{veg}}$ 上的总相位变化超过 $2\\pi$，就会出现模糊性。\n具体来说，如果高度 $h$ 和高度 $h + \\Delta h_{\\text{amb}}$ 对应的相位之差为 $2\\pi$ 的整数倍，那么它们将无法区分。导致这种模糊性的最小高度差对应于 $2\\pi$ 的相位变化。这个高度被称为“模糊高度”或无模糊高度区间，我们记为 $H_{2\\pi}$。\n$$ |k_z| H_{2\\pi} = 2\\pi $$\n解出这个区间得到：\n$$ H_{2\\pi} = \\frac{2\\pi}{|k_z|} $$\n为了唯一地反演植被高度 $H_{\\text{veg}}$（假设地面相位已知，提供了一个参考），从地面到冠层顶部的总相位变化必须小于一个完整周期。这施加了以下条件：\n$$ |k_z| H_{\\text{veg}}  2\\pi $$\n因此，唯一反演植被高度的条件是它必须小于模糊高度：\n$$ H_{\\text{veg}}  H_{2\\pi} = \\frac{2\\pi}{|k_z|} $$\n\n4.  最大无模糊冠层高度的计算\n\n最大无模糊冠层高度 $H_{\\text{max}}$ 等同于模糊高度 $H_{2\\pi}$。我们将第2部分推导出的 $k_z$ 表达式代入第3部分的公式中。\n$$ H_{\\text{max}} = \\frac{2\\pi}{|k_z|} = \\frac{2\\pi}{\\left| \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} \\right|} = \\frac{2\\pi \\lambda R \\sin\\theta}{4\\pi B_\\perp} = \\frac{\\lambda R \\sin\\theta}{2 B_\\perp} $$\n我们给定的参数如下：\n- 波长 $\\lambda = 0.24 \\ \\mathrm{m}$\n- 垂直基线 $B_\\perp = 30 \\ \\mathrm{m}$\n- 斜距 $R = 25000 \\ \\mathrm{m}$\n- 入射角 $\\theta = 40^\\circ$\n\n将这些值代入 $H_{\\text{max}}$ 的表达式：\n$$ H_{\\text{max}} = \\frac{(0.24) \\times (25000) \\times \\sin(40^\\circ)}{2 \\times (30)} $$\n$$ H_{\\text{max}} = \\frac{6000 \\times \\sin(40^\\circ)}{60} = 100 \\times \\sin(40^\\circ) $$\n使用 $\\sin(40^\\circ) \\approx 0.6427876$ 的值：\n$$ H_{\\text{max}} \\approx 100 \\times 0.6427876 = 64.27876 \\ \\mathrm{m} $$\n按要求将结果四舍五入到四位有效数字：\n$$ H_{\\text{max}} \\approx 64.28 \\ \\mathrm{m} $$\n这是该PolInSAR系统配置能够无模糊测量的最大冠层高度。",
            "answer": "$$\\boxed{64.28}$$"
        },
        {
            "introduction": "在上一个练习的基础上，我们引入一个更真实的森林模型来解决相位模糊性带来的挑战。本练习将演示极化干涉SAR如何利用随机介质-地面（RVoG）模型，通过不同极化方式与冠层的相互作用来区分来自地面的散射和来自植被体的散射。通过模拟这一过程，你将学会如何从混合信号中估计地面相位，这是精确反演森林高度的关键一步。",
            "id": "3834626",
            "problem": "给定一个合成的极化干涉合成孔径雷达（PolInSAR）场景，其包含两种散射机制：地表分量和植被体分量。目标是在一个具有物理基础的混合模型下构建与极化相关的干涉相干性，然后根据其在不同极化下的相位行为来估计共同的地面干涉相位 $\\phi_g$。\n\n请基于核心定义进行推导和实现。使用以下内容作为您的出发点：\n\n- 合成孔径雷达（SAR）和干涉合成孔径雷达（InSAR）的相干性由两次采集之间的归一化复相关定义。对于单个极化 $p$，干涉相干性定义为\n$$\n\\gamma_p \\triangleq \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}} \\, ,\n$$\n其中，$s_{1,p}$ 和 $s_{2,p}$ 分别表示第一次和第二次采集中极化 $p$ 的复 SAR 信号。\n\n- 体散射贡献被建模为具有极化相关消光剖面的垂直分布后向散射。设冠层厚度为 $H$（单位：米），极化相关的后向散射权重为 $f_p(z) = e^{-\\xi_p z}$，其中 $\\xi_p$（单位：米⁻¹）是极化相关的消光参数，$z$ 是高度坐标。干涉体相干性是垂直剖面在垂直波数 $k_z$（单位：弧度/米）处求值的归一化加权傅里叶变换：\n$$\n\\gamma_{v,p} \\triangleq \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz} \\, .\n$$\n\n- 地面贡献是一个具有干涉相位 $\\phi_g$（单位：弧度）的单相位中心，建模为确定性复相量 $e^{j \\phi_g}$。\n\n假设对于每个极化 $p$，总后向散射是地面分量和体散射分量的独立和，其功率分别与极化相关的非负权重 $a_p^2$（地面）和 $b_p^2$（体散射）成正比。设地面分量和体散射分量相互不相关。在这些假设下，并使用上述干涉相干性的定义，构建与极化相关的合成干涉相干性 $\\gamma_p$。\n\n然后，利用几何特性，即对于每个极化 $p$，复相干性 $\\gamma_p$ 位于连接体相干性 $\\gamma_{v,p}$ 和地面相量 $e^{j \\phi_g}$ 的复平面直线上。使用三个具有不同消光参数和混合权重的线性极化通道 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$，通过找到这些直线在复平面上的最小二乘交点并取其辐角来估计 $\\phi_g$。\n\n您的程序必须：\n\n1. 对于每个提供的测试用例，使用上述积分定义计算 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$ 的 $\\gamma_{v,p}$。\n2. 在本问题详述的独立混合模型下，为每个极化构建 $\\gamma_p$。\n3. 通过求解三条极化直线的最小二乘交点问题来估计 $\\phi_g$，其中每条直线由一个点 $\\gamma_{v,p}$ 和一个方向向量 $\\gamma_p - \\gamma_{v,p}$ 定义。\n4. 对每个测试用例，以弧度为单位输出估计的 $\\phi_g$，并四舍五入到六位小数。\n\n物理单位和角度单位要求：\n- 冠层厚度 $H$ 必须以米为单位。\n- 消光参数 $\\xi_p$ 必须以米⁻¹为单位。\n- 垂直波数 $k_z$ 必须以弧度/米为单位。\n- 地面相位 $\\phi_g$ 必须以弧度为单位进行估计和输出。\n\n测试套件和参数：\n请严格使用以下测试套件。每个测试用例定义了 $H$、$k_z$、$\\phi_g$（真实值，仅用于生成合成相干性）、消光参数 $\\xi_p$ 和混合权重 $(a_p, b_p)$，其中 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$。\n\n- 测试用例 1（一般情况）：\n  - $H = 20$\n  - $k_z = 0.2$\n  - $\\phi_g = 0.8$\n  - $\\xi_{\\text{HH}} = 0.12$, $\\xi_{\\text{HV}} = 0.30$, $\\xi_{\\text{VV}} = 0.08$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.7, 0.3)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.2, 0.8)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.6, 0.4)$\n\n- 测试用例 2（小垂直波数边界）：\n  - $H = 25$\n  - $k_z = 0.01$\n  - $\\phi_g = -1.0$\n  - $\\xi_{\\text{HH}} = 0.18$, $\\xi_{\\text{HV}} = 0.28$, $\\xi_{\\text{VV}} = 0.10$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.5, 0.5)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.1, 0.9)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.4, 0.6)$\n\n- 测试用例 3（大垂直波数边缘情况，交叉极化中体散射较强）：\n  - $H = 15$\n  - $k_z = 0.5$\n  - $\\phi_g = 1.5$\n  - $\\xi_{\\text{HH}} = 0.20$, $\\xi_{\\text{HV}} = 0.40$, $\\xi_{\\text{VV}} = 0.12$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.8, 0.2)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.15, 0.85)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.7, 0.3)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的估计地面相位，格式为方括号括起来的逗号分隔列表，单位为弧度，四舍五入到六位小数（例如，$\\left[\\phi_1,\\phi_2,\\phi_3\\right]$ 变成类似“[0.800000,-1.000000,1.500000]”的字符串）。",
            "solution": "该问题是有效的，因为它在科学上基于极化干涉测量的原理，问题设定良好，具有明确的目标和充足的数据，并且表述客观。任务是基于“地面上随机体散射”（RVoG）模型，从合成的极化干涉合成孔径雷达（PolInSAR）数据中估计地面干涉相位 $\\phi_g$。\n\n解决方案分四个阶段进行：\n1.  推导混合地-体散射体的复合干涉相干性 $\\gamma_p$。\n2.  纯体散射相干性 $\\gamma_{v,p}$ 的解析计算。\n3.  将地面相位估计问题表述为最小二乘直线相交问题。\n4.  将此框架应用于所提供的测试用例。\n\n**1. 复合干涉相干性模型**\n\n问题给出了单个极化通道 $p$ 的干涉相干性定义为：\n$$\n\\gamma_p = \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}}\n$$\n其中 $s_{1,p}$ 和 $s_{2,p}$ 是两次采样的复 SAR 信号。假设统计平稳性，分母简化为 $\\mathbb{E}\\left[|s_p|^2\\right]$。\n\n总信号 $s_p$ 被建模为地面分量 $s_{g,p}$ 和体散射分量 $s_{v,p}$ 的独立和：$s_{p} = s_{g,p} + s_{v,p}$。问题指出这些分量相互不相关，即 $\\mathbb{E}\\left[s_{g,p} s_{v,p}^\\ast\\right] = 0$。\n\n$\\gamma_p$ 分子中的相关项变为：\n$$\n\\mathbb{E}\\left[s_{1,p}s_{2,p}^\\ast\\right] = \\mathbb{E}\\left[(s_{1,g,p} + s_{1,v,p})(s_{2,g,p}^\\ast + s_{2,v,p}^\\ast)\\right] = \\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] + \\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right]\n$$\n分母中的总功率变为：\n$$\n\\mathbb{E}\\left[|s_p|^2\\right] = \\mathbb{E}\\left[|s_{g,p} + s_{v,p}|^2\\right] = \\mathbb{E}\\left[|s_{g,p}|^2\\right] + \\mathbb{E}\\left[|s_{v,p}|^2\\right]\n$$\n令 $P_{g,p} = \\mathbb{E}\\left[|s_{g,p}|^2\\right]$ 为地面功率，$P_{v,p} = \\mathbb{E}\\left[|s_{v,p}|^2\\right]$ 为体散射功率。\n\n纯地面相干性由相量 $e^{j\\phi_g}$ 给出，纯体散射相干性为 $\\gamma_{v,p}$。根据定义，我们可以写出：\n$\\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] = P_{g,p} e^{j\\phi_g}$\n$\\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right] = P_{v,p} \\gamma_{v,p}$\n\n将这些代入 $\\gamma_p$ 的表达式中，得到：\n$$\n\\gamma_p = \\frac{P_{g,p} e^{j\\phi_g} + P_{v,p} \\gamma_{v,p}}{P_{g,p} + P_{v,p}}\n$$\n问题指出，地面和体散射功率分别与 $a_p^2$ 和 $b_p^2$ 成正比。定义地-体功率比为 $\\mu_p = P_{g,p}/P_{v,p} = a_p^2/b_p^2$，我们可以将相干性重写为：\n$$\n\\gamma_p = \\frac{\\mu_p e^{j\\phi_g} + \\gamma_{v,p}}{\\mu_p + 1}\n$$\n这个方程表明，观测到的相干性 $\\gamma_p$ 是地面相量 $e^{j\\phi_g}$ 和体散射相干性 $\\gamma_{v,p}$ 的复加权平均。在几何上，点 $\\gamma_p$ 位于复平面上连接点 $\\gamma_{v,p}$ 和 $e^{j\\phi_g}$ 的线段上。这是 RVoG 模型的基本见解。\n\n**2. 体散射相干性计算**\n\n体散射相干性 $\\gamma_{v,p}$ 由垂直后向散射剖面 $f_p(z) = e^{-\\xi_p z}$ 的归一化傅里叶变换定义：\n$$\n\\gamma_{v,p} = \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz}\n$$\n分子中的积分是：\n$$\n\\int_{0}^{H} e^{-\\xi_p z} e^{j k_z z} \\, dz = \\int_{0}^{H} e^{(j k_z - \\xi_p) z} \\, dz = \\left[ \\frac{e^{(j k_z - \\xi_p) z}}{j k_z - \\xi_p} \\right]_{0}^{H} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p}\n$$\n分母中的积分是：\n$$\n\\int_{0}^{H} e^{-\\xi_p z} \\, dz = \\left[ \\frac{e^{-\\xi_p z}}{-\\xi_p} \\right]_{0}^{H} = \\frac{e^{-\\xi_p H} - 1}{-\\xi_p} = \\frac{1 - e^{-\\xi_p H}}{\\xi_p}\n$$\n结合这些结果，得到体散射相干性的解析表达式：\n$$\n\\gamma_{v,p} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p} \\left( \\frac{\\xi_p}{1 - e^{-\\xi_p H}} \\right)\n$$\n该公式用于计算每个极化通道 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$ 的 $\\gamma_{v,p}$。注意，对于特殊情况 $\\xi_p=0$，可以使用洛必达法则来证明该公式正确地收敛到 $\\gamma_{v,p}|_{\\xi_p=0} = \\frac{e^{j k_z H} - 1}{j k_z H}$。\n\n**3. 地面相位的最小二乘估计**\n\n对于三种极化 $p_i$ 中的每一种（其中 $i \\in \\{1, 2, 3\\}$ 对应于 HH, HV, VV），观测到的相干性 $\\gamma_{p_i}$ 和体散射相干性 $\\gamma_{v,p_i}$ 在复平面上定义了一条直线。未知的地面相量，我们称之为 $G = e^{j\\phi_g}$，位于所有这三条直线上。在像这样的无噪声合成场景中，这三条直线将相交于一个单点 $G$。为了找到这个交点，我们根据要求建立一个超定系统，并使用最小二乘法求解。\n\n设复平面中的一个点由其实部和虚部组成的二维向量表示。地面点是 $\\mathbf{g} = (\\text{Re}\\{G\\}, \\text{Im}\\{G\\})$。对于每个极化 $i$，直线穿过点 $\\mathbf{v}_i = (\\text{Re}\\{\\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{v,p_i}\\})$，并平行于方向向量 $\\mathbf{d}_i = (\\text{Re}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\})$。\n\n直线 $i$ 的方程可以用单位法向量 $\\mathbf{n}_i$ 表示。方向向量是 $\\mathbf{d}_i = (d_{ix}, d_{iy})$；一个法向量是 $(-d_{iy}, d_{ix})$。单位法向量是 $\\mathbf{n}_i = \\frac{1}{||\\mathbf{d}_i||}(-d_{iy}, d_{ix}) = (n_{ix}, n_{iy})$。直线上一点 $\\mathbf{x}=(x,y)$ 的方程是 $\\mathbf{n}_i \\cdot (\\mathbf{x} - \\mathbf{v}_i) = 0$。\n\n我们寻求点 $\\mathbf{g}=(x_g, y_g)$，使得它到这三条直线的平方距离之和最小。从 $\\mathbf{g}$ 到直线 $i$ 的平方距离是 $(\\mathbf{n}_i \\cdot (\\mathbf{g} - \\mathbf{v}_i))^2$。最小化问题是：\n$$\n\\min_{x_g, y_g} \\sum_{i=1}^{3} (\\mathbf{n}_i \\cdot \\mathbf{g} - \\mathbf{n}_i \\cdot \\mathbf{v}_i)^2\n$$\n这是一个形式为 $\\min_{\\mathbf{x}} ||\\mathbf{A}\\mathbf{x} - \\mathbf{c}||^2$ 的标准线性最小二乘问题，其中：\n$$\n\\mathbf{A} = \\begin{pmatrix} n_{1x}  n_{1y} \\\\ n_{2x}  n_{2y} \\\\ n_{3x}  n_{3y} \\end{pmatrix}, \\quad \\mathbf{x} = \\begin{pmatrix} x_g \\\\ y_g \\end{pmatrix}, \\quad \\mathbf{c} = \\begin{pmatrix} \\mathbf{n}_1 \\cdot \\mathbf{v}_1 \\\\ \\mathbf{n}_2 \\cdot \\mathbf{v}_2 \\\\ \\mathbf{n}_3 \\cdot \\mathbf{v}_3 \\end{pmatrix}\n$$\n解由正规方程给出：$(\\mathbf{A}^T \\mathbf{A}) \\mathbf{x} = \\mathbf{A}^T \\mathbf{c}$。通过求解这个 $2 \\times 2$ 线性系统，可以找到估计的地面点坐标 $\\mathbf{x}$。\n\n**4. 最终相位估计**\n\n一旦找到最小二乘解 $\\mathbf{x} = (\\hat{x}_g, \\hat{y}_g)$，该向量对应于估计的复地面相量 $\\hat{G} = \\hat{x}_g + j\\hat{y}_g$。估计的地面相位 $\\hat{\\phi}_g$ 是该复数的辐角：\n$$\n\\hat{\\phi}_g = \\arg(\\hat{G}) = \\text{atan2}(\\hat{y}_g, \\hat{x}_g)\n$$\n将此程序应用于每个测试用例，以找到各自的估计地面相位。由于合成数据是无噪声的，估计的相位 $\\hat{\\phi}_g$ 应该在数值精度范围内与用于生成数据的真实相位 $\\phi_g$ 完全匹配。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR ground phase estimation problem for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            'H': 20.0, 'kz': 0.2, 'phi_g': 0.8,\n            'pols': {\n                'HH': {'xi': 0.12, 'a': 0.7, 'b': 0.3},\n                'HV': {'xi': 0.30, 'a': 0.2, 'b': 0.8},\n                'VV': {'xi': 0.08, 'a': 0.6, 'b': 0.4}\n            }\n        },\n        {\n            'H': 25.0, 'kz': 0.01, 'phi_g': -1.0,\n            'pols': {\n                'HH': {'xi': 0.18, 'a': 0.5, 'b': 0.5},\n                'HV': {'xi': 0.28, 'a': 0.1, 'b': 0.9},\n                'VV': {'xi': 0.10, 'a': 0.4, 'b': 0.6}\n            }\n        },\n        {\n            'H': 15.0, 'kz': 0.5, 'phi_g': 1.5,\n            'pols': {\n                'HH': {'xi': 0.20, 'a': 0.8, 'b': 0.2},\n                'HV': {'xi': 0.40, 'a': 0.15, 'b': 0.85},\n                'VV': {'xi': 0.12, 'a': 0.7, 'b': 0.3}\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        estimated_phi_g = estimate_ground_phase(case)\n        results.append(estimated_phi_g)\n\n    # Format the final output string exactly as required.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef compute_gamma_v(H, kz, xi):\n    \"\"\"\n    Computes the pure volume interferometric coherence gamma_v.\n    \n    Args:\n        H (float): Canopy thickness in meters.\n        kz (float): Vertical wavenumber in radians per meter.\n        xi (float): Polarization-dependent extinction in inverse meters.\n    \n    Returns:\n        complex: The volume coherence gamma_v.\n    \"\"\"\n    if np.isclose(xi, 0.0):\n        # Handle the zero-extinction case\n        if np.isclose(kz, 0.0):\n            return 1.0 + 0.0j\n        num = np.exp(1j * kz * H) - 1.0\n        den = 1j * kz * H\n        return num / den\n    else:\n        # General case for non-zero extinction\n        num_term = 1j * kz - xi\n        num = (np.exp(num_term * H) - 1.0) / num_term\n        \n        den_term = -xi\n        den = (np.exp(den_term * H) - 1.0) / den_term\n        \n        return num / den\n\ndef estimate_ground_phase(case_params):\n    \"\"\"\n    Estimates the ground phase for a single test case.\n    \n    Args:\n        case_params (dict): A dictionary containing all parameters for one case.\n    \n    Returns:\n        float: The estimated ground phase phi_g in radians.\n    \"\"\"\n    H = case_params['H']\n    kz = case_params['kz']\n    phi_g_true = case_params['phi_g']\n    \n    gamma_v_points = []\n    gamma_p_points = []\n    \n    # polarization channels are ordered to be deterministic (HH, HV, VV)\n    pol_channels = ['HH', 'HV', 'VV']\n\n    for p_name in pol_channels:\n        p_params = case_params['pols'][p_name]\n        xi = p_params['xi']\n        a = p_params['a']\n        b = p_params['b']\n        \n        # 1. Compute volume-only coherence\n        gamma_v = compute_gamma_v(H, kz, xi)\n        \n        # 2. Synthesize total coherence using the true ground phase\n        g_phasor = np.exp(1j * phi_g_true)\n        mu = (a / b)**2\n        gamma_p = (mu * g_phasor + gamma_v) / (mu + 1.0)\n        \n        gamma_v_points.append(gamma_v)\n        gamma_p_points.append(gamma_p)\n        \n    # 3. Formulate and solve the least-squares intersection-of-lines problem\n    num_pols = len(pol_channels)\n    A = np.zeros((num_pols, 2))\n    c_vec = np.zeros(num_pols)\n    \n    for i in range(num_pols):\n        v = gamma_v_points[i]\n        p = gamma_p_points[i]\n        \n        # Direction vector of the line in the complex plane\n        d_vec = p - v\n        \n        # Handle case where v and p are the same (pure volume)\n        if np.isclose(np.abs(d_vec), 0.0):\n            # This line provides no information on the ground point,\n            # but to avoid division by zero we can skip it or handle it.\n            # In a robust implementation, this line might be weighted out.\n            # Here we can just set its normal to zero.\n            nx, ny = 0.0, 0.0\n        else:\n            # Unit normal vector to the line\n            nx = -d_vec.imag / np.abs(d_vec)\n            ny = d_vec.real / np.abs(d_vec)\n        \n        A[i, 0] = nx\n        A[i, 1] = ny\n        c_vec[i] = nx * v.real + ny * v.imag\n        \n    # Solve the normal equations: (A^T A) x = A^T c\n    ATA = A.T @ A\n    ATc = A.T @ c_vec\n    \n    # Since the system is noise-free, the lines intersect perfectly.\n    # The matrix ATA is invertible.\n    solution = np.linalg.solve(ATA, ATc)\n    \n    g_hat = solution[0] + 1j * solution[1]\n    \n    # 4. The estimated phase is the argument of the resulting complex number\n    estimated_phi_g = np.angle(g_hat)\n    \n    return estimated_phi_g\n\nsolve()\n```"
        },
        {
            "introduction": "在学会分离地面和植被体散射之后，下一步是尽可能有效地完成这项任务。这项高级实践将介绍相干性优化，这是一种寻找特定极化组合以最大化不同散射机制之间分离度的强大技术。掌握这种方法能够更稳健地分离散射机制，从而提高植被参数估算的准确性。",
            "id": "3834682",
            "problem": "考虑用于植被结构反演的极化干涉合成孔径雷达 (PolInSAR) 相干性优化问题。设来自两次重复轨道采集的极化散射矢量在同一基底下用复权重表示。分别为第一次和第二次采集定义 $3 \\times 3$ 埃尔米特半正定协方差矩阵 $C_{11}$ 和 $C_{22}$，以及 $3 \\times 3$ 互协方差矩阵 $C_{12}$，其中 $C_{21} = C_{12}^{\\mathrm{H}}$，$(\\cdot)^{\\mathrm{H}}$ 表示共轭转置。构成 $6 \\times 6$ 埃尔米特块协方差矩阵\n$$\n\\Sigma \\;=\\; \\begin{bmatrix}\nC_{11}  C_{12} \\\\\nC_{21}  C_{22}\n\\end{bmatrix}.\n$$\n对于复权重矢量 $w_1 \\in \\mathbb{C}^3$ 和 $w_2 \\in \\mathbb{C}^3$，极化干涉相干性由瑞利型商定义\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}.\n$$\n从复随机矢量的二阶统计量核心定义和加权内积空间中的 Cauchy–Schwarz 不等式出发，推导出一个等价的广义特征值公式，其主解提供最优相干性 $\\,\\gamma_{\\star}\\,$ 和相应的极化矢量 $\\,w_{1,\\star}\\,$ 与 $\\,w_{2,\\star}\\,$。您的推导必须从最大化 $\\,\\gamma(w_1, w_2)\\,$ 开始，约束条件为 $\\,w_1^{\\mathrm{H}} C_{11} w_1 = 1\\,$ 和 $\\,w_2^{\\mathrm{H}} C_{22} w_2 = 1\\,$，并通过一系列基于线性代数和概率论的有效变换进行，不得引入任何快捷公式。\n\n实现要求：\n- 给定 $\\,\\Sigma\\,$，计算 $\\,\\gamma_{\\star}\\,$ 和任意一对实现最优值的极化矢量 $\\,w_{1,\\star}, w_{2,\\star}\\,$，并将其归一化以满足约束 $\\,w_{1,\\star}^{\\mathrm{H}} C_{11} w_{1,\\star} = 1\\,$ 和 $\\,w_{2,\\star}^{\\mathrm{H}} C_{22} w_{2,\\star} = 1\\,$。\n- 如果 $\\,C_{11}\\,$ 或 $\\,C_{22}\\,$ 是奇异或数值病态的，使用通过埃尔米特特征分解计算的 Tikhonov 正则化平方根逆因子。具体来说，对于一个埃尔米特矩阵 $\\,C\\,$，其特征分解为 $\\,C = Q \\Lambda Q^{\\mathrm{H}}\\,$，使用 $\\,C^{-1/2}_{\\epsilon} = Q \\operatorname{diag}\\!\\left(1/\\sqrt{\\lambda_i + \\epsilon}\\right) Q^{\\mathrm{H}}\\,$，并取固定的 $\\,\\epsilon = 10^{-8}\\,$。\n- 对于每个测试用例，报告：\n  1. 最优相干性 $\\,\\gamma_{\\star}\\,$，作为保留六位小数的浮点数。\n  2. $\\,w_{1,\\star}\\,$ 的实部，作为一个包含三个浮点数的列表，每个浮点数保留六位小数。\n  3. $\\,w_{1,\\star}\\,$ 的虚部，作为一个包含三个浮点数的列表，每个浮点数保留六位小数。\n  4. $\\,w_{2,\\star}\\,$ 的实部，作为一个包含三个浮点数的列表，每个浮点数保留六位小数。\n  5. $\\,w_{2,\\star}\\,$ 的虚部，作为一个包含三个浮点数的列表，每个浮点数保留六位小数。\n\n测试套件：\n为以下三个科学上一致的案例提供结果，这些案例探查了典型、零和秩亏场景。角度以弧度为单位。\n\n案例1（典型情况，具有非零干涉相位的对角协方差）：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 3.0,\\; 2.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.8,\\; 2.8,\\; 2.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.8}\\cdot 0.72 \\cdot e^{\\mathrm{i}\\cdot 0.1},\\;\\; \\sqrt{3.0 \\cdot 2.8}\\cdot 0.50 \\cdot e^{\\mathrm{i}\\cdot (-0.2)},\\;\\; \\sqrt{2.5 \\cdot 2.2}\\cdot 0.35 \\cdot e^{\\mathrm{i}\\cdot 0.05}\\Big).\n$$\n\n案例2（边缘情况，互协方差为零）：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(2.0,\\; 1.5,\\; 1.0\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(1.8,\\; 1.2,\\; 0.8\\right), \\quad\nC_{12} = \\begin{bmatrix}\n0  0  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{bmatrix}.\n$$\n\n案例3（边界情况，$\\,C_{11}\\,$ 秩亏且第三通道具有强相干性）：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 0.0,\\; 1.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.5,\\; 2.0,\\; 1.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.5}\\cdot 0.30 \\cdot e^{\\mathrm{i}\\cdot 0.3},\\;\\; 0.0,\\;\\; \\sqrt{1.5 \\cdot 1.2}\\cdot 0.90 \\cdot e^{\\mathrm{i}\\cdot (-0.15)}\\Big).\n$$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个案例的结果，形式为一个用方括号括起来的逗号分隔列表，并且任何地方都没有空格。每个案例的结果本身应该是一个包含上述指定顺序的五个元素的列表。例如，输出应如下所示\n$$\n[\\,[\\gamma_1,[\\Re w_{1,1}],[\\Im w_{1,1}],[\\Re w_{2,1}],[\\Im w_{2,1}]],[\\gamma_2,[\\Re w_{1,2}],[\\Im w_{1,2}],[\\Re w_{2,2}],[\\Im w_{2,2}]],[\\gamma_3,[\\Re w_{1,3}],[\\Im w_{1,3}],[\\Re w_{2,3}],[\\Im w_{2,3}]]\\,],\n$$\n其中所有数值均四舍五入到六位小数并表示为浮点数。程序必须是自包含的，且不得读取任何输入或文件。",
            "solution": "该问题旨在通过最大化以下表达式来找到最大极化干涉相干性 $\\gamma_{\\star}$ 和相应的极化权重矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$：\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}\n$$\n其约束条件为归一化约束 $w_1^{\\mathrm{H}}\\, C_{11}\\, w_1 = 1$ 和 $w_2^{\\mathrm{H}}\\, C_{22}\\, w_2 = 1$。矩阵 $C_{11}$ 和 $C_{22}$ 是埃尔米特半正定的。\n\n我们的推导过程是将问题转换为一个可用线性代数求解的标准形式，然后按要求将此解与一个广义特征值问题联系起来。\n\n步骤 1：通过变量替换进行重构\n$\\gamma(w_1, w_2)$ 的约束条件和分母在加权内积空间中定义了范数。为简化问题，我们可以将矢量 $w_1$ 和 $w_2$ 变换到一个具有标准欧几里得范数的空间。我们定义新的矢量 $v_1 \\in \\mathbb{C}^3$ 和 $v_2 \\in \\mathbb{C}^3$ 如下：\n$$\nv_1 = C_{11}^{1/2} w_1 \\quad \\text{和} \\quad v_2 = C_{22}^{1/2} w_2\n$$\n其中 $C^{1/2}$ 表示一个半正定矩阵 $C$ 的埃尔米特平方根。如果 $C_{11}$ 或 $C_{22}$ 是奇异的，则其逆变换所需的平方根逆矩阵未定义。按照规定，我们通过使用 Tikhonov 正则化的平方根逆矩阵 $C^{-1/2}_{\\epsilon}$ 来处理此问题。因此，逆变换为：\n$$\nw_1 = C_{11}^{-1/2} v_1 \\quad \\text{和} \\quad w_2 = C_{22}^{-1/2} v_2\n$$\n（此后，在必要时 $C^{-1/2}$ 隐式表示正则化版本 $C^{-1/2}_{\\epsilon}$）。\n\n将这些代入归一化约束中，我们得到：\n$$\nw_1^{\\mathrm{H}} C_{11} w_1 = (C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{11} (C_{11}^{-1/2} v_1) = v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{11} C_{11}^{-1/2} v_1 = v_1^{\\mathrm{H}} v_1 = 1\n$$\n$$\nw_2^{\\mathrm{H}} C_{22} w_2 = (C_{22}^{-1/2} v_2)^{\\mathrm{H}} C_{22} (C_{22}^{-1/2} v_2) = v_2^{\\mathrm{H}} C_{22}^{-1/2 \\mathrm{H}} C_{22} C_{22}^{-1/2} v_2 = v_2^{\\mathrm{H}} v_2 = 1\n$$\n如果 $C_{11}$ 和 $C_{22}$ 可逆，则此式精确成立。在正则化的情况下，$C^{-1/2}_{\\epsilon} C C^{-1/2}_{\\epsilon} \\neq I$，因此需要对最终得到的矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$ 进行最终的重新归一化。对新矢量的约束简化为标准的单位范数约束：$\\|v_1\\| = 1$ 和 $\\|v_2\\| = 1$。\n\n现在，我们将变换代入相干性表达式的分子中：\n$$\n|w_1^{\\mathrm{H}} C_{12} w_2| = |(C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{12} (C_{22}^{-1/2} v_2)| = |v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{12} C_{22}^{-1/2} v_2|\n$$\n由于 $C_{11}$ 是埃尔米特矩阵，其平方根和平方根逆矩阵也是埃尔米特矩阵，因此 $C_{11}^{-1/2 \\mathrm{H}} = C_{11}^{-1/2}$。我们定义一个新矩阵 $K$：\n$$\nK = C_{11}^{-1/2} C_{12} C_{22}^{-1/2}\n$$\n优化问题现在转换为：\n$$\n\\text{最大化} \\quad |v_1^{\\mathrm{H}} K v_2| \\quad \\text{约束条件为} \\quad \\|v_1\\| = 1, \\|v_2\\| = 1\n$$\n\n步骤 2：通过奇异值分解 (SVD) 求解\n这是线性代数中的一个标准问题。当 $v_1$ 和 $v_2$ 分别是矩阵 $K$ 的主左奇异矢量和主右奇异矢量时，表达式 $|v_1^{\\mathrm{H}} K v_2|$ 达到最大值。所达到的最大值是 $K$ 的最大奇异值。\n\n设 $K$ 的奇异值分解为 $K = U S V^{\\mathrm{H}}$，其中 $U$ 和 $V$ 是酉矩阵，其列分别是左、右奇异矢量，$S$ 是由实非负奇异值 $s_1 \\ge s_2 \\ge \\dots \\ge 0$ 构成的对角矩阵。\n目标函数变为 $|v_1'^{\\mathrm{H}} U S V^{\\mathrm{H}} v_2|$。令 $v'_1 = U^{\\mathrm{H}} v_1$ 和 $v'_2 = V^{\\mathrm{H}} v_2$。由于 $U$ 和 $V$ 是酉矩阵，所以 $\\|v'_1\\|=\\|v_1\\|=1$ 且 $\\|v'_2\\|=\\|v_2\\|=1$。问题等价于最大化 $|v_1'^{\\mathrm{H}} S v_2'|$。由于 $S$ 是对角矩阵，当 $v'_1$ 和 $v'_2$ 是对应于最大奇异值 $s_1$ 的标准基矢量 $e_1 = [1, 0, \\dots, 0]^{\\mathrm{T}}$ 时，该表达式达到最大值。\n\n最优相干性是最大值：\n$$\n\\gamma_{\\star} = s_{\\max}(K) = s_1\n$$\n变换后空间中的最优矢量是 $U$ 和 $V$ 的第一列：\n$$\nv_{1,\\star} = u_1 \\quad \\text{和} \\quad v_{2,\\star} = v_1\n$$\n\n步骤 3：等价广义特征值问题的推导\n$K$ 的奇异值是 $K K^{\\mathrm{H}}$ 的特征值的平方根。我们来构造这个矩阵：\n$$\nK K^{\\mathrm{H}} = (C_{11}^{-1/2} C_{12} C_{22}^{-1/2}) (C_{11}^{-1/2} C_{12} C_{22}^{-1/2})^{\\mathrm{H}} = C_{11}^{-1/2} (C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) C_{11}^{-1/2}\n$$\n$K K^{\\mathrm{H}}$ 的特征值问题是 $K K^{\\mathrm{H}} v_1 = \\lambda v_1$，其中特征矢量是 $K$ 的左奇异矢量 $v_1 = u_i$，特征值是奇异值的平方 $\\lambda = s_i^2$。对于最大值，有 $\\lambda_{\\max} = s_{\\max}^2 = \\gamma_{\\star}^2$。\n代入 $K K^{\\mathrm{H}}$ 的表达式：\n$$\n(C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) v_1 = \\lambda v_1\n$$\n现在，我们用 $C_{11}^{1/2}$ 左乘，并代入 $v_1 = C_{11}^{1/2} w_1$：\n$$\nC_{11}^{1/2} (C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) (C_{11}^{1/2} w_1) = \\lambda C_{11}^{1/2} (C_{11}^{1/2} w_1)\n$$\n这可以简化为：\n$$\n(C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) w_1 = \\lambda C_{11} w_1\n$$\n这是一个形式为 $A x = \\lambda B x$ 的广义特征值问题，其中 $A = C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}$ 且 $B = C_{11}$。该系统的最大特征值 $\\lambda_{\\max}$ 等于最优相干性的平方 $\\gamma_{\\star}^2$。对应的特征矢量 $w_1$ 就是最优极化矢量 $w_{1,\\star}$。一旦 $w_{1,\\star}$ 已知，相应的 $w_{2,\\star}$ 可以从步骤 1 中的最大化条件找到，这导致 $w_{2,\\star}$ 与 $C_{22}^{-1} C_{12}^{\\mathrm{H}} w_{1,\\star}$ 成比例。这就完成了等价广义特征值公式的推导。\n\n在实现上，SVD 方法通常在数值上更稳定。最优矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$ 通过将奇异矢量变换回原始空间来找到：\n$$\nw_{1,\\star}^{\\text{raw}} = C_{11}^{-1/2} v_{1,\\star} \\quad \\text{和} \\quad w_{2,\\star}^{\\text{raw}} = C_{22}^{-1/2} v_{2,\\star}\n$$\n为了严格执行约束条件，特别是在使用正则化时，需要应用一个最终的归一化步骤：\n$$\nw_{1,\\star} = \\frac{w_{1,\\star}^{\\text{raw}}}{\\sqrt{w_{1,\\star}^{\\text{raw H}} C_{11} w_{1,\\star}^{\\text{raw}}}} \\quad \\text{和} \\quad w_{2,\\star} = \\frac{w_{2,\\star}^{\\text{raw}}}{\\sqrt{w_{2,\\star}^{\\text{raw H}} C_{22} w_{2,\\star}^{\\text{raw}}}}\n$$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR coherence optimization problem for three test cases.\n    \"\"\"\n    \n    epsilon = 1e-8\n\n    def compute_regularized_inverse_sqrt(C, e):\n        \"\"\"\n        Computes the Tikhonov-regularized inverse square root of a Hermitian matrix C.\n        C_inv_sqrt = Q * diag(1/sqrt(lambda_i + e)) * Q^H\n        \"\"\"\n        lambdas, Q = np.linalg.eigh(C)  # Eigenvalues are sorted in ascending order\n        \n        # Add epsilon to eigenvalues for regularization\n        # For a PSD matrix C, all lambdas are non-negative.\n        lambdas_reg = lambdas + e\n        \n        # Compute 1/sqrt of regularized eigenvalues\n        d_inv_sqrt_vals = 1.0 / np.sqrt(lambdas_reg)\n        \n        # Form the diagonal matrix of these values\n        D_inv_sqrt = np.diag(d_inv_sqrt_vals)\n        \n        # Reconstruct the matrix: Q @ D @ Q.conj().T\n        C_inv_sqrt = Q @ D_inv_sqrt @ Q.conj().T\n        \n        return C_inv_sqrt\n\n    def process_case(C11, C22, C12, eps):\n        \"\"\"\n        Processes a single test case to find optimal coherence and vectors.\n        \"\"\"\n        # Step 1: Compute regularized inverse square roots of C11 and C22\n        C11_inv_sqrt = compute_regularized_inverse_sqrt(C11, eps)\n        C22_inv_sqrt = compute_regularized_inverse_sqrt(C22, eps)\n        \n        # Step 2: Form the matrix K\n        K = C11_inv_sqrt @ C12 @ C22_inv_sqrt\n        \n        # Step 3: Compute the SVD of K\n        # U columns are left singular vectors, s are singular values, Vh is V hermitian\n        U, s, Vh = np.linalg.svd(K)\n        \n        # Step 4: Extract optimal coherence and transformed vectors\n        # The largest singular value is the optimal coherence\n        gamma_star = s[0]\n        \n        # The principal left singular vector (first column of U)\n        v1_star = U[:, 0]\n        # The principal right singular vector (first column of V, or conj().T of first row of Vh)\n        v2_star = Vh[0, :].conj()\n        \n        # Step 5: Transform vectors back to the original space\n        w1_raw = C11_inv_sqrt @ v1_star\n        w2_raw = C22_inv_sqrt @ v2_star\n        \n        # Step 6: Renormalize the vectors to satisfy the constraints, which is critical\n        # especially when regularization is active.\n        norm1_sq = (w1_raw.conj().T @ C11 @ w1_raw).real\n        w1_star = w1_raw / np.sqrt(norm1_sq) if norm1_sq > 0 else w1_raw\n\n        norm2_sq = (w2_raw.conj().T @ C22 @ w2_raw).real\n        w2_star = w2_raw / np.sqrt(norm2_sq) if norm2_sq > 0 else w2_raw\n        \n        # Prepare results for output\n        gamma_out = np.round(gamma_star, 6)\n        w1_real_out = np.round(w1_star.real, 6).tolist()\n        w1_imag_out = np.round(w1_star.imag, 6).tolist()\n        w2_real_out = np.round(w2_star.real, 6).tolist()\n        w2_imag_out = np.round(w2_star.imag, 6).tolist()\n        \n        return [gamma_out, w1_real_out, w1_imag_out, w2_real_out, w2_imag_out]\n\n    # Define Test Cases\n    # Case 1\n    C11_1 = np.diag([4.0, 3.0, 2.5])\n    C22_1 = np.diag([3.8, 2.8, 2.2])\n    C12_1 = np.diag([\n        np.sqrt(4.0 * 3.8) * 0.72 * np.exp(1j * 0.1),\n        np.sqrt(3.0 * 2.8) * 0.50 * np.exp(1j * -0.2),\n        np.sqrt(2.5 * 2.2) * 0.35 * np.exp(1j * 0.05)\n    ])\n\n    # Case 2\n    C11_2 = np.diag([2.0, 1.5, 1.0])\n    C22_2 = np.diag([1.8, 1.2, 0.8])\n    C12_2 = np.zeros((3, 3), dtype=np.complex128)\n\n    # Case 3\n    C11_3 = np.diag([4.0, 0.0, 1.5])\n    C22_3 = np.diag([3.5, 2.0, 1.2])\n    C12_3 = np.diag([\n        np.sqrt(4.0 * 3.5) * 0.30 * np.exp(1j * 0.3),\n        0.0,\n        np.sqrt(1.5 * 1.2) * 0.90 * np.exp(1j * -0.15)\n    ])\n    \n    test_cases = [\n        (C11_1, C22_1, C12_1),\n        (C11_2, C22_2, C12_2),\n        (C11_3, C22_3, C12_3)\n    ]\n    \n    results = []\n    for C11, C22, C12 in test_cases:\n        results.append(process_case(C11, C22, C12, epsilon))\n    \n    # Format the final output string\n    def format_list(data):\n        return '[' + ','.join(map(str, data)) + ']'\n        \n    formatted_results = []\n    for res in results:\n        gamma_str = f\"{res[0]:.6f}\"\n        w1r_str = format_list([f\"{x:.6f}\" for x in res[1]])\n        w1i_str = format_list([f\"{x:.6f}\" for x in res[2]])\n        w2r_str = format_list([f\"{x:.6f}\" for x in res[3]])\n        w2i_str = format_list([f\"{x:.6f}\" for x in res[4]])\n        formatted_results.append(f\"[{gamma_str},{w1r_str},{w1i_str},{w2r_str},{w2i_str}]\")\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}