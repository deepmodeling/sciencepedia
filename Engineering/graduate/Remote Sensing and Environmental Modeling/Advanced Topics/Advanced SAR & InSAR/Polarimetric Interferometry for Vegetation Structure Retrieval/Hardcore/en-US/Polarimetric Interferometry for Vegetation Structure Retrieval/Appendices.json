{
    "hands_on_practices": [
        {
            "introduction": "The ability of interferometric radar to measure height relies on the precise relationship between the path length difference of the signals and the resulting phase shift. This exercise establishes that fundamental link by introducing the vertical wavenumber, $k_z$, which quantifies the sensitivity of the interferometric phase to changes in target height. By working through this problem, you will derive this crucial parameter from first principles and confront the inherent ambiguity of phase measurements, leading to the concept of the maximum unambiguous height. ",
            "id": "3834633",
            "problem": "A Polarimetric Interferometric Synthetic Aperture Radar (PolInSAR) experiment is conducted with two Synthetic Aperture Radar (SAR) acquisitions separated by a perpendicular baseline. In vegetation, the interferometric phase can be referenced to the ground by exploiting polarimetric separation of scattering mechanisms, so that the relative phase between the vegetation volume and the ground is used to estimate vegetation height. Starting from first principles of interferometry, consider the following tasks:\n\n1. Define phase wrapping in interferometry and explain its consequence for any measured interferometric phase.\n2. Using the relation between interferometric phase and path length difference, derive the vertical wavenumber $k_{z}$ that links a small change in height $\\Delta h$ to the corresponding interferometric phase change $\\Delta \\varphi$ through $\\Delta \\varphi \\approx k_{z} \\Delta h$. Express $k_{z}$ in terms of the radar wavelength $\\lambda$, the perpendicular baseline $B_{\\perp}$, the slant range $R$, and the incidence angle $\\theta$.\n3. Given that the interferometric phase is wrapped modulo $2\\pi$, argue from first principles what the unambiguous height interval must be in terms of $k_{z}$, and state the condition on vegetation height for unique retrieval when the ground phase is known.\n4. For a PolInSAR system with parameters $\\lambda = 0.24 \\ \\mathrm{m}$, $B_{\\perp} = 30 \\ \\mathrm{m}$, $R = 25{,}000 \\ \\mathrm{m}$, and $\\theta = 40^\\circ$, compute the maximum unambiguous canopy height $H_{\\max}$ implied by the condition you derived. Round your final numerical result to four significant figures and express it in meters. Angles must be treated in degrees.",
            "solution": "The problem statement is evaluated to be scientifically grounded, well-posed, objective, and self-contained. It describes a standard application of Polarimetric Interferometric Synthetic Aperture Radar (PolInSAR) for vegetation height estimation. The tasks involve fundamental definitions, a standard derivation, logical reasoning based on first principles, and a final calculation with realistic parameters. The problem is therefore deemed valid.\n\nThe solution proceeds by addressing the four tasks in order.\n\n1. Phase Wrapping in Interferometry\n\nThe measured quantity in radar interferometry is the interferometric phase, $\\varphi$, which is the argument of the complex-valued interferogram. The interferogram is formed by multiplying a pixel from one SAR image, $s_1$, with the complex conjugate of the corresponding pixel from a second SAR image, $s_2^*$. The phase is computed using an arctangent function, typically `atan2`, which restricts the output to a principal interval, usually $(-\\pi, \\pi]$ or $[0, 2\\pi)$.\n\nThis process is known as phase wrapping. The true interferometric phase, $\\varphi_{\\text{true}}$, which is proportional to the path length difference, can be any real number. However, the measured phase, $\\varphi_{\\text{wrapped}}$, is wrapped into the principal interval. The relationship between the true and wrapped phase is given by:\n$$ \\varphi_{\\text{true}} = \\varphi_{\\text{wrapped}} + 2 \\pi n $$\nwhere $n$ is an unknown integer representing the number of full $2\\pi$ cycles.\n\nThe consequence of phase wrapping is that the measured phase is inherently ambiguous. A measured phase of, for example, $\\frac{\\pi}{4}$ could correspond to a true phase of $\\frac{\\pi}{4}$, $\\frac{9\\pi}{4}$, $-\\frac{7\\pi}{4}$, and so on. To recover the absolute phase difference across the scene, a process called phase unwrapping is required, which aims to estimate the correct integer $n$ for each pixel relative to its neighbors.\n\n2. Derivation of the Vertical Wavenumber $k_z$\n\nWe begin from the first principles of interferometric SAR geometry. The interferometric phase, $\\varphi$, is directly proportional to the path length difference, $\\Delta R$, between the two radar acquisitions for a two-way propagation path. This relationship is:\n$$ \\varphi = \\frac{4\\pi}{\\lambda} \\Delta R $$\nwhere $\\lambda$ is the radar wavelength. The factor of $4\\pi$ arises from the two-way travel of the radar signal (to the target and back).\n\nConsider a side-looking SAR geometry where a target is observed from two positions separated by a baseline $B$. Let $\\theta$ be the look angle (measured from nadir) and $R$ be the slant range to the target from the master antenna. The path difference $\\Delta R$ can be approximated for a small baseline ($B \\ll R$) as the projection of the baseline vector onto the look direction. For a baseline with perpendicular component $B_{\\perp}$ (component perpendicular to the line-of-sight vector), the phase-height relationship is derived by considering how the phase changes with a small vertical displacement of the target, $\\Delta h$.\n\nThe height of a target, $h$, above a reference surface is related to the slant range $R$ and look angle $\\theta$ by $h = H - R\\cos\\theta$, where $H$ is the sensor altitude. For a small change in height $dh$ at a fixed ground range ($x=R\\sin\\theta = \\text{constant}$), the corresponding change in look angle $d\\theta$ can be found.\nDifferentiating the ground range expression gives $dx = \\sin\\theta dR + R\\cos\\theta d\\theta = 0$, which implies $dR = -R\\cot\\theta d\\theta$.\nDifferentiating the height expression gives $dh = - \\cos\\theta dR + R\\sin\\theta d\\theta$. Substituting for $dR$:\n$$ dh = - \\cos\\theta (-R\\cot\\theta d\\theta) + R\\sin\\theta d\\theta = R\\frac{\\cos^2\\theta}{\\sin\\theta}d\\theta + R\\sin\\theta d\\theta = \\frac{R}{\\sin\\theta}(\\cos^2\\theta + \\sin^2\\theta)d\\theta = \\frac{R}{\\sin\\theta} d\\theta $$\nThis gives the relationship between a change in height and a change in look angle:\n$$ d\\theta = \\frac{\\sin\\theta}{R} dh $$\nThe interferometric phase can be expressed as a function of the look angle $\\theta$. The path difference $\\Delta R$ is well approximated as $\\Delta R \\approx \\frac{B_\\perp}{\\sin\\theta} \\sin\\theta'$, where $\\theta'$ is the angle to the target. A more direct approach is to relate the phase to height via differentiation. It is a standard result that the interferometric phase variation is predominantly sensitive to the perpendicular baseline $B_\\perp$ and the change in look angle $d\\theta$. The phase difference can be locally approximated as a linear function of look angle separation:\n$$ \\varphi(\\theta) \\approx \\frac{4\\pi}{\\lambda} B_{\\perp} $$\nThis expression is incomplete. The full expression for phase as a function of height is $\\varphi \\approx \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} h$. The vertical wavenumber $k_z$ is the rate of change of phase with height, $k_z = \\frac{d\\varphi}{dh}$.\nFrom a more rigorous derivation found in interferometry literature, the phase $\\varphi$ is related to height $h$ for a point scatterer as:\n$$ \\varphi \\approx \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} h $$\nTaking the derivative with respect to height $h$ directly gives the vertical wavenumber $k_z$.\n$$ k_z = \\frac{d\\varphi}{dh} = \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} $$\nThus, for a small change in height $\\Delta h$, the phase change $\\Delta \\varphi$ is approximately:\n$$ \\Delta \\varphi \\approx k_z \\Delta h $$\n\n3. Unambiguous Height Interval\n\nAs established in part 1, any measured interferometric phase is wrapped into the range $(-\\pi, \\pi]$ or $[0, 2\\pi)$. This means that phase differences are only known modulo $2\\pi$. The relationship $\\Delta \\varphi \\approx k_z \\Delta h$ links a height difference to a phase difference. If the total phase change across the full height of the vegetation, $H_{\\text{veg}}$, exceeds $2\\pi$, ambiguity arises.\nSpecifically, a height $h$ becomes indistinguishable from a height $h + \\Delta h_{\\text{amb}}$ if their corresponding phases are separated by an integer multiple of $2\\pi$. The smallest height difference that leads to this ambiguity corresponds to a phase change of $2\\pi$. This height is called the \"height of ambiguity\" or the unambiguous height interval, which we denote $H_{2\\pi}$.\n$$ |k_z| H_{2\\pi} = 2\\pi $$\nSolving for this interval gives:\n$$ H_{2\\pi} = \\frac{2\\pi}{|k_z|} $$\nFor the unique retrieval of vegetation height $H_{\\text{veg}}$ (assuming the ground phase is known, providing a reference), the total phase change from the ground to the top of the canopy must be less than one full cycle. This imposes the condition:\n$$ |k_z| H_{\\text{veg}}  2\\pi $$\nTherefore, the condition on vegetation height for unique retrieval is that it must be less than the height of ambiguity:\n$$ H_{\\text{veg}}  H_{2\\pi} = \\frac{2\\pi}{|k_z|} $$\n\n4. Calculation of Maximum Unambiguous Canopy Height\n\nThe maximum unambiguous canopy height, $H_{\\text{max}}$, is equivalent to the height of ambiguity, $H_{2\\pi}$. We substitute the expression for $k_z$ derived in part 2 into the formula from part 3.\n$$ H_{\\text{max}} = \\frac{2\\pi}{|k_z|} = \\frac{2\\pi}{\\left| \\frac{4\\pi B_\\perp}{\\lambda R \\sin\\theta} \\right|} = \\frac{2\\pi \\lambda R \\sin\\theta}{4\\pi B_\\perp} = \\frac{\\lambda R \\sin\\theta}{2 B_\\perp} $$\nWe are given the following parameters:\n- Wavelength $\\lambda = 0.24 \\ \\mathrm{m}$\n- Perpendicular baseline $B_\\perp = 30 \\ \\mathrm{m}$\n- Slant range $R = 25000 \\ \\mathrm{m}$\n- Incidence angle $\\theta = 40^\\circ$\n\nSubstituting these values into the expression for $H_{\\text{max}}$:\n$$ H_{\\text{max}} = \\frac{(0.24) \\times (25000) \\times \\sin(40^\\circ)}{2 \\times (30)} $$\n$$ H_{\\text{max}} = \\frac{6000 \\times \\sin(40^\\circ)}{60} = 100 \\times \\sin(40^\\circ) $$\nUsing the value for $\\sin(40^\\circ) \\approx 0.6427876$:\n$$ H_{\\text{max}} \\approx 100 \\times 0.6427876 = 64.27876 \\ \\mathrm{m} $$\nRounding the result to four significant figures, as required:\n$$ H_{\\text{max}} \\approx 64.28 \\ \\mathrm{m} $$\nThis is the maximum canopy height that can be unambiguously measured by this PolInSAR system configuration.",
            "answer": "$$\\boxed{64.28}$$"
        },
        {
            "introduction": "In forested environments, the radar signal is a complex mixture of scattering from the ground surface and the overlying vegetation volume. The Random Volume over Ground (RVoG) model provides a powerful framework for disentangling these contributions. This practice offers a hands-on simulation of the RVoG model, where you will first construct synthetic polarimetric interferometric data and then apply a geometric line-fitting algorithm to estimate the ground's interferometric phase, a critical step towards isolating the vegetation component and retrieving its height. ",
            "id": "3834626",
            "problem": "You are given a synthetic Polarimetric Interferometric Synthetic Aperture Radar (PolInSAR) scene comprising two scattering mechanisms: a ground surface component and a vegetation volume component. The goal is to construct polarization-dependent interferometric coherences under a physically grounded mixture model and then estimate the common ground interferometric phase $\\phi_g$ from the phase behavior across polarizations.\n\nBase your derivation and implementation on core definitions. Use the following as your starting point:\n\n- Synthetic Aperture Radar (SAR) and Interferometric SAR (InSAR) coherences are defined by the normalized complex correlation between two acquisitions. For a single polarization $p$, the interferometric coherence is defined as\n$$\n\\gamma_p \\triangleq \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}} \\, ,\n$$\nwhere $s_{1,p}$ and $s_{2,p}$ denote the complex SAR signals of polarization $p$ in the first and second acquisitions, respectively.\n\n- The volume contribution is modeled as a vertically distributed backscatter with a polarization-dependent extinction profile. Let the polarization-dependent backscatter weight be $f_p(z) = e^{-\\xi_p z}$ for a canopy of thickness $H$ (in meters), where $\\xi_p$ (in inverse meters) is the polarization-dependent extinction parameter and $z$ is the height coordinate. The interferometric volume coherence is the normalized weighted Fourier transform of the vertical profile evaluated at the vertical wavenumber $k_z$ (in radians per meter):\n$$\n\\gamma_{v,p} \\triangleq \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz} \\, .\n$$\n\n- The ground contribution is a single phase center with interferometric phase $\\phi_g$ (in radians), modeled as a deterministic complex phasor $e^{j \\phi_g}$.\n\nAssume for each polarization $p$ that the total backscatter is an independent sum of ground and volume components whose powers are proportional to polarization-dependent nonnegative weights $a_p^2$ for ground and $b_p^2$ for volume. Let the ground and volume components be mutually uncorrelated. Under these assumptions and using the above definition of interferometric coherence, construct the polarization-dependent synthetic interferometric coherences $\\gamma_p$.\n\nThen, exploit the geometrical property that for each polarization $p$, the complex coherence $\\gamma_p$ lies on a line in the complex plane connecting the volume coherence $\\gamma_{v,p}$ and the ground phasor $e^{j \\phi_g}$. Using three linear polarization channels $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$ with distinct extinction parameters and mixture weights, estimate $\\phi_g$ by finding the point in the complex plane that is the least-squares intersection of these lines and taking its argument.\n\nYour program must:\n\n1. For each provided test case, compute $\\gamma_{v,p}$ using the integral definition above for $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$.\n2. Construct $\\gamma_p$ for each polarization under the independent mixture model detailed in this problem.\n3. Estimate $\\phi_g$ by solving a least-squares intersection-of-lines problem across the three polarizations, where each line is defined by a point $\\gamma_{v,p}$ and a direction vector $\\gamma_p - \\gamma_{v,p}$.\n4. Output the estimated $\\phi_g$ in radians for each test case, rounded to six decimal places.\n\nPhysical units and angle unit requirements:\n- The canopy thickness $H$ must be in meters.\n- The extinction parameters $\\xi_p$ must be in inverse meters.\n- The vertical wavenumber $k_z$ must be in radians per meter.\n- The ground phase $\\phi_g$ must be estimated and output in radians.\n\nTest suite and parameters:\nUse exactly the following test suite. Each test case defines $H$, $k_z$, $\\phi_g$ (true, used only to generate the synthetic coherences), extinction parameters $\\xi_p$, and mixture weights $(a_p, b_p)$ for $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$.\n\n- Test case 1 (general case):\n  - $H = 20$\n  - $k_z = 0.2$\n  - $\\phi_g = 0.8$\n  - $\\xi_{\\text{HH}} = 0.12$, $\\xi_{\\text{HV}} = 0.30$, $\\xi_{\\text{VV}} = 0.08$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.7, 0.3)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.2, 0.8)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.6, 0.4)$\n\n- Test case 2 (small vertical wavenumber boundary):\n  - $H = 25$\n  - $k_z = 0.01$\n  - $\\phi_g = -1.0$\n  - $\\xi_{\\text{HH}} = 0.18$, $\\xi_{\\text{HV}} = 0.28$, $\\xi_{\\text{VV}} = 0.10$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.5, 0.5)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.1, 0.9)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.4, 0.6)$\n\n- Test case 3 (large vertical wavenumber edge case with strong volume in cross-polarization):\n  - $H = 15$\n  - $k_z = 0.5$\n  - $\\phi_g = 1.5$\n  - $\\xi_{\\text{HH}} = 0.20$, $\\xi_{\\text{HV}} = 0.40$, $\\xi_{\\text{VV}} = 0.12$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.8, 0.2)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.15, 0.85)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.7, 0.3)$\n\nFinal output format:\nYour program should produce a single line of output containing the estimated ground phases for the three test cases as a comma-separated list enclosed in square brackets, in radians, rounded to six decimal places (for example, $\\left[\\phi_1,\\phi_2,\\phi_3\\right]$ becomes a string like \"[0.800000,-1.000000,1.500000]\").",
            "solution": "The problem is valid as it is scientifically grounded in the principles of polarimetric interferometry, well-posed with a clear objective and sufficient data, and formulated objectively. The task is to estimate the ground interferometric phase, $\\phi_g$, from synthetic Polarimetric Interferometric Synthetic Aperture Radar (PolInSAR) data based on the Random Volume over Ground (RVoG) model.\n\nThe solution proceeds in four stages:\n1.  Derivation of the composite interferometric coherence, $\\gamma_p$, for a mixed ground-volume scatterer.\n2.  Analytical calculation of the pure volume coherence, $\\gamma_{v,p}$.\n3.  Formulation of the ground phase estimation as a least-squares line intersection problem.\n4.  Application of this framework to the provided test cases.\n\n**1. Composite Interferometric Coherence Model**\n\nThe problem provides the definition of interferometric coherence for a single polarization channel $p$ as:\n$$\n\\gamma_p = \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}}\n$$\nwhere $s_{1,p}$ and $s_{2,p}$ are the complex SAR signals from two acquisitions. Assuming statistical stationarity, the denominator simplifies to $\\mathbb{E}\\left[|s_p|^2\\right]$.\n\nThe total signal $s_p$ is modeled as an independent sum of a ground component $s_{g,p}$ and a volume component $s_{v,p}$: $s_{p} = s_{g,p} + s_{v,p}$. The problem states that these components are mutually uncorrelated, meaning $\\mathbb{E}\\left[s_{g,p} s_{v,p}^\\ast\\right] = 0$.\n\nThe correlation term in the numerator of $\\gamma_p$ becomes:\n$$\n\\mathbb{E}\\left[s_{1,p}s_{2,p}^\\ast\\right] = \\mathbb{E}\\left[(s_{1,g,p} + s_{1,v,p})(s_{2,g,p}^\\ast + s_{2,v,p}^\\ast)\\right] = \\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] + \\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right]\n$$\nThe total power in the denominator becomes:\n$$\n\\mathbb{E}\\left[|s_p|^2\\right] = \\mathbb{E}\\left[|s_{g,p} + s_{v,p}|^2\\right] = \\mathbb{E}\\left[|s_{g,p}|^2\\right] + \\mathbb{E}\\left[|s_{v,p}|^2\\right]\n$$\nLet $P_{g,p} = \\mathbb{E}\\left[|s_{g,p}|^2\\right]$ be the ground power and $P_{v,p} = \\mathbb{E}\\left[|s_{v,p}|^2\\right]$ be the volume power.\n\nThe ground-only coherence is given as the phasor $e^{j\\phi_g}$, and the volume-only coherence is $\\gamma_{v,p}$. By definition, we can write:\n$\\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] = P_{g,p} e^{j\\phi_g}$\n$\\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right] = P_{v,p} \\gamma_{v,p}$\n\nSubstituting these into the expression for $\\gamma_p$ yields:\n$$\n\\gamma_p = \\frac{P_{g,p} e^{j\\phi_g} + P_{v,p} \\gamma_{v,p}}{P_{g,p} + P_{v,p}}\n$$\nThe problem states that the ground and volume powers are proportional to $a_p^2$ and $b_p^2$, respectively. Defining the ground-to-volume power ratio as $\\mu_p = P_{g,p}/P_{v,p} = a_p^2/b_p^2$, we can rewrite the coherence as:\n$$\n\\gamma_p = \\frac{\\mu_p e^{j\\phi_g} + \\gamma_{v,p}}{\\mu_p + 1}\n$$\nThis equation shows that the observed coherence $\\gamma_p$ is a complex weighted average of the ground phasor $e^{j\\phi_g}$ and the volume coherence $\\gamma_{v,p}$. Geometrically, the point $\\gamma_p$ lies on the line segment in the complex plane connecting the points $\\gamma_{v,p}$ and $e^{j\\phi_g}$. This is the fundamental insight of the RVoG model.\n\n**2. Volume Coherence Calculation**\n\nThe volume coherence $\\gamma_{v,p}$ is defined by the normalized Fourier transform of the vertical backscatter profile $f_p(z) = e^{-\\xi_p z}$:\n$$\n\\gamma_{v,p} = \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz}\n$$\nThe integral in the numerator is:\n$$\n\\int_{0}^{H} e^{-\\xi_p z} e^{j k_z z} \\, dz = \\int_{0}^{H} e^{(j k_z - \\xi_p) z} \\, dz = \\left[ \\frac{e^{(j k_z - \\xi_p) z}}{j k_z - \\xi_p} \\right]_{0}^{H} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p}\n$$\nThe integral in the denominator is:\n$$\n\\int_{0}^{H} e^{-\\xi_p z} \\, dz = \\left[ \\frac{e^{-\\xi_p z}}{-\\xi_p} \\right]_{0}^{H} = \\frac{e^{-\\xi_p H} - 1}{-\\xi_p} = \\frac{1 - e^{-\\xi_p H}}{\\xi_p}\n$$\nCombining these results gives the analytical expression for the volume coherence:\n$$\n\\gamma_{v,p} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p} \\left( \\frac{\\xi_p}{1 - e^{-\\xi_p H}} \\right)\n$$\nThis formula is used to compute $\\gamma_{v,p}$ for each polarization channel $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$. Note that for the special case $\\xi_p=0$, L'Hôpital's rule can be used to show the formula correctly limits to $\\gamma_{v,p}|_{\\xi_p=0} = \\frac{e^{j k_z H} - 1}{j k_z H}$.\n\n**3. Least-Squares Estimation of Ground Phase**\n\nFor each of the three polarizations $p_i$ (where $i \\in \\{1, 2, 3\\}$ corresponds to HH, HV, VV), the observed coherence $\\gamma_{p_i}$ and the volume coherence $\\gamma_{v,p_i}$ define a line in the complex plane. The unknown ground phasor, let's call it $G = e^{j\\phi_g}$, lies on all three of these lines. In a noise-free synthetic scenario as this one, these three lines will intersect at a single point, $G$. To find this intersection, we formulate an overdetermined system and solve it using least squares, as requested.\n\nLet a point in the complex plane be represented by a $2$D vector of its real and imaginary parts. The ground point is $\\mathbf{g} = (\\text{Re}\\{G\\}, \\text{Im}\\{G\\})$. For each polarization $i$, the line passes through the point $\\mathbf{v}_i = (\\text{Re}\\{\\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{v,p_i}\\})$ and is parallel to the direction vector $\\mathbf{d}_i = (\\text{Re}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\})$.\n\nThe equation of line $i$ can be expressed using a unit normal vector $\\mathbf{n}_i$. The direction vector is $\\mathbf{d}_i = (d_{ix}, d_{iy})$; a normal vector is $(-d_{iy}, d_{ix})$. The unit normal is $\\mathbf{n}_i = \\frac{1}{||\\mathbf{d}_i||}(-d_{iy}, d_{ix}) = (n_{ix}, n_{iy})$. The equation for a point $\\mathbf{x}=(x,y)$ on the line is $\\mathbf{n}_i \\cdot (\\mathbf{x} - \\mathbf{v}_i) = 0$.\n\nWe seek the point $\\mathbf{g}=(x_g, y_g)$ that minimizes the sum of squared distances to these three lines. The squared distance from $\\mathbf{g}$ to line $i$ is $(\\mathbf{n}_i \\cdot (\\mathbf{g} - \\mathbf{v}_i))^2$. The minimization problem is:\n$$\n\\min_{x_g, y_g} \\sum_{i=1}^{3} (\\mathbf{n}_i \\cdot \\mathbf{g} - \\mathbf{n}_i \\cdot \\mathbf{v}_i)^2\n$$\nThis is a standard linear least-squares problem of the form $\\min_{\\mathbf{x}} ||\\mathbf{A}\\mathbf{x} - \\mathbf{c}||^2$, where:\n$$\n\\mathbf{A} = \\begin{pmatrix} n_{1x}  n_{1y} \\\\ n_{2x}  n_{2y} \\\\ n_{3x}  n_{3y} \\end{pmatrix}, \\quad \\mathbf{x} = \\begin{pmatrix} x_g \\\\ y_g \\end{pmatrix}, \\quad \\mathbf{c} = \\begin{pmatrix} \\mathbf{n}_1 \\cdot \\mathbf{v}_1 \\\\ \\mathbf{n}_2 \\cdot \\mathbf{v}_2 \\\\ \\mathbf{n}_3 \\cdot \\mathbf{v}_3 \\end{pmatrix}\n$$\nThe solution is given by the normal equations: $(\\mathbf{A}^T \\mathbf{A}) \\mathbf{x} = \\mathbf{A}^T \\mathbf{c}$. The estimated ground point coordinates $\\mathbf{x}$ are found by solving this $2 \\times 2$ linear system.\n\n**4. Final Phase Estimation**\n\nOnce the least-squares solution $\\mathbf{x} = (\\hat{x}_g, \\hat{y}_g)$ is found, this vector corresponds to the estimated complex ground phasor $\\hat{G} = \\hat{x}_g + j\\hat{y}_g$. The estimated ground phase $\\hat{\\phi}_g$ is the argument of this complex number:\n$$\n\\hat{\\phi}_g = \\arg(\\hat{G}) = \\text{atan2}(\\hat{y}_g, \\hat{x}_g)\n$$\nThis procedure is applied to each test case to find the respective estimated ground phases. Since the synthetic data are noise-free, the estimated phase $\\hat{\\phi}_g$ should perfectly match the true phase $\\phi_g$ used for data generation, up to numerical precision.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR ground phase estimation problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            'H': 20.0, 'kz': 0.2, 'phi_g': 0.8,\n            'pols': {\n                'HH': {'xi': 0.12, 'a': 0.7, 'b': 0.3},\n                'HV': {'xi': 0.30, 'a': 0.2, 'b': 0.8},\n                'VV': {'xi': 0.08, 'a': 0.6, 'b': 0.4}\n            }\n        },\n        {\n            'H': 25.0, 'kz': 0.01, 'phi_g': -1.0,\n            'pols': {\n                'HH': {'xi': 0.18, 'a': 0.5, 'b': 0.5},\n                'HV': {'xi': 0.28, 'a': 0.1, 'b': 0.9},\n                'VV': {'xi': 0.10, 'a': 0.4, 'b': 0.6}\n            }\n        },\n        {\n            'H': 15.0, 'kz': 0.5, 'phi_g': 1.5,\n            'pols': {\n                'HH': {'xi': 0.20, 'a': 0.8, 'b': 0.2},\n                'HV': {'xi': 0.40, 'a': 0.15, 'b': 0.85},\n                'VV': {'xi': 0.12, 'a': 0.7, 'b': 0.3}\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        estimated_phi_g = estimate_ground_phase(case)\n        results.append(estimated_phi_g)\n\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef compute_gamma_v(H, kz, xi):\n    \"\"\"\n    Computes the pure volume interferometric coherence gamma_v.\n    \n    Args:\n        H (float): Canopy thickness in meters.\n        kz (float): Vertical wavenumber in radians per meter.\n        xi (float): Polarization-dependent extinction in inverse meters.\n    \n    Returns:\n        complex: The volume coherence gamma_v.\n    \"\"\"\n    if np.isclose(xi, 0.0):\n        # Handle the zero-extinction case\n        if np.isclose(kz, 0.0):\n            return 1.0 + 0.0j\n        num = np.exp(1j * kz * H) - 1.0\n        den = 1j * kz * H\n        return num / den\n    else:\n        # General case for non-zero extinction\n        num_term = 1j * kz - xi\n        num = (np.exp(num_term * H) - 1.0) / num_term\n        \n        den_term = -xi\n        den = (np.exp(den_term * H) - 1.0) / den_term\n        \n        return num / den\n\ndef estimate_ground_phase(case_params):\n    \"\"\"\n    Estimates the ground phase for a single test case.\n    \n    Args:\n        case_params (dict): A dictionary containing all parameters for one case.\n    \n    Returns:\n        float: The estimated ground phase phi_g in radians.\n    \"\"\"\n    H = case_params['H']\n    kz = case_params['kz']\n    phi_g_true = case_params['phi_g']\n    \n    gamma_v_points = []\n    gamma_p_points = []\n    \n    # polarization channels are ordered to be deterministic (HH, HV, VV)\n    pol_channels = ['HH', 'HV', 'VV']\n\n    for p_name in pol_channels:\n        p_params = case_params['pols'][p_name]\n        xi = p_params['xi']\n        a = p_params['a']\n        b = p_params['b']\n        \n        # 1. Compute volume-only coherence\n        gamma_v = compute_gamma_v(H, kz, xi)\n        \n        # 2. Synthesize total coherence using the true ground phase\n        g_phasor = np.exp(1j * phi_g_true)\n        mu = (a / b)**2\n        gamma_p = (mu * g_phasor + gamma_v) / (mu + 1.0)\n        \n        gamma_v_points.append(gamma_v)\n        gamma_p_points.append(gamma_p)\n        \n    # 3. Formulate and solve the least-squares intersection-of-lines problem\n    num_pols = len(pol_channels)\n    A = np.zeros((num_pols, 2))\n    c_vec = np.zeros(num_pols)\n    \n    for i in range(num_pols):\n        v = gamma_v_points[i]\n        p = gamma_p_points[i]\n        \n        # Direction vector of the line in the complex plane\n        d_vec = p - v\n        \n        # Handle case where v and p are the same (pure volume)\n        if np.isclose(np.abs(d_vec), 0.0):\n            # This line provides no information on the ground point,\n            # but to avoid division by zero we can skip it or handle it.\n            # In a robust implementation, this line might be weighted out.\n            # Here we can just set its normal to zero.\n            nx, ny = 0.0, 0.0\n        else:\n            # Unit normal vector to the line\n            nx = -d_vec.imag / np.abs(d_vec)\n            ny = d_vec.real / np.abs(d_vec)\n        \n        A[i, 0] = nx\n        A[i, 1] = ny\n        c_vec[i] = nx * v.real + ny * v.imag\n        \n    # Solve the normal equations: (A^T A) x = A^T c\n    ATA = A.T @ A\n    ATc = A.T @ c_vec\n    \n    # Since the system is noise-free, the lines intersect perfectly.\n    # The matrix ATA is invertible.\n    solution = np.linalg.solve(ATA, ATc)\n    \n    g_hat = solution[0] + 1j * solution[1]\n    \n    # 4. The estimated phase is the argument of the resulting complex number\n    estimated_phi_g = np.angle(g_hat)\n    \n    return estimated_phi_g\n\nsolve()\n```"
        },
        {
            "introduction": "A key advantage of PolInSAR is the ability to synthesize different polarizations to enhance the quality of the interferometric measurement. Since different polarizations can result in varying levels of coherence, we can mathematically determine the optimal combination that maximizes it, leading to more stable phase estimates and more reliable height retrievals. This practice guides you through the derivation and implementation of this coherence optimization procedure, a cornerstone technique in modern PolInSAR processing that transforms raw covariance data into the most robust possible measurement. ",
            "id": "3834682",
            "problem": "Consider the Polarimetric Interferometric Synthetic Aperture Radar (PolInSAR) coherence optimization problem for vegetation structure retrieval. Let the polarimetric scattering vectors from two repeat-pass acquisitions be represented in a common basis with complex weights. Define the $3 \\times 3$ Hermitian positive semidefinite covariance matrices $C_{11}$ and $C_{22}$ for the first and second acquisition, respectively, and the $3 \\times 3$ cross-covariance matrix $C_{12}$, with $C_{21} = C_{12}^{\\mathrm{H}}$, where $(\\cdot)^{\\mathrm{H}}$ denotes the conjugate transpose. Form the $6 \\times 6$ Hermitian block covariance\n$$\n\\Sigma \\;=\\; \\begin{bmatrix}\nC_{11}  C_{12} \\\\\nC_{21}  C_{22}\n\\end{bmatrix}.\n$$\nThe polarimetric interferometric coherence for complex weight vectors $w_1 \\in \\mathbb{C}^3$ and $w_2 \\in \\mathbb{C}^3$ is defined by the Rayleigh-type quotient\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}.\n$$\nStarting from the core definitions of second-order statistics for complex random vectors and the Cauchy–Schwarz inequality in a weighted inner-product space, derive an equivalent generalized eigenvalue formulation whose principal solution provides the optimal coherence $\\,\\gamma_{\\star}\\,$ and the corresponding polarimetric vectors $\\,w_{1,\\star}\\,$ and $\\,w_{2,\\star}\\,$. Your derivation must begin with the maximization of $\\,\\gamma(w_1, w_2)\\,$ subject to $\\,w_1^{\\mathrm{H}} C_{11} w_1 = 1\\,$ and $\\,w_2^{\\mathrm{H}} C_{22} w_2 = 1\\,$ and proceed by a valid sequence of transformations grounded in linear algebra and probability theory, without introducing any shortcut formulas.\n\nImplementation requirements:\n- Given $\\,\\Sigma\\,$, compute $\\,\\gamma_{\\star}\\,$ and any pair of polarimetric vectors $\\,w_{1,\\star}, w_{2,\\star}\\,$ that achieve the optimum, normalized to satisfy the constraints $\\,w_{1,\\star}^{\\mathrm{H}} C_{11} w_{1,\\star} = 1\\,$ and $\\,w_{2,\\star}^{\\mathrm{H}} C_{22} w_{2,\\star} = 1\\,$.\n- If $\\,C_{11}\\,$ or $\\,C_{22}\\,$ is singular or numerically ill-conditioned, use Tikhonov-regularized inverse square-root factors computed from Hermitian eigen-decompositions. Specifically, for a Hermitian $\\,C\\,$ with eigen-decomposition $\\,C = Q \\Lambda Q^{\\mathrm{H}}\\,$, use $\\,C^{-1/2}_{\\epsilon} = Q \\operatorname{diag}\\!\\left(1/\\sqrt{\\lambda_i + \\epsilon}\\right) Q^{\\mathrm{H}}\\,$ with a fixed $\\,\\epsilon = 10^{-8}\\,$.\n- For each test case, report:\n  1. The optimal coherence $\\,\\gamma_{\\star}\\,$ as a float rounded to six decimal places.\n  2. The real parts of $\\,w_{1,\\star}\\,$ as a list of three floats, each rounded to six decimal places.\n  3. The imaginary parts of $\\,w_{1,\\star}\\,$ as a list of three floats, each rounded to six decimal places.\n  4. The real parts of $\\,w_{2,\\star}\\,$ as a list of three floats, each rounded to six decimal places.\n  5. The imaginary parts of $\\,w_{2,\\star}\\,$ as a list of three floats, each rounded to six decimal places.\n\nTest suite:\nProvide results for the following three scientifically consistent cases that probe typical, zero, and rank-deficient scenarios. Angles are specified in radians.\n\nCase 1 (typical, diagonal covariance with nonzero interferometric phases):\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 3.0,\\; 2.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.8,\\; 2.8,\\; 2.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.8}\\cdot 0.72 \\cdot e^{\\mathrm{i}\\cdot 0.1},\\;\\; \\sqrt{3.0 \\cdot 2.8}\\cdot 0.50 \\cdot e^{\\mathrm{i}\\cdot (-0.2)},\\;\\; \\sqrt{2.5 \\cdot 2.2}\\cdot 0.35 \\cdot e^{\\mathrm{i}\\cdot 0.05}\\Big).\n$$\n\nCase 2 (edge case with zero cross-covariance):\n$$\nC_{11} = \\operatorname{diag}\\!\\left(2.0,\\; 1.5,\\; 1.0\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(1.8,\\; 1.2,\\; 0.8\\right), \\quad\nC_{12} = \\begin{bmatrix}\n0  0  0 \\\\\n0  0  0 \\\\\n0  0  0\n\\end{bmatrix}.\n$$\n\nCase 3 (boundary case with rank-deficient $\\,C_{11}\\,$ and strong coherence in the third channel):\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 0.0,\\; 1.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.5,\\; 2.0,\\; 1.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.5}\\cdot 0.30 \\cdot e^{\\mathrm{i}\\cdot 0.3},\\;\\; 0.0,\\;\\; \\sqrt{1.5 \\cdot 1.2}\\cdot 0.90 \\cdot e^{\\mathrm{i}\\cdot (-0.15)}\\Big).\n$$\n\nFinal output format:\nYour program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets, with no spaces anywhere. Each case’s result should itself be a list of five elements in the order specified above. For example, the output should look like\n$$\n[\\,[\\gamma_1,[\\Re w_{1,1}],[\\Im w_{1,1}],[\\Re w_{2,1}],[\\Im w_{2,1}]],[\\gamma_2,[\\Re w_{1,2}],[\\Im w_{1,2}],[\\Re w_{2,2}],[\\Im w_{2,2}]],[\\gamma_3,[\\Re w_{1,3}],[\\Im w_{1,3}],[\\Re w_{2,3}],[\\Im w_{2,3}]]\\,],\n$$\nwhere all numeric values are rounded to six decimal places and expressed as floats. The program must be self-contained and must not read any input or files.",
            "solution": "The problem is to find the maximum polarimetric interferometric coherence $\\gamma_{\\star}$ and the corresponding polarimetric weight vectors $w_{1,\\star}$ and $w_{2,\\star}$ by maximizing the expression:\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}\n$$\nsubject to the normalization constraints $w_1^{\\mathrm{H}}\\, C_{11}\\, w_1 = 1$ and $w_2^{\\mathrm{H}}\\, C_{22}\\, w_2 = 1$. The matrices $C_{11}$ and $C_{22}$ are Hermitian positive semidefinite.\n\nOur derivation proceeds by transforming the problem into a standard form solvable by linear algebra, and then relating this solution back to a generalized eigenvalue problem as requested.\n\nStep 1: Reformulation through Change of Variables\nThe constraints and the denominator of $\\gamma(w_1, w_2)$ define norms in weighted inner product spaces. To simplify the problem, we can transform the vectors $w_1$ and $w_2$ into a space with the standard Euclidean norm. Let us define new vectors $v_1 \\in \\mathbb{C}^3$ and $v_2 \\in \\mathbb{C}^3$ as:\n$$\nv_1 = C_{11}^{1/2} w_1 \\quad \\text{and} \\quad v_2 = C_{22}^{1/2} w_2\n$$\nwhere $C^{1/2}$ represents the Hermitian square root of a positive semidefinite matrix $C$. If $C_{11}$ or $C_{22}$ are singular, their inverse square roots, needed for the reverse transformation, are not defined. As specified, we handle this by using a Tikhonov-regularized inverse square root, $C^{-1/2}_{\\epsilon}$. Therefore, the inverse transformations are:\n$$\nw_1 = C_{11}^{-1/2} v_1 \\quad \\text{and} \\quad w_2 = C_{22}^{-1/2} v_2\n$$\n(Hereafter, $C^{-1/2}$ implicitly denotes the regularized version $C^{-1/2}_{\\epsilon}$ where necessary).\n\nSubstituting these into the normalization constraints, we get:\n$$\nw_1^{\\mathrm{H}} C_{11} w_1 = (C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{11} (C_{11}^{-1/2} v_1) = v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{11} C_{11}^{-1/2} v_1 = v_1^{\\mathrm{H}} v_1 = 1\n$$\n$$\nw_2^{\\mathrm{H}} C_{22} w_2 = (C_{22}^{-1/2} v_2)^{\\mathrm{H}} C_{22} (C_{22}^{-1/2} v_2) = v_2^{\\mathrm{H}} C_{22}^{-1/2 \\mathrm{H}} C_{22} C_{22}^{-1/2} v_2 = v_2^{\\mathrm{H}} v_2 = 1\n$$\nThis holds exactly if $C_{11}$ and $C_{22}$ are invertible. In the regularized case, $C^{-1/2}_{\\epsilon} C C^{-1/2}_{\\epsilon} \\neq I$, so a final re-normalization of the resulting vectors $w_{1,\\star}$ and $w_{2,\\star}$ will be required. The constraints on the new vectors are simplified to standard unit-norm constraints: $\\|v_1\\| = 1$ and $\\|v_2\\| = 1$.\n\nNow, we substitute the transformations into the numerator of the coherence expression:\n$$\n|w_1^{\\mathrm{H}} C_{12} w_2| = |(C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{12} (C_{22}^{-1/2} v_2)| = |v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{12} C_{22}^{-1/2} v_2|\n$$\nSince $C_{11}$ is Hermitian, its square root and inverse square root are also Hermitian, so $C_{11}^{-1/2 \\mathrm{H}} = C_{11}^{-1/2}$. Let us define a new matrix $K$:\n$$\nK = C_{11}^{-1/2} C_{12} C_{22}^{-1/2}\n$$\nThe optimization problem is now transformed into:\n$$\n\\text{maximize} \\quad |v_1^{\\mathrm{H}} K v_2| \\quad \\text{subject to} \\quad \\|v_1\\| = 1, \\|v_2\\| = 1\n$$\n\nStep 2: Solution via Singular Value Decomposition (SVD)\nThis is a standard problem in linear algebra. The expression $|v_1^{\\mathrm{H}} K v_2|$ is maximized when $v_1$ and $v_2$ are the principal left and right singular vectors of the matrix $K$, respectively. The maximum value achieved is the largest singular value of $K$.\n\nLet the Singular Value Decomposition of $K$ be $K = U S V^{\\mathrm{H}}$, where $U$ and $V$ are unitary matrices whose columns are the left and right singular vectors, and $S$ is a diagonal matrix of real, non-negative singular values, $s_1 \\ge s_2 \\ge \\dots \\ge 0$.\nThe objective function becomes $|v_1^{\\mathrm{H}} U S V^{\\mathrm{H}} v_2|$. Let $v'_1 = U^{\\mathrm{H}} v_1$ and $v'_2 = V^{\\mathrm{H}} v_2$. Since $U$ and $V$ are unitary, $\\|v'_1\\|=\\|v_1\\|=1$ and $\\|v'_2\\|=\\|v_2\\|=1$. The problem is equivalent to maximizing $|v_1'^{\\mathrm{H}} S v_2'|$. Since $S$ is diagonal, this is maximized when $v'_1$ and $v'_2$ are the standard basis vector $e_1 = [1, 0, \\dots, 0]^{\\mathrm{T}}$, which corresponds to the largest singular value $s_1$.\n\nThe optimal coherence is the maximum value:\n$$\n\\gamma_{\\star} = s_{\\max}(K) = s_1\n$$\nThe optimal vectors in the transformed space are the first columns of $U$ and $V$:\n$$\nv_{1,\\star} = u_1 \\quad \\text{and} \\quad v_{2,\\star} = v_1\n$$\n\nStep 3: Derivation of the Equivalent Generalized Eigenvalue Problem\nThe singular values of $K$ are the square roots of the eigenvalues of $K K^{\\mathrm{H}}$. Let's construct this matrix:\n$$\nK K^{\\mathrm{H}} = (C_{11}^{-1/2} C_{12} C_{22}^{-1/2}) (C_{11}^{-1/2} C_{12} C_{22}^{-1/2})^{\\mathrm{H}} = C_{11}^{-1/2} (C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) C_{11}^{-1/2}\n$$\nThe eigenvalue problem for $K K^{\\mathrm{H}}$ is $K K^{\\mathrm{H}} v_1 = \\lambda v_1$, where the eigenvectors are the left singular vectors of $K$, $v_1 = u_i$, and the eigenvalues are the squared singular values, $\\lambda = s_i^2$. For the maximum, $\\lambda_{\\max} = s_{\\max}^2 = \\gamma_{\\star}^2$.\nSubstituting the expression for $K K^{\\mathrm{H}}$:\n$$\n(C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) v_1 = \\lambda v_1\n$$\nNow, we pre-multiply by $C_{11}^{1/2}$ and substitute $v_1 = C_{11}^{1/2} w_1$:\n$$\nC_{11}^{1/2} (C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) (C_{11}^{1/2} w_1) = \\lambda C_{11}^{1/2} (C_{11}^{1/2} w_1)\n$$\nThis simplifies to:\n$$\n(C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) w_1 = \\lambda C_{11} w_1\n$$\nThis is a generalized eigenvalue problem of the form $A x = \\lambda B x$, with $A = C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}$ and $B = C_{11}$. The largest eigenvalue $\\lambda_{\\max}$ of this system is equal to the squared optimal coherence, $\\gamma_{\\star}^2$. The corresponding eigenvector $w_1$ is the optimal polarimetric vector $w_{1,\\star}$. Once $w_{1,\\star}$ is known, the corresponding $w_{2,\\star}$ can be found from the maximization condition in Step 1, which leads to $w_{2,\\star}$ being proportional to $C_{22}^{-1} C_{12}^{\\mathrm{H}} w_{1,\\star}$. This completes the derivation of the equivalent generalized eigenvalue formulation.\n\nFor implementation, the SVD method is often more numerically stable. The optimal vectors $w_{1,\\star}$ and $w_{2,\\star}$ are found by transforming the singular vectors back to the original space:\n$$\nw_{1,\\star}^{\\text{raw}} = C_{11}^{-1/2} v_{1,\\star} \\quad \\text{and} \\quad w_{2,\\star}^{\\text{raw}} = C_{22}^{-1/2} v_{2,\\star}\n$$\nTo strictly enforce the constraints, especially when regularization is used, a final normalization step is applied:\n$$\nw_{1,\\star} = \\frac{w_{1,\\star}^{\\text{raw}}}{\\sqrt{w_{1,\\star}^{\\text{raw H}} C_{11} w_{1,\\star}^{\\text{raw}}}} \\quad \\text{and} \\quad w_{2,\\star} = \\frac{w_{2,\\star}^{\\text{raw}}}{\\sqrt{w_{2,\\star}^{\\text{raw H}} C_{22} w_{2,\\star}^{\\text{raw}}}}\n$$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR coherence optimization problem for three test cases.\n    \"\"\"\n    \n    epsilon = 1e-8\n\n    def compute_regularized_inverse_sqrt(C, e):\n        \"\"\"\n        Computes the Tikhonov-regularized inverse square root of a Hermitian matrix C.\n        C_inv_sqrt = Q * diag(1/sqrt(lambda_i + e)) * Q^H\n        \"\"\"\n        lambdas, Q = np.linalg.eigh(C)  # Eigenvalues are sorted in ascending order\n        \n        # Add epsilon to eigenvalues for regularization\n        # For a PSD matrix C, all lambdas are non-negative.\n        lambdas_reg = lambdas + e\n        \n        # Compute 1/sqrt of regularized eigenvalues\n        d_inv_sqrt_vals = 1.0 / np.sqrt(lambdas_reg)\n        \n        # Form the diagonal matrix of these values\n        D_inv_sqrt = np.diag(d_inv_sqrt_vals)\n        \n        # Reconstruct the matrix: Q @ D @ Q.conj().T\n        C_inv_sqrt = Q @ D_inv_sqrt @ Q.conj().T\n        \n        return C_inv_sqrt\n\n    def process_case(C11, C22, C12, eps):\n        \"\"\"\n        Processes a single test case to find optimal coherence and vectors.\n        \"\"\"\n        # Step 1: Compute regularized inverse square roots of C11 and C22\n        C11_inv_sqrt = compute_regularized_inverse_sqrt(C11, eps)\n        C22_inv_sqrt = compute_regularized_inverse_sqrt(C22, eps)\n        \n        # Step 2: Form the matrix K\n        K = C11_inv_sqrt @ C12 @ C22_inv_sqrt\n        \n        # Step 3: Compute the SVD of K\n        # U columns are left singular vectors, s are singular values, Vh is V hermitian\n        U, s, Vh = np.linalg.svd(K)\n        \n        # Step 4: Extract optimal coherence and transformed vectors\n        # The largest singular value is the optimal coherence\n        gamma_star = s[0]\n        \n        # The principal left singular vector (first column of U)\n        v1_star = U[:, 0]\n        # The principal right singular vector (first column of V, or conj().T of first row of Vh)\n        v2_star = Vh[0, :].conj()\n        \n        # Step 5: Transform vectors back to the original space\n        w1_raw = C11_inv_sqrt @ v1_star\n        w2_raw = C22_inv_sqrt @ v2_star\n        \n        # Step 6: Renormalize the vectors to satisfy the constraints, which is critical\n        # especially when regularization is active.\n        norm1_sq = (w1_raw.conj().T @ C11 @ w1_raw).real\n        w1_star = w1_raw / np.sqrt(norm1_sq) if norm1_sq > 0 else w1_raw\n\n        norm2_sq = (w2_raw.conj().T @ C22 @ w2_raw).real\n        w2_star = w2_raw / np.sqrt(norm2_sq) if norm2_sq > 0 else w2_raw\n        \n        # Prepare results for output\n        gamma_out = np.round(gamma_star, 6)\n        w1_real_out = np.round(w1_star.real, 6).tolist()\n        w1_imag_out = np.round(w1_star.imag, 6).tolist()\n        w2_real_out = np.round(w2_star.real, 6).tolist()\n        w2_imag_out = np.round(w2_star.imag, 6).tolist()\n        \n        return [gamma_out, w1_real_out, w1_imag_out, w2_real_out, w2_imag_out]\n\n    # Define Test Cases\n    # Case 1\n    C11_1 = np.diag([4.0, 3.0, 2.5])\n    C22_1 = np.diag([3.8, 2.8, 2.2])\n    C12_1 = np.diag([\n        np.sqrt(4.0 * 3.8) * 0.72 * np.exp(1j * 0.1),\n        np.sqrt(3.0 * 2.8) * 0.50 * np.exp(1j * -0.2),\n        np.sqrt(2.5 * 2.2) * 0.35 * np.exp(1j * 0.05)\n    ])\n\n    # Case 2\n    C11_2 = np.diag([2.0, 1.5, 1.0])\n    C22_2 = np.diag([1.8, 1.2, 0.8])\n    C12_2 = np.zeros((3, 3), dtype=np.complex128)\n\n    # Case 3\n    C11_3 = np.diag([4.0, 0.0, 1.5])\n    C22_3 = np.diag([3.5, 2.0, 1.2])\n    C12_3 = np.diag([\n        np.sqrt(4.0 * 3.5) * 0.30 * np.exp(1j * 0.3),\n        0.0,\n        np.sqrt(1.5 * 1.2) * 0.90 * np.exp(1j * -0.15)\n    ])\n    \n    test_cases = [\n        (C11_1, C22_1, C12_1),\n        (C11_2, C22_2, C12_2),\n        (C11_3, C22_3, C12_3)\n    ]\n    \n    results = []\n    for C11, C22, C12 in test_cases:\n        results.append(process_case(C11, C22, C12, epsilon))\n    \n    # Format the final output string\n    def format_list(data):\n        return '[' + ','.join(map(str, data)) + ']'\n        \n    formatted_results = []\n    for res in results:\n        gamma_str = f\"{res[0]:.6f}\"\n        w1r_str = format_list([f\"{x:.6f}\" for x in res[1]])\n        w1i_str = format_list([f\"{x:.6f}\" for x in res[2]])\n        w2r_str = format_list([f\"{x:.6f}\" for x in res[3]])\n        w2i_str = format_list([f\"{x:.6f}\" for x in res[4]])\n        formatted_results.append(f\"[{gamma_str},{w1r_str},{w1i_str},{w2r_str},{w2i_str}]\")\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}