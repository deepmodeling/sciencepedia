{
    "hands_on_practices": [
        {
            "introduction": "在我们能够解译极化干涉雷达（PolInSAR）数据之前，我们必须首先理解不同的植被元素（如树叶和树干）如何散射雷达波。本练习将指导您建立一个简单但基于物理的“正向模型”，将目标的几何和物理属性转化为雷达测量的极化相干矩阵（$\\mathbf{T}$）。这为理解不同植被的极化特征奠定了基础。",
            "id": "3834660",
            "problem": "您的任务是合成两种典型植被成分——建模为薄偶极子的叶片和建模为各向异性圆柱体的树干——的极化散射矩阵，然后计算单站后向散射下混合场景的相关相干矩阵。目标是推导从物理几何和极化率到极化散射矩阵，再到极化合成孔径雷达（PolSAR）中使用的相干描述的转换。\n\n从以下基本电磁散射基础开始：对于一个由极化率并矢 $\\boldsymbol{\\alpha}$ 表征的小颗粒，在方向 $\\mathbf{n}$ 上的远场散射电场可以紧凑的并矢形式（瑞利区）写为与 $(\\mathbf{I} - \\mathbf{n}\\mathbf{n}^{\\mathsf{T}})\\boldsymbol{\\alpha}\\mathbf{E}_{\\text{inc}}$ 成正比，其中 $\\mathbf{I}$ 是单位并矢，$\\mathbf{n}$ 是单位传播方向，$\\mathbf{E}_{\\text{inc}}$ 是入射场。在单站后向散射中，测得的极化散射矩阵 $\\mathbf{S}$ 的条目与该并矢作用在垂直于 $\\mathbf{n}$ 的平面内的接收和发射极化单位矢量上的投影成正比。\n\n定义和几何结构：\n- 设全局笛卡尔坐标系的单位矢量与距离 $\\hat{\\mathbf{x}}$、横向距离 $\\hat{\\mathbf{y}}$ 和垂直方向 $\\hat{\\mathbf{z}}$ 对齐。\n- 设入射角为 $\\theta_i$（单位为度），从垂直方向 $\\hat{\\mathbf{z}}$ 朝距离方向 $\\hat{\\mathbf{x}}$ 测量，因此视线单位矢量为 $\\mathbf{n} = [\\sin(\\theta_i),\\,0,\\,\\cos(\\theta_i)]^{\\mathsf{T}}$。\n- 水平极化单位矢量为 $\\mathbf{u}_H = [0,\\,1,\\,0]^{\\mathsf{T}}$。\n- 垂直极化单位矢量为 $\\mathbf{u}_V = [-\\cos(\\theta_i),\\,0,\\,\\sin(\\theta_i)]^{\\mathsf{T}}$，使得 $\\{\\mathbf{u}_H,\\mathbf{u}_V,\\mathbf{n}\\}$ 构成一个右手正交三元组。\n- 到垂直于 $\\mathbf{n}$ 的平面的投影算子是 $\\mathbf{P} = \\mathbf{I} - \\mathbf{n}\\mathbf{n}^{\\mathsf{T}}$。\n\n叶片模型（薄偶极子）：\n- 叶片被建模为一个薄偶极子，其单位轴 $\\mathbf{a}$ 由球坐标角指定：极角 $\\theta_{\\ell}$（单位为度），从垂直方向测量；方位角 $\\phi_{\\ell}$（单位为度），在水平面内从距离轴测量。单位矢量为 $\\mathbf{a} = [\\sin(\\theta_{\\ell})\\cos(\\phi_{\\ell}),\\,\\sin(\\theta_{\\ell})\\sin(\\phi_{\\ell}),\\,\\cos(\\theta_{\\ell})]^{\\mathsf{T}}$。\n- 其极化率并矢为 $\\boldsymbol{\\alpha}_{\\ell} = \\alpha_{\\ell}\\,\\mathbf{a}\\mathbf{a}^{\\mathsf{T}}$，其中标量 $\\alpha_{\\ell} > 0$（在此合成模型中为无量纲）。\n\n树干模型（各向异性圆柱体）：\n- 树干被建模为一个圆柱体，其单位轴 $\\mathbf{t}$ 由极角 $\\theta_{t}$（单位为度，从垂直方向测量）和方位角 $\\phi_{t}$（单位为度，从距离轴测量）指定，因此 $\\mathbf{t} = [\\sin(\\theta_{t})\\cos(\\phi_{t}),\\,\\sin(\\theta_{t})\\sin(\\phi_{t}),\\,\\cos(\\theta_{t})]^{\\mathsf{T}}$。\n- 其极化率并矢为 $\\boldsymbol{\\alpha}_{c} = \\alpha_{\\perp}\\left(\\mathbf{I} - \\mathbf{t}\\mathbf{t}^{\\mathsf{T}}\\right) + \\alpha_{\\parallel}\\,\\mathbf{t}\\mathbf{t}^{\\mathsf{T}}$，其中标量 $\\alpha_{\\parallel} > 0$ 和 $\\alpha_{\\perp} > 0$（在此合成模型中为无量纲）。\n\n散射和相干性：\n- 一个分量的有效散射并矢为 $\\mathbf{D} = \\mathbf{P}\\boldsymbol{\\alpha}\\mathbf{P}$。\n- 极化散射矩阵 $\\mathbf{S}$ 的条目为 $S_{pq} = \\mathbf{u}_p^{\\mathsf{T}}\\mathbf{D}\\,\\mathbf{u}_q$，其中 $p,q\\in\\{H,V\\}$，确保了单站互易性 $S_{HV}=S_{VH}$。\n- 定义Pauli散射矢量为\n$$\n\\mathbf{k}_p = \\frac{1}{\\sqrt{2}}\n\\begin{bmatrix}\nS_{HH} + S_{VV} \\\\\nS_{HH} - S_{VV} \\\\\n2 S_{HV}\n\\end{bmatrix}.\n$$\n- 对于一个确定性的单分量，相干矩阵是 $\\mathbf{T} = \\mathbf{k}_p \\mathbf{k}_p^{\\dagger}$，其中 $\\dagger$ 表示共轭转置。\n- 对于具有独立相位的双分量混合，场景相干矩阵是加权和 $\\mathbf{T}_{\\text{tot}} = w_{\\ell}\\mathbf{T}_{\\ell} + w_{t}\\mathbf{T}_{t}$，其中 $w_{\\ell} \\ge 0$ 和 $w_{t} \\ge 0$ 是代表相对功率贡献的无量纲权重。\n\n需要计算的输出：\n- 对于每个测试用例，计算 $\\mathbf{T}_{\\text{tot}}$ 的归一化特征值，即，对特征值进行排序 $\\lambda_1 \\ge \\lambda_2 \\ge \\lambda_3 \\ge 0$，并返回 $[\\lambda_1/s,\\,\\lambda_2/s,\\,\\lambda_3/s]$，其中 $s = \\lambda_1+\\lambda_2+\\lambda_3$ 是迹（span）。如果 $s=0$，则返回 $[0,\\,0,\\,0]$。\n\n角度单位说明：\n- 测试套件中提供的所有角度都以度为单位，并且必须按度处理。\n\n物理和数值单位：\n- 在此问题设置中，合成极化率标量 $\\alpha_{\\ell}$、$\\alpha_{\\parallel}$ 和 $\\alpha_{\\perp}$ 是无量纲的。输出是无量纲的浮点数。\n\n测试套件：\n计算以下参数集的结果（所有角度均以度为单位）：\n- 情况1（一般情况，各向异性树干，斜入射）：$\\theta_i=35$，叶片 $(\\theta_{\\ell},\\phi_{\\ell},\\alpha_{\\ell})=(60,45,1.0)$，树干 $(\\theta_{t},\\phi_{t},\\alpha_{\\parallel},\\alpha_{\\perp})=(0,0,5.0,0.5)$，权重 $(w_{\\ell},w_{t})=(0.3,0.7)$。\n- 情况2（各向同性树干，叶片在距离向水平）：$\\theta_i=50$，叶片 $(\\theta_{\\ell},\\phi_{\\ell},\\alpha_{\\ell})=(90,0,1.2)$，树干 $(\\theta_{t},\\phi_{t},\\alpha_{\\parallel},\\alpha_{\\perp})=(0,0,2.0,2.0)$，权重 $(w_{\\ell},w_{t})=(0.5,0.5)$。\n- 情况3（近天底入射，强各向异性树干，叶片垂直）：$\\theta_i=10$，叶片 $(\\theta_{\\ell},\\phi_{\\ell},\\alpha_{\\ell})=(0,0,0.8)$，树干 $(\\theta_{t},\\phi_{t},\\alpha_{\\parallel},\\alpha_{\\perp})=(0,0,8.0,0.1)$，权重 $(w_{\\ell},w_{t})=(0.2,0.8)$。\n- 情况4（倾斜树干，叶片在横向距离向）：$\\theta_i=40$，叶片 $(\\theta_{\\ell},\\phi_{\\ell},\\alpha_{\\ell})=(70,90,1.0)$，树干 $(\\theta_{t},\\phi_{t},\\alpha_{\\parallel},\\alpha_{\\perp})=(10,30,4.0,1.0)$，权重 $(w_{\\ell},w_{t})=(0.6,0.4)$。\n- 情况5（边界情况，无叶片）：$\\theta_i=30$，叶片 $(\\theta_{\\ell},\\phi_{\\ell},\\alpha_{\\ell})=(60,45,0.0)$，树干 $(\\theta_{t},\\phi_{t},\\alpha_{\\parallel},\\alpha_{\\perp})=(0,0,3.0,0.3)$，权重 $(w_{\\ell},w_{t})=(0.0,1.0)$。\n\n最终输出格式：\n您的程序应生成单行输出，包含所有测试用例的结果，格式为逗号分隔的Python风格列表的列表，其中每个内部列表是三个归一化特征值，四舍五入到六位小数，例如：$[[a_1,a_2,a_3],[b_1,b_2,b_3],\\dots]$。角度单位是度，输出中不需要物理单位。",
            "solution": "问题陈述经评估有效。其科学基础是电磁散射和雷达极化测量原理，数学上适定、内部一致且客观。它提供了所有必要的信息来获得唯一、可验证的解。\n\n该解决方案需要合成由两种典型植被散射体——叶片和树干——组成的混合场景的极化响应，并分析得到的相干矩阵。步骤如下：\n\n1.  **建立几何框架**：根据入射角 $\\theta_i$ 定义所有相关矢量。\n2.  **对单个散射体建模**：对于每个分量（叶片和树干），根据其方向和物理特性构建其极化率并矢 $\\boldsymbol{\\alpha}$。\n3.  **计算散射矩阵**：计算每个分量的 $2 \\times 2$ 极化散射矩阵 $\\mathbf{S}$。\n4.  **推导相干矩阵**：将每个散射矩阵转换为其对应的Pauli散射矢量 $\\mathbf{k}_p$，然后再转换为 $3 \\times 3$ 的相干矩阵 $\\mathbf{T}$。\n5.  **计算总场景相干性**：使用指定的功率权重组合单个相干矩阵，以获得总场景相干矩阵 $\\mathbf{T}_{\\text{tot}}$。\n6.  **分析特征结构**：计算 $\\mathbf{T}_{\\text{tot}}$ 的特征值，按降序对其进行排序，并用它们的和（迹 span）进行归一化，以获得最终结果。\n\n### 第1步：几何框架\n所有以度为单位提供的角度必须首先转换为弧度，以便在三角函数中使用。设 $\\theta_i$ 为入射角。关键的几何矢量是：\n- 视线单位矢量：\n    $$\n    \\mathbf{n} = \\begin{bmatrix} \\sin(\\theta_i) \\\\ 0 \\\\ \\cos(\\theta_i) \\end{bmatrix}\n    $$\n- 水平极化单位矢量：\n    $$\n    \\mathbf{u}_H = \\begin{bmatrix} 0 \\\\ 1 \\\\ 0 \\end{bmatrix}\n    $$\n- 垂直极化单位矢量：\n    $$\n    \\mathbf{u}_V = \\begin{bmatrix} -\\cos(\\theta_i) \\\\ 0 \\\\ \\sin(\\theta_i) \\end{bmatrix}\n    $$\n这三个矢量构成一个右手正交基 $\\{\\mathbf{u}_H, \\mathbf{u}_V, \\mathbf{n}\\}$。\n\n### 第2步：单个散射体模型\n具有极化率并矢 $\\boldsymbol{\\alpha}$ 的分量的散射矩阵元素 $S_{pq}$ 由 $S_{pq} = \\mathbf{u}_p^{\\mathsf{T}} \\mathbf{D} \\mathbf{u}_q$ 给出，其中 $\\mathbf{D} = \\mathbf{P}\\boldsymbol{\\alpha}\\mathbf{P}$ 且 $\\mathbf{P} = \\mathbf{I} - \\mathbf{n}\\mathbf{n}^{\\mathsf{T}}$。由于极化矢量 $\\mathbf{u}_H$ 和 $\\mathbf{u}_V$ 位于垂直于 $\\mathbf{n}$ 的平面内，我们有 $\\mathbf{P}\\mathbf{u}_p = \\mathbf{u}_p$。这将散射元素的表达式简化为 $S_{pq} = \\mathbf{u}_p^{\\mathsf{T}} \\boldsymbol{\\alpha} \\mathbf{u}_q$。\n\n**叶片模型（薄偶极子）**\n叶片的轴单位矢量 $\\mathbf{a}$ 由其极角 $\\theta_{\\ell}$ 和方位角 $\\phi_{\\ell}$ 定义：\n$$\n\\mathbf{a} = \\begin{bmatrix} \\sin(\\theta_{\\ell})\\cos(\\phi_{\\ell}) \\\\ \\sin(\\theta_{\\ell})\\sin(\\phi_{\\ell}) \\\\ \\cos(\\theta_{\\ell}) \\end{bmatrix}\n$$\n极化率并矢为 $\\boldsymbol{\\alpha}_{\\ell} = \\alpha_{\\ell} \\mathbf{a}\\mathbf{a}^{\\mathsf{T}}$。散射矩阵元素为：\n$$\nS_{pq,\\ell} = \\mathbf{u}_p^{\\mathsf{T}} (\\alpha_{\\ell} \\mathbf{a}\\mathbf{a}^{\\mathsf{T}}) \\mathbf{u}_q = \\alpha_{\\ell} (\\mathbf{u}_p^{\\mathsf{T}}\\mathbf{a})(\\mathbf{a}^{\\mathsf{T}}\\mathbf{u}_q) = \\alpha_{\\ell} (\\mathbf{u}_p \\cdot \\mathbf{a})(\\mathbf{u}_q \\cdot \\mathbf{a})\n$$\n其中 $p, q \\in \\{H, V\\}$。\n\n**树干模型（各向异性圆柱体）**\n树干的轴单位矢量 $\\mathbf{t}$ 由其极角 $\\theta_{t}$ 和方位角 $\\phi_{t}$ 定义：\n$$\n\\mathbf{t} = \\begin{bmatrix} \\sin(\\theta_{t})\\cos(\\phi_{t}) \\\\ \\sin(\\theta_{t})\\sin(\\phi_{t}) \\\\ \\cos(\\theta_{t}) \\end{bmatrix}\n$$\n极化率并矢为 $\\boldsymbol{\\alpha}_{c} = \\alpha_{\\perp}(\\mathbf{I} - \\mathbf{t}\\mathbf{t}^{\\mathsf{T}}) + \\alpha_{\\parallel}\\mathbf{t}\\mathbf{t}^{\\mathsf{T}}$。散射矩阵元素由通用形式 $S_{pq,c} = \\mathbf{u}_p^{\\mathsf{T}} \\boldsymbol{\\alpha}_{c} \\mathbf{u}_q$ 给出。\n\n### 第3步：相干矩阵公式\n对于每个分量（叶片 $\\ell$ 和树干 $t$），我们计算散射矩阵 $\\mathbf{S}$。由于极化率并矢是实对称的，单站互易性 $S_{HV} = S_{VH}$ 得到保证。\nPauli散射矢量 $\\mathbf{k}_p$ 由 $\\mathbf{S}$ 的元素构成：\n$$\n\\mathbf{k}_p = \\frac{1}{\\sqrt{2}}\n\\begin{bmatrix}\nS_{HH} + S_{VV} \\\\\nS_{HH} - S_{VV} \\\\\n2 S_{HV}\n\\end{bmatrix}\n$$\n由于所有输入都是实数，$\\mathbf{k}_p$ 的元素也是实数。单个确定性分量的相干矩阵为 $\\mathbf{T} = \\mathbf{k}_p \\mathbf{k}_p^{\\dagger}$。对于实数 $\\mathbf{k}_p$，这简化为外积 $\\mathbf{T} = \\mathbf{k}_p \\mathbf{k}_p^{\\mathsf{T}}$。这将产生一个 $3 \\times 3$ 的实对称、秩为1的矩阵。我们分别计算 $\\mathbf{T}_{\\ell}$ 和 $\\mathbf{T}_{t}$。\n\n### 第4步：场景聚合与特征分解\n混合场景的总相干矩阵是单个分量相干矩阵的加权和：\n$$\n\\mathbf{T}_{\\text{tot}} = w_{\\ell}\\mathbf{T}_{\\ell} + w_{t}\\mathbf{T}_{t}\n$$\n其中 $w_{\\ell}$ 和 $w_{t}$ 是相对功率贡献权重。$\\mathbf{T}_{\\text{tot}}$ 是一个 $3 \\times 3$ 的实对称矩阵。作为正半定矩阵的非负加权和，它本身也是正半定的，其特征值 $\\lambda_i$ 是非负的。\n\n最后一步是计算 $\\mathbf{T}_{\\text{tot}}$ 的特征值，按降序对其进行排序（$\\lambda_1 \\ge \\lambda_2 \\ge \\lambda_3$），并用它们的和，即迹 $s = \\text{Tr}(\\mathbf{T}_{\\text{tot}}) = \\lambda_1 + \\lambda_2 + \\lambda_3$ 进行归一化。归一化特征值为 $[\\lambda_1/s, \\lambda_2/s, \\lambda_3/s]$。如果迹 $s = 0$，则结果为 $[0, 0, 0]$。对每个测试用例重复此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes normalized eigenvalues of the total coherency matrix for mixed scenes\n    of canonical vegetation scatterers.\n    \"\"\"\n    test_cases = [\n        # Case 1: general, anisotropic trunk, oblique incidence\n        {'theta_i': 35, 'leaf': (60, 45, 1.0), 'trunk': (0, 0, 5.0, 0.5), 'weights': (0.3, 0.7)},\n        # Case 2: isotropic trunk, leaf horizontal in range\n        {'theta_i': 50, 'leaf': (90, 0, 1.2), 'trunk': (0, 0, 2.0, 2.0), 'weights': (0.5, 0.5)},\n        # Case 3: near-nadir incidence, strongly anisotropic trunk, leaf vertical\n        {'theta_i': 10, 'leaf': (0, 0, 0.8), 'trunk': (0, 0, 8.0, 0.1), 'weights': (0.2, 0.8)},\n        # Case 4: tilted trunk, leaf cross-range\n        {'theta_i': 40, 'leaf': (70, 90, 1.0), 'trunk': (10, 30, 4.0, 1.0), 'weights': (0.6, 0.4)},\n        # Case 5: boundary, leaf absent\n        {'theta_i': 30, 'leaf': (60, 45, 0.0), 'trunk': (0, 0, 3.0, 0.3), 'weights': (0.0, 1.0)},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        # --- Unpack parameters ---\n        theta_i_deg = case['theta_i']\n        theta_l_deg, phi_l_deg, alpha_l = case['leaf']\n        theta_t_deg, phi_t_deg, alpha_para, alpha_perp = case['trunk']\n        w_l, w_t = case['weights']\n\n        # --- Convert angles to radians ---\n        theta_i = np.deg2rad(theta_i_deg)\n        theta_l, phi_l = np.deg2rad(theta_l_deg), np.deg2rad(phi_l_deg)\n        theta_t, phi_t = np.deg2rad(theta_t_deg), np.deg2rad(phi_t_deg)\n\n        # --- Geometric Setup ---\n        cos_ti, sin_ti = np.cos(theta_i), np.sin(theta_i)\n        u_H = np.array([0.0, 1.0, 0.0])\n        u_V = np.array([-cos_ti, 0.0, sin_ti])\n\n        T_tot = np.zeros((3, 3))\n\n        # --- Leaf Component Coherency Matrix ---\n        if w_l > 0 and alpha_l > 0:\n            a = np.array([\n                np.sin(theta_l) * np.cos(phi_l),\n                np.sin(theta_l) * np.sin(phi_l),\n                np.cos(theta_l)\n            ])\n            # S_pq = alpha * (up . a) * (uq . a)\n            S_HH_l = alpha_l * (np.dot(u_H, a))**2\n            S_VV_l = alpha_l * (np.dot(u_V, a))**2\n            S_HV_l = alpha_l * np.dot(u_H, a) * np.dot(u_V, a)\n            \n            k_p_l = (1/np.sqrt(2)) * np.array([\n                S_HH_l + S_VV_l,\n                S_HH_l - S_VV_l,\n                2 * S_HV_l\n            ])\n            T_l = np.outer(k_p_l, k_p_l)\n            T_tot += w_l * T_l\n\n        # --- Trunk Component Coherency Matrix ---\n        if w_t > 0:\n            t = np.array([\n                np.sin(theta_t) * np.cos(phi_t),\n                np.sin(theta_t) * np.sin(phi_t),\n                np.cos(theta_t)\n            ])\n            tt_outer = np.outer(t, t)\n            I = np.identity(3)\n            alpha_c = alpha_perp * (I - tt_outer) + alpha_para * tt_outer\n\n            S_HH_t = u_H.T @ alpha_c @ u_H\n            S_VV_t = u_V.T @ alpha_c @ u_V\n            S_HV_t = u_H.T @ alpha_c @ u_V\n            \n            k_p_t = (1/np.sqrt(2)) * np.array([\n                S_HH_t + S_VV_t,\n                S_HH_t - S_VV_t,\n                2 * S_HV_t\n            ])\n            T_t = np.outer(k_p_t, k_p_t)\n            T_tot += w_t * T_t\n\n        # --- Eigen-decomposition ---\n        span = np.trace(T_tot)\n        \n        if span > 1e-9: # Safe floating point comparison for non-zero span\n            eigenvalues = np.linalg.eigvalsh(T_tot)\n            # Sort in descending order\n            eigenvalues = np.sort(eigenvalues)[::-1]\n            normalized_eigs = eigenvalues / span\n        else:\n            normalized_eigs = np.array([0.0, 0.0, 0.0])\n            \n        results.append(normalized_eigs)\n\n    # --- Format output string ---\n    inner_strs = [f\"[{','.join(f'{val:.6f}' for val in res)}]\" for res in results]\n    final_output = f\"[{','.join(inner_strs)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "“地面上随机体”（Random Volume over Ground, RVoG）模型是利用 PolInSAR 反演植被高度的基石。本练习模拟了反演过程中的一个关键步骤：将地面散射贡献从植被体散射中分离出来。通过将观测到的相干性建模为一种混合，并利用其在不同极化下的行为，您将估计出地面的干涉相位（$\\phi_g$），这是确定下方地形的关键参数。",
            "id": "3834626",
            "problem": "给定一个合成的极化干涉合成孔径雷达（PolInSAR）场景，该场景包含两种散射机制：地表分量和植被体分量。目标是在一个有物理基础的混合模型下构建极化相关的干涉相干性，然后根据不同极化下的相位行为估计公共的地表干涉相位 $\\phi_g$。\n\n请基于核心定义进行推导和实现。使用以下内容作为您的起点：\n\n- 合成孔径雷达（SAR）和干涉合成孔径雷达（InSAR）的相干性由两次采集之间的归一化复相关定义。对于单一极化 $p$，干涉相干性定义为\n$$\n\\gamma_p \\triangleq \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}}\n$$\n其中 $s_{1,p}$ 和 $s_{2,p}$ 分别表示第一次和第二次采集中极化 $p$ 的复数SAR信号。\n\n- 体散射贡献被建模为一个垂直分布的后向散射，具有一个极化相关的消光剖面。设冠层厚度为 $H$（单位：米），极化相关的后向散射权重为 $f_p(z) = e^{-\\xi_p z}$，其中 $\\xi_p$（单位：米分之一）是极化相关的消光参数，$z$ 是高度坐标。干涉体相干性是在垂直波数 $k_z$（单位：弧度/米）处评估的垂直剖面的归一化加权傅里叶变换：\n$$\n\\gamma_{v,p} \\triangleq \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz} \\, .\n$$\n\n- 地表贡献是一个具有干涉相位 $\\phi_g$（单位：弧度）的单一相位中心，建模为一个确定性复相量 $e^{j \\phi_g}$。\n\n假设对于每个极化 $p$，总后向散射是地表和体散射分量的独立和，其功率分别与极化相关的非负权重 $a_p^2$（地表）和 $b_p^2$（体）成正比。设地表和体散射分量相互不相关。在这些假设下，并使用上述干涉相干性的定义，构建极化相关的合成干涉相干性 $\\gamma_p$。\n\n然后，利用几何特性，即对于每个极化 $p$，复相干性 $\\gamma_p$ 位于复平面中连接体相干性 $\\gamma_{v,p}$ 和地表相量 $e^{j \\phi_g}$ 的直线上。使用三个线性极化通道 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$，它们具有不同的消光参数和混合权重，通过找到这些直线在复平面上的最小二乘交点并取其辐角来估计 $\\phi_g$。\n\n您的程序必须：\n\n1. 对于每个提供的测试用例，使用上述积分定义为 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$ 计算 $\\gamma_{v,p}$。\n2. 在此问题详述的独立混合模型下，为每个极化构建 $\\gamma_p$。\n3. 通过求解三个极化间的最小二乘直线相交问题来估计 $\\phi_g$，其中每条直线由一个点 $\\gamma_{v,p}$ 和一个方向向量 $\\gamma_p - \\gamma_{v,p}$ 定义。\n4. 对于每个测试用例，以弧度为单位输出估计的 $\\phi_g$，并四舍五入到六位小数。\n\n物理单位和角度单位要求：\n- 冠层厚度 $H$ 必须以米为单位。\n- 消光参数 $\\xi_p$ 必须以米分之一为单位。\n- 垂直波数 $k_z$ 必须以弧度/米为单位。\n- 地表相位 $\\phi_g$ 必须以弧度为单位进行估计和输出。\n\n测试套件和参数：\n请精确使用以下测试套件。每个测试用例定义了 $H$、$k_z$、$\\phi_g$（真值，仅用于生成合成相干性）、消光参数 $\\xi_p$ 和混合权重 $(a_p, b_p)$，其中 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$。\n\n- 测试用例 1（一般情况）：\n  - $H = 20$\n  - $k_z = 0.2$\n  - $\\phi_g = 0.8$\n  - $\\xi_{\\text{HH}} = 0.12$, $\\xi_{\\text{HV}} = 0.30$, $\\xi_{\\text{VV}} = 0.08$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.7, 0.3)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.2, 0.8)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.6, 0.4)$\n\n- 测试用例 2（小垂直波数边界情况）：\n  - $H = 25$\n  - $k_z = 0.01$\n  - $\\phi_g = -1.0$\n  - $\\xi_{\\text{HH}} = 0.18$, $\\xi_{\\text{HV}} = 0.28$, $\\xi_{\\text{VV}} = 0.10$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.5, 0.5)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.1, 0.9)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.4, 0.6)$\n\n- 测试用例 3（大垂直波数且交叉极化中体散射较强的边缘情况）：\n  - $H = 15$\n  - $k_z = 0.5$\n  - $\\phi_g = 1.5$\n  - $\\xi_{\\text{HH}} = 0.20$, $\\xi_{\\text{HV}} = 0.40$, $\\xi_{\\text{VV}} = 0.12$\n  - $(a_{\\text{HH}}, b_{\\text{HH}}) = (0.8, 0.2)$\n  - $(a_{\\text{HV}}, b_{\\text{HV}}) = (0.15, 0.85)$\n  - $(a_{\\text{VV}}, b_{\\text{VV}}) = (0.7, 0.3)$\n\n最终输出格式：\n您的程序应生成一行输出，其中包含三个测试用例的估计地表相位，以弧度为单位，并四舍五入到六位小数，形式为用方括号括起来的逗号分隔列表（例如，$\\left[\\phi_1,\\phi_2,\\phi_3\\right]$ 变为字符串 \"[0.800000,-1.000000,1.500000]\"）。",
            "solution": "该问题是有效的，因为它在科学上基于极化干涉测量的原理，问题陈述清晰，目标明确，数据充分，并且表述客观。任务是基于地面随机体散射（RVoG）模型，从合成的极化干涉合成孔径雷达（PolInSAR）数据中估计地表干涉相位 $\\phi_g$。\n\n求解过程分为四个阶段：\n1.  推导混合地表-体散射体的复合干涉相干性 $\\gamma_p$。\n2.  纯体散射相干性 $\\gamma_{v,p}$ 的解析计算。\n3.  将地表相位估计问题表述为最小二乘直线相交问题。\n4.  将此框架应用于所提供的测试用例。\n\n**1. 复合干涉相干性模型**\n\n问题给出了单一极化通道 $p$ 的干涉相干性定义为：\n$$\n\\gamma_p = \\frac{\\mathbb{E}\\left[s_{1,p}\\, s_{2,p}^\\ast \\right]}{\\sqrt{\\mathbb{E}\\left[|s_{1,p}|^2\\right] \\, \\mathbb{E}\\left[|s_{2,p}|^2\\right]}}\n$$\n其中 $s_{1,p}$ 和 $s_{2,p}$ 是两次采样的复数SAR信号。假设统计平稳性，分母简化为 $\\mathbb{E}\\left[|s_p|^2\\right]$。\n\n总信号 $s_p$ 被建模为地表分量 $s_{g,p}$ 和体散射分量 $s_{v,p}$ 的独立和：$s_{p} = s_{g,p} + s_{v,p}$。问题陈述这些分量相互不相关，意味着 $\\mathbb{E}\\left[s_{g,p} s_{v,p}^\\ast\\right] = 0$。\n\n$\\gamma_p$ 分子中的相关项变为：\n$$\n\\mathbb{E}\\left[s_{1,p}s_{2,p}^\\ast\\right] = \\mathbb{E}\\left[(s_{1,g,p} + s_{1,v,p})(s_{2,g,p}^\\ast + s_{2,v,p}^\\ast)\\right] = \\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] + \\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right]\n$$\n分母中的总功率变为：\n$$\n\\mathbb{E}\\left[|s_p|^2\\right] = \\mathbb{E}\\left[|s_{g,p} + s_{v,p}|^2\\right] = \\mathbb{E}\\left[|s_{g,p}|^2\\right] + \\mathbb{E}\\left[|s_{v,p}|^2\\right]\n$$\n设 $P_{g,p} = \\mathbb{E}\\left[|s_{g,p}|^2\\right]$ 为地表功率，$P_{v,p} = \\mathbb{E}\\left[|s_{v,p}|^2\\right]$ 为体散射功率。\n\n纯地表相干性由相量 $e^{j\\phi_g}$ 给出，纯体散射相干性为 $\\gamma_{v,p}$。根据定义，我们可以写出：\n$\\mathbb{E}\\left[s_{1,g,p}s_{2,g,p}^\\ast\\right] = P_{g,p} e^{j\\phi_g}$\n$\\mathbb{E}\\left[s_{1,v,p}s_{2,v,p}^\\ast\\right] = P_{v,p} \\gamma_{v,p}$\n\n将这些代入 $\\gamma_p$ 的表达式中，得到：\n$$\n\\gamma_p = \\frac{P_{g,p} e^{j\\phi_g} + P_{v,p} \\gamma_{v,p}}{P_{g,p} + P_{v,p}}\n$$\n问题陈述，地表和体散射功率分别与 $a_p^2$ 和 $b_p^2$ 成正比。定义地体功率比为 $\\mu_p = P_{g,p}/P_{v,p} = a_p^2/b_p^2$，我们可以将相干性重写为：\n$$\n\\gamma_p = \\frac{\\mu_p e^{j\\phi_g} + \\gamma_{v,p}}{\\mu_p + 1}\n$$\n此方程表明，观测到的相干性 $\\gamma_p$ 是地表相量 $e^{j\\phi_g}$ 和体散射相干性 $\\gamma_{v,p}$ 的复数加权平均。在几何上，点 $\\gamma_p$ 位于连接复平面上点 $\\gamma_{v,p}$ 和 $e^{j\\phi_g}$ 的线段上。这是RVoG模型的基本见解。\n\n**2. 体散射相干性计算**\n\n体散射相干性 $\\gamma_{v,p}$ 由垂直后向散射剖面 $f_p(z) = e^{-\\xi_p z}$ 的归一化傅里叶变换定义：\n$$\n\\gamma_{v,p} = \\frac{\\int_{0}^{H} f_p(z) \\, e^{j k_z z} \\, dz}{\\int_{0}^{H} f_p(z)\\, dz}\n$$\n分子中的积分是：\n$$\n\\int_{0}^{H} e^{-\\xi_p z} e^{j k_z z} \\, dz = \\int_{0}^{H} e^{(j k_z - \\xi_p) z} \\, dz = \\left[ \\frac{e^{(j k_z - \\xi_p) z}}{j k_z - \\xi_p} \\right]_{0}^{H} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p}\n$$\n分母中的积分是：\n$$\n\\int_{0}^{H} e^{-\\xi_p z} \\, dz = \\left[ \\frac{e^{-\\xi_p z}}{-\\xi_p} \\right]_{0}^{H} = \\frac{e^{-\\xi_p H} - 1}{-\\xi_p} = \\frac{1 - e^{-\\xi_p H}}{\\xi_p}\n$$\n合并这些结果，得到体散射相干性的解析表达式：\n$$\n\\gamma_{v,p} = \\frac{e^{(j k_z - \\xi_p) H} - 1}{j k_z - \\xi_p} \\left( \\frac{\\xi_p}{1 - e^{-\\xi_p H}} \\right)\n$$\n此公式用于计算每个极化通道 $p \\in \\{\\text{HH}, \\text{HV}, \\text{VV}\\}$ 的 $\\gamma_{v,p}$。注意，对于 $\\xi_p=0$ 的特殊情况，可以使用洛必达法则证明该公式正确地收敛于 $\\gamma_{v,p}|_{\\xi_p=0} = \\frac{e^{j k_z H} - 1}{j k_z H}$。\n\n**3. 地表相位的最小二乘估计**\n\n对于三个极化中的每一个 $p_i$（其中 $i \\in \\{1, 2, 3\\}$ 对应于 HH, HV, VV），观测相干性 $\\gamma_{p_i}$ 和体散射相干性 $\\gamma_{v,p_i}$ 在复平面上定义了一条直线。未知的地表相量，我们称之为 $G = e^{j\\phi_g}$，位于所有这三条直线上。在像这样的无噪声合成场景中，这三条线将相交于一个单点 $G$。为了找到这个交点，我们按照要求构建一个超定系统并使用最小二乘法求解。\n\n设复平面上的一个点由其真实和虚部组成的二维向量表示。地表点是 $\\mathbf{g} = (\\text{Re}\\{G\\}, \\text{Im}\\{G\\})$。对于每个极化 $i$，该直线穿过点 $\\mathbf{v}_i = (\\text{Re}\\{\\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{v,p_i}\\})$ 且平行于方向向量 $\\mathbf{d}_i = (\\text{Re}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\}, \\text{Im}\\{\\gamma_{p_i} - \\gamma_{v,p_i}\\})$。\n\n直线 $i$ 的方程可以用单位法向量 $\\mathbf{n}_i$ 表示。方向向量是 $\\mathbf{d}_i = (d_{ix}, d_{iy})$；一个法向量是 $(-d_{iy}, d_{ix})$。单位法向量是 $\\mathbf{n}_i = \\frac{1}{||\\mathbf{d}_i||}(-d_{iy}, d_{ix}) = (n_{ix}, n_{iy})$。直线上一点 $\\mathbf{x}=(x,y)$ 的方程是 $\\mathbf{n}_i \\cdot (\\mathbf{x} - \\mathbf{v}_i) = 0$。\n\n我们寻求点 $\\mathbf{g}=(x_g, y_g)$，使得它到这三条线的平方距离之和最小。从 $\\mathbf{g}$ 到直线 $i$ 的平方距离是 $(\\mathbf{n}_i \\cdot (\\mathbf{g} - \\mathbf{v}_i))^2$。最小化问题是：\n$$\n\\min_{x_g, y_g} \\sum_{i=1}^{3} (\\mathbf{n}_i \\cdot \\mathbf{g} - \\mathbf{n}_i \\cdot \\mathbf{v}_i)^2\n$$\n这是一个标准线性最小二乘问题，形式为 $\\min_{\\mathbf{x}} ||\\mathbf{A}\\mathbf{x} - \\mathbf{c}||^2$，其中：\n$$\n\\mathbf{A} = \\begin{pmatrix} n_{1x} & n_{1y} \\\\ n_{2x} & n_{2y} \\\\ n_{3x} & n_{3y} \\end{pmatrix}, \\quad \\mathbf{x} = \\begin{pmatrix} x_g \\\\ y_g \\end{pmatrix}, \\quad \\mathbf{c} = \\begin{pmatrix} \\mathbf{n}_1 \\cdot \\mathbf{v}_1 \\\\ \\mathbf{n}_2 \\cdot \\mathbf{v}_2 \\\\ \\mathbf{n}_3 \\cdot \\mathbf{v}_3 \\end{pmatrix}\n$$\n解由正规方程给出：$(\\mathbf{A}^T \\mathbf{A}) \\mathbf{x} = \\mathbf{A}^T \\mathbf{c}$。通过求解这个 $2 \\times 2$ 线性系统，可以找到估计的地表点坐标 $\\mathbf{x}$。\n\n**4. 最终相位估计**\n\n一旦找到最小二乘解 $\\mathbf{x} = (\\hat{x}_g, \\hat{y}_g)$，该向量对应于估计的复数地表相量 $\\hat{G} = \\hat{x}_g + j\\hat{y}_g$。估计的地表相位 $\\hat{\\phi}_g$ 是这个复数的辐角：\n$$\n\\hat{\\phi}_g = \\arg(\\hat{G}) = \\text{atan2}(\\hat{y}_g, \\hat{x}_g)\n$$\n此过程应用于每个测试用例以找到各自的估计地表相位。由于合成数据是无噪声的，估计的相位 $\\hat{\\phi}_g$ 应该与用于生成数据的真实相位 $\\phi_g$ 完全匹配，直至数值精度。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR ground phase estimation problem for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            'H': 20.0, 'kz': 0.2, 'phi_g': 0.8,\n            'pols': {\n                'HH': {'xi': 0.12, 'a': 0.7, 'b': 0.3},\n                'HV': {'xi': 0.30, 'a': 0.2, 'b': 0.8},\n                'VV': {'xi': 0.08, 'a': 0.6, 'b': 0.4}\n            }\n        },\n        {\n            'H': 25.0, 'kz': 0.01, 'phi_g': -1.0,\n            'pols': {\n                'HH': {'xi': 0.18, 'a': 0.5, 'b': 0.5},\n                'HV': {'xi': 0.28, 'a': 0.1, 'b': 0.9},\n                'VV': {'xi': 0.10, 'a': 0.4, 'b': 0.6}\n            }\n        },\n        {\n            'H': 15.0, 'kz': 0.5, 'phi_g': 1.5,\n            'pols': {\n                'HH': {'xi': 0.20, 'a': 0.8, 'b': 0.2},\n                'HV': {'xi': 0.40, 'a': 0.15, 'b': 0.85},\n                'VV': {'xi': 0.12, 'a': 0.7, 'b': 0.3}\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        estimated_phi_g = estimate_ground_phase(case)\n        results.append(estimated_phi_g)\n\n    # Format the final output string exactly as required.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\ndef compute_gamma_v(H, kz, xi):\n    \"\"\"\n    Computes the pure volume interferometric coherence gamma_v.\n    \n    Args:\n        H (float): Canopy thickness in meters.\n        kz (float): Vertical wavenumber in radians per meter.\n        xi (float): Polarization-dependent extinction in inverse meters.\n    \n    Returns:\n        complex: The volume coherence gamma_v.\n    \"\"\"\n    if np.isclose(xi, 0.0):\n        # Handle the zero-extinction case\n        if np.isclose(kz, 0.0):\n            return 1.0 + 0.0j\n        num = np.exp(1j * kz * H) - 1.0\n        den = 1j * kz * H\n        return num / den\n    else:\n        # General case for non-zero extinction\n        num_term = 1j * kz - xi\n        num = (np.exp(num_term * H) - 1.0) / num_term\n        \n        den_term = -xi\n        den = (np.exp(den_term * H) - 1.0) / den_term\n        \n        return num / den\n\ndef estimate_ground_phase(case_params):\n    \"\"\"\n    Estimates the ground phase for a single test case.\n    \n    Args:\n        case_params (dict): A dictionary containing all parameters for one case.\n    \n    Returns:\n        float: The estimated ground phase phi_g in radians.\n    \"\"\"\n    H = case_params['H']\n    kz = case_params['kz']\n    phi_g_true = case_params['phi_g']\n    \n    gamma_v_points = []\n    gamma_p_points = []\n    \n    # polarization channels are ordered to be deterministic (HH, HV, VV)\n    pol_channels = ['HH', 'HV', 'VV']\n\n    for p_name in pol_channels:\n        p_params = case_params['pols'][p_name]\n        xi = p_params['xi']\n        a = p_params['a']\n        b = p_params['b']\n        \n        # 1. Compute volume-only coherence\n        gamma_v = compute_gamma_v(H, kz, xi)\n        \n        # 2. Synthesize total coherence using the true ground phase\n        g_phasor = np.exp(1j * phi_g_true)\n        mu = (a / b)**2\n        gamma_p = (mu * g_phasor + gamma_v) / (mu + 1.0)\n        \n        gamma_v_points.append(gamma_v)\n        gamma_p_points.append(gamma_p)\n        \n    # 3. Formulate and solve the least-squares intersection-of-lines problem\n    num_pols = len(pol_channels)\n    A = np.zeros((num_pols, 2))\n    c_vec = np.zeros(num_pols)\n    \n    for i in range(num_pols):\n        v = gamma_v_points[i]\n        p = gamma_p_points[i]\n        \n        # Direction vector of the line in the complex plane\n        d_vec = p - v\n        \n        # Handle case where v and p are the same (pure volume)\n        if np.isclose(np.abs(d_vec), 0.0):\n            # This line provides no information on the ground point,\n            # but to avoid division by zero we can skip it or handle it.\n            # In a robust implementation, this line might be weighted out.\n            # Here we can just set its normal to zero.\n            nx, ny = 0.0, 0.0\n        else:\n            # Unit normal vector to the line\n            nx = -d_vec.imag / np.abs(d_vec)\n            ny = d_vec.real / np.abs(d_vec)\n        \n        A[i, 0] = nx\n        A[i, 1] = ny\n        c_vec[i] = nx * v.real + ny * v.imag\n        \n    # Solve the normal equations: (A^T A) x = A^T c\n    ATA = A.T @ A\n    ATc = A.T @ c_vec\n    \n    # Since the system is noise-free, the lines intersect perfectly.\n    # The matrix ATA is invertible.\n    solution = np.linalg.solve(ATA, ATc)\n    \n    g_hat = solution[0] + 1j * solution[1]\n    \n    # 4. The estimated phase is the argument of the resulting complex number\n    estimated_phi_g = np.angle(g_hat)\n    \n    return estimated_phi_g\n\nsolve()\n```"
        },
        {
            "introduction": "任何干涉测量的质量都取决于其相干性。这最后一个练习介绍了一种 PolInSAR 所独有的强大技术：相干性优化。您将学习如何找到极化通道的最佳组合以最大化干涉相干性，从而有效提高信噪比，实现更稳健、更准确的植被参数估计。这一目标可以通过构建并求解一个广义特征值问题来实现。",
            "id": "3834682",
            "problem": "考虑用于植被结构反演的极化干涉合成孔径雷达 (PolInSAR) 相干性优化问题。设两次重复轨道采集的极化散射矢量在共同基底下由复权重表示。定义第一次和第二次采集的 $3 \\times 3$ 埃尔米特半正定协方差矩阵分别为 $C_{11}$ 和 $C_{22}$，以及 $3 \\times 3$ 互协方差矩阵 $C_{12}$，其中 $C_{21} = C_{12}^{\\mathrm{H}}$，$(\\cdot)^{\\mathrm{H}}$ 表示共轭转置。构成 $6 \\times 6$ 埃尔米特块协方差矩阵\n$$\n\\Sigma \\;=\\; \\begin{bmatrix}\nC_{11} & C_{12} \\\\\nC_{21} & C_{22}\n\\end{bmatrix}.\n$$\n对于复权重矢量 $w_1 \\in \\mathbb{C}^3$ 和 $w_2 \\in \\mathbb{C}^3$，极化干涉相干性由以下瑞利商类型的商定义\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}.\n$$\n从复随机矢量的二阶统计核心定义以及加权内积空间中的柯西-施瓦茨不等式出发，推导一个等价的广义特征值公式，其主解提供最优相干性 $\\,\\gamma_{\\star}\\,$ 及相应的极化矢量 $\\,w_{1,\\star}\\,$ 和 $\\,w_{2,\\star}\\,$。您的推导必须从最大化 $\\,\\gamma(w_1, w_2)\\,$ 开始，约束条件为 $\\,w_1^{\\mathrm{H}} C_{11} w_1 = 1\\,$ 和 $\\,w_2^{\\mathrm{H}} C_{22} w_2 = 1\\,$，并通过一系列基于线性代数和概率论的有效变换进行，不得引入任何快捷公式。\n\n实现要求：\n- 给定 $\\,\\Sigma\\,$，计算 $\\,\\gamma_{\\star}\\,$ 以及任意一对达到最优值的极化矢量 $\\,w_{1,\\star}, w_{2,\\star}\\,$，并将其归一化以满足约束条件 $\\,w_{1,\\star}^{\\mathrm{H}} C_{11} w_{1,\\star} = 1\\,$ 和 $\\,w_{2,\\star}^{\\mathrm{H}} C_{22} w_{2,\\star} = 1\\,$。\n- 如果 $\\,C_{11}\\,$ 或 $\\,C_{22}\\,$ 是奇异或数值病态的，请使用通过埃尔米特特征分解计算的Tikhonov正则化逆平方根因子。具体来说，对于一个特征分解为 $\\,C = Q \\Lambda Q^{\\mathrm{H}}\\,$ 的埃尔米特矩阵 $\\,C\\,$，使用 $\\,C^{-1/2}_{\\epsilon} = Q \\operatorname{diag}\\!\\left(1/\\sqrt{\\lambda_i + \\epsilon}\\right) Q^{\\mathrm{H}}\\,$，并设定一个固定的 $\\,\\epsilon = 10^{-8}\\,$。\n- 对于每个测试用例，报告：\n  1. 最优相干性 $\\,\\gamma_{\\star}\\,$，作为浮点数，保留六位小数。\n  2. $\\,w_{1,\\star}\\,$ 的实部，作为包含三个浮点数的列表，每个浮点数保留六位小数。\n  3. $\\,w_{1,\\star}\\,$ 的虚部，作为包含三个浮点数的列表，每个浮点数保留六位小数。\n  4. $\\,w_{2,\\star}\\,$ 的实部，作为包含三个浮点数的列表，每个浮点数保留六位小数。\n  5. $\\,w_{2,\\star}\\,$ 的虚部，作为包含三个浮点数的列表，每个浮点数保留六位小数。\n\n测试套件：\n为以下三个科学上一致的案例提供结果，这些案例探究了典型、零值和秩亏情景。角度以弧度为单位指定。\n\n案例 1 (典型情况，具有非零干涉相位的对角协方差)：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 3.0,\\; 2.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.8,\\; 2.8,\\; 2.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.8}\\cdot 0.72 \\cdot e^{\\mathrm{i}\\cdot 0.1},\\;\\; \\sqrt{3.0 \\cdot 2.8}\\cdot 0.50 \\cdot e^{\\mathrm{i}\\cdot (-0.2)},\\;\\; \\sqrt{2.5 \\cdot 2.2}\\cdot 0.35 \\cdot e^{\\mathrm{i}\\cdot 0.05}\\Big).\n$$\n\n案例 2 (边缘情况，互协方差为零)：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(2.0,\\; 1.5,\\; 1.0\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(1.8,\\; 1.2,\\; 0.8\\right), \\quad\nC_{12} = \\begin{bmatrix}\n0 & 0 & 0 \\\\\n0 & 0 & 0 \\\\\n0 & 0 & 0\n\\end{bmatrix}.\n$$\n\n案例 3 (边界情况，$\\,C_{11}\\,$ 秩亏且第三通道具有强相干性)：\n$$\nC_{11} = \\operatorname{diag}\\!\\left(4.0,\\; 0.0,\\; 1.5\\right), \\quad\nC_{22} = \\operatorname{diag}\\!\\left(3.5,\\; 2.0,\\; 1.2\\right),\n$$\n$$\nC_{12} = \\operatorname{diag}\\!\\Big(\\sqrt{4.0 \\cdot 3.5}\\cdot 0.30 \\cdot e^{\\mathrm{i}\\cdot 0.3},\\;\\; 0.0,\\;\\; \\sqrt{1.5 \\cdot 1.2}\\cdot 0.90 \\cdot e^{\\mathrm{i}\\cdot (-0.15)}\\Big).\n$$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个案例的结果，格式为一个由方括号括起来的逗号分隔列表，中间没有任何空格。每个案例的结果本身应该是一个包含上述指定顺序的五个元素的列表。例如，输出应如下所示\n$$\n[\\,[\\gamma_1,[\\Re w_{1,1}],[\\Im w_{1,1}],[\\Re w_{2,1}],[\\Im w_{2,1}]],[\\gamma_2,[\\Re w_{1,2}],[\\Im w_{1,2}],[\\Re w_{2,2}],[\\Im w_{2,2}]],[\\gamma_3,[\\Re w_{1,3}],[\\Im w_{1,3}],[\\Re w_{2,3}],[\\Im w_{2,3}]]\\,],\n$$\n其中所有数值都四舍五入到六位小数并表示为浮点数。程序必须是自包含的，并且不得读取任何输入或文件。",
            "solution": "问题是通过最大化以下表达式来找到最大极化干涉相干性 $\\gamma_{\\star}$ 以及相应的极化权重矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$：\n$$\n\\gamma(w_1, w_2) \\;=\\; \\frac{\\left|\\, w_1^{\\mathrm{H}}\\, C_{12}\\, w_2 \\,\\right|}{\\sqrt{\\left(w_1^{\\mathrm{H}}\\, C_{11}\\, w_1\\right)\\,\\left(w_2^{\\mathrm{H}}\\, C_{22}\\, w_2\\right)}}\n$$\n约束条件为归一化约束 $w_1^{\\mathrm{H}}\\, C_{11}\\, w_1 = 1$ 和 $w_2^{\\mathrm{H}}\\, C_{22}\\, w_2 = 1$。矩阵 $C_{11}$ 和 $C_{22}$ 是埃尔米特半正定的。\n\n我们的推导过程是将问题转换为一个可用线性代数求解的标准形式，然后按要求将此解与一个广义特征值问题联系起来。\n\n步骤 1：通过变量替换进行重构\n约束条件和 $\\gamma(w_1, w_2)$ 的分母在加权内积空间中定义了范数。为了简化问题，我们可以将矢量 $w_1$ 和 $w_2$ 转换到一个具有标准欧几里得范数的空间中。我们定义新的矢量 $v_1 \\in \\mathbb{C}^3$ 和 $v_2 \\in \\mathbb{C}^3$ 如下：\n$$\nv_1 = C_{11}^{1/2} w_1 \\quad \\text{and} \\quad v_2 = C_{22}^{1/2} w_2\n$$\n其中 $C^{1/2}$ 表示一个半正定矩阵 $C$ 的埃尔米特平方根。如果 $C_{11}$ 或 $C_{22}$ 是奇异的，则逆变换所需的逆平方根未定义。按照规定，我们通过使用Tikhonov正则化的逆平方根 $C^{-1/2}_{\\epsilon}$ 来处理此问题。因此，逆变换为：\n$$\nw_1 = C_{11}^{-1/2} v_1 \\quad \\text{and} \\quad w_2 = C_{22}^{-1/2} v_2\n$$\n(下文中，$C^{-1/2}$ 在必要时隐式地表示正则化版本 $C^{-1/2}_{\\epsilon}$)。\n\n将这些代入归一化约束中，我们得到：\n$$\nw_1^{\\mathrm{H}} C_{11} w_1 = (C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{11} (C_{11}^{-1/2} v_1) = v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{11} C_{11}^{-1/2} v_1 = v_1^{\\mathrm{H}} v_1 = 1\n$$\n$$\nw_2^{\\mathrm{H}} C_{22} w_2 = (C_{22}^{-1/2} v_2)^{\\mathrm{H}} C_{22} (C_{22}^{-1/2} v_2) = v_2^{\\mathrm{H}} C_{22}^{-1/2 \\mathrm{H}} C_{22} C_{22}^{-1/2} v_2 = v_2^{\\mathrm{H}} v_2 = 1\n$$\n如果 $C_{11}$ 和 $C_{22}$ 是可逆的，这个等式精确成立。在正则化的情况下，$C^{-1/2}_{\\epsilon} C C^{-1/2}_{\\epsilon} \\neq I$，因此需要对最终得到的矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$ 进行最后的重新归一化。对新矢量的约束简化为标准的单位范数约束：$\\|v_1\\| = 1$ 和 $\\|v_2\\| = 1$。\n\n现在，我们将变换代入相干性表达式的分子中：\n$$\n|w_1^{\\mathrm{H}} C_{12} w_2| = |(C_{11}^{-1/2} v_1)^{\\mathrm{H}} C_{12} (C_{22}^{-1/2} v_2)| = |v_1^{\\mathrm{H}} C_{11}^{-1/2 \\mathrm{H}} C_{12} C_{22}^{-1/2} v_2|\n$$\n由于 $C_{11}$ 是埃尔米特矩阵，其平方根和逆平方根也是埃尔米特矩阵，所以 $C_{11}^{-1/2 \\mathrm{H}} = C_{11}^{-1/2}$。我们定义一个新矩阵 $K$：\n$$\nK = C_{11}^{-1/2} C_{12} C_{22}^{-1/2}\n$$\n优化问题现在转化为：\n$$\n\\text{最大化} \\quad |v_1^{\\mathrm{H}} K v_2| \\quad \\text{约束条件为} \\quad \\|v_1\\| = 1, \\|v_2\\| = 1\n$$\n\n步骤 2：通过奇异值分解 (SVD) 求解\n这是线性代数中的一个标准问题。当 $v_1$ 和 $v_2$ 分别是矩阵 $K$ 的主左奇异矢量和主右奇异矢量时，表达式 $|v_1^{\\mathrm{H}} K v_2|$ 达到最大值。所达到的最大值是 $K$ 的最大奇异值。\n\n设 $K$ 的奇异值分解为 $K = U S V^{\\mathrm{H}}$，其中 $U$ 和 $V$ 是酉矩阵，其列分别是左、右奇异矢量，$S$ 是由实数、非负奇异值 $s_1 \\ge s_2 \\ge \\dots \\ge 0$ 构成的对角矩阵。\n目标函数变为 $|v_1^{\\mathrm{H}} U S V^{\\mathrm{H}} v_2|$。令 $v'_1 = U^{\\mathrm{H}} v_1$ 和 $v'_2 = V^{\\mathrm{H}} v_2$。由于 $U$ 和 $V$ 是酉矩阵，所以 $\\|v'_1\\|=\\|v_1\\|=1$ 且 $\\|v'_2\\|=\\|v_2\\|=1$。问题等价于最大化 $|v_1'^{\\mathrm{H}} S v_2'|$。由于 $S$ 是对角矩阵，当 $v'_1$ 和 $v'_2$ 是标准基矢量 $e_1 = [1, 0, \\dots, 0]^{\\mathrm{T}}$ 时，该表达式达到最大值，对应于最大奇异值 $s_1$。\n\n最优相干性是最大值：\n$$\n\\gamma_{\\star} = s_{\\max}(K) = s_1\n$$\n变换空间中的最优矢量是 $U$ 和 $V$ 的第一列：\n$$\nv_{1,\\star} = u_1 \\quad \\text{and} \\quad v_{2,\\star} = v_1\n$$\n\n步骤 3：等价广义特征值问题的推导\n$K$ 的奇异值是 $K K^{\\mathrm{H}}$ 的特征值的平方根。我们来构造这个矩阵：\n$$\nK K^{\\mathrm{H}} = (C_{11}^{-1/2} C_{12} C_{22}^{-1/2}) (C_{11}^{-1/2} C_{12} C_{22}^{-1/2})^{\\mathrm{H}} = C_{11}^{-1/2} (C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) C_{11}^{-1/2}\n$$\n$K K^{\\mathrm{H}}$ 的特征值问题是 $K K^{\\mathrm{H}} v_1 = \\lambda v_1$，其中特征矢量是 $K$ 的左奇异矢量，$v_1 = u_i$，特征值是奇异值的平方，$\\lambda = s_i^2$。对于最大值，$\\lambda_{\\max} = s_{\\max}^2 = \\gamma_{\\star}^2$。\n代入 $K K^{\\mathrm{H}}$ 的表达式：\n$$\n(C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) v_1 = \\lambda v_1\n$$\n现在，我们左乘 $C_{11}^{1/2}$ 并代入 $v_1 = C_{11}^{1/2} w_1$：\n$$\nC_{11}^{1/2} (C_{11}^{-1/2} C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}} C_{11}^{-1/2}) (C_{11}^{1/2} w_1) = \\lambda C_{11}^{1/2} (C_{11}^{1/2} w_1)\n$$\n这可以简化为：\n$$\n(C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}) w_1 = \\lambda C_{11} w_1\n$$\n这是一个形式为 $A x = \\lambda B x$ 的广义特征值问题，其中 $A = C_{12} C_{22}^{-1} C_{12}^{\\mathrm{H}}$ 且 $B = C_{11}$。该系统的最大特征值 $\\lambda_{\\max}$ 等于最优相干性的平方，即 $\\gamma_{\\star}^2$。相应的特征矢量 $w_1$ 就是最优极化矢量 $w_{1,\\star}$。一旦 $w_{1,\\star}$ 已知，相应的 $w_{2,\\star}$ 可以从步骤 1 的最大化条件中找到，这导致 $w_{2,\\star}$ 与 $C_{22}^{-1} C_{12}^{\\mathrm{H}} w_{1,\\star}$ 成比例。这就完成了等价广义特征值公式的推导。\n\n在实现上，SVD 方法通常在数值上更稳定。最优矢量 $w_{1,\\star}$ 和 $w_{2,\\star}$ 通过将奇异矢量变换回原始空间得到：\n$$\nw_{1,\\star}^{\\text{raw}} = C_{11}^{-1/2} v_{1,\\star} \\quad \\text{and} \\quad w_{2,\\star}^{\\text{raw}} = C_{22}^{-1/2} v_{2,\\star}\n$$\n为了严格执行约束条件，特别是在使用正则化时，需要应用一个最终的归一化步骤：\n$$\nw_{1,\\star} = \\frac{w_{1,\\star}^{\\text{raw}}}{\\sqrt{w_{1,\\star}^{\\text{raw H}} C_{11} w_{1,\\star}^{\\text{raw}}}} \\quad \\text{and} \\quad w_{2,\\star} = \\frac{w_{2,\\star}^{\\text{raw}}}{\\sqrt{w_{2,\\star}^{\\text{raw H}} C_{22} w_{2,\\star}^{\\text{raw}}}}\n$$",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PolInSAR coherence optimization problem for three test cases.\n    \"\"\"\n    \n    epsilon = 1e-8\n\n    def compute_regularized_inverse_sqrt(C, e):\n        \"\"\"\n        Computes the Tikhonov-regularized inverse square root of a Hermitian matrix C.\n        C_inv_sqrt = Q * diag(1/sqrt(lambda_i + e)) * Q^H\n        \"\"\"\n        lambdas, Q = np.linalg.eigh(C)  # Eigenvalues are sorted in ascending order\n        \n        # Add epsilon to eigenvalues for regularization\n        # For a PSD matrix C, all lambdas are non-negative.\n        lambdas_reg = lambdas + e\n        \n        # Compute 1/sqrt of regularized eigenvalues\n        d_inv_sqrt_vals = 1.0 / np.sqrt(lambdas_reg)\n        \n        # Form the diagonal matrix of these values\n        D_inv_sqrt = np.diag(d_inv_sqrt_vals)\n        \n        # Reconstruct the matrix: Q @ D @ Q.conj().T\n        C_inv_sqrt = Q @ D_inv_sqrt @ Q.conj().T\n        \n        return C_inv_sqrt\n\n    def process_case(C11, C22, C12, eps):\n        \"\"\"\n        Processes a single test case to find optimal coherence and vectors.\n        \"\"\"\n        # Step 1: Compute regularized inverse square roots of C11 and C22\n        C11_inv_sqrt = compute_regularized_inverse_sqrt(C11, eps)\n        C22_inv_sqrt = compute_regularized_inverse_sqrt(C22, eps)\n        \n        # Step 2: Form the matrix K\n        K = C11_inv_sqrt @ C12 @ C22_inv_sqrt\n        \n        # Step 3: Compute the SVD of K\n        # U columns are left singular vectors, s are singular values, Vh is V hermitian\n        U, s, Vh = np.linalg.svd(K)\n        \n        # Step 4: Extract optimal coherence and transformed vectors\n        # The largest singular value is the optimal coherence\n        gamma_star = s[0]\n        \n        # The principal left singular vector (first column of U)\n        v1_star = U[:, 0]\n        # The principal right singular vector (first column of V, or conj().T of first row of Vh)\n        v2_star = Vh[0, :].conj()\n        \n        # Step 5: Transform vectors back to the original space\n        w1_raw = C11_inv_sqrt @ v1_star\n        w2_raw = C22_inv_sqrt @ v2_star\n        \n        # Step 6: Renormalize the vectors to satisfy the constraints, which is critical\n        # especially when regularization is active.\n        norm1_sq = (w1_raw.conj().T @ C11 @ w1_raw).real\n        w1_star = w1_raw / np.sqrt(norm1_sq) if norm1_sq > 0 else w1_raw\n\n        norm2_sq = (w2_raw.conj().T @ C22 @ w2_raw).real\n        w2_star = w2_raw / np.sqrt(norm2_sq) if norm2_sq > 0 else w2_raw\n        \n        # Prepare results for output\n        gamma_out = np.round(gamma_star, 6)\n        w1_real_out = np.round(w1_star.real, 6).tolist()\n        w1_imag_out = np.round(w1_star.imag, 6).tolist()\n        w2_real_out = np.round(w2_star.real, 6).tolist()\n        w2_imag_out = np.round(w2_star.imag, 6).tolist()\n        \n        return [gamma_out, w1_real_out, w1_imag_out, w2_real_out, w2_imag_out]\n\n    # Define Test Cases\n    # Case 1\n    C11_1 = np.diag([4.0, 3.0, 2.5])\n    C22_1 = np.diag([3.8, 2.8, 2.2])\n    C12_1 = np.diag([\n        np.sqrt(4.0 * 3.8) * 0.72 * np.exp(1j * 0.1),\n        np.sqrt(3.0 * 2.8) * 0.50 * np.exp(1j * -0.2),\n        np.sqrt(2.5 * 2.2) * 0.35 * np.exp(1j * 0.05)\n    ])\n\n    # Case 2\n    C11_2 = np.diag([2.0, 1.5, 1.0])\n    C22_2 = np.diag([1.8, 1.2, 0.8])\n    C12_2 = np.zeros((3, 3), dtype=np.complex128)\n\n    # Case 3\n    C11_3 = np.diag([4.0, 0.0, 1.5])\n    C22_3 = np.diag([3.5, 2.0, 1.2])\n    C12_3 = np.diag([\n        np.sqrt(4.0 * 3.5) * 0.30 * np.exp(1j * 0.3),\n        0.0,\n        np.sqrt(1.5 * 1.2) * 0.90 * np.exp(1j * -0.15)\n    ])\n    \n    test_cases = [\n        (C11_1, C22_1, C12_1),\n        (C11_2, C22_2, C12_2),\n        (C11_3, C22_3, C12_3)\n    ]\n    \n    results = []\n    for C11, C22, C12 in test_cases:\n        results.append(process_case(C11, C22, C12, epsilon))\n    \n    # Format the final output string\n    def format_list(data):\n        return '[' + ','.join(map(str, data)) + ']'\n        \n    formatted_results = []\n    for res in results:\n        gamma_str = f\"{res[0]:.6f}\"\n        w1r_str = format_list([f\"{x:.6f}\" for x in res[1]])\n        w1i_str = format_list([f\"{x:.6f}\" for x in res[2]])\n        w2r_str = format_list([f\"{x:.6f}\" for x in res[3]])\n        w2i_str = format_list([f\"{x:.6f}\" for x in res[4]])\n        formatted_results.append(f\"[{gamma_str},{w1r_str},{w1i_str},{w2r_str},{w2i_str}]\")\n        \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}