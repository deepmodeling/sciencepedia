{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导您完成经验线法的核心计算。通过使用两个已知反射率的地面目标及其对应的传感器测量辐亮度值，您将学习如何确定大气校正的关键参数——路径辐亮度 $a_\\lambda$ 和增益 $b_\\lambda$。掌握此方法后，您便可以将这些参数应用于场景中的任何像素，从而将其大气顶层（TOA）辐亮度转换为物理意义明确的地表反射率。",
            "id": "3808707",
            "problem": "一台成像光谱仪在波长为 $\\lambda$ 的窄光谱带内测量大气层顶（TOA）辐亮度。在晴朗、空间均匀的大气条件下，忽略邻近效应，且地表为朗伯体的情况下，大气层顶辐亮度的波段辐射传输可以分解为路径分量和传输到传感器的地表出射分量。对于固定的观测和光照几何，以及足够窄的光谱响应，这导致大气层顶辐亮度与该波段的地表反射率之间存在仿射依赖关系。经验线性法（ELM）利用两个已知地表反射率的参考目标来确定该仿射映射的截距（路径辐亮度）和斜率（系统增益）。\n\n给定在同一次采集中观测到的两个参考目标：\n- 目标 $1$：反射率 $\\rho_{1} = 0.04$，测量的大气层顶辐亮度 $L_{1} = 12.6$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n- 目标 $2$：反射率 $\\rho_{2} = 0.56$，测量的大气层顶辐亮度 $L_{2} = 48.2$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n\n假设该波段中大气层顶辐亮度与地表反射率之间的经验仿射映射在整个场景中是有效且恒定的。仅使用适用于辐射传输和遥感的​​基本原理和定义，推导关联大气层顶辐亮度 $L_{\\lambda}$ 与反射率 $\\rho_{\\lambda}$ 的经验线的截距 $a_{\\lambda}$ 和斜率 $b_{\\lambda}$，然后计算测量到的大气层顶辐亮度为 $L_{\\lambda} = 30.0$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ 的第三个像元的反射率 $\\rho_{\\lambda}$。\n\n将 $a_{\\lambda}$ 和 $b_{\\lambda}$ 以 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ 为单位表示，$\\rho_{\\lambda}$ 表示为无单位小数。将所有三个数值结果四舍五入到四位有效数字。仅提供最终的数值结果。",
            "solution": "该问题需进行验证。\n\n### 步骤1：提取已知条件\n-   大气层顶（TOA）辐亮度 $L_{\\lambda}$ 与地表反射率 $\\rho_{\\lambda}$ 之间的关系是仿射映射。\n-   目标1：反射率 $\\rho_{1} = 0.04$，测量的大气层顶辐亮度 $L_{1} = 12.6$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n-   目标2：反射率 $\\rho_{2} = 0.56$，测量的大气层顶辐亮度 $L_{2} = 48.2$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n-   第三个像元的测量大气层顶辐亮度为 $L_{\\lambda} = 30.0$ $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n-   任务是求经验线的截距 $a_{\\lambda}$ 和斜率 $b_{\\lambda}$，以及第三个像元的反射率 $\\rho_{\\lambda}$。\n-   所有三个数值结果必须四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于经验线性法（ELM），这是遥感中用于大气校正的一种标准的、基于物理的技术。仿射模型 $L_{\\lambda} \\approx a_{\\lambda} + b_{\\lambda}\\rho_{\\lambda}$ 是对朗伯表面上光学薄、均匀大气辐射传输方程的有效一阶近似，这与问题陈述的条件一致。\n-   **适定性**：该问题提供了两个不同的点 $(\\rho_1, L_1)$ 和 $(\\rho_2, L_2)$，这是唯一定义一条直线，从而确定其斜率 $b_{\\lambda}$ 和截距 $a_{\\lambda}$ 的充分必要条件。随后，给定第三个像元的辐亮度 $L_{\\lambda}$，其反射率 $\\rho_{\\lambda}$ 也可以被唯一确定。该问题是自洽的，并且有唯一的、稳定的解。\n-   **客观性**：该问题使用精确、定量的语言和公认的科学术语进行陈述。它没有主观或模糊的措辞。\n-   **一致性与真实性**：反射率值（$\\rho_{1} = 0.04$ 和 $\\rho_{2} = 0.56$）在物理上是现实的，落在 $[0, 1]$ 的有效范围内。辐亮度值对于典型的地球观测传感器也是合理的。没有内部矛盾。\n\n### 步骤3：结论与行动\n该问题科学上合理、适定且客观。判定为**有效**。将推导解答。\n\n经验线性法的基本原理是传感器（或大气层顶）光谱辐亮度 $L_{\\lambda}$ 与地表光谱反射率 $\\rho_{\\lambda}$ 之间的仿射关系。该关系可表示为线性方程：\n$$L_{\\lambda} = b_{\\lambda} \\rho_{\\lambda} + a_{\\lambda}$$\n这里，$b_{\\lambda}$ 是斜率，它包含了总下行太阳辐照度和大气透射率等因素；$a_{\\lambda}$ 是截距，主要代表大气路径辐亮度。下标 $\\lambda$ 表示这些参数特定于给定的光谱带。为简化推导过程的符号，下标 $\\lambda$ 将被省略，在最终表达式中再重新引入。\n\n给定两个参考点 $(\\rho_1, L_1)$ 和 $(\\rho_2, L_2)$，它们必须满足该线性方程。这产生了一个包含两个未知数 $a$ 和 $b$ 的二元线性方程组：\n$$L_1 = b \\rho_1 + a \\quad (1)$$\n$$L_2 = b \\rho_2 + a \\quad (2)$$\n\n为求斜率 $b$，我们将方程 $(2)$ 减去方程 $(1)$：\n$$L_2 - L_1 = (b \\rho_2 + a) - (b \\rho_1 + a)$$\n$$L_2 - L_1 = b \\rho_2 - b \\rho_1 = b (\\rho_2 - \\rho_1)$$\n解出 $b$：\n$$b = \\frac{L_2 - L_1}{\\rho_2 - \\rho_1}$$\n重新引入光谱依赖性，斜率 $b_{\\lambda}$ 为：\n$$b_{\\lambda} = \\frac{L_2 - L_1}{\\rho_2 - \\rho_1}$$\n\n为求截距 $a$，我们可以重新整理方程 $(1)$：\n$$a = L_1 - b \\rho_1$$\n代入 $b$ 的表达式：\n$$a = L_1 - \\left( \\frac{L_2 - L_1}{\\rho_2 - \\rho_1} \\right) \\rho_1$$\n我们可以通分来简化这个表达式：\n$$a = \\frac{L_1(\\rho_2 - \\rho_1) - (L_2 - L_1)\\rho_1}{\\rho_2 - \\rho_1} = \\frac{L_1\\rho_2 - L_1\\rho_1 - L_2\\rho_1 + L_1\\rho_1}{\\rho_2 - \\rho_1}$$\n$$a = \\frac{L_1\\rho_2 - L_2\\rho_1}{\\rho_2 - \\rho_1}$$\n重新引入光谱依赖性，截距 $a_{\\lambda}$ 为：\n$$a_{\\lambda} = \\frac{L_1 \\rho_2 - L_2 \\rho_1}{\\rho_2 - \\rho_1}$$\n\n现在，我们代入给定的数值：\n$\\rho_1 = 0.04$, $L_1 = 12.6 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n$\\rho_2 = 0.56$, $L_2 = 48.2 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n\n计算斜率 $b_{\\lambda}$：\n$$b_{\\lambda} = \\frac{48.2 - 12.6}{0.56 - 0.04} = \\frac{35.6}{0.52} \\approx 68.461538... \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$$\n四舍五入到四位有效数字，$b_{\\lambda} = 68.46 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n\n计算截距 $a_{\\lambda}$：\n$$a_{\\lambda} = \\frac{(12.6)(0.56) - (48.2)(0.04)}{0.56 - 0.04} = \\frac{7.056 - 1.928}{0.52} = \\frac{5.128}{0.52} \\approx 9.861538... \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$$\n四舍五入到四位有效数字，$a_{\\lambda} = 9.862 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$。\n\n最后的任务是计算测量到的大气层顶辐亮度为 $L_{\\lambda} = 30.0 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$ 的像元的反射率 $\\rho_{\\lambda}$。我们从基本方程开始，求解 $\\rho_{\\lambda}$：\n$$L_{\\lambda} = b_{\\lambda} \\rho_{\\lambda} + a_{\\lambda}$$\n$$b_{\\lambda} \\rho_{\\lambda} = L_{\\lambda} - a_{\\lambda}$$\n$$\\rho_{\\lambda} = \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}}$$\n\n为保持精度，我们在此计算中使用 $a_{\\lambda}$ 和 $b_{\\lambda}$ 的未四舍五入值：\n$$\\rho_{\\lambda} = \\frac{30.0 - 9.861538...}{68.461538...} = \\frac{20.138461...}{68.461538...} \\approx 0.294166...$$\n将最终结果四舍五入到四位有效数字，反射率为 $\\rho_{\\lambda} = 0.2942$。这是一个无单位量。\n\n所要求的值是截距 $a_{\\lambda}$、斜率 $b_{\\lambda}$ 和目标反射率 $\\rho_{\\lambda}$。\n-   $a_{\\lambda} \\approx 9.862 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n-   $b_{\\lambda} \\approx 68.46 \\, \\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$\n-   $\\rho_{\\lambda} \\approx 0.2942$ (无单位)",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n9.862  68.46  0.2942\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在实际应用中，任何测量都伴随着不确定性，经验线法也不例外。校准参数 $a_\\lambda$ 和 $b_\\lambda$ 以及待校正像素的辐亮度 $L_\\lambda$ 都不是绝对精确的。本练习旨在介绍误差传播的基本原理，指导您如何量化这些输入不确定性对最终反演出的地表反射率 $\\rho_\\lambda$ 的影响，从而对结果的可靠性进行科学评估。",
            "id": "3808679",
            "problem": "一台工作在太阳反射域的窄带成像光谱仪，在晴朗大气条件下测量来自未知光谱反射率 $\\rho_{\\lambda}$ 表面的传感器入瞳辐亮度 $L_{\\lambda}$。经验线性法（ELM）是一种对辐射传输进行场内定标线性化的方法，该方法中，仪器在波长 $\\lambda$ 处的响应表示为地表反射率和辐亮度之间的仿射映射，其参数由已知反射率的地面目标及其同步测量的辐亮度确定。设 $a_{\\lambda}$ 表示大气路径辐亮度偏移量，$b_{\\lambda}$ 表示与波长相关的增益，该增益包含了光照、太阳和传感器路径上的大气透射率以及仪器通量，所有这些在定标和采集期间均假定为常数。\n\n从以下物理前提开始：在一个足够窄的波段通道和有限的地表反射率范围内，$L_{\\lambda}$ 和 $\\rho_{\\lambda}$ 之间的映射是线性的，偏移量为 $a_{\\lambda}$，增益为 $b_{\\lambda}$。请推导用 $L_{\\lambda}$、$a_{\\lambda}$ 和 $b_{\\lambda}$ 表示 $\\rho_{\\lambda}$ 的表达式。然后，使用基于全微分的一阶不确定度传播方法，并假设 $L_{\\lambda}$、$a_{\\lambda}$ 和 $b_{\\lambda}$ 相互独立，推导用 $\\sigma_{L,\\lambda}$、$\\sigma_{a,\\lambda}$ 和 $\\sigma_{b,\\lambda}$ 表示 $\\rho_{\\lambda}$ 的标准不确定度 $\\sigma_{\\rho,\\lambda}$ 的表达式。\n\n对以下已定标波段计算您的表达式：\n- $a_{\\lambda} = 10.0 \\pm 0.3$，\n- $b_{\\lambda} = 70.0 \\pm 3.0$，\n- $L_{\\lambda} = 35.0 \\pm 0.5$，\n\n其中，辐亮度的单位为 $\\mathrm{W\\,m^{-2}\\,sr^{-1}\\,nm^{-1}}$，而 $\\rho_{\\lambda}$ 是无量纲的。将 $\\rho_{\\lambda}$ 和 $\\sigma_{\\rho,\\lambda}$ 表示为纯小数（不带百分号）。将两个数值都四舍五入到四位有效数字。",
            "solution": "该问题是有效的。其科学基础是辐射传输和遥感的原理，特别是经验线性法（ELM），并采用了标准统计不确定度传播方法。该问题提法得当、客观，并包含了推导唯一解所需的所有信息。\n\n传感器入瞳辐亮度 $L_{\\lambda}$、地表反射率 $\\rho_{\\lambda}$、路径辐亮度 $a_{\\lambda}$ 和增益 $b_{\\lambda}$ 之间的关系被描述为一个仿射映射，具体来说是一个带偏移量的线性函数。其形式化表达式为：\n$$L_{\\lambda} = a_{\\lambda} + b_{\\lambda} \\rho_{\\lambda}$$\n其中，$a_{\\lambda}$ 是对应于大气路径辐亮度的辐亮度偏移量（即零反射率目标的信号），而 $b_{\\lambda}$ 是包含了太阳光照、双程大气透过率和传感器响应影响的增益因子。\n\n首先，我们通过对该方程进行代数重排来推导地表反射率 $\\rho_{\\lambda}$ 的表达式：\n$$L_{\\lambda} - a_{\\lambda} = b_{\\lambda} \\rho_{\\lambda}$$\n$$\\rho_{\\lambda} = \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}}$$\n该方程允许在给定定标系数 $a_{\\lambda}$ 和 $b_{\\lambda}$ 的情况下，从测量的传感器入瞳辐亮度中反演地表反射率。\n\n接下来，我们推导反演反射率的标准不确定度 $\\sigma_{\\rho,\\lambda}$ 的表达式。我们使用一阶不确定度传播公式，对于一个函数 $f(x_1, x_2, \\dots, x_n)$，其自变量 $x_i$ 相互独立且标准不确定度为 $\\sigma_{x_i}$：\n$$\\sigma_f^2 = \\sum_{i=1}^{n} \\left( \\frac{\\partial f}{\\partial x_i} \\right)^2 \\sigma_{x_i}^2$$\n在我们的例子中，函数是 $\\rho_{\\lambda}(L_{\\lambda}, a_{\\lambda}, b_{\\lambda})$，自变量是 $L_{\\lambda}$、$a_{\\lambda}$ 和 $b_{\\lambda}$。我们计算 $\\rho_{\\lambda}$ 对每个变量的偏导数：\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial L_{\\lambda}} = \\frac{\\partial}{\\partial L_{\\lambda}} \\left( \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}} \\right) = \\frac{1}{b_{\\lambda}}$$\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial a_{\\lambda}} = \\frac{\\partial}{\\partial a_{\\lambda}} \\left( \\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}} \\right) = -\\frac{1}{b_{\\lambda}}$$\n$$\\frac{\\partial \\rho_{\\lambda}}{\\partial b_{\\lambda}} = \\frac{\\partial}{\\partial b_{\\lambda}} \\left( (L_{\\lambda} - a_{\\lambda}) b_{\\lambda}^{-1} \\right) = (L_{\\lambda} - a_{\\lambda})(-1)b_{\\lambda}^{-2} = -\\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}^2}$$\n\n将这些偏导数代入不确定度传播公式，我们得到不确定度的平方 $\\sigma_{\\rho,\\lambda}^2$：\n$$\\sigma_{\\rho,\\lambda}^2 = \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial L_{\\lambda}}\\right)^2 \\sigma_{L,\\lambda}^2 + \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial a_{\\lambda}}\\right)^2 \\sigma_{a,\\lambda}^2 + \\left(\\frac{\\partial \\rho_{\\lambda}}{\\partial b_{\\lambda}}\\right)^2 \\sigma_{b,\\lambda}^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\left(\\frac{1}{b_{\\lambda}}\\right)^2 \\sigma_{L,\\lambda}^2 + \\left(-\\frac{1}{b_{\\lambda}}\\right)^2 \\sigma_{a,\\lambda}^2 + \\left(-\\frac{L_{\\lambda} - a_{\\lambda}}{b_{\\lambda}^2}\\right)^2 \\sigma_{b,\\lambda}^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{1}{b_{\\lambda}^2} \\sigma_{L,\\lambda}^2 + \\frac{1}{b_{\\lambda}^2} \\sigma_{a,\\lambda}^2 + \\frac{(L_{\\lambda} - a_{\\lambda})^2}{b_{\\lambda}^4} \\sigma_{b,\\lambda}^2$$\n取平方根得到标准不确定度 $\\sigma_{\\rho,\\lambda}$：\n$$\\sigma_{\\rho,\\lambda} = \\sqrt{\\frac{\\sigma_{L,\\lambda}^2 + \\sigma_{a,\\lambda}^2}{b_{\\lambda}^2} + \\frac{(L_{\\lambda} - a_{\\lambda})^2}{b_{\\lambda}^4} \\sigma_{b,\\lambda}^2}$$\n这是反演反射率不确定度的通用表达式。\n\n最后，我们使用给定的数值数据来计算这些表达式：\n- $a_{\\lambda} = 10.0$，不确定度为 $\\sigma_{a,\\lambda} = 0.3$\n- $b_{\\lambda} = 70.0$，不确定度为 $\\sigma_{b,\\lambda} = 3.0$\n- $L_{\\lambda} = 35.0$，不确定度为 $\\sigma_{L,\\lambda} = 0.5$\n\n我们首先计算反射率 $\\rho_{\\lambda}$ 的值：\n$$\\rho_{\\lambda} = \\frac{35.0 - 10.0}{70.0} = \\frac{25.0}{70.0} = \\frac{5}{14} \\approx 0.3571428...$$\n四舍五入到四位有效数字，我们得到 $\\rho_{\\lambda} = 0.3571$。\n\n现在，我们计算标准不确定度 $\\sigma_{\\rho,\\lambda}$。我们将数值代入导出的不确定度公式中：\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{(0.5)^2 + (0.3)^2}{(70.0)^2} + \\frac{(35.0 - 10.0)^2}{(70.0)^4} (3.0)^2$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.25 + 0.09}{4900} + \\frac{(25.0)^2}{(2.401 \\times 10^7)} (9.0)$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.34}{4900} + \\frac{625 \\times 9.0}{2.401 \\times 10^7}$$\n$$\\sigma_{\\rho,\\lambda}^2 = \\frac{0.34}{4900} + \\frac{5625}{24010000}$$\n$$\\sigma_{\\rho,\\lambda}^2 \\approx 6.93877... \\times 10^{-5} + 2.34277... \\times 10^{-4}$$\n$$\\sigma_{\\rho,\\lambda}^2 \\approx 3.03665... \\times 10^{-4}$$\n取平方根求标准不确定度：\n$$\\sigma_{\\rho,\\lambda} = \\sqrt{3.03665... \\times 10^{-4}} \\approx 0.01742599...$$\n四舍五入到四位有效数字，我们得到 $\\sigma_{\\rho,\\lambda} = 0.01743$。\n\n因此，反演得到的反射率为 $\\rho_{\\lambda} = 0.3571$，其标准不确定度为 $\\sigma_{\\rho,\\lambda} = 0.01743$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.3571  0.01743\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然两点校准是经验线法的基础，但在实践中，使用多个（大于两个）校准目标可以显著提高校准的稳健性和准确性。通过增加数据点，我们可以减小单个目标测量误差对整体模型的影响。本练习将要求您使用普通最小二乘法（OLS）来实现多点校准，并计算决定系数 $R^2$ 等统计指标来评估线性模型的拟合优度，这是一个更通用、更强大的实践方法。",
            "id": "3808740",
            "problem": "您的任务是设计并实现用于太阳反射域大气校正的经验线性法 (ELM)，从第一性原理出发，并应用于定标目标。经验线性法 (ELM) 假设地表为朗伯体且光谱波段很窄，并且在一个小场景范围内，大气路径贡献和透射率可以被视为特定于波段的常数。在这些条件下，特定波段的传感器接收光谱辐射率是该波段地表反射率的仿射函数。从这一物理基础出发，推导单个波长波段的适当仿射模型，然后使用由地表反射率和传感器接收辐射率对组成的定标数据，通过普通最小二乘法 (OLS) 估计其参数。\n\n使用的科学基础：\n- 太阳反射域中的辐射传输结合了大气路径辐射和穿过大气的地表反射辐射。在朗伯体假设和窄带近似下，地表反射的贡献与地表反射率成正比，比例常数包含了下行辐照度、大气透射率和几何因子的项。\n- 普通最小二乘法 (OLS) 估计最小化了观测值与仿射模型预测值之间的平方差之和。\n- 决定系数 (R2) 量化了因变量中可由模型解释的方差比例。\n\n任务：\n- 对于每个给定的测试用例，您将获得5个定标对 $\\left(\\rho_i, L_i\\right)$，其中 $\\rho_i$ 是无单位的地表反射率，$L_i$ 是在单次采集中对定标目标测量的单个波长波段 $\\lambda$ 的传感器接收光谱辐射率，单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$。\n- 使用基于物理原理的仿射模型，通过普通最小二乘法 (OLS) 估计特定波段的截距 $a_\\lambda$ 和斜率 $b_\\lambda$。\n- 计算5个定标对的残差，即测量辐射率与模型预测辐射率之间的差异。\n- 计算拟合的决定系数 (R2)。\n- 为每个测试用例报告一个列表，其中包含估计的 $a_\\lambda$（单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$）、估计的 $b_\\lambda$（单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ 每单位反射率）、标量 $R^2$（无单位）以及5个残差的列表（每个单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$）。所有浮点输出必须四舍五入到6位小数。\n\n单位：\n- $L_i$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$。\n- $\\rho_i$: 无单位。\n- $a_\\lambda$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$。\n- $b_\\lambda$: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$ 每单位反射率。\n- $R^2$: 无单位。\n- 残差: $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$。\n\n测试套件：\n- 案例1 (良态，中等噪声):\n  - $\\rho$: $[0.02, 0.10, 0.20, 0.35, 0.50]$\n  - $L$: $[7.5, 16.95, 29.2, 46.85, 65.0]$\n- 案例2 (反射率范围小，测试数值稳定性):\n  - $\\rho$: $[0.30, 0.305, 0.310, 0.315, 0.320]$\n  - $L$: $[34.02, 34.39, 34.8, 35.215, 35.58]$\n- 案例3 (一个定标对中存在异常值):\n  - $\\rho$: $[0.05, 0.15, 0.25, 0.35, 0.45]$\n  - $L$: $[9.0, 19.0, 39.0, 39.0, 49.0]$\n- 案例4 (完美的仿射关系):\n  - $\\rho$: $[0.00, 0.12, 0.24, 0.36, 0.48]$\n  - $L$: $[6.0, 16.8, 27.6, 38.4, 49.2]$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，每个测试用例对应一个嵌套列表，形式为 $[a_\\lambda, b_\\lambda, R^2, [r_1, r_2, r_3, r_4, r_5]]$。例如：$[[a_1,b_1,R^2_1,[r_{1,1},\\dots,r_{1,5}]],[a_2,b_2,R^2_2,[r_{2,1},\\dots,r_{2,5}]],\\dots]$。所有浮点值必须四舍五入到6位小数。",
            "solution": "该问题是有效的。它提出了遥感领域一个定义明确的任务，该任务基于成熟的辐射传输物理原理和标准统计方法。所有唯一解所需的必要数据和条件都已提供，并且不存在科学或逻辑上的矛盾。\n\n经验线性法 (ELM) 提供了一种稳健的、数据驱动的大气校正方法。它利用从定标目标获取的地表反射率现场测量数据，来建立地表属性与传感器测量值之间的直接经验关系。该方法基于一系列针对单一光谱波段 $\\lambda$ 和空间有限场景的简化但物理上合理的假设。\n\n**1. 物理模型推导**\n\n其基本原理是，传感器接收到的光谱辐射率 $L_\\lambda$ 是地表反射率 $\\rho$ 的一个仿射函数。这一关系源于太阳反射域中一个简化的辐射传输模型，该模型假设场景上方的大气是均匀的，并且地表目标具有朗伯（完全漫反射）反射特性。该模型表示为：\n\n$$ L_\\lambda = a_\\lambda + b_\\lambda \\rho $$\n\n在此方程中：\n- $L_\\lambda$ 是传感器接收的光谱辐射率，单位为 $\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu\\mathrm{m}^{-1}$。\n- $\\rho$ 是目标的无单位地表反射率。\n- $a_\\lambda$ 是模型截距，代表大气路径辐射率 $L_{path, \\lambda}$。这是指大气散射进入传感器视场而未与地表相互作用的辐射。当 $\\rho = 0$ 时，它就是 $L_\\lambda$ 的值。\n- $b_\\lambda$ 是模型斜率。该项结合了多个物理因素：地表的总下行太阳辐照度 $E_{down, \\lambda}$，以及从地表到传感器的路径上的大气透射率 $T_\\lambda^{\\uparrow}$。对于朗伯表面，此关系可概括为 $b_\\lambda = \\frac{E_{down, \\lambda} T_\\lambda^{\\uparrow}}{\\pi}$。\n\n目标是使用一组 $n$ 个定标对 $(\\rho_i, L_i)$ 来估计特定波段的大气常数 $a_\\lambda$ 和 $b_\\lambda$。\n\n**2. 通过普通最小二乘法 (OLS) 进行参数估计**\n\n我们采用普通最小二乘法 (OLS) 来寻找最能拟合定标数据的参数 $a_\\lambda$ 和 $b_\\lambda$。OLS 最小化了残差平方和 (SSR)，即测量辐射率 $L_i$ 与模型预测辐射率 $\\hat{L_i} = a_\\lambda + b_\\lambda \\rho_i$ 之间差值的平方和。\n\n$$ SSR = \\sum_{i=1}^{n} (L_i - \\hat{L_i})^2 = \\sum_{i=1}^{n} (L_i - (a_\\lambda + b_\\lambda \\rho_i))^2 $$\n\n为了最小化 $SSR$，我们对 $a_\\lambda$ 和 $b_\\lambda$ 求偏导数并令其为零。这个过程得出了参数的以下解析解：\n\n斜率 $b_\\lambda$ 由 $\\rho$ 和 $L$ 的协方差与 $\\rho$ 的方差之比给出：\n$$ b_\\lambda = \\frac{\\sum_{i=1}^{n} (\\rho_i - \\bar{\\rho})(L_i - \\bar{L})}{\\sum_{i=1}^{n} (\\rho_i - \\bar{\\rho})^2} $$\n\n然后确定截距 $a_\\lambda$，以确保直线通过均值点 $(\\bar{\\rho}, \\bar{L})$：\n$$ a_\\lambda = \\bar{L} - b_\\lambda \\bar{\\rho} $$\n\n在这里，$\\bar{\\rho} = \\frac{1}{n}\\sum_{i=1}^{n}\\rho_i$ 和 $\\bar{L} = \\frac{1}{n}\\sum_{i=1}^{n}L_i$ 分别是反射率和辐射率数据的样本均值。\n\n**3. 模型评估**\n\n一旦参数被估计出来，就必须对模型的性能进行量化。\n\n- **残差**：对于每个定标点，其残差 $r_i$ 是观测辐射率与预测辐射率之间的差值。它量化了模型在该特定点上的误差。\n  $$ r_i = L_i - \\hat{L_i} = L_i - (a_\\lambda + b_\\lambda \\rho_i) $$\n  这 $n$ 个残差的列表提供了拟合情况的详细视图。\n\n- **决定系数 ($R^2$)**：$R^2$ 值提供了拟合优度的综合度量。它表示因变量 ($L$) 中的方差能被自变量 ($\\rho$) 通过仿射模型解释的比例。其计算公式为：\n  $$ R^2 = 1 - \\frac{SSR}{SST} $$\n  其中 $SSR$ 是如前定义的残差平方和，而 $SST$ 是总平方和，用于衡量观测辐射率数据的总方差：\n  $$ SST = \\sum_{i=1}^{n} (L_i - \\bar{L})^2 $$\n  $R^2$ 值接近 $1$ 表示存在非常强的线性关系和良好的模型拟合，而接近 $0$ 的值则表明没有线性关系。\n\n**4. 算法实现**\n\n对于提供的每个测试用例，执行以下计算步骤：\n1.  定义输入的 $n=5$ 组定标对 $(\\rho_i, L_i)$。\n2.  计算样本均值 $\\bar{\\rho}$ 和 $\\bar{L}$。\n3.  使用上面推导的 OLS 公式计算斜率 $b_\\lambda$ 和截距 $a_\\lambda$。\n4.  为每个定标点计算预测辐射率 $\\hat{L_i}$。\n5.  计算所有 $i=1, \\dots, 5$ 的残差 $r_i = L_i - \\hat{L_i}$。\n6.  计算 $SST$ 和 $SSR$ 以确定 $R^2$ 值。\n7.  将最终结果——估计的参数 $a_\\lambda$ 和 $b_\\lambda$、$R^2$ 统计量以及残差列表——按要求四舍五入到6位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process test cases for the Empirical Line Method.\n    \"\"\"\n\n    def perform_elm_ols(rho_data, l_data):\n        \"\"\"\n        Performs OLS regression for the Empirical Line Method.\n\n        Args:\n            rho_data (list): A list of surface reflectance values.\n            l_data (list): A list of corresponding at-sensor radiance values.\n\n        Returns:\n            list: A list containing [a, b, R2, [residuals]], all rounded to 6 decimal places.\n        \"\"\"\n        # Convert inputs to numpy arrays for vectorized operations, using 64-bit floats for precision.\n        rho = np.array(rho_data, dtype=np.float64)\n        L = np.array(l_data, dtype=np.float64)\n\n        # Calculate the sample means\n        rho_bar = np.mean(rho)\n        L_bar = np.mean(L)\n\n        # Calculate the slope (b_lambda) and intercept (a_lambda) using the OLS formulas.\n        # This form, using deviations from the mean, is generally more numerically stable.\n        # b = Cov(rho, L) / Var(rho)\n        numerator = np.sum((rho - rho_bar) * (L - L_bar))\n        denominator = np.sum((rho - rho_bar)**2)\n        \n        # Avoid division by zero if all rho values are identical (denominator would be 0).\n        # In such a case, the slope is undefined. For the given problem, this is not an issue.\n        if denominator == 0:\n            # This case is not expected based on the problem's test suite.\n            # A vertical line has an infinite slope. We return NaN for b and a.\n            # R^2 would be undefined.\n            b = np.nan\n            a = np.nan\n        else:\n            b = numerator / denominator\n            a = L_bar - b * rho_bar\n\n        # Calculate the predicted radiance values\n        L_hat = a + b * rho\n\n        # Calculate the residuals\n        residuals = L - L_hat\n\n        # Calculate the Coefficient of Determination (R^2)\n        # R^2 = 1 - (Sum of Squared Residuals / Total Sum of Squares)\n        ssr = np.sum(residuals**2)\n        sst = np.sum((L - L_bar)**2)\n        \n        # Avoid division by zero if all L values are identical (SST would be 0).\n        if sst == 0:\n            # If SST is 0, all L are the same. If SSR is also 0, fit is perfect, so R^2 is 1.\n            # Otherwise, the model has no explanatory power, and R^2 would be 0.\n            r2 = 1.0 if ssr == 0 else 0.0\n        else:\n            r2 = 1 - (ssr / sst)\n\n        # Round all floating-point results to 6 decimal places as required.\n        a_rounded = round(a, 6)\n        b_rounded = round(b, 6)\n        r2_rounded = round(r2, 6)\n        residuals_rounded = [round(res, 6) for res in residuals]\n        \n        return [a_rounded, b_rounded, r2_rounded, residuals_rounded]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (well-conditioned, modest noise)\n        {'rho': [0.02, 0.10, 0.20, 0.35, 0.50], 'L': [7.5, 16.95, 29.2, 46.85, 65.0]},\n        # Case 2 (small reflectance span, tests numerical stability)\n        {'rho': [0.30, 0.305, 0.310, 0.315, 0.320], 'L': [34.02, 34.39, 34.8, 35.215, 35.58]},\n        # Case 3 (outlier in one calibration pair)\n        {'rho': [0.05, 0.15, 0.25, 0.35, 0.45], 'L': [9.0, 19.0, 39.0, 39.0, 49.0]},\n        # Case 4 (perfect affine relationship)\n        {'rho': [0.00, 0.12, 0.24, 0.36, 0.48], 'L': [6.0, 16.8, 27.6, 38.4, 49.2]}\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = perform_elm_ols(case['rho'], case['L'])\n        all_results.append(result)\n\n    # Format the final output string according to the specified format.\n    # Floating-point values are formatted to ensure 6 decimal places are shown.\n    def format_case_result(res):\n        a_str = f\"{res[0]:.6f}\"\n        b_str = f\"{res[1]:.6f}\"\n        r2_str = f\"{res[2]:.6f}\"\n        residuals_list_str = [f\"{r:.6f}\" for r in res[3]]\n        residuals_str = f\"[{','.join(residuals_list_str)}]\"\n        return f\"[{a_str},{b_str},{r2_str},{residuals_str}]\"\n\n    final_output_string = f\"[{','.join([format_case_result(res) for res in all_results])}]\"\n\n    # The final print statement must produce only the single-line formatted output.\n    print(final_output_string)\n\nsolve()\n```"
        }
    ]
}