{
    "hands_on_practices": [
        {
            "introduction": "数字信号(DN)不仅仅是任意的数值；它们的统计分布包含了关于传感器物理特性的关键信息。本练习将引导您使用光子传输曲线(PTC)法（这是传感器表征的基石）来将像素噪声分解为其基本组成部分：与信号相关的散粒噪声和固有的读出噪声。通过分析直方图宽度随信号强度的变化，我们可以估算出传感器的关键性能指标，从而深入理解图像数据的物理来源。",
            "id": "3806017",
            "problem": "一个工作在推扫模式下的星载传感器，在实验室辐射扫描中，采用多种曝光设置记录了一个均匀辐射目标的数字量化值（DN）图像。在遥感与环境建模的背景下，假设随机图像形成过程及其测量遵循以下基本原理：\n\n- 光子的到达被建模为泊松过程（Poisson process），因此在一个像素中产生的光电子数 $E$ 的方差等于其均值，即 $\\mathrm{Var}(E) = \\mathbb{E}[E]$。\n- 探测器中的电子读出噪声被建模为一个独立的加性高斯随机变量 $R$，其均值为零，方差为 $\\sigma_r^2$（以电子为单位），即 $R \\sim \\mathcal{N}(0, \\sigma_r^2)$，且与 $E$ 独立。\n- 系统响应在偏置校正后是线性的，使得 DN 值 $D$ 通过 $D = \\alpha T$ 与总电子数 $T = E + R$ 相关联，其中 $\\alpha$ 是系统增益（单位为 $\\mathrm{DN/e^-}$），并且偏置偏移已被移除，因此均值关系为 $\\mathbb{E}[D] = \\alpha \\mathbb{E}[E]$。\n\n基于这些基本原理，推导在整个辐射扫描中 DN 方差与 DN 均值之间的关系，该关系应适用于通过对“方差-均值”数据进行直线拟合来进行参数估计。然后，设计一个算法，该算法根据在不同曝光下从均匀目标区域测得的直方图宽度（以 DN 为单位的标准差）和平均 DN 值，估算散粒噪声标度（增益 $\\alpha$，单位为 $\\mathrm{DN/e^-}$）和读出噪声幅值（以电子为单位的 $\\sigma_r$）。\n\n您的程序必须通过对每个提供的测试用例的 DN 方差与 DN 均值进行线性拟合来实现此估计，然后将拟合参数转换为所需的物理量。程序不得要求任何用户输入。\n\n在数值输出中，最终估算的读出噪声（以电子为单位的 $\\sigma_r$）和增益 $\\alpha$ 应不附带物理单位；但是，其解释必须是：$\\sigma_r$ 的单位为 $\\mathrm{e^-}$，$\\alpha$ 的单位为 $\\mathrm{DN/e^-}$。将每个报告的数值四舍五入到六位小数。\n\n测试套件。对于每个用例，您将获得来自均匀目标区域的平均 DN 值数组和相应的直方图宽度（DN 标准差）数组。所有测量值均经过偏置校正，并在线性响应条件下获取。仅使用给定的值。\n\n- 用例1（一般理想情况，中到高辐射度）：\n  - 平均 DN: [$475$, $1425$, $2850$, $5700$, $8550$, $11400$]\n  - 直方图宽度 (DN): [$21.536$, $36.958$, $52.153$, $73.671$, $90.196$, $104.136$]\n- 用例2（弱光条件，读出噪声主导边界）：\n  - 平均 DN: [$0$, $47.5$, $95$, $190$]\n  - 直方图宽度 (DN): [$3.515$, $7.585$, $10.130$, $13.889$]\n- 用例3（某次曝光中存在轻微离群值）：\n  - 平均 DN: [$600$, $1800$, $3600$, $7200$, $10800$]\n  - 直方图宽度 (DN): [$27.495$, $46.872$, $66.0$, $102.442$, $114.0$]\n- 用例4（不同的传感器增益和读出噪声，中等辐射度范围）：\n  - 平均 DN: [$350$, $1400$, $2800$, $4900$]\n  - 直方图宽度 (DN): [$15.716$, $31.352$, $44.333$, $58.600$]\n\n所需输出格式。您的程序应生成单行输出，其中包含所有用例的结果，格式为方括号括起来的逗号分隔列表。每个用例的结果必须是包含两个浮点数 [$\\alpha$, $\\sigma_r$] 的列表，四舍五入到六位小数，并按上述用例的顺序排列。例如，输出应类似于 [$[$a$,$b$],[$c$,$d$],[$e$,$f$],[$g$,$h$]$]，其中每个符号都是一个浮点数。不应打印任何附加文本。\n\n所有用例的最终答案必须仅为数值浮点数（无单位、无百分号），并完全按照规定进行汇总。",
            "solution": "用户提供的问题已经过评估，并被确定为 **有效**。该问题以传感器噪声建模的既定原则为科学基础，是适定的，并且其组成部分是完整且内部一致的。因此，我们可以进行正式求解。\n\n该问题要求基于光子探测和电子噪声的物理模型，推导传感器数字量化值（DN）输出的均值与方差之间的关系。然后，利用此关系来估计关键的传感器参数：系统增益 $\\alpha$ 和读出噪声 $\\sigma_r$。\n\n该物理模型由三个核心原则定义：\n1.  在一个像素处产生的光电子数 $E$ 是一个遵循泊松分布的随机变量。泊松分布的一个基本性质是其方差等于其均值：$\\mathrm{Var}(E) = \\mathbb{E}[E]$。我们将平均光电子数记为 $\\mu_E$。因此，$\\mathrm{Var}(E) = \\mu_E$。\n2.  电子读出噪声 $R$ 是一个独立的加性高斯随机变量，其均值为零，方差为 $\\sigma_r^2$。即 $\\mathbb{E}[R] = 0$ 且 $\\mathrm{Var}(R) = \\sigma_r^2$。$R$ 的均值和方差的单位都是电子。\n3.  在一个像素处累积的总电子数 $T$ 是光电子数和读出噪声之和：$T = E + R$。最终的数字量化值 $D$ 与总电子数 $T$ 呈线性正比关系，系统增益为 $\\alpha$（单位为 $\\mathrm{DN/e^-}$）。该关系式为 $D = \\alpha T$。问题指明偏置偏移已被移除。\n\n我们的目标是找到数字量化值均值 $\\mathbb{E}[D]$ 与数字量化值方差 $\\mathrm{Var}(D)$ 之间的关系。\n\n首先，我们推导平均数字量化值的表达式，记为 $\\mu_D$：\n$\\mu_D = \\mathbb{E}[D] = \\mathbb{E}[\\alpha T] = \\alpha \\mathbb{E}[T]$\n利用期望的线性性质和 $T$ 的定义：\n$\\mathbb{E}[T] = \\mathbb{E}[E + R] = \\mathbb{E}[E] + \\mathbb{E}[R]$\n代入给定的 $E$ 和 $R$ 的均值：\n$\\mathbb{E}[T] = \\mu_E + 0 = \\mu_E$\n因此，平均数字量化值与平均光电子数成正比：\n$$\n\\mu_D = \\alpha \\mu_E\n$$\n\n接下来，我们推导数字量化值方差的表达式，记为 $\\sigma_D^2$：\n$\\sigma_D^2 = \\mathrm{Var}(D) = \\mathrm{Var}(\\alpha T)$\n利用方差的性质 $\\mathrm{Var}(cX) = c^2 \\mathrm{Var}(X)$：\n$\\sigma_D^2 = \\alpha^2 \\mathrm{Var}(T)$\n由于 $E$ 和 $R$ 被声明为独立随机变量，它们的和的方差等于它们各自方差的和：\n$\\mathrm{Var}(T) = \\mathrm{Var}(E + R) = \\mathrm{Var}(E) + \\mathrm{Var}(R)$\n代入已知的 $E$ 和 $R$ 的方差：\n$\\mathrm{Var}(T) = \\mu_E + \\sigma_r^2$\n因此，数字量化值的方差为：\n$$\n\\sigma_D^2 = \\alpha^2 (\\mu_E + \\sigma_r^2) = \\alpha^2 \\mu_E + \\alpha^2 \\sigma_r^2\n$$\n\n现在，我们必须建立一个连接可观测量 $\\mu_D$ 和 $\\sigma_D^2$ 的关系。我们可以利用均值的表达式来消去不可观测的变量 $\\mu_E$。由 $\\mu_D = \\alpha \\mu_E$ 可得 $\\mu_E = \\mu_D / \\alpha$。将此代入方差方程：\n$$\n\\sigma_D^2 = \\alpha^2 \\left(\\frac{\\mu_D}{\\alpha}\\right) + \\alpha^2 \\sigma_r^2\n$$\n这可以简化为最终的线性关系：\n$$\n\\sigma_D^2 = \\alpha \\mu_D + \\alpha^2 \\sigma_r^2\n$$\n这个方程的形式为 $y = mx + c$，其中：\n-   因变量 $y$ 是数字量化值的方差 $\\sigma_D^2$。\n-   自变量 $x$ 是数字量化值的均值 $\\mu_D$。\n-   直线的斜率 $m$ 是系统增益 $\\alpha$。\n-   直线的 y 轴截距 $c$ 是 $\\alpha^2 \\sigma_r^2$ 项。\n\n问题提供了多组测量的平均 DN 值（$\\mu_D$）及其对应的直方图宽度，即标准差（$\\sigma_D$）。要使用推导出的线性模型，我们必须首先将标准差平方以获得方差（$\\sigma_D^2$）。然后，可以对 $(\\mu_D, \\sigma_D^2)$ 数据点执行线性回归（最小二乘拟合），以估计斜率 $m$ 和 y 轴截距 $c$。\n\n一旦确定了拟合参数 $m$ 和 $c$，就可以如下计算物理传感器参数 $\\alpha$ 和 $\\sigma_r$：\n1.  增益 $\\alpha$ 等于拟合直线的斜率：\n    $$\n    \\alpha = m\n    $$\n2.  读出噪声 $\\sigma_r$ 由 y 轴截距确定。我们有 $c = \\alpha^2 \\sigma_r^2$。代入 $\\alpha=m$，得到 $c = m^2 \\sigma_r^2$。求解 $\\sigma_r$：\n    $$\n    \\sigma_r^2 = \\frac{c}{m^2} \\implies \\sigma_r = \\frac{\\sqrt{c}}{m}\n    $$\n    物理约束要求方差 $c$ 必须为非负，增益 $m$ 必须为正。在实践中，测量噪声可能导致拟合得到一个小的负截距；在这种情况下，具有物理意义的解释是读出噪声为零或低于测量阈值，因此我们应将任何负的 $c$ 视为 0。\n\n因此，算法如下：\n1.  对于每个测试用例，取平均 DN 和标准差的输入数组。\n2.  通过将每个标准差平方，创建一个对应的 DN 方差数组。\n3.  对 DN 方差与 DN 均值进行线性最小二乘拟合，以获得斜率 $m$ 和 y 轴截距 $c$。\n4.  计算增益 $\\alpha = m$。\n5.  计算读出噪声 $\\sigma_r = \\sqrt{\\max(0, c)} / m$。\n6.  将 $\\alpha$ 和 $\\sigma_r$ 都四舍五入到六位小数，并按规定格式化输出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the sensor characterization problem for all test cases.\n    The method is based on the Photon Transfer Curve (PTC) analysis,\n    where a linear relationship between signal variance and signal mean is exploited.\n    The derived relationship is Var(DN) = alpha * Mean(DN) + (alpha * sigma_r)^2.\n    A linear fit of Var(DN) vs. Mean(DN) yields a slope `m` and intercept `c`.\n    The physical parameters are then:\n    - Gain (alpha) = m\n    - Read Noise (sigma_r) = sqrt(c) / m\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general happy path, mid to high radiance)\n        (\n            np.array([475, 1425, 2850, 5700, 8550, 11400], dtype=float),\n            np.array([21.536, 36.958, 52.153, 73.671, 90.196, 104.136], dtype=float),\n        ),\n        # Case 2 (low-light regime, read noise dominated boundary)\n        (\n            np.array([0, 47.5, 95, 190], dtype=float),\n            np.array([3.515, 7.585, 10.130, 13.889], dtype=float),\n        ),\n        # Case 3 (presence of a mild outlier in one exposure)\n        (\n            np.array([600, 1800, 3600, 7200, 10800], dtype=float),\n            np.array([27.495, 46.872, 66.0, 102.442, 114.0], dtype=float),\n        ),\n        # Case 4 (different sensor gain and read noise, moderate radiance range)\n        (\n            np.array([350, 1400, 2800, 4900], dtype=float),\n            np.array([15.716, 31.352, 44.333, 58.600], dtype=float),\n        ),\n    ]\n\n    results = []\n    for mean_dn, std_dev_dn in test_cases:\n        # The independent variable x is the mean DN\n        x = mean_dn\n        \n        # The dependent variable y is the variance of the DN, which is the square of the histogram width (std dev)\n        y = np.square(std_dev_dn)\n        \n        # Perform a linear least-squares fit (polynomial of degree 1)\n        # This returns the slope (m) and y-intercept (c) of the fitted line y = mx + c\n        m, c = np.polyfit(x, y, 1)\n        \n        # From the derived model, the gain alpha is the slope of the line\n        alpha = m\n        \n        # The read noise sigma_r is derived from the intercept c = (alpha * sigma_r)^2\n        # So, sigma_r = sqrt(c) / alpha.\n        # Intercept c must be non-negative for a physical interpretation.\n        # Fit errors on noisy data can result in a small negative intercept.\n        # In such a case, the physically meaningful interpretation is a read noise of zero.\n        if alpha > 0:\n            sigma_r = np.sqrt(max(0, c)) / alpha\n        else:\n            # A non-positive gain is physically unrealistic. In this unlikely event, read noise is undefined.\n            # Handle this gracefully, e.g., by setting it to 0 or NaN.\n            # For this problem's context, with valid data, alpha should be positive.\n            sigma_r = 0.0\n\n        # Round the results to six decimal places as required\n        alpha_rounded = round(alpha, 6)\n        sigma_r_rounded = round(sigma_r, 6)\n        \n        results.append([alpha_rounded, sigma_r_rounded])\n\n    # Format the final output string to exactly match the required format: [[a,b],[c,d],...]\n    case_strings = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_output = f\"[{','.join(case_strings)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "原始的数字信号(DN)值是依赖于具体设备的，为了进行定量分析，必须将其转换为标准化的物理单位。本练习聚焦于辐射定标，即将DN值转换为大气层顶(TOA)反射率的过程。这是比较不同传感器或不同时间获取的数据的关键步骤，也构成了几乎所有定量遥感应用的基础。",
            "id": "3806065",
            "problem": "一个被动式多光谱卫星传感器在太阳天顶角 $\\theta_s = 30^{\\circ}$ 时，获取了一块均质农田上空的一小部分像素，平台报告了三个光谱波段的原始数字量化值（DN）：波段1（蓝色）、波段2（绿色）和波段3（近红外）。每个波段 $b$ 的辐射定标是线性的，其特征为增益 $\\alpha_b$ 和偏移量 $\\beta_b$，以及特定波段的大气外太阳辐照度 $E_{0,\\lambda_b}$。为计算大气层顶（TOA）反射率，假设大气影响可忽略不计，且所有波段的偏移量均为零，即 $\\beta_b = 0$。参数如下：\n- 波段1（蓝色）：$\\alpha_1 = 1.2$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{每 DN}\\right)$, $E_{0,\\lambda_1} = 1900$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n- 波段2（绿色）：$\\alpha_2 = 1.0$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{每 DN}\\right)$, $E_{0,\\lambda_2} = 1850$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n- 波段3（近红外）：$\\alpha_3 = 0.8$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mathrm{sr}^{-1}\\,\\mu \\mathrm{m}^{-1}\\,\\text{每 DN}\\right)$, $E_{0,\\lambda_3} = 1600$ $\\left(\\mathrm{W}\\,\\mathrm{m}^{-2}\\,\\mu \\mathrm{m}^{-1}\\right)$。\n\n对于每个波段，传感器在10个空间像素上记录了以下原始DN值：\n- 波段1：$\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$。\n- 波段2：$\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$。\n- 波段3：$\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$。\n\n从辐亮度、线性辐射定标和TOA反射率的定义出发，推导将DN映射到TOA反射率 $\\rho_{\\lambda_b}$ 的表达式，并计算每个波段中每个像素的反射率。为每个波段构建两个3个分箱的直方图：\n- 使用DN分箱 $[0, 80)$、$[80, 120)$、$[120, \\infty)$ 构建定标前的DN直方图。\n- 使用反射率分箱 $[0, 0.15)$、$[0.15, 0.30)$、$[0.30, \\infty)$ 构建定标后的反射率直方图。\n\n将每个直方图归一化为这3个分箱上的离散概率质量函数。对于每个波段 $b$，使用 $D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) = \\sum_{i=1}^{3} p^{(b)}_i \\,\\ln\\!\\left(\\frac{p^{(b)}_i}{q^{(b)}_i}\\right)$ 计算从定标前分布 $p^{(b)}$ 到定标后分布 $q^{(b)}$ 的Kullback–Leibler散度（KLD），约定当 $p^{(b)}_i = 0$ 时，该项贡献为0。最后，报告定义为总和 $\\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right)$ 的多波段直方图散度度量。将最终答案四舍五入到四位有效数字。将最终度量表示为无量纲的小数。",
            "solution": "该问题经评估具有科学依据、提法恰当、客观且自洽。提供了所有必要的数据、定义和约束条件，并且它们与遥感和信息论的既定原则相符。因此，该问题被认为是**有效的**，下面是完整的解题过程。\n\n分析过程分五个连续步骤进行：\n1.  从数字量化值（DN）推导大气层顶（TOA）反射率的公式。\n2.  计算所有三个光谱波段中每个像素的反射率值。\n3.  为DN值（定标前）和反射率值（定标后）构建归一化直方图（概率质量函数，PMF）。\n4.  计算每个波段的Kullback–Leibler散度（KLD）。\n5.  对KLD值求和，以获得最终的多波段直方图散度度量。\n\n**步骤1：从DN推导TOA反射率**\n波段 $b$ 的传感器入瞳光谱辐亮度 $L_{\\lambda_b}$ 由以下线性辐射定标方程给出：\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b + \\beta_b$$\n其中 $\\alpha_b$ 是增益，$\\beta_b$ 是偏移量，$\\text{DN}_b$ 是数字量化值。题目说明偏移量为零，即 $\\beta_b = 0$。因此，方程简化为：\n$$L_{\\lambda_b} = \\alpha_b \\cdot \\text{DN}_b$$\n\n假设地表为朗伯体且大气影响可忽略不计，TOA反射率 $\\rho_{\\lambda_b}$ 将测得的上行辐亮度 $L_{\\lambda_b}$ 与入射太阳辐照度关联起来。大气层顶水平面上的太阳辐照度由 $E_{0,\\lambda_b} \\cos(\\theta_s)$ 给出，其中 $E_{0,\\lambda_b}$ 是特定波段的平均大气外太阳辐照度，$\\theta_s$ 是太阳天顶角。从理想朗伯体表面反射的辐亮度在所有方向上均匀分布，其关系式为：\n$$L_{\\lambda_b} = \\frac{\\rho_{\\lambda_b} E_{0,\\lambda_b} \\cos(\\theta_s)}{\\pi}$$\n求解 $\\rho_{\\lambda_b}$ 可得：\n$$\\rho_{\\lambda_b} = \\frac{\\pi L_{\\lambda_b}}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n将 $L_{\\lambda_b}$ 用 $\\text{DN}_b$ 的表达式代入：\n$$\\rho_{\\lambda_b} = \\frac{\\pi \\alpha_b \\text{DN}_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n该表达式可通过定义一个特定波段的转换因子 $C_b$ 来简化：\n$$C_b = \\frac{\\pi \\alpha_b}{E_{0,\\lambda_b} \\cos(\\theta_s)}$$\n使得 $\\rho_{\\lambda_b} = C_b \\cdot \\text{DN}_b$。\n\n**步骤2：计算转换因子和反射率**\n已知太阳天顶角 $\\theta_s = 30^{\\circ}$，我们有 $\\cos(30^{\\circ}) = \\frac{\\sqrt{3}}{2}$。现在我们可以计算每个波段的转换因子 $C_b$。\n对于波段1：$C_1 = \\frac{\\pi(1.2)}{1900 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0022911$\n对于波段2：$C_2 = \\frac{\\pi(1.0)}{1850 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0019609$\n对于波段3：$C_3 = \\frac{\\pi(0.8)}{1600 \\cdot \\frac{\\sqrt{3}}{2}} \\approx 0.0018138$\n\n使用这些因子，我们将每个像素的DN值转换为反射率值。\n- **波段1反射率 ($\\rho_1$)：**\n  DN值：$\\{50, 55, 60, 65, 70, 80, 90, 100, 120, 150\\}$\n  反射率：$\\{0.1146, 0.1260, 0.1375, 0.1489, 0.1604, 0.1833, 0.2062, 0.2291, 0.2749, 0.3437\\}$\n- **波段2反射率 ($\\rho_2$)：**\n  DN值：$\\{60, 65, 75, 85, 90, 95, 110, 130, 160, 180\\}$\n  反射率：$\\{0.1177, 0.1275, 0.1471, 0.1667, 0.1765, 0.1863, 0.2157, 0.2549, 0.3137, 0.3530\\}$\n- **波段3反射率 ($\\rho_3$)：**\n  DN值：$\\{110, 120, 130, 140, 150, 170, 190, 210, 230, 250\\}$\n  反射率：$\\{0.1995, 0.2177, 0.2358, 0.2539, 0.2721, 0.3083, 0.3446, 0.3809, 0.4171, 0.4534\\}$\n\n**步骤3：构建归一化直方图（PMF）**\n我们使用指定的分箱为每个波段的DN和反射率构建直方图，并通过像素总数（$N=10$）进行归一化，以获得PMF $p^{(b)}$（定标前）和 $q^{(b)}$（定标后）。\n\n- **波段1：**\n  - DN分箱：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{5, 3, 2\\}$\n    PMF $p^{(1)} = \\{0.5, 0.3, 0.2\\}$\n  - 反射率分箱：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{4, 5, 1\\}$\n    PMF $q^{(1)} = \\{0.4, 0.5, 0.1\\}$\n\n- **波段2：**\n  - DN分箱：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{3, 4, 3\\}$\n    PMF $p^{(2)} = \\{0.3, 0.4, 0.3\\}$\n  - 反射率分箱：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{3, 5, 2\\}$\n    PMF $q^{(2)} = \\{0.3, 0.5, 0.2\\}$\n\n- **波段3：**\n  - DN分箱：$[0, 80)$, $[80, 120)$, $[120, \\infty)$\n    计数：$\\{0, 1, 9\\}$\n    PMF $p^{(3)} = \\{0.0, 0.1, 0.9\\}$\n  - 反射率分箱：$[0, 0.15)$, $[0.15, 0.30)$, $[0.30, \\infty)$\n    计数：$\\{0, 5, 5\\}$\n    PMF $q^{(3)} = \\{0.0, 0.5, 0.5\\}$\n\n**步骤4：计算Kullback–Leibler散度（KLD）**\n从分布 $p$ 到 $q$ 的KLD由 $D_{\\mathrm{KL}}\\!\\left(p \\parallel q\\right) = \\sum_{i} p_i \\,\\ln\\!\\left(\\frac{p_i}{q_i}\\right)$ 给出。我们将其应用于每个波段。\n\n- **波段1：**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = p^{(1)}_1 \\ln\\left(\\frac{p^{(1)}_1}{q^{(1)}_1}\\right) + p^{(1)}_2 \\ln\\left(\\frac{p^{(1)}_2}{q^{(1)}_2}\\right) + p^{(1)}_3 \\ln\\left(\\frac{p^{(1)}_3}{q^{(1)}_3}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln\\left(\\frac{0.5}{0.4}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.5}\\right) + 0.2 \\ln\\left(\\frac{0.2}{0.1}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) = 0.5 \\ln(1.25) + 0.3 \\ln(0.6) + 0.2 \\ln(2)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(1)} \\parallel q^{(1)}\\right) \\approx 0.5(0.22314) + 0.3(-0.51083) + 0.2(0.69315) \\approx 0.11157 - 0.15325 + 0.13863 \\approx 0.09695$\n\n- **波段2：**\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln\\left(\\frac{0.3}{0.3}\\right) + 0.4 \\ln\\left(\\frac{0.4}{0.5}\\right) + 0.3 \\ln\\left(\\frac{0.3}{0.2}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) = 0.3 \\ln(1) + 0.4 \\ln(0.8) + 0.3 \\ln(1.5)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(2)} \\parallel q^{(2)}\\right) \\approx 0 + 0.4(-0.22314) + 0.3(0.40547) \\approx -0.08926 + 0.12164 \\approx 0.03238$\n\n- **波段3：**\n  第一个分箱的 $p^{(3)}_1 = 0$ 且 $q^{(3)}_1 = 0$。根据所述约定，当 $p^{(b)}_i = 0$ 时，该项对总和的贡献为0。\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0 + 0.1 \\ln\\left(\\frac{0.1}{0.5}\\right) + 0.9 \\ln\\left(\\frac{0.9}{0.5}\\right)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) = 0.1 \\ln(0.2) + 0.9 \\ln(1.8)$\n  $D_{\\mathrm{KL}}\\!\\left(p^{(3)} \\parallel q^{(3)}\\right) \\approx 0.1(-1.60944) + 0.9(0.58779) \\approx -0.16094 + 0.52901 \\approx 0.36807$\n\n**步骤5：求和与最终答案**\n多波段直方图散度度量是各个KLD值的总和。\n$$ \\sum_{b=1}^{3} D_{\\mathrm{KL}}\\!\\left(p^{(b)} \\parallel q^{(b)}\\right) \\approx 0.09695 + 0.03238 + 0.36807 \\approx 0.49740 $$\n将最终答案四舍五入到四位有效数字，得到 $0.4974$。",
            "answer": "$$\n\\boxed{0.4974}\n$$"
        },
        {
            "introduction": "在将DN值转换为物理量之后，我们常常需要确保在同一区域拍摄的不同图像之间具有一致性。本练习介绍了一种相对辐射归一化技术，该技术利用直方图统计数据来对齐目标图像与参考图像的辐射特性。通过本练习，您将了解为何使用中位数（一种稳健的统计量）能够在图像包含云或饱和像素等异常值时，依然获得稳定的归一化结果。",
            "id": "3806073",
            "problem": "一部具有$12$比特量化的被动式光学卫星传感器的单个光谱波段记录了覆盖同一地表镶嵌体的两幅已配准图像的数字量化值(DN)：一幅是待归一化的目标图像，另一幅是定义辐射基准的参考图像。目标图像的直方图在以下DN支持集$\\{d_i\\}$上测得，其计数为$\\{h_T(d_i)\\}$：\n- $d_i \\in \\{0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1200, 1400, 1600, 1800, 2000, 2200, 2400, 2600, 2800, 3000, 3200, 3400, 3600, 3800, 4095\\}$，\n- $h_T(d_i) \\in \\{50, 200, 500, 800, 1200, 2000, 4000, 6000, 8000, 9000, 9500, 8000, 6000, 4000, 2500, 1500, 900, 600, 400, 300, 250, 150, 100, 80, 60, 30\\}$，顺序相同。\n\n参考图像在相同的DN支持集上测得的直方图，其计数为$\\{h_R(d_i)\\}$：\n- $h_R(d_i) \\in \\{100, 400, 800, 1200, 2200, 3000, 5000, 7000, 9000, 10000, 9500, 7000, 5000, 3000, 1800, 1100, 700, 500, 300, 250, 200, 120, 90, 70, 50, 20\\}$，顺序相同。\n\n假设传感器在动态范围内具有线性响应，目标图像和参考图像分别具有固定的黑电平偏移量$b_T$和$b_R$，并且将一个未知的乘性增益$a$应用于目标图像以实现辐射归一化。设偏移量为$b_T = 64$和$b_R = 60$，单位为DN。在没有显著大气路径辐射差异的单调光照变化条件下，一种稳健的归一化方法通过以下公式对齐以中位数居中的DN值：\n$$y = a\\,(x - b_T) + b_R,$$\n其中$x$是目标DN值，$y$是归一化后的DN值，期望其在统计上与参考DN值一致。\n\n使用经验累积分布函数(CDF)的定义$F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$，其中直方图的总计数为$N = \\sum_i h(d_i)$，计算：\n1. 计算目标图像在给定DN支持集上的经验CDF $F_T(d)$，并确定中位数DN值$m_T$，其中$m_T$是满足$F_T(d) \\geq 0.5$的最小$d$值。\n2. 使用相同定义计算参考图像的中位数DN值$m_R$。\n3. 使用以下公式计算在给定偏移量下对齐中位数的稳健增益$a$：\n$$a = \\frac{m_R - b_R}{m_T - b_T}.$$\n\n解释为什么在存在高DN值的饱和明亮异常值时，中位数比均值更可取，并最终给出$a$的数值。\n\n将你计算的$a$的最终答案四舍五入到四位有效数字。最终答案以无单位的无量纲标量形式表示。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、提法恰当且信息完整。\n\n### 步骤1：问题验证\n给定的信息如下：\n- 一个具有$12$比特量化（$0$到$4095$ DN范围）的传感器。\n- 目标图像直方图：DN支持集$\\{d_i\\}$和计数$\\{h_T(d_i)\\}$。\n- 参考图像直方图：相同的DN支持集$\\{d_i\\}$和计数$\\{h_R(d_i)\\}$。\n- 目标图像黑电平偏移量：$b_T = 64$。\n- 参考图像黑电平偏移量：$b_R = 60$。\n- 线性归一化模型：$y = a\\,(x - b_T) + b_R$。\n- 经验CDF定义：$F(d) = \\frac{1}{N}\\sum_{d_i \\leq d} h(d_i)$，其中$N = \\sum_i h(d_i)$。\n- 中位数定义：满足$F(d) \\geq 0.5$的最小$d$值。\n- 增益计算公式：$a = \\frac{m_R - b_R}{m_T - b_T}$。\n\n该问题具有科学合理性，因为它描述了遥感中相对辐射归一化的一种标准方法。计算所需的所有数据和定义都已提供，使得问题提法恰当且自成体系。所作的假设（线性传感器响应、单调光照变化）是简化此类问题的典型假设。不存在矛盾或含糊之处。该问题被认为是有效的。\n\n### 步骤2：求解推导\n\n求解过程需要进行三部分计算，然后进行概念性解释。\n\n**1. 计算目标图像中位数 ($m_T$)**\n\n首先，我们必须通过对直方图计数$h_T(d_i)$求和来计算目标图像的总像素数$N_T$：\n$N_T = \\sum_i h_T(d_i)$\n$N_T = 50 + 200 + 500 + 800 + 1200 + 2000 + 4000 + 6000 + 8000 + 9000 + 9500 + 8000 + 6000 + 4000 + 2500 + 1500 + 900 + 600 + 400 + 300 + 250 + 150 + 100 + 80 + 60 + 30 = 66120$。\n目标图像的总像素数为$N_T = 66120$。\n\n中位数$m_T$是使累积分布函数$F_T(d) \\geq 0.5$成立的最小数字量化值$d$。这等同于找到最小的$d_i$，使其累积计数$H_T(d_i) = \\sum_{j \\le i} h_T(d_j)$大于或等于总像素数的一半，即$N_T/2 = 33060$。\n\n我们计算累积直方图计数$H_T(d_i)$：\n- $H_T(0) = 50$\n- $H_T(100) = 50 + 200 = 250$\n- $H_T(200) = 250 + 500 = 750$\n- $H_T(300) = 750 + 800 = 1550$\n- $H_T(400) = 1550 + 1200 = 2750$\n- $H_T(500) = 2750 + 2000 = 4750$\n- $H_T(600) = 4750 + 4000 = 8750$\n- $H_T(700) = 8750 + 6000 = 14750$\n- $H_T(800) = 14750 + 8000 = 22750$\n- $H_T(900) = 22750 + 9000 = 31750$\n- $H_T(1000) = 31750 + 9500 = 41250$\n\n在$d_i = 900$处的累积计数为$31750$，小于$33060$。在下一个DN支持集值$d_i = 1000$处的累积计数为$41250$，大于或等于$33060$。根据定义，中位数是满足条件的最小$d$值。\n因此，目标图像的中位数为$m_T = 1000$。\n\n**2. 计算参考图像中位数 ($m_R$)**\n\n类似地，我们计算参考图像的总像素数$N_R$：\n$N_R = \\sum_i h_R(d_i)$\n$N_R = 100 + 400 + 800 + 1200 + 2200 + 3000 + 5000 + 7000 + 9000 + 10000 + 9500 + 7000 + 5000 + 3000 + 1800 + 1100 + 700 + 500 + 300 + 250 + 200 + 120 + 90 + 70 + 50 + 20 = 68400$。\n参考图像的总像素数为$N_R = 68400$。\n\n中位数的条件是找到最小的$d_i$，使其累积计数$H_R(d_i)$大于或等于$N_R/2 = 34200$。\n\n我们计算累积直方图计数$H_R(d_i)$：\n- $H_R(0) = 100$\n- $H_R(100) = 100 + 400 = 500$\n- $H_R(200) = 500 + 800 = 1300$\n- $H_R(300) = 1300 + 1200 = 2500$\n- $H_R(400) = 2500 + 2200 = 4700$\n- $H_R(500) = 4700 + 3000 = 7700$\n- $H_R(600) = 7700 + 5000 = 12700$\n- $H_R(700) = 12700 + 7000 = 19700$\n- $H_R(800) = 19700 + 9000 = 28700$\n- $H_R(900) = 28700 + 10000 = 38700$\n\n在$d_i = 800$处的累积计数为$28700$，小于$34200$。在下一个DN支持集值$d_i = 900$处的累积计数为$38700$，超过了$34200$。\n因此，参考图像的中位数为$m_R = 900$。\n\n**3. 计算稳健增益 ($a$)**\n\n增益因子$a$使用提供的公式和计算出的中位数进行计算：\n$$a = \\frac{m_R - b_R}{m_T - b_T}$$\n代入已知值：$m_T = 1000$，$m_R = 900$，$b_T = 64$ 和 $b_R = 60$。\n$$a = \\frac{900 - 60}{1000 - 64} = \\frac{840}{936}$$\n进行除法运算得出：\n$$a \\approx 0.897435897...$$\n四舍五入到四位有效数字，我们得到：\n$$a \\approx 0.8974$$\n\n**4. 中位数与均值的对比解释**\n\n对于辐射归一化这类任务，特别是在存在异常值的情况下，中位数比均值更可取，这与其作为集中趋势统计量度的稳健性有关。\n\n数据集的均值是所有值的总和除以值的数量。它对每个数据点的大小都高度敏感。异常值（即与数据其余部分相比异常高或低的值）会对均值产生不成比例的影响。在卫星影像中，“饱和的明亮异常值”指的是记录了可能的最大数字量化值（例如，对于一个$12$比特传感器是$4095$）的像素，这是因为入射辐射超出了传感器的感应能力。这些饱和值不是地表辐射的真实度量，而是传感器限制所造成的假象。少量此类像素（例如来自云或镜面反射的像素）可以显著提高图像计算出的平均亮度，使其成为一个不能代表场景主体部分的统计量。\n\n相比之下，中位数是将数据样本较高的一半与较低的一半分开的值。其值取决于数据的排序，而不是极端值的具体大小。如果图像中的最高DN值被人为地加倍，均值会增加，但中位数将保持不变。因为中位数不受极端值的影响而产生偏斜，所以它被认为是一个稳健的统计量。\n\n在对齐两幅图像的背景下，使用均值会导致归一化因任一图像中存在的饱和像素而产生偏差。这可能导致不正确的增益因子，无法很好地匹配大多数非饱和像素的辐射特性。通过使用中位数，归一化基于数据主体的集中趋势，忽略了分布尾部异常值的偏倚效应。这会使图像的对齐更稳定、更可靠（即“稳健”）。",
            "answer": "$$\\boxed{0.8974}$$"
        }
    ]
}