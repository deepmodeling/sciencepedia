{
    "hands_on_practices": [
        {
            "introduction": "本练习将带您深入建筑区域能量平衡的第一性原理。这是理解建筑温度如何响应内部负荷、外部条件和暖通空调系统运行的基石。通过计算稳态温度和动态时间常数，您将掌握决定热力性能和控制的核心概念 ()。",
            "id": "4118294",
            "problem": "一个单区域充分混合模型被用于一个机械制冷的开放式办公室。地板面积为 $200$ m$^2$，与室外的热导率为 $U A = 150$ W/K。该区域由暖通空调（HVAC）系统供风，空气质量流量为 $\\dot{m}_{sa} = 0.6$ kg/s，送风温度恒定为 $T_{sa} = 16^\\circ$C。室外空气温度为 $T_{o} = 30^\\circ$C。内部热增益恒定为 $Q_{int} = 3$ kW，太阳能增益初始恒定为 $Q_{sol} = 2$ kW。区域空气和轻质物体的有效热容为 $C_{z} = 300$ kJ/K。假设空气的定压比热为 $c_{p} = 1005$ J/(kg K)。忽略空气渗透和湿度的影响。考虑一个充分混合区域空气节点的标准第一性原理能量平衡。\n\n- 首先，从基本原理出发，推导并计算在给定恒定输入下区域空气的稳态温度 $T_{z,ss}$。\n- 接着，假设在时间 $t=0$ 时，太阳能增益 $Q_{sol}$ 发生阶跃变化到一个新的恒定值。使用相同的第一性原理模型，确定控制区域空气温度对此阶跃响应的一阶瞬态响应的时间常数 $\\tau$。\n\n将您的答案四舍五入到四位有效数字。将 $T_{z,ss}$ 以摄氏度表示，$\\tau$ 以分钟表示。最终答案必须以单行两个值的形式报告。",
            "solution": "该问题被认为是有效的，因为它科学地基于热力学和传热原理，问题设定良好，有足够的信息得到唯一解，并以客观、正式的语言表达。我们可以开始求解。\n\n第一步是为这个单区域充分混合模型建立控制性的第一性原理能量平衡。区域热容内能的变化率等于所有热增益之和减去所有热损失之和。区域的热能由 $C_z T_z$ 给出。其变化率为 $C_z \\frac{dT_z}{dt}$。\n\n该区域的热增益和热损失包括：\n1.  恒定的内部热增益，$Q_{int}$。\n2.  太阳能热增益，$Q_{sol}$。\n3.  通过建筑围护结构（热导率 $UA$）与室外（温度为 $T_o$）的热传递。如果 $T_o > T_z$ 则为热增益，如果 $T_z > T_o$ 则为热损失。热流率为 $UA (T_o - T_z)$。\n4.  来自暖通空调系统的净热传递，该系统以质量流量 $\\dot{m}_{sa}$ 和温度 $T_{sa}$ 供应空气。由于区域是充分混合的，离开区域的空气温度为区域温度 $T_z$。平流进入区域的净能量率为 $\\dot{m}_{sa} c_p (T_{sa} - T_z)$。\n\n结合这些项，得到控制区域空气温度 $T_z$ 的常微分方程（ODE）：\n$$\nC_z \\frac{dT_z}{dt} = Q_{int} + Q_{sol} + UA (T_o - T_z) + \\dot{m}_{sa} c_p (T_{sa} - T_z)\n$$\n这个方程是问题两个部分的基础。\n\n首先，我们将求出区域空气的稳态温度 $T_{z,ss}$。在稳态下，区域的温度是恒定的，这意味着时间导数为零：$\\frac{dT_z}{dt} = 0$。将常微分方程的左侧设为零，我们得到：\n$$\n0 = Q_{int} + Q_{sol} + UA (T_o - T_{z,ss}) + \\dot{m}_{sa} c_p (T_{sa} - T_{z,ss})\n$$\n现在我们可以通过重新排列各项来求解 $T_{z,ss}$。首先，展开包含 $T_{z,ss}$ 的项：\n$$\n0 = Q_{int} + Q_{sol} + UA T_o - UA T_{z,ss} + \\dot{m}_{sa} c_p T_{sa} - \\dot{m}_{sa} c_p T_{z,ss}\n$$\n将所有包含 $T_{z,ss}$ 的项收集到一边：\n$$\nUA T_{z,ss} + \\dot{m}_{sa} c_p T_{z,ss} = Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}\n$$\n提取公因式 $T_{z,ss}$：\n$$\nT_{z,ss} (UA + \\dot{m}_{sa} c_p) = Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}\n$$\n最后，稳态温度的表达式是：\n$$\nT_{z,ss} = \\frac{Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}}{UA + \\dot{m}_{sa} c_p}\n$$\n现在，我们代入给定的数值。所有温度都可以用摄氏度表示，因为方程结构是一个加权平均，使得选择摄氏温标或开尔文温标对结果是等效的。我们必须确保所有其他单位是一致的（国际单位制：W, J, s, kg, K）。\n\n给定值：\n$Q_{int} = 3 \\text{ kW} = 3000 \\text{ W}$\n$Q_{sol} = 2 \\text{ kW} = 2000 \\text{ W}$\n$UA = 150 \\text{ W/K}$\n$T_o = 30^\\circ\\text{C}$\n$\\dot{m}_{sa} = 0.6 \\text{ kg/s}$\n$c_p = 1005 \\text{ J/(kg K)}$\n$T_{sa} = 16^\\circ\\text{C}$\n\n首先，计算平流传热系数：\n$\\dot{m}_{sa} c_p = 0.6 \\text{ kg/s} \\times 1005 \\text{ J/(kg K)} = 603 \\text{ W/K}$\n\n现在，将所有值代入 $T_{z,ss}$ 的表达式中：\n$$\nT_{z,ss} = \\frac{3000 + 2000 + (150 \\times 30) + (603 \\times 16)}{150 + 603}\n$$\n$$\nT_{z,ss} = \\frac{5000 + 4500 + 9648}{753} = \\frac{19148}{753} \\approx 25.42895... \\text{ }^\\circ\\text{C}\n$$\n四舍五入到四位有效数字，稳态温度为 $T_{z,ss} = 25.43^\\circ\\text{C}$。\n\n接下来，我们确定系统的时间常数 $\\tau$。时间常数描述了一阶系统对其输入变化的响应速率。为了找到它，我们将原始的常微分方程重排成一阶线性系统的标准形式：$\\tau \\frac{dy}{dt} + y = K \\cdot f(t)$。\n\n从完整的常微分方程开始：\n$$\nC_z \\frac{dT_z}{dt} = Q_{int} + Q_{sol} + UA T_o - UA T_z + \\dot{m}_{sa} c_p T_{sa} - \\dot{m}_{sa} c_p T_z\n$$\n将所有包含状态变量 $T_z$ 的项组合到左侧：\n$$\nC_z \\frac{dT_z}{dt} + UA T_z + \\dot{m}_{sa} c_p T_z = Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}\n$$\n提取公因式 $T_z$：\n$$\nC_z \\frac{dT_z}{dt} + (UA + \\dot{m}_{sa} c_p) T_z = Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}\n$$\n为了匹配标准形式 $\\tau \\frac{dT_z}{dt} + T_z = ...$，我们将整个方程除以 $T_z$ 的系数，即 $(UA + \\dot{m}_{sa} c_p)$：\n$$\n\\frac{C_z}{UA + \\dot{m}_{sa} c_p} \\frac{dT_z}{dt} + T_z = \\frac{Q_{int} + Q_{sol} + UA T_o + \\dot{m}_{sa} c_p T_{sa}}{UA + \\dot{m}_{sa} c_p}\n$$\n通过将此方程与标准形式进行比较，我们可以确定时间常数 $\\tau$ 是导数项的系数：\n$$\n\\tau = \\frac{C_z}{UA + \\dot{m}_{sa} c_p}\n$$\n注意，时间常数仅取决于系统的固有属性（热容 $C_z$ 和热损失系数 $UA$ 及 $\\dot{m}_{sa} c_p$），并且与外部强迫函数（如热增益和温度）无关。\n\n我们代入给定的数值，确保单位一致：\n$C_z = 300 \\text{ kJ/K} = 300 \\times 10^3 \\text{ J/K} = 300000 \\text{ J/K}$\n$UA + \\dot{m}_{sa} c_p = 150 \\text{ W/K} + 603 \\text{ W/K} = 753 \\text{ W/K} = 753 \\text{ J/(s K)}$\n\n现在，我们计算 $\\tau$：\n$$\n\\tau = \\frac{300000 \\text{ J/K}}{753 \\text{ J/(s K)}} \\approx 398.40637... \\text{ s}\n$$\n问题要求时间常数以分钟为单位。我们通过除以 $60$ 将秒转换为分钟：\n$$\n\\tau_{\\text{min}} = \\frac{398.40637...}{60} \\approx 6.640106... \\text{ min}\n$$\n四舍五入到四位有效数字，时间常数为 $\\tau = 6.640$ 分钟。\n\n两个所需的值是 $T_{z,ss} = 25.43^\\circ\\text{C}$ 和 $\\tau = 6.640 \\text{ min}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 25.43 & 6.640 \\end{pmatrix}}$$"
        },
        {
            "introduction": "建筑能耗模型不仅仅局限于供暖和制冷。本练习侧重于照明——商业建筑中的一个主要能源消耗者——及其通过自然采光与建筑设计的相互作用。您将实践计算现代控制系统带来的节能效果，展示如何将集成被动式设计策略与主动控制相结合，从而显著降低电力消耗 ()。",
            "id": "4118283",
            "problem": "一个楼面面积为 $A = 1{,}000\\,\\text{m}^{2}$ 的开放式办公室，其安装的照明功率密度 (LPD) 为 $8\\,\\text{W}/\\text{m}^{2}$。目标工作面照度设定值为 $E_{\\text{set}} = 500\\,\\text{lx}$，通过闭环日光响应调光系统来维持。该控制系统经过校准，在没有日光的情况下，全功率输出 ($f=1$) 的人工照明在工作面上提供 $E_{\\text{set}}$ 的照度。调光控制分数 $f \\in [0,1]$ 的定义是：所提供的人工照明照度与 $f$ 成正比，人工照明功率为安装功率的 $f$ 倍。\n\n在某一小时，空间内的平均采光系数 (DF) 为 $3\\%$，测得的室外水平照度为 $E_{\\text{ext}} = 50{,}000\\,\\text{lx}$。假设室内水平日光照度等于采光系数（以小数形式表示）与室外水平照度的乘积，并且人工照明照度与日光照度在工作面上线性相加。忽略遮阳、空间不均匀性和任何最小调光限制。\n\n根据这些假设以及照度和采光系数的基本定义，计算：\n- 为维持 $500\\,\\text{lx}$ 设定值所需的调光分数 $f$，以及\n- 在此一小时内消耗的相应照明能量，以 $\\text{kWh}$ 为单位表示。\n\n将您的最终数值结果四舍五入至四位有效数字。能量以 $\\text{kWh}$ 为单位表示。",
            "solution": "用户希望我验证问题，如果问题有效，则提供解决方案。\n\n### 步骤1：提取已知条件\n- 楼面面积: $A = 1,000\\,\\text{m}^{2}$\n- 安装的照明功率密度 (LPD): $8\\,\\text{W}/\\text{m}^{2}$\n- 目标工作面照度设定值: $E_{\\text{set}} = 500\\,\\text{lx}$\n- 控制系统: 闭环日光响应调光。\n- 控制分数范围: $f \\in [0,1]$\n- 校准: 在 $f=1$ 时，人工照明提供 $E_{\\text{set}}$。\n- 人工照明照度模型: 与 $f$ 成正比。\n- 人工照明功率模型: 安装功率的 $f$ 倍。\n- 平均采光系数 (DF): $3\\%$\n- 室外水平照度: $E_{\\text{ext}} = 50,000\\,\\text{lx}$\n- 日光照度模型: 室内日光照度 = DF $\\times$ $E_{\\text{ext}}$ (其中 DF 为小数)。\n- 总照度模型: 人工照明照度与日光照度线性相加。\n- 排除项: 遮阳、空间不均匀性、最小调光限制。\n- 要求输出: 调光分数 $f$，以及一小时内消耗的照明能量（以 $\\text{kWh}$ 为单位）。\n- 四舍五入: 最终数值结果保留四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题很好地基于建筑工程和建筑科学的原理。照度 (lx)、照明功率密度 (LPD)、采光系数 (DF) 和日光响应调光等概念是照明设计和能源建模中的标准和基本概念。照度线性相加和调光器简化线性功率模型的假设在教学或一阶近似问题中是常见且可接受的。\n- **适定性**：该问题是适定的。它提供了所有必要的数据，并充分定义了变量之间的关系，从而可以计算出所要求量（$f$ 和能量）的唯一解。\n- **客观性**：该问题使用精确、客观和定量的语言陈述，没有任何主观性或歧义。\n- **一致性与完整性**：数据在内部是一致且完整的。例如，控制系统在全输出（$f=1$）时的行为定义提供了控制分数与物理量照度之间的必要联系。没有缺少必要信息，也不存在矛盾。所提供的值对于办公环境是物理上现实的。\n\n### 步骤3：结论与行动\n该问题是有效的，因为它科学上合理、适定、客观，并包含一套完整且一致的信息。我将继续进行求解。\n\n### 解题推导\n\n闭环控制系统的基本原理是通过人工照明照度 $E_{\\text{electric}}$ 来补充可用的日光照度 $E_{\\text{daylight}}$，以达到目标设定值 $E_{\\text{set}}$。工作面上的总照度 $E_{\\text{total}}$ 是这两个分量的线性和：\n$$\nE_{\\text{total}} = E_{\\text{electric}} + E_{\\text{daylight}}\n$$\n控制系统的目标是在最小化能耗的同时保持 $E_{\\text{total}} \\ge E_{\\text{set}}$，这在可能的情况下通过设置 $E_{\\text{total}} = E_{\\text{set}}$ 来实现。\n\n首先，我们使用给定的采光系数 $\\text{DF}$ 和室外照度 $E_{\\text{ext}}$ 来计算室内日光照度 $E_{\\text{daylight}}$。采光系数必须表示为无量纲的小数。\n$$\n\\text{DF} = 3\\% = \\frac{3}{100} = 0.03\n$$\n$$\nE_{\\text{ext}} = 50,000\\,\\text{lx}\n$$\n室内日光照度为：\n$$\nE_{\\text{daylight}} = \\text{DF} \\times E_{\\text{ext}} = 0.03 \\times 50,000\\,\\text{lx} = 1,500\\,\\text{lx}\n$$\n接下来，我们确定为达到设定值 $E_{\\text{set}} = 500\\,\\text{lx}$ 所需的人工照明系统贡献 $E_{\\text{electric,req}}$。\n$$\nE_{\\text{electric,req}} = E_{\\text{set}} - E_{\\text{daylight}} = 500\\,\\text{lx} - 1,500\\,\\text{lx} = -1,000\\,\\text{lx}\n$$\n人工照明照度的负需求意味着可用日光（$1,500\\,\\text{lx}$）已经超过了目标设定值（$500\\,\\text{lx}$）。由于人工照明系统只能增加光线，不能产生负照度，因此控制系统会将人工照明输出降至最低可能水平。问题说明忽略最小调光限制，并将控制分数定义为 $f \\in [0,1]$。因此，最小输出对应于调光分数 $f=0$。实际提供的人工照明照度将是 $E_{\\text{electric}} = 0\\,\\text{lx}$。\n\n调光分数 $f$ 是根据人工照明照度与其最大可能值之间的关系计算的。问题陈述，在全功率（$f=1$）时，系统提供设定点照度。因此，最大人工照明照度 $E_{\\text{electric,max}}$ 等于 $E_{\\text{set}}$。\n$$\nE_{\\text{electric,max}} = E_{\\text{set}} = 500\\,\\text{lx}\n$$\n提供的人工照明照度与 $f$ 成正比：\n$$\nE_{\\text{electric}} = f \\times E_{\\text{electric,max}}\n$$\n由于系统必须提供 $E_{\\text{electric}} = 0\\,\\text{lx}$，我们求解 $f$：\n$$\n0\\,\\text{lx} = f \\times 500\\,\\text{lx}\n$$\n这得出 $f=0$。根据保留四位有效数字的舍入说明，这个精确值写作 $0.0000$。\n\n现在，我们计算在一小时内消耗的照明能量。首先，我们根据照明功率密度 (LPD) 和楼面面积 $A$ 计算总安装照明功率 $P_{\\text{installed}}$。\n$$\n\\text{LPD} = 8\\,\\text{W}/\\text{m}^{2}\n$$\n$$\nA = 1,000\\,\\text{m}^{2}\n$$\n$$\nP_{\\text{installed}} = \\text{LPD} \\times A = (8\\,\\text{W}/\\text{m}^{2}) \\times (1,000\\,\\text{m}^{2}) = 8,000\\,\\text{W}\n$$\n为了方便最终以 $\\text{kWh}$ 为单位计算能量，我们将功率转换为千瓦：\n$$\nP_{\\text{installed}} = 8,000\\,\\text{W} = 8\\,\\text{kW}\n$$\n运行功率 $P_{\\text{op}}$ 定义为安装功率乘以调光分数 $f$。\n$$\nP_{\\text{op}}(f) = f \\times P_{\\text{installed}}\n$$\n当 $f=0$ 时，运行功率为：\n$$\nP_{\\text{op}}(0) = 0 \\times 8\\,\\text{kW} = 0\\,\\text{kW}\n$$\n在时间段 $t = 1\\,\\text{h}$ 内消耗的能量 $W$ 是运行功率与时间持续的乘积。\n$$\nW = P_{\\text{op}}(0) \\times t = 0\\,\\text{kW} \\times 1\\,\\text{h} = 0\\,\\text{kWh}\n$$\n将此结果表示为四位有效数字，消耗的能量为 $0.0000\\,\\text{kWh}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.0000 & 0.0000 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "能源建模的最终目标通常是为更好的决策提供信息。这项高级实践将挑战您将建模技能应用于一个现实世界的投资问题：选择最佳的节能改造方案组合。通过构建并求解一个约束优化问题，您将学习如何将物理性能指标转化为净现值（$NPV$）等经济成果，并在成本、节能量和其他约束之间进行权衡，以找到最优解决方案 ()。",
            "id": "4118257",
            "problem": "您需要为一个住宅和商业建筑能源建模问题构建并求解一个二元决策优化模型，该模型从三个改造措施中进行选择，以在资本预算和峰值供暖负荷舒适度约束下最大化净现值 (NPV)。决策变量是针对隔热、窗户和供暖通风与空调 (HVAC) 升级的二元选择。解决方案必须由一个完整且可运行的程序计算得出，并且必须将指定测试套件的结果汇总为单行输出。\n\n从以下基本依据和定义开始：\n- 热力学第一定律意味着能量核算与守恒，这为终端使用能源平衡建模提供了支持。\n- 折现现金流和净现值 (NPV) 由货币时间价值定义。对于一个在 $N$ 年内以恒定实际利率 $r$ 折现的恒定年金 $A$，其现值系数为\n$$\n\\mathrm{PWF}(r,N) \\equiv \\sum_{t=1}^{N} \\frac{1}{(1+r)^t} = \\frac{1 - (1+r)^{-N}}{r}.\n$$\n- 应用多个独立措施后的年度供暖和制冷能耗，采用分数影响的乘法复合效应进行建模。如果基准年度供暖能耗为 $E_{h,0}$，基准年度制冷能耗为 $E_{c,0}$，并且一组选定的措施 $\\mathcal{S}$ 各自带来独立的分数变化 $\\delta_h^{(m)}$ 和 $\\delta_c^{(m)}$（负值表示减少），则\n$$\nE_h(\\mathcal{S}) = E_{h,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_h^{(m)}\\right), \\quad\nE_c(\\mathcal{S}) = E_{c,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_c^{(m)}\\right).\n$$\n- 峰值供暖负荷复合遵循相同的独立乘法方法。如果基准峰值供暖负荷为 $P_{h,0}$，措施 $m$ 对峰值供暖负荷的分数影响为 $\\delta_{P}^{(m)}$，则\n$$\nP_h(\\mathcal{S}) = P_{h,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_{P}^{(m)}\\right).\n$$\n- 年度能源成本是年度能耗与电价的乘积。设电价为 $p$（单位：美元/兆瓦时）。年度基准能源成本为 $p \\left(E_{h,0} + E_{c,0}\\right)$，改造后的年度能源成本为 $p \\left(E_h(\\mathcal{S}) + E_c(\\mathcal{S})\\right)$。年度能源成本节余为 $p \\left(E_{h,0} + E_{c,0} - E_h(\\mathcal{S}) - E_c(\\mathcal{S})\\right)$。\n- 运营与维护 (O&M) 年度成本因每项选定措施而产生固定额度的变化。净等额年现金流是年度能源成本节余减去所选措施的年度 O&M 增量总和。\n\n问题定义：\n- 决策向量 $\\mathbf{b} = [b_I, b_W, b_H]$，其中 $b_I, b_W, b_H \\in \\{0,1\\}$ 分别表示是否选择隔热 ($I$)、窗户 ($W$) 和 HVAC 升级 ($H$)。允许空集（不采取任何措施）。\n- 对于给定的 $\\mathbf{b}$，令 $\\mathcal{S}(\\mathbf{b})$ 为所选措施的集合。净现值为\n$$\n\\mathrm{NPV}(\\mathbf{b}) = \\left(\\mathrm{PWF}(r,N)\\right)\\left[p \\left(E_{h,0} + E_{c,0} - E_h(\\mathcal{S}(\\mathbf{b})) - E_c(\\mathcal{S}(\\mathbf{b}))\\right) - \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} \\mathrm{OM}^{(m)} \\right] - \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} C^{(m)},\n$$\n其中 $C^{(m)}$ 是措施 $m$ 的资本成本，$\\mathrm{OM}^{(m)}$ 是其年度 O&M 成本变化。\n- 约束条件：\n  1. 资本预算：$\\sum_{m \\in \\mathcal{S}(\\mathbf{b})} C^{(m)} \\leq B$，其中 $B = \\$700{,}000$。\n  2. 舒适度约束（峰值供暖负荷不增加）：$P_h(\\mathcal{S}(\\mathbf{b})) \\leq P_{h,0}$。\n- 目标：在满足约束条件的所有 $\\mathbf{b} \\in \\{0,1\\}^3$ 中，最大化 $\\mathrm{NPV}(\\mathbf{b})$。如果有多个选择在 1 美元的绝对舍入容差内达到相同的最大 NPV，则选择总资本成本最低的那个；如果仍然持平，则选择措施数量较少的那个；如果仍然持平，则选择字典序最小的 $\\mathbf{b}$。\n\n所有测试通用的物理和建模参数：\n- 基准年度供暖能耗 $E_{h,0} = 3{,}000$ 兆瓦时/年（所有能量以兆瓦时表示）。\n- 基准年度制冷能耗 $E_{c,0} = 4{,}000$ 兆瓦时/年。\n- 基准峰值供暖负荷 $P_{h,0} = 5{,}000$ 千瓦（所有功率以千瓦表示）。\n- 分析周期 $N = 20$ 年。\n- 资本预算 $B = \\$700{,}000$。\n- 措施（参数值在整个测试套件中保持不变）：\n  - 隔热 ($I$)：资本成本 $C^{(I)} = \\$320{,}000$，年度 O&M 变化 $\\mathrm{OM}^{(I)} = \\$2{,}000$/年，分数影响 $\\delta_h^{(I)} = -0.20$, $\\delta_c^{(I)} = -0.05$, $\\delta_{P}^{(I)} = -0.15$。\n  - 窗户 ($W$)：资本成本 $C^{(W)} = \\$250{,}000$，年度 O&M 变化 $\\mathrm{OM}^{(W)} = \\$1{,}000$/年，分数影响 $\\delta_h^{(W)} = +0.02$, $\\delta_c^{(W)} = -0.12$, $\\delta_{P}^{(W)} = +0.03$。\n  - HVAC 升级 ($H$)：资本成本 $C^{(H)} = \\$380{,}000$，年度 O&M 变化 $\\mathrm{OM}^{(H)} = \\$5{,}000$/年，分数影响 $\\delta_h^{(H)} = -0.18$, $\\delta_c^{(H)} = -0.22$, $\\delta_{P}^{(H)} = 0.00$。\n\n测试套件：\n- 案例 1：电价 $p = \\$120$/兆瓦时，折现率 $r = 0.05$/年（$r$ 以小数表示），分析周期 $N = 20$ 年。\n- 案例 2：电价 $p = \\$20$/兆瓦时，折现率 $r = 0.05$/年，分析周期 $N = 20$ 年。\n- 案例 3：电价 $p = \\$200$/兆瓦时，折现率 $r = 0.05$/年，分析周期 $N = 20$ 年。\n- 案例 4：电价 $p = \\$120$/兆瓦时，折现率 $r = 0.12$/年，分析周期 $N = 20$ 年。\n\n角度单位不适用。\n\n要求的程序行为：\n- 对于每个测试案例，枚举所有二元选择 $\\mathbf{b} \\in \\{0,1\\}^3$，根据两个约束条件评估其可行性，计算 $\\mathrm{NPV}(\\mathbf{b})$，并根据目标和决胜规则选择最优的可行选择。\n- 最终输出必须是单行文本，包含一个有四个条目的 Python 风格列表，分别对应四个测试案例。每个条目本身必须是一个包含四个数字的列表，顺序为 $[b_I,b_W,b_H,\\mathrm{NPV}^\\star]$，其中 $\\mathrm{NPV}^\\star$ 是该案例的最优 NPV，表示为整数美元，四舍五入到最接近的美元。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如，\"[[1,0,1,2305000],[...],[...],[...]]\"）。所有货币价值以美元表示，能量以兆瓦时表示，功率以千瓦表示，如上所述。程序不得读取任何输入，也不得打印任何其他文本。",
            "solution": "用户指定了一个选择建筑能源改造措施的二元决策优化问题。目标是在资本预算约束和热舒适度约束下，最大化一系列措施组合的净现值 (NPV)。我将首先验证问题陈述，然后提供一个完整的解决方案。\n\n### 第一步：提取已知条件\n\n**决策变量：**\n- 一个二元决策向量 $\\mathbf{b} = [b_I, b_W, b_H]$，其中对于措施 $m \\in \\{I, W, H\\}$（隔热、窗户、HVAC），$b_m \\in \\{0,1\\}$。\n\n**目标函数：**\n- 在所有可行的 $\\mathbf{b} \\in \\{0,1\\}^3$ 中最大化 $\\mathrm{NPV}(\\mathbf{b})$。\n$$\n\\mathrm{NPV}(\\mathbf{b}) = \\left(\\mathrm{PWF}(r,N)\\right)\\left[p \\left(E_{h,0} + E_{c,0} - E_h(\\mathcal{S}(\\mathbf{b})) - E_c(\\mathcal{S}(\\mathbf{b}))\\right) - \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} \\mathrm{OM}^{(m)} \\right] - \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} C^{(m)}\n$$\n其中 $\\mathcal{S}(\\mathbf{b})$ 是所选措施的集合。\n\n**组成公式：**\n- 现值系数：$\\mathrm{PWF}(r,N) = \\frac{1 - (1+r)^{-N}}{r}$\n- 改造后年度供暖能耗：$E_h(\\mathcal{S}) = E_{h,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_h^{(m)}\\right)$\n- 改造后年度制冷能耗：$E_c(\\mathcal{S}) = E_{c,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_c^{(m)}\\right)$\n- 改造后峰值供暖负荷：$P_h(\\mathcal{S}) = P_{h,0} \\prod_{m \\in \\mathcal{S}} \\left(1 + \\delta_{P}^{(m)}\\right)$\n\n**约束条件：**\n1.  资本预算：$\\sum_{m \\in \\mathcal{S}(\\mathbf{b})} C^{(m)} \\leq B$，其中 $B = \\$700,000$。\n2.  舒适度约束：$P_h(\\mathcal{S}(\\mathbf{b})) \\leq P_{h,0}$。\n\n**决胜规则：**\n如果多个选择产生了相同的最大 NPV（在 1 美元的容差范围内）：\n1.  选择总资本成本最低的那个。\n2.  如果仍然持平，选择措施数量较少的那个。\n3.  如果仍然持平，选择字典序最小的 $\\mathbf{b}$。\n\n**通用参数：**\n- 基准年度供暖能耗 $E_{h,0} = 3000$ MWh/年。\n- 基准年度制冷能耗 $E_{c,0} = 4000$ MWh/年。\n- 基准峰值供暖负荷 $P_{h,0} = 5000$ kW。\n- 分析周期 $N = 20$ 年。\n- 资本预算 $B = \\$700,000$。\n\n**具体措施数据：**\n- 隔热 ($I$)：$C^{(I)} = \\$320,000$, $\\mathrm{OM}^{(I)} = \\$2,000$/年, $\\delta_h^{(I)} = -0.20$, $\\delta_c^{(I)} = -0.05$, $\\delta_{P}^{(I)} = -0.15$。\n- 窗户 ($W$)：$C^{(W)} = \\$250,000$, $\\mathrm{OM}^{(W)} = \\$1,000$/年, $\\delta_h^{(W)} = +0.02$, $\\delta_c^{(W)} = -0.12$, $\\delta_{P}^{(W)} = +0.03$。\n- HVAC 升级 ($H$)：$C^{(H)} = \\$380,000$, $\\mathrm{OM}^{(H)} = \\$5,000$/年, $\\delta_h^{(H)} = -0.18$, $\\delta_c^{(H)} = -0.22$, $\\delta_{P}^{(H)} = 0.00$。\n\n**测试套件：**\n- 案例 1：$p = \\$120$/MWh, $r = 0.05$/年。\n- 案例 2：$p = \\$20$/MWh, $r = 0.05$/年。\n- 案例 3：$p = \\$200$/MWh, $r = 0.05$/年。\n- 案例 4：$p = \\$120$/MWh, $r = 0.12$/年。\n所有案例均使用 $N = 20$ 年。\n\n### 第二步：使用提取的已知条件进行验证\n\n1.  **科学基础：** 该问题基于热力学第一定律（能量平衡）、标准金融原则（净现值）和公认的工程建模技术（效率措施的乘法影响）。该公式是对真实世界建筑能源改造分析的简化但有效的表述。\n2.  **定义明确：** 该问题是一个二元整数线性规划问题。然而，由于只有 3 个决策变量，搜索空间仅限于 $2^3 = 8$ 种可能的组合。这个小的有限空间保证了最优解的存在。目标函数定义清晰，全面的决胜规则确保能找到唯一的解。\n3.  **目标：** 问题以精确、量化和无偏见的语言陈述。所有术语都经过了正式定义。\n4.  **不完整或矛盾的设置：** 所有必需的参数都已提供。没有矛盾之处。单位一致（价格为 $/MWh，能量为 MWh，功率为 kW，成本为 $）。\n5.  **不切实际或不可行：** 所提供的参数值对于大型商业建筑改造项目而言在合理范围内。\n6.  **其他缺陷：** 问题没有其他列出的缺陷。它不过于隐喻、琐碎、无法验证或结构不良。\n\n### 第三步：结论与行动\n问题有效。将通过对决策空间进行穷举搜索来开发解决方案。\n\n### 解决方案设计\n\n该问题是一个二元优化问题，可以通过完全枚举来解决，因为决策变量的数量很少（3 个），只产生 $2^3=8$ 种可能的组合。对于每个测试案例，算法按以下步骤进行：\n\n1.  **遍历组合：** 系统地生成从 $[0,0,0]$ 到 $[1,1,1]$ 的所有 8 个二元决策向量 $\\mathbf{b} = [b_I, b_W, b_H]$。此迭代按字典序进行，这对于最终的决胜规则至关重要。\n\n2.  **评估可行性：** 对于每种组合 $\\mathbf{b}$，确定所选措施的集合 $\\mathcal{S}(\\mathbf{b})$。然后，检查两个约束：\n    - **资本预算约束：** 计算总资本成本 $C_{total} = \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} C^{(m)}$，并验证 $C_{total} \\leq B$。\n    - **舒适度约束：** 计算改造后的峰值供暖负荷 $P_h(\\mathcal{S}(\\mathbf{b})) = P_{h,0} \\prod_{m \\in \\mathcal{S}(\\mathbf{b})} (1 + \\delta_{P}^{(m)})$，并验证 $P_h(\\mathcal{S}(\\mathbf{b})) \\leq P_{h,0}$。\n    如果任何约束被违反，则该组合不可行，并被舍弃。\n\n3.  **计算 NPV：** 对于每个可行的组合，计算 $\\mathrm{NPV}$。这涉及几个子步骤：\n    - 计算改造后的年度供暖和制冷能耗 $E_h(\\mathcal{S}(\\mathbf{b}))$ 和 $E_c(\\mathcal{S}(\\mathbf{b}))$。\n    - 计算年度总能源成本节余：$A_{savings} = p \\left( (E_{h,0} + E_{c,0}) - (E_h(\\mathcal{S}(\\mathbf{b})) + E_c(\\mathcal{S}(\\mathbf{b}))) \\right)$。\n    - 计算年度 O&M 成本的总变化：$\\mathrm{OM}_{total} = \\sum_{m \\in \\mathcal{S}(\\mathbf{b})} \\mathrm{OM}^{(m)}$。\n    - 确定净等额年现金流：$A_{net} = A_{savings} - \\mathrm{OM}_{total}$。\n    - 根据测试案例的折现率 $r$ 和分析周期 $N$ 计算现值系数 $\\mathrm{PWF}(r,N)$。\n    - 最后，计算净现值：$\\mathrm{NPV}(\\mathbf{b}) = A_{net} \\times \\mathrm{PWF}(r,N) - C_{total}$。\n\n4.  **确定最优解：** 维护一个迄今为止找到的最佳可行解的记录，初始值为“不作为”情况（$\\mathbf{b}=[0,0,0]$，$\\mathrm{NPV}=\\$0$，$C_{total}=\\$0$）。在评估每个可行解时，使用指定的多级决胜标准将其与当前最优解进行比较：\n    - 如果一个新解的 $\\mathrm{NPV}$ 高出超过 1 美元的容差，则它更优。\n    - 如果 NPV 持平（在 1 美元以内），资本成本较低的新解更优。\n    - 如果 NPV 和成本都持平，涉及措施较少的新解更优。\n    - 如果以上所有都持平，则保留现有解，因为迭代顺序确保了它是字典序较小的那个。\n\n在遍历所有 8 种组合后，存储的最佳解即为给定测试案例的最优解。对所有四个测试案例重复此过程，并将结果汇总成要求的输出格式。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the building retrofit optimization problem by enumerating all\n    possible combinations and selecting the optimal one based on NPV\n    and specified tie-breaking rules.\n    \"\"\"\n\n    # Define physical and modeling parameters common to all tests\n    E_h0 = 3000.0  # Baseline annual heating energy (MWh/year)\n    E_c0 = 4000.0  # Baseline annual cooling energy (MWh/year)\n    P_h0 = 5000.0  # Baseline peak heating load (kW)\n    N = 20.0       # Analysis period (years)\n    B = 700000.0   # Capital budget ($)\n\n    # Define parameters for each retrofit measure\n    # Format: { 'key': {'C': cost, 'OM': om_change, 'd_h': delta_h, 'd_c': delta_c, 'd_P': delta_p} }\n    measures_data = {\n        'I': {'C': 320000.0, 'OM': 2000.0, 'd_h': -0.20, 'd_c': -0.05, 'd_P': -0.15},\n        'W': {'C': 250000.0, 'OM': 1000.0, 'd_h': +0.02, 'd_c': -0.12, 'd_P': +0.03},\n        'H': {'C': 380000.0, 'OM': 5000.0, 'd_h': -0.18, 'd_c': -0.22, 'd_P': 0.00}\n    }\n    measure_keys = ['I', 'W', 'H']\n\n    # Define the test suite\n    # Format: (electricity_price_p, discount_rate_r)\n    test_cases = [\n        (120.0, 0.05), # Case 1\n        (20.0, 0.05),  # Case 2\n        (200.0, 0.05), # Case 3\n        (120.0, 0.12)  # Case 4\n    ]\n\n    all_results = []\n\n    for p, r in test_cases:\n        # Initialize the best solution found for the current test case.\n        # The \"do nothing\" case is always feasible and serves as the baseline.\n        # Structure: (b_vector, NPV, capital_cost, number_of_measures)\n        best_solution = ([0, 0, 0], 0.0, 0.0, 0)\n\n        # Enumerate all 2^3 = 8 possible combinations of measures.\n        # The loop from 0 to 7 naturally produces b_vectors in lexicographical order.\n        for i in range(8):\n            b_I = (i >> 2)  1\n            b_W = (i >> 1)  1\n            b_H = (i >> 0)  1\n            b_vector = [b_I, b_W, b_H]\n            \n            selected_measures = []\n            if b_I: selected_measures.append('I')\n            if b_W: selected_measures.append('W')\n            if b_H: selected_measures.append('H')\n\n            # --- Constraint Validation ---\n            # 1. Capital Budget Constraint\n            C_total = sum(measures_data[key]['C'] for key in selected_measures)\n            if C_total > B:\n                continue\n\n            # 2. Comfort Constraint (Peak Heating Load)\n            P_h_retrofit = P_h0 * np.prod([1 + measures_data[key]['d_P'] for key in selected_measures])\n            if P_h_retrofit > P_h0:\n                continue\n\n            # --- NPV Calculation for Feasible Solutions ---\n            # Post-retrofit energy consumption\n            E_h_retrofit = E_h0 * np.prod([1 + measures_data[key]['d_h'] for key in selected_measures])\n            E_c_retrofit = E_c0 * np.prod([1 + measures_data[key]['d_c'] for key in selected_measures])\n            \n            # Annual energy cost savings\n            E_total_baseline = E_h0 + E_c0\n            E_total_retrofit = E_h_retrofit + E_c_retrofit\n            annual_cost_savings = p * (E_total_baseline - E_total_retrofit)\n            \n            # Net uniform annual cash flow\n            OM_total = sum(measures_data[key]['OM'] for key in selected_measures)\n            A_net = annual_cost_savings - OM_total\n            \n            # Present Worth Factor (PWF)\n            if r == 0:\n              pwf = N\n            else:\n              pwf = (1 - (1 + r)**-N) / r\n            \n            # Net Present Value (NPV)\n            npv = pwf * A_net - C_total\n            \n            # --- Tie-Breaking Logic ---\n            current_best_b, current_best_npv, current_best_cost, current_best_count = best_solution\n            num_measures = len(selected_measures)\n            \n            # 1. Higher NPV wins (with a $1 tolerance)\n            if npv > current_best_npv + 1.0:\n                best_solution = (b_vector, npv, C_total, num_measures)\n            elif abs(npv - current_best_npv) = 1.0:\n                # 2. Lower capital cost wins if NPV is tied\n                if C_total  current_best_cost:\n                    best_solution = (b_vector, npv, C_total, num_measures)\n                elif C_total == current_best_cost:\n                    # 3. Fewer measures win if cost is also tied\n                    if num_measures  current_best_count:\n                        best_solution = (b_vector, npv, C_total, num_measures)\n                    # 4. If all are tied, the existing solution (lexicographically smaller b) is kept.\n        \n        # After checking all combinations, format the result for this test case\n        optimal_b, optimal_npv, _, _ = best_solution\n        result_for_case = [optimal_b[0], optimal_b[1], optimal_b[2], int(round(optimal_npv))]\n        all_results.append(result_for_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[[{','.join(map(str, all_results))}]\".replace(\"], [\", \"],[\", 3))\n\nsolve()\n```"
        }
    ]
}