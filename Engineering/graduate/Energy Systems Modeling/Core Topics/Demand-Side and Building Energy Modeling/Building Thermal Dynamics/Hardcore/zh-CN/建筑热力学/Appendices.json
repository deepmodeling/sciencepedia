{
    "hands_on_practices": [
        {
            "introduction": "真实的建筑外墙是复杂的组合体，简单的单向传热分析往往不足以准确评估其热性能。本练习将介绍一种标准的工程方法，用于综合评估整个立面的稳态传热损失。您将学习如何将通过平面构件（由整体传热系数$U$值表征）的一维传热与在几何或材料不连续处（如墙角、窗户周边）产生的额外热流（由线性热桥或$\\psi$值表征）相结合，从而获得对建筑构件稳态性能的完整评估。",
            "id": "4073015",
            "problem": "一个矩形建筑立面由多个平面元件和线性连接构成，它们共同将一个均匀调节的室内环境与一个均匀的室外环境隔开。在稳态条件下，通过立面的传热可以从第一性原理进行建模。从傅里叶热传导定律、平面元件总传热系数的定义以及线性连接的线性热传导率的定义开始。以这些基础为依据，构建一种方法，将基于总传热系数 $U$ 的面积相关项和基于线性热传导率 $\\psi$ 的线性连接项组合成该立面的单一总热损失率。室内外温差是均匀的，等于 $\\Delta T$。一个连接处的线性热传导率 $\\psi$ 定义为：在相同的温差 $\\Delta T$下，相对于相邻平面元件的一维传热基准，由该连接处的二维效应产生的每单位长度的额外稳态热流。假设点热桥可以忽略不计，并且所提供的连接长度的测量方式确保了没有连接长度被重复计算。该立面具有以下平面组件和连接类型：\n\n- 不透明墙体类型 $A$，面积 $A_A = 220 \\, \\mathrm{m}^2$，总传热系数 $U_A = 0.22 \\, \\mathrm{W/(m^2 \\cdot K)}$。\n- 不透明墙体类型 $B$，面积 $A_B = 80 \\, \\mathrm{m}^2$，总传热系数 $U_B = 0.35 \\, \\mathrm{W/(m^2 \\cdot K)}$。\n- 窗户类型 $W$，总玻璃和窗框面积 $A_W = 40 \\, \\mathrm{m}^2$，总传热系数 $U_W = 1.50 \\, \\mathrm{W/(m^2 \\cdot K)}$。\n\n该立面包括以下不同的线性连接，其长度和 $\\psi$ 值根据上述定义测量：\n\n- 沿墙体 $A$ 周边的窗-墙连接，总长度 $L_{A\\!W} = 96 \\ \\mathrm{m}$，$\\psi_{A\\!W} = 0.06 \\, \\mathrm{W/(m \\cdot K)}$。\n- 沿墙体 $B$ 周边的窗-墙连接，总长度 $L_{B\\!W} = 24 \\ \\mathrm{m}$，$\\psi_{B\\!W} = 0.08 \\, \\mathrm{W/(m \\cdot K)}$。\n- 与墙体 $A$ 相连的楼板边缘连接，长度 $L_{sA} = 30 \\ \\mathrm{m}$，$\\psi_{sA} = 0.35 \\, \\mathrm{W/(m \\cdot K)}$。\n- 与墙体 $B$ 相连的楼板边缘连接，长度 $L_{sB} = 18 \\ \\mathrm{m}$，$\\psi_{sB} = 0.42 \\, \\mathrm{W/(m \\cdot K)}$。\n- 立面的外角连接，总垂直角长度 $L_{C} = 12 \\ \\mathrm{m}$，$\\psi_{C} = 0.10 \\, \\mathrm{W/(m \\cdot K)}$。\n\n假设室内外温差均匀为 $\\Delta T = 22 \\ \\mathrm{K}$。使用第一性原理来证明您的方法，推导出通过立面的总稳态热损失率 $Q_{\\text{tot}}$ 的通用表达式，该表达式能够正确地组合与面积相关的 $U$ 项和与线性相关的 $\\psi$ 项，而不会重复计算，然后根据给定数据对 $Q_{\\text{tot}}$ 进行数值计算。将最终数值答案四舍五入到四位有效数字。以瓦特（$\\mathrm{W}$）为单位表示最终热损失率。",
            "solution": "该问题被认为是有效的，因为它科学地基于传热原理，所有必要数据均已提供，问题设置良好，且其表述是客观的。所提供的物理量是现实的且量纲一致。\n\n目标是推导出一个建筑立面总稳态热损失率 $Q_{\\text{tot}}$ 的综合表达式，然后计算其数值。该立面由具有一维（$1\\mathrm{D}$）传热特性的平面元件和具有显著二维（$2\\mathrm{D}$）传热效应的线性连接组成。\n\n我们从第一性原理开始。控制热传导的基本定律是傅里叶定律，其矢量形式为：\n$$\n\\vec{q} = -k \\nabla T\n$$\n其中 $\\vec{q}$ 是热通量矢量（$\\mathrm{W/m^2}$），$k$ 是热导率（$\\mathrm{W/(m \\cdot K)}$），而 $\\nabla T$ 是温度梯度（$\\mathrm{K/m}$）。\n\n对于面积为 $A$、厚度为 $d$ 的简单平面元件，在稳态条件下，其两侧温差为 $\\Delta T$，傅里叶定律简化为一维热流率 $Q$：\n$$\nQ = \\frac{k A \\Delta T}{d}\n$$\n在建筑物理学中，通常使用总传热系数 $U$（单位为 $\\mathrm{W/(m^2 \\cdot K)}$）来表征复合建筑构件（如墙体或窗户组件）的热性能。$U$ 值包含了所有层和表面的导热和对流热阻。通过面积为 $A_i$、总传热系数为 $U_i$ 的平面元件 $i$ 的热流率 $Q_{\\text{1D},i}$ 由下式给出：\n$$\nQ_{\\text{1D},i} = U_i A_i \\Delta T\n$$\n如果我们天真地将整个立面建模为不相交的平面元件的集合，那么总热损失将是这些单独的一维热流的总和：\n$$\nQ_{\\text{planar}} = \\left( \\sum_{i} U_i A_i \\right) \\Delta T\n$$\n然而，这个模型忽略了在元件之间的连接处（例如，墙-窗界面、角落、楼板边缘）发生的多维热流。在这些“热桥”处，由于材料和几何形状的不连续性，热流会增强。\n\n为了解决这个问题，引入了线性热传导率 $\\psi$（单位为 $\\mathrm{W/(m \\cdot K)}$）的概念。正如问题陈述中所定义，$\\psi$ 量化了连接处每单位长度的*额外*热流，这是相对于相邻平面元件的一维基准热流而言的。通过包含连接区域的总热流是 $1\\mathrm{D}$ 分量（已通过 $U A$ 项计算）和连接的附加项的总和。对于长度为 $L_j$、线性热传导率为 $\\psi_j$ 的线性连接 $j$，其额外热流率 $Q_{\\text{bridge}, j}$ 为：\n$$\nQ_{\\text{bridge}, j} = \\psi_j L_j \\Delta T\n$$\n通过将 $\\psi$ 定义为一个*额外*量，我们可以通过将所有平面区域的基准 $1\\mathrm{D}$ 热损失与所有线性连接的附加、额外热损失相加，来计算立面的总热损失 $Q_{\\text{tot}}$。这种方法可以防止热流的重复计算。因此，总热损失率为：\n$$\nQ_{\\text{tot}} = Q_{\\text{planar}} + Q_{\\text{bridges}} = \\left( \\sum_{i} U_i A_i \\right) \\Delta T + \\left( \\sum_{j} \\psi_j L_j \\right) \\Delta T\n$$\n将均匀温差 $\\Delta T$ 提取出来，我们得到总稳态热损失率的通用表达式：\n$$\nQ_{\\text{tot}} = \\left( \\sum_{i} U_i A_i + \\sum_{j} \\psi_j L_j \\right) \\Delta T\n$$\n这也可以表示为 $Q_{\\text{tot}} = H_T \\Delta T$，其中 $H_T$ 是立面的总传热系数，定义为 $H_T = \\sum_{i} U_i A_i + \\sum_{j} \\psi_j L_j$。\n\n现在，我们使用所提供的数据来评估这个表达式。\n\n首先，我们计算与面积相关的传热系数之和，$\\sum_{i} U_i A_i$：\n平面组件是墙体类型 $A$、墙体类型 $B$ 和窗户类型 $W$。\n$$\n\\sum_{i} U_i A_i = U_A A_A + U_B A_B + U_W A_W\n$$\n代入给定值：\n$$\n\\sum_i U_i A_i = (0.22 \\, \\mathrm{W/(m^2 \\cdot K)}) (220 \\, \\mathrm{m}^2) + (0.35 \\, \\mathrm{W/(m^2 \\cdot K)}) (80 \\, \\mathrm{m}^2) + (1.50 \\, \\mathrm{W/(m^2 \\cdot K)}) (40 \\, \\mathrm{m}^2)\n$$\n$$\n\\sum_i U_i A_i = 48.4 \\, \\mathrm{W/K} + 28.0 \\, \\mathrm{W/K} + 60.0 \\, \\mathrm{W/K} = 136.4 \\, \\mathrm{W/K}\n$$\n接下来，我们计算与连接相关的传热系数之和，$\\sum_{j} \\psi_j L_j$：\n线性连接包括窗-墙连接（$A$ 和 $B$）、楼板-墙连接（$A$ 和 $B$）以及外角。\n$$\n\\sum_{j} \\psi_j L_j = \\psi_{A\\!W} L_{A\\!W} + \\psi_{B\\!W} L_{B\\!W} + \\psi_{sA} L_{sA} + \\psi_{sB} L_{sB} + \\psi_{C} L_{C}\n$$\n代入给定值：\n$$\n\\sum_j \\psi_j L_j = (0.06)(96) + (0.08)(24) + (0.35)(30) + (0.42)(18) + (0.10)(12) \\ \\mathrm{[W/K]}\n$$\n$$\n\\sum_j \\psi_j L_j = 5.76 + 1.92 + 10.5 + 7.56 + 1.2 \\ \\mathrm{[W/K]}\n$$\n$$\n\\sum_j \\psi_j L_j = 26.94 \\ \\mathrm{W/K}\n$$\n现在，我们计算总传热系数 $H_T$：\n$$\nH_T = \\sum_i U_i A_i + \\sum_j \\psi_j L_j = 136.4 \\, \\mathrm{W/K} + 26.94 \\, \\mathrm{W/K} = 163.34 \\, \\mathrm{W/K}\n$$\n最后，我们使用给定的温差 $\\Delta T = 22 \\ \\mathrm{K}$ 计算总热损失率 $Q_{\\text{tot}}$：\n$$\nQ_{\\text{tot}} = H_T \\Delta T = (163.34 \\, \\mathrm{W/K}) (22 \\ \\mathrm{K})\n$$\n$$\nQ_{\\text{tot}} = 3593.48 \\ \\mathrm{W}\n$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$\nQ_{\\text{tot}} \\approx 3593 \\ \\mathrm{W}\n$$\n推导出的表达式正确地结合了基于面积的一维传热和连接处的二维额外传热，为指定条件下立面的热性能提供了一个完整的模型。",
            "answer": "$$\\boxed{3593}$$"
        },
        {
            "introduction": "建筑物很少处于完全的稳态条件下，其热性能会随着室外温度的日夜波动而动态变化。本练习将带您进入瞬态分析领域，模拟墙体如何响应正弦变化的室外温度。您将从第一性原理出发，推导并应用一种基本的计算传热学技术——显式有限差分格式，并深入分析其保持数值解稳定的必要条件。",
            "id": "4073024",
            "problem": "一个矩形建筑墙体被建模为厚度为 $L$ 的一维平板，其材料属性均匀：热导率 $k$（单位为 $\\mathrm{W/(m\\cdot K)}$），密度 $\\rho$（单位为 $\\mathrm{kg/m^3}$），以及比热容 $c$（单位为 $\\mathrm{J/(kg\\cdot K)}$）。热扩散率为 $\\alpha = \\frac{k}{\\rho c}$（单位为 $\\mathrm{m^2/s}$）。空间域被离散化为 $N$ 个节点，节点间距均匀，为 $\\Delta x = \\frac{L}{N-1}$（单位为 $\\mathrm{m}$）。在 $x=0$ 的外表面，瞬态外部空气温度由函数 $T_{\\text{ext}}(t) = T_{\\text{mean}} + A \\sin\\!\\left(2\\pi t / 86400\\right)$（单位为 $\\mathrm{K}$）给出，其中正弦函数的参数以弧度为单位，$t$ 是时间（单位为秒），$T_{\\text{mean}}$ 是基础温度（单位为 $\\mathrm{K}$），$A$ 是振幅（单位为 $\\mathrm{K}$）。在 $x=L$ 的内边界可以是对流边界，其室内空气温度恒为 $T_{\\text{int}}$（单位为 $\\mathrm{K}$），对流换热系数为 $h_{\\text{int}}$（单位为 $\\mathrm{W/(m^2\\cdot K)}$）；也可以是固定温度的狄利克雷（Dirichlet）边界，温度设定为 $T_{\\text{int}}$。\n\n从控制体中的能量守恒和傅里叶（Fourier）热传导定律出发，为内部节点推导一个在时间上向前（Forward-Time）、在空间上居中（Centered-Space）的一维显式有限差分格式。对于边界，使用第一性原理的传导和对流平衡，推导一致的显式更新方程：在 $x=0$ 处，与温度为 $T_{\\text{ext}}(t)$ 的外部环境进行对流，系数为 $h_{\\text{ext}}$（单位为 $\\mathrm{W/(m^2\\cdot K)}$）；在 $x=L$ 处，或者与温度为 $T_{\\text{int}}$ 的内部环境进行对流，系数为 $h_{\\text{int}}$，或者采用固定的狄利克雷（Dirichlet）条件。仅使用已声明的物理定律和定义；不要引用未声明的快捷公式。基于傅里叶数 $Fo = \\frac{\\alpha \\Delta t}{\\Delta x^2}$ 和对显式格式的适当稳定性分析（包括内部模式稳定性和边界更新约束），确定最大稳定时间步长 $\\Delta t_{\\max}$（单位为秒）。您的推导必须清楚地说明显式更新保持稳定的条件。\n\n您的程序必须实现所推导的逻辑，以计算以下每个测试用例的 $\\Delta t_{\\max}$。所有输出均以秒为单位表示，并四舍五入到六位小数。$T_{\\text{ext}}(t)$ 中的正弦函数使用弧度制。\n\n测试套件：\n- 案例1（砖石墙，双边对流边界）：\n    - $L = 0.25$ $\\mathrm{m}$, $k = 1.2$ $\\mathrm{W/(m\\cdot K)}$, $\\rho = 2200$ $\\mathrm{kg/m^3}$, $c = 880$ $\\mathrm{J/(kg\\cdot K)}$, $N = 21$。\n    - 外部：$h_{\\text{ext}} = 25$ $\\mathrm{W/(m^2\\cdot K)}$, $T_{\\text{mean}} = 278.15$ $\\mathrm{K}$, $A = 5$ $\\mathrm{K}$。\n    - 内部：与 $h_{\\text{int}} = 8$ $\\mathrm{W/(m^2\\cdot K)}$ 和 $T_{\\text{int}} = 294.15$ $\\mathrm{K}$ 对流。\n- 案例2（铝板，双边对流边界）：\n    - $L = 0.005$ $\\mathrm{m}$, $k = 205$ $\\mathrm{W/(m\\cdot K)}$, $\\rho = 2700$ $\\mathrm{kg/m^3}$, $c = 900$ $\\mathrm{J/(kg\\cdot K)}$, $N = 11$。\n    - 外部：$h_{\\text{ext}} = 15$ $\\mathrm{W/(m^2\\cdot K)}$, $T_{\\text{mean}} = 280.15$ $\\mathrm{K}$, $A = 7$ $\\mathrm{K}$。\n    - 内部：与 $h_{\\text{int}} = 7$ $\\mathrm{W/(m^2\\cdot K)}$ 和 $T_{\\text{int}} = 295.15$ $\\mathrm{K}$ 对流。\n- 案例3（隔热材料，外部对流与内部狄利克雷边界）：\n    - $L = 0.2$ $\\mathrm{m}$, $k = 0.035$ $\\mathrm{W/(m\\cdot K)}$, $\\rho = 30$ $\\mathrm{kg/m^3}$, $c = 1400$ $\\mathrm{J/(kg\\cdot K)}$, $N = 41$。\n    - 外部：$h_{\\text{ext}} = 20$ $\\mathrm{W/(m^2\\cdot K)}$, $T_{\\text{mean}} = 275.15$ $\\mathrm{K}$, $A = 8$ $\\mathrm{K}$。\n    - 内部：固定狄利克雷边界，温度为 $T_{\\text{int}} = 294.15$ $\\mathrm{K}$（无对流系数）。\n- 案例4（粗糙离散化，强外部对流）：\n    - $L = 0.1$ $\\mathrm{m}$, $k = 0.12$ $\\mathrm{W/(m\\cdot K)}$, $\\rho = 500$ $\\mathrm{kg/m^3}$, $c = 1600$ $\\mathrm{J/(kg\\cdot K)}$, $N = 3$。\n    - 外部：$h_{\\text{ext}} = 100$ $\\mathrm{W/(m^2\\cdot K)}$, $T_{\\text{mean}} = 276.15$ $\\mathrm{K}$, $A = 6$ $\\mathrm{K}$。\n    - 内部：与 $h_{\\text{int}} = 10$ $\\mathrm{W/(m^2\\cdot K)}$ 和 $T_{\\text{int}} = 293.15$ $\\mathrm{K}$ 对流。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，例如 $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4\\right]$，其中每个 $\\text{result}_i$ 是对应案例计算出的 $\\Delta t_{\\max}$，单位为秒，四舍五入到六位小数。",
            "solution": "本问题的分析始于应用于一维热传导问题的能量守恒基本原理，该问题遵循傅里叶（Fourier）定律。我们将为内部节点和边界节点推导显式有限差分方程，并随后确定决定最大允许时间步长 $\\Delta t_{\\max}$ 的稳定性约束。\n\n主导的物理原理是热力学第一定律，它指出一个控制体内内能的变化率等于进入该控制体的净热传递率。对于具有恒定属性的不可压缩固体，这表示为：\n$$ \\rho c \\frac{\\partial T}{\\partial t} = -\\nabla \\cdot \\vec{q}'' $$\n其中 $\\rho$ 是密度，$c$ 是比热容，$T$ 是温度，$\\vec{q}''$ 是热通量矢量。在一维情况下，根据傅里叶热传导定律（$q''_x = -k \\frac{\\partial T}{\\partial x}$），该方程简化为热方程：\n$$ \\rho c \\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial x} \\left( k \\frac{\\partial T}{\\partial x} \\right) $$\n在热导率 $k$ 均匀的情况下，方程变为：\n$$ \\frac{\\partial T}{\\partial t} = \\alpha \\frac{\\partial^2 T}{\\partial x^2} $$\n其中 $\\alpha = \\frac{k}{\\rho c}$ 是热扩散率。\n\n我们将空间域 $x \\in [0, L]$ 离散化为 $N$ 个节点，索引为 $i=0, 1, \\dots, N-1$，节点间距均匀，为 $\\Delta x = \\frac{L}{N-1}$。在节点 $i$ 和时间步 $p$ 的温度表示为 $T_i^p$。\n\n**1. 内部节点（$i=1, \\dots, N-2$）的有限差分方程**\n\n我们对以节点 $i$ 为中心、宽度为 $\\Delta x$、范围从 $x_i - \\frac{\\Delta x}{2}$ 到 $x_i + \\frac{\\Delta x}{2}$ 的控制体应用能量平衡。单位面积上的能量平衡为：\n$$ \\text{能量储存率} = \\text{热传导输入率} - \\text{热传导输出率} $$\n$$ \\rho c \\Delta x \\frac{dT_i}{dt} = q''_{x, \\text{in}} - q''_{x, \\text{out}} $$\n热通量使用有限差分进行近似：\n- 从节点 $i-1$ 传入的热通量：$q''_{x, \\text{in}} \\approx k \\frac{T_{i-1} - T_i}{\\Delta x}$\n- 传出到节点 $i+1$ 的热通量：$q''_{x, \\text{out}} \\approx k \\frac{T_i - T_{i+1}}{\\Delta x}$\n\n将这些代入能量平衡方程：\n$$ \\rho c \\Delta x \\frac{dT_i}{dt} = k \\frac{T_{i-1} - T_i}{\\Delta x} - k \\frac{T_i - T_{i+1}}{\\Delta x} = \\frac{k}{\\Delta x} (T_{i-1} - 2T_i + T_{i+1}) $$\n两边同除以 $\\rho c \\Delta x$ 得到半离散化方程：\n$$ \\frac{dT_i}{dt} = \\frac{\\alpha}{\\Delta x^2} (T_{i-1} - 2T_i + T_{i+1}) $$\n对时间导数应用前向时间（显式欧拉）近似，即 $\\frac{dT_i}{dt} \\approx \\frac{T_i^{p+1} - T_i^p}{\\Delta t}$，我们得到：\n$$ \\frac{T_i^{p+1} - T_i^p}{\\Delta t} = \\frac{\\alpha}{\\Delta x^2} (T_{i-1}^p - 2T_i^p + T_{i+1}^p) $$\n求解未来温度 $T_i^{p+1}$：\n$$ T_i^{p+1} = T_i^p + \\frac{\\alpha \\Delta t}{\\Delta x^2} (T_{i-1}^p - 2T_i^p + T_{i+1}^p) $$\n定义无量纲傅里叶数 $Fo = \\frac{\\alpha \\Delta t}{\\Delta x^2}$，方程变为：\n$$ T_i^{p+1} = Fo \\cdot T_{i-1}^p + (1 - 2Fo) T_i^p + Fo \\cdot T_{i+1}^p $$\n为使格式稳定，乘以时间步 $p$ 温度的系数必须为非负值。这要求 $1 - 2Fo \\ge 0$，从而得出内部节点的稳定性判据：\n$$ Fo \\le \\frac{1}{2} \\implies \\Delta t \\le \\frac{\\Delta x^2}{2\\alpha} $$\n\n**2. 外边界节点（$x=0$, $i=0$）的有限差分方程**\n\n对于外表面的节点，我们考虑一个从 $x=0$ 到 $x=\\frac{\\Delta x}{2}$ 的半宽度控制体。能量平衡包括来自外部空气的对流和来自相邻内部节点（$i=1$）的传导。\n$$ \\rho c \\frac{\\Delta x}{2} \\frac{dT_0}{dt} = q''_{\\text{conv}} + q''_{\\text{cond}} $$\n- 来自外部空气的对流热通量：$q''_{\\text{conv}} = h_{\\text{ext}} (T_{\\text{ext}}(t) - T_0)$\n- 来自节点1的传导热通量：$q''_{\\text{cond}} = k \\frac{T_1 - T_0}{\\Delta x}$\n\n能量平衡方程为：\n$$ \\rho c \\frac{\\Delta x}{2} \\frac{dT_0}{dt} = h_{\\text{ext}} (T_{\\text{ext}}(t) - T_0) + k \\frac{T_1 - T_0}{\\Delta x} $$\n在时间上进行离散化并求解 $T_0^{p+1}$：\n$$ \\rho c \\frac{\\Delta x}{2} \\frac{T_0^{p+1} - T_0^p}{\\Delta t} = h_{\\text{ext}} (T_{\\text{ext}}^p - T_0^p) + \\frac{k}{\\Delta x} (T_1^p - T_0^p) $$\n$$ T_0^{p+1} = T_0^p + \\frac{2\\Delta t}{\\rho c \\Delta x} \\left[ h_{\\text{ext}}(T_{\\text{ext}}^p - T_0^p) + \\frac{k}{\\Delta x}(T_1^p - T_0^p) \\right] $$\n按时间步 $p$ 的温度重新排列并分组：\n$$ T_0^{p+1} = \\left( 1 - \\frac{2 h_{\\text{ext}} \\Delta t}{\\rho c \\Delta x} - \\frac{2 k \\Delta t}{\\rho c \\Delta x^2} \\right) T_0^p + \\left(\\frac{2 k \\Delta t}{\\rho c \\Delta x^2}\\right) T_1^p + \\left(\\frac{2 h_{\\text{ext}} \\Delta t}{\\rho c \\Delta x}\\right) T_{\\text{ext}}^p $$\n使用傅里叶数 $Fo = \\frac{\\alpha \\Delta t}{\\Delta x^2} = \\frac{k \\Delta t}{\\rho c \\Delta x^2}$ 并定义毕渥（Biot）数 $Bi_{\\text{ext}} = \\frac{h_{\\text{ext}} \\Delta x}{k}$，我们可以简化系数：\n$$ \\frac{2 h_{\\text{ext}} \\Delta t}{\\rho c \\Delta x} = \\frac{2 h_{\\text{ext}} \\Delta x}{k} \\frac{k \\Delta t}{\\rho c \\Delta x^2} = 2 Bi_{\\text{ext}} Fo $$\n更新方程变为：\n$$ T_0^{p+1} = (1 - 2Fo - 2Bi_{\\text{ext}}Fo) T_0^p + 2Fo \\cdot T_1^p + 2Bi_{\\text{ext}}Fo \\cdot T_{\\text{ext}}^p $$\n$$ T_0^{p+1} = [1 - 2Fo(1 + Bi_{\\text{ext}})] T_0^p + 2Fo \\cdot T_1^p + 2Bi_{\\text{ext}}Fo \\cdot T_{\\text{ext}}^p $$\n稳定性条件要求 $T_0^p$ 的系数为非负：\n$$ 1 - 2Fo(1 + Bi_{\\text{ext}}) \\ge 0 \\implies Fo \\le \\frac{1}{2(1 + Bi_{\\text{ext}})} $$\n$$ \\Delta t \\le \\frac{\\Delta x^2}{2\\alpha(1 + \\frac{h_{\\text{ext}}\\Delta x}{k})} $$\n由于 $Bi_{\\text{ext}} > 0$，此约束比内部节点的约束更严格。\n\n**3. 内边界节点（$x=L$, $i=N-1$）的有限差分方程**\n\n**A. 对流边界：**\n推导过程与外边界情况对称。控制体范围从 $x=L-\\frac{\\Delta x}{2}$ 到 $x=L$。能量平衡为：\n$$ \\rho c \\frac{\\Delta x}{2} \\frac{dT_{N-1}}{dt} = q''_{\\text{cond}} + q''_{\\text{conv}} $$\n- 来自节点 $N-2$ 的传导热通量：$q''_{\\text{cond}} = k \\frac{T_{N-2} - T_{N-1}}{\\Delta x}$\n- 来自室内空气的对流热通量：$q''_{\\text{conv}} = h_{\\text{int}} (T_{\\text{int}} - T_{N-1})$\n\n遵循相同的步骤，我们得到更新方程：\n$$ T_{N-1}^{p+1} = [1 - 2Fo(1 + Bi_{\\text{int}})] T_{N-1}^p + 2Fo \\cdot T_{N-2}^p + 2Bi_{\\text{int}}Fo \\cdot T_{\\text{int}} $$\n其中 $Bi_{\\text{int}} = \\frac{h_{\\text{int}} \\Delta x}{k}$。稳定性判据为：\n$$ \\Delta t \\le \\frac{\\Delta x^2}{2\\alpha(1 + \\frac{h_{\\text{int}}\\Delta x}{k})} $$\n\n**B. 狄利克雷边界：**\n如果 $x=L$ 处的边界是固定温度（狄利克雷）边界，其温度在所有时间都是给定的：\n$$ T_{N-1}^p = T_{\\text{int}} \\quad \\forall p $$\n此节点不需要能量平衡或更新方程。固定的温度 $T_{N-1}$ 仅用于其相邻节点 $N-2$ 的更新方程中。狄利克雷边界本身不对 $\\Delta t$ 施加新的稳定性约束。\n\n**4. 整体稳定性与最大时间步长（$\\Delta t_{\\max}$）**\n\n为使显式有限差分格式保持数值稳定，时间步长 $\\Delta t$ 必须同时满足所有推导出的稳定性条件。因此，整体最大稳定时间步长 $\\Delta t_{\\max}$ 是由内部节点和任何对流边界节点施加的限制中的最小值。\n\n设 $\\Delta t_{\\text{int\\_nodes}} = \\frac{\\Delta x^2}{2\\alpha}$。\n设 $\\Delta t_{\\text{ext\\_boundary}} = \\frac{\\Delta x^2}{2\\alpha(1 + \\frac{h_{\\text{ext}}\\Delta x}{k})}$。\n如果内边界是对流边界，设 $\\Delta t_{\\text{int\\_boundary}} = \\frac{\\Delta x^2}{2\\alpha(1 + \\frac{h_{\\text{int}}\\Delta x}{k})}$。\n\n那么，$\\Delta t_{\\max}$ 是给定案例所有适用约束中的最小值。\n- 对于两个对流边界：$\\Delta t_{\\max} = \\min(\\Delta t_{\\text{int\\_nodes}}, \\Delta t_{\\text{ext\\_boundary}}, \\Delta t_{\\text{int\\_boundary}})$。\n- 对于一个对流边界和一个狄利克雷边界：$\\Delta t_{\\max} = \\min(\\Delta t_{\\text{int\\_nodes}}, \\Delta t_{\\text{ext\\_boundary}})$。\n\n由于毕渥数总是非负的（$h \\ge 0, k > 0, \\Delta x > 0$），对流边界的约束总是比内部节点的约束更严格或同样严格。计算简化为在边界条件中找到最小的 $\\Delta t$。\n\n程序将实现这些公式，以根据每个测试用例的特定边界类型和物理属性来计算 $\\Delta t_{\\max}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_dt_max(params):\n    \"\"\"\n    Calculates the maximum stable time step for a 1D transient heat conduction problem\n    using an explicit finite difference scheme.\n\n    The calculation is based on stability criteria for interior nodes and convective\n    boundary nodes.\n\n    Args:\n        params (dict): A dictionary containing all the physical and discretization\n                       parameters for a specific case.\n\n    Returns:\n        float: The maximum stable time step (dt_max) in seconds.\n    \"\"\"\n    # Extract parameters from the dictionary\n    L = params['L']\n    k = params['k']\n    rho = params['rho']\n    c = params['c']\n    N = params['N']\n    h_ext = params['h_ext']\n    \n    # Calculate derived simulation parameters\n    # Spatial step size\n    delta_x = L / (N - 1)\n    # Thermal diffusivity\n    alpha = k / (rho * c)\n    \n    # --- Stability Criteria Derivations ---\n\n    # 1. Interior nodes stability constraint: dt = dx^2 / (2 * alpha)\n    # This is from the coefficient of T_i^p in the FTCS scheme: (1 - 2*Fo) >= 0\n    # where Fo = alpha * dt / dx^2.\n    dt_interior_constraint = (delta_x**2) / (2 * alpha)\n    \n    # 2. Exterior boundary (x=0) stability constraint (convective)\n    # This is from the coefficient of T_0^p in its energy balance update equation:\n    # (1 - 2*Fo*(1 + Bi_ext)) >= 0, where Bi_ext = h_ext * dx / k.\n    # This leads to: dt = dx^2 / (2 * alpha * (1 + h_ext * dx / k))\n    dt_ext_boundary_constraint = (delta_x**2) / (2 * alpha * (1 + (h_ext * delta_x) / k))\n    \n    # Initialize a list of all applicable constraints\n    constraints = [dt_interior_constraint, dt_ext_boundary_constraint]\n    \n    # 3. Interior boundary (x=L) stability constraint\n    # This is only applicable if the boundary is convective.\n    # A Dirichlet boundary imposes no additional stability constraint.\n    if 'h_int' in params:\n        h_int = params['h_int']\n        # The derivation is symmetric to the exterior boundary case:\n        # dt = dx^2 / (2 * alpha * (1 + h_int * dx / k))\n        dt_int_boundary_constraint = (delta_x**2) / (2 * alpha * (1 + (h_int * delta_x) / k))\n        constraints.append(dt_int_boundary_constraint)\n        \n    # The overall maximum stable time step is the minimum of all constraints\n    return min(constraints)\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Masonry wall, both boundaries convective\n        {\n            'L': 0.25, 'k': 1.2, 'rho': 2200, 'c': 880, 'N': 21,\n            'h_ext': 25, 'h_int': 8\n        },\n        # Case 2: Aluminum panel, both boundaries convective\n        {\n            'L': 0.005, 'k': 205, 'rho': 2700, 'c': 900, 'N': 11,\n            'h_ext': 15, 'h_int': 7\n        },\n        # Case 3: Insulation, exterior convective and interior Dirichlet\n        {\n            'L': 0.2, 'k': 0.035, 'rho': 30, 'c': 1400, 'N': 41,\n            'h_ext': 20  # No h_int, indicating a Dirichlet boundary\n        },\n        # Case 4: Coarse discretization, strong exterior convection\n        {\n            'L': 0.1, 'k': 0.12, 'rho': 500, 'c': 1600, 'N': 3,\n            'h_ext': 100, 'h_int': 10\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        dt_max = calculate_dt_max(case)\n        # Format the result to six decimal places\n        results.append(f\"{dt_max:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the solver\nsolve()\n```"
        },
        {
            "introduction": "虽然显式差分法在教学上很有价值，但其对时间步长的严格限制在实际应用中可能效率低下。本练习将引导您实现一种更强大、更广泛应用的隐式方法——Crank-Nicolson格式，该方法对于线性问题是无条件稳定的。您将处理一个真实的多层墙体结构，并构建求解温度场的带状矩阵系统，从而深入了解专业建筑能耗模拟软件的核心算法。",
            "id": "4073050",
            "problem": "考虑一个一维多层墙体，其材料属性为分段常数，受到随时间变化的室外气温和通过对流边界条件维持的室内空气的影响。从能量守恒和傅里叶热传导定律出发，推导一个半离散空间模型，并实现一个 Crank–Nicolson 时间积分方案。在每个时间步长构建由此产生的三对角线性系统，并求解它以获得墙体温度场随时间的变化。在您的推导和算法设计中，明确阐述 Crank–Nicolson 方法的数值阻尼和精度特性，但除了基本公式外，不要依赖任何简化公式。\n\n基本公式：\n- 微分形式的能量守恒：对于均匀介质中的温度场 $T(x,t)$，一维瞬态热传导方程为\n$$\n\\rho c \\,\\frac{\\partial T}{\\partial t} = \\frac{\\partial}{\\partial x} \\left( k \\,\\frac{\\partial T}{\\partial x} \\right),\n$$\n其中 $\\rho$ 是质量密度（单位 $\\mathrm{kg/m^3}$），$c$ 是比热容（单位 $\\mathrm{J/(kg\\cdot K)}$），$k$ 是导热系数（单位 $\\mathrm{W/(m\\cdot K)}$）。\n- 傅里叶热传导定律：热通量 $q$ 满足 $q = -k\\,\\partial T/\\partial x$。\n- 对流（Robin）边界条件：在与温度为 $T_{\\infty}(t)$ 的空气接触的表面上，热通量满足 $q = h\\,(T_{\\mathrm{surface}} - T_{\\infty}(t))$，其中 $h$ 是对流换热系数（单位 $\\mathrm{W/(m^2\\cdot K)}$）。\n\n空间离散化要求：\n- 采用有限体积法沿 $x$ 方向对墙体进行离散化：对于厚度为 $\\Delta x_i$、中心温度为 $T_i(t)$、材料属性为 $\\rho_i, c_i, k_i$ 的控制体 $i$，使用通过界面的传导通量为每个控制体写出能量平衡方程。\n- 在控制体 $i$ 和 $i+1$ 之间的内部界面处，使用两个相邻半厚度上的串联热阻来近似界面热导。令界面热导为\n$$\nG_{i+\\frac{1}{2}} = \\frac{1}{\\left(\\frac{\\Delta x_i}{2\\,k_i}\\right) + \\left(\\frac{\\Delta x_{i+1}}{2\\,k_{i+1}}\\right)}.\n$$\n- 在外部边界（索引为 $1$），与室外空气温度为 $T_{\\text{out}}(t)$、对流系数为 $h_{\\text{out}}$ 接触，将从单元中心到环境的总串联热阻建模为\n$$\nR_{\\text{left}} = \\frac{\\Delta x_1}{2\\,k_1} + \\frac{1}{h_{\\text{out}}}, \\quad \\text{so that} \\quad q_{\\text{left}} = \\frac{T_{\\text{out}}(t) - T_1(t)}{R_{\\text{left}}}.\n$$\n类似地，在内部边界（索引为 $N$），与室内空气温度为 $T_{\\text{room}}(t)$、对流系数为 $h_{\\text{in}}$ 接触，\n$$\nR_{\\text{right}} = \\frac{\\Delta x_N}{2\\,k_N} + \\frac{1}{h_{\\text{in}}}, \\quad \\text{so that} \\quad q_{\\text{right}} = \\frac{T_{\\text{room}}(t) - T_N(t)}{R_{\\text{right}}}.\n$$\n\n时间离散化要求：\n- 使用上述有限体积空间离散化得到的半离散系统，实现 Crank–Nicolson 方案。构建在时间层 $t^{n+1}$ 的温度相对于时间层 $t^{n}$ 的温度的三对角系统。\n- 该方案的实现必须与 $T_{\\text{out}}(t)$ 的时间变化一致（对 Crank–Nicolson 平均源项使用 $T_{\\text{out}}(t^n)$ 和 $T_{\\text{out}}(t^{n+1})$）。\n\n表面温度报告：\n- 室内侧边界的内表面温度 $T_{\\text{surf,in}}(t)$ 必须使用最后一个单元中心与室内空气之间的串联电阻关系报告：\n$$\nT_{\\text{surf,in}}(t) = \\frac{R_{\\text{cond}}\\,T_{\\text{room}}(t) + R_{\\text{conv}}\\,T_N(t)}{R_{\\text{cond}} + R_{\\text{conv}}},\n$$\n其中 $R_{\\text{cond}} = \\frac{\\Delta x_N}{2\\,k_N}$ 且 $R_{\\text{conv}} = \\frac{1}{h_{\\text{in}}}$。\n\n单位和角度约定：\n- 所有几何长度必须以米为单位。\n- 导热系数单位为 $\\mathrm{W/(m\\cdot K)}$，密度单位为 $\\mathrm{kg/m^3}$，热容单位为 $\\mathrm{J/(kg\\cdot K)}$，对流系数单位为 $\\mathrm{W/(m^2\\cdot K)}$。\n- 时间必须以秒为单位。\n- 报告的温度必须以摄氏度为单位。\n- 三角函数中的任何角度都必须以弧度表示。\n\n测试套件规范：\n实现程序以运行以下三个测试用例并产生所需的输出。在所有情况下，用均匀温度 $T(x,0) = T_0$ 初始化墙体，并使用提供的室外和室内条件。对于正弦强迫，定义 $T_{\\text{out}}(t) = T_{\\text{mean}} + A \\,\\sin\\left( 2\\pi\\,t/P \\right)$，其中 $P$ 是周期，角度以弧度为单位。\n\n- 测试用例 1（多层墙体，中等时间步长；正常路径）：\n  - 层（从外到内），每层都分割为给定数量的控制体，且每层内的 $\\Delta x$ 均匀：\n    - 砖：厚度 $0.15$ $\\mathrm{m}$，$k = 0.7$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 1800$ $\\mathrm{kg/m^3}$，$c = 840$ $\\mathrm{J/(kg\\cdot K)}$，$30$ 个单元。\n    - 绝缘层：厚度 $0.10$ $\\mathrm{m}$，$k = 0.035$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 30$ $\\mathrm{kg/m^3}$，$c = 1400$ $\\mathrm{J/(kg\\cdot K)}$，$20$ 个单元。\n    - 石膏板：厚度 $0.013$ $\\mathrm{m}$，$k = 0.25$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 950$ $\\mathrm{kg/m^3}$，$c = 1090$ $\\mathrm{J/(kg\\cdot K)}$，$5$ 个单元。\n  - 边界对流：$h_{\\text{out}} = 25$ $\\mathrm{W/(m^2\\cdot K)}$，$h_{\\text{in}} = 7$ $\\mathrm{W/(m^2\\cdot K)}$。\n  - 室外温度：$T_{\\text{out}}(t) = 10 + 5\\,\\sin\\!\\left( 2\\pi\\,t/86400 \\right)$ $\\mathrm{^\\circ C}$。\n  - 室内空气：$T_{\\text{room}}(t) = 20$ $\\mathrm{^\\circ C}$。\n  - 初始温度：$T_0 = 20$ $\\mathrm{^\\circ C}$。\n  - 时间积分：时间步长 $\\Delta t = 300$ $\\mathrm{s}$，最终时间 $t_{\\text{end}} = 21600$ $\\mathrm{s}$。\n  - 此用例的所需输出：在 $t_{\\text{end}}$ 时的内表面温度，单位为摄氏度，四舍五入到三位小数。\n\n- 测试用例 2（包含刚性层；边缘情况）：\n  - 层（从外到内）：\n    - 砖：厚度 $0.15$ $\\mathrm{m}$，$k = 0.7$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 1800$ $\\mathrm{kg/m^3}$，$c = 840$ $\\mathrm{J/(kg\\cdot K)}$，$30$ 个单元。\n    - 绝缘层：厚度 $0.10$ $\\mathrm{m}$，$k = 0.035$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 30$ $\\mathrm{kg/m^3}$，$c = 1400$ $\\mathrm{J/(kg\\cdot K)}$，$20$ 个单元。\n    - 铝箔：厚度 $0.001$ $\\mathrm{m}$，$k = 220$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 2700$ $\\mathrm{kg/m^3}$，$c = 900$ $\\mathrm{J/(kg\\cdot K)}$，$2$ 个单元。\n    - 石膏板：厚度 $0.013$ $\\mathrm{m}$，$k = 0.25$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 950$ $\\mathrm{kg/m^3}$，$c = 1090$ $\\mathrm{J/(kg\\cdot K)}$，$5$ 个单元。\n  - 边界对流：$h_{\\text{out}} = 25$ $\\mathrm{W/(m^2\\cdot K)}$，$h_{\\text{in}} = 7$ $\\mathrm{W/(m^2\\cdot K)}$。\n  - 室外温度：$T_{\\text{out}}(t) = 10 + 5\\,\\sin\\!\\left( 2\\pi\\,t/86400 \\right)$ $\\mathrm{^\\circ C}$。\n  - 室内空气：$T_{\\text{room}}(t) = 20$ $\\mathrm{^\\circ C}$。\n  - 初始温度：$T_0 = 20$ $\\mathrm{^\\circ C}$。\n  - 时间积分：时间步长 $\\Delta t = 600$ $\\mathrm{s}$，最终时间 $t_{\\text{end}} = 21600$ $\\mathrm{s}$。\n  - 此用例的所需输出：在 $t_{\\text{end}}$ 时的内表面温度，单位为摄氏度，四舍五入到三位小数。\n\n- 测试用例 3（通过参考解进行精度和数值阻尼评估；边界条件重点）：\n  - 单均质层（从外到内）：\n    - 混凝土：厚度 $0.20$ $\\mathrm{m}$，$k = 1.4$ $\\mathrm{W/(m\\cdot K)}$，$\\rho = 2200$ $\\mathrm{kg/m^3}$，$c = 880$ $\\mathrm{J/(kg\\cdot K)}$，$40$ 个单元。\n  - 边界对流：$h_{\\text{out}} = 30$ $\\mathrm{W/(m^2\\cdot K)}$，$h_{\\text{in}} = 10$ $\\mathrm{W/(m^2\\cdot K)}$。\n  - 室外温度：$T_{\\text{out}}(t) = 0 + 10\\,\\sin\\!\\left( 2\\pi\\,t/43200 \\right)$ $\\mathrm{^\\circ C}$ (周期 $P = 43200$ $\\mathrm{s}$)。\n  - 室内空气：$T_{\\text{room}}(t) = 0$ $\\mathrm{^\\circ C}$。\n  - 初始温度：$T_0 = 0$ $\\mathrm{^\\circ C}$。\n  - 时间积分：粗糙时间步长 $\\Delta t_{\\text{coarse}} = 2400$ $\\mathrm{s}$，精细参考时间步长 $\\Delta t_{\\text{fine}} = 200$ $\\mathrm{s}$，最终时间 $t_{\\text{end}} = 21600$ $\\mathrm{s}$。\n  - 此用例的所需输出：在 $t_{\\text{end}}$ 时，用粗糙时间步长计算的内表面温度与用精细时间步长计算的内表面温度之间的绝对差值，单位为摄氏度，四舍五入到三位小数。\n\n程序输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，结果按测试用例 $1, 2, 3$ 的顺序排列。对于测试用例 $1$ 和 $2$，条目必须是最终的内表面温度（单位为摄氏度）；对于测试用例 $3$，条目必须是粗糙结果和精细结果之间的绝对差值（单位为摄氏度）。每个条目必须四舍五入到三位小数。例如，一个可接受的输出格式是 $[x_1,x_2,x_3]$，其中每个 $x_i$ 是一个具有三位小数的浮点数。",
            "solution": "该问题要求推导并实现一个用于一维瞬态热传导通过多层墙体的数值模型。该模型将基于有限体积空间离散化和 Crank-Nicolson 时间积分方案。\n\n### 1. 空间离散化：半离散系统\n\n该模型的基础是应用于代表墙体的一系列离散控制体（CV）的能量守恒原理。我们将总厚度为 $L$ 的墙体离散化为 $N$ 个控制体。对于每个控制体 $i$，其中心位于位置 $x_i$，厚度为 $\\Delta x_i$，其热属性被假定为分段常数：密度 $\\rho_i$、比热容 $c_i$ 和导热系数 $k_i$。\n\n控制体 $i$（垂直于热流方向的单位面积）的一维热传导方程的积分形式为：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\rho c T(x,t) dx = q(x_{i-1/2},t) - q(x_{i+1/2},t)\n$$\n其中 $q$ 是热通量。假设温度 $T_i(t)$ 在控制体内是均匀的，这可简化为：\n$$\n(\\rho_i c_i \\Delta x_i) \\frac{dT_i}{dt} = q_{i-1/2} - q_{i+1/2}\n$$\n令 $C_i = \\rho_i c_i \\Delta x_i$ 为控制体 $i$ 的单位面积热容。方程为 $C_i \\frac{dT_i}{dt} = q_{i-1/2} - q_{i+1/2}$。\n\n界面处的通量使用热阻类比法建模。\n\n**内部控制体 ($1  < i < N$):**\n对于内部节点 $i$，从左侧（从节点 $i-1$）进入和向右侧（向节点 $i+1$）流出的热通量由温差除以单元中心之间的热阻给出。问题指定了界面热导 $G_{i-1/2}$ 和 $G_{i+1/2}$。\n从节点 $i-1$ 到 $i$ 的通量为 $q_{i-1/2} = G_{i-1/2}(T_{i-1} - T_i)$。\n从节点 $i$ 到 $i+1$ 的通量为 $q_{i+1/2} = G_{i+1/2}(T_i - T_{i+1})$。\n将这些代入能量平衡方程得到：\n$$\nC_i \\frac{dT_i}{dt} = G_{i-1/2}(T_{i-1} - T_i) - G_{i+1/2}(T_i - T_{i+1})\n$$\n$$\nC_i \\frac{dT_i}{dt} = G_{i-1/2} T_{i-1} - (G_{i-1/2} + G_{i+1/2}) T_i + G_{i+1/2} T_{i+1}\n$$\n\n**外部边界控制体 ($i=1$):**\n对于第一个节点，来自左侧的热通量是由于与室外空气在 $T_{\\text{out}}(t)$ 下的对流。如题目所给，$q_{\\text{left}} = \\frac{T_{\\text{out}}(t) - T_1}{R_{\\text{left}}}$，我们将其识别为 $q_{1/2}$。向右的通量为 $q_{1+1/2} = G_{1+1/2}(T_1 - T_2)$。\n能量平衡方程为：\n$$\nC_1 \\frac{dT_1}{dt} = \\frac{T_{\\text{out}}(t) - T_1}{R_{\\text{left}}} - G_{1+1/2}(T_1 - T_2)\n$$\n$$\nC_1 \\frac{dT_1}{dt} = -\\left(\\frac{1}{R_{\\text{left}}} + G_{1+1/2}\\right)T_1 + G_{1+1/2}T_2 + \\frac{T_{\\text{out}}(t)}{R_{\\text{left}}}\n$$\n\n**内部边界控制体 ($i=N$):**\n对于最后一个节点，来自左侧的通量为 $q_{N-1/2} = G_{N-1/2}(T_{N-1} - T_N)$。向右的通量是流向室内空气 $T_{\\text{room}}(t)$ 的。问题陈述 $q_{\\text{right}} = \\frac{T_{\\text{room}}(t) - T_N(t)}{R_{\\text{right}}}$。这是从室内进入节点的热通量。能量平衡方程为 $C_N \\frac{dT_N}{dt} = q_{N-1/2} + q_{\\text{right}}$。\n$$\nC_N \\frac{dT_N}{dt} = G_{N-1/2}(T_{N-1} - T_N) + \\frac{T_{\\text{room}}(t) - T_N}{R_{\\text{right}}}\n$$\n$$\nC_N \\frac{dT_N}{dt} = G_{N-1/2}T_{N-1} - \\left(G_{N-1/2} + \\frac{1}{R_{\\text{right}}}\\right)T_N + \\frac{T_{\\text{room}}(t)}{R_{\\text{right}}}\n$$\n\n**矩阵形式：**\n这个包含 $N$ 个常微分方程的系统可以写成矩阵形式：\n$$\n\\mathbf{C} \\frac{d\\mathbf{T}}{dt} = \\mathbf{K}\\mathbf{T} + \\mathbf{f}(t)\n$$\n其中：\n- $\\mathbf{T} = [T_1, T_2, \\dots, T_N]^T$ 是单元温度向量。\n- $\\mathbf{C}$ 是一个对角矩阵，其元素为热容：$C_{ii} = C_i = \\rho_i c_i \\Delta x_i$。\n- $\\mathbf{K}$ 是一个对称的三对角热导矩阵：\n  - $K_{i,i} = -(G_{i-1/2} + G_{i+1/2})$ for $1 < i < N$\n  - $K_{1,1} = -(\\frac{1}{R_{\\text{left}}} + G_{1+1/2})$\n  - $K_{N,N} = -(G_{N-1/2} + \\frac{1}{R_{\\text{right}}})$\n  - $K_{i,i+1} = K_{i+1,i} = G_{i+1/2}$ for $1 \\le i < N$\n- $\\mathbf{f}(t)$ 是来自边界条件的源向量：\n  - $f_1(t) = T_{\\text{out}}(t) / R_{\\text{left}}$\n  - $f_i(t) = 0$ for $1 < i < N$\n  - $f_N(t) = T_{\\text{room}}(t) / R_{\\text{right}}$\n\n### 2. 时间离散化：Crank-Nicolson 方案\n\n为了随时间求解这个常微分方程组，我们使用 Crank-Nicolson 方法。该方案是一种隐式方法，它将右侧项评估为当前时间步 $t^n$ 和下一个时间步 $t^{n+1} = t^n + \\Delta t$ 值的平均值。时间导数在中间点 $t^{n+1/2}$ 处用中心差分近似：\n$$\n\\mathbf{C} \\left( \\frac{\\mathbf{T}^{n+1} - \\mathbf{T}^n}{\\Delta t} \\right) = \\frac{1}{2} \\left[ (\\mathbf{K}\\mathbf{T}^n + \\mathbf{f}(t^n)) + (\\mathbf{K}\\mathbf{T}^{n+1} + \\mathbf{f}(t^{n+1})) \\right]\n$$\n我们的目标是求解未知的温度向量 $\\mathbf{T}^{n+1}$。我们通过将所有涉及 $\\mathbf{T}^{n+1}$ 的项移到左侧（LHS），将所有已知项（涉及 $\\mathbf{T}^n$）移到右侧（RHS）来重新整理方程。\n$$\n\\mathbf{C}(\\mathbf{T}^{n+1} - \\mathbf{T}^n) = \\frac{\\Delta t}{2} (\\mathbf{K}\\mathbf{T}^n + \\mathbf{K}\\mathbf{T}^{n+1} + \\mathbf{f}^n + \\mathbf{f}^{n+1})\n$$\n$$\n\\mathbf{C}\\mathbf{T}^{n+1} - \\frac{\\Delta t}{2}\\mathbf{K}\\mathbf{T}^{n+1} = \\mathbf{C}\\mathbf{T}^n + \\frac{\\Delta t}{2}\\mathbf{K}\\mathbf{T}^n + \\frac{\\Delta t}{2}(\\mathbf{f}^n + \\mathbf{f}^{n+1})\n$$\n在 LHS 上提出 $\\mathbf{T}^{n+1}$ 因子，在 RHS 上提出 $\\mathbf{T}^n$ 因子，得到每个时间步需要求解的最终线性系统：\n$$\n\\left( \\mathbf{C} - \\frac{\\Delta t}{2}\\mathbf{K} \\right) \\mathbf{T}^{n+1} = \\left( \\mathbf{C} + \\frac{\\Delta t}{2}\\mathbf{K} \\right) \\mathbf{T}^n + \\frac{\\Delta t}{2} (\\mathbf{f}^n + \\mathbf{f}^{n+1})\n$$\n这是一个形如 $\\mathbf{A} \\mathbf{x} = \\mathbf{b}$ 的线性系统，其中：\n- $\\mathbf{A} = \\mathbf{C} - \\frac{\\Delta t}{2}\\mathbf{K}$ 是 LHS 矩阵。由于 $\\mathbf{C}$ 是对角的，$\\mathbf{K}$ 是三对角的，因此 $\\mathbf{A}$ 也是三对角的。\n- $\\mathbf{x} = \\mathbf{T}^{n+1}$ 是下一个时间步的未知温度向量。\n- $\\mathbf{b}$ 是 RHS 向量，由已知量构成。\n\n### 3. 数值特性与实现\n\n选择 Crank-Nicolson 方案是因为其具有理想的数值特性。它在时间上是二阶精确的，意味着时间离散化误差随 $(\\Delta t)^2$ 减小，这比像显式或隐式 Euler 这样的一阶方案有所改进。关键的是，它是 A-稳定的，意味着对于线性热传导方程，无论时间步长 $\\Delta t$ 相对于空间网格尺寸 $\\Delta x_i$ 的大小如何，它都是无条件稳定的。这对于具有“刚性”空间特征的问题尤其重要，例如测试用例 2 中的薄而高导热的铝层，这会给条件稳定的显式方法施加极其小的时间步长限制。\n\n然而，尽管该方法是稳定的，但它并非完全 L-稳定。对于大的时间步长，解的高频分量（通常由急剧的初始条件或边界强迫引起）没有被强烈阻尼，这可能导致持续的、非物理的振荡。其精度虽然形式上是二阶的，但仍取决于 $\\Delta t$ 是否足够小以解析物理动态。测试用例 3 旨在探究这一点，通过比较粗糙时间步长和精细时间步长来量化时间误差。\n\n实现算法如下：\n1.  **设置：** 根据给定的分层墙体结构，为所有 $N$ 个控制体构建属性数组 $(\\rho_i, c_i, k_i, \\Delta x_i)$。\n2.  **矩阵组装：**\n    -   计算界面热导 $G_{i+1/2}$ 和边界热阻 $R_{\\text{left}}, R_{\\text{right}}$。\n    -   构建电容矩阵 $\\mathbf{C}$ 和电导矩阵 $\\mathbf{K}$ 的对角线。\n    -   形成 LHS 三对角矩阵 $\\mathbf{A} = \\mathbf{C} - \\frac{\\Delta t}{2}\\mathbf{K}$ 的三个对角线。\n    -   形成 RHS 矩阵乘子 $\\mathbf{B} = \\mathbf{C} + \\frac{\\Delta t}{2}\\mathbf{K}$ 的三个对角线。\n3.  **时间积分：**\n    -   用初始条件 $T_0$ 初始化温度向量 $\\mathbf{T}$。\n    -   从 $t=0$ 迭代到 $t_{\\text{end}}$：\n        a. 使用 $T_{\\text{out}}(t^n)$ 和 $T_{\\text{out}}(t^{n+1})$ 计算源向量 $\\mathbf{f}^n$ 和 $\\mathbf{f}^{n+1}$。\n        b. 计算 RHS 向量 $\\mathbf{b} = \\mathbf{B} \\mathbf{T}^n + \\frac{\\Delta t}{2}(\\mathbf{f}^n + \\mathbf{f}^{n+1})$。矩阵-向量乘积 $\\mathbf{B} \\mathbf{T}^n$ 使用存储的 $\\mathbf{B}$ 的对角线高效执行。\n        c. 求解三对角线性系统 $\\mathbf{A} \\mathbf{T}^{n+1} = \\mathbf{b}$ 以得到 $\\mathbf{T}^{n+1}$。这可以通过托马斯算法（或像 `scipy.linalg.solve_banded` 这样的库等效方法）高效完成。\n        d. 更新 $\\mathbf{T}^n \\leftarrow \\mathbf{T}^{n+1}$。\n4.  **最终计算：** 在最后一个时间步之后，使用最后的节点温度 $T_N(t_{\\text{end}})$，根据所提供的串联电阻公式计算内表面温度 $T_{\\text{surf,in}}$。\n\n这种基于原理的结构化方法确保了解决方案的正确性和鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and run the thermal simulation.\n    \"\"\"\n    \n    # Test Case 1: Multilayer wall, moderate time step\n    case1_params = {\n        \"layers\": [\n            {\"thick\": 0.15, \"k\": 0.7, \"rho\": 1800, \"c\": 840, \"cells\": 30},  # Brick\n            {\"thick\": 0.10, \"k\": 0.035, \"rho\": 30, \"c\": 1400, \"cells\": 20}, # Insulation\n            {\"thick\": 0.013, \"k\": 0.25, \"rho\": 950, \"c\": 1090, \"cells\": 5}   # Gypsum\n        ],\n        \"h_out\": 25.0,\n        \"h_in\": 7.0,\n        \"T_out_func\": lambda t: 10.0 + 5.0 * np.sin(2.0 * np.pi * t / 86400.0),\n        \"T_room\": 20.0,\n        \"T0\": 20.0,\n        \"dt\": 300.0,\n        \"t_end\": 21600.0\n    }\n\n    # Test Case 2: Stiff layer included\n    case2_params = {\n        \"layers\": [\n            {\"thick\": 0.15, \"k\": 0.7, \"rho\": 1800, \"c\": 840, \"cells\": 30},   # Brick\n            {\"thick\": 0.10, \"k\": 0.035, \"rho\": 30, \"c\": 1400, \"cells\": 20},  # Insulation\n            {\"thick\": 0.001, \"k\": 220, \"rho\": 2700, \"c\": 900, \"cells\": 2}, # Aluminum Foil\n            {\"thick\": 0.013, \"k\": 0.25, \"rho\": 950, \"c\": 1090, \"cells\": 5}    # Gypsum\n        ],\n        \"h_out\": 25.0,\n        \"h_in\": 7.0,\n        \"T_out_func\": lambda t: 10.0 + 5.0 * np.sin(2.0 * np.pi * t / 86400.0),\n        \"T_room\": 20.0,\n        \"T0\": 20.0,\n        \"dt\": 600.0,\n        \"t_end\": 21600.0\n    }\n\n    # Test Case 3: Accuracy assessment\n    case3_params = {\n        \"layers\": [\n            {\"thick\": 0.20, \"k\": 1.4, \"rho\": 2200, \"c\": 880, \"cells\": 40} # Concrete\n        ],\n        \"h_out\": 30.0,\n        \"h_in\": 10.0,\n        \"T_out_func\": lambda t: 0.0 + 10.0 * np.sin(2.0 * np.pi * t / 43200.0),\n        \"T_room\": 0.0,\n        \"T0\": 0.0,\n        \"dt_coarse\": 2400.0,\n        \"dt_fine\": 200.0,\n        \"t_end\": 21600.0\n    }\n\n    results = []\n\n    # Run Case 1\n    result1 = run_simulation(case1_params)\n    results.append(round(result1, 3))\n\n    # Run Case 2\n    result2 = run_simulation(case2_params)\n    results.append(round(result2, 3))\n    \n    # Run Case 3\n    params_coarse = case3_params.copy()\n    params_coarse[\"dt\"] = case3_params[\"dt_coarse\"]\n    result_coarse = run_simulation(params_coarse)\n\n    params_fine = case3_params.copy()\n    params_fine[\"dt\"] = case3_params[\"dt_fine\"]\n    result_fine = run_simulation(params_fine)\n    \n    result3 = abs(result_coarse - result_fine)\n    results.append(round(result3, 3))\n    \n    # Print final output in the required format\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef run_simulation(params):\n    \"\"\"\n    Executes the Crank-Nicolson simulation for a given set of parameters.\n    \"\"\"\n    layers = params[\"layers\"]\n    h_out, h_in = params[\"h_out\"], params[\"h_in\"]\n    T_out_func, T_room = params[\"T_out_func\"], params[\"T_room\"]\n    T0, dt, t_end = params[\"T0\"], params[\"dt\"], params[\"t_end\"]\n\n    # 1. Spatial Discretization\n    N = sum(layer[\"cells\"] for layer in layers)\n    dx = np.zeros(N)\n    k = np.zeros(N)\n    rho_c = np.zeros(N)\n\n    cell_idx = 0\n    for layer in layers:\n        layer_dx = layer[\"thick\"] / layer[\"cells\"]\n        for i in range(layer[\"cells\"]):\n            dx[cell_idx] = layer_dx\n            k[cell_idx] = layer[\"k\"]\n            rho_c[cell_idx] = layer[\"rho\"] * layer[\"c\"]\n            cell_idx += 1\n\n    # 2. Matrix Assembly\n    # Thermal Capacitance Vector (Diagonal of C matrix)\n    C_diag = rho_c * dx\n\n    # Conductance Matrix K (as three diagonals)\n    K_main = np.zeros(N)\n    K_upper = np.zeros(N - 1)\n    K_lower = np.zeros(N - 1)\n\n    # Interface Conductances G\n    G = np.zeros(N - 1)\n    for i in range(N - 1):\n        R1 = dx[i] / (2 * k[i])\n        R2 = dx[i+1] / (2 * k[i+1])\n        G[i] = 1.0 / (R1 + R2)\n        \n    # Fill in diagonals of K\n    # Internal nodes\n    K_main[1:-1] = -(G[:-1] + G[1:])\n    K_upper[:] = G\n    K_lower[:] = G\n\n    # Boundary nodes\n    R_left = dx[0] / (2 * k[0]) + 1.0 / h_out\n    R_right = dx[N-1] / (2 * k[N-1]) + 1.0 / h_in\n    K_main[0] = -(1.0 / R_left + G[0])\n    K_main[N-1] = -(G[N-2] + 1.0 / R_right)\n\n    # Crank-Nicolson Matrices\n    # LHS Matrix: A = C - dt/2 * K\n    A_banded = np.zeros((3, N))\n    A_banded[0, 1:] = -0.5 * dt * K_upper\n    A_banded[1, :] = C_diag - 0.5 * dt * K_main\n    A_banded[2, :-1] = -0.5 * dt * K_lower\n\n    # RHS Matrix: B = C + dt/2 * K\n    B_main = C_diag + 0.5 * dt * K_main\n    B_upper = 0.5 * dt * K_upper\n    B_lower = 0.5 * dt * K_lower\n\n    # 3. Time Integration\n    T = np.full(N, T0)\n    times = np.arange(0, t_end + dt, dt)\n\n    for i in range(len(times) - 1):\n        t_n, t_n1 = times[i], times[i+1]\n\n        # Source vectors f\n        f_n = np.zeros(N)\n        f_n[0] = T_out_func(t_n) / R_left\n        f_n[-1] = T_room / R_right\n        \n        f_n1 = np.zeros(N)\n        f_n1[0] = T_out_func(t_n1) / R_left\n        f_n1[-1] = T_room / R_right\n\n        # RHS vector: b = B*T_n + dt/2 * (f_n + f_n1)\n        # B*T_n product (tridiagonal)\n        b_mat_prod = np.zeros(N)\n        b_mat_prod[0] = B_main[0] * T[0] + B_upper[0] * T[1]\n        b_mat_prod[1:-1] = B_lower[:-1] * T[:-2] + B_main[1:-1] * T[1:-1] + B_upper[1:] * T[2:]\n        b_mat_prod[-1] = B_lower[-1] * T[-2] + B_main[-1] * T[-1]\n        \n        b = b_mat_prod + 0.5 * dt * (f_n + f_n1)\n\n        # Solve linear system A * T_n1 = b\n        T = solve_banded((1, 1), A_banded, b)\n\n    # 4. Final Calculation\n    T_N = T[-1]\n    R_cond_N = dx[N-1] / (2 * k[N-1])\n    R_conv_in = 1.0 / h_in\n    T_surf_in = (R_cond_N * T_room + R_conv_in * T_N) / (R_cond_N + R_conv_in)\n    \n    return T_surf_in\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}