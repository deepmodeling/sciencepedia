{
    "hands_on_practices": [
        {
            "introduction": "经济调度是电力系统运行的核心，其最基本的形式是在单个母线系统上展开。这个练习将带你掌握具有更贴近实际的二次成本函数和发电机出力限制的经济调度问题。通过从第一性原理出发，推导并应用 Karush-Kuhn-Tucker (KKT) 条件，你将学会如何系统地求解当一个或多个机组达到其出力上限或下限时的最优发电组合，这是理解电力市场定价和机组承诺的基础。",
            "id": "4086798",
            "problem": "一个火力发电系统拥有三个可调度机组，其生产成本是严格凸的二次函数。对于机组 $i \\in \\{1,2,3\\}$，其成本为 $C_i(P_i) = \\alpha_i P_i^2 + \\beta_i P_i + \\gamma_i$ 美元/小时，其中 $P_i$ 是以兆瓦为单位的功率输出。系统总需求为 $D = 120$，每个机组的功率输出必须满足 $0 \\leq P_i \\leq \\overline{P}_i$。数据如下：\n- 机组 1：$\\alpha_1 = 0.05$，$\\beta_1 = 14$，$\\gamma_1 = 100$，$\\overline{P}_1 = 50$。\n- 机组 2：$\\alpha_2 = 0.10$，$\\beta_2 = 10$，$\\gamma_2 = 120$，$\\overline{P}_2 = 35$。\n- 机组 3：$\\alpha_3 = 0.08$，$\\beta_3 = 12$，$\\gamma_3 = 60$，$\\overline{P}_3 = 70$。\n\n使用凸优化和拉格朗日对偶的基本原理，将此经济调度问题构建为一个凸规划。从此模型推导出 Karush–Kuhn–Tucker (KKT) 最优性条件，并计算唯一的原始-对偶最优解 $\\{P_1^\\star, P_2^\\star, P_3^\\star, \\lambda^\\star\\}$，其中 $\\lambda^\\star$ 是与功率平衡约束相关的最优拉格朗日乘子。确定在最优解处哪个不等式约束是激活的，并通过显式计算与该激活边界相关的拉格朗日乘子来验证互补松弛性。\n\n在适当的情况下，将最终数值结果表示为精确的既约分数。将拉格朗日乘子的值以美元/兆瓦时（USD/MWh）表示，各机组的调度出力以兆瓦（MW）表示。请将您的最终答案以单行矩阵的形式给出，顺序为 $\\left(\\lambda^\\star, P_1^\\star, P_2^\\star, P_3^\\star\\right)$。最终答案框中不包含单位。无需四舍五入。",
            "solution": "经济调度的目标是在满足需求和遵守机组容量限制的前提下，最小化总生产成本。该问题基于以下原理：\n- 总成本是可分離的，并且对于每个 $P_i$ 都是严格凸的，因为对所有 $i$ 都有 $\\alpha_i  0$。\n- 由线性等式和不等式约束定义的可行集是凸的。\n- 对于具有仿射约束和严格可行点（Slater 条件）的严格凸规划问题，强对偶性成立，这确保了 Karush–Kuhn–Tucker (KKT) 条件是最优性的充分必要条件。\n\n模型构建：\n最小化 $\\sum_{i=1}^{3} C_i(P_i)$，并满足以下约束条件\n- $\\sum_{i=1}^{3} P_i = D$，\n- $0 \\leq P_i \\leq \\overline{P}_i$，对于 $i \\in \\{1,2,3\\}$。\n\n根据给定数据，问题为：\n最小化\n$$\nC_1(P_1) + C_2(P_2) + C_3(P_3) = 0.05 P_1^2 + 14 P_1 + 100 + 0.10 P_2^2 + 10 P_2 + 120 + 0.08 P_3^2 + 12 P_3 + 60\n$$\n约束条件为\n$$\nP_1 + P_2 + P_3 = 120, \\quad 0 \\leq P_1 \\leq 50, \\quad 0 \\leq P_2 \\leq 35, \\quad 0 \\leq P_3 \\leq 70.\n$$\n\n拉格朗日函数和 KKT 条件：\n为等式约束引入拉格朗日乘子 $\\lambda$，并分别为下界和上界引入非负乘子 $\\mu_i^{-}$ 和 $\\mu_i^{+}$。拉格朗日函数为\n$$\n\\mathcal{L}(P_1, P_2, P_3, \\lambda, \\mu^{-}, \\mu^{+}) = \\sum_{i=1}^{3} C_i(P_i) + \\lambda \\left(D - \\sum_{i=1}^{3} P_i \\right) + \\sum_{i=1}^{3} \\mu_i^{-} (0 - P_i) + \\sum_{i=1}^{3} \\mu_i^{+} (P_i - \\overline{P}_i).\n$$\nKarush–Kuhn–Tucker (KKT) 条件如下：\n1. 原始可行性：$P_1 + P_2 + P_3 = 120$，且 $0 \\leq P_i \\leq \\overline{P}_i$。\n2. 对偶可行性：$\\mu_i^{-} \\geq 0$，$\\mu_i^{+} \\geq 0$。\n3. 平稳性条件：\n$$\n\\frac{\\partial C_i}{\\partial P_i}(P_i) - \\lambda - \\mu_i^{-} + \\mu_i^{+} = 0, \\quad i \\in \\{1,2,3\\}.\n$$\n已知 $C_i(P_i) = \\alpha_i P_i^2 + \\beta_i P_i + \\gamma_i$，边际成本为\n$$\n\\frac{\\partial C_1}{\\partial P_1} = 2 \\cdot 0.05 P_1 + 14 = 0.10 P_1 + 14, \\quad \\frac{\\partial C_2}{\\partial P_2} = 2 \\cdot 0.10 P_2 + 10 = 0.20 P_2 + 10, \\quad \\frac{\\partial C_3}{\\partial P_3} = 2 \\cdot 0.08 P_3 + 12 = 0.16 P_3 + 12.\n$$\n4. 互补松弛性：\n$$\n\\mu_i^{-} P_i = 0, \\quad \\mu_i^{+} (P_i - \\overline{P}_i) = 0, \\quad i \\in \\{1,2,3\\}.\n$$\n\n确定激活集：\n首先，忽略不等式约束，并令边际成本相等：\n假设对所有 $i$ 都有 $\\mu_i^{-}=\\mu_i^{+}=0$。那么平稳性条件给出 $0.10 P_1 + 14 = \\lambda$，$0.20 P_2 + 10 = \\lambda$，$0.16 P_3 + 12 = \\lambda$，即\n$$\nP_1 = 10 \\lambda - 140, \\quad P_2 = 5 \\lambda - 50, \\quad P_3 = 6.25 \\lambda - 75.\n$$\n代入功率平衡约束：\n$$\n(10 \\lambda - 140) + (5 \\lambda - 50) + (6.25 \\lambda - 75) = 120 \\;\\Rightarrow\\; 21.25 \\lambda - 265 = 120 \\;\\Rightarrow\\; \\lambda = \\frac{385}{21.25} = \\frac{308}{17}.\n$$\n对应的 $P_2$ 是\n$$\nP_2 = 5 \\cdot \\frac{308}{17} - 50 = \\frac{1540}{17} - 50 = \\frac{690}{17} \\approx 40.588,\n$$\n这违反了 $P_2 \\leq 35$ 的约束。因此，在最优解处，机组2的上界约束是激活的：$P_2^\\star = \\overline{P}_2 = 35$ 且 $\\mu_2^{+}  0$。\n\n在激活约束 $P_2 = 35$ 下求解：\n对于 $i \\in \\{1,3\\}$，如果它们的边界约束未激活，则 $\\mu_i^{-}=\\mu_i^{+}=0$，平稳性条件得出\n$$\n0.10 P_1 + 14 = \\lambda, \\quad 0.16 P_3 + 12 = \\lambda.\n$$\n因此\n$$\nP_1 = 10 \\lambda - 140, \\quad P_3 = 6.25 \\lambda - 75.\n$$\n应用功率平衡约束，其中 $P_2 = 35$：\n$$\nP_1 + P_3 + 35 = 120 \\;\\Rightarrow\\; (10 \\lambda - 140) + (6.25 \\lambda - 75) + 35 = 120.\n$$\n化简得\n$$\n16.25 \\lambda - 180 = 120 \\;\\Rightarrow\\; 16.25 \\lambda = 300 \\;\\Rightarrow\\; \\lambda^\\star = \\frac{300}{16.25} = \\frac{1200}{65} = \\frac{240}{13}.\n$$\n则\n$$\nP_1^\\star = 10 \\lambda^\\star - 140 = 10 \\cdot \\frac{240}{13} - 140 = \\frac{2400}{13} - \\frac{1820}{13} = \\frac{580}{13},\n$$\n$$\nP_3^\\star = 6.25 \\lambda^\\star - 75 = \\frac{25}{4} \\cdot \\frac{240}{13} - 75 = \\frac{1500}{13} - \\frac{975}{13} = \\frac{525}{13}.\n$$\n检查边界约束：$P_1^\\star = \\frac{580}{13} \\approx 44.615 \\in (0,50)$，$P_3^\\star = \\frac{525}{13} \\approx 40.385 \\in (0,70)$；因此它们的边界约束未激活，这与 $\\mu_1^{-}=\\mu_1^{+}=\\mu_3^{-}=\\mu_3^{+}=0$ 的假设一致。\n\n对激活边界的互补松弛性验证：\n对于机组2，在 $P_2^\\star = \\overline{P}_2 = 35$ 时，平稳性条件为\n$$\n(0.20 P_2^\\star + 10) - \\lambda^\\star - \\mu_2^{-} + \\mu_2^{+} = 0.\n$$\n由于 $P_2^\\star=350$，下界约束未激活，我们有 $\\mu_2^{-}=0$。因此，\n$$\n\\mu_2^{+} = \\lambda^\\star - (0.20 P_2^\\star + 10) = \\frac{240}{13} - (0.20 \\cdot 35 + 10) = \\frac{240}{13} - 17 = \\frac{19}{13} \\geq 0.\n$$\n互补松弛性成立：$\\mu_2^{+} (P_2^\\star - \\overline{P}_2) = \\frac{19}{13} \\cdot 0 = 0$；对于机组1和3，$\\mu_i^{\\pm}=0$ 且 $P_i^\\star$ 严格位于边界内，所以 $\\mu_i^{-} P_i^\\star = 0$ 和 $\\mu_i^{+} (P_i^\\star - \\overline{P}_i) = 0$ 也被满足。\n\n对非绑定机组的边际成本均等化检验：\n检验 $0.10 P_1^\\star + 14 = \\frac{0.10 \\cdot 580}{13} + 14 = \\frac{58}{13} + \\frac{182}{13} = \\frac{240}{13} = \\lambda^\\star$，以及 $0.16 P_3^\\star + 12 = \\frac{0.16 \\cdot 525}{13} + 12 = \\frac{84}{13} + \\frac{156}{13} = \\frac{240}{13} = \\lambda^\\star$，这符合当边界约束未激活时的平稳性条件。\n\n唯一性：\n因为目标函数是严格凸的，且可行集是非空凸集，所以KKT解是唯一的。\n\n因此，唯一的原始-对偶最优解对是\n$$\n\\lambda^\\star = \\frac{240}{13}, \\quad P_1^\\star = \\frac{580}{13}, \\quad P_2^\\star = 35, \\quad P_3^\\star = \\frac{525}{13},\n$$\n其中机组2的上界约束被激活，相关的乘子为 $\\mu_2^{+} = \\frac{19}{13}$。",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{240}{13}  \\frac{580}{13}  35  \\frac{525}{13}\\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了单母线系统的调度后，下一步是将其扩展到更真实的电网环境中。这个动手实践将引导你进入直流最优潮流 (DC Optimal Power Flow, DC-OPF) 的世界，这是一个在电力市场分析中广泛应用的强大工具。通过为一个三母线系统编写求解程序，你将不仅需要最小化总发电成本，还必须遵守输电线路的物理限制，从而亲身体会输电阻塞如何产生以及它如何导致不同地点的电价——即节点边际电价 (Locational Marginal Prices, LMPs)——出现差异。",
            "id": "4086771",
            "problem": "您必须编写一个完整、可运行的程序，该程序为一个三母线网络求解直流最优潮流（DC OPF）问题，该问题包含线性发电机成本、发电机容量限制、节点功率平衡约束以及单一输电线路潮流限制。该问题以纯数学术语提出，并且必须使用直流潮流的第一性原理建模来解决。物理功率量单位必须是兆瓦（MW），相角单位为弧度，价格单位为美元/兆瓦（$/MW）。\n\n基本基准和定义：\n- 在直流潮流近似下，线路 $(i,j)$ 上的有功功率潮流由 $P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $\\theta_i$ 和 $\\theta_j$ 是母线电压相角，单位为弧度，而 $b_{ij}$ 是根据系统基准标幺化的线路电纳。\n- 母线 $i$ 处的节点功率平衡由 $p_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$ 给出，其中 $p_i$ 是母线 $i$ 处的净注入功率，等于发电功率减去负荷需求，即 $p_i = P_i - D_i$。\n- 每个母线处的基尔霍夫电流定律确保了所有接入线路的潮流之和等于净注入功率。\n- 经济调度旨在满足上述物理约束的同时，最小化总发电成本。\n\n网络规范：\n- 三个母线，标记为 $1$、$2$ 和 $3$。\n- 线路：$(1,2)$、$(1,3)$、$(2,3)$。\n- 在 $100$ 兆伏安（MVA）基准下的电抗标幺值：$x_{12} = 0.25$，$x_{13} = 0.25$，$x_{23} = 0.50$。当电压幅值接近 $1$ 标幺值并使用基准功率时，有效电纳（单位 MW/rad）为 $b_{12} = \\frac{1}{x_{12}} \\cdot 100 = 400$，$b_{13} = \\frac{1}{x_{13}} \\cdot 100 = 400$，$b_{23} = \\frac{1}{x_{23}} \\cdot 100 = 200$。\n- 母线电纳矩阵 $B_{\\text{bus}}$（单位 MW/rad）为：\n$$\nB_{\\text{bus}} =\n\\begin{bmatrix}\n800  -400  -400 \\\\\n-400  600  -200 \\\\\n-400  -200  600\n\\end{bmatrix}。\n$$\n- 参考（平衡）母线是母线 $1$，其相角固定为 $\\theta_1 = 0$ 弧度。\n\n发电机：\n- 每个母线一台发电机，具有线性成本函数 $C_i(P_i) = c_i P_i$，其中对于母线 $1$、$2$ 和 $3$，成本系数 $c = [10, 12, 30]$（单位 $/MW）。\n- 发电机容量限制：$P^{\\max} = [100, 100, 50]$ MW 和 $P^{\\min} = [0, 0, 0]$ MW。\n\n约束条件：\n- 节点功率平衡（对于 $i = 1,2,3$）：$P_i - D_i = \\sum_j b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n- 平衡母线相角：$\\theta_1 = 0$ 弧度。\n- 线路 $(1,2)$ 有一个热潮流限制 $\\left| P_{12} \\right| \\leq F_{12}^{\\max}$，其中 $F_{12}^{\\max} = 40$ MW。其他线路没有有功潮流限制。\n- 发电机边界：$0 \\leq P_i \\leq P_i^{\\max}$。\n\n目标：\n- 最小化总成本 $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$。\n\n每个测试案例要求的输出：\n- 最优发电向量 $[P_1, P_2, P_3]$，单位 MW。\n- 线路潮流 $[P_{12}, P_{13}, P_{23}]$，单位 MW，计算公式为 $P_{12} = b_{12}(\\theta_1 - \\theta_2)$、$P_{13} = b_{13}(\\theta_1 - \\theta_3)$、$P_{23} = b_{23}(\\theta_2 - \\theta_3)$。\n- 节点边际电价（LMP）$[\\lambda_1, \\lambda_2, \\lambda_3]$，单位 $/MW，其中 $\\lambda_i$ 对应于母线 $i$ 处节点功率平衡的影子价格。\n\n所有相角必须以弧度为单位。所有功率必须以 MW 为单位。所有价格必须以 $/MW 为单位。输出中不允许使用其他单位。\n\n需实现的公式：\n- 决策变量为 $[P_1, P_2, P_3, \\theta_2, \\theta_3]$，其中 $\\theta_1 = 0$ 固定。\n- 从节点平衡推导出的等式约束（代入 $\\theta_1 = 0$）：\n$$\n\\begin{aligned}\nP_1 - D_1 + b_{12} \\theta_2 + b_{13} \\theta_3 = 0, \\\\\nP_2 - D_2 - (b_{12} + b_{23}) \\theta_2 + b_{23} \\theta_3 = 0, \\\\\nP_3 - D_3 + b_{23} \\theta_2 - (b_{13} + b_{23}) \\theta_3 = 0.\n\\end{aligned}\n$$\n- 针对线路 $(1,2)$ 的单一线路限制的不等式约束：\n$$\n-b_{12} \\theta_2 \\le F_{12}^{\\max}, \\quad b_{12} \\theta_2 \\le F_{12}^{\\max}.\n$$\n- 发电机边界：$0 \\le P_1 \\le 100$，$0 \\le P_2 \\le 100$，$0 \\le P_3 \\le 50$。相角变量 $\\theta_2, \\theta_3$ 除了由等式和线路约束所隐含的限制外，是无约束的。\n\n测试套件：\n- 案例 $1$：负荷 $D = [50, 50, 50]$ MW。\n- 案例 $2$：负荷 $D = [30, 120, 30]$ MW。\n- 案例 $3$：负荷 $D = [90, 110, 50]$ MW。\n\n您的程序应为每个测试案例求解 DC OPF，提取最优的 $[P_1, P_2, P_3]$，计算 $[P_{12}, P_{13}, P_{23}]$，并获得节点影子价格 $[\\lambda_1, \\lambda_2, \\lambda_3]$。最终输出必须是单行，包含一个由三个内部列表组成的逗号分隔列表，每个内部列表对应一个测试案例，不含空格，格式完全如下：\n\"[ [P1_case1,P2_case1,P3_case1,P12_case1,P13_case1,P23_case1,lambda1_case1,lambda2_case1,lambda3_case1], [P1_case2,P2_case2,P3_case2,P12_case2,P13_case2,P23_case2,lambda1_case2,lambda2_case2,lambda3_case2], [P1_case3,P2_case3,P3_case3,P12_case3,P13_case3,P23_case3,lambda1_case3,lambda2_case3,lambda3_case3] ]\"\n为避免歧义，您的程序应精确地产生单行输出，其中包含一个顶级列表，该列表包含三个逗号分隔的内部列表，每个内部列表包含九个数字，打印的字符串中任何位置都不能有空格。所有值都必须表示为标准十进制数。",
            "solution": "用户提供的问题陈述已经过严格评估，并被确定为**有效**。\n\n### 步骤 1：提取已知条件\n\n- **基本物理模型**：问题基于直流（DC）潮流近似。\n  - 线路有功功率潮流：$P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n  - 节点功率平衡：$p_i = P_i - D_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$。\n- **网络数据**：\n  - 母线：$3$ 个（标记为 $1, 2, 3$）。\n  - 线路：$(1,2), (1,3), (2,3)$。\n  - 基准功率：$100$ MVA。\n  - 线路电抗（标幺值）：$x_{12} = 0.25$，$x_{13} = 0.25$，$x_{23} = 0.50$。\n  - 线路电纳（MW/rad）：$b_{12} = 400$，$b_{13} = 400$，$b_{23} = 200$。\n  - 母线电纳矩阵 $B_{\\text{bus}}$（MW/rad）：\n    $$\n    B_{\\text{bus}} =\n    \\begin{bmatrix}\n    800  -400  -400 \\\\\n    -400  600  -200 \\\\\n    -400  -200  600\n    \\end{bmatrix}。\n    $$\n- **参考母线**：母线 $1$ 是平衡母线，其电压相角固定：$\\theta_1 = 0$ 弧度。\n- **发电机数据**：\n  - 线性成本函数：$C_i(P_i) = c_i P_i$。\n  - 成本系数：$c = [10, 12, 30]$（$/MW），分别对应于母线 $1, 2, 3$ 上的发电机。\n  - 容量限制：$P^{\\min} = [0, 0, 0]$ MW，$P^{\\max} = [100, 100, 50]$ MW。\n- **约束条件**：\n  - 每个母线的功率平衡方程。\n  - 线路 $(1,2)$ 的单一热限制：$|P_{12}| \\leq 40$ MW。\n  - 发电机输出限制：$0 \\leq P_i \\leq P_i^{\\max}$。\n- **目标函数**：最小化总发电成本 $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$。\n- **决策变量**：$[P_1, P_2, P_3, \\theta_2, \\theta_3]$。\n- **测试案例（负荷）**：\n  - 案例 1：$D = [50, 50, 50]$ MW。\n  - 案例 2：$D = [30, 120, 30]$ MW。\n  - 案例 3：$D = [90, 110, 50]$ MW。\n- **要求输出**：最优发电量 $[P_1, P_2, P_3]$、线路潮流 $[P_{12}, P_{13}, P_{23}]$ 和节点边际电价（LMP）$[\\lambda_1, \\lambda_2, \\lambda_3]$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n根据指定标准对问题进行评估：\n- **科学依据**：直流最优潮流（DC OPF）是电力系统工程中用于经济分析的一种标准、广泛使用且易于理解的方法。该公式具有科学合理性。\n- **适定性**：该问题是一个线性规划（LP），其特点是线性目标函数和一组线性等式及不等式约束。因此，它是一个凸优化问题，只要存在可行解，就具有唯一的最小成本。所提供的负荷相对于发电容量似乎是合理的。\n- **客观性**：问题使用精确的数学和工程术语陈述，所有常数和参数都已明确定义。没有主观或含糊不清的语言。\n- **完整性与一致性**：所有必要的数据（网络拓扑、阻抗、成本、限制、负荷）都已提供。从电抗导出电纳的计算是正确的（$b=1/x \\cdot 100$）。提供的 $B_{\\text{bus}}$ 矩阵与线路电纳一致。指定的功率平衡方程对于给定的网络和所选的平衡母线是正确的。问题是自包含且内部一致的。\n\n### 步骤 3：结论与行动\n\n该问题是**有效的**。它是一个标准的 DC OPF 问题，可以使用线性规划来解决。解决方法是构建标准 LP 形式的问题，并为每个测试案例进行求解。\n\n### 求解方案构建\n\nDC OPF 问题将被构建为一个标准形式的线性规划（LP）问题，可以使用 `scipy.optimize.linprog` 进行求解：\n$$\n\\begin{align*}\n\\min_{x} \\quad  c^T x \\\\\n\\text{s.t.} \\quad  A_{eq} x = b_{eq} \\\\\n A_{ub} x \\leq b_{ub} \\\\\n lb \\leq x \\leq ub\n\\end{align*}\n$$\n\n**1. 决策变量 ($x$)**\n决策变量向量 $x$ 包括发电机有功功率输出和非参考母线的电压相角：\n$$x = [P_1, P_2, P_3, \\theta_2, \\theta_3]^T$$\n\n**2. 目标函数 ($c^T x$)**\n目标是最小化总发电成本，$C_{\\text{total}} = 10 P_1 + 12 P_2 + 30 P_3$。母线相角没有成本。因此，成本向量 $c$ 为：\n$$c = [10, 12, 30, 0, 0]^T$$\n\n**3. 等式约束 ($A_{eq} x = b_{eq}$)**\n节点功率平衡方程构成等式约束。给定 $\\theta_1=0$，问题陈述中提供的方程被重新排列以适应标准形式：\n$$P_1 - D_1 + b_{12}\\theta_2 + b_{13}\\theta_3 = 0 \\implies 1 \\cdot P_1 + 0 \\cdot P_2 + 0 \\cdot P_3 + 400 \\cdot \\theta_2 + 400 \\cdot \\theta_3 = D_1$$\n$$P_2 - D_2 - (b_{12}+b_{23})\\theta_2 + b_{23}\\theta_3 = 0 \\implies 0 \\cdot P_1 + 1 \\cdot P_2 + 0 \\cdot P_3 - 600 \\cdot \\theta_2 + 200 \\cdot \\theta_3 = D_2$$\n$$P_3 - D_3 + b_{23}\\theta_2 - (b_{13}+b_{23})\\theta_3 = 0 \\implies 0 \\cdot P_1 + 0 \\cdot P_2 + 1 \\cdot P_3 + 200 \\cdot \\theta_2 - 600 \\cdot \\theta_3 = D_3$$\n这给出了等式约束矩阵 $A_{eq}$ 和向量 $b_{eq}$：\n$$\nA_{eq} = \\begin{bmatrix}\n1  0  0  400  400 \\\\\n0  1  0  -600  200 \\\\\n0  0  1  200  -600\n\\end{bmatrix}, \\quad\nb_{eq} = \\begin{bmatrix} D_1 \\\\ D_2 \\\\ D_3 \\end{bmatrix}\n$$\n向量 $b_{eq}$ 将根据给定的负荷 $D$ 为每个测试案例进行更新。\n\n**4. 变量边界 ($lb \\leq x \\leq ub$)**\n变量的边界源于发电机容量限制和输电线路潮流限制。\n- 发电机限制：\n  - $0 \\leq P_1 \\leq 100$\n  - $0 \\leq P_2 \\leq 100$\n  - $0 \\leq P_3 \\leq 50$\n- 输电线路限制：线路 $(1,2)$ 上的潮流为 $P_{12} = b_{12}(\\theta_1 - \\theta_2) = 400(0 - \\theta_2) = -400\\theta_2$。约束为 $|P_{12}| \\leq 40$，这意味着 $|-400\\theta_2| \\leq 40$，或 $|\\theta_2| \\leq 40/400 = 0.1$。\n  - $-0.1 \\leq \\theta_2 \\leq 0.1$\n- 相角 $\\theta_3$ 是无界的。\n这些约束可以表示为决策变量的下界和上界：\n$$\nlb = [0, 0, 0, -0.1, -\\infty]^T, \\quad ub = [100, 100, 50, 0.1, +\\infty]^T\n$$\n将线路限制纳入边界后，不再需要不等式约束矩阵 $A_{ub}$ 和 $b_{ub}$。\n\n**5. 后处理**\n一旦针对给定的负荷向量 $D$ 解决了优化问题，得到最优解向量 $x^* = [P_1^*, P_2^*, P_3^*, \\theta_2^*, \\theta_3^*]^T$，就可以计算所需的输出：\n- **最优发电量**：$[P_1^*, P_2^*, P_3^*]$ 是 $x^*$ 的前三个元素。\n- **线路潮流**：使用最优相角计算，其中 $\\theta_1=0$：\n  - $P_{12} = b_{12}(\\theta_1 - \\theta_2^*) = -400 \\theta_2^*$\n  - $P_{13} = b_{13}(\\theta_1 - \\theta_3^*) = -400 \\theta_3^*$\n  - $P_{23} = b_{23}(\\theta_2^* - \\theta_3^*) = 200(\\theta_2^* - \\theta_3^*)$\n- **节点边际电价（LMP）**：LMP $[\\lambda_1, \\lambda_2, \\lambda_3]$ 是与节点功率平衡等式约束相关的对偶变量（影子价格）。`scipy.optimize.linprog` 函数以 `res.eqlin.marginals` 的形式返回这些值。这些值代表在每个母线供应额外一兆瓦电力的边际成本。\n\n此完整公式将针对问题中指定的三个测试案例中的每一个进行实施。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of DC Optimal Power Flow (DC-OPF) problems for a 3-bus network.\n\n    The problem is formulated as a Linear Program (LP) and solved using scipy.optimize.linprog.\n    The decision variables are x = [P1, P2, P3, theta2, theta3].\n    \"\"\"\n    \n    # ----------------------------------------------------------------------\n    # Define constants and problem parameters based on the problem statement\n    # ----------------------------------------------------------------------\n    \n    # Generator cost coefficients ($/MW)\n    c_gen = np.array([10.0, 12.0, 30.0])\n    \n    # Generator min/max power output (MW)\n    P_min = np.array([0.0, 0.0, 0.0])\n    P_max = np.array([100.0, 100.0, 50.0])\n    \n    # Line susceptances (MW/rad)\n    b12 = 400.0\n    b13 = 400.0\n    b23 = 200.0\n    \n    # Line flow limit for line (1,2) (MW)\n    F12_max = 40.0\n    \n    # Test cases: Demand vectors D = [D1, D2, D3] (MW)\n    test_cases = [\n        np.array([50.0, 50.0, 50.0]),\n        np.array([30.0, 120.0, 30.0]),\n        np.array([90.0, 110.0, 50.0]),\n    ]\n\n    # ----------------------------------------------------------------------\n    # Construct the LP matrices and vectors\n    # ----------------------------------------------------------------------\n    \n    # Objective function vector c for x = [P1, P2, P3, theta2, theta3]\n    # Costs are associated with P1, P2, P3. Angles theta2, theta3 have zero cost.\n    c = np.array([ c_gen[0], c_gen[1], c_gen[2], 0.0, 0.0 ])\n    \n    # Equality constraints: A_eq * x = b_eq\n    # Nodal power balance equations\n    # P1 - D1 + b12*theta2 + b13*theta3 = 0\n    # P2 - D2 - (b12+b23)*theta2 + b23*theta3 = 0\n    # P3 - D3 + b23*theta2 - (b13+b23)*theta3 = 0\n    A_eq = np.array([\n        [1, 0, 0, b12, b13],\n        [0, 1, 0, -(b12 + b23), b23],\n        [0, 0, 1, b23, -(b13 + b23)]\n    ])\n    \n    # Bounds for variables: lb = x = ub\n    # Bounds for P1, P2, P3\n    p_bounds = list(zip(P_min, P_max))\n    \n    # Bounds for theta2 from line limit: |P12| = F12_max\n    # |b12 * (theta1 - theta2)| = F12_max. With theta1=0, |-b12*theta2| = F12_max\n    # |theta2| = F12_max / b12\n    theta2_limit = F12_max / b12\n    theta_bounds = [(-theta2_limit, theta2_limit), (None, None)] # theta3 is unbounded\n    \n    bounds = p_bounds + theta_bounds\n\n    results = []\n    \n    # ----------------------------------------------------------------------\n    # Solve the LP for each test case\n    # ----------------------------------------------------------------------\n    for D in test_cases:\n        # The right-hand side of the equality constraints is the demand vector D\n        b_eq = D\n        \n        # Solve the linear program\n        res = linprog(c=c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res.success:\n            # Handle cases where the solver fails (e.g., infeasible)\n            # For this problem set, solutions are expected to exist.\n            # Using placeholder values if a case were to fail.\n            case_result = [np.nan] * 9\n        else:\n            # Extract optimal solution\n            P1_opt, P2_opt, P3_opt, theta2_opt, theta3_opt = res.x\n            \n            # Store optimal generation\n            P_opt = [P1_opt, P2_opt, P3_opt]\n            \n            # Calculate line flows with theta1=0\n            P12_flow = b12 * (0 - theta2_opt)\n            P13_flow = b13 * (0 - theta3_opt)\n            P23_flow = b23 * (theta2_opt - theta3_opt)\n            \n            flows = [P12_flow, P13_flow, P23_flow]\n            \n            # Extract Locational Marginal Prices (LMPs)\n            # These are the dual variables of the nodal power balance equality constraints\n            LMPs = res.eqlin.marginals\n            \n            # Combine all results for the current case\n            case_result = P_opt + flows + list(LMPs)\n            \n        results.append(case_result)\n\n    # ----------------------------------------------------------------------\n    # Format and print the final output exactly as specified\n    # ----------------------------------------------------------------------\n    # Convert each inner list of numbers to a comma-separated string\n    case_strings = [','.join(map(str, case)) for case in results]\n    # Join the case strings into the final list-of-lists format\n    output_string = f\"[[{case_strings[0]}],[{case_strings[1]}],[{case_strings[2]}]]\"\n    \n    print(output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "现代电力系统日益依赖储能技术来应对可再生能源的波动性。这个练习将经济调度问题从单一时间断面扩展到了跨时间维度，让你探索包含储能单元的多周期经济调度。通过对一个包含储能设施的简化系统进行两周期调度，你将深入理解储能的核心经济原理，例如充放电效率如何影响套利决策，以及初始和最终储能量如何作为跨时间周期的关键约束。这个看似简单的场景深刻地揭示了储能在一系列变化的市场价格中实现价值的基本逻辑。",
            "id": "4086781",
            "problem": "考虑一个包含储能的双周期经济调度（ED）问题，周期为 $t \\in \\{1,2\\}$，每个周期时长 $\\Delta t = 1$ 小时。该系统有一台火电机组，其边际成本恒为 $c = 30$ 美元/兆瓦时，无装机容量上限，决策变量 $P_t \\ge 0$ 表示每个周期的火电发电功率（单位：兆瓦）。系统中有一个理想化储能设备，其特征为：充电效率 $\\eta_c = 0.9$，放电效率 $\\eta_d = 0.9$，初始荷电状态 $s_0 = 0$ 兆瓦时，荷电状态限制为 $0 \\le s_t \\le s_{\\max} = 50$ 兆瓦时（对于 $t \\in \\{1,2\\}$）。储能的决策变量为充电功率 $c_t \\ge 0$（兆瓦）和放电功率 $d_t \\ge 0$（兆瓦），两者均在电网侧定义。荷电状态的动态变化遵循能量守恒定律，并考虑给定的效率和周期时长。非弹性需求为 $(D_1,D_2) = (100,80)$ 兆瓦。除了满足可行性约束外，没有为最终储能状态指定外生价值。\n\n仅使用功率平衡和能量守恒的基本原理，建立以最小化整个时间范围内的总生产成本为目标的经济调度模型。然后求解每个周期的最优决策 $(c_t,d_t,P_t)$。\n\n请将您的最终答案以单行矩阵 $\\left(c_1\\ c_2\\ d_1\\ d_2\\ P_1\\ P_2\\right)$ 的形式给出，单位为兆瓦。不要四舍五入；请提供精确值。",
            "solution": "用户要求我解决一个双周期经济调度问题。\n\n### 步骤 1：提取已知条件\n- **时间周期：** $t \\in \\{1, 2\\}$\n- **周期时长：** $\\Delta t = 1$ 小时\n- **火电机组边际成本：** $c = 30$ 美元/兆瓦时\n- **火电发电限制：** $P_t \\ge 0$，无上限\n- **储能充电效率：** $\\eta_c = 0.9$\n- **储能放电效率：** $\\eta_d = 0.9$\n- **初始荷电状态：** $s_0 = 0$ 兆瓦时\n- **荷电状态限制：** $0 \\le s_t \\le s_{\\max} = 50$ 兆瓦时，对于 $t \\in \\{1, 2\\}$\n- **储能决策变量：** 充电功率 $c_t \\ge 0$ (MW)，放电功率 $d_t \\ge 0$ (MW)\n- **需求：** $(D_1, D_2) = (100, 80)$ 兆瓦\n- **最终储能价值：** 没有为最终储能状态指定价值。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题是一个标准的含储能的经济调度模型，是能源系统工程中的一个常见课题。\n- **科学性：** 该模型基于能量守恒和经济优化的基本原理。边际成本、储能效率和功率平衡等概念都是成熟的。\n- **适定性：** 该问题是一个线性规划问题，属于适定优化问题。它有明确定义的目标函数和非空的凸可行集，保证了唯一最优解的存在。\n- **客观性：** 问题陈述使用了精确、正式的语言，没有主观或模糊的术语。\n- **完整性：** 所有必要的数据（成本、效率、需求、限制、初始条件）都已提供。该问题是自洽的。\n- **一致性：** 所提供的数据是一致的，不会导致矛盾。\n\n### 步骤 3：结论与行动\n该问题有效。我将继续进行求解。\n\n问题在于确定每个周期的火电发电（$P_t$）、储能充电（$c_t$）和储能放电（$d_t$）的最优决策，以最小化双周期内的总发电成本。\n\n首先，我们建立优化问题模型。\n\n**决策变量：**\n- $P_t$：周期 $t$ 的火电发电功率 [MW]\n- $c_t$：周期 $t$ 从电网吸收用于储能充电的功率 [MW]\n- $d_t$：周期 $t$ 储能向电网注入的功率 [MW]\n- $s_t$：周期 $t$ 结束时的荷电状态（储存的能量） [MWh]\n\n**目标函数：**\n目标是最小化总火电发电成本，其表达式为：\n$$ \\min_{P_t, c_t, d_t} Z = \\sum_{t=1}^{2} c \\cdot P_t \\cdot \\Delta t $$\n已知 $c=30$ 和 $\\Delta t=1$，目标函数为：\n$$ \\min Z = 30(P_1 + P_2) $$\n\n**约束条件：**\n该优化问题在每个周期 $t \\in \\{1, 2\\}$ 都受到若干约束。\n\n1.  **功率平衡：** 总发电功率和放电功率必须等于总需求和充电功率之和。\n    对于 $t=1$：$P_1 + d_1 = D_1 + c_1 \\implies P_1 + d_1 = 100 + c_1$\n    对于 $t=2$：$P_2 + d_2 = D_2 + c_2 \\implies P_2 + d_2 = 80 + c_2$\n\n2.  **储能动态：** 一个周期结束时的荷电状态取决于前一状态以及流入储能的净能量，同时要考虑效率。充电功率 $c_t$ 在进入储能时会因充电效率 $\\eta_c$ 而减少，而为了向电网提供放电功率 $d_t$，必须从储能中以更高的功率 $d_t/\\eta_d$ 提取能量。\n    当 $s_0=0$ 和 $\\Delta t=1$ 时：\n    对于 $t=1$：$s_1 = s_0 + (\\eta_c c_1 - \\frac{d_1}{\\eta_d}) \\Delta t = 0 + (0.9 c_1 - \\frac{d_1}{0.9}) \\cdot 1 = 0.9 c_1 - \\frac{d_1}{0.9}$\n    对于 $t=2$：$s_2 = s_1 + (\\eta_c c_2 - \\frac{d_2}{\\eta_d}) \\Delta t = s_1 + (0.9 c_2 - \\frac{d_2}{0.9}) \\cdot 1 = s_1 + 0.9 c_2 - \\frac{d_2}{0.9}$\n\n3.  **储能容量限制：** 荷电状态必须保持在其上下限之内。\n    $0 \\le s_1 \\le 50$\n    $0 \\le s_2 \\le 50$\n\n4.  **非负性：** 所有决策变量必须为非负。\n    $P_t \\ge 0, c_t \\ge 0, d_t \\ge 0$ 对于 $t \\in \\{1, 2\\}$\n\n为了求解该问题，我们首先使用功率平衡方程，将总发电量 $P_1+P_2$ 用储能决策变量来表示：\n$P_1 = 100 + c_1 - d_1$\n$P_2 = 80 + c_2 - d_2$\n将两者相加得到：\n$P_1 + P_2 = 180 + (c_1 + c_2) - (d_1 + d_2)$\n\n目标函数变为：\n$$ \\min Z = 30 \\cdot \\left(180 + (c_1 + c_2) - (d_1 + d_2)\\right) $$\n最小化 $Z$ 等价于最小化 $(c_1 + c_2) - (d_1 + d_2)$ 这一项。\n\n现在，考虑整个时间范围内的储能能量平衡。通过对荷电状态动态方程求和，我们可以将最终状态 $s_2$ 与初始状态 $s_0$ 以及总的充放电活动联系起来：\n$s_2 = s_1 + 0.9 c_2 - \\frac{d_2}{0.9} = (0.9 c_1 - \\frac{d_1}{0.9}) + 0.9 c_2 - \\frac{d_2}{0.9}$\n$s_2 = 0.9(c_1 + c_2) - \\frac{1}{0.9}(d_1 + d_2)$\n由于 $s_0=0$ 且最终荷电状态必须为非负（$s_2 \\ge 0$），我们有：\n$0.9(c_1 + c_2) - \\frac{1}{0.9}(d_1 + d_2) \\ge 0$\n这意味着：\n$0.9(c_1 + c_2) \\ge \\frac{1}{0.9}(d_1 + d_2)$\n乘以 $0.9$：\n$0.81(c_1 + c_2) \\ge (d_1 + d_2)$\n\n这个不等式揭示了核心的经济权衡。储能放出的总能量 $(d_1+d_2)\\Delta t$ 最多只能是充入的总能量 $(c_1+c_2)\\Delta t$ 的 $0.81$ 倍。这个因子 $0.81 = \\eta_c \\eta_d$ 是储能的往返效率。任何通过储能循环的能量都存在不可避免的 $19\\%$ 的能量损失。\n\n让我们回到我们想要最小化的量：$F = (c_1 + c_2) - (d_1 + d_2)$。\n利用我们推导出的不等式 $d_1 + d_2 \\le 0.81(c_1 + c_2)$，我们可以找到 $F$ 的一个下界：\n$F = (c_1 + c_2) - (d_1 + d_2) \\ge (c_1 + c_2) - 0.81(c_1 + c_2)$\n$F \\ge (1 - 0.81)(c_1 + c_2)$\n$F \\ge 0.19(c_1 + c_2)$\n\n由于充电功率必须为非负（$c_1 \\ge 0, c_2 \\ge 0$），所以 $0.19(c_1 + c_2)$ 这一项也是非负的。$F$ 的最小可能值为 $0$。当且仅当 $c_1 + c_2 = 0$ 时，才能达到这个最小值。又因为 $c_1 \\ge 0$ 和 $c_2 \\ge 0$，这意味着 $c_1 = 0$ 且 $c_2 = 0$。\n\n如果 $c_1 = 0$ 且 $c_2 = 0$，不等式 $0.81(c_1 + c_2) \\ge (d_1 + d_2)$ 变为 $0 \\ge d_1 + d_2$。由于 $d_1 \\ge 0$ 且 $d_2 \\ge 0$，这迫使 $d_1 = 0$ 且 $d_2 = 0$。\n\n因此，最优的储能策略是完全不使用储能。最优的储能决策是：\n$c_1^* = 0$, $c_2^* = 0$, $d_1^* = 0$, $d_2^* = 0$。\n\n这个结果是直观的：由于发电的边际成本是恒定的，因此没有价格套利的机会。通过有损耗的储能设备循环能量只会增加满足相同需求所需的总发电量，从而增加总成本。\n\n根据最优的储能决策，我们将这些值代入功率平衡方程，从而求得最优的火电发电量：\n对于 $t=1$：$P_1^* = 100 + c_1^* - d_1^* = 100 + 0 - 0 = 100$ MW。\n对于 $t=2$：$P_2^* = 80 + c_2^* - d_2^* = 80 + 0 - 0 = 80$ MW。\n\n荷电状态在整个时间范围内保持其初始值：\n$s_1 = 0.9(0) - (0)/0.9 = 0$。这满足 $0 \\le 0 \\le 50$。\n$s_2 = s_1 + 0.9(0) - (0)/0.9 = 0$。这满足 $0 \\le 0 \\le 50$。\n所有约束条件均得到满足。\n\n以所要求的行矩阵 $(c_1, c_2, d_1, d_2, P_1, P_2)$ 表示的各周期最优决策为 $(0, 0, 0, 0, 100, 80)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0  0  100  80\n\\end{pmatrix}\n}\n$$"
        }
    ]
}