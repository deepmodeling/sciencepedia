{
    "hands_on_practices": [
        {
            "introduction": "Before we can optimize a power system, we must first be able to model its physical behavior. This foundational exercise guides you through the process of constructing the bus susceptance matrix ($B$), a cornerstone of the DC power flow model, from basic network parameters. By solving the linear system of equations that relates power injections to bus voltage angles, you will calculate the power flows across the network, gaining a crucial understanding of how the system responds to a given state of generation and load .",
            "id": "4083085",
            "problem": "Consider a connected $4$-bus transmission network modeled under the Direct Current (DC) power flow approximation within Direct Current Optimal Power Flow (DC-OPF). Assume all voltage magnitudes are fixed at $1$ per unit, real power flows are linear in bus voltage angle differences, and line resistances are negligible relative to reactances. The base power is $S_{\\text{base}} = 100$ MVA. The buses are $\\{1,2,3,4\\}$ with lines and per-unit reactances on the $100$ MVA base given by: line $(1,2)$ has $x_{12} = 0.25$, line $(2,3)$ has $x_{23} = 0.4$, line $(3,4)$ has $x_{34} = 0.2$, line $(1,4)$ has $x_{14} = 0.5$, and line $(2,4)$ has $x_{24} = 1/3$. Define the line susceptances as $b_{\\ell} = 1/x_{\\ell}$. The net real power injections at the buses (positive for net generation, negative for net load) are specified in megawatts by the vector $p = \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix}$, which satisfies $\\sum_{i=1}^{4} p_i = 0$. Take bus $1$ as the reference with angle $\\theta_1 = 0$ radians. \n\nStarting from first principles, construct the bus susceptance matrix $B$ using Kirchhoff’s current law and the line susceptances, explain why $B$ is singular and identify the structure of its nullspace, form the reduced matrix $B_{\\text{red}}$ by removing the reference-bus row and column, solve for the non-reference bus voltage angles $\\theta_{\\text{red}}$ via $B_{\\text{red}}^{-1}$, and compute the oriented line flows $f_{\\ell} = b_{\\ell}(\\theta_i - \\theta_j)$ in per unit for each line $(i,j)$, then convert to megawatts using $S_{\\text{base}}$.\n\nDefine the orientation of each line flow from the lower-index bus to the higher-index bus (for example, $(1,2)$ is oriented from bus $1$ to bus $2$). Finally, determine the maximum absolute line-flow magnitude across all five lines and report its value in megawatts. Express bus voltage angles in radians and round your final reported megawatt value to four significant figures.",
            "solution": "The problem is evaluated and deemed valid as it is scientifically grounded in standard power systems analysis, is well-posed with sufficient and consistent data, and is formulated objectively. We may proceed with the solution.\n\nThe DC power flow model is derived from Kirchhoff's Current Law (KCL) applied at each bus of the network. The real power injection at bus $i$, denoted by $p_i$, must equal the sum of real power flows leaving the bus on all connected transmission lines. Under the DC approximation, the real power flow $f_{ij}$ on a line connecting bus $i$ to bus $j$ is given by $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$, where $b_{ij}$ is the line's susceptance and $\\theta_i$ and $\\theta_j$ are the bus voltage angles. KCL at bus $i$ is thus $p_i = \\sum_j b_{ij}(\\theta_i - \\theta_j)$, where the sum is over all buses $j$ connected to bus $i$. This system of linear equations for all buses can be written in matrix form as $P = B\\theta$, where $P$ is the vector of bus power injections, $\\theta$ is the vector of bus voltage angles, and $B$ is the bus susceptance matrix.\n\nFirst, we convert the given net power injections from megawatts (MW) to per unit (p.u.) using the base power $S_{\\text{base}} = 100$ MVA.\nThe vector of power injections in p.u. is $P = \\frac{1}{S_{\\text{base}}} p_{\\text{MW}}$.\n$$P = \\frac{1}{100} \\begin{pmatrix} 80 \\\\ -30 \\\\ -20 \\\\ -30 \\end{pmatrix} = \\begin{pmatrix} 0.8 \\\\ -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} \\text{ p.u.}$$\n\nNext, we calculate the line susceptances $b_{\\ell} = 1/x_{\\ell}$ in p.u.\n$b_{12} = 1/x_{12} = 1/0.25 = 4.0$ p.u.\n$b_{23} = 1/x_{23} = 1/0.4 = 2.5$ p.u.\n$b_{34} = 1/x_{34} = 1/0.2 = 5.0$ p.u.\n$b_{14} = 1/x_{14} = 1/0.5 = 2.0$ p.u.\n$b_{24} = 1/x_{24} = 1/(1/3) = 3.0$ p.u.\n\nWe construct the $4 \\times 4$ bus susceptance matrix $B$. The diagonal elements $B_{ii}$ are the sum of the susceptances of all lines connected to bus $i$. The off-diagonal elements $B_{ij}$ ($i \\neq j$) are the negative of the susceptance of the line connecting bus $i$ and bus $j$.\n$B_{11} = b_{12} + b_{14} = 4.0 + 2.0 = 6.0$\n$B_{22} = b_{12} + b_{23} + b_{24} = 4.0 + 2.5 + 3.0 = 9.5$\n$B_{33} = b_{23} + b_{34} = 2.5 + 5.0 = 7.5$\n$B_{44} = b_{14} + b_{24} + b_{34} = 2.0 + 3.0 + 5.0 = 10.0$\n\n$B_{12} = B_{21} = -b_{12} = -4.0$\n$B_{13} = B_{31} = 0$\n$B_{14} = B_{41} = -b_{14} = -2.0$\n$B_{23} = B_{32} = -b_{23} = -2.5$\n$B_{24} = B_{42} = -b_{24} = -3.0$\n$B_{34} = B_{43} = -b_{34} = -5.0$\n\nThe bus susceptance matrix $B$ is:\n$$B = \\begin{pmatrix} 6.0  -4.0  0  -2.0 \\\\ -4.0  9.5  -2.5  -3.0 \\\\ 0  -2.5  7.5  -5.0 \\\\ -2.0  -3.0  -5.0  10.0 \\end{pmatrix}$$\n\nThe matrix $B$ is singular. This arises directly from its construction based on KCL. For any row $i$, the sum of the elements is $\\sum_{j=1}^{4} B_{ij} = B_{ii} + \\sum_{j \\neq i} B_{ij} = (\\sum_{k \\neq i} b_{ik}) + \\sum_{j \\neq i} (-b_{ij}) = 0$. Since every row sum is zero, the sum of the column vectors weighted by $1$ is the zero vector. This means the vector $\\mathbf{1} = \\begin{pmatrix} 1  1  1  1 \\end{pmatrix}^T$ is a basis for the nullspace of $B$, i.e., $B\\mathbf{1} = \\mathbf{0}$. A non-trivial nullspace implies the matrix is singular and its determinant is zero. Physically, this singularity means that only the differences in voltage angles $(\\theta_i - \\theta_j)$ affect power flow, not their absolute values. Adding a constant offset to all angles, $\\theta' = \\theta + c\\mathbf{1}$, yields the same power injections since $B\\theta' = B(\\theta + c\\mathbf{1}) = B\\theta + cB\\mathbf{1} = P + \\mathbf{0} = P$.\n\nTo obtain a unique solution, we must specify a reference angle. We set bus $1$ as the reference, so $\\theta_1 = 0$. This allows us to solve for the remaining angles by removing the first row and first column from the system $P = B\\theta$. Let $\\theta_{\\text{red}} = \\begin{pmatrix} \\theta_2  \\theta_3  \\theta_4 \\end{pmatrix}^T$ and $P_{\\text{red}} = \\begin{pmatrix} p_2  p_3  p_4 \\end{pmatrix}^T$. The reduced system is $P_{\\text{red}} = B_{\\text{red}}\\theta_{\\text{red}}$.\n$$P_{\\text{red}} = \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix}, \\quad B_{\\text{red}} = \\begin{pmatrix} 9.5  -2.5  -3.0 \\\\ -2.5  7.5  -5.0 \\\\ -3.0  -5.0  10.0 \\end{pmatrix}$$\nWe solve for $\\theta_{\\text{red}}$ by inverting $B_{\\text{red}}$: $\\theta_{\\text{red}} = B_{\\text{red}}^{-1} P_{\\text{red}}$. The determinant of $B_{\\text{red}}$ is:\n$\\det(B_{\\text{red}}) = 9.5(7.5 \\cdot 10.0 - (-5.0)^2) - (-2.5)(-2.5 \\cdot 10.0 - (-5.0)(-3.0)) + (-3.0)((-2.5)(-5.0) - 7.5(-3.0))$\n$\\det(B_{\\text{red}}) = 9.5(50) + 2.5(-40) - 3.0(35) = 475 - 100 - 105 = 270$.\nThe inverse matrix is $B_{\\text{red}}^{-1} = \\frac{1}{\\det(B_{\\text{red}})} \\text{adj}(B_{\\text{red}})$.\n$$B_{\\text{red}}^{-1} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix}$$\nNow, we compute the angle vector $\\theta_{\\text{red}}$:\n$$\\theta_{\\text{red}} = \\frac{1}{270} \\begin{pmatrix} 50  40  35 \\\\ 40  86  55 \\\\ 35  55  65 \\end{pmatrix} \\begin{pmatrix} -0.3 \\\\ -0.2 \\\\ -0.3 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -15 - 8 - 10.5 \\\\ -12 - 17.2 - 16.5 \\\\ -10.5 - 11 - 19.5 \\end{pmatrix} = \\frac{1}{270} \\begin{pmatrix} -33.5 \\\\ -45.7 \\\\ -41.0 \\end{pmatrix}$$\nSo, the bus voltage angles in radians are:\n$\\theta_1 = 0$\n$\\theta_2 = -33.5 / 270 \\approx -0.1241$ rad\n$\\theta_3 = -45.7 / 270 \\approx -0.1693$ rad\n$\\theta_4 = -41.0 / 270 \\approx -0.1519$ rad\n\nNext, we compute the oriented line flows $f_{ij} = b_{ij}(\\theta_i - \\theta_j)$ in p.u., with orientation from lower-index bus to higher-index bus.\n$f_{12} = b_{12}(\\theta_1 - \\theta_2) = 4.0(0 - (-33.5/270)) = 134/270$ p.u.\n$f_{14} = b_{14}(\\theta_1 - \\theta_4) = 2.0(0 - (-41.0/270)) = 82/270$ p.u.\n$f_{23} = b_{23}(\\theta_2 - \\theta_3) = 2.5(-33.5/270 - (-45.7/270)) = 2.5(12.2/270) = 30.5/270$ p.u.\n$f_{24} = b_{24}(\\theta_2 - \\theta_4) = 3.0(-33.5/270 - (-41.0/270)) = 3.0(7.5/270) = 22.5/270$ p.u.\n$f_{34} = b_{34}(\\theta_3 - \\theta_4) = 5.0(-45.7/270 - (-41.0/270)) = 5.0(-4.7/270) = -23.5/270$ p.u.\n\nFinally, we convert these flows to MW using $S_{\\text{base}} = 100$ MVA and find the maximum absolute magnitude.\n$|f_{12, \\text{MW}}| = |134/270| \\times 100 \\approx 49.6296$ MW\n$|f_{14, \\text{MW}}| = |82/270| \\times 100 \\approx 30.3704$ MW\n$|f_{23, \\text{MW}}| = |30.5/270| \\times 100 \\approx 11.2963$ MW\n$|f_{24, \\text{MW}}| = |22.5/270| \\times 100 \\approx 8.3333$ MW\n$|f_{34, \\text{MW}}| = |-23.5/270| \\times 100 \\approx 8.7037$ MW\n\nThe maximum absolute line-flow magnitude is on line $(1,2)$ with a value of $49.6296...$ MW. Rounding to four significant figures gives $49.63$ MW.",
            "answer": "$$\\boxed{49.63}$$"
        },
        {
            "introduction": "With the physical model established, we now introduce economic principles to find the most cost-effective way to operate the system. This practice challenges you to solve a DC Optimal Power Flow problem analytically by formulating and solving its Karush-Kuhn-Tucker (KKT) optimality conditions . This deep dive into the underlying mathematics reveals precisely how physical constraints, such as transmission line limits, lead to congestion and create the essential economic signals known as Locational Marginal Prices (LMPs).",
            "id": "4083058",
            "problem": "Consider a three-bus transmission network under the direct current (DC) approximation for power flow. Buses $1$, $2$, and $3$ are connected radially by transmission lines $(1,2)$ and $(2,3)$ with series reactances $x_{12} = 1$ and $x_{23} = 1$ (in per-unit on a consistent base). Define the directed line flows so that for line $(i,j)$ the active power flow is $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$, where $\\theta_i$ is the voltage phase angle at bus $i$. Let bus $1$ be the angle reference with $\\theta_1 = 0$. The thermal limit on line $(2,3)$ is $|f_{23}| \\leq F_{23}^{\\max}$ with $F_{23}^{\\max} = 50$ megawatts. There is no thermal limit on line $(1,2)$.\n\nGeneration is located at buses $1$ and $3$ with convex quadratic costs. The cost at bus $1$ is $c_1(p_1) = \\tfrac{1}{2}\\,a_1\\,p_1^2 + b_1\\,p_1$ with $a_1 = 0.01$ and $b_1 = 5$, and the cost at bus $3$ is $c_3(p_3) = \\tfrac{1}{2}\\,a_3\\,p_3^2 + b_3\\,p_3$ with $a_3 = 0.01$ and $b_3 = 15$. There are no generation capacity limits. The only demand is at bus $3$ with $d_3 = 100$ megawatts; $d_1 = d_2 = 0$ megawatts. There is no generation or demand at bus $2$.\n\nFormulate the Direct Current Optimal Power Flow (DC OPF) problem by minimizing total generation cost subject to nodal power balance at each bus and the line thermal limit on $(2,3)$, using the DC power flow relations. Write down the necessary and sufficient optimality conditions given by the Karush–Kuhn–Tucker (KKT) system, treating the inequality $f_{23} \\leq F_{23}^{\\max}$ and $-f_{23} \\leq F_{23}^{\\max}$ separately. Solve the KKT system analytically to obtain the optimal generation dispatch $\\{p_1, p_3\\}$, the corresponding optimal angles $\\{\\theta_2, \\theta_3\\}$, and the Locational Marginal Prices (LMPs) $\\{\\lambda_1, \\lambda_2, \\lambda_3\\}$, where each $\\lambda_i$ is the Lagrange multiplier associated with the nodal power balance at bus $i$.\n\nFinally, interpret the resulting LMPs in terms of congestion and marginal costs, and provide your final answer as the LMP row vector $[\\lambda_1, \\lambda_2, \\lambda_3]$ in $\\$/\\mathrm{MWh}$. No rounding is required; report exact values.",
            "solution": "The problem is first validated according to the specified criteria. The problem is a standard Direct Current Optimal Power Flow (DC OPF) formulation, a well-established and scientifically grounded model in power systems engineering. It provides a complete and consistent set of data, including network topology, line reactances, generator cost functions, load data, and transmission line limits. The objective is clearly stated and the constraints are well-defined. The problem is thus deemed valid as it is scientifically sound, well-posed, objective, and complete.\n\nThe DC OPF problem is formulated to minimize the total generation cost subject to network constraints.\n\nThe total generation cost $C$ is the sum of the costs at bus $1$ and bus $3$:\n$$ C(p_1, p_3) = c_1(p_1) + c_3(p_3) = \\left(\\frac{1}{2}a_1 p_1^2 + b_1 p_1\\right) + \\left(\\frac{1}{2}a_3 p_3^2 + b_3 p_3\\right) $$\nSubstituting the given values $a_1=0.01$, $b_1=5$, $a_3=0.01$, and $b_3=15$:\n$$ C(p_1, p_3) = 0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3 $$\n\nThe constraints are as follows:\n1.  **Nodal Power Balance Equations**: Let $\\lambda_i$ be the Lagrange multiplier (Locational Marginal Price, LMP) for the power balance at bus $i$.\n    -   Bus 1: $p_1 - f_{12} = d_1 = 0 \\quad (\\lambda_1)$\n    -   Bus 2: $f_{12} - f_{23} = d_2 = 0 \\quad (\\lambda_2)$\n    -   Bus 3: $p_3 + f_{23} = d_3 = 100 \\quad (\\lambda_3)$\n\n2.  **DC Power Flow Equations**: The active power flow $f_{ij}$ is given by $f_{ij} = (\\theta_i - \\theta_j)/x_{ij}$. With $\\theta_1 = 0$, $x_{12} = 1$, and $x_{23} = 1$:\n    -   $f_{12} = \\frac{\\theta_1 - \\theta_2}{x_{12}} = \\frac{0 - \\theta_2}{1} = -\\theta_2$\n    -   $f_{23} = \\frac{\\theta_2 - \\theta_3}{x_{23}} = \\frac{\\theta_2 - \\theta_3}{1} = \\theta_2 - \\theta_3$\n\n3.  **Thermal Limits**: The limit $|f_{23}| \\leq F_{23}^{\\max}$ with $F_{23}^{\\max}=50$ is treated as two separate inequality constraints with non-negative multipliers $\\mu_{23}^+$ and $\\mu_{23}^-$.\n    -   $f_{23} - 50 \\leq 0 \\implies \\theta_2 - \\theta_3 - 50 \\leq 0 \\quad (\\mu_{23}^+ \\geq 0)$\n    -   $-f_{23} - 50 \\leq 0 \\implies -(\\theta_2 - \\theta_3) - 50 \\leq 0 \\quad (\\mu_{23}^- \\geq 0)$\n\nSubstituting the flow equations into the balance equations:\n-   $p_1 + \\theta_2 = 0$\n-   $-\\theta_2 - (\\theta_2 - \\theta_3) = 0 \\implies \\theta_3 = 2\\theta_2$\n-   $p_3 + \\theta_2 - \\theta_3 = 100$\n\nThe Lagrangian function $\\mathcal{L}$ for this problem is:\n$$ \\mathcal{L} = (0.005 p_1^2 + 5 p_1 + 0.005 p_3^2 + 15 p_3) - \\lambda_1(p_1 + \\theta_2) - \\lambda_2(-\\theta_2 - (\\theta_2 - \\theta_3)) - \\lambda_3(p_3 + \\theta_2 - \\theta_3 - 100) + \\mu_{23}^+(\\theta_2 - \\theta_3 - 50) + \\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) $$\n\nThe Karush-Kuhn-Tucker (KKT) conditions for optimality are:\n**Stationarity:**\n1.  $\\frac{\\partial\\mathcal{L}}{\\partial p_1} = 0.01 p_1 + 5 - \\lambda_1 = 0 \\implies \\lambda_1 = 0.01 p_1 + 5$\n2.  $\\frac{\\partial\\mathcal{L}}{\\partial p_3} = 0.01 p_3 + 15 - \\lambda_3 = 0 \\implies \\lambda_3 = 0.01 p_3 + 15$\n3.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_2} = -\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ - \\mu_{23}^- = 0$\n4.  $\\frac{\\partial\\mathcal{L}}{\\partial \\theta_3} = -\\lambda_2 + \\lambda_3 - \\mu_{23}^+ + \\mu_{23}^- = 0$\n\n**Primal Feasibility:**\n5.  $p_1 + \\theta_2 = 0$\n6.  $\\theta_3 = 2\\theta_2$\n7.  $p_3 + \\theta_2 - \\theta_3 = 100$\n8.  $\\theta_2 - \\theta_3 \\leq 50$\n9.  $-(\\theta_2 - \\theta_3) \\leq 50$\n\n**Dual Feasibility:**\n10. $\\mu_{23}^+ \\geq 0$, $\\mu_{23}^- \\geq 0$\n\n**Complementary Slackness:**\n11. $\\mu_{23}^+(\\theta_2 - \\theta_3 - 50) = 0$\n12. $\\mu_{23}^-(-\\theta_2 + \\theta_3 - 50) = 0$\n\nWe solve the KKT system by first assuming the line is uncongested, i.e., $\\mu_{23}^+ = 0$ and $\\mu_{23}^- = 0$.\nFrom KKT (4), $-\\lambda_2 + \\lambda_3 = 0 \\implies \\lambda_2 = \\lambda_3$.\nFrom KKT (3), $-\\lambda_1 + 2\\lambda_2 - \\lambda_3 = 0 \\implies -\\lambda_1 + 2\\lambda_3 - \\lambda_3 = 0 \\implies \\lambda_1 = \\lambda_3$.\nThus, $\\lambda_1 = \\lambda_2 = \\lambda_3$. Equating the marginal costs from KKT (1) and (2):\n$0.01 p_1 + 5 = 0.01 p_3 + 15 \\implies p_1 - p_3 = 1000$.\nSumming the nodal power balance equations yields total generation equals total demand: $p_1 + p_3 = 100$.\nSolving these two linear equations for $p_1$ and $p_3$:\n$(p_3 + 1000) + p_3 = 100 \\implies 2p_3 = -900 \\implies p_3 = -450$.\nThen $p_1 = 100 - p_3 = 100 - (-450) = 550$.\nWhile physically unusual, let's check the line flow. From the balance equations: $f_{12} = p_1 = 550$, and $f_{12} = f_{23}$, so $f_{23} = 550$.\nThe flow $f_{23} = 550$ MW violates the thermal limit $|f_{23}| \\leq 50$ MW.\nTherefore, the uncongested assumption is incorrect. The line $(2,3)$ must be congested.\n\nSince the unconstrained dispatch seeks to send a large positive power flow across line $(2,3)$, the binding constraint must be $f_{23} \\leq 50$. This implies:\n- The line flow is at its limit: $f_{23} = \\theta_2 - \\theta_3 = 50$.\n- The corresponding multiplier is active: $\\mu_{23}^+  0$.\n- The other inequality is slack, so its multiplier is zero: $\\mu_{23}^- = 0$.\n\nWith $f_{23}=50$, we solve for the primal variables using the power balance equations:\n- Bus 2: $f_{12} = f_{23} \\implies f_{12} = 50$.\n- Bus 1: $p_1 = f_{12} \\implies p_1 = 50$ MW.\n- Bus 3: $p_3 + f_{23} = 100 \\implies p_3 + 50 = 100 \\implies p_3 = 50$ MW.\nThe optimal generation dispatch is $\\{p_1, p_3\\} = \\{50, 50\\}$.\n\nNow we find the optimal angles:\n- From $f_{12} = -\\theta_2 = 50$, we get $\\theta_2 = -50$.\n- From $f_{23} = \\theta_2 - \\theta_3 = 50$, we get $-50 - \\theta_3 = 50 \\implies \\theta_3 = -100$.\nThis is consistent with KKT (6), since $\\theta_3 = -100$ and $2\\theta_2 = 2(-50) = -100$. The optimal angles are $\\{\\theta_2, \\theta_3\\} = \\{-50, -100\\}$.\n\nNext, we calculate the LMPs using KKT (1) and (2):\n- $\\lambda_1 = 0.01 p_1 + 5 = 0.01(50) + 5 = 0.5 + 5 = 5.5$.\n- $\\lambda_3 = 0.01 p_3 + 15 = 0.01(50) + 15 = 0.5 + 15 = 15.5$.\n\nFinally, we find $\\lambda_2$ and $\\mu_{23}^+$ from KKT (3) and (4), with $\\mu_{23}^- = 0$:\n- KKT (4): $-\\lambda_2 + \\lambda_3 - \\mu_{23}^+ = 0 \\implies \\lambda_2 = \\lambda_3 - \\mu_{23}^+ = 15.5 - \\mu_{23}^+$.\n- KKT (3): $-\\lambda_1 + 2\\lambda_2 - \\lambda_3 + \\mu_{23}^+ = 0 \\implies 2\\lambda_2 + \\mu_{23}^+ = \\lambda_1 + \\lambda_3 = 5.5 + 15.5 = 21$.\nSubstitute the first equation into the second:\n$2(15.5 - \\mu_{23}^+) + \\mu_{23}^+ = 21 \\implies 31 - 2\\mu_{23}^+ + \\mu_{23}^+ = 21 \\implies 31 - \\mu_{23}^+ = 21 \\implies \\mu_{23}^+ = 10$.\nSince $\\mu_{23}^+ = 10  0$, our assumption of congestion is consistent.\nNow we find $\\lambda_2$:\n$\\lambda_2 = 15.5 - \\mu_{23}^+ = 15.5 - 10 = 5.5$.\nThe LMPs are $\\{\\lambda_1, \\lambda_2, \\lambda_3\\} = \\{5.5, 5.5, 15.5\\}$ in units of $\\$/\\mathrm{MWh}$.\n\n**Interpretation of LMPs**:\nThe Locational Marginal Price (LMP) at a bus represents the marginal cost to supply the next megawatt of load at that bus.\n- $\\lambda_1 = 5.5$ $/MWh is the marginal cost of generation at bus 1, since $c_1'(50) = 0.01(50)+5=5.5$.\n- $\\lambda_3 = 15.5$ $/MWh is the marginal cost of generation at bus 3, since $c_3'(50) = 0.01(50)+15=15.5$.\n- The LMPs are not uniform across the network, which indicates transmission congestion. Line $(1,2)$ is uncongested, so $\\lambda_1 = \\lambda_2 = 5.5$.\n- Line $(2,3)$ is congested, creating a price separation between bus 2 and bus 3. The difference in LMPs, $\\lambda_3 - \\lambda_2 = 15.5 - 5.5 = 10$ $/MWh, is the marginal cost of congestion. This value is equal to the shadow price (Lagrange multiplier) $\\mu_{23}^+ = 10$ of the binding thermal limit on line $(2,3)$. This price reflects the additional cost incurred by being forced to dispatch the more expensive generator at bus 3 instead of transmitting more cheap power from bus 1.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 5.5  5.5  15.5 \\end{pmatrix} } $$"
        },
        {
            "introduction": "While analytical solutions offer deep insight, real-world power systems require computational tools for optimization. This final practice transitions from theory to application, asking you to implement a full DC-OPF as a linear program to solve for the economic dispatch of a multi-bus network . This exercise mirrors the core task performed by system operators to clear electricity markets, solidifying your ability to translate DC-OPF theory into a practical problem-solving framework.",
            "id": "4086771",
            "problem": "You must write a complete, runnable program that solves a Direct Current Optimal Power Flow (DC OPF) for a three-bus network with linear generator costs, generator capacity limits, nodal power balance constraints, and a single transmission line flow limit. The problem is posed in purely mathematical terms and must be solved using first-principles modeling of DC power flow. The physical power quantities must be in megawatts (MW), angles in radians, and prices in dollars per megawatt ($/MW).\n\nFundamental base and definitions:\n- Under the DC power flow approximation, the active power flow on line $(i,j)$ is given by $P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$, where $\\theta_i$ and $\\theta_j$ are bus voltage angles in radians, and $b_{ij}$ is the line susceptance scaled to the system base.\n- The nodal power balance at bus $i$ is given by $p_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$, where $p_i$ is the net injection at bus $i$, equal to generation minus demand, i.e., $p_i = P_i - D_i$.\n- Kirchhoff's Current Law at each bus ensures the sum of incident line flows equals the net injection.\n- Economic dispatch seeks to minimize total generation cost subject to the physical constraints above.\n\nNetwork specification:\n- Three buses labeled $1$, $2$, and $3$.\n- Lines: $(1,2)$, $(1,3)$, $(2,3)$.\n- Reactances in per unit on a $100$ megavolt-ampere (MVA) base: $x_{12} = 0.25$, $x_{13} = 0.25$, $x_{23} = 0.50$. With voltage magnitude near $1$ per unit and using the base power, the effective susceptances in MW/rad are $b_{12} = \\frac{1}{x_{12}} \\cdot 100 = 400$, $b_{13} = \\frac{1}{x_{13}} \\cdot 100 = 400$, $b_{23} = \\frac{1}{x_{23}} \\cdot 100 = 200$.\n- The bus susceptance matrix $B_{\\text{bus}}$ in MW/rad is:\n$$\nB_{\\text{bus}} =\n\\begin{bmatrix}\n800  -400  -400 \\\\\n-400  600  -200 \\\\\n-400  -200  600\n\\end{bmatrix}.\n$$\n- The reference (slack) bus is bus $1$, with angle fixed at $\\theta_1 = 0$ radians.\n\nGenerators:\n- One generator per bus with linear cost functions $C_i(P_i) = c_i P_i$ where $c = [10, 12, 30]$ in $$/MW for buses $1$, $2$, and $3$, respectively.\n- Generator capacity limits: $P^{\\max} = [100, 100, 50]$ MW and $P^{\\min} = [0, 0, 0]$ MW.\n\nConstraints:\n- Nodal power balances (for $i = 1,2,3$): $P_i - D_i = \\sum_j b_{ij} \\left( \\theta_i - \\theta_j \\right)$.\n- Slack bus angle: $\\theta_1 = 0$ radians.\n- Line $(1,2)$ has a thermal flow limit $\\left| P_{12} \\right| \\leq F_{12}^{\\max}$ with $F_{12}^{\\max} = 40$ MW. Other lines have no active flow limits.\n- Generator bounds: $0 \\leq P_i \\leq P_i^{\\max}$.\n\nObjective:\n- Minimize the total cost $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$.\n\nOutputs required for each test case:\n- Optimal generation vector $[P_1, P_2, P_3]$ in MW.\n- Line flows $[P_{12}, P_{13}, P_{23}]$ in MW, computed as $P_{12} = b_{12}(\\theta_1 - \\theta_2)$, $P_{13} = b_{13}(\\theta_1 - \\theta_3)$, $P_{23} = b_{23}(\\theta_2 - \\theta_3)$.\n- Locational Marginal Prices (LMPs) $[\\lambda_1, \\lambda_2, \\lambda_3]$ in $$/MW, where $\\lambda_i$ corresponds to the shadow price of the nodal power balance at bus $i$.\n\nAll angles must be in radians. All powers must be in MW. All prices must be in $$/MW. No other units are permitted in the output.\n\nFormulation to implement:\n- Decision variables are $[P_1, P_2, P_3, \\theta_2, \\theta_3]$ with $\\theta_1 = 0$ fixed.\n- Equality constraints derived from nodal balances (substitute $\\theta_1 = 0$):\n$$\n\\begin{aligned}\nP_1 - D_1 + b_{12} \\theta_2 + b_{13} \\theta_3 = 0, \\\\\nP_2 - D_2 - (b_{12} + b_{23}) \\theta_2 + b_{23} \\theta_3 = 0, \\\\\nP_3 - D_3 + b_{23} \\theta_2 - (b_{13} + b_{23}) \\theta_3 = 0.\n\\end{aligned}\n$$\n- Inequality constraints for the single line limit on $(1,2)$:\n$$\n-b_{12} \\theta_2 \\le F_{12}^{\\max}, \\quad b_{12} \\theta_2 \\le F_{12}^{\\max}.\n$$\n- Generator bounds: $0 \\le P_1 \\le 100$, $0 \\le P_2 \\le 100$, $0 \\le P_3 \\le 50$. The angle variables $\\theta_2, \\theta_3$ are unconstrained except as implied by equality and line constraints.\n\nTest suite:\n- Case $1$: demands $D = [50, 50, 50]$ MW.\n- Case $2$: demands $D = [30, 120, 30]$ MW.\n- Case $3$: demands $D = [90, 110, 50]$ MW.\n\nYour program should solve the DC OPF for each test case, extract the optimal $[P_1, P_2, P_3]$, compute $[P_{12}, P_{13}, P_{23}]$, and obtain the nodal shadow prices $[\\lambda_1, \\lambda_2, \\lambda_3]$. The final output must be a single line containing the results as a comma-separated list of three inner lists, one per test case, with no spaces, in the exact format:\n\"[ [P1_case1,P2_case1,P3_case1,P12_case1,P13_case1,P23_case1,lambda1_case1,lambda2_case1,lambda3_case1], [P1_case2,P2_case2,P3_case2,P12_case2,P13_case2,P23_case2,lambda1_case2,lambda2_case2,lambda3_case2], [P1_case3,P2_case3,P3_case3,P12_case3,P13_case3,P23_case3,lambda1_case3,lambda2_case3,lambda3_case3] ]\"\nFor avoidance of ambiguity, your program should produce exactly a single line of output containing a top-level list of three comma-separated inner lists, each inner list containing nine numbers, with no spaces anywhere in the printed string. All values must be represented as standard decimal numbers.",
            "solution": "### Step 1: Extracted Givens\n\n- **Fundamental physical model**: The problem is based on the Direct Current (DC) power flow approximation.\n  - Line active power flow: $P_{ij} = b_{ij} \\left( \\theta_i - \\theta_j \\right)$.\n  - Nodal power balance: $p_i = P_i - D_i = \\sum_{j} b_{ij} \\left( \\theta_i - \\theta_j \\right)$.\n- **Network data**:\n  - Buses: $3$ (labeled $1, 2, 3$).\n  - Lines: $(1,2), (1,3), (2,3)$.\n  - Base power: $100$ MVA.\n  - Line reactances (per unit): $x_{12} = 0.25$, $x_{13} = 0.25$, $x_{23} = 0.50$.\n  - Line susceptances (MW/rad): $b_{12} = 400$, $b_{13} = 400$, $b_{23} = 200$.\n  - Bus susceptance matrix $B_{\\text{bus}}$ (MW/rad):\n    $$\n    B_{\\text{bus}} =\n    \\begin{bmatrix}\n    800  -400  -400 \\\\\n    -400  600  -200 \\\\\n    -400  -200  600\n    \\end{bmatrix}.\n    $$\n- **Reference bus**: Bus $1$ is the slack bus, with its voltage angle fixed: $\\theta_1 = 0$ radians.\n- **Generator data**:\n  - Linear cost functions: $C_i(P_i) = c_i P_i$.\n  - Cost coefficients: $c = [10, 12, 30]$ ($/MW) for generators at buses $1, 2, 3$.\n  - Capacity limits: $P^{\\min} = [0, 0, 0]$ MW, $P^{\\max} = [100, 100, 50]$ MW.\n- **Constraints**:\n  - Power balance equations at each bus.\n  - A single thermal limit on line $(1,2)$: $|P_{12}| \\leq 40$ MW.\n  - Generator output limits: $0 \\leq P_i \\leq P_i^{\\max}$.\n- **Objective function**: Minimize total generation cost $C_{\\text{total}} = \\sum_{i=1}^{3} c_i P_i$.\n- **Decision variables**: $[P_1, P_2, P_3, \\theta_2, \\theta_3]$.\n- **Test cases (Demands)**:\n  - Case $1$: $D = [50, 50, 50]$ MW.\n  - Case $2$: $D = [30, 120, 30]$ MW.\n  - Case $3$: $D = [90, 110, 50]$ MW.\n- **Required outputs**: Optimal generation $[P_1, P_2, P_3]$, line flows $[P_{12}, P_{13}, P_{23}]$, and Locational Marginal Prices (LMPs) $[\\lambda_1, \\lambda_2, \\lambda_3]$.\n\n### Step 2: Validation Using Extracted Givens\n\nThe problem is evaluated against the specified criteria:\n- **Scientifically Grounded**: The DC Optimal Power Flow (DC OPF) is a standard, widely used, and well-understood method in power systems engineering for economic analysis. The formulation is scientifically sound.\n- **Well-Posed**: The problem is a Linear Program (LP), characterized by a linear objective function and a set of linear equality and inequality constraints. As such, it is a convex optimization problem that is well-posed and has a unique minimum cost, provided a feasible solution exists. The provided demands appear reasonable relative to generation capacity.\n- **Objective**: The problem is stated using precise mathematical and engineering terminology with all constants and parameters clearly defined. There is no subjective or ambiguous language.\n- **Completeness and Consistency**: All necessary data (network topology, impedances, costs, limits, demands) are provided. The derivation of susceptances from reactances is correct ($b=1/x \\cdot 100$). The provided $B_{\\text{bus}}$ matrix is consistent with the line susceptances. The specified power balance equations are correct for the given network and choice of slack bus. The problem is self-contained and internally consistent.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. It is a standard DC OPF problem that can be solved using linear programming. The solution proceeds by formulating the problem in the standard LP form and solving it for each test case.\n\n### Solution Formulation\n\nThe DC OPF problem will be formulated as a Linear Program (LP) of the standard form, which can be solved using `scipy.optimize.linprog`:\n$$\n\\begin{align*}\n\\min_{x} \\quad  c^T x \\\\\n\\text{subject to} \\quad  A_{eq} x = b_{eq} \\\\\n A_{ub} x \\leq b_{ub} \\\\\n lb \\leq x \\leq ub\n\\end{align*}\n$$\n\n**1. Decision Variables ($x$)**\nThe vector of decision variables $x$ includes the generator active power outputs and the non-reference bus voltage angles:\n$$x = [P_1, P_2, P_3, \\theta_2, \\theta_3]^T$$\n\n**2. Objective Function ($c^T x$)**\nThe objective is to minimize the total generation cost, $C_{\\text{total}} = 10 P_1 + 12 P_2 + 30 P_3$. The bus angles do not have a cost. Therefore, the cost vector $c$ is:\n$$c = [10, 12, 30, 0, 0]^T$$\n\n**3. Equality Constraints ($A_{eq} x = b_{eq}$)**\nThe nodal power balance equations form the equality constraints. Given $\\theta_1=0$, the equations provided in the problem statement are rearranged to fit the standard form:\n$$P_1 - D_1 + b_{12}\\theta_2 + b_{13}\\theta_3 = 0 \\implies 1 \\cdot P_1 + 0 \\cdot P_2 + 0 \\cdot P_3 + 400 \\cdot \\theta_2 + 400 \\cdot \\theta_3 = D_1$$\n$$P_2 - D_2 - (b_{12}+b_{23})\\theta_2 + b_{23}\\theta_3 = 0 \\implies 0 \\cdot P_1 + 1 \\cdot P_2 + 0 \\cdot P_3 - 600 \\cdot \\theta_2 + 200 \\cdot \\theta_3 = D_2$$\n$$P_3 - D_3 + b_{23}\\theta_2 - (b_{13}+b_{23})\\theta_3 = 0 \\implies 0 \\cdot P_1 + 0 \\cdot P_2 + 1 \\cdot P_3 + 200 \\cdot \\theta_2 - 600 \\cdot \\theta_3 = D_3$$\nThis gives the equality constraint matrix $A_{eq}$ and vector $b_{eq}$:\n$$\nA_{eq} = \\begin{bmatrix}\n1  0  0  400  400 \\\\\n0  1  0  -600  200 \\\\\n0  0  1  200  -600\n\\end{bmatrix}, \\quad\nb_{eq} = \\begin{bmatrix} D_1 \\\\ D_2 \\\\ D_3 \\end{bmatrix}\n$$\nThe vector $b_{eq}$ will be updated for each test case according to the given demands $D$.\n\n**4. Variable Bounds ($lb \\leq x \\leq ub$)**\nThe bounds on the variables are derived from the generator capacity limits and the transmission line flow limit.\n- Generator limits:\n  - $0 \\leq P_1 \\leq 100$\n  - $0 \\leq P_2 \\leq 100$\n  - $0 \\leq P_3 \\leq 50$\n- Transmission line limit: The flow on line $(1,2)$ is $P_{12} = b_{12}(\\theta_1 - \\theta_2) = 400(0 - \\theta_2) = -400\\theta_2$. The constraint is $|P_{12}| \\leq 40$, which means $|-400\\theta_2| \\leq 40$, or $|\\theta_2| \\leq 40/400 = 0.1$.\n  - $-0.1 \\leq \\theta_2 \\leq 0.1$\n- The angle $\\theta_3$ is unbounded.\nThese constraints can be expressed as lower and upper bounds on the decision variables:\n$$\nlb = [0, 0, 0, -0.1, -\\infty]^T, \\quad ub = [100, 100, 50, 0.1, +\\infty]^T\n$$\nWith the line limit incorporated into the bounds, the inequality constraint matrices $A_{ub}$ and $b_{ub}$ are not needed.\n\n**5. Post-processing**\nOnce the optimization problem is solved for a given demand vector $D$, yielding the optimal solution vector $x^* = [P_1^*, P_2^*, P_3^*, \\theta_2^*, \\theta_3^*]^T$, the required outputs are calculated:\n- **Optimal Generation**: $[P_1^*, P_2^*, P_3^*]$ are the first three elements of $x^*$.\n- **Line Flows**: Calculated using the optimal angles, with $\\theta_1=0$:\n  - $P_{12} = b_{12}(\\theta_1 - \\theta_2^*) = -400 \\theta_2^*$\n  - $P_{13} = b_{13}(\\theta_1 - \\theta_3^*) = -400 \\theta_3^*$\n  - $P_{23} = b_{23}(\\theta_2^* - \\theta_3^*) = 200(\\theta_2^* - \\theta_3^*)$\n- **Locational Marginal Prices (LMPs)**: The LMPs, $[\\lambda_1, \\lambda_2, \\lambda_3]$, are the dual variables (shadow prices) associated with the nodal power balance equality constraints. The `scipy.optimize.linprog` function returns these as `res.eqlin.marginals`. These values represent the marginal cost of supplying an additional MW of power at each bus.\n\nThis complete formulation is implemented for each of the three test cases specified in the problem.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of DC Optimal Power Flow (DC-OPF) problems for a 3-bus network.\n\n    The problem is formulated as a Linear Program (LP) and solved using scipy.optimize.linprog.\n    The decision variables are x = [P1, P2, P3, theta2, theta3].\n    \"\"\"\n    \n    # ----------------------------------------------------------------------\n    # Define constants and problem parameters based on the problem statement\n    # ----------------------------------------------------------------------\n    \n    # Generator cost coefficients ($/MW)\n    c_gen = np.array([10.0, 12.0, 30.0])\n    \n    # Generator min/max power output (MW)\n    P_min = np.array([0.0, 0.0, 0.0])\n    P_max = np.array([100.0, 100.0, 50.0])\n    \n    # Line susceptances (MW/rad)\n    b12 = 400.0\n    b13 = 400.0\n    b23 = 200.0\n    \n    # Line flow limit for line (1,2) (MW)\n    F12_max = 40.0\n    \n    # Test cases: Demand vectors D = [D1, D2, D3] (MW)\n    test_cases = [\n        np.array([50.0, 50.0, 50.0]),\n        np.array([30.0, 120.0, 30.0]),\n        np.array([90.0, 110.0, 50.0]),\n    ]\n\n    # ----------------------------------------------------------------------\n    # Construct the LP matrices and vectors\n    # ----------------------------------------------------------------------\n    \n    # Objective function vector c for x = [P1, P2, P3, theta2, theta3]\n    # Costs are associated with P1, P2, P3. Angles theta2, theta3 have zero cost.\n    c = np.array([ c_gen[0], c_gen[1], c_gen[2], 0.0, 0.0 ])\n    \n    # Equality constraints: A_eq * x = b_eq\n    # Nodal power balance equations\n    # P1 - D1 + b12*theta2 + b13*theta3 = 0\n    # P2 - D2 - (b12+b23)*theta2 + b23*theta3 = 0\n    # P3 - D3 + b23*theta2 - (b13+b23)*theta3 = 0\n    A_eq = np.array([\n        [1, 0, 0, b12, b13],\n        [0, 1, 0, -(b12 + b23), b23],\n        [0, 0, 1, b23, -(b13 + b23)]\n    ])\n    \n    # Bounds for variables: lb = x = ub\n    # Bounds for P1, P2, P3\n    p_bounds = list(zip(P_min, P_max))\n    \n    # Bounds for theta2 from line limit: |P12| = F12_max\n    # |b12 * (theta1 - theta2)| = F12_max. With theta1=0, |-b12*theta2| = F12_max\n    # |theta2| = F12_max / b12\n    theta2_limit = F12_max / b12\n    theta_bounds = [(-theta2_limit, theta2_limit), (None, None)] # theta3 is unbounded\n    \n    bounds = p_bounds + theta_bounds\n\n    results = []\n    \n    # ----------------------------------------------------------------------\n    # Solve the LP for each test case\n    # ----------------------------------------------------------------------\n    for D in test_cases:\n        # The right-hand side of the equality constraints is the demand vector D\n        b_eq = D\n        \n        # Solve the linear program\n        res = linprog(c=c, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res.success:\n            # Handle cases where the solver fails (e.g., infeasible)\n            # For this problem set, solutions are expected to exist.\n            # Using placeholder values if a case were to fail.\n            case_result = [np.nan] * 9\n        else:\n            # Extract optimal solution\n            P1_opt, P2_opt, P3_opt, theta2_opt, theta3_opt = res.x\n            \n            # Store optimal generation\n            P_opt = [P1_opt, P2_opt, P3_opt]\n            \n            # Calculate line flows with theta1=0\n            P12_flow = b12 * (0 - theta2_opt)\n            P13_flow = b13 * (0 - theta3_opt)\n            P23_flow = b23 * (theta2_opt - theta3_opt)\n            \n            flows = [P12_flow, P13_flow, P23_flow]\n            \n            # Extract Locational Marginal Prices (LMPs)\n            # These are the dual variables of the nodal power balance equality constraints\n            LMPs = res.eqlin.marginals\n            \n            # Combine all results for the current case\n            case_result = P_opt + flows + list(LMPs)\n            \n        results.append(case_result)\n\n    # ----------------------------------------------------------------------\n    # Format and print the final output exactly as specified\n    # ----------------------------------------------------------------------\n    # Convert each inner list of numbers to a comma-separated string\n    case_strings = [','.join(map(str, case)) for case in results]\n    # Join the case strings into the final list-of-lists format\n    output_string = f\"[[{case_strings[0]}],[{case_strings[1]}],[{case_strings[2]}]]\"\n    \n    print(output_string)\n\nsolve()\n```"
        }
    ]
}