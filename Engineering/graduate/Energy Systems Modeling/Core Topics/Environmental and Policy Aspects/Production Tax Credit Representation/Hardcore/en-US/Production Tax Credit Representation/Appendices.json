{
    "hands_on_practices": [
        {
            "introduction": "The first step in any robust modeling exercise is ensuring the consistency of all input data. Production Tax Credit (PTC) policies are often specified in legislative texts using units like cents per kilowatt-hour, while large-scale energy system models typically operate with units of dollars per megawatt-hour. This practice focuses on the fundamental principle of unit invariance, where the total economic value of a credit must remain constant regardless of the units used in its calculation. Mastering this essential conversion  is a critical skill that prevents significant scaling errors and ensures your model's policy representation is accurate from the start.",
            "id": "4114288",
            "problem": "An energy system model represents generation outputs in megawatt-hours ($\\mathrm{MWh}$). A policy includes a Production Tax Credit (PTC), quoted as a rate $x$ in United States dollar per kilowatt-hour ($\\mathrm{USD}/\\mathrm{kWh}$). The model computes the total credit by multiplying a per-unit rate by the energy produced. To ensure scientific consistency, the credit computed from outputs must be invariant to the choice of energy unit representation.\n\nStarting from the definitions of power and energy units, and the linear relation between per-unit rates and total credit, derive the per-megawatt-hour rate $s$ in $\\mathrm{USD}/\\mathrm{MWh}$ that yields the same total credit when applied to outputs measured in $\\mathrm{MWh}$. Your derivation must justify the unit transformation from $\\mathrm{kWh}$ to $\\mathrm{MWh}$ using base unit definitions and the structure of a linear credit functional.\n\nProvide a single closed-form analytic expression for $s$ in terms of $x$. No numerical approximation is required. Express the final rate $s$ in $\\mathrm{USD}/\\mathrm{MWh}$. The final answer must be a single expression.",
            "solution": "The problem requires the derivation of a new production tax credit rate, $s$, in units of United States dollars per megawatt-hour ($\\mathrm{USD}/\\mathrm{MWh}$), from a given rate, $x$, in units of United States dollars per kilowatt-hour ($\\mathrm{USD}/\\mathrm{kWh}$). The fundamental constraint is that the total credit calculated for a given amount of energy production must be invariant to the choice of energy units. The derivation must be based on first principles of unit definitions and the linear nature of the credit calculation.\n\nLet $E$ represent a specific quantity of energy produced. The problem states that the total credit, which we denote as $C$, is a linear functional of the energy produced.\n\nWhen the energy $E$ is measured in kilowatt-hours ($\\mathrm{kWh}$), its numerical value is $E_{\\mathrm{kWh}}$. The per-unit rate is given as $x$, in units of $\\mathrm{USD}/\\mathrm{kWh}$. The total credit is calculated as:\n$$C = x \\cdot E_{\\mathrm{kWh}}$$\n\nWhen the same quantity of energy $E$ is measured in megawatt-hours ($\\mathrm{MWh}$), its numerical value is $E_{\\mathrm{MWh}}$. The per-unit rate in this case is the unknown value $s$, in units of $\\mathrm{USD}/\\mathrm{MWh}$. The total credit is calculated as:\n$$C = s \\cdot E_{\\mathrm{MWh}}$$\n\nThe core principle of invariance dictates that the total credit amount $C$ must be the same regardless of the units used for the calculation. Therefore, we can equate the two expressions for $C$:\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot E_{\\mathrm{kWh}}$$\n\nTo solve for $s$ in terms of $x$, we must establish the mathematical relationship between the numerical values $E_{\\mathrm{MWh}}$ and $E_{\\mathrm{kWh}}$. This relationship is derived from the definitions of the energy units $\\mathrm{kWh}$ and $\\mathrm{MWh}$.\n\nThe prefixes 'kilo' (k) and 'mega' (M) are standard SI prefixes representing factors of $10^3$ and $10^6$, respectively. Let $\\mathrm{Wh}$ denote the base energy unit of a watt-hour.\nThe definitions of kilowatt-hour and megawatt-hour are:\n$$1 \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{Wh}$$\n$$1 \\ \\mathrm{MWh} = 10^6 \\ \\mathrm{Wh}$$\n\nFrom these two definitions, we can establish a direct relationship between $\\mathrm{MWh}$ and $\\mathrm{kWh}$. We can express $\\mathrm{Wh}$ in terms of $\\mathrm{kWh}$ from the first equation:\n$$1 \\ \\mathrm{Wh} = 10^{-3} \\ \\mathrm{kWh}$$\nSubstituting this into the second equation yields the conversion factor between $\\mathrm{MWh}$ and $\\mathrm{kWh}$:\n$$1 \\ \\mathrm{MWh} = 10^6 \\cdot (10^{-3} \\ \\mathrm{kWh}) = 10^{(6-3)} \\ \\mathrm{kWh} = 10^3 \\ \\mathrm{kWh}$$\nThus, we have the unit relationship:\n$$1 \\ \\mathrm{MWh} = 1000 \\ \\mathrm{kWh}$$\n\nNow, we apply this relationship to the numerical values $E_{\\mathrm{MWh}}$ and $E_{\\mathrm{kWh}}$ for a given quantity of energy $E$. The quantity of energy $E$ can be expressed as the product of its numerical value and its unit:\n$$E = E_{\\mathrm{MWh}} \\ [\\mathrm{MWh}] = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\nUsing the unit relationship $1 \\ [\\mathrm{MWh}] = 1000 \\ [\\mathrm{kWh}]$, we substitute for the unit $[\\mathrm{MWh}]$:\n$$E_{\\mathrm{MWh}} \\cdot (1000 \\ [\\mathrm{kWh}]) = E_{\\mathrm{kWh}} \\ [\\mathrm{kWh}]$$\nBy canceling the common unit $[\\mathrm{kWh}]$ from both sides of the equation, we obtain the relationship between the numerical values:\n$$1000 \\cdot E_{\\mathrm{MWh}} = E_{\\mathrm{kWh}}$$\nThis result is logical: because a kilowatt-hour is a smaller unit of energy than a megawatt-hour, a given quantity of energy will have a numerical value that is $1000$ times larger when measured in $\\mathrm{kWh}$ compared to when it is measured in $\\mathrm{MWh}$.\n\nFinally, we substitute this relationship for $E_{\\mathrm{kWh}}$ back into our credit invariance equation:\n$$s \\cdot E_{\\mathrm{MWh}} = x \\cdot (1000 \\cdot E_{\\mathrm{MWh}})$$\nFor any non-zero amount of energy production, $E_{\\mathrm{MWh}} \\neq 0$, we can divide both sides of the equation by $E_{\\mathrm{MWh}}$:\n$$s = 1000 \\cdot x$$\nThis is the desired closed-form expression for the rate $s$ in terms of the rate $x$. The units are consistent, as the factor of $1000$ carries implicit units of $\\mathrm{kWh}/\\mathrm{MWh}$:\n$$[s] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{kWh}}\\right] \\cdot \\left[\\frac{\\mathrm{kWh}}{\\mathrm{MWh}}\\right] = \\left[\\frac{\\mathrm{USD}}{\\mathrm{MWh}}\\right]$$\nThe derived rate $s = 1000x$ will therefore be in units of $\\mathrm{USD}/\\mathrm{MWh}$, as required by the problem statement.",
            "answer": "$$\\boxed{1000x}$$"
        },
        {
            "introduction": "In optimization models, the application of a PTC is often conditional, representing an \"on/off\" status that depends on a generator's eligibility. This creates a mathematically challenging product of a binary decision variable and a continuous production variable, which would render a linear model non-linear and computationally intractable. This exercise introduces the powerful McCormick relaxation technique to linearize this product, demonstrating how to embed conditional logic within a mixed-integer linear programming (MILP) framework. This linearization skill  is a cornerstone of advanced energy systems modeling, enabling the tractable representation of countless discrete operational and policy decisions.",
            "id": "4114298",
            "problem": "An energy system planner wishes to represent Production Tax Credit (PTC) revenues for generators in a mixed-integer linear program. For each unit index $i$ and time index $t$, define a binary eligibility variable $a_{i,t}$ with domain $a_{i,t} \\in \\{0,1\\}$, a continuous production variable $q_{i,t}$ with bounds $L_{i,t} \\le q_{i,t} \\le U_{i,t}$ in megawatt-hour (MWh), and a continuous auxiliary variable $y_{i,t}$ intended to represent the product $y_{i,t} = a_{i,t} q_{i,t}$. Let the PTC rate be $c_{i,t}$ in United States dollars per megawatt-hour (USD/MWh), and define revenue $r_{i,t} = c_{i,t} y_{i,t}$ in United States dollars (USD). The goal is to express the product relationship between $a_{i,t}$ and $q_{i,t}$ using linear constraints that preserve computational tractability.\n\nStarting only from base facts and definitions (binary domain for $a_{i,t}$, interval bounds for $q_{i,t}$, linearity of constraints and objective in mixed-integer linear programming), derive a set of linear constraints that exactly enforce $y_{i,t} = a_{i,t} q_{i,t}$ for all feasible $(a_{i,t}, q_{i,t})$ using standard big-$M$ or indicator-constraint logic. Your derivation must justify how to select minimal and tight constants from the known bounds $L_{i,t}$ and $U_{i,t}$ for computational tractability. Then, implement the derived representation to compute revenues $r_{i,t}$ for specific test cases by deducing the unique value of $y_{i,t}$ implied by the constraints in each case.\n\nImplement a program that, for each test case $(L, U, a, q, c)$, computes the implied unique $y$ from your derived linear constraints and then computes $r = c \\cdot y$. Express $r$ in United States dollars (USD) as a float rounded to two decimal places.\n\nUse the following test suite of parameter values, each given as $(L, U, a, q, c)$ with $L$ and $U$ in megawatt-hour (MWh), $a \\in \\{0,1\\}$, $q$ in megawatt-hour (MWh), and $c$ in United States dollars per megawatt-hour (USD/MWh):\n\n- Case 1: $(L, U, a, q, c) = (0, 150, 0, 120, 26)$\n- Case 2: $(L, U, a, q, c) = (0, 120, 1, 85, 26)$\n- Case 3: $(L, U, a, q, c) = (10, 50, 0, 40, 26)$\n- Case 4: $(L, U, a, q, c) = (10, 50, 1, 25, 26)$\n- Case 5: $(L, U, a, q, c) = (0, 250, 1, 250, 15.75)$\n- Case 6: $(L, U, a, q, c) = (5, 5, 1, 5, 30)$\n- Case 7: $(L, U, a, q, c) = (0, 0, 1, 0, 26)$\n- Case 8: $(L, U, a, q, c) = (0, 200, 0, 0, 26)$\n\nYour program should produce a single line of output containing the revenues for the cases, in order, as a comma-separated list enclosed in square brackets, for example, $[r_1,r_2,\\dots,r_8]$. Each $r_k$ must be a float rounded to two decimals and expressed in United States dollars as specified above.",
            "solution": "The problem of representing the product of a binary variable and a continuous variable is a canonical task in mixed-integer linear programming (MILP). The problem as stated is valid: it is scientifically grounded in established mathematical optimization techniques, well-posed with all necessary information provided, and objective in its formulation.\n\nThe goal is to formulate a set of linear constraints to represent the non-linear relationship $y_{i,t} = a_{i,t} q_{i,t}$, where $a_{i,t} \\in \\{0, 1\\}$ is a binary variable, and $q_{i,t}$ is a continuous variable bounded by $L_{i,t} \\le q_{i,t} \\le U_{i,t}$. We seek to enforce this relationship for an auxiliary continuous variable $y_{i,t}$. All physical quantities are assumed to be non-negative, thus $0 \\le L_{i,t} \\le q_{i,t} \\le U_{i,t}$.\n\nThe derivation proceeds from the definition of the product, which can be broken down into two logical conditions based on the value of the binary variable $a_{i,t}$:\n1. If $a_{i,t} = 1$, the relationship becomes $y_{i,t} = q_{i,t}$.\n2. If $a_{i,t} = 0$, the relationship becomes $y_{i,t} = 0$.\n\nWe can formulate linear constraints that enforce these two conditions. This is achieved by constructing inequalities that correctly bound the variable $y_{i,t}$ and the difference $y_{i,t} - q_{i,t}$, leveraging the known bounds $L_{i,t}$ and $U_{i,t}$ on $q_{i,t}$. This is a standard approach known as a \"big-M\" formulation, or more precisely, the McCormick relaxation, which for this specific case provides an exact convex hull representation.\n\n**Derivation of the Linear Constraints**\n\nWe will derive four linear inequalities. The first two will constrain $y_{i,t}$ directly, and the next two will constrain the difference $y_{i,t} - q_{i,t}$.\n\n**Constraint 1: Upper Bound on $y_{i,t}$**\n- If $a_{i,t} = 1$, then $y_{i,t} = q_{i,t}$, and since $q_{i,t} \\le U_{i,t}$, we must have $y_{i,t} \\le U_{i,t}$.\n- If $a_{i,t} = 0$, then $y_{i,t} = 0$.\nA single inequality capturing both conditions is:\n$$y_{i,t} \\le U_{i,t} a_{i,t}$$\nIf $a_{i,t}=1$, this gives $y_{i,t} \\le U_{i,t}$. If $a_{i,t}=0$, it gives $y_{i,t} \\le 0$. Since production is non-negative, $y_{i,t}$ must also be non-negative, forcing $y_{i,t}=0$.\n\n**Constraint 2: Lower Bound on $y_{i,t}$**\n- If $a_{i,t} = 1$, then $y_{i,t} = q_{i,t}$, and since $q_{i,t} \\ge L_{i,t}$, we must have $y_{i,t} \\ge L_{i,t}$.\n- If $a_{i,t} = 0$, then $y_{i,t} = 0$.\nA single inequality capturing both conditions is:\n$$y_{i,t} \\ge L_{i,t} a_{i,t}$$\nIf $a_{i,t}=1$, this gives $y_{i,t} \\ge L_{i,t}$. If $a_{i,t}=0$, it gives $y_{i,t} \\ge 0$.\n\nLet's test these two constraints. If $a_{i,t}=0$, we have $y_{i,t} \\le 0$ and $y_{i,t} \\ge 0$, which correctly forces $y_{i,t}=0$. If $a_{i,t}=1$, we have $L_{i,t} \\le y_{i,t} \\le U_{i,t}$. This is necessary but not sufficient to enforce $y_{i,t}=q_{i,t}$. We need further constraints.\n\n**Constraint 3: Upper Bound on the difference $y_{i,t} - q_{i,t}$**\n- If $a_{i,t} = 1$, then $y_{i,t} - q_{i,t} = 0$.\n- If $a_{i,t} = 0$, then $y_{i,t}=0$, so the difference is $y_{i,t} - q_{i,t} = -q_{i,t}$. Since $L_{i,t} \\le q_{i,t} \\le U_{i,t}$, the difference is bounded by $-U_{i,t} \\le -q_{i,t} \\le -L_{i,t}$. The upper bound for the difference is $-L_{i,t}$.\nWe need an inequality of the form $y_{i,t} - q_{i,t} \\le M$, where $M$ depends on $a_{i,t}$. Let $M = k(1-a_{i,t})$. When $a_{i,t}=1$, $M=0$. When $a_{i,t}=0$, $M=k$. We need $k$ to be at least the maximum value of $y_{i,t}-q_{i,t}$ in this case, which is $-L_{i,t}$. So we can set $k = -L_{i,t}$. The constraint becomes $y_{i,t} - q_{i,t} \\le -L_{i,t}(1-a_{i,t})$, which rearranges to:\n$$y_{i,t} - q_{i,t} + L_{i,t}(1-a_{i,t}) \\le 0$$\nIf $a_{i,t}=1$, this gives $y_{i,t} - q_{i,t} \\le 0$, or $y_{i,t} \\le q_{i,t}$.\nIf $a_{i,t}=0$, this gives $y_{i,t} - q_{i,t} + L_{i,t} \\le 0$. Since $y_{i,t}=0$, this is $-q_{i,t} + L_{i,t} \\le 0 \\implies q_{i,t} \\ge L_{i,t}$, which is consistent with the bounds on $q_{i,t}$.\n\n**Constraint 4: Lower Bound on the difference $y_{i,t} - q_{i,t}$**\n- If $a_{i,t} = 1$, the lower bound is $0$.\n- If $a_{i,t} = 0$, the lower bound is $-U_{i,t}$.\nUsing similar logic, we can construct the constraint $y_{i,t} - q_{i,t} \\ge -U_{i,t}(1-a_{i,t})$, which rearranges to:\n$$y_{i,t} - q_{i,t} + U_{i,t}(1-a_{i,t}) \\ge 0$$\nIf $a_{i,t}=1$, this gives $y_{i,t} - q_{i,t} \\ge 0$, or $y_{i,t} \\ge q_{i,t}$.\nIf $a_{i,t}=0$, this gives $y_{i,t} - q_{i,t} + U_{i,t} \\ge 0$. As $y_{i,t}=0$, this is $-q_{i,t} + U_{i,t} \\ge 0 \\implies q_{i,t} \\le U_{i,t}$, which is also consistent.\n\n**Complete Formulation**\nThe complete set of four linear constraints that exactly models $y_{i,t} = a_{i,t} q_{i,t}$ is:\n1. $$y_{i,t} \\le U_{i,t} a_{i,t}$$\n2. $$y_{i,t} \\ge L_{i,t} a_{i,t}$$\n3. $$y_{i,t} - q_{i,t} \\le -L_{i,t} (1 - a_{i,t})$$\n4. $$y_{i,t} - q_{i,t} \\ge -U_{i,t} (1 - a_{i,t})$$\n\nWhen $a_{i,t}=1$, constraints 3 and 4 combine to enforce $y_{i,t} = q_{i,t}$. When $a_{i,t}=0$, constraints 1 and 2 combine to enforce $y_{i,t} = 0$. This formulation is exact and uses the tightest possible constant coefficients ($L_{i,t}$ and $U_{i,t}$), which improves the computational tractability of the resulting MILP by providing a tight linear programming relaxation.\n\n**Application to Test Cases**\nThe problem requires computing the revenue $r_{i,t} = c_{i,t} y_{i,t}$ for several test cases where the values of $L, U, a, q,$ and $c$ are provided. As demonstrated by the derivation, for any given feasible pair of $(a_{i,t}, q_{i,t})$, the derived constraints uniquely determine the value of $y_{i,t}$.\n- If $a_{i,t} = 0$, then $y_{i,t}=0$.\n- If $a_{i,t} = 1$, then $y_{i,t}=q_{i,t}$.\nThis is precisely the original non-linear definition, $y_{i,t} = a_{i,t} q_{i,t}$. Therefore, to find the implied value of $y_{i,t}$ and the resulting revenue for each test case, we can directly compute the product. The indices $i,t$ are dropped for simplicity in the context of the specific test cases. For each case $(L, U, a, q, c)$, we calculate $y = a \\cdot q$ and then $r = c \\cdot y$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes PTC revenues for a series of test cases based on a linearized\n    representation of the product of a binary and a continuous variable.\n    \"\"\"\n    # The problem statement provides test cases as tuples of (L, U, a, q, c).\n    # The dollar signs in the problem description are interpreted as formatting\n    # artifacts, and the numerical values are used directly.\n    test_cases = [\n        (0, 150, 0, 120, 26),\n        (0, 120, 1, 85, 26),\n        (10, 50, 0, 40, 26),\n        (10, 50, 1, 25, 26),\n        (0, 250, 1, 250, 15.75),\n        (5, 5, 1, 5, 30),\n        (0, 0, 1, 0, 26),\n        (0, 200, 0, 0, 26)\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack the parameters for the current test case.\n        L, U, a, q, c = case\n\n        # The core of the problem is to derive linear constraints for the product\n        # y = a * q. The derivation shows that for any given feasible pair (a, q),\n        # where a is in {0, 1} and L = q = U, the value of the auxiliary\n        # variable y is uniquely determined by the constraints to be exactly the\n        # product of a and q.\n        # If a = 0, the constraints force y = 0.\n        # If a = 1, the constraints force y = q.\n        # This is equivalent to y = a * q.\n        \n        # We can therefore compute y directly.\n        y = float(a) * float(q)\n        \n        # The revenue r is then the product of the PTC rate c and the\n        # production quantity receiving the credit, y.\n        revenue = float(c) * y\n        \n        # The problem requires the revenue to be rounded to two decimal places.\n        # We format it as a string to ensure trailing zeros are included.\n        results.append(f\"{revenue:.2f}\")\n\n    # The final output must be a single line containing a comma-separated list\n    # of the results, enclosed in square brackets.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Real-world energy investment decisions often involve choosing between mutually exclusive policy incentives, such as the volume-based Production Tax Credit (PTC) and the upfront Investment Tax Credit (ITC). Modeling this strategic choice requires synthesizing economic valuation principles with the mathematical techniques of optimization. This practice applies the linearization methods from the previous exercise to construct a complete Mixed-Integer Linear Program (MILP) that maximizes a project's Net Present Value ($NPV$) by selecting the optimal policy regime and investment capacity. By building and solving this model , you will gain hands-on experience in how optimization can provide quantitative insights into the complex trade-offs that drive energy infrastructure investments.",
            "id": "4114349",
            "problem": "You are tasked with constructing and solving a Mixed-Integer Linear Program (MILP) that represents the mutually exclusive choice between the Production Tax Credit (PTC) and the Investment Tax Credit (ITC) in a stylized energy system model of a single wind project. The model must be formulated from first principles of cash flow accounting, capacity-limited production, and linear optimization, and then implemented as a program that computes the optimal choice and investment and operational decisions for a small test suite. All physical and financial quantities must be expressed in specified units, and all variables, parameters, and numbers must be written in LaTeX.\n\nThe fundamental base for the derivation is:\n1. Net Present Value (NPV): cash flows are additive across periods, with present value weights. For each period $t$, a revenue cash flow equals the product of price and quantity, discounted to present value via a weight $w_t$. Investment outlay is paid at $t=0$ and is not discounted. The NPV to be maximized is the present value of revenues plus credits minus investment cost.\n2. Capacity-limited production: energy generation in period $t$, denoted $g_t$ in $\\mathrm{MWh}$, is limited by installed capacity $K$ in $\\mathrm{MW}$ and period-specific performance via\n$$\ng_t \\leq \\mathrm{CF}_t \\cdot H_t \\cdot K,\n$$\nwhere $\\mathrm{CF}_t \\in [0,1]$ is the capacity factor (unitless) and $H_t$ is the number of hours in period $t$ in $\\mathrm{h}$.\n3. Linear objective and constraints: the objective is a linear function of decision variables and the feasible region is defined by linear inequalities and bounds. Binary decision variables enforce policy regime selection.\n\nDefine the following notation and decision variables:\n- $K \\ge 0$ in $\\mathrm{MW}$ is the installed capacity.\n- $g_t \\ge 0$ in $\\mathrm{MWh}$ is the generation in period $t$.\n- $x \\in \\{0,1\\}$ is the binary variable selecting the Production Tax Credit (PTC) regime.\n- $y \\in \\{0,1\\}$ is the binary variable selecting the Investment Tax Credit (ITC) regime.\n- Mutual exclusivity is enforced by the equality\n$$\nx + y = 1.\n$$\n- The price of electricity in period $t$ is $p_t$ in $\\mathrm{USD/MWh}$.\n- The variable operating and maintenance cost per unit energy is $c_v$ in $\\mathrm{USD/MWh}$.\n- The capital expenditure per unit capacity is $c_{\\mathrm{cap}}$ in $\\mathrm{USD/MW}$.\n- The PTC rate is $r_{\\mathrm{PTC}}$ in $\\mathrm{USD/MWh}$.\n- The ITC rate is $r_{\\mathrm{ITC}}$ in $\\text{fraction}$ (unitless, e.g., $0.3$ for thirty percent).\n- Present value weight for period $t$ is $w_t$ (unitless).\n- A physical upper bound on capacity is $K_{\\max}$ in $\\mathrm{MW}$.\n\nTo maintain linearity without products between binary and continuous variables in the objective, use standard gating variables:\n- Introduce $g^{\\mathrm{PTC}}_t \\ge 0$ in $\\mathrm{MWh}$ such that $g^{\\mathrm{PTC}}_t = g_t$ if $x=1$ and $g^{\\mathrm{PTC}}_t = 0$ if $x=0$. This is represented via linear constraints with an upper bound $U_t$ on $g_t$:\n$$\n\\begin{aligned}\ng^{\\mathrm{PTC}}_t \\le g_t, \\\\\ng^{\\mathrm{PTC}}_t \\le x \\cdot U_t, \\\\\ng^{\\mathrm{PTC}}_t \\ge g_t - (1-x)\\cdot U_t, \\\\\ng^{\\mathrm{PTC}}_t \\ge 0,\n\\end{aligned}\n$$\nwhere $U_t$ is a valid constant upper bound on $g_t$, for example $U_t = \\mathrm{CF}_t \\cdot H_t \\cdot K_{\\max}$ in $\\mathrm{MWh}$.\n- Introduce $K^{\\mathrm{ITC}} \\ge 0$ in $\\mathrm{MW}$ such that $K^{\\mathrm{ITC}} = K$ if $y=1$ and $K^{\\mathrm{ITC}} = 0$ if $y=0$, with constraints\n$$\n\\begin{aligned}\nK^{\\mathrm{ITC}} \\le K, \\\\\nK^{\\mathrm{ITC}} \\le y \\cdot K_{\\max}, \\\\\nK^{\\mathrm{ITC}} \\ge K - (1-y)\\cdot K_{\\max}, \\\\\nK^{\\mathrm{ITC}} \\ge 0.\n\\end{aligned}\n$$\n\nThe NPV objective, in $\\mathrm{USD}$, is then\n$$\n\\max\\ \\sum_{t} w_t \\left( (p_t - c_v) g_t + r_{\\mathrm{PTC}}\\, g^{\\mathrm{PTC}}_t \\right) - c_{\\mathrm{cap}} K + r_{\\mathrm{ITC}} c_{\\mathrm{cap}} K^{\\mathrm{ITC}}.\n$$\n\nAll variables and parameters must respect their units:\n- $K$ and $K^{\\mathrm{ITC}}$ in $\\mathrm{MW}$,\n- $g_t$ and $g^{\\mathrm{PTC}}_t$ in $\\mathrm{MWh}$,\n- $p_t$, $c_v$, $r_{\\mathrm{PTC}}$ in $\\mathrm{USD/MWh}$,\n- $c_{\\mathrm{cap}}$ in $\\mathrm{USD/MW}$,\n- NPV in $\\mathrm{USD}$.\n\nYour program must solve this MILP by enumerating the binary decision in $\\{(x,y) : x \\in \\{0,1\\}, y=1-x\\}$, and for each fixed choice reduce to a Linear Program (LP) by setting $g^{\\mathrm{PTC}}_t = g_t$ when $x=1$ and $g^{\\mathrm{PTC}}_t = 0$ when $x=0$, and setting $K^{\\mathrm{ITC}} = K$ when $y=1$ and $K^{\\mathrm{ITC}} = 0$ when $y=0$. Solve the resulting LP with standard linear programming, choose the binary regime with the higher NPV, and if NPVs are equal choose the Investment Tax Credit (ITC) regime (i.e., set $y=1$) to break ties.\n\nTest suite:\n- Case 1 (general case where the Production Tax Credit can dominate):\n  - $T = 2$ periods.\n  - $H = [4380, 4380]$ in $\\mathrm{h}$.\n  - $\\mathrm{CF} = [0.35, 0.25]$ (unitless).\n  - $p = [40, 45]$ in $\\mathrm{USD/MWh}$.\n  - $c_v = 5$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{PTC}} = 23$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{ITC}} = 0.3$ (unitless fraction).\n  - $c_{\\mathrm{cap}} = 100000$ in $\\mathrm{USD/MW}$.\n  - $K_{\\max} = 100$ in $\\mathrm{MW}$.\n  - $w = [0.95, 0.90]$ (unitless).\n- Case 2 (boundary case where the Production Tax Credit is zero, favoring Investment Tax Credit):\n  - $T = 2$.\n  - $H = [4380, 4380]$ in $\\mathrm{h}$.\n  - $\\mathrm{CF} = [0.35, 0.25]$.\n  - $p = [40, 45]$ in $\\mathrm{USD/MWh}$.\n  - $c_v = 5$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{PTC}} = 0$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{ITC}} = 0.3$.\n  - $c_{\\mathrm{cap}} = 100000$ in $\\mathrm{USD/MW}$.\n  - $K_{\\max} = 100$ in $\\mathrm{MW}$.\n  - $w = [0.95, 0.90]$.\n- Case 3 (edge case where the energy price is low but a high Production Tax Credit can enable investment):\n  - $T = 2$.\n  - $H = [4380, 4380]$ in $\\mathrm{h}$.\n  - $\\mathrm{CF} = [0.35, 0.25]$.\n  - $p = [15, 16]$ in $\\mathrm{USD/MWh}$.\n  - $c_v = 20$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{PTC}} = 60$ in $\\mathrm{USD/MWh}$.\n  - $r_{\\mathrm{ITC}} = 0.3$.\n  - $c_{\\mathrm{cap}} = 100000$ in $\\mathrm{USD/MW}$.\n  - $K_{\\max} = 80$ in $\\mathrm{MW}$.\n  - $w = [0.95, 0.90]$.\n\nOutput specification:\n- For each test case, your program must compute the optimal binary choice $(x^\\star, y^\\star)$, optimal capacity $K^\\star$ in $\\mathrm{MW}$, optimal generation $g^\\star_t$ in $\\mathrm{MWh}$ for each period $t$, and the optimal Net Present Value $\\mathrm{NPV}^\\star$ in $\\mathrm{USD}$.\n- Your program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets. Each test case result must itself be a list of the form\n$$\n[x^\\star, y^\\star, K^\\star, g^\\star_1, \\dots, g^\\star_T, \\mathrm{NPV}^\\star],\n$$\nwhere $x^\\star$ and $y^\\star$ are integers, and $K^\\star$, $g^\\star_t$, and $\\mathrm{NPV}^\\star$ are real numbers. The units are as specified above.",
            "solution": "The user has provided a problem that requires the formulation and solution of a Mixed-Integer Linear Program (MILP) to model an investment decision in a wind power project. The decision involves a mutually exclusive choice between two tax credit policies: the Production Tax Credit (PTC) and the Investment Tax Credit (ITC). The problem is to be solved by enumerating the discrete choices, reducing the problem to two separate Linear Programs (LPs), and selecting the policy that yields the highest Net Present Value (NPV).\n\nThe problem, as stated, has been validated and found to be scientifically grounded, well-posed, objective, and internally consistent. It is a standard application of optimization techniques to energy-economic modeling. We may, therefore, proceed with the derivation and solution.\n\nThe core of the problem is to maximize the NPV of the project, which is a function of the installed capacity $K$ (in $\\mathrm{MW}$), the electricity generation $g_t$ in each period $t$ (in $\\mathrm{MWh}$), and the choice of tax credit regime, represented by binary variables $x$ (for PTC) and $y$ (for ITC).\n\nThe full MILP formulation is as follows:\n\n**Decision Variables:**\n-   $K \\ge 0$: installed capacity ($\\mathrm{MW}$).\n-   $g_t \\ge 0$: generation in period $t$ ($\\mathrm{MWh}$).\n-   $x, y \\in \\{0, 1\\}$: binary indicators for PTC and ITC regimes.\n-   $g^{\\mathrm{PTC}}_t \\ge 0$: generation qualifying for PTC in period $t$ ($\\mathrm{MWh}$).\n-   $K^{\\mathrm{ITC}} \\ge 0$: capacity qualifying for ITC ($\\mathrm{MW}$).\n\n**Objective Function (Maximize NPV):**\n$$\n\\max_{K, g_t, x, y, g^{\\mathrm{PTC}}_t, K^{\\mathrm{ITC}}} \\left( \\sum_{t} w_t \\left( (p_t - c_v) g_t + r_{\\mathrm{PTC}}\\, g^{\\mathrm{PTC}}_t \\right) - c_{\\mathrm{cap}} K + r_{\\mathrm{ITC}} c_{\\mathrm{cap}} K^{\\mathrm{ITC}} \\right)\n$$\n\n**Constraints:**\n1.  Mutual Exclusivity of Tax Credits:\n    $$x + y = 1$$\n2.  Capacity-Limited Generation:\n    $$g_t \\le \\mathrm{CF}_t \\cdot H_t \\cdot K \\quad \\forall t$$\n3.  Upper Bound on Capacity:\n    $$0 \\le K \\le K_{\\max}$$\n4.  Gating Constraints for PTC Generation ($g^{\\mathrm{PTC}}_t = x \\cdot g_t$):\n    $$\n    \\begin{aligned}\n    g^{\\mathrm{PTC}}_t \\le g_t \\\\\n    g^{\\mathrm{PTC}}_t \\le x \\cdot U_t \\\\\n    g^{\\mathrm{PTC}}_t \\ge g_t - (1-x)\\cdot U_t\n    \\end{aligned}\n    $$\n    where $U_t = \\mathrm{CF}_t \\cdot H_t \\cdot K_{\\max}$ is a valid upper bound for $g_t$.\n5.  Gating Constraints for ITC Capacity ($K^{\\mathrm{ITC}} = y \\cdot K$):\n    $$\n    \\begin{aligned}\n    K^{\\mathrm{ITC}} \\le K \\\\\n    K^{\\mathrm{ITC}} \\le y \\cdot K_{\\max} \\\\\n    K^{\\mathrm{ITC}} \\ge K - (1-y)\\cdot K_{\\max}\n    \\end{aligned}\n    $$\n6.  Non-negativity: All variables are non-negative.\n\nThe problem specifies solving this MILP by decomposing it into two separate LPs, corresponding to the two possible tax credit regimes.\n\n**Decomposition into Linear Programs**\n\n**1. The Production Tax Credit (PTC) Regime: $(x, y) = (1, 0)$**\nIf we fix $x=1$ and $y=0$, the MILP simplifies significantly.\nThe mutual exclusivity constraint $x+y=1$ is satisfied.\nThe gating constraints for $g^{\\mathrm{PTC}}_t$ reduce to $g^{\\mathrm{PTC}}_t \\le g_t$, $g^{\\mathrm{PTC}}_t \\le U_t$, and $g^{\\mathrm{PTC}}_t \\ge g_t$, which together enforce $g^{\\mathrm{PTC}}_t = g_t$.\nThe gating constraints for $K^{\\mathrm{ITC}}$ reduce to $K^{\\mathrm{ITC}} \\le K$, $K^{\\mathrm{ITC}} \\le 0$, and $K^{\\mathrm{ITC}} \\ge K - K_{\\max}$, which along with non-negativity enforces $K^{\\mathrm{ITC}} = 0$.\n\nSubstituting these into the objective function, we obtain the first linear program, LP$_{\\mathrm{PTC}}$:\n$$\n\\mathrm{NPV}_{\\mathrm{PTC}} = \\max_{K, g_t} \\left( \\sum_{t} w_t (p_t - c_v + r_{\\mathrm{PTC}}) g_t - c_{\\mathrm{cap}} K \\right)\n$$\nsubject to:\n$$\n\\begin{aligned}\ng_t \\le (\\mathrm{CF}_t \\cdot H_t) K \\quad \\forall t \\\\\n0 \\le K \\le K_{\\max} \\\\\ng_t \\ge 0 \\quad \\forall t\n\\end{aligned}\n$$\nThis is a linear program with decision variables $K$ and $g_t$ for all periods $t$.\n\n**2. The Investment Tax Credit (ITC) Regime: $(x, y) = (0, 1)$**\nIf we fix $x=0$ and $y=1$, a similar simplification occurs.\nThe gating constraints for $g^{\\mathrm{PTC}}_t$ become $g^{\\mathrm{PTC}}_t \\le g_t$, $g^{\\mathrm{PTC}}_t \\le 0$, and $g^{\\mathrm{PTC}}_t \\ge g_t - U_t$. With non-negativity, this enforces $g^{\\mathrm{PTC}}_t = 0$.\nThe gating constraints for $K^{\\mathrm{ITC}}$ become $K^{\\mathrm{ITC}} \\le K$, $K^{\\mathrm{ITC}} \\le K_{\\max}$, and $K^{\\mathrm{ITC}} \\ge K$, enforcing $K^{\\mathrm{ITC}} = K$.\n\nSubstituting these into the general objective function gives the second linear program, LP$_{\\mathrm{ITC}}$:\n$$\n\\mathrm{NPV}_{\\mathrm{ITC}} = \\max_{K, g_t} \\left( \\sum_{t} w_t (p_t - c_v) g_t - (1 - r_{\\mathrm{ITC}}) c_{\\mathrm{cap}} K \\right)\n$$\nsubject to the same set of constraints as LP$_{\\mathrm{PTC}}$:\n$$\n\\begin{aligned}\ng_t \\le (\\mathrm{CF}_t \\cdot H_t) K \\quad \\forall t \\\\\n0 \\le K \\le K_{\\max} \\\\\ng_t \\ge 0 \\quad \\forall t\n\\end{aligned}\n$$\n\n**Solution Algorithm**\nThe overall solution is found by executing the following steps for each test case:\n1.  Formulate and solve LP$_{\\mathrm{PTC}}$ to find the optimal capacity $K_{\\mathrm{PTC}}^\\star$, generation levels $g_{t, \\mathrm{PTC}}^\\star$, and the maximum net present value $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star$.\n2.  Formulate and solve LP$_{\\mathrm{ITC}}$ to find the optimal capacity $K_{\\mathrm{ITC}}^\\star$, generation levels $g_{t, \\mathrm{ITC}}^\\star$, and the maximum net present value $\\mathrm{NPV}_{\\mathrm{ITC}}^\\star$.\n3.  Compare the optimal values:\n    -   If $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star  \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$, the optimal strategy is to choose the PTC regime. The final solution is $(x^\\star, y^\\star) = (1, 0)$, $K^\\star = K_{\\mathrm{PTC}}^\\star$, $g_t^\\star = g_{t, \\mathrm{PTC}}^\\star$, and $\\mathrm{NPV}^\\star = \\mathrm{NPV}_{\\mathrm{PTC}}^\\star$.\n    -   Otherwise (if $\\mathrm{NPV}_{\\mathrm{PTC}}^\\star \\le \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$, including the tie-breaking case), the optimal strategy is to choose the ITC regime. The final solution is $(x^\\star, y^\\star) = (0, 1)$, $K^\\star = K_{\\mathrm{ITC}}^\\star$, $g_t^\\star = g_{t, \\mathrm{ITC}}^\\star$, and $\\mathrm{NPV}^\\star = \\mathrm{NPV}_{\\mathrm{ITC}}^\\star$.\n\nEach LP will be solved using a standard linear programming solver. The decision variables for the solver will be formulated as a vector $\\mathbf{z} = [K, g_1, \\dots, g_T]^T$. The objective function coefficients and constraint matrices will be constructed accordingly for each of the two subproblems.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a set of wind project investment problems, choosing between\n    Production Tax Credit (PTC) and Investment Tax Credit (ITC).\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"case_id\": 1,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([40, 45]),\n            \"c_v\": 5,\n            \"r_PTC\": 23,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 100,\n            \"w\": np.array([0.95, 0.90]),\n        },\n        {\n            \"case_id\": 2,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([40, 45]),\n            \"c_v\": 5,\n            \"r_PTC\": 0,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 100,\n            \"w\": np.array([0.95, 0.90]),\n        },\n        {\n            \"case_id\": 3,\n            \"T\": 2,\n            \"H\": np.array([4380, 4380]),\n            \"CF\": np.array([0.35, 0.25]),\n            \"p\": np.array([15, 16]),\n            \"c_v\": 20,\n            \"r_PTC\": 60,\n            \"r_ITC\": 0.3,\n            \"c_cap\": 100000,\n            \"K_max\": 80,\n            \"w\": np.array([0.95, 0.90]),\n        },\n    ]\n\n    results = []\n    for params in test_cases:\n        # Unpack parameters\n        T = params[\"T\"]\n        H = params[\"H\"]\n        CF = params[\"CF\"]\n        p = params[\"p\"]\n        c_v = params[\"c_v\"]\n        r_PTC = params[\"r_PTC\"]\n        r_ITC = params[\"r_ITC\"]\n        c_cap = params[\"c_cap\"]\n        K_max = params[\"K_max\"]\n        w = params[\"w\"]\n        \n        # --- Solve for PTC regime (x=1, y=0) ---\n        \n        # Objective function for maximization: \n        # sum(w_t * (p_t - c_v + r_PTC) * g_t) - c_cap * K\n        # For scipy.optimize.linprog (minimization):\n        # min c_cap*K - sum(w_t * (p_t - c_v + r_PTC) * g_t)\n        # Variables z = [K, g_1, ..., g_T]\n        \n        c_ptc = np.zeros(T + 1)\n        c_ptc[0] = c_cap\n        c_ptc[1:] = -w * (p - c_v + r_PTC)\n\n        # Constraints: g_t - CF_t * H_t * K = 0 for all t\n        # A_ub @ z = b_ub\n        A_ub = np.zeros((T, T + 1))\n        for t in range(T):\n            A_ub[t, 0] = -CF[t] * H[t]  # Coefficient for K\n            A_ub[t, t + 1] = 1         # Coefficient for g_t\n        b_ub = np.zeros(T)\n\n        # Bounds for variables: 0 = K = K_max, g_t = 0\n        bounds = [(0, K_max)] + [(0, None) for _ in range(T)]\n        \n        res_ptc = linprog(c_ptc, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n        \n        if res_ptc.success:\n            K_ptc = res_ptc.x[0] if res_ptc.x[0]  1e-9 else 0.0\n            g_ptc = res_ptc.x[1:]\n            g_ptc[g_ptc  1e-9] = 0.0\n            npv_ptc = -res_ptc.fun\n        else:\n            # If solver fails, assume zero investment is the fallback\n            K_ptc, g_ptc, npv_ptc = 0.0, np.zeros(T), 0.0\n\n        # --- Solve for ITC regime (x=0, y=1) ---\n\n        # Objective function for maximization:\n        # sum(w_t * (p_t - c_v) * g_t) - (1 - r_ITC) * c_cap * K\n        # For scipy.optimize.linprog (minimization):\n        # min (1 - r_ITC) * c_cap * K - sum(w_t * (p_t - c_v) * g_t)\n        \n        c_itc = np.zeros(T + 1)\n        c_itc[0] = (1 - r_ITC) * c_cap\n        c_itc[1:] = -w * (p - c_v)\n\n        # Constraints and bounds are the same as for the PTC case.\n        res_itc = linprog(c_itc, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs')\n        \n        if res_itc.success:\n            K_itc = res_itc.x[0] if res_itc.x[0]  1e-9 else 0.0\n            g_itc = res_itc.x[1:]\n            g_itc[g_itc  1e-9] = 0.0\n            npv_itc = -res_itc.fun\n        else:\n            # If solver fails, assume zero investment is the fallback\n            K_itc, g_itc, npv_itc = 0.0, np.zeros(T), 0.0\n\n        # --- Compare and select the optimal regime ---\n        \n        # Tie-breaking rule: if NPVs are equal, choose ITC\n        if npv_ptc  npv_itc:\n            x_star, y_star = 1, 0\n            K_star, g_star, npv_star = K_ptc, g_ptc, npv_ptc\n        else:\n            x_star, y_star = 0, 1\n            K_star, g_star, npv_star = K_itc, g_itc, npv_itc\n\n        # Format the result list for this case\n        case_result = [x_star, y_star, K_star] + list(g_star) + [npv_star]\n        results.append(case_result)\n\n\n    # Final print statement in the exact required format.\n    # The output format requires `str(list)` which includes brackets and spaces.\n    # Joining these string representations with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}