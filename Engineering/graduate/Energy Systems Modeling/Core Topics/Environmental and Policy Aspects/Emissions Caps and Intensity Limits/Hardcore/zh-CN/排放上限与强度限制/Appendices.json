{
    "hands_on_practices": [
        {
            "introduction": "准确的排放核算是任何有效排放法规的基石。本练习将探讨简化、仅依赖于负荷的排放计算与更全面的核算方法之间的区别，后者还包括了机组的空载和启动排放。通过实施这些计算()，您将亲身体会到建模假设会如何显著影响报告的排放量和合规结果，这是进行详细能源系统分析的一项关键技能。",
            "id": "4088133",
            "problem": "考虑一个发电系统，该系统由一组有限的发电机组成，其索引为 $g \\in \\{1,\\dots,G\\}$。该系统在一个离散时间范围内运行，其索引为 $t \\in \\{1,\\dots,T\\}$，每个时段的持续时间 $\\Delta t$ 均相同，单位为小时。对于每台发电机 $g$ 和每个时段 $t$，令 $p_{g,t}$ 表示以兆瓦 (MW) 为单位的输出电功率，令 $u_{g,t} \\in \\{0,1\\}$ 表示其启停状态指示器，其中 $u_{g,t} = 1$ 表示发电机处于开启状态，$u_{g,t} = 0$ 表示其处于关闭状态。启动指示器 $v_{g,t}$ 定义为 $v_{g,t} = \\max\\{0, u_{g,t} - u_{g,t-1}\\}$，并约定 $u_{g,0} = 0$。对于每台发电机 $g$，负荷相关排放率 $r_g$ 的单位为千克/兆瓦时 (kg/MWh)，发电机开启时的空载排放率 $n_g$ 的单位为千克/小时 (kg/h)，每次启动事件的启动排放量 $s_g$ 的单位为千克 (kg)。\n\n发电机 $g$ 在时段 $t$ 内产生的总电能为 $e_{g,t} = p_{g,t} \\Delta t$，单位为兆瓦时 (MWh)。发电机 $g$ 在时段 $t$ 内产生的负荷相关排放量与 $e_{g,t}$ 成正比，比例常数为 $r_g$。发电机 $g$ 在时段 $t$ 内产生的空载排放量等于 $n_g u_{g,t} \\Delta t$。发电机 $g$ 在时段 $t$ 内产生的启动排放量等于 $s_g v_{g,t}$。令 $E^{\\text{gen}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} e_{g,t}$ 表示在整个时间范围内产生的总电能（单位：MWh）。定义完全核算下的总排放量\n$$\nE^{\\text{full}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} \\left( r_g e_{g,t} + n_g u_{g,t} \\Delta t + s_g v_{g,t} \\right)\n$$\n和部分核算下的总排放量（忽略启动和空载部分）\n$$\nE^{\\text{partial}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} r_g e_{g,t}.\n$$\n定义完全核算下的平均排放强度为 $I^{\\text{full}} = E^{\\text{full}} / E^{\\text{gen}}$，部分核算下的平均排放强度为 $I^{\\text{partial}} = E^{\\text{partial}} / E^{\\text{gen}}$，二者均以千克/兆瓦时 (kg/MWh) 为单位。如果 $E^{\\text{gen}} = 0$，则在合规性评估中，将 $I^{\\text{full}} = +\\infty$ 和 $I^{\\text{partial}} = +\\infty$ 处理。\n\n给定以千克 (kg) 为单位的绝对排放上限 $C$ 和以千克/兆瓦时 (kg/MWh) 为单位的强度限值 $L$，合规性条件如下：完全核算上限合规性要求 $E^{\\text{full}} \\le C$，部分核算上限合规性要求 $E^{\\text{partial}} \\le C$，完全核算强度合规性要求 $I^{\\text{full}} \\le L$，部分核算强度合规性要求 $I^{\\text{partial}} \\le L$。令忽略启动和空载部分时总排放量的偏差为 $B_E = E^{\\text{partial}} - E^{\\text{full}}$，单位为千克 (kg)；强度的偏差为 $B_I = I^{\\text{partial}} - I^{\\text{full}}$，单位为千克/兆瓦时 (kg/MWh)。\n\n您的任务是实现一个程序，针对每个给定的测试用例，计算以下内容：\n- 以千克 (kg) 为单位的 $B_E$，\n- 以千克/兆瓦时 (kg/MWh) 为单位的 $B_I$，\n- 完全核算上限合规性布尔值（如果 $E^{\\text{full}} \\le C$ 则为 true，否则为 false），\n- 部分核算上限合规性布尔值（如果 $E^{\\text{partial}} \\le C$ 则为 true，否则为 false），\n- 完全核算强度合规性布尔值（如果 $I^{\\text{full}} \\le L$ 则为 true，否则为 false），\n- 部分核算强度合规性布尔值（如果 $I^{\\text{partial}} \\le L$ 则为 true，否则为 false）。\n\n所有强度均以千克/兆瓦时 (kg/MWh) 表示。不涉及角度。输出中任何地方均不得使用百分号；请使用十进制数。\n\n使用以下参数值测试套件。在所有情况下，时段持续时间均为 $\\Delta t = 1$ 小时。\n\n测试用例 $1$（理想路径，完全核算与部分核算下的合规性不同）：\n- 发电机数量 $G = 2$，时段数量 $T = 4$。\n- 发电机 $1$：$r_1 = 800$ kg/MWh, $n_1 = 60$ kg/h, $s_1 = 500$ kg。\n- 发电机 $2$：$r_2 = 400$ kg/MWh, $n_2 = 30$ kg/h, $s_2 = 300$ kg。\n- 在 $t = 1 \\dots 4$ 上的状态数组 $u_{1,t}$：$\\{1, 1, 0, 1\\}$；$u_{2,t}$：$\\{0, 1, 1, 1\\}$。\n- 在 $t = 1 \\dots 4$ 上以 MW 为单位的输出数组 $p_{1,t}$：$\\{50, 60, 0, 30\\}$；$p_{2,t}$：$\\{0, 40, 70, 50\\}$。\n- 排放上限 $C = 176500$ kg。\n- 强度限值 $L = 590$ kg/MWh。\n\n测试用例 $2$（边界条件，完全核算值等于限值）：\n- 发电机数量 $G = 1$，时段数量 $T = 3$。\n- 发电机 $1$：$r_1 = 500$ kg/MWh, $n_1 = 50$ kg/h, $s_1 = 200$ kg。\n- 在 $t = 1 \\dots 3$ 上的状态数组 $u_{1,t}$：$\\{1, 1, 0\\}$。\n- 在 $t = 1 \\dots 3$ 上以 MW 为单位的输出数组 $p_{1,t}$：$\\{20, 20, 0\\}$。\n- 排放上限 $C = 20300$ kg。\n- 强度限值 $L = 507.5$ kg/MWh。\n\n测试用例 $3$（边缘情况，频繁启停且启动排放量大）：\n- 发电机数量 $G = 1$，时段数量 $T = 6$。\n- 发电机 $1$：$r_1 = 300$ kg/MWh, $n_1 = 100$ kg/h, $s_1 = 1000$ kg。\n- 在 $t = 1 \\dots 6$ 上的状态数组 $u_{1,t}$：$\\{1, 0, 1, 0, 1, 0\\}$。\n- 在 $t = 1 \\dots 6$ 上以 MW 为单位的输出数组 $p_{1,t}$：$\\{30, 0, 35, 0, 40, 0\\}$。\n- 排放上限 $C = 33000$ kg。\n- 强度限值 $L = 320$ kg/MWh。\n\n测试用例 $4$（低负荷下持续运行；完全核算和部分核算均合规，以证明合规性无变化）：\n- 发电机数量 $G = 1$，时段数量 $T = 5$。\n- 发电机 $1$：$r_1 = 100$ kg/MWh, $n_1 = 80$ kg/h, $s_1 = 50$ kg。\n- 在 $t = 1 \\dots 5$ 上的状态数组 $u_{1,t}$：$\\{1, 1, 1, 1, 1\\}$。\n- 在 $t = 1 \\dots 5$ 上以 MW 为单位的输出数组 $p_{1,t}$：$\\{10, 10, 10, 10, 10\\}$。\n- 排放上限 $C = 6000$ kg。\n- 强度限值 $L = 120$ kg/MWh。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个测试用例的结果是一个列表，顺序为 $[B_E, B_I, \\text{cap\\_compliance\\_full}, \\text{cap\\_compliance\\_partial}, \\text{intensity\\_compliance\\_full}, \\text{intensity\\_compliance\\_partial}]$。例如，整体输出格式必须为 $[[\\dots],[\\dots],[\\dots],[\\dots]]$，其中包含四个对应于四个测试用例的内部列表，并且所有强度均以千克/兆瓦时 (kg/MWh) 表示，所有排放量均以千克 (kg) 表示。",
            "solution": "该问题要求在两种不同的核算方案（完全核算和部分核算）下，计算一个发电系统的排放相关指标。该系统由一组在 $T$ 个离散时段内运行的 $G$ 台发电机组成。解决方案需要系统地应用问题中提供的关于排放、能源和合规性的数学定义。\n\n首先，我们重申问题陈述中提供的基本量和定义。时段持续时间为 $\\Delta t$。对于每台发电机 $g \\in \\{1, \\dots, G\\}$ 和每个时段 $t \\in \\{1, \\dots, T\\}$：\n- $p_{g,t}$ 是以兆瓦 (MW) 为单位的功率输出。\n- $u_{g,t} \\in \\{0, 1\\}$ 是二进制启停状态。\n- $v_{g,t} = \\max\\{0, u_{g,t} - u_{g,t-1}\\}$ 是启动事件指示器，初始条件为 $u_{g,0} = 0$。\n\n每台发电机 $g$ 的参数如下：\n- $r_g$：负荷相关排放率 (kg/MWh)。\n- $n_g$：空载排放率 (kg/h)。\n- $s_g$：启动排放量 (kg/次启动)。\n\n基于这些，我们推导出以下量。发电机 $g$ 在时段 $t$ 内产生的电能为：\n$$e_{g,t} = p_{g,t} \\Delta t$$\n在整个时间范围内产生的总电能是所有发电机和所有时段的总和：\n$$E^{\\text{gen}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} e_{g,t}$$\n\n问题定义了两种计算总排放量的方法。部分核算方法仅考虑负荷相关排放：\n$$E^{\\text{partial}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} r_g e_{g,t}$$\n完全核算方法包括负荷相关排放、空载排放和启动排放：\n$$E^{\\text{full}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} \\left( r_g e_{g,t} + n_g u_{g,t} \\Delta t + s_g v_{g,t} \\right)$$\n这可以分解为 $E^{\\text{full}} = E^{\\text{partial}} + E^{\\text{no-load}} + E^{\\text{start-up}}$，其中：\n$$E^{\\text{no-load}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} n_g u_{g,t} \\Delta t$$\n$$E^{\\text{start-up}} = \\sum_{g=1}^{G} \\sum_{t=1}^{T} s_g v_{g,t}$$\n相应的平均排放强度定义为：\n$$I^{\\text{partial}} = \\frac{E^{\\text{partial}}}{E^{\\text{gen}}}$$\n$$I^{\\text{full}} = \\frac{E^{\\text{full}}}{E^{\\text{gen}}}$$\n如果 $E^{\\text{gen}} = 0$，则强度被视为无穷大。\n\n所需的输出是排放量和强度的偏差，以及四个合规性布尔值。\n总排放量的偏差是：\n$$B_E = E^{\\text{partial}} - E^{\\text{full}} = - (E^{\\text{no-load}} + E^{\\text{start-up}})$$\n强度的偏差是：\n$$B_I = I^{\\text{partial}} - I^{\\text{full}} = \\frac{E^{\\text{partial}}}{E^{\\text{gen}}} - \\frac{E^{\\text{full}}}{E^{\\text{gen}}} = \\frac{B_E}{E^{\\text{gen}}}$$\n合规性条件根据排放上限 $C$ 和强度限值 $L$ 进行检查：\n1.  完全核算上限合规性：$E^{\\text{full}} \\le C$\n2.  部分核算上限合规性：$E^{\\text{partial}} \\le C$\n3.  完全核算强度合规性：$I^{\\text{full}} \\le L$\n4.  部分核算强度合规性：$I^{\\text{partial}} \\le L$\n\n每个测试用例的算法流程如下：\n1.  给定每台发电机 $g$ 的输入数组 $u_{g,t}$ 和 $p_{g,t}$，参数 $r_g, n_g, s_g$，以及全局参数 $\\Delta t, C, L$。\n2.  对于每台发电机 $g$，使用定义 $v_{g,t} = \\max\\{0, u_{g,t} - u_{g,t-1}\\}$ 和 $u_{g,0}=0$ 计算 $t=1,\\dots,T$ 的启动指示器向量 $v_{g,t}$。\n3.  计算能量矩阵 $e_{g,t} = p_{g,t} \\Delta t$。\n4.  通过对 $e_{g,t}$ 矩阵的所有元素求和，计算总发电量 $E^{\\text{gen}}$。\n5.  如果 $E^{\\text{gen}} = 0$，处理无限强度的情况。否则，继续。\n6.  通过对能量矩阵 $e_{g,t}$ 以 $r_g$ 为权重进行加权求和，计算总部分排放量 $E^{\\text{partial}}$。\n7.  通过对状态矩阵 $u_{g,t}$ 以 $n_g$ 为权重进行加权求和并乘以 $\\Delta t$，计算总空载排放量 $E^{\\text{no-load}}$。\n8.  通过对启动矩阵 $v_{g,t}$ 以 $s_g$ 为权重进行加权求和，计算总启动排放量 $E^{\\text{start-up}}$。\n9.  计算总完全排放量 $E^{\\text{full}} = E^{\\text{partial}} + E^{\\text{no-load}} + E^{\\text{start-up}}$。\n10. 计算排放偏差 $B_E = E^{\\text{partial}} - E^{\\text{full}}$。\n11. 计算部分强度 $I^{\\text{partial}} = E^{\\text{partial}} / E^{\\text{gen}}$ 和完全强度 $I^{\\text{full}} = E^{\\text{full}} / E^{\\text{gen}}$。\n12. 计算强度偏差 $B_I = I^{\\text{partial}} - I^{\\text{full}}$。\n13. 通过将计算出的排放量和强度与提供的上限 $C$ 和限值 $L$ 进行比较，评估四个布尔合规性条件。\n14. 将六个结果（$B_E$、$B_I$ 和四个布尔值）组合成当前测试用例的列表。\n\n针对提供的每个测试用例实施此程序，利用数值库进行高效的数组操作。最终输出是一个列表，其中包含每个测试用例的结果列表。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the emissions calculation and compliance checking problem for a given set of test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            # Test Case 1\n            \"G\": 2, \"T\": 4, \"delta_t\": 1.0,\n            \"r\": np.array([800.0, 400.0]),\n            \"n\": np.array([60.0, 30.0]),\n            \"s\": np.array([500.0, 300.0]),\n            \"u\": np.array([[1, 1, 0, 1],\n                           [0, 1, 1, 1]]),\n            \"p\": np.array([[50.0, 60.0, 0.0, 30.0],\n                           [0.0, 40.0, 70.0, 50.0]]),\n            \"C\": 176500.0, \"L\": 590.0\n        },\n        {\n            # Test Case 2\n            \"G\": 1, \"T\": 3, \"delta_t\": 1.0,\n            \"r\": np.array([500.0]),\n            \"n\": np.array([50.0]),\n            \"s\": np.array([200.0]),\n            \"u\": np.array([[1, 1, 0]]),\n            \"p\": np.array([[20.0, 20.0, 0.0]]),\n            \"C\": 20300.0, \"L\": 507.5\n        },\n        {\n            # Test Case 3\n            \"G\": 1, \"T\": 6, \"delta_t\": 1.0,\n            \"r\": np.array([300.0]),\n            \"n\": np.array([100.0]),\n            \"s\": np.array([1000.0]),\n            \"u\": np.array([[1, 0, 1, 0, 1, 0]]),\n            \"p\": np.array([[30.0, 0.0, 35.0, 0.0, 40.0, 0.0]]),\n            \"C\": 33000.0, \"L\": 320.0\n        },\n        {\n            # Test Case 4\n            \"G\": 1, \"T\": 5, \"delta_t\": 1.0,\n            \"r\": np.array([100.0]),\n            \"n\": np.array([80.0]),\n            \"s\": np.array([50.0]),\n            \"u\": np.array([[1, 1, 1, 1, 1]]),\n            \"p\": np.array([[10.0, 10.0, 10.0, 10.0, 10.0]]),\n            \"C\": 6000.0, \"L\": 120.0\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Extract data from the case dictionary\n        G, T, delta_t = case[\"G\"], case[\"T\"], case[\"delta_t\"]\n        r, n, s = case[\"r\"], case[\"n\"], case[\"s\"]\n        u, p = case[\"u\"], case[\"p\"]\n        C, L = case[\"C\"], case[\"L\"]\n\n        # Ensure parameters are column vectors for broadcasting\n        r_col = r.reshape(-1, 1)\n        n_col = n.reshape(-1, 1)\n        s_col = s.reshape(-1, 1)\n\n        # 1. Calculate startup indicator v\n        # Prepend a column of zeros for u_g,0\n        u_padded = np.hstack((np.zeros((G, 1)), u))\n        v = np.maximum(0, np.diff(u_padded, axis=1))\n\n        # 2. Calculate energy e_g,t\n        e = p * delta_t\n\n        # 3. Calculate total generated energy E_gen\n        E_gen = np.sum(e)\n\n        # 4. Calculate partial emissions E_partial\n        E_partial = np.sum(r_col * e)\n\n        # 5. Calculate full emissions E_full\n        E_no_load = np.sum(n_col * u * delta_t)\n        E_startup = np.sum(s_col * v)\n        E_full = E_partial + E_no_load + E_startup\n\n        # 6. Calculate biases\n        B_E = E_partial - E_full\n        \n        # 7. Calculate intensities and intensity bias\n        if E_gen == 0:\n            I_full = float('inf')\n            I_partial = float('inf')\n            B_I = float('nan') # Or handle as per specific rules, here B_I would be `inf - inf`\n        else:\n            I_full = E_full / E_gen\n            I_partial = E_partial / E_gen\n            B_I = I_partial - I_full\n\n        # 8. Perform compliance checks\n        cap_compliance_full = E_full = C\n        cap_compliance_partial = E_partial = C\n        intensity_compliance_full = I_full = L\n        intensity_compliance_partial = I_partial = L\n\n        # 9. Store results for this case\n        case_results = [\n            B_E,\n            B_I,\n            cap_compliance_full,\n            cap_compliance_partial,\n            intensity_compliance_full,\n            intensity_compliance_partial\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string to match the required format without spaces\n    def format_inner_list(lst):\n        # Converts list items to string, with lowercase for booleans as required.\n        items = []\n        for v in lst:\n            if isinstance(v, bool):\n                items.append(str(v).lower())\n            else:\n                items.append(str(v))\n        return \"[\" + \",\".join(items) + \"]\"\n\n    output_str = \"[\" + \",\".join([format_inner_list(res) for res in all_results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "从排放核算转向经济学，我们现在研究排放政策如何创造基于市场的激励机制。本练习模拟了一个总量管制与交易体系，在该体系中，企业根据许可证价格优化其减排行为，从而达到市场均衡。通过构建并求解混合互补问题（MCP）()，您将学会如何描述和计算复杂环境市场的均衡结果，这些市场包含了不同政策工具之间的相互作用，例如总体排放上限和特定企业的排放强度限制。",
            "id": "4088149",
            "problem": "考虑一个针对二氧化碳排放的总量管制与交易计划，其中有三个价格接受者企业，索引为 $i \\in \\{1,2,3\\}$。每个企业都有外生性产出 $y_i$ 和基准排放强度 $\\alpha_i$，因此在未减排的情况下，基准排放量为 $E_i^{0} = \\alpha_i y_i$。每个企业选择减排量 $a_i$ 以最小化总合规成本，该成本包括凸性减排成本 $c_i(a_i)$ 和为剩余排放量 $E_i^{0} - a_i$ 支付价格为 $\\pi$ 的许可证的支出。排放强度限制规定 $E_i^{0} - a_i \\le \\bar{\\alpha}_i y_i$，其中 $\\bar{\\alpha}_i$ 是排放强度限值。企业层面的决策变量受到可行性 $0 \\le E_i^{0} - a_i$ 和强度限制的约束。经济体范围的总排放上限为 $C$，这导致了许可证的市场出清条件，即剩余排放量总和不能超过 $C$。\n\n从企业的成本最小化问题及其 Karush-Kuhn-Tucker (KKT) 最优性条件出发，并从具有非负价格的许可证的市场出清条件出发，构建一个具有明确互补关系的混合互补问题 (MCP)，该问题共同刻画了在带有强度限制的总量管制与交易计划下的竞争性均衡。然后，对于以下科学上合理的参数化，计算均衡许可证价格 $\\pi$：\n\n- 产出：$y_1 = 10$, $y_2 = 8$, $y_3 = 6$。\n- 基准排放强度：$\\alpha_1 = 1$, $\\alpha_2 = 1$, $\\alpha_3 = 1$。\n- 强度限制：$\\bar{\\alpha}_1 = 0.6$, $\\bar{\\alpha}_2 = 0.9$, $\\bar{\\alpha}_3 = 1.0$。\n- 基准排放量：$E_i^{0} = \\alpha_i y_i$（由上述参数推导）。\n- 减排成本函数：$c_i(a_i) = \\frac{1}{2} k_i a_i^{2}$，其中 $k_1 = 2$, $k_2 = 1$, $k_3 = 0.5$。\n- 总量上限：$C = 12$。\n\n以美元/吨二氧化碳的形式表示您对均衡许可证价格的最终答案。将答案四舍五入至四位有效数字。",
            "solution": "该问题经过审查，被认定为有效，因为它在经济学理论上具有科学依据，具有凸成本函数和线性约束，是适定、客观的，并包含一套完整且一致的数据和条件来寻找唯一均衡。\n\n解题过程分为两部分。首先，我们推导竞争性均衡的一般混合互补问题 (MCP) 结构。其次，我们应用具体参数化来计算均衡许可证价格 $\\pi$。\n\n### 第1部分：混合互补问题 (MCP) 的构建\n\n每个价格接受者企业 $i \\in \\{1,2,3\\}$ 寻求最小化其总合规成本，即减排成本与为其剩余排放量购买许可证的成本之和。企业的决策变量是减排水平 $a_i$。\n\n企业的优化问题是：\n$$ \\min_{a_i} \\quad C_i(a_i) = c_i(a_i) + \\pi (E_i^0 - a_i) $$\n约束条件如下：\n1.  非负排放量：$E_i^0 - a_i \\ge 0 \\implies a_i \\le E_i^0$。\n2.  强度限制：$E_i^0 - a_i \\le \\bar{\\alpha}_i y_i \\implies a_i \\ge E_i^0 - \\bar{\\alpha}_i y_i$。\n3.  非负减排量：$a_i \\ge 0$。\n\n我们定义企业 $i$ 的减排量有效下界为 $a_i^{\\min} = \\max(0, E_i^0 - \\bar{\\alpha}_i y_i)$，上界为 $a_i^{\\max} = E_i^0$。企业 $i$ 的问题简化为：\n$$ \\min_{a_i} \\quad c_i(a_i) - \\pi a_i $$\n(去掉常数项 $\\pi E_i^0$)\n约束条件为：\n$$ a_i^{\\min} \\le a_i \\le a_i^{\\max} $$\n\n为了推导 Karush-Kuhn-Tucker (KKT) 条件，我们为企业 $i$ 的问题构建拉格朗日函数，为下界约束（$a_i - a_i^{\\min} \\ge 0$）引入拉格朗日乘子 $\\mu_i \\ge 0$，为上界约束（$a_i^{\\max} - a_i \\ge 0$）引入拉格朗日乘子 $\\nu_i \\ge 0$：\n$$ \\mathcal{L}_i(a_i, \\mu_i, \\nu_i) = c_i(a_i) - \\pi a_i - \\mu_i(a_i - a_i^{\\min}) - \\nu_i(a_i^{\\max} - a_i) $$\n\n企业 $i$ 的 KKT 条件是：\n1.  **平稳性：**\n    $$ \\frac{\\partial \\mathcal{L}_i}{\\partial a_i} = c'_i(a_i) - \\pi - \\mu_i + \\nu_i = 0 $$\n2.  **原始可行性：**\n    $$ a_i - a_i^{\\min} \\ge 0 $$\n    $$ a_i^{\\max} - a_i \\ge 0 $$\n3.  **对偶可行性：**\n    $$ \\mu_i \\ge 0 $$\n    $$ \\nu_i \\ge 0 $$\n4.  **互补松弛性：**\n    $$ \\mu_i (a_i - a_i^{\\min}) = 0 $$\n    $$ \\nu_i (a_i^{\\max} - a_i) = 0 $$\n\n这些条件定义了在给定的许可证价格 $\\pi$ 下，每个企业的最优行为。\n\n均衡的第二个组成部分是排放许可证的市场出清条件。企业所需求的许可证总数量（其总剩余排放量）必须小于或等于许可证的总供给量 $C$。许可证价格 $\\pi$ 必须为非负。如果总排放量严格小于上限，则许可证价格必须为零。这是一个互补条件。\n$$ C - \\sum_{i=1}^3 (E_i^0 - a_i) \\ge 0, \\quad \\pi \\ge 0, \\quad \\pi \\left( C - \\sum_{i=1}^3 (E_i^0 - a_i) \\right) = 0 $$\n其中 $(E_i^0 - a_i)$ 是企业 $i$ 的剩余排放量。\n\n完全市场均衡由所有企业的 KKT 条件和市场出清条件同时成立所刻画。这个系统构成一个混合互补问题 (MCP)。变量是 $(a_1, a_2, a_3, \\mu_1, \\mu_2, \\mu_3, \\nu_1, \\nu_2, \\nu_3, \\pi)$。MCP 由以下关系定义：\n- 对于每个企业 $i \\in \\{1,2,3\\}$:\n  1. $c'_i(a_i) - \\pi - \\mu_i + \\nu_i = 0$\n  2. $0 \\le \\mu_i \\quad \\perp \\quad a_i - a_i^{\\min} \\ge 0$\n  3. $0 \\le \\nu_i \\quad \\perp \\quad a_i^{\\max} - a_i \\ge 0$\n- 对于市场:\n  4. $0 \\le \\pi \\quad \\perp \\quad C - \\sum_{i=1}^3 (E_i^0 - a_i) \\ge 0$\n\n在这里，符号 $\\perp$ 表示互补性 (即，$A \\perp B$ 意味着 $A \\ge 0, B \\ge 0, AB = 0$）。\n\n### 第2部分：均衡许可证价格的计算\n\n现在我们将给定的参数代入模型。\n- **产出：** $y_1 = 10$, $y_2 = 8$, $y_3 = 6$。\n- **基准强度：** $\\alpha_1 = 1$, $\\alpha_2 = 1$, $\\alpha_3 = 1$。\n- **基准排放量：** $E_1^0 = 10$, $E_2^0 = 8$, $E_3^0 = 6$。总基准排放量 $\\sum E_i^0 = 24$。\n- **强度限制：** $\\bar{\\alpha}_1 = 0.6$, $\\bar{\\alpha}_2 = 0.9$, $\\bar{\\alpha}_3 = 1.0$。\n- **减排成本参数：** $k_1 = 2$, $k_2 = 1$, $k_3 = 0.5$。\n- **减排成本函数：** $c_1(a_1) = a_1^2$, $c_2(a_2) = \\frac{1}{2} a_2^2$, $c_3(a_3) = \\frac{1}{4} a_3^2$。\n- **边际减排成本函数：** $c'_1(a_1) = 2a_1$, $c'_2(a_2) = a_2$, $c'_3(a_3) = \\frac{1}{2}a_3$。\n- **总量上限：** $C = 12$。\n\n总所需减排量为 $\\sum a_i = (\\sum E_i^0) - C = 24 - 12 = 12$。由于总减排量必须为正，上限是具有约束力的，因此均衡许可证价格 $\\pi$ 将为正。市场出清条件简化为 $\\sum a_i = 12$。\n\n接下来，我们确定每个企业的可行减排范围 $[a_i^{\\min}, a_i^{\\max}]$。\n- **企业 1：** $a_1^{\\min} = E_1^0 - \\bar{\\alpha}_1 y_1 = 10 - (0.6)(10) = 4$。$a_1^{\\max} = 10$。范围：$[4, 10]$。\n- **企业 2：** $a_2^{\\min} = E_2^0 - \\bar{\\alpha}_2 y_2 = 8 - (0.9)(8) = 0.8$。$a_2^{\\max} = 8$。范围：$[0.8, 8]$。\n- **企业 3：** $a_3^{\\min} = E_3^0 - \\bar{\\alpha}_3 y_3 = 6 - (1.0)(6) = 0$。$a_3^{\\max} = 6$。范围：$[0, 6]$。\n\n根据 KKT 条件，如果一个企业的减排量 $a_i$ 在其可行范围的内部（$a_i^{\\min}  a_i  a_i^{\\max}$），其乘子 $\\mu_i$ 和 $\\nu_i$ 为零，其边际减排成本等于许可证价格：$c'_i(a_i) = \\pi$。\n这使我们能够将每个企业的减排水平 $a_i$ 表示为 $\\pi$ 的函数：\n$a_i(\\pi) = \\begin{cases} a_i^{\\min}  \\text{当 } c'_i(a_i^{\\min})  \\pi \\\\ (c'_i)^{-1}(\\pi)  \\text{当 } c'_i(a_i^{\\min}) \\le \\pi \\le c'_i(a_i^{\\max}) \\\\ a_i^{\\max}  \\text{当 } c'_i(a_i^{\\max})  \\pi \\end{cases}$\n\n让我们计算每个企业在边界处的边际成本：\n- **企业 1：** $c'_1(a_1^{\\min}) = c'_1(4) = 2(4) = 8$。$c'_1(a_1^{\\max}) = c'_1(10) = 2(10) = 20$。\n  $a_1(\\pi) = \\begin{cases} 4  \\text{当 } \\pi  8 \\\\ \\pi/2  \\text{当 } 8 \\le \\pi \\le 20 \\\\ 10  \\text{当 } \\pi  20 \\end{cases}$\n- **企业 2：** $c'_2(a_2^{\\min}) = c'_2(0.8) = 0.8$。$c'_2(a_2^{\\max}) = c'_2(8) = 8$。\n  $a_2(\\pi) = \\begin{cases} 0.8  \\text{当 } \\pi  0.8 \\\\ \\pi  \\text{当 } 0.8 \\le \\pi \\le 8 \\\\ 8  \\text{当 } \\pi  8 \\end{cases}$\n- **企业 3：** $c'_3(a_3^{\\min}) = c'_3(0) = \\frac{1}{2}(0) = 0$。$c'_3(a_3^{\\max}) = c'_3(6) = \\frac{1}{2}(6) = 3$。\n  $a_3(\\pi) = \\begin{cases} 2\\pi  \\text{当 } 0 \\le \\pi \\le 3 \\\\ 6  \\text{当 } \\pi  3 \\end{cases}$\n\n均衡价格 $\\pi$ 通过求解 $\\sum_{i=1}^3 a_i(\\pi) = 12$ 来找到。令 $A(\\pi) = a_1(\\pi) + a_2(\\pi) + a_3(\\pi)$。我们检验由断点 $\\{0, 0.8, 3, 8, 20\\}$ 定义的 $\\pi$ 的区间。\n\n1.  **区间 $0 \\le \\pi  0.8$**：\n    $A(\\pi) = 4 + 0.8 + 2\\pi = 4.8 + 2\\pi$。\n    $A(\\pi)$ 的范围是 $[4.8, 6.4)$。由于 $12$ 不在此范围内，解不在此区间。\n\n2.  **区间 $0.8 \\le \\pi  3$**：\n    $A(\\pi) = 4 + \\pi + 2\\pi = 4 + 3\\pi$。\n    $A(\\pi)$ 的范围是 $[A(0.8), A(3)) = [4 + 3(0.8), 4 + 3(3)) = [6.4, 13)$。\n    目标减排量 $12$ 位于此范围内。我们令 $A(\\pi) = 12$：\n    $$ 4 + 3\\pi = 12 $$\n    $$ 3\\pi = 8 $$\n    $$ \\pi = \\frac{8}{3} $$\n    值 $\\pi = 8/3 \\approx 2.667$ 确实在区间 $[0.8, 3)$ 内，因此这是均衡价格。\n\n让我们计算在此价格下的减排水平以进行确认：\n- $a_1(\\pi=8/3)$: 由于 $8/3  8$, $a_1 = 4$。\n- $a_2(\\pi=8/3)$: 由于 $0.8 \\le 8/3 \\le 8$, $a_2 = \\pi = 8/3$。\n- $a_3(\\pi=8/3)$: 由于 $0 \\le 8/3 \\le 3$, $a_3 = 2\\pi = 2(8/3) = 16/3$。\n\n总减排量：$\\sum a_i = 4 + \\frac{8}{3} + \\frac{16}{3} = 4 + \\frac{24}{3} = 4 + 8 = 12$。这与所需的总减排量相符。\n\n均衡许可证价格为 $\\pi = 8/3$。题目要求将此值四舍五入至四位有效数字。\n$\\pi = 8/3 = 2.6666...$\n四舍五入至四位有效数字得到 $2.667$。",
            "answer": "$$\\boxed{2.667}$$"
        },
        {
            "introduction": "能源系统建模的最终目标通常是在面临气候目标等约束条件下，为长期战略决策提供指导。这最后一个练习涉及构建一个容量扩展模型，以确定在累积碳预算下，多时期规划范围内发电技术的最佳组合。通过构建并求解这个线性规划问题()，您将看到一个长期政策约束如何转化为隐含的碳价轨迹，并推动投资从高排放技术转向低排放技术，从而为政策制定和基础设施规划提供关键见解。",
            "id": "4088134",
            "problem": "考虑一个由 $T$ 个离散时期组成的规划期，时期索引为 $t \\in \\{1, \\dots, T\\}$，存在两种发电技术：煤电和天然气发电。规划者选择新增容量和各时期的发电量，以最小化净现值成本 (NPC)，同时需满足能源平衡、容量可用性和累积碳预算约束。所有时期均为年度，每个时期包含 $H$ 小时。目标是，对于测试套件中的每一组参数，计算最优的装机容量组合（煤电和天然气）以及在累积预算下隐含的碳价轨迹。\n\n基本原理和定义：\n- 净现值成本 (NPC)：$\\text{NPC} = \\sum_{t=1}^{T} d_t \\left( \\sum_{i \\in \\{\\text{coal}, \\text{gas}\\}} \\left( f_i K_i + v_i G_{i,t} \\right) \\right) + \\sum_{i \\in \\{\\text{coal}, \\text{gas}\\}} I_i \\Delta K_i$，其中 $d_t$ 是时期 $t$ 的贴现因子，$f_i$ 是单位兆瓦年的固定运营和维护成本（美元/兆瓦·年），$K_i$ 是总装机容量（兆瓦），$v_i$ 是可变成本（美元/兆瓦时），$G_{i,t}$ 是发电量（兆瓦时），$I_i$ 是单位兆瓦的一次性投资成本（美元/兆瓦），$\\Delta K_i$ 是容量增加决策（兆瓦）。\n- 贴现因子：$d_t = (1+r)^{-(t-1)}$，其中 $r$ 为贴现率。\n- 能源平衡：对于每个时期 $t$，$\\sum_{i} G_{i,t} = D_t$，其中 $D_t$ 是需求量（兆瓦时）。\n- 容量可用性：对于每种技术 $i$ 和每个时期 $t$，$G_{i,t} \\leq \\alpha_{i,t} H K_i$，其中 $\\alpha_{i,t}$ 是可用性因子（无量纲），$H$ 是每时期的总小时数（小时/年），$K_i$ 是总容量 $K_i = K_{i,0} + \\Delta K_i$，其中 $K_{i,0}$ 是现有容量，$\\Delta K_i \\geq 0$。\n- 排放：对于每种技术 $i$，排放因子 $e_i$ 的单位是公吨二氧化碳/兆瓦时（$\\text{tCO}_2/\\text{MWh}$）。累积碳预算约束：$\\sum_{t=1}^{T} \\sum_{i} e_i G_{i,t} \\leq B$，其中 $B$ 是总预算（公吨二氧化碳）。\n\n该优化问题在决策变量 $\\Delta K_{\\text{coal}}$、$\\Delta K_{\\text{gas}}$、$G_{\\text{coal},t}$ 和 $G_{\\text{gas},t}$ 上是线性的。设与累积碳预算相关的拉格朗日乘子为 $\\lambda_B$（单位为美元/公吨二氧化碳，以现值计）。根据标准线性规划对偶理论，如果预算约束是紧约束，则时期 $t$ 的隐含同期碳价（记为 $p_t$）与累积预算乘子之间的关系为 $p_t = \\lambda_B / d_t$（单位为美元/公吨二氧化碳）。如果预算约束为非紧约束，则 $\\lambda_B = 0$，因此所有时期的 $p_t = 0$。\n\n您的任务是：\n1. 构建上述线性规划模型。\n2. 求解该模型以获得最优容量增量 $\\Delta K_{\\text{coal}}$ 和 $\\Delta K_{\\text{gas}}$、总装机容量 $K_{\\text{coal}}$ 和 $K_{\\text{gas}}$，以及基于预算约束的影子价格 $\\lambda_B$ 得出的所有时期的隐含碳价轨迹 $p_t$。\n3. 为所提供的测试套件生成最终输出。\n\n单位和输出规范：\n- 装机容量 $K_{\\text{coal}}$ 和 $K_{\\text{gas}}$ 必须以兆瓦（$\\text{MW}$）为单位表示，并四舍五入到两位小数。\n- 隐含碳价 $p_t$ 必须以美元/公吨二氧化碳（$\\$/\\text{tCO}_2$）为单位表示，并四舍五入到两位小数。\n- 本问题不使用角度。\n- 百分比：如果出现任何百分比，必须将其转换为小数形式。\n\n测试套件：\n所有案例均使用 $T=3$ 个时期，每时期 $H=8760$ 小时，贴现率 $r=0.05$。技术参数在所有案例中保持不变：\n- 投资成本：$I_{\\text{coal}} = 2000000$ 美元/兆瓦，$I_{\\text{gas}} = 1000000$ 美元/兆瓦。\n- 固定运营和维护成本：$f_{\\text{coal}} = 40000$ 美元/兆瓦·年，$f_{\\text{gas}} = 20000$ 美元/兆瓦·年。\n- 可变成本：$v_{\\text{coal}} = 20$ 美元/兆瓦时，$v_{\\text{gas}} = 35$ 美元/兆瓦时。\n- 排放因子：$e_{\\text{coal}} = 0.90$ $\\text{tCO}_2/\\text{MWh}$，$e_{\\text{gas}} = 0.35$ $\\text{tCO}_2/\\text{MWh}$。\n- 可用性因子：所有 $t$ 的 $\\alpha_{\\text{coal},t} = 0.85$，所有 $t$ 的 $\\alpha_{\\text{gas},t} = 0.90$。\n- 现有容量：$K_{\\text{coal},0} = 400$ 兆瓦，$K_{\\text{gas},0} = 200$ 兆瓦。\n- 需求：$D_1 = 5000000$ 兆瓦时，$D_2 = 5500000$ 兆瓦时，$D_3 = 6000000$ 兆瓦时。\n\n定义三种碳预算案例：\n- 案例 A（中等约束性预算）：$B = 8000000$ $\\text{tCO}_2$。\n- 案例 B（非约束性预算）：$B = 20000000$ $\\text{tCO}_2$。\n- 案例 C（紧预算）：$B = 6000000$ $\\text{tCO}_2$。\n\n要求的最终输出格式：\n- 对于每个测试案例，输出一个包含总装机容量和碳价轨迹的列表：$[K_{\\text{coal}}, K_{\\text{gas}}, p_1, p_2, p_3]$。\n- 您的程序应生成一行输出，其中包含所有测试案例的结果，格式为一个逗号分隔的列表，用方括号括起来，每个测试案例的结果也用各自的方括号括起来，并且没有空格。例如：$[[K_{\\text{coal}}^{(A)},K_{\\text{gas}}^{(A)},p_1^{(A)},p_2^{(A)},p_3^{(A)}],[K_{\\text{coal}}^{(B)},K_{\\text{gas}}^{(B)},p_1^{(B)},p_2^{(B)},p_3^{(B)}],[K_{\\text{coal}}^{(C)},K_{\\text{gas}}^{(C)},p_1^{(C)},p_2^{(C)},p_3^{(C)}]]$。",
            "solution": "### 步骤 1：提取已知条件\n\n问题提供了以下用于电力系统优化模型的数据、变量和定义。\n\n**时间范围与技术：**\n- 时期数：$T=3$\n- 每时期小时数：$H=8760$\n- 技术：$i \\in \\{\\text{coal}, \\text{gas}\\}$\n\n**经济参数：**\n- 贴现率：$r=0.05$\n- 贴现因子：$d_t = (1+r)^{-(t-1)}$\n- 投资成本：$I_{\\text{coal}} = 2000000$ 美元/兆瓦，$I_{\\text{gas}} = 1000000$ 美元/兆瓦\n- 固定运营维护成本：$f_{\\text{coal}} = 40000$ 美元/兆瓦·年，$f_{\\text{gas}} = 20000$ 美元/兆瓦·年\n- 可变成本：$v_{\\text{coal}} = 20$ 美元/兆瓦时，$v_{\\text{gas}} = 35$ 美元/兆瓦时\n\n**技术与环境参数：**\n- 可用性因子：所有 $t$ 的 $\\alpha_{\\text{coal},t} = 0.85$，所有 $t$ 的 $\\alpha_{\\text{gas},t} = 0.90$\n- 排放因子：$e_{\\text{coal}} = 0.90$ $\\text{tCO}_2/\\text{MWh}$，$e_{\\text{gas}} = 0.35$ $\\text{tCO}_2/\\text{MWh}$\n\n**初始状态与需求：**\n- 现有容量：$K_{\\text{coal},0} = 400$ 兆瓦，$K_{\\text{gas},0} = 200$ 兆瓦\n- 需求：$D_1 = 5000000$ 兆瓦时，$D_2 = 5500000$ 兆瓦时，$D_3 = 6000000$ 兆瓦时\n\n**测试案例的碳预算：**\n- 案例 A：$B = 8000000$ $\\text{tCO}_2$\n- 案例 B：$B = 20000000$ $\\text{tCO}_2$\n- 案例 C：$B = 6000000$ $\\text{tCO}_2$\n\n**决策变量：**\n- 容量增量：$\\Delta K_{\\text{coal}}, \\Delta K_{\\text{gas}}$ (兆瓦)\n- 各时期发电量：$G_{\\text{coal},t}, G_{\\text{gas},t}$ (兆瓦时)，对于 $t \\in \\{1, 2, 3\\}$\n\n**目标函数与约束：**\n- 目标：最小化净现值成本 (NPC)\n  $\\text{NPC} = \\sum_{t=1}^{T} d_t \\left( \\sum_{i \\in \\{\\text{coal}, \\text{gas}\\}} \\left( f_i (K_{i,0} + \\Delta K_i) + v_i G_{i,t} \\right) \\right) + \\sum_{i \\in \\{\\text{coal}, \\text{gas}\\}} I_i \\Delta K_i$\n- 能源平衡：$\\sum_{i} G_{i,t} = D_t$ 对于每个时期 $t$\n- 容量可用性：$G_{i,t} \\leq \\alpha_{i,t} H (K_{i,0} + \\Delta K_i)$ 对于每种技术 $i$ 和每个时期 $t$\n- 碳预算：$\\sum_{t=1}^{T} \\sum_{i} e_i G_{i,t} \\leq B$\n- 非负性：$\\Delta K_i \\geq 0$, $G_{i,t} \\geq 0$\n\n**碳价定义：**\n- 时期 $t$ 的隐含同期碳价为 $p_t = \\lambda_B / d_t$，其中 $\\lambda_B$ 是累积碳预算约束的拉格朗日乘子（影子价格）。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n根据验证标准对问题陈述进行评估：\n\n1.  **科学依据**：该问题描述了一个容量扩张和经济调度模型，这是能源系统分析和经济学中一个标准且广泛使用的框架。将其表述为线性规划是该领域的基础。所有原则，如NPC最小化、贴现和约束，都基于成熟的经济和工程理论。该问题具有科学合理性。\n2.  **适定性**：该问题被表述为一个具有线性目标函数和线性约束的线性规划（LP）问题。只要可行域非空（本例中需求可以被满足，因此可行域非空），最优解就存在。该问题是适定的。\n3.  **客观性**：问题以精确、定量和客观的语言陈述。所有参数都以数值形式给出，目标是计算特定的数值量。没有主观或基于观点的内容。\n4.  **完整性与一致性**：所有必要的数据（$T, H, r$、成本、需求、技术参数等）都已提供。目标函数和约束的定义明确，并且在数学上相互一致。没有缺失的定义或矛盾的陈述。\n5.  **现实性与可行性**：参数值（成本、排放因子、容量）在相应技术的实际范围内。需求和预算的设定使得问题能够探索不同的情景（紧约束、非紧约束），这是进行敏感性分析的标准方法。这些约束在物理上和经济上都是有意义的。\n6.  **无其他缺陷**：该问题不是比喻性的、琐碎的或故作高深的。它要求将标准的优化技术应用于一个具体定义的问题。\n\n### 步骤 3：结论与行动\n\n该问题有效。它是一个定义明确、有科学依据且客观的线性规划问题。将提供完整的解决方案。\n\n### 求解方案构建\n\n该问题是一个线性规划问题，可以表示为标准形式：\n最小化 $\\mathbf{c}^T \\mathbf{x}$\n约束于：\n$\\mathbf{A}_{eq} \\mathbf{x} = \\mathbf{b}_{eq}$\n$\\mathbf{A}_{ub} \\mathbf{x} \\leq \\mathbf{b}_{ub}$\n$\\mathbf{x} \\geq 0$\n\n**1. 决策变量**\n决策变量向量 $\\mathbf{x}$ 结合了容量增量和每个时期的发电水平。对于两种技术和三个时期，共有 $2 + 2 \\times 3 = 8$ 个变量。我们按以下顺序排列它们：\n$$ \\mathbf{x} = [\\Delta K_{\\text{coal}}, \\Delta K_{\\text{gas}}, G_{\\text{coal},1}, G_{\\text{gas},1}, G_{\\text{coal},2}, G_{\\text{gas},2}, G_{\\text{coal},3}, G_{\\text{gas},3}]^T $$\n\n**2. 目标函数**\n目标是最小化净现值成本 (NPC)。NPC 表达式可以重新整理，将与决策变量相关的项与常数项分开。常数部分（与现有容量相关的成本）可以从优化目标中省略。\n需要最小化的成本函数是：\n$$ \\text{Cost} = (I_{\\text{coal}} + f_{\\text{coal}} \\sum_{t=1}^T d_t) \\Delta K_{\\text{coal}} + (I_{\\text{gas}} + f_{\\text{gas}} \\sum_{t=1}^T d_t) \\Delta K_{\\text{gas}} + \\sum_{t=1}^T d_t (v_{\\text{coal}} G_{\\text{coal},t} + v_{\\text{gas}} G_{\\text{gas},t}) $$\n大小为 8 的成本向量 $\\mathbf{c}$ 由此表达式中变量的系数构成。设 $D_S = \\sum_{t=1}^3 d_t$。\n$$\n\\mathbf{c} = [\n(I_{\\text{coal}} + f_{\\text{coal}} D_S),\n(I_{\\text{gas}} + f_{\\text{gas}} D_S),\nd_1 v_{\\text{coal}}, d_1 v_{\\text{gas}},\nd_2 v_{\\text{coal}}, d_2 v_{\\text{gas}},\nd_3 v_{\\text{coal}}, d_3 v_{\\text{gas}}\n]^T\n$$\n\n**3. 约束**\n\n*   **能源平衡（等式约束）：** 对于每个时期 $t \\in \\{1, 2, 3\\}$，总发电量必须等于需求：\n    $G_{\\text{coal},t} + G_{\\text{gas},t} = D_t$。\n    这给出了 3 个等式约束，构成了矩阵 $\\mathbf{A}_{eq}$ ($3 \\times 8$) 和向量 $\\mathbf{b}_{eq}$ (大小为 3)。\n\n*   **容量可用性（不等式约束）：** 对于每种技术 $i$ 和每个时期 $t$，发电量受限于可用容量。\n    $G_{i,t} \\leq \\alpha_i H (K_{i,0} + \\Delta K_i)$\n    整理成标准形式 $Ax \\leq b$：\n    $G_{i,t} - (\\alpha_i H) \\Delta K_i \\leq \\alpha_i H K_{i,0}$\n    这给出了 $2 \\times 3 = 6$ 个不等式约束。\n\n*   **累积碳预算（不等式约束）：** 规划期内的总排放量不得超过预算 $B$。\n    $\\sum_{t=1}^3 (e_{\\text{coal}} G_{\\text{coal},t} + e_{\\text{gas}} G_{\\text{gas},t}) \\leq B$\n    这是一个额外的不等式约束。\n\n这 7 个不等式约束构成了矩阵 $\\mathbf{A}_{ub}$ ($7 \\times 8$) 和向量 $\\mathbf{b}_{ub}$ (大小为 7)。\n\n*   **非负性：** 所有决策变量必须为非负，这是 LP 求解器中的标准边界条件。\n\n**4. 碳价计算**\n线性规划求解器提供决策变量的最优值 $\\mathbf{x}^*$ 和每个约束的影子价格（拉格朗日乘子）。累积碳预算约束的影子价格 $\\lambda_B$ 特别值得关注。它表示碳预算 $B$ 每增加一个单位，最优 NPC 的减少量。其单位是按现值计算的美元/吨二氧化碳。问题将时期 $t$ 的同期碳价定义为 $p_t = \\lambda_B / d_t$。这种转换考虑了货币的时间价值，反映了未来的碳价在今天价值较低的事实。如果碳预算约束不具约束力（即最优排放量小于 $B$），其影子价格 $\\lambda_B$ 将为 0，因此所有 $p_t$ 也将为 0。\n\n以下 Python 代码使用 `scipy.optimize.linprog` 实现了这个线性规划模型，以求解三种预算情况下的最优容量和发电量。然后，它根据碳预算约束的对偶变量计算碳价轨迹。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the energy capacity expansion and dispatch problem for three carbon budget cases.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    T = 3\n    H = 8760.0\n    r = 0.05\n    \n    params = {\n        'coal': {\n            'I': 2000000.0,  # Investment cost $/MW\n            'f': 40000.0,    # Fixed O $/MW-yr\n            'v': 20.0,       # Variable cost $/MWh\n            'e': 0.90,       # Emission factor tCO2/MWh\n            'alpha': 0.85,   # Availability factor\n            'K0': 400.0,     # Existing capacity MW\n        },\n        'gas': {\n            'I': 1000000.0,\n            'f': 20000.0,\n            'v': 35.0,\n            'e': 0.35,\n            'alpha': 0.90,\n            'K0': 200.0,\n        }\n    }\n    \n    demands = np.array([5000000.0, 5500000.0, 6000000.0]) # MWh\n    \n    # Test cases for carbon budget B\n    test_cases = [\n        8000000.0,   # Case A: Moderately binding\n        20000000.0,  # Case B: Non-binding\n        6000000.0,   # Case C: Tight\n    ]\n    \n    # --- Derived Parameters ---\n    # Decision variables are ordered as [dK_c, dK_g, G_c1, G_g1, G_c2, G_g2, G_c3, G_g3]\n    num_vars = 2 + 2 * T\n\n    # Discount factors\n    d = np.array([(1 + r)**(-(t - 1)) for t in range(1, T + 1)])\n    \n    # Cost vector c for the objective function min c'x\n    c = np.zeros(num_vars)\n    d_sum = np.sum(d)\n    c[0] = params['coal']['I'] + params['coal']['f'] * d_sum\n    c[1] = params['gas']['I'] + params['gas']['f'] * d_sum\n    for t in range(T):\n        c[2 + 2 * t] = params['coal']['v'] * d[t]\n        c[2 + 2 * t + 1] = params['gas']['v'] * d[t]\n        \n    # --- Constraint Matrices ---\n    \n    # Equality constraints: A_eq * x = b_eq (Energy balance)\n    A_eq = np.zeros((T, num_vars))\n    for t in range(T):\n        A_eq[t, 2 + 2 * t] = 1.0  # G_coal,t\n        A_eq[t, 2 + 2 * t + 1] = 1.0  # G_gas,t\n    b_eq = demands\n    \n    # Inequality constraints: A_ub * x = b_ub\n    num_ineq = 2 * T + 1\n    A_ub = np.zeros((num_ineq, num_vars))\n    b_ub = np.zeros(num_ineq)\n    \n    # Capacity constraints\n    alpha_c_H = params['coal']['alpha'] * H\n    alpha_g_H = params['gas']['alpha'] * H\n    \n    for t in range(T):\n        # Coal: G_c,t - alpha_c*H * dK_c = alpha_c*H * K_c0\n        row_c = t\n        A_ub[row_c, 2 + 2 * t] = 1.0\n        A_ub[row_c, 0] = -alpha_c_H\n        b_ub[row_c] = alpha_c_H * params['coal']['K0']\n        \n        # Gas: G_g,t - alpha_g*H * dK_g = alpha_g*H * K_g0\n        row_g = T + t\n        A_ub[row_g, 2 + 2 * t + 1] = 1.0\n        A_ub[row_g, 1] = -alpha_g_H\n        b_ub[row_g] = alpha_g_H * params['gas']['K0']\n\n    # Carbon budget constraint\n    carbon_constraint_idx = 2 * T\n    for t in range(T):\n        A_ub[carbon_constraint_idx, 2 + 2 * t] = params['coal']['e']\n        A_ub[carbon_constraint_idx, 2 + 2 * t + 1] = params['gas']['e']\n    \n    # All variables must be non-negative\n    bounds = (0, None)\n    \n    # --- Solve for each case ---\n    all_results = []\n    \n    for B in test_cases:\n        # Update the RHS of the carbon budget constraint\n        b_ub[carbon_constraint_idx] = B\n        \n        # Solve the LP\n        res = linprog(c=c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res.success:\n            # Handle solver failure if necessary\n            # For this problem, a solution is expected to exist.\n            raise RuntimeError(f\"Solver failed for budget B={B}\")\n            \n        # Extract optimal values\n        dK_c, dK_g = res.x[0], res.x[1]\n        \n        # Calculate total installed capacity\n        K_coal = params['coal']['K0'] + dK_c\n        K_gas = params['gas']['K0'] + dK_g\n\n        # Extract shadow price of carbon budget\n        # duals for A_ub @ x = b_ub are non-positive. Shadow price is the negative.\n        lambda_B = -res.ineqlin.marginals[carbon_constraint_idx]\n        \n        # Calculate contemporaneous carbon prices\n        p_t = lambda_B / d\n        p1, p2, p3 = p_t[0], p_t[1], p_t[2]\n        \n        # Format results\n        case_result = [\n            round(K_coal, 2),\n            round(K_gas, 2),\n            round(p1, 2),\n            round(p2, 2),\n            round(p3, 2),\n        ]\n        all_results.append(case_result)\n        \n    # Reorder results to match A, B, C as defined in the prompt\n    # My test_cases list is [A, B, C] already.\n    # The final output needs to be in a specific string format\n    result_str = \",\".join([f\"[{','.join(f'{val:.2f}' for val in case)}]\" for case in all_results])\n    \n    # Final print statement\n    print(f\"[{result_str}]\")\n\nsolve()\n```"
        }
    ]
}