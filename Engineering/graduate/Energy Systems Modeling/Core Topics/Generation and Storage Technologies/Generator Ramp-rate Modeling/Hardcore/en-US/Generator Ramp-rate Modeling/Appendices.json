{
    "hands_on_practices": [
        {
            "introduction": "This exercise goes to the heart of building effective optimization models for power systems. In discrete-time frameworks like Unit Commitment, correctly formulating a generator's physical limits on its power output $P_t$ is essential for ensuring the model's solutions are both feasible and economically efficient. This practice will guide you through deriving a \"tight\" constraint for a startup event, a common scenario that requires careful combination of different operational limits .",
            "id": "4093090",
            "problem": "Consider a single thermal generator in a discrete-time scheduling model for Unit Commitment (UC). Let the time step be of duration $\\Delta t$ hours, and let $P_t$ denote the electrical power output at time step $t$, $u_t \\in \\{0,1\\}$ the on/off commitment at time step $t$, $y_t \\in \\{0,1\\}$ the startup indicator at time $t$ (equal to $1$ if and only if the generator transitions from off at $t-1$ to on at $t$), and $w_t \\in \\{0,1\\}$ the shutdown indicator at time $t$ (equal to $1$ if and only if the generator transitions from on at $t-1$ to off at $t$). The generator has minimum and maximum power output limits when committed, written as $P^{\\min}$ and $P^{\\max}$, respectively. When the generator is on, its output must satisfy the bound $P^{\\min} u_t \\le P_t \\le P^{\\max} u_t$. The generator has a sustained ramp-up capability $R^{\\uparrow}$ expressed in $\\mathrm{MW}/\\mathrm{h}$ for steady operation and an additional startup ramp allowance $S^{\\uparrow}$ expressed in $\\mathrm{MW}$ per time step when a startup occurs. Similarly, it has a sustained ramp-down capability $R^{\\downarrow}$ and a shutdown ramp allowance $S^{\\downarrow}$, but these are not required for this question.\n\nFrom the basic definition of a ramp rate as a bound on the time derivative of power output, together with the discrete-time approximation of this bound over interval length $\\Delta t$, and the interpretation of the startup allowance as an additional permissible increment in output only when $y_t=1$, construct the tightest possible upper bound on $P_t$ by combining the output limit constraint $P_t \\le P^{\\max} u_t$ with the ramp-up inequality linking $P_t$ and $P_{t-1}$ under the event of a startup. Your derivation must begin from the fundamental definitions above (rate-of-change bounded by $R^{\\uparrow}$ over $\\Delta t$, plus startup allowance only when $y_t=1$), and logically arrive at a single closed-form expression for the upper bound on $P_t$ in terms of $P_{t-1}$, $u_{t-1}$, $u_t$, $y_t$, $P^{\\min}$, $P^{\\max}$, $R^{\\uparrow}$, $S^{\\uparrow}$, and $\\Delta t$.\n\nThen evaluate your bound numerically for the following data and transition:\n- $\\Delta t = 0.25$ $\\mathrm{h}$,\n- $P^{\\min} = 60$ $\\mathrm{MW}$,\n- $P^{\\max} = 220$ $\\mathrm{MW}$,\n- $R^{\\uparrow} = 180$ $\\mathrm{MW}/\\mathrm{h}$,\n- $S^{\\uparrow} = 100$ $\\mathrm{MW}$,\n- $u_{t-1} = 0$, $u_t = 1$ (a startup, so $y_t = 1$), and $P_{t-1} = 0$ $\\mathrm{MW}$.\n\nExpress the final numerical upper bound as a single number in $\\mathrm{MW}$. No rounding is necessary beyond exact arithmetic. Your final answer must be a single real-valued number.",
            "solution": "The problem requires the derivation of the tightest possible upper bound on a thermal generator's power output, $P_t$, during a startup event. This is to be followed by a numerical evaluation for a specific set of parameters. The derivation must logically combine the generator's maximum power limit and its ramp-up characteristics, including a special allowance for startups.\n\nFirst, we identify all constraints that impose an upper limit on the power output $P_t$ at time step $t$.\n\n1.  **Maximum Power Limit**: When the generator is committed (i.e., online, $u_t = 1$), its output $P_t$ cannot exceed its maximum rated capacity, $P^{\\max}$. When the generator is offline ($u_t=0$), its output must be zero. Both conditions are captured by the inequality:\n    $$P_t \\le P^{\\max} u_t$$\n\n2.  **Ramp-Up Limitations**: The rate at which the generator can increase its power output is physically limited. These limits are typically different for sustained operation versus a startup from an offline state.\n\n    a.  **Sustained Ramp-Up**: For \"steady operation,\" meaning the generator is online at both time $t-1$ and time $t$ (i.e., $u_{t-1}=1$ and $u_t=1$), the change in power output is limited by the sustained ramp-up capability $R^{\\uparrow}$ (in $\\mathrm{MW}/\\mathrm{h}$). In a discrete-time model with time steps of duration $\\Delta t$, this is approximated as:\n        $$P_t - P_{t-1} \\le R^{\\uparrow} \\Delta t$$\n        This provides an upper bound on $P_t$ based on its previous state: $P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t$.\n\n    b.  **Startup Ramp Allowance**: When a generator starts up at time $t$, its state transitions from off at $t-1$ ($u_{t-1}=0$, hence $P_{t-1}=0$) to on at $t$ ($u_t=1$). The problem specifies a \"startup ramp allowance\" $S^{\\uparrow}$ in units of $\\mathrm{MW}$. The term \"allowance\" in conjunction with the unit $\\mathrm{MW}$ indicates a limit on the achievable power level itself, not a rate. The most rigorous interpretation in the context of power systems modeling is that $S^{\\uparrow}$ represents the maximum power output the generator can reach in its first time interval of operation. The modifier \"additional\" signifies that this is a special constraint applied in the case of a startup, in addition to the standard operational constraints like sustained ramping and maximum power limits. Therefore, for a startup event ($y_t=1$), the power output is bounded by:\n        $$P_t \\le S^{\\uparrow}$$\n\nTo construct a single expression for the ramp-related upper bound that is valid for both sustained operation and startup, we can use the binary indicator variables. A single inequality that combines these two mutually exclusive cases is:\n$$P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t$$\nThis formulation is valid under the condition that $P_{t-1}=0$ if $u_{t-1}=0$, which is enforced by the general output limit constraints ($P^{\\min}u_{t-1} \\le P_{t-1} \\le P^{\\max}u_{t-1}$). Let's verify this expression:\n-   For sustained operation ($u_{t-1}=1, u_t=1, y_t=0$): The inequality becomes $P_t \\le P_{t-1} + R^{\\uparrow} \\Delta t$, which is the correct sustained ramp-up limit.\n-   For startup ($u_{t-1}=0, u_t=1, y_t=1$): Since $u_{t-1}=0$, we have $P_{t-1}=0$. The inequality becomes $P_t \\le 0 + (R^{\\uparrow} \\Delta t)(0) + S^{\\uparrow}(1)$, which simplifies to $P_t \\le S^{\\uparrow}$. This is the correct startup ramp limit.\n\nThe problem asks for the *tightest possible* upper bound on $P_t$. This is found by taking the minimum of all active upper-bounding constraints. Thus, the most comprehensive upper bound on $P_t$ at any time $t$ is:\n$$P_t \\le \\min\\left( P^{\\max} u_t, \\quad P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t \\right)$$\nThis expression satisfies the requirement for a single closed-form upper bound in terms of the specified variables.\n\nNow, we evaluate this bound for the specific case given in the problem: a startup event. The conditions are:\n-   Generator state transition: $u_{t-1}=0$ to $u_t=1$.\n-   This implies the startup indicator is $y_t=1$.\n-   The previous power output was $P_{t-1}=0 \\, \\mathrm{MW}$.\n\nWe substitute these values into the general upper bound expression.\nThe first argument of the minimum function becomes:\n$$P^{\\max} u_t = P^{\\max} \\cdot 1 = P^{\\max}$$\nThe second argument of the minimum function becomes:\n$$P_{t-1} + R^{\\uparrow} \\Delta t \\cdot u_{t-1} + S^{\\uparrow} \\cdot y_t = 0 + (R^{\\uparrow} \\Delta t) \\cdot 0 + S^{\\uparrow} \\cdot 1 = S^{\\uparrow}$$\nTherefore, for the specific case of a startup, the tightest possible upper bound on the generator's output is:\n$$P_t \\le \\min(P^{\\max}, S^{\\uparrow})$$\n\nFinally, we calculate the numerical value of this bound using the provided data:\n-   $P^{\\max} = 220 \\, \\mathrm{MW}$\n-   $S^{\\uparrow} = 100 \\, \\mathrm{MW}$\n\nThe numerical upper bound is:\n$$P_t \\le \\min(220, 100) = 100 \\, \\mathrm{MW}$$\n\nThe other data ($\\Delta t$, $P^{\\min}$, $R^{\\uparrow}$) are not needed for calculating the upper bound in this specific startup scenario, according to the standard and most rigorous interpretation of the startup ramp allowance $S^{\\uparrow}$. The derived bound is consistent with the generator's minimum output requirement ($P_t \\ge P^{\\min} = 60 \\, \\mathrm{MW}$), as the resulting feasible range for the startup is $60 \\, \\mathrm{MW} \\le P_t \\le 100 \\, \\mathrm{MW}$. The question, however, only asks for the upper bound.",
            "answer": "$$\\boxed{100}$$"
        },
        {
            "introduction": "With a solid understanding of how to model physical ramp capabilities, we can now explore their economic implications. This problem simulates a central task for a system operator: allocating a required amount of ramp-rate reserve, $x_i$, across a fleet of generators based on their costs $C_i(x_i)$ to meet a system-wide need. By applying principles of constrained optimization, you will develop an algorithm to determine the economically optimal dispatch, revealing how market prices for ancillary services like ramp reserve are determined .",
            "id": "4093106",
            "problem": "Consider an energy systems modeling task focused on generator upward ramp-rate reserve allocation. There are $n$ thermal generator units indexed by $i \\in \\{1, \\dots, n\\}$. Each unit has an upward ramp-rate capability $RU_i$ measured in $\\mathrm{MW/min}$. An independent system operator must allocate upward ramp reserve $x_i$ (measured in $\\mathrm{MW/min}$) to each unit for a single dispatch interval, to meet a system-level upward ramp reserve requirement $R$ (measured in $\\mathrm{MW/min}$). The allocation must satisfy $0 \\leq x_i \\leq RU_i$ for all units and $\\sum_{i=1}^{n} x_i = R$.\n\nEach unitâ€™s upward ramp reserve incurs a strictly convex cost given by $C_i(x_i) = \\frac{1}{2} q_i x_i^2 + c_i x_i$, where $q_i > 0$ has units of dollars per $(\\mathrm{MW/min})^2$ and $c_i \\geq 0$ has units of dollars per $\\mathrm{MW/min}$. The objective is to determine the allocation vector $\\mathbf{x} = (x_1, \\dots, x_n)$ that minimizes the total reserve cost $\\sum_{i=1}^{n} C_i(x_i)$ subject to the constraints described above.\n\nStarting from fundamental laws and core definitions in constrained optimization and calculus (e.g., the concept of marginal cost as the derivative of the cost function and feasibility in linear inequality constraints), you must derive the algorithmic approach and then implement a complete, runnable program that computes the optimal allocation $\\mathbf{x}$ for each of the provided test cases. You must also provide a principled justification of the resulting dispatch using marginal analysis in your solution. Do not use any shortcut formulas without derivation; derive your method from first principles.\n\nAssumptions:\n- $q_i > 0$ for all $i$.\n- The requirement $R$ satisfies $0 \\leq R \\leq \\sum_{i=1}^{n} RU_i$ (i.e., feasibility).\n- All inputs are deterministic and represent a single dispatch interval, and each $x_i$ is continuous within its bounds.\n\nYour program must implement a robust numerical procedure to obtain $\\mathbf{x}$, achieving the equality constraint $\\sum_{i=1}^{n} x_i = R$ within a numerical tolerance of $10^{-9}$.\n\nPhysical units:\n- Express every allocation $x_i$ in $\\mathrm{MW/min}$.\n- In the final output, print each $x_i$ as a decimal float with exactly $6$ digits after the decimal point.\n\nTest suite:\nCompute the optimal allocation for the following four cases. Each case is specified by the tuple $(\\{RU_i\\}_{i=1}^{n}, \\{q_i\\}_{i=1}^{n}, \\{c_i\\}_{i=1}^{n}, R)$.\n\n- Case $1$: $n = 3$, $RU = [\\,30,\\,20,\\,10\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.8,\\,0.4,\\,1.2\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,4.0,\\,3.0,\\,5.5\\,]$ dollars per $\\mathrm{MW/min}$, $R = 35$ $\\mathrm{MW/min}$.\n- Case $2$: $n = 2$, $RU = [\\,15,\\,15\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.5,\\,0.5\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,2.0,\\,2.0\\,]$ dollars per $\\mathrm{MW/min}$, $R = 0$ $\\mathrm{MW/min}$.\n- Case $3$: $n = 4$, $RU = [\\,5,\\,10,\\,15,\\,20\\,]$ $\\mathrm{MW/min}$, $q = [\\,1.0,\\,0.2,\\,0.6,\\,0.4\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,3.5,\\,2.0,\\,2.5,\\,3.0\\,]$ dollars per $\\mathrm{MW/min}$, $R = 50$ $\\mathrm{MW/min}$.\n- Case $4$: $n = 4$, $RU = [\\,50,\\,5,\\,0,\\,40\\,]$ $\\mathrm{MW/min}$, $q = [\\,0.1,\\,1.5,\\,0.8,\\,0.3\\,]$ dollars per $(\\mathrm{MW/min})^2$, $c = [\\,1.0,\\,10.0,\\,2.0,\\,1.5\\,]$ dollars per $\\mathrm{MW/min}$, $R = 60$ $\\mathrm{MW/min}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is an inner list representing the optimal allocations $\\mathbf{x}$ for one case, in unit $\\mathrm{MW/min}$, with each value printed with exactly $6$ digits after the decimal point. For example, the output should have the form $[\\,[x_{1,1},x_{1,2},\\dots],\\,[x_{2,1},x_{2,2},\\dots],\\,\\dots\\,]$ with no spaces anywhere in the line.",
            "solution": "The problem is to find the allocation vector $\\mathbf{x} = (x_1, \\dots, x_n)$ that solves the following constrained optimization problem:\n$$\n\\begin{aligned}\n& \\underset{\\mathbf{x}}{\\text{minimize}}\n& & \\sum_{i=1}^{n} \\left(\\frac{1}{2} q_i x_i^2 + c_i x_i\\right) \\\\\n& \\text{subject to}\n& & \\sum_{i=1}^{n} x_i = R \\\\\n& & & 0 \\leq x_i \\leq RU_i, \\quad \\forall i \\in \\{1, \\dots, n\\}\n\\end{aligned}\n$$\n\nThis is a convex optimization problem. We can derive the conditions for optimality using the method of Lagrange multipliers, specifically by formulating the Karush-Kuhn-Tucker (KKT) conditions. The constraints can be written as $R - \\sum_{i=1}^{n} x_i = 0$, $-x_i \\leq 0$, and $x_i - RU_i \\leq 0$.\n\nThe Lagrangian function $L$ for this problem is:\n$$\nL(\\mathbf{x}, \\lambda, \\boldsymbol{\\mu}, \\boldsymbol{\\nu}) = \\sum_{i=1}^{n} \\left(\\frac{1}{2} q_i x_i^2 + c_i x_i\\right) + \\lambda \\left(R - \\sum_{i=1}^{n} x_i\\right) + \\sum_{i=1}^{n} \\mu_i (-x_i) + \\sum_{i=1}^{n} \\nu_i (x_i - RU_i)\n$$\nwhere $\\lambda$ is the Lagrange multiplier for the equality constraint, and $\\mu_i \\geq 0$ and $\\nu_i \\geq 0$ are the multipliers for the lower and upper bound inequality constraints on $x_i$, respectively.\n\nThe KKT conditions for an optimal solution $(\\mathbf{x}^*, \\lambda^*, \\boldsymbol{\\mu}^*, \\boldsymbol{\\nu}^*)$ are:\n\n1.  **Stationarity**: The gradient of the Lagrangian with respect to each $x_i$ must be zero.\n    $$\n    \\frac{\\partial L}{\\partial x_i} = q_i x_i + c_i - \\lambda - \\mu_i + \\nu_i = 0 \\quad \\forall i\n    $$\n    This can be rearranged to $q_i x_i + c_i = \\lambda + \\mu_i - \\nu_i$. The term $q_i x_i + c_i$ is the derivative of the cost function, $C'_i(x_i)$, known as the **marginal cost** of unit $i$.\n\n2.  **Primal Feasibility**: The original constraints must be satisfied.\n    $$\n    \\sum_{i=1}^{n} x_i = R\n    $$\n    $$\n    0 \\leq x_i \\leq RU_i \\quad \\forall i\n    $$\n\n3.  **Dual Feasibility**: The Lagrange multipliers for inequality constraints must be non-negative.\n    $$\n    \\mu_i \\geq 0, \\quad \\nu_i \\geq 0 \\quad \\forall i\n    $$\n\n4.  **Complementary Slackness**: The product of an inequality multiplier and its corresponding constraint must be zero.\n    $$\n    \\mu_i x_i = 0 \\quad \\forall i\n    $$\n    $$\n    \\nu_i (x_i - RU_i) = 0 \\quad \\forall i\n    $$\n\nFrom these conditions, we derive the optimal allocation $x_i$ for a given system marginal price $\\lambda$. We analyze three cases for each unit $i$:\n\n-   **Case A: The unit is dispatched between its limits ($0 < x_i < RU_i$)**\n    Since $x_i > 0$ and $x_i < RU_i$, the complementary slackness conditions imply that $\\mu_i = 0$ and $\\nu_i = 0$. The stationarity condition then simplifies to:\n    $$\n    q_i x_i + c_i = \\lambda \\quad \\implies \\quad x_i = \\frac{\\lambda - c_i}{q_i}\n    $$\n    This shows that all units operating within their bounds must have the same marginal cost, equal to $\\lambda$.\n\n-   **Case B: The unit is at its lower bound ($x_i = 0$)**\n    Since $x_i < RU_i$ (assuming $RU_i > 0$), complementary slackness implies $\\nu_i = 0$. The stationarity condition is $c_i - \\lambda - \\mu_i = 0$. Since $\\mu_i \\geq 0$, this means $c_i - \\lambda \\geq 0$, or $\\lambda \\leq c_i$. The unit's base marginal cost is too high relative to the system price $\\lambda$, so it is not dispatched.\n\n-   **Case C: The unit is at its upper bound ($x_i = RU_i$)**\n    Since $x_i > 0$ (assuming $RU_i > 0$), complementary slackness implies $\\mu_i = 0$. The stationarity condition is $q_i RU_i + c_i - \\lambda + \\nu_i = 0$. Since $\\nu_i \\geq 0$, this means $q_i RU_i + c_i - \\lambda \\leq 0$, or $\\lambda \\geq q_i RU_i + c_i$. The unit is so economical that even at its maximum output, its marginal cost is less than or equal to the system price $\\lambda$.\n\nCombining these three cases, we can express the optimal allocation for unit $i$ as a function of the single parameter $\\lambda$:\n$$\nx_i(\\lambda) = \\begin{cases}\nRU_i & \\text{if } \\lambda > q_i RU_i + c_i \\\\\n\\frac{\\lambda - c_i}{q_i} & \\text{if } c_i \\leq \\lambda \\leq q_i RU_i + c_i \\\\\n0 & \\text{if } \\lambda < c_i\n\\end{cases}\n$$\nThis can be written more compactly as:\n$$\nx_i(\\lambda) = \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda - c_i}{q_i}\\right)\\right)\n$$\nThis function $x_i(\\lambda)$ is continuous and monotonically non-decreasing with respect to $\\lambda$.\n\n### Algorithmic Approach\nThe core of the problem is to find the unique value of the system marginal cost, $\\lambda^*$, such that the total allocation meets the system requirement:\n$$\n\\sum_{i=1}^{n} x_i(\\lambda^*) = R\n$$\nLet us define a function $f(\\lambda) = \\sum_{i=1}^{n} x_i(\\lambda) - R$. We are looking for the root of $f(\\lambda) = 0$. Since each $x_i(\\lambda)$ is a monotonically non-decreasing function of $\\lambda$, their sum $\\sum_{i=1}^{n} x_i(\\lambda)$ is also monotonic. This property makes the root-finding problem very well-suited for a bisection search algorithm.\n\nThe bisection algorithm proceeds as follows:\n\n1.  **Establish a search interval $[\\lambda_{\\text{low}}, \\lambda_{\\text{high}}]$ for $\\lambda$**:\n    -   A lower bound can be set to $\\lambda_{\\text{low}} = 0$, since $c_i \\geq 0$. If $\\lambda < 0$, all $x_i$ would be $0$.\n    -   An upper bound $\\lambda_{\\text{high}}$ must be large enough such that $\\sum_{i=1}^{n} x_i(\\lambda_{\\text{high}}) \\geq R$. A safe, sufficiently large value can be chosen, for instance, by finding the maximum possible marginal cost across all units: $\\lambda_{\\text{high}} = \\max_i(c_i + q_i RU_i)$.\n\n2.  **Iterate to find the root**:\n    -   Repeat for a fixed number of iterations (e.g., $100$) to achieve high precision, or until the search interval is sufficiently small.\n    -   In each iteration, calculate the midpoint $\\lambda_{\\text{mid}} = (\\lambda_{\\text{low}} + \\lambda_{\\text{high}}) / 2$.\n    -   Calculate the total allocation at this trial value: $X_{\\text{total}} = \\sum_{i=1}^{n} \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda_{\\text{mid}} - c_i}{q_i}\\right)\\right)$.\n    -   Update the interval:\n        -   If $X_{\\text{total}} < R$, the trial $\\lambda_{\\text{mid}}$ is too low to meet the requirement. We need to increase the marginal cost to procure more reserve. Thus, we set $\\lambda_{\\text{low}} = \\lambda_{\\text{mid}}$.\n        -   If $X_{\\text{total}} \\geq R$, the trial $\\lambda_{\\text{mid}}$ is high enough or too high. We can potentially achieve the requirement with a lower cost. Thus, we set $\\lambda_{\\text{high}} = \\lambda_{\\text{mid}}$.\n\n3.  **Final Calculation**:\n    -   After the iterations complete, the optimal marginal cost $\\lambda^*$ is taken as the midpoint of the final interval, $\\lambda^* = (\\lambda_{\\text{low}} + \\lambda_{\\text{high}}) / 2$.\n    -   The final optimal allocation vector $\\mathbf{x}^* = (x_1^*, \\dots, x_n^*)$ is computed using this $\\lambda^*$:\n        $$\n        x_i^* = \\max\\left(0, \\min\\left(RU_i, \\frac{\\lambda^* - c_i}{q_i}\\right)\\right) \\quad \\forall i\n        $$\nThis algorithm is robust, efficient, and guaranteed to converge to the unique optimal solution due to the monotonicity of $f(\\lambda)$. A sufficient number of iterations (e.g., $100$) on standard double-precision floating-point numbers will ensure that the final constraint $\\left| \\sum x_i - R \\right|$ is well within the required tolerance of $10^{-9}$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the ramp-rate reserve allocation problem for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: n = 3, RU = [30, 20, 10], q = [0.8, 0.4, 1.2], c = [4.0, 3.0, 5.5], R = 35\n        (np.array([30.0, 20.0, 10.0]), np.array([0.8, 0.4, 1.2]), np.array([4.0, 3.0, 5.5]), 35.0),\n        # Case 2: n = 2, RU = [15, 15], q = [0.5, 0.5], c = [2.0, 2.0], R = 0\n        (np.array([15.0, 15.0]), np.array([0.5, 0.5]), np.array([2.0, 2.0]), 0.0),\n        # Case 3: n = 4, RU = [5, 10, 15, 20], q = [1.0, 0.2, 0.6, 0.4], c = [3.5, 2.0, 2.5, 3.0], R = 50\n        (np.array([5.0, 10.0, 15.0, 20.0]), np.array([1.0, 0.2, 0.6, 0.4]), np.array([3.5, 2.0, 2.5, 3.0]), 50.0),\n        # Case 4: n = 4, RU = [50, 5, 0, 40], q = [0.1, 1.5, 0.8, 0.3], c = [1.0, 10.0, 2.0, 1.5], R = 60\n        (np.array([50.0, 5.0, 0.0, 40.0]), np.array([0.1, 1.5, 0.8, 0.3]), np.array([1.0, 10.0, 2.0, 1.5]), 60.0),\n    ]\n\n    all_results = []\n\n    for RU, q, c, R in test_cases:\n        # Handle the trivial case where R=0\n        if R == 0:\n            allocations = np.zeros_like(RU)\n            all_results.append(allocations)\n            continue\n        \n        # Handle the trivial case where R is the sum of all capacities\n        if abs(R - np.sum(RU)) < 1e-9:\n            allocations = RU\n            all_results.append(allocations)\n            continue\n            \n        # 1. Establish a search interval for lambda\n        lambda_low = 0.0\n        # A safe upper bound for lambda is the max possible marginal cost\n        # Add a small epsilon to handle cases where RU might be zero\n        lambda_high = np.max(c + q * (RU + 1e-9)) * 1.5 # Multiplied by 1.5 for an extra margin\n        \n        # For a more robust upper bound, ensure it's sufficiently large\n        lambda_high = max(lambda_high, 1000.0)\n\n        # 2. Iterate using bisection search to find the optimal lambda\n        # 100 iterations are more than sufficient for double precision convergence\n        for _ in range(100):\n            lambda_mid = (lambda_low + lambda_high) / 2.0\n            \n            # Calculate total allocation for the current lambda_mid\n            # x_i = (lambda - c_i) / q_i, clipped by [0, RU_i]\n            # np.divide is used for safe division, although q_i > 0 is assumed\n            x = (lambda_mid - c) / q\n            allocations = np.maximum(0.0, np.minimum(RU, x))\n            \n            total_allocation = np.sum(allocations)\n            \n            # Update the search interval\n            if total_allocation < R:\n                lambda_low = lambda_mid\n            else:\n                lambda_high = lambda_mid\n        \n        # 3. Final calculation using the determined optimal lambda\n        lambda_opt = (lambda_low + lambda_high) / 2.0\n        \n        final_x = (lambda_opt - c) / q\n        final_allocations = np.maximum(0.0, np.minimum(RU, final_x))\n        \n        # An optional step to correct for floating point inaccuracies to perfectly match R.\n        # However, 100 iterations of bisection typically make the error negligible (well within 1e-9).\n        residual = R - np.sum(final_allocations)\n        # Identify generators not at their bounds\n        active_mask = (final_allocations > 1e-9) & (final_allocations < RU - 1e-9)\n        \n        if np.any(active_mask):\n            # Calculate sum of 1/q_i for active generators\n            inv_q_sum_active = np.sum(1.0 / q[active_mask])\n            if inv_q_sum_active > 0:\n                # Distribute residual proportionally\n                final_allocations[active_mask] += residual * (1.0 / q[active_mask]) / inv_q_sum_active\n        \n        # Ensure positivity and bounds again after correction\n        final_allocations = np.maximum(0.0, np.minimum(RU, final_allocations))\n\n        all_results.append(final_allocations)\n\n    # Format output string\n    output_parts = []\n    for result_vector in all_results:\n        formatted_vector = ','.join([f\"{val:.6f}\" for val in result_vector])\n        output_parts.append(f\"[{formatted_vector}]\")\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Our models are ultimately approximations of a continuous physical reality, and a skilled modeler must understand the limitations of their tools. This final practice delves into the subtle but critical issue of discretization error, exploring how a discrete-time check might fail to capture violations of a continuous limit like $|\\dot{P}(t)| \\le r$ that occur *between* time steps. You will use foundational calculus to derive a rigorous bound on this \"hidden\" violation, providing a concrete method for assessing the fidelity of discrete-time monitoring and scheduling schemes .",
            "id": "4093140",
            "problem": "A thermal generator is scheduled in continuous time with real power output trajectory $P(t)$ that is twice continuously differentiable on every dispatch interval $[t_k, t_{k+1}]$ of length $\\Delta t = t_{k+1}-t_k$. The plant is subject to a continuous-time ramp-rate limit $|\\dot{P}(t)| \\le r$ for all $t$, where $r > 0$ is known. For practical monitoring, the system operator enforces a discrete ramp check at sampling times only: $|P(t_{k+1}) - P(t_k)| \\le r \\,\\Delta t$. Because actual trajectories need not be linear within an interval, intra-interval violations of $|\\dot{P}(t)| \\le r$ may be hidden by this discrete check.\n\nAssume the following physically motivated regularity: there exists a known constant $a > 0$ such that the second derivative satisfies $|\\ddot{P}(t)| \\le a$ for all $t$ (this reflects a bound on the rate of change of the ramp rate due to actuator and inertia limitations).\n\nUsing only foundational calculus facts about differentiable functions, construct the tightest uniform bound on the possible intra-interval excess of the instantaneous ramp rate over the average slope. Specifically, let $m_k := \\dfrac{P(t_{k+1}) - P(t_k)}{\\Delta t}$ denote the average slope on $[t_k, t_{k+1}]$. Derive the smallest function $B(\\Delta t, a)$ such that, for any $P(t)$ satisfying $|\\ddot{P}(t)| \\le a$ on $[t_k,t_{k+1}]$, one has\n$$\n\\sup_{\\tau \\in [t_k,t_{k+1}]} \\bigl| \\dot{P}(\\tau) \\bigr| \\le |m_k| + B(\\Delta t, a).\n$$\nThen, interpret this bound to obtain a sufficient condition on $\\Delta t$ that guarantees the following: whenever the discrete check $|P(t_{k+1}) - P(t_k)| \\le r \\,\\Delta t$ passes, any possible intra-interval violation of the continuous-time ramp limit is bounded in magnitude by at most a tolerance $\\varepsilon > 0$, i.e., $\\sup_{\\tau \\in [t_k,t_{k+1}]} \\max\\{0, |\\dot{P}(\\tau)| - r\\} \\le \\varepsilon$.\n\nFinally, take $r = 30$ MW/min, $a = 180$ MW/min$^2$, and choose a tolerance equal to one tenth of the ramp limit, $\\varepsilon = 0.1\\, r$. Compute the largest admissible sampling interval $\\Delta t$ in seconds that satisfies your sufficient condition. Round your answer to three significant figures. Express your final result in seconds.",
            "solution": "We start from the definitions of the derivative and integral average, and the Mean Value Theorem. Let $v(t) := \\dot{P}(t)$ on the interval $[t_k, t_{k+1}]$ of length $\\Delta t$. The average slope on the interval is\n$$\nm_k = \\frac{P(t_{k+1}) - P(t_k)}{\\Delta t} = \\frac{1}{\\Delta t} \\int_{t_k}^{t_{k+1}} v(s)\\, ds.\n$$\nWe are given a uniform bound on the second derivative, $|\\ddot{P}(t)| \\le a$, which is equivalent to a Lipschitz bound on $v(t)$: $|v'(t)| \\le a$ for all $t$ in the interval. Our goal is to bound the deviation of $v(t)$ from its average $m_k$ in terms of $\\Delta t$ and $a$ only, uniformly over the interval.\n\nFix any $\\tau \\in [t_k, t_{k+1}]$. Consider\n$$\nv(\\tau) - m_k \\;=\\; v(\\tau) - \\frac{1}{\\Delta t} \\int_{t_k}^{t_{k+1}} v(s)\\, ds \\;=\\; \\frac{1}{\\Delta t} \\int_{t_k}^{t_{k+1}} \\bigl( v(\\tau) - v(s) \\bigr)\\, ds.\n$$\nTaking absolute values and using the triangle inequality yields\n$$\n|v(\\tau) - m_k| \\;\\le\\; \\frac{1}{\\Delta t} \\int_{t_k}^{t_{k+1}} |v(\\tau) - v(s)|\\, ds.\n$$\nBy the Fundamental Theorem of Calculus and the bound on $|v'|$, we have for any $s,\\tau$,\n$$\n|v(\\tau) - v(s)| \\;=\\; \\left| \\int_{s}^{\\tau} v'(u)\\, du \\right| \\;\\le\\; \\int_{s}^{\\tau} |v'(u)|\\, du \\;\\le\\; \\int_{s}^{\\tau} a\\, du \\;=\\; a\\, |\\tau - s|.\n$$\nSubstituting this into the previous inequality,\n$$\n|v(\\tau) - m_k| \\;\\le\\; \\frac{a}{\\Delta t} \\int_{t_k}^{t_{k+1}} |\\tau - s|\\, ds.\n$$\nLet us change variables to measure times relative to $t_k$. Write $\\tau = t_k + \\theta$ and $s = t_k + \\sigma$ with $\\theta,\\sigma \\in [0,\\Delta t]$. Then\n$$\n\\int_{t_k}^{t_{k+1}} |\\tau - s|\\, ds \\;=\\; \\int_{0}^{\\Delta t} |\\theta - \\sigma|\\, d\\sigma \\;=: I(\\theta).\n$$\nWe compute $I(\\theta)$ explicitly:\n$$\nI(\\theta) \\;=\\; \\int_{0}^{\\theta} (\\theta - \\sigma)\\, d\\sigma \\;+\\; \\int_{\\theta}^{\\Delta t} (\\sigma - \\theta)\\, d\\sigma \\;=\\; \\left[\\theta \\sigma - \\frac{\\sigma^{2}}{2}\\right]_{0}^{\\theta} + \\left[\\frac{\\sigma^{2}}{2} - \\theta \\sigma\\right]_{\\theta}^{\\Delta t}.\n$$\nEvaluating,\n$$\nI(\\theta) \\;=\\; \\left(\\theta^{2} - \\frac{\\theta^{2}}{2}\\right) \\;+\\; \\left(\\frac{\\Delta t^{2}}{2} - \\theta \\Delta t - \\left(\\frac{\\theta^{2}}{2} - \\theta^{2}\\right)\\right) \\;=\\; \\frac{\\Delta t^{2}}{2} - \\Delta t\\, \\theta + \\theta^{2}.\n$$\nThis quadratic in $\\theta$ is convex, with derivative $2\\theta - \\Delta t$, so it attains its maximum over $[0,\\Delta t]$ at the endpoints $\\theta = 0$ or $\\theta = \\Delta t$, where $I(0) = I(\\Delta t) = \\Delta t^{2}/2$. Therefore,\n$$\n\\sup_{\\tau \\in [t_k,t_{k+1}]} |v(\\tau) - m_k| \\;\\le\\; \\frac{a}{\\Delta t} \\cdot \\frac{\\Delta t^{2}}{2} \\;=\\; \\frac{a\\, \\Delta t}{2}.\n$$\nThis bound is tight: for example, choosing $v(t)$ to increase linearly with slope $a$ from the left endpoint to the right endpoint yields an endpoint deviation of exactly $a\\, \\Delta t/2$ from the average.\n\nConsequently, the tightest uniform additive bound is\n$$\nB(\\Delta t, a) \\;=\\; \\frac{a\\, \\Delta t}{2},\n$$\nin the sense that for all admissible $P(t)$,\n$$\n\\sup_{\\tau \\in [t_k,t_{k+1}]} |\\dot{P}(\\tau)| \\;\\le\\; |m_k| + \\frac{a\\, \\Delta t}{2}.\n$$\n\nWe now interpret this bound relative to the continuous-time ramp limit. If the discrete check passes, then $|m_k| \\le r$, and thus\n$$\n\\sup_{\\tau \\in [t_k,t_{k+1}]} |\\dot{P}(\\tau)| \\;\\le\\; r + \\frac{a\\, \\Delta t}{2}.\n$$\nTherefore, the maximum possible intra-interval excess of the instantaneous ramp over $r$ is bounded by $\\frac{a\\, \\Delta t}{2}$. To ensure that any hidden violation is no larger than a prescribed tolerance $\\varepsilon > 0$, it suffices to choose $\\Delta t$ such that\n$$\n\\frac{a\\, \\Delta t}{2} \\;\\le\\; \\varepsilon,\n$$\nor equivalently,\n$$\n\\Delta t \\;\\le\\; \\frac{2\\, \\varepsilon}{a}.\n$$\n\nFor the numerical instance, we are given $r = 30$ MW/min, $a = 180$ MW/min$^{2}$, and $\\varepsilon = 0.1\\, r = 3$ MW/min. The largest admissible interval length in minutes is\n$$\n\\Delta t_{\\max} \\;=\\; \\frac{2\\, \\varepsilon}{a} \\;=\\; \\frac{2 \\times 3}{180} \\;=\\; \\frac{6}{180} \\;=\\; \\frac{1}{30} \\;\\text{minutes}.\n$$\nConverting to seconds,\n$$\n\\Delta t_{\\max} \\;=\\; \\frac{1}{30} \\times 60 \\;=\\; 2 \\;\\text{seconds}.\n$$\nRounding to three significant figures and expressing in seconds, the result is $2.00$ seconds.",
            "answer": "$$\\boxed{2.00}$$"
        }
    ]
}