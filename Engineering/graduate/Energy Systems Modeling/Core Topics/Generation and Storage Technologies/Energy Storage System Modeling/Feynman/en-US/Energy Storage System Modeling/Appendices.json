{
    "hands_on_practices": [
        {
            "introduction": "We begin our practical exploration with pumped hydro storage, a cornerstone of grid-scale energy management. This exercise challenges you to model the system's round-trip efficiency from first principles, integrating fundamental fluid dynamics with the practical realities of turbomachinery performance and hydraulic losses. By deriving the potential energy and applying the extended Bernoulli equation, you will develop a robust understanding of the factors that govern the overall energy balance and efficiency of this critical storage technology. ",
            "id": "4090291",
            "problem": "A pumped hydro energy storage facility connects an upper and a lower reservoir with a single straight steel penstock of constant circular cross-section. The reservoirs have large free surfaces so that velocity heads at the reservoirs are negligible. The gross static elevation difference between the reservoir free surfaces is $H = 120 \\ \\mathrm{m}$. The penstock has length $L = 800 \\ \\mathrm{m}$ and inside diameter $D = 4 \\ \\mathrm{m}$. During generation, the volumetric flow rate is $Q_{\\mathrm{gen}} = 50 \\ \\mathrm{m^3/s}$ sustained for a duration of $T_{\\mathrm{gen}} = 6 \\ \\mathrm{h}$; during pumping, the flow rate is $Q_{\\mathrm{pump}} = 45 \\ \\mathrm{m^3/s}$ and pumping continues until the upper reservoir returns to its initial elevation. The fluid is water, modeled as incompressible with density $\\rho = 1000 \\ \\mathrm{kg/m^3}$. Take gravitational acceleration $g = 9.81 \\ \\mathrm{m/s^2}$. Assume direction-specific hydraulic loss parameters: during generation, the Darcy–Weisbach friction factor is $f_{\\mathrm{gen}} = 0.018$ and the sum of minor loss coefficients is $K_{\\mathrm{gen}} = 2.0$; during pumping, $f_{\\mathrm{pump}} = 0.020$ and $K_{\\mathrm{pump}} = 2.5$. The turbine hydraulic efficiency is $\\eta_{\\mathrm{turb,h}} = 0.92$, and the generator electromechanical efficiency is $\\eta_{\\mathrm{e,gen}} = 0.98$. The pump hydraulic efficiency is $\\eta_{\\mathrm{pump,h}} = 0.88$, and the motor electromechanical efficiency is $\\eta_{\\mathrm{motor}} = 0.96$. Ignore atmospheric pressure differences, cavitation limits, surge phenomena, and any penstock elevation changes other than those implicit in the static head $H$.\n\nStarting from first principles of mechanical energy balance for incompressible flow and the definition of gravitational potential energy, derive the expression for the gravitational potential energy stored by elevating a fluid volume by the static head, and then formulate the round-trip energy balance for this pumped hydro system including hydraulic losses and conversion efficiencies. Using the given data, compute the Round-Trip Efficiency (RTE), defined as the ratio of electrical energy produced during generation to electrical energy consumed during pumping when the pumped volume exactly restores the upper reservoir to its initial elevation.\n\nExpress the final RTE as a dimensionless decimal fraction, and round your answer to four significant figures.",
            "solution": "The problem requires the derivation of the round-trip efficiency (RTE) for a pumped hydro energy storage system and its calculation based on provided data. The solution proceeds in three stages: a preliminary derivation of the potential energy formula, formulation of the energy balance for the system, and numerical computation of the RTE.\n\nFirst, we derive the expression for the gravitational potential energy, $E_p$, stored by elevating a volume of fluid. The work, $W$, done to lift a mass $m$ against gravity (with acceleration $g$) by a vertical height $H$ is stored as potential energy.\n$$ W = \\text{Force} \\times \\text{Distance} = (mg)H $$\nThus, the potential energy is $E_p = mgH$. For a fluid with density $\\rho$ and volume $V$, the mass is $m = \\rho V$. Substituting this into the energy expression gives:\n$$ E_p = \\rho g V H $$\n\nNext, we formulate the round-trip energy balance. The RTE is defined as the ratio of electrical energy produced during generation, $E_{\\mathrm{elec,gen}}$, to the electrical energy consumed during pumping, $E_{\\mathrm{elec,pump}}$, to return the system to its initial state.\n$$ \\mathrm{RTE} = \\frac{E_{\\mathrm{elec,gen}}}{E_{\\mathrm{elec,pump}}} $$\n\n**Generation Mode Analysis**\nWe apply the mechanical energy balance (extended Bernoulli equation) for an incompressible fluid between the upper reservoir surface (point 1) and the lower reservoir surface (point 2):\n$$ \\frac{P_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 = \\frac{P_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + H_{\\mathrm{turb}} + h_{L,\\mathrm{gen}} $$\nHere, $P$ is pressure, $v$ is velocity, $z$ is elevation, $H_{\\mathrm{turb}}$ is the head extracted by the turbine, and $h_{L,\\mathrm{gen}}$ is the total hydraulic head loss. Given that the reservoirs are large ($v_1 \\approx 0, v_2 \\approx 0$) and open to the atmosphere ($P_1 = P_2$), and the static head is $H = z_1 - z_2$, the equation simplifies to $H = H_{\\mathrm{turb}} + h_{L,\\mathrm{gen}}$.\nThe net head delivered to the turbine is $H_{\\mathrm{net,gen}} = H_{\\mathrm{turb}} = H - h_{L,\\mathrm{gen}}$. The hydraulic power extracted from the flow is:\n$$ P_{\\mathrm{hyd,gen}} = \\rho g Q_{\\mathrm{gen}} H_{\\mathrm{net,gen}} = \\rho g Q_{\\mathrm{gen}} (H - h_{L,\\mathrm{gen}}) $$\nThis hydraulic power is converted to electrical power with a combined efficiency $\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}}$:\n$$ P_{\\mathrm{elec,gen}} = \\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}} P_{\\mathrm{hyd,gen}} $$\nThe total energy generated over a duration $T_{\\mathrm{gen}}$ is $E_{\\mathrm{elec,gen}} = P_{\\mathrm{elec,gen}} T_{\\mathrm{gen}}$.\n\n**Pumping Mode Analysis**\nDuring pumping, the energy balance between the lower (point 2) and upper (point 1) reservoirs includes the head added by the pump, $H_{\\mathrm{pump}}$:\n$$ \\frac{P_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + H_{\\mathrm{pump}} = \\frac{P_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 + h_{L,\\mathrm{pump}} $$\nWith the same assumptions, this gives $H_{\\mathrm{pump}} = (z_1 - z_2) + h_{L,\\mathrm{pump}} = H + h_{L,\\mathrm{pump}}$. This is the total dynamic head the pump must overcome. The hydraulic power delivered to the water is:\n$$ P_{\\mathrm{hyd,pump}} = \\rho g Q_{\\mathrm{pump}} H_{\\mathrm{pump}} = \\rho g Q_{\\mathrm{pump}} (H + h_{L,\\mathrm{pump}}) $$\nThe electrical power consumed by the motor-pump unit with combined efficiency $\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}$ is:\n$$ P_{\\mathrm{elec,pump}} = \\frac{P_{\\mathrm{hyd,pump}}}{\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}} $$\nTo return the volume of water displaced during generation, $V = Q_{\\mathrm{gen}} T_{\\mathrm{gen}}$, the pumping duration must be $T_{\\mathrm{pump}} = V / Q_{\\mathrm{pump}} = (Q_{\\mathrm{gen}} T_{\\mathrm{gen}}) / Q_{\\mathrm{pump}}$. The total energy consumed is $E_{\\mathrm{elec,pump}} = P_{\\mathrm{elec,pump}} T_{\\mathrm{pump}}$.\n\n**RTE Calculation**\nSubstituting the expressions for energy into the RTE definition:\n$$ \\mathrm{RTE} = \\frac{ (\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}}) (\\rho g Q_{\\mathrm{gen}} (H - h_{L,\\mathrm{gen}})) T_{\\mathrm{gen}} }{ \\frac{\\rho g Q_{\\mathrm{pump}} (H + h_{L,\\mathrm{pump}})}{\\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}} \\left( \\frac{Q_{\\mathrm{gen}} T_{\\mathrm{gen}}}{Q_{\\mathrm{pump}}} \\right) } $$\nSimplifying by canceling common terms ($\\rho, g, Q_{\\mathrm{gen}}, T_{\\mathrm{gen}}$ and the two $Q_{\\mathrm{pump}}$ terms) yields the final expression for RTE:\n$$ \\mathrm{RTE} = (\\eta_{\\mathrm{turb,h}} \\eta_{\\mathrm{e,gen}} \\eta_{\\mathrm{pump,h}} \\eta_{\\mathrm{motor}}) \\left( \\frac{H - h_{L,\\mathrm{gen}}}{H + h_{L,\\mathrm{pump}}} \\right) $$\nThe hydraulic head losses $h_{L}$ are calculated using the Darcy-Weisbach equation for friction loss and the minor loss formula:\n$$ h_{L} = \\left( f \\frac{L}{D} + K \\right) \\frac{v^2}{2g} $$\nwhere $v=Q/A$ and $A = \\pi D^2 / 4$.\n\n**Numerical Computation**\nThe given values are:\n$H = 120 \\ \\mathrm{m}$, $L = 800 \\ \\mathrm{m}$, $D = 4 \\ \\mathrm{m}$, $g = 9.81 \\ \\mathrm{m/s^2}$.\n$Q_{\\mathrm{gen}} = 50 \\ \\mathrm{m^3/s}$, $f_{\\mathrm{gen}} = 0.018$, $K_{\\mathrm{gen}} = 2.0$.\n$Q_{\\mathrm{pump}} = 45 \\ \\mathrm{m^3/s}$, $f_{\\mathrm{pump}} = 0.020$, $K_{\\mathrm{pump}} = 2.5$.\n$\\eta_{\\mathrm{turb,h}} = 0.92$, $\\eta_{\\mathrm{e,gen}} = 0.98$, $\\eta_{\\mathrm{pump,h}} = 0.88$, $\\eta_{\\mathrm{motor}} = 0.96$.\n\n1.  Penstock Area: $A = \\frac{\\pi (4 \\ \\mathrm{m})^2}{4} = 4\\pi \\ \\mathrm{m}^2$.\n\n2.  Flow Velocities:\n    $v_{\\mathrm{gen}} = \\frac{50 \\ \\mathrm{m^3/s}}{4\\pi \\ \\mathrm{m}^2} = \\frac{12.5}{\\pi} \\ \\mathrm{m/s}$.\n    $v_{\\mathrm{pump}} = \\frac{45 \\ \\mathrm{m^3/s}}{4\\pi \\ \\mathrm{m}^2} = \\frac{11.25}{\\pi} \\ \\mathrm{m/s}$.\n\n3.  Velocity Heads:\n    $\\frac{v_{\\mathrm{gen}}^2}{2g} = \\frac{(12.5/\\pi \\ \\mathrm{m/s})^2}{2(9.81 \\ \\mathrm{m/s^2})} \\approx 0.80690 \\ \\mathrm{m}$.\n    $\\frac{v_{\\mathrm{pump}}^2}{2g} = \\frac{(11.25/\\pi \\ \\mathrm{m/s})^2}{2(9.81 \\ \\mathrm{m/s^2})} \\approx 0.65359 \\ \\mathrm{m}$.\n\n4.  Head Losses:\n    The ratio $L/D = 800/4 = 200$.\n    $h_{L,\\mathrm{gen}} = (0.018 \\times 200 + 2.0) \\times (0.80690 \\ \\mathrm{m}) = (3.6 + 2.0) \\times 0.80690 \\ \\mathrm{m} = 5.6 \\times 0.80690 \\ \\mathrm{m} \\approx 4.51864 \\ \\mathrm{m}$.\n    $h_{L,\\mathrm{pump}} = (0.020 \\times 200 + 2.5) \\times (0.65359 \\ \\mathrm{m}) = (4.0 + 2.5) \\times 0.65359 \\ \\mathrm{m} = 6.5 \\times 0.65359 \\ \\mathrm{m} \\approx 4.24834 \\ \\mathrm{m}$.\n\n5.  Round-Trip Efficiency:\n    The product of the equipment efficiencies is:\n    $\\eta_{\\mathrm{em}} = 0.92 \\times 0.98 \\times 0.88 \\times 0.96 = 0.76169216$.\n    The hydraulic cycle efficiency is:\n    $\\eta_{\\mathrm{hyd}} = \\frac{H - h_{L,\\mathrm{gen}}}{H + h_{L,\\mathrm{pump}}} = \\frac{120 \\ \\mathrm{m} - 4.51864 \\ \\mathrm{m}}{120 \\ \\mathrm{m} + 4.24834 \\ \\mathrm{m}} = \\frac{115.48136}{124.24834} \\approx 0.929439$.\n    The total Round-Trip Efficiency is:\n    $\\mathrm{RTE} = \\eta_{\\mathrm{em}} \\times \\eta_{\\mathrm{hyd}} = 0.76169216 \\times 0.929439 \\approx 0.707915$.\n\nRounding the result to four significant figures gives $0.7079$.",
            "answer": "$$\\boxed{0.7079}$$"
        },
        {
            "introduction": "Moving from macroscopic mechanical systems to electrochemical devices, we now model an electrochemical double-layer capacitor (EDLC) bank. This practice goes beyond the ideal energy storage formula, $W = \\frac{1}{2}CV^2$, to compute the actual usable energy available in a real-world application. You will learn to incorporate crucial operational constraints, such as temperature-dependent capacitance, voltage derating for safety, and the operating window of the power electronics, to distinguish between theoretical capacity and deliverable performance. ",
            "id": "4090324",
            "problem": "A distribution-level fast frequency response device uses an electrochemical double-layer capacitor (EDLC) bank as its energy storage element. The EDLC bank consists of $N_s$ cells in series per string and $N_p$ parallel strings. Each cell is modeled as a linear capacitor whose capacitance depends on temperature but is independent of voltage over the operating window. The work required to charge a capacitor from zero voltage to a voltage $V$ at fixed temperature $T$ is defined by the incremental work $dW = v\\,dq$, where $q$ is the electric charge and $v$ is the instantaneous voltage. For a linear capacitor at fixed $T$, the constitutive relation between charge and voltage is $q = C(T)\\,v$, where $C(T)$ is the capacitance at temperature $T$.\n\nThe EDLC cell has nominal capacitance $C_{\\mathrm{cell},25}$ at $25^\\circ\\mathrm{C}$ and a temperature coefficient $\\alpha$ such that $C_{\\mathrm{cell}}(T) = C_{\\mathrm{cell},25}\\,[1 + \\alpha\\,(T - 25^\\circ\\mathrm{C})]$. The maximum allowable cell voltage at temperature $T$ is operationally derated above a threshold temperature $T_0$ according to $V_{\\mathrm{cell,max}}(T) = V_{\\mathrm{cell,nom}} - \\gamma\\,\\max(0,\\,T - T_0)$, where $V_{\\mathrm{cell,nom}}$ is the nominal maximum cell voltage at or below $T_0$. The power electronic converter interfacing the EDLC bank imposes a DC bus voltage window $[V_{\\min},\\,V_{\\max,\\mathrm{conv}}]$; the EDLC bank is charged to the lesser of the converter upper bound and the temperature-derated bank maximum, and is discharged only down to the converter lower bound.\n\nParameters and application profile:\n- $N_s = 18$, $N_p = 2$.\n- $C_{\\mathrm{cell},25} = 3000$ F, $V_{\\mathrm{cell,nom}} = 2.7$ V, $T_0 = 35^\\circ\\mathrm{C}$, $\\alpha = 1.0 \\times 10^{-3}\\ \\mathrm{K}^{-1}$, $\\gamma = 1.0 \\times 10^{-2}$ V/K.\n- Ambient temperature $T = 50^\\circ\\mathrm{C}$.\n- Converter voltage window: $V_{\\min} = 30$ V, $V_{\\max,\\mathrm{conv}} = 48$ V.\n- Neglect resistive losses and leakage during the discharge event, and assume $C(T)$ is constant over the voltage window at fixed $T$.\n\nTask:\nStarting from the definitions $dW = v\\,dq$ and $q = C(T)\\,v$, derive an expression for the energy stored in the EDLC bank at voltage $V$ and fixed temperature $T$. Then compute the usable energy that can be extracted when discharging from the initial bank voltage $V_i$ (the lesser of the converter upper bound and the temperature-derated bank maximum) down to the final bank voltage $V_f = V_{\\min}$ at $T = 50^\\circ\\mathrm{C}$. Round your final numerical answer to four significant figures and express the energy in kJ. The final answer must be a single real number.",
            "solution": "The first task is to derive an expression for the energy stored in the EDLC bank. We begin with the fundamental definitions provided: the incremental work $dW$ to add an incremental charge $dq$ to a capacitor at voltage $v$ is $dW = v\\,dq$. For a linear capacitor at a fixed temperature $T$, the relationship between charge $q$ and voltage $v$ is $q = C(T)\\,v$, where $C(T)$ is the capacitance. At a fixed temperature, $C(T)$ is constant, so we can denote it simply as $C$. Differentiating the charge-voltage relation gives $dq = C\\,dv$.\n\nThe total energy $W$ stored when charging the capacitor from a voltage of $0$ to a final voltage $V$ is the integral of the incremental work:\n$$W = \\int_{v=0}^{v=V} dW = \\int_{v=0}^{v=V} v\\,dq$$\nSubstituting $dq = C\\,dv$:\n$$W = \\int_{0}^{V} v\\,(C\\,dv) = C \\int_{0}^{V} v\\,dv = C \\left[ \\frac{1}{2}v^2 \\right]_{0}^{V} = \\frac{1}{2}CV^2$$\nThis is the general expression for the energy stored in a linear capacitor. The EDLC bank, being a combination of linear capacitors, also behaves as a single linear capacitor with an equivalent bank capacitance $C_{\\mathrm{bank}}$. Thus, the energy stored in the bank at a voltage $V_{\\mathrm{bank}}$ is:\n$$W_{\\mathrm{bank}}(V_{\\mathrm{bank}}) = \\frac{1}{2} C_{\\mathrm{bank}}(T) V_{\\mathrm{bank}}^2$$\n\nNext, we determine the properties of the entire EDLC bank based on its constituent cells. The bank consists of $N_p$ parallel strings, where each string has $N_s$ cells in series.\nFor $N_s$ cells in series, the total string capacitance is $C_{\\mathrm{string}} = \\frac{C_{\\mathrm{cell}}}{N_s}$ and the total string voltage is the sum of cell voltages, $V_{\\mathrm{string}} = N_s V_{\\mathrm{cell}}$.\nFor $N_p$ strings in parallel, the total bank capacitance is $C_{\\mathrm{bank}} = N_p C_{\\mathrm{string}} = \\frac{N_p}{N_s} C_{\\mathrm{cell}}$, and the bank voltage is the same as the string voltage, $V_{\\mathrm{bank}} = V_{\\mathrm{string}}$.\nTherefore, the bank parameters in terms of cell parameters are:\n$$C_{\\mathrm{bank}}(T) = \\frac{N_p}{N_s} C_{\\mathrm{cell}}(T)$$\n$$V_{\\mathrm{bank,max}}(T) = N_s V_{\\mathrm{cell,max}}(T)$$\n\nWe are given the operating temperature $T = 50^\\circ\\mathrm{C}$. We first calculate the individual cell parameters at this temperature. The temperature dependencies are given with coefficients in units of $\\mathrm{K}^{-1}$ and $\\mathrm{V/K}$, while temperatures are in ${}^\\circ\\mathrm{C}$. This is standard, as a temperature difference has the same numerical value in Kelvin and degrees Celsius (i.e., $\\Delta T_{\\mathrm{K}} = \\Delta T_{^\\circ\\mathrm{C}}$).\n\nThe cell capacitance at $T = 50^\\circ\\mathrm{C}$ is:\n$$C_{\\mathrm{cell}}(T) = C_{\\mathrm{cell},25}\\,[1 + \\alpha\\,(T - 25^\\circ\\mathrm{C})]$$\n$$C_{\\mathrm{cell}}(50^\\circ\\mathrm{C}) = 3000\\,\\text{F} \\times [1 + (1.0 \\times 10^{-3}\\,\\mathrm{K}^{-1}) \\times (50 - 25)\\,\\mathrm{K}] = 3000 \\times [1 + 0.025] = 3075\\,\\text{F}$$\n\nThe maximum allowable cell voltage at $T = 50^\\circ\\mathrm{C}$ is derated because $T > T_0$.\n$$V_{\\mathrm{cell,max}}(T) = V_{\\mathrm{cell,nom}} - \\gamma\\,\\max(0,\\,T - T_0)$$\n$$V_{\\mathrm{cell,max}}(50^\\circ\\mathrm{C}) = 2.7\\,\\text{V} - (1.0 \\times 10^{-2}\\,\\mathrm{V/K}) \\times \\max(0, 50 - 35)\\,\\mathrm{K} = 2.7 - (1.0 \\times 10^{-2}) \\times 15 = 2.7 - 0.15 = 2.55\\,\\text{V}$$\n\nNow, we can calculate the bank-level parameters using $N_s = 18$ and $N_p = 2$.\nThe bank capacitance at $T = 50^\\circ\\mathrm{C}$ is:\n$$C_{\\mathrm{bank}}(50^\\circ\\mathrm{C}) = \\frac{N_p}{N_s} C_{\\mathrm{cell}}(50^\\circ\\mathrm{C}) = \\frac{2}{18} \\times 3075\\,\\text{F} = \\frac{3075}{9}\\,\\text{F} \\approx 341.67\\,\\text{F}$$\nThe maximum allowable bank voltage at $T = 50^\\circ\\mathrm{C}$ is:\n$$V_{\\mathrm{bank,max}}(50^\\circ\\mathrm{C}) = N_s V_{\\mathrm{cell,max}}(50^\\circ\\mathrm{C}) = 18 \\times 2.55\\,\\text{V} = 45.9\\,\\text{V}$$\n\nThe usable energy is extracted by discharging the bank over a specific voltage range. The initial voltage, $V_i$, is the fully charged state, which is the lesser of the temperature-derated bank maximum and the converter's upper voltage limit, $V_{\\max,\\mathrm{conv}} = 48\\,\\text{V}$.\n$$V_i = \\min(V_{\\mathrm{bank,max}}(50^\\circ\\mathrm{C}), V_{\\max,\\mathrm{conv}}) = \\min(45.9\\,\\text{V}, 48\\,\\text{V}) = 45.9\\,\\text{V}$$\nThe final voltage, $V_f$, is the converter's lower voltage limit, $V_{\\min} = 30\\,\\text{V}$.\n$$V_f = V_{\\min} = 30\\,\\text{V}$$\n\nThe usable energy, $\\Delta W$, is the difference between the energy stored at $V_i$ and the energy stored at $V_f$.\n$$\\Delta W = W_{\\mathrm{bank}}(V_i) - W_{\\mathrm{bank}}(V_f) = \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})V_i^2 - \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})V_f^2$$\n$$\\Delta W = \\frac{1}{2}C_{\\mathrm{bank}}(50^\\circ\\mathrm{C})(V_i^2 - V_f^2)$$\nSubstituting the calculated values:\n$$\\Delta W = \\frac{1}{2} \\left(\\frac{3075}{9}\\,\\text{F}\\right) \\left( (45.9\\,\\text{V})^2 - (30\\,\\text{V})^2 \\right)$$\n$$\\Delta W = \\frac{3075}{18} (2106.81 - 900)\\,\\text{J}$$\n$$\\Delta W = \\frac{3075}{18} (1206.81)\\,\\text{J} \\approx 206200.708\\,\\text{J}$$\n\nThe problem requires the answer in kilojoules (kJ), rounded to four significant figures.\n$$\\Delta W \\approx 206.200708\\,\\text{kJ}$$\nRounding to four significant figures, we get:\n$$\\Delta W = 206.2\\,\\text{kJ}$$",
            "answer": "$$\\boxed{206.2}$$"
        },
        {
            "introduction": "Our final practice addresses one of the most complex and commercially significant aspects of energy storage modeling: predicting lifetime and degradation. This computational exercise guides you through implementing a sophisticated life-cycle analysis for a battery, based on an analogy to mechanical fatigue. You will apply rainflow counting to a state-of-charge profile to quantify damaging cycles and use Miner's rule to estimate cumulative damage, translating complex usage patterns into a concrete prediction of energy throughput to failure. ",
            "id": "4090343",
            "problem": "You are given discrete time series representing battery State of Charge (SoC) cycling profiles, along with physically meaningful parameters that allow mapping SoC variations to electrode stress. Your task is to compute the cumulative external energy throughput for each profile and estimate the cycle life by applying rainflow counting on the induced stress signal and a Wöhler-type fatigue model. The solution must be implemented as a complete, runnable program.\n\nAssume the following physically grounded base definitions and laws:\n\n- Energy conservation: Stored energy change in a battery over a time step is proportional to the change in State of Charge. If the nominal energy capacity is $C_{\\mathrm{Wh}}$ in watt-hours (Wh), and the SoC changes by $\\Delta s$, then the internal energy change is $C_{\\mathrm{Wh}} \\,\\Delta s$ in $\\mathrm{Wh}$.\n\n- External energy throughput accounts for charge and discharge conversion efficiencies. For a time step $k$ with SoC change $\\Delta s_k$, charging ($\\Delta s_k \\gt 0$) requires external energy $C_{\\mathrm{Wh}} \\,\\Delta s_k / \\eta_c$, while discharging ($\\Delta s_k \\lt 0$) yields external energy $C_{\\mathrm{Wh}} \\,|\\Delta s_k| \\,\\eta_d$. Here $\\eta_c$ and $\\eta_d$ are the charge and discharge efficiencies, respectively, each a dimensionless number in $(0,1]$.\n\n- Stress-number of cycles (S–N) Wöhler-type fatigue model: If the stress amplitude for cycle $i$ is $\\Delta \\sigma_i$, the cycles to failure at that amplitude are $N_i = N_{\\mathrm{ref}}\\left(\\dfrac{\\Delta \\sigma_{\\mathrm{ref}}}{\\Delta \\sigma_i}\\right)^m$, where $N_{\\mathrm{ref}}$ is the cycles to failure at reference stress amplitude $\\Delta \\sigma_{\\mathrm{ref}}$, and $m$ is the Basquin exponent. The per-cycle damage is $d_i = \\dfrac{1}{N_i} = \\dfrac{1}{N_{\\mathrm{ref}}}\\left(\\dfrac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m$.\n\n- Miner's linear damage accumulation rule: The total damage over a profile is $D_{\\mathrm{profile}} = \\sum_i \\alpha_i \\, d_i$, where $\\alpha_i$ is the cycle count weight ($\\alpha_i = 1$ for a full cycle and $\\alpha_i = \\tfrac{1}{2}$ for a half cycle). The predicted number of repeats of the given profile to failure (cycle life for this repeated use) is $R^\\star = \\dfrac{1}{D_{\\mathrm{profile}}}$.\n\n- Mapping SoC to stress: Use a linear mapping for the electrode stress signal $\\sigma(t)$ from SoC, $\\sigma(t) = k_\\sigma \\, s(t)$, where $k_\\sigma$ has units $\\mathrm{MPa}$ per unit SoC and $s(t)$ is dimensionless. This ensures the stress amplitude for a counted cycle is $\\Delta \\sigma = k_\\sigma \\, \\Delta s$.\n\nThe rainflow counting must be performed on the discrete stress signal $\\{\\sigma_k\\}$ obtained from the SoC samples $\\{s_k\\}$. Use an algorithm that:\n- Extracts turning points (local extrema) from $\\{\\sigma_k\\}$ to form a sequence of reversals.\n- Iteratively applies the rainflow counting rules to identify full and half cycles and their amplitudes $\\Delta \\sigma_i$.\n- Produces a set of cycles with amplitudes and weights $\\alpha_i \\in \\{1,\\tfrac{1}{2}\\}$.\n\nFor each test case, compute:\n- The cumulative external energy throughput in $\\mathrm{Wh}$ over the provided profile (sum of external charge and discharge energy magnitudes).\n- The total damage $D_{\\mathrm{profile}}$ over the profile.\n- The predicted repeats to failure $R^\\star = \\dfrac{1}{D_{\\mathrm{profile}}}$, dimensionless. If $D_{\\mathrm{profile}} = 0$, define $R^\\star = +\\infty$.\n- The energy throughput to failure $E_{\\mathrm{TTF}} = R^\\star \\times E_{\\mathrm{throughput}}$, expressed in $\\mathrm{Wh}$. If $R^\\star = +\\infty$, define $E_{\\mathrm{TTF}} = +\\infty$.\n\nExpress all energy values in $\\mathrm{Wh}$, and produce dimensionless quantities without units. Angles are not involved, and no angle unit is required.\n\nUse the following Test Suite of parameter sets. Each test case is defined by a tuple $(\\{s_k\\}, \\Delta t, C_{\\mathrm{Wh}}, \\eta_c, \\eta_d, k_\\sigma, \\Delta \\sigma_{\\mathrm{ref}}, N_{\\mathrm{ref}}, m)$:\n- Test Case $1$ (happy path, mixed amplitudes):\n  - $\\{s_k\\} = [\\,0.50,\\,0.65,\\,0.40,\\,0.75,\\,0.35,\\,0.80,\\,0.45,\\,0.60\\,]$\n  - $\\Delta t = 600\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- Test Case $2$ (boundary, monotonic increase causing only half cycles):\n  - $\\{s_k\\} = [\\,0.50,\\,0.55,\\,0.60,\\,0.65,\\,0.70\\,]$\n  - $\\Delta t = 900\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- Test Case $3$ (edge case with mixed half and full cycles):\n  - $\\{s_k\\} = [\\,0.20,\\,0.60,\\,0.30,\\,0.55,\\,0.25\\,]$\n  - $\\Delta t = 300\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n- Test Case $4$ (high-stress swings):\n  - $\\{s_k\\} = [\\,0.10,\\,0.90,\\,0.20,\\,0.85,\\,0.30,\\,0.80\\,]$\n  - $\\Delta t = 1200\\,\\mathrm{s}$\n  - $C_{\\mathrm{Wh}} = 10000$\n  - $\\eta_c = 0.96$\n  - $\\eta_d = 0.96$\n  - $k_\\sigma = 80\\,\\mathrm{MPa}$\n  - $\\Delta \\sigma_{\\mathrm{ref}} = 32\\,\\mathrm{MPa}$\n  - $N_{\\mathrm{ref}} = 12000$\n  - $m = 3.2$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a list in the form $[E_{\\mathrm{throughput}}, D_{\\mathrm{profile}}, R^\\star, E_{\\mathrm{TTF}}]$. For example, the final output should look like $[[x_1,y_1,z_1,w_1],[x_2,y_2,z_2,w_2],[x_3,y_3,z_3,w_3],[x_4,y_4,z_4,w_4]]$ with numeric values replacing the placeholders.",
            "solution": "The task requires integrating foundational electrochemical energy accounting with mechanical fatigue analysis. The derivation proceeds from first principles.\n\nStart with the energy conservation principle for a battery. Let the nominal energy capacity be $C_{\\mathrm{Wh}}$ in watt-hours. The State of Charge sequence is $\\{s_k\\}$, dimensionless and bounded in $[0,1]$. The internal energy change over a discrete step $k$ is $\\Delta E_{\\mathrm{int},k} = C_{\\mathrm{Wh}} \\,\\Delta s_k$, with $\\Delta s_k = s_{k+1} - s_k$. External energy accounting incorporates efficiency. For charging steps ($\\Delta s_k \\gt 0$), the required external energy input is $E_{\\mathrm{ext},k}^{\\mathrm{in}} = \\dfrac{C_{\\mathrm{Wh}} \\,\\Delta s_k}{\\eta_c}$. For discharging steps ($\\Delta s_k \\lt 0$), the external energy output is $E_{\\mathrm{ext},k}^{\\mathrm{out}} = C_{\\mathrm{Wh}} \\,|\\Delta s_k| \\,\\eta_d$. The cumulative external energy throughput, defined as the sum of magnitudes of external energy flows, is\n$$\nE_{\\mathrm{throughput}} = \\sum_{k=0}^{K-2}\n\\begin{cases}\n\\dfrac{C_{\\mathrm{Wh}} \\,\\Delta s_k}{\\eta_c}, & \\Delta s_k \\gt 0,\\\n$$6pt]\nC_{\\mathrm{Wh}} \\,(-\\Delta s_k)\\,\\eta_d, & \\Delta s_k \\lt 0,\\\n$$6pt]\n0, & \\Delta s_k = 0.\n\\end{cases}\n$$\nThis quantity is expressed in $\\mathrm{Wh}$.\n\nNext, map the SoC signal to electrode stress using the linear model $\\sigma_k = k_\\sigma \\, s_k$, where $k_\\sigma$ has units $\\mathrm{MPa}$ per unit SoC. This mapping reflects a proportional relationship between lithiation state and mechanical stress, which is consistent with small-strain approximations in active materials. The stress sequence $\\{\\sigma_k\\}$ is then analyzed using rainflow counting to extract cycle amplitudes. The rainflow algorithm operates on the sequence of turning points (reversals) and applies a stack-based comparison of adjacent ranges to identify closed cycles. For three consecutive reversals $\\sigma_{a}, \\sigma_{b}, \\sigma_{c}$, define ranges $R_1 = |\\sigma_b - \\sigma_a|$ and $R_2 = |\\sigma_c - \\sigma_b|$. If $R_1 \\le R_2$, a cycle with amplitude $\\Delta \\sigma = R_1$ is counted; the algorithm then removes the middle points and continues. At the end of the traversal, residual adjacent pairs on the stack represent half cycles. Each counted element is associated with a weight $\\alpha_i = 1$ for full cycles and $\\alpha_i = \\tfrac{1}{2}$ for half cycles.\n\nWith the set of cycle amplitudes $\\{\\Delta \\sigma_i\\}$ and weights $\\{\\alpha_i\\}$, apply the Wöhler-type fatigue model. The cycles to failure at amplitude $\\Delta \\sigma_i$ is\n$$\nN_i = N_{\\mathrm{ref}}\\left(\\dfrac{\\Delta \\sigma_{\\mathrm{ref}}}{\\Delta \\sigma_i}\\right)^m,\n$$\nwith $N_{\\mathrm{ref}}$ the cycles to failure at the reference stress amplitude $\\Delta \\sigma_{\\mathrm{ref}}$, and $m$ the Basquin exponent. The damage for cycle $i$ is\n$$\nd_i = \\dfrac{1}{N_i} = \\dfrac{1}{N_{\\mathrm{ref}}}\\left(\\dfrac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m.\n$$\nBy Miner's rule, the total damage over the profile is\n$$\nD_{\\mathrm{profile}} = \\sum_i \\alpha_i \\, d_i = \\sum_i \\alpha_i \\, \\dfrac{1}{N_{\\mathrm{ref}}}\\left(\\dfrac{\\Delta \\sigma_i}{\\Delta \\sigma_{\\mathrm{ref}}}\\right)^m.\n$$\nIf no cycles are detected or all amplitudes are zero, then $D_{\\mathrm{profile}} = 0$. The predicted number of repeats to failure is\n$$\nR^\\star = \\begin{cases}\n\\dfrac{1}{D_{\\mathrm{profile}}}, & D_{\\mathrm{profile}} \\gt 0,\\\n$$6pt]\n+\\infty, & D_{\\mathrm{profile}} = 0.\n\\end{cases}\n$$\nThe energy throughput to failure is the cumulative throughput of the profile scaled by the number of repeats:\n$$\nE_{\\mathrm{TTF}} = R^\\star \\times E_{\\mathrm{throughput}}.\n$$\nIf $R^\\star = +\\infty$, then $E_{\\mathrm{TTF}} = +\\infty$.\n\nAlgorithmic design:\n\n- Compute $E_{\\mathrm{throughput}}$ directly from $\\{s_k\\}$, $C_{\\mathrm{Wh}}$, $\\eta_c$, and $\\eta_d$ using the piecewise sum above.\n\n- Generate the stress sequence $\\sigma_k = k_\\sigma \\, s_k$.\n\n- Extract reversals: include the first and last points, and any intermediate point $\\sigma_i$ that satisfies $(\\sigma_i - \\sigma_{i-1})(\\sigma_{i+1} - \\sigma_i) \\le 0$ with inequality strict when adjacent values differ. Remove consecutive duplicates to avoid zero-length ranges.\n\n- Apply the stack-based rainflow algorithm:\n  - Initialize an empty stack.\n  - For each reversal value, push onto the stack and, while there are at least three points, compare the last two ranges. If the earlier range is less than or equal to the later, count a full cycle of amplitude equal to the earlier range and remove the two earlier points from the stack; otherwise stop the inner loop.\n  - After processing all reversals, count half cycles for each remaining adjacent pair on the stack with amplitude equal to the pair’s range.\n\n- Compute $D_{\\mathrm{profile}}$ via the Wöhler model for each cycle amplitude, applying $\\alpha_i$ weights.\n\n- Compute $R^\\star$ and $E_{\\mathrm{TTF}}$.\n\nThis approach respects conservation of energy in throughput computation and uses a well-tested fatigue model (the stress-number of cycles Wöhler relation) combined with rainflow counting, a standard method for transforming variable-amplitude load histories into a set of damaging cycles. The program applies this procedure to the four test cases and outputs the requested list-of-lists, with energy values in $\\mathrm{Wh}$ and dimensionless damage and repeats.",
            "answer": "```python\nimport numpy as np\n\ndef extract_reversals(series: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Extract turning points (reversals) from a numeric sequence.\n    Includes first and last points. Removes consecutive duplicates.\n    \"\"\"\n    if len(series) == 0:\n        return np.array([])\n    # Remove consecutive duplicates\n    s = [series[0]]\n    for x in series[1:]:\n        if x != s[-1]:\n            s.append(x)\n    s = np.array(s, dtype=float)\n    if len(s) == 1:\n        return s.copy()\n\n    rev = [s[0]]\n    for i in range(1, len(s) - 1):\n        prev = s[i - 1]\n        curr = s[i]\n        nxt = s[i + 1]\n        # reversal if direction changes or plateau transitions\n        if (curr - prev) * (nxt - curr) <= 0:\n            if not (curr == prev and curr == nxt):\n                rev.append(curr)\n    rev.append(s[-1])\n    # Remove consecutive duplicates in reversals\n    clean = [rev[0]]\n    for x in rev[1:]:\n        if x != clean[-1]:\n            clean.append(x)\n    return np.array(clean, dtype=float)\n\ndef rainflow_ranges(series: np.ndarray):\n    \"\"\"\n    Perform rainflow counting on a sequence of stress values.\n    Returns a list of tuples (amplitude, weight) where weight is 1.0 for full cycle\n    and 0.5 for half cycle.\n    \"\"\"\n    rev = extract_reversals(series)\n    cycles = []\n    stack = []\n    for x in rev:\n        stack.append(x)\n        # While at least 3 reversals, compare ranges\n        while len(stack) >= 3:\n            s0 = stack[-3]\n            s1 = stack[-2]\n            s2 = stack[-1]\n            r1 = abs(s1 - s0)\n            r2 = abs(s2 - s1)\n            if r1 <= r2:\n                # Count a full cycle of amplitude r1\n                if r1 > 0.0:\n                    cycles.append((r1, 1.0))\n                # Remove middle two: first remove s1 (index -2), then s0 (now at index -2)\n                stack.pop(-2)\n                stack.pop(-2)\n            else:\n                break\n    # Remaining adjacent pairs are half cycles\n    for i in range(len(stack) - 1):\n        r = abs(stack[i + 1] - stack[i])\n        if r > 0.0:\n            cycles.append((r, 0.5))\n    return cycles\n\ndef compute_throughput_wh(soc: np.ndarray, C_wh: float, eta_c: float, eta_d: float) -> float:\n    \"\"\"\n    Compute cumulative external energy throughput in Wh from an SoC sequence.\n    Charging steps: external energy in = C_wh * delta_soc / eta_c\n    Discharging steps: external energy out = C_wh * (-delta_soc) * eta_d\n    \"\"\"\n    throughput = 0.0\n    for i in range(len(soc) - 1):\n        ds = soc[i + 1] - soc[i]\n        if ds > 0:\n            throughput += C_wh * ds / eta_c\n        elif ds < 0:\n            throughput += C_wh * (-ds) * eta_d\n        # ds == 0 contributes nothing\n    return throughput\n\ndef fatigue_damage_profile(soc: np.ndarray, k_sigma: float, sigma_ref: float,\n                           N_ref: float, m: float) -> float:\n    \"\"\"\n    Map SoC to stress, apply rainflow counting, and compute total damage per profile.\n    Damage per cycle: d_i = (1/N_ref) * (Delta_sigma_i / sigma_ref)^m\n    \"\"\"\n    sigma = k_sigma * soc\n    cycles = rainflow_ranges(sigma)\n    D = 0.0\n    for amp, weight in cycles:\n        if amp <= 0.0:\n            continue\n        # Damage contribution\n        D += weight * (amp / sigma_ref) ** m / N_ref\n    return D\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (soc_list, dt_seconds, C_wh, eta_c, eta_d, k_sigma, sigma_ref, N_ref, m)\n    test_cases = [\n        ([0.50, 0.65, 0.40, 0.75, 0.35, 0.80, 0.45, 0.60], 600, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.50, 0.55, 0.60, 0.65, 0.70], 900, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.20, 0.60, 0.30, 0.55, 0.25], 300, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n        ([0.10, 0.90, 0.20, 0.85, 0.30, 0.80], 1200, 10000.0, 0.96, 0.96, 80.0, 32.0, 12000.0, 3.2),\n    ]\n\n    results = []\n    for case in test_cases:\n        soc_list, dt, C_wh, eta_c, eta_d, k_sigma, sigma_ref, N_ref, m = case\n        soc = np.array(soc_list, dtype=float)\n\n        # Energy throughput in Wh\n        E_throughput = compute_throughput_wh(soc, C_wh, eta_c, eta_d)\n\n        # Damage per profile\n        D_profile = fatigue_damage_profile(soc, k_sigma, sigma_ref, N_ref, m)\n\n        # Repeats to failure\n        if D_profile > 0.0:\n            R_star = 1.0 / D_profile\n            E_ttf = R_star * E_throughput\n        else:\n            R_star = float('inf')\n            E_ttf = float('inf')\n\n        results.append([E_throughput, D_profile, R_star, E_ttf])\n\n    # Final print statement in the exact required format.\n    # Produce a single line with the list-of-lists.\n    print(f\"[{','.join([str(r) for r in results])}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}