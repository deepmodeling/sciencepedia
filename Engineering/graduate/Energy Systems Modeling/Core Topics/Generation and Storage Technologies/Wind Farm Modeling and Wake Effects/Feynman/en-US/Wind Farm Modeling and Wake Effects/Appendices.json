{
    "hands_on_practices": [
        {
            "introduction": "This exercise grounds our study in the fundamental physics of wind energy extraction using the actuator disk model. By applying conservation laws to this idealized yet powerful representation of a turbine, you will derive the core relationships between inflow velocity, power extraction, and the resulting velocity deficit in the wake. This practice is essential for understanding the physical origin of wake effects and the theoretical limits of turbine performance. ",
            "id": "4136830",
            "problem": "A single horizontal-axis wind turbine in a large, neutrally stratified onshore wind farm is modeled as a permeable, uniformly loaded actuator disk immersed in a steady, incompressible, axisymmetric stream tube. The far-upstream freestream velocity is $U_{\\infty}$, the air density is $\\rho$, and the rotor area is $A$. Define the axial induction factor $a$ by the disk velocity $U_{\\text{disk}} = U_{\\infty}(1 - a)$. Assume a steady control volume around the stream tube, negligible shear and swirl, equal static pressure far upstream and far downstream, and that Bernoulli’s equation applies along streamlines outside the disk, with a pressure jump across the disk.\n\nStarting from conservation of mass and conservation of linear momentum applied to the control volume, together with the above assumptions, derive the far-wake centerline velocity $U_{d}$ downstream of the turbine in terms of $U_{\\infty}$ and $a$, and derive the extracted mechanical power $P$ in terms of $\\rho$, $A$, $U_{\\infty}$, and $a$. Introduce the power coefficient (C_p) as $C_{p} \\equiv \\dfrac{P}{\\tfrac{1}{2}\\rho A U_{\\infty}^{3}}$ and express it solely in terms of $a$.\n\nThen, for a turbine characterized by $\\rho = 1.225\\,\\text{kg m}^{-3}$, $A = 1.0000 \\times 10^{4}\\,\\text{m}^{2}$, $U_{\\infty} = 10.0\\,\\text{m s}^{-1}$, and $a = \\dfrac{1}{3}$, compute numerical values of $U_{d}$ and $P$. Express $U_{d}$ in meters per second and $P$ in megawatts. Round both quantities to $4$ significant figures. Your final answer must be a single two-entry row matrix containing $U_{d}$ and $P$ (in the specified units).",
            "solution": "The problem is valid as it is a standard application of the Rankine-Froude actuator disk model, which is a fundamental and scientifically grounded concept in wind energy engineering. The problem is well-posed, objective, self-contained, and uses realistic physical parameters.\n\nWe begin by applying the principles of conservation of mass and linear momentum to a control volume defined by the stream tube that passes through the turbine disk. Let the cross-sectional area of the stream tube be $A_{\\infty}$ far upstream, $A$ at the disk, and $A_d$ far downstream. The corresponding axial velocities are $U_{\\infty}$, $U_{\\text{disk}}$, and $U_d$. The static pressures are $p_{\\infty}$, $p_{\\text{up}}$ (just upstream of the disk), $p_{\\text{down}}$ (just downstream of the disk), and $p_d$ far downstream.\n\nFirst, by the principle of conservation of mass for an incompressible fluid of density $\\rho$, the mass flow rate $\\dot{m}$ through the stream tube is constant. The mass flow rate passing through the turbine disk is:\n$$\n\\dot{m} = \\rho A U_{\\text{disk}}\n$$\nUsing the given definition for the axial induction factor, $a$, we have $U_{\\text{disk}} = U_{\\infty}(1-a)$. Substituting this into the mass flow rate expression gives:\n$$\n\\dot{m} = \\rho A U_{\\infty}(1-a)\n$$\n\nNext, we apply the conservation of linear momentum. The net force on the fluid within the control volume is equal to the rate of change of momentum of the fluid passing through it. The force exerted by the turbine on the fluid is directed upstream, which we denote as $-T$, where $T$ is the thrust on the turbine. According to the momentum theorem, the total force on the fluid in the stream tube is:\n$$\n\\sum F_{x} = \\dot{m} (U_{d} - U_{\\infty})\n$$\nThe force on the fluid is composed of pressure forces on the control volume surfaces and the force $-T$ from the disk. Assuming the pressure far upstream and far downstream is equal to the freestream static pressure, $p_{\\infty} = p_d$ as given, the net force on the fluid is simply $-T$. Thus,\n$$\n-T = \\dot{m} (U_{d} - U_{\\infty})\n$$\nThe thrust force on the turbine is therefore:\n$$\nT = \\dot{m} (U_{\\infty} - U_{d})\n$$\nSubstituting the expression for $\\dot{m}$:\n$$\nT = \\rho A U_{\\text{disk}} (U_{\\infty} - U_{d})\n$$\n\nNow, we apply Bernoulli's equation. It is assumed to be valid along streamlines upstream of the disk and downstream of the disk, but not across the disk itself, where energy is extracted.\nApplying Bernoulli's equation from far upstream to just before the disk:\n$$\np_{\\infty} + \\frac{1}{2}\\rho U_{\\infty}^2 = p_{\\text{up}} + \\frac{1}{2}\\rho U_{\\text{disk}}^2\n$$\nApplying it from just after the disk to far downstream, and using the given condition $p_d = p_{\\infty}$:\n$$\np_{\\text{down}} + \\frac{1}{2}\\rho U_{\\text{disk}}^2 = p_{d} + \\frac{1}{2}\\rho U_{d}^2 = p_{\\infty} + \\frac{1}{2}\\rho U_{d}^2\n$$\nBy rearranging these two equations, we can find expressions for $p_{\\text{up}}$ and $p_{\\text{down}}$:\n$$\np_{\\text{up}} = p_{\\infty} + \\frac{1}{2}\\rho (U_{\\infty}^2 - U_{\\text{disk}}^2)\n$$\n$$\np_{\\text{down}} = p_{\\infty} + \\frac{1}{2}\\rho (U_{d}^2 - U_{\\text{disk}}^2)\n$$\nThe thrust $T$ is also the result of the pressure difference across the disk, integrated over the disk area $A$:\n$$\nT = (p_{\\text{up}} - p_{\\text{down}}) A\n$$\nSubstituting the expressions for $p_{\\text{up}}$ and $p_{\\text{down}}$:\n$$\nT = \\left[ \\left(p_{\\infty} + \\frac{1}{2}\\rho (U_{\\infty}^2 - U_{\\text{disk}}^2)\\right) - \\left(p_{\\infty} + \\frac{1}{2}\\rho (U_{d}^2 - U_{\\text{disk}}^2)\\right) \\right] A\n$$\n$$\nT = \\frac{1}{2}\\rho A (U_{\\infty}^2 - U_{d}^2)\n$$\nWe now have two expressions for the thrust $T$. Equating them:\n$$\n\\rho A U_{\\text{disk}} (U_{\\infty} - U_{d}) = \\frac{1}{2}\\rho A (U_{\\infty}^2 - U_{d}^2)\n$$\nWe can cancel $\\rho A$ from both sides and factor the difference of squares:\n$$\nU_{\\text{disk}} (U_{\\infty} - U_{d}) = \\frac{1}{2} (U_{\\infty} - U_{d}) (U_{\\infty} + U_{d})\n$$\nFor a non-trivial case where $U_{\\infty} \\neq U_d$, we can cancel the term $(U_{\\infty} - U_{d})$, which yields a central result of actuator disk theory:\n$$\nU_{\\text{disk}} = \\frac{1}{2} (U_{\\infty} + U_{d})\n$$\nThis shows that the velocity through the disk is the average of the far upstream and far downstream velocities.\n\nTo derive $U_d$ in terms of $U_{\\infty}$ and $a$, we substitute the definition $U_{\\text{disk}} = U_{\\infty}(1-a)$:\n$$\nU_{\\infty}(1-a) = \\frac{1}{2} (U_{\\infty} + U_{d})\n$$\n$$\n2U_{\\infty}(1-a) = U_{\\infty} + U_{d}\n$$\n$$\nU_{d} = 2U_{\\infty} - 2aU_{\\infty} - U_{\\infty}\n$$\n$$\nU_{d} = U_{\\infty}(1-2a)\n$$\nThis is the required expression for the far-wake velocity. For this model to be physically meaningful (i.e., $U_d > 0$), $a$ must be less than $1/2$.\n\nNext, we derive the extracted mechanical power $P$. Power is the rate at which the turbine does work, which is the thrust force multiplied by the velocity of the fluid at the disk:\n$$\nP = T U_{\\text{disk}}\n$$\nUsing the momentum expression for thrust $T = \\dot{m}(U_{\\infty} - U_{d})$ and the relation $\\dot{m} = \\rho A U_{\\text{disk}}$:\n$$\nP = (\\rho A U_{\\text{disk}} (U_{\\infty} - U_{d})) U_{\\text{disk}} = \\rho A U_{\\text{disk}}^2 (U_{\\infty} - U_{d})\n$$\nNow we substitute the expressions for $U_{\\text{disk}}$ and $U_d$ in terms of $U_{\\infty}$ and $a$:\n$$\nU_{\\text{disk}} = U_{\\infty}(1-a)\n$$\n$$\nU_d = U_{\\infty}(1-2a)\n$$\n$$\nP = \\rho A (U_{\\infty}(1-a))^2 (U_{\\infty} - U_{\\infty}(1-2a))\n$$\n$$\nP = \\rho A U_{\\infty}^2 (1-a)^2 (U_{\\infty} - U_{\\infty} + 2aU_{\\infty})\n$$\n$$\nP = \\rho A U_{\\infty}^2 (1-a)^2 (2aU_{\\infty})\n$$\n$$\nP = 2\\rho A U_{\\infty}^3 a(1-a)^2\n$$\nThis is the required expression for the extracted power.\n\nThe power coefficient $C_p$ is defined as $C_{p} \\equiv \\dfrac{P}{\\tfrac{1}{2}\\rho A U_{\\infty}^{3}}$. Substituting our expression for $P$:\n$$\nC_p = \\frac{2\\rho A U_{\\infty}^3 a(1-a)^2}{\\frac{1}{2}\\rho A U_{\\infty}^3}\n$$\nCanceling common terms, we find the power coefficient solely in terms of $a$:\n$$\nC_p = 4a(1-a)^2\n$$\n\nFinally, we compute the numerical values for $U_d$ and $P$ using the provided data: $\\rho = 1.225\\,\\text{kg m}^{-3}$, $A = 1.0000 \\times 10^{4}\\,\\text{m}^{2}$, $U_{\\infty} = 10.0\\,\\text{m s}^{-1}$, and $a = \\dfrac{1}{3}$.\n\nThe far-wake velocity $U_d$ is:\n$$\nU_d = U_{\\infty}(1-2a) = 10.0 \\left(1 - 2 \\cdot \\frac{1}{3}\\right) = 10.0 \\left(1 - \\frac{2}{3}\\right) = 10.0 \\left(\\frac{1}{3}\\right) = \\frac{10.0}{3}\\,\\text{m s}^{-1}\n$$\n$$\nU_d \\approx 3.3333...\\,\\text{m s}^{-1}\n$$\nRounding to $4$ significant figures, $U_d = 3.333\\,\\text{m s}^{-1}$.\n\nThe extracted power $P$ is:\n$$\nP = 2\\rho A U_{\\infty}^3 a(1-a)^2 = 2(1.225)(1.0000 \\times 10^4)(10.0)^3 \\left(\\frac{1}{3}\\right) \\left(1-\\frac{1}{3}\\right)^2\n$$\n$$\nP = 2(1.225)(10^4)(10^3) \\left(\\frac{1}{3}\\right) \\left(\\frac{2}{3}\\right)^2 = 2.45 \\times 10^7 \\times \\frac{1}{3} \\times \\frac{4}{9}\n$$\n$$\nP = 2.45 \\times 10^7 \\times \\frac{4}{27} = \\frac{9.8}{27} \\times 10^7\\,\\text{W}\n$$\n$$\nP \\approx 0.36296296... \\times 10^7\\,\\text{W} = 3.6296296... \\times 10^6\\,\\text{W}\n$$\nSince $1\\,\\text{MW} = 10^6\\,\\text{W}$, the power in megawatts is $P \\approx 3.6296296...\\,\\text{MW}$.\nRounding to $4$ significant figures, $P = 3.630\\,\\text{MW}$.\n\nThe numerical results are $U_d = 3.333\\,\\text{m s}^{-1}$ and $P = 3.630\\,\\text{MW}$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3.333  3.630 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "While the actuator disk model establishes the existence of a wake, practical engineering requires predictive models for its evolution and impact on other turbines. This hands-on coding practice challenges you to implement the classic Jensen (or Park) wake model, which describes how a wake expands and its deficit decays with distance. You will translate theory into a functional algorithm, tackling the critical geometric problem of calculating the wake overlap area on a downstream rotor, a cornerstone of wind farm simulation. ",
            "id": "4136770",
            "problem": "You are to construct a complete and runnable program that models the wake overlap for two horizontal-axis wind turbines in tandem using the Park model (also known as the Jensen model) under a uniform deficit (top-hat) assumption. The goal is to determine the portion of the downstream rotor area impacted by the upstream wake and to compute the area-weighted rotor-average wind speed at the downstream turbine plane. You must build the algorithm from first principles grounded in mass and momentum conservation and elementary Euclidean geometry, without relying on any shortcut formulas given in this statement. The model must be implemented for a set of test cases with numerically specified parameters and produce a single line of output in the exact required format.\n\nFundamental base and assumptions:\n- Use conservation of mass and momentum as they apply to actuator disk theory to relate thrust to velocity deficit behind an upstream rotor and the established Park model scaling for wake expansion downstream based on turbulent entrainment. The Park model assumes a uniform velocity deficit within an expanding circular wake cross-section and no yaw misalignment.\n- The upstream wake expands linearly downstream; the cross-sectional wake region is circular with a centerline aligned with the upstream turbine axis. The downstream turbine center may be laterally offset relative to the wake centerline.\n- The downstream rotor is circular. The impacted region is the intersection area between the wake circle at the downstream position and the downstream rotor circle.\n- The rotor-average wind speed at the downstream turbine plane is obtained by an area-weighted mixture of the ambient undisturbed wind and the uniform wake deficit, with the deficit predicted by the Park model at the considered downstream position.\n\nRequired outputs for each test case:\n- The impacted area of the downstream rotor by the upstream wake, expressed in square meters (m²) as a float.\n- The rotor-average wind speed at the downstream turbine plane, expressed in meters per second (m/s) as a float.\n- Both outputs must be rounded to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list in the form $[A_{\\text{impacted}}, U_{\\text{avg}}]$ (e.g., $[[1.234000,7.890000],[...],...]$).\n\nDefinitions:\n- Let $D_u$ be the upstream rotor diameter in meters.\n- Let $D_d$ be the downstream rotor diameter in meters.\n- Let $R_u = D_u/2$ be the upstream rotor radius in meters.\n- Let $R_d = D_d/2$ be the downstream rotor radius in meters.\n- Let $U_\\infty$ be the ambient inflow wind speed in meters per second.\n- Let $C_T$ be the upstream turbine thrust coefficient (dimensionless).\n- Let $k_w$ be the wake expansion coefficient (dimensionless) governing the linear wake radius growth.\n- Let $x$ be the streamwise spacing between turbine centers in meters.\n- Let $y$ be the lateral offset between turbine centers in meters, measured perpendicular to the wind direction at the downstream plane.\n- Let $r_w(x)$ be the wake radius at downstream distance $x$ in meters according to the Park model.\n- Let $\\Delta$ be the streamwise velocity deficit ratio within the wake at distance $x$ according to the Park model.\n- Let $A_{\\cap}$ be the geometric intersection area between the wake circle of radius $r_w(x)$ and the downstream rotor circle of radius $R_d$ with center separation $d = y$.\n- Let $A_d = \\pi R_d^2$ be the downstream rotor area in square meters.\n- Let $A_{\\text{impacted}} = A_{\\cap}$ be the impacted portion of the downstream rotor area.\n- Let $U_{\\text{avg}}$ be the area-weighted average wind speed over the downstream rotor circle.\n\nAlgorithmic tasks you must implement:\n1. Compute the wake radius $r_w(x)$ from the Park model using the upstream rotor radius $R_u$, wake expansion coefficient $k_w$, and downstream distance $x$.\n2. Compute the uniform velocity deficit ratio $\\Delta$ within the wake at distance $x$ based on ambient wind speed $U_\\infty$, thrust coefficient $C_T$, wake expansion coefficient $k_w$, upstream rotor diameter $D_u$, and downstream distance $x$, as implied by the Park model under mass and momentum conservation.\n3. Compute the geometric intersection area $A_{\\cap}$ for two circles of radii $r_w(x)$ and $R_d$ whose centers are separated by distance $d = y$. Handle all geometric configurations, including no overlap ($A_{\\cap} = 0$), full coverage of the smaller circle, partial overlap, external tangency, and internal tangency, using exact Euclidean geometry.\n4. Compute $A_{\\text{impacted}} = A_{\\cap}$ in square meters and $U_{\\text{avg}}$ by area-weighted mixture of the ambient and wake velocities over the downstream rotor disc.\n5. Round each $A_{\\text{impacted}}$ and $U_{\\text{avg}}$ to six decimal places.\n\nTest suite:\nImplement your solution for the following four test cases, which together explore a typical configuration, full coverage, no overlap, and exact external tangency:\n- Case $1$: $D_u = 100\\,\\mathrm{m}$, $D_d = 100\\,\\mathrm{m}$, $x = 500\\,\\mathrm{m}$, $y = 20\\,\\mathrm{m}$, $k_w = 0.05$, $U_\\infty = 8\\,\\mathrm{m/s}$, $C_T = 0.8$.\n- Case $2$: $D_u = 100\\,\\mathrm{m}$, $D_d = 80\\,\\mathrm{m}$, $x = 600\\,\\mathrm{m}$, $y = 0\\,\\mathrm{m}$, $k_w = 0.1$, $U_\\infty = 10\\,\\mathrm{m/s}$, $C_T = 0.75$.\n- Case $3$: $D_u = 100\\,\\mathrm{m}$, $D_d = 100\\,\\mathrm{m}$, $x = 400\\,\\mathrm{m}$, $y = 200\\,\\mathrm{m}$, $k_w = 0.04$, $U_\\infty = 9\\,\\mathrm{m/s}$, $C_T = 0.9$.\n- Case $4$: $D_u = 120\\,\\mathrm{m}$, $D_d = 90\\,\\mathrm{m}$, $x = 300\\,\\mathrm{m}$, $y = 123\\,\\mathrm{m}$, $k_w = 0.06$, $U_\\infty = 7\\,\\mathrm{m/s}$, $C_T = 0.7$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of four two-element lists in the order of the test cases, each two-element list being $[A_{\\text{impacted}}, U_{\\text{avg}}]$ with both floats rounded to six decimals.\n- The exact format must be: $[[A_1,U_1],[A_2,U_2],[A_3,U_3],[A_4,U_4]]$, using decimal notation with no units and no additional text. For example, a valid output line looks like $[[1234.567890,7.654321],[\\ldots],[\\ldots],[\\ldots]]$.",
            "solution": "The problem is evaluated as valid. It is scientifically grounded in the established Park (Jensen) model for wind turbine wakes, which is a standard simplification based on conservation laws. The problem is well-posed, providing all necessary data and definitions for a unique solution. The language is objective and the tasks are specified without ambiguity.\n\nThe solution is developed by implementing the four algorithmic tasks specified in the problem statement, grounding each step in the requested first principles.\n\n**1. Wake Radius, $r_w(x)$**\n\nThe Park model assumes that the turbine wake expands linearly with the downstream distance $x$. The wake is modeled as a circular cross-section whose radius $r_w(x)$ grows from its initial value, the upstream rotor radius $R_u$, according to a wake expansion coefficient $k_w$.\n\nThe formula for the wake radius at a distance $x$ is:\n$$r_w(x) = R_u + k_w x$$\nwhere $R_u = D_u/2$ is the upstream rotor radius. This linear expansion is an empirical model for the turbulent entrainment of ambient air into the wake.\n\n**2. Velocity Deficit, $\\Delta(x)$**\n\nThe velocity deficit within the wake is derived from the conservation of momentum, linking the thrust exerted by the turbine to the momentum deficit in the downstream flow.\n\nFrom actuator disk theory, the thrust $T$ is given by $T = \\frac{1}{2}\\rho A_u C_T U_\\infty^2$, where $\\rho$ is the air density, $A_u = \\pi R_u^2$ is the rotor area, $C_T$ is the thrust coefficient, and $U_\\infty$ is the ambient wind speed.\n\nThe thrust is also the rate of momentum change imparted to the air. In one-dimensional momentum theory, the far-wake velocity $U_{w, \\text{far}}$ is related to the axial induction factor $a$ by $U_{w, \\text{far}} = U_\\infty(1-2a)$. The thrust coefficient is $C_T = 4a(1-a)$. Assuming the turbine operates in the windmill state ($a  1/2$), we can solve for $2a$:\n$$1-C_T = (1-2a)^2 \\implies \\sqrt{1-C_T} = 1-2a \\implies 2a = 1 - \\sqrt{1-C_T}$$\nThe velocity deficit in the far wake, relative to the ambient speed, is $\\Delta U_{\\text{far}} = U_\\infty - U_{w, \\text{far}} = 2aU_\\infty$. The initial deficit ratio is thus $2a$.\n\nThe Park model assumes this momentum deficit is conserved as the wake expands. The momentum flux deficit at a downstream distance $x$ is assumed to be proportional to the wake area $A_w(x) = \\pi r_w(x)^2$ and the local velocity deficit $U_\\infty - U_w(x)$. By conserving the momentum deficit:\n$$(U_\\infty - U_w(x)) A_w(x) \\propto (U_\\infty - U_{w, \\text{far}}) A_u$$\nThis leads to the velocity deficit at distance $x$, $\\Delta U(x) = U_\\infty - U_w(x)$, scaling with the initial deficit and the ratio of the areas:\n$$\\Delta U(x) = (2a U_\\infty) \\frac{A_u}{A_w(x)}$$\nDividing by $U_\\infty$ gives the dimensionless deficit ratio $\\Delta(x)$:\n$$\\Delta(x) = \\frac{U_\\infty - U_w(x)}{U_\\infty} = (2a) \\frac{\\pi R_u^2}{\\pi r_w(x)^2} = (1 - \\sqrt{1-C_T}) \\left(\\frac{R_u}{r_w(x)}\\right)^2$$\nSubstituting $r_w(x) = R_u + k_w x$:\n$$\\Delta(x) = \\frac{1 - \\sqrt{1-C_T}}{(1 + k_w x / R_u)^2}$$\nThe velocity inside the wake at distance $x$ is then $U_w(x) = U_\\infty(1 - \\Delta(x))$.\n\n**3. Intersection Area, $A_{\\cap}$**\n\nThe impacted area of the downstream rotor is the geometric intersection of two circles: the wake circle with radius $r_1 = r_w(x)$ and the downstream rotor circle with radius $r_2 = R_d = D_d/2$. The distance between their centers is $d=y$.\n\nThe calculation proceeds by considering three distinct geometric cases:\na. **No Overlap**: If the distance between the centers is greater than or equal to the sum of the radii, the circles do not intersect or are externally tangent.\n$$d \\ge r_1 + r_2 \\implies A_{\\cap} = 0$$\nb. **Full Containment**: If the distance between centers is less than or equal to the absolute difference of their radii, the smaller circle is entirely contained within the larger one (or they are internally tangent).\n$$d \\le |r_1 - r_2| \\implies A_{\\cap} = \\pi (\\min(r_1, r_2))^2$$\nc. **Partial Overlap**: If $|r_1 - r_2|  d  r_1 + r_2$, the circles partially intersect. The intersection area is the sum of the areas of the two circular segments formed by the common chord of the circles.\n\nThe area of a circular segment is the area of the circular sector minus the area of the triangle formed by the radii and the chord. For a circle of radius $r$ and a segment defined by a central angle $\\theta$ (in radians), the area is $A_{\\text{seg}} = \\frac{1}{2}r^2(\\theta - \\sin\\theta)$.\n\nThe central angles, $\\theta_1$ and $\\theta_2$, for the segments in each circle can be found using the Law of Cosines. Consider the triangle formed by the two centers and one of the intersection points. Its sides are $r_1$, $r_2$, and $d$. The half-angles at the centers are:\n$$\\alpha_1 = \\text{arccos}\\left(\\frac{d^2 + r_1^2 - r_2^2}{2 d r_1}\\right)$$\n$$\\alpha_2 = \\text{arccos}\\left(\\frac{d^2 + r_2^2 - r_1^2}{2 d r_2}\\right)$$\nThe full central angles are $\\theta_1 = 2\\alpha_1$ and $\\theta_2 = 2\\alpha_2$. The total intersection area is the sum of the two segment areas:\n$$A_{\\cap} = A_{\\text{seg},1} + A_{\\text{seg},2} = \\frac{1}{2}r_1^2(\\theta_1 - \\sin\\theta_1) + \\frac{1}{2}r_2^2(\\theta_2 - \\sin\\theta_2)$$\nThis formula robustly calculates the intersection area for the partial overlap case. The final impacted area is $A_{\\text{impacted}} = A_{\\cap}$.\n\n**4. Average Wind Speed, $U_{\\text{avg}}$**\n\nThe rotor-average wind speed $U_{\\text{avg}}$ at the downstream turbine is the area-weighted average of the wind speeds over its rotor disk area, $A_d = \\pi R_d^2$. The portion of the disk inside the wake, $A_{\\cap}$, experiences the wake velocity $U_w(x)$, while the portion outside the wake, $A_d - A_{\\cap}$, experiences the ambient velocity $U_\\infty$.\n\nThe weighted average is:\n$$U_{\\text{avg}} = \\frac{U_w(x) \\cdot A_{\\cap} + U_\\infty \\cdot (A_d - A_{\\cap})}{A_d}$$\nSubstituting $U_w(x) = U_\\infty(1 - \\Delta(x))$:\n$$U_{\\text{avg}} = \\frac{U_\\infty(1 - \\Delta(x)) A_{\\cap} + U_\\infty A_d - U_\\infty A_{\\cap}}{A_d}$$\n$$U_{\\text{avg}} = \\frac{U_\\infty A_d - U_\\infty \\Delta(x) A_{\\cap}}{A_d}$$\nSimplifying yields the final expression:\n$$U_{\\text{avg}} = U_\\infty \\left(1 - \\Delta(x) \\frac{A_{\\cap}}{A_d}\\right)$$\nThis formula is used to calculate the area-weighted average wind speed. In the case where the downstream rotor area $A_d$ is zero, the area-averaged velocity is not well-defined. However, since all test cases feature a physical rotor ($D_d > 0$), this degenerate case does not arise.\n\nThe algorithm constructed from these principles will now be implemented to solve the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Models the wake overlap for two wind turbines using the Park (Jensen) model.\n    Calculates the impacted downstream rotor area and the area-weighted average wind speed.\n    \"\"\"\n\n    def calculate_wake_effects(Du, Dd, x, y, kw, U_inf, CT):\n        \"\"\"\n        Computes wake effects for a single turbine pair configuration.\n\n        Args:\n            Du (float): Upstream rotor diameter (m).\n            Dd (float): Downstream rotor diameter (m).\n            x (float): Streamwise spacing between turbines (m).\n            y (float): Lateral offset between turbine centers (m).\n            kw (float): Wake expansion coefficient.\n            U_inf (float): Ambient inflow wind speed (m/s).\n            CT (float): Upstream turbine thrust coefficient.\n\n        Returns:\n            list: A list containing [A_impacted, U_avg], rounded to 6 decimal places.\n        \"\"\"\n\n        # Step 1: Compute radii and wake radius\n        Ru = Du / 2.0\n        Rd = Dd / 2.0\n        \n        # The wake does not exist at or before the turbine\n        if x = 0:\n            A_impacted = 0.0\n            U_avg = U_inf\n            return [round(A_impacted, 6), round(U_avg, 6)]\n\n        r_w = kw * x + Ru\n\n        # Step 2: Compute velocity deficit ratio\n        # The term (1 + kw * x / Ru) is equivalent to r_w / Ru.\n        # Check for Ru  0 to avoid division by zero.\n        if Ru  0:\n            deficit_ratio_factor = (r_w / Ru)**2\n            deficit_ratio = (1 - np.sqrt(1 - CT)) / deficit_ratio_factor\n        else: # If upstream turbine has no size, it creates no wake.\n            deficit_ratio = 0.0\n\n        # Step 3: Compute geometric intersection area (A_impacted)\n        A_impacted = calculate_intersection_area(r_w, Rd, y)\n\n        # Step 4: Compute area-weighted average wind speed\n        A_d = np.pi * Rd**2\n        \n        if A_d  0:\n            U_avg = U_inf * (1 - deficit_ratio * (A_impacted / A_d))\n        else:\n            # For a zero-area downstream rotor, the concept of area-average is\n            # ill-defined. We can find the point velocity at its center.\n            if abs(y)  r_w: # Point is inside the wake\n                U_avg = U_inf * (1 - deficit_ratio)\n            else: # Point is outside the wake\n                U_avg = U_inf\n\n        return [round(A_impacted, 6), round(U_avg, 6)]\n\n    def calculate_intersection_area(r1, r2, d):\n        \"\"\"\n        Calculates the intersection area of two circles.\n\n        Args:\n            r1 (float): Radius of the first circle.\n            r2 (float): Radius of the second circle.\n            d (float): Distance between the centers of the circles.\n\n        Returns:\n            float: The intersection area.\n        \"\"\"\n        d = abs(float(d))\n        r1, r2 = float(r1), float(r2)\n\n        if r1 = 0 or r2 = 0:\n            return 0.0\n\n        # Case 1: No overlap or external tangency\n        if d = r1 + r2:\n            return 0.0\n\n        # Case 2: Full containment or internal tangency\n        if d = abs(r1 - r2):\n            return np.pi * min(r1, r2)**2\n\n        # Case 3: Partial overlap\n        r1_sq, r2_sq, d_sq = r1**2, r2**2, d**2\n\n        # Arguments for arccos based on law of cosines\n        # Clip to handle potential floating point inaccuracies near +/-1\n        cos_alpha1_arg = np.clip((d_sq + r1_sq - r2_sq) / (2 * d * r1), -1.0, 1.0)\n        cos_alpha2_arg = np.clip((d_sq + r2_sq - r1_sq) / (2 * d * r2), -1.0, 1.0)\n        \n        # Central angles for the segments\n        theta1 = 2 * np.arccos(cos_alpha1_arg)\n        theta2 = 2 * np.arccos(cos_alpha2_arg)\n\n        # Area of circular segments\n        area_seg1 = 0.5 * r1_sq * (theta1 - np.sin(theta1))\n        area_seg2 = 0.5 * r2_sq * (theta2 - np.sin(theta2))\n        \n        return area_seg1 + area_seg2\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Typical configuration with partial overlap (actually full coverage)\n        (100.0, 100.0, 500.0, 20.0, 0.05, 8.0, 0.8),\n        # Case 2: Full coverage (concentric)\n        (100.0, 80.0, 600.0, 0.0, 0.1, 10.0, 0.75),\n        # Case 3: No overlap\n        (100.0, 100.0, 400.0, 200.0, 0.04, 9.0, 0.9),\n        # Case 4: Exact external tangency\n        (120.0, 90.0, 300.0, 123.0, 0.06, 7.0, 0.7),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_wake_effects(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Convert each inner list to its string representation and join with commas.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This capstone practice elevates our analysis from single interactions to the performance of an entire wind farm. You will synthesize the concepts of wake modeling and power generation into a comprehensive calculation of Annual Energy Production (AEP), considering a statistical distribution of wind speeds. By numerically computing the gradient of the AEP with respect to turbine locations, this exercise introduces a powerful technique used in computational design to optimize wind farm layouts for maximum energy yield. ",
            "id": "4136783",
            "problem": "You are tasked with implementing a complete, runnable program that performs a layout sensitivity analysis for a wind farm by differentiating Annual Energy Production (AEP) with respect to turbine positions and identifying gradients that indicate beneficial relocations. The analysis must be grounded in first principles of wind energy conversion and canonical wake modeling. The physical model assumptions are as follows: the wind farm consists of identical horizontal-axis wind turbines, the inflow wind states are within the regime where the cubic power law is applicable, and wake interactions are represented by a top-hat deficit with geometric overlap, combined by a root-sum-square superposition. The wind direction is fixed, and angles must be treated in radians.\n\nYour program must implement the following scientifically realistic and self-consistent components:\n- A physical power extraction model based on kinetic energy flux through the rotor with a constant power coefficient. The instantaneous turbine power for effective inflow speed is given by a cubic law derived from actuator disc principles, with air density and rotor area explicitly used.\n- A wake model for velocity deficit produced by an upstream turbine that expands linearly with downwind distance. The wake deficit reaching a downstream turbine must account for the overlap between the expanding wake disc and the downstream rotor disc using exact circle-circle intersection area geometry. Multiple wakes at a single turbine must be combined via the square root of the sum of squared deficits to maintain conservation-consistent aggregation.\n- A discrete wind rose with wind speed states and associated probabilities. Annual Energy Production (AEP) must be computed by aggregating power over wind states and multiplying by total hours in a year, and must be expressed in megawatt-hours per year. The gradient of AEP with respect to turbine positions must then be estimated using a numerically stable method.\n\nYou must not assume or use any saturated power regime (rated power) or cut-in/cut-out speed regimes; instead, confine wind speed states to values where the cubic law is valid. All computations must be in International System of Units, and angles must be in radians. The gradient components must be returned in units of megawatt-hours per meter per year.\n\nConstants to use in your model:\n- Air density $ \\rho = 1.225\\,\\mathrm{kg/m^3} $.\n- Rotor radius $ R = 63\\,\\mathrm{m} $, rotor diameter $ D = 2R $.\n- Power coefficient $ C_p = 0.45 $.\n- Thrust coefficient $ C_T = 0.8 $.\n- Wake decay constant $ k = 0.05 $.\n- Annual hours $ H = 8760\\,\\mathrm{h} $.\n- Wind direction $ \\theta = 0 $ radians (wind coming from negative $ x $ and blowing toward positive $ x $).\n- Wind speed states and probabilities: two states with speeds $ V_1 = 8\\,\\mathrm{m/s} $ and $ V_2 = 12\\,\\mathrm{m/s} $, with probabilities $ p_1 = 0.6 $ and $ p_2 = 0.4 $, respectively.\n\nModeling requirements:\n- For each turbine $ j $, compute the effective inflow speed $ V_{\\mathrm{eff},j} $ considering all upstream turbines $ i $ for which the downwind projected separation $ \\Delta x_{ij} $ is positive along the wind direction $ \\theta $. The wake radius grows as a linear function of $ \\Delta x_{ij} $, and the centerline deficit reduces with increasing $ \\Delta x_{ij} $. The geometric overlap fraction between the wake cross-section and the downstream rotor disc must be computed using exact circle-circle intersection area.\n- The total velocity deficit at turbine $ j $ from multiple upstream turbines must be the square root of the sum of squared individual deficits multiplied by their overlap fractions. The effective inflow speed at $ j $ is then the free-stream wind speed multiplied by one minus the combined deficit.\n- The instantaneous power $ P_j $ for each wind state must be computed using the cubic power relationship with $ C_p $ and rotor area $ A = \\pi R^2 $. The AEP is the sum over wind states of probability-weighted power across all turbines times $ H $, converted to megawatt-hours by dividing by $ 10^6 $.\n- The gradient of AEP with respect to each turbine position component must be computed using central finite differences with a small displacement step $ h $ in meters, applied independently to $ x $ and $ y $ coordinates. Use $ h = 0.1\\,\\mathrm{m} $.\n\nTest suite:\nImplement your program to evaluate the following $ 4 $ test cases, each with $ 3 $ turbines, all coordinates in meters:\n- Case $ 1 $ (aligned, moderate spacing): turbine positions $ [(0,0),(378,0),(756,0)] $.\n- Case $ 2 $ (widely spaced, oblique): turbine positions $ [(0,0),(1000,400),(2000,-400)] $.\n- Case $ 3 $ (diagonal alignment): turbine positions $ [(0,0),(378,100),(756,200)] $.\n- Case $ 4 $ (close spacing, stronger wake): turbine positions $ [(0,0),(200,0),(400,0)] $.\n\nYour program must produce, for each case, the gradient of AEP with respect to all turbine positions as a flattened list in the order $ [\\partial \\mathrm{AEP}/\\partial x_1,\\partial \\mathrm{AEP}/\\partial y_1,\\partial \\mathrm{AEP}/\\partial x_2,\\partial \\mathrm{AEP}/\\partial y_2,\\partial \\mathrm{AEP}/\\partial x_3,\\partial \\mathrm{AEP}/\\partial y_3] $, with each component in units of megawatt-hours per meter per year. The final program output must be a single line containing a comma-separated list of the $ 4 $ flattened gradient lists, enclosed in square brackets. For example, your output must resemble $ [[g_{1,1},g_{1,2},\\dots],[g_{2,1},g_{2,2},\\dots],[g_{3,1},g_{3,2},\\dots],[g_{4,1},g_{4,2},\\dots]] $ where each $ g_{i,j} $ is a float.\n\nAngles must be in radians. Energy must be expressed in megawatt-hours per year, and gradient components must be expressed in megawatt-hours per meter per year. Your program must be self-contained and must not require any external input.",
            "solution": "The objective is to compute the sensitivity of the Annual Energy Production (AEP) of a small wind farm to the spatial coordinates of its turbines. This is accomplished by calculating the gradient of the AEP with respect to each turbine's position, $\\nabla \\mathrm{AEP}$. The analysis is founded upon established physical principles of wind energy conversion and simplified wake modeling, as specified.\n\nFirst, we define the physical constants and parameters provided for the model:\n- Air density: $\\rho = 1.225\\,\\mathrm{kg/m^3}$\n- Rotor radius: $R = 63\\,\\mathrm{m}$\n- Rotor diameter: $D = 2R = 126\\,\\mathrm{m}$\n- Rotor area: $A = \\pi R^2$\n- Power coefficient: $C_p = 0.45$\n- Thrust coefficient: $C_T = 0.8$\n- Wake decay constant: $k = 0.05$\n- Annual hours: $H = 8760\\,\\mathrm{h}$\n- Wind direction: $\\theta = 0\\,\\mathrm{rad}$ (from negative $x$ towards positive $x$)\n- Wind states: $(V_1, p_1) = (8\\,\\mathrm{m/s}, 0.6)$ and $(V_2, p_2) = (12\\,\\mathrm{m/s}, 0.4)$\n- Finite difference step: $h = 0.1\\,\\mathrm{m}$\n\nThe solution is developed by first formulating the AEP as a function of turbine positions and then differentiating this function numerically.\n\n**1. Physical Model Formulation**\n\n**1.1. Power Extraction**\nThe power extracted by a single wind turbine $j$ from an effective inflow wind speed $V_{\\mathrm{eff},j}$ is based on the kinetic energy flux through the rotor disc. According to actuator disc theory, the instantaneous power $P_j$ is given by:\n$$\nP_j = \\frac{1}{2} \\rho A C_p V_{\\mathrm{eff},j}^3\n$$\nwhere $V_{\\mathrm{eff},j}$ is the wind speed experienced by the rotor, which may be reduced from the free-stream speed $V_0$ due to wake effects from upstream turbines. For a turbine unaffected by wakes, $V_{\\mathrm{eff},j} = V_0$.\n\n**1.2. Wake Interaction Model**\nThe interaction between turbines is modeled by considering the velocity deficit in the wake of each turbine and its effect on downstream turbines. We establish a Cartesian coordinate system where the wind blows along the positive $x$-axis. A turbine $i$ at position $(x_i, y_i)$ is considered upstream of a turbine $j$ at $(x_j, y_j)$ if their downwind separation is positive, i.e., $\\Delta x_{ij} = x_j - x_i  0$.\n\n- **Wake Expansion**: Following the Jensen model, the wake generated by turbine $i$ expands linearly with downwind distance $\\Delta x_{ij}$. The radius of the wake's cross-section at the location of turbine $j$ is given by:\n$$\nR_{w,ij} = R + k \\Delta x_{ij}\n$$\n\n- **Velocity Deficit**: The problem specifies a \"top-hat\" velocity deficit profile that reduces with distance. While the exact formula is not provided, the context strongly implies the standard deficit formulation associated with the Jensen momentum-conserving model. We therefore adopt this scientifically-grounded interpretation:\n$$\nd_i(\\Delta x_{ij}) = \\frac{1 - \\sqrt{1 - C_T}}{\\left(1 + \\frac{k \\Delta x_{ij}}{R}\\right)^2}\n$$\nThis represents the fractional velocity reduction at the centerline of the wake from turbine $i$ at a distance $\\Delta x_{ij}$.\n\n- **Wake-Rotor Overlap**: When a downstream turbine $j$ is partially or fully submerged in the wake of an upstream turbine $i$, only the portion of its rotor disc within the wake is affected. The lateral separation between the wake centerline (originating from $y_i$) and the downstream rotor center $y_j$ is $d_{centers} = |y_j - y_i|$. The wake is a circle of radius $R_{w,ij}$ and the rotor is a circle of radius $R$. The area of their geometric intersection, $A_{\\mathrm{overlap}, ij}$, must be computed. The effective impact on the entire rotor is scaled by the overlap fraction:\n$$\nf_{ij} = \\frac{A_{\\mathrm{overlap}, ij}}{\\pi R^2}\n$$\nThe calculation of $A_{\\mathrm{overlap}, ij}$ is performed using the exact formula for the intersection area of two circles.\n\n- **Wake Superposition**: A turbine may be affected by wakes from multiple upstream turbines. The problem specifies a root-sum-square (RSS) superposition. The phrasing \"sum of squared individual deficits multiplied by their overlap fractions\" is interpreted as follows: the rotor-averaged velocity deficit induced at turbine $j$ by upstream turbine $i$ is $d_i \\cdot f_{ij}$. These rotor-averaged deficits are then combined using RSS. This is a common and physically plausible method for wake superposition. The total deficit $D_j$ at turbine $j$ is thus:\n$$\nD_j = \\sqrt{\\sum_{i \\in U(j)} (d_i(\\Delta x_{ij}) \\cdot f_{ij})^2}\n$$\nwhere $U(j)$ is the set of all turbines upstream of $j$.\n\n- **Effective Wind Speed**: The final effective wind speed incident on the rotor of turbine $j$ for a free-stream wind speed $V_0$ is:\n$$\nV_{\\mathrm{eff}, j} = V_0 (1 - D_j)\n$$\nNote that the total deficit $D_j$ depends only on the turbine layout geometry and the constants $C_T$ and $k$, not on the free-stream wind speed $V_0$.\n\n**1.3. Annual Energy Production (AEP)**\nThe AEP is the sum of energy produced over all wind states, weighted by their probabilities, and extrapolated over a full year. For a set of $N_s$ wind states $(V_k, p_k)$ and $N_t$ turbines, the AEP in megawatt-hours (MWh) is:\n$$\n\\mathrm{AEP} = \\frac{H}{10^6} \\sum_{k=1}^{N_s} p_k \\left( \\sum_{j=1}^{N_t} P_j(V_k) \\right)\n$$\nSubstituting the expressions for power and effective velocity yields the complete AEP function:\n$$\n\\mathrm{AEP}(\\mathbf{P}) = \\frac{H \\cdot \\frac{1}{2} \\rho A C_p}{10^6} \\sum_{k=1}^{N_s} p_k V_k^3 \\sum_{j=1}^{N_t} \\left(1 - D_j(\\mathbf{P})\\right)^3\n$$\nwhere $\\mathbf{P}$ represents the vector of all turbine coordinates, upon which the deficits $D_j$ depend.\n\n**2. Numerical Gradient Computation**\nThe gradient of the AEP with respect to the turbine coordinate vector $\\mathbf{P} = (x_1, y_1, \\dots, x_{N_t}, y_{N_t})$ indicates the direction of steepest ascent for AEP in the layout design space. We estimate this gradient using the central finite difference method, which provides second-order accuracy and numerical stability. For a generic coordinate $z_m$ (which can be $x_m$ or $y_m$ for turbine $m$), the partial derivative is approximated as:\n$$\n\\frac{\\partial \\mathrm{AEP}}{\\partial z_m} \\approx \\frac{\\mathrm{AEP}(\\mathbf{P} + h \\mathbf{\\hat{e}}_{z_m}) - \\mathrm{AEP}(\\mathbf{P} - h \\mathbf{\\hat{e}}_{z_m})}{2h}\n$$\nwhere $h$ is a small displacement and $\\mathbf{\\hat{e}}_{z_m}$ is the unit vector in the direction of the $z_m$ coordinate. This procedure is applied systematically to each $x$ and $y$ coordinate of every turbine to construct the full gradient vector.\n\n**3. Algorithmic Design**\nThe implementation consists of two primary functions.\nFirst, a function `calculate_aep(positions)` is created. This function takes an array of turbine coordinates as input and returns the total AEP. It iterates through each turbine, determines its upstream influencers, calculates the individual wake radii and deficits, computes the geometric overlap fractions, combines the deficits using the RSS method, determines the effective wind speed for each wind state, computes the corresponding power, and finally aggregates these to produce the total AEP. The calculation of the circle-circle intersection area is encapsulated in a dedicated helper function that handles cases of no overlap, full containment, and partial overlap robustly.\n\nSecond, a main function `solve()` orchestrates the gradient calculation. It iterates through the provided test cases. For each case, it computes the gradient vector component by component. For each coordinate of each turbine, it calls `calculate_aep` twice with infinitesimally perturbed coordinates ($+\\,h$ and $-\\,h$) and applies the central difference formula. The resulting gradient components are collected into a flattened list for each test case. The final output is a list of these gradient lists.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the gradient of AEP with respect to turbine positions for a wind farm.\n\n    The solution implements a physics-based model for wind farm AEP calculation\n    and uses central finite differences to estimate the gradient.\n    \"\"\"\n\n    # Constants\n    RHO = 1.225  # Air density (kg/m^3)\n    R = 63.0     # Rotor radius (m)\n    D = 2 * R    # Rotor diameter (m)\n    A = np.pi * R**2 # Rotor area (m^2)\n    CP = 0.45    # Power coefficient\n    CT = 0.8     # Thrust coefficient\n    K = 0.05     # Wake decay constant\n    H = 8760.0   # Annual hours (h)\n    FD_H = 0.1   # Finite difference step (m)\n\n    # Wind rose: list of (speed, probability) tuples\n    WIND_ROSE = [\n        (8.0, 0.6),  # (m/s, probability)\n        (12.0, 0.4)\n    ]\n\n    def circle_intersection_area(r1, r2, d):\n        \"\"\"Calculates the intersection area of two circles.\"\"\"\n        if d = r1 + r2:\n            return 0.0\n        \n        if d = abs(r1 - r2):\n            return np.pi * min(r1, r2)**2\n\n        # Partial overlap case\n        # To avoid domain errors with arccos from floating point inaccuracies\n        arg1 = np.clip((d**2 + r1**2 - r2**2) / (2 * d * r1), -1.0, 1.0)\n        arg2 = np.clip((d**2 + r2**2 - r1**2) / (2 * d * r2), -1.0, 1.0)\n\n        term1 = r1**2 * np.arccos(arg1)\n        term2 = r2**2 * np.arccos(arg2)\n        \n        # Heron's formula for triangle area from side lengths (d, r1, r2)\n        # multiplied by 2. This is sqrt part of the std formula.\n        term3_arg = (-d + r1 + r2) * (d + r1 - r2) * (d - r1 + r2) * (d + r1 + r2)\n        term3 = 0.5 * np.sqrt(max(0, term3_arg)) # max(0,...) for stability\n        \n        return term1 + term2 - term3\n    \n    def calculate_aep(positions):\n        \"\"\"\n        Calculates the Annual Energy Production (AEP) for a given wind farm layout.\n        \n        Args:\n            positions (np.ndarray): A (N_turbines, 2) array of turbine (x, y) coordinates.\n            \n        Returns:\n            float: AEP in MWh/year.\n        \"\"\"\n        n_turbines = positions.shape[0]\n        total_expected_power = 0.0\n\n        for v_inf, prob in WIND_ROSE:\n            farm_power_for_state = 0.0\n            \n            # Pre-calculate deficits (independent of wind speed)\n            deficits = np.zeros(n_turbines)\n            for j in range(n_turbines):\n                sum_sq_deficits = 0.0\n                xj, yj = positions[j]\n\n                for i in range(n_turbines):\n                    if i == j:\n                        continue\n                    \n                    xi, yi = positions[i]\n                    dx = xj - xi\n                    \n                    if dx  0: # Turbine i is upstream of turbine j\n                        dy = yj - yi\n                        \n                        # Jensen model wake radius\n                        wake_radius = R + K * dx\n                        \n                        # Jensen model centerline deficit\n                        centerline_deficit = (1 - np.sqrt(1 - CT)) / (1 + K * dx / R)**2\n                        \n                        # Overlap area and fraction\n                        dist_centers = np.abs(dy)\n                        overlap_area = circle_intersection_area(wake_radius, R, dist_centers)\n                        overlap_fraction = overlap_area / A\n                        \n                        # Rotor-averaged deficit contribution from wake i\n                        # This interpretation of the RSS rule is most consistent\n                        rotor_avg_deficit = centerline_deficit * overlap_fraction\n                        sum_sq_deficits += rotor_avg_deficit**2\n                \n                deficits[j] = np.sqrt(sum_sq_deficits)\n            \n            # Calculate power for each turbine for the current wind state\n            for j in range(n_turbines):\n                v_eff = v_inf * (1 - deficits[j])\n                power = 0.5 * RHO * A * CP * v_eff**3\n                farm_power_for_state += power\n\n            total_expected_power += prob * farm_power_for_state\n        \n        aep = (total_expected_power * H) / 1e6 # Convert from W-h to MWh\n        return aep\n\n    test_cases = [\n        np.array([[0,0],[378,0],[756,0]], dtype=float),\n        np.array([[0,0],[1000,400],[2000,-400]], dtype=float),\n        np.array([[0,0],[378,100],[756,200]], dtype=float),\n        np.array([[0,0],[200,0],[400,0]], dtype=float),\n    ]\n\n    all_gradients = []\n    \n    for case_positions in test_cases:\n        n_turbines = case_positions.shape[0]\n        gradient_vector = []\n        \n        for i in range(n_turbines):\n            # Gradient wrt x_i\n            pos_plus = case_positions.copy()\n            pos_plus[i, 0] += FD_H\n            aep_plus = calculate_aep(pos_plus)\n            \n            pos_minus = case_positions.copy()\n            pos_minus[i, 0] -= FD_H\n            aep_minus = calculate_aep(pos_minus)\n            \n            grad_x = (aep_plus - aep_minus) / (2 * FD_H)\n            gradient_vector.append(grad_x)\n            \n            # Gradient wrt y_i\n            pos_plus = case_positions.copy()\n            pos_plus[i, 1] += FD_H\n            aep_plus = calculate_aep(pos_plus)\n            \n            pos_minus = case_positions.copy()\n            pos_minus[i, 1] -= FD_H\n            aep_minus = calculate_aep(pos_minus)\n            \n            grad_y = (aep_plus - aep_minus) / (2 * FD_H)\n            gradient_vector.append(grad_y)\n            \n        all_gradients.append(gradient_vector)\n    \n    # Format the output exactly as specified\n    formatted_output = \"[\" + \",\".join([f\"[{','.join(map(str, grad))}]\" for grad in all_gradients]) + \"]\"\n    print(formatted_output)\n\nsolve()\n```"
        }
    ]
}