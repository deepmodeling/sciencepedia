{
    "hands_on_practices": [
        {
            "introduction": "We begin with the most fundamental source of inefficiency in a battery: its internal resistance. This exercise uses a simplified series-resistance model to demonstrate how round-trip energy efficiency is directly impacted by the magnitude of the charging and discharging current. By calculating the efficiency at two different C-rates, you will gain a first-principles understanding of why operating batteries at higher power levels leads to greater energy losses .",
            "id": "4077752",
            "problem": "A single lithium-ion cell is modeled by a series internal resistance and a state-dependent open-circuit voltage. Consider a cell with nominal capacity $C_{\\text{nom}} = 50\\,\\text{Ah}$, series internal resistance $R = 4\\,\\text{m}\\Omega$, and an open-circuit voltage that is approximately constant over the cycle, $U(\\text{SOC}) \\approx 3.7\\,\\text{V}$. Assume negligible kinetic and concentration overpotentials, unity coulombic efficiency, and that the series internal resistance model is valid over the entire operating range. Perform a symmetric full cycle consisting of constant-current charge from $\\text{SOC} = 0$ to $\\text{SOC} = 1$ and constant-current discharge back to $\\text{SOC} = 0$, once at $0.5\\,\\text{C}$ and once at $2\\,\\text{C}$, where a $n\\,\\text{C}$ rate means a constant current $I = n\\,C_{\\text{nom}}$ in amperes.\n\nUsing first principles of electrical energy and the series-resistance model, compute the round-trip energy efficiency $\\eta$, defined as the ratio of the total energy delivered to the external circuit during discharge to the total energy supplied from the external source during charge, for both $0.5\\,\\text{C}$ and $2\\,\\text{C}$. Express both efficiencies as unitless decimals, and round your answers to four significant figures. Provide your final result as a two-component row vector $\\left[\\eta_{0.5\\,\\text{C}},\\ \\eta_{2\\,\\text{C}}\\right]$.",
            "solution": "The round-trip energy efficiency, $\\eta$, is defined as the ratio of the total energy delivered to the external circuit during discharge, $E_{\\text{dis}}$, to the total energy supplied from the external source during charge, $E_{\\text{ch}}$.\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}}\n$$\nThe problem models a lithium-ion cell as an ideal voltage source with a constant open-circuit voltage, $U$, in series with a constant internal resistance, $R$. The terminal voltage of the cell, $V_{t}$, is therefore a function of the current, $I$. By convention, a positive current, $I  0$, corresponds to discharge, and a negative current, $I  0$, corresponds to charge. However, for this problem involving symmetric constant-current cycles, it is more convenient to work with the magnitude of the current, which we denote as $I$, and explicitly account for the voltage effects.\n\nDuring charging, the external power source must overcome both the cell's open-circuit voltage $U$ and the resistive loss. The terminal voltage is:\n$$\nV_{t, \\text{ch}} = U + IR\n$$\nDuring discharging, the internal resistance causes a voltage drop, so the voltage delivered to the external load is:\n$$\nV_{t, \\text{dis}} = U - IR\n$$\nThe problem specifies a constant-current cycle. The energy transferred during a process is the integral of power over time, $E = \\int P(t) dt$. Since the current $I$, resistance $R$, and open-circuit voltage $U$ are all constant, the power is constant throughout each phase (charge and discharge). Thus, the energy is simply the product of power and time duration.\n\nEnergy supplied during charge, $E_{\\text{ch}}$, is:\n$$\nE_{\\text{ch}} = P_{\\text{ch}} \\cdot \\Delta t_{\\text{ch}} = (V_{t, \\text{ch}} \\cdot I) \\cdot \\Delta t_{\\text{ch}} = (U + IR) I \\Delta t_{\\text{ch}}\n$$\nEnergy delivered during discharge, $E_{\\text{dis}}$, is:\n$$\nE_{\\text{dis}} = P_{\\text{dis}} \\cdot \\Delta t_{\\text{dis}} = (V_{t, \\text{dis}} \\cdot I) \\cdot \\Delta t_{\\text{dis}} = (U - IR) I \\Delta t_{\\text{dis}}\n$$\nThe problem states the cycle is from $\\text{SOC}=0$ to $\\text{SOC}=1$ and back to $\\text{SOC}=0$. The total charge transferred in each phase is equal to the nominal capacity, $C_{\\text{nom}}$. For a constant current $I$, the duration of the process $\\Delta t$ is given by $\\Delta t = C_{\\text{nom}} / I$. The problem specifies unity coulombic efficiency and a symmetric cycle, which implies that the magnitude of the current $I$ and the duration $\\Delta t$ are the same for both charging and discharging. Therefore, the total charge transferred, $I \\Delta t$, is equal to $C_{\\text{nom}}$ for both processes.\n$$\nI \\Delta t_{\\text{ch}} = C_{\\text{nom}}\n$$\n$$\nI \\Delta t_{\\text{dis}} = C_{\\text{nom}}\n$$\nSubstituting this into the energy expressions:\n$$\nE_{\\text{ch}} = (U + IR) C_{\\text{nom}}\n$$\n$$\nE_{\\text{dis}} = (U - IR) C_{\\text{nom}}\n$$\nThe efficiency $\\eta$ can now be expressed as:\n$$\n\\eta = \\frac{E_{\\text{dis}}}{E_{\\text{ch}}} = \\frac{(U - IR) C_{\\text{nom}}}{(U + IR) C_{\\text{nom}}} = \\frac{U - IR}{U + IR}\n$$\nThis general expression shows that the efficiency depends on the open-circuit voltage, internal resistance, and the magnitude of the current.\n\nThe problem specifies two cases based on the C-rate, $n$. A rate of $n\\,\\text{C}$ corresponds to a current $I = n \\cdot Q_{\\text{nom}}$, where $Q_{\\text{nom}}$ is the numerical value of the nominal capacity in Ampere-hours.\nGiven values:\n$U = 3.7\\,\\text{V}$\n$R = 4\\,\\text{m}\\Omega = 0.004\\,\\Omega$\n$C_{\\text{nom}} = 50\\,\\text{Ah}$, so $Q_{\\text{nom}} = 50$.\n\nCase 1: $0.5\\,\\text{C}$ rate.\nThe current is $I_{0.5\\,\\text{C}} = 0.5 \\times 50\\,\\text{A} = 25\\,\\text{A}$.\nThe voltage drop (or rise) across the resistor is $I_{0.5\\,\\text{C}}R = 25\\,\\text{A} \\times 0.004\\,\\Omega = 0.1\\,\\text{V}$.\nThe efficiency is:\n$$\n\\eta_{0.5\\,\\text{C}} = \\frac{3.7 - 0.1}{3.7 + 0.1} = \\frac{3.6}{3.8} \\approx 0.947368...\n$$\nRounding to four significant figures, $\\eta_{0.5\\,\\text{C}} = 0.9474$.\n\nCase 2: $2\\,\\text{C}$ rate.\nThe current is $I_{2\\,\\text{C}} = 2 \\times 50\\,\\text{A} = 100\\,\\text{A}$.\nThe voltage drop (or rise) across the resistor is $I_{2\\,\\text{C}}R = 100\\,\\text{A} \\times 0.004\\,\\Omega = 0.4\\,\\text{V}$.\nThe efficiency is:\n$$\n\\eta_{2\\,\\text{C}} = \\frac{3.7 - 0.4}{3.7 + 0.4} = \\frac{3.3}{4.1} \\approx 0.804878...\n$$\nRounding to four significant figures, $\\eta_{2\\,\\text{C}} = 0.8049$.\n\nThe final result is the two-component row vector $[\\eta_{0.5\\,\\text{C}}, \\eta_{2\\,\\text{C}}]$.",
            "answer": "$$\n\\boxed{\n\\begin{bmatrix}\n0.9474  0.8049\n\\end{bmatrix}\n}\n$$"
        },
        {
            "introduction": "Real-world battery operation rarely involves constant current, instead following dynamic load profiles. This practice explores the consequences of using simplified efficiency models for systems under such variable schedules, a common scenario in grid services or electric vehicle operation . You will compare energy accounting from a simple constant efficiency assumption against a more realistic current-dependent model, quantifying the resulting error and highlighting the importance of model fidelity.",
            "id": "4077721",
            "problem": "A battery energy storage system is operated under a three-segment constant-current schedule with currents $I \\in \\{20, 40, 60\\}\\ \\text{A}$ applied over equal durations $\\Delta t$ per segment. The battery has approximately constant terminal voltage $V$ during the schedule. The system operator accounts energy using the round-trip efficiency (RTE), defined as $\\eta_{\\text{rt}} \\equiv E_{\\text{out}}/E_{\\text{in}}$, where $E_{\\text{in}}$ is the electrical energy supplied to the battery during charging and $E_{\\text{out}}$ is the electrical energy delivered from the battery during discharging for the corresponding processed energy. The true RTE depends on the magnitude of the segment current according to the model $\\eta_{\\text{rt}}(I) = 0.95 - 0.001 I$, while a simplified accounting uses a constant $\\eta_{\\text{rt}} = 0.9$ across all segments.\n\nStarting from energy conservation and the definition of round-trip efficiency, and treating each segment $k$ as processing energy $E_{\\text{in},k} = \\int V I_{k}\\, dt = V I_{k} \\Delta t$ with delivered energy $E_{\\text{out},k} = \\eta_{\\text{rt}}(I_{k}) E_{\\text{in},k}$, derive and compute the signed fractional error in the total delivered energy over the three-segment schedule when the constant efficiency model is used instead of the current-dependent model, normalized by the total input energy:\n$$\\delta \\equiv \\frac{E_{\\text{out}}^{\\text{const}} - E_{\\text{out}}^{\\text{true}}}{E_{\\text{in},\\text{tot}}}.$$\nExplicitly use $I \\in \\{20, 40, 60\\}\\ \\text{A}$ with equal durations. Express your final answer as a dimensionless fraction with no rounding and no units inside your final answer.",
            "solution": "The problem requires the calculation of the signed fractional error, $\\delta$, in the total delivered energy when a constant efficiency model is used instead of a current-dependent one. The definition of $\\delta$ is:\n$$\n\\delta \\equiv \\frac{E_{\\text{out}}^{\\text{const}} - E_{\\text{out}}^{\\text{true}}}{E_{\\text{in},\\text{tot}}}\n$$\nFirst, we express the total input energy, $E_{\\text{in},\\text{tot}}$. The schedule consists of 3 segments with currents $I_1 = 20\\,\\text{A}$, $I_2 = 40\\,\\text{A}$, and $I_3 = 60\\,\\text{A}$, each over an equal duration $\\Delta t$ and at a constant voltage $V$. The input energy for a single segment $k$ is $E_{\\text{in},k} = V I_k \\Delta t$. The total input energy is the sum over all segments:\n$$\nE_{\\text{in},\\text{tot}} = \\sum_{k=1}^{3} E_{\\text{in},k} = V \\Delta t \\sum_{k=1}^{3} I_k = V \\Delta t (20 + 40 + 60) = 120 V \\Delta t\n$$\nNext, we determine the total \"true\" output energy, $E_{\\text{out}}^{\\text{true}}$, using the current-dependent model $\\eta_{\\text{rt}}^{\\text{true}}(I) = 0.95 - 0.001 I$. The total true output energy is the sum of the outputs from each segment:\n$$\nE_{\\text{out}}^{\\text{true}} = \\sum_{k=1}^{3} \\eta_{\\text{rt}}^{\\text{true}}(I_k) E_{\\text{in},k} = \\sum_{k=1}^{3} (0.95 - 0.001 I_k) (V I_k \\Delta t)\n$$\n$$\nE_{\\text{out}}^{\\text{true}} = V \\Delta t \\left[ (0.95 - 0.001 \\cdot 20) \\cdot 20 + (0.95 - 0.001 \\cdot 40) \\cdot 40 + (0.95 - 0.001 \\cdot 60) \\cdot 60 \\right]\n$$\n$$\nE_{\\text{out}}^{\\text{true}} = V \\Delta t \\left[ (0.93 \\cdot 20) + (0.91 \\cdot 40) + (0.89 \\cdot 60) \\right] = V \\Delta t [18.6 + 36.4 + 53.4] = 108.4 V \\Delta t\n$$\nThen, we calculate the total output energy using the constant efficiency model, $E_{\\text{out}}^{\\text{const}}$, where $\\eta_{\\text{rt}}^{\\text{const}} = 0.9$:\n$$\nE_{\\text{out}}^{\\text{const}} = \\eta_{\\text{rt}}^{\\text{const}} E_{\\text{in},\\text{tot}} = 0.9 \\cdot (120 V \\Delta t) = 108 V \\Delta t\n$$\nNow we can substitute these expressions into the formula for $\\delta$. The common factor $V \\Delta t$ cancels out:\n$$\n\\delta = \\frac{108 V \\Delta t - 108.4 V \\Delta t}{120 V \\Delta t} = \\frac{-0.4}{120}\n$$\nSimplifying the fraction:\n$$\n\\delta = -\\frac{4}{1200} = -\\frac{1}{300}\n$$\nThe negative sign indicates that the simplified constant efficiency model underestimates the total delivered energy compared to the more accurate current-dependent model for this specific schedule.",
            "answer": "$$\\boxed{-\\frac{1}{300}}$$"
        },
        {
            "introduction": "For the most accurate performance predictions, we must acknowledge that a battery's properties, like its internal resistance $R$, change with temperature. This final practice challenges you to build a coupled electro-thermal model, linking electrical behavior with thermal dynamics governed by Joule heating and convective cooling . By deriving and implementing the analytical solution for this system, you will directly explore the critical role of thermal management in preserving energy efficiency.",
            "id": "4077760",
            "problem": "A constant-current discharge of a single lumped battery module is modeled using a first-principles energy balance with Joule heating and convective cooling. The objective is to evaluate the impact of cooling effectiveness on energy efficiency by comparing the temperature-dependent internal resistance trajectories under different thermal conductance values. The battery is discharged at current $I$ for a duration $t_f$, starting at ambient temperature $T_{\\text{amb}}$. The internal resistance depends linearly on temperature as $R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$, where $R_0$ is the temperature-independent baseline resistance at reference temperature $T_{\\text{ref}}$, and $\\alpha$ is the temperature coefficient of resistance. The thermal dynamics are represented by a single-node lumped thermal capacitance $C_{\\text{th}}$ exchanging heat convectively with ambient via an aggregate thermal conductance $h$. The terminal voltage is $U_{\\text{term}}(t) = U_{\\text{oc}} - I\\,R(T(t))$, where $U_{\\text{oc}}$ is the open-circuit voltage (OCV), assumed constant over the short discharge considered.\n\nStarting from the energy conservation law and standard definitions of Joule heating and convective heat transfer, determine the time evolution $T(t)$ and the associated trajectory $R(T(t))$ during the discharge. Using these, compute the energy efficiency over the interval $[0,t_f]$, defined as the ratio of useful electrical energy delivered to the external circuit to the ideal electrical energy with no internal resistance:\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt},\n$$\nwhich must be expressed as a decimal (not a percentage). All quantities and parameters in your derivation and computation must be treated in the International System of Units.\n\nYou must implement a complete, runnable program that performs the calculation for each parameter set in the test suite given below and outputs the energy efficiencies as specified. The program should solve the thermal-resistance dynamics exactly for the given linear temperature dependence without numerical time stepping.\n\nParameters are:\n- Discharge current $I$ in $\\text{A}$,\n- Thermal conductance $h$ in $\\text{W}\\,\\text{K}^{-1}$,\n- Baseline internal resistance $R_0$ in $\\Omega$,\n- Temperature coefficient $\\alpha$ in $\\text{K}^{-1}$,\n- Thermal capacitance $C_{\\text{th}}$ in $\\text{J}\\,\\text{K}^{-1}$,\n- Reference temperature $T_{\\text{ref}}$ in $\\text{K}$,\n- Ambient temperature $T_{\\text{amb}}$ in $\\text{K}$,\n- Open-circuit voltage $U_{\\text{oc}}$ in $\\text{V}$,\n- Discharge duration $t_f$ in $\\text{s}$.\n\nTest suite (each case is independent and should be computed from first principles):\n1. Baseline cooling and negative temperature coefficient (happy path): $I = 40\\,\\text{A}$, $h = 5\\,\\text{W}\\,\\text{K}^{-1}$, $R_0 = 5 \\times 10^{-3}\\,\\Omega$, $\\alpha = -2 \\times 10^{-3}\\,\\text{K}^{-1}$, $C_{\\text{th}} = 900\\,\\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\,\\text{K}$, $T_{\\text{amb}} = 298.15\\,\\text{K}$, $U_{\\text{oc}} = 3.7\\,\\text{V}$, $t_f = 600\\,\\text{s}$.\n2. Stronger cooling (comparison target): $I = 40\\,\\text{A}$, $h = 20\\,\\text{W}\\,\\text{K}^{-1}$, $R_0 = 5 \\times 10^{-3}\\,\\Omega$, $\\alpha = -2 \\times 10^{-3}\\,\\text{K}^{-1}$, $C_{\\text{th}} = 900\\,\\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\,\\text{K}$, $T_{\\text{amb}} = 298.15\\,\\text{K}$, $U_{\\text{oc}} = 3.7\\,\\text{V}$, $t_f = 600\\,\\text{s}$.\n3. Adiabatic edge case: $I = 40\\,\\text{A}$, $h = 0\\,\\text{W}\\,\\text{K}^{-1}$, $R_0 = 5 \\times 10^{-3}\\,\\Omega$, $\\alpha = -2 \\times 10^{-3}\\,\\text{K}^{-1}$, $C_{\\text{th}} = 900\\,\\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\,\\text{K}$, $T_{\\text{amb}} = 298.15\\,\\text{K}$, $U_{\\text{oc}} = 3.7\\,\\text{V}$, $t_f = 600\\,\\text{s}$.\n4. Temperature-independent resistance boundary: $I = 40\\,\\text{A}$, $h = 5\\,\\text{W}\\,\\text{K}^{-1}$, $R_0 = 5 \\times 10^{-3}\\,\\Omega$, $\\alpha = 0\\,\\text{K}^{-1}$, $C_{\\text{th}} = 900\\,\\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\,\\text{K}$, $T_{\\text{amb}} = 298.15\\,\\text{K}$, $U_{\\text{oc}} = 3.7\\,\\text{V}$, $t_f = 600\\,\\text{s}$.\n5. Positive temperature coefficient scenario: $I = 40\\,\\text{A}$, $h = 5\\,\\text{W}\\,\\text{K}^{-1}$, $R_0 = 5 \\times 10^{-3}\\,\\Omega$, $\\alpha = +2 \\times 10^{-3}\\,\\text{K}^{-1}$, $C_{\\text{th}} = 900\\,\\text{J}\\,\\text{K}^{-1}$, $T_{\\text{ref}} = 298.15\\,\\text{K}$, $T_{\\text{amb}} = 298.15\\,\\text{K}$, $U_{\\text{oc}} = 3.7\\,\\text{V}$, $t_f = 600\\,\\text{s}$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the energy efficiencies for the five test cases as a comma-separated list enclosed in square brackets, with each efficiency expressed as a decimal rounded to six places (e.g., $[0.950000,0.946000,0.948500,0.945946,0.945834]$). No other text must be printed.",
            "solution": "The problem requires the calculation of the energy efficiency of a battery module undergoing a constant-current discharge. The solution necessitates determining the time-evolution of the battery's temperature, which in turn affects its internal resistance and, consequently, its terminal voltage and energy output. An analytical solution is derived from the governing principles of energy conservation.\n\n### 1. Thermal Model and Governing Equation\n\nThe energy balance for the lumped-capacitance battery module is given by the first law of thermodynamics. The rate of change of the module's internal energy is equal to the rate of internal heat generation minus the rate of heat loss to the surroundings.\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = P_{\\text{gen}}(t) - P_{\\text{loss}}(t)\n$$\nHere, $C_{\\text{th}}$ is the thermal capacitance and $T(t)$ is the temperature of the module at time $t$.\n\nThe heat generation, $P_{\\text{gen}}(t)$, is due to Joule heating, given by $P_{\\text{gen}}(t) = I^2 R(T(t))$, where $I$ is the constant discharge current and $R(T(t))$ is the temperature-dependent internal resistance.\n\nThe heat loss, $P_{\\text{loss}}(t)$, is modeled as convective heat transfer to the ambient environment, described by Newton's law of cooling: $P_{\\text{loss}}(t) = h(T(t) - T_{\\text{amb}})$, where $h$ is the thermal conductance and $T_{\\text{amb}}$ is the ambient temperature.\n\nSubstituting these expressions into the energy balance equation yields:\n$$\nC_{\\text{th}} \\frac{dT(t)}{dt} = I^2 R(T(t)) - h(T(t) - T_{\\text{amb}})\n$$\nThe internal resistance is given by a linear function of temperature: $R(T) = R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right)$. Substituting this into the differential equation gives:\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0\\left(1 + \\alpha\\,(T - T_{\\text{ref}})\\right) - h(T - T_{\\text{amb}})\n$$\nTo solve this equation, we rearrange it into the standard form of a first-order linear ordinary differential equation, $\\frac{dT}{dt} + pT = q$.\n$$\nC_{\\text{th}} \\frac{dT}{dt} = I^2 R_0 + I^2 R_0 \\alpha T - I^2 R_0 \\alpha T_{\\text{ref}} - hT + hT_{\\text{amb}}\n$$\n$$\nC_{\\text{th}} \\frac{dT}{dt} + (h - I^2 R_0 \\alpha)T = I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}\n$$\nDividing by $C_{\\text{th}}$, we get:\n$$\n\\frac{dT}{dt} + \\left(\\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\\right)T = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\nLet us define the constants $k_1$ and $k_2$:\n$$\nk_1 = \\frac{h - I^2 R_0 \\alpha}{C_{\\text{th}}}\n$$\n$$\nk_2 = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{C_{\\text{th}}}\n$$\nThe differential equation is now $\\frac{dT}{dt} + k_1 T = k_2$.\n\n### 2. Analytical Solution for Temperature Evolution\n\nThis is a first-order linear ODE with constant coefficients. Its solution is composed of a transient part and a steady-state part. The steady-state temperature, $T_{ss}$, is achieved when $\\frac{dT}{dt} = 0$, which gives $k_1 T_{ss} = k_2$, so $T_{ss} = \\frac{k_2}{k_1}$.\n$$\nT_{ss} = \\frac{I^2 R_0(1 - \\alpha T_{\\text{ref}}) + h T_{\\text{amb}}}{h - I^2 R_0 \\alpha}\n$$\nThe general solution is of the form $T(t) = T_{ss} + C e^{-k_1 t}$, where $C$ is a constant of integration determined by the initial condition. The problem states that the battery starts at ambient temperature, so $T(0) = T_{\\text{amb}}$.\n$$\nT(0) = T_{ss} + C e^0 = T_{ss} + C = T_{\\text{amb}} \\implies C = T_{\\text{amb}} - T_{ss}\n$$\nThus, the analytical solution for the temperature as a function of time is:\n$$\nT(t) = T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t}\n$$\nThis solution is valid provided $k_1 \\neq 0$, which is equivalent to $h - I^2 R_0 \\alpha \\neq 0$. This condition holds for all test cases provided.\n\n### 3. Energy Efficiency Calculation\n\nThe energy efficiency $\\eta$ is defined as the ratio of the useful electrical energy delivered to the external circuit to the ideal electrical energy available from the source (with no internal resistance):\n$$\n\\eta = \\frac{\\int_0^{t_f} I\\,U_{\\text{term}}(t)\\,dt}{\\int_0^{t_f} I\\,U_{\\text{oc}}\\,dt}\n$$\nGiven that $I$ and $U_{\\text{oc}}$ are constant, the formula simplifies. Substituting $U_{\\text{term}}(t) = U_{\\text{oc}} - I R(T(t))$:\n$$\n\\eta = \\frac{\\int_0^{t_f} I(U_{\\text{oc}} - I R(T(t)))\\,dt}{I U_{\\text{oc}} t_f} = \\frac{I U_{\\text{oc}} t_f - I^2 \\int_0^{t_f} R(T(t))\\,dt}{I U_{\\text{oc}} t_f}\n$$\n$$\n\\eta = 1 - \\frac{I}{U_{\\text{oc}} t_f} \\int_0^{t_f} R(T(t))\\,dt\n$$\nTo calculate $\\eta$, we must evaluate the time-integral of the resistance, $\\mathcal{I}_R = \\int_0^{t_f} R(T(t))\\,dt$.\n$$\n\\mathcal{I}_R = \\int_0^{t_f} R_0\\left(1 + \\alpha(T(t) - T_{\\text{ref}})\\right)dt = \\int_0^{t_f} \\left(R_0(1 - \\alpha T_{\\text{ref}}) + R_0 \\alpha T(t)\\right)dt\n$$\n$$\n\\mathcal{I}_R = R_0(1 - \\alpha T_{\\text{ref}}) t_f + R_0 \\alpha \\int_0^{t_f} T(t)\\,dt\n$$\nLet $\\mathcal{I}_T = \\int_0^{t_f} T(t)\\,dt$. We can integrate the expression for $T(t)$:\n$$\n\\mathcal{I}_T = \\int_0^{t_f} \\left( T_{ss} + (T_{\\text{amb}} - T_{ss}) e^{-k_1 t} \\right) dt\n$$\n$$\n\\mathcal{I}_T = \\left[ T_{ss} t + \\frac{T_{\\text{amb}} - T_{ss}}{-k_1} e^{-k_1 t} \\right]_0^{t_f}\n$$\n$$\n\\mathcal{I}_T = T_{ss} t_f + \\frac{T_{ss} - T_{\\text{amb}}}{k_1} (e^{-k_1 t_f} - 1)\n$$\nBy substituting $\\mathcal{I}_T$ into the expression for $\\mathcal{I}_R$, and subsequently $\\mathcal{I}_R$ into the formula for $\\eta$, we can compute the energy efficiency for each set of parameters.\n\n### 4. Special Cases\n\n-   **Temperature-Independent Resistance ($\\alpha=0$)**: In this case, $R(T) = R_0$ is constant. The integral $\\mathcal{I}_R = R_0 t_f$, and the efficiency simplifies to $\\eta = 1 - \\frac{I R_0}{U_{\\text{oc}}}$. Our general formula correctly reduces to this limit.\n-   **Adiabatic Case ($h=0$)**: The formulas remain valid. $k_1 = -I^2 R_0 \\alpha / C_{\\text{th}}$ and $T_{ss} = T_{\\text{ref}} - 1/\\alpha$.\n-   **Critical Condition ($h - I^2 R_0 \\alpha=0$)**: In this case, $k_1=0$. The ODE becomes $\\frac{dT}{dt} = k_2$, leading to a linear temperature rise: $T(t) = T_{\\text{amb}} + k_2 t$. The integral $\\mathcal{I}_T$ would be $T_{\\text{amb}} t_f + \\frac{1}{2} k_2 t_f^2$. This case is not encountered in the provided test suite but is handled for robustness.\n\nThe computational procedure for each test case is to first calculate $k_1$ and $T_{ss}$, then evaluate $\\mathcal{I}_T$, followed by $\\mathcal{I}_R$, and finally compute $\\eta$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the energy efficiency for battery discharge scenarios.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: Baseline cooling and negative temperature coefficient\n        (40.0, 5.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 2: Stronger cooling\n        (40.0, 20.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 3: Adiabatic edge case\n        (40.0, 0.0, 5e-3, -2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 4: Temperature-independent resistance boundary\n        (40.0, 5.0, 5e-3, 0.0, 900.0, 298.15, 298.15, 3.7, 600.0),\n        # Case 5: Positive temperature coefficient scenario\n        (40.0, 5.0, 5e-3, 2e-3, 900.0, 298.15, 298.15, 3.7, 600.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        eff = calculate_efficiency(*params)\n        results.append(f\"{eff:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_efficiency(I, h, R0, alpha, C_th, T_ref, T_amb, U_oc, t_f):\n    \"\"\"\n    Computes the energy efficiency for a given set of battery parameters.\n\n    The function first solves the ordinary differential equation for temperature T(t)\n    analytically, then integrates the resulting resistance R(T(t)) over time to\n    find the total energy loss and efficiency.\n    \"\"\"\n    \n    # Special case: alpha = 0 (temperature-independent resistance)\n    if alpha == 0:\n        eta = 1 - (I * R0) / U_oc\n        return eta\n\n    # This term appears in the denominator of T_ss and the definition of k1\n    denominator_term = h - I**2 * R0 * alpha\n\n    # This is a special case when k1=0, leading to a linear temperature profile.\n    # Handled with a small tolerance for floating-point arithmetic.\n    if abs(denominator_term)  1e-12:\n        k2 = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / C_th\n        # T(t) = T_amb + k2*t, so its integral is T_amb*t_f + 0.5*k2*t_f^2\n        integral_T = T_amb * t_f + 0.5 * k2 * t_f**2\n    else:\n        # General case (k1 != 0)\n        # Constant k1 for the ODE dT/dt + k1*T = k2\n        k1 = denominator_term / C_th\n        \n        # Steady-state temperature\n        T_ss = (I**2 * R0 * (1 - alpha * T_ref) + h * T_amb) / denominator_term\n        \n        # Analytical integral of T(t) from 0 to t_f\n        # T(t) = T_ss + (T_amb - T_ss) * exp(-k1*t)\n        integral_T = T_ss * t_f + (T_ss - T_amb) / k1 * (np.exp(-k1 * t_f) - 1.0)\n\n    # Integral of resistance R(t) from 0 to t_f\n    # R(t) = R0 * (1 - alpha*T_ref) + R0*alpha*T(t)\n    integral_R = R0 * (1 - alpha * T_ref) * t_f + R0 * alpha * integral_T\n\n    # Energy efficiency eta = 1 - (I * integral_R) / (U_oc * t_f)\n    eta = 1 - (I / (U_oc * t_f)) * integral_R\n\n    return eta\n\nsolve()\n```"
        }
    ]
}