{
    "hands_on_practices": [
        {
            "introduction": "At the heart of hydro-thermal coordination lies a fundamental economic trade-off: use water now to displace costly thermal generation, or save it for a future period when it might be more valuable. This exercise  introduces the concept of \"water value,\" the marginal opportunity cost that quantifies this trade-off. By solving a simplified two-period problem, you will learn to calculate this critical value from first principles, providing the foundational economic intuition for all hydro-thermal scheduling models.",
            "id": "4095243",
            "problem": "Consider a two-period Hydro-Thermal Coordination (HTC) problem in an energy system with one hydro unit and one thermal unit. Periods are indexed by $t \\in \\{1,2\\}$. The objective is to schedule hydro and thermal generation to meet the period demands while minimizing the thermal generation cost. Hydro generation is costless but limited by the available water resource, a conversion efficiency, and turbine capacity limits.\n\nThe thermal unit in period $t$ produces $g_t$ and has a convex cost $C_t(g_t) = a_t g_t^2 + b_t g_t$, where $a_t  0$ and $b_t \\geq 0$. The hydro unit in period $t$ produces $h_t$ and uses water volume $v_t$ related by $h_t = k v_t$, where $k \\in (0,1]$ is a fixed conversion efficiency. Demand balance in each period requires $g_t + h_t = D_t$, with $D_t  0$ given. Hydro turbine capacity in each period imposes $0 \\leq h_t \\leq H_t^{\\max}$.\n\nThe intertemporal water balance is given by an initial storage $S_1$, exogenous inflows $I_1$ and $I_2$ that materialize before dispatch in each respective period, and a required terminal storage $\\bar{S}$ at the end of period $2$. Assuming no spill, the total water available for generation across the two periods is\n$$W = S_1 + I_1 + I_2 - \\bar{S},$$\nand the aggregate hydro generation satisfies\n$$\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W.$$\n\nYou are given the following parameters:\n- $D_1 = 90$, $D_2 = 110$,\n- $a_1 = 0.02$, $b_1 = 12$; $a_2 = 0.015$, $b_2 = 10$,\n- $k = 0.9$,\n- $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$,\n- $H_1^{\\max} = 80$, $H_2^{\\max} = 80$.\n\nFormulate the minimization of total thermal cost subject to period-wise demand balance and the aggregate water constraint. Then, by reasoning from fundamental optimality principles for convex economic dispatch, compute the water value at the given storage level $S_1$, defined as the Lagrange multiplier on the aggregate water-use constraint expressed in monetary units per unit of water volume.\n\nRound your final numerical answer to four significant figures and express it in monetary units per unit of water volume.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\n**Step 1: Extracted Givens**\n- **Periods:** $t \\in \\{1, 2\\}$.\n- **Thermal generation:** $g_t$ in period $t$.\n- **Thermal cost:** $C_t(g_t) = a_t g_t^2 + b_t g_t$, with $a_t  0$, $b_t \\geq 0$.\n- **Hydro generation:** $h_t$ in period $t$.\n- **Hydro efficiency:** $h_t = k v_t$, where $v_t$ is water volume and $k \\in (0,1]$ is the efficiency.\n- **Demand balance:** $g_t + h_t = D_t$, with $D_t  0$.\n- **Hydro capacity:** $0 \\leq h_t \\leq H_t^{\\max}$.\n- **Water balance:** Total available water for generation is $W = S_1 + I_1 + I_2 - \\bar{S}$.\n- **Aggregate water constraint:** $\\frac{h_1}{k} + \\frac{h_2}{k} \\leq W$.\n- **Parameters:**\n  - $D_1 = 90$, $D_2 = 110$.\n  - $a_1 = 0.02$, $b_1 = 12$.\n  - $a_2 = 0.015$, $b_2 = 10$.\n  - $k = 0.9$.\n  - $S_1 = 50$, $I_1 = 20$, $I_2 = 10$, $\\bar{S} = 15$.\n  - $H_1^{\\max} = 80$, $H_2^{\\max} = 80$.\n- **Objective:** Minimize total thermal cost $\\sum_{t=1}^2 C_t(g_t)$ and find the water value, which is the Lagrange multiplier on the aggregate water constraint.\n\n**Step 2: Validation**\nThe problem describes a classic Hydro-Thermal Coordination (HTC) scenario, a standard and well-understood topic in energy systems engineering. The objective function is a convex quadratic, and the constraints are linear, forming a convex optimization problem which is well-posed and guaranteed to have a unique solution. All parameters are provided, and there are no internal contradictions, scientific inaccuracies, or ambiguous statements. The problem is therefore deemed **valid**.\n\n**Problem Formulation**\nThe objective is to minimize the total thermal cost over the two periods:\n$$ \\min_{g_1, g_2, h_1, h_2} \\sum_{t=1}^{2} C_t(g_t) = C_1(g_1) + C_2(g_2) $$\nUsing the demand balance equation, $g_t = D_t - h_t$, we can express the cost solely in terms of hydro generation, $h_t$:\n$$ \\min_{h_1, h_2} \\sum_{t=1}^{2} C_t(D_t - h_t) = \\left(a_1(D_1 - h_1)^2 + b_1(D_1 - h_1)\\right) + \\left(a_2(D_2 - h_2)^2 + b_2(D_2 - h_2)\\right) $$\nThis minimization is subject to a set of constraints.\nFirst, the total water used for generation cannot exceed the total available water. The water use is $v_t = h_t/k$. Thus, the aggregate water constraint is:\n$$ \\frac{h_1}{k} + \\frac{h_2}{k} \\leq W $$\nThe total available water $W$ is calculated from the given storage and inflow data:\n$$ W = S_1 + I_1 + I_2 - \\bar{S} = 50 + 20 + 10 - 15 = 65 $$\nSubstituting $k=0.9$ and $W=65$, the constraint on total hydro energy becomes:\n$$ h_1 + h_2 \\leq k W = 0.9 \\times 65 = 58.5 $$\nSecond, hydro generation in each period is bounded by the turbine capacity and also cannot exceed the demand (since thermal generation $g_t$ must be non-negative, $g_t=D_t-h_t \\geq 0$).\nFor period $1$: $0 \\leq h_1 \\leq \\min(D_1, H_1^{\\max}) = \\min(90, 80) = 80$.\nFor period $2$: $0 \\leq h_2 \\leq \\min(D_2, H_2^{\\max}) = \\min(110, 80) = 80$.\n\nThe full optimization problem is:\n$$ \\min_{h_1, h_2} \\left[ a_1(D_1 - h_1)^2 + b_1(D_1 - h_1) + a_2(D_2 - h_2)^2 + b_2(D_2 - h_2) \\right] $$\nsubject to:\n$$ h_1 + h_2 \\leq 58.5 \\quad (\\text{with Lagrange multiplier } \\lambda_E) $$\n$$ 0 \\leq h_1 \\leq 80 $$\n$$ 0 \\leq h_2 \\leq 80 $$\nThe problem asks for the \"water value,\" which is the Lagrange multiplier on the water volume constraint $\\frac{h_1+h_2}{k} \\leq W$. Let's call this multiplier $\\lambda$. The constraint on hydro energy $h_1+h_2 \\leq kW$ would have a multiplier $\\lambda_E$. These multipliers are related by $\\lambda = k \\lambda_E$, as a marginal unit of water $W$ provides $k$ marginal units of energy $kW$. We are asked to find $\\lambda$.\n\n**Optimality Conditions**\nLet $J(h_1, h_2)$ be the objective function. This is a convex problem, so the Karush-Kuhn-Tucker (KKT) conditions are necessary and sufficient for optimality. The core principle of economic dispatch is that a resource should be allocated such that its marginal benefit is equal across all uses. Here, the \"resource\" is total hydro energy, and the \"uses\" are generation in period $1$ and period $2$.\n\nThe marginal benefit of using hydro generation in period $t$ is the avoided marginal cost of thermal generation. The marginal cost of thermal generation is $C'_t(g_t) = 2a_t g_t + b_t$. The avoided cost, or marginal benefit of hydro, is therefore:\n$$ \\beta_t(h_t) = -\\frac{\\partial J}{\\partial h_t} = - \\frac{d C_t(D_t - h_t)}{d h_t} = - [2a_t(D_t - h_t)(-1) + b_t(-1)] = 2a_t(D_t - h_t) + b_t $$\nThe marginal opportunity cost of using hydro energy is its shadow price, $\\lambda_E = \\lambda/k$. At the optimum, if the hydro generations $h_1^*$ and $h_2^*$ are not at their bounds, we must have:\n$$ \\beta_1(h_1^*) = \\beta_2(h_2^*) = \\lambda_E = \\frac{\\lambda}{k} $$\n\n**Solving for the Optimal Dispatch**\nLet's compute the marginal benefit functions with the given parameters:\nFor period $1$:\n$$ \\beta_1(h_1) = 2(0.02)(90 - h_1) + 12 = 0.04(90 - h_1) + 12 = 3.6 - 0.04h_1 + 12 = 15.6 - 0.04h_1 $$\nFor period $2$:\n$$ \\beta_2(h_2) = 2(0.015)(110 - h_2) + 10 = 0.03(110 - h_2) + 10 = 3.3 - 0.03h_2 + 10 = 13.3 - 0.03h_2 $$\n\nWe must check if the water constraint $h_1 + h_2 \\leq 58.5$ is binding. The maximum possible hydro generation is far greater than the available amount ($80+80=160  58.5$). Further, the marginal benefits $\\beta_t(h_t)$ are positive for any feasible $h_t \\in [0, 80]$. For example, at maximum hydro use in period $1$, $\\beta_1(80) = 15.6 - 0.04(80) = 12.4  0$. This implies that using hydro is always cost-saving. Therefore, all available water will be used, and the water constraint is binding:\n$$ h_1 + h_2 = 58.5 $$\nThe hydro generation is limited by water availability, not turbine capacity in this case. The optimal dispatch will satisfy the system of two equations:\n1. $h_1 + h_2 = 58.5$\n2. $\\beta_1(h_1) = \\beta_2(h_2) \\implies 15.6 - 0.04h_1 = 13.3 - 0.03h_2$\n\nFrom equation (1), we have $h_2 = 58.5 - h_1$. Substituting this into equation (2):\n$$ 15.6 - 0.04h_1 = 13.3 - 0.03(58.5 - h_1) $$\n$$ 15.6 - 0.04h_1 = 13.3 - 1.755 + 0.03h_1 $$\n$$ 15.6 - 0.04h_1 = 11.545 + 0.03h_1 $$\n$$ 15.6 - 11.545 = 0.04h_1 + 0.03h_1 $$\n$$ 4.055 = 0.07h_1 $$\n$$ h_1 = \\frac{4.055}{0.07} \\approx 57.92857 $$\nThen, $h_2 = 58.5 - h_1 = 58.5 - 57.92857 \\approx 0.57143$.\nBoth $h_1$ and $h_2$ are within their individual bounds $[0, 80]$, so this solution is feasible.\n\n**Calculating the Water Value**\nThe shadow price of hydro energy, $\\lambda_E$, is the common marginal benefit at the optimal dispatch:\n$$ \\lambda_E = \\beta_1(h_1) = 15.6 - 0.04 \\left(\\frac{4.055}{0.07}\\right) = 15.6 - \\frac{0.1622}{0.07} \\approx 15.6 - 2.31714 = 13.28286 $$\nWe can verify with $\\beta_2(h_2)$:\n$$ \\lambda_E = \\beta_2(h_2) = 13.3 - 0.03 (58.5 - \\frac{4.055}{0.07}) = 13.3 - 1.755 + 0.03 \\left(\\frac{4.055}{0.07}\\right) = 11.545 + \\frac{0.12165}{0.07} \\approx 11.545 + 1.73786 = 13.28286 $$\nThe values match. $\\lambda_E$ has units of monetary units per unit of energy (e.g., \\$/MWh).\nThe problem asks for the water value $\\lambda$, which is the Lagrange multiplier for the volume constraint $\\frac{h_1+h_2}{k} \\leq W$. This is related to $\\lambda_E$ by $\\lambda = k \\lambda_E$.\n$$ \\lambda = k \\times \\lambda_E = 0.9 \\times 13.28286 \\approx 11.954574 $$\nRounding to four significant figures, we get:\n$$ \\lambda = 11.95 $$\nThis value represents the marginal worth of an additional unit of water volume in storage, expressed in monetary units.",
            "answer": "$$\\boxed{11.95}$$"
        },
        {
            "introduction": "Real-world power system operations involve not just deciding *how much* to generate from each unit, but also *which* units to turn on or offâ€”a complex problem known as Unit Commitment (UC). This practice  moves beyond continuous dispatch to a mixed-integer framework, incorporating the binary on/off decisions and associated costs of thermal units. By solving a small-scale instance via exhaustive enumeration, you will gain direct insight into the combinatorial complexity of the HTC problem and the logic of co-optimizing discrete commitment and continuous hydro release decisions.",
            "id": "4095248",
            "problem": "Consider a Hydro-Thermal Coordination (HTC) problem formulated as a Mixed-Integer Linear Programming (MILP) for a small Unit Commitment (UC) instance involving two thermal generating units and a single reservoir over three discrete periods. The goal is to minimize the total operating cost over the horizon while satisfying electricity demand, reservoir water balance, unit operating constraints, and integral release decisions. Assume each period has a duration of one hour so that energy in megawatt-hour aligns with power in megawatt for one hour.\n\nYou are to implement a program that solves the following optimization problem via exhaustive enumeration over the integer and binary decision variables, with continuous decisions resolved optimally under linear costs.\n\nDecision variables per period $t \\in \\{1,2,3\\}$:\n- Thermal commitment $y_{u,t} \\in \\{0,1\\}$ for each unit $u \\in \\{1,2\\}$.\n- Thermal startup $s_{u,t} \\in \\{0,1\\}$, defined by $s_{u,t} \\ge y_{u,t} - y_{u,t-1}$ with $y_{u,0} = 0$ for all units.\n- Thermal generation $g_{u,t} \\ge 0$ for each unit, subject to minimum and maximum operating limits that apply when committed.\n- Reservoir release $r_t \\in \\{0,\\Delta r,2\\Delta r,\\ldots,R^{\\max}\\}$ in cubic hectometers (hm$^3$), with a constant hydroelectric conversion $h_t = \\eta r_t$ in megawatt-hour.\n\nParameters:\n- Demand $D_t$ in megawatt-hour for each period $t$.\n- Reservoir storage $v_t$ in hm$^3$ obeys the water balance $v_{t+1} = v_t + \\text{inflow}_t - r_t$, with $v_1$ initialized at $v_0$, bounds $v_t \\in [v^{\\min}, v^{\\max}]$, and terminal requirement $v_4 = v^{\\text{target}}$.\n- Per-period release bound $r_t \\le R^{\\max}$ and release granularity $\\Delta r$ in hm$^3$.\n- Hydroelectric conversion factor $\\eta$ in megawatt-hour per hm$^3$ (assume constant head).\n- For each thermal unit $u$, minimum and maximum generation $P^{\\min}_u$ and $P^{\\max}_u$ in megawatt-hour per period, variable cost $c_u$ in dollars per megawatt-hour, per-period commitment fixed cost $F_u$ in dollars, and startup cost $SU_u$ in dollars.\n\nConstraints:\n- Demand balance for each period $t$: $\\sum_{u} g_{u,t} + h_t = D_t$.\n- Thermal operating limits: $P^{\\min}_u y_{u,t} \\le g_{u,t} \\le P^{\\max}_u y_{u,t}$.\n- Startup logic: $s_{u,t} \\ge y_{u,t} - y_{u,t-1}$ and $s_{u,t} \\ge 0$, with $y_{u,0} = 0$.\n- Reservoir balance and bounds: $v_{t+1} = v_t + \\text{inflow}_t - r_t$, $v_t \\in [v^{\\min}, v^{\\max}]$, $r_t \\in \\{0,\\Delta r,\\ldots,R^{\\max}\\}$, and $v_4 = v^{\\text{target}}$.\n- Hydroelectric generation: $h_t = \\eta r_t$.\n- No overproduction is allowed: $h_t \\le D_t$ for all $t$.\n\nObjective:\n- Minimize total cost\n$$\n\\text{Cost} = \\sum_{t=1}^{3} \\left( \\sum_{u=1}^{2} (c_u g_{u,t} + F_u y_{u,t} + SU_u s_{u,t}) \\right),\n$$\nexpressed in dollars.\n\nAlgorithmic constraints for implementation:\n- Enumerate all binary commitment states $y_{u,t}$ for $u \\in \\{1,2\\}$ and $t \\in \\{1,2,3\\}$.\n- Enumerate all release sequences $r_t$ consistent with $v_4 = v^{\\text{target}}$, reservoir bounds, and per-period release bounds.\n- For each feasible pair of $(y,r)$, compute the minimal thermal dispatch cost by merit-order allocation under linear variable costs, honoring minimum generation when committed and maximum capacities. If the remaining demand after hydro is below the sum of committed minimums or above the sum of committed maximums, the pair is infeasible.\n\nYou must use the following test suite of parameter sets. All units and numbers are specified explicitly, and all quantities must be treated exactly as stated.\n\nCommon parameters used in all cases:\n- Thermal unit $1$: $P^{\\min}_1 = 10$ megawatt-hour, $P^{\\max}_1 = 50$ megawatt-hour, $c_1 = 30$ dollars per megawatt-hour, $F_1 = 100$ dollars per period, $SU_1 = 60$ dollars.\n- Thermal unit $2$: $P^{\\min}_2 = 0$ megawatt-hour, $P^{\\max}_2 = 40$ megawatt-hour, $c_2 = 22$ dollars per megawatt-hour, $F_2 = 80$ dollars per period, $SU_2 = 40$ dollars.\n- Hydroelectric conversion: $\\eta = 2$ megawatt-hour per hm$^3$.\n- Release granularity: $\\Delta r = 5$ hm$^3$.\n- Per-period maximum release: $R^{\\max} = 15$ hm$^3$.\n- Initial commitment states: $y_{u,0} = 0$ for all units.\n\nCase $1$ (general happy path):\n- Demand: $D = [50, 40, 60]$ megawatt-hour.\n- Inflows: $[\\text{inflow}_1, \\text{inflow}_2, \\text{inflow}_3] = [5, 5, 5]$ hm$^3$.\n- Initial storage: $v_0 = 20$ hm$^3$.\n- Storage bounds: $v^{\\min} = 0$ hm$^3$, $v^{\\max} = 40$ hm$^3$.\n- Terminal storage target: $v^{\\text{target}} = 15$ hm$^3$.\n\nCase $2$ (boundary due to upper storage saturation and mandatory releases):\n- Demand: $D = [20, 20, 20]$ megawatt-hour.\n- Inflows: $[\\text{inflow}_1, \\text{inflow}_2, \\text{inflow}_3] = [10, 10, 10]$ hm$^3$.\n- Initial storage: $v_0 = 40$ hm$^3$.\n- Storage bounds: $v^{\\min} = 0$ hm$^3$, $v^{\\max} = 40$ hm$^3$.\n- Terminal storage target: $v^{\\text{target}} = 35$ hm$^3$.\n\nCase $3$ (edge case with high demand and limited hydro availability):\n- Demand: $D = [70, 70, 70]$ megawatt-hour.\n- Inflows: $[\\text{inflow}_1, \\text{inflow}_2, \\text{inflow}_3] = [3, 3, 3]$ hm$^3$.\n- Initial storage: $v_0 = 16$ hm$^3$.\n- Storage bounds: $v^{\\min} = 0$ hm$^3$, $v^{\\max} = 40$ hm$^3$.\n- Terminal storage target: $v^{\\text{target}} = 10$ hm$^3$.\n\nRequired outputs:\n- For each case, compute the minimal total cost in dollars. Express each result as a floating-point number rounded to two decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $[x_1,x_2,x_3]$, where $x_i$ corresponds to the minimal total cost for case $i$.\n\nAngle units are not applicable. Percentages are not used. All energy quantities must be handled in megawatt-hour, and all water quantities must be handled in hm$^3$. All costs must be handled in dollars. The final outputs must be in dollars rounded to two decimal places.",
            "solution": "The problem presented is a well-posed instance of a Hydro-Thermal Coordination (HTC) problem for a small-scale power system. It is formulated as a Mixed-Integer Linear Program (MILP) to be solved by exhaustive enumeration of the discrete decision variables. The problem is scientifically grounded, self-contained, and all parameters are provided, rendering it valid for a full analytical and computational solution.\n\nThe objective is to minimize the total operational cost over a planning horizon of $T=3$ periods, each of $1$-hour duration. The system consists of two thermal generating units and one hydroelectric reservoir.\n\nThe total cost to be minimized is the sum of variable generation costs, fixed commitment costs, and startup costs for the thermal units over the entire horizon:\n$$\n\\text{Cost} = \\sum_{t=1}^{3} \\sum_{u=1}^{2} (c_u g_{u,t} + F_u y_{u,t} + SU_u s_{u,t})\n$$\nwhere for each unit $u \\in \\{1, 2\\}$ and period $t \\in \\{1, 2, 3\\}$:\n- $g_{u,t}$ is the thermal generation in megawatt-hours (MWh).\n- $y_{u,t} \\in \\{0, 1\\}$ is the binary commitment status (1 if on, 0 if off).\n- $s_{u,t} \\in \\{0, 1\\}$ is the binary startup status, determined by $s_{u,t} = \\max(0, y_{u,t} - y_{u,t-1})$ with initial state $y_{u,0} = 0$.\n- $c_u$ is the variable cost in dollars per MWh ($/\\text{MWh}$).\n- $F_u$ is the fixed cost in dollars per period.\n- $SU_u$ is the startup cost in dollars.\n\nThis minimization is subject to several constraints:\n1.  **Demand Balance:** For each period $t$, the total generation must exactly meet the demand $D_t$:\n    $$\n    g_{1,t} + g_{2,t} + h_t = D_t\n    $$\n    where $h_t$ is the hydroelectric generation in MWh.\n2.  **Thermal Operating Limits:** Each thermal unit's generation is constrained by its minimum ($P^{\\min}_u$) and maximum ($P^{\\max}_u$) power output limits when committed:\n    $$\n    P^{\\min}_u y_{u,t} \\le g_{u,t} \\le P^{\\max}_u y_{u,t}\n    $$\n3.  **Hydroelectric Generation:** Hydro generation is a linear function of the water release $r_t$ (in hm$^3$), with a constant conversion factor $\\eta$ (in MWh/hm$^3$):\n    $$\n    h_t = \\eta r_t\n    $$\n    Additionally, hydro generation cannot exceed the demand in any period: $h_t \\le D_t$.\n4.  **Reservoir Dynamics and Constraints:** The reservoir's water volume $v_t$ (in hm$^3$) at the start of period $t$ evolves according to the water balance equation:\n    $$\n    v_{t+1} = v_t + \\text{inflow}_t - r_t\n    $$\n    The storage volume must remain within specified bounds, $[v^{\\min}, v^{\\max}]$, for all periods. A terminal storage target, $v_4 = v^{\\text{target}}$, must be met at the end of the horizon.\n5.  **Discrete Release Decisions:** The water release in each period, $r_t$, is a discrete decision variable, chosen from the set $\\{0, \\Delta r, 2\\Delta r, \\ldots, R^{\\max}\\}$. Given $\\Delta r = 5$ hm$^3$ and $R^{\\max} = 15$ hm$^3$, the possible release values are $r_t \\in \\{0, 5, 10, 15\\}$ hm$^3$.\n\nThe solution methodology proceeds via a structured exhaustive enumeration as specified.\n\n**Step 1: Enumeration of Feasible Hydro-Schedules**\nFirst, we generate all possible sequences of releases $(r_1, r_2, r_3)$ where each $r_t$ can be one of $\\{0, 5, 10, 15\\}$. This results in $4^3 = 64$ potential sequences. Each sequence is then validated against the full set of hydraulic constraints for the given case parameters ($v_0, \\text{inflows}, v^{\\min}, v^{\\max}, v^{\\text{target}}, D_t$):\n- Starting with the initial volume $v_1 = v_0$, we simulate the reservoir volume for $t=1, 2, 3$ using $v_{t+1} = v_t + \\text{inflow}_t - r_t$.\n- At each step, we check if $v_{t+1}$ is within $[v^{\\min}, v^{\\max}]$.\n- We also check if the resulting hydro generation $h_t = \\eta r_t$ exceeds demand $D_t$.\n- Finally, we check if the terminal volume $v_4$ matches the target $v^{\\text{target}}$.\nA release sequence is deemed feasible only if it satisfies all these conditions. Sequences that fail any check are discarded.\n\n**Step 2: Enumeration of Thermal Commitment Schedules**\nFor the two thermal units over three periods, a commitment schedule is defined by the set of binary variables $\\{y_{u,t}\\}$ for $u \\in \\{1,2\\}$ and $t \\in \\{1,2,3\\}$. There are $2$ units and $3$ periods, so there are $2^{2 \\times 3} = 64$ possible commitment schedules. We generate all of them.\n\n**Step 3: Cost Evaluation for Each Feasible (Hydro, Thermal) Pair**\nWe iterate through every feasible hydro-schedule found in Step 1 and every thermal commitment schedule from Step 2. For each pair, we calculate the total cost. If at any point a schedule is found to be infeasible, we discard it and move to the next.\nThe total cost for a given pair is the sum of fixed, startup, and variable costs.\n\n- **Fixed and Startup Costs:** These depend only on the commitment schedule $y = \\{y_{u,t}\\}$.\n    - Fixed Cost: $\\sum_{t=1}^{3} \\sum_{u=1}^{2} F_u y_{u,t}$.\n    - Startup Cost: $\\sum_{t=1}^{3} \\sum_{u=1}^{2} SU_u s_{u,t}$, where $s_{u,t} = \\max(0, y_{u,t} - y_{u,t-1})$ and $y_{u,0} = 0$.\n\n- **Variable Generation Cost (Economic Dispatch):** For each period $t$, we calculate the minimum cost to meet the residual demand, which is the total demand $D_t$ minus the hydro generation $h_t = \\eta r_t$. Let the residual demand be $D'_t = D_t - h_t$.\n    - **Feasibility Check:** First, we determine the total minimum and maximum generation capacity from the committed units: $P^{\\min}_{\\text{total}, t} = \\sum_{u} P^{\\min}_u y_{u,t}$ and $P^{\\max}_{\\text{total}, t} = \\sum_{u} P^{\\max}_u y_{u,t}$. If the residual demand $D'_t$ is outside the range $[P^{\\min}_{\\text{total}, t}, P^{\\max}_{\\text{total}, t}]$, the schedule is infeasible for this period, and the entire (hydro, thermal) schedule pair is discarded.\n    - **Merit-Order Dispatch:** If feasible, we dispatch the thermal units to meet $D'_t$ at minimum cost. The units are ordered by their variable cost $c_u$ ($c_2 = 22  c_1 = 30$).\n        1.  First, all committed units are dispatched at their minimum generation level $P^{\\min}_u y_{u,t}$. The cost for this is $\\sum_u c_u P^{\\min}_u y_{u,t}$.\n        2.  The remaining load to be served is $D''_{t} = D'_t - P^{\\min}_{\\text{total}, t}$.\n        3.  This remaining load $D''_{t}$ is met by increasing the output of committed units in ascending order of their variable cost (merit order), up to their maximum capacity.\n            - Unit 2 is dispatched first, providing generation $\\Delta g_{2,t} = \\min(D''_{t}, P^{\\max}_2 y_{2,t} - P^{\\min}_2 y_{2,t})$.\n            - If load still remains ($D''_{t} - \\Delta g_{2,t}  0$), Unit 1 is dispatched to cover the rest: $\\Delta g_{1,t} = \\min(D''_{t} - \\Delta g_{2,t}, P^{\\max}_1 y_{1,t} - P^{\\min}_1 y_{1,t})$.\n        4.  The total variable cost for the period is the sum of costs from minimum and incremental dispatch. The total generation for each unit is $g_{u,t} = P^{\\min}_u y_{u,t} + \\Delta g_{u,t}$.\n\nThe sum of fixed, startup, and variable costs over all three periods gives the total cost for the schedule pair.\n\n**Step 4: Finding the Global Minimum**\nThe minimum total cost found across all feasible (hydro, thermal) schedule pairs is the optimal solution for the given case. If no feasible hydro-schedule exists, or if for every feasible hydro-schedule, no thermal schedule can satisfy the demand, the problem is infeasible, and the minimum cost is taken as infinity. This occurs in Case 2, where reservoir and demand constraints create an infeasible problem description.\n\nThis procedure is systematically applied to each of the three test cases to determine their respective minimum operating costs.",
            "answer": "```python\nimport numpy as np\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the Hydro-Thermal Coordination problem for three test cases\n    using exhaustive enumeration.\n    \"\"\"\n    \n    # Common parameters for all cases\n    thermal_units = [\n        {'P_min': 10, 'P_max': 50, 'c': 30, 'F': 100, 'SU': 60},  # Unit 1\n        {'P_min': 0, 'P_max': 40, 'c': 22, 'F': 80, 'SU': 40},   # Unit 2\n    ]\n    # Units sorted by variable cost for merit-order dispatch\n    sorted_thermal_units = sorted(enumerate(thermal_units), key=lambda x: x[1]['c'])\n\n    hydro_params = {\n        'eta': 2,\n        'delta_r': 5,\n        'R_max': 15,\n    }\n    \n    # Define test cases\n    test_cases = [\n        {\n            'D': [50, 40, 60],\n            'inflows': [5, 5, 5],\n            'v0': 20,\n            'v_min': 0,\n            'v_max': 40,\n            'v_target': 15,\n        },\n        {\n            'D': [20, 20, 20],\n            'inflows': [10, 10, 10],\n            'v0': 40,\n            'v_min': 0,\n            'v_max': 40,\n            'v_target': 35,\n        },\n        {\n            'D': [70, 70, 70],\n            'inflows': [3, 3, 3],\n            'v0': 16,\n            'v_min': 0,\n            'v_max': 40,\n            'v_target': 10,\n        },\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # Step 1: Generate and filter feasible hydro schedules\n        possible_releases = list(range(0, hydro_params['R_max'] + 1, hydro_params['delta_r']))\n        all_r_sequences = itertools.product(possible_releases, repeat=3)\n        \n        feasible_r_sequences = []\n        \n        total_inflow = sum(case['inflows'])\n        required_total_release = case['v0'] + total_inflow - case['v_target']\n\n        for r_seq in all_r_sequences:\n            if sum(r_seq) != required_total_release:\n                continue\n\n            v = case['v0']\n            is_feasible = True\n            for t in range(3):\n                # Check hydro generation vs demand\n                h_t = hydro_params['eta'] * r_seq[t]\n                if h_t > case['D'][t]:\n                    is_feasible = False\n                    break\n                \n                # Check reservoir volume bounds\n                v = v + case['inflows'][t] - r_seq[t]\n                if not (case['v_min'] = v = case['v_max']):\n                    is_feasible = False\n                    break\n            \n            if is_feasible:\n                feasible_r_sequences.append(r_seq)\n\n        # Step 2: Generate thermal commitment schedules\n        # A state is (y_1, y_2), 4 possibilities. 3 periods. 4^3 = 64 schedules.\n        period_commitment_states = list(itertools.product([0, 1], repeat=2))\n        all_y_schedules = list(itertools.product(period_commitment_states, repeat=3))\n\n        min_total_cost = np.inf\n\n        # Step 3  4: Evaluate all pairs and find minimum cost\n        for r_seq in feasible_r_sequences:\n            for y_sched in all_y_schedules:\n                current_total_cost = 0.0\n                is_dispatch_feasible = True\n                \n                # Calculate fixed and startup costs\n                y_prev = (0, 0)\n                for t in range(3):\n                    y_curr = y_sched[t]\n                    for u in range(2):\n                        # Fixed cost\n                        current_total_cost += thermal_units[u]['F'] * y_curr[u]\n                        # Startup cost\n                        startup = max(0, y_curr[u] - y_prev[u])\n                        current_total_cost += thermal_units[u]['SU'] * startup\n                    y_prev = y_curr\n\n                # Calculate variable cost per period\n                variable_cost = 0.0\n                for t in range(3):\n                    h_t = hydro_params['eta'] * r_seq[t]\n                    residual_demand = case['D'][t] - h_t\n                    \n                    y_t = y_sched[t]\n                    \n                    p_min_total = sum(thermal_units[u]['P_min'] * y_t[u] for u in range(2))\n                    p_max_total = sum(thermal_units[u]['P_max'] * y_t[u] for u in range(2))\n\n                    if not (p_min_total = residual_demand = p_max_total):\n                        is_dispatch_feasible = False\n                        break\n\n                    # Economic dispatch\n                    period_var_cost = 0.0\n                    load_to_dispatch = residual_demand\n                    \n                    # Dispatch minimum generation\n                    for u in range(2):\n                        if y_t[u] == 1:\n                            min_gen = thermal_units[u]['P_min']\n                            period_var_cost += min_gen * thermal_units[u]['c']\n                            load_to_dispatch -= min_gen\n\n                    # Dispatch remaining load in merit order\n                    for u_idx, unit in sorted_thermal_units:\n                        if y_t[u_idx] == 1:\n                            available_capacity = unit['P_max'] - unit['P_min']\n                            gen_increase = min(load_to_dispatch, available_capacity)\n                            \n                            period_var_cost += gen_increase * unit['c']\n                            load_to_dispatch -= gen_increase\n                    \n                    variable_cost += period_var_cost\n\n                if is_dispatch_feasible:\n                    current_total_cost += variable_cost\n                    min_total_cost = min(min_total_cost, current_total_cost)\n\n        results.append(min_total_cost)\n\n    # Format output\n    formatted_results = [f\"{cost:.2f}\" for cost in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The most significant challenge in hydro scheduling is uncertainty, especially regarding future water inflows. This requires moving from deterministic optimization to a stochastic framework. This exercise  introduces you to Stochastic Dual Dynamic Programming (SDDP), the benchmark algorithm for solving multi-stage stochastic hydro-thermal problems. By implementing a single forward and backward pass, you will build a foundational understanding of how SDDP approximates the value of future uncertainty and generates \"cuts\" that inform optimal water usage in the present.",
            "id": "4095233",
            "problem": "Consider a two-stage hydro-thermal coordination problem formulated for one iteration of Stochastic Dual Dynamic Programming (SDDP). The decision variables at each stage are the hydro release $r_t$, thermal generation $g_t$, spillage $s_t$, and storage $v_t$, each constrained to be nonnegative. The hydroelectric conversion is modeled by a constant factor $\\alpha$ so that hydro energy produced equals $\\alpha r_t$. Thermal generation has linear cost $c g_t$. The reservoir dynamics follow mass balance, and there are upper bounds on reservoir storage $V_{\\max}$ and on the hydro release $R_{\\max}$. All quantities are expressed in normalized units without physical dimensions. The uncertainty is in the stage-$2$ inflow and demand, with two equally likely scenarios (probability $0.5$ each). The stage-$1$ inflow and demand are deterministic. The objective is to perform a single SDDP iteration that consists of a forward pass to determine stage-$1$ decisions using the current cost-to-go approximation for stage-$2$ (initialized to zero), and a backward pass to compute one affine lower bound (a \"cut\") for the expected stage-$2$ cost-to-go at the storage $v_1$ reached in the forward pass.\n\nFundamental base:\n- Reservoir mass balance: for stage $t \\in \\{1,2\\}$, $v_t = v_{t-1} + I_t - r_t - s_t$, where $I_t$ is the inflow (scenario-dependent at stage $2$ and deterministic at stage $1$).\n- Demand balance: $g_t + \\alpha r_t \\ge D_t$.\n- Bounds: $0 \\le r_t \\le R_{\\max}$, $0 \\le v_t \\le V_{\\max}$, $s_t \\ge 0$, $g_t \\ge 0$.\n- Bellman optimality principle: the stage-$1$ problem minimizes immediate thermal cost plus the current approximation of the expected future cost; the stage-$2$ problem minimizes immediate thermal cost (no terminal value).\n- Convexity and duality: the expected stage-$2$ cost-to-go as a function of $v_1$ is convex and piecewise linear under linear constraints and costs. An affine lower bound (\"cut\") at $v_1$ is defined by a subgradient $a$ and intercept $b$ such that $\\widehat{J}_2(v) \\ge a v + b$ and $\\widehat{J}_2(v_1) = a v_1 + b$, where $\\widehat{J}_2$ is the expected optimal stage-$2$ cost.\n\nForward pass specification:\n- Use the current stage-$2$ cost-to-go approximation $\\widehat{J}_2(v) \\equiv 0$.\n- The forward stage-$1$ problem minimizes $c g_1$ subject to the constraints stated. If multiple minimizers exist, select the one with the smallest hydro release $r_1$.\n\nBackward pass specification:\n- At the visited storage $v_1$, solve both stage-$2$ scenario subproblems exactly to compute their optimal costs and then the expected cost $\\mathbb{E}[J_2(v_1)]$.\n- Compute one valid subgradient $a$ of the expected cost-to-go at $v_1$ by averaging scenario subgradients. For each scenario, the subgradient with respect to $v_1$ is $-c \\alpha$ when additional storage directly allows replacing thermal generation (that is, when $v_1 + I_2$ is strictly below the binding threshold $\\min(R_{\\max}, D_2/\\alpha)$), and $0$ otherwise. In the strict equality case, choose the subgradient $0$.\n- Set the cut intercept $b$ so that the cut passes through the expected cost at $v_1$, namely $b = \\mathbb{E}[J_2(v_1)] - a v_1$.\n\nYour program must implement this single SDDP iteration deterministically and output, for each test case, the list $[C_1, r_1, g_1, v_1, a, b]$, where $C_1$ is the forward pass stage-$1$ immediate cost $c g_1$, $r_1$ is the forward hydro release, $g_1$ is the forward thermal generation, $v_1$ is the storage after stage $1$, $a$ is the backward cut slope, and $b$ is the backward cut intercept. All quantities should be computed exactly in the normalized units given.\n\nTest suite:\n- Case $1$ (general \"happy path\" with thermal use in stage $2$): $\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 100$, $R_{\\max} = 40$, $v_0 = 30$, $I_1 = 20$, $D_1 = 50$, scenario $A$: $I_2^{(A)} = 15$, $D_2^{(A)} = 40$, scenario $B$: $I_2^{(B)} = 5$, $D_2^{(B)} = 40$.\n- Case $2$ (hydro suffices fully at stage $2$): $\\alpha = 1.0$, $c = 10.0$, $V_{\\max} = 200$, $R_{\\max} = 100$, $v_0 = 150$, $I_1 = 10$, $D_1 = 20$, scenario $A$: $I_2^{(A)} = 20$, $D_2^{(A)} = 100$, scenario $B$: $I_2^{(B)} = 70$, $D_2^{(B)} = 100$.\n- Case $3$ (mixed slope across scenarios): $\\alpha = 1.0$, $c = 20.0$, $V_{\\max} = 120$, $R_{\\max} = 30$, $v_0 = 40$, $I_1 = 15$, $D_1 = 30$, scenario $A$: $I_2^{(A)} = 4$, $D_2^{(A)} = 60$, scenario $B$: $I_2^{(B)} = 10$, $D_2^{(B)} = 25$.\n- Case $4$ (stage-$1$ spillage boundary): $\\alpha = 1.0$, $c = 5.0$, $V_{\\max} = 50$, $R_{\\max} = 10$, $v_0 = 45$, $I_1 = 20$, $D_1 = 5$, scenario $A$: $I_2^{(A)} = 5$, $D_2^{(A)} = 40$, scenario $B$: $I_2^{(B)} = 0$, $D_2^{(B)} = 8$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of the four case results, each result itself being a list $[C_1, r_1, g_1, v_1, a, b]$. The output must be formatted as a comma-separated list enclosed in square brackets, for example, $[[\\dots],[\\dots],[\\dots],[\\dots]]$. No other text should be printed.",
            "solution": "The problem is a well-defined two-stage stochastic optimization problem in the context of hydro-thermal power system scheduling. It requests a single iteration of the Stochastic Dual Dynamic Programming (SDDP) algorithm. The problem is scientifically sound, self-contained, and all data and constraints are provided. The validation is successful and we may proceed with the solution.\n\nThe solution process involves two main passes: a forward pass to determine the first-stage decisions and a backward pass to generate a new Benders cut (an affine lower bound on the expected future cost function).\n\n### Forward Pass: Stage 1\n\nThe objective in the first stage is to minimize the immediate operational cost plus the expected future cost. For this single iteration, the expected future cost function, $\\widehat{J}_2(v_1)$, is approximated as zero for all values of the final storage $v_1$.\nThe stage-1 problem is thus:\n$$ \\min_{r_1, g_1, s_1, v_1} c g_1 $$\nsubject to the constraints:\n1.  Demand balance: $g_1 + \\alpha r_1 \\ge D_1$\n2.  Reservoir mass balance: $v_1 = v_0 + I_1 - r_1 - s_1$\n3.  Decision variable bounds: $0 \\le r_1 \\le R_{\\max}$, $0 \\le v_1 \\le V_{\\max}$, $s_1 \\ge 0$, $g_1 \\ge 0$.\n\nSince the thermal cost coefficient $c$ is positive, minimizing $c g_1$ is equivalent to minimizing the thermal generation $g_1$. From the demand balance constraint, $g_1 \\ge D_1 - \\alpha r_1$. As $g_1$ must be non-negative, this can be written as $g_1 = \\max(0, D_1 - \\alpha r_1)$. To minimize $g_1$, we must maximize the hydro release $r_1$.\n\nHowever, the problem specifies a tie-breaking rule: if multiple solutions yield the same minimum cost, the one with the smallest hydro release $r_1$ must be chosen. This leads to the following logic for determining the optimal stage-1 release, $r_1$:\n\n1.  **Determine if demand can be met by hydro alone.** This is possible if there exists a feasible release $r_1$ such that $\\alpha r_1 \\ge D_1$, or $r_1 \\ge D_1/\\alpha$. A release $r_1$ is feasible if it respects the physical limits of the system. The maximum possible release, $r_{1, \\text{max\\_feasible}}$, is constrained by the turbine capacity $R_{\\max}$ and the total water available in the reservoir, $v_0 + I_1$. Thus, $r_{1, \\text{max\\_feasible}} = \\min(R_{\\max}, v_0 + I_1)$.\n\n2.  **Select optimal release $r_1$**:\n    *   If meeting demand with hydro is feasible (i.e., $D_1/\\alpha \\le r_{1, \\text{max\\_feasible}}$), any release $r_1 \\in [D_1/\\alpha, r_{1, \\text{max\\_feasible}}]$ results in $g_1 = 0$, the minimum possible thermal generation. According to the tie-breaking rule, we must select the smallest such release, so we set $r_1 = D_1/\\alpha$.\n    *   If demand cannot be fully met by hydro ($D_1/\\alpha  r_{1, \\text{max\\_feasible}}$), then $g_1 = D_1 - \\alpha r_1  0$ for all feasible $r_1$. To minimize $g_1$, we must maximize $r_1$. The unique maximizer is $r_1 = r_{1, \\text{max\\_feasible}}$.\n\n3.  **Determine other stage-1 variables**:\n    *   Thermal generation is $g_1 = \\max(0, D_1 - \\alpha r_1)$. The immediate cost is $C_1 = c g_1$.\n    *   The end-of-stage storage $v_1$ and spillage $s_1$ must satisfy $v_1 + s_1 = v_0 + I_1 - r_1$. Since the future cost function is zero, there is no explicit incentive to store water. We adopt the standard operational practice of minimizing spillage, which is equivalent to maximizing the end-of-stage storage $v_1$. The potential storage is $v'_1 = v_0 + I_1 - r_1$.\n        *   If $v'_1  V_{\\max}$, the reservoir is full. Thus, $v_1 = V_{\\max}$ and spillage $s_1 = v'_1 - V_{\\max}$.\n        *   If $0 \\le v'_1 \\le V_{\\max}$, we can store all remaining water. Thus, $v_1 = v'_1$ and $s_1 = 0$.\n\nThis procedure uniquely determines all stage-1 decision variables: $[C_1, r_1, g_1, v_1]$.\n\n### Backward Pass: Stage 2\n\nThe backward pass computes a Benders cut (an affine function) that lower-bounds the true expected future cost function, $\\mathbb{E}[J_2(v_1)]$. The cut is of the form $\\mathbb{E}[J_2(v)] \\ge a v + b$, and it is constructed to be exact at the point $v_1$ visited in the forward pass.\n\nFor each stage-2 scenario $s \\in \\{A, B\\}$, we must solve the following deterministic subproblem to find the optimal cost $J_2(v_1, s)$:\n$$ J_2(v_1, s) = \\min_{r_2, g_2, s_2, v_2} c g_2^{(s)} $$\nsubject to stage-2 constraints, given the starting storage $v_1$.\n\n1.  **Solve Scenario Subproblems**: The objective is to minimize $c g_2^{(s)}$, which again implies maximizing the hydro release $r_2^{(s)}$. The maximum feasible release is $r_{2, \\text{max\\_feasible}}^{(s)} = \\min(R_{\\max}, v_1 + I_2^{(s)})$.\n    *   The optimal release is $r_2^{(s)} = r_{2, \\text{max\\_feasible}}^{(s)}$.\n    *   The optimal thermal generation is $g_2^{(s)} = \\max(0, D_2^{(s)} - \\alpha r_2^{(s)})$.\n    *   The cost for scenario $s$ is $J_2(v_1, s) = c g_2^{(s)}$.\n\n2.  **Compute the Expected Cost**: With scenarios being equally likely (probability $p=0.5$), the expected cost is $\\mathbb{E}[J_2(v_1)] = 0.5 \\cdot J_2(v_1, A) + 0.5 \\cdot J_2(v_1, B)$.\n\n3.  **Compute the Cut Slope (Subgradient)**: The slope $a$ of the cut is the expected value of the scenario subgradients. A subgradient $a^{(s)}$ of $J_2(v_1, s)$ with respect to $v_1$ represents the marginal value of water. An additional unit of water reduces cost by $c\\alpha$ if it can be used to displace thermal generation. This is possible only if the system has both remaining turbine capacity and unmet demand that can be served by hydro.\n    The problem specifies the formula:\n    $$ a^{(s)} = \\begin{cases} -c \\alpha  \\text{if } v_1 + I_2^{(s)}  \\min(R_{\\max}, D_2^{(s)}/\\alpha) \\\\ 0  \\text{otherwise} \\end{cases} $$\n    This condition checks if the total water available, $v_1 + I_2^{(s)}$, is less than the amount that can be usefully released through the turbines. If it is less, marginal water has a value of $c\\alpha$, and the subgradient is $-c\\alpha$. Otherwise, the marginal water has zero value for the current stage, and the subgradient is $0$.\n    The overall slope is the expectation: $a = 0.5 \\cdot a^{(A)} + 0.5 \\cdot a^{(B)}$.\n\n4.  **Compute the Cut Intercept**: The intercept $b$ is chosen so that the affine function is exact at $v_1$: $\\mathbb{E}[J_2(v_1)] = a v_1 + b$. This gives $b = \\mathbb{E}[J_2(v_1)] - a v_1$.\n\nThis procedure determines the cut parameters $[a, b]$, completing the single SDDP iteration. The algorithm is implemented for each test case to produce the required output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the given hydro-thermal coordination problem for all test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case 1: alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B\n        (1.0, 10.0, 100.0, 40.0, 30.0, 20.0, 50.0, 15.0, 40.0, 5.0, 40.0),\n        # Case 2\n        (1.0, 10.0, 200.0, 100.0, 150.0, 10.0, 20.0, 20.0, 100.0, 70.0, 100.0),\n        # Case 3\n        (1.0, 20.0, 120.0, 30.0, 40.0, 15.0, 30.0, 4.0, 60.0, 10.0, 25.0),\n        # Case 4\n        (1.0, 5.0, 50.0, 10.0, 45.0, 20.0, 5.0, 5.0, 40.0, 0.0, 8.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_sddp_iteration(case)\n        results.append(result)\n\n    # Format the final output string exactly as required.\n    # e.g., \"[[C1,r1,...],[C1,r1,...]]\"\n    results_as_strings = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output = f\"[{','.join(results_as_strings)}]\"\n    print(final_output)\n\ndef run_sddp_iteration(params):\n    \"\"\"\n    Performs a single SDDP iteration (forward and backward pass) for one test case.\n\n    Args:\n        params (tuple): A tuple containing all parameters for the test case.\n\n    Returns:\n        list: A list of the calculated values [C1, r1, g1, v1, a, b].\n    \"\"\"\n    alpha, c, V_max, R_max, v0, I1, D1, I2A, D2A, I2B, D2B = params\n\n    # FORWARD PASS (Stage 1)\n    \n    # Water available in stage 1\n    water_available_1 = v0 + I1\n    \n    # Release required to meet demand D1 with hydro only\n    r_target = D1 / alpha\n    \n    # Maximum feasible release in stage 1\n    r_max_feasible = min(R_max, water_available_1)\n\n    r1, g1 = 0.0, 0.0\n    if r_target = r_max_feasible:\n        # Minimum cost (g1=0) is achievable. By tie-breaking rule, use smallest r1.\n        r1 = r_target\n        g1 = 0.0\n    else:\n        # Minimum cost requires maximizing r1, as g1 > 0.\n        r1 = r_max_feasible\n        g1 = D1 - alpha * r1\n\n    C1 = c * g1\n\n    # Determine end-of-stage storage v1 by maximizing storage (minimizing spillage)\n    v_potential = v0 + I1 - r1\n    v1 = 0.0\n    if v_potential > V_max:\n        v1 = V_max\n    else:\n        v1 = v_potential\n\n    # BACKWARD PASS (Stage 2)\n    \n    # Scenario A\n    water_available_2A = v1 + I2A\n    r2_opt_A = min(R_max, water_available_2A)\n    g2_A = max(0.0, D2A - alpha * r2_opt_A)\n    cost_A = c * g2_A\n    \n    threshold_A = min(R_max, D2A / alpha)\n    slope_A = -c * alpha if (v1 + I2A)  threshold_A else 0.0\n\n    # Scenario B\n    water_available_2B = v1 + I2B\n    r2_opt_B = min(R_max, water_available_2B)\n    g2_B = max(0.0, D2B - alpha * r2_opt_B)\n    cost_B = c * g2_B\n\n    threshold_B = min(R_max, D2B / alpha)\n    slope_B = -c * alpha if (v1 + I2B)  threshold_B else 0.0\n\n    # Calculate the Benders cut parameters (a, b)\n    # The scenarios have equal probability of 0.5\n    expected_future_cost = 0.5 * cost_A + 0.5 * cost_B\n    a = 0.5 * slope_A + 0.5 * slope_B\n    b = expected_future_cost - a * v1\n    \n    return [C1, r1, g1, v1, a, b]\n\nsolve()\n```"
        }
    ]
}