{
    "hands_on_practices": [
        {
            "introduction": "Every energy project evaluation begins with the fundamental principle of the time value of money. This exercise challenges you to derive the total present value of a project from first principles, combining an initial capital outlay with a series of future operating costs. Mastering this derivation ensures you understand the foundational mathematics behind more complex metrics like the Levelized Cost of Energy (LCOE) and can critically assess the financial viability of any long-term investment .",
            "id": "4075157",
            "problem": "An integrated energy system developer is evaluating a project with an upfront capital expenditure and recurring Operations and Maintenance (O&M) costs. The developer commits an upfront capital cost of $K$ at time $t=0$ and expects to pay a constant annual O&M cost of $c$ at the end of each year for $N$ years. Assume time is measured in years, the discount rate is a constant $r$ per year with discrete compounding, and $r > 0$. Operations and Maintenance (O&M) refers to all recurring costs necessary to operate and maintain the asset over its service life.\n\nStarting only from the fundamental time value of money principle that one unit of currency today grows deterministically to $(1+r)$ units in one year under discrete compounding, and from the definition of present value as the amount at $t=0$ that is financially equivalent to a future payment under the same discounting convention, derive the present value at $t=0$ of the combined cash flow consisting of the upfront capital cost and the $N$ end-of-year O&M payments. Clearly state and justify each step in your derivation, including any summations and transformations you use.\n\nExpress your final answer as a single closed-form analytic expression in terms of $K$, $c$, $N$, and $r$. The result should be in the same currency units as $K$ and $c$. No numerical rounding is required.",
            "solution": "The problem statement is evaluated for validity prior to any attempt at a solution.\n\n### Step 1: Extract Givens\n- Upfront capital cost: $K$ at time $t=0$.\n- Annual Operations and Maintenance (O&M) cost: $c$, paid at the end of each year for $N$ years.\n- Time is measured in years.\n- Discount rate: constant $r$ per year, with discrete compounding.\n- Condition on the discount rate: $r > 0$.\n- Fundamental principle: One unit of currency today grows to $(1+r)$ units in one year.\n- Definition of present value: The amount at $t=0$ that is financially equivalent to a future payment.\n- Objective: Derive the present value at $t=0$ of the combined cash flow stream.\n- Required output format: A single closed-form analytic expression in terms of $K$, $c$, $N$, and $r$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed based on the specified criteria.\n- **Scientifically Grounded:** The problem is rooted in the fundamental principles of financial mathematics and engineering economics, specifically the time value of money, present value calculation, and annuities. These concepts are well-established and rigorously defined.\n- **Well-Posed:** All variables ($K$, $c$, $N$, $r$) are clearly defined, and the constraints (e.g., $r>0$) are sufficient to ensure a unique, stable, and meaningful solution exists. The task to derive the result from first principles is a standard and unambiguous academic exercise.\n- **Objective:** The language is formal, precise, and devoid of subjective or opinion-based content. Terms like \"present value\" and \"discount rate\" have universally accepted meanings in this context.\n- **Incomplete or Contradictory Setup:** The problem is self-contained. It provides all necessary information and definitions for the derivation. There are no internal contradictions.\n- **Unrealistic or Infeasible:** The scenario represents a standard capital budgeting problem common in energy systems modeling and other engineering fields. The use of symbolic variables avoids any concerns about unrealistic numerical data.\n\n### Step 3: Verdict and Action\nThe problem is **valid** as it is scientifically sound, well-posed, objective, and complete. A full derivation can proceed.\n\nThe objective is to find the total present value, denoted as $PV_{\\text{total}}$, of all cash outflows associated with the project. The total cash flow is composed of two distinct components: the upfront capital cost and the stream of annual O&M costs. The total present value is the sum of the present values of these two components.\n\n$PV_{\\text{total}} = PV_{\\text{capital}} + PV_{\\text{O&M}}$\n\nFirst, we determine the present value of the upfront capital cost, $PV_{\\text{capital}}$.\nThe capital cost $K$ is incurred at time $t=0$. According to the provided definition, the present value of a payment is its equivalent value at $t=0$. For a payment already at $t=0$, its present value is the amount of the payment itself.\nTherefore,\n$$PV_{\\text{capital}} = K$$\n\nNext, we derive the present value of the stream of $N$ annual O&M payments, $PV_{\\text{O&M}}$.\nThe problem states that a constant cost $c$ is incurred at the end of each year for $N$ years. This means payments of $c$ occur at times $t=1, 2, 3, \\ldots, N$. This stream of payments constitutes an ordinary annuity.\n\nFrom the fundamental principle provided, a present amount $PV$ grows to a future value $FV$ in $k$ years according to the relationship $FV = PV(1+r)^k$. Rearranging this equation to find the present value of a single future payment $C_k$ made at time $k$ gives:\n$$PV_k = \\frac{C_k}{(1+r)^k} = C_k (1+r)^{-k}$$\n\nTo find the total present value of the entire O&M cost stream, we must sum the present values of each individual payment from $k=1$ to $k=N$.\n$$PV_{\\text{O&M}} = \\sum_{k=1}^{N} c (1+r)^{-k}$$\n\nSince $c$ is a constant annual cost, it can be factored out of the summation:\n$$PV_{\\text{O&M}} = c \\sum_{k=1}^{N} (1+r)^{-k}$$\n\nThe summation is a finite geometric series. Let the common ratio of the series be $q = (1+r)^{-1}$. The sum can be written as:\n$$S_N = \\sum_{k=1}^{N} q^k = q^1 + q^2 + q^3 + \\dots + q^N$$\n\nTo find a closed-form expression for this sum, we can use the standard method. We write out the sum $S_N$:\n$$S_N = q + q^2 + \\dots + q^N$$\nMultiply by the common ratio $q$:\n$$qS_N = q^2 + q^3 + \\dots + q^{N+1}$$\nSubtract the second equation from the first:\n$$S_N - qS_N = (q + q^2 + \\dots + q^N) - (q^2 + q^3 + \\dots + q^{N+1})$$\n$$S_N(1-q) = q - q^{N+1} = q(1-q^N)$$\nSince the problem states $r > 0$, we have $1+r > 1$, which implies $0  q  1$. Thus, $q \\neq 1$ and the term $(1-q)$ is non-zero, allowing us to divide by it.\n$$S_N = \\frac{q(1-q^N)}{1-q}$$\n\nNow, we substitute $q = (1+r)^{-1}$ back into this expression.\nThe numerator term is $q(1-q^N) = (1+r)^{-1} (1 - (1+r)^{-N})$.\nThe denominator term is $1-q = 1 - (1+r)^{-1} = 1 - \\frac{1}{1+r} = \\frac{1+r-1}{1+r} = \\frac{r}{1+r}$.\n\nCombining these results:\n$$S_N = \\frac{(1+r)^{-1} (1 - (1+r)^{-N})}{\\frac{r}{1+r}} = \\frac{\\frac{1}{1+r} (1 - (1+r)^{-N})}{\\frac{r}{1+r}}$$\nMultiplying the numerator and denominator by $(1+r)$ cancels the term, yielding:\n$$S_N = \\frac{1 - (1+r)^{-N}}{r}$$\n\nNow, we can find $PV_{\\text{OM}}$ by substituting this closed-form sum back into our expression for $PV_{\\text{OM}}$:\n$$PV_{\\text{OM}} = c \\cdot S_N = c \\left[ \\frac{1 - (1+r)^{-N}}{r} \\right]$$\n\nFinally, we combine the present values of the capital and OM costs to find the total present value.\n$$PV_{\\text{total}} = PV_{\\text{capital}} + PV_{\\text{OM}}$$\n$$PV_{\\text{total}} = K + c \\frac{1 - (1+r)^{-N}}{r}$$\n\nThis is the final closed-form analytic expression for the present value at $t=0$ of the specified cash flows, derived from the fundamental principles as required.",
            "answer": "$$\\boxed{K + c \\frac{1 - (1+r)^{-N}}{r}}$$"
        },
        {
            "introduction": "While long-term valuation provides a project's overall financial picture, understanding its short-term operational cost structure is critical for efficient system operation. This practice delves into the granular costs of a thermal generating unit, requiring you to calculate total expenses based on its hourly commitment schedule, power output, and start-up conditions. By carefully tracking variable, no-load, and state-dependent start-up costs, you will gain practical experience in modeling the complex economic behavior essential for unit commitment and dispatch optimization .",
            "id": "4075196",
            "problem": "A single thermal generating unit participates in an hourly unit commitment over a horizon of $12$ consecutive hours, indexed by $t \\in \\{1,2,\\dots,12\\}$. Each hour has duration $\\Delta t = 1$ hour. The unit’s operating cost structure comprises three components grounded in standard power system operations definitions: a variable Operation and Maintenance (variable OM) cost proportional to energy produced, a fixed no-load cost incurred per hour when synchronized (committed), and a start-up cost incurred upon each transition from off to on that depends on the immediately preceding continuous off duration length.\n\nAssume the following fundamentals:\n- The energy produced in hour $t$ is $E_t = P_t \\Delta t$, where the electrical power output is $P_t$ in megawatts (MW) and energy is $E_t$ in megawatt-hours (MWh).\n- The variable OM cost per unit energy is constant and equal to $c_v = \\$9.5/\\text{MWh}$.\n- The no-load cost per hour when the unit is committed (synchronized) is $c_{nl} = \\$600/\\text{h}$.\n- The start-up cost depends on the immediately preceding continuous off duration $d$ (in hours) as follows:\n  - Hot start if $d \\le 2$: cost $C_h = \\$5,000$.\n  - Warm start if $2  d \\le 6$: cost $C_w = \\$12,000$.\n  - Cold start if $d  6$: cost $C_c = \\$25,000$.\n\nThe unit’s binary commitment status $u_t \\in \\{0,1\\}$ and hourly power output $P_t$ are given for each hour. Immediately prior to hour $t=1$, the unit has been continuously off for $6$ hours. The hourly schedule is:\n- Hour $t=1$: $u_1=0$, $P_1=0$.\n- Hour $t=2$: $u_2=0$, $P_2=0$.\n- Hour $t=3$: $u_3=1$, $P_3=120$.\n- Hour $t=4$: $u_4=1$, $P_4=180$.\n- Hour $t=5$: $u_5=1$, $P_5=220$.\n- Hour $t=6$: $u_6=0$, $P_6=0$.\n- Hour $t=7$: $u_7=0$, $P_7=0$.\n- Hour $t=8$: $u_8=1$, $P_8=150$.\n- Hour $t=9$: $u_9=1$, $P_9=130$.\n- Hour $t=10$: $u_{10}=1$, $P_{10}=170$.\n- Hour $t=11$: $u_{11}=0$, $P_{11}=0$.\n- Hour $t=12$: $u_{12}=1$, $P_{12}=160$.\n\nStarting from the above core definitions of energy and cost contributions, determine the total operating cost over the $12$-hour horizon as the sum of hourly variable OM costs, hourly no-load costs, and start-up costs triggered at off-to-on transitions. Express the final total cost in United States Dollars (USD) and round your answer to four significant figures.",
            "solution": "The operating cost is composed of three terms derived from the fundamental definitions:\n\n1. Variable Operation and Maintenance (OM) cost arises from produced energy. With energy per hour given by $E_t = P_t \\Delta t$ and constant variable OM rate $c_v$, the hourly variable cost is $c_v E_t = c_v P_t \\Delta t$. Over the horizon,\n$$\nC_{\\text{var}} = \\sum_{t=1}^{12} c_v P_t \\Delta t.\n$$\n\n2. No-load cost is incurred for each hour the unit is synchronized (committed). With hourly no-load cost $c_{nl}$ and binary commitment $u_t$,\n$$\nC_{\\text{nl}} = \\sum_{t=1}^{12} c_{nl} u_t.\n$$\n\n3. Start-up cost is incurred at transitions from off to on, characterized by a start indicator $s_t$ and the preceding continuous off duration $d_t$. Define\n$$\ns_t = \\begin{cases}\n1,  \\text{if } u_{t-1} = 0 \\text{ and } u_t = 1,\\\\\n0,  \\text{otherwise},\n\\end{cases}\n$$\nwith $u_0$ understood through the stated prehistory. The immediately preceding continuous off duration $d_t$ counts the number of consecutive hours the unit was off prior to $t$. The start-up cost map $C_{SU}(d)$ is defined by:\n$$\nC_{SU}(d) = \\begin{cases}\nC_h,  d \\le 2,\\\\\nC_w,  2  d \\le 6,\\\\\nC_c,  d  6.\n\\end{cases}\n$$\nThus the total start-up cost is\n$$\nC_{\\text{su}} = \\sum_{t=1}^{12} C_{SU}(d_t) s_t.\n$$\n\nThe total operating cost is the sum:\n$$\nC_{\\text{tot}} = C_{\\text{var}} + C_{\\text{nl}} + C_{\\text{su}}.\n$$\n\nWe now evaluate each component using the provided schedule and parameters, substituting numerical values only at the final step.\n\nFirst, identify start-ups and their duration $d_t$:\n- Prehistory: immediately prior to $t=1$, the unit was off for $6$ hours. Then $u_1=0$ and $u_2=0$, so before $t=3$ the unit has been off continuously for $6 + 2 = 8$ hours. Therefore $s_3=1$ and $d_3=8$, which implies a cold start: $C_{SU}(d_3) = C_c$.\n- Between $t=5$ ($u_5=1$) and $t=8$ ($u_8=1$), the unit is off at $t=6$ and $t=7$. Therefore prior to $t=8$, $d_8=2$, $s_8=1$, which is a hot start: $C_{SU}(d_8) = C_h$.\n- Between $t=10$ ($u_{10}=1$) and $t=12$ ($u_{12}=1$), the unit is off at $t=11$. Therefore prior to $t=12$, $d_{12}=1$, $s_{12}=1$, which is a hot start: $C_{SU}(d_{12}) = C_h$.\nAll other hours have $s_t=0$.\n\nHence,\n$$\nC_{\\text{su}} = C_{SU}(d_3) s_3 + C_{SU}(d_8) s_8 + C_{SU}(d_{12}) s_{12} = C_c + C_h + C_h.\n$$\n\nNext, compute the variable OM cost. With $\\Delta t = 1$, $E_t = P_t$, so\n$$\nC_{\\text{var}} = c_v \\sum_{t=1}^{12} P_t.\n$$\nOnly hours with positive $P_t$ contribute: $t \\in \\{3,4,5,8,9,10,12\\}$ with $P_3=120$, $P_4=180$, $P_5=220$, $P_8=150$, $P_9=130$, $P_{10}=170$, $P_{12}=160$. Summing,\n$$\n\\sum_{t=1}^{12} P_t = 120 + 180 + 220 + 150 + 130 + 170 + 160 = 1{,}130.\n$$\nTherefore,\n$$\nC_{\\text{var}} = c_v \\times 1{,}130.\n$$\n\nThen compute the no-load cost. The unit is committed in hours $t \\in \\{3,4,5,8,9,10,12\\}$, for a total of $7$ hours. Hence,\n$$\nC_{\\text{nl}} = c_{nl} \\times 7.\n$$\n\nSubstitute the given numerical parameters $c_v = \\$9.5/\\text{MWh}$, $c_{nl} = \\$600/\\text{h}$, $C_h = \\$5,000$, $C_w = \\$12,000$, $C_c = \\$25,000$:\n- Variable OM:\n$$\nC_{\\text{var}} = \\$9.5 \\times 1{,}130 = \\$10,735.\n$$\n- No-load:\n$$\nC_{\\text{nl}} = \\$600 \\times 7 = \\$4,200.\n$$\n- Start-up:\n$$\nC_{\\text{su}} = \\$25,000 + \\$5,000 + \\$5,000 = \\$35,000.\n$$\n\nTotal operating cost:\n$$\nC_{\\text{tot}} = \\$10,735 + \\$4,200 + \\$35,000 = \\$49,935.\n$$\n\nRound to four significant figures. Writing in scientific notation to preserve significant figures,\n$$\n\\$49,935 \\approx \\$4.994 \\times 10^{4}\n$$\nto four significant figures.\n\nTherefore, the total operating cost over the $12$-hour horizon is $\\$4.994 \\times 10^{4}$ when rounded to four significant figures.",
            "answer": "$$\\boxed{4.994 \\times 10^{4}}$$"
        },
        {
            "introduction": "Real-world investment decisions are never made with perfect foresight; they must account for uncertainty in key variables like fuel price, demand, or, in this case, a generator's capacity factor. This capstone exercise requires you to synthesize capital and operating costs into the Levelized Cost of Energy (LCOE), analyze its sensitivity to uncertainty, and employ a sophisticated risk metric, Conditional Value at Risk (CVaR), to make a robust design choice. This practice bridges the gap between deterministic modeling and advanced, risk-aware decision analysis, a cornerstone of modern energy systems engineering .",
            "id": "4075220",
            "problem": "An engineer studies the sensitivity of Levelized Cost of Energy (LCOE) to uncertainty in Capacity Factor (CF) and seeks a principled way to select robust designs or hedging strategies for a generation asset. Begin from fundamental definitions to derive all required quantities and implement an algorithmic evaluation over a specified test suite.\n\nThe foundational base to use is the following set of definitions and assumptions:\n- Capacity Factor (CF) is defined as the ratio of average power output to nameplate capacity over a year. If nameplate capacity is $P$ in megawatts (MW) and the capacity factor is CF (dimensionless), then the annual energy produced is $E_{\\text{year}} = P \\cdot \\text{CF} \\cdot 8760$ in megawatt-hours (MWh).\n- Levelized Cost of Energy (LCOE) is the constant price per megawatt-hour such that the Net Present Value (NPV) of revenues equals the NPV of costs over the asset lifetime. Formally, LCOE is the price $L$ that satisfies the NPV equality of discounted cash flows.\n- The discount rate $r$ represents the Weighted Average Cost of Capital (WACC) and is assumed constant over time. Let the asset lifetime be $T$ years.\n- Total discounted costs comprise capital expenditure $K$ (paid at time zero), fixed Operations and Maintenance (OM) costs $F$ per year, and variable cost $v$ per megawatt-hour.\n- Assume the annual energy output is constant across years once CF is realized, and there is no degradation beyond what is captured by CF itself.\n\nTasks:\n1. From the NPV equality definition, derive a functional form $L(\\text{CF})$ for the LCOE in terms of $K$, $F$, $v$, $P$, CF, $T$, and $r$. The derivation must start from the cash flow NPV balance and the definition of annual energy output, without introducing any unmotivated shortcut formulas.\n2. Using the derived $L(\\text{CF})$, compute the sensitivity of LCOE to the capacity factor at a baseline $\\text{CF} = c_0$ by evaluating the derivative $\\frac{dL}{d\\text{CF}}\\big|_{\\text{CF}=c_0}$ and the elasticity $\\varepsilon = \\left(\\frac{dL}{d\\text{CF}}\\big|_{\\text{CF}=c_0}\\right) \\cdot \\left(\\frac{\\text{CF}}{L(\\text{CF})}\\right)\\big|_{\\text{CF}=c_0}$. Report $\\frac{dL}{d\\text{CF}}$ in United States Dollars per megawatt-hour per unit CF (USD/MWh per unit CF), and report $\\varepsilon$ as dimensionless.\n3. Model CF uncertainty as a discrete scenario distribution $\\{(CF_i, p_i)\\}$ with $\\sum_i p_i = 1$, where each scenario $CF_i$ has probability $p_i$. Compute the distribution of LCOE by evaluating $L(CF_i)$ at each scenario.\n4. Define the upper-tail Conditional Value at Risk (CVaR) at risk level $\\alpha$ for the LCOE distribution as the expected LCOE conditional on exceeding the $(1-\\alpha)$-quantile of the LCOE distribution. For a discrete distribution, implement CVaR by averaging the highest-cost tail of total probability mass $\\alpha$, allowing fractional inclusion of the boundary scenario if necessary.\n5. Consider two design options, A and B, each with its own parameters $(K, F, v)$ and its own discrete CF scenario distribution. For each test case, make a robust recommendation between A and B as follows:\n   - Compute the expected LCOE and upper-tail CVaR for each option.\n   - Let $\\tau$ be an admissible expected LCOE threshold in United States Dollars per megawatt-hour (USD/MWh).\n   - Among options whose expected LCOE is less than or equal to $\\tau$, select the option with the lower CVaR. If both options have equal CVaR to numerical tolerance, select the option with the lower expected LCOE.\n   - If neither option has expected LCOE less than or equal to $\\tau$, select the option with the lower expected LCOE.\n6. Your program must implement the above derivations and computations and produce, for each test case, the five-element list $[dL/dCF \\text{ at } c_0, \\varepsilon \\text{ at } c_0, \\text{CVaR}_A, \\text{CVaR}_B, \\text{recommendation}]$, where recommendation is $1$ if option B is recommended and $0$ otherwise. All LCOE-related quantities and sensitivities must be computed in United States Dollars per megawatt-hour (USD/MWh). Output floats as raw decimals (no units) and the recommendation as an integer.\n\nUse the following test suite with scientifically plausible parameters. All values must be interpreted in the specified units:\n- Test Case 1 (moderate solar-like asset):\n  - Shared parameters: $P = 100$ MW, $T = 25$ years, $r = 0.07$, baseline $c_0 = 0.22$, risk level $\\alpha = 0.10$, threshold $\\tau = 80$ USD/MWh.\n  - Option A: $K = 80{,}000{,}000$ USD, $F = 2{,}500{,}000$ USD/year, $v = 2$ USD/MWh, CF scenarios $\\{(0.18, 0.20), (0.22, 0.40), (0.26, 0.30), (0.30, 0.10)\\}$.\n  - Option B: $K = 95{,}000{,}000$ USD, $F = 3{,}000{,}000$ USD/year, $v = 1.5$ USD/MWh, CF scenarios $\\{(0.20, 0.10), (0.24, 0.50), (0.27, 0.30), (0.29, 0.10)\\}$.\n- Test Case 2 (wind-like asset with curtailment risk and higher discount rate):\n  - Shared parameters: $P = 200$ MW, $T = 20$ years, $r = 0.10$, baseline $c_0 = 0.25$, risk level $\\alpha = 0.10$, threshold $\\tau = 70$ USD/MWh.\n  - Option A: $K = 300{,}000{,}000$ USD, $F = 8{,}000{,}000$ USD/year, $v = 3$ USD/MWh, CF scenarios $\\{(0.10, 0.05), (0.25, 0.40), (0.35, 0.40), (0.45, 0.15)\\}$.\n  - Option B: $K = 360{,}000{,}000$ USD, $F = 10{,}000{,}000$ USD/year, $v = 4$ USD/MWh, CF scenarios $\\{(0.20, 0.20), (0.30, 0.50), (0.40, 0.30)\\}$.\n- Test Case 3 (boundary case with very low CF risk versus a high-variable-cost stable alternative):\n  - Shared parameters: $P = 50$ MW, $T = 15$ years, $r = 0.05$, baseline $c_0 = 0.08$, risk level $\\alpha = 0.10$, threshold $\\tau = 120$ USD/MWh.\n  - Option A: $K = 30{,}000{,}000$ USD, $F = 1{,}000{,}000$ USD/year, $v = 5$ USD/MWh, CF scenarios $\\{(0.02, 0.20), (0.08, 0.50), (0.15, 0.30)\\}$.\n  - Option B: $K = 20{,}000{,}000$ USD, $F = 1{,}200{,}000$ USD/year, $v = 40$ USD/MWh, CF scenarios $\\{(0.80, 1.00)\\}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case result is an inner list in the order given above. For example, the output should look like $[[x_1, x_2, x_3, x_4, x_5],[y_1, y_2, y_3, y_4, y_5],[z_1, z_2, z_3, z_4, z_5]]$, where each $x_i$, $y_i$, $z_i$ is a float except the recommendation element which is an integer. All LCOE-related numbers must be in United States Dollars per megawatt-hour (USD/MWh), sensitivities in United States Dollars per megawatt-hour per unit CF (USD/MWh per unit CF), and elasticities dimensionless.",
            "solution": "The user-provided problem is assessed as valid and well-posed, permitting a full solution. A minor ambiguity regarding the parameters for the sensitivity analysis in Task 2 is resolved by assuming the parameters of Option A serve as the baseline, a common convention in such problems. This interpretation is explicitly noted.\n\n### 1. Derivation of the LCOE Functional Form $L(\\text{CF})$\n\nThe Levelized Cost of Energy (LCOE), denoted by $L$, is defined as the constant price per megawatt-hour (MWh) of energy produced that makes the Net Present Value (NPV) of revenues equal to the NPV of costs over the asset's lifetime, $T$.\n\nThe NPV of a stream of cash flows $C_t$ occurring at the end of each year $t$ from $1$ to $T$, discounted at a rate $r$, is given by $\\sum_{t=1}^{T} \\frac{C_t}{(1+r)^t}$. An upfront cost $C_0$ at time $t=0$ has an NPV of $C_0$.\n\n**NPV of Costs:**\nThe costs consist of:\n1.  Capital Expenditure ($K$): A one-time cost at $t=0$. Its NPV is simply $K$.\n2.  Fixed Operations and Maintenance ($F$): A constant annual cost for $t=1, \\dots, T$.\n3.  Variable Cost ($v$): A cost per MWh of energy produced.\n\nThe annual energy produced, $E_{\\text{year}}$, is constant by assumption and given by:\n$$E_{\\text{year}} = P \\cdot \\text{CF} \\cdot 8760$$\nwhere $P$ is the nameplate capacity in MW, CF is the capacity factor, and $8760$ is the number of hours in a year. Let $H=8760$.\n\nThe annual cash outflow from costs for years $t=1, \\dots, T$ is the sum of fixed and variable costs: $F + v \\cdot E_{\\text{year}}$. The NPV of these recurring costs is:\n$$\\text{NPV}_{\\text{OM, Var}} = \\sum_{t=1}^{T} \\frac{F + v \\cdot E_{\\text{year}}}{(1+r)^t} = (F + v \\cdot E_{\\text{year}}) \\sum_{t=1}^{T} \\frac{1}{(1+r)^t}$$\nThe summation term is the present value of an annuity factor, which we denote as $S_r$:\n$$S_r = \\sum_{t=1}^{T} \\left(\\frac{1}{1+r}\\right)^t = \\frac{1 - (1+r)^{-T}}{r}$$\nThus, the total NPV of all costs is:\n$$\\text{NPV}_{\\text{Costs}} = K + (F + v \\cdot E_{\\text{year}}) \\cdot S_r$$\n\n**NPV of Revenues:**\nThe annual revenue is the energy produced multiplied by the LCOE, $L \\cdot E_{\\text{year}}$. The NPV of this revenue stream over $T$ years is:\n$$\\text{NPV}_{\\text{Revenues}} = \\sum_{t=1}^{T} \\frac{L \\cdot E_{\\text{year}}}{(1+r)^t} = (L \\cdot E_{\\text{year}}) \\cdot S_r$$\n\n**Equating NPVs and Solving for LCOE:**\nAccording to the definition of LCOE, $\\text{NPV}_{\\text{Revenues}} = \\text{NPV}_{\\text{Costs}}$:\n$$(L \\cdot E_{\\text{year}}) \\cdot S_r = K + (F + v \\cdot E_{\\text{year}}) \\cdot S_r$$\nTo solve for $L$, we rearrange the equation:\n$$(L - v) \\cdot E_{\\text{year}} \\cdot S_r = K + F \\cdot S_r$$\n$$L - v = \\frac{K + F \\cdot S_r}{E_{\\text{year}} \\cdot S_r} = \\frac{K}{E_{\\text{year}} \\cdot S_r} + \\frac{F}{E_{\\text{year}}}$$\n$$L = \\frac{K}{E_{\\text{year}} \\cdot S_r} + \\frac{F}{E_{\\text{year}}} + v$$\nThe term $1/S_r$ is the Capital Recovery Factor (CRF), $\\text{CRF} = \\frac{r}{1-(1+r)^{-T}}$. Substituting this and $E_{\\text{year}} = P \\cdot \\text{CF} \\cdot H$, we get:\n$$L(\\text{CF}) = \\frac{K \\cdot \\text{CRF}}{P \\cdot \\text{CF} \\cdot H} + \\frac{F}{P \\cdot \\text{CF} \\cdot H} + v$$\nThis can be written more compactly as:\n$$L(\\text{CF}) = \\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot \\text{CF}} + v$$\nThis is the required functional form $L(\\text{CF})$.\n\n### 2. Sensitivity and Elasticity of LCOE\n\nTo find the sensitivity of LCOE to the capacity factor, we compute the derivative of $L(\\text{CF})$ with respect to CF. For simplicity, let the combined annualized fixed costs be $C_{\\text{fix}} = K \\cdot \\text{CRF} + F$ and the annual full-load energy production be $E_{\\text{max}} = P \\cdot H$. Then, $L(\\text{CF}) = \\frac{C_{\\text{fix}}}{E_{\\text{max}} \\cdot \\text{CF}} + v$.\n\nThe derivative is:\n$$\\frac{dL}{d\\text{CF}} = \\frac{d}{d\\text{CF}}\\left(\\frac{C_{\\text{fix}}}{E_{\\text{max}} \\cdot \\text{CF}} + v\\right) = -\\frac{C_{\\text{fix}}}{E_{\\text{max}} \\cdot \\text{CF}^2}$$\nSubstituting back the full expressions:\n$$\\frac{dL}{d\\text{CF}} = -\\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot \\text{CF}^2}$$\nEvaluated at a baseline capacity factor $\\text{CF} = c_0$:\n$$\\frac{dL}{d\\text{CF}}\\bigg|_{\\text{CF}=c_0} = -\\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot c_0^2}$$\nThe elasticity $\\varepsilon$ is a dimensionless measure of sensitivity, defined as:\n$$\\varepsilon = \\left(\\frac{dL}{d\\text{CF}}\\right) \\cdot \\left(\\frac{\\text{CF}}{L(\\text{CF})}\\right)$$\nEvaluated at $\\text{CF} = c_0$:\n$$\\varepsilon\\bigg|_{\\text{CF}=c_0} = \\left(-\\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot c_0^2}\\right) \\cdot \\left(\\frac{c_0}{L(c_0)}\\right) = -\\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot c_0 \\cdot L(c_0)}$$\nSubstituting $L(c_0) = \\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot c_0} + v$:\n$$\\varepsilon\\bigg|_{\\text{CF}=c_0} = -\\frac{K \\cdot \\text{CRF} + F}{(P \\cdot H \\cdot c_0) \\left(\\frac{K \\cdot \\text{CRF} + F}{P \\cdot H \\cdot c_0} + v\\right)} = -\\frac{K \\cdot \\text{CRF} + F}{(K \\cdot \\text{CRF} + F) + v \\cdot P \\cdot H \\cdot c_0}$$\nThis simplifies to:\n$$\\varepsilon\\bigg|_{\\text{CF}=c_0} = \\frac{-(\\text{Annualized Fixed Cost})}{\\text{Annualized Fixed Cost} + \\text{Annualized Variable Cost at } c_0}$$\nThis shows that elasticity is the negative ratio of fixed costs to total costs. For the numerical computation, the parameters $(K, F, v)$ of Option A are used as the baseline asset, as this is a reasonable interpretation of the problem's structure.\n\n### 3. LCOE Distribution Under Uncertainty\n\nGiven a discrete probability distribution for the capacity factor, $\\{(CF_i, p_i)\\}$, the corresponding distribution for LCOE is found by applying the derived function $L(\\text{CF})$ to each scenario:\n$$\\{(L_i, p_i) \\mid L_i = L(CF_i)\\}$$\n\n### 4. Conditional Value at Risk (CVaR)\n\nThe upper-tail CVaR at risk level $\\alpha$ is the expected LCOE in the worst $\\alpha$ fraction of cases. For a discrete distribution $\\{(L_i, p_i)\\}$, the algorithm is as follows:\n1.  Create pairs of $(L_i, p_i)$.\n2.  Sort these pairs in descending order based on the LCOE values, $L_i$.\n3.  Iterate through the sorted list, accumulating the product of LCOE and probability ($L_i \\cdot p_i$) and the cumulative probability.\n4.  Let the cumulative probability be $P_{cum}$. For each entry $(L_{(j)}, p_{(j)})$ in the sorted list:\n    - If the current cumulative probability plus the probability of the current event, $p_{(j)}$, is less than $\\alpha$, we include the full contribution of this event: $L_{(j)} \\cdot p_{(j)}$.\n    - If it exceeds $\\alpha$, we have found the boundary event. We include only the fractional part needed to bring the total probability to $\\alpha$. The contribution is $L_{(j)} \\cdot (\\alpha - P_{cum})$.\n5.  Sum these contributions and divide by $\\alpha$ to get the final CVaR value.\n$$\\text{CVaR}_\\alpha(L) = \\frac{1}{\\alpha} \\sum_{(L_i, p_i) \\in \\text{Tail}} L_i \\cdot p'_i$$\nwhere the tail consists of the highest LCOE events with a total probability mass of $\\alpha$, and $p'_i$ is the (potentially fractional) probability of event $i$ included in the tail.\n\n### 5. Recommendation Logic\n\nThe robust recommendation between Option A and Option B follows a deterministic algorithm:\n1.  For each option, calculate its Expected LCOE ($E_A, E_B$) and its CVaR at level $\\alpha$ ($\\text{CVaR}_A, \\text{CVaR}_B$).\n2.  Check if each option is \"admissible\" by comparing its expected LCOE to the threshold $\\tau$. An option is admissible if its expected LCOE is less than or equal to $\\tau$.\n3.  **Decision Rule:**\n    a. If both options are admissible, select the one with the lower CVaR. If CVaRs are equal (within a numerical tolerance), select the one with the lower expected LCOE.\n    b. If only one option is admissible, select that option.\n    c. If neither option is admissible, select the one with the lower expected LCOE.\n4. The final output is an integer: $1$ if Option B is recommended, $0$ if Option A is recommended (or chosen by default in a tie).\n\nThese steps provide a complete, systematic procedure for evaluating the given test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the energy systems modeling problem for all test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"shared\": {\"P\": 100, \"T\": 25, \"r\": 0.07, \"c0\": 0.22, \"alpha\": 0.10, \"tau\": 80},\n            \"A\": {\"K\": 80_000_000, \"F\": 2_500_000, \"v\": 2, \"cf_scenarios\": [(0.18, 0.20), (0.22, 0.40), (0.26, 0.30), (0.30, 0.10)]},\n            \"B\": {\"K\": 95_000_000, \"F\": 3_000_000, \"v\": 1.5, \"cf_scenarios\": [(0.20, 0.10), (0.24, 0.50), (0.27, 0.30), (0.29, 0.10)]},\n        },\n        {\n            \"shared\": {\"P\": 200, \"T\": 20, \"r\": 0.10, \"c0\": 0.25, \"alpha\": 0.10, \"tau\": 70},\n            \"A\": {\"K\": 300_000_000, \"F\": 8_000_000, \"v\": 3, \"cf_scenarios\": [(0.10, 0.05), (0.25, 0.40), (0.35, 0.40), (0.45, 0.15)]},\n            \"B\": {\"K\": 360_000_000, \"F\": 10_000_000, \"v\": 4, \"cf_scenarios\": [(0.20, 0.20), (0.30, 0.50), (0.40, 0.30)]},\n        },\n        {\n            \"shared\": {\"P\": 50, \"T\": 15, \"r\": 0.05, \"c0\": 0.08, \"alpha\": 0.10, \"tau\": 120},\n            \"A\": {\"K\": 30_000_000, \"F\": 1_000_000, \"v\": 5, \"cf_scenarios\": [(0.02, 0.20), (0.08, 0.50), (0.15, 0.30)]},\n            \"B\": {\"K\": 20_000_000, \"F\": 1_200_000, \"v\": 40, \"cf_scenarios\": [(0.80, 1.00)]},\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        all_results.append(process_case(case))\n    \n    # Format the final output string\n    output_str = \"[\" + \",\".join([\n        f\"[{','.join(map(str, result))}]\" for result in all_results\n    ]) + \"]\"\n    print(output_str)\n\ndef process_case(case_data):\n    \"\"\"\n    Processes a single test case, calculating all required metrics and the recommendation.\n    \"\"\"\n    shared_params = case_data[\"shared\"]\n    params_A = {**shared_params, **case_data[\"A\"]}\n    params_B = {**shared_params, **case_data[\"B\"]}\n    \n    # Task 2: Sensitivity and Elasticity - calculated using Option A's parameters as baseline\n    deriv, epsilon = calculate_sensitivity(**params_A)\n\n    # Tasks 3-5: Analyze options and make recommendation\n    E_A, CVaR_A = analyze_option(**params_A)\n    E_B, CVaR_B = analyze_option(**params_B)\n    \n    tau = shared_params[\"tau\"]\n    recommendation = make_recommendation(E_A, E_B, CVaR_A, CVaR_B, tau)\n\n    return [deriv, epsilon, CVaR_A, CVaR_B, recommendation]\n\ndef get_lcoe_func(K, F, v, P, T, r):\n    \"\"\"\n    Returns a function that calculates LCOE for a given capacity factor (CF).\n    \"\"\"\n    H = 8760\n    # Avoid division by zero if r=0, although problem constraints make this unlikely.\n    if r > 0:\n        crf = (r * (1 + r)**T) / ((1 + r)**T - 1)\n    else:\n        crf = 1 / T\n        \n    annualized_fixed_cost = K * crf + F\n    max_energy = P * H\n    \n    def lcoe(cf):\n        if cf = 0:\n            return float('inf')\n        return annualized_fixed_cost / (max_energy * cf) + v\n        \n    return lcoe\n\ndef calculate_sensitivity(K, F, v, P, T, r, c0, **kwargs):\n    \"\"\"\n    Calculates the LCOE derivative and elasticity at a baseline capacity factor c0.\n    \"\"\"\n    H = 8760\n    if r > 0:\n        crf = (r * (1 + r)**T) / ((1 + r)**T - 1)\n    else:\n        crf = 1 / T\n\n    annualized_fixed_cost = K * crf + F\n    max_energy = P * H\n\n    # Derivative dL/dCF at c0\n    derivative = -annualized_fixed_cost / (max_energy * c0**2)\n    \n    # LCOE at c0\n    lcoe_at_c0 = (annualized_fixed_cost / (max_energy * c0)) + v\n    \n    # Elasticity\n    elasticity = derivative * c0 / lcoe_at_c0\n    \n    return derivative, elasticity\n    \ndef analyze_option(K, F, v, P, T, r, cf_scenarios, alpha, **kwargs):\n    \"\"\"\n    Analyzes a single design option to find its Expected LCOE and CVaR.\n    \"\"\"\n    lcoe_func = get_lcoe_func(K, F, v, P, T, r)\n    \n    lcoe_dist = []\n    for cf, prob in cf_scenarios:\n        lcoe = lcoe_func(cf)\n        lcoe_dist.append((lcoe, prob))\n        \n    # Calculate Expected LCOE\n    expected_lcoe = sum(lcoe * prob for lcoe, prob in lcoe_dist)\n    \n    # Calculate CVaR\n    cvar = calculate_cvar(lcoe_dist, alpha)\n    \n    return expected_lcoe, cvar\n\ndef calculate_cvar(dist, alpha):\n    \"\"\"\n    Calculates the Conditional Value at Risk (CVaR) for a discrete distribution.\n    \"\"\"\n    if not (0  alpha = 1):\n        raise ValueError(\"Alpha must be in (0, 1]\")\n        \n    # Sort by value (LCOE) in descending order\n    sorted_dist = sorted(dist, key=lambda x: x[0], reverse=True)\n    \n    cvar_sum = 0.0\n    prob_accumulated = 0.0\n    \n    for value, prob in sorted_dist:\n        prob_to_consider = min(prob, alpha - prob_accumulated)\n        cvar_sum += value * prob_to_consider\n        prob_accumulated += prob_to_consider\n        \n        if prob_accumulated >= alpha:\n            break\n            \n    # Normalize by alpha to get the expectation\n    # Handle potential floating point issue if alpha is very small\n    return cvar_sum / alpha if alpha > 0 else 0.0\n\ndef make_recommendation(E_A, E_B, CVaR_A, CVaR_B, tau, tol=1e-9):\n    \"\"\"\n    Implements the recommendation logic.\n    Returns 1 to recommend B, 0 to recommend A.\n    \"\"\"\n    A_is_admissible = E_A = tau\n    B_is_admissible = E_B = tau\n    \n    if A_is_admissible and B_is_admissible:\n        # Both admissible: choose based on lower CVaR, with E_LCOE as tie-breaker\n        if np.isclose(CVaR_A, CVaR_B, atol=tol, rtol=tol):\n            return 1 if E_B  E_A else 0\n        return 1 if CVaR_B  CVaR_A else 0\n    elif A_is_admissible and not B_is_admissible:\n        # Only A is admissible\n        return 0\n    elif not A_is_admissible and B_is_admissible:\n        # Only B is admissible\n        return 1\n    else: # Neither is admissible\n        # Choose based on lower Expected LCOE\n        return 1 if E_B  E_A else 0\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}