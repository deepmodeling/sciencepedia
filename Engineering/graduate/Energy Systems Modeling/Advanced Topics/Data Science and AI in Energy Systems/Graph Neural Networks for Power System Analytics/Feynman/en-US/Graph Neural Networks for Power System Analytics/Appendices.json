{
    "hands_on_practices": [
        {
            "introduction": "Before applying any machine learning model, data must be preprocessed into a consistent and scale-free format. This exercise introduces the per-unit system, a standard practice in power engineering for normalizing physical quantities like power and voltage. By working through this fundamental calculation , you will see how raw measurements are transformed into the dimensionless features that serve as the initial input for a Graph Neural Network.",
            "id": "4094182",
            "problem": "A transmission network is represented as a graph where each bus is a node and lines are edges. To train a Graph Neural Network (GNN) for state estimation and anomaly detection, node features are normalized in the per-unit (p.u.) system to ensure dimensionless, scale-consistent inputs. Consider a single bus $i$ with net active power injection $P_i=150\\,\\mathrm{MW}$ and voltage magnitude $|V_i|=230\\,\\mathrm{kV}$. The system per-unit bases are the apparent power base $S_{\\mathrm{base}}=100\\,\\mathrm{MVA}$ and the voltage base $V_{\\mathrm{base}}=230\\,\\mathrm{kV}$, aligned with the nominal transmission level. Starting from the definition of complex power $S=P+jQ$ in alternating current networks and the per-unit normalization principle defined by ratios to base quantities, and enforcing dimensional consistency, derive the per-unit normalized features $P_i^{\\mathrm{pu}}$ and $|V_i|^{\\mathrm{pu}}$ for bus $i$. Assemble the final normalized row feature vector for bus $i$ as $\\begin{pmatrix}P_i^{\\mathrm{pu}} & |V_i|^{\\mathrm{pu}}\\end{pmatrix}$ with dimensionless entries. Provide your final answer as a single row matrix. No rounding is required; present exact values.",
            "solution": "The problem requires the derivation of per-unit normalized features for a power system bus, specifically the active power injection and voltage magnitude. The per-unit system is a method of normalizing quantities in power system analysis, where an actual value is expressed as a decimal fraction of a base value.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n- Bus: $i$\n- Net active power injection: $P_i=150\\,\\mathrm{MW}$\n- Voltage magnitude: $|V_i|=230\\,\\mathrm{kV}$\n- Apparent power base: $S_{\\mathrm{base}}=100\\,\\mathrm{MVA}$\n- Voltage base: $V_{\\mathrm{base}}=230\\,\\mathrm{kV}$\n- Definition of complex power: $S=P+jQ$\n- Per-unit principle: Ratios to base quantities.\n- Required output: A row feature vector $\\begin{pmatrix}P_i^{\\mathrm{pu}} & |V_i|^{\\mathrm{pu}}\\end{pmatrix}$.\n\n**1.2. Validate Using Extracted Givens**\nThe problem is scientifically grounded in the principles of electrical engineering, specifically AC power circuit analysis and the per-unit system, which is a standard technique for analyzing power networks and preparing data for computational models like Graph Neural Networks. The provided values are realistic for a high-voltage transmission system. The problem is well-posed, providing all necessary base quantities and actual values to compute a unique solution. It is stated objectively using standard terminology. The problem is complete, consistent, and does not violate any scientific or mathematical principles.\n\n**1.3. Verdict and Action**\nThe problem is deemed **valid**. A solution will be derived.\n\n### Step 2: Solution Derivation\n\nThe fundamental definition of a per-unit quantity is the ratio of the actual quantity to a selected base quantity of the same dimension.\n$$ \\text{Quantity}_{\\mathrm{pu}} = \\frac{\\text{Actual Quantity}}{\\text{Base Quantity}} $$\nThe result of this operation is a dimensionless value. We apply this principle to both the voltage magnitude and the active power.\n\n**2.1. Per-Unit Voltage Magnitude ($|V_i|^{\\mathrm{pu}}$)**\nThe actual voltage magnitude at bus $i$ is given as $|V_i| = 230\\,\\mathrm{kV}$. The system voltage base is given as $V_{\\mathrm{base}} = 230\\,\\mathrm{kV}$.\nApplying the per-unit definition:\n$$ |V_i|^{\\mathrm{pu}} = \\frac{|V_i|}{V_{\\mathrm{base}}} $$\nSubstituting the given values:\n$$ |V_i|^{\\mathrm{pu}} = \\frac{230\\,\\mathrm{kV}}{230\\,\\mathrm{kV}} = 1.0 $$\nThe resulting per-unit voltage magnitude is a dimensionless value of $1.0$.\n\n**2.2. Per-Unit Active Power ($P_i^{\\mathrm{pu}}$)**\nThe actual net active power injection at bus $i$ is given as $P_i = 150\\,\\mathrm{MW}$.\nIn a standard per-unit system, all power quantities—active power ($P$), reactive power ($Q$), and apparent power ($S$)—are normalized by a single, common apparent power base, $S_{\\mathrm{base}}$. This convention ensures that the power triangle relationship, expressed in terms of complex power as $S=P+jQ$, remains valid for the per-unit quantities, i.e., $S^{\\mathrm{pu}} = P^{\\mathrm{pu}} + jQ^{\\mathrm{pu}}$.\nThe apparent power base is given as $S_{\\mathrm{base}} = 100\\,\\mathrm{MVA}$. Therefore, the base for active power is this same value.\n$$ P_{\\mathrm{base}} = S_{\\mathrm{base}} = 100\\,\\mathrm{MVA} $$\nThe units of the actual quantity ($P_i$ in $\\mathrm{MW}$) and the base quantity ($S_{\\mathrm{base}}$ in $\\mathrm{MVA}$) must be consistent. In the context of power, megawatts ($\\mathrm{MW}$) and megavolt-amperes ($\\mathrm{MVA}$) are dimensionally consistent for the purpose of this ratio, as $P=|S|\\cos\\phi$. The base unit of power is the Volt-Ampere ($\\mathrm{VA}$), and the Watt ($\\mathrm{W}$) is equivalent for normalization purposes ($1\\,\\mathrm{W} = 1\\,\\mathrm{VA} \\times (\\text{power factor})$). Since the per-unit system seeks to create a dimensionless representation, the ratio is formed directly.\nApplying the per-unit definition for power:\n$$ P_i^{\\mathrm{pu}} = \\frac{P_i}{S_{\\mathrm{base}}} $$\nSubstituting the given values:\n$$ P_i^{\\mathrm{pu}} = \\frac{150\\,\\mathrm{MW}}{100\\,\\mathrm{MVA}} = 1.5 $$\nThe resulting per-unit active power is a dimensionless value of $1.5$.\n\n**2.3. Assembling the Feature Vector**\nThe problem requires the final normalized features to be assembled into a row feature vector of the form $\\begin{pmatrix}P_i^{\\mathrm{pu}} & |V_i|^{\\mathrm{pu}}\\end{pmatrix}$.\nSubstituting the calculated per-unit values:\n$$ \\begin{pmatrix} 1.5 & 1.0 \\end{pmatrix} $$\nThis vector represents the normalized features for bus $i$ that would be used as input to a node in a Graph Neural Network model.",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.5 & 1.0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "To apply GNNs to a power system, we must first translate its physical structure into the language of graph theory. This practice guides you through deriving the fundamental matrices that define a power network as a graph, including the incidence matrix, the bus admittance matrix, and the graph Laplacian . Understanding this connection is crucial, as the graph Laplacian forms the mathematical bedrock for many graph-based learning algorithms, directly linking network topology and physics to the GNN's operations.",
            "id": "4094186",
            "problem": "Consider a lossless transmission network represented as a simple chain of buses $1$–$2$–$3$ with two series branches $(1,2)$ and $(2,3)$ having per-unit series reactances $X_{12}=0.2$ and $X_{23}=0.25$, respectively. Assume the Direct Current (DC) power flow approximation in which bus voltage magnitudes are fixed at $1$ per-unit, angle differences are small, branch resistances and shunt elements are neglected, and lines are purely reactive. Adopt an orientation for the two directed edges $e_{1}: 1 \\to 2$ and $e_{2}: 2 \\to 3$. \n\nUsing Kirchhoff’s current law at each bus and Ohm’s law across each line under these DC assumptions, derive from first principles:\n\n(a) the node-to-edge incidence matrix $\\mathbf{A}$ corresponding to the chosen orientation,\n\n(b) the bus admittance matrix $\\mathbf{Y}_{\\mathrm{bus}}$ in per-unit,\n\n(c) the weighted graph Laplacian $\\mathbf{L}$ associated with the network’s susceptance weights.\n\nThen, using the definition of algebraic connectivity as the second-smallest eigenvalue of $\\mathbf{L}$, compute this eigenvalue exactly as a simplified analytic expression. Express your final answer as a single closed-form expression with no units. Do not round; provide the exact expression.",
            "solution": "The problem requires the derivation of key matrices representing a simple power network and the calculation of its algebraic connectivity. We will proceed step-by-step, deriving each quantity from first principles as requested. The network consists of three buses labeled $1$, $2$, and $3$, connected in a chain by two transmission lines $(1,2)$ and $(2,3)$. The analysis is performed under the standard Direct Current (DC) power flow assumptions.\n\nThe given per-unit series reactances are $X_{12}=0.2$ and $X_{23}=0.25$. In the DC power flow model, resistances are neglected, so the impedance of a branch is purely imaginary: $Z_{ik} = jX_{ik}$. The admittance is the reciprocal of the impedance, $y_{ik} = Z_{ik}^{-1} = (jX_{ik})^{-1} = -j/X_{ik}$. The term $B_{ik} = 1/X_{ik}$ is the branch susceptance.\n\nFor the given branches:\nThe branch susceptance for line $(1,2)$ is $B_{12} = \\frac{1}{X_{12}} = \\frac{1}{0.2} = 5$ per-unit.\nThe branch admittance is $y_{12} = -jB_{12} = -j5$ per-unit.\n\nThe branch susceptance for line $(2,3)$ is $B_{23} = \\frac{1}{X_{23}} = \\frac{1}{0.25} = 4$ per-unit.\nThe branch admittance is $y_{23} = -jB_{23} = -j4$ per-unit.\n\n(a) Derivation of the node-to-edge incidence matrix $\\mathbf{A}$\n\nThe node-to-edge incidence matrix, denoted by $\\mathbf{A}$, describes the topology of the directed graph. For a graph with $n$ nodes and $m$ edges, $\\mathbf{A}$ is an $n \\times m$ matrix. Its elements, $A_{ie}$, are defined based on the given edge orientation:\n- $A_{ie} = +1$ if node $i$ is the source (starting point) of edge $e$.\n- $A_{ie} = -1$ if node $i$ is the sink (ending point) of edge $e$.\n- $A_{ie} = 0$ if node $i$ is not incident to edge $e$.\n\nThe network has $n=3$ nodes (buses) and $m=2$ edges (lines). The specified edge orientations are $e_1: 1 \\to 2$ and $e_2: 2 \\to 3$.\n\nFor edge $e_1$ (column 1 of $\\mathbf{A}$): Node $1$ is the source ($+1$), node $2$ is the sink ($-1$), and node $3$ is not incident ($0$).\nFor edge $e_2$ (column 2 of $\\mathbf{A}$): Node $2$ is the source ($+1$), node $3$ is the sink ($-1$), and node $1$ is not incident ($0$).\n\nConstructing the $3 \\times 2$ incidence matrix $\\mathbf{A}$ with rows for nodes $\\{1, 2, 3\\}$ and columns for edges $\\{e_1, e_2\\}$:\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1 & 0 \\\\\n-1 & 1 \\\\\n0 & -1\n\\end{pmatrix}\n$$\n\n(b) Derivation of the bus admittance matrix $\\mathbf{Y}_{\\mathrm{bus}}$\n\nThe bus admittance matrix $\\mathbf{Y}_{\\mathrm{bus}}$ relates the vector of bus current injections $\\mathbf{I}$ to the vector of bus voltages $\\boldsymbol{V}$ via the equation $\\mathbf{I} = \\mathbf{Y}_{\\mathrm{bus}}\\boldsymbol{V}$. It can be derived from first principles using Kirchhoff’s Current Law (KCL) at each bus.\n\nLet $V_1, V_2, V_3$ be the complex voltages at buses $1, 2, 3$ and $I_1, I_2, I_3$ be the current injections into these buses.\nKCL at bus 1: The current leaving bus $1$ towards bus $2$ is $(V_1-V_2)y_{12}$. Thus, the injected current is $I_1 = (V_1-V_2)y_{12} = y_{12}V_1 - y_{12}V_2$.\nKCL at bus 2: The current leaving bus $2$ towards bus $1$ is $(V_2-V_1)y_{12}$ and towards bus $3$ is $(V_2-V_3)y_{23}$. The injected current is $I_2 = (V_2-V_1)y_{12} + (V_2-V_3)y_{23} = -y_{12}V_1 + (y_{12}+y_{23})V_2 - y_{23}V_3$.\nKCL at bus 3: The current leaving bus $3$ towards bus $2$ is $(V_3-V_2)y_{23}$. The injected current is $I_3 = (V_3-V_2)y_{23} = -y_{23}V_2 + y_{23}V_3$.\n\nArranging these equations in matrix form $\\mathbf{I} = \\mathbf{Y}_{\\mathrm{bus}}\\boldsymbol{V}$:\n$$\n\\begin{pmatrix} I_1 \\\\ I_2 \\\\ I_3 \\end{pmatrix} =\n\\begin{pmatrix}\ny_{12} & -y_{12} & 0 \\\\\n-y_{12} & y_{12}+y_{23} & -y_{23} \\\\\n0 & -y_{23} & y_{23}\n\\end{pmatrix}\n\\begin{pmatrix} V_1 \\\\ V_2 \\\\ V_3 \\end{pmatrix}\n$$\nSubstituting the calculated admittance values $y_{12} = -j5$ and $y_{23} = -j4$:\n$$\n\\mathbf{Y}_{\\mathrm{bus}} =\n\\begin{pmatrix}\n-j5 & -(-j5) & 0 \\\\\n-(-j5) & (-j5)+(-j4) & -(-j4) \\\\\n0 & -(-j4) & -j4\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n-j5 & j5 & 0 \\\\\nj5 & -j9 & j4 \\\\\n0 & j4 & -j4\n\\end{pmatrix}\n$$\n\n(c) Derivation of the weighted graph Laplacian $\\mathbf{L}$\n\nWithin the DC power flow approximation, the vector of active power injections $\\mathbf{P}$ is related to the vector of bus voltage angles $\\boldsymbol{\\theta}$ by the equation $\\mathbf{P} = \\mathbf{B}' \\boldsymbol{\\theta}$, where $\\mathbf{B}'$ is the DC bus admittance matrix. This matrix is defined as $\\mathbf{B}' = -\\mathrm{Im}(\\mathbf{Y}_{\\mathrm{bus}})$ and is identical to the weighted graph Laplacian $\\mathbf{L}$ of the network, where the edge weights are the susceptances $B_{ik}$.\n\nUsing the derived $\\mathbf{Y}_{\\mathrm{bus}}$:\n$$\n\\mathrm{Im}(\\mathbf{Y}_{\\mathrm{bus}}) =\n\\begin{pmatrix}\n-5 & 5 & 0 \\\\\n5 & -9 & 4 \\\\\n0 & 4 & -4\n\\end{pmatrix}\n$$\nThe weighted graph Laplacian $\\mathbf{L}$ is therefore:\n$$\n\\mathbf{L} = \\mathbf{B}' = -\\mathrm{Im}(\\mathbf{Y}_{\\mathrm{bus}}) = -\n\\begin{pmatrix}\n-5 & 5 & 0 \\\\\n5 & -9 & 4 \\\\\n0 & 4 & -4\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n5 & -5 & 0 \\\\\n-5 & 9 & -4 \\\\\n0 & -4 & 4\n\\end{pmatrix}\n$$\nThis matrix is symmetric and has zero row and column sums, which are properties of a Laplacian matrix.\n\nCalculation of the Algebraic Connectivity\n\nThe algebraic connectivity of a graph is the second-smallest eigenvalue of its Laplacian matrix, denoted $\\lambda_2$. For any connected graph, the smallest eigenvalue, $\\lambda_1$, is always $0$. We need to find the eigenvalues of $\\mathbf{L}$.\nThe characteristic equation is $\\det(\\mathbf{L} - \\lambda \\mathbf{I}) = 0$.\n$$\n\\det\\left(\n\\begin{pmatrix}\n5-\\lambda & -5 & 0 \\\\\n-5 & 9-\\lambda & -4 \\\\\n0 & -4 & 4-\\lambda\n\\end{pmatrix}\n\\right) = 0\n$$\nWe expand the determinant along the first row:\n$$\n(5-\\lambda) \\det\\left(\\begin{pmatrix} 9-\\lambda & -4 \\\\ -4 & 4-\\lambda \\end{pmatrix}\\right) - (-5) \\det\\left(\\begin{pmatrix} -5 & -4 \\\\ 0 & 4-\\lambda \\end{pmatrix}\\right) = 0\n$$\n$$\n(5-\\lambda)[(9-\\lambda)(4-\\lambda) - 16] + 5[-5(4-\\lambda) - 0] = 0\n$$\n$$\n(5-\\lambda)[\\lambda^2 - 13\\lambda + 36 - 16] + 5[-20 + 5\\lambda] = 0\n$$\n$$\n(5-\\lambda)(\\lambda^2 - 13\\lambda + 20) - 100 + 25\\lambda = 0\n$$\n$$\n5\\lambda^2 - 65\\lambda + 100 - \\lambda^3 + 13\\lambda^2 - 20\\lambda - 100 + 25\\lambda = 0\n$$\nCombining terms, we get:\n$$\n-\\lambda^3 + (5+13)\\lambda^2 + (-65-20+25)\\lambda + (100-100) = 0\n$$\n$$\n-\\lambda^3 + 18\\lambda^2 - 60\\lambda = 0\n$$\n$$\n\\lambda^3 - 18\\lambda^2 + 60\\lambda = 0\n$$\nFactor out $\\lambda$:\n$$\n\\lambda(\\lambda^2 - 18\\lambda + 60) = 0\n$$\nOne eigenvalue is $\\lambda_1 = 0$, as expected for a connected graph. The other two eigenvalues are the roots of the quadratic equation $\\lambda^2 - 18\\lambda + 60 = 0$.\nUsing the quadratic formula, $\\lambda = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$:\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{(-18)^2 - 4(1)(60)}}{2(1)}\n$$\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{324 - 240}}{2}\n$$\n$$\n\\lambda = \\frac{18 \\pm \\sqrt{84}}{2}\n$$\nTo simplify $\\sqrt{84}$, we note that $84 = 4 \\times 21$, so $\\sqrt{84} = 2\\sqrt{21}$.\n$$\n\\lambda = \\frac{18 \\pm 2\\sqrt{21}}{2} = 9 \\pm \\sqrt{21}\n$$\nThe three eigenvalues are $\\lambda_1=0$, $\\lambda_2=9 - \\sqrt{21}$, and $\\lambda_3=9 + \\sqrt{21}$. Since $\\sqrt{16} < \\sqrt{21} < \\sqrt{25}$, we have $4 < \\sqrt{21} < 5$, which confirms that $0 < 9 - \\sqrt{21} < 9 + \\sqrt{21}$.\nThe eigenvalues in increasing order are $\\lambda_{(1)}=0$, $\\lambda_{(2)}=9 - \\sqrt{21}$, and $\\lambda_{(3)}=9 + \\sqrt{21}$.\n\nThe algebraic connectivity is the second-smallest eigenvalue, $\\lambda_{(2)}$.",
            "answer": "$$\n\\boxed{9-\\sqrt{21}}\n$$"
        },
        {
            "introduction": "The core of a GNN lies in its message passing mechanism, where nodes aggregate information from their neighbors. This hands-on simulation challenges you to compare two common aggregation functions, sum and max, by evaluating how well they approximate the physical distribution of power flows in a network . This exercise provides direct insight into how different GNN design choices can impact the model's ability to capture the underlying physics of the system.",
            "id": "4094253",
            "problem": "Consider a connected power transmission network with $5$ buses represented as an undirected graph. Each line $(i,j)$ has a series reactance in per unit (p.u.), and the network is modeled using the linearized Direct Current (DC) power flow approximation. Let the vector of net active power injections be $\\mathbf{p} \\in \\mathbb{R}^{5}$ in p.u., with the convention that generation is positive and load is negative, and power balance $\\sum_{i=1}^{5} p_i = 0$ holds. Angles are measured in radians. Choose bus $1$ as the slack bus with angle $\\theta_1 = 0$. The DC power flow model states that\n$$\n\\mathbf{p} = \\mathbf{B} \\, \\boldsymbol{\\theta},\n$$\nwhere $\\boldsymbol{\\theta} \\in \\mathbb{R}^{5}$ is the vector of bus voltage angles, and $\\mathbf{B} \\in \\mathbb{R}^{5 \\times 5}$ is the bus susceptance matrix defined by\n$$\nB_{ij} = \\begin{cases}\n-\\frac{1}{x_{ij}} & \\text{if buses } i \\text{ and } j \\text{ are directly connected},\\\\\n0 & \\text{if buses } i \\text{ and } j \\text{ are not directly connected and } i \\neq j,\\\\\n-\\sum_{k \\neq i} B_{ik} & \\text{if } i = j,\n\\end{cases}\n$$\nwhere $x_{ij}$ is the series reactance (in p.u.) of the line $(i,j)$. For each connected pair $(i,j)$, the DC branch flow (in p.u.) is\n$$\nF_{ij} = \\frac{1}{x_{ij}} \\left(\\theta_i - \\theta_j\\right),\n$$\nand the total incident flow magnitude at bus $i$ is defined as\n$$\nd_i = \\sum_{j \\in \\mathcal{N}(i)} \\left| F_{ij} \\right|,\n$$\nwhere $\\mathcal{N}(i)$ denotes the set of neighbors of bus $i$.\n\nA Graph Neural Network (GNN) message passing step is defined on this graph as follows. Let the initial node feature be $h_i^{(0)} = p_i$ (in p.u.), and define an edge weight $s_{ij} = \\left| B_{ij} \\right|$ for each connected pair $(i,j)$. The message sent from node $j$ to node $i$ is\n$$\nm_{ij} = s_{ij} \\cdot \\left| h_j^{(0)} \\right| = \\left| B_{ij} \\right| \\cdot \\left| p_j \\right|.\n$$\nTwo aggregation operators at each node $i$ are considered:\n- Sum-aggregation: \n$$\na_i^{\\mathrm{sum}} = \\sum_{j \\in \\mathcal{N}(i)} m_{ij} = \\sum_{j \\in \\mathcal{N}(i)} \\left| B_{ij} \\right| \\cdot \\left| p_j \\right|.\n$$\n- Max-aggregation:\n$$\na_i^{\\mathrm{max}} = \\max_{j \\in \\mathcal{N}(i)} m_{ij} = \\max_{j \\in \\mathcal{N}(i)} \\left\\{ \\left| B_{ij} \\right| \\cdot \\left| p_j \\right| \\right\\}.\n$$\n\nThe goal is to compute a quantitative comparison of how well each aggregation captures the distributed power flow dependencies encoded by $\\{ d_i \\}_{i=1}^{5}$. Define the normalized mean absolute error (dimensionless) of an aggregation vector $\\mathbf{a} \\in \\mathbb{R}^{5}$ with respect to $\\mathbf{d} \\in \\mathbb{R}^{5}$ as\n$$\n\\operatorname{NMAE}(\\mathbf{a}, \\mathbf{d}) = \\frac{\\sum_{i=1}^{5} \\left| a_i - d_i \\right|}{\\sum_{i=1}^{5} d_i}.\n$$\nFor each test case, compute the improvement factor\n$$\n\\gamma = \\frac{\\operatorname{NMAE}\\left(\\mathbf{a}^{\\mathrm{max}}, \\mathbf{d}\\right)}{\\operatorname{NMAE}\\left(\\mathbf{a}^{\\mathrm{sum}}, \\mathbf{d}\\right)},\n$$\nwhich is greater than $1$ if the sum-aggregation is closer (lower error) to the distributed dependency $\\mathbf{d}$ than the max-aggregation.\n\nUse the following $5$-bus network and line reactances (in p.u.):\n- Line $(1,2)$: $x_{12} = 0.2$,\n- Line $(1,3)$: $x_{13} = 0.25$,\n- Line $(2,3)$: $x_{23} = 0.3$,\n- Line $(2,4)$: $x_{24} = 0.4$,\n- Line $(3,5)$: $x_{35} = 0.35$,\n- Line $(4,5)$: $x_{45} = 0.5$,\n- Line $(1,5)$: $x_{15} = 0.45$.\n\nConstruct $\\mathbf{B}$ accordingly. Solve for $\\boldsymbol{\\theta}$ using the DC power flow relation with slack bus angle $\\theta_1 = 0$. Compute $F_{ij}$ for each connected line and then $d_i$ for each bus.\n\nTest Suite (all injections in p.u., each vector $\\mathbf{p}$ satisfies $\\sum_i p_i = 0$):\n- Case $1$ (distributed injections): $\\mathbf{p}^{(1)} = [0.4,\\,-0.1,\\,0.0,\\,-0.15,\\,-0.15]$,\n- Case $2$ (single source and single sink): $\\mathbf{p}^{(2)} = [1.0,\\,-1.0,\\,0.0,\\,0.0,\\,0.0]$,\n- Case $3$ (neighboring buses opposite): $\\mathbf{p}^{(3)} = [0.0,\\,0.6,\\,-0.6,\\,0.0,\\,0.0]$,\n- Case $4$ (mildly spread): $\\mathbf{p}^{(4)} = [0.25,\\,-0.05,\\,-0.1,\\,-0.05,\\,-0.05]$.\n\nYour program should produce a single line of output containing the improvement factors $\\gamma$ for the four cases as a comma-separated list enclosed in square brackets (e.g., `[r_1,r_2,r_3,r_4]`). Angles must be treated in radians, reactances and injections in p.u., and the final improvement factors are dimensionless floats. Round nothing; report the raw computed floats.",
            "solution": "The user-provided problem is validated as scientifically grounded, well-posed, objective, and self-contained. It is a formal problem in power systems analysis and graph neural networks, free of any identified flaws. A complete solution is therefore warranted.\n\nThe solution methodology involves a systematic computation for each test case provided. The core steps are: 1) constructing the network's mathematical representation, 2) solving the DC power flow equations to find bus voltage angles, 3) calculating the ground-truth flow distribution metric $\\mathbf{d}$, 4) computing the GNN-based aggregation metrics $\\mathbf{a}^{\\mathrm{sum}}$ and $\\mathbf{a}^{\\mathrm{max}}$, and 5) evaluating the final improvement factor $\\gamma$.\n\n### Step 1: Network Representation and Susceptance Matrix Construction\n\nThe $5$-bus power network is represented as a graph where buses are nodes and transmission lines are edges. The key electrical property for the DC power flow model is the bus susceptance matrix $\\mathbf{B} \\in \\mathbb{R}^{5 \\times 5}$. Its elements are derived from the given line reactances $x_{ij}$.\n\nThe off-diagonal elements are given by $B_{ij} = -1/x_{ij}$ if an edge exists between bus $i$ and bus $j$, and $B_{ij} = 0$ otherwise. Let's denote the susceptance magnitude of a line as $b_{ij} = 1/x_{ij}$. The given reactances are:\n- $x_{12} = 0.2 \\implies b_{12} = 5.0$ p.u.\n- $x_{13} = 0.25 \\implies b_{13} = 4.0$ p.u.\n- $x_{23} = 0.3 \\implies b_{23} \\approx 3.333$ p.u.\n- $x_{24} = 0.4 \\implies b_{24} = 2.5$ p.u.\n- $x_{35} = 0.35 \\implies b_{35} \\approx 2.857$ p.u.\n- $x_{45} = 0.5 \\implies b_{45} = 2.0$ p.u.\n- $x_{15} = 0.45 \\implies b_{15} \\approx 2.222$ p.u.\n\nUsing these values, the bus susceptance matrix $\\mathbf{B}$ is constructed as:\n$$\n\\mathbf{B} = \\begin{pmatrix}\nb_{12}+b_{13}+b_{15} & -b_{12} & -b_{13} & 0 & -b_{15} \\\\\n-b_{12} & b_{12}+b_{23}+b_{24} & -b_{23} & -b_{24} & 0 \\\\\n-b_{13} & -b_{23} & b_{13}+b_{23}+b_{35} & 0 & -b_{35} \\\\\n0 & -b_{24} & 0 & b_{24}+b_{45} & -b_{45} \\\\\n-b_{15} & 0 & -b_{35} & -b_{45} & b_{15}+b_{35}+b_{45}\n\\end{pmatrix}\n$$\nNumerically, this is:\n$$\n\\mathbf{B} \\approx \\begin{pmatrix}\n11.222 & -5.0 & -4.0 & 0.0 & -2.222 \\\\\n-5.0 & 10.833 & -3.333 & -2.5 & 0.0 \\\\\n-4.0 & -3.333 & 10.190 & 0.0 & -2.857 \\\\\n0.0 & -2.5 & 0.0 & 4.5 & -2.0 \\\\\n-2.222 & 0.0 & -2.857 & -2.0 & 7.079\n\\end{pmatrix}\n$$\n\n### Step 2: Solving for Bus Voltage Angles\n\nThe DC power flow model is a linear system $\\mathbf{p} = \\mathbf{B} \\boldsymbol{\\theta}$, where $\\mathbf{p}$ is the net active power injection vector and $\\boldsymbol{\\theta}$ is the bus voltage angle vector. The matrix $\\mathbf{B}$ is singular because its row and column sums are zero. To obtain a unique solution, we must specify a reference angle. The problem designates bus $1$ as the slack bus with $\\theta_1 = 0$ radians.\n\nThis allows us to solve for the remaining unknown angles $(\\theta_2, \\theta_3, \\theta_4, \\theta_5)$. We form a reduced linear system by removing the first row and first column of the original system:\n$$\n\\mathbf{p}_{\\text{red}} = \\mathbf{B}_{\\text{red}} \\boldsymbol{\\theta}_{\\text{red}}\n$$\nwhere $\\mathbf{p}_{\\text{red}} = [p_2, p_3, p_4, p_5]^T$, $\\boldsymbol{\\theta}_{\\text{red}} = [\\theta_2, \\theta_3, \\theta_4, \\theta_5]^T$, and $\\mathbf{B}_{\\text{red}}$ is the $4 \\times 4$ submatrix of $\\mathbf{B}$ corresponding to buses $2$ through $5$. Since the network is connected, $\\mathbf{B}_{\\text{red}}$ is invertible. The unknown angles are found by solving this system:\n$$\n\\boldsymbol{\\theta}_{\\text{red}} = \\mathbf{B}_{\\text{red}}^{-1} \\mathbf{p}_{\\text{red}}\n$$\nThe full angle vector for the network is then $\\boldsymbol{\\theta} = [0, \\theta_2, \\theta_3, \\theta_4, \\theta_5]^T$.\n\n### Step 3: Calculation of Target Flow Dependencies ($\\mathbf{d}$)\n\nThe vector $\\mathbf{d}$ represents the ground-truth distribution of power flow stress at each bus. First, we compute the active power flow $F_{ij}$ on each line $(i,j)$:\n$$\nF_{ij} = \\frac{1}{x_{ij}} (\\theta_i - \\theta_j) = b_{ij}(\\theta_i - \\theta_j)\n$$\nThen, for each bus $i$, we sum the magnitudes of all flows on lines connected to it:\n$$\nd_i = \\sum_{j \\in \\mathcal{N}(i)} |F_{ij}|\n$$\nwhere $\\mathcal{N}(i)$ is the set of neighboring buses of bus $i$. This calculation is performed for all $i \\in \\{1, \\dots, 5\\}$ to form the vector $\\mathbf{d}$.\n\n### Step 4: Calculation of GNN Aggregations ($\\mathbf{a}^{\\mathrm{sum}}$ and $\\mathbf{a}^{\\mathrm{max}}$)\n\nThe problem defines a single GNN message passing step where initial node features are the power injections, $h_i^{(0)} = p_i$. The aggregations $\\mathbf{a}^{\\mathrm{sum}}$ and $\\mathbf{a}^{\\mathrm{max}}$ are local approximations of flow distribution, computed without solving the global power flow equations.\n\nFor each bus $i$, the message from a neighboring bus $j$ is $m_{ij} = |B_{ij}| \\cdot |p_j| = b_{ij} |p_j|$. The two aggregation operators are then:\n- Sum-aggregation: $a_i^{\\mathrm{sum}} = \\sum_{j \\in \\mathcal{N}(i)} m_{ij} = \\sum_{j \\in \\mathcal{N}(i)} b_{ij} |p_j|$\n- Max-aggregation: $a_i^{\\mathrm{max}} = \\max_{j \\in \\mathcal{N}(i)} m_{ij} = \\max_{j \\in \\mathcal{N}(i)} \\{ b_{ij} |p_j| \\}$\n\nThese calculations are performed for all $i \\in \\{1, \\dots, 5\\}$ to form the vectors $\\mathbf{a}^{\\mathrm{sum}}$ and $\\mathbf{a}^{\\mathrm{max}}$.\n\n### Step 5: Error and Improvement Factor Calculation\n\nThe normalized mean absolute error (NMAE) quantifies the discrepancy between an aggregated vector $\\mathbf{a}$ and the target vector $\\mathbf{d}$:\n$$\n\\operatorname{NMAE}(\\mathbf{a}, \\mathbf{d}) = \\frac{\\sum_{i=1}^{5} |a_i - d_i|}{\\sum_{i=1}^{5} d_i}\n$$\nThe final improvement factor $\\gamma$ compares the performance of sum-aggregation to max-aggregation:\n$$\n\\gamma = \\frac{\\operatorname{NMAE}(\\mathbf{a}^{\\mathrm{max}}, \\mathbf{d})}{\\operatorname{NMAE}(\\mathbf{a}^{\\mathrm{sum}}, \\mathbf{d})} = \\frac{\\sum_{i=1}^{5} |a_i^{\\mathrm{max}} - d_i| / \\sum_{i=1}^{5} d_i}{\\sum_{i=1}^{5} |a_i^{\\mathrm{sum}} - d_i| / \\sum_{i=1}^{5} d_i} = \\frac{\\sum_{i=1}^{5} |a_i^{\\mathrm{max}} - d_i|}{\\sum_{i=1}^{5} |a_i^{\\mathrm{sum}} - d_i|}\n$$\nA value $\\gamma > 1$ indicates that sum-aggregation provides a better approximation of the true flow distribution $\\mathbf{d}$ than max-aggregation. This entire procedure is repeated for each of the four specified test cases for the power injection vector $\\mathbf{p}$.",
            "answer": "`[1.9961605389684136,1.2587595568194483,1.0,1.706316277978586]`"
        }
    ]
}