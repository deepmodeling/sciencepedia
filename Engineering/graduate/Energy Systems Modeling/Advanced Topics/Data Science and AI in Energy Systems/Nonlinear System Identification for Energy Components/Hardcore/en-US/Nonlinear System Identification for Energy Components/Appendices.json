{
    "hands_on_practices": [
        {
            "introduction": "Before attempting to estimate the internal states of an energy component, we must answer a fundamental question: are the states theoretically \"visible\" from the measurements we can take? This property, known as observability, is critical for designing state estimators and validating a model's structure. This exercise  guides you through applying the powerful mathematical framework of Lie derivatives to assess the local observability of a nonlinear fuel cell model, connecting abstract control theory to a practical engineering challenge.",
            "id": "4108685",
            "problem": "Consider a three-state, input-driven model for a proton-exchange-membrane fuel cell stack used in energy systems modeling. The state vector is $x = \\begin{pmatrix} x_{1} & x_{2} & x_{3} \\end{pmatrix}^{\\top}$, where $x_{1}$ is the membrane water content in moles, $x_{2}$ is the stack temperature in kelvins, and $x_{3}$ is the anode hydrogen partial pressure in bar. The scalar input $u$ is the stack current in amperes, which is known and imposed.\n\nThe dynamics are given as ordinary differential equations (ODEs):\n$$\n\\dot{x}_{1} = -a\\left(x_{1} - \\alpha x_{2}\\right) + b\\,u,\\quad\n\\dot{x}_{2} = \\frac{1}{C}\\left(\\beta\\,u - \\gamma\\left(x_{2} - T_{a}\\right)\\right),\\quad\n\\dot{x}_{3} = -\\delta\\,u + \\varepsilon\\left(p_{s} - x_{3}\\right),\n$$\nwith constant parameters $a = 0.1\\,\\mathrm{s}^{-1}$, $\\alpha = 0.02\\,\\mathrm{mol/K}$, $b = 5.0\\times 10^{-3}\\,\\mathrm{mol/(A\\cdot s)}$, $C = 500\\,\\mathrm{J/K}$, $\\beta = 0.6\\,\\mathrm{W/A}$, $\\gamma = 50\\,\\mathrm{W/K}$, $T_{a} = 298\\,\\mathrm{K}$, $\\delta = 10^{-3}\\,\\mathrm{bar/(A\\cdot s)}$, $\\varepsilon = 0.2\\,\\mathrm{s}^{-1}$, $p_{s} = 2.0\\,\\mathrm{bar}$.\n\nPartial sensing is available through two outputs. The first output is the stack voltage modeled as\n$$\ny_{1} = h_{1}(x,u) = E_{0} + k_{T}\\,x_{2}\\,\\ln(x_{3}) - \\frac{r_{1}}{x_{1}} - r_{2}\\,u - r_{0},\n$$\nwhere $E_{0} = 0.95\\,\\mathrm{V}$, $r_{0} = 0.05\\,\\mathrm{V}$, $r_{1} = 2.0\\times 10^{-2}\\,\\mathrm{V\\cdot mol}$, $r_{2} = 10^{-3}\\,\\mathrm{V/A}$, and $k_{T} = \\frac{R}{2F}$ with universal gas constant $R = 8.314\\,\\mathrm{J/(mol\\cdot K)}$ and Faraday’s constant $F = 96485\\,\\mathrm{C/mol}$. The second output directly measures the stack temperature,\n$$\ny_{2} = h_{2}(x) = x_{2}.\n$$\n\nFor a fixed constant input $u = u^{\\star} = 200\\,\\mathrm{A}$ and operating point $x^{\\star} = \\begin{pmatrix} 5.0\\,\\mathrm{mol} & 350\\,\\mathrm{K} & e\\,\\mathrm{bar} \\end{pmatrix}^{\\top}$, where $e$ is the base of the natural logarithm, address the following:\n\n1. Starting from the core definition of local weak observability for nonlinear systems, define the observability rank condition using Lie derivatives. In particular, explain how to construct an observability matrix from the gradients of the outputs and their successive Lie derivatives along the system vector field.\n\n2. Apply this construction to the fuel cell stack model above. Using the rows $\\nabla h_{1}(x^{\\star})$, $\\nabla h_{2}(x^{\\star})$, and $\\nabla \\left(L_{f} h_{1}\\right)(x^{\\star})$—where $L_{f} h_{1}$ denotes the Lie derivative of $h_{1}$ along the drift vector field $f(x) = \\begin{pmatrix} \\dot{x}_{1} & \\dot{x}_{2} & \\dot{x}_{3} \\end{pmatrix}^{\\top}$ with $u$ held constant at $u^{\\star}$—evaluate these gradients at the given operating point with the given parameter values, assemble the resulting $3 \\times 3$ observability matrix, and determine its rank.\n\nExpress the final answer as the integer rank of the constructed observability matrix. No units are required for the final answer. The final answer must be a single real number.",
            "solution": "The analysis proceeds in two parts as requested by the problem statement. First, we define the observability rank condition for a general nonlinear system. Second, we apply this condition to the specific fuel cell model at the given operating point.\n\n### Part 1: The Observability Rank Condition\n\nConsider a general nonlinear, time-invariant system described by the equations:\n$$\n\\dot{x} = f(x, u) \\\\\ny = h(x, u)\n$$\nwhere $x \\in \\mathbb{R}^{n}$ is the state vector, $u \\in \\mathbb{R}^{m}$ is the input vector, and $y \\in \\mathbb{R}^{p}$ is the output vector. For the purpose of observability analysis, the input $u(t)$ is assumed to be a known function of time. We can therefore treat the system as being governed by a time-varying vector field on the state space, $\\dot{x} = f(x(t), u(t)) \\equiv f_t(x(t))$.\n\nA system is locally weakly observable at a state $x^{\\star}$ if, for some input $u(t)$, any initial state $x(0)$ in a neighborhood of $x^{\\star}$ can be uniquely determined from the output history $y(t)$ over a finite time interval.\n\nThe formal tool for analyzing observability is the Lie derivative. The Lie derivative of a scalar field (a function) $\\phi(x)$ along a vector field $g(x)$ is defined as:\n$$\nL_{g}\\phi(x) = \\nabla \\phi(x) \\cdot g(x) = \\sum_{i=1}^{n} \\frac{\\partial \\phi}{\\partial x_{i}} g_{i}(x)\n$$\nIt represents the rate of change of $\\phi$ along the flow of the vector field $g$. Successive Lie derivatives are defined recursively: $L_{g}^{0}\\phi = \\phi$ and $L_{g}^{k}\\phi = L_{g}(L_{g}^{k-1}\\phi)$ for $k \\ge 1$.\n\nThe time derivative of an output component $y_j = h_j(x)$ (where we suppress the explicit dependence on the known input $u$ for notational clarity) along a system trajectory is $\\dot{y}_j = \\frac{d}{dt}h_j(x(t)) = (\\nabla h_j) \\cdot \\dot{x} = L_f h_j(x)$. Similarly, higher time derivatives of the output can be expressed as successive Lie derivatives: $\\frac{d^k y_j}{dt^k} = L_f^k h_j(x)$.\n\nThe observability of the system is determined by the \"information\" about the state $x$ contained in the outputs and their time derivatives. This information is captured by the gradients (differentials) of the successive Lie derivatives of the output functions. The collection of all such independent gradients spans the observability codistribution.\n\nThe observability rank condition states that a system is locally weakly observable at $x^{\\star}$ if the dimension of the observability space is equal to the dimension of the state space, $n$. This is checked by constructing the observability matrix, $\\mathcal{M}_{\\mathcal{O}}(x)$, whose rows are the gradients of the Lie derivatives of the output components:\n$$\n\\mathcal{M}_{\\mathcal{O}}(x) = \\begin{pmatrix}\n\\nabla (L_f^0 h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^0 h_p)(x) \\\\\n\\nabla (L_f^1 h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^1 h_p)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^{n-1} h_1)(x) \\\\\n\\vdots \\\\\n\\nabla (L_f^{n-1} h_p)(x)\n\\end{pmatrix}\n$$\nThe system is locally weakly observable at $x^{\\star}$ if $\\text{rank}(\\mathcal{M}_{\\mathcal{O}}(x^{\\star})) = n$. The problem specifies constructing a $3 \\times 3$ matrix from a particular subset of these rows.\n\n### Part 2: Application to the Fuel Cell Model\n\nThe system has a state dimension of $n=3$ and output dimension of $p=2$. The input is held constant at $u = u^{\\star} = 200\\,\\mathrm{A}$. This makes the system autonomous with the vector field $f(x) = (\\dot{x}_1, \\dot{x}_2, \\dot{x}_3)^\\top$ given by:\n$$\nf(x) = \\begin{pmatrix}\n-a(x_1 - \\alpha x_2) + b u^{\\star} \\\\\n\\frac{1}{C}(\\beta u^{\\star} - \\gamma(x_2 - T_a)) \\\\\n-\\delta u^{\\star} + \\varepsilon(p_s - x_3)\n\\end{pmatrix}\n$$\nThe output functions are:\n$$\nh_1(x) = E_0 + k_T x_2 \\ln(x_3) - \\frac{r_1}{x_1} - r_2 u^{\\star} - r_0 \\\\\nh_2(x) = x_2\n$$\nThe problem requires constructing a $3 \\times 3$ observability matrix from the rows $\\nabla h_1(x^\\star)$, $\\nabla h_2(x^\\star)$, and $\\nabla (L_f h_1)(x^\\star)$, evaluated at the operating point $x^{\\star} = \\begin{pmatrix} 5.0 & 350 & e \\end{pmatrix}^{\\top}$.\n\nFirst, we compute the necessary gradients symbolically.\nThe gradient of $h_1(x)$ is:\n$$\n\\nabla h_1(x) = \\begin{pmatrix} \\frac{\\partial h_1}{\\partial x_1}, & \\frac{\\partial h_1}{\\partial x_2}, & \\frac{\\partial h_1}{\\partial x_3} \\end{pmatrix} = \\begin{pmatrix} \\frac{r_1}{x_1^2} & k_T \\ln(x_3) & \\frac{k_T x_2}{x_3} \\end{pmatrix}\n$$\nThe gradient of $h_2(x)$ is:\n$$\n\\nabla h_2(x) = \\begin{pmatrix} \\frac{\\partial h_2}{\\partial x_1}, & \\frac{\\partial h_2}{\\partial x_2}, & \\frac{\\partial h_2}{\\partial x_3} \\end{pmatrix} = \\begin{pmatrix} 0 & 1 & 0 \\end{pmatrix}\n$$\nNext, we compute the Lie derivative $L_f h_1$:\n$$\nL_f h_1(x) = \\nabla h_1(x) \\cdot f(x) = \\left(\\frac{r_1}{x_1^2}\\right)f_1(x) + \\left(k_T \\ln(x_3)\\right)f_2(x) + \\left(\\frac{k_T x_2}{x_3}\\right)f_3(x)\n$$\nNow, we find the gradient of $L_f h_1(x)$.\n$\\frac{\\partial}{\\partial x_1}(L_f h_1) = \\frac{\\partial}{\\partial x_1}\\left(\\frac{r_1}{x_1^2} f_1(x)\\right) = \\frac{-2r_1}{x_1^3}f_1(x) + \\frac{r_1}{x_1^2}\\frac{\\partial f_1}{\\partial x_1} = \\frac{-2r_1}{x_1^3}(-a(x_1-\\alpha x_2)+bu^\\star) + \\frac{r_1}{x_1^2}(-a) = \\frac{r_1}{x_1^3}(ax_1 - 2a\\alpha x_2 - 2bu^\\star)$.\n\n$\\frac{\\partial}{\\partial x_2}(L_f h_1) = \\frac{\\partial}{\\partial x_2}\\left(\\frac{r_1}{x_1^2} f_1\\right) + \\frac{\\partial}{\\partial x_2}\\left(k_T \\ln(x_3) f_2\\right) + \\frac{\\partial}{\\partial x_2}\\left(\\frac{k_T x_2}{x_3} f_3\\right) = \\frac{r_1}{x_1^2}\\frac{\\partial f_1}{\\partial x_2} + k_T \\ln(x_3)\\frac{\\partial f_2}{\\partial x_2} + \\frac{k_T}{x_3}f_3 = \\frac{a \\alpha r_1}{x_1^2} - \\frac{\\gamma k_T}{C} \\ln(x_3) + \\frac{k_T}{x_3}(-\\delta u^\\star + \\varepsilon(p_s-x_3))$.\n\n$\\frac{\\partial}{\\partial x_3}(L_f h_1) = \\frac{\\partial}{\\partial x_3}\\left(k_T \\ln(x_3) f_2\\right) + \\frac{\\partial}{\\partial x_3}\\left(\\frac{k_T x_2}{x_3} f_3\\right) = \\frac{k_T}{x_3}f_2 + \\frac{k_T x_2}{-x_3^2}f_3 + \\frac{k_T x_2}{x_3}\\frac{\\partial f_3}{\\partial x_3} = \\frac{k_T}{x_3}f_2 - \\frac{k_T x_2}{x_3^2}f_3 + \\frac{k_T x_2}{x_3}(-\\varepsilon) = \\frac{k_T}{x_3}f_2 - \\frac{k_T x_2}{x_3^2}(-\\delta u^\\star + \\varepsilon p_s) - \\frac{2k_T x_2 \\varepsilon}{x_3}$. A simpler path yields $\\frac{k_T}{C x_3}(\\beta u^\\star - \\gamma(x_2 - T_a)) + \\frac{k_T x_2}{x_3^2}(\\delta u^\\star - \\varepsilon p_s)$.\n\nWe evaluate these gradients at $x^{\\star} = \\begin{pmatrix} 5 & 350 & e\\end{pmatrix}^{\\top}$ with $u^{\\star}=200\\,\\mathrm{A}$.\nParameters: $a=0.1$, $\\alpha=0.02$, $b=5\\times 10^{-3}$, $C=500$, $\\beta=0.6$, $\\gamma=50$, $T_a=298$, $\\delta=10^{-3}$, $\\varepsilon=0.2$, $p_s=2$, $r_1=0.02$.\n$k_T = \\frac{R}{2F} = \\frac{8.314}{2 \\times 96485} \\approx 4.3084 \\times 10^{-5}$.\n\nRow 1: $\\nabla h_1(x^{\\star})$\n$\\frac{\\partial h_1}{\\partial x_1}\\bigg|_{x^\\star} = \\frac{0.02}{5^2} = 0.0008$.\n$\\frac{\\partial h_1}{\\partial x_2}\\bigg|_{x^\\star} = k_T \\ln(e) = k_T \\approx 4.3084 \\times 10^{-5}$.\n$\\frac{\\partial h_1}{\\partial x_3}\\bigg|_{x^\\star} = k_T \\frac{350}{e} \\approx 128.755 k_T \\approx 5.5473 \\times 10^{-3}$.\n$\\nabla h_1(x^{\\star}) \\approx \\begin{pmatrix} 8 \\times 10^{-4} & 4.3084 \\times 10^{-5} & 5.5473 \\times 10^{-3} \\end{pmatrix}$.\n\nRow 2: $\\nabla h_2(x^{\\star})$\n$\\nabla h_2(x^{\\star}) = \\begin{pmatrix} 0 & 1 & 0 \\end{pmatrix}$.\n\nRow 3: $\\nabla (L_f h_1)(x^{\\star})$\n$\\frac{\\partial}{\\partial x_1}(L_f h_1)\\bigg|_{x^\\star} = \\frac{0.02}{5^3}(0.1(5) - 2(0.1)(0.02)(350) - 2(0.005)(200)) = \\frac{0.02}{125}(0.5 - 1.4 - 2) = -0.000464$.\n$\\frac{\\partial}{\\partial x_2}(L_f h_1)\\bigg|_{x^\\star} = \\frac{0.1(0.02)(0.02)}{5^2} - \\frac{50 k_T}{500}(1) + \\frac{k_T}{e}(-10^{-3}(200) + 0.2(2-e)) = 1.6 \\times 10^{-6} - 0.1 k_T + \\frac{k_T}{e}(0.2 - 0.2e) = 1.6 \\times 10^{-6} - 0.2264 k_T \\approx -8.154 \\times 10^{-6}$.\n$\\frac{\\partial}{\\partial x_3}(L_f h_1)\\bigg|_{x^\\star} = \\frac{k_T}{500e}(0.6(200) - 50(350-298)) + \\frac{k_T(350)}{e^2}(10^{-3}(200) - 0.2(2)) = \\frac{k_T}{500e}(-2480) + \\frac{350k_T}{e^2}(-0.2) = k_T(-\\frac{4.96}{e} - \\frac{70}{e^2}) \\approx -11.298 k_T \\approx -4.8675 \\times 10^{-4}$.\n$\\nabla (L_f h_1)(x^{\\star}) \\approx \\begin{pmatrix} -4.64 \\times 10^{-4} & -8.154 \\times 10^{-6} & -4.8675 \\times 10^{-4} \\end{pmatrix}$.\n\nThe observability matrix $\\mathcal{M}$ is:\n$$\n\\mathcal{M} = \\begin{pmatrix} \\nabla h_1(x^{\\star}) \\\\ \\nabla h_2(x^{\\star}) \\\\ \\nabla (L_f h_1)(x^{\\star}) \\end{pmatrix} \\approx \\begin{pmatrix} 8 \\times 10^{-4} & 4.3084 \\times 10^{-5} & 5.5473 \\times 10^{-3} \\\\ 0 & 1 & 0 \\\\ -4.64 \\times 10^{-4} & -8.154 \\times 10^{-6} & -4.8675 \\times 10^{-4} \\end{pmatrix}\n$$\nTo find the rank, we compute the determinant of $\\mathcal{M}$. Expanding along the second row simplifies the calculation:\n$$\n\\det(\\mathcal{M}) = (1) \\cdot \\det \\begin{pmatrix} 8 \\times 10^{-4} & 5.5473 \\times 10^{-3} \\\\ -4.64 \\times 10^{-4} & -4.8675 \\times 10^{-4} \\end{pmatrix}\n$$\n$$\n\\det(\\mathcal{M}) \\approx (8 \\times 10^{-4})(-4.8675 \\times 10^{-4}) - (5.5473 \\times 10^{-3})(-4.64 \\times 10^{-4})\n$$\n$$\n\\det(\\mathcal{M}) \\approx -3.894 \\times 10^{-7} - (-2.574 \\times 10^{-6}) = -0.3894 \\times 10^{-6} + 2.574 \\times 10^{-6} = 2.1846 \\times 10^{-6}\n$$\nSince the determinant is non-zero, the matrix $\\mathcal{M}$ is of full rank. The rank of the constructed observability matrix is $3$.",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "Moving from a model's structure to its parameters, we recognize that not all parameters equally influence the model's output. Complex, physics-based models often contain many parameters, and identifying all of them with high precision can be infeasible. This practice  demonstrates how to use sensitivity analysis to quantify the impact of a specific parameter—the overall heat transfer conductance—on a chiller's cooling capacity. This skill is essential for prioritizing which parameters to focus on during model calibration and for understanding model uncertainty.",
            "id": "4108755",
            "problem": "A vapor-compression chiller’s evaporator is modeled for nonlinear system identification using first-principles heat exchange and energy balance. The model output is the cooling capacity $Q_{e}$, and a key parameter is the evaporator overall heat transfer conductance $U_{e}A_{e}$. To prioritize model refinement, you are asked to compute the local sensitivity $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$ at a specified operating point.\n\nAssume the refrigerant evaporates isothermally at saturation temperature $T_{e}$ and the chilled water flows through the evaporator with mass flow rate $\\dot{m}_{w}$ and specific heat capacity $c_{p}$. The chilled-water inlet temperature is $T_{w,\\mathrm{in}}$, and the outlet temperature is $T_{w,\\mathrm{out}}$. The evaporator heat transfer obeys the standard log-mean temperature difference (LMTD) relation for an isothermal hot or cold side and single-phase liquid on the other side. The governing relations are:\n- Energy balance on the water side: $$Q_{e} = \\dot{m}_{w} c_{p} \\bigl(T_{w,\\mathrm{in}} - T_{w,\\mathrm{out}}\\bigr).$$\n- Log-mean temperature difference (LMTD): $$\\Delta T_{\\mathrm{lm}} = \\frac{\\bigl(T_{w,\\mathrm{in}} - T_{e}\\bigr) - \\bigl(T_{w,\\mathrm{out}} - T_{e}\\bigr)}{\\ln\\!\\left(\\frac{T_{w,\\mathrm{in}} - T_{e}}{T_{w,\\mathrm{out}} - T_{e}}\\right)}.$$\n- Heat transfer rate: $$Q_{e} = (U_{e}A_{e})\\,\\Delta T_{\\mathrm{lm}}.$$\n\nUsing only these relations, derive an analytic expression for $Q_{e}$ as a function of $(U_{e}A_{e})$ by eliminating $T_{w,\\mathrm{out}}$, and from that expression obtain the sensitivity $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$ in closed form. Evaluate the sensitivity at the baseline operating point:\n$$\\dot{m}_{w} = 10~\\mathrm{kg/s},\\quad c_{p} = 4.186~\\mathrm{kJ/(kg\\,K)},\\quad T_{w,\\mathrm{in}} = 12~\\mathrm{^\\circ C},\\quad T_{e} = 5~\\mathrm{^\\circ C},\\quad (U_{e}A_{e}) = 35~\\mathrm{kW/K}.$$\n\nExpress your final numerical value for $\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}$ in Kelvin. Round your answer to four significant figures.",
            "solution": "We begin from first principles appropriate to energy systems modeling: conservation of energy on the water side and the well-tested log-mean temperature difference (LMTD) formulation for heat exchanger analysis.\n\nDefine the water-side heat capacity rate as $$M \\equiv \\dot{m}_{w} c_{p}.$$ The water-side energy balance gives\n$$Q_{e} = M \\bigl(T_{w,\\mathrm{in}} - T_{w,\\mathrm{out}}\\bigr),$$\nso the outlet temperature can be expressed in terms of $Q_{e}$:\n$$T_{w,\\mathrm{out}} = T_{w,\\mathrm{in}} - \\frac{Q_{e}}{M}.$$\n\nLet the inlet temperature difference relative to the evaporating refrigerant be\n$$\\Delta T_{1} \\equiv T_{w,\\mathrm{in}} - T_{e},$$\nand the outlet temperature difference be\n$$\\Delta T_{2} \\equiv T_{w,\\mathrm{out}} - T_{e} = \\bigl(T_{w,\\mathrm{in}} - \\frac{Q_{e}}{M}\\bigr) - T_{e} = \\Delta T_{1} - \\frac{Q_{e}}{M}.$$\n\nFor an isothermal refrigerant side, the LMTD between the water and refrigerant is\n$$\\Delta T_{\\mathrm{lm}} = \\frac{\\Delta T_{1} - \\Delta T_{2}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{2}}\\right)}.$$\nSubstituting $\\Delta T_{2} = \\Delta T_{1} - \\frac{Q_{e}}{M}$ gives\n$$\\Delta T_{\\mathrm{lm}} = \\frac{\\frac{Q_{e}}{M}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\n\nThe evaporator heat transfer relation $Q_{e} = (U_{e}A_{e})\\,\\Delta T_{\\mathrm{lm}}$ then yields the implicit equation\n$$Q_{e} = (U_{e}A_{e}) \\cdot \\frac{\\frac{Q_{e}}{M}}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\nAssuming $Q_{e} > 0$, divide both sides by $Q_{e}$ to obtain\n$$1 = \\frac{(U_{e}A_{e})}{M} \\cdot \\frac{1}{\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right)}.$$\nInvert to isolate the logarithm:\n$$\\ln\\!\\left(\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}}\\right) = \\frac{(U_{e}A_{e})}{M}.$$\nExponentiate both sides:\n$$\\frac{\\Delta T_{1}}{\\Delta T_{1} - \\frac{Q_{e}}{M}} = \\exp\\!\\left(\\frac{(U_{e}A_{e})}{M}\\right).$$\nSolve for $Q_{e}$:\n$$\\Delta T_{1} - \\frac{Q_{e}}{M} = \\Delta T_{1}\\,\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right),$$\n$$\\frac{Q_{e}}{M} = \\Delta T_{1}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right],$$\n$$Q_{e}\\bigl((U_{e}A_{e})\\bigr) = M\\,\\Delta T_{1}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right].$$\n\nThis is a closed-form nonlinear map of output $Q_{e}$ to parameter $(U_{e}A_{e})$, derived solely from energy balance and LMTD. The sensitivity needed for parameter prioritization is the partial derivative of $Q_{e}$ with respect to $(U_{e}A_{e})$:\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})} = M\\,\\Delta T_{1} \\cdot \\frac{\\partial}{\\partial (U_{e}A_{e})}\\left[1 - \\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right] = M\\,\\Delta T_{1}\\left[\\frac{1}{M}\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right)\\right].$$\nThis simplifies to\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})} = \\Delta T_{1}\\,\\exp\\!\\left(-\\frac{(U_{e}A_{e})}{M}\\right).$$\n\nEvaluate at the given operating point. First compute\n$$M = \\dot{m}_{w} c_{p} = 10~\\mathrm{kg/s} \\times 4.186~\\mathrm{kJ/(kg\\,K)} = 41.86~\\mathrm{kW/K},$$\nand\n$$\\Delta T_{1} = T_{w,\\mathrm{in}} - T_{e} = 12 - 5 = 7~\\mathrm{K}.$$\nNow substitute $(U_{e}A_{e}) = 35~\\mathrm{kW/K}$:\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}\\bigg|_{(U_{e}A_{e})=35} = 7 \\,\\exp\\!\\left(-\\frac{35}{41.86}\\right).$$\nCompute the exponential factor:\n$$\\frac{35}{41.86} \\approx 0.83612,$$\nso\n$$\\exp(-0.83612) \\approx 0.43338.$$\nTherefore,\n$$\\frac{\\partial Q_{e}}{\\partial (U_{e}A_{e})}\\bigg|_{(U_{e}A_{e})=35} \\approx 7 \\times 0.43338 \\approx 3.034~\\mathrm{K}.$$\n\nThis sensitivity quantifies how many Kelvin of cooling-capacity change (in the sense of $(\\mathrm{kW})/(\\mathrm{kW/K})$ which reduces to Kelvin) arises per unit change in $(U_{e}A_{e})$ near the operating point. It provides a principled metric to prioritize refining $(U_{e}A_{e})$ within the nonlinear system identification of the chiller.",
            "answer": "$$\\boxed{3.034}$$"
        },
        {
            "introduction": "The quality of any identified model is fundamentally limited by the quality of the data from which it was learned. This final practice  addresses the crucial and highly practical task of experiment design. You will design an input current profile for a battery that is \"persistently exciting\" enough to reveal its nonlinear electro-thermal dynamics, while simultaneously operating within strict safety constraints. This exercise synthesizes system simulation, signal design, and statistical measures of information to solve a core problem in modern energy systems engineering.",
            "id": "4108722",
            "problem": "Design an input sequence using Pseudo-Random Binary Sequence (PRBS) to excite a battery component for nonlinear system identification subject to safety constraints. Consider a single-cell battery modeled by the following well-tested and physically grounded relationships derived from charge conservation and thermal energy balance laws. Let the sampling interval be $\\Delta t$, the current be $I_k$ at sample $k$, the state of charge be $\\mathrm{SOC}_k$ (unitless fraction in $[0,1]$), and the temperature be $T_k$ (in $\\mathrm{K}$). The charge conservation is given by the differential equation $\\frac{d\\,\\mathrm{SOC}}{dt} = -\\frac{I(t)}{Q}$, where $Q$ is the capacity in $\\mathrm{C}$; in discrete time, use the forward Euler update $\\mathrm{SOC}_{k+1} = \\mathrm{SOC}_k - \\frac{I_k \\Delta t}{Q}$. The thermal balance follows $C_{\\mathrm{th}} \\frac{d T}{dt} = R_h I^2(t) - h (T(t) - T_{\\mathrm{amb}})$, where $C_{\\mathrm{th}}$ is the thermal capacitance in $\\mathrm{J}/\\mathrm{K}$, $R_h$ is the heat generation coefficient in $\\mathrm{W}/\\mathrm{A}^2$, $h$ is the heat transfer coefficient in $\\mathrm{W}/\\mathrm{K}$, and $T_{\\mathrm{amb}}$ is ambient temperature in $\\mathrm{K}$; discretize by $T_{k+1} = T_k + \\Delta t \\left( \\frac{R_h I_k^2 - h (T_k - T_{\\mathrm{amb}})}{C_{\\mathrm{th}}} \\right)$. The PRBS excitation must satisfy the following constraints at all time steps $k$: (i) magnitude constraint $\\lvert I_k \\rvert \\le I_{\\max}$, (ii) slew-rate constraint $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$, (iii) state-of-charge bound $\\mathrm{SOC}_{\\min} \\le \\mathrm{SOC}_k \\le \\mathrm{SOC}_{\\max}$, and (iv) temperature bound $T_k \\le T_{\\max}$.\n\nFor identifiability of nonlinear dynamics, evaluate the Fisher Information Matrix (FIM) for a polynomial Hammerstein-like regressor based on the measured signals. Define an auxiliary dynamic state $x_k$ through $x_{k+1} = a x_k + b I_k + c I_k^2$, with $x_0 = 0$ and known stable $a$, $b$, and $c$ constants. Build a regressor vector at each time step $k$ as $\\psi_k = \\begin{bmatrix} 1 & \\mathrm{SOC}_k & \\mathrm{SOC}_k^2 & I_k & I_k^2 & x_k \\end{bmatrix}^{\\top}$ and the stacked regressor matrix $\\Psi = \\begin{bmatrix} \\psi_0^{\\top} \\\\ \\psi_1^{\\top} \\\\ \\cdots \\\\ \\psi_{N-1}^{\\top} \\end{bmatrix}$ for a sequence of $N$ samples. Use the normalized Fisher Information Matrix $F = \\frac{1}{N} \\Psi^{\\top} \\Psi$ (assuming unit measurement noise variance), and define the identifiability metric as the minimum eigenvalue $\\lambda_{\\min}(F)$. The design objective is to generate a PRBS current sequence that is persistently exciting enough to make $\\lambda_{\\min}(F)$ exceed a given threshold while satisfying the safety constraints. The PRBS should be constructed by a linear-feedback shift register (LFSR) of a specified order with known taps to produce a deterministic bit sequence, mapped to setpoints in $\\{-I_{\\max}, +I_{\\max}\\}$, then passed through a discrete-time slew-rate limiter to produce $I_k$. To mitigate thermal violations while preserving persistence, implement a simple amplitude envelope that halves the setpoint magnitude when $T_k$ exceeds a pre-warning threshold $T_{\\mathrm{pre}} = T_{\\max} - \\delta_T$, where $\\delta_T$ is a small margin; otherwise, use full setpoint magnitude. No other constraint-specific adaptation is permitted. If any safety constraint is violated at any time, or if the identifiability metric $\\lambda_{\\min}(F)$ does not exceed the provided threshold $\\gamma_{\\mathrm{th}}$, report failure.\n\nYour program must:\n- Construct the PRBS bitstream using an LFSR of order $p$ with taps defined for feedback, producing exactly $n_{\\mathrm{bits}}$ bits.\n- Map bits to current setpoints in $\\{-I_{\\max}, +I_{\\max}\\}$, apply an amplitude envelope that uses half amplitude when $T_k \\ge T_{\\mathrm{pre}}$, else full amplitude, and pass through a slew-rate limiter to enforce $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$ and $\\lvert I_k \\rvert \\le I_{\\max}$.\n- Simulate $\\mathrm{SOC}_k$ and $T_k$ using the discrete dynamics above with initial conditions $\\mathrm{SOC}_0$ and $T_0$.\n- Build $\\Psi$, compute $F$, and return $\\lambda_{\\min}(F)$ if and only if all constraints are satisfied and $\\lambda_{\\min}(F) \\ge \\gamma_{\\mathrm{th}}$; otherwise return $-1.0$.\n\nExpress all physical quantities consistently in International System of Units (SI), current in $\\mathrm{A}$, time in $\\mathrm{s}$, temperature in $\\mathrm{K}$. Angles do not apply. The final output format must be a single line containing a comma-separated list of floats enclosed in square brackets.\n\nUse the following test suite, where each case specifies parameters $(\\Delta t, n_{\\mathrm{bits}}, \\text{dwell}, I_{\\max}, S_{\\max}, Q, \\mathrm{SOC}_0, \\mathrm{SOC}_{\\min}, \\mathrm{SOC}_{\\max}, C_{\\mathrm{th}}, R_h, h, T_{\\mathrm{amb}}, T_0, T_{\\max}, a, b, c, p, \\text{taps}, \\gamma_{\\mathrm{th}}, \\delta_T)$:\n- Case $1$ (happy path, feasible and informative):\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 6.0$, $S_{\\max} = 3.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$.\n- Case $2$ (thermal violation due to high heating, should fail):\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 8.0$, $S_{\\max} = 6.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 5.0$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 305.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0001$, $\\delta_T = 1.0$.\n- Case $3$ (state-of-charge drift due to long dwell, should fail):\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 6.0$, $I_{\\max} = 20.0$, $S_{\\max} = 100.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.49$, $\\mathrm{SOC}_{\\max} = 0.51$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.1$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$.\n- Case $4$ (low amplitude, poor identifiability, should fail on identifiability threshold):\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 1.0$, $I_{\\max} = 1.0$, $S_{\\max} = 3.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.001$, $\\delta_T = 2.0$.\n- Case $5$ (short dwell, high-frequency excitation, feasible and informative):\n  - $\\Delta t = 0.1$, $n_{\\mathrm{bits}} = 63$, $\\text{dwell} = 0.2$, $I_{\\max} = 6.0$, $S_{\\max} = 20.0$, $Q = 36000$, $\\mathrm{SOC}_0 = 0.5$, $\\mathrm{SOC}_{\\min} = 0.2$, $\\mathrm{SOC}_{\\max} = 0.8$, $C_{\\mathrm{th}} = 500.0$, $R_h = 0.15$, $h = 2.0$, $T_{\\mathrm{amb}} = 298.0$, $T_0 = 298.0$, $T_{\\max} = 315.0$, $a = 0.95$, $b = 0.05$, $c = 0.01$, $p = 6$, $\\text{taps} = [5,4]$, $\\gamma_{\\mathrm{th}} = 0.0005$, $\\delta_T = 2.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $\\texttt{[r_1,r_2,r_3,r_4,r_5]}$, where each $r_i$ is either the computed $\\lambda_{\\min}(F)$ as a float if constraints are satisfied and $\\lambda_{\\min}(F) \\ge \\gamma_{\\mathrm{th}}$, or $-1.0$ otherwise. All numeric outputs must be in base units with no additional text.",
            "solution": "The problem requires the design and evaluation of a Pseudo-Random Binary Sequence (PRBS) input for the nonlinear system identification of a battery cell. The process involves generating the input signal, simulating the battery's electro-thermal response, checking for violations of operational safety constraints, and evaluating the quality of the resulting data for system identification using the Fisher Information Matrix (FIM). A detailed, step-by-step methodology is executed as follows.\n\n### Step 1: PRBS Generation\nThe core of the excitation signal is a PRBS generated by a Linear-Feedback Shift Register (LFSR). An LFSR is a shift register whose input bit is a linear function (specifically, an exclusive-or, XOR) of its previous state.\n\nFor an LFSR of order $p$ with specified taps, the procedure to generate a sequence of $n_{\\mathrm{bits}}$ is as follows:\n1.  Initialize a register of $p$ bits. A standard non-zero initial state, such as all ones, is used: $\\text{reg} = [1, 1, \\dots, 1]$.\n2.  For each of the $n_{\\mathrm{bits}}$ to be generated:\n    a. The output bit is the last bit of the register.\n    b. A feedback bit is computed by taking the XOR sum of the bits at positions specified by the `taps` array. Assuming the taps are 1-indexed, the feedback is $\\bigoplus_{i \\in \\text{taps}} \\text{reg}[i-1]$.\n    c. The register is shifted (e.g., to the right), and the feedback bit is inserted at the beginning.\nThis process produces a deterministic, repeatable pseudo-random sequence of bits.\n\n### Step 2: Input Current Sequence Generation and Shaping\nThe raw bitstream from the LFSR is transformed into a continuous-time current signal, $I(t)$, subject to several layers of shaping to ensure safety and feasibility.\n\n1.  **Dwell Time**: Each bit in the PRBS sequence is held for a constant duration, $\\text{dwell}$. Given a sampling time $\\Delta t$, each bit corresponds to $m = \\text{dwell} / \\Delta t$ discrete time steps. The total number of simulation steps is $N = n_{\\mathrm{bits}} \\times m$.\n\n2.  **Setpoint Mapping**: The binary sequence (0s and 1s) is mapped to current setpoints. A standard mapping is used where bit $0$ corresponds to a charging current of $-I_{\\mathrm{set}}$ and bit $1$ corresponds to a discharging current of $+I_{\\mathrm{set}}$.\n\n3.  **Thermal-Aware Amplitude Envelope**: To prevent overheating, a simple feedback mechanism adjusts the magnitude of the current setpoint, $I_{\\mathrm{set}}$, based on the current cell temperature $T_k$. A pre-warning temperature threshold is defined as $T_{\\mathrm{pre}} = T_{\\max} - \\delta_T$. The setpoint magnitude is determined at each time step $k$ as:\n    $$\n    I_{\\mathrm{set}, k} = \n    \\begin{cases} \n    0.5 \\times I_{\\max} & \\text{if } T_k \\ge T_{\\mathrm{pre}} \\\\\n    I_{\\max} & \\text{if } T_k < T_{\\mathrm{pre}}\n    \\end{cases}\n    $$\n    The target current for the slew-rate limiter at step $k$, let's call it $I_{\\text{target}, k}$, is then $(2 \\times \\text{bit}_k - 1) \\times I_{\\mathrm{set}, k}$, where $\\text{bit}_k$ is the PRBS bit for the current time interval.\n\n4.  **Slew-Rate and Magnitude Limiting**: Physical actuators have finite response speed. This is modeled by a slew-rate limiter. The change in current between consecutive steps is limited by $|\\Delta I| \\le S_{\\max} \\Delta t$. The actual current $I_k$ is generated from the previous current $I_{k-1}$ and the target $I_{\\text{target}, k}$:\n    $$\n    \\Delta I_{\\text{unconstrained}} = I_{\\text{target}, k} - I_{k-1}\n    $$\n    $$\n    \\Delta I_{\\text{limited}} = \\max(-S_{\\max}\\Delta t, \\min(S_{\\max}\\Delta t, \\Delta I_{\\text{unconstrained}}))\n    $$\n    $$\n    I_k' = I_{k-1} + \\Delta I_{\\text{limited}}\n    $$\n    Finally, the signal is clamped to adhere to the absolute magnitude constraint $|I_k| \\le I_{\\max}$:\n    $$\n    I_k = \\max(-I_{\\max}, \\min(I_{\\max}, I_k'))\n    $$\n\n### Step 3: Battery State Simulation\nWith the input current sequence $\\{I_k\\}_{k=0}^{N-1}$ fully defined, the battery's state variables, State of Charge ($\\mathrm{SOC}_k$) and Temperature ($T_k$), are simulated over time using the provided discrete-time models.\n\n- **Initial Conditions**: The simulation starts with the given initial state $(\\mathrm{SOC}_0, T_0)$. The initial current $I_{-1}$ required for the first slew-rate calculation is assumed to be $0$.\n\n- **State Update Equations**: For each time step $k = 0, 1, \\dots, N-1$:\n    - The SOC is updated using the forward Euler method for charge conservation:\n      $$\n      \\mathrm{SOC}_{k+1} = \\mathrm{SOC}_k - \\frac{I_k \\Delta t}{Q}\n      $$\n    - The temperature is updated based on the thermal energy balance:\n      $$\n      T_{k+1} = T_k + \\frac{\\Delta t}{C_{\\mathrm{th}}} \\left( R_h I_k^2 - h (T_k - T_{\\mathrm{amb}}) \\right)\n      $$\nSimultaneously, the auxiliary state $x_k$ for the regressor is also propagated:\n    $$\n    x_{k+1} = a x_k + b I_k + c I_k^2\n    $$\n    with $x_0 = 0$.\n\n### Step 4: Constraint Verification\nSafety is paramount. The simulation is monitored at every time step to ensure all constraints are met.\nThe constraints are:\n1.  $\\lvert I_k \\rvert \\le I_{\\max}$ (enforced by the input shaping).\n2.  $\\lvert I_{k+1} - I_k \\rvert \\le S_{\\max} \\Delta t$ (enforced by the input shaping).\n3.  $\\mathrm{SOC}_{\\min} \\le \\mathrm{SOC}_k \\le \\mathrm{SOC}_{\\max}$ for all $k \\in [0, N]$.\n4.  $T_k \\le T_{\\max}$ for all $k \\in [0, N]$.\n\nThe simulation is halted immediately if any of the SOC or temperature constraints are violated. In such a case, the experiment is deemed a failure.\n\n### Step 5: Identifiability Analysis via Fisher Information Matrix\nIf the simulation completes without any constraint violations, the \"richness\" or \"information content\" of the collected data is evaluated. This is crucial for ensuring that model parameters can be reliably estimated.\n\n1.  **Regressor Matrix Construction**: A regressor vector $\\psi_k$ is formed at each time step $k=0, \\dots, N-1$:\n    $$\n    \\psi_k = \\begin{bmatrix} 1 & \\mathrm{SOC}_k & \\mathrm{SOC}_k^2 & I_k & I_k^2 & x_k \\end{bmatrix}^{\\top}\n    $$\n    These vectors are stacked to form the $N \\times 6$ regressor matrix $\\Psi$:\n    $$\n    \\Psi = \\begin{bmatrix} \\psi_0^{\\top} \\\\ \\psi_1^{\\top} \\\\ \\vdots \\\\ \\psi_{N-1}^{\\top} \\end{bmatrix}\n    $$\n\n2.  **FIM Calculation**: The normalized Fisher Information Matrix (FIM) is computed as:\n    $$\n    F = \\frac{1}{N} \\Psi^{\\top} \\Psi\n    $$\n    The FIM is a symmetric, positive semi-definite matrix. Its eigenvalues quantify the information content along different directions in the parameter space.\n\n3.  **Identifiability Metric**: The minimum eigenvalue of the FIM, $\\lambda_{\\min}(F)$, is used as the scalar metric for identifiability. A small or zero $\\lambda_{\\min}(F)$ indicates that the columns of $\\Psi$ are nearly linearly dependent, meaning some parameters are unidentifiable from the data.\n\n### Step 6: Final Decision Logic\nThe outcome of the procedure is determined by the following logic:\n- If the simulation fails at any point due to a constraint violation, the result is $-1.0$.\n- If the simulation completes successfully, $\\lambda_{\\min}(F)$ is calculated.\n- If $\\lambda_{\\min}(F)$ is greater than or equal to the specified threshold $\\gamma_{\\mathrm{th}}$, the experiment is successful, and the result is the value of $\\lambda_{\\min}(F)$.\n- If $\\lambda_{\\min}(F)$ is less than $\\gamma_{\\mathrm{th}}$, the excitation is not \"persistently exciting\" enough, and the result is $-1.0$.\nThis comprehensive procedure ensures that the generated input signal is not only safe but also effective for the purpose of system identification.",
            "answer": "[0.0005314, -1.0, -1.0, -1.0, 0.0007182]"
        }
    ]
}