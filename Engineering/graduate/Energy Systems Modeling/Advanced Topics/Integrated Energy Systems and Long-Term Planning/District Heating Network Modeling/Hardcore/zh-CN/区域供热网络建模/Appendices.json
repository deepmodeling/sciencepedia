{
    "hands_on_practices": [
        {
            "introduction": "在区域供热管网中，循环泵是驱动热水流动的核心部件。为了准确模拟管网在不同工况下的动态行为，特别是当采用变速控制时，我们必须能够预测泵的性能如何随其转速而变化。这个练习  将指导您应用流体机械中的基本相似定律（或称“亲和定律”），从一个已知的性能曲线推导出新转速下的性能曲线，这是所有液压网络建模的一项基本技能。",
            "id": "4086272",
            "problem": "一台离心泵在一个区域供热网络的供水总管中循环输送水。在不同运行工况下，该泵的叶轮几何相似，叶轮直径 $D$ 固定。流体是水，其热物理性质近似恒定，运行状态为完全湍流，因此粘性效应可作一级近似忽略。从涡轮机械和量纲分析的基本原理（特别是欧拉涡轮机方程和白金汉π定理）出发，推导并陈述对于在动力学相似点上运行的几何相似泵，其体积流量 $Q$、泵扬程 $H$ 和轴功率 $P$ 与转速 $n$ 和叶轮直径 $D$ 之间的相似（亲和）定律。然后，应用这些定律来预测同一叶轮在新转速下的扬程-流量特性曲线。\n\n在初始转速 $n_{1} = 1480$ 转/分钟（记为 $\\mathrm{r/min}$），叶轮直径恒定为 $D = 0.30$ 米时，测得的水泵特性曲线为\n$$\nH_{n_{1}}(q) = 32 - 8000\\,q^{2},\n$$\n其中 $H$ 是以米为单位的扬程，$q$ 是以 $\\mathrm{m^{3}\\!/s}$ 为单位的体积流量。假设叶轮直径保持不变，且在不同转速下流动条件保持动力学相似，使用您推导的亲和定律，得到在更高转速 $n_{2} = 1760$ $\\mathrm{r/min}$ 下的扬程-流量特性曲线 $H_{n_{2}}(q)$ 的显式解析表达式。将最终的扬程-流量函数表示为以米为单位的扬程关于以 $\\mathrm{m^{3}\\!/s}$ 为单位的 $q$ 的函数。无需四舍五入；以精确形式给出表达式。",
            "solution": "该问题要求从基本原理推导泵的亲和定律，并随后应用这些定律来确定一台在不同转速下运行的离心泵的新扬程-流量特性曲线。\n\n### 步骤1：问题验证\n\n**1.1. 提取已知条件：**\n- 泵类型：离心泵，叶轮几何相似。\n- 叶轮直径：$D$，恒定。\n- 流体：水，热物理性质恒定。\n- 流动状态：完全湍流，忽略粘性效应。\n- 推导依据：欧拉涡轮机方程和白金汉π定理。\n- 需关联的变量：体积流量 $Q$，泵扬程 $H$，轴功率 $P$，转速 $n$，叶轮直径 $D$。\n- 初始条件：在转速 $n_{1} = 1480 \\, \\mathrm{r/min}$ 时，扬程-流量特性为 $H_{n_{1}}(q) = 32 - 8000\\,q^{2}$，其中 $H$ 的单位是米，$q$ 的单位是 $\\mathrm{m^{3}/s}$。直径为 $D = 0.30 \\, \\mathrm{m}$。\n- 目标条件：确定在新转速 $n_{2} = 1760 \\, \\mathrm{r/min}$ 下的扬程-流量特性 $H_{n_{2}}(q)$，假设叶轮直径固定且流动是动力学相似的。\n\n**1.2. 验证：**\n- **科学依据**：该问题基于流体力学和涡轮机械的基本且公认的原理，特别是量纲分析（白金汉π定理）和泵的性能换算（亲和定律）。欧拉涡轮机方程是该领域的基石。所有概念都具有科学合理性。\n- **良定性**：该问题是良定的。它提供了明确的目标、所有必要的数据（$n_1$、$n_2$ 和泵曲线的初始函数形式），以及一个关键条件（动力学相似性），从而能够得到唯一解。\n- **客观性**：该问题以精确、定量和客观的术语陈述，没有歧义或主观论断。\n\n**1.3. 结论：**\n该问题有效。它是能源系统和流体机械领域一个标准且表述清晰的问题。\n\n### 步骤2：亲和定律的推导\n\n亲和定律描述了在动力学相似条件下，泵的性能变量（$Q, H, P$）与运行参数（$n, D$）之间的关系。动力学相似性意味着流场几何相似，因此控制流动的无量纲群为常数。我们将通过白金汉π定理使用量纲分析法。\n\n相关的物理量如下：\n- 体积流量 $Q$ [量纲: $L^{3}T^{-1}$]\n- 扬程 $H$ [量纲: $L$]。更基本的方法是处理单位质量流体获得的能量 $gH$，其中 $g$ 是重力加速度。$gH$ 的量纲是 $(LT^{-2})(L) = L^{2}T^{-2}$。\n- 轴功率 $P$ [量纲: $ML^{2}T^{-3}$]\n- 转速 $n$ [量纲: $T^{-1}$]\n- 叶轮直径 $D$ [量纲: $L$]\n- 流体密度 $\\rho$ [量纲: $ML^{-3}$]\n\n问题陈述忽略粘性效应，因此不包括流体粘度 $\\mu$。我们有 6 个变量和 3 个基本量纲（质量 $M$、长度 $L$、时间 $T$）。根据白金汉π定理，将有 $6 - 3 = 3$ 个独立的无量纲群（Pi群）。\n\n我们选择 $\\rho$、$n$ 和 $D$ 作为重复变量，因为它们包含了所有基本量纲。\n\n**流量的Pi群 ($\\Pi_Q$):**\n我们寻求一个包含 $Q$ 的无量纲群。\n$$ \\Pi_Q = Q^{1} \\rho^{a} n^{b} D^{c} $$\n在量纲方面：\n$$ [\\Pi_Q] = (L^{3}T^{-1})^{1} (ML^{-3})^{a} (T^{-1})^{b} (L)^{c} = M^{0}L^{0}T^{0} $$\n对每个量纲的指数进行均衡：\n- $M: a = 0$\n- $T: -1 - b = 0 \\implies b = -1$\n- $L: 3 - 3a + c = 0 \\implies 3 - 0 + c = 0 \\implies c = -3$\n因此，流量系数为 $\\Pi_Q = \\frac{Q}{n D^{3}}$。\n\n**扬程的Pi群 ($\\Pi_H$):**\n我们寻求一个包含 $gH$ 的无量纲群。\n$$ \\Pi_H = (gH)^{1} \\rho^{a} n^{b} D^{c} $$\n在量纲方面：\n$$ [\\Pi_H] = (L^{2}T^{-2})^{1} (ML^{-3})^{a} (T^{-1})^{b} (L)^{c} = M^{0}L^{0}T^{0} $$\n对各量纲的指数进行均衡：\n- $M: a = 0$\n- $T: -2 - b = 0 \\implies b = -2$\n- $L: 2 - 3a + c = 0 \\implies 2 - 0 + c = 0 \\implies c = -2$\n因此，扬程系数为 $\\Pi_H = \\frac{gH}{n^{2}D^{2}}$。由于 $g$ 是常数，我们可以定义一个实用的扬程系数为 $\\frac{H}{n^{2}D^{2}}$。\n\n**功率的Pi群 ($\\Pi_P$):**\n我们寻求一个包含 $P$ 的无量纲群。\n$$ \\Pi_P = P^{1} \\rho^{a} n^{b} D^{c} $$\n在量纲方面：\n$$ [\\Pi_P] = (ML^{2}T^{-3})^{1} (ML^{-3})^{a} (T^{-1})^{b} (L)^{c} = M^{0}L^{0}T^{0} $$\n对各量纲的指数进行均衡：\n- $M: 1 + a = 0 \\implies a = -1$\n- $T: -3 - b = 0 \\implies b = -3$\n- $L: 2 - 3a + c = 0 \\implies 2 - 3(-1) + c = 0 \\implies 5 + c = 0 \\implies c = -5$\n因此，功率系数为 $\\Pi_P = \\frac{P}{\\rho n^{3}D^{5}}$。\n\n对于两个动力学相似的运行点 (1) 和 (2)，这些无量纲群必须相等。\n$$ \\frac{Q_1}{n_1 D_1^3} = \\frac{Q_2}{n_2 D_2^3} $$\n$$ \\frac{H_1}{n_1^2 D_1^2} = \\frac{H_2}{n_2^2 D_2^2} $$\n$$ \\frac{P_1}{\\rho_1 n_1^3 D_1^5} = \\frac{P_2}{\\rho_2 n_2^3 D_2^5} $$\n这些等式得出了通用的亲和定律：\n1.  **流量：** $\\frac{Q_2}{Q_1} = \\left(\\frac{n_2}{n_1}\\right) \\left(\\frac{D_2}{D_1}\\right)^3$\n2.  **扬程：** $\\frac{H_2}{H_1} = \\left(\\frac{n_2}{n_1}\\right)^2 \\left(\\frac{D_2}{D_1}\\right)^2$\n3.  **功率：** $\\frac{P_2}{P_1} = \\left(\\frac{\\rho_2}{\\rho_1}\\right) \\left(\\frac{n_2}{n_1}\\right)^3 \\left(\\frac{D_2}{D_1}\\right)^5$\n\n这些结果可以通过欧拉涡轮机方程得到验证，该方程指出理想扬程与叶轮尖端速度的平方成正比（$U \\propto nD$）。因此，$H \\propto (nD)^2$。流量是速度分量（$v \\propto nD$）和流动面积（$A \\propto D^2$）的乘积，所以 $Q \\propto nD^3$。功率与 $\\rho Q H$ 成正比，所以 $P \\propto \\rho (nD^3)(nD)^2 = \\rho n^3 D^5$。\n\n在此问题中，叶轮直径 $D$ 是固定的（$D_1=D_2$），流体是性质恒定的水（$\\rho_1 = \\rho_2$）。亲和定律简化为：\n1.  $\\frac{Q_2}{Q_1} = \\frac{n_2}{n_1}$\n2.  $\\frac{H_2}{H_1} = \\left(\\frac{n_2}{n_1}\\right)^2$\n3.  $\\frac{P_2}{P_1} = \\left(\\frac{n_2}{n_1}\\right)^3$\n\n### 步骤3：应用于泵特性曲线\n\n我们已知在转速 $n_1$ 下的初始泵特性曲线：\n$$ H_1 = H_{n_1}(q_1) = 32 - 8000 q_1^{2} $$\n这里，$(q_1, H_1)$ 代表在转速 $n_1$ 下特性曲线上的任意一点。\n\n我们想求出在转速 $n_2$ 下的新特性曲线 $H_2 = H_{n_2}(q_2)$。对于第一条曲线上的任意一点 $(q_1, H_1)$，在第二条曲线上都有一个与之对应的动力学相似点 $(q_2, H_2)$，它们通过亲和定律相关联。\n\n根据直径恒定时的亲和定律：\n$$ q_2 = q_1 \\left(\\frac{n_2}{n_1}\\right) \\implies q_1 = q_2 \\left(\\frac{n_1}{n_2}\\right) $$\n$$ H_2 = H_1 \\left(\\frac{n_2}{n_1}\\right)^2 $$\n\n我们可以通过代入法将 $H_2$ 表示为 $q_2$ 的函数。首先，将初始特性曲线代入 $H_2$ 的方程中：\n$$ H_2 = \\left( 32 - 8000 q_1^{2} \\right) \\left(\\frac{n_2}{n_1}\\right)^2 $$\n接下来，代入用 $q_2$ 表示的 $q_1$ 的表达式：\n$$ H_2 = \\left( 32 - 8000 \\left[q_2 \\left(\\frac{n_1}{n_2}\\right)\\right]^{2} \\right) \\left(\\frac{n_2}{n_1}\\right)^2 $$\n将因子 $\\left(\\frac{n_2}{n_1}\\right)^2$ 分配到括号内：\n$$ H_2 = 32 \\left(\\frac{n_2}{n_1}\\right)^2 - 8000 q_2^{2} \\left(\\frac{n_1}{n_2}\\right)^2 \\left(\\frac{n_2}{n_1}\\right)^2 $$\n第二项中的转速比相互抵消：\n$$ H_2 = 32 \\left(\\frac{n_2}{n_1}\\right)^2 - 8000 q_2^{2} $$\n该表达式给出了新扬程 $H_2$ 作为新流量 $q_2$ 的函数。我们可以将其写成新的特性函数 $H_{n_2}(q)$：\n$$ H_{n_2}(q) = 32 \\left(\\frac{n_2}{n_1}\\right)^2 - 8000 q^{2} $$\n\n现在，我们代入给定的转速数值：\n$n_1 = 1480 \\, \\mathrm{r/min}$\n$n_2 = 1760 \\, \\mathrm{r/min}$\n\n转速之比为：\n$$ \\frac{n_2}{n_1} = \\frac{1760}{1480} = \\frac{176}{148} = \\frac{44 \\times 4}{37 \\times 4} = \\frac{44}{37} $$\n该比值的平方为：\n$$ \\left(\\frac{n_2}{n_1}\\right)^2 = \\left(\\frac{44}{37}\\right)^2 = \\frac{44^2}{37^2} = \\frac{1936}{1369} $$\n现在我们计算新的截止扬程（常数项）：\n$$ 32 \\times \\frac{1936}{1369} = \\frac{61952}{1369} $$\n将此值代回 $H_{n_2}(q)$ 的函数中：\n$$ H_{n_2}(q) = \\frac{61952}{1369} - 8000 q^{2} $$\n这就是在新的转速 $n_2 = 1760 \\, \\mathrm{r/min}$ 下，扬程-流量特性的显式解析表达式，其中扬程 $H$ 的单位是米，流量 $q$ 的单位是 $\\mathrm{m^3/s}$。",
            "answer": "$$ \\boxed{\\frac{61952}{1369} - 8000 q^{2}} $$"
        },
        {
            "introduction": "在建立了泵等关键部件的模型之后，我们还需要对热量在管网中的传输过程进行建模。这通常涉及到求解描述平流和热损失的偏微分方程。这个实践练习  将引导您使用有限体积法，将连续的物理定律离散化，从而将一个复杂的物理问题转化为一个可执行的计算算法。这是从理论物理到实际仿真模型构建的关键一步。",
            "id": "4086279",
            "problem": "考虑区域供热网络中的一个单直管段，其横截面积恒定，流体为均匀、不可压缩流。假设为一维平推流，流体性质恒定，且与周围环境的热损失通过牛顿冷却定律建模。设 $x \\in [0,L]$ 表示沿管道的位置，$t \\ge 0$ 表示时间，$T(x,t)$ 为主体流体温度（单位为开尔文），$u$ 为恒定的轴向速度（单位为米/秒），$\\rho$ 为流体密度（单位为千克/立方米），$c$ 为比热容（单位为焦耳/千克·开尔文），$A$ 为管道横截面积（单位为平方米），$P$ 为管道湿周（单位为米），$h$ 为对流传热系数（单位为瓦特/平方米·开尔文），$T_g$ 为环境地温（单位为开尔文）。其基本出发点是长度为 $\\mathrm{d}x$ 的微分控制体的能量守恒定律，并结合用于壁面热损失的牛顿冷却定律。\n\n基于这些基础，通过将能量平衡方程除以 $\\rho c A$，可以将控制方程写成归一化形式，得到\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = -\\alpha \\left(T - T_g\\right),\n$$\n其中 $\\alpha = \\frac{h P}{\\rho c A}$ 的单位为秒的倒数。\n\n您的任务是：\n1. 从能量守恒和牛顿冷却定律出发，推导在一个均匀网格上的一阶迎风有限体积空间离散格式。该网格包含 $N$ 个宽度为 $\\Delta x = L/N$ 的控制体，单元中心索引为 $i = 0,1,\\dots,N-1$，单元面索引为 $i+\\tfrac{1}{2}$。使用时间步长为 $\\Delta t$ 的显式前向欧拉时间积分。根据 $u$ 的符号，采用迎风格式谨慎地构造对流面通量，并包含体积损失项。\n2. 写出单元平均温度 $T_i^n \\approx T(x_i, t^n)$ 从时间层 $n$推进到 $n+1$ 的最终离散更新法则。\n3. 对以下测试套件，实现单步更新（从 $t^n$ 推进到 $t^{n+1}=t^n+\\Delta t$）。在每种情况下，在区域入流处（如果 $u0$，则在 $x=0$ 处；如果 $u0$，则在 $x=L$ 处）使用适当的入流狄利克雷边界条件，并根据迎风格式对边界面通量进行一致性建模。所有温度单位必须为开尔文。所有速度单位必须为米/秒。所有长度单位必须为米。所有时间单位必须为秒。损失系数单位必须为秒的倒数。报告的答案需四舍五入到六位小数。\n\n定义均匀网格，其单元中心为 $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$，其中 $i=0,\\dots,N-1$。对于每种情况，按规定初始化 $T_i^n$，应用一个时间步长，并返回指定探针索引（从零开始）处的更新后温度。\n\n测试套件：\n- 情况 A（理想情况，正速度，中等损失）：$L = 100\\,\\mathrm{m}$，$N = 10$，$\\Delta t = 1\\,\\mathrm{s}$，$u = 0.5\\,\\mathrm{m/s}$，$\\alpha = 0.01\\,\\mathrm{s^{-1}}$，$T_g = 285\\,\\mathrm{K}$，$x=0$ 处的入流温度：$T_{\\mathrm{in}} = 350\\,\\mathrm{K}$。初始条件：对于所有 $i$，$T_i^n = 330\\,\\mathrm{K}$。探针索引：$i=3$。\n- 情况 B（零对流边界条件，纯损失）：$L = 50\\,\\mathrm{m}$，$N = 5$，$\\Delta t = 10\\,\\mathrm{s}$，$u = 0.0\\,\\mathrm{m/s}$，$\\alpha = 0.05\\,\\mathrm{s^{-1}}$，$T_g = 280\\,\\mathrm{K}$。由于 $u=0$，入流温度无关紧要。初始条件：对于所有 $i$，$T_i^n = 320\\,\\mathrm{K}$。探针索引：$i=2$。\n- 情况 C（边界情况，负速度，右边界入流）：$L = 80\\,\\mathrm{m}$，$N = 8$，$\\Delta t = 2\\,\\mathrm{s}$，$u = -0.3\\,\\mathrm{m/s}$，$\\alpha = 0.02\\,\\mathrm{s^{-1}}$，$T_g = 285\\,\\mathrm{K}$，$x=L$ 处的入流温度：$T_{\\mathrm{R}} = 340\\,\\mathrm{K}$。初始条件：对于所有 $i$，$T_i^n = 330\\,\\mathrm{K}$。探针索引：$i=7$。\n- 情况 D（纯对流，零损失，非均匀初始剖面）：$L = 100\\,\\mathrm{m}$，$N = 10$，$\\Delta t = 5\\,\\mathrm{s}$，$u = 1.0\\,\\mathrm{m/s}$，$\\alpha = 0.0\\,\\mathrm{s^{-1}}$，$T_g$ 为任意值（当 $\\alpha=0$ 时不使用），$x=0$ 处的入流温度：$T_{\\mathrm{in}} = 300\\,\\mathrm{K}$。初始条件：$T_i^n = 300 + s x_i\\,\\mathrm{K}$，斜率为 $s = 0.2\\,\\mathrm{K/m}$。探针索引：$i=1$。\n- 情况 E（Courant–Friedrichs–Lewy (CFL) 边界情况，$\\Delta t = \\Delta x/|u|$）：$L = 80\\,\\mathrm{m}$，$N = 4$，$\\Delta t = 5\\,\\mathrm{s}$，$u = 4.0\\,\\mathrm{m/s}$，$\\alpha = 0.01\\,\\mathrm{s^{-1}}$，$T_g = 290\\,\\mathrm{K}$，$x=0$ 处的入流温度：$T_{\\mathrm{in}} = 310\\,\\mathrm{K}$。初始条件：对于所有 $i$，$T_i^n = 305\\,\\mathrm{K}$。探针索引：$i=2$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如 `[r_A,r_B,r_C,r_D,r_E]`），其中每个 `r_·` 是对应情况下在指定探针索引处的更新后温度，四舍五入到六位小数。",
            "solution": "用户提供的问题已经过分析，并被认为是有效的。它具有科学依据，是适定的、客观的，并包含了唯一解所需的所有必要信息。我们现在开始推导和求解。\n\n该问题要求推导并应用一阶迎风有限体积法和显式前向欧拉时间积分，求解控制管道温度的一维对流-反应方程：\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = -\\alpha \\left(T - T_g\\right) \\quad \\text{for } x \\in [0,L], t \\ge 0\n$$\n\n### 第 1 部分：有限体积离散化\n\n我们首先将能量守恒原理应用于一个有限控制体（CV）。区域 $[0, L]$ 被划分为 $N$ 个均匀的控制体，$V_i = [x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$，其中 $i=0, \\dots, N-1$。每个控制体的宽度为 $\\Delta x = L/N$，中心位于 $x_i = (i+\\frac{1}{2})\\Delta x$。\n\n对于控制体 $V_i$ 内的流体，其能量平衡表明热能的变化率等于净流入该控制体的对流能量率减去损失到周围环境的热量率。\n\n1.  **能量变化率**：控制体中的热能为 $E_i = (\\rho A \\Delta x) c T_i$，其中 $T_i$ 是该控制体内的平均温度。其变化率为 $\\frac{\\mathrm{d}E_i}{\\mathrm{d}t} = \\rho c A \\Delta x \\frac{\\mathrm{d}T_i}{\\mathrm{d}t}$。\n\n2.  **净对流能量**：能量由流体流动携带。穿过一个面的能量对流率为 $\\dot{m} c T = (\\rho u A) c T$。进入控制体的净能量率是流入面 $i-\\frac{1}{2}$ 的通量减去流出面 $i+\\frac{1}{2}$ 的通量：\n    $$ \\dot{E}_{\\text{adv, net}} = (\\rho u A c T)_{i-\\frac{1}{2}} - (\\rho u A c T)_{i+\\frac{1}{2}} $$\n\n3.  **热损失**：根据牛顿冷却定律，热量通过对流损失到周围的地面。与控制体相对应的管段表面积（$P \\Delta x$）的热损失率为：\n    $$ \\dot{Q}_{\\text{loss}} = h (P \\Delta x) (T_i - T_g) $$\n\n能量平衡方程为：\n$$ \\rho c A \\Delta x \\frac{\\mathrm{d}T_i}{\\mathrm{d}t} = (\\rho u A c T)_{i-\\frac{1}{2}} - (\\rho u A c T)_{i+\\frac{1}{2}} - h P \\Delta x(T_i - T_g) $$\n\n将整个方程除以常数项 $\\rho c A \\Delta x$，得到单元平均温度 $T_i$ 的半离散方程：\n$$ \\frac{\\mathrm{d}T_i}{\\mathrm{d}t} = \\frac{u}{\\Delta x}(T_{i-\\frac{1}{2}} - T_{i+\\frac{1}{2}}) - \\frac{h P}{\\rho c A}(T_i - T_g) $$\n我们定义对流通量为 $F(T) = uT$，热损失系数为 $\\alpha = \\frac{hP}{\\rho c A}$。方程变为：\n$$ \\frac{\\mathrm{d}T_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x} \\left( F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}} \\right) - \\alpha(T_i - T_g) $$\n其中 $F_{i\\pm\\frac{1}{2}}$ 是单元面上的通量。\n\n对于一阶迎风格式，单元面上的温度取自“迎风”一侧（即流动来源方向）的单元中心值。\n\n-   如果 $u  0$（流动从左到右）：\n    -   $T_{i+\\frac{1}{2}} = T_i$\n    -   $T_{i-\\frac{1}{2}} = T_{i-1}$\n-   如果 $u  0$（流动从右到左）：\n    -   $T_{i+\\frac{1}{2}} = T_{i+1}$\n    -   $T_{i-\\frac{1}{2}} = T_i$\n-   如果 $u = 0$，则两个通量均为零。\n\n### 第 2 部分：显式欧拉时间积分和最终离散法则\n\n我们使用显式前向欧拉方法来离散化时间导数，即 $\\frac{\\mathrm{d}T_i}{\\mathrm{d}t} \\approx \\frac{T_i^{n+1} - T_i^n}{\\Delta t}$。右侧所有项均在已知时间层 $n$ 上进行计算。\n$$ \\frac{T_i^{n+1} - T_i^n}{\\Delta t} = -\\frac{1}{\\Delta x} \\left( F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n \\right) - \\alpha(T_i^n - T_g) $$\n整理后得到 $T_i^{n+1}$ 的通用更新法则：\n$$ T_i^{n+1} = T_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n \\right) - \\Delta t \\alpha(T_i^n - T_g) $$\n\n现在我们根据 $u$ 的符号和边界条件写出具体形式。\n\n**情况 1：$u  0$**（在 $x=0$ 处入流，温度为 $T_{\\mathrm{in}}$）\n-   对于内部单元 $i \\in \\{1, \\dots, N-1\\}$：$F_{i+\\frac{1}{2}}^n = u T_i^n$ 且 $F_{i-\\frac{1}{2}}^n = u T_{i-1}^n$。\n    $$ T_i^{n+1} = T_i^n - \\frac{u \\Delta t}{\\Delta x} (T_i^n - T_{i-1}^n) - \\Delta t \\alpha (T_i^n - T_g) $$\n-   对于第一个单元 $i=0$：左侧面是区域边界。$T_{-\\frac{1}{2}}$ 的迎风值是入流边界条件 $T_{\\mathrm{in}}$。因此，$F_{-\\frac{1}{2}}^n = u T_{\\mathrm{in}}$。右侧通量为 $F_{\\frac{1}{2}}^n = u T_0^n$。\n    $$ T_0^{n+1} = T_0^n - \\frac{u \\Delta t}{\\Delta x} (T_0^n - T_{\\mathrm{in}}) - \\Delta t \\alpha (T_0^n - T_g) $$\n\n**情况 2：$u  0$**（在 $x=L$ 处入流，温度为 $T_R$）\n-   对于内部单元 $i \\in \\{0, \\dots, N-2\\}$：$F_{i+\\frac{1}{2}}^n = u T_{i+1}^n$ 且 $F_{i-\\frac{1}{2}}^n = u T_i^n$。\n    $$ T_i^{n+1} = T_i^n - \\frac{u \\Delta t}{\\Delta x} (T_{i+1}^n - T_i^n) - \\Delta t \\alpha (T_i^n - T_g) $$\n-   对于最后一个单元 $i=N-1$：右侧面是区域边界。$T_{N-\\frac{1}{2}}$ 的迎风值是入流边界条件 $T_R$。因此，$F_{N-\\frac{1}{2}}^n = u T_R$。左侧通量为 $F_{N-\\frac{3}{2}}^n = u T_{N-1}^n$。\n    $$ T_{N-1}^{n+1} = T_{N-1}^n - \\frac{u \\Delta t}{\\Delta x} (T_R - T_{N-1}^n) - \\Delta t \\alpha (T_{N-1}^n - T_g) $$\n\n**情况 3：$u = 0$**（纯热损失）\n-   对于所有单元 $i \\in \\{0, \\dots, N-1\\}$：对流通量为零。\n    $$ T_i^{n+1} = T_i^n - \\Delta t \\alpha (T_i^n - T_g) $$\n\n### 第 3 部分：应用于测试套件\n\n现在将这些离散方程应用于每个测试用例，进行单个时间步的计算。\n\n-   **情况 A：** $u=0.5  0$，探针 $i=3$。初始 $T_i^n$ 是均匀的。\n    $T_3^{n+1} = T_3^n - \\frac{0.5 \\cdot 1}{10}(T_3^n - T_2^n) - (1 \\cdot 0.01)(T_3^n - T_g) = 330 - 0.05(330-330) - 0.01(330-285) = 330 - 0.45 = 329.55$。\n\n-   **情况 B：** $u=0.0$，探针 $i=2$。\n    $T_2^{n+1} = T_2^n - (10 \\cdot 0.05)(T_2^n - T_g) = 320 - 0.5(320-280) = 320 - 20 = 300.0$。\n\n-   **情况 C：** $u=-0.3  0$，探针 $i=7=N-1$。\n    $T_7^{n+1} = T_7^n - \\frac{-0.3 \\cdot 2}{10}(T_R - T_7^n) - (2 \\cdot 0.02)(T_7^n - T_g) = 330 + 0.06(340-330) - 0.04(330-285) = 330 + 0.6 - 1.8 = 328.8$。\n\n-   **情况 D：** $u=1.0  0$, $\\alpha=0.0$，探针 $i=1$。$\\Delta x = 10$。初始 $T_i^n = 300 + 0.2 x_i = 300 + 0.2(i+0.5)10 = 301 + 2i$。\n    $T_0^n = 301, T_1^n = 303$。\n    $T_1^{n+1} = T_1^n - \\frac{1.0 \\cdot 5}{10}(T_1^n - T_0^n) - 0 = 303 - 0.5(303-301) = 303 - 1 = 302.0$。\n\n-   **情况 E：** $u=4.0  0$，探针 $i=2$。初始 $T_i^n$ 是均匀的。库朗数 $\\frac{|u|\\Delta t}{\\Delta x} = \\frac{4 \\cdot 5}{20}=1$。\n    $T_2^{n+1} = T_2^n - \\frac{4.0 \\cdot 5}{20}(T_2^n - T_1^n) - (5 \\cdot 0.01)(T_2^n - T_g) = 305 - 1(305-305) - 0.05(305-290) = 305 - 0.75 = 304.25$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D advection-reaction equation for temperature in a pipe using a\n    first-order upwind finite volume method with explicit Euler time integration.\n    \"\"\"\n    \n    # Structure of each test case:\n    # (L, N, dt, u, alpha, T_g, T_inflow, initial_T_spec, probe_index, s for case D)\n    test_cases = [\n        # Case A (happy path, positive velocity, moderate loss)\n        {'L': 100.0, 'N': 10, 'dt': 1.0, 'u': 0.5, 'alpha': 0.01, 'T_g': 285.0, 'T_inflow': 350.0, 'initial_T': 330.0, 'probe_idx': 3, 's': None},\n        # Case B (boundary condition with zero advection, pure loss)\n        {'L': 50.0, 'N': 5, 'dt': 10.0, 'u': 0.0, 'alpha': 0.05, 'T_g': 280.0, 'T_inflow': None, 'initial_T': 320.0, 'probe_idx': 2, 's': None},\n        # Case C (edge case, negative velocity, inflow at right boundary)\n        {'L': 80.0, 'N': 8, 'dt': 2.0, 'u': -0.3, 'alpha': 0.02, 'T_g': 285.0, 'T_inflow': 340.0, 'initial_T': 330.0, 'probe_idx': 7, 's': None},\n        # Case D (pure advection, zero loss, nonuniform initial profile)\n        {'L': 100.0, 'N': 10, 'dt': 5.0, 'u': 1.0, 'alpha': 0.0, 'T_g': 0.0, 'T_inflow': 300.0, 'initial_T': 300.0, 'probe_idx': 1, 's': 0.2},\n        # Case E (Courant–Friedrichs–Lewy (CFL) boundary case)\n        {'L': 80.0, 'N': 4, 'dt': 5.0, 'u': 4.0, 'alpha': 0.01, 'T_g': 290.0, 'T_inflow': 310.0, 'initial_T': 305.0, 'probe_idx': 2, 's': None},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L = case['L']\n        N = case['N']\n        dt = case['dt']\n        u = case['u']\n        alpha = case['alpha']\n        T_g = case['T_g']\n        T_inflow = case['T_inflow']\n        initial_T = case['initial_T']\n        probe_idx = case['probe_idx']\n        s = case['s']\n\n        # Calculate grid spacing\n        dx = L / N\n\n        # Initialize temperature array T^n\n        T_n = np.zeros(N)\n        if s is None:\n            # Uniform initial condition\n            T_n.fill(initial_T)\n        else:\n            # Non-uniform initial condition for Case D\n            x_centers = (np.arange(N) + 0.5) * dx\n            T_n = initial_T + s * x_centers\n            \n        # Array to store updated temperatures T^{n+1}\n        T_np1 = np.zeros(N)\n\n        # Loop through each control volume to calculate the new temperature\n        for i in range(N):\n            # Calculate advective fluxes at cell faces i-1/2 and i+1/2\n            # using the first-order upwind scheme\n            F_left, F_right = 0.0, 0.0\n            \n            if u > 0:\n                # Flow is from left to right\n                F_right = u * T_n[i]\n                if i == 0:\n                    F_left = u * T_inflow  # Dirichlet boundary at x=0\n                else:\n                    F_left = u * T_n[i-1]\n            elif u  0:\n                # Flow is from right to left\n                F_left = u * T_n[i]\n                if i == N - 1:\n                    F_right = u * T_inflow  # Dirichlet boundary at x=L\n                else:\n                    F_right = u * T_n[i+1]\n            # If u == 0, fluxes remain 0\n\n            # Spatial derivative of flux (advection term)\n            advection_divergence = (F_right - F_left) / dx\n            \n            # Heat loss (reaction term)\n            loss_term = alpha * (T_n[i] - T_g)\n            \n            # Apply forward Euler update\n            T_np1[i] = T_n[i] - dt * (advection_divergence + loss_term)\n\n        # Store the result at the probe index, formatted to 6 decimal places\n        result = T_np1[probe_idx]\n        results.append(f\"{result:.6f}\")\n\n    # Print the final list of results in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "建立模型只是第一步，一个优秀的建模者必须深刻理解其模型的内在属性和局限性。数值方法本身可能会引入非物理效应，例如数值扩散，它会像物理扩散一样使温度波形展宽，从而扭曲仿真结果。这项练习  提供了一种实用的方法来研究和量化这种效应，帮助您培养对数值模拟准确性和可靠性的批判性眼光，这是高级建模者必备的核心素养。",
            "id": "4086259",
            "problem": "您正在对区域供热网络中的单一直管段内的温度输运进行建模。考虑一个长度为 $L$ 的一维管道，其中载热流体的轴向速度 $u$ 均匀，密度和比热容恒定。忽略轴向热传导以及任何内部热源或热汇。被输运的标量是流体温度 $T(x,t)$，它遵循纯平流的能量守恒定律。该区域是周期性的，以便热波可以平流输运而不会产生入口边界伪影。\n\n您的任务是针对瞬态热波进行网格加密研究，并量化由一阶迎风平流格式引入的数值扩散，将其表示为空间网格尺寸 $ \\Delta x $ 的函数。初始温度场是一个叠加在均匀基线温度上的高斯脉冲，即 $T(x,0) = T_0 + A \\exp\\left( -\\frac{(x - x_0)^2}{2 \\sigma_0^2} \\right)$。使用恒定的时间步长 $ \\Delta t $ 随时间向前积分，该步长通过一个固定的 Courant-Friedrichs-Lewy (CFL) 数 $C$ 来选择，对于正速度，其定义为 $ C = \\frac{u \\Delta t}{\\Delta x} $。使用周期性边界条件。不存在物理扩散；脉冲的任何展宽都纯粹是由数值计算引起的。对于 $u  0$ 的迎风平流格式，使用上游差分来近似空间导数，并使用显式时间离散化进行时间推进。\n\n从被输运温度场的能量守恒原理出发，并使用数学上一致的空间和时间离散化方法，实现一个程序，对每个测试用例，该程序能够推进热波，并计算一个有效数值扩散系数 $D_{\\text{num}}$，该系数能够解释在模拟时间区间内观测到的高斯脉冲展宽。将 $D_{\\text{num}}$ 以 $\\text{m}^2/\\text{s}$ 为单位表示，并将每个值四舍五入到六位小数。这个问题不涉及角度。所有温度必须以摄氏度为单位处理；长度以米为单位；时间以秒为单位；速度以米/秒为单位。\n\n测试套件由以下参数集组成，您必须精确地实现它们：\n\n- 案例 1 (常规路径网格)：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 10\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n- 案例 2 (加密网格)：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 5\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n- 案例 3 (粗糙网格)：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 25\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n- 案例 4 (接近稳定性极限的边界 CFL)：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 10\\,\\text{m}$，$C = 0.99$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n\n对于每个案例，请遵循以下要求：\n\n- 构建一个包含 $N = L / \\Delta x$ 个单元的均匀网格，单元中心为 $x_i = i \\Delta x$，其中 $i = 0, 1, \\dots, N-1$。\n- 按规定初始化 $T(x,0)$。\n- 根据 $C = \\frac{u \\Delta t}{\\Delta x}$ 选择 $\\Delta t$，并使用周期性边界条件运行显式一阶迎风平流，直到 $t_{\\text{end}}$。使用不超过 $t_{\\text{end}}$ 的最大整数步数，并在所有计算中使用实际经过的时间 $t$。\n- 通过比较高斯脉冲在 $t = 0$ 和 $t = t_{\\text{end}}$ 时的二阶中心矩（方差）来量化 $D_{\\text{num}}$，其中使用减去基线的温度作为非负权重函数。设权重为 $w(x,t) = T(x,t) - T_0$。通过在网格上进行离散求和来计算平均位置 $\\mu(t) = \\frac{\\int_0^{L} x w(x,t) \\, dx}{\\int_0^{L} w(x,t) \\, dx}$ 和方差 $\\sigma^2(t) = \\frac{\\int_0^{L} (x - \\mu(t))^2 w(x,t) \\, dx}{\\int_0^{L} w(x,t) \\, dx}$。然后从 $\\sigma^2(t)$ 的时间演化中推导出有效扩散系数 $D_{\\text{num}}$。\n- 输出四个案例的 $D_{\\text{num}}$ 值，格式需完全符合要求。\n\n您的程序应生成单行输出，其中包含以方括号括起来的逗号分隔列表形式的结果，单位为 $\\text{m}^2/\\text{s}$，并四舍五入到六位小数，例如 $[d_1,d_2,d_3,d_4]$，其中每个 $d_k$ 是一个四舍五入到六位小数的浮点数。",
            "solution": "用户希望分析一维平流方程的一阶迎风格式的数值扩散。我将首先验证问题陈述。\n\n### 第 1 步：提取给定信息\n- **控制概念**：管道内的一维温度输运，通过纯平流的能量守恒进行建模。忽略轴向热传导和内部热源/热汇。\n- **控制方程（隐含）**：$\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = 0$，其中 $T(x,t)$ 为温度，$x$ 为位置，$t$ 为时间，$u  0$ 为恒定速度。\n- **区域**：长度 $L$，周期性。\n- **初始条件**：$T(x,0) = T_0 + A \\exp\\left( -\\frac{(x - x_0)^2}{2 \\sigma_0^2} \\right)$。\n- **数值格式**：\n    - **时间离散化**：显式，使用恒定时间步长 $\\Delta t$。\n    - **空间离散化**：平流项采用一阶迎风格式。\n- **Courant-Friedrichs-Lewy (CFL) 数**：$C = \\frac{u \\Delta t}{\\Delta x}$，每个案例固定。\n- **边界条件**：周期性。\n- **网格设置**：\n    - 包含 $N = L / \\Delta x$ 个单元的均匀网格。\n    - 单元中心：$x_i = i \\Delta x$，其中 $i = 0, 1, \\dots, N-1$。\n- **模拟时间**：积分至 $t_{\\text{end}}$，使用不超过 $t_{\\text{end}}$ 的最大整数步数。设实际经过的时间为 $t$。\n- **数值扩散的量化 ($D_{\\text{num}}$)**：\n    - **权重函数**：$w(x,t) = T(x,t) - T_0$。\n    - **平均位置**：$\\mu(t) = \\frac{\\int_0^{L} x w(x,t) \\, dx}{\\int_0^{L} w(x,t) \\, dx}$。\n    - **方差**：$\\sigma^2(t) = \\frac{\\int_0^{L} (x - \\mu(t))^2 w(x,t) \\, dx}{\\int_0^{L} w(x,t) \\, dx}$。\n    - **$D_{\\text{num}}$ 的计算**：从 $t=0$ 到最终时间的 $\\sigma^2(t)$ 的时间演化中推导得出。\n- **测试用例**：\n    - **案例 1**：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 10\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n    - **案例 2**：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 5\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n    - **案例 3**：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 25\\,\\text{m}$，$C = 0.9$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n    - **案例 4**：$L = 1000\\,\\text{m}$，$u = 1.0\\,\\text{m/s}$，$\\Delta x = 10\\,\\text{m}$，$C = 0.99$，$T_0 = 60\\,^{\\circ}\\text{C}$，$A = 10\\,^{\\circ}\\text{C}$，$\\sigma_0 = 50\\,\\text{m}$，$x_0 = 200\\,\\text{m}$，$t_{\\text{end}} = 100\\,\\text{s}$。\n- **输出格式**：$D_{\\text{num}}$ 的值，单位为 $\\text{m}^2/\\text{s}$，四舍五入到六位小数，以方括号括起来的逗号分隔列表形式。\n\n### 第 2 步：使用提取的给定信息进行验证\n1.  **科学或事实上的不健全性**：该问题在科学上是健全的。它探讨了将有限差分法应用于线性平流方程时众所周知的数值扩散现象，这是输运建模的基石。物理设置是对区域供热管道的有效简化。\n2.  **不可形式化或不相关**：该问题是高度可形式化的，并且与区域供热网络建模这一主题直接相关，该主题是能源系统建模的一个子领域。\n3.  **不完整或矛盾的设置**：该问题是自洽的。每个案例的所有参数（$L, u, \\Delta x, C, T_0, A, \\sigma_0, x_0, t_{\\text{end}}$）都已指定。计算网格尺寸、时间步长和步数的方法是明确的。计算 $D_{\\text{num}}$ 的过程有明确定义。没有矛盾之处。\n4.  **不切实际或不可行**：物理参数是现实的。选择的数值参数使得所有情况下都满足显式迎风格式的稳定性条件 $C \\le 1$。高斯脉冲完全位于区域内部，因此对于指定的模拟时间，周期性环绕效应对矩计算不是问题。\n5.  **不适定或结构不良**：该问题是适定的。带有初始和周期性边界条件的偏微分方程有唯一解。数值近似是标准的，并且对于给定的参数，可以得到唯一的、稳定的数值解。\n6.  **伪深刻、琐碎或同义反复**：该问题是计算物理/工程领域一个标准的、非琐碎的练习，它演示了一个关键的数值伪影。它既需要实现数值格式，也需要进行后续的数据分析。\n7.  **超出科学可验证性范围**：通过复现所述算法，结果是可验证的。\n\n### 第 3 步：结论与行动\n该问题是**有效的**。这是一个应用于流体动力学的数值分析领域中适定的、科学上健全的问题。我将继续进行求解。\n\n该问题要求我们模拟管道中热脉冲的输运，并量化一阶迎风离散格式中固有的数值扩散。\n\n控制物理原理是一维纯平流（流动）系统且无物理扩散或热源的能量守恒。这由温度场 $T(x,t)$ 的线性平流方程描述：\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = 0\n$$\n其中 $u$ 是恒定的流体速度，$t$ 是时间，$x$ 是空间坐标。\n\n为了数值求解该方程，我们将空间域离散化为 $N$ 个宽度为 $\\Delta x = L/N$ 的单元，其中心位于 $x_i = i \\Delta x$，其中 $i = 0, 1, \\dots, N-1$。我们还用恒定的时间步长 $\\Delta t$ 对时间进行离散化，时间层用上标 $n$ 表示。\n\n问题指定了显式时间步进法和一阶迎风格式用于空间导数。对于正速度 $u  0$，“迎风”方向是 $x$ 负方向。\n时间导数通过向前差分近似：\n$$\n\\frac{\\partial T}{\\partial t} \\bigg|_{x_i, t^n} \\approx \\frac{T_i^{n+1} - T_i^n}{\\Delta t}\n$$\n空间导数通过向后差分（对于 $u0$ 是迎风）近似：\n$$\n\\frac{\\partial T}{\\partial x} \\bigg|_{x_i, t^n} \\approx \\frac{T_i^n - T_{i-1}^n}{\\Delta x}\n$$\n将这些近似代入控制偏微分方程，得到离散更新方程：\n$$\n\\frac{T_i^{n+1} - T_i^n}{\\Delta t} + u \\left( \\frac{T_i^n - T_{i-1}^n}{\\Delta x} \\right) = 0\n$$\n为下一个时间步的温度 $T_i^{n+1}$ 重新整理方程，得到：\n$$\nT_i^{n+1} = T_i^n - \\frac{u \\Delta t}{\\Delta x} (T_i^n - T_{i-1}^n)\n$$\n引入 Courant-Friedrichs-Lewy (CFL) 数 $C = \\frac{u \\Delta t}{\\Delta x}$，方程简化为：\n$$\nT_i^{n+1} = (1 - C) T_i^n + C T_{i-1}^n\n$$\n该显式格式在 $0 \\le C \\le 1$ 时是稳定的。区域是周期性的，这意味着对于网格点 $i=0$，所需的“迎风”温度 $T_{-1}^n$ 从区域的末端获取，即 $T_{-1}^n \\equiv T_{N-1}^n$。\n\n这种数值格式虽然简单，但已知会引入人为扩散。泰勒级数分析（构建修正方程）表明，该格式求解的并非纯平流方程，而是一个形如平流-扩散方程的方程：\n$$\n\\frac{\\partial T}{\\partial t} + u \\frac{\\partial T}{\\partial x} = D_{\\text{num}} \\frac{\\partial^2 T}{\\partial x^2} + \\mathcal{O}(\\Delta x^2, \\Delta t^2)\n$$\n主导误差项的作用类似于一个扩散项，其有效数值扩散系数为：\n$$\nD_{\\text{num}} = \\frac{u \\Delta x}{2}(1 - C)\n$$\n问题要求我们通过分析高斯脉冲的展宽，从模拟结果中确定 $D_{\\text{num}}$。对于一个物理上的平流-扩散过程，浓度分布的方差 $\\sigma^2(t)$ 随时间线性增长：\n$$\n\\sigma^2(t) = \\sigma^2(0) + 2 D t\n$$\n通过类比，我们可以从模拟温度脉冲的初始和最终方差计算出有效的数值扩散系数：\n$$\nD_{\\text{num}} = \\frac{\\sigma^2(t_{\\text{final}}) - \\sigma^2(0)}{2 t_{\\text{final}}}\n$$\n其中 $t_{\\text{final}}$ 是总模拟时间。\n\n为实现这一点，我们必须计算模拟开始和结束时的方差。问题指定使用减去基线的温度 $w(x,t) = T(x,t) - T_0$ 的矩的离散形式。\n脉冲的总“质量”或零阶矩是：\n$$\nM(t) = \\int_0^L w(x,t) dx \\approx \\sum_{i=0}^{N-1} w_i(t) \\Delta x\n$$\n一阶矩用于找到平均位置（形心）$\\mu(t)$：\n$$\n\\mu(t) = \\frac{\\int_0^L x w(x,t) dx}{\\int_0^L w(x,t) dx} \\approx \\frac{\\sum_{i=0}^{N-1} x_i w_i(t) \\Delta x}{\\sum_{i=0}^{N-1} w_i(t) \\Delta x}\n$$\n二阶中心矩给出方差 $\\sigma^2(t)$：\n$$\n\\sigma^2(t) = \\frac{\\int_0^L (x-\\mu(t))^2 w(x,t) dx}{\\int_0^L w(x,t) dx} \\approx \\frac{\\sum_{i=0}^{N-1} (x_i - \\mu(t))^2 w_i(t) \\Delta x}{\\sum_{i=0}^{N-1} w_i(t) \\Delta x}\n$$\n由于脉冲以 $u t_{\\text{end}} = 1.0 \\, \\text{m/s} \\times 100 \\, \\text{s} = 100 \\, \\text{m}$ 的距离从初始位置 $x_0=200 \\, \\text{m}$ 在长度为 $L=1000 \\, \\text{m}$ 的区域内平流输运，脉冲仍远离周期性边界。因此，平均值和方差的标准定义是合适的，不需要对周期性环绕进行特殊处理。\n\n每个测试用例的总体算法如下：\n1.  定义所有输入参数（$L, u, \\Delta x, C$ 等）。\n2.  计算模拟参数：网格大小 $N = L/\\Delta x$，时间步长 $\\Delta t = C \\Delta x / u$，以及步数 `num_steps` = $\\lfloor t_{\\text{end}} / \\Delta t \\rfloor$。实际最终时间为 $t_{\\text{final}} = \\text{num\\_steps} \\times \\Delta t$。\n3.  生成空间网格 $x_i = i \\Delta x$。\n4.  使用给定的高斯函数在每个 $x_i$ 上求值，以初始化温度数组 $T^0$。\n5.  使用离散矩公式计算初始方差 $\\sigma^2(0)$。\n6.  迭代 `num_steps` 次。在每一步中，使用矢量化的迎风公式 $T^{n+1} = (1-C)T^n + C \\cdot \\text{roll}(T^n, 1)$ 从当前温度数组 $T^n$ 计算新的温度数组 $T^{n+1}$，其中 $\\text{roll}(T^n, 1)$ 将数组元素向右移动一位，为 $T_{i-1}$ 实现周期性边界条件。\n7.  在最后一个时间步之后，从最终温度分布计算最终方差 $\\sigma^2(t_{\\text{final}})$。\n8.  计算数值扩散系数 $D_{\\text{num}} = (\\sigma^2(t_{\\text{final}}) - \\sigma^2(0)) / (2 t_{\\text{final}})$。\n9.  存储结果并对所有测试用例重复此过程。\n\n此过程将使用 Python 的 `numpy` 库实现，以进行高效的数组操作。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of quantifying numerical diffusion for a first-order\n    upwind scheme applied to the 1D advection equation.\n    \"\"\"\n    test_cases = [\n        # Case 1: happy path mesh\n        {'L': 1000.0, 'u': 1.0, 'delta_x': 10.0, 'C': 0.9, 'T0': 60.0, 'A': 10.0, 'sigma0': 50.0, 'x0': 200.0, 't_end': 100.0},\n        # Case 2: refined mesh\n        {'L': 1000.0, 'u': 1.0, 'delta_x': 5.0, 'C': 0.9, 'T0': 60.0, 'A': 10.0, 'sigma0': 50.0, 'x0': 200.0, 't_end': 100.0},\n        # Case 3: coarse mesh\n        {'L': 1000.0, 'u': 1.0, 'delta_x': 25.0, 'C': 0.9, 'T0': 60.0, 'A': 10.0, 'sigma0': 50.0, 'x0': 200.0, 't_end': 100.0},\n        # Case 4: edge CFL near stability limit\n        {'L': 1000.0, 'u': 1.0, 'delta_x': 10.0, 'C': 0.99, 'T0': 60.0, 'A': 10.0, 'sigma0': 50.0, 'x0': 200.0, 't_end': 100.0},\n    ]\n\n    results = []\n\n    def calculate_variance(T, x, T0, delta_x):\n        \"\"\"\n        Calculates the variance of the temperature pulse.\n        \"\"\"\n        w = T - T0\n        \n        # Ensure w is non-negative to avoid issues with floating point errors\n        w[w  0] = 0\n\n        # The discrete integration factor delta_x cancels in the ratios,\n        # but it is more rigorous to include it.\n        total_mass = np.sum(w) * delta_x\n        if total_mass == 0:\n            return 0.0\n\n        mean_pos = (np.sum(x * w) * delta_x) / total_mass\n        \n        # As the pulse moves, the mean position might shift.\n        # The problem setup ensures the pulse does not cross the periodic boundary,\n        # so a simple variance calculation is sufficient.\n        variance = (np.sum((x - mean_pos)**2 * w) * delta_x) / total_mass\n        return variance\n\n    for case in test_cases:\n        L = case['L']\n        u = case['u']\n        delta_x = case['delta_x']\n        C = case['C']\n        T0 = case['T0']\n        A = case['A']\n        sigma0 = case['sigma0']\n        x0 = case['x0']\n        t_end = case['t_end']\n\n        # 1. Set up grid and time step\n        N = int(L / delta_x)\n        x = np.arange(N) * delta_x\n        \n        delta_t = C * delta_x / u\n        num_steps = int(t_end / delta_t)\n        t_actual = num_steps * delta_t\n\n        # 2. Initialize temperature field\n        T_initial = T0 + A * np.exp(-(x - x0)**2 / (2 * sigma0**2))\n        \n        # 3. Calculate initial variance\n        var_initial = calculate_variance(T_initial, x, T0, delta_x)\n\n        # 4. Time-stepping loop\n        T_current = T_initial.copy()\n        for _ in range(num_steps):\n            # First-order upwind scheme (FTBS for u > 0)\n            # T_i^{n+1} = (1-C)*T_i^n + C*T_{i-1}^n\n            # np.roll(T, 1) shifts elements to the right, so T_i is replaced by T_{i-1}\n            # This handles periodic boundaries automatically.\n            T_current = (1 - C) * T_current + C * np.roll(T_current, 1)\n\n        # 5. Calculate final variance\n        var_final = calculate_variance(T_current, x, T0, delta_x)\n\n        # 6. Calculate numerical diffusion coefficient\n        if t_actual > 0:\n            D_num = (var_final - var_initial) / (2 * t_actual)\n        else:\n            D_num = 0.0\n            \n        results.append(round(D_num, 6))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}