{
    "hands_on_practices": [
        {
            "introduction": "Energy system models operate in discrete time steps, yet the power plants they represent are governed by continuous physical laws. This exercise bridges that gap by tackling a fundamental question: how do we translate a continuous-time physical limit, such as a generator's maximum ramp rate, into a mathematically sound constraint for a discrete-time optimization model? By applying the Fundamental Theorem of Calculus, you will derive the discrete ramp-rate constraint from first principles, a crucial skill for ensuring that your models accurately reflect real-world operational realities. ",
            "id": "4098308",
            "problem": "Consider a single thermal generator scheduled in a time-discretized energy system optimization model with period length $\\Delta t$ measured in minutes. Let the continuous-time power output be $p(t)$ in megawatts (MW), and suppose the generator is subject to a symmetric ramp-rate limit specified as a bound on its time derivative, namely $|\\frac{dp(t)}{dt}| \\leq R$, where $R$ is given in megawatts per minute (MW/min). The model records decision variables $P_t$ that represent the generator output at the end of each period $t$.\n\nStarting from the definitions of ramp rate as a time derivative and the fundamental theorem of calculus for absolutely continuous functions, derive the discrete-time inter-temporal ramp constraint that links $P_t$ and $P_{t-1}$ across consecutive periods. Then, for the specific case $\\Delta t = 15$ minutes, determine the maximum permissible change in output between consecutive periods, $\\Delta P_{\\max}$, expressed in MW as a function of $R$.\n\nYour final answer must be a single real-valued symbolic expression. No rounding is required. Express the final change in output in MW.",
            "solution": "The problem requires the derivation of a discrete-time ramp constraint from a continuous-time definition and then its application to a specific case.\n\nFirst, we formalize the relationship between the continuous-time power output, $p(t)$, and the discrete-time decision variables, $P_t$. The problem states that $P_t$ is the generator output at the end of period $t$. Let each period have a duration of $\\Delta t$. If we denote the time at the end of period $t$ as $\\tau_t = t \\Delta t$ for $t = 1, 2, \\dots$, then the decision variables are defined as:\n$$P_t = p(\\tau_t) = p(t \\Delta t)$$\n$$P_{t-1} = p(\\tau_{t-1}) = p((t-1) \\Delta t)$$\n\nThe change in power output between the end of period $t-1$ and the end of period $t$ is $P_t - P_{t-1}$. Using the definitions above, this difference can be expressed in terms of the continuous-time function $p(t)$:\n$$P_t - P_{t-1} = p(t \\Delta t) - p((t-1) \\Delta t)$$\n\nThe problem states that $p(t)$ is an absolutely continuous function. This is a sufficient condition to apply the Fundamental Theorem of Calculus, which states that for such a function, the integral of its derivative over an interval is equal to the change in the function's value at the endpoints of the interval. Applying this theorem to the function $p(t)$ over the time interval $[(t-1)\\Delta t, t \\Delta t]$, we have:\n$$p(t \\Delta t) - p((t-1) \\Delta t) = \\int_{(t-1)\\Delta t}^{t \\Delta t} \\frac{dp(\\tau)}{d\\tau} d\\tau$$\nTherefore:\n$$P_t - P_{t-1} = \\int_{(t-1)\\Delta t}^{t \\Delta t} \\frac{dp(\\tau)}{d\\tau} d\\tau$$\n\nNext, we incorporate the given physical constraint on the ramp rate. The instantaneous rate of change of power is limited by a maximum ramp rate $R$, given in megawatts per minute (MW/min). This constraint is expressed as:\n$$\\left|\\frac{dp(t)}{dt}\\right| \\leq R$$\nThis inequality is equivalent to the following pair of inequalities:\n$$-R \\leq \\frac{dp(t)}{dt} \\leq R$$\n\nThis inequality holds for all time $t$. We can therefore integrate it over the time interval of interest, $[(t-1)\\Delta t, t \\Delta t]$. Using the property that if $f(x) \\leq g(x)$ then $\\int f(x)dx \\leq \\int g(x)dx$, we get:\n$$\\int_{(t-1)\\Delta t}^{t \\Delta t} (-R) d\\tau \\leq \\int_{(t-1)\\Delta t}^{t \\Delta t} \\frac{dp(\\tau)}{d\\tau} d\\tau \\leq \\int_{(t-1)\\Delta t}^{t \\Delta t} R d\\tau$$\n\nNow, we evaluate the definite integrals. The integrand on the left-hand side and the right-hand side, $R$, is a constant.\nThe left-hand integral is:\n$$\\int_{(t-1)\\Delta t}^{t \\Delta t} (-R) d\\tau = -R \\left[ \\tau \\right]_{(t-1)\\Delta t}^{t \\Delta t} = -R (t \\Delta t - (t-1)\\Delta t) = -R \\Delta t$$\nThe right-hand integral is:\n$$\\int_{(t-1)\\Delta t}^{t \\Delta t} R d\\tau = R \\left[ \\tau \\right]_{(t-1)\\Delta t}^{t \\Delta t} = R (t \\Delta t - (t-1)\\Delta t) = R \\Delta t$$\n\nSubstituting these results and the expression for the middle integral back into the inequality, we obtain:\n$$-R \\Delta t \\leq P_t - P_{t-1} \\leq R \\Delta t$$\nThis is the discrete-time inter-temporal ramp constraint that links the power output in consecutive periods, $P_t$ and $P_{t-1}$. This completes the first part of the derivation. The constraint can be expressed more compactly using the absolute value:\n$$|P_t - P_{t-1}| \\leq R \\Delta t$$\n\nThe second part of the problem asks for the maximum permissible change in output between consecutive periods, denoted $\\Delta P_{\\max}$, for the specific case where the period length is $\\Delta t = 15$ minutes. The change in output is $|P_t - P_{t-1}|$. From the derived constraint, we can see that the maximum value of this change is bounded by $R \\Delta t$.\n$$\\Delta P_{\\max} = \\max(|P_t - P_{t-1}|) = R \\Delta t$$\n\nWe are given $\\Delta t = 15$ minutes and $R$ is in megawatts per minute (MW/min). Substituting the value for $\\Delta t$:\n$$\\Delta P_{\\max} = R \\cdot 15$$\nThe units of this expression are $(\\text{MW/min}) \\cdot (\\text{min}) = \\text{MW}$, which is consistent with the required units for a change in power output. The final expression is $15R$.",
            "answer": "$$\\boxed{15R}$$"
        },
        {
            "introduction": "Beyond continuous limits like ramping, thermal generators are subject to complex logical constraints, most notably minimum up-time and down-time requirements. This practice moves beyond simple physics into the art of mathematical formulation for Mixed-Integer Linear Programs (MILPs). You are challenged to construct a complete set of linear constraints that capture these \"if-then\" rules, correctly handling not only in-horizon events but also the critical edge cases of pre-existing obligations at the start of the horizon and truncated requirements at the end. ",
            "id": "4098248",
            "problem": "Consider a single thermal unit in an energy systems model formulated as a Mixed Integer Linear Programming (MILP) problem over discrete time periods $\\mathcal{T} = \\{1, \\dots, T\\}$. Let $u_t \\in \\{0,1\\}$ denote the on/off commitment status at period $t$, $y_t \\in \\{0,1\\}$ denote a startup indicator at period $t$, and $z_t \\in \\{0,1\\}$ denote a shutdown indicator at period $t$. The initial status $u_0 \\in \\{0,1\\}$ is given. The unit has a minimum up time $\\underline{U} \\in \\mathbb{Z}_{+}$ and a minimum down time $\\underline{D} \\in \\mathbb{Z}_{+}$. The inter-temporal logical relationship between commitment transitions and startup/shutdown events is defined by the identity $u_t - u_{t-1} = y_t - z_t$ for all $t \\in \\mathcal{T}$. Within the horizon, minimum up time and minimum down time are governed by the standard operational definitions: after any startup event the unit must remain committed for at least $\\underline{U}$ consecutive periods, and after any shutdown event the unit must remain uncommitted for at least $\\underline{D}$ consecutive periods.\n\nAcross the start of the horizon, the unit may carry residual obligations from operations prior to period $t = 1$. Define the residual minimum up time counter $\\rho^{\\text{up}}_0 \\in \\{0, 1, \\dots, \\underline{U}-1\\}$ to be the number of periods at the start of the horizon during which the unit must stay on if $u_0 = 1$, and define the residual minimum down time counter $\\rho^{\\text{down}}_0 \\in \\{0, 1, \\dots, \\underline{D}-1\\}$ to be the number of periods at the start of the horizon during which the unit must stay off if $u_0 = 0$. These residual counters reflect remaining mandatory time due to events before $t = 1$ and are consistent with the initial status, meaning if $u_0 = 1$ then $\\rho^{\\text{down}}_0 = 0$ and if $u_0 = 0$ then $\\rho^{\\text{up}}_0 = 0$.\n\nStarting from the above definitions, select the option that correctly constructs a set of linear constraints that enforces both the within-horizon minimum up/down times and the start-of-horizon residual obligations implied by $u_0$, $\\rho^{\\text{up}}_0$, and $\\rho^{\\text{down}}_0$. The constraints must be valid for any $T \\ge 1$, properly handle truncation near the horizon end, and reflect the operational logic that startup events require subsequent on-ness and shutdown events require subsequent off-ness. Only one option is fully correct.\n\nA. For all $t \\in \\mathcal{T}$, impose $u_t - u_{t-1} = y_t - z_t$, $u_t \\in \\{0,1\\}$, $y_t \\in \\{0,1\\}$, $z_t \\in \\{0,1\\}$. For minimum up time triggered by in-horizon startups: for all $t \\in \\{1, \\dots, T - \\underline{U} + 1\\}$, impose $\\sum_{s=t}^{t + \\underline{U} - 1} u_s \\ge \\underline{U} \\, y_t$, and for all $t \\in \\{T - \\underline{U} + 2, \\dots, T\\}$, impose $\\sum_{s=t}^{T} u_s \\ge (T - t + 1) \\, y_t$. For minimum down time triggered by in-horizon shutdowns: for all $t \\in \\{1, \\dots, T - \\underline{D} + 1\\}$, impose $\\sum_{s=t}^{t + \\underline{D} - 1} (1 - u_s) \\ge \\underline{D} \\, z_t$, and for all $t \\in \\{T - \\underline{D} + 2, \\dots, T\\}$, impose $\\sum_{s=t}^{T} (1 - u_s) \\ge (T - t + 1) \\, z_t$. Across the start of the horizon, enforce residual obligations as follows: if $u_0 = 1$, then for all $t \\in \\{1, \\dots, \\rho^{\\text{up}}_0\\}$ impose $u_t = 1$ and $z_t = 0$; equivalently, $\\sum_{s=1}^{\\rho^{\\text{up}}_0} (1 - u_s) = 0$ and $\\sum_{s=1}^{\\rho^{\\text{up}}_0} z_s = 0$. If $u_0 = 0$, then for all $t \\in \\{1, \\dots, \\rho^{\\text{down}}_0\\}$ impose $u_t = 0$ and $y_t = 0$; equivalently, $\\sum_{s=1}^{\\rho^{\\text{down}}_0} u_s = 0$ and $\\sum_{s=1}^{\\rho^{\\text{down}}_0} y_s = 0$.\n\nB. For all $t \\in \\mathcal{T}$, impose $u_t - u_{t-1} = y_t - z_t$, $u_t \\in \\{0,1\\}$, $y_t \\in \\{0,1\\}$, $z_t \\in \\{0,1\\}$, and set $u_1 = u_0$. For minimum up/down times, use only the in-horizon event constraints: for all $t \\in \\{1, \\dots, T - \\underline{U} + 1\\}$, $\\sum_{s=t}^{t + \\underline{U} - 1} u_s \\ge \\underline{U} \\, y_t$, and for all $t \\in \\{1, \\dots, T - \\underline{D} + 1\\}$, $\\sum_{s=t}^{t + \\underline{D} - 1} (1 - u_s) \\ge \\underline{D} \\, z_t$; do not impose any residual start-of-horizon constraints because the event constraints are sufficient.\n\nC. For all $t \\in \\mathcal{T}$, impose $u_t - u_{t-1} = y_t - z_t$, $u_t \\in \\{0,1\\}$, $y_t \\in \\{0,1\\}$, $z_t \\in \\{0,1\\}$. At the start of the horizon, enforce full minimum times regardless of residual counters by imposing $\\sum_{s=1}^{\\underline{U}} u_s \\ge \\underline{U} \\, u_0$ and $\\sum_{s=1}^{\\underline{D}} (1 - u_s) \\ge \\underline{D} \\, (1 - u_0)$. Within the horizon, do not use truncated sums at the end; simply apply for all $t \\in \\{1, \\dots, T - \\underline{U} + 1\\}$ the minimum up time constraint $\\sum_{s=t}^{t + \\underline{U} - 1} u_s \\ge \\underline{U} \\, y_t$ and for all $t \\in \\{1, \\dots, T - \\underline{D} + 1\\}$ the minimum down time constraint $\\sum_{s=t}^{t + \\underline{D} - 1} (1 - u_s) \\ge \\underline{D} \\, z_t$.\n\nD. For all $t \\in \\mathcal{T}$, impose $u_t - u_{t-1} = y_t - z_t$, $u_t \\in \\{0,1\\}$, $y_t \\in \\{0,1\\}$, $z_t \\in \\{0,1\\}$. At the start of the horizon, enforce residual counters by preventing the wrong event type: if $u_0 = 1$ then impose $y_t = 0$ for all $t \\in \\{1, \\dots, \\rho^{\\text{up}}_0\\}$, and if $u_0 = 0$ then impose $z_t = 0$ for all $t \\in \\{1, \\dots, \\rho^{\\text{down}}_0\\}$. Rely on the inter-temporal identity to propagate these restrictions and do not impose any additional minimum up/down time constraints.",
            "solution": "The problem statement posits a standard unit commitment formulation for a single thermal unit and asks for the correct set of linear constraints to model minimum up and down times, including residual obligations at the start of the planning horizon. The validation of the problem statement is the first necessary step.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- Time periods: $\\mathcal{T} = \\{1, \\dots, T\\}$.\n- Variables:\n    - Commitment status: $u_t \\in \\{0,1\\}$ for $t \\in \\mathcal{T}$.\n    - Startup indicator: $y_t \\in \\{0,1\\}$ for $t \\in \\mathcal{T}$.\n    - Shutdown indicator: $z_t \\in \\{0,1\\}$ for $t \\in \\mathcal{T}$.\n- Initial condition: $u_0 \\in \\{0,1\\}$.\n- Parameters:\n    - Minimum up time: $\\underline{U} \\in \\mathbb{Z}_{+}$.\n    - Minimum down time: $\\underline{D} \\in \\mathbb{Z}_{+}$.\n    - Residual up time counter: $\\rho^{\\text{up}}_0 \\in \\{0, 1, \\dots, \\underline{U}-1\\}$.\n    - Residual down time counter: $\\rho^{\\text{down}}_0 \\in \\{0, 1, \\dots, \\underline{D}-1\\}$.\n- Constraints & Definitions:\n    - Inter-temporal logic: $u_t - u_{t-1} = y_t - z_t$ for all $t \\in \\mathcal{T}$.\n    - Within-horizon minimum up time: After a startup, the unit must remain on for at least $\\underline{U}$ consecutive periods.\n    - Within-horizon minimum down time: After a shutdown, the unit must remain off for at least $\\underline{D}$ consecutive periods.\n    - Start-of-horizon obligations: If $u_0 = 1$, the unit must stay on for the first $\\rho^{\\text{up}}_0$ periods. If $u_0 = 0$, the unit must stay off for the first $\\rho^{\\text{down}}_0$ periods.\n    - Consistency: If $u_0 = 1$, then $\\rho^{\\text{down}}_0 = 0$. If $u_0 = 0$, then $\\rho^{\\text{up}}_0 = 0$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem describes a classic optimization subproblem in energy systems modeling. All terms, variables, and parameters are standard in the field of operations research and power systems engineering.\n- **Scientifically Grounded:** The problem is firmly based on the established principles of Mixed Integer Linear Programming applied to unit commitment, a core topic in energy systems analysis. The formulation is scientifically and mathematically sound.\n- **Well-Posed:** The question asks for a set of constraints to represent physical and operational rules. This is a well-defined modeling task with a known, correct implementation.\n- **Objective:** The language is formal, precise, and unambiguous. All definitions are clearly stated.\nThe problem statement is complete, consistent, and scientifically valid. It does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the detailed derivation and evaluation of the options.\n\n### Derivation of Correct Constraints\n\nA complete and correct formulation must address four distinct aspects:\n1.  **Inter-temporal event logic:** The relation $u_t - u_{t-1} = y_t - z_t$ correctly links the state variable $u_t$ to the event variables $y_t$ and $z_t$. A startup ($u_{t-1}=0, u_t=1$) forces $y_t=1, z_t=0$. A shutdown ($u_{t-1}=1, u_t=0$) forces $y_t=0, z_t=1$. No change of state ($u_{t-1}=u_t$) implies $y_t = z_t$. In a cost-minimizing setting, $y_t=z_t=1$ would not be chosen.\n\n2.  **Within-horizon minimum up/down times:**\n    - A startup at period $t$, indicated by $y_t = 1$, requires the unit to be online for periods $s \\in \\{t, t+1, \\dots, t+\\underline{U}-1\\}$. This is enforced by requiring $u_s = 1$ for all these periods. A standard linear constraint is $\\sum_{s=t}^{t+\\underline{U}-1} u_s \\ge \\underline{U} \\cdot y_t$.\n    - A shutdown at period $t$, indicated by $z_t = 1$, requires the unit to be offline for periods $s \\in \\{t, t+1, \\dots, t+\\underline{D}-1\\}$. This is enforced by requiring $u_s = 0$, or equivalently $1-u_s=1$, for all these periods. The linear constraint is $\\sum_{s=t}^{t+\\underline{D}-1} (1-u_s) \\ge \\underline{D} \\cdot z_t$.\n\n3.  **End-of-horizon truncation:** The above constraints must be modified for events occurring near the end of the horizon $T$.\n    - If a startup occurs at $t$ where $t+\\underline{U}-1 > T$, the unit must remain on for all subsequent periods until $T$. The number of such periods is $T-t+1$. The constraint becomes $\\sum_{s=t}^{T} u_s \\ge (T-t+1) \\cdot y_t$. This applies for $t \\in \\{T-\\underline{U}+2, \\dots, T\\}$.\n    - Similarly, for a shutdown at $t$ where $t+\\underline{D}-1 > T$, the constraint becomes $\\sum_{s=t}^{T} (1-u_s) \\ge (T-t+1) \\cdot z_t$. This applies for $t \\in \\{T-\\underline{D}+2, \\dots, T\\}$.\n\n4.  **Start-of-horizon residual obligations:** These are initial conditions that must be directly enforced.\n    - If $u_0 = 1$ with a residual counter $\\rho^{\\text{up}}_0 > 0$, the unit must be on for the first $\\rho^{\\text{up}}_0$ periods. This implies $u_t=1$ for $t \\in \\{1, \\dots, \\rho^{\\text{up}}_0\\}$. Furthermore, the unit cannot shut down in this interval, so $z_t=0$ for $t \\in \\{1, \\dots, \\rho^{\\text{up}}_0\\}$. The most direct enforcement is to set these variables to their required values. Summation constraints like $\\sum_{t=1}^{\\rho^{\\text{up}}_0} (1-u_t) = 0$ and $\\sum_{t=1}^{\\rho^{\\text{up}}_0} z_t = 0$ are the standard linear forms.\n    - If $u_0 = 0$ with a residual counter $\\rho^{\\text{down}}_0 > 0$, the unit must be off for the first $\\rho^{\\text{down}}_0$ periods. This implies $u_t=0$ for $t \\in \\{1, \\dots, \\rho^{\\text{down}}_0\\}$. The unit cannot start up, so $y_t=0$ for $t \\in \\{1, \\dots, \\rho^{\\text{down}}_0\\}$. The linear constraints are $\\sum_{t=1}^{\\rho^{\\text{down}}_0} u_t = 0$ and $\\sum_{t=1}^{\\rho^{\\text{down}}_0} y_t = 0$.\n\n### Option-by-Option Analysis\n\n**Option A**:\n- **Inter-temporal logic:** $u_t - u_{t-1} = y_t - z_t$ is correctly stated.\n- **Within-horizon up time:** The constraint $\\sum_{s=t}^{t + \\underline{U} - 1} u_s \\ge \\underline{U} \\, y_t$ is stated for $t \\in \\{1, \\dots, T - \\underline{U} + 1\\}$. This is correct.\n- **End-of-horizon up time:** The truncated constraint $\\sum_{s=t}^{T} u_s \\ge (T - t + 1) \\, y_t$ is stated for $t \\in \\{T - \\underline{U} + 2, \\dots, T\\}$. This is correct.\n- **Within-horizon down time:** The constraint $\\sum_{s=t}^{t + \\underline{D} - 1} (1 - u_s) \\ge \\underline{D} \\, z_t$ is stated for $t \\in \\{1, \\dots, T - \\underline{D} + 1\\}$. This is correct.\n- **End-of-horizon down time:** The truncated constraint $\\sum_{s=t}^{T} (1 - u_s) \\ge (T - t + 1) \\, z_t$ is stated for $t \\in \\{T - \\underline{D} + 2, \\dots, T\\}$. This is correct.\n- **Start-of-horizon logic:** For $u_0=1$, it correctly imposes $u_t=1$ and $z_t=0$ for $t \\in \\{1, \\dots, \\rho^{\\text{up}}_0\\}$. For $u_0=0$, it correctly imposes $u_t=0$ and $y_t=0$ for $t \\in \\{1, \\dots, \\rho^{\\text{down}}_0\\}$. The equivalent summation forms are also correct.\nThis option provides a complete and accurate formulation that matches the derived correct constraints in all aspects.\n\nVerdict: **Correct**.\n\n**Option B**:\nThis option contains several critical flaws.\n1.  It fails to include constraints for the start-of-horizon residual obligations, incorrectly claiming the in-horizon event constraints are sufficient. They are not, as they are triggered by events $y_t, z_t$ for $t \\ge 1$ and cannot account for obligations from before $t=1$.\n2.  It fails to handle end-of-horizon truncation for the minimum up/down time constraints, making the formulation incomplete for $t > T - \\underline{U}+1$ or $t > T - \\underline{D}+1$.\n3.  The constraint $u_1=u_0$ is incorrect as it forbids a startup or shutdown at $t=1$, which should be a valid decision if not prohibited by a residual obligation (i.e., if $\\rho^{\\text{up}}_0=0$ or $\\rho^{\\text{down}}_0=0$).\n\nVerdict: **Incorrect**.\n\n**Option C**:\nThis option is flawed in its logic for both start-of-horizon and end-of-horizon conditions.\n1.  The start-of-horizon constraints, $\\sum_{s=1}^{\\underline{U}} u_s \\ge \\underline{U} \\, u_0$ and $\\sum_{s=1}^{\\underline{D}} (1 - u_s) \\ge \\underline{D} \\, (1 - u_0)$, enforce the *full* minimum up/down time from $t=1$ if the unit was on/off at $t=0$. This disregards the provided residual counters $\\rho^{\\text{up}}_0$ and $\\rho^{\\text{down}}_0$, which specify the *remaining* obligation. This is an overly restrictive and inaccurate formulation given the problem's definitions.\n2.  It completely omits the end-of-horizon truncation for the within-horizon constraints, identical to the flaw in Option B.\n\nVerdict: **Incorrect**.\n\n**Option D**:\nThis option is fundamentally flawed.\n1.  It completely omits the minimum up/down time constraints for events occurring within the horizon ($t \\ge 1$), stating to rely only on the start-of-horizon constraints and the inter-temporal identity. This fails to model a primary requirement of the problem.\n2.  The start-of-horizon logic is inverted. If $u_0=1$, the unit is already on and must be prevented from shutting down ($z_t=0$ should be enforced), not from starting up ($y_t=0$ is proposed). If $u_0=0$, the unit is off and must be prevented from starting up ($y_t=0$ should be enforced), not from shutting down ($z_t=0$ is proposed).\n\nVerdict: **Incorrect**.\n\nBased on this comprehensive analysis, Option A is the only one that presents a correct, complete, and robust set of constraints for the specified unit commitment problem.",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "Effective energy system planning must contend with uncertainty, from fluctuating renewable output to volatile market prices. This exercise introduces you to decision-making under uncertainty through a two-stage stochastic optimization problem for an energy storage device. Your task is to determine the optimal first-stage action (how much to charge) that minimizes an *expected* future cost, while ensuring that inter-temporal physical constraints, such as State of Charge (SOC) limits, are respected across all possible future scenarios. This practice provides a hands-on introduction to a powerful framework for hedging against future risks. ",
            "id": "4098303",
            "problem": "Consider a two-stage stochastic energy storage optimization problem for a single storage device with State of Charge (SOC) bounds, where the second-period exogenous inflow is uncertain. The uncertainty is described by a discrete random variable $\\xi \\in \\{0,10\\}$ megawatt-hours (MWh), with $\\mathbb{P}(\\xi = 0) = 0.5$ and $\\mathbb{P}(\\xi = 10) = 0.5$. The decision variable is the first-period charge $c_1$ in MWh, chosen before the uncertainty is realized. The storage has initial SOC $s_0$ in MWh and maximum SOC $S_{\\max}$ in MWh. Charging efficiency is assumed to be $1$, and discharging is not performed in the first period. There is a first-period charge-rate upper bound $C_{\\max}$ in MWh.\n\nThe system follows the fundamental energy balance for storage, which is a direct consequence of conservation of energy: the SOC evolves inter-temporally according to\n$$ s_1 = s_0 + c_1, $$\nand, after the uncertain inflow realization $\\xi$, the SOC becomes\n$$ s_2(\\xi) = s_1 + \\xi = s_0 + c_1 + \\xi. $$\n\nInter-temporal feasibility requires that the SOC respects bounds at each stage for all uncertainty realizations:\n$$ 0 \\le s_1 \\le S_{\\max}, \\quad 0 \\le s_2(\\xi) \\le S_{\\max} \\text{ for all } \\xi \\in \\{0,10\\}. $$\nAdditionally, the first-period charging rate is bounded:\n$$ 0 \\le c_1 \\le C_{\\max}. $$\n\nThe expected cost to be minimized over the first-stage decision $c_1$ is the sum of a linear charging cost and a convex terminal SOC tracking penalty relative to a target reserve $r$ in MWh:\n$$ J(c_1) = p_1 \\, c_1 + \\gamma \\cdot \\mathbb{E}\\left[\\left(s_2(\\xi) - r\\right)^2\\right], $$\nwhere $p_1$ is the first-period charging price in dollars per MWh ($/\\text{MWh}$), and $\\gamma$ is a nonnegative penalty weight in dollars per squared MWh ($/\\text{MWh}^2$).\n\nYour task is to compute the optimizer $c_1$ in MWh that minimizes the expected cost $J(c_1)$ subject to the SOC bounds and the charge-rate bound. For all calculations, express $c_1$ in MWh. The final numerical outputs must be rounded to three decimal places.\n\nAssume the following parameters are given per test case:\n- $s_0$: initial SOC in MWh,\n- $S_{\\max}$: maximum SOC in MWh,\n- $C_{\\max}$: maximum charge rate in MWh for the first period,\n- $p_1$: first-period charging price in $/\\text{MWh}$,\n- $\\gamma$: penalty weight in $/\\text{MWh}^2$,\n- $r$: terminal SOC target in MWh.\n\nFrom the inter-temporal constraints and $\\xi \\in \\{0,10\\}$ MWh, feasibility requires:\n$$ 0 \\le c_1 \\le \\min\\left\\{ C_{\\max},\\, S_{\\max} - s_0 - 10 \\right\\}. $$\nAssume all test cases are feasible, that is, $S_{\\max} - s_0 - 10 \\ge 0$.\n\nTest Suite:\nProvide a program that computes $c_1$ for the following five test cases. For each case, report the optimal $c_1$ in MWh rounded to three decimal places.\n\n1. Case A (interior optimum expected): $s_0 = 20$, $S_{\\max} = 50$, $C_{\\max} = 15$, $p_1 = 2$, $\\gamma = 0.1$, $r = 40$.\n2. Case B (SOC upper bound active at optimum): $s_0 = 10$, $S_{\\max} = 25$, $C_{\\max} = 20$, $p_1 = 1$, $\\gamma = 0.5$, $r = 25$.\n3. Case C (lower bound active at optimum): $s_0 = 30$, $S_{\\max} = 60$, $C_{\\max} = 20$, $p_1 = 5$, $\\gamma = 0.1$, $r = 40$.\n4. Case D (zero feasible upper bound due to SOC): $s_0 = 40$, $S_{\\max} = 50$, $C_{\\max} = 100$, $p_1 = 1$, $\\gamma = 0.3$, $r = 45$.\n5. Case E (charge-rate upper bound active at optimum): $s_0 = 5$, $S_{\\max} = 100$, $C_{\\max} = 4$, $p_1 = 1$, $\\gamma = 0.2$, $r = 30$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1,result_2,\\dots]$). Each $result_i$ is the optimal $c_1$ in MWh for the corresponding test case, rounded to three decimal places. No additional text should be printed.",
            "solution": "The problem is formulated on fundamental inter-temporal energy balance and convex expected cost minimization under uncertainty. The State of Charge (SOC) is governed by conservation of energy, yielding $s_1 = s_0 + c_1$ and $s_2(\\xi) = s_1 + \\xi = s_0 + c_1 + \\xi$. The SOC bounds and the charge-rate constraint are\n$$ 0 \\le s_1 \\le S_{\\max}, \\quad 0 \\le s_2(\\xi) \\le S_{\\max}, \\quad 0 \\le c_1 \\le C_{\\max}. $$\nBecause $\\xi \\in \\{0,10\\}$ MWh must be feasible for all realizations, the upper bound on $s_2$ implies\n$$ s_0 + c_1 + 10 \\le S_{\\max} \\quad \\Rightarrow \\quad c_1 \\le S_{\\max} - s_0 - 10. $$\nThe lower bound $s_2(\\xi) \\ge 0$ is automatically satisfied when $c_1 \\ge 0$ and $s_0 \\ge 0$. The SOC bound on $s_1$ implies $0 \\le s_0 + c_1 \\le S_{\\max}$, but given $\\xi \\in \\{0,10\\}$ and $c_1 \\ge 0$, the more restrictive upper bound is $c_1 \\le S_{\\max} - s_0 - 10$. Combining with the charge-rate bound gives the feasible interval\n$$ \\mathcal{C} = \\big[0,\\, U\\big], \\quad U := \\min\\{C_{\\max},\\, S_{\\max} - s_0 - 10\\}. $$\nAssuming feasibility, $U \\ge 0$.\n\nThe expected cost to minimize is\n$$ J(c_1) = p_1 c_1 + \\gamma \\cdot \\mathbb{E}\\left[(s_0 + c_1 + \\xi - r)^2\\right]. $$\nUsing the law of the unconscious statistician for discrete variables and the given distribution,\n$$ \\mathbb{E}\\left[(s_0 + c_1 + \\xi - r)^2\\right] = 0.5\\,\\left[(s_0 + c_1 - r)^2 + (s_0 + c_1 + 10 - r)^2\\right]. $$\nHence\n$$ J(c_1) = p_1 c_1 + 0.5\\,\\gamma\\left[(s_0 + c_1 - r)^2 + (s_0 + c_1 + 10 - r)^2\\right]. $$\nThis is a strictly convex quadratic function in $c_1$ when $\\gamma > 0$, so the unconstrained minimizer is found by setting the derivative to zero:\n$$ \\frac{\\mathrm{d}J}{\\mathrm{d}c_1} = p_1 + \\gamma\\left[(s_0 + c_1 - r) + (s_0 + c_1 + 10 - r)\\right] = p_1 + \\gamma\\left[2(s_0 + c_1 - r) + 10\\right]. $$\nSetting $\\frac{\\mathrm{d}J}{\\mathrm{d}c_1} = 0$ yields\n$$ p_1 + \\gamma\\left[2(s_0 + c_1 - r) + 10\\right] = 0, $$\n$$ 2\\gamma(s_0 + c_1 - r) = -p_1 - 10\\gamma, $$\n$$ s_0 + c_1 - r = -\\frac{p_1 + 10\\gamma}{2\\gamma}, $$\nand thus the unconstrained optimizer is\n$$ c_1^{\\star} = r - s_0 - \\frac{p_1 + 10\\gamma}{2\\gamma}. $$\nImposing feasibility on $c_1$ requires projection onto the interval $\\mathcal{C} = [0, U]$, which for a convex problem is achieved by clamping:\n$$ c_1^{\\mathrm{opt}} = \\min\\left\\{\\max\\left\\{c_1^{\\star},\\,0\\right\\},\\,U\\right\\}, \\quad U = \\min\\{C_{\\max},\\, S_{\\max} - s_0 - 10\\}. $$\nThis expression captures all cases:\n- If $c_1^{\\star}  0$, then $c_1^{\\mathrm{opt}} = 0$.\n- If $c_1^{\\star} > U$, then $c_1^{\\mathrm{opt}} = U$.\n- Otherwise $c_1^{\\mathrm{opt}} = c_1^{\\star}$.\n\nAlgorithm:\n1. For each test case, compute $U = \\min\\{C_{\\max}, S_{\\max} - s_0 - 10\\}$.\n2. Compute $c_1^{\\star} = r - s_0 - \\frac{p_1 + 10\\gamma}{2\\gamma}$ for $\\gamma > 0$.\n3. Compute $c_1^{\\mathrm{opt}} = \\min\\{\\max\\{c_1^{\\star}, 0\\}, U\\}$.\n4. Round $c_1^{\\mathrm{opt}}$ to three decimal places and report in MWh.\n\nApplying this method to the provided test suite yields a list of five floating-point results, each representing the optimal $c_1$ in MWh for the corresponding case, rounded to three decimal places. The program implements this computation and prints the results in the specified single-line format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef optimal_c1(s0, Smax, Cmax, p1, gamma, r):\n    \"\"\"\n    Compute optimal first-stage charge c1 (in MWh) minimizing\n    J(c1) = p1*c1 + gamma * E[(s0 + c1 + xi - r)^2]\n    subject to 0 = c1 = U, where U = min(Cmax, Smax - s0 - 10),\n    with xi in {0, 10} equiprobable.\n    \"\"\"\n    # Feasible upper bound due to inter-temporal SOC constraints and charge rate\n    U = min(Cmax, Smax - s0 - 10)\n    # Assume feasibility as per problem statement: U = 0\n    # Unconstrained minimizer (gamma  0)\n    c1_star = r - s0 - (p1 + 10.0 * gamma) / (2.0 * gamma)\n    # Clamp to feasible interval [0, U]\n    c1_opt = min(max(c1_star, 0.0), U)\n    # Round to three decimals\n    return round(c1_opt + 0.0, 3)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (s0, Smax, Cmax, p1, gamma, r)\n    test_cases = [\n        (20.0, 50.0, 15.0, 2.0, 0.1, 40.0),   # Case A\n        (10.0, 25.0, 20.0, 1.0, 0.5, 25.0),   # Case B\n        (30.0, 60.0, 20.0, 5.0, 0.1, 40.0),   # Case C\n        (40.0, 50.0, 100.0, 1.0, 0.3, 45.0),  # Case D\n        (5.0, 100.0, 4.0, 1.0, 0.2, 30.0),    # Case E\n    ]\n\n    results = []\n    for case in test_cases:\n        s0, Smax, Cmax, p1, gamma, r = case\n        result = optimal_c1(s0, Smax, Cmax, p1, gamma, r)\n        results.append(f\"{result:.3f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}