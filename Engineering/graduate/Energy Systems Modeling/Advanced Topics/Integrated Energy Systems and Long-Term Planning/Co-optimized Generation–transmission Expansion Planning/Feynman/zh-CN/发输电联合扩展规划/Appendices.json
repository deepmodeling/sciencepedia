{
    "hands_on_practices": [
        {
            "introduction": "在任何发电和输电扩展规划中，核心任务是在不同投资方案之间做出经济上最合理的选择。本练习将通过一个基础性的案例，让您亲手实践如何运用净现值（$NPV$）方法来评估和比较两种不同的能源供应组合 。通过计算，您将深入理解资本成本、运营维护成本、以及资产残值在长期投资决策中的折现价值，这是进行复杂能源系统建模之前必须掌握的基本功。",
            "id": "4078601",
            "problem": "考虑一个双节点电力系统，在 $T = 20$ 年的有限规划期内进行发输电联合优化扩张规划。节点 $1$ 有一个无弹性的年能源需求，其量等于一个铭牌容量为 $100$ 兆瓦、容量因子为 $0.6$ 的恒定输出发电机所产生的能量。因此，年能源需求为 $100 \\times 8760 \\times 0.6$ 兆瓦时/年。从节点 $2$到节点 $1$ 有一条现有的输电联络线，其热容量为 $50$ 兆瓦。有一个候选的输电增强方案，如果建成，将增加 $100$ 兆瓦的传输容量。\n\n为完全满足节点 $1$ 的年能源需求，有两个相互排斥的可行投资组合：\n\n- 投资组合 $\\mathrm{A}$（仅本地发电）：在节点 $1$ 建造一台发电机，铭牌容量为 $100$ 兆瓦，实际隔夜建设资本成本为每千瓦 $1800$ 美元，固定运营和维护（O&M）成本为每千瓦年 $30$ 美元，可变生产成本为每兆瓦时 $45$ 美元，技术寿命为 $30$ 年，在整个规划期内容量因子恒为 $0.6$。不建造输电增强设施。\n\n- 投资组合 $\\mathrm{B}$（远程发电加输电增强）：在节点 $2$ 建造一台发电机，铭牌容量为 $100$ 兆瓦，实际隔夜建设资本成本为每千瓦 $1200$ 美元，固定运营和维护（O&M）成本为每千瓦年 $40$ 美元，可变生产成本为每兆瓦时 $20$ 美元，技术寿命为 $25$ 年，在整个规划期内容量因子恒为 $0.6$；并建造输电增强设施，将传输容量增加 $100$ 兆瓦，其实际隔夜建设资本成本为 $6000$ 万美元，固定运营和维护成本为每年 $100$ 万美元，技术寿命为 $40$ 年。\n\n假设恒定的实际贴现率为每年 $r = 0.05$。所有资本投资都发生在第 $0$ 年，并在那时一次性支付。固定运营和维护成本以及可变生产成本在第 $1$ 年到第 $T$ 年的每年年底发生。如果一项资产的技术寿命 $L$ 超过规划期 $T$，则将其在第 $T$ 年的残值视为等于其原始资本成本未折旧部分的线性残值，即在第 $T$ 年有一笔现金流入，金额为 $\\text{资本成本} \\times (L - T)/L$。忽略税收、指定实际贴现之外的通货膨胀以及任何退役成本。假设网络在所述情况之外无拥塞运行，因此投资组合 $\\mathrm{B}$ 通过增强的联络线向节点 $1$ 提供全部能源需求。\n\n仅使用基于现金流贴现和几何级数求和的货币时间价值基本定义，确定投资组合 $\\mathrm{A}$ 和 $\\mathrm{B}$ 中成本最低的那个的总系统成本的净现值。\n\n以百万美元（million USD）为单位表示最终净现值。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题被评估为有效，因为它具有科学依据、问题明确、客观且信息完备。它代表了电力系统扩张规划背景下的一个标准工程经济学问题。所有数据都一致且足以得出一个唯一解。\n\n目标是通过比较两个相互排斥的投资组合 A 和 B 在 $T = 20$ 年的规划期内、实际贴现率为 $r = 0.05$ 时的总系统成本净现值（NPV），来确定成本最低的投资组合。成本的净现值是所有贴现后现金流出的总和减去所有贴现后现金流入的总和。\n\n给定投资组合的成本净现值通用公式为：\n$$NPV = C_{CAP, 0} + \\sum_{t=1}^{T} \\frac{A_t}{(1+r)^t} - \\frac{S_T}{(1+r)^T}$$\n其中 $C_{CAP, 0}$ 是在第 $t=0$ 年发生的总资本投资成本， $A_t$ 是在第 $t$ 年年底发生的年成本， $S_T$ 是在规划期结束时（第 $T$ 年）作为现金流入实现的总残值。\n\n在这个问题中，年成本是恒定的，因此对于所有年份 $t=1, \\dots, T$ 都有 $A_t = A$。求和项代表了等额年金的现值，这是一个几何级数：\n$$\\sum_{t=1}^{T} \\frac{A}{(1+r)^t} = A \\left[ \\frac{1 - (1+r)^{-T}}{r} \\right]$$\n方括号中的项是现值年金系数， $PVAF(r, T)$。对于 $r=0.05$ 和 $T=20$：\n$$PVAF(0.05, 20) = \\frac{1 - (1+0.05)^{-20}}{0.05} = \\frac{1 - (1.05)^{-20}}{0.05}$$\n\n问题指明，年能源需求 $E$ 由一个铭牌容量为 $100$ 兆瓦、容量因子为 $0.6$ 的发电机来满足：\n$$E = 100 \\text{ MW} \\times 8760 \\frac{\\text{h}}{\\text{year}} \\times 0.6 = 525,600 \\frac{\\text{MWh}}{\\text{year}}$$\n两个投资组合都需要这个能源产量。\n\n**投资组合 A：本地发电**\n\n1.  **资本成本 ($C_{CAP, A}$):**\n    发电机的铭牌容量为 $100 \\text{ MW} = 100,000 \\text{ kW}$。隔夜建设资本成本为 $1800$ 美元/千瓦。\n    $$C_{CAP, A} = 100,000 \\text{ kW} \\times 1800 \\frac{\\text{USD}}{\\text{kW}} = 180,000,000 \\text{ USD}$$\n    该成本在第 $t=0$ 年发生。\n\n2.  **年成本 ($A_A$):**\n    年成本是固定运营和维护成本与可变生产成本的总和。\n    固定运营和维护成本：$100,000 \\text{ kW} \\times 30 \\frac{\\text{USD}}{\\text{kW-year}} = 3,000,000 \\frac{\\text{USD}}{\\text{year}}$。\n    可变成本：$525,600 \\frac{\\text{MWh}}{\\text{year}} \\times 45 \\frac{\\text{USD}}{\\text{MWh}} = 23,652,000 \\frac{\\text{USD}}{\\text{year}}$。\n    $$A_A = 3,000,000 + 23,652,000 = 26,652,000 \\frac{\\text{USD}}{\\text{year}}$$\n    这个年金在 $T=20$ 年内的现值为：\n    $$PV_{ANN, A} = A_A \\times PVAF(0.05, 20) = 26,652,000 \\times \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right]$$\n\n3.  **残值 ($S_A$):**\n    发电机的技术寿命为 $L_{G,A} = 30$ 年，大于规划期 $T = 20$ 年。残值是资本成本中未折旧的部分。\n    $$S_A = C_{CAP, A} \\times \\frac{L_{G,A} - T}{L_{G,A}} = 180,000,000 \\text{ USD} \\times \\frac{30 - 20}{30} = 60,000,000 \\text{ USD}$$\n    这是在第 $T=20$ 年的一笔现金流入。其现值为：\n    $$PV_{SAL, A} = \\frac{S_A}{(1+r)^T} = \\frac{60,000,000}{(1.05)^{20}}$$\n\n4.  **净现值 ($NPV_A$):**\n    $$NPV_A = C_{CAP, A} + PV_{ANN, A} - PV_{SAL, A}$$\n    $$NPV_A = 180,000,000 + 26,652,000 \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right] - \\frac{60,000,000}{(1.05)^{20}}$$\n    使用 $(1.05)^{20} \\approx 2.6532977$：\n    $$NPV_A \\approx 180,000,000 + 26,652,000 \\times 12.46221 - 22,613,369 = 180,000,000 + 332,143,623 - 22,613,369 = 489,530,254 \\text{ USD}$$\n\n**投资组合 B：远程发电和输电增强**\n\n1.  **资本成本 ($C_{CAP, B}$):**\n    这包括发电机和输电线路的资本成本，均在 $t=0$ 时发生。\n    发电机：$100,000 \\text{ kW} \\times 1200 \\frac{\\text{USD}}{\\text{kW}} = 120,000,000 \\text{ USD}$。\n    输电：$60,000,000 \\text{ USD}$。\n    $$C_{CAP, B} = 120,000,000 + 60,000,000 = 180,000,000 \\text{ USD}$$\n\n2.  **年成本 ($A_B$):**\n    这包括发电机和输电的固定运营和维护成本，以及发电机的可变成本。\n    发电机固定运营和维护成本：$100,000 \\text{ kW} \\times 40 \\frac{\\text{USD}}{\\text{kW-year}} = 4,000,000 \\frac{\\text{USD}}{\\text{year}}$。\n    发电机可变成本：$525,600 \\frac{\\text{MWh}}{\\text{year}} \\times 20 \\frac{\\text{USD}}{\\text{MWh}} = 10,512,000 \\frac{\\text{USD}}{\\text{year}}$。\n    输电固定运营和维护成本：$1,000,000 \\frac{\\text{USD}}{\\text{year}}$。\n    $$A_B = 4,000,000 + 10,512,000 + 1,000,000 = 15,512,000 \\frac{\\text{USD}}{\\text{year}}$$\n    这个年金的现值为：\n    $$PV_{ANN, B} = A_B \\times PVAF(0.05, 20) = 15,512,000 \\times \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right]$$\n\n3.  **残值 ($S_B$):**\n    由于两项资产的寿命（$L_{G,B}=25$, $L_{T,B}=40$）都超过 $T=20$，因此需要计算它们的残值。\n    发电机：$S_{G,B} = 120,000,000 \\times \\frac{25 - 20}{25} = 24,000,000 \\text{ USD}$。\n    输电：$S_{T,B} = 60,000,000 \\times \\frac{40 - 20}{40} = 30,000,000 \\text{ USD}$。\n    总残值：\n    $$S_B = S_{G,B} + S_{T,B} = 24,000,000 + 30,000,000 = 54,000,000 \\text{ USD}$$\n    这笔在第 $T=20$ 年的流入的现值为：\n    $$PV_{SAL, B} = \\frac{S_B}{(1+r)^T} = \\frac{54,000,000}{(1.05)^{20}}$$\n\n4.  **净现值 ($NPV_B$):**\n    $$NPV_B = C_{CAP, B} + PV_{ANN, B} - PV_{SAL, B}$$\n    $$NPV_B = 180,000,000 + 15,512,000 \\left[ \\frac{1 - (1.05)^{-20}}{0.05} \\right] - \\frac{54,000,000}{(1.05)^{20}}$$\n    $$NPV_B \\approx 180,000,000 + 15,512,000 \\times 12.46221 - 20,352,032 = 180,000,000 + 193,310,959 - 20,352,032 = 352,958,927 \\text{ USD}$$\n\n**比较**\n\n比较两个投资组合的总成本净现值：\n$NPV_A \\approx 489,530,254 \\text{ USD}$\n$NPV_B \\approx 352,958,927 \\text{ USD}$\n\n由于 $NPV_B  NPV_A$，投资组合 B 是成本最低的投资组合。问题要求以百万美元为单位，并四舍五入到四位有效数字，给出这个成本最低的投资组合的净现值。\n\n$NPV_B = 352.958927$ 百万美元。\n四舍五入到四位有效数字得到 $353.0$ 百万美元。",
            "answer": "$$\\boxed{353.0}$$"
        },
        {
            "introduction": "当我们将经济原则扩展到网络化的能源系统中时，发电与输电投资之间的权衡变得至关重要。此练习构建了一个简化的双节点网络模型，旨在阐明长期边际成本（$LRMC$）的概念，并引导您推导出决定本地发电与远程发电加输电方案经济性的盈亏平衡点 。通过这种筛选曲线分析，您将能够直观地理解固定成本和可变成本的权衡如何影响最优的系统扩展决策。",
            "id": "4078594",
            "problem": "一个中央规划者正在一个简化的双节点网络中进行发电-输电协同优化扩展规划。节点 $1$ 具有无限的潜力来建设基荷技术，其可变成本为常数 $c_{B}$，年化固定成本为每兆瓦年 $f_{B}$。节点 $2$ 具有无限的潜力来建设峰荷技术，其可变成本为常数 $c_{P}$，年化固定成本为每兆瓦年 $f_{P}$。两个节点由单一的输电走廊连接，其容量可以扩展，年化固定成本为每兆瓦年 $f_{T}$。假设无损直流（DC）潮流，并为了边际分析的目的忽略已有的容量。\n\n一个节点的长期边际成本（LRMC）定义为，在该节点年能源需求每增加一个单位时，总年化系统成本的最小增量，其中允许对发电和输电投资及调度进行最优化的再优化。考虑在节点 $2$ 有一个小的、恒定的负荷块，其大小为 $\\Delta$ $\\mathrm{MW}$，每年出现 $h$ 小时；相关的年能量为 $E=\\Delta h$ $\\mathrm{MWh}$。规划者可以通过在节点 $2$ 本地安装峰荷技术，或者在节点 $1$ 安装基荷技术并扩展输电走廊向节点 $2$ 输送电力，来满足这个增量负荷块。\n\n使用成本最小化的第一性原理和LRMC的定义，推导盈亏平衡的年使用小时数 $h^{\\star}$，在该小时数下，由节点 $1$ 的远程基荷发电加上输电扩展所提供的LRMC，恰好等于由节点 $2$ 的本地峰荷发电所提供的LRMC。然后根据以下数据计算 $h^{\\star}$ 的数值：\n- $f_{B} = 200{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$，\n- $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$，\n- $f_{P} = 80{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$，\n- $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$，\n- $f_{T} = 60{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$。\n\n将您的最终数值答案四舍五入到四位有效数字。最终答案以小时为单位表示。",
            "solution": "首先将根据指定程序对问题进行验证。\n\n### 步骤 1：提取已知条件\n-   系统：一个双节点网络，节点 $1$ 和节点 $2$。\n-   节点 $1$ 的发电：基荷技术，可变成本为 $c_{B}$，年化固定成本为每兆瓦年 $f_{B}$。无限安装潜力。\n-   节点 $2$ 的发电：峰荷技术，可变成本为 $c_{P}$，年化固定成本为每兆瓦年 $f_{P}$。无限安装潜力。\n-   输电：连接节点的单一走廊。容量可扩展，年化固定成本为每兆瓦年 $f_{T}$。\n-   建模假设：无损直流（DC）潮流。为进行边际分析，忽略已有的容量。\n-   LRMC的定义：一个节点的长期边际成本（LRMC）是指，在该节点年能源需求每增加一个单位时，总年化系统成本的最小增量，其中允许对发电和输电投资及调度进行最优化的再优化。\n-   增量负荷：在节点 $2$ 的一个小的、恒定的负荷块，大小为 $\\Delta$ $\\mathrm{MW}$，每年出现 $h$ 小时。\n-   增量能源：与该负荷块相关的年能量为 $E=\\Delta h$ $\\mathrm{MWh}$。\n-   数据：\n    -   $f_{B} = 200{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n    -   $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$\n    -   $f_{P} = 80{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n    -   $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$\n    -   $f_{T} = 60{,}000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   任务 1：推导盈亏平衡的年使用小时数 $h^{\\star}$。\n-   任务 2：计算 $h^{\\star}$ 的数值并四舍五入到四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据。它代表了能源经济学和系统工程中的一个经典但简化的问​​题，特别是关于发电和输电扩展规划。这种类型的分析，通常称为筛选曲线分析，是该领域的一个基本工具。该模型基于公认的成本最小化原则。该问题是适定的。目标明确（找到盈亏平衡小时数），提供的数据充分，且假设（例如，线性成本、无损直流潮流、为进行边际分析而忽略现有容量）构成了一个可解的系统。语言客观、精确。该问题是自洽且内部一致的。它不违反任何科学或数学原理。所有术语都在学科内有明确定义或是标准术语。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。将提供解答。\n\n该问题要求推导盈亏平衡的使用小时数 $h^{\\star}$，在该小时数下，服务增量负荷的两种方案具有相等的长期边际成本（LRMC）。增量负荷是在节点 $2$ 的一个大小为 $\\Delta$ $\\mathrm{MW}$ 的负荷块，每年持续 $h$ 小时。相关的年能源需求增量为 $E = \\Delta h$ $\\mathrm{MWh}$。\n\n根据问题的定义，LRMC是总年化系统成本的增量 $\\delta C_{sys}$ 与年能源需求增量 $\\delta E$ 的比值。对于一个小的、离散的负荷块，可以写作：\n$$\n\\mathrm{LRMC} = \\frac{\\delta C_{sys}}{\\delta E} = \\frac{\\delta C_{sys}}{\\Delta h}\n$$\n我们必须评估为这个增量负荷提供服务的两种供应方案的LRMC。\n\n**方案 1：在节点 $2$ 的本地峰荷发电**\n为了在节点 $2$ 服务一个 $\\Delta$ $\\mathrm{MW}$ 的负荷，必须在本地安装 $\\Delta$ $\\mathrm{MW}$ 的峰荷技术容量。\n这项新容量的年化固定成本是每兆瓦年的固定成本乘以增加的容量：\n$$\n\\delta C_{fixed, P} = f_{P} \\Delta\n$$\n年可变成本是为了在 $h$ 小时内生成 $\\Delta$ $\\mathrm{MW}$ 电力所产生的成本：\n$$\n\\delta C_{var, P} = c_{P} (\\Delta h)\n$$\n该方案的总年化系统成本增量是固定成本和可变成本之和：\n$$\n\\delta C_{sys, P} = f_{P} \\Delta + c_{P} \\Delta h\n$$\n因此，本地峰荷方案的LRMC，即 $\\mathrm{LRMC}_{P}$，为：\n$$\n\\mathrm{LRMC}_{P} = \\frac{\\delta C_{sys, P}}{\\Delta h} = \\frac{f_{P} \\Delta + c_{P} \\Delta h}{\\Delta h} = \\frac{f_{P}}{h} + c_{P}\n$$\n\n**方案 2：在节点 $1$ 的远程基荷发电加输电扩展**\n为了使用节点 $1$ 的发电来服务节点 $2$ 的 $\\Delta$ $\\mathrm{MW}$ 负荷，必须在节点 $1$ 建设 $\\Delta$ $\\mathrm{MW}$ 的新基荷容量，并且输电容量必须扩展 $\\Delta$ $\\mathrm{MW}$ 以输送电力。\n新基荷发电容量的年化固定成本是：\n$$\n\\delta C_{fixed, B} = f_{B} \\Delta\n$$\n新输电容量的年化固定成本是：\n$$\n\\delta C_{fixed, T} = f_{T} \\Delta\n$$\n该方案的总年化固定成本是发电和输电固定成本之和：\n$$\n\\delta C_{fixed, B+T} = (f_{B} + f_{T}) \\Delta\n$$\n年可变成本是基荷电厂在 $h$ 小时内发电的成本：\n$$\n\\delta C_{var, B} = c_{B} (\\Delta h)\n$$\n该方案的总年化系统成本增量是：\n$$\n\\delta C_{sys, B+T} = (f_{B} + f_{T}) \\Delta + c_{B} \\Delta h\n$$\n远程基荷方案的LRMC，即 $\\mathrm{LRMC}_{B+T}$，为：\n$$\n\\mathrm{LRMC}_{B+T} = \\frac{\\delta C_{sys, B+T}}{\\Delta h} = \\frac{(f_{B} + f_{T}) \\Delta + c_{B} \\Delta h}{\\Delta h} = \\frac{f_{B} + f_{T}}{h} + c_{B}\n$$\n\n**盈亏平衡小时数（$h^{\\star}$）的推导**\n盈亏平衡点 $h^{\\star}$ 是两种方案的LRMC相等的小时数。\n$$\n\\mathrm{LRMC}_{P} = \\mathrm{LRMC}_{B+T}\n$$\n将推导出的表达式在 $h = h^{\\star}$ 处代入：\n$$\n\\frac{f_{P}}{h^{\\star}} + c_{P} = \\frac{f_{B} + f_{T}}{h^{\\star}} + c_{B}\n$$\n为了求解 $h^{\\star}$，我们首先将含有 $h^{\\star}$ 的项和常数项分组：\n$$\nc_{P} - c_{B} = \\frac{f_{B} + f_{T}}{h^{\\star}} - \\frac{f_{P}}{h^{\\star}}\n$$\n$$\nc_{P} - c_{B} = \\frac{f_{B} + f_{T} - f_{P}}{h^{\\star}}\n$$\n假设 $c_{P} \\neq c_{B}$，我们可以分离出 $h^{\\star}$：\n$$\nh^{\\star} = \\frac{f_{B} + f_{T} - f_{P}}{c_{P} - c_{B}}\n$$\n这是盈亏平衡年使用小时数的符号表达式。\n\n**数值计算**\n现在，我们将提供的数值代入推导出的表达式中。给定的值为：\n-   $f_{B} = 200000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $f_{P} = 80000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $f_{T} = 60000$ $\\mathrm{\\$}/\\mathrm{MW}\\text{-}\\mathrm{year}$\n-   $c_{B} = 25$ $\\mathrm{\\$}/\\mathrm{MWh}$\n-   $c_{P} = 120$ $\\mathrm{\\$}/\\mathrm{MWh}$\n\n将这些值代入 $h^{\\star}$ 的公式中：\n$$\nh^{\\star} = \\frac{200000 + 60000 - 80000}{120 - 25}\n$$\n$$\nh^{\\star} = \\frac{180000}{95}\n$$\n$$\nh^{\\star} \\approx 1894.736842... \\text{ hours}\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nh^{\\star} \\approx 1895 \\text{ hours}\n$$\n盈亏平衡点大约在每年 $1895$ 小时。对于比这个时间短的持续时间，本地峰荷机组更经济。对于比这个时间长的持续时间，远程基荷电厂加输电扩展是服务增量负荷的更便宜选择。",
            "answer": "$$\\boxed{1895}$$"
        },
        {
            "introduction": "联合优化规划模型不仅能找出最低成本的投资和运营方案，其数学解还蕴含着丰富的经济信息。本实践将指导您编写程序来求解一个发输电联合扩展的线性规划问题，并重点关注其对偶变量（即影子价格）的解读 。通过提取和分析这些对偶变量，您将学习到如何将它们与节点边际电价（$LMPs$）等关键经济指标联系起来，并数值验证优化理论中的包络定理，从而深刻理解优化模型如何为电力系统规划和市场设计提供价值信号。",
            "id": "4078588",
            "problem": "考虑一个在双节点网络上构建的、具有单一时间快照的联合优化发电-输电扩展规划线性规划问题。决策变量包括节点 $1$ 和节点 $2$ 的发电调度量 $g_1$ 和 $g_2$（单位为 $\\mathrm{MW}$），从节点 $1$ 到节点 $2$ 的潮流 $f$（单位为 $\\mathrm{MW}$，可正可负），以及分别用于节点 $1$ 和节点 $2$ 发电的非负容量扩展 $\\Delta G_1$、$\\Delta G_2$（单位为 $\\mathrm{MW}$）和输电线路的容量扩展 $\\Delta L$（单位为 $\\mathrm{MW}$）。给定参数包括负荷 $d_1$、$d_2$（单位为 $\\mathrm{MW}$），现有容量 $G_1^{\\mathrm{base}}$、$G_2^{\\mathrm{base}}$ 和 $L^{\\mathrm{base}}$（单位为 $\\mathrm{MW}$），可变发电成本 $v_1$、$v_2$（单位为 $\\mathrm{\\$/MWh}$），以及每小时摊销的容量扩展成本 $k_{G_1}$、$k_{G_2}$ 和 $k_L$（单位为 $\\mathrm{\\$/MW\\text{-}h}$）。目标是最小化以 $\\mathrm{\\$/h}$ 为单位的系统总小时成本。\n\n原始线性规划为：\n最小化目标函数\n$$\nJ = v_1 g_1 + v_2 g_2 + k_{G_1} \\Delta G_1 + k_{G_2} \\Delta G_2 + k_L \\Delta L\n$$\n满足节点功率平衡等式约束\n$$\ng_1 - f = d_1, \\quad g_2 + f = d_2,\n$$\n容量不等式约束\n$$\ng_1 - \\Delta G_1 \\leq G_1^{\\mathrm{base}}, \\quad g_2 - \\Delta G_2 \\leq G_2^{\\mathrm{base}},\n$$\n$$\nf - \\Delta L \\leq L^{\\mathrm{base}}, \\quad -f - \\Delta L \\leq L^{\\mathrm{base}},\n$$\n以及边界条件\n$$\ng_1 \\ge 0, \\quad g_2 \\ge 0, \\quad \\Delta G_1 \\ge 0, \\quad \\Delta G_2 \\ge 0, \\quad \\Delta L \\ge 0, \\quad f \\in \\mathbb{R}.\n$$\n\n基于线性规划对偶和包络定理，与节点平衡等式相关的影子价格（对偶变量）提供了最优目标值 $J^\\star$ 对负荷 $d_1$ 和 $d_2$ 的灵敏度（方向导数），单位为 $\\mathrm{\\$/MWh}$；而与线路容量不等式相关的影子价格则提供了 $J^\\star$ 对 $L^{\\mathrm{base}}$ 的灵敏度，单位为 $\\mathrm{\\$/MWh}$。\n\n你的程序必须：\n- 求解给定参数集下的原始问题。\n- 提取节点平衡等式和各容量不等式的对偶变量（影子价格）。\n- 计算 $J^\\star$ 对 $L^{\\mathrm{base}}$ 的灵敏度，该灵敏度为两个线路不等式对偶变量之和，因为 $L^{\\mathrm{base}}$ 在两个线路不等式中均以相同的符号出现。\n- 通过使用一个小的扰动 $\\delta$（单位为 $\\mathrm{MW}$）计算 $\\partial J^\\star / \\partial d_2$ 的有限差分近似，即 $\\left(J^\\star(d_2+\\delta) - J^\\star(d_2)\\right)/\\delta$，并将其与节点 $2$ 节点平衡的对偶变量进行比较，从而对 $d_2$ 进行包络定理的数值验证。\n\n所有计算中的物理单位必须保持一致：$g_1$、$g_2$、$f$、$\\Delta G_1$、$\\Delta G_2$、$\\Delta L$、$d_1$、$d_2$、$G_1^{\\mathrm{base}}$、$G_2^{\\mathrm{base}}$、$L^{\\mathrm{base}}$ 的单位是 $\\mathrm{MW}$；$v_1$、$v_2$ 的单位是 $\\mathrm{\\$/MWh}$；$k_{G_1}$、$k_{G_2}$、$k_L$ 的单位是 $\\mathrm{\\$/MW\\text{-}h}$；最优目标值 $J^\\star$ 的单位是 $\\mathrm{\\$/h}$；对负荷和容量的灵敏度单位是 $\\mathrm{\\$/MWh}$。\n\n测试套件：\n为以下三个参数集提供结果，这些参数集旨在覆盖不同的运行状况。\n\n- 情况 1（节点 1 发电成本低，线路扩展成本适中，基础容量紧张）：\n    - $d_1 = 80$, $d_2 = 20$.\n    - $G_1^{\\mathrm{base}} = 50$, $G_2^{\\mathrm{base}} = 10$, $L^{\\mathrm{base}} = 10$.\n    - $v_1 = 20$, $v_2 = 60$.\n    - $k_{G_1} = 15$, $k_{G_2} = 8$, $k_{L} = 5$.\n- 情况 2（输电扩展成本高，倾向于节点 2 本地供电）：\n    - $d_1 = 10$, $d_2 = 90$.\n    - $G_1^{\\mathrm{base}} = 30$, $G_2^{\\mathrm{base}} = 50$, $L^{\\mathrm{base}} = 20$.\n    - $v_1 = 25$, $v_2 = 40$.\n    - $k_{G_1} = 20$, $k_{G_2} = 12$, $k_{L} = 100$.\n- 情况 3（基础容量充裕，无需扩展，可变成本相等）：\n    - $d_1 = 30$, $d_2 = 30$.\n    - $G_1^{\\mathrm{base}} = 100$, $G_2^{\\mathrm{base}} = 100$, $L^{\\mathrm{base}} = 100$.\n    - $v_1 = 30$, $v_2 = 30$.\n    - $k_{G_1} = 100$, $k_{G_2} = 100$, $k_{L} = 100$.\n\n对于每种情况，你的程序必须输出一个包含五个浮点数的列表：$[J^\\star, \\lambda_1, \\lambda_2, \\partial J^\\star / \\partial L^{\\mathrm{base}}, \\widehat{\\partial J^\\star / \\partial d_2}]$，其中 $\\lambda_1$ 和 $\\lambda_2$ 是节点 1 和节点 2 节点平衡等式的对偶变量（单位为 $\\mathrm{\\$/MWh}$），$\\partial J^\\star / \\partial L^{\\mathrm{base}}$ 是通过两个线路不等式对偶变量之和计算得出的（单位为 $\\mathrm{\\$/MWh}$），而 $\\widehat{\\partial J^\\star / \\partial d_2}$ 是使用扰动 $\\delta = 10^{-4}$ 计算的有限差分估计值（单位为 $\\mathrm{\\$/MWh}$）。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含三个测试用例的结果，格式为方括号括起来的逗号分隔的列表的列表，例如 $[[\\dots],[\\dots],[\\dots]]$。所有数值输出均表示上述指定单位的值，并且必须表示为不带单位符号的普通十进制数。",
            "solution": "我们从线性规划和对偶性的基本原理出发。原始问题是一个线性规划，其决策向量为 $x = [g_1, g_2, f, \\Delta G_1, \\Delta G_2, \\Delta L]^\\top$。目标函数是线性的，\n$$\nJ(x) = c^\\top x,\n$$\n其成本向量为 $c = [v_1, v_2, 0, k_{G_1}, k_{G_2}, k_L]^\\top$。等式约束表示每个节点的功率平衡，\n$$\nA_{\\mathrm{eq}} x = b_{\\mathrm{eq}}, \\quad A_{\\mathrm{eq}} = \\begin{bmatrix} 1  0  -1  0  0  0 \\\\ 0  1  1  0  0  0 \\end{bmatrix}, \\quad b_{\\mathrm{eq}} = \\begin{bmatrix} d_1 \\\\ d_2 \\end{bmatrix}.\n$$\n不等式约束表示容量限制，可重写为标准形式 $A_{\\mathrm{ub}} x \\le b_{\\mathrm{ub}}$，\n$$\nA_{\\mathrm{ub}} = \\begin{bmatrix}\n1  0  0  -1  0  0 \\\\\n0  1  0  0  -1  0 \\\\\n0  0  1  0  0  -1 \\\\\n0  0  -1  0  0  -1\n\\end{bmatrix}, \\quad\nb_{\\mathrm{ub}} = \\begin{bmatrix}\nG_1^{\\mathrm{base}} \\\\\nG_2^{\\mathrm{base}} \\\\\nL^{\\mathrm{base}} \\\\\nL^{\\mathrm{base}}\n\\end{bmatrix}.\n$$\n变量边界条件为 $g_1 \\ge 0$，$g_2 \\ge 0$，$\\Delta G_1 \\ge 0$，$\\Delta G_2 \\ge 0$，$\\Delta L \\ge 0$，且 $f$ 是自由变量。\n\n根据经过充分检验的线性规划对偶理论，原始最小化问题的对偶问题具有与等式约束相关的对偶变量 $\\lambda \\in \\mathbb{R}^2$ 和与不等式约束相关的对偶变量 $\\mu \\in \\mathbb{R}^4_{\\ge 0}$。拉格朗日函数为\n$$\n\\mathcal{L}(x, \\lambda, \\mu) = c^\\top x + \\lambda^\\top (A_{\\mathrm{eq}} x - b_{\\mathrm{eq}}) + \\mu^\\top (A_{\\mathrm{ub}} x - b_{\\mathrm{ub}}),\n$$\nKarush–Kuhn–Tucker 条件（线性规划的一阶最优性条件）包括原始可行性 $A_{\\mathrm{eq}} x = b_{\\mathrm{eq}}$，$A_{\\mathrm{ub}} x \\le b_{\\mathrm{ub}}$，边界条件满足；对于具有非负边界的变量，对偶可行性为 $A_{\\mathrm{eq}}^\\top \\lambda + A_{\\mathrm{ub}}^\\top \\mu \\le c$，并对自由变量进行适当处理；以及对每个不等式 $i$ 成立的互补松弛性 $\\mu_i \\cdot (A_{\\mathrm{ub},i} x - b_{\\mathrm{ub},i}) = 0$。\n\n灵敏度分析源于包络定理：在正则性和唯一性条件下，最优值 $J^\\star$ 对右端项的梯度由最优对偶变量给出。具体来说，对于等式约束的右端项 $b_{\\mathrm{eq}}$，我们有\n$$\n\\frac{\\partial J^\\star}{\\partial b_{\\mathrm{eq}}} = \\lambda^\\star,\n$$\n因此 $\\frac{\\partial J^\\star}{\\partial d_1} = \\lambda_1^\\star$ 和 $\\frac{\\partial J^\\star}{\\partial d_2} = \\lambda_2^\\star$，单位均为 $\\mathrm{\\$/MWh}$。对于不等式约束的右端项 $b_{\\mathrm{ub}}$，我们有\n$$\n\\frac{\\partial J^\\star}{\\partial b_{\\mathrm{ub},i}} = \\mu_i^\\star,\n$$\n因此 $J^\\star$ 对 $L^{\\mathrm{base}}$ 的灵敏度是两个线路不等式对偶变量之和，因为 $L^{\\mathrm{base}}$ 在两者中均以系数 $+1$ 出现：\n$$\n\\frac{\\partial J^\\star}{\\partial L^{\\mathrm{base}}} = \\mu_3^\\star + \\mu_4^\\star.\n$$\n\n算法设计：\n- 直接根据所提供的参数构建原始矩阵 $A_{\\mathrm{eq}}$、$b_{\\mathrm{eq}}$、$A_{\\mathrm{ub}}$、$b_{\\mathrm{ub}}$、成本向量 $c$ 和边界条件。\n- 使用能够提供对偶信息的数值稳定求解器来求解原始线性规划问题。Highs 中的高性能内点法或单纯形法实现（通过标准科学计算库访问）会返回每个等式和不等式约束的对偶变量（边际值）。\n- 从等式约束的边际值中提取 $\\lambda^\\star$，从不等式约束的边际值中提取 $\\mu^\\star$。\n- 计算灵敏度 $\\partial J^\\star / \\partial L^{\\mathrm{base}}$，其值为 $\\mu_3^\\star + \\mu_4^\\star$。\n- 通过使用一个小的扰动 $\\delta$ 计算有限差分近似来验证 $\\partial J^\\star / \\partial d_2$ 的包络定理：\n$$\n\\widehat{\\frac{\\partial J^\\star}{\\partial d_2}} = \\frac{J^\\star(d_2 + \\delta) - J^\\star(d_2)}{\\delta}.\n$$\n选择 $\\delta = 10^{-4}$ 以确保扰动相对于变量的规模足够小，从而平衡数值稳定性和准确性。\n\n单位与解释：\n- 最优目标值 $J^\\star$ 的单位是 $\\mathrm{\\$/h}$，因为在一个小时的快照中，发电调度成本 $v_i g_i$ 的单位是 $\\mathrm{\\$/MWh} \\cdot \\mathrm{MW} = \\mathrm{\\$/h}$，而容量扩展成本 $k_{G_i} \\Delta G_i$、$k_L \\Delta L$ 的单位是 $\\mathrm{\\$/MW\\text{-}h} \\cdot \\mathrm{MW} = \\mathrm{\\$/h}$。\n- 对偶变量 $\\lambda_1^\\star$、$\\lambda_2^\\star$ 分别代表节点 1 和节点 2 的位置边际电价（LMP），单位为 $\\mathrm{\\$/MWh}$。它们等于在联合优化规划框架内，在每个节点服务额外一兆瓦（$\\mathrm{MW}$）的边际成本，这包括了以每小时摊销成本进行容量扩展的可能性。\n- 灵敏度 $\\partial J^\\star / \\partial L^{\\mathrm{base}}$ 等于将基础线路容量增加一兆瓦（$\\mathrm{MW}$）的边际价值，单位同样是 $\\mathrm{\\$/MWh}$，该值是两个潮流方向约束贡献的总和。\n\n实现细节：\n- 使用能够提供原始解和对偶解的鲁棒线性规划功能。\n- 组合每个测试用例，进行求解，并收集所需的输出。\n- 对 $d_2$ 使用 $\\delta = 10^{-4}$ 进行有限差分检验。\n\n最后，将三个测试用例的结果汇总成指定的单行输出格式，其中每个用例产生列表 $[J^\\star, \\lambda_1^\\star, \\lambda_2^\\star, \\partial J^\\star / \\partial L^{\\mathrm{base}}, \\widehat{\\partial J^\\star / \\partial d_2}]$，并以方括号括起来的逗号分隔的列表的列表形式打印。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve_case(params, fd_eps=1e-4):\n    # Unpack parameters\n    d1 = params[\"d1\"]\n    d2 = params[\"d2\"]\n    G1_base = params[\"G1_base\"]\n    G2_base = params[\"G2_base\"]\n    L_base = params[\"L_base\"]\n    v1 = params[\"v1\"]\n    v2 = params[\"v2\"]\n    kG1 = params[\"kG1\"]\n    kG2 = params[\"kG2\"]\n    kL = params[\"kL\"]\n\n    # Cost vector: [g1, g2, f, dG1, dG2, dL]\n    c = np.array([v1, v2, 0.0, kG1, kG2, kL], dtype=float)\n\n    # Equality constraints A_eq x = b_eq\n    # g1 - f = d1\n    # g2 + f = d2\n    A_eq = np.array([\n        [1, 0, -1, 0, 0, 0],\n        [0, 1,  1, 0, 0, 0]\n    ], dtype=float)\n    b_eq = np.array([d1, d2], dtype=float)\n\n    # Inequality constraints A_ub x = b_ub\n    # g1 - dG1 = G1_base\n    # g2 - dG2 = G2_base\n    # f - dL = L_base\n    # -f - dL = L_base\n    A_ub = np.array([\n        [1, 0, 0, -1, 0,  0],\n        [0, 1, 0,  0,-1,  0],\n        [0, 0, 1,  0, 0, -1],\n        [0, 0,-1,  0, 0, -1]\n    ], dtype=float)\n    b_ub = np.array([G1_base, G2_base, L_base, L_base], dtype=float)\n\n    # Variable bounds: g1>=0, g2>=0, f free, dG1>=0, dG2>=0, dL>=0\n    bounds = [(0, None), (0, None), (None, None), (0, None), (0, None), (0, None)]\n\n    # Solve the LP\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method=\"highs\")\n\n    if not res.success:\n        # In a robust implementation, we might handle infeasibility. Here, we rely on feasibility by design.\n        raise RuntimeError(f\"LP did not solve successfully: {res.message}\")\n\n    J_star = float(res.fun)\n\n    # Extract dual variables (marginals)\n    # For HiGHS via SciPy, equality and inequality marginals are available\n    lam_eq = np.array(res.eqlin.marginals, dtype=float) if hasattr(res, \"eqlin\") else np.zeros(2)\n    mu_ineq = np.array(res.ineqlin.marginals, dtype=float) if hasattr(res, \"ineqlin\") else np.zeros(4)\n\n    lambda1 = float(lam_eq[0])\n    lambda2 = float(lam_eq[1])\n\n    # Sensitivity wrt L_base appears in both line constraints (indices 2 and 3)\n    dJ_dLbase = float(mu_ineq[2] + mu_ineq[3])\n\n    # Finite-difference check for derivative wrt d2\n    b_eq_fd = np.array([d1, d2 + fd_eps], dtype=float)\n    res_fd = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq_fd, bounds=bounds, method=\"highs\")\n    if not res_fd.success:\n        raise RuntimeError(f\"FD LP did not solve successfully: {res_fd.message}\")\n    J_star_fd = float(res_fd.fun)\n    fd_dJ_dd2 = (J_star_fd - J_star) / fd_eps\n\n    return [J_star, lambda1, lambda2, dJ_dLbase, fd_dJ_dd2]\n\ndef solve():\n    test_cases = [\n        {\n            \"d1\": 80.0, \"d2\": 20.0,\n            \"G1_base\": 50.0, \"G2_base\": 10.0, \"L_base\": 10.0,\n            \"v1\": 20.0, \"v2\": 60.0,\n            \"kG1\": 15.0, \"kG2\": 8.0, \"kL\": 5.0\n        },\n        {\n            \"d1\": 10.0, \"d2\": 90.0,\n            \"G1_base\": 30.0, \"G2_base\": 50.0, \"L_base\": 20.0,\n            \"v1\": 25.0, \"v2\": 40.0,\n            \"kG1\": 20.0, \"kG2\": 12.0, \"kL\": 100.0\n        },\n        {\n            \"d1\": 30.0, \"d2\": 30.0,\n            \"G1_base\": 100.0, \"G2_base\": 100.0, \"L_base\": 100.0,\n            \"v1\": 30.0, \"v2\": 30.0,\n            \"kG1\": 100.0, \"kG2\": 100.0, \"kL\": 100.0\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        results.append(solve_case(case, fd_eps=1e-4))\n\n    # Print single-line aggregated output as specified\n    # Convert nested lists to string with comma-separated values\n    print(\"[\" + \",\".join([\"[\" + \",\".join(map(str, r)) + \"]\" for r in results]) + \"]\")\n\nsolve()\n```"
        }
    ]
}