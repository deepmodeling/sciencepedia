{
    "hands_on_practices": [
        {
            "introduction": "在化石燃料供应链建模中，一项核心任务是确保产品质量符合规格。炼油厂和调和站通常会混合多种不同品质的原料（例如原油），因此优化模型必须包含能够准确反映混合过程的约束。本练习  将引导你从质量守恒这一基本物理原理出发，推导出用于控制污染物含量（如硫含量）的线性调和约束，这是将物理现实转化为线性规划模型中数学形式的一项基本技能。",
            "id": "4091811",
            "problem": "一个管道混合终端接收 $n$ 股进来的化石燃料流（例如，原油），索引为 $i \\in \\{1, \\dots, n\\}$。每股流 $i$ 的特征在于其质量 $m_i \\ge 0$（在一个指定的规划期内）和一种按质量线性混合的污染物（例如，硫）的质量分数 $q_i \\in [0,1]$。混合后的出口流必须满足关于污染物质量分数的一个最大规格 $Q^{\\mathrm{spec}} \\in [0,1]$。\n\n仅从质量守恒原理和可加属性按质量线性混合这一事实出发，推导一个关于决策变量 $m_i$ 的线性不等式，该不等式强制要求混合出口流的污染物质量分数不超过 $Q^{\\mathrm{spec}}$。然后，定义该不等式的左侧函数 $L(m_1,\\dots,m_n)$，以便该约束可以写成规范线性形式 $L(m_1,\\dots,m_n) \\le 0$，用于线性规划或混合整数线性规划。你的最终答案必须是 $L(m_1,\\dots,m_n)$ 的闭式解析表达式。不需要进行数值计算，且最终答案中不应出现任何不等号或等号。假设 $q_i$ 和 $Q^{\\mathrm{spec}}$ 是先验已知的固定参数，并且所有 $m_i$ 都是非负决策变量。将 $q_i$ 和 $Q^{\\mathrm{spec}}$ 视为无量纲的质量分数。",
            "solution": "首先将根据指定标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 进料流数量：$n$。\n- 料流索引：$i \\in \\{1, \\dots, n\\}$。\n- 料流 $i$ 的质量（决策变量）：$m_i \\ge 0$。\n- 料流 $i$ 的污染物质量分数（参数）：$q_i \\in [0,1]$。\n- 出口混合物的最大污染物质量分数（参数）：$Q^{\\mathrm{spec}} \\in [0,1]$。\n- 污染物按质量线性混合。\n- 推导必须从质量守恒和线性混合原理出发。\n- 最终约束必须是形式为 $L(m_1,\\dots,m_n) \\le 0$ 的线性不等式。\n- 最终答案是函数 $L(m_1,\\dots,m_n)$ 的解析表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n对照验证标准对问题进行评估。\n\n- **有科学依据：** 问题基于质量守恒基本原理和质量分数的定义，这些是化学、物理和工程学中的基石概念。对于像硫含量这样的属性按质量线性混合的假设，是炼油和化工行业使用的标准有效模型。\n- **适定性：** 该问题是适定的。它要求基于明确陈述的物理原理和变量，推导一个特定的数学表达式（一个线性约束）。目标明确，并且提供了足够的信息来得出一个唯一的解析函数 $L$。\n- **客观性：** 问题以精确、客观和定量的术语陈述。“质量分数”和“线性不等式”等术语是标准的，没有歧义或主观解释。\n\n该问题没有任何使其无效的缺陷。它不是科学上不合理、不可形式化、不完整、不切实际、病态、微不足道或不可验证的。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将按要求推导解决方案。\n\n推导过程从所述的两个基本原理出发：质量守恒和污染物属性的线性混合。\n\n1.  **总质量守恒：** 出口混合流的总质量，记为 $M_{\\text{total}}$，是 $n$ 股入口流质量的总和。\n    $$M_{\\text{total}} = \\sum_{i=1}^{n} m_i$$\n    由于每个 $m_i \\ge 0$，因此 $M_{\\text{total}} \\ge 0$。我们将考虑非平凡情况，即至少有一个 $m_i  0$，因此 $M_{\\text{total}}  0$。\n\n2.  **污染物质量守恒：** 每股入口流 $i$ 中的污染物质量是该流总质量 $m_i$ 与其污染物质量分数 $q_i$ 的乘积，即 $q_i m_i$。由于污染物属性是可加的并且按质量线性混合，最终混合物中污染物的总质量 $M_{\\text{cont}}$ 是每股输入流中污染物质量的总和。\n    $$M_{\\text{cont}} = \\sum_{i=1}^{n} q_i m_i$$\n\n3.  **混合流的属性：** 最终混合流中污染物的质量分数，我们记为 $Q_{\\text{blend}}$，定义为污染物总质量与混合物总质量之比。\n    $$Q_{\\text{blend}} = \\frac{M_{\\text{cont}}}{M_{\\text{total}}} = \\frac{\\sum_{i=1}^{n} q_i m_i}{\\sum_{i=1}^{n} m_i}$$\n\n4.  **建立不等式：** 问题要求混合物中污染物的质量分数不超过规格 $Q^{\\mathrm{spec}}$。这表示为以下不等式：\n    $$Q_{\\text{blend}} \\le Q^{\\mathrm{spec}}$$\n    代入 $Q_{\\text{blend}}$ 的表达式，得到：\n    $$\\frac{\\sum_{i=1}^{n} q_i m_i}{\\sum_{i=1}^{n} m_i} \\le Q^{\\mathrm{spec}}$$\n\n5.  **转换为规范线性形式：** 为了将其表示为关于决策变量 $m_i$ 的线性不等式，我们必须消除分母。分母 $\\sum_{i=1}^{n} m_i$ 代表总质量，是非负的。对于任何非平凡的混合，这个和是严格为正的。不等式两边同乘以这个正数，不会改变不等号的方向。\n    $$\\sum_{i=1}^{n} q_i m_i \\le Q^{\\mathrm{spec}} \\left( \\sum_{j=1}^{n} m_j \\right)$$\n    （在右侧的和中使用不同的索引 $j$ 在表示法上更清晰，但并非严格必要；我们可以换回 $i$。）\n    $$\\sum_{i=1}^{n} q_i m_i \\le Q^{\\mathrm{spec}} \\sum_{i=1}^{n} m_i$$\n    为了得到规范形式 $L(m_1,\\dots,m_n) \\le 0$，我们将所有项移到不等式的左侧。\n    $$\\sum_{i=1}^{n} q_i m_i - Q^{\\mathrm{spec}} \\sum_{i=1}^{n} m_i \\le 0$$\n    这两个求和可以合并成一个单独的求和，因为它们都在相同的索引集 $i=1$ 到 $n$ 上进行迭代。\n    $$\\sum_{i=1}^{n} (q_i m_i - Q^{\\mathrm{spec}} m_i) \\le 0$$\n    从求和内的每一项中提取出决策变量 $m_i$，得到不等式的最终线性形式：\n    $$\\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i \\le 0$$\n    这个不等式对于变量 $m_i$ 是线性的，因为项 $(q_i - Q^{\\mathrm{spec}})$ 是常数系数。\n\n6.  **确定函数 $L$：** 问题要求找出左侧函数 $L(m_1,\\dots,m_n)$，使得约束为 $L(m_1,\\dots,m_n) \\le 0$。通过观察推导出的不等式，这个函数是：\n    $$L(m_1,\\dots,m_n) = \\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i$$\n    这就是所要求的闭式解析表达式。",
            "answer": "$$\\boxed{\\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i}$$"
        },
        {
            "introduction": "供应链模型不仅要考虑产品质量，还必须受制于基础设施的物理容量。管道作为化石燃料运输的关键环节，其最大输送能力是决定区域供应能力的重要参数。此练习  让你能亲手实践如何应用流体力学中的 Darcy-Weisbach 等基本方程，根据管道的物理特性和流体性质来计算其水力极限。通过这个计算，你将理解模型中的“容量”参数是如何从底层工程原理中具体化而来的。",
            "id": "4091834",
            "problem": "一条原油干线管道是区域化石燃料供应链中的一个容量限制元件。该管道在稳态下将单相原油从沿海终端输送到内陆枢纽，高程变化和局部损失可忽略不计。管道长度为 $L = 60{,}000\\,\\text{m}$，内径为 $D = 0.60\\,\\text{m}$，商用钢管的内部绝对粗糙度为 $\\epsilon = 2.0 \\times 10^{-4}\\,\\text{m}$。在工作温度下，油的密度为 $\\rho = 870\\,\\text{kg}\\,\\text{m}^{-3}$，动力粘度为 $\\mu = 1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}$。受泵站和最大允许工作压力限制，该管段的可用压降为 $\\Delta p = 8.0 \\times 10^{5}\\,\\text{Pa}$。\n\n从稳态不可压缩流体的机械能守恒方程和适用于粗糙管道中湍流的摩擦损失的物理上恰当的表示出发，推导将体积流量 $Q$ 与可用压降 $\\Delta p$、管道和流体性质 $(L, D, \\epsilon, \\rho, \\mu)$ 以及摩擦系数联系起来的控制关系式。然后，计算在该液压限制条件下，此管段能够维持的最大体积流量 $Q$。\n\n假设流动保持单相，在此条件下原油可视为不可压缩，且与沿程摩擦损失相比，局部损失可忽略不计。将最大体积流量的最终答案四舍五入至三位有效数字，并以立方米/秒为单位表示。",
            "solution": "首先对问题进行验证。\n\n**步骤1：提取已知条件**\n- 管道长度：$L = 60{,}000\\,\\text{m}$\n- 内径：$D = 0.60\\,\\text{m}$\n- 内部绝对粗糙度：$\\epsilon = 2.0 \\times 10^{-4}\\,\\text{m}$\n- 油密度：$\\rho = 870\\,\\text{kg}\\,\\text{m}^{-3}$\n- 动力粘度：$\\mu = 1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}$\n- 可用压降：$\\Delta p = 8.0 \\times 10^{5}\\,\\text{Pa}$\n- 假设：稳态、单相、不可压缩流，高程变化可忽略，局部损失可忽略。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，是流体力学原理（Darcy-Weisbach 和 Colebrook-White 方程）在能源系统实际工程场景中的标准应用。所提供的流体（原油）和管道（商用钢）数据在物理上是现实的。该问题是适定的；它提供了所有必要的信息和约束条件，以确定一个唯一的、稳定的流量解。所使用的语言客观而精确。该问题是自洽的、一致的，并且没有任何科学或逻辑上的缺陷。\n\n**步骤3：结论与行动**\n问题有效。将提供完整解答。\n\n**求解推导**\n分析始于不可压缩流体在两点（指定为 $1$（入口）和 $2$（出口））之间流动的稳态机械能守恒方程。该方程以水头的形式表示为：\n$$ \\frac{p_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 = \\frac{p_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + h_L $$\n此处，$p$ 是压力，$v$ 是平均流速，$z$ 是高程，$\\rho$ 是流体密度，$g$ 是重力加速度，$h_L$ 是总水头损失。\n\n我们应用问题中给出的条件：\n1.  管道的内径 $D$ 恒定，因此横截面积 $A$ 恒定。根据连续性方程（$Q = A_1 v_1 = A_2 v_2$），平均速度相等：$v_1 = v_2$。因此动能项相互抵消。\n2.  高程变化可忽略不计，因此 $z_1 = z_2$。\n3.  局部损失可忽略不计，因此总水头损失 $h_L$ 等于主要摩擦水头损失 $h_f$。\n\n能量守恒方程简化为：\n$$ \\frac{p_1 - p_2}{\\rho g} = h_f $$\n压降已知为 $\\Delta p = p_1 - p_2 = 8.0 \\times 10^{5}\\,\\text{Pa}$。因此：\n$$ \\frac{\\Delta p}{\\rho g} = h_f $$\n摩擦水头损失由 Darcy-Weisbach 方程描述：\n$$ h_f = f \\frac{L}{D} \\frac{v^2}{2g} $$\n其中 $f$ 是 Darcy 摩擦系数。\n\n将 Darcy-Weisbach 表达式代入简化的能量守恒方程，得到：\n$$ \\frac{\\Delta p}{\\rho g} = f \\frac{L}{D} \\frac{v^2}{2g} $$\n乘以 $\\rho g$ 得到压降和速度之间的控制关系：\n$$ \\Delta p = f \\frac{L}{D} \\frac{\\rho v^2}{2} $$\n为了用体积流量 $Q$ 来表示，我们使用关系式 $v = Q/A$，其中面积为 $A = \\frac{\\pi D^2}{4}$。代入 $v$：\n$$ \\Delta p = f \\frac{L}{D} \\frac{\\rho}{2} \\left( \\frac{Q}{\\frac{\\pi D^2}{4}} \\right)^2 = f \\frac{L}{D} \\frac{8 \\rho}{\\pi^2 D^4} Q^2 $$\n这就是连接 $Q$ 与 $\\Delta p$ 及其他参数的控制关系式。\n\n要计算 $Q$，我们必须确定摩擦系数 $f$。对于大型管道中预期的湍流，$f$ 是雷诺数 $Re$ 和相对粗糙度 $\\epsilon/D$ 的函数。Colebrook-White 方程提供了这种关系：\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} \\left( \\frac{\\epsilon/D}{3.7} + \\frac{2.51}{Re \\sqrt{f}} \\right) $$\n雷诺数的定义为：\n$$ Re = \\frac{\\rho v D}{\\mu} = \\frac{4 \\rho Q}{\\pi D \\mu} $$\n这个系统是隐式的，因为 $Q$ 依赖于 $f$，而 $f$ 又依赖于 $Re$，而 $Re$ 又依赖于 $Q$。为了求解这个系统，我们可以重新排列方程。从以压力表示的 Darcy-Weisbach 方程出发：\n$$ v = \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} $$\n将此代入雷诺数的定义：\n$$ Re = \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} $$\n一个有用的项组合是 $Re\\sqrt{f}$：\n$$ Re\\sqrt{f} = \\left( \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} \\right) \\sqrt{f} = \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{\\rho L}} $$\n这个量与未知数 $f$ 和 $v$（或 $Q$）无关，可以直接从已知数据计算得出。\n\n首先，我们计算常数参数：\n相对粗糙度：$\\frac{\\epsilon}{D} = \\frac{2.0 \\times 10^{-4}\\,\\text{m}}{0.60\\,\\text{m}} = \\frac{1}{3000} \\approx 3.333 \\times 10^{-4}$。\n\n接下来，我们计算 $Re\\sqrt{f}$ 的值：\n$$ Re\\sqrt{f} = \\frac{(870\\,\\text{kg}\\,\\text{m}^{-3})(0.60\\,\\text{m})}{1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}} \\sqrt{\\frac{2(0.60\\,\\text{m})(8.0 \\times 10^{5}\\,\\text{Pa})}{(870\\,\\text{kg}\\,\\text{m}^{-3})(60{,}000\\,\\text{m})}} $$\n$$ Re\\sqrt{f} = (34800) \\sqrt{\\frac{9.6 \\times 10^5}{5.22 \\times 10^7}} = (34800) \\sqrt{0.0183908...} = (34800)(0.135612...) \\approx 4719.3 $$\n现在，我们将此值代入 Colebrook-White 方程以求得 $f$：\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} \\left( \\frac{3.333 \\times 10^{-4}}{3.7} + \\frac{2.51}{4719.3} \\right) $$\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} (9.009 \\times 10^{-5} + 5.3188 \\times 10^{-4}) $$\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} (6.2197 \\times 10^{-4}) \\approx -2.0 (-3.2062) \\approx 6.4124 $$\n由此，我们可以解出 $f$：\n$$ f = \\left( \\frac{1}{6.4124} \\right)^2 \\approx 0.02432 $$\n确定了摩擦系数后，我们现在可以计算平均速度 $v$：\n$$ v = \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} = \\sqrt{\\frac{2(0.60\\,\\text{m})(8.0 \\times 10^{5}\\,\\text{Pa})}{(0.02432)(870\\,\\text{kg}\\,\\text{m}^{-3})(60{,}000\\,\\text{m})}} $$\n$$ v = \\sqrt{\\frac{9.6 \\times 10^5}{1.270 \\times 10^6}} \\approx \\sqrt{0.7557} \\approx 0.8693\\,\\text{m}\\,\\text{s}^{-1} $$\n作为检验，我们计算雷诺数以确认湍流假设：\n$$ Re = \\frac{\\rho v D}{\\mu} = \\frac{(870)(0.8693)(0.60)}{1.5 \\times 10^{-2}} \\approx 30250 $$\n由于 $Re > 4000$，流动是湍流，因此我们使用 Colebrook-White 方程是恰当的。\n\n最后，我们计算最大体积流量 $Q$：\n$$ Q = A v = \\left( \\frac{\\pi D^2}{4} \\right) v = \\left( \\frac{\\pi (0.60\\,\\text{m})^2}{4} \\right) (0.8693\\,\\text{m}\\,\\text{s}^{-1}) $$\n$$ Q = (0.28274\\,\\text{m}^2)(0.8693\\,\\text{m}\\,\\text{s}^{-1}) \\approx 0.2458\\,\\text{m}^3\\,\\text{s}^{-1} $$\n根据要求四舍五入到三位有效数字，我们得到 $Q = 0.246\\,\\text{m}^3\\,\\text{s}^{-1}$。",
            "answer": "$$\n\\boxed{0.246}\n$$"
        },
        {
            "introduction": "掌握了如何为质量和输送能力建立模型后，下一步便是将这些约束与经济因素相结合，以指导运营决策。此练习  构建了一个经典的单元承诺（unit commitment）问题，要求你在满足需求的同时，最小化总运营成本。你将需要权衡可变生产成本、每次运行时产生的固定成本以及冷启动时的额外启动成本，通过探索不同的开关机计划，深刻理解驱动供应链经济效益的核心决策逻辑。",
            "id": "4091824",
            "problem": "您的任务是构建和分析一个简化的混合整数优化模型，该模型模拟一个化石燃料供应链单元，在离散时间范围内将化石输入流转换为输出流，以满足外生需求。目标是使用二元决策变量和大$M$约束来捕捉设置和启动成本对运营计划的影响，并计算成本最小化的启停计划。您的程序必须实现该模型，并为一组测试案例返回最优运营计划。\n\n基本原理和定义：\n- 该单元在一组由 $t \\in \\{1,\\dots,T\\}$ 索引的有限离散时间周期内运行。\n- 令 $d_t$ 表示在周期 $t$ 内需要满足的外生输出需求（例如汽油），以桶/小时（bbl/h）为单位。\n- 令 $S_t$ 表示化石原料的可用性（例如原油供应），以桶/小时（bbl/h）为单位。\n- 令 $e$ 表示原料到输出的转换因子，单位为桶输出/桶原料（bbl/bbl）。为简化起见，除非另有说明，否则假设 $e = 1$。\n- 令 $M$ 表示该单元的结构性最大产出能力，以桶/小时（bbl/h）为单位。\n- 令 $x_t$ 为周期 $t$ 的连续决策变量，表示产出量，单位为 bbl/h。\n- 令 $y_t \\in \\{0,1\\}$ 为二元启停决策变量，其中 $y_t = 1$ 表示单元在周期 $t$ 处于在线状态，$y_t = 0$ 表示其处于离线状态。\n- 令 $z_t \\in \\{0,1\\}$ 为二元启动指示变量，其中如果单元在周期 $t-1$ 和 $t$ 之间从离线转换到在线（给定 $y_0 = 0$），则 $z_t = 1$，否则 $z_t = 0$。\n- 令 $c^{var}$ 为每桶的可变生产成本，以美元/桶（$）表示。\n- 令 $c^{setup}$ 为单元在线的每个周期产生的固定设置成本，以美元（$）表示。\n- 令 $c^{start}$ 为单元每次从离线转换到在线时产生的启动成本，以美元（$）表示。\n- 令 $c^{short}$ 为每桶未满足需求的短缺惩罚成本，以美元/桶（$）表示。\n\n模型构建要求：\n- 通过大$M$方法进行容量关联：强制执行以下逻辑蕴涵，即当单元离线时产出必须为零，在线时产出有界。使用以下约束对每个 $t$ 进行建模：\n  $$x_t \\leq M \\cdot y_t,$$\n  $$x_t \\leq \\frac{S_t}{e},$$\n  $$x_t \\geq 0.$$\n  第一个不等式是联系连续产出变量 $x_t$ 和二元启停变量 $y_t$ 的大$M$约束。第二个不等式在给定 $S_t$ 和 $e$ 的情况下强制执行供应链可行性。\n- 启动定义：对于 $t=1,\\dots,T$，使用与二元变量和初始条件 $y_0 = 0$ 一致的标准线性化来定义 $z_t$：\n  $$z_t \\geq y_t - y_{t-1}, \\quad z_t \\geq 0, \\quad z_t \\leq y_t, \\quad z_t \\leq 1 - y_{t-1}.$$\n  在二元可行计划中，这确保了当且仅当 $y_{t-1} = 0$ 且 $y_t = 1$ 时，$z_t = 1$，否则 $z_t = 0$。\n- 带短缺的需求满足：未满足的需求 $\\max(0, d_t - x_t)$ 会以每桶 $c^{short}$ 的速率产生一个成本。周期之间没有库存或缺货。\n\n目标：\n- 最小化整个时间范围内的总成本，包括可变生产成本、各周期设置成本、启动成本和短缺惩罚成本：\n  $$\\min \\sum_{t=1}^T \\left(c^{var} \\cdot x_t + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t) \\right).$$\n\n算法要求：\n- 由于此处不使用混合整数线性规划 (MILP) 求解器，因此需要根据模型结构推导出一个有原则的算法，以评估任何候选二元计划 $\\{y_t\\}_{t=1}^T$ 的成本，然后对小型 $T$ 的所有二元计划进行穷举搜索。对于一个固定的计划，根据上述目标和约束，以闭式解形式计算最优的 $x_t$。\n\n输出要求：\n- 对于每个测试案例，返回成本最小化的计划 $\\{y_t\\}_{t=1}^T$ 和相应的最小总成本（美元）。成本以美元（$）表示，运营决策以整数 $0$ 或 $1$ 表示。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果。每个测试案例的结果必须是一个列表，其第一个条目是总成本（美元，浮点数），后跟运营计划条目 $y_1, \\dots, y_T$（整数）。例如，两个案例的输出格式可能为 $$[[1000.0,1,0,1],[0.0,0,0]]$$ 打印在单行上。\n\n测试套件：\n使用以下科学上合理的参数集，所有速率单位为桶/小时（bbl/h），成本单位为美元（$）。对所有案例假设 $y_0 = 0$ 且 $e = 1$。\n\n- 案例 $1$ （基准化石燃料供应受限操作）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例 $2$ （更高的启动成本，相同的供应和需求）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 2000$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例 $3$ （零启动成本，更高的单位周期设置成本）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 300$ $,\n  - $c^{start} = 0$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例 $4$ （单周期峰值需求）：\n  - $T = 1$,\n  - $d = [150]$ bbl/h,\n  - $S = [300]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 30$ $/bbl$,\n  - $c^{setup} = 200$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 300$ $/bbl$.\n\n- 案例 $5$ （所有周期需求为零）：\n  - $T = 3$,\n  - $d = [0, 0, 0]$ bbl/h,\n  - $S = [100, 100, 100]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 25$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例 $6$ （可变生产成本超过短缺惩罚）：\n  - $T = 2$,\n  - $d = [60, 60]$ bbl/h,\n  - $S = [100, 100]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 500$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 200$ $,\n  - $c^{short} = 100$ $/bbl$.\n\n您的程序必须计算每个案例的最优计划，并打印一行包含案例结果的逗号分隔列表，每个案例结果的格式应完全如上所述为 $[ \\text{total\\_cost}, y_1, \\dots, y_T ]$。",
            "solution": "根据指定的验证协议，对用户提供的问题进行了分析。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n- **时间范围**：由 $t \\in \\{1, \\dots, T\\}$ 索引的离散周期。\n- **外生需求**：$d_t$，单位为桶/小时 (bbl/h)。\n- **原料可用性**：$S_t$，单位为桶/小时 (bbl/h)。\n- **转换因子**：$e$，单位为桶输出/桶原料，所有案例中均为1。\n- **最大产能**：$M$，单位为桶/小时 (bbl/h)。\n- **决策变量**：\n    - 连续产出：$x_t \\geq 0$ (bbl/h)。\n    - 二元启停状态：$y_t \\in \\{0, 1\\}$。\n    - 二元启动指示：$z_t \\in \\{0, 1\\}$。\n- **初始条件**：$y_0 = 0$。\n- **成本参数**：\n    - 可变成本：$c^{var}$ ($/桶)。\n    - 设置成本：$c^{setup}$ ($)。\n    - 启动成本：$c^{start}$ ($)。\n    - 短缺惩罚：$c^{short}$ ($/桶)。\n- **每个周期 $t$ 的约束**：\n    1. $x_t \\leq M \\cdot y_t$\n    2. $x_t \\leq S_t / e$\n    3. $x_t \\geq 0$\n    4. $z_t \\geq y_t - y_{t-1}$\n    5. $z_t \\geq 0, z_t \\leq y_t, z_t \\leq 1 - y_{t-1}$\n- **目标函数**：最小化时间范围 $T$ 内的总成本。\n  $$ \\min \\sum_{t=1}^T \\left(c^{var} \\cdot x_t + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t) \\right) $$\n- **算法要求**：对所有二元计划 $\\{y_t\\}_{t=1}^T$ 进行穷举搜索，并对给定的固定计划使用闭式解来确定最优的 $x_t$。\n- **提供的测试案例**：指定了六个不同的参数集。\n\n**步骤2：使用提取的已知条件进行验证**\n\n该问题根据验证标准进行评估：\n- **有科学依据：** 该问题是运筹学和能源系统工程中单元承诺问题的典型代表。模型元素（成本、容量、二元决策）是标准的且在基础上是合理的。它是科学有效的。\n- **适定性：** 任务是在一个有限的 $2^T$ 个计划集合中找到最小成本。对于每个计划，确定最优产量的子问题是一个具有唯一解的凸优化问题。保证存在一个最小成本和相关的最优计划。该问题是适定的。\n- **客观性：** 问题使用精确、无歧义的数学和经济术语陈述。它不含主观或基于意见的内容。\n- **完整性和一致性：** 问题陈述是自洽的。每个测试案例的所有必要参数、约束和目标都已明确定义。没有矛盾之处。\n- **现实性：** 参数被认为是科学上合理的。该模型虽然简化，但捕捉了生产计划中的现实权衡，例如平衡启动成本、运营成本和短缺惩罚。数据在量纲上是一致的。\n- **结构性：** 问题结构良好。非线性项 $\\max(0, d_t - x_t)$ 是此类模型中的一个标准特征，代表一个凸惩罚函数。所要求的算法方法（穷举搜索）适用于测试案例中给出的较小的 $T$ 值。\n\n**步骤3：结论与行动**\n\n该问题是**有效的**。这是一个定义明确的优化建模和算法实现练习。将提供解决方案。\n\n### 求解推导\n\n该问题要求找到一个最优的运营计划 $\\{y_t\\}_{t=1}^T$ 和相应的生产水平 $\\{x_t\\}_{t=1}^T$，以最小化总成本。指定的算法是对所有可能的二元计划 $\\{y_t\\}_{t=1}^T$ 进行穷举搜索。这在计算上是可行的，因为所提供的测试案例中时间范围 $T$ 很小（最大为 $T=4$，对应于 $2^4=16$ 个计划）。\n\n算法的核心是计算任何给定二元计划 $\\{y_t\\}$ 的总成本。对于一个固定的计划，目标函数允许逐周期确定最优的生产水平 $\\{x_t\\}$。总成本是每个周期成本的总和。\n\n对于特定周期 $t$，给定一个固定的 $y_t$ 值（以及 $y_{t-1}$ 以确定是否启动），成本分量 $c^{setup}y_t$ 和 $c^{start}z_t$ 是固定的。决策变量 $x_t$ 的确定是为了最小化该周期成本的剩余可变部分：\n$$ J_t(x_t) = c^{var} \\cdot x_t + c^{short} \\cdot \\max(0, d_t - x_t) $$\n该最小化受制于对 $x_t$ 的约束：$x_t \\leq M \\cdot y_t$、 $x_t \\leq S_t/e$ 和 $x_t \\geq 0$。\n\n我们分析最优产量 $x_t^{opt}$ 的确定和由此产生的周期成本 $C_t$：\n\n**1. 单元离线 ($y_t = 0$)**\n约束 $x_t \\leq M \\cdot y_t$ 变为 $x_t \\leq 0$。结合 $x_t \\geq 0$，这迫使产量为 $x_t^{opt} = 0$。启动变量 $z_t$ 也必须为 $0$，因为 $z_t \\leq y_t$。周期 $t$ 的成本完全来自未满足的需求：\n$$ C_t = c^{var} \\cdot 0 + c^{setup} \\cdot 0 + c^{start} \\cdot 0 + c^{short} \\cdot \\max(0, d_t - 0) = c^{short} \\cdot d_t $$\n\n**2. 单元在线 ($y_t = 1$)**\n对 $x_t$ 的约束变为 $0 \\leq x_t \\leq M$ 和 $x_t \\leq S_t/e$。因此，$x_t$ 必须在 $[0, X_{max,t}]$ 范围内，其中有效容量为 $X_{max,t} = \\min(M, S_t/e)$。我们必须在此范围内找到使 $J_t(x_t)$ 最小化的 $x_t$。\n\n函数 $J_t(x_t)$ 是凸的且分段线性。其关于 $x_t$ 的导数为：\n$$ \\frac{dJ_t}{dx_t} = \\begin{cases} c^{var} - c^{short}  \\text{如果 } x_t  d_t \\\\ c^{var}  \\text{如果 } x_t > d_t \\end{cases} $$\n$x_t$ 的最优选择取决于斜率 $c^{var} - c^{short}$ 的符号。\n\n- **子情况 2a: $c^{var}  c^{short}$**\n当 $x_t  d_t$ 时斜率为负，当 $x_t > d_t$ 时斜率为正。函数 $J_t(x_t)$ 在 $x_t = d_t$ 处最小化。为了满足容量约束，我们应尽可能地接近需求进行生产。最优产量为：\n$$ x_t^{opt} = \\min(d_t, X_{max,t}) = \\min(d_t, M, S_t/e) $$\n这是标准的经济学逻辑：如果生产成本低于不生产的惩罚，那么就在物理限制内生产以满足需求。\n\n- **子情况 2b: $c^{var} \\geq c^{short}$**\n斜率处处为非负（$c^{var} - c^{short} \\ge 0$ 且 $c^{var} > 0$）。$J_t(x_t)$ 是一个关于 $x_t$ 的非递减函数。为了最小化它，我们必须选择 $x_t$ 的最小可能值，即 $x_t^{opt} = 0$。这意味着即使单元开启，生产任何东西并支付可变生产成本，也比不生产并支付全部短缺惩罚的成本更高。比较在线 ($y_t=1$) 与离线 ($y_t=0$) 的总成本，会发现在线会增加一个严格为正的设置成本 ($c^{setup} > 0$) 却没有带来任何收益。因此，在这种情况下，最优决策将总是保持单元关闭，除非所有成本和需求都为零。通用算法会正确地找到这一点，因此不需要特殊处理。\n\n当 $y_t=1$ 时，周期 $t$ 的成本根据确定的 $x_t^{opt}$ 计算。如果单元之前是关闭的 ($y_{t-1}=0$) 而现在是开启的 ($y_t=1$)，则启动变量 $z_t$ 为 $1$，否则为 $0$。给定初始条件 $y_0 = 0$，对于 $t \\geq 1$，这可以写成 $z_t = y_t \\cdot (1 - y_{t-1})$。周期成本为：\n$$ C_t = c^{var} \\cdot x_t^{opt} + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t^{opt}) $$\n\n**算法总结**\n对于每个测试案例：\n1. 初始化 `min_total_cost` 为无穷大，`best_schedule` 为 `None`。\n2. 遍历从 $0$ 到 $2^T - 1$ 的每个整数 $i$。每个整数的二进制表示对应一个唯一的候选计划 $\\{y_1, \\dots, y_T\\}$。\n3. 对于每个计划，通过将从 $t=1$ 到 $T$ 的周期成本 $C_t$ 相加来计算总成本。\n    a. 对于每个周期 $t$，从计划中确定 $y_t$。\n    b. 基于 $y_t$（和 $y_{t-1}$），如上所述计算 $x_t^{opt}$ 和 $z_t$。\n    c. 计算周期成本 $C_t$。\n4. 如果当前计划的计算总成本小于 `min_total_cost`，则更新 `min_total_cost` 和 `best_schedule`。\n5. 遍历完所有 $2^T$ 个计划后，即可找到最优计划及其成本。存储此结果。\n6. 处理完所有测试案例后，将收集到的结果格式化为指定的单个字符串并打印。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Computes the cost-minimizing on/off schedule for a fossil fuel unit\n    by performing an exhaustive search over all possible binary schedules.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Format: (T, d, S, M, c_var, c_setup, c_start, c_short)\n    # e is assumed to be 1.0 for all cases.\n    test_cases = [\n        # Case 1\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 100, 500, 200),\n        # Case 2\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 100, 2000, 200),\n        # Case 3\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 300, 0, 200),\n        # Case 4\n        (1, [150], [300], 100, 30, 200, 500, 300),\n        # Case 5\n        (3, [0, 0, 0], [100, 100, 100], 100, 25, 100, 500, 200),\n        # Case 6\n        (2, [60, 60], [100, 100], 100, 500, 100, 200, 100),\n    ]\n\n    all_results = []\n    e = 1.0 # Conversion factor\n\n    for case in test_cases:\n        T, d, S, M, c_var, c_setup, c_start, c_short = case\n        \n        min_total_cost = np.inf\n        best_schedule = []\n\n        num_schedules = 2**T\n        for i in range(num_schedules):\n            # Generate a candidate schedule {y_1, ..., y_T}\n            # (i  t)  1 gives bits from right-to-left, which works for t=0..T-1\n            # corresponding to periods 1..T\n            y_schedule = [(i  t)  1 for t in range(T)]\n            \n            current_total_cost = 0.0\n            y_prev = 0  # y_0 is given as 0\n\n            for t_idx in range(T):\n                y_t = y_schedule[t_idx]\n                d_t = d[t_idx]\n                S_t = S[t_idx]\n                \n                period_cost = 0.0\n                \n                if y_t == 0:\n                    # Unit is offline. Production is 0. Cost is only from unmet demand.\n                    # z_t is 0 since z_t = y_t. No setup or startup cost.\n                    period_cost = c_short * d_t\n                else: # y_t == 1\n                    # Unit is online.\n                    \n                    # Determine start-up: z_t = 1 if y_t=1 and y_{t-1}=0\n                    z_t = 1 if y_prev == 0 else 0\n                    \n                    # Determine optimal production x_t\n                    X_max_t = min(M, S_t / e)\n                    \n                    x_t = 0.0\n                    if c_var  c_short:\n                        # Produce to meet demand up to capacity if cheaper than shortage\n                        x_t = min(d_t, X_max_t)\n                    else:\n                        # Cheaper to not produce and incur shortage penalty\n                        x_t = 0.0\n\n                    shortage = max(0, d_t - x_t)\n                    \n                    period_cost = (c_var * x_t) + c_setup + (c_start * z_t) + (c_short * shortage)\n\n                current_total_cost += period_cost\n                y_prev = y_t\n\n            if current_total_cost  min_total_cost:\n                min_total_cost = current_total_cost\n                best_schedule = y_schedule\n\n        # Format the result for the current case\n        case_result = [float(min_total_cost)] + best_schedule\n        all_results.append(case_result)\n\n    # Print all results in the specified single-line format\n    # The format [[cost,y1,...],[cost,y1,...]] is Python's list-to-string without spaces.\n    print(str(all_results).replace(' ', ''))\n\nsolve()\n```"
        }
    ]
}