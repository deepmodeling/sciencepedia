{
    "hands_on_practices": [
        {
            "introduction": "在化石燃料供应链中，混合不同来源的原料以满足最终产品的质量规格是一项核心任务。例如，在炼油厂中，必须将不同含硫量的原油混合，以确保最终混合油的硫含量不超过规定的限值。本练习将指导您从质量守恒的基本原则出发，推导出一个线性不等式约束，该约束在优化模型中用于控制混合产品的质量。",
            "id": "4091811",
            "problem": "一个管道调合终端接收 $n$ 股输入的化石燃料流（例如，原油），索引为 $i \\in \\{1, \\dots, n\\}$。每股物料流 $i$ 的特征在于其质量 $m_i \\ge 0$（在一个指定的规划周期内）以及一种按质量线性混合的污染物（例如，硫）的属性质量分数 $q_i \\in [0,1]$。输出的混合流中污染物的质量分数必须满足一个最大属性规格 $Q^{\\mathrm{spec}} \\in [0,1]$。\n\n仅从质量守恒原理以及可加属性按质量线性混合这一事实出发，推导出一个关于决策变量 $m_i$ 的线性不等式，该不等式强制要求混合后的输出流中污染物的质量分数不超过 $Q^{\\mathrm{spec}}$。然后，定义该不等式的左侧函数 $L(m_1,\\dots,m_n)$，使得该约束可以写成规范线性形式 $L(m_1,\\dots,m_n) \\le 0$，以便在线性规划或混合整数线性规划中使用。你的最终答案必须是 $L(m_1,\\dots,m_n)$ 的闭式解析表达式。不需要进行数值计算，且最终答案中不应出现任何不等号或等号。假设 $q_i$ 和 $Q^{\\mathrm{spec}}$ 是先验已知的固定参数，并且所有 $m_i$ 都是非负决策变量。将 $q_i$ 和 $Q^{\\mathrm{spec}}$ 视为无量纲质量分数。",
            "solution": "首先将根据指定标准对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- 输入流的数量：$n$。\n- 流索引：$i \\in \\{1, \\dots, n\\}$。\n- 流 $i$ 的质量（决策变量）：$m_i \\ge 0$。\n- 流 $i$ 的污染物质量分数（参数）：$q_i \\in [0,1]$。\n- 输出混合物的最大污染物质量分数（参数）：$Q^{\\mathrm{spec}} \\in [0,1]$。\n- 污染物按质量线性混合。\n- 推导必须从质量守恒和线性混合的原理开始。\n- 最终约束必须是 $L(m_1,\\dots,m_n) \\le 0$ 形式的线性不等式。\n- 最终答案是函数 $L(m_1,\\dots,m_n)$ 的解析表达式。\n\n### 步骤2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n\n- **科学依据充分：** 该问题基于质量守恒基本原理和质量分数的定义，这些是化学、物理学和工程学中的基石概念。对于硫含量等属性按质量线性混合的假设是炼油和化工行业中使用的标准有效模型。\n- **问题适定：** 该问题是适定的。它要求基于明确陈述的物理原理和变量，推导出一个特定的数学表达式（一个线性约束）。目标明确，并且提供了足够的信息来得出一个唯一的解析函数 $L$。\n- **客观性：** 问题以精确、客观和定量的术语陈述。诸如“质量分数”和“线性不等式”之类的术语是标准的，没有歧义或主观解释。\n\n该问题不存在任何使其无效的缺陷。它不是科学上不合理、不可形式化、不完整、不切实际、不适定、琐碎或无法验证的。\n\n### 步骤3：结论与行动\n此问题是**有效的**。将按要求推导解决方案。\n\n推导过程从所述的两个基本原理开始：质量守恒和污染物属性的线性混合。\n\n1.  **总质量守恒：** 输出的混合流的总质量，记为 $M_{\\text{total}}$，是 $n$ 个输入流的质量之和。\n    $$M_{\\text{total}} = \\sum_{i=1}^{n} m_i$$\n    由于每个 $m_i \\ge 0$，因此 $M_{\\text{total}} \\ge 0$。我们将考虑非平凡情况，即至少有一个 $m_i > 0$，因此 $M_{\\text{total}} > 0$。\n\n2.  **污染物质量守恒：** 每个输入流 $i$ 中污染物的质量是该流的总质量 $m_i$ 与其污染物质量分数 $q_i$ 的乘积。这个量是 $q_i m_i$。由于污染物属性是可加的，并且按质量线性混合，最终混合物中污染物的总质量 $M_{\\text{cont}}$ 是每个输入流中污染物质量的总和。\n    $$M_{\\text{cont}} = \\sum_{i=1}^{n} q_i m_i$$\n\n3.  **混合流的属性：** 最终混合流中污染物的质量分数，我们记为 $Q_{\\text{blend}}$，定义为污染物总质量与混合物总质量之比。\n    $$Q_{\\text{blend}} = \\frac{M_{\\text{cont}}}{M_{\\text{total}}} = \\frac{\\sum_{i=1}^{n} q_i m_i}{\\sum_{i=1}^{n} m_i}$$\n\n4.  **建立不等式：** 问题要求混合物中污染物的质量分数不超过规格值 $Q^{\\mathrm{spec}}$。这表示为不等式：\n    $$Q_{\\text{blend}} \\le Q^{\\mathrm{spec}}$$\n    代入 $Q_{\\text{blend}}$ 的表达式，得到：\n    $$\\frac{\\sum_{i=1}^{n} q_i m_i}{\\sum_{i=1}^{n} m_i} \\le Q^{\\mathrm{spec}}$$\n\n5.  **转换为规范线性形式：** 为了将其表示为关于决策变量 $m_i$ 的线性不等式，我们必须消除分母。分母 $\\sum_{i=1}^{n} m_i$ 代表总质量，是非负的。对于任何非平凡的混合，这个和是严格正的。不等式两边同乘以这个正量不会改变不等号的方向。\n    $$\\sum_{i=1}^{n} q_i m_i \\le Q^{\\mathrm{spec}} \\left( \\sum_{j=1}^{n} m_j \\right)$$\n    （在右边的求和中使用不同的索引 $j$ 在符号上更清晰，但并非绝对必要；我们可以换回 $i$。）\n    $$\\sum_{i=1}^{n} q_i m_i \\le Q^{\\mathrm{spec}} \\sum_{i=1}^{n} m_i$$\n    为了得到规范形式 $L(m_1,\\dots,m_n) \\le 0$，我们将所有项移到不等式的左侧。\n    $$\\sum_{i=1}^{n} q_i m_i - Q^{\\mathrm{spec}} \\sum_{i=1}^{n} m_i \\le 0$$\n    这两个求和可以合并成一个单独的求和，因为它们都在从 $i=1$ 到 $n$ 的相同索引集上进行迭代。\n    $$\\sum_{i=1}^{n} (q_i m_i - Q^{\\mathrm{spec}} m_i) \\le 0$$\n    从求和内部的每一项中提取出决策变量 $m_i$，得到不等式的最终线性形式：\n    $$\\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i \\le 0$$\n    这个不等式对于变量 $m_i$ 是线性的，因为项 $(q_i - Q^{\\mathrm{spec}})$ 是常数系数。\n\n6.  **确定函数 $L$：** 问题要求左侧函数 $L(m_1,\\dots,m_n)$，使得约束为 $L(m_1,\\dots,m_n) \\le 0$。通过观察推导出的不等式，这个函数是：\n    $$L(m_1,\\dots,m_n) = \\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i$$\n    这就是所要求的闭式解析表达式。",
            "answer": "$$\\boxed{\\sum_{i=1}^{n} (q_i - Q^{\\mathrm{spec}}) m_i}$$"
        },
        {
            "introduction": "任何供应链模型的准确性都取决于其对物理基础设施（如管道、储罐和加工单元）实际限制的真实反映。本练习将理论与实践相结合，要求您应用流体力学原理来计算原油管道的最大输送能力。通过这个计算，您将理解一个看似简单的模型参数（如管道容量）是如何由复杂的工程和物理现实决定的。",
            "id": "4091834",
            "problem": "一条原油干线管道是区域性化石燃料供应链中的一个能力限制环节。该管道在稳态下将单相原油从一个沿海终端输送到一个内陆枢纽，其高程变化和局部损失均可忽略不计。管道长度为 $L = 60{,}000\\,\\text{m}$，内径为 $D = 0.60\\,\\text{m}$，商用钢管的内部绝对粗糙度为 $\\epsilon = 2.0 \\times 10^{-4}\\,\\text{m}$。原油密度为 $\\rho = 870\\,\\text{kg}\\,\\text{m}^{-3}$，在操作温度下的动力粘度为 $\\mu = 1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}$。受泵站和最大允许操作压力所限，该管段上的可用压降为 $\\Delta p = 8.0 \\times 10^{5}\\,\\text{Pa}$。\n\n从稳态不可压缩流体机械能平衡方程以及一个对粗糙管道中湍流摩擦损失的物理上合适的表达形式出发，推导将体积流量 $Q$ 与可用压降 $\\Delta p$、管道和流体性质 $(L, D, \\epsilon, \\rho, \\mu)$ 以及摩擦系数联系起来的控制关系式。然后，计算在该水力限制条件下，此管段所能维持的最大体积流量 $Q$。\n\n假设流动保持单相，在此条件下原油可视为不可压缩，并且与沿程摩擦损失相比，局部损失可以忽略不计。将最大体积流量的最终答案四舍五入至三位有效数字，并以立方米/秒为单位表示。",
            "solution": "首先对问题进行验证。\n\n**步骤1：提取已知条件**\n- 管道长度：$L = 60{,}000\\,\\text{m}$\n- 内径：$D = 0.60\\,\\text{m}$\n- 内部绝对粗糙度：$\\epsilon = 2.0 \\times 10^{-4}\\,\\text{m}$\n- 原油密度：$\\rho = 870\\,\\text{kg}\\,\\text{m}^{-3}$\n- 动力粘度：$\\mu = 1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}$\n- 可用压降：$\\Delta p = 8.0 \\times 10^{5}\\,\\text{Pa}$\n- 假设：稳态、单相、不可压缩流、高程变化可忽略、局部损失可忽略。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，是流体力学原理（Darcy-Weisbach 和 Colebrook-White 方程）在能源系统实际工程场景中的一个标准应用。所提供的流体（原油）和管道（商用钢）的数据在物理上是切合实际的。该问题是适定的；它提供了确定流量的唯一稳定解所需的所有信息和约束。所用语言客观、精确。该问题是自洽的、一致的，并且没有任何科学或逻辑上的缺陷。\n\n**步骤3：结论与行动**\n问题有效。将提供完整解答。\n\n**求解推导**\n分析始于在两点（标记为1（入口）和2（出口））之间流动的不可压缩流体的稳态机械能平衡。该方程以水头形式表示为：\n$$ \\frac{p_1}{\\rho g} + \\frac{v_1^2}{2g} + z_1 = \\frac{p_2}{\\rho g} + \\frac{v_2^2}{2g} + z_2 + h_L $$\n此处，$p$ 是压力，$v$ 是平均流体速度，$z$ 是高程，$\\rho$ 是流体密度，$g$ 是重力加速度，$h_L$ 是总水头损失。\n\n我们应用问题中给出的条件：\n1.  管道具有恒定的内径 $D$，因此横截面积 $A$ 是恒定的。根据连续性方程 ($Q = A_1 v_1 = A_2 v_2$)，平均速度相等：$v_1 = v_2$。因此动能项相互抵消。\n2.  高程变化可忽略不计，因此 $z_1 = z_2$。\n3.  局部损失可忽略不计，因此总水头损失 $h_L$ 等于主要摩擦水头损失 $h_f$。\n\n能量平衡方程简化为：\n$$ \\frac{p_1 - p_2}{\\rho g} = h_f $$\n压降给定为 $\\Delta p = p_1 - p_2 = 8.0 \\times 10^{5}\\,\\text{Pa}$。因此：\n$$ \\frac{\\Delta p}{\\rho g} = h_f $$\n摩擦水头损失由 Darcy-Weisbach 方程描述：\n$$ h_f = f \\frac{L}{D} \\frac{v^2}{2g} $$\n其中 $f$ 是 Darcy 摩擦系数。\n\n将 Darcy-Weisbach 表达式代入简化的能量平衡方程得到：\n$$ \\frac{\\Delta p}{\\rho g} = f \\frac{L}{D} \\frac{v^2}{2g} $$\n乘以 $\\rho g$ 得到压降和速度之间的控制关系：\n$$ \\Delta p = f \\frac{L}{D} \\frac{\\rho v^2}{2} $$\n为了用体积流量 $Q$ 表示此关系式，我们使用关系 $v = Q/A$，其中面积为 $A = \\frac{\\pi D^2}{4}$。代入 $v$：\n$$ \\Delta p = f \\frac{L}{D} \\frac{\\rho}{2} \\left( \\frac{Q}{\\frac{\\pi D^2}{4}} \\right)^2 = f \\frac{L}{D} \\frac{8 \\rho}{\\pi^2 D^4} Q^2 $$\n这就是将 $Q$ 与 $\\Delta p$ 及其他参数联系起来的控制关系式。\n\n为了计算 $Q$，我们必须确定摩擦系数 $f$。对于大管道中预期的湍流，$f$ 是雷诺数 $Re$ 和相对粗糙度 $\\epsilon/D$ 的函数。Colebrook-White 方程提供了这种关系：\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} \\left( \\frac{\\epsilon/D}{3.7} + \\frac{2.51}{Re \\sqrt{f}} \\right) $$\n雷诺数的定义为：\n$$ Re = \\frac{\\rho v D}{\\mu} = \\frac{4 \\rho Q}{\\pi D \\mu} $$\n这是一个隐式系统，因为 $Q$ 依赖于 $f$，而 $f$ 又依赖于 $Re$，$Re$ 又依赖于 $Q$。为了解这个系统，我们可以重新整理方程。从以压力表示的 Darcy-Weisbach 方程：\n$$ v = \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} $$\n将此代入雷诺数的定义中：\n$$ Re = \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} $$\n一个有用的项组合是 $Re\\sqrt{f}$：\n$$ Re\\sqrt{f} = \\left( \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} \\right) \\sqrt{f} = \\frac{\\rho D}{\\mu} \\sqrt{\\frac{2D\\Delta p}{\\rho L}} $$\n这个量与未知数 $f$ 和 $v$（或 $Q$）无关，可以直接从给定数据计算出来。\n\n首先，我们计算常数参数：\n相对粗糙度：$\\frac{\\epsilon}{D} = \\frac{2.0 \\times 10^{-4}\\,\\text{m}}{0.60\\,\\text{m}} = \\frac{1}{3000} \\approx 3.333 \\times 10^{-4}$。\n\n接下来，我们计算 $Re\\sqrt{f}$ 的值：\n$$ Re\\sqrt{f} = \\frac{(870\\,\\text{kg}\\,\\text{m}^{-3})(0.60\\,\\text{m})}{1.5 \\times 10^{-2}\\,\\text{Pa}\\cdot\\text{s}} \\sqrt{\\frac{2(0.60\\,\\text{m})(8.0 \\times 10^{5}\\,\\text{Pa})}{(870\\,\\text{kg}\\,\\text{m}^{-3})(60{,}000\\,\\text{m})}} $$\n$$ Re\\sqrt{f} = (34800) \\sqrt{\\frac{9.6 \\times 10^5}{5.22 \\times 10^7}} = (34800) \\sqrt{0.0183908...} = (34800)(0.135612...) \\approx 4719.3 $$\n现在，我们将这个值代入 Colebrook-White 方程以求出 $f$：\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} \\left( \\frac{3.333 \\times 10^{-4}}{3.7} + \\frac{2.51}{4719.3} \\right) $$\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} (9.009 \\times 10^{-5} + 5.3188 \\times 10^{-4}) $$\n$$ \\frac{1}{\\sqrt{f}} = -2.0 \\log_{10} (6.2197 \\times 10^{-4}) \\approx -2.0 (-3.2062) \\approx 6.4124 $$\n由此，我们可以解出 $f$：\n$$ f = \\left( \\frac{1}{6.4124} \\right)^2 \\approx 0.02432 $$\n确定了摩擦系数后，我们现在可以计算平均速度 $v$：\n$$ v = \\sqrt{\\frac{2D\\Delta p}{f \\rho L}} = \\sqrt{\\frac{2(0.60\\,\\text{m})(8.0 \\times 10^{5}\\,\\text{Pa})}{(0.02432)(870\\,\\text{kg}\\,\\text{m}^{-3})(60{,}000\\,\\text{m})}} $$\n$$ v = \\sqrt{\\frac{9.6 \\times 10^5}{1.270 \\times 10^6}} \\approx \\sqrt{0.7557} \\approx 0.8693\\,\\text{m}\\,\\text{s}^{-1} $$\n作为检验，我们计算雷诺数以确认湍流假设：\n$$ Re = \\frac{\\rho v D}{\\mu} = \\frac{(870)(0.8693)(0.60)}{1.5 \\times 10^{-2}} \\approx 30250 $$\n由于 $Re > 4000$，流动是湍流，我们使用 Colebrook-White 方程是合适的。\n\n最后，我们计算最大体积流量 $Q$：\n$$ Q = A v = \\left( \\frac{\\pi D^2}{4} \\right) v = \\left( \\frac{\\pi (0.60\\,\\text{m})^2}{4} \\right) (0.8693\\,\\text{m}\\,\\text{s}^{-1}) $$\n$$ Q = (0.28274\\,\\text{m}^2)(0.8693\\,\\text{m}\\,\\text{s}^{-1}) \\approx 0.2458\\,\\text{m}^3\\,\\text{s}^{-1} $$\n按要求四舍五入到三位有效数字，我们得到 $Q = 0.246\\,\\text{m}^3\\,\\text{s}^{-1}$。",
            "answer": "$$\n\\boxed{0.246}\n$$"
        },
        {
            "introduction": "能源系统的优化不仅仅是决定生产多少，还包括决定何时开启或关闭设备，尤其是在存在显著的启动成本和固定成本时。这个问题，即所谓的“机组组合”问题，是运营规划的核心。本练习将引导您构建并分析一个简化的混合整数优化模型，通过该模型探索经济权衡如何驱动成本最优的运营计划。",
            "id": "4091824",
            "problem": "您的任务是构建并分析一个简化的混合整数优化模型，该模型描述了一个化石燃料供应链单元，该单元将化石输入流转换为输出流，以满足离散时间范围内的外生需求。目标是使用二元决策变量和“大M”约束来捕捉设置成本和启动成本对运行计划的影响，并计算成本最小化的开关机计划。您的程序必须实现该模型，并返回一组测试用例的最优运行计划。\n\n基本原理和定义：\n- 该单元在一系列离散时间段内运行，时间段由 $t \\in \\{1,\\dots,T\\}$ 索引。\n- 令 $d_t$ 表示外生输出需求（例如汽油），单位为桶/小时，需要在时间段 $t$ 内满足，以桶/小时（bbl/h）表示。\n- 令 $S_t$ 表示化石原料可用性（例如原油供应），单位为桶/小时，以桶/小时（bbl/h）表示。\n- 令 $e$ 表示原料到产出的转换因子，单位为桶产出/桶原料，以桶/桶（bbl/bbl）表示。为简单起见，除非另有说明，否则假设 $e = 1$。\n- 令 $M$ 表示该单元的结构性最大输出能力，单位为桶/小时，以桶/小时（bbl/h）表示。\n- 令 $x_t$ 为时间段 $t$ 内的连续决策变量，代表产出，单位为桶/小时（bbl/h）。\n- 令 $y_t \\in \\{0,1\\}$ 为二元开关机决策变量，其中 $y_t = 1$ 表示单元在时间段 $t$ 处于在线状态， $y_t = 0$ 表示其处于离线状态。\n- 令 $z_t \\in \\{0,1\\}$ 为二元启动指示变量，其中当单元在时间段 $t-1$ 和 $t$ 之间从离线转换到在线状态时（给定 $y_0=0$）， $z_t=1$ ，否则 $z_t=0$ 。\n- 令 $c^{var}$ 为每桶可变生产成本，单位为美元/桶（$）。\n- 令 $c^{setup}$ 为单元在线的每个时间段内产生的固定设置成本，单位为美元（$）。\n- 令 $c^{start}$ 为单元每次从离线转换到在线时产生的启动成本，单位为美元（$）。\n- 令 $c^{short}$ 为每桶未满足需求的短缺惩罚成本，单位为美元/桶（$）。\n\n模型构建要求：\n- 通过“大M”法进行容量关联：使用以下对每个 $t$ 的约束来强制执行逻辑蕴涵关系，即当单元离线时产出必须为零，在线时产出受限：\n  $$x_t \\leq M \\cdot y_t,$$\n  $$x_t \\leq \\frac{S_t}{e},$$\n  $$x_t \\geq 0.$$\n  第一个不等式是“大M”约束，它将连续产出变量 $x_t$ 与二元开关机变量 $y_t$ 联系起来。第二个不等式在给定 $S_t$ 和 $e$ 的情况下强制执行供应链可行性。\n- 启动定义：对于 $t=1,\\dots,T$，使用与二元变量和初始条件 $y_0 = 0$ 一致的标准线性化方法来定义 $z_t$：\n  $$z_t \\geq y_t - y_{t-1}, \\quad z_t \\geq 0, \\quad z_t \\leq y_t, \\quad z_t \\leq 1 - y_{t-1}.$$\n  在二元可行计划中，这确保了当且仅当 $y_{t-1} = 0$ 且 $y_t = 1$ 时 $z_t = 1$，否则 $z_t = 0$。\n- 带有短缺的需求满足：未满足的需求 $\\max(0, d_t - x_t)$ 会以每桶 $c^{short}$ 的费率产生一个成本。各时间段之间没有库存或延期交货。\n\n目标：\n- 最小化整个时间范围内的总成本，包括可变生产成本、各时间段的设置成本、启动成本和短缺惩罚成本：\n  $$\\min \\sum_{t=1}^T \\left(c^{var} \\cdot x_t + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t) \\right).$$\n\n算法要求：\n- 由于此处不使用混合整数线性规划（MILP）求解器，请基于模型结构推导一个有原则的算法，以评估任何候选二元计划 $\\{y_t\\}_{t=1}^T$ 的成本，然后对小的 $T$ 值在所有二元计划上执行穷举搜索。对于一个固定的计划，根据上述目标和约束，以封闭形式计算最优的 $x_t$。\n\n输出要求：\n- 对于每个测试用例，返回成本最小化的计划 $\\{y_t\\}_{t=1}^T$ 和相应的最小总成本（以美元为单位）。成本以美元（$）表示，运行决策以整数0或1表示。\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是一个列表，其第一个条目是总成本（以美元为单位，作为浮点数），后跟运行计划条目 $y_1, \\dots, y_T$（作为整数）。例如，两个用例的输出格式可能是在单行上打印的 $$[[1000.0,1,0,1],[0.0,0,0]]$$。\n\n测试套件：\n使用以下科学上合理的参数集，所有速率单位为桶/小时（bbl/h），成本单位为美元（$）。假设所有情况下 $y_0 = 0$ 且 $e = 1$。\n\n- 案例1（基准化石燃料供应受限运行）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例2（更高的启动成本，相同的供应和需求）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 2000$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例3（零启动成本，更高的单位时间段设置成本）：\n  - $T = 4$,\n  - $d = [50, 120, 80, 0]$ bbl/h,\n  - $S = [120, 80, 160, 0]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 20$ $/bbl$,\n  - $c^{setup} = 300$ $,\n  - $c^{start} = 0$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例4（单时间段高峰需求）：\n  - $T = 1$,\n  - $d = [150]$ bbl/h,\n  - $S = [300]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 30$ $/bbl$,\n  - $c^{setup} = 200$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 300$ $/bbl$.\n\n- 案例5（所有时间段需求为零）：\n  - $T = 3$,\n  - $d = [0, 0, 0]$ bbl/h,\n  - $S = [100, 100, 100]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 25$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 500$ $,\n  - $c^{short} = 200$ $/bbl$.\n\n- 案例6（可变生产成本超过短缺惩罚）：\n  - $T = 2$,\n  - $d = [60, 60]$ bbl/h,\n  - $S = [100, 100]$ bbl/h,\n  - $M = 100$ bbl/h,\n  - $c^{var} = 500$ $/bbl$,\n  - $c^{setup} = 100$ $,\n  - $c^{start} = 200$ $,\n  - $c^{short} = 100$ $/bbl$.\n\n您的程序必须为每个案例计算最优计划，并打印一行包含案例结果的逗号分隔列表，每个案例结果的格式需严格按照上述描述的列表 $[ \\text{total\\_cost}, y_1, \\dots, y_T ]$。",
            "solution": "已根据指定的验证协议对用户提供的问题进行了分析。\n\n### 问题验证\n\n**步骤1：提取已知信息**\n\n- **时间范围**：由 $t \\in \\{1, \\dots, T\\}$ 索引的离散时间段。\n- **外生需求**：$d_t$，单位为桶/小时 (bbl/h)。\n- **原料可用性**：$S_t$，单位为桶/小时 (bbl/h)。\n- **转换因子**：$e$，单位为 bbl/bbl，所有案例中 $e=1$。\n- **最大能力**：$M$，单位为桶/小时 (bbl/h)。\n- **决策变量**：\n    - 连续产出：$x_t \\geq 0$ (bbl/h)。\n    - 二元开关机状态：$y_t \\in \\{0, 1\\}$。\n    - 二元启动指示变量：$z_t \\in \\{0, 1\\}$。\n- **初始条件**：$y_0 = 0$。\n- **成本参数**：\n    - 可变成本：$c^{var}$ ($/bbl)。\n    - 设置成本：$c^{setup}$ ($)。\n    - 启动成本：$c^{start}$ ($)。\n    - 短缺惩罚：$c^{short}$ ($/bbl)。\n- **每个时间段 $t$ 的约束**：\n    1. $x_t \\leq M \\cdot y_t$\n    2. $x_t \\leq S_t / e$\n    3. $x_t \\geq 0$\n    4. $z_t \\geq y_t - y_{t-1}$\n    5. $z_t \\geq 0, z_t \\leq y_t, z_t \\leq 1 - y_{t-1}$\n- **目标函数**：最小化时间范围 $T$ 内的总成本。\n  $$ \\min \\sum_{t=1}^T \\left(c^{var} \\cdot x_t + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t) \\right) $$\n- **算法要求**：对所有二元计划 $\\{y_t\\}_{t=1}^T$ 进行穷举搜索，利用给定固定计划下最优 $x_t$ 的封闭解。\n- **提供的测试用例**：指定了六个不同的参数集。\n\n**步骤2：使用提取的已知信息进行验证**\n\n根据验证标准对问题进行评估：\n\n- **科学依据**：该问题是运筹学和能源系统工程中机组组合问题的典型代表。模型元素（成本、容量、二元决策）是标准的且在基础上是合理的。它是科学有效的。\n- **适定性**：任务是在一个包含 $2^T$ 个计划的有限集合中找到最低成本。对于每个计划，确定最优产量的子问题是一个具有唯一解的凸优化问题。保证存在一个最低成本和相关的最优计划。该问题是适定的。\n- **客观性**：该问题使用精确、无歧义的数学和经济学术语进行陈述。它不含主观或基于意见的内容。\n- **完整性与一致性**：问题陈述是自洽的。每个测试用例的所有必要参数、约束和目标都已明确定义。没有矛盾之处。\n- **现实性**：参数被陈述为科学上是合理的。该模型虽然简化，但捕捉了生产计划中的现实权衡，例如在启动成本、运营成本和短缺惩罚之间取得平衡。数据在量纲上是一致的。\n- **结构性**：该问题结构良好。非线性项 $\\max(0, d_t - x_t)$ 是此类模型中的一个标准特征，代表一个凸惩罚函数。所要求的算法方法（穷举搜索）适用于测试用例中给出的较小的 $T$ 值。\n\n**步骤3：结论与行动**\n\n该问题是 **有效的**。这是一个关于优化建模和算法实现的明确定义的练习。将提供一个解决方案。\n\n### 解决方案推导\n\n该问题要求找到一个最优运行计划 $\\{y_t\\}_{t=1}^T$ 及相应的生产水平 $\\{x_t\\}_{t=1}^T$ 以最小化总成本。指定的算法是对所有可能的二元计划 $\\{y_t\\}_{t=1}^T$ 进行穷举搜索。这在计算上是可行的，因为在提供的测试用例中，时间范围 $T$ 很小（最大 $T=4$，对应 $2^4=16$ 个计划）。\n\n算法的核心是计算任何给定二元计划 $\\{y_t\\}$ 的总成本。对于一个固定的计划，目标函数允许逐个时间段确定最优生产水平 $\\{x_t\\}$。总成本是每个时间段成本的总和。\n\n对于一个特定的时间段 $t$，给定一个固定的 $y_t$ 值（以及用于确定启动的 $y_{t-1}$），成本分量 $c^{setup}y_t$ 和 $c^{start}z_t$ 是固定的。关于 $x_t$ 的决策是为了最小化该时间段成本的剩余可变部分：\n$$ J_t(x_t) = c^{var} \\cdot x_t + c^{short} \\cdot \\max(0, d_t - x_t) $$\n这个最小化问题受制于对 $x_t$ 的约束：$x_t \\leq M \\cdot y_t$, $x_t \\leq S_t/e$ 和 $x_t \\geq 0$。\n\n我们分析最优产量 $x_t^{opt}$ 的确定以及由此产生的期间成本 $C_t$：\n\n**1. 单元离线 ($y_t = 0$)**\n约束 $x_t \\leq M \\cdot y_t$ 变为 $x_t \\leq 0$。结合 $x_t \\geq 0$，这迫使产量为 $x_t^{opt} = 0$。启动变量 $z_t$ 也必须为 $0$，因为 $z_t \\leq y_t$。时间段 $t$ 的成本完全来自未满足的需求：\n$$ C_t = c^{var} \\cdot 0 + c^{setup} \\cdot 0 + c^{start} \\cdot 0 + c^{short} \\cdot \\max(0, d_t - 0) = c^{short} \\cdot d_t $$\n\n**2. 单元在线 ($y_t = 1$)**\n对 $x_t$ 的约束变为 $0 \\leq x_t \\leq M$ 和 $x_t \\leq S_t/e$。因此，$x_t$ 必须在范围 $[0, X_{max,t}]$ 内，其中有效容量为 $X_{max,t} = \\min(M, S_t/e)$。我们必须在此范围内找到使 $J_t(x_t)$ 最小化的 $x_t$。\n\n函数 $J_t(x_t)$ 是凸的且是分段线性的。它关于 $x_t$ 的导数是：\n$$ \\frac{dJ_t}{dx_t} = \\begin{cases} c^{var} - c^{short} & \\text{if } x_t  d_t \\\\ c^{var}  \\text{if } x_t > d_t \\end{cases} $$\n$x_t$ 的最优选择取决于斜率 $c^{var} - c^{short}$ 的符号。\n\n- **子情况 2a：$c^{var}  c^{short}$**\n当 $x_t  d_t$ 时斜率为负，当 $x_t > d_t$ 时斜率为正。函数 $J_t(x_t)$ 在 $x_t = d_t$ 处最小化。为满足容量约束，我们应尽可能接近需求进行生产。最优产量是：\n$$ x_t^{opt} = \\min(d_t, X_{max,t}) = \\min(d_t, M, S_t/e) $$\n这是标准的经济学逻辑：如果生产成本低于不生产的惩罚，那么就在物理限制内生产以满足需求。\n\n- **子情况 2b：$c^{var} \\geq c^{short}$**\n斜率处处非负（$c^{var} - c^{short} \\ge 0$ 且 $c^{var} > 0$）。$J_t(x_t)$ 是一个关于 $x_t$ 的非递减函数。要最小化它，我们必须为 $x_t$ 选择可能的最小值，即 $x_t^{opt} = 0$。这意味着即使单元开启，生产任何东西并支付可变生产成本，也比不生产并支付全部短缺惩罚更不划算。比较在线（$y_t=1$）与离线（$y_t=0$）的总成本表明，在线会增加一个严格为正的设置成本（$c^{setup} > 0$），而没有任何收益。因此，在这种情况下，最优决策总是保持单元关闭，除非所有成本和需求都为零。通用算法能正确找到这一点，因此不需要特殊处理。\n\n当 $y_t=1$ 时，时间段 $t$ 的成本是根据已确定的 $x_t^{opt}$ 计算的。如果单元之前是关闭的（$y_{t-1}=0$）而现在是开启的（$y_t=1$），则启动变量 $z_t$ 为 $1$，否则为 $0$。给定初始条件 $y_0=0$，对于 $t \\geq 1$，这可以写成 $z_t = y_t \\cdot (1 - y_{t-1})$。该时间段的成本是：\n$$ C_t = c^{var} \\cdot x_t^{opt} + c^{setup} \\cdot y_t + c^{start} \\cdot z_t + c^{short} \\cdot \\max(0, d_t - x_t^{opt}) $$\n\n**算法摘要**\n对于每个测试用例：\n1. 将 `min_total_cost` 初始化为无穷大，并将 `best_schedule` 初始化为 `None`。\n2. 遍历从 $0$ 到 $2^T - 1$ 的每个整数 $i$。每个整数的二进制表示对应一个唯一的候选计划 $\\{y_1, \\dots, y_T\\}$。\n3. 对于每个计划，通过将时间段 $t=1$ 到 $T$ 的成本 $C_t$ 相加来计算总成本。\n    a. 对于每个时间段 $t$，从计划中确定 $y_t$。\n    b. 基于 $y_t$（和 $y_{t-1}$），按上文推导的方式计算 $x_t^{opt}$ 和 $z_t$。\n    c. 计算时间段成本 $C_t$。\n4. 如果当前计划计算出的总成本小于 `min_total_cost`，则更新 `min_total_cost` 和 `best_schedule`。\n5. 遍历完所有 $2^T$ 个计划后，就找到了最优计划及其成本。存储此结果。\n6. 处理完所有测试用例后，将收集到的结果格式化为指定的单个字符串并打印。",
            "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Computes the cost-minimizing on/off schedule for a fossil fuel unit\n    by performing an exhaustive search over all possible binary schedules.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Format: (T, d, S, M, c_var, c_setup, c_start, c_short)\n    # e is assumed to be 1.0 for all cases.\n    test_cases = [\n        # Case 1\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 100, 500, 200),\n        # Case 2\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 100, 2000, 200),\n        # Case 3\n        (4, [50, 120, 80, 0], [120, 80, 160, 0], 100, 20, 300, 0, 200),\n        # Case 4\n        (1, [150], [300], 100, 30, 200, 500, 300),\n        # Case 5\n        (3, [0, 0, 0], [100, 100, 100], 100, 25, 100, 500, 200),\n        # Case 6\n        (2, [60, 60], [100, 100], 100, 500, 100, 200, 100),\n    ]\n\n    all_results = []\n    e = 1.0 # Conversion factor\n\n    for case in test_cases:\n        T, d, S, M, c_var, c_setup, c_start, c_short = case\n        \n        min_total_cost = np.inf\n        best_schedule = []\n\n        num_schedules = 2**T\n        for i in range(num_schedules):\n            # Generate a candidate schedule {y_1, ..., y_T}\n            # (i >> t)  1 gives bits from right-to-left, which works for t=0..T-1\n            # corresponding to periods 1..T\n            y_schedule = [(i >> t)  1 for t in range(T)]\n            \n            current_total_cost = 0.0\n            y_prev = 0  # y_0 is given as 0\n\n            for t_idx in range(T):\n                y_t = y_schedule[t_idx]\n                d_t = d[t_idx]\n                S_t = S[t_idx]\n                \n                period_cost = 0.0\n                \n                if y_t == 0:\n                    # Unit is offline. Production is 0. Cost is only from unmet demand.\n                    # z_t is 0 since z_t = y_t. No setup or startup cost.\n                    period_cost = c_short * d_t\n                else: # y_t == 1\n                    # Unit is online.\n                    \n                    # Determine start-up: z_t = 1 if y_t=1 and y_{t-1}=0\n                    z_t = 1 if y_prev == 0 else 0\n                    \n                    # Determine optimal production x_t\n                    X_max_t = min(M, S_t / e)\n                    \n                    x_t = 0.0\n                    if c_var  c_short:\n                        # Produce to meet demand up to capacity if cheaper than shortage\n                        x_t = min(d_t, X_max_t)\n                    else:\n                        # Cheaper to not produce and incur shortage penalty\n                        x_t = 0.0\n\n                    shortage = max(0, d_t - x_t)\n                    \n                    period_cost = (c_var * x_t) + c_setup + (c_start * z_t) + (c_short * shortage)\n\n                current_total_cost += period_cost\n                y_prev = y_t\n\n            if current_total_cost  min_total_cost:\n                min_total_cost = current_total_cost\n                best_schedule = y_schedule\n\n        # Format the result for the current case\n        case_result = [float(min_total_cost)] + best_schedule\n        all_results.append(case_result)\n\n    # Print all results in the specified single-line format\n    # The format [[cost,y1,...],[cost,y1,...]] is Python's list-to-string without spaces.\n    print(str(all_results).replace(' ', ''))\n\nsolve()\n```"
        }
    ]
}