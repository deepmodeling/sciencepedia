{
    "hands_on_practices": [
        {
            "introduction": "多尺度建模的第一步通常是简化复杂的物理网络。本练习将引导您应用基本的电路理论，将多个并联的配电馈线聚合为一个等效模型。掌握这种降阶建模技术至关重要，它能有效降低大规模系统仿真的计算复杂度，从而将详细的局部模型与宏观的输电网研究联系起来。",
            "id": "4106591",
            "problem": "一个配电变电站通过其下游馈线的聚合表示与一个输电级动态模型相连接，以实现输电动态与配电潮流之间的多尺度耦合。三条相同且平衡的三相馈线在变电站母线上并联，为一个下游区域供电。在额定频率下，每条馈线的单位长度每相串联阻抗是均匀的，由$\\left(R,X\\right)=\\left(0.2,0.4\\right)\\,\\Omega/\\mathrm{km}$给出，且每条馈线的长度为$5\\,\\mathrm{km}$。假设系统处于准静态正弦稳态，并联导纳可忽略，且在平衡条件下进行单相分析，因此串联阻抗可被视为集总和线性的。使用源自基尔霍夫电流定律(KCL)和基尔霍夫电压定律(KVL)的基本网络组合原理，将三条并联馈线聚合成从变电站看去的单个等效每相串联阻抗。使用串并联等效方法，计算该等效阻抗的等效电阻$R_{\\mathrm{eq}}$和电抗$X_{\\mathrm{eq}}$。将最终答案表示为一个单位为$\\Omega$的双元素行矩阵$\\left(R_{\\mathrm{eq}},X_{\\mathrm{eq}}\\right)$。无需四舍五入；请提供精确值。",
            "solution": "该问题要求计算三条相同的并联配电馈线的等效每相串联阻抗。这是电路理论在电力系统分析中的一个标准问题，特别是在多尺度仿真中用于模型聚合。\n\n首先，我们验证问题陈述。\n\n**步骤1：提取已知条件**\n- 馈线数量: $3$\n- 馈线连接方式: 并联\n- 馈线特性: 所有三条馈线均相同。\n- 单位长度每相串联阻抗: $(R, X) = (0.2, 0.4) \\, \\Omega/\\mathrm{km}$\n- 每条馈线的长度: $L = 5 \\, \\mathrm{km}$\n- 假设: 准静态正弦稳态，可忽略的并联导纳，平衡条件下的单相分析，集总和线性的串联阻抗。\n- 目标: 计算单个等效每相串联阻抗的等效电阻$R_{\\mathrm{eq}}$和电抗$X_{\\mathrm{eq}}$。\n- 最终答案格式: 双元素行矩阵 $(R_{\\mathrm{eq}}, X_{\\mathrm{eq}})$，单位为$\\Omega$。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上基于应用于交流电力系统的电路理论原理（欧姆定律、KCL、KVL）。聚合并联馈线的概念是为大规模电力系统研究创建降阶模型的一项基本技术，也是多尺度建模的核心部分。所提供的物理参数是现实的。问题提法得当，提供了所有必要信息，没有矛盾。目标明确，语言精确。因此，该问题被认为是有效的。\n\n**步骤3：结论与行动**\n问题有效。将提供完整的解答。\n\n**求解过程**\n\n单位长度每相串联阻抗以电阻和电抗对的形式给出，即$(R, X) = (0.2, 0.4) \\, \\Omega/\\mathrm{km}$。用复数表示法，这被记为$z$：\n$$z = R + jX = 0.2 + j0.4 \\, \\frac{\\Omega}{\\mathrm{km}}$$\n其中$j$是虚数单位。\n\n每条馈线的长度为$L = 5 \\, \\mathrm{km}$。由于阻抗是均匀的且并联导纳可忽略不计，单条馈线的总串联阻抗（我们记为$Z_{\\mathrm{feeder}}$）是单位长度阻抗乘以馈线的总长度。\n$$Z_{\\mathrm{feeder}} = z \\times L$$\n代入给定值：\n$$Z_{\\mathrm{feeder}} = (0.2 + j0.4) \\, \\frac{\\Omega}{\\mathrm{km}} \\times 5 \\, \\mathrm{km}$$\n$$Z_{\\mathrm{feeder}} = (5 \\times 0.2) + j(5 \\times 0.4) \\, \\Omega$$\n$$Z_{\\mathrm{feeder}} = 1 + j2 \\, \\Omega$$\n这意味着单条馈线的电阻为$R_{\\mathrm{feeder}} = 1 \\, \\Omega$，电抗为$X_{\\mathrm{feeder}} = 2 \\, \\Omega$。\n\n问题陈述有三条相同的馈线在变电站母线上并联。$N$个相同阻抗$Z$并联的等效阻抗$Z_{\\mathrm{eq}}$由以下公式给出：\n$$Z_{\\mathrm{eq}} = \\frac{Z}{N}$$\n该公式可以从并联导纳的一般规则推导出来。导纳$Y$是阻抗$Z$的倒数，即$Y = \\frac{1}{Z}$。对于并联元件，总导纳是各个导纳之和：\n$$Y_{\\mathrm{eq}} = \\sum_{i=1}^{N} Y_i$$\n由于所有馈线都相同，因此对于所有$i$，$Y_i = Y_{\\mathrm{feeder}} = \\frac{1}{Z_{\\mathrm{feeder}}}$。\n$$Y_{\\mathrm{eq}} = N \\times Y_{\\mathrm{feeder}} = \\frac{N}{Z_{\\mathrm{feeder}}}$$\n等效阻抗是等效导纳的倒数：\n$$Z_{\\mathrm{eq}} = \\frac{1}{Y_{\\mathrm{eq}}} = \\frac{Z_{\\mathrm{feeder}}}{N}$$\n在本问题中，我们有$N = 3$条相同的馈线，且$Z_{\\mathrm{feeder}} = 1 + j2 \\, \\Omega$。因此，等效阻抗$Z_{\\mathrm{eq}}$为：\n$$Z_{\\mathrm{eq}} = \\frac{1 + j2}{3} \\, \\Omega$$\n为了求出等效电阻$R_{\\mathrm{eq}}$和等效电抗$X_{\\mathrm{eq}}$，我们分离$Z_{\\mathrm{eq}}$的实部和虚部：\n$$Z_{\\mathrm{eq}} = \\frac{1}{3} + j\\frac{2}{3} \\, \\Omega$$\n根据定义，$Z_{\\mathrm{eq}} = R_{\\mathrm{eq}} + jX_{\\mathrm{eq}}$。比较表达式，我们得到：\n$$R_{\\mathrm{eq}} = \\frac{1}{3} \\, \\Omega$$\n$$X_{\\mathrm{eq}} = \\frac{2}{3} \\, \\Omega$$\n问题要求最终答案为双元素行矩阵$(R_{\\mathrm{eq}}, X_{\\mathrm{eq}})$。这些是所要求的精确值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{3}  \\frac{2}{3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "当耦合具有显著不同时间尺度的领域时，例如快速的电气动态和缓慢的热过程，会产生数值计算上的“刚性”系统。本练习旨在探讨使用不同数值积分方法（显式欧拉法与隐式欧拉法）求解此类刚性常微分方程组所带来的计算成本差异。通过比较计算开销，您将深入理解为何隐式方法虽然单步计算更复杂，但对于实现稳定高效的多尺度动态仿真往往是必不可少的。",
            "id": "4106641",
            "problem": "考虑一个线性时不变的跨域能源系统，其常微分方程 (ODE) 动力学由 $\\dot{x}(t) = A x(t) + s(t)$ 给出，其中 $x(t) \\in \\mathbb{R}^{n}$ 是包含电气和热学两种状态的状态向量，$A \\in \\mathbb{R}^{n \\times n}$ 是在某个工作点附近线性化的雅可比矩阵，$s(t)$ 是一个代表外源输入的已知源项。该系统耦合了一个具有特征（最快）时间常数 $\\tau_{f} = 1\\,\\mathrm{ms}$ 的快速电气子域和一个具有特征（最慢）时间常数 $\\tau_{s} = 1\\,\\mathrm{h}$ 的慢速热学子域。这种跨域耦合源于电阻加热（电气）影响温度（热学），以及热电效应反馈到电气参数中。您需要在一个 $T = 1\\,\\mathrm{h}$ 的时间范围内对该系统进行积分。\n\n考虑两种时间积分策略：\n- 显式欧拉法，时间步长为 $\\Delta t_{\\mathrm{EE}} = 0.1\\,\\mathrm{ms}$。\n- 后向欧拉法，时间步长为 $\\Delta t_{\\mathrm{BE}} = 1\\,\\mathrm{s}$。\n\n假设：\n- 对于具有实负特征值 $\\lambda$ 的线性模式，显式欧拉法的稳定性由条件 $|1 + \\Delta t_{\\mathrm{EE}} \\lambda|  1$ 决定，而后向欧拉法对于此类模式是无条件稳定的。\n- 系统维度为 $n = 2000$，由 $n_{e} = 1200$ 个电气状态和 $n_{t} = 800$ 个热学状态组成。\n- 雅可比矩阵 $A$ 是稀疏的，具有以下科学上合理的结构：每个状态平均有 $4$ 个域内耦合；每个状态有一个对角线元素；以及有 $400$ 个由界面功率-温度依赖性产生的跨域耦合元素。因此，非零元素的总数为 $\\mathrm{nnz} = n$ (对角线) $+ 4n$ (域内耦合) $+ 400 = 10400$。\n- 稀疏矩阵向量乘法 $A x$ 的成本近似为 $2\\,\\mathrm{nnz}$ 次浮点运算 (flops)。\n- 对于后向欧拉法，每一步都需要求解线性系统 $(I - \\Delta t_{\\mathrm{BE}} A) x_{k+1} = x_{k} + \\Delta t_{\\mathrm{BE}} s_{k+1}$。因为 $A$ 和 $\\Delta t_{\\mathrm{BE}}$ 是常数，所以系统矩阵随时间不变；因此，一个稀疏的下上三角 (LU) 分解可以在所有步骤中重复使用。假设 LU 分解的成本为 $10\\,\\mathrm{nnz}$ 次浮点运算，每个时间步后续的前向加后向三角求解成本为 $4\\,\\mathrm{nnz}$ 次浮点运算。\n- 忽略两种方法共有的、不改变比率的成本，例如不涉及 $A$ 的向量 axpy 运算。\n\n任务：\n1. 使用 $T = 3600\\,\\mathrm{s}$，计算显式欧拉法的总时间步数 $N_{\\mathrm{EE}}$ 和后向欧拉法的总时间步数 $N_{\\mathrm{BE}}$。\n2. 在上述成本模型下，计算总运算次数 $C_{\\mathrm{EE}}$ 和 $C_{\\mathrm{BE}}$，然后计算无量纲比率 $R = C_{\\mathrm{EE}} / C_{\\mathrm{BE}}$ 作为比较计算成本的度量。\n\n将最终答案以包含三个量 $\\left(N_{\\mathrm{EE}}, N_{\\mathrm{BE}}, R\\right)$ 的行矩阵形式报告。对 $N_{\\mathrm{EE}}$ 和 $N_{\\mathrm{BE}}$ 使用精确整数。将 $R$ 四舍五入到四位有效数字。该比率为无量纲；最终答案中不包含任何单位。",
            "solution": "我们从线性时不变 ODE $\\dot{x}(t) = A x(t) + s(t)$ 开始，其中刚性问题源于时间尺度的巨大差异：最快的电气模式时间常数为 $\\tau_{f} = 1\\,\\mathrm{ms}$，最慢的热学模式时间常数为 $\\tau_{s} = 1\\,\\mathrm{h}$。对于应用于标量线性模式 $\\dot{y} = \\lambda y$ 的显式欧拉法，其更新公式为 $y_{k+1} = y_{k} + \\Delta t_{\\mathrm{EE}} \\lambda y_{k}$，对于实负的 $\\lambda$，稳定性要求 $|1 + \\Delta t_{\\mathrm{EE}} \\lambda|  1$。最快模式的特征为 $\\lambda_{f} \\approx -\\frac{1}{\\tau_{f}}$，因此稳定性条件可以根据 $\\Delta t_{\\mathrm{EE}}$ 相对于 $\\tau_{f}$ 的关系来评估。后向欧拉法应用于同一模式时使用 $y_{k+1} = \\frac{y_{k}}{1 - \\Delta t_{\\mathrm{BE}} \\lambda}$，当 $\\lambda  0$ 时，对于所有 $\\Delta t_{\\mathrm{BE}}  0$ 都是稳定的。\n\n我们需要计算在时间范围 $T = 3600\\,\\mathrm{s}$ 内每种方法的时间步数：\n- 对于显式欧拉法，时间步长为 $\\Delta t_{\\mathrm{EE}} = 0.1\\,\\mathrm{ms} = 10^{-4}\\,\\mathrm{s}$，步数为\n$$\nN_{\\mathrm{EE}} = \\frac{T}{\\Delta t_{\\mathrm{EE}}} = \\frac{3600}{10^{-4}} = 36{,}000{,}000.\n$$\n- 对于后向欧拉法，时间步长为 $\\Delta t_{\\mathrm{BE}} = 1\\,\\mathrm{s}$，步数为\n$$\nN_{\\mathrm{BE}} = \\frac{T}{\\Delta t_{\\mathrm{BE}}} = \\frac{3600}{1} = 3600.\n$$\n\n接下来，我们在给定的模型下计算计算成本（运算次数）。雅可比矩阵有\n$$\n\\mathrm{nnz} = n + 4n + 400 = 2000 + 8000 + 400 = 10400\n$$\n个非零元素。对于显式欧拉法，每一步需要一次稀疏矩阵向量乘法 $A x$，其成本模型为 $2\\,\\mathrm{nnz}$ 次浮点运算。因此，显式欧拉法的总成本为\n$$\nC_{\\mathrm{EE}} = N_{\\mathrm{EE}} \\cdot (2\\,\\mathrm{nnz}) = 36{,}000{,}000 \\times (2 \\times 10400).\n$$\n计算每步的浮点运算次数：\n$$\n2 \\times 10400 = 20800,\n$$\n所以\n$$\nC_{\\mathrm{EE}} = 36{,}000{,}000 \\times 20800 = 748{,}800 \\times 10^{6} = 7.488 \\times 10^{11}.\n$$\n\n对于后向欧拉法，系统矩阵 $(I - \\Delta t_{\\mathrm{BE}} A)$ 是常数，因此我们执行一次稀疏下上三角 (LU) 分解，成本为 $10\\,\\mathrm{nnz}$ 次浮点运算，然后在每一步中通过两次三角求解重复使用它，每步成本模型为 $4\\,\\mathrm{nnz}$ 次浮点运算。后向欧拉法的总成本为\n$$\nC_{\\mathrm{BE}} = (10\\,\\mathrm{nnz}) + N_{\\mathrm{BE}} \\cdot (4\\,\\mathrm{nnz}) = 10 \\times 10400 + 3600 \\times (4 \\times 10400).\n$$\n我们计算各项：\n$$\n10 \\times 10400 = 104000, \\quad 4 \\times 10400 = 41600,\n$$\n所以\n$$\nC_{\\mathrm{BE}} = 104000 + 3600 \\times 41600.\n$$\n进行乘法运算，\n$$\n3600 \\times 41600 = (36 \\times 41600) \\times 100 = (1497600) \\times 100 = 149{,}760{,}000,\n$$\n因此，\n$$\nC_{\\mathrm{BE}} = 149{,}760{,}000 + 104{,}000 = 149{,}864{,}000 = 1.49864 \\times 10^{8}.\n$$\n\n比较成本比率为\n$$\nR = \\frac{C_{\\mathrm{EE}}}{C_{\\mathrm{BE}}} = \\frac{7.488 \\times 10^{11}}{1.49864 \\times 10^{8}}.\n$$\n进行除法运算，\n$$\nR \\approx 4.996532 \\times 10^{3}.\n$$\n将 $R$ 四舍五入到四位有效数字，得到\n$$\nR \\approx 4997.\n$$\n\n我们现在按要求组合最终输出：精确整数 $N_{\\mathrm{EE}} = 36{,}000{,}000$，$N_{\\mathrm{BE}} = 3600$，以及四舍五入到四位有效数字的无量纲比率 $R = 4997$。",
            "answer": "$$\\boxed{\\begin{pmatrix}36000000  3600  4997\\end{pmatrix}}$$"
        },
        {
            "introduction": "能源系统的规划决策通常涉及在未来运营条件充满不确定性的情况下，做出影响深远的长期投资。这是一个典型的多尺度、跨领域优化问题。本高级练习将向您介绍 Benders 分解法，这是一种强大的算法，可将复杂的规划问题分解为一个主投资问题和多个对应不同情景的运营子问题。您将亲手生成用于在不同尺度模型间传递信息的“割平面”，从而实践能源系统建模中最核心的优化技术之一。",
            "id": "4106621",
            "problem": "考虑一个电力系统的两阶段容量扩展和运营问题，该问题将跨多个不确定性场景的缓慢投资决策与快速运营决策相结合，反映了经济学和气象学之间的多尺度建模和跨领域耦合。第一阶段选择两种技术的容量：一个化石燃料发电机和一个风力发电厂。第二阶段在物理约束下，以最低的可变成本运营该系统，以满足特定场景的需求。\n\n定义投资向量 $y = (y_G, y_W)$，其中 $y_G \\ge 0$ 和 $y_W \\ge 0$ 分别是燃气发电机和风力发电厂的装机铭牌容量，单位为兆瓦 (MW)。对于每个场景 $s$，定义：\n- 需求 $d_s$，单位为兆瓦 (MW)。\n- 燃气边际成本 $c_G^s$，单位为美元/兆瓦时 ($\\$/\\text{MWh}$)。\n- 风能边际成本 $c_W^s$，单位为美元/兆瓦时 ($\\$/\\text{MWh}$)。\n- 风能可用率因子 $a^s \\in [0,1]$，无量纲，使得可运行的风能输出受 $a^s y_W$ 的限制。\n\n对于每个场景 $s$，运营线性规划 (LP) 子问题为：\n最小化可变发电成本\n$$\\min_{p_G, p_W} \\; c_G^s \\, p_G + c_W^s \\, p_W,$$\n受限于以下物理约束\n$$p_G + p_W \\ge d_s,$$\n$$0 \\le p_G \\le y_G,$$\n$$0 \\le p_W \\le a^s y_W.$$\n这里 $p_G$ 和 $p_W$ 分别是燃气和风能的调度水平，单位为兆瓦 (MW)，能量以一小时为单位计量，因此成本单位为美元 ($\\$$)。第一阶段主问题为每个场景 $s$ 包含一个追索成本占位符变量 $\\theta_s$（单位为美元），而 Benders 分解 (BD) 添加两种类型的割：\n- 最优性割，通过场景 $s$ 运营 LP 的值（表示为 $y$ 的仿射函数）来为 $\\theta_s$ 提供上界。\n- 可行性割，对 $y$ 施加必要条件，以使场景 $s$ 的运营 LP 可行。\n\n从线性规划 (LP) 对偶性的基本原理和用于不可行性证明的 Farkas 引理出发，您的任务是针对给定的投资向量 $y$ 和场景参数，计算以下两者之一：\n- 一个有效的 Benders 最优性割，形式为\n$$\\theta_s \\ge \\gamma_s + \\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W,$$\n给出 $\\gamma_s$、$\\eta_{G,s}$ 和 $\\eta_{W,s}$ 的明确数值；或者\n- 一个有效的 Benders 可行性割，形式为\n$$\\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W \\ge -\\gamma_s,$$\n给出 $\\gamma_s$、$\\eta_{G,s}$ 和 $\\eta_{W,s}$ 的明确数值。\n\n所有物理量必须使用一致的单位处理。需求单位为兆瓦 (MW)，成本单位为美元 ($\\$$)。如果返回可行性割，它约束的是容量，应以兆瓦 (MW) 为单位解释；如果返回最优性割，它约束的是追索成本，应以美元 ($\\$$) 为单位解释。\n\n给定以下场景数据集（三个场景），作为测试套件的背景：\n- 场景 $s=1$：$d_1 = 120$ MW, $c_G^1 = 50$ $\\$/\\text{MWh}$, $c_W^1 = 5$ $\\$/\\text{MWh}$, $a^1 = 0.4$。\n- 场景 $s=2$：$d_2 = 80$ MW, $c_G^2 = 70$ $\\$/\\text{MWh}$, $c_W^2 = 10$ $\\$/\\text{MWh}$, $a^2 = 0.9$。\n- 场景 $s=3$：$d_3 = 200$ MW, $c_G^3 = 60$ $\\$/\\text{MWh}$, $c_W^3 = 20$ $\\$/\\text{MWh}$, $a^3 = 0.2$。\n\n您的程序必须评估以下五个测试用例，每个用例由一个场景索引 $s$ 和一个投资向量 $y$ 指定：\n1. $(s=1, y_G = 160 \\text{ MW}, y_W = 50 \\text{ MW})$。\n2. $(s=2, y_G = 60 \\text{ MW}, y_W = 50 \\text{ MW})$。\n3. $(s=3, y_G = 20 \\text{ MW}, y_W = 100 \\text{ MW})$。\n4. $(s=1, y_G = 100 \\text{ MW}, y_W = 50 \\text{ MW})$。\n5. $(s=2, y_G = 0 \\text{ MW}, y_W = 100 \\text{ MW})$。\n\n对于每个测试用例，确定在给定的 $y$ 和场景参数下，运营 LP 是否可行。如果不可行，则返回可行性割的系数 $(\\gamma_s, \\eta_{G,s}, \\eta_{W,s})$，单位为兆瓦 (MW)，使得 $\\eta_{G,s} y_G + \\eta_{W,s} y_W \\ge -\\gamma_s$；如果可行，则返回最优性割的系数 $(\\gamma_s, \\eta_{G,s}, \\eta_{W,s})$，单位为美元 ($\\$$)，使得 $\\theta_s \\ge \\gamma_s + \\eta_{G,s} y_G + \\eta_{W,s} y_W$。\n\n最终输出格式规范：\n- 对于每个测试用例，输出一个包含四个基本值的列表 $[t, \\gamma_s, \\eta_{G,s}, \\eta_{W,s}]$，其中 $t$ 是一个整数指示符，$t=0$ 表示最优性割（成本单位为美元），$t=1$ 表示可行性割（容量单位为兆瓦）。\n- 将所有五个测试用例的列表聚合到一个 Python 风格的列表字面量中，并在一行上打印。例如，格式必须是\n$$[\\,[t_1,\\gamma_1,\\eta_{G,1},\\eta_{W,1}],\\,[t_2,\\gamma_2,\\eta_{G,2},\\eta_{W,2}],\\,[t_3,\\gamma_3,\\eta_{G,3},\\eta_{W,3}],\\,[t_4,\\gamma_4,\\eta_{G,4},\\eta_{W,4}],\\,[t_5,\\gamma_5,\\eta_{G,5},\\eta_{W,5}]\\,].$$\n\n您的程序必须只生成一行包含指定列表的内容，数值表示为 Python 浮点数或整数。不得打印任何其他文本。答案的单位由如上所述的割类型指示符 $t$ 隐含。",
            "solution": "用户的要求是为一个两阶段随机容量扩展问题推导 Benders 割。这需要针对给定的第一阶段投资决策和特定的不确定性场景，分析运营子问题。该分析取决于线性规划 (LP) 对偶性的原理。\n\n### 1. 原始和对偶运营子问题\n\n对于一个给定的场景 $s$ 和一个固定的投资向量 $y = (y_G, y_W)$，第二阶段的运营子问题是一个线性规划 (LP)，用于确定最低成本的调度 $(p_G, p_W)$。\n\n**原始子问题 $P_s(y)$:**\n原始 LP 如下所示：\n$$\n\\min_{p_G, p_W} \\; c_G^s \\, p_G + c_W^s \\, p_W\n$$\n受限于：\n$$\n\\begin{align*}\np_G + p_W \\ge d_s \\\\\n0 \\le p_G \\le y_G \\\\\n0 \\le p_W \\le a^s y_W\n\\end{align*}\n$$\n为了构建对偶问题，我们将对偶变量与每个约束关联起来。让我们将原始问题重写为标准形式（$\\min c^T x$ subject to $Ax \\ge b, x \\ge 0$）：\n$$ \\min_{p_G, p_W} c_G^s p_G + c_W^s p_W $$\n受限于：\n$$\n\\begin{array}{lcll}\np_G + p_W \\ge d_s  (\\text{对偶变量 } \\lambda_s \\ge 0) \\\\\np_G \\le y_G  \\iff -p_G \\ge -y_G \\quad (\\text{对偶变量 } \\mu_{G,s} \\ge 0) \\\\\np_W \\le a^s y_W  \\iff -p_W \\ge -a^s y_W \\quad (\\text{对偶变量 } \\mu_{W,s} \\ge 0) \\\\\np_G, p_W \\ge 0 \n\\end{array}\n$$\n\n**对偶子问题 $D_s(y)$:**\n相应的对偶 LP 是一个最大化问题：\n$$\n\\max_{\\lambda_s, \\mu_{G,s}, \\mu_{W,s}} \\; d_s \\lambda_s - y_G \\mu_{G,s} - a^s y_W \\mu_{W,s}\n$$\n受限于：\n$$\n\\begin{align*}\n\\lambda_s - \\mu_{G,s} \\le c_G^s \\\\\n\\lambda_s - \\mu_{W,s} \\le c_W^s \\\\\n\\lambda_s, \\mu_{G,s}, \\mu_{W,s} \\ge 0\n\\end{align*}\n$$\n场景 $s$ 的追索成本值，记为 $Q_s(y)$，是这些 LP 的最优目标值。Benders 割是从对偶问题的结构中推导出来的。\n\n### 2. 可行性与不可行性分析\n\n原始子问题的可行性决定了要生成的割的类型。\n\n**可行性条件：** 原始子问题是可行的，当且仅当最大可能发电量能够满足需求 $d_s$。该条件为：\n$$\ny_G + a^s y_W \\ge d_s\n$$\n\n**情况1：原始问题不可行 ($y_G + a^s y_W  d_s$) 与可行性割**\n如果原始问题不可行，其对偶问题是无界的（因为对偶问题总是可行的，例如，所有对偶变量都设为0）。一个无界的对偶问题意味着存在对偶可行域的一个极射线，沿着该射线目标函数无限增加。Benders 可行性割旨在通过使沿着该射线的对偶目标非正，来排除当前不可行的投资向量 $y$。\n\n极射线是一个方向向量 $v = (\\bar{\\lambda}_s, \\bar{\\mu}_{G,s}, \\bar{\\mu}_{W,s})$，满足 $\\bar{\\lambda}_s - \\bar{\\mu}_{G,s} \\le 0$，$\\bar{\\lambda}_s - \\bar{\\mu}_{W,s} \\le 0$，以及 $v \\ge 0$。为了使对偶问题无界，目标函数必须沿着该射线增加：$d_s \\bar{\\lambda}_s - y_G \\bar{\\mu}_{G,s} - a^s y_W \\bar{\\mu}_{W,s}  0$。\n\n对于这样的射线，一个简单且有效的选择是 $(\\bar{\\lambda}_s, \\bar{\\mu}_{G,s}, \\bar{\\mu}_{W,s}) = (1, 1, 1)$。这个向量满足射线条件。无界性条件变为 $d_s - y_G - a^s y_W  0$，这正是原始问题不可行的条件。\n\n可行性割是通过强制使沿着该射线的物镜变化为非正来导出的：\n$$\nd_s \\bar{\\lambda}_s - y_G \\bar{\\mu}_{G,s} - y_W (a^s \\bar{\\mu}_{W,s}) \\le 0\n$$\n代入射线 $(1, 1, 1)$，我们得到 $d_s - y_G - a^s y_W \\le 0$，简化为 $y_G + a^s y_W \\ge d_s$。\n为了匹配要求的格式 $\\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W \\ge -\\gamma_s$，我们将其重写为 $1 \\cdot y_G + a^s \\cdot y_W \\ge d_s$。\n比较各项，得到可行性割的系数：\n- $\\gamma_s = -d_s$\n- $\\eta_{G,s} = 1$\n- $\\eta_{W,s} = a^s$\n割类型指示符为 $t=1$。\n\n**情况2：原始问题可行 ($y_G + a^s y_W \\ge d_s$) 与最优性割**\n如果原始问题可行，则生成一个最优性割。根据强对偶性，最优追索成本 $Q_s(y)$ 等于对偶问题的最优值。对于一个最优对偶解 $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*)$，我们有：\n$$\nQ_s(y) = d_s \\lambda_s^* - y_G \\mu_{G,s}^* - y_W (a^s \\mu_{W,s}^*)\n$$\nBenders 最优性割是追索成本变量 $\\theta_s$ 的一个下界，由 $\\theta_s \\ge Q_s(y)$ 给出。这得出了割：\n$$\n\\theta_s \\ge d_s \\lambda_s^* - y_G \\mu_{G,s}^* - y_W (a^s \\mu_{W,s}^*)\n$$\n将其与所需格式 $\\theta_s \\ge \\gamma_s + \\eta_{G,s} \\, y_G + \\eta_{W,s} \\, y_W$ 匹配，我们找到系数：\n- $\\gamma_s = d_s \\lambda_s^*$\n- $\\eta_{G,s} = -\\mu_{G,s}^*$\n- $\\eta_{W,s} = -a^s \\mu_{W,s}^*$\n割类型指示符为 $t=0$。\n\n为了找到最优对偶变量 $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*)$，我们首先使用优先顺序调度逻辑来解决原始子问题。在所有场景中，风能都比燃气便宜 ($c_W^s  c_G^s$)，所以风能优先调度。\n\n**子情况 2.1：风能充足 ($a^s y_W \\ge d_s$)**\n调度为 $p_W^* = d_s$ 和 $p_G^* = 0$。通过应用 Karush-Kuhn-Tucker (KKT) 或互补松弛条件：\n- 风能容量约束 $p_W \\le a^s y_W$ 未激活，因此其对偶变量 $\\mu_{W,s}^* = 0$。\n- 燃气容量约束 $p_G \\le y_G$ 未激活，因此 $\\mu_{G,s}^* = 0$。\n- 由于 $p_W^*  0$，相应的对偶约束是激活的：$\\lambda_s^* - \\mu_{W,s}^* = c_W^s$，这得出 $\\lambda_s^* = c_W^s$。\n最优对偶解是 $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*) = (c_W^s, 0, 0)$。\n最优性割的系数为：\n- $\\gamma_s = d_s c_W^s$\n- $\\eta_{G,s} = 0$\n- $\\eta_{W,s} = 0$\n\n**子情况 2.2：风能不足 ($a^s y_W  d_s$)**\n调度为 $p_W^* = a^s y_W$ 和 $p_G^* = d_s - a^s y_W$。\n- 风能容量约束是激活的，所以 $\\mu_{W,s}^* \\ge 0$。\n- 燃气容量约束是未激活的（假设 $y_G + a^s y_W > d_s$），所以 $\\mu_{G,s}^* = 0$。\n- 由于 $p_G^*  0$，相应的对偶约束是激活的：$\\lambda_s^* - \\mu_{G,s}^* = c_G^s$，这得出 $\\lambda_s^* = c_G^s$。\n- 由于 $p_W^*  0$，另一个对偶约束是激活的：$\\lambda_s^* - \\mu_{W,s}^* = c_W^s$，这得出 $c_G^s - \\mu_{W,s}^* = c_W^s$，所以 $\\mu_{W,s}^* = c_G^s - c_W^s$。\n最优对偶解为 $(\\lambda_s^*, \\mu_{G,s}^*, \\mu_{W,s}^*) = (c_G^s, 0, c_G^s - c_W^s)$。这个解也适用于边界情况，即 $y_G + a^s y_W = d_s$。\n最优性割的系数为：\n- $\\gamma_s = d_s c_G^s$\n- $\\eta_{G,s} = 0$\n- $\\eta_{W,s} = -a^s(c_G^s - c_W^s)$\n\n### 3. 应用于测试用例\n\n上述逻辑应用于每个测试用例。\n\n**测试用例 1： $(s=1, y_G = 160, y_W = 50)$**\n$d_1=120, a^1=0.4$。总容量 $160 + 0.4 \\times 50 = 180 \\ge 120$ (可行)。风能容量 $0.4 \\times 50 = 20  120$ (子情况 2.2)。\n$\\gamma_1 = 120 \\times 50 = 6000$。 $\\eta_{G,1} = 0$。 $\\eta_{W,1} = -0.4 \\times (50-5) = -18$。 结果：$[0, 6000.0, 0.0, -18.0]$。\n\n**测试用例 2： $(s=2, y_G = 60, y_W = 50)$**\n$d_2=80, a^2=0.9$。总容量 $60 + 0.9 \\times 50 = 105 \\ge 80$ (可行)。风能容量 $0.9 \\times 50 = 45  80$ (子情况 2.2)。\n$\\gamma_2 = 80 \\times 70 = 5600$。 $\\eta_{G,2} = 0$。 $\\eta_{W,2} = -0.9 \\times (70-10) = -54$。 结果：$[0, 5600.0, 0.0, -54.0]$。\n\n**测试用例 3： $(s=3, y_G = 20, y_W = 100)$**\n$d_3=200, a^3=0.2$。总容量 $20 + 0.2 \\times 100 = 40  200$ (不可行)。\n$\\gamma_3 = -200$。 $\\eta_{G,3} = 1$。 $\\eta_{W,3} = 0.2$。 结果：$[1, -200.0, 1.0, 0.2]$。\n\n**测试用例 4： $(s=1, y_G = 100, y_W = 50)$**\n$d_1=120, a^1=0.4$。总容量 $100 + 0.4 \\times 50 = 120 \\ge 120$ (可行)。风能容量 $0.4 \\times 50 = 20  120$ (子情况 2.2)。\n$\\gamma_1 = 120 \\times 50 = 6000$。 $\\eta_{G,1} = 0$。 $\\eta_{W,1} = -0.4 \\times (50-5) = -18$。 结果：$[0, 6000.0, 0.0, -18.0]$。\n\n**测试用例 5： $(s=2, y_G = 0, y_W = 100)$**\n$d_2=80, a^2=0.9$。总容量 $0 + 0.9 \\times 100 = 90 \\ge 80$ (可行)。风能容量 $0.9 \\times 100 = 90 \\ge 80$ (子情况 2.1)。\n$\\gamma_2 = 80 \\times 10 = 800$。 $\\eta_{G,2} = 0$。 $\\eta_{W,2} = 0$。 结果：$[0, 800.0, 0.0, 0.0]$。",
            "answer": "[[0, 6000.0, 0.0, -18.0], [0, 5600.0, 0.0, -54.0], [1, -200.0, 1.0, 0.2], [0, 6000.0, 0.0, -18.0], [0, 800.0, 0.0, 0.0]]"
        }
    ]
}