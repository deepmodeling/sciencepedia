{
    "hands_on_practices": [
        {
            "introduction": "这项基础练习旨在评估单辆电动汽车（EV）可提供的最大对称调节能量。通过此练习 ，您将实践能量衡算、效率建模，并理解在电池荷电状态（SOC）余量和服务提供能力之间的关键权衡。这是进行任何V2G服务分析所必需掌握的核心技能。",
            "id": "4135568",
            "problem": "一个聚合商运营着一个电动汽车（EV）车队，以提供车辆到电网（V2G）的调频服务。考虑一辆额定电池容量为 $C = 50$ kWh 的单个电动汽车，其荷电状态（SOC）管理策略将SOC限制在额定容量的 $10\\%$ 到 $90\\%$ 的可用窗口内。电池的充放电效率是恒定且相等的，为 $\\eta_{\\text{ch}} = \\eta_{\\text{dis}} = 0.95$。假设：\n- 电池内部存储的能量为 $E_{\\text{batt}} = C \\cdot \\text{SOC}$。\n- 当从电网充电能量为 $E$（在电网侧测量）时，存储的能量增加 $\\Delta E_{\\text{batt, ch}} = \\eta_{\\text{ch}} E$。\n- 当向电网放电能量为 $E$（在电网侧测量）时，存储的能量减少 $\\Delta E_{\\text{batt, dis}} = E / \\eta_{\\text{dis}}$。\n\n聚合商寻求承诺一种对称的一小时调节能量能力，这意味着它可以从一个在策略窗口内可行的选定SOC设定点 $\\text{SOC}_{0}$ 开始，在一小时的时间间隔内，从电网吸收能量 $+E$ 或向电网输送能量 $-E$，两种方向的能量大小 $E$ 相同。该承诺必须保证，在一小时内完成完全充电 $+E$ 或完全放电 $-E$ 之后，电池的SOC仍保持在 $10\\%$–$90\\%$ 的范围内。\n\n使用考虑效率和SOC约束的能量衡算基本原理，确定在不违反SOC边界的情况下可以持续一小时的最大对称调节能量 $E$（单位 kWh），假设聚合商选择最优的 $\\text{SOC}_{0}$ 来最大化此对称能力。将您的答案四舍五入至四位有效数字。以kWh为单位表示最终能量。",
            "solution": "问题陈述具有科学依据，提法得当且客观。它基于储能和车辆到电网系统建模的既定原理，提供了一套清晰、自洽的定义和约束。所有必要的数据都已提供，没有内部矛盾或事实不准确之处。因此，该问题被视为有效，可以推导出正式的解。\n\n问题的核心是找出电动汽车（EV）在电网连接点处，受其荷电状态（SOC）限制，可以持续一小时的最大对称能量交换 $E$。这需要找到一个最佳的初始SOC，记为 $\\text{SOC}_{0}$，以最大化此能力。\n\n首先，我们定义问题陈述中提供的参数和变量：\n- 额定电池容量：$C_n = 50$ kWh。我们将使用 $C$ 代表此值。\n- 允许的最小荷电状态：$\\text{SOC}_{\\text{min}} = 0.10$ (或 $10\\%$)。\n- 允许的最大荷电状态：$\\text{SOC}_{\\text{max}} = 0.90$ (或 $90\\%$)。\n- 充电效率：$\\eta_{\\text{ch}} = 0.95$。\n- 放电效率：$\\eta_{\\text{dis}} = 0.95$。\n由于效率相等，我们可以定义一个单一的效率参数 $\\eta = \\eta_{\\text{ch}} = \\eta_{\\text{dis}} = 0.95$。\n\n电池内部存储的能量 $E_{\\text{batt}}$ 与SOC的关系式为 $E_{\\text{batt}} = C \\cdot \\text{SOC}$。因此，允许的内部能量范围是从 $E_{\\text{batt,min}} = C \\cdot \\text{SOC}_{\\text{min}}$ 到 $E_{\\text{batt,max}} = C \\cdot \\text{SOC}_{\\text{max}}$。\n设初始荷电状态为 $\\text{SOC}_{0}$，对应的初始内部能量为 $E_{\\text{batt},0} = C \\cdot \\text{SOC}_{0}$。要使 $\\text{SOC}_{0}$ 成为一个有效的起始点，它必须在允许的范围内：$\\text{SOC}_{\\text{min}} \\le \\text{SOC}_{0} \\le \\text{SOC}_{\\text{max}}$。\n\n我们分析能量大小为 $E$ 的对称调节服务的两种情况。\n\n1.  **充电情景（从电网吸收能量 $E$）：**\n    当从电网吸收能量 $E$ 时，电池中存储的能量增加 $\\Delta E_{\\text{batt, ch}} = \\eta_{\\text{ch}} E = \\eta E$。\n    充电后电池的最终内部能量为 $E_{\\text{batt,final,ch}} = E_{\\text{batt},0} + \\eta E$。\n    就SOC而言，最终荷电状态为 $\\text{SOC}_{\\text{final,ch}} = \\frac{E_{\\text{batt,final,ch}}}{C} = \\frac{C \\cdot \\text{SOC}_{0} + \\eta E}{C} = \\text{SOC}_{0} + \\frac{\\eta E}{C}$。\n    这个最终SOC不能超过最大限制：\n    $$ \\text{SOC}_{\\text{final,ch}} \\le \\text{SOC}_{\\text{max}} $$\n    $$ \\text{SOC}_{0} + \\frac{\\eta E}{C} \\le \\text{SOC}_{\\text{max}} $$\n    重新整理以找到对 $E$ 的约束：\n    $$ E \\le \\frac{C(\\text{SOC}_{\\text{max}} - \\text{SOC}_{0})}{\\eta} \\quad (1) $$\n\n2.  **放电情景（向电网输送能量 $E$）：**\n    当向电网输送能量 $E$ 时，从电池存储中提取的能量为 $\\Delta E_{\\text{batt, dis}} = E / \\eta_{\\text{dis}} = E / \\eta$。\n    放电后电池的最终内部能量为 $E_{\\text{batt,final,dis}} = E_{\\text{batt},0} - \\frac{E}{\\eta}$。\n    就SOC而言，最终荷电状态为 $\\text{SOC}_{\\text{final,dis}} = \\frac{E_{\\text{batt,final,dis}}}{C} = \\frac{C \\cdot \\text{SOC}_{0} - E/\\eta}{C} = \\text{SOC}_{0} - \\frac{E}{C\\eta}$。\n    这个最终SOC不能低于最小限制：\n    $$ \\text{SOC}_{\\text{final,dis}} \\ge \\text{SOC}_{\\text{min}} $$\n    $$ \\text{SOC}_{0} - \\frac{E}{C\\eta} \\ge \\text{SOC}_{\\text{min}} $$\n    重新整理以找到对 $E$ 的约束：\n    $$ E \\le C\\eta(\\text{SOC}_{0} - \\text{SOC}_{\\text{min}}) \\quad (2) $$\n\n为了保证从初始状态 $\\text{SOC}_{0}$ 进行充电和放电能量 $E$ 都是可行的，$E$ 必须同时满足不等式 $(1)$ 和 $(2)$。这意味着 $E$ 必须小于或等于两个上界中的最小值。\n$$ E \\le \\min \\left( \\frac{C(\\text{SOC}_{\\text{max}} - \\text{SOC}_{0})}{\\eta}, C\\eta(\\text{SOC}_{0} - \\text{SOC}_{\\text{min}}) \\right) $$\n聚合商希望承诺可能的最大对称能量 $E$。我们可以通过选择最优的初始SOC，即 $\\text{SOC}_{0}$，来使上述不等式的右侧最大化。两个函数（一个关于 $\\text{SOC}_{0}$ 递减，另一个递增）的最小值的最大值，在两个函数相等时取得。这平衡了充电和放电的能量裕度。\n$$ \\frac{C(\\text{SOC}_{\\text{max}} - \\text{SOC}_{0})}{\\eta} = C\\eta(\\text{SOC}_{0} - \\text{SOC}_{\\text{min}}) $$\n我们可以消去两侧的 $C$ 并求解最优的 $\\text{SOC}_{0}$：\n$$ \\frac{\\text{SOC}_{\\text{max}} - \\text{SOC}_{0}}{\\eta} = \\eta(\\text{SOC}_{0} - \\text{SOC}_{\\text{min}}) $$\n$$ \\text{SOC}_{\\text{max}} - \\text{SOC}_{0} = \\eta^2(\\text{SOC}_{0} - \\text{SOC}_{\\text{min}}) $$\n$$ \\text{SOC}_{\\text{max}} - \\text{SOC}_{0} = \\eta^2\\text{SOC}_{0} - \\eta^2\\text{SOC}_{\\text{min}} $$\n$$ \\text{SOC}_{\\text{max}} + \\eta^2\\text{SOC}_{\\text{min}} = \\text{SOC}_{0}(1 + \\eta^2) $$\n$$ \\text{SOC}_{0, \\text{opt}} = \\frac{\\text{SOC}_{\\text{max}} + \\eta^2\\text{SOC}_{\\text{min}}}{1 + \\eta^2} $$\n现在，我们将这个最优的 $\\text{SOC}_{0, \\text{opt}}$ 代回到 $E$ 的任一表达式中，以求得最大可能的对称能量 $E_{\\text{max}}$。使用表达式 $(2)$：\n$$ E_{\\text{max}} = C\\eta(\\text{SOC}_{0, \\text{opt}} - \\text{SOC}_{\\text{min}}) = C\\eta\\left(\\frac{\\text{SOC}_{\\text{max}} + \\eta^2\\text{SOC}_{\\text{min}}}{1 + \\eta^2} - \\text{SOC}_{\\text{min}}\\right) $$\n$$ E_{\\text{max}} = C\\eta\\left(\\frac{\\text{SOC}_{\\text{max}} + \\eta^2\\text{SOC}_{\\text{min}} - \\text{SOC}_{\\text{min}}(1 + \\eta^2)}{1 + \\eta^2}\\right) $$\n$$ E_{\\text{max}} = C\\eta\\left(\\frac{\\text{SOC}_{\\text{max}} + \\eta^2\\text{SOC}_{\\text{min}} - \\text{SOC}_{\\text{min}} - \\eta^2\\text{SOC}_{\\text{min}}}{1 + \\eta^2}\\right) $$\n$$ E_{\\text{max}} = C\\eta\\left(\\frac{\\text{SOC}_{\\text{max}} - \\text{SOC}_{\\text{min}}}{1 + \\eta^2}\\right) $$\n这个表达式代表了最大的对称调节能量。现在，我们代入数值：\n- $C = 50$ kWh\n- $\\eta = 0.95$\n- $\\text{SOC}_{\\text{max}} = 0.90$\n- $\\text{SOC}_{\\text{min}} = 0.10$\n- $\\text{SOC}_{\\text{max}} - \\text{SOC}_{\\text{min}} = 0.90 - 0.10 = 0.80$\n\n$$ E_{\\text{max}} = \\frac{(50)(0.95)(0.80)}{1 + (0.95)^2} $$\n$$ E_{\\text{max}} = \\frac{40 \\times 0.95}{1 + 0.9025} $$\n$$ E_{\\text{max}} = \\frac{38}{1.9025} $$\n$$ E_{\\text{max}} \\approx 19.97371879... \\text{ kWh} $$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $1$、$9$、$9$ 和 $7$。第五位数字是 $3$，所以我们向下舍入。\n$$ E_{\\text{max}} \\approx 19.97 \\text{ kWh} $$\n这就是可以在不违反SOC边界的情况下持续一小时的最大对称调节能量。",
            "answer": "$$\\boxed{19.97}$$"
        },
        {
            "introduction": "V2G服务绝不能影响车辆的主要功能——出行。这项练习  通过将行程能量需求建模为一个随机变量，引入了现实世界的复杂性。通过基于可靠性目标（例如，$0.95$的置信度）计算最低SOC预留值，您将学会如何在抓住电网服务机遇与确保驾驶员满意度这一关键约束之间取得平衡。",
            "id": "4135623",
            "problem": "一个参与车辆到电网 (V2G) 服务的车队运营商必须设定一个最低荷电状态 (SOC) 预留策略，以确保高可靠性地满足驾驶员的出行需求，同时允许向电网放电。设 SOC 定义为存储能量与电池容量的比值，下一次出行所需的总能量模型化为一个随机出行距离与一个确定性耗电率的乘积。具体来说，假设出行距离随机变量 $D$ 服从正态分布 $D \\sim \\mathcal{N}(30\\,\\text{km}, 10^2\\,\\text{km}^2)$，且能耗率为常数 $r = 0.18\\,\\text{kWh/km}$。设电池容量为 $C_{\\text{bat}} = 60\\,\\text{kWh}$。从概率、分位数和随机变量线性变换的定义出发，制定最低 SOC 预留策略 $\\theta$（一个无量纲的电池容量分数），该策略确保存储的能量满足出行能量需求的概率至少为 $0.95$。推导 $\\theta$ 作为正态分布 $0.95$ 分位数和给定参数的函数的显式表达式，然后根据所提供的数值计算其数值。将最终数值答案四舍五入至四位有效数字。将 SOC 阈值表示为电池容量的无量纲分数。",
            "solution": "该问题要求为一支电动汽车车队制定一个最低荷电状态 (SOC) 预留策略，用 $\\theta$ 表示。该策略必须确保电池中预留的能量足以满足下一次出行的需求，且概率至少为 $0.95$。\n\n首先，我们将给出的变量和参数形式化。\n设 $D$ 为表示出行距离的随机变量，其服从正态分布，均值为 $\\mu_D = 30\\,\\text{km}$，方差为 $\\sigma_D^2 = 10^2\\,\\text{km}^2$。因此，标准差为 $\\sigma_D = 10\\,\\text{km}$。其分布为 $D \\sim \\mathcal{N}(\\mu_D, \\sigma_D^2)$。\n能耗率为确定性常数 $r = 0.18\\,\\text{kWh/km}$。\n总电池容量为 $C_{\\text{bat}} = 60\\,\\text{kWh}$。\n\n出行所需能量 $E_{\\text{trip}}$ 是出行距离和能耗率的乘积：\n$$E_{\\text{trip}} = r \\cdot D$$\n由于 $E_{\\text{trip}}$ 是正态分布随机变量 $D$ 的线性变换，因此 $E_{\\text{trip}}$ 也是一个正态分布随机变量。我们可以如下确定其均值 $\\mu_E$ 和方差 $\\sigma_E^2$：\n$E_{\\text{trip}}$ 的均值为：\n$$\\mu_E = \\mathbb{E}[E_{\\text{trip}}] = \\mathbb{E}[r \\cdot D] = r \\cdot \\mathbb{E}[D] = r \\cdot \\mu_D$$\n$E_{\\text{trip}}$ 的方差为：\n$$\\sigma_E^2 = \\text{Var}(E_{\\text{trip}}) = \\text{Var}(r \\cdot D) = r^2 \\cdot \\text{Var}(D) = r^2 \\cdot \\sigma_D^2$$\n因此，$E_{\\text{trip}}$ 的标准差为 $\\sigma_E = \\sqrt{r^2 \\sigma_D^2} = |r| \\sigma_D$。因为 $r  0$，我们有 $\\sigma_E = r \\sigma_D$。\n所以，出行能量的分布为 $E_{\\text{trip}} \\sim \\mathcal{N}(r \\mu_D, (r \\sigma_D)^2)$。\n\nSOC 预留策略 $\\theta$ 是一个无量纲分数，表示必须预留的电池容量的最小部分。相应的预留能量 $E_{\\text{res}}$ 由下式给出：\n$$E_{\\text{res}} = \\theta \\cdot C_{\\text{bat}}$$\n\n该策略的核心要求是预留能量足以满足出行需求的概率至少为 $0.95$。这可以表示为一个概率表述：\n$$P(E_{\\text{res}} \\ge E_{\\text{trip}}) \\ge 0.95$$\n这等价于：\n$$P(E_{\\text{trip}} \\le E_{\\text{res}}) \\ge 0.95$$\n为了找到最小的 SOC 预留 $\\theta$，我们必须找到满足此条件的最小 $E_{\\text{res}}$。当概率恰好等于阈值时，这种情况发生：\n$$P(E_{\\text{trip}} \\le E_{\\text{res}}) = 0.95$$\n该表述将 $E_{\\text{res}}$ 定义为 $E_{\\text{trip}}$ 分布的 $0.95$ 分位数（或第 $95$ 百分位数）。\n\n为了求得此值，我们可以对随机变量 $E_{\\text{trip}}$ 进行标准化。设 $Z$ 为一个标准正态随机变量，$Z \\sim \\mathcal{N}(0, 1)$。标准化为 $Z = \\frac{E_{\\text{trip}} - \\mu_E}{\\sigma_E}$。概率表述变为：\n$$P\\left(\\frac{E_{\\text{trip}} - \\mu_E}{\\sigma_E} \\le \\frac{E_{\\text{res}} - \\mu_E}{\\sigma_E}\\right) = 0.95$$\n$$P\\left(Z \\le \\frac{E_{\\text{res}} - \\mu_E}{\\sigma_E}\\right) = 0.95$$\n设 $z_{0.95}$ 表示标准正态分布的 $0.95$ 分位数，即满足 $P(Z \\le z_{0.95}) = 0.95$ 的值。我们便得到等式：\n$$\\frac{E_{\\text{res}} - \\mu_E}{\\sigma_E} = z_{0.95}$$\n解出 $E_{\\text{res}}$，我们得到：\n$$E_{\\text{res}} = \\mu_E + z_{0.95} \\cdot \\sigma_E$$\n现在，我们代入 $\\mu_E$ 和 $\\sigma_E$ 的表达式：\n$$E_{\\text{res}} = (r \\cdot \\mu_D) + z_{0.95} \\cdot (r \\cdot \\sigma_D)$$\n我们可以提出能耗率 $r$ 这个公因子：\n$$E_{\\text{res}} = r(\\mu_D + z_{0.95} \\sigma_D)$$\n最后，我们使用 $E_{\\text{res}} = \\theta \\cdot C_{\\text{bat}}$ 将其与 SOC 策略 $\\theta$ 关联起来：\n$$\\theta \\cdot C_{\\text{bat}} = r(\\mu_D + z_{0.95} \\sigma_D)$$\n解出 $\\theta$ 得到最低 SOC 预留策略的显式表达式：\n$$\\theta = \\frac{r(\\mu_D + z_{0.95} \\sigma_D)}{C_{\\text{bat}}}$$\n这是 $\\theta$ 作为给定参数函数的通用公式。\n\n现在我们使用给定的值对此表达式进行数值计算：\n$\\mu_D = 30\\,\\text{km}$\n$\\sigma_D = 10\\,\\text{km}$\n$r = 0.18\\,\\text{kWh/km}$\n$C_{\\text{bat}} = 60\\,\\text{kWh}$\n标准正态分布的 $0.95$ 分位数的值是 $z_{0.95} \\approx 1.64485$。\n\n首先，我们计算所需的能量预留 $E_{\\text{res}}$：\n$$E_{\\text{res}} = 0.18 \\cdot (30 + 1.64485 \\cdot 10) = 0.18 \\cdot (30 + 16.4485)$$\n$$E_{\\text{res}} = 0.18 \\cdot 46.4485 = 8.36073\\,\\text{kWh}$$\n接下来，我们计算 SOC 预留 $\\theta$：\n$$\\theta = \\frac{E_{\\text{res}}}{C_{\\text{bat}}} = \\frac{8.36073}{60}$$\n$$\\theta \\approx 0.1393455$$\n问题要求最终数值答案四舍五入到四位有效数字。\n$$\\theta \\approx 0.1393$$\n因此，必须预留的最低 SOC 约为总电池容量的 $13.93\\%$。",
            "answer": "$$\\boxed{0.1393}$$"
        },
        {
            "introduction": "从单辆车扩展到整个车队管理，需要一种系统性的优化方法。这项高级练习  将指导您构建并求解一个线性规划问题，以最大化车队的总调节容量。它将所有先前学到的概念——SOC动态、功率限制、效率和出行目标——整合到一个统一且实用的优化框架中，这代表了能源系统建模中的一项核心任务。",
            "id": "4135549",
            "problem": "您需要为一个车辆到电网（V2G）服务制定并解决一个日前调度问题，该问题承诺一个统一的、对称的调节容量，同时遵守出行和电池约束。核心目标是确定每个车辆在每个时间的基线充电和放电功率，以及一个可在整个调度周期内维持的单一调节承诺，并受荷电状态（SOC）动态和边界的约束。\n\n您必须构建一个程序，为每个测试用例计算可以在所有时间步长上承诺的最大统一对称调节容量 $r$（单位为千瓦，缩写为 kW），同时确保所有车辆在指定的离开时间前达到其荷电状态（SOC）目标，并在任何时候都保持在 SOC 和功率限制范围内。最终输出必须是单行，包含一个用方括号括起来的逗号分隔列表。列表中的每个元素对应一个测试用例，并且必须是计算出的最优 $r$ 值（单位为 kW），四舍五入到三位小数。如果某个测试用例不可行，则该用例的输出为浮点数 $-1.000$。\n\n定义和基本原理：\n- 车辆到电网（V2G）服务涉及电动汽车与电网之间的双向功率交换。\n- 电池的荷电状态（SOC）定义为存储能量相对于额定容量的分数，范围在 $0$ 和 $1$ 之间。\n- 我们使用能量守恒和标准的电池充放电效率模型来推导 SOC 动态。设 $P_{i,t}^{\\mathrm{ch}} \\ge 0$ 和 $P_{i,t}^{\\mathrm{dis}} \\ge 0$ 分别为车辆 $i$ 在时间 $t$ 的充电和放电基线功率，设 $E_i$ 为电池能量容量（单位为千瓦时，缩写为 kWh）。设 $\\eta_i^{\\mathrm{ch}} \\in (0,1]$ 和 $\\eta_i^{\\mathrm{dis}} \\in (0,1]$ 分别为充电和放电效率，设 $\\Delta t$ 为时间步长（单位为小时）。SOC 根据以下公式更新：\n$$\nSOC_{i,t+1} = SOC_{i,t} + \\frac{\\eta_i^{\\mathrm{ch}} \\Delta t}{E_i} P_{i,t}^{\\mathrm{ch}} - \\frac{\\Delta t}{\\eta_i^{\\mathrm{dis}} E_i} P_{i,t}^{\\mathrm{dis}}.\n$$\n\n调节承诺和裕度：\n- 必须在每个时间步长内都可行一个统一的对称调节容量 $r \\ge 0$。对于每个车辆和时间，设 $p_{i,t}^{\\uparrow} \\ge 0$ 为上调裕度（在整个时间步长内可以维持的、超出基线的额外放电功率），设 $p_{i,t}^{\\downarrow} \\ge 0$ 为下调裕度（超出基线的额外充电功率）。\n- 功率裕量约束要求：\n$$\np_{i,t}^{\\uparrow} + P_{i,t}^{\\mathrm{dis}} \\le P_i^{\\max}, \\quad p_{i,t}^{\\downarrow} + P_{i,t}^{\\mathrm{ch}} \\le P_i^{\\max},\n$$\n其中 $P_i^{\\max}$ 是最大充电或放电功率（单位为 kW）。\n- 荷电状态裕量约束确保调节可以在整个步长内维持：\n$$\nSOC_{i,t} - SOC_i^{\\min} \\ge \\frac{\\Delta t}{\\eta_i^{\\mathrm{dis}} E_i} p_{i,t}^{\\uparrow}, \\quad SOC_i^{\\max} - SOC_{i,t} \\ge \\frac{\\eta_i^{\\mathrm{ch}} \\Delta t}{E_i} p_{i,t}^{\\downarrow}.\n$$\n- 统一调节可行性要求，对于每个时间 $t$：\n$$\nr \\le \\sum_i p_{i,t}^{\\uparrow}, \\quad r \\le \\sum_i p_{i,t}^{\\downarrow}.\n$$\n\n可用性和出行约束：\n- 车辆可用性由二进制参数 $a_{i,t} \\in \\{0,1\\}$ 给出；如果 $a_{i,t} = 0$，则 $P_{i,t}^{\\mathrm{ch}} = 0$, $P_{i,t}^{\\mathrm{dis}} = 0$, $p_{i,t}^{\\uparrow} = 0$, 且 $p_{i,t}^{\\downarrow} = 0$。\n- 在离开时间 $t = t_i^{\\mathrm{dep}}$，每辆车必须满足：\n$$\nSOC_{i,t_i^{\\mathrm{dep}}} \\ge SOC_i^{\\mathrm{target}}.\n$$\n- SOC 边界必须在所有时间 $t$ 内都成立：\n$$\nSOC_i^{\\min} \\le SOC_{i,t} \\le SOC_i^{\\max}.\n$$\n\n优化问题的决策变量是所有车辆和时间点的 $P_{i,t}^{\\mathrm{ch}}$, $P_{i,t}^{\\mathrm{dis}}$, $p_{i,t}^{\\uparrow}$, $p_{i,t}^{\\downarrow}$, $SOC_{i,t}$，以及统一调节容量 $r$。目标是最大化 $r$，并服从上述所有约束。由于所有约束和目标函数都是决策变量的线性函数，因此该问题可以被表述为一个线性规划问题。\n\n单位：\n- 功率变量 $P_{i,t}^{\\mathrm{ch}}$, $P_{i,t}^{\\mathrm{dis}}$, $p_{i,t}^{\\uparrow}$, $p_{i,t}^{\\downarrow}$ 和 $r$ 的单位是千瓦（kW）。\n- 能量容量 $E_i$ 的单位是千瓦时（kWh）。\n- 时间步长 $\\Delta t$ 的单位是小时。\n- 荷电状态 $SOC_{i,t}$ 是无单位的，表示为 $\\in [0,1]$ 的分数。\n- 效率 $\\eta_i^{\\mathrm{ch}}$ 和 $\\eta_i^{\\mathrm{dis}}$ 是无单位的分数 $\\in (0,1]$。\n\n您的程序必须为每个测试用例求解线性规划问题，并输出得到的 $r$ 值，四舍五入到三位小数。如果某个测试用例不可行，则该用例的输出为浮点数 $-1.000$。\n\n测试套件和参数：\n- 测试用例 1（一般情况，多辆车，完全可用）：\n    - 车辆数 $N = 2$，时域长度 $T = 4$，$\\Delta t = 1$。\n    - 车辆 1：$E_1 = 60$ kWh, $P_1^{\\max} = 7$ kW, $\\eta_1^{\\mathrm{ch}} = 0.95$, $\\eta_1^{\\mathrm{dis}} = 0.95$, $SOC_1^{\\min} = 0.10$, $SOC_1^{\\max} = 0.90$, $SOC_{1,0} = 0.30$, $t_1^{\\mathrm{dep}} = 4$, $SOC_1^{\\mathrm{target}} = 0.60$，在所有 $t \\in \\{0,1,2,3\\}$ 内可用性 $a_{1,t} = 1$。\n    - 车辆 2：$E_2 = 40$ kWh, $P_2^{\\max} = 7$ kW, $\\eta_2^{\\mathrm{ch}} = 0.95$, $\\eta_2^{\\mathrm{dis}} = 0.95$, $SOC_2^{\\min} = 0.10$, $SOC_2^{\\max} = 0.90$, $SOC_{2,0} = 0.25$, $t_2^{\\mathrm{dep}} = 4$, $SOC_2^{\\mathrm{target}} = 0.50$，在所有 $t \\in \\{0,1,2,3\\}$ 内可用性 $a_{2,t} = 1$。\n- 测试用例 2（边界 SOC 接近 $SOC^{\\max}$ 限制下调调节）：\n    - 车辆数 $N = 1$，时域长度 $T = 3$，$\\Delta t = 1$。\n    - 车辆 1：$E_1 = 75$ kWh, $P_1^{\\max} = 11$ kW, $\\eta_1^{\\mathrm{ch}} = 0.95$, $\\eta_1^{\\mathrm{dis}} = 0.95$, $SOC_1^{\\min} = 0.15$, $SOC_1^{\\max} = 0.90$, $SOC_{1,0} = 0.88$, $t_1^{\\mathrm{dep}} = 3$, $SOC_1^{\\mathrm{target}} = 0.86$，在所有 $t \\in \\{0,1,2\\}$ 内可用性 $a_{1,t} = 1$。\n- 测试用例 3（由于可用性不足以达到目标而导致边缘不可行）：\n    - 车辆数 $N = 1$，时域长度 $T = 2$，$\\Delta t = 1$。\n    - 车辆 1：$E_1 = 50$ kWh, $P_1^{\\max} = 7$ kW, $\\eta_1^{\\mathrm{ch}} = 0.95$, $\\eta_1^{\\mathrm{dis}} = 0.95$, $SOC_1^{\\min} = 0.10$, $SOC_1^{\\max} = 0.90$, $SOC_{1,0} = 0.20$, $t_1^{\\mathrm{dep}} = 2$, $SOC_1^{\\mathrm{target}} = 0.90$，可用性 $a_{1,0} = 1$, $a_{1,1} = 0$。\n\n最终输出格式要求：\n- 您的程序应生成一行输出，其中包含三个测试用例的结果，形式为用方括号括起来的逗号分隔列表，例如 $\\left[ r_1, r_2, r_3 \\right]$，其中每个 $r_k$ 是最优的统一调节容量（单位 kW），四舍五入到三位小数，如果不可行则为 $-1.000$。输出单位为千瓦（kW）。",
            "solution": "该问题要求制定并求解一个优化问题，以找到一个电动汽车（EV）车队在有限时间范围内可以提供的最大统一对称调节容量，记为 $r$。该问题明确地由一组线性约束和一个线性目标函数定义，因此属于线性规划（LP）问题。\n\n问题的核心是为每个车辆 $i$ 在每个时间步 $t$ 做出决策，决定其基线充电功率 $P_{i,t}^{\\mathrm{ch}}$ 和放电功率 $P_{i,t}^{\\mathrm{dis}}$，以及它可以提供的调节裕度：上调裕度 $p_{i,t}^{\\uparrow}$（额外的放电容量）和下调裕度 $p_{i,t}^{\\downarrow}$（额外的充电容量）。这些决策必须尊重电动汽车电池和充电设备的物理限制，并确保每辆车满足其未来的出行能量需求。\n\n首先，我们定义优化问题的决策变量集。对于每个车辆 $i \\in \\{1, \\ldots, N\\}$ 和每个时间步 $t \\in \\{0, \\ldots, T-1\\}$（其中 $T$ 是时域内的时间步数），我们有：\n- $P_{i,t}^{\\mathrm{ch}} \\ge 0$：基线充电功率。\n- $P_{i,t}^{\\mathrm{dis}} \\ge 0$：基线放电功率。\n- $p_{i,t}^{\\uparrow} \\ge 0$：上调调节功率裕度。\n- $p_{i,t}^{\\downarrow} \\ge 0$：下调调节功率裕度。\n- $SOC_{i,t+1}$：时间步 $t$ 结束时（或 $t+1$ 开始时）的荷电状态。\n\n此外，我们有一个全局决策变量：\n- $r \\ge 0$：整个车队在所有时间步上的统一对称调节容量。\n\n目标是最大化这个单一变量 $r$：\n$$\n\\text{maximize} \\quad r\n$$\n\n这个目标受到几类线性约束的限制，这些约束模拟了系统的物理特性和操作要求。\n\n1.  **荷电状态（SOC）动态**：每个车辆电池 SOC 的演变由能量平衡决定。时间步 $t+1$ 开始时的 SOC 由时间步 $t$ 开始时的 SOC 和在时间间隔 $\\Delta t$ 内的净能量流决定。\n    $$\n    SOC_{i,t+1} = SOC_{i,t} + \\frac{\\eta_i^{\\mathrm{ch}} \\Delta t}{E_i} P_{i,t}^{\\mathrm{ch}} - \\frac{\\Delta t}{\\eta_i^{\\mathrm{dis}} E_i} P_{i,t}^{\\mathrm{dis}} \\quad \\forall i, t\n    $$\n    这里，$E_i$ 是电池容量，$\\eta_i^{\\mathrm{ch}}, \\eta_i^{\\mathrm{dis}}$ 是充电和放电效率。注意，$SOC_{i,0}$ 是每个车辆的给定初始条件。这些方程构成一组线性等式约束。\n\n2.  **SOC 边界**：每个车辆电池的 SOC 必须始终保持在其操作限制范围内。\n    $$\n    SOC_i^{\\min} \\le SOC_{i,t} \\le SOC_i^{\\max} \\quad \\forall i, t \\in \\{1, \\ldots, T\\}\n    $$\n    这些被实现为对 $SOC_{i,t}$ 决策变量的下界和上界。\n\n3.  **出行要求**：每个车辆必须在其预定的离开时间 $t_i^{\\mathrm{dep}}$ 之前有足够的能量。\n    $$\n    SOC_{i,t_i^{\\mathrm{dep}}} \\ge SOC_i^{\\mathrm{target}} \\quad \\forall i\n    $$\n    这是对每个车辆连接期间的最终 SOC 变量的一个线性不等式约束。\n\n4.  **功率限制**：车辆从电网汲取或向电网注入的总功率不能超过其最大功率额定值 $P_i^{\\max}$。这适用于基线功率与任何潜在调节功率之和。\n    $$\n    p_{i,t}^{\\uparrow} + P_{i,t}^{\\mathrm{dis}} \\le P_i^{\\max} \\quad \\forall i, t\n    $$\n    $$\n    p_{i,t}^{\\downarrow} + P_{i,t}^{\\mathrm{ch}} \\le P_i^{\\max} \\quad \\forall i, t\n    $$\n    此外，所有功率变量都是非负的。同时，充电和放电不会同时发生也是隐含的，在没有明确的能源成本套利机会的情况下，寻求最优解的 LP 求解器会自然满足这一条件。我们还将基线功率本身限制在 $[0, P_i^{\\max}]$ 范围内。\n\n5.  **来自 SOC 的调节裕量**：车辆可提供的调节裕度受其当前 SOC 的限制。车辆必须能够在整个时长 $\\Delta t$ 内维持调节功率，而不违反其 SOC 限制。\n    - 对于上调调节（放电），起始 SOC 必须足够高以提供能量：\n      $$\n      SOC_{i,t} - SOC_i^{\\min} \\ge \\frac{\\Delta t}{\\eta_i^{\\mathrm{dis}} E_i} p_{i,t}^{\\uparrow} \\quad \\forall i, t\n      $$\n    - 对于下调调节（充电），起始 SOC 必须足够低以吸收能量：\n      $$\n      SOC_i^{\\max} - SOC_{i,t} \\ge \\frac{\\eta_i^{\\mathrm{ch}} \\Delta t}{E_i} p_{i,t}^{\\downarrow} \\quad \\forall i, t\n      $$\n    这些不等式将调节裕度 $p_{i,t}^{\\uparrow}, p_{i,t}^{\\downarrow}$ 与状态变量 $SOC_{i,t}$ 联系起来。\n\n6.  **车队级调节承诺**：核心约束是承诺的调节容量 $r$ 必须在所有时间都可用。这意味着在每个时间步，单个车辆贡献的总和必须达到或超过 $r$，无论上调还是下调服务。\n    $$\n    r \\le \\sum_{i=1}^{N} p_{i,t}^{\\uparrow} \\quad \\forall t\n    $$\n    $$\n    r \\le \\sum_{i=1}^{N} p_{i,t}^{\\downarrow} \\quad \\forall t\n    $$\n\n7.  **车辆可用性**：如果车辆 $i$ 在时间 $t$ 不可用（由 $a_{i,t}=0$ 表示），它不能提供任何服务。这通过将其功率变量设置为零来强制执行。\n    $$\n    P_{i,t}^{\\mathrm{ch}} = 0, \\quad P_{i,t}^{\\mathrm{dis}} = 0, \\quad p_{i,t}^{\\uparrow} = 0, \\quad p_{i,t}^{\\downarrow} = 0 \\quad \\text{if } a_{i,t}=0\n    $$\n    最好通过将这些变量的上界设置为 0 来实现。\n\n为了求解这个 LP 问题，我们使用 `scipy.optimize.linprog` 函数，它要求问题是标准形式：最小化 $\\mathbf{c}^T \\mathbf{x}$，满足 $\\mathbf{A}_{ub} \\mathbf{x} \\le \\mathbf{b}_{ub}$，$\\mathbf{A}_{eq} \\mathbf{x} = \\mathbf{b}_{eq}$，和 $\\mathbf{l} \\le \\mathbf{x} \\le \\mathbf{u}$。我们将所有决策变量展平成一个单一向量 $\\mathbf{x}$，并为目标函数、约束和边界构建相应的矩阵和向量。最大化 $r$ 等同于最小化 $-r$。如果求解器报告问题不可行，这意味着没有调度可以满足所有约束，我们报告值为 $-1.0$。否则，最优的 $r$ 值是求解器返回的目标函数值的相反数。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Defines test cases and computes the maximal uniform symmetric regulation capacity for each.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 2, \"T\": 4, \"dt\": 1.0,\n            \"vehicles\": [\n                {\n                    \"E\": 60.0, \"P_max\": 7.0, \"eta_ch\": 0.95, \"eta_dis\": 0.95,\n                    \"SOC_min\": 0.10, \"SOC_max\": 0.90, \"SOC_0\": 0.30,\n                    \"t_dep\": 4, \"SOC_target\": 0.60, \"a\": [1, 1, 1, 1]\n                },\n                {\n                    \"E\": 40.0, \"P_max\": 7.0, \"eta_ch\": 0.95, \"eta_dis\": 0.95,\n                    \"SOC_min\": 0.10, \"SOC_max\": 0.90, \"SOC_0\": 0.25,\n                    \"t_dep\": 4, \"SOC_target\": 0.50, \"a\": [1, 1, 1, 1]\n                }\n            ]\n        },\n        {\n            \"N\": 1, \"T\": 3, \"dt\": 1.0,\n            \"vehicles\": [\n                {\n                    \"E\": 75.0, \"P_max\": 11.0, \"eta_ch\": 0.95, \"eta_dis\": 0.95,\n                    \"SOC_min\": 0.15, \"SOC_max\": 0.90, \"SOC_0\": 0.88,\n                    \"t_dep\": 3, \"SOC_target\": 0.86, \"a\": [1, 1, 1]\n                }\n            ]\n        },\n        {\n            \"N\": 1, \"T\": 2, \"dt\": 1.0,\n            \"vehicles\": [\n                {\n                    \"E\": 50.0, \"P_max\": 7.0, \"eta_ch\": 0.95, \"eta_dis\": 0.95,\n                    \"SOC_min\": 0.10, \"SOC_max\": 0.90, \"SOC_0\": 0.20,\n                    \"t_dep\": 2, \"SOC_target\": 0.90, \"a\": [1, 0]\n                }\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_lp_case(case)\n        results.append(f\"{result:.3f}\")\n    \n    print(f\"[{','.join(results)}]\")\n\ndef _solve_lp_case(case_params):\n    \"\"\"\n    Formulates and solves the linear program for a single test case.\n    \"\"\"\n    N = case_params['N']\n    T = case_params['T']\n    dt = case_params['dt']\n    vehicles = case_params['vehicles']\n\n    # ----- 1. Define decision variables and their indices -----\n    # Variable vector x: [Pch, Pdis, Pup, Pdown, SOC, r]\n    num_vars = 5 * N * T + 1\n    \n    def idx_pch(i, t): return i * T + t\n    def idx_pdis(i, t): return N * T + i * T + t\n    def idx_pup(i, t): return 2 * N * T + i * T + t\n    def idx_pdown(i, t): return 3 * N * T + i * T + t\n    def idx_soc(i, t_plus_1): return 4 * N * T + i * T + (t_plus_1 - 1)\n    idx_r = 5 * N * T\n\n    # ----- 2. Define the objective function (minimize -r) -----\n    c = np.zeros(num_vars)\n    c[idx_r] = -1\n\n    # ----- 3. Define constraints -----\n    # -- Equality constraints (SOC dynamics) --\n    num_eq_constraints = N * T\n    A_eq = np.zeros((num_eq_constraints, num_vars))\n    b_eq = np.zeros(num_eq_constraints)\n\n    for i in range(N):\n        v = vehicles[i]\n        k_ch = (v['eta_ch'] * dt) / v['E']\n        k_dis = dt / (v['eta_dis'] * v['E'])\n        for t in range(T):\n            row_idx = i * T + t\n            A_eq[row_idx, idx_soc(i, t + 1)] = 1\n            A_eq[row_idx, idx_pch(i, t)] = -k_ch\n            A_eq[row_idx, idx_pdis(i, t)] = k_dis\n            if t == 0:\n                b_eq[row_idx] = v['SOC_0']\n            else:\n                A_eq[row_idx, idx_soc(i, t)] = -1\n                b_eq[row_idx] = 0\n\n    # -- Inequality constraints --\n    A_ub_list = []\n    b_ub_list = []\n\n    for i in range(N):\n        v = vehicles[i]\n        for t in range(T):\n            # Power headroom\n            row_dis = np.zeros(num_vars); row_dis[idx_pdis(i, t)] = 1; row_dis[idx_pup(i, t)] = 1\n            A_ub_list.append(row_dis); b_ub_list.append(v['P_max'])\n            row_ch = np.zeros(num_vars); row_ch[idx_pch(i, t)] = 1; row_ch[idx_pdown(i, t)] = 1\n            A_ub_list.append(row_ch); b_ub_list.append(v['P_max'])\n            \n            # SOC headroom\n            C_up = (v['eta_dis'] * v['E']) / dt\n            row_up = np.zeros(num_vars); row_up[idx_pup(i, t)] = 1\n            if t == 0: b_ub_list.append(C_up * (v['SOC_0'] - v['SOC_min']))\n            else: row_up[idx_soc(i, t)] = -C_up; b_ub_list.append(-C_up * v['SOC_min'])\n            A_ub_list.append(row_up)\n\n            C_down = (v['E'] / (v['eta_ch'] * dt))\n            row_down = np.zeros(num_vars); row_down[idx_pdown(i, t)] = 1\n            if t == 0: b_ub_list.append(C_down * (v['SOC_max'] - v['SOC_0']))\n            else: row_down[idx_soc(i, t)] = C_down; b_ub_list.append(C_down * v['SOC_max'])\n            A_ub_list.append(row_down)\n\n    # Uniform regulation capacity\n    for t in range(T):\n        row_up_sum = np.zeros(num_vars); row_up_sum[idx_r] = 1\n        for i in range(N): row_up_sum[idx_pup(i, t)] = -1\n        A_ub_list.append(row_up_sum); b_ub_list.append(0)\n\n        row_down_sum = np.zeros(num_vars); row_down_sum[idx_r] = 1\n        for i in range(N): row_down_sum[idx_pdown(i, t)] = -1\n        A_ub_list.append(row_down_sum); b_ub_list.append(0)\n\n    # Target SOC\n    for i in range(N):\n        v = vehicles[i]\n        row_target = np.zeros(num_vars); row_target[idx_soc(i, v['t_dep'])] = -1\n        A_ub_list.append(row_target); b_ub_list.append(-v['SOC_target'])\n        \n    A_ub = np.array(A_ub_list)\n    b_ub = np.array(b_ub_list)\n\n    # -- Bounds --\n    bounds = []\n    for var_group in range(4): # Pch, Pdis, Pup, Pdown\n        for i in range(N):\n            v = vehicles[i]\n            for t in range(T):\n                ub = v['P_max'] if v['a'][t] == 1 else 0\n                bounds.append((0, ub))\n    for i in range(N): # SOC\n        v = vehicles[i]\n        for _ in range(T):\n            bounds.append((v['SOC_min'], v['SOC_max']))\n    bounds.append((0, None)) # r\n    \n    # ----- 4. Solve the LP -----\n    res = linprog(c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        return -res.fun # Maximized r\n    else:\n        return -1.0\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}