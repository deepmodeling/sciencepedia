{
    "hands_on_practices": [
        {
            "introduction": "对气候风险的理解始于对单个系统组件如何响应极端天气的建模。本练习聚焦于光伏（PV）系统，其输出功率对温度高度敏感。通过从传热学的基本原理出发，您将推导出一个物理驱动的光伏输出功率模型()。这项实践使您能够具体理解热浪事件如何降低太阳能发电能力，这是任何系统级压力测试的关键输入。",
            "id": "4077987",
            "problem": "一个公用事业规模的光伏(PV)阵列正在一个并网电力系统的热浪压力测试情景下进行评估。目标是推导出一个以辐照度和温度为函数的、具有物理基础的阵列电功率表达式，然后计算在压力事件期间的预期输出。\n\n假设以下基本要素：\n\n- 在标准测试条件(STC)下，定义为电池温度 $T_{STC} = 298\\ \\mathrm{K}$ 和阵列平面辐照度 $G_{STC} = 1000\\ \\mathrm{W/m^2}$，阵列的电功率为 $P_{STC} = 4.5\\ \\mathrm{kW}$。\n- 阵列对电池温度 $T_c$ 的电功率响应，可以通过围绕 $T_{STC}$ 的一阶线性化来近似，其中使用已知的温度系数 $\\gamma$ (单位为 $\\mathrm{K^{-1}}$)，当 $\\gamma  0$ 时，增加 $T_c$ 会降低功率。\n- 组件电池温度 $T_c$ 由吸收的太阳能功率与向环境空气的对流热损失之间的能量平衡决定，该过程由一个广泛使用的、通过传热系数参数化的稳态热模型表示。\n\n仅从这些要素出发，不使用任何快捷公式，完成以下任务：\n\n1. 推导光伏阵列电功率 $P$ 作为辐照度 $G$、环境空气温度 $T_a$ 和风速 $v$ 的函数表达式，该表达式应使用 $P_{STC}$、$G_{STC}$、$T_{STC}$、$\\gamma$、组件电效率 $\\eta$ 以及传热系数 $U_0$ 和 $U_1$ 表示。你的推导必须从组件的热平衡和围绕 $T_{STC}$ 的电功率一阶近似出发。\n2. 使用你推导的表达式，计算在热浪情景下的阵列功率，参数为：环境空气温度 $T_a = 310\\ \\mathrm{K}$，风速 $v = 0.5\\ \\mathrm{m/s}$，辐照度 $G = 950\\ \\mathrm{W/m^2}$，温度系数 $\\gamma = -0.004\\ \\mathrm{K^{-1}}$，组件效率 $\\eta = 0.18$，以及热系数 $U_0 = 20\\ \\mathrm{W/(m^2\\cdot K)}$ 和 $U_1 = 6\\ \\mathrm{W/(m^2\\cdot K)}$。\n3. 在气候风险压力测试的背景下，简要讨论 $\\gamma$、$\\eta$、$U_0$ 和 $U_1$ 的物理上合理的选择，包括它们的值如何影响功率 $P$ 对热浪的敏感性。\n\n将你计算出的最终 $P$ 值四舍五入至四位有效数字，并以 $\\mathrm{kW}$ 为单位表示。",
            "solution": "所述问题具有科学依据、提法得当、客观，并包含足够的信息以获得唯一解。它基于光伏器件物理和传热学的既定第一性原理。因此，该问题被认为是有效的。\n\n解答按要求分为三部分：功率表达式的推导、特定情景的数值计算，以及模型参数的物理讨论。\n\n### 第1部分：光伏阵列电功率表达式的推导\n\n推导过程从两个基础模型开始：用于功率输出的电学模型和用于电池温度的热学模型。\n\n**1. 电功率模型**\n光伏(PV)阵列的电功率输出 $P$ 主要与入射的阵列平面太阳辐照度 $G$ 成正比。在标准测试条件(STC)下，当辐照度为 $G_{STC}$、电池温度为 $T_{STC}$ 时，功率为 $P_{STC}$。如果电池温度保持在 $T_{STC}$ 不变，那么在不同辐照度 $G$ 下的功率将由以下比例关系给出：\n$$ P'(G) = P_{STC} \\frac{G}{G_{STC}} $$\n然而，光伏电池的电性能会随着温度的升高而下降。问题指明，这种依赖关系可以通过围绕参考温度 $T_{STC}$ 的一阶线性化来建模。这通过功率温度系数 $\\gamma$ 来表示，其单位为 $\\mathrm{K^{-1}}$，且通常为负值。因此，在电池温度为 $T_c$、辐照度为 $G$ 时的功率 $P$ 为：\n$$ P(G, T_c) = P'(G) \\left[ 1 + \\gamma (T_c - T_{STC}) \\right] $$\n将 $P'(G)$ 的表达式代入，得到功率作为辐照度和电池温度的函数：\n$$ P(G, T_c) = P_{STC} \\frac{G}{G_{STC}} \\left[ 1 + \\gamma (T_c - T_{STC}) \\right] $$\n这个方程还不是最终形式，因为它依赖于内部变量 $T_c$。下一步是将 $T_c$ 用外部环境条件来表示。\n\n**2. 电池温度($T_c$)的热学模型**\n电池温度 $T_c$ 由稳态能量平衡决定。在稳态下，组件内部产生的热能等于散失到周围环境的热量。\n\n*   **热量产生($Q_{gen}$):** 面积为 $A$ 的组件上的入射太阳辐射提供的功率等于 $G \\cdot A$。这部分功率的一部分（由组件的电效率 $\\eta$ 描述）被转换成电能 $P_{elec} = \\eta G A$。入射能量的其余部分被转换成必须散发的热能。因此，热量产生率为：\n    $$ Q_{gen} = G A - P_{elec} = G A - \\eta G A = G A (1 - \\eta) $$\n*   **热量散失($Q_{loss}$):** 热量通过对流和辐射从组件表面散失到环境空气（温度为 $T_a$）中。这个过程使用牛顿冷却定律来建模，其中热损失率与电池和环境空气之间的温差 $(T_c - T_a)$ 以及总传热系数 $U_L$ 成正比。\n    $$ Q_{loss} = U_L A (T_c - T_a) $$\n    问题指明 $U_L$ 是风速 $v$ 的线性函数，由系数 $U_0$（代表与风速无关的传热，如辐射和自然对流）和 $U_1$（代表强制对流）参数化：\n    $$ U_L = U_0 + U_1 v $$\n    将此代入热损失方程得到：\n    $$ Q_{loss} = (U_0 + U_1 v) A (T_c - T_a) $$\n\n*   **稳态能量平衡：** 令热量产生与热量散失相等 ($Q_{gen} = Q_{loss}$):\n    $$ G A (1 - \\eta) = (U_0 + U_1 v) A (T_c - T_a) $$\n    未给出的组件面积 $A$ 很方便地从方程两边消去。我们现在可以解出电池温度 $T_c$：\n    $$ G (1 - \\eta) = (U_0 + U_1 v) (T_c - T_a) $$\n    $$ T_c - T_a = \\frac{G(1 - \\eta)}{U_0 + U_1 v} $$\n    $$ T_c = T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} $$\n\n**3. 最终功率表达式**\n最后，我们将推导出的 $T_c$ 表达式代入电功率模型，得到光伏功率 $P$ 作为自变量 $G$、$T_a$ 和 $v$ 的函数：\n$$ P(G, T_a, v) = P_{STC} \\frac{G}{G_{STC}} \\left[ 1 + \\gamma \\left( \\left( T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} \\right) - T_{STC} \\right) \\right] $$\n这就是所要求的具有物理基础的表达式。\n\n### 第2部分：热浪情景下阵列功率的计算\n\n现在我们使用推导的公式和给定的参数来计算阵列功率。\n给定的值为：\n$P_{STC} = 4.5\\ \\mathrm{kW}$\n$G_{STC} = 1000\\ \\mathrm{W/m^2}$\n$T_{STC} = 298\\ \\mathrm{K}$\n$G = 950\\ \\mathrm{W/m^2}$\n$T_a = 310\\ \\mathrm{K}$\n$v = 0.5\\ \\mathrm{m/s}$\n$\\gamma = -0.004\\ \\mathrm{K^{-1}}$\n$\\eta = 0.18$\n$U_0 = 20\\ \\mathrm{W/(m^2\\cdot K)}$\n$U_1 = 6\\ \\mathrm{W/(m^2\\cdot K)}$\n\n首先，我们计算热浪条件下的电池温度 $T_c$：\n$$ T_c = T_a + \\frac{G(1 - \\eta)}{U_0 + U_1 v} = 310 + \\frac{950(1 - 0.18)}{20 + 6(0.5)} $$\n$$ T_c = 310 + \\frac{950(0.82)}{20 + 3} = 310 + \\frac{779}{23} $$\n$$ T_c \\approx 310 + 33.869565\\ \\mathrm{K} = 343.869565\\ \\mathrm{K} $$\n\n接下来，我们用这个电池温度计算功率 $P$：\n$$ P = P_{STC} \\frac{G}{G_{STC}} \\left[ 1 + \\gamma (T_c - T_{STC}) \\right] $$\n$$ P = 4.5\\ \\mathrm{kW} \\times \\frac{950}{1000} \\left[ 1 + (-0.004) (343.869565 - 298) \\right] $$\n$$ P = 4.275\\ \\mathrm{kW} \\times \\left[ 1 - 0.004 (45.869565) \\right] $$\n$$ P = 4.275\\ \\mathrm{kW} \\times \\left[ 1 - 0.183478 \\right] $$\n$$ P = 4.275\\ \\mathrm{kW} \\times 0.816522 $$\n$$ P \\approx 3.491413\\ \\mathrm{kW} $$\n四舍五入到四位有效数字，热浪情景下的预期阵列功率为 $3.491\\ \\mathrm{kW}$。\n\n### 第3部分：模型参数的物理讨论\n\n下面简要讨论参数 $\\gamma$、$\\eta$、$U_0$ 和 $U_1$ 及其在热浪期间对系统性能的影响。\n\n*   **$\\gamma$，功率温度系数：** 此参数量化了光伏组件功率输出对其工作温度变化的敏感性。对于主导市场的晶体硅技术，$\\gamma$ 的典型范围为 $-0.003\\ \\mathrm{K^{-1}}$ 到 $-0.005\\ \\mathrm{K^{-1}}$。给定值 $-0.004\\ \\mathrm{K^{-1}}$ 是一个标准值。一个更负的值（即更大的绝对值）意味着温度每升高一度，功率损失更大。在气候风险压力测试的背景下，对于给定的技术，选择一个在其合理范围内更敏感端的值（例如 $-0.005\\ \\mathrm{K^{-1}}$）构成了对热浪影响的保守、最坏情况的假设。\n\n*   **$\\eta$，组件电效率：** 这代表了转换成电能的入射太阳能的比例。对于现代公用事业规模的硅组件，$\\eta$ 通常在 $0.18$ 到 $0.22$（$18\\%$ 到 $22\\%$）之间。值 $\\eta = 0.18$ 是合理的。从热学模型来看，更高的 $\\eta$ 意味着更小比例的太阳能 $(1-\\eta)$ 被转换成废热。这会导致更低的工作电池温度 $T_c$。因此，更高效率的组件天生运行温度更低，受温度引起的功率衰减影响也稍小。对于压力测试，为所建模的技术使用一个处于下限但符合实际的效率是一个保守的选择，因为它会预测更高的电池温度，从而在热浪期间导致更大的功率损失。\n\n*   **$U_0$ 和 $U_1$，传热系数：** 这些系数定义了组件的散热能力。$U_0$ 捕捉了辐射和自然对流冷却，而 $U_1$ 则模拟了风引起的强制对流冷却。它们的值高度依赖于组件的安装方式；具有良好空气流通的开放式支架安装将比气流受限的屋顶集成系统具有更高的 $U_0$ 和 $U_1$ 值。对于典型的开放式支架安装，$U_0$ 通常在 $20-30\\ \\mathrm{W/(m^2\\cdot K)}$ 范围内，$U_1$ 在 $2-7\\ \\mathrm{W/(m^2\\cdot K)}$ 范围内。所提供的值（$U_0 = 20\\ \\mathrm{W/(m^2\\cdot K)}$，$U_1 = 6\\ \\mathrm{W/(m^2\\cdot K)}$）在物理上是合理的。较低的 $U_0$ 和 $U_1$ 值意味着较差的散热能力，导致更高的电池温度和更大的功率损失。热浪通常与静止空气（低风速 $v$）相关，这会减小 $U_1$ 项的贡献，并使系统性能严重依赖于 $U_0$。对于保守的压力测试，应选择对应于通风不良的安装配置的 $U_0$ 和 $U_1$ 值，从而使预测的温升最大化。",
            "answer": "$$\\boxed{3.491}$$"
        },
        {
            "introduction": "在完成对单个组件的建模后，下一步是评估整个电力系统的可靠性。本练习引入了“期望缺供时数”（Loss of Load Expectation, LOLE），这是一个衡量电力系统充裕度的核心概率性指标。该练习将综合考虑温度对电力需求和发电容量两方面的影响()。通过计算热浪期间的增量LOLE，您将学会如何量化整个系统的脆弱性，并将气候情景转化为一个具体的电网风险度量。",
            "id": "4078015",
            "problem": "考虑一个遭受热浪事件的单区域电力系统。负荷损失期望（Loss of Load Expectation, LOLE）定义为负荷超过可用发电容量的概率在时间上的积分。形式上，对于以 $t$ 为索引的时间，在事件窗口 $\\mathcal{T}$ 内的 LOLE 为\n$$\n\\mathrm{LOLE} \\;=\\; \\int_{t \\in \\mathcal{T}} \\mathbb{P}\\!\\left( D(t) \\;\\; C(t) \\right)\\, dt,\n$$\n其中 $D(t)$ 是电力需求，$C(t)$ 是可用容量。由热浪引起的增量 LOLE 是在热浪温度下计算的 LOLE 与在基准温度条件下同一时间窗口内计算的 LOLE 之差。在本问题中，您将使用需求和容量的概率模型，在考虑温度引起的降额情况下计算此增量 LOLE。\n\n假设对于每个小时 $t$：\n- 需求 $D(t)$ 被建模为一个高斯（正态）随机变量，其均值为 $\\mu_D(T(t))$，标准差为 $\\sigma_D$，其中温度 $T(t)$ 线性地改变均值：\n$$\n\\mu_D(T(t)) \\;=\\; \\mu_{D,0} \\;+\\; \\beta \\cdot \\left(T(t) - T_0\\right).\n$$\n- 可用容量 $C(t)$ 被建模为一个高斯（正态）随机变量，其均值为 $\\mu_C(T(t))$，标准差为 $\\sigma_C$，其均值受温度影响发生分数降额，该降额与温度相对于基准 $T_0$ 的偏差呈线性关系：\n$$\n\\mu_C(T(t)) \\;=\\; \\mu_{C,0} \\cdot \\left( 1 \\;-\\; \\gamma \\cdot \\left(T(t) - T_0\\right) \\right).\n$$\n- 参数 $\\mu_{D,0}$ 和 $\\mu_{C,0}$ 是在基准温度 $T_0$ 下的基准均值。系数 $\\beta$（单位为 $\\mathrm{MW}/^{\\circ}\\mathrm{C}$）和 $\\gamma$（单位为 $1/^{\\circ}\\mathrm{C}$）分别代表需求敏感度和容量降额系数。标准差 $\\sigma_D$ 和 $\\sigma_C$ 的单位是 $\\mathrm{MW}$。\n- 在给定温度的条件下，$D(t)$ 和 $C(t)$ 在统计上是独立的。\n\n设基准 LOLE 是在同一时间范围内，使用对所有小时 $t \\in \\mathcal{T}$ 均有 $T(t) = T_0$ 以及相同的 $\\mu_{D,0}$、$\\mu_{C,0}$、$\\sigma_D$ 和 $\\sigma_C$ 计算得出的。设热浪 LOLE 是使用每个测试用例中指定的逐小时温度 $T(t)$ 计算得出的。增量 LOLE 定义为\n$$\n\\Delta \\mathrm{LOLE} \\;=\\; \\mathrm{LOLE}_{\\text{heatwave}} \\;-\\; \\mathrm{LOLE}_{\\text{baseline}}.\n$$\n\n单位和输出要求：\n- 所有需求和容量参数的单位均为 $\\mathrm{MW}$。\n- 温度单位为摄氏度 ($^{\\circ}\\mathrm{C}$)。\n- 时间单位为小时 ($\\mathrm{h}$)。LOLE 和增量 LOLE 必须以 $\\mathrm{h}$ 为单位，作为实数（浮点数）报告。\n- 最终输出必须是单行，包含所有测试用例的增量 LOLE 值的逗号分隔列表，并用方括号括起来，例如 $[x_1,x_2,x_3]$。输出中不要包含任何单位或附加文本。每个条目必须是浮点数。\n\n您的程序必须通过以下方式计算增量 LOLE：对每个小时 $t$，根据指定的高斯模型评估概率 $\\mathbb{P}\\!\\left(D(t)  C(t)\\right)$，然后以给定的时间步长 $\\Delta t$（单位为小时）在事件窗口内求和。对于基准 LOLE，在事件窗口内的所有 $t$ 都使用 $T(t) = T_0$。处理 $\\sigma_D^2 + \\sigma_C^2 = 0$ 的边界情况，此时如果 $\\mu_D(T(t))  \\mu_C(T(t))$，则将概率 $\\mathbb{P}\\!\\left(D(t)  C(t)\\right)$ 视为 $1$；如果相等，则视为 $0.5$；否则视为 $0$。\n\n测试套件：\n为以下五个参数集计算 $\\Delta \\mathrm{LOLE}$。每个用例提供 $(\\mu_{C,0}, \\sigma_C, \\mu_{D,0}, \\sigma_D, \\gamma, \\beta, T_0, \\Delta t, \\{T(t)\\}_{t \\in \\mathcal{T}})$。\n\n- 用例 $1$（一般热浪，中等方差）：\n  - $\\mu_{C,0} = 10000\\ \\mathrm{MW}$，\n  - $\\sigma_C = 300\\ \\mathrm{MW}$，\n  - $\\mu_{D,0} = 9300\\ \\mathrm{MW}$，\n  - $\\sigma_D = 600\\ \\mathrm{MW}$，\n  - $\\gamma = 0.002 /^{\\circ}\\mathrm{C}$，\n  - $\\beta = 100\\ \\mathrm{MW}/^{\\circ}\\mathrm{C}$，\n  - $T_0 = 25\\ ^{\\circ}\\mathrm{C}$，\n  - $\\Delta t = 1\\ \\mathrm{h}$，\n  - $24$ 小时内的逐时温度 $\\{T(t)\\}$：\n    $[33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 32, 33, 34]\\ ^{\\circ}\\mathrm{C}$，即 $[33,34,35,36,37,38,39,40,41,42,41,40,39,38,37,36,35,34,33,32,31,32,33,34]$，每个条目的单位为 $^{\\circ}\\mathrm{C}$。\n\n- 用例 $2$（确定性边界，零方差）：\n  - $\\mu_{C,0} = 1200\\ \\mathrm{MW}$，\n  - $\\sigma_C = 0\\ \\mathrm{MW}$，\n  - $\\mu_{D,0} = 1000\\ \\mathrm{MW}$，\n  - $\\sigma_D = 0\\ \\mathrm{MW}$，\n  - $\\gamma = 0.01 /^{\\circ}\\mathrm{C}$，\n  - $\\beta = 25\\ \\mathrm{MW}/^{\\circ}\\mathrm{C}$，\n  - $T_0 = 20\\ ^{\\circ}\\mathrm{C}$，\n  - $\\Delta t = 1\\ \\mathrm{h}$，\n  - $8$ 小时内的逐时温度 $\\{T(t)\\}$：\n    $[20,22,24,26,28,30,32,34]\\ ^{\\circ}\\mathrm{C}$。\n\n- 用例 $3$（无降额，仅需求敏感）：\n  - $\\mu_{C,0} = 6500\\ \\mathrm{MW}$，\n  - $\\sigma_C = 250\\ \\mathrm{MW}$，\n  - $\\mu_{D,0} = 6000\\ \\mathrm{MW}$，\n  - $\\sigma_D = 350\\ \\mathrm{MW}$，\n  - $\\gamma = 0.0 /^{\\circ}\\mathrm{C}$，\n  - $\\beta = 60\\ \\mathrm{MW}/^{\\circ}\\mathrm{C}$，\n  - $T_0 = 23\\ ^{\\circ}\\mathrm{C}$，\n  - $\\Delta t = 1\\ \\mathrm{h}$，\n  - $12$ 小时内的逐时温度 $\\{T(t)\\}$：\n    $[23,25,27,29,31,33,35,33,31,29,27,25]\\ ^{\\circ}\\mathrm{C}$。\n\n- 用例 $4$（高方差边缘，概率接近对称）：\n  - $\\mu_{C,0} = 5000\\ \\mathrm{MW}$，\n  - $\\sigma_C = 1500\\ \\mathrm{MW}$，\n  - $\\mu_{D,0} = 4800\\ \\mathrm{MW}$，\n  - $\\sigma_D = 1500\\ \\mathrm{MW}$，\n  - $\\gamma = 0.002 /^{\\circ}\\mathrm{C}$，\n  - $\\beta = 40\\ \\mathrm{MW}/^{\\circ}\\mathrm{C}$，\n  - $T_0 = 24\\ ^{\\circ}\\mathrm{C}$，\n  - $\\Delta t = 1\\ \\mathrm{h}$，\n  - $6$ 小时内的逐时温度 $\\{T(t)\\}$：\n    $[30,30,30,30,30,30]\\ ^{\\circ}\\mathrm{C}$。\n\n- 用例 $5$（无热浪，温度等于基准）：\n  - $\\mu_{C,0} = 8000\\ \\mathrm{MW}$，\n  - $\\sigma_C = 400\\ \\mathrm{MW}$，\n  - $\\mu_{D,0} = 7800\\ \\mathrm{MW}$，\n  - $\\sigma_D = 300\\ \\mathrm{MW}$，\n  - $\\gamma = 0.003 /^{\\circ}\\mathrm{C}$，\n  - $\\beta = 20\\ \\mathrm{MW}/^{\\circ}\\mathrm{C}$，\n  - $T_0 = 26\\ ^{\\circ}\\mathrm{C}$，\n  - $\\Delta t = 1\\ \\mathrm{h}$，\n  - $24$ 小时内的逐时温度 $\\{T(t)\\}$：\n    $[26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26]\\ ^{\\circ}\\mathrm{C}$。\n\n您的程序应生成单行输出，其中包含用例 $1$ 到 $5$ 的增量 LOLE，形式为用方括号括起来的逗号分隔列表，例如 $[x_1,x_2,x_3,x_4,x_5]$，其中每个 $x_i$ 是以 $\\mathrm{h}$ 为单位的浮点数。",
            "solution": "经评估，用户提供的问题是有效的。它在科学上基于电力系统可靠性和概率论的原理，是自洽的，提供了所有必要的数据，并且是适定的，存在唯一且稳定的解。问题陈述客观，并使用清晰、正式的语言。因此，我将继续提供完整的解决方案。\n\n该问题要求计算在热浪条件下单个区域电力系统的增量负荷损失期望（$\\Delta \\mathrm{LOLE}$）。解决方案涉及将电力需求和可用发电容量都建模为高斯随机变量，其均值依赖于温度。\n\n首先，让我们形式化在任何给定时间 $t$ 发生负荷损失事件的概率。当需求 $D(t)$ 超过容量 $C(t)$ 时，发生负荷损失。我们需要计算 $\\mathbb{P}(D(t)  C(t))$。我们定义一个裕度变量 $X(t) = D(t) - C(t)$。负荷损失事件等价于条件 $X(t)  0$。\n\n问题指出，需求 $D(t)$ 和容量 $C(t)$ 是独立的高斯随机变量：\n$$\nD(t) \\sim \\mathcal{N}(\\mu_D(t), \\sigma_D^2)\n$$\n$$\nC(t) \\sim \\mathcal{N}(\\mu_C(t), \\sigma_C^2)\n$$\n两个独立高斯变量的差也是一个高斯变量。因此，$X(t)$ 服从高斯分布 $X(t) \\sim \\mathcal{N}(\\mu_X(t), \\sigma_X^2)$，其均值和方差为：\n$$\n\\mu_X(t) = \\mathbb{E}[D(t) - C(t)] = \\mathbb{E}[D(t)] - \\mathbb{E}[C(t)] = \\mu_D(t) - \\mu_C(t)\n$$\n$$\n\\sigma_X^2 = \\mathrm{Var}(D(t) - C(t)) = \\mathrm{Var}(D(t)) + \\mathrm{Var}(C(t)) = \\sigma_D^2 + \\sigma_C^2\n$$\n方差计算的第二步源于 $D(t)$ 和 $C(t)$ 的统计独立性。因此，组合标准差为 $\\sigma_X = \\sqrt{\\sigma_D^2 + \\sigma_C^2}$。\n\n均值 $\\mu_D(t)$ 和 $\\mu_C(t)$ 是环境温度 $T(t)$ 的函数：\n$$\n\\mu_D(T(t)) = \\mu_{D,0} + \\beta \\cdot (T(t) - T_0)\n$$\n$$\n\\mu_C(T(t)) = \\mu_{C,0} \\cdot \\left( 1 - \\gamma \\cdot (T(t) - T_0) \\right)\n$$\n其中 $\\mu_{D,0}$ 和 $\\mu_{C,0}$ 是在参考温度 $T_0$ 下的基准均值。\n\n为了求出概率 $\\mathbb{P}(X(t)  0)$，我们将变量 $X(t)$ 标准化为标准正态变量 $Z \\sim \\mathcal{N}(0, 1)$：\n$$\nZ = \\frac{X(t) - \\mu_X(t)}{\\sigma_X}\n$$\n不等式 $X(t)  0$ 变为：\n$$\n\\frac{X(t) - \\mu_X(t)}{\\sigma_X}  \\frac{0 - \\mu_X(t)}{\\sigma_X} \\implies Z  -\\frac{\\mu_X(t)}{\\sigma_X}\n$$\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF）。该概率由下式给出：\n$$\np(t) = \\mathbb{P}(X(t)  0) = \\mathbb{P}\\left(Z  -\\frac{\\mu_X(t)}{\\sigma_X}\\right) = 1 - \\Phi\\left(-\\frac{\\mu_X(t)}{\\sigma_X}\\right)\n$$\n使用恒等式 $\\Phi(-z) = 1 - \\Phi(z)$，可简化为：\n$$\np(t) = \\Phi\\left(\\frac{\\mu_X(t)}{\\sigma_X}\\right) = \\Phi\\left(\\frac{\\mu_D(T(t)) - \\mu_C(T(t))}{\\sqrt{\\sigma_D^2 + \\sigma_C^2}}\\right)\n$$\n这是单个小时 $t$ 的负荷损失概率。\n\n问题将 LOLE 定义为在事件窗口 $\\mathcal{T}$ 上的积分。对于一组离散的小时温度，该积分近似为一个和式：\n$$\n\\mathrm{LOLE} \\approx \\sum_{t_i \\in \\mathcal{T}_{\\text{discrete}}} p(t_i) \\, \\Delta t\n$$\n其中 $\\Delta t$ 是时间步长，在所有测试用例中均为 $1$ 小时。\n\n增量 LOLE, $\\Delta \\mathrm{LOLE}$，是在热浪条件下计算的 LOLE（$\\mathrm{LOLE}_{\\text{heatwave}}$）与在基准条件下计算的 LOLE（$\\mathrm{LOLE}_{\\text{baseline}}$）之差。\n\n对于 $\\mathrm{LOLE}_{\\text{heatwave}}$，我们使用指定的逐时温度 $T(t_i)$ 计算每小时的 $p(t_i)$，然后将结果求和：\n$$\n\\mathrm{LOLE}_{\\text{heatwave}} = \\Delta t \\sum_{i=1}^{N} \\Phi\\left(\\frac{\\mu_D(T(t_i)) - \\mu_C(T(t_i))}{\\sqrt{\\sigma_D^2 + \\sigma_C^2}}\\right)\n$$\n其中 $N$ 是事件窗口中的小时数。\n\n对于 $\\mathrm{LOLE}_{\\text{baseline}}$，在窗口内的所有小时中，温度都保持恒定为 $T(t) = T_0$。这使得在所有基准小时内，概率 $p(t)$ 是一个常数。在 $T(t)=T_0$ 时，平均需求和容量就是 $\\mu_{D,0}$ 和 $\\mu_{C,0}$。基准概率为：\n$$\np_{\\text{base}} = \\Phi\\left(\\frac{\\mu_{D,0} - \\mu_{C,0}}{\\sqrt{\\sigma_D^2 + \\sigma_C^2}}\\right)\n$$\n那么，在 $N$ 小时窗口内的总基准 LOLE 为：\n$$\n\\mathrm{LOLE}_{\\text{baseline}} = N \\cdot p_{\\text{base}} \\cdot \\Delta t\n$$\n最后，增量 LOLE 为 $\\Delta \\mathrm{LOLE} = \\mathrm{LOLE}_{\\text{heatwave}} - \\mathrm{LOLE}_{\\text{baseline}}$。\n\n当 $\\sigma_D^2 + \\sigma_C^2 = 0$ 时，会出现一个特殊的边界情况，这意味着 $\\sigma_D=0$ 且 $\\sigma_C=0$。在这种确定性场景下，$D(t)$ 和 $C(t)$ 不是随机变量，而是等于其均值的固定值。概率 $\\mathbb{P}(D(t)  C(t))$ 不再通过 CDF 计算，而变成一个简单的比较：\n- 如果 $\\mu_D(T(t))  \\mu_C(T(t))$，则为 $1$\n- 如果 $\\mu_D(T(t)) = \\mu_C(T(t))$，则为 $0.5$\n- 如果 $\\mu_D(T(t))  \\mu_C(T(t))$，则为 $0$\n\n每个测试用例的算法如下：\n1. 提取所有参数：$(\\mu_{C,0}, \\sigma_C, \\mu_{D,0}, \\sigma_D, \\gamma, \\beta, T_0, \\Delta t, \\{T(t)\\})$。\n2. 计算总方差 $\\sigma_X^2 = \\sigma_D^2 + \\sigma_C^2$ 和标准差 $\\sigma_X = \\sqrt{\\sigma_X^2}$。\n3. 计算 $\\mathrm{LOLE}_{\\text{baseline}}$：\n    a. 使用 CDF 公式（如果 $\\sigma_X  0$）或确定性比较规则（如果 $\\sigma_X=0$），并利用均值 $\\mu_{D,0}$ 和 $\\mu_{C,0}$ 来确定基准概率 $p_{\\text{base}}$。\n    b. 计算 $\\mathrm{LOLE}_{\\text{baseline}} = N \\cdot p_{\\text{base}} \\cdot \\Delta t$，其中 $N$ 是事件中的小时数。\n4. 计算 $\\mathrm{LOLE}_{\\text{heatwave}}$：\n    a. 初始化 $\\mathrm{LOLE}_{\\text{heatwave}} = 0$。\n    b. 对于每个具有温度 $T(t_i)$ 的小时 $t_i$：\n        i. 计算与温度相关的均值 $\\mu_D(T(t_i))$ 和 $\\mu_C(T(t_i))$。\n        ii. 使用 CDF（如果 $\\sigma_X  0$）或确定性规则（如果 $\\sigma_X = 0$）计算小时概率 $p(t_i)$。\n        iii. 将 $p(t_i) \\cdot \\Delta t$ 加到 $\\mathrm{LOLE}_{\\text{heatwave}}$ 上。\n5. 计算最终结果：$\\Delta \\mathrm{LOLE} = \\mathrm{LOLE}_{\\text{heatwave}} - \\mathrm{LOLE}_{\\text{baseline}}$。\n此过程应用于所提供的五个测试用例中的每一个。",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases and print the results.\n    \"\"\"\n\n    test_cases = [\n        # Case 1\n        {\n            \"mu_c0\": 10000.0, \"sigma_c\": 300.0,\n            \"mu_d0\": 9300.0, \"sigma_d\": 600.0,\n            \"gamma\": 0.002, \"beta\": 100.0,\n            \"t0\": 25.0, \"dt\": 1.0,\n            \"temps\": [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 32, 33, 34]\n        },\n        # Case 2\n        {\n            \"mu_c0\": 1200.0, \"sigma_c\": 0.0,\n            \"mu_d0\": 1000.0, \"sigma_d\": 0.0,\n            \"gamma\": 0.01, \"beta\": 25.0,\n            \"t0\": 20.0, \"dt\": 1.0,\n            \"temps\": [20, 22, 24, 26, 28, 30, 32, 34]\n        },\n        # Case 3\n        {\n            \"mu_c0\": 6500.0, \"sigma_c\": 250.0,\n            \"mu_d0\": 6000.0, \"sigma_d\": 350.0,\n            \"gamma\": 0.0, \"beta\": 60.0,\n            \"t0\": 23.0, \"dt\": 1.0,\n            \"temps\": [23, 25, 27, 29, 31, 33, 35, 33, 31, 29, 27, 25]\n        },\n        # Case 4\n        {\n            \"mu_c0\": 5000.0, \"sigma_c\": 1500.0,\n            \"mu_d0\": 4800.0, \"sigma_d\": 1500.0,\n            \"gamma\": 0.002, \"beta\": 40.0,\n            \"t0\": 24.0, \"dt\": 1.0,\n            \"temps\": [30, 30, 30, 30, 30, 30]\n        },\n        # Case 5\n        {\n            \"mu_c0\": 8000.0, \"sigma_c\": 400.0,\n            \"mu_d0\": 7800.0, \"sigma_d\": 300.0,\n            \"gamma\": 0.003, \"beta\": 20.0,\n            \"t0\": 26.0, \"dt\": 1.0,\n            \"temps\": [26] * 24\n        }\n    ]\n\n    results = [calculate_incremental_lole(case) for case in test_cases]\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\ndef calculate_incremental_lole(params):\n    \"\"\"\n    Calculates the incremental LOLE for a single test case.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the case.\n\n    Returns:\n        float: The calculated incremental LOLE in hours.\n    \"\"\"\n    mu_c0 = params[\"mu_c0\"]\n    sigma_c = params[\"sigma_c\"]\n    mu_d0 = params[\"mu_d0\"]\n    sigma_d = params[\"sigma_d\"]\n    gamma = params[\"gamma\"]\n    beta = params[\"beta\"]\n    t0 = params[\"t0\"]\n    dt = params[\"dt\"]\n    temps = params[\"temps\"]\n    \n    n_hours = len(temps)\n    total_variance = sigma_c**2 + sigma_d**2\n    \n    # Calculate LOLE_baseline\n    mu_diff_base = mu_d0 - mu_c0\n    if total_variance == 0:\n        if mu_diff_base  0:\n            p_base = 1.0\n        elif mu_diff_base == 0:\n            p_base = 0.5\n        else:\n            p_base = 0.0\n    else:\n        total_std_dev = np.sqrt(total_variance)\n        z_base = mu_diff_base / total_std_dev\n        p_base = norm.cdf(z_base)\n        \n    lole_baseline = p_base * n_hours * dt\n\n    # Calculate LOLE_heatwave\n    lole_heatwave = 0.0\n    for t_hour in temps:\n        delta_t = t_hour - t0\n        \n        mu_d_t = mu_d0 + beta * delta_t\n        mu_c_t = mu_c0 * (1 - gamma * delta_t)\n        \n        mu_diff_hw = mu_d_t - mu_c_t\n\n        if total_variance == 0:\n            if mu_diff_hw  0:\n                p_hw = 1.0\n            elif mu_diff_hw == 0:\n                p_hw = 0.5\n            else:\n                p_hw = 0.0\n        else:\n            total_std_dev = np.sqrt(total_variance)\n            z_hw = mu_diff_hw / total_std_dev\n            p_hw = norm.cdf(z_hw)\n            \n        lole_heatwave += p_hw * dt\n\n    return lole_heatwave - lole_baseline\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "压力测试的最终目的不仅是评估风险，更是为了指导更优的决策。最后的这个实践将带您进入风险管理的领域，通过机组组合（Unit Commitment, UC）问题来探索风险感知的运行策略。您将比较标准的期望成本最小化方法与一种明确针对最坏情景的“条件风险价值”（Conditional Value at Risk, CVaR）方法()。这项练习将揭示经济效率与系统韧性之间的权衡，让您掌握设计能抵御气候压力测试所识别出的尾部风险的运行策略。",
            "id": "4078008",
            "problem": "给定一个单时段机组组合（UC）问题，该问题考虑了代表电力系统气候压力情景的不确定性。UC决策是为三个火电机组确定的二进制启停向量，在情景实现前的日前阶段选定。每个情景都指定了净负荷（需求减去可变可再生能源）及其相关概率。每个情景下的调度必须遵守发电机容量限制和最小稳定运行水平。允许出现缺额（未服务能源），并会产生旨在代表社会失负荷价值（VOLL）的罚款。您必须计算两种策略的可靠性指标和成本风险：期望成本UC和条件风险价值UC。\n\n定义与约束：\n- 机组组合（UC）为每个火电机组 $i$ 确定一个二进制决策 $x_i \\in \\{0,1\\}$，表示该机组在该时段是否启机。\n- 如果启机，发电机 $i$ 的出力必须至少为其最小稳定出力 $P^{\\min}_i$，至多为其最大出力 $P^{\\max}_i$；如果不启机，则其出力为 $0$。\n- 发电机 $i$ 的可变成本为每兆瓦时（MWh）$c_i$ 美元，如果启机，则启动成本为 $s_i$ 美元，未服务能源的罚款为每兆瓦时 $c^{\\text{short}}$ 美元。\n- 每个情景下的调度旨在最小化可变发电成本，同时在容量限制下尽可能满足净负荷；允许出现缺额。已启机机组必须达到其最小出力，额外的调度将按照经济次序（$c_i$ 最低者优先）分配，直至达到 $P^{\\max}_i$。\n- 期望总成本为 $\\mathbb{E}[C] = \\sum_{s} p_s C_s$，其中 $C_s$ 是情景 $s$ 下的总成本，$p_s$ 是该情景的概率。\n- 对于成本随机变量 $C$，在水平 $\\alpha \\in (0,1)$ 下的条件风险价值（CVaR）被定义为最差的 $(1-\\alpha)$ 尾部结果的平均值。对于具有成本 $C_s$ 和概率 $p_s$ 的离散分布，设 $(C_{(1)},p_{(1)}),\\dots,(C_{(m)},p_{(m)})$ 按 $C$ 递增排序，并设 $k$ 是满足 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$ 的最小索引。那么，在水平 $\\alpha$ 下的风险价值（VaR）是 $C_{(k)}$，而条件风险价值是\n$$\n\\text{CVaR}_\\alpha(C) = \\frac{1}{1-\\alpha}\\left(\\sum_{j=k+1}^{m} p_{(j)} C_{(j)} + \\left(\\sum_{j=1}^{k} p_{(j)} - \\alpha\\right) C_{(k)}\\right).\n$$\n- 可靠性指标：\n  - 缺额概率为 $\\sum_s p_s \\mathbf{1}\\{\\text{shortfall}_s  0\\}$，以小数形式表示。\n  - 期望未服务能源为 $\\sum_s p_s \\cdot \\text{shortfall}_s$，单位为兆瓦时（MWh）。\n\n策略：\n- 期望成本UC策略选择一个启停向量 $x$，以在上述情景和调度规则下最小化 $\\mathbb{E}[C]$。\n- 条件风险价值（CVaR）UC策略选择一个启停向量 $x$，以在相同的情景和调度规则下最小化 $\\text{CVaR}_\\alpha(C)$。\n\n任务：\n1. 对于下方的每个测试用例，枚举所有 $2^3$ 个启停向量 $x \\in \\{0,1\\}^3$，并通过求解每个情景下的最低成本调度问题来计算情景成本 $C_s$，需满足以下条件：\n   - 如果 $x_i=1$，则调度 $g_i \\in [P^{\\min}_i,P^{\\max}_i]$；如果 $x_i=0$，则 $g_i=0$。\n   - 设 $L_s$ 为情景 $s$ 中的净负荷。首先满足强制的最小出力 $\\sum_i x_i P^{\\min}_i$。如果仍有剩余需求，则按 $c_i$ 的递增顺序将额外发电量分配给已启机机组，直至达到 $P^{\\max}_i$。在用尽 $\\sum_i x_i P^{\\max}_i$ 后任何剩余的未满足需求即为缺额 $\\text{shortfall}_s$。\n   - 情景成本为 $C_s = \\sum_i x_i s_i + \\sum_i c_i g_i + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n2. 识别出在每个测试用例中最小化 $\\mathbb{E}[C]$ 的期望成本UC策略和最小化 $\\text{CVaR}_\\alpha(C)$ 的CVaR UC策略。\n3. 对于每个识别出的策略，计算：\n   - 期望总成本，单位为美元。\n   - 成本的 $\\text{CVaR}_\\alpha$，单位为美元。\n   - 缺额概率，以小数表示。\n   - 期望未服务能源，单位为兆瓦时（MWh）。\n\n单位与格式：\n- 所有成本必须以美元表示，并四舍五入到两位小数。\n- 能源量必须以MWh表示，并四舍五入到三位小数。\n- 概率必须以小数表示，并四舍五入到三位小数。\n- 不涉及角度。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，结果必须按顺序排列如下：\n  - 期望成本UC：期望总成本（美元），$\\text{CVaR}_\\alpha$（美元），缺额概率（小数），期望未服务能源（MWh），\n  - CVaR UC：期望总成本（美元），$\\text{CVaR}_\\alpha$（美元），缺额概率（小数），期望未服务能源（MWh）。\n\n测试套件：\n- 所有测试通用的发电机组：\n  - 发电机 1：$P^{\\min}_1 = 20$ MW， $P^{\\max}_1 = 100$ MW， $c_1 = 50$ 美元/MWh， $s_1 = 1000$ 美元。\n  - 发电机 2：$P^{\\min}_2 = 10$ MW， $P^{\\max}_2 = 50$ MW， $c_2 = 80$ 美元/MWh， $s_2 = 600$ 美元。\n  - 发电机 3：$P^{\\min}_3 = 0$ MW， $P^{\\max}_3 = 30$ MW， $c_3 = 200$ 美元/MWh。其启动成本 $s_3$ 因测试用例而异。\n- 测试用例1（一般情况）：\n  - 情景：净负荷 $L = [120, 160, 90]$ MW，概率 $p = [0.5, 0.3, 0.2]$。\n  - 罚款 $c^{\\text{short}} = 10000$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 200]$ 美元。\n  - 风险水平 $\\alpha = 0.9$。\n- 测试用例2（在VaR处有质量的边界尾部概率）：\n  - 情景：净负荷 $L = [100, 150, 200]$ MW，概率 $p = [0.7, 0.29, 0.01]$。\n  - 罚款 $c^{\\text{short}} = 10000$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 200]$ 美元。\n  - 风险水平 $\\alpha = 0.99$。\n- 测试用例3（CVaR策略与期望成本策略不同的边缘情况）：\n  - 情景：净负荷 $L = [120, 140, 190]$ MW，概率 $p = [0.6, 0.32, 0.08]$。\n  - 罚款 $c^{\\text{short}} = 500$ 美元/MWh。\n  - 启动成本向量 $s = [1000, 600, 2000]$ 美元。\n  - 风险水平 $\\alpha = 0.9$。\n\n您的程序必须实现上述逻辑，并按所述确切格式生成单行输出。无需外部输入，所有数值结果都应根据此处提供的测试套件计算得出。",
            "solution": "该问题是有效的。这是一个定义明确的优化问题，其基础是电力系统工程和金融风险管理的标准原则。所有必要的数据、定义、约束和目标函数均已提供。该问题是自包含的、科学上合理的，并且在算法上是可解的。\n\n### 步骤1：提取已知条件\n\n**发电机参数（所有测试用例通用）：**\n- 发电机 1: $P^{\\min}_1 = 20$ MW, $P^{\\max}_1 = 100$ MW, $c_1 = 50$ \\$/MWh。\n- 发电机 2: $P^{\\min}_2 = 10$ MW, $P^{\\max}_2 = 50$ MW, $c_2 = 80$ \\$/MWh。\n- 发电机 3: $P^{\\min}_3 = 0$ MW, $P^{\\max}_3 = 30$ MW, $c_3 = 200$ \\$/MWh。\n- 调度经济次序：发电机1，然后发电机2，然后发电机3，基于递增的可变成本 $c_i$。\n\n**决策变量：**\n- 机组组合（UC）：$x_i \\in \\{0,1\\}$，对于每个发电机 $i \\in \\{1, 2, 3\\}$。\n- 发电调度：$g_i \\ge 0$，对于每个发电机 $i$。\n\n**约束：**\n- 如果 $x_i = 0$，则 $g_i = 0$。\n- 如果 $x_i = 1$，则 $P^{\\min}_i \\le g_i \\le P^{\\max}_i$。\n\n**成本组成部分：**\n- 启动成本：如果机组 $i$ 启机（$x_i=1$），则为 $s_i$。\n- 可变成本：每兆瓦时发电量 $g_i$ 为 $c_i$。\n- 缺额罚款：每兆瓦时未服务能源为 $c^{\\text{short}}$。\n\n**情景成本计算：**\n- 对于给定的启停决策 $x$ 和具有净负荷 $L_s$ 的情景 $s$：\n  1. 设置最小发电量：$g_i = x_i P^{\\min}_i$。\n  2. 按照经济次序将剩余需求分配给已启机机组，直至其 $P^{\\max}_i$。\n  3. 缺额 $\\text{shortfall}_s$ 是任何剩余的未满足需求。\n  4. 总情景成本：$C_s = \\sum_i x_i s_i + \\sum_i c_i g_i + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n\n**用于UC策略选择的目标函数：**\n- 期望成本：最小化 $\\mathbb{E}[C] = \\sum_{s} p_s C_s$。\n- 条件风险价值（CVaR）：最小化 $\\text{CVaR}_\\alpha(C) = \\frac{1}{1-\\alpha}\\left(\\sum_{j=k+1}^{m} p_{(j)} C_{(j)} + \\left(\\sum_{j=1}^{k} p_{(j)} - \\alpha\\right) C_{(k)}\\right)$，其中 $(C_{(j)}, p_{(j)})$ 是按成本排序的成本和概率，而 $k$ 是满足 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$ 的最小索引。\n\n**可靠性指标：**\n- 缺额概率：$\\sum_s p_s \\mathbf{1}\\{\\text{shortfall}_s  0\\}$。\n- 期望未服务能源：$\\sum_s p_s \\cdot \\text{shortfall}_s$。\n\n**测试用例1：**\n- 情景：$L = [120, 160, 90]$ MW, $p = [0.5, 0.3, 0.2]$。\n- $c^{\\text{short}} = 10000$ \\$/MWh。\n- 启动成本：$s = [1000, 600, 200]$ \\$。\n- 风险水平：$\\alpha = 0.9$。\n\n**测试用例2：**\n- 情景：$L = [100, 150, 200]$ MW, $p = [0.7, 0.29, 0.01]$。\n- $c^{\\text{short}} = 10000$ \\$/MWh。\n- 启动成本：$s = [1000, 600, 200]$ \\$。\n- 风险水平：$\\alpha = 0.99$。\n\n**测试用例3：**\n- 情景：$L = [120, 140, 190]$ MW, $p = [0.6, 0.32, 0.08]$。\n- $c^{\\text{short}} = 500$ \\$/MWh。\n- 启动成本：$s = [1000, 600, 2000]$ \\$。\n- 风险水平：$\\alpha = 0.9$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是**有效的**。\n- **科学基础：** 机组组合、经济调度、经济次序、期望成本最小化和条件风险价值等概念是电力系统运营和风险管理中的标准和基础内容。\n- **适定性：** 问题的结构使其具有唯一、稳定的解。对有限集合 $2^3=8$ 个启停决策的枚举保证了 $\\mathbb{E}[C]$ 和 $\\text{CVaR}_\\alpha(C)$ 的最小值存在并且可以找到。\n- **客观性：** 问题使用精确、形式化的数学和工程术语陈述，没有主观语言。\n- **完整性与一致性：** 每个测试用例都提供了所有必要的参数（发电机特性、成本、负荷情景、概率、风险水平）。所提供的数据或约束中没有矛盾。\n- **可行性：** 所描述的条件在一个简化的电力系统模型背景下是物理上和经济上合理的。\n\n### 步骤3：算法求解\n求解方法涉及对每个测试用例的所有可能启停决策进行系统性评估。\n\n1.  **定义系统参数**：对于每个测试用例，定义发电机数据、情景数据（负荷和概率）、启动成本、缺额罚款和 $\\alpha$ 水平。发电机索引为 0、1、2，其调度经济次序是固定的，因为这对应于它们递增的可变成本（$c_0 = 50$, $c_1 = 80$, $c_2 = 200$ \\$/MWh）。\n\n2.  **枚举启停向量**：存在 $2^3=8$ 种可能的二进制启停向量，从 $x=[0,0,0]$ 到 $x=[1,1,1]$。我们将遍历这些向量中的每一个。\n\n3.  **计算每个启停决策下的情景结果**：对于给定的启停向量 $x$：\n    a.  **计算总启动成本**：$S(x) = \\sum_{i=0}^{2} x_i s_i$。\n    b.  **对于每个情景 $s$（负荷为 $L_s$，概率为 $p_s$）：**\n        i.  如果机组 $i$ 启机，则将其发电量初始化为其最小稳定水平：$g_{i,s} = x_i P^{\\min}_i$。\n        ii. 计算总最小发电量 $G_{\\min} = \\sum_i g_{i,s}$。\n        iii. 计算待由可调度容量满足的剩余需求：$D^{\\text{resid}}_s = L_s - G_{\\min}$。我们可以假设 $D^{\\text{resid}}_s \\ge 0$，因为所有给定的负荷都超过了可能的最大最小出力总和。\n        iv. 按照经济次序（$i=0, 1, 2$）顺序调度已启机机组的额外功率：\n            - 对于每个机组 $i$，可用的可调度容量为 $\\Delta P_i^{\\max} = x_i (P^{\\max}_i - P^{\\min}_i)$。\n            - 该机组调度的量为 $\\Delta g_{i,s} = \\min(D^{\\text{resid}}_s, \\Delta P_i^{\\max})$。\n            - 更新机组的发电量：$g_{i,s} = g_{i,s} + \\Delta g_{i,s}$。\n            - 更新剩余需求：$D^{\\text{resid}}_s = D^{\\text{resid}}_s - \\Delta g_{i,s}$。\n        v. 遍历所有机组后，任何剩余的 $D^{\\text{resid}}_s  0$ 即为该情景的能源缺额：$\\text{shortfall}_s = D^{\\text{resid}}_s$。\n        vi. 计算该情景的总成本：$C_s(x) = S(x) + \\sum_{i=0}^{2} c_i g_{i,s} + c^{\\text{short}} \\cdot \\text{shortfall}_s$。\n\n4.  **计算每个启停决策的聚合指标**：在计算了启停决策 $x$ 下所有情景的成本 $C_s(x)$ 和缺额 $\\text{shortfall}_s$ 之后：\n    a.  **期望成本**：$\\mathbb{E}[C(x)] = \\sum_s p_s C_s(x)$。\n    b.  **条件风险价值**：\n        i.  创建 $(C_s(x), p_s)$ 对，并按成本 $C_s(x)$ 升序排序，得到 $(C_{(j)}, p_{(j)})$。\n        ii. 找到最小的索引 $k$，使得累积概率 $\\sum_{j=1}^{k} p_{(j)} \\ge \\alpha$。\n        iii. 应用提供的公式计算 $\\text{CVaR}_\\alpha(C(x))$。\n    c.  **缺额概率**：$P(\\text{shortfall}0) = \\sum_{s \\text{ s.t. } \\text{shortfall}_s  0} p_s$。\n    d.  **期望未服务能源 (EUE)**：$\\mathbb{E}[\\text{shortfall}] = \\sum_s p_s \\cdot \\text{shortfall}_s$。\n\n5.  **确定最优策略**：\n    a.  在计算完所有 8 个启停向量的指标后，找到具有最小 $\\mathbb{E}[C(x)]$ 的向量 $x_{\\text{E}}$。\n    b.  找到具有最小 $\\text{CVaR}_\\alpha(C(x))$ 的向量 $x_{\\text{CVaR}}$。\n    c.  如果多个向量达到最小值，任何一个都是有效选择。实现将选择遇到的第一个。\n\n6.  **报告结果**：对于每个测试用例，为 $x_{\\text{E}}$ 策略和 $x_{\\text{CVaR}}$ 策略编制四个所需指标（$\\mathbb{E}[C]$, $\\text{CVaR}_\\alpha(C)$, $P(\\text{shortfall})$, EUE）。数值必须按规定四舍五入。\n\n这一综合程序在以下 Python 代码中实现。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the climate risk stress testing problem for unit commitment.\n    \"\"\"\n    \n    # Common generator parameters (index 0, 1, 2)\n    gen_params_base = [\n        {'p_min': 20, 'p_max': 100, 'c': 50},  # Gen 1\n        {'p_min': 10, 'p_max': 50,  'c': 80},  # Gen 2\n        {'p_min': 0,  'p_max': 30,  'c': 200}, # Gen 3\n    ]\n\n    test_cases = [\n        {\n            # Test case 1\n            \"scenarios\": {'L': np.array([120, 160, 90]), 'p': np.array([0.5, 0.3, 0.2])},\n            \"c_short\": 10000,\n            \"s\": [1000, 600, 200],\n            \"alpha\": 0.9\n        },\n        {\n            # Test case 2\n            \"scenarios\": {'L': np.array([100, 150, 200]), 'p': np.array([0.7, 0.29, 0.01])},\n            \"c_short\": 10000,\n            \"s\": [1000, 600, 200],\n            \"alpha\": 0.99\n        },\n        {\n            # Test case 3\n            \"scenarios\": {'L': np.array([120, 140, 190]), 'p': np.array([0.6, 0.32, 0.08])},\n            \"c_short\": 500,\n            \"s\": [1000, 600, 2000],\n            \"alpha\": 0.9\n        }\n    ]\n\n    final_results = []\n    \n    # Define merit order based on variable cost\n    merit_order = sorted(range(len(gen_params_base)), key=lambda i: gen_params_base[i]['c'])\n\n    def calculate_cvar(costs, probs, alpha):\n        if not (0  alpha  1):\n            raise ValueError(\"Alpha must be in (0,1)\")\n        \n        items = sorted(zip(costs, probs))\n        sorted_costs = np.array([item[0] for item in items])\n        sorted_probs = np.array([item[1] for item in items])\n\n        cum_probs = np.cumsum(sorted_probs)\n        \n        # Find index k_idx where cumulative probability first exceeds or equals alpha\n        k_idx = np.searchsorted(cum_probs, alpha, side='left')\n\n        if k_idx = len(sorted_costs): # Should not happen if sum(probs) is 1\n            k_idx = len(sorted_costs) - 1\n\n        val_at_risk = sorted_costs[k_idx]\n        \n        # Sum of p*C for outcomes worse than VaR\n        tail_sum = np.sum(sorted_probs[k_idx+1:] * sorted_costs[k_idx+1:])\n        \n        # Probability mass at VaR\n        prob_sum_at_k = cum_probs[k_idx]\n        \n        # Formula from problem statement\n        cvar_numerator = tail_sum + (prob_sum_at_k - alpha) * val_at_risk\n        cvar = cvar_numerator / (1 - alpha)\n        \n        return cvar\n\n    def calculate_scenario_outcomes(commitment, generators, scenarios, c_short):\n        num_scenarios = len(scenarios['L'])\n        startup_cost = sum(gen['s'] for i, gen in enumerate(generators) if commitment[i] == 1)\n        \n        scenario_costs = np.zeros(num_scenarios)\n        shortfalls = np.zeros(num_scenarios)\n\n        for s_idx, load in enumerate(scenarios['L']):\n            g = np.array([generators[i]['p_min'] if commitment[i] else 0 for i in range(len(generators))])\n            min_gen_total = np.sum(g)\n            \n            residual_demand = load - min_gen_total\n            variable_cost = np.sum(g * np.array([gen['c'] for gen in generators]))\n            \n            if residual_demand  0:\n                for unit_idx in merit_order:\n                    if commitment[unit_idx]:\n                        dispatchable_range = generators[unit_idx]['p_max'] - generators[unit_idx]['p_min']\n                        dispatch = min(residual_demand, dispatchable_range)\n                        \n                        g[unit_idx] += dispatch\n                        variable_cost += dispatch * generators[unit_idx]['c']\n                        residual_demand -= dispatch\n\n                        if residual_demand = 1e-9: # Floating point tolerance\n                            break\n            \n            shortfall = max(0, residual_demand)\n            shortfall_cost = shortfall * c_short\n            \n            scenario_costs[s_idx] = startup_cost + variable_cost + shortfall_cost\n            shortfalls[s_idx] = shortfall\n\n        return scenario_costs, shortfalls\n\n    for case in test_cases:\n        generators = [dict(base, s=startup) for base, startup in zip(gen_params_base, case['s'])]\n        scenarios = case['scenarios']\n        c_short = case['c_short']\n        alpha = case['alpha']\n        \n        uc_results = []\n        \n        for i in range(8): # Iterate through 2^3=8 commitment vectors\n            commitment = [(i  2)  1, (i  1)  1, i  1]\n            \n            scenario_costs, shortfalls = calculate_scenario_outcomes(commitment, generators, scenarios, c_short)\n            \n            probs = scenarios['p']\n            exp_cost = np.sum(probs * scenario_costs)\n            cvar = calculate_cvar(scenario_costs, probs, alpha)\n            prob_shortfall = np.sum(probs[shortfalls  1e-9])\n            eue = np.sum(probs * shortfalls)\n            \n            uc_results.append({\n                \"exp_cost\": exp_cost,\n                \"cvar\": cvar,\n                \"prob_shortfall\": prob_shortfall,\n                \"eue\": eue\n            })\n\n        # Find best policies\n        exp_cost_uc_result = min(uc_results, key=lambda x: x['exp_cost'])\n        cvar_uc_result = min(uc_results, key=lambda x: x['cvar'])\n        \n        # Append results for Expected Cost UC policy\n        final_results.append(f\"{exp_cost_uc_result['exp_cost']:.2f}\")\n        final_results.append(f\"{exp_cost_uc_result['cvar']:.2f}\")\n        final_results.append(f\"{exp_cost_uc_result['prob_shortfall']:.3f}\")\n        final_results.append(f\"{exp_cost_uc_result['eue']:.3f}\")\n\n        # Append results for CVaR UC policy\n        final_results.append(f\"{cvar_uc_result['exp_cost']:.2f}\")\n        final_results.append(f\"{cvar_uc_result['cvar']:.2f}\")\n        final_results.append(f\"{cvar_uc_result['prob_shortfall']:.3f}\")\n        final_results.append(f\"{cvar_uc_result['eue']:.3f}\")\n\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```"
        }
    ]
}