{
    "hands_on_practices": [
        {
            "introduction": "在进行任何优化之前，我们必须首先理解系统的物理行为。第一个练习将重点关注水电调度的基石：水量平衡方程。通过应用质量守恒定律，您将学习如何为水库的状态转移过程建模，这是任何水电调度问题中最基本的动态约束 。",
            "id": "4125511",
            "problem": "考虑一个在随机对偶动态规划 (SDDP) 框架内建模的单水库水电系统。在阶段 $t$，水库的蓄水状态变量为 $s_{t}$，单位为 $\\text{hm}^3$。该系统经历入流 $a_{t}$、涡轮机放水 $q_{t}$、非控制性弃水 $\\text{spill}_{t}$ 和蒸发 $e_{t}$，所有这些流量的单位均为 $\\text{m}^3/\\text{s}$。决策周期的时长为 $\\Delta t$ 小时，控制体积内的水量平衡遵循质量守恒定律。下一阶段的蓄水量 $s_{t+1}$ 通过对决策周期内的净体积流量进行积分，并利用 $1 \\text{ hm}^3 = 10^6 \\text{ m}^3$ 这一换算关系将其转换为蓄水单位 $\\text{hm}^3$ 来确定。可行蓄水区域由上下界 $s_{\\min}$ 和 $s_{\\max}$ 定义。\n\n以质量守恒原理为基本依据，并考虑在周期 $\\Delta t$ 内的离散时间累积，推导蓄水转移方程，并使用以下数据计算下一阶段的蓄水量：$s_{t}=90 \\text{ hm}^3$，$a_{t}=12 \\text{ m}^3/\\text{s}$，$q_{t}=30 \\text{ m}^3/\\text{s}$，$\\text{spill}_{t}=5 \\text{ m}^3/\\text{s}$，$e_{t}=1 \\text{ m}^3/\\text{s}$，以及 $\\Delta t=3 \\text{ h}$。根据给定的上下界 $s_{\\min}=50 \\text{ hm}^3$ 和 $s_{\\max}=120 \\text{ hm}^3$，检验 $s_{t+1}$ 的可行性。\n\n将最终答案以一个行矩阵的形式报告，该矩阵包含两个条目：$s_{t+1}$ 的值（以 $\\text{hm}^3$ 表示并四舍五入到四位有效数字）和一个可行性指标（如果 $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$，则为 $1$，否则为 $0$）。",
            "solution": "该问题是有效的，因为它科学地基于质量守恒原理，所有必要数据均已提供，问题陈述清晰，并且以客观、正式的语言表达。我们开始进行求解。\n\n问题的核心是根据质量守恒原理建立水库的蓄水转移方程。该原理指出，控制体积内水量的变化率等于流入该体积的净体积流量率。\n\n设 $V(t)$ 表示在时间 $t$ 水库中的水量，单位为立方米 ($m^3$)。状态变量 $s_t$ 是在决策周期 $t$ 开始时的蓄水量，单位为立方公引 ($\\text{hm}^3$)。这两个量之间的关系由换算因子 $1 \\text{ hm}^3 = 10^6 \\text{ m}^3$ 给出。因此，在阶段 $t$ 开始时的初始体积为 $V_t = s_t \\times 10^6$。\n\n流入和流出水库的流量速率单位为 $m^3/s$。总入流速率为 $a_t$。总出流速率是涡轮机放水 $q_t$、非控制性弃水 $\\text{spill}_t$ 和蒸发 $e_t$ 的总和。因此，流入水库的净流量速率 $f_{\\text{net}}$ 为：\n$$f_{\\text{net}} = a_t - (q_t + \\text{spill}_t + e_t)$$\n\n假设这些流量在整个时长为 $\\Delta t$ 的决策周期内保持不变，水库体积的变化量 $\\Delta V$ 是净流量速率与周期时长的乘积。关键是，单位必须保持一致。流量速率的单位是 $m^3/s$，因此时间长度必须以秒为单位。\n给定的时长 $\\Delta t$ 的单位是小时。为了将小时转换为秒，我们使用换算因子 $1 \\text{ h} = 3600 \\text{ s}$。设 $\\Delta t_{\\text{sec}}$ 是以秒为单位的时长：\n$$\\Delta t_{\\text{sec}} = \\Delta t \\times 3600$$\n\n该周期内的体积变化量 $\\Delta V$ 是：\n$$\\Delta V = f_{\\text{net}} \\times \\Delta t_{\\text{sec}} = (a_t - q_t - \\text{spill}_t - e_t) \\times (\\Delta t \\times 3600)$$\n这个变化量 $\\Delta V$ 的单位是 $m^3$。\n\n下一阶段的蓄水量 $s_{t+1}$ 是初始蓄水量 $s_t$ 加上蓄水变化量 $\\Delta s$。蓄水变化量必须从 $m^3$ 转换为 $\\text{hm}^3$：\n$$\\Delta s = \\frac{\\Delta V}{10^6} = \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\n因此，蓄水转移方程为：\n$$s_{t+1} = s_t + \\Delta s = s_t + \\frac{(a_t - q_t - \\text{spill}_t - e_t) \\times \\Delta t \\times 3600}{10^6}$$\n\n现在，我们将给定的数值代入这个方程：\n- 初始蓄水量：$s_t = 90 \\text{ hm}^3$\n- 入流量：$a_t = 12 \\text{ m}^3/\\text{s}$\n- 涡轮机放水量：$q_t = 30 \\text{ m}^3/\\text{s}$\n- 非控制性弃水量：$\\text{spill}_t = 5 \\text{ m}^3/\\text{s}$\n- 蒸发量：$e_t = 1 \\text{ m}^3/\\text{s}$\n- 时长：$\\Delta t = 3 \\text{ h}$\n\n首先，我们计算净流量速率 $f_{\\text{net}}$：\n$$f_{\\text{net}} = 12 - (30 + 5 + 1) = 12 - 36 = -24 \\text{ m}^3/\\text{s}$$\n负值表示水库有净流出。\n\n接下来，我们计算以 $\\text{hm}^3$ 为单位的蓄水变化量 $\\Delta s$：\n$$\\Delta s = \\frac{(-24 \\text{ m}^3/\\text{s}) \\times (3 \\text{ h} \\times 3600 \\text{ s/h})}{10^6 \\text{ m}^3/\\text{hm}^3}$$\n$$\\Delta s = \\frac{-24 \\times 10800}{10^6} = \\frac{-259200}{1000000} = -0.2592 \\text{ hm}^3$$\n\n最后，我们计算下一阶段的蓄水量 $s_{t+1}$：\n$$s_{t+1} = s_t + \\Delta s = 90 + (-0.2592) = 89.7408 \\text{ hm}^3$$\n问题要求将此值四舍五入到四位有效数字。\n$$s_{t+1} \\approx 89.74 \\text{ hm}^3$$\n\n任务的第二部分是根据给定的上下界检查所得蓄水量的可行性：\n- 最小蓄水量：$s_{\\min} = 50 \\text{ hm}^3$\n- 最大蓄水量：$s_{\\max} = 120 \\text{ hm}^3$\n\n我们必须验证是否满足 $s_{\\min} \\leq s_{t+1} \\leq s_{\\max}$：\n$$50 \\leq 89.7408 \\leq 120$$\n此不等式成立。因此，所得蓄水量是可行的。可行性指标为 $1$。\n\n最终答案是一个行矩阵，包含 $s_{t+1}$ 的四舍五入值和可行性指标。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n89.74  1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "SDDP中的“对偶”指的是对偶变量，即表示资源机会成本的边际价值。本练习将带您深入SDDP决策过程的核心，要求您执行一次单阶段的经济调度。您将利用一个给定的水的边际价值——即SDDP反向传递过程的产物——来决定水电和火电的最优组合，从而具体理解未来的预期结果如何指导当前的决策 。",
            "id": "4125540",
            "problem": "考虑一个由随机对偶动态规划（SDDP）求解的水火电调度问题的单阶段，其中随机对偶动态规划（SDDP）是一种基于分解的算法，它通过一系列仿射割来近似贝尔曼未来成本函数。在当前阶段，系统运营商选择水力发电量 $P_{t}$ 和火力发电量 $P_{t}^{\\text{thermal}}$ 以满足确定性的功率平衡 $P_{t} + P_{t}^{\\text{thermal}} = D_{t}$。需求为 $D_{t} = 100$ MW。火力机组的线性可变成本为 $c^{\\text{th}} = 30 \\text{ \\$/MWh}$。水的边际机会成本（即当前未来成本割相对于蓄水量（已转换为能量单位）的次梯度）为 $\\pi_{t} = 60 \\text{ \\$/MWh}$。假设没有爬坡或容量限制，并且可行性得到保证。\n\n仅使用动态规划和凸优化的基本原理，构建单阶段经济调度模型，以最小化即时火电生产成本与以价格 $\\pi_{t}$ 使用水电能源的机会成本之和，并满足功率平衡和非负性约束。推导一阶最优性条件，并用其确定最优水力调度量 $P_{t}^{\\star}$。以 MW 为单位，将您的最终答案表示为单个实数。无需四舍五入。仅报告 $P_{t}^{\\star}$ 的值（单位：MW）。",
            "solution": "该问题要求在随机对偶动态规划（SDDP）框架内，求解单阶段经济调度问题的最优水力发电量 $P_{t}^{\\star}$。该解是根据凸优化的基本原理推导出来的。\n\n首先，我们构建优化问题。目标是最小化当前阶段 $t$ 的总系统成本。该成本是即时火力发电成本与调度水电能源的机会成本之和。机会成本代表了现在用水而不是将其储存以备后用所产生的预期未来成本，它由水的边际价值 $\\pi_{t}$ 给出。\n\n决策变量是水力发电量 $P_{t}$ 和火力发电量 $P_{t}^{\\text{thermal}}$。两者均以 MW 为单位。\n\n运行一小时的总成本 $C(P_{t}, P_{t}^{\\text{thermal}})$ 由下式给出：\n$$C(P_{t}, P_{t}^{\\text{thermal}}) = c^{\\text{th}} \\cdot P_{t}^{\\text{thermal}} + \\pi_{t} \\cdot P_{t}$$\n其中 $c^{\\text{th}}$ 是火力机组的可变成本，$\\pi_{t}$ 是水的边际机会成本。\n\n系统受以下约束：\n1.  **功率平衡：** 总发电量必须满足需求 $D_{t}$。\n    $$P_{t} + P_{t}^{\\text{thermal}} = D_{t}$$\n2.  **非负性：** 发电量不能为负。\n    $$P_{t} \\ge 0$$\n    $$P_{t}^{\\text{thermal}} \\ge 0$$\n问题陈述中说明没有容量或爬坡限制。\n\n我们可以通过将功率平衡约束代入目标函数来简化问题。根据功率平衡，我们有 $P_{t}^{\\text{thermal}} = D_{t} - P_{t}$。将其代入成本函数，得到一个仅关于 $P_{t}$ 的目标函数：\n$$f(P_{t}) = c^{\\text{th}} (D_{t} - P_{t}) + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} - c^{\\text{th}} P_{t} + \\pi_{t} P_{t}$$\n$$f(P_{t}) = c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\n\n非负性约束 $P_{t}^{\\text{thermal}} \\ge 0$ 意味着 $D_{t} - P_{t} \\ge 0$，即 $P_{t} \\le D_{t}$。结合 $P_{t} \\ge 0$，水力调度的可行范围是 $0 \\le P_{t} \\le D_{t}$。\n\n优化问题现在简化为：\n$$\\min_{P_{t}} \\quad c^{\\text{th}} D_{t} + (\\pi_{t} - c^{\\text{th}}) P_{t}$$\n约束条件：\n$$0 \\le P_{t} \\le D_{t}$$\n\n这是一个线性规划问题。项 $c^{\\text{th}} D_{t}$ 对于决策变量 $P_{t}$ 是一个常数，因此它不影响最优解。解由 $P_{t}$ 的系数 $(\\pi_{t} - c^{\\text{th}})$ 的符号决定。\n\n我们代入给定值：\n-   需求：$D_{t} = 100$ MW\n-   火电成本：$c^{\\text{th}} = 30 \\text{ \\$/MWh}$\n-   水的边际价值：$\\pi_{t} = 60 \\text{ \\$/MWh}$\n\n系数为 $(\\pi_{t} - c^{\\text{th}}) = 60 - 30 = 30$。由于该系数为正，为了最小化目标函数，我们必须在其可行范围内为 $P_{t}$ 选择尽可能小的值。可行范围是 $[0, 100]$。最小值为 $0$。\n因此，最优水力调度为 $P_{t}^{\\star} = 0$ MW。这意味着全部需求应由更便宜的火力发电来满足，即 $P_{t}^{\\text{thermal}\\star} = 100$ MW。\n\n为了按要求使用一阶最优性条件来验证此结果，我们为原问题构建 Karush-Kuhn-Tucker (KKT) 条件。\n问题是：\n$$\\min_{P_t, P_t^{\\text{thermal}}} \\quad c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t$$\n约束条件：\n1.  $P_t + P_t^{\\text{thermal}} - D_t = 0 \\quad (\\text{乘子为 } \\lambda)$\n2.  $-P_t \\le 0 \\quad (\\text{乘子为 } \\mu_1)$\n3.  $-P_t^{\\text{thermal}} \\le 0 \\quad (\\text{乘子为 } \\mu_2)$\n\n拉格朗日函数 $\\mathcal{L}$ 为：\n$$\\mathcal{L}(P_t, P_t^{\\text{thermal}}, \\lambda, \\mu_1, \\mu_2) = c^{\\text{th}} P_t^{\\text{thermal}} + \\pi_t P_t - \\lambda(P_t + P_t^{\\text{thermal}} - D_t) - \\mu_1 P_t - \\mu_2 P_t^{\\text{thermal}}$$\n最优性的 KKT 条件如下：\n\n1.  **驻点条件：**\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t} = \\pi_t - \\lambda - \\mu_1 = 0 \\implies \\lambda = \\pi_t - \\mu_1$$\n    $$\\frac{\\partial \\mathcal{L}}{\\partial P_t^{\\text{thermal}}} = c^{\\text{th}} - \\lambda - \\mu_2 = 0 \\implies \\lambda = c^{\\text{th}} - \\mu_2$$\n2.  **原始可行性：**\n    $$P_t + P_t^{\\text{thermal}} = D_t$$\n    $$P_t \\ge 0, \\quad P_t^{\\text{thermal}} \\ge 0$$\n3.  **对偶可行性：**\n    $$\\mu_1 \\ge 0, \\quad \\mu_2 \\ge 0$$\n4.  **互补松弛性：**\n    $$\\mu_1 P_t = 0$$\n    $$\\mu_2 P_t^{\\text{thermal}} = 0$$\n\n根据驻点条件，我们令 $\\lambda$ 的表达式相等：\n$$\\pi_t - \\mu_1 = c^{\\text{th}} - \\mu_2$$\n$$\\pi_t - c^{\\text{th}} = \\mu_1 - \\mu_2$$\n代入给定值 $c^{\\text{th}} = 30$ 和 $\\pi_{t} = 60$：\n$$60 - 30 = \\mu_1 - \\mu_2 \\implies 30 = \\mu_1 - \\mu_2$$\n这意味着 $\\mu_1 = \\mu_2 + 30$。由于 $\\mu_2 \\ge 0$（对偶可行性），必然有 $\\mu_1 \\ge 30$。\n因为 $\\mu_1$ 是严格正的（$\\mu_1 > 0$），互补松弛性条件 $\\mu_1 P_t = 0$ 要求 $P_t = 0$。\n\n我们来检查一致性。最优水力调度为 $P_{t}^{\\star} = 0$。\n-   根据功率平衡， $P_{t}^{\\text{thermal}\\star} = D_t - P_{t}^{\\star} = 100 - 0 = 100$。\n-   $P_{t}^{\\star} = 0$ 和 $P_{t}^{\\text{thermal}\\star} = 100$ 均满足非负性约束。\n-   由于 $P_{t}^{\\text{thermal}\\star} = 100 > 0$，互补松弛性条件 $\\mu_2 P_t^{\\text{thermal}} = 0$ 要求 $\\mu_2 = 0$。\n-   使用 $\\mu_1 = \\mu_2 + 30$，我们得到 $\\mu_1 = 0 + 30 = 30$。这满足对偶可行性（$\\mu_1 \\ge 0$）。\n-   系统边际价格 $\\lambda$ 可以从任一驻点条件计算得出：\n    $$\\lambda = c^{\\text{th}} - \\mu_2 = 30 - 0 = 30$$\n    $$\\lambda = \\pi_t - \\mu_1 = 60 - 30 = 30$$\n$\\lambda$ 的值是一致的。所有 KKT 条件均得到满足。\n经济学解释是，水电能源的边际成本（$\\pi_t = 60 \\text{ \\$/MWh}$）高于火电能源的边际成本（$c^{\\text{th}} = 30 \\text{ \\$/MWh}$）。因此，系统运营商通过调度最便宜的可用资源，即火力机组，来满足全部需求，从而最小化成本。成本较高的水电资源不被调度。\n\n最优水力调度为 $P_{t}^{\\star} = 0$ MW。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "为什么我们要使用像SDDP这样复杂的随机方法，而不是更简单的确定性模型？最后一个练习将通过引导您计算随机解决方案的价值（VSS）来回答这个关键问题。通过比较一个考虑了不确定性的策略与一个仅使用平均值预测的策略的表现，您将能够量化采用随机优化的实际经济效益 。",
            "id": "4125539",
            "problem": "考虑一个适用于随机对偶动态规划 (SDDP) 求解的两阶段水火电调度问题，其中第二阶段的入流不确定。一个具有恒定水头的单个水库发电，其转换系数为每单位放水量 $1$ 兆瓦时。目标是最小化两个阶段的期望总火电成本。系统数据如下：\n- 初始蓄水量为 $S_{0} = 4$。\n- 阶段 $1$ 的需求为 $D_{1} = 6$。\n- 阶段 $2$ 的需求为 $D_{2} = 6$。\n- 阶段 $1$ 的火电成本为 $c_{1} = 30$，阶段 $2$ 的火电成本为 $c_{2} = 80$ (单位为美元/兆瓦时)。\n- 放水限制为 $0 \\le r_{t} \\le R_{\\max}$，其中对于 $t \\in \\{1,2\\}$，$R_{\\max} = 6$。\n- 阶段 $1$ 的入流为 $0$。\n- 阶段 $2$ 的入流 $\\tilde{I}_{2}$ 是不确定的，存在两种等概率情景：低入流 $I_{2}^{\\mathrm{L}} = 0$，概率为 $p^{\\mathrm{L}} = \\frac{1}{2}$；高入流 $I_{2}^{\\mathrm{H}} = 6$，概率为 $p^{\\mathrm{H}} = \\frac{1}{2}$。没有规划期末的水未来价值，也没有弃水惩罚。\n- 水电和火电可以完全替代以满足需求，电力平衡约束为 $r_{t} + g_{t} = D_{t}$ (对于 $t \\in \\{1,2\\}$)，非负约束为 $g_{t} \\ge 0$。\n\n将从完整随机问题（追索问题）中得到的策略称为随机策略。将确定性期望值解定义为：用 $\\tilde{I}_{2}$ 的期望值 $\\mathbb{E}[\\tilde{I}_{2}]$ 替代随机变量，求解得到的确定性两阶段问题，从而获得第一阶段的决策，然后在随机世界中实施该决策，并采用最优的第二阶段追索。\n\n任务：\n1. 针对此最小化问题，根据随机策略下的期望总成本与实施了追索的确定性期望值策略下的期望总成本，定义随机解的价值 (VSS)。\n2. 根据给定数据计算 VSS，方法如下：\n   - 求解随机策略下的最优第一阶段放水量，并计算其期望总成本。\n   - 求解确定性期望值模型下的最优第一阶段放水量，并计算当此第一阶段决策在随机世界中以最优追索方式实施时的期望总成本。\n   - 根据你对 VSS 的定义计算差值。\n以美元为单位表示最终的 VSS 值，并提供一个实数。如果需要任何近似，请四舍五入到四位有效数字。对于给定的数据，不需要近似。",
            "solution": "用户提供了一个能源系统随机优化领域的适定问题。我将进行形式化的求解。\n\n### 步骤 1：问题验证\n\n**1.1. 已知条件提取**\n- 系统：两阶段水火电调度问题。\n- 目标：最小化期望总火电成本。\n- 初始蓄水量：$S_{0} = 4$。\n- 阶段 1 需求：$D_{1} = 6$。\n- 阶段 2 需求：$D_{2} = 6$。\n- 火电成本，阶段 1：$c_{1} = 30$。\n- 火电成本，阶段 2：$c_{2} = 80$。\n- 水电能量转换系数：每单位水量 $1$ 兆瓦时。\n- 放水限制：$0 \\le r_{t} \\le R_{\\max}$，其中对于 $t \\in \\{1,2\\}$，$R_{\\max} = 6$。\n- 阶段 1 入流：$I_{1} = 0$。\n- 阶段 2 不确定入流 $\\tilde{I}_{2}$：\n    - 情景低 (L)：$I_{2}^{\\mathrm{L}} = 0$，概率为 $p^{\\mathrm{L}} = \\frac{1}{2}$。\n    - 情景高 (H)：$I_{2}^{\\mathrm{H}} = 6$，概率为 $p^{\\mathrm{H}} = \\frac{1}{2}$。\n- 电力平衡：$r_{t} + g_{t} = D_{t}$ (对于 $t \\in \\{1,2\\}$)，其中火电发电量 $g_{t} \\ge 0$。\n- 没有规划期末的未来价值或弃水惩罚。\n\n除了明确的约束之外，一个基本的物理约束是放水量不能超过水库中的可用水量。\n对于阶段 1，这意味着 $r_{1} \\le S_{0} + I_{1}$。给定 $S_{0}=4$ 和 $I_{1}=0$，我们有 $r_{1} \\le 4$。结合给定的放水限制 $r_{1} \\le 6$ 和火电发电量的非负性 $g_{1} = D_{1} - r_{1} = 6 - r_{1} \\ge 0 \\implies r_{1} \\le 6$，第一阶段放水量的有效约束是 $0 \\le r_{1} \\le 4$。\n\n**1.2. 验证结论**\n该问题作为电力系统随机优化的一个标准练习，具有科学依据。它是适定的、客观的、自洽的，提供了所有必要的数据，没有内部矛盾。因此，该问题是 **有效的**。\n\n### 步骤 2：随机解的价值 (VSS) 的定义\n\n随机解的价值 (VSS) 量化了求解完整随机问题相对于求解确定性简化问题的收益。对于这个最小化问题，它被定义为确定性策略的期望成本与最优随机策略的期望成本之间的差值。\n\n令 $Z_{\\mathrm{RP}}$ 为追索问题（完整随机问题）的最优期望成本。这是可实现的最小期望成本。\n令期望值 (EV) 问题为确定性问题，其中随机变量 $\\tilde{I}_{2}$ 被其期望值 $\\mathbb{E}[\\tilde{I}_{2}]$ 替代。令 EV 问题的最优第一阶段决策为 $r_{1}^{\\mathrm{EV}}$。\n期望值解的期望成本 (EEV) 是在真实的随机环境中实施决策 $r_{1}^{\\mathrm{EV}}$，并在第二阶段采取最优追索（行动）时所产生的成本。\n\nVSS 定义为：\n$$\n\\mathrm{VSS} = \\mathrm{EEV} - Z_{\\mathrm{RP}}\n$$\n根据定义，$\\mathrm{VSS} \\ge 0$。\n\n### 步骤 3：VSS 的计算\n\n**3.1. 求解追索问题 (RP) 以得到 $Z_{\\mathrm{RP}}$**\n\n我们使用随机动态规划。该方法从最后阶段向后推导。\n\n**阶段 2：**\n对于给定的初始蓄水量 $S_{1}$ 和入流情景 $s \\in \\{\\mathrm{L}, \\mathrm{H}\\}$，目标是最小化阶段 2 的成本，$C_{2}^{s} = c_{2} g_{2}^{s}$。\n这等同于最大化水电放水量 $r_{2}^{s}$，因为 $g_{2}^{s} = D_{2} - r_{2}^{s} = 6 - r_{2}^{s}$。\n放水量 $r_{2}^{s}$ 受限于水轮机容量 $R_{\\max}=6$ 和可用水量 $S_{1} + I_{2}^{s}$。\n因此，最优放水量为 $r_{2}^{s,*} = \\min(R_{\\max}, S_{1} + I_{2}^{s}) = \\min(6, S_{1} + I_{2}^{s})$。\n最优发电量为 $g_{2}^{s,*} = 6 - r_{2}^{s,*}$。\n对于给定的 $S_1$ 和情景 $s$，最小的阶段 2 成本为 $Q_{2}^{s}(S_{1}) = c_{2} g_{2}^{s,*} = 80 \\cdot (6 - \\min(6, S_{1} + I_{2}^{s})) = 80 \\cdot \\max(0, 6 - S_{1} - I_{2}^{s})$。\n\n从阶段 1 来看，未来期望成本函数 $\\mathcal{F}_{2}(S_1)$ 是这些最小成本在所有情景下的期望值：\n$\\mathcal{F}_{2}(S_1) = \\mathbb{E}[Q_{2}(\\tilde{I}_2, S_1)] = p^{\\mathrm{L}} Q_{2}^{\\mathrm{L}}(S_{1}) + p^{\\mathrm{H}} Q_{2}^{\\mathrm{H}}(S_{1})$\n$\\mathcal{F}_{2}(S_1) = \\frac{1}{2} \\cdot 80 \\cdot \\max(0, 6 - S_{1} - 0) + \\frac{1}{2} \\cdot 80 \\cdot \\max(0, 6 - S_{1} - 6)$\n$\\mathcal{F}_{2}(S_1) = 40 \\max(0, 6 - S_{1}) + 40 \\max(0, -S_{1})$。\n\n**阶段 1：**\n目标是最小化阶段 1 成本与未来期望成本之和：\n$J(r_{1}) = c_{1} g_{1} + \\mathcal{F}_{2}(S_{1})$\n状态变量 $S_{1}$ 由阶段 1 的放水量 $r_{1}$ 决定：$S_{1} = S_{0} + I_{1} - r_{1} = 4 + 0 - r_{1} = 4 - r_{1}$。\n阶段 1 的火电发电量为 $g_{1} = D_{1} - r_{1} = 6 - r_{1}$。\n$r_{1}$ 的可行范围是 $[0, 4]$。对于此范围内的任何 $r_{1}$，$S_{1} = 4 - r_{1}$ 都在 $[0, 4]$ 范围内。\n因此，$S_{1} \\ge 0 \\implies \\max(0, -S_{1}) = 0$，并且 $6-S_1 > 0 \\implies \\max(0, 6-S_1) = 6-S_1$。\n未来期望成本简化为 $\\mathcal{F}_{2}(S_1) = 40(6 - S_{1})$。\n代入 $S_{1} = 4 - r_{1}$：$\\mathcal{F}_{2}(4 - r_{1}) = 40(6 - (4 - r_{1})) = 40(2 + r_{1}) = 80 + 40r_{1}$。\n阶段 1 的问题是最小化：\n$J(r_{1}) = c_{1}(D_{1} - r_{1}) + 80 + 40r_{1}$\n$J(r_{1}) = 30(6 - r_{1}) + 80 + 40r_{1}$\n$J(r_{1}) = 180 - 30r_{1} + 80 + 40r_{1} = 260 + 10r_{1}$。\n\n为了在区间 $r_{1} \\in [0, 4]$ 上最小化 $J(r_{1})$，我们必须为 $r_1$ 选择可能的最小值，因为成本函数是严格递增的。\n随机问题的最优第一阶段放水量是 $r_{1}^{\\mathrm{RP}} = 0$。\n\n最小期望总成本 $Z_{\\mathrm{RP}}$ 为 $J(0) = 260 + 10(0) = 260$。\n所以，$Z_{\\mathrm{RP}} = 260$。\n\n**3.2. 求解 EEV**\n\n首先，我们求解确定性期望值 (EV) 问题。我们将随机入流 $\\tilde{I}_{2}$ 替换为其期望值：\n$\\mathbb{E}[\\tilde{I}_{2}] = p^{\\mathrm{L}} I_{2}^{\\mathrm{L}} + p^{\\mathrm{H}} I_{2}^{\\mathrm{H}} = \\frac{1}{2}(0) + \\frac{1}{2}(6) = 3$。\n\nEV 问题是一个确定性的两阶段问题：\n最小化 $C = c_{1}g_{1} + c_{2}g_{2} = 30(6 - r_{1}) + 80(6 - r_{2})$\n约束条件：\n$0 \\le r_{1} \\le 4$\n$S_{1} = 4 - r_{1}$\n$0 \\le r_{2} \\le \\min(R_{\\max}, S_{1} + \\mathbb{E}[\\tilde{I}_{2}]) = \\min(6, (4-r_1) + 3) = \\min(6, 7-r_1)$。\n\n为了最小化成本，我们必须决定如何在两个阶段之间分配总可用水量 $S_0 + I_1 + \\mathbb{E}[\\tilde{I}_{2}] = 4+0+3=7$ 个单位。在阶段 1 使用的水可以替代成本为 $c_1=30$ 的发电，而在阶段 2 使用的水可以替代成本为 $c_2=80$ 的发电。由于 $c_2 > c_1$，水在阶段 2 更有价值。我们应该优先在阶段 2 用水。\n阶段 2 的最大放水量为 $r_2=6$。为实现这一点，需要满足 $7-r_1 \\ge 6$，即 $r_1 \\le 1$。我们总共有 $7$ 个单位的水；如果在阶段 2 使用 $6$ 个单位，则阶段 1 还剩下 $1$ 个单位。这给出了候选解 $(r_1, r_2) = (1, 6)$。这是可行的，因为 $0 \\le 1 \\le 4$。\n该策略在成本更高的时期最大化了用水量，因此对于确定性问题必定是最优的。\nEV 问题的最优第一阶段放水量是 $r_{1}^{\\mathrm{EV}} = 1$。\n\n现在，我们在真实的随机世界中实施 $r_{1}^{\\mathrm{EV}} = 1$ 来计算 EEV。\n**阶段 1：**\n- 放水量：$r_{1} = 1$。\n- 火电发电量：$g_{1} = D_{1} - r_{1} = 6 - 1 = 5$。\n- 成本：$C_{1} = c_{1} g_{1} = 30 \\cdot 5 = 150$。\n- 阶段末蓄水量：$S_{1} = S_{0} - r_{1} = 4 - 1 = 3$。\n\n**阶段 2 (采用最优追索)：**\n- **情景 L ($I_{2}^{\\mathrm{L}}=0$)：**\n    - 可用水量：$S_{1} + I_{2}^{\\mathrm{L}} = 3 + 0 = 3$。\n    - 最优放水量：$r_{2}^{\\mathrm{L}} = \\min(6, 3) = 3$。\n    - 火电发电量：$g_{2}^{\\mathrm{L}} = D_{2} - r_{2}^{\\mathrm{L}} = 6 - 3 = 3$。\n    - 成本：$C_{2}^{\\mathrm{L}} = c_{2} g_{2}^{\\mathrm{L}} = 80 \\cdot 3 = 240$。\n- **情景 H ($I_{2}^{\\mathrm{H}}=6$)：**\n    - 可用水量：$S_{1} + I_{2}^{\\mathrm{H}} = 3 + 6 = 9$。\n    - 最优放水量：$r_{2}^{\\mathrm{H}} = \\min(6, 9) = 6$。\n    - 火电发电量：$g_{2}^{\\mathrm{H}} = D_{2} - r_{2}^{\\mathrm{H}} = 6 - 6 = 0$。\n    - 成本：$C_{2}^{\\mathrm{H}} = c_{2} g_{2}^{\\mathrm{H}} = 80 \\cdot 0 = 0$。\n\n阶段 2 的期望成本为 $\\mathbb{E}[C_{2}] = p^{\\mathrm{L}} C_{2}^{\\mathrm{L}} + p^{\\mathrm{H}} C_{2}^{\\mathrm{H}} = \\frac{1}{2}(240) + \\frac{1}{2}(0) = 120$。\nEV 策略的总期望成本 (EEV) 为：\n$\\mathrm{EEV} = C_{1} + \\mathbb{E}[C_{2}] = 150 + 120 = 270$。\n\n**3.3. 最终 VSS 计算**\n\n使用 VSS 的定义：\n$\\mathrm{VSS} = \\mathrm{EEV} - Z_{\\mathrm{RP}} = 270 - 260 = 10$。\n\n随机解的价值为 $10$ 美元。这表明，与基于平均入流的确定性策略相比，明确地对入流不确定性进行建模可以带来 $10$ 的期望成本节省。随机策略更为保守（为不确定的未来节省所有水），并且平均表现更好。",
            "answer": "$$\\boxed{10}$$"
        }
    ]
}