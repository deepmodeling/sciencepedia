{
    "hands_on_practices": [
        {
            "introduction": "任何交易能源平台的核心操作都是市场出清。本练习演示了供需均衡的基本原理，即市场通过寻找一个统一的价格，使得所有产消者提供的总能量等于所有消费者需求的总能量。通过这个计算，学生将对一个简化的点对点能源市场中价格和数量的决定方式获得基础性的量化理解。",
            "id": "4072829",
            "problem": "一个分布式能源（DER）微电网在一个时长为 $1$ 小时的单一结算周期内，运行一个基于区块链的交易能源平台。该平台使用部署在分布式账本技术（DLT）上的智能合约（SC）来清算产消者和消费者之间的连续双向拍卖。在单母线、无损网络的假设下，区域边际电价（LMP）对所有参与者是统一的，并且根据基尔霍夫电流定律，功率平衡约束要求在出清价格下总供给等于总需求。智能合约强制要求出价为单调的供给和需求计划，并在交易量为非负的约束下，执行一个福利最大化的统一价格出清。\n\n现有 $3$ 个产消者，其供给计划为 $S_1(p)=2p$, $S_2(p)=p+1$, $S_3(p)=3$，表示以 $\\text{MWh}$ 为单位的供给能量，是统一价格 $p$（单位为 $\\$/\\text{MWh}$）的函数。现有 $2$ 个消费者，其需求计划为 $D_1(p)=5-2p$ 和 $D_2(p)=4-p$，表示以 $\\text{MWh}$ 为单位的需求能量，是相同统一价格 $p$ 的函数。\n\n假设：(i) 无网络损耗，(ii) 链上无交易或结算费用，(iii) $p \\ge 0$，以及 (iv) 智能合约在唯一价格 $p^{\\ast}$ 处进行出清，该价格下总供给等于总需求，并且由 $p^{\\ast}$ 决定的所有个体交易量均为非负。\n\n从能量平衡原理和计划的单调性出发，推导出出清价格 $p^{\\ast}$ 和总交易量 $Q^{\\ast}$ 的闭式解。提供精确值，不要四舍五入。将出清价格以 $\\$/\\text{MWh}$ 表示，总交易量以 $\\text{MWh}$ 表示。",
            "solution": "首先对问题进行验证。\n\n**步骤1：提取已知条件**\n- 结算周期时长：$1$ 小时。\n- 平台：基于区块链的交易能源平台，使用部署在分布式账本技术（DLT）上的智能合约（SC）。\n- 拍卖机制：连续双向拍卖，以统一价格出清。\n- 网络模型：单母线、无损。\n- 定价模型：统一的区域边际电价（LMP），用 $p$ 表示，单位为 $\\$/\\text{MWh}$。\n- 控制原理：功率平衡约束（源于基尔霍夫电流定律），总供给等于总需求。\n- 产消者供给计划（能量单位为 $\\text{MWh}$）：\n  - $S_1(p) = 2p$\n  - $S_2(p) = p+1$\n  - $S_3(p) = 3$\n- 消费者需求计划（能量单位为 $\\text{MWh}$）：\n  - $D_1(p) = 5-2p$\n  - $D_2(p) = 4-p$\n- 假设：\n  - (i) 无网络损耗。\n  - (ii) 无交易或结算费用。\n  - (iii) 价格为非负， $p \\ge 0$。\n  - (iv) 智能合约在唯一价格 $p^{\\ast}$ 处进行出清，该价格下总供给等于总需求，并且所有个体交易量均为非负。\n- 目标：推导出出清价格 $p^{\\ast}$ 和总交易量 $Q^{\\ast}$ 的闭式解。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题具有科学依据，借鉴了微观经济学（供需平衡、市场出清）和电气工程（电力系统建模）的既定原则。在区块链上实施交易能源市场的概念是当前能源系统的研究领域，所提出的模型虽然经过简化（例如，无损、单母线），却是从基础层面分析此类系统的标准方法。该问题是适定的；它提供了确定唯一解所需的所有数学函数和约束。给定的供给和需求计划是线性的，这通常会导致唯一的市场出清点。问题陈述客观，术语精确。它没有科学缺陷、矛盾或含糊之处。所有假设都已明确列出。在出清价格下交易量为非负是一个需要验证的条件，但它不会使问题变得不适定。\n\n**步骤3：结论与行动**\n问题被认为是有效的。将推导解答。\n\n市场出清的核心原则是市场均衡，即产消者供给的总能量等于消费者需求的总能量。这个均衡点决定了统一出清价格 $p^{\\ast}$ 和总交易量 $Q^{\\ast}$。问题指出，这是由智能合约在功率平衡约束下强制执行的。\n\n首先，我们通过将3个产消者的个体供给计划相加来确定总供给计划 $S_{agg}(p)$：\n$$S_{agg}(p) = S_1(p) + S_2(p) + S_3(p)$$\n代入给定的函数：\n$$S_{agg}(p) = (2p) + (p+1) + 3$$\n$$S_{agg}(p) = 3p + 4$$\n这个总供给函数在 $p \\ge 0$ 时有效。\n\n接下来，我们通过将2个消费者的个体需求计划相加来确定总需求计划 $D_{agg}(p)$：\n$$D_{agg}(p) = D_1(p) + D_2(p)$$\n代入给定的函数：\n$$D_{agg}(p) = (5-2p) + (4-p)$$\n$$D_{agg}(p) = 9 - 3p$$\n这个总需求函数在个体需求为非负的价格范围内有效。$D_1(p) \\ge 0$ 意味着 $5-2p \\ge 0$，即 $p \\le 2.5$。$D_2(p) \\ge 0$ 意味着 $4-p \\ge 0$，即 $p \\le 4$。因此，为使两个需求都为非负，价格必须满足 $p \\le 2.5$。\n\n市场在总供给等于总需求的价格 $p^{\\ast}$ 处出清：\n$$S_{agg}(p^{\\ast}) = D_{agg}(p^{\\ast})$$\n代入推导出的总函数：\n$$3p^{\\ast} + 4 = 9 - 3p^{\\ast}$$\n为了解出 $p^{\\ast}$，我们整理方程：\n$$3p^{\\ast} + 3p^{\\ast} = 9 - 4$$\n$$6p^{\\ast} = 5$$\n$$p^{\\ast} = \\frac{5}{6}$$\n\n我们现在必须验证这个出清价格是否与问题的假设一致。\n1.  价格为非负：$p^{\\ast} = \\frac{5}{6} \\ge 0$。此条件满足。\n2.  所有个体交易量均为非负。我们在 $p^{\\ast} = \\frac{5}{6}$ 处对每个参与者进行检查：\n- $S_1(\\frac{5}{6}) = 2 \\left( \\frac{5}{6} \\right) = \\frac{10}{6} = \\frac{5}{3} \\ge 0$.\n- $S_2(\\frac{5}{6}) = \\frac{5}{6} + 1 = \\frac{11}{6} \\ge 0$.\n- $S_3(\\frac{5}{6}) = 3 \\ge 0$.\n- $D_1(\\frac{5}{6}) = 5 - 2 \\left( \\frac{5}{6} \\right) = 5 - \\frac{10}{6} = 5 - \\frac{5}{3} = \\frac{15-5}{3} = \\frac{10}{3} \\ge 0$.\n- $D_2(\\frac{5}{6}) = 4 - \\frac{5}{6} = \\frac{24-5}{6} = \\frac{19}{6} \\ge 0$.\n所有个体交易量均为非负，且价格在需求函数的有效域内（$p^{\\ast} = \\frac{5}{6} \\approx 0.833$，小于 $2.5$）。所有条件都得到满足。唯一的出清价格是 $p^{\\ast} = \\frac{5}{6} \\text{ \\$/MWh}$。\n\n最后，我们通过将 $p^{\\ast}$ 代入总供给或总需求函数来计算总交易量 $Q^{\\ast}$。\n使用总供给函数：\n$$Q^{\\ast} = S_{agg}(p^{\\ast}) = 3p^{\\ast} + 4 = 3 \\left( \\frac{5}{6} \\right) + 4 = \\frac{15}{6} + 4 = \\frac{5}{2} + 4 = \\frac{5}{2} + \\frac{8}{2} = \\frac{13}{2}$$\n为了验证，我们使用总需求函数：\n$$Q^{\\ast} = D_{agg}(p^{\\ast}) = 9 - 3p^{\\ast} = 9 - 3 \\left( \\frac{5}{6} \\right) = 9 - \\frac{15}{6} = 9 - \\frac{5}{2} = \\frac{18}{2} - \\frac{5}{2} = \\frac{13}{2}$$\n两种计算得出了相同的结果。总出清量为 $Q^{\\ast} = \\frac{13}{2} \\text{ MWh}$。\n\n出清价格为 $p^{\\ast} = \\frac{5}{6}$，总交易量为 $Q^{\\ast} = \\frac{13}{2}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{5}{6}  \\frac{13}{2}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在市场均衡概念的基础上，我们可以使用优化理论来更正式地构建出清过程。本练习探讨了如何将市场出清建模为一个社会福利最大化问题，其目标是最大化所有参与者的总效益（效用减去成本）。通过推导卡罗需-库恩-塔克（KKT）条件，该练习揭示了市场价格如何作为能源平衡约束上的拉格朗日乘子（即“影子价格”）自然产生。",
            "id": "4072842",
            "problem": "一个单周期、单节点的交互式能源（Transactive Energy, TE）市场通过智能合约在基于区块链的结算层上实现。该平台清算一个聚合买方和一个聚合卖方之间的交易。聚合买方在已清算需求 $d \\geq 0$ 方面拥有一个严格凹的效用函数 $U(d)$，而聚合卖方在已清算供应 $s \\geq 0$ 方面拥有一个严格凸的成本函数 $C(s)$。在区块链上进行结算时，每单位交易的能源需要支付单位协议费 $\\phi \\geq 0$，该费用由结算层消耗（即不重新分配给市场参与者），因此会减少总社会福利。\n\n假设聚合效用和成本是二次函数：\n$$U(d) = \\alpha d - \\frac{\\beta}{2} d^{2}, \\quad \\alpha  0, \\ \\beta  0,$$\n$$C(s) = \\gamma s + \\frac{\\delta}{2} s^{2}, \\quad \\gamma \\geq 0, \\ \\delta  0.$$\n\n该平台通过最大化扣除区块链结算费后的总社会福利来清算市场，并受限于能量平衡和决策的非负性约束：\n$$\\max_{s,d} \\; \\left[ U(d) - C(s) - \\phi s \\right] \\quad \\text{subject to} \\quad s - d = 0, \\ s \\geq 0, \\ d \\geq 0.$$\n\n从凸性和凹性的定义、边际效用和边际成本的解释，以及约束优化的的一阶最优性框架出发，推导该市场出清问题的 Karush–Kuhn–Tucker (KKT) 条件。将与能量平衡约束相关的拉格朗日乘子解释为由智能合约在链上实现的市场价格信号，并根据 KKT 的平稳性关系证明这一解释的合理性。\n\n假设参数满足 $\\alpha - \\gamma - \\phi  0$，因此社会最优解具有严格为正的交易量。在这种内部解的情况下，求解 KKT 系统，以获得区块链出清价格 $\\lambda^{\\star}$ 作为 $(\\alpha,\\beta,\\gamma,\\delta,\\phi)$ 函数的封闭形式表达式。以 $\\lambda^{\\star}$ 的单个解析表达式形式提供最终答案，无需进行数值计算。$\\lambda^{\\star}$ 的经济单位是货币/千瓦时，但您应只提供符号表达式；无需四舍五入，最终表达式也不应附加单位。",
            "solution": "用户提供了一个来自能源系统建模和微观经济理论领域的适定问题。一个严谨的数学解所需的所有组成部分都已具备，该问题在科学和数学上都是合理的。\n\n问题在于通过解决一个社会福利最大化问题，来找到单节点交互式能源市场的市场出清价格。该优化问题表述为：\n$$\n\\max_{s,d} \\; W(s,d) = U(d) - C(s) - \\phi s\n$$\n受限于以下约束：\n$$\ns - d = 0 \\\\\ns \\geq 0 \\\\\nd \\geq 0\n$$\n其中效用和成本函数由下式给出：\n$$\nU(d) = \\alpha d - \\frac{\\beta}{2} d^{2}, \\quad \\alpha  0, \\ \\beta  0\n$$\n$$\nC(s) = \\gamma s + \\frac{\\delta}{2} s^{2}, \\quad \\gamma \\geq 0, \\ \\delta  0\n$$\n项 $\\phi \\geq 0$ 是单位交易费。目标函数 $W(s,d)$ 代表总社会福利，即买方的效用减去卖方的生产成本和结算费。由于 $U(d)$ 是关于 $d$ 的严格凹函数（其二阶导数 $U''(d) = -\\beta  0$），且 $-C(s) - \\phi s$ 是关于 $s$ 的严格凹函数（其二阶导数 $-C''(s) = -\\delta  0$），目标函数 $W(s,d)$ 在 $(s,d)$ 上是严格凹的。这些约束定义了一个凸集。这是一个凸优化问题，保证了唯一解的存在。\n\n为了推导 Karush–Kuhn–Tucker (KKT) 条件，我们首先构建拉格朗日函数。为了使拉格朗日乘子与价格的经济学解释保持一致，我们将能量平衡约束写为 $d - s = 0$。我们将拉格朗日乘子 $\\lambda$ 与此等式约束关联，将乘子 $\\mu_s$ 和 $\\mu_d$ 分别与非负性约束 $-s \\leq 0$ 和 $-d \\leq 0$ 关联。\n\n拉格朗日函数 $\\mathcal{L}$ 为：\n$$\n\\mathcal{L}(s, d, \\lambda, \\mu_s, \\mu_d) = U(d) - C(s) - \\phi s - \\lambda(d-s) - \\mu_s(-s) - \\mu_d(-d)\n$$\n代入给定的函数：\n$$\n\\mathcal{L}(s, d, \\lambda, \\mu_s, \\mu_d) = \\left(\\alpha d - \\frac{\\beta}{2} d^{2}\\right) - \\left(\\gamma s + \\frac{\\delta}{2} s^{2}\\right) - \\phi s - \\lambda(d-s) + \\mu_s s + \\mu_d d\n$$\n\nKKT 条件由平稳性、原始可行性、对偶可行性和互补松弛性组成。\n\n1.  **平稳性 (Stationarity)**：拉格朗日函数关于决策变量 $s$ 和 $d$ 的偏导数在最优点 $(s^{\\star}, d^{\\star})$ 必须为零。\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial s} = - \\frac{dC(s^{\\star})}{ds} - \\phi + \\lambda + \\mu_s = -(\\gamma + \\delta s^{\\star}) - \\phi + \\lambda + \\mu_s = 0\n    $$\n    $$\n    \\frac{\\partial \\mathcal{L}}{\\partial d} = \\frac{dU(d^{\\star})}{dd} - \\lambda + \\mu_d = (\\alpha - \\beta d^{\\star}) - \\lambda + \\mu_d = 0\n    $$\n\n2.  **原始可行性 (Primal Feasibility)**：最优解必须满足所有约束条件。\n    $$\n    d^{\\star} - s^{\\star} = 0\n    $$\n    $$\n    s^{\\star} \\geq 0\n    $$\n    $$\n    d^{\\star} \\geq 0\n    $$\n\n3.  **对偶可行性 (Dual Feasibility)**：不等式约束的拉格朗日乘子必须为非负。\n    $$\n    \\mu_s \\geq 0\n    $$\n    $$\n    \\mu_d \\geq 0\n    $$\n\n4.  **互补松弛性 (Complementary Slackness)**：每个不等式约束乘子与其对应松弛量的乘积必须为零。\n    $$\n    \\mu_s s^{\\star} = 0\n    $$\n    $$\n    \\mu_d d^{\\star} = 0\n    $$\n\n现在，我们来解释拉格朗日乘子 $\\lambda$。项 $\\frac{dU}{dd} = U'(d)$ 是边际效用，代表买方为额外一单位能源愿意支付的价格。项 $\\frac{dC}{ds} = C'(s)$ 是边际成本，代表卖方生产额外一单位能源可接受的最低价格。\n\n平稳性条件可以改写为：\n$$\n\\lambda + \\mu_s = C'(s^{\\star}) + \\phi = \\gamma + \\delta s^{\\star} + \\phi\n$$\n$$\n\\lambda - \\mu_d = U'(d^{\\star}) = \\alpha - \\beta d^{\\star}\n$$\n问题指定我们在一个内部解机制下操作，其中交易量严格为正，即 $s^{\\star}  0$ 且 $d^{\\star}  0$。根据互补松弛性条件，如果 $s^{\\star}  0$，则 $\\mu_s$ 必须为 $0$。如果 $d^{\\star}  0$，则 $\\mu_d$ 必须为 $0$。假设 $\\alpha - \\gamma - \\phi  0$ 确保了这种机制，因为零交易解将产生零福利，而任何接近于零的正交易量 $q0$ 产生的福利约为 $(\\alpha - \\gamma - \\phi)q  0$。\n\n在这种内部解的假设下（$\\mu_s=0, \\mu_d=0$），平稳性关系简化为：\n$$\n\\lambda^{\\star} = C'(s^{\\star}) + \\phi\n$$\n$$\n\\lambda^{\\star} = U'(d^{\\star})\n$$\n这为 $\\lambda^{\\star}$ 提供了清晰的经济学解释。它是在这个价格上，买方的边际效用等于卖方的边际成本（包括交易费）。智能合约通过解决这个优化问题，确定一个统一的出清价格 $\\lambda^{\\star}$，以平衡供需。买方消费直到其边际效益 $U'(d^{\\star})$ 下降到价格 $\\lambda^{\\star}$。卖方生产直到其有效边际成本 $C'(s^{\\star}) + \\phi$ 上升到价格 $\\lambda^{\\star}$。这证明了将 $\\lambda^{\\star}$ 解释为区块链出清价格的合理性。\n\n最后，我们使用这个简化的方程组求解 $\\lambda^{\\star}$。根据能量平衡约束，令出清量为 $q^{\\star} = s^{\\star} = d^{\\star}$。\n\n从第一个简化的平稳性方程得出：\n$$\n\\lambda^{\\star} = \\alpha - \\beta d^{\\star} \\implies \\beta d^{\\star} = \\alpha - \\lambda^{\\star} \\implies d^{\\star} = \\frac{\\alpha - \\lambda^{\\star}}{\\beta}\n$$\n\n从第二个简化的平稳性方程得出：\n$$\n\\lambda^{\\star} = \\gamma + \\delta s^{\\star} + \\phi \\implies \\delta s^{\\star} = \\lambda^{\\star} - \\gamma - \\phi \\implies s^{\\star} = \\frac{\\lambda^{\\star} - \\gamma - \\phi}{\\delta}\n$$\n\n由于 $d^{\\star} = s^{\\star}$，我们可以将它们的表达式相等：\n$$\n\\frac{\\alpha - \\lambda^{\\star}}{\\beta} = \\frac{\\lambda^{\\star} - \\gamma - \\phi}{\\delta}\n$$\n\n我们现在求解这个关于 $\\lambda^{\\star}$ 的线性方程：\n$$\n\\delta(\\alpha - \\lambda^{\\star}) = \\beta(\\lambda^{\\star} - \\gamma - \\phi)\n$$\n$$\n\\alpha\\delta - \\delta\\lambda^{\\star} = \\beta\\lambda^{\\star} - \\beta\\gamma - \\beta\\phi\n$$\n将所有包含 $\\lambda^{\\star}$ 的项移到一边：\n$$\n\\alpha\\delta + \\beta\\gamma + \\beta\\phi = \\beta\\lambda^{\\star} + \\delta\\lambda^{\\star}\n$$\n$$\n\\alpha\\delta + \\beta(\\gamma + \\phi) = (\\beta + \\delta)\\lambda^{\\star}\n$$\n分离出 $\\lambda^{\\star}$，得到出清价格的封闭形式表达式：\n$$\n\\lambda^{\\star} = \\frac{\\alpha\\delta + \\beta\\gamma + \\beta\\phi}{\\beta + \\delta}\n$$\n该表达式是在给定的二次效用/成本结构和单位交易费下的社会最优出清价格。",
            "answer": "$$\n\\boxed{\\frac{\\alpha\\delta + \\beta\\gamma + \\beta\\phi}{\\beta + \\delta}}\n$$"
        },
        {
            "introduction": "在区块链上实现能源市场会引入与底层共识机制相关的独特约束。本练习探讨了在工作量证明（PoW）区块链中，交易终局性与结算频率之间的关键权衡。它运用一个基于有偏随机游走的概率模型来分析链重组攻击的风险，迫使我们思考安全参数（如确认数）如何影响平台在近实时能源交易中的可行性。",
            "id": "4072815",
            "problem": "一个微电网规模的交易能源平台在区块链上每隔 $\\Delta t$ 秒的结算间隔执行一次市场出清。该平台要求任何已提交的交易在下次出清前达到最终性，以避免结算逆转。考虑一个工作量证明（PoW）区块链，其中每个区块要么由诚实多数派生成，要么由对手生成。设诚实算力比例为 $p$，对手算力比例为 $q$，满足 $p+q=1$ 和 $0  q  p  1$。如果一笔交易被包含在一个区块中，并且其后又附加了 $z-1$ 个区块，则称该交易有 $z$ 个确认。平台选择满足 $z \\cdot T_b \\leq \\Delta t$ 的最大整数 $z$ 作为其确认要求，其中 $T_b$ 是平均出块时间。为保证可靠性，在获得 $z$ 个确认后，对手成功创建更长链（即重组交易历史）的概率必须不大于 $\\varepsilon = 1.0 \\times 10^{-6}$。\n\n基于将对手与诚实网络之间的竞赛建模为有偏随机游走的第一性原理，考虑边界情况 $T_b = \\Delta t/3$（因此 $z=3$）。计算允许的最大对手算力比例 $q_{\\max}$，使得交易能以所需可靠性达到最终性。以四舍五入到四位有效数字的小数形式给出答案。",
            "solution": "### 第1步：提取已知信息\n- 结算间隔：$\\Delta t$ 秒\n- 区块链是工作量证明（PoW）。\n- 诚实挖矿比例：$p$\n- 对手挖矿比例：$q$\n- 比例条件：$p+q=1$ 且 $0  q  p  1$。\n- 最终性定义：一笔交易在获得 $z$ 个连续确认后是最终的。\n- 出块时间：$T_b$ 秒\n- 选择 $z$ 的条件：平台选择满足 $z \\cdot T_b \\leq \\Delta t$ 的最大整数 $z$。\n- 可靠性要求：在 $z$ 个确认后，对手重组链的概率不得大于 $\\varepsilon$。\n- 可靠性目标：$\\varepsilon = 1.0 \\times 10^{-6}$。\n- 分析模型：基于区块数量差异的有偏随机游走的第一性原理。\n- 特定场景：分析 $T_b = \\Delta t/3$ 的情况。\n- 最坏情况边界条件：$T_b = \\Delta t/3$，这意味着 $z=3$。\n- 目标：找出允许的最大对手算力比例 $q_{\\max}$，使得当 $z=3$ 时，对手追赶上的概率 $\\leq \\varepsilon$。\n- 最终答案格式：四舍五入到四位有效数字的小数。\n\n### 第2步：使用提取的已知信息进行验证\n根据验证标准评估问题陈述。\n\n1.  **科学基础**：该问题在科学上是合理的。它模拟了PoW区块链对抗“51%攻击”（或更准确地说，是链重组攻击）的安全性。使用有偏随机游走来模拟攻击者与诚实网络之间的竞赛，是区块链技术基础文献中确立的经典方法。将其应用于交易能源平台是区块链的一个现实用例。\n\n2.  **适定性与一致性**：该问题在很大程度上是适定的，但包含一个模糊点。它指出平台选择“满足 $z\\,T_b \\leq \\Delta t$ 的最小整数 $z$”。对于任何 $T_b  \\Delta t$ 的非平凡情况，最小的正整数将是 $z=1$，这提供的安全性极低。然而，问题稍后指定考虑边界情况 $T_b = \\Delta t/3$ 并明确说明“（因此 $z=3$）”。这个后续的澄清意味着平台实际上选择了在时间约束 $\\Delta t$ 内所能容纳的*最大*可能整数值 $z$。如果 $T_b = \\Delta t/3$，则 $z \\cdot T_b \\leq \\Delta t$ 变为 $z(\\Delta t/3) \\leq \\Delta t$，简化为 $z \\leq 3$。满足此条件的最大整数 $z$ 是 $z=3$。这种解释使得问题一致且可解。没有这种解释，问题将因矛盾而变得不适定。我将在此合理解释下继续。所有其他条件和数据都是一致的，足以找到唯一解。\n\n3.  **客观性**：问题以精确、客观和定量的术语陈述，没有任何主观或有偏见的语言。\n\n4.  **其他缺陷**：该问题不违反任何其他标准。它没有过度使用隐喻，与指定主题直接相关，（在上述澄清后）不是不完整的，并且不是微不足道的。\n\n### 第3步：结论与行动\n在将确认数 $z$ 解释为满足时间约束的最大整数的逻辑下，该问题被判定为**有效**。可以继续求解过程。\n\n问题要求在确认数要求为 $z=3$ 和可靠性目标为 $\\varepsilon = 1.0 \\times 10^{-6}$ 的情况下，求出允许的最大对手算力比例 $q_{\\max}$。\n\n问题的核心在于分析拥有集体算力比例 $p$ 的诚实矿工与拥有算力比例 $q$ 的对手之间的竞赛。由于PoW系统中的区块发现是一个无记忆的泊松过程，因此下一个区块由对手找到的概率是 $q$，由诚实网络找到的概率是 $p = 1-q$。\n\n我们将此场景建模为有偏随机游走。设系统的状态为诚实链相对于对手私有链领先的区块数。在一笔交易收到 $z$ 个确认后，诚实链领先 $z$ 个区块。如果对手能够创建一个比诚实链更长的链，他们就成功了，这意味着他们必须首先追上（弥合 $z$ 个区块的差距），然后再超越。\n\n拥有算力比例 $q$ 的对手从 $z$ 个区块的劣势追上拥有算力比例 $p$ 的诚实网络的概率 $\\mathcal{P}$，由经典的赌徒破产公式给出。这种情况相当于一个拥有有限资金的赌徒与一个无限富有的对手对赌。对手是赌徒，“追上”即为破产。然而，在这个具体表述中，攻击者的成功是达到零差距的状态。\n\n设 $P_i$ 为攻击者最终弥合 $i$ 个区块差距的概率。该过程根据以下递推关系演化：\n$$P_i = q \\cdot P_{i-1} + p \\cdot P_{i+1}$$\n其中 $P_{i-1}$ 是从 $i-1$ 的劣势（如果攻击者找到下一个区块）成功追上的概率，而 $P_{i+1}$ 是从 $i+1$ 的劣势（如果诚实链找到下一个区块）成功追上的概率。边界条件是 $P_0 = 1$（一个没有劣势的攻击者已经“追上”了）和 $\\lim_{i \\to \\infty} P_i = 0$（一个无限落后的攻击者无法追上，因为 $p > q$）。\n\n这个递推关系的通解是 $P_i = A + B\\left(\\frac{q}{p}\\right)^i$。在无穷远处的边界条件意味着 $A=0$。条件 $P_0=1$ 得出 $B=1$。因此，对手从 $i$ 个区块的劣势追上的概率是：\n$$P_i = \\left(\\frac{q}{p}\\right)^i$$\n对于我们的问题，交易有 $z$ 个确认，所以初始劣势是 $z$。一次成功的重组攻击的概率 $\\mathcal{P}_{\\text{attack}}$ 是：\n$$\\mathcal{P}_{\\text{attack}} = \\left(\\frac{q}{p}\\right)^z$$\n我们被给予的可靠性约束是这个概率必须不大于 $\\varepsilon$。\n$$\\left(\\frac{q}{p}\\right)^z \\leq \\varepsilon$$\n问题指定了 $z=3$ 和 $\\varepsilon = 1.0 \\times 10^{-6}$ 的场景。我们试图找到满足此条件的 $q$ 的最大可能值，记为 $q_{\\max}$。最大值在不等式的边界处找到：\n$$\\left(\\frac{q_{\\max}}{p_{\\max}}\\right)^3 = \\varepsilon$$\n由于 $p+q=1$，我们有 $p_{\\max} = 1 - q_{\\max}$。将此代入方程：\n$$\\left(\\frac{q_{\\max}}{1-q_{\\max}}\\right)^3 = \\varepsilon$$\n为了解出 $q_{\\max}$，我们首先对两边取立方根：\n$$\\frac{q_{\\max}}{1-q_{\\max}} = \\varepsilon^{1/3}$$\n现在，我们进行代数操作来分离 $q_{\\max}$：\n$$q_{\\max} = \\varepsilon^{1/3} (1 - q_{\\max})$$\n$$q_{\\max} = \\varepsilon^{1/3} - \\varepsilon^{1/3} q_{\\max}$$\n$$q_{\\max} + \\varepsilon^{1/3} q_{\\max} = \\varepsilon^{1/3}$$\n$$q_{\\max}(1 + \\varepsilon^{1/3}) = \\varepsilon^{1/3}$$\n$$q_{\\max} = \\frac{\\varepsilon^{1/3}}{1 + \\varepsilon^{1/3}}$$\n现在，我们代入数值 $\\varepsilon = 1.0 \\times 10^{-6}$：\n$$\\varepsilon^{1/3} = (1.0 \\times 10^{-6})^{1/3} = (10^{-6})^{1/3} = 10^{-2} = 0.01$$\n将这个值代入 $q_{\\max}$ 的表达式中：\n$$q_{\\max} = \\frac{0.01}{1 + 0.01} = \\frac{0.01}{1.01}$$\n计算数值：\n$$q_{\\max} = \\frac{1}{101} \\approx 0.009900990099...$$\n问题要求答案四舍五入到四位有效数字。\n$$q_{\\max} \\approx 0.009901$$\n这个结果与初始条件 $0  q  p  1$ 一致，因为 $q_{\\max} \\approx 0.009901$ 远小于 $0.5$。",
            "answer": "$$\\boxed{0.009901}$$"
        }
    ]
}