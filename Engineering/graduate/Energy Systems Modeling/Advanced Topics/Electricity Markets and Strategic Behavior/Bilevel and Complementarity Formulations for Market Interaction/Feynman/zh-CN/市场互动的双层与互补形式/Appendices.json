{
    "hands_on_practices": [
        {
            "introduction": "要理解市场出清的结果，必须从其优化模型的Karush-Kuhn-Tucker（KKT）条件入手。第一个练习在一个简化的单节点市场中提供了一项基础实践。本题旨在将对偶变量和互补松弛性等数学概念，与市场价格和发电容量价值等关键经济学解释联系起来 。",
            "id": "4072001",
            "problem": "考虑一个单周期、单节点的电力市场出清问题，其形式为社会成本最小化，其中发电成本是线性的，需求是无弹性的。共有三台发电机，由 $i \\in \\{1,2,3\\}$ 索引，其决策变量 $P_i$ 代表它们的调度出力，单位为兆瓦。总需求为 $D = 160$。发电机 $i$ 的边际生产成本 $c_i$ 为常数，单位为美元/兆瓦时，其容量上限为 $\\bar{P}_i$，单位为兆瓦。具体数据如下：\n- $c_1 = 14$，$\\bar{P}_1 = 60$，\n- $c_2 = 27$，$\\bar{P}_2 = 70$，\n- $c_3 = 55$，$\\bar{P}_3 = 120$。\n\n原始市场出清问题是在满足功率平衡和容量约束的条件下，最小化总生产成本：\n$$\n\\min_{P_1,P_2,P_3} \\;\\; c_1 P_1 + c_2 P_2 + c_3 P_3\n$$\n约束条件为\n$$\nP_1 + P_2 + P_3 = D, \\quad 0 \\leq P_i \\leq \\bar{P}_i \\;\\; \\text{for all } i \\in \\{1,2,3\\}.\n$$\n\n设 $\\lambda$ 表示与功率平衡等式约束相关的拉格朗日乘子（可解释为市场价格），设 $\\alpha_i \\geq 0$ 表示与下限约束 $P_i \\geq 0$ 相关的拉格朗日乘子，设 $\\mu_i \\geq 0$ 表示与上限约束 $P_i \\leq \\bar{P}_i$ 相关的拉格朗日乘子。\n\n从凸优化和线性规划对偶的基本原理出发，特别是 Karush–Kuhn–Tucker (KKT) 最优性条件，推导出最优调度出力和相应的 KKT 乘子。明确地验证上限约束的互补松弛性，即验证在最优解处，对于所有 $i \\in \\{1,2,3\\}$，都有 $\\mu_i \\left(P_i - \\bar{P}_i\\right) = 0$。然后，将上限乘子 $\\mu_2$ 解释为发电机 2 的容量边际价值（即 $\\bar{P}_2$ 每增加一个单位，最优目标值的变化量），并计算其值。\n\n将发电机 2 的容量边际价值以美元/兆瓦时（$\\$/\\mathrm{MWh}$）为单位，作为一个实数报告。无需四舍五入，请提供精确值。",
            "solution": "用户提供了一个单周期、单节点的电力市场出清问题，这是一个经典的线性规划问题。任务是找到最优的发电机调度出力、相应的 Karush-Kuhn-Tucker (KKT) 乘子，并解释和计算特定发电机的容量边际价值。\n\n首先，我们验证该问题。这是一个标准的经济调度模型。所有数据、变量和约束都已提供。目标函数为 $\\sum_{i} c_i P_i$。成本系数 $c_i$ 的单位是美元/兆瓦时（$\\$/\\mathrm{MWh}$），调度变量 $P_i$ 的单位是兆瓦（$\\mathrm{MW}$）。因此，目标函数的单位是 $(\\$/\\mathrm{MWh}) \\times \\mathrm{MW} = (\\$/(\\mathrm{MW}\\cdot\\mathrm{h})) \\times \\mathrm{MW} = \\$/\\mathrm{h}$。这表示总发电成本率。功率约束的单位都是 $\\mathrm{MW}$。与这些功率约束相关的拉格朗日乘子的单位将是单位功率的成本率，即 $(\\$/\\mathrm{h})/\\mathrm{MW}$，这等同于 $\\$/(\\mathrm{MW}\\cdot\\mathrm{h})$ 或 $\\$/\\mathrm{MWh}$。问题要求最终答案以 $\\$/\\mathrm{MWh}$ 为单位，这与该解释一致。因此，该问题在科学上是有根据的、适定的，并且在对此类模型的标准解释下，所有数据在量纲上都是一致的。该问题被认为是有效的。\n\n该优化问题是：\n$$ \\min_{P_1,P_2,P_3} \\;\\; 14 P_1 + 27 P_2 + 55 P_3 $$\n约束条件为：\n$$ P_1 + P_2 + P_3 = 160 $$\n$$ 0 \\leq P_1 \\leq 60 $$\n$$ 0 \\leq P_2 \\leq 70 $$\n$$ 0 \\leq P_3 \\leq 120 $$\n\n为了解决这个问题，我们可以使用经济优序原则，该原则指出，按照边际成本的递增顺序调度发电机是最优的。边际成本为 $c_1 = 14$，$c_2 = 27$ 和 $c_3 = 55$。优序为发电机 1，然后是发电机 2，最后是发电机 3。总需求为 $D = 160$ MW。\n\n1.  调度发电机 1（成本 $c_1=14$）：其容量为 $\\bar{P}_1=60$。由于需求 $160$ 大于 $60$，我们将发电机 1 按其最大容量进行调度。\n    $P_1^* = 60$。\n    剩余需求 = $160 - 60 = 100$。\n\n2.  调度发电机 2（成本 $c_2=27$）：其容量为 $\\bar{P}_2=70$。剩余需求 $100$ 大于 $70$，所以我们将发电机 2 按其最大容量进行调度。\n    $P_2^* = 70$。\n    剩余需求 = $100 - 70 = 30$。\n\n3.  调度发电机 3（成本 $c_3=55$）：其容量为 $\\bar{P}_3=120$。我们只需要满足 $30$ 的剩余需求。由于 $30  120$，我们调度发电机 3 来满足这部分剩余需求。\n    $P_3^* = 30$。\n\n因此，最优调度为 $P_1^* = 60$，$P_2^* = 70$ 和 $P_3^* = 30$。我们来验证功率平衡：$60 + 70 + 30 = 160 = D$。该解是可行的。\n\n接下来，我们推导 KKT 乘子。该问题的拉格朗日函数为：\n$$ \\mathcal{L}(P, \\lambda, \\alpha, \\mu) = \\sum_{i=1}^3 c_i P_i + \\lambda \\left( \\sum_{i=1}^3 P_i - D \\right) - \\sum_{i=1}^3 \\alpha_i P_i + \\sum_{i=1}^3 \\mu_i (P_i - \\bar{P}_i) $$\n其中 $\\lambda$ 是等式约束的乘子，$\\alpha_i \\geq 0$ 和 $\\mu_i \\geq 0$ 分别是不等式约束 $-P_i \\leq 0$ 和 $P_i - \\bar{P}_i \\leq 0$ 的乘子。\n\n在最优解 $(P^*, \\lambda^*, \\alpha^*, \\mu^*)$ 处的 KKT 条件是：\n1.  **原始可行性**：如上所示，调度出力 $P_1^*=60, P_2^*=70, P_3^*=30$ 是可行的。\n2.  **对偶可行性**：对所有 $i$，$\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$。\n3.  **驻点条件**：对 $i=1,2,3$，$\\frac{\\partial \\mathcal{L}}{\\partial P_i} = c_i + \\lambda^* - \\alpha_i^* + \\mu_i^* = 0$。\n4.  **互补松弛性**：对 $i=1,2,3$，$\\alpha_i^* P_i^* = 0$ 且 $\\mu_i^* (P_i^* - \\bar{P}_i) = 0$。\n\n我们使用这些条件来求解乘子：\n\n-   **对于发电机 3 ($i=3$)**：调度出力为 $P_3^*=30$。由于 $0  P_3^*  \\bar{P}_3$，该发电机是边际内的（即不在边界上）。根据互补松弛性：\n    -   $P_3^* > 0 \\implies \\alpha_3^* P_3^* = 0 \\implies \\alpha_3^* = 0$。\n    -   $P_3^*  \\bar{P}_3 \\implies \\mu_3^*(P_3^* - \\bar{P}_3) = 0 \\implies \\mu_3^* = 0$。\n    将 $\\alpha_3^*=0$ 和 $\\mu_3^*=0$ 代入 $i=3$ 的驻点条件：\n    $c_3 + \\lambda^* - 0 + 0 = 0 \\implies \\lambda^* = -c_3 = -55$。\n    市场出清价格，在此类模型中通常定义为 $-\\lambda^*$，为 $55$，由边际发电机决定。\n\n-   **对于发电机 1 ($i=1$)**：调度出力为 $P_1^*=60 = \\bar{P}_1$。\n    -   $P_1^* > 0 \\implies \\alpha_1^* = 0$。\n    -   约束 $P_1 \\leq \\bar{P}_1$ 是激活的，因此 $\\mu_1^*$ 可以是非零的。\n    根据 $i=1$ 的驻点条件：\n    $c_1 + \\lambda^* - \\alpha_1^* + \\mu_1^* = 0 \\implies 14 + (-55) - 0 + \\mu_1^* = 0 \\implies \\mu_1^* = 41$。\n\n-   **对于发电机 2 ($i=2$)**：调度出力为 $P_2^*=70 = \\bar{P}_2$。\n    -   $P_2^* > 0 \\implies \\alpha_2^* = 0$。\n    -   约束 $P_2 \\leq \\bar{P}_2$ 是激活的，因此 $\\mu_2^*$ 可以是非零的。\n    根据 $i=2$ 的驻点条件：\n    $c_2 + \\lambda^* - \\alpha_2^* + \\mu_2^* = 0 \\implies 27 + (-55) - 0 + \\mu_2^* = 0 \\implies \\mu_2^* = 28$。\n\n最优 KKT 乘子为 $\\lambda^* = -55$，$\\alpha_1^*=\\alpha_2^*=\\alpha_3^*=0$，$\\mu_1^*=41$，$\\mu_2^*=28$ 和 $\\mu_3^*=0$。所有对偶可行性条件（$\\alpha_i^* \\geq 0, \\mu_i^* \\geq 0$）均得到满足。\n\n接下来，我们验证上限约束的互补松弛性条件 $\\mu_i(P_i - \\bar{P}_i) = 0$：\n-   对于 $i=1$：$\\mu_1^*(P_1^* - \\bar{P}_1) = 41(60 - 60) = 41 \\times 0 = 0$。\n-   对于 $i=2$：$\\mu_2^*(P_2^* - \\bar{P}_2) = 28(70 - 70) = 28 \\times 0 = 0$。\n-   对于 $i=3$：$\\mu_3^*(P_3^* - \\bar{P}_3) = 0(30 - 120) = 0 \\times (-90) = 0$。\n该条件对所有发电机都得到了验证。\n\n最后，我们解释并计算 $\\mu_2$ 的值。乘子 $\\mu_i$ 是容量约束 $P_i \\leq \\bar{P}_i$ 的影子价格。根据约束优化的包络定理，最优目标函数值（我们称之为 $V^*$）关于约束右端项的导数是相应拉格朗日乘子的负值。我们的约束是 $P_i - \\bar{P}_i \\leq 0$。设 $V^*(\\bar{P}_1, \\bar{P}_2, \\bar{P}_3)$ 为最小成本。那么 $\\frac{\\partial V^*}{\\partial \\bar{P}_i} = -\\mu_i^*$。\n“容量的边际价值”定义为容量每增加一个单位所带来的总成本的减少量。这恰好是 $-\\frac{\\partial V^*}{\\partial \\bar{P}_i}$，它等于 $\\mu_i^*$。\n因此，发电机 2 的容量边际价值是 $\\mu_2^*$。我们计算出 $\\mu_2^* = 28$。\n\n这个值可以直观地理解。如果发电机 2 的容量增加一个单位（例如，增加到 $71$ MW），它就可以以其成本 $c_2 = 27$ 多生产一兆瓦的电力。为了保持功率平衡，最昂贵的发电机 3 将其产量减少一兆瓦，从而节省其成本 $c_3 = 55$。总成本的净变化将是 $c_2 - c_3 = 27 - 55 = -28$。成本减少了 $28$，所以额外容量的边际价值是 $28$。如前所述，这个值的单位是 $\\$/\\mathrm{MWh}$。\n\n发电机 2 的容量边际价值是 $28$ $\\$/\\mathrm{MWh}$。",
            "answer": "$$\n\\boxed{28}\n$$"
        },
        {
            "introduction": "在单节点模型的基础上，我们通过引入网络约束来增加真实性，这是现实电力系统中的核心元素。本实践问题将KKT分析扩展到一个包含拥塞输电线路的多节点系统。它清晰地演示了网络拥塞如何在不同地点造成价格差异，从而引出区域边际电价（Locational Marginal Prices, LMPs）这一基本概念 。",
            "id": "4072007",
            "problem": "考虑一个电力系统中的理想化双层市场交互模型，其中上层参与者以其真实边际成本进行报价，下层独立系统运营商 (ISO) 通过直流最优潮流 (DC-OPF) 进行市场清算。下层问题是一个线性规划问题，其唯一的受监控输电约束由功率传输分布因子 (PTDF) 表示。系统中有三个母线，索引为 $i \\in \\{1,2,3\\}$，每个母线都有一台发电机和刚性需求。发电机的边际成本 $c_i$ 是线性的，单位为美元/兆瓦时 ($\\$/\\mathrm{MWh}$)，并选择非负的调度功率 $p_i$，单位为兆瓦 (MW)。\n\n数据：\n- 需求：$d_1 = 40$ $\\mathrm{MW}$，$d_2 = 40$ $\\mathrm{MW}$，$d_3 = 20$ $\\mathrm{MW}$。\n- 边际成本：$c_1 = 40$ $\\$/\\mathrm{MWh}$，$c_2 = 20$ $\\$/\\mathrm{MWh}$，$c_3 = 10$ $\\$/\\mathrm{MWh}$。\n- 受监控线路 $L$ 的方向为从母线 $1$ 到母线 $2$，其 PTDF 分别为 $\\phi_1 = 0.7$，$\\phi_2 = -0.2$，$\\phi_3 = -0.5$。线路潮流为 $f = \\sum_{i=1}^{3} \\phi_i (p_i - d_i)$。\n- 输电极限：上限为 $f \\le \\bar{F}$，其中 $\\bar{F} = 10$ $\\mathrm{MW}$，无其他网络约束。\n- 发电机容量：$0 \\le p_i$，无上限。\n\n下层 DC-OPF 旨在最小化总可变成本 $\\sum_{i=1}^{3} c_i p_i$，其约束条件为功率平衡 $\\sum_{i=1}^{3} p_i = \\sum_{i=1}^{3} d_i$ 和单一线路极限 $f \\le \\bar{F}$。节点边际电价 (LMP) $\\pi_i$ 定义为从 Karush-Kuhn-Tucker (KKT) 条件中得到的节点影子价格，$\\pi_i = \\lambda + \\mu \\phi_i$，其中 $\\lambda$ 是功率平衡约束的对偶变量，$\\mu \\ge 0$ 是紧约束的线路约束 $f \\le \\bar{F}$ 的对偶变量。\n\n任务：\n1. 构建下层 DC-OPF 问题及其拉格朗日函数，推导 KKT 条件，并计算最优调度向量 $(p_1, p_2, p_3)$ 和节点边际电价 $(\\pi_1, \\pi_2, \\pi_3)$。\n2. 验证发电机非负性约束和单一紧约束的线路极限的对偶可行性与互补松弛性。\n3. 确认计算出的 LMP 与发电的发电机处的平稳性条件以及不发电的发电机处的非负性松弛条件相一致。\n\n请将您的最终数值答案以一个单行矩阵的形式提供，矩阵中包含 $p_1$、$p_2$、$p_3$（单位 $\\mathrm{MW}$），随后是 $\\pi_1$、$\\pi_2$、$\\pi_3$（单位 $\\$/\\mathrm{MWh}$）。无需四舍五入；在方便的情况下使用精确值。最终的方框答案中不要包含单位。",
            "solution": "用户提供的问题被评估为有效。其科学基础是电力系统经济学与优化原理，作为一个线性规划问题是适定的，并且以一套完整的数据进行了客观陈述。\n\n第一步是形式化地陈述下层 DC-OPF 问题。目标是最小化总发电成本，即 $\\sum_{i=1}^{3} c_i p_i$，其中 $p_i$ 是发电机 $i$ 的功率输出，$c_i$ 是其边际成本。决策变量是发电机的调度水平 $p_1, p_2, p_3$。\n\n给定的数据是：\n- 需求：$d_1 = 40$ $\\mathrm{MW}$，$d_2 = 40$ $\\mathrm{MW}$，$d_3 = 20$ $\\mathrm{MW}$。总需求为 $\\sum_{i=1}^{3} d_i = 100$ $\\mathrm{MW}$。\n- 边际成本：$c_1 = 40$ $\\$/\\mathrm{MWh}$，$c_2 = 20$ $\\$/\\mathrm{MWh}$，$c_3 = 10$ $\\$/\\mathrm{MWh}$。\n- PTDF：$\\phi_1 = 0.7$，$\\phi_2 = -0.2$，$\\phi_3 = -0.5$。\n- 输电极限：$\\bar{F} = 10$ $\\mathrm{MW}$。\n\n优化问题是：\n$$\n\\min_{p_1, p_2, p_3} \\quad 40 p_1 + 20 p_2 + 10 p_3\n$$\n约束条件为：\n1.  功率平衡：$p_1 + p_2 + p_3 = 100$\n2.  输电极限：$\\sum_{i=1}^{3} \\phi_i (p_i - d_i) \\le \\bar{F}$\n    $0.7(p_1 - 40) - 0.2(p_2 - 40) - 0.5(p_3 - 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (0.7 \\cdot 40 - 0.2 \\cdot 40 - 0.5 \\cdot 20) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - (28 - 8 - 10) \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 - 10 \\le 10$\n    $0.7 p_1 - 0.2 p_2 - 0.5 p_3 \\le 20$\n3.  非负性：$p_i \\ge 0$ for $i \\in \\{1, 2, 3\\}$\n\n为推导 Karush-Kuhn-Tucker (KKT) 条件，构建该问题的拉格朗日函数。设 $\\lambda$ 为功率平衡约束的对偶变量，$\\mu$ 为输电极限的对偶变量。根据标准的电力系统惯例，并将LMP定义为$\\pi_i$，最优性的 KKT 条件包括：\n- 如果 $p_i  0$，则平稳性条件为 $c_i = \\pi_i = \\lambda + \\mu\\phi_i$。\n- 如果 $p_i = 0$，则条件为 $c_i \\ge \\pi_i = \\lambda + \\mu\\phi_i$。\n此外，对于不等式约束：\n- $\\mu \\ge 0$ 且 $\\mu(\\sum_{i=1}^{3} \\phi_i(p_i-d_i) - \\bar{F}) = 0$。\n\n问题指出线路约束是紧的，这意味着我们假设 $\\mu  0$ 并且线路潮流达到其极限。当 $\\mu  0$ 时，LMP 因 PTDF 的不同而不同：\n$\\pi_1 = \\lambda + 0.7\\mu$\n$\\pi_2 = \\lambda - 0.2\\mu$\n$\\pi_3 = \\lambda - 0.5\\mu$\n这意味着价格分离：$\\pi_1  \\pi_2  \\pi_3$。\n\n这个线性规划问题的解最多有两台发电机被调度，以满足两个激活约束（功率平衡和紧约束的线路极限）。我们测试两台被调度发电机的组合。\n假设1：发电机2和3被调度（$p_2  0, p_3  0, p_1 = 0$）。\n这要求 $c_2 = \\pi_2$ 且 $c_3 = \\pi_3$。\n$20 = \\lambda - 0.2\\mu$\n$10 = \\lambda - 0.5\\mu$\n两式相减得到 $10 = 0.3\\mu$，所以 $\\mu = 100/3$。代回计算，$\\lambda = 20 + 0.2(100/3) = 20 + 20/3 = 80/3$。\n现在，我们必须检查未调度发电机1的条件：$c_1 \\ge \\pi_1$。\n$\\pi_1 = \\lambda + 0.7\\mu = 80/3 + 0.7(100/3) = (80+70)/3 = 150/3 = 50$。\n条件是 $c_1 \\ge \\pi_1 \\implies 40 \\ge 50$，这是错误的。因此，这个假设不正确。\n\n假设2：发电机1和3被调度（$p_1  0, p_3  0, p_2 = 0$）。\n这要求 $c_1 = \\pi_1$ 且 $c_3 = \\pi_3$。\n$40 = \\lambda + 0.7\\mu$\n$10 = \\lambda - 0.5\\mu$\n两式相减得到 $30 = 1.2\\mu$，所以 $\\mu = 30/1.2 = 25$。因为 $\\mu  0$，这与紧约束是一致的。\n代回计算，$\\lambda = 10 + 0.5\\mu = 10 + 0.5(25) = 10 + 12.5 = 22.5$。\n现在，检查未调度发电机2的条件：$c_2 \\ge \\pi_2$。\n$\\pi_2 = \\lambda - 0.2\\mu = 22.5 - 0.2(25) = 22.5 - 5 = 17.5$。\n条件是 $c_2 \\ge \\pi_2 \\implies 20 \\ge 17.5$，这是正确的。这个假设是一致的。\n\n在找到了正确的被调度发电机集合和对偶变量后，我们现在求解原始变量 $p_1, p_2, p_3$。\n我们有 $p_2 = 0$ 和两个激活约束：\n1. $p_1 + p_3 = 100$\n2. $0.7p_1 - 0.5p_3 = 20$\n由(1)得，$p_1 = 100 - p_3$。代入(2)中：\n$0.7(100 - p_3) - 0.5p_3 = 20$\n$70 - 0.7p_3 - 0.5p_3 = 20$\n$50 = 1.2p_3$\n$p_3 = 50 / 1.2 = 500 / 12 = 125 / 3$。\n然后，$p_1 = 100 - 125/3 = (300 - 125)/3 = 175/3$。\n最优调度为 $(p_1, p_2, p_3) = (175/3, 0, 125/3)$。$p_1$ 和 $p_3$ 均为正，与我们的假设一致。\n\n使用 $\\lambda = 22.5$ 和 $\\mu=25$ 计算节点边际电价：\n$\\pi_1 = \\lambda + \\mu\\phi_1 = 22.5 + 25(0.7) = 22.5 + 17.5 = 40$。\n$\\pi_2 = \\lambda + \\mu\\phi_2 = 22.5 + 25(-0.2) = 22.5 - 5 = 17.5$。\n$\\pi_3 = \\lambda + \\mu\\phi_3 = 22.5 + 25(-0.5) = 22.5 - 12.5 = 10$。\n最优 LMP 为 $(\\pi_1, \\pi_2, \\pi_3) = (40, 17.5, 10)$。\n\n最后，我们验证余下的 KKT 条件。\n- **线路极限的对偶可行性与互补松弛性**：\n对偶可行性要求 $\\mu \\ge 0$，我们计算出 $\\mu=25$，该条件成立。\n互补松弛性要求 $\\mu(0.7p_1 - 0.2p_2 - 0.5p_3 - 20)=0$。\n线路潮流项为 $0.7(175/3) - 0.2(0) - 0.5(125/3) - 20 = (122.5 - 62.5)/3 - 20 = 60/3 - 20 = 20 - 20 = 0$。\n条件 $25 \\cdot 0 = 0$ 成立。\n\n- **发电机非负性的对偶可行性与互补松弛性**：这等同于确认 LMP 的一致性。\n对于发电的发电机1：$p_1 = 175/3  0$。我们检查是否 $c_1 = \\pi_1$。$40 = 40$。这是一致的。\n对于发电的发电机3：$p_3 = 125/3  0$。我们检查是否 $c_3 = \\pi_3$。$10 = 10$。这是一致的。\n对于不发电的发电机2：$p_2 = 0$。我们检查是否 $c_2 \\ge \\pi_2$。$20 \\ge 17.5$。这是一致的。\n\n所有 KKT 条件均已满足。该解为最优解。\n最终结果结合了调度向量 $(p_1, p_2, p_3)$ 和 LMP 向量 $(\\pi_1, \\pi_2, \\pi_3)$。\n$p_1 = 175/3$ $\\mathrm{MW}$，$p_2 = 0$ $\\mathrm{MW}$，$p_3 = 125/3$ $\\mathrm{MW}$。\n$\\pi_1 = 40$ $\\$/\\mathrm{MWh}$，$\\pi_2 = 17.5$ $\\$/\\mathrm{MWh}$，$\\pi_3 = 10$ $\\$/\\mathrm{MWh}$。\n以分数形式表示，$17.5$ 是 $35/2$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{175}{3}  0  \\frac{125}{3}  40  \\frac{35}{2}  10 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最后，我们从市场出清模型转向使用双层模型来分析战略行为。这个高级练习探讨了如何将双层问题重构为带均衡约束的数学规划（MPEC），并介绍了一种常用的“大M”（big-M）线性化技术。本题的关键教训在于，必须批判性地评估这类重构模型中的参数，因为不当的选择会导致错误的结论，这凸显了将数学模型植根于经济现实的重要性 。",
            "id": "4071973",
            "problem": "考虑一个单一价格的能源市场，其中一个代表性公司在顶层决定装机容量 $K \\geq 0$，而底层则进行集中市场出清。逆需求函数为 $p(q) = a - b q$，其中 $a  0$ 且 $b  0$。该公司具有恒定的边际成本 $c$，并为每单位装机容量支付固定的容量成本 $F$。底层的市场出清在可行性约束下最大化总盈余。整个问题是一个带均衡约束的数学规划 (MPEC)，其中使用 Karush–Kuhn–Tucker (KKT) 互补条件来捕捉市场出清。\n\n本实例的数据为 $a = 100$, $b = 2$, $c = 10$ 和 $F = 5$。底层问题是以决策变量 $q$ 进行福利最大化，\n$$\n\\max_{q} \\ \\int_{0}^{q} (a - b t) \\, dt - c q \\quad \\text{s.t.} \\quad 0 \\leq q \\leq K,\n$$\n其中对偶变量为 $\\mu \\geq 0$ (对应于 $q \\geq 0$) 和 $\\lambda \\geq 0$ (对应于 $q \\leq K$)。顶层选择 $K$ 以在给定价格 $p(q) = a - b q$ 的情况下最大化利润，即\n$$\n\\max_{K \\geq 0} \\ \\pi(K) = p(q) q - c q - F K,\n$$\n其中 $q$ 是给定 $K$ 时底层的最优调度量。\n\n您将分析底层互补条件 $0 \\leq \\lambda \\perp K - q \\geq 0$ 的两种表述形式：\n- 一个不正确的混合整数线性规划 (MILP) 大 M 线性化，它施加了 $\\lambda \\leq M_{\\lambda} z$, $K - q \\leq U_{q} (1 - z)$，其中 $z \\in \\{0,1\\}$，并使用了 $M_{\\lambda} = 20$ 和一个无信息量的界限 $U_{q} = 200$。\n- 一个修正后的大 M 方法，其紧化的界限源于经济学和可行性分析。\n\n任务：\n1. 从福利最大化和 KKT 最优性的基本原理出发，推导求解该双层问题的真实均衡解 $q^{\\star}$ 和 $K^{\\star}$，其中互补条件被正确执行（没有对对偶变量施加人为的上限）。确定相关的价格 $p^{\\star} = a - b q^{\\star}$。\n2. 展示不正确的大 M 选择 $M_{\\lambda} = 20$ 如何扭曲底层的 KKT 条件，并计算在这种情况下 MILP 将返回的均衡解。解释为什么这个均衡解是错误的。\n3. 确定经济上有效的紧化界限，以保证此实例中大 M 线性化的正确性。具体来说，提供并论证一个上界 $\\overline{q}$ 满足所有可行均衡下的 $q \\leq \\overline{q}$，以及一个相应的安全上界 $\\overline{\\lambda}$ 满足所有可行均衡下的 $\\lambda \\leq \\overline{\\lambda}$。论证使用这些修正后的界限可以恢复真实的均衡解。\n\n以 $/MWh$ 为单位表示最终价格 $p^{\\star}$。给出精确答案（不要四舍五入）。",
            "solution": "该问题要求分析一个双层市场均衡模型，该模型被构建为一个带均衡约束的数学规划 (MPEC)。我们将按顺序完成三个任务：推导真实均衡，分析一个有缺陷的混合整数线性规划 (MILP) 表述，以及为 MILP 表述确定正确的界限。\n\n给定数据为：$a = 100$, $b = 2$, $c = 10$ 和 $F = 5$。逆需求函数为 $p(q) = 100 - 2q$。\n\n**1. 真实均衡解**\n\n首先，我们分析底层福利最大化问题。目标函数为 $\\int_{0}^{q} (100 - 2t) dt - 10q = [100t - t^2]_0^q - 10q = 100q - q^2 - 10q = 90q - q^2$。这是一个关于 $q$ 的严格凹函数。\n底层问题是：\n$$ \\max_{0 \\leq q \\leq K} \\ 90q - q^2 $$\n该问题的 KKT 条件为：\n- **驻点条件**: $90 - 2q - \\mu + \\lambda = 0$，其中 $\\mu$ 是 $q \\ge 0$ 约束的乘子，$\\lambda$ 是 $q \\le K$ 约束的乘子。\n- **互补松弛性**: $0 \\leq \\mu \\perp q \\geq 0$ 和 $0 \\leq \\lambda \\perp K - q \\geq 0$。\n\n由于 $c=10$ 时市场需求为正 ($p(q)=10 \\implies q=45$)，我们知道最优产量 $q$ 必然大于 0。因此，根据互补松弛性，$\\mu=0$。驻点条件简化为 $90 - 2q + \\lambda = 0$。\n\n现在我们分析关于 $\\lambda$ 的互补条件，以确定追随者（市场）对领导者（公司）的决策 $K$ 的反应函数 $q(K)$：\n- **情况 1: 容量约束不紧 ($K - q > 0$)**。根据互补性，$\\lambda=0$。代入驻点条件：$90 - 2q = 0 \\implies q=45$。这种情况在 $K > 45$ 时发生。\n- **情况 2: 容量约束紧 ($K - q = 0$)**。即 $q=K$。根据互补性，$\\lambda \\geq 0$。代入驻点条件：$90 - 2K + \\lambda = 0 \\implies \\lambda = 2K - 90$。$\\lambda \\geq 0$ 的条件意味着 $2K \\geq 90 \\implies K \\geq 45$。但这种情况假设 $\\lambda>0$，所以严格来说是 $K > 45$。当 $q=K$ 时，如果 $K45$，则 $\\lambda=90-2K > 0$，所以容量约束是紧的。\n综合来看，追随者的反应函数是：\n- 如果 $K  45$，则 $q(K) = K$。\n- 如果 $K \\geq 45$，则 $q(K) = 45$。\n\n接下来，我们解决上层（领导者）的利润最大化问题：\n$\\pi(K) = p(q)q - cq - FK = (100 - 2q)q - 10q - 5K = 90q - 2q^2 - 5K$。\n我们将追随者的反应 $q(K)$ 代入利润函数：\n- **如果 $K  45$** ($q=K$):\n  $\\pi(K) = 90K - 2K^2 - 5K = 85K - 2K^2$。\n  为求最大值，取一阶导数并令其为零：$\\frac{d\\pi}{dK} = 85 - 4K = 0 \\implies K = 85/4 = 21.25$。\n  这个值在 $K  45$ 的区域内，所以是一个有效的候选解。此时，$\\pi(21.25) = 85(21.25) - 2(21.25)^2 = 903.125$。\n- **如果 $K \\geq 45$** ($q=45$):\n  $\\pi(K) = 90(45) - 2(45)^2 - 5K = 4050 - 4050 - 5K = -5K$。\n  在这个区域，利润是 $K$ 的递减函数。因此，领导者会选择最小的可能值，即 $K=45$。此时，$\\pi(45) = -5(45) = -225$。\n\n比较两个情况的利润，领导者会选择 $K^{\\star} = 21.25$ 以获得最大利润 $903.125$。\n对应的均衡产量为 $q^{\\star} = K^{\\star} = 21.25$。\n均衡价格为 $p^{\\star} = 100 - 2q^{\\star} = 100 - 2(21.25) = 100 - 42.5 = 57.5$。\n\n**2. 不正确的“大M”分析**\n\nMPEC 的互补条件 $0 \\leq \\lambda \\perp K-q \\geq 0$ 被不正确地线性化为：\n1. $\\lambda \\le M_{\\lambda} z \\implies \\lambda \\le 20z$\n2. $K - q \\le U_q (1-z) \\implies K - q \\le 200(1-z)$\n其中 $z \\in \\{0,1\\}$。\n同时，驻点条件 $90 - 2q + \\lambda = 0$ 和领导者的利润最大化目标 $\\max 90q - 2q^2 - 5K$ 仍然适用。\n- **如果 $z=0$**: 则 $\\lambda \\le 0$。由于 $\\lambda \\ge 0$，所以 $\\lambda = 0$。驻点条件变为 $90 - 2q = 0 \\implies q=45$。线性化约束(2)变为 $K - 45 \\le 200$，即 $K \\le 245$。同时，$\\lambda=0$ 的原始含义是 $K-q \\ge 0$，即 $K \\ge 45$。所以，此情况对应 $q=45, 45 \\le K \\le 245$。利润为 $\\pi = -5K$，在 $K=45$ 时最大，为 $-225$。\n- **如果 $z=1$**: 则 $\\lambda \\le 20$。驻点条件 $\\lambda = 2q - 90$ 必须满足此界限，即 $2q - 90 \\le 20 \\implies 2q \\le 110 \\implies q \\le 55$。同时，$\\lambda \\ge 0 \\implies 2q - 90 \\ge 0 \\implies q \\ge 45$。线性化约束(2)变为 $K - q \\le 0 \\implies K \\le q$。原始含义 $z=1 \\implies \\lambda>0$ (近似) 意味着 $K-q=0$。所以此情况对应 $K=q$ 且 $45 \\le q \\le 55$。利润为 $\\pi(q) = 85q - 2q^2$。函数 $\\pi(q)$ 在 $q > 21.25$ 时是递减的，所以在 $[45, 55]$ 区间内，它在 $q=45$ 处达到最大值。$\\pi(45)=85(45)-2(45)^2 = 3825 - 4050 = -225$。\n等等，我的驻点条件 $\\lambda = 2q-90$ 符号错了。应该是 $90-2q+\\lambda=0 \\implies \\lambda = 2q-90$。还是不对。\n$90-2q-\\mu+\\lambda=0$ and $\\mu=0$ leads to $90 - 2q + \\lambda = 0 \\implies \\lambda = 2q-90$。这又错了。\n啊，拉格朗日函数定义问题。 $\\max f(x)$ s.t. $g(x)\\le 0$。Lagrangian is $f(x) - \\lambda g(x)$ with $\\lambda\\ge 0$。\nHere $f(q) = 90q-q^2$, $g(q)=q-K \\le 0$. Lagrangian: $(90q-q^2) - \\lambda(q-K)$。\nStationarity: $90 - 2q - \\lambda = 0 \\implies \\lambda = 90 - 2q$。\nLet's re-evaluate the incorrect Big-M with the correct stationarity.\n- **如果 $z=1$**: $K-q \\le 0 \\implies K \\le q$。同时原始含义是 $K-q=0$。$\\lambda \\le 20 \\implies 90 - 2q \\le 20 \\implies 70 \\le 2q \\implies q \\ge 35$。\n  利润是 $\\pi(q) = 85q - 2q^2$。在 $q \\ge 35$ 的约束下，这是一个递减函数。所以最优解是 $q=35, K=35$。利润 $\\pi(35)=85(35)-2(35)^2 = 2975-2450=525$。\n- **如果 $z=0$**: $\\lambda=0 \\implies q=45$。$K \\ge 45$。利润 $\\pi=-5K$。在 $K=45$ 处最大，$\\pi=-225$。\n\n比较两种情况，不正确的模型会选择 $z=1$ 并得到 $K=35, q=35$，利润为 $525$。\n这个解是错误的，因为它是由一个不正确的约束 $\\lambda \\le 20$ 导致的。我们在第一部分计算的真实均衡解中，$\\lambda^{\\star} = 90 - 2(21.25) = 47.5$。由于 $47.5 > 20$，真实的最优解被这个有缺陷的 “大M” 界限 $M_{\\lambda}=20$ 非法地排除了。因此，优化器找到了在人为限制下的次优解。\n\n**3. 经济上有效的紧界限**\n\n为了使“大M”方法正确，我们需要为 $\\lambda$ 和 $K-q$ 设置有效的上界。\n- **$q$ 的上界 $\\overline{q}$**: 价格必须为非负数，即 $p(q) = 100 - 2q \\ge 0 \\implies q \\le 50$。产量不可能超过 50。更紧的界限可以从利润非负性得到。领导者不会选择一个导致负利润的投资，而 $K=0$ 可以保证利润为零。在 $q=K$ 的情况下，$\\pi(K) = 85K-2K^2 \\ge 0 \\implies K(85-2K) \\ge 0 \\implies K \\le 42.5$。因此，任何理性的投资 $K$ 都不会超过 42.5，相应的 $q$ 也不会。所以，一个紧的界限是 $\\overline{q} = 42.5$。使用 $\\overline{q}=50$ 也是安全的。\n- **$\\lambda$ 的上界 $\\overline{\\lambda}$**: 从驻点条件 $\\lambda = 90 - 2q$ 和 $q \\ge 0$ 可知，$\\lambda$ 的最大值在 $q=0$ 时取得，即 $\\overline{\\lambda} = 90$。\n- **$K-q$ 的上界 $U_q$**: 这个界限是在 $\\lambda=0$ 时需要的。此时 $q=45$。$K-q = K-45$。领导者不会选择一个导致利润为负的 $K$。当 $q=45$ 时，$\\pi(K)=-5K$。只要 $K>0$，利润就为负。但如果存在启动成本等，情况可能不同。理论上，领导者可以选择任意大的 $K$。然而，在一个合理的模型中，如果 $K > 45$，公司可以通过减少 $K$ 到 $45$ 来减少损失而不影响产量 $q$。因此，没有理由选择 $K>45$。所以 $K-q$ 的上界可以认为是 $45-45=0$。为了安全起见，可以使用一个足够大但非病态的数，比如基于总市场规模的 $U_q=50$。\n\n如果我们使用修正后的界限，例如 $\\overline{\\lambda} = 90$ 和 $U_q = 50$，那么线性化约束变为 $\\lambda \\le 90z$ และ $K-q \\le 50(1-z)$。由于真实解的 $\\lambda^{\\star} = 47.5$ 满足 $\\lambda \\le 90$，它不再被错误地排除。因此，MIQP求解器将能够找到并验证 $K=21.25, q=21.25$ 是最优解，从而恢复真实的均衡。",
            "answer": "$$\n\\boxed{57.5}\n$$"
        }
    ]
}