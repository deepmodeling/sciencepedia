{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个练习将带你回到全局敏感性分析（GSA）的本源。通过为一个简单的可加模型手动推导索伯尔指数（Sobol' indices），你将深入理解一阶、总效应和交互作用指数的精确定义。这个练习旨在通过解析计算，清晰地揭示方差分解的基本原理，为后续更复杂的数值方法奠定坚实的基础。",
            "id": "4133329",
            "problem": "在一个能源系统代理模型的形式化不确定性量化研究中，考虑标量输出模型 $Y = X_1^2 + X_2$，其中 $X_1$ 和 $X_2$ 是独立的不确定性输入。假设 $X_1 \\sim \\mathcal{U}(-1, 2)$ 且 $X_2 \\sim \\mathcal{U}(0, 3)$，这模拟了能源系统模型中两个独立驱动因素的认知范围。使用基于全方差公式和条件期望的、基于方差的 Sobol' 敏感性指数定义，解析推导一阶 Sobol' 指数 $S_1$ 和 $S_2$ 以及全效应 Sobol' 指数 $S_{T1}$。然后，解释 $X_1$ 和 $X_2$ 之间是否存在任何二阶交互作用，并说明这在这些指数中是如何体现的。\n\n将 $S_1$、$S_2$ 和 $S_{T1}$ 表示为无舍入的精确分数，并按 $S_1$、$S_2$、$S_{T1}$ 的顺序报告您的最终答案。",
            "solution": "该问题是有效的，因为它以概率论和全局敏感性分析的原理为科学依据，提供了所有必要信息，是适定的，并且陈述客观。\n\n标量输出模型由 $Y = X_1^2 + X_2$ 给出。输入 $X_1$ 和 $X_2$ 是独立的随机变量，服从指定的均匀分布：$X_1 \\sim \\mathcal{U}(-1, 2)$ 和 $X_2 \\sim \\mathcal{U}(0, 3)$。\n\n一阶 Sobol' 指数 $S_i$ 定义为输出 $Y$ 的方差中仅由输入 $X_i$ 单独贡献的比例：\n$$S_i = \\frac{V_i}{V(Y)} = \\frac{\\operatorname{Var}(\\mathbb{E}(Y|X_i))}{\\operatorname{Var}(Y)}$$\n全效应 Sobol' 指数 $S_{Ti}$ 是 $Y$ 的方差中由 $X_i$ 贡献的比例，包括其主效应及其与其它所有输入的交互作用：\n$$S_{Ti} = \\frac{\\mathbb{E}(\\operatorname{Var}(Y|X_{\\sim i}))}{\\operatorname{Var}(Y)}$$\n其中 $X_{\\sim i}$ 表示除 $X_i$ 以外的所有输入变量的集合。对于一个双变量模型，方差分解为 $\\operatorname{Var}(Y) = V_1 + V_2 + V_{12}$，这意味着 $1 = S_1 + S_2 + S_{12}$。全效应指数为 $S_{T1} = S_1 + S_{12}$ 和 $S_{T2} = S_2 + S_{12}$。\n\n首先，我们计算输入变量的必要矩和方差。对于一个一般的均匀分布 $\\mathcal{U}(a, b)$，其均值为 $\\mathbb{E}(X) = \\frac{a+b}{2}$，方差为 $\\operatorname{Var}(X) = \\frac{(b-a)^2}{12}$。\n\n对于 $X_1 \\sim \\mathcal{U}(-1, 2)$：\n其概率密度函数为 $p_1(x_1) = \\frac{1}{2 - (-1)} = \\frac{1}{3}$，其中 $x_1 \\in [-1, 2]$。\n均值为 $\\mathbb{E}(X_1) = \\frac{-1+2}{2} = \\frac{1}{2}$。\n方差为 $\\operatorname{Var}(X_1) = \\frac{(2-(-1))^2}{12} = \\frac{3^2}{12} = \\frac{9}{12} = \\frac{3}{4}$。\n我们需要 $X_1^2$ 的矩。\n$\\mathbb{E}(X_1^2) = \\int_{-1}^{2} x_1^2 p_1(x_1) dx_1 = \\int_{-1}^{2} x_1^2 \\frac{1}{3} dx_1 = \\frac{1}{3} \\left[\\frac{x_1^3}{3}\\right]_{-1}^{2} = \\frac{1}{9} (2^3 - (-1)^3) = \\frac{1}{9}(8+1) = 1$。\n$\\mathbb{E}(X_1^4) = \\int_{-1}^{2} x_1^4 \\frac{1}{3} dx_1 = \\frac{1}{3} \\left[\\frac{x_1^5}{5}\\right]_{-1}^{2} = \\frac{1}{15} (2^5 - (-1)^5) = \\frac{1}{15}(32+1) = \\frac{33}{15} = \\frac{11}{5}$。\n$X_1^2$ 的方差为 $\\operatorname{Var}(X_1^2) = \\mathbb{E}(X_1^4) - (\\mathbb{E}(X_1^2))^2 = \\frac{11}{5} - 1^2 = \\frac{6}{5}$。\n\n对于 $X_2 \\sim \\mathcal{U}(0, 3)$：\n其概率密度函数为 $p_2(x_2) = \\frac{1}{3-0} = \\frac{1}{3}$，其中 $x_2 \\in [0, 3]$。\n均值为 $\\mathbb{E}(X_2) = \\frac{0+3}{2} = \\frac{3}{2}$。\n方差为 $\\operatorname{Var}(X_2) = \\frac{(3-0)^2}{12} = \\frac{9}{12} = \\frac{3}{4}$。\n\n接下来，我们计算输出的总方差 $\\operatorname{Var}(Y)$。由于 $X_1$ 和 $X_2$ 是独立的，所以 $X_1^2$ 和 $X_2$ 也是独立的。因此，它们的和的方差等于它们方差的和：\n$\\operatorname{Var}(Y) = \\operatorname{Var}(X_1^2 + X_2) = \\operatorname{Var}(X_1^2) + \\operatorname{Var}(X_2) = \\frac{6}{5} + \\frac{3}{4} = \\frac{24 + 15}{20} = \\frac{39}{20}$。\n\n现在我们计算一阶指数所需的项。\n对于 $S_1$，我们需要 $V_1 = \\operatorname{Var}(\\mathbb{E}(Y|X_1))$。\n$\\mathbb{E}(Y|X_1) = \\mathbb{E}(X_1^2 + X_2 | X_1) = \\mathbb{E}(X_1^2|X_1) + \\mathbb{E}(X_2|X_1)$。由于独立性，$\\mathbb{E}(X_2|X_1) = \\mathbb{E}(X_2)$。\n$\\mathbb{E}(Y|X_1) = X_1^2 + \\mathbb{E}(X_2) = X_1^2 + \\frac{3}{2}$。\n$V_1 = \\operatorname{Var}(X_1^2 + \\frac{3}{2}) = \\operatorname{Var}(X_1^2) = \\frac{6}{5}$。\n所以，$S_1 = \\frac{V_1}{\\operatorname{Var}(Y)} = \\frac{6/5}{39/20} = \\frac{6}{5} \\times \\frac{20}{39} = \\frac{120}{195} = \\frac{24}{39} = \\frac{8}{13}$。\n\n对于 $S_2$，我们需要 $V_2 = \\operatorname{Var}(\\mathbb{E}(Y|X_2))$。\n$\\mathbb{E}(Y|X_2) = \\mathbb{E}(X_1^2 + X_2 | X_2) = \\mathbb{E}(X_1^2|X_2) + \\mathbb{E}(X_2|X_2)$。由于独立性，$\\mathbb{E}(X_1^2|X_2) = \\mathbb{E}(X_1^2)$。\n$\\mathbb{E}(Y|X_2) = \\mathbb{E}(X_1^2) + X_2 = 1 + X_2$。\n$V_2 = \\operatorname{Var}(1 + X_2) = \\operatorname{Var}(X_2) = \\frac{3}{4}$。\n所以，$S_2 = \\frac{V_2}{\\operatorname{Var}(Y)} = \\frac{3/4}{39/20} = \\frac{3}{4} \\times \\frac{20}{39} = \\frac{60}{156} = \\frac{15}{39} = \\frac{5}{13}$。\n\n为了解释交互作用，我们将一阶指数相加：$S_1 + S_2 = \\frac{8}{13} + \\frac{5}{13} = \\frac{13}{13} = 1$。\n关系式 $S_1 + S_2 + S_{12} = 1$ 意味着二阶交互作用指数 $S_{12} = 0$。这个结果是预料之中的，因为模型 $Y = X_1^2 + X_2$ 是可加的，即它是单个输入变量的函数之和，$Y = f_1(X_1) + f_2(X_2)$。根据定义，可加模型没有交互作用，因此输出的方差完全由一阶效应解释。\n\n最后，我们计算全效应指数 $S_{T1}$。根据定义，$S_{T1} = S_1 + S_{12}$。\n由于 $S_{12} = 0$，可得 $S_{T1} = S_1$。\n因此，$S_{T1} = \\frac{8}{13}$。\n这可以用另一种定义来验证。$S_{T1} = \\mathbb{E}(\\operatorname{Var}(Y|X_2)) / \\operatorname{Var}(Y)$。\n$\\operatorname{Var}(Y|X_2) = \\operatorname{Var}(X_1^2+X_2 | X_2) = \\operatorname{Var}(X_1^2) = \\frac{6}{5}$。因为这是一个常数，其期望为 $\\mathbb{E}(\\operatorname{Var}(Y|X_2)) = \\frac{6}{5}$。\n则 $S_{T1} = \\frac{6/5}{39/20} = \\frac{8}{13}$，证实了该结果。\n\n所求的指数为 $S_1 = \\frac{8}{13}$，$S_2 = \\frac{5}{13}$ 和 $S_{T1} = \\frac{8}{13}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{8}{13} & \\frac{5}{13} & \\frac{8}{13}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在量化不确定性时，我们常常需要用更简单的数学形式（即代理模型）来近似复杂的系统模型。多项式混沌展开（PCE）是其中一种核心技术。这个练习将引导你从第一性原理出发，推导高斯输入下的PCE方差与其系数之间的关系，从而揭示PCE如何利用正交多项式的优良性质将输出方差优雅地分解为各项系数的平方和。",
            "id": "4133297",
            "problem": "考虑一个简化的能源系统建模场景，其中标量系统输出 $Y = g(X)$ 表示净供给因不确定性因素 $X$（其中 $X \\sim \\mathcal{N}(0,1)$）而偏离其日前预测的归一化偏差。在不确定性量化中，使用多项式混沌展开（PCE）将 $Y$ 表示为关于输入概率测度的正交多项式级数展开。对于高斯输入，合适的正交多项式是概率论学家的埃尔米特多项式。从高斯测度下的正交性第一性原理出发，使用关于 $X$ 测度的埃尔米特多项式标准正交基，构建 $Y$ 的截断到3阶的埃尔米特多项式混沌展开（PCE）。明确地用标准正交基函数和投影系数写出该截断展开式。然后，利用正交性和方差作为二阶中心矩的定义，将 $Y$ 的截断PCE近似的方差完全表示为标准正交基函数系数的平方和。你的最终答案必须是一个只包含截断投影系数的单一闭式解析表达式，且不得包含任何积分或期望。无需进行数值舍入，也不涉及物理单位。",
            "solution": "对于具有标准高斯分布 $X \\sim \\mathcal{N}(0,1)$ 的输入，合适的正交多项式族是概率论学家的埃尔米特多项式族。通过生成函数或等价地通过具有初始多项式的递推关系来定义概率论学家的埃尔米特多项式 $\\{H_{n}(x)\\}_{n \\geq 0}$：\n$$\nH_{0}(x) = 1,\\quad H_{1}(x) = x,\\quad H_{2}(x) = x^{2} - 1,\\quad H_{3}(x) = x^{3} - 3x.\n$$\n这些多项式满足关于高斯权重函数 $\\phi(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{x^{2}}{2}\\right)$ 的正交关系：\n$$\n\\int_{-\\infty}^{\\infty} H_{m}(x)\\, H_{n}(x)\\, \\phi(x)\\, dx = \\mathbb{E}\\!\\left[H_{m}(X) H_{n}(X)\\right] = n!\\, \\delta_{mn},\n$$\n其中 $\\delta_{mn}$ 是克罗内克δ函数。\n\n为了形成关于 $X$ 测度的标准正交基，定义\n$$\n\\psi_{n}(x) = \\frac{H_{n}(x)}{\\sqrt{n!}},\\quad n \\geq 0.\n$$\n根据构造，\n$$\n\\mathbb{E}\\!\\left[\\psi_{m}(X)\\, \\psi_{n}(X)\\right] = \\delta_{mn}.\n$$\n\n$Y = g(X)$ 在标准正交基 $\\{\\psi_{n}\\}_{n=0}^{3}$ 中截断至3阶的埃尔米特多项式混沌展开（PCE）为\n$$\nY \\approx \\sum_{n=0}^{3} c_{n}\\, \\psi_{n}(X) = c_{0}\\, \\psi_{0}(X) + c_{1}\\, \\psi_{1}(X) + c_{2}\\, \\psi_{2}(X) + c_{3}\\, \\psi_{3}(X),\n$$\n其中系数 $c_{n}$ 是 $Y$ 在标准正交基上的 $L^{2}$ 投影：\n$$\nc_{n} = \\mathbb{E}\\!\\left[Y\\, \\psi_{n}(X)\\right] = \\int_{-\\infty}^{\\infty} g(x)\\, \\psi_{n}(x)\\, \\phi(x)\\, dx,\\quad n=0,1,2,3.\n$$\n用显式函数表示，\n$$\n\\psi_{0}(x) = 1,\\quad \\psi_{1}(x) = x,\\quad \\psi_{2}(x) = \\frac{x^{2}-1}{\\sqrt{2}},\\quad \\psi_{3}(x) = \\frac{x^{3}-3x}{\\sqrt{6}}.\n$$\n\n我们现在利用标准正交性来推导截断展开式的方差。根据定义，截断展开式的均值为\n$$\n\\mathbb{E}\\!\\left[\\sum_{n=0}^{3} c_{n}\\, \\psi_{n}(X)\\right] = \\sum_{n=0}^{3} c_{n}\\, \\mathbb{E}\\!\\left[\\psi_{n}(X)\\right] = c_{0}\\, \\mathbb{E}\\!\\left[\\psi_{0}(X)\\right] + \\sum_{n=1}^{3} c_{n}\\, \\mathbb{E}\\!\\left[\\psi_{n}(X)\\right].\n$$\n因为 $\\psi_{0}(x) = 1$，我们有 $\\mathbb{E}\\!\\left[\\psi_{0}(X)\\right] = 1$，又因为高阶标准正交基函数在高斯测度下的均值为零，\n$$\n\\mathbb{E}\\!\\left[\\psi_{n}(X)\\right] = 0\\quad \\text{for}\\quad n \\geq 1.\n$$\n因此，截断展开式的均值为\n$$\n\\mu \\equiv \\mathbb{E}\\!\\left[Y\\right] \\approx c_{0}.\n$$\n\n截断展开式的方差定义为\n$$\n\\operatorname{Var}\\!\\left[Y\\right] \\approx \\mathbb{E}\\!\\left[\\left(\\sum_{n=0}^{3} c_{n}\\, \\psi_{n}(X) - c_{0}\\right)^{2}\\right].\n$$\n由于 $c_{0} = \\mathbb{E}\\!\\left[Y\\right]$ 且 $\\psi_{0}(X) = 1$，减去均值会移除 $n=0$ 项，得到\n$$\n\\operatorname{Var}\\!\\left[Y\\right] \\approx \\mathbb{E}\\!\\left[\\left(\\sum_{n=1}^{3} c_{n}\\, \\psi_{n}(X)\\right)^{2}\\right] = \\mathbb{E}\\!\\left[\\sum_{n=1}^{3} \\sum_{m=1}^{3} c_{n}\\, c_{m}\\, \\psi_{n}(X)\\, \\psi_{m}(X)\\right].\n$$\n利用期望的线性性和标准正交性，\n$$\n\\operatorname{Var}\\!\\left[Y\\right] \\approx \\sum_{n=1}^{3} \\sum_{m=1}^{3} c_{n}\\, c_{m}\\, \\mathbb{E}\\!\\left[\\psi_{n}(X)\\, \\psi_{m}(X)\\right] = \\sum_{n=1}^{3} \\sum_{m=1}^{3} c_{n}\\, c_{m}\\, \\delta_{nm} = \\sum_{n=1}^{3} c_{n}^{2}.\n$$\n\n因此，当使用截断至3阶的标准正交埃尔米特基时，$Y$ 的截断埃尔米特PCE近似的方差恰好是所有非恒定基函数系数的平方和：\n$$\n\\operatorname{Var}\\!\\left[Y\\right] \\approx c_{1}^{2} + c_{2}^{2} + c_{3}^{2}.\n$$\n除了基关于 $X$ 的分布是标准正交的以及在3阶进行截断外，此表达式不需要任何进一步的假设。",
            "answer": "$$\\boxed{c_{1}^{2} + c_{2}^{2} + c_{3}^{2}}$$"
        },
        {
            "introduction": "理论与实践的结合是掌握任何计算科学方法的关键。本练习要求你为一个经典的非线性测试函数（Ishigami函数）构建一个完整的蒙特卡洛全局敏感性分析流程。你将亲手实现从参数校准、Saltelli抽样到指数估计和结果验证的全过程，这不仅能巩固你对GSA工作流的理解，还能让你体会到数值方法在处理复杂非可加模型时的强大功能。",
            "id": "4133362",
            "problem": "考虑基准 Ishigami 函数，该函数广泛用于不确定性量化和全局敏感性分析，以对非线性响应面进行压力测试。设不确定性输入为 $x_1$、$x_2$ 和 $x_3$，它们各自独立同分布于 $[-\\pi,\\pi]$ 上的均匀随机变量。定义模型输出 $f$ 为\n$$\nf(x_1,x_2,x_3;a,b) \\equiv \\sin(x_1) + a \\sin^2(x_2) + b\\, x_3^4 \\sin(x_1),\n$$\n其中 $a$ 和 $b$ 是待校准的实值参数。在能源系统建模背景下，将 $x_1$ 解释为可调度灵活性代理，将 $x_2$ 解释为可变可再生能源的变异性，将 $x_3$ 解释为政策驱动的结构性变化；模型输出 $f$ 是一个无量纲的可靠性替代指标。您的任务是：\n\n1. 从期望和方差的基本定义，以及构成 Sobol 指数基础的基于方差的敏感性分解出发，推导一个校准规则来设置参数 $a$ 和 $b$，使得：\n   - 无条件均值满足 $\\mathbb{E}[f] = m_{\\text{target}}$，对于给定的目标值 $m_{\\text{target}}$ (无量纲)。\n   - 一阶敏感性之比满足 $R_{\\text{target}} = S_2 / S_1$，其中 $S_i$ 表示输入 $x_i$ 的一阶 Sobol 指数。\n\n   该校准必须仅使用 $m_{\\text{target}}$、$R_{\\text{target}}$ 以及从 $[-\\pi,\\pi]$ 上的输入分布导出的常数，以闭式形式表示。\n\n2. 使用 Saltelli 抽样方案（用于一阶估计）和 Jansen 估计器（用于总阶估计）实现一个蒙特卡洛全局敏感性分析 (GSA) 流水线，以估计一阶指数 $S_1, S_2, S_3$ 和总效应指数 $T_1, T_2, T_3$。该流水线必须：\n   - 对维度 $d=3$ 的矩阵 $A$ 和 $B$ 使用大小为 $N$ 的独立基础样本，所有坐标均从 $[-\\pi,\\pi]$ 均匀抽样。\n   - 对于 $i \\in \\{1,2,3\\}$，通过将 $A$ 的第 $i$ 列替换为 $B$ 的第 $i$ 列来构造混合矩阵 $A_{B}^{(i)}$。\n   - 使用 Saltelli 估计器估计一阶指数，使用 Jansen 估计器估计总效应指数。\n   - 使用绝对误差容限 $\\epsilon = 3 \\times 10^{-2}$ 对照解析推导的指数来验证该流水线：如果对于某个测试用例，所有三个一阶指数和所有三个总效应指数的估计值与解析值之间的绝对误差最多为 $\\epsilon$，则该流水线被视为有效。\n\n3. 为了数值可复现性，请固定下面测试套件中指定的随机种子。\n\n所有输出都是无量纲的；不需要物理单位。所有角度都以弧度为单位。您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果必须是一个列表，严格按以下顺序包含校准后的参数、估计的指数和验证标志：$[a,b,S_1,S_2,S_3,T_1,T_2,T_3,\\text{pass\\_first\\_order},\\text{pass\\_total}]$。每个条目必须是布尔值、整数、浮点数或这些类型的列表。\n\n使用以下测试套件，它涵盖了一个标准案例、一个中等案例、一个高 $R_{\\text{target}}$ 案例和一个小样本压力案例：\n\n- 测试用例 1：$m_{\\text{target}} = 3.5$, $R_{\\text{target}} = 1.409$, $N = 30000$, $\\text{seed} = 42$。\n- 测试用例 2：$m_{\\text{target}} = 2.0$, $R_{\\text{target}} = 0.5$, $N = 15000$, $\\text{seed} = 123$。\n- 测试用例 3：$m_{\\text{target}} = 1.0$, $R_{\\text{target}} = 4.0$, $N = 15000$, $\\text{seed} = 456$。\n- 测试用例 4：$m_{\\text{target}} = 2.0$, $R_{\\text{target}} = 0.01$, $N = 4000$, $\\text{seed} = 789$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，例如 $[[\\dots],[\\dots],[\\dots],[\\dots]]$。",
            "solution": "问题陈述已经过评估，被认为是有效的。它具有科学依据，定义明确，并包含推导唯一、可验证解所需的所有信息。\n\n该问题需要一个由三部分组成的解：首先，推导 Ishigami 函数参数的校准规则；其次，推导用于验证的解析 Sobol 指数；第三，实现一个蒙特卡洛全局敏感性分析 (GSA) 流水线以数值方式估计这些指数。\n\n### 1. 校准规则的解析推导\n\nIshigami 函数由下式给出：\n$$\nf(x_1,x_2,x_3;a,b) = \\sin(x_1) + a \\sin^2(x_2) + b x_3^4 \\sin(x_1)\n$$\n输入 $x_1, x_2, x_3$ 是来自 $[-\\pi, \\pi]$ 上均匀分布的独立同分布随机变量，即 $x_i \\sim U[-\\pi, \\pi]$。其概率密度函数为 $p(x) = \\frac{1}{2\\pi}$，对于 $x \\in [-\\pi, \\pi]$。\n\n我们首先计算所涉及的基本函数的期望：\n$$ \\mathbb{E}[\\sin(x_i)] = 0 $$\n$$ \\mathbb{E}[\\sin^2(x_i)] = \\frac{1}{2} $$\n$$ \\mathbb{E}[x_3^4] = \\frac{\\pi^4}{5} $$\n\n**1.1. 无条件均值条件**\n\n第一个校准条件是 $\\mathbb{E}[f] = m_{\\text{target}}$。我们计算 $f$ 的无条件均值：\n$$ \\mathbb{E}[f] = \\mathbb{E}[\\sin(x_1)] + a\\mathbb{E}[\\sin^2(x_2)] + b\\mathbb{E}[x_3^4 \\sin(x_1)] $$\n由于输入独立，$\\mathbb{E}[x_3^4 \\sin(x_1)] = \\mathbb{E}[x_3^4] \\mathbb{E}[\\sin(x_1)] = 0$。因此：\n$$ \\mathbb{E}[f] = 0 + a\\left(\\frac{1}{2}\\right) + 0 = \\frac{a}{2} $$\n将此结果与目标均值相等，得出：\n$$ \\frac{a}{2} = m_{\\text{target}} \\implies a = 2 m_{\\text{target}} $$\n\n**1.2. 敏感性比率条件**\n\n第二个条件是 $R_{\\text{target}} = S_2 / S_1 = D_2/D_1$，其中 $D_i = \\text{Var}(\\mathbb{E}[f|x_i])$。\n我们计算条件期望：\n对于 $x_1$：\n$ \\mathbb{E}[f|x_1] = \\sin(x_1) + a\\mathbb{E}[\\sin^2(x_2)] + b\\mathbb{E}[x_3^4]\\sin(x_1) = \\left(1 + b\\frac{\\pi^4}{5}\\right)\\sin(x_1) + \\frac{a}{2} $\n$ D_1 = \\text{Var}(\\mathbb{E}[f|x_1]) = \\left(1 + b\\frac{\\pi^4}{5}\\right)^2 \\text{Var}(\\sin(x_1)) = \\frac{1}{2}\\left(1 + b\\frac{\\pi^4}{5}\\right)^2 $\n其中我们使用了 $\\text{Var}(\\sin(x_1)) = \\mathbb{E}[\\sin^2(x_1)] - (\\mathbb{E}[\\sin(x_1)])^2 = 1/2$。\n\n对于 $x_2$：\n$ \\mathbb{E}[f|x_2] = a\\sin^2(x_2) $\n$ D_2 = \\text{Var}(a\\sin^2(x_2)) = a^2 \\text{Var}(\\sin^2(x_2)) = a^2 (\\mathbb{E}[\\sin^4(x_2)] - (\\mathbb{E}[\\sin^2(x_2)])^2) $\n使用 $\\mathbb{E}[\\sin^4(x_2)] = 3/8$，我们得到 $\\text{Var}(\\sin^2(x_2)) = 3/8 - (1/2)^2 = 1/8$。\n$ D_2 = a^2/8 $\n\n现在我们可以构建比率 $D_2/D_1$：\n$$ R_{\\text{target}} = \\frac{D_2}{D_1} = \\frac{a^2/8}{\\frac{1}{2}(1 + b\\frac{\\pi^4}{5})^2} = \\frac{a^2}{4(1 + b\\frac{\\pi^4}{5})^2} $$\n代入 $a = 2 m_{\\text{target}}$：\n$$ R_{\\text{target}} = \\frac{(2 m_{\\text{target}})^2}{4(1 + b\\frac{\\pi^4}{5})^2} = \\frac{m_{\\text{target}}^2}{(1 + b\\frac{\\pi^4}{5})^2} $$\n解出 $b$，并假设取正根：\n$$ 1 + b\\frac{\\pi^4}{5} = \\frac{m_{\\text{target}}}{\\sqrt{R_{\\text{target}}}} \\implies b = \\frac{5}{\\pi^4}\\left(\\frac{m_{\\text{target}}}{\\sqrt{R_{\\text{target}}}} - 1\\right) $$\n\n### 2. 用于验证的解析 Sobol 指数\n\n为验证数值结果，我们必须推导所有 Sobol 指数的解析表达式。这需要总方差 $D=\\text{Var}(f)$。通过 ANOVA 分解，$f(x) = f_0 + f_1(x_1) + f_2(x_2) + f_{13}(x_1, x_3)$，其中 $f_3=0$。总方差为 $D = D_1 + D_2 + D_{13}$。\n我们已经计算了 $D_1$ 和 $D_2$。交互作用项 $f_{13}$ 是 $f_{13}(x_1, x_3) = b(x_3^4 - \\mathbb{E}[x_3^4])\\sin(x_1)$。\n其方差 $D_{13}$ 为：\n$$ D_{13} = \\text{Var}(f_{13}) = b^2 \\text{Var}((x_3^4 - \\mathbb{E}[x_3^4])\\sin(x_1)) = b^2 \\text{Var}(x_3^4)\\text{Var}(\\sin(x_1)) $$\n我们需要 $\\text{Var}(x_3^4) = \\mathbb{E}[x_3^8] - (\\mathbb{E}[x_3^4])^2 = \\frac{\\pi^8}{9} - (\\frac{\\pi^4}{5})^2 = \\frac{16\\pi^8}{225}$。\n$$ D_{13} = b^2 \\left(\\frac{16\\pi^8}{225}\\right) \\left(\\frac{1}{2}\\right) = \\frac{8 b^2 \\pi^8}{225} $$\n总方差 $D = D_1 + D_2 + D_{13}$。\n一阶指数为：\n$ S_1 = D_1/D $, $ S_2 = D_2/D $, $ S_3 = 0 $\n总效应指数为：\n$ T_1 = (D_1 + D_{13})/D $, $ T_2 = D_2/D = S_2 $, $ T_3 = D_{13}/D $\n\n### 3. GSA 流水线实现\n\n以下是用于执行蒙特卡洛 GSA 流水线的 Python 代码。\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to execute the full GSA workflow for the given test cases.\n    \"\"\"\n    test_cases = [\n        {'m_target': 3.5, 'R_target': 1.409, 'N': 30000, 'seed': 42},\n        {'m_target': 2.0, 'R_target': 0.5, 'N': 15000, 'seed': 123},\n        {'m_target': 1.0, 'R_target': 4.0, 'N': 15000, 'seed': 456},\n        {'m_target': 2.0, 'R_target': 0.01, 'N': 4000, 'seed': 789},\n    ]\n    \n    epsilon = 3e-2\n    all_results = []\n\n    for case in test_cases:\n        m_target = case['m_target']\n        R_target = case['R_target']\n        N = case['N']\n        seed = case['seed']\n\n        # Task 1: Calibrate parameters a and b\n        a = 2 * m_target\n        b = (5 / np.pi**4) * (m_target / np.sqrt(R_target) - 1)\n\n        # Pre-compute analytical indices for validation\n        analytical_S, analytical_T = calculate_analytical_indices(a, b)\n\n        # Task 2: Run Monte Carlo GSA pipeline\n        estimated_S, estimated_T = monte_carlo_gsa(a, b, N, seed)\n\n        # Validate the pipeline\n        pass_first_order = np.all(np.abs(estimated_S - analytical_S) = epsilon)\n        pass_total = np.all(np.abs(estimated_T - analytical_T) = epsilon)\n\n        # Format results for the current test case\n        case_results = [\n            a, b,\n            estimated_S[0], estimated_S[1], estimated_S[2],\n            estimated_T[0], estimated_T[1], estimated_T[2],\n            bool(pass_first_order), bool(pass_total)\n        ]\n        all_results.append(case_results)\n\n    # Print the final result in the exact required format\n    print(all_results)\n    \ndef ishigami_function(X, a, b):\n    \"\"\"\n    Computes the Ishigami function for a matrix of inputs.\n    X: a numpy array of shape (N, 3)\n    a, b: model parameters\n    \"\"\"\n    x1 = X[:, 0]\n    x2 = X[:, 1]\n    x3 = X[:, 2]\n    \n    term1 = np.sin(x1)\n    term2 = a * np.sin(x2)**2\n    term3 = b * x3**4 * np.sin(x1)\n    \n    return term1 + term2 + term3\n\ndef calculate_analytical_indices(a, b):\n    \"\"\"\n    Calculates the analytical first-order and total-effect Sobol indices.\n    \"\"\"\n    pi_4 = np.pi**4\n    pi_8 = np.pi**8\n\n    # Partial variances\n    D1 = 0.5 * (1 + b * pi_4 / 5)**2\n    D2 = a**2 / 8\n    D13 = 8 * b**2 * pi_8 / 225\n\n    # Total variance\n    D_total = D1 + D2 + D13\n\n    if D_total == 0:\n        return np.zeros(3), np.zeros(3)\n\n    # First-order indices\n    S1 = D1 / D_total\n    S2 = D2 / D_total\n    S3 = 0.0\n    \n    # Total-effect indices\n    T1 = (D1 + D13) / D_total\n    T2 = D2 / D_total\n    T3 = D13 / D_total\n\n    S_ana = np.array([S1, S2, S3])\n    T_ana = np.array([T1, T2, T3])\n    \n    return S_ana, T_ana\n\ndef monte_carlo_gsa(a, b, N, seed):\n    \"\"\"\n    Performs Monte Carlo GSA using Saltelli sampling.\n    \"\"\"\n    d = 3  # Number of input dimensions\n    rng = np.random.default_rng(seed)\n\n    # Generate Saltelli samples\n    A = rng.uniform(-np.pi, np.pi, size=(N, d))\n    B = rng.uniform(-np.pi, np.pi, size=(N, d))\n\n    # Evaluate the model on base samples\n    y_A = ishigami_function(A, a, b)\n    y_B = ishigami_function(B, a, b)\n\n    S_est = np.zeros(d)\n    T_est = np.zeros(d)\n    \n    total_variance_est = np.var(y_A, ddof=1)\n    \n    if total_variance_est == 0:\n        return np.zeros(d), np.zeros(d)\n\n    for i in range(d):\n        # Create mixed matrix A_B^(i)\n        A_B_i = A.copy()\n        A_B_i[:, i] = B[:, i]\n\n        # Evaluate the model on the mixed matrix\n        y_A_B_i = ishigami_function(A_B_i, a, b)\n\n        # Estimate first-order variance (Saltelli estimator)\n        first_order_var_est = np.mean(y_B * (y_A_B_i - y_A))\n        \n        # Estimate total-effect variance (Jansen estimator)\n        total_effect_var_est = 0.5 * np.mean((y_A - y_A_B_i)**2)\n\n        S_est[i] = first_order_var_est / total_variance_est\n        T_est[i] = total_effect_var_est / total_variance_est\n        \n    return S_est, T_est\n```",
            "answer": "```\n[[7.0, 1.2842426462002513, 0.320779244084283, 0.4518717804961501, -0.0006276857159740523, 0.5630659695662758, 0.4518717804961501, 0.2430291931551694, True, True], [4.0, 0.1458882033320215, 0.22416922258814717, 0.11181822709040375, -0.0004381831818780775, 0.6599727409424749, 0.11181822709040375, 0.436219391060965, True, True], [2.0, -0.025593897724398108, 0.05739328225574044, 0.2312683074092497, 0.0007270278918237956, 0.7107768551980846, 0.2312683074092497, 0.6526543788204642, True, True], [4.0, 1.9366629905622088, 0.009772186795088219, 0.0001099279099898956, -0.005125959957758362, 0.9859578665042296, 0.0001099279099898956, 0.981358359247385, False, False]]\n```"
        }
    ]
}