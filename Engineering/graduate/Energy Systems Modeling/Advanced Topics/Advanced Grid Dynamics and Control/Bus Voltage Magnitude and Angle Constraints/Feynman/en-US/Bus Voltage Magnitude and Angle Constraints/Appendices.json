{
    "hands_on_practices": [
        {
            "introduction": "Understanding how system variables like voltage magnitudes and angles govern the flow of power is fundamental to energy systems modeling. This first exercise reinforces these first principles by guiding you through the derivation of the active power flow equation for a lossless transmission line . By deriving this relationship from scratch, you will solidify your understanding of the physical connection between system state and power transfer and clarify the distinct roles of series reactance and shunt susceptance.",
            "id": "4073467",
            "problem": "Consider a balanced, steady-state Alternating Current (AC) power system with buses $i$ and $j$ connected by a transmission line modeled by the $\\pi$-equivalent. The line has lossless series reactance $X_{ij} > 0$ and a total shunt susceptance $B_{ij} \\ge 0$ that is split equally and placed at both ends of the line. There is no series resistance and no shunt conductance. Let the complex bus voltages be $V_{i} = |V_{i}| \\exp(j \\theta_{i})$ and $V_{j} = |V_{j}| \\exp(j \\theta_{j})$, with the angle difference $\\theta_{ij} \\equiv \\theta_{i} - \\theta_{j}$ measured in radians. The active power flow from bus $i$ to bus $j$ along the branch is denoted $P_{ij} \\equiv \\operatorname{Re}\\{S_{ij}\\}$, where $S_{ij}$ is the complex power injected into the branch from bus $i$.\n\nUsing only Kirchhoff’s laws, the phasor-domain Ohm’s law, and the definition of complex power, derive the closed-form analytic expression for $P_{ij}$ in terms of $|V_{i}|$, $|V_{j}|$, $\\theta_{ij}$, and $X_{ij}$, allowing for the presence of $B_{ij}$ in the model. Explicitly state whether the shunt susceptance $B_{ij}$ appears in the final expression for $P_{ij}$ and justify your conclusion through the derivation.\n\nAdditionally, the buses are subject to operational constraints\n$$\\underline{V}_{i} \\le |V_{i}| \\le \\overline{V}_{i}, \\quad \\underline{V}_{j} \\le |V_{j}| \\le \\overline{V}_{j}, \\quad |\\theta_{ij}| \\le \\overline{\\theta},$$\nwith $0  \\overline{\\theta}  \\frac{\\pi}{2}$. Explain how these constraints shape the feasible set for $P_{ij}$, but express your final answer solely as the closed-form analytic expression for $P_{ij}$ as a function of $|V_{i}|$, $|V_{j}|$, $\\theta_{ij}$, and $X_{ij}$. Angles must be treated in radians. No numerical evaluation is required.",
            "solution": "The problem statement is assessed to be valid. It is a standard problem in power system analysis, scientifically grounded in the principles of AC circuit theory. All necessary parameters and definitions are provided, and the problem is well-posed, objective, and free from internal contradictions or ambiguities that would prevent a rigorous solution.\n\nThe problem asks for the derivation of the active power flow, $P_{ij}$, from bus $i$ to bus $j$. The transmission line connecting these buses is represented by a $\\pi$-equivalent model. In this model, the series impedance is purely reactive, $Z_{series} = jX_{ij}$, as the series resistance is zero. The total shunt admittance is purely susceptive, $Y_{shunt} = jB_{ij}$, as the shunt conductance is zero. This shunt admittance is split equally, with an admittance of $Y_{i,shunt} = j\\frac{B_{ij}}{2}$ at the bus $i$ end and $Y_{j,shunt} = j\\frac{B_{ij}}{2}$ at the bus $j$ end.\n\nThe problem defines the complex power flow, $S_{ij}$, as the power injected from bus $i$ into the entire branch (the $\\pi$-model). The current injected from bus $i$ into the branch, denoted $I_{ij}$, is the sum of the current flowing into the shunt element at bus $i$, $I_{i,shunt}$, and the current flowing into the series element, $I_{series}$.\n$$I_{ij} = I_{i,shunt} + I_{series}$$\n\nUsing Ohm's law in phasor form, we can express these currents in terms of the bus voltages $V_{i}$ and $V_{j}$. The shunt element at bus $i$ is connected between the bus and the ground (neutral reference), so the current through it is:\n$$I_{i,shunt} = V_{i} Y_{i,shunt} = V_{i} \\left(j\\frac{B_{ij}}{2}\\right)$$\nThe series element is connected between the two buses, so the current through it is:\n$$I_{series} = \\frac{V_{i} - V_{j}}{Z_{series}} = \\frac{V_{i} - V_{j}}{jX_{ij}}$$\n\nThe complex power $S_{ij}$ injected from bus $i$ into the branch is given by the formula $S_{ij} = V_{i} I_{ij}^{*}$. Substituting the expression for $I_{ij}$:\n$$S_{ij} = V_{i} (I_{i,shunt} + I_{series})^{*} = V_{i} I_{i,shunt}^{*} + V_{i} I_{series}^{*}$$\nThis can be analyzed as the sum of power into the shunt component, $S_{i,shunt} = V_{i} I_{i,shunt}^{*}$, and power into the series component, $S_{i,series} = V_{i} I_{series}^{*}$.\n\nFirst, we analyze the power into the shunt component:\n$$S_{i,shunt} = V_{i} \\left(V_{i} j\\frac{B_{ij}}{2}\\right)^{*} = V_{i} \\left(V_{i}^{*} (-j\\frac{B_{ij}}{2})\\right) = (V_{i}V_{i}^{*}) \\left(-j\\frac{B_{ij}}{2}\\right)$$\nSince $V_{i}V_{i}^{*} = |V_{i}|^2$, this simplifies to:\n$$S_{i,shunt} = -j \\frac{|V_{i}|^2 B_{ij}}{2}$$\nThis is a purely imaginary quantity, representing reactive power. The active power associated with the shunt element is its real part, which is zero:\n$$P_{i,shunt} = \\operatorname{Re}\\{S_{i,shunt}\\} = 0$$\n\nNext, we analyze the power into the series component:\n$$S_{i,series} = V_{i} I_{series}^{*} = V_{i} \\left(\\frac{V_{i} - V_{j}}{jX_{ij}}\\right)^{*}$$\nThe conjugate of the current term is:\n$$I_{series}^{*} = \\frac{(V_{i} - V_{j})^{*}}{(jX_{ij})^{*}} = \\frac{V_{i}^{*} - V_{j}^{*}}{-jX_{ij}}$$\nSubstituting this back into the expression for $S_{i,series}$:\n$$S_{i,series} = V_{i} \\left(\\frac{V_{i}^{*} - V_{j}^{*}}{-jX_{ij}}\\right) = \\frac{V_{i}V_{i}^{*} - V_{i}V_{j}^{*}}{-jX_{ij}} = \\frac{|V_{i}|^2 - V_{i}V_{j}^{*}}{-jX_{ij}}$$\nTo clear the complex number from the denominator, we multiply the numerator and denominator by $j$:\n$$S_{i,series} = j\\frac{|V_{i}|^2 - V_{i}V_{j}^{*}}{X_{ij}}$$\n\nThe active power flow $P_{ij}$ is the real part of the total complex power $S_{ij} = S_{i,shunt} + S_{i,series}$.\n$$P_{ij} = \\operatorname{Re}\\{S_{ij}\\} = \\operatorname{Re}\\{S_{i,shunt}\\} + \\operatorname{Re}\\{S_{i,series}\\} = 0 + \\operatorname{Re}\\{S_{i,series}\\}$$\n$$P_{ij} = \\operatorname{Re}\\left\\{j\\frac{|V_{i}|^2 - V_{i}V_{j}^{*}}{X_{ij}}\\right\\}$$\nNow, we express the term $V_{i}V_{j}^{*}$ using polar coordinates. Given $V_{i} = |V_{i}| \\exp(j\\theta_{i})$ and $V_{j} = |V_{j}| \\exp(j\\theta_{j})$, the conjugate of $V_{j}$ is $V_{j}^{*} = |V_{j}| \\exp(-j\\theta_{j})$.\n$$V_{i}V_{j}^{*} = \\left(|V_{i}| \\exp(j\\theta_{i})\\right) \\left(|V_{j}| \\exp(-j\\theta_{j})\\right) = |V_{i}||V_{j}| \\exp(j(\\theta_{i} - \\theta_{j}))$$\nUsing the definition $\\theta_{ij} \\equiv \\theta_{i} - \\theta_{j}$, we have:\n$$V_{i}V_{j}^{*} = |V_{i}||V_{j}| \\exp(j\\theta_{ij}) = |V_{i}||V_{j}|(\\cos\\theta_{ij} + j\\sin\\theta_{ij})$$\nSubstituting this into the expression for $P_{ij}$:\n$$P_{ij} = \\operatorname{Re}\\left\\{ \\frac{j}{X_{ij}} \\left( |V_{i}|^2 - |V_{i}||V_{j}|(\\cos\\theta_{ij} + j\\sin\\theta_{ij}) \\right) \\right\\}$$\n$$P_{ij} = \\operatorname{Re}\\left\\{ \\frac{j}{X_{ij}} \\left( (|V_{i}|^2 - |V_{i}||V_{j}|\\cos\\theta_{ij}) - j|V_{i}||V_{j}|\\sin\\theta_{ij} \\right) \\right\\}$$\nDistributing the factor of $j$ inside the parentheses:\n$$P_{ij} = \\operatorname{Re}\\left\\{ \\frac{1}{X_{ij}} \\left( j(|V_{i}|^2 - |V_{i}||V_{j}|\\cos\\theta_{ij}) - j^2|V_{i}||V_{j}|\\sin\\theta_{ij} \\right) \\right\\}$$\nSince $j^2 = -1$:\n$$P_{ij} = \\operatorname{Re}\\left\\{ \\frac{1}{X_{ij}} \\left( |V_{i}||V_{j}|\\sin\\theta_{ij} + j(|V_{i}|^2 - |V_{i}||V_{j}|\\cos\\theta_{ij}) \\right) \\right\\}$$\nThe real part of this complex number is the term without a $j$:\n$$P_{ij} = \\frac{|V_{i}||V_{j}|}{X_{ij}} \\sin(\\theta_{ij})$$\n\nThe shunt susceptance $B_{ij}$ does not appear in the final expression for the active power flow $P_{ij}$. The justification, as shown in the derivation, is that the shunt elements are modeled as pure susceptances. A pure susceptance is an ideal reactive component that does not dissipate any active power. The complex power it draws, $S_{i,shunt}$, is purely imaginary, meaning its real part is zero. Therefore, the shunt susceptance only affects the reactive power flow, not the active power flow.\n\nThe operational constraints on bus voltage magnitudes and angle difference shape the feasible set for $P_{ij}$. The expression for $P_{ij}$ is a function of $|V_{i}|$, $|V_{j}|$, and $\\theta_{ij}$. The constraints are $\\underline{V}_{i} \\le |V_{i}| \\le \\overline{V}_{i}$, $\\underline{V}_{j} \\le |V_{j}| \\le \\overline{V}_{j}$, and $|\\theta_{ij}| \\le \\overline{\\theta}$, which implies $-\\overline{\\theta} \\le \\theta_{ij} \\le \\overline{\\theta}$. Since $X_{ij} > 0$ and $0  \\overline{\\theta}  \\pi/2$, the function $\\sin(\\theta_{ij})$ is monotonically increasing over the interval $[-\\overline{\\theta}, \\overline{\\theta}]$.\nTo find the maximum value of $P_{ij}$, we must maximize the product $|V_{i}||V_{j}|\\sin(\\theta_{ij})$. This occurs when each term is maximized: $|V_{i}| = \\overline{V}_{i}$, $|V_{j}| = \\overline{V}_{j}$, and $\\theta_{ij} = \\overline{\\theta}$.\n$$P_{ij}^{\\max} = \\frac{\\overline{V}_{i}\\overline{V}_{j}}{X_{ij}} \\sin(\\overline{\\theta})$$\nTo find the minimum value of $P_{ij}$, we must make the product as negative as possible. This occurs when $\\sin(\\theta_{ij})$ is minimized, i.e., at $\\theta_{ij} = -\\overline{\\theta}$, while the magnitude product $|V_{i}||V_{j}|$ is maximized.\n$$P_{ij}^{\\min} = \\frac{\\overline{V}_{i}\\overline{V}_{j}}{X_{ij}} \\sin(-\\overline{\\theta}) = -\\frac{\\overline{V}_{i}\\overline{V}_{j}}{X_{ij}} \\sin(\\overline{\\theta})$$\nThus, the feasible set for $P_{ij}$ is the closed interval $[P_{ij}^{\\min}, P_{ij}^{\\max}]$.",
            "answer": "$$\\boxed{\\frac{|V_{i}| |V_{j}|}{X_{ij}} \\sin(\\theta_{ij})}$$"
        },
        {
            "introduction": "While exact formulas provide physical truth, large-scale system analysis often requires computationally efficient approximations. This practice explores the critical trade-off between accuracy and tractability by focusing on the widely used \"small-angle\" approximation . By calculating the error between the exact nonlinear power flow equation and its linear approximation for a realistic operating point, you will gain a quantitative appreciation for the validity and limitations of simplified models.",
            "id": "4073469",
            "problem": "Consider a single series branch connecting bus $i$ to bus $j$ in an Alternating Current (AC) transmission network. The branch is modeled as an ideal, lossless series reactance with reactance $X_{ij} > 0$ in the per unit (p.u.) system, and shunt admittances are neglected. Bus phasor voltages are $V_{i} \\angle \\theta_{i}$ and $V_{j} \\angle \\theta_{j}$, where $V_{i}$ and $V_{j}$ are the voltage magnitudes in p.u. and $\\theta_{i}$, $\\theta_{j}$ are the voltage angles in radians. The branch angle difference is $\\theta_{ij} \\equiv \\theta_{i} - \\theta_{j}$.\n\nIn energy systems modeling of transmission networks, typical operational constraints impose bounds $0.95 \\leq V_{k} \\leq 1.05$ for each bus $k$, and angles satisfying $|\\theta_{ij}| \\leq 0.3$ radians on each branch. Under these constraints, the so-called “small-angle” approximation replaces the exact branch active power flow with a linearized expression that is first-order in $\\theta_{ij}$.\n\nStarting from circuit fundamentals—Kirchhoff’s laws, Ohm’s law for sinusoidal steady state, and the definition of complex power $S = V I^{*}$—derive the exact expression for the active power flow from bus $i$ to bus $j$ over the branch and the corresponding small-angle approximation that linearizes the trigonometric dependence on $\\theta_{ij}$. Then, for the numerically specified operating point\n- $V_{i} = 1.03$ p.u.,\n- $V_{j} = 0.97$ p.u.,\n- $\\theta_{ij} = 0.25$ radians,\n- $X_{ij} = 0.35$ p.u.,\n- system base $S_{\\text{base}} = 100$ MVA,\n\ncompute the absolute error in the branch active power flow (in megawatts) incurred by using the small-angle approximation instead of the exact expression. Express the final error in MW and round your answer to four significant figures. Use radians for angles throughout.",
            "solution": "The problem statement is evaluated to be valid. It is scientifically grounded in the principles of AC circuit theory and power systems analysis, is well-posed with sufficient and consistent data, and is expressed in objective, precise language. All provided numerical values are consistent with the stated operational constraints.\n\nThe solution proceeds in three stages: first, the derivation of the exact expression for active power flow; second, the derivation of the small-angle approximation; and third, the calculation of the absolute error between the two for the specified operating point.\n\n**1. Derivation of the Exact Active Power Flow ($P_{ij}$)**\n\nThe system consists of two buses, $i$ and $j$, connected by a purely reactive, lossless transmission line with series reactance $X_{ij}$. The bus voltages are given by the phasors $\\tilde{V}_i = V_i \\angle \\theta_i = V_i \\exp(j\\theta_i)$ and $\\tilde{V}_j = V_j \\angle \\theta_j = V_j \\exp(j\\theta_j)$. The impedance of the branch is purely imaginary, $Z_{ij} = jX_{ij}$.\n\nAccording to Ohm's law, the current $I_{ij}$ flowing from bus $i$ to bus $j$ is:\n$$I_{ij} = \\frac{\\tilde{V}_i - \\tilde{V}_j}{Z_{ij}} = \\frac{\\tilde{V}_i - \\tilde{V}_j}{jX_{ij}}$$\nThe complex power $S_{ij}$ flowing from bus $i$ into the branch is defined as $S_{ij} = P_{ij} + jQ_{ij} = \\tilde{V}_i I_{ij}^{*}$, where $I_{ij}^{*}$ is the complex conjugate of the current $I_{ij}$.\n\nFirst, we find the complex conjugate of the current:\n$$I_{ij}^{*} = \\left( \\frac{\\tilde{V}_i - \\tilde{V}_j}{jX_{ij}} \\right)^{*} = \\frac{\\tilde{V}_i^{*} - \\tilde{V}_j^{*}}{-jX_{ij}} = \\frac{j(\\tilde{V}_i^{*} - \\tilde{V}_j^{*})}{X_{ij}}$$\nNow, we substitute this into the expression for complex power:\n$$S_{ij} = \\tilde{V}_i \\left( \\frac{j(\\tilde{V}_i^{*} - \\tilde{V}_j^{*})}{X_{ij}} \\right) = \\frac{j}{X_{ij}} (\\tilde{V}_i \\tilde{V}_i^{*} - \\tilde{V}_i \\tilde{V}_j^{*})$$\nWe use the properties of complex numbers: $\\tilde{V}_i \\tilde{V}_i^{*} = |\\tilde{V}_i|^2 = V_i^2$, and $\\tilde{V}_i \\tilde{V}_j^{*} = (V_i \\exp(j\\theta_i))(V_j \\exp(-j\\theta_j)) = V_i V_j \\exp(j(\\theta_i - \\theta_j))$. Using the given definition $\\theta_{ij} \\equiv \\theta_i - \\theta_j$, this becomes $V_i V_j \\exp(j\\theta_{ij})$.\n\nSubstituting these back into the expression for $S_{ij}$:\n$$S_{ij} = \\frac{j}{X_{ij}} (V_i^2 - V_i V_j \\exp(j\\theta_{ij}))$$\nUsing Euler's formula, $\\exp(j\\theta_{ij}) = \\cos(\\theta_{ij}) + j\\sin(\\theta_{ij})$, we expand the expression:\n$$S_{ij} = \\frac{j}{X_{ij}} (V_i^2 - V_i V_j (\\cos(\\theta_{ij}) + j\\sin(\\theta_{ij})))$$\n$$S_{ij} = \\frac{j}{X_{ij}} (V_i^2 - V_i V_j \\cos(\\theta_{ij})) - \\frac{j^2}{X_{ij}} (V_i V_j \\sin(\\theta_{ij}))$$\nSince $j^2 = -1$:\n$$S_{ij} = \\frac{V_i V_j}{X_{ij}} \\sin(\\theta_{ij}) + j \\frac{V_i^2 - V_i V_j \\cos(\\theta_{ij})}{X_{ij}}$$\nThe active power flow $P_{ij}$ is the real part of the complex power $S_{ij}$.\n$$P_{ij}^{\\text{exact}} = \\text{Re}(S_{ij}) = \\frac{V_i V_j}{X_{ij}} \\sin(\\theta_{ij})$$\n\n**2. Derivation of the Small-Angle Approximation ($P_{ij}^{\\text{approx}}$)**\n\nThe small-angle approximation linearizes the expression for power flow by using the first-order Taylor series expansion of the sine function around an angle of $0$ radians. The expansion is:\n$$\\sin(x) = x - \\frac{x^3}{3!} + \\frac{x^5}{5!} - \\dots$$\nFor small angles $x$, we can approximate $\\sin(x) \\approx x$. Applying this to the angle difference $\\theta_{ij}$, we get $\\sin(\\theta_{ij}) \\approx \\theta_{ij}$.\n\nSubstituting this approximation into the exact expression for active power gives the linearized approximation:\n$$P_{ij}^{\\text{approx}} = \\frac{V_i V_j}{X_{ij}} \\theta_{ij}$$\n\n**3. Calculation of the Absolute Error**\n\nThe absolute error in the active power flow is the magnitude of the difference between the exact and approximated values.\n$$\\Delta P_{ij} = |P_{ij}^{\\text{exact}} - P_{ij}^{\\text{approx}}| = \\left| \\frac{V_i V_j}{X_{ij}} \\sin(\\theta_{ij}) - \\frac{V_i V_j}{X_{ij}} \\theta_{ij} \\right|$$\nFactoring out the common term:\n$$\\Delta P_{ij} = \\frac{V_i V_j}{X_{ij}} |\\sin(\\theta_{ij}) - \\theta_{ij}|$$\nFor any non-zero angle $\\theta_{ij}$ (in radians), $|\\sin(\\theta_{ij})|  |\\theta_{ij}|$. For the given value $\\theta_{ij} = 0.25 > 0$, $\\theta_{ij} > \\sin(\\theta_{ij})$, so the expression simplifies to:\n$$\\Delta P_{ij} = \\frac{V_i V_j}{X_{ij}} (\\theta_{ij} - \\sin(\\theta_{ij}))$$\nThis gives the error in the per unit (p.u.) system.\n\nThe problem provides the following numerical values for the operating point:\n- $V_{i} = 1.03$ p.u.\n- $V_{j} = 0.97$ p.u.\n- $\\theta_{ij} = 0.25$ radians\n- $X_{ij} = 0.35$ p.u.\n\nSubstituting these values into the error expression:\n$$\\Delta P_{ij} (\\text{p.u.}) = \\frac{(1.03)(0.97)}{0.35} (0.25 - \\sin(0.25))$$\nFirst, calculate the terms:\n$$V_i V_j = (1.03)(0.97) = 0.9991$$\nThe angle is in radians, so we compute $\\sin(0.25)$:\n$$\\sin(0.25) \\approx 0.24740396$$\nNow, substitute these into the per unit error equation:\n$$\\Delta P_{ij} (\\text{p.u.}) = \\frac{0.9991}{0.35} (0.25 - 0.24740396)$$\n$$\\Delta P_{ij} (\\text{p.u.}) = (2.8545714...) (0.00259604) \\approx 0.00741103 \\text{ p.u.}$$\n\nTo convert this per unit error to megawatts (MW), we multiply by the system base power, $S_{\\text{base}} = 100$ MVA. The base for active power is $P_{\\text{base}} = 100$ MW.\n$$\\text{Error (MW)} = \\Delta P_{ij} (\\text{p.u.}) \\times P_{\\text{base}}$$\n$$\\text{Error (MW)} = 0.00741103 \\times 100 \\text{ MW} = 0.741103 \\text{ MW}$$\n\nThe problem requires the answer to be rounded to four significant figures. The calculated value is $0.741103...$ MW. The first four significant figures are $7$, $4$, $1$, and $1$. The fifth digit is $0$, so we do not round up.\nThe final error is $0.7411$ MW.",
            "answer": "$$\\boxed{0.7411}$$"
        },
        {
            "introduction": "This final practice moves from passive analysis to active system management, integrating the previous concepts into a realistic engineering optimization problem. You are tasked with selecting optimal settings for discrete control devices—a transformer tap changer and a shunt capacitor bank—to maintain system voltages within secure limits while minimizing total energy losses . This exercise mirrors the real-world challenge of using grid assets to enforce operational constraints, requiring you to combine rigorous AC power flow solutions with a discrete optimization framework.",
            "id": "4073479",
            "problem": "You are given a three-bus alternating current (AC) power network to model using nodal admittance analysis with an off-nominal transformer and a discrete shunt susceptance. The network consists of Bus $1$ (slack), Bus $2$ (load), and Bus $3$ (load). Bus $1$ is modeled as an ideal voltage source with fixed voltage magnitude and angle. Buses $2$ and $3$ have specified real and reactive power demands. The objective is to select discrete transformer tap positions and discrete shunt susceptance sizes to keep all bus voltage magnitudes within bounds and all branch angle differences within bounds while minimizing total real power losses.\n\nFundamental laws and core definitions:\n- Kirchhoff’s Current Law (KCL): At each bus, the sum of complex currents leaving equals the sum entering.\n- Ohm’s Law for AC circuits: For a series element between buses $i$ and $k$ with complex series admittance $y_{ik}$, the current is $I_{ik} = y_{ik}(V_i' - V_k)$ where $V_i'$ accounts for any off-nominal tap transformation.\n- Complex power at bus $k$: $S_k = P_k + j Q_k = V_k I_k^\\ast$, where $I_k = \\sum_{j} Y_{kj} V_j$ and $^\\ast$ denotes complex conjugation.\n- Nodal admittance matrix (Y-bus): For each branch admittance and shunt, bus admittances are assembled to satisfy KCL. For an off-nominal transformer between buses $i$ and $k$ with real tap ratio $t$ (no phase shift) and series admittance $y$, the contributions to the nodal admittance matrix are:\n  - $Y_{ii} \\leftarrow Y_{ii} + y/t^2$,\n  - $Y_{ik} \\leftarrow Y_{ik} - y/t$,\n  - $Y_{kk} \\leftarrow Y_{kk} + y$,\n  - $Y_{ki} \\leftarrow Y_{ki} - y/t$.\n- The branch without tap (simple line) between buses $2$ and $3$ with series admittance $y$ contributes:\n  - $Y_{22} \\leftarrow Y_{22} + y$,\n  - $Y_{23} \\leftarrow Y_{23} - y$,\n  - $Y_{33} \\leftarrow Y_{33} + y$,\n  - $Y_{32} \\leftarrow Y_{32} - y$.\n- A shunt susceptance $B$ (capacitive when $B>0$) at bus $k$ contributes $Y_{kk} \\leftarrow Y_{kk} + jB$.\n\nNetwork specification:\n- Base power $S_{\\text{base}} = 100$ megavolt-ampere (MVA).\n- Slack bus $1$: fixed voltage magnitude $|V_1| = 1.0$ per unit (p.u.) and voltage angle $\\angle V_1 = 0$ radians.\n- Transformer between Bus $1$ and Bus $2$: series impedance $z_{12} = 0.01 + j 0.04$ p.u., with off-nominal real tap ratio $t$ chosen from the discrete set $\\{0.95, 1.00, 1.05\\}$.\n- Line between Bus $2$ and Bus $3$: series impedance $z_{23} = 0.015 + j 0.06$ p.u.\n- Discrete shunt susceptance at Bus $3$: $B_3 \\in \\{0.00, 0.05, 0.10\\}$ p.u. (added as $j B_3$ admittance).\n- Voltage magnitude bounds for all buses: $|V_k| \\in [0.95, 1.05]$ p.u.\n- Branch angle difference bounds: for each connected pair $(i,k)$, $|\\angle V_i - \\angle V_k| \\le \\Delta_{\\max}$ with $\\Delta_{\\max} = 0.35$ radians. Angles must be treated in radians.\n\nPower flow formulation:\n- Loads at Bus $2$ and Bus $3$ are specified by $(P_2, Q_2)$ and $(P_3, Q_3)$ in megawatts (MW) and megavolt-amperes reactive (MVAr).\n- Convert loads to per unit using $S_{\\text{base}}$: $P_{\\ell,k}^{\\text{pu}} = P_k / S_{\\text{base}}$, $Q_{\\ell,k}^{\\text{pu}} = Q_k / S_{\\text{base}}$.\n- Treat load as negative complex injection: $S_k^{\\text{spec}} = -P_{\\ell,k}^{\\text{pu}} - j Q_{\\ell,k}^{\\text{pu}}$ for $k \\in \\{2,3\\}$.\n- Solve the AC power flow by enforcing $S_k(V) = V_k \\left(\\sum_j Y_{kj} V_j \\right)^\\ast = S_k^{\\text{spec}}$ at buses $k \\in \\{2,3\\}$. Unknowns are $|V_2|$, $\\angle V_2$, $|V_3|$, $\\angle V_3$; $V_1$ is fixed.\n\nObjective and constraints:\n- For each discrete configuration $(t, B_3)$, solve the power flow. Check constraints:\n  - Voltage magnitudes: $|V_k| \\in [0.95, 1.05]$ for $k \\in \\{1,2,3\\}$.\n  - Angle differences: $|\\angle V_1 - \\angle V_2| \\le 0.35$ and $|\\angle V_2 - \\angle V_3| \\le 0.35$ radians.\n- Compute total real power losses in MW as $P_{\\text{loss}} = \\left(\\Re\\{S_1\\} - (P_{\\ell,2}^{\\text{pu}} + P_{\\ell,3}^{\\text{pu}})\\right) \\times S_{\\text{base}}$, where $S_1 = V_1 \\left(\\sum_j Y_{1j} V_j \\right)^\\ast$ is the complex power injection at the slack bus. The shunt susceptance is purely reactive and does not contribute to real power directly; losses arise from branch resistances.\n- Among all discrete configurations that satisfy constraints, select the one that minimizes $P_{\\text{loss}}$. In case of numerical ties within a tolerance of $10^{-6}$ MW, choose the configuration with the smallest tap index, then the smallest shunt index, where indices are defined by the enumeration order below.\n\nDiscrete decision indices:\n- Tap ratio enumeration: index $0 \\mapsto 0.95$, index $1 \\mapsto 1.00$, index $2 \\mapsto 1.05$.\n- Shunt susceptance enumeration: index $0 \\mapsto 0.00$ p.u., index $1 \\mapsto 0.05$ p.u., index $2 \\mapsto 0.10$ p.u.\n\nTest suite:\nYou must run the optimization for the following three test cases. All angles must be in radians, and final losses must be reported in megawatts (MW).\n- Test case $1$: $(P_2, Q_2, P_3, Q_3) = (60, 25, 50, 20)$ MW/MVAr.\n- Test case $2$: $(P_2, Q_2, P_3, Q_3) = (90, 45, 90, 45)$ MW/MVAr.\n- Test case $3$: $(P_2, Q_2, P_3, Q_3) = (70, 30, 40, 20)$ MW/MVAr.\n\nOutput specification:\n- For each test case, output a list $[i_{\\text{tap}}, i_{\\text{shunt}}, P_{\\text{loss}}]$ where $i_{\\text{tap}}$ is the tap index (an integer), $i_{\\text{shunt}}$ is the shunt index (an integer), and $P_{\\text{loss}}$ is the minimized real power loss in MW (a float).\n- If no feasible configuration exists for a test case (no solution converges or constraints cannot be met), output $[-1, -1, \\mathrm{nan}]$ for that test case.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[[i_tap1,i_shunt1,loss1],[i_tap2,i_shunt2,loss2],[i_tap3,i_shunt3,loss3]]\"). Angles must be treated in radians; losses must be in MW.\n\nImplement the complete solution with the above specifications as a single, runnable program.",
            "solution": "The problem requires finding the optimal discrete settings for a transformer tap ratio and a shunt susceptance in a three-bus power system to minimize total real power losses while adhering to operational constraints on bus voltage magnitudes and branch angle differences. This is a discrete optimization problem, which, given the small number of discrete choices (3 tap positions $\\times$ 3 shunt sizes = 9 total configurations), can be solved by exhaustively evaluating each configuration.\n\nThe solution process for each test case involves the following steps:\n1.  Iterate through each of the $9$ discrete configurations defined by the transformer tap ratio $t$ and the shunt susceptance $B_3$.\n2.  For each configuration, construct the $3 \\times 3$ nodal admittance matrix, $Y_{\\text{bus}}$.\n3.  Solve the nonlinear AC power flow equations using the Newton-Raphson method to find the voltage magnitudes and angles at the load buses (Bus $2$ and Bus $3$).\n4.  Check if the resulting voltages satisfy the given magnitude and angle difference constraints.\n5.  If the solution is feasible, calculate the total real power losses.\n6.  Keep track of the configuration that results in the minimum real power loss, respecting the specified tie-breaking rule.\n7.  If no configuration is feasible, report it as such.\n\nThe following sections detail each step in this process.\n\n### Step 1: Nodal Admittance Matrix ($Y_{\\text{bus}}$) Formation\nThe foundation of the power flow analysis is the nodal admittance matrix, $Y_{\\text{bus}}$, which relates the bus voltage phasors to the current injections according to the equation $I = Y_{\\text{bus}}V$. For the given $3$-bus system, $Y_{\\text{bus}}$ is a $3 \\times 3$ matrix. Its elements are determined by the network's branch and shunt admittances. The base power is $S_{\\text{base}} = 100$ MVA.\n\nThe series impedances are converted to admittances:\n-   Branch $1-2$: $z_{12} = 0.01 + j0.04$ p.u. The admittance is $y_{12} = 1/z_{12} \\approx 5.8824 - j23.5294$ p.u.\n-   Branch $2-3$: $z_{23} = 0.015 + j0.06$ p.u. The admittance is $y_{23} = 1/z_{23} \\approx 4.0 - j16.0$ p.u.\n\nFollowing the rules provided for an off-nominal transformer with tap ratio $t$ on the Bus $1$ side, a standard line, and a shunt susceptance $B_3$ at Bus $3$, the $Y_{\\text{bus}}$ matrix is constructed as:\n$$\nY_{\\text{bus}} =\n\\begin{pmatrix}\nY_{11}  Y_{12}  Y_{13} \\\\\nY_{21}  Y_{22}  Y_{23} \\\\\nY_{31}  Y_{32}  Y_{33}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\ny_{12}/t^2    -y_{12}/t        0 \\\\\n-y_{12}/t    y_{12} + y_{23}  -y_{23} \\\\\n0            -y_{23}          y_{23} + jB_3\n\\end{pmatrix}\n$$\nThis matrix is constructed for each of the $9$ configurations of $(t, B_3)$, where $t \\in \\{0.95, 1.00, 1.05\\}$ and $B_3 \\in \\{0.00, 0.05, 0.10\\}$ p.u.\n\n### Step 2: Newton-Raphson AC Power Flow Solution\nWith $Y_{\\text{bus}}$ defined, we solve the power flow equations. Bus $1$ is the slack bus with a fixed voltage $V_1 = 1.0 + j0.0$ p.u. Buses $2$ and $3$ are PQ (load) buses, where the specified complex power injections $S_k^{\\text{spec}}$ must be met. The loads $(P_k, Q_k)$ are converted to per-unit injections: $S_k^{\\text{spec}} = -(P_k/S_{\\text{base}}) - j(Q_k/S_{\\text{base}})$.\n\nThe power balance equations for a bus $k$ are:\n$P_k(V) = \\Re\\{V_k (\\sum_{j} Y_{kj} V_j)^*\\} = P_k^{\\text{spec}}$\n$Q_k(V) = \\Im\\{V_k (\\sum_{j} Y_{kj} V_j)^*\\} = Q_k^{\\text{spec}}$\n\nIn polar form, with $V_k = |V_k|e^{j\\delta_k}$ and $Y_{kj} = G_{kj} + jB_{kj}$, these are:\n$P_k(|V|, \\delta) = \\sum_{j=1}^3 |V_k||V_j|(G_{kj}\\cos(\\delta_k - \\delta_j) + B_{kj}\\sin(\\delta_k - \\delta_j))$\n$Q_k(|V|, \\delta) = \\sum_{j=1}^3 |V_k||V_j|(G_{kj}\\sin(\\delta_k - \\delta_j) - B_{kj}\\cos(\\delta_k - \\delta_j))$\n\nThe unknown variables are the voltage magnitudes and angles at the PQ buses: $x = [\\delta_2, \\delta_3, |V_2|, |V_3|]^T$. The Newton-Raphson method is an iterative algorithm to find the solution. Starting with an initial guess (e.g., a \"flat start\": $|V_2|=|V_3|=1.0$, $\\delta_2=\\delta_3=0$), we iterate:\n\n$x_{i+1} = x_i - J(x_i)^{-1} \\Delta F(x_i)$\n\nwhere:\n-   $\\Delta F(x_i)$ is the vector of power mismatches at iteration $i$:\n    $\\Delta F = [\\Delta P_2, \\Delta P_3, \\Delta Q_2, \\Delta Q_3]^T$, with $\\Delta P_k = P_k(V) - P_k^{\\text{spec}}$ and $\\Delta Q_k = Q_k(V) - Q_k^{\\text{spec}}$.\n-   $J(x_i)$ is the $4 \\times 4$ Jacobian matrix of partial derivatives of the power balance equations with respect to the state variables, evaluated at $x_i$:\n    $$\n    J = \\begin{pmatrix}\n    \\frac{\\partial P_2}{\\partial \\delta_2}  \\frac{\\partial P_2}{\\partial \\delta_3}  \\frac{\\partial P_2}{\\partial |V_2|}  \\frac{\\partial P_2}{\\partial |V_3|} \\\\\n    \\frac{\\partial P_3}{\\partial \\delta_2}  \\frac{\\partial P_3}{\\partial \\delta_3}  \\frac{\\partial P_3}{\\partial |V_2|}  \\frac{\\partial P_3}{\\partial |V_3|} \\\\\n    \\frac{\\partial Q_2}{\\partial \\delta_2}  \\frac{\\partial Q_2}{\\partial \\delta_3}  \\frac{\\partial Q_2}{\\partial |V_2|}  \\frac{\\partial Q_2}{\\partial |V_3|} \\\\\n    \\frac{\\partial Q_3}{\\partial \\delta_2}  \\frac{\\partial Q_3}{\\partial \\delta_3}  \\frac{\\partial Q_3}{\\partial |V_2|}  \\frac{\\partial Q_3}{\\partial |V_3|}\n    \\end{pmatrix}\n    $$\nThe iteration continues until the maximum absolute value of the mismatch vector elements is below a small tolerance (e.g., $10^{-9}$), or a maximum number of iterations is reached (indicating non-convergence).\n\n### Step 3: Feasibility Check and Loss Calculation\nIf the Newton-Raphson algorithm converges, the resulting voltage profile $(V_2, V_3)$ is checked against the operational constraints:\n1.  **Voltage Magnitude Constraints**: $|V_k| \\in [0.95, 1.05]$ p.u. for $k \\in \\{2, 3\\}$.\n2.  **Angle Difference Constraints**: $|\\angle V_1 - \\angle V_2| \\le 0.35$ and $|\\angle V_2 - \\angle V_3| \\le 0.35$ radians. Since $V_1$ is the reference, $\\angle V_1 = 0$, so these simplify to $|\\delta_2| \\le 0.35$ and $|\\delta_2 - \\delta_3| \\le 0.35$.\n\nA configuration is deemed \"feasible\" only if the power flow converges and all constraints are satisfied. For each feasible configuration, the total real power loss is calculated. The complex power injected by the slack bus is:\n$S_1 = P_1 + jQ_1 = V_1 I_1^* = V_1 \\left(Y_{11}V_1 + Y_{12}V_2 + Y_{13}V_3\\right)^*$\nSince $V_1 = 1.0$ and $Y_{13}=0$, this simplifies to $S_1 = (Y_{11} + Y_{12}V_2)^*$.\n\nThe total real power loss in per-unit is the sum of all real power injections, which equals the real power from the slack bus minus the real power consumed by the loads:\n$P_{\\text{loss,pu}} = P_1 - (P_{\\ell,2}^{\\text{pu}} + P_{\\ell,3}^{\\text{pu}})$\nThe loss in megawatts (MW) is then:\n$P_{\\text{loss}} = P_{\\text{loss,pu}} \\times S_{\\text{base}}$\n\n### Step 4: Optimization Algorithm\nThe optimization procedure systematically evaluates all $9$ configurations for each test case.\n1.  Initialize a variable for the best loss found so far to infinity (`best_loss = float('inf')`) and store the best configuration details, e.g., `best_config = [-1, -1, float('nan')]`.\n2.  Iterate through the discrete tap indices $i_{\\text{tap}} \\in \\{0, 1, 2\\}$ and shunt indices $i_{\\text{shunt}} \\in \\{0, 1, 2\\}$. This order naturally handles the primary tie-breaking rule.\n3.  For each configuration $(i_{\\text{tap}}, i_{\\text{shunt}})$, solve the power flow and check for feasibility as described above.\n4.  If the configuration is feasible, calculate its loss, $P_{\\text{loss}}$.\n5.  Compare this loss with the current best. If $P_{\\text{loss}}  \\text{best\\_loss} - 10^{-6}$, update `best_loss` to $P_{\\text{loss}}$ and record the current indices $(i_{\\text{tap}}, i_{\\text{shunt}})$ and the new loss value. The strict inequality combined with the iteration order correctly implements the tie-breaking rule for losses within the $10^{-6}$ MW tolerance.\n6.  After checking all $9$ configurations, the stored `best_config` holds the result for the given test case. This is repeated for all three test cases.\n\nThis comprehensive approach guarantees finding the discrete configuration that minimizes real power losses while satisfying all system constraints, as required.",
            "answer": "[[2,2,2.3789643],[-1,-1,nan],[1,2,2.2037748]]"
        }
    ]
}