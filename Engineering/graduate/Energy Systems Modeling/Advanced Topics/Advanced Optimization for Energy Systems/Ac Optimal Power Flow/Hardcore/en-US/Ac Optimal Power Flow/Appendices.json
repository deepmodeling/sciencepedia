{
    "hands_on_practices": [
        {
            "introduction": "Before we can optimize a power system, we must first be able to accurately model the flow of electricity through its components. This foundational exercise focuses on the physics of power transmission in a simple two-bus network. By calculating the active power flow and the associated real power losses, you will practice the core computations that form the power balance equations in any AC Optimal Power Flow formulation .",
            "id": "4068460",
            "problem": "Consider a $2$-bus alternating-current network used within an alternating-current optimal power flow context. The branch connecting buses $1$ and $2$ is modeled as a series admittance $y_{12}$ without shunt elements, and bus voltages are represented by steady-state phasors. Let the bus phasors be $V_1 = 1.05 \\angle 0^{\\circ}$ and $V_2 = 1.00 \\angle -5^{\\circ}$, and let the series admittance be $y_{12} = 10 - j 50$ in per-unit. Define $P_{12}$ as the active power injected into the branch at bus $1$ flowing toward bus $2$, and $P_{21}$ as the active power injected into the branch at bus $2$ flowing toward bus $1$. Using Kirchhoff’s laws, the constitutive relation of linear admittance elements, and the definition of complex power in phasor steady state, derive expressions for $P_{12}$ and $P_{21}$ and compute their numerical values, as well as the real-power line loss defined as $P_{\\text{loss}} = P_{12} + P_{21}$. Take angles in degrees as stated; if you perform trigonometric evaluation, you may convert angles to radians. Express all final quantities in per-unit on the system base. Round your final numerical values to four significant figures.",
            "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and objective. It provides all necessary information to compute the required quantities using fundamental principles of alternating-current circuit theory and power systems analysis.\n\nThe problem requires the calculation of active power flows, $P_{12}$ and $P_{21}$, in a $2$-bus system, and the total line loss, $P_{\\text{loss}}$. The given quantities are the bus voltage phasors and the series admittance of the connecting branch.\n\nLet the voltage phasors at bus $1$ and bus $2$ be represented in polar form as $V_1 = |V_1| \\angle \\delta_1$ and $V_2 = |V_2| \\angle \\delta_2$.\nThe series admittance of the branch connecting bus $1$ and bus $2$ is given as $y_{12} = G_{12} + jB_{12}$.\nThe given values are:\n$V_1 = 1.05 \\angle 0^{\\circ}$, so $|V_1| = 1.05$ and $\\delta_1 = 0^{\\circ}$.\n$V_2 = 1.00 \\angle -5^{\\circ}$, so $|V_2| = 1.00$ and $\\delta_2 = -5^{\\circ}$.\n$y_{12} = 10 - j50$ per-unit, so the conductance is $G_{12} = 10$ and the susceptance is $B_{12} = -50$.\n\nThe current flowing from bus $1$ to bus $2$, denoted $I_{12}$, is given by Ohm's law applied to the branch:\n$$I_{12} = (V_1 - V_2) y_{12}$$\nThe complex power $S_{12}$ injected into the branch at bus $1$ is defined as:\n$$S_{12} = V_1 I_{12}^*$$\nwhere $I_{12}^*$ is the complex conjugate of the current $I_{12}$.\nSubstituting the expression for the current:\n$$S_{12} = V_1 ((V_1 - V_2) y_{12})^* = V_1 (V_1^* - V_2^*) y_{12}^*$$\n$$S_{12} = V_1 V_1^* y_{12}^* - V_1 V_2^* y_{12}^* = |V_1|^2 y_{12}^* - V_1 V_2^* y_{12}^*$$\nLet's express the terms using their polar and rectangular components:\n$V_1 = |V_1| e^{j\\delta_1}$\n$V_2 = |V_2| e^{j\\delta_2} \\implies V_2^* = |V_2| e^{-j\\delta_2}$\n$y_{12} = G_{12} + jB_{12} \\implies y_{12}^* = G_{12} - jB_{12}$\nThe product $V_1 V_2^*$ is:\n$$V_1 V_2^* = |V_1| e^{j\\delta_1} |V_2| e^{-j\\delta_2} = |V_1||V_2| e^{j(\\delta_1 - \\delta_2)}$$\n$$V_1 V_2^* = |V_1||V_2| (\\cos(\\delta_1 - \\delta_2) + j\\sin(\\delta_1 - \\delta_2))$$\nSubstituting these into the expression for $S_{12}$:\n$$S_{12} = |V_1|^2 (G_{12} - jB_{12}) - |V_1||V_2| (\\cos(\\delta_1 - \\delta_2) + j\\sin(\\delta_1 - \\delta_2)) (G_{12} - jB_{12})$$\nThe active power $P_{12}$ is the real part of $S_{12}$:\n$$P_{12} = \\text{Re}(S_{12}) = |V_1|^2 G_{12} - \\text{Re}[|V_1||V_2| (\\cos(\\delta_1 - \\delta_2) + j\\sin(\\delta_1 - \\delta_2)) (G_{12} - jB_{12})]$$\nThe real part of the product of two complex numbers $(a+jb)(c+jd)$ is $ac-bd$. Here, $a = \\cos(\\delta_1 - \\delta_2)$, $b = \\sin(\\delta_1 - \\delta_2)$, $c = G_{12}$, and $d = -B_{12}$.\n$$\\text{Re}[...] = |V_1||V_2| (G_{12}\\cos(\\delta_1 - \\delta_2) + B_{12}\\sin(\\delta_1 - \\delta_2))$$\nThus, the expression for $P_{12}$ is:\n$$P_{12} = |V_1|^2 G_{12} - |V_1||V_2| [G_{12}\\cos(\\delta_1 - \\delta_2) + B_{12}\\sin(\\delta_1 - \\delta_2)]$$\nBy symmetry, the active power $P_{21}$ injected into the branch at bus $2$ is obtained by swapping indices $1$ and $2$:\n$$P_{21} = |V_2|^2 G_{12} - |V_2||V_1| [G_{12}\\cos(\\delta_2 - \\delta_1) + B_{12}\\sin(\\delta_2 - \\delta_1)]$$\nUsing the identities $\\cos(-x) = \\cos(x)$ and $\\sin(-x) = -\\sin(x)$, we can rewrite $P_{21}$ in terms of $(\\delta_1 - \\delta_2)$:\n$$P_{21} = |V_2|^2 G_{12} - |V_1||V_2| [G_{12}\\cos(\\delta_1 - \\delta_2) - B_{12}\\sin(\\delta_1 - \\delta_2)]$$\n\nNow we substitute the numerical values. The angle difference is $\\delta_1 - \\delta_2 = 0^{\\circ} - (-5^{\\circ}) = 5^{\\circ}$. We will need $\\cos(5^{\\circ})$ and $\\sin(5^{\\circ})$.\nCalculating $P_{12}$:\n$$P_{12} = (1.05)^2 (10) - (1.05)(1.00) [10 \\cos(5^{\\circ}) + (-50) \\sin(5^{\\circ})]$$\n$$P_{12} = 1.1025 \\times 10 - 1.05 [10 \\cos(5^{\\circ}) - 50 \\sin(5^{\\circ})]$$\nUsing $\\cos(5^{\\circ}) \\approx 0.996195$ and $\\sin(5^{\\circ}) \\approx 0.087156$:\n$$P_{12} \\approx 11.025 - 1.05 [10(0.996195) - 50(0.087156)]$$\n$$P_{12} \\approx 11.025 - 1.05 [9.96195 - 4.3578]$$\n$$P_{12} \\approx 11.025 - 1.05 [5.60415]$$\n$$P_{12} \\approx 11.025 - 5.8843575$$\n$$P_{12} \\approx 5.1406425 \\text{ per-unit}$$\nRounding to four significant figures, $P_{12} = 5.141$ per-unit.\n\nCalculating $P_{21}$:\n$$P_{21} = (1.00)^2 (10) - (1.05)(1.00) [10 \\cos(5^{\\circ}) - (-50) \\sin(5^{\\circ})]$$\n$$P_{21} = 10 - 1.05 [10 \\cos(5^{\\circ}) + 50 \\sin(5^{\\circ})]$$\n$$P_{21} \\approx 10 - 1.05 [10(0.996195) + 50(0.087156)]$$\n$$P_{21} \\approx 10 - 1.05 [9.96195 + 4.3578]$$\n$$P_{21} \\approx 10 - 1.05 [14.31975]$$\n$$P_{21} \\approx 10 - 15.0357375$$\n$$P_{21} \\approx -5.0357375 \\text{ per-unit}$$\nRounding to four significant figures, $P_{21} = -5.036$ per-unit. The negative sign indicates that active power is flowing out of bus $2$ into the line, consistent with the flow from bus $1$ to bus $2$.\n\nFinally, the real-power line loss $P_{\\text{loss}}$ is the sum of the active power injections at both ends of the line:\n$$P_{\\text{loss}} = P_{12} + P_{21}$$\n$$P_{\\text{loss}} \\approx 5.1406425 + (-5.0357375)$$\n$$P_{\\text{loss}} \\approx 0.104905 \\text{ per-unit}$$\nRounding to four significant figures, $P_{\\text{loss}} = 0.1049$ per-unit.\n\nTo verify, the loss can also be calculated as $P_{\\text{loss}} = G_{12} |V_1 - V_2|^2$:\n$V_1 = 1.05 + j0$\n$V_2 = 1.00(\\cos(-5^{\\circ}) + j\\sin(-5^{\\circ})) \\approx 1.00(0.996195 - j0.087156) = 0.996195 - j0.087156$\n$V_1 - V_2 \\approx (1.05 - 0.996195) + j0.087156 = 0.053805 + j0.087156$\n$|V_1 - V_2|^2 \\approx (0.053805)^2 + (0.087156)^2 = 0.0028950 + 0.0075962 = 0.0104912$\n$P_{\\text{loss}} = 10 \\times 0.0104912 = 0.104912$, which confirms the result.\n\nFinal values rounded to four significant figures:\n$P_{12} = 5.141$ p.u.\n$P_{21} = -5.036$ p.u.\n$P_{\\text{loss}} = 0.1049$ p.u.",
            "answer": "$$\\boxed{\\begin{pmatrix} 5.141  -5.036  0.1049 \\end{pmatrix}}$$"
        },
        {
            "introduction": "Power losses are not merely a physical inefficiency; they represent a direct economic cost that system operators strive to minimize. This practice distills the complex AC OPF problem into a core trade-off: adjusting voltage to reduce resistive losses and, consequently, the cost of generation. By applying the Karush-Kuhn-Tucker (KKT) conditions to a simplified model, you will gain intuition for how optimization theory connects physical actions to economic objectives and how operational limits dictate optimal strategies .",
            "id": "4068421",
            "problem": "Consider a radial $3$-bus Alternating Current Optimal Power Flow (AC OPF) network with buses indexed by $1$, $2$, and $3$. Bus $1$ is a slack generator bus with fixed voltage magnitude $|V_{1}|$ and free real power injection $P_{1}$. Buses $2$ and $3$ are load buses with complex power demands $S_{2} = P_{2} + j Q_{2}$ and $S_{3} = P_{3} + j Q_{3}$, where $P_{2}  0$, $P_{3}  0$, and $Q_{2}$, $Q_{3}$ are given. The network topology is radial: line $\\{1,2\\}$ connects bus $1$ to bus $2$ and line $\\{2,3\\}$ connects bus $2$ to bus $3$. The series resistances of the lines are $r_{12}  0$ and $r_{23}  0$, and shunts are negligible. The generator at bus $1$ has a strictly convex cost $C(P_{1}) = a P_{1}^{2} + b P_{1}$ with $a  0$ and $b  0$.\n\nAssume small angle differences and moderate voltage drops so that the magnitude of the line currents can be approximated by the magnitude of downstream complex power divided by the local voltage magnitude. Using the complex power definition $S = V I^{*}$ and Ohm’s law, and neglecting second-order voltage-drop terms, approximate the real power loss on line $\\{1,2\\}$ as\n$$P_{\\text{loss},12} \\approx r_{12} \\frac{\\left(|S_{2}| + |S_{3}|\\right)^{2}}{|V_{2}|^{2}},$$\nand on line $\\{2,3\\}$ as\n$$P_{\\text{loss},23} \\approx r_{23} \\frac{|S_{3}|^{2}}{|V_{2}|^{2}},$$\nwith $|S_{k}| = \\sqrt{P_{k}^{2} + Q_{k}^{2}}$ and the approximation $|V_{3}| \\approx |V_{2}|$ justified by the moderate-drop assumption. Under this approximation, the total real power injection at bus $1$ is\n$$P_{1} \\approx P_{2} + P_{3} + P_{\\text{loss},12} + P_{\\text{loss},23}.$$\n\nThe decision variable for the OPF is the voltage magnitude at bus $2$, denoted $|V_{2}|$, subject to a box constraint $|V_{2}|^{\\min} \\le |V_{2}| \\le |V_{2}|^{\\max}$, where $|V_{2}|^{\\min}  0$ and $|V_{2}|^{\\max}  |V_{2}|^{\\min}$. Formulate the optimization problem to minimize $C(P_{1})$ with respect to $|V_{2}|$ given the above physical relationships.\n\nStarting from fundamental definitions of complex power $S = V I^{*}$, Ohm’s law, and the resistive loss $P_{\\text{loss}} = r |I|^{2}$, derive the Karush–Kuhn–Tucker (KKT) conditions for this one-dimensional AC OPF in $|V_{2}|$. Identify the inequality constraints and their complementarity pairs, and justify which pair could bind at the optimum on physical grounds based on the monotonicity of $C(P_{1}(|V_{2}|))$.\n\nFinally, compute and provide the closed-form analytic expression for the Lagrange multiplier associated with the upper voltage magnitude limit at bus $2$ (the multiplier of the constraint $|V_{2}| \\le |V_{2}|^{\\max}$) at the optimum, expressed in terms of the parameters $a$, $b$, $P_{2}$, $P_{3}$, $Q_{2}$, $Q_{3}$, $r_{12}$, $r_{23}$, and $|V_{2}|^{\\max}$. Your final answer must be a single closed-form expression. No numerical evaluation or rounding is required.",
            "solution": "The problem asks for the formulation of a one-dimensional Alternating Current Optimal Power Flow (AC OPF) problem, the derivation of its Karush-Kuhn-Tucker (KKT) conditions, an analysis of the optimal solution, and the computation of the Lagrange multiplier associated with the upper voltage limit.\n\nFirst, we validate the problem statement. The problem provides a consistent physical model of a radial power network based on standard, albeit simplified, approximations (LinDistFlow-type). It defines a clear objective function, a single decision variable, and well-defined constraints. The cost function $C(P_1) = a P_1^2 + b P_1$ with $a  0$ and $b  0$ is strictly convex and increasing for positive power injection $P_1  0$. The total power injection $P_1$ is a function of the voltage magnitude at bus $2$, denoted as $v_2 = |V_2|$. As will be shown, the resulting optimization problem is convex and thus well-posed. The problem is scientifically grounded, objective, and complete. Therefore, it is valid, and we may proceed with the solution.\n\nLet the decision variable be $v_2 = |V_2|$. The optimization problem is to minimize the cost of generation at bus $1$.\n\nThe objective function is $C(P_1)$, where $P_1$ is the real power injected by the slack generator at bus $1$. According to the given power balance equation, $P_1$ is the sum of the real power demands and the total real power losses in the lines:\n$$P_1(v_2) = P_2 + P_3 + P_{\\text{loss},12}(v_2) + P_{\\text{loss},23}(v_2)$$\nThe line losses are given as functions of $v_2$:\n$$P_{\\text{loss},12}(v_2) = r_{12} \\frac{\\left(|S_{2}| + |S_{3}|\\right)^{2}}{v_2^{2}}$$\n$$P_{\\text{loss},23}(v_2) = r_{23} \\frac{|S_{3}|^{2}}{v_2^{2}}$$\nwhere $|S_k| = \\sqrt{P_k^2 + Q_k^2}$ for $k \\in \\{2, 3\\}$.\n\nCombining these, we express $P_1$ as a function of $v_2$:\n$$P_1(v_2) = P_2 + P_3 + \\frac{1}{v_2^2} \\left[ r_{12} \\left(|S_2| + |S_3|\\right)^2 + r_{23} |S_3|^2 \\right]$$\nFor notational brevity, let us define a constant $K$:\n$$K = r_{12} \\left(\\sqrt{P_2^2 + Q_2^2} + \\sqrt{P_3^2 + Q_3^2}\\right)^2 + r_{23} \\left(P_3^2 + Q_3^2\\right)$$\nSince $r_{12}  0$, $r_{23}  0$, and the loads are nonzero ($P_2  0, P_3  0$), we have $K  0$.\nThe power injection is then $P_1(v_2) = P_2 + P_3 + K v_2^{-2}$.\n\nThe objective function to be minimized is $f(v_2) = C(P_1(v_2))$:\n$$f(v_2) = a \\left(P_2 + P_3 + K v_2^{-2}\\right)^2 + b \\left(P_2 + P_3 + K v_2^{-2}\\right)$$\nThe optimization problem is formulated as:\n$$\\min_{v_2} \\quad f(v_2)$$\n$$\\text{subject to} \\quad |V_2|^{\\min} \\le v_2 \\le |V_2|^{\\max}$$\n\nTo derive the KKT conditions, we first write the constraints in the standard form $g_i(x) \\le 0$:\n$1$. $g_1(v_2) = v_2 - |V_2|^{\\max} \\le 0$\n$2$. $g_2(v_2) = |V_2|^{\\min} - v_2 \\le 0$\n\nThe Lagrangian function $\\mathcal{L}$ is constructed by appending the constraints to the objective function, weighted by their respective Lagrange multipliers, $\\mu_{\\max} \\ge 0$ and $\\mu_{\\min} \\ge 0$:\n$$\\mathcal{L}(v_2, \\mu_{\\max}, \\mu_{\\min}) = f(v_2) + \\mu_{\\max} (v_2 - |V_2|^{\\max}) + \\mu_{\\min} (|V_2|^{\\min} - v_2)$$\nThe KKT conditions for an optimal solution $v_2^*$ are:\n1.  **Stationarity**: $\\frac{\\partial \\mathcal{L}}{\\partial v_2} \\bigg|_{v_2=v_2^*} = \\frac{df}{dv_2}\\bigg|_{v_2=v_2^*} + \\mu_{\\max} - \\mu_{\\min} = 0$.\n2.  **Primal Feasibility**: $|V_2|^{\\min} \\le v_2^* \\le |V_2|^{\\max}$.\n3.  **Dual Feasibility**: $\\mu_{\\max} \\ge 0$, $\\mu_{\\min} \\ge 0$.\n4.  **Complementary Slackness**: $\\mu_{\\max} (v_2^* - |V_2|^{\\max}) = 0$ and $\\mu_{\\min} (|V_2|^{\\min} - v_2^*) = 0$.\n\nNext, we analyze the monotonicity of the objective function $f(v_2)$ to determine which constraints will be active at the optimum. We compute the derivative of $f(v_2)$ with respect to $v_2$ using the chain rule:\n$$\\frac{df}{dv_2} = \\frac{dC}{dP_1} \\frac{dP_1}{dv_2}$$\nThe derivative of the cost function with respect to $P_1$ is:\n$$\\frac{dC}{dP_1} = 2aP_1 + b$$\nSince $a  0$, $b  0$, and $P_1 = P_2 + P_3 + (\\text{losses})  0$, the term $\\frac{dC}{dP_1}$ is strictly positive. This confirms the physical intuition that the cost of generation increases with the amount of power generated.\n\nThe derivative of the power injection $P_1$ with respect to $v_2$ is:\n$$\\frac{dP_1}{dv_2} = \\frac{d}{dv_2} \\left(P_2 + P_3 + K v_2^{-2}\\right) = -2 K v_2^{-3}$$\nSince $K  0$ and $v_2 = |V_2|  |V_2|^{\\min}  0$, the term $\\frac{dP_1}{dv_2}$ is strictly negative. This reflects the physical principle that increasing the voltage level for the same power demand reduces the current and thereby the resistive losses.\n\nCombining these results, the derivative of the objective function is:\n$$\\frac{df}{dv_2} = (2aP_1(v_2) + b) (-2 K v_2^{-3})$$\nSince both $(2aP_1(v_2) + b)$ and $(2 K v_2^{-3})$ are positive, their product is positive, and thus $\\frac{df}{dv_2}$ is strictly negative for all $v_2$ in the feasible domain.\nThis means that the objective function $f(v_2)$ is a strictly monotonically decreasing function of $v_2$. To minimize a strictly decreasing function over an interval, one must choose the largest possible value for the variable. Therefore, the optimal voltage magnitude $v_2^*$ must be at its upper limit:\n$$v_2^* = |V_2|^{\\max}$$\n\nWith $v_2^* = |V_2|^{\\max}$, the complementary slackness conditions provide insight into the Lagrange multipliers.\nThe first condition, $\\mu_{\\max} (v_2^* - |V_2|^{\\max}) = 0$, becomes $\\mu_{\\max} (0) = 0$, which is satisfied for any $\\mu_{\\max}$.\nThe second condition, $\\mu_{\\min} (|V_2|^{\\min} - v_2^*) = 0$, becomes $\\mu_{\\min} (|V_2|^{\\min} - |V_2|^{\\max}) = 0$. Since the problem states $|V_2|^{\\max}  |V_2|^{\\min}$, the term $(|V_2|^{\\min} - |V_2|^{\\max})$ is non-zero. Thus, we must have $\\mu_{\\min} = 0$.\n\nWe can now find the expression for the Lagrange multiplier $\\mu_{\\max}$ from the stationarity condition at the optimum $v_2^* = |V_2|^{\\max}$:\n$$\\frac{df}{dv_2}\\bigg|_{v_2=|V_2|^{\\max}} + \\mu_{\\max} - \\mu_{\\min} = 0$$\nSubstituting $\\mu_{\\min} = 0$:\n$$\\mu_{\\max} = - \\frac{df}{dv_2}\\bigg|_{v_2=|V_2|^{\\max}}$$\nSubstituting the expression for the derivative:\n$$\\mu_{\\max} = - \\left( (2aP_1(|V_2|^{\\max}) + b) (-2 K (|V_2|^{\\max})^{-3}) \\right)$$\n$$\\mu_{\\max} = (2aP_1(|V_2|^{\\max}) + b) (2 K (|V_2|^{\\max})^{-3})$$\nTo obtain the final expression, we substitute the formulas for $P_1(|V_2|^{\\max})$ and $K$:\n$$P_1(|V_2|^{\\max}) = P_2 + P_3 + \\frac{K}{(|V_2|^{\\max})^2} = P_2 + P_3 + \\frac{r_{12} \\left(\\sqrt{P_2^2 + Q_2^2} + \\sqrt{P_3^2 + Q_3^2}\\right)^2 + r_{23} \\left(P_3^2 + Q_3^2\\right)}{(|V_2|^{\\max})^2}$$\nPlugging this into the expression for $\\mu_{\\max}$ gives the final closed-form solution:\n$$\\mu_{\\max} = \\left( 2a \\left[ P_2 + P_3 + \\frac{K}{(|V_2|^{\\max})^2} \\right] + b \\right) \\left( \\frac{2K}{(|V_2|^{\\max})^3} \\right)$$\nExplicitly expanding $K$:\n$$\\mu_{\\max} = \\left( 2a \\left[ P_{2} + P_{3} + \\frac{r_{12} (\\sqrt{P_{2}^{2} + Q_{2}^{2}} + \\sqrt{P_{3}^{2} + Q_{3}^{2}})^{2} + r_{23} (P_{3}^{2} + Q_{3}^{2})}{(|V_{2}|^{\\max})^{2}} \\right] + b \\right) \\times \\left( \\frac{2 \\left[ r_{12} (\\sqrt{P_{2}^{2} + Q_{2}^{2}} + \\sqrt{P_{3}^{2} + Q_{3}^{2}})^{2} + r_{23} (P_{3}^{2} + Q_{3}^{2}) \\right]}{(|V_{2}|^{\\max})^{3}} \\right)$$\nThis expression represents the sensitivity of the optimal cost to a marginal relaxation of the upper voltage constraint, often referred to as the shadow price of the constraint. Since $\\frac{df}{dv_2}  0$, we have $\\mu_{\\max}  0$, consistent with dual feasibility.",
            "answer": "$$\n\\boxed{\n\\left( 2a \\left( P_{2} + P_{3} + \\frac{r_{12} \\left(\\sqrt{P_{2}^{2} + Q_{2}^{2}} + \\sqrt{P_{3}^{2} + Q_{3}^{2}}\\right)^{2} + r_{23} \\left(P_{3}^{2} + Q_{3}^{2}\\right)}{\\left(|V_{2}|^{\\max}\\right)^{2}} \\right) + b \\right) \\left( \\frac{2 \\left( r_{12} \\left(\\sqrt{P_{2}^{2} + Q_{2}^{2}} + \\sqrt{P_{3}^{2} + Q_{3}^{2}}\\right)^{2} + r_{23} \\left(P_{3}^{2} + Q_{3}^{2}\\right) \\right)}{\\left(|V_{2}|^{\\max}\\right)^{3}} \\right)\n}\n$$"
        },
        {
            "introduction": "The full AC Optimal Power Flow problem is notoriously difficult to solve due to its inherent non-convexity. This hands-on programming exercise introduces a powerful modern technique used to overcome this challenge: Second-Order Cone (SOC) relaxation, which approximates the problem with a solvable convex counterpart. You will implement an algorithm to find the maximum power transfer capability of a single branch subject to realistic operational constraints, gaining practical experience with a method central to many state-of-the-art OPF solvers .",
            "id": "4068444",
            "problem": "Consider a single branch of a radial alternating current (AC) feeder connecting bus $i$ to bus $j$ with series impedance $z_{ij} = r_{ij} + j x_{ij}$, where $r_{ij} \\in \\mathbb{R}_{\\ge 0}$ and $x_{ij} \\in \\mathbb{R}$ denote the branch resistance and reactance in per-unit (p.u.). The AC branch-flow model uses the squared voltage magnitudes $v_i$ and $v_j$ (in p.u.$^2$), the active and reactive power flows $P_{ij}$ and $Q_{ij}$ (in p.u.), and the squared current magnitude $l_{ij}$ (in p.u.). The fundamental starting point is Kirchhoff's voltage law, Ohm's law, and the definition of complex power $S = P + jQ = V I^*$, together with the relation $|S|^2 = v_i\\,l_{ij}$ at the sending end. The Second-Order Cone (SOC) relaxation replaces the exact equality $P_{ij}^2 + Q_{ij}^2 = v_i\\,l_{ij}$ with the inequality $P_{ij}^2 + Q_{ij}^2 \\le v_i\\,l_{ij}$.\n\nThe single-branch AC feeder subproblem is to compute the maximal feasible active power $P_{ij}$ (in p.u.) subject to the following constraints:\n- Voltage drop relation along the branch (derived from Kirchhoff's voltage law and Ohm's law) as an affine equality:\n$$\nv_j = v_i - 2\\left(r_{ij}\\,P_{ij} + x_{ij}\\,Q_{ij}\\right) + \\left(r_{ij}^2 + x_{ij}^2\\right) l_{ij}.\n$$\n- SOC relaxation of complex power and current at the sending end:\n$$\nP_{ij}^2 + Q_{ij}^2 \\le v_i\\,l_{ij}.\n$$\n- Squared current magnitude bound (ampacity):\n$$\n0 \\le l_{ij} \\le \\bar{I}_{ij}^2.\n$$\n- Apparent power thermal limit:\n$$\nP_{ij}^2 + Q_{ij}^2 \\le \\bar{S}_{ij}^2.\n$$\n- Squared voltage magnitude bounds at both buses:\n$$\n\\underline{v}_i \\le v_i \\le \\overline{v}_i, \\quad \\underline{v}_j \\le v_j \\le \\overline{v}_j.\n$$\n\nYour task is to write a complete, runnable program that, for each provided test case, returns the maximal feasible $P_{ij}$ under the above constraints using logically sound reasoning grounded in the fundamental relations stated above. Work entirely in per-unit and squared per-unit units, and return the value of $P_{ij}$ in per-unit as a real number. Angles are not used in this formulation, so no angle unit is required.\n\nTest suite:\n- Case $1$: $r_{ij} = 0.02$, $x_{ij} = 0.04$, $\\underline{v}_i = (0.95)^2$, $\\overline{v}_i = (1.05)^2$, $\\underline{v}_j = (0.95)^2$, $\\overline{v}_j = (1.05)^2$, $\\bar{I}_{ij} = 0.8$, $\\bar{S}_{ij} = 1.0$.\n- Case $2$: $r_{ij} = 0.07$, $x_{ij} = 0.15$, $\\underline{v}_i = (0.99)^2$, $\\overline{v}_i = (1.03)^2$, $\\underline{v}_j = (0.97)^2$, $\\overline{v}_j = (1.03)^2$, $\\bar{I}_{ij} = 1.2$, $\\bar{S}_{ij} = 5.0$.\n- Case $3$: $r_{ij} = 0.05$, $x_{ij} = 0.25$, $\\underline{v}_i = (0.95)^2$, $\\overline{v}_i = (1.05)^2$, $\\underline{v}_j = (0.95)^2$, $\\overline{v}_j = (1.05)^2$, $\\bar{I}_{ij} = 0.9$, $\\bar{S}_{ij} = 1.2$.\n- Case $4$: $r_{ij} = 0.03$, $x_{ij} = 0.04$, $\\underline{v}_i = (0.96)^2$, $\\overline{v}_i = (1.04)^2$, $\\underline{v}_j = (0.95)^2$, $\\overline{v}_j = (1.05)^2$, $\\bar{I}_{ij} = 0.2$, $\\bar{S}_{ij} = 10.0$.\n- Case $5$: $r_{ij} = 0.0$, $x_{ij} = 0.0$, $\\underline{v}_i = (1.00)^2$, $\\overline{v}_i = (1.00)^2$, $\\underline{v}_j = (0.99)^2$, $\\overline{v}_j = (1.01)^2$, $\\bar{I}_{ij} = 2.0$, $\\bar{S}_{ij} = 1.0$.\n\nYour program should produce a single line of output containing the results for the above five cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5\\right]$. Each $\\text{result}_k$ must be a floating-point number representing the maximal feasible $P_{ij}$ in per-unit for case $k$.",
            "solution": "The user's request is to determine the maximal feasible active power flow, $P_{ij}$, on a single AC branch, subject to a set of constraints that form a convex feasible region. This is a convex optimization problem, specifically a Second-Order Cone Program (SOCP), which is well-posed and scientifically grounded in established power system modeling principles. The problem is valid and a solution can be formulated.\n\nThe optimization problem is:\n$$\n\\begin{align*}\n\\text{maximize} \\quad  P_{ij} \\\\\n\\text{subject to} \\quad  v_j = v_i - 2(r_{ij}P_{ij} + x_{ij}Q_{ij}) + (r_{ij}^2 + x_{ij}^2)l_{ij} \\\\\n P_{ij}^2 + Q_{ij}^2 \\le v_i l_{ij} \\\\\n P_{ij}^2 + Q_{ij}^2 \\le \\bar{S}_{ij}^2 \\\\\n 0 \\le l_{ij} \\le \\bar{I}_{ij}^2 \\\\\n \\underline{v}_i \\le v_i \\le \\overline{v}_i \\\\\n \\underline{v}_j \\le v_j \\le \\overline{v}_j\n\\end{align*}\n$$\nThe optimization variables are the active power $P_{ij}$, reactive power $Q_{ij}$, squared voltage magnitudes $v_i$ and $v_j$, and squared current magnitude $l_{ij}$.\n\nTo solve this, we can employ a binary search algorithm on the value of $P_{ij}$. The objective is monotonic, and the feasible set is convex, which makes this approach suitable. We search for the maximum $P_{ij}$ in a given range $[P_{low}, P_{high}]$, for which a feasible solution exists. The existence of a feasible solution for a candidate $P_{ij}=P^*$ is determined by a `check` function.\n\nFirst, an absolute upper bound for $P_{ij}$ can be established from the thermal limits. From $P_{ij}^2 + Q_{ij}^2 \\le \\bar{S}_{ij}^2$, we have $P_{ij} \\le \\bar{S}_{ij}$. From $P_{ij}^2 + Q_{ij}^2 \\le v_i l_{ij}$ and the bounds on $v_i$ and $l_{ij}$, we have $P_{ij}^2 \\le \\overline{v}_i \\bar{I}_{ij}^2$, so $P_{ij} \\le \\sqrt{\\overline{v}_i}\\bar{I}_{ij}$. Thus, a safe upper bound for our binary search is $P_{high} = \\min(\\bar{S}_{ij}, \\sqrt{\\overline{v}_i}\\bar{I}_{ij})$. Since $P_{ij}=0$ is always a feasible point (assuming non-contradictory voltage bounds), a safe lower bound is $P_{low}=0$.\n\nThe core of the method is the `check(P^*)` function, which determines if a given active power $P^*$ is feasible. For a fixed $P^*$, we must find if there exist corresponding values for $Q_{ij}$, $v_i$, $v_j$, and $l_{ij}$ that satisfy all constraints. To maximize the feasibility region, we should make the most favorable choices for the free variables. Setting the sending-end voltage to its maximum allowed value, $v_i = \\overline{v}_i$, relaxes the constraints on voltage drop and the SOC relaxation, and is thus the optimal choice for this variable.\n\nWith $P_{ij}=P^*$ and $v_i=\\overline{v}_i$, the feasibility problem reduces to finding a pair $(Q_{ij}, l_{ij})$ that satisfies the remaining constraints:\n1. $Q_{ij}^2 \\le \\bar{S}_{ij}^2 - (P^*)^2$\n2. $l_{ij} \\le \\bar{I}_{ij}^2$\n3. $(P^*)^2 + Q_{ij}^2 \\le \\overline{v}_i l_{ij} \\implies l_{ij} \\ge \\frac{(P^*)^2+Q_{ij}^2}{\\overline{v}_i}$\n4. $\\underline{v}_j \\le \\overline{v}_i - 2(r_{ij}P^* + x_{ij}Q_{ij}) + |z_{ij}|^2 l_{ij} \\le \\overline{v}_j$\n\nFrom constraints 1, 2, and 3, we can establish a search range for $Q_{ij}$. Let $S_{th}^2 = \\min(\\bar{S}_{ij}^2, \\overline{v}_i \\bar{I}_{ij}^2)$. Then $(P^*)^2 + Q_{ij}^2 \\le S_{th}^2$, which implies that $|Q_{ij}| \\le \\sqrt{S_{th}^2 - (P^*)^2}$. If $(P^*)^2  S_{th}^2$, $P^*$ is infeasible.\n\nFor any $Q_{ij}$ in this range, a feasible $l_{ij}$ can exist only in the interval $L(Q_{ij}) = \\left[ \\frac{(P^*)^2+Q_{ij}^2}{\\overline{v}_i}, \\bar{I}_{ij}^2 \\right]$. Let $l_{min}(Q_{ij})$ and $l_{max}$ be the lower and upper bounds of this interval.\n\nThe problem is feasible if there exists at least one $Q_{ij}$ in its allowed range for which the interval of possible $v_j$ values, obtained by substituting $l_{ij} \\in L(Q_{ij})$ into the voltage drop equation, overlaps with the allowed voltage range $[\\underline{v}_j, \\overline{v}_j]$.\nLet $v_j(l_{ij}, Q_{ij}) = \\overline{v}_i - 2(r_{ij}P^* + x_{ij}Q_{ij}) + |z_{ij}|^2 l_{ij}$. Since this function is linear and increasing in $l_{ij}$, we only need to check the values at the endpoints of the interval $L(Q_{ij})$. The range of possible $v_j$ values is $[v_j(l_{min}(Q_{ij})), v_j(l_{max})]$.\nOverlap with $[\\underline{v}_j, \\overline{v}_j]$ requires:\n- $v_j(l_{min}(Q_{ij})) \\le \\overline{v}_j$\n- $v_j(l_{max}) \\ge \\underline{v}_j$\n\nSubstituting the expressions for $l_{min}(Q_{ij})$ and $l_{max}$ yields two inequalities in terms of $Q_{ij}$:\n1. A quadratic inequality: $\\frac{|z_{ij}|^2}{\\overline{v}_i} Q_{ij}^2 - 2x_{ij}Q_{ij} + \\left( \\overline{v}_i - \\overline{v}_j - 2r_{ij}P^* + \\frac{|z_{ij}|^2}{\\overline{v}_i}(P^*)^2 \\right) \\le 0$.\n2. A linear inequality: $\\overline{v}_i - 2(r_{ij}P^* + x_{ij}Q_{ij}) + |z_{ij}|^2\\bar{I}_{ij}^2 \\ge \\underline{v}_j$.\n\nThe `check(P^*)` function returns `True` if the set of $Q_{ij}$ values satisfying both inequalities, as well as the thermal limit $|Q_{ij}| \\le \\sqrt{S_{th}^2 - (P^*)^2}$, is non-empty. This can be determined by solving the inequalities for $Q_{ij}$ and checking for a non-empty intersection of the resulting intervals.\n\nThe binary search proceeds for a fixed number of iterations to achieve sufficient precision, refining the interval $[P_{low}, P_{high}]$ based on the boolean result of `check(mid)`. The final value of $P_{low}$ is the maximal feasible active power.\n\nA special case arises when the impedance $z_{ij}=0$, which implies $r_{ij}=0$ and $x_{ij}=0$. The voltage drop equation simplifies to $v_j=v_i$. The feasible voltage range becomes $[\\max(\\underline{v}_i, \\underline{v}_j), \\min(\\overline{v}_i, \\overline{v}_j)]$. To maximize $P_{ij}$, we choose the highest possible voltage $v_i^{opt} = \\min(\\overline{v}_i, \\overline{v}_j)$. The maximal apparent power squared is then $\\min(\\bar{S}_{ij}^2, v_i^{opt}\\bar{I}_{ij}^2)$, and the maximal $P_{ij}$ is its square root.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # r_ij, x_ij, v_i_min, v_i_max, v_j_min, v_j_max, I_ij_bar, S_ij_bar\n        (0.02, 0.04, 0.95**2, 1.05**2, 0.95**2, 1.05**2, 0.8, 1.0),\n        (0.07, 0.15, 0.99**2, 1.03**2, 0.97**2, 1.03**2, 1.2, 5.0),\n        (0.05, 0.25, 0.95**2, 1.05**2, 0.95**2, 1.05**2, 0.9, 1.2),\n        (0.03, 0.04, 0.96**2, 1.04**2, 0.95**2, 1.05**2, 0.2, 10.0),\n        (0.0, 0.0, 1.00**2, 1.00**2, 0.99**2, 1.01**2, 2.0, 1.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        result = _solve_case(*params)\n        results.append(result)\n\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\ndef _solve_case(r_ij, x_ij, v_i_min, v_i_max, v_j_min, v_j_max, I_ij_bar, S_ij_bar):\n    \"\"\"\n    Calculates the maximal feasible active power P_ij for a single branch.\n    Uses binary search over P_ij and a feasibility check function.\n    \"\"\"\n    z2 = r_ij**2 + x_ij**2\n    l_ij_bar_sq = I_ij_bar**2\n    s_ij_bar_sq = S_ij_bar**2\n\n    # Special case for a lossless (zero impedance) line\n    if z2 == 0:\n        v_eff_min = max(v_i_min, v_j_min)\n        v_eff_max = min(v_i_max, v_j_max)\n        if v_eff_min > v_eff_max:\n            return 0.0\n        \n        v_i_opt = v_eff_max\n        s2_max = min(s_ij_bar_sq, v_i_opt * l_ij_bar_sq)\n        return np.sqrt(s2_max) if s2_max > 0 else 0.0\n\n    def check_feasibility(p):\n        \"\"\"\n        Checks if a given active power p is feasible by finding if there exists\n        a feasible reactive power Q that satisfies all constraints.\n        \"\"\"\n        p2 = p**2\n        s2_thermal_limit = min(s_ij_bar_sq, v_i_max * l_ij_bar_sq)\n        if p2 > s2_thermal_limit:\n            return False\n        \n        q_limit_sq = s2_thermal_limit - p2\n        q_limit = np.sqrt(q_limit_sq) if q_limit_sq > 0 else 0.0\n        q_range = [-q_limit, q_limit]\n\n        # Condition 1: v_j(l_min(Q)) = v_j_max\n        # This is a quadratic inequality in Q: A1*Q^2 + B1*Q + C1 = 0\n        A1 = z2 / v_i_max\n        B1 = -2 * x_ij\n        C1 = v_i_max - v_j_max - 2 * r_ij * p + (z2 / v_i_max) * p2\n        \n        delta1 = B1**2 - 4 * A1 * C1\n        if delta1  0:\n            # Since A1 > 0, the quadratic is always positive, so the inequality is never satisfied.\n            interval1 = [np.inf, -np.inf]  # Empty interval\n        else:\n            sqrt_delta1 = np.sqrt(delta1)\n            q1_root1 = (-B1 - sqrt_delta1) / (2 * A1)\n            q1_root2 = (-B1 + sqrt_delta1) / (2 * A1)\n            interval1 = [q1_root1, q1_root2]\n\n        # Condition 2: v_j(l_max) >= v_j_min\n        # This is a linear inequality in Q.\n        # -2*x_ij*Q >= v_j_min - v_i_max + 2*r_ij*p - z2*l_ij_bar_sq\n        C2 = v_j_min - v_i_max + 2 * r_ij * p - z2 * l_ij_bar_sq\n        if abs(x_ij)  1e-12:\n            interval2 = [-np.inf, np.inf] if 0 >= C2 else [np.inf, -np.inf]\n        elif x_ij > 0:\n            interval2 = [-np.inf, -C2 / (2 * x_ij)]\n        else: # x_ij  0\n            interval2 = [-C2 / (2 * x_ij), np.inf]\n\n        # Check for non-empty intersection of the three Q intervals\n        final_min = max(q_range[0], interval1[0], interval2[0])\n        final_max = min(q_range[1], interval1[1], interval2[1])\n\n        return final_min = final_max\n\n    # Binary search for the maximum p\n    p_upper_bound = np.sqrt(min(s_ij_bar_sq, v_i_max * l_ij_bar_sq))\n    \n    low = 0.0\n    high = p_upper_bound\n    ans = 0.0\n    \n    for _ in range(100):  # 100 iterations for high precision\n        mid = low + (high - low) / 2\n        if check_feasibility(mid):\n            ans = mid\n            low = mid\n        else:\n            high = mid\n            \n    return ans\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}