{
    "hands_on_practices": [
        {
            "introduction": "要掌握凸松弛技术，首先必须深刻理解其试图近似的原始非凸问题。本练习将指导您从第一性原理出发，使用直角坐标系完整地构建交流最优潮流（AC OPF）问题，涵盖所有等式和不等式约束。通过这个过程，您将亲手处理导致问题非凸性的二次项，并进一步学习如何通过“提升”（lifting）变量到更高维度的矩阵空间，并推导出一个关键的二阶锥（SOC）约束，从而在原始问题和其凸松弛之间建立起一座桥梁。",
            "id": "4081226",
            "problem": "考虑一个以标幺值建模的三母线输电网络，其节点导纳矩阵 $Y \\in \\mathbb{C}^{3 \\times 3}$ 由下式给出\n$$\nY \\;=\\; \\begin{pmatrix}\n7 - j\\,22  -4 + j\\,16  -3 + j\\,12 \\\\\n-4 + j\\,16  6.5 - j\\,23  -2.5 + j\\,10 \\\\\n-3 + j\\,12  -2.5 + j\\,10  5.5 - j\\,20\n\\end{pmatrix},\n$$\n其中 $j$ 表示 $\\sqrt{-1}$，$Y$ 的实部和虚部分别用 $G$ 和 $B$ 表示，即 $Y_{ik} = G_{ik} + j B_{ik}$。母线负荷指定为 $(P_{1}^{d}, Q_{1}^{d}) = (1.0, 0.5)$、$(P_{2}^{d}, Q_{2}^{d}) = (0.8, 0.3)$ 和 $(P_{3}^{d}, Q_{3}^{d}) = (1.2, 0.6)$。有两个发电机：一个在母线 $1$，其有功功率二次成本系数为 $(a_{1}, b_{1}, c_{1}) = (10, 6, 0.2)$；另一个在母线 $2$，其成本系数为 $(a_{2}, b_{2}, c_{2}) = (12, 5, 0.1)$。发电机容量限制为 $0 \\leq P_{1}^{g} \\leq 3$、$-1 \\leq Q_{1}^{g} \\leq 1$ 和 $0 \\leq P_{2}^{g} \\leq 2$、$-0.8 \\leq Q_{2}^{g} \\leq 0.8$。电压幅值满足 $0.95 \\leq |V_{i}| \\leq 1.05$，其中 $i \\in \\{1,2,3\\}$。支路串联导纳为 $y_{12} = 4 - j\\,16$、$y_{13} = 3 - j\\,12$ 和 $y_{23} = 2.5 - j\\,10$，对应的视在功率极限为 $S_{12,\\max} = 2.5$、$S_{13,\\max} = 2.0$ 和 $S_{23,\\max} = 2.0$。使用直角坐标表示电压 $V_{i} = v_{i,r} + j\\,v_{i,i}$，并通过 $v_{1,i} = 0$ 和 $v_{1,r} \\geq 0$ 来固定相角参考。\n\n仅从网络基本原理（基尔霍夫定律和欧姆定律）出发，构建完整的直角坐标形式的交流最优潮流（AC OPF）模型，并给出以下各项的显式代数表达式：\n- 每个母线的节点复功率平衡约束，\n- 电压幅值边界，\n- 发电机有功和无功功率边界，\n- 支路视在功率极限，\n- 相角参考。\n\n然后，引入由 $W_{ik} = V_{i} V_{k}^{*}$ 定义的提升电压乘积矩阵 $W \\in \\mathbb{C}^{3 \\times 3}$，其中 $^{*}$ 表示复共轭，并推导对应于母线1和2的 $2 \\times 2$ 主子式的二阶锥（SOC）松弛。最后，定义标量\n$$\n\\Xi \\;=\\; \\left(W_{11} + W_{22}\\right)^{2} \\;-\\; \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2},\n$$\n其中 $W_{12,r} = \\Re(W_{12})$ 且 $W_{12,i} = \\Im(W_{12})$，并将 $\\Xi$ 以最简展开形式报告为关于 $W$ 中元素的解析表达式。将最终答案表示为单个符号表达式。无需数值取整。",
            "solution": "问题陈述已经过严格验证，并被认为是合理的。它在科学上基于电力系统工程的原理，特别是交流最优潮流（AC OPF）问题。所提供的数据是自洽、一致且定义明确的。任务是客观且可形式化的，能够为指定的计算导出一个唯一的、有意义的解。因此，我将给出完整的解答。\n\n该问题需要一个包含三部分的解答：首先，构建直角坐标系下的交流最优潮流问题；其次，推导特定子问题的二阶锥（SOC）松弛；第三，计算标量 $\\Xi$。\n\n### 第一部分：交流最优潮流问题公式化\n交流最优潮流问题旨在最小化总发电成本，同时满足一系列物理和运行约束。决策变量是复数母线电压的实部和虚部 $V_i = v_{i,r} + j v_{i,i}$（$i \\in \\{1,2,3\\}$）以及发电机的有功和无功功率输出 $(P_1^g, Q_1^g)$ 和 $(P_2^g, Q_2^g)$。\n\n**目标函数：**\n目标是最小化总的有功发电二次成本：\n$$ \\min_{P_1^g, P_2^g} C(P_1^g, P_2^g) = (a_1(P_1^g)^2 + b_1 P_1^g + c_1) + (a_2(P_2^g)^2 + b_2 P_2^g + c_2) $$\n\n**约束条件：**\n\n1.  **节点功率平衡约束：** 对于每个母线 $i \\in \\{1,2,3\\}$，净注入复功率 $S_i^{\\text{inj}} = P_i^{\\text{inj}} + j Q_i^{\\text{inj}}$ 必须与流入输电网络的功率相平衡。净注入功率是发电功率减去负荷功率，即 $P_i^{\\text{inj}} = P_i^g - P_i^d$ 和 $Q_i^{\\text{inj}} = Q_i^g - Q_i^d$。注意，对于母线3，有 $P_3^g = Q_3^g = 0$。从母线 $i$ 流入网络的功率为 $S_i = V_i I_i^* = V_i (\\sum_{k=1}^3 Y_{ik} V_k)^*$。将其用 $V_i = v_{i,r} + j v_{i,i}$ 和 $Y_{ik} = G_{ik} + j B_{ik}$ 展开为实部和虚部，得到：\n    $$ P_i^g - P_i^d = \\sum_{k=1}^3 \\left[ G_{ik}(v_{i,r}v_{k,r} + v_{i,i}v_{k,i}) + B_{ik}(v_{i,i}v_{k,r} - v_{i,r}v_{k,i}) \\right], \\quad \\forall i \\in \\{1,2,3\\} $$\n    $$ Q_i^g - Q_i^d = \\sum_{k=1}^3 \\left[ G_{ik}(v_{i,i}v_{k,r} - v_{i,r}v_{k,i}) - B_{ik}(v_{i,r}v_{k,r} + v_{i,i}v_{k,i}) \\right], \\quad \\forall i \\in \\{1,2,3\\} $$\n\n2.  **电压幅值边界：** 每个母线的电压幅值必须保持在指定范围内，$V_i^{\\min} \\leq |V_i| \\leq V_i^{\\max}$。在直角坐标系中，这是一对二次约束：\n    $$ (V_i^{\\min})^2 \\leq v_{i,r}^2 + v_{i,i}^2 \\leq (V_i^{\\max})^2, \\quad \\forall i \\in \\{1,2,3\\} $$\n    使用给定值，$(0.95)^2 \\leq v_{i,r}^2 + v_{i,i}^2 \\leq (1.05)^2$。\n\n3.  **发电机容量限制：** 每个发电机的有功和无功功率输出是有界的：\n    $$ 0 \\leq P_1^g \\leq 3, \\quad -1 \\leq Q_1^g \\leq 1 $$\n    $$ 0 \\leq P_2^g \\leq 2, \\quad -0.8 \\leq Q_2^g \\leq 0.8 $$\n\n4.  **支路视在功率极限：** 每条支路上的视在功率流 $S_{ik}$ 的幅值不得超过其极限 $S_{ik, \\max}$。对于母线 $i$ 和 $k$ 之间串联导纳为 $y_{ik}$ 的支路，离开母线 $i$ 的复功率为 $S_{ik} = V_i I_{ik}^*$，其中 $I_{ik} = y_{ik}(V_i - V_k)$。因此，$S_{ik} = y_{ik}^*(|V_i|^2 - V_i V_k^*)$。约束为 $|S_{ik}|^2 \\leq (S_{ik, \\max})^2$，展开为：\n    $$ |y_{ik}|^2 \\left[ \\left( (v_{i,r}^2+v_{i,i}^2) - (v_{i,r}v_{k,r}+v_{i,i}v_{k,i}) \\right)^2 + \\left( v_{i,r}v_{k,i} - v_{i,i}v_{k,r} \\right)^2 \\right] \\leq (S_{ik,\\max})^2 $$\n    该不等式对支路 $(1,2)$、$(1,3)$ 和 $(2,3)$ 成立。\n\n5.  **相角参考：** 为了消除电压相角的自由度，指定一个母线作为参考。对于母线1，相角设为零，这在直角坐标系中通过以下方式强制实现：\n    $$ v_{1,i} = 0, \\quad v_{1,r} \\geq 0 $$\n\n### 第二部分：SOC松弛\n由于二次方的潮流和支路极限方程，交流最优潮流问题是非凸的。找到一个好解的常用方法是使用凸松弛。我们引入提升电压乘积矩阵 $W$，其元素为 $W_{ik} = V_i V_k^*$。根据定义，该矩阵是厄米特矩阵、半正定矩阵，且秩为一（$W = vv^*$，其中 $v=[V_1, V_2, V_3]^T$）。非凸性被封装在秩一约束中。\n\n交流最优潮流的半定规划（SDP）松弛涉及去掉秩约束，仅要求 $W \\succeq 0$。$W \\succeq 0$ 的一个必要条件是其所有的主子式都是半正定的。SOC松弛是SDP的一种更弱（更松弛）但计算成本更低的替代方法，它通常只强制 $W$ 的 $2 \\times 2$ 主子式的半正定性。\n\n考虑 $W$ 中对应于母线1和2的 $2 \\times 2$ 主子式：\n$$ W_{1,2} = \\begin{pmatrix} W_{11}  W_{12} \\\\ W_{21}  W_{22} \\end{pmatrix} $$\n为使该子矩阵为半正定，其对角线元素必须非负（$W_{11} \\geq 0, W_{22} \\geq 0$，这是成立的，因为 $W_{ii}=|V_i|^2$），且其行列式必须非负。\n$$ \\det(W_{1,2}) = W_{11}W_{22} - W_{12}W_{21} \\geq 0 $$\n由于 $W$ 是厄米特矩阵，有 $W_{21} = W_{12}^*$，因此条件为 $W_{11}W_{22} - |W_{12}|^2 \\geq 0$。设 $W_{12} = W_{12,r} + j W_{12,i}$，我们有：\n$$ W_{11}W_{22} \\geq W_{12,r}^2 + W_{12,i}^2 $$\n这个不等式可以表示为一个标准的二阶锥约束。通过代数变换：\n$$ 4W_{11}W_{22} \\geq 4W_{12,r}^2 + 4W_{12,i}^2 $$\n$$ (W_{11}+W_{22})^2 - (W_{11}-W_{22})^2 \\geq (2W_{12,r})^2 + (2W_{12,i})^2 $$\n$$ (W_{11}+W_{22})^2 \\geq (2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11}-W_{22})^2 $$\n因为 $W_{11}+W_{22} \\ge 0$，我们可以对两边取平方根：\n$$ \\sqrt{(2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11}-W_{22})^2} \\leq W_{11}+W_{22} $$\n这是一个标准形式为 $\\|\\mathbf{x}\\|_2 \\leq t$ 的SOC约束，写作：\n$$ \\left\\| \\begin{pmatrix} 2W_{12,r} \\\\ 2W_{12,i} \\\\ W_{11}-W_{22} \\end{pmatrix} \\right\\|_2 \\leq W_{11}+W_{22} $$\n这个约束就是 $2 \\times 2$ 子矩阵的SOC松弛。\n\n### 第三部分：$\\Xi$ 的计算\n最后的任务是计算标量 $\\Xi$，其定义为：\n$$ \\Xi \\;=\\; \\left(W_{11} + W_{22}\\right)^{2} \\;-\\; \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2} $$\n我们展开平方范数项：\n$$ \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2} = (2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11} - W_{22})^2 $$\n$$ = 4W_{12,r}^2 + 4W_{12,i}^2 + (W_{11}^2 - 2W_{11}W_{22} + W_{22}^2) $$\n我们同样展开 $\\Xi$ 定义中的第一项：\n$$ (W_{11} + W_{22})^2 = W_{11}^2 + 2W_{11}W_{22} + W_{22}^2 $$\n将两个展开式代入 $\\Xi$ 的定义中：\n$$ \\Xi = (W_{11}^2 + 2W_{11}W_{22} + W_{22}^2) - (4W_{12,r}^2 + 4W_{12,i}^2 + W_{11}^2 - 2W_{11}W_{22} + W_{22}^2) $$\n我们去掉括号并合并同类项：\n$$ \\Xi = W_{11}^2 + 2W_{11}W_{22} + W_{22}^2 - 4W_{12,r}^2 - 4W_{12,i}^2 - W_{11}^2 + 2W_{11}W_{22} - W_{22}^2 $$\n$W_{11}^2$ 和 $W_{22}^2$ 项相互抵消。$W_{11}W_{22}$ 项相加。\n$$ \\Xi = 4W_{11}W_{22} - 4W_{12,r}^2 - 4W_{12,i}^2 $$\n这就是 $\\Xi$ 关于 $W$ 中指定元素的最简展开解析表达式。值得注意的是，SOC松弛的条件 $\\left\\| \\ldots \\right\\|_2 \\leq W_{11}+W_{22}$ 等价于 $\\Xi \\geq 0$。此外，$\\Xi$ 等于 $W$ 的 $2 \\times 2$ 主子式行列式的4倍。",
            "answer": "$$\n\\boxed{4W_{11}W_{22} - 4W_{12,r}^{2} - 4W_{12,i}^{2}}\n$$"
        },
        {
            "introduction": "在构建了非凸模型之后，下一步是分析一个完整的松弛形式。本练习聚焦于一个简单的双母线系统，旨在深入探索半定规划（SDP）松弛的关键特性。您需要为这个系统构建一个满足所有松弛约束的解，并判断该解是否“精确”，即对应的电压乘积矩阵是否为秩一。这个过程将帮助您具体理解SDP松弛在何种条件下能够找到原问题的可行解，并揭示松弛“精确性”（exactness）这一核心概念。",
            "id": "4081204",
            "problem": "考虑一个在标幺值系统下的双母线交流最优潮流 (AC-OPF) 问题的半定规划 (SDP) 松弛模型。母线由一条串联支路连接，其电阻 $R = 0.05$，电抗 $X = 0.25$。系统中没有并联支路。串联导纳为 $$y = \\frac{R - \\mathrm{j} X}{R^{2} + X^{2}} = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13},$$ 因此，母线导纳矩阵为\n$$\nY = \\begin{pmatrix}\ny  -y \\\\\n-y  y\n\\end{pmatrix}\n= \n\\begin{pmatrix}\n\\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}  -\\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13} \\\\\n-\\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13}  \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}\n\\end{pmatrix}.\n$$\n令 $v \\in \\mathbb{C}^{2}$ 为复数母线电压向量，并令 $W = v v^{\\mathrm{H}} \\in \\mathbb{C}^{2 \\times 2}$ 为 SDP 松弛中使用的提升埃尔米特矩阵。矩阵 $W$ 的对角线元素等于电压幅值的平方，即 $W_{kk} = |V_{k}|^{2}$。\n\n运行规范如下：\n- 两条母线的电压幅值边界：$0.95 \\leq |V_{k}| \\leq 1.05$。\n- 两条母线均无并联元件和负荷：对于 $k \\in \\{1,2\\}$，$P_{k}^{d} = 0$ 且 $Q_{k}^{d} = 0$。\n- 母线1上有一台发电机，其出力边界为 $0 \\leq P_{1}^{g} \\leq 2$ 和 $-1 \\leq Q_{1}^{g} \\leq 1$。母线2上没有发电机，因此 $P_{2}^{g} = 0$ 且 $Q_{2}^{g} = 0$。\n- 母线1的线性发电成本为：$c_{1} P_{1}^{g}$，其中 $c_{1}  0$（其数值对于确定可行性而言并非必要）。\n\nSDP松弛约束包括：\n- $W \\succeq 0$ 且 $W$ 为埃尔米特矩阵。\n- 电压幅值边界表示为 $0.95^{2} \\leq W_{kk} \\leq 1.05^{2}$，对于 $k \\in \\{1,2\\}$。\n- 使用提升变量的节点功率平衡方程：对于每个 $k \\in \\{1,2\\}$，\n$$\nP_{k}^{g} - P_{k}^{d} = \\Re\\!\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right), \n\\quad\nQ_{k}^{g} - Q_{k}^{d} = \\Im\\!\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right).\n$$\n\n从基本定义 $I = Y v$ 和 $S_{k} = V_{k} I_{k}^{*}$ 出发，构造一个满足所有上述约束的显式矩阵 $W \\succeq 0$。然后判断所构造的矩阵 $W$ 的秩是否为1。将 $W$ 的秩作为最终答案报告（一个无单位的整数）。无需四舍五入；请提供精确的整数。",
            "solution": "用户希望我解决一个关于交流最优潮流 (AC-OPF) 问题的半定规划 (SDP) 松弛相关的问题。\n\n### 步骤1：提取已知条件\n-   系统：双母线网络。\n-   松弛方法：半定规划 (SDP)。\n-   支路参数：串联电阻 $R = 0.05$ p.u.，串联电抗 $X = 0.25$ p.u.。无并联支路。\n-   串联导纳：$y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$ p.u.\n-   母线导纳矩阵：$Y = \\begin{pmatrix} y  -y \\\\ -y  y \\end{pmatrix}$。\n-   提升变量：$W = v v^{\\mathrm{H}} \\in \\mathbb{C}^{2 \\times 2}$，其中 $v$ 是母线电压向量。$W$ 是埃尔米特矩阵且 $W \\succeq 0$。\n-   对角线元素：$W_{kk} = |V_{k}|^{2}$。\n-   电压边界：$0.95 \\leq |V_{k}| \\leq 1.05$，对于 $k \\in \\{1,2\\}$。这转化为 $0.95^2 \\leq W_{kk} \\leq 1.05^2$。\n-   负荷：$P_{k}^{d} = 0$ 且 $Q_{k}^{d} = 0$，对于 $k \\in \\{1,2\\}$。\n-   母线1的发电：$0 \\leq P_{1}^{g} \\leq 2$ 且 $-1 \\leq Q_{1}^{g} \\leq 1$。\n-   母线2的发电：$P_{2}^{g} = 0$ 且 $Q_{2}^{g} = 0$。\n-   成本函数：最小化 $c_{1} P_{1}^{g}$，其中 $c_{1}  0$。\n-   功率平衡方程（松弛后）：对于 $k \\in \\{1,2\\}$，\n    -   $P_{k}^{g} - P_{k}^{d} = \\Re\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right) = P_k^{\\text{inj}}$\n    -   $Q_{k}^{g} - Q_{k}^{d} = \\Im\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right) = Q_k^{\\text{inj}}$\n-   任务：构造一个可行的矩阵 $W \\succeq 0$ 并确定其秩。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题定义明确，科学上基于成熟的电力系统优化凸松弛理论，并包含了所有必要信息。所提供的电阻、电抗以及由此计算出的导纳值是一致的。SDP松弛的潮流方程的表示是标准的。成本函数 $c_1 P_1^g$ 的存在表明这是一个优化问题 (AC-OPF)，而不仅仅是一个可行性问题。因此，构造一个“解”意味着找到一个*最优*的可行点，而非任意一个。\n\n### 步骤3：结论与行动\n该问题有效。我将继续求解所述的 SDP 松弛 OPF 问题，并确定所得矩阵 W 的秩。\n\n### 解题过程\n问题在于找到一个矩阵 W，它满足所有给定约束并最小化目标函数。令矩阵 $W$ 表示为\n$$\nW = \\begin{pmatrix} W_{11}  W_{12} \\\\ W_{21}  W_{22} \\end{pmatrix}\n$$\n其中 $W$ 是埃尔米特矩阵，即 $W_{11}, W_{22} \\in \\mathbb{R}$ 且 $W_{21} = W_{12}^{*}$。\n\n首先，我们分析母线2的功率平衡约束。在母线2，没有发电也没有负荷，所以 $P_2^g = 0$, $P_2^d = 0$, $Q_2^g = 0$, $Q_2^d = 0$。母线2的复功率注入为零：\n$$\nS_2^{\\text{inj}} = P_2^{\\text{inj}} + \\mathrm{j} Q_2^{\\text{inj}} = (P_2^g - P_2^d) + \\mathrm{j}(Q_2^g - Q_2^d) = 0\n$$\n功率平衡方程将此与矩阵 $W$ 相关联：\n$$\nS_2^{\\text{inj}} = \\sum_{m=1}^{2} Y_{2m}^{*} W_{2m} = Y_{21}^{*} W_{21} + Y_{22}^{*} W_{22} = 0\n$$\n从母线导纳矩阵可知，$Y_{21} = -y$ 且 $Y_{22} = y$。取它们的复共轭得到 $Y_{21}^* = -y^*$ 和 $Y_{22}^* = y^*$。将这些代入方程：\n$$\n(-y^*) W_{21} + (y^*) W_{22} = 0\n$$\n$$\ny^* (W_{22} - W_{21}) = 0\n$$\n题目给出 $y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$，这是一个非零值。因此，其共轭 $y^*$ 也非零。这意味着另一个因子必须为零：\n$$\nW_{22} - W_{21} = 0 \\implies W_{21} = W_{22}\n$$\n由于 $W$ 是埃尔米特矩阵，我们有 $W_{12} = W_{21}^*$。对角元素 $W_{22}$ 定义为 $|V_2|^2$，是一个实数。因此，$W_{21}$ 必须是一个实数，且 $W_{12} = W_{21}$。综合这些发现，我们得到：\n$$\nW_{12} = W_{21} = W_{22}\n$$\n因此，矩阵 $W$ 必须具有以下形式：\n$$\nW = \\begin{pmatrix} W_{11}  W_{22} \\\\ W_{22}  W_{22} \\end{pmatrix}\n$$\n为了使 $W$ 为半正定矩阵 ($W \\succeq 0$)，其行列式必须非负（同时对角线元素也需非负，这一点已由电压边界保证）。\n$$\n\\det(W) = W_{11}W_{22} - W_{22}^2 = W_{22}(W_{11} - W_{22}) \\ge 0\n$$\n电压边界为 $0.95 \\le |V_k| \\le 1.05$，这意味着 $W_{kk} = |V_k|^2 \\ge 0.95^2 = 0.9025$。由于 $W_{22}  0$，我们可以在不等式两边同除以 $W_{22}$ 而不改变其方向：\n$$\nW_{11} - W_{22} \\ge 0 \\implies W_{11} \\ge W_{22}\n$$\n现在，我们考虑母线1的功率注入。\n$$\nS_1^{\\text{inj}} = P_1^g + \\mathrm{j}Q_1^g = \\sum_{m=1}^{2} Y_{1m}^* W_{1m} = Y_{11}^* W_{11} + Y_{12}^* W_{12}\n$$\n我们有 $Y_{11} = y$ 和 $Y_{12} = -y$，所以 $Y_{11}^* = y^*$ 和 $Y_{12}^* = -y^*$。我们还知道 $W_{12} = W_{22}$。\n$$\nS_1^{\\text{inj}} = y^* W_{11} + (-y^*) W_{22} = y^*(W_{11} - W_{22})\n$$\n目标是最小化发电成本 $c_1 P_1^g$，其中 $c_1  0$。这等价于最小化有功发电量 $P_1^g = \\Re(S_1^{\\text{inj}})$。\n$$\nP_1^g = \\Re\\left(y^*(W_{11} - W_{22})\\right)\n$$\n由于 $W_{11}$ 和 $W_{22}$ 是实数，$W_{11}-W_{22}$ 也是实数。所以，\n$$\nP_1^g = \\Re(y^*) (W_{11} - W_{22})\n$$\n我们有 $y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$，所以 $y^* = \\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13}$。因此，$\\Re(y^*) = \\frac{10}{13}$。\n$$\nP_1^g = \\frac{10}{13}(W_{11} - W_{22})\n$$\n由于 $\\frac{10}{13}  0$ 并且我们已经确定可行解必须满足 $W_{11} \\ge W_{22}$，因此当 $W_{11} - W_{22}$ 取最小值时，$P_1^g$ 达到其最小值。$W_{11} - W_{22}$ 的最小可行值为0。这在 $W_{11} = W_{22}$ 时发生。\n\n我们来检查这是否是一个有效的解。如果 $W_{11} = W_{22}$，那么：\n-   $P_1^g = \\frac{10}{13}(0) = 0$。这满足发电边界 $0 \\le 0 \\le 2$。\n-   无功发电量为 $Q_1^g = \\Im(S_1^{\\text{inj}}) = \\Im(y^*) (W_{11} - W_{22}) = \\frac{50}{13}(0) = 0$。这满足边界 $-1 \\le 0 \\le 1$。\n-   我们需要选择一个值 $w = W_{11} = W_{22}$ 来满足电压边界：$0.95^2 \\le w \\le 1.05^2$，即 $0.9025 \\le w \\le 1.1025$。\n-   我们可以通过在此范围内选择任意 $w$ 来构造一个显式的最优矩阵。一个简单的选择是 $w=1$。\n\n当 $w=1$ 时，我们有 $W_{11}=1$ 和 $W_{22}=1$。构造的最优矩阵 $W$ 为：\n$$\nW = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}\n$$\n该矩阵满足所有约束条件：\n-   它是埃尔米特矩阵。\n-   它是半正定矩阵：$W_{11} = 1 \\ge 0$，且 $\\det(W) = 1 \\times 1 - 1 \\times 1 = 0 \\ge 0$。\n-   电压边界得到满足：$0.9025 \\le W_{11} = 1 \\le 1.1025$ 且 $0.9025 \\le W_{22} = 1 \\le 1.1025$。\n-   如上所示，功率平衡和发电限制也得到满足。\n\n最后一步是确定所构造的矩阵 $W$ 的秩。矩阵的秩是其线性无关的列（或行）的数量。\n$W$ 的列向量是 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ 和 $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。这两个向量完全相同，因此是线性相关的。\n由于该矩阵不是零矩阵，其秩不为0。\n因此，矩阵 $W$ 的秩为1。",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "理论的生命力在于实践。本练习要求您编写一个程序，为一个辐射状配电网络求解基于支路潮流模型的二阶锥规划（SOCP）松弛问题。通过实现经典的“后推-前推”（backward-forward sweep）迭代算法，您将获得解决电力系统凸优化问题的实践经验，并深刻理解物理模型、松弛技术与计算算法之间的相互作用。这项实践将理论知识转化为可运行的代码，是掌握凸优化的关键一步。",
            "id": "4081242",
            "problem": "要求您实现一个完整、可运行的程序，该程序将二阶锥规划 (SOCP) 支路潮流松弛应用于一个 $3$ 节点辐射状馈线，并计算支路潮流变量的最优解。其背景是使用支路潮流（也称为 DistFlow）模型对辐射状配电网进行交流 (AC) 最优潮流计算。该网络由节点 $1 \\rightarrow 2 \\rightarrow 3$ 组成，其中节点 $1$ 为平衡节点。需要计算的变量是有功和无功潮流 $p_{12}, q_{12}, p_{23}, q_{23}$，电流幅值平方 $\\ell_{12}, \\ell_{23}$，以及节点 $2$ 和 $3$ 处的电压幅值平方 $v_{2}, v_{3}$。\n\n从基本物理定律和经过验证的公式开始：\n- 基尔霍夫电流定律 (KCL) 和基尔霍夫电压定律 (KVL)。\n- 电力系统中的相量形式欧姆定律。\n- 无并联元件的辐射状馈线的支路潮流 (DistFlow) 方程。\n- 由复功率、电压幅值和电流幅值之间的关系产生的 SOCP 支路潮流松弛。\n\n对于每条线路 $i \\rightarrow j$，模型规定如下：\n- 线路沿线及下游节点的功率平衡：\n  - $p_{23} = p_{3} + r_{23} \\ell_{23}$,\n  - $q_{23} = q_{3} + x_{23} \\ell_{23}$,\n  - $p_{12} = p_{2} + p_{23} + r_{12} \\ell_{12}$,\n  - $q_{12} = q_{2} + q_{23} + x_{12} \\ell_{12}$.\n- 电压降方程：\n  - $v_{2} = v_{1} - 2 \\left(r_{12} p_{12} + x_{12} q_{12} \\right) + \\left(r_{12}^{2} + x_{12}^{2}\\right) \\ell_{12}$,\n  - $v_{3} = v_{2} - 2 \\left(r_{23} p_{23} + x_{23} q_{23} \\right) + \\left(r_{23}^{2} + x_{23}^{2}\\right) \\ell_{23}$.\n- SOCP 松弛（发送端公式）：\n  - $\\ell_{12} v_{1} \\ge p_{12}^{2} + q_{12}^{2}$,\n  - $\\ell_{23} v_{2} \\ge p_{23}^{2} + q_{23}^{2}$.\n\n所有量均以标幺值 (p.u.) 表示。电压幅值由其平方值 $v_{i}$ 表示，电流幅值平方为 $\\ell_{ij}$。平衡节点的电压幅值平方固定为 $v_{1}$。目标是最小化总有功功率损耗，模型为 $\\min \\sum_{(i,j)} r_{ij} \\ell_{ij}$，并满足上述约束和箱式约束：\n- 节点 2 和 3 的电压边界：$v_{\\min}^{2} \\le v_{i} \\le v_{\\max}^{2}$，\n- 线路电流边界：$\\ell_{ij} \\le I_{\\max,ij}^{2}$。\n\n在线路电阻为正 ($r_{ij}  0$) 的情况下，该凸规划的最优解在 SOCP 约束中达到等式，即在电流上界未激活的任何地方都有 $\\ell_{ij} v_{i} = p_{ij}^{2} + q_{ij}^{2}$。您的程序应利用这一特性，通过将 SOCP 约束中的等式与线性功率平衡和电压降方程一起迭代强制执行，直至收敛，从而计算出最优解。\n\n此公式中不使用相角量；因此，不需要相角单位。所有输出必须以标幺值表示，并以浮点数形式呈现。\n\n实现一个算法，该算法：\n- 使用上述模型，并在最优状态下强制执行 SOCP 等式 $\\ell_{ij} v_{i} = p_{ij}^{2} + q_{ij}^{2}$，除非会违反电流上界。\n- 对两条线路迭代更新 $(p_{ij}, q_{ij}, v_{i}, \\ell_{ij})$，直到变化量小于一个很小的容差。\n- 检查电流上界，并在必要时将 $\\ell_{ij}$ 限制在 $I_{\\max,ij}^{2}$。对于下面的测试套件，参数的选择使得电流边界不被激活。\n\n测试套件（三种情况），所有值均以标幺值表示：\n- 情况 A（中等负载）：\n  - 平衡节点电压平方 $v_{1} = 1.0$。\n  - 线路 $1 \\rightarrow 2$：$r_{12} = 0.005$, $x_{12} = 0.010$。\n  - 线路 $2 \\rightarrow 3$：$r_{23} = 0.006$, $x_{23} = 0.012$。\n  - 负荷：$p_{2} = 0.50$, $q_{2} = 0.15$, $p_{3} = 0.35$, $q_{3} = 0.10$。\n  - 电压边界：$v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$（对应于 $0.95$ 和 $1.05$ 标幺值的电压幅值）。\n  - 电流限制：$I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$（即每条线路上的 $I_{\\max} = 2.0$ 标幺值）。\n- 情况 B（较重负载但可行）：\n  - 平衡节点电压平方 $v_{1} = 1.0$。\n  - 线路 $1 \\rightarrow 2$：$r_{12} = 0.005$, $x_{12} = 0.010$。\n  - 线路 $2 \\rightarrow 3$：$r_{23} = 0.006$, $x_{23} = 0.012$。\n  - 负荷：$p_{2} = 0.60$, $q_{2} = 0.20$, $p_{3} = 0.45$, $q_{3} = 0.15$。\n  - 电压边界：$v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$。\n  - 电流限制：$I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$。\n- 情况 C（下游节点轻载的边缘情况）：\n  - 平衡节点电压平方 $v_{1} = 1.0$。\n  - 线路 $1 \\rightarrow 2$：$r_{12} = 0.005$, $x_{12} = 0.010$。\n  - 线路 $2 \\rightarrow 3$：$r_{23} = 0.006$, $x_{23} = 0.012$。\n  - 负荷：$p_{2} = 0.40$, $q_{2} = 0.00, p_{3} = 0.00, q_{3} = 0.00$。\n  - 电压边界：$v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$。\n  - 电流限制：$I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$。\n\n计算细节：\n- 使用 SOCP 等式更新 $\\ell_{12} = \\dfrac{p_{12}^{2} + q_{12}^{2}}{v_{1}}$ 和 $\\ell_{23} = \\dfrac{p_{23}^{2} + q_{23}^{2}}{v_{2}}$ 进行迭代。\n- 使用一个严格介于 $0$ 和 $1$ 之间的松弛参数来稳定迭代。\n- 当 $\\ell_{12}$ 和 $\\ell_{23}$ 的最大变化量低于 $10^{-10}$ 或在 $10000$ 次迭代之后停止，以先到者为准。\n- 如果计算出的 $v_{2}$ 或 $v_{3}$ 超出 $[v_{\\min}^{2}, v_{\\max}^{2}]$ 范围，不要修改算法；测试套件设计为可行的。报告计算出的值。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含用方括号括起来的逗号分隔列表形式的结果。每个测试用例的结果本身必须是按顺序排列的列表 $[p_{12},p_{23},q_{12},q_{23},\\ell_{12},\\ell_{23},v_{2},v_{3}]$。\n- 所有值必须打印为四舍五入到六位小数的浮点数。\n- 例如：$[[a_{1},a_{2},\\dots,a_{8}],[b_{1},\\dots,b_{8}],[c_{1},\\dots,c_{8}]]$。\n\n您的任务是实现该算法，以返回上述测试套件在 SOCP 支路潮流松弛下的最优解。",
            "solution": "用户希望使用二阶锥规划 (SOCP) 松弛来解决一个 3 节点辐射状配电网的交流最优潮流 (AC OPF) 问题。该解决方案不是通过通用的 SOCP 求解器找到的，而是通过一个利用问题结构的专用迭代算法找到的。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n\n- **网络拓扑：**一个 3 节点辐射状馈线 $1 \\rightarrow 2 \\rightarrow 3$，其中节点 1 是平衡节点。\n- **变量：**有功潮流 ($p_{12}, p_{23}$)、无功潮流 ($q_{12}, q_{23}$)、电流幅值平方 ($\\ell_{12}, \\ell_{23}$) 和电压幅值平方 ($v_2, v_3$)。所有量均为标幺值 (p.u.)。\n- **常量：**\n  - 平衡节点电压幅值平方：$v_1$。\n  - 线路阻抗：$r_{12}, x_{12}, r_{23}, x_{23}$。\n  - 节点功率消耗（负荷）：$p_2, q_2, p_3, q_3$。\n- **模型方程（支路潮流模型）：**\n  - 功率平衡：\n    - $p_{23} = p_{3} + r_{23} \\ell_{23}$\n    - $q_{23} = q_{3} + x_{23} \\ell_{23}$\n    - $p_{12} = p_{2} + p_{23} + r_{12} \\ell_{12}$\n    - $q_{12} = q_{2} + q_{23} + x_{12} \\ell_{12}$\n  - 电压降：\n    - $v_2 = v_1 - 2(r_{12} p_{12} + x_{12} q_{12}) + (r_{12}^2 + x_{12}^2) \\ell_{12}$\n    - $v_3 = v_2 - 2(r_{23} p_{23} + x_{23} q_{23}) + (r_{23}^2 + x_{23}^2) \\ell_{23}$\n- **SOCP 松弛约束：**\n  - $\\ell_{12} v_{1} \\ge p_{12}^{2} + q_{12}^{2}$\n  - $\\ell_{23} v_{2} \\ge p_{23}^{2} + q_{23}^{2}$\n- **目标函数：**最小化总有功功率损耗，$\\min \\sum_{(i,j)} r_{ij} \\ell_{ij}$。\n- **箱式约束：**\n  - 电压：$v_{\\min}^{2} \\le v_i \\le v_{\\max}^{2}$ 对于 $i \\in \\{2, 3\\}$。\n  - 电流：$\\ell_{ij} \\le I_{\\max,ij}^{2}$。\n- **算法规范：**\n  - 一种利用最优性条件 $\\ell_{ij} v_i = p_{ij}^2 + q_{ij}^2$ 的迭代方法。\n  - 迭代更新 $(p_{ij}, q_{ij}, v_i, \\ell_{ij})$。\n  - 使用一个松弛参数 $\\alpha \\in (0,1)$。\n  - 收敛容差：$\\ell_{12}, \\ell_{23}$ 的最大变化量低于 $10^{-10}$。\n  - 最大迭代次数：$10000$。\n  - 应检查电流限制，但对于给定的测试用例，预计不会被激活。\n  - 电压限制仅供参考；即使计算值超出范围，算法也应报告。\n- **测试套件：**三个不同的情况（A, B, C），所有参数均有指定的数值。\n\n**1.2. 使用提取的已知条件进行验证**\n\n- **科学依据：**该问题基于电力配电系统公认的支路潮流 (DistFlow) 模型，该模型是基本电路定律（KCL、KVL、欧姆定律）的直接应用。AC OPF 问题的 SOCP 松弛是电力系统优化中一种经过严格研究的标准技术。最小化功率损耗的目标具有物理意义和经济重要性。该问题在科学上是合理的。\n- **适定性：**该问题描述了一个具有严格凸目标函数（因为 $r_{ij}  0$）的凸优化问题（一个 SOCP）。此类问题有唯一的最优解。模型和测试用例的所有必要参数都已提供。指定的迭代算法是一种不动点迭代法，这是求解由最优性条件产生的方程组的有效方法。该问题是适定的。\n- **客观性：**问题陈述以精确、定量和技术性的语言编写。它没有歧义、主观性或意见。\n- **完整性和一致性：**模型方程、约束、目标和所有必需的数值数据都已完全指定。所提供的信息中没有矛盾之处。\n- **真实性：**阻抗、负荷和电压/电流限制的标幺值代表了典型的配电网。\n\n**1.3. 结论与行动**\n\n问题有效。这是计算电力系统工程中一个定义明确、有科学依据的练习。将提供一个解决方案。\n\n### 步骤 2：解决方案\n\n问题的核心是求解一个非线性方程组，该方程组代表了 SOCP 松弛的最优潮流问题的 Karush-Kuhn-Tucker (KKT) 最优性条件。问题中指定的迭代算法是一种不动点迭代法，具体来说是一种带有松弛参数的逐次代换法，旨在找到该方程组的解。\n\n**基于原理的算法设计**\n\n该算法被构造为一系列更新，模拟了辐射状网络中信息的物理流动。它包括一个用于从网络末端向源头计算潮流的“后向扫描”，一个用于从源头向外计算电压的“前向扫描”，以及一个用于更新电流幅值平方的步骤，该步骤将两次扫描耦合起来。\n\n1.  **模型推导与结构：**\n    所提供的方程构成了辐射状馈线的完整模型。\n    - **功率平衡（后向传播）：** 对于任何节点 $j$，从其父节点 $i$ 流入的功率 $S_{ij} = p_{ij} + \\mathrm{i} q_{ij}$ 必须供应本地负荷 $S_j^{\\text{load}} = p_j + \\mathrm{i} q_j$、流向其子节点的功率 ($S_{jk}$) 以及线路段 $ij$ 上的损耗。给定的方程是对这一原理在简单线路拓扑下的重新整理。例如，对于线路段 $1 \\rightarrow 2$：\n    $$p_{12} = p_2 + p_{23} + r_{12} \\ell_{12}$$\n    这里，$p_2$ 是节点 2 的负荷，$p_{23}$ 是流向节点 3 的功率，$r_{12} \\ell_{12}$ 是线路 $1 \\rightarrow 2$ 上的有功功率损耗。这种结构非常适合从没有出线的最后一个节点（3）开始的后向扫描。\n\n    - **电压降（前向传播）：** 下游节点 $j$ 的电压是上游节点 $i$ 的电压减去线路上的电压降。给定的方程是电压幅值平方的精确表达式：\n    $$v_j = v_i - 2(r_{ij} p_{ij} + x_{ij} q_{ij}) + (r_{ij}^2 + x_{ij}^2) \\ell_{ij}$$\n    这自然适用于从电压 $v_1$ 已知且固定的平衡节点（1）开始的前向扫描。\n\n    - **SOCP 等式（耦合关系）：** 非凸的潮流约束 $p_{ij}^2 + q_{ij}^2 = v_i \\ell_{ij}$ 被松弛为 $p_{ij}^2 + q_{ij}^2 \\le v_i \\ell_{ij}$。一个关键的见解是，对于一个惩罚损耗的目标函数（即最小化 $\\sum r_{ij}\\ell_{ij}$ 且 $r_{ij}  0$），优化将驱使 $\\ell_{ij}$ 达到其可能的最小值。满足该约束的 $\\ell_{ij}$ 的最小值是在等式成立时取到。因此，在最优解处（假设没有其他约束被激活），我们有：\n    $$\\ell_{ij} = \\frac{p_{ij}^2 + q_{ij}^2}{v_i}$$\n    该方程被用作迭代更新电流平方变量 $\\ell_{ij}$ 的基础。\n\n2.  **迭代求解方案：**\n    我们可以通过从电流平方的初始猜测值 $\\ell_{12}^{(k)}$ 和 $\\ell_{23}^{(k)}$（其中 $k$ 是迭代索引）开始，然后循环遍历这些方程，来构建一个迭代算法。\n\n    - **初始化：** 令 $k=0$。设置初始猜测值 $\\ell_{12}^{(0)} = 0$ 和 $\\ell_{23}^{(0)} = 0$。这对应于一个“无潮流”的初始状态。\n\n    - **迭代 $k+1$：**\n        1.  **后向扫描（潮流）：** 使用前一次迭代的值 $\\ell_{12}^{(k)}$ 和 $\\ell_{23}^{(k)}$，计算当前迭代的潮流。我们从馈线的末端开始：\n            $$p_{23}^{(k+1)} = p_3 + r_{23} \\ell_{23}^{(k)}$$\n            $$q_{23}^{(k+1)} = q_3 + x_{23} \\ell_{23}^{(k)}$$\n            然后移动到上一个线路段：\n            $$p_{12}^{(k+1)} = p_2 + p_{23}^{(k+1)} + r_{12} \\ell_{12}^{(k)}$$\n            $$q_{12}^{(k+1)} = q_2 + q_{23}^{(k+1)} + x_{12} \\ell_{12}^{(k)}$$\n\n        2.  **前向扫描（电压）：** 使用新计算的潮流，计算当前迭代的电压。我们从已知的平衡节点电压 $v_1$ 开始：\n            $$v_2^{(k+1)} = v_1 - 2(r_{12} p_{12}^{(k+1)} + x_{12} q_{12}^{(k+1)}) + (r_{12}^2 + x_{12}^2) \\ell_{12}^{(k)}$$\n            $$v_3^{(k+1)} = v_2^{(k+1)} - 2(r_{23} p_{23}^{(k+1)} + x_{23} q_{23}^{(k+1)}) + (r_{23}^2 + x_{23}^2) \\ell_{23}^{(k)}$$\n\n        3.  **更新电流平方 ($\\ell$)：** 使用最优性条件以及最新的电压和潮流值，计算电流平方的新的试探值。\n            $$\\ell_{12}^{\\text{trial}} = \\frac{(p_{12}^{(k+1)})^2 + (q_{12}^{(k+1)})^2}{v_1}$$\n            $$\\ell_{23}^{\\text{trial}} = \\frac{(p_{23}^{(k+1)})^2 + (q_{23}^{(k+1)})^2}{v_2^{(k+1)}}$$\n            问题要求检查电流限制，所以我们将试探值限制在上限内：\n            $$\\ell_{ij}^{\\text{new}} = \\min(\\ell_{ij}^{\\text{trial}}, I_{\\max,ij}^2)$$\n\n        4.  **松弛：** 为了提高收敛稳定性，通过使用松弛参数 $\\alpha \\in (0, 1)$ 对旧值和新试探值进行加权平均，形成 $\\ell_{ij}$ 的新值。\n            $$\\ell_{12}^{(k+1)} = (1-\\alpha)\\ell_{12}^{(k)} + \\alpha \\ell_{12}^{\\text{new}}$$\n            $$\\ell_{23}^{(k+1)} = (1-\\alpha)\\ell_{23}^{(k)} + \\alpha \\ell_{23}^{\\text{new}}$$\n\n    - **收敛性检查：** 重复此过程，直到迭代变量的变化可以忽略不计，即 $\\max(|\\ell_{12}^{(k+1)} - \\ell_{12}^{(k)}|, |\\ell_{23}^{(k+1)} - \\ell_{23}^{(k)}|)  10^{-10}$，或达到最大迭代次数。\n\n    - **最终结果：** 一旦循环终止，收敛的值 $\\ell_{12}$ 和 $\\ell_{23}$ 将被用于最终的后向和前向扫描，以计算最终的一致变量集 $(p_{12}, p_{23}, q_{12}, q_{23}, \\ell_{12}, \\ell_{23}, v_{2}, v_{3})$。这确保了所有报告的值都满足具有收敛电流的模型方程。\n\n该算法将为提供的三个测试用例分别实现。",
            "answer": "```python\nimport math\n\ndef run_solver_for_case(params):\n    \"\"\"\n    Solves the SOCP-relaxed branch flow problem for a single case using an iterative method.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the test case.\n\n    Returns:\n        list: A list of the 8 solution variables in the order\n              [p12, p23, q12, q23, l12, l23, v2, v3].\n    \"\"\"\n    # Algorithm constants\n    TOL = 1e-10\n    MAX_ITER = 10000\n    ALPHA = 0.5  # Relaxation parameter, strictly between 0 and 1\n\n    # Extract parameters from the dictionary for clarity\n    v1 = params['v1']\n    r12, x12 = params['r12'], params['x12']\n    r23, x23 = params['r23'], params['x23']\n    p2_load, q2_load = params['p2'], params['q2']\n    p3_load, q3_load = params['p3'], params['q3']\n    Imax12_sq = params['Imax12_sq']\n    Imax23_sq = params['Imax23_sq']\n\n    # Pre-calculate squared line impedances\n    z12_sq = r12**2 + x12**2\n    z23_sq = r23**2 + x23**2\n\n    # Initialize the iteration variables (squared current magnitudes)\n    l12 = 0.0\n    l23 = 0.0\n\n    for _ in range(MAX_ITER):\n        l12_old, l23_old = l12, l23\n\n        # --- Backward Sweep: Compute power flows from leaf to root ---\n        # Power flow on line 2->3\n        p23 = p3_load + r23 * l23\n        q23 = q3_load + x23 * l23\n        \n        # Power flow on line 1->2\n        p12 = p2_load + p23 + r12 * l12\n        q12 = q2_load + q23 + x12 * l12\n\n        # --- Forward Sweep: Compute voltages from root to leaf ---\n        # Voltage at bus 2\n        v2 = v1 - 2 * (r12 * p12 + x12 * q12) + z12_sq * l12\n        \n        # Voltage at bus 3\n        v3 = v2 - 2 * (r23 * p23 + x23 * q23) + z23_sq * l23\n\n        # --- Update Step: Compute new squared currents ---\n        # The iterative scheme can diverge if v2 becomes non-positive.\n        # The test cases are feasible, so we assume v2 > 0.\n        if v2 = 0:\n            # In a robust solver, this would require error handling.\n            # Here we can break as this indicates divergence.\n            break\n            \n        # New trial values for l12 and l23 based on SOCP equality\n        l12_new_trial = (p12**2 + q12**2) / v1\n        l23_new_trial = (p23**2 + q23**2) / v2\n\n        # Enforce current limits (as per problem, these will not bind)\n        l12_new = min(l12_new_trial, Imax12_sq)\n        l23_new = min(l23_new_trial, Imax23_sq)\n\n        # Apply relaxation for stability\n        l12 = (1 - ALPHA) * l12_old + ALPHA * l12_new\n        l23 = (1 - ALPHA) * l23_old + ALPHA * l23_new\n\n        # --- Convergence Check ---\n        error = max(abs(l12 - l12_old), abs(l23 - l23_old))\n        if error  TOL:\n            break\n\n    # After convergence, perform one final calculation for fully consistent results\n    p23 = p3_load + r23 * l23\n    q23 = q3_load + x23 * l23\n    p12 = p2_load + p23 + r12 * l12\n    q12 = q2_load + q23 + x12 * l12\n    v2 = v1 - 2 * (r12 * p12 + x12 * q12) + z12_sq * l12\n    v3 = v2 - 2 * (r23 * p23 + x23 * q23) + z23_sq * l23\n\n    return [p12, p23, q12, q23, l12, l23, v2, v3]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n    test_cases = [\n        # Case A: moderate load\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.50, 'q2': 0.15, 'p3': 0.35, 'q3': 0.10,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        },\n        # Case B: heavier load\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.60, 'q2': 0.20, 'p3': 0.45, 'q3': 0.15,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        },\n        # Case C: edge with downstream bus lightly loaded\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.40, 'q2': 0.00, 'p3': 0.00, 'q3': 0.00,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        }\n    ]\n    \n    results = []\n    for case_params in test_cases:\n        result = run_solver_for_case(case_params)\n        results.append(result)\n\n    # Format the final output string exactly as specified\n    case_strings = []\n    for res in results:\n        res_str = f'[{\",\".join(f\"{v:.6f}\" for v in res)}]'\n        case_strings.append(res_str)\n    \n    final_output = f'[{\",\".join(case_strings)}]'\n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}