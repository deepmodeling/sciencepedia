{
    "hands_on_practices": [
        {
            "introduction": "This exercise provides a foundational experience by guiding you from the basic physics of a power network to the full mathematical statement of the non-convex AC Optimal Power Flow (AC OPF) problem. By constructing the objective function and all constraints from first principles, you will gain a deep appreciation for the sources of non-convexity. The second part of the problem introduces the \"lifting\" technique by defining the voltage product matrix $W$ and asks you to derive a second-order cone constraint, which is a cornerstone of many powerful convex relaxations. This practice is essential for understanding how the intractable AC OPF problem is transformed into a solvable convex counterpart. ",
            "id": "4081226",
            "problem": "Consider a three-bus transmission network modeled in per-unit with the nodal bus admittance matrix $Y \\in \\mathbb{C}^{3 \\times 3}$ given by\n$$\nY \\;=\\; \\begin{pmatrix}\n7 - j\\,22  -4 + j\\,16  -3 + j\\,12 \\\\\n-4 + j\\,16  6.5 - j\\,23  -2.5 + j\\,10 \\\\\n-3 + j\\,12  -2.5 + j\\,10  5.5 - j\\,20\n\\end{pmatrix},\n$$\nwhere $j$ denotes $\\sqrt{-1}$, and the real and imaginary parts of $Y$ are denoted by $G$ and $B$, respectively, with $Y_{ik} = G_{ik} + j B_{ik}$. Bus loads are specified as $(P_{1}^{d}, Q_{1}^{d}) = (1.0, 0.5)$, $(P_{2}^{d}, Q_{2}^{d}) = (0.8, 0.3)$, and $(P_{3}^{d}, Q_{3}^{d}) = (1.2, 0.6)$. There are two generators: one at bus $1$ with quadratic active power cost coefficients $(a_{1}, b_{1}, c_{1}) = (10, 6, 0.2)$ and one at bus $2$ with $(a_{2}, b_{2}, c_{2}) = (12, 5, 0.1)$. Generator capability limits are $0 \\leq P_{1}^{g} \\leq 3$, $-1 \\leq Q_{1}^{g} \\leq 1$, and $0 \\leq P_{2}^{g} \\leq 2$, $-0.8 \\leq Q_{2}^{g} \\leq 0.8$. Voltage magnitudes satisfy $0.95 \\leq |V_{i}| \\leq 1.05$ for $i \\in \\{1,2,3\\}$. Branch series admittances are $y_{12} = 4 - j\\,16$, $y_{13} = 3 - j\\,12$, and $y_{23} = 2.5 - j\\,10$, with corresponding apparent power limits $S_{12,\\max} = 2.5$, $S_{13,\\max} = 2.0$, and $S_{23,\\max} = 2.0$. Use a rectangular voltage coordinate representation $V_{i} = v_{i,r} + j\\,v_{i,i}$, and fix the angular reference by $v_{1,i} = 0$ and $v_{1,r} \\geq 0$.\n\nStarting only from network fundamentals (Kirchhoff’s laws and Ohm’s law), construct the complete Alternating Current Optimal Power Flow (AC OPF) in rectangular form with explicit algebraic expressions for:\n- the nodal complex power balance constraints at each bus,\n- the voltage-magnitude bounds,\n- the generator active and reactive power bounds,\n- the branch apparent power limits,\n- the angle reference.\n\nThen, introduce the lifted voltage product matrix $W \\in \\mathbb{C}^{3 \\times 3}$ defined by $W_{ik} = V_{i} V_{k}^{*}$, where $^{*}$ denotes complex conjugation, and derive a Second-Order Cone (SOC) relaxation of the $2 \\times 2$ principal minor corresponding to buses $1$ and $2$. Finally, define the scalar\n$$\n\\Xi \\;=\\; \\left(W_{11} + W_{22}\\right)^{2} \\;-\\; \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2},\n$$\nwhere $W_{12,r} = \\Re(W_{12})$ and $W_{12,i} = \\Im(W_{12})$, and report $\\Xi$ in simplest expanded form as an analytic expression in the entries of $W$. Express your final answer as a single symbolic expression. No numerical rounding is required.",
            "solution": "The problem statement has been critically validated and is deemed sound. It is scientifically grounded in the principles of power systems engineering, specifically the Alternating Current Optimal Power Flow (AC OPF) problem. The provided data is self-contained, consistent, and well-defined. The tasks are objective and formalizable, leading to a unique, meaningful solution for the specified calculations. Therefore, I will proceed with a complete solution.\n\nThe problem requires a three-part solution: first, the construction of the AC OPF problem in rectangular coordinates; second, the derivation of a Second-Order Cone (SOC) relaxation for a specific subproblem; and third, the calculation of a scalar quantity $\\Xi$.\n\n### Part 1: AC OPF Problem Formulation\nThe AC OPF problem seeks to minimize the total cost of generation subject to a set of physical and operational constraints. The decision variables are the real and imaginary parts of the complex bus voltages, $V_i = v_{i,r} + j v_{i,i}$ for $i \\in \\{1,2,3\\}$, and the real and reactive power outputs of the generators, $(P_1^g, Q_1^g)$ and $(P_2^g, Q_2^g)$.\n\n**Objective Function:**\nThe objective is to minimize the total quadratic cost of active power generation:\n$$ \\min_{P_1^g, P_2^g} C(P_1^g, P_2^g) = (a_1(P_1^g)^2 + b_1 P_1^g + c_1) + (a_2(P_2^g)^2 + b_2 P_2^g + c_2) $$\n\n**Constraints:**\n\n1.  **Nodal Power Balance Constraints:** For each bus $i \\in \\{1,2,3\\}$, the net injected complex power $S_i^{\\text{inj}} = P_i^{\\text{inj}} + j Q_i^{\\text{inj}}$ must balance the power flowing into the transmission network. The net injected power is the generation minus the load, $P_i^{\\text{inj}} = P_i^g - P_i^d$ and $Q_i^{\\text{inj}} = Q_i^g - Q_i^d$. Note that for bus $3$, $P_3^g = Q_3^g = 0$. The power flowing into the network from bus $i$ is $S_i = V_i I_i^* = V_i (\\sum_{k=1}^3 Y_{ik} V_k)^*$. Expanding this into real and imaginary parts with $V_i = v_{i,r} + j v_{i,i}$ and $Y_{ik} = G_{ik} + j B_{ik}$ yields:\n    $$ P_i^g - P_i^d = \\sum_{k=1}^3 \\left[ G_{ik}(v_{i,r}v_{k,r} + v_{i,i}v_{k,i}) + B_{ik}(v_{i,i}v_{k,r} - v_{i,r}v_{k,i}) \\right], \\quad \\forall i \\in \\{1,2,3\\} $$\n    $$ Q_i^g - Q_i^d = \\sum_{k=1}^3 \\left[ G_{ik}(v_{i,i}v_{k,r} - v_{i,r}v_{k,i}) - B_{ik}(v_{i,r}v_{k,r} + v_{i,i}v_{k,i}) \\right], \\quad \\forall i \\in \\{1,2,3\\} $$\n\n2.  **Voltage Magnitude Bounds:** The voltage magnitude at each bus must remain within specified limits, $V_i^{\\min} \\leq |V_i| \\leq V_i^{\\max}$. In rectangular coordinates, this is a pair of quadratic constraints:\n    $$ (V_i^{\\min})^2 \\leq v_{i,r}^2 + v_{i,i}^2 \\leq (V_i^{\\max})^2, \\quad \\forall i \\in \\{1,2,3\\} $$\n    Using the given values, $(0.95)^2 \\leq v_{i,r}^2 + v_{i,i}^2 \\leq (1.05)^2$.\n\n3.  **Generator Capability Limits:** The active and reactive power outputs of each generator are bounded:\n    $$ 0 \\leq P_1^g \\leq 3, \\quad -1 \\leq Q_1^g \\leq 1 $$\n    $$ 0 \\leq P_2^g \\leq 2, \\quad -0.8 \\leq Q_2^g \\leq 0.8 $$\n\n4.  **Branch Apparent Power Limits:** The magnitude of the apparent power flow $S_{ik}$ on each branch must not exceed its limit $S_{ik, \\max}$. For a branch between buses $i$ and $k$ with series admittance $y_{ik}$, the complex power leaving bus $i$ is $S_{ik} = V_i I_{ik}^*$, where $I_{ik} = y_{ik}(V_i - V_k)$. Thus, $S_{ik} = y_{ik}^*(|V_i|^2 - V_i V_k^*)$. The constraint is $|S_{ik}|^2 \\leq (S_{ik, \\max})^2$, which expands to:\n    $$ |y_{ik}|^2 \\left[ \\left( (v_{i,r}^2+v_{i,i}^2) - (v_{i,r}v_{k,r}+v_{i,i}v_{k,i}) \\right)^2 + \\left( v_{i,r}v_{k,i} - v_{i,i}v_{k,r} \\right)^2 \\right] \\leq (S_{ik,\\max})^2 $$\n    This inequality holds for the branches $(1,2)$, $(1,3)$, and $(2,3)$.\n\n5.  **Angle Reference:** To remove the degree of freedom in the voltage phase angles, one bus is designated as the reference. For bus $1$, the angle is set to zero, which in rectangular coordinates is enforced by:\n    $$ v_{1,i} = 0, \\quad v_{1,r} \\geq 0 $$\n\n### Part 2: SOC Relaxation\nThe AC OPF problem is non-convex due to the quadratic power flow and branch limit equations. A common approach to find a good solution is to use a convex relaxation. We introduce the lifted voltage product matrix $W$ with elements $W_{ik} = V_i V_k^*$. This matrix is, by construction, Hermitian, positive semidefinite, and has rank one ($W = vv^*$, where $v=[V_1, V_2, V_3]^T$). The non-convexity is encapsulated in the rank-one constraint.\n\nThe semidefinite programming (SDP) relaxation of AC OPF involves dropping the rank constraint, requiring only $W \\succeq 0$. A necessary condition for $W \\succeq 0$ is that all of its principal minors are positive semidefinite. An SOC relaxation is a weaker (more relaxed) but computationally cheaper alternative to SDP, which often involves enforcing the positive semidefiniteness of only the $2 \\times 2$ principal minors of $W$.\n\nConsider the $2 \\times 2$ principal minor of $W$ corresponding to buses $1$ and $2$:\n$$ W_{1,2} = \\begin{pmatrix} W_{11}  W_{12} \\\\ W_{21}  W_{22} \\end{pmatrix} $$\nFor this submatrix to be positive semidefinite, its diagonal entries must be non-negative ($W_{11} \\geq 0, W_{22} \\geq 0$, which is true since $W_{ii}=|V_i|^2$), and its determinant must be non-negative.\n$$ \\det(W_{1,2}) = W_{11}W_{22} - W_{12}W_{21} \\geq 0 $$\nSince $W$ is Hermitian, $W_{21} = W_{12}^*$, so the condition is $W_{11}W_{22} - |W_{12}|^2 \\geq 0$. With $W_{12} = W_{12,r} + j W_{12,i}$, we have:\n$$ W_{11}W_{22} \\geq W_{12,r}^2 + W_{12,i}^2 $$\nThis inequality can be represented as a standard second-order cone constraint. Through algebraic manipulation:\n$$ 4W_{11}W_{22} \\geq 4W_{12,r}^2 + 4W_{12,i}^2 $$\n$$ (W_{11}+W_{22})^2 - (W_{11}-W_{22})^2 \\geq (2W_{12,r})^2 + (2W_{12,i})^2 $$\n$$ (W_{11}+W_{22})^2 \\geq (2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11}-W_{22})^2 $$\nSince $W_{11}+W_{22} \\ge 0$, we can take the square root of both sides:\n$$ \\sqrt{(2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11}-W_{22})^2} \\leq W_{11}+W_{22} $$\nThis is a standard SOC constraint of the form $\\|\\mathbf{x}\\|_2 \\leq t$, written as:\n$$ \\left\\| \\begin{pmatrix} 2W_{12,r} \\\\ 2W_{12,i} \\\\ W_{11}-W_{22} \\end{pmatrix} \\right\\|_2 \\leq W_{11}+W_{22} $$\nThis constraint is the SOC relaxation for the $2 \\times 2$ submatrix.\n\n### Part 3: Calculation of $\\Xi$\nThe final task is to compute the scalar $\\Xi$ defined as:\n$$ \\Xi \\;=\\; \\left(W_{11} + W_{22}\\right)^{2} \\;-\\; \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2} $$\nWe expand the squared norm term:\n$$ \\left\\| \\begin{bmatrix} 2\\,W_{12,r} \\\\ 2\\,W_{12,i} \\\\ W_{11} - W_{22} \\end{bmatrix} \\right\\|_{2}^{2} = (2W_{12,r})^2 + (2W_{12,i})^2 + (W_{11} - W_{22})^2 $$\n$$ = 4W_{12,r}^2 + 4W_{12,i}^2 + (W_{11}^2 - 2W_{11}W_{22} + W_{22}^2) $$\nWe also expand the first term in the definition of $\\Xi$:\n$$ (W_{11} + W_{22})^2 = W_{11}^2 + 2W_{11}W_{22} + W_{22}^2 $$\nSubstituting both expansions into the definition of $\\Xi$:\n$$ \\Xi = (W_{11}^2 + 2W_{11}W_{22} + W_{22}^2) - (4W_{12,r}^2 + 4W_{12,i}^2 + W_{11}^2 - 2W_{11}W_{22} + W_{22}^2) $$\nWe remove the parentheses and collect like terms:\n$$ \\Xi = W_{11}^2 + 2W_{11}W_{22} + W_{22}^2 - 4W_{12,r}^2 - 4W_{12,i}^2 - W_{11}^2 + 2W_{11}W_{22} - W_{22}^2 $$\nThe terms $W_{11}^2$ and $W_{22}^2$ cancel. The $W_{11}W_{22}$ terms add up.\n$$ \\Xi = 4W_{11}W_{22} - 4W_{12,r}^2 - 4W_{12,i}^2 $$\nThis is the simplest expanded form of $\\Xi$ as an analytic expression in the specified entries of $W$. It is notable that the condition for the SOC relaxation, $\\left\\| \\ldots \\right\\|_2 \\leq W_{11}+W_{22}$, is equivalent to $\\Xi \\geq 0$. Furthermore, $\\Xi$ is equal to $4$ times the determinant of the $2 \\times 2$ principal minor of $W$.",
            "answer": "$$\n\\boxed{4W_{11}W_{22} - 4W_{12,r}^{2} - 4W_{12,i}^{2}}\n$$"
        },
        {
            "introduction": "After formulating the AC OPF problem and its relaxation, a key question arises: how good is the solution from the relaxation? This exercise tackles this question head-on by having you solve a Semidefinite Programming (SDP) relaxation for a simple two-bus system. The central idea of the SDP relaxation is to replace the non-convex rank-1 constraint on the voltage product matrix $W$ with the convex constraint that $W$ is positive semidefinite ($W \\succeq 0$). Your task is to find the optimal solution to this relaxed problem and determine if the resulting matrix $W$ has rank 1, which would mean the relaxation is \"exact\" and has recovered the true optimal solution to the original AC problem. ",
            "id": "4081204",
            "problem": "Consider a two-bus Alternating Current Optimal Power Flow (AC-OPF) formulation under the Semidefinite Programming (SDP) relaxation in the per-unit system. The buses are connected by a single series branch with resistance $R = 0.05$ and reactance $X = 0.25$. There are no shunts. The series admittance is $$y = \\frac{R - \\mathrm{j} X}{R^{2} + X^{2}} = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13},$$ so the bus admittance matrix is\n$$\nY = \\begin{pmatrix}\ny  -y \\\\\n-y  y\n\\end{pmatrix}\n= \n\\begin{pmatrix}\n\\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}  -\\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13} \\\\\n-\\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13}  \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}\n\\end{pmatrix}.\n$$\nLet $v \\in \\mathbb{C}^{2}$ be the complex bus-voltage vector and let $W = v v^{\\mathrm{H}} \\in \\mathbb{C}^{2 \\times 2}$ be the lifted Hermitian matrix used in the SDP relaxation. The diagonal entries of $W$ equal the squared voltage magnitudes, i.e., $W_{kk} = |V_k|^2$.\n\nThe operating specifications are:\n- Voltage-magnitude bounds at both buses: $0.95 \\leq |V_{k}| \\leq 1.05$.\n- No shunt elements and no loads at either bus: $P_{k}^{d} = 0$ and $Q_{k}^{d} = 0$ for $k \\in \\{1,2\\}$.\n- A generator is located at bus $1$ with bounds $0 \\leq P_{1}^{g} \\leq 2$ and $-1 \\leq Q_{1}^{g} \\leq 1$. There is no generator at bus $2$, so $P_{2}^{g} = 0$ and $Q_{2}^{g} = 0$.\n- Linear generation cost at bus $1$: $c_{1} P_{1}^{g}$ for some $c_{1}  0$ (the numerical value is not needed for feasibility).\n\nThe SDP-relaxed constraints include:\n- $W \\succeq 0$ and $W$ Hermitian.\n- Voltage-magnitude bounds encoded as $0.95^{2} \\leq W_{kk} \\leq 1.05^{2}$ for $k \\in \\{1,2\\}$.\n- Nodal power balance using the lifted variables: for each $k \\in \\{1,2\\}$,\n$$\nP_{k}^{g} - P_{k}^{d} = \\Re\\!\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right), \n\\quad\nQ_{k}^{g} - Q_{k}^{d} = \\Im\\!\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right).\n$$\n\nStarting from the fundamental definitions $I = Y v$ and $S_{k} = V_{k} I_{k}^{*}$, construct an explicit matrix $W \\succeq 0$ that satisfies all the above constraints. Then determine whether this constructed $W$ is rank $1$. Report the rank of $W$ as your final answer (a single integer, unitless). No rounding is required; provide the exact integer.",
            "solution": "The user wants me to solve a problem related to the Semidefinite Programming (SDP) relaxation of an AC Optimal Power Flow (AC-OPF) problem.\n\n### Step 1: Extract Givens\n-   System: Two-bus network.\n-   Relaxation: Semidefinite Programming (SDP).\n-   Branch parameters: Series resistance $R = 0.05$ p.u., series reactance $X = 0.25$ p.u. No shunts.\n-   Series admittance: $y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$ p.u.\n-   Bus admittance matrix: $Y = \\begin{pmatrix} y  -y \\\\ -y  y \\end{pmatrix}$.\n-   Lifted variable: $W = v v^{\\mathrm{H}} \\in \\mathbb{C}^{2 \\times 2}$, where $v$ is the bus voltage vector. $W$ is Hermitian and $W \\succeq 0$.\n-   Diagonal entries: $W_{kk} = |V_{k}|^{2}$.\n-   Voltage bounds: $0.95 \\leq |V_{k}| \\leq 1.05$ for $k \\in \\{1,2\\}$. This translates to $0.95^2 \\leq W_{kk} \\leq 1.05^2$.\n-   Loads: $P_{k}^{d} = 0$ and $Q_{k}^{d} = 0$ for $k \\in \\{1,2\\}$.\n-   Generation at bus 1: $0 \\leq P_{1}^{g} \\leq 2$ and $-1 \\leq Q_{1}^{g} \\leq 1$.\n-   Generation at bus 2: $P_{2}^{g} = 0$ and $Q_{2}^{g} = 0$.\n-   Cost function: Minimize $c_{1} P_{1}^{g}$ where $c_{1}  0$.\n-   Power balance equations (relaxed): For $k \\in \\{1,2\\}$,\n    -   $P_{k}^{g} - P_{k}^{d} = \\Re\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right) = P_k^{\\text{inj}}$\n    -   $Q_{k}^{g} - Q_{k}^{d} = \\Im\\left(\\sum_{m=1}^{2} Y_{km}^{*} W_{km}\\right) = Q_k^{\\text{inj}}$\n-   Task: Construct a feasible matrix $W \\succeq 0$ and determine its rank.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is well-defined, scientifically grounded in the established theory of convex relaxations for power systems optimization, and contains all necessary information. The values provided for resistance, reactance, and the resulting admittance are consistent. The formulation of the SDP-relaxed power flow equations is standard. The presence of a cost function, $c_1 P_1^g$, indicates that the problem is an optimization problem (AC-OPF), not just a feasibility problem. Therefore, constructing a \"solution\" implies finding an *optimal* feasible point, not an arbitrary one.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed to find the optimal solution to the stated SDP-relaxed OPF problem and determine the rank of the resulting matrix $W$.\n\n### Solution\nThe problem is to find a matrix $W$ that satisfies all the given constraints and minimizes the objective function. Let the matrix $W$ be denoted as\n$$\nW = \\begin{pmatrix} W_{11}  W_{12} \\\\ W_{21}  W_{22} \\end{pmatrix}\n$$\nwhere $W$ is Hermitian, i.e., $W_{11}, W_{22} \\in \\mathbb{R}$ and $W_{21} = W_{12}^{*}$.\n\nFirst, we analyze the power balance constraints at bus $2$. At bus $2$, there is no generation and no load, so $P_2^g = 0$, $P_2^d = 0$, $Q_2^g = 0$, and $Q_2^d = 0$. The complex power injection at bus $2$ is zero:\n$$\nS_2^{\\text{inj}} = P_2^{\\text{inj}} + \\mathrm{j} Q_2^{\\text{inj}} = (P_2^g - P_2^d) + \\mathrm{j}(Q_2^g - Q_2^d) = 0\n$$\nThe power balance equation relates this to the matrix $W$:\n$$\nS_2^{\\text{inj}} = \\sum_{m=1}^{2} Y_{2m}^{*} W_{2m} = Y_{21}^{*} W_{21} + Y_{22}^{*} W_{22} = 0\n$$\nFrom the bus admittance matrix, we have $Y_{21} = -y$ and $Y_{22} = y$. Taking their complex conjugates gives $Y_{21}^* = -y^*$ and $Y_{22}^* = y^*$. Substituting these into the equation:\n$$\n(-y^*) W_{21} + (y^*) W_{22} = 0\n$$\n$$\ny^* (W_{22} - W_{21}) = 0\n$$\nThe problem gives $y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$, which is non-zero. Therefore, its conjugate $y^*$ is also non-zero. This implies that the other factor must be zero:\n$$\nW_{22} - W_{21} = 0 \\implies W_{21} = W_{22}\n$$\nSince $W$ is Hermitian, we have $W_{12} = W_{21}^*$. The diagonal element $W_{22}$ is defined as $|V_2|^2$, which is a real number. Thus, $W_{21}$ must be a real number, and $W_{12} = W_{21}$. Combining these findings, we have:\n$$\nW_{12} = W_{21} = W_{22}\n$$\nThe matrix $W$ must therefore have the form:\n$$\nW = \\begin{pmatrix} W_{11}  W_{22} \\\\ W_{22}  W_{22} \\end{pmatrix}\n$$\nFor $W$ to be positive semidefinite ($W \\succeq 0$), its determinant must be non-negative (along with non-negative diagonal entries, which are guaranteed by the voltage bounds).\n$$\n\\det(W) = W_{11}W_{22} - W_{22}^2 = W_{22}(W_{11} - W_{22}) \\ge 0\n$$\nThe voltage bounds are $0.95 \\le |V_k| \\le 1.05$, which implies $W_{kk} = |V_k|^2 \\ge 0.95^2 = 0.9025$. Since $W_{22}  0$, we can divide the inequality by $W_{22}$ without changing its direction:\n$$\nW_{11} - W_{22} \\ge 0 \\implies W_{11} \\ge W_{22}\n$$\nNow, we consider the power injection at bus $1$.\n$$\nS_1^{\\text{inj}} = P_1^g + \\mathrm{j}Q_1^g = \\sum_{m=1}^{2} Y_{1m}^* W_{1m} = Y_{11}^* W_{11} + Y_{12}^* W_{12}\n$$\nWe have $Y_{11} = y$ and $Y_{12} = -y$, so $Y_{11}^* = y^*$ and $Y_{12}^* = -y^*$. We also know $W_{12} = W_{22}$.\n$$\nS_1^{\\text{inj}} = y^* W_{11} + (-y^*) W_{22} = y^*(W_{11} - W_{22})\n$$\nThe objective is to minimize the generation cost $c_1 P_1^g$ with $c_1  0$. This is equivalent to minimizing the active power generation $P_1^g = \\Re(S_1^{\\text{inj}})$.\n$$\nP_1^g = \\Re\\left(y^*(W_{11} - W_{22})\\right)\n$$\nSince $W_{11}$ and $W_{22}$ are real, $W_{11}-W_{22}$ is real. So,\n$$\nP_1^g = \\Re(y^*) (W_{11} - W_{22})\n$$\nWe have $y = \\frac{10}{13} - \\mathrm{j}\\,\\frac{50}{13}$, so $y^* = \\frac{10}{13} + \\mathrm{j}\\,\\frac{50}{13}$. Thus, $\\Re(y^*) = \\frac{10}{13}$.\n$$\nP_1^g = \\frac{10}{13}(W_{11} - W_{22})\n$$\nSince $\\frac{10}{13}  0$ and we've established that a feasible solution must have $W_{11} \\ge W_{22}$, the minimum possible value of $P_1^g$ is achieved when $W_{11} - W_{22}$ is minimized. The minimum feasible value for $W_{11} - W_{22}$ is $0$. This occurs when $W_{11} = W_{22}$.\n\nLet's check if this is a valid solution. If $W_{11} = W_{22}$, then:\n-   $P_1^g = \\frac{10}{13}(0) = 0$. This satisfies the generation bound $0 \\le 0 \\le 2$.\n-   The reactive power generation is $Q_1^g = \\Im(S_1^{\\text{inj}}) = \\Im(y^*) (W_{11} - W_{22}) = \\frac{50}{13}(0) = 0$. This satisfies the bound $-1 \\le 0 \\le 1$.\n-   We need to select a value $w = W_{11} = W_{22}$ that satisfies the voltage bounds: $0.95^2 \\le w \\le 1.05^2$, which is $0.9025 \\le w \\le 1.1025$.\n-   We can construct an explicit optimal matrix by choosing any $w$ in this range. A simple choice is $w=1$.\n\nWith $w=1$, we have $W_{11}=1$ and $W_{22}=1$. The constructed optimal matrix $W$ is:\n$$\nW = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}\n$$\nThis matrix satisfies all constraints:\n-   It is Hermitian.\n-   It is positive semidefinite: $W_{11} = 1 \\ge 0$, and $\\det(W) = 1 \\times 1 - 1 \\times 1 = 0 \\ge 0$.\n-   The voltage bounds are satisfied: $0.9025 \\le W_{11} = 1 \\le 1.1025$ and $0.9025 \\le W_{22} = 1 \\le 1.1025$.\n-   The power balance and generation limits are satisfied, as shown above.\n\nThe final step is to determine the rank of this constructed matrix $W$. The rank of a matrix is the number of linearly independent columns (or rows).\nThe columns of $W$ are $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ and $\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$. These two vectors are identical and therefore linearly dependent.\nSince the matrix is not the zero matrix, its rank is not $0$.\nTherefore, the rank of the matrix $W$ is $1$.",
            "answer": "$$\n\\boxed{1}\n$$"
        },
        {
            "introduction": "Moving from analytical understanding to practical application, this exercise requires you to implement a numerical solver for the AC OPF problem on a radial distribution network. You will use the branch-flow formulation, a powerful model for radial systems, and apply the Second-Order Cone Programming (SOCP) relaxation, which is computationally more efficient than SDP. By coding an iterative algorithm that converges to the optimal solution, you will gain hands-on experience with how these convex optimization problems are solved in practice and develop an intuition for the interplay between power flow physics and the geometry of conic constraints. ",
            "id": "4081242",
            "problem": "You are asked to implement a complete, runnable program that applies the Second-Order Cone Programming (SOCP) branch flow relaxation to a $3$-bus radial feeder and computes an optimal solution for the branch-flow variables. The context is Alternating Current (AC) Optimal Power Flow for a radial distribution network using the branch flow (also known as DistFlow) model. The network consists of buses $1 \\rightarrow 2 \\rightarrow 3$ with bus $1$ as the slack bus. The variables to compute are the real and reactive power flows $p_{12}, q_{12}, p_{23}, q_{23}$, the squared current magnitudes $\\ell_{12}, \\ell_{23}$, and the squared voltage magnitudes $v_{2}, v_{3}$ at buses $2$ and $3$.\n\nStart from the fundamental physical laws and tested formulas:\n- Kirchhoff’s Current Law (KCL) and Kirchhoff’s Voltage Law (KVL).\n- Ohm’s law in phasor form for power systems.\n- The branch flow (DistFlow) equations for radial feeders without shunt elements.\n- The SOCP branch flow relaxation that arises from the relation between complex power, voltage magnitude, and current magnitude.\n\nThe model is specified as follows for each line $i \\rightarrow j$:\n- Power balance along the line and at downstream buses:\n  - $p_{23} = p_{3} + r_{23} \\ell_{23}$,\n  - $q_{23} = q_{3} + x_{23} \\ell_{23}$,\n  - $p_{12} = p_{2} + p_{23} + r_{12} \\ell_{12}$,\n  - $q_{12} = q_{2} + q_{23} + x_{12} \\ell_{12}$.\n- Voltage drop equations:\n  - $v_{2} = v_{1} - 2 \\left(r_{12} p_{12} + x_{12} q_{12} \\right) + \\left(r_{12}^{2} + x_{12}^{2}\\right) \\ell_{12}$,\n  - $v_{3} = v_{2} - 2 \\left(r_{23} p_{23} + x_{23} q_{23} \\right) + \\left(r_{23}^{2} + x_{23}^{2}\\right) \\ell_{23}$.\n- SOCP relaxation (sending-end formulation):\n  - $\\ell_{12} v_{1} \\ge p_{12}^{2} + q_{12}^{2}$,\n  - $\\ell_{23} v_{2} \\ge p_{23}^{2} + q_{23}^{2}$.\n\nAll quantities are in per-unit (p.u.). Voltage magnitudes are represented by their squared values $v_{i}$, and the squared current magnitudes are $\\ell_{ij}$. The slack bus squared voltage is fixed at $v_{1}$. The objective is to minimize the total real power loss, modeled as $\\min \\sum_{(i,j)} r_{ij} \\ell_{ij}$, subject to the above constraints and the box constraints:\n- Voltage bounds at buses $2$ and $3$: $v_{\\min}^{2} \\le v_{i} \\le v_{\\max}^{2}$,\n- Line current bounds: $\\ell_{ij} \\le I_{\\max,ij}^{2}$.\n\nUnder positive line resistances $r_{ij}  0$, the optimal solution of this convex program attains equality in the SOCP constraints, i.e., $\\ell_{ij} v_{i} = p_{ij}^{2} + q_{ij}^{2}$ wherever the current upper bounds are not active. Your program should exploit this property to compute the optimal solution by iteratively enforcing the equalities in the SOCP constraints together with the linear power balance and voltage drop equations until convergence.\n\nAngle quantities are not used in this formulation; therefore, no angle unit is required. All outputs must be in per-unit and expressed as floats.\n\nImplement an algorithm that:\n- Uses the above model and enforces the SOCP equalities $\\ell_{ij} v_{i} = p_{ij}^{2} + q_{ij}^{2}$ at optimality unless the current upper bound would be violated.\n- Iteratively updates $(p_{ij}, q_{ij}, v_{i}, \\ell_{ij})$ for the two lines until the changes are below a small tolerance.\n- Checks current upper bounds and caps $\\ell_{ij}$ at $I_{\\max,ij}^{2}$ if necessary. For the test suite below, parameters are chosen so that the current bounds do not bind.\n\nTest Suite (three cases), all in per-unit:\n- Case A (moderate load):\n  - Slack voltage squared $v_{1} = 1.0$.\n  - Line $1 \\rightarrow 2$: $r_{12} = 0.005$, $x_{12} = 0.010$.\n  - Line $2 \\rightarrow 3$: $r_{23} = 0.006$, $x_{23} = 0.012$.\n  - Loads: $p_{2} = 0.50$, $q_{2} = 0.15$, $p_{3} = 0.35$, $q_{3} = 0.10$.\n  - Voltage bounds: $v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$ (corresponding to $0.95$ and $1.05$ p.u. voltage magnitudes).\n  - Current limits: $I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$ (i.e., $I_{\\max} = 2.0$ p.u. on each line).\n- Case B (heavier load but feasible):\n  - Slack voltage squared $v_{1} = 1.0$.\n  - Line $1 \\rightarrow 2$: $r_{12} = 0.005$, $x_{12} = 0.010$.\n  - Line $2 \\rightarrow 3$: $r_{23} = 0.006$, $x_{23} = 0.012$.\n  - Loads: $p_{2} = 0.60$, $q_{2} = 0.20$, $p_{3} = 0.45$, $q_{3} = 0.15$.\n  - Voltage bounds: $v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$.\n  - Current limits: $I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$.\n- Case C (edge with downstream bus lightly loaded):\n  - Slack voltage squared $v_{1} = 1.0$.\n  - Line $1 \\rightarrow 2$: $r_{12} = 0.005$, $x_{12} = 0.010$.\n  - Line $2 \\rightarrow 3$: $r_{23} = 0.006$, $x_{23} = 0.012$.\n  - Loads: $p_{2} = 0.40$, $q_{2} = 0.00$, $p_{3} = 0.00$, $q_{3} = 0.00$.\n  - Voltage bounds: $v_{\\min}^{2} = 0.9025$, $v_{\\max}^{2} = 1.1025$.\n  - Current limits: $I_{\\max,12}^{2} = 4.0$, $I_{\\max,23}^{2} = 4.0$.\n\nComputation details:\n- Use the SOCP equality updates $\\ell_{12} = \\dfrac{p_{12}^{2} + q_{12}^{2}}{v_{1}}$ and $\\ell_{23} = \\dfrac{p_{23}^{2} + q_{23}^{2}}{v_{2}}$ for iterations.\n- Use a relaxation parameter strictly between $0$ and $1$ to stabilize iterations.\n- Stop when the maximum change in $\\ell_{12}$ and $\\ell_{23}$ is below $10^{-10}$ or after $10000$ iterations, whichever comes first.\n- If computed $v_{2}$ or $v_{3}$ falls outside $[v_{\\min}^{2}, v_{\\max}^{2}]$, do not alter the algorithm; the test suite is designed to be feasible. Report the computed values.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case result must itself be a list in the order $[p_{12},p_{23},q_{12},q_{23},\\ell_{12},\\ell_{23},v_{2},v_{3}]$.\n- All values must be printed as floats rounded to six decimal places.\n- For example: $[[a_{1},a_{2},\\dots,a_{8}],[b_{1},\\dots,b_{8}],[c_{1},\\dots,c_{8}]]$.\n\nYour task is to implement the algorithm to return the optimal solution under the SOCP branch flow relaxation for the above test suite.",
            "solution": "The user wants to solve the AC Optimal Power Flow (AC OPF) problem for a 3-bus radial distribution network using a Second-Order Cone Programming (SOCP) relaxation. The solution is to be found not by a generic SOCP solver but by a specialized iterative algorithm that exploits the structure of the problem.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n\n- **Network Topology:** A 3-bus radial feeder $1 \\rightarrow 2 \\rightarrow 3$, with bus $1$ as the slack bus.\n- **Variables:** Real power flow ($p_{12}, p_{23}$), reactive power flow ($q_{12}, q_{23}$), squared current magnitude ($\\ell_{12}, \\ell_{23}$), and squared voltage magnitude ($v_2, v_3$). All quantities are in per-unit (p.u.).\n- **Constants:**\n  - Slack bus squared voltage: $v_1$.\n  - Line impedances: $r_{12}, x_{12}, r_{23}, x_{23}$.\n  - Nodal power consumptions (loads): $p_2, q_2, p_3, q_3$.\n- **Model Equations (Branch Flow Model):**\n  - Power Balance:\n    - $p_{23} = p_{3} + r_{23} \\ell_{23}$\n    - $q_{23} = q_{3} + x_{23} \\ell_{23}$\n    - $p_{12} = p_{2} + p_{23} + r_{12} \\ell_{12}$\n    - $q_{12} = q_{2} + q_{23} + x_{12} \\ell_{12}$\n  - Voltage Drop:\n    - $v_2 = v_1 - 2(r_{12} p_{12} + x_{12} q_{12}) + (r_{12}^2 + x_{12}^2) \\ell_{12}$\n    - $v_3 = v_2 - 2(r_{23} p_{23} + x_{23} q_{23}) + (r_{23}^2 + x_{23}^2) \\ell_{23}$\n- **SOCP Relaxation Constraints:**\n  - $\\ell_{12} v_{1} \\ge p_{12}^{2} + q_{12}^{2}$\n  - $\\ell_{23} v_{2} \\ge p_{23}^{2} + q_{23}^{2}$\n- **Objective Function:** Minimize total real power loss, $\\min \\sum_{(i,j)} r_{ij} \\ell_{ij}$.\n- **Box Constraints:**\n  - Voltage: $v_{\\min}^{2} \\le v_i \\le v_{\\max}^{2}$ for $i \\in \\{2, 3\\}$.\n  - Current: $\\ell_{ij} \\le I_{\\max,ij}^{2}$.\n- **Algorithmic Specification:**\n  - An iterative method exploiting the optimality condition $\\ell_{ij} v_i = p_{ij}^2 + q_{ij}^2$.\n  - Iteratively update $(p_{ij}, q_{ij}, v_i, \\ell_{ij})$.\n  - Use a relaxation parameter $\\alpha \\in (0,1)$.\n  - Convergence tolerance: maximum change in $\\ell_{12}, \\ell_{23}$ is below $10^{-10}$.\n  - Maximum iterations: $10000$.\n  - Current limits should be checked, but are not expected to be active for the given test cases.\n  - Voltage limits are for context; the algorithm should report computed values even if they fall outside the bounds.\n- **Test Suite:** Three distinct cases (A, B, C) with specified numerical values for all parameters.\n\n**1.2. Validate Using Extracted Givens**\n\n- **Scientifically Grounded:** The problem is based on the well-established branch flow (DistFlow) model for power distribution systems, which is a direct application of fundamental circuit laws (KCL, KVL, Ohm's Law). The SOCP relaxation of the AC OPF problem is a standard, rigorously studied technique in power systems optimization. The objective of minimizing power losses is physically meaningful and economically important. The problem is scientifically sound.\n- **Well-Posed:** The problem describes a convex optimization problem (an SOCP) with a strictly convex objective function (since $r_{ij}  0$). Such problems have a unique optimal solution. All necessary parameters for the model and the test cases are provided. The iterative algorithm specified is a fixed-point iteration method, which is a valid approach for solving the system of equations that arise from the optimality conditions. The problem is well-posed.\n- **Objective:** The problem statement is written in precise, quantitative, and technical language. It is free from ambiguity, subjectivity, or opinion.\n- **Completeness and Consistency:** The model equations, constraints, objective, and all required numerical data are fully specified. There are no contradictions in the provided information.\n- **Realism:** The per-unit values for impedances, loads, and voltage/current limits are representative of typical distribution networks.\n\n**1.3. Verdict and Action**\n\nThe problem is valid. It is a well-defined, scientifically-grounded exercise in computational power systems engineering. A solution will be provided.\n\n### Step 2: Solution\n\nThe core of the problem is to solve a system of nonlinear equations that represent the Karush-Kuhn-Tucker (KKT) optimality conditions of the SOCP-relaxed Optimal Power Flow problem. The iterative algorithm specified in the problem is a fixed-point iteration method, specifically a successive substitution method enhanced with a relaxation parameter, designed to find the solution to this system.\n\n**Principle-Based Design of the Algorithm**\n\nThe algorithm is structured as a sequence of updates that mimics the physical flow of information in a radial network. It consists of a \"backward sweep\" to calculate power flows from the network extremities toward the source, a \"forward sweep\" to calculate voltages from the source outward, and an update step for the squared current magnitudes, which couples the two sweeps.\n\n1.  **Model Derivation and Structure:**\n    The provided equations form a complete model of the radial feeder.\n    - **Power Balance (Backward propagation):** For any bus $j$, the power $S_{ij} = p_{ij} + \\mathrm{i} q_{ij}$ flowing into it from its parent bus $i$ must supply the local load $S_j^{\\text{load}} = p_j + \\mathrm{i} q_j$, the power flowing out to its children buses ($S_{jk}$), and the losses on the line segment $ij$. The equations given are a rearrangement of this principle for a simple line topology. For example, for the segment $1 \\rightarrow 2$:\n    $$p_{12} = p_2 + p_{23} + r_{12} \\ell_{12}$$\n    Here, $p_2$ is the load at bus $2$, $p_{23}$ is the power flowing out to bus $3$, and $r_{12} \\ell_{12}$ is the real power loss on the line $1 \\rightarrow 2$. This structure is ideal for a backward sweep starting from the last bus ($3$) where there are no outgoing lines.\n\n    - **Voltage Drop (Forward propagation):** The voltage at a downstream bus $j$ is the voltage at the upstream bus $i$ minus the voltage drop along the line. The given equation is the exact expression for the squared voltage magnitude:\n    $$v_j = v_i - 2(r_{ij} p_{ij} + x_{ij} q_{ij}) + (r_{ij}^2 + x_{ij}^2) \\ell_{ij}$$\n    This naturally lends itself to a forward sweep, starting from the slack bus ($1$) where the voltage $v_1$ is known and fixed.\n\n    - **SOCP Equality (Coupling Relation):** The non-convex power flow constraint $p_{ij}^2 + q_{ij}^2 = v_i \\ell_{ij}$ is relaxed to $p_{ij}^2 + q_{ij}^2 \\le v_i \\ell_{ij}$. A key insight is that for an objective function that penalizes losses (i.e., minimizes $\\sum r_{ij}\\ell_{ij}$ with $r_{ij}  0$), the optimization will drive $\\ell_{ij}$ to its smallest possible value. The smallest value for $\\ell_{ij}$ that satisfies the constraint is when it holds with equality. Therefore, at the optimum (assuming no other constraints are binding), we have:\n    $$\\ell_{ij} = \\frac{p_{ij}^2 + q_{ij}^2}{v_i}$$\n    This equation is used as the basis for the iterative update of the squared current variables $\\ell_{ij}$.\n\n2.  **Iterative Solution Scheme:**\n    We can construct an iterative algorithm by starting with an initial guess for the squared currents, $\\ell_{12}^{(k)}$ and $\\ell_{23}^{(k)}$ (where $k$ is the iteration index), and then cycling through the equations.\n\n    - **Initialization:** Let $k=0$. Set initial guesses $\\ell_{12}^{(0)} = 0$ and $\\ell_{23}^{(0)} = 0$. This corresponds to a \"no-flow\" initial state.\n\n    - **Iteration $k+1$:**\n        1.  **Backward Sweep (Power Flows):** Using the values $\\ell_{12}^{(k)}$ and $\\ell_{23}^{(k)}$ from the previous iteration, compute the power flows for the current iteration. We start at the end of the feeder:\n            $$p_{23}^{(k+1)} = p_3 + r_{23} \\ell_{23}^{(k)}$$\n            $$q_{23}^{(k+1)} = q_3 + x_{23} \\ell_{23}^{(k)}$$\n            Then move up to the next line segment:\n            $$p_{12}^{(k+1)} = p_2 + p_{23}^{(k+1)} + r_{12} \\ell_{12}^{(k)}$$\n            $$q_{12}^{(k+1)} = q_2 + q_{23}^{(k+1)} + x_{12} \\ell_{12}^{(k)}$$\n\n        2.  **Forward Sweep (Voltages):** Using the newly computed power flows, calculate the voltages for the current iteration. We start from the known slack bus voltage $v_1$:\n            $$v_2^{(k+1)} = v_1 - 2(r_{12} p_{12}^{(k+1)} + x_{12} q_{12}^{(k+1)}) + (r_{12}^2 + x_{12}^2) \\ell_{12}^{(k)}$$\n            $$v_3^{(k+1)} = v_2^{(k+1)} - 2(r_{23} p_{23}^{(k+1)} + x_{23} q_{23}^{(k+1)}) + (r_{23}^2 + x_{23}^2) \\ell_{23}^{(k)}$$\n\n        3.  **Update Squared Currents ($\\ell$):** Compute new trial values for the squared currents using the optimality condition and the most recent voltage and power flow values.\n            $$\\ell_{12}^{\\text{trial}} = \\frac{(p_{12}^{(k+1)})^2 + (q_{12}^{(k+1)})^2}{v_1}$$\n            $$\\ell_{23}^{\\text{trial}} = \\frac{(p_{23}^{(k+1)})^2 + (q_{23}^{(k+1)})^2}{v_2^{(k+1)}}$$\n            The problem requires checking the current limit, so we cap the trial value:\n            $$\\ell_{ij}^{\\text{new}} = \\min(\\ell_{ij}^{\\text{trial}}, I_{\\max,ij}^2)$$\n\n        4.  **Relaxation:** To improve convergence stability, a new value for $\\ell_{ij}$ is formed by taking a weighted average of the old value and the new trial value, using a relaxation parameter $\\alpha \\in (0, 1)$.\n            $$\\ell_{12}^{(k+1)} = (1-\\alpha)\\ell_{12}^{(k)} + \\alpha \\ell_{12}^{\\text{new}}$$\n            $$\\ell_{23}^{(k+1)} = (1-\\alpha)\\ell_{23}^{(k)} + \\alpha \\ell_{23}^{\\text{new}}$$\n\n    - **Convergence Check:** The process is repeated until the change in the iterated variables is negligible, i.e., $\\max(|\\ell_{12}^{(k+1)} - \\ell_{12}^{(k)}|, |\\ell_{23}^{(k+1)} - \\ell_{23}^{(k)}|)  10^{-10}$, or a maximum number of iterations is reached.\n\n    - **Final Result:** Once the loop terminates, the converged values $\\ell_{12}$ and $\\ell_{23}$ are used in a final backward and forward sweep to compute the final, consistent set of variables $(p_{12}, p_{23}, q_{12}, q_{23}, \\ell_{12}, \\ell_{23}, v_{2}, v_{3})$. This ensures all reported values satisfy the model equations with the converged currents.\n\nThis algorithm will be implemented for each of the three test cases provided.",
            "answer": "```python\nimport numpy as np\n\ndef run_solver_for_case(params):\n    \"\"\"\n    Solves the SOCP-relaxed branch flow problem for a single case using an iterative method.\n\n    Args:\n        params (dict): A dictionary containing all parameters for the test case.\n\n    Returns:\n        list: A list of the 8 solution variables in the order\n              [p12, p23, q12, q23, l12, l23, v2, v3].\n    \"\"\"\n    # Algorithm constants\n    TOL = 1e-10\n    MAX_ITER = 10000\n    ALPHA = 0.5  # Relaxation parameter, strictly between 0 and 1\n\n    # Extract parameters from the dictionary for clarity\n    v1 = params['v1']\n    r12, x12 = params['r12'], params['x12']\n    r23, x23 = params['r23'], params['x23']\n    p2_load, q2_load = params['p2'], params['q2']\n    p3_load, q3_load = params['p3'], params['q3']\n    Imax12_sq = params['Imax12_sq']\n    Imax23_sq = params['Imax23_sq']\n\n    # Pre-calculate squared line impedances\n    z12_sq = r12**2 + x12**2\n    z23_sq = r23**2 + x23**2\n\n    # Initialize the iteration variables (squared current magnitudes)\n    l12 = 0.0\n    l23 = 0.0\n\n    for _ in range(MAX_ITER):\n        l12_old, l23_old = l12, l23\n\n        # --- Backward Sweep: Compute power flows from leaf to root ---\n        # Power flow on line 2-3\n        p23 = p3_load + r23 * l23\n        q23 = q3_load + x23 * l23\n        \n        # Power flow on line 1-2\n        p12 = p2_load + p23 + r12 * l12\n        q12 = q2_load + q23 + x12 * l12\n\n        # --- Forward Sweep: Compute voltages from root to leaf ---\n        # Voltage at bus 2\n        v2 = v1 - 2 * (r12 * p12 + x12 * q12) + z12_sq * l12\n        \n        # Voltage at bus 3\n        v3 = v2 - 2 * (r23 * p23 + x23 * q23) + z23_sq * l23\n\n        # --- Update Step: Compute new squared currents ---\n        # The iterative scheme can diverge if v2 becomes non-positive.\n        # The test cases are feasible, so we assume v2  0.\n        if v2 = 0:\n            # In a robust solver, this would require error handling.\n            # Here we can break as this indicates divergence.\n            break\n            \n        # New trial values for l12 and l23 based on SOCP equality\n        l12_new_trial = (p12**2 + q12**2) / v1\n        l23_new_trial = (p23**2 + q23**2) / v2\n\n        # Enforce current limits (as per problem, these will not bind)\n        l12_new = min(l12_new_trial, Imax12_sq)\n        l23_new = min(l23_new_trial, Imax23_sq)\n\n        # Apply relaxation for stability\n        l12 = (1 - ALPHA) * l12_old + ALPHA * l12_new\n        l23 = (1 - ALPHA) * l23_old + ALPHA * l23_new\n\n        # --- Convergence Check ---\n        error = max(abs(l12 - l12_old), abs(l23 - l23_old))\n        if error  TOL:\n            break\n\n    # After convergence, perform one final calculation for fully consistent results\n    p23 = p3_load + r23 * l23\n    q23 = q3_load + x23 * l23\n    p12 = p2_load + p23 + r12 * l12\n    q12 = q2_load + q23 + x12 * l12\n    v2 = v1 - 2 * (r12 * p12 + x12 * q12) + z12_sq * l12\n    v3 = v2 - 2 * (r23 * p23 + x23 * q23) + z23_sq * l23\n\n    return [p12, p23, q12, q23, l12, l23, v2, v3]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the final results.\n    \"\"\"\n    test_cases = [\n        # Case A: moderate load\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.50, 'q2': 0.15, 'p3': 0.35, 'q3': 0.10,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        },\n        # Case B: heavier load\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.60, 'q2': 0.20, 'p3': 0.45, 'q3': 0.15,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        },\n        # Case C: edge with downstream bus lightly loaded\n        {\n            'v1': 1.0, 'r12': 0.005, 'x12': 0.010, 'r23': 0.006, 'x23': 0.012,\n            'p2': 0.40, 'q2': 0.00, 'p3': 0.00, 'q3': 0.00,\n            'Imax12_sq': 4.0, 'Imax23_sq': 4.0\n        }\n    ]\n    \n    results = []\n    for case_params in test_cases:\n        result = run_solver_for_case(case_params)\n        results.append(result)\n\n    # Format the final output string exactly as specified\n    case_strings = []\n    for res in results:\n        res_str = f'[{\",\".join(f\"{v:.6f}\" for v in res)}]'\n        case_strings.append(res_str)\n    \n    final_output = f'[{\",\".join(case_strings)}]'\n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}