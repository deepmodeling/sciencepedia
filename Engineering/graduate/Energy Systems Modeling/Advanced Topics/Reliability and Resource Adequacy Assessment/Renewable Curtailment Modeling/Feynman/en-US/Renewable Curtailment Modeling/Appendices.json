{
    "hands_on_practices": [
        {
            "introduction": "Understanding renewable curtailment begins with the fundamental economic trade-offs at the heart of power system operations. This first practice invites you to solve a simplified Unit Commitment (UC) problem, forcing a decision between dispatching a conventional thermal generator with its associated costs and constraints, or utilizing available wind energy. By comparing these scenarios, you will uncover how operational constraints, such as a thermal unit's minimum stable output, can directly lead to the economic curtailment of otherwise available renewable power .",
            "id": "4116370",
            "problem": "Consider a single-period Unit Commitment (UC) problem with one dispatchable thermal generator and a wind plant. The objective is to determine the thermal commitment decision, thermal dispatch, wind dispatch, wind curtailment, and any unserved energy that minimize the total system cost while respecting physical constraints. Use the following fundamental basis: energy balance, non-negativity and capacity constraints, and a linear cost function combining commitment-related and dispatch-related terms.\n\nDefine the decision variables as follows, all expressed in megawatts (MW): thermal on/off indicator $y \\in \\{0,1\\}$, thermal power $p^{\\text{th}} \\ge 0$, wind power $p^{\\text{w}} \\ge 0$, wind curtailment $c^{\\text{w}} \\ge 0$, and unserved energy $s \\ge 0$. The parameters are: load $L$ (MW), thermal minimum stable output $P^{\\min}$ (MW), thermal maximum output $P^{\\max}$ (MW), available wind $P^{\\text{avail}}$ (MW), thermal marginal energy cost $c_{\\text{m}}$ (dollars per megawatt-hour), start-up cost $C_{\\text{su}}$ (dollars), no-load cost $C_{\\text{nl}}$ (dollars), wind curtailment penalty $\\pi_{\\text{curt}}$ (dollars per megawatt-hour), and Value of Lost Load (VOLL) $V$ (dollars per megawatt-hour). Assume initial thermal status is off, so committing incurs a start-up cost if $y=1$.\n\nThe physical and operational constraints are:\n- Power balance: $$p^{\\text{th}} + p^{\\text{w}} + s = L.$$\n- Thermal operability: $$y \\in \\{0,1\\}, \\quad p^{\\text{th}} \\le y \\, P^{\\max}, \\quad p^{\\text{th}} \\ge y \\, P^{\\min}.$$\n- Wind availability and curtailment definition: $$0 \\le p^{\\text{w}} \\le P^{\\text{avail}}, \\quad c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}, \\quad c^{\\text{w}} \\ge 0.$$\n- Non-negativity of unserved energy: $$s \\ge 0.$$\n\nThe total cost to minimize is:\n$$\\text{Cost} = C_{\\text{su}} \\, y + C_{\\text{nl}} \\, y + c_{\\text{m}} \\, p^{\\text{th}} + \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s.$$\n\nInterpretation:\n- Thermal generation has a binary commitment and must respect minimum and maximum output if committed.\n- Wind generation is free to dispatch up to its availability, with any unused available wind counted as curtailment and penalized by $\\pi_{\\text{curt}}$.\n- Unserved energy (shortage) is allowed but highly penalized by VOLL $V$.\n- All power quantities must be expressed in MW, and all cost quantities in dollars. For outputs, express all MW values and dollar values as decimal numbers rounded to two decimal places.\n\nImplement a program that, for each parameter set in the test suite below, computes the optimal tuple $[y, p^{\\text{th}}, p^{\\text{w}}, c^{\\text{w}}, s, \\text{Cost}]$ that minimizes the total cost subject to the constraints. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is itself a bracketed comma-separated list with no spaces. For example, the final output format must be of the form $$[ [y_1,p^{\\text{th}}_1,p^{\\text{w}}_1,c^{\\text{w}}_1,s_1,\\text{Cost}_1], [y_2,p^{\\text{th}}_2,p^{\\text{w}}_2,c^{\\text{w}}_2,s_2,\\text{Cost}_2], \\ldots ].$$\n\nTest suite (all powers in MW, all costs in dollars or dollars per megawatt-hour, and all numbers should be treated as exact constants in the calculations):\n- Case $1$: $L=100$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $2$: $L=60$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $3$: $L=40$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=20$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $4$: $L=300$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $5$: $L=370$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each case encoded as $[y,p^{\\text{th}},p^{\\text{w}},c^{\\text{w}},s,\\text{Cost}]$, where $y$ is an integer ($0$ or $1$) and all other entries are decimal numbers rounded to two decimal places. There must be no spaces anywhere in the printed line.",
            "solution": "The user wants to solve a single-period unit commitment problem. I will begin by validating the problem statement.\n\n### Step 1: Extract Givens\nThe problem is to find the minimum of a cost function subject to a set of constraints.\n\n**Decision Variables (all in MW):**\n- Thermal on/off indicator: $y \\in \\{0,1\\}$\n- Thermal power output: $p^{\\text{th}} \\ge 0$\n- Wind power dispatched: $p^{\\text{w}} \\ge 0$\n- Wind curtailment: $c^{\\text{w}} \\ge 0$\n- Unserved energy (shortage): $s \\ge 0$\n\n**Parameters:**\n- Load: $L$ (MW)\n- Thermal minimum stable output: $P^{\\min}$ (MW)\n- Thermal maximum output: $P^{\\max}$ (MW)\n- Available wind power: $P^{\\text{avail}}$ (MW)\n- Thermal marginal energy cost: $c_{\\text{m}}$ ($\\$/MWh$)\n- Thermal start-up cost: $C_{\\text{su}}$ ($\\$$)\n- Thermal no-load cost: $C_{\\text{nl}}$ ($\\$$)\n- Wind curtailment penalty: $\\pi_{\\text{curt}}$ ($\\$/MWh$)\n- Value of Lost Load (VOLL): $V$ ($\\$/MWh$)\n\n**Initial Condition:**\n- The thermal generator is initially off.\n\n**Constraints:**\n1.  Power balance: $p^{\\text{th}} + p^{\\text{w}} + s = L$\n2.  Thermal operability: $y \\in \\{0,1\\}$, $p^{\\text{th}} \\le y \\, P^{\\max}$, $p^{\\text{th}} \\ge y \\, P^{\\min}$\n3.  Wind availability: $0 \\le p^{\\text{w}} \\le P^{\\text{avail}}$\n4.  Wind curtailment definition: $c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}$\n5.  Non-negativity: $c^{\\text{w}} \\ge 0$, $s \\ge 0$\n\n**Objective Function:**\n- Minimize Total Cost: $\\text{Cost} = C_{\\text{su}} \\, y + C_{\\text{nl}} \\, y + c_{\\text{m}} \\, p^{\\text{th}} + \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s$\n\n**Test Suite:**\n- Case $1$: $L=100$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $2$: $L=60$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=80$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $3$: $L=40$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=20$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $4$: $L=300$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n- Case $5$: $L=370$, $P^{\\min}=50$, $P^{\\max}=200$, $P^{\\text{avail}}=120$, $c_{\\text{m}}=30$, $C_{\\text{su}}=500$, $C_{\\text{nl}}=100$, $\\pi_{\\text{curt}}=5$, $V=2000$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem describes a simplified but standard economic dispatch and unit commitment formulation, a cornerstone of energy systems modeling. It is formulated as a Mixed-Integer Linear Program (MILP).\n\n- **Scientifically Grounded**: The problem is based on fundamental principles of power system operation, including power balance, generator limits, and cost minimization. All components (thermal/wind generation, load, curtailment, shortage) are standard concepts.\n- **Well-Posed**: The problem is an optimization problem with a linear objective function and linear constraints over a convex domain for each fixed value of the integer variable $y$. Since there are only two possible values for $y$, a unique, stable, and meaningful solution is guaranteed to exist.\n- **Objective**: The problem is defined with precise mathematical and technical language, with all parameters and variables specified unambiguously.\n\nThe problem is self-contained, consistent, and scientifically sound. No flaws are identified.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with the solution.\n\nThe problem can be solved by decomposing it based on the binary commitment decision for the thermal generator, $y \\in \\{0, 1\\}$. We will analyze the optimal dispatch and associated cost for each case and then select the case that yields the minimum total cost. The time period is a single hour, so MWh and MW are numerically equivalent, and all cost rates in $\\$/MWh$ can be treated as costs per MW.\n\n**Case A: Thermal Unit is OFF ($y=0$)**\nIf the thermal unit is off, its commitment state is $y = 0$. The operational constraints on $p^{\\text{th}}$ become $p^{\\text{th}} \\le 0 \\cdot P^{\\max}$ and $p^{\\text{th}} \\ge 0 \\cdot P^{\\min}$, which forces $p^{\\text{th}} = 0$. The cost function simplifies to:\n$$ \\text{Cost}_{y=0} = \\pi_{\\text{curt}} \\, c^{\\text{w}} + V \\, s $$\nThe power balance becomes $p^{\\text{w}} + s = L$. We can express $s$ as $s = L - p^{\\text{w}}$ and $c^{\\text{w}}$ as $c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}}$. Substituting these into the cost function gives:\n$$ \\text{Cost}_{y=0} = \\pi_{\\text{curt}}(P^{\\text{avail}} - p^{\\text{w}}) + V(L - p^{\\text{w}}) = (\\pi_{\\text{curt}}P^{\\text{avail}} + VL) - (\\pi_{\\text{curt}} + V)p^{\\text{w}} $$\nTo minimize this cost, we must maximize $p^{\\text{w}}$, since its coefficient $-(\\pi_{\\text{curt}} + V)$ is negative. The constraints on $p^{\\text{w}}$ are $0 \\le p^{\\text{w}} \\le P^{\\text{avail}}$ and $s = L - p^{\\text{w}} \\ge 0 \\implies p^{\\text{w}} \\le L$. Combining these, the feasible range for $p^{\\text{w}}$ is $0 \\le p^{\\text{w}} \\le \\min(L, P^{\\text{avail}})$.\nThus, the optimal wind dispatch is $p^{\\text{w}}_{(0)} = \\min(L, P^{\\text{avail}})$.\nThe remaining variables are then:\n- $p^{\\text{th}}_{(0)} = 0$\n- $c^{\\text{w}}_{(0)} = P^{\\text{avail}} - p^{\\text{w}}_{(0)}$\n- $s_{(0)} = L - p^{\\text{w}}_{(0)}$\nThe total cost is $\\text{Cost}_{y=0} = \\pi_{\\text{curt}}c^{\\text{w}}_{(0)} + V s_{(0)}$.\n\n**Case B: Thermal Unit is ON ($y=1$)**\nIf the thermal unit is on ($y = 1$), it incurs fixed costs $C_{\\text{su}} + C_{\\text{nl}}$ and must operate within its limits, $P^{\\min} \\le p^{\\text{th}} \\le P^{\\max}$. The total cost is:\n$$ \\text{Cost}_{y=1} = (C_{\\text{su}} + C_{\\text{nl}}) + c_{\\text{m}} p^{\\text{th}} + \\pi_{\\text{curt}} c^{\\text{w}} + V s $$\nA critical constraint arises from the power balance equation $p^{\\text{th}} + p^{\\text{w}} + s = L$. Since $p^{\\text{w}} \\ge 0$ and $s \\ge 0$, we have $p^{\\text{th}} \\le L$. Combined with the minimum output constraint $p^{\\text{th}} \\ge P^{\\min}$, this implies that the $y=1$ case is only feasible if $L \\ge P^{\\min}$. If $L < P^{\\min}$, any dispatch with $p^{\\text{th}} \\ge P^{\\min}$ would violate the power balance equation (as $p^{\\text{th}} > L$ would require $p^{\\text{w}} + s < 0$, which is impossible). Therefore, if $L < P^{\\min}$, the $y=1$ case is infeasible, and its cost can be considered infinite.\n\nAssuming $L \\ge P^{\\min}$, we proceed by determining the optimal dispatch. The economic merit order suggests using wind first, then thermal, and finally incurring unserved energy, due to the typical cost hierarchy $\\pi_{\\text{curt}} < c_{\\text{m}} < V$.\n\nThere are two primary sub-cases for $y=1$:\n1.  **Insufficient Capacity ($L > P^{\\max} + P^{\\text{avail}}$):** The total available generation is less than the load. To minimize the prohibitively expensive unserved energy $s$, all available generation must be dispatched.\n    - $p^{\\text{th}}_{(1)} = P^{\\max}$\n    - $p^{\\text{w}}_{(1)} = P^{\\text{avail}}$ (which implies $c^{\\text{w}}_{(1)} = 0$)\n    - $s_{(1)} = L - P^{\\max} - P^{\\text{avail}}$\n\n2.  **Sufficient Capacity ($P^{\\min} \\le L \\le P^{\\max} + P^{\\text{avail}}$):** The load can be met without unserved energy, so we can set $s_{(1)} = 0$. The power balance is $p^{\\text{th}} + p^{\\text{w}} = L$. The objective is to minimize $(C_{\\text{su}} + C_{\\text{nl}}) + c_{\\text{m}}p^{\\text{th}} + \\pi_{\\text{curt}}c^{\\text{w}}$. Substituting $p^{\\text{w}} = L - p^{\\text{th}}$ and $c^{\\text{w}} = P^{\\text{avail}} - p^{\\text{w}} = P^{\\text{avail}} - (L - p^{\\text{th}})$, the variable part of the cost becomes:\n    $$ c_{\\text{m}}p^{\\text{th}} + \\pi_{\\text{curt}}(P^{\\text{avail}} - L + p^{\\text{th}}) = (c_{\\text{m}} + \\pi_{\\text{curt}})p^{\\text{th}} + \\pi_{\\text{curt}}(P^{\\text{avail}} - L) $$\n    Since the coefficient $(c_{\\text{m}} + \\pi_{\\text{curt}})$ is positive, we must choose the minimum possible value for $p^{\\text{th}}$. The feasible range for $p^{\\text{th}}$ is determined by its own limits and the limits on wind power:\n    - $P^{\\min} \\le p^{\\text{th}} \\le P^{\\max}$\n    - $0 \\le p^{\\text{w}} \\le P^{\\text{avail}} \\implies 0 \\le L - p^{\\text{th}} \\le P^{\\text{avail}}$, which gives $L - P^{\\text{avail}} \\le p^{\\text{th}} \\le L$.\n    Combining these, the feasible range for $p^{\\text{th}}$ is $[\\max(P^{\\min}, L - P^{\\text{avail}}), \\min(P^{\\max}, L)]$.\n    To minimize cost, we select the lowest value from this range:\n    - $p^{\\text{th}}_{(1)} = \\max(P^{\\min}, L - P^{\\text{avail}})$\n    - The other variables follow: $p^{\\text{w}}_{(1)} = L - p^{\\text{th}}_{(1)}$, $c^{\\text{w}}_{(1)} = P^{\\text{avail}} - p^{\\text{w}}_{(1)}$, and $s_{(1)} = 0$.\n\n**Final Decision Algorithm**\nFor each parameter set:\n1.  Calculate the decision variables and total cost for the $y=0$ case, $\\text{Cost}_{y=0}$.\n2.  Calculate the decision variables and total cost for the $y=1$ case, $\\text{Cost}_{y=1}$. If $L < P^{\\min}$, set $\\text{Cost}_{y=1} = \\infty$.\n3.  Compare the costs. If $\\text{Cost}_{y=0} \\le \\text{Cost}_{y=1}$, the optimal solution is the one found in the $y=0$ case. Otherwise, it is the one from the $y=1$ case.\n4.  Format the resulting tuple $[y, p^{\\text{th}}, p^{\\text{w}}, c^{\\text{w}}, s, \\text{Cost}]$ for output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the single-period unit commitment problem for a series of test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: L=100, P_min=50, P_max=200, P_avail=80, ...\n        {\n            \"L\": 100.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 80.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 2: L=60, P_min=50, P_max=200, P_avail=80, ...\n        {\n            \"L\": 60.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 80.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 3: L=40, P_min=50, P_max=200, P_avail=20, ...\n        {\n            \"L\": 40.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 20.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 4: L=300, P_min=50, P_max=200, P_avail=120, ...\n        {\n            \"L\": 300.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 120.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        },\n        # Case 5: L=370, P_min=50, P_max=200, P_avail=120, ...\n        {\n            \"L\": 370.0, \"P_min\": 50.0, \"P_max\": 200.0, \"P_avail\": 120.0,\n            \"c_m\": 30.0, \"C_su\": 500.0, \"C_nl\": 100.0, \"pi_curt\": 5.0, \"V\": 2000.0\n        }\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        L, P_min, P_max, P_avail = params[\"L\"], params[\"P_min\"], params[\"P_max\"], params[\"P_avail\"]\n        c_m, C_su, C_nl, pi_curt, V = params[\"c_m\"], params[\"C_su\"], params[\"C_nl\"], params[\"pi_curt\"], params[\"V\"]\n\n        # Case y = 0 (Thermal OFF)\n        y0 = 0\n        p_th0 = 0.0\n        p_w0 = min(L, P_avail)\n        c_w0 = P_avail - p_w0\n        s0 = L - p_w0\n        cost0 = pi_curt * c_w0 + V * s0\n        res0 = [y0, p_th0, p_w0, c_w0, s0, cost0]\n\n        # Case y = 1 (Thermal ON)\n        cost1 = float('inf')\n        res1 = []\n\n        # The y=1 case is infeasible if load is less than the thermal minimum run level.\n        if L >= P_min:\n            y1 = 1\n            fixed_cost1 = C_su + C_nl\n            \n            # Subcase: Insufficient capacity\n            if L > P_max + P_avail:\n                p_th1 = P_max\n                p_w1 = P_avail\n                c_w1 = 0.0\n                s1 = L - p_th1 - p_w1\n            # Subcase: Sufficient capacity\n            else:\n                s1 = 0.0\n                p_th1 = max(P_min, L - P_avail)\n                p_w1 = L - p_th1\n                c_w1 = P_avail - p_w1\n            \n            cost1 = fixed_cost1 + c_m * p_th1 + pi_curt * c_w1 + V * s1\n            res1 = [y1, p_th1, p_w1, c_w1, s1, cost1]\n\n        # Compare costs and select optimal solution\n        if cost0 <= cost1:\n            optimal_res = res0\n        else:\n            optimal_res = res1\n            \n        # Format for output\n        y_opt = int(optimal_res[0])\n        p_th_opt = f\"{optimal_res[1]:.2f}\"\n        p_w_opt = f\"{optimal_res[2]:.2f}\"\n        c_w_opt = f\"{optimal_res[3]:.2f}\"\n        s_opt = f\"{optimal_res[4]:.2f}\"\n        cost_opt = f\"{optimal_res[5]:.2f}\"\n        \n        results.append(f\"[{y_opt},{p_th_opt},{p_w_opt},{c_w_opt},{s_opt},{cost_opt}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "In a real power grid, the location of generation is as important as its amount, and curtailment decisions are often driven by physical network constraints. This exercise moves from a single-node view to a meshed network, introducing the concept of Power Transfer Distribution Factors (PTDFs) to quantify how effectively different renewable plants can alleviate transmission congestion. You will derive the most efficient curtailment strategy and contrast it with a fairness-based approach, revealing a critical trade-off between system efficiency and equitable treatment of generators .",
            "id": "4116381",
            "problem": "Consider the linearized direct current (DC) power flow model for a meshed transmission network. Let there be a set of buses indexed by $i \\in \\{1,\\dots,N\\}$ and a single monitored transmission element (line) $\\ell$ with a thermal limit. The Power Transfer Distribution Factor (PTDF) for bus $i$ with respect to line $\\ell$, denoted $p_i$, gives the change in flow on line $\\ell$ (in megawatts, MW) resulting from a $1$ MW net injection at bus $i$ and a corresponding $1$ MW withdrawal at the slack bus under the DC approximation. Renewable curtailment at bus $i$ is modeled as a reduction in net injection by an amount $c_i$ (in MW), with $0 \\le c_i \\le r_i$, where $r_i$ is the pre-curtailment renewable output at bus $i$ (in MW). Assume that only buses with $p_i > 0$ can relieve congestion on the monitored line by curtailment; curtailment at buses with $p_i \\le 0$ does not help and must be ignored for congestion relief on $\\ell$.\n\nThe base flow on the monitored line is $F_0$ (in MW), and the thermal limit is $F_{\\max}$ (in MW). The required congestion relief is $D = \\max\\{0, F_0 - F_{\\max}\\}$ (in MW). Under the DC model, the change in flow on line $\\ell$ due to curtailment vector $\\mathbf{c} = (c_1,\\dots,c_N)$ is $\\Delta F = \\sum_{i=1}^N p_i c_i$. A feasible curtailment plan must satisfy $\\sum_{i=1}^N p_i c_i \\ge D$ with $0 \\le c_i \\le r_i$, and $c_i = 0$ whenever $p_i \\le 0$.\n\nTask A: Efficiency. Starting from the DC power flow linearization and the definition of PTDF, and without assuming any specialized optimality formula, derive from first principles which buses should be curtailed to minimize the total curtailed energy $\\sum_{i=1}^N c_i$ subject to the constraint $\\sum_{i=1}^N p_i c_i \\ge D$ and the bounds $0 \\le c_i \\le r_i$, focusing only on buses with $p_i > 0$. Use your derivation to show that curtailing at a bus with a low $p_i$ is inefficient, in the sense that more total curtailment (in MW) is required to achieve the same congestion relief $D$ compared to curtailing at a bus with a higher $p_i$.\n\nTask B: Fairness-constrained allocation. Impose a fairness constraint that all contributing renewable producers (those with $p_i > 0$) face an equal proportional curtailment burden: there exists a scalar $\\phi \\in [0,1]$ such that $c_i = \\phi r_i$ for all $i$ with $p_i > 0$, capped by $r_i$. Under this fairness constraint, derive the allocation that achieves the minimal proportional burden $\\phi$ while satisfying the congestion relief requirement. Express the resulting $\\phi$ as a decimal fraction and the total curtailment $\\sum_{i=1}^N c_i$ in megawatts.\n\nImplementation requirements: Write a complete program that, for each provided test case, computes the following four outputs:\n- The minimal total curtailment in MW from Task A, rounded to three decimals.\n- The total curtailment in MW when curtailments are applied greedily in ascending order of $p_i$ (that is, prioritizing the lowest positive $p_i$ first, then the next-lowest, and so on), rounded to three decimals. This ascending order plan is used to demonstrate inefficiency relative to the efficient plan.\n- The fairness burden $\\phi$ from Task B as a decimal fraction, rounded to six decimals.\n- The total curtailment in MW under the fairness-constrained allocation from Task B, rounded to three decimals.\n\nYour program should assume that all quantities are in megawatts (MW) and should express all curtailment outputs in MW. The fairness burden should be expressed as a decimal fraction, not a percentage. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result\\_1,result\\_2,\\dots]$). For multiple test cases, aggregate the per-test-case results as a list of lists.\n\nUse the following test suite, where each test case is a tuple $(\\mathbf{p}, \\mathbf{r}, F_0, F_{\\max})$:\n- Test case $1$: $\\mathbf{p} = [0.9, 0.6, 0.1, -0.2, 0.0]$, $\\mathbf{r} = [70, 50, 500, 20, 10]$ in MW, $F_0 = 140$ MW, $F_{\\max} = 110$ MW.\n- Test case $2$: $\\mathbf{p} = [0.7, 0.3, -0.2]$, $\\mathbf{r} = [20, 10, 5]$ in MW, $F_0 = 117$ MW, $F_{\\max} = 100$ MW.\n- Test case $3$: $\\mathbf{p} = [0.5, 0.2, 0.0, -0.1]$, $\\mathbf{r} = [10, 10, 100, 5]$ in MW, $F_0 = 95$ MW, $F_{\\max} = 100$ MW.\n\nNotes:\n- For each test case, compute $D = \\max\\{0, F_0 - F_{\\max}\\}$ in MW.\n- Assume feasibility holds for all test cases in the sense that the fairness-constrained allocation with $\\phi \\in [0,1]$ can meet the required relief $D$. If $D = 0$, all curtailments should be $0$ MW and $\\phi = 0$.\n- In all computations, ignore buses with $p_i \\le 0$ for the purpose of congestion relief.\n\nFinal output format: Your program should produce a single line of output representing a list with three elements (one per test case). Each element must itself be a list of four floats in the exact order described above, with the prescribed rounding applied. For example, the printed output should look like $[[a,b,c,d],[\\dots],[\\dots]]$ where $a,b,d$ are in MW and $c$ is a decimal fraction.",
            "solution": "The problem statement is evaluated and found to be valid. It is scientifically grounded in the established principles of linearized DC power flow analysis, a standard method in power systems engineering. The problem is well-posed, containing all necessary data and constraints to derive unique and meaningful solutions for the defined tasks. The language is objective and precise.\n\nThe central task is to determine optimal and fair strategies for renewable energy curtailment to alleviate transmission congestion. We are given a set of buses $i \\in \\{1,\\dots,N\\}$, their Power Transfer Distribution Factors (PTDFs) $p_i$ with respect to a congested line $\\ell$, and their available renewable generation $r_i$. The congestion is quantified as a required relief of $D = \\max\\{0, F_0 - F_{\\max}\\}$, where $F_0$ is the base flow and $F_{\\max}$ is the line's thermal limit.\n\nA curtailment action $c_i$ at bus $i$ reduces the net injection, and the total relief provided is $\\sum_{i=1}^N p_i c_i$. The constraints on curtailment are $0 \\le c_i \\le r_i$ for all $i$, and importantly, only buses with $p_i > 0$ are effective for relieving this specific congestion, so we must have $c_i = 0$ for all $i$ where $p_i \\le 0$. Let $I_+$ be the set of indices for which $p_i > 0$. The relief constraint is thus $\\sum_{i \\in I_+} p_i c_i \\ge D$.\n\nIf $D = 0$, no congestion exists, and no curtailment is necessary. In this trivial case, all calculated curtailment values will be $0$ and the fairness burden $\\phi$ will be $0$. The derivations below assume $D > 0$.\n\n### Task A: Efficiency-Based Curtailment\n\nThe objective is to minimize the total curtailed energy, $C_{total} = \\sum_{i \\in I_+} c_i$, while satisfying the relief constraint. The problem is formulated as a linear program:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad & \\sum_{i \\in I_+} c_i \\\\\n\\text{subject to} \\quad & \\sum_{i \\in I_+} p_i c_i \\ge D \\\\\n& 0 \\le c_i \\le r_i, \\quad \\forall i \\in I_+\n\\end{aligned}\n$$\nTo derive the solution from first principles, we analyze the efficiency of curtailment at each bus. The efficiency of a bus $i \\in I_+$ can be defined as the amount of congestion relief achieved per unit of energy curtailed. For a curtailment $c_i$, the relief is $p_i c_i$. The \"cost\" is $c_i$. The ratio of benefit (relief) to cost (curtailment) is $\\frac{p_i c_i}{c_i} = p_i$.\n\nTherefore, the PTDF value $p_i$ is a direct measure of the curtailment efficiency for bus $i$. To achieve the required relief $D$ with the minimum total curtailment $\\sum c_i$, we must prioritize curtailing from the most efficient buses—those with the highest $p_i$ values.\n\nThis leads to a greedy algorithm:\n1. Identify all buses $i \\in I_+$ (where $p_i > 0$).\n2. Sort these buses in descending order of their $p_i$ values.\n3. Iterate through the sorted buses, curtailing generation from each one until the cumulative relief meets or exceeds $D$. For each bus $j$ in the sorted sequence, we determine the necessary curtailment $c_j$. Let $D_{rem}$ be the remaining relief required. The curtailment at bus $j$ is $c_j = \\min\\left(r_j, \\frac{D_{rem}}{p_j}\\right)$. We update $D_{rem} \\leftarrow D_{rem} - p_j c_j$ and proceed to the next bus if $D_{rem} > 0$.\n\nThis greedy strategy is optimal because of the linear nature of the problem. Any deviation from this strategy, such as substituting a small amount of curtailment $\\delta c_k$ from a high-PTDF bus $k$ with curtailment from a low-PTDF bus $j$ ($p_j < p_k$), would be inefficient. To maintain the same relief $\\Delta F = p_k \\delta c_k$, the substituted curtailment at bus $j$ would have to be $\\delta c_j = \\frac{p_k}{p_j} \\delta c_k$. Since $p_k > p_j$, it follows that $\\delta c_j > \\delta c_k$, resulting in a larger total curtailment. This proves that an ascending-order curtailment plan is inherently less efficient than the descending-order plan, unless all available generation must be curtailed regardless of order.\n\nThe implementation will calculate the total curtailment for both the optimal (descending $p_i$) and the demonstrably inefficient (ascending $p_i$) strategies.\n\n### Task B: Fairness-Constrained Curtailment\n\nThis task imposes a fairness constraint: all contributing producers (those with $p_i > 0$) must be curtailed by the same proportion $\\phi \\in [0,1]$ of their available generation. This means $c_i = \\phi r_i$ for all $i \\in I_+$, and $c_i=0$ otherwise.\n\nWe need to find the minimal $\\phi$ that satisfies the relief constraint. We substitute the fairness-constrained curtailment into the relief inequality:\n$$\n\\sum_{i \\in I_+} p_i c_i \\ge D\n$$\n$$\n\\sum_{i \\in I_+} p_i (\\phi r_i) \\ge D\n$$\nSince $\\phi$ is a scalar constant across all buses in $I_+$, we can factor it out:\n$$\n\\phi \\left( \\sum_{i \\in I_+} p_i r_i \\right) \\ge D\n$$\nTo find the minimum possible value of $\\phi$ that satisfies the condition, we solve for the equality:\n$$\n\\phi = \\frac{D}{\\sum_{i \\in I_+} p_i r_i}\n$$\nThe problem statement guarantees that a feasible solution with $\\phi \\in [0,1]$ exists, which implies that the maximum possible relief, $\\sum_{i \\in I_+} p_i r_i$, is greater than or equal to $D$. If the denominator is zero, it must be that $D=0$, thus $\\phi=0$.\n\nThe total curtailment under this fairness-constrained allocation is the sum of individual curtailments:\n$$\nC_{total, fair} = \\sum_{i \\in I_+} c_i = \\sum_{i \\in I_+} \\phi r_i = \\phi \\sum_{i \\in I_+} r_i\n$$\nCombining the two expressions, we get:\n$$\nC_{total, fair} = \\left( \\frac{D}{\\sum_{j \\in I_+} p_j r_j} \\right) \\left( \\sum_{i \\in I_+} r_i \\right)\n$$\nThis provides a direct formula for the total curtailment under the fairness scheme.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the renewable curtailment problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        (np.array([0.9, 0.6, 0.1, -0.2, 0.0]), np.array([70, 50, 500, 20, 10]), 140.0, 110.0),\n        (np.array([0.7, 0.3, -0.2]), np.array([20, 10, 5]), 117.0, 100.0),\n        (np.array([0.5, 0.2, 0.0, -0.1]), np.array([10, 10, 100, 5]), 95.0, 100.0),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        p_vec, r_vec, f0, fmax = case\n        \n        # Calculate required congestion relief D\n        D = max(0.0, f0 - fmax)\n\n        if D == 0.0:\n            # No congestion, all curtailment values are zero.\n            all_results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n\n        # Filter for buses that can help relieve congestion (p_i > 0)\n        positive_p_mask = p_vec > 0\n        p_pos = p_vec[positive_p_mask]\n        r_pos = r_vec[positive_p_mask]\n\n        if len(p_pos) == 0:\n            # This case assumes feasibility, but as a safeguard.\n            # If no generators can help, curtailment is impossible. For this problem,\n            # this implies D=0, which is handled above.\n            all_results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n            \n        # --- Task A: Efficiency-based curtailment (Greedy, descending PTDF) ---\n        sorted_indices_desc = np.argsort(p_pos)[::-1]\n        p_sorted_desc = p_pos[sorted_indices_desc]\n        r_sorted_desc = r_pos[sorted_indices_desc]\n\n        total_curtailment_eff = 0.0\n        relief_needed = D\n        for p_i, r_i in zip(p_sorted_desc, r_sorted_desc):\n            max_relief_from_bus = p_i * r_i\n            if relief_needed > max_relief_from_bus:\n                total_curtailment_eff += r_i\n                relief_needed -= max_relief_from_bus\n            else:\n                curtailment_needed = relief_needed / p_i\n                total_curtailment_eff += curtailment_needed\n                relief_needed = 0.0\n                break\n        \n        # --- Inefficient curtailment (Greedy, ascending PTDF) ---\n        sorted_indices_asc = np.argsort(p_pos)\n        p_sorted_asc = p_pos[sorted_indices_asc]\n        r_sorted_asc = r_pos[sorted_indices_asc]\n\n        total_curtailment_ineff = 0.0\n        relief_needed_ineff = D\n        for p_i, r_i in zip(p_sorted_asc, r_sorted_asc):\n            max_relief_from_bus = p_i * r_i\n            if relief_needed_ineff > max_relief_from_bus:\n                total_curtailment_ineff += r_i\n                relief_needed_ineff -= max_relief_from_bus\n            else:\n                curtailment_needed = relief_needed_ineff / p_i\n                total_curtailment_ineff += curtailment_needed\n                relief_needed_ineff = 0.0\n                break\n\n        # --- Task B: Fairness-constrained allocation ---\n        max_possible_relief = np.sum(p_pos * r_pos)\n        \n        phi = 0.0\n        if max_possible_relief > 0:\n            phi = D / max_possible_relief\n        \n        total_renewable_at_pos_buses = np.sum(r_pos)\n        total_curtailment_fair = phi * total_renewable_at_pos_buses\n        \n        # Store results for the current test case with specified rounding\n        case_results = [\n            round(total_curtailment_eff, 3),\n            round(total_curtailment_ineff, 3),\n            round(phi, 6),\n            round(total_curtailment_fair, 3)\n        ]\n        all_results.append(case_results)\n\n    # Format final output string to match [[a,b,c,d],[e,f,g,h],...]\n    formatted_cases = []\n    for res_list in all_results:\n        # Format numbers to avoid trailing .0 for integers\n        formatted_list = [f\"{x:.3f}\" if i in [0,1,3] else f\"{x:.6f}\" for i, x in enumerate(res_list)]\n        inner_str = ','.join(formatted_list)\n        formatted_cases.append(f\"[{inner_str}]\")\n        \n    final_output_str = f\"[{','.join(formatted_cases)}]\"\n    print(final_output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Accurate modeling depends on accurate data, but real-world telemetry can contain subtle biases. This final practice addresses a critical issue in curtailment accounting: the distinction between grid-instructed curtailment and internal plant \"clipping\" due to AC inverter limits. You will generate synthetic data to demonstrate how using clipped availability data leads to a systematic underestimation of the true curtailment factor and then derive and implement a correction to recover the true value .",
            "id": "4116409",
            "problem": "A power plant modeled for renewable generation has hourly telemetry over a year of length $N = 8760$ hours. Let the plant have a Direct Current (DC) rating $R^{\\mathrm{DC}}$ measured in megawatts (MW) and an Alternating Current (AC) nameplate rating $R^{\\mathrm{AC}}$ measured in megawatts (MW). For each hour $t \\in \\{1,2,\\dots,N\\}$, define the following quantities:\n- The unconstrained potential power $P^{\\mathrm{pot}}_t$ in megawatts (MW), which is the power that would be produced absent any grid curtailment or AC conversion bottleneck.\n- A grid-dispatch curtailment cap $U_t$ in megawatts (MW), representing the maximum AC power allowed by the system operator in hour $t$, with $U_t = +\\infty$ signifying no curtailment cap.\n- The realized AC output $P^{\\mathrm{AC}}_t$ in megawatts (MW), taken to obey the physical constraints $P^{\\mathrm{AC}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}, U_t\\right)$.\n\nDefine the AC-limited availability telemetry as $A^{\\mathrm{clip}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}\\right)$ for each hour $t$. Using fundamental energy accounting with one-hour resolution $\\Delta t = 1$ hour, the annual energy available without AC clipping is $E^{\\mathrm{avail,true}} = \\sum_{t=1}^N P^{\\mathrm{pot}}_t \\Delta t$ measured in megawatt-hours (MWh), the annual energy delivered is $E^{\\mathrm{deliv}} = \\sum_{t=1}^N P^{\\mathrm{AC}}_t \\Delta t$ measured in megawatt-hours (MWh), and the annual energy curtailed on a true basis is $E^{\\mathrm{curt,true}} = \\sum_{t=1}^N \\max\\left(0, P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t\\right) \\Delta t$ measured in megawatt-hours (MWh). The plant-level true curtailment factor is\n$$\nCF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}}.\n$$\nAlternatively, if availability is reported with the AC-limited clipping, the annual clipped availability is $E^{\\mathrm{avail,clip}} = \\sum_{t=1}^N A^{\\mathrm{clip}}_t \\Delta t$ measured in megawatt-hours (MWh), the annual clipped curtailed energy is $E^{\\mathrm{curt,clip}} = \\sum_{t=1}^N \\max\\left(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t\\right) \\Delta t$ measured in megawatt-hours (MWh), and the clipped curtailment factor is\n$$\nCF^{\\mathrm{clip}} = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}}.\n$$\nThe bias induced by AC clipping in curtailment quantification is $B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}}$. Prove from first principles that $B \\le 0$, quantify $B$ in terms of the AC rating and the unconstrained potential, and design a correction that recovers $CF^{\\mathrm{true}}$ from $CF^{\\mathrm{clip}}$ when $P^{\\mathrm{pot}}_t$ and $R^{\\mathrm{AC}}$ are known.\n\nYour program must:\n- Generate deterministic synthetic hourly telemetry for one full year ($N = 8760$) for each test case as follows. Use a seasonally modulated diurnal shape to construct $P^{\\mathrm{pot}}_t$ that is physically plausible. Specifically, for hour index $h \\in \\{0,1,\\dots,8759\\}$, let the day-of-year be $d = \\lfloor h/24 \\rfloor + 1$ and the hour-of-day be $q = h \\bmod 24$. Define a seasonal factor\n$$\nS(d) = \\max\\left(0, \\min\\left(1, 0.6 + 0.4 \\cos\\left(\\frac{2\\pi (d - 172)}{365}\\right)\\right)\\right),\n$$\nand a diurnal factor\n$$\nD(q) = \\max\\left(0, \\cos\\left(\\frac{\\pi (q - 12)}{12}\\right)\\right)^{1.2}.\n$$\nThen set\n$$\nP^{\\mathrm{pot}}_t = R^{\\mathrm{DC}} \\cdot S(d) \\cdot D(q),\n$$\nwith $R^{\\mathrm{DC}}$ in megawatts (MW). For each hour, construct $U_t$ according to curtailment windows specified below, and compute $P^{\\mathrm{AC}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}, U_t\\right)$.\n- Compute $CF^{\\mathrm{true}}$, $CF^{\\mathrm{clip}}$, and $B$ for each test case. Express all curtailment factors as decimal numbers (for example, $0.125$), with no percentage sign.\n- Implement and apply the correction to recover $CF^{\\mathrm{true}}$ from clipped telemetry using the identity you derive, and verify numerically that the corrected value equals $CF^{\\mathrm{true}}$ to within numerical precision.\n\nUse the following test suite of parameter values that exercises a general case, no-clipping boundary, heavy-clipping case, and a pure clipping case with zero grid curtailment:\n- Test case $1$ (\"general\"): $R^{\\mathrm{DC}} = 120$ MW, $R^{\\mathrm{AC}} = 100$ MW, with grid curtailment caps $U_t = 70$ MW for all hours in days $d \\in \\{80,81,\\dots,110\\}$ and hours-of-day $q \\in \\{10,11,12,13,14,15\\}$, and $U_t = +\\infty$ otherwise.\n- Test case $2$ (\"no clipping\"): $R^{\\mathrm{DC}} = 100$ MW, $R^{\\mathrm{AC}} = 150$ MW, with grid curtailment caps $U_t = 60$ MW for all hours in days $d \\in \\{80,81,\\dots,110\\}$ and hours-of-day $q \\in \\{10,11,12,13,14,15\\}$, and $U_t = +\\infty$ otherwise.\n- Test case $3$ (\"heavy clipping\"): $R^{\\mathrm{DC}} = 160$ MW, $R^{\\mathrm{AC}} = 80$ MW, with grid curtailment caps $U_t = 50$ MW for all hours in days $d \\in \\{180,181,\\dots,210\\}$ and hours-of-day $q \\in \\{10,11,12,13,14,15\\}$, and $U_t = +\\infty$ otherwise.\n- Test case $4$ (\"pure clipping, no curtailment\"): $R^{\\mathrm{DC}} = 120$ MW, $R^{\\mathrm{AC}} = 100$ MW, with no grid curtailment caps, i.e., $U_t = +\\infty$ for all hours.\n\nAll power quantities must be in megawatts (MW), all energy quantities must be in megawatt-hours (MWh). Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as $[CF^{\\mathrm{true}}_1, CF^{\\mathrm{clip}}_1, B_1, CF^{\\mathrm{true}}_2, CF^{\\mathrm{clip}}_2, B_2, CF^{\\mathrm{true}}_3, CF^{\\mathrm{clip}}_3, B_3, CF^{\\mathrm{true}}_4, CF^{\\mathrm{clip}}_4, B_4]$, with each entry formatted as a decimal number.",
            "solution": "The problem as stated is valid. It is a well-posed, self-contained, and scientifically grounded exercise in energy systems analysis, specifically in the domain of renewable curtailment accounting. All terms are defined with mathematical precision, the data generation process is explicit, and the objectives—mathematical derivation and numerical verification—are standard scientific tasks. The problem is free of factual unsoundness, ambiguity, and subjectivity.\n\nThe central task is to analyze the systematic bias introduced when calculating curtailment losses using AC-limited availability data instead of the true, unconstrained potential power. Let the bias be $B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}}$. Our analysis will proceed by first deriving key identities for the energy components, then using these to prove $B \\le 0$ and quantify it, and finally deriving a formula to correct for this bias.\n\nFirst, we establish relationships between the primary energy quantities. All energy aggregates are calculated over $N = 8760$ hours with a time resolution of $\\Delta t = 1$ hour. Consequently, any annual energy quantity in MWh is numerically equal to the sum of the corresponding hourly power values in MW.\n\nThe hourly unconstrained potential power, $P^{\\mathrm{pot}}_t$, can be decomposed into two components: the portion that is within the AC inverter's capacity, $A^{\\mathrm{clip}}_t = \\min(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}})$, and the portion that exceeds it, which we define as the hourly clipping loss, $P^{\\mathrm{loss,clip}}_t$.\n$$P^{\\mathrm{loss,clip}}_t = \\max\\left(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}}\\right)$$\nBy definition, it follows that for every hour $t$:\n$$P^{\\mathrm{pot}}_t = \\min\\left(P^{\\mathrm{pot}}_t, R^{\\mathrm{AC}}\\right) + \\max\\left(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}}\\right) = A^{\\mathrm{clip}}_t + P^{\\mathrm{loss,clip}}_t$$\nSumming over all hours $t \\in \\{1, 2, \\dots, N\\}$ gives the relationship between the annual available energy metrics:\n$$E^{\\mathrm{avail,true}} = \\sum_{t=1}^N P^{\\mathrm{pot}}_t \\Delta t = \\sum_{t=1}^N A^{\\mathrm{clip}}_t \\Delta t + \\sum_{t=1}^N P^{\\mathrm{loss,clip}}_t \\Delta t = E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}$$\nwhere $E^{\\mathrm{loss,clip}}$ is the total annual energy lost due to AC inverter clipping.\n\nNext, we analyze the curtailed energy. The true hourly uncaptured power is the difference $P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t$. The clipped hourly uncaptured power is $A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t$. Using the decomposition of $P^{\\mathrm{pot}}_t$, we find:\n$$P^{\\mathrm{pot}}_t - P^{\\mathrm{AC}}_t = \\left(A^{\\mathrm{clip}}_t + P^{\\mathrm{loss,clip}}_t\\right) - P^{\\mathrm{AC}}_t = \\left(A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t\\right) + P^{\\mathrm{loss,clip}}_t$$\nSince $P^{\\mathrm{pot}}_t \\ge A^{\\mathrm{clip}}_t \\ge P^{\\mathrm{AC}}_t$, all terms in this identity are non-negative. The term $(A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t)$ represents the power curtailed by the grid operator (i.e., below the AC-limited availability), while $P^{\\mathrm{loss,clip}}_t$ represents power lost to AC clipping. The \"true\" uncaptured power is the sum of these two distinct loss mechanisms. Summing over all hours yields the relationship for annual curtailed energy:\n$$E^{\\mathrm{curt,true}} = E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}$$\n\nWith these fundamental identities, we can analyze the bias $B$:\n$$B = CF^{\\mathrm{clip}} - CF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} - \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}}$$\nSubstituting the derived identities for the \"true\" quantities gives:\n$$B = \\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} - \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\nTo prove that $B \\le 0$, we must show that $\\frac{E^{\\mathrm{curt,clip}}}{E^{\\mathrm{avail,clip}}} \\le \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$. Let $x = E^{\\mathrm{curt,clip}}$, $y = E^{\\mathrm{avail,clip}}$, and $z = E^{\\mathrm{loss,clip}}$. All three quantities are non-negative. Assuming non-trivial generation, $y > 0$. The inequality is $\\frac{x}{y} \\le \\frac{x+z}{y+z}$. Since the denominators are positive, we can cross-multiply:\n$$x(y+z) \\le y(x+z) \\implies xy + xz \\le yx + yz \\implies xz \\le yz$$\nThis inequality holds if $z=0$ or if $x \\le y$. The quantity $z = E^{\\mathrm{loss,clip}} \\ge 0$ by definition. To check if $x \\le y$, we compare $E^{\\mathrm{curt,clip}} = \\sum_t \\max(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t)\\Delta t$ and $E^{\\mathrm{avail,clip}} = \\sum_t A^{\\mathrm{clip}}_t \\Delta t$. Since $P^{\\mathrm{AC}}_t = \\min(A^{\\mathrm{clip}}_t, U_t) \\ge 0$, we have $\\max(0, A^{\\mathrm{clip}}_t - P^{\\mathrm{AC}}_t) \\le A^{\\mathrm{clip}}_t$ for all $t$. Summing over all hours confirms that $E^{\\mathrm{curt,clip}} \\le E^{\\mathrm{avail,clip}}$, i.e., $x \\le y$. Therefore, the condition $xz \\le yz$ is always satisfied, proving that $B \\le 0$. This confirms that calculating curtailment against a clipped availability baseline systematically underestimates (or at best, equals) the true curtailment factor. The equality $B=0$ holds if and only if $E^{\\mathrm{loss,clip}} \\cdot E^{\\mathrm{deliv}} = 0$, where $E^{\\mathrm{deliv}} = E^{\\mathrm{avail,clip}} - E^{\\mathrm{curt,clip}}$. This occurs if there is no clipping loss ($E^{\\mathrm{loss,clip}}=0$) or if no energy is delivered ($E^{\\mathrm{deliv}}=0$).\n\nThe quantification of $B$ in terms of the AC rating and unconstrained potential is given by the expression derived for $B$. The terms $E^{\\mathrm{curt,clip}}$, $E^{\\mathrm{avail,clip}}$, and $E^{\\mathrm{loss,clip}} = \\sum_t \\max(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}})\\Delta t$ all depend on $P^{\\mathrm{pot}}_t$ and $R^{\\mathrm{AC}}$.\n\nFinally, to design a correction that recovers $CF^{\\mathrm{true}}$, we start with its definition in terms of the decomposed energy quantities:\n$$CF^{\\mathrm{true}} = \\frac{E^{\\mathrm{curt,true}}}{E^{\\mathrm{avail,true}}} = \\frac{E^{\\mathrm{curt,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\nFrom the definition $CF^{\\mathrm{clip}} = E^{\\mathrm{curt,clip}} / E^{\\mathrm{avail,clip}}$, we can write $E^{\\mathrm{curt,clip}} = CF^{\\mathrm{clip}} \\cdot E^{\\mathrm{avail,clip}}$. Substituting this into the equation for $CF^{\\mathrm{true}}$ yields the correction formula:\n$$CF^{\\mathrm{true}} = \\frac{CF^{\\mathrm{clip}} \\cdot E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}{E^{\\mathrm{avail,clip}} + E^{\\mathrm{loss,clip}}}$$\nThis formula allows for the exact recovery of $CF^{\\mathrm{true}}$. To use it, one needs $CF^{\\mathrm{clip}}$ and $E^{\\mathrm{avail,clip}}$ (which can be calculated from AC-side telemetry, i.e., $A^{\\mathrm{clip}}_t$ and $P^{\\mathrm{AC}}_t$) and the total clipping loss $E^{\\mathrm{loss,clip}}$. The problem specifies that $P^{\\mathrm{pot}}_t$ and $R^{\\mathrm{AC}}$ are known, allowing for the direct calculation of $E^{\\mathrm{loss,clip}} = \\sum_t \\max(0, P^{\\mathrm{pot}}_t - R^{\\mathrm{AC}})\\Delta t$ and thus enabling the correction.\n\nThe numerical portion of this task involves implementing this framework to generate synthetic data and compute these quantities for the specified test cases. The implementation will construct the time series, calculate the aggregate energy totals, compute the curtailment factors and bias, and verify the correction formula.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the renewable curtailment modeling problem for a suite of test cases.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"general\",\n            \"R_DC\": 120.0,\n            \"R_AC\": 100.0,\n            \"curtail_cap\": 70.0,\n            \"curtail_day_range\": (80, 110),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"no clipping\",\n            \"R_DC\": 100.0,\n            \"R_AC\": 150.0,\n            \"curtail_cap\": 60.0,\n            \"curtail_day_range\": (80, 110),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"heavy clipping\",\n            \"R_DC\": 160.0,\n            \"R_AC\": 80.0,\n            \"curtail_cap\": 50.0,\n            \"curtail_day_range\": (180, 210),\n            \"curtail_hour_range\": (10, 15),\n        },\n        {\n            \"name\": \"pure clipping, no curtailment\",\n            \"R_DC\": 120.0,\n            \"R_AC\": 100.0,\n            \"curtail_cap\": np.inf,\n            \"curtail_day_range\": (0, 0), # No curtailment window\n            \"curtail_hour_range\": (0, 0),\n        },\n    ]\n\n    results = []\n    N = 8760\n    delta_t = 1.0  # hour\n\n    # Generate time indices\n    h = np.arange(N)\n    d = np.floor(h / 24).astype(int) + 1  # Day of year, 1 to 365\n    q = h % 24  # Hour of day, 0 to 23\n\n    for case in test_cases:\n        R_DC = case[\"R_DC\"]\n        R_AC = case[\"R_AC\"]\n\n        # Step 1: Generate synthetic telemetry\n        \n        # Seasonal factor S(d)\n        seasonal_factor = np.maximum(0, np.minimum(1, 0.6 + 0.4 * np.cos(2 * np.pi * (d - 172) / 365)))\n        \n        # Diurnal factor D(q)\n        diurnal_factor = np.maximum(0, np.cos(np.pi * (q - 12) / 12))**1.2\n        \n        # Unconstrained potential power P_pot_t\n        P_pot = R_DC * seasonal_factor * diurnal_factor\n\n        # Grid-dispatch curtailment cap U_t\n        U = np.full(N, np.inf)\n        if np.isfinite(case[\"curtail_cap\"]):\n            d_start, d_end = case[\"curtail_day_range\"]\n            q_start, q_end = case[\"curtail_hour_range\"]\n            curtailment_mask = (d >= d_start) & (d <= d_end) & (q >= q_start) & (q <= q_end)\n            U[curtailment_mask] = case[\"curtail_cap\"]\n\n        # Realized AC output P_AC_t\n        P_AC = np.minimum(P_pot, R_AC)\n        P_AC = np.minimum(P_AC, U)\n        \n        # AC-limited availability A_clip_t\n        A_clip = np.minimum(P_pot, R_AC)\n\n        # Step 2: Compute annual energy quantities\n        # Note: Since delta_t = 1, Energy (MWh) = sum of Power (MW)\n        E_avail_true = np.sum(P_pot)\n        E_avail_clip = np.sum(A_clip)\n        E_deliv = np.sum(P_AC)\n\n        # It is numerically more stable and definitionally equivalent to calculate\n        # curtailed energies from the delivered energy.\n        E_curt_true = E_avail_true - E_deliv\n        E_curt_clip = E_avail_clip - E_deliv\n        \n        # Step 3: Compute curtailment factors and bias\n        \n        # Handle division by zero for cases with no generation\n        CF_true = E_curt_true / E_avail_true if E_avail_true > 0 else 0.0\n        CF_clip = E_curt_clip / E_avail_clip if E_avail_clip > 0 else 0.0\n        \n        B = CF_clip - CF_true\n        \n        results.extend([CF_true, CF_clip, B])\n\n        # Step 4 (Numerical Verification): Apply correction to recover CF_true\n        # This part verifies the derived formula but is not part of the final output string itself.\n        E_loss_clip = E_avail_true - E_avail_clip\n        if (E_avail_clip + E_loss_clip) > 0:\n            CF_true_corrected = (CF_clip * E_avail_clip + E_loss_clip) / (E_avail_clip + E_loss_clip)\n            assert np.isclose(CF_true, CF_true_corrected), f\"Correction failed for case {case['name']}\"\n        else: # Trivial case of no generation\n            assert np.isclose(CF_true, 0.0)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}