{
    "hands_on_practices": [
        {
            "introduction": "在研究文化选择的影响之前，我们必须首先理解一个基准情形：当不存在选择压力时，文化特征在群体中如何演变。本练习将引导您通过分析经典的 Wright-Fisher 模型来探索文化漂变（cultural drift）这一随机过程。您将推导出一个基础性结论，即一个中性文化变体的最终固定概率等于其在群体中的初始频率，这个结论对于理解有限群体中的随机效应至关重要。",
            "id": "2699390",
            "problem": "考虑一个大小恒定为 $N$ 的有限群体，该群体在没有创新的情况下，根据文化传播的赖特-费雪复制模型演化。时间是离散的，由 $t \\in \\{0,1,2,\\dots\\}$ 索引，每一代 $t+1$ 都是通过从第 $t$ 代中有放回地抽样 $N$ 个文化亲本形成的，每次抽样都从第 $t$ 代的 $N$ 个个体中均匀选择一个亲本。存在两种文化变体，记为 $A$ 和 $B$。令 $X_t \\in \\{0,1,\\dots,N\\}$ 为第 $t$ 代中携带变体 $A$ 的个体数量，令 $x_t = X_t/N$ 为相应的频率。假设中性和无创新：在每次抽样中，亲本都是独立且均匀地选择的，因此在给定 $X_t=i$ 的条件下，$X_{t+1}$ 的分布是 $\\mathrm{Binomial}(N, i/N)$。\n\n定义固化概率 $\\phi(i;N)$ 为从 $X_0=i$ 开始，变体 $A$ 最终达到频率 $1$（即 $X_t$ 达到吸收态 $N$）的概率。等价地，定义 $\\phi(x_0;N)$，其中 $x_0=i/N$。\n\n仅使用上述基本定义，推导固化概率 $\\phi(x_0;N)$ 的一个闭式表达式，该表达式是初始频率 $x_0 \\in [0,1]$ 和群体大小 $N$ 的函数。将你的最终答案表示为单个解析表达式。不需要四舍五入，也不涉及单位。",
            "solution": "问题要求在一个大小为 $N$ 的有限群体中，一个中性文化变体在赖特-费雪模型下演化时的固化概率。令 $X_t$ 为第 $t$ 代携带变体 $A$ 的个体数量，令 $x_t = X_t/N$ 为该变体的频率。该过程从初始数量 $X_0=i$ 开始，对应的初始频率为 $x_0 = i/N$。我们的任务是找到变体 $A$ 最终固化的概率，即其频率达到 $1$。这个概率记为 $\\phi(x_0;N)$。\n\n该过程的状态空间是 $\\{0, 1, \\dots, N\\}$。状态 $0$ 和 $N$ 是吸收态，分别对应于变体 $A$ 的丢失和固化。该过程根据转移规则演化，即在给定 $X_t=k$ 的条件下，下一代中携带 $A$ 的个体数量 $X_{t+1}$ 服从二项分布：\n$$ X_{t+1} | (X_t = k) \\sim \\mathrm{Binomial}(N, k/N) $$\n\n解决此问题的一个直接而严谨的方法是分析频率过程 $\\{x_t\\}_{t \\geq 0}$ 的性质。我们将证明，在指定的中性模型下，该变体的频率是一个鞅。如果一个过程 $\\{Y_t\\}$ 满足 $\\mathbb{E}[Y_{t+1} | Y_t, Y_{t-1}, \\dots, Y_0] = Y_t$，则它是一个鞅。\n\n让我们计算在给定时间 $t$ 的状态下，$x_{t+1}$ 的条件期望。假设在时间 $t$，状态为 $X_t = i$。频率为 $x_t = i/N$。在时间 $t+1$ 时，携带 $A$ 的个体的期望数量是一个 $\\mathrm{Binomial}(N, p=i/N)$ 随机变量的期望。二项分布 $\\mathrm{Binomial}(n,p)$ 的期望是 $np$。因此，\n$$ \\mathbb{E}[X_{t+1} | X_t = i] = N \\cdot \\left(\\frac{i}{N}\\right) = i $$\n现在我们可以求出时间 $t+1$ 时的期望频率：\n$$ \\mathbb{E}[x_{t+1} | X_t = i] = \\mathbb{E}\\left[\\frac{X_{t+1}}{N} \\Big| X_t = i\\right] = \\frac{1}{N} \\mathbb{E}[X_{t+1} | X_t = i] = \\frac{i}{N} $$\n由于我们已定义 $x_t = i/N$，这表明 $\\mathbb{E}[x_{t+1} | x_t] = x_t$。这个等式证实了频率过程 $\\{x_t\\}$ 是一个鞅。\n\n当过程达到其中一个吸收边界，即 $x_t=0$（丢失）或 $x_t=1$（固化）时，过程停止。令 $T$ 为该过程的停止时间，定义为：\n$$ T = \\inf\\{t \\geq 0 : x_t = 0 \\text{ or } x_t = 1\\} $$\n对于一个有限群体 $N$，最终被其中一个状态吸收是必然的，这意味着停止时间 $T$ 几乎必然是有限的。鞅 $\\{x_t\\}$ 是有界的，因为它的值始终在区间 $[0,1]$ 内。\n\n这些条件——一个有界鞅和一个几乎必然有限的停止时间——使我们能够应用可选停止定理。该定理指出，鞅在停止时间的期望值等于其初始值：\n$$ \\mathbb{E}[x_T] = x_0 $$\n过程在停止时间 $T$ 的值 $x_T$ 是一个随机变量，它只能取两个值之一：如果变体 $A$ 固化，则为 $1$；如果丢失，则为 $0$。固化概率正是我们想要找到的 $\\phi(x_0;N)$。因此，\n$$ P(x_T = 1) = \\phi(x_0;N) $$\n而丢失的概率是：\n$$ P(x_T = 0) = 1 - \\phi(x_0;N) $$\n期望 $\\mathbb{E}[x_T]$ 可以根据其定义计算：\n$$ \\mathbb{E}[x_T] = (1) \\cdot P(x_T = 1) + (0) \\cdot P(x_T = 0) = 1 \\cdot \\phi(x_0;N) + 0 \\cdot (1 - \\phi(x_0;N)) = \\phi(x_0;N) $$\n通过令 $\\mathbb{E}[x_T]$ 的两个表达式相等，我们得到最终结果：\n$$ \\phi(x_0;N) = x_0 $$\n这个结果展示了群体遗传学的一个基本原理：在没有选择、突变或迁移的情况下，一个中性等位基因或文化变体最终在群体中固化的概率等于其初始频率。这个结果与群体大小 $N$ 无关。给定初始频率 $x_0 = i/N$，固化概率就是 $i/N$。",
            "answer": "$$\\boxed{x_{0}}$$"
        },
        {
            "introduction": "与随机漂变不同，文化特征的传播通常会受到其自身内容或相关社会互动收益的影响，这便是文化选择。本练习使用演化博弈论中的核心工具——复制子动态（replicator dynamics），来模拟一个典型的协调博弈场景，即个体采用与他人相同的特征时能获得更高收益。通过分析该模型，您将学习如何确定演化稳定点，并理解初始条件如何决定文化的最终走向。",
            "id": "4119283",
            "problem": "考虑一个大型、均匀混合的群体，其中个体携带两种文化性状中的一种，标记为 $T_{1}$ 和 $T_{2}$。当个体互动时，他们获得的收益由一个对称协调博弈决定，其收益矩阵为 $A$，其中 $A_{11}=a$, $A_{22}=a$, 以及 $A_{12}=A_{21}=b$，且 $b  a$。该群体的文化动态由连续时间的复制子动态（replicator dynamics）描述。设 $x$ 为携带性状 $T_{1}$ 的个体在群体中的频率。\n你的任务是确定 $x \\in (0,1)$ 的哪个值充当了将群体引向两种不同演化结果（即 $T_1$ 固化或 $T_2$ 固化）的临界点或“分界线”（separatrix）。你的答案应该是一个数值。",
            "solution": "该问题要求在由复制子动态描述的协调博弈中，找到两种文化性状之间的演化分界线。\n\n设性状 $T_1$ 的频率为 $x$，则性状 $T_2$ 的频率为 $1-x$。根据给定的收益矩阵 $A = \\begin{pmatrix} a  b \\\\ b  a \\end{pmatrix}$，我们可以计算出携带每种性状的个体的平均收益（适应度）：\n- 携带 $T_1$ 的个体的期望收益为：$\\pi_1 = x \\cdot a + (1-x) \\cdot b$\n- 携带 $T_2$ 的个体的期望收益为：$\\pi_2 = x \\cdot b + (1-x) \\cdot a$\n\n群体的平均收益为 $\\bar{\\pi} = x \\pi_1 + (1-x) \\pi_2$。\n\n连续形式的复制子动态方程由下式给出：\n$$ \\dot{x} = \\frac{dx}{dt} = x (\\pi_1 - \\bar{\\pi}) $$\n我们可以将其展开为更易于分析的形式：\n$$ \\dot{x} = x(1-x)(\\pi_1 - \\pi_2) $$\n这个形式直观地表明，如果性状 $T_1$ 的收益高于 $T_2$，其频率 $x$ 将会增加（假设 $0  x  1$），反之亦然。\n\n现在，我们计算收益差：\n$$ \\pi_1 - \\pi_2 = (ax + b(1-x)) - (bx + a(1-x)) = ax + b - bx - bx - a + ax = 2ax - 2bx + b - a = (a-b)(2x-1) $$\n将这个差值代入复制子方程：\n$$ \\dot{x} = x(1-x)(a-b)(2x-1) $$\n我们需要找到方程的稳态（不动点），即 $\\dot{x} = 0$ 的点。这发生在以下三种情况：\n1.  $x = 0$ (群体完全由 $T_2$ 组成)\n2.  $x = 1$ (群体完全由 $T_1$ 组成)\n3.  $2x - 1 = 0 \\implies x = 1/2$\n\n为了确定哪个点是分界线，我们需要分析内部不动点 $x^* = 1/2$ 的稳定性。由于问题给定 $a  b$，因此项 $(a-b)$ 是正数。\n- 当 $x  1/2$ 时，$2x-1  0$，所以 $\\dot{x}  0$。频率 $x$ 会朝向 $1$ 增加。\n- 当 $x  1/2$ 时，$2x-1  0$，所以 $\\dot{x}  0$。频率 $x$ 会朝向 $0$ 减少。\n\n这表明 $x=1/2$ 是一个不稳定的不动点。任何偏离这一点的微小扰动都会导致系统演化到两个稳定状态之一（$x=0$ 或 $x=1$）。因此，$x=1/2$ 正是分隔两个演化结果（$T_1$ 固化或 $T_2$ 固化）的盆地的边界，即分界线。",
            "answer": "$$\\boxed{\\frac{1}{2}}$$"
        },
        {
            "introduction": "理论模型为我们提供了深刻的洞见，但如何将这些思想应用于真实的或模拟的数据呢？本练习将指导您应用强大的 Price 方程框架，将观察到的总体文化变迁分解为不同部分。您将通过编程实践，从原始数据中量化文化选择（即不同个体被模仿的差异）和传递偏误（即学习过程中的系统性改变）的相对贡献，从而掌握连接理论与实证分析的关键技能。",
            "id": "2699362",
            "problem": "给定一个种群在单个代际步骤中的个体层面文化数据，该种群包含一组文化模型（亲代）和一组学习者。每个学习者选择一个模型进行学习，并获得一个可能被修改的性状值。您的任务是计算种群层面文化变迁的两个组成部分，这两个部分将平均性状值的变化划分为一个可归因于文化选择（模型的差异化影响）的成分和一个可归因于传播偏误（学习过程中系统性的谱系内变化）的成分。\n\n基本原理和定义：\n- 设有 $N$ 个模型，由 $i \\in \\{1,\\dots,N\\}$ 索引，每个模型具有性状值 $z_i \\in \\mathbb{R}$。设模型的平均性状为 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。\n- 设有 $M$ 个学习者，由 $j \\in \\{1,\\dots,M\\}$ 索引。每个学习者 $j$ 精确选择一个模型 $m(j) \\in \\{1,\\dots,N\\}$，并在学习后获得性状 $z'_j \\in \\mathbb{R}$。\n- 模型 $i$ 的文化影响（学习者数量）为 $w_i = \\left| \\{ j : m(j) = i \\} \\right|$。平均影响为 $\\bar{w} = \\frac{1}{N} \\sum_{i=1}^N w_i$。注意，$\\sum_{i=1}^N w_i = M$ 意味着 $\\bar{w} = M / N$。\n- 定义每个模型的学习者平均值 $\\mu_i$ 如下：若 $w_i  0$，则 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$；若 $w_i = 0$，则采用约定 $\\mu_i = z_i$，这样 $\\mu_i - z_i = 0$ 对传播偏误无贡献。\n\n您的程序必须为每个提供的数据集计算：\n1. 文化选择协方差项 $S$，定义为相对影响和模型性状之间的协方差，\n$$\nS \\equiv \\operatorname{Cov}\\!\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) \\;=\\; \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right)\\left(z_i - \\bar{z}\\right).\n$$\n2. 传播偏误项 $T$，定义为按相对影响加权的期望谱系内变化，\n$$\nT \\equiv \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right)\\left(\\mu_i - z_i\\right).\n$$\n3. 在该代际步骤中平均性状的总变化，\n$$\n\\Delta \\bar{z} \\equiv \\left(\\frac{1}{M}\\sum_{j=1}^M z'_j\\right) - \\bar{z}.\n$$\n4. 一个解释代码，用以指示哪个成分的绝对值更大。设 $\\varepsilon = 10^{-9}$。定义\n$$\nd \\equiv \\left|S\\right| - \\left|T\\right|.\n$$\n每个数据集返回一个整数代码，规则如下：如果 $d  \\varepsilon$，返回 $1$（选择的绝对值超过传播）；如果 $d  -\\varepsilon$，返回 $-1$（传播的绝对值超过选择）；否则返回 $0$（在容差范围内，绝对值相当）。\n\n每个数据集的输入规范：\n- $N$ 和模型性状向量 $\\mathbf{z} = [z_1,\\dots,z_N]$。\n- 学习者到模型的索引向量 $\\mathbf{m} = [m(1),\\dots,m(M)]$，其索引从零开始，位于 $\\{0,\\dots,N-1\\}$ 集合中。\n- 学习后的学习者性状向量 $\\mathbf{z}' = [z'_1,\\dots,z'_M]$。\n所有量均为无量纲实数。\n\n测试套件：\n为以下四个数据集提供结果。$\\mathbf{m}$ 中的索引是从零开始的。\n\n- 数据集 A：\n  - $N = 4$。\n  - $\\mathbf{z} = [0.0, 1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 3, 3, 3, 3, 3]$。\n  - $\\mathbf{z}' = [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9]$。\n\n- 数据集 B：\n  - $N = 3$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0]$。\n  - $\\mathbf{m} = [0, 0, 1, 1, 2, 2]$。\n  - $\\mathbf{z}' = [1.3, 1.3, 2.0, 2.0, 2.8, 2.8]$。\n\n- 数据集 C：\n  - $N = 3$。\n  - $\\mathbf{z} = [0.0, 1.0, 3.0]$。\n  - $\\mathbf{m} = [0, 1, 1, 2, 2, 2]$。\n  - $\\mathbf{z}' = [0.0, 1.0, 1.0, 3.0, 3.0, 3.0]$。\n\n- 数据集 D：\n  - $N = 4$。\n  - $\\mathbf{z} = [1.0, 2.0, 3.0, 4.0]$。\n  - $\\mathbf{m} = [1, 2, 3, 3]$。\n  - $\\mathbf{z}' = [1.9, 3.2, 3.7, 3.9]$。\n\n输出规范：\n- 对于每个数据集，输出一个形式为 $[S, T, \\Delta\\bar{z}, \\text{code}]$ 的列表，其中 $S$、$T$ 和 $\\Delta\\bar{z}$ 是四舍五入到六位小数的浮点数，而 $\\text{code}$ 是如上定义的整数。\n- 您的程序应生成单行输出，其中包含所有数据集的结果，形式为一个由这些列表组成的、以逗号分隔的列表，并用方括号括起来。例如，输出格式必须是\n$[[S_A,T_A,\\Delta\\bar{z}_A,\\text{code}_A],[S_B,T_B,\\Delta\\bar{z}_B,\\text{code}_B],[S_C,T_C,\\Delta\\bar{z}_C,\\text{code}_C],[S_D,T_D,\\Delta\\bar{z}_D,\\text{code}_D]]$\n并应用所需的四舍五入。",
            "solution": "所述问题已经过严格验证。它被认为是一个有效、适定且有科学依据的练习。所要求的定义和计算是 Price 方程框架的直接应用，该框架是演化分析的基石，并被改编用于文化演化研究。所有术语都以数学精度定义，所提供的数据是自洽的，目标是明确的。不存在逻辑矛盾或事实错误。我们将着手推导解答。\n\n核心任务是将种群平均性状值的总变化 $\\Delta\\bar{z}$ 划分为两个部分：一个选择成分 $S$ 和一个传播偏误成分 $T$。问题为这三个量提供了定义。一个基本的一致性检验是证明总变化实际上是这两个成分之和，即 $\\Delta\\bar{z} = S + T$。该恒等式构成了我们分析的基础。\n\n让我们从给出的定义开始。$N$ 个模型的平均性状是 $\\bar{z} = \\frac{1}{N} \\sum_{i=1}^N z_i$。下一代 $M$ 个学习者的平均性状是 $\\bar{z}' = \\frac{1}{M}\\sum_{j=1}^M z'_j$。总变化是 $\\Delta\\bar{z} = \\bar{z}' - \\bar{z}$。\n\n我们可以通过将学习者按照他们选择的模型 $m(j)$ 分组来表示 $\\bar{z}'$。选择模型 $i$ 的学习者数量是其影响 $w_i$。选择模型 $i$ 的学习者的性状值之和是 $\\sum_{j : m(j) = i} z'_j$。根据定义，对于 $w_i > 0$，每个模型的学习者平均值为 $\\mu_i = \\frac{1}{w_i} \\sum_{j : m(j) = i} z'_j$。因此，$\\sum_{j : m(j) = i} z'_j = w_i \\mu_i$。即使当 $w_i=0$ 时，这个关系也成立，因为等式两边都为零。学习者性状的总和是 $\\sum_{j=1}^M z'_j = \\sum_{i=1}^N \\sum_{j : m(j) = i} z'_j = \\sum_{i=1}^N w_i \\mu_i$。\n\n将此代入 $\\bar{z}'$ 的表达式中：\n$$\n\\bar{z}' = \\frac{1}{M} \\sum_{i=1}^N w_i \\mu_i\n$$\n平均影响为 $\\bar{w} = \\sum_{i=1}^N w_i / N = M/N$。因此，$M = N\\bar{w}$。用此替换 $M$：\n$$\n\\bar{z}' = \\frac{1}{N\\bar{w}} \\sum_{i=1}^N w_i \\mu_i = \\frac{1}{N} \\sum_{i=1}^N \\frac{w_i}{\\bar{w}} \\mu_i\n$$\n现在，我们可以将总变化 $\\Delta\\bar{z}$ 写为：\n$$\n\\Delta\\bar{z} = \\bar{z}' - \\bar{z} = \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\bar{z}\n$$\n为了划分这个变化，我们通过加上和减去 $\\frac{1}{N} \\sum_{i=1}^N (\\frac{w_i}{\\bar{w}}) z_i$ 这一项来引入它：\n$$\n\\Delta\\bar{z} = \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) \\mu_i - \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i \\right) + \\left( \\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) z_i - \\bar{z} \\right)\n$$\n让我们分析括号中的两项。第一项可以写成：\n$$\n\\frac{1}{N} \\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}}\\right) (\\mu_i - z_i)\n$$\n这正是传播偏误项 $T$ 的定义。它表示从模型到学习者的性状值的平均变化，并按每个模型的相对影响加权。当 $w_i = 0$ 时，约定 $\\mu_i = z_i$ 确保了没有学习者的模型对此项没有贡献。\n\n第二项可以被识别为相对影响 $\\frac{w_i}{\\bar{w}}$ 和模型性状 $z_i$ 之间的协方差。一个变量 $X_i$ 在模型群体上的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N X_i$。协方差是 $\\operatorname{Cov}(X, Y) = E[(X-E[X])(Y-E[Y])]$。令 $X_i = \\frac{w_i}{\\bar{w}}$ 和 $Y_i = z_i$。那么 $E[Y] = \\bar{z}$。$X_i$ 的期望是 $E[X] = \\frac{1}{N}\\sum_{i=1}^N \\frac{w_i}{\\bar{w}} = \\frac{1}{N\\bar{w}}\\sum_{i=1}^N w_i = \\frac{M}{N(M/N)} = 1$。第二项是 $E[XY] - \\bar{z} = E[XY] - E[X]E[Y]$，也就是 $\\operatorname{Cov}(X,Y)$。展开此式得到：\n$$\n\\operatorname{Cov}\\left(\\frac{w_i}{\\bar{w}}, z_i\\right) = \\frac{1}{N}\\sum_{i=1}^N \\left(\\frac{w_i}{\\bar{w}} - 1\\right) (z_i - \\bar{z})\n$$\n这正是文化选择项 $S$ 的定义。它衡量了模型的性状值与其文化影响之间的统计关联。\n\n因此，我们证明了恒等式 $\\Delta\\bar{z} = S + T$。总变化被完美地划分了。计算步骤如下：\n\n对于每个数据集（$N$, $\\mathbf{z}$, $\\mathbf{m}$, $\\mathbf{z}'$）：\n1.  计算平均模型性状 $\\bar{z} = \\frac{1}{N}\\sum z_i$。\n2.  根据 $\\mathbf{m}$ 的长度确定学习者数量 $M$。\n3.  计算影响向量 $\\mathbf{w}$，其中 $w_i$ 是模型索引 $i$ 在 $\\mathbf{m}$ 中出现的次数。$\\mathbf{m}$ 中的索引是从零开始的，即 $\\{0, \\dots, N-1\\}$。\n4.  计算平均影响 $\\bar{w} = M/N$。\n5.  确定每个模型的学习者平均值向量 $\\boldsymbol{\\mu}$。对于每个模型 $i$，如果 $w_i  0$，则 $\\mu_i$ 是所有选择模型 $i$ 的学习者 $j$ 的 $z'_j$ 的平均值。如果 $w_i = 0$，则将 $\\mu_i$ 设为 $z_i$。\n6.  计算选择项 $S = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}} - 1)(z_i - \\bar{z})$。\n7.  计算传播偏误项 $T = \\frac{1}{N}\\sum_{i=0}^{N-1} (\\frac{w_i}{\\bar{w}})(\\mu_i - z_i)$。\n8.  计算总变化 $\\Delta\\bar{z} = (\\frac{1}{M}\\sum z'_j) - \\bar{z}$。作为验证，必须确认 $S + T$ 约等于 $\\Delta\\bar{z}$。\n9.  计算绝对值差异 $d = |S| - |T|$，并根据给定的容差 $\\varepsilon = 10^{-9}$ 确定解释代码。如果 $d  \\varepsilon$，代码为 $1$；如果 $d  -\\varepsilon$，代码为 $-1$；否则，代码为 $0$。\n10. 将结果格式化为列表 $[S, T, \\Delta\\bar{z}, \\text{code}]$，其中浮点数四舍五入到六位小数。\n\n该算法将被实现以处理所提供的测试套件。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the cultural evolution problem for all given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Dataset A\n        {\n            \"N\": 4,\n            \"z_models\": [0.0, 1.0, 2.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 3, 3, 3, 3, 3],\n            \"z_prime_learners\": [0.2, 1.0, 1.0, 1.9, 1.9, 2.8, 2.8, 2.8, 2.9, 2.9],\n        },\n        # Dataset B\n        {\n            \"N\": 3,\n            \"z_models\": [1.0, 2.0, 3.0],\n            \"m_learners\": [0, 0, 1, 1, 2, 2],\n            \"z_prime_learners\": [1.3, 1.3, 2.0, 2.0, 2.8, 2.8],\n        },\n        # Dataset C\n        {\n            \"N\": 3,\n            \"z_models\": [0.0, 1.0, 3.0],\n            \"m_learners\": [0, 1, 1, 2, 2, 2],\n            \"z_prime_learners\": [0.0, 1.0, 1.0, 3.0, 3.0, 3.0],\n        },\n        # Dataset D\n        {\n            \"N\": 4,\n            \"z_models\": [1.0, 2.0, 3.0, 4.0],\n            \"m_learners\": [1, 2, 3, 3],\n            \"z_prime_learners\": [1.9, 3.2, 3.7, 3.9],\n        },\n    ]\n\n    results_str_list = []\n    for case in test_cases:\n        s, t, delta_z, code = calculate_components(\n            case[\"N\"],\n            case[\"z_models\"],\n            case[\"m_learners\"],\n            case[\"z_prime_learners\"]\n        )\n        \n        # Format the output for the current case\n        s_str = f\"{s:.6f}\"\n        t_str = f\"{t:.6f}\"\n        delta_z_str = f\"{delta_z:.6f}\"\n        \n        result_str = f\"[{s_str},{t_str},{delta_z_str},{code}]\"\n        results_str_list.append(result_str)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results_str_list)}]\")\n\ndef calculate_components(N_models, z_models_list, m_learners_list, z_prime_learners_list):\n    \"\"\"\n    Computes S, T, delta_z, and the interpretation code for a single dataset.\n    \"\"\"\n    \n    # Convert lists to numpy arrays for vectorized operations\n    z_models = np.array(z_models_list, dtype=float)\n    m_learners = np.array(m_learners_list, dtype=int)\n    z_prime_learners = np.array(z_prime_learners_list, dtype=float)\n    \n    # Number of learners\n    M_learners = len(m_learners)\n\n    # 1. Compute model-level quantities\n    z_bar = np.mean(z_models)\n\n    # 2. Compute learner-level and linking quantities\n    # Influence of each model (number of learners choosing each model)\n    w = np.bincount(m_learners, minlength=N_models)\n    \n    # Mean influence\n    if N_models > 0:\n        w_bar = M_learners / N_models\n    else:\n        w_bar = 0\n\n    # 3. Calculate per-model learner mean mu\n    mu = np.zeros(N_models, dtype=float)\n    for i in range(N_models):\n        if w[i] > 0:\n            learners_of_model_i = z_prime_learners[m_learners == i]\n            mu[i] = np.mean(learners_of_model_i)\n        else:\n            # Convention: if w_i = 0, mu_i = z_i\n            mu[i] = z_models[i]\n\n    # Handle case where all models have zero influence\n    if w_bar == 0:\n        rel_w = np.zeros(N_models, dtype=float)\n    else:\n        rel_w = w / w_bar\n\n    # 4. Calculate S (Selection)\n    # S = (1/N) * sum((w_i/w_bar - 1) * (z_i - z_bar))\n    s_term_per_model = (rel_w - 1) * (z_models - z_bar)\n    S = np.mean(s_term_per_model)\n\n    # 5. Calculate T (Transmission)\n    # T = (1/N) * sum((w_i/w_bar) * (mu_i - z_i))\n    t_term_per_model = rel_w * (mu - z_models)\n    T = np.mean(t_term_per_model)\n\n    # 6. Calculate Delta z_bar (Total Change)\n    if M_learners > 0:\n        z_prime_bar = np.mean(z_prime_learners)\n    else:\n        z_prime_bar = z_bar # No learners, no change\n    delta_z_bar = z_prime_bar - z_bar\n\n    # 7. Calculate the interpretation code\n    epsilon = 1e-9\n    d = abs(S) - abs(T)\n    if d > epsilon:\n        code = 1\n    elif d  -epsilon:\n        code = -1\n    else:\n        code = 0\n        \n    return S, T, delta_z_bar, code\n\n# Execute the main function\nsolve()\n```"
        }
    ]
}