{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的多层次模型之前，理解其必要性至关重要。当数据天然地具有分组结构时，直接忽略这种结构进行汇总分析可能会得出完全错误的结论。这个练习将通过一个具体的计算任务，直观地展示著名的“辛普森悖论”，即在分组数据中观察到的趋势与汇总数据后观察到的趋势完全相反。通过亲手计算，您将深刻体会到在分析复杂系统时，识别并恰当处理数据层次结构的重要性，从而为多层次建模建立坚实的直觉基础。",
            "id": "4131281",
            "problem": "考虑一个由两个相互作用的子系统（标记为 $L$ 组和 $H$ 组）组成的复杂自适应系统，每个组由 $g \\in \\{L, H\\}$ 内索引为 $i$ 的个体构成。对于每个个体，我们观察到一个个体层面的预测变量 $x_{ig}$ 和一个结果变量 $y_{ig}$。记录了以下数据集：\n- $L$ 组：当 $i \\in \\{1, 2, 3\\}$ 时，$(x_{iL}, y_{iL})$ 分别为 $(1, 9), (2, 7)$ 和 $(3, 5)$。\n- $H$ 组：当 $i \\in \\{1, 2, 3\\}$ 时，$(x_{iH}, y_{iH})$ 分别为 $(8, 20), (9, 18)$ 和 $(10, 16)$。\n\n将每个组视为具有不同基线属性的子系统，并将 $x_{ig}$ 与 $y_{ig}$ 之间的组内关系解释为微观层面效应。聚合关系忽略了分组信息，将两组中的所有个体汇集到单个数据集中，这代表了宏观层面效应。\n\n使用线性关联的基本定义，确定 $y_{ig}$ 对 $x_{ig}$ 的组内回归的普通最小二乘法斜率的符号（假设各组符号相同），以及在忽略分组信息时，$y$ 对 $x$ 的聚合回归的普通最小二乘法斜率的符号。哪个选项正确地报告了这两个符号？\n\nA. 组内斜率为负；聚合斜率为正。\n\nB. 组内斜率为正；聚合斜率为负。\n\nC. 组内斜率和聚合斜率均为负。\n\nD. 组内斜率和聚合斜率均为正。",
            "solution": "该问题要求在一个分层系统的两个不同层面上分析线性关联：组内（微观）层面和聚合（宏观）层面。由普通最小二乘法（OLS）回归所确定的线性关联的符号，取决于预测变量和结果变量之间的样本协方差的符号。\n\n对于 $y$ 对 $x$ 的回归，OLS 斜率系数 $\\beta$ 的公式如下：\n$$ \\beta = \\frac{\\text{Cov}(x, y)}{\\text{Var}(x)} = \\frac{\\sum_{i=1}^n (x_i - \\bar{x})(y_i - \\bar{y})}{\\sum_{i=1}^n (x_i - \\bar{x})^2} $$\n由于分母中的方差 $\\text{Var}(x)$ 是一个平方和，它总是非负的（且对于非恒定的 $x$ 而言是严格为正的）。因此，斜率 $\\beta$ 的符号完全由样本协方差 $\\text{Cov}(x, y)$ 的符号决定。\n\n首先，我们将验证问题陈述。\n\n### 步骤 1：提取已知条件\n- 系统：一个包含两个子系统（$L$ 组和 $H$ 组）的复杂自适应系统。\n- 组：$g \\in \\{L, H\\}$。\n- 个体索引：$i$。\n- 个体层面预测变量：$x_{ig}$。\n- 个体层面结果变量：$y_{ig}$。\n- $L$ 组数据集：对于 $i \\in \\{1, 2, 3\\}$，$(x_{iL}, y_{iL})$ 分别为 $(1, 9), (2, 7)$ 和 $(3, 5)$。\n- $H$ 组数据集：对于 $i \\in \\{1, 2, 3\\}$，$(x_{iH}, y_{iH})$ 分别为 $(8, 20), (9, 18)$ 和 $(10, 16)$。\n- 微观层面效应：$x_{ig}$ 与 $y_{ig}$ 之间的组内关系。\n- 宏观层面效应：所有个体被汇集后的聚合关系。\n- 任务：确定组内回归（假设符号相同）和聚合回归的 OLS 斜率的符号。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在统计学上具有科学依据，特别是在多层次模型和被称为辛普森悖论的现象的背景下。OLS 回归、协方差和聚合等概念都是定义明确的数学和统计学原理。该问题提法恰当，提供了计算所需量值的全部必要数据。语言客观而精确。数据内部一致，不违反任何数学或逻辑原理。该问题是统计学中一个标准的、可形式化的问题。\n\n### 步骤 3：结论与行动\n问题陈述是有效的。我们继续进行解答。\n\n### 斜率的推导\n\n**1. 组内斜率（微观层面）**\n\n我们将确定每个组的协方差的符号。\n\n**对于 L 组：**\n数据点为 $(1, 9), (2, 7), (3, 5)$。\n样本均值为：\n$$ \\bar{x}_L = \\frac{1+2+3}{3} = \\frac{6}{3} = 2 $$\n$$ \\bar{y}_L = \\frac{9+7+5}{3} = \\frac{21}{3} = 7 $$\n协方差的分子是 $\\sum_{i=1}^3 (x_{iL} - \\bar{x}_L)(y_{iL} - \\bar{y}_L)$:\n$$ (1-2)(9-7) + (2-2)(7-7) + (3-2)(5-7) $$\n$$ = (-1)(2) + (0)(0) + (1)(-2) $$\n$$ = -2 + 0 - 2 = -4 $$\n由于协方差为负（$-4$），$L$ 组的回归线斜率为**负**。\n\n**对于 H 组：**\n数据点为 $(8, 20), (9, 18), (10, 16)$。\n样本均值为：\n$$ \\bar{x}_H = \\frac{8+9+10}{3} = \\frac{27}{3} = 9 $$\n$$ \\bar{y}_H = \\frac{20+18+16}{3} = \\frac{54}{3} = 18 $$\n协方差的分子是 $\\sum_{i=1}^3 (x_{iH} - \\bar{x}_H)(y_{iH} - \\bar{y}_H)$:\n$$ (8-9)(20-18) + (9-9)(18-18) + (10-9)(16-18) $$\n$$ = (-1)(2) + (0)(0) + (1)(-2) $$\n$$ = -2 + 0 - 2 = -4 $$\n由于协方差为负（$-4$），$H$ 组的回归线斜率也为**负**。\n组内斜率符号相同的假设成立，且这个共同的符号是负号。\n\n**2. 聚合斜率（宏观层面）**\n\n我们将所有 6 个数据点汇集起来：$(1, 9), (2, 7), (3, 5), (8, 20), (9, 18), (10, 16)$。\n聚合数据的样本均值为：\n$$ \\bar{x}_{agg} = \\frac{1+2+3+8+9+10}{6} = \\frac{33}{6} = 5.5 $$\n$$ \\bar{y}_{agg} = \\frac{9+7+5+20+18+16}{6} = \\frac{75}{6} = 12.5 $$\n聚合数据的协方差的分子是 $\\sum_{i} (x_i - \\bar{x}_{agg})(y_i - \\bar{y}_{agg})$：\n- 对于 $L$ 组的点：\n  - $(1 - 5.5)(9 - 12.5) = (-4.5)(-3.5) = 15.75$\n  - $(2 - 5.5)(7 - 12.5) = (-3.5)(-5.5) = 19.25$\n  - $(3 - 5.5)(5 - 12.5) = (-2.5)(-7.5) = 18.75$\n- 对于 $H$ 组的点：\n  - $(8 - 5.5)(20 - 12.5) = (2.5)(7.5) = 18.75$\n  - $(9 - 5.5)(18 - 12.5) = (3.5)(5.5) = 19.25$\n  - $(10 - 5.5)(16 - 12.5) = (4.5)(3.5) = 15.75$\n\n这些乘积的总和是：\n$$ 15.75 + 19.25 + 18.75 + 18.75 + 19.25 + 15.75 = 107.5 $$\n由于协方差为正（$107.5$），聚合数据的回归线斜率为**正**。\n\n当数据聚合时，关联符号发生反转，这是辛普森悖论的一个典型例子。\n\n### 逐项分析\n\n- **A. 组内斜率为负；聚合斜率为正。**\n  我们的计算表明，共同的组内斜率为负，而聚合斜率为正。此陈述与我们的发现一致。\n  **结论：正确。**\n\n- **B. 组内斜率为正；聚合斜率为负。**\n  此陈述在两方面都与我们的发现相矛盾。组内斜率为负，而不是正；聚合斜率为正，而不是负。\n  **结论：不正确。**\n\n- **C. 组内斜率和聚合斜率均为负。**\n  此陈述正确地指出了组内斜率为负，但错误地声称聚合斜率也为负。我们的计算表明聚合斜率为正。\n  **结论：不正确。**\n\n- **D. 组内斜率和聚合斜率均为正。**\n  此陈述错误地声称组内斜率为正。我们的计算表明它为负。\n  **结论：不正确。**\n\n唯一正确报告了两个斜率符号的选项是 A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理解了忽略分组结构可能带来的陷阱之后，我们现在来探讨多层次模型解决这一问题的核心数学机制。这个练习要求您从贝叶斯定理出发，为一个经典的正态-正态层级模型推导其组级别参数的条件后验分布。这个推导过程将清晰地揭示模型如何巧妙地融合来自单个组的数据信息（似然）和来自整体的信息（先验），这一过程被称为“收缩效应” (shrinkage) 或“借力” (borrowing strength)。完成这个从第一性原理出发的推导，将使您对贝叶斯层级模型如何实现信息共享和平衡个体与整体趋势有更深刻的理解。",
            "id": "4131271",
            "problem": "考虑一个用于分组观测的贝叶斯双层层次模型。对于由 $j \\in \\{1,\\dots,J\\}$ 索引的组，以及组 $j$ 内由 $i \\in \\{1,\\dots,n_j\\}$ 索引的观测，假设在给定组参数的条件下，$i$ 之间条件独立，并且在给定超参数的条件下，组之间相互独立。数据模型（似然）为 $y_{ij} \\mid \\theta_j, \\sigma^2 \\sim \\mathcal{N}(\\theta_j,\\sigma^2)$，组水平先验为 $\\theta_j \\mid \\mu,\\tau^2 \\sim \\mathcal{N}(\\mu,\\tau^2)$。令超参数表示为 $\\phi \\equiv (\\mu,\\tau^2,\\sigma^2)$，假设 $\\sigma^2 > 0$ 和 $\\tau^2 > 0$ 已知，并令 $y \\equiv \\{y_{ij}: j \\in \\{1,\\dots,J\\}, i \\in \\{1,\\dots,n_j\\}\\}$ 表示完整数据集。对于一个固定但任意的组 $j$，令 $n_j$ 为组 $j$ 的样本量，并定义组内样本均值 $\\bar{y}_j \\equiv \\frac{1}{n_j}\\sum_{i=1}^{n_j} y_{ij}$。\n\n仅从贝叶斯定理和高斯概率密度函数 (pdf) 的定义出发，推导全条件后验密度 $p(\\theta_j \\mid y,\\phi)$，并计算其后验均值和后验方差，以 $(\\mu,\\tau^2,\\sigma^2,n_j,\\bar{y}_j)$ 的封闭形式解析表达式表示。你的推导必须明确且自洽，展示后验核是如何从似然和先验中获得的，以及如何将其补全为一个高斯概率密度函数。不允许使用任何预先编译的共轭公式。\n\n请以由 $\\theta_j \\mid y,\\phi$ 的后验均值和后验方差组成的数对形式提供最终答案。不需要进行数值评估或四舍五入，你的最终表达式必须是精确的。不要包含任何单位。",
            "solution": "目标是为特定组 $j$ 推导全条件后验密度 $p(\\theta_j \\mid y, \\phi)$，并求出其均值和方差。推导将从贝叶斯定理和高斯概率密度函数的定义开始。\n\n根据贝叶斯定理，$\\theta_j$ 的后验概率密度与似然和先验的乘积成正比：\n$$p(\\theta_j \\mid y, \\phi) \\propto p(y \\mid \\theta_j, \\phi) p(\\theta_j \\mid \\phi)$$\n超参数向量 $\\phi$ 已知为 $(\\mu, \\tau^2, \\sigma^2)$。问题陈述了在给定超参数的情况下，各组之间的观测是条件独立的。这意味着完整似然 $p(y \\mid \\theta_1, \\dots, \\theta_J, \\phi)$ 可以分解。更具体地说，对于 $\\theta_j$ 的条件后验，一旦超参数 $\\phi$ 已知，来自其他组 $k \\neq j$ 的数据不会提供关于 $\\theta_j$ 的额外信息。模型结构为 $y_{ik} \\to \\theta_k \\to \\phi$。从 $y_{ik}$ ($k \\neq j$) 到 $\\theta_j$ 的路径被 $\\phi$ 阻断。因此，$\\theta_j$ 的后验仅依赖于其自身组的数据 $y_j = \\{y_{ij} : i=1, \\dots, n_j\\}$。\n$$p(\\theta_j \\mid y, \\phi) = p(\\theta_j \\mid y_j, \\phi)$$\n$\\theta_j$ 的先验被直接指定为 $p(\\theta_j \\mid \\mu, \\tau^2)$，它是 $p(\\theta_j \\mid \\phi)$ 的一个组成部分。因此，后验由下式给出：\n$$p(\\theta_j \\mid y_j, \\phi) \\propto p(y_j \\mid \\theta_j, \\sigma^2) p(\\theta_j \\mid \\mu, \\tau^2)$$\n这里，$p(y_j \\mid \\theta_j, \\sigma^2)$ 是组 $j$ 的似然，$p(\\theta_j \\mid \\mu, \\tau^2)$ 是 $\\theta_j$ 的先验。\n\n对于一个随机变量 $X \\sim \\mathcal{N}(m, v)$，其高斯概率密度函数 (pdf) 为 $f(x) = (2\\pi v)^{-1/2} \\exp\\left(-\\frac{(x-m)^2}{2v}\\right)$。\n\n首先，我们写出似然项。观测值 $y_{ij}$ 在给定 $\\theta_j$ 的条件下是条件独立的，因此组 $j$ 的似然是各个密度的乘积：\n$$p(y_j \\mid \\theta_j, \\sigma^2) = \\prod_{i=1}^{n_j} p(y_{ij} \\mid \\theta_j, \\sigma^2) = \\prod_{i=1}^{n_j} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(y_{ij}-\\theta_j)^2}{2\\sigma^2}\\right)$$\n我们可以将乘积合并为一个指数函数：\n$$p(y_j \\mid \\theta_j, \\sigma^2) = (2\\pi\\sigma^2)^{-n_j/2} \\exp\\left(-\\frac{1}{2\\sigma^2} \\sum_{i=1}^{n_j} (y_{ij}-\\theta_j)^2\\right)$$\n作为 $\\theta_j$ 的函数，似然的核为：\n$$p(y_j \\mid \\theta_j, \\sigma^2) \\propto \\exp\\left(-\\frac{1}{2\\sigma^2} \\sum_{i=1}^{n_j} (y_{ij}-\\theta_j)^2\\right)$$\n\n其次，我们写出先验项。$\\theta_j$ 的先验为 $\\theta_j \\mid \\mu,\\tau^2 \\sim \\mathcal{N}(\\mu, \\tau^2)$。其概率密度函数为：\n$$p(\\theta_j \\mid \\mu, \\tau^2) = \\frac{1}{\\sqrt{2\\pi\\tau^2}} \\exp\\left(-\\frac{(\\theta_j-\\mu)^2}{2\\tau^2}\\right)$$\n作为 $\\theta_j$ 的函数，先验的核为：\n$$p(\\theta_j \\mid \\mu, \\tau^2) \\propto \\exp\\left(-\\frac{(\\theta_j-\\mu)^2}{2\\tau^2}\\right)$$\n\n现在，我们将似然和先验的核相乘，以找到后验的核：\n$$p(\\theta_j \\mid y_j, \\phi) \\propto \\exp\\left(-\\frac{1}{2\\sigma^2} \\sum_{i=1}^{n_j} (y_{ij}-\\theta_j)^2\\right) \\exp\\left(-\\frac{(\\theta_j-\\mu)^2}{2\\tau^2}\\right)$$\n$$p(\\theta_j \\mid y_j, \\phi) \\propto \\exp\\left( -\\frac{1}{2} \\left[ \\frac{1}{\\sigma^2}\\sum_{i=1}^{n_j} (y_{ij}-\\theta_j)^2 + \\frac{1}{\\tau^2}(\\theta_j-\\mu)^2 \\right] \\right)$$\n\n为了确定这个后验密度的形式，我们检查指数中的表达式，我们将其表示为 $Q(\\theta_j)$：\n$$Q(\\theta_j) = \\frac{1}{\\sigma^2}\\sum_{i=1}^{n_j} (y_{ij}^2 - 2y_{ij}\\theta_j + \\theta_j^2) + \\frac{1}{\\tau^2}(\\theta_j^2 - 2\\mu\\theta_j + \\mu^2)$$\n我们按 $\\theta_j$ 的幂次对各项进行分组。不依赖于 $\\theta_j$ 的项可以被吸收到比例常数中。\n$$Q(\\theta_j) = \\frac{1}{\\sigma^2}(n_j\\theta_j^2 - 2\\theta_j \\sum_{i=1}^{n_j} y_{ij}) + \\frac{1}{\\tau^2}(\\theta_j^2 - 2\\mu\\theta_j) + \\text{constant}$$\n使用样本均值的定义 $\\bar{y}_j = \\frac{1}{n_j}\\sum_{i=1}^{n_j} y_{ij}$，我们有 $\\sum_{i=1}^{n_j} y_{ij} = n_j\\bar{y}_j$。\n$$Q(\\theta_j) = \\frac{1}{\\sigma^2}(n_j\\theta_j^2 - 2n_j\\bar{y}_j\\theta_j) + \\frac{1}{\\tau^2}(\\theta_j^2 - 2\\mu\\theta_j) + \\text{constant}$$\n收集 $\\theta_j^2$ 和 $\\theta_j$ 的系数：\n$$Q(\\theta_j) = \\theta_j^2 \\left(\\frac{n_j}{\\sigma^2} + \\frac{1}{\\tau^2}\\right) - 2\\theta_j \\left(\\frac{n_j\\bar{y}_j}{\\sigma^2} + \\frac{\\mu}{\\tau^2}\\right) + \\text{constant}$$\n这是 $\\theta_j$ 的一个二次函数。因此，后验密度是高斯分布。为了找到其参数，我们进行配方。一个高斯密度 $\\mathcal{N}(\\mu_{\\text{post}}, \\sigma^2_{\\text{post}})$ 的核与 $\\exp\\left(-\\frac{(\\theta_j - \\mu_{\\text{post}})^2}{2\\sigma^2_{\\text{post}}}\\right)$ 成正比。其指数为 $-\\frac{1}{2\\sigma^2_{\\text{post}}}(\\theta_j^2 - 2\\mu_{\\text{post}}\\theta_j + \\mu_{\\text{post}}^2)$。我们的后验核与 $\\exp\\left(-\\frac{1}{2}Q(\\theta_j)\\right)$ 成正比。\n\n通过比较各项，我们将 $-\\frac{1}{2}Q(\\theta_j)$ 中 $\\theta_j^2$ 的系数与 $-\\frac{1}{2\\sigma^2_{\\text{post}}}$ 进行匹配：\n$$\\frac{1}{\\sigma^2_{\\text{post}}} = \\frac{n_j}{\\sigma^2} + \\frac{1}{\\tau^2}$$\n这就确定了后验精度（方差的倒数）。后验方差，我们称之为 $V_{\\text{post}}$，是：\n$$V_{\\text{post}} = \\sigma^2_{\\text{post}} = \\left(\\frac{n_j}{\\sigma^2} + \\frac{1}{\\tau^2}\\right)^{-1} = \\frac{1}{\\frac{n_j\\tau^2 + \\sigma^2}{\\sigma^2\\tau^2}} = \\frac{\\sigma^2\\tau^2}{n_j\\tau^2 + \\sigma^2}$$\n\n接下来，我们将 $-\\frac{1}{2}Q(\\theta_j)$ 中 $\\theta_j$ 的系数与 $\\frac{\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}}$ 进行匹配：\n$$\\frac{\\mu_{\\text{post}}}{\\sigma^2_{\\text{post}}} = \\frac{n_j\\bar{y}_j}{\\sigma^2} + \\frac{\\mu}{\\tau^2}$$\n后验均值，我们称之为 $M_{\\text{post}}$，是：\n$$M_{\\text{post}} = \\mu_{\\text{post}} = \\sigma^2_{\\text{post}} \\left(\\frac{n_j\\bar{y}_j}{\\sigma^2} + \\frac{\\mu}{\\tau^2}\\right) = \\left(\\frac{n_j}{\\sigma^2} + \\frac{1}{\\tau^2}\\right)^{-1} \\left(\\frac{n_j\\bar{y}_j}{\\sigma^2} + \\frac{\\mu}{\\tau^2}\\right)$$\n代入后验精度的倒数表达式：\n$$M_{\\text{post}} = \\frac{\\frac{n_j\\bar{y}_j}{\\sigma^2} + \\frac{\\mu}{\\tau^2}}{\\frac{n_j}{\\sigma^2} + \\frac{1}{\\tau^2}}$$\n为了简化，将分子和分母同乘以 $\\sigma^2\\tau^2$：\n$$M_{\\text{post}} = \\frac{(n_j\\bar{y}_j/\\sigma^2)(\\sigma^2\\tau^2) + (\\mu/\\tau^2)(\\sigma^2\\tau^2)}{(n_j/\\sigma^2)(\\sigma^2\\tau^2) + (1/\\tau^2)(\\sigma^2\\tau^2)} = \\frac{n_j\\bar{y}_j\\tau^2 + \\mu\\sigma^2}{n_j\\tau^2 + \\sigma^2}$$\n推导表明，后验分布 $p(\\theta_j \\mid y, \\phi)$ 是一个高斯分布，即 $\\mathcal{N}(M_{\\text{post}}, V_{\\text{post}})$。\n\n后验均值 $M_{\\text{post}}$ 是样本均值 $\\bar{y}_j$ 和先验均值 $\\mu$ 的加权平均，权重由它们各自的精度决定。后验方差 $V_{\\text{post}}$ 是数据精度和先验精度之和的倒数。\n\n推导出的后验均值和后验方差的表达式为：\n后验均值：$M_{\\text{post}} = \\frac{n_j\\bar{y}_j\\tau^2 + \\mu\\sigma^2}{n_j\\tau^2 + \\sigma^2}$\n后验方差：$V_{\\text{post}} = \\frac{\\sigma^2\\tau^2}{n_j\\tau^2 + \\sigma^2}$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{n_j\\bar{y}_j\\tau^2 + \\mu\\sigma^2}{n_j\\tau^2 + \\sigma^2}  \\frac{\\sigma^2\\tau^2}{n_j\\tau^2 + \\sigma^2}\n\\end{pmatrix}\n}\n$$"
        }
    ]
}