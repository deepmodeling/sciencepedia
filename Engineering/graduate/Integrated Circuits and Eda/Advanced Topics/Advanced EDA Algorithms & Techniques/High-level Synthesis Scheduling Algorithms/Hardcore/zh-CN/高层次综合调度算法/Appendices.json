{
    "hands_on_practices": [
        {
            "introduction": "在尝试优化一个调度方案之前，评估其理论上的最佳性能至关重要。此练习将指导您计算两种基本的延迟下界：一种基于最长依赖路径（关键路径），另一种基于资源的总需求。通过确定这些下界，您可以为任何启发式调度算法的结果建立一个黄金标准，并量化其与理论最优解的差距。",
            "id": "4275683",
            "problem": "考虑一个用于在电子设计自动化（EDA）领域的高层次综合（HLS）中进行调度的数据流有向无环图（DAG）。调度目标是在满足先行关系和资源容量约束的条件下，最小化以整数时间步为单位的总延迟（完工时间）。所有操作都是不可抢占的，使用整数周期的持续时间，并在其执行区间内独占其所需资源。一个周期内没有链接（chaining），多周期运算符没有流水线化（pipelining），通信延迟可忽略不计。输入在时间 $0$ 可用。延迟以周期为单位进行测量，定义为所有操作中的最大完成时间。\n\n资源和容量：\n- 一个乘法器单元（$1$ 个乘法器），\n- 两个加法器单元（$2$ 个加法器），\n- 一个除法器单元（$1$ 个除法器）。\n\n操作类型和持续时间：\n- 乘法器操作耗时 $3$ 个周期，\n- 加法器操作耗时 $1$ 个周期，\n- 除法器操作耗时 $5$ 个周期。\n\n该DAG包含以下操作及先行约束：\n\n- $O_{1}$：乘法器，持续时间 $3$，无前驱。\n- $O_{2}$：加法器，持续时间 $1$，无前驱。\n- $O_{3}$：乘法器，持续时间 $3$，前驱为 $O_{2}$。\n- $O_{4}$：加法器，持续时间 $1$，前驱为 $O_{1}$ 和 $O_{3}$。\n- $O_{5}$：除法器，持续时间 $5$，前驱为 $O_{4}$。\n- $O_{6}$：加法器，持续时间 $1$，前驱为 $O_{5}$。\n- $O_{7}$：乘法器，持续时间 $3$，前驱为 $O_{6}$。\n- $O_{8}$：加法器，持续时间 $1$，前驱为 $O_{7}$。\n- $O_{9}$：乘法器，持续时间 $3$，前驱为 $O_{1}$ 和 $O_{8}$。\n- $O_{10}$：加法器，持续时间 $1$，前驱为 $O_{9}$ 和 $O_{3}$。\n\n任务：\n1. 仅使用先行约束，推导由DAG中最长依赖路径所隐含的最小延迟下限。\n2. 仅使用资源容量约束，推导由每种资源类型的总强制占用所隐含的最小延迟下限。\n3. 结合以上两点，得出通过这两种考虑可获得的最紧下限。\n4. 一个启发式列表调度（在所述资源限制下）产生了以下开始时间（每个操作 $O_{i}$ 在时间 $s_{i}$ 开始，并运行其持续时间，在区间 $[s_{i}, s_{i} + \\text{duration})$ 内占用其资源）：\n   - $O_{1}$：$s_{1} = 0$，\n   - $O_{2}$：$s_{2} = 0$，\n   - $O_{3}$：$s_{3} = 3$，\n   - $O_{4}$：$s_{4} = 6$，\n   - $O_{5}$：$s_{5} = 7$，\n   - $O_{6}$：$s_{6} = 12$，\n   - $O_{7}$：$s_{7} = 13$，\n   - $O_{8}$：$s_{8} = 16$，\n   - $O_{9}$：$s_{9} = 17$，\n   - $O_{10}$：$s_{10} = 20$。\n   计算此启发式调度的延迟，并将其与第 $1$–$3$ 部分得到的最紧下限进行比较。\n5. 报告最优性差距，即启发式调度延迟与最紧下限之间的差值，以周期为单位。请提供最终答案，形式为单个数字。无需四舍五入。",
            "solution": "首先验证问题陈述的正确性和完整性。\n\n**步骤 1：提取给定信息**\n- **目标**：最小化以整数时间步为单位的总延迟（完工时间）。\n- **资源和容量**：一个乘法器单元（$N_{\\text{mult}} = 1$），两个加法器单元（$N_{\\text{add}} = 2$），一个除法器单元（$N_{\\text{div}} = 1$）。\n- **操作类型和持续时间**：乘法器操作耗时 $d_{\\text{mult}} = 3$ 个周期，加法器操作耗时 $d_{\\text{add}} = 1$ 个周期，除法器操作耗时 $d_{\\text{div}} = 5$ 个周期。\n- **操作和先行约束**：\n  - $O_{1}$：乘法器，持续时间 $3$，无前驱。\n  - $O_{2}$：加法器，持续时间 $1$，无前驱。\n  - $O_{3}$：乘法器，持续时间 $3$，前驱为 $O_{2}$。\n  - $O_{4}$：加法器，持续时间 $1$，前驱为 $O_{1}$ 和 $O_{3}$。\n  - $O_{5}$：除法器，持续时间 $5$，前驱为 $O_{4}$。\n  - $O_{6}$：加法器，持续时间 $1$，前驱为 $O_{5}$。\n  - $O_{7}$：乘法器，持续时间 $3$，前驱为 $O_{6}$。\n  - $O_{8}$：加法器，持续时间 $1$，前驱为 $O_{7}$。\n  - $O_{9}$：乘法器，持续时间 $3$，前驱为 $O_{1}$ 和 $O_{8}$。\n  - $O_{10}$：加法器，持续时间 $1$，前驱为 $O_{9}$ 和 $O_{3}$。\n- **启发式调度开始时间**：$s_{1} = 0$, $s_{2} = 0$, $s_{3} = 3$, $s_{4} = 6$, $s_{5} = 7$, $s_{6} = 12$, $s_{7} = 13$, $s_{8} = 16$, $s_{9} = 17$, $s_{10} = 20$。\n\n**步骤 2：使用提取的给定信息进行验证**\n该问题是电子设计自动化（EDA）领域高层次综合（HLS）中的一个经典资源受限调度问题。\n- **科学上成立**：该问题基于数字电路设计、调度理论和计算机体系结构的既定基本原则。\n- **定义明确**：所有必要信息——资源容量、操作持续时间和先行约束——均已提供。目标陈述清晰，确保每个部分都能推导出唯一解。\n- **目标**：问题使用该领域精确、无歧义的标准术语进行描述。\n问题是完整、一致且科学合理的。未发现任何缺陷。\n\n**步骤 3：结论与行动**\n问题有效。将推导出一个完整的解答。\n\n**解题过程**\n\n解答过程按顺序处理五个任务中的每一个。\n\n**1. 基于先行关系的延迟下限（关键路径）**\n任何调度的最小延迟都受限于数据流图（DAG）中的最长路径，即关键路径。此路径的长度是其构成操作的持续时间之和。我们可以通过计算每个操作的最早开始时间（$EST$）和最早完成时间（$EF$）来找到它。对于持续时间为 $d_i$ 且前驱集合为 $\\text{preds}(O_i)$ 的操作 $O_i$：\n$$EST(O_i) = \\max_{O_j \\in \\text{preds}(O_i)} \\{EF(O_j)\\}$$\n$$EF(O_i) = EST(O_i) + d_i$$\n对于没有前驱的操作，$EST = 0$。各操作持续时间为 $d_1=3, d_2=1, d_3=3, d_4=1, d_5=5, d_6=1, d_7=3, d_8=1, d_9=3, d_{10}=1$。\n\n- $O_1$：$EST(O_1) = 0$，因此 $EF(O_1) = 0 + 3 = 3$。\n- $O_2$：$EST(O_2) = 0$，因此 $EF(O_2) = 0 + 1 = 1$。\n- $O_3$ (前驱 $O_2$)：$EST(O_3) = EF(O_2) = 1$，因此 $EF(O_3) = 1 + 3 = 4$。\n- $O_4$ (前驱 $O_1, O_3$)：$EST(O_4) = \\max(EF(O_1), EF(O_3)) = \\max(3, 4) = 4$，因此 $EF(O_4) = 4 + 1 = 5$。\n- $O_5$ (前驱 $O_4$)：$EST(O_5) = EF(O_4) = 5$，因此 $EF(O_5) = 5 + 5 = 10$。\n- $O_6$ (前驱 $O_5$)：$EST(O_6) = EF(O_5) = 10$，因此 $EF(O_6) = 10 + 1 = 11$。\n- $O_7$ (前驱 $O_6$)：$EST(O_7) = EF(O_6) = 11$，因此 $EF(O_7) = 11 + 3 = 14$。\n- $O_8$ (前驱 $O_7$)：$EST(O_8) = EF(O_7) = 14$，因此 $EF(O_8) = 14 + 1 = 15$。\n- $O_9$ (前驱 $O_1, O_8$)：$EST(O_9) = \\max(EF(O_1), EF(O_8)) = \\max(3, 15) = 15$，因此 $EF(O_9) = 15 + 3 = 18$。\n- $O_{10}$ (前驱 $O_9, O_3$)：$EST(O_{10}) = \\max(EF(O_9), EF(O_3)) = \\max(18, 4) = 18$，因此 $EF(O_{10}) = 18 + 1 = 19$。\n\n关键路径长度是所有操作中的最大最早完成时间。这决定了基于先行关系的延迟下限 $L_{\\text{precedence}}$。\n$$L_{\\text{precedence}} = \\max(3, 1, 4, 5, 10, 11, 14, 15, 18, 19) = 19 \\text{ 周期。}$$\n\n**2. 基于资源的延迟下限**\n延迟也受限于每种资源类型的总执行需求。对于具有 $N_k$ 个单元的每种资源类型 $k$，其下限是该类型所有操作的总持续时间除以 $N_k$，然后向上取整（ceiling 函数）。\n$$L_{\\text{resource}, k} = \\left\\lceil \\frac{\\sum_{i \\in \\text{ops of type } k} d_i}{N_k} \\right\\rceil$$\n\n- **乘法器**：有 $4$ 个乘法操作（$O_1, O_3, O_7, O_9$），每个耗时 $3$ 个周期。有 $N_{\\text{mult}} = 1$ 个乘法器。\n$$L_{\\text{mult}} = \\left\\lceil \\frac{4 \\times 3}{1} \\right\\rceil = \\lceil 12 \\rceil = 12 \\text{ 周期。}$$\n- **加法器**：有 $5$ 个加法操作（$O_2, O_4, O_6, O_8, O_{10}$），每个耗时 $1$ 个周期。有 $N_{\\text{add}} = 2$ 个加法器。\n$$L_{\\text{add}} = \\left\\lceil \\frac{5 \\times 1}{2} \\right\\rceil = \\lceil 2.5 \\rceil = 3 \\text{ 周期。}$$\n- **除法器**：有 $1$ 个除法操作（$O_5$），耗时 $5$ 个周期。有 $N_{\\text{div}} = 1$ 个除法器。\n$$L_{\\text{div}} = \\left\\lceil \\frac{1 \\times 5}{1} \\right\\rceil = \\lceil 5 \\rceil = 5 \\text{ 周期。}$$\n总的基于资源的下限 $L_{\\text{resource}}$ 是这些下限中的最大值。\n$$L_{\\text{resource}} = \\max(L_{\\text{mult}}, L_{\\text{add}}, L_{\\text{div}}) = \\max(12, 3, 5) = 12 \\text{ 周期。}$$\n\n**3. 最紧下限**\n真正的最小延迟必须同时满足先行关系和资源约束。因此，最紧下限 $L_{\\text{lower\\_bound}}$ 是从这两个独立考虑中推导出的下限的最大值。\n$$L_{\\text{lower\\_bound}} = \\max(L_{\\text{precedence}}, L_{\\text{resource}}) = \\max(19, 12) = 19 \\text{ 周期。}$$\n\n**4. 启发式调度的延迟**\n给定启发式调度的延迟是其完工时间，即所有操作中的最大完成时间。操作 $O_i$ 的完成时间 $f_i$ 是其开始时间 $s_i$ 加上其持续时间 $d_i$。\n- $f_1 = s_1 + d_1 = 0 + 3 = 3$。\n- $f_2 = s_2 + d_2 = 0 + 1 = 1$。\n- $f_3 = s_3 + d_3 = 3 + 3 = 6$。\n- $f_4 = s_4 + d_4 = 6 + 1 = 7$。\n- $f_5 = s_5 + d_5 = 7 + 5 = 12$。\n- $f_6 = s_6 + d_6 = 12 + 1 = 13$。\n- $f_7 = s_7 + d_7 = 13 + 3 = 16$。\n- $f_8 = s_8 + d_8 = 16 + 1 = 17$。\n- $f_9 = s_9 + d_9 = 17 + 3 = 20$。\n- $f_{10} = s_{10} + d_{10} = 20 + 1 = 21$。\n该调度的延迟 $L_{\\text{heuristic}}$ 是这些完成时间的最大值。\n$$L_{\\text{heuristic}} = \\max(3, 1, 6, 7, 12, 13, 16, 17, 20, 21) = 21 \\text{ 周期。}$$\n与下限相比，$L_{\\text{heuristic}} = 21 > L_{\\text{lower\\_bound}} = 19$，这证实了该调度未被证明为最优。\n\n**5. 最优性差距**\n最优性差距是启发式调度的延迟与最紧下限之间的差值。\n$$\\text{Optimality Gap} = L_{\\text{heuristic}} - L_{\\text{lower\\_bound}} = 21 - 19 = 2 \\text{ 周期。}$$\n这个值代表启发式解超过理论最小可能延迟的周期数。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "调度问题的核心挑战之一在于有效处理有限的硬件资源。本练习通过对比两种调度模型——差分约束系统（SDC）和整数线性规划（ILP），深刻揭示了仅考虑时序依赖而忽略资源互斥的简化模型的局限性。通过分析一个SDC调度失败的案例，您将直观地理解为何需要更强大的模型来保证调度的有效性和最优性。",
            "id": "4275702",
            "problem": "考虑在高级综合（High-Level Synthesis）中使用两种方法来调度数据流图的问题：差分约束系统（System of Difference Constraints, SDC）调度和整数线性规划（Integer Linear Programming, ILP）调度。差分约束系统（SDC）调度将先行约束和时序约束建模为起始时间之间的线性差分不等式，但它本身不编码用于在容量有限的资源上强制互斥的析取资源约束。整数线性规划（ILP）调度可以明确地表示先行约束和析取资源约束。\n\n假设单个全局时钟周期为 $1$ 个周期，操作延迟以整数周期为单位进行测量。资源容量约束规定，在任何时候，在给定资源上执行的操作数量不能超过该资源的容量。对于共享单一容量资源的两个操作，析取资源约束强制规定其中一个操作必须在另一个操作完成后才能开始。\n\n构建并分析以下两种情况：\n\n情况 A（SDC 产生最优调度）。数据流图由具有以下延迟和先行关系的操作组成：\n- 一个内存读取操作 $r_{1}$，延迟为 $3$，在单个内存端口（容量为 $1$）上执行，没有先行操作。\n- 两个加法操作 $a_{1}$ 和 $a_{2}$，每个延迟为 $1$，在加法器（加法器容量为 $2$）上执行，都依赖于 $r_{1}$。\n- 一个乘法操作 $m_{1}$，延迟为 $2$，在乘法器（乘法器容量为 $1$）上执行，依赖于 $a_{1}$ 和 $a_{2}$。\n- 一个加法操作 $a_{3}$，延迟为 $1$，在加法器（加法器容量为 $2$）上执行，依赖于 $m_{1}$。\n\n情况 B（SDC 因缺少析取资源约束而失败）。数据流图由具有以下延迟和先行关系的操作组成：\n- 三个独立的乘法操作 $m_{1}$、$m_{2}$、$m_{3}$，每个延迟为 $2$，都共享同一个单一乘法器资源（乘法器容量为 $1$）。\n- 一个加法操作 $a_{4}$，延迟为 $1$，在加法器（加法器容量为 $2$）上执行，依赖于 $m_{1}$、$m_{2}$ 和 $m_{3}$。\n\n仅使用先行约束（每个后继操作的开始时间不能早于其所有先行操作的完成时间）和资源容量约束（在任何时候，资源上活动的操作数量不超过其容量）的定义，确定情况 B 中 SDC 和 ILP 调度的完工时间（makespan），并验证在情况 A 中 SDC 调度是最优的且与 ILP 调度一致。然后计算差值\n$$\\Delta = L_{B}^{\\mathrm{ILP}} - L_{B}^{\\mathrm{SDC}},$$\n其中 $L_{B}^{\\mathrm{ILP}}$ 和 $L_{B}^{\\mathrm{SDC}}$ 分别表示在整数线性规划调度和差分约束系统调度下情况 B 的完工时间。最终结果以周期为单位表示。无需四舍五入。",
            "solution": "该问题要求在高级综合（HLS）中分析两种调度场景，比较差分约束系统（SDC）调度和整数线性规划（ILP）调度的结果。设 $s_i$ 表示操作 $i$ 的开始时间（周期），$d(i)$ 表示其以周期为单位的延迟。该操作在周期 $s_i + d(i)$ 的开始时完成。从操作 $i$到操作 $j$ 的先行约束表示为 $s_j \\ge s_i + d(i)$。我们假设调度从时间 $t=0$ 开始。\n\n如前所述，SDC 调度只对先行约束进行建模。这等同于一种尽快调度（As-Soon-As-Possible, ASAP）算法。所得调度的完工时间，我们记为 $L^{\\mathrm{SDC}}$，由数据流图的关键路径决定。此调度可能满足也可能不满足资源约束。\n\nILP 调度是一种完整的方法，它同时对先行约束和资源约束进行建模。它能找到一个满足资源约束且具有最小可能完工时间的调度，记为 $L^{\\mathrm{ILP}}$。\n\n我们首先分析情况 A，以验证 SDC 和 ILP 调度一致且均为最优。然后，我们分析情况 B，以找到完工时间 $L_{B}^{\\mathrm{SDC}}$ 和 $L_{B}^{\\mathrm{ILP}}$ 并计算它们的差值。\n\n### 情况 A：SDC 是最优的\n\n操作、延迟和依赖关系如下：\n- $r_1$：延迟 $d(r_1)=3$。\n- $a_1$：延迟 $d(a_1)=1$，先行操作 $r_1$。\n- $a_2$：延迟 $d(a_2)=1$，先行操作 $r_1$。\n- $m_1$：延迟 $d(m_1)=2$，先行操作 $a_1, a_2$。\n- $a_3$：延迟 $d(a_3)=1$，先行操作 $m_1$。\n\n资源容量为：$1$ 个内存端口，$2$ 个加法器，和 $1$ 个乘法器。\n\n我们首先通过计算每个操作的最早可能开始时间来确定 SDC (ASAP) 调度：\n- $s_{r1} = 0$。它在时间 $s_{r1} + d(r_1) = 0 + 3 = 3$ 完成。\n- $s_{a1} \\ge 3$ 且 $s_{a2} \\ge 3$。两者的最早开始时间都是 $3$。它们在 $s_{a1} + d(a_1) = 3 + 1 = 4$ 和 $s_{a2} + d(a_2) = 3 + 1 = 4$ 完成。\n- $s_{m1} \\ge s_{a1} + d(a_1) = 4$ 且 $s_{m1} \\ge s_{a2} + d(a_2) = 4$。最早开始时间是 $s_{m1} = \\max(4, 4) = 4$。它在 $s_{m1} + d(m_1) = 4 + 2 = 6$ 完成。\n- $s_{a3} \\ge s_{m1} + d(m_1) = 6$。最早开始时间是 $s_{a3} = 6$。它在 $s_{a3} + d(a_3) = 6 + 1 = 7$ 完成。\n\nSDC 调度的完工时间是最后一个操作 $a_3$ 的完成时间。\n$L_{A}^{\\mathrm{SDC}} = 7$ 个周期。\n\n现在，我们必须验证此调度是否遵守资源约束：\n- 周期区间 $[0, 3)$：$r_1$ 处于活动状态。需要 $1$ 个内存端口。容量为 $1$。符合要求。\n- 周期区间 $[3, 4)$：$a_1$ 和 $a_2$ 处于活动状态。它们需要 $2$ 个加法器。容量为 $2$。符合要求。\n- 周期区间 $[4, 6)$：$m_1$ 处于活动状态。需要 $1$ 个乘法器。容量为 $1$。符合要求。\n- 周期区间 $[6, 7)$：$a_3$ 处于活动状态。需要 $1$ 个加法器。容量为 $2$。符合要求。\n\n由于 SDC 调度是资源有效的，并且其长度由图的关键路径（$r_1 \\to a_1 \\to m_1 \\to a_3$ 或 $r_1 \\to a_2 \\to m_1 \\to a_3$）决定，因此它是一个最优调度。ILP 求解器作为一种最优方法，会找到相同的调度和完工时间。因此，$L_{A}^{\\mathrm{ILP}} = 7$。情况 A 的验证完成。\n\n### 情况 B：SDC 失败\n\n操作、延迟和依赖关系如下：\n- $m_1, m_2, m_3$：独立，每个延迟为 $d(m_i)=2$。\n- $a_4$：延迟 $d(a_4)=1$，先行操作 $m_1, m_2, m_3$。\n\n资源容量为：$1$ 个乘法器（用于 $m_1, m_2, m_3$）和 $2$ 个加法器（用于 $a_4$）。\n\n首先，我们确定忽略资源约束的 SDC (ASAP) 调度的完工时间：\n- $m_1, m_2, m_3$ 没有先行操作，所以它们的最早开始时间是 $s_{m1}=s_{m2}=s_{m3}=0$。\n- 它们都在时间 $0 + 2 = 2$ 完成。\n- $a_4$ 依赖于所有三个乘法操作，所以它的最早开始时间是 $s_{a4} = \\max(2, 2, 2) = 2$。\n- $a_4$ 在 $s_{a4} + d(a_4) = 2 + 1 = 3$ 完成。\n\n这个 SDC 派生出的调度的完工时间是 $L_{B}^{\\mathrm{SDC}} = 3$ 个周期。\n然而，在时间区间 $[0, 2)$ 内，此调度要求 $m_1, m_2, m_3$ 并发执行。这将需要 $3$ 个乘法器，但可用容量只有 $1$。因此 SDC 调度是无效的，因为它违反了资源约束。SDC 的“失败”在于它默认情况下无法生成一个有效的调度。题目要求的是 SDC 方法产生的调度的完工时间，即 $3$。\n\n接下来，我们确定 ILP 调度的完工时间，该调度必须是资源有效且最优的。\n三个乘法操作 $m_1, m_2, m_3$ 都使用同一个单一容量的乘法器。因此，它们必须按顺序调度。由于每个操作的延迟都是 $2$ 个周期，它们所需的总时间是 $d(m_1) + d(m_2) + d(m_3) = 2 + 2 + 2 = 6$ 个周期。\n为了最小化完工时间，这些操作应该背靠背地调度。由于它们是独立的，任何顺序对于后续操作 $a_4$ 都会产生相同的结果。让我们按 $m_1, m_2, m_3$ 的顺序来调度它们：\n- $s_{m1} = 0$，在时间 $2$ 完成。\n- $s_{m2} = 2$，在时间 $4$ 完成。\n- $s_{m3} = 4$，在时间 $6$ 完成。\n\n操作 $a_4$ 只能在其所有先行操作都完成后开始。完成时间分别是 $2, 4,$ 和 $6$。\n- $s_{a4} \\ge \\max(2, 4, 6) = 6$。\n- 最早开始时间是 $s_{a4}=6$。它的延迟是 $d(a_4)=1$，所以在 $6 + 1 = 7$ 完成。\n\nILP 调度的完工时间是最后一个操作 $a_4$ 的完成时间。\n$L_{B}^{\\mathrm{ILP}} = 7$ 个周期。\n这个调度是最优的，因为在单一资源上顺序执行这些乘法操作，要求在 $a_4$ 开始之前至少需要 $6$ 个周期。\n\n### 最终计算\n\n问题要求计算差值 $\\Delta = L_{B}^{\\mathrm{ILP}} - L_{B}^{\\mathrm{SDC}}$。\n使用为情况 B 计算的完工时间：\n$L_{B}^{\\mathrm{ILP}} = 7$\n$L_{B}^{\\mathrm{SDC}} = 3$\n\n差值为：\n$\\Delta = 7 - 3 = 4$\n\n差值为 $4$ 个周期。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "由于寻找最优调度通常是NP难问题，启发式算法在高级综合中扮演着核心角色。本练习将带您手动执行一次经典的力导向调度（FDS）算法的迭代，这是一种旨在均衡资源利用率的强大技术。通过计算将一个操作调度在不同时间步上的“力”，您将亲身体验FDS如何做出决策以降低资源冲突，从而生成高质量的调度方案。",
            "id": "4275720",
            "problem": "考虑一个用于高层次综合 (HLS) 的同步数据流图 (DFG)，其调度基于以下假设和定义：DFG 是一个有向无环图，其中节点表示操作，边表示前驱约束；对于每个节点，根据全局延迟界限定义了尽快 (ASAP) 时间和尽量晚 (ALAP) 时间；一个节点的可行时间步构成了其从 ASAP 到 ALAP（包含两者）的移动性窗口；为每个未调度的节点 $i$ 在其移动性窗口内分配一个概率分布 $P_{i}(t)$，使得 $P_{i}(t)$ 在其可行时间步上是均匀分布的，而在其他地方为零；对于每种资源类型 $k$，资源使用分布为 $R_{k}(t) = \\sum_{i \\in \\mathcal{I}_{k}} P_{i}(t)$，其中 $\\mathcal{I}_{k}$ 是类型为 $k$ 的节点集合；并且，调度质量成本是所有资源类型上资源使用量的平方在时间上的总和，即 $C = \\sum_{k} \\sum_{t=1}^{L} R_{k}(t)^{2}$。力导向调度 (FDS) (Force-Directed Scheduling (FDS)) 选择一个能最大程度减小 $C$ 的节点-时间分配方案，其方法是使用 $C$ 相对于因在特定时间分配一个节点而引起分布变化的梯度。这些变化包括对该节点自身的影响，以及通过前驱关系引起的移动性窗口收紧对其直接前驱和直接后继节点的影响。\n\n给定一个小型 DFG，包含两种资源类型（加法器和乘法器），单位延迟，以及全局延迟界限 $L = 6$ 个时间步。节点如下：\n- $n_{1}$：乘法，无前驱，后继为 $n_{3}$。\n- $n_{2}$：加法，无前驱，后继为 $n_{3}$。\n- $n_{3}$：加法，前驱为 $n_{1}, n_{2}$，后继为 $n_{4}$。\n- $n_{4}$：乘法，前驱为 $n_{3}$，无后继。\n\n所有操作的延迟均为 $1$ 个时间步。在迭代开始时，没有节点被调度；每个节点的初始 $P_{i}(t)$ 在由界限 $L$ 导出的其 ASAP–ALAP 窗口上是均匀分布的。如上定义，将资源分布视为每种资源类型的节点分布之和。在评估将 $n_{3}$ 分配到时间 $t$ 的候选方案时，将引起的变化建模为：$n_{3}$ 自身分布的变化，从其窗口上的均匀分布变为在 $t$ 处的单位脉冲；收紧其前驱节点的窗口，使其 ALAP 变为 $t-1$（如果这比它们当前的 ALAP 更紧）；收紧其后继节点的窗口，使其 ASAP 变为 $t+1$（如果这比它当前的 ASAP 更紧）；并利用这些收紧的窗口为前驱和后继节点导出更新后的均匀分布，而不完全调度它们。计算 $n_{3}$ 在每个可行时间 $t$ 的总力，其值为资源分布变化向量与当前迭代中 $C$ 相对于这些分布的梯度之间的内积。\n\n对节点 $n_{3}$ 手动执行一次力导向调度迭代：计算其 ASAP 和 ALAP，推导初始的 $P_{i}(t)$ 和 $R_{k}(t)$，评估每个可行时间 $t$ 的总力，选择使总力最小的时间 $t^{\\ast}$，并相应地更新分布。仅报告为 $n_{3}$ 选择的时间步 $t^{\\ast}$。无需四舍五入；以整数形式提供 $t^{\\ast}$。",
            "solution": "本解答将通过一次力导向调度 (FDS) 迭代，来确定调度操作 $n_3$ 的最优时间步。\n\n**1. 初始状态计算**\n\n首先，我们计算所有操作的 ASAP (尽快) 和 ALAP (尽量晚) 时间，全局延迟界限为 $L=6$，所有操作延迟为1个周期。时间步从1开始。\n\n- **ASAP 时间**:\n  - $ASAP(n_1) = 1$\n  - $ASAP(n_2) = 1$\n  - $ASAP(n_3) = \\max(ASAP(n_1) + 1, ASAP(n_2) + 1) = 2$\n  - $ASAP(n_4) = ASAP(n_3) + 1 = 3$\n\n- **ALAP 时间**:\n  - $ALAP(n_4) = L = 6$\n  - $ALAP(n_3) = ALAP(n_4) - 1 = 5$\n  - $ALAP(n_1) = ALAP(n_3) - 1 = 4$\n  - $ALAP(n_2) = ALAP(n_3) - 1 = 4$\n\n- **移动性窗口与概率分布**:\n  - $n_1$ (乘法): $[1, 4]$, $P_1(t) = 1/4$ for $t \\in [1, 4]$\n  - $n_2$ (加法): $[1, 4]$, $P_2(t) = 1/4$ for $t \\in [1, 4]$\n  - $n_3$ (加法): $[2, 5]$, $P_3(t) = 1/4$ for $t \\in [2, 5]$\n  - $n_4$ (乘法): $[3, 6]$, $P_4(t) = 1/4$ for $t \\in [3, 6]$\n\n- **初始资源分布 $R_k(t)$**:\n  - **乘法器 ($R_{mult}$)**: $R_{mult}(1)=1/4$, $R_{mult}(2)=1/4$, $R_{mult}(3)=1/2$, $R_{mult}(4)=1/2$, $R_{mult}(5)=1/4$, $R_{mult}(6)=1/4$。\n  - **加法器 ($R_{add}$)**: $R_{add}(1)=1/4$, $R_{add}(2)=1/2$, $R_{add}(3)=1/2$, $R_{add}(4)=1/2$, $R_{add}(5)=1/4$, $R_{add}(6)=0$。\n\n**2. 计算每个可行时间步的力**\n\n我们将为 $n_3$ 的每个可行时间步 $t \\in [2, 5]$ 计算“总力” $F(t)$。力由 $F(t) = \\sum_k \\sum_{t_j} 2 R_k(t_j) \\Delta R_k(t_j)$ 给出，其中 $\\Delta R_k$ 是因试探性调度而引起的资源分布变化。\n\n- **情况 1: 调度 $n_3$ 到 $t=2$**\n  - **约束更新**: $ALAP(n_1, n_2) \\to 1$。\n  - **力计算**: $F_{mult}(2) = -1/4$, $F_{add}(2) = -1/4$。\n  - **总力**: $F(2) = -1/4 - 1/4 = -1/2 = -0.5$。\n\n- **情况 2: 调度 $n_3$ 到 $t=3$**\n  - **约束更新**: $ALAP(n_1, n_2) \\to 2$, $ASAP(n_4) \\to 4$。\n  - **力计算**: $F_{mult}(3) = -1/3$, $F_{add}(3) = 0$。\n  - **总力**: $F(3) = -1/3 + 0 \\approx -0.333$。\n\n- **情况 3: 调度 $n_3$ 到 $t=4$**\n  - **约束更新**: $ALAP(n_1, n_2) \\to 3$, $ASAP(n_4) \\to 5$。\n  - **力计算**: $F_{mult}(4) = -1/3$, $F_{add}(4) = 1/12$。\n  - **总力**: $F(4) = -1/3 + 1/12 = -1/4 = -0.25$。\n\n- **情况 4: 调度 $n_3$ 到 $t=5$**\n  - **约束更新**: $ASAP(n_4) \\to 6$。\n  - **力计算**: $F_{mult}(5) = -1/4$, $F_{add}(5) = -3/8$。\n  - **总力**: $F(5) = -1/4 - 3/8 = -5/8 = -0.625$。\n\n**3. 结论**\n\n比较所有时间步的总力：\n- $F(2) = -0.5$\n- $F(3) \\approx -0.333$\n- $F(4) = -0.25$\n- $F(5) = -0.625$\n\n最小的力（最负的力）是 $F(5) = -0.625$。FDS算法选择能最大程度降低成本函数的调度，即力最小的调度。\n\n因此，为节点 $n_3$ 选择的最佳时间步是 $t^*=5$。",
            "answer": "$$\\boxed{5}$$"
        }
    ]
}