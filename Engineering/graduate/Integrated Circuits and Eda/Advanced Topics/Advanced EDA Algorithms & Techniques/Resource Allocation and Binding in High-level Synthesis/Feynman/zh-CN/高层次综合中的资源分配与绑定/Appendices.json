{
    "hands_on_practices": [
        {
            "introduction": "在将算法转化为硬件时，操作的调度是决定资源需求的关键一步。为了在满足时序约束的同时最小化硬件成本，我们需要了解每个操作在时间上的灵活性。这个练习将通过计算“尽早”（ASAP）和“尽晚”（ALAP）调度来量化这种灵活性，从而推导出每个操作的“移动性”（mobility），这是后续资源绑定和共享决策的基础。",
            "id": "4293552",
            "problem": "考虑在电子设计自动化（EDA）的高层次综合（HLS）背景下调度一个计算核心的任务。该核心表示为一个数据流图（DFG），包含顶点 $v_1, v_2, \\dots, v_9$，每个顶点对应一个单一操作，有向边则编码了先行约束（从 $v_i$ 到 $v_j$ 的边意味着 $v_j$ 必须在 $v_i$ 完成后才能开始）。假设存在一个单一的全局时钟、离散的控制步，并且所有初始输入（非由DFG内操作产生的输入）在时间 $0$ 可用。\n\n操作和延迟如下：每次乘法操作的延迟为 $2$ 个周期，每次加法操作的延迟为 $1$ 个周期，每次减法操作的延迟为 $1$ 个周期。操作和先行约束为：\n- $v_1$：乘法，无前驱。\n- $v_2$：乘法，无前驱。\n- $v_3$：加法，前驱为 $v_1$ 和 $v_2$。\n- $v_4$：加法，前驱为 $v_2$。\n- $v_5$：减法，前驱为 $v_3$ 和 $v_4$。\n- $v_6$：乘法，前驱为 $v_5$。\n- $v_7$：加法，前驱为 $v_3$。\n- $v_8$：加法，前驱为 $v_7$。\n- $v_9$：加法，前驱为 $v_6$ 和 $v_8$。\n\n假设DFG输出 $v_9$ 的要求最大完成时间为 $T_{\\text{req}} = 9$ 个周期；即，$v_9$ 必须在时间 $9$ 之前完成。\n\n请根据给定的延迟模型和要求的完成时间，定义此DFG的尽早调度（ASAP）和尽晚调度（ALAP），然后计算每个操作 $v_i$ 的移动性 $m_i$（为其ALAP和ASAP开始时间之差）。最后，计算总移动性 $M = \\sum_{i=1}^{9} m_i$。请用周期数表示 $M$ 的最终值。无需四舍五入。",
            "solution": "该问题要求计算一个由数据流图（DFG）表示的一组操作的总移动性。这涉及确定每个操作的尽早调度（ASAP）和尽晚调度（ALAP）。\n\n首先，必须验证问题陈述。\n\n### 步骤1：提取给定信息\n-   **顶点**：DFG由九个顶点组成，$v_1, v_2, \\dots, v_9$。\n-   **操作与延迟 ($L_i$)**：\n    -   乘法（延迟 $L_{mul} = 2$ 个周期）：操作 $v_1, v_2, v_6$。\n    -   加法（延迟 $L_{add} = 1$ 个周期）：操作 $v_3, v_4, v_7, v_8, v_9$。\n    -   减法（延迟 $L_{sub} = 1$ 个周期）：操作 $v_5$。\n-   **先行约束**：\n    -   $v_1$：无前驱。\n    -   $v_2$：无前驱。\n    -   $v_3$ 的前驱为 $\\{v_1, v_2\\}$。\n    -   $v_4$ 的前驱为 $\\{v_2\\}$。\n    -   $v_5$ 的前驱为 $\\{v_3, v_4\\}$。\n    -   $v_6$ 的前驱为 $\\{v_5\\}$。\n    -   $v_7$ 的前驱为 $\\{v_3\\}$。\n    -   $v_8$ 的前驱为 $\\{v_7\\}$。\n    -   $v_9$ 的前驱为 $\\{v_6, v_8\\}$。\n-   **初始条件**：所有初始输入在时间 $t=0$ 可用。\n-   **全局约束**：最终操作 $v_9$ 的最大完成时间为 $T_{\\text{req}} = 9$ 个周期。\n-   **目标**：计算总移动性 $M = \\sum_{i=1}^{9} m_i$，其中 $m_i$ 是操作 $v_i$ 的移动性。\n\n### 步骤2：使用提取的给定信息进行验证\n根据验证标准对问题进行评估：\n-   **科学依据**：该问题是高层次综合（HLS）中的一个标准练习，这是电子设计自动化（EDA）和数字电路设计中的一个核心主题。DFG、调度、延迟、ASAP、ALAP和移动性等概念是该领域的基本原理。\n-   **定义明确**：问题提供了一个完整的DFG、明确的操作延迟和一个清晰的时间约束。这允许确定性地计算出唯一的ASAP和ALAP调度，从而得到唯一的总移动性。\n-   **客观性**：问题使用相关科学领域的正式、标准术语陈述，没有主观或模糊的语言。\n\n该问题被认为是完整的、一致的且科学上合理的。它没有表现出问题验证部分列出的任何缺陷。\n\n### 步骤3：结论与行动\n该问题是**有效的**。将提供解答。\n\n### 解答推导\n\n我们将操作 $v_i$ 的开始时间定义为 $S_i$，其延迟为 $L_i$。该操作的结果在时间 $S_i + L_i$ 可用。对于一个依赖于 $v_i$ 输出的操作 $v_j$，其开始时间必须满足约束 $S_j \\ge S_i + L_i$。\n\n各操作的延迟为：\n$L_1=2$, $L_2=2$, $L_3=1$, $L_4=1$, $L_5=1$, $L_6=2$, $L_7=1$, $L_8=1$, $L_9=1$。\n\n**1. 尽早调度 (ASAP)**\n\nASAP开始时间 $S_{A,i}$ 是操作 $v_i$ 可以开始的最早时间。对于没有前驱的操作，开始时间为 $0$。对于其他操作，其开始时间由其前驱的完成时间决定。\n控制方程为：\n$$S_{A,i} = \\max_{v_j \\in \\text{Pred}(v_i)} \\{ S_{A,j} + L_j \\}$$\n如果 $\\text{Pred}(v_i)$ 为空，则 $S_{A,i} = 0$。\n\n-   $S_{A,1} = 0$\n-   $S_{A,2} = 0$\n-   $S_{A,3} = \\max(S_{A,1} + L_1, S_{A,2} + L_2) = \\max(0+2, 0+2) = 2$\n-   $S_{A,4} = S_{A,2} + L_2 = 0 + 2 = 2$\n-   $S_{A,5} = \\max(S_{A,3} + L_3, S_{A,4} + L_4) = \\max(2+1, 2+1) = 3$\n-   $S_{A,6} = S_{A,5} + L_5 = 3 + 1 = 4$\n-   $S_{A,7} = S_{A,3} + L_3 = 2 + 1 = 3$\n-   $S_{A,8} = S_{A,7} + L_7 = 3 + 1 = 4$\n-   $S_{A,9} = \\max(S_{A,6} + L_6, S_{A,8} + L_8) = \\max(4+2, 4+1) = \\max(6, 5) = 6$\n\n关键路径长度是ASAP调度中最终操作的完成时间，即 $T_{crit} = S_{A,9} + L_9 = 6 + 1 = 7$ 个周期。\n\n**2. 尽晚调度 (ALAP)**\n\nALAP开始时间 $S_{L,i}$ 是操作 $v_i$ 在不违反总要求时间 $T_{\\text{req}}$ 的前提下可以开始的最晚时间。我们从汇点节点向后计算。最终操作 $v_9$ 的完成时间不得晚于 $T_{\\text{req}}$。因此，$S_{L,9} + L_9 \\le T_{\\text{req}}$。对于最晚调度，我们设置 $S_{L,9} + L_9 = T_{\\text{req}}$。\n控制方程为：\n$$S_{L,i} = \\min_{v_j \\in \\text{Succ}(v_i)} \\{ S_{L,j} \\} - L_i$$\n-   对于 $v_9$，$S_{L,9} = T_{\\text{req}} - L_9 = 9 - 1 = 8$。\n-   $v_8$ 是 $v_9$ 的前驱：$S_{L,8} = S_{L,9} - L_8 = 8 - 1 = 7$。\n-   $v_7$ 是 $v_8$ 的前驱：$S_{L,7} = S_{L,8} - L_7 = 7 - 1 = 6$。\n-   $v_6$ 是 $v_9$ 的前驱：$S_{L,6} = S_{L,9} - L_6 = 8 - 2 = 6$。\n-   $v_5$ 是 $v_6$ 的前驱：$S_{L,5} = S_{L,6} - L_5 = 6 - 1 = 5$。\n-   $v_4$ 是 $v_5$ 的前驱：$S_{L,4} = S_{L,5} - L_4 = 5 - 1 = 4$。\n-   $v_3$ 的后继为 $\\{v_5, v_7\\}$：$S_{L,3} = \\min(S_{L,5}, S_{L,7}) - L_3 = \\min(5, 6) - 1 = 5 - 1 = 4$。\n-   $v_2$ 的后继为 $\\{v_3, v_4\\}$：$S_{L,2} = \\min(S_{L,3}, S_{L,4}) - L_2 = \\min(4, 4) - 2 = 4 - 2 = 2$。\n-   $v_1$ 是 $v_3$ 的前驱：$S_{L,1} = S_{L,3} - L_1 = 4 - 2 = 2$。\n\n**3. 移动性计算**\n\n操作 $v_i$ 的移动性，记作 $m_i$，是其可以被调度的时间周期范围。它通过其ALAP和ASAP开始时间之差计算得出：$m_i = S_{L,i} - S_{A,i}$。\n\n-   $m_1 = S_{L,1} - S_{A,1} = 2 - 0 = 2$\n-   $m_2 = S_{L,2} - S_{A,2} = 2 - 0 = 2$\n-   $m_3 = S_{L,3} - S_{A,3} = 4 - 2 = 2$\n-   $m_4 = S_{L,4} - S_{A,4} = 4 - 2 = 2$\n-   $m_5 = S_{L,5} - S_{A,5} = 5 - 3 = 2$\n-   $m_6 = S_{L,6} - S_{A,6} = 6 - 4 = 2$\n-   $m_7 = S_{L,7} - S_{A,7} = 6 - 3 = 3$\n-   $m_8 = S_{L,8} - S_{A,8} = 7 - 4 = 3$\n-   $m_9 = S_{L,9} - S_{A,9} = 8 - 6 = 2$\n\n**4. 总移动性计算**\n\n总移动性 $M$ 是DFG中所有操作的个体移动性之和。\n$$M = \\sum_{i=1}^{9} m_i$$\n$$M = m_1 + m_2 + m_3 + m_4 + m_5 + m_6 + m_7 + m_8 + m_9$$\n$$M = 2 + 2 + 2 + 2 + 2 + 2 + 3 + 3 + 2$$\n$$M = (7 \\times 2) + (2 \\times 3) = 14 + 6 = 20$$\n给定DFG的总移动性为 $20$ 个周期。",
            "answer": "$$\\boxed{20}$$"
        },
        {
            "introduction": "在确定了操作的调度时间后，下一步就是为它们分配具体的硬件资源。这个过程的核心是识别并发操作的峰值，因为它直接决定了所需资源实例的最小数量。本练习将基于一个已调度的操作集合，通过分析资源占用区间来计算实现该调度所需的最小加法器数量，从而将抽象的调度计划转化为具体的硬件需求。",
            "id": "4293564",
            "problem": "考虑一组已在高层次综合（HLS）中调度的加法操作，其中高层次综合（HLS）指的是从算法规范自动生成寄存器传输级实现的过程。每个加法操作都在一个相同的、非流水线加法器上实现，其固定延迟为 $L$ 个时钟周期。一个延迟为 $L$ 的非流水线加法器，从其开始时间起占用硬件，直至 $L$ 个周期过去，在此期间阻止另一个操作在同一个加法器上启动。假设调度以整数时钟周期的开始时间给出，并且在数据依赖方面是可行的。设延迟为 $L = 3$ 个周期。这 9 个加法操作的调度开始时间为\n$$\n\\{\\,0,\\,2,\\,3,\\,5,\\,6,\\,7,\\,9,\\,10,\\,12\\,\\}.\n$$\n在标准的绑定约束下，当且仅当两个操作的资源占用区间不重叠时，它们才可以共享一个加法器。使用资源占用和冲突的基本定义，推导在不违反时序的情况下绑定所有这些操作所需的最少加法器实例数。作为推导的一部分，请论证给定集合中至少有一对操作可以在不重叠的情况下共享一个加法器。将最终答案表示为所需的最少加法器整数数量。无需四舍五入，所有时间均以周期表示。",
            "solution": "用户提供的问题被评估为有效。它在科学上基于数字电路设计的高层次综合（HLS）原理，问题设定良好，目标明确，数据充分，并且以客观、明确的术语表达。\n\n问题的核心是确定在固定调度下实现给定操作集所需的最少功能单元（加法器）数量。这是一个经典的资源分配问题。所需的最少资源数量由必须并发执行的最大操作数决定。\n\n首先，我们必须定义每个操作的资源占用情况。问题陈述，每个加法操作都在一个延迟为 $L = 3$ 个时钟周期的非流水线加法器上执行。对于一个开始时间为 $t_{start}$ 的操作，非流水线资源在操作的整个持续时间内被占用。这意味着资源从 $t_{start}$ 周期开始，连续占用 $L$ 个时钟周期。资源占用可以用一个时间区间来表示。如果一个操作在时钟周期 $t_i$ 开始，它会占用一个加法器 $t_i$、$t_i+1$ 和 $t_i+2$ 这几个周期。这对应于连续时间区间 $[t_i, t_i+L)$，对于本问题即为 $[t_i, t_i+3)$。\n\n给定的 9 个加法操作的开始时间集合为 $T = \\{\\,0,\\,2,\\,3,\\,5,\\,6,\\,7,\\,9,\\,10,\\,12\\,\\}$。我们可以列出每个操作的占用区间：\n\\begin{itemize}\n    \\item 操作 1：开始时间 $t_1 = 0$，占用区间 $I_1 = [0, 0+3) = [0, 3)$。\n    \\item 操作 2：开始时间 $t_2 = 2$，占用区间 $I_2 = [2, 2+3) = [2, 5)$。\n    \\item 操作 3：开始时间 $t_3 = 3$，占用区间 $I_3 = [3, 3+3) = [3, 6)$。\n    \\item 操作 4：开始时间 $t_4 = 5$，占用区间 $I_4 = [5, 5+3) = [5, 8)$。\n    \\item 操作 5：开始时间 $t_5 = 6$，占用区间 $I_5 = [6, 6+3) = [6, 9)$。\n    \\item 操作 6：开始时间 $t_6 = 7$，占用区间 $I_6 = [7, 7+3) = [7, 10)$。\n    \\item 操作 7：开始时间 $t_7 = 9$，占用区间 $I_7 = [9, 9+3) = [9, 12)$。\n    \\item 操作 8：开始时间 $t_8 = 10$，占用区间 $I_8 = [10, 10+3) = [10, 13)$。\n    \\item 操作 9：开始时间 $t_9 = 12$，占用区间 $I_9 = [12, 12+3) = [12, 15)$。\n\\end{itemize}\n\n如果两个操作的占用区间重叠，它们就会产生资源冲突。所需的最少加法器数量等于在任何单个时间点上重叠区间的最大数量。这也被称为与这些操作相对应的区间图中的最大团的大小。\n\n为了找到这个最大重叠数，我们可以分析随时间变化的活动操作数量。设 $N(t)$ 为时间 $t$ 的活动操作数。我们需要找到 $\\max_{t} N(t)$。$N(t)$ 的值仅在区间的开始或结束时间点发生变化。我们可以检查由这些开始和结束点定义的时间段内的活动操作数。\n\n一个更直接的方法是确定最大并发点。让我们检查这些区间：\n\\begin{itemize}\n    \\item 在 $t = 2.5$ 时：区间 $I_1 = [0, 3)$ 和 $I_2 = [2, 5)$ 重叠。$N(2.5) = 2$。\n    \\item 在 $t = 3.5$ 时：区间 $I_2 = [2, 5)$ 和 $I_3 = [3, 6)$ 重叠。$N(3.5) = 2$。\n    \\item 在 $t = 5.5$ 时：区间 $I_3 = [3, 6)$ 和 $I_4 = [5, 8)$ 重叠。$N(5.5) = 2$。\n    \\item 在 $t = 6.5$ 时：区间 $I_4 = [5, 8)$ 和 $I_5 = [6, 9)$ 重叠。$N(6.5) = 2$。\n    \\item 在 $t = 7.5$ 时：区间 $I_4 = [5, 8)$、$I_5 = [6, 9)$ 和 $I_6 = [7, 10)$ 全部重叠。对于区间 $[7, 8)$ 内的任何时间 $t$，这三个操作都是并发活动的。例如，在 $t=7$ 时，操作 4 处于其第三个周期，操作 5 处于其第二个周期，操作 6 处于其第一个周期。因此，$N(7.5) = 3$。\n    \\item 在 $t = 8.5$ 时：区间 $I_5 = [6, 9)$ 和 $I_6 = [7, 10)$ 重叠。$N(8.5) = 2$。\n    \\item 在 $t = 9.5$ 时：区间 $I_6 = [7, 10)$ 和 $I_7 = [9, 12)$ 重叠。$N(9.5) = 2$。\n    \\item 在 $t = 10.5$ 时：区间 $I_7 = [9, 12)$ 和 $I_8 = [10, 13)$ 重叠。$N(10.5) = 2$。\n    \\item 在 $t = 12.5$ 时：区间 $I_8 = [10, 13)$ 和 $I_9 = [12, 15)$ 重叠。$N(12.5) = 2$。\n\\end{itemize}\n观察到的最大并发操作数为 $3$，发生在时间区间 $[7, 8)$。这种峰值并发性要求三个不同的加法器单元同时可用。因此，所需的最少加法器数量为 $3$。\n\n问题还要求论证至少有一对操作可以共享一个加法器。根据绑定约束，如果它们的资源占用区间不重叠，这是可能的。让我们考虑操作 1（开始时间 $t_1=0$）和操作 3（开始时间 $t_3=3$）。\n\\begin{itemize}\n    \\item 操作 1 的占用区间是 $I_1 = [0, 3)$。加法器在周期 $0$、$1$ 和 $2$ 被占用。它在周期 $3$ 的开始时刻变为空闲。\n    \\item 操作 3 的占用区间是 $I_3 = [3, 6)$。该操作从周期 $3$ 开始需要一个加法器。\n\\end{itemize}\n由于区间 $I_1$ 在时间 $t=3$ 结束，而区间 $I_3$ 在时间 $t=3$ 开始，它们的区间 $[0, 3)$ 和 $[3, 6)$ 是不相交的（它们仅在边界点接触，在离散时钟周期和占用区间定义为 $[start, end)$ 的上下文中，这不构成重叠）。因此，单个加法器可以执行操作 1，然后在它完成后立即执行操作 3。这证明了有效的资源共享。\n\n基于对最大并发性的分析，最少加法器数量由峰值需求决定。峰值需求是 3 个加法器。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "前面的练习分别探讨了调度灵活性和从调度到资源分配的过程，但在实践中，这些决策是相互影响的，分开处理可能无法得到全局最优解。整数线性规划（ILP）提供了一个强大的数学框架，能够将调度、资源分配和绑定统一在一个模型中，以求得在满足所有约束条件下的最小面积（成本）解。通过这个练习，你将为一个小型设计实例构建并求解一个ILP模型，体验如何形式化地表达并解决这一复杂的组合优化问题。",
            "id": "4293535",
            "problem": "一个用于电子设计自动化 (EDA) 的高层次综合 (HLS) 实例由一个带优先级约束的有向无环操作图、具有以离散时钟周期为单位的固定延迟的资源类型，以及一个为实例化每种资源类型的每个单元分配成本的面积模型来规定。调度与绑定问题是为每个操作选择开始周期，并为每种资源类型选择要实例化的单元数量，使得在给定的延迟界限下，所有优先级和资源容量约束都得到满足。目标是最小化总面积。\n\n考虑以下具有 $3$ 个操作和 $2$ 种资源类型的实例：\n- 操作：$v_1$ 是M类型的乘法，延迟为 $\\ell_M = 2$ 个周期；$v_2$ 是A类型的加法，延迟为 $\\ell_A = 1$ 个周期；$v_3$ 是A类型的加法，延迟为 $\\ell_A = 1$ 个周期。\n- 优先级约束：$v_1$ 产生一个中间值，该值被 $v_2$ 和 $v_3$ 共同消耗，即 $v_1 \\rightarrow v_2$ 和 $v_1 \\rightarrow v_3$。\n- 时间范围：周期 $t \\in \\{1, 2, 3, 4\\}$。\n- 面积权重：每个乘法器单元的面积权重为 $w_M = 3$，每个加法器单元的面积权重为 $w_A = 1$。\n- 延迟界限：所有操作必须在第4周期前完成。\n\n构建一个整数线性规划 (ILP) 模型来联合执行资源分配和绑定：\n- 决策变量必须包括二进制开始时间变量 $x_{i,t} \\in \\{0,1\\}$（表示操作 $v_i$ 是否在周期 $t$ 开始），以及非负整数资源计数变量 $q_M \\in \\mathbb{Z}_{\\ge 0}$ 和 $q_A \\in \\mathbb{Z}_{\\ge 0}$（分别表示实例化的乘法器和加法器的数量）。\n- 该模型必须强制每个操作被精确调度一次，优先级约束得到满足，没有操作在其由延迟界限所隐含的可行窗口之外开始，并且在每个周期，给定类型的并发活动操作的数量不超过该类型的可用实例数量。\n- 目标必须是最小化总面积 $J = w_M q_M + w_A q_A$。\n\n求解此 ILP 以获得最优调度和绑定，然后解释与每个周期的资源容量约束相对应的线性规划松弛的对偶变量。特别地，给出在周期 $t \\in \\{1,2,3,4\\}$ 内，M类型和A类型的容量约束的一组一致的非负对偶乘子，使其满足与您的最优原始解的互补松弛性，并简要解释这些对偶乘子的经济学含义（价格信号）。\n\n将最优最小面积目标值 $J$ 作为一个无单位的纯数字报告为您的最终数值答案。如果需要任何四舍五入，则四舍五入到四位有效数字；否则，提供精确的整数值。",
            "solution": "该问题已经过验证并被认为是有效的。这是一个在电子设计自动化的高层次综合领域中的良定问题，基于整数线性规划和资源受限调度的既定原则。所有必要的数据都已提供，并且该问题没有科学缺陷、矛盾或歧义。\n\n我们按要求继续构建并求解该整数线性规划 (ILP) 模型。\n\n**1. ILP 公式化**\n\n首先，我们为模型定义集合、参数和决策变量。\n\n**集合与参数：**\n- 操作：$V = \\{v_1, v_2, v_3\\}$。\n- 资源类型：$R = \\{M, A\\}$ (乘法器，加法器)。\n- 时间范围（周期）：$T = \\{1, 2, 3, 4\\}$。\n- 操作延迟：$\\ell_1 = \\ell_M = 2$, $\\ell_2 = \\ell_A = 1$, $\\ell_3 = \\ell_A = 1$。\n- 操作类型：$Type(v_1) = M$, $Type(v_2) = A$, $Type(v_3) = A$。\n- 面积权重：$w_M = 3$, $w_A = 1$。\n- 优先级约束：$v_1 \\rightarrow v_2$, $v_1 \\rightarrow v_3$。\n\n**可行开始时间：**\n具有延迟 $\\ell_i$ 的操作 $v_i$ 必须在第4周期结束前完成。如果它在周期 $t$ 开始，它将在周期 $t+\\ell_i-1$ 结束时完成。因此，我们必须有 $t+\\ell_i-1 \\le 4$，这意味着 $t \\le 5-\\ell_i$。\n- 对于 $v_1$ ($\\ell_1=2$)：$t_1 \\le 5-2 = 3$。可能的开始时间集合是 $T_1 = \\{1, 2, 3\\}$。\n- 对于 $v_2$ ($\\ell_2=1$)：$t_2 \\le 5-1 = 4$。可能的开始时间集合是 $T_2 = \\{1, 2, 3, 4\\}$。\n- 对于 $v_3$ ($\\ell_3=1$)：$t_3 \\le 5-1 = 4$。可能的开始时间集合是 $T_3 = \\{1, 2, 3, 4\\}$。\n\n根据优先级约束，$v_2$ 和 $v_3$ 必须在 $v_1$ 完成后开始。$v_1$ 的最早开始时间是 $t=1$，意味着它在周期 $1+2-1=2$ 结束时完成。所以，$v_2$ 和 $v_3$ 不能在第3周期之前开始。这进一步限制了它们的开始时间：$T_2 = \\{3, 4\\}$ 和 $T_3 = \\{3, 4\\}$。如果 $v_1$ 在 $t=2$ 开始，它在第3周期完成，所以 $v_2,v_3$ 必须在 $t \\ge 4$ 开始。如果 $v_1$ 在 $t=3$ 开始，它在第4周期完成，所以 $v_2,v_3$ 必须在 $t \\ge 5$ 开始，这是不可能的。因此，$v_1$ 的开始时间实际上被限制在 $T_1=\\{1, 2\\}$。\n\n**决策变量：**\n- 二进制开始时间变量：$x_{i,t} \\in \\{0, 1\\}$，对于 $i \\in \\{1, 2, 3\\}$ 和 $t \\in T_i$。如果操作 $v_i$ 在周期 $t$ 开始，则 $x_{i,t}=1$，否则为 $0$。\n- 非负整数资源计数变量：$q_M, q_A \\in \\mathbb{Z}_{\\ge 0}$。\n\n**目标函数：**\n目标是最小化总面积，即实例化的资源单元数量的加权和。\n$$ \\text{最小化} \\quad J = w_M q_M + w_A q_A = 3q_M + q_A $$\n\n**约束条件：**\n1.  **唯一调度约束：** 每个操作必须在其可行窗口内被精确调度一次。\n    $$ \\sum_{t \\in T_1} x_{1,t} = \\sum_{t=1}^{2} x_{1,t} = 1 $$\n    $$ \\sum_{t \\in T_2} x_{2,t} = \\sum_{t=3}^{4} x_{2,t} = 1 $$\n    $$ \\sum_{t \\in T_3} x_{3,t} = \\sum_{t=3}^{4} x_{3,t} = 1 $$\n\n2.  **优先级约束：** 令 $S_i = \\sum_{t \\in T_i} t \\cdot x_{i,t}$ 为操作 $v_i$ 的开始时间。后继操作 ($v_2, v_3$) 的开始时间不得早于前驱操作 ($v_1$) 的完成时间。$v_1$ 的完成时间是 $S_1 + \\ell_1 - 1$。后继操作的开始时间必须大于此时间，即 $S_j \\ge S_1 + \\ell_1$。\n    $$ \\sum_{t \\in T_2} t \\cdot x_{2,t} \\ge \\sum_{t \\in T_1} t \\cdot x_{1,t} + \\ell_1 \\quad \\implies \\quad \\sum_{t=3}^{4} t \\cdot x_{2,t} - \\sum_{t=1}^{2} t \\cdot x_{1,t} \\ge 2 $$\n    $$ \\sum_{t \\in T_3} t \\cdot x_{3,t} \\ge \\sum_{t \\in T_1} t \\cdot x_{1,t} + \\ell_1 \\quad \\implies \\quad \\sum_{t=3}^{4} t \\cdot x_{3,t} - \\sum_{t=1}^{2} t \\cdot x_{1,t} \\ge 2 $$\n\n3.  **资源容量约束：** 对于每种资源类型 $r \\in \\{M, A\\}$ 和每个周期 $k \\in T=\\{1,2,3,4\\}$，该类型并发活动的操作数量不得超过分配的资源数量 $q_r$。如果操作 $v_i$ 在时间 $t$ 开始，且满足 $t \\le k  t + \\ell_i$，则该操作在周期 $k$ 处于活动状态。\n    -   **乘法器 (类型 M)：** 操作 $v_1$ 的延迟为 $\\ell_1=2$。\n        -   $k=1: x_{1,1} \\le q_M$\n        -   $k=2: x_{1,1} + x_{1,2} \\le q_M$\n        -   $k=3: x_{1,2} + x_{1,3} \\le q_M$ (但 $x_{1,3}=0$，所以 $x_{1,2} \\le q_M$)\n        -   $k=4: x_{1,3} + x_{1,4} \\le q_M$ (但 $x_{1,3}=x_{1,4}=0$，所以 $0 \\le q_M$)\n    -   **加法器 (类型 A)：** 操作 $v_2, v_3$ 的延迟为 $\\ell_2=\\ell_3=1$。\n        -   $k=1: x_{2,1}+x_{3,1} \\le q_A$ (但 $x_{2,1}=x_{3,1}=0$，所以 $0 \\le q_A$)\n        -   $k=2: x_{2,2}+x_{3,2} \\le q_A$ (但 $x_{2,2}=x_{3,2}=0$，所以 $0 \\le q_A$)\n        -   $k=3: x_{2,3}+x_{3,3} \\le q_A$\n        -   $k=4: x_{2,4}+x_{3,4} \\le q_A$\n\n**2. 求解 ILP**\n\n我们可以通过枚举 $v_1$ 的少数有效调度来解决这个小实例。如前所定，$v_1$ 只能在 $t=1$ 或 $t=2$ 开始。\n\n**情况1：$v_1$ 在 $t=1$ 开始 ($x_{1,1}=1$)**\n- $v_1$ 在周期1和2期间处于活动状态。根据M类型的资源约束，$x_{1,1} \\le q_M \\implies 1 \\le q_M$，以及 $x_{1,1}+x_{1,2} \\le q_M \\implies 1+0 \\le q_M$。因此，我们至少需要 $q_M=1$。\n- 优先级约束要求 $v_2$ 和 $v_3$ 在 $t \\ge 1+2 = 3$ 开始。它们可能的开始时间是 $t=3$ 或 $t=4$。\n- **子情况1a：串行调度 $v_2$ 和 $v_3$。** 我们可以设置 $x_{2,3}=1$ 和 $x_{3,4}=1$。\n    - 在 $k=3$ 时的加法器使用情况：$x_{2,3}+x_{3,3}=1+0=1$。我们需要 $q_A \\ge 1$。\n    - 在 $k=4$ 时的加法器使用情况：$x_{2,4}+x_{3,4}=0+1=1$。我们需要 $q_A \\ge 1$。\n    - 这个调度需要 $q_M=1$ 和 $q_A=1$。总面积为 $J = 3(1) + 1(1) = 4$。\n- **子情况1b：并行调度 $v_2$ 和 $v_3$。** 我们可以设置 $x_{2,3}=1$ 和 $x_{3,3}=1$。\n    - 在 $k=3$ 时的加法器使用情况：$x_{2,3}+x_{3,3}=1+1=2$。我们需要 $q_A \\ge 2$。\n    - 这个调度需要 $q_M=1$ 和 $q_A=2$。总面积为 $J = 3(1) + 1(2) = 5$。\n\n**情况2：$v_1$ 在 $t=2$ 开始 ($x_{1,2}=1$)**\n- $v_1$ 在周期2和3期间处于活动状态。根据M类型的资源约束，这要求 $q_M \\ge 1$。\n- 优先级约束要求 $v_2$ 和 $v_3$ 在 $t \\ge 2+2=4$ 开始。唯一可能的开始时间是 $t=4$。\n- 因此，我们必须有 $x_{2,4}=1$ 和 $x_{3,4}=1$。\n- 在 $k=4$ 时的加法器使用情况：$x_{2,4}+x_{3,4}=1+1=2$。我们需要 $q_A \\ge 2$。\n- 这个调度需要 $q_M=1$ 和 $q_A=2$。总面积为 $J = 3(1) + 1(2) = 5$。\n\n**最优解：**\n比较成本，最小面积为 $J=4$，在子情况1a中实现。\n- **最优资源分配：** $q_M=1$, $q_A=1$。\n- **最优调度：** $v_1$ 在 $t=1$ 开始，$v_2$ 在 $t=3$ 开始，$v_3$ 在 $t=4$ 开始。\n(注意：交换 $v_2$ 和 $v_3$ 的开始时间会得到一个等价的最优解)。\n最小面积目标值为 $J=4$。\n\n**3. 对偶变量与解释**\n\n我们分析在找到的最优解处，资源容量约束的线性规划(LP)松弛的对偶变量。令 $\\lambda_{r,k}$ 为资源类型 $r$ 在周期 $k$ 的容量约束的对偶变量（影子价格）。\n\n对于最优解（$q_M=1, q_A=1, x_{1,1}=1, x_{2,3}=1, x_{3,4}=1$）：\n- **乘法器约束 (类型 M)：**\n    - $k=1: x_{1,1} \\le q_M \\implies 1 \\le 1$。约束是**紧**的。\n    - $k=2: x_{1,1}+x_{1,2} \\le q_M \\implies 1+0 \\le 1$。约束是**紧**的。\n    - $k=3: x_{1,2} \\le q_M \\implies 0 \\le 1$。约束不是紧的。\n    - $k=4: 0 \\le q_M$。约束不是紧的。\n- **加法器约束 (类型 A)：**\n    - $k=1,2$: 约束为 $0 \\le q_A$。不是紧的。\n    - $k=3: x_{2,3}+x_{3,3} \\le q_A \\implies 1+0 \\le 1$。约束是**紧**的。\n    - $k=4: x_{2,4}+x_{3,4} \\le q_A \\implies 0+1 \\le 1$。约束是**紧**的。\n\n根据互补松弛性原理，如果一个约束不是紧的，其对应的对偶变量必须为零。\n- $\\lambda_{M,3} = 0$ 且 $\\lambda_{M,4} = 0$。\n- $\\lambda_{A,1} = 0$ 且 $\\lambda_{A,2} = 0$。\n\n对于 LP 松弛的最优解，给定资源类型的容量约束的对偶变量之和必须等于该资源的面积权重，前提是该资源被使用 ($q_r > 0$)。\n$$ \\sum_{k=1}^{4} \\lambda_{M,k} = w_M = 3 \\quad \\implies \\quad \\lambda_{M,1} + \\lambda_{M,2} = 3 $$\n$$ \\sum_{k=1}^{4} \\lambda_{A,k} = w_A = 1 \\quad \\implies \\quad \\lambda_{A,3} + \\lambda_{A,4} = 1 $$\n\n我们需要提供一组一致的非负对偶乘子。一个简单、一致的选择是将总价格均匀分配到资源约束为紧的周期上。\n- 对于乘法器，在周期1和2使用：$\\lambda_{M,1} = 1.5$ 和 $\\lambda_{M,2} = 1.5$。\n- 对于加法器，在周期3和4使用：$\\lambda_{A,3} = 0.5$ 和 $\\lambda_{A,4} = 0.5$。\n\n因此，一组一致的对偶乘子是：\n- $\\lambda_M = (1.5, 1.5, 0, 0)$\n- $\\lambda_A = (0, 0, 0.5, 0.5)$\n\n**经济学解释：**\n对偶变量 $\\lambda_{r,k}$ 表示在周期 $k$ 需要一个单位资源 $r$ 所带来的边际成本（以总面积计）。它是特定时间使用资源的价格。\n\n- 乘法器的总“价值”，即在其调度中的有效生命周期内的价值总和，是 $\\lambda_{M,1} + \\lambda_{M,2} = 1.5 + 1.5 = 3$，等于其面积成本 $w_M$。每个周期1.5的价格反映了乘法器在周期1和周期2都是瓶颈。\n- 加法器的总“价值”是 $\\lambda_{A,3} + \\lambda_{A,4} = 0.5 + 0.5 = 1$，等于其面积成本 $w_A$。这个价格被分配到周期3和4，因为单个加法器在这两个周期都是瓶颈（串行执行 $v_2$ 和 $v_3$）。\n- 值为零的对偶变量（$\\lambda_{M,3}, \\lambda_{M,4}, \\lambda_{A,1}, \\lambda_{A,2}$）表明在那些时间，这些资源有剩余容量。在第3周期引入一个需要乘法器的新操作，或在第1周期引入一个需要加法器的新操作，一阶近似下不会增加所需的资源数量，因此不会增加总面积成本。这些时间槽代表“免费”容量。",
            "answer": "$$\\boxed{4}$$"
        }
    ]
}