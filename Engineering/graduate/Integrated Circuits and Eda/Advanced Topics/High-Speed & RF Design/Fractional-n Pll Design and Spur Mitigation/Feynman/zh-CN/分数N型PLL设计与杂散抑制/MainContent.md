## 引言
在现代[无线通信](@entry_id:266253)和高速数字系统中，对频率源的精度和灵活性提出了前所未有的要求。传统的整数N[分频](@entry_id:162771)锁相环（PLL）因其固有的频率步进限制，已无法满足密集信道间隔和精细频率调谐的需求。为突破这一瓶颈，小数N分频锁相环应运而生，它通过在时间上“平均”不同的[分频](@entry_id:162771)比，实现了极高的频率分辨率。然而，这种看似优雅的解决方案也带来了一个棘手的副作用——在输出[频谱](@entry_id:276824)上产生不必要的“杂散”（spurs），严重影响信号质量和系统性能。理解这些杂散的来源并掌握其抑制方法，是每一个现代射频和时钟电路设计师必须面对的核心挑战。

本文将系统性地剖析小数N分频[锁相环](@entry_id:271717)中的杂散问题。在第一部分“原理与机制”中，我们将深入探讨[小数杂散](@entry_id:1125281)是如何从理想的ΔΣ调制器量化过程中诞生，以及电路的非理想性又是如何与之“共谋”放大问题的。接着，在“应用与跨学科联结”部分，我们将把目光投向现实世界的设计权衡、仿真验证策略以及解决这些问题所需的跨学科知识。最后，通过“动手实践”环节，读者将有机会运用所学知识解决具体的设计与分析问题。这趟旅程将揭示，一个高性能PLL的诞生，正是在深刻的理论理解与精湛的工程实践之间取得完美平衡的艺术。

## 原理与机制

### 追求更精细的步进：从整数到分数

想象一下，你有一把只能以整厘米为单位进行测量的尺子。如果你想测量一个物体的长度为3.5厘米，你会怎么做？这正是老式锁相环（PLL）设计师面临的困境。在经典的**整数N分频[锁相环](@entry_id:271717)**（Integer-N PLL）中，输出频率 $f_{\mathrm{out}}$ 必须是参考频率 $f_{\mathrm{ref}}$ 的整数倍，即 $f_{\mathrm{out}} = N \times f_{\mathrm{ref}}$。这种架构简单而稳健，但它的[频率分辨率](@entry_id:143240)被死死地锁定在了 $f_{\mathrm{ref}}$。在现代[无线通信](@entry_id:266253)中，信道间隔远小于典型的参考频率，这就好比要求我们用一把厘米尺去精确测量一粒沙子。

面对这个挑战，工程师们提出了一个绝妙而又看似简单的想法：如果我们不能直接得到一个小数倍数，那我们能否通过“平均”来实现呢？这就是**小数N[分频](@entry_id:162771)锁相环**（Fractional-N PLL）的核心思想。设想一下，如果我们想实现 $N+\alpha$ 的平均[分频](@entry_id:162771)比，其中 $N$ 是整数，$\alpha$ 是小数部分，我们可以让[分频器](@entry_id:177929)在一段时间内以 $N+1$ 的比例进行分频，在另一段时间内以 $N$ 的比例进行[分频](@entry_id:162771)。只要我们精确控制这两段时间的比例，就能在时间上得到我们想要的平均分频比 。这就像一位画家，通过快速地交替涂抹红色和黄色，让你的眼睛看到橙色一样。这个想法如此优雅，以至于它几乎掩盖了其背后深刻而复杂的物理现实。我们很快就会发现，这种看似简单的“平均”操作，在锁相环的精密世界里掀起了一场不小的风波。

### 机器中的幽灵：[小数杂散](@entry_id:1125281)的诞生

让我们仔细审视这个在 $N$ 和 $N+1$ 之间切换的过程。[锁相环](@entry_id:271717)的核心是一个反馈系统，它不断地比较参考信号相位和[分频](@entry_id:162771)后的输出信号相位，并试图将二者之间的[相位误差](@entry_id:162993) $\Delta\phi$ 降为零。当我们动态地改变分频比时，我们实际上是在有意识地、周期性地向这个反馈环路中注入一个相位误差。

这个误差是如何产生的呢？现代小数N分频锁相环通常使用一个被称为**ΔΣ调制器**（Delta-Sigma Modulator, DSM）的数字电路来控制[分频](@entry_id:162771)比的切换。最简单的DSM可以想象成一个带[溢出](@entry_id:172355)功能的[累加器](@entry_id:175215) 。假设我们想实现的小数部分是 $\alpha$，在每个参考[时钟周期](@entry_id:165839)，我们都将 $\alpha$ 加到[累加器](@entry_id:175215)中。[累加器](@entry_id:175215)的值代表了我们“欠下”的相位。当这个累加值超过1时，就发生一次“[溢出](@entry_id:172355)”，我们就在下一个周期让[分频器](@entry_id:177929)除以 $N+1$ 来“偿还”这个相位，同时从[累加器](@entry_id:175215)中减去1。如果不[溢出](@entry_id:172355)，[分频器](@entry_id:177929)就继续除以 $N$。

这里的关键在于，如果小数部分 $\alpha$ 是一个有理数，比如 $\alpha = p/q$（其中 $p$ 和 $q$ 是[互质整数](@entry_id:152973)），那么这个累加和溢出的过程就不是随机的，而是完全确定的、周期性的！[累加器](@entry_id:175215)的状态值序列会以 $q$ 个参考周期为单位精确地重复。因此，我们选择 $N+1$ 分频的时刻序列也是周期性的，其周期同样为 $q$ 。举个例子，如果 $\alpha = 137/512$，那么这个分频切换的完整模式会每 $512$ 个参考时钟周期重复一次 。

现在，激动人心的时刻到了。这个周期性的[分频](@entry_id:162771)误差，对于[锁相环](@entry_id:271717)来说，就是一个不折不扣的“信号”。它就像一个幽灵，在机器内部以 $f_{\mathrm{ref}}/q$ 的频率有节奏地“敲击”着系统。物理学告诉我们，对一个系统施加周期性的激励，尤其是在其敏感的频率上，会引起共振。在这里，这个周期性的[相位误差](@entry_id:162993)会调制[压控振荡器](@entry_id:265947)（VCO）的输出，在其[频谱](@entry_id:276824)上产生一系列不请自来的“[边带](@entry_id:261079)”。这些[边带](@entry_id:261079)就是我们所说的**[小数杂散](@entry_id:1125281)**（fractional spurs），它们出现在距离主输出频率 $f_{\mathrm{out}}$ 为 $k \cdot f_{\mathrm{ref}}/q$ 的偏[移位](@entry_id:145848)置上（$k$ 为整数）。这就是那个优雅的“平均”思想所付出的代价。

### 杂散的剖析：误差如何变为[边带](@entry_id:261079)

我们已经知道了[小数杂散](@entry_id:1125281)的“幽灵”是如何诞生的，现在让我们来解剖它，看看一个微小的周期性误差是如何一步步变成[频谱](@entry_id:276824)上清晰可见的杂散尖峰的。

整个过程就像一条多米诺骨牌链：
1.  **[相位误差](@entry_id:162993)到电流**：周期性的分频误差首先被鉴频[鉴相器](@entry_id:266236)（PFD）捕捉，它会产生一系列宽度变化的“UP”或“DN”脉冲。这些脉冲控制着[电荷泵](@entry_id:1122300)（CP），将其转化为一股周期性的误差电流注入到[环路滤波器](@entry_id:275178)中。这个转换的“增益”由PFD增益 $K_{pd}$ 和CP增益 $K_{cp}$ 共同决定。通常，$K_{pd}$ 的量级为 $1/(2\pi)$ （单位：1/rad），而 $K_{cp}$ 就是电荷泵的电流值 $I_{cp}$（单位：A）。一个更大的 $I_{cp}$ 意味着对于相同的[相位误差](@entry_id:162993)，我们会给环路一个更猛烈的“电流踢” 。

2.  **电流到电压**：这股误差电流流入[环路滤波器](@entry_id:275178)，在其上产生一个[电压纹波](@entry_id:1133886)。如果环路滤波器主要是电容性的，那么这个[电压纹波](@entry_id:1133886)的频率就和误差电流的频率相同。

3.  **电压到频率/相位**：这个叠加在VCO控制电压上的纹波，会直接“调制”VCO的输出频率。VCO的灵敏度由其增益 $K_{VCO}$ (单位：rad/s/V) 描述。一个更敏感的VCO，其频率摆动就更大。然而，真正产生[边带](@entry_id:261079)的是[相位调制](@entry_id:262420)。VCO本身就像一个[积分器](@entry_id:261578)，其传递函数可以表示为 $\frac{K_{VCO}}{s}$，它将输入的频率变化（由[电压纹波](@entry_id:1133886)引起）积分成输出的相位变化 。

一个频率为 $\omega_m$、幅度为 $V_r$ 的正弦电压纹波 $v_r(t) = V_r\cos(\omega_m t)$，会产生一个峰值相位偏移（即[调制指数](@entry_id:267497)）为 $\beta = \frac{K_{VCO} V_r}{\omega_m}$ 的[相位调制](@entry_id:262420)。正是这个[相位调制](@entry_id:262420)，在输出[频谱](@entry_id:276824)的两侧产生了杂散[边带](@entry_id:261079) 。这个机制是普适的，它不仅解释了[小数杂散](@entry_id:1125281)，也解释了所有PLL中都存在的**[参考杂散](@entry_id:1130774)**（reference spurs）。[参考杂散](@entry_id:1130774)是由PFD/CP在参考频率 $f_{\mathrm{ref}}$ 上的周期性活动（如电荷泵纹波、[时钟馈通](@entry_id:170725)等）泄漏到VCO控制端而产生的，它们出现在离载波 $\pm k f_{\mathrm{ref}}$ 的位置 。

### 不完美的世界：当电路背叛了数学

到目前为止，我们讨论的还只是理想DSM量化过程带来的“原罪”。然而，现实世界中的电路远非完美，它们会以各种意想不到的方式，与这个“原罪”共谋，制造出更复杂的麻烦。

**案例一：不对称的推拉**

想象一个最简单的小数PLL，其目标[分频](@entry_id:162771)比为 $N+0.5$。理想情况下，DSM会精确地让[分频器](@entry_id:177929)在 $N$ 和 $N+1$ 之间交替，导致PFD完美地交替输出一个UP脉冲和一个DN脉冲。假设这两个脉冲的宽度完全相同。在理想世界里，一切都应该完美抵消。但现实是，电荷泵中负责“推”（UP电流 $I_{\mathrm{U}}$）和“拉”（DN电流 $I_{\mathrm{D}}$）的晶体管永远不会完全匹配。它们的电流大小会有差异，电流脉冲的上升/下降时间也不尽相同。结果是，每一个UP周期注入的电荷 $Q_{\mathrm{U}}$ 和每一个DN周期抽出的电荷 $Q_{\mathrm{D}}$ 的绝对值并不相等。这种电荷的不平衡本身就是周期性的，其[基频](@entry_id:268182)为 $f_{\mathrm{ref}}/2$，它会直接在VCO控制端产生一个强大的纹波，从而生成杂散 。这告诉我们，电路的非理想性本身就是一种重要的杂散来源。

**案例二：不光彩的联盟**

当两种不同的周期性误差源相遇时，情况会变得更加棘手。设想一个由8个独立的单元[电流源](@entry_id:275668)组成的电荷泵，由于工艺偏差，这些单元的电流大小各不相同。为了“平均化”这种误差，设计者让这8个单元轮流工作，形成一个周期为 $P=8$ 的电流误差序列 $e_c[n]$。与此同时，PLL中的DSM正在以它自己的周期（比如 $L=64$）运行，产生一个周期性的[分频](@entry_id:162771)指令序列 $a[n]$。最终注入环路的误差电流，实际上是这两个[周期信号](@entry_id:266688)的“乘积”——因为CP的电流误差只在PFD输出脉冲时才起作用，而PFD的脉冲模式又由DSM序列决定。在信号处理中，时域的乘积对应于频域的卷积。这意味着，最终的杂散[频谱](@entry_id:276824)不仅包含各自的[谐波](@entry_id:181533)，还包含了二者频率的“和”与“差”，即所谓的**互调杂散**。它们会出现在 $|k_1 \cdot f_{\mathrm{ref}}/L \pm k_2 \cdot f_{\mathrm{ref}}/P|$ 这样复杂的位置，让[频谱](@entry_id:276824)变得像一片荆棘丛 。

### 驯服猛兽：[杂散抑制](@entry_id:1132234)策略

我们已经深入了解了杂散是如何在理想的数学王国和不完美的物理世界中诞生的。那么，我们该如何驯服这些[频谱](@entry_id:276824)上的“猛兽”呢？既然问题的根源在于“周期性”，那么打破它就是我们最有力的武器。

**策略一：随机的“[抖动](@entry_id:200248)”——Dither**

如果我们无法消除误差，那我们能否让它变得“无序”？这就是**[抖动](@entry_id:200248)**（Dithering）技术的精髓。我们可以在小数[分频](@entry_id:162771)值 $\alpha$ 进入DSM[累加器](@entry_id:175215)之前，给它加上一个微小的、均值为零的随机噪声信号 $d[n]$。这个随机的“[抖动](@entry_id:200248)”彻底打乱了DSM内部状态的确定性演化，破坏了导致杂散的极限环（limit cycles）。曾经高度集中在几个离散频率点上的杂散能量，现在被“涂抹”开来，变成了一个宽带的、低功率的噪声基底 。

这好比推一个秋千：如果你总是在其固有频率上同步地推，它会荡得很高（形成杂散）；但如果你毫无规律地、随机地推拉，它虽然也会晃动，但绝不会形成巨大的、有节奏的摆幅。当然，天下没有免费的午餐。我们用尖锐的杂散换来了一个略微抬高的整体噪声基底。幸运的是，DSM的**噪声整形**（noise shaping）特性会将大部分[抖动](@entry_id:200248)引入的噪声“推”到高频区域，而PLL环路本身的低通特性恰好可以有效地滤除这些高频噪声 。

**策略二：“障眼法”——动态元件匹配（DEM）**

对于由电路元件不匹配（如CP单元或[分频器](@entry_id:177929)延迟单元）引起的杂散，我们又该如何应对？我们无法改变单个晶体管的物理失配，但我们可以通过“耍花招”来消除它的宏观影响。**动态元件匹配**（Dynamic Element Matching, DEM）就是这样一种聪明的“障眼法”。其核心思想是：不要总让同一个（有缺陷的）元件去执行同一个任务，而是通过一个快速的、伪随机的置换算法，让所有元件都有均等的机会参与工作 。

这就像指挥一队实力不均的划船手：如果强壮的队员总在船的一侧，船就会跑偏；但如果让他们不断地、有策略地交换位置，从远处看，船就会走得很直。DEM技术将一个静态的、类似直流的失配误差（某个特定元件的固有偏差），通过高速切换，转化成了一个高频的交流误差。而PLL环路对于高频误差的抑制能力非常强，因此这个被“调制”到高频的误差就很容易被滤除了 。

### 底线：我们为什么关心杂散

我们花了这么多篇幅来讨论这些[频谱](@entry_id:276824)上微小的尖峰，那么，它们到底有多重要？为什么工程师们愿意花费如此大的力气去抑制它们？答案在于，这些频域上的“污点”，会直接转化为时域上实实在在的性能退化。

一个杂散，本质上是对载波的确定性[相位调制](@entry_id:262420)。这意味着，本应以精准等间隔出现的时钟边沿，现在却在以一种可预测的正弦规律提前或延迟。这种有规律的时间误差，我们称之为**[确定性抖动](@entry_id:1123600)**（Deterministic Jitter）。

让我们来量化一下。一个在 $2.4\,\mathrm{GHz}$ [载波](@entry_id:261646)旁 $20\,\mathrm{MHz}$ 偏移处、强度为 $-50\,\mathrm{dBc}$ 的杂散，听起来微不足道。但经过计算，它对应于一个峰峰值约为 $0.84\,\mathrm{ps}$ 的时间误差。对于使用此时钟的下游数字电路来说，这意味着其宝贵的时序裕量被永久性地“偷”走了 $0.84\,\mathrm{ps}$ 。

这种[确定性抖动](@entry_id:1123600)与我们更常听说的**[随机抖动](@entry_id:1130551)**（Random Jitter）有何不同？假设有一种[随机抖动](@entry_id:1130551)，其均方根（RMS）值与上述杂散引起的RMS时间误差相等。二者的影响一样吗？完全不同！[确定性抖动](@entry_id:1123600)是**有界**的，其误差永远不会超过其峰值（此例中为 $\pm 0.42\,\mathrm{ps}$）。而高斯分布的[随机抖动](@entry_id:1130551)是**无界**的，虽然发生概率极低，但理论上可能出现任意大的误差。更有趣的是，对于这个与杂散[RMS值](@entry_id:269927)相等的随机抖动，其瞬时误差超过杂散峰值（$0.42\,\mathrm{ps}$）的概率，竟然高达约 $16\%$ 。

这揭示了两种[抖动](@entry_id:200248)截然不同的威胁模式：[确定性抖动](@entry_id:1123600)是对系统时序预算征收的一笔固定的“税”，而[随机抖动](@entry_id:1130551)则像是一场可能导致灾难性故障的概率性风险。在高性能系统中，两者都无法容忍。理解它们的起源，是最终战胜它们的第一步，也正是小数N[分频](@entry_id:162771)锁相环设计的魅力与挑战所在。