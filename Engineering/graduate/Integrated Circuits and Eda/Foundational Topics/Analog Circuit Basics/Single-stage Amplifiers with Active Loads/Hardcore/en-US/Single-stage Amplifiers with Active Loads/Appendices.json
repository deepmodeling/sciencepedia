{
    "hands_on_practices": [
        {
            "introduction": "The first step in evaluating any amplifier is to determine its fundamental small-signal characteristics. This practice focuses on calculating the transconductance ($g_m$), output resistance ($r_o$), and intrinsic voltage gain ($A_v$) from the transistor's physical parameters and bias current. Mastering this calculation is essential for linking device-level choices to circuit-level performance and for performing initial design validation .",
            "id": "4298294",
            "problem": "A single-stage common-source amplifier is implemented in complementary metal-oxide-semiconductor (CMOS) technology and analyzed within the framework of Electronic Design Automation (EDA). The amplifying device is an $n$-channel metal-oxide-semiconductor field-effect transistor (MOSFET) $M_1$ with a $p$-channel MOSFET $M_2$ serving as an active load through a current-mirror bias that enforces equal drain currents. Both transistors operate in strong inversion and remain in saturation at the chosen bias point. Body effect is negligible, and vertical-field mobility reduction is ignored; channel-length modulation is included via an Early-voltage-based parameterization.\n\nGiven the bias and technology parameters:\n- Drain current $I_D = 100\\,\\mu\\mathrm{A}$ is established by the bias network and flows through both $M_1$ and $M_2$.\n- Process transconductance parameters are $k_n' = \\mu_n C_{\\mathrm{ox}} = 350\\,\\mu\\mathrm{A}/\\mathrm{V}^2$ and $k_p' = \\mu_p C_{\\mathrm{ox}} = 80\\,\\mu\\mathrm{A}/\\mathrm{V}^2$.\n- Channel-length modulation is modeled with an Early voltage $V_A$ that scales linearly with channel length $L$: $V_A = V_{A0}\\,(L/L_0)$, using $L_0 = 1\\,\\mu\\mathrm{m}$, $V_{A0,n} = 20\\,\\mathrm{V}$ for $M_1$, and $V_{A0,p} = 15\\,\\mathrm{V}$ for $M_2$.\n- Device geometries: $M_1$ has $W_1 = 20\\,\\mu\\mathrm{m}$ and $L_1 = 0.18\\,\\mu\\mathrm{m}$; $M_2$ has $W_2 = 40\\,\\mu\\mathrm{m}$ and $L_2 = 0.50\\,\\mu\\mathrm{m}$.\n\nStarting from drift-diffusion based MOSFET saturation and the small-signal definitions $g_m = \\partial I_D/\\partial V_{GS}$ at fixed $V_{DS}$ and $r_o = (\\partial I_D/\\partial V_{DS})^{-1}$ at fixed $V_{GS}$, compute:\n1. The transconductance $g_m$ of $M_1$.\n2. The small-signal output resistance $r_o$ at the amplifier output node (the parallel combination of $r_{o,n}$ of $M_1$ and $r_{o,p}$ of $M_2$).\n3. The intrinsic gain $A_v = g_m\\,r_o$.\n\nExpress $g_m$ in $\\mathrm{mS}$, $r_o$ in $\\mathrm{k}\\Omega$, and $A_v$ as a dimensionless ratio. Round all requested quantities to four significant figures. Conclude whether the targeted intrinsic gain of at least $60$ (in $\\mathrm{V}/\\mathrm{V}$) is met, but the final reported answer must consist only of the numerical values requested.",
            "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded in established MOSFET theory, well-posed with all necessary parameters provided, and objectively stated. There are no contradictions, ambiguities, or unrealistic conditions. We may therefore proceed with the solution.\n\nThe problem asks for the calculation of three small-signal parameters for a common-source amplifier: the transconductance $g_m$ of the input transistor $M_1$, the total small-signal output resistance $r_o$ of the stage, and the intrinsic voltage gain $A_v$.\n\n1.  **Calculation of the Transconductance $g_m$ of $M_1$**\n\nThe transistor $M_1$ is operating in the saturation region. The transconductance, $g_m$, can be calculated using several equivalent formulas. Given the drain current $I_D$, the process transconductance parameter $k_n'$, and the device geometry $(W/L)$, the most direct formula is:\n$$g_{m1} = \\sqrt{2 k_n' \\left(\\frac{W_1}{L_1}\\right) I_D}$$\nThe given parameters for $M_1$ are:\n- Drain current: $I_D = 100\\,\\mu\\mathrm{A} = 1 \\times 10^{-4}\\,\\mathrm{A}$\n- Process transconductance parameter: $k_n' = 350\\,\\mu\\mathrm{A}/\\mathrm{V}^2 = 3.5 \\times 10^{-4}\\,\\mathrm{A}/\\mathrm{V}^2$\n- Device geometry: $W_1 = 20\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, so the aspect ratio is $\\frac{W_1}{L_1} = \\frac{20\\,\\mu\\mathrm{m}}{0.18\\,\\mu\\mathrm{m}} = \\frac{20}{0.18}$.\n\nSubstituting these values into the equation for $g_{m1}$:\n$$g_{m1} = \\sqrt{2 \\left(3.5 \\times 10^{-4}\\,\\frac{\\mathrm{A}}{\\mathrm{V}^2}\\right) \\left(\\frac{20}{0.18}\\right) \\left(1 \\times 10^{-4}\\,\\mathrm{A}\\right)}$$\n$$g_{m1} = \\sqrt{2 \\times 3.5 \\times \\frac{20}{0.18} \\times 10^{-8}}\\,\\mathrm{S} = \\sqrt{\\frac{140}{0.18} \\times 10^{-8}}\\,\\mathrm{S} \\approx \\sqrt{777.77... \\times 10^{-8}}\\,\\mathrm{S}$$\n$$g_{m1} \\approx 2.788866 \\times 10^{-3}\\,\\mathrm{S}$$\nThe problem requests the value in millisiemens ($\\mathrm{mS}$) rounded to four significant figures.\n$$g_m \\approx 2.789\\,\\mathrm{mS}$$\n\n2.  **Calculation of the Small-Signal Output Resistance $r_o$**\n\nThe total output resistance $r_o$ is the parallel combination of the output resistance of the NMOS driver transistor $M_1$ ($r_{o1}$) and the PMOS active load transistor $M_2$ ($r_{o2}$):\n$$r_o = r_{o1} \\parallel r_{o2} = \\frac{r_{o1} r_{o2}}{r_{o1} + r_{o2}}$$\nThe output resistance of a MOSFET in saturation is given by the formula $r_o = \\frac{V_A}{I_D}$, where $V_A$ is the Early voltage. The problem specifies that $V_A$ scales linearly with channel length $L$: $V_A = V_{A0} \\frac{L}{L_0}$.\n\nFirst, we must calculate the Early voltage for each transistor.\nFor $M_1$ (NMOS):\n- $V_{A0,n} = 20\\,\\mathrm{V}$\n- $L_1 = 0.18\\,\\mu\\mathrm{m}$\n- $L_0 = 1\\,\\mu\\mathrm{m}$\n$$V_{A1} = V_{A0,n} \\frac{L_1}{L_0} = (20\\,\\mathrm{V}) \\frac{0.18\\,\\mu\\mathrm{m}}{1\\,\\mu\\mathrm{m}} = 3.6\\,\\mathrm{V}$$\n\nFor $M_2$ (PMOS):\n- $V_{A0,p} = 15\\,\\mathrm{V}$\n- $L_2 = 0.50\\,\\mu\\mathrm{m}$\n- $L_0 = 1\\,\\mu\\mathrm{m}$\n$$V_{A2} = V_{A0,p} \\frac{L_2}{L_0} = (15\\,\\mathrm{V}) \\frac{0.50\\,\\mu\\mathrm{m}}{1\\,\\mu\\mathrm{m}} = 7.5\\,\\mathrm{V}$$\n\nNow, we can calculate the individual output resistances using $I_D = 1 \\times 10^{-4}\\,\\mathrm{A}$:\n$$r_{o1} = \\frac{V_{A1}}{I_D} = \\frac{3.6\\,\\mathrm{V}}{1 \\times 10^{-4}\\,\\mathrm{A}} = 36000\\,\\Omega = 36\\,\\mathrm{k}\\Omega$$\n$$r_{o2} = \\frac{V_{A2}}{I_D} = \\frac{7.5\\,\\mathrm{V}}{1 \\times 10^{-4}\\,\\mathrm{A}} = 75000\\,\\Omega = 75\\,\\mathrm{k}\\Omega$$\n\nFinally, we calculate the total parallel resistance:\n$$r_o = \\frac{(36\\,\\mathrm{k}\\Omega) \\times (75\\,\\mathrm{k}\\Omega)}{36\\,\\mathrm{k}\\Omega + 75\\,\\mathrm{k}\\Omega} = \\frac{2700}{111}\\,\\mathrm{k}\\Omega \\approx 24.324324\\,\\mathrm{k}\\Omega$$\nRounding to four significant figures, we get:\n$$r_o \\approx 24.32\\,\\mathrm{k}\\Omega$$\n\n3.  **Calculation of the Intrinsic Gain $A_v$**\n\nThe intrinsic voltage gain is defined in the problem as $A_v = g_m r_o$. Note that the actual voltage gain is $A_v = -g_m r_o$ due to the inverting nature of the common-source stage, but the question asks for the magnitude, which is a common convention for intrinsic gain.\nUsing the unrounded values for better accuracy before the final rounding:\n$$A_v = g_{m1} r_o = (2.788866 \\times 10^{-3}\\,\\mathrm{S}) \\times (24324.324\\,\\Omega)$$\n$$A_v \\approx 67.8422$$\nThis is a dimensionless quantity (V/V). Rounding to four significant figures:\n$$A_v \\approx 67.84$$\n\nThe problem also asks to conclude whether the target intrinsic gain of at least $60$ is met. Since our calculated gain is $67.84$, which is greater than $60$, the target is met.\n\nThe final numerical answers requested are $g_m$ in $\\mathrm{mS}$, $r_o$ in $\\mathrm{k}\\Omega$, and $A_v$ as a dimensionless ratio, all rounded to four significant figures.\n- $g_m = 2.789$\n- $r_o = 24.32$\n- $A_v = 67.84$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.789 & 24.32 & 67.84\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While small-signal gain describes an amplifier's behavior for small inputs, its large-signal performance is limited by the output voltage swing. This exercise guides you through a first-principles derivation of the maximum symmetric output swing, a key metric determined by the supply voltage and the overdrive voltages required to keep the transistors in saturation. Understanding this fundamental limitation is crucial for designing amplifiers that can handle signals without introducing significant distortion .",
            "id": "4298358",
            "problem": "Consider a single-stage Complementary Metal-Oxide-Semiconductor (CMOS) common-source amplifier with an active load implemented by a saturated p-channel Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET). The amplifier consists of an n-channel MOSFET $M_{N}$ (driver) with source at $0$ and drain at the output node $v_{o}$, and a p-channel MOSFET $M_{P}$ (active load) with source at $V_{DD}$ and drain also at $v_{o}$. The gate voltages are held fixed so that both transistors are biased in strong inversion saturation at the quiescent operating point. Let the n-channel overdrive be $V_{OVN} = V_{GS,N} - V_{TN}$ and the p-channel overdrive be $V_{OVP} = V_{SG,P} - |V_{TP}|$, where $V_{TN}$ and $V_{TP}$ are the threshold voltages for the n-channel and p-channel devices, respectively. Assume long-channel behavior such that the saturation condition for each device is determined by its instantaneous drain-to-source voltage relative to its overdrive.\n\nYou are to derive, from first principles and the saturation criteria for strong inversion operation, the maximum peak-to-peak symmetric output swing that can be applied at $v_{o}(t)$ around some quiescent voltage $V_{OQ}$ while guaranteeing that both $M_{N}$ and $M_{P}$ remain in saturation for all time across the swing. Express your final result as a single closed-form analytic expression in terms of $V_{DD}$, $V_{OVN}$, and $V_{OVP}$. Use volts as the unit. No numerical evaluation is required; provide the symbolic expression only.",
            "solution": "The problem statement is subjected to validation.\n\n### Step 1: Extract Givens\n- **System**: A single-stage Complementary Metal-Oxide-Semiconductor (CMOS) common-source amplifier with an active load.\n- **Driver Transistor ($M_{N}$)**: n-channel MOSFET. Source is connected to $0$ volts. Drain is connected to the output node $v_{o}$.\n- **Active Load Transistor ($M_{P}$)**: p-channel MOSFET. Source is connected to the supply voltage $V_{DD}$. Drain is connected to the output node $v_{o}$.\n- **Biasing**: Both transistors, $M_{N}$ and $M_{P}$, are biased in strong inversion saturation at the quiescent operating point. Gate voltages are held fixed.\n- **Definitions**:\n    - N-channel overdrive voltage: $V_{OVN} = V_{GS,N} - V_{TN}$.\n    - P-channel overdrive voltage: $V_{OVP} = V_{SG,P} - |V_{TP}|$.\n- **Model**: Long-channel behavior is assumed.\n- **Saturation Condition**: The saturation condition for each device is determined by its instantaneous drain-to-source voltage relative to its overdrive voltage.\n- **Objective**: Derive the maximum peak-to-peak symmetric output swing at $v_{o}(t)$ around a quiescent voltage $V_{OQ}$ such that both $M_{N}$ and $M_{P}$ remain in saturation. The result must be a single closed-form analytic expression in terms of $V_{DD}$, $V_{OVN}$, and $V_{OVP}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is firmly grounded in the principles of analog integrated circuit design, specifically the analysis of MOSFET amplifiers. The components, configuration, and parameters ($V_{DD}$, $V_{OVN}$, $V_{OVP}$) are standard in this field. The long-channel model and saturation conditions are fundamental concepts in MOSFET theory.\n- **Well-Posedness**: The problem is well-posed. It provides all necessary information ($V_{DD}$, $V_{OVN}$, $V_{OVP}$, and the circuit topology) to uniquely determine the boundaries of the output voltage swing. The objective is clearly stated, and a unique analytical solution exists.\n- **Objectivity**: The problem is stated using precise, objective, and standard technical terminology. There are no subjective or ambiguous statements.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is scientifically sound, well-posed, and objective. There are no inconsistencies, missing data, or logical flaws. The solution process may proceed.\n\n### Derivation\nThe objective is to find the maximum peak-to-peak symmetric output voltage swing, denoted $V_{pp,symm}$, for which both the n-channel driver transistor $M_{N}$ and the p-channel load transistor $M_{P}$ remain in the saturation region of operation.\n\nThe analysis begins by establishing the conditions for saturation for each transistor based on the long-channel model.\n\nFor the n-channel MOSFET, $M_{N}$, to be in saturation, its drain-to-source voltage, $V_{DS,N}$, must be greater than or equal to its gate-to-source voltage minus the threshold voltage. This difference is defined as the overdrive voltage $V_{OVN}$.\n$$V_{DS,N} \\geq V_{GS,N} - V_{TN}$$\nUsing the provided definition, this condition is:\n$$V_{DS,N} \\geq V_{OVN}$$\nIn the given circuit configuration, the source of $M_{N}$ is connected to ground ($V_{S,N} = 0$), and its drain is connected to the output node, $v_{o}$. Therefore, the instantaneous drain-to-source voltage is $V_{DS,N} = v_{o} - V_{S,N} = v_{o}$. The condition for $M_{N}$ to remain in saturation sets the lower limit on the output voltage:\n$$v_{o} \\geq V_{OVN}$$\nThis defines the minimum permissible output voltage, $v_{o,min}$:\n$$v_{o,min} = V_{OVN}$$\n\nFor the p-channel MOSFET, $M_{P}$, to be in saturation, its source-to-drain voltage, $V_{SD,P}$, must be greater than or equal to its source-to-gate voltage minus the magnitude of its threshold voltage. This difference is defined as the overdrive voltage $V_{OVP}$.\n$$V_{SD,P} \\geq V_{SG,P} - |V_{TP}|$$\nUsing the provided definition, this condition is:\n$$V_{SD,P} \\geq V_{OVP}$$\nIn the given circuit configuration, the source of $M_{P}$ is connected to the positive supply voltage $V_{DD}$ ($V_{S,P} = V_{DD}$), and its drain is connected to the output node, $v_{o}$. Therefore, the instantaneous source-to-drain voltage is $V_{SD,P} = V_{S,P} - v_{o} = V_{DD} - v_{o}$. The condition for $M_{P}$ to remain in saturation sets the upper limit on the output voltage:\n$$V_{DD} - v_{o} \\geq V_{OVP}$$\nRearranging this inequality to solve for $v_{o}$:\n$$v_{o} \\leq V_{DD} - V_{OVP}$$\nThis defines the maximum permissible output voltage, $v_{o,max}$:\n$$v_{o,max} = V_{DD} - V_{OVP}$$\n\nThe total range of output voltage over which both transistors remain in saturation is the interval $[v_{o,min}, v_{o,max}]$. The total available voltage swing is the difference between these limits:\n$$\\text{Total Swing} = v_{o,max} - v_{o,min} = (V_{DD} - V_{OVP}) - V_{OVN}$$\n\nThe problem asks for the maximum *symmetric* peak-to-peak swing. A symmetric swing implies that the output voltage $v_{o}(t)$ varies equally above and below a quiescent point $V_{OQ}$. To maximize this symmetric swing, $V_{OQ}$ must be chosen to be the midpoint of the valid voltage range:\n$$V_{OQ} = \\frac{v_{o,max} + v_{o,min}}{2} = \\frac{(V_{DD} - V_{OVP}) + V_{OVN}}{2}$$\nWith this optimal choice of $V_{OQ}$, the output can swing from $v_{o,min}$ to $v_{o,max}$. The maximum peak-to-peak symmetric swing, $V_{pp,symm}$, is therefore equal to the total available swing.\n$$V_{pp,symm} = v_{o,max} - v_{o,min}$$\nSubstituting the derived expressions for $v_{o,max}$ and $v_{o,min}$:\n$$V_{pp,symm} = (V_{DD} - V_{OVP}) - V_{OVN}$$\n$$V_{pp,symm} = V_{DD} - V_{OVN} - V_{OVP}$$\nThis is the final closed-form expression for the maximum peak-to-peak symmetric output swing in terms of the given parameters. This swing ensures that for all time $t$, the output voltage $v_{o}(t)$ satisfies $V_{OVN} \\leq v_{o}(t) \\leq V_{DD} - V_{OVP}$, guaranteeing that both $M_{N}$ and $M_{P}$ remain in saturation.",
            "answer": "$$\n\\boxed{V_{DD} - V_{OVN} - V_{OVP}}\n$$"
        },
        {
            "introduction": "An amplifier's performance is inherently frequency-dependent, with parasitic capacitances limiting its operational speed. This practice delves into the AC analysis of the common-source stage, modeling it as a single-pole system to determine its frequency response, dominant pole, and gain-bandwidth product (GBW). By deriving the transfer function from Kirchhoff's laws, you will develop a foundational understanding of how device and load capacitances dictate the high-frequency limits of an amplifier .",
            "id": "4298376",
            "problem": "You are to formalize and implement an alternating current (AC) analysis for a single-stage inverting amplifier employing an active load within the framework of Electronic Design Automation (EDA). The amplifier is a Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET) common-source stage using a direct-current (DC) current-source active load. The goal is to derive, from first principles, a small-signal transfer function that yields the complex voltage gain $A_v(j\\omega)$, the gain-bandwidth product (GBW), and the dominant pole frequency. The analysis must be expressed and implemented in purely mathematical terms, without referencing any specific circuit simulator.\n\nAssumptions and modeling:\n- The small-signal view of the MOSFET is represented using its transconductance $g_{m,n}$ and output resistance $r_{o,n}$. The active load is represented by an output resistance $r_{o,p}$. Channel-length modulation and other output conductance effects are subsumed into these resistances. Body effect and bulk-source coupling are neglected.\n- The amplifier’s output node is loaded by the parallel combination of device parasitic capacitances and an explicit load capacitance. These are modeled as $C_{L}$, $C_{db,n}$, $C_{db,p}$, and $C_{gd}$, all connected to the output node for the purpose of dominant-pole estimation. This approximation assumes a low source impedance drive so that the Miller redistribution places most of $C_{gd}$ impact on the input rather than reshaping the output pole beyond its inclusion in the output node. You must state and use this approximation.\n- The input stimulus for the AC analysis is an AC voltage source of amplitude $1$ V applied at the gate node, with zero source resistance. The source and bulk nodes are at AC ground. The output is measured at the drain node relative to AC ground.\n- The output resistance at the output node is the parallel combination $R_{\\text{out}} = \\left(\\frac{1}{r_{o,n}} + \\frac{1}{r_{o,p}}\\right)^{-1}$. The total output capacitance is $C_{\\text{out}} = C_{L} + C_{db,n} + C_{db,p} + C_{gd}$ under the stated approximation.\n- Starting only from Kirchhoff’s Current Law (KCL), linear time-invariant (LTI) system theory, and small-signal linearization, you must derive that the transfer function of this single-pole stage can be parameterized by a direct-current (DC) gain $A_v(0)$ and an angular pole frequency $\\omega_p$, and then used to evaluate $A_v(j\\omega)$ at a specified frequency. Angles and angular frequency must be treated in radians.\n\nRequired outputs and units:\n- Compute the DC gain $A_v(0)$ as a dimensionless quantity.\n- Compute the dominant pole frequency in hertz, $f_p$.\n- Compute the gain-bandwidth product in hertz, GBW $= \\lvert A_v(0) \\rvert \\cdot f_p$.\n- Evaluate the complex gain $A_v(j\\omega_{\\text{eval}})$ at a specified evaluation frequency $f_{\\text{eval}}$ (with $\\omega_{\\text{eval}} = 2\\pi f_{\\text{eval}}$), and report its real and imaginary parts as dimensionless quantities.\n\nYour program must use the following single-pole representation of the amplifier, derived from first principles as described:\n- The DC gain is $A_v(0) = -g_{m,n} R_{\\text{out}}$.\n- The pole is $\\omega_p = \\dfrac{1}{R_{\\text{out}} C_{\\text{out}}}$ and $f_p = \\dfrac{\\omega_p}{2\\pi}$.\n- The frequency response is $A_v(j\\omega) = \\dfrac{A_v(0)}{1 + j \\dfrac{\\omega}{\\omega_p}}$.\n- The gain-bandwidth product is $\\text{GBW} = \\lvert A_v(0) \\rvert \\cdot f_p$.\n\nSmall-signal stimuli and measurement nodes required:\n- Apply an AC voltage source of amplitude $1$ V at the input gate node with zero source resistance.\n- Keep the source and bulk nodes at AC ground.\n- Measure the output node voltage at the drain with respect to AC ground to obtain $A_v(j\\omega) = \\dfrac{v_{\\text{out}}(j\\omega)}{v_{\\text{in}}(j\\omega)}$.\n\nTest suite:\nImplement the computation for the following parameter sets. Each parameter set is a tuple of $(g_{m,n}, r_{o,n}, r_{o,p}, C_L, C_{db,n}, C_{db,p}, C_{gd}, f_{\\text{eval}})$, with units of siemens, ohms, ohms, farads, farads, farads, farads, and hertz, respectively. All frequency-related calculations must use radians for angular frequency.\n\n- Case $1$ (general inverting stage with significant gain and light load): $g_{m,n} = 2\\times 10^{-3}$, $r_{o,n} = 5.0\\times 10^{4}$, $r_{o,p} = 1.0\\times 10^{5}$, $C_{L} = 1.0\\times 10^{-13}$, $C_{db,n} = 2.0\\times 10^{-14}$, $C_{db,p} = 2.0\\times 10^{-14}$, $C_{gd} = 1.0\\times 10^{-14}$, $f_{\\text{eval}} = 1.0\\times 10^{7}$.\n- Case $2$ (boundary case with low transconductance yielding sub-unity gain): $g_{m,n} = 2.0\\times 10^{-5}$, $r_{o,n} = 4.0\\times 10^{4}$, $r_{o,p} = 4.0\\times 10^{4}$, $C_{L} = 1.0\\times 10^{-12}$, $C_{db,n} = 5.0\\times 10^{-14}$, $C_{db,p} = 5.0\\times 10^{-14}$, $C_{gd} = 2.0\\times 10^{-14}$, $f_{\\text{eval}} = 5.0\\times 10^{6}$.\n- Case $3$ (dominant pole pushed low by heavy loading and near-ideal current-source load): $g_{m,n} = 4.0\\times 10^{-3}$, $r_{o,n} = 2.5\\times 10^{4}$, $r_{o,p} = 1.0\\times 10^{9}$, $C_{L} = 1.0\\times 10^{-11}$, $C_{db,n} = 2.0\\times 10^{-13}$, $C_{db,p} = 1.5\\times 10^{-13}$, $C_{gd} = 2.0\\times 10^{-13}$, $f_{\\text{eval}} = 1.0\\times 10^{6}$.\n\nOutput specification:\nFor each test case, compute and return the list $[A_v(0), \\text{GBW}, f_p, \\Re\\{A_v(j\\omega_{\\text{eval}})\\}, \\Im\\{A_v(j\\omega_{\\text{eval}})\\}]$. Your program should produce a single line of output containing the results for all test cases as a comma-separated list of these per-case lists, enclosed in square brackets. For example, a valid output format is $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],[a_3,b_3,c_3,d_3,e_3]]$, where all entries are floating-point numbers. Report $A_v(0)$ as dimensionless, GBW and $f_p$ in hertz, and the real and imaginary parts of $A_v(j\\omega_{\\text{eval}})$ as dimensionless quantities.",
            "solution": "The problem is valid. It presents a standard, well-posed problem in analog integrated circuit analysis that is scientifically grounded and internally consistent. We will proceed to derive the requested transfer function and associated parameters from first principles.\n\nThe objective is to determine the small-signal AC characteristics of a common-source MOSFET amplifier with an active current-source load. The analysis begins by constructing the small-signal equivalent circuit under the specified assumptions. The input n-channel MOSFET ($M_n$) is modeled by its transconductance $g_{m,n}$ and output resistance $r_{o,n}$. The p-channel MOSFET active load ($M_p$) is modeled by its output resistance $r_{o,p}$. The input signal $v_{in}$ is applied at the gate of $M_n$. Its source and bulk are connected to AC ground, which implies the gate-to-source voltage is $v_{gs} = v_{in}$. The output voltage, $v_{out}$, is measured at the common drain node of $M_n$ and $M_p$. The DC supply voltage ($V_{DD}$) is an AC ground.\n\nThe total output resistance, $R_{out}$, is the parallel combination of the NMOS output resistance $r_{o,n}$ and the PMOS output resistance $r_{o,p}$.\n$$R_{out} = r_{o,n} \\parallel r_{o,p} = \\left(\\frac{1}{r_{o,n}} + \\frac{1}{r_{o,p}}\\right)^{-1}$$\nThe total output capacitance, $C_{out}$, is the sum of all capacitances connected to the output node, as specified by the problem's dominant-pole approximation.\n$$C_{out} = C_{L} + C_{db,n} + C_{db,p} + C_{gd}$$\n\nThe small-signal equivalent circuit consists of the following components connected to the output node (drain):\n$1$. The dependent current source of the NMOS transistor, which draws a current $g_{m,n}v_{gs} = g_{m,n}v_{in}$ from the output node to ground.\n$2$. The NMOS output resistance $r_{o,n}$ from the output node to ground.\n$3$. The PMOS output resistance $r_{o,p}$ from the output node to ground (since the source of the PMOS is tied to $V_{DD}$, which is AC ground).\n$4$. The total output capacitance $C_{out}$ from the output node to ground.\n\nTo find the transfer function $A_v(s) = V_{out}(s) / V_{in}(s)$, where $s$ is the complex frequency variable, we apply Kirchhoff's Current Law (KCL) at the output node. The sum of currents leaving the node is zero. In the s-domain (phasor domain), this is expressed as:\n$$g_{m,n}V_{in}(s) + \\frac{V_{out}(s)}{r_{o,n}} + \\frac{V_{out}(s)}{r_{o,p}} + s C_{out} V_{out}(s) = 0$$\nWe can group the terms involving $V_{out}(s)$:\n$$V_{out}(s) \\left( \\frac{1}{r_{o,n}} + \\frac{1}{r_{o,p}} + s C_{out} \\right) = -g_{m,n}V_{in}(s)$$\nUsing the definition of $R_{out}$, the expression in the parenthesis becomes $\\frac{1}{R_{out}} + s C_{out}$.\n$$V_{out}(s) \\left( \\frac{1}{R_{out}} + s C_{out} \\right) = -g_{m,n}V_{in}(s)$$\nNow, we solve for the voltage gain $A_v(s) = V_{out}(s) / V_{in}(s)$:\n$$A_v(s) = \\frac{-g_{m,n}}{\\frac{1}{R_{out}} + s C_{out}}$$\nTo express this in the standard single-pole transfer function form $A_v(s) = \\frac{A_v(0)}{1+s/\\omega_p}$, we multiply the numerator and denominator by $R_{out}$:\n$$A_v(s) = \\frac{-g_{m,n}R_{out}}{1 + s R_{out}C_{out}}$$\nBy comparing this derived expression with the standard form, we can identify the DC gain $A_v(0)$ and the pole angular frequency $\\omega_p$.\n\n$1$. The DC gain, evaluated at $s=0$ (or $\\omega=0$), is:\n$$A_v(0) = -g_{m,n}R_{out}$$\nThis represents the gain of the amplifier at low frequencies. The negative sign indicates that the amplifier is inverting, as expected for a common-source configuration.\n\n$2$. The dominant pole angular frequency $\\omega_p$ is found from the denominator term $1 + sR_{out}C_{out} = 1 + s/\\omega_p$. This gives:\n$$\\omega_p = \\frac{1}{R_{out}C_{out}}$$\nThe pole frequency in hertz, $f_p$, is related to the angular frequency by $f_p = \\omega_p / (2\\pi)$.\n$$f_p = \\frac{1}{2\\pi R_{out}C_{out}}$$\n\n$3$. The Gain-Bandwidth Product (GBW) is defined as the product of the DC gain magnitude and the pole frequency. For a single-pole system, this is also approximately the unity-gain frequency.\n$$\\text{GBW} = |A_v(0)| \\cdot f_p = |-g_{m,n}R_{out}| \\cdot \\frac{1}{2\\pi R_{out}C_{out}} = \\frac{g_{m,n}}{2\\pi C_{out}}$$\n\n$4$. The complex gain at a specific evaluation frequency $f_{\\text{eval}}$ is found by substituting $s = j\\omega_{\\text{eval}} = j2\\pi f_{\\text{eval}}$ into the transfer function:\n$$A_v(j\\omega_{\\text{eval}}) = \\frac{A_v(0)}{1 + j\\frac{\\omega_{\\text{eval}}}{\\omega_p}}$$\nTo find the real and imaginary parts, we rationalize the denominator:\n$$A_v(j\\omega_{\\text{eval}}) = \\frac{A_v(0)}{1 + j\\frac{\\omega_{\\text{eval}}}{\\omega_p}} \\cdot \\frac{1 - j\\frac{\\omega_{\\text{eval}}}{\\omega_p}}{1 - j\\frac{\\omega_{\\text{eval}}}{\\omega_p}} = \\frac{A_v(0)\\left(1 - j\\frac{\\omega_{\\text{eval}}}{\\omega_p}\\right)}{1 + \\left(\\frac{\\omega_{\\text{eval}}}{\\omega_p}\\right)^2}$$\nFrom this, the real and imaginary components are:\n$$\\Re\\{A_v(j\\omega_{\\text{eval}})\\} = \\frac{A_v(0)}{1 + \\left(\\frac{\\omega_{\\text{eval}}}{\\omega_p}\\right)^2}$$\n$$\\Im\\{A_v(j\\omega_{\\text{eval}})\\} = \\frac{-A_v(0) \\cdot \\frac{\\omega_{\\text{eval}}}{\\omega_p}}{1 + \\left(\\frac{\\omega_{\\text{eval}}}{\\omega_p}\\right)^2}$$\n\nThe implementation will proceed by calculating these quantities for each parameter set provided in the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes the AC analysis characteristics for a single-stage common-source\n    amplifier with an active load for a given set of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple:\n    # (g_m_n, r_o_n, r_o_p, C_L, C_db_n, C_db_p, C_gd, f_eval)\n    # Units: (S, Ohm, Ohm, F, F, F, F, Hz)\n    test_cases = [\n        (2e-3, 5e4, 1e5, 1e-13, 2e-14, 2e-14, 1e-14, 1e7),\n        (2e-5, 4e4, 4e4, 1e-12, 5e-14, 5e-14, 2e-14, 5e6),\n        (4e-3, 2.5e4, 1e9, 1e-11, 2e-13, 1.5e-13, 2e-13, 1e6)\n    ]\n\n    results = []\n    for case in test_cases:\n        g_m_n, r_o_n, r_o_p, C_L, C_db_n, C_db_p, C_gd, f_eval = case\n\n        # 1. Calculate total output resistance R_out\n        # R_out = r_o_n || r_o_p\n        if r_o_n + r_o_p == 0:\n            R_out = 0.0\n        else:\n            R_out = (r_o_n * r_o_p) / (r_o_n + r_o_p)\n        \n        # 2. Calculate total output capacitance C_out\n        C_out = C_L + C_db_n + C_db_p + C_gd\n        \n        # 3. Compute DC gain A_v(0)\n        A_v_0 = -g_m_n * R_out\n        \n        # 4. Compute the dominant pole frequency (omega_p and f_p)\n        # Avoid division by zero if R_out or C_out is zero\n        if R_out == 0 or C_out == 0:\n            omega_p = float('inf')\n            f_p = float('inf')\n        else:\n            omega_p = 1 / (R_out * C_out)\n            f_p = omega_p / (2 * np.pi)\n            \n        # 5. Compute the gain-bandwidth product (GBW)\n        # The relationship GBW = g_m_n / (2*pi*C_out) is more numerically stable\n        if C_out == 0:\n            GBW = float('inf')\n        else:\n            GBW = g_m_n / (2 * np.pi * C_out)\n        # Alternatively, using the derived relation GBW = |A_v(0)| * f_p \n        # GBW_alt = abs(A_v_0) * f_p \n        # Both should be equivalent; we use the more stable form.\n        \n        # 6. Evaluate the complex gain at f_eval\n        omega_eval = 2 * np.pi * f_eval\n        \n        # Using complex numbers for straightforward calculation\n        # A_v(jw) = A_v(0) / (1 + j * w / w_p)\n        if omega_p == float('inf'): # Corresponds to zero RC time constant\n             A_v_jw_eval = A_v_0 + 0j\n        else:\n             A_v_jw_eval = A_v_0 / (1 + 1j * (omega_eval / omega_p))\n        \n        real_part = A_v_jw_eval.real\n        imag_part = A_v_jw_eval.imag\n        \n        # Append the list of results for the current case\n        results.append([A_v_0, GBW, f_p, real_part, imag_part])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}