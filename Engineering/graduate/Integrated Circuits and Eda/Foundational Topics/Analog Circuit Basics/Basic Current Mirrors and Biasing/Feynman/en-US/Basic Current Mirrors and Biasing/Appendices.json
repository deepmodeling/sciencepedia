{
    "hands_on_practices": [
        {
            "introduction": "The cornerstone of designing current mirrors is translating a desired current ratio into physical transistor dimensions. This practice grounds the theoretical square-law model in a practical design flow, starting with sizing a transistor based on an ideal model and then verifying its operation under more realistic conditions. By calculating the required width-to-length ratio and checking the saturation and compliance voltage constraints, you will develop the fundamental skills needed for creating robust biasing circuits. ",
            "id": "4257613",
            "problem": "An engineer is designing a Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET) current mirror in the context of integrated circuits and electronic design automation (EDA). The mirror uses two long-channel n-channel MOSFETs, denoted $M_1$ (diode-connected reference) and $M_2$ (output), fabricated in a complementary MOS (CMOS) process. The reference branch provides a constant current $I_{REF}$ into $M_1$, and the output branch of $M_2$ must deliver a nominal $10:1$ mirror of the reference current into a load at the output node.\n\nThe following process and design parameters are given: electron mobility–oxide capacitance product $\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$, threshold voltage $V_{TH} = 0.45\\ \\mathrm{V}$, channel-length modulation parameter $\\lambda = 0.06\\ \\mathrm{V}^{-1}$, supply voltage $V_{DD} = 1.2\\ \\mathrm{V}$. The geometry of $M_1$ is fixed with width $W_1 = 1.0\\ \\mu\\mathrm{m}$ and length $L_1 = 0.18\\ \\mu\\mathrm{m}$, and the reference current is $I_{REF} = 20\\ \\mu\\mathrm{A}$. The output transistor $M_2$ uses the same channel length as $M_1$, namely $L_2 = 0.18\\ \\mu\\mathrm{m}$. The minimum output voltage imposed by the load is $V_{OUT,\\min} = 0.30\\ \\mathrm{V}$. Assume both sources and bulks are at $0\\ \\mathrm{V}$ so that body effect is negligible.\n\nStarting from first principles of long-channel MOSFET operation in saturation and ignoring channel-length modulation during the sizing step, the designer wishes to choose the geometry of $M_2$ to achieve a nominal current ratio of $I_{OUT}/I_{REF} = 10$ when both transistors share the same gate-source voltage set by the diode-connected $M_1$. Then, using the obtained operating point, verify that the saturation condition is satisfied for both transistors and that the output compliance constraint is met when $\\lambda$ is nonzero. You may treat square-law behavior as the foundational device model for saturation.\n\nCompute the required ratio $W_2/L_2$ for $M_2$ to meet the $10:1$ mirror target under the sizing assumption above. Express your final answer as a dimensionless number and round your answer to four significant figures. No units should be included in the final boxed answer.",
            "solution": "The fundamental base for long-channel MOSFET operation in saturation is that the drain current satisfies\n$$\nI_{D} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W}{L}\\,(V_{GS}-V_{TH})^{2}\\,(1+\\lambda V_{DS}),\n$$\nwith the square-law behavior in the absence of channel-length modulation. For sizing, we ignore channel-length modulation, which amounts to taking\n$$\nI_{D} \\approx \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W}{L}\\,(V_{GS}-V_{TH})^{2}.\n$$\nDefine the overdrive voltage as $V_{OV} \\equiv V_{GS}-V_{TH}$. In a current mirror with $M_1$ diode-connected, the gate-source voltage $V_{GS}$ is set by $M_1$ under $I_{REF}$, and $M_2$ shares the same gate voltage and source node, so $M_2$ operates with the same $V_{OV}$ in sizing.\n\nFirst, determine $V_{OV}$ from $M_1$ using the given $I_{REF}$ and geometry. The geometry ratio of $M_1$ is\n$$\n\\frac{W_1}{L_1} = \\frac{1.0\\ \\mu\\mathrm{m}}{0.18\\ \\mu\\mathrm{m}} = \\frac{1.0}{0.18} \\approx 5.555\\ldots\n$$\nUsing the square-law saturation expression for $M_1$,\n$$\nI_{REF} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_1}{L_1}\\,V_{OV}^{2},\n$$\nso\n$$\nV_{OV}^{2} = \\frac{2\\,I_{REF}}{\\mu_n C_{ox}\\,(W_1/L_1)}.\n$$\nSubstitute $I_{REF} = 20\\ \\mu\\mathrm{A}$ and $\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$:\n$$\n\\mu_n C_{ox}\\,\\frac{W_1}{L_1} = \\left(250\\ \\mu\\mathrm{A}/\\mathrm{V}^2\\right)\\times 5.555\\ldots \\approx 1388.888\\ldots\\ \\mu\\mathrm{A}/\\mathrm{V}^2,\n$$\nand hence\n$$\nV_{OV}^{2} = \\frac{2\\times 20\\ \\mu\\mathrm{A}}{1388.888\\ldots\\ \\mu\\mathrm{A}/\\mathrm{V}^2} = \\frac{40}{1388.888\\ldots}\\ \\mathrm{V}^2 \\approx 0.0288\\ \\mathrm{V}^2,\n$$\nso\n$$\nV_{OV} \\approx \\sqrt{0.0288}\\ \\mathrm{V} \\approx 0.1697056\\ \\mathrm{V}.\n$$\nThe gate-source voltage of $M_1$ is therefore\n$$\nV_{GS1} = V_{TH} + V_{OV} \\approx 0.45\\ \\mathrm{V} + 0.1697056\\ \\mathrm{V} \\approx 0.6197056\\ \\mathrm{V}.\n$$\n\nNext, choose $W_2/L_2$ to yield $I_{OUT} = 10\\,I_{REF} = 200\\ \\mu\\mathrm{A}$ under the same $V_{OV}$ in sizing:\n$$\nI_{OUT} = \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_2}{L_2}\\,V_{OV}^{2},\n$$\nso\n$$\n\\frac{W_2}{L_2} = \\frac{2\\,I_{OUT}}{\\mu_n C_{ox}\\,V_{OV}^{2}}.\n$$\nSubstituting $I_{OUT} = 200\\ \\mu\\mathrm{A}$, $\\mu_n C_{ox} = 250\\ \\mu\\mathrm{A}/\\mathrm{V}^2$, and $V_{OV}^{2} \\approx 0.0288\\ \\mathrm{V}^2$,\n$$\n\\frac{W_2}{L_2} = \\frac{2\\times 200\\ \\mu\\mathrm{A}}{250\\ \\mu\\mathrm{A}/\\mathrm{V}^2 \\times 0.0288\\ \\mathrm{V}^2} = \\frac{400}{7.2} \\approx 55.555\\ldots\n$$\nThis is exactly $10$ times $\\frac{W_1}{L_1}$, as expected for an ideal mirror with equal overdrive voltages.\n\nNow verify saturation and compliance constraints when $\\lambda \\neq 0$.\n\nFor $M_1$ (diode-connected), $V_{DS1} = V_{GS1} \\approx 0.6197056\\ \\mathrm{V}$. The saturation condition requires $V_{DS1} \\ge V_{OV}$. We have\n$$\nV_{DS1} - V_{OV} \\approx 0.6197056\\ \\mathrm{V} - 0.1697056\\ \\mathrm{V} \\approx 0.450\\ \\mathrm{V} > 0,\n$$\nso $M_1$ remains in saturation. With channel-length modulation, the current becomes\n$$\nI_{REF,\\lambda} \\approx \\frac{1}{2}\\,\\mu_n C_{ox}\\,\\frac{W_1}{L_1}\\,V_{OV}^{2}\\,(1+\\lambda V_{DS1}),\n$$\nbut this does not affect the saturation condition itself.\n\nFor $M_2$, the saturation condition requires $V_{DS2} \\ge V_{OV}$. The minimum output voltage is given as $V_{OUT,\\min} = 0.30\\ \\mathrm{V}$. Therefore,\n$$\nV_{OUT,\\min} - V_{OV} \\approx 0.30\\ \\mathrm{V} - 0.1697056\\ \\mathrm{V} \\approx 0.1302944\\ \\mathrm{V} > 0,\n$$\nso $M_2$ also remains in saturation at the worst-case output voltage.\n\nFinally, assess the impact of $\\lambda$ on the mirrored ratio to ensure compliance considerations are realistic. The ratio with channel-length modulation becomes\n$$\n\\frac{I_{OUT}}{I_{REF}} \\approx \\left(\\frac{W_2/L_2}{W_1/L_1}\\right)\\,\\frac{1+\\lambda V_{DS2}}{1+\\lambda V_{DS1}}.\n$$\nUsing $\\frac{W_2/L_2}{W_1/L_1} = 10$, $V_{DS2} \\approx V_{OUT,\\min} = 0.30\\ \\mathrm{V}$, $V_{DS1} \\approx V_{GS1} \\approx 0.6197056\\ \\mathrm{V}$, and $\\lambda = 0.06\\ \\mathrm{V}^{-1}$,\n$$\n\\frac{I_{OUT}}{I_{REF}} \\approx 10\\,\\frac{1+0.06\\times 0.30}{1+0.06\\times 0.6197056} = 10\\,\\frac{1+0.018}{1+0.037182336} \\approx 10\\,\\frac{1.018}{1.037182336} \\approx 9.815.\n$$\nThis indicates a modest ratio error due to differing $V_{DS}$ values between $M_1$ and $M_2$, while both devices still satisfy saturation and output compliance. The sizing target remains met under the square-law assumption, and the compliance headroom is sufficient.\n\nTherefore, the required ratio $W_2/L_2$ is approximately $55.555\\ldots$. Rounded to four significant figures as requested, the answer is $55.56$.",
            "answer": "$$\\boxed{55.56}$$"
        },
        {
            "introduction": "An ideal current mirror provides a perfectly constant output current, but real-world devices suffer from non-idealities. A primary source of error is channel-length modulation, which gives the transistor a finite output resistance and makes the mirrored current dependent on the output voltage. This exercise provides a hands-on approach to quantifying this error and exploring a common technique—increasing the channel length—to improve the mirror's accuracy, demonstrating the critical trade-off between performance and circuit area. ",
            "id": "4257571",
            "problem": "A two-transistor simple current mirror implemented in a Complementary Metal-Oxide-Semiconductor (CMOS) process uses two identical n-channel Metal-Oxide-Semiconductor Field-Effect Transistors (MOSFETs) with common gate connection; the reference transistor has its drain tied to its gate. Assume the devices operate in saturation, body effect is negligible, and threshold voltage and mobility are identical for both devices. The mirror is used in an Electronic Design Automation (EDA) flow to bias a block at a fixed current, and non-idealities due to channel-length modulation must be quantified.\n\nThe mirror is evaluated in two configurations that differ only in the channel length $L$ of both transistors; the channel width $W$ is held constant and the same for both devices. The bias current magnitude is kept the same between configurations by appropriately adjusting $V_{\\text{GS}}$ so that both devices remain in saturation. The drain-to-source voltages at the operating point are fixed by the surrounding circuitry to $V_{\\text{DS,ref}} = 0.50\\,\\text{V}$ for the reference device and $V_{\\text{DS,out}} = 1.20\\,\\text{V}$ for the output device, and these voltages are identical in both configurations.\n\nMeasured channel-length modulation parameters $\\lambda$ for the two devices at the relevant bias region are:\n- At $L = 0.18\\,\\mu\\text{m}$: $\\lambda_{\\text{ref}} = 0.12\\,\\text{V}^{-1}$ and $\\lambda_{\\text{out}} = 0.11\\,\\text{V}^{-1}$.\n- At $L = 0.36\\,\\mu\\text{m}$: $\\lambda_{\\text{ref}} = 0.060\\,\\text{V}^{-1}$ and $\\lambda_{\\text{out}} = 0.055\\,\\text{V}^{-1}$.\n\nStarting from fundamental device relations for MOSFETs in saturation and the definition of a simple current mirror, derive the expression for the fractional current error in the mirrored output due solely to channel-length modulation when $V_{\\text{DS,ref}} \\neq V_{\\text{DS,out}}$. Using the measured $\\lambda$ values provided, compute the fractional error in each configuration and then compute the expected improvement in mirror accuracy defined as the ratio of the magnitude of the fractional error at $L = 0.18\\,\\mu\\text{m}$ to that at $L = 0.36\\,\\mu\\text{m}$.\n\nExpress the final improvement as a dimensionless decimal number and round your answer to four significant figures.",
            "solution": "Let the reference transistor be denoted by $M_1$ and the output transistor by $M_2$. The drain current $I_D$ for an n-channel MOSFET operating in the saturation region is given by:\n$$I_D = \\frac{1}{2} k' \\frac{W}{L} (V_{\\text{GS}} - V_{th})^2 (1 + \\lambda V_{\\text{DS}})$$\nwhere $k'$ is the process transconductance parameter ($\\mu_n C_{ox}$), $W$ is the channel width, $L$ is the channel length, $V_{th}$ is the threshold voltage, $V_{\\text{GS}}$ is the gate-to-source voltage, $V_{\\text{DS}}$ is the drain-to-source voltage, and $\\lambda$ is the channel-length modulation parameter.\n\nFor the reference transistor $M_1$, the drain is tied to the gate, so $V_{\\text{DS1}} = V_{\\text{GS1}}$. The reference current $I_{\\text{ref}}$ is the drain current of $M_1$:\n$$I_{\\text{ref}} = I_{D1} = \\frac{1}{2} k' \\left(\\frac{W}{L}\\right)_1 (V_{\\text{GS1}} - V_{th})^2 (1 + \\lambda_{\\text{ref}} V_{\\text{DS1}})$$\nFor the output transistor $M_2$, the gates are connected, so $V_{\\text{GS2}} = V_{\\text{GS1}}$. The output current $I_{\\text{out}}$ is the drain current of $M_2$:\n$$I_{\\text{out}} = I_{D2} = \\frac{1}{2} k' \\left(\\frac{W}{L}\\right)_2 (V_{\\text{GS2}} - V_{th})^2 (1 + \\lambda_{\\text{out}} V_{\\text{DS2}})$$\nThe problem states the transistors are identical within each configuration, which means they share the same $k'$, $V_{th}$, $W$, and $L$. Thus, $(W/L)_1 = (W/L)_2$. As noted, $V_{\\text{GS1}} = V_{\\text{GS2}}$. We can find the ratio of the output current to the reference current by dividing the two equations:\n$$\\frac{I_{\\text{out}}}{I_{\\text{ref}}} = \\frac{\\frac{1}{2} k' (W/L) (V_{\\text{GS}} - V_{th})^2 (1 + \\lambda_{\\text{out}} V_{\\text{DS2}})}{\\frac{1}{2} k' (W/L) (V_{\\text{GS}} - V_{th})^2 (1 + \\lambda_{\\text{ref}} V_{\\text{DS1}})} = \\frac{1 + \\lambda_{\\text{out}} V_{\\text{DS,out}}}{1 + \\lambda_{\\text{ref}} V_{\\text{DS,ref}}}$$\nHere we have substituted $V_{\\text{DS1}}$ with the given name $V_{\\text{DS,ref}}$ and $V_{\\text{DS2}}$ with $V_{\\text{DS,out}}$.\n\nThe fractional current error, $\\epsilon$, is defined as the relative difference between the output and reference currents:\n$$\\epsilon = \\frac{I_{\\text{out}} - I_{\\text{ref}}}{I_{\\text{ref}}} = \\frac{I_{\\text{out}}}{I_{\\text{ref}}} - 1$$\nSubstituting the derived ratio, we obtain the expression for the fractional error:\n$$\\epsilon = \\frac{1 + \\lambda_{\\text{out}} V_{\\text{DS,out}}}{1 + \\lambda_{\\text{ref}} V_{\\text{DS,ref}}} - 1 = \\frac{(1 + \\lambda_{\\text{out}} V_{\\text{DS,out}}) - (1 + \\lambda_{\\text{ref}} V_{\\text{DS,ref}})}{1 + \\lambda_{\\text{ref}} V_{\\text{DS,ref}}}$$\n$$\\epsilon = \\frac{\\lambda_{\\text{out}} V_{\\text{DS,out}} - \\lambda_{\\text{ref}} V_{\\text{DS,ref}}}{1 + \\lambda_{\\text{ref}} V_{\\text{DS,ref}}}$$\nThis is the general expression for the fractional error due to channel-length modulation.\n\nNow, we compute the fractional error for each of the two configurations.\nThe provided bias voltages are $V_{\\text{DS,ref}} = 0.50\\,\\text{V}$ and $V_{\\text{DS,out}} = 1.20\\,\\text{V}$.\n\nFor the first configuration with $L = 0.18\\,\\mu\\text{m}$, the parameters are $\\lambda_{\\text{ref},1} = 0.12\\,\\text{V}^{-1}$ and $\\lambda_{\\text{out},1} = 0.11\\,\\text{V}^{-1}$.\nThe fractional error, $\\epsilon_1$, is:\n$$\\epsilon_1 = \\frac{(0.11\\,\\text{V}^{-1})(1.20\\,\\text{V}) - (0.12\\,\\text{V}^{-1})(0.50\\,\\text{V})}{1 + (0.12\\,\\text{V}^{-1})(0.50\\,\\text{V})} = \\frac{0.132 - 0.060}{1 + 0.060} = \\frac{0.072}{1.060}$$\n$$\\epsilon_1 \\approx 0.0679245$$\n\nFor the second configuration with $L = 0.36\\,\\mu\\text{m}$, the parameters are $\\lambda_{\\text{ref},2} = 0.060\\,\\text{V}^{-1}$ and $\\lambda_{\\text{out},2} = 0.055\\,\\text{V}^{-1}$.\nThe fractional error, $\\epsilon_2$, is:\n$$\\epsilon_2 = \\frac{(0.055\\,\\text{V}^{-1})(1.20\\,\\text{V}) - (0.060\\,\\text{V}^{-1})(0.50\\,\\text{V})}{1 + (0.060\\,\\text{V}^{-1})(0.50\\,\\text{V})} = \\frac{0.066 - 0.030}{1 + 0.030} = \\frac{0.036}{1.030}$$\n$$\\epsilon_2 \\approx 0.0349515$$\n\nThe problem defines the improvement in mirror accuracy as the ratio of the magnitude of the fractional error at $L = 0.18\\,\\mu\\text{m}$ to that at $L = 0.36\\,\\mu\\text{m}$. Let us denote this improvement as $I_{\\text{imp}}$.\n$$I_{\\text{imp}} = \\frac{|\\epsilon_1|}{|\\epsilon_2|}$$\nSince both $\\epsilon_1$ and $\\epsilon_2$ are positive, the absolute value is trivial.\n$$I_{\\text{imp}} = \\frac{\\frac{0.072}{1.060}}{\\frac{0.036}{1.030}} = \\frac{0.072}{0.036} \\times \\frac{1.030}{1.060} = 2 \\times \\frac{1.030}{1.060}$$\n$$I_{\\text{imp}} \\approx 1.9433962...$$\nThe problem requires the final answer to be rounded to four significant figures.\n$$I_{\\text{imp}} \\approx 1.943$$\nThis result indicates that doubling the channel length improves the current mirror's accuracy by a factor of approximately $1.943$ under the specified conditions, which is consistent with the expectation that longer channel devices exhibit weaker channel-length modulation effects and thus form more ideal current sources.",
            "answer": "$$\\boxed{1.943}$$"
        },
        {
            "introduction": "Beyond deterministic effects, the performance of modern integrated circuits is fundamentally limited by random process variations. This advanced practice moves from analyzing predictable non-idealities to tackling statistical mismatch between transistors, a dominant source of error in scaled technologies. Using the industry-standard Pelgrom mismatch model and Monte Carlo simulations, you will analyze the statistical spread of the output current and learn how to size devices to meet a specific manufacturing yield target, connecting device physics directly to the economic realities of IC production. ",
            "id": "4257603",
            "problem": "An Electronic Design Automation (EDA) program must analyze the statistical current error of a basic Metal–Oxide–Semiconductor Field-Effect Transistor (MOSFET) current mirror due to device mismatch, using Monte Carlo (MC) simulation and first-principles modeling. The devices are assumed long-channel and operate in strong inversion with well-defined overdrive voltage. The mismatch follows Pelgrom’s law. The program must compute, for each test case, the three-sigma current spread around the ideal mirror current and the minimum area scale factor needed to meet a specified yield target under a two-sided relative error tolerance.\n\nFundamental base:\n- Square-law current in strong inversion for long-channel MOSFETs: for device $i$, the drain current in saturation is $$I_i = \\frac{1}{2} \\beta_i (V_{\\mathrm{ov},i})^2,$$ where $\\beta_i = k' \\frac{W_i}{L_i}$, $k'$ is the process transconductance factor, $W_i$ is the device width, $L_i$ is the device length, and $V_{\\mathrm{ov},i} = V_{\\mathrm{GS},i} - V_{\\mathrm{TH},i}$ is the overdrive voltage. Channel-length modulation and other second-order effects are neglected.\n- In a two-transistor current mirror, the reference transistor is diode-connected, establishing a gate-source voltage $V_{\\mathrm{GS}}$ such that the reference current $I_{\\mathrm{ref}}$ flows. The output transistor sees the same $V_{\\mathrm{GS}}$ (neglecting interconnect gradients), and the ideal current ratio equals the geometry scale factor $s = \\frac{W_2/L_2}{W_1/L_1}$, so ideally $I_{\\mathrm{out,ideal}} = s I_{\\mathrm{ref}}$.\n- Pelgrom mismatch model for two nearby devices:\n  - Threshold voltage mismatch is modeled as a zero-mean Gaussian random variable $\\Delta V_{\\mathrm{TH}}$ with standard deviation $$\\sigma_{\\Delta V_{\\mathrm{TH}}} = \\frac{A_{V_{\\mathrm{TH}}}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}},$$ where $A_{V_{\\mathrm{TH}}}$ is the Pelgrom coefficient for threshold voltage with units $\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$, and $s$ accounts for output device scaling when $L_2 = L_1$ and $W_2 = s W_1$.\n  - Current factor (mobility-capacitance) relative mismatch is modeled by a zero-mean Gaussian random variable $\\delta_\\beta$ with standard deviation $$\\sigma_{\\delta_\\beta} = \\frac{A_{\\beta}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}},$$ where $A_{\\beta}$ is the Pelgrom coefficient for relative $\\beta$ mismatch with units $\\text{unitless}\\cdot\\mu\\mathrm{m}^{1/2}$. Geometry scaling $s$ is not part of $\\delta_\\beta$; it multiplies the nominal ratio $\\beta_2/\\beta_1$.\n- With the same $V_{\\mathrm{GS}}$ across both devices, $V_{\\mathrm{GS}} = V_{\\mathrm{TH},1} + V_{\\mathrm{ov},1}$, the output device overdrive is $V_{\\mathrm{ov},2} = V_{\\mathrm{GS}} - V_{\\mathrm{TH},2} = V_{\\mathrm{ov},1} - \\Delta V_{\\mathrm{TH}}$, where $\\Delta V_{\\mathrm{TH}} = V_{\\mathrm{TH},2} - V_{\\mathrm{TH},1}$. The output current becomes $$I_{\\mathrm{out}} = \\frac{1}{2}\\beta_2\\big(V_{\\mathrm{ov},1} - \\Delta V_{\\mathrm{TH}}\\big)^2 = s\\,I_{\\mathrm{ref}} \\cdot (1+\\delta_\\beta)\\left(1 - \\frac{\\Delta V_{\\mathrm{TH}}}{V_{\\mathrm{ov},1}}\\right)^2.$$\n- The relative current error (dimensionless) is defined as $$\\varepsilon = \\frac{I_{\\mathrm{out}} - s I_{\\mathrm{ref}}}{s I_{\\mathrm{ref}}} = (1+\\delta_\\beta)\\left(1 - \\frac{\\Delta V_{\\mathrm{TH}}}{V_{\\mathrm{ov},1}}\\right)^2 - 1.$$\n\nTasks:\n1. For each test case, perform a Monte Carlo (MC) simulation with $N$ samples to generate $\\Delta V_{\\mathrm{TH}} \\sim \\mathcal{N}(0, \\sigma_{\\Delta V_{\\mathrm{TH}}}^2)$ and $\\delta_\\beta \\sim \\mathcal{N}(0, \\sigma_{\\delta_\\beta}^2)$ independently, compute the output current $I_{\\mathrm{out}}$ for the given $s$, and compute the three-sigma current spread around the ideal current as $$\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}\\big(I_{\\mathrm{out}} - s I_{\\mathrm{ref}}\\big),$$ expressed in Amperes.\n2. Using a first-order linearization of $\\varepsilon$ around zero mismatch, derive an analytical condition on the standard deviation $\\sigma_\\varepsilon(s)$ ensuring that a two-sided tolerance $|\\varepsilon| \\le t$ is met with probability at least $p$ (the yield target). Use the inverse cumulative distribution function of the standard normal distribution. From this, compute the minimum scale factor $s_{\\min} \\ge 1$ required to meet the yield target for the specified tolerance. If no finite $s$ can satisfy the yield target, output $-1.0$ for $s_{\\min}$.\n\nSimulation and units:\n- Use $N = 200000$ samples for MC and a fixed random seed of $123$ for reproducibility.\n- All currents must be in $\\mathrm{A}$.\n- All dimensions $W$ and $L$ must be in $\\mu\\mathrm{m}$.\n- $A_{V_{\\mathrm{TH}}}$ must be in $\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$.\n- $A_{\\beta}$ must be in $\\text{unitless}\\cdot\\mu\\mathrm{m}^{1/2}$.\n- Overdrive voltage $V_{\\mathrm{ov},1}$ must be in $\\mathrm{V}$.\n- The tolerance $t$ is dimensionless (relative error).\n- The yield target $p$ is a probability in the interval $(0,1)$.\n\nTest suite:\nProvide results for the following four parameter sets to test different facets of the solution. Each list entry is a tuple in the order $(I_{\\mathrm{ref}}, V_{\\mathrm{ov},1}, W_1, L_1, s, A_{V_{\\mathrm{TH}}}, A_{\\beta}, p, t)$.\n\n- Case $1$ (happy path):\n  - $I_{\\mathrm{ref}} = 1.0\\times 10^{-5}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.2\\,\\mathrm{V}$, $W_1 = 10.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}^{1/2}$, $p = 0.99$, $t = 0.05$.\n- Case $2$ (small device area, relaxed tolerance, high yield):\n  - $I_{\\mathrm{ref}} = 1.0\\times 10^{-4}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.25\\,\\mathrm{V}$, $W_1 = 0.8\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$, $A_{\\beta} = 1.5\\times 10^{-2}\\,\\mu\\mathrm{m}^{1/2}$, $p = 0.9973$, $t = 0.10$.\n- Case $3$ (scaled mirror, stringent yield and tolerance):\n  - $I_{\\mathrm{ref}} = 5.0\\times 10^{-5}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.15\\,\\mathrm{V}$, $W_1 = 4.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 4.0$, $A_{V_{\\mathrm{TH}}} = 2.5\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}^{1/2}$, $p = 0.999$, $t = 0.03$.\n- Case $4$ (low overdrive, moderate area, difficult yield):\n  - $I_{\\mathrm{ref}} = 5.0\\times 10^{-6}\\,\\mathrm{A}$, $V_{\\mathrm{ov},1} = 0.06\\,\\mathrm{V}$, $W_1 = 20.0\\,\\mu\\mathrm{m}$, $L_1 = 0.18\\,\\mu\\mathrm{m}$, $s = 1.0$, $A_{V_{\\mathrm{TH}}} = 3.0\\times 10^{-3}\\,\\mathrm{V}\\cdot\\mu\\mathrm{m}^{1/2}$, $A_{\\beta} = 1.0\\times 10^{-2}\\,\\mu\\mathrm{m}^{1/2}$, $p = 0.95$, $t = 0.02$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output two values in order: the three-sigma current spread $\\Delta I_{3\\sigma}$ in $\\mathrm{A}$ as a floating-point number, and the minimum scale factor $s_{\\min}$ as a floating-point number (use $-1.0$ if no finite $s$ can meet the yield). The output therefore contains $8$ numbers corresponding to the $4$ test cases, for example, $[\\Delta I_{3\\sigma,1}, s_{\\min,1}, \\Delta I_{3\\sigma,2}, s_{\\min,2}, \\Delta I_{3\\sigma,3}, s_{\\min,3}, \\Delta I_{3\\sigma,4}, s_{\\min,4}]$.",
            "solution": "The problem requires an analysis of a basic MOSFET current mirror's performance, accounting for statistical mismatch between the two transistors. The analysis has two parts: first, a Monte Carlo (MC) simulation to determine the statistical spread of the output current, and second, an analytical derivation to find the minimum required device sizing to meet a specified yield target.\n\nThe fundamental models provided are the long-channel square-law model for MOSFET drain current in saturation, $I_i = \\frac{1}{2} \\beta_i (V_{\\mathrm{ov},i})^2$ with $\\beta_i = k' (W_i/L_i)$, and the Pelgrom mismatch model for threshold voltage ($V_{\\mathrm{TH}}$) and current factor ($\\beta$). The output current $I_{\\mathrm{out}}$ is affected by the mismatch between the reference transistor (device $1$) and the output transistor (device $2$). Given that both transistors share the same gate-source voltage $V_{\\mathrm{GS}}$, the output current is expressed as $I_{\\mathrm{out}} = s I_{\\mathrm{ref}} (1+\\delta_\\beta)(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2$, where $s$ is the geometric scaling factor, $I_{\\mathrm{ref}}$ is the reference current, $V_{\\mathrm{ov},1}$ is the overdrive voltage of the reference device, and $\\Delta V_{\\mathrm{TH}}$ and $\\delta_\\beta$ are zero-mean Gaussian random variables representing the mismatch in threshold voltage and current factor, respectively.\n\nThe first task is to compute the three-sigma spread of the current error, $\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}(I_{\\mathrm{out}} - s I_{\\mathrm{ref}})$, for a given set of device and operating parameters. This is accomplished using a Monte Carlo simulation.\nThe standard deviations of the mismatch variables, $\\sigma_{\\Delta V_{\\mathrm{TH}}}$ and $\\sigma_{\\delta_\\beta}$, depend on the Pelgrom coefficients ($A_{V_{\\mathrm{TH}}}$, $A_{\\beta}$), the area of the reference device ($W_1 L_1$), and the scaling factor ($s$), according to the provided formulas:\n$$ \\sigma_{\\Delta V_{\\mathrm{TH}}} = \\frac{A_{V_{\\mathrm{TH}}}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}} $$\n$$ \\sigma_{\\delta_\\beta} = \\frac{A_{\\beta}}{\\sqrt{W_1 L_1}} \\sqrt{1 + \\frac{1}{s}} $$\nFor each test case, the simulation proceeds as follows:\n1.  Calculate the numerical values of $\\sigma_{\\Delta V_{\\mathrm{TH}}}$ and $\\sigma_{\\delta_\\beta}$ using the given parameters.\n2.  Generate $N=200000$ independent random samples for $\\Delta V_{\\mathrm{TH}}$ from the distribution $\\mathcal{N}(0, \\sigma_{\\Delta V_{\\mathrm{TH}}}^2)$ and for $\\delta_\\beta$ from $\\mathcal{N}(0, \\sigma_{\\delta_\\beta}^2)$. A fixed random seed of $123$ is used for reproducibility.\n3.  For each pair of samples $(\\Delta V_{\\mathrm{TH}}[i], \\delta_\\beta[i])$, compute the corresponding output current $I_{\\mathrm{out}}[i]$.\n4.  Calculate the ideal output current, $I_{\\mathrm{out,ideal}} = s I_{\\mathrm{ref}}$.\n5.  Compute the array of current errors, $\\Delta I[i] = I_{\\mathrm{out}}[i] - I_{\\mathrm{out,ideal}}$.\n6.  The three-sigma spread is then calculated as $\\Delta I_{3\\sigma} = 3 \\cdot \\mathrm{std}(\\Delta I)$, where $\\mathrm{std}(\\cdot)$ is the standard deviation of the array of current errors.\n\nThe second task is to derive an analytical expression for the minimum scaling factor, $s_{\\min} \\ge 1$, required to ensure that the relative current error, $\\varepsilon = (I_{\\mathrm{out}} - s I_{\\mathrm{ref}}) / (s I_{\\mathrm{ref}})$, is within a tolerance $\\pm t$ with a probability (yield) of at least $p$. This requires a first-order linearization of the expression for $\\varepsilon$ with respect to the mismatch variables $\\Delta V_{\\mathrm{TH}}$ and $\\delta_\\beta$. The Taylor series expansion of $\\varepsilon$ around $\\Delta V_{\\mathrm{TH}} = 0$ and $\\delta_\\beta = 0$ is:\n$$ \\varepsilon(\\delta_\\beta, \\Delta V_{\\mathrm{TH}}) = \\varepsilon(0,0) + \\frac{\\partial \\varepsilon}{\\partial \\delta_\\beta}\\bigg|_{(0,0)} \\delta_\\beta + \\frac{\\partial \\varepsilon}{\\partial \\Delta V_{\\mathrm{TH}}}\\bigg|_{(0,0)} \\Delta V_{\\mathrm{TH}} + \\dots $$\nWith $\\varepsilon = (1+\\delta_\\beta)(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2 - 1$, the partial derivatives are $\\frac{\\partial \\varepsilon}{\\partial \\delta_\\beta} = (1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})^2$ and $\\frac{\\partial \\varepsilon}{\\partial \\Delta V_{\\mathrm{TH}}} = (1+\\delta_\\beta) \\cdot 2(1 - \\Delta V_{\\mathrm{TH}}/V_{\\mathrm{ov},1})(-\\frac{1}{V_{\\mathrm{ov},1}})$. Evaluating at $(0,0)$ gives partial derivatives of $1$ and $-2/V_{\\mathrm{ov},1}$, respectively. The linearized error is thus:\n$$ \\varepsilon_{\\mathrm{lin}} = \\delta_\\beta - \\frac{2}{V_{\\mathrm{ov},1}}\\Delta V_{\\mathrm{TH}} $$\nSince $\\delta_\\beta$ and $\\Delta V_{\\mathrm{TH}}$ are independent, zero-mean Gaussian variables, $\\varepsilon_{\\mathrm{lin}}$ is also a zero-mean Gaussian variable. Its variance is the sum of the variances of its components:\n$$ \\sigma^2_\\varepsilon = \\mathrm{Var}(\\varepsilon_{\\mathrm{lin}}) = \\mathrm{Var}(\\delta_\\beta) + \\left(-\\frac{2}{V_{\\mathrm{ov},1}}\\right)^2 \\mathrm{Var}(\\Delta V_{\\mathrm{TH}}) = \\sigma^2_{\\delta_\\beta} + \\frac{4}{V_{\\mathrm{ov},1}^2}\\sigma^2_{\\Delta V_{\\mathrm{TH}}} $$\nSubstituting the Pelgrom-based expressions for the variances gives:\n$$ \\sigma^2_\\varepsilon(s) = \\left( \\frac{A_\\beta^2}{W_1 L_1} + \\frac{4A_{V_{\\mathrm{TH}}}^2}{V_{\\mathrm{ov},1}^2 W_1 L_1} \\right) \\left(1 + \\frac{1}{s}\\right) = \\frac{A_{\\mathrm{comb}}^2}{W_1 L_1} \\left(1 + \\frac{1}{s}\\right) $$\nwhere $A_{\\mathrm{comb}}^2 = A_\\beta^2 + 4A_{V_{\\mathrm{TH}}}^2/V_{\\mathrm{ov},1}^2$ is a combined mismatch coefficient that is independent of geometry.\n\nThe yield requirement $P(|\\varepsilon| \\le t) \\ge p$ for a zero-mean Gaussian variable $\\varepsilon$ is equivalent to $P(-t \\le \\varepsilon \\le t) \\ge p$. Normalizing by $\\sigma_\\varepsilon$, this becomes $P(-t/\\sigma_\\varepsilon \\le Z \\le t/\\sigma_\\varepsilon) \\ge p$, where $Z$ is a standard normal variable. If $\\Phi(z)$ is the standard normal cumulative distribution function (CDF), then $2\\Phi(t/\\sigma_\\varepsilon) - 1 \\ge p$. This implies $t/\\sigma_\\varepsilon \\ge z_p$, where $z_p = \\Phi^{-1}((1+p)/2)$ is the z-score corresponding to the two-sided probability $p$. The condition on the variance is therefore $\\sigma^2_\\varepsilon \\le (t/z_p)^2$.\n\nWe substitute the expression for $\\sigma^2_\\varepsilon(s)$ into this inequality to solve for $s$:\n$$ \\frac{A_{\\mathrm{comb}}^2}{W_1 L_1} \\left(1 + \\frac{1}{s}\\right) \\le \\left(\\frac{t}{z_p}\\right)^2 $$\n$$ 1 + \\frac{1}{s} \\le \\frac{W_1 L_1}{A_{\\mathrm{comb}}^2} \\left(\\frac{t}{z_p}\\right)^2 $$\nLet's define a dimensionless quantity $K = \\frac{W_1 L_1}{A_{\\mathrm{comb}}^2} (\\frac{t}{z_p})^2$. The inequality becomes $1 + 1/s \\le K$, or $1/s \\le K - 1$.\nFor a solution with finite, positive $s$ to exist, we must have $K - 1 > 0$, i.e., $K>1$. If $K \\le 1$, it is impossible to meet the yield specifications by scaling the output device, and $s_{\\min}$ is reported as $-1.0$.\nIf $K > 1$, we can write $s \\ge 1/(K-1)$. The minimum required scale factor is $s_{\\mathrm{min,raw}} = 1/(K-1)$.\nGiven the additional constraint that $s_{\\min} \\ge 1$, the final minimum scale factor is $s_{\\min} = \\max(1.0, 1/(K-1))$. This analytical procedure is applied to each test case to find $s_{\\min}$.",
            "answer": "`[4.332309117652759e-07,1.0,1.0116035048865666e-05,1.0,2.373264426553813e-06,2.353347596043139,1.0090886586071536e-06,-1.0]`"
        }
    ]
}