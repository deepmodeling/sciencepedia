{
    "hands_on_practices": [
        {
            "introduction": "随着技术节点的缩小，互连线延迟已成为限制芯片性能的主要因素。本练习将引导你从物理第一性原理出发，为分布式RC（电阻-电容）网络建立一个有效的信号延迟模型。通过计算导线远端的信号上升时间，你将亲身体会到金属化和低κ电介质的电气特性如何直接影响电路的时序性能，并掌握评估互连延迟的关键近似方法。",
            "id": "4282373",
            "problem": "一条布线于低介电常数（low-$\\kappa$）层间介质中的全局铜互连，被建模为一条均匀分布的电阻-电容（RC）线。该线路长度为 $L$，单位长度电阻为 $r$（源于金属化几何形状和散射限制的铜电阻率），单位长度电容为 $c$（包括平行板和边缘场贡献，由电子设计自动化（EDA）寄生参数提取工具针对低-$\\kappa$ 堆叠结构提取）。该线路由一个阶跃源通过一个源（驱动）电阻 $R_{d}$ 驱动，其远端连接到一个高阻抗接收器，因此除了分布电容之外，没有额外的集总负载。假设在所关注的边沿速率下，电感效应可以忽略不计。\n\n从第一性原理出发，从分布式RC线的扩散描述和电荷守恒开始。通过匹配RC梯形网络的脉冲响应的一阶时间矩，为远端阶跃响应构建一个有效的一阶近似。使用这个具有物理依据的单极点近似，计算接收端的 $10$–$90$ 上升时间。\n\n使用以下对应于一个低-$\\kappa$ 后端堆叠结构的参数：\n- 驱动电阻: $R_{d} = 35\\ \\Omega$。\n- 线路长度: $L = 8\\ \\mathrm{mm}$。\n- 单位长度电阻: $r = 7.5\\ \\Omega/\\mathrm{mm}$。\n- 单位长度电容（针对低-$\\kappa$ 提取，$\\kappa \\approx 2.7$）: $c = 0.22\\ \\mathrm{fF}/\\mu\\mathrm{m}$。\n\n将您的最终答案表示为一个以皮秒为单位的实数，并四舍五入到三位有效数字。",
            "solution": "一条长的片上互连，布线在低介电常数（low-$\\kappa$）电介质上并有接地屏蔽，可被建模为分布式电阻-电容（RC）传输线。在电感可忽略的情况下，线路电压 $v(x,t)$ 和电流 $i(x,t)$ 满足电阻-电容电报方程\n$$\n\\frac{\\partial v(x,t)}{\\partial x} = - r\\, i(x,t), \\qquad \\frac{\\partial i(x,t)}{\\partial x} = - c\\, \\frac{\\partial v(x,t)}{\\partial t},\n$$\n它们结合成扩散方程\n$$\n\\frac{\\partial v(x,t)}{\\partial t} = \\frac{1}{r c}\\, \\frac{\\partial^{2} v(x,t)}{\\partial x^{2}}.\n$$\n输入端通过一个源电阻 $R_{d}$ 以单位阶跃信号驱动该线路，远端 $x = L$ 处开路（接收器输入为高阻抗）。\n\n精确的远端阶跃响应是一个非指数上升过程，可以表示为一系列实数衰减模式。对于电路时序分析，一个标准的基于物理的近似方法是用一个有效的单极点系统来表示响应，其时间常数的选择是为了匹配一阶时间矩（脉冲响应的“质心”）。这种方法等效于匹配RC网络脉冲响应的一阶矩，并导出了著名的Elmore延迟。对于带有驱动电阻 $R_{d}$ 的分布式RC线，这个单极点近似的有效时间常数 $\\tau$ 是通过对线路上每个无穷小电容所看到的电阻进行积分得到的：\n$$\n\\tau \\equiv \\int_{0}^{L} R_{\\mathrm{seen}}(x)\\, dC(x).\n$$\n此处，无穷小电容为 $dC(x) = c\\, dx$，而 $dC(x)$ 回望源端所看到的电阻是 $R_{\\mathrm{seen}}(x) = R_{d} + r x$（源电阻加上从 $x=0$ 到 $x$ 这段线路的电阻）。因此，\n$$\n\\tau = \\int_{0}^{L} \\bigl(R_{d} + r x \\bigr)\\, c\\, dx = c \\left( R_{d} \\int_{0}^{L} dx + r \\int_{0}^{L} x\\, dx \\right)\n= c \\left( R_{d} L + \\frac{r L^{2}}{2} \\right).\n$$\n在单极点模型中，远端阶跃响应近似为\n$$\nv_{\\mathrm{out}}(t) \\approx V_{\\mathrm{DD}} \\left(1 - \\exp\\!\\left(-\\frac{t}{\\tau}\\right)\\right).\n$$\n对于此波形，达到最终值的分数 $p$ 所需的时间 $t_{p}$ 满足\n$$\np = 1 - \\exp\\!\\left(-\\frac{t_{p}}{\\tau}\\right) \\ \\Rightarrow\\ t_{p} = - \\tau \\ln(1-p).\n$$\n因此，$10$–$90$ 上升时间是\n$$\nt_{10\\text{–}90} = t_{0.9} - t_{0.1} = \\tau \\left[ -\\ln(1-0.9) + \\ln(1-0.1) \\right]\n= \\tau \\left[ \\ln(10) - \\ln\\!\\left(\\frac{10}{9}\\right) \\right] = \\tau \\ln(9).\n$$\n等效地，\n$$\nt_{10\\text{–}90} = \\ln(9)\\, c \\left( R_{d} L + \\frac{r L^{2}}{2} \\right).\n$$\n\n现在代入给定的数值，注意单位的一致转换。首先，将单位长度电容 $c$ 转换为 $\\mathrm{F}/\\mathrm{m}$：\n$$\nc = 0.22\\ \\mathrm{fF}/\\mu\\mathrm{m} = 0.22 \\times 10^{-15}\\ \\mathrm{F}/10^{-6}\\ \\mathrm{m} = 2.2 \\times 10^{-10}\\ \\mathrm{F}/\\mathrm{m}.\n$$\n将线路长度 $L$ 转换为米：\n$$\nL = 8\\ \\mathrm{mm} = 8 \\times 10^{-3}\\ \\mathrm{m}.\n$$\n将单位长度电阻 $r$ 转换为 $\\Omega/\\mathrm{m}$：\n$$\nr = 7.5\\ \\Omega/\\mathrm{mm} = 7.5 \\times 10^{3}\\ \\Omega/\\mathrm{m}.\n$$\n通过矩积分计算有效时间常数：\n$$\n\\tau = c \\left( R_{d} L + \\frac{r L^{2}}{2} \\right)\n= \\left(2.2 \\times 10^{-10}\\right) \\left[ 35 \\cdot \\left(8 \\times 10^{-3}\\right) + \\frac{7.5 \\times 10^{3} \\cdot \\left(8 \\times 10^{-3}\\right)^{2}}{2} \\right]\\ \\mathrm{s}.\n$$\n计算方括号中的项：\n$$\nR_{d} L = 35 \\cdot 8 \\times 10^{-3} = 280 \\times 10^{-3} = 0.28\\ \\Omega\\cdot\\mathrm{m},\n$$\n$$\n\\frac{r L^{2}}{2} = \\frac{7.5 \\times 10^{3} \\cdot 64 \\times 10^{-6}}{2}\n= \\frac{480 \\times 10^{-3}}{2} = 0.24\\ \\Omega\\cdot\\mathrm{m}.\n$$\n因此，\n$$\nR_{d} L + \\frac{r L^{2}}{2} = 0.28 + 0.24 = 0.52\\ \\Omega\\cdot\\mathrm{m},\n$$\n并且\n$$\n\\tau = \\left(2.2 \\times 10^{-10}\\right) \\cdot 0.52\\ \\mathrm{s} = 1.144 \\times 10^{-10}\\ \\mathrm{s}.\n$$\n最后，$10$–$90$ 上升时间是\n$$\nt_{10\\text{–}90} = \\ln(9)\\, \\tau \\approx 2.19722458 \\times 1.144 \\times 10^{-10}\\ \\mathrm{s}\n= 2.513 \\times 10^{-10}\\ \\mathrm{s}.\n$$\n以皮秒表示，\n$$\nt_{10\\text{–}90} = 2.513 \\times 10^{-10}\\ \\mathrm{s} \\times 10^{12}\\ \\mathrm{ps}/\\mathrm{s} = 251.3\\ \\mathrm{ps}.\n$$\n按要求四舍五入到三位有效数字，结果是 $251\\ \\mathrm{ps}$。",
            "answer": "$$\\boxed{251}$$"
        },
        {
            "introduction": "引入多孔、易碎的低κ电介质在带来性能优势的同时，也给制造过程带来了严峻的力学稳定性挑战。本练习聚焦于湿法清洗过程中由毛细作用力引起的“图形坍塌”现象，这是一个关键的制造失效模式。通过建立毛细作用压力与电介质鳍状结构弹性恢复力之间的平衡，你将推导出为避免坍塌所允许的最大深宽比，这对于制定可制造性设计规则至关重要。",
            "id": "4282323",
            "problem": "在集成电路制造的后段金属化工艺中，会图形化低介电常数（low-$k$）电介质鳍片阵列来限定铜互连结构。在湿法清洗和漂洗过程中，相邻鳍片间充满液体的间隙中的毛细作用力会引发机械不稳定性，从而导致图形坍塌。考虑一个由相同、平行的 low-$k$ 鳍片组成的周期性阵列，其高度为 $h$，鳍片宽度（在横向弯曲方向上）为 $w$，沿线方向的深度很大，因此分析时采用单位深度。相邻鳍片之间的间隙（在顶部测量）为 $s$。液体的表面张力为 $\\gamma$，与电介质表面的接触角为 $\\theta$。鳍片的底部被钳制在基底上，顶部自由，其弹性行为由杨氏模量 $E$ 表征。假设液-气界面沿线方向的曲率与跨越间隙的曲率相比可以忽略不计，并假设毛细压力均匀作用于整个鳍片侧壁高度。同时假设小挠度线性弹性，且坍塌阈值由细长梁的屈曲不稳定性决定。\n\n从毛细作用和弹性稳定性的基本关系出发，通过将毛细压力引起的横向载荷与临界屈曲载荷相等，确定在毛细加载下为避免坍塌，鳍片所能具有的最大高宽比 $\\mathrm{AR}_{\\max} = h/w$。请用 $E$、$\\gamma$、$\\theta$ 和 $s$ 将最终答案表示为单一的闭式解析表达式。无需进行数值计算。请清晰地说明您定义的任何中间物理量。最终答案是无量纲的；该表达式无需注明单位。中间步骤和最终表达式均不要取整。",
            "solution": "该问题要求我们通过平衡毛细作用力与结构的弹性恢复力来推导避免图形坍塌的最大高宽比。这是一种典型的屈曲不稳定性问题，其核心是遵循问题中给出的简化模型：将毛细压力引起的横向载荷与临界屈曲载荷相等同。\n\n**1. 毛细压力与横向载荷的计算**\n\n在湿法清洗后，残留在间隙中的液体由于表面张力会形成弯月面，从而在液体内部产生负压（相对于环境压力）。这个压力即为毛细压力 $P_{\\mathrm{cap}}$。根据杨-拉普拉斯方程，对于跨越间隙 $s$ 的二维圆柱形弯月面（忽略沿线方向的曲率），其压力差为：\n$$ P_{\\mathrm{cap}} = \\frac{2 \\gamma \\cos(\\theta)}{s} $$\n其中 $\\gamma$ 是液体表面张力，$\\theta$ 是接触角。这个压力作用在鳍片的内侧壁上，将其拉向相邻的鳍片。\n\n问题假设该压力均匀作用于整个鳍片高度 $h$。对于单位深度的鳍片，这个压力产生了一个总的横向力 $F_{\\mathrm{lateral}}$，其大小为压力乘以作用面积（$h \\times 1$）：\n$$ F_{\\mathrm{lateral}} = P_{\\mathrm{cap}} \\cdot h = \\frac{2 \\gamma h \\cos(\\theta)}{s} $$\n\n**2. 临界屈曲载荷的确定**\n\n问题将鳍片建模为底部钳制、顶部自由的悬臂梁，并指出坍塌由“屈曲不稳定性”决定。这是一个关键的简化指令。在梁理论中，悬臂梁在受到轴向压缩力时会发生欧拉屈曲。其临界屈曲载荷 $P_{\\mathrm{cr}}$ 为：\n$$ P_{\\mathrm{cr}} = \\frac{\\pi^2 E I}{(K h)^2} $$\n其中 $E$ 是杨氏模量，$I$ 是梁横截面的惯性矩，$h$ 是梁的高度，$K$ 是有效长度因子。对于固定-自由边界条件的悬臂梁，$K=2$。因此，临界载荷为：\n$$ P_{\\mathrm{cr}} = \\frac{\\pi^2 E I}{4h^2} $$\n对于宽度为 $w$、深度为 $d=1$ 的矩形截面，其抗弯惯性矩为 $I = \\frac{d w^3}{12} = \\frac{w^3}{12}$。代入后得到：\n$$ P_{\\mathrm{cr}} = \\frac{\\pi^2 E w^3}{48h^2} $$\n\n**3. 平衡载荷并求解高宽比**\n\n问题指示我们将“毛细压力引起的横向载荷”与“临界屈曲载荷”相等。尽管物理上一个是横向力，一个是轴向临界力，但这种类比是解决此类简化问题的标准方法。因此，我们令 $F_{\\mathrm{lateral}} = P_{\\mathrm{cr}}$：\n$$ \\frac{2 \\gamma h \\cos(\\theta)}{s} = \\frac{\\pi^2 E w^3}{48h^2} $$\n我们的目标是求解最大高宽比 $\\mathrm{AR}_{\\max} = h/w$。重新整理上式，将包含 $h$ 和 $w$ 的项移到一边：\n$$ h^3 \\cdot (2 \\gamma \\cos(\\theta) \\cdot 48) = w^3 \\cdot (\\pi^2 E s) $$\n$$ 96 \\gamma \\cos(\\theta) h^3 = \\pi^2 E s w^3 $$\n$$ \\frac{h^3}{w^3} = \\frac{\\pi^2 E s}{96 \\gamma \\cos(\\theta)} $$\n最后，取立方根得到最大允许高宽比的表达式：\n$$ \\mathrm{AR}_{\\max} = \\frac{h}{w} = \\left( \\frac{\\pi^{2} E s}{96 \\gamma \\cos(\\theta)} \\right)^{\\frac{1}{3}} $$\n这个表达式符合物理直觉：材料越硬（$E$ 越大）或间隙越大（$s$ 越大），允许的高宽比就越高；而表面张力越大（$\\gamma$ 越大）或液体润湿性越好（$\\cos(\\theta)$ 越大），允许的高宽比就越低。",
            "answer": "$$ \\boxed{ \\left( \\frac{\\pi^{2} E s}{96 \\gamma \\cos(\\theta)} \\right)^{\\frac{1}{3}} } $$"
        },
        {
            "introduction": "多通孔（via array）结构是提高互连可靠性的常用设计，但电流在阵列中的分布并非均匀。本计算实践旨在通过建立一个考虑了“电流拥挤”效应的电阻网络模型，来分析通孔阵列中的真实电流分布。你将应用基尔霍夫定律求解网络，并结合Black方程来量化多通孔设计相对于单个通孔在电迁移（electromigration）寿命上的提升，从而深入理解多维效应对互连可靠性的影响。",
            "id": "4282349",
            "problem": "您的任务是构建并求解一个物理上一致的电阻网络，该网络模拟一个连接顶层金属层与底层金属层的 $3\\times 3$ 通孔阵列，此阵列位于一个使用低介电常数 (low-$\\kappa$) 材料制造的双大马士革互连系统中。目标是计算在非均匀电阻网络下通过通孔的垂直电流分布，并量化相对于单个通孔连接的电迁移寿命改善情况，同时考虑由顶层金属层有限的薄层电阻引起的电流拥挤效应。\n\n仅使用以下基本原理：\n- 欧姆定律：$V=IR$，等效于 $I=GV$，其中 $G=1/R$。\n- 基尔霍夫电流定律 (KCL)：离开任一节点的电流代数和为零。\n- Black电迁移寿命经验方程：$\\mathrm{MTTF}=\\mathcal{A}\\, J^{-n}\\exp\\!\\left(\\frac{E_{\\mathrm{a}}}{k_{\\mathrm{B}}T}\\right)$，其中 $\\mathrm{MTTF}$ 是平均失效时间，$J$ 是电流密度，$n$ 是经验电流指数，$E_{\\mathrm{a}}$ 是活化能，$k_{\\mathrm{B}}$ 是玻尔兹曼常数，$T$ 是绝对温度。\n\n网络模型：\n- 顶层金属层被建模为一个二维电阻网格，以均匀间距在矩形网格中连接 $3\\times 3$ 的通孔焊盘。每对水平相邻的顶部焊盘由一个电阻器 $R_{\\mathrm{top},x} = R_{\\mathrm{sh,top}}\\,(L_x/W_x)$ 连接，每对垂直相邻的顶部焊盘由一个电阻器 $R_{\\mathrm{top},y} = R_{\\mathrm{sh,top}}\\,(L_y/W_y)$ 连接，其中 $R_{\\mathrm{sh,top}}$ 是顶层的薄层电阻，单位为 $\\Omega/\\square$，$L_x$ 和 $L_y$ 分别是沿 $x$ 和 $y$ 方向的焊盘间距，单位为 $\\mathrm{m}$，$W_x$ 和 $W_y$ 分别是沿 $x$ 和 $y$ 方向相邻焊盘之间电流流过的有效顶部金属宽度，单位为 $\\mathrm{m}$。\n- 底层金属层是一个宽阔的低电阻平面，被建模为 $V=0$ 的等电位参考。底层中的横向电阻因 $R_{\\mathrm{sh,bot}}\\rightarrow 0$ 而被忽略，这与厚电源轨或电源平面一致。\n- 每个通孔被建模为一个垂直电阻器，其电阻为 $R_{\\mathrm{via},i}$，将顶部焊盘 $i$ 连接到 $V=0$ 的底层平面。这 $9$ 个通孔电阻可以是非均匀的，以捕捉工艺变化和由低-$\\kappa$ 电介质引起的图形依赖性。\n- 电流拥挤的边界条件：最左列的三个顶部焊盘保持在固定电位 $V_{\\mathrm{app}}$（与馈电焊盘的理想接触），所有其他顶部焊盘的电位未知，由KCL确定。这会驱动顶层网格中的横向电流和通过通孔流向接地底层的垂直电流，从而产生非均匀的通孔电流。\n\n电迁移寿命建模：\n- 假设在固定温度 $T$ 下等温运行，且阵列中所有通孔的横截面积相同，因此电流密度与通过每个通孔的电流成正比。假设每个通孔的失效时间服从统计独立的指数分布，其平均值由Black方程给出，经验指数 $n$ 按每个测试用例提供。在这些假设下，系统的平均首次失效时间（指数寿命下的最弱环节）是失效率之和的倒数。\n\n每个测试用例需要执行的任务：\n1. 为 $3\\times 3$ 顶部节点构建节点KCL方程，将最左列的三个节点视为固定在 $V_{\\mathrm{app}}$，底层平面视为 $V=0$。在 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$ 的条件下，求解线性系统以获得未知的顶部节点电位。\n2. 计算 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$ 时的通孔电流 $I_i$，公式为 $I_i = G_{\\mathrm{via},i}\\,V_{\\mathrm{top},i}$，其中 $G_{\\mathrm{via},i}=1/R_{\\mathrm{via},i}$。在 $1\\,\\mathrm{V}$ 时的总电流为 $I_{\\mathrm{tot},1\\mathrm{V}}=\\sum_{i=1}^{9} I_i$。\n3. 通过将所有通孔电流乘以 $s=I_{\\mathrm{tot}}/I_{\\mathrm{tot},1\\mathrm{V}}$ 来缩放到目标总电流 $I_{\\mathrm{tot}}$，以获得在指定驱动下的物理通孔电流。\n4. 计算电迁移改善因子，其定义为阵列的平均首次失效时间与在相同总电流下单个通孔的平均失效时间之比。将此比率报告为无量纲十进制数。假设单个通孔情况承载全部 $I_{\\mathrm{tot}}$ 电流，且该通孔的横截面与阵列中的通孔相同。\n5. 将通孔电流分布报告为一个包含 $9$ 个电流（单位 A）的列表，按行主序排列（从顶行到底行，每行内从左到右），每个值四舍五入到六位小数。同时报告改善因子，四舍五入到六位小数。\n\n角度单位不适用。所有物理量必须使用以下单位：\n- 电阻，单位 $\\Omega$，\n- 薄层电阻，单位 $\\Omega/\\square$，\n- 长度，单位 $\\mathrm{m}$，\n- 电流，单位 $\\mathrm{A}$，\n- 电压，单位 $\\mathrm{V}$。\n将改善因子表示为纯十进制数（无单位）。\n\n测试套件：\n为以下三种情况提供结果。对于所有情况，在缩放之前求解节点电压时，取 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$。\n\n- 情况1（均匀通孔，中等拥挤）：\n  - $I_{\\mathrm{tot}} = 0.01\\,\\mathrm{A}$，\n  - $R_{\\mathrm{sh,top}} = 0.05\\,\\Omega/\\square$，\n  - $L_x = 2.0\\times 10^{-7}\\,\\mathrm{m}$，$L_y = 2.0\\times 10^{-7}\\,\\mathrm{m}$，\n  - $W_x = 3.0\\times 10^{-7}\\,\\mathrm{m}$，$W_y = 3.0\\times 10^{-7}\\,\\mathrm{m}$，\n  - $n = 1.10$，\n  - $R_{\\mathrm{via}}$ (行主序)：$\\left[0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01,\\,0.01\\right]\\,\\Omega$。\n\n- 情况2（非均匀通孔，更强拥挤）：\n  - $I_{\\mathrm{tot}} = 0.02\\,\\mathrm{A}$，\n  - $R_{\\mathrm{sh,top}} = 0.08\\,\\Omega/\\square$，\n  - $L_x = 2.0\\times 10^{-7}\\,\\mathrm{m}$，$L_y = 2.0\\times 10^{-7}\\,\\mathrm{m}$，\n  - $W_x = 3.0\\times 10^{-7}\\,\\mathrm{m}$，$W_y = 3.0\\times 10^{-7}\\,\\mathrm{m}$，\n  - $n = 1.10$，\n  - $R_{\\mathrm{via}}$ (行主序)：$\\left[0.015,\\,0.012,\\,0.015,\\,0.012,\\,0.020,\\,0.012,\\,0.015,\\,0.012,\\,0.015\\right]\\,\\Omega$。\n\n- 情况3（角通孔开路，顶部宽度较窄）：\n  - $I_{\\mathrm{tot}} = 0.005\\,\\mathrm{A}$，\n  - $R_{\\mathrm{sh,top}} = 0.05\\,\\Omega/\\square$，\n  - $L_x = 2.0\\times 10^{-7}\\,\\mathrm{m}$，$L_y = 2.0\\times 10^{-7}\\,\\mathrm{m}$，\n  - $W_x = 2.0\\times 10^{-7}\\,\\mathrm{m}$，$W_y = 2.5\\times 10^{-7}\\,\\mathrm{m}$，\n  - $n = 1.10$，\n  - $R_{\\mathrm{via}}$ (行主序)：$\\left[10^{9},\\,0.010,\\,0.010,\\,0.010,\\,0.010,\\,0.010,\\,0.010,\\,0.010,\\,0.010\\right]\\,\\Omega$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含一个长度为 $3$ 的列表，每个元素对应一个测试用例，并且本身是一个长度为 $2$ 的列表：第一个元素是改善因子（无量纲十进制数），第二个元素是按行主序排列的 $9$ 个通孔电流（单位 A）的列表。所有数字必须四舍五入到六位小数。例如：$\\left[\\,[\\mathrm{IF}_1,\\,[i_{1,1},\\dots,i_{1,9}]]\\,,\\,[\\mathrm{IF}_2,\\,[\\dots]]\\,,\\,[\\mathrm{IF}_3,\\,[\\dots]]\\,\\right]$。",
            "solution": "问题是分析一个集成电路中 $3\\times 3$ 通孔阵列的电阻网络模型，计算电流分布，并确定相对于单个通孔的电迁移寿命改善。该问题物理上是适定的，并提供了所有必要的参数。我们将通过应用电路理论的基本原理和标准的电迁移模型来解决它。\n\n### 1. 电阻网络模型和节点分析\n\n系统被建模为一个 $3\\times 3$ 的节点网格，代表通孔的顶部焊盘。我们按行主序将这些节点标记为 $1$ 到 $9$（左上角是节点 $1$，右下角是节点 $9$）。\n\n-   **连接**：水平相邻节点通过电阻 $R_{\\mathrm{top},x}$ 连接，垂直相邻节点通过 $R_{\\mathrm{top},y}$ 连接。每个节点 $i$ 通过一个通孔电阻 $R_{\\mathrm{via},i}$ 连接到公共地（$V=0$）。\n-   **边界条件**：最左列的节点（$1$, $4$, 和 $7$）保持在固定电位 $V_{\\mathrm{app}}$。其他六个节点（$2, 3, 5, 6, 8, 9$）的电位未知，我们将其表示为 $V_2, V_3, V_5, V_6, V_8, V_9$。底层金属层是系统地参考，电位为 $V=0\\,\\mathrm{V}$。\n\n为了找到未知电位，我们在六个未知电压节点中的每一个上应用基尔霍夫电流定律 (KCL)。使用电导（$G = 1/R$）更为方便。横向电导为：\n$$G_x = \\frac{1}{R_{\\mathrm{top},x}} = \\frac{1}{R_{\\mathrm{sh,top}}} \\frac{W_x}{L_x}$$\n$$G_y = \\frac{1}{R_{\\mathrm{top},y}} = \\frac{1}{R_{\\mathrm{sh,top}}} \\frac{W_y}{L_y}$$\n节点 $i$ 的垂直通孔电导为 $G_{\\mathrm{via},i} = 1/R_{\\mathrm{via},i}$。\n\n对六个未知节点应用KCL（离开一个节点的电流总和为零），得到一个六个线性方程组。我们定义未知电压向量为 $\\mathbf{V}_{\\mathrm{unk}} = [V_2, V_3, V_5, V_6, V_8, V_9]^T$。该系统可以写成矩阵形式 $\\mathbf{G} \\mathbf{V}_{\\mathrm{unk}} = \\mathbf{I}_{\\mathrm{src}}$，其中 $\\mathbf{G}$ 是 $6\\times 6$ 的电导矩阵，$\\mathbf{I}_{\\mathrm{src}}$ 是由与固定电压节点的连接产生的电流源向量。根据规定，我们设置 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$ 用于初始求解。\n\n对于一个通用未知节点 $u$ 的KCL方程是：\n$$V_u \\left(\\sum_{j \\in \\text{neighbors}} G_{uj} + G_{\\mathrm{via},u}\\right) - \\sum_{k \\in \\text{unknown neighbors}} V_k G_{uk} = \\sum_{f \\in \\text{fixed neighbors}} V_f G_{uf}$$\n由于 $V_f = V_{\\mathrm{app}} = 1\\,\\mathrm{V}$，方程右边成为连接到固定电压邻居的电导之和。\n\n例如，节点 $2$（邻居为 $1, 3, 5$）的KCL方程是：\n$$(V_2 - V_1)G_x + (V_2 - V_3)G_x + (V_2 - V_5)G_y + V_2 G_{\\mathrm{via},2} = 0$$\n由于 $V_1=V_{\\mathrm{app}}=1\\,\\mathrm{V}$，这可以重新整理为：\n$$V_2(2G_x + G_y + G_{\\mathrm{via},2}) - V_3 G_x - V_5 G_y = V_{\\mathrm{app}} G_x$$\n完整的六个方程组以类似方式构建。得到的电导矩阵 $\\mathbf{G}$ 是对称正定的，这保证了未知电压有唯一解。\n\n### 2. 电流计算与缩放\n\n一旦线性系统求解出未知电压，我们就得到了全部九个顶部节点电压（三个固定在 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$，六个是求解得到的）。然后使用欧姆定律计算通过每个通孔 $i$ 的电流：\n$$I_{i,1\\mathrm{V}} = \\frac{V_i}{R_{\\mathrm{via},i}} = V_i G_{\\mathrm{via},i}$$\n在 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$ 时流入阵列的总电流是所有通孔电流之和：\n$$I_{\\mathrm{tot},1\\mathrm{V}} = \\sum_{i=1}^9 I_{i,1\\mathrm{V}}$$\n由于网络是线性的，电流与施加的电压成比例缩放。为达到每个测试用例中指定的目标总电流 $I_{\\mathrm{tot}}$，我们找到一个缩放因子 $s$：\n$$s = \\frac{I_{\\mathrm{tot}}}{I_{\\mathrm{tot},1\\mathrm{V}}}$$\n那么，通过每个通孔的最终物理电流为：\n$$I_i = s \\cdot I_{i,1\\mathrm{V}}$$\n\n### 3. 电迁移改善因子\n\n由电迁移引起的平均失效时间 (MTTF) 由Black方程给出：$\\mathrm{MTTF}=\\mathcal{A}\\, J^{-n}\\exp(E_{\\mathrm{a}}/k_{\\mathrm{B}}T)$。由于假设温度 $T$、活化能 $E_{\\mathrm{a}}$、通孔横截面积和材料属性是恒定的，MTTF 与电流的 $n$ 次方成反比：$\\mathrm{MTTF} \\propto I^{-n}$。\n\n问题假设每个通孔的失效时间服从指数分布，因此通孔 $i$ 的失效率为 $\\lambda_i = 1/\\mathrm{MTTF}_i$。因此，$\\lambda_i \\propto I_i^n$。对于最弱环节模型，系统在第一个通孔失效时失效。总的系统失效率是各个失效率之和：$\\lambda_{\\mathrm{sys}} = \\sum_{i=1}^9 \\lambda_i$。系统的平均首次失效时间是 $\\mathrm{MTTF}_{\\mathrm{sys}} = 1/\\lambda_{\\mathrm{sys}}$。\n\n因此，$\\mathrm{MTTF}_{\\mathrm{sys}} \\propto \\left(\\sum_{i=1}^9 I_i^n\\right)^{-1}$。\n\n对于参考情况，单个通孔承载全部电流 $I_{\\mathrm{tot}}$。其 MTTF 为 $\\mathrm{MTTF}_{\\mathrm{single}} \\propto (I_{\\mathrm{tot}})^{-n}$。\n\n改善因子 (IF) 是系统 MTTF 与单个通孔 MTTF 之比：\n$$\\mathrm{IF} = \\frac{\\mathrm{MTTF}_{\\mathrm{sys}}}{\\mathrm{MTTF}_{\\mathrm{single}}} = \\frac{k\\left(\\sum_{i=1}^9 I_i^n\\right)^{-1}}{k\\left(I_{\\mathrm{tot}}\\right)^{-n}} = \\frac{I_{\\mathrm{tot}}^n}{\\sum_{i=1}^9 I_i^n}$$\n其中 $k$ 是比例常数。\n代入 $I_i = s \\cdot I_{i,1\\mathrm{V}}$ 和 $I_{\\mathrm{tot}} = s \\cdot I_{\\mathrm{tot},1\\mathrm{V}}$ 得到：\n$$\\mathrm{IF} = \\frac{(s \\cdot I_{\\mathrm{tot},1\\mathrm{V}})^n}{\\sum_{i=1}^9 (s \\cdot I_{i,1\\mathrm{V}})^n} = \\frac{s^n (I_{\\mathrm{tot},1\\mathrm{V}})^n}{s^n \\sum_{i=1}^9 (I_{i,1\\mathrm{V}})^n} = \\frac{\\left(\\sum_{i=1}^9 I_{i,1\\mathrm{V}}\\right)^n}{\\sum_{i=1}^9 (I_{i,1\\mathrm{V}})^n}$$\n这个重要的结果表明，改善因子仅取决于电流的相对分布（在 $V_{\\mathrm{app}}=1\\,\\mathrm{V}$ 时确定）和电流指数 $n$，而与总电流 $I_{\\mathrm{tot}}$ 无关。\n\n### 4. 实现算法\n\n对于每个测试用例：\n1.  计算顶层的水平 ($G_x$) 和垂直 ($G_y$) 电导以及九个通孔电导 ($G_{\\mathrm{via},i}$)。\n2.  为未知节点构建 $6\\times 6$ 的电导矩阵 $\\mathbf{G}$ 和 $6\\times 1$ 的电流源向量 $\\mathbf{I}_{\\mathrm{src}}$。\n3.  求解线性系统 $\\mathbf{G} \\mathbf{V}_{\\mathrm{unk}} = \\mathbf{I}_{\\mathrm{src}}$ 以找到未知节点的电位。\n4.  组装包含九个节点电位的完整向量，包括三个固定在 $1\\,\\mathrm{V}$ 的节点。\n5.  计算初始通孔电流 $I_{i,1\\mathrm{V}}$，其中 $i=1, \\dots, 9$。\n6.  使用上面推导的公式计算改善因子 (IF)。\n7.  计算缩放因子 $s = I_{\\mathrm{tot}} / \\sum I_{i,1\\mathrm{V}}$ 并计算最终的物理电流 $I_i=s \\cdot I_{i,1\\mathrm{V}}$。\n8.  将 IF 和最终电流列表格式化为六位小数，并附加到结果中。\n\n为提供的三个测试用例中的每一个实施此过程。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and solves the resistive network for a 3x3 via array,\n    calculates current distribution and electromigration improvement factor.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"I_tot\": 0.01, \"R_sh_top\": 0.05,\n            \"L_x\": 2.0e-7, \"L_y\": 2.0e-7,\n            \"W_x\": 3.0e-7, \"W_y\": 3.0e-7,\n            \"n\": 1.10,\n            \"R_via\": [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01]\n        },\n        {\n            \"I_tot\": 0.02, \"R_sh_top\": 0.08,\n            \"L_x\": 2.0e-7, \"L_y\": 2.0e-7,\n            \"W_x\": 3.0e-7, \"W_y\": 3.0e-7,\n            \"n\": 1.10,\n            \"R_via\": [0.015, 0.012, 0.015, 0.012, 0.020, 0.012, 0.015, 0.012, 0.015]\n        },\n        {\n            \"I_tot\": 0.005, \"R_sh_top\": 0.05,\n            \"L_x\": 2.0e-7, \"L_y\": 2.0e-7,\n            \"W_x\": 2.0e-7, \"W_y\": 2.5e-7,\n            \"n\": 1.10,\n            \"R_via\": [1e9, 0.010, 0.010, 0.010, 0.010, 0.010, 0.010, 0.010, 0.010]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        I_tot = case[\"I_tot\"]\n        R_sh_top = case[\"R_sh_top\"]\n        L_x, L_y = case[\"L_x\"], case[\"L_y\"]\n        W_x, W_y = case[\"W_x\"], case[\"W_y\"]\n        n = case[\"n\"]\n        R_via = np.array(case[\"R_via\"])\n\n        # 1. Calculate conductances\n        G_x = (1.0 / R_sh_top) * (W_x / L_x) if R_sh_top > 0 and L_x > 0 else 0\n        G_y = (1.0 / R_sh_top) * (W_y / L_y) if R_sh_top > 0 and L_y > 0 else 0\n        G_via = 1.0 / R_via\n\n        V_app = 1.0\n\n        # Node indices (0-8, row major)\n        # Fixed voltage nodes (left column): 0, 3, 6\n        # Unknown voltage nodes: 1, 2, 4, 5, 7, 8\n        unknown_nodes = [1, 2, 4, 5, 7, 8]\n        # Map from node index to matrix index for the 6x6 system\n        unknown_map = {node_idx: i for i, node_idx in enumerate(unknown_nodes)}\n\n        # 2. Build the 6x6 conductance matrix G and current vector I_src\n        G_matrix = np.zeros((6, 6))\n        I_src_vector = np.zeros(6)\n\n        for i, node_idx in enumerate(unknown_nodes):\n            r, c = divmod(node_idx, 3)\n            \n            # Diagonal element: sum of all conductances connected to the node\n            diagonal_sum = G_via[node_idx]\n            \n            # Neighbors: up, down, left, right\n            neighbors = [\n                (r - 1, c, G_y), (r + 1, c, G_y), \n                (r, c - 1, G_x), (r, c + 1, G_x)\n            ]\n\n            for nr, nc, G_link in neighbors:\n                if 0 <= nr < 3 and 0 <= nc < 3:\n                    diagonal_sum += G_link\n                    neighbor_idx = nr * 3 + nc\n                    if neighbor_idx in unknown_map: # Off-diagonal element\n                        j = unknown_map[neighbor_idx]\n                        G_matrix[i, j] = -G_link\n                    else: # Contribution to source vector from fixed voltage node\n                        I_src_vector[i] += G_link * V_app\n            \n            G_matrix[i, i] = diagonal_sum\n\n        # 3. Solve the linear system\n        V_unknown = np.linalg.solve(G_matrix, I_src_vector)\n\n        # 4. Assemble full voltage vector\n        V_full = np.zeros(9)\n        V_full[0] = V_full[3] = V_full[6] = V_app\n        for i, node_idx in enumerate(unknown_nodes):\n            V_full[node_idx] = V_unknown[i]\n\n        # 5. Calculate initial via currents (for V_app=1)\n        I_initial = V_full * G_via\n        \n        # 6. Calculate Improvement Factor (IF)\n        I_total_initial = np.sum(I_initial)\n        sum_I_pow_n = np.sum(I_initial**n)\n        \n        # Handle case where all currents are zero to avoid 0/0\n        if I_total_initial == 0.0:\n            IF = 1.0 # No current, no failure, IF is neutral.\n        else:\n            IF = (I_total_initial**n) / sum_I_pow_n\n\n        # 7. Calculate final physical currents\n        scaling_factor = I_tot / I_total_initial if I_total_initial != 0 else 0\n        I_final = I_initial * scaling_factor\n\n        # 8. Format results\n        rounded_IF = round(IF, 6)\n        rounded_currents = [round(c, 6) for c in I_final]\n        all_results.append([rounded_IF, rounded_currents])\n\n    # Final print statement in the exact required format (JSON-like, no spaces)\n    result_strings = []\n    for res in all_results:\n        if_val, currents_list = res\n        currents_str = f\"[{','.join(f'{c:.6f}' for c in currents_list)}]\"\n        result_strings.append(f\"[{if_val:.6f},{currents_str}]\")\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}