{
    "hands_on_practices": [
        {
            "introduction": "设计规则检查 (DRC) 不仅仅是验证电路的连接性和间距，它在确保可制造性方面也起着至关重要的作用。一个典型的例子是控制金属图案密度，这对于化学机械平坦化 (CMP) 工艺的成功至关重要。本练习将通过一个具体案例，让您亲手实践 DRC 工具中用于计算局部金属密度的核心几何运算，从而加深对版图验证与制造工艺之间联系的理解 。",
            "id": "4265028",
            "problem": "一个电子设计自动化 (EDA) 物理验证流程包括用于化学机械平坦化 (CMP) 的图形密度窗口的设计规则检查 (DRC)。考虑第二层金属层 ($\\mathrm{M}2$) 的一个 CMP 密度窗口，该窗口定义为角点在 $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ 和 $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$ 的方形区域。在此窗口内，三个不相交的绘制金属矩形可能部分位于窗口内部或外部，并且同一层上矩形之间的重叠区域必须只计算一次（即，使用窗口内金属覆盖的几何并集）。这三个矩形是：\n- 矩形 $\\mathrm{P}1$：左下角位于 $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$，右上角位于 $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$。\n- 矩形 $\\mathrm{P}2$：左下角位于 $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$，右上角位于 $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$。\n- 矩形 $\\mathrm{P}3$：左下角位于 $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$，右上角位于 $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$。\n\n使用窗口中局部金属图形密度的物理定义，即窗口中被测试层金属覆盖的面积分数，计算这个 $100\\,\\mu\\mathrm{m} \\times 100\\,\\mu\\mathrm{m}$ 窗口中的局部 $\\mathrm{M}2$ 金属密度。在合规性评估中，可接受的局部密度的目标范围是 $0.30$–$0.70$。将最终密度值表示为无单位的小数，并将您的答案四舍五入到四位有效数字。",
            "solution": "对所述问题进行验证。\n\n**步骤1：提取已知条件**\n- **分析窗口 ($W$)：** 一个角点在 $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ 和 $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$ 的方形区域。\n- **矩形 P1 ($P_1$)：** 左下角位于 $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$，右上角位于 $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$。\n- **矩形 P2 ($P_2$)：** 左下角位于 $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$，右上角位于 $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$。\n- **矩形 P3 ($P_3$)：** 左下角位于 $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$，右上角位于 $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$。\n- **重叠规则：** “同一层上矩形之间的重叠区域必须只计算一次（即，使用窗口内金属覆盖的几何并集）。”\n- **密度定义 ($\\rho$)：** 局部金属图形密度是窗口中被金属覆盖的面积分数，$\\rho = \\frac{A_{\\text{metal}}}{A_{\\text{window}}}$。\n- **输出要求：** 最终密度值必须是无单位小数，并四舍五入到四位有效数字。\n- **问题陈述异常：** 问题将矩形描述为“不相交的”，这意味着它们没有重叠。然而，对所提供坐标的简单检查表明，矩形$P_1$和矩形$P_2$实际上是重叠的。这是问题描述中的一个事实不一致之处。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在集成电路物理验证领域具有科学依据。它是客观的，并为唯一解提供了足够的数据。注意到了关于术语“不相交的”的异常；然而，问题提供了一个明确且主导的指令：“使用窗口内金属覆盖的几何并集。”在EDA实践中，该指令优先于任何描述性术语。因此，该问题是适定的，因为处理重叠的方法已明确定义。该计算是计算几何学的标准应用。\n\n**步骤3：结论与行动**\n该问题被判定为**有效**。识别到微小的不一致性，但已通过其他明确指令解决。将提供完整的解法。\n\n**解法推导**\n\n局部金属图形密度 $\\rho$ 定义为分析窗口内的总金属面积 $A_{\\text{metal-in-window}}$ 与窗口总面积 $A_{\\text{window}}$ 的比值。\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} $$\n\n首先，我们计算分析窗口 $W$ 的面积。窗口是由区间 $W = [0, 100] \\times [0, 100]$ 的笛卡尔积定义的方形区域，单位为 $\\mu\\mathrm{m}$。\n$$ A_{\\text{window}} = (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) \\times (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) = 10000\\,\\mu\\mathrm{m}^2 $$\n\n接下来，我们必须确定此窗口内的总金属面积 $A_{\\text{metal-in-window}}$。该面积是三个矩形（$P_1$、$P_2$、$P_3$）的几何并集，并被裁剪到窗口 $W$ 的边界内。令 $P'_i = P_i \\cap W$ 表示每个矩形 $P_i$ 位于窗口内的部分。我们需要计算这些裁剪后矩形的并集面积：$A(P'_1 \\cup P'_2 \\cup P'_3)$。\n\n三个矩形给出如下：\n- $P_1 = [-20, 60] \\times [10, 50]$\n- $P_2 = [40, 120] \\times [30, 80]$\n- $P_3 = [70, 95] \\times [60, 110]$\n\n一个通用矩形 $[x_{\\min}, x_{\\max}] \\times [y_{\\min}, y_{\\max}]$ 与窗口 $W = [0, 100] \\times [0, 100]$ 的交集产生一个新的矩形 $[\\max(x_{\\min}, 0), \\min(x_{\\max}, 100)] \\times [\\max(y_{\\min}, 0), \\min(y_{\\max}, 100)]$。\n\n裁剪后的矩形 $P'_i$ 是：\n- $P'_1 = [\\max(-20, 0), \\min(60, 100)] \\times [\\max(10, 0), \\min(50, 100)] = [0, 60] \\times [10, 50]$\n- $P'_2 = [\\max(40, 0), \\min(120, 100)] \\times [\\max(30, 0), \\min(80, 100)] = [40, 100] \\times [30, 80]$\n- $P'_3 = [\\max(70, 0), \\min(95, 100)] \\times [\\max(60, 0), \\min(110, 100)] = [70, 95] \\times [60, 100]$\n\n这些裁剪后矩形的各自面积是：\n- $A(P'_1) = (60 - 0) \\times (50 - 10) = 60 \\times 40 = 2400\\,\\mu\\mathrm{m}^2$\n- $A(P'_2) = (100 - 40) \\times (80 - 30) = 60 \\times 50 = 3000\\,\\mu\\mathrm{m}^2$\n- $A(P'_3) = (95 - 70) \\times (100 - 60) = 25 \\times 40 = 1000\\,\\mu\\mathrm{m}^2$\n\n为了求并集面积，我们使用三个集合的容斥原理：\n$$ A(P'_1 \\cup P'_2 \\cup P'_3) = A(P'_1) + A(P'_2) + A(P'_3) - A(P'_1 \\cap P'_2) - A(P'_1 \\cap P'_3) - A(P'_2 \\cap P'_3) + A(P'_1 \\cap P'_2 \\cap P'_3) $$\n\n我们现在计算裁剪后矩形成对交集的面积：\n- 交集 $P'_1 \\cap P'_2$：\n  - $x$-区间: $[\\max(0, 40), \\min(60, 100)] = [40, 60]$\n  - $y$-区间: $[\\max(10, 30), \\min(50, 80)] = [30, 50]$\n  - 面积: $A(P'_1 \\cap P'_2) = (60 - 40) \\times (50 - 30) = 20 \\times 20 = 400\\,\\mu\\mathrm{m}^2$\n\n- 交集 $P'_1 \\cap P'_3$：\n  - $x$-区间: $[\\max(0, 70), \\min(60, 95)] = [70, 60]$。由于下界大于上界，交集为空集。\n  - 面积: $A(P'_1 \\cap P'_3) = 0\\,\\mu\\mathrm{m}^2$\n\n- 交集 $P'_2 \\cap P'_3$：\n  - $x$-区间: $[\\max(40, 70), \\min(100, 95)] = [70, 95]$\n  - $y$-区间: $[\\max(30, 60), \\min(80, 100)] = [60, 80]$\n  - 面积: $A(P'_2 \\cap P'_3) = (95 - 70) \\times (80 - 60) = 25 \\times 20 = 500\\,\\mu\\mathrm{m}^2$\n\n最后，我们计算三重交集的面积，$A(P'_1 \\cap P'_2 \\cap P'_3)$。由于 $P'_1 \\cap P'_3$ 为空，三重交集也必定为空。\n$$ A(P'_1 \\cap P'_2 \\cap P'_3) = A((P'_1 \\cap P'_3) \\cap P'_2) = A(\\emptyset \\cap P'_2) = A(\\emptyset) = 0\\,\\mu\\mathrm{m}^2 $$\n\n现在，我们将所有面积代回容斥公式：\n$$ A_{\\text{metal-in-window}} = A(P'_1 \\cup P'_2 \\cup P'_3) = (2400 + 3000 + 1000) - (400 + 0 + 500) + 0 $$\n$$ A_{\\text{metal-in-window}} = 6400 - 900 + 0 = 5500\\,\\mu\\mathrm{m}^2 $$\n\n因此，局部金属密度 $\\rho$ 为：\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} = \\frac{5500\\,\\mu\\mathrm{m}^2}{10000\\,\\mu\\mathrm{m}^2} = 0.55 $$\n\n问题要求答案以小数形式表示，并四舍五入到四位有效数字。\n$$ \\rho = 0.5500 $$\n\n该值落在 $0.30$ 到 $0.70$ 的可接受目标范围内。",
            "answer": "$$\\boxed{0.5500}$$"
        },
        {
            "introduction": "从可制造性规则转向可靠性规则，天线效应是等离子体刻蚀工艺中一个关键的考量因素。天线比率并非一个静态属性，它的大小取决于芯片制造过程中每个特定步骤的电路连接状态。本练习旨在通过将电路网络建模为一个随制造步骤演化的图，培养一种算法思维，以理解现代 EDA 工具如何执行对工艺步骤敏感的、精确的天线规则检查 。",
            "id": "4265077",
            "problem": "您将要执行一个集成电路和电子设计自动化（EDA）领域的任务。重点是设计规则检查（DRC），特别是在等离子体刻蚀过程中的天线规则合规性。制造过程按离散步骤进行，互连的连通性仅在相关元件于其各自步骤中形成时才会出现。所计算的量是特定层的天线比，该比率量化了相对于栅极氧化层容限的等离子体诱导电荷暴露。\n\n基本陈述：\n- 刻蚀过程中等离子体诱导的电荷累积与暴露的导体表面积成正比。对于给定层，在其形成步骤中，该层所产生的电荷暴露量与该层上连接导体的面积成正比。\n- 栅极氧化层损坏的风险与相对于栅极氧化层面积的电荷密度成正比。较大的栅极氧化层面积会降低单位电荷暴露所产生的应力。\n- 在某个制造步骤中，一个网络的连通性仅包括其形成步骤小于或等于当前步骤的互连线段和通孔。如果在该步骤中，一个栅极连接到扩散节点（或等效的汇点），则存在放电路径。\n- 基于这些原则，每层的天线比是一个无量纲的量，它比较了暴露的导体面积与栅极氧化层面积，并严格在该层的刻蚀步骤进行评估。\n\n建模假设和定义：\n- 将网络表示为一个无向图。节点代表端点或连接点，边代表互连线段或通孔。每条边都有一个形成步骤，并且对于金属线段，其面积为正值。在此模型中，通孔仅用于连通性考虑，其面积为零。\n- 设工艺步骤为以下有序映射：\n  - 步骤 $1$ 进行多晶硅（Poly）图形化（表示为 $POLY$）。\n  - 步骤 $2$ 形成接触孔（表示为 $V0$），用于连接栅极或扩散区。\n  - 步骤 $3$ 进行第一层金属沉积和刻蚀（表示为 $M1$）。\n  - 步骤 $4$ 形成从 $M1$ 到 $M2$ 的通孔（表示为 $V1$）。\n  - 步骤 $5$ 进行第二层金属沉积和刻蚀（表示为 $M2$）。\n- 指定为扩散区的节点是放电汇点。指定为栅极的节点具有给定的栅极氧化层面积。\n- 对于具有多个栅极的网络，给定层的网络级天线比是在该层的步骤中，使用上述连通性计算出的所有栅极特定比率的最大值。\n\n任务：\n1. 构造一个算法，该算法对于给定的网络和对应于层 $L$ 的制造步骤，从每个栅极出发，仅使用形成步骤小于或等于层 $L$ 步骤的边来遍历连通性。如果在这些约束下，从某个栅极可以到达任何扩散节点，则该栅极在该步骤中对该层的暴露被设置为无风险。否则，将在该步骤中从该栅极可达的所有层 $L$ 的边的面积相加，并与栅极氧化层面积进行比较，以计算该栅极的特定层天线比。通过取网络中所有栅极比率的最大值，将结果汇总为网络级比率。\n2. 将该算法实现为一个完整的程序，用于评估以下测试套件。对于每个案例，使用上述工艺步骤映射返回列表 $[AR^{(M1)},AR^{(M2)}]$。\n\n测试套件规范（所有面积均为正实数；天线比无单位）：\n- 案例 $1$ (单个栅极，$M1$ 未受保护)：\n  - 节点：栅极 $G1$，栅极氧化层面积 $1.0$；连接点 $J1$、$T1$。\n  - 边：$G1 \\leftrightarrow J1$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$J1 \\leftrightarrow T1$，在 $M1$ 上，在步骤 $3$ 形成，面积 $150$。\n- 案例 $2$ (单个栅极，在 $M1$ 步骤时可到达扩散区)：\n  - 节点：栅极 $G2$，栅极氧化层面积 $0.5$；扩散节点 $D2$；连接点 $J2$、$T2$。\n  - 边：$G2 \\leftrightarrow J2$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$J2 \\leftrightarrow T2$，在 $M1$ 上，在步骤 $3$ 形成，面积 $100$；$J2 \\leftrightarrow D2$，通过 $V0$，在步骤 $2$ 形成，面积 $0$。\n- 案例 $3$ (多层，保护仅在 $V1$ 形成后才可用，保护 $M2$ 但不保护 $M1$)：\n  - 节点：栅极 $G3$，栅极氧化层面积 $2.0$；扩散节点 $D3$；连接点 $J3$、$T3$、$W31$、$W32$、$M1d$。\n  - 边：$G3 \\leftrightarrow J3$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$J3 \\leftrightarrow T3$，在 $M1$ 上，在步骤 $3$ 形成，面积 $50$；$T3 \\leftrightarrow W31$，通过 $V1$，在步骤 $4$ 形成，面积 $0$；$W31 \\leftrightarrow W32$，在 $M2$ 上，在步骤 $5$ 形成，面积 $200$；$W31 \\leftrightarrow M1d$，通过 $V1$，在步骤 $4$ 形成，面积 $0$；$M1d \\leftrightarrow D3$，通过 $V0$，在步骤 $2$ 形成，面积 $0$。\n- 案例 $4$ (两个栅极共享金属，无扩散区)：\n  - 节点：栅极 $G4a$，栅极氧化层面积 $0.4$；栅极 $G4b$，栅极氧化层面积 $2.0$；连接点 $J4$、$T4$、$W41$、$Z41$。\n  - 边：$G4a \\leftrightarrow J4$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$G4b \\leftrightarrow J4$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$J4 \\leftrightarrow T4$，在 $M1$ 上，在步骤 $3$ 形成，面积 $80$；$T4 \\leftrightarrow W41$，通过 $V1$，在步骤 $4$ 形成，面积 $0$；$W41 \\leftrightarrow Z41$，在 $M2$ 上，在步骤 $5$ 形成，面积 $120$。\n- 案例 $5$ (零暴露金属，可到达扩散区)：\n  - 节点：栅极 $G5$，栅极氧化层面积 $1.0$；扩散节点 $D5$；连接点 $J5$。\n  - 边：$G5 \\leftrightarrow J5$，通过 $V0$，在步骤 $2$ 形成，面积 $0$；$J5 \\leftrightarrow D5$，通过 $V0$，在步骤 $2$ 形成，面积 $0$。\n\n输出要求：\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的、以逗号分隔的结果列表。每个测试案例的结果是一个列表 $[AR^{(M1)},AR^{(M2)}]$，按案例顺序排列。总输出是这些列表的列表，例如 $[[a_{11},a_{12}],[a_{21},a_{22}],\\dots]$。天线比是无量纲实数，必须以十进制形式打印。",
            "solution": "问题陈述已经过分析，并被确定为有效。该问题在科学上基于半导体制造和电子设计自动化的原理，特别是关于等离子体引起的器件损伤和天线规则检查。这是一个定义明确的问题，具有清晰的算法任务、明确的定义以及为指定测试案例提供的完整输入数据集。其语言客观而精确，可以得出一个唯一且可验证的解决方案。\n\n该问题要求为一组电路网络计算特定层的天线比。对于特定导电层 $L$ 上的给定栅极，天线比 $AR$ 是评估等离子体刻蚀过程中栅极氧化层损伤风险的关键指标。它被定义为连接到该栅极的层 $L$ 上导体的总暴露面积 $A_{L, \\text{exposed}}$ 与栅极氧化层自身面积 $A_{\\text{gate}}$ 的比值。\n$$\nAR_L = \\frac{A_{L, \\text{exposed}}}{A_{\\text{gate}}}\n$$\n计算过程严重依赖于制造步骤。网络的连通性不是静态的；它随着各层的图形化而演变。在任何给定的制造步骤 $s$ 中，电气网络仅由在步骤 $s' \\le s$ 形成的组件（互连、通孔）组成。一个关键的保护机制是连接到扩散节点，它充当电荷汇点。如果在对应于层 $L$ 刻蚀的步骤中，一个栅极连接到扩散节点，电荷就可以被安全地释放，该栅极在该层上的天线比被视为 $0$。\n\n解决此问题的算法将网络建模为一个无向图 $G=(V, E)$，其中 $V$ 是节点（栅极、扩散区、连接点）的集合， $E$ 是边（金属线段、通孔）的集合。每条边 $e \\in E$ 都关联一个形成步骤 $s_e$、一个层标识 $l_e$ 和一个面积 $a_e$。通孔的 $a_e=0$。我们的任务是计算层 $M1$ 和 $M2$ 的天线比，它们分别在步骤 $s_{M1}=3$ 和 $s_{M2}=5$ 形成。\n\n计算目标层 $L$ （其形成步骤为 $s_L$）的网络级天线比的步骤如下：\n\n1.  对于网络中的每个栅极 $g$，我们确定其特定的天线比 $AR_{g,L}$。网络级比率 $AR_L^{\\text{net}}$ 是这些单个栅极比率的最大值。\n    $$\n    AR_L^{\\text{net}} = \\max_{g \\, \\in \\, \\text{gates}} (AR_{g,L})\n    $$\n\n2.  为了计算特定栅极 $g$ 的 $AR_{g,L}$，我们首先识别出子图 $G'_g(s_L)$，它表示在步骤 $s_L$ 时包含 $g$ 的电气连接组件。该子图包括从 $g$ 出发，仅通过形成步骤为 $s_e \\le s_L$ 的边 $e$ 可到达的所有节点。从 $g$ 开始的广度优先搜索（BFS）或深度优先搜索（DFS）可用于查找此组件中的所有节点，我们将其表示为 $V'_g$。\n\n3.  然后我们检查是否存在放电路径。如果 $V'_g$ 中的任何节点 $v \\in V'_g$ 是一个扩散节点，则该栅极在步骤 $s_L$ 时被视为受保护。在这种情况下，其天线比为 $AR_{g,L} = 0$。\n\n4.  如果在 $V'_g$ 中没有找到扩散节点，则该栅极处于风险之中。我们必须计算层 $L$ 金属的总暴露面积。这是连通组件 $G'_g(s_L)$ 内所有属于层 $L$ 的边的面积之和。设 $E'_g$ 是子图 $G'_g(s_L)$ 中的边集。暴露面积为：\n    $$\n    A_{L, \\text{exposed}} = \\sum_{e \\, \\in \\, E'_g, \\, l_e=L} a_e\n    $$\n    请注意，用于面积求和的边是连通组件中所有层 $L$ 的边，而不仅仅是那些从栅极出发的简单路径上的边。\n\n5.  然后使用其栅极氧化层面积 $A_{g, \\text{gate}}$ 计算特定于栅极的天线比：\n    $$\n    AR_{g,L} = \\frac{A_{L, \\text{exposed}}}{A_{g, \\text{gate}}}\n    $$\n\n对网络中的每个栅极应用此过程以找到最大比率，该比率构成了该层的最终答案。整体解决方案包括对每个测试案例应用此完整过程两次：一次是针对步骤 $s_{M1}=3$ 的层 $M1$，另一次是针对步骤 $s_{M2}=5$ 的层 $M2$。",
            "answer": "```python\nimport collections\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the antenna ratio calculation for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: single gate, unprotected M1\n        {\n            \"nodes\": {\"G1\": {\"type\": \"gate\", \"area\": 1.0}},\n            \"edges\": [\n                (\"G1\", \"J1\", \"V0\", 2, 0.0),\n                (\"J1\", \"T1\", \"M1\", 3, 150.0),\n            ]\n        },\n        # Case 2: single gate, diffusion reachable at M1 step\n        {\n            \"nodes\": {\n                \"G2\": {\"type\": \"gate\", \"area\": 0.5},\n                \"D2\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G2\", \"J2\", \"V0\", 2, 0.0),\n                (\"J2\", \"T2\", \"M1\", 3, 100.0),\n                (\"J2\", \"D2\", \"V0\", 2, 0.0),\n            ]\n        },\n        # Case 3: multi-layer, protection available after V1\n        {\n            \"nodes\": {\n                \"G3\": {\"type\": \"gate\", \"area\": 2.0},\n                \"D3\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G3\", \"J3\", \"V0\", 2, 0.0),\n                (\"J3\", \"T3\", \"M1\", 3, 50.0),\n                (\"T3\", \"W31\", \"V1\", 4, 0.0),\n                (\"W31\", \"W32\", \"M2\", 5, 200.0),\n                (\"W31\", \"M1d\", \"V1\", 4, 0.0),\n                (\"M1d\", \"D3\", \"V0\", 2, 0.0),\n            ]\n        },\n        # Case 4: two gates sharing metal, no diffusion\n        {\n            \"nodes\": {\n                \"G4a\": {\"type\": \"gate\", \"area\": 0.4},\n                \"G4b\": {\"type\": \"gate\", \"area\": 2.0}\n            },\n            \"edges\": [\n                (\"G4a\", \"J4\", \"V0\", 2, 0.0),\n                (\"G4b\", \"J4\", \"V0\", 2, 0.0),\n                (\"J4\", \"T4\", \"M1\", 3, 80.0),\n                (\"T4\", \"W41\", \"V1\", 4, 0.0),\n                (\"W41\", \"Z41\", \"M2\", 5, 120.0),\n            ]\n        },\n        # Case 5: zero exposed metal, diffusion reachable\n        {\n            \"nodes\": {\n                \"G5\": {\"type\": \"gate\", \"area\": 1.0},\n                \"D5\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G5\", \"J5\", \"V0\", 2, 0.0),\n                (\"J5\", \"D5\", \"V0\", 2, 0.0),\n            ]\n        },\n    ]\n\n    layer_steps = {'M1': 3, 'M2': 5}\n    results = []\n\n    for case in test_cases:\n        adj = collections.defaultdict(list)\n        all_nodes = set()\n        for u, v, layer, step, area in case[\"edges\"]:\n            adj[u].append((v, layer, step, area))\n            adj[v].append((u, layer, step, area))\n            all_nodes.add(u)\n            all_nodes.add(v)\n\n        gates = {name: props for name, props in case[\"nodes\"].items() if props[\"type\"] == \"gate\"}\n        diffusions = {name for name, props in case[\"nodes\"].items() if props[\"type\"] == \"diffusion\"}\n        \n        case_results = []\n        for target_layer, current_step in layer_steps.items():\n            net_ratio = calculate_net_ratio(adj, gates, diffusions, current_step, target_layer)\n            case_results.append(net_ratio)\n        \n        results.append(case_results)\n\n    # The expected output format from the problem description, e.g., [[150.0, 0.0], [0.0, 0.0], ...]\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_net_ratio(adj, gates, diffusions, current_step, target_layer):\n    \"\"\"\n    Calculates the net-level antenna ratio for a given layer.\n    This is the maximum ratio over all gates in the net.\n    \"\"\"\n    if not gates:\n        return 0.0\n\n    max_ratio = 0.0\n    \n    # Memoization to avoid recomputing for gates in the same connected component\n    visited_gates = set()\n\n    for gate_name, gate_props in gates.items():\n        if gate_name in visited_gates:\n            continue\n            \n        # 1. Find the connected component for the current gate at this process step\n        component_nodes = set()\n        queue = collections.deque([gate_name])\n        visited_bfs = {gate_name}\n        \n        while queue:\n            u = queue.popleft()\n            component_nodes.add(u)\n            for v, _, step, _ in adj[u]:\n                if step = current_step and v not in visited_bfs:\n                    visited_bfs.add(v)\n                    queue.append(v)\n        \n        # Mark all gates in this component as visited\n        component_gates = {node for node in component_nodes if node in gates}\n        for g in component_gates:\n            visited_gates.add(g)\n        \n        # 2. Check if the component is protected by a diffusion node\n        is_protected = any(node in diffusions for node in component_nodes)\n        \n        if is_protected:\n            # All gates in this component have a ratio of 0 for this step\n            continue\n        \n        # 3. If not protected, calculate the exposed area for the target layer\n        total_exposed_area = 0.0\n        visited_edges = set()\n        for u in component_nodes:\n            for v, layer, step, area in adj[u]:\n                if v in component_nodes and step = current_step:\n                    # Edge must be part of the component at this step.\n                    # Ensure each edge is counted once.\n                    edge_id = tuple(sorted((u, v, layer, step)))\n                    if edge_id not in visited_edges:\n                        visited_edges.add(edge_id)\n                        if layer == target_layer:\n                            total_exposed_area += area\n                            \n        # 4. Calculate ratio for each gate in this component and find the max\n        for node in component_gates:\n            gate_area = gates[node]['area']\n            if gate_area > 0:\n                gate_ratio = total_exposed_area / gate_area\n                if gate_ratio > max_ratio:\n                    max_ratio = gate_ratio\n    \n    return max_ratio\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了如何计算天线比率后，下一步是学习如何智能地处理和修复违例。简单地标记所有违例是不够的，先进的 DRC 流程必须能够识别有效的修复策略，以避免不必要的设计修改。本练习将探讨一种常见的天线效应缓解技术——使用保护二极管，并挑战您从物理原理出发，构建一个条件性规则模型，该模型能够智能地评估保护二极管的存在及其有效性 。",
            "id": "4265055",
            "problem": "考虑一个集成电路电子设计自动化（EDA）中的高级物理验证场景。其目标是构建一个基于数学的设计规则检查（DRC）天线效应合规性规则，当存在网内二极管时，通过建模一个用于缩放天线比的有效放电因子，有条件地放宽天线比（AR）。\n\n从以下基本原理开始：\n\n- 天线比定义为 $AR = \\frac{A_m}{A_g}$，其中 $A_m$ 是在蚀刻步骤中连接到栅极的总暴露导体面积，$A_g$ 是栅极面积。$A_m$ 和 $A_g$ 都必须以 $\\mu \\mathrm{m}^2$ 为单位表示。\n- 蚀刻过程中的等离子体感应充电会注入与导体面积成正比的电流。设注入电流密度为 $\\rho$，单位为 $\\mathrm{A}/\\mu \\mathrm{m}^2$。注入电流为 $I_{\\mathrm{in}} = \\rho A_m$。\n- 如果存在网内二极管，它会在蚀刻期间对节点进行放电，大致提供一个与其面积成正比的放电电流。设二极管面积为 $A_d$，单位为 $\\mu \\mathrm{m}^2$，在相关偏压下的二极管电流密度为 $J_s$，单位为 $\\mathrm{A}/\\mu \\mathrm{m}^2$。从二极管到天线节点的路径电阻为 $R_p$，单位为 $\\Omega$，二极管表现出一个特征串联电阻参数 $R_s$，单位为 $\\Omega$。您必须使用一个随 $R_p$ 增大而减小的无量纲因子，为由 $R_p$ 引起的放电电流建立衰减因子模型。\n- 工艺天线规则指定了最大允许比率 $AR_{\\max}$（无量纲）。合规性要求有效天线比 $AR_{\\mathrm{eff}}$ 不超过 $AR_{\\max}$。\n\n构建一个规则，通过一个有效放电因子 $\\gamma \\in [0,1]$ 来缩放 $AR$ 以确定 $AR_{\\mathrm{eff}}$，该因子模拟了在二极管辅助放电后节点上残留的等离子体注入电荷的比例。该规则必须满足以下标准：\n- 如果没有二极管，则节点得不到放电辅助，规则必须简化为 $AR_{\\mathrm{eff}} = AR$。\n- 如果存在二极管，放电辅助必须随着 $A_d$ 的增加和 $R_p$ 的减小而单调地减小 $AR_{\\mathrm{eff}}$。\n- 放电因子的构建必须基于给定的基本原理，并且在量纲上保持一致。为通过二极管放电建模的衰减因子必须是 $R_p$ 和 $R_s$ 的无量纲函数，当 $R_p \\rightarrow 0$ 时趋近于 $1$，当 $R_p \\rightarrow \\infty$ 时趋近于 $0$。\n\n您的任务是实现一个程序，对每个测试用例，确定其净有效天线比是否满足 $AR_{\\mathrm{eff}} \\le AR_{\\max}$。所有输入必须使用指定的单位：\n- 面积 $A_m$、$A_g$ 和 $A_d$ 必须以 $\\mu \\mathrm{m}^2$ 为单位。\n- 电阻 $R_p$ 和 $R_s$ 必须以 $\\Omega$ 为单位。\n- 电流密度 $\\rho$ 和 $J_s$ 必须以 $\\mathrm{A}/\\mu \\mathrm{m}^2$ 为单位。\n\n在您的计算中使用以下固定的工艺参数：\n- $AR_{\\max} = 300$。\n- $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$。\n- $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$。\n- $R_s = 100 \\, \\Omega$。\n\n用于覆盖多个方面的参数值测试集：\n- 案例 $1$（无二极管的边界情况）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$。\n- 案例 $2$（无二极管时失败）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$。\n- 案例 $3$（中等大小二极管和中等路径电阻下的部分放宽）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$。\n- 案例 $4$（大尺寸二极管和中等路径电阻下的强放宽）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$。\n- 案例 $5$（金属面积为零的边缘情况）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$。\n- 案例 $6$（存在二极管但因极大路径电阻而实际断开）：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\ldots]$），其中每个 $\\text{result}_i$ 是一个布尔值，表示相应测试用例的合规性，$\\text{True}$ 表示 $AR_{\\mathrm{eff}} \\le AR_{\\max}$，否则为 $\\text{False}$。不允许有其他输出。",
            "solution": "用户想要解决一个问题陈述。\n\n### 步骤1：提取已知条件\n- **天线比定义**：$AR = \\frac{A_m}{A_g}$，其中 $A_m$ 是暴露的导体面积（$\\mu \\mathrm{m}^2$），$A_g$ 是栅极面积（$\\mu \\mathrm{m}^2$）。\n- **注入电流**：$I_{\\mathrm{in}} = \\rho A_m$，其中 $\\rho$ 是注入电流密度（$\\mathrm{A}/\\mu \\mathrm{m}^2$）。\n- **二极管放电**：一个面积为 $A_d$（$\\mu \\mathrm{m}^2$）的网内二极管提供放电电流。二极管电流密度为 $J_s$（$\\mathrm{A}/\\mu \\mathrm{m}^2$）。路径电阻为 $R_p$（$\\Omega$），二极管的串联电阻参数为 $R_s$（$\\Omega$）。必须根据 $R_p$ 和 $R_s$ 建立一个衰减因子模型。\n- **合规性规则**：有效天线比 $AR_{\\mathrm{eff}}$ 不得超过最大允许比 $AR_{\\max}$。$AR_{\\mathrm{eff}} \\le AR_{\\max}$。\n- **有效放电因子**：$AR_{\\mathrm{eff}}$ 是通过一个因子 $\\gamma \\in [0,1]$ 缩放 $AR$ 得到的，该因子模拟了残留电荷的比例。\n- **模型标准**：\n    1. 如果没有二极管，$AR_{\\mathrm{eff}} = AR$。\n    2. 如果存在二极管，$AR_{\\mathrm{eff}}$ 必须随着 $A_d$ 的增加和 $R_p$ 的减小而单调减小。\n    3. 放电的衰减因子必须是 $R_p$ 和 $R_s$ 的无量纲函数，当 $R_p \\rightarrow 0$ 时趋近于 $1$，当 $R_p \\rightarrow \\infty$ 时趋近于 $0$。\n- **固定工艺参数**：\n    - $AR_{\\max} = 300$\n    - $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $R_s = 100 \\, \\Omega$\n- **测试套件**：\n    - 案例 $1$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\n    - 案例 $2$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\n    - 案例 $3$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\n    - 案例 $4$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\n    - 案例 $5$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\n    - 案例 $6$：$(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上植根于半导体制造中等离子体感应充电的原理，这是一个众所周知的可靠性问题。其公式基于面积、电流密度和电阻等物理量。该问题是适定的，提供了明确的目标（确定一组测试用例的合规性）、充足的数据以及构建所需数学模型的约束条件。语言客观而精确。该问题要求从第一性原理和给定约束推导模型，这是物理学和工程学中的标准任务。构建过程并非欠定，因为对单调性和边界条件的约束指导了物理上合理的模型的选择。该问题未违反任何无效性标准。\n\n### 步骤3：结论与行动\n该问题有效。将制定一个合理的解决方案。\n\n### 解决方案推导\n问题的核心是为有效天线比 $AR_{\\mathrm{eff}}$ 构建一个模型。标准的天线规则 $AR = \\frac{A_m}{A_g} \\le AR_{\\max}$ 是限制栅极氧化层应力的一种代理方法。这种应力是由等离子体注入电流 $I_{\\mathrm{in}}$ 流入栅极所产生的电压引起的。二极管提供了一条放电此电流的替代路径。\n\n首先，我们定义基本天线比：\n$$AR = \\frac{A_m}{A_g}$$\n如果没有二极管，问题陈述指出 $AR_{\\mathrm{eff}} = AR$。\n\n如果存在二极管，它会提供放电电流。二极管本身可提供的最大放电电流与其面积成正比，$I_{d} = J_s A_d$。然而，该电流必须流过二极管的串联电阻 $R_s$ 和路径电阻 $R_p$。放电路径中的总电阻为 $R_{\\mathrm{path\\_total}} = R_s + R_p$。\n\n我们必须构建一个无量纲衰减因子 $f_{\\mathrm{att}}$，用于模拟由于 $R_p$ 导致的放电效率降低。该因子必须是 $R_s$ 和 $R_p$ 的函数，当 $R_p \\rightarrow 0$ 时趋近于 $1$，当 $R_p \\rightarrow \\infty$ 时趋近于 $0$。一个类似于电阻分压器的物理直观模型是合适的。放电“电势”受限于总路径电阻相对于二极管固有电阻的大小。一个满足给定约束的合适函数是：\n$$f_{\\mathrm{att}}(R_p, R_s) = \\frac{R_s}{R_s + R_p}$$\n此函数是无量纲的，当 $R_p=0$ 时等于 $1$，当 $R_p \\rightarrow \\infty$ 时趋近于 $0$。\n\n有效放电电流 $I_{\\mathrm{discharge\\_eff}}$ 是理想二极管电流经此因子衰减后的值：\n$$I_{\\mathrm{discharge\\_eff}} = I_d \\cdot f_{\\mathrm{att}} = J_s A_d \\frac{R_s}{R_s + R_p}$$\n给栅极充电的净电流是注入电流与有效放电电流之差。物理上，放电电流不能超过注入电流，因此净电流不能为负。\n$$I_{\\mathrm{net}} = \\max(0, I_{\\mathrm{in}} - I_{\\mathrm{discharge\\_eff}}) = \\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)$$\n天线规则是栅极应力的代理，而应力与流入栅极的电流密度 $I_{\\mathrm{net}} / A_g$ 相关。我们定义 $AR_{\\mathrm{eff}}$ 以保持与原始规则相似的结构，其中应力与比率成正比。\n$$\\text{应力} \\propto \\frac{I_{\\mathrm{net}}}{A_g}$$\n我们希望 $\\rho \\cdot AR_{\\mathrm{eff}}$ 代表这个新的应力水平。\n$$\\rho \\cdot AR_{\\mathrm{eff}} = \\frac{I_{\\mathrm{net}}}{A_g} = \\frac{\\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)}{A_g}$$\n两边同除以 $\\rho$ 并在 $\\max$ 函数内分配：\n$$AR_{\\mathrm{eff}} = \\max\\left(0, \\frac{\\rho A_m}{\\rho A_g} - \\frac{J_s A_d}{\\rho A_g} \\frac{R_s}{R_s + R_p}\\right)$$\n代入 $AR = A_m / A_g$，我们推导出 $AR_{\\mathrm{eff}}$ 的最终表达式：\n$$AR_{\\mathrm{eff}} = \\max\\left(0, AR - \\frac{J_s A_d R_s}{\\rho A_g (R_s + R_p)}\\right)$$\n此模型满足所有标准。如果没有二极管（以 $A_d=0$ 建模），减法项为零，得到 $AR_{\\mathrm{eff}} = \\max(0, AR) = AR$（因为面积非负）。$AR_{\\mathrm{eff}}$ 随着 $A_d$ 的增加和 $R_p$ 的减小而单调减小。从 $AR$ 中减去的项是无量纲的，确保了量纲一致性。\n\n### 应用于测试用例\n我们使用推导出的公式和给定参数：$AR_{\\max} = 300$，$\\rho = 1.0 \\times 10^{-9}$，$J_s = 2.0 \\times 10^{-6}$，以及 $R_s = 100$。\n\n**案例 1**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\n无二极管。$AR_{\\mathrm{eff}} = AR = \\frac{60000}{200} = 300$。\n合规性：$300 \\le 300 \\Rightarrow \\text{True}$。\n\n**案例 2**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\n无二极管。$AR_{\\mathrm{eff}} = AR = \\frac{90000}{200} = 450$。\n合规性：$450 \\le 300 \\Rightarrow \\text{False}$。\n\n**案例 3**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\n存在二极管。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(50)(100)}{(1.0 \\times 10^{-9})(200)(100 + 50)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{ (2.0 \\times 10^{-7})(150) }\\right) = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{3.0 \\times 10^{-5}}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - 333.33...\\right) = 116.66...$\n合规性：$116.66... \\le 300 \\Rightarrow \\text{True}$。\n\n**案例 4**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\n存在二极管。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(300)(100)}{(1.0 \\times 10^{-9})(200)(100 + 400)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(500)}\\right) = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{1.0 \\times 10^{-4}}\\right)$\n$AR_{\\mathrm{eff}} = \\max(0, 450 - 600) = \\max(0, -150) = 0$。\n合规性：$0 \\le 300 \\Rightarrow \\text{True}$。\n\n**案例 5**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\n无二极管。$A_m = 0$，所以 $AR = 0$。\n$AR_{\\mathrm{eff}} = AR = 0$。\n合规性：$0 \\le 300 \\Rightarrow \\text{True}$。\n\n**案例 6**：$(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\n存在二极管，但路径电阻极大。$AR = 450$。\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(100)(100)}{(1.0 \\times 10^{-9})(200)(100 + 10^9)}\\right)$\n项 $(100 + 10^9) \\approx 10^9$。\n$AR_{\\mathrm{eff}} \\approx \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(10^9)}\\right) = \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{2.0 \\times 10^2}\\right)$\n$AR_{\\mathrm{eff}} \\approx \\max(0, 450 - 1.0 \\times 10^{-4}) = 449.9999$。\n合规性：$449.9999 \\le 300 \\Rightarrow \\text{False}$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DRC antenna compliance problem for a suite of test cases.\n    \"\"\"\n\n    # Define the fixed technology parameters from the problem statement.\n    AR_max = 300.0\n    rho = 1.0e-9  # A/um^2\n    J_s = 2.0e-6  # A/um^2\n    R_s = 100.0   # Ohm\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Am, Ag, diode_present, Ad, Rp)\n    test_cases = [\n        (60000.0, 200.0, False, 0.0, 0.0),    # Case 1\n        (90000.0, 200.0, False, 0.0, 0.0),    # Case 2\n        (90000.0, 200.0, True, 50.0, 50.0),     # Case 3\n        (90000.0, 200.0, True, 300.0, 400.0),   # Case 4\n        (0.0, 200.0, False, 0.0, 0.0),        # Case 5\n        (90000.0, 200.0, True, 100.0, 1.0e9)  # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        Am, Ag, diode_present, Ad, Rp = case\n\n        # Ensure gate area is non-zero to avoid division by zero.\n        # Physical devices will have Ag > 0.\n        if Ag == 0:\n            # An infinitely large AR, always fails unless Am is also 0.\n            is_compliant = (Am == 0)\n            results.append(is_compliant)\n            continue\n\n        # Calculate the base Antenna Ratio (AR)\n        AR = Am / Ag\n\n        AR_eff = 0.0\n        if not diode_present:\n            # Rule 1: If no diode, AR_eff is just AR.\n            AR_eff = AR\n        else:\n            # Diode is present, calculate the effective AR with relaxation.\n\n            # The subtractive term represents the relaxation effect of the diode.\n            # Its formulation is derived in the solution description.\n            # Numerator of the reduction term\n            reduction_num = J_s * Ad * R_s\n            \n            # Denominator of the reduction term\n            reduction_den = rho * Ag * (R_s + Rp)\n\n            reduction_term = 0.0\n            if reduction_den > 0:\n                reduction_term = reduction_num / reduction_den\n            \n            # AR_eff is the base AR minus the relaxation, clamped at 0.\n            AR_eff = np.maximum(0.0, AR - reduction_term)\n\n        # Check for compliance against the maximum allowed antenna ratio.\n        is_compliant = (AR_eff = AR_max)\n        results.append(is_compliant)\n\n    # Format the final output as a comma-separated list of booleans in brackets.\n    # The boolean values must be capitalized as True/False for correct string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}