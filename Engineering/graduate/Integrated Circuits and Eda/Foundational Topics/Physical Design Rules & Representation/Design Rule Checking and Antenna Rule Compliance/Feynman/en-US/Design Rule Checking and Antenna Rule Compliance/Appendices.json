{
    "hands_on_practices": [
        {
            "introduction": "To build robust integrated circuits, we must first ensure they are manufacturable. This practice grounds us in a fundamental Design Rule Check (DRC) related to manufacturing yield: metal density control for Chemical Mechanical Planarization (CMP). You will calculate the local metal density for a given layout, a task that requires precise geometric reasoning and the handling of overlapping shapes, which are core operations within any physical verification tool. This exercise provides a tangible entry point into the computational geometry at the heart of DRC.",
            "id": "4265028",
            "problem": "An Electronic Design Automation (EDA) physical verification flow includes Design Rule Checking (DRC) for pattern density windows used by Chemical Mechanical Planarization (CMP). Consider a single CMP density window for the second metal layer ($\\mathrm{M}2$), defined as the square region with corners at $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ and $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$. Within this window, three disjoint drawn metal rectangles may partially lie inside or outside the window, and overlapping regions between rectangles on the same layer must be counted only once (i.e., use the geometric union of metal coverage within the window). The three rectangles are:\n- Rectangle $\\mathrm{P}1$: lower-left corner at $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$, upper-right corner at $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$.\n- Rectangle $\\mathrm{P}2$: lower-left corner at $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$, upper-right corner at $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$.\n- Rectangle $\\mathrm{P}3$: lower-left corner at $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$, upper-right corner at $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$.\n\nUsing the physical definition of local metal pattern density in a window as the fraction of the window’s area covered by metal on the layer under test, compute the local $\\mathrm{M}2$ metal density in this $100\\,\\mu\\mathrm{m} \\times 100\\,\\mu\\mathrm{m}$ window. In the compliance assessment, the target band is $0.30$–$0.70$ for acceptable local density. Express the final density value as a unitless decimal fraction, and round your answer to four significant figures.",
            "solution": "The problem as stated is subject to validation.\n\n**Step 1: Extract Givens**\n- **Analysis Window ($W$):** A square region with corners at $(0\\,\\mu\\mathrm{m}, 0\\,\\mu\\mathrm{m})$ and $(100\\,\\mu\\mathrm{m}, 100\\,\\mu\\mathrm{m})$.\n- **Rectangle P1 ($P_1$):** Lower-left corner at $(-20\\,\\mu\\mathrm{m}, 10\\,\\mu\\mathrm{m})$, upper-right corner at $(60\\,\\mu\\mathrm{m}, 50\\,\\mu\\mathrm{m})$.\n- **Rectangle P2 ($P_2$):** Lower-left corner at $(40\\,\\mu\\mathrm{m}, 30\\,\\mu\\mathrm{m})$, upper-right corner at $(120\\,\\mu\\mathrm{m}, 80\\,\\mu\\mathrm{m})$.\n- **Rectangle P3 ($P_3$):** Lower-left corner at $(70\\,\\mu\\mathrm{m}, 60\\,\\mu\\mathrm{m})$, upper-right corner at $(95\\,\\mu\\mathrm{m}, 110\\,\\mu\\mathrm{m})$.\n- **Rule for Overlaps:** \"overlapping regions between rectangles on the same layer must be counted only once (i.e., use the geometric union of metal coverage within the window).\"\n- **Definition of Density ($\\rho$):** The local metal pattern density is the fraction of the window’s area covered by metal, $\\rho = \\frac{A_{\\text{metal}}}{A_{\\text{window}}}$.\n- **Output Requirement:** The final density value must be a unitless decimal fraction rounded to four significant figures.\n- **Problem Statement Anomaly:** The problem describes the rectangles as \"disjoint,\" which means non-overlapping. However, a simple check of the provided coordinates reveals that rectangle $P_1$ and rectangle $P_2$ do, in fact, overlap. This is a factual inconsistency in the problem's description.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded in the domain of integrated circuit physical verification. It is objective and provides sufficient data for a unique solution. The anomaly regarding the term \"disjoint\" is noted; however, the problem provides a clear and dominant instruction: \"use the geometric union of metal coverage.\" In EDA practice, this instruction supersedes any descriptive terms. The problem is therefore well-posed, as the method of handling the overlaps is explicitly defined. The calculation is a standard application of computational geometry.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. The minor inconsistency is recognized but resolved by other explicit instructions. A complete solution will be provided.\n\n**Solution Derivation**\n\nThe local metal pattern density, $\\rho$, is defined as the ratio of the total area of metal within the analysis window, $A_{\\text{metal-in-window}}$, to the total area of the window, $A_{\\text{window}}$.\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} $$\n\nFirst, we calculate the area of the analysis window, $W$. The window is a square region defined by the Cartesian product of intervals $W = [0, 100] \\times [0, 100]$ in units of $\\mu\\mathrm{m}$.\n$$ A_{\\text{window}} = (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) \\times (100\\,\\mu\\mathrm{m} - 0\\,\\mu\\mathrm{m}) = 10000\\,\\mu\\mathrm{m}^2 $$\n\nNext, we must determine the total area of metal within this window, $A_{\\text{metal-in-window}}$. This area is the geometric union of the three rectangles ($P_1$, $P_2$, $P_3$), clipped to the boundaries of the window $W$. Let $P'_i = P_i \\cap W$ represent the portion of each rectangle $P_i$ that lies within the window. We need to calculate the area of the union of these clipped rectangles: $A(P'_1 \\cup P'_2 \\cup P'_3)$.\n\nThe three rectangles are given as:\n- $P_1 = [-20, 60] \\times [10, 50]$\n- $P_2 = [40, 120] \\times [30, 80]$\n- $P_3 = [70, 95] \\times [60, 110]$\n\nThe intersection of a generic rectangle $[x_{\\min}, x_{\\max}] \\times [y_{\\min}, y_{\\max}]$ with the window $W = [0, 100] \\times [0, 100]$ results in a new rectangle $[\\max(x_{\\min}, 0), \\min(x_{\\max}, 100)] \\times [\\max(y_{\\min}, 0), \\min(y_{\\max}, 100)]$.\n\nThe clipped rectangles $P'_i$ are:\n- $P'_1 = [\\max(-20, 0), \\min(60, 100)] \\times [\\max(10, 0), \\min(50, 100)] = [0, 60] \\times [10, 50]$\n- $P'_2 = [\\max(40, 0), \\min(120, 100)] \\times [\\max(30, 0), \\min(80, 100)] = [40, 100] \\times [30, 80]$\n- $P'_3 = [\\max(70, 0), \\min(95, 100)] \\times [\\max(60, 0), \\min(110, 100)] = [70, 95] \\times [60, 100]$\n\nThe individual areas of these clipped rectangles are:\n- $A(P'_1) = (60 - 0) \\times (50 - 10) = 60 \\times 40 = 2400\\,\\mu\\mathrm{m}^2$\n- $A(P'_2) = (100 - 40) \\times (80 - 30) = 60 \\times 50 = 3000\\,\\mu\\mathrm{m}^2$\n- $A(P'_3) = (95 - 70) \\times (100 - 60) = 25 \\times 40 = 1000\\,\\mu\\mathrm{m}^2$\n\nTo find the area of the union, we use the Principle of Inclusion-Exclusion for three sets:\n$$ A(P'_1 \\cup P'_2 \\cup P'_3) = A(P'_1) + A(P'_2) + A(P'_3) - A(P'_1 \\cap P'_2) - A(P'_1 \\cap P'_3) - A(P'_2 \\cap P'_3) + A(P'_1 \\cap P'_2 \\cap P'_3) $$\n\nWe now compute the areas of the pairwise intersections of the clipped rectangles:\n- Intersection $P'_1 \\cap P'_2$:\n  - $x$-interval: $[\\max(0, 40), \\min(60, 100)] = [40, 60]$\n  - $y$-interval: $[\\max(10, 30), \\min(50, 80)] = [30, 50]$\n  - Area: $A(P'_1 \\cap P'_2) = (60 - 40) \\times (50 - 30) = 20 \\times 20 = 400\\,\\mu\\mathrm{m}^2$\n\n- Intersection $P'_1 \\cap P'_3$:\n  - $x$-interval: $[\\max(0, 70), \\min(60, 95)] = [70, 60]$. Since the lower bound is greater than the upper bound, the intersection is an empty set.\n  - Area: $A(P'_1 \\cap P'_3) = 0\\,\\mu\\mathrm{m}^2$\n\n- Intersection $P'_2 \\cap P'_3$:\n  - $x$-interval: $[\\max(40, 70), \\min(100, 95)] = [70, 95]$\n  - $y$-interval: $[\\max(30, 60), \\min(80, 100)] = [60, 80]$\n  - Area: $A(P'_2 \\cap P'_3) = (95 - 70) \\times (80 - 60) = 25 \\times 20 = 500\\,\\mu\\mathrm{m}^2$\n\nFinally, we compute the area of the triple intersection, $A(P'_1 \\cap P'_2 \\cap P'_3)$. Since $P'_1 \\cap P'_3$ is empty, the triple intersection must also be empty.\n$$ A(P'_1 \\cap P'_2 \\cap P'_3) = A((P'_1 \\cap P'_3) \\cap P'_2) = A(\\emptyset \\cap P'_2) = A(\\emptyset) = 0\\,\\mu\\mathrm{m}^2 $$\n\nNow, we substitute all areas back into the inclusion-exclusion formula:\n$$ A_{\\text{metal-in-window}} = A(P'_1 \\cup P'_2 \\cup P'_3) = (2400 + 3000 + 1000) - (400 + 0 + 500) + 0 $$\n$$ A_{\\text{metal-in-window}} = 6400 - 900 + 0 = 5500\\,\\mu\\mathrm{m}^2 $$\n\nThe local metal density $\\rho$ is therefore:\n$$ \\rho = \\frac{A_{\\text{metal-in-window}}}{A_{\\text{window}}} = \\frac{5500\\,\\mu\\mathrm{m}^2}{10000\\,\\mu\\mathrm{m}^2} = 0.55 $$\n\nThe problem requires the answer to be expressed as a decimal fraction rounded to four significant figures.\n$$ \\rho = 0.5500 $$\n\nThis value falls within the acceptable target band of $0.30$ to $0.70$.",
            "answer": "$$\\boxed{0.5500}$$"
        },
        {
            "introduction": "Antenna rule violations are intrinsically linked to the sequential nature of semiconductor fabrication, where a net's connectivity evolves with each new layer. This advanced practice challenges you to model this dynamic process by treating the net as a graph whose structure changes over time. By implementing an algorithm to traverse the net's connectivity at specific fabrication steps, you will calculate layer-specific antenna ratios, gaining a deep, procedural understanding of when a gate is exposed to plasma-induced charging and when it is protected. ",
            "id": "4265077",
            "problem": "You are given a task in the domain of integrated circuits and electronic design automation (EDA). The focus is design rule checking (DRC) with attention to antenna rule compliance during plasma etching. The fabrication process proceeds in discrete steps, and interconnect connectivity emerges only when elements are formed in their respective step. The computed quantity is the layer-specific antenna ratio, which quantifies plasma-induced charge exposure with respect to gate oxide tolerance.\n\nFundamental base statements:\n- Plasma-induced charge accumulation during etch scales with exposed conductor surface area. For a given layer, the charge exposure attributable to that layer at its formation step scales with the area of connected conductors on that layer.\n- The risk of gate oxide damage scales with charge density relative to gate oxide area. A larger gate oxide area reduces stress per unit charge exposure.\n- Connectivity of a net at a fabrication step includes only interconnect segments and vias whose formation steps are less than or equal to the current step. A discharge path exists if a gate is connected, at that step, to a diffusion node (or an equivalent sink).\n- The antenna ratio per layer follows from these principles as a dimensionless quantity comparing exposed conductor area to gate oxide area, evaluated strictly at the etch step for that layer.\n\nModeling assumptions and definitions:\n- Represent the net as an undirected graph. Nodes represent terminals or junctions, and edges represent interconnect segments or vias. Each edge has a formation step and, for metal segments, a positive area. Vias are considered for connectivity only and have zero area in this model.\n- Let the process steps be the following ordered mapping:\n  - Poly patterning at step $1$ (denoted $POLY$).\n  - Contact formation at step $2$ (denoted $V0$), which connects to gates or diffusions.\n  - First metal deposition and etch at step $3$ (denoted $M1$).\n  - Via from $M1$ to $M2$ formation at step $4$ (denoted $V1$).\n  - Second metal deposition and etch at step $5$ (denoted $M2$).\n- A node designated as diffusion is a discharge sink. A node designated as gate has a given gate oxide area.\n- For a net with multiple gates, the net-level antenna ratio for a given layer is the maximum over the gate-specific ratios at that layer’s step using the above connectivity.\n\nTask:\n1. Construct an algorithm that, for a given net and a fabrication step corresponding to a layer $L$, walks the connectivity from each gate using only edges formed at steps less than or equal to the step for $L$. If any diffusion node is reachable from a gate under these constraints, the exposure for that gate at that step is set to no-risk for that layer. Otherwise, sum the areas of the layer-$L$ edges reachable from that gate at that step and compare to the gate oxide area to compute the gate’s layer-specific antenna ratio. Aggregate to a net-level ratio by taking the maximum across the gates in the net.\n2. Implement the algorithm as a complete program that evaluates the following test suite. For each case, return the list $[AR^{(M1)},AR^{(M2)}]$ using the process step mapping above.\n\nTest suite specification (all areas are positive reals; antenna ratios are unitless):\n- Case $1$ (single gate, unprotected $M1$):\n  - Nodes: gate $G1$ with gate oxide area $1.0$; junction nodes $J1$, $T1$.\n  - Edges: $G1 \\leftrightarrow J1$ via $V0$ at step $2$ with area $0$; $J1 \\leftrightarrow T1$ on $M1$ at step $3$ with area $150$.\n- Case $2$ (single gate, diffusion reachable at $M1$ step):\n  - Nodes: gate $G2$ with gate oxide area $0.5$; diffusion node $D2$; junction nodes $J2$, $T2$.\n  - Edges: $G2 \\leftrightarrow J2$ via $V0$ at step $2$ with area $0$; $J2 \\leftrightarrow T2$ on $M1$ at step $3$ with area $100$; $J2 \\leftrightarrow D2$ via $V0$ at step $2$ with area $0$.\n- Case $3$ (multi-layer, protection becomes available only after $V1$ formation, protecting $M2$ but not $M1$):\n  - Nodes: gate $G3$ with gate oxide area $2.0$; diffusion node $D3$; junction nodes $J3$, $T3$, $W31$, $W32$, $M1d$.\n  - Edges: $G3 \\leftrightarrow J3$ via $V0$ at step $2$ with area $0$; $J3 \\leftrightarrow T3$ on $M1$ at step $3$ with area $50$; $T3 \\leftrightarrow W31$ via $V1$ at step $4$ with area $0$; $W31 \\leftrightarrow W32$ on $M2$ at step $5$ with area $200$; $W31 \\leftrightarrow M1d$ via $V1$ at step $4$ with area $0$; $M1d \\leftrightarrow D3$ via $V0$ at step $2$ with area $0$.\n- Case $4$ (two gates sharing metal, no diffusion):\n  - Nodes: gates $G4a$ with gate oxide area $0.4$, $G4b$ with gate oxide area $2.0$; junction nodes $J4$, $T4$, $W41$, $Z41$.\n  - Edges: $G4a \\leftrightarrow J4$ via $V0$ at step $2$ with area $0$; $G4b \\leftrightarrow J4$ via $V0$ at step $2$ with area $0$; $J4 \\leftrightarrow T4$ on $M1$ at step $3$ with area $80$; $T4 \\leftrightarrow W41$ via $V1$ at step $4$ with area $0$; $W41 \\leftrightarrow Z41$ on $M2$ at step $5$ with area $120$.\n- Case $5$ (zero exposed metal, diffusion reachable):\n  - Nodes: gate $G5$ with gate oxide area $1.0$; diffusion node $D5$; junction node $J5$.\n  - Edges: $G5 \\leftrightarrow J5$ via $V0$ at step $2$ with area $0$; $J5 \\leftrightarrow D5$ via $V0$ at step $2$ with area $0$.\n\nOutput requirement:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each test case’s result is a list $[AR^{(M1)},AR^{(M2)}]$, in order of the cases. The overall output is a list of these lists, such as $[[a_{11},a_{12}],[a_{21},a_{22}],\\dots]$. Antenna ratios are unitless real numbers and must be printed in decimal form.",
            "solution": "The problem statement has been analyzed and is determined to be valid. It is scientifically grounded in the principles of semiconductor fabrication and electronic design automation, specifically concerning plasma-induced device damage and antenna rule checking. The problem is well-posed, with a clearly defined algorithmic task, unambiguous definitions, and a complete set of input data for the specified test cases. The language is objective and precise, allowing for a unique and verifiable solution.\n\nThe problem requires the calculation of layer-specific antenna ratios for a set of circuit nets. The antenna ratio, $AR$, for a given gate on a specific conducting layer $L$ is a critical metric for assessing the risk of gate oxide damage during plasma etching processes. It is defined as the ratio of the total exposed area of conductors on layer $L$ connected to the gate, $A_{L, \\text{exposed}}$, to the area of the gate oxide itself, $A_{\\text{gate}}$.\n$$\nAR_L = \\frac{A_{L, \\text{exposed}}}{A_{\\text{gate}}}\n$$\nThe calculation is critically dependent on the fabrication step. A net's connectivity is not static; it evolves as layers are patterned. At any given fabrication step $s$, the electrical network consists only of components (interconnects, vias) formed at steps $s' \\le s$. A key protective mechanism is the connection to a diffusion node, which acts as a charge sink. If a gate is connected to a diffusion node at the step corresponding to the etch of layer $L$, the charge can be safely discharged, and the antenna ratio for that gate on that layer is considered to be $0$.\n\nThe algorithm to solve this problem models the net as an undirected graph $G=(V, E)$, where $V$ is the set of nodes (gates, diffusions, junctions) and $E$ is the set of edges (metal segments, vias). Each edge $e \\in E$ is associated with a formation step, $s_e$, a layer designation, $l_e$, and an area, $a_e$. Vias have $a_e=0$. We are tasked with computing the antenna ratios for layers $M1$ and $M2$, which are formed at steps $s_{M1}=3$ and $s_{M2}=5$, respectively.\n\nThe procedure for calculating the net-level antenna ratio for a target layer $L$ with formation step $s_L$ is as follows:\n\n1.  For each gate $g$ in the net, we determine its specific antenna ratio, $AR_{g,L}$. The net-level ratio $AR_L^{\\text{net}}$ is the maximum of these individual gate ratios.\n    $$\n    AR_L^{\\text{net}} = \\max_{g \\, \\in \\, \\text{gates}} (AR_{g,L})\n    $$\n\n2.  To compute $AR_{g,L}$ for a specific gate $g$, we first identify the subgraph $G'_g(s_L)$ representing the electrically connected component containing $g$ at step $s_L$. This subgraph includes all nodes reachable from $g$ by traversing only edges $e$ with a formation step $s_e \\le s_L$. A Breadth-First Search (BFS) or Depth-First Search (DFS) starting from $g$ can be used to find all nodes in this component, which we denote as $V'_g$.\n\n3.  We then check for the presence of a discharge path. If any node $v \\in V'_g$ is a diffusion node, the gate is considered protected at step $s_L$. In this case, its antenna ratio is $AR_{g,L} = 0$.\n\n4.  If no diffusion node is found in $V'_g$, the gate is at risk. We must calculate the total exposed area of layer $L$ metal. This is the sum of the areas of all edges within the connected component $G'_g(s_L)$ that belong to layer $L$. Let $E'_g$ be the set of edges in the subgraph $G'_g(s_L)$. The exposed area is:\n    $$\n    A_{L, \\text{exposed}} = \\sum_{e \\, \\in \\, E'_g, \\, l_e=L} a_e\n    $$\n    Note that the edges considered for area summation are all edges of layer $L$ in the connected component, not just those on a simple path from the gate.\n\n5.  The gate-specific antenna ratio is then calculated using its gate oxide area, $A_{g, \\text{gate}}$:\n    $$\n    AR_{g,L} = \\frac{A_{L, \\text{exposed}}}{A_{g, \\text{gate}}}\n    $$\n\nThis procedure is applied for each gate in the net to find the maximum ratio, which constitutes the final answer for that layer. The overall solution involves applying this entire process twice for each test case: once for layer $M1$ at step $s_{M1}=3$ and once for layer $M2$ at step $s_{M2}=5$.",
            "answer": "```python\nimport collections\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the antenna ratio calculation for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: single gate, unprotected M1\n        {\n            \"nodes\": {\"G1\": {\"type\": \"gate\", \"area\": 1.0}},\n            \"edges\": [\n                (\"G1\", \"J1\", \"V0\", 2, 0.0),\n                (\"J1\", \"T1\", \"M1\", 3, 150.0),\n            ]\n        },\n        # Case 2: single gate, diffusion reachable at M1 step\n        {\n            \"nodes\": {\n                \"G2\": {\"type\": \"gate\", \"area\": 0.5},\n                \"D2\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G2\", \"J2\", \"V0\", 2, 0.0),\n                (\"J2\", \"T2\", \"M1\", 3, 100.0),\n                (\"J2\", \"D2\", \"V0\", 2, 0.0),\n            ]\n        },\n        # Case 3: multi-layer, protection available after V1\n        {\n            \"nodes\": {\n                \"G3\": {\"type\": \"gate\", \"area\": 2.0},\n                \"D3\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G3\", \"J3\", \"V0\", 2, 0.0),\n                (\"J3\", \"T3\", \"M1\", 3, 50.0),\n                (\"T3\", \"W31\", \"V1\", 4, 0.0),\n                (\"W31\", \"W32\", \"M2\", 5, 200.0),\n                (\"W31\", \"M1d\", \"V1\", 4, 0.0),\n                (\"M1d\", \"D3\", \"V0\", 2, 0.0),\n            ]\n        },\n        # Case 4: two gates sharing metal, no diffusion\n        {\n            \"nodes\": {\n                \"G4a\": {\"type\": \"gate\", \"area\": 0.4},\n                \"G4b\": {\"type\": \"gate\", \"area\": 2.0}\n            },\n            \"edges\": [\n                (\"G4a\", \"J4\", \"V0\", 2, 0.0),\n                (\"G4b\", \"J4\", \"V0\", 2, 0.0),\n                (\"J4\", \"T4\", \"M1\", 3, 80.0),\n                (\"T4\", \"W41\", \"V1\", 4, 0.0),\n                (\"W41\", \"Z41\", \"M2\", 5, 120.0),\n            ]\n        },\n        # Case 5: zero exposed metal, diffusion reachable\n        {\n            \"nodes\": {\n                \"G5\": {\"type\": \"gate\", \"area\": 1.0},\n                \"D5\": {\"type\": \"diffusion\"}\n            },\n            \"edges\": [\n                (\"G5\", \"J5\", \"V0\", 2, 0.0),\n                (\"J5\", \"D5\", \"V0\", 2, 0.0),\n            ]\n        },\n    ]\n\n    layer_steps = {'M1': 3, 'M2': 5}\n    results = []\n\n    for case in test_cases:\n        adj = collections.defaultdict(list)\n        for u, v, layer, step, area in case[\"edges\"]:\n            adj[u].append((v, layer, step, area))\n            adj[v].append((u, layer, step, area))\n\n        gates = {name: props for name, props in case[\"nodes\"].items() if props[\"type\"] == \"gate\"}\n        diffusions = {name for name, props in case[\"nodes\"].items() if props[\"type\"] == \"diffusion\"}\n        \n        case_results = []\n        for target_layer, current_step in layer_steps.items():\n            net_ratio = calculate_net_ratio(adj, gates, diffusions, current_step, target_layer)\n            case_results.append(net_ratio)\n        \n        results.append(case_results)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef calculate_net_ratio(adj, gates, diffusions, current_step, target_layer):\n    \"\"\"\n    Calculates the net-level antenna ratio for a given layer.\n    This is the maximum ratio over all gates in the net.\n    \"\"\"\n    if not gates:\n        return 0.0\n\n    max_ratio = 0.0\n    \n    # Memoization to avoid recomputing for gates in the same connected component\n    visited_gates = set()\n\n    for gate_name, gate_props in gates.items():\n        if gate_name in visited_gates:\n            continue\n            \n        # 1. Find the connected component for the current gate at this process step\n        component_nodes = set()\n        queue = collections.deque([gate_name])\n        visited_bfs = {gate_name}\n        \n        while queue:\n            u = queue.popleft()\n            component_nodes.add(u)\n            for v, _, step, _ in adj[u]:\n                if step <= current_step and v not in visited_bfs:\n                    visited_bfs.add(v)\n                    queue.append(v)\n        \n        # Mark all gates in this component as visited\n        for node in component_nodes:\n            if node in gates:\n                visited_gates.add(node)\n        \n        # 2. Check if the component is protected by a diffusion node\n        is_protected = any(node in diffusions for node in component_nodes)\n        \n        if is_protected:\n            # All gates in this component have a ratio of 0\n            # max_ratio remains unchanged (or becomes max(max_ratio, 0.0))\n            continue\n        \n        # 3. If not protected, calculate the exposed area for the target layer\n        total_exposed_area = 0.0\n        visited_edges = set()\n        for u in component_nodes:\n            for v, layer, step, area in adj[u]:\n                # Ensure edge is within component and counted once\n                if v in component_nodes:\n                    edge_id = tuple(sorted((u, v)))\n                    if edge_id not in visited_edges:\n                        visited_edges.add(edge_id)\n                        if layer == target_layer:\n                            total_exposed_area += area\n                            \n        # 4. Calculate ratio for each gate in this component and find the max\n        for node in component_nodes:\n            if node in gates:\n                gate_area = gates[node]['area']\n                if gate_area > 0:\n                    gate_ratio = total_exposed_area / gate_area\n                    if gate_ratio > max_ratio:\n                        max_ratio = gate_ratio\n    \n    return max_ratio\n\nsolve()\n```"
        },
        {
            "introduction": "Effective DRC involves not only flagging violations but also intelligently recognizing valid fixes. This exercise moves into advanced antenna rule compliance by asking you to model a common mitigation strategy: the use of a protection diode. You will derive a physically-grounded formula for an \"effective\" antenna ratio, $AR_{\\mathrm{eff}}$, that accounts for the charge-sinking capability of a nearby diode. This practice exemplifies how modern rule decks incorporate sophisticated physical models to avoid flagging false violations and enable more aggressive designs. ",
            "id": "4265055",
            "problem": "Consider an advanced Physical Verification scenario within Electronic Design Automation (EDA) for integrated circuits. The goal is to construct a mathematically grounded Design Rule Checking (DRC) antenna compliance rule that conditionally relaxes the Antenna Ratio (AR) when an on-net diode is present, by modeling an effective discharge factor that scales the antenna ratio.\n\nStart from the following fundamental base:\n\n- The Antenna Ratio is defined as $AR = \\frac{A_m}{A_g}$, where $A_m$ is the total exposed conductor area connected to a gate during an etch step and $A_g$ is the gate area. Both $A_m$ and $A_g$ must be expressed in $\\mu \\mathrm{m}^2$.\n- Plasma-induced charging during etch injects current proportional to conductor area. Let the injection current density be $\\rho$ with units $\\mathrm{A}/\\mu \\mathrm{m}^2$. The injection current is $I_{\\mathrm{in}} = \\rho A_m$.\n- An on-net diode, if present, discharges the node during etch, approximately providing a discharge current proportional to its area. Let the diode area be $A_d$ in $\\mu \\mathrm{m}^2$ and the diode current density at the relevant bias be $J_s$ with units $\\mathrm{A}/\\mu \\mathrm{m}^2$. The path from the diode to the antenna node has resistance $R_p$ in $\\Omega$, and the diode exhibits a characteristic series resistance parameter $R_s$ in $\\Omega$. You must model an attenuation factor for the discharge current due to $R_p$ using a dimensionless factor that decreases with increasing $R_p$.\n- The technology antenna rule specifies a maximum allowable ratio $AR_{\\max}$ (dimensionless). Compliance requires that an effective antenna ratio $AR_{\\mathrm{eff}}$ not exceed $AR_{\\max}$.\n\nConstruct a rule that determines $AR_{\\mathrm{eff}}$ by scaling $AR$ with an effective discharge factor $\\gamma \\in [0,1]$ that models the fraction of plasma-injected charge that remains on the node after diode-assisted discharge. The rule must satisfy the following criteria:\n- If no diode is present, then the node does not receive discharge assistance and the rule must reduce to $AR_{\\mathrm{eff}} = AR$.\n- If a diode is present, the discharge assistance must monotonically reduce $AR_{\\mathrm{eff}}$ with increasing $A_d$ and decreasing $R_p$.\n- The discharge factor construction must be justified from the given fundamental base and be dimensionally consistent. The modeled attenuation factor for discharge through the diode must be a dimensionless function of $R_p$ and $R_s$ that approaches $1$ as $R_p \\rightarrow 0$ and approaches $0$ as $R_p \\rightarrow \\infty$.\n\nYour task is to implement a program that, for each test case, determines whether the net effective antenna ratio satisfies $AR_{\\mathrm{eff}} \\le AR_{\\max}$. All inputs must use the specified units:\n- Areas $A_m$, $A_g$, and $A_d$ must be in $\\mu \\mathrm{m}^2$.\n- Resistances $R_p$ and $R_s$ must be in $\\Omega$.\n- Current densities $\\rho$ and $J_s$ must be in $\\mathrm{A}/\\mu \\mathrm{m}^2$.\n\nUse the following fixed technology parameters in your computation:\n- $AR_{\\max} = 300$.\n- $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$.\n- $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$.\n- $R_s = 100 \\, \\Omega$.\n\nTest suite of parameter values to cover multiple facets:\n- Case $1$ (boundary without diode): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$.\n- Case $2$ (fail without diode): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$.\n- Case $3$ (partial relaxation with moderate diode and moderate path resistance): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$.\n- Case $4$ (strong relaxation with large diode and moderate path resistance): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$.\n- Case $5$ (edge case zero metal area): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$.\n- Case $6$ (diode present but effectively disconnected due to extreme path resistance): $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\ldots]$), where each $\\text{result}_i$ is a boolean indicating compliance for the corresponding test case, with $\\text{True}$ meaning $AR_{\\mathrm{eff}} \\le AR_{\\max}$ and $\\text{False}$ otherwise. No other output is allowed.",
            "solution": "The user wants to solve a problem statement.\n\n### Step 1: Extract Givens\n- **Antenna Ratio Definition**: $AR = \\frac{A_m}{A_g}$, where $A_m$ is the exposed conductor area ($\\mu \\mathrm{m}^2$) and $A_g$ is the gate area ($\\mu \\mathrm{m}^2$).\n- **Injection Current**: $I_{\\mathrm{in}} = \\rho A_m$, where $\\rho$ is the injection current density ($\\mathrm{A}/\\mu \\mathrm{m}^2$).\n- **Diode Discharge**: An on-net diode with area $A_d$ ($\\mu \\mathrm{m}^2$) provides a discharge current. The diode current density is $J_s$ ($\\mathrm{A}/\\mu \\mathrm{m}^2$). The path has resistance $R_p$ ($\\Omega$) and the diode has series resistance parameter $R_s$ ($\\Omega$). An attenuation factor must be modeled as a function of $R_p$ and $R_s$.\n- **Compliance Rule**: The effective antenna ratio $AR_{\\mathrm{eff}}$ must not exceed the maximum allowable ratio $AR_{\\max}$. $AR_{\\mathrm{eff}} \\le AR_{\\max}$.\n- **Effective Discharge Factor**: $AR_{\\mathrm{eff}}$ is obtained by scaling $AR$ with a factor $\\gamma \\in [0,1]$, which models the fraction of charge remaining.\n- **Model Criteria**:\n    1. If no diode is present, $AR_{\\mathrm{eff}} = AR$.\n    2. If a diode is present, $AR_{\\mathrm{eff}}$ must monotonically decrease with increasing $A_d$ and decreasing $R_p$.\n    3. The attenuation factor for discharge must be a dimensionless function of $R_p$ and $R_s$ that approaches $1$ as $R_p \\rightarrow 0$ and approaches $0$ as $R_p \\rightarrow \\infty$.\n- **Fixed Technology Parameters**:\n    - $AR_{\\max} = 300$\n    - $\\rho = 1.0 \\times 10^{-9} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $J_s = 2.0 \\times 10^{-6} \\, \\mathrm{A}/\\mu \\mathrm{m}^2$\n    - $R_s = 100 \\, \\Omega$\n- **Test Suite**:\n    - Case $1$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\n    - Case $2$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\n    - Case $3$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\n    - Case $4$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\n    - Case $5$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\n    - Case $6$: $(A_m, A_g, \\text{diode\\_present}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the principles of plasma-induced charging in semiconductor manufacturing, a well-known reliability concern. Its formulation is based on physical quantities like area, current density, and resistance. The problem is well-posed, providing a clear objective (determine compliance for a set of test cases), sufficient data, and a set of constraints for constructing the required mathematical model. The language is objective and precise. The problem requires the derivation of a model from first principles and given constraints, which is a standard task in physics and engineering. The construction is not underspecified, as the constraints on monotonicity and boundary conditions guide the selection of a physically justifiable model. The problem does not violate any of the invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is valid. A reasoned solution will be developed.\n\n### Solution Derivation\nThe core of the problem is to construct a model for the effective antenna ratio, $AR_{\\mathrm{eff}}$. The standard antenna rule, $AR = \\frac{A_m}{A_g} \\le AR_{\\max}$, is a proxy for limiting the stress on the gate oxide. This stress is caused by the voltage built up from the plasma-injected current, $I_{\\mathrm{in}}$, flowing into the gate. A diode provides an alternative path to discharge this current.\n\nFirst, we define the base antenna ratio:\n$$AR = \\frac{A_m}{A_g}$$\nIf no diode is present, the problem states that $AR_{\\mathrm{eff}} = AR$.\n\nIf a diode is present, it provides a discharge current. The maximum available discharge current from the diode itself is proportional to its area, $I_{d} = J_s A_d$. However, this current must flow through the diode's series resistance $R_s$ and the path resistance $R_p$. The total resistance in the discharge path is $R_{\\mathrm{path\\_total}} = R_s + R_p$.\n\nWe must construct a dimensionless attenuation factor, $f_{\\mathrm{att}}$, that models the reduction in discharge effectiveness due to $R_p$. This factor must be a function of $R_s$ and $R_p$, approaching $1$ as $R_p \\rightarrow 0$ and $0$ as $R_p \\rightarrow \\infty$. A physically intuitive model analogous to a resistive divider is appropriate. The discharge 'potential' is limited by the total path resistance relative to the diode's intrinsic resistance. A suitable function that satisfies the given constraints is:\n$$f_{\\mathrm{att}}(R_p, R_s) = \\frac{R_s}{R_s + R_p}$$\nThis function is dimensionless, equals $1$ when $R_p=0$, and approaches $0$ as $R_p \\rightarrow \\infty$.\n\nThe effective discharge current, $I_{\\mathrm{discharge\\_eff}}$, is the ideal diode current attenuated by this factor:\n$$I_{\\mathrm{discharge\\_eff}} = I_d \\cdot f_{\\mathrm{att}} = J_s A_d \\frac{R_s}{R_s + R_p}$$\nThe net current charging the gate is the difference between the injected current and the effective discharge current. Physically, discharge current cannot exceed the injection current, so the net current cannot be negative.\n$$I_{\\mathrm{net}} = \\max(0, I_{\\mathrm{in}} - I_{\\mathrm{discharge\\_eff}}) = \\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)$$\nThe antenna rule is a proxy for the stress on the gate, which is related to the current density flowing into the gate, $I_{\\mathrm{net}} / A_g$. We define $AR_{\\mathrm{eff}}$ to maintain a similar structure to the original rule, where stress is proportional to the ratio.\n$$\\text{Stress} \\propto \\frac{I_{\\mathrm{net}}}{A_g}$$\nWe want $\\rho \\cdot AR_{\\mathrm{eff}}$ to represent this new stress level.\n$$\\rho \\cdot AR_{\\mathrm{eff}} = \\frac{I_{\\mathrm{net}}}{A_g} = \\frac{\\max\\left(0, \\rho A_m - J_s A_d \\frac{R_s}{R_s + R_p}\\right)}{A_g}$$\nDividing by $\\rho$ and distributing inside the $\\max$ function:\n$$AR_{\\mathrm{eff}} = \\max\\left(0, \\frac{\\rho A_m}{\\rho A_g} - \\frac{J_s A_d}{\\rho A_g} \\frac{R_s}{R_s + R_p}\\right)$$\nSubstituting $AR = A_m / A_g$, we arrive at the final expression for $AR_{\\mathrm{eff}}$:\n$$AR_{\\mathrm{eff}} = \\max\\left(0, AR - \\frac{J_s A_d R_s}{\\rho A_g (R_s + R_p)}\\right)$$\nThis model satisfies all criteria. If no diode is present (modeled by $A_d=0$), the subtractive term is zero, yielding $AR_{\\mathrm{eff}} = \\max(0, AR) = AR$ (since area is non-negative). $AR_{\\mathrm{eff}}$ monotonically decreases as $A_d$ increases and as $R_p$ decreases. The term subtracted from $AR$ is dimensionless, ensuring dimensional consistency.\n\n### Application to Test Cases\nWe use the derived formula with the given parameters: $AR_{\\max} = 300$, $\\rho = 1.0 \\times 10^{-9}$, $J_s = 2.0 \\times 10^{-6}$, and $R_s = 100$.\n\n**Case 1**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (60000, 200, \\text{False}, 0, 0)$\nNo diode. $AR_{\\mathrm{eff}} = AR = \\frac{60000}{200} = 300$.\nCompliance: $300 \\le 300 \\Rightarrow \\text{True}$.\n\n**Case 2**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{False}, 0, 0)$\nNo diode. $AR_{\\mathrm{eff}} = AR = \\frac{90000}{200} = 450$.\nCompliance: $450 \\le 300 \\Rightarrow \\text{False}$.\n\n**Case 3**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 50, 50)$\nDiode is present. $AR = 450$.\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(50)(100)}{(1.0 \\times 10^{-9})(200)(100 + 50)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{ (2.0 \\times 10^{-7})(150) }\\right) = \\max\\left(0, 450 - \\frac{1.0 \\times 10^{-2}}{3.0 \\times 10^{-5}}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - 333.33...\\right) = 116.66...$\nCompliance: $116.66... \\le 300 \\Rightarrow \\text{True}$.\n\n**Case 4**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 300, 400)$\nDiode is present. $AR = 450$.\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(300)(100)}{(1.0 \\times 10^{-9})(200)(100 + 400)}\\right)$\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(500)}\\right) = \\max\\left(0, 450 - \\frac{6.0 \\times 10^{-2}}{1.0 \\times 10^{-4}}\\right)$\n$AR_{\\mathrm{eff}} = \\max(0, 450 - 600) = \\max(0, -150) = 0$.\nCompliance: $0 \\le 300 \\Rightarrow \\text{True}$.\n\n**Case 5**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (0, 200, \\text{False}, 0, 0)$\nNo diode. $A_m = 0$, so $AR = 0$.\n$AR_{\\mathrm{eff}} = AR = 0$.\nCompliance: $0 \\le 300 \\Rightarrow \\text{True}$.\n\n**Case 6**: $(A_m, A_g, \\text{diode}, A_d, R_p) = (90000, 200, \\text{True}, 100, 10^9)$\nDiode is present but with extremely high path resistance. $AR = 450$.\n$AR_{\\mathrm{eff}} = \\max\\left(0, 450 - \\frac{(2.0 \\times 10^{-6})(100)(100)}{(1.0 \\times 10^{-9})(200)(100 + 10^9)}\\right)$\nThe term $(100 + 10^9) \\approx 10^9$.\n$AR_{\\mathrm{eff}} \\approx \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{(2.0 \\times 10^{-7})(10^9)}\\right) = \\max\\left(0, 450 - \\frac{2.0 \\times 10^{-2}}{2.0 \\times 10^2}\\right)$\n$AR_{\\mathrm{eff}} \\approx \\max(0, 450 - 1.0 \\times 10^{-4}) = 449.9999$.\nCompliance: $449.9999 \\le 300 \\Rightarrow \\text{False}$.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DRC antenna compliance problem for a suite of test cases.\n    \"\"\"\n\n    # Define the fixed technology parameters from the problem statement.\n    AR_max = 300.0\n    rho = 1.0e-9  # A/um^2\n    J_s = 2.0e-6  # A/um^2\n    R_s = 100.0   # Ohm\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Am, Ag, diode_present, Ad, Rp)\n    test_cases = [\n        (60000.0, 200.0, False, 0.0, 0.0),    # Case 1\n        (90000.0, 200.0, False, 0.0, 0.0),    # Case 2\n        (90000.0, 200.0, True, 50.0, 50.0),     # Case 3\n        (90000.0, 200.0, True, 300.0, 400.0),   # Case 4\n        (0.0, 200.0, False, 0.0, 0.0),        # Case 5\n        (90000.0, 200.0, True, 100.0, 1.0e9)  # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        Am, Ag, diode_present, Ad, Rp = case\n\n        # Ensure gate area is non-zero to avoid division by zero.\n        # Physical devices will have Ag > 0.\n        if Ag <= 0:\n            # An infinitely large AR, always fails unless Am is also 0.\n            is_compliant = (Am == 0)\n            results.append(is_compliant)\n            continue\n\n        # Calculate the base Antenna Ratio (AR)\n        AR = Am / Ag\n\n        AR_eff = 0.0\n        if not diode_present:\n            # Rule 1: If no diode, AR_eff is just AR.\n            AR_eff = AR\n        else:\n            # Diode is present, calculate the effective AR with relaxation.\n\n            # The subtractive term represents the relaxation effect of the diode.\n            # Its formulation is derived in the solution description.\n            # Numerator of the reduction term\n            reduction_num = J_s * Ad * R_s\n            \n            # Denominator of the reduction term\n            reduction_den = rho * Ag * (R_s + Rp)\n\n            reduction_term = 0.0\n            if reduction_den > 0:\n                reduction_term = reduction_num / reduction_den\n            \n            # AR_eff is the base AR minus the relaxation, clamped at 0.\n            AR_eff = np.maximum(0.0, AR - reduction_term)\n\n        # Check for compliance against the maximum allowed antenna ratio.\n        is_compliant = (AR_eff <= AR_max)\n        results.append(is_compliant)\n\n    # Format the final output as a comma-separated list of booleans in brackets.\n    # The boolean values must be capitalized as True/False for correct string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}