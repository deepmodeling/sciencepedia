{
    "hands_on_practices": [
        {
            "introduction": "在我们开始优化布局之前，我们必须首先学会如何衡量。这项练习将介绍并对比三种基本的几何线长模型：半周长线长（HPWL）、最小生成树（MST）和直线斯坦纳最小树（RSMT）。通过为一个简单的网络计算这些指标，学生可以具体地理解它们的定义、计算差异以及精度上的权衡，这是所有布局算法的基础。",
            "id": "4289794",
            "problem": "考虑一个具有三个引脚的单个网络，其笛卡尔坐标（单位：微米）分别为：$p_{1}=(2,1)$、$p_{2}=(2,5)$ 和 $p_{3}=(9,3)$。假设所有互连都是直线（曼哈顿）模式，并且布线仅限于水平和垂直线段。使用标准的布局线长指标：\n\n- 通过考虑包围所有引脚的边界框，计算该网络的半周长线长（HPWL）。\n- 在连接三个引脚的直线（曼哈顿）度量下，计算最小生成树（MST）的长度。\n- 使用适用于 $n=3$ 个引脚的、基于快速查找表的直线斯坦纳近似（类 FLUTE）方法，计算直线斯坦纳最小树（RSMT）的长度。该方法在汉南网格上确定一个最优斯坦纳点。\n- 提供有序三元组 $(\\text{HPWL}, \\text{MST}, \\text{RSMT})$，并对这三个量进行定量比较。\n\n所有三个长度均以微米表示。如果选择四舍五入，请将最终值保留四位有效数字。",
            "solution": "该问题要求计算和比较一个具有三个引脚的单个网络的三个标准线长指标。引脚坐标（单位：微米）为 $p_1=(2,1)$、$p_2=(2,5)$ 和 $p_3=(9,3)$。布线是直线模式，意味着所有互连都由水平和垂直线段组成。距离度量是曼哈顿距离，对于两点 $p_i=(x_i, y_i)$ 和 $p_j=(x_j, y_j)$，其定义为 $d(p_i, p_j) = |x_i - x_j| + |y_i - y_j|$。\n\n**1. 半周长线长 (HPWL)**\n\n半周长线长（HPWL）是一种广泛使用的线长估计方法，其计算方式为包围该网络所有引脚的最小轴对齐边界框的半周长。\n\n首先，我们从引脚集合 $P = \\{p_1, p_2, p_3\\}$ 中确定 x 和 y 坐标的最小值和最大值。\n引脚的 x 坐标为 $\\{2, 2, 9\\}$。\n引脚的 y 坐标为 $\\{1, 5, 3\\}$。\n\n极值坐标为：\n$$x_{\\min} = \\min(2, 2, 9) = 2$$\n$$x_{\\max} = \\max(2, 2, 9) = 9$$\n$$y_{\\min} = \\min(1, 5, 3) = 1$$\n$$y_{\\max} = \\max(1, 5, 3) = 5$$\n\n边界框的宽度是 x 坐标的跨度，即 $W = x_{\\max} - x_{\\min} = 9 - 2 = 7 \\, \\mu m$。\n边界框的高度是 y 坐标的跨度，即 $H = y_{\\max} - y_{\\min} = 5 - 1 = 4 \\, \\mu m$。\n\nHPWL 是宽度和高度之和：\n$$\\text{HPWL} = W + H = (x_{\\max} - x_{\\min}) + (y_{\\max} - y_{\\min})$$\n$$\\text{HPWL} = 7 + 4 = 11 \\, \\mu m$$\n\n**2. 最小生成树 (MST) 长度**\n\n最小生成树（MST）以可能的最小总线长连接所有引脚，仅使用引脚之间的边，不添加任何新的中间点。该问题等效于在一个以引脚为顶点、曼哈顿距离为边权重的完全图中寻找 MST。\n\n我们计算每对引脚之间的曼哈顿距离：\n-   $p_1=(2,1)$ 和 $p_2=(2,5)$ 之间的距离：\n    $$d(p_1, p_2) = |2-2| + |1-5| = 0 + 4 = 4$$\n-   $p_1=(2,1)$ 和 $p_3=(9,3)$ 之间的距离：\n    $$d(p_1, p_3) = |2-9| + |1-3| = 7 + 2 = 9$$\n-   $p_2=(2,5)$ 和 $p_3=(9,3)$ 之间的距离：\n    $$d(p_2, p_3) = |2-9| + |5-3| = 7 + 2 = 9$$\n\n边权重的集合是 $\\{4, 9, 9\\}$。要在 $3$ 个顶点上形成一个 MST，我们必须选择权重最小且不形成环路的 $3-1=2$ 条边。应用 Kruskal 算法：\n1.  选择权重最小的边，即长度为 $4$ 的 $(p_1, p_2)$。\n2.  选择权重次小的边。$(p_1, p_3)$ 和 $(p_2, p_3)$ 的权重相同，均为 $9$。选择其中任意一条都可以将最后一个引脚 $p_3$ 连接到现有网络。例如，选择 $(p_1, p_3)$ 会得到树边 $(p_1, p_2)$ 和 $(p_1, p_3)$。\n\nMST 的总长度是所选边权重之和：\n$$\\text{MST} = d(p_1, p_2) + d(p_1, p_3) = 4 + 9 = 13 \\, \\mu m$$\n\n**3. 直线斯坦纳最小树 (RSMT) 长度**\n\n直线斯坦纳最小树（RSMT）是连接所有引脚的最短直线网络。它可以通过引入新的交汇点，即斯坦纳点（Steiner points），来减少总长度。对于一个引脚集合，RSMT 的最优斯坦纳点位于汉南网格（Hanan grid）上，该网格由穿过每个引脚的水平线和垂直线构成。\n\n对于一个有 $n=3$ 个引脚的网络，RSMT 最多有一个最优斯坦纳点 $s = (x_s, y_s)$，其坐标是引脚坐标的中位数。\nx 坐标的集合是 $\\{2, 2, 9\\}$。中位数是 $x_s = 2$。\ny 坐标的集合是 $\\{1, 3, 5\\}$（排序后）。中位数是 $y_s = 3$。\n因此，最优斯坦纳点是 $s=(2,3)$。\n\n生成的斯坦纳树的几何形状是通过将三个引脚连接到这个斯坦纳点而形成的。从 $s$ 到每个引脚的直线路径的并集构成了这棵树。\n-   从 $p_1=(2,1)$到 $s=(2,3)$ 的路径和从 $p_2=(2,5)$ 到 $s=(2,3)$ 的路径合并成一条位于直线 $x=2$ 上的垂直主干，其范围从 $y=1$ 到 $y=5$。该主干的长度为 $|5-1|=4$。\n-   从 $p_3=(9,3)$ 到 $s=(2,3)$ 的路径是一条位于直线 $y=3$ 上的水平分支，其范围从 $x=2$ 到 $x=9$。该分支的长度为 $|9-2|=7$。\nRSMT 的总长度是这两个正交线段的长度之和：\n$$\\text{RSMT} = 4 + 7 = 11 \\, \\mu m$$\n\n一个已知的定理是，对于 $n \\le 3$ 个引脚的网络，HPWL 是 RSMT 长度的精确计算值。我们的计算结果 $\\text{HPWL}=11$ 和 $\\text{RSMT}=11$ 与该定理一致。\n\n**4. 总结与定量比较**\n\n计算出的线长为：\n-   $\\text{HPWL} = 11 \\, \\mu m$\n-   $\\text{MST} = 13 \\, \\mu m$\n-   $\\text{RSMT} = 11 \\, \\mu m$\n\n有序三元组 $(\\text{HPWL}, \\text{MST}, \\text{RSMT})$ 是 $(11, 13, 11)$。\n\n线长估计中的一个关键关系是 $\\text{RSMT} \\le \\text{MST}$。RSMT 代表了真实的最小线长，而 MST 提供了一个计算简单的上界。在我们的例子中，$\\text{RSMT} = 11 \\, \\mu m$，而 $\\text{MST} = 13 \\, \\mu m$。引入斯坦纳点使得长度减少了 $2 \\, \\mu m$，与 MST 长度相比，这是一个 $15.4\\%$ 的改进 $(\\frac{13-11}{13} \\approx 0.154)$。比率 $\\frac{\\text{MST}}{\\text{RSMT}} = \\frac{13}{11} \\approx 1.1818$，这完全在直线斯坦纳比率的理论最大值 $\\frac{3}{2}=1.5$ 的范围内。HPWL 指标在计算上最为简单，在 $n=3$ 个引脚的情况下，它为 RSMT 提供了精确值。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n11  13  11\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从衡量转向优化，我们来探索最早也是最具影响力的解析布局技术之一：二次布局。这个问题展示了如何通过使用平方距离目标函数，将最小化线长这一复杂的几何目标转化为一个简单、可解的线性方程组。完成这个例子可以巩固对物理布局问题与其优雅的线性代数数学表达之间联系的理解。",
            "id": "4289739",
            "problem": "考虑一个用于集成电路 (IC) 布局的电子设计自动化 (EDA) 中的二次布局模型，其中网表由一个带权无向图表示，其权重为 $w_{ij}$，并且输入/输出 (IO) 引脚的坐标是固定的。设二次线长度量定义在无向边集合上，其形式为\n$$\nE \\;=\\; \\sum_{(i,j)\\in \\mathcal{E}} w_{ij}\\left[(x_i - x_j)^{2} + (y_i - y_j)^{2}\\right],\n$$\n其中 $(x_i,y_i)$ 是节点 $i$ 的坐标，求和对每条无向边计算一次。\n\n设顶点集为 $\\mathcal{V} = \\{1,2,3,4,5\\}$，其中内部（自由）节点为 $\\{1,2,3\\}$，固定 IO 节点为 $\\{4,5\\}$。固定的 IO 坐标为\n- 节点 $4$：$(x_4,y_4) = (0,0)$，\n- 节点 $5$：$(x_5,y_5) = (8,4)$。\n\n无向边及其对称权重 $w_{ij} = w_{ji}$ 如下：\n- 边 $(1,4)$，权重 $w_{14} = 2$，\n- 边 $(1,2)$，权重 $w_{12} = 1$，\n- 边 $(1,3)$，权重 $w_{13} = 1$，\n- 边 $(2,3)$，权重 $w_{23} = 1$，\n- 边 $(2,5)$，权重 $w_{25} = 1$，\n- 边 $(3,5)$，权重 $w_{35} = 2$。\n\n仅从给定的二次线长定义以及自由坐标的最小值点满足通过对内部节点的 $(x_i,y_i)$ 求导得到的一阶最优性条件这一原理出发，完成以下任务：\n\n- 推导出自由节点坐标必须满足的线性系统，并构建内部系数矩阵以及包含固定 IO 贡献的右端项。\n- 使用你选择的直接法（例如，高斯消元法）求解此线性系统，以得到 $(x_1,y_1)$、$(x_2,y_2)$ 和 $(x_3,y_3)$。\n- 计算最终的二次线长 $E$。\n\n仅报告 $E$ 的最终值，形式为一个精确的实数。如果选择化简为单个分数，请以最简形式表示。不需要四舍五入，也不需要报告单位。",
            "solution": "用户希望解决一个二次布局问题，该问题涉及最小化二次线长度量，以确定电路布局中自由节点的最优坐标。\n\n### 第 1 步：问题验证\n\n**1.1. 提取已知条件**\n\n- **目标函数：** 待最小化的二次线长为 $E = \\sum_{(i,j)\\in \\mathcal{E}} w_{ij}\\left[(x_i - x_j)^{2} + (y_i - y_j)^{2}\\right]$。\n- **顶点集：** $\\mathcal{V} = \\{1,2,3,4,5\\}$。\n- **内部（自由）节点：** $\\mathcal{F} = \\{1,2,3\\}$。坐标 $(x_1,y_1), (x_2,y_2), (x_3,y_3)$ 待确定。\n- **固定 (IO) 节点：** $\\mathcal{P} = \\{4,5\\}$。\n- **固定坐标：**\n  - 节点 $4$：$(x_4,y_4) = (0,0)$。\n  - 节点 $5$：$(x_5,y_5) = (8,4)$。\n- **边集 $\\mathcal{E}$ 和权重 $w_{ij}$：**\n  - $w_{14} = 2$。\n  - $w_{12} = 1$。\n  - $w_{13} = 1$。\n  - $w_{23} = 1$。\n  - $w_{25} = 1$。\n  - $w_{35} = 2$。\n  所有未列出边的权重 $w_{ij}$ 均为 0。权重是对称的，$w_{ij}=w_{ji}$。\n\n**1.2. 使用提取的已知条件进行验证**\n\n- **科学依据：** 该问题描述了二次布局，这是超大规模集成 (VLSI) 电路设计的电子设计自动化 (EDA) 领域中的一种标准和基础技术。使用二次目标函数并通过求解由一阶最优性条件推导出的线性系统来对其进行最小化，是一种基于微积分和线性代数的核心、成熟的方法。该方法在科学上是合理的。\n- **适定性：** 该问题指定了一个待最小化的凸二次目标函数。自由节点与固定节点之间的连接确保了相应的线性系统有唯一、稳定的解。所有必要的数据（图结构、权重、固定坐标）都已提供。该问题是适定的。\n- **客观性：** 该问题使用精确的数学定义和数值进行陈述，没有任何主观或模糊的语言。\n\n**1.3. 结论与行动**\n\n该问题是有效的，因为它有科学依据、适定、客观且完整。适合进行求解。\n\n### 第 2 步：推导与求解\n\n总线长 $E$ 可以分解为两个独立的和，一个用于 x 坐标 ($E_x$)，另一个用于 y 坐标 ($E_y$)：\n$$ E_x = \\sum_{(i,j)\\in \\mathcal{E}} w_{ij}(x_i - x_j)^2 $$\n$$ E_y = \\sum_{(i,j)\\in \\mathcal{E}} w_{ij}(y_i - y_j)^2 $$\n$$ E = E_x + E_y $$\n为了找到最小化 $E$ 的坐标 $(x_1, x_2, x_3)$ 和 $(y_1, y_2, y_3)$，我们必须满足一阶最优性条件。这意味着将 $E$ 对每个自由坐标的偏导数设为零。由于 $E_x$ 仅依赖于 x 坐标，$E_y$ 仅依赖于 y 坐标，我们可以对每个维度独立求解。\n\n**2.1. x 坐标的方程组**\n\nx 坐标的最优性条件是，对于每个自由节点 $k \\in \\{1,2,3\\}$，有 $\\frac{\\partial E_x}{\\partial x_k} = 0$。\n偏导数的一般形式是：\n$$ \\frac{\\partial E_x}{\\partial x_k} = \\frac{\\partial}{\\partial x_k} \\sum_{(i,j)\\in \\mathcal{E}} w_{ij}(x_i - x_j)^2 = \\sum_{j \\text{ s.t. } (k,j)\\in\\mathcal{E}} 2 w_{kj}(x_k - x_j) = 0 $$\n这可以简化为：\n$$ \\left(\\sum_{j \\text{ s.t. } (k,j)\\in\\mathcal{E}} w_{kj}\\right)x_k - \\sum_{j \\text{ s.t. } (k,j)\\in\\mathcal{E}} w_{kj}x_j = 0 $$\n我们将此应用于每个自由节点：\n- 对于 $k=1$：邻接点为 $\\{2,3,4\\}$。\n  $ (w_{12}+w_{13}+w_{14})x_1 - w_{12}x_2 - w_{13}x_3 = w_{14}x_4 $\n  $ (1+1+2)x_1 - 1 \\cdot x_2 - 1 \\cdot x_3 = 2 \\cdot x_4 \\implies 4x_1 - x_2 - x_3 = 2x_4 $\n- 对于 $k=2$：邻接点为 $\\{1,3,5\\}$。\n  $ (w_{21}+w_{23}+w_{25})x_2 - w_{21}x_1 - w_{23}x_3 = w_{25}x_5 $\n  $ (1+1+1)x_2 - 1 \\cdot x_1 - 1 \\cdot x_3 = 1 \\cdot x_5 \\implies -x_1 + 3x_2 - x_3 = x_5 $\n- 对于 $k=3$：邻接点为 $\\{1,2,5\\}$。\n  $ (w_{31}+w_{32}+w_{35})x_3 - w_{31}x_1 - w_{32}x_2 = w_{35}x_5 $\n  $ (1+1+2)x_3 - 1 \\cdot x_1 - 1 \\cdot x_2 = 2 \\cdot x_5 \\implies -x_1 - x_2 + 4x_3 = 2x_5 $\n\n代入固定坐标 $x_4=0$ 和 $x_5=8$：\n$$\n\\begin{cases}\n4x_1 - x_2 - x_3 = 2(0) = 0 \\\\\n-x_1 + 3x_2 - x_3 = 8 \\\\\n-x_1 - x_2 + 4x_3 = 2(8) = 16\n\\end{cases}\n$$\n写成矩阵形式 $A\\mathbf{x} = \\mathbf{b}_x$：\n$$\n\\begin{pmatrix} 4  -1  -1 \\\\ -1  3  -1 \\\\ -1  -1  4 \\end{pmatrix}\n\\begin{pmatrix} x_1 \\\\ x_2 \\\\ x_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 8 \\\\ 16 \\end{pmatrix}\n$$\n内部系数矩阵为 $A = \\begin{pmatrix} 4  -1  -1 \\\\ -1  3  -1 \\\\ -1  -1  4 \\end{pmatrix}$，右端项为 $\\mathbf{b}_x = \\begin{pmatrix} 0 \\\\ 8 \\\\ 16 \\end{pmatrix}$。\n\n**2.2. y 坐标的方程组**\n\ny 坐标方程的结构是相同的。线性系统为 $A\\mathbf{y} = \\mathbf{b}_y$。矩阵 $A$ 相同。右端项 $\\mathbf{b}_y$ 使用固定的 y 坐标 $y_4=0$ 和 $y_5=4$ 构成：\n$$ \\mathbf{b}_y = \\begin{pmatrix} w_{14}y_4 \\\\ w_{25}y_5 \\\\ w_{35}y_5 \\end{pmatrix} = \\begin{pmatrix} 2(0) \\\\ 1(4) \\\\ 2(4) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 4 \\\\ 8 \\end{pmatrix} $$\n所以 y 的系统是：\n$$\n\\begin{pmatrix} 4  -1  -1 \\\\ -1  3  -1 \\\\ -1  -1  4 \\end{pmatrix}\n\\begin{pmatrix} y_1 \\\\ y_2 \\\\ y_3 \\end{pmatrix}\n=\n\\begin{pmatrix} 0 \\\\ 4 \\\\ 8 \\end{pmatrix}\n$$\n\n**2.3. 求解线性系统**\n\n我们使用高斯消元法求解 $\\mathbf{x}$ 的系统。增广矩阵为：\n$$ \\left[ \\begin{array}{ccc|c} 4  -1  -1  0 \\\\ -1  3  -1  8 \\\\ -1  -1  4  16 \\end{array} \\right] $$\n进行行变换：$R_2 \\to 4R_2 + R_1$ 和 $R_3 \\to 4R_3 + R_1$。\n$$ \\left[ \\begin{array}{ccc|c} 4  -1  -1  0 \\\\ 0  11  -5  32 \\\\ 0  -5  15  64 \\end{array} \\right] $$\n进行行变换：$R_3 \\to 11R_3 + 5R_2$。\n$$ \\left[ \\begin{array}{ccc|c} 4  -1  -1  0 \\\\ 0  11  -5  32 \\\\ 0  0  140  864 \\end{array} \\right] $$\n使用回代法求解：\n$140x_3 = 864 \\implies x_3 = \\frac{864}{140} = \\frac{216}{35}$。\n$11x_2 - 5x_3 = 32 \\implies 11x_2 = 32 + 5(\\frac{216}{35}) = 32 + \\frac{216}{7} = \\frac{224+216}{7} = \\frac{440}{7} \\implies x_2 = \\frac{40}{7}$。\n$4x_1 - x_2 - x_3 = 0 \\implies 4x_1 = x_2 + x_3 = \\frac{40}{7} + \\frac{216}{35} = \\frac{200+216}{35} = \\frac{416}{35} \\implies x_1 = \\frac{104}{35}$。\n所以，$(x_1, x_2, x_3) = (\\frac{104}{35}, \\frac{40}{7}, \\frac{216}{35})$。\n\n对于 y 坐标，我们观察到 $\\mathbf{b}_y = \\frac{1}{2}\\mathbf{b}_x$。由于系统的线性性，解将是 $\\mathbf{y} = \\frac{1}{2}\\mathbf{x}$。\n$(y_1, y_2, y_3) = (\\frac{1}{2}\\frac{104}{35}, \\frac{1}{2}\\frac{40}{7}, \\frac{1}{2}\\frac{216}{35}) = (\\frac{52}{35}, \\frac{20}{7}, \\frac{108}{35})$。\n\n**2.4. 计算最终线长 E**\n\n最小值点的线长值可以被计算出来。我们可以证明 $E_x = \\sum_{i \\in \\text{fixed}} x_i \\sum_{j \\text{ s.t. } (i,j)\\in\\mathcal{E}} w_{ij}(x_i-x_j)$。\n固定节点是 $4$ 和 $5$。节点 $4$ 连接到 $1$，节点 $5$ 连接到 $2$ 和 $3$。\n$$ E_x = x_4 \\cdot w_{41}(x_4 - x_1) + x_5 \\cdot \\left[ w_{52}(x_5-x_2) + w_{53}(x_5-x_3) \\right] $$\n有 $x_4=0$ 和 $x_5=8$：\n$$ E_x = 0 + 8 \\cdot \\left[ 1(8-x_2) + 2(8-x_3) \\right] = 8 \\cdot (8 - x_2 + 16 - 2x_3) = 8 \\cdot (24 - x_2 - 2x_3) $$\n代入 $x_2$ 和 $x_3$ 的值：\n$$ E_x = 8 \\left( 24 - \\frac{40}{7} - 2\\frac{216}{35} \\right) = 8 \\left( \\frac{24 \\cdot 35}{35} - \\frac{40 \\cdot 5}{35} - \\frac{432}{35} \\right) $$\n$$ E_x = 8 \\left( \\frac{840 - 200 - 432}{35} \\right) = 8 \\left( \\frac{208}{35} \\right) = \\frac{1664}{35} $$\n类似地，对于 $E_y$，有 $y_4=0$ 和 $y_5=4$：\n$$ E_y = 0 + 4 \\cdot \\left[ 1(4-y_2) + 2(4-y_3) \\right] = 4 \\cdot (12 - y_2 - 2y_3) $$\n代入 $y_2$ 和 $y_3$ 的值：\n$$ E_y = 4 \\left( 12 - \\frac{20}{7} - 2\\frac{108}{35} \\right) = 4 \\left( \\frac{12 \\cdot 35}{35} - \\frac{20 \\cdot 5}{35} - \\frac{216}{35} \\right) $$\n$$ E_y = 4 \\left( \\frac{420 - 100 - 216}{35} \\right) = 4 \\left( \\frac{104}{35} \\right) = \\frac{416}{35} $$\n总二次线长是两部分之和：\n$$ E = E_x + E_y = \\frac{1664}{35} + \\frac{416}{35} = \\frac{2080}{35} $$\n通过将分子和分母除以它们的最大公约数 $5$ 来化简分数：\n$$ E = \\frac{2080 \\div 5}{35 \\div 5} = \\frac{416}{7} $$\n该分数是不可约的，因为 $416 = 2^5 \\cdot 13$。",
            "answer": "$$\n\\boxed{\\frac{416}{7}}\n$$"
        },
        {
            "introduction": "尽管二次布局很高效，但其线长模型是一个粗略的代理。现代布局器力求更直接地优化如HPWL这样更精确的度量。本练习直面HPWL的核心挑战——其不可微性——并介绍了优雅的对数和指数 (Log-Sum-Exp, LSE) 平滑解决方案。通过计算平滑LSE模型的梯度并与真实HPWL的方向进行比较，您将深入了解现代非线性优化器如何有效地最小化一个与HPWL高度近似的目标函数。",
            "id": "4289692",
            "problem": "考虑解析布局中的一个线网，其有四个引脚，笛卡尔坐标 $\\{(x_i,y_i)\\}_{i=1}^{4}$ 为 $(x_1,y_1)=(-1,1)$，$(x_2,y_2)=(0,0)$，$(x_3,y_3)=(1,2)$ 及 $(x_4,y_4)=(2,-1)$。对于一个引脚坐标为 $\\{(x_i,y_i)\\}$ 的线网，其精确的半周长线长 (HPWL) 由基本公式 $\\mathrm{HPWL} = \\left(\\max_i x_i - \\min_i x_i\\right) + \\left(\\max_i y_i - \\min_i y_i\\right)$ 定义。在电子设计自动化 (EDA) 领域，max 函数的一个广泛使用的可微近似是“对数和指数”(Log-Sum-Exp) 方法。对于集合 $\\{u_i\\}$ 和平滑参数 $\\alpha>0$，该近似由 $\\max_i u_i \\approx \\alpha \\ln\\!\\left(\\sum_i \\exp(u_i/\\alpha)\\right)$ 和 $\\min_i u_i \\approx -\\alpha \\ln\\!\\left(\\sum_i \\exp(-u_i/\\alpha)\\right)$ 给出。以此为基础，单个线网的平滑线长目标函数定义为\n$$\nH_{\\alpha}(\\{(x_i,y_i)\\}) \\;=\\; \\alpha \\ln\\!\\Big(\\sum_{i=1}^{n} \\exp(x_i/\\alpha)\\Big) \\;+\\; \\alpha \\ln\\!\\Big(\\sum_{i=1}^{n} \\exp(-x_i/\\alpha)\\Big) \\;+\\; \\alpha \\ln\\!\\Big(\\sum_{i=1}^{n} \\exp(y_i/\\alpha)\\Big) \\;+\\; \\alpha \\ln\\!\\Big(\\sum_{i=1}^{n} \\exp(-y_i/\\alpha)\\Big).\n$$\n设平滑参数为 $\\alpha=1$。\n\n任务：\n- 根据定义计算精确的 $\\mathrm{HPWL}$。\n- 在给定的引脚位置处，数值计算 $H_{\\alpha}$ 的值。\n- 推导 $H_{\\alpha}$ 相对于所有引脚坐标的梯度 $\\nabla H_{\\alpha}$，并在给定的引脚位置处进行数值计算。使用应用于 $\\alpha\\ln(\\sum \\exp(\\cdot/\\alpha))$ 的微分第一性原理。\n- 在给定的配置下，选择一个 $\\mathrm{HPWL}$ 的有效次梯度。方法是：在每个坐标维度上，对唯一的最大值点取 $+1$，对唯一的最小值点取 $-1$，其他情况取 $0$。\n- 通过串联 $\\nabla H_{\\alpha}$ 和所选的 $\\mathrm{HPWL}$ 次梯度的每个引脚分量，构建 $2n$ 维向量。计算这两个向量之间夹角的余弦值。\n\n仅报告余弦值作为最终答案。将答案四舍五入到四位有效数字。不需要单位。",
            "solution": "问题陈述经评估有效。其科学基础在于电子设计自动化 (EDA) 领域，特别是关于解析布局技术。半周长线长 (HPWL) 及其对数-和-指数 (LSE) 近似的定义是标准且正确的。所有必要的数据和参数均已提供，任务定义明确且在数学上是可解的。不存在矛盾、歧义或事实错误。\n\n该问题需要基于给定的引脚位置和参数进行一系列计算。四个引脚的坐标集合为 $\\{(x_i,y_i)\\}_{i=1}^{4}$：$P_1(-1,1)$、$P_2(0,0)$、$P_3(1,2)$ 和 $P_4(2,-1)$。平滑参数给定为 $\\alpha=1$。\n\n首先，我们计算精确的 HPWL。x 坐标集合为 $\\{x_i\\} = \\{-1, 0, 1, 2\\}$，y 坐标集合为 $\\{y_i\\} = \\{1, 0, 2, -1\\}$。\n边界框由这些坐标的最小值和最大值确定。\n$\\max_i x_i = 2$\n$\\min_i x_i = -1$\n$\\max_i y_i = 2$\n$\\min_i y_i = -1$\n精确的 HPWL 为：\n$$ \\mathrm{HPWL} = (\\max_i x_i - \\min_i x_i) + (\\max_i y_i - \\min_i y_i) = (2 - (-1)) + (2 - (-1)) = 3 + 3 = 6 $$\n\n接下来，我们计算平滑线长目标函数 $H_{\\alpha}$ 在 $\\alpha=1$ 时的值。该函数为：\n$$ H_{1}(\\{(x_i,y_i)\\}) = \\ln\\Big(\\sum_{i=1}^{4} \\exp(x_i)\\Big) + \\ln\\Big(\\sum_{i=1}^{4} \\exp(-x_i)\\Big) + \\ln\\Big(\\sum_{i=1}^{4} \\exp(y_i)\\Big) + \\ln\\Big(\\sum_{i=1}^{4} \\exp(-y_i)\\Big) $$\n这个计算对于最终答案来说不是严格必需的，但它是问题任务的一部分。\n\n问题的核心涉及 $H_{\\alpha}$ 的梯度。让我们首先推导关于引脚坐标 $(x_k, y_k)$ 的偏导数的一般形式。\n函数 $H_{\\alpha}$ 可以分解为 x 和 y 两个分量：$H_{\\alpha} = H_{\\alpha,x}(\\mathbf{x}) + H_{\\alpha,y}(\\mathbf{y})$。\n关于 $x_k$ 的偏导数为：\n$$ \\frac{\\partial H_{\\alpha}}{\\partial x_k} = \\frac{\\partial}{\\partial x_k} \\left[ \\alpha \\ln\\Big(\\sum_i \\exp(x_i/\\alpha)\\Big) + \\alpha \\ln\\Big(\\sum_i \\exp(-x_i/\\alpha)\\Big) \\right] $$\n使用链式法则，$\\frac{d}{du}\\ln(f(u)) = \\frac{f'(u)}{f(u)}$，我们得到：\n$$ \\frac{\\partial H_{\\alpha}}{\\partial x_k} = \\alpha \\frac{\\frac{1}{\\alpha}\\exp(x_k/\\alpha)}{\\sum_i \\exp(x_i/\\alpha)} + \\alpha \\frac{-\\frac{1}{\\alpha}\\exp(-x_k/\\alpha)}{\\sum_i \\exp(-x_i/\\alpha)} = \\frac{\\exp(x_k/\\alpha)}{\\sum_i \\exp(x_i/\\alpha)} - \\frac{\\exp(-x_k/\\alpha)}{\\sum_i \\exp(-x_i/\\alpha)} $$\n类似地，关于 $y_k$ 的偏导数为：\n$$ \\frac{\\partial H_{\\alpha}}{\\partial y_k} = \\frac{\\exp(y_k/\\alpha)}{\\sum_i \\exp(y_i/\\alpha)} - \\frac{\\exp(-y_k/\\alpha)}{\\sum_i \\exp(-y_i/\\alpha)} $$\n对于我们的问题，$\\alpha=1$。我们必须为每个引脚计算这些表达式的值。让我们首先计算总和。\n对于 x 坐标 $\\{-1, 0, 1, 2\\}$：\n$S_x^+ = \\sum_i \\exp(x_i) = \\exp(-1) + \\exp(0) + \\exp(1) + \\exp(2) = e^{-1} + 1 + e + e^2 \\approx 11.475217$\n$S_x^- = \\sum_i \\exp(-x_i) = \\exp(1) + \\exp(0) + \\exp(-1) + \\exp(-2) = e + 1 + e^{-1} + e^{-2} \\approx 4.221496$\n对于 y 坐标 $\\{1, 0, 2, -1\\}$：\n$S_y^+ = \\sum_i \\exp(y_i) = \\exp(1) + \\exp(0) + \\exp(2) + \\exp(-1) = e + 1 + e^2 + e^{-1} \\approx 11.475217$\n$S_y^- = \\sum_i \\exp(-y_i) = \\exp(-1) + \\exp(0) + \\exp(-2) + \\exp(1) = e^{-1} + 1 + e^{-2} + e \\approx 4.221496$\n\n令 $\\vec{G} = \\nabla H_{1}$ 为 8 维梯度向量，其分量按引脚串联而成 $(\\frac{\\partial H_1}{\\partial x_1}, \\frac{\\partial H_1}{\\partial y_1}, \\dots, \\frac{\\partial H_1}{\\partial x_4}, \\frac{\\partial H_1}{\\partial y_4})$。\n$G_{x_k} = \\frac{\\exp(x_k)}{S_x^+} - \\frac{\\exp(-x_k)}{S_x^-}$ 且 $G_{y_k} = \\frac{\\exp(y_k)}{S_y^+} - \\frac{\\exp(-y_k)}{S_y^-}$。\n引脚 $1$ $(-1, 1)$：\n$G_{x_1} = \\frac{\\exp(-1)}{11.475217} - \\frac{\\exp(1)}{4.221496} \\approx 0.032059 - 0.643912 = -0.611853$\n$G_{y_1} = \\frac{\\exp(1)}{11.475217} - \\frac{\\exp(-1)}{4.221496} \\approx 0.236883 - 0.087144 = 0.149739$\n引脚 $2$ $(0, 0)$：\n$G_{x_2} = \\frac{\\exp(0)}{11.475217} - \\frac{\\exp(0)}{4.221496} \\approx 0.087144 - 0.236883 = -0.149739$\n$G_{y_2} = \\frac{\\exp(0)}{11.475217} - \\frac{\\exp(0)}{4.221496} \\approx -0.149739$\n引脚 $3$ $(1, 2)$：\n$G_{x_3} = \\frac{\\exp(1)}{11.475217} - \\frac{\\exp(-1)}{4.221496} \\approx 0.236883 - 0.087144 = 0.149739$\n$G_{y_3} = \\frac{\\exp(2)}{11.475217} - \\frac{\\exp(-2)}{4.221496} \\approx 0.643912 - 0.032059 = 0.611853$\n引脚 $4$ $(2, -1)$：\n$G_{x_4} = \\frac{\\exp(2)}{11.475217} - \\frac{\\exp(-2)}{4.221496} \\approx 0.643912 - 0.032059 = 0.611853$\n$G_{y_4} = \\frac{\\exp(-1)}{11.475217} - \\frac{\\exp(1)}{4.221496} \\approx 0.032059 - 0.643912 = -0.611853$\n梯度向量为 $\\vec{G} \\approx (-0.611853, 0.149739, -0.149739, -0.149739, 0.149739, 0.611853, 0.611853, -0.611853)$。\n\n接下来，我们确定 HPWL 的指定次梯度。规则是，在每个坐标维度上，为唯一的最大值点分配 $+1$，为唯一的最小值点分配 $-1$，其他情况分配 $0$。\n对于 x 坐标 $\\{-1, 0, 1, 2\\}$，唯一的最小值点是 $x_1=-1$，唯一的最大值点是 $x_4=2$。\n对于 y 坐标 $\\{1, 0, 2, -1\\}$，唯一的最小值点是 $y_4=-1$，唯一的最大值点是 $y_3=2$。\n令 $\\vec{s}$ 为次梯度向量。\n$s_{x_1} = -1$, $s_{x_2}=0$, $s_{x_3}=0$, $s_{x_4}=1$。\n$s_{y_1} = 0$, $s_{y_2}=0$, $s_{y_3}=1$, $s_{y_4}=-1$。\n按引脚串联：\n引脚 $1$：$(s_{x_1}, s_{y_1}) = (-1, 0)$\n引脚 $2$：$(s_{x_2}, s_{y_2}) = (0, 0)$\n引脚 $3$：$(s_{x_3}, s_{y_3}) = (0, 1)$\n引脚 $4$：$(s_{x_4}, s_{y_4}) = (1, -1)$\n次梯度向量为 $\\vec{s} = (-1, 0, 0, 0, 0, 1, 1, -1)$。\n\n最后，我们计算 $\\vec{G}$ 和 $\\vec{s}$ 之间夹角 $\\theta$ 的余弦值。\n$\\cos(\\theta) = \\frac{\\vec{G} \\cdot \\vec{s}}{\\|\\vec{G}\\| \\|\\vec{s}\\|}$。\n点积为：\n$\\vec{G} \\cdot \\vec{s} = G_{x_1}(-1) + G_{y_3}(1) + G_{x_4}(1) + G_{y_4}(-1)$\n$\\vec{G} \\cdot \\vec{s} \\approx (-0.611853)(-1) + (0.611853)(1) + (0.611853)(1) + (-0.611853)(-1)$\n$\\vec{G} \\cdot \\vec{s} \\approx 0.611853 + 0.611853 + 0.611853 + 0.611853 = 4 \\times 0.611853 = 2.447412$\n\n$\\vec{s}$ 的范数为 $\\|\\vec{s}\\| = \\sqrt{(-1)^2 + 0^2 + \\dots + 1^2 + (-1)^2} = \\sqrt{1+1+1+1} = \\sqrt{4} = 2$。\n$\\vec{G}$ 的范数为 $\\|\\vec{G}\\| = \\sqrt{\\sum_i G_i^2}$。\n$\\|\\vec{G}\\|^2 = G_{x_1}^2 + G_{y_1}^2 + G_{x_2}^2 + G_{y_2}^2 + G_{x_3}^2 + G_{y_3}^2 + G_{x_4}^2 + G_{y_4}^2$\n$\\|\\vec{G}\\|^2 \\approx (-0.611853)^2 + (0.149739)^2 + (-0.149739)^2 + (-0.149739)^2 + (0.149739)^2 + (0.611853)^2 + (0.611853)^2 + (-0.611853)^2$\n$\\|\\vec{G}\\|^2 \\approx 4 \\times (0.611853)^2 + 4 \\times (0.149739)^2$\n$\\|\\vec{G}\\|^2 \\approx 4 \\times 0.374364 + 4 \\times 0.022422 = 4 \\times (0.374364 + 0.022422) = 4 \\times 0.396786 = 1.587144$\n$\\|\\vec{G}\\| \\approx \\sqrt{1.587144} \\approx 1.259819$\n\n夹角的余弦值为：\n$\\cos(\\theta) \\approx \\frac{2.447412}{1.259819 \\times 2} = \\frac{2.447412}{2.519638} \\approx 0.971335$\n四舍五入到四位有效数字，该值为 $0.9713$。",
            "answer": "$$\\boxed{0.9713}$$"
        }
    ]
}