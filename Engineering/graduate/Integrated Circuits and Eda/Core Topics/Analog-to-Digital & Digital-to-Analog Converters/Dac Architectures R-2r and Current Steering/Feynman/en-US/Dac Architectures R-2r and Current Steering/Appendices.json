{
    "hands_on_practices": [
        {
            "introduction": "The choice between an R-2R and a current-steering DAC architecture involves fundamental trade-offs. This first practice explores a critical distinction: the impedance presented to the reference voltage buffer. By analyzing the code-dependent loading of a current-steering DAC and contrasting it with the constant input resistance of an R-2R ladder, you will gain insight into how architectural choices impact the stability and design of crucial support circuitry like reference buffers .",
            "id": "4262635",
            "problem": "Consider two digital-to-analog converter (DAC) architectures sharing a common precision reference buffer node: (i) a segmented current-steering front-end and (ii) an ideal resistive R-2R ladder. In the current-steering front-end, the most-significant segment is an 8-bit thermometer-coded array of 256 identical unit current sources, each sourcing a current of $I_{u} = 100~\\mu\\text{A}$ from the reference node when its switch is asserted. Let the random variable $M \\in \\{0,1,2,\\dots,255\\}$ denote the number of asserted unit sources. The code statistics are such that the probability mass function is proportional to an exponential in the occupancy:\n$$\np(M=m) = \\kappa \\exp(-\\alpha m), \\quad m=0,1,\\dots,255,\n$$\nwhere $\\alpha = \\ln(2)/64$ and the normalization constant $\\kappa$ ensures $\\sum_{m=0}^{255} p(M=m) = 1$. The number of asserted sources is independent across conversion cycles, and the unit sources are assumed ideal with infinite small-signal output impedance. Using first principles of discrete expectation and linear circuit loading, compute the expected input current drawn from the reference node by this thermometer-coded segment.\n\nSeparately, analyze the ideal resistive R-2R ladder under the same reference buffer, where the ladder is driven by a reference voltage. Starting from linear resistive network invariance and Thevenin-Norton equivalence, argue why the input resistance seen by the reference buffer is constant and equal to $R$ for any digital code configuration. Using small-signal linearization of the reference buffer output stage with output resistance $R_{s}$ and total effective output capacitance $C_{\\text{out}}$ to ground, explain how this constant load simplifies stability assessment by yielding a code-invariant dominant pole. No numerical stability analysis is required.\n\nExpress the expected input current from the first part in $\\text{mA}$. Round your answer to four significant figures.",
            "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of digital-to-analog converter design and linear circuit theory, is well-posed with sufficient information for a unique solution, and is expressed in objective, formal language.\n\nThe problem consists of two distinct parts. The first part requires the calculation of an expected value for a current-steering DAC segment. The second part requires a conceptual analysis of an R-2R ladder DAC.\n\n**Part 1: Expected Current of the Thermometer-Coded Segment**\n\nThe total current, $I_{\\text{in}}$, drawn from the reference node by the thermometer-coded segment is the product of the number of asserted unit sources, $M$, and the current of a single unit source, $I_u$.\n$$\nI_{\\text{in}} = M \\cdot I_u\n$$\nWe are asked to compute the expected input current, $E[I_{\\text{in}}]$. By the linearity of expectation, and since $I_u$ is a constant, this is:\n$$\nE[I_{\\text{in}}] = E[M \\cdot I_u] = I_u \\cdot E[M]\n$$\nThe primary task is to calculate the expected value, $E[M]$, of the discrete random variable $M$, which can take integer values $m \\in \\{0, 1, 2, \\dots, 255\\}$. The probability mass function (PMF) is given as $p(M=m) = \\kappa \\exp(-\\alpha m)$. This is a truncated geometric distribution.\n\nLet $N = 256$ be the number of possible states for $m$ (from $0$ to $255$). The PMF can be written as:\n$$\np(M=m) = \\kappa \\left( \\exp(-\\alpha) \\right)^m, \\quad m = 0, 1, \\dots, N-1\n$$\nLet $r = \\exp(-\\alpha)$. The PMF is $p(M=m) = \\kappa r^m$. The normalization constant $\\kappa$ is determined by the condition that the sum of all probabilities is $1$:\n$$\n\\sum_{m=0}^{N-1} p(M=m) = \\sum_{m=0}^{N-1} \\kappa r^m = \\kappa \\sum_{m=0}^{N-1} r^m = 1\n$$\nThe sum is a finite geometric series: $\\sum_{m=0}^{N-1} r^m = \\frac{1-r^N}{1-r}$.\nTherefore, $\\kappa = \\frac{1-r}{1-r^N}$.\n\nThe expected value of $M$ is given by:\n$$\nE[M] = \\sum_{m=0}^{N-1} m \\cdot p(M=m) = \\kappa \\sum_{m=0}^{N-1} m r^m\n$$\nThe sum $\\sum_{m=0}^{N-1} m r^m$ can be found using a standard identity for arithmetico-geometric series. A convenient derivation uses calculus:\n$$\n\\sum_{m=0}^{N-1} m r^m = r \\frac{d}{dr} \\left( \\sum_{m=0}^{N-1} r^m \\right) = r \\frac{d}{dr} \\left( \\frac{1-r^N}{1-r} \\right)\n$$\nUsing the quotient rule for differentiation:\n$$\n\\frac{d}{dr} \\left( \\frac{1-r^N}{1-r} \\right) = \\frac{(-Nr^{N-1})(1-r) - (1-r^N)(-1)}{(1-r)^2} = \\frac{-Nr^{N-1} + Nr^N + 1 - r^N}{(1-r)^2}\n$$\nSo, the sum is:\n$$\n\\sum_{m=0}^{N-1} m r^m = r \\left( \\frac{1 - Nr^{N-1} + (N-1)r^N}{(1-r)^2} \\right)\n$$\nSubstituting this and the expression for $\\kappa$ into the formula for $E[M]$:\n$$\nE[M] = \\left(\\frac{1-r}{1-r^N}\\right) \\left( \\frac{r(1 - Nr^{N-1} + (N-1)r^N)}{(1-r)^2} \\right) = \\frac{r(1 - Nr^{N-1} + (N-1)r^N)}{(1-r)(1-r^N)}\n$$\nThis expression can be simplified. Consider the identity $r(1 - Nr^{N-1} + (N-1)r^N) = r(1-r^N) - Nr^N(1-r)$.\nThis leads to a more elegant form for the expectation of a truncated geometric distribution:\n$$\nE[M] = \\frac{r(1-r^N) - Nr^N(1-r)}{(1-r)(1-r^N)} = \\frac{r}{1-r} - \\frac{Nr^N}{1-r^N}\n$$\nThe first term, $\\frac{r}{1-r}$, is the expectation of the corresponding non-truncated geometric distribution, and the second term is a correction for the truncation at $N-1$.\n\nNow, we substitute the given values:\n$I_u = 100~\\mu\\text{A} = 10^{-4}~\\text{A}$\n$N = 256$\n$\\alpha = \\frac{\\ln(2)}{64}$\n$r = \\exp(-\\alpha) = \\exp\\left(-\\frac{\\ln(2)}{64}\\right) = \\left(\\exp(\\ln(2))\\right)^{-1/64} = 2^{-1/64}$\n\nWe also need $r^N$:\n$r^N = (2^{-1/64})^{256} = 2^{-256/64} = 2^{-4} = \\frac{1}{16}$\n\nNow we compute $E[M]$:\n$$\nE[M] = \\frac{2^{-1/64}}{1-2^{-1/64}} - \\frac{256 \\cdot (1/16)}{1-(1/16)} = \\frac{1}{2^{1/64}-1} - \\frac{16}{15/16} = \\frac{1}{2^{1/64}-1} - \\frac{256}{15}\n$$\nUsing a calculator for the numerical value:\n$2^{1/64} \\approx 1.01088911$\n$\\frac{1}{2^{1/64}-1} \\approx \\frac{1}{0.01088911} \\approx 91.83499$\n$\\frac{256}{15} \\approx 17.06667$\n$E[M] \\approx 91.83499 - 17.06667 = 74.76832$\n\nFinally, the expected input current is:\n$$\nE[I_{\\text{in}}] = I_u \\cdot E[M] = (10^{-4}~\\text{A}) \\cdot (74.76832) \\approx 7.476832 \\times 10^{-3}~\\text{A}\n$$\nThis result is $7.476832~\\text{mA}$. The problem requires rounding to four significant figures, which gives $7.477~\\text{mA}$.\n\n**Part 2: Analysis of the Ideal R-2R Ladder**\n\nThe problem asks for an argument, based on linear resistive network principles, for why the input resistance of an ideal R-2R ladder is constant, and how this simplifies stability analysis for a driving buffer.\n\nFirst, consider the input resistance of a standard R-2R ladder. The canonical topology is a chain of horizontal resistors of value $R$ and vertical shunt resistors of value $2R$. At the far end (LSB side), the ladder is terminated with a resistor of value $2R$ to ground. The digital input code is applied via switches at the bottom of each vertical $2R$ resistor, connecting it to one of two ideal voltage sources (e.g., ground and a virtual ground), both of which have zero internal impedance.\n\nThe key property of this network is that the resistance looking into any node along the main trunk of the ladder towards the LSB side is always $2R$. This can be proven by induction, starting from the LSB.\n1. At the LSB node (let's call it node $0$), the resistance looking towards the terminated end is simply the terminating resistor's value, which is $2R$.\n2. Now, consider the next node up, node $1$. The resistance looking from node $1$ towards the LSB side (to the \"right\") is the series combination of the horizontal resistor $R$ and the parallel combination of the network at node $0$. At node $0$, we have its vertical $2R$ leg in parallel with the resistance to its right, which is the terminating $2R$. So the resistance at node $0$ is $2R \\parallel 2R = R$.\n3. The total resistance looking right from node $1$ is therefore $R + (2R \\parallel 2R) = R + R = 2R$.\n4. By induction, this property holds for any node $i$: the resistance looking towards the LSB side from node $i$ is $2R$.\n\nThis structural property's invariance to the digital code is a direct consequence of linear network theory (specifically, the substitution theorem or Thevenin's theorem). When calculating the equivalent resistance of the network, all independent voltage sources are turned off (replaced by short circuits). The switches in the R-2R ladder connect each leg to an ideal voltage source. Since both switch positions connect to a zero-impedance node (ground or virtual ground), the resistance looking down any vertical $2R$ leg is always $2R$, regardless of the digital code.\n\nThe reference voltage, $V_{\\text{ref}}$, drives the ladder at its MSB end. Let's assume $V_{\\text{ref}}$ is connected directly to the MSB node (node $N-1$). The input resistance, $R_{\\text{in}}$, seen by the reference buffer is the resistance looking into this node. This resistance is the parallel combination of the MSB's own vertical $2R$ leg and the resistance of the rest of the ladder to its right. As established by our inductive argument, the resistance of the rest of the ladder is $2R$.\nTherefore, the input resistance is:\n$$\nR_{\\text{in}} = 2R \\parallel 2R = \\frac{(2R)(2R)}{2R+2R} = \\frac{4R^2}{4R} = R\n$$\nThis demonstrates that the input resistance of an ideal R-2R ladder is constant and equal to $R$, independent of the digital code.\n\nThis code-invariant load has a significant positive impact on the stability of the reference buffer driving the DAC. The buffer is modeled with an output resistance $R_s$ and drives a total load capacitance $C_{\\text{out}}$ (which includes parasitic capacitance and the buffer's own output capacitance) in parallel with the DAC's input resistance $R_{\\text{in}}$.\nThe transfer function of this output stage has a pole whose location is determined by the total resistance and capacitance at the output node. The equivalent resistance seen by the capacitor $C_{\\text{out}}$ is $R_s \\parallel R_{\\text{in}}$. The pole's angular frequency, $\\omega_p$, is:\n$$\n\\omega_p = \\frac{1}{(R_s \\parallel R_{\\text{in}})C_{\\text{out}}}\n$$\nFor the R-2R ladder, since $R_{\\text{in}} = R$ (constant), the pole location is fixed:\n$$\n\\omega_p = \\frac{1}{(R_s \\parallel R)C_{\\text{out}}}\n$$\nThis pole is a dominant pole for the buffer's feedback loop. A code-invariant dominant pole means that the phase margin and overall stability of the buffer do not change as the DAC's digital input code changes. The design and compensation of the buffer are greatly simplified, as it only needs to be made stable for one specific, known load impedance ($R$). In contrast, DAC architectures with code-dependent input impedance/capacitance present a load that varies with the input code, causing the loop dynamics and stability margins to change, potentially leading to instability or performance degradation for certain codes.",
            "answer": "$$\\boxed{7.477}$$"
        },
        {
            "introduction": "Beyond static characteristics, a DAC's value is determined by its dynamic performance—how quickly and accurately it can produce a changing signal. This exercise focuses on the trade-offs between speed and precision, governed by the DAC's output time constant, $\\tau$. You will derive the maximum operating frequency by balancing two competing requirements: the time-domain need for the output to settle to a given precision and the frequency-domain need for sufficient signal bandwidth .",
            "id": "4262631",
            "problem": "A segmented current-steering Digital-to-Analog Converter (DAC) drives an external load that can be modeled, over the signal band of interest, by an effective small-signal output resistance $R_o$ and a shunt capacitance $C_L$, forming a first-order linear time-invariant network. The same small-signal model captures the dominant pole behavior that would arise at the output of an R-2R ladder DAC when viewed through its Thevenin equivalent at the output node. The DAC is used to synthesize a sinusoid at frequency $f_{\\mathrm{out}}$ by updating its output code at a uniform rate $f_u = M f_{\\mathrm{out}}$ with non-return-to-zero switching, where $M$ is the number of code updates per sinusoidal period.\n\nYou are given:\n- Resolution $N = 12$ bits.\n- Effective output resistance $R_o = 50$ ohm.\n- Output load capacitance $C_L = 5$ pF.\n- Samples per period $M = 8$.\n- Linearity requirement: for any code transition up to a full-scale step, the residual settling error just before the next update must be strictly less than one half of one least significant bit.\n- In-band flatness requirement: the magnitude response at $f_{\\mathrm{out}}$ must be no less than a fraction $(1 - \\delta)$ of its direct current magnitude, with $\\delta = 0.01$.\n\nStarting from the fundamental properties of a first-order linear time-invariant system’s step response and frequency response and from the definition of least significant bit for an $N$-bit converter, derive closed-form expressions for the two independent upper bounds on $f_{\\mathrm{out}}$ implied by the settling requirement and the in-band flatness requirement, respectively. Then, for the given numerical values, determine the single maximum $f_{\\mathrm{out}}$ that satisfies both bounds simultaneously. Express the final maximum frequency in MHz and round your answer to three significant figures.",
            "solution": "The problem requires the determination of the maximum output signal frequency, $f_{\\mathrm{out}}$, for a Digital-to-Analog Converter (DAC) subject to two independent constraints: a time-domain settling requirement and a frequency-domain flatness requirement. The DAC's output stage is modeled as a first-order linear time-invariant (LTI) system with an output resistance $R_o$ and a load capacitance $C_L$.\n\nFirst, we define the time constant $\\tau$ of this first-order system, which governs both its transient and frequency responses:\n$$\n\\tau = R_o C_L\n$$\nThe transfer function $H(s)$ of this system is:\n$$\nH(s) = \\frac{1}{1 + s\\tau}\n$$\n\n### 1. Settling Requirement\nThe settling requirement dictates the behavior of the DAC's output following a change in the input digital code. The DAC updates its output at a rate $f_u$, so the time available for settling is the update period, $T_u = 1/f_u$. The problem states that $f_u = M f_{\\mathrm{out}}$, so the settling time is $t_{\\mathrm{settle}} = T_u = \\frac{1}{M f_{\\mathrm{out}}}$.\n\nThe response of a first-order system to a step input of magnitude $\\Delta V$ (from an initial voltage $V_i$ to a final voltage $V_f = V_i + \\Delta V$) is given by:\n$$\nV(t) = V_f - (V_f - V_i) \\exp\\left(-\\frac{t}{\\tau}\\right) = V_f - \\Delta V \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\nThe settling error at time $t$ is the difference between the instantaneous voltage and the final voltage:\n$$\nE(t) = |V(t) - V_f| = |\\Delta V| \\exp\\left(-\\frac{t}{\\tau}\\right)\n$$\nThe problem states that for any code transition up to a full-scale step, the residual settling error at the end of the update period, $t_{\\mathrm{settle}} = T_u$, must be less than one half of one least significant bit ($LSB$).\n\nFor an $N$-bit DAC with a full-scale voltage range $V_{FS}$, the $LSB$ voltage is defined as:\n$$\nV_{LSB} = \\frac{V_{FS}}{2^N}\n$$\nThe settling error condition is:\n$$\nE(T_u) < \\frac{1}{2} V_{LSB} = \\frac{1}{2} \\frac{V_{FS}}{2^N} = \\frac{V_{FS}}{2^{N+1}}\n$$\nTo ensure this condition holds for the worst-case scenario, we must consider the largest possible voltage step, which is the full-scale step, $\\Delta V = V_{FS}$. Substituting $\\Delta V = V_{FS}$ and $t = T_u$ into the error equation:\n$$\nV_{FS} \\exp\\left(-\\frac{T_u}{\\tau}\\right) < \\frac{V_{FS}}{2^{N+1}}\n$$\nThe term $V_{FS}$ cancels, which is fortunate as its value is not provided:\n$$\n\\exp\\left(-\\frac{T_u}{\\tau}\\right) < \\frac{1}{2^{N+1}}\n$$\nTaking the natural logarithm of both sides:\n$$\n-\\frac{T_u}{\\tau} < \\ln\\left(\\frac{1}{2^{N+1}}\\right) = -(N+1)\\ln(2)\n$$\nMultiplying by $-1$ reverses the inequality:\n$$\n\\frac{T_u}{\\tau} > (N+1)\\ln(2)\n$$\nNow, we substitute $T_u = \\frac{1}{M f_{\\mathrm{out}}}$ to find the bound on $f_{\\mathrm{out}}$:\n$$\n\\frac{1}{M f_{\\mathrm{out}} \\tau} > (N+1)\\ln(2)\n$$\nSolving for $f_{\\mathrm{out}}$ gives the first upper bound, which we denote as $f_{\\mathrm{out,settle}}$:\n$$\nf_{\\mathrm{out}} < \\frac{1}{M \\tau (N+1)\\ln(2)} \\quad \\implies \\quad f_{\\mathrm{out,settle}} = \\frac{1}{M R_o C_L (N+1)\\ln(2)}\n$$\n\n### 2. In-Band Flatness Requirement\nThe flatness requirement concerns the magnitude of the system's frequency response. The frequency response is $H(j\\omega)$ where $\\omega = 2\\pi f$. The magnitude is:\n$$\n|H(j\\omega)| = \\left|\\frac{1}{1 + j\\omega\\tau}\\right| = \\frac{1}{\\sqrt{1 + (\\omega\\tau)^2}} = \\frac{1}{\\sqrt{1 + (2\\pi f \\tau)^2}}\n$$\nThe DC gain (at $f=0$) is $|H(j0)| = 1$. The flatness requirement states that the magnitude response at the signal frequency $f_{\\mathrm{out}}$ must be no less than a fraction $(1 - \\delta)$ of the DC gain:\n$$\n|H(j2\\pi f_{\\mathrm{out}})| \\ge (1-\\delta) |H(j0)| = 1 - \\delta\n$$\nSubstituting the expression for the magnitude response:\n$$\n\\frac{1}{\\sqrt{1 + (2\\pi f_{\\mathrm{out}} \\tau)^2}} \\ge 1 - \\delta\n$$\nSince both sides are positive, we can invert them, which reverses the inequality:\n$$\n\\sqrt{1 + (2\\pi f_{\\mathrm{out}} \\tau)^2} \\le \\frac{1}{1 - \\delta}\n$$\nSquaring both sides:\n$$\n1 + (2\\pi f_{\\mathrm{out}} \\tau)^2 \\le \\frac{1}{(1 - \\delta)^2}\n$$\n$$\n(2\\pi f_{\\mathrm{out}} \\tau)^2 \\le \\frac{1}{(1 - \\delta)^2} - 1 = \\frac{1 - (1 - \\delta)^2}{(1 - \\delta)^2} = \\frac{1 - (1 - 2\\delta + \\delta^2)}{(1 - \\delta)^2} = \\frac{2\\delta - \\delta^2}{(1 - \\delta)^2}\n$$\nTaking the square root of both sides (and noting all terms are positive):\n$$\n2\\pi f_{\\mathrm{out}} \\tau \\le \\frac{\\sqrt{2\\delta - \\delta^2}}{1 - \\delta}\n$$\nSolving for $f_{\\mathrm{out}}$ gives the second upper bound, which we denote as $f_{\\mathrm{out,flat}}$:\n$$\nf_{\\mathrm{out}} \\le \\frac{1}{2\\pi \\tau} \\frac{\\sqrt{2\\delta - \\delta^2}}{1 - \\delta} \\quad \\implies \\quad f_{\\mathrm{out,flat}} = \\frac{1}{2\\pi R_o C_L} \\frac{\\sqrt{2\\delta - \\delta^2}}{1 - \\delta}\n$$\n\n### 3. Numerical Calculation\nThe maximum frequency $f_{\\mathrm{out,max}}$ must satisfy both constraints simultaneously, so it is the minimum of the two derived bounds:\n$$\nf_{\\mathrm{out,max}} = \\min(f_{\\mathrm{out,settle}}, f_{\\mathrm{out,flat}})\n$$\nWe are given the following values:\n- $N = 12$\n- $R_o = 50 \\, \\Omega$\n- $C_L = 5 \\, \\text{pF} = 5 \\times 10^{-12} \\, \\text{F}$\n- $M = 8$\n- $\\delta = 0.01$\n\nFirst, calculate the time constant $\\tau$:\n$$\n\\tau = R_o C_L = (50) \\times (5 \\times 10^{-12}) = 250 \\times 10^{-12} \\, \\text{s} = 2.5 \\times 10^{-10} \\, \\text{s}\n$$\nNext, calculate $f_{\\mathrm{out,settle}}$:\n$$\nf_{\\mathrm{out,settle}} = \\frac{1}{8 \\times (2.5 \\times 10^{-10}) \\times (12+1) \\ln(2)} = \\frac{1}{2 \\times 10^{-9} \\times 13 \\ln(2)} = \\frac{1}{2.6 \\times 10^{-8} \\ln(2)}\n$$\n$$\nf_{\\mathrm{out,settle}} \\approx \\frac{1}{(2.6 \\times 10^{-8}) \\times 0.69315} \\approx \\frac{1}{1.80219 \\times 10^{-8}} \\approx 5.5488 \\times 10^7 \\, \\text{Hz} = 55.488 \\, \\text{MHz}\n$$\nNow, calculate $f_{\\mathrm{out,flat}}$:\n$$\nf_{\\mathrm{out,flat}} = \\frac{1}{2\\pi (2.5 \\times 10^{-10})} \\frac{\\sqrt{2(0.01) - (0.01)^2}}{1 - 0.01} = \\frac{1}{5\\pi \\times 10^{-10}} \\frac{\\sqrt{0.02 - 0.0001}}{0.99}\n$$\n$$\nf_{\\mathrm{out,flat}} = \\frac{1}{5\\pi \\times 10^{-10}} \\frac{\\sqrt{0.0199}}{0.99} \\approx \\frac{1}{1.5708 \\times 10^{-9}} \\frac{0.14107}{0.99} \\approx (6.3662 \\times 10^8) \\times (0.14249) \\approx 9.0705 \\times 10^7 \\, \\text{Hz} = 90.705 \\, \\text{MHz}\n$$\nFinally, we find the overall maximum frequency:\n$$\nf_{\\mathrm{out,max}} = \\min(55.488 \\, \\text{MHz}, 90.705 \\, \\text{MHz}) = 55.488 \\, \\text{MHz}\n$$\nThe problem asks for the result to be expressed in MHz and rounded to three significant figures.\n$$\nf_{\\mathrm{out,max}} \\approx 55.5 \\, \\text{MHz}\n$$\nThe settling time requirement is the more stringent constraint and limits the maximum output frequency.",
            "answer": "$$\n\\boxed{55.5}\n$$"
        },
        {
            "introduction": "Achieving high precision in a current-steering DAC requires actively compensating for inherent fabrication mismatches in the current sources. This advanced practice puts you in the role of a designer choosing between two powerful correction strategies: analog trimming and digital element selection. By modeling the residual error and the implementation cost in terms of area and power for each method, you will perform a quantitative trade-off analysis that is central to modern integrated circuit design .",
            "id": "4262677",
            "problem": "A current-steering Digital-to-Analog Converter (DAC) requires a precise reference current $I_{\\mathrm{ref}}$ realized from on-chip Metal-Oxide Semiconductor Field-Effect Transistor (MOSFET) current mirrors. Consider two competing architectures to realize the same fractional accuracy target: (A) a single large mirror whose static error is nulled by analog trimming, and (B) the average of $N$ nominally identical unit mirrors combined by digital element selection.\n\nAssume the following physically grounded models and definitions.\n\n- Mismatch follows Pelgrom’s law: the standard deviation of the relative current error for a mirror device of physical area $A$ is $\\sigma_{I}/I = A_{I}/\\sqrt{A}$, where $A_{I}$ is the technology mismatch parameter and $A$ is in the same area units as the unit device area $A_{u}$.\n\n- In architecture (A), the main device has area $A_{m} = \\gamma A_{u}$ with $\\gamma \\geq 1$. Analog trimming uses a $b$-bit current trim with full-scale range equal to $k$ standard deviations of the main device’s fractional error, where $k > 0$. The trim is assumed ideal except for quantization, and the residual trim error is modeled as uniform over one least-significant bit.\n\n- In architecture (B), $N$ statistically independent unit mirrors of area $A_{u}$ are averaged in parallel with digital element selection such that the instantaneous output is the arithmetic mean of their currents. The residual fractional error is then the average of $N$ independent unit errors.\n\n- Normalize area and power to dimensionless quantities: normalized area $a \\triangleq \\text{(physical area)}/A_{u}$ and normalized power $p \\triangleq \\text{(power)}/\\left(V_{\\mathrm{DD}} I_{\\mathrm{ref}}\\right)$. The static power in both architectures is $p_{\\text{static}} = 1$. The analog trim network’s dynamic power is negligible, while the digital element selection incurs additional normalized switching power proportional to the number of elements, $p_{\\text{switch}} = \\beta N$ with $\\beta > 0$. The analog trim hardware area overhead is modeled as $a_{\\text{trim}} = \\alpha 2^{b}$ with $\\alpha > 0$.\n\nDefine a weighted cost $C \\triangleq \\lambda_{a} a + \\lambda_{p} p$ with positive weights $\\lambda_{a} > 0$ and $\\lambda_{p} > 0$. Let $A_{I}$, $A_{u}$, $\\gamma$, $b$, $k$, $\\alpha$, $\\beta$, $\\lambda_{a}$, and $\\lambda_{p}$ be given constants.\n\nStarting from the above first principles only, do the following:\n\n- Derive the residual fractional error variance for architecture (A) due to trim quantization, and for architecture (B) due to averaging of $N$ units.\n\n- Enforce equality of the residual fractional error variances between the two architectures and solve for $N$ in terms of $\\gamma$, $b$, and $k$.\n\n- Using the normalized area and power models, form $C_{A}$ and $C_{B}$, the weighted costs for architectures (A) and (B), respectively, and substitute the $N$ you derived.\n\nWhat is the closed-form analytic expression for the ratio $R \\triangleq C_{B}/C_{A}$ in terms of $\\gamma$, $b$, $k$, $\\alpha$, $\\beta$, $\\lambda_{a}$, and $\\lambda_{p}$? Provide your final answer as a single analytic expression. No numerical evaluation is required.",
            "solution": "The problem statement has been validated and is determined to be a well-posed, scientifically grounded problem in the field of analog integrated circuit design. The derivation of the solution proceeds logically from the provided models and definitions.\n\nThe first step is to derive the residual fractional error variance for each architecture.\n\nFor architecture (A), a single large mirror with analog trimming:\nThe main device has an area of $A_{m} = \\gamma A_{u}$. According to Pelgrom's law, the standard deviation of its fractional current error, denoted $\\sigma_{\\epsilon, A}$, is given by:\n$$\n\\sigma_{\\epsilon, A} = \\frac{A_{I}}{\\sqrt{A_{m}}} = \\frac{A_{I}}{\\sqrt{\\gamma A_{u}}}\n$$\nThe variance of this error is therefore:\n$$\n\\sigma_{\\epsilon, A}^2 = \\frac{A_{I}^2}{\\gamma A_{u}}\n$$\nThe $b$-bit analog trim network has a full-scale range (FSR) equal to $k$ times this standard deviation:\n$$\n\\mathrm{FSR}_{\\mathrm{trim}} = k \\sigma_{\\epsilon, A}\n$$\nThe size of one least-significant bit (LSB) of the trim is:\n$$\n\\mathrm{LSB}_{\\mathrm{trim}} = \\frac{\\mathrm{FSR}_{\\mathrm{trim}}}{2^b} = \\frac{k \\sigma_{\\epsilon, A}}{2^b}\n$$\nThe residual error after trimming is due to quantization and is modeled as a random variable uniformly distributed between $-\\frac{1}{2}\\mathrm{LSB}_{\\mathrm{trim}}$ and $+\\frac{1}{2}\\mathrm{LSB}_{\\mathrm{trim}}$. The variance of a uniform distribution $U(c-d, c+d)$ is $\\frac{(2d)^2}{12} = \\frac{d^2}{3}$. Here, $d = \\frac{1}{2}\\mathrm{LSB}_{\\mathrm{trim}}$, so the variance of the residual fractional error for architecture (A), denoted $\\sigma_{\\mathrm{res}, A}^2$, is:\n$$\n\\sigma_{\\mathrm{res}, A}^2 = \\frac{(\\mathrm{LSB}_{\\mathrm{trim}})^2}{12} = \\frac{1}{12} \\left( \\frac{k \\sigma_{\\epsilon, A}}{2^b} \\right)^2 = \\frac{k^2 \\sigma_{\\epsilon, A}^2}{12 \\cdot (2^b)^2}\n$$\nSubstituting the expression for $\\sigma_{\\epsilon, A}^2$:\n$$\n\\sigma_{\\mathrm{res}, A}^2 = \\frac{k^2}{12 \\cdot 4^b} \\left( \\frac{A_{I}^2}{\\gamma A_{u}} \\right) = \\frac{k^2 A_{I}^2}{12 \\cdot 4^b \\gamma A_{u}}\n$$\n\nFor architecture (B), the average of $N$ unit mirrors:\nEach of the $N$ unit mirrors has an area of $A_u$. The standard deviation of the fractional current error for a single unit mirror, $\\sigma_{\\epsilon, u}$, is given by Pelgrom's law:\n$$\n\\sigma_{\\epsilon, u} = \\frac{A_{I}}{\\sqrt{A_{u}}}\n$$\nThe variance of this unit error is:\n$$\n\\sigma_{\\epsilon, u}^2 = \\frac{A_{I}^2}{A_{u}}\n$$\nThe output is the arithmetic mean of $N$ statistically independent unit mirror currents. The residual fractional error is the average of $N$ independent unit errors. The variance of the average of $N$ independent, identically distributed random variables is the variance of a single variable divided by $N$. Thus, the residual fractional error variance for architecture (B), $\\sigma_{\\mathrm{res}, B}^2$, is:\n$$\n\\sigma_{\\mathrm{res}, B}^2 = \\frac{\\sigma_{\\epsilon, u}^2}{N} = \\frac{1}{N} \\left( \\frac{A_{I}^2}{A_{u}} \\right) = \\frac{A_{I}^2}{N A_{u}}\n$$\n\nThe next step is to enforce the condition of equal residual error variances, $\\sigma_{\\mathrm{res}, A}^2 = \\sigma_{\\mathrm{res}, B}^2$, and solve for $N$:\n$$\n\\frac{k^2 A_{I}^2}{12 \\cdot 4^b \\gamma A_{u}} = \\frac{A_{I}^2}{N A_{u}}\n$$\nThe terms $A_{I}^2$ and $A_{u}$ are non-zero and cancel from both sides:\n$$\n\\frac{k^2}{12 \\cdot 4^b \\gamma} = \\frac{1}{N}\n$$\nSolving for $N$ yields:\n$$\nN = \\frac{12 \\cdot 4^b \\gamma}{k^2}\n$$\n\nNext, we formulate the weighted cost functions $C_{A}$ and $C_{B}$. The cost is defined as $C \\triangleq \\lambda_{a} a + \\lambda_{p} p$.\n\nFor architecture (A):\nThe normalized area $a_A$ is the sum of the main device's normalized area and the trim hardware's normalized area. The main device has physical area $\\gamma A_u$, so its normalized area is $\\gamma$. The trim area is given as $a_{\\mathrm{trim}} = \\alpha 2^b$.\n$$\na_A = \\gamma + \\alpha 2^b\n$$\nThe normalized power $p_A$ consists of the static power $p_{\\text{static}}=1$ and negligible dynamic power from the analog trim.\n$$\np_A = 1\n$$\nThe cost for architecture (A) is:\n$$\nC_A = \\lambda_a a_A + \\lambda_p p_A = \\lambda_a (\\gamma + \\alpha 2^b) + \\lambda_p (1) = \\lambda_a(\\gamma + \\alpha 2^b) + \\lambda_p\n$$\n\nFor architecture (B):\nThe normalized area $a_B$ is the sum of the normalized areas of the $N$ unit mirrors. Each unit mirror has normalized area $1$, so the total is $N$.\n$$\na_B = N\n$$\nThe normalized power $p_B$ is the sum of the static power $p_{\\text{static}}=1$ and the switching power $p_{\\text{switch}} = \\beta N$.\n$$\np_B = 1 + \\beta N\n$$\nThe cost for architecture (B) is:\n$$\nC_B = \\lambda_a a_B + \\lambda_p p_B = \\lambda_a N + \\lambda_p (1 + \\beta N) = \\lambda_p + (\\lambda_a + \\lambda_p \\beta) N\n$$\n\nFinally, we substitute the derived expression for $N$ into the cost $C_B$:\n$$\nC_B = \\lambda_p + (\\lambda_a + \\lambda_p \\beta) \\left( \\frac{12 \\cdot 4^b \\gamma}{k^2} \\right)\n$$\nThe required ratio is $R \\triangleq C_B / C_A$.\n$$\nR = \\frac{C_B}{C_A} = \\frac{\\lambda_p + (\\lambda_a + \\lambda_p \\beta) \\frac{12 \\cdot 4^b \\gamma}{k^2}}{\\lambda_a(\\gamma + \\alpha 2^b) + \\lambda_p}\n$$\nThis is the final closed-form analytic expression for the ratio $R$.",
            "answer": "$$\n\\boxed{\\frac{\\lambda_{p} + (\\lambda_{a} + \\lambda_{p} \\beta) \\frac{12 \\cdot 4^{b} \\gamma}{k^2}}{\\lambda_{a}(\\gamma + \\alpha 2^{b}) + \\lambda_{p}}}\n$$"
        }
    ]
}