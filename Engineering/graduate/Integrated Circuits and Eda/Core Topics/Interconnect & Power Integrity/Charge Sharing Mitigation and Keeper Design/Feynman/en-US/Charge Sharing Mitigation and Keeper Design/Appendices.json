{
    "hands_on_practices": [
        {
            "introduction": "Our first practice involves analyzing the recovery of a dynamic node after a charge-sharing event . This exercise is foundational because it models the keeper transistor as a simple resistor, allowing us to frame the recovery process as a classic first-order $RC$ circuit. By calculating the voltage droop from first principles and then applying the $RC$ time constant model, you will develop a strong intuition for the dynamics of node voltage recovery and the key parameters that govern its speed.",
            "id": "4259385",
            "problem": "A domino-style dynamic logic gate is precharged so that its dynamic node is at voltage $V_{\\mathrm{DD}}$. During the evaluation phase, a benign input glitch momentarily connects the dynamic node to two floating internal diffusion nodes (each isolated by an off transistor) with capacitances $C_{1}$ and $C_{2}$ that were initially at $0$ voltage, causing a charge-sharing event. Immediately after this event, the series stack is non-conductive again, and the internal nodes remain electrically isolated (no further conduction paths exist), while the dynamic node must be restored by a keeper.\n\nAssume:\n- Supply voltage $V_{\\mathrm{DD}} = 1\\ \\mathrm{V}$.\n- Dynamic-node capacitance $C_{\\mathrm{D}} = 12\\ \\mathrm{fF}$.\n- Floating internal capacitances $C_{1} = 3\\ \\mathrm{fF}$ and $C_{2} = 5\\ \\mathrm{fF}$, both initially at $0\\ \\mathrm{V}$ prior to charge sharing.\n- A keeper is a long-channel $p$-channel metal–oxide–semiconductor transistor (PMOS) with source tied to $V_{\\mathrm{DD}}$, drain at the dynamic node, and gate held at $0\\ \\mathrm{V}$ during the hold interval. Neglect body effect and channel-length modulation. Use the long-channel drift–diffusion model in strong inversion and triode region to linearize its current around small $V_{\\mathrm{SD}}$.\n- The PMOS parameters are $\\mu_{p} C_{\\mathrm{ox}} = 100\\ \\mu\\mathrm{A}/\\mathrm{V}^{2}$ and threshold magnitude $|V_{\\mathrm{TP}}| = 0.25\\ \\mathrm{V}$.\n- The minimum channel length is $L = 30\\ \\mathrm{nm}$, and you will size the keeper by choosing its width $W$.\n- After charge sharing, the internal floating nodes remain isolated by off devices, so the keeper only needs to recharge the dynamic-node capacitance $C_{\\mathrm{D}}$.\n- Neglect any pulldown leakage or noise current during the recovery interval.\n\nStarting from fundamental principles (charge conservation for the charge-sharing droop and a first-principles small-signal linearization of the PMOS triode current for the recovery), derive an expression for the minimum keeper width $W$ (for fixed $L$) that guarantees the dynamic node voltage recovers from its post–charge-sharing value to at least $V_{\\mathrm{target}} = 0.9\\,V_{\\mathrm{DD}}$ within a recovery time budget $T = 50\\ \\mathrm{ps}$. Then evaluate this expression numerically using the given parameters.\n\nExpress your final answer as the numerical value of $W$ in micrometers, and round your answer to three significant figures.",
            "solution": "The problem requires determining the minimum width $W$ of a PMOS keeper transistor to restore the voltage on a dynamic node after a charge-sharing event within a specified time. The solution is partitioned into two main stages: first, calculating the voltage drop on the dynamic node due to charge sharing, and second, modeling the recovery process driven by the keeper to derive an expression for its width.\n\n**Step 1: Analysis of the Charge-Sharing Event**\n\nInitially, the dynamic node, with capacitance $C_{\\mathrm{D}}$, is charged to the supply voltage $V_{\\mathrm{DD}}$. The total charge stored on this node is:\n$$Q_{\\mathrm{initial}} = C_{\\mathrm{D}} V_{\\mathrm{DD}}$$\nThe two internal diffusion nodes, with capacitances $C_{1}$ and $C_{2}$, are initially at $0\\ \\mathrm{V}$, so they store no charge. The total initial charge in the isolated system of three capacitors is $Q_{\\mathrm{initial}}$.\n\nDuring the benign glitch, these three nodes are momentarily connected. Charge redistributes among the capacitors until they reach a common voltage, which we will call the post-charge-sharing voltage, $V_{\\mathrm{droop}}$. The total capacitance of the combined network is the sum of the individual capacitances, $C_{\\mathrm{total}} = C_{\\mathrm{D}} + C_{1} + C_{2}$. The total charge after redistribution is:\n$$Q_{\\mathrm{final}} = C_{\\mathrm{total}} V_{\\mathrm{droop}} = (C_{\\mathrm{D}} + C_{1} + C_{2}) V_{\\mathrm{droop}}$$\nBy the principle of charge conservation, the initial charge must equal the final charge, $Q_{\\mathrm{initial}} = Q_{\\mathrm{final}}$.\n$$C_{\\mathrm{D}} V_{\\mathrm{DD}} = (C_{\\mathrm{D}} + C_{1} + C_{2}) V_{\\mathrm{droop}}$$\nSolving for $V_{\\mathrm{droop}}$ gives:\n$$V_{\\mathrm{droop}} = \\frac{C_{\\mathrm{D}}}{C_{\\mathrm{D}} + C_{1} + C_{2}} V_{\\mathrm{DD}}$$\nSubstituting the given values: $V_{\\mathrm{DD}} = 1\\ \\mathrm{V}$, $C_{\\mathrm{D}} = 12\\ \\mathrm{fF}$, $C_{1} = 3\\ \\mathrm{fF}$, and $C_{2} = 5\\ \\mathrm{fF}$:\n$$V_{\\mathrm{droop}} = \\frac{12\\ \\mathrm{fF}}{12\\ \\mathrm{fF} + 3\\ \\mathrm{fF} + 5\\ \\mathrm{fF}} \\times 1\\ \\mathrm{V} = \\frac{12}{20} \\times 1\\ \\mathrm{V} = 0.6\\ \\mathrm{V}$$\nThis is the initial voltage of the dynamic node, $V_{\\mathrm{D}}(t=0)$, at the beginning of the recovery phase.\n\n**Step 2: Analysis of the Keeper-Driven Recovery**\n\nAfter the glitch, the keeper transistor turns on to restore the voltage on the dynamic node. The keeper is a PMOS device with its source connected to $V_{\\mathrm{DD}}$, gate to ground ($0\\ \\mathrm{V}$), and drain to the dynamic node (at voltage $V_{\\mathrm{D}}(t)$).\nThe gate-source voltage is $V_{\\mathrm{GS}} = V_{\\mathrm{G}} - V_{\\mathrm{S}} = 0 - V_{\\mathrm{DD}} = -V_{\\mathrm{DD}} = -1\\ \\mathrm{V}$.\nThe threshold voltage is $V_{\\mathrm{TP}} = -0.25\\ \\mathrm{V}$. Since $V_{\\mathrm{GS}} (-1\\ \\mathrm{V})  V_{\\mathrm{TP}} (-0.25\\ \\mathrm{V})$, the PMOS is in strong inversion (ON).\n\nTo determine the region of operation (triode vs. saturation), we examine the drain-source voltage, $V_{\\mathrm{DS}} = V_{\\mathrm{D}}(t) - V_{\\mathrm{S}} = V_{\\mathrm{D}}(t) - V_{\\mathrm{DD}}$. The boundary is given by $V_{\\mathrm{DS}} = V_{\\mathrm{GS}} - V_{\\mathrm{TP}}$. In terms of source-referred voltages, saturation occurs for $V_{\\mathrm{SD}} \\ge V_{\\mathrm{SG}} - |V_{\\mathrm{TP}}|$. Triode region occurs for $V_{\\mathrm{SD}}  V_{\\mathrm{SG}} - |V_{\\mathrm{TP}}|$.\nHere, $V_{\\mathrm{SG}} = V_{\\mathrm{S}} - V_{\\mathrm{G}} = V_{\\mathrm{DD}} - 0 = V_{\\mathrm{DD}}$ and $V_{\\mathrm{SD}} = V_{\\mathrm{S}} - V_{\\mathrm{D}} = V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t)$.\nThe triode condition is $V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t)  V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}|$, which simplifies to $V_{\\mathrm{D}}(t) > |V_{\\mathrm{TP}}|$.\nThe recovery process starts at $V_{\\mathrm{droop}}=0.6\\ \\mathrm{V}$ and aims for $V_{\\mathrm{target}}=0.9\\ \\mathrm{V}$. Since $|V_{\\mathrm{TP}}| = 0.25\\ \\mathrm{V}$, the condition $V_{\\mathrm{D}}(t) > 0.25\\ \\mathrm{V}$ is satisfied throughout the entire recovery interval. Thus, the keeper operates in the triode region.\n\nThe problem specifies to linearize the triode current equation for a small source-drain voltage $V_{\\mathrm{SD}}$. The full triode equation for the source-to-drain current $I_{\\mathrm{SD}}$ is:\n$$I_{\\mathrm{SD}} = \\mu_p C_{\\mathrm{ox}} \\frac{W}{L} \\left[ (V_{\\mathrm{SG}} - |V_{\\mathrm{TP}}|)V_{\\mathrm{SD}} - \\frac{V_{\\mathrm{SD}}^2}{2} \\right]$$\nFor small $V_{\\mathrm{SD}}$, the $V_{\\mathrm{SD}}^2$ term is negligible. Substituting $V_{\\mathrm{SG}} = V_{\\mathrm{DD}}$ and $V_{\\mathrm{SD}} = V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t)$, the linearized current is:\n$$I_{\\mathrm{SD}} \\approx \\mu_p C_{\\mathrm{ox}} \\frac{W}{L} (V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}|) (V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t))$$\nThis shows the keeper acts as a conductor with conductance $G_{\\mathrm{k}}$:\n$$G_{\\mathrm{k}} = \\mu_p C_{\\mathrm{ox}} \\frac{W}{L} (V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}|)$$\nThe current $I_{\\mathrm{SD}}$ from the keeper charges the dynamic node capacitance $C_{\\mathrm{D}}$. The differential equation governing the node voltage $V_{\\mathrm{D}}(t)$ is:\n$$C_{\\mathrm{D}} \\frac{dV_{\\mathrm{D}}}{dt} = I_{\\mathrm{SD}} = G_{\\mathrm{k}} (V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t))$$\nThis is a first-order linear ordinary differential equation. We can solve it by letting $v(t) = V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t)$, which implies $\\frac{dv}{dt} = -\\frac{dV_{\\mathrm{D}}}{dt}$. The equation becomes:\n$$-C_{\\mathrm{D}} \\frac{dv}{dt} = G_{\\mathrm{k}} v(t) \\quad \\implies \\quad \\frac{dv}{dt} = -\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} v(t)$$\nThe solution is $v(t) = v(0) \\exp(-t/\\tau)$, where the time constant is $\\tau = C_{\\mathrm{D}}/G_{\\mathrm{k}}$.\nSubstituting back for $V_{\\mathrm{D}}(t)$:\n$$V_{\\mathrm{DD}} - V_{\\mathrm{D}}(t) = (V_{\\mathrm{DD}} - V_{\\mathrm{D}}(0)) \\exp\\left(-\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} t\\right)$$\nThe initial condition is $V_{\\mathrm{D}}(0) = V_{\\mathrm{droop}}$. The voltage at time $t$ is:\n$$V_{\\mathrm{D}}(t) = V_{\\mathrm{DD}} - (V_{\\mathrm{DD}} - V_{\\mathrm{droop}}) \\exp\\left(-\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} t\\right)$$\n\n**Step 3: Derivation of the Keeper Width $W$**\n\nWe require the voltage to recover to $V_{\\mathrm{target}} = 0.9\\,V_{\\mathrm{DD}}$ within time $T = 50\\ \\mathrm{ps}$. Setting $V_{\\mathrm{D}}(T) = V_{\\mathrm{target}}$:\n$$V_{\\mathrm{target}} = V_{\\mathrm{DD}} - (V_{\\mathrm{DD}} - V_{\\mathrm{droop}}) \\exp\\left(-\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} T\\right)$$\nRearranging to solve for the exponential term:\n$$\\exp\\left(-\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} T\\right) = \\frac{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}$$\nTaking the natural logarithm of both sides:\n$$-\\frac{G_{\\mathrm{k}}}{C_{\\mathrm{D}}} T = \\ln\\left(\\frac{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}\\right)$$\nSolving for $G_{\\mathrm{k}}$:\n$$G_{\\mathrm{k}} = \\frac{C_{\\mathrm{D}}}{T} \\ln\\left(\\frac{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}\\right)$$\nNow we equate the two expressions for $G_{\\mathrm{k}}$:\n$$\\mu_p C_{\\mathrm{ox}} \\frac{W}{L} (V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}|) = \\frac{C_{\\mathrm{D}}}{T} \\ln\\left(\\frac{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}\\right)$$\nFinally, we solve for the minimum required keeper width $W$:\n$$W = \\frac{L}{\\mu_p C_{\\mathrm{ox}} (V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}|)} \\cdot \\frac{C_{\\mathrm{D}}}{T} \\cdot \\ln\\left(\\frac{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}\\right)$$\n\n**Step 4: Numerical Calculation**\n\nWe substitute the given numerical values into the expression for $W$:\n- $L = 30\\ \\mathrm{nm} = 30 \\times 10^{-9}\\ \\mathrm{m}$\n- $\\mu_p C_{\\mathrm{ox}} = 100\\ \\mu\\mathrm{A}/\\mathrm{V}^{2} = 100 \\times 10^{-6}\\ \\mathrm{A}/\\mathrm{V}^{2}$\n- $V_{\\mathrm{DD}} = 1\\ \\mathrm{V}$\n- $|V_{\\mathrm{TP}}| = 0.25\\ \\mathrm{V}$\n- $C_{\\mathrm{D}} = 12\\ \\mathrm{fF} = 12 \\times 10^{-15}\\ \\mathrm{F}$\n- $T = 50\\ \\mathrm{ps} = 50 \\times 10^{-12}\\ \\mathrm{s}$\n- $V_{\\mathrm{droop}} = 0.6\\ \\mathrm{V}$\n- $V_{\\mathrm{target}} = 0.9\\,V_{\\mathrm{DD}} = 0.9\\ \\mathrm{V}$\n\nFirst, calculate the individual terms in the expression for $W$:\n$$V_{\\mathrm{DD}} - |V_{\\mathrm{TP}}| = 1\\ \\mathrm{V} - 0.25\\ \\mathrm{V} = 0.75\\ \\mathrm{V}$$\n$$\\frac{C_{\\mathrm{D}}}{T} = \\frac{12 \\times 10^{-15}\\ \\mathrm{F}}{50 \\times 10^{-12}\\ \\mathrm{s}} = 0.24 \\times 10^{-3}\\ \\mathrm{A}/\\mathrm{V}$$\n$$\\ln\\left(\\frac{V_{\\mathrm{DD}} - V_{\\mathrm{droop}}}{V_{\\mathrm{DD}} - V_{\\mathrm{target}}}\\right) = \\ln\\left(\\frac{1\\ \\mathrm{V} - 0.6\\ \\mathrm{V}}{1\\ \\mathrm{V} - 0.9\\ \\mathrm{V}}\\right) = \\ln\\left(\\frac{0.4}{0.1}\\right) = \\ln(4)$$\nNow, substitute these into the equation for $W$:\n$$W = \\frac{30 \\times 10^{-9}\\ \\mathrm{m}}{(100 \\times 10^{-6}\\ \\mathrm{A}/\\mathrm{V}^{2}) \\times (0.75\\ \\mathrm{V})} \\times (0.24 \\times 10^{-3}\\ \\mathrm{A}/\\mathrm{V}) \\times \\ln(4)$$\n$$W = \\frac{30 \\times 10^{-9}}{75 \\times 10^{-6}} \\times (0.24 \\times 10^{-3}) \\times \\ln(4)\\ \\mathrm{m}$$\n$$W = (0.4 \\times 10^{-3}) \\times (0.24 \\times 10^{-3}) \\times \\ln(4)\\ \\mathrm{m}$$\n$$W = 0.096 \\times 10^{-6} \\times \\ln(4)\\ \\mathrm{m}$$\nUsing $\\ln(4) \\approx 1.38629$:\n$$W \\approx 0.096 \\times 10^{-6} \\times 1.38629\\ \\mathrm{m} \\approx 0.133084 \\times 10^{-6}\\ \\mathrm{m}$$\nThe result is in meters. To express it in micrometers, we multiply by $10^6$:\n$$W \\approx 0.133084\\ \\mu\\mathrm{m}$$\nRounding to three significant figures, the minimum keeper width is $0.133\\ \\mu\\mathrm{m}$.",
            "answer": "$$\\boxed{0.133}$$"
        },
        {
            "introduction": "Building on the linearized model, this next exercise introduces a more accurate, non-linear model for the keeper transistor, specifically for a device operating in the saturation region . Your task is to derive a closed-form analytical expression for the required keeper size, starting from the square-law MOSFET current equation. This practice is crucial for understanding how to handle non-linear device behavior in circuit analysis and for appreciating the parametric dependencies that influence keeper design.",
            "id": "4259391",
            "problem": "Consider a dynamic domino gate in the context of Integrated Circuits and Electronic Design Automation (EDA). The gate uses a precharge-evaluate clocking scheme. During the precharge phase, the dynamic output node is charged to the supply voltage $V_{DD}$ through a precharge transistor. At the beginning of the evaluation phase at time $t=0$, the precharge transistor turns off, and an internal floating diffusion node is connected to the dynamic node through a single $n$-type Metal-Oxide-Semiconductor Field-Effect Transistor ($n$-MOSFET) that turns on, enabling charge sharing. The floating internal node has capacitance $C_{X}$ and is initially at $0$ before $t=0$. The dynamic node has capacitance $C_{D}$.\n\nTo mitigate charge sharing and subsequent droop, a keeper is implemented as a weak $p$-type Metal-Oxide-Semiconductor Field-Effect Transistor ($p$-MOSFET) whose gate and drain are both connected to the dynamic node and whose source is connected to $V_{DD}$. The keeper has channel length $L_{k}$ and width $W_{k}$. Assume the $p$-MOSFET is always in saturation while it is on, and its drain current for $V_{SG} \\ge |V_{TP}|$ follows the well-tested square-law model $I_{k} = \\frac{1}{2}\\mu_{p} C_{ox}\\frac{W_{k}}{L_{k}}(V_{SG}-|V_{TP}|)^{2}$, where $\\mu_{p}$ is the hole mobility, $C_{ox}$ is the oxide capacitance per unit area, and $|V_{TP}|$ is the magnitude of the keeper threshold voltage. Neglect all other leakage currents during evaluation.\n\nAssume the charge sharing between $C_{D}$ and $C_{X}$ is much faster than the keeper response, so the dynamic node voltage experiences an instantaneous drop at $t=0^{+}$ to $V_{0}$ due to charge conservation. For $t>0$, the keeper current charges the combined capacitance $C_{D}+C_{X}$, increasing the dynamic node voltage. Let the evaluation time window be $T_{eval}$, and require that by time $T_{eval}$ the dynamic node recovers to at least a minimum voltage $V_{min}$, with the constraint that $V_{DD}-V_{min} \\ge |V_{TP}|$ and $V_{DD}-V_{0} \\ge |V_{TP}|$ so the keeper is active throughout the relevant trajectory.\n\nStarting from first principles (charge conservation and the capacitor current relation $i = C\\, dv/dt$), and using only the square-law saturation model stated above for the keeper, derive a closed-form analytic expression for the minimum keeper width $W_{k}^{\\star}$ that guarantees $V_{D}(T_{eval}) = V_{min}$. Your final expression must be a single closed-form analytic expression in terms of $V_{DD}$, $V_{min}$, $|V_{TP}|$, $C_{D}$, $C_{X}$, $\\mu_{p}$, $C_{ox}$, $L_{k}$, and $T_{eval}$. You do not need to compute a numerical value. No rounding is required. Do not include units in your final answer.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and internally consistent. It describes a standard scenario in digital integrated circuit design involving charge sharing in dynamic logic and its mitigation using a keeper device. The problem provides all necessary physical models, constraints, and parameters to derive a unique solution. Therefore, the problem is valid, and a solution can be derived.\n\nThe derivation proceeds in four principal steps:\n1.  Calculate the initial voltage on the dynamic node immediately after charge sharing.\n2.  Formulate the differential equation governing the voltage recovery of the dynamic node due to the keeper transistor.\n3.  Solve the differential equation for the given boundary conditions.\n4.  Isolate the parameter of interest, the minimum keeper width $W_{k}^{\\star}$.\n\nStep 1: Initial Voltage from Charge Sharing\nAt time $t=0^{-}$, just before the evaluation phase begins, the dynamic node, with capacitance $C_{D}$, is precharged to the supply voltage $V_{DD}$. The internal floating node, with capacitance $C_{X}$, is at a potential of $0$. The total charge stored on these two nodes is given by:\n$$Q_{initial} = C_{D}V_{DD} + C_{X}(0) = C_{D}V_{DD}$$\nAt time $t=0^{+}$, an access transistor turns on, connecting the two nodes. This is modeled as an instantaneous event where charge is conserved. The two capacitances $C_{D}$ and $C_{X}$ are now in parallel, sharing a common voltage which we denote as $V_{0}$. The total charge after sharing is:\n$$Q_{final} = (C_{D} + C_{X})V_{0}$$\nBy the principle of charge conservation, $Q_{initial} = Q_{final}$:\n$$C_{D}V_{DD} = (C_{D} + C_{X})V_{0}$$\nSolving for $V_{0}$, we find the initial condition for the subsequent recovery phase:\n$$V_{0} = V_{DD} \\frac{C_{D}}{C_{D} + C_{X}}$$\nThis represents the voltage on the dynamic node at $t=0^{+}$.\n\nStep 2: Differential Equation for Voltage Recovery\nFor $t > 0$, the keeper $p$-MOSFET begins to counteract the voltage droop by sourcing current to the dynamic node. The keeper is a diode-connected $p$-MOSFET with its source at $V_{DD}$ and its gate and drain connected to the dynamic node at voltage $V_{D}(t)$.\nThe source-to-gate voltage is $V_{SG}(t) = V_{S} - V_{G}(t) = V_{DD} - V_{D}(t)$.\nThe problem states that the keeper remains in its saturation region for the entire recovery trajectory, which is ensured by the constraints $V_{DD}-V_{min} \\ge |V_{TP}|$ and $V_{DD}-V_{0} \\ge |V_{TP}|$. The saturation current $I_{k}$ for the $p$-MOSFET is given by the provided square-law model:\n$$I_{k} = \\frac{1}{2}\\mu_{p} C_{ox}\\frac{W_{k}}{L_{k}}(V_{SG} - |V_{TP}|)^{2}$$\nSubstituting the expression for $V_{SG}(t)$:\n$$I_{k} = \\frac{1}{2}\\mu_{p} C_{ox}\\frac{W_{k}}{L_{k}}(V_{DD} - V_{D}(t) - |V_{TP}|)^{2}$$\nThis current $I_{k}$ charges the total capacitance of the dynamic and internal nodes, $C_{total} = C_{D} + C_{X}$. Using the fundamental capacitor current-voltage relationship, $I = C \\frac{dV}{dt}$:\n$$I_{k} = (C_{D} + C_{X}) \\frac{dV_{D}(t)}{dt}$$\nEquating the two expressions for $I_{k}$ yields the first-order nonlinear ordinary differential equation for the dynamic node voltage:\n$$(C_{D} + C_{X}) \\frac{dV_{D}}{dt} = \\frac{1}{2}\\mu_{p} C_{ox}\\frac{W_{k}}{L_{k}}(V_{DD} - V_{D} - |V_{TP}|)^{2}$$\n\nStep 3: Solving the Differential Equation\nThis is a separable differential equation. We can rearrange the terms to separate the variables $V_{D}$ and $t$:\n$$\\frac{dV_{D}}{(V_{DD} - V_{D} - |V_{TP}|)^{2}} = \\frac{\\mu_{p} C_{ox} W_{k}}{2 L_{k} (C_{D} + C_{X})} dt$$\nTo find the relationship between the final voltage and the evaluation time, we integrate both sides over the specified interval. The time $t$ ranges from $0$ to $T_{eval}$, and the dynamic node voltage $V_{D}$ ranges from its initial value $V_{0}$ to the target minimum voltage $V_{min}$. For the minimum width $W_{k}^{\\star}$, the voltage at time $T_{eval}$ will be exactly $V_{min}$.\n$$\\int_{V_{0}}^{V_{min}} \\frac{dV_{D}}{(V_{DD} - V_{D} - |V_{TP}|)^{2}} = \\int_{0}^{T_{eval}} \\frac{\\mu_{p} C_{ox} W_{k}}{2 L_{k} (C_{D} + C_{X})} dt$$\nThe integral of the left side is:\n$$\\int_{V_{0}}^{V_{min}} \\frac{dV_{D}}{(V_{DD} - V_{D} - |V_{TP}|)^{2}} = \\left[ \\frac{1}{V_{DD} - V_{D} - |V_{TP}|} \\right]_{V_{0}}^{V_{min}} = \\frac{1}{V_{DD} - V_{min} - |V_{TP}|} - \\frac{1}{V_{DD} - V_{0} - |V_{TP}|}$$\nThe integral of the right side is:\n$$\\int_{0}^{T_{eval}} \\frac{\\mu_{p} C_{ox} W_{k}}{2 L_{k} (C_{D} + C_{X})} dt = \\frac{\\mu_{p} C_{ox} W_{k} T_{eval}}{2 L_{k} (C_{D} + C_{X})}$$\nEquating the results gives the integrated relationship:\n$$\\frac{1}{V_{DD} - V_{min} - |V_{TP}|} - \\frac{1}{V_{DD} - V_{0} - |V_{TP}|} = \\frac{\\mu_{p} C_{ox} W_{k} T_{eval}}{2 L_{k} (C_{D} + C_{X})}$$\n\nStep 4: Deriving the Expression for Minimum Keeper Width $W_{k}^{\\star}$\nWe now solve for $W_{k}$ to find the minimum width $W_{k}^{\\star}$ required to meet the condition $V_{D}(T_{eval}) = V_{min}$.\n$$W_{k}^{\\star} = \\frac{2 L_{k} (C_{D} + C_{X})}{\\mu_{p} C_{ox} T_{eval}} \\left( \\frac{1}{V_{DD} - V_{min} - |V_{TP}|} - \\frac{1}{V_{DD} - V_{0} - |V_{TP}|} \\right)$$\nTo provide the answer solely in terms of the initial problem parameters, we substitute the expression for $V_{0}$ from Step 1. The denominator of the second term within the parentheses becomes:\n$$V_{DD} - V_{0} - |V_{TP}| = V_{DD} - V_{DD} \\frac{C_{D}}{C_{D} + C_{X}} - |V_{TP}| = V_{DD}\\left(1 - \\frac{C_{D}}{C_{D} + C_{X}}\\right) - |V_{TP}| = V_{DD}\\frac{C_{X}}{C_{D} + C_{X}} - |V_{TP}|$$\nSubstituting this back into the expression for $W_{k}^{\\star}$ yields the final closed-form analytical expression:\n$$W_{k}^{\\star} = \\frac{2 L_{k} (C_{D} + C_{X})}{\\mu_{p} C_{ox} T_{eval}} \\left( \\frac{1}{V_{DD} - V_{min} - |V_{TP}|} - \\frac{1}{V_{DD}\\frac{C_{X}}{C_{D}+C_{X}} - |V_{TP}|} \\right)$$\nThis expression represents the minimum width of the keeper transistor that ensures the dynamic node voltage recovers to at least $V_{min}$ within the evaluation time $T_{eval}$.",
            "answer": "$$\\boxed{\\frac{2 L_{k} (C_{D} + C_{X})}{\\mu_{p} C_{ox} T_{eval}} \\left( \\frac{1}{V_{DD} - V_{min} - |V_{TP}|} - \\frac{1}{V_{DD}\\frac{C_{X}}{C_{D}+C_{X}} - |V_{TP}|} \\right)}$$"
        },
        {
            "introduction": "In our final practice, we shift perspective from analyzing a single event to a broader, system-level challenge common in Electronic Design Automation (EDA) . You will develop an algorithm to identify the worst-case input pattern that causes the most severe charge-sharing droop, accounting for the circuit's history. This exercise highlights the critical concept of pattern-dependent noise in dynamic logic and provides hands-on experience in the kind of algorithmic analysis that underpins modern static timing and noise analysis tools.",
            "id": "4259387",
            "problem": "Consider a dynamic domino logic stage used in Very Large Scale Integration (VLSI) analyzed within Electronic Design Automation (EDA). The evaluation network comprises a series stack of Metal-Oxide-Semiconductor Field-Effect Transistor (MOSFET) devices with internal nodes and a single dynamic output node precharged to a high supply voltage. During the evaluation phase, a subset of the transistors at the top of the stack turn on, instantaneously connecting some internal capacitive nodes to the dynamic node. Due to charge conservation, these connections cause charge sharing and a droop on the dynamic node voltage. A weak keeper device modeled as a resistor connects the dynamic node to the supply and slowly restores charge, but on the timescale of the initial redistribution, the droop is governed by capacitive charge sharing.\n\nYou are given the following physical and circuit modeling assumptions:\n- The dynamic node is initially at $V_{\\mathrm{DD}}$ at the start of evaluation due to the precharge phase.\n- The first $j$ transistors from the top of an $n$-device series stack turn on at the start of evaluation; the rest remain off.\n- The internal node between device $i$ and $i+1$ has capacitance $C_i$, for $i \\in \\{1,2,\\dots,n\\}$, indexed from the top device ($i=1$) towards ground ($i=n$). The dynamic node capacitance is $C_{\\mathrm{dyn}}$.\n- The previous cycle may have discharged a contiguous suffix of internal nodes at the bottom of the stack due to a completed or partial path to ground. Let $d_{\\mathrm{prev}} \\in \\{0,1,\\dots,n\\}$ denote the length of this contiguous suffix; thus, nodes with indices $i \\in \\{n-d_{\\mathrm{prev}}+1, \\dots, n\\}$ start at $0\\,\\mathrm{V}$, while nodes with indices $i \\in \\{1,\\dots,n-d_{\\mathrm{prev}}\\}$ start at $V_{\\mathrm{DD}}$.\n- During the current evaluation, when the first $j$ devices turn on, the connected set of internal nodes is $\\{1,2,\\dots,j\\}$. Only the overlap of this set with the previously discharged suffix participates in charge sharing at $0\\,\\mathrm{V}$, while the non-overlap within $\\{1,\\dots,j\\}$ participates at $V_{\\mathrm{DD}}$.\n- The keeper is modeled as a linear resistor $R_k$ to $V_{\\mathrm{DD}}$; the evaluation window is $t_{\\mathrm{eval}}$. There is no completed path to ground during the current evaluation ($j  n$), and off-state leakage is neglected on the timescale of $t_{\\mathrm{eval}}$.\n\nStarting from first principles, use charge conservation $Q = C V$ and Kirchhoff’s laws to derive the minimum dynamic node voltage due to charge sharing for a given $d_{\\mathrm{prev}}$. Treat the connected nodes and the dynamic node as a single lumped capacitance during the instantaneous redistribution, and treat the keeper as a first-order charging element thereafter. The instantaneous post-connection equilibrium voltage $V_{\\mathrm{eq}}$ and the subsequent time-domain behavior $V(t)$ must be derived from these principles; do not use or assume any shortcut formulas not derived from $Q = C V$ and basic circuit laws.\n\nYour task is to write a program that, for each test case, performs the following steps:\n- Enumerate all $d_{\\mathrm{prev}} \\in \\{0,1,\\dots,n\\}$.\n- For each $d_{\\mathrm{prev}}$, compute the instantaneous equilibrium voltage $V_{\\mathrm{eq}}(d_{\\mathrm{prev}})$ at $t = 0^+$ due to charge sharing between the dynamic node ($C_{\\mathrm{dyn}}$ initially at $V_{\\mathrm{DD}}$) and the connected internal capacitors $\\{C_1,\\dots,C_j\\}$ with initial voltages determined by $d_{\\mathrm{prev}}$ (either $0\\,\\mathrm{V}$ or $V_{\\mathrm{DD}}$ as above).\n- Using the keeper model as a resistor $R_k$ to $V_{\\mathrm{DD}}$ and the lumped connected capacitance $C_{\\mathrm{tot}} = C_{\\mathrm{dyn}} + \\sum_{i=1}^{j} C_i$, derive and use the first-order solution for $V(t)$ during the evaluation window $t \\in [0, t_{\\mathrm{eval}}]$ to identify the minimum dynamic node voltage $V_{\\min}(d_{\\mathrm{prev}})$ in that window. Under the given assumptions, show whether $V_{\\min}(d_{\\mathrm{prev}})$ occurs at $t = 0^+$ or later.\n- Select the worst-case previous-cycle pattern $d_{\\mathrm{prev}}^\\star$ that minimizes $V_{\\min}(d_{\\mathrm{prev}})$ for the given test case. If multiple $d_{\\mathrm{prev}}$ yield the same minimum, choose the smallest $d_{\\mathrm{prev}}$.\n- Report, for each test case, the pair $\\left[d_{\\mathrm{prev}}^\\star, V_{\\mathrm{min}}^\\star\\right]$, where $V_{\\mathrm{min}}^\\star$ is rounded to six decimals.\n\nAll symbols must be expressed in the following physical units:\n- $V_{\\mathrm{DD}}$, $V_{\\mathrm{eq}}$, $V_{\\mathrm{min}}$ in $\\mathrm{V}$.\n- $C_{\\mathrm{dyn}}$, $C_i$ in $\\mathrm{fF}$.\n- $R_k$ in $\\mathrm{k}\\Omega$.\n- $t_{\\mathrm{eval}}$ in $\\mathrm{ns}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $\\left[\\texttt{[3,0.705882]},\\texttt{[3,0.600000]}\\right]$). The numeric formatting in the output should follow the above rounding specification for $V_{\\mathrm{min}}^\\star$.\n\nUse the following test suite, which is designed to exercise typical, boundary, and edge-case behaviors:\n- Test case $1$ (happy path): $n = 3$, $j = 2$, $V_{\\mathrm{DD}} = 1.0\\,\\mathrm{V}$, $C_{\\mathrm{dyn}} = 12\\,\\mathrm{fF}$, $\\{C_1,C_2,C_3\\} = \\{2,3,5\\}\\,\\mathrm{fF}$, $R_k = 100\\,\\mathrm{k}\\Omega$, $t_{\\mathrm{eval}} = 0.5\\,\\mathrm{ns}$.\n- Test case $2$ (boundary design point): $n = 3$, $j = 2$, $V_{\\mathrm{DD}} = 1.0\\,\\mathrm{V}$, $C_{\\mathrm{dyn}} = 12\\,\\mathrm{fF}$, $\\{C_1,C_2,C_3\\} = \\{3,5,2\\}\\,\\mathrm{fF}$, $R_k = 50\\,\\mathrm{k}\\Omega$, $t_{\\mathrm{eval}} = 0.2\\,\\mathrm{ns}$.\n- Test case $3$ (keeper strength edge case): $n = 4$, $j = 3$, $V_{\\mathrm{DD}} = 0.9\\,\\mathrm{V}$, $C_{\\mathrm{dyn}} = 6\\,\\mathrm{fF}$, $\\{C_1,C_2,C_3,C_4\\} = \\{4,6,5,7\\}\\,\\mathrm{fF}$, $R_k = 2\\,\\mathrm{k}\\Omega$, $t_{\\mathrm{eval}} = 5.0\\,\\mathrm{ns}$.\n- Test case $4$ (no devices turned on, sanity edge case): $n = 5$, $j = 0$, $V_{\\mathrm{DD}} = 1.2\\,\\mathrm{V}$, $C_{\\mathrm{dyn}} = 20\\,\\mathrm{fF}$, $\\{C_1,C_2,C_3,C_4,C_5\\} = \\{1,1,1,1,1\\}\\,\\mathrm{fF}$, $R_k = 10\\,\\mathrm{k}\\Omega$, $t_{\\mathrm{eval}} = 1.0\\,\\mathrm{ns}$.\n\nYour program should produce a single line of output containing the four pairs, formatted as a comma-separated list enclosed in square brackets, with each pair formatted as $\\left[\\texttt{integer},\\texttt{float}\\right]$ and no additional whitespace (for example, $\\texttt{[[3,0.705882],[3,0.600000],[4,0.257143],[0,1.200000]]}$).",
            "solution": "The problem is subjected to validation against the established criteria.\n\n### Step 1: Extract Givens\n-   **Circuit Topology and State**: A dynamic domino logic stage with an $n$-device series stack.\n-   **Dynamic Node**: Initial voltage $V_{\\mathrm{DD}}$; capacitance $C_{\\mathrm{dyn}}$.\n-   **Internal Nodes**: $n$ internal nodes with capacitances $C_i$ for $i \\in \\{1, 2, \\dots, n\\}$.\n-   **Evaluation Trigger**: First $j$ transistors from the top turn on, connecting internal nodes $\\{1, 2, \\dots, j\\}$ to the dynamic node.\n-   **Previous Cycle State**: A contiguous suffix of $d_{\\mathrm{prev}}$ internal nodes at the bottom of the stack are discharged to $0\\,\\mathrm{V}$. The length $d_{\\mathrm{prev}}$ can be any integer from $0$ to $n$.\n-   **Initial Node Voltages**:\n    -   Nodes $i \\in \\{n - d_{\\mathrm{prev}} + 1, \\dots, n\\}$ start at $0\\,\\mathrm{V}$.\n    -   Nodes $i \\in \\{1, \\dots, n - d_{\\mathrm{prev}}\\}$ start at $V_{\\mathrm{DD}}$.\n-   **Keeper Device**: Modeled as a linear resistor $R_k$ connecting the dynamic node to $V_{\\mathrm{DD}}$.\n-   **Evaluation Window**: Duration is $t_{\\mathrm{eval}}$.\n-   **Assumptions**: No completed path to ground ($j  n$); off-state leakage is negligible.\n-   **Objective**: For a given set of parameters $(n, j, V_{\\mathrm{DD}}, C_{\\mathrm{dyn}}, \\{C_i\\}, R_k, t_{\\mathrm{eval}})$, enumerate all possible previous discharge patterns $d_{\\mathrm{prev}} \\in \\{0, 1, \\dots, n\\}$. For each, determine the minimum dynamic node voltage $V_{\\min}(d_{\\mathrm{prev}})$ during the evaluation window. Identify the worst-case pattern $d_{\\mathrm{prev}}^\\star$ that leads to the lowest minimum voltage, $V_{\\min}^\\star$. If multiple patterns produce the same minimum voltage, the one with the smallest $d_{\\mathrm{prev}}$ is chosen. The final output for each test case is the pair $[d_{\\mathrm{prev}}^\\star, V_{\\min}^\\star]$.\n-   **Physical Units**: Voltages in Volts ($\\mathrm{V}$), capacitances in femtofarads ($\\mathrm{fF}$), resistance in kilo-ohms ($\\mathrm{k}\\Omega$), and time in nanoseconds ($\\mathrm{ns}$).\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded**: The problem is fundamentally based on the principle of conservation of charge ($Q=CV$) and the analysis of a first-order RC circuit, both of which are cornerstones of classical circuit theory. The model of charge sharing in a domino logic gate is a standard, if simplified, problem in VLSI circuit analysis. The premises are scientifically sound.\n-   **Well-Posed**: The problem is well-posed. It requires finding a minimum value by exploring a finite, discrete set of initial conditions defined by $d_{\\mathrm{prev}}$. For each initial condition, the physical principles yield a deterministic outcome. The tie-breaking rule (choosing the smallest $d_{\\mathrm{prev}}$) ensures that the solution $[d_{\\mathrm{prev}}^\\star, V_{\\min}^\\star]$ is unique.\n-   **Objective**: The problem is stated in precise, objective language. All parameters, models, and constraints are defined quantitatively, leaving no room for subjective interpretation.\n-   **Conclusion**: The problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity. It is a formalizable and solvable problem within the specified domain.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be derived and implemented.\n\n### Derivations and Solution Strategy\n\nThe solution requires two main derivations: the instantaneous voltage droop from charge sharing and the subsequent time-domain behavior due to the keeper.\n\n#### 1. Instantaneous Equilibrium Voltage $V_{\\mathrm{eq}}$\n\nAt the start of the evaluation phase ($t=0$), the first $j$ transistors turn on, connecting the dynamic node (capacitance $C_{\\mathrm{dyn}}$) and the first $j$ internal nodes (capacitances $C_1, \\dots, C_j$). This system of connected capacitors is momentarily isolated. By the principle of conservation of charge, the total charge in this isolated system immediately before the connection ($t=0^-$) must equal the total charge immediately after charge redistribution is complete ($t=0^+$).\n\nThe total capacitance of the interconnected system is the sum of the individual capacitances:\n$$\nC_{\\mathrm{tot}} = C_{\\mathrm{dyn}} + \\sum_{i=1}^{j} C_i\n$$\n\nThe total initial charge, $Q_{\\mathrm{init}}$, depends on the initial voltage of each capacitor, which is determined by $d_{\\mathrm{prev}}$.\n- The dynamic node is precharged to $V_{\\mathrm{DD}}$, so its initial charge is $Q_{\\mathrm{dyn,init}} = C_{\\mathrm{dyn}} V_{\\mathrm{DD}}$.\n- An internal node $i$ (for $i \\in \\{1,\\dots,j\\}$) is initially at $0\\,\\mathrm{V}$ if it belongs to the previously discharged suffix, i.e., if $i \\ge n - d_{\\mathrm{prev}} + 1$. Otherwise, it is at $V_{\\mathrm{DD}}$.\n\nThe total initial charge in the system for a given $d_{\\mathrm{prev}}$ is:\n$$\nQ_{\\mathrm{init}}(d_{\\mathrm{prev}}) = C_{\\mathrm{dyn}}V_{\\mathrm{DD}} + \\sum_{i=1}^{j} C_i V_i(0^-)\n$$\nwhere $V_i(0^-)$ is the initial voltage on capacitor $C_i$. This can be split into contributions from charged and discharged capacitors:\n$$\nQ_{\\mathrm{init}}(d_{\\mathrm{prev}}) = C_{\\mathrm{dyn}}V_{\\mathrm{DD}} + \\sum_{i \\in \\{1,\\dots,j\\} \\text{ s.t. } i  n-d_{\\mathrm{prev}}+1} C_i V_{\\mathrm{DD}} + \\sum_{i \\in \\{1,\\dots,j\\} \\text{ s.t. } i \\ge n-d_{\\mathrm{prev}}+1} C_i \\cdot 0\\,\\mathrm{V}\n$$\nThe condition $i  n-d_{\\mathrm{prev}}+1$ and $i \\le j$ can be simplified to $i \\le \\min(j, n-d_{\\mathrm{prev}})$. The sum is taken from $i=1$.\n$$\nQ_{\\mathrm{init}}(d_{\\mathrm{prev}}) = V_{\\mathrm{DD}} \\left( C_{\\mathrm{dyn}} + \\sum_{i=1}^{\\min(j, n-d_{\\mathrm{prev}})} C_i \\right)\n$$\n\nAfter the transistors turn on, the charge redistributes, and the entire lumped capacitance $C_{\\mathrm{tot}}$ settles to a new equilibrium voltage, $V_{\\mathrm{eq}}$. The final charge is $Q_{\\mathrm{final}} = C_{\\mathrm{tot}} V_{\\mathrm{eq}}$.\nBy charge conservation, $Q_{\\mathrm{final}} = Q_{\\mathrm{init}}$, so:\n$$\nV_{\\mathrm{eq}}(d_{\\mathrm{prev}}) = \\frac{Q_{\\mathrm{init}}(d_{\\mathrm{prev}})}{C_{\\mathrm{tot}}} = V_{\\mathrm{DD}} \\frac{C_{\\mathrm{dyn}} + \\sum_{i=1}^{\\min(j, n-d_{\\mathrm{prev}})} C_i}{C_{\\mathrm{dyn}} + \\sum_{i=1}^{j} C_i}\n$$\n\n#### 2. Minimum Voltage $V_{\\min}$ during the Evaluation Window\n\nFor $t>0$, the keeper device, modeled as a resistor $R_k$, connects the dynamic node (now at voltage $V_{\\mathrm{eq}}$ and part of the lumped capacitance $C_{\\mathrm{tot}}$) to the supply $V_{\\mathrm{DD}}$. This forms a first-order RC circuit. The current from the keeper charges the total capacitance. Applying Kirchhoff's Current Law at the dynamic node:\n$$\nI_{C_{\\mathrm{tot}}} = I_{R_k} \\implies C_{\\mathrm{tot}} \\frac{dV(t)}{dt} = \\frac{V_{\\mathrm{DD}} - V(t)}{R_k}\n$$\nThis is a standard first-order linear ordinary differential equation for the dynamic node voltage $V(t)$:\n$$\n\\frac{dV(t)}{dt} + \\frac{1}{R_k C_{\\mathrm{tot}}} V(t) = \\frac{V_{\\mathrm{DD}}}{R_k C_{\\mathrm{tot}}}\n$$\nThe solution to this equation, with the initial condition $V(t=0) = V_{\\mathrm{eq}}$, is:\n$$\nV(t) = V_{\\mathrm{DD}} + \\left( V_{\\mathrm{eq}} - V_{\\mathrm{DD}} \\right) e^{-t/\\tau}\n$$\nwhere the time constant is $\\tau = R_k C_{\\mathrm{tot}}$.\n\nWe need to find the minimum voltage $V_{\\min}$ in the evaluation window $t \\in [0, t_{\\mathrm{eval}}]$. By its nature, charge sharing can only lower the dynamic node voltage or keep it the same, so $V_{\\mathrm{eq}} \\le V_{\\mathrm{DD}}$. This implies that the term $(V_{\\mathrm{eq}} - V_{\\mathrm{DD}})$ is non-positive. The exponential term $e^{-t/\\tau}$ is positive and decreases with time. Therefore, the function $V(t)$ is monotonically non-decreasing for $t \\ge 0$. It starts at $V_{\\mathrm{eq}}$ and charges towards $V_{\\mathrm{DD}}$.\n\nThe minimum voltage in the interval $[0, t_{\\mathrm{eval}}]$ must therefore occur at the very beginning, at $t=0^+$.\n$$\nV_{\\min}(d_{\\mathrm{prev}}) = V(t=0^+) = V_{\\mathrm{eq}}(d_{\\mathrm{prev}})\n$$\nThe keeper's resistive action only serves to restore the voltage, so the worst-case droop is the instantaneous value determined purely by capacitive charge sharing.\n\n#### 3. Worst-Case Analysis Strategy\n\nTo find the worst-case scenario, we must find the value of $d_{\\mathrm{prev}}$ that minimizes $V_{\\min}(d_{\\mathrm{prev}})$. Since $V_{\\min} = V_{\\mathrm{eq}}$, we need to minimize $V_{\\mathrm{eq}}(d_{\\mathrm{prev}})$. The denominator of the expression for $V_{\\mathrm{eq}}$ is constant with respect to $d_{\\mathrm{prev}}$. Therefore, we must minimize the numerator, which is proportional to the initial charge. The initial charge is minimized by maximizing the number of initially discharged ($0\\,\\mathrm{V}$) capacitors that participate in the charge sharing.\n\nAs $d_{\\mathrm{prev}}$ increases from $0$ to $n$, the set of initially discharged nodes $\\{n - d_{\\mathrm{prev}} + 1, \\dots, n\\}$ grows. This can only increase the number of discharged nodes in the connected set $\\{1, \\dots, j\\}$, thus causing $V_{\\mathrm{eq}}(d_{\\mathrm{prev}})$ to be a monotonically non-increasing function of $d_{\\mathrm{prev}}$. The minimum voltage $V_{\\min}^\\star$ will be achieved at one or more of the largest values of $d_{\\mathrm{prev}}$.\n\nThe algorithm is as follows:\n1.  Initialize $V_{\\min}^\\star$ to a value greater than any possible voltage (e.g., $V_{\\mathrm{DD}}+1$) and $d_{\\mathrm{prev}}^\\star$ to a placeholder (e.g., $-1$).\n2.  Iterate through each possible value of $d_{\\mathrm{prev}}$ from $0$ to $n$.\n3.  For each $d_{\\mathrm{prev}}$, calculate $V_{\\min}(d_{\\mathrm{prev}})$ using the formula for $V_{\\mathrm{eq}}(d_{\\mathrm{prev}})$.\n4.  If the calculated $V_{\\min}(d_{\\mathrm{prev}})$ is less than the current $V_{\\min}^\\star$, update $V_{\\min}^\\star = V_{\\min}(d_{\\mathrm{prev}})$ and $d_{\\mathrm{prev}}^\\star = d_{\\mathrm{prev}}$.\n5.  Due to the \"smallest $d_{\\mathrm{prev}}$\" tie-breaking rule, we do not need to handle the case $V_{\\min}(d_{\\mathrm{prev}}) = V_{\\min}^\\star$, as the loop's ascending order naturally finds the smallest $d_{\\mathrm{prev}}$ first.\n6.  The final pair $[d_{\\mathrm{prev}}^\\star, V_{\\min}^\\star]$ is the result. This approach correctly handles cases where some $C_i=0$, which might cause the minimum voltage to be achieved for multiple $d_{\\mathrm{prev}}$ values.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the charge sharing problem for a series of test cases.\n    \"\"\"\n    \n    test_cases = [\n        # n, j, V_DD, C_dyn, C_internal_list, R_k, t_eval\n        (3, 2, 1.0, 12.0, [2.0, 3.0, 5.0], 100.0, 0.5),\n        (3, 2, 1.0, 12.0, [3.0, 5.0, 2.0], 50.0, 0.2),\n        (4, 3, 0.9, 6.0, [4.0, 6.0, 5.0, 7.0], 2.0, 5.0),\n        (5, 0, 1.2, 20.0, [1.0, 1.0, 1.0, 1.0, 1.0], 10.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = find_worst_case_droop(*case)\n        results.append(f\"[{result[0]},{result[1]:.6f}]\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef find_worst_case_droop(n, j, V_DD, C_dyn, C_internal_list, R_k, t_eval):\n    \"\"\"\n    Calculates the worst-case voltage droop by enumerating d_prev.\n\n    Args:\n        n (int): Total number of devices in the stack.\n        j (int): Number of top devices turned on.\n        V_DD (float): Supply voltage in V.\n        C_dyn (float): Dynamic node capacitance in fF.\n        C_internal_list (list of float): Capacitances of internal nodes [C1, ..., Cn] in fF.\n        R_k (float): Keeper resistance in kOhms.\n        t_eval (float): Evaluation time window in ns.\n\n    Returns:\n        tuple: A tuple (d_prev_star, V_min_star) representing the worst-case scenario.\n    \"\"\"\n\n    # Special case: j=0. No charge sharing with internal nodes.\n    # Voltage remains V_DD. Minimum is V_DD for all d_prev.\n    # Smallest d_prev is 0.\n    if j == 0:\n        return 0, V_DD\n\n    # As derived, the minimum voltage occurs instantaneously at t=0+.\n    # We only need to calculate V_eq for each d_prev.\n    # V_min(d_prev) = V_eq(d_prev)\n    \n    worst_d_prev = -1\n    worst_V_min = V_DD + 1.0  # Initialize with a value guaranteed to be higher than any possible droop\n\n    # C_internal_list is 0-indexed, corresponding to C_1, C_2, ...\n    # Sum of capacitors connected to the dynamic node\n    C_connected_sum = sum(C_internal_list[i] for i in range(j))\n    C_tot = C_dyn + C_connected_sum\n\n    # Enumerate all possible previous discharge patterns\n    for d_prev in range(n + 1):\n        # Calculate the sum of capacitances of connected nodes that start at V_DD\n        # A node i (1-indexed) starts at V_DD if i  n - d_prev + 1\n        C_charged_sum = 0\n        for i in range(1, j + 1):\n            if i  n - d_prev + 1:\n                # C_internal_list is 0-indexed, so C_i is at index i-1\n                C_charged_sum += C_internal_list[i - 1]\n\n        # Calculate total initial charge Q_init = V_DD * (C_dyn + C_charged_sum)\n        # Calculate V_eq = Q_init / C_tot\n        if C_tot > 0:\n            V_eq = V_DD * (C_dyn + C_charged_sum) / C_tot\n        else: # C_tot can be 0 if C_dyn and all C_i are 0\n            V_eq = V_DD\n\n        current_V_min = V_eq\n\n        # Check if this is a new worst-case.\n        # The first time we find a minimum, we set it.\n        # Subsequently, we only update if a strictly smaller voltage is found.\n        # This correctly implements the \"choose smallest d_prev\" for tie-breaking\n        # because we are iterating d_prev in increasing order.\n        if current_V_min  worst_V_min:\n            worst_V_min = current_V_min\n            worst_d_prev = d_prev\n    \n    return worst_d_prev, worst_V_min\n\nsolve()\n```"
        }
    ]
}