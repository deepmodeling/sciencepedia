{
    "hands_on_practices": [
        {
            "introduction": "这项练习旨在建立静态比较器分析的基本原则。通过从阈值电压失配推导出输入参考失调电压 ($V_{\\mathrm{os}}$)，您将对器件缺陷如何影响比较器精度有具体的理解。此外，验证行为模型的小信号增益，将有助于巩固晶体管级参数与比较器主要放大功能之间的联系。",
            "id": "4300753",
            "problem": "考虑一个由N沟道MOSFET（NMOS）差分对实现的静态金属-氧化物-半导体场效应晶体管（MOSFET）差分比较器前端。该差分对由一个值为 $I_{T}$ 的恒定尾电流源偏置，并在其中一个漏极驱动一个单端电阻负载 $R_{L}$。假设器件工作在强反型和饱和区，沟道长度调制效应可忽略不计，且除阈值电压失配外，几何结构对称。设两个输入器件的阈值电压分别为 $V_{t1}$ 和 $V_{t2}$，失配为 $\\Delta V_{t} \\equiv V_{t1} - V_{t2}$。定义差分输入为 $v_{id} \\equiv v_{G1} - v_{G2}$，共模输入为 $v_{CM} \\equiv (v_{G1} + v_{G2})/2$。设 $g_{m}$ 表示从 $v_{id}$ 到输出节点单端支路电流的有效小信号差分跨导，因此对于小的 $|v_{id}|$，支路电流扰动满足 $i_{o} \\approx g_{m}\\,v_{id}$。\n\n在集成电路和电子设计自动化（EDA）的背景下，比较器的输入参考失调定义为必须施加的差分输入电压，用以抵消失配，从而使输出指示精确平衡。从饱和区漏极电流对过驱动电压的单调依赖关系出发，并根据跨导的定义 $g_{m} \\equiv \\partial I_{D}/\\partial V_{GS}$，推导在存在阈值失配 $\\Delta V_{t}$ 的情况下，为使两个支路电流相等所需的输入参考失调 $V_{\\mathrm{os}}$。使用物理上合理的近似，即支路电流相等意味着两个晶体管的有效过驱动电压相等。\n\n另外，电阻负载差分对的单端输出电压可由平滑限制器关系式近似：\n$$\nV_{\\mathrm{out}} \\approx I_{T}\\,R_{L}\\,\\tanh\\!\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right),\n$$\n该关系式捕捉了在 $\\pm I_{T}$ 处的电流导向饱和特性，并被广泛用作差分对的行为表示。使用第一性原理和形式级数展开，通过计算小信号增益 $\\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0}$，来验证此关系在 $v_{id} = 0$ 附近的小信号行为。\n\n以包含两个符号条目 $V_{\\mathrm{os}}$ 和 $\\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0}$ 的行矩阵形式提供您的最终答案。\n不需要进行数值计算，最终的方框表达式中不应包含单位。",
            "solution": "用户提出了一个关于静态NMOS差分比较器的两部分问题。第一部分要求推导由阈值电压失配 $\\Delta V_{t}$ 引起的输入参考失调电压 $V_{\\mathrm{os}}$。第二部分要求计算给定比较器输出级行为模型下，零差分输入时的小信号电压增益。\n\n该问题已经过验证，被认为是科学上合理、表述清晰且客观的，代表了模拟集成电路设计领域的标准分析。\n\n**第一部分：输入参考失调电压($V_{\\mathrm{os}}$)的推导**\n\n输入参考失调电压 $V_{\\mathrm{os}}$ 定义为使差分对进入平衡状态所需的差分输入电压 $v_{id} = v_{G1} - v_{G2}$，该电压可以抵消由器件失配引起的任何输出失调。在此背景下，当差分对中两个晶体管的漏极电流相等时，即 $I_{D1} = I_{D2}$ 时，达到平衡。\n\n问题指出晶体管工作在强反型和饱和区。在该工作区，MOSFET的漏极电流 $I_D$ 是其过驱动电压 $V_{OV} = V_{GS} - V_t$ 的单调递增函数，其中 $V_{GS}$ 是栅-源电压，$V_t$ 是阈值电压。由于两个晶体管M1和M2被说明具有对称的几何结构，它们共享相同的漏极电流与过驱动电压函数关系。我们可以将其表示为 $I_D = F(V_{OV})$，其中函数 $F$ 对两个器件是相同的。\n\n平衡的条件是 $I_{D1} = I_{D2}$。这意味着：\n$$\nF(V_{OV1}) = F(V_{OV2})\n$$\n其中 $V_{OV1}$ 和 $V_{OV2}$ 分别是晶体管M1和M2的过驱动电压。\n\n如问题所述，漏极电流对过驱动电压具有单调依赖性。对于单调函数 $F$，等式 $F(x) = F(y)$ 成立的充要条件是 $x = y$。这验证了问题中“支路电流相等意味着过驱动电压相等”的近似。因此，平衡条件 $I_{D1} = I_{D2}$ 简化为：\n$$\nV_{OV1} = V_{OV2}\n$$\n过驱动电压根据端点电压定义如下：\n$$\nV_{OV1} = V_{G1} - V_S - V_{t1}\n$$\n$$\nV_{OV2} = V_{G2} - V_S - V_{t2}\n$$\n这里，$V_{G1}$ 和 $V_{G2}$ 是栅极电压，$V_S$ 是差分对的公共源极电压，$V_{t1}$ 和 $V_{t2}$ 是各自的阈值电压。\n\n令过驱动电压相等，得到：\n$$\nV_{G1} - V_S - V_{t1} = V_{G2} - V_S - V_{t2}\n$$\n公共源极电压 $V_S$ 在等式两边被消去：\n$$\nV_{G1} - V_{t1} = V_{G2} - V_{t2}\n$$\n重新整理此方程以求解差分栅极电压 $V_{G1} - V_{G2}$：\n$$\nV_{G1} - V_{G2} = V_{t1} - V_{t2}\n$$\n根据定义，输入参考失调 $V_{\\mathrm{os}}$ 是满足此平衡条件的差分输入 $v_{id} = V_{G1} - V_{G2}$ 的值。问题还定义了阈值电压失配为 $\\Delta V_t \\equiv V_{t1} - V_{t2}$。因此，我们得到：\n$$\nV_{\\mathrm{os}} = \\Delta V_t\n$$\n\n**第二部分：小信号增益的验证**\n\n问题的第二部分要求计算单端输出电压行为模型的小信号增益，该模型由以下关系式给出：\n$$\nV_{\\mathrm{out}} \\approx I_{T}\\,R_{L}\\,\\tanh\\!\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right)\n$$\n零差分输入时的小信号增益定义为 $V_{\\mathrm{out}}$ 对 $v_{id}$ 的导数在 $v_{id} = 0$ 处的值。\n$$\nA_v = \\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0}\n$$\n为计算此导数，我们应用链式法则。令 $u(v_{id}) = \\frac{g_{m}\\,v_{id}}{I_{T}}$。则 $V_{\\mathrm{out}} = I_T R_L \\tanh(u)$。\n$$\n\\frac{d V_{\\mathrm{out}}}{d v_{id}} = \\frac{d}{d v_{id}} \\left[ I_{T}\\,R_{L}\\,\\tanh(u(v_{id})) \\right] = I_{T}\\,R_{L} \\cdot \\frac{d(\\tanh(u))}{du} \\cdot \\frac{du}{dv_{id}}\n$$\n双曲正切函数的导数是 $\\frac{d}{du}(\\tanh(u)) = \\text{sech}^2(u)$。\n$u$ 对 $v_{id}$ 的导数是 $\\frac{du}{dv_{id}} = \\frac{d}{d v_{id}}\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right) = \\frac{g_{m}}{I_{T}}$。\n\n将这些导数代入增益表达式中：\n$$\n\\frac{d V_{\\mathrm{out}}}{d v_{id}} = I_{T}\\,R_{L} \\cdot \\text{sech}^2(u) \\cdot \\frac{g_{m}}{I_{T}}\n$$\n将 $u = \\frac{g_{m}\\,v_{id}}{I_{T}}$ 代回：\n$$\n\\frac{d V_{\\mathrm{out}}}{d v_{id}} = I_{T}\\,R_{L} \\cdot \\text{sech}^2\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right) \\cdot \\frac{g_{m}}{I_{T}} = g_{m} R_{L} \\text{sech}^2\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right)\n$$\n现在，我们在 $v_{id} = 0$ 处计算该表达式的值：\n$$\n\\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0} = g_{m} R_{L} \\text{sech}^2\\left(\\frac{g_{m} \\cdot 0}{I_{T}}\\right) = g_{m} R_{L} \\text{sech}^2(0)\n$$\n双曲正割定义为 $\\text{sech}(x) = 1/\\cosh(x)$。双曲余弦在 $x=0$ 处的值是 $\\cosh(0) = 1$。\n因此，$\\text{sech}(0) = 1$，且 $\\text{sech}^2(0) = 1^2 = 1$。\n\n在 $v_{id}=0$ 时的小信号增益为：\n$$\n\\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0} = g_{m} R_{L} \\cdot 1 = g_{m} R_{L}\n$$\n这个结果与电阻负载差分对的标准分析一致，其中小信号增益是差分跨导和负载电阻的乘积。\n\n或者，使用 $\\tanh(x)$ 在 $x=0$ 附近的形式级数展开，即 $\\tanh(x) = x - \\frac{x^3}{3} + O(x^5)$。对于小的 $v_{id}$，其参数 $\\frac{g_{m}\\,v_{id}}{I_{T}}$ 也很小，因此我们可以使用一阶近似 $\\tanh(x) \\approx x$。\n$$\nV_{\\mathrm{out}} \\approx I_{T}\\,R_{L}\\,\\left(\\frac{g_{m}\\,v_{id}}{I_{T}}\\right) = g_m R_L v_{id}\n$$\n对于小信号，增益是比率 $V_{\\mathrm{out}}/v_{id}$，即 $g_m R_L$。这证实了通过微分得到的结果。\n\n所要求的两个符号条目是 $V_{\\mathrm{os}} = \\Delta V_t$ 和小信号增益 $\\left.\\frac{d V_{\\mathrm{out}}}{d v_{id}}\\right|_{v_{id}=0} = g_m R_L$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\Delta V_{t}  g_{m} R_{L}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "本练习将重点转移到许多高速比较器核心的动态行为上。您将探索由指数增长建模的再生锁存过程，并分析随机输入噪声如何转化为比较器决策中的时序不确定性，即抖动 ($ \\sigma_t $)。掌握这种关系对于设计可靠的高频时钟和数据恢复电路至关重要。",
            "id": "4300776",
            "problem": "一个基于交叉耦合差分对的再生动态比较器，在其判决阶段，其差分输出电压呈指数增长。在亚稳态点附近，小信号差分输出电压可以由线性时不变常微分方程 $\\,\\frac{d v_{o}(t)}{d t} = \\frac{1}{\\tau} v_{o}(t)\\,$ 建模，其中 $\\,\\tau\\,$ 是再生时间常数，由器件的跨导和有效负载电容决定。设再生开始时的初始条件为 $\\,v_{o}(0) = v_{id} + n_{in}\\,$，其中 $\\,v_{id}\\,$ 是一个确定性的输入差分电压，而 $\\,n_{in}\\,$ 是一个均值为零的随机输入参考噪声，其均方根（RMS）值为 $\\,\\sigma_{n,\\mathrm{in}}\\,$。假设当差分输出的幅度达到一个固定的阈值 $\\,V_{\\mathrm{th}}\\,$ 时，比较器做出判决，即判决时间 $\\,t_{d}\\,$ 满足 $\\,|v_{o}(t_{d})| = V_{\\mathrm{th}}\\,$。在小噪声假设 $\\,|n_{in}| \\ll |v_{id}|\\,$（因此一阶线性化有效）下，推导由 $\\,n_{in}\\,$ 引起的判决时间波动 $\\,\\sigma_{t}\\,$ 的近似标准差，用 $\\,\\tau\\,$, $\\,v_{id}\\,$ 和 $\\,\\sigma_{n,\\mathrm{in}}\\,$ 表示。\n\n然后，对 $\\,\\tau = 17.3\\,\\mathrm{ps}\\,$, $\\,v_{id} = 8.7\\,\\mathrm{mV}\\,$ 和 $\\,\\sigma_{n,\\mathrm{in}} = 0.42\\,\\mathrm{mV}\\,$ 的情况，数值计算 $\\,\\sigma_{t}\\,$。将您的答案四舍五入到三位有效数字。最终的时间抖动以皮秒为单位表示。",
            "solution": "首先通过提取给定信息并评估其科学和逻辑一致性来验证问题。\n\n### 步骤1：提取给定信息\n- 差分输出电压 $v_o(t)$ 由常微分方程控制：$\\frac{d v_{o}(t)}{d t} = \\frac{1}{\\tau} v_{o}(t)$。\n- $\\tau$ 是再生时间常数。\n- 在时间 $t=0$ 时的初始条件是 $v_{o}(0) = v_{id} + n_{in}$。\n- $v_{id}$ 是一个确定性的输入差分电压。\n- $n_{in}$ 是一个均值为零的随机输入参考噪声，其均方根（RMS）值为 $\\sigma_{n,\\mathrm{in}}$。\n- 当 $|v_{o}(t_{d})| = V_{\\mathrm{th}}$ 时，在时间 $t_d$ 做出判决，其中 $V_{\\mathrm{th}}$ 是一个固定阈值。\n- 提供了小噪声假设 $|n_{in}| \\ll |v_{id}|$，这使得线性化方法有效。\n- 目标是推导判决时间波动 $\\sigma_t$ 的近似标准差，用 $\\tau$、$v_{id}$ 和 $\\sigma_{n,\\mathrm{in}}$ 表示。\n- 用于评估的数值为：$\\tau = 17.3\\,\\mathrm{ps}$，$v_{id} = 8.7\\,\\mathrm{mV}$，以及 $\\sigma_{n,\\mathrm{in}} = 0.42\\,\\mathrm{mV}$。\n- 最终的数值答案必须以皮秒为单位，并四舍五入到三位有效数字。\n\n### 步骤2：使用提取的给定信息进行验证\n该问题具有科学依据，因为它使用了一个标准的动态比较器再生阶段的一阶线性模型，这是集成电路分析中广为接受的简化方法。再生时间常数、输入参考噪声和判决阈值的概念是比较器理论的基础。该问题定义明确，提供了一个微分方程、一个初始条件以及判决时间的边界条件。变量定义清晰，任务具体。明确陈述了小噪声假设，为近似计算提供了清晰的路径。该问题不包含科学谬误、矛盾或含糊之处。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整的解答。\n\n### 判决时间抖动的推导\n差分输出电压 $v_o(t)$ 的动态行为由以下线性时不变常微分方程描述：\n$$\n\\frac{d v_{o}(t)}{d t} = \\frac{1}{\\tau} v_{o}(t)\n$$\n这是一个可分离的一阶微分方程，其解是时间的指数函数：\n$$\nv_{o}(t) = A \\exp\\left(\\frac{t}{\\tau}\\right)\n$$\n其中 $A$ 是一个积分常数。我们使用再生开始时（$t=0$）的初始条件来确定 $A$：\n$$\nv_{o}(0) = v_{id} + n_{in}\n$$\n将此代入 $t=0$ 时的通解中：\n$$\nv_{o}(0) = A \\exp(0) = A\n$$\n因此，常数 $A$ 等于初始差分电压，而 $v_o(t)$ 的特解是：\n$$\nv_{o}(t) = (v_{id} + n_{in}) \\exp\\left(\\frac{t}{\\tau}\\right)\n$$\n当输出电压的幅度达到阈值 $V_{\\mathrm{th}}$ 时，比较器在时间 $t_d$ 达到判决状态：\n$$\n|v_{o}(t_d)| = V_{\\mathrm{th}}\n$$\n代入 $v_o(t)$ 的表达式：\n$$\n\\left|(v_{id} + n_{in}) \\exp\\left(\\frac{t_d}{\\tau}\\right)\\right| = V_{\\mathrm{th}}\n$$\n由于 $\\exp(t_d/\\tau)$ 总是正的，我们可以写成：\n$$\n|v_{id} + n_{in}| \\exp\\left(\\frac{t_d}{\\tau}\\right) = V_{\\mathrm{th}}\n$$\n问题陈述了小噪声条件 $|n_{in}| \\ll |v_{id}|$。这意味着项 $(v_{id} + n_{in})$ 的符号由 $v_{id}$ 的符号决定。不失一般性，我们假设 $v_{id}  0$（因此 $v_{id} + n_{in}  0$）和 $V_{\\mathrm{th}}  0$。对于 $v_{id}  0$ 的推导，将得到完全相同的标准差最终结果。\n在此假设下，方程变为：\n$$\n(v_{id} + n_{in}) \\exp\\left(\\frac{t_d}{\\tau}\\right) = V_{\\mathrm{th}}\n$$\n我们现在求解判决时间 $t_d$：\n$$\n\\exp\\left(\\frac{t_d}{\\tau}\\right) = \\frac{V_{\\mathrm{th}}}{v_{id} + n_{in}}\n$$\n对两边取自然对数：\n$$\n\\frac{t_d}{\\tau} = \\ln\\left(\\frac{V_{\\mathrm{th}}}{v_{id} + n_{in}}\\right) = \\ln(V_{\\mathrm{th}}) - \\ln(v_{id} + n_{in})\n$$\n所以，判决时间 $t_d$ 是随机噪声变量 $n_{in}$ 的函数：\n$$\nt_d(n_{in}) = \\tau \\left[ \\ln(V_{\\mathrm{th}}) - \\ln(v_{id} + n_{in}) \\right]\n$$\n为了找到由 $n_{in}$ 引起的 $t_d$ 波动的标准差，我们使用 $t_d(n_{in})$ 在 $n_{in}=0$ 附近的一阶泰勒级数展开。小噪声假设为此提供了依据。\n$$\nt_d(n_{in}) \\approx t_d(0) + \\left. \\frac{d t_d}{d n_{in}} \\right|_{n_{in}=0} \\cdot n_{in}\n$$\n判决时间的波动 $\\Delta t_d$ 是有噪声的时间与标称时间之间的差值：\n$$\n\\Delta t_d = t_d(n_{in}) - t_d(0) \\approx \\left. \\frac{d t_d}{d n_{in}} \\right|_{n_{in}=0} \\cdot n_{in}\n$$\n我们计算 $t_d$ 对 $n_{in}$ 的导数：\n$$\n\\frac{d t_d}{d n_{in}} = \\frac{d}{d n_{in}} \\left( \\tau \\left[ \\ln(V_{\\mathrm{th}}) - \\ln(v_{id} + n_{in}) \\right] \\right) = -\\tau \\frac{1}{v_{id} + n_{in}}\n$$\n在 $n_{in}=0$ 处计算该导数：\n$$\n\\left. \\frac{d t_d}{d n_{in}} \\right|_{n_{in}=0} = -\\frac{\\tau}{v_{id}}\n$$\n因此，波动 $\\Delta t_d$ 近似为：\n$$\n\\Delta t_d \\approx -\\frac{\\tau}{v_{id}} n_{in}\n$$\n判决时间的标准差 $\\sigma_t$ 是此波动的均方根。由于 $n_{in}$ 是一个均值为零的随机变量，$\\Delta t_d$ 的均值也为零。方差 $\\sigma_t^2$ 是 $(\\Delta t_d)^2$ 的期望值：\n$$\n\\sigma_t^2 = E[(\\Delta t_d)^2] \\approx E\\left[\\left(-\\frac{\\tau}{v_{id}} n_{in}\\right)^2\\right] = \\frac{\\tau^2}{v_{id}^2} E[n_{in}^2]\n$$\n问题陈述输入噪声的均方根（RMS）值为 $\\sigma_{n,\\mathrm{in}}$。对于一个均值为零的变量，其方差是均方根值的平方，所以 $E[n_{in}^2] = \\sigma_{n,\\mathrm{in}}^2$。将此代入 $\\sigma_t^2$ 的方程中：\n$$\n\\sigma_t^2 = \\frac{\\tau^2 \\sigma_{n,\\mathrm{in}}^2}{v_{id}^2}\n$$\n取平方根得到标准差 $\\sigma_t$。由于标准差是非负的，我们对 $v_{id}$ 使用绝对值：\n$$\n\\sigma_t = \\frac{\\tau \\sigma_{n,\\mathrm{in}}}{|v_{id}|}\n$$\n\n### 数值计算\n我们给定以下数值：\n- $\\tau = 17.3\\,\\mathrm{ps} = 17.3 \\times 10^{-12}\\,\\mathrm{s}$\n- $v_{id} = 8.7\\,\\mathrm{mV} = 8.7 \\times 10^{-3}\\,\\mathrm{V}$\n- $\\sigma_{n,\\mathrm{in}} = 0.42\\,\\mathrm{mV} = 0.42 \\times 10^{-3}\\,\\mathrm{V}$\n\n我们将这些值代入推导出的 $\\sigma_t$ 表达式中：\n$$\n\\sigma_t = \\frac{(17.3\\,\\mathrm{ps}) (0.42\\,\\mathrm{mV})}{8.7\\,\\mathrm{mV}}\n$$\n电压单位 $(\\mathrm{mV})$ 相互抵消，结果的单位为皮秒 $(\\mathrm{ps})$：\n$$\n\\sigma_t = 17.3 \\times \\frac{0.42}{8.7}\\,\\mathrm{ps}\n$$\n$$\n\\sigma_t = 17.3 \\times 0.04827586... \\,\\mathrm{ps}\n$$\n$$\n\\sigma_t \\approx 0.8351724... \\,\\mathrm{ps}\n$$\n问题要求答案四舍五入到三位有效数字。\n$$\n\\sigma_t \\approx 0.835\\,\\mathrm{ps}\n$$",
            "answer": "$$\n\\boxed{0.835}\n$$"
        },
        {
            "introduction": "这最后一个练习将器件级设计与系统级性能要求联系起来，这是现代集成电路设计中的关键一步。首先，通过推导N位模数转换器 (ADC) 的失调容差，您将把一个器件参数直接与系统规格联系起来。随后的任务是编写一个蒙特卡洛模拟脚本来优化晶体管尺寸以提高良率，这将引入一种强大的、符合行业标准的EDA方法，用以设计能够应对制造变化的稳健电路。",
            "id": "4300798",
            "problem": "考虑在模数转换器 (ADC) 中使用的比较器的输入参考失调设计。使用量化和判决电平的定义，推导为保持正确的比特判决和单调的代码转换，对输入参考失调电压 $V_{\\mathrm{os}}$ 的约束条件：证明其要求为 $|V_{\\mathrm{os}}|\\le \\tfrac{1}{2}\\mathrm{LSB}$，其中对于一个具有全量程输入范围 $V_{\\mathrm{FS}}$ 的 $N$ 位 ADC，$\\mathrm{LSB}=\\dfrac{V_{\\mathrm{FS}}}{2^{N}}$。因此，得出结论，失调边界变为 $|V_{\\mathrm{os}}|\\le \\dfrac{V_{\\mathrm{FS}}}{2^{N+1}}$。\n\n接下来，使用 Pelgrom 失配定律对随机失配进行建模。假设相同尺寸晶体管的阈值电压失配的标准差为 $\\sigma(\\Delta V_{\\mathrm{t}})=\\dfrac{A_{V_{\\mathrm{t}}}}{\\sqrt{W L}}$，电流因子失配的标准差为 $\\sigma\\!\\left(\\dfrac{\\Delta \\beta}{\\beta}\\right)=\\dfrac{A_{\\beta}}{\\sqrt{W L}}$，其中 $W$ 是晶体管宽度，$L$ 是晶体管长度，$A_{V_{\\mathrm{t}}}$ 和 $A_{\\beta}$ 是 Pelgrom 系数，$\\beta$ 是跨导参数。考虑一个对称差分输入对比较器（静态）和一个动态再生比较器；在这两种比较器中，跨工艺、电压、温度 (PVT) 角点的输入参考失调主要由输入对失配决定，并且可以通过与架构相关的灵敏度系数进行参数化。具体来说，在由输入对过驱动电压 $V_{\\mathrm{ov}}$ 表征的给定工艺、电压、温度 (PVT) 角点下，输入参考失调被建模为失配贡献的线性组合，其中架构相关的灵敏度系数在测试套件中提供。\n\n你的任务是编写一个完整的程序，该程序针对几个测试用例，计算输入晶体管（假设尺寸相同）所需的最小晶体管宽度 $W$（单位为 $\\mu\\mathrm{m}$），以在所有 PVT 角点上达到目标良率。良率定义为，在蒙特卡洛失配采样下，对于给定的 $W$，输入参考失调的绝对值 $|V_{\\mathrm{os}}|$ 对所有 PVT 角点同时小于或等于 $\\tfrac{1}{2}\\mathrm{LSB}$ 的概率。使用固定的伪随机种子，以使结果具有确定性。\n\n使用的基本原理：\n- $N$ 位 ADC 的量化：$\\mathrm{LSB}=\\dfrac{V_{\\mathrm{FS}}}{2^{N}}$。\n- 判决正确性条件：由于输入参考失调，比较器判决边界的偏移量不得超过 $\\tfrac{1}{2}\\mathrm{LSB}$，以保持正确的编码。\n- Pelgrom 失配定律：$\\sigma(\\Delta V_{\\mathrm{t}})=\\dfrac{A_{V_{\\mathrm{t}}}}{\\sqrt{W L}}$ 和 $\\sigma\\!\\left(\\dfrac{\\Delta \\beta}{\\beta}\\right)=\\dfrac{A_{\\beta}}{\\sqrt{W L}}$。\n- 高斯失配：$\\Delta V_{\\mathrm{t}}$ 和 $\\dfrac{\\Delta \\beta}{\\beta}$ 是独立的、零均值的高斯随机变量，其标准差如上所述。\n\n程序设计要求：\n- 实现一个带有固定伪随机种子的蒙特卡洛估计器，以评估良率，即在给定 $W$ 的情况下，满足所有角点 $|V_{\\mathrm{os}}|\\le \\tfrac{1}{2}\\mathrm{LSB}$ 的样本比例。\n- 对于每种架构，使用测试用例中由灵敏度系数指定的输入参考失调映射。设 $k_{V_{\\mathrm{t}}}$ 和 $k_{\\beta}$ 表示灵敏度系数；则在过驱动电压为 $V_{\\mathrm{ov}}$ 的角点中，将蒙特卡洛样本的输入参考失调建模为\n  $$V_{\\mathrm{os}}=k_{V_{\\mathrm{t}}}\\,\\Delta V_{\\mathrm{t}}+k_{\\beta}\\,\\frac{V_{\\mathrm{ov}}}{2}\\,\\frac{\\Delta \\beta}{\\beta}.$$\n- 在指定边界内搜索可实现所有角点至少达到目标良率的最小 $W$。使用单调搜索，例如对 $W$ 进行二分搜索。\n- 在搜索中对所有 $W$ 使用相同的蒙特卡洛标准正态抽样，通过按 $\\dfrac{1}{\\sqrt{W L}}$ 进行缩放来减少二分搜索期间的方差。\n\n物理和数值单位：\n- $V_{\\mathrm{FS}}$ 和 $V_{\\mathrm{ov}}$ 以 $\\mathrm{V}$ 表示。\n- $W$ 和 $L$ 以 $\\mu\\mathrm{m}$ 表示。\n- 最终宽度必须以 $\\mu\\mathrm{m}$ 报告，并四舍五入到三位小数。\n\n角度单位不适用。百分比必须表示为小数。\n\n测试套件：\n每个测试用例是一个元组，包含 $(\\text{architecture}, N, V_{\\mathrm{FS}}, \\text{yield}, L, W_{\\min}, W_{\\max}, A_{V_{\\mathrm{t}}}, A_{\\beta}, [V_{\\mathrm{ov},i}], k_{V_{\\mathrm{t}}}, k_{\\beta})$，如上所述进行解释。使用以下测试用例：\n- 用例 $1$：$(\\text{static},\\,10,\\,1.8,\\,0.9973,\\,0.18,\\,0.5,\\,200.0,\\,0.003,\\,0.02,\\,[0.18,\\,0.14,\\,0.22],\\,1.0,\\,1.0)$。\n- 用例 $2$：$(\\text{dynamic},\\,12,\\,1.2,\\,0.99,\\,0.16,\\,0.3,\\,300.0,\\,0.002,\\,0.015,\\,[0.16,\\,0.12,\\,0.20],\\,0.7,\\,0.5)$。\n- 用例 $3$：$(\\text{static},\\,16,\\,1.0,\\,0.999,\\,0.09,\\,0.2,\\,1000.0,\\,0.0025,\\,0.01,\\,[0.10,\\,0.08,\\,0.12],\\,1.0,\\,1.0)$。\n- 用例 $4$：$(\\text{dynamic},\\,8,\\,0.5,\\,0.95,\\,0.07,\\,0.2,\\,100.0,\\,0.003,\\,0.02,\\,[0.08,\\,0.06,\\,0.10],\\,0.7,\\,0.6)$。\n\n算法规范：\n- 使用固定的伪随机种子 $12345$。\n- 每个用例至少使用 $20000$ 个蒙特卡洛样本。\n- 如果在 $W_{\\max}$ 时无法达到目标良率，则该用例返回 $W_{\\max}$。\n\n最终输出格式：\n您的程序应产生单行输出，其中包含四个测试用例的最小宽度结果，格式为逗号分隔的列表，并用方括号括起来，每个宽度以 $\\mu\\mathrm{m}$ 为单位四舍五入到三位小数（例如，$[w_1,w_2,w_3,w_4]$）。",
            "solution": "该问题要求我们确定比较器输入对的最小晶体管宽度 $W$，以满足基于输入参考失调电压 $V_{\\mathrm{os}}$ 的给定良率标准。解决方案包括三个主要部分：首先，对保证模数转换器 (ADC) 正确操作的 $V_{\\mathrm{os}}$ 约束进行理论推导；其次，建立基于器件失配的 $V_{\\mathrm{os}}$ 统计模型；第三，开发用于找到所需最小 $W$ 的数值算法。\n\n### 1. 输入参考失调约束的推导\n\n一个 $N$ 位 ADC 将全量程范围 $V_{\\mathrm{FS}}$ 内的连续模拟输入电压 $V_{\\mathrm{in}}$ 量化为 $2^N$ 个离散数字电平。量化器的分辨率由最低有效位 (LSB) 定义，其公式为：\n$$\n\\mathrm{LSB} = \\frac{V_{\\mathrm{FS}}}{2^N}\n$$\n理想判决电平（或阈值）$V_{\\mathrm{d},k}$ 是 ADC 输出从一个数字码 $k$ 转换到下一个数字码 $k+1$ 时的输入电压。对于均匀量化器，这些电平位于标称量化电平的中间。理想判决电平由以下公式给出：\n$$\nV_{\\mathrm{d},k} = (k + \\frac{1}{2}) \\mathrm{LSB}, \\quad \\text{for } k = 0, 1, \\dots, 2^N - 2\n$$\n比较器是将 $V_{\\mathrm{in}}$ 与这些判决电平进行比较的核心组件。一个输入为 $V_+$ 和 $V_-$ 的理想比较器在 $V_+ = V_-$ 时发生翻转。然而，由于制造缺陷，实际比较器存在非零的输入参考失调电压 $V_{\\mathrm{os}}$。该比较器在 $V_+ - V_- = V_{\\mathrm{os}}$ 时发生翻转。这意味着有效判决电平 $V'_{\\mathrm{d},k}$ 相对于理想电平偏移了 $V_{\\mathrm{os}}$：\n$$\nV'_{\\mathrm{d},k} = V_{\\mathrm{d},k} + V_{\\mathrm{os}}\n$$\n为确保 ADC 保持单调行为（即输出码不会随着输入电压的增加而减少）并且没有丢失码，偏移后的判决电平不得越过其相邻的理想电平。代码 $k$ 的“量化区间”是电压范围 $[V_{\\mathrm{d},k-1}, V_{\\mathrm{d},k}]$，其宽度为 $\\mathrm{LSB}$。为了正确量化，实际判决电平 $V'_{\\mathrm{d},k}$ 必须保持在比任何其他位置更靠近其自身的理想位置 $V_{\\mathrm{d},k}$。偏移的容差边界是到下一个理想判决电平的一半距离。相邻理想判决电平之间的距离是 $\\mathrm{LSB}$。因此，偏移的幅度 $|V_{\\mathrm{os}}|$ 必须小于该距离的一半：\n$$\n|V_{\\mathrm{os}}| \\le \\frac{1}{2} \\mathrm{LSB}\n$$\n代入 $\\mathrm{LSB}$ 的表达式，我们得到输入参考失调的最终约束：\n$$\n|V_{\\mathrm{os}}| \\le \\frac{1}{2} \\left( \\frac{V_{\\mathrm{FS}}}{2^N} \\right) = \\frac{V_{\\mathrm{FS}}}{2^{N+1}}\n$$\n这个不等式是在存在比较器失调的情况下保证 ADC 正确操作必须满足的基本要求。\n\n### 2. 输入参考失调的统计失配模型\n\n输入参考失调 $V_{\\mathrm{os}}$ 主要由比较器输入差分对中晶体管的物理和电气特性的随机失配引起。问题提供了一个基于两个主要失配源的 $V_{\\mathrm{os}}$ 线性化模型：阈值电压失配 $\\Delta V_{\\mathrm{t}}$ 和电流因子失配 $\\frac{\\Delta \\beta}{\\beta}$。\n$$\nV_{\\mathrm{os}} = k_{V_{\\mathrm{t}}}\\,\\Delta V_{\\mathrm{t}} + k_{\\beta}\\,\\frac{V_{\\mathrm{ov}}}{2}\\,\\frac{\\Delta \\beta}{\\beta}\n$$\n此处，$k_{V_{\\mathrm{t}}}$ 和 $k_{\\beta}$ 是与架构相关的灵敏度系数，$V_{\\mathrm{ov}}$ 是输入对的过驱动电压，它取决于工艺、电压和温度 (PVT) 角点。\n\n随机失配效应由 Pelgrom 定律建模，该定律指出失配参数的标准差与晶体管面积 $W L$ 的平方根成反比。\n$$\n\\sigma(\\Delta V_{\\mathrm{t}}) = \\frac{A_{V_{\\mathrm{t}}}}{\\sqrt{W L}} \\quad \\text{and} \\quad \\sigma\\left(\\frac{\\Delta \\beta}{\\beta}\\right) = \\frac{A_{\\beta}}{\\sqrt{W L}}\n$$\n其中 $A_{V_{\\mathrm{t}}}$ 和 $A_{\\beta}$ 是特定于工艺的 Pelgrom 系数，$W$ 是晶体管栅极宽度，$L$ 是栅极长度。\n\n由于 $\\Delta V_{\\mathrm{t}}$ 和 $\\frac{\\Delta \\beta}{\\beta}$ 被建模为独立的、零均值的高斯随机变量，因此 $V_{\\mathrm{os}}$ 也是一个零均值的高斯随机变量。对于给定的 PVT 角点（由 $V_{\\mathrm{ov}}$ 表征），其方差 $\\sigma_{V_{\\mathrm{os}}}^2$ 是各个项方差的总和：\n$$\n\\sigma_{V_{\\mathrm{os}}}^2(V_{\\mathrm{ov}}) = \\left(k_{V_{\\mathrm{t}}}\\right)^2 \\sigma^2(\\Delta V_{\\mathrm{t}}) + \\left(k_{\\beta} \\frac{V_{\\mathrm{ov}}}{2}\\right)^2 \\sigma^2\\left(\\frac{\\Delta \\beta}{\\beta}\\right)\n$$\n代入标准差的 Pelgrom 模型：\n$$\n\\sigma_{V_{\\mathrm{os}}}^2(V_{\\mathrm{ov}}) = \\left(k_{V_{\\mathrm{t}}}\\right)^2 \\frac{A_{V_{\\mathrm{t}}}^2}{W L} + \\left(k_{\\beta} \\frac{V_{\\mathrm{ov}}}{2}\\right)^2 \\frac{A_{\\beta}^2}{W L} = \\frac{1}{W L} \\left[ (k_{V_{\\mathrm{t}}} A_{V_{\\mathrm{t}}})^2 + \\left(k_{\\beta} \\frac{V_{\\mathrm{ov}}}{2} A_{\\beta}\\right)^2 \\right]\n$$\n这个方程表明，失调的标准差 $\\sigma_{V_{\\mathrm{os}}}$ 与 $\\frac{1}{\\sqrt{W}}$ 成正比。增加晶体管宽度 $W$ 会减少失配，从而降低失调电压的标准差，导致满足约束 $|V_{\\mathrm{os}}| \\le \\frac{V_{\\mathrm{FS}}}{2^{N+1}}$ 的概率更高。\n\n### 3. 最小宽度计算的算法方法\n\n目标是找到在给定范围 $[W_{\\min}, W_{\\max}]$ 内的最小宽度 $W$，使得良率至少达到目标值。良率定义为失调约束在所有指定的 PVT 角点上同时满足的概率。一个制造出的器件具有物理失配（$\\Delta V_{\\mathrm{t}}$，$\\frac{\\Delta \\beta}{\\beta}$）的单个实例，但其失调电压 $V_{\\mathrm{os}}$ 会随操作条件（$V_{\\mathrm{ov}}$）而变化。因此，对于单个蒙特卡洛样本，我们必须验证所有角点的条件。\n\n算法流程如下：\n\n1.  **蒙特卡洛设置**：对于每个测试用例，我们生成大量的随机样本，数量为 $M=20000$。为了在搜索 $W$ 的过程中提高效率并减少方差，我们生成 $M$ 对标准正态随机变量 $(z_{V_{\\mathrm{t}}, j}, z_{\\beta, j})$，其中 $j=1, \\dots, M$。然后，这些变量用于创建与几何尺寸无关的“基础”失配样本：\n    $$\n    \\Delta V_{\\mathrm{t}, j, \\text{base}} = z_{V_{\\mathrm{t}}, j} \\cdot A_{V_{\\mathrm{t}}} \\quad \\text{and} \\quad \\left(\\frac{\\Delta \\beta}{\\beta}\\right)_{j, \\text{base}} = z_{\\beta, j} \\cdot A_{\\beta}\n    $$\n    对于任何几何尺寸 $(W, L)$，样本 $j$ 的实际失配可以通过缩放找到：\n    $$\n    \\Delta V_{\\mathrm{t}, j} = \\frac{\\Delta V_{\\mathrm{t}, j, \\text{base}}}{\\sqrt{W L}} \\quad \\text{and} \\quad \\left(\\frac{\\Delta \\beta}{\\beta}\\right)_{j} = \\frac{\\left(\\frac{\\Delta \\beta}{\\beta}\\right)_{j, \\text{base}}}{\\sqrt{W L}}\n    $$\n2.  **良率评估函数 `Yield(W)`**：创建一个函数来计算给定宽度 $W$ 的良率。\n    - 对于 $M$ 个基础失配样本中的每一个，计算按几何尺寸缩放的失配值。\n    - 对于每个缩放后的失配样本，计算每个 PVT 角点 $i$（及其对应的 $V_{\\mathrm{ov},i}$）的失调电压 $V_{\\mathrm{os},i}$。\n    - 只有当所有角点 $i$ 都满足 $|V_{\\mathrm{os},i}| \\le \\frac{V_{\\mathrm{FS}}}{2^{N+1}}$ 时，一个样本才被认为是‘好的’。\n    - 良率是‘好的’样本总数除以 $M$。\n\n3.  **二分搜索**：由于良率是关于 $W$ 的单调非减函数，我们可以使用二分搜索算法在区间 $[W_{\\min}, W_{\\max}]$ 上高效地找到所需的最小 $W$。\n    - 初始化 `low = W_min`，`high = W_max`，以及一个候选答案 `ans = W_max`。\n    - 首先，我们检查即使使用最大可能的宽度 $W_{\\max}$ 是否能达到目标良率。如果 `Yield(W_max)` 小于目标良率，则在边界内不存在解，我们按照问题规范返回 $W_{\\max}$。\n    - 否则，我们进行足够次数的迭代：\n        a. 设置 `mid = (low + high) / 2`。\n        b. 评估 `Yield(mid)`。\n        c. 如果 `Yield(mid)` 大于或等于目标良率，`mid` 是一个潜在解。我们记录它（`ans = mid`），并通过设置 `high = mid` 尝试找到一个更小的有效宽度。\n        d. 如果 `Yield(mid)` 小于目标良率，则 `mid` 太小。我们必须通过设置 `low = mid` 来增加宽度。\n    - 搜索收敛后，`ans` 将持有满足标准的最小宽度。然后将此值四舍五入到三位小数。\n\n这种理论建模、统计仿真和数值优化的组合，为设计满足严格性能和良率要求的比较器输入级提供了一种鲁棒的方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the minimum transistor width W for comparator input pairs to meet\n    a specified yield target for input-referred offset voltage.\n    \"\"\"\n    \n    # Test cases defined in the problem statement\n    test_cases = [\n        # (architecture, N, V_FS, yield, L, W_min, W_max, A_Vt, A_beta, [V_ov_i], k_Vt, k_beta)\n        ('static', 10, 1.8, 0.9973, 0.18, 0.5, 200.0, 0.003, 0.02, [0.18, 0.14, 0.22], 1.0, 1.0),\n        ('dynamic', 12, 1.2, 0.99, 0.16, 0.3, 300.0, 0.002, 0.015, [0.16, 0.12, 0.20], 0.7, 0.5),\n        ('static', 16, 1.0, 0.999, 0.09, 0.2, 1000.0, 0.0025, 0.01, [0.10, 0.08, 0.12], 1.0, 1.0),\n        ('dynamic', 8, 0.5, 0.95, 0.07, 0.2, 100.0, 0.003, 0.02, [0.08, 0.06, 0.10], 0.7, 0.6),\n    ]\n\n    # Algorithmic specifications\n    NUM_SAMPLES = 20000\n    RANDOM_SEED = 12345\n    BINARY_SEARCH_ITERATIONS = 100\n\n    results = []\n    \n    # Initialize random number generator with a fixed seed for reproducibility\n    rng = np.random.default_rng(RANDOM_SEED)\n    \n    # Generate standard normal random variables once for all test cases and simulations\n    # This ensures consistency and fairness in comparison.\n    # Generate two sets, one for dVt and one for dbeta/beta\n    z_vt_samples = rng.standard_normal(NUM_SAMPLES)\n    z_beta_samples = rng.standard_normal(NUM_SAMPLES)\n\n    for case in test_cases:\n        (arch, N, V_FS, target_yield, L, W_min, W_max, \n         A_Vt, A_beta, V_ov_corners, k_Vt, k_beta) = case\n\n        # Calculate the maximum allowed input-referred offset\n        V_os_max = V_FS / (2**(N + 1))\n\n        # Generate base mismatch samples, independent of geometry (W, L)\n        delta_vt_base = z_vt_samples * A_Vt\n        delta_beta_base = z_beta_samples * A_beta\n        \n        # Pre-calculate offset terms for each corner that depend on V_ov\n        vov_corners_np = np.array(V_ov_corners)\n        \n        # The offset contribution from Vt mismatch for each sample. Shape (num_samples,)\n        term_vt = k_Vt * delta_vt_base\n        \n        # The offset contribution from beta mismatch for each corner and sample. Shape (num_corners, num_samples)\n        beta_coeffs = k_beta * vov_corners_np[:, np.newaxis] / 2\n        term_beta = beta_coeffs * delta_beta_base\n\n        def calculate_yield(W):\n            \"\"\"\n            Calculates the yield for a given transistor width W using Monte Carlo simulation.\n            \"\"\"\n            if W == 0:\n                return 0.0\n                \n            # Scale factor for mismatch standard deviation\n            scale_factor = 1.0 / np.sqrt(W * L)\n            \n            # V_os for all samples and all corners. Shape (num_corners, num_samples)\n            # Broadcasting adds the (num_samples,) array to each row of the (num_corners, num_samples) array\n            V_os_samples = (term_vt + term_beta) * scale_factor\n            \n            # Check if |V_os| = V_os_max for all corners\n            # max() along axis 0 finds the max absolute offset over all corners for each sample\n            max_abs_vos_per_sample = np.max(np.abs(V_os_samples), axis=0)\n            \n            # Count how many samples pass the criterion\n            passed_samples = np.sum(max_abs_vos_per_sample = V_os_max)\n            \n            return passed_samples / NUM_SAMPLES\n\n        # Check if the target yield is achievable at W_max\n        if calculate_yield(W_max)  target_yield:\n            results.append(round(W_max, 3))\n            continue\n\n        # Binary search for the minimum W\n        low = W_min\n        high = W_max\n        ans = W_max\n        \n        for _ in range(BINARY_SEARCH_ITERATIONS):\n            mid = (low + high) / 2\n            if mid == low or mid == high: # Avoid getting stuck\n                break\n                \n            current_yield = calculate_yield(mid)\n            \n            if current_yield >= target_yield:\n                # Met the target, try for a smaller W\n                ans = mid\n                high = mid\n            else:\n                # Did not meet the target, need a larger W\n                low = mid\n        \n        results.append(round(ans, 3))\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}