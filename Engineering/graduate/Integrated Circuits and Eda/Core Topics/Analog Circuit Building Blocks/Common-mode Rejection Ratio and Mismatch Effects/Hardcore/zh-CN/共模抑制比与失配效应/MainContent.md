## 引言
模拟与混合信号集成电路的精度，从根本上受其抑制无关共模噪声能力的限制。[共模抑制比](@entry_id:271843)（CMRR）是量化此能力的关键指标，但其性能不可避免地会因[器件失配](@entry_id:1123618)而下降。本文旨在填补理想的完美[对称差](@entry_id:156264)分电路与其充满非理想性的现实实现之间的关键知识鸿沟。我们将开启一段全面的探索之旅来理解这一挑战。

第一章“原理与机制”将奠定理论基石，剖析不对称性和有限阻抗如何导致CMRR退化。在此基础上，第二章“应用与跨学科连接”将展示CMRR在从生物医学传感器到高精度物理学等领域的深远影响，揭示其作为一个系统级问题的重要性。最后，“动手实践”部分将连接理论与实践，提供分析、仿真乃至校准失配效应的练习。通过这种结构化的探索，读者将对如何在复杂电子系统中设计和优化高CMRR获得深刻而实用的理解。

## 原理与机制

在深入研究[共模抑制比](@entry_id:271843)（CMRR）及其在集成电路设计中的核心作用之前，我们必须首先建立一个坚实的理论基础。本章将系统地阐述[差分信号](@entry_id:260727)处理的基本原理，从理想对称性出发，逐步揭示非理想因素（如失配和有限阻抗）如何导致性能下降。我们将探讨[共模信号](@entry_id:264851)和差分信号的数学描述，量化衡量电路抑制能力的指标，剖析共模到差模转换的关键物理机制，并分析这些效应的频率依赖性。最后，我们将讨论[共模反馈](@entry_id:266519)（CMFB）这一主动控制技术，它是现代[全差分放大器](@entry_id:268611)设计的基石。

### 对称性、模态与理想抑制

差分电路的核心优势源于其 **对称性（symmetry）**。一个理想的[差分放大器](@entry_id:272747)在物理结构和电气特性上是完全对称的。这种对称性不仅仅是美学上的要求，它具有深刻的数学和物理内涵，直接导致了[共模信号](@entry_id:264851)与[差分信号](@entry_id:260727)的[解耦](@entry_id:160890)。

我们可以将输入电压对 $(v_1, v_2)$ 分解为两个正交的模式：**共模（common-mode, CM）**分量和 **差模（differential-mode, DM）**分量。

**[共模电压](@entry_id:267734)** $v_{cm}$ 定义为两个输入电压的平均值：
$$
v_{cm} = \frac{v_1 + v_2}{2}
$$
它代表了两个输入共同经历的信号扰动，例如电源噪声、衬底噪声或信号源的直流偏置变化。

**差模电压** $v_d$ 定义为两个输入电压之差：
$$
v_d = v_1 - v_2
$$
它代表了我们真正关心的、承载信息的信号。

在一个对称的[线性时不变](@entry_id:276287)（LTI）网络中，我们可以从更抽象的线性代数角度来理解这种分解 。考虑一个交换端口节点1和2的置换算子 $\mathbf{S} = \begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}$。网络的对称性意味着其导纳矩阵 $\mathbf{Y}$ 与 $\mathbf{S}$ 可交换，即 $\mathbf{SYS} = \mathbf{Y}$。共模和差模激励可以由 $\mathbf{S}$ 的[特征向量](@entry_id:151813)表示：
- **偶模（Even Mode）** 或共模基向量：$\mathbf{e} \propto \begin{pmatrix} 1 \\ 1 \end{pmatrix}$，对应特征值 $+1$。
- **奇模（Odd Mode）** 或差模基向量：$\mathbf{o} \propto \begin{pmatrix} 1 \\ -1 \end{pmatrix}$，对应特征值 $-1$。

由于 $\mathbf{Y}$ 与 $\mathbf{S}$ 可交换，它们共享相同的[特征向量](@entry_id:151813)。这意味着 $\mathbf{Y}$ 在 $\{\mathbf{e}, \mathbf{o}\}$ 基下是对角的。其物理意义是：当网络受到纯共模激励（即电压向量与 $\mathbf{e}$ 成比例）时，其响应电流也必然是纯共模的。同样，纯差模激励也只产生纯差模响应。换言之，**在理想对称的电路中，共模与差模之间不存在任何耦合或转换**。

一个理想的[差分放大器](@entry_id:272747)正是利用了这一原理。它被设计为对[差模信号](@entry_id:272661)具有高增益，而对[共模信号](@entry_id:264851)的增益为零。因此，对于一个纯共模输入，其差分输出应严格为零。这种对[共模信号](@entry_id:264851)的理想抑制能力，是差分电路在充满噪声的真实环境中能够精确提取微弱信号的关键。

### 量化抑制能力：CMRR 与 PSRR

在现实世界中，完美的对称性是不存在的。器件的制造偏差、版图的不对称以及非理想的[偏置电路](@entry_id:1121543)都会破坏这种理想的平衡。因此，我们需要一个量化的指标来衡量一个实际的[差分放大器](@entry_id:272747)抑制[共模信号](@entry_id:264851)的能力，这个指标就是 **[共模抑制比](@entry_id:271843)（Common-Mode Rejection Ratio, CMRR）**。

#### [共模抑制比](@entry_id:271843) (CMRR)

当对称性被破坏时，一部分共模输入信号会“泄漏”并转换为差分输出信号。我们定义两个关键的增益：
- **[差模增益](@entry_id:264461) ($A_d$)**：从差分输入到差分输出的增益，$A_d = v_{od} / v_{id}$。
- **共模到差模转换增益 ($A_{cd}$)**：从共模输入到差分输出的增益，$A_{cd} = v_{od} / v_{icm}$。

**CMRR** 被定义为这两个增益幅度的比值：
$$
\mathrm{CMRR} = \left| \frac{A_d}{A_{cd}} \right|
$$
一个高的CMRR值意味着放大器对期望的[差分信号](@entry_id:260727)的放大能力远强于其将不期望的[共模信号](@entry_id:264851)转换为差分输出的能力。

在工程实践中，CMRR通常用分贝（dB）表示。由于分贝最初是为功率比定义的（$10\log_{10}(P_2/P_1)$），而功率与电压（或电流）的平方成正比，因此电压比的分贝表示使用 $20$ 作为系数 ：
$$
\mathrm{CMRR_{dB}} = 20 \log_{10} \left( \left| \frac{A_d}{A_{cd}} \right| \right)
$$
例如，CMRR为 $1000$ 对应于 $60\,\mathrm{dB}$。

#### [电源抑制比](@entry_id:268797) (PSRR) 与 CMRR 的关系

电源电压的波动（即 **[电源纹波](@entry_id:271017)**）是集成电路中一种普遍存在的共模噪声源。**[电源抑制比](@entry_id:268797)（Power Supply Rejection Ratio, PSRR）** 衡量了放大器抑制这种电源噪声的能力。对于[差分放大器](@entry_id:272747)，我们特别关心从[电源纹波](@entry_id:271017)到差分输出的增益，记为 $A_{dd-d}$。PSRR 通常定义为[差模增益](@entry_id:264461)与此电源增益的比值：
$$
\mathrm{PSRR} = \left| \frac{A_d}{A_{dd-d}} \right|
$$
[电源纹波](@entry_id:271017)本质上是一个共模事件，它会同等地影响电路的两个对称半边。因此，电源噪声在电路内部的表现形式与共模输入信号非常相似。当存在失配时，这种内部的共模扰动就会转换为差分输出。这表明，有限的PSRR和有限的CMRR根源是相同的：**电路对称性的破坏**。

我们可以量化这种关系。由[电源纹波](@entry_id:271017) $V_s$ 产生的差分输出纹波幅度为 $|A_{dd-d}| V_s$。要产生同样大小的输出纹波，所需要的等效输入[共模信号](@entry_id:264851)幅度 $V_{cm,eq}$ 满足 $|A_{cd}| V_{cm,eq} = |A_{dd-d}| V_s$。整理可得 ：
$$
V_{cm,eq} = \frac{|A_{dd-d}|}{|A_{cd}|} V_s = \frac{\mathrm{CMRR}}{\mathrm{PSRR}} V_s
$$
这个简洁的公式深刻地揭示了[电源抑制](@entry_id:1130064)和[共模抑制](@entry_id:265391)之间的内在联系。例如，一个在某频率下PSRR为 $72\,\mathrm{dB}$、CMRR为 $58\,\mathrm{dB}$ 的放大器，当面临 $25\,\mathrm{mV}$ 的[电源纹波](@entry_id:271017)时，其表现等效于受到一个幅度为 $V_{cm,eq} = (10^{58/20} / 10^{72/20}) \times 25\,\mathrm{mV} \approx 4.99\,\mathrm{mV}$ 的输入[共模信号](@entry_id:264851)。

### CMRR 退化机制：对称性的破坏

一个有限的CMRR（即一个非零的 $A_{cd}$）的产生，通常需要两个条件同时满足：
1.  **一个允许共模输入信号改变电路内部工作点的机制。**
2.  **电路中存在的不对称性（失配），使得上述[工作点](@entry_id:173374)的变化在两个半边电路中产生不等的响应，从而导致非零的差分输出。**

在典型的[MOS差分对](@entry_id:272034)中，最关键的因素是 **有限的[尾电流源](@entry_id:262705)阻抗**。

#### 有限[尾电流源](@entry_id:262705)阻抗的角色

一个理想的差分对由一个理想的电流源（具有无穷大的小信号[输出阻抗](@entry_id:265563)）来偏置。这个电流源强制流过两个支路的总电流保持恒定。然而，实际的电流源（通常由一个MOS管实现）具有有限的输出阻抗，我们将其在低频时建模为一个电阻 $R_t$。

考虑一个 **完全匹配** 的[差分对](@entry_id:266000)，其尾部接有有限电阻 $R_t$。当施加一个共模输入 $v_{cm}$ 时，由于 $R_t$ 的存在，两个晶体管的公共源极节点电压 $v_s$ 不再是地，而是会跟随 $v_{cm}$ 变化。我们可以通过 **[共模半电路](@entry_id:275516)** 的方法来分析这种情况 。由于电路和激励都是对称的，我们可以将电路从中间“劈开”，并将尾电阻 $R_t$ 替换为一个值为 $2R_t$ 的电阻。这样，单端[共模增益](@entry_id:263356) $A_c = v_o / v_{cm}$ 就等效于一个带有[源极负反馈](@entry_id:260703)电阻 $2R_t$ 的[共源放大器](@entry_id:265648)的增益。其增益表达式为：
$$
A_c = \frac{-g_m R_D r_o}{r_o + R_D + 2R_t(1 + g_m r_o)}
$$
其中 $g_m$ 是晶体管的跨导，$R_D$ 是漏极[负载电阻](@entry_id:267991)，$r_o$ 是晶体管的输出电阻。这个公式表明，一个共模输入确实会产生一个共模输出。然而，由于电路是完全对称的，两个单端输出 $v_{o1}$ 和 $v_{o2}$ 是完全相等的，因此差分输出 $v_{od} = v_{o1} - v_{o2}$ 依然严格为零。

这证实了我们的观点：仅有有限的尾阻抗 $R_t$ 不足以产生共模到差模的转换。我们还需要第二个要素：**失配**。

#### 失配的影响

失配（mismatch）是指由于制造工艺的随机偏差，导致设计上本应相同的两个器件（如晶体管或电阻）在电气特性上出现微小差异的现象。

##### 1. 跨导 ($g_m$) 失配

假设两个晶体管的[跨导](@entry_id:274251)存在失配，分别为 $g_{m1} = g_m(1+\epsilon_g)$ 和 $g_{m2} = g_m(1-\epsilon_g)$ 。当一个[共模电压](@entry_id:267734) $v_{cm}$ 施加时，有限的尾阻抗 $Z_t$ 使得公共源极电压 $v_s$ 变化，导致两个晶体管的栅源电压 $v_{gs} = v_{cm} - v_s$ 发生变化。流过两个晶体管的漏电流增量分别为 $i_{d1} = g_{m1} v_{gs}$ 和 $i_{d2} = g_{m2} v_{gs}$。由于 $g_{m1} \neq g_{m2}$，这两个电流增量不再相等。这个不等的电流流过（假定匹配的）负载电阻 $R_D$，产生了不等的输出电压变化，从而导致一个非零的差分输出 $v_{od} = -(i_{d1} - i_{d2})R_D$。

通过[小信号分析](@entry_id:263462)，可以推导出共模到差模的转换增益为：
$$
A_{cd} = \frac{v_{od}}{v_{cm}} \approx \frac{-2 g_m R_D \epsilon_g}{1 + 2 g_m Z_t}
$$
相应的CMRR为：
$$
\mathrm{CMRR} \approx \left| \frac{A_d}{A_{cd}} \right| \approx \frac{1 + 2 g_m Z_t}{2 |\epsilon_g|}
$$
这里 $A_d \approx -g_m R_D$ 是[差模增益](@entry_id:264461)。这个结果清晰地表明，CMRR与尾阻抗 $Z_t$ 成正比，与跨导失配 $\epsilon_g$ 成反比。

##### 2. 负载 ($R_D$) 失配

类似地，即使晶体管[完美匹配](@entry_id:273916)（$\epsilon_g = 0$），如果负载电阻存在失配，$R_{D1} = R_D(1+\epsilon_R)$ 和 $R_{D2} = R_D(1-\epsilon_R)$，也会导致CMRR下降 。在这种情况下，共模输入 $v_{cm}$ 同样通过有限的尾阻抗 $R_T$ 引起两个支路产生 **相等** 的电流变化 $i_d$。然而，这个相等的电流流过不等的[负载电阻](@entry_id:267991)，产生不等的输出电压：$v_{o1} = -i_d R_{D1}$ 和 $v_{o2} = -i_d R_{D2}$。因此，差分输出 $v_{od} = -i_d(R_{D1} - R_{D2})$ 不再为零。

推导得到的CMRR表达式与 $g_m$ 失配的情况非常相似：
$$
\mathrm{CMRR} = \frac{1 + 2 g_m R_T}{2 |\epsilon_R|}
$$

在实际电路中，跨导失配和负载失配通常同时存在。一阶分析表明，它们对 $A_{cd}$ 的贡献是线性叠加的 。如果同时存在 $g_m$ 和负载 $R_L$ 的失配，CMRR表达式的分母会变为包含两种失配之和的形式：
$$
\mathrm{CMRR} = \frac{1 + 2g_{m}R_{t}}{2|\epsilon_{g} + \epsilon_{L}|}
$$
这意味着如果两种失配恰好符号相反（例如，跨导较大的晶体管恰好匹配了电阻较小的负载），它们的影响可能会相互抵消，从而改善CMRR。反之，如果符号相同，则会加剧CMRR的恶化。

##### 3. 先进工艺中的失配：体效应

在一些先进工艺中，例如[全耗尽绝缘体上硅](@entry_id:1124876)（FD-SOI），还存在其他更微妙的失配机制。FD-SOI工艺允许通过背栅（back-gate）来调节晶体管的阈值电压 $V_T$。阈值电压模型可以表示为 $V_{T,i} = V_{T0} + \eta_i (V_{BG} - V_S)$，其中 $\eta_i$ 是[背栅耦合](@entry_id:1121304)系数。如果两个晶体管的 $\eta_i$ 存在失配 ，即 $\eta_1 \neq \eta_2$，即使在理想[尾电流源](@entry_id:262705)（$R_t \to \infty$）的情况下，CMRR也会受到影响。

在这种情况下，共模输入 $v_{cm}$ 会使公共源极电压 $v_s$ 变化（即使 $i_{d1}+i_{d2}=0$，为了保持总电流恒定，$v_{gs}$必须改变，从而 $v_s$ 必须改变）。$v_s$ 的变化会通过不同的 $\eta_i$ 对两个晶体管的阈值电压产生不同的调制。这等效于产生了一个与[信号相关](@entry_id:274796)的 $V_T$ 失配，进而导致了不等的漏电流和非零的差分输出。推导表明，这种机制导致的CMRR为：
$$
\mathrm{CMRR} = \frac{2 - \eta_1 - \eta_2}{2|\eta_1 - \eta_2|}
$$
一个有效的缓解策略是将背栅与源极连接在一起（$V_{BG}=V_S$），这样 $V_{BG}-V_S=0$，阈值电压就不再受 $v_s$ 变化的影响，从而消除了这种失配机制的源头。

### CMRR的频率依赖性

到目前为止，我们的讨论主要集中在低频或直流情况。然而，CMRR是一个与频率相关的参数，通常会随着频率的升高而显著下降。其主要原因在于电路中的[寄生电容](@entry_id:270891)，特别是[尾电流源](@entry_id:262705)的[寄生电容](@entry_id:270891)。

一个更实际的[尾电流源](@entry_id:262705)阻抗模型是一个电阻 $r_t$ 和一个电容 $C_t$ 的并联网络 。其频率相关的阻抗为：
$$
Z_t(\omega) = \frac{r_t}{1 + j\omega r_t C_t}
$$
该阻抗在直流时为 $r_t$，但在频率高于其极点 $\omega_p = 1/(r_t C_t)$ 时，其幅值会以 $20\,\mathrm{dB}/\text{decade}$ 的速率下降。

将这个频率相关的 $Z_t(\omega)$ 代入我们之前推导的CMRR表达式中，例如，考虑 $g_m$ 和 $R_D$ 均存在失配的情况，我们得到频率相关的CMRR：
$$
\mathrm{CMRR}(\omega) = \frac{|1 + 2g_m Z_t(\omega)|}{2|\epsilon_R + \epsilon_g|} = \frac{\sqrt{(1+2g_m r_t)^2 + (\omega r_t C_t)^2}}{2|\epsilon_R + \epsilon_g| \sqrt{1+(\omega r_t C_t)^2}}
$$
分析这个表达式可以得出：
- **低频时** ($\omega \ll 1/(r_t C_t)$)，$\mathrm{CMRR}(\omega) \approx \frac{1+2g_m r_t}{2|\epsilon_R + \epsilon_g|}$，由尾电阻 $r_t$ 决定。
- **高频时** ($\omega \gg 1/(r_t C_t)$)，尾阻抗变得非常小，近似于 $1/(j\omega C_t)$。此时，$\mathrm{CMRR}(\omega)$ 趋向于一个较低的常数值，或者如果考虑更复杂的模型，它会持续下降。

因此，[尾电流源](@entry_id:262705)的极点是导致CMRR在高频下降的关键因素。为了在更宽的带宽内保持高CMRR，设计者必须努力提高[尾电流源](@entry_id:262705)的阻抗，并将其寄生极点推向更高的频率。这通常通过使用 **共源共栅（cascode）** [电流源](@entry_id:275668)结构来实现。

### 设计考量与[共模反馈](@entry_id:266519) (CMFB)

上述分析为高CMRR设计提供了明确的指导方针：
1.  **最大化尾阻抗**：使用诸如[共源共栅电流镜](@entry_id:272485)等高输出阻抗结构来实现[尾电流源](@entry_id:262705)。CMRR对尾电阻 $R_t$ 的灵敏度为 $\partial \mathrm{CMRR}/\partial R_t = g_m/|\epsilon_g+\epsilon_L|$ ，表明CMRR与 $R_t$ 呈[线性增长](@entry_id:157553)关系，这进一步凸显了高尾阻抗的重要性。
2.  **最小化失配**：通过精心的版图设计技术（如公[共质心布局](@entry_id:272235)、交叉耦合、使用大尺寸器件）来减小晶体管和负载的失配。

对于 **[全差分放大器](@entry_id:268611)**（即输入和输出均为[差分信号](@entry_id:260727)的放大器），还存在一个额外且至关重要的问题：输出共模电压的确定。由于[差分增益](@entry_id:264006)通常非常高，而[共模增益](@entry_id:263356)路径可能不确定，如果没有一个专门的机制来稳定输出共模电平，它很容易漂移到电源轨附近，导致放大器失效。

解决这个问题的标准方法是采用 **[共模反馈](@entry_id:266519)（Common-Mode Feedback, CMFB）** 电路。CMFB电路的功能是：
1.  **感知** 输出端的共模电压（通常通过电阻分压或电容[分压](@entry_id:168927)网络来计算 $v_{ocm} = (v_{o1}+v_{o2})/2$）。
2.  将其与一个期望的参考电压 $V_{ref,cm}$进行 **比较**，生成一个误差信号。
3.  通过一个[反馈放大器](@entry_id:262853) **调节** 差分放大器内部的偏置（通常是[尾电流源](@entry_id:262705)的电流或[有源负载](@entry_id:262691)的偏置），从而将输出共模电压强制拉回到参考电平。

CMFB本质上是一个[负反馈系统](@entry_id:921413)，其目标是抑制输出[共模电压](@entry_id:267734)的任何偏移。我们可以使用控制理论的模型来分析其性能 。假设CMFB环路的开环增益为 $L(s) = k_s A(s) P(s)$，其中 $k_s$ 是传感增益， $A(s)$ 是CMFB[放大器增益](@entry_id:261870)， $P(s)$ 是从CMFB[控制信号](@entry_id:747841)到输出共模电压的“被控对象”增益。当存在一个从输入共模到输出共模的扰动路径 $D(s)$ 时，闭环下的共模传递函数为：
$$
T(s) = \frac{v_{ocm}(s)}{v_{icm}(s)} = \frac{D(s)}{1 + L(s)} = \frac{D(s)}{1 + k_s A(s) P(s)}
$$
这个结果表明，CMFB环路通过一个因子 $(1+L(s))$ 来抑制共模扰动。在低频时，[环路增益](@entry_id:268715) $L(0)$ 通常非常大，可以实现出色的[共模抑制](@entry_id:265391)。然而，与任何[反馈系统](@entry_id:268816)一样，CMFB环路本身也具有有限的增益和带宽。在较高频率下，$|L(j\omega)|$ 会下降，导致其抑制共模扰动的能力减弱。因此，CMFB环路的设计（特别是其带宽和稳定性）对于[全差分放大器](@entry_id:268611)在高频下的整体性能至关重要。