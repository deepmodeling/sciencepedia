{
    "hands_on_practices": [
        {
            "introduction": "JTAG协议的核心是其测试访问端口（TAP）控制器，一个由测试模式选择（`TMS`）信号驱动的有限状态机。精确控制状态转换是所有JTAG操作的基础。本练习旨在通过一个基本的数据寄存器（DR）扫描序列，让您掌握如何以最少的`TCK`周期在关键TAP状态之间导航，从而加深对`TMS`信号与状态转换之间关系的理解。",
            "id": "4258516",
            "problem": "在电气和电子工程师协会 (IEEE) 标准 1149.1 边界扫描架构中，通常称为联合测试行动组 (JTAG)，测试接入端口 (TAP) 控制器是一个有限状态机，其下一个状态由在测试时钟 (`TCK`) 的上升沿采样测试模式选择 (`TMS`) 信号来确定。考虑数据寄存器 (DR) 扫描路径，其具有以下规范的下一状态规则（仅表述与此问题相关的状态）。在每个 `TCK` 的上升沿，TAP 控制器根据当前状态和采样的 `TMS` 值进行转换：\n\n- 从 `Run-Test/Idle` (`RTI`)：`TMS=0` → `RTI`， `TMS=1` → `Select-DR-Scan`。\n- 从 `Select-DR-Scan`：`TMS=0` → `Capture-DR`， `TMS=1` → `Select-IR-Scan`。\n- 从 `Capture-DR`：`TMS=0` → `Shift-DR`， `TMS=1` → `Exit1-DR`。\n- 从 `Shift-DR`：`TMS=0` → `Shift-DR`， `TMS=1` → `Exit1-DR`。\n- 从 `Exit1-DR`：`TMS=0` → `Pause-DR`， `TMS=1` → `Update-DR`。\n- 从 `Update-DR`：`TMS=0` → `RTI`， `TMS=1` → `Select-DR-Scan`。\n\n假设 TAP 控制器从 `RTI` 状态开始。您需要设计一个确定性的 `TMS` 波形，它由在连续的 `TCK` 上升沿上施加和采样的一系列 `TMS` 值组成，该波形将 TAP 控制器从 `RTI` 移动到 `Shift-DR`，然后到 `Update-DR`，最后返回到 `RTI`。您的设计必须最小化完成此状态访问序列所需的 `TCK` 脉冲数。假设除了访问 `Shift-DR` 之外，不需要进行数据移位（即，进入 `Shift-DR` 后立即退出，不执行任何移位操作）。\n\n仅使用上述基本规则和有限状态控制的第一性原理，确定完成序列 `RTI` → `Shift-DR` → `Update-DR` → `RTI` 所需的最小 `TCK` 脉冲数。请以单个整数形式提供最终答案。无需四舍五入，也无需单位。",
            "solution": "测试接入端口 (TAP) 控制器是一个有限状态机，由在测试时钟 (`TCK`) 的上升沿采样的测试模式选择 (`TMS`) 信号驱动。下一状态行为完全由当前状态和 `TCK` 上升沿的 `TMS` 值决定。我们使用问题陈述中列出的规范数据寄存器 (DR) 路径转换，这些是 IEEE 标准 1149.1 的标准事实，并作为基础。\n\n我们必须按顺序访问状态，从 `Run-Test/Idle` (`RTI`) 到 `Shift-DR`，然后到 `Update-DR`，最后返回到 `RTI`，同时最小化 `TCK` 脉冲的数量。每次转换仅发生在 `TCK` 的上升沿，因此最小化转换次数等同于最小化 `TMS` 采样事件的数量。\n\n**步骤 1：从 `RTI` 移动到 `Shift-DR`**\n- 从 `RTI` 出发，进入数据寄存器 (DR) 路径的唯一方法是通过 `Select-DR-Scan`，这要求在下一个 `TCK` 上升沿 `TMS=1`：\n  - `RTI` $\\xrightarrow{TMS=1}$ `Select-DR-Scan` (1 TCK)\n- 从 `Select-DR-Scan` 出发，要进入 DR 捕获状态，我们必须设置 `TMS=0`：\n  - `Select-DR-Scan` $\\xrightarrow{TMS=0}$ `Capture-DR` (1 TCK)\n- 从 `Capture-DR` 出发，要进入 `Shift-DR`，我们必须再次设置 `TMS=0`：\n  - `Capture-DR` $\\xrightarrow{TMS=0}$ `Shift-DR` (1 TCK)\n\n因此，从 `RTI` 到达 `Shift-DR` 的最小序列需要三个 `TCK` 脉冲，在连续的上升沿上对应的 `TMS` 值为 `1, 0, 0`。此时，我们已使用 $3$ 个脉冲。\n\n**步骤 2：在不进行数据移位的情况下，从 `Shift-DR` 移动到 `Update-DR`**\n- 在 `Shift-DR` 状态下，保持在 `Shift-DR` 需要 `TMS=0`；退出则需要 `TMS=1`。为了最小化脉冲数并避免数据移位，我们立即退出：\n  - `Shift-DR` $\\xrightarrow{TMS=1}$ `Exit1-DR` (1 TCK)\n- 从 `Exit1-DR` 出发，要直接进入 `Update-DR`，我们设置 `TMS=1`：\n  - `Exit1-DR` $\\xrightarrow{TMS=1}$ `Update-DR` (1 TCK)\n\n这需要额外的 $2$ 个脉冲，对应的 `TMS` 值为 `1, 1`。累计脉冲数现在是 $3 + 2 = 5$ 个。\n\n**步骤 3：从 `Update-DR` 返回到 `RTI`**\n- 从 `Update-DR` 出发，返回到 `RTI` 需要 `TMS=0`：\n  - `Update-DR` $\\xrightarrow{TMS=0}$ `RTI` (1 TCK)\n\n这需要再加 $1$ 个脉冲。总脉冲数是 $5 + 1 = 6$。\n\n因此，完成序列 `RTI` → `Shift-DR` → `Update-DR` → `RTI` 所需的最小 `TCK` 脉冲数为 $6$。实现此目的的、在连续的 `TCK` 上升沿采样的确定性最小 `TMS` 波形是序列 `1, 0, 0, 1, 1, 0`。\n\n为了证明其最小性，我们观察到每一步都遵循了到达目标状态的最短路径，没有任何绕行（例如，进入 `Pause-DR` 或 `Select-IR-Scan`），这些绕行都会严格增加转换次数。因此，$6$ 是最小值。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "在掌握了基本的TAP状态导航后，下一步是分析一个完整的JTAG操作的成本。现实世界的测试场景通常涉及复合操作，例如先加载一条指令到指令寄存器（IR），然后对选定的数据寄存器（DR）进行移位操作。本练习要求您计算完成这样一个复合操作所需的总`TCK`周期数，这是估算测试时间和优化测试流程的关键技能。",
            "id": "4258496",
            "problem": "一个数字集成电路实现了由电气和电子工程师协会 (IEEE) 标准 1149.1 定义的边界扫描架构，并带有一个标准的测试接入端口 (TAP) 控制器。您需要确定，在对测试模式选择 (TMS) 信号进行最小开销控制的情况下，执行以下复合操作所需的测试时钟 (TCK) 上升沿的确切数量。\n\n假设以下操作约束和定义：\n- 电路从 TAP 状态 `Run-Test/Idle` 开始，并在整个复合操作完成后必须结束于 `Run-Test/Idle` 状态。\n- 首先，执行一次 $m$ 位指令寄存器 (IR) 加载。紧接着，将一个特定的 $n$ 位数据寄存器 (DR) 通过测试数据输出 (TDO) 移出。\n- 所有状态转换均遵循 IEEE 标准 1149.1 的 TAP 状态机。所经过的状态路径必须是最小且合法的，没有暂停，也没有超出为进入和退出所需移位操作以及在完成后返回 `Run-Test/Idle` 状态所绝对必需的额外空闲时间。\n- 测试时钟 (TCK) 的每个上升沿会根据当前的 TMS 值推进 TAP 状态机，或在 `Shift-IR` 或 `Shift-DR` 状态下对当前选定的移位寄存器执行一次移位。\n- 在 $m$ 位和 $n$ 位移位期间，每个 `TCK` 上升沿恰好移位一位。每次移位操作的最后一位在置位 TMS 的同时被时钟同步，以便在同一个时钟沿退出相应的移位状态。\n- 不施加异步复位。不调用向 `Test-Logic-Reset` 状态的转换。不插入暂停。\n\n在这些假设下，推导一个以 $m$ 和 $n$ 为函数的闭式解析表达式，用于表示完成以下操作所需的 TCK 上升沿总数：\n$1)$ 加载 $m$ 位 IR，以及 $2)$ 移出 $n$ 位 DR，此过程从 `Run-Test/Idle` 开始并在 `Run-Test/Idle` 结束，使用最小合法 TAP 状态转换序列。您的最终答案必须是一个以 $m$ 和 $n$ 表示的、无单位的单一解析表达式。请勿近似或四舍五入。",
            "solution": "要推导出完成此复合操作所需的TCK总周期数，我们必须将过程分解为几个连续的阶段，并计算每个阶段的开销。该路径遵循IEEE 1149.1标准TAP状态机的最小转换序列。\n\n**阶段1：加载 $m$ 位指令 (IR Load)**\n1.  从 `Run-Test/Idle` 导航到 `Shift-IR`：\n    - `Run-Test/Idle` $\\xrightarrow{\\text{TMS=1}}$ `Select-DR-Scan` (1 TCK)\n    - `Select-DR-Scan` $\\xrightarrow{\\text{TMS=1}}$ `Select-IR-Scan` (1 TCK)\n    - `Select-IR-Scan` $\\xrightarrow{\\text{TMS=0}}$ `Capture-IR` (1 TCK)\n    - `Capture-IR` $\\xrightarrow{\\text{TMS=0}}$ `Shift-IR` (1 TCK)\n    此导航开销为 **4 TCK** 周期。\n2.  移入 $m$ 位指令：\n    - 移入前 $m-1$ 位，`TMS` 保持为0，停留在 `Shift-IR` 状态 ($m-1$ TCKs)。\n    - 移入第 $m$ 位，同时将 `TMS` 置为1，退出到 `Exit1-IR` 状态 (1 TCK)。\n    移位操作总共需要 **$m$ TCK** 周期。\n\n**阶段2：从IR扫描转换到DR扫描**\n1.  更新指令并导航到 `Shift-DR`：\n    - `Exit1-IR` $\\xrightarrow{\\text{TMS=1}}$ `Update-IR` (1 TCK) - 在此时钟下降沿，新指令生效。\n    - `Update-IR` $\\xrightarrow{\\text{TMS=1}}$ `Select-DR-Scan` (1 TCK)\n    - `Select-DR-Scan` $\\xrightarrow{\\text{TMS=0}}$ `Capture-DR` (1 TCK)\n    - `Capture-DR` $\\xrightarrow{\\text{TMS=0}}$ `Shift-DR` (1 TCK)\n    此转换开销为 **4 TCK** 周期。\n\n**阶段3：移出 $n$ 位数据 (DR Scan)**\n1.  移出 $n$ 位数据：\n    - 移出前 $n-1$ 位，`TMS` 保持为0 ($n-1$ TCKs)。\n    - 移出第 $n$ 位，同时将 `TMS` 置为1，退出到 `Exit1-DR` 状态 (1 TCK)。\n    数据移位总共需要 **$n$ TCK** 周期。\n\n**阶段4：返回 `Run-Test/Idle`**\n1.  从 `Exit1-DR` 返回：\n    - `Exit1-DR` $\\xrightarrow{\\text{TMS=1}}$ `Update-DR` (1 TCK)\n    - `Update-DR` $\\xrightarrow{\\text{TMS=0}}$ `Run-Test/Idle` (1 TCK)\n    返回开销为 **2 TCK** 周期。\n\n**总周期数**\n将所有阶段的TCK周期数相加：\n$$ N_{TCK} = (\\text{导航到Shift-IR}) + (\\text{IR移位}) + (\\text{转换到Shift-DR}) + (\\text{DR移位}) + (\\text{返回RTI}) $$\n$$ N_{TCK} = 4 + m + 4 + n + 2 $$\n$$ N_{TCK} = m + n + 10 $$\n因此，完成该复合操作所需的TCK上升沿总数为 $m + n + 10$。",
            "answer": "$$\n\\boxed{m+n+10}\n$$"
        },
        {
            "introduction": "JTAG的实践应用远不止时序计算，更关键的是要确保操作的安全性。在复杂的片上系统（SoC）中，不正确地进入测试模式（如`INTEST`）可能会导致总线冲突，从而损坏硬件。本练习将挑战您设计一个安全的操作序列，通过策略性地使用不同的JTAG指令（如`SAMPLE/PRELOAD`和`EXTEST`），确保在进入内部测试模式前，所有引脚驱动器都处于安全的高阻态，从而避免任何潜在的竞争风险。",
            "id": "4258533",
            "problem": "一个片上系统集成了多个总线主控和共享外设接口。在正常操作期间，片上焊盘可能会驱动共享总线。现要求您进入联合测试行动组 (JTAG) 的内部测试 (`INTEST`) 模式，以执行内核隔离测试，同时避免在片外网络上引起总线冲突。考虑一个符合电子电气工程师学会 (IEEE) $1149.1$ 标准的边界扫描架构，其边界扫描寄存器 (`BSR`) 由输出数据单元和驱动焊盘驱动器输出使能 (`OE`) 的输出控制单元组成。假设以下基本事实：\n\n- 在 $1149.1$ 标准中，`BSR` 由移位、捕获和更新元件组成，其中 `Update-DR` 锁存器仅在当前指令选中 BSR 时才将值驱动到其作用点。\n- 联合测试行动组 (JTAG) 测试访问端口 (TAP) 状态机仅在进入 `Capture-DR` 状态时修改移位路径的内容；将数据锁存到作用点的操作发生在 `Update-DR` 状态。\n- `SAMPLE/PRELOAD` 指令选择 `BSR` 进行移位和捕获，但不驱动引脚；系统逻辑继续控制焊盘驱动器。\n- `EXTEST` 指令选择 `BSR` 来驱动引脚；输出控制单元设置焊盘驱动器的 OE，输出数据单元设置焊盘驱动器的数据；三态化要求相应控制单元中的 `OE=0`。\n- `INTEST` 指令选择 `BSR` 来驱动内核输入并捕获内核输出；安全进入该模式要求禁用焊盘驱动器，以避免与外部驱动器发生冲突。\n- `HIGHZ` 指令（如果已实现）会强制输出进入高阻态，但通常会选择 `BYPASS` 寄存器，并且不允许对 `BSR` 进行回读访问。\n- `CLAMP` 指令（如果已实现）会将预加载的 `BSR` 更新值应用于焊盘，同时选择 `BYPASS` 寄存器；它会维持焊盘状态，但不允许 `BSR` 扫描。\n\n您的目标是构建一个指令和状态序列，确保在选择 INTEST 之前满足以下条件：通过强制所有相关的输出控制单元为 `OE=0` 来禁用焊盘驱动器，并通过 `BSR` 回读确认已禁用的 `OE` 状态。该序列必须没有因指令变更或 TAP 转换而引入的瞬态冲突风险，并且必须仅使用上述语义。请选择在正常操作下从 `Run-Test/Idle` (`RTI`) 状态开始时，最严格满足这些约束条件的选项。\n\n哪个序列是正确的？\n\nA. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 将所有输出控制位预加载为 $OE=0$，然后执行 Update-DR；通过 Shift-IR 和 Update-IR 加载 EXTEST 指令，使 BSR 控制焊盘 OE；执行 Capture-DR 和 Shift-DR 以回读控制单元状态并验证 $OE=0$；然后通过 Shift-IR 和 Update-IR 加载 INTEST 指令，进入内核隔离测试，同时保持焊盘禁用。\n\nB. 从 RTI 状态开始，立即通过 Shift-IR 和 Update-IR 加载 INTEST 指令；然后通过 Shift-DR 将输出控制位预加载为 $OE=0$；最后在已处于 INTEST 模式的情况下执行 Update-DR 以应用三态。\n\nC. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 HIGHZ 指令，以强制所有输出进入高阻态；然后通过 Shift-IR 和 Update-IR 加载 INTEST 指令；假设在 INTEST 期间焊盘保持禁用状态，不进行任何 BSR 回读。\n\nD. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 将所有输出控制位预加载为 $OE=0$；执行 Capture-DR 和 Shift-DR 以回读 BSR 并验证 $OE=0$；然后执行 Update-DR；最后通过 Shift-IR 和 Update-IR 加载 INTEST 指令。\n\nE. 从 RTI 状态开始，通过 Shift-IR 和 Update-IR 加载 SAMPLE/PRELOAD 指令；通过 Shift-DR 预加载 $OE=0$ 并执行 Update-DR；通过 Shift-IR 和 Update-IR 加载 CLAMP 指令以应用预加载的三态；然后在保持 CLAMP 状态的同时，尝试通过执行 Capture-DR 和 Shift-DR 来确认 $OE=0$；最后通过 Shift-IR 和 Update-IR 加载 INTEST 指令。",
            "solution": "### 解决方案分析\n\n目标是安全地进入 `INTEST` 模式，核心在于必须在进入 `INTEST` 之前，将所有I/O焊盘驱动器置于高阻态（三态），并验证这一状态，以避免任何总线冲突的风险。高阻态是通过将边界扫描寄存器（`BSR`）中对应的输出使能（`OE`）控制位设为0来实现的。\n\n让我们分析正确的操作序列：\n\n1.  **预加载安全状态**：我们不能直接使用会影响引脚的指令（如 `EXTEST` 或 `INTEST`）来加载安全状态，因为 `BSR` 的初始内容未知，可能导致冲突。正确的做法是先加载 `SAMPLE/PRELOAD` 指令。该指令允许我们扫描 `BSR`，但不会让 `BSR` 的内容驱动引脚。\n2.  **执行预加载**：在 `SAMPLE/PRELOAD` 模式下，我们通过 `Shift-DR` 操作将所有 `OE` 控制位设为0的模式加载到 `BSR` 的移位路径中，然后通过 `Update-DR` 状态将这个模式锁存到 `BSR` 的更新锁存器（update latches）中。此时，引脚仍由芯片核心逻辑控制，但 `BSR` 的更新锁存器已准备好一个“安全”配置。\n3.  **应用并验证安全状态**：现在需要将这个安全配置应用到引脚上。我们加载 `EXTEST` 指令。该指令会断开核心逻辑与引脚的连接，并将 `BSR` 的更新锁存器内容驱动到引脚上。由于锁存器中已是 `OE=0` 的安全值，引脚会立即进入高阻态。`EXTEST` 指令的另一个关键作用是它选择 `BSR` 作为当前的数据寄存器。这使我们能够执行一次 `Capture-DR` 和 `Shift-DR` 操作，回读 `BSR` 控制单元的当前状态，从而**验证**引脚确实已被置于高阻态。这是满足问题要求的关键一步。\n4.  **安全进入INTEST**：在确认引脚处于安全的高阻态后，最后加载 `INTEST` 指令。根据IEEE 1149.1标准，在 `INTEST` 模式下，引脚的行为与 `EXTEST` 模式相同，即由 `BSR` 更新锁存器的内容控制。由于该内容在上一步中已被设为并验证为安全状态，并且指令切换不会改变它，因此过渡到 `INTEST` 是无风险的。\n\n### 选项分析\n\n-   **A**: 该序列完全遵循了上述安全流程：使用 `SAMPLE/PRELOAD` 预加载，使用 `EXTEST` 应用和验证，最后切换到 `INTEST`。这是唯一安全且满足所有约束的选项。\n-   **B**: 直接加载 `INTEST` 是极其危险的，因为 `BSR` 的初始状态未知，可能立即导致总线冲突。\n-   **C**: `HIGHZ` 指令通常选择 `BYPASS` 寄存器，这使得无法通过回读 `BSR` 来验证状态，不满足问题要求。\n-   **D**: 在 `Update-DR` 之前执行 `Capture-DR` 是错误的。`Capture-DR` 会用引脚的当前状态（由核心逻辑驱动）覆盖掉我们刚刚移入的 `OE=0` 数据，导致验证失败且预加载无效。\n-   **E**: `CLAMP` 指令也选择 `BYPASS` 寄存器，同样无法回读 `BSR` 进行验证。\n\n因此，选项A是唯一正确且稳健的解决方案。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}