{
    "hands_on_practices": [
        {
            "introduction": "神经元最基本的功能之一是将其接收到的输入电流转化为输出的放电频率。这个输入-输出关系被称为频率-电流（F-I）曲线，是表征神经元兴奋性的关键。本练习将引导你从第一性原理出发，为二次积分发放（QIF）模型推导其精确的F-I曲线，从而揭示其作为I类兴奋性神经元模型的典型特征。",
            "id": "4056267",
            "problem": "考虑一个无量纲的二次积分发放（QIF）神经元，由恒定输入电流 $I \\in \\mathbb{R}$ 驱动，其膜电位动力学由 $ \\frac{dv}{dt} = v^{2} + I$ 定义。当 $v(t)$ 发散至 $+\\infty$ 时，定义为发生一次脉冲，之后膜电位瞬时重置为 $-\\infty$，不应期为零。\n\n假设在恒定 $I$ 下系统处于稳态，因此，当且仅当 $v(t)$ 从 $-\\infty$ 单调演化至 $+\\infty$ 所需的时间 $T(I)$ 为有限值时，存在稳定的发放速率。\n\n从QIF动力学的定义以及脉冲间期作为重置和阈值之间的遍历时间出发，根据第一性原理推导稳态频率-电流（F–I）曲线 $f(I)$ 的闭式表达式，其中当 $T(I)$ 有限时 $f(I) = \\frac{1}{T(I)}$，否则 $f(I) = 0$。你的推导应确定周期性脉冲发放的存在性（或不存在性）作为 $I$ 的函数，并通过计算动力学所蕴含的相应时间积分，在周期性脉冲发放存在时精确计算 $f(I)$。请以对所有 $I \\in \\mathbb{R}$ 均有效的单个解析表达式的形式，给出 $f(I)$ 的最终结果。\n\n以闭式形式陈述你得到的 $f(I)$ 的最终表达式。无需四舍五入，也无需单位，因为该模型是无量纲的。此外，请在你的推理中证明为何当 $I \\le 0$ 时不存在稳态发放。",
            "solution": "首先根据既定标准对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n-   **膜电位动力学：** 无量纲电压 $v$ 根据常微分方程（ODE）$\\frac{dv}{dt} = v^{2} + I$ 演化。\n-   **输入电流：** 输入 $I$ 是一个恒定的实数，$I \\in \\mathbb{R}$。\n-   **脉冲与重置机制：** 当 $v(t)$ 发散至 $+\\infty$ 时发生脉冲。紧随脉冲之后，$v(t)$ 被重置为 $-\\infty$。不应期为零。\n-   **脉冲间期 (ISI)：** 一个完整周期的时间，记为 $T(I)$，是 $v(t)$ 从 $-\\infty$ 单调演化至 $+\\infty$ 所需的时间。当且仅当 $T(I)$ 是有限的时，存在稳态发放速率。\n-   **发放速率（F-I 曲线）：** 稳态频率 $f(I)$ 定义为：如果 $T(I)$ 有限，则 $f(I) = \\frac{1}{T(I)}$；否则 $f(I) = 0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学基础：** 该问题描述了二次积分发放（QIF）神经元，这是计算神经科学中一个典型且被广泛研究的模型。它是 I 型神经元兴奋性的范式。其动力学和推导 F-I 曲线的任务都是标准的、科学合理的。\n-   **适定性：** 该问题是适定的。常微分方程（ODE）定义清晰，积分区间的初始和最终条件（$v \\to -\\infty$ 和 $v \\to +\\infty$）已明确，发放速率的定义也毫不含糊。存在一个唯一的、稳定的且有意义的解。\n-   **客观性：** 语言精确且数学化，没有主观或模糊的术语。\n-   **自洽性与一致性：** 推导 F-I 曲线所需的所有信息都已在问题陈述中提供。不存在矛盾之处。\n\n### 步骤 3：结论与行动\n该问题有效。将提供完整解答。\n\nF-I 曲线 $f(I)$ 的推导通过计算脉冲间期 $T(I)$ 来进行。控制方程为 $\\frac{dv}{dt} = v^{2} + I$。我们可以分离变量来求出电压发生无穷小变化 $dv$ 所需的时间 $dt$：\n$$\ndt = \\frac{dv}{v^{2} + I}\n$$\n电压从重置值 $v = -\\infty$ 移动到脉冲阈值 $v = +\\infty$ 所需的总时间 $T(I)$，可以通过对 $v$ 的整个范围对此表达式进行积分得到：\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + I}\n$$\n该积分的存在性及其值，以及因此有限发放速率的存在性，关键取决于输入电流 $I$ 的符号。我们通过考虑 $I$ 的三种情况来分析此问题。\n\n**情况 1：兴奋性输入 ($I  0$)**\n当 $I$ 为正时，对于所有实数 $v$，项 $v^2 + I$ 严格为正。这意味着 $\\frac{dv}{dt}  0$，电压 $v(t)$ 在所有时间上单调增加，确保了从 $v \\to -\\infty$ 开始的轨迹最终会发散到 $v \\to +\\infty$。存在周期性脉冲发放机制。\n\n为了计算 $T(I)$ 的积分，我们令 $I = a^{2}$，其中 $a = \\sqrt{I}$ 是一个正实数。积分为：\n$$\nT(I) = \\int_{-\\infty}^{\\infty} \\frac{dv}{v^{2} + a^{2}}\n$$\n这是一个标准积分。被积函数的原函数是 $\\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right)$。我们在积分极限处计算该值：\n$$\nT(I) = \\left[ \\frac{1}{a} \\arctan\\left(\\frac{v}{a}\\right) \\right]_{v=-\\infty}^{v=+\\infty} = \\frac{1}{a} \\left( \\lim_{v \\to \\infty} \\arctan\\left(\\frac{v}{a}\\right) - \\lim_{v \\to -\\infty} \\arctan\\left(\\frac{v}{a}\\right) \\right)\n$$\n使用反正切函数的已知极限，当 $x \\to \\infty$ 时 $\\arctan(x) \\to \\frac{\\pi}{2}$，以及当 $x \\to -\\infty$ 时 $\\arctan(x) \\to -\\frac{\\pi}{2}$，我们得到：\n$$\nT(I) = \\frac{1}{a} \\left( \\frac{\\pi}{2} - \\left(-\\frac{\\pi}{2}\\right) \\right) = \\frac{1}{a} (\\pi) = \\frac{\\pi}{a}\n$$\n将 $a = \\sqrt{I}$ 代回，我们得到 $I  0$ 时的脉冲间期：\n$$\nT(I) = \\frac{\\pi}{\\sqrt{I}}\n$$\n发放速率是 ISI 的倒数：\n$$\nf(I) = \\frac{1}{T(I)} = \\frac{\\sqrt{I}}{\\pi} \\quad \\text{for } I  0\n$$\n\n**情况 2：抑制性输入 ($I  0$)**\n这种情况解释了为何当 $I \\le 0$ 时不存在稳态发放。当 $I$ 为负时，动力学性质发生质变。令 $I = -k^2$，其中 $k = \\sqrt{-I}$ 为某个正实数。常微分方程变为：\n$$\n\\frac{dv}{dt} = v^2 - k^2 = (v-k)(v+k)\n$$\n系统现在有两个不动点，在这些点上 $\\frac{dv}{dt} = 0$。它们是 $v_1 = -k = -\\sqrt{-I}$ 和 $v_2 = +k = +\\sqrt{-I}$。\n\n我们分析这些不动点的稳定性。令 $g(v) = v^2 - k^2$。稳定性由导数 $g'(v) = 2v$ 在不动点处的符号决定。\n-   在 $v_1 = -k$ 处，$g'(-k) = -2k  0$。这是一个**稳定**不动点。\n-   在 $v_2 = +k$ 处，$g'(+k) = +2k  0$。这是一个**不稳定**不动点。\n\n神经元的电压被重置为 $v \\to -\\infty$。对于任何 $v  -k$，我们有 $\\frac{dv}{dt} = (v-k)(v+k)  0$，因为两个因子都为负。因此，电压从 $-\\infty$ 开始增加。然而，当 $v(t)$ 接近位于 $v_1 = -k = -\\sqrt{-I}$ 的稳定不动点时，其变化率 $\\frac{dv}{dt}$ 接近于 $0$。电压轨迹被困在这个稳定平衡点。它永远无法越过此点到达 $v  -k$ 的区域并随后发放脉冲。到达脉冲阈值（发散点）的时间是无限的。\n因此，对于 $I  0$，永远不会产生脉冲，$T(I) = \\infty$，根据定义，发放速率为 $f(I) = 0$。\n\n**情况 3：零输入 ($I = 0$)**\n这是临界情况。常微分方程为：\n$$\n\\frac{dv}{dt} = v^2\n$$\n在 $v=0$ 处有一个单一的不动点。对于 $v  0$，$\\frac{dv}{dt} = v^2  0$，所以电压从其重置值 $-\\infty$ 开始增加。为了确定到达 $v=0$ 所需的时间，我们可以积分：\n$$\n\\Delta t = \\int_{v_0}^{v_f} \\frac{dv}{v^2} = \\left[ -\\frac{1}{v} \\right]_{v_0}^{v_f} = \\frac{1}{v_0} - \\frac{1}{v_f}\n$$\n从 $v_0 = -\\infty$ 移动到任何有限负值（例如 $v_f = -1$）的时间是有限的：$\\Delta t = \\lim_{v_0 \\to -\\infty} \\left( \\frac{1}{v_0} - \\frac{1}{-1} \\right) = 0+1 = 1$。\n然而，从 $v_0 = -1$ 移动到位于 $v_f=0$ 的不动点所需的时间是：\n$$\n\\Delta t = \\lim_{v_f \\to 0^{-}} \\left( \\frac{1}{-1} - \\frac{1}{v_f} \\right) = -1 - (-\\infty) = \\infty\n$$\n电压会渐近地趋向于 $v=0$，但永远不会在有限时间内到达。神经元被卡在 $v=0$ 处，永远不会发放脉冲。因此，脉冲间期是无限的，$T(0) = \\infty$，发放速率为 $f(0) = 0$。\n\n**总结与最终表达式**\n结合所有三种情况的结果：\n-   对于 $I  0$，$f(I) = \\frac{\\sqrt{I}}{\\pi}$。\n-   对于 $I \\le 0$，$f(I) = 0$。\n\n这个分段函数描述了完整的 F-I 曲线。通过使用能够捕捉 $I=0$ 处阈值行为的 $\\max$ 函数，可以将其写成一个对所有 $I \\in \\mathbb{R}$ 都有效的、连续的、闭式单一表达式：\n$$\nf(I) = \\frac{\\sqrt{\\max(0, I)}}{\\pi}\n$$\n该表达式对于 $I0$ 正确地给出 $\\frac{\\sqrt{I}}{\\pi}$，对于 $I \\le 0$ 给出 $0$。该神经元仅在超阈值（兴奋性）电流下发放脉冲，其发放速率与输入电流的平方根成正比，这是 I 型神经元兴奋性的一个典型特征。",
            "answer": "$$\n\\boxed{\\frac{\\sqrt{\\max(0, I)}}{\\pi}}\n$$"
        },
        {
            "introduction": "简单的神经元模型在引入额外的生物物理机制后，可以展现出复杂的动态行为。本练习旨在探索在QIF模型中加入一个慢速的自适应电流如何能产生簇状放电（bursting），这是一种在大脑中普遍存在的放电模式。你将通过模拟该模型并根据其放电序列的统计特性来对神经元的活动状态进行分类，从而深入理解慢速过程如何塑造神经元的放电节律。",
            "id": "4056247",
            "problem": "您需要通过编程来表征一个带有适应性电流的二次整合发放 (QIF) 神经元的定性模式变化，其方式等效于构建一个关于有效输入和重置机制的离散分岔图。QIF 神经元是一个带有阈值重置规则的典型一维可兴奋系统；适应性电流引入了一个慢时间尺度，从而使系统成为一个快慢系统，并能够实现包括静息、节律性发放和簇发放在内的模式转变。您的程序必须针对一组给定的参数配置，模拟带有适应性的 QIF 动力学，分析得到的脉冲序列，并将每种配置分类到三种模式之一。将这些分类汇总成所要求的单行输出。\n\n使用以下基础模型。膜电位变量 $V$ 根据一个带有附加适应性电流的二次整合发放 (QIF) 常微分方程在连续时间内演化，\n$$\n\\frac{dV}{dt} = \\frac{1}{\\tau}\\left(V^2 + \\eta + I - g\\,w\\right),\n$$\n其中 $V$ 是无量纲电压，$t$ 是无量纲时间，$\\tau$ 是膜时间尺度，$\\eta$ 是无量纲可兴奋性参数，$I$ 是无量纲外部输入电流，$g$ 是从适应性到电压方程的耦合增益，$w$ 是一个无量纲的慢适应变量。适应性变量 $w$ 根据以下方程在慢时间尺度上演化\n$$\n\\frac{dw}{dt} = -\\frac{w}{\\tau_w},\n$$\n并在每次脉冲时发生瞬时跳变，\n$$\nw \\leftarrow w + \\alpha.\n$$\n脉冲发放通过阈值重置规则实现：当 $V$ 达到或超过一个大阈值 $V_{\\text{th}}$ 时，记录一个脉冲事件，并且电压立即重置为 $V \\leftarrow V_{\\text{reset}}$。所有变量和参数都是无量纲的。\n\n您必须使用固定时间步长 $\\Delta t$ 和有限时间范围 $\\mathcal{T}$ 来实现一个直接时间步进数值模拟，检测脉冲时间，计算脉冲间期，并按如下方式对模式进行分类：\n- 静息 ($0$)：在区间 $[0,\\mathcal{T}]$ 内脉冲数量少于 $k_{\\min}$。\n- 节律性发放 ($1$)：至少有 $k_{\\min}$ 个脉冲，且脉冲间期分布为单峰，变异性低。\n- 簇发放 ($2$)：至少有 $k_{\\min}$ 个脉冲，并有证据表明短脉冲间期聚集，并由长的静息间隙分隔，这与慢适应变量使得有效输入 $I_{\\text{eff}} = \\eta + I - g\\,w$ 交替为正和负所引起的交替变化一致。\n\n在所有模拟中，您必须使用以下固定常数：\n- $\\tau = 1$,\n- $\\eta = -0.5$,\n- $g = 1$,\n- $V_{\\text{th}} = 100$,\n- $\\Delta t = 10^{-2}$,\n- $\\mathcal{T} = 3\\times 10^{2}$,\n- $k_{\\min} = 3$.\n\n对于每次模拟，初始化 $V(0) = 0$ 和 $w(0) = 0$。使用与上述方程一致的显式欧拉更新，并应用阈值重置规则。对于脉冲检测，在 $V \\ge V_{\\text{th}}$ 的离散步长上记录脉冲时间，并立即应用 $V \\leftarrow V_{\\text{reset}}$ 和 $w \\leftarrow w + \\alpha$。\n\n使用基于脉冲间期 (ISI) 的定量标准，从第一性原理出发设计模式分类。设 $\\{t_i\\}$ 为脉冲时间，$\\{\\Delta t_i\\}$ 为脉冲间期，$\\Delta t_i = t_{i+1} - t_i$。计算 ISI 的变异系数，\n$$\n\\text{CV} = \\frac{\\sigma_{\\text{ISI}}}{\\mu_{\\text{ISI}}},\n$$\n并使用 ISI 的下四分位数 $Q_1$ 和上四分位数 $Q_3$ 来估计短阈值和长阈值，\n$$\n\\theta_{\\text{short}} = 0.7\\,Q_1,\\quad \\theta_{\\text{long}} = 1.2\\,Q_3.\n$$\n短序列是指至少包含2个连续的、每个都小于 $\\theta_{\\text{short}}$ 的 ISI 序列。长间隙是指任何至少为 $\\theta_{\\text{long}}$ 的 ISI。如果至少存在一个短序列，一个长间隙，并且 $\\text{CV} \\ge 0.3$，则分类为簇发放。否则，分类为节律性发放。\n\n实现以下参数配置的测试套件，以覆盖不同方面，包括一般情况、边界条件和重置引起的模式变化。每个测试用例是一个元组 $(I, V_{\\text{reset}}, \\alpha, \\tau_w)$：\n1. $(I = -0.8, V_{\\text{reset}} = -20, \\alpha = 0, \\tau_w = 200)$: 强的负输入，导致静息。\n2. $(I = 0.7, V_{\\text{reset}} = -20, \\alpha = 0.05, \\tau_w = 200)$: 正输入伴随弱适应，预期为节律性发放。\n3. $(I = 0.9, V_{\\text{reset}} = -40, \\alpha = 1, \\tau_w = 200)$: 强的正输入伴随强适应，预期通过 $I_{\\text{eff}}$ 的交替变化产生簇发放。\n4. $(I = 0.5, V_{\\text{reset}} = -20, \\alpha = 0.05, \\tau_w = 200)$: 边界情况，初始 $I_{\\text{eff}} = 0$，由于在 $V = 0$ 处的中性稳定性，预期为静息。\n5. $(I = 0.6, V_{\\text{reset}} = -10, \\alpha = 0.3, \\tau_w = 200)$: 中等输入和适应伴随浅重置，由于 $w$ 的快速累积，预期为簇发放。\n6. $(I = 0.6, V_{\\text{reset}} = -50, \\alpha = 0.3, \\tau_w = 200)$: 与情况5相同，但为深重置，由于 $w$ 累积较慢和 ISI 较长，预期为节律性发放。\n\n您的程序应生成单行输出，其中包含六个测试用例的分类代码，形式为用方括号括起来的逗号分隔列表，例如 $[r_1,r_2,r_3,r_4,r_5,r_6]$，其中每个 $r_i$ 是根据上述分类描述的集合 $\\{0,1,2\\}$ 中的一个整数。",
            "solution": "该问题要求对一个增加了慢适应性电流的二次整合发放 (QIF) 神经元模型的动力学进行数值模拟和分类。分类的目的是区分三种主要的发放模式：静息、节律性发放和簇发放。此任务等效于构建系统关于其输入和内部状态动力学的定性行为的分岔分析。\n\n解决方案的实现首先是对控制微分方程进行离散化，然后对模拟的脉冲序列应用一组定量规则。\n\n**1. 模型方程与离散化**\n\n神经元的状态由两个变量描述：膜电位 $V(t)$ 和适应性电流 $w(t)$。它们的演化由一个常微分方程 (ODE) 系统控制。\n\n膜电位 $V$ 根据 QIF 方程演化：\n$$\n\\frac{dV}{dt} = \\frac{1}{\\tau}\\left(V^2 + I_{\\text{eff}}\\right)\n$$\n其中有效输入电流为 $I_{\\text{eff}} = \\eta + I - g\\,w$。参数包括膜时间尺度 $\\tau$、可兴奋性参数 $\\eta$、外部输入 $I$、适应性耦合强度 $g$ 和适应性变量 $w$。\n\n适应性变量 $w$ 在慢时间尺度 $\\tau_w$ 上指数衰减：\n$$\n\\frac{dw}{dt} = -\\frac{w}{\\tau_w}\n$$\n当电压 $V$ 达到阈值 $V_{\\text{th}}$ 时，一个脉冲被记录下来，并发生两个瞬时事件：\n1.  电压被重置：$V \\leftarrow V_{\\text{reset}}$。\n2.  适应性变量增加：$w \\leftarrow w + \\alpha$。\n\n为了模拟这个系统，我们使用具有固定时间步长 $\\Delta t$ 的显式欧拉法。设 $V_n$ 和 $w_n$ 是状态变量在时间 $t_n = n \\Delta t$ 处的值。在下一个时间步 $t_{n+1}$ 的值计算如下：\n$$\nV_{n+1} = V_n + \\Delta t \\cdot \\frac{1}{\\tau}\\left(V_n^2 + \\eta + I - g w_n\\right)\n$$\n$$\nw_{n+1} = w_n + \\Delta t \\cdot \\left(-\\frac{w_n}{\\tau_w}\\right)\n$$\n此更新在每个时间步执行。脉冲检测和重置机制被整合到这个离散时间模拟中。在每个步骤内，计算更新之前，将当前电压 $V_n$ 与阈值 $V_{\\text{th}}$进行比较。如果 $V_n \\ge V_{\\text{th}}$，我们将 $t_n$ 记录为脉冲时间，然后在继续计算欧拉步骤的导数之前，应用重置规则 $V_n \\leftarrow V_{\\text{reset}}$ 和 $w_n \\leftarrow w_n + \\alpha$。这确保了重置在离散时间框架内被“瞬时”处理。模拟从 $t=0$ 运行到 $t=\\mathcal{T}$，初始条件为 $V(0)=0$ 和 $w(0)=0$。\n\n**2. 模式分类算法**\n\n模拟完成后，分析记录的脉冲时间列表 $\\{t_i\\}$，以对神经元的行为进行分类。\n\n**步骤 2.1：静息模式**\n计算总脉冲数 $N_{\\text{spikes}}$。如果 $N_{\\text{spikes}}$ 小于最小阈值 $k_{\\min}$，则认为神经元处于**静息**模式，分配代码 $0$。对于此问题，$k_{\\min}=3$。\n\n**步骤 2.2：节律性发放 vs. 簇发放模式**\n如果 $N_{\\text{spikes}} \\ge k_{\\min}$，则神经元处于活动发放状态。为了区分节律性（规则的）发放和簇（聚集的）发放，我们分析脉冲间期 (ISI) 的统计数据。ISI 是连续脉冲之间的时间差：$\\Delta t_i = t_{i+1} - t_i$。\n\n分类依赖于三个定量标准：\n\n**标准 A：发放率变异性**\n计算 ISI 的变异系数 (CV)。CV 是标准差 $\\sigma_{\\text{ISI}}$ 与均值 $\\mu_{\\text{ISI}}$ 的比值：\n$$\n\\text{CV} = \\frac{\\sigma_{\\text{ISI}}}{\\mu_{\\text{ISI}}}\n$$\n高 CV 表明发放率存在显著变异，这是簇发放的一个标志。使用 $\\text{CV} \\ge 0.3$ 的阈值。\n\n**标准 B：短 ISI 和长 ISI 的识别**\n簇发放的特征是具有短 ISI（簇内）的脉冲簇被具有长 ISI（簇间）的静息期所分隔。为了客观地识别这些特征，我们根据 ISI 分布的四分位数定义了两个阈值。设 $Q_1$ 为 ISI 集合的第一四分位数（第25百分位数），$Q_3$ 为第三四分位数（第75百分位数）。短 ISI 和长 ISI 的阈值是：\n$$\n\\theta_{\\text{short}} = 0.7 \\cdot Q_1\n$$\n$$\n\\theta_{\\text{long}} = 1.2 \\cdot Q_3\n$$\n\n**标准 C：脉冲簇和间隙的存在性**\n使用这些阈值，我们在脉冲序列中检查簇发放结构的证据：\n1.  **长间隙的存在：** 必须至少有一个 ISI，$\\Delta t_i$，使得 $\\Delta t_i \\ge \\theta_{\\text{long}}$。\n2.  **短序列的存在：** 必须存在一个至少包含两个连续的、且都短于 $\\theta_{\\text{short}}$ 的 ISI 序列。这可以识别一个最小的脉冲簇。\n\n一个发放模式被分类为**簇发放**（代码 $2$），当且仅当满足所有三个条件：\n1.  $\\text{CV} \\ge 0.3$。\n2.  至少有一个 ISI 大于或等于 $\\theta_{\\text{long}}$。\n3.  至少存在一个由两个或更多个连续的、且都小于 $\\theta_{\\text{short}}$ 的 ISI 组成的序列。\n\n如果神经元不处于静息模式，并且不满足簇发放的标准，则将其分类为**节律性发放**（代码 $1$）。此类别代表规则或半规则的脉冲发放。\n\n将此完整流程应用于六个指定的参数配置中的每一个，以确定其动力学模式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates a QIF neuron with adaptation and classifies its firing regime.\n    \"\"\"\n\n    test_cases = [\n        # (I, V_reset, alpha, tau_w)\n        (-0.8, -20.0, 0.0, 200.0),\n        (0.7, -20.0, 0.05, 200.0),\n        (0.9, -40.0, 1.0, 200.0),\n        (0.5, -20.0, 0.05, 200.0),\n        (0.6, -10.0, 0.3, 200.0),\n        (0.6, -50.0, 0.3, 200.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        I, V_reset, alpha, tau_w = case\n        result = simulate_and_classify(I, V_reset, alpha, tau_w)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef simulate_and_classify(I, V_reset, alpha, tau_w):\n    \"\"\"\n    Runs a single simulation and classification for a given parameter set.\n\n    Args:\n        I (float): External input current.\n        V_reset (float): Reset voltage.\n        alpha (float): Adaptation jump strength.\n        tau_w (float): Adaptation time constant.\n\n    Returns:\n        int: Classification code (0 for Rest, 1 for Tonic, 2 for Bursting).\n    \"\"\"\n\n    # Fixed constants\n    tau = 1.0\n    eta = -0.5\n    g = 1.0\n    V_th = 100.0\n    dt = 1e-2\n    T_sim = 3e2\n    k_min = 3\n\n    # Initial conditions\n    V = 0.0\n    w = 0.0\n\n    # Simulation setup\n    num_steps = int(T_sim / dt)\n    spike_times = []\n\n    # Simulation loop using Explicit Euler\n    for i in range(num_steps):\n        t = i * dt\n\n        # Spike detection and reset\n        if V = V_th:\n            spike_times.append(t)\n            V = V_reset\n            w = w + alpha\n\n        # Calculate derivatives at current state\n        dV_dt = (V**2 + eta + I - g * w) / tau\n        dw_dt = -w / tau_w\n\n        # Update state variables\n        V = V + dV_dt * dt\n        w = w + dw_dt * dt\n\n    # --- Regime Classification ---\n\n    # 1. Rest regime\n    if len(spike_times)  k_min:\n        return 0\n\n    # 2. Tonic vs. Bursting\n    isis = np.diff(spike_times)\n    \n    # This case is unlikely with k_min=3 but is a safeguard.\n    # We need at least 2 ISIs to check for a short run.\n    if len(isis)  2:\n        return 1 # Cannot be bursting, so must be tonic.\n\n    # Criterion A: Coefficient of Variation (CV)\n    mu_isi = np.mean(isis)\n    sigma_isi = np.std(isis)\n    \n    if mu_isi == 0:\n        cv = 0.0 # Avoid division by zero\n    else:\n        cv = sigma_isi / mu_isi\n    \n    cv_check = cv = 0.3\n\n    # Criterion B: Short and Long ISI thresholds\n    q1, q3 = np.quantile(isis, [0.25, 0.75])\n    theta_short = 0.7 * q1\n    theta_long = 1.2 * q3\n\n    # Criterion C: Existence of Gaps and Runs\n    long_gap_check = np.any(isis = theta_long)\n\n    short_run_check = False\n    for j in range(len(isis) - 1):\n        if isis[j]  theta_short and isis[j+1]  theta_short:\n            short_run_check = True\n            break\n    \n    # Final classification\n    if cv_check and long_gap_check and short_run_check:\n        return 2  # Bursting\n    else:\n        return 1  # Tonic\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "从理论模型到计算模拟的转换充满了挑战，其中数值方法的选择和实现至关重要。本练习将焦点转向指数积分发放（EIF）模型，并揭示一个常见的数值陷阱：朴素的欧拉积分法可能会因其对尖峰起始阶段非线性动态的低估而错过尖峰。你需要通过分析推导来确定保证尖峰被成功检测的条件，这强调了在神经元动力学模拟中进行严谨数值分析的重要性。",
            "id": "4056299",
            "problem": "考虑在恒定输入下的指数积分发放 (EIF) 神经元模型，其膜电位 $V(t)$ 根据规范膜电位常微分方程演化\n$$\n\\frac{dV}{dt} = F(V),\n$$\n其中 $F(V)$ 是连续可微的，由于指数级峰电位起始电流，当 $V \\geq V_T$ 时严格递增，并且包含在峰电位起始附近主导动力学的指数项。在高于 $V_T$ 的 EIF 区域，一个科学上合理的渐近简化是仅保留指数级峰电位起始电流，从而得到简化流\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right),\n$$\n其中 $\\tau_m$ 是膜时间常数（单位：秒），$V_T$ 是内在阈值（单位：伏特），$\\Delta_T$ 是斜率因子（单位：伏特）。假设当 $V(t)$ 首次达到一个有限的峰值截止电压 $V_p$（单位：伏特）时，检测到一个峰电位，其中 $V_p  V_T$。一种广泛使用的数值方案是朴素显式欧拉方法，\n$$\nV_{n+1} = V_n + \\Delta t \\, F(V_n),\n$$\n该方法应用于离散时间 $t_n = n\\Delta t$，其中 $\\Delta t$ 是固定时间步长（单位：秒），并且仅当 $V_{n+1} \\geq V_p$ 时才标记一个峰电位。\n\n您的任务是，从第一性原理出发，推导一个数学上严谨的论证，证明存在某些参数区域（对于较大的 $\\Delta_T$），朴素显式欧拉方法会错过在一个步长内连续时间里发生的峰电位，因为欧拉更新使用左端点斜率 $F(V_n)$，从而在 $F(V)$ 是递增和凸的区间上低估了真实增长。然后，推导在此简化 EIF 区域中能保证峰电位检测的 $\\Delta t$ 的界限。推导必须从高于 $V_T$ 的简化流的可分离结构出发，论证从起始电压 $V_0 \\in [V_T, V_p)$ 到截止电压 $V_p$ 的精确穿越时间，并将其与 $V_{n+1} \\geq V_p$ 所需的欧拉穿越准则进行比较。\n\n推导出界限后，实现一个程序，对下面测试套件中的每一组参数，计算：\n- 从 $V_0$ 到 $V_p$ 的简化 EIF 流的精确连续时间穿越时间 $t_{\\text{cross}}$（单位：秒）。\n- 使得从 $V_0$ 开始的朴素显式欧拉更新满足 $V_{n+1} \\geq V_p$ 的最小欧拉步长 $\\Delta t_{\\min}$（单位：秒）。\n- 一个布尔值 $b_{\\text{miss}}$，指示当所选的 $\\Delta t$ 使得连续系统在步长内穿越但欧拉更新未检测到时，朴素欧拉方法是否错过了峰电位，即，当且仅当 $\\Delta t \\geq t_{\\text{cross}}$ 且 $\\Delta t  \\Delta t_{\\min}$ 时，$b_{\\text{miss}}$ 为真。\n\n使用以下科学上合理的测试套件，该套件涵盖了正常路径、边界和边缘情况。所有电压单位为伏特，所有时间单位为秒。\n\n测试套件案例指定为 $(\\tau_m, \\Delta_T, V_T, V_p, V_0, \\Delta t)$：\n1. $(0.010, 0.020, -0.050, -0.020, -0.045, 0.007)$\n2. $(0.010, 0.020, -0.050, -0.020, -0.035, 0.004)$\n3. $(0.010, 0.002, -0.050, -0.020, -0.050, 0.200)$\n4. $(0.010, 0.020, -0.050, -0.020, -0.045, t_{\\text{cross}})$ 其中 $t_{\\text{cross}}$ 是根据相同参数计算的精确穿越时间；使用其数值作为 $\\Delta t$。\n5. $(0.010, 0.020, -0.050, -0.020, -0.045, \\Delta t_{\\min})$ 其中 $\\Delta t_{\\min}$ 是根据相同参数计算的保证检测的最小步长；使用其数值作为 $\\Delta t$。\n\n对于每个案例，您的程序必须根据您为简化 EIF 流推导出的公式计算 $t_{\\text{cross}}$、$\\Delta t_{\\min}$ 和 $b_{\\text{miss}}$，并生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素本身就是一个形如 $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$ 的列表。所有时间量必须以秒为单位表示为浮点数。例如，最后一行应如下所示：\n$[[\\text{布尔值}, \\text{浮点数}, \\text{浮点数}], [\\text{布尔值}, \\text{浮点数}, \\text{浮点数}], \\ldots]$。",
            "solution": "指数积分发放 (EIF) 模型通过一个指数非线性来捕捉峰电位的起始。在高于 $V_T$ 的峰电位起始区域，指数项占主导地位，简化流\n$$\n\\frac{dV}{dt} = \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)\n$$\n根据常微分方程的标准比较论证，为包含泄漏和恒定输入的完整动力学提供了一个有下界的近似。该简化流是可分离的，在 $V$ 上严格递增，并且当 $V \\geq V_T$ 时是凸的，因为\n$$\n\\frac{d}{dV}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)  0,\n\\quad\n\\frac{d^2}{dV^2}\\left(\\frac{dV}{dt}\\right) = \\frac{1}{\\tau_m \\Delta_T}\\exp\\!\\left(\\frac{V - V_T}{\\Delta_T}\\right)  0.\n$$\n我们推导简化流从 $V_0 \\in [V_T, V_p)$ 到截止电压 $V_p$ 的精确穿越时间。将 $V$ 视为 $t$ 的函数并分离变量可得\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= \\int_0^{t_{\\text{cross}}} \\frac{\\Delta_T}{\\tau_m} \\, dt.\n$$\n左侧积分得到\n$$\n\\int_{V_0}^{V_p} \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\, dV\n= -\\Delta_T \\left[ \\exp\\!\\left(-\\frac{V - V_T}{\\Delta_T}\\right) \\right]_{V_0}^{V_p}\n= \\Delta_T \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\n右侧积分得到 $(\\Delta_T/\\tau_m)\\, t_{\\text{cross}}$。令两侧相等，我们得到精确的连续时间穿越时间\n$$\nt_{\\text{cross}}(V_0 \\to V_p)\n= \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right).\n$$\n我们现在分析从 $V_0$ 开始的单步朴素显式欧拉方法：\n$$\nV_{n+1}\n= V_0 + \\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right).\n$$\n在离散方案中，当且仅当 $V_{n+1} \\geq V_p$ 时，才会在步长结束时检测到峰电位，这施加了不等式\n$$\n\\Delta t \\, \\frac{\\Delta_T}{\\tau_m}\\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right) \\geq V_p - V_0.\n$$\n求解 $\\Delta t$ 定义了在朴素欧拉方案中保证步末检测的最小步长：\n$$\n\\Delta t_{\\min}(V_0)\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}.\n$$\n我们将 $t_{\\text{cross}}$ 与 $\\Delta t_{\\min}(V_0)$ 进行比较。因为当 $V \\geq V_T$ 时流是递增且凸的，所以函数 $F(V) = (\\Delta_T/\\tau_m)\\exp((V - V_T)/\\Delta_T)$ 随 $V$ 递增，因此 $1/F(V)$ 随 $V$ 递减。精确穿越时间可以写成\n$$\nt_{\\text{cross}} = \\int_{V_0}^{V_p} \\frac{dV}{F(V)}.\n$$\n由于 $1/F(V)$ 是递减的，我们有标准的单调积分界\n$$\n\\int_{V_0}^{V_p} \\frac{dV}{F(V)}\n\\leq \\frac{V_p - V_0}{F(V_0)}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n= \\Delta t_{\\min}(V_0).\n$$\n因此，\n$$\nt_{\\text{cross}} \\leq \\Delta t_{\\min}(V_0),\n$$\n当 $F(V)$ 在 $[V_0, V_p)$ 上严格递增时（这在 $V_0 \\geq V_T$ 时成立），不等式为严格不等式。这个不等式精确地描述了朴素欧拉方法可能错过峰电位的区域：如果选择的 $\\Delta t$ 满足\n$$\nt_{\\text{cross}} \\leq \\Delta t  \\Delta t_{\\min}(V_0),\n$$\n那么连续系统会在步长内达到 $V_p$，而欧拉更新由于使用左端点斜率 $F(V_0)$ 会低估增长，并保持在 $V_p$ 以下。在这种情况下，峰电位在步长结束时被错过。这个错过区间的宽度\n$$\n\\Delta t_{\\min}(V_0) - t_{\\text{cross}}\n= \\frac{(V_p - V_0)\\, \\tau_m}{\\Delta_T \\exp\\!\\left(\\frac{V_0 - V_T}{\\Delta_T}\\right)}\n- \\tau_m \\left(\n\\exp\\!\\left(-\\frac{V_0 - V_T}{\\Delta_T}\\right)\n- \\exp\\!\\left(-\\frac{V_p - V_T}{\\Delta_T}\\right)\n\\right),\n$$\n对于足够接近 $V_T$ 的起始电压，它会随着斜率因子 $\\Delta_T$ 的增大而增大，这反映了较大的 $\\Delta_T$ 会增加流中的振幅因子，同时降低对 $V$ 的指数敏感度，从而加大了左端点线性外推与跨越凸增流的精确积分之间的差距。\n\n保证在跨步中检测到峰电位的时间步长界限随之即来：对于给定的 $V_0$，\n$$\n\\Delta t \\geq \\Delta t_{\\min}(V_0)\n$$\n保证了 $V_{n+1} \\geq V_p$，从而在步长末端进行检测。为了在带区 $V_0 \\in [V_T, V_b]$（其中 $V_b  V_p$）上获得一个与状态无关的保守界限，可以选择\n$$\n\\Delta t \\geq \\sup_{V_0 \\in [V_T, V_b]} \\Delta t_{\\min}(V_0),\n$$\n尽管由于其在 $V_T$ 附近的值很大，这通常是不切实际的。在实践中，自适应步长或事件检测是首选方法，但在朴素固定步长欧拉框架内，推导出的 $\\Delta t_{\\min}(V_0)$ 为简化 EIF 区域中的每步检测提供了精确阈值。\n\n程序的算法设计：\n- 对每个测试案例，计算 $x_0 = (V_0 - V_T)/\\Delta_T$ 和 $x_p = (V_p - V_T)/\\Delta_T$。\n- 计算\n$$\nt_{\\text{cross}} = \\tau_m\\left(e^{-x_0} - e^{-x_p}\\right),\n\\quad\n\\Delta t_{\\min} = \\frac{(V_p - V_0)\\tau_m}{\\Delta_T e^{x_0}}.\n$$\n- 根据案例的 $\\Delta t$，设置错过布尔值\n$$\nb_{\\text{miss}} = \\left(\\Delta t \\geq t_{\\text{cross}}\\right) \\wedge \\left(\\Delta t  \\Delta t_{\\min}\\right).\n$$\n- 对于边界情况，其中 $\\Delta t$ 被指定为 $t_{\\text{cross}}$ 或 $\\Delta t_{\\min}$，首先计算其值，然后将其用作 $\\Delta t$。\n- 将每个案例的输出聚合为 $[b_{\\text{miss}}, t_{\\text{cross}}, \\Delta t_{\\min}]$，其中时间条目以秒为单位。\n\n这种基于原理的方法将朴素显式欧拉方法下峰电位检测的保证，直接与简化 EIF 流的可分离结构以及由凸性引起的 $1/F(V)$ 的精确积分与其左端点黎曼近似之间的差距联系起来。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_crossing_time(tau_m, delta_T, V_T, V_p, V0):\n    # t_cross = tau_m * (exp(-(V0 - V_T)/delta_T) - exp(-(V_p - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    xp = (V_p - V_T) / delta_T\n    return tau_m * (np.exp(-x0) - np.exp(-xp))\n\ndef compute_dt_min(tau_m, delta_T, V_T, V_p, V0):\n    # dt_min = (V_p - V0) * tau_m / (delta_T * exp((V0 - V_T)/delta_T))\n    x0 = (V0 - V_T) / delta_T\n    denom = delta_T * np.exp(x0)\n    return (V_p - V0) * tau_m / denom\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (tau_m, delta_T, V_T, V_p, V0, dt)\n    # Units: tau_m [s], delta_T [V], V_T [V], V_p [V], V0 [V], dt [s]\n    tau_m = 0.010  # 10 ms\n    cases = [\n        # 1. (0.010, 0.020, -0.050, -0.020, -0.045, 0.007)\n        (0.010, 0.020, -0.050, -0.020, -0.045, 0.007),\n        # 2. (0.010, 0.020, -0.050, -0.020, -0.035, 0.004)\n        (0.010, 0.020, -0.050, -0.020, -0.035, 0.004),\n        # 3. (0.010, 0.002, -0.050, -0.020, -0.050, 0.200)\n        (0.010, 0.002, -0.050, -0.020, -0.050, 0.200),\n        # 4. (0.010, 0.020, -0.050, -0.020, -0.045, t_cross)\n        # Placeholder dt; will be replaced by t_cross computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n        # 5. (0.010, 0.020, -0.050, -0.020, -0.045, dt_min)\n        # Placeholder dt; will be replaced by dt_min computed\n        (0.010, 0.020, -0.050, -0.020, -0.045, None),\n    ]\n\n    results = []\n    for idx, case in enumerate(cases):\n        tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i, dt_i = case\n\n        t_cross = compute_crossing_time(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n        dt_min = compute_dt_min(tau_m_i, delta_T_i, V_T_i, V_p_i, V0_i)\n\n        # For cases 4 and 5, substitute dt as specified (t_cross or dt_min)\n        if idx == 3:\n            dt_i = t_cross\n        if idx == 4:\n            dt_i = dt_min\n\n        # Missed spike occurs if exact crossing happens within step but Euler does not detect\n        missed = (dt_i = t_cross) and (dt_i  dt_min)\n\n        results.append([bool(missed), float(t_cross), float(dt_min)])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}