{"hands_on_practices": [{"introduction": "A robust understanding of any metric begins with its mathematical definition. This exercise will guide you from the first principles of geometry to a full derivation of the Intersection over Union ($IoU$) metric. By analyzing both a simplified co-centered case and the general off-center case, you will gain a deep appreciation for how $IoU$ captures errors in both size and location, and why these errors are inherently coupled [@problem_id:3160509].", "problem": "Consider two axis-aligned rectangular bounding boxes used in object detection, each represented by its center coordinates, width, and height. Let the ground-truth box have center at $(x, y)$, width $w$, and height $h$, and let the predicted box have center at $(\\hat{x}, \\hat{y})$, width $\\hat{w}$, and height $\\hat{h}$. The Intersection over Union (IoU) is defined as the ratio of the area of intersection of the two boxes to the area of their union. You will derive and analyze IoU starting only from the core definition of area overlap between axis-aligned rectangles and the definition of the union of sets.\n\n(a) Using only the definition that the overlap along one axis of two intervals is the length of the intersection of the intervals, and that the area of intersection of axis-aligned rectangles equals the product of their overlapped extents along the two axes, derive an expression for $\\mathrm{IoU}$ in the special case where the two boxes share the same center, that is, $(\\hat{x}, \\hat{y}) = (x, y)$. Then, argue from first principles why maximizing $\\mathrm{IoU}$ in this special case reduces to minimizing the absolute differences $|w - \\hat{w}|$ and $|h - \\hat{h}|$.\n\n(b) Extend your derivation to the off-center case $(\\hat{x}, \\hat{y}) \\neq (x, y)$ with horizontal and vertical offsets $\\Delta x = \\hat{x} - x$ and $\\Delta y = \\hat{y} - y$. Derive the overlapped extents along the horizontal and vertical axes in terms of $w$, $\\hat{w}$, $h$, $\\hat{h}$, $|\\Delta x|$, and $|\\Delta y|$, and give the corresponding $\\mathrm{IoU}$ expression. Based on this expression, discuss whether errors in center location and errors in size can be decoupled for the purpose of maximizing $\\mathrm{IoU}$.\n\n(c) For a concrete configuration, let the ground-truth box be centered at $(0, 0)$ with $w = 6$ and $h = 4$, and let the predicted box be centered at $(1, -0.5)$ with $\\hat{w} = 5$ and $\\hat{h} = 3$. Compute the resulting $\\mathrm{IoU}$. Round your final answer to four significant figures. The final answer must be a single real number with no units.", "solution": "The problem requires the derivation and analysis of the Intersection over Union (IoU) metric for two axis-aligned rectangular boxes. We will address each part systematically. A ground-truth box is defined by its center $(x, y)$, width $w$, and height $h$. A predicted box is defined by its center $(\\hat{x}, \\hat{y})$, width $\\hat{w}$, and height $\\hat{h}$.\n\n(a) Special Case: Co-centered Boxes\n\nFirst, we consider the special case where the boxes share the same center, i.e., $(\\hat{x}, \\hat{y}) = (x, y)$.\n\nAn axis-aligned rectangle can be described by the Cartesian product of two closed intervals on the horizontal and vertical axes.\nThe ground-truth box corresponds to the horizontal interval $[x - w/2, x + w/2]$ and the vertical interval $[y - h/2, y + h/2]$.\nThe predicted box, sharing the same center, corresponds to the horizontal interval $[x - \\hat{w}/2, x + \\hat{w}/2]$ and the vertical interval $[y - \\hat{h}/2, y + \\hat{h}/2]$.\n\nThe area of intersection of two axis-aligned rectangles is the product of the lengths of the intersections of their corresponding 1D intervals.\nThe intersection of the two horizontal intervals $[x - w/2, x + w/2]$ and $[x - \\hat{w}/2, x + \\hat{w}/2]$ is another interval centered at $x$. Its half-width is the minimum of the two half-widths, i.e., $\\min(w/2, \\hat{w}/2)$. The length of this intersection is $2 \\cdot \\min(w/2, \\hat{w}/2) = \\min(w, \\hat{w})$.\nSimilarly, the length of the intersection of the two vertical intervals is $\\min(h, \\hat{h})$.\n\nThe area of intersection, $A_I$, is therefore:\n$$A_I = \\min(w, \\hat{w}) \\cdot \\min(h, \\hat{h})$$\n\nThe area of the union of two sets is given by the principle of inclusion-exclusion: $A_U = A_{GT} + A_P - A_I$, where $A_{GT} = wh$ is the area of the ground-truth box and $A_P = \\hat{w}\\hat{h}$ is the area of the predicted box.\n$$A_U = wh + \\hat{w}\\hat{h} - \\min(w, \\hat{w}) \\min(h, \\hat{h})$$\n\nThe Intersection over Union, $\\mathrm{IoU}$, is the ratio of these two areas:\n$$\\mathrm{IoU} = \\frac{A_I}{A_U} = \\frac{\\min(w, \\hat{w}) \\min(h, \\hat{h})}{wh + \\hat{w}\\hat{h} - \\min(w, \\hat{w}) \\min(h, \\hat{h})}$$\n\nTo argue why maximizing $\\mathrm{IoU}$ reduces to minimizing the absolute differences $|w - \\hat{w}|$ and $|h - \\hat{h}|$, we analyze the $\\mathrm{IoU}$ expression. Maximizing the fraction is equivalent to minimizing its reciprocal:\n$$\\frac{1}{\\mathrm{IoU}} = \\frac{wh + \\hat{w}\\hat{h}}{\\min(w, \\hat{w}) \\min(h, \\hat{h})} - 1 = \\frac{w}{\\min(w, \\hat{w})} \\frac{h}{\\min(h, \\hat{h})} + \\frac{\\hat{w}}{\\min(w, \\hat{w})} \\frac{\\hat{h}}{\\min(h, \\hat{h})} - 1$$\nLet's analyze the ratios. The term $\\frac{w}{\\min(w, \\hat{w})}$ is equal to $1$ if $w \\le \\hat{w}$ and $w/\\hat{w}$ if $w > \\hat{w}$. This can be compactly written as $\\max(1, w/\\hat{w})$. Similarly, $\\frac{\\hat{w}}{\\min(w, \\hat{w})} = \\max(1, \\hat{w}/w)$. Substituting these into the expression gives:\n$$\\frac{1}{\\mathrm{IoU}} = \\max\\left(1, \\frac{w}{\\hat{w}}\\right) \\max\\left(1, \\frac{h}{\\hat{h}}\\right) + \\max\\left(1, \\frac{\\hat{w}}{w}\\right) \\max\\left(1, \\frac{\\hat{h}}{h}\\right) - 1$$\nEach ratio term, like $\\max(1, w/\\hat{w})$, is always greater than or equal to $1$. The minimum value of this expression is achieved when all ratios are exactly $1$. This occurs if and only if $w = \\hat{w}$ and $h = \\hat{h}$. In this case, $1/\\mathrm{IoU} = 1 \\cdot 1 + 1 \\cdot 1 - 1 = 1$, which means $\\mathrm{IoU}=1$, the maximum possible value.\nAny deviation of $\\hat{w}$ from $w$ (i.e., $|w - \\hat{w}| > 0$) or $\\hat{h}$ from $h$ (i.e., $|h - \\hat{h}| > 0$) will make at least one of the ratios strictly greater than $1$. For instance, if $\\hat{w} < w$, then $w/\\hat{w} > 1$, making $\\max(1, w/\\hat{w}) > 1$. This increases the value of $1/\\mathrm{IoU}$ and thus decreases the $\\mathrm{IoU}$. Therefore, maximizing $\\mathrm{IoU}$ in this co-centered case is equivalent to forcing $\\hat{w} \\to w$ and $\\hat{h} \\to h$, which is the same as minimizing $|w - \\hat{w}|$ and $|h - \\hat{h}|$.\n\n(b) General Case: Off-center Boxes\n\nNow we extend the derivation to the general case with center offsets $\\Delta x = \\hat{x} - x$ and $\\Delta y = \\hat{y} - y$. The ground-truth box has horizontal interval $[x_1, x_2] = [x - w/2, x + w/2]$ and vertical interval $[y_1, y_2] = [y - h/2, y + h/2]$. The predicted box has horizontal interval $[\\hat{x}_1, \\hat{x}_2] = [\\hat{x} - \\hat{w}/2, \\hat{x} + \\hat{w}/2]$ and vertical interval $[\\hat{y}_1, \\hat{y}_2] = [\\hat{y} - \\hat{h}/2, \\hat{y} + \\hat{h}/2]$.\n\nThe length of the intersection of two intervals $[a,b]$ and $[c,d]$ is given by $\\max(0, \\min(b, d) - \\max(a, c))$.\nThe overlapped horizontal extent, $W_{int}$, is:\n$$W_{int} = \\max(0, \\min(x_2, \\hat{x}_2) - \\max(x_1, \\hat{x}_1)) = \\max\\left(0, \\min\\left(x + \\frac{w}{2}, \\hat{x} + \\frac{\\hat{w}}{2}\\right) - \\max\\left(x - \\frac{w}{2}, \\hat{x} - \\frac{\\hat{w}}{2}\\right)\\right)$$\nSimilarly, the overlapped vertical extent, $H_{int}$, is:\n$$H_{int} = \\max(0, \\min(y_2, \\hat{y}_2) - \\max(y_1, \\hat{y}_1)) = \\max\\left(0, \\min\\left(y + \\frac{h}{2}, \\hat{y} + \\frac{\\hat{h}}{2}\\right) - \\max\\left(y - \\frac{h}{2}, \\hat{y} - \\frac{\\hat{h}}{2}\\right)\\right)$$\nThese expressions are general and are functions of the centers and dimensions of both boxes. Although the length of the intersection is symmetric with respect to the sign of the offset (e.g., depends on $|\\Delta x|$), expressing $W_{int}$ solely in terms of $w$, $\\hat{w}$ and $|\\Delta x|$ without using min/max functions or case analysis is not possible due to the complex interaction between relative sizes and positions.\n\nThe area of intersection is $A_I = W_{int} \\cdot H_{int}$.\nThe area of union is $A_U = wh + \\hat{w}\\hat{h} - A_I$.\nThe general $\\mathrm{IoU}$ expression is:\n$$\\mathrm{IoU} = \\frac{W_{int} \\cdot H_{int}}{wh + \\hat{w}\\hat{h} - W_{int} \\cdot H_{int}}$$\n\nNow, we discuss whether errors in center location $(\\Delta x, \\Delta y)$ and errors in size $(\\hat{w}, \\hat{h})$ can be decoupled for the purpose of maximizing $\\mathrm{IoU}$. The parameters are coupled. The expression for $W_{int}$ depends on both the center coordinates $(x, \\hat{x})$ and the widths $(w, \\hat{w})$. Likewise, $H_{int}$ depends on $(y, \\hat{y})$ and $(h, \\hat{h})$. The $\\mathrm{IoU}$ is a non-linear function of these intersection extents.\n$$\\mathrm{IoU}(\\Delta x, \\Delta y, \\hat{w}, \\hat{h}) = \\frac{W_{int}(\\Delta x, \\hat{w}) \\cdot H_{int}(\\Delta y, \\hat{h})}{wh + \\hat{w}\\hat{h} - W_{int}(\\Delta x, \\hat{w}) \\cdot H_{int}(\\Delta y, \\hat{h})}$$\nThe variables are not separable in this function. For example, the gradient of $\\mathrm{IoU}$ with respect to $\\hat{w}$ depends on $\\Delta x, \\Delta y,$ and $\\hat{h}$. The effect of a change in width, $\\Delta \\hat{w}$, on the $\\mathrm{IoU}$ is modulated by the current offset $\\Delta x$. If $|\\Delta x|$ is large such that the boxes are far apart horizontally ($W_{int}=0$), a small change in $\\hat{w}$ will have no effect on $A_I$ and thus little to no effect on $\\mathrm{IoU}$. However, if the boxes are perfectly centered horizontally ($\\Delta x = 0$), the same change in $\\hat{w}$ can have a significant impact on $W_{int}$ and thus on $\\mathrm{IoU}$, as shown in part (a). Because the sensitivity of $\\mathrm{IoU}$ to an error in one parameter (e.g., $\\hat{w}$) depends on the value of another parameter (e.g., $\\Delta x$), the errors cannot be considered decoupled. Therefore, to maximize $\\mathrm{IoU}$, one must simultaneously optimize all four prediction parameters: $\\hat{x}, \\hat{y}, \\hat{w}, \\hat{h}$.\n\n(c) Numerical Computation\n\nWe are given the following configuration:\nGround-truth box: center $(x, y)=(0, 0)$, width $w=6$, height $h=4$.\nPredicted box: center $(\\hat{x}, \\hat{y})=(1, -0.5)$, width $\\hat{w}=5$, height $\\hat{h}=3$.\n\nFirst, we determine the coordinates of the box boundaries.\nFor the ground-truth box:\n$x_1 = x - w/2 = 0 - 6/2 = -3$\n$x_2 = x + w/2 = 0 + 6/2 = 3$\n$y_1 = y - h/2 = 0 - 4/2 = -2$\n$y_2 = y + h/2 = 0 + 4/2 = 2$\n\nFor the predicted box:\n$\\hat{x}_1 = \\hat{x} - \\hat{w}/2 = 1 - 5/2 = -1.5$\n$\\hat{x}_2 = \\hat{x} + \\hat{w}/2 = 1 + 5/2 = 3.5$\n$\\hat{y}_1 = \\hat{y} - \\hat{h}/2 = -0.5 - 3/2 = -2$\n$\\hat{y}_2 = \\hat{y} + \\hat{h}/2 = -0.5 + 3/2 = 1$\n\nNext, we compute the overlapped extents using the formulas from part (b).\n$W_{int} = \\max(0, \\min(x_2, \\hat{x}_2) - \\max(x_1, \\hat{x}_1)) = \\max(0, \\min(3, 3.5) - \\max(-3, -1.5)) = \\min(3, 3.5) - \\max(-3, -1.5) = 3 - (-1.5) = 4.5$.\n$H_{int} = \\max(0, \\min(y_2, \\hat{y}_2) - \\max(y_1, \\hat{y}_1)) = \\max(0, \\min(2, 1) - \\max(-2, -2)) = \\min(2, 1) - \\max(-2, -2) = 1 - (-2) = 3$.\n\nThe area of intersection is:\n$A_I = W_{int} \\cdot H_{int} = 4.5 \\times 3 = 13.5$.\n\nThe areas of the individual boxes are:\n$A_{GT} = w \\cdot h = 6 \\times 4 = 24$.\n$A_P = \\hat{w} \\cdot \\hat{h} = 5 \\times 3 = 15$.\n\nThe area of the union is:\n$A_U = A_{GT} + A_P - A_I = 24 + 15 - 13.5 = 39 - 13.5 = 25.5$.\n\nFinally, we compute the $\\mathrm{IoU}$:\n$$\\mathrm{IoU} = \\frac{A_I}{A_U} = \\frac{13.5}{25.5} = \\frac{135}{255} = \\frac{27}{51} = \\frac{9}{17}$$\nAs a decimal, this is $9/17 \\approx 0.52941176...$.\nRounding to four significant figures gives $0.5294$.", "answer": "$$\\boxed{0.5294}$$", "id": "3160509"}, {"introduction": "Now that we have a mathematical grasp of $IoU$, let's explore *why* it is the preferred metric for localization over simpler alternatives. This practice challenges you to compare $IoU$ with the Euclidean distance between box centers in two carefully constructed scenarios. You will discover how $IoU$ provides a much more comprehensive evaluation by accounting for scale and aspect ratio, not just proximity [@problem_id:3160438].", "problem": "Consider axis-aligned rectangular bounding boxes in a two-dimensional image plane. A bounding box is parameterized by its center coordinates $(x,y)$, width $w$, and height $h$. For two boxes, define Intersection-over-Union (IoU) as the ratio of the area of their intersection to the area of their union, and define the center distance metric as the Euclidean distance (in pixels) between their centers. Intersection-over-Union (IoU) and the Euclidean center distance are widely used to evaluate object detection localization. In this problem, you will compare these metrics in two scenarios where they give contrasting judgments.\n\nScenario Pair $1$: Ground-truth box $G_1$ has center $(50,50)$, width $40$, and height $20$. Predicted box $P_1$ has center $(51,49)$, width $6$, and height $6$.\n\nScenario Pair $2$: Ground-truth box $G_2$ has center $(200,200)$, width $300$, and height $300$. Predicted box $P_2$ has center $(280,200)$, width $300$, and height $300$.\n\nSelect all statements that are correct:\n\nA. In Pair $1$, the center distance is less than $2$ pixels, yet the Intersection-over-Union is below $0.05$ due to aspect and size mismatch.\n\nB. In Pair $2$, the center distance exceeds $75$ pixels, yet the Intersection-over-Union is at least $0.55$ because the boxes are large and strongly overlapping.\n\nC. Center distance and Intersection-over-Union are equivalent metrics that order predictions identically for all axis-aligned rectangles.\n\nD. The mismatch highlighted by the two pairs shows that minimizing only center distance can lead to poor IoU and vice versa, so a loss function that incorporates overlap (for example, Generalized Intersection-over-Union (GIoU)) is necessary for robust localization.", "solution": "The problem statement is evaluated for validity.\n\n**Step 1: Extract Givens**\n- A bounding box is parameterized by its center coordinates $(x,y)$, width $w$, and height $h$.\n- Intersection-over-Union (IoU) is defined as the ratio of the area of the intersection of two boxes to the area of their union.\n- Center distance is defined as the Euclidean distance between the centers of two boxes.\n- Scenario Pair $1$:\n  - Ground-truth box $G_1$: center $(50,50)$, width $w_1=40$, height $h_1=20$.\n  - Predicted box $P_1$: center $(51,49)$, width $w'_1=6$, height $h'_1=6$.\n- Scenario Pair $2$:\n  - Ground-truth box $G_2$: center $(200,200)$, width $w_2=300$, height $h_2=300$.\n  - Predicted box $P_2$: center $(280,200)$, width $w'_2=300$, height $h'_2=300$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The concepts of bounding boxes, Intersection-over-Union, and Euclidean distance are fundamental and standard metrics in the field of computer vision, specifically for object detection. The problem is firmly based on established definitions.\n- **Well-Posed:** All parameters for the bounding boxes are provided with precise numerical values. The definitions of the metrics are clear. This allows for the unique calculation of IoU and center distance for both scenarios.\n- **Objective:** The problem is described using precise, quantitative language. There are no subjective or ambiguous terms.\n\n**Step 3: Verdict and Action**\nThe problem is scientifically sound, well-posed, and objective. It is a valid problem. We proceed to the solution.\n\nThe solution requires calculating the center distance and IoU for each scenario pair.\n\nA bounding box with center $(c_x, c_y)$, width $w$, and height $h$ has corner coordinates given by:\n$x_{min} = c_x - w/2$\n$y_{min} = c_y - h/2$\n$x_{max} = c_x + w/2$\n$y_{max} = c_y + h/2$\nThe area of such a box is $A = w \\times h$.\n\nThe intersection of two boxes $B_a$ and $B_b$ is a rectangle with corner coordinates:\n$x_{int,min} = \\max(x_{a,min}, x_{b,min})$\n$y_{int,min} = \\max(y_{a,min}, y_{b,min})$\n$x_{int,max} = \\min(x_{a,max}, x_{b,max})$\n$y_{int,max} = \\min(y_{a,max}, y_{b,max})$\nThe area of the intersection is $A_{int} = \\max(0, x_{int,max} - x_{int,min}) \\times \\max(0, y_{int,max} - y_{int,min})$.\n\nThe area of the union is given by $A_{union} = A_a + A_b - A_{int}$.\nThe Intersection-over-Union is $IoU = A_{int} / A_{union}$.\n\n**Analysis of Scenario Pair $1$**\n- Ground-truth box $G_1$: center $(50,50)$, $w_1=40$, $h_1=20$.\n  - $A_1 = 40 \\times 20 = 800$.\n  - $x_{1,min}=50-20=30$, $y_{1,min}=50-10=40$.\n  - $x_{1,max}=50+20=70$, $y_{1,max}=50+10=60$.\n- Predicted box $P_1$: center $(51,49)$, $w'_1=6$, $h'_1=6$.\n  - $A'_1 = 6 \\times 6 = 36$.\n  - $x'_{1,min}=51-3=48$, $y'_{1,min}=49-3=46$.\n  - $x'_{1,max}=51+3=54$, $y'_{1,max}=49+3=52$.\n\n- **Center Distance for Pair $1$**:\nThe distance $d_1$ between centers $(50,50)$ and $(51,49)$ is:\n$$d_1 = \\sqrt{(51-50)^2 + (49-50)^2} = \\sqrt{1^2 + (-1)^2} = \\sqrt{2} \\approx 1.414 \\text{ pixels}$$\n\n- **IoU for Pair $1$**:\n  - Intersection coordinates:\n    - $x_{int,min} = \\max(30, 48) = 48$\n    - $y_{int,min} = \\max(40, 46) = 46$\n    - $x_{int,max} = \\min(70, 54) = 54$\n    - $y_{int,max} = \\min(60, 52) = 52$\n  - Area of intersection:\n    - $A_{int,1} = (54-48) \\times (52-46) = 6 \\times 6 = 36$.\n  - Area of union:\n    - $A_{union,1} = A_1 + A'_1 - A_{int,1} = 800 + 36 - 36 = 800$.\n  - IoU:\n    - $IoU_1 = \\frac{A_{int,1}}{A_{union,1}} = \\frac{36}{800} = \\frac{9}{200} = 0.045$.\n\n**Analysis of Scenario Pair $2$**\n- Ground-truth box $G_2$: center $(200,200)$, $w_2=300$, $h_2=300$.\n  - $A_2 = 300 \\times 300 = 90000$.\n  - $x_{2,min}=200-150=50$, $y_{2,min}=200-150=50$.\n  - $x_{2,max}=200+150=350$, $y_{2,max}=200+150=350$.\n- Predicted box $P_2$: center $(280,200)$, $w'_2=300$, $h'_2=300$.\n  - $A'_2 = 300 \\times 300 = 90000$.\n  - $x'_{2,min}=280-150=130$, $y'_{2,min}=200-150=50$.\n  - $x'_{2,max}=280+150=430$, $y'_{2,max}=200+150=350$.\n\n- **Center Distance for Pair $2$**:\nThe distance $d_2$ between centers $(200,200)$ and $(280,200)$ is:\n$$d_2 = \\sqrt{(280-200)^2 + (200-200)^2} = \\sqrt{80^2 + 0^2} = 80 \\text{ pixels}$$\n\n- **IoU for Pair $2$**:\n  - Intersection coordinates:\n    - $x_{int,min} = \\max(50, 130) = 130$\n    - $y_{int,min} = \\max(50, 50) = 50$\n    - $x_{int,max} = \\min(350, 430) = 350$\n    - $y_{int,max} = \\min(350, 350) = 350$\n  - Area of intersection:\n    - $A_{int,2} = (350-130) \\times (350-50) = 220 \\times 300 = 66000$.\n  - Area of union:\n    - $A_{union,2} = A_2 + A'_2 - A_{int,2} = 90000 + 90000 - 66000 = 114000$.\n  - IoU:\n    - $IoU_2 = \\frac{A_{int,2}}{A_{union,2}} = \\frac{66000}{114000} = \\frac{66}{114} = \\frac{11}{19} \\approx 0.5789$.\n\n**Evaluation of Options**\n\nA. In Pair $1$, the center distance is less than $2$ pixels, yet the Intersection-over-Union is below $0.05$ due to aspect and size mismatch.\n- Our calculation shows the center distance is $d_1 = \\sqrt{2} \\approx 1.414$, which is less than $2$.\n- Our calculation shows the IoU is $IoU_1 = 0.045$, which is below $0.05$.\n- The reason given, \"aspect and size mismatch,\" is accurate. The ground truth box $G_1$ has area $800$ and aspect ratio $40/20=2$, while the predicted box $P_1$ has area $36$ and aspect ratio $6/6=1$. This gross mismatch in scale and shape causes the poor overlap despite the proximity of the centers.\n- **Verdict: Correct**\n\nB. In Pair $2$, the center distance exceeds $75$ pixels, yet the Intersection-over-Union is at least $0.55$ because the boxes are large and strongly overlapping.\n- Our calculation shows the center distance is $d_2 = 80$, which exceeds $75$.\n- Our calculation shows the IoU is $IoU_2 = 11/19 \\approx 0.579$, which is at least $0.55$.\n- The reason given is also accurate. The center distance of $80$ pixels is relatively small compared to the box width of $300$ pixels. This results in a large overlap area and consequently a high IoU.\n- **Verdict: Correct**\n\nC. Center distance and Intersection-over-Union are equivalent metrics that order predictions identically for all axis-aligned rectangles.\n- This statement claims that if one prediction is better than another by one metric, it must also be better by the other. The two scenarios serve as a direct counterexample.\n- Comparing the quality of the predictions in the two scenarios:\n  - By center distance: Prediction $P_1$ is superior to $P_2$ because $d_1 \\approx 1.414 \\ll d_2 = 80$.\n  - By IoU: Prediction $P_2$ is superior to $P_1$ because $IoU_2 \\approx 0.579 \\gg IoU_1 = 0.045$.\n- The two metrics produce opposite rankings for the quality of the localization in these two pairs. Therefore, they are not equivalent metrics.\n- **Verdict: Incorrect**\n\nD. The mismatch highlighted by the two pairs shows that minimizing only center distance can lead to poor IoU and vice versa, so a loss function that incorporates overlap (for example, Generalized Intersection-over-Union (GIoU)) is necessary for robust localization.\n- The first part of the statement is a direct conclusion from our analysis. Pair $1$ shows that a very small center distance does not guarantee a good IoU. Pair $2$ shows that a high IoU can be achieved even with a large center distance if the boxes are large. This demonstrates that optimizing for one metric does not necessarily optimize for the other.\n- The second part of the statement is a well-established principle in modern object detection. The limitations of simple L_n-norm losses on box coordinates (which relate to center distance and size) and the limitations of IoU loss (e.g., zero gradients for non-overlapping boxes) led to the development of improved loss functions like Generalized IoU (GIoU), Distance IoU (DIoU), and Complete IoU (CIoU). These losses combine notions of overlap, center distance, and aspect ratio to provide more stable and robust training for bounding box regression. The statement correctly identifies GIoU as an example of such a function and correctly asserts its purpose.\n- **Verdict: Correct**", "answer": "$$\\boxed{ABD}$$", "id": "3160438"}, {"introduction": "While $IoU$ is a powerful metric, it has its own limitations, particularly in cases of ambiguity where different misalignments can yield the same score. This advanced practice invites you to confront one such pathological case and engineer a solution. You will design and implement an auxiliary loss function based on corner distances to break ties, providing a hands-on introduction to the concepts that motivate modern loss functions like GIoU, DIoU, and CIoU [@problem_id:3160496].", "problem": "You are given the task of designing and evaluating a tie-breaking auxiliary loss for object detection bounding box regression when Intersection over Union (IoU) cannot distinguish between two misaligned predictions. Work strictly with axis-aligned bounding boxes parameterized as $\\left[x_{1},y_{1},x_{2},y_{2}\\right]$, where $\\left(x_{1},y_{1}\\right)$ is the top-left corner and $\\left(x_{2},y_{2}\\right)$ is the bottom-right corner in a standard Cartesian plane with the $x$-axis increasing to the right and the $y$-axis increasing downward. Assume all boxes have positive area with $x_{2} \\gt x_{1}$ and $y_{2} \\gt y_{1}$.\n\nStart from the following fundamental definitions:\n- Intersection over Union (IoU) is defined as the ratio of the area of intersection to the area of union between two sets: for axis-aligned rectangles, if the overlap has width $w_{\\mathrm{int}}$ and height $h_{\\mathrm{int}}$, then the intersection area is $A_{\\mathrm{int}} = w_{\\mathrm{int}} \\cdot h_{\\mathrm{int}}$, the predicted and ground-truth areas are $A_{\\mathrm{p}}$ and $A_{\\mathrm{g}}$, and\n$$\n\\mathrm{IoU} = \\frac{A_{\\mathrm{int}}}{A_{\\mathrm{p}} + A_{\\mathrm{g}} - A_{\\mathrm{int}}}.\n$$\n- The overlap width and height for axis-aligned rectangles are\n$$\nw_{\\mathrm{int}} = \\max\\left(0, \\min\\left(x_{2}^{\\mathrm{p}}, x_{2}^{\\mathrm{g}}\\right) - \\max\\left(x_{1}^{\\mathrm{p}}, x_{1}^{\\mathrm{g}}\\right)\\right),\n$$\n$$\nh_{\\mathrm{int}} = \\max\\left(0, \\min\\left(y_{2}^{\\mathrm{p}}, y_{2}^{\\mathrm{g}}\\right) - \\max\\left(y_{1}^{\\mathrm{p}}, y_{1}^{\\mathrm{g}}\\right)\\right).\n$$\n\nDesign an auxiliary corner-distance penalty that can be combined with IoU to break ties when IoU is identical for two different predictions. Define the penalty as follows. Let the four corresponding corners of the predicted and ground-truth boxes be\n$\\left(x_{1}^{\\mathrm{p}}, y_{1}^{\\mathrm{p}}\\right)$, $\\left(x_{2}^{\\mathrm{p}}, y_{1}^{\\mathrm{p}}\\right)$, $\\left(x_{1}^{\\mathrm{p}}, y_{2}^{\\mathrm{p}}\\right)$, $\\left(x_{2}^{\\mathrm{p}}, y_{2}^{\\mathrm{p}}\\right)$ and $\\left(x_{1}^{\\mathrm{g}}, y_{1}^{\\mathrm{g}}\\right)$, $\\left(x_{2}^{\\mathrm{g}}, y_{1}^{\\mathrm{g}}\\right)$, $\\left(x_{1}^{\\mathrm{g}}, y_{2}^{\\mathrm{g}}\\right)$, $\\left(x_{2}^{\\mathrm{g}}, y_{2}^{\\mathrm{g}}\\right)$, respectively. Let the Euclidean distance between corresponding corners be averaged and normalized by the diagonal length of the ground-truth box:\n$$\nD_{\\mathrm{corner}} = \\frac{1}{4} \\sum_{k=1}^{4} \\frac{\\sqrt{\\left(\\Delta x_{k}\\right)^{2} + \\left(\\Delta y_{k}\\right)^{2}}}{\\sqrt{\\left(x_{2}^{\\mathrm{g}} - x_{1}^{\\mathrm{g}}\\right)^{2} + \\left(y_{2}^{\\mathrm{g}} - y_{1}^{\\mathrm{g}}\\right)^{2}}},\n$$\nwhere $\\Delta x_{k}$ and $\\Delta y_{k}$ are the coordinate differences for the $k$-th corresponding corner. This yields a dimensionless, scale-normalized penalty.\n\nCombine IoU and the corner penalty into a single tie-breaking score\n$$\nS = \\mathrm{IoU} - \\alpha \\, D_{\\mathrm{corner}},\n$$\nwith a fixed weight $\\alpha = 0.5$. A higher value of $S$ is better.\n\nConstruct and evaluate a pathological case in which IoU is identical for two misaligned predictions against the same ground-truth box, and show that the auxiliary penalty breaks the tie in favor of the prediction whose corners are closer to the ground-truth corners.\n\nImplement a program that computes $\\mathrm{IoU}$, $D_{\\mathrm{corner}}$, and $S$ for the following test suite. Use a tolerance $\\varepsilon = 10^{-9}$ when asserting equality of floating-point values.\n\nTest suite:\n- Test case $1$ (pathological tie with different misalignment patterns):\n  - Ground truth $G_{1} = \\left[0,0,2,2\\right]$.\n  - Prediction $A_{1} = \\left[1,0,3,2\\right]$.\n  - Prediction $B_{1} = \\left[\\tfrac{1}{2}, \\tfrac{2}{3}, \\tfrac{5}{2}, \\tfrac{8}{3}\\right]$.\n  - Both $A_{1}$ and $B_{1}$ have identical $\\mathrm{IoU}$ with $G_{1}$, but different $D_{\\mathrm{corner}}$. The result for this test is a boolean that is true if $\\left|\\mathrm{IoU}\\left(A_{1},G_{1}\\right) - \\mathrm{IoU}\\left(B_{1},G_{1}\\right)\\right| \\le \\varepsilon$ and $S\\left(B_{1},G_{1}\\right) \\gt S\\left(A_{1},G_{1}\\right)$.\n\n- Test case $2$ (boundary condition with zero overlap for both predictions):\n  - Ground truth $G_{2} = \\left[0,0,1,1\\right]$.\n  - Prediction $A_{2} = \\left[2,0,3,1\\right]$.\n  - Prediction $B_{2} = \\left[10,0,11,1\\right]$.\n  - Both $\\mathrm{IoU}$ values are $0$, but $A_{2}$ is closer in corner distance. The result is a boolean that is true if $\\left|\\mathrm{IoU}\\left(A_{2},G_{2}\\right) - \\mathrm{IoU}\\left(B_{2},G_{2}\\right)\\right| \\le \\varepsilon$ and $S\\left(A_{2},G_{2}\\right) \\gt S\\left(B_{2},G_{2}\\right)$.\n\n- Test case $3$ (happy path where $\\mathrm{IoU}$ ranking should be preserved by the auxiliary loss):\n  - Ground truth $G_{3} = \\left[0,0,2,2\\right]$.\n  - Prediction $A_{3} = \\left[0.3,0.1,2.3,2.1\\right]$.\n  - Prediction $B_{3} = \\left[0.6,0.2,2.6,2.2\\right]$.\n  - The result is a boolean that is true if $\\mathrm{IoU}\\left(A_{3},G_{3}\\right) \\gt \\mathrm{IoU}\\left(B_{3},G_{3}\\right)$ and $S\\left(A_{3},G_{3}\\right) \\gt S\\left(B_{3},G_{3}\\right)$.\n\n- Test case $4$ (edge case of perfect prediction):\n  - Ground truth $G_{4} = \\left[0,0,2,2\\right]$.\n  - Prediction $P_{4} = \\left[0,0,2,2\\right]$.\n  - The result is the scalar value of $S\\left(P_{4},G_{4}\\right)$ as a floating-point number rounded to $6$ decimal places.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[r1,r2,r3,r4]\". Here $r1$, $r2$, and $r3$ are booleans as defined above, and $r4$ is the floating-point value for $S\\left(P_{4},G_{4}\\right)$ rounded to $6$ decimals.\n- No input is provided to the program; it must run with the test suite hard-coded.", "solution": "The problem requires the design and evaluation of a tie-breaking scoring function, $S$, for bounding box regression in object detection. This score combines the standard Intersection over Union ($\\mathrm{IoU}$) metric with a novel auxiliary penalty, $D_{\\mathrm{corner}}$, designed to resolve ambiguities where $\\mathrm{IoU}$ alone is insufficient. The analysis will proceed by first defining the components of the score and then systematically evaluating its behavior across a suite of specified test cases. All bounding boxes are axis-aligned and defined by their top-left $(x_1, y_1)$ and bottom-right $(x_2, y_2)$ corners.\n\nFirst, we define the Intersection over Union ($\\mathrm{IoU}$) for a predicted box $P$ and a ground-truth box $G$. The $\\mathrm{IoU}$ is the ratio of the area of their intersection to the area of their union.\nLet the predicted box be $P = [x_{1}^{\\mathrm{p}}, y_{1}^{\\mathrm{p}}, x_{2}^{\\mathrm{p}}, y_{2}^{\\mathrm{p}}]$ and the ground-truth box be $G = [x_{1}^{\\mathrm{g}}, y_{1}^{\\mathrm{g}}, x_{2}^{\\mathrm{g}}, y_{2}^{\\mathrm{g}}]$.\nThe area of the predicted box is $A_{\\mathrm{p}} = (x_{2}^{\\mathrm{p}} - x_{1}^{\\mathrm{p}})(y_{2}^{\\mathrm{p}} - y_{1}^{\\mathrm{p}})$ and the ground-truth area is $A_{\\mathrm{g}} = (x_{2}^{\\mathrm{g}} - x_{1}^{\\mathrm{g}})(y_{2}^{\\mathrm{g}} - y_{1}^{\\mathrm{g}})$.\nThe intersection area, $A_{\\mathrm{int}}$, is calculated from the overlap width $w_{\\mathrm{int}}$ and height $h_{\\mathrm{int}}$:\n$$\nw_{\\mathrm{int}} = \\max(0, \\min(x_{2}^{\\mathrm{p}}, x_{2}^{\\mathrm{g}}) - \\max(x_{1}^{\\mathrm{p}}, x_{1}^{\\mathrm{g}}))\n$$\n$$\nh_{\\mathrm{int}} = \\max(0, \\min(y_{2}^{\\mathrm{p}}, y_{2}^{\\mathrm{g}}) - \\max(y_{1}^{\\mathrm{p}}, y_{1}^{\\mathrm{g}}))\n$$\n$$\nA_{\\mathrm{int}} = w_{\\mathrm{int}} \\cdot h_{\\mathrm{int}}\n$$\nThe union area is $A_{\\mathrm{union}} = A_{\\mathrm{p}} + A_{\\mathrm{g}} - A_{\\mathrm{int}}$. The $\\mathrm{IoU}$ is then:\n$$\n\\mathrm{IoU}(P,G) = \\frac{A_{\\mathrm{int}}}{A_{\\mathrm{union}}}\n$$\nWhile $\\mathrm{IoU}$ is a powerful metric, it can yield identical values for geometrically distinct misalignments, creating pathological cases where it cannot distinguish the better prediction.\n\nTo resolve such ties, an auxiliary corner distance penalty, $D_{\\mathrm{corner}}$, is introduced. This penalty measures the average normalized Euclidean distance between the four corresponding corners of the predicted and ground-truth boxes. The four corners of a box $[x_1, y_1, x_2, y_2]$ are $(x_1, y_1)$, $(x_2, y_1)$, $(x_1, y_2)$, and $(x_2, y_2)$. The penalty is defined as:\n$$\nD_{\\mathrm{corner}} = \\frac{1}{4} \\sum_{k=1}^{4} \\frac{\\sqrt{(\\Delta x_{k})^{2} + (\\Delta y_{k})^{2}}}{d_{\\mathrm{g}}}\n$$\nwhere $(\\Delta x_k, \\Delta y_k)$ is the vector between the $k$-th corresponding corners of the predicted and ground-truth boxes, and $d_{\\mathrm{g}}$ is the length of the diagonal of the ground-truth box, $d_{\\mathrm{g}} = \\sqrt{(x_{2}^{\\mathrm{g}} - x_{1}^{\\mathrm{g}})^2 + (y_{2}^{\\mathrm{g}} - y_{1}^{\\mathrm{g}})^2}$. Normalization by $d_{\\mathrm{g}}$ ensures the penalty is a dimensionless, scale-invariant quantity. A smaller $D_{\\mathrm{corner}}$ value indicates a better geometric alignment of the corners.\n\nThe final tie-breaking score, $S$, combines $\\mathrm{IoU}$ and $D_{\\mathrm{corner}}$:\n$$\nS(P,G) = \\mathrm{IoU}(P,G) - \\alpha \\, D_{\\mathrm{corner}}(P,G)\n$$\nwith the weight $\\alpha$ given as $0.5$. This score prioritizes maximizing $\\mathrm{IoU}$ while using the corner distance as a penalty term. A higher score $S$ indicates a better prediction.\n\nWe now evaluate $S$ on the provided test suite.\n\n**Test Case 1: Pathological Tie**\n- Ground Truth $G_1 = [0, 0, 2, 2]$\n- Prediction $A_1 = [1, 0, 3, 2]$\n- Prediction $B_1 = [1/2, 2/3, 5/2, 8/3]$\nFor $(A_1, G_1)$: $A_{\\mathrm{g}} = 4$, $A_{\\mathrm{p}} = 4$. Intersection is $[1, 0, 2, 2]$, so $A_{\\mathrm{int}} = 2$. $\\mathrm{IoU}(A_1, G_1) = \\frac{2}{4+4-2} = \\frac{2}{6} = \\frac{1}{3}$.\nFor $(B_1, G_1)$: $A_{\\mathrm{g}} = 4$, $A_{\\mathrm{p}} = (5/2 - 1/2)(8/3 - 2/3) = 2 \\cdot 2 = 4$. Intersection is $[1/2, 2/3, 2, 2]$, so $A_{\\mathrm{int}} = (2 - 1/2)(2 - 2/3) = (3/2)(4/3) = 2$. $\\mathrm{IoU}(B_1, G_1) = \\frac{2}{4+4-2} = \\frac{1}{3}$.\nThe condition $|\\mathrm{IoU}(A_1, G_1) - \\mathrm{IoU}(B_1, G_1)| \\le \\varepsilon$ is satisfied, as the difference is exactly $0$.\nNow we compute $D_{\\mathrm{corner}}$ for both. The diagonal of $G_1$ is $d_{\\mathrm{g}} = \\sqrt{(2-0)^2 + (2-0)^2} = \\sqrt{8} = 2\\sqrt{2}$.\nFor $A_1$, the displacement for all four corners is $(\\Delta x, \\Delta y) = (1, 0)$, so the distance is $1$. Thus, $D_{\\mathrm{corner}}(A_1, G_1) = \\frac{1}{4} \\frac{1+1+1+1}{2\\sqrt{2}} = \\frac{4}{8\\sqrt{2}} = \\frac{\\sqrt{2}}{4}$.\nFor $B_1$, the displacement for each of the four corresponding corners is $(1/2, 2/3)$, leading to a distance of $\\sqrt{(1/2)^2 + (2/3)^2} = \\sqrt{1/4 + 4/9} = \\sqrt{25/36} = 5/6$ for each corner. Thus, $D_{\\mathrm{corner}}(B_1, G_1) = \\frac{1}{4} \\frac{4 \\cdot (5/6)}{2\\sqrt{2}} = \\frac{5/6}{2\\sqrt{2}} = \\frac{5}{12\\sqrt{2}} = \\frac{5\\sqrt{2}}{24}$.\nComparing penalties: $\\frac{\\sqrt{2}}{4} = \\frac{6\\sqrt{2}}{24} > \\frac{5\\sqrt{2}}{24}$. So $D_{\\mathrm{corner}}(A_1, G_1) > D_{\\mathrm{corner}}(B_1, G_1)$.\nThis implies $S(A_1, G_1) < S(B_1, G_1)$. The condition $S(B_1, G_1) > S(A_1, G_1)$ holds. The final result for this test case is true.\n\n**Test Case 2: Zero Overlap**\n- Ground Truth $G_2 = [0, 0, 1, 1]$\n- Prediction $A_2 = [2, 0, 3, 1]$\n- Prediction $B_2 = [10, 0, 11, 1]$\nFor both $(A_2, G_2)$ and $(B_2, G_2)$, the boxes are disjoint, so $A_{\\mathrm{int}} = 0$. $\\mathrm{IoU}(A_2, G_2) = 0$ and $\\mathrm{IoU}(B_2, G_2) = 0$. The first condition $|\\mathrm{IoU}(A_2, G_2) - \\mathrm{IoU}(B_2, G_2)| \\le \\varepsilon$ is met.\nThe diagonal of $G_2$ is $d_{\\mathrm{g}} = \\sqrt{(1-0)^2 + (1-0)^2} = \\sqrt{2}$.\nFor $A_2$, the corner displacements are all $(\\Delta x, \\Delta y) = (2, 0)$, so the distance is $2$. $D_{\\mathrm{corner}}(A_2, G_2) = \\frac{1}{4} \\frac{4 \\cdot 2}{\\sqrt{2}} = \\frac{2}{\\sqrt{2}} = \\sqrt{2}$.\nFor $B_2$, the corner displacements are all $(\\Delta x, \\Delta y) = (10, 0)$, so the distance is $10$. $D_{\\mathrm{corner}}(B_2, G_2) = \\frac{1}{4} \\frac{4 \\cdot 10}{\\sqrt{2}} = \\frac{10}{\\sqrt{2}} = 5\\sqrt{2}$.\nSince $\\mathrm{IoU}$ is $0$ for both, $S(P,G) = -\\alpha D_{\\mathrm{corner}}(P,G)$. As $D_{\\mathrm{corner}}(A_2, G_2) < D_{\\mathrm{corner}}(B_2, G_2)$, it follows that $S(A_2, G_2) > S(B_2, G_2)$. The condition holds. The final result is true.\n\n**Test Case 3: Preserving IoU Ranking**\n- Ground Truth $G_3 = [0, 0, 2, 2]$\n- Prediction $A_3 = [0.3, 0.1, 2.3, 2.1]$\n- Prediction $B_3 = [0.6, 0.2, 2.6, 2.2]$\nFor $(A_3, G_3)$: $A_{\\mathrm{g}} = 4$, $A_{\\mathrm{p}}=4$. Intersection is $[0.3, 0.1, 2, 2]$, so $A_{\\mathrm{int}} = (2-0.3)(2-0.1) = 1.7 \\cdot 1.9 = 3.23$. $\\mathrm{IoU}(A_3, G_3) = \\frac{3.23}{4+4-3.23} = \\frac{3.23}{4.77} \\approx 0.67715$.\nFor $(B_3, G_3)$: $A_{\\mathrm{g}} = 4$, $A_{\\mathrm{p}}=4$. Intersection is $[0.6, 0.2, 2, 2]$, so $A_{\\mathrm{int}} = (2-0.6)(2-0.2) = 1.4 \\cdot 1.8 = 2.52$. $\\mathrm{IoU}(B_3, G_3) = \\frac{2.52}{4+4-2.52} = \\frac{2.52}{5.48} \\approx 0.45985$.\nClearly $\\mathrm{IoU}(A_3, G_3) > \\mathrm{IoU}(B_3, G_3)$. The first part of the condition holds.\nThe diagonal of $G_3$ is $d_{\\mathrm{g}} = 2\\sqrt{2}$.\nFor $A_3$, the corner displacements are $(\\Delta x, \\Delta y) = (0.3, 0.1)$. Distance is $\\sqrt{0.3^2+0.1^2} = \\sqrt{0.1}$. $D_{\\mathrm{corner}}(A_3, G_3) = \\frac{1}{4} \\frac{4\\sqrt{0.1}}{2\\sqrt{2}} = \\frac{\\sqrt{0.1}}{2\\sqrt{2}} \\approx 0.1118$.\nFor $B_3$, the corner displacements are $(\\Delta x, \\Delta y) = (0.6, 0.2)$. Distance is $\\sqrt{0.6^2+0.2^2} = \\sqrt{0.4}$. $D_{\\mathrm{corner}}(B_3, G_3) = \\frac{1}{4} \\frac{4\\sqrt{0.4}}{2\\sqrt{2}} = \\frac{\\sqrt{0.4}}{2\\sqrt{2}} \\approx 0.2236$.\nNow we compute the scores:\n$S(A_3, G_3) \\approx 0.67715 - 0.5 \\cdot 0.1118 \\approx 0.62125$.\n$S(B_3, G_3) \\approx 0.45985 - 0.5 \\cdot 0.2236 \\approx 0.34805$.\n$S(A_3, G_3) > S(B_3, G_3)$, so the second part of the condition also holds. The final result is true.\n\n**Test Case 4: Perfect Prediction**\n- Ground Truth $G_4 = [0, 0, 2, 2]$\n- Prediction $P_4 = [0, 0, 2, 2]$\nThe prediction is identical to the ground truth.\n$\\mathrm{IoU}(P_4, G_4) = 1$, as $A_{\\mathrm{int}} = A_{\\mathrm{p}} = A_{\\mathrm{g}} = 4$.\n$D_{\\mathrm{corner}}(P_4, G_4) = 0$, as all corner displacements $(\\Delta x_k, \\Delta y_k)$ are $(0, 0)$.\nThe score is $S(P_4, G_4) = 1 - 0.5 \\cdot 0 = 1$. Rounded to $6$ decimal places, this is $1.000000$.\n\nThe analysis confirms that the designed score $S$ successfully addresses the limitations of $\\mathrm{IoU}$ in the pathological test cases while behaving coherently in standard scenarios.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by implementing and evaluating a tie-breaking\n    score for bounding box regression.\n    \"\"\"\n\n    def calculate_metrics(p_box, g_box, alpha):\n        \"\"\"\n        Calculates IoU, D_corner, and the combined score S.\n\n        Args:\n            p_box (np.ndarray): Predicted box [x1, y1, x2, y2].\n            g_box (np.ndarray): Ground-truth box [x1, y1, x2, y2].\n            alpha (float): Weight for the corner penalty.\n\n        Returns:\n            tuple: A tuple containing (iou, d_corner, s_score).\n        \"\"\"\n        x1p, y1p, x2p, y2p = p_box\n        x1g, y1g, x2g, y2g = g_box\n\n        # Calculate IoU\n        x1_int = max(x1p, x1g)\n        y1_int = max(y1p, y1g)\n        x2_int = min(x2p, x2g)\n        y2_int = min(y2p, y2g)\n\n        w_int = max(0, x2_int - x1_int)\n        h_int = max(0, y2_int - y1_int)\n        A_int = w_int * h_int\n\n        A_p = (x2p - x1p) * (y2p - y1p)\n        A_g = (x2g - x1g) * (y2g - y1g)\n\n        A_union = A_p + A_g - A_int\n        iou = A_int / A_union if A_union > 1e-9 else 0.0\n\n        # Calculate D_corner\n        p_corners = np.array([\n            [x1p, y1p], [x2p, y1p], [x1p, y2p], [x2p, y2p]\n        ])\n        g_corners = np.array([\n            [x1g, y1g], [x2g, y1g], [x1g, y2g], [x2g, y2g]\n        ])\n\n        w_g = x2g - x1g\n        h_g = y2g - y1g\n        diag_g = np.sqrt(w_g**2 + h_g**2)\n\n        if diag_g < 1e-9:\n            d_corner = 0.0\n        else:\n            corner_dists = np.sqrt(np.sum((p_corners - g_corners)**2, axis=1))\n            total_dist = np.sum(corner_dists)\n            d_corner = (1/4) * (total_dist / diag_g)\n\n        # Calculate S\n        s_score = iou - alpha * d_corner\n\n        return iou, d_corner, s_score\n\n    # Define test parameters\n    alpha = 0.5\n    epsilon = 1e-9\n    results = []\n    \n    # Test case 1\n    G1 = np.array([0., 0., 2., 2.])\n    A1 = np.array([1., 0., 3., 2.])\n    B1 = np.array([1/2, 2/3, 5/2, 8/3])\n    iou_a1, _, s_a1 = calculate_metrics(A1, G1, alpha)\n    iou_b1, _, s_b1 = calculate_metrics(B1, G1, alpha)\n    result1 = abs(iou_a1 - iou_b1) <= epsilon and s_b1 > s_a1\n    results.append(result1)\n\n    # Test case 2\n    G2 = np.array([0., 0., 1., 1.])\n    A2 = np.array([2., 0., 3., 1.])\n    B2 = np.array([10., 0., 11., 1.])\n    iou_a2, _, s_a2 = calculate_metrics(A2, G2, alpha)\n    iou_b2, _, s_b2 = calculate_metrics(B2, G2, alpha)\n    result2 = abs(iou_a2 - iou_b2) <= epsilon and s_a2 > s_b2\n    results.append(result2)\n\n    # Test case 3\n    G3 = np.array([0., 0., 2., 2.])\n    A3 = np.array([0.3, 0.1, 2.3, 2.1])\n    B3 = np.array([0.6, 0.2, 2.6, 2.2])\n    iou_a3, _, s_a3 = calculate_metrics(A3, G3, alpha)\n    iou_b3, _, s_b3 = calculate_metrics(B3, G3, alpha)\n    result3 = iou_a3 > iou_b3 and s_a3 > s_b3\n    results.append(result3)\n    \n    # Test case 4\n    G4 = np.array([0., 0., 2., 2.])\n    P4 = np.array([0., 0., 2., 2.])\n    _, _, s_p4 = calculate_metrics(P4, G4, alpha)\n    result4 = f\"{s_p4:.6f}\"\n    results.append(result4)\n\n    # Final print statement\n    final_results_str = []\n    for res in results:\n        if isinstance(res, bool):\n            final_results_str.append(str(res).lower())\n        else:\n            final_results_str.append(str(res))\n    print(f\"[{','.join(final_results_str)}]\")\n\nsolve()\n```", "id": "3160496"}]}