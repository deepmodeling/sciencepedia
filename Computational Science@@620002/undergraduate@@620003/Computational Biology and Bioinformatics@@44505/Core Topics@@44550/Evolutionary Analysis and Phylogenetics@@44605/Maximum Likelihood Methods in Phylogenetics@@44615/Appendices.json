{"hands_on_practices": [{"introduction": "The primary output of a maximum likelihood phylogenetic analysis is a phylogram, where branch lengths are not arbitrary but carry a specific statistical meaning. This first exercise challenges you to correctly interpret these branch lengths, a fundamental skill for drawing valid evolutionary inferences from phylogenetic trees. By analyzing a hypothetical result, you will learn to connect the visual representation of a long branch to its quantitative meaning in terms of evolutionary change [@problem_id:1946202].", "problem": "A team of evolutionary biologists is investigating the relationships among four species of deep-sea corals (Species A, B, C, and D) using DNA sequence data from a mitochondrial gene. They align the sequences and employ a Maximum Likelihood (ML) phylogenetic analysis, which is a statistical method for inferring evolutionary trees. The ML algorithm calculates the likelihood of the observed sequence data for a given tree topology and a model of nucleotide substitution, and its output includes a phylogram where branch lengths are proportional to the estimated amount of evolutionary change.\n\nThe resulting phylogram shows a tree topology of ((A,B),C),D). The branches leading to Species A, Species B, and the internal branch uniting them are all relatively short. The branch leading to Species C is of moderate length. However, the terminal branch leading to Species D is exceptionally long, indicating a high value for the branch length parameter estimated by the ML model for that lineage.\n\nBased on the principles of Maximum Likelihood phylogenetics, which of the following statements provides the most direct and certain interpretation of the long branch leading to Species D?\n\nA. Species D is a \"living fossil,\" representing the ancestral state of the entire group.\n\nB. The mitochondrial gene in the lineage leading to Species D has accumulated a significantly larger number of estimated nucleotide substitutions per site compared to the other lineages.\n\nC. The sequence data for Species D likely contains numerous sequencing errors, which the model has mistaken for genuine mutations.\n\nD. Species D must be the outgroup to the clade containing Species A, B, and C.\n\nE. The rate of speciation was much slower in the lineage leading to Species D.", "solution": "In a maximum likelihood phylogenetic analysis under a specified nucleotide substitution model, the likelihood is $\\mathcal{L}(\\text{data} \\mid \\text{topology}, \\{\\ell_{i}\\}, \\theta)$, where the $\\ell_{i}$ are branch lengths and $\\theta$ are model parameters. The ML estimates of branch lengths maximize this likelihood and are interpreted as the expected number of substitutions per site along each branch, typically denoted in units of substitutions per site. Formally, for a lineage with instantaneous substitution rate $r(t)$ over time, the branch length is $\\ell=\\int r(t)\\,dt$, and thus a larger $\\ell$ reflects a larger cumulative expected number of substitutions per site along that lineage.\n\nIn the reported phylogram, the terminal branch leading to Species D is exceptionally long relative to others. The most direct and certain interpretation, by definition of branch length in an ML phylogram, is that the ML model has estimated a substantially larger number of nucleotide substitutions per site along the lineage to D than along the other lineages.\n\nEvaluating the options:\n- A is incorrect: a long branch does not indicate an ancestral state; it indicates greater inferred change, not stasis or primitiveness.\n- B is correct: a longer branch length directly means more estimated substitutions per site on that lineage under the ML model.\n- C is not a direct or certain interpretation: while sequencing error can, in principle, inflate apparent changes, this is a speculative data-quality hypothesis and not implied by the ML output alone.\n- D is incorrect: a long branch does not imply outgroup status; rooting requires external information, and long-branch attraction is a known artifact but not a certainty nor a definition of outgroup.\n- E is incorrect: branch lengths reflect molecular change (substitutions per site), not speciation rates.\n\nTherefore, the most direct and certain interpretation is that the lineage to Species D has accumulated more estimated substitutions per site.", "answer": "$$\\boxed{B}$$", "id": "1946202"}, {"introduction": "Real-world datasets are often incomplete, containing missing data for certain taxa. This practical exercise explores how the maximum likelihood framework robustly handles such imperfections, a crucial concept for any practicing bioinformatician. You will investigate the statistical impact of having a large fraction of missing data for one taxon on the estimation of its branch length, $b_D$, revealing how ML avoids bias while quantifying uncertainty [@problem_id:2402743].", "problem": "In a phylogenetic analysis under Maximum Likelihood (ML), consider a fixed, correctly specified unrooted tree on four taxa, with a known topology and unknown branch lengths. Assume a time-homogeneous, time-reversible, stationary nucleotide substitution model with equal base frequencies and equal substitution rates (the Jukes–Cantor model), and an alignment of length $N$ independent sites evolving identically and independently on this tree. One taxon, call it taxon $D$, has $90\\%$ of its sites coded as missing data (denoted by the symbol “$?$”), with the missingness for taxon $D$ occurring independently across sites and independently of the true nucleotide states (i.e., missing completely at random). Under standard ML handling of missing data, a “$?$” at a leaf is treated as an unknown/ambiguous state, and the per-site likelihood is marginalized over all possible true nucleotides at that leaf.\n\nLet $b_{D}$ denote the pendant branch length leading to taxon $D$. Which statement best describes the impact of the $90\\%$ missing data at taxon $D$ on the ML estimation of $b_{D}$?\n\nA. Only the approximately $0.1N$ sites where taxon $D$ is observed directly inform $b_{D}$; the remaining approximately $0.9N$ sites contribute no information about $b_{D}$ under the model, so the ML estimate of $b_{D}$ remains consistent as $N \\to \\infty$ but has increased variance relative to the complete-data case.\n\nB. Because “$?$” is treated as matching every nucleotide, the per-site likelihood at missing positions penalizes longer branches most strongly, so the ML estimate of $b_{D}$ is driven toward $0$ as $N$ increases.\n\nC. The $90\\%$ missing data at taxon $D$ causes all branch lengths in the tree, including internal branches unrelated to $D$, to be underestimated by roughly $90\\%$.\n\nD. The missing positions induce the algorithm to impute random nucleotides for taxon $D$, which systematically inflates the ML estimate of $b_{D}$ above its true value.\n\nE. Regardless of the data on the other taxa, the internal branch adjacent to $D$ becomes unidentifiable in the presence of $90\\%$ missing data at $D$, so the ML estimation problem lacks a well-defined maximum for that branch.", "solution": "The total likelihood of the alignment $S$ given the tree topology and branch lengths $\\mathbf{b}$ is the product of the likelihoods for each site, due to the assumption of independence:\n$$L(\\mathbf{b} | S) = \\prod_{i=1}^{N} L_i(\\mathbf{b} | S_i)$$\nwhere $S_i$ is the character data at site $i$. The log-likelihood is $\\ell(\\mathbf{b}) = \\sum_{i=1}^{N} \\log L_i(\\mathbf{b} | S_i)$.\n\nThe likelihood for a single site is calculated using Felsenstein's pruning algorithm. This algorithm computes the probability of the observed states at the leaves of the tree by recursively calculating \"partial likelihoods\" at each internal node, summing over all possible states at each node.\n\nLet us analyze the calculation for two types of sites from the alignment:\n1.  **Sites where taxon $D$ is observed**: This corresponds to approximately $0.1N$ sites. At such a site, the state of taxon $D$ is a specific nucleotide (e.g., $A$, $C$, $G$, or $T$). The pruning algorithm starts at this leaf with a partial likelihood vector that is $1$ for the observed state and $0$ for others (e.g., $(1, 0, 0, 0)^T$ for state $A$). This vector is propagated up the tree along the branch of length $b_D$. The likelihood contribution of this site will explicitly depend on the transition probabilities over the branch length $b_D$. Thus, these sites contain information about $b_D$.\n\n2.  **Sites where taxon $D$ is missing**: This corresponds to approximately $0.9N$ sites. The state for taxon $D$ is \"?\". Standard ML practice treats this as ambiguity, meaning the true state could be any of the possible nucleotides. The likelihood is calculated by marginalizing over these possibilities. In the pruning algorithm, this is accomplished by setting the initial partial likelihood vector for taxon $D$ to $(1, 1, 1, 1)^T$.\n\nLet $P(b_D)$ be the transition probability matrix for the branch leading to taxon $D$. The elements of this matrix, $[P(b_D)]_{xy}$, give the probability of observing state $y$ at the leaf given state $x$ at the ancestral node. When this vector is propagated from the leaf $D$ to its parent node $u$, the resulting partial likelihood vector is given by $P(b_D)^T (1, 1, 1, 1)^T$.\n\nFor any time-reversible substitution model, including the Jukes-Cantor model, the transition matrix $P(t)$ is such that its columns sum to $1$. This is because the uniform distribution of bases is stationary. Therefore, each row of the transposed matrix $P(t)^T$ sums to $1$. The product $P(b_D)^T (1, 1, 1, 1)^T$ results in a vector whose elements are the sums of the rows of $P(b_D)^T$, which is simply $(1, 1, 1, 1)^T$.\n\nThis means that the partial likelihood contribution from the subtree containing taxon $D$ to the rest of the tree is a vector of ones, which is independent of the branch length $b_D$. Consequently, the total likelihood for any site where taxon $D$ has a \"?\" is not a function of $b_D$.\n\nThe total log-likelihood can be partitioned:\n$$\\ell(\\mathbf{b}) = \\sum_{i \\in \\text{sites with observed } D} \\log L_i(\\mathbf{b}) + \\sum_{j \\in \\text{sites with missing } D} \\log L_j(\\mathbf{b})$$\nTo find the ML estimate of $b_D$, we solve $\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = 0$.\nThe derivative is:\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D} + \\sum_{j \\in \\text{sites with missing } D} \\frac{\\partial \\log L_j(\\mathbf{b})}{\\partial b_D}$$\nSince $L_j(\\mathbf{b})$ is independent of $b_D$ for sites with missing data at $D$, the second term is zero.\n$$\\frac{\\partial \\ell(\\mathbf{b})}{\\partial b_D} = \\sum_{i \\in \\text{sites with observed } D} \\frac{\\partial \\log L_i(\\mathbf{b})}{\\partial b_D}$$\nThis demonstrates that only the sites where data for taxon $D$ are observed contribute to the estimation of its pendant branch length, $b_D$.\n\nThe statistical consequences are as follows:\n- **Consistency**: The ML estimator for $b_D$ is based on an effective sample size of approximately $0.1N$. Since this sample size still approaches infinity as $N \\to \\infty$, the ML estimator for $b_D$ remains consistent (i.e., it converges in probability to the true value of $b_D$). There is no systematic bias.\n- **Variance**: The amount of information about a parameter is related to the sample size. The Fisher Information for $b_D$ is now derived from only about $10\\%$ of the sites. As the asymptotic variance of an ML estimator is the inverse of the Fisher Information, the variance of the estimate of $b_D$ will be approximately $10$ times larger than in the complete-data case.\n\nNow, we evaluate each option:\n\n**A. Only the approximately $0.1N$ sites where taxon $D$ is observed directly inform $b_{D}$; the remaining approximately $0.9N$ sites contribute no information about $b_{D}$ under the model, so the ML estimate of $b_{D}$ remains consistent as $N \\to \\infty$ but has increased variance relative to the complete-data case.**\nThis statement is fully consistent with our derivation. The sites with missing data for taxon $D$ contribute zero to the gradient of the log-likelihood with respect to $b_D$, meaning they provide no information for its estimation. The estimator remains consistent because the number of informative sites still grows to infinity with $N$. The variance increases because the effective sample size is drastically reduced. **Correct.**\n\n**B. Because “$?$” is treated as matching every nucleotide, the per-site likelihood at missing positions penalizes longer branches most strongly, so the ML estimate of $b_{D}$ is driven toward $0$ as $N$ increases.**\nThis is incorrect. As shown, the per-site likelihood at missing positions is independent of $b_D$. It neither penalizes nor rewards any particular value of $b_D$. The ML estimate of $b_D$ is consistent, not biased toward $0$. **Incorrect.**\n\n**C. The $90\\%$ missing data at taxon $D$ causes all branch lengths in the tree, including internal branches unrelated to $D$, to be underestimated by roughly $90\\%$.**\nThis is incorrect. The estimation of other branch lengths (e.g., those within the subtree of taxa $A$, $B$, and $C$) utilizes information from all $N$ sites. For the $90\\%$ of sites where $D$ is missing, the data behave like a 3-taxon alignment, which is still informative for the relationships among $A$, $B$, and $C$. There is no reason to expect a systematic underestimation, let alone one of $90\\%$. The estimators for all branch lengths should be consistent. **Incorrect.**\n\n**D. The missing positions induce the algorithm to impute random nucleotides for taxon $D$, which systematically inflates the ML estimate of $b_{D}$ above its true value.**\nThis is a mischaracterization of the ML method. ML does not impute (i.e., \"fill in\") missing data with random values. It correctly integrates (marginalizes) over the uncertainty. This procedure does not introduce systematic bias; the estimator for $b_D$ is consistent. Imputing random data would likely lead to bias (overestimation of $b_D$, as random data would appear more diverged than the true data), but this is not what the specified algorithm does. **Incorrect.**\n\n**E. Regardless of the data on the other taxa, the internal branch adjacent to $D$ becomes unidentifiable in the presence of $90\\%$ missing data at $D$, so the ML estimation problem lacks a well-defined maximum for that branch.**\nThis is incorrect. An unrooted 4-taxon tree has one internal branch. While this branch is indeed unidentifiable from the $90\\%$ of sites where taxon $D$ is missing (as the data collapses to a 3-taxon star tree), it remains identifiable from the $10\\%$ of sites where all four taxa are observed. As long as there is some non-zero fraction of sites with complete data, all parameters of the 4-taxon tree are theoretically identifiable. The estimation problem has a well-defined maximum, though the precision of the estimate for the internal branch will be poor. **Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2402743"}, {"introduction": "To truly master maximum likelihood, it is helpful to look \"under the hood\" at the behavior of the likelihood function itself. This thought experiment explores how the total log-likelihood of a tree changes when all its branch lengths are scaled by a constant factor, $c$. This will build your intuition for the shape of the likelihood landscape and clarify why an optimal set of branch lengths—the maximum likelihood estimate—can be found [@problem_id:2402788].", "problem": "In maximum likelihood (ML) phylogenetic inference under a continuous-time Markov chain (CTMC) substitution model, the probability of a change along a branch of duration $t$ is governed by the transition matrix $P(t) = \\exp(Q t)$, where $Q$ is the instantaneous rate matrix with rows summing to $0$, off-diagonal entries nonnegative, and stationary distribution $\\boldsymbol{\\pi}$. For a fixed tree topology with branch lengths $\\{\\ell_e\\}$ and a fixed, time-homogeneous substitution process with rate matrix $Q$ and stationary distribution $\\boldsymbol{\\pi}$, the per-site likelihood is obtained by summing over all assignments of ancestral states at internal nodes (e.g., via the Felsenstein pruning algorithm), and the total log-likelihood across $n$ independent and identically distributed sites is the sum of per-site log-likelihoods.\n\nConsider scaling all branch lengths by the same positive constant $c > 0$, so that each branch length $\\ell_e$ is replaced by $c \\ell_e$, while holding $Q$ and $\\boldsymbol{\\pi}$ fixed. Assume $Q$ is normalized to have expected substitutions per unit time equal to $1$.\n\nWhich statements about the effect of this scaling on the total log-likelihood are correct? Select all that apply.\n\nA. The total log-likelihood is unchanged for any $c$, because only relative branch lengths matter.\n\nB. For fixed $Q$, scaling all branch lengths by $c$ generally changes the total log-likelihood in a nonlinear way and there exists a value of $c$ that maximizes the likelihood; as $c \\to 0$ or $c \\to \\infty$, the total log-likelihood decreases relative to its maximum for typical data with differences among taxa.\n\nC. The total log-likelihood always increases as $c$ increases, because longer branches allow more substitutions and thus fit more observed differences.\n\nD. The total log-likelihood always decreases as $c$ increases, because longer branches make leaf states effectively random under the stationary distribution.\n\nE. The total log-likelihood is invariant to scaling branch lengths by $c$ if, at the same time, the rate matrix is scaled to $Q/c$ (so that $P(c t)$ under $Q$ equals $P(t)$ under $Q/c$); otherwise, for fixed $Q$, the total log-likelihood changes with $c$.", "solution": "The total log-likelihood, which we denote as $\\mathcal{L}$, is a function of the tree topology $\\tau$, the set of branch lengths $\\boldsymbol{\\ell} = \\{\\ell_e\\}$, and the parameters of the substitution model, which include the instantaneous rate matrix $Q$ and the stationary distribution $\\boldsymbol{\\pi}$. The problem specifies a fixed topology and fixed model parameters $Q$ and $\\boldsymbol{\\pi}$. The branch lengths are uniformly scaled by a positive constant $c > 0$, so $\\ell_e \\to c\\ell_e$. We must analyze the behavior of the total log-likelihood as a function of this scaling factor $c$. Let this function be $f(c) = \\mathcal{L}(c\\boldsymbol{\\ell} \\mid Q, \\tau)$.\n\nThe likelihood calculation for each site involves transition probabilities along the branches of the tree. The transition probability matrix for a branch of length $t$ is $P(t) = \\exp(Qt)$. When branch lengths are scaled by $c$, the new transition matrix for a branch $e$ is $P(c\\ell_e) = \\exp(Q c \\ell_e)$. The total log-likelihood is the sum of log-likelihoods over all sites, and each per-site likelihood is a complex function of these transition probabilities, computed via an algorithm such as Felsenstein's pruning algorithm.\n\nLet us analyze the behavior of $f(c)$ at its limits.\n\n1.  **As $c \\to 0$**: The length of every branch $c\\ell_e$ approaches $0$. The transition matrix approaches the identity matrix, $P(c\\ell_e) = \\exp(Qc\\ell_e) \\approx I + Qc\\ell_e \\to I$. This implies that the probability of a substitution occurring on any branch approaches zero. The model thus predicts that all sequences at the tips of the tree (the observed taxa) should be identical. The problem states we have \"typical data with differences among taxa\". For such data, a model that predicts no change is a very poor fit. For any site where two related taxa have different character states, the likelihood contribution will approach $0$, and the log-likelihood will approach $-\\infty$. Therefore, for typical data, $\\lim_{c \\to 0} f(c) = -\\infty$.\n\n2.  **As $c \\to \\infty$**: The length of every branch $c\\ell_e$ approaches infinity. For an ergodic Markov process, the transition matrix $P(t)$ converges to a matrix where each row is the stationary distribution $\\boldsymbol{\\pi}$. That is, $\\lim_{t \\to \\infty} P_{ij}(t) = \\pi_j$. This means that the state at the end of a very long branch is independent of the state at its beginning and is simply a random draw from the stationary distribution $\\boldsymbol{\\pi}$. When all branches are infinitely long, the states at all leaf nodes become independent and identically distributed draws from $\\boldsymbol{\\pi}$. The likelihood of the data at a site then depends only on the frequencies of characters at that site, not on their phylogenetic relationships. This model completely ignores the phylogenetic signal (the shared history) in the data. For \"typical data,\" which exhibits correlations reflecting a particular evolutionary history, this model will also be a poor fit compared to a model with finite, optimal branch lengths. Consequently, the log-likelihood will be low, although typically not $-\\infty$.\n\nSince the function $f(c) = \\mathcal{L}(c\\boldsymbol{\\ell})$ is low for $c \\to 0$ and for $c \\to \\infty$, and assuming it is a continuous function for $c > 0$, it must attain a maximum value for some $c_{ML} \\in (0, \\infty)$. This is the fundamental basis for ML estimation of branch lengths.\n\nNow, we evaluate each option based on this analysis.\n\n**A. The total log-likelihood is unchanged for any $c$, because only relative branch lengths matter.**\nThis statement is **Incorrect**. The likelihood depends on the absolute, not just relative, branch lengths. The absolute length of a branch, measured in expected substitutions, determines the probability of change along that branch. Scaling all branch lengths changes these probabilities, $P(c\\ell_e)$, and therefore changes the overall likelihood. The total number of substitutions expected over the tree, which is proportional to $c$, is a critical parameter.\n\n**B. For fixed $Q$, scaling all branch lengths by $c$ generally changes the total log-likelihood in a nonlinear way and there exists a value of $c$ that maximizes the likelihood; as $c \\to 0$ or $c \\to \\infty$, the total log-likelihood decreases relative to its maximum for typical data with differences among taxa.**\nThis statement is **Correct**. Our analysis shows precisely this behavior. The dependence on $c$ is through the matrix exponential function $\\exp(Qc\\ell_e)$, which is highly nonlinear. As derived above, for typical data showing both similarities and differences, the log-likelihood is low at the extremes ($c \\to 0$ and $c \\to \\infty$) and must have a maximum for some finite, positive $c$. This option provides an accurate qualitative description of the likelihood function with respect to a global branch length scaling factor.\n\n**C. The total log-likelihood always increases as $c$ increases, because longer branches allow more substitutions and thus fit more observed differences.**\nThis statement is **Incorrect**. It correctly notes that increasing $c$ from a small value can improve the fit, but it incorrectly assumes this trend is monotonic. As established, for very large $c$, the phylogenetic signal is destroyed, leading to a poorer fit for structured data. Therefore, the log-likelihood does not always increase with $c$.\n\n**D. The total log-likelihood always decreases as $c$ increases, because longer branches make leaf states effectively random under the stationary distribution.**\nThis statement is **Incorrect**. While it correctly describes the behavior for large $c$ (beyond the maximum likelihood value), it fails to account for the initial increase in likelihood as $c$ moves away from $0$. For data with differences, a model with zero branch lengths ($c=0$) has an extremely low likelihood, which must increase as $c$ increases initially.\n\n**E. The total log-likelihood is invariant to scaling branch lengths by $c$ if, at the same time, the rate matrix is scaled to $Q/c$ (so that $P(c t)$ under $Q$ equals $P(t)$ under $Q/c$); otherwise, for fixed $Q$, the total log-likelihood changes with $c$.**\nThis statement is **Correct**. The likelihood is determined by the transition matrices $P(\\ell_e) = \\exp(Q\\ell_e)$ and the stationary distribution $\\boldsymbol{\\pi}$. Consider the simultaneous transformation $\\ell_e \\to \\ell'_e = c\\ell_e$ and $Q \\to Q' = Q/c$. The new matrix product in the exponential is $Q'\\ell'_e = (Q/c)(c\\ell_e) = Q\\ell_e$. Thus, the transition matrices are unchanged. The stationary distribution $\\boldsymbol{\\pi}$ is the left eigenvector of $Q$ with eigenvalue $0$, such that $\\boldsymbol{\\pi} Q = \\mathbf{0}$. For the new matrix $Q'$, we have $\\boldsymbol{\\pi}Q' = \\boldsymbol{\\pi}(Q/c) = (1/c)(\\boldsymbol{\\pi}Q) = \\mathbf{0}$, so $\\boldsymbol{\\pi}$ is also invariant. Since all inputs to the likelihood calculation are unchanged, the likelihood itself is invariant. This reveals a fundamental non-identifiability between the overall rate of substitution and the total tree length. The second part of the statement, \"otherwise, for fixed $Q$, the total log-likelihood changes with $c$\", is the scenario analyzed for options A-D, and as established, the likelihood does change with $c$.\nIt must be noted that the parenthetical remark, \"so that $P(c t)$ under $Q$ equals $P(t)$ under $Q/c$,\" contains a minor typographical error. The correct identity for the invariance of the matrix exponential argument $Qt$ is that $P(t)$ under $Q$ equals $P(ct)$ under $Q/c$, since $\\exp(Qt) = \\exp((Q/c)(ct))$. However, the primary claims of the statement are fundamentally sound and central to the theory of phylogenetic likelihood, so the statement as a whole is correct in its substance.\n\nBoth statements B and E are correct.", "answer": "$$\\boxed{BE}$$", "id": "2402788"}]}