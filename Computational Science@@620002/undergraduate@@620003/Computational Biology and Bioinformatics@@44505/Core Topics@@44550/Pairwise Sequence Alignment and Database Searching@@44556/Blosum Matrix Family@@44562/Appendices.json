{"hands_on_practices": [{"introduction": "To truly understand BLOSUM matrices, it's best to build one from the ground up. This exercise guides you through the fundamental process of deriving a substitution score from raw alignment data. By working with a hypothetical new amino acid, 'Z', you will perform the core calculations that transform observed pair counts into meaningful log-odds scores, demystifying where the numbers in the matrix come from [@problem_id:2376348].", "id": "2376348", "problem": "A synthetic amino acid, denoted $Z$, is introduced into protein sequences. You are given a set of aligned sequence blocks clustered at the $62\\%$ identity threshold used for constructing the BLOcks SUbstitution Matrix (BLOSUM) family, and you will extend the BLOSUM62-style scoring to include $Z$. Let unordered aligned-pair counts be denoted $c_{ij}$ for residues $i$ and $j$, with total unordered pairs $N = \\sum_{i \\le j} c_{ij}$. For $Z$, the only observed unordered counts involving $Z$ in the dataset are:\n- $c_{ZZ} = 10$,\n- $c_{ZA} = 8$,\n- $c_{ZG} = 6$,\n- $c_{ZS} = 4$,\n- $c_{ZP} = 2$,\n- $c_{ZX} = 0$ for all other canonical amino acids $X \\in \\{ \\text{C}, \\text{D}, \\text{E}, \\text{F}, \\text{H}, \\text{I}, \\text{K}, \\text{L}, \\text{M}, \\text{N}, \\text{Q}, \\text{R}, \\text{T}, \\text{V}, \\text{W}, \\text{Y} \\}$.\nAll unordered aligned-pair counts not involving $Z$ sum to $50$, i.e., $\\sum_{i \\le j,\\, i,j \\neq Z} c_{ij} = 50$.\n\nDefine the empirical joint probabilities $p_{ij} = c_{ij} / N$ for unordered pairs and the marginal residue frequencies\n$$\nq_i \\;=\\; p_{ii} \\;+\\; \\sum_{j \\neq i} \\frac{p_{ij}}{2} \\, ,\n$$\nwhich represent the probability that a randomly chosen residue in an aligned column is $i$. In the BLOSUM framework, the substitution score is the scaled base-$2$ log-odds\n$$\ns_{ij} \\;=\\; \\beta \\,\\log_{2}\\!\\left(\\frac{p_{ij}}{q_i\\,q_j}\\right),\n$$\nwith scaling factor $\\beta = 2$ for BLOSUM62-style integer units.\n\nUsing only the data above and these definitions, compute the exact BLOSUM62-style integer score for the self-substitution $s_{ZZ}$. Report a single number. Do not round; the value in this dataset is an exact integer.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. The given definitions and data are consistent with the standard methodology for constructing BLOSUM matrices. We proceed with the calculation.\n\nThe objective is to compute the self-substitution score for the synthetic amino acid $Z$, denoted as $s_{ZZ}$. The formula provided is:\n$$\ns_{ij} = \\beta \\log_{2}\\left(\\frac{p_{ij}}{q_i q_j}\\right)\n$$\nFor the self-substitution of $Z$, this becomes:\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right)\n$$\nWe are given the scaling factor $\\beta = 2$. To compute $s_{ZZ}$, we must first determine the values of the total number of unordered aligned-pairs $N$, the joint probability $p_{ZZ}$, and the marginal frequency $q_Z$.\n\nFirst, we calculate the total number of unordered aligned-pairs, $N$. This is the sum of all observed counts $c_{ij}$. The problem provides counts involving the amino acid $Z$ and the sum of all counts not involving $Z$.\n$$\nN = \\sum_{i \\le j} c_{ij} = \\left(\\sum_{i \\le j, \\, i,j \\neq Z} c_{ij}\\right) + \\sum_{j} c_{Zj}\n$$\nThe first term is given as $50$. The second term is the sum of all counts where at least one residue is $Z$. These consist of pairs of $Z$ with itself ($c_{ZZ}$) and pairs of $Z$ with other amino acids ($c_{Zj}$ for $j \\neq Z$).\n$$\n\\sum_{j} c_{Zj} = c_{ZZ} + c_{ZA} + c_{ZG} + c_{ZS} + c_{ZP} + \\sum_{X} c_{ZX}\n$$\nwhere $X$ represents all other canonical amino acids for which the count $c_{ZX}$ is zero. Substituting the given values:\n$$\n\\sum_{j} c_{Zj} = 10 + 8 + 6 + 4 + 2 + 0 = 30\n$$\nThus, the total number of pairs is:\n$$\nN = 50 + 30 = 80\n$$\n\nNext, we calculate the empirical joint probability $p_{ZZ}$. This is the ratio of the count of $Z-Z$ pairs to the total number of pairs.\n$$\np_{ZZ} = \\frac{c_{ZZ}}{N} = \\frac{10}{80} = \\frac{1}{8}\n$$\n\nNow, we compute the marginal frequency of the residue $Z$, denoted $q_Z$. The provided formula is:\n$$\nq_Z = p_{ZZ} + \\sum_{j \\neq Z} \\frac{p_{Zj}}{2}\n$$\nWe need to calculate the probabilities $p_{Zj} = c_{Zj}/N$ for all $j \\neq Z$. The non-zero counts are for $j \\in \\{ A, G, S, P \\}$. The sum of these probabilities is:\n$$\n\\sum_{j \\neq Z} p_{Zj} = \\frac{c_{ZA}}{N} + \\frac{c_{ZG}}{N} + \\frac{c_{ZS}}{N} + \\frac{c_{ZP}}{N} = \\frac{8}{80} + \\frac{6}{80} + \\frac{4}{80} + \\frac{2}{80} = \\frac{8+6+4+2}{80} = \\frac{20}{80} = \\frac{1}{4}\n$$\nSubstituting this into the formula for $q_Z$:\n$$\nq_Z = p_{ZZ} + \\frac{1}{2} \\left(\\sum_{j \\neq Z} p_{Zj}\\right) = \\frac{1}{8} + \\frac{1}{2}\\left(\\frac{1}{4}\\right) = \\frac{1}{8} + \\frac{1}{8} = \\frac{2}{8} = \\frac{1}{4}\n$$\n\nFinally, we have all the components to calculate the substitution score $s_{ZZ}$.\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right) = 2 \\log_{2}\\left(\\frac{1/8}{(1/4)^2}\\right)\n$$\nWe evaluate the argument of the logarithm:\n$$\n\\frac{p_{ZZ}}{q_Z^2} = \\frac{1/8}{1/16} = \\frac{1}{8} \\times \\frac{16}{1} = \\frac{16}{8} = 2\n$$\nSubstituting this result back into the expression for $s_{ZZ}$:\n$$\ns_{ZZ} = 2 \\log_{2}(2)\n$$\nSince $\\log_{2}(2) = 1$, the final score is:\n$$\ns_{ZZ} = 2 \\times 1 = 2\n$$\nThe resulting score is an integer, as specified in the problem statement.", "answer": "$$\\boxed{2}$$"}, {"introduction": "The numbers within a BLOSUM matrix are not arbitrary; each one tells a story about evolutionary relationships. This practice allows you to deconstruct a known score from the famous BLOSUM62 matrix to reveal its core components. By reverse-engineering the score for a Serine-Threonine pair, you will gain a deeper intuition for how a log-odds score quantifies whether a substitution occurs more or less frequently than expected by chance [@problem_id:2376388].", "id": "2376388", "problem": "In the construction of a BLOcks SUbstitution Matrix (BLOSUM), each entry is a log-odds score comparing the observed joint probability of aligned amino acids to the probability expected under independent background composition. For BLOSUM62, the score for a pair of amino acids $i$ and $j$ is defined using half-bit units as\n$$\ns_{ij} \\;=\\; \\mathrm{round}\\!\\left( 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right) \\right),\n$$\nwhere $q_{ij}$ is the ordered-pair joint probability of aligning residue $i$ with residue $j$ in the curated blocks after clustering, and $p_i$ and $p_j$ are the background frequencies of residues $i$ and $j$, respectively. The matrix is symmetric, so $q_{ij} = q_{ji}$ and $s_{ij} = s_{ji}$.\n\nFor the serine–threonine pair, BLOSUM62 reports the score $s_{ST} = 1$. Assume that the rounding operation is negligible (i.e., replace $\\mathrm{round}(\\cdot)$ by the identity) so that the reported integer can be treated as the exact unrounded half-bit score for the purpose of this calculation.\n\nUsing only the definition above, express the target frequency $q_{ST}$ analytically in terms of the background frequencies $p_S$ and $p_T$ and known constants. Provide your final expression in closed form. No numerical evaluation is required, and no units are involved. Do not estimate or substitute numerical values for $p_S$ or $p_T$.\n\nYour final answer must be a single closed-form analytic expression.", "solution": "The problem is subjected to validation and is found to be scientifically sound, well-posed, and free of ambiguity. It is a straightforward exercise in algebraic manipulation derived from the principles of bioinformatics scoring matrices. We shall proceed with the derivation.\n\nThe definition of the BLOSUM score $s_{ij}$ for a pair of amino acids $i$ and $j$ is given by the formula:\n$$\ns_{ij} \\;=\\; \\mathrm{round}\\!\\left( 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right) \\right)\n$$\nHere, $q_{ij}$ represents the observed joint probability of the alignment, and $p_i$ and $p_j$ are the respective background frequencies of the amino acids.\n\nThe problem requires us to consider the specific case of the serine–threonine pair, denoted by $S$ and $T$. For this pair, the score is given as $s_{ST} = 1$. A critical instruction is to neglect the rounding operation, which simplifies the governing equation to:\n$$\ns_{ij} = 2 \\log_{2}\\!\\left( \\frac{q_{ij}}{p_i p_j} \\right)\n$$\nOur objective is to solve for the target frequency $q_{ST}$ in terms of the background frequencies $p_S$ and $p_T$.\n\nWe substitute the given values for the serine-threonine pair into the simplified equation:\n$$\n1 = 2 \\log_{2}\\!\\left( \\frac{q_{ST}}{p_S p_T} \\right)\n$$\nTo solve for $q_{ST}$, we must isolate it. The first step is to divide both sides of the equation by $2$:\n$$\n\\frac{1}{2} = \\log_{2}\\!\\left( \\frac{q_{ST}}{p_S p_T} \\right)\n$$\nThis equation is in logarithmic form. To eliminate the logarithm, we convert the equation to its equivalent exponential form. By the definition of a logarithm, if $y = \\log_b(x)$, then $b^y = x$. Applying this principle, we set the base of the logarithm, $2$, as the base of the exponentiation on both sides:\n$$\n2^{\\frac{1}{2}} = \\frac{q_{ST}}{p_S p_T}\n$$\nThe term $2^{\\frac{1}{2}}$ is, by definition, the square root of $2$, which is written as $\\sqrt{2}$. The equation becomes:\n$$\n\\sqrt{2} = \\frac{q_{ST}}{p_S p_T}\n$$\nFinally, to isolate $q_{ST}$, we multiply both sides by the product of the background frequencies, $p_S p_T$:\n$$\nq_{ST} = p_S p_T \\sqrt{2}\n$$\nThis expression provides the target frequency $q_{ST}$ as a function of the background frequencies $p_S$ and $p_T$ and the constant $\\sqrt{2}$, as required. The expression is in closed form and does not depend on any other variables. It demonstrates that for a positive log-odds score ($s_{ST}=1 > 0$), the observed frequency of substitution $q_{ST}$ is greater than the frequency expected by random chance ($p_S p_T$) by a factor of $\\sqrt{2}$. This is consistent with the chemical similarity between serine and threonine, which both possess a hydroxyl group.", "answer": "$$\n\\boxed{p_S p_T \\sqrt{2}}\n$$"}, {"introduction": "BLOSUM matrices are the engines behind powerful search tools like BLAST, where scores are used to calculate statistical significance. This advanced exercise explores the deep connection between the mathematical construction of a scoring matrix and the E-value used to assess alignment quality. By investigating how a change in the logarithm's base affects the scores, you will uncover an invariant property that is fundamental to the Karlin-Altschul statistical framework [@problem_id:2376389].", "id": "2376389", "problem": "A Blocks Substitution Matrix (BLOSUM) is a log-odds scoring matrix with entries defined, for a chosen logarithm base $b$, by $S^{(b)}_{ij} = \\log_{b}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right)$, where $p_{i}$ and $p_{j}$ are background amino acid frequencies and $q_{ij}$ is the observed aligned pair frequency in conserved blocks. Consider the amino acids alanine ($\\mathrm{A}$) and glycine ($\\mathrm{G}$) with background frequencies $p_{\\mathrm{A}} = 0.08$ and $p_{\\mathrm{G}} = 0.07$, and the following symmetric observed pair frequencies in aligned blocks: $q_{\\mathrm{AA}} = 0.011$, $q_{\\mathrm{AG}} = q_{\\mathrm{GA}} = 0.006$, and $q_{\\mathrm{GG}} = 0.004$.\n\nUsing the natural logarithm $\\ln$ (base $\\exp(1)$) instead of base $2$, recalculate the scores $S^{(e)}_{\\mathrm{AA}}$, $S^{(e)}_{\\mathrm{AG}}$, and $S^{(e)}_{\\mathrm{GG}}$ for this portion of the matrix from first principles, starting from the definition of log-odds. Then, consider a local alignment scored as the sum of these substitution scores without gap penalties. Assume the Karlin–Altschul statistics hold and that the expected number of high-scoring segment pairs with score at least $S$ is given by $E = K\\, m\\, n \\exp(-\\lambda S)$ for both scoring schemes, where $K$, $m$, and $n$ are the same under both schemes. Assume further that the two scoring schemes are exact log-odds matrices differing only by the change of logarithm base (no additional integer scaling or rounding).\n\nUnder these assumptions, what is the value of the ratio $E^{(e)}/E^{(2)}$ of the Basic Local Alignment Search Tool (BLAST) E-values when using the natural logarithm–based matrix versus the base-$2$ matrix for the same alignment? Provide your final answer as a single real number. No rounding is required.", "solution": "The problem requires an analysis of the effect of changing the logarithm base in a BLOSUM scoring matrix on the resulting E-value from a BLAST search. We are given the definition of a BLOSUM score, $S_{ij}$, for a pair of amino acids $i$ and $j$, as a log-odds ratio:\n$$ S^{(b)}_{ij} = \\log_{b}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\nHere, $p_i$ is the background frequency of amino acid $i$, $q_{ij}$ is the observed frequency of the aligned pair $(i, j)$ in conserved blocks, and $b$ is the base of the logarithm.\n\nThe problem compares two scoring schemes: one using the natural logarithm (base $e$), denoted $S^{(e)}_{ij}$, and one using base $2$, denoted $S^{(2)}_{ij}$. Their definitions are:\n$$ S^{(e)}_{ij} = \\ln\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\n$$ S^{(2)}_{ij} = \\log_{2}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\nWe can relate these two scores using the change of base formula for logarithms, $\\log_{a}(x) = \\frac{\\log_{c}(x)}{\\log_{c}(a)}$. Let us convert the base-$2$ logarithm to the natural logarithm:\n$$ S^{(2)}_{ij} = \\frac{\\ln\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right)}{\\ln(2)} = \\frac{S^{(e)}_{ij}}{\\ln(2)} $$\nThis establishes a simple scaling relationship between the scores in the two systems:\n$$ S^{(e)}_{ij} = S^{(2)}_{ij} \\ln(2) $$\nThe total score of an alignment, $S$, is the sum of the scores of the individual aligned pairs. If an alignment consists of a sequence of pairs, the total scores, $S^{(e)}$ and $S^{(2)}$, are related by the same scaling factor:\n$$ S^{(e)} = \\sum_{k} S^{(e)}_{i_k j_k} = \\sum_{k} \\left(S^{(2)}_{i_k j_k} \\ln(2)\\right) = \\left(\\ln(2)\\right) \\sum_{k} S^{(2)}_{i_k j_k} = S^{(2)} \\ln(2) $$\n\nNext, we must analyze the Karlin-Altschul statistical parameter $\\lambda$. For a given scoring matrix $S_{ij}$ and background frequencies $p_i$, $\\lambda$ is the unique positive root of the equation:\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda S_{ij}) = 1 $$\nLet $\\lambda^{(e)}$ and $\\lambda^{(2)}$ be the parameters corresponding to the base-$e$ and base-$2$ scoring matrices, respectively. They must satisfy their respective equations:\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda^{(e)} S_{ij}^{(e)}) = 1 $$\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda^{(2)} S_{ij}^{(2)}) = 1 $$\nWe substitute the relationship $S_{ij}^{(e)} = S_{ij}^{(2)} \\ln(2)$ into the first equation:\n$$ \\sum_{i,j} p_i p_j \\exp\\left(\\lambda^{(e)} (S_{ij}^{(2)} \\ln(2))\\right) = 1 $$\nRearranging the term inside the exponent gives:\n$$ \\sum_{i,j} p_i p_j \\exp\\left((\\lambda^{(e)} \\ln(2)) S_{ij}^{(2)}\\right) = 1 $$\nSince $\\lambda$ is the unique positive solution for a given matrix, comparing this equation to the defining equation for $\\lambda^{(2)}$, we must have equality of the coefficients of $S_{ij}^{(2)}$ in the exponent:\n$$ \\lambda^{(2)} = \\lambda^{(e)} \\ln(2) $$\nThis gives us the relationship between the $\\lambda$ parameters for the two systems:\n$$ \\lambda^{(e)} = \\frac{\\lambda^{(2)}}{\\ln(2)} $$\n\nThe problem asks for the ratio of E-values, $E^{(e)}/E^{(2)}$. The E-value is given by the formula $E = K m n \\exp(-\\lambda S)$, where $K$, $m$, and $n$ are constants related to the search space and statistical properties of the score matrix. The problem states that these are the same for both schemes.\nThe two E-values are:\n$$ E^{(e)} = K m n \\exp(-\\lambda^{(e)} S^{(e)}) $$\n$$ E^{(2)} = K m n \\exp(-\\lambda^{(2)} S^{(2)}) $$\nThe ratio is:\n$$ \\frac{E^{(e)}}{E^{(2)}} = \\frac{K m n \\exp(-\\lambda^{(e)} S^{(e)})}{K m n \\exp(-\\lambda^{(2)} S^{(2)})} = \\exp\\left(-\\lambda^{(e)} S^{(e)} + \\lambda^{(2)} S^{(2)}\\right) $$\nLet us examine the term $\\lambda^{(e)} S^{(e)}$ by substituting the derived relationships:\n$$ \\lambda^{(e)} S^{(e)} = \\left(\\frac{\\lambda^{(2)}}{\\ln(2)}\\right) \\left(S^{(2)} \\ln(2)\\right) = \\lambda^{(2)} S^{(2)} $$\nThis demonstrates that the product $\\lambda S$ is invariant under a change of logarithm base for the scoring matrix. This product represents the score in dimensionless units (nats), which is fundamental to the statistical theory.\nTherefore, the exponent in the ratio of E-values is zero:\n$$ -\\lambda^{(e)} S^{(e)} + \\lambda^{(2)} S^{(2)} = 0 $$\nThe ratio simplifies to:\n$$ \\frac{E^{(e)}}{E^{(2)}} = \\exp(0) = 1 $$\nThe specific numerical data provided for frequencies ($p_{\\mathrm{A}} = 0.08$, $p_{\\mathrm{G}} = 0.07$) and observed pairs ($q_{\\mathrm{AA}} = 0.011$, $q_{\\mathrm{AG}} = 0.006$, $q_{\\mathrm{GG}} = 0.004$) are not necessary for this derivation. The result is general and holds for any alignment and any valid set of probabilities, given the condition that the scoring matrices are exact log-odds matrices differing only by the logarithm base. The prompt to calculate specific scores is a distraction from the core theoretical question.", "answer": "$$\n\\boxed{1}\n$$"}]}