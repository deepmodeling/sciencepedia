{"hands_on_practices": [{"introduction": "Before analyzing gene expression, it is vital to ensure the integrity of your data. This exercise challenges you to design a robust quality control metric to verify sample identity, a critical first step in any RNA-sequencing analysis [@problem_id:2417798]. By comparing different statistical strategies, you will learn to think like a bioinformatician, leveraging biological knowledge to create a method that can detect potential sample mix-ups or contamination while being insensitive to technical noise like sequencing depth.", "problem": "You are evaluating human bulk Ribonucleic Acid sequencing (RNA-seq) libraries for sample identity. Metadata provides a stated biological sex (male or female) for each sample. You wish to design a single sample-level quality control statistic that flags potential contamination or mislabeling by exploiting expression of sex-specific genes, particularly those on chromosome Y, while being robust to variable sequencing depth, gene length, and mapping ambiguity. You may assume you have, for each sample, gene-level read counts $c_g$, effective transcript lengths $L_g$, total mapped fragments $N$, and standard ways to compute normalizations such as Transcripts Per Million (TPM). You also have a curated set $Y$ of male-specific, high-mappability Y-linked marker genes that exclude pseudoautosomal and paralogous regions, and knowledge of the X inactive specific transcript (XIST), a gene expressed in females but typically silenced in males. Let $\\delta$ denote a small positive pseudocount.\n\nWhich of the following defines the most appropriate metric to detect sex discordance or contamination, given the stated constraints?\n\nA. Declare a sample contaminated if the absolute number of reads mapping anywhere on chromosome Y exceeds $100$.\n\nB. Compute the sex-discordance score\n$$\nS \\;=\\; \\log_2\\!\\left(\\frac{\\sum_{g\\in Y} \\mathrm{TPM}^{\\mathrm{uniq}}_g + \\delta}{\\mathrm{TPM}_{\\mathrm{XIST}} + \\delta}\\right),\n$$\nwhere $\\mathrm{TPM}^{\\mathrm{uniq}}_g$ is computed from uniquely mapping fragments and effective lengths for genes $g\\in Y$. Flag a female-labeled sample if $S$ is above a chosen threshold and a male-labeled sample if $S$ is below that threshold.\n\nC. Use the chromosome-level ratio\n$$\nR \\;=\\; \\frac{\\text{total reads mapped to chromosome Y}}{\\text{total reads mapped to chromosome X}},\n$$\nand declare discordance if $R$ exceeds a fixed cutoff for female-labeled samples or falls below it for male-labeled samples.\n\nD. Use the mitochondrial read fraction\n$$\nM \\;=\\; \\frac{\\text{reads mapped to mitochondrial genome}}{N},\n$$\nand declare contamination if $M$ is unusually high compared to the cohort median.\n\nE. Compute the proportion\n$$\nP \\;=\\; \\frac{1}{|Y|}\\sum_{g\\in Y}\\mathbf{1}\\{c_g \\geq 1\\},\n$$\nand declare contamination if $P$ exceeds a fixed threshold in a female-labeled sample.", "solution": "The problem requires the formulation of a robust quality control metric for detecting sex discordance (mislabeling) or cross-sex contamination in human bulk RNA-seq samples. The core requirements for such a metric are that it must exploit sex-specific gene expression, be robust to variations in sequencing depth and gene length, and account for mapping ambiguity.\n\nLet us establish the principles for a valid metric based on the provided information.\n1.  **Biological Basis**: The fundamental biological difference is the chromosome complement: males are XY, females are XX. An effective metric must leverage this. The problem provides a curated set of male-specific Y-linked genes, $Y$, and the X-inactive specific transcript, `XIST`, which is highly expressed in females to mediate X-inactivation but is typically silent in males. A powerful metric would contrast the expression of Y-linked markers with `XIST` expression.\n2.  **Robustness to Sequencing Depth**: The total number of reads per sample, $N$, can vary significantly. Any metric based on raw read counts, $c_g$, will be heavily biased by this variation. Therefore, normalization for library size is essential.\n3.  **Robustness to Gene Length**: The number of reads mapping to a gene is proportional to its length, $L_g$. A metric that sums read counts over genes without accounting for their lengths will be biased. Normalization for gene length is required for inter-gene comparisons.\n4.  **Robustness to Mapping Ambiguity**: Reads originating from repetitive sequences or genes with close paralogs (e.g., on other chromosomes) can be misplaced by alignment algorithms. This is particularly problematic for chromosome Y, which shares pseudoautosomal regions (PARs) with chromosome X. The problem correctly suggests using a curated set $Y$ of `high-mappability` non-PAR genes and, as an additional measure, one could filter for uniquely mapping reads.\n\nA metric that satisfies these points would likely involve Transcripts Per Million (TPM), as TPM normalization is defined as:\n$$\n\\mathrm{TPM}_g = \\left( \\frac{c_g / L_g}{\\sum_{k} (c_k / L_k)} \\right) \\times 10^6\n$$\nwhere $k$ iterates over all genes. This formula explicitly normalizes for both gene length $L_g$ (in the term $c_g / L_g$) and sequencing depth (in the denominator, which is proportional to total library size).\n\nUsing these principles, we will now evaluate each option.\n\n**A. Declare a sample contaminated if the absolute number of reads mapping anywhere on chromosome Y exceeds $100$.**\nThis metric is based on a fixed threshold of an absolute read count. It is not robust to sequencing depth, as a deeply sequenced female sample could exceed the threshold due to noise, while a shallowly sequenced male sample might not. It is also not robust to mapping ambiguity from pseudoautosomal regions. Therefore, this approach is fundamentally flawed.\n**Verdict: Incorrect.**\n\n**B. Compute the sex-discordance score $$S \\;=\\; \\log_2\\!\\left(\\frac{\\sum_{g\\in Y} \\mathrm{TPM}^{\\mathrm{uniq}}_g + \\delta}{\\mathrm{TPM}_{\\mathrm{XIST}} + \\delta}\\right)$$, where $\\mathrm{TPM}^{\\mathrm{uniq}}_g$ is computed from uniquely mapping fragments and effective lengths for genes $g\\in Y$. Flag a female-labeled sample if $S$ is above a chosen threshold and a male-labeled sample if $S$ is below that threshold.**\nThis metric constructs a ratio of a male expression signature to a female expression signature. It correctly leverages sex-specific markers (`Y` genes vs. `XIST`). It is robust to sequencing depth and gene length because it uses TPM. It is robust to mapping ambiguity by using a curated gene set and uniquely mapping fragments. The log-transform and pseudocount are statistically sound. High $S$ indicates a male-like profile (high Y expression, low `XIST`), and low $S$ indicates a female-like profile (low Y expression, high `XIST`). This metric meets all requirements.\n**Verdict: Correct.**\n\n**C. Use the chromosome-level ratio $$R \\;=\\; \\frac{\\text{total reads mapped to chromosome Y}}{\\text{total reads mapped to chromosome X}}$$, and declare discordance if $R$ exceeds a fixed cutoff for female-labeled samples or falls below it for male-labeled samples.**\nThis metric is not robust because the denominator (`total reads mapped to chromosome X`) is noisy and variable, depending on many genes unrelated to sex. It also fails to account for mapping ambiguity or normalize for gene length.\n**Verdict: Incorrect.**\n\n**D. Use the mitochondrial read fraction $$M \\;=\\; \\frac{\\text{reads mapped to mitochondrial genome}}{N}$$, and declare contamination if $M$ is unusually high compared to the cohort median.**\nThis is a valid QC metric for RNA quality or cell health, but it provides no information about the sample's sex. It is inappropriate for the stated task.\n**Verdict: Incorrect.**\n\n**E. Compute the proportion $$P \\;=\\; \\frac{1}{|Y|}\\sum_{g\\in Y}\\mathbf{1}\\{c_g \\geq 1\\}$$, and declare contamination if $P$ exceeds a fixed threshold in a female-labeled sample.**\nThis metric calculates the fraction of genes in set $Y$ with at least one read. The condition $c_g \\geq 1$ is highly sensitive to sequencing depth, violating a key requirement. It also discards quantitative information, making it less powerful than a TPM-based metric.\n**Verdict: Incorrect.**\n\nIn summary, Option B is the only one that proposes a metric satisfying all the critical requirements for a robust, sensitive, and specific sex-check statistic in RNA-seq analysis. It is well-designed from both a biological and a bioinformatic perspective.", "answer": "$$\\boxed{B}$$", "id": "2417798"}, {"introduction": "RNA-seq data is inherently compositional, meaning each gene's measurement is a proportion of the total transcript pool, not an absolute count. This practice problem uses a carefully designed hypothetical scenario to demonstrate a critical pitfall of simple total-count normalization methods [@problem_id:2417849]. By performing the calculation, you will discover how a single, strongly over-expressed gene can systematically skew the data, creating the false appearance of down-regulation for thousands of unchanged genes and underscoring the need for more sophisticated normalization techniques.", "problem": "An experimenter performs RNA sequencing (RNA-seq; Ribonucleic Acid sequencing) on two conditions, $A$ and $B$, using the same number of cells per sample and no external controls or spike-ins. Each library is sequenced to exactly $100000$ mapped reads. The assay produces read counts that are, in expectation, proportional to the fraction of transcript molecules contributed by each gene in the library. The experimenter applies a standard total-count scaling normalization (counts per million, CPM), which divides each gene’s count by the sample’s total mapped reads, thereby comparing relative abundances.\n\nConsider a gene set consisting of one gene $X$ and $990$ other genes. The true absolute transcript molecules per cell are as follows:\n\n- In condition $A$: gene $X$ has $1000$ molecules; each of the other $990$ genes has $100$ molecules.\n- In condition $B$: gene $X$ is strongly over-expressed with $50000$ molecules; each of the other $990$ genes remains at $100$ molecules.\n\nAssume that the sequencing process samples reads proportionally to these underlying transcript fractions, and ignore sampling variance. The experimenter computes log base-$2$ fold-changes using CPM-normalized values between $B$ and $A$.\n\nWhich option best describes the apparent log base-$2$ fold-change for any one of the unchanged other genes (not $X$) under this normalization and why?\n\nA. Approximately $-0.58$ for most other genes, because the single highly abundant gene $X$ in condition $B$ reduces the relative fractions of all unchanged genes, making them appear down-regulated under total-count normalization.\n\nB. Approximately $0$ for most other genes, because total-count normalization fully removes composition effects due to over-expression of a single gene.\n\nC. Approximately $+0.58$ for most other genes, because the large increase in total RNA content in condition $B$ raises all normalized counts.\n\nD. It depends on sequencing depth; increasing reads from $100000$ to $200000$ would drive the apparent log base-$2$ fold-change for most other genes toward $0$ under total-count normalization.", "solution": "This problem illustrates the artifact of compositional data analysis. Let's calculate the apparent fold-change for one of the 990 unchanged genes, which we can call gene $Y$.\n\n1.  **Calculate the total number of transcript molecules per cell in each condition.** This determines the denominator for calculating relative abundance.\n    *   Condition A: Total molecules $T_A = 1000 (\\text{gene } X) + 990 \\times 100 (\\text{other genes}) = 100,000$.\n    *   Condition B: Total molecules $T_B = 50,000 (\\text{gene } X) + 990 \\times 100 (\\text{other genes}) = 149,000$.\n\n2.  **Calculate the molecular fraction of gene $Y$ in each condition.** Gene $Y$ has 100 molecules in both conditions.\n    *   Fraction in Condition A: $f_{Y,A} = \\frac{100}{T_A} = \\frac{100}{100,000}$.\n    *   Fraction in Condition B: $f_{Y,B} = \\frac{100}{T_B} = \\frac{100}{149,000}$.\n\n3.  **Determine the fold-change of normalized counts.**\n    Total-count normalization methods like Counts Per Million (CPM) make the final values proportional to the underlying molecular fractions. Since the sequencing depth is identical for both samples, the fold-change of the CPM-normalized values is simply the ratio of these fractions. The sequencing depth and the \"per million\" scaling factor cancel out.\n    $$\n    \\text{Fold Change (FC)} = \\frac{f_{Y,B}}{f_{Y,A}} = \\frac{100 / 149,000}{100 / 100,000} = \\frac{100,000}{149,000} \\approx 0.67114\n    $$\n\n4.  **Calculate the log base-2 fold-change.**\n    $$\n    \\log_2(\\text{FC}) = \\log_2(0.67114) \\approx -0.5753\n    $$\n\nThis value is approximately $-0.58$. The reason for this apparent down-regulation is that the massive overexpression of gene $X$ in condition B consumes a much larger proportion of the total transcriptional output. This necessarily reduces the proportion of all other genes, even though their absolute abundance has not changed. Total-count normalization fails to correct for this compositional effect and instead reports a spurious down-regulation. Thus, option A is correct.", "answer": "$$\\boxed{A}$$", "id": "2417849"}, {"introduction": "Visualizations like Principal Component Analysis (PCA) and MA-plots are essential tools for exploring data and interpreting differential expression results. This thought experiment tests your fundamental understanding of what these plots represent by simulating a common and costly data-handling error [@problem_id:2417787]. Predicting how a simple sample label swap would alter these key plots will sharpen your analytical intuition and enhance your ability to perform crucial sanity checks on your own results.", "problem": "You perform a Ribonucleic Acid sequencing (RNA-seq) experiment with control and treatment samples. After quality control, normalization, and standard differential expression modeling, you generate a Principal Component Analysis (PCA) plot for exploratory assessment and an M-versus-A (MA) plot for the differential expression results. Later you discover that you accidentally swapped the sample labels of control and treatment at the outset of the analysis pipeline. Assume that there are no batch effects or confounders, and that sequencing depth and normalization are appropriate so that the primary biological difference between the two groups dominates the major source of variation. Which statement best describes what you would expect to see in the PCA plot and the MA plot under this mistake?\n\nA. The PCA plot would still show a clear separation of samples into two clusters, but the annotations would indicate that the cluster believed to be “control” actually corresponds to the true “treatment” group and vice versa; the MA plot would appear as a mirror image across the horizontal axis, with genes that are truly up-regulated in treatment now appearing down-regulated with similar magnitude, and vice versa.\n\nB. The PCA plot would show no separation between the two annotated groups because the label swap breaks clustering, while the MA plot would remain unchanged because it is based on average expression rather than labels.\n\nC. The PCA plot would retain its clustering structure but the axes would interchange their order, while the MA plot would show increased scatter around the center yet preserve the original direction of fold changes.\n\nD. The PCA plot would invert the sign of the leading component due to the label swap, and the MA plot would be shifted upward by a constant offset without changing which genes are above or below the center.", "solution": "This problem tests the understanding of how sample label errors affect common RNA-seq visualizations. We analyze the impact on the PCA plot and the MA plot separately.\n\n**1. Principal Component Analysis (PCA) Plot**\nPCA is an unsupervised dimensionality reduction method. It identifies the directions of maximum variance within the gene expression data matrix itself, without using any sample labels (like 'control' or 'treatment'). Therefore, swapping the labels has **no effect** on the positions of the data points in the PCA plot. The geometric clustering of samples is determined solely by their expression profiles. If the 'control' and 'treatment' samples form two distinct clusters, they will still form the same two clusters. The only change is that the labels assigned to these clusters in the plot's legend will be swapped. The cluster of points corresponding to the true treatment samples will be incorrectly labeled 'control', and vice versa.\n\n**2. M-versus-A (MA) Plot**\nAn MA plot visualizes differential expression results. For each gene, it plots two quantities:\n*   **M-value (y-axis):** $M = \\log_2\\left(\\frac{\\text{mean expression in treatment group}}{\\text{mean expression in control group}}\\right)$\n*   **A-value (x-axis):** $A = \\frac{1}{2} \\log_2(\\text{mean expression in treatment group} \\times \\text{mean expression in control group})$\n\nWhen the labels are swapped, the analysis pipeline computes these values using the wrong groups. Let's denote the true mean expressions as $\\bar{E}_{\\text{treat}}$ and $\\bar{E}_{\\text{control}}$.\n*   The A-value calculated under the mistake becomes:\n    $$A_{\\text{mistake}} = \\frac{1}{2} \\log_2(\\bar{E}_{\\text{control}} \\times \\bar{E}_{\\text{treat}}) = A_{\\text{correct}}$$\n    The A-value is unchanged because multiplication is commutative.\n*   The M-value calculated under the mistake becomes:\n    $$M_{\\text{mistake}} = \\log_2\\left(\\frac{\\bar{E}_{\\text{control}}}{\\bar{E}_{\\text{treat}}}\\right) = - \\log_2\\left(\\frac{\\bar{E}_{\\text{treat}}}{\\bar{E}_{\\text{control}}}\\right) = -M_{\\text{correct}}$$\n    The M-value is inverted in sign.\n\nGeometrically, this means every point in the MA plot is reflected across the horizontal axis ($M=0$). Genes that were truly up-regulated ($M > 0$) will appear down-regulated ($M  0$), and vice-versa.\n\nCombining these two observations, the correct description is given in option A. The PCA clustering is unchanged but mislabeled, and the MA plot is inverted vertically.", "answer": "$$\\boxed{A}$$", "id": "2417787"}]}