{"hands_on_practices": [{"introduction": "Over-Representation Analysis (ORA) is built upon the hypergeometric test, a statistical tool for sampling without replacement. This exercise moves beyond theory and into the quantitative details, challenging you to calculate how the choice of the background gene 'universe' impacts the resulting $p$-value. By working through this hypothetical scenario [@problem_id:2412461], you will gain a crucial, hands-on understanding of how analytical parameters directly influence the apparent significance of a pathway.", "problem": "In a pathway enrichment analysis based on a targeted gene panel, a researcher considers a gene universe of size $N$ and evaluates enrichment of a specific pathway that contains $M$ genes present in this universe. A list of differentially expressed genes (DEGs) of size $n$ is obtained from an experiment, and the observed overlap between the DEG list and the pathway is $k$. The one-sided enrichment $p$-value is defined as the right-tail probability $\\Pr(X \\geq k)$ where $X$ is the number of pathway genes observed in a sample of size $n$ drawn without replacement from the universe of size $N$.\n\nSuppose initially the universe size is $N_{1} = $ $20$, the pathway contains $M = $ $6$ genes, the DEG list size is $n = $ $5$, and the observed overlap is $k = $ $3$. Now the universe is doubled to $N_{2} = $ $40$ by adding genes that are not members of the pathway, while $M = $ $6$, $n = $ $5$, and $k = $ $3$ remain unchanged.\n\nLet $p_{1}$ denote the enrichment $p$-value at $N = N_{1}$ and $p_{2}$ denote the enrichment $p$-value at $N = N_{2}$. Compute the exact ratio $r = \\dfrac{p_{2}}{p_{1}}$ and express your final answer as a single reduced fraction. Do not round.", "solution": "The problem requires the calculation of a ratio of two enrichment $p$-values. The enrichment test is based on sampling without replacement, which is correctly modeled by the hypergeometric distribution. Let $N$ be the total number of genes in the universe, $M$ be the number of genes in the pathway (successes in population), $n$ be the size of the sample drawn (the DEG list), and $i$ be the number of genes from the pathway found in the sample (successes in sample). The probability mass function (PMF) for observing exactly $i$ successful draws is given by:\n$$P(X=i) = \\frac{\\binom{M}{i} \\binom{N-M}{n-i}}{\\binom{N}{n}}$$\nThe one-sided enrichment $p$-value is defined as the right-tail probability $P(X \\ge k)$, where $k$ is the observed number of pathway genes in the sample. This is calculated as:\n$$p = P(X \\ge k) = \\sum_{i=k}^{\\min(n,M)} P(X=i) = \\sum_{i=k}^{\\min(n,M)} \\frac{\\binom{M}{i} \\binom{N-M}{n-i}}{\\binom{N}{n}}$$\n\nFirst, we calculate the $p$-value for the initial condition, $p_1$.\nThe parameters are $N_1 = 20$, $M = 6$, $n = 5$, and $k = 3$. The maximum possible overlap is $\\min(n, M) = \\min(5, 6) = 5$.\n$$p_1 = P(X_1 \\ge 3) = P(X_1=3) + P(X_1=4) + P(X_1=5)$$\nUsing the PMF, we express $p_1$ as:\n$$p_1 = \\frac{\\binom{6}{3}\\binom{20-6}{5-3}}{\\binom{20}{5}} + \\frac{\\binom{6}{4}\\binom{20-6}{5-4}}{\\binom{20}{5}} + \\frac{\\binom{6}{5}\\binom{20-6}{5-5}}{\\binom{20}{5}}$$\n$$p_1 = \\frac{1}{\\binom{20}{5}} \\left[ \\binom{6}{3}\\binom{14}{2} + \\binom{6}{4}\\binom{14}{1} + \\binom{6}{5}\\binom{14}{0} \\right]$$\nWe compute the binomial coefficients:\n$\\binom{6}{3} = \\frac{6 \\cdot 5 \\cdot 4}{3 \\cdot 2 \\cdot 1} = 20$\n$\\binom{6}{4} = \\binom{6}{2} = \\frac{6 \\cdot 5}{2 \\cdot 1} = 15$\n$\\binom{6}{5} = \\binom{6}{1} = 6$\n$\\binom{14}{2} = \\frac{14 \\cdot 13}{2 \\cdot 1} = 91$\n$\\binom{14}{1} = 14$\n$\\binom{14}{0} = 1$\n$\\binom{20}{5} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16}{5 \\cdot 4 \\cdot 3 \\cdot 2 \\cdot 1} = 15504$\nSubstituting these values, we find the numerator for $p_1$:\n$$ \\text{Numerator}_1 = (20)(91) + (15)(14) + (6)(1) = 1820 + 210 + 6 = 2036 $$\nSo, $p_1 = \\frac{2036}{15504}$.\n\nNext, we calculate the $p$-value for the second condition, $p_2$.\nThe parameters are $N_2 = 40$, $M = 6$, $n = 5$, and $k = 3$. The number of genes not in the pathway is $N_2 - M = 40 - 6 = 34$.\n$$p_2 = P(X_2 \\ge 3) = P(X_2=3) + P(X_2=4) + P(X_2=5)$$\n$$p_2 = \\frac{1}{\\binom{40}{5}} \\left[ \\binom{6}{3}\\binom{34}{2} + \\binom{6}{4}\\binom{34}{1} + \\binom{6}{5}\\binom{34}{0} \\right]$$\nWe compute the required binomial coefficients:\nThe coefficients for $M$ are the same: $\\binom{6}{3}=20$, $\\binom{6}{4}=15$, $\\binom{6}{5}=6$.\n$\\binom{34}{2} = \\frac{34 \\cdot 33}{2 \\cdot 1} = 17 \\cdot 33 = 561$\n$\\binom{34}{1} = 34$\n$\\binom{34}{0} = 1$\n$\\binom{40}{5} = \\frac{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36}{5 \\cdot 4 \\cdot 3 \\cdot 2 \\cdot 1} = 658008$\nSubstituting these values, we find the numerator for $p_2$:\n$$ \\text{Numerator}_2 = (20)(561) + (15)(34) + (6)(1) = 11220 + 510 + 6 = 11736 $$\nSo, $p_2 = \\frac{11736}{658008}$.\n\nFinally, we compute the ratio $r = \\frac{p_2}{p_1}$:\n$$r = \\frac{p_2}{p_1} = \\frac{11736/658008}{2036/15504} = \\frac{11736}{2036} \\times \\frac{15504}{658008}$$\nWe simplify each fraction separately.\nFor the first fraction:\n$$\\frac{11736}{2036} = \\frac{4 \\times 2934}{4 \\times 509} = \\frac{2934}{509}$$\nThe number $509$ is prime.\nFor the second fraction:\n$$\\frac{15504}{658008} = \\frac{\\binom{20}{5}}{\\binom{40}{5}} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16 / 5!}{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36 / 5!} = \\frac{20 \\cdot 19 \\cdot 18 \\cdot 17 \\cdot 16}{40 \\cdot 39 \\cdot 38 \\cdot 37 \\cdot 36}$$\nWe simplify this expression by pairing terms:\n$$ \\frac{20}{40} \\cdot \\frac{18}{36} \\cdot \\frac{19}{38} \\cdot \\frac{16 \\cdot 17}{39 \\cdot 37} = \\left(\\frac{1}{2}\\right) \\cdot \\left(\\frac{1}{2}\\right) \\cdot \\left(\\frac{1}{2}\\right) \\cdot \\frac{16 \\cdot 17}{39 \\cdot 37} = \\frac{1}{8} \\cdot \\frac{272}{1443} = \\frac{34}{1443} $$\nNow we multiply the simplified fractions to find $r$:\n$$r = \\frac{2934}{509} \\times \\frac{34}{1443}$$\nTo simplify this product, we find the prime factorizations of the numerators and denominators.\n$2934 = 2 \\times 3^2 \\times 163$.\n$34 = 2 \\times 17$.\n$509$ is prime.\n$1443 = 3 \\times 13 \\times 37$.\nNow, substitute these factorizations into the expression for $r$:\n$$r = \\frac{2 \\times 3^2 \\times 163}{509} \\times \\frac{2 \\times 17}{3 \\times 13 \\times 37}$$\nCancel one factor of $3$:\n$$r = \\frac{2 \\times 3 \\times 163}{509} \\times \\frac{2 \\times 17}{13 \\times 37} = \\frac{12 \\times 17 \\times 163}{509 \\times 13 \\times 37}$$\nThe remaining factors in the numerator are $2$, $3$, $17$, $163$. The factors in the denominator are $13$, $37$, $509$. All are prime, and there are no common factors between the numerator and denominator. Thus, the fraction is in its reduced form. We compute the final products.\nNumerator: $12 \\times 17 \\times 163 = 204 \\times 163 = 33252$.\nDenominator: $509 \\times 13 \\times 37 = 509 \\times 481 = 244829$.\nThe exact ratio is:\n$$r = \\frac{33252}{244829}$$", "answer": "$$\\boxed{\\frac{33252}{244829}}$$", "id": "2412461"}, {"introduction": "While Over-Representation Analysis is a powerful tool, its statistical validity can be compromised when applied to very small gene lists, a common outcome of stringent experimental filtering. This practice [@problem_id:2412466] explores the critical statistical pitfalls—such as diminished power, result instability, and sensitivity to single 'hub' genes—that arise in this scenario. Mastering these concepts is essential for critically evaluating the reliability of enrichment results and avoiding common interpretation errors.", "problem": "A researcher performs an over-representation pathway enrichment analysis on a list of only $10$ differentially expressed genes (DEGs) using a background of all expressed genes in the experiment. Over-representation analysis models the overlap count $k$ between the query list of size $n$ and a pathway of size $K$ drawn from a background of size $M$ under a sampling-without-replacement null. The analysis reports nominal $p$-values for many pathways and then applies a multiple-hypothesis correction such as the Benjamini–Hochberg procedure for False Discovery Rate (FDR) control. Which of the following statements correctly describe risks or drawbacks that arise specifically because the query list is very small (e.g., $n = 10$)? Select all that apply.\n\nA. With $n$ very small, the possible overlap counts $k$ are few, so $p$-values are highly discrete and can change abruptly when a single gene is added or removed. This discreteness and low counts inflate the variance of effect size estimates (e.g., odds ratios) and can lead to unstable significance calls.\n\nB. Using a very small list reduces the number of pathway hypotheses tested, thereby decreasing the multiple-testing burden and making FDR estimates more reliable.\n\nC. A very small list eliminates annotation biases (such as gene length bias and pathway size effects), because fewer genes means less bias from gene set databases.\n\nD. Results become highly sensitive to the presence of multifunctional or hub genes that appear in many pathways; a single such gene in the list can drive apparent enrichment across numerous pathways.\n\nE. Power to detect true enrichments increases with a smaller list because the signal is concentrated among fewer genes, so true pathways are more likely to pass significance thresholds.\n\nF. With very small $n$, the $2 \\times 2$ contingency tables used to compute enrichment statistics often contain zero or near-zero counts, making odds ratios and their confidence intervals unreliable without ad hoc small-sample corrections, and contributing to unstable inferences.", "solution": "The statistical basis for the described over-representation analysis is the hypergeometric test. The probability of observing exactly $k$ genes from a pathway of size $K$ in a randomly drawn list of $n$ genes from a universe of $M$ genes is given by the probability mass function:\n$$P(X=k) = \\frac{\\binom{K}{k} \\binom{M-K}{n-k}}{\\binom{M}{n}}$$\nThe $p$-value for enrichment is the probability of observing an overlap of $k$ or more, calculated as a right-sided tail probability:\n$$p = \\sum_{i=k}^{\\min(n,K)} P(X=i)$$\nWe analyze the consequences of a very small $n$, specifically $n=10$.\n\n**Option A: With $n$ very small, the possible overlap counts $k$ are few, so $p$-values are highly discrete and can change abruptly when a single gene is added or removed. This discreteness and low counts inflate the variance of effect size estimates (e.g., odds ratios) and can lead to unstable significance calls.**\n\nThis statement is correct. When $n=10$, the number of possible overlaps, $k$, is an integer in $[0, 10]$. This small set of possible outcomes leads to a highly discrete set of possible $p$-values. For any given pathway, there are at most $n+1 = 11$ distinct one-sided $p$-values that can be obtained. A single gene change in the query list can alter $k$ by $1$, potentially causing a large jump in the $p$-value (e.g., from non-significant to significant, or vice-versa), leading to instability. Furthermore, small counts in the associated $2 \\times 2$ contingency table ($k$ and $n-k$ are small) cause the variance of the log odds ratio, which is approximately the sum of the reciprocal of cell counts, to be very large. This makes the effect size estimate unreliable.\nVerdict: **Correct**.\n\n**Option B: Using a very small list reduces the number of pathway hypotheses tested, thereby decreasing the multiple-testing burden and making FDR estimates more reliable.**\n\nThis statement is incorrect. The number of hypotheses tested is determined by the number of pathways in the annotation database (e.g., Gene Ontology terms, KEGG pathways), not by the size of the input gene list, $n$. Whether one tests a list of $10$ genes or $1000$ genes against the KEGG database, the number of pathways—and thus the number of tests—remains the same. The multiple-testing burden is therefore unchanged. The high discreteness of $p$-values resulting from small $n$ can actually complicate and reduce the reliability of certain FDR estimation procedures.\nVerdict: **Incorrect**.\n\n**Option C: A very small list eliminates annotation biases (such as gene length bias and pathway size effects), because fewer genes means less bias from gene set databases.**\n\nThis statement is incorrect. Annotation biases, such as the fact that longer genes are more likely to be identified as differentially expressed, are systematic properties related to the genes themselves and the experimental technology. Using a small gene list does not eliminate these biases. On the contrary, if the small list is not a representative sample (which is highly likely), such biases can be amplified, leading to misleading results. The problem of bias is not solved by reducing the amount of data; in most cases, it is made worse.\nVerdict: **Incorrect**.\n\n**Option D: Results become highly sensitive to the presence of multifunctional or hub genes that appear in many pathways; a single such gene in the list can drive apparent enrichment across numerous pathways.**\n\nThis statement is correct. A hub gene, by definition, is a member of many pathways. If such a gene is present in a small list of $n=10$ genes, it constitutes $10\\%$ of the query list. This single gene will contribute an overlap count of $1$ to every pathway it belongs to. This can create a signal of enrichment across a large number of, perhaps functionally unrelated, pathways. The result is then driven by the properties of this one gene rather than a coordinated biological response. This effect is magnified when $n$ is small because each individual gene represents a larger fraction of the whole list.\nVerdict: **Correct**.\n\n**Option E: Power to detect true enrichments increases with a smaller list because the signal is concentrated among fewer genes, so true pathways are more likely to pass significance thresholds.**\n\nThis statement is incorrect. Statistical power is the probability of correctly rejecting a false null hypothesis. In virtually all statistical contexts, power increases with sample size. In ORA, the query list size $n$ is analogous to a sample size. Using a small list, which is often the result of applying an overly stringent significance threshold to identify DEGs, means discarding potentially valuable information from moderately significant genes. This loss of information leads to a substantial *decrease* in statistical power. One is less likely, not more likely, to detect true, but subtle, enrichments with a tiny list of genes.\nVerdict: **Incorrect**.\n\n**Option F: With very small $n$, the $2 \\times 2$ contingency tables used to compute enrichment statistics often contain zero or near-zero counts, making odds ratios and their confidence intervals unreliable without ad hoc small-sample corrections, and contributing to unstable inferences.**\n\nThis statement is correct. The $2 \\times 2$ contingency table for ORA has cells with counts $k$, $n-k$, $K-k$, and $M-K-n+k$. With $n=10$, the counts $k$ and $n-k$ are guaranteed to be small. For many pathways, the overlap $k$ may be $0$ or $1$. The odds ratio, $OR = \\frac{k / (n-k)}{(K-k) / (M-K-n+k)}$, becomes $0$ if $k=0$ or infinite if $n-k=0$. The variance of the logarithm of the odds ratio is estimated by $\\frac{1}{k} + \\frac{1}{n-k} + \\frac{1}{K-k} + \\frac{1}{M-K-n+k}$. Small integer counts in the numerator cells ($k$, $n-k$) make this variance estimator explode, rendering the odds ratio and its confidence interval extremely unstable and untrustworthy. This contributes directly to unstable inferences about the magnitude of enrichment.\nVerdict: **Correct**.", "answer": "$$\\boxed{ADF}$$", "id": "2412466"}, {"introduction": "Pathway analysis is not a one-size-fits-all problem; different methods can yield different answers from the same dataset. This exercise [@problem_id:2412467] presents a common and important conundrum: Gene Set Enrichment Analysis (GSEA) reports a significant pathway that Over-Representation Analysis (ORA) misses. By dissecting this apparent contradiction, you will learn to appreciate the fundamental power of threshold-free methods like GSEA to detect subtle, coordinated biological signals that are invisible to threshold-based approaches.", "problem": "You analyze an RNA-sequencing experiment comparing two phenotypes and obtain a ranked list of all genes by a signed differential expression statistic. Gene Set Enrichment Analysis (GSEA) on the full ranked list reports the gene set labeled \"Immune Response\" as significantly enriched at a False Discovery Rate (FDR) below $0.05$. Separately, you perform Over-Representation Analysis (ORA) using a hypergeometric framework on the top $200$ differentially expressed genes (DEGs) defined at FDR below $0.05$, and for this analysis the \"Immune Response\" gene set is not significant. Which of the following is the most likely biological interpretation of these findings? Here, Gene Set Enrichment Analysis (GSEA), Over-Representation Analysis (ORA), and differentially expressed genes (DEGs) are defined in their standard bioinformatics usage.\n\nA. Many immune response genes exhibit small, coordinated shifts that are consistent in direction but too modest to cross the individual DEG threshold, producing a distributional shift detectable by GSEA while yielding insufficient overlap among the top $200$ DEGs for ORA.\n\nB. The immune response pathway is entirely inactive in all samples; the GSEA result arises solely from gene set size bias and should be disregarded.\n\nC. Over-Representation Analysis is inherently more sensitive than Gene Set Enrichment Analysis; therefore the lack of ORA significance demonstrates there is no true immune involvement.\n\nD. The discordance necessarily indicates a severe batch effect affecting housekeeping genes, which is the only plausible explanation for a significant GSEA result without a matching ORA signal.\n\nE. The immune response signal is driven exclusively by a few extremely strong differentially expressed genes, which ORA would tend to miss but GSEA would detect.", "solution": "The core of this problem lies in understanding the fundamental methodological differences between Over-Representation Analysis (ORA) and Gene Set Enrichment Analysis (GSEA).\n\nFirst, let us define the principles of each method.\nOver-Representation Analysis (ORA) is a threshold-dependent method. It begins by partitioning the entire set of measured genes into two groups: a small list of \"interesting\" genes (in this case, the top $200$ differentially expressed genes, or DEGs) and all other genes. This partitioning is based on a somewhat arbitrary significance threshold (here, a rank cutoff combined with an FDR threshold of $0.05$). ORA then uses a statistical test, typically the hypergeometric test or Fisher's exact test, to determine if a predefined gene set (e.g., \"Immune Response\") is statistically over-represented in the list of \"interesting\" genes compared to the background of all genes. The critical weakness of ORA is the information loss it incurs: all quantitative information about genes that do not pass the stringent threshold is discarded. Genes with modest but biologically relevant changes are treated identically to genes with no change at all.\n\nGene Set Enrichment Analysis (GSEA), in contrast, is a threshold-free method. It does not begin with an arbitrary cutoff to select a small list of DEGs. Instead, it considers all genes measured in the experiment, ranked according to a differential expression metric (e.g., signal-to-noise ratio, log-fold change). The method walks down the ranked list of genes and calculates a running-sum statistic, which increases when a gene from the set of interest is encountered and decreases when a gene not in the set is encountered. The maximum deviation of this running sum from zero is the Enrichment Score (ES). This ES reflects the degree to which a gene set is over-represented at the extremes (top or bottom) of the entire ranked list. The statistical significance of the ES is assessed using permutation testing, which generates a null distribution by shuffling the gene labels or sample labels, followed by correction for multiple testing (FDR). The primary strength of GSEA is its ability to detect subtle, coordinated changes in the expression of many genes within a pathway, even if none of those individual genes demonstrates a change sufficient to pass a strict DEG cutoff.\n\nNow, we analyze the specific results presented. GSEA finds the \"Immune Response\" gene set to be significant (FDR $ 0.05$), while ORA does not.\nThe significant GSEA result indicates that genes belonging to the \"Immune Response\" set are not randomly distributed throughout the ranked list. They are, as a group, enriched towards one end of the list, implying a coordinated, directional shift (e.g., mild but consistent upregulation) across the phenotype comparison.\nThe non-significant ORA result indicates that when we consider only the most extremely perturbed $200$ genes, the number of \"Immune Response\" genes found in this short list is not statistically surprising.\n\nThe most logical synthesis of these two findings is that the \"Immune Response\" pathway is indeed transcriptionally perturbed, but this perturbation manifests as a subtle, widespread, and coordinated shift in the expression of many genes in the set. The magnitude of these individual changes is too modest for most of these genes to qualify for inclusion in the top $200$ DEGs. GSEA, by integrating these small effects across the entire gene set, correctly identifies the significant biological signal. ORA, by focusing only on the \"tip of the iceberg\" (the top $200$ DEGs), fails to see the broader pattern and therefore incorrectly concludes there is no significant enrichment.\n\nWith this foundation, we evaluate each option:\n\nA. Many immune response genes exhibit small, coordinated shifts that are consistent in direction but too modest to cross the individual DEG threshold, producing a distributional shift detectable by GSEA while yielding insufficient overlap among the top $200$ DEGs for ORA.\nThis statement accurately describes the exact scenario for which GSEA was designed and where it excels in sensitivity over ORA. It perfectly reconciles the two seemingly contradictory results based on the fundamental principles of the methods.\nVerdict: **Correct**.\n\nB. The immune response pathway is entirely inactive in all samples; the GSEA result arises solely from gene set size bias and should be disregarded.\nThis is an unsound assertion. A significant GSEA result, especially with an FDR corrected by permutation testing below $0.05$, is strong evidence *against* the pathway being inactive. While gene set size can be a confounding factor, standard GSEA implementations include normalization steps to account for it. To dismiss a statistically significant finding as a mere artifact without further evidence is poor scientific practice. The statement that the pathway is \"entirely inactive\" is an extreme claim that is contradicted by the GSEA result.\nVerdict: **Incorrect**.\n\nC. Over-Representation Analysis is inherently more sensitive than Gene Set Enrichment Analysis; therefore the lack of ORA significance demonstrates there is no true immune involvement.\nThis premise is factually incorrect. The bioinformatics literature and community widely acknowledge that GSEA and similar threshold-free methods are generally *more* sensitive than ORA, precisely because they avoid arbitrary cutoffs and can detect subtle, cumulative effects. The logic of the option is based on a false premise.\nVerdict: **Incorrect**.\n\nD. The discordance necessarily indicates a severe batch effect affecting housekeeping genes, which is the only plausible explanation for a significant GSEA result without a matching ORA signal.\nThis is an overly strong and unsubstantiated claim. A batch effect is a potential issue in any high-throughput experiment, but it is far from the \"only plausible explanation.\" The methodological difference between GSEA and ORA provides a much more direct and parsimonious explanation for the observed results. There is no basis to \"necessarily\" conclude a batch effect is the cause, nor is there any information to specifically implicate housekeeping genes.\nVerdict: **Incorrect**.\n\nE. The immune response signal is driven exclusively by a few extremely strong differentially expressed genes, which ORA would tend to miss but GSEA would detect.\nThis statement demonstrates a misunderstanding of ORA. If the signal were driven by a few extremely strong DEGs, those genes would, by definition, be at the very top of the ranked list and would be included in the top $200$ DEGs used for the ORA. In such a scenario, ORA would be *highly likely* to return a significant result. This situation would lead to both GSEA and ORA being significant, which contradicts the problem statement that ORA was not significant.\nVerdict: **Incorrect**.\n\nIn summary, the discrepancy between GSEA and ORA results is a classic illustration of their respective strengths and weaknesses. Option A provides the only correct and mechanistically sound interpretation.", "answer": "$$\\boxed{A}$$", "id": "2412467"}]}