{"hands_on_practices": [{"introduction": "Partial charges are a cornerstone of classical force fields, yet they are not directly measurable quantum observables. We must therefore derive them by fitting our model to reproduce known physical properties. This first practice exercise [@problem_id:2452401] guides you through a fundamental parameterization task: creating a three-point charge model for a carbon dioxide molecule that correctly reproduces its experimentally measured electric quadrupole moment. This provides crucial insight into how the electrostatic potential of an overall neutral molecule is captured.", "problem": "In fixed-charge force fields such as Assisted Model Building with Energy Refinement (AMBER), Chemistry at Harvard Macromolecular Mechanics (CHARMM), Optimized Potentials for Liquid Simulations (OPLS), and Groningen Molecular Simulation (GROMOS), partial atomic charges are often chosen to reproduce low-order molecular multipole moments. Consider a linear carbon dioxide molecule aligned along the $z$-axis with the carbon atom at the origin and the two oxygen atoms at positions $z=\\pm \\ell$, where $\\ell = 1.160\\,\\text{\\AA}$. Model the molecule using three point charges: a carbon charge $q_{C}$ at $z=0$ and identical oxygen charges $q_{O}$ at $z=\\pm \\ell$. Impose overall charge neutrality.\n\nUse the traceless electric quadrupole tensor definition for point charges,\n$$Q_{\\alpha\\beta}=\\sum_{i} q_{i}\\left(3 r_{i,\\alpha} r_{i,\\beta} - r_{i}^{2}\\delta_{\\alpha\\beta}\\right),$$\nand the experimental axial component for carbon dioxide,\n$$Q_{zz} = -4.30\\,\\text{D}\\cdot\\text{\\AA},$$\nto determine the oxygen and carbon partial charges, $q_{O}$ and $q_{C}$, that reproduce $Q_{zz}$ for this geometry.\n\nExpress $q_{O}$ and $q_{C}$ in units of the elementary charge $e$. Use the following constants:\n- $1\\,\\text{Debye} = 3.33564\\times 10^{-30}\\,\\text{C}\\cdot\\text{m}$,\n- $1\\,\\text{\\AA} = 1.0\\times 10^{-10}\\,\\text{m}$,\n- $e = 1.602176634\\times 10^{-19}\\,\\text{C}$.\n\nRound each partial charge to four significant figures. Provide your final answer as a row matrix $\\big(q_{O}\\ \\ q_{C}\\big)$ in units of $e$.", "solution": "The problem statement is evaluated as scientifically grounded, well-posed, objective, and self-contained. It presents a standard problem in computational chemistry: the parameterization of atomic partial charges to reproduce an experimentally known electrostatic property. All required data and definitions are provided, and no contradictions or ambiguities are detected. Therefore, the problem is valid and a solution will be provided.\n\nThe objective is to determine the partial atomic charges, $q_C$ and $q_O$, for a linear model of carbon dioxide. The carbon atom is at the origin ($z=0$), and two oxygen atoms are at $z=+\\ell$ and $z=-\\ell$, with $\\ell = 1.160\\,\\text{\\AA}$.\n\nThe first constraint is that the molecule must have no net charge (overall charge neutrality). The sum of the charges must be zero:\n$$q_C + q_O + q_O = 0$$\nwhich simplifies to:\n$$q_C + 2q_O = 0 \\quad \\implies \\quad q_C = -2q_O$$\n\nThe second constraint is that the model must reproduce the experimental axial component of the traceless electric quadrupole tensor, $Q_{zz} = -4.30\\,\\text{D}\\cdot\\text{\\AA}$. The problem provides the definition for this tensor:\n$$Q_{\\alpha\\beta}=\\sum_{i} q_{i}\\left(3 r_{i,\\alpha} r_{i,\\beta} - r_{i}^{2}\\delta_{\\alpha\\beta}\\right)$$\nFor the $zz$-component, $\\alpha=z$ and $\\beta=z$, so $\\delta_{\\alpha\\beta} = \\delta_{zz} = 1$. The expression becomes:\n$$Q_{zz} = \\sum_{i} q_{i}\\left(3 z_i^2 - r_i^2\\right)$$\nwhere $z_i$ is the $z$-coordinate of charge $q_i$ and $r_i$ is its distance from the origin.\n\nWe now sum the contributions from the three point charges in the model:\n1. Carbon atom (C): Located at the origin, its position vector is $\\vec{r}_C = (0, 0, 0)$. Thus, $z_C=0$ and $r_C^2 = 0$. Its contribution to $Q_{zz}$ is $q_C(3 \\cdot 0^2 - 0^2) = 0$.\n2. First oxygen atom ($O_1$): Located at $z=+\\ell$, its position vector is $\\vec{r}_{O1} = (0, 0, \\ell)$. Thus, $z_{O1}=\\ell$ and $r_{O1}^2 = \\ell^2$. Its contribution is $q_O(3\\ell^2 - \\ell^2) = 2q_O\\ell^2$.\n3. Second oxygen atom ($O_2$): Located at $z=-\\ell$, its position vector is $\\vec{r}_{O2} = (0, 0, -\\ell)$. Thus, $z_{O2}=-\\ell$ and $r_{O2}^2 = \\ell^2$. Its contribution is $q_O(3(-\\ell)^2 - \\ell^2) = q_O(3\\ell^2 - \\ell^2) = 2q_O\\ell^2$.\n\nThe total $Q_{zz}$ is the sum of these contributions:\n$$Q_{zz} = 0 + 2q_O\\ell^2 + 2q_O\\ell^2 = 4q_O\\ell^2$$\nFrom this expression, we can solve for the oxygen charge $q_O$:\n$$q_O = \\frac{Q_{zz}}{4\\ell^2}$$\n\nNow, we perform the numerical calculation. The given values are $Q_{zz} = -4.30\\,\\text{D}\\cdot\\text{\\AA}$ and $\\ell = 1.160\\,\\text{\\AA}$. To ensure dimensional consistency, we convert all quantities to SI units.\nThe constants are:\n$1\\,\\text{D} = 3.33564 \\times 10^{-30}\\,\\text{C}\\cdot\\text{m}$\n$1\\,\\text{\\AA} = 1.0 \\times 10^{-10}\\,\\text{m}$\n$e = 1.602176634 \\times 10^{-19}\\,\\text{C}$\n\nFirst, convert $Q_{zz}$ to $\\text{C}\\cdot\\text{m}^2$:\n$$Q_{zz} = -4.30 \\, (\\text{D}\\cdot\\text{\\AA}) = -4.30 \\times (3.33564 \\times 10^{-30}\\,\\text{C}\\cdot\\text{m}) \\times (1.0 \\times 10^{-10}\\,\\text{m})$$\n$$Q_{zz} = -1.4343252 \\times 10^{-39}\\,\\text{C}\\cdot\\text{m}^2$$\nNext, convert $\\ell$ to meters:\n$$\\ell = 1.160\\,\\text{\\AA} = 1.160 \\times 10^{-10}\\,\\text{m}$$\nNow, we can calculate $q_O$ in Coulombs:\n$$q_O = \\frac{-1.4343252 \\times 10^{-39}\\,\\text{C}\\cdot\\text{m}^2}{4 \\times (1.160 \\times 10^{-10}\\,\\text{m})^2} = \\frac{-1.4343252 \\times 10^{-39}}{4 \\times 1.3456 \\times 10^{-20}}\\,\\text{C}$$\n$$q_O = \\frac{-1.4343252 \\times 10^{-39}}{5.3824 \\times 10^{-20}}\\,\\text{C} \\approx -2.66490 \\times 10^{-20}\\,\\text{C}$$\nThe problem asks for the charges in units of the elementary charge $e$. We divide $q_O$ by $e$:\n$$\\frac{q_O}{e} = \\frac{-2.66490 \\times 10^{-20}\\,\\text{C}}{1.602176634 \\times 10^{-19}\\,\\text{C}/e} = -0.166331\\dots$$\nRounding to four significant figures gives:\n$$q_O \\approx -0.1663\\,e$$\nUsing the charge neutrality condition, we find the charge on the carbon atom, $q_C$:\n$$q_C = -2q_O$$\nIn units of $e$:\n$$\\frac{q_C}{e} = -2\\left(\\frac{q_O}{e}\\right) = -2 \\times (-0.166331\\dots) = 0.332662\\dots$$\nRounding to four significant figures gives:\n$$q_C \\approx 0.3327\\,e$$\nThe partial charges that reproduce the given quadrupole moment under the specified model are $q_O = -0.1663\\,e$ and $q_C = 0.3327\\,e$.", "answer": "$$\\boxed{\\begin{pmatrix} -0.1663 & 0.3327 \\end{pmatrix}}$$", "id": "2452401"}, {"introduction": "Force fields differ in their parameters and functional forms, leading to varying predictions for the same chemical system. This exercise [@problem_id:2452387] provides a hands-on opportunity to dissect and compare how simplified models of popular force fields—AMBER, CHARMM, and GROMOS—tackle a subtle stereochemical problem, the anomeric effect. By calculating the total energy from its constituent parts—torsional, Lennard–Jones, and Coulombic—you will develop a deeper appreciation for how these energy terms balance to determine conformational stability.", "problem": "You are asked to construct and evaluate a minimal, classical molecular mechanics model for the anomeric preference at the anomeric center of a glucopyranose ring. The objective is to compare three parameterizations that emulate Assisted Model Building with Energy Refinement (AMBER), Chemistry at Harvard Macromolecular Mechanics (CHARMM), and Groningen Molecular Simulation (GROMOS), and to compute the energy difference between equatorial and axial anomer conformations to assess which parameterization predicts a lower energy for the equatorial or axial arrangement. Work entirely within a simplified, pairwise-additive potential with a single dihedral torsion about the anomeric bond and three nonbonded pairs that represent the dominant local contacts between the exocyclic substituent and the ring environment.\n\nUse only the following fundamental base and assumptions:\n\n- Classical mechanics and the potential energy description: for a fixed geometry, the relative stability of two conformations is determined by their potential energies. Denote the axial and equatorial dihedral conformations as $\\phi_{\\mathrm{ax}}$ and $\\phi_{\\mathrm{eq}}$.\n- The total potential energy is a sum of a single dihedral torsion term and pairwise nonbonded terms between the substituent site $X$ and three ring sites $R_1$, $R_2$, and $R_3$. The dihedral torsion is represented by a single cosine Fourier term of periodicity $n$ and phase $\\delta$. The nonbonded interaction for each pair is the sum of a Lennard–Jones $12$–$6$ term and a Coulomb term.\n- The Lennard–Jones pair interaction for a given pair with parameters $(\\varepsilon_{ij},\\sigma_{ij})$ at separation $r$ uses the standard $12$–$6$ form. The Coulomb interaction at separation $r$ between partial charges $q_i$ and $q_j$ uses the Coulomb constant $k_c$ appropriate to energies in kilojoules per mole and distances in nanometers.\n\nYou must compute the energy difference\n$$\n\\Delta E \\equiv E_{\\mathrm{eq}} - E_{\\mathrm{ax}}\n$$\nin kilojoules per mole for each parameterization below, using the following fixed geometry and constants:\n\n- Coulomb constant: $k_c = 138.935458$ $\\mathrm{kJ\\ mol^{-1}\\ nm\\ e^{-2}}$.\n- Dihedral angles (express all angles in degrees; when evaluating trigonometric functions, convert degrees to radians): $\\phi_{\\mathrm{ax}} = 60^\\circ$, $\\phi_{\\mathrm{eq}} = 180^\\circ$.\n- For each nonbonded pair $(X,R_k)$, use the two fixed center-to-center distances corresponding to axial and equatorial conformations, respectively. Distances are in nanometers. The three pairs and their distances are:\n    - Pair $1$ $(X,R_1)$: $r_{\\mathrm{ax}} = 0.33$ $\\mathrm{nm}$, $r_{\\mathrm{eq}} = 0.38$ $\\mathrm{nm}$.\n    - Pair $2$ $(X,R_2)$: $r_{\\mathrm{ax}} = 0.40$ $\\mathrm{nm}$, $r_{\\mathrm{eq}} = 0.35$ $\\mathrm{nm}$.\n    - Pair $3$ $(X,R_3)$: $r_{\\mathrm{ax}} = 0.36$ $\\mathrm{nm}$, $r_{\\mathrm{eq}} = 0.39$ $\\mathrm{nm}$.\n\nThe potential components to be used are:\n\n- Dihedral torsion for a single term with amplitude $V$, periodicity $n$, phase $\\delta$ (in degrees), and dihedral angle $\\phi$ (in degrees):\n  $$\n  U_{\\mathrm{tor}}(\\phi;V,n,\\delta) = \\frac{V}{2}\\left[1 + \\cos\\!\\left(n\\,\\phi - \\delta\\right)\\right].\n  $$\n- Lennard–Jones interaction for a pair $(i,j)$ with parameters $(\\varepsilon_{ij},\\sigma_{ij})$ at distance $r$:\n  $$\n  U_{\\mathrm{LJ}}(r;\\varepsilon_{ij},\\sigma_{ij}) = 4\\,\\varepsilon_{ij}\\left[\\left(\\frac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r}\\right)^{6}\\right].\n  $$\n- Coulomb interaction for a pair $(i,j)$ at distance $r$ with charges $(q_i,q_j)$:\n  $$\n  U_{\\mathrm{C}}(r;q_i,q_j) = k_c\\frac{q_i q_j}{r}.\n  $$\n\nFor each force-field-like parameterization below, evaluate $E_{\\mathrm{ax}}$ and $E_{\\mathrm{eq}}$ as the sum of the torsional term at $\\phi_{\\mathrm{ax}}$ or $\\phi_{\\mathrm{eq}}$ and the three pairwise nonbonded terms (each being the sum of Lennard–Jones and Coulomb terms) at the corresponding axial or equatorial distances. Then compute $\\Delta E$ in $\\mathrm{kJ\\ mol^{-1}}$.\n\nProvide results for the following six test cases. In all cases, angles are in degrees, distances in nanometers, energies in kilojoules per mole, and charges in elementary charge units. When a value is stated as zero, treat it as exactly zero.\n\n- Test case $1$ (AMBER-like: Assisted Model Building with Energy Refinement):\n  - Dihedral: $V = 1.2$, $n = 1$, $\\delta = 0^\\circ$.\n  - Charges: $q_X = -0.18$, $q_{R_1} = +0.06$, $q_{R_2} = -0.10$, $q_{R_3} = +0.05$.\n  - Lennard–Jones pair parameters:\n    - Pair $1$: $\\varepsilon_{XR_1} = 0.30$, $\\sigma_{XR_1} = 0.32$.\n    - Pair $2$: $\\varepsilon_{XR_2} = 0.50$, $\\sigma_{XR_2} = 0.30$.\n    - Pair $3$: $\\varepsilon_{XR_3} = 0.20$, $\\sigma_{XR_3} = 0.33$.\n\n- Test case $2$ (CHARMM-like: Chemistry at Harvard Macromolecular Mechanics):\n  - Dihedral: $V = 1.5$, $n = 1$, $\\delta = 0^\\circ$.\n  - Charges: $q_X = -0.20$, $q_{R_1} = +0.07$, $q_{R_2} = -0.12$, $q_{R_3} = +0.06$.\n  - Lennard–Jones pair parameters:\n    - Pair $1$: $\\varepsilon_{XR_1} = 0.28$, $\\sigma_{XR_1} = 0.32$.\n    - Pair $2$: $\\varepsilon_{XR_2} = 0.45$, $\\sigma_{XR_2} = 0.29$.\n    - Pair $3$: $\\varepsilon_{XR_3} = 0.22$, $\\sigma_{XR_3} = 0.33$.\n\n- Test case $3$ (GROMOS-like: Groningen Molecular Simulation):\n  - Dihedral: $V = 0.9$, $n = 1$, $\\delta = 0^\\circ$.\n  - Charges: $q_X = -0.16$, $q_{R_1} = +0.05$, $q_{R_2} = -0.09$, $q_{R_3} = +0.04$.\n  - Lennard–Jones pair parameters:\n    - Pair $1$: $\\varepsilon_{XR_1} = 0.25$, $\\sigma_{XR_1} = 0.32$.\n    - Pair $2$: $\\varepsilon_{XR_2} = 0.55$, $\\sigma_{XR_2} = 0.31$.\n    - Pair $3$: $\\varepsilon_{XR_3} = 0.18$, $\\sigma_{XR_3} = 0.34$.\n\n- Test case $4$ (AMBER-like with electrostatics suppressed):\n  - Same as Test case $1$, except set all charges to $0.0$.\n\n- Test case $5$ (AMBER-like with van der Waals suppressed):\n  - Same as Test case $1$, except set all $\\varepsilon_{XR_k}$ to $0.0$.\n\n- Test case $6$ (AMBER-like with torsion suppressed):\n  - Same as Test case $1$, except set $V = 0.0$.\n\nYour program must compute $\\Delta E$ for each test case and produce a single line of output containing the six results as a comma-separated list enclosed in square brackets. Each number must be rounded to exactly three decimal places. For example, the output format must be like\n$[x_1,x_2,x_3,x_4,x_5,x_6]$\nwhere each $x_i$ is a decimal float in $\\mathrm{kJ\\ mol^{-1}}$ with three digits after the decimal point. Angles must be treated in degrees as given and converted to radians internally when evaluating the cosine. Distances must be treated in nanometers as given. Energies must be reported in kilojoules per mole as required.", "solution": "The problem statement is validated and found to be scientifically grounded, well-posed, objective, and complete. It describes a standard, albeit simplified, application of molecular mechanics principles to a legitimate problem in stereochemistry. There are no contradictions or ambiguities. A direct solution is possible and will be provided.\n\nThe fundamental task is to compute the potential energy difference, $\\Delta E$, between the equatorial and axial conformations of a model system. The relative stability is determined by the potential energy, where a lower energy corresponds to a more stable conformation. The quantity to be calculated is $\\Delta E \\equiv E_{\\mathrm{eq}} - E_{\\mathrm{ax}}$, where $E_{\\mathrm{eq}}$ and $E_{\\mathrm{ax}}$ are the total potential energies of the equatorial and axial conformations, respectively. A negative $\\Delta E$ indicates that the equatorial conformation is more stable, while a positive $\\Delta E$ indicates the axial conformation is more stable.\n\nThe total potential energy, $E$, for a given conformation is defined as the sum of a single dihedral torsion term, $U_{\\mathrm{tor}}$, and three nonbonded interaction terms. Each nonbonded term is the sum of a Lennard-Jones potential, $U_{\\mathrm{LJ}}$, and a Coulomb potential, $U_{\\mathrm{C}}$. The total energy for one conformation is thus:\n$$\nE = U_{\\mathrm{tor}} + \\sum_{k=1}^{3} \\left( U_{\\mathrm{LJ},k} + U_{\\mathrm{C},k} \\right)\n$$\nThe specific functional forms for these energy components are provided.\n\nThe dihedral torsion energy is given by a single term of a Fourier series:\n$$\nU_{\\mathrm{tor}}(\\phi;V,n,\\delta) = \\frac{V}{2}\\left[1 + \\cos\\!\\left(n\\,\\phi - \\delta\\right)\\right]\n$$\nHere, $V$ is the potential barrier height, $n$ is the periodicity, $\\phi$ is the dihedral angle, and $\\delta$ is the phase shift. The angles $\\phi$ and $\\delta$ are provided in degrees and must be converted to radians for evaluation of the cosine function.\n\nThe nonbonded interaction for each pair $k$ between the substituent $X$ and a ring site $R_k$ at a distance $r$ is the sum of the Lennard-Jones and Coulomb terms:\n$$\nU_{\\mathrm{nonbonded},k}(r) = U_{\\mathrm{LJ}}(r;\\varepsilon_{k},\\sigma_{k}) + U_{\\mathrm{C}}(r;q_X,q_{R_k})\n$$\nThe Lennard-Jones $12$-$6$ potential is defined as:\n$$\nU_{\\mathrm{LJ}}(r;\\varepsilon_{ij},\\sigma_{ij}) = 4\\,\\varepsilon_{ij}\\left[\\left(\\frac{\\sigma_{ij}}{r}\\right)^{12} - \\left(\\frac{\\sigma_{ij}}{r}\\right)^{6}\\right]\n$$\nwhere $\\varepsilon_{ij}$ is the well depth and $\\sigma_{ij}$ is the finite distance at which the inter-particle potential is zero.\n\nThe Coulomb, or electrostatic, potential is:\n$$\nU_{\\mathrm{C}}(r;q_i,q_j) = k_c\\frac{q_i q_j}{r}\n$$\nwhere $q_i$ and $q_j$ are the partial charges, $r$ is the separation distance, and $k_c$ is the Coulomb constant, given as $k_c = 138.935458$ $\\mathrm{kJ\\ mol^{-1}\\ nm\\ e^{-2}}$.\n\nTo find the energy difference $\\Delta E$, we calculate the energy for the axial and equatorial conformations using their respective geometric parameters and subtract. The axial conformation has a dihedral angle $\\phi_{\\mathrm{ax}} = 60^\\circ$ and nonbonded distances $r_{k,\\mathrm{ax}}$ for $k=1,2,3$. The equatorial conformation has a dihedral angle $\\phi_{\\mathrm{eq}} = 180^\\circ$ and nonbonded distances $r_{k,\\mathrm{eq}}$.\n\nThe energy for the axial conformation is:\n$$\nE_{\\mathrm{ax}} = U_{\\mathrm{tor}}(\\phi_{\\mathrm{ax}}) + \\sum_{k=1}^{3} \\left( U_{\\mathrm{LJ}}(r_{k,\\mathrm{ax}}) + U_{\\mathrm{C}}(r_{k,\\mathrm{ax}}) \\right)\n$$\nThe energy for the equatorial conformation is:\n$$\nE_{\\mathrm{eq}} = U_{\\mathrm{tor}}(\\phi_{\\mathrm{eq}}) + \\sum_{k=1}^{3} \\left( U_{\\mathrm{LJ}}(r_{k,\\mathrm{eq}}) + U_{\\mathrm{C}}(r_{k,\\mathrm{eq}}) \\right)\n$$\nThe desired energy difference is therefore:\n$$\n\\Delta E = E_{\\mathrm{eq}} - E_{\\mathrm{ax}} = \\left( U_{\\mathrm{tor}}(\\phi_{\\mathrm{eq}}) - U_{\\mathrm{tor}}(\\phi_{\\mathrm{ax}}) \\right) + \\sum_{k=1}^{3} \\left( \\left( U_{\\mathrm{LJ}}(r_{k,\\mathrm{eq}}) - U_{\\mathrm{LJ}}(r_{k,\\mathrm{ax}}) \\right) + \\left( U_{\\mathrm{C}}(r_{k,\\mathrm{eq}}) - U_{\\mathrm{C}}(r_{k,\\mathrm{ax}}) \\right) \\right)\n$$\nThis expression can be written as the sum of the differences for each energy component:\n$$\n\\Delta E = \\Delta U_{\\mathrm{tor}} + \\sum_{k=1}^{3} (\\Delta U_{\\mathrm{LJ},k} + \\Delta U_{\\mathrm{C},k})\n$$\nwhere:\n$$\n\\Delta U_{\\mathrm{tor}} = \\frac{V}{2} \\left[ \\cos(n\\phi_{\\mathrm{eq}} - \\delta) - \\cos(n\\phi_{\\mathrm{ax}} - \\delta) \\right]\n$$\n$$\n\\Delta U_{\\mathrm{LJ},k} = 4\\varepsilon_k \\left[ \\left( \\left(\\frac{\\sigma_k}{r_{k,\\mathrm{eq}}}\\right)^{12} - \\left(\\frac{\\sigma_k}{r_{k,\\mathrm{eq}}}\\right)^{6} \\right) - \\left( \\left(\\frac{\\sigma_k}{r_{k,\\mathrm{ax}}}\\right)^{12} - \\left(\\frac{\\sigma_k}{r_{k,\\mathrm{ax}}}\\right)^{6} \\right) \\right]\n$$\n$$\n\\Delta U_{\\mathrm{C},k} = k_c q_X q_{R_k} \\left( \\frac{1}{r_{k,\\mathrm{eq}}} - \\frac{1}{r_{k,\\mathrm{ax}}} \\right)\n$$\nThe calculation is performed for each of the six specified test cases by substituting the corresponding parameter sets into these equations. The fixed geometric parameters are:\n- Dihedral angles: $\\phi_{\\mathrm{ax}} = 60^\\circ$, $\\phi_{\\mathrm{eq}} = 180^\\circ$.\n- Nonbonded distances (axial, equatorial) in nm:\n    - Pair $1$: ($0.33$, $0.38$)\n    - Pair $2$: ($0.40$, $0.35$)\n    - Pair $3$: ($0.36$, $0.39$)\nThe implementation will calculate the total $\\Delta E$ for each case and format the results as requested.", "answer": "```python\nimport numpy as np\nimport copy\n\ndef solve():\n    \"\"\"\n    Computes the energy difference between equatorial and axial anomers for a\n    simplified glucopyranose model using six different parameter sets.\n    \"\"\"\n\n    # --- Fixed Parameters and Constants ---\n    # Coulomb constant in kJ mol^-1 nm e^-2\n    KC = 138.935458\n\n    # Dihedral angles in degrees\n    PHI_AX = 60.0\n    PHI_EQ = 180.0\n\n    # Nonbonded pair distances [r_ax, r_eq] in nm\n    DISTANCES = {\n        'r1': [0.33, 0.38],\n        'r2': [0.40, 0.35],\n        'r3': [0.36, 0.39]\n    }\n    r_ax = np.array([DISTANCES['r1'][0], DISTANCES['r2'][0], DISTANCES['r3'][0]])\n    r_eq = np.array([DISTANCES['r1'][1], DISTANCES['r2'][1], DISTANCES['r3'][1]])\n\n    # --- Test Case Definitions ---\n    test_cases_data = [\n        {\n            \"name\": \"AMBER-like\",\n            \"dihedral\": {\"V\": 1.2, \"n\": 1, \"delta\": 0.0},\n            \"charges\": {\"qX\": -0.18, \"qR\": np.array([0.06, -0.10, 0.05])},\n            \"lj\": {\"eps\": np.array([0.30, 0.50, 0.20]), \"sig\": np.array([0.32, 0.30, 0.33])}\n        },\n        {\n            \"name\": \"CHARMM-like\",\n            \"dihedral\": {\"V\": 1.5, \"n\": 1, \"delta\": 0.0},\n            \"charges\": {\"qX\": -0.20, \"qR\": np.array([0.07, -0.12, 0.06])},\n            \"lj\": {\"eps\": np.array([0.28, 0.45, 0.22]), \"sig\": np.array([0.32, 0.29, 0.33])}\n        },\n        {\n            \"name\": \"GROMOS-like\",\n            \"dihedral\": {\"V\": 0.9, \"n\": 1, \"delta\": 0.0},\n            \"charges\": {\"qX\": -0.16, \"qR\": np.array([0.05, -0.09, 0.04])},\n            \"lj\": {\"eps\": np.array([0.25, 0.55, 0.18]), \"sig\": np.array([0.32, 0.31, 0.34])}\n        }\n    ]\n    \n    # Case 4: AMBER-like with electrostatics suppressed\n    case4 = copy.deepcopy(test_cases_data[0])\n    case4[\"name\"] = \"AMBER-like, no electrostatics\"\n    case4[\"charges\"][\"qX\"] = 0.0\n    case4[\"charges\"][\"qR\"] = np.array([0.0, 0.0, 0.0])\n    test_cases_data.append(case4)\n\n    # Case 5: AMBER-like with van der Waals suppressed\n    case5 = copy.deepcopy(test_cases_data[0])\n    case5[\"name\"] = \"AMBER-like, no vdW\"\n    case5[\"lj\"][\"eps\"] = np.array([0.0, 0.0, 0.0])\n    test_cases_data.append(case5)\n    \n    # Case 6: AMBER-like with torsion suppressed\n    case6 = copy.deepcopy(test_cases_data[0])\n    case6[\"name\"] = \"AMBER-like, no torsion\"\n    case6[\"dihedral\"][\"V\"] = 0.0\n    test_cases_data.append(case6)\n\n    # --- Energy Calculation Functions ---\n    def U_tor(phi, V, n, delta):\n        phi_rad = np.deg2rad(phi)\n        delta_rad = np.deg2rad(delta)\n        return (V / 2.0) * (1.0 + np.cos(n * phi_rad - delta_rad))\n\n    def U_lj(r, eps, sig):\n        if eps == 0.0:\n            return 0.0\n        ratio = sig / r\n        return 4.0 * eps * (ratio**12 - ratio**6)\n        \n    def U_coulomb(r, q1, q2):\n        if q1 == 0.0 or q2 == 0.0:\n            return 0.0\n        return KC * (q1 * q2) / r\n\n    def calculate_delta_e(params):\n        # Unpack parameters\n        V, n, delta = params[\"dihedral\"][\"V\"], params[\"dihedral\"][\"n\"], params[\"dihedral\"][\"delta\"]\n        qX, qR = params[\"charges\"][\"qX\"], params[\"charges\"][\"qR\"]\n        epsilons, sigmas = params[\"lj\"][\"eps\"], params[\"lj\"][\"sig\"]\n\n        # Calculate E_ax\n        E_ax_tor = U_tor(PHI_AX, V, n, delta)\n        E_ax_lj = np.sum([U_lj(r, eps, sig) for r, eps, sig in zip(r_ax, epsilons, sigmas)])\n        E_ax_c = np.sum([U_coulomb(r, qX, qr) for r, qr in zip(r_ax, qR)])\n        E_ax = E_ax_tor + E_ax_lj + E_ax_c\n\n        # Calculate E_eq\n        E_eq_tor = U_tor(PHI_EQ, V, n, delta)\n        E_eq_lj = np.sum([U_lj(r, eps, sig) for r, eps, sig in zip(r_eq, epsilons, sigmas)])\n        E_eq_c = np.sum([U_coulomb(r, qX, qr) for r, qr in zip(r_eq, qR)])\n        E_eq = E_eq_tor + E_eq_lj + E_eq_c\n        \n        # Return Delta E\n        return E_eq - E_ax\n\n    # --- Main Loop ---\n    results = []\n    for case_params in test_cases_data:\n        delta_e = calculate_delta_e(case_params)\n        results.append(delta_e)\n\n    # Format and print the final output\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "2452387"}, {"introduction": "A common and frustrating experience in molecular dynamics is a simulation that \"explodes\" due to numerical instability, which often points to an underlying issue in the system's potential energy. This final practice [@problem_id:2452415] moves from calculation to methodology, challenging you to think like an expert diagnostician. You will evaluate different strategies to identify the most systematic and principled workflow for tracing an instability back to its source, a critical skill for any computational practitioner.", "problem": "You are running a Molecular Dynamics (MD) simulation of a small organic solute in explicit water with periodic boundary conditions using a common biomolecular force field such as Assisted Model Building with Energy Refinement (AMBER), Chemistry at HARvard Macromolecular Mechanics (CHARMM), Optimized Potentials for Liquid Simulations (OPLS), or GROningen MOlecular Simulation (GROMOS). The force field potential is the usual sum of bonded and nonbonded terms,\n$$\nE(\\mathbf{r}) \\;=\\; E_{\\mathrm{bond}} \\;+\\; E_{\\mathrm{angle}} \\;+\\; E_{\\mathrm{dihedral}} \\;+\\; E_{\\mathrm{LJ}} \\;+\\; E_{\\mathrm{Coul}},\n$$\nwhere $E_{\\mathrm{LJ}}$ is the Lennard–Jones term and $E_{\\mathrm{Coul}}$ is the Coulomb electrostatic term. After starting production, the simulation “explodes” within a short time: the potential energy spikes to extremely large positive values and the atomic coordinates become nonphysical.\n\nYou want to design a principled debugging workflow that can trace the instability back to a specific energy term in the potential, so that you can correct a parameterization or setup error (for example, a wrong combining rule, an incorrect $1$–$4$ scaling, a bad initial geometry, or a missing bonded parameter). Which of the following workflows is the most appropriate to isolate the problematic term from first principles?\n\nA. Reduce the integration time step to $0.1\\,\\mathrm{fs}$ and couple strongly to a thermostat and barostat so that the system does not heat up. If the simulation no longer explodes, conclude that the instability was due to an overly large time step and proceed with these damping settings.\n\nB. Replace the current force field (for example, OPLS) with a different one (for example, CHARMM) without changing anything else. If the simulation becomes stable, conclude that the original force field was incorrect and adopt the new force field.\n\nC. Perform energy minimization to remove steric clashes, then carry out a sequence of short, restrained single-point or few-step runs in which you include subsets of the energy terms to build up the full potential: first $E_{\\mathrm{bond}} + E_{\\mathrm{angle}}$, then add $E_{\\mathrm{dihedral}}$, then add the scaled $1$–$4$ intramolecular nonbonded interactions as prescribed by the chosen force field, then add $E_{\\mathrm{LJ}}$ using the proper cross-interaction combining rule, and finally add $E_{\\mathrm{Coul}}$ with the intended long-range treatment (for example, Particle Mesh Ewald (PME)). At each stage, record per-term energies and monitor interatomic separations $r_{ij}$. Identify the first stage at which energies or forces diverge, and inspect the corresponding parameters (for example, equilibrium values, force constants, partial charges, $\\sigma/\\epsilon$, and $1$–$4$ scaling) to locate the faulty term.\n\nD. Increase the nonbonded cutoff to a very large value, disable all exclusions, and turn off all bonded terms so that only nonbonded interactions remain. If the system still explodes, conclude that nonbonded terms are responsible and reduce all partial charges by a factor of $10$ to stabilize the run.\n\nE. Apply strong positional restraints to all heavy atoms and perform a steepest-descent minimization until the gradient norm is below a small threshold. Then compute a single total-energy and total-force evaluation. If the total force norm is small, conclude that the system is stable; if large, conclude that the integrator is at fault. No decomposition into $E_{\\mathrm{bond}}$, $E_{\\mathrm{angle}}$, $E_{\\mathrm{dihedral}}$, $E_{\\mathrm{LJ}}$, or $E_{\\mathrm{Coul}}$ is necessary.", "solution": "The problem statement describes a common and critical issue in the field of molecular dynamics (MD) simulations: a numerical instability, colloquially known as the simulation \"exploding.\" This is characterized by a rapid, divergent increase in potential energy and the generation of non-physical atomic coordinates. The task is to identify the most appropriate, principled debugging workflow to isolate the specific energy term responsible for this instability.\n\nThe problem statement is scientifically sound and well-posed. The potential energy function\n$$\nE(\\mathbf{r}) \\;=\\; E_{\\mathrm{bond}} \\;+\\; E_{\\mathrm{angle}} \\;+\\; E_{\\mathrm{dihedral}} \\;+\\; E_{\\mathrm{LJ}} \\;+\\; E_{\\mathrm{Coul}}\n$$\nis a standard representation for common biomolecular force fields like AMBER, CHARMM, OPLS, and GROMOS. The scenario of a simulation failing due to errors in parameterization (e.g., incorrect $1$–$4$ scaling, missing parameters) or setup (e.g., bad initial geometry with steric clashes) is highly realistic. The objective is to find a systematic method for diagnosis, which is a fundamental skill in computational science. The problem is valid.\n\nA principled debugging workflow must be systematic and isolating. It should begin with the simplest possible stable state and incrementally add complexity, checking for failure at each step. The goal is not merely to suppress the instability, but to identify its root cause within the physical model—the potential energy function.\n\nLet us evaluate each proposed workflow.\n\n**A. Reduce the integration time step to $0.1\\,\\mathrm{fs}$ and couple strongly to a thermostat and barostat so that the system does not heat up. If the simulation no longer explodes, conclude that the instability was due to an overly large time step and proceed with these damping settings.**\n\nThis approach is flawed. It treats the symptom, not the disease. While a very small time step (the standard is typically $1$–$2\\,\\mathrm{fs}$) and strong temperature/pressure coupling can dampen high-frequency motions and suppress numerical instabilities, they do not correct the underlying error in the potential energy function or initial geometry. If the potential contains a singularity (e.g., from an incorrect Lennard-Jones parameter where a repulsive wall is missing) or generates excessively large forces for certain configurations, this method only masks the problem. The resulting simulation, even if it does not crash, may be sampling a completely unphysical state and would not be scientifically valid. Concluding that the time step was the sole cause is a premature and likely incorrect diagnosis. The goal is to correct the force field setup, not to cripple the simulation dynamics to make it run.\n\n**Verdict:** Incorrect.\n\n**B. Replace the current force field (for example, OPLS) with a different one (for example, CHARMM) without changing anything else. If the simulation becomes stable, conclude that the original force field was incorrect and adopt the new force field.**\n\nThis is an unscientific \"shotgun\" approach to debugging. It fails to provide any insight into *why* the original simulation failed. The most probable reason for an explosion is not a fundamental flaw in a widely used force field like OPLS, but a user error in applying it (e.g., a mistake in the topology file, missing parameters for the solute, or incorrect preparation scripts). If changing the force field happens to work, it is likely because the setup process for the new force field was performed correctly by chance, or because the parameter files were more complete for the given molecule. The conclusion that the \"original force field was incorrect\" is a gross oversimplification and does not constitute a proper diagnosis. A principled investigation requires understanding the specific failure within the chosen model.\n\n**Verdict:** Incorrect.\n\n**C. Perform energy minimization to remove steric clashes, then carry out a sequence of short, restrained single-point or few-step runs in which you include subsets of the energy terms to build up the full potential: first $E_{\\mathrm{bond}} + E_{\\mathrm{angle}}$, then add $E_{\\mathrm{dihedral}}$, then add the scaled $1$–$4$ intramolecular nonbonded interactions as prescribed by the chosen force field, then add $E_{\\mathrm{LJ}}$ using the proper cross-interaction combining rule, and finally add $E_{\\mathrm{Coul}}$ with the intended long-range treatment (for example, Particle Mesh Ewald (PME)). At each stage, record per-term energies and monitor interatomic separations $r_{ij}$. Identify the first stage at which energies or forces diverge, and inspect the corresponding parameters (for example, equilibrium values, force constants, partial charges, $\\sigma/\\epsilon$, and $1$–$4$ scaling) to locate the faulty term.**\n\nThis workflow is the correct and standard professional procedure for diagnosing such problems. It is systematic, logical, and designed for isolation.\n$1$. **Energy Minimization:** This is the correct first step to resolve high-energy steric clashes in the initial structure, which are a common cause of explosions.\n$2$. **Incremental Buildup:** Adding energy terms sequentially (bonded, then dihedrals, then nonbonded) is a classic divide-and-conquer strategy. It allows one to pinpoint exactly which component of the potential introduces the instability. The proposed order is logical, moving from local covalent interactions to more complex and longer-ranged ones.\n$3$. **Monitoring:** Checking energies and forces at each stage provides a clear signal. If the system is stable with terms $1$ through $N-1$, but explodes upon adding term $N$, then term $N$ is the source of the problem.\n$4$. **Inspection:** Once the problematic term is identified, one can perform a focused investigation of the associated parameters, which is the ultimate goal of the debugging process. This workflow leads directly to the root cause of the error.\n\n**Verdict:** Correct.\n\n**D. Increase the nonbonded cutoff to a very large value, disable all exclusions, and turn off all bonded terms so that only nonbonded interactions remain. If the system still explodes, conclude that nonbonded terms are responsible and reduce all partial charges by a factor of $10$ to stabilize the run.**\n\nThis workflow is nonsensical and physically destructive.\n$1$. **Turning off bonded terms:** This disintegrates the molecules. It is no longer a simulation of the intended system.\n$2$. **Disabling all exclusions:** Force fields are parameterized with the assumption that interactions between atoms separated by one bond ($1$–$2$ pairs) and two bonds ($1$–$3$ pairs) are excluded from the nonbonded calculation. Disabling these exclusions would introduce colossal repulsive and electrostatic forces between nearby atoms, guaranteeing an instant explosion. This action demonstrates a fundamental misunderstanding of how force fields are constructed.\n$3$. **Arbitrarily reducing charges:** This is not a diagnosis; it is an ad-hoc modification of the physical model without justification. The problem could lie in the Lennard-Jones parameters, not the charges. This step does not identify the specific error.\n\n**Verdict:** Incorrect.\n\n**E. Apply strong positional restraints to all heavy atoms and perform a steepest-descent minimization until the gradient norm is below a small threshold. Then compute a single total-energy and total-force evaluation. If the total force norm is small, conclude that the system is stable; if large, conclude that the integrator is at fault. No decomposition into $E_{\\mathrm{bond}}$, $E_{\\mathrm{angle}}$, $E_{\\mathrm{dihedral}}$, $E_{\\mathrm{LJ}}$, or $E_{\\mathrm{Coul}}$ is necessary.**\n\nThis workflow is based on flawed logic. A single static force calculation on a minimized, restrained structure is insufficient to assess dynamic stability. The system might be stable in that specific configuration but unstable as soon as atoms begin to move during an actual MD run. The most critical error is the conclusion: \"if [the force is] large, conclude that the integrator is at fault.\" The forces are calculated from the gradient of the potential, $F = -\\nabla E$. The integrator (e.g., Verlet algorithm) simply uses these forces to update positions. An extremely large force points to a problem with the potential energy function $E$ (i.e., the force field parameters or geometry), not the standard, well-validated integration algorithm. Finally, the statement \"No decomposition ... is necessary\" is in direct opposition to the goal of a principled diagnosis, which is precisely to decompose the problem to find its origin.\n\n**Verdict:** Incorrect.", "answer": "$$\\boxed{C}$$", "id": "2452415"}]}