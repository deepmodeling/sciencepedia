{"hands_on_practices": [{"introduction": "Molecular mechanics force fields break down a molecule's potential energy into distinct components. This first practice challenges you to think about the fundamental purpose of the improper torsion term. By considering a simple, highly symmetric molecule like methane, you will explore why this energy term is essential for some molecular structures but unnecessary for others, honing your understanding of force field construction [@problem_id:2459874].", "problem": "A single methane molecule, $CH_4$, is simulated in vacuum using a classical molecular mechanics (MM) force field that decomposes the potential energy into contributions labeled $E_{\\text{bond}}$, $E_{\\text{angle}}$, $E_{\\text{proper}}$ (proper dihedrals), $E_{\\text{improper}}$ (improper torsions or out-of-plane bending), $E_{\\text{vdW}}$ from the Lennard–Jones (LJ) interaction, and $E_{\\text{elec}}$ from fixed partial charges. The methane geometry is optimized and exhibits tetrahedral ($T_d$) symmetry about carbon with $sp^3$ hybridization. The topology used by the package includes bonded terms only if they are explicitly defined for the relevant atom types.\n\nIn the package’s energy breakdown for this optimized $CH_4$, the reported $E_{\\text{improper}}$ is $0$. Which statement best explains why the improper torsion (out-of-plane) energy is, or should be, $0$ for methane under these conditions?\n\nA. $E_{\\text{improper}}$ is $0$ because standard MM force fields assign improper torsion terms primarily to enforce planarity at $sp^2$ centers or to preserve chirality at stereocenters. The central carbon in $CH_4$ is $sp^3$ and achiral (all $4$ substituents are identical), so no improper terms are defined for methane and the sum over improper terms is empty.\n\nB. $E_{\\text{improper}}$ must be nonzero for $CH_4$ because any nonplanar arrangement around carbon intrinsically incurs an out-of-plane penalty; tetrahedral geometry is maximally nonplanar, so $E_{\\text{improper}}$ is largest in methane.\n\nC. $E_{\\text{improper}}$ would be $0$ only at $T=0\\,\\text{K}$; at any finite temperature, thermal fluctuations induce out-of-plane motion that is penalized by the improper torsion potential, making the ensemble-average $E_{\\text{improper}}$ strictly greater than $0$.\n\nD. $E_{\\text{improper}}$ is $0$ at the optimized geometry because general-purpose force fields include improper torsions for $sp^3$ centers with an equilibrium out-of-plane value equal to the tetrahedral angle (approximately $35.26^\\circ$); deviations from this angle at nonoptimized geometries would make $E_{\\text{improper}}$ nonzero.", "solution": "The problem asks for the most accurate explanation for why the improper torsion energy, $E_{\\text{improper}}$, is zero for a methane molecule in its optimized tetrahedral geometry, as calculated by a classical molecular mechanics (MM) force field.\n\nFirst, we must understand the nature of the improper torsion potential energy term. An improper torsion is defined for a set of four atoms, and its energy is typically represented by a harmonic or periodic function. For a harmonic potential, the form is:\n$$ E_{\\text{improper}} = \\sum_{\\text{impropers}} \\frac{1}{2} k_{\\chi} (\\chi - \\chi_0)^2 $$\nHere, $\\chi$ is the improper dihedral angle, $\\chi_0$ is its equilibrium value, and $k_{\\chi}$ is the force constant. The total $E_{\\text{improper}}$ is a sum over all defined improper torsions in the molecule. For this sum to be zero, one of two conditions must be met for every term in the sum:\n$1$. The geometry is such that $\\chi = \\chi_0$ for every defined improper torsion. This means the structure is perfectly relaxed with respect to these degrees of freedom.\n$2$. The set of defined improper torsions for the molecule is empty. In the context of the given problem, this means that for the atom types present in methane ($CH_4$), no improper torsion parameters are defined in the force field file, so $k_{\\chi} = 0$ for any potential improper torsion. The problem statement points toward this possibility with the clause: \"The topology used by the package includes bonded terms only if they are explicitly defined for the relevant atom types.\"\n\nThe primary functions of improper torsion terms in standard MM force fields (such as AMBER, CHARMM, OPLS) are:\n(a) To enforce planarity at $sp^2$-hybridized centers. For example, in a benzene ring or a peptide bond, the atoms should remain coplanar. This is achieved by defining an improper torsion with an equilibrium angle $\\chi_0 = 0^\\circ$ or $\\chi_0 = 180^\\circ$ and a large force constant $k_{\\chi}$ to penalize out-of-plane deviations.\n(b) To maintain the stereochemistry (chirality) of a chiral center. For an $sp^3$ carbon atom with four different substituents, an improper torsion can prevent the center from inverting its configuration during a simulation. This acts as a restraint to preserve a specific stereoisomer.\n\nNow, we apply these principles to the methane molecule, $CH_4$. The central carbon atom is $sp^3$-hybridized. However, it is bonded to four identical hydrogen atoms. Consequently, this carbon atom is **achiral**. Therefore, it does not require an improper torsion term to maintain stereochemistry. Furthermore, the carbon atom is not $sp^2$-hybridized, and the molecule's equilibrium geometry is tetrahedral, not planar. So, it does not require an improper torsion to enforce planarity.\n\nThe tetrahedral geometry of methane is primarily established by other, more fundamental terms in the force field: the $E_{\\text{angle}}$ term, which forces the $H-C-H$ angle toward approximately $109.5^\\circ$, and the non-bonded interactions ($E_{\\text{vdW}}$ and $E_{\\text{elec}}$) between the four hydrogen atoms, which also favor a tetrahedral arrangement to minimize steric and electrostatic repulsion. Introducing an additional improper torsion term to enforce tetrahedrality would be redundant.\n\nGiven these facts, the most logical and common approach in force field design is to simply **not define** any improper torsion parameters for an achiral, $sp^3$-hybridized center like the one in methane. The sum over improper terms becomes an empty sum, which is mathematically equal to $0$.\n\nBased on this derivation, we can evaluate the provided options.\n\n**A. $E_{\\text{improper}}$ is $0$ because standard MM force fields assign improper torsion terms primarily to enforce planarity at $sp^2$ centers or to preserve chirality at stereocenters. The central carbon in $CH_4$ is $sp^3$ and achiral (all $4$ substituents are identical), so no improper terms are defined for methane and the sum over improper terms is empty.**\nThis statement is a precise and accurate summary of the reasoning derived above. It correctly identifies the main purposes of improper torsions, correctly characterizes the carbon in methane as $sp^3$ and achiral, and draws the correct conclusion that force fields typically omit such a term for methane, resulting in a zero contribution to the energy.\n**Verdict: Correct.**\n\n**B. $E_{\\text{improper}}$ must be nonzero for $CH_4$ because any nonplanar arrangement around carbon intrinsically incurs an out-of-plane penalty; tetrahedral geometry is maximally nonplanar, so $E_{\\text{improper}}$ is largest in methane.**\nThis statement is fundamentally flawed. It misinterprets the improper torsion potential as a generic penalty for non-planarity. In reality, the potential penalizes deviations from a specific equilibrium angle $\\chi_0$. A non-planar structure can have zero improper torsion energy if it matches the equilibrium geometry (e.g., $\\chi = \\chi_0 \\neq 0$) or, more to the point, if the term is not defined at all. The statement directly contradicts the problem's premise that $E_{\\text{improper}}$ is $0$.\n**Verdict: Incorrect.**\n\n**C. $E_{\\text{improper}}$ would be $0$ only at $T=0\\,\\text{K}$; at any finite temperature, thermal fluctuations induce out-of-plane motion that is penalized by the improper torsion potential, making the ensemble-average $E_{\\text{improper}}$ strictly greater than $0$.**\nThis statement conflates the potential energy of a single optimized geometry with the average energy of an ensemble at finite temperature. The problem describes a geometry optimization, which finds a point on the potential energy surface where the gradient is zero. This corresponds to the classical structure at $T=0\\,\\text{K}$. The question asks why the potential energy term is $0$ for this specific conformation. The behavior at $T > 0\\,\\text{K}$ is irrelevant to the question asked. Moreover, if the term is undefined as concluded above, its contribution will be $0$ regardless of temperature or molecular motion.\n**Verdict: Incorrect.**\n\n**D. $E_{\\text{improper}}$ is $0$ at the optimized geometry because general-purpose force fields include improper torsions for $sp^3$ centers with an equilibrium out-of-plane value equal to the tetrahedral angle (approximately $35.26^\\circ$); deviations from this angle at nonoptimized geometries would make $E_{\\text{improper}}$ nonzero.**\nThis option presents a plausible, but less likely and less fundamental, explanation. It is true that if an improper term were defined such that its equilibrium angle $\\chi_0$ matched the angle in the optimized tetrahedron, then the energy contribution at that geometry would be $E_{\\text{improper}} = \\frac{1}{2} k_{\\chi} (\\chi_0 - \\chi_0)^2 = 0$. However, as explained, such a term is redundant. More critically, this is not the standard practice in widely used force fields like AMBER or CHARMM. The primary explanation is the one given in option A. Furthermore, the numerical value provided, $35.26^\\circ$, is not a standard representation of an out-of-plane coordinate in a tetrahedron and its mention is dubious without a precise definition. Option A provides a more fundamental reason rooted in the core design philosophy of force fields. Therefore, D is not the *best* explanation.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2459874"}, {"introduction": "Having established the purpose of improper torsion terms, we now explore the physical meaning of their parameters. The force constant, $k$, dictates the stiffness of the out-of-plane potential. This exercise uses the classic comparison between aromatic benzene and a hypothetical localized cyclohexatriene to illustrate how $k$ is directly related to the stability of a molecule's $\\pi$-electron system, providing a deep link between force field parameters and fundamental electronic structure [@problem_id:2459803].", "problem": "A molecular mechanics (MM) force field models the resistance of a trigonal planar carbon center to pyramidalization using an improper torsion (out-of-plane) term. For a given central atom, the out-of-plane angle is denoted by $\\chi$, with a harmonic potential $V(\\chi)=\\tfrac{1}{2}k(\\chi-\\chi_{0})^{2}$ near the equilibrium value $\\chi_{0}=0$ for a planar $sp^{2}$ center. The force constant $k$ is, by definition, the second derivative of the potential energy with respect to $\\chi$ at $\\chi=0$, that is, $k=\\left.\\dfrac{\\mathrm{d}^{2}V}{\\mathrm{d}\\chi^{2}}\\right|_{\\chi=0}$. Consider two models for a six-membered hydrocarbon ring: aromatic benzene and a hypothetical non-aromatic $1,3,5$-cyclohexatriene in which the $\\pi$ bonds are fully localized and there is no cyclic delocalization. Suppose $k$ is to be fitted at a ring carbon in each molecule to reproduce the small-amplitude out-of-plane vibrational behavior predicted by quantum mechanics (QM). Which option best justifies the expected relative magnitude of $k$ in benzene versus $1,3,5$-cyclohexatriene?\n\nA. $k$ should be larger in benzene because cyclic $\\pi$ delocalization couples adjacent $p$ orbitals around the ring; an out-of-plane displacement at one carbon disrupts aromatic conjugation with both neighbors, increasing the curvature of $V(\\chi)$ relative to a localized triene.\n\nB. $k$ should be larger in $1,3,5$-cyclohexatriene because the absence of resonance makes individual double bonds intrinsically stiffer, so pyramidalization is more strongly resisted than in benzene.\n\nC. $k$ should be approximately equal in both molecules because the local hybridization is $sp^{2}$ in each case and the local geometry around each carbon is similar.\n\nD. $k$ should be smaller in benzene because delocalization allows charge to redistribute upon out-of-plane bending, softening the out-of-plane mode relative to a localized triene.\n\nE. $k$ should be identical because both molecules have six-membered rings, and ring size dominates the out-of-plane stiffness irrespective of electronic structure.", "solution": "The problem statement must first be validated for scientific soundness and consistency.\n\n**Step 1: Extract Givens**\n- The system is a trigonal planar carbon center in a six-membered hydrocarbon ring.\n- The out-of-plane bending is modeled by an improper torsion with angle $\\chi$.\n- The potential energy function for this motion is harmonic near equilibrium: $V(\\chi)=\\tfrac{1}{2}k(\\chi-\\chi_{0})^{2}$.\n- The equilibrium angle for a planar $sp^{2}$ center is $\\chi_{0}=0$.\n- The force constant $k$ is the second derivative of the potential energy evaluated at the equilibrium point: $k=\\left.\\dfrac{\\mathrm{d}^{2}V}{\\mathrm{d}\\chi^{2}}\\right|_{\\chi=0}$.\n- Two molecular models are to be compared:\n    1. Aromatic benzene.\n    2. A hypothetical non-aromatic $1,3,5$-cyclohexatriene with fully localized $\\pi$ bonds and no cyclic delocalization.\n- The question asks for the justification of the expected relative magnitude of the force constant $k$ for a ring carbon in benzene versus $1,3,5$-cyclohexatriene.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is well-grounded in the principles of computational chemistry (molecular mechanics force fields), physical organic chemistry (aromaticity, electronic structure), and physics (harmonic oscillator model). The concepts of improper torsions, out-of-plane bending, force constants, benzene, and the hypothetical localized $1,3,5$-cyclohexatriene as a reference state are standard in the field.\n- **Well-Posedness**: The problem is well-posed. It asks for a qualitative comparison of a well-defined physical parameter ($k$) between two clearly defined chemical systems. A unique and meaningful answer can be derived from fundamental chemical principles.\n- **Objectivity**: The problem is stated in objective, scientific language, free of ambiguity or subjective claims.\n- **Completeness and Consistency**: The problem provides all necessary information. The definition of the potential $V(\\chi)$ and the force constant $k$ are explicit. The properties of the two molecules (aromatic vs. localized non-aromatic) are clearly stated. There are no contradictions. The use of a hypothetical molecule as a reference is a standard and valid technique in theoretical chemistry.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically sound, well-posed, and internally consistent. We may proceed to the solution.\n\n**Derivation of the Solution**\nThe force constant $k$ is defined as $k=\\left.\\dfrac{\\mathrm{d}^{2}V}{\\mathrm{d}\\chi^{2}}\\right|_{\\chi=0}$. This quantity measures the curvature of the potential energy well at the equilibrium planar geometry ($\\chi=0$). A larger value of $k$ signifies a \"stiffer\" potential, meaning that a larger amount of energy is required to displace the atom from the plane by a given small angle $\\chi$. In other words, a larger $k$ corresponds to a stronger restoring force that maintains planarity.\n\nThe out-of-plane motion of a carbon atom in the ring involves the pyramidalization of that atom. This geometric distortion causes the $p_{z}$ orbital on that carbon, which is responsible for $\\pi$-bonding, to tilt away from the parallel alignment with the $p_{z}$ orbitals on the adjacent carbon atoms. This mis-alignment reduces the orbital overlap, which in turn weakens the $\\pi$-bonding. The energy cost of this distortion, $V(\\chi)$, is therefore directly related to the stability of the $\\pi$ electron system.\n\n1.  **Benzene**: Benzene is an aromatic molecule. The six $\\pi$ electrons are delocalized over the entire six-membered ring, forming a continuous cycle of conjugation. This cyclic delocalization results in a significant aromatic stabilization energy, which makes the planar structure of benzene exceptionally stable. When a single carbon atom is moved out of the plane (a non-zero $\\chi$), its $p_{z}$ orbital's overlap with the $p_{z}$ orbitals of *both* of its neighbors is diminished. This single local perturbation disrupts the entire cycle of conjugation, leading to a substantial loss of the aromatic stabilization energy. Because the aromatic system is so stable, resisting this disruption requires a large amount of energy. Thus, the potential energy $V(\\chi)$ for benzene rises very steeply as $\\chi$ deviates from $0$. This corresponds to a large curvature at the minimum, and therefore a large force constant $k$.\n\n2.  **Hypothetical $1,3,5$-Cyclohexatriene**: This molecule is defined as having three isolated carbon-carbon double bonds and three carbon-carbon single bonds, with no cyclic delocalization (no resonance). At any given carbon atom, it is part of one double bond and one single bond. When this carbon atom is displaced out of the plane, it primarily disrupts the $\\pi$ overlap within the single double bond it belongs to. The effect on the adjacent single bond is negligible in this localized model. While destabilizing a localized $\\pi$ bond certainly has an energy cost, this cost is not amplified by the loss of a collective, ring-wide stabilization effect like aromaticity. The stabilization of a single, isolated $\\pi$ bond is significantly less than the total stabilization of the delocalized aromatic system in benzene. Consequently, the energy penalty for the same out-of-plane displacement $\\chi$ is smaller for $1,3,5$-cyclohexatriene than for benzene. The potential well $V(\\chi)$ is shallower, its curvature is smaller, and thus the force constant $k$ is smaller.\n\nIn conclusion, $k_{\\text{benzene}} > k_{1,3,5-\\text{cyclohexatriene}}$ because disrupting the highly stable aromatic system in benzene is energetically more costly than disrupting a localized $\\pi$ bond in the non-aromatic analogue.\n\n**Evaluation of Options**\n\n**A. $k$ should be larger in benzene because cyclic $\\pi$ delocalization couples adjacent $p$ orbitals around the ring; an out-of-plane displacement at one carbon disrupts aromatic conjugation with both neighbors, increasing the curvature of $V(\\chi)$ relative to a localized triene.**\nThis option correctly states that $k$ is larger in benzene. The justification provided is entirely correct. Out-of-plane displacement disrupts the cyclic aromatic conjugation, which is a highly stabilizing feature. The energy cost to break this stabilization is high, leading to a large potential energy curvature ($k$).\n**Verdict: Correct.**\n\n**B. $k$ should be larger in $1,3,5$-cyclohexatriene because the absence of resonance makes individual double bonds intrinsically stiffer, so pyramidalization is more strongly resisted than in benzene.**\nThis option incorrectly claims $k$ is larger in cyclohexatriene. The reasoning inappropriately conflates the stiffness of bond *stretching* with the stiffness of out-of-plane *bending*. A localized C=C double bond is indeed stiffer with respect to stretching than the bonds in benzene. However, the resistance to out-of-plane bending is governed by the stability of the planar $\\pi$ system, which is far greater in aromatic benzene.\n**Verdict: Incorrect.**\n\n**C. $k$ should be approximately equal in both molecules because the local hybridization is $sp^{2}$ in each case and the local geometry around each carbon is similar.**\nThis option incorrectly claims the force constants are approximately equal. It relies on a superficial analysis of local geometry and hybridization. It entirely misses the dominant energetic difference between the two systems: the presence versus absence of aromatic stabilization energy, a global electronic effect that dictates the resistance to non-planar distortions.\n**Verdict: Incorrect.**\n\n**D. $k$ should be smaller in benzene because delocalization allows charge to redistribute upon out-of-plane bending, softening the out-of-plane mode relative to a localized triene.**\nThis option incorrectly claims $k$ is smaller in benzene. The reasoning is flawed and presents the opposite of the correct physical picture. Delocalization creates an exceptionally stable planar system. This stability does not \"soften\" the molecule to out-of-plane distortions; it makes the molecule \"stiffer\" with respect to such distortions because they are energetically very unfavorable.\n**Verdict: Incorrect.**\n\n**E. $k$ should be identical because both molecules have six-membered rings, and ring size dominates the out-of-plane stiffness irrespective of electronic structure.**\nThis option incorrectly claims the force constants are identical. The reasoning that ring size is the dominant factor and that electronic structure is irrelevant is fundamentally wrong. The out-of-plane potential is almost entirely a consequence of the electronic structure of the $\\pi$ system, which is the primary point of difference between the two molecules.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2459803"}, {"introduction": "The final step in mastering improper torsions is to learn how they are parameterized in practice. This hands-on coding exercise simulates a real-world task in force field development: fitting parameters of the harmonic potential, $k$ and $\\chi_0$, to energy data from high-level quantum mechanical calculations. By contrasting the planar nitrogen in pyrrole with the pyramidal nitrogen in pyrrolidine, you will translate raw numerical data into a refined molecular mechanics model [@problem_id:2459809].", "problem": "You are asked to construct a program that parametrizes the harmonic improper torsion potential for the out-of-plane bending at a nitrogen center for two chemically distinct cases: a planar, aromatic nitrogen in pyrrole and a pyramidal, saturated nitrogen in pyrrolidine. The improper torsion potential is modeled as a one-dimensional harmonic function of the signed improper dihedral angle, defined for a central atom and three substituents. The model is\n$$\nE(\\chi) = \\tfrac{1}{2} k \\left(\\chi - \\chi_0\\right)^2,\n$$\nwhere $E(\\chi)$ is the energy in kilojoules per mole, $\\chi$ is the improper dihedral angle in radians, $k$ is the force constant in kilojoules per mole per square radian, and $\\chi_0$ is the equilibrium improper angle in radians. Given a set of sampled angles $\\{\\chi_i\\}$ and corresponding energies $\\{E_i\\}$ for each case, determine the parameters $k$ and $\\chi_0$ that minimize the sum of squared residuals $\\sum_i \\left[E_i - \\tfrac{1}{2} k(\\chi_i - \\chi_0)^2\\right]^2$. Then, for each fitted model, evaluate the barrier at the planar geometry as $E(0) = \\tfrac{1}{2}k\\chi_0^2$ in kilojoules per mole.\n\nAll angles must be treated in radians and all energies must be treated in kilojoules per mole. The final numerical answers must be returned as floating-point numbers.\n\nUse the following test suite of cases, each consisting of a list of angles $\\{\\chi_i\\}$ in radians and the corresponding energies $\\{E_i\\}$ in kilojoules per mole:\n\n- Case 1 (planar pyrrole-like, symmetric about $0$): angles $\\{-0.35,-0.20,0.00,0.20,0.35\\}$ and energies $\\{18.375,6.000,0.000,6.000,18.375\\}$.\n- Case 2 (pyramidal pyrrolidine-like, minimum near $0.60$): angles $\\{0.00,0.20,0.60,1.00,1.20\\}$ and energies $\\{18.000,8.000,0.000,8.000,18.000\\}$.\n- Case 3 (minimal three-point set, weakly pyramidal): angles $\\{-0.10,0.20,0.50\\}$ and energies $\\{1.000,0.250,4.000\\}$.\n\nYour program must compute, for each case, the tuple $\\left[k,\\chi_0,E(0)\\right]$ with $k$ in kilojoules per mole per square radian, $\\chi_0$ in radians, and $E(0)$ in kilojoules per mole. The program must produce a single line of output containing the results as a comma-separated list of lists, with each inner list ordered as $\\left[k,\\chi_0,E(0)\\right]$, and with all numbers rounded to six decimal places, for example:\n\"[[k1,chi01,E0_1],[k2,chi02,E0_2],[k3,chi03,E0_3]]\".", "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- **Model for potential energy:** $E(\\chi) = \\tfrac{1}{2} k \\left(\\chi - \\chi_0\\right)^2$, where $E$ is energy in kJ/mol and $\\chi$ is the improper dihedral angle in radians.\n- **Parameters to determine:** Force constant $k$ (in kJ/mol/rad$^2$) and equilibrium angle $\\chi_0$ (in radians).\n- **Objective function:** Minimize the sum of squared residuals, $SSR = \\sum_i \\left[E_i - \\tfrac{1}{2} k(\\chi_i - \\chi_0)^2\\right]^2$, given discrete data points $(\\chi_i, E_i)$.\n- **Derived quantity:** Calculate the energy barrier at the planar geometry, $E(0) = \\tfrac{1}{2}k\\chi_0^2$.\n- **Data Sets:**\n    - **Case 1:** angles $\\{-0.35, -0.20, 0.00, 0.20, 0.35\\}$ radians; energies $\\{18.375, 6.000, 0.000, 6.000, 18.375\\}$ kJ/mol.\n    - **Case 2:** angles $\\{0.00, 0.20, 0.60, 1.00, 1.20\\}$ radians; energies $\\{18.000, 8.000, 0.000, 8.000, 18.000\\}$ kJ/mol.\n    - **Case 3:** angles $\\{-0.10, 0.20, 0.50\\}$ radians; energies $\\{1.000, 0.250, 4.000\\}$ kJ/mol.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is assessed against the required criteria.\n- **Scientifically Grounded:** The problem is valid. The harmonic potential is a fundamental model in physics and chemistry used to describe oscillations around an equilibrium, such as out-of-plane bending vibrations. The concept of improper torsions to describe planarity at an atomic center is a standard technique in molecular mechanics.\n- **Well-Posed:** The problem is valid. It is a well-defined parameter estimation problem (non-linear regression). For each case, the number of data points ($5$, $5$, and $3$) is greater than or equal to the number of parameters to fit ($2$), so the system is not underdetermined.\n- **Objective:** The problem is valid. It is formulated with precise mathematical definitions and objective numerical data, free of any subjective or ambiguous language.\n\nAll other validation checks are passed. The problem is free of scientific flaws, contradictions, or unstated assumptions.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A solution will be constructed.\n\n**Principle-Based Design of the Solution**\nThe task is to determine the parameters $k$ and $\\chi_0$ of the harmonic potential energy model $E(\\chi) = \\tfrac{1}{2} k \\left(\\chi - \\chi_0\\right)^2$ by fitting it to provided energy-versus-angle data. This is a classic non-linear least-squares problem. The goal is to find the parameter values that minimize the sum of squared residuals ($SSR$) between the model's predictions and the given energy values:\n$$\n\\min_{k, \\chi_0} SSR(k, \\chi_0) = \\sum_i \\left( E_i - \\frac{1}{2} k (\\chi_i - \\chi_0)^2 \\right)^2\n$$\nA robust method for solving such problems is the Levenberg-Marquardt algorithm, which is available in the `scipy.optimize.least_squares` library function. This function iteratively finds the minimum of a sum of squares of non-linear functions. It requires as input a function that returns a vector of the residuals, $r_i$, for a given set of parameters. The residual for the $i$-th data point is:\n$$\nr_i(k, \\chi_0) = E_i - \\frac{1}{2} k (\\chi_i - \\chi_0)^2\n$$\nThe success of non-linear optimization is often sensitive to the initial guess for the parameters. A physically motivated initial guess improves the likelihood of finding the global minimum. We can devise a strategy for this:\n$1$. The equilibrium angle $\\chi_0$ corresponds to the minimum of the potential energy curve. A reasonable initial guess for $\\chi_0$ is the angle value in the dataset that corresponds to the lowest energy, $\\chi_{\\text{guess},0} = \\chi_j$ where $E_j = \\min(\\{E_i\\})$.\n$2$. With an estimate for $\\chi_0$, the force constant $k$ can be estimated from the model equation using another data point. To ensure a stable estimate, it is best to use a point far from the minimum. We select the data point $(\\chi_f, E_f)$ where $\\chi_f$ is the angle furthest from $\\chi_{\\text{guess},0}$. The initial guess for $k$ is then calculated as:\n$$\nk_{\\text{guess}} = \\frac{2 E_f}{(\\chi_f - \\chi_{\\text{guess},0})^2}\n$$\nA constraint must be imposed on the force constant $k$, as it must be positive ($k > 0$) for the potential to describe a stable minimum.\n\nThe algorithm is as follows for each test case:\n$1$. Prepare the angle and energy data as numerical arrays.\n$2$. Generate an intelligent initial guess for $(k, \\chi_0)$ using the strategy outlined above.\n$3$. Invoke `scipy.optimize.least_squares`, providing the residual function, the initial guess, the data, and bounds to enforce $k \\ge 0$.\n$4$. Extract the optimized parameters $k$ and $\\chi_0$ from the solver's result.\n$5$. Calculate the final required quantity, the planar barrier height $E(0) = \\frac{1}{2}k\\chi_0^2$.\n\nIt is noteworthy that the provided data for all three cases are \"ideal\" in that they perfectly fit the harmonic model for a specific set of parameters, leading to a minimum $SSR$ of $0$. While a numerical solver is a general approach, for these specific cases, an analytical solution also exists. Our robust numerical strategy will correctly identify these exact solutions.\n\nThe final program will systematically apply this procedure to each test case, collect the results $\\left[k, \\chi_0, E(0)\\right]$, and format them into the specified output string. All numbers will be rounded to six decimal places as required.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\nimport sys\n\n# Set a higher recursion limit for optimization algorithms if needed, though not expected for this problem.\nsys.setrecursionlimit(2000)\n\ndef solve():\n    \"\"\"\n    Solves for the parameters of a harmonic improper torsion potential for three test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case 1 (planar pyrrole-like)\",\n            \"angles\": np.array([-0.35, -0.20, 0.00, 0.20, 0.35]),\n            \"energies\": np.array([18.375, 6.000, 0.000, 6.000, 18.375]),\n        },\n        {\n            \"name\": \"Case 2 (pyramidal pyrrolidine-like)\",\n            \"angles\": np.array([0.00, 0.20, 0.60, 1.00, 1.20]),\n            \"energies\": np.array([18.000, 8.000, 0.000, 8.000, 18.000]),\n        },\n        {\n            \"name\": \"Case 3 (minimal three-point set, weakly pyramidal)\",\n            \"angles\": np.array([-0.10, 0.20, 0.50]),\n            \"energies\": np.array([1.000, 0.250, 4.000]),\n        },\n    ]\n\n    def residuals_function(params, angles, energies):\n        \"\"\"\n        Calculates the residuals for the harmonic potential model.\n        params: A list or tuple [k, chi0].\n        angles: Numpy array of angles (chi).\n        energies: Numpy array of corresponding energies (E).\n        Returns a numpy array of residuals (E_data - E_model).\n        \"\"\"\n        k, chi0 = params\n        model_energies = 0.5 * k * (angles - chi0)**2\n        return energies - model_energies\n\n    results = []\n    for case in test_cases:\n        angles = case[\"angles\"]\n        energies = case[\"energies\"]\n\n        # 1. Generate an intelligent initial guess.\n        # Guess chi0 is the angle corresponding to the minimum energy.\n        min_energy_idx = np.argmin(energies)\n        chi0_guess = angles[min_energy_idx]\n\n        # Guess k using the point furthest from chi0_guess for stability.\n        furthest_point_idx = np.argmax(np.abs(angles - chi0_guess))\n        chi_furthest = angles[furthest_point_idx]\n        energy_furthest = energies[furthest_point_idx]\n        \n        # Avoid division by zero if the furthest point happens to be the minimum.\n        # This is unlikely with typical potential scan data.\n        denominator = (chi_furthest - chi0_guess)**2\n        if np.isclose(denominator, 0):\n            # Fallback k_guess if denominator is zero\n            k_guess = 1.0 \n        else:\n            k_guess = 2 * energy_furthest / denominator\n\n        initial_guess = [k_guess, chi0_guess]\n\n        # 2. Perform the non-linear least squares optimization.\n        # Bounds: k must be non-negative. chi0 is unconstrained.\n        bounds = ([0, -np.inf], [np.inf, np.inf])\n        \n        # Levenberg-Marquardt is the default method and is suitable here.\n        opt_result = least_squares(\n            residuals_function,\n            initial_guess,\n            args=(angles, energies),\n            bounds=bounds\n        )\n\n        # 3. Extract results and calculate E(0).\n        k_fit, chi0_fit = opt_result.x\n        e0_fit = 0.5 * k_fit * chi0_fit**2\n\n        results.append([k_fit, chi0_fit, e0_fit])\n\n    # 4. Format the output as specified.\n    formatted_results = []\n    for res in results:\n        # Format each number to six decimal places.\n        formatted_res_str = f\"[{res[0]:.6f},{res[1]:.6f},{res[2]:.6f}]\"\n        formatted_results.append(formatted_res_str)\n\n    print(f\"[{','.join(formatted_results)}]\")\n\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "2459809"}]}