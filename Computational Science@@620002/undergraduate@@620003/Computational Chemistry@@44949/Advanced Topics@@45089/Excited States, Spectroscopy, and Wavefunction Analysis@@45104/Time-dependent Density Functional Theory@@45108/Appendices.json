{"hands_on_practices": [{"introduction": "Time-Dependent DFT calculations build upon a ground-state reference, and their validity hinges on the stability of this reference. This first practice explores a critical diagnostic tool: the sign of the calculated excitation energies. A seemingly unphysical negative excitation energy is not a bug, but rather a crucial indicator that the chosen ground-state formalism may be inappropriate for the system, pointing towards a lower-energy electronic structure. [@problem_id:1417491]", "problem": "An undergraduate researcher is investigating the electronic properties of a molecule that is known to have significant diradical character. They begin by performing a standard ground-state calculation using Density Functional Theory (DFT) with a spin-restricted formalism, which assumes all electrons are paired in orbitals, yielding a closed-shell singlet state ($S_0$). To probe the excited states, they then run a Time-Dependent Density Functional Theory (TD-DFT) calculation using this spin-restricted $S_0$ state as the reference. The output of the TD-DFT calculation reports that the lowest-lying triplet state ($T_1$) has an excitation energy of $-0.15$ Hartrees.\n\nBased on this seemingly unphysical result of a negative excitation energy, what is the most likely conclusion about the initial ground-state DFT calculation?\n\nA. The numerical integration grid used in the DFT calculation was not dense enough, leading to a spurious, non-physical result that will disappear upon re-calculation with a finer grid.\n\nB. The chosen basis set was inadequate for describing the triplet state, causing an artificial lowering of its energy below the ground state. A much larger basis set is required.\n\nC. The spin-restricted formalism was an incorrect assumption for this molecule. The true ground state has a lower energy than the calculated spin-restricted singlet, and this lower-energy state likely has triplet or open-shell character.\n\nD. The TD-DFT method is fundamentally incapable of describing triplet states for any molecular system, and the negative energy is a common artifact of this theoretical limitation.", "solution": "The core of this problem lies in understanding what an excitation energy represents and how Time-Dependent Density Functional Theory (TD-DFT) calculates it.\n\n1.  **Definition of Excitation Energy**: In quantum mechanics, an excitation energy ($\\Delta E$) is the energy difference between an excited state and the ground state. By definition, the ground state is the lowest energy state of a system. Therefore, for a physically real process, the excitation energy must be positive:\n    $$\n    \\Delta E = E_{\\text{excited}} - E_{\\text{ground}} \\ge 0\n    $$\n    A negative excitation energy would imply that the \"excited\" state is actually lower in energy than the state which was presumed to be the \"ground\" state.\n\n2.  **Context of TD-DFT**: TD-DFT is a method for calculating excited state properties. It operates on a reference state, which is typically the ground state calculated using standard Density Functional Theory (DFT). The energies of the excited states are then calculated *relative* to this DFT reference state. In this problem, the reference state is a spin-restricted, closed-shell singlet, which we can denote as $E(S_0, \\text{restricted})$.\n\n3.  **Analyzing the Result**: The TD-DFT calculation yielded a negative excitation energy for the lowest triplet state ($T_1$). Let's call this energy $\\Delta E(T_1)$. According to the principles of TD-DFT, this means:\n    $$\n    \\Delta E(T_1) = E(T_1) - E(S_0, \\text{restricted}) < 0\n    $$\n    This can be rearranged to:\n    $$\n    E(T_1) < E(S_0, \\text{restricted})\n    $$\n    This inequality shows that the energy of the triplet state ($T_1$) is calculated to be lower than the energy of the spin-restricted singlet state ($S_0$) that was used as the reference.\n\n4.  **Physical Interpretation**: A negative excitation energy in TD-DFT is not actually \"unphysical\". Instead, it is a diagnostic tool that reveals an instability in the reference DFT calculation. It indicates that the reference state, $E(S_0, \\text{restricted})$, is *not* the true ground state of the system. The calculation was forced into a higher-energy solution by the constraint of the spin-restricted formalism (forcing all electrons to be paired). There exists another electronic configuration—in this case, one with triplet character—that has a lower energy. This is a common occurrence for molecules with diradical character, where the lowest-energy singlet state is often an open-shell singlet, and the triplet state can be very close to, or even below, the energy of an improperly described closed-shell singlet. The negative TD-DFT excitation energy is a signature of this so-called \"triplet instability\" of the reference state.\n\n5.  **Evaluating the Options**:\n    *   **A. Numerical integration grid:** While a poor grid can cause numerical noise and convergence issues, it is not the fundamental reason for a qualitatively incorrect result like a negative excitation energy. This specific artifact is a well-known indicator of a reference state stability problem, not a simple numerical precision issue.\n    *   **B. Basis set inadequacy:** An inadequate basis set can lead to inaccurate energies for all states. However, like the grid issue, it does not typically manifest as a negative excitation energy unless it exacerbates an underlying stability problem. The primary cause is the nature of the reference wavefunction itself.\n    *   **C. Incorrect spin-restricted formalism:** This aligns perfectly with our analysis. The negative excitation energy is a direct consequence of the spin-restricted singlet reference state being higher in energy than the triplet state. This means the assumption that the ground state is a closed-shell singlet was incorrect, and the true ground state is better described by a different electronic configuration (e.g., an open-shell or unrestricted one).\n    *   **D. TD-DFT incapable of describing triplets:** This statement is too strong and incorrect. TD-DFT, especially within the adiabatic approximation used in most codes, can and does calculate triplet excitation energies. The issue here is not a general failure of TD-DFT but rather a specific issue with the *input reference state* provided to the TD-DFT calculation. The method is correctly diagnosing the flawed reference.\n\nTherefore, the most accurate conclusion is that the spin-restricted DFT calculation failed to find the true ground state of the molecule.", "answer": "$$\\boxed{C}$$", "id": "1417491"}, {"introduction": "One of the most powerful applications of TD-DFT is the prediction of photophysical properties for fluorescent and phosphorescent molecules. This exercise demonstrates the standard computational protocol for calculating the Stokes shift, a key parameter that quantifies the energy difference between light absorption and emission. By combining ground-state and excited-state geometry optimizations with single-point energy calculations, you will model the complete photoexcitation and relaxation cycle. [@problem_id:1417512]", "problem": "A computational chemist is investigating the photophysical properties of a newly synthesized organic molecule intended for use in Organic Light-Emitting Diodes (OLEDs). The goal is to predict the Stokes shift, which is the difference in energy between the maximum of the absorption and emission spectra. This is achieved by modeling the molecule's behavior upon photoexcitation using quantum chemical methods.\n\nThe computational protocol involves the following steps, based on Density Functional Theory (DFT) for the ground state and Time-Dependent Density Functional Theory (TD-DFT) for the excited state:\n1.  The geometry of the molecule is optimized in its electronic ground state ($S_0$), yielding the equilibrium geometry $R_0$.\n2.  The geometry is then optimized in its first singlet excited state ($S_1$), yielding the relaxed excited-state equilibrium geometry $R_1$.\n\nA series of single-point energy calculations are then performed. The total electronic energies from these calculations are provided below. Note that $E(S_i, R_j)$ denotes the energy of the electronic state $S_i$ calculated at the fixed nuclear geometry $R_j$.\n\n-   Energy of the ground state at the optimized ground state geometry, $E(S_0, R_0) = -450.1234$ Hartrees.\n-   Energy of the first excited state at the optimized ground state geometry, $E(S_1, R_0) = -449.9948$ Hartrees.\n-   Energy of the first excited state at the optimized excited state geometry, $E(S_1, R_1) = -449.9985$ Hartrees.\n-   Energy of the ground state at the optimized excited state geometry, $E(S_0, R_1) = -450.1197$ Hartrees.\n\nUsing the provided data and the conversion factor 1 Hartree = 27.2114 eV, calculate the Stokes shift for this molecule. Express your answer in electronvolts (eV), rounded to three significant figures.", "solution": "The Stokes shift is defined as the difference between the vertical absorption energy (from $S_{0}$ at $R_{0}$ to $S_{1}$ at $R_{0}$) and the vertical emission energy (from $S_{1}$ at $R_{1}$ to $S_{0}$ at $R_{1}$) according to the Franck–Condon principle.\n\nDefine the absorption energy:\n$$\nE_{\\text{abs}}=\\left[E(S_{1},R_{0})-E(S_{0},R_{0})\\right].\n$$\nSubstitute the given values (in Hartrees):\n$$\nE_{\\text{abs}} = \\left[-449.9948 - (-450.1234)\\right] = 0.1286.\n$$\n\nDefine the emission energy:\n$$\nE_{\\text{em}}=\\left[E(S_{1},R_{1})-E(S_{0},R_{1})\\right].\n$$\nSubstitute the given values (in Hartrees):\n$$\nE_{\\text{em}} = \\left[-449.9985 - (-450.1197)\\right] = 0.1212.\n$$\n\nThe Stokes shift in energy units is then:\n$$\n\\Delta E_{\\text{Stokes}} = E_{\\text{abs}} - E_{\\text{em}} = 0.1286 - 0.1212 = 0.0074 \\text{ Hartree}.\n$$\n\nConvert Hartrees to electronvolts using $1 \\text{ Hartree} = 27.2114 \\text{ eV}$:\n$$\n\\Delta E_{\\text{Stokes}} (\\text{eV}) = 0.0074 \\times 27.2114 = 0.20136436 \\text{ eV}.\n$$\n\nRounded to three significant figures:\n$$\n\\Delta E_{\\text{Stokes}} = 0.201 \\text{ eV}.\n$$", "answer": "$$\\boxed{0.201}$$", "id": "1417512"}, {"introduction": "While powerful, TD-DFT with common approximate functionals has well-known limitations, and understanding them is key to being a proficient computational chemist. This practice confronts one of its most famous failures: the incorrect description of long-range charge-transfer (CT) excitations. You will use first-principles reasoning to derive both the physically correct CT energy and the erroneous prediction from a typical semi-local functional, thereby revealing the origin of this critical systematic error. [@problem_id:2466214]", "problem": "You are asked to write a complete, runnable program that demonstrates, within a minimal but scientifically grounded model, how Time-Dependent Density Functional Theory (TD-DFT) using a standard Generalized Gradient Approximation (GGA) functional can wrongly predict a spuriously low-energy charge-transfer excitation in a spatially separated donor–acceptor pair. Your program must implement the following logic from first principles.\n\nBegin from the fundamental definitions of ionization potential and electron affinity in density functional theory (DFT), and from the electrostatic interaction of separated charges. Use these principles to derive an expression for the lowest donor-to-acceptor charge-transfer excitation energy at large separation. Then, using linear-response TD-DFT and the fact that for spatially nonoverlapping orbitals the adiabatic semilocal Hartree–exchange–correlation kernel yields vanishing coupling, derive the corresponding prediction made by a semilocal GGA functional. Finally, connect the Kohn–Sham orbital energy difference to the fundamental gap by including the derivative discontinuity. Do not use or quote any pre-existing shortcut formulas in your derivation; instead, reason from the following foundational bases only:\n- Fundamental definitions: the ionization potential $I$ and electron affinity $A$ defined via total energy differences, and the electrostatic interaction energy of two unit charges separated by a distance $R$.\n- Linear-response theory core ideas: that the excitation energy arises from a response pole determined by a noninteracting transition energy and a coupling term, and that for charge-transfer between spatially separated fragments with negligible orbital overlap, a local and adiabatic kernel provides negligible long-range coupling.\n- The well-tested conceptual fact that the many-body fundamental gap is related to the Kohn–Sham gap by the derivative discontinuity.\n\nImplement a minimal two-fragment model with the following parameters for each test case:\n- Donor ionization potential $I_D$ in Hartree.\n- Acceptor electron affinity $A_A$ in Hartree.\n- Center-to-center separation $R$ in bohr.\n- An effective positive derivative-discontinuity parameter $\\Delta_{\\mathrm{xc}}$ in Hartree that captures the gap underestimation characteristic of a semilocal GGA functional.\n\nFor each test case, compute:\n1. The physically motivated large-separation charge-transfer excitation energy, based on the above principles, expressed in Hartree and denoted here as $E_{\\mathrm{true}}$.\n2. The adiabatic semilocal GGA TD-DFT prediction for the same charge-transfer excitation, expressed in Hartree and denoted here as $E_{\\mathrm{GGA}}$.\n3. The signed error $\\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}}$ in Hartree.\n4. A boolean flag that is true if and only if the GGA prediction is spuriously low, defined by the strict inequality $E_{\\mathrm{GGA}} < E_{\\mathrm{true}}$.\n\nYour program must use the following fixed test suite of parameter tuples $(I_D,A_A,R,\\Delta_{\\mathrm{xc}})$, in atomic units (Hartree for energies, bohr for distances):\n- Test 1 (general separated pair): $(0.30, 0.08, 30.0, 0.12)$.\n- Test 2 (very large separation): $(0.30, 0.08, 200.0, 0.12)$.\n- Test 3 (small fundamental gap leading to near-zero GGA excitation): $(0.20, 0.08, 25.0, 0.12)$.\n- Test 4 (numerical balance where the underestimation equals the missing electrostatics at this $R$): $(0.25, 0.05, 8.\\overline{3})$, where $8.\\overline{3}$ denotes $25/3$ in bohr.\n\nAll energies must be expressed in Hartree and rounded to six decimal places. For each test case, your program must output the four values $E_{\\mathrm{true}}$, $E_{\\mathrm{GGA}}$, $\\Delta E$, and the boolean flag, in that order. Aggregate the results for all test cases into a single flat list. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,...]\").\n\nAngle units are not involved. No external input is permitted; the program must be fully self-contained and produce the required single-line output upon execution.", "solution": "The problem statement is scientifically grounded, well-posed, and contains all necessary information to derive a unique solution. It describes a well-known failure mode of common density functional approximations. The problem is therefore deemed valid, and a solution will be constructed based on the provided first principles.\n\nWe begin by deriving the expression for the physically correct charge-transfer ($CT$) excitation energy at large separation, denoted $E_{\\mathrm{true}}$. A $CT$ excitation involves moving an electron from a donor molecule, $D$, to an acceptor molecule, $A$, separated by a distance $R$. This process can be represented as $D^0A^0 \\rightarrow D^+A^-$. The energy of this excitation, $\\omega_{CT}$, is the difference in the total energies of the final and initial states:\n$$ \\omega_{CT} = E(D^+A^-) - E(D^0A^0) $$\nIn the limit of large separation $R$, the energy of a combined system can be approximated as the sum of the energies of its non-interacting constituent fragments plus their classical electrostatic interaction energy. For the initial neutral state, this is:\n$$ E(D^0A^0) \\approx E(D^0) + E(A^0) $$\nFor the final ionic state, the energy includes the electrostatic attraction between the newly formed ions:\n$$ E(D^+A^-) \\approx E(D^+) + E(A^-) + E_{\\mathrm{int}} $$\nHere, $E(X)$ represents the total energy of species $X$. The interaction energy, $E_{\\mathrm{int}}$, between a point charge of $+1e$ on $D^+$ and $-1e$ on $A^-$ is given by Coulomb's law. In atomic units, where energy is in Hartree and distance is in bohr, this is:\n$$ E_{\\mathrm{int}} = -\\frac{1}{R} $$\nBy substituting these expressions into the equation for $\\omega_{CT}$, we obtain:\n$$ \\omega_{CT} \\approx \\left( E(D^+) + E(A^-) - \\frac{1}{R} \\right) - \\left( E(D^0) + E(A^0) \\right) $$\nRearranging the terms to group them by species yields:\n$$ \\omega_{CT} \\approx \\left( E(D^+) - E(D^0) \\right) + \\left( E(A^-) - E(A^0) \\right) - \\frac{1}{R} $$\nThe terms in parentheses correspond to fundamental definitions. The ionization potential of the donor, $I_D$, is the energy required to remove an electron:\n$$ I_D = E(D^+) - E(D^0) $$\nThe electron affinity of the acceptor, $A_A$, is the energy released upon capturing an electron, defined as:\n$$ A_A = E(A^0) - E(A^-) $$\nFrom this definition, it follows that $E(A^-) - E(A^0) = -A_A$. By substituting these definitions for $I_D$ and $A_A$, we arrive at the expression for the true large-separation charge-transfer excitation energy:\n$$ E_{\\mathrm{true}} = I_D - A_A - \\frac{1}{R} $$\n\nNext, we derive the corresponding prediction from adiabatic semilocal Time-Dependent Density Functional Theory ($TD-DFT$), denoted $E_{\\mathrm{GGA}}$. Within linear-response $TD-DFT$, the excitation energies $\\omega$ are obtained as the eigenvalues of a matrix equation. For a single excitation from an occupied Kohn-Sham ($KS$) orbital $\\phi_i$ to a virtual $KS$ orbital $\\phi_a$, the excitation energy in the adiabatic approximation is given by:\n$$ \\omega_{ia} = \\varepsilon_a - \\varepsilon_i + K_{ia,ia} $$\nwhere $\\varepsilon_i$ and $\\varepsilon_a$ are the energies of the $KS$ orbitals, and $K_{ia,ia}$ is the coupling matrix element. This element depends on the Hartree-exchange-correlation ($HXC$) kernel, $f_{HXC}$:\n$$ K_{ia,ia} = \\iint \\phi_i^*(\\mathbf{r})\\phi_a(\\mathbf{r}) f_{HXC}(\\mathbf{r}, \\mathbf{r}') \\phi_a^*(\\mathbf{r}')\\phi_i(\\mathbf{r}') d\\mathbf{r} d\\mathbf{r}' $$\nFor the $CT$ excitation under consideration, the occupied orbital $\\phi_i$ is the highest occupied molecular orbital of the donor ($HOMO_D$) and the virtual orbital $\\phi_a$ is the lowest unoccupied molecular orbital of the acceptor ($LUMO_A$). At large separation $R$, these orbitals are spatially isolated, and their overlap product, $\\phi_i(\\mathbf{r})\\phi_a(\\mathbf{r})$, is negligible for all $\\mathbf{r}$.\nFor a semilocal functional, such as a Generalized Gradient Approximation ($GGA$), the kernel $f_{HXC}^{GGA}(\\mathbf{r}, \\mathbf{r}')$ is effectively local, meaning it vanishes rapidly as the distance $|\\mathbf{r} - \\mathbf{r}'|$ increases. The combination of a local kernel and vanishing orbital overlap causes the coupling integral $K_{ia,ia}$ to become zero:\n$$ K_{ia,ia}^{GGA} \\approx 0 $$\nConsequently, the $TD-GGA$ excitation energy spuriously reduces to the simple difference in the energies of the $KS$ orbitals involved:\n$$ E_{\\mathrm{GGA}} = \\omega_{CT}^{GGA} \\approx \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D} $$\nTo make this expression useful, we must relate this $KS$ orbital energy gap to the physical quantities $I_D$ and $A_A$. The fundamental many-body gap of the combined $D-A$ system is $E_{gap} = I_D - A_A$. The corresponding $KS$ gap is $\\varepsilon_{gap}^{KS} = \\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}$. For an exact functional, these quantities are related via the derivative discontinuity of the exchange-correlation potential, $\\Delta_{xc}$:\n$$ E_{gap} = \\varepsilon_{gap}^{KS} + \\Delta_{xc} \\implies I_D - A_A = (\\varepsilon_{LUMO,A} - \\varepsilon_{HOMO,D}) + \\Delta_{xc} $$\nApproximate functionals like $GGA$ are known to suffer from a systematic error that effectively corresponds to a missing derivative discontinuity. The problem provides an effective parameter, $\\Delta_{\\mathrm{xc}} > 0$, to model this deficiency. Rearranging the equation for the $KS$ gap as predicted within a $GGA$ framework gives:\n$$ \\varepsilon_{LUMO,A}^{GGA} - \\varepsilon_{HOMO,D}^{GGA} = (I_D - A_A) - \\Delta_{xc} $$\nThis provides the final expression for the $TD-GGA$ charge-transfer excitation energy:\n$$ E_{\\mathrm{GGA}} = I_D - A_A - \\Delta_{xc} $$\nThis result incorrectly shows the excitation energy approaching a constant value at large $R$, completely missing the correct $-1/R$ asymptotic behavior.\n\nFinally, we compute the signed error $\\Delta E$ and establish the condition for a spuriously low prediction. The error is the difference between the $GGA$ value and the true value:\n$$ \\Delta E = E_{\\mathrm{GGA}} - E_{\\mathrm{true}} = (I_D - A_A - \\Delta_{\\mathrm{xc}}) - \\left(I_D - A_A - \\frac{1}{R}\\right) $$\n$$ \\Delta E = \\frac{1}{R} - \\Delta_{\\mathrm{xc}} $$\nThe $GGA$ prediction is spuriously low if and only if $E_{\\mathrm{GGA}} < E_{\\mathrm{true}}$, which implies $\\Delta E < 0$. This gives the condition:\n$$ \\frac{1}{R} - \\Delta_{\\mathrm{xc}} < 0 \\implies \\frac{1}{R} < \\Delta_{\\mathrm{xc}} $$\nAs separation $R$ increases, $1/R$ decreases. For any system with a non-zero gap-underestimation error ($\\Delta_{\\mathrm{xc}} > 0$), there exists a separation beyond which this inequality holds, demonstrating the fundamental failure of adiabatic semilocal functionals for describing long-range charge transfer. The following program implements these derived formulas.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the true and TD-GGA charge-transfer excitation energies for a\n    series of donor-acceptor pairs to demonstrate the failure of semilocal DFT.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each tuple is (I_D, A_A, R, delta_xc) in atomic units.\n    test_cases = [\n        # Test 1: General separated pair\n        (0.30, 0.08, 30.0, 0.12),\n        # Test 2: Very large separation\n        (0.30, 0.08, 200.0, 0.12),\n        # Test 3: Small fundamental gap\n        (0.20, 0.08, 25.0, 0.12),\n        # Test 4: Numerical balance point\n        (0.25, 0.05, 25.0/3.0, 0.12),\n    ]\n\n    results = []\n    for case in test_cases:\n        I_D, A_A, R, delta_xc = case\n        \n        # 1. Calculate the physically motivated charge-transfer energy, E_true.\n        # This is derived from E_true = I_D - A_A - 1/R.\n        E_true = I_D - A_A - 1.0/R\n        \n        # 2. Calculate the adiabatic semilocal GGA TD-DFT prediction, E_GGA.\n        # This is derived from E_GGA = I_D - A_A - delta_xc.\n        E_gga = I_D - A_A - delta_xc\n        \n        # 3. Calculate the signed error, delta_E.\n        # This is delta_E = E_GGA - E_true, which simplifies to 1/R - delta_xc.\n        delta_E = 1.0/R - delta_xc\n\n        # 4. Determine if the GGA prediction is spuriously low.\n        # This is true if E_GGA < E_true.\n        is_spurious = E_gga < E_true\n\n        # Append the four required results for this test case.\n        # Energies are rounded to six decimal places.\n        results.append(np.round(E_true, 6))\n        results.append(np.round(E_gga, 6))\n        results.append(np.round(delta_E, 6))\n        results.append(is_spurious)\n        \n    # Final print statement in the exact required format.\n    # The boolean `True`/`False` is converted to string \"True\"/\"False\".\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2466214"}]}