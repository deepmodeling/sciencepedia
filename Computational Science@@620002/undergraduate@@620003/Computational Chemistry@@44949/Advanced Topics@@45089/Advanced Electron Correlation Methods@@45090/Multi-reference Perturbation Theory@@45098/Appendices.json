{"hands_on_practices": [{"introduction": "A common point of confusion when learning multi-reference methods is understanding why a perturbative correction is necessary if the initial CASSCF calculation yields a wavefunction that appears to be simple, i.e., dominated by a single electronic configuration. This exercise challenges that misconception head-on, forcing a confrontation with the fundamental distinction between static and dynamic electron correlation. By working through this problem [@problem_id:2459116], you will solidify your understanding of why methods like CASPT2 and NEVPT2 are essential for achieving quantitative accuracy, even when the multi-reference character of a state is weak.", "problem": "You perform a Complete Active Space Self-Consistent Field (CASSCF) calculation with an active space of $\\mathrm{CAS}(8,8)$ on a conjugated polyene. The CASSCF ground-state wavefunction is dominated by a single configuration whose squared amplitude is $c_0^2=0.95$. A colleague argues that, because of the large $c_0^2$, applying Complete Active Space Second-Order Perturbation Theory (CASPT2) or $N$-Electron Valence State Second-Order Perturbation Theory (NEVPT2) is unnecessary for energies and properties. Which statement(s) provide the most appropriate counterargument? Select all that apply.\n\nA. Even with $c_0^2=0.95$, CASSCF treats primarily static (near-degeneracy) correlation within the active space and misses most dynamic correlation from excitations outside the active space; a second-order treatment such as CASPT2 or NEVPT2 is needed to recover this missing correlation and improve quantitative energies and properties.\n\nB. A large $c_0^2$ means dynamic correlation is negligible, so applying CASPT2 or NEVPT2 would double-count correlation and typically worsen results.\n\nC. CASPT2 is only useful when $c_0^2<0.5$; for $c_0^2\\ge 0.5$ it is generally numerically unstable due to intruder states, so it should be avoided.\n\nD. Even if the ground state appears single-configuration-like, differential dynamic correlation between states (e.g., ground versus excited states or along a reaction coordinate) can be substantial; adding CASPT2 or NEVPT2 reduces bias in relative energies such as excitation energies and barrier heights.\n\nE. With a sufficiently large one-electron basis set, CASSCF includes both static and dynamic correlation, so perturbative corrections like CASPT2 or NEVPT2 are unnecessary regardless of $c_0^2$.", "solution": "The problem statement is subjected to rigorous validation.\n\n**Step 1: Extract Givens**\n- Method: Complete Active Space Self-Consistent Field (CASSCF).\n- System: A conjugated polyene.\n- Active Space: $\\mathrm{CAS}(8,8)$, which denotes $8$ electrons in $8$ active orbitals.\n- Result: The ground-state wavefunction from CASSCF is dominated by a single configuration.\n- Data: The squared amplitude of the dominant configuration is $c_0^2 = 0.95$.\n- Premise to Evaluate: A colleague argues that because $c_0^2$ is large, subsequent Complete Active Space Second-Order Perturbation Theory (CASPT2) or $N$-Electron Valence State Second-Order Perturbation Theory (NEVPT2) calculations are unnecessary.\n- Question: Identify the most appropriate counterargument(s) to this claim.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded. It presents a standard scenario in multi-reference computational chemistry. The concepts of CASSCF, CASPT2, NEVPT2, active space, static and dynamic correlation, and configuration amplitudes are fundamental to the field. The given value $c_0^2=0.95$ is physically realistic and indicates a wavefunction with weak multi-reference character. The colleague's argument represents a common but incorrect simplification, making it a valid premise for a conceptual question. The problem is well-posed, asking for a scientifically correct refutation from a list of options. It is objective and self-contained. There are no violations of scientific principles, logical inconsistencies, or ambiguities.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. A full solution will be developed.\n\nThe core of the problem lies in the distinction between static and dynamic electron correlation.\nThe CASSCF method is designed to provide a qualitatively correct zeroth-order wavefunction by treating strong electron correlation effects that arise from near-degeneracy of electronic configurations. This is known as **static correlation**. CASSCF accomplishes this by performing a full configuration interaction (FCI) calculation within a limited, chemically relevant set of orbitals called the active space. In this case, the active space is $\\mathrm{CAS}(8,8)$.\n\nHowever, the CASSCF method, by its very construction, almost completely neglects **dynamic correlation**. Dynamic correlation arises from the short-range interactions of electrons attempting to avoid one another (the \"Coulomb hole\"). Capturing this effect requires accounting for a vast number of excitations from occupied orbitals (both inactive and active) to unoccupied virtual orbitals. These excitations lie outside the CI space of the CASSCF calculation.\n\nThe value $c_0^2$ is the squared coefficient of the leading configuration (usually the Hartree-Fock determinant) in the CASSCF wavefunction. A value of $c_0^2 = 0.95$ indicates that the wavefunction is dominated by a single electronic configuration. This means that the effects of static correlation are weak for the state in question. The colleague's error is to infer from the small static correlation component that *all* correlation effects are small. This is fundamentally incorrect. Dynamic correlation is a distinct physical effect and its magnitude is not directly determined by the size of $c_0^2$. For nearly all molecules, dynamic correlation provides a substantial contribution to the total energy and is essential for achieving quantitative accuracy for energies and molecular properties.\n\nMethods like CASPT2 and NEVPT2 are multi-reference perturbation theories. They are explicitly designed to be applied *after* a CASSCF calculation. They use the CASSCF wavefunction as the zeroth-order reference and apply second-order perturbation theory to compute the energy contribution from excitations outside the active space. In doing so, they recover the missing dynamic correlation.\n\nTherefore, the colleague's argument that PT2 corrections are unnecessary is invalid. Even when static correlation is weak ($c_0^2 \\approx 1$), dynamic correlation must be included for quantitative results. Now, we evaluate each option.\n\n**A. Even with $c_0^2=0.95$, CASSCF treats primarily static (near-degeneracy) correlation within the active space and misses most dynamic correlation from excitations outside the active space; a second-order treatment such as CASPT2 or NEVPT2 is needed to recover this missing correlation and improve quantitative energies and properties.**\nThis statement is a precise and accurate description of the situation. It correctly identifies that CASSCF addresses static correlation within the active space and that its primary limitation is the neglect of dynamic correlation from outside this space. It correctly states the purpose of CASPT2/NEVPT2, which is to add this missing dynamic correlation to achieve quantitative accuracy. The fact that $c_0^2=0.95$ does not negate this fundamental need.\n**Verdict: Correct.**\n\n**B. A large $c_0^2$ means dynamic correlation is negligible, so applying CASPT2 or NEVPT2 would double-count correlation and typically worsen results.**\nThis statement is incorrect on multiple grounds. First, a large $c_0^2$ indicates weak *static* correlation, not negligible *dynamic* correlation. Dynamic correlation is almost always significant. Second, CASPT2 and NEVPT2 are formulated to avoid double-counting correlation. They operate on the space of configurations orthogonal to the CASSCF reference space, thereby adding a correction for interactions that were not included in the CASSCF calculation. Applying these methods is the standard procedure to improve, not worsen, CASSCF results.\n**Verdict: Incorrect.**\n\n**C. CASPT2 is only useful when $c_0^2  0.5$; for $c_0^2 \\ge 0.5$ it is generally numerically unstable due to intruder states, so it should be avoided.**\nThis statement is factually incorrect. CASPT2 works best when the reference state is well-defined and not pathologically multi-configurational, i.e., when $c_0^2$ is large. A value of $c_0^2=0.95$ represents an ideal case for CASPT2. The claim that it is only useful for $c_0^2  0.5$ is false; such a low value would indicate extreme multi-reference character where the choice of a single reference state for perturbation theory becomes questionable itself. Intruder state problems, which lead to divergencies in the perturbative expansion, are a known issue in CASPT2 but are not systematically correlated with high $c_0^2$ values. They are caused by near-degeneracies between the zeroth-order state energy and the energy of an excited configuration used in the perturbation sum. Various techniques exist to mitigate these instabilities.\n**Verdict: Incorrect.**\n\n**D. Even if the ground state appears single-configuration-like, differential dynamic correlation between states (e.g., ground versus excited states or along a reaction coordinate) can be substantial; adding CASPT2 or NEVPT2 reduces bias in relative energies such as excitation energies and barrier heights.**\nThis statement presents a critical and sophisticated reason for using post-CASSCF methods. CASSCF treats static correlation for a set of states (e.g., ground and excited) in a balanced manner. However, the amount of dynamic correlation, which CASSCF neglects, can differ significantly between these states. For instance, an excited state is typically more diffuse and electronically \"softer\" than the ground state, and thus has a larger dynamic correlation energy. By neglecting this differential effect, CASSCF often produces biased relative energies, such as overestimated excitation energies or reaction barriers. CASPT2 and NEVPT2 correct for this by calculating the dynamic correlation for each state, leading to a much more balanced and quantitatively accurate description of energy differences. This point is a powerful counterargument to the colleague's claim, as it highlights the importance of dynamic correlation even for computing relative properties.\n**Verdict: Correct.**\n\n**E. With a sufficiently large one-electron basis set, CASSCF includes both static and dynamic correlation, so perturbative corrections like CASPT2 or NEVPT2 are unnecessary regardless of $c_0^2$.**\nThis statement demonstrates a fundamental misunderstanding of electronic structure theory. The quality of the one-electron basis set determines how well the molecular orbitals can be represented. A large basis set is necessary for an accurate description of any electronic state. However, it does not change the level of electron correlation treatment provided by the method itself. CASSCF is, by definition, an FCI within a small active space. It does not include excitations to virtual orbitals, irrespective of how large the basis set is. To include all dynamic correlation, one would need to expand the active space to include all orbitals, which is the definition of a full CI calculation—a computationally intractable task for a system with 8 electrons in a large basis set. Thus, a large basis set does not obviate the need for a post-CASSCF dynamic correlation treatment like CASPT2 or NEVPT2.\n**Verdict: Incorrect.**\n\nIn summary, statements A and D provide scientifically correct and compelling counterarguments against the colleague's flawed reasoning.", "answer": "$$\\boxed{AD}$$", "id": "2459116"}, {"introduction": "Having established the need for a second-order correction, a crucial practical skill is to assess the quality and reliability of the resulting CASPT2 calculation. Perturbation theory is only valid if the perturbation is \"small,\" but how do we diagnose this? This problem introduces the reference weight, $c_0^2$, a standard diagnostic printed by most quantum chemistry programs [@problem_id:2459081]. Understanding its physical meaning will empower you to identify problematic calculations, particularly those suffering from so-called \"intruder states,\" which signal that your initial active space choice may have been inadequate.", "problem": "In Complete Active Space Second-Order Perturbation Theory (CASPT2), the zeroth-order state is the Complete Active Space Self-Consistent Field (CASSCF) reference wavefunction, denoted by $\\lvert \\Psi^{(0)} \\rangle$, and the perturbative correction mixes $\\lvert \\Psi^{(0)} \\rangle$ with external configurations to form a normalized, perturbed state. Many CASPT2 implementations report the reference weight, $c_0^2$, defined as the square of the coefficient of the CASSCF reference component in the normalized, perturbation-corrected wavefunction. This diagnostic takes values between $0$ and $1$. Which option best explains why $c_0^2$ is a useful diagnostic for the quality of the zeroth-order wavefunction?\n\nA. $c_0^2$ directly measures the norm of the zeroth-order CASSCF component in the normalized perturbed state; a small $c_0^2$ indicates strong mixing with external configurations due to large first-order amplitudes (often from small energy denominators or intruder states), signaling that the zeroth-order description and/or active space may be inadequate.\n\nB. $c_0^2$ is size-extensive and equals the fraction of the total dynamic correlation energy captured at second order, so it quantitatively predicts the residual energy error.\n\nC. $c_0^2$ equals the sum of squares of all important configuration state functions within the active space and therefore reports the completeness of the active space independently of the perturbation.\n\nD. In CASPT2, $c_0^2$ is fixed by the Ionization Potential–Electron Affinity (IPEA) partitioning and is always approximately $1$, so any deviation from $1$ is due to numerical noise rather than physics.", "solution": "The problem asks for the best explanation of the utility of the reference weight, $c_0^2$, as a diagnostic in Complete Active Space Second-Order Perturbation Theory (CASPT2). To answer this, we must first formalize the definition of $c_0^2$ within the framework of perturbation theory.\n\nIn CASPT2, the zeroth-order state is the CASSCF wavefunction, which we denote as $\\lvert \\Psi_0^{(0)} \\rangle$. This state is assumed to be normalized, $\\langle \\Psi_0^{(0)} | \\Psi_0^{(0)} \\rangle = 1$. The perturbation theory formalism introduces a correction to this state by mixing it with configurations from the external space. According to standard Rayleigh-Schrödinger perturbation theory, the first-order correction to the wavefunction, $\\lvert \\Psi_0^{(1)} \\rangle$, is given by:\n$$ \\lvert \\Psi_0^{(1)} \\rangle = \\sum_{k \\notin \\text{CAS}} \\frac{\\langle \\Psi_k^{(0)} | \\hat{V} | \\Psi_0^{(0)} \\rangle}{E_0^{(0)} - E_k^{(0)}} \\lvert \\Psi_k^{(0)} \\rangle $$\nwhere $\\lvert \\Psi_k^{(0)} \\rangle$ are the external configurations (eigenfunctions of the zeroth-order Hamiltonian $\\hat{H}_0$), $\\hat{V}$ is the perturbation operator, and $E_j^{(0)}$ are the zeroth-order energies. The unnormalized, first-order corrected wavefunction is $\\lvert \\Psi \\rangle = \\lvert \\Psi_0^{(0)} \\rangle + \\lvert \\Psi_0^{(1)} \\rangle$.\n\nThe problem states that $c_0^2$ is derived from the *normalized* perturbed state, $\\lvert \\Psi_{\\text{norm}} \\rangle$. We find the normalization constant $N$ from the condition $\\langle N\\Psi | N\\Psi \\rangle = 1$.\n$$ N^{-2} = \\langle \\Psi_0^{(0)} + \\Psi_0^{(1)} | \\Psi_0^{(0)} + \\Psi_0^{(1)} \\rangle $$\nSince the external states $\\lvert \\Psi_k^{(0)} \\rangle$ are orthogonal to the reference state $\\lvert \\Psi_0^{(0)} \\rangle$ and to each other, this simplifies to:\n$$ N^{-2} = \\langle \\Psi_0^{(0)} | \\Psi_0^{(0)} \\rangle + \\langle \\Psi_0^{(1)} | \\Psi_0^{(1)} \\rangle = 1 + \\sum_{k \\notin \\text{CAS}} \\left| \\frac{\\langle \\Psi_k^{(0)} | \\hat{V} | \\Psi_0^{(0)} \\rangle}{E_0^{(0)} - E_k^{(0)}} \\right|^2 $$\nThe normalized wavefunction is $\\lvert \\Psi_{\\text{norm}} \\rangle = N(\\lvert \\Psi_0^{(0)} \\rangle + \\lvert \\Psi_0^{(1)} \\rangle)$. The coefficient of the reference component $\\lvert \\Psi_0^{(0)} \\rangle$ in this normalized state is $c_0 = N$. The reference weight is therefore:\n$$ c_0^2 = N^2 = \\frac{1}{1 + \\sum_{k \\notin \\text{CAS}} \\left| \\frac{\\langle \\Psi_k^{(0)} | \\hat{V} | \\Psi_0^{(0)} \\rangle}{E_0^{(0)} - E_k^{(0)}} \\right|^2} $$\nThis expression is exact and forms the basis for our analysis. A \"good\" zeroth-order wavefunction for perturbation theory is one that is already a dominant component of the true wavefunction, meaning the perturbative corrections are small. If the corrections are small, the sum in the denominator is small (close to $0$), and $c_0^2$ is close to $1$.\n\nConversely, if $c_0^2$ is significantly smaller than $1$, the sum in the denominator must be large. This indicates that one or more first-order amplitudes, $\\frac{\\langle \\Psi_k^{(0)} | \\hat{V} | \\Psi_0^{(0)} \\rangle}{E_0^{(0)} - E_k^{(0)}}$, are large. A large amplitude can arise from a strong coupling matrix element $\\langle \\Psi_k^{(0)} | \\hat{V} | \\Psi_0^{(0)} \\rangle$, or more typically from a small energy denominator $|E_0^{(0)} - E_k^{(0)}|$. The latter situation, where an external state is nearly degenerate with the reference state at the zeroth-order level, is known as an \"intruder state\" problem. The presence of intruder states signals that the CASSCF active space is deficient, as it omits configurations that have a strong interaction with the reference. This makes the zeroth-order description inadequate and the perturbation too large for the second-order treatment to be reliable. Thus, a small $c_0^2$ is a critical warning about the quality of the zeroth-order CASSCF wavefunction and/or the choice of active space.\n\nNow we evaluate the given options.\n\nA. $c_0^2$ directly measures the norm of the zeroth-order CASSCF component in the normalized perturbed state; a small $c_0^2$ indicates strong mixing with external configurations due to large first-order amplitudes (often from small energy denominators or intruder states), signaling that the zeroth-order description and/or active space may be inadequate.\nThis statement is fully consistent with our derivation.\n- The quantity $c_0^2$ is the squared coefficient (or weight) of the reference state $\\lvert \\Psi_0^{(0)} \\rangle$ in the normalized total state, correctly identified as \"the norm of the... component\" in colloquial terms.\n- It correctly links a small $c_0^2$ to strong mixing (large first-order wavefunction correction).\n- It correctly identifies the cause of this strong mixing: large first-order amplitudes, which often stem from small energy denominators, a hallmark of intruder states.\n- It draws the correct conclusion: this situation indicates that the zeroth-order CASSCF wavefunction is a poor starting point, often because the active space is poorly chosen.\nThis option provides a complete and accurate explanation.\nVerdict: **Correct**.\n\nB. $c_0^2$ is size-extensive and equals the fraction of the total dynamic correlation energy captured at second order, so it quantitatively predicts the residual energy error.\n- The quantity $c_0^2$ is not size-extensive. As system size increases, the number of external configurations and the magnitude of the wavefunction correction typically grow, causing $c_0^2$ to decrease. It is an intensive-like quantity, but not strictly size-intensive.\n- $c_0^2$ is related to the norm of the first-order wavefunction correction, not directly to the second-order energy correction, $E_0^{(2)}$. There is no simple equality between $c_0^2$ and the fraction of correlation energy.\n- Consequently, it serves as a qualitative diagnostic, not a quantitative predictor of the residual error. A small $c_0^2$ warns that the CASPT2 energy is unreliable, but does not state the error in kJ/mol.\nThis statement is incorrect on multiple fundamental points.\nVerdict: **Incorrect**.\n\nC. $c_0^2$ equals the sum of squares of all important configuration state functions within the active space and therefore reports the completeness of the active space independently of the perturbation.\n- The sum of squares of all configuration coefficients *within* the CASSCF wavefunction $\\lvert \\Psi_0^{(0)} \\rangle$ is $1$ by definition. The quantity $c_0^2$ is the weight of the entire $\\lvert \\Psi_0^{(0)} \\rangle$ in the *perturbed* state. This statement confuses the internal structure of the CASSCF wavefunction with its role in perturbation theory.\n- The value of $c_0^2$ is fundamentally dependent on the perturbation, as shown by its formula which includes the perturbation operator $\\hat{V}$ and matrix elements with *external* states. It cannot report on the active space \"independently of the perturbation.\"\nThis statement misrepresents the definition and nature of $c_0^2$.\nVerdict: **Incorrect**.\n\nD. In CASPT2, $c_0^2$ is fixed by the Ionization Potential–Electron Affinity (IPEA) partitioning and is always approximately $1$, so any deviation from $1$ is due to numerical noise rather than physics.\n- The IPEA shift is a technique used to modify the zeroth-order Hamiltonian $\\hat{H}_0$, which in turn affects the energy denominators and thus the value of $c_0^2$. It is designed to mitigate intruder state problems and push $c_0^2$ closer to $1$, but it does not fix it to a specific value.\n- For many challenging systems, $c_0^2$ can be significantly less than $1$ (e.g., $0.8$ or lower) even with the IPEA shift. The claim that it is \"always approximately $1$\" is false.\n- A significant deviation of $c_0^2$ from $1$ is a sign of profound physical issues (strong multireference character extending beyond the active space, intruder states), not numerical noise. It is one of the most important physical diagnostics in a CASPT2 calculation.\nThis statement is a complete mischaracterization of both the IPEA shift and the diagnostic value of $c_0^2$.\nVerdict: **Incorrect**.\n\nBased on this analysis, Option A is the only correct and comprehensive explanation.", "answer": "$$\\boxed{A}$$", "id": "2459081"}, {"introduction": "Multi-reference perturbation theory is not a single method but a family of related approaches, with CASPT2 and NEVPT2 being two prominent members. While they share a common goal, they differ in their underlying construction, leading to important theoretical and practical differences. This final practice provides a hands-on computational task to explore one of the most critical theoretical properties: size-consistency [@problem_id:2459090]. By implementing a simplified but insightful toy model, you will gain a concrete, quantitative understanding of why NEVPT2 is designed to be strictly size-consistent, while standard CASPT2 is not—a crucial distinction when studying non-covalently interacting systems or dissociation processes.", "problem": "You will analyze size-consistency using a minimal, fully specified toy model that abstracts two well-known multireference second-order perturbation theories: Complete Active Space Second-Order Perturbation Theory (CASPT2) with a real level shift and N-Electron Valence State Perturbation Theory (NEVPT2). Consider two noninteracting fragments, labeled $A$ and $B$, whose zeroth-order model states are tensor products of their fragment model states. Each fragment $X \\in \\{A,B\\}$ has one external configuration characterized by an energy gap $\\Delta_X  0$ relative to its fragment model state and a real coupling amplitude $g_X$ between the model and external configuration. Assume the total Hamiltonian is strictly separable, so there are no inter-fragment couplings. Let $s \\ge 0$ denote a real level shift.\n\nFor the NEVPT2 abstraction (Epstein–Nesbet separable construction), define the fragment second-order corrections by\n$$\nE^{(2)}_{\\mathrm{NEV}}(X) = -\\frac{g_X^2}{\\Delta_X},\n$$\nand for the composite noninteracting dimer $AB$,\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}.\n$$\nThis construction enforces strong separability by assigning distinct external spaces to $A$-only and $B$-only excitations.\n\nFor the CASPT2-with-level-shift abstraction (internally contracted, level-shifted construction), define the fragment second-order corrections by\n$$\nE^{(2)}_{\\mathrm{CAS}}(X;s) = -\\frac{g_X^2}{\\Delta_X + s}.\n$$\nFor the composite noninteracting dimer $AB$, model internal contraction at the level of a single external class that merges the $A$-only and $B$-only external configurations into one contracted external vector with total coupling $g_A + g_B$ and an effective averaged denominator. Define\n$$\n\\overline{\\Delta}_{AB}(s) = \\frac{\\Delta_A + \\Delta_B}{2} + s,\n\\quad\nE^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(g_A + g_B)^2}{\\overline{\\Delta}_{AB}(s)}.\n$$\nThis construction models the non-separable effect of internal contraction combined with a global level shift applied to a merged excitation class.\n\nDefine size-consistency for a given method as the statement $E^{(2)}(\\mathrm{AB}) = E^{(2)}(\\mathrm{A}) + E^{(2)}(\\mathrm{B})$. For each parameter set below, evaluate whether size-consistency holds for NEVPT2 and for CASPT2-with-level-shift in the above abstractions, within an absolute tolerance of $\\tau = 1\\times 10^{-12}$. Your program should compute, for each test case, two boolean values:\n- the first indicates whether NEVPT2 is size-consistent,\n- the second indicates whether CASPT2-with-level-shift is size-consistent.\n\nUse the following test suite of parameter values ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$):\n1. $(0.8, 0.25, 1.1, 0.18, 0.2)$\n2. $(0.5, 0.3, 1.5, 0.1, 0.05)$\n3. $(0.7, 0.2, 2.0, 0.0, 0.3)$\n4. $(0.5, 0.3, 0.5, 0.3, 1000.0)$\n\nAll quantities are dimensionless. Angles do not appear. No percentages are used.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$[\\text{NEV-1}, \\text{CAS-1}, \\text{NEV-2}, \\text{CAS-2}, \\text{NEV-3}, \\text{CAS-3}, \\text{NEV-4}, \\text{CAS-4}]$,\nwhere each entry is a boolean computed with the absolute tolerance $\\tau = 1\\times 10^{-12}$.", "solution": "The problem statement is subjected to validation and is found to be scientifically grounded, well-posed, and objective. It presents a valid theoretical exercise in computational chemistry, using simplified but sound models to investigate the property of size-consistency in multi-reference perturbation theory. The problem is self-contained and provides all necessary definitions and data for a unique solution. We may therefore proceed with a rigorous analysis.\n\nThe task is to assess the size-consistency of two abstract second-order perturbation theories, NEVPT2 and CASPT2, for a system of two non-interacting fragments, $A$ and $B$. Size-consistency requires that the energy of the composite system (dimer) is the sum of the energies of the individual fragments, i.e., $E^{(2)}(AB) = E^{(2)}(A) + E^{(2)}(B)$. We evaluate this condition for each model. The tolerance for numerical equality is given as $\\tau = 1 \\times 10^{-12}$.\n\nFirst, we analyze the N-Electron Valence State Perturbation Theory (NEVPT2) abstraction.\nThe second-order energy correction for a single fragment $X \\in \\{A, B\\}$ is given by:\n$$\nE^{(2)}_{\\mathrm{NEV}}(X) = -\\frac{g_X^2}{\\Delta_X}\n$$\nThe sum of the fragment energies is therefore:\n$$\nE^{(2)}_{\\mathrm{NEV}}(A) + E^{(2)}_{\\mathrm{NEV}}(B) = \\left(-\\frac{g_A^2}{\\Delta_A}\\right) + \\left(-\\frac{g_B^2}{\\Delta_B}\\right) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}\n$$\nThe energy of the non-interacting dimer $AB$ is defined as:\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = -\\frac{g_A^2}{\\Delta_A} - \\frac{g_B^2}{\\Delta_B}\n$$\nBy direct comparison, we see that the size-consistency condition\n$$\nE^{(2)}_{\\mathrm{NEV}}(AB) = E^{(2)}_{\\mathrm{NEV}}(A) + E^{(2)}_{\\mathrm{NEV}}(B)\n$$\nis satisfied exactly by definition. The model is constructed to be strictly separable, or \"strongly size-consistent\". The size-consistency error is analytically zero. Thus, for any set of parameters ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$) where $\\Delta_A, \\Delta_B  0$, this model is size-consistent.\n\nNext, we analyze the Complete Active Space Second-Order Perturbation Theory with a real level shift (CASPT2) abstraction.\nThe second-order energy correction for a single fragment $X \\in \\{A, B\\}$ with a level shift $s \\ge 0$ is:\n$$\nE^{(2)}_{\\mathrm{CAS}}(X;s) = -\\frac{g_X^2}{\\Delta_X + s}\n$$\nThe sum of the fragment energies is:\n$$\nE^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{g_A^2}{\\Delta_A + s} - \\frac{g_B^2}{\\Delta_B + s}\n$$\nThe energy of the dimer $AB$ is defined using a model of internal contraction with an averaged denominator:\n$$\nE^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(g_A + g_B)^2}{\\overline{\\Delta}_{AB}(s)} = -\\frac{(g_A + g_B)^2}{\\frac{\\Delta_A + \\Delta_B}{2} + s}\n$$\nThe size-consistency error, $\\delta E$, is the difference between the dimer energy and the sum of fragment energies:\n$$\n\\delta E = E^{(2)}_{\\mathrm{CAS}}(AB;s) - \\left( E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) \\right)\n$$\n$$\n\\delta E = \\left( \\frac{g_A^2}{\\Delta_A + s} + \\frac{g_B^2}{\\Delta_B + s} \\right) - \\frac{(g_A + g_B)^2}{\\frac{\\Delta_A + \\Delta_B}{2} + s}\n$$\nThis expression is not, in general, equal to zero. This model is therefore not generally size-consistent. The size-consistency error arises from two features of the model which mimic real CASPT2: the use of a single, averaged denominator for a merged excitation class, and the non-separable nature of the numerator due to internal contraction, modeled here as $(g_A + g_B)^2$. Size-consistency holds only if $|\\delta E| \\le \\tau$. We must evaluate this condition for each test case.\n\nCase 1: ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$) = $(0.8, 0.25, 1.1, 0.18, 0.2)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2:\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.25^2}{0.8+0.2} - \\frac{0.18^2}{1.1+0.2} = -0.0625 - \\frac{0.0324}{1.3} \\approx -0.0874230769$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.25+0.18)^2}{\\frac{0.8+1.1}{2}+0.2} = -\\frac{0.43^2}{1.15} = -\\frac{0.1849}{1.15} \\approx -0.1607826087$\n  - $|\\delta E| \\approx |-0.1607826087 - (-0.0874230769)| \\approx 0.0733595318 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 2: ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$) = $(0.5, 0.3, 1.5, 0.1, 0.05)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2:\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.3^2}{0.5+0.05} - \\frac{0.1^2}{1.5+0.05} = -\\frac{0.09}{0.55} - \\frac{0.01}{1.55} \\approx -0.1700879765$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.3+0.1)^2}{\\frac{0.5+1.5}{2}+0.05} = -\\frac{0.4^2}{1.05} = -\\frac{0.16}{1.05} \\approx -0.1523809524$\n  - $|\\delta E| \\approx |-0.1523809524 - (-0.1700879765)| \\approx 0.0177070241 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 3: ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$) = $(0.7, 0.2, 2.0, 0.0, 0.3)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2: Here, $g_B=0$. The error becomes $\\delta E = g_A^2 \\left( \\frac{1}{\\Delta_A+s} - \\frac{1}{\\frac{\\Delta_A+\\Delta_B}{2}+s} \\right)$. This is non-zero unless $\\Delta_A = \\Delta_B$. Here, $\\Delta_A \\neq \\Delta_B$.\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.2^2}{0.7+0.3} - \\frac{0^2}{2.0+0.3} = -0.04$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.2+0)^2}{\\frac{0.7+2.0}{2}+0.3} = -\\frac{0.04}{1.65} \\approx -0.0242424242$\n  - $|\\delta E| \\approx |-0.0242424242 - (-0.04)| \\approx 0.0157575758 \\gg \\tau$. Not size-consistent. Result: False.\n\nCase 4: ($\\Delta_A$, $g_A$, $\\Delta_B$, $g_B$, $s$) = $(0.5, 0.3, 0.5, 0.3, 1000.0)$\n- NEVPT2: Size-consistent by definition. Result: True.\n- CASPT2: The shift $s$ is large. In the limit $s \\to \\infty$, the error approaches zero as $\\delta E \\approx -2g_A g_B / s$. For a finite but large $s$, the error is small but non-zero.\n  - $E^{(2)}_{\\mathrm{CAS}}(A;s) + E^{(2)}_{\\mathrm{CAS}}(B;s) = -\\frac{0.3^2}{0.5+1000} - \\frac{0.3^2}{0.5+1000} = -2 \\frac{0.09}{1000.5} \\approx -0.0001799100$\n  - $E^{(2)}_{\\mathrm{CAS}}(AB;s) = -\\frac{(0.3+0.3)^2}{\\frac{0.5+0.5}{2}+1000} = -\\frac{0.6^2}{1000.5} = -\\frac{0.36}{1000.5} \\approx -0.0003598201$\n  - $|\\delta E| \\approx |-0.0003598201 - (-0.0001799100)| \\approx 0.0001799101 \\gg \\tau$. Not size-consistent. Result: False.\n\nIn summary, the NEVPT2 abstraction is size-consistent for all test cases, while the CASPT2 abstraction is not size-consistent for any of the test cases, as the model inherently introduces a size-consistency error that does not vanish under the given conditions.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes the size-consistency of two abstract multireference perturbation\n    theory models (NEVPT2 and CASPT2) for a series of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (delta_A, g_A, delta_B, g_B, s)\n    test_cases = [\n        (0.8, 0.25, 1.1, 0.18, 0.2),\n        (0.5, 0.3, 1.5, 0.1, 0.05),\n        (0.7, 0.2, 2.0, 0.0, 0.3),\n        (0.5, 0.3, 0.5, 0.3, 1000.0),\n    ]\n\n    # Absolute tolerance for checking size-consistency\n    tau = 1.0e-12\n\n    results = []\n    for case in test_cases:\n        delta_A, g_A, delta_B, g_B, s = case\n\n        # --- NEVPT2 Validation ---\n        # The NEVPT2 abstraction defines the dimer energy as the exact sum of\n        # the fragment energies:\n        # E2_NEV(AB) = -g_A^2/delta_A - g_B^2/delta_B\n        # E2_NEV(A) + E2_NEV(B) = (-g_A^2/delta_A) + (-g_B^2/delta_B)\n        # These are analytically identical. The size-consistency error is zero.\n        # Therefore, the result for NEVPT2 is always True.\n        results.append(True)\n\n        # --- CASPT2-with-level-shift Validation ---\n        # Sum of fragment energies\n        E2_CAS_A = -g_A**2 / (delta_A + s)\n        if delta_B > 0: # Avoid division by zero if delta_B was 0, though problem states > 0\n            E2_CAS_B = -g_B**2 / (delta_B + s)\n        else:\n            E2_CAS_B = 0.0\n        \n        sum_E2_CAS = E2_CAS_A + E2_CAS_B\n\n        # Dimer energy\n        delta_AB_bar = (delta_A + delta_B) / 2.0 + s\n        E2_CAS_AB = -(g_A + g_B)**2 / delta_AB_bar\n\n        # Check for size-consistency\n        error_cas = abs(E2_CAS_AB - sum_E2_CAS)\n        is_cas_consistent = error_cas = tau\n        results.append(is_cas_consistent)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts Python booleans (True, False) to strings.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2459090"}]}