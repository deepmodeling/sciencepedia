{"hands_on_practices": [{"introduction": "Before applying advanced simulation techniques like Adaptive Biasing Force, it is crucial to solidify our understanding of the target quantity: the Potential of Mean Force (PMF). This practice guides you through the analytical calculation of the PMF for a simple diatomic molecule, revealing how it arises from both the potential energy landscape and entropic contributions related to phase space volume. By solving for this \"ground truth,\" you build a firm theoretical foundation for interpreting and validating results from more complex free energy simulations.", "problem": "A diatomic molecule in three spatial dimensions has an interaction energy that depends only on the scalar interatomic separation $r$ (in nm), modeled by a Morse potential\n$$\nU(r) \\;=\\; D_e\\left(1 - e^{-a\\,(r-r_e)}\\right)^2 \\;-\\; D_e,\n$$\nwhere $D_e$ (in kJ/mol) is the dissociation energy, $a$ (in nm$^{-1}$) is a range parameter, and $r_e$ (in nm) is the equilibrium bond length. Consider an Adaptive Biasing Force (ABF) simulation whose reaction coordinate is the interatomic distance $r$. In the canonical ensemble at absolute temperature $T$ (in K), the potential of mean force $A_T(r)$ (in kJ/mol) along $r$ is defined up to an additive constant by the marginal probability density of $r$,\n$$\np_r(r) \\;\\propto\\; 4\\pi r^2 \\, e^{-\\beta U(r)},\n$$\nwith $\\beta = 1/(R T)$ and $R$ the molar gas constant. The quantity of interest is the free-energy difference along the reaction coordinate between a reference $r_{\\min}$ and a target $r_{\\max}$ at temperature $T$,\n$$\n\\Delta A_T \\;=\\; A_T(r_{\\max}) - A_T(r_{\\min}),\n$$\nexpressed in kJ/mol. This quantity is independent of the arbitrary additive constant in $A_T(r)$ and represents the change in the potential of mean force relevant to a dissociation event. For this problem, take $r_{\\min} = r_e$.\n\nUse the following physically grounded parameters and constants:\n- $D_e = 50$ kJ/mol,\n- $a = 20$ nm$^{-1}$,\n- $r_e = 0.25$ nm,\n- $R = 0.008314462618$ kJ/(mol·K).\n\nYour task is to compute $\\Delta A_T$ for the parameter sets listed below. Each answer must be a single floating-point value (in kJ/mol), rounded to three decimals.\n\nTest suite:\n1. $T = 300$ K, $r_{\\max} = 0.80$ nm.\n2. $T = 350$ K, $r_{\\max} = 0.80$ nm.\n3. $T = 400$ K, $r_{\\max} = 0.80$ nm.\n4. $T = 300$ K, $r_{\\max} = 2.00$ nm.\n5. $T = 300$ K, $r_{\\max} = 0.26$ nm.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[x1,x2,x3,x4,x5]\"), where each $x_i$ is the computed $\\Delta A_T$ (in kJ/mol) rounded to three decimals, in the same order as the test suite above.", "solution": "The problem statement has been validated and is deemed acceptable for analysis. It is scientifically grounded, well-posed, and self-contained. It presents a standard problem in computational statistical mechanics. We will proceed with the formal derivation and solution.\n\nThe central task is to compute the free-energy difference, $\\Delta A_T$, along a reaction coordinate defined by the interatomic distance $r$ for a diatomic molecule. The system is in the canonical ensemble at temperature $T$.\n\nThe potential of mean force (PMF), denoted as $A_T(r)$, is related to the marginal probability density of the reaction coordinate, $p_r(r)$, by the fundamental relation from statistical mechanics:\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln p_r(r) + C\n$$\nwhere $\\beta = 1/(RT)$ is the inverse thermal energy per mole, $R$ is the molar gas constant, and $C$ is an arbitrary additive constant that depends on the normalization of the probability density but is independent of the coordinate $r$.\n\nThe problem states that the probability density is proportional to\n$$\np_r(r) \\propto 4\\pi r^2 \\, e^{-\\beta U(r)}\n$$\nThe term $4\\pi r^2$ is the Jacobian factor that arises from transforming from three-dimensional Cartesian coordinates to spherical coordinates and integrating over the angular degrees of freedom. It represents the volume of a spherical shell at radius $r$. The term $e^{-\\beta U(r)}$ is the Boltzmann weight associated with the interaction potential energy $U(r)$.\n\nSubstituting this into the definition of the PMF, we obtain:\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln \\left( K \\cdot 4\\pi r^2 e^{-\\beta U(r)} \\right) + C\n$$\nwhere $K$ is the constant of proportionality. Using the properties of logarithms, this can be expanded:\n$$\nA_T(r) = -\\frac{1}{\\beta} \\left( \\ln(4\\pi K) + \\ln(r^2) + \\ln(e^{-\\beta U(r)}) \\right) + C\n$$\n$$\nA_T(r) = -\\frac{1}{\\beta} \\ln(4\\pi K) - \\frac{2}{\\beta} \\ln(r) - \\frac{1}{\\beta} (-\\beta U(r)) + C\n$$\nCombining all constant terms into a single new constant $C'$, and recalling that $1/\\beta = RT$, we arrive at the expression for the PMF:\n$$\nA_T(r) = U(r) - 2RT \\ln(r) + C'\n$$\nWe are required to calculate the free-energy difference $\\Delta A_T$ between a reference state at $r_{\\min}$ and a target state at $r_{\\max}$:\n$$\n\\Delta A_T = A_T(r_{\\max}) - A_T(r_{\\min})\n$$\nSubstituting the derived expression for $A_T(r)$:\n$$\n\\Delta A_T = \\left( U(r_{\\max}) - 2RT \\ln(r_{\\max}) + C' \\right) - \\left( U(r_{\\min}) - 2RT \\ln(r_{\\min}) + C' \\right)\n$$\nThe unknown constant $C'$ cancels out, as expected for a difference calculation:\n$$\n\\Delta A_T = U(r_{\\max}) - U(r_{\\min}) - 2RT (\\ln(r_{\\max}) - \\ln(r_{\\min}))\n$$\n$$\n\\Delta A_T = U(r_{\\max}) - U(r_{\\min}) - 2RT \\ln\\left(\\frac{r_{\\max}}{r_{\\min}}\\right)\n$$\nThe problem specifies the interaction potential $U(r)$ as a shifted Morse potential:\n$$\nU(r) = D_e\\left(1 - e^{-a\\,(r-r_e)}\\right)^2 - D_e\n$$\nwith parameters $D_e$, $a$, and $r_e$. The reference coordinate is set to the equilibrium bond length, $r_{\\min} = r_e$.\n\nFirst, we evaluate the potential energy at the reference point $r_{\\min} = r_e$:\n$$\nU(r_e) = D_e\\left(1 - e^{-a\\,(r_e-r_e)}\\right)^2 - D_e = D_e\\left(1 - e^{0}\\right)^2 - D_e = D_e(1-1)^2 - D_e = -D_e\n$$\nNext, we evaluate the potential at the target point $r_{\\max}$:\n$$\nU(r_{\\max}) = D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - D_e\n$$\nNow, substitute these potential energy values back into the expression for $\\Delta A_T$:\n$$\n\\Delta A_T = \\left( D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - D_e \\right) - (-D_e) - 2RT \\ln\\left(\\frac{r_{\\max}}{r_e}\\right)\n$$\nThe $-D_e$ terms cancel, yielding the final, simplified expression for the free-energy difference:\n$$\n\\Delta A_T = D_e\\left(1 - e^{-a\\,(r_{\\max}-r_e)}\\right)^2 - 2RT \\ln\\left(\\frac{r_{\\max}}{r_e}\\right)\n$$\nThis is the equation we must implement. The given constants are:\n- $D_e = 50$ kJ/mol\n- $a = 20$ nm$^{-1}$\n- $r_e = 0.25$ nm\n- $R = 0.008314462618$ kJ/(mol·K)\n\nWe will now apply this formula to each set of parameters $(T, r_{\\max})$ provided in the test suite. The calculations will be performed, and the results rounded to three decimal places.\n\nFor example, for the first test case ($T = 300$ K, $r_{\\max} = 0.80$ nm):\n- $RT = 0.008314462618 \\times 300 \\approx 2.4943$ kJ/mol\n- Exponent term: $-a(r_{\\max}-r_e) = -20 \\times (0.80 - 0.25) = -11.0$\n- Potential term: $50 \\times (1 - e^{-11.0})^2 \\approx 50 \\times (0.999983...)^2 \\approx 49.998$ kJ/mol\n- Entropic term: $-2 \\times 2.4943 \\times \\ln(0.80 / 0.25) \\approx -4.9886 \\times \\ln(3.2) \\approx -4.9886 \\times 1.16315 \\approx -5.802$ kJ/mol\n- $\\Delta A_T \\approx 49.998 - 5.802 = 44.196$ kJ/mol.\n\nThis procedure will be systematically applied to all test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the free-energy difference for a diatomic molecule\n    based on a Morse potential and statistical mechanics principles.\n    \"\"\"\n    # Define physical constants and model parameters.\n    D_e = 50.0  # Dissociation energy in kJ/mol\n    a = 20.0  # Range parameter in nm^-1\n    r_e = 0.25  # Equilibrium bond length in nm\n    R = 0.008314462618  # Molar gas constant in kJ/(mol·K)\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple of (Temperature in K, r_max in nm).\n    test_cases = [\n        (300.0, 0.80),\n        (350.0, 0.80),\n        (400.0, 0.80),\n        (300.0, 2.00),\n        (300.0, 0.26),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, r_max = case\n\n        # The derived formula for the free-energy difference is:\n        # ΔA_T = D_e * (1 - e^(-a*(r_max - r_e)))^2 - 2*R*T*ln(r_max / r_e)\n\n        # Term 1: Contribution from the potential energy difference (standard Morse part)\n        term1 = D_e * (1 - np.exp(-a * (r_max - r_e)))**2\n\n        # Term 2: Contribution from the change in phase space volume (entropic part)\n        term2 = -2 * R * T * np.log(r_max / r_e)\n\n        # Total free energy difference\n        delta_A_T = term1 + term2\n        \n        # Round the result to three decimal places\n        results.append(round(delta_A_T, 3))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2448528"}, {"introduction": "A perfect simulation would sample the entire energy landscape until convergence, but in practice, computational cost often limits simulation time. This exercise explores a critical pitfall: what happens to the calculated PMF when the simulation is stopped before the system can adequately and reversibly cross energy barriers? Understanding the consequences of such incomplete sampling, a phenomenon known as hysteresis, is key to avoiding the misinterpretation of simulation results and assessing the reliability of your findings.", "problem": "Consider a molecular system described by a one-dimensional collective variable (CV) $\\xi$ that exhibits two deep, non-equivalent free-energy minima separated by a high barrier. The Potential of Mean Force (PMF) $A(\\xi)$ is defined by the reversible work along $\\xi$, with its derivative given by\n$$\n\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi},\n$$\nwhere $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ is the conditional equilibrium average of the instantaneous generalized force projected along $\\xi$ at fixed $\\xi$. In Adaptive Biasing Force (ABF), a biasing potential $V_{\\mathrm{ABF}}(\\xi)$ is constructed so that $\\mathrm{d}V_{\\mathrm{ABF}}/\\mathrm{d}\\xi$ adaptively approaches $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, with the aim of improving sampling and reconstructing $A(\\xi)$ by numerical integration of the estimated mean force.\n\nSuppose an ABF simulation is initialized in the lower free-energy minimum and is terminated long before the system has undergone adequately many transitions in both directions across the barrier (i.e., before local conditional equilibrium is reached in each bin and before reversibility along $\\xi$ is established). Which option best describes the qualitative appearance of the resulting estimated PMF $\\hat{A}(\\xi)$?\n\nA. Nearly flat $\\hat{A}(\\xi)$ with two wells of equal depth and a strongly underestimated barrier, because the adaptive bias flattens the profile even with few samples.\n\nB. An apparent preference for the initial basin: $\\hat{A}(\\xi)$ reproduces the local curvature near the starting minimum, but the barrier height is overestimated and the other minimum appears too high in free energy; poorly sampled regions are noisy or irregular.\n\nC. Exact $A(\\xi)$ within the visited interval and no estimate elsewhere, because the local force average enforces the exact gradient regardless of sampling directionality.\n\nD. A symmetric double-well $\\hat{A}(\\xi)$ differing from the true $A(\\xi)$ only by an additive constant, despite the non-equivalence of the minima.\n\nE. A PMF $\\hat{A}(\\xi)$ that is essentially random and uncorrelated with the true landscape, because the imposed bias dominates the dynamics from the outset.", "solution": "The problem statement must first be subjected to rigorous validation.\n\n### Step 1: Extract Givens\n- The system is described by a one-dimensional collective variable (CV) $\\xi$.\n- The Potential of Mean Force (PMF), $A(\\xi)$, has two deep, non-equivalent minima separated by a high barrier.\n- The derivative of the PMF is defined as $\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, where $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ is the conditional equilibrium average of the instantaneous generalized force projected along $\\xi$ at fixed $\\xi$.\n- In the Adaptive Biasing Force (ABF) method, a biasing potential $V_{\\mathrm{ABF}}(\\xi)$ is constructed such that its derivative, $\\frac{\\mathrm{d}V_{\\mathrm{ABF}}}{\\mathrm{d}\\xi}$, adaptively approaches $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$.\n- The objective of ABF is to improve sampling and reconstruct $A(\\xi)$ by numerical integration of the estimated mean force.\n- The simulation conditions are:\n    1.  Initialization in the lower free-energy minimum.\n    2.  Termination occurs \"long before the system has undergone adequately many transitions in both directions across the barrier\".\n    3.  This implies \"local conditional equilibrium is not reached in each bin\" and \"reversibility along $\\xi$ is not established\".\n- The question asks for the qualitative appearance of the resulting estimated PMF, $\\hat{A}(\\xi)$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard scenario in the application of an enhanced sampling method, specifically ABF, in computational statistical mechanics.\n\n- **Scientifically Grounded:** The definitions of the PMF, $A(\\xi)$, and its relation to the mean force, $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, are fundamental principles of statistical mechanics. The description of the ABF method is consistent with its standard formulation. The scenario of a non-converged simulation is a common and practical problem.\n- **Well-Posed:** The problem is well-defined. It specifies the system (two non-equivalent minima), the method (ABF), the initial conditions (start in the lower minimum), and the termination condition (insufficient sampling across the barrier). The question asks for a qualitative but physically determined outcome. A unique conceptual answer exists based on the principles of the method.\n- **Objective:** The language is precise and technical. It avoids subjectivity and ambiguity.\n\n### Step 3: Verdict and Action\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. I will proceed with the derivation of the solution.\n\nThe core principle of the Adaptive Biasing Force method is the estimation of the true mean force, $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$, by accumulating a running average of the instantaneous force, $F_{\\xi}$, within discrete bins along the collective variable $\\xi$. The estimated PMF, $\\hat{A}(\\xi)$, is then obtained by integrating the negative of this estimated mean force:\n$$\n\\hat{A}(\\xi) = \\int_{\\xi_0}^{\\xi} \\frac{\\mathrm{d}A(x)}{\\mathrm{d}x} \\, \\mathrm{d}x \\approx - \\int_{\\xi_0}^{\\xi} \\hat{\\left\\langle F_{x} \\right\\rangle}_{x} \\, \\mathrm{d}x + C\n$$\nwhere $\\hat{\\left\\langle F_{x} \\right\\rangle}_{x}$ is the estimated mean force in the bin corresponding to coordinate $x$ and $C$ is an integration constant.\n\nThe problem specifies two critical conditions: the simulation is initiated in one basin and is terminated before convergence. Convergence in ABF requires two conditions to be met for each bin along $\\xi$:\n1.  **Statistical convergence**: Sufficient samples of $F_{\\xi}$ must be collected so that the statistical error on the average is low.\n2.  **Equilibrium of orthogonal degrees of freedom**: The system, constrained at a value of $\\xi$, must have had time to equilibrate in all other degrees of freedom. This is what \"conditional equilibrium average\" $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ signifies. This requires the system to have visited the bin from all adjacent regions (e.g., from both the left and the right) multiple times, establishing reversibility.\n\nThe problem explicitly states that the simulation is terminated before \"adequately many transitions in both directions across the barrier\" have occurred. This is a direct violation of the second condition for convergence, particularly in the barrier region.\n\nLet us analyze the consequences:\n- **In the initial basin**: The system is initialized here and spends a significant amount of time exploring this region before crossing the barrier. Sampling is therefore dense. The force estimates, $\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}$, will be statistically reliable, and the system is in local equilibrium. Consequently, the integral, $\\hat{A}(\\xi)$, will accurately reproduce the true shape and local curvature of the PMF, $A(\\xi)$, within this initial free-energy well.\n\n- **On the barrier and in the second basin**: As the ABF bias pushes the system away from the initial minimum and up the free-energy barrier, the sampling becomes progressively sparser. The crucial failure is the lack of reversibility. The forces $F_{\\xi}$ are sampled almost exclusively from trajectories moving \"uphill\" from the first basin. The system is being actively driven into a high-energy region and does not have time to relax its orthogonal degrees of freedom to the new constrained condition. This phenomenon, known as hysteresis or system lag, results in a systematic error. The measured restoring force is typically overestimated; it is the force required to drag a non-equilibrated system, which is greater than the force required to hold an equilibrated one. Therefore, the magnitude of the estimated mean force, $|\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}|$, will be systematically larger than the true equilibrium value, $|\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}|$, in the barrier region.\n\n- **Consequences for $\\hat{A}(\\xi)$**: Integrating a mean force whose magnitude is overestimated leads to a reconstructed PMF that is too steep. This means the free-energy difference between the minimum and the transition state—the barrier height—will be **overestimated**. Following this overestimated barrier, the subsequent descent into the second basin will start from an artificially high free-energy value. As a result, the second minimum will appear to be at a much higher free energy relative to the first minimum than it is in reality. Furthermore, in regions with very few samples (the barrier top and the second basin), the high statistical uncertainty in the force estimate will manifest as noise or irregular, jagged features in the reconstructed PMF, $\\hat{A}(\\xi)$.\n\n### Option-by-Option Analysis\n\n**A. Nearly flat $\\hat{A}(\\xi)$ with two wells of equal depth and a strongly underestimated barrier, because the adaptive bias flattens the profile even with few samples.**\n**Incorrect.** The ABF method flattens the *modified* free-energy surface (physical plus bias), not the reconstructed PMF $\\hat{A}(\\xi)$. $\\hat{A}(\\xi)$ is the estimate of the original, un-flattened PMF. There is no reason for the wells to become of equal depth, especially with biased sampling. An underestimated barrier is also contrary to the expected hysteresis effect.\n\n**B. An apparent preference for the initial basin: $\\hat{A}(\\xi)$ reproduces the local curvature near the starting minimum, but the barrier height is overestimated and the other minimum appears too high in free energy; poorly sampled regions are noisy or irregular.**\n**Correct.** This statement accurately summarizes the consequences of a non-converged ABF simulation with insufficient barrier crossings. Good sampling in the initial basin ensures correct local curvature. Lack of reversible sampling leads to force overestimation (hysteresis), causing an overestimated barrier. This, in turn, makes the subsequent basin appear artificially high in energy. Poor statistics in sparsely sampled regions lead to noise.\n\n**C. Exact $A(\\xi)$ within the visited interval and no estimate elsewhere, because the local force average enforces the exact gradient regardless of sampling directionality.**\n**Incorrect.** This is fundamentally wrong. The local force average only converges to the exact gradient, $-\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi}$, under conditions of local equilibrium and sufficient sampling. The problem explicitly states these conditions are not met. The directionality of sampling is critical for avoiding systematic bias.\n\n**D. A symmetric double-well $\\hat{A}(\\xi)$ differing from the true $A(\\xi)$ only by an additive constant, despite the non-equivalence of the minima.**\n**Incorrect.** The true PMF is asymmetric (\"non-equivalent minima\"). There is no physical or algorithmic reason why a non-converged simulation, started asymmetrically, would produce a symmetric result. The result will be a distorted version of the true asymmetric profile, not a perfectly symmetric one.\n\n**E. A PMF $\\hat{A}(\\xi)$ that is essentially random and uncorrelated with the true landscape, because the imposed bias dominates the dynamics from the outset.**\n**Incorrect.** The result is not random. It is systematically biased. In the well-sampled initial region, the correlation with the true landscape is high. The bias does not dominate from the outset; it is built up adaptively from an initial value of zero. Therefore, the initial part of the simulation explores the true potential. The final result, while flawed, is far from random.", "answer": "$$\\boxed{B}$$", "id": "2448538"}, {"introduction": "This practice moves from running simulations to the crucial post-processing stage, a vital skill for any computational scientist. It addresses a common scenario where the mean force data from an ABF simulation may be unreliable or missing in certain regions, such as a high-energy transition state. You will learn how to use physically-motivated interpolation, specifically cubic splines that minimize bending energy, to reconstruct a complete and smooth PMF profile from incomplete data, reinforcing the core relationship $W(z) = -\\int f(s)\\, ds$.", "problem": "You are given a one-dimensional adaptive biasing force (ABF) data reconstruction task expressed in purely mathematical terms. Consider a dimensionless reaction coordinate $z \\in [0,1]$ with an unknown true mean force $f_{\\star}(z)$. From a completed simulation, you have binned mean-force samples $\\{(z_i,\\bar{F}_i)\\}_{i=0}^{N-1}$ on the uniform grid $z_i = \\frac{i}{N-1}$ for $i \\in \\{0,1,\\dots,N-1\\}$. The data in a specified subinterval is corrupted and must be treated as missing. Assume that for $i$ corresponding to uncorrupted grid points, the samples are exact: $\\bar{F}_i = f_{\\star}(z_i)$.\n\nYour task is to reconstruct a twice continuously differentiable function $f:[0,1]\\to\\mathbb{R}$ that satisfies the following:\n\n- For all uncorrupted indices $i$, $f(z_i) = \\bar{F}_i$.\n- Among all such functions, $f$ minimizes the bending energy\n$$\n\\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\nsubject to the natural boundary conditions $f''(0)=0$ and $f''(1)=0$.\n\nDefine the reconstructed potential of mean force (PMF) $W(z)$ by\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\nwith $W(0)=0$. Let the exact PMF be $W_{\\star}(z) = -\\int_{0}^{z} f_{\\star}(s)\\, ds$ with $W_{\\star}(0)=0$.\n\nFor each test case below, compute the root-mean-square error (RMSE) between $W$ and $W_{\\star}$ on a dense grid of $M$ equispaced points $z^{(k)}=\\frac{k}{M-1}$, $k \\in \\{0,1,\\dots,M-1\\}$:\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1} \\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n\nAll quantities are dimensionless. Use $M = 1001$.\n\nTest suite. For each case, the exact force $f_{\\star}(z)$, the number of samples $N$, and the corrupted interval $\\mathcal{I}$ are specified. Construct the grid $z_i=\\frac{i}{N-1}$ and form the exact samples $\\bar{F}_i=f_{\\star}(z_i)$. Treat any $z_i \\in \\mathcal{I}$ as corrupted and exclude those constraints in the reconstruction. The endpoints $z=0$ and $z=1$ are uncorrupted in all cases.\n\n- Case $1$ (happy path): $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$, $N=33$, corrupted interval $\\mathcal{I}=[0.45,\\,0.55]$.\n- Case $2$ (boundary consistency): $f_{\\star}(z) = 3 z - 1$, $N=21$, corrupted interval $\\mathcal{I}=[0.35,\\,0.50]$.\n- Case $3$ (wide missing region): $f_{\\star}(z) = e^{z}$, $N=15$, corrupted interval $\\mathcal{I}=[0.30,\\,0.70]$.\n\nYour program should produce a single line of output containing the three RMSE values for Cases $1$–$3$ as a comma-separated list enclosed in square brackets, with each value rounded to six decimal places (e.g., \"[0.001234,0.000000,0.012345]\").", "solution": "We begin from the physical definition that in adaptive biasing force (ABF) analysis the potential of mean force (PMF) $W(z)$ satisfies $W'(z) = -f_{\\star}(z)$, where $f_{\\star}(z)$ is the exact mean force along the reaction coordinate $z$. When we only have samples of the force at discrete points and a region is corrupted, we must interpolate or infer the force in the missing region while maintaining physical consistency, namely that the force should be sufficiently smooth in $z$ for macroscopic collective variables. The requirement to minimize the bending energy $\\int_{0}^{1} \\left(f''(z)\\right)^2 dz$ among functions that pass through the uncorrupted samples and satisfy $f''(0)=f''(1)=0$ formalizes this as a well-posed variational problem.\n\nPrinciple 1: Variational characterization of the interpolant. Consider the space of functions $\\mathcal{H} = \\{ f \\in C^2([0,1]) : f'' \\in L^2([0,1]) \\}$ and the linear constraints $f(z_i)=\\bar{F}_i$ for all uncorrupted $i$. The functional\n$$\nJ[f] = \\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\nis strictly convex on $\\mathcal{H}$, and the feasible set defined by the interpolation constraints is affine and non-empty (since a piecewise-cubic function through the data exists). The Euler–Lagrange equation for the associated constrained minimization implies that the minimizer is a piecewise-cubic polynomial with continuous first and second derivatives at the interpolation nodes, and $f''(0)=f''(1)=0$ (natural boundary conditions). Uniqueness follows from strict convexity. This minimizer is the natural cubic spline interpolant through the uncorrupted points.\n\nPrinciple 2: Reconstruction of the PMF. Once $f$ is reconstructed, the PMF is given by\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\nwith $W(0)=0$. This is a direct application of the fundamental theorem of calculus and the ABF definition of the PMF.\n\nPrinciple 3: Error quantification. To quantify the reconstruction quality, we compute the root-mean-square error (RMSE) over a dense grid $\\{ z^{(k)} \\}_{k=0}^{M-1}$,\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1}\\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\nFor each test case, $W_{\\star}(z)$ is derived analytically from the exact force $f_{\\star}(z)$:\n- Case $1$: $f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} \\sin(2\\pi s)\\, ds = -\\left[-\\frac{\\cos(2\\pi s)}{2\\pi}\\right]_{0}^{z} = \\frac{\\cos(2\\pi z) - 1}{2\\pi}.\n$$\n- Case $2$: $f_{\\star}(z) = 3 z - 1$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} (3 s - 1)\\, ds = -\\left(\\frac{3}{2} z^2 - z\\right) = -\\frac{3}{2} z^2 + z.\n$$\n- Case $3$: $f_{\\star}(z) = e^{z}$. Then\n$$\nW_{\\star}(z) = -\\int_{0}^{z} e^{s}\\, ds = -\\left(e^{z} - 1\\right) = 1 - e^{z}.\n$$\n\nAlgorithmic realization. To compute the minimizer, we employ the natural cubic spline interpolant through the uncorrupted nodes $\\{(z_i,\\bar{F}_i)\\}$, which is justified by the variational characterization above. A natural cubic spline produces a piecewise-cubic $f$ with continuous first and second derivatives and satisfies $f''(0)=f''(1)=0$. The reconstructed $f$ is then integrated to obtain $W$. Numerically, the antiderivative of a cubic spline can be constructed exactly by integrating its piecewise-polynomial representation, enabling accurate evaluation of $W(z)$ for any $z$. We then compute the RMSE $\\varepsilon$ on the dense grid of $M=1001$ points for each test case.\n\nTest suite coverage. The three cases probe different behaviors:\n- Case $1$ tests a smooth oscillatory force with a modest corrupted interval.\n- Case $2$ tests linear force; the spline exactly reproduces linear functions, so the RMSE is expected to be near machine precision.\n- Case $3$ tests a rapidly varying monotonic force with a wide missing interval, stressing the extrapolative behavior across the gap.\n\nThe final program constructs the grids, removes points whose $z_i$ lie in the specified corrupted interval $\\mathcal{I}$, fits the natural cubic spline to the remaining points, forms the antiderivative to compute $W$, evaluates $W$ and $W_{\\star}$ on the dense grid, computes the RMSE, and prints the three RMSE values rounded to six decimal places in a single comma-separated list enclosed in square brackets, as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.interpolate import CubicSpline\n\ndef true_force(case_id, z):\n    if case_id == 1:\n        return np.sin(2*np.pi*z)\n    elif case_id == 2:\n        return 3.0*z - 1.0\n    elif case_id == 3:\n        return np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef true_pmf(case_id, z):\n    # W*(z) with W*(0)=0\n    if case_id == 1:\n        return (np.cos(2*np.pi*z) - 1.0) / (2*np.pi)\n    elif case_id == 2:\n        return -1.5*z*z + z\n    elif case_id == 3:\n        return 1.0 - np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef reconstruct_rmse(case_id, N, corrupt_interval, M=1001):\n    # Build nodes and exact samples\n    z_nodes = np.linspace(0.0, 1.0, N)\n    f_exact = true_force(case_id, z_nodes)\n\n    a, b = corrupt_interval\n    # Keep points not in corrupted interval (inclusive bounds)\n    mask = ~((z_nodes >= a)  (z_nodes = b))\n    # Ensure endpoints are kept (as stated in problem); just in case tolerance issues\n    mask[0] = True\n    mask[-1] = True\n\n    x = z_nodes[mask]\n    y = f_exact[mask]\n\n    # Fit natural cubic spline interpolant through uncorrupted points\n    spline = CubicSpline(x, y, bc_type='natural')\n\n    # Construct antiderivative to get PMF: W(z) = -(F(z) - F(0))\n    anti = spline.antiderivative()\n    F0 = anti(0.0)\n\n    # Dense grid for RMSE\n    z_dense = np.linspace(0.0, 1.0, M)\n    W_rec = -(anti(z_dense) - F0)\n    W_true = true_pmf(case_id, z_dense)\n\n    rmse = np.sqrt(np.mean((W_rec - W_true)**2))\n    return rmse\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (case_id, N, (a, b))\n        (1, 33, (0.45, 0.55)),  # Case 1\n        (2, 21, (0.35, 0.50)),  # Case 2\n        (3, 15, (0.30, 0.70)),  # Case 3\n    ]\n\n    results = []\n    for case_id, N, interval in test_cases:\n        rmse = reconstruct_rmse(case_id, N, interval, M=1001)\n        results.append(rmse)\n\n    # Round to six decimals and format\n    results_str = \",\".join(f\"{x:.6f}\" for x in results)\n    print(f\"[{results_str}]\")\n\nsolve()\n```", "id": "2448511"}]}