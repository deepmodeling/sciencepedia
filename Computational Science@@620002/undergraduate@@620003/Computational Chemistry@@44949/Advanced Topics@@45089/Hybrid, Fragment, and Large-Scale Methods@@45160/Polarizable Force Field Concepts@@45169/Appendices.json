{"hands_on_practices": [{"introduction": "Before modeling complex molecular systems, it is essential to master the fundamental physics of polarization. This exercise guides you through a first-principles derivation of the interaction energy between a point charge and a polarizable particle. By working through the electrostatics, you will solidify your understanding of how an induced dipole is formed and the energy associated with this process, which is a cornerstone of all induced-dipole force fields [@problem_id:2460442].", "problem": "A neutral, isotropic, and linearly polarizable particle with polarizability $\\alpha$ is placed at a distance $r$ from a fixed point charge $q$ in vacuum with permittivity $\\varepsilon_{0}$. The particle has no permanent dipole moment. The local electric field at the particle is assumed to be the field of the point charge alone, and the quasi-static limit applies. The induced dipole moment is defined by $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}_{\\text{loc}}$, where $\\mathbf{E}_{\\text{loc}}$ is the local electric field at the particle.\n\nUsing only these assumptions and fundamental electrostatics, determine the induction (polarization) energy of interaction between the charge and the polarizable particle as a function of $q$, $\\alpha$, $r$, and $\\varepsilon_{0}$. Provide your answer as a single closed-form analytic expression in terms of $q$, $\\alpha$, $r$, and $\\varepsilon_{0}$ only. Do not evaluate numerically and do not include units in your final expression.", "solution": "The problem statement is critically evaluated and found to be valid. It is a well-posed, scientifically grounded problem in classical electrostatics, containing all necessary information and no contradictions. We may therefore proceed with a rigorous solution.\n\nThe problem asks for the induction energy of interaction between a fixed point charge $q$ and a neutral, linearly polarizable particle. The specified givens are the charge $q$, the particle's scalar polarizability $\\alpha$, the distance $r$ between them, and the vacuum permittivity $\\varepsilon_{0}$. The particle has no permanent dipole moment.\n\nThe foundation of this interaction is the electric field generated by the point charge $q$. According to Coulomb's law, the magnitude of the electric field $\\mathbf{E}$ at a distance $r$ from the charge is given by:\n$$ E = \\frac{|q|}{4\\pi\\varepsilon_0 r^2} $$\nThe problem states that this field from the point charge is to be considered the local field $\\mathbf{E}_{\\text{loc}}$ at the particle. Thus, $E_{\\text{loc}} = E$.\n\nThe particle is linearly polarizable, which is described by the relation $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}_{\\text{loc}}$, where $\\boldsymbol{\\mu}$ is the induced dipole moment. Since $\\alpha$ is a positive scalar constant, the induced dipole moment $\\boldsymbol{\\mu}$ is always aligned with the local electric field $\\mathbf{E}_{\\text{loc}}$.\n\nThe total potential energy of this system, which we identify as the induction energy $U_{ind}$, is not simply the energy of a dipole in a field, $U = -\\boldsymbol{\\mu} \\cdot \\mathbf{E}$. That formula applies to a permanent dipole. For an induced dipole, we must account for the energy required to create the dipole in the first place. The total induction energy is the sum of two terms: first, the work done on the particle to polarize it, $W_{pol}$, and second, the interaction energy of the resulting dipole with the field that created it, $U_{int}$.\n\nThe work done to polarize the particle against its internal restoring forces is stored as potential energy within the particle. This energy is calculated by integrating the work element $d W = E' d\\mu'$ from a state of no polarization to the final state:\n$$ W_{pol} = \\int_0^{\\mu} E' d\\mu' $$\nGiven the linear relationship $\\mu' = \\alpha E'$, we can write $d\\mu' = \\alpha dE'$. The integral is then performed with respect to the field strength:\n$$ W_{pol} = \\int_0^{E} E' (\\alpha dE') = \\alpha \\int_0^{E} E' dE' = \\frac{1}{2} \\alpha E^2 $$\nThis term represents the energy stored in the polarized particle.\n\nNext, the potential energy of the induced dipole $\\boldsymbol{\\mu}$ interacting with the external field $\\mathbf{E}$ is given by the standard formula:\n$$ U_{int} = -\\boldsymbol{\\mu} \\cdot \\mathbf{E} $$\nSubstituting the definition of the induced dipole, $\\boldsymbol{\\mu} = \\alpha \\mathbf{E}$, we obtain:\n$$ U_{int} = -(\\alpha \\mathbf{E}) \\cdot \\mathbf{E} = -\\alpha E^2 $$\nThe total induction energy is the sum of these two contributions:\n$$ U_{ind} = W_{pol} + U_{int} = \\frac{1}{2}\\alpha E^2 - \\alpha E^2 = -\\frac{1}{2}\\alpha E^2 $$\nThis result, $U_{ind} = -\\frac{1}{2}\\alpha E^2$, is a cornerstone of polarization phenomena. The factor of $\\frac{1}{2}$ correctly distinguishes the energy of an induced dipole from that of a permanent one. An alternative derivation based on integrating the force $\\mathbf{F} = (\\boldsymbol{\\mu} \\cdot \\nabla)\\mathbf{E}$ over distance from infinity yields the same potential energy expression, confirming its correctness.\n\nTo find the final expression, we substitute the square of the electric field magnitude, $E^2$, into our energy equation.\n$$ E^2 = \\left(\\frac{|q|}{4\\pi\\varepsilon_0 r^2}\\right)^2 = \\frac{q^2}{(4\\pi\\varepsilon_0)^2 r^4} $$\nNote that the energy depends on $q^2$, so the interaction is attractive regardless of the sign of the charge $q$.\n\nSubstituting this into the expression for $U_{ind}$, we arrive at the final analytical expression for the induction energy:\n$$ U_{ind} = -\\frac{1}{2} \\alpha \\left( \\frac{q^2}{(4\\pi\\varepsilon_0)^2 r^4} \\right) = - \\frac{\\alpha q^2}{2(4\\pi\\varepsilon_0)^2 r^4} $$\nThis expression represents the complete solution as a function of the given parameters $q$, $\\alpha$, $r$, and $\\varepsilon_0$.", "answer": "$$ \\boxed{- \\frac{\\alpha q^2}{2(4 \\pi \\varepsilon_{0})^2 r^4}} $$", "id": "2460442"}, {"introduction": "In a real system, polarizable atoms do not just respond to static charges; they respond to each other in a coupled, self-consistent manner. This exercise simulates the mutual induction between two closely approaching particles, a scenario that can lead to a critical failure mode known as the \"polarization catastrophe.\" By implementing the model and identifying the point of divergence, you will gain hands-on experience with a key challenge in force field development and appreciate why advanced models require short-range damping corrections [@problem_id:2460405].", "problem": "You will model the mutual induction between two isotropic, polarizable point particles on the same line to illustrate the onset of the polarization catastrophe as they approach each other. Each particle has an isotropic polarizability and is subjected to a uniform external electric field colinear with the interparticle axis.\n\nGiven two particles located on the $z$-axis and separated by a center-to-center distance $r$, assume that the external electric field is uniform with magnitude $E_0$ along $+\\hat{z}$. The induced dipole moment on particle $i$ is defined by the linear response relation $\\mu_i = \\alpha^{\\mathrm{SI}}_i E^{\\mathrm{loc}}_i$, where $\\alpha^{\\mathrm{SI}}_i$ is the polarizability in the International System of Units (SI), and $E^{\\mathrm{loc}}_i$ is the local field at particle $i$. For two colinear dipoles on the $z$-axis, the on-axis electric field due to a dipole $\\mu$ at a distance $r$ is $E_z = \\dfrac{2 \\mu}{4 \\pi \\varepsilon_0 r^3}$, directed along $+\\hat{z}$ if $\\mu$ is along $+\\hat{z}$. Therefore, the local fields satisfy\n$$\nE^{\\mathrm{loc}}_1 = E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3}, \\quad\nE^{\\mathrm{loc}}_2 = E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3}.\n$$\nUse the relation between the polarizability in volume units (common in chemistry) and SI units:\n$$\n\\alpha^{\\mathrm{SI}}_i = 4 \\pi \\varepsilon_0 \\, \\alpha^{\\mathrm{vol}}_i,\n$$\nwhere $\\alpha^{\\mathrm{vol}}_i$ is a volume with units of $\\mathrm{m}^3$. The vacuum permittivity is $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\ \\mathrm{F\\,m^{-1}}$. Use $1\\ \\mathrm{\\AA} = 1 \\times 10^{-10}\\ \\mathrm{m}$ to convert distances and $1\\ \\mathrm{\\AA}^3 = 1 \\times 10^{-30}\\ \\mathrm{m}^3$ to convert polarizability volumes. Report induced dipole magnitudes in Debye, where $1\\ \\mathrm{D} = 3.33564 \\times 10^{-30}\\ \\mathrm{C\\,m}$.\n\nBy first principles, the coupled linear response equations are\n$$\n\\mu_1 = \\alpha^{\\mathrm{SI}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right), \\qquad\n\\mu_2 = \\alpha^{\\mathrm{SI}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right).\n$$\nFor each test case below, determine whether these equations admit a unique finite solution for $(\\mu_1,\\mu_2)$ (which is equivalent to the associated homogeneous system, obtained by setting $E_0 = 0$, having only the trivial solution). If and only if a unique finite solution exists, compute the magnitude $|\\mu_1|$ in Debye. If the coupled equations do not have a unique finite solution (that is, the homogeneous system has a nonzero solution), return the special floating-point value NaN for that test case. Treat the homogeneous-system nonuniqueness as occurring when the determinant of the associated $2 \\times 2$ linear operator is numerically zero within a relative tolerance of $\\tau = 1 \\times 10^{-12}$.\n\nExpress the final answers in Debye, rounded to six significant digits.\n\nUse the following test suite. Each test case is a tuple $(\\alpha^{\\mathrm{vol}}_1[\\mathrm{\\AA}^3], \\alpha^{\\mathrm{vol}}_2[\\mathrm{\\AA}^3], r[\\mathrm{\\AA}], E_0[\\mathrm{V/m}])$:\n- Test $1$: $(10.0, 10.0, 5.0, 1.0 \\times 10^{8})$\n- Test $2$: $(10.0, 10.0, 2.75, 1.0 \\times 10^{8})$\n- Test $3$: $(10.0, 10.0, 2.714417617, 1.0 \\times 10^{8})$  (chosen to be at the analytical catastrophe threshold within machine precision)\n- Test $4$: $(10.0, 10.0, 2.60, 1.0 \\times 10^{8})$\n- Test $5$: $(5.0, 50.0, 2.50, 1.0 \\times 10^{8})$\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[x1,x2,x3,x4,x5]\"). Each $x_k$ must be either a single floating-point number (the rounded magnitude in Debye) or the token \"nan\" to represent NaN. No additional characters or whitespace are permitted.", "solution": "The problem requires the analysis of a system of coupled linear equations describing the mutual induction of two polarizable particles in a uniform external electric field. The primary task is to determine the conditions under which a unique, finite solution for the induced dipole moments exists and to calculate the magnitude of one of the dipole moments, $|\\mu_1|$, when such a solution is found. This phenomenon is a classic example of polarization response in computational chemistry, and the divergence of the solution corresponds to the polarization catastrophe.\n\nThe governing equations for the induced dipole moments, $\\mu_1$ and $\\mu_2$, are given as:\n$$\n\\mu_1 = \\alpha^{\\mathrm{SI}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right)\n$$\n$$\n\\mu_2 = \\alpha^{\\mathrm{SI}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right)\n$$\nHere, $\\alpha^{\\mathrm{SI}}_i$ is the polarizability in SI units, $E_0$ is the external field magnitude, $r$ is the interparticle distance, and $\\varepsilon_0$ is the vacuum permittivity.\n\nTo simplify this system, we use the provided relation between polarizability in SI units and polarizability in volume units, $\\alpha^{\\mathrm{vol}}_i$:\n$$\n\\alpha^{\\mathrm{SI}}_i = 4 \\pi \\varepsilon_0 \\, \\alpha^{\\mathrm{vol}}_i\n$$\nSubstituting this into the coupled equations yields:\n$$\n\\mu_1 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 \\left( E_0 + \\frac{2 \\mu_2}{4 \\pi \\varepsilon_0 r^3} \\right) = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 E_0 + \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\mu_2\n$$\n$$\n\\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 \\left( E_0 + \\frac{2 \\mu_1}{4 \\pi \\varepsilon_0 r^3} \\right) = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 E_0 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\mu_1\n$$\nThis simplification is valid as long as $\\alpha^{\\mathrm{vol}}_i$ and $r^3$ are expressed in consistent units (e.g., $\\mathrm{m}^3$), making the ratio $\\alpha^{\\mathrm{vol}}_i/r^3$ dimensionless.\n\nWe can rearrange these equations into a standard matrix form, $A \\mathbf{x} = \\mathbf{b}$, where $\\mathbf{x} = [\\mu_1, \\mu_2]^T$:\n$$\n\\mu_1 - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_1 E_0\n$$\n$$\n- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\mu_1 + \\mu_2 = 4 \\pi \\varepsilon_0 \\alpha^{\\mathrm{vol}}_2 E_0\n$$\nThis corresponds to the matrix system:\n$$\n\\begin{pmatrix}\n1 & - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\\\\n- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} & 1\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mu_1 \\\\\n\\mu_2\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\\\\n4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2\n\\end{pmatrix}\n$$\nA unique, finite solution for $(\\mu_1, \\mu_2)$ exists if and only if the determinant of the coefficient matrix is non-zero. The determinant is:\n$$\n\\det(A) = (1)(1) - \\left(- \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\right) \\left(- \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3} \\right) = 1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}\n$$\nThe polarization catastrophe occurs when $\\det(A) = 0$. The problem specifies a numerical criterion for this condition: the system is considered to not have a unique finite solution if $|\\det(A)| \\le \\tau$, where the tolerance $\\tau = 1 \\times 10^{-12}$. If this condition is met, the result is NaN.\n\nIf $|\\det(A)| > \\tau$, we proceed to calculate $\\mu_1$. Using Cramer's rule:\n$$\n\\mu_1 = \\frac{\\det \\begin{pmatrix} 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 & - \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3} \\\\ 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2 & 1 \\end{pmatrix}}{\\det(A)}\n= \\frac{(4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1)(1) - (- \\frac{2 \\alpha^{\\mathrm{vol}}_1}{r^3})(4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_2)}{1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}}\n$$\nSimplifying the numerator:\n$$\n\\text{Numerator} = 4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\left(1 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3}\\right)\n$$\nThus, the expression for $\\mu_1$ is:\n$$\n\\mu_1 = \\frac{4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1 \\left(1 + \\frac{2 \\alpha^{\\mathrm{vol}}_2}{r^3}\\right)}{1 - \\frac{4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2}{r^6}}\n$$\nFor the calculation, it is crucial to handle units correctly. The ratios $\\alpha^{\\mathrm{vol}}/r^3$ and $\\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2/r^6$ are dimensionless, so the provided values in $\\mathrm{\\AA}^3$ and $\\mathrm{\\AA}$ can be used directly for these terms. However, the prefactor $4 \\pi \\varepsilon_0 E_0 \\alpha^{\\mathrm{vol}}_1$ must be computed in SI units to yield $\\mu_1$ in units of Coulomb-meters ($C \\cdot m$). This requires converting $\\alpha^{\\mathrm{vol}}_1$ from $\\mathrm{\\AA}^3$ to $\\mathrm{m}^3$. The resulting $\\mu_1$ in C$\\cdot$m is then converted to Debye ($D$) and its magnitude, $|\\mu_1|$, is rounded to six significant digits.\n\nThe algorithm is as follows for each test case:\n1.  Read the input values: $\\alpha^{\\mathrm{vol}}_1$ [$\\mathrm{\\AA}^3$], $\\alpha^{\\mathrm{vol}}_2$ [$\\mathrm{\\AA}^3$], $r$ [$\\mathrm{\\AA}$], and $E_0$ [V/m].\n2.  Calculate the determinant $D = 1 - 4 \\alpha^{\\mathrm{vol}}_1 \\alpha^{\\mathrm{vol}}_2 / r^6$.\n3.  If $|D| \\le 1 \\times 10^{-12}$, the solution is divergent. The result for this case is NaN.\n4.  Otherwise, calculate $\\mu_1$ in SI units using the derived formula. Ensure $\\alpha^{\\mathrm{vol}}_1$ is converted to $\\mathrm{m}^3$ for the numerator prefactor.\n5.  Take the absolute value to find the magnitude $|\\mu_1|$.\n6.  Convert $|\\mu_1|$ from C$\\cdot$m to Debye using the given conversion factor $1 \\mathrm{D} = 3.33564 \\times 10^{-30} \\mathrm{C \\cdot m}$.\n7.  Format the result to six significant digits.\nThis procedure is applied to each test case to produce the final list of results.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the induced dipole moment for a system of two interacting\n    polarizable particles in an external electric field, checking for the\n    polarization catastrophe.\n    \"\"\"\n    # Define physical and conversion constants.\n    # Vacuum permittivity in F/m.\n    EPSILON_0 = 8.8541878128e-12\n    # Conversion from Angstrom^3 to m^3.\n    A3_TO_M3 = 1e-30\n    # Conversion from C*m to Debye.\n    C_M_TO_D = 1 / 3.33564e-30\n    # Numerical tolerance for determinant singularity.\n    TOLERANCE = 1e-12\n\n    # Define the test suite. Each tuple contains:\n    # (alpha_vol_1 [A^3], alpha_vol_2 [A^3], r [A], E_0 [V/m])\n    test_cases = [\n        (10.0, 10.0, 5.0, 1.0e8),\n        (10.0, 10.0, 2.75, 1.0e8),\n        (10.0, 10.0, 2.714417617, 1.0e8),\n        (10.0, 10.0, 2.60, 1.0e8),\n        (5.0, 50.0, 2.50, 1.0e8),\n    ]\n\n    results = []\n    \n    for alpha_v1_A3, alpha_v2_A3, r_A, E0_Vm in test_cases:\n        # The terms in the determinant calculation are dimensionless,\n        # so we can use the provided units (Angstroms) directly.\n        r6 = r_A**6\n        \n        # Calculate the determinant of the linear system's matrix.\n        det = 1.0 - (4.0 * alpha_v1_A3 * alpha_v2_A3) / r6\n        \n        # Check for polarization catastrophe against the given tolerance.\n        if abs(det) <= TOLERANCE:\n            results.append(\"nan\")\n        else:\n            # Convert polarizability from Angstrom^3 to m^3 for SI calculation.\n            alpha_v1_SI = alpha_v1_A3 * A3_TO_M3\n            r3 = r_A**3\n            \n            # The term in the numerator is also dimensionless.\n            num_dimless_term = 1.0 + (2.0 * alpha_v2_A3) / r3\n            \n            # Calculate the numerator of the expression for mu_1 in SI units.\n            numerator_SI = 4.0 * np.pi * EPSILON_0 * E0_Vm * alpha_v1_SI * num_dimless_term\n            \n            # Calculate mu_1 in SI units (C*m).\n            mu1_SI = numerator_SI / det\n            \n            # Calculate the magnitude of mu_1 in Debye.\n            mu1_D_magnitude = abs(mu1_SI * C_M_TO_D)\n            \n            # Format the result to six significant digits.\n            formatted_result = f\"{mu1_D_magnitude:.6g}\"\n            results.append(formatted_result)\n\n    # Print the final list of results in the specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "2460405"}, {"introduction": "The power of polarizable models lies in their ability to describe the nuanced electrostatic environments within large biomolecules. This practice bridges the gap from simple systems to practical application by having you design an algorithm to pinpoint regions of high polarization energy in a model protein. By implementing a simplified, non-iterative polarization model, you will learn how these calculations can be used to analyze a biomolecular structure and identify electrostatically-active sites that may be crucial for function [@problem_id:2460445].", "problem": "You are given the task of designing a complete, runnable program that, starting from foundational electrostatics and linear response, identifies the residue (region) in a model protein snapshot where the polarization energy is most significant. Use only the electric field due to permanent charges to drive polarization, and neglect mutual induction between induced dipoles. Start from well-established principles: the vector superposition of electric fields from point charges and the linear relation between an induced dipole and the local electric field for an isotropic polarizable site. From these principles, derive a computable, first-order measure of the polarization energy per site that depends only on the permanent charges and the site polarizabilities, and then aggregate these contributions by residue to determine which residue has the largest magnitude polarization energy. Break ties by selecting the smallest residue index when values are equal within a tolerance. Use reduced electrostatic units where the Coulomb constant is $k = 1$, so that no physical unit conversion factors appear. The final outputs are residue indices and therefore unitless integers.\n\nAlgorithmic requirements:\n- Model each atom $i$ by a position vector $\\mathbf{r}_i \\in \\mathbb{R}^3$, a permanent charge $q_i$, and an isotropic polarizability $\\alpha_i \\ge 0$.\n- Define a residue mapping that assigns each atom index $i$ to a residue index $R(i) \\in \\{0,1,\\dots, M-1\\}$ for $M$ residues.\n- Use only the electric field created by permanent charges to define the local field at each polarizable site; exclude any self-contribution of an atom to its own local field.\n- Aggregate a first-order polarization energy contribution per residue by summing site contributions over its atoms, and select the residue with the largest magnitude polarization energy. If multiple residues have equal values within a tolerance $\\varepsilon = 10^{-12}$, choose the smallest residue index among them.\n\nYour program must compute the result for each of the following test cases and print all results in a single line as a comma-separated list enclosed in square brackets. Indices are zero-based integers.\n\nTest suite:\n- Test case $1$ (three residues, a charged–neutral–charged linear arrangement intended to produce a strong field in the central residue):\n  - Number of atoms: $6$.\n  - Positions $\\mathbf{r}_i$ (in arbitrary reduced length units): \n    - $\\mathbf{r}_0 = (0.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.2, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (0.6, 0.0, 0.0)$,\n    - $\\mathbf{r}_4 = (1.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_5 = (1.2, 0.0, 0.0)$.\n  - Charges $q_i$: $[+0.5, +0.3, 0.0, 0.0, -0.6, -0.3]$.\n  - Polarizabilities $\\alpha_i$: $[0.8, 0.5, 1.0, 1.2, 0.7, 0.4]$.\n  - Residue map $R(i)$: $[0, 0, 1, 1, 2, 2]$.\n  - Number of residues $M = 3$.\n- Test case $2$ (one residue with zero polarizability, strong external dipole field spanning a central polarizable residue):\n  - Number of atoms: $6$.\n  - Positions $\\mathbf{r}_i$:\n    - $\\mathbf{r}_0 = (0.0, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.1, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (0.6, 0.0, 0.0)$,\n    - $\\mathbf{r}_4 = (-0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_5 = (1.5, 0.0, 0.0)$.\n  - Charges $q_i$: $[0.0, 0.0, 0.0, 0.0, +1.0, -1.0]$.\n  - Polarizabilities $\\alpha_i$: $[0.0, 0.0, 1.0, 1.0, 0.2, 0.2]$.\n  - Residue map $R(i)$: $[0, 0, 1, 1, 2, 2]$.\n  - Number of residues $M = 3$.\n- Test case $3$ (symmetry-induced tie between two polarizable residues, resolved by smallest index):\n  - Number of atoms: $4$.\n  - Positions $\\mathbf{r}_i$:\n    - $\\mathbf{r}_0 = (-0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_1 = (0.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_2 = (-1.5, 0.0, 0.0)$,\n    - $\\mathbf{r}_3 = (1.5, 0.0, 0.0)$.\n  - Charges $q_i$: $[0.0, 0.0, +1.0, -1.0]$.\n  - Polarizabilities $\\alpha_i$: $[1.0, 1.0, 0.0, 0.0]$.\n  - Residue map $R(i)$: $[0, 1, 2, 2]$.\n  - Number of residues $M = 3$.\n\nImplementation details to enforce:\n- Use reduced electrostatic units with $k = 1$; distances appear only through geometric factors, and results are unitless indices.\n- Angles do not appear; no angle unit is required.\n- Ties are defined by absolute differences less than or equal to $\\varepsilon = 10^{-12}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3]$), where each $r_j$ is the selected residue index for test case $j$.", "solution": "The problem statement is subjected to validation and is found to be valid. It is scientifically grounded in the principles of classical electrostatics, mathematically well-posed, and provides a complete and unambiguous specification for the required computation. We therefore proceed directly to the derivation of the solution.\n\nThe system consists of a set of $N$ atomic sites, where each site $i$ is characterized by a position vector $\\mathbf{r}_i \\in \\mathbb{R}^3$, a static partial charge $q_i$, and an isotropic scalar polarizability $\\alpha_i \\ge 0$. The atoms are grouped into $M$ disjoint residues, specified by a mapping $R(i)$ from an atom index to a residue index.\n\nThe first step is to determine the electric field at each polarizable site $i$. According to the problem, this field, denoted $\\mathbf{E}_i^0$, is generated only by the permanent charges $q_j$ of all other atoms ($j \\neq i$). The contribution to the field at $\\mathbf{r}_i$ from a point charge $q_j$ at $\\mathbf{r}_j$ is given by Coulomb's Law. Using the specified reduced units where the electrostatic constant $k=1$, this is:\n$$\n\\mathbf{E}_{ij} = \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}\n$$\nBy the principle of superposition, the total electric field at site $i$ due to the permanent charge distribution is the vector sum over all other sites:\n$$\n\\mathbf{E}_i^0 = \\sum_{j=0, j \\neq i}^{N-1} \\mathbf{E}_{ij} = \\sum_{j=0, j \\neq i}^{N-1} \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}\n$$\nThis field $\\mathbf{E}_i^0$ is the \"zeroth-order\" field, as it arises solely from the fixed, permanent charges.\n\nThe second step is to calculate the dipole moment $\\mathbf{p}_i$ induced at site $i$. For an isotropic site with polarizability $\\alpha_i$, the induced dipole is linearly proportional to the local electric field. The problem specifies a first-order approximation where mutual polarization is neglected. Thus, the inducing field is simply $\\mathbf{E}_i^0$.\n$$\n\\mathbf{p}_i = \\alpha_i \\mathbf{E}_i^0\n$$\nThis approximation is common and defines a non-self-consistent polarization model. If $\\alpha_i = 0$, then no dipole is induced, $\\mathbf{p}_i = \\mathbf{0}$, and the site makes no contribution to the polarization energy.\n\nThe third step is to compute the polarization energy. The potential energy $U_i$ of an induced dipole $\\mathbf{p}_i$ in the field $\\mathbf{E}_i^0$ that created it is given by:\n$$\nU_i = -\\frac{1}{2} \\mathbf{p}_i \\cdot \\mathbf{E}_i^0\n$$\nThe factor of $\\frac{1}{2}$ arises because the energy stored is the work done to separate the charge within the polarizable entity, which grows linearly with the field. Substituting the expression for $\\mathbf{p}_i$, we obtain a direct formula for the polarization energy of site $i$:\n$$\nU_i = -\\frac{1}{2} \\alpha_i |\\mathbf{E}_i^0|^2\n$$\nSince $\\alpha_i \\ge 0$ and $|\\mathbf{E}_i^0|^2 \\ge 0$, the site polarization energy $U_i$ is always less than or equal to zero.\n\nThe fourth step is to aggregate these site-level energies by residue. The total polarization energy of a residue $k$, denoted $U_{R_k}$, is the scalar sum of the polarization energies of all atoms $i$ that belong to residue $k$. Let $S_k = \\{i \\mid R(i) = k\\}$ be the set of indices of atoms in residue $k$. Then:\n$$\nU_{R_k} = \\sum_{i \\in S_k} U_i = \\sum_{i \\in S_k} \\left(-\\frac{1}{2} \\alpha_i |\\mathbf{E}_i^0|^2\\right)\n$$\n\nThe final objective is to identify the residue with the largest magnitude of polarization energy, $|U_{R_k}|$. The computational procedure is as follows:\n1. For a given system of $N$ atoms and $M$ residues, initialize an array of residue energies, $E_{\\text{res}}$, of size $M$ to all zeros.\n2. For each atom $i$ from $0$ to $N-1$:\n    a. If the polarizability $\\alpha_i$ is zero, its energy contribution is zero. Proceed to the next atom.\n    b. Calculate the electric field vector $\\mathbf{E}_i^0 = \\sum_{j \\neq i} \\frac{q_j (\\mathbf{r}_i - \\mathbf{r}_j)}{|\\mathbf{r}_i - \\mathbf{r}_j|^3}$.\n    c. Calculate the squared magnitude of this field, $|\\mathbf{E}_i^0|^2 = \\mathbf{E}_i^0 \\cdot \\mathbf{E}_i^0$.\n    d. Compute the site polarization energy $U_i = -0.5 \\times \\alpha_i \\times |\\mathbf{E}_i^0|^2$.\n    e. Determine the residue index $k = R(i)$ for atom $i$.\n    f. Add the site energy to the total for its residue: $E_{\\text{res}}[k] = E_{\\text{res}}[k] + U_i$.\n3. After iterating through all atoms, the array $E_{\\text{res}}$ contains the total polarization energy for each residue.\n4. Calculate the absolute value of each element in $E_{\\text{res}}$ to get the energy magnitudes.\n5. Find the maximum magnitude, $U_{\\max} = \\max_k |E_{\\text{res}}[k]|$.\n6. Identify the set of residue indices $K_{\\text{max}} = \\{k \\mid |E_{\\text{res}}[k]| \\ge U_{\\max} - \\varepsilon\\}$, where $\\varepsilon = 10^{-12}$ is the specified tolerance for floating-point comparisons.\n7. The final answer is the smallest index in this set, $\\min(K_{\\text{max}})$. This resolves any ties by selecting the lowest residue index among those with the maximum energy magnitude.\nThis procedure is deterministic and provides a unique solution for any valid input.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for all defined test cases.\n    The function encapsulates the problem's logic and prints the final result\n    in the specified format.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1\n        {\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], [0.2, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [0.6, 0.0, 0.0], [1.0, 0.0, 0.0], [1.2, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([+0.5, +0.3, 0.0, 0.0, -0.6, -0.3]),\n            \"polarizabilities\": np.array([0.8, 0.5, 1.0, 1.2, 0.7, 0.4]),\n            \"residue_map\": np.array([0, 0, 1, 1, 2, 2]),\n            \"num_residues\": 3\n        },\n        # Test case 2\n        {\n            \"positions\": np.array([\n                [0.0, 0.0, 0.0], [0.1, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [0.6, 0.0, 0.0], [-0.5, 0.0, 0.0], [1.5, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([0.0, 0.0, 0.0, 0.0, +1.0, -1.0]),\n            \"polarizabilities\": np.array([0.0, 0.0, 1.0, 1.0, 0.2, 0.2]),\n            \"residue_map\": np.array([0, 0, 1, 1, 2, 2]),\n            \"num_residues\": 3\n        },\n        # Test case 3\n        {\n            \"positions\": np.array([\n                [-0.5, 0.0, 0.0], [0.5, 0.0, 0.0],\n                [-1.5, 0.0, 0.0], [1.5, 0.0, 0.0]\n            ]),\n            \"charges\": np.array([0.0, 0.0, +1.0, -1.0]),\n            \"polarizabilities\": np.array([1.0, 1.0, 0.0, 0.0]),\n            \"residue_map\": np.array([0, 1, 2, 2]),\n            \"num_residues\": 3\n        }\n    ]\n\n    results = []\n    TOLERANCE = 1e-12\n\n    for case in test_cases:\n        positions = case[\"positions\"]\n        charges = case[\"charges\"]\n        polarizabilities = case[\"polarizabilities\"]\n        residue_map = case[\"residue_map\"]\n        num_residues = case[\"num_residues\"]\n        \n        num_atoms = len(positions)\n        residue_energies = np.zeros(num_residues)\n\n        for i in range(num_atoms):\n            alpha_i = polarizabilities[i]\n            # If site is not polarizable, its energy contribution is zero.\n            if alpha_i == 0.0:\n                continue\n\n            pos_i = positions[i]\n            E_i = np.zeros(3)\n\n            # Sum electric field contributions from all other atoms j\n            for j in range(num_atoms):\n                if i == j:\n                    continue\n                \n                q_j = charges[j]\n                if q_j == 0.0:\n                    continue\n                    \n                pos_j = positions[j]\n                \n                # Vector from j to i\n                r_ij_vec = pos_i - pos_j\n                dist_sq = np.dot(r_ij_vec, r_ij_vec)\n                \n                # Positions are distinct in test data, so dist_sq > 0\n                dist = np.sqrt(dist_sq)\n                dist_cubed = dist_sq * dist\n                \n                # E_field = (k*q / r^3) * r_vec, with k=1\n                E_i += (q_j / dist_cubed) * r_ij_vec\n            \n            # Site polarization energy: U_i = -1/2 * alpha_i * |E_i|^2\n            E_i_mag_sq = np.dot(E_i, E_i)\n            U_i = -0.5 * alpha_i * E_i_mag_sq\n            \n            # Aggregate energy into the corresponding residue\n            res_idx = residue_map[i]\n            residue_energies[res_idx] += U_i\n            \n        # Find residue with the largest magnitude of polarization energy\n        magnitudes = np.abs(residue_energies)\n        max_magnitude = np.max(magnitudes)\n        \n        # Find the smallest index of all residues that are tied for the max magnitude\n        # within the given tolerance.\n        candidate_indices = np.where(max_magnitude - magnitudes <= TOLERANCE)[0]\n        result_index = np.min(candidate_indices)\n        \n        results.append(result_index)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2460445"}]}