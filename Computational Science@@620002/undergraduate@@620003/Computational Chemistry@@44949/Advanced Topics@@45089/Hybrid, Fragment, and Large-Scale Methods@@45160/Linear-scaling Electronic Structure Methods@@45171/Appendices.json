{"hands_on_practices": [{"introduction": "The bottleneck in traditional electronic structure calculations is often the computation of two-electron repulsion integrals, which scales unfavorably as the fourth power of system size, $N^4$. Linear-scaling methods overcome this by exploiting the principle that interactions between distant electrons are negligible, allowing most integrals to be \"screened\" or discarded. This exercise [@problem_id:2457312] provides a concrete, hands-on opportunity to apply a distance-based screening protocol, building an intuitive understanding of how sparsity is introduced at the most fundamental level.", "problem": "Consider a model screening procedure motivated by linear-scaling electronic structure methods for a square $\\mathrm{H}_4$ cluster in a minimal basis of localized $1s$ Atomic Orbitals (AO). Four hydrogen nuclei are fixed at Cartesian coordinates (in arbitrary length units) $\\mathbf{R}_1=(0,0,0)$, $\\mathbf{R}_2=(L,0,0)$, $\\mathbf{R}_3=(L,L,0)$, and $\\mathbf{R}_4=(0,L,0)$, where $L>0$. Let $(\\mu\\nu|\\lambda\\sigma)$ denote a two-electron Coulomb repulsion integral in chemists’ notation over AOs centered at nuclei indexed by $\\mu,\\nu,\\lambda,\\sigma \\in \\{1,2,3,4\\}$.\n\nYou are to apply the following purely distance-based screening rule to the full ordered list of all $(\\mu\\nu|\\lambda\\sigma)$ (that is, all $4^4$ ordered quadruples):\n\n1. Pair-compactness condition: For a pair of AO indices $(\\mu,\\nu)$, define the inter-center distance $d_{\\mu\\nu}=\\|\\mathbf{R}_\\mu-\\mathbf{R}_\\nu\\|$. The pair $(\\mu,\\nu)$ is deemed compact if $d_{\\mu\\nu}\\le r_p$, with $r_p=L$. Similarly define compactness for $(\\lambda,\\sigma)$.\n\n2. Pair-centroid separation condition: For a pair $(\\mu,\\nu)$, define its centroid as $\\mathbf{C}_{\\mu\\nu}=\\tfrac{1}{2}(\\mathbf{R}_\\mu+\\mathbf{R}_\\nu)$. Given two pairs $(\\mu,\\nu)$ and $(\\lambda,\\sigma)$, define the pair-centroid separation $D_{\\mu\\nu,\\lambda\\sigma}=\\|\\mathbf{C}_{\\mu\\nu}-\\mathbf{C}_{\\lambda\\sigma}\\|$. The two-electron integral $(\\mu\\nu|\\lambda\\sigma)$ is retained only if $D_{\\mu\\nu,\\lambda\\sigma}\\le R_c$, with $R_c=\\tfrac{L}{2}$.\n\nA two-electron integral $(\\mu\\nu|\\lambda\\sigma)$ is retained by the screening if and only if both pair-compactness conditions and the pair-centroid separation condition are satisfied. Count all retained integrals as distinct by their ordered indices $(\\mu,\\nu,\\lambda,\\sigma)$; do not invoke any permutation symmetries.\n\nWhat is the total number of ordered two-electron integrals $(\\mu\\nu|\\lambda\\sigma)$ that are retained by this screening rule? Provide your answer as a single integer. No rounding is required.", "solution": "The problem requires us to count the total number of ordered two-electron integrals $(\\mu\\nu|\\lambda\\sigma)$, with indices $\\mu, \\nu, \\lambda, \\sigma$ each ranging from $1$ to $4$, that are retained by a specific three-part screening rule. An integral is retained if and only if all three of the following conditions are met:\n$1$. The pair $(\\mu,\\nu)$ is compact: $d_{\\mu\\nu} = \\|\\mathbf{R}_\\mu - \\mathbf{R}_\\nu\\| \\le r_p$, where $r_p=L$.\n$2$. The pair $(\\lambda,\\sigma)$ is compact: $d_{\\lambda\\sigma} = \\|\\mathbf{R}_\\lambda - \\mathbf{R}_\\sigma\\| \\le r_p$, where $r_p=L$.\n$3$. The pair-centroid separation is small: $D_{\\mu\\nu,\\lambda\\sigma} = \\|\\mathbf{C}_{\\mu\\nu} - \\mathbf{C}_{\\lambda\\sigma}\\| \\le R_c$, where $R_c = \\frac{L}{2}$.\n\nThe solution proceeds in a sequence of logical steps: first, we identify all pairs of atomic orbital indices that satisfy the compactness condition. Second, we compute the centroids for these compact pairs. Third, using the set of compact pairs and their centroids, we enumerate all combinations of pairs $((\\mu,\\nu), (\\lambda,\\sigma))$ that satisfy the pair-centroid separation condition.\n\nThe four hydrogen nuclei are located at the vertices of a square in the $xy$-plane: $\\mathbf{R}_1=(0,0,0)$, $\\mathbf{R}_2=(L,0,0)$, $\\mathbf{R}_3=(L,L,0)$, and $\\mathbf{R}_4=(0,L,0)$.\n\nStep 1: Identify the set of compact pairs, $S_p$.\nWe must find all ordered pairs $(\\mu,\\nu)$ such that the distance $d_{\\mu\\nu} = \\|\\mathbf{R}_\\mu - \\mathbf{R}_\\nu\\|$ is less than or equal to $L$. Let us compute the relevant squared distances, $d_{\\mu\\nu}^2$:\n- For $\\mu=\\nu$: $d_{\\mu\\mu}^2 = 0$. The distance is $d_{\\mu\\mu}=0$. Since $0 \\le L$, all $4$ pairs of the form $(\\mu,\\mu)$ are compact: $(1,1), (2,2), (3,3), (4,4)$.\n- For adjacent nuclei (sides of the square): $d_{12}^2 = L^2$, $d_{23}^2 = L^2$, $d_{34}^2 = L^2$, $d_{41}^2 = L^2$. The distance is $d_{\\mu\\nu}=L$ in these cases. Since $L \\le L$, these pairs are compact. This gives us the pairs $(1,2), (2,1), (2,3), (3,2), (3,4), (4,3), (4,1), (1,4)$, for a total of $8$ pairs.\n- For opposite nuclei (diagonals of the square): $d_{13}^2 = L^2+L^2 = 2L^2$ and $d_{24}^2 = L^2+L^2 = 2L^2$. The distance is $d_{\\mu\\nu}=L\\sqrt{2}$. Since $L\\sqrt{2} > L$ (as $L>0$), these pairs are not compact.\n\nThe set of compact pairs, $S_p$, thus consists of $4+8=12$ pairs:\n$S_p = \\{ (1,1), (2,2), (3,3), (4,4), (1,2), (2,1), (2,3), (3,2), (3,4), (4,3), (1,4), (4,1) \\}$.\n\nStep 2: Determine the centroids for all compact pairs.\nThe centroid for a pair $(\\mu,\\nu)$ is $\\mathbf{C}_{\\mu\\nu} = \\frac{1}{2}(\\mathbf{R}_\\mu + \\mathbf{R}_\\nu)$.\nWe find two distinct types of centroids corresponding to the compact pairs:\n- For pairs of the form $(\\mu,\\mu)$, the centroid is the position of the nucleus itself: $\\mathbf{C}_{\\mu\\mu} = \\mathbf{R}_\\mu$. These are the $4$ vertices of the square, which we call \"vertex centroids\".\n    - $\\mathbf{C}_{11} = (0,0,0)$\n    - $\\mathbf{C}_{22} = (L,0,0)$\n    - $\\mathbf{C}_{33} = (L,L,0)\n    - $\\mathbf{C}_{44} = (0,L,0)$\n    Each vertex centroid corresponds to exactly $1$ compact pair.\n- For pairs of adjacent nuclei $(\\mu,\\nu)$, the centroid is the midpoint of the edge connecting them. Note that $\\mathbf{C}_{\\mu\\nu} = \\mathbf{C}_{\\nu\\mu}$. These are the $4$ midpoints of the sides of the square, which we call \"midpoint centroids\".\n    - $\\mathbf{C}_{12} = \\mathbf{C}_{21} = (\\frac{L}{2}, 0, 0)$\n    - $\\mathbf{C}_{23} = \\mathbf{C}_{32} = (L, \\frac{L}{2}, 0)$\n    - $\\mathbf{C}_{34} = \\mathbf{C}_{43} = (\\frac{L}{2}, L, 0)$\n    - $\\mathbf{C}_{41} = \\mathbf{C}_{14} = (0, \\frac{L}{2}, 0)$\n    Each midpoint centroid corresponds to exactly $2$ compact pairs.\n\nStep 3: Apply the pair-centroid separation condition and count integrals.\nThe total number of retained integrals, $N$, is the sum over all initial compact pairs $(\\mu,\\nu) \\in S_p$ of the number of final compact pairs $(\\lambda,\\sigma) \\in S_p$ that satisfy $\\|\\mathbf{C}_{\\mu\\nu} - \\mathbf{C}_{\\lambda\\sigma}\\| \\le \\frac{L}{2}$.\nLet's analyze the distances between centroids.\n- The distance between an adjacent vertex centroid and midpoint centroid is, for example, $\\|\\mathbf{C}_{11} - \\mathbf{C}_{12}\\| = \\|(0,0,0) - (\\frac{L}{2},0,0)\\| = \\frac{L}{2}$. This distance satisfies the condition. By symmetry, any vertex centroid is at distance $\\frac{L}{2}$ from its two adjacent midpoint centroids.\n- The distance between any two distinct vertex centroids is at least $L$, which is greater than $\\frac{L}{2}$.\n- The distance between any two distinct midpoint centroids is at least $\\frac{L\\sqrt{2}}{2} \\approx 0.707L$, which is greater than $\\frac{L}{2}$.\n- The distance of a centroid to itself is $0$, which satisfies the condition.\n\nSo, a given centroid $\\mathbf{C}$ is \"connected\" (i.e., satisfies the separation condition) only to itself and its nearest neighbors in the set of centroids. Specifically:\n- A vertex centroid is connected to itself and its $2$ adjacent midpoint centroids.\n- A midpoint centroid is connected to itself and its $2$ adjacent vertex centroids.\n\nWe can now count the total number of integrals by considering the two types of initial pairs $(\\mu,\\nu)$.\n\nCase A: The initial pair $(\\mu,\\nu)$ has a vertex centroid.\nThere are $4$ such pairs in $S_p$: $(1,1), (2,2), (3,3), (4,4)$. Let's consider $(\\mu,\\nu)=(1,1)$, whose centroid is $\\mathbf{C}_{11}=(0,0,0)$. The centroids for the final pair $(\\lambda,\\sigma)$ must be within $\\frac{L}{2}$ of $\\mathbf{C}_{11}$. These are $\\mathbf{C}_{11}$ itself, and the adjacent midpoint centroids $\\mathbf{C}_{12}$ and $\\mathbf{C}_{41}$.\n- Number of pairs with centroid $\\mathbf{C}_{11}$: $1$ pair, which is $(1,1)$.\n- Number of pairs with centroid $\\mathbf{C}_{12}$: $2$ pairs, which are $(1,2)$ and $(2,1)$.\n- Number of pairs with centroid $\\mathbf{C}_{41}$: $2$ pairs, which are $(1,4)$ and $(4,1)$.\nFor an initial pair with a vertex centroid, there are $1+2+2=5$ valid final pairs.\nSince there are $4$ such initial pairs, this contributes $4 \\times 5 = 20$ to the total count.\n\nCase B: The initial pair $(\\mu,\\nu)$ has a midpoint centroid.\nThere are $8$ such pairs in $S_p$. Let's consider $(\\mu,\\nu)=(1,2)$, whose centroid is $\\mathbf{C}_{12}=(\\frac{L}{2},0,0)$. The centroids for the final pair $(\\lambda,\\sigma)$ must be within $\\frac{L}{2}$ of $\\mathbf{C}_{12}$. These are $\\mathbf{C}_{12}$ itself, and the adjacent vertex centroids $\\mathbf{C}_{11}$ and $\\mathbf{C}_{22}$.\n- Number of pairs with centroid $\\mathbf{C}_{12}$: $2$ pairs, which are $(1,2)$ and $(2,1)$.\n- Number of pairs with centroid $\\mathbf{C}_{11}$: $1$ pair, which is $(1,1)$.\n- Number of pairs with centroid $\\mathbf{C}_{22}$: $1$ pair, which is $(2,2)$.\nFor an initial pair with a midpoint centroid, there are $2+1+1=4$ valid final pairs.\nSince there are $8$ such initial pairs, this contributes $8 \\times 4 = 32$ to the total count.\n\nFinally, the total number of retained integrals is the sum of the contributions from both cases.\n$N = 20 + 32 = 52$.", "answer": "$$\n\\boxed{52}\n$$", "id": "2457312"}, {"introduction": "The modern foundation of linear-scaling methods is the \"nearsightedness\" of electronic matter, which posits that for systems with a non-zero energy gap, the density matrix is local in real space. The rate of the density matrix's spatial decay is directly governed by the HOMO-LUMO gap; gapped systems are highly \"nearsighted,\" while gapless systems exhibit long-range electronic correlations. This coding challenge [@problem_id:2457332] guides you to implement a quantitative test for nearsightedness, allowing you to computationally explore and verify this crucial link between a system's electronic gap and the accuracy of real-space truncation.", "problem": "You are asked to formalize and implement a quantitative test of electronic nearsightedness for a finite one-dimensional molecule within a tight-binding model. Consider a real symmetric tight-binding Hamiltonian matrix $H \\in \\mathbb{R}^{N \\times N}$ constructed from a set of $N$ atomic sites located at positions $\\{\\mathbf{r}_i\\}_{i=1}^N \\subset \\mathbb{R}^3$ (in units of Angstroms). The Hamiltonian is defined by the following first-principles specifications:\n\n1. On-site terms: for site index $i$, the on-site energy is $\\varepsilon_i \\in \\mathbb{R}$. The diagonal elements satisfy $H_{ii} = \\varepsilon_i$.\n\n2. Hopping terms: for distinct sites $i \\neq j$, define the Euclidean intersite distance $d_{ij} = \\|\\mathbf{r}_i - \\mathbf{r}_j\\|_2$ (in Angstroms). Let $d_0$ denote the minimum nonzero intersite distance. Fix a tolerance factor $\\eta = 0.05$. The off-diagonal matrix element $H_{ij}$ equals a constant hopping energy $t \\in \\mathbb{R}$ (in electronvolts) if $d_{ij} \\in [d_0(1-\\eta),\\, d_0(1+\\eta)]$, and $H_{ij}=0$ otherwise.\n\nFor an inverse temperature $\\beta > 0$ (in inverse electronvolts) and a chemical potential $\\mu$ (in electronvolts), the one-particle density matrix $P \\in \\mathbb{R}^{N \\times N}$ is defined as the Fermi–Dirac function of the Hamiltonian,\n$$\nP \\;=\\; \\bigl(I + \\exp\\bigl(\\beta\\,(H - \\mu I)\\bigr)\\bigr)^{-1}.\n$$\nGiven a real-space cutoff $r_c > 0$ (in Angstroms), define the cutoff-truncated density matrix $P_c \\in \\mathbb{R}^{N \\times N}$ by\n$$\n(P_c)_{ij} \\;=\\; \\begin{cases}\nP_{ij}, & \\text{if } d_{ij} \\le r_c,\\\\\n0, & \\text{if } d_{ij} > r_c,\n\\end{cases}\n$$\nwith the convention $d_{ii} = 0$ for all $i$.\n\nDefine the band energy $E_{\\text{band}}$ and the electron number $N_e$ by\n$$\nE_{\\text{band}} \\;=\\; \\mathrm{Tr}(P\\,H), \\qquad N_e \\;=\\; \\mathrm{Tr}(P),\n$$\nand analogously define\n$$\nE_{\\text{band}}^{(c)} \\;=\\; \\mathrm{Tr}(P_c\\,H), \\qquad N_e^{(c)} \\;=\\; \\mathrm{Tr}(P_c).\n$$\nA molecule is said to be “nearsighted enough” for the cutoff $r_c$ if and only if both of the following quantitative accuracy criteria hold:\n$$\n\\frac{\\bigl|E_{\\text{band}} - E_{\\text{band}}^{(c)}\\bigr|}{\\bigl|E_{\\text{band}}\\bigr|} \\;\\le\\; \\varepsilon_E\n\\quad\\text{and}\\quad\n\\bigl|N_e - N_e^{(c)}\\bigr| \\;\\le\\; \\varepsilon_N,\n$$\nwhere $\\varepsilon_E > 0$ is a relative energy tolerance (dimensionless) and $\\varepsilon_N > 0$ is an absolute electron-number tolerance (dimensionless).\n\nFor all test cases below, use spinless electrons at half filling with chemical potential $\\mu = 0\\,\\text{eV}$. The geometry is a linear chain of $N$ atoms placed along the $x$-axis with uniform spacing $a$ (in Angstroms), specifically $\\mathbf{r}_i = ( (i-1)\\,a,\\, 0,\\, 0 )$ for $i = 1,2,\\dots,N$. The on-site energies alternate as $\\varepsilon_i = (+\\Delta)$ for even $i$ and $\\varepsilon_i = (-\\Delta)$ for odd $i$, where $\\Delta \\ge 0$ (in electronvolts). The hopping constant $t$ is uniform (in electronvolts) and negative.\n\nYour task is to write a complete, runnable program that, for each test case, constructs $H$, evaluates $P$ and $P_c$, computes the two errors defined above, and returns a boolean value indicating whether the molecule is “nearsighted enough” for the specified cutoff $r_c$ and tolerances. All energies must be treated in electronvolts and all distances in Angstroms. The inverse temperature $\\beta$ must be treated in inverse electronvolts. The final output must be a single line containing a list of boolean results, one per test case, in the order provided, formatted as a comma-separated list enclosed in square brackets with no spaces, for example, “[True,False,True]”.\n\nUse the following test suite, where each case is specified by $(N, a, t, \\Delta, \\beta, r_c, \\varepsilon_E, \\varepsilon_N)$:\n\n- Case 1 (gapped, expected to be accurate at short range): $(\\,N=12,\\; a=1.40\\,\\text{\\AA},\\; t=-2.5\\,\\text{eV},\\; \\Delta=1.0\\,\\text{eV},\\; \\beta=40\\,\\text{eV}^{-1},\\; r_c=4.20\\,\\text{\\AA},\\; \\varepsilon_E=1.0\\times 10^{-2},\\; \\varepsilon_N=1.0\\times 10^{-2}\\,)$.\n\n- Case 2 (metallic, expected to be inaccurate at the same short range): $(\\,N=12,\\; a=1.40\\,\\text{\\AA},\\; t=-2.5\\,\\text{eV},\\; \\Delta=0.0\\,\\text{eV},\\; \\beta=40\\,\\text{eV}^{-1},\\; r_c=2.10\\,\\text{\\AA},\\; \\varepsilon_E=1.0\\times 10^{-2},\\; \\varepsilon_N=1.0\\times 10^{-2}\\,)$.\n\n- Case 3 (small gap, short cutoff, likely inaccurate): $(\\,N=12,\\; a=1.40\\,\\text{\\AA},\\; t=-2.5\\,\\text{eV},\\; \\Delta=0.2\\,\\text{eV},\\; \\beta=40\\,\\text{eV}^{-1},\\; r_c=3.00\\,\\text{\\AA},\\; \\varepsilon_E=1.0\\times 10^{-2},\\; \\varepsilon_N=1.0\\times 10^{-2}\\,)$.\n\n- Case 4 (small gap, longer cutoff, likely accurate): $(\\,N=12,\\; a=1.40\\,\\text{\\AA},\\; t=-2.5\\,\\text{eV},\\; \\Delta=0.2\\,\\text{eV},\\; \\beta=40\\,\\text{eV}^{-1},\\; r_c=7.00\\,\\text{\\AA},\\; \\varepsilon_E=1.0\\times 10^{-2},\\; \\varepsilon_N=1.0\\times 10^{-2}\\,)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, “[result1,result2,result3,result4]”), where each result is either True or False depending on whether both acceptance criteria are satisfied for that test case.", "solution": "The problem statement is subjected to validation and is determined to be scientifically sound, well-posed, and complete. All necessary physical parameters, mathematical definitions, and numerical tolerances are provided. The model is a standard tight-binding representation of a one-dimensional molecular chain, and the concept of electronic nearsightedness is a fundamental principle in computational chemistry and condensed matter physics. We proceed with the solution.\n\nThe problem requires a quantitative test of electronic nearsightedness for a finite one-dimensional chain of $N$ atoms. The physical system is modeled by a tight-binding Hamiltonian $H$. The core of the problem is to compute the one-particle density matrix $P$, truncate it in real space to obtain $P_c$, and then compare the physical observables derived from $P$ and $P_c$.\n\nFirst, we construct the Hamiltonian matrix $H \\in \\mathbb{R}^{N \\times N}$. The geometry is a linear chain with uniform spacing $a$, so the atomic positions are $\\mathbf{r}_i = ((i-1)a, 0, 0)$ for $i=1, \\dots, N$. The distance between sites $i$ and $j$ is $d_{ij} = |i-j|a$. The minimum non-zero distance is $d_0 = a$. The hopping term $H_{ij} = t$ is non-zero only if $d_{ij} \\in [a(1-\\eta), a(1+\\eta)]$. With $\\eta=0.05$, this range is $[0.95a, 1.05a]$. For $d_{ij}=|i-j|a$, this condition becomes $0.95 \\le |i-j| \\le 1.05$. As $|i-j|$ must be an integer, this is only satisfied for $|i-j|=1$. Thus, the Hamiltonian includes only nearest-neighbor hopping. The on-site energies $\\varepsilon_i$ alternate: $\\varepsilon_i = -\\Delta$ for odd $i$ and $\\varepsilon_i = +\\Delta$ for even $i$. The chemical potential is given as $\\mu = 0\\,\\text{eV}$.\n\nThe Hamiltonian matrix elements are therefore:\n$$\nH_{ij} = \\begin{cases}\n-\\Delta, & \\text{if } i=j \\text{ and } i \\text{ is odd} \\\\\n+\\Delta, & \\text{if } i=j \\text{ and } i \\text{ is even} \\\\\nt, & \\text{if } |i-j| = 1 \\\\\n0, & \\text{otherwise}\n\\end{cases}\n$$\n\nNext, we compute the one-particle density matrix $P$. It is defined as a function of the Hamiltonian:\n$$\nP = \\left(I + \\exp\\left(\\beta(H - \\mu I)\\right)\\right)^{-1}\n$$\nWith $\\mu=0$, this simplifies to $P = (I + \\exp(\\beta H))^{-1}$. The most numerically stable and efficient method to compute this matrix function is via the eigendecomposition of $H$. Since $H$ is a real symmetric matrix, it can be diagonalized as $H = U \\Lambda U^T$, where $\\Lambda$ is the diagonal matrix of real eigenvalues $\\lambda_k$, and $U$ is the orthogonal matrix of corresponding eigenvectors. The density matrix is then given by:\n$$\nP = U f(\\Lambda) U^T\n$$\nwhere $f(\\Lambda)$ is a diagonal matrix with elements $(f(\\Lambda))_{kk} = f(\\lambda_k) = (1 + \\exp(\\beta \\lambda_k))^{-1}$. These values $f(\\lambda_k)$ are the Fermi-Dirac occupation numbers for the single-particle energy levels $\\lambda_k$.\n\nWith the eigensystem, the band energy $E_{\\text{band}}$ and the number of electrons $N_e$ are computed efficiently. Using the cyclic property of the trace, $\\mathrm{Tr}(ABC)=\\mathrm{Tr}(BCA)$:\n$$\nE_{\\text{band}} = \\mathrm{Tr}(P H) = \\mathrm{Tr}(U f(\\Lambda) U^T U \\Lambda U^T) = \\mathrm{Tr}(f(\\Lambda) \\Lambda) = \\sum_{k=1}^N f(\\lambda_k) \\lambda_k\n$$\n$$\nN_e = \\mathrm{Tr}(P) = \\mathrm{Tr}(U f(\\Lambda) U^T) = \\mathrm{Tr}(f(\\Lambda)) = \\sum_{k=1}^N f(\\lambda_k)\n$$\n\nThe next step is to construct the cutoff-truncated density matrix $P_c$. Its elements are defined as:\n$$\n(P_c)_{ij} = \\begin{cases}\nP_{ij}, & \\text{if } d_{ij} \\le r_c \\\\\n0, & \\text{if } d_{ij} > r_c\n\\end{cases}\n$$\nwhere $d_{ij} = |i-j|a$. To implement this, we first compute the full density matrix $P = U f(\\Lambda) U^T$. Then, we construct a binary mask matrix $M$ where $M_{ij}=1$ if $|i-j|a \\le r_c$ and $M_{ij}=0$ otherwise. $P_c$ is then the element-wise product of $P$ and $M$.\n\nThe observables corresponding to the truncated density matrix are calculated as:\n$$\nE_{\\text{band}}^{(c)} = \\mathrm{Tr}(P_c H) \\qquad \\text{and} \\qquad N_e^{(c)} = \\mathrm{Tr}(P_c)\n$$\nHere, a crucial observation must be made regarding $N_e^{(c)}$. The trace is the sum of the diagonal elements. The truncation condition for a diagonal element $(P_c)_{ii}$ depends on the distance $d_{ii}$. By convention, $d_{ii}=0$. Since all test cases use a positive cutoff $r_c > 0$, the condition $d_{ii} \\le r_c$ is always satisfied for all diagonal elements. Therefore, $(P_c)_{ii} = P_{ii}$ for all $i=1, \\dots, N$. This leads to the identity:\n$$\nN_e^{(c)} = \\mathrm{Tr}(P_c) = \\sum_{i=1}^N (P_c)_{ii} = \\sum_{i=1}^N P_{ii} = \\mathrm{Tr}(P) = N_e\n$$\nConsequently, the absolute electron number error $|N_e - N_e^{(c)}|$ is identically zero. The second criterion for nearsightedness, $|N_e - N_e^{(c)}| \\le \\varepsilon_N$, is thus trivially satisfied for any $\\varepsilon_N > 0$. The test for nearsightedness reduces to only the energy criterion:\n$$\n\\frac{\\left|E_{\\text{band}} - E_{\\text{band}}^{(c)}\\right|}{\\left|E_{\\text{band}}\\right|} \\le \\varepsilon_E\n$$\nThe value of $E_{\\text{band}}^{(c)} = \\mathrm{Tr}(P_c H)$ must be computed by explicit matrix multiplication and trace, as $P_c$ and $H$ do not in general commute.\n\nThe algorithm for determining if a molecule is \"nearsighted enough\" is as follows:\n1. For a given set of parameters $(N, a, t, \\Delta, \\beta, r_c, \\varepsilon_E, \\varepsilon_N)$, construct the $N \\times N$ Hamiltonian matrix $H$.\n2. Compute the eigenvalues $\\lambda_k$ and eigenvectors (matrix $U$) of $H$.\n3. Calculate the Fermi-Dirac occupation numbers $f_k = (1 + \\exp(\\beta \\lambda_k))^{-1}$.\n4. Compute the exact band energy $E_{\\text{band}} = \\sum_k f_k \\lambda_k$.\n5. Construct the full density matrix $P = U \\mathrm{diag}(f_k) U^T$.\n6. Construct the distance matrix $D$ with elements $d_{ij} = |i-j|a$.\n7. Create the truncated density matrix $P_c$ by setting elements $(P_c)_{ij}=0$ where $d_{ij} > r_c$.\n8. Compute the truncated band energy $E_{\\text{band}}^{(c)} = \\mathrm{Tr}(P_c H)$.\n9. Calculate the relative energy error, $\\delta_E = |E_{\\text{band}} - E_{\\text{band}}^{(c)}| / |E_{\\text{band}}|$.\n10. The condition is met if $\\delta_E \\le \\varepsilon_E$. The electron number condition is always met. The final result is the boolean outcome of this single test.\n\nThis procedure is applied to each test case to generate the final list of boolean results. The underlying physical principle is that for gapped systems ($\\Delta > 0$), the elements $P_{ij}$ decay exponentially with distance $d_{ij}$, so the truncation error is small. For gapless (metallic) systems ($\\Delta = 0$), the decay is slower (algebraic), and the truncation error is expected to be significant.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries are needed for this problem.\n\ndef is_nearsighted(N, a, t, Delta, beta, r_c, eps_E, eps_N):\n    \"\"\"\n    Checks if a molecule is \"nearsighted enough\" based on a tight-binding model.\n\n    Args:\n        N (int): Number of atoms.\n        a (float): Uniform spacing in Angstroms.\n        t (float): Hopping energy in eV.\n        Delta (float): On-site energy staggering in eV.\n        beta (float): Inverse temperature in eV^-1.\n        r_c (float): Real-space cutoff in Angstroms.\n        eps_E (float): Relative energy tolerance.\n        eps_N (float): Absolute electron number tolerance.\n\n    Returns:\n        bool: True if both accuracy criteria are met, False otherwise.\n    \"\"\"\n    # 1. Construct the Hamiltonian matrix H\n    # H is an N x N matrix. Indices k, l are 0-based (0 to N-1).\n    H = np.zeros((N, N))\n\n    # On-site terms (diagonal elements)\n    for k in range(N):\n        # i = k + 1. If i is odd (k is even), energy is -Delta.\n        # If i is even (k is odd), energy is +Delta.\n        if k % 2 == 0:\n            H[k, k] = -Delta\n        else:\n            H[k, k] = Delta\n    \n    # Hopping terms (off-diagonal elements for nearest neighbors)\n    for k in range(N - 1):\n        H[k, k + 1] = t\n        H[k + 1, k] = t\n\n    # 2. Diagonalize H to get eigenvalues (e_vals) and eigenvectors (e_vecs)\n    # numpy.linalg.eigh is suitable for real symmetric matrices.\n    e_vals, e_vecs = np.linalg.eigh(H)\n    \n    # 3. Calculate Fermi-Dirac occupation numbers\n    # Chemical potential mu is 0.\n    f_k = 1.0 / (1.0 + np.exp(beta * e_vals))\n\n    # 4. Calculate exact band energy and electron number\n    E_band = np.sum(f_k * e_vals)\n    N_e = np.sum(f_k)\n    \n    # 5. Construct the full density matrix P\n    # P = U * diag(f_k) * U_transpose\n    P = e_vecs @ np.diag(f_k) @ e_vecs.T\n\n    # 6. Construct the cutoff-truncated density matrix P_c\n    # First, create the distance matrix D\n    indices = np.arange(N)\n    dist_matrix = np.abs(indices[:, np.newaxis] - indices) * a\n    \n    # Create a mask based on the cutoff radius r_c\n    mask = dist_matrix <= r_c\n    \n    # Apply the mask to P to get P_c\n    P_c = P * mask\n    \n    # 7. Calculate truncated observables\n    E_band_c = np.trace(P_c @ H)\n    N_e_c = np.trace(P_c) # As derived, this equals N_e\n    \n    # 8. Check the accuracy criteria\n    # Avoid division by zero, although E_band is not expected to be zero here.\n    if np.abs(E_band) < 1e-12:\n        # If E_band is effectively zero, relative error is not well-defined.\n        # Define error as absolute difference in this case.\n        # Problem constraints ensure this is not an issue.\n        rel_energy_error = np.abs(E_band - E_band_c)\n    else:\n        rel_energy_error = np.abs(E_band - E_band_c) / np.abs(E_band)\n        \n    abs_electron_error = np.abs(N_e - N_e_c)\n\n    # 9. Return boolean result\n    is_accurate_E = rel_energy_error <= eps_E\n    is_accurate_N = abs_electron_error <= eps_N\n    \n    return is_accurate_E and is_accurate_N\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Each test case is a tuple: (N, a, t, Delta, beta, r_c, eps_E, eps_N)\n    test_cases = [\n        # Case 1: gapped, expected to be accurate at short range\n        (12, 1.40, -2.5, 1.0, 40.0, 4.20, 1.0e-2, 1.0e-2),\n        # Case 2: metallic, expected to be inaccurate at the same short range\n        (12, 1.40, -2.5, 0.0, 40.0, 2.10, 1.0e-2, 1.0e-2),\n        # Case 3: small gap, short cutoff, likely inaccurate\n        (12, 1.40, -2.5, 0.2, 40.0, 3.00, 1.0e-2, 1.0e-2),\n        # Case 4: small gap, longer cutoff, likely accurate\n        (12, 1.40, -2.5, 0.2, 40.0, 7.00, 1.0e-2, 1.0e-2),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = is_nearsighted(*case)\n        results.append(result)\n\n    # Format the final output as specified\n    # map(str, ...) converts boolean True/False to strings \"True\"/\"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver\nsolve()\n\n```", "id": "2457332"}, {"introduction": "While thresholding matrix elements is a cornerstone of linear-scaling techniques, its naive application can produce qualitatively wrong and physically meaningless results. The assumption of nearsightedness is not universally valid, and this thought experiment [@problem_id:2457296] explores a critical failure mode: systems with nearly degenerate energy levels. By analyzing how thresholding a single, numerically small coupling term can trigger a catastrophic failure, you will gain a deeper appreciation for the subtleties involved and understand why robust algorithms must carefully handle the long-range physics of near-degeneracy.", "problem": "A linear-scaling Hartree–Fock (HF) calculation employs element thresholding: any off-diagonal Fock matrix element $F_{\\mu\\nu}$ with magnitude less than a cutoff $\\tau$ is set to $0$ to enforce sparsity. Consider a one-electron system composed of two identical, well-separated fragments $A$ and $B$ aligned along the $x$-axis and centered at $x_A=-R/2$ and $x_B=+R/2$, respectively, with $R$ large. Work in an orthonormal localized basis $\\{\\phi_A,\\phi_B\\}$ with negligible spatial overlap of the basis functions’ charge densities. In the exact (unthresholded) calculation, the one-electron Fock matrix in this subspace has the form\n$$\n\\mathbf{F} \\;=\\;\n\\begin{pmatrix}\n\\epsilon & V \\\\\nV & \\epsilon\n\\end{pmatrix},\n$$\nwith $|V| \\ll |\\epsilon|$ and $|V| < \\tau$, so that the linear-scaling code sets $F_{AB}=F_{BA}=0$ before diagonalization. Assume the dipole moment operator along the molecular axis is $\\hat{\\mu} = q\\,\\hat{x}$, with $q$ the electron charge, and take the origin at the midpoint between $A$ and $B$. No external fields are present and there are no two-electron terms because the system has a single electron.\n\nWhich option best describes the physical and numerical consequence of dropping this single, numerically small, long-range Fock matrix element $V$?\n\nA. The ground-state energy error scales linearly with $|V|$ (losing a stabilization of magnitude $|V|$), and the predicted dipole moment changes from approximately $0$ to approximately $|q|R/2$ in magnitude because the electron localizes on one fragment when $V$ is set to $0$.\n\nB. The ground-state energy error scales quadratically as $\\mathcal{O}(V^2)$ because only second-order mixing is affected, and the dipole moment remains approximately $0$ due to residual symmetry even when $V$ is set to $0$.\n\nC. The self-consistent field (SCF) procedure becomes non-Hermitian and variationally unstable because setting $F_{AB}$ to $0$ breaks Hermiticity, leading to divergence rather than a physical error in energy or dipole.\n\nD. There is no significant effect on either energy or dipole because $|V|<\\tau$ by construction, so thresholding guarantees negligible physical impact.\n\nE. Although the initial diagonalization omits $V$, the self-consistent field (SCF) iterations regenerate an effective coupling through the density matrix so that the final state remains delocalized and the energy error is limited to $\\mathcal{O}(V^2)$.", "solution": "The problem statement must first be validated for scientific and logical integrity.\n\n### Step 1: Extract Givens\n- **System**: A one-electron system of two identical, well-separated fragments, $A$ and $B$.\n- **Geometry**: Fragments are on the $x$-axis, centered at $x_A = -R/2$ and $x_B = +R/2$, with $R$ being large.\n- **Basis Set**: An orthonormal localized basis $\\{\\phi_A, \\phi_B\\}$.\n- **Overlap**: Negligible spatial overlap of charge densities, implying $\\phi_A^2(r)\\phi_B^2(r) \\approx 0$. Given orthonormality, the overlap integral is $\\langle \\phi_A|\\phi_B \\rangle = S_{AB} = 0$.\n- **Exact Fock Matrix**: In the given basis, the one-electron Fock matrix is $\\mathbf{F} = \\begin{pmatrix} \\epsilon & V \\\\ V & \\epsilon \\end{pmatrix}$. This is the core Hamiltonian matrix since there is only one electron.\n- **Parameters**: $|V| \\ll |\\epsilon|$ and $|V| < \\tau$, where $\\tau$ is a numerical threshold.\n- **Approximation**: A linear-scaling method sets any off-diagonal Fock matrix element $F_{\\mu\\nu}$ to $0$ if $|F_{\\mu\\nu}| < \\tau$. Since $|V| < \\tau$, the approximate Fock matrix becomes $\\mathbf{F}' = \\begin{pmatrix} \\epsilon & 0 \\\\ 0 & \\epsilon \\end{pmatrix}$.\n- **Observable**: The dipole moment operator along the molecular axis is $\\hat{\\mu} = q\\hat{x}$, with the origin at the midpoint between $A$ and $B$. $q$ is the electron charge.\n- **Conditions**: No external fields, single-electron system (no two-electron interactions, thus no self-consistent field (SCF) cycles).\n\n### Step 2: Validate Using Extracted Givens\nThe problem describes a two-level quantum system, a standard and valid model used in physics and chemistry to study fundamental concepts.\n- **Scientifically Grounded**: The problem is a simplified but correct representation of a molecular system within the framework of linear combination of atomic orbitals (LCAO) and Hartree-Fock theory. The concept of thresholding matrix elements is central to linear-scaling methods. The analysis of its consequences is a legitimate scientific question. The model is sound.\n- **Well-Posed**: The problem is clearly defined. It asks for a comparison of the ground state properties (energy, dipole moment) obtained from two different Hamiltonians (represented by $\\mathbf{F}$ and $\\mathbf{F}'$). A unique, meaningful solution can be derived.\n- **Objective**: The language is precise and uses standard, unambiguous terminology from quantum chemistry.\n- **No Flaws**: The setup is self-consistent and contains no scientific or logical contradictions. The parameters and conditions are physically reasonable for the model.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will now proceed with the derivation of the solution.\n\n### Derivation\nLet us analyze the system before and after the thresholding approximation.\n\n**1. Exact (Unthresholded) System**\nThe Hamiltonian is represented by the matrix $\\mathbf{F} = \\begin{pmatrix} \\epsilon & V \\\\ V & \\epsilon \\end{pmatrix}$. We solve the time-independent Schrödinger equation in matrix form, which for an orthonormal basis is the eigenvalue problem $\\mathbf{F}\\mathbf{c} = E\\mathbf{c}$.\nThe eigenvalues (orbital energies) are the roots of the characteristic equation $\\det(\\mathbf{F} - E\\mathbf{I}) = 0$:\n$$\n\\det\\begin{pmatrix} \\epsilon - E & V \\\\ V & \\epsilon - E \\end{pmatrix} = (\\epsilon - E)^2 - V^2 = 0\n$$\nThis gives $\\epsilon - E = \\pm V$, so the energies are $E_1 = \\epsilon - |V|$ and $E_2 = \\epsilon + |V|$.\nThe ground state energy is $E_{GS} = \\epsilon - |V|$, which represents a stabilization of magnitude $|V|$ relative to the fragment orbital energy $\\epsilon$.\n\nThe eigenvector $\\mathbf{c}_{GS}$ for the ground state $E_{GS}$ is found by solving $(\\mathbf{F} - E_{GS}\\mathbf{I})\\mathbf{c}_{GS} = 0$:\n$$\n\\begin{pmatrix} \\epsilon - (\\epsilon - |V|) & V \\\\ V & \\epsilon - (\\epsilon - |V|) \\end{pmatrix} \\begin{pmatrix} c_A \\\\ c_B \\end{pmatrix} = \\begin{pmatrix} |V| & V \\\\ V & |V| \\end{pmatrix} \\begin{pmatrix} c_A \\\\ c_B \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}\n$$\nThis yields the condition $|V|c_A + Vc_B = 0$.\n- If $V < 0$, then $-Vc_A + Vc_B = 0 \\implies c_A = c_B$.\n- If $V > 0$, then $Vc_A + Vc_B = 0 \\implies c_A = -c_B$.\nIn either case, normalization ($c_A^2 + c_B^2 = 1$) gives $|c_A| = |c_B| = 1/\\sqrt{2}$. The ground state molecular orbital is $\\psi_{GS} = \\frac{1}{\\sqrt{2}}(\\phi_A \\pm \\phi_B)$. This state is **delocalized** across both fragments. The probability density $|\\psi_{GS}|^2 = \\frac{1}{2}(\\phi_A^2 + \\phi_B^2 \\pm 2\\phi_A\\phi_B)$ is symmetric with respect to the origin (since $\\phi_A$ and $\\phi_B$ are images of each other through inversion), as the $\\phi_A\\phi_B$ cross-term is negligible where the densities are significant.\n\nThe expectation value of the dipole moment is:\n$$\n\\langle \\mu \\rangle_{exact} = \\langle \\psi_{GS} | q\\hat{x} | \\psi_{GS} \\rangle = \\frac{q}{2} \\langle \\phi_A \\pm \\phi_B | \\hat{x} | \\phi_A \\pm \\phi_B \\rangle\n= \\frac{q}{2} \\left[ \\langle \\phi_A|\\hat{x}|\\phi_A \\rangle + \\langle \\phi_B|\\hat{x}|\\phi_B \\rangle \\pm 2\\langle \\phi_A|\\hat{x}|\\phi_B \\rangle \\right]\n$$\nThe basis functions are centered at $x_A = -R/2$ and $x_B = +R/2$. Thus, $\\langle \\phi_A|\\hat{x}|\\phi_A \\rangle \\approx -R/2$ and $\\langle \\phi_B|\\hat{x}|\\phi_B \\rangle \\approx +R/2$. The term $\\langle \\phi_A|\\hat{x}|\\phi_B \\rangle$ is negligible due to the minimal overlap.\n$$\n\\langle \\mu \\rangle_{exact} \\approx \\frac{q}{2} \\left( -\\frac{R}{2} + \\frac{R}{2} \\right) = 0\n$$\nThe exact calculation correctly predicts a delocalized state with zero dipole moment due to the system's symmetry.\n\n**2. Approximate (Thresholded) System**\nThe thresholding sets $V=0$, resulting in the approximate Fock matrix $\\mathbf{F}' = \\begin{pmatrix} \\epsilon & 0 \\\\ 0 & \\epsilon \\end{pmatrix}$.\nThe eigenvalues are trivially $E'_1 = E'_2 = \\epsilon$. The ground state energy is degenerate. Any linear combination of $\\phi_A$ and $\\phi_B$ is an eigenstate with energy $\\epsilon$.\nIn a numerical calculation, an eigensolver confronted with a perfectly degenerate subspace will typically return one of the original basis vectors as the eigenvector due to round-off error or algorithmic choice. Let us assume the algorithm returns the eigenvector $\\mathbf{c}'_{GS} = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}$, which corresponds to the molecular orbital $\\psi'_{GS} = \\phi_A$. This represents the electron becoming fully **localized** on fragment $A$.\n\nThe approximate ground state energy is $E'_{GS} = \\epsilon$.\nThe energy error is $\\Delta E = E'_{GS} - E_{GS} = \\epsilon - (\\epsilon - |V|) = |V|$. This is a first-order error, scaling linearly with $|V|$.\n\nThe dipole moment for this localized state $\\psi'_{GS} = \\phi_A$ is:\n$$\n\\langle \\mu \\rangle' = \\langle \\phi_A | q\\hat{x} | \\phi_A \\rangle \\approx qx_A = -qR/2\n$$\nHad the solver chosen $\\psi'_{GS} = \\phi_B$, the dipole moment would be $+qR/2$. In either case, the magnitude of the dipole moment is $|\\langle \\mu \\rangle'| \\approx |q|R/2$. For a large separation $R$, this is a very large dipole moment, a qualitative and catastrophic failure compared to the correct value of $0$.\n\n### Option-by-Option Analysis\n\n**A. The ground-state energy error scales linearly with $|V|$ (losing a stabilization of magnitude $|V|$), and the predicted dipole moment changes from approximately $0$ to approximately $|q|R/2$ in magnitude because the electron localizes on one fragment when $V$ is set to $0$.**\nThis statement is a perfect summary of our derivation. The energy error is $\\Delta E = |V|$. The exact stabilization energy is lost. The dipole moment changes from $0$ to a magnitude of $|q|R/2$. The physical reason is the artificial localization of the electron onto a single fragment because the coupling $V$ that enforces delocalization is removed.\n**Verdict: Correct.**\n\n**B. The ground-state energy error scales quadratically as $\\mathcal{O}(V^2)$ because only second-order mixing is affected, and the dipole moment remains approximately $0$ due to residual symmetry even when $V$ is set to $0$.**\nThe energy error is $|V|$, which is $\\mathcal{O}(|V|)$, not $\\mathcal{O}(V^2)$. A $\\mathcal{O}(V^2)$ error is characteristic of second-order perturbation theory, which is not applicable here as the unperturbed system ($\\mathbf{F}'$) is degenerate. The dipole moment does not remain $0$; the numerical solution breaks the symmetry.\n**Verdict: Incorrect.**\n\n**C. The self-consistent field (SCF) procedure becomes non-Hermitian and variationally unstable because setting $F_{AB}$ to $0$ breaks Hermiticity, leading to divergence rather than a physical error in energy or dipole.**\nSetting $F_{AB}=F_{BA}=0$ preserves the Hermiticity of the Fock matrix. The approximate matrix $\\mathbf{F}'$ is real and diagonal, hence Hermitian. Furthermore, this is a one-electron system, so there is no SCF procedure. The premise of this option is fundamentally flawed.\n**Verdict: Incorrect.**\n\n**D. There is no significant effect on either energy or dipole because $|V|<\\tau$ by construction, so thresholding guarantees negligible physical impact.**\nThis option represents a naive misunderstanding of the problem. While the discarded element $V$ is numerically small, its removal leads to a qualitative change in the physics (delocalized to localized) because it creates an artificial degeneracy. The effect on the dipole moment is catastrophic, not negligible.\n**Verdict: Incorrect.**\n\n**E. Although the initial diagonalization omits $V$, the self-consistent field (SCF) iterations regenerate an effective coupling through the density matrix so that the final state remains delocalized and the energy error is limited to $\\mathcal{O}(V^2)$.**\nThis problem concerns a one-electron system, for which the Fock matrix is constant and there are no SCF iterations. The option is inapplicable. Even in a many-electron system, there is no guarantee that SCF iterations would correct the artificial localization; in fact, SCF can get trapped in such symmetry-broken solutions.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "2457296"}]}