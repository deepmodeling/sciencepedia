{"hands_on_practices": [{"introduction": "Hierarchical clustering is an intuitive method for discovering structure in data, and constructing a dendrogram is the key visualization of this process. This exercise provides fundamental practice in building a dendrogram from a distance matrix using the complete-linkage criterion [@problem_id:1423409]. By manually stepping through the agglomerative process, you will gain a concrete understanding of how clusters are iteratively formed and how the choice of linkage—in this case, using the maximum distance between clusters—dictates the final tree topology.", "problem": "A team of marine biologists is studying the microbial ecosystem of a recently discovered deep-sea hydrothermal vent. They have isolated five previously unknown bacterial species, labeled S1, S2, S3, S4, and S5. To understand their potential evolutionary relationships, they performed a genetic analysis and computed a distance matrix based on dissimilarities in their 16S ribosomal RNA (rRNA) gene sequences. A larger value in the matrix indicates greater genetic divergence between two species.\n\nThe resulting distance matrix is as follows:\n\n| | S1 | S2 | S3 | S4 | S5 |\n|:--|:--:|:--:|:--:|:--:|:--:|\n| **S1**| 0 | 0.20 | 0.50 | 0.60 | 0.70 |\n| **S2**| 0.20 | 0 | 0.40 | 0.55 | 0.65 |\n| **S3**| 0.50 | 0.40 | 0 | 0.10 | 0.30 |\n| **S4**| 0.60 | 0.55 | 0.10 | 0 | 0.25 |\n| **S5**| 0.70 | 0.65 | 0.30 | 0.25 | 0 |\n\nYour task is to determine the phylogenetic relationship between these species by performing hierarchical clustering. Specifically, you must use the **complete-linkage agglomerative clustering** method.\n\nThe resulting relationship is to be represented as a dendrogram, which can be described textually using the Newick format. In Newick format, a tree is represented by nested parentheses. For example, the string `((A,B),C);` means that species A and B are clustered together first, and this cluster is then grouped with species C.\n\nWhich of the following Newick format strings correctly represents the topology of the dendrogram obtained from the given distance matrix using complete-linkage clustering?\n\nA. `((S1,S2),((S3,S4),S5));`\n\nB. `((((S3,S4),S5),S2),S1));`\n\nC. `(((S1,S2),S5),(S3,S4));`\n\nD. `((S1,S5),((S2,S3),S4));`\n\nE. `(((S3,S4),S2),(S1,S5));`", "solution": "In complete-linkage agglomerative clustering, the distance between two clusters $A$ and $B$ is defined as\n$$\nd_{\\text{complete}}(A,B)=\\max\\{d(i,j): i\\in A,\\ j\\in B\\}.\n$$\nStart with singleton clusters $\\{S1\\},\\{S2\\},\\{S3\\},\\{S4\\},\\{S5\\}$ and the given pairwise distances.\n\n1) Identify the closest pair among singletons. The smallest entry in the matrix is $d(S3,S4)=0.10$, so merge $S3$ and $S4$ first to form $C_{34}=\\{S3,S4\\}$.\n\nCompute distances from $C_{34}$ to the remaining singletons using the complete-linkage rule:\n$$\nd(C_{34},S1)=\\max\\{d(S3,S1),d(S4,S1)\\}=\\max\\{0.50,0.60\\}=0.60,\n$$\n$$\nd(C_{34},S2)=\\max\\{d(S3,S2),d(S4,S2)\\}=\\max\\{0.40,0.55\\}=0.55,\n$$\n$$\nd(C_{34},S5)=\\max\\{d(S3,S5),d(S4,S5)\\}=\\max\\{0.30,0.25\\}=0.30.\n$$\nCurrent inter-cluster distances include $d(S1,S2)=0.20$, $d(S1,S5)=0.70$, $d(S2,S5)=0.65$, and the three computed above.\n\n2) The smallest current distance is $d(S1,S2)=0.20$, so merge $S1$ and $S2$ to form $C_{12}=\\{S1,S2\\}$.\n\nCompute distances among $C_{12}$, $C_{34}$, and $S5$:\n$$\nd(C_{12},S5)=\\max\\{d(S1,S5),d(S2,S5)\\}=\\max\\{0.70,0.65\\}=0.70,\n$$\n$$\nd(C_{12},C_{34})=\\max\\{d(S1,S3),d(S1,S4),d(S2,S3),d(S2,S4)\\}\n=\\max\\{0.50,0.60,0.40,0.55\\}=0.60,\n$$\nand from before $d(C_{34},S5)=0.30$.\n\n3) The smallest current distance is $d(C_{34},S5)=0.30$, so merge to form $C_{345}=\\{S3,S4,S5\\}$ with structure $((S3,S4),S5)$.\n\n4) Now two clusters remain: $C_{12}=\\{S1,S2\\}$ and $C_{345}=\\{S3,S4,S5\\}$. Their complete-linkage distance is\n$$\nd(C_{12},C_{345})=\\max\\{d(S1,S3),d(S1,S4),d(S1,S5),d(S2,S3),d(S2,S4),d(S2,S5)\\}\n=\\max\\{0.50,0.60,0.70,0.40,0.55,0.65\\}=0.70.\n$$\nThus the final merge is between $(S1,S2)$ and $((S3,S4),S5)$.\n\nThe resulting topology in Newick form is $((S1,S2),((S3,S4),S5));$, which corresponds to option A.", "answer": "$$\\boxed{A}$$", "id": "1423409"}, {"introduction": "A dendrogram offers a simplified, hierarchical view of the relationships within a dataset, but how well does this tree structure truly represent the original pairwise distances between data points? This practice introduces the cophenetic correlation coefficient, a crucial metric for quantifying the fidelity of a dendrogram [@problem_id:2439035]. You will learn to extract the tree-implied (cophenetic) distances from a given dendrogram and compare them against the original dissimilarities, providing a powerful tool for evaluating the quality of your clustering.", "problem": "Consider the following symmetric dissimilarity matrix for taxa $A$, $B$, $C$, $D$, and $E$:\n- $d(A,B)=2$, $d(A,C)=9$, $d(A,D)=8$, $d(A,E)=4$\n- $d(B,C)=7$, $d(B,D)=8$, $d(B,E)=6$\n- $d(C,D)=3$, $d(C,E)=7$\n- $d(D,E)=9$\n\nAn Unweighted Pair Group Method with Arithmetic mean (UPGMA) dendrogram on these taxa is given by the following merge sequence (heights shown are the cluster merge heights on the dendrogram):\n- Merge $A$ and $B$ at height $2$.\n- Merge $C$ and $D$ at height $3$.\n- Merge the cluster $\\{A,B\\}$ with $E$ at height $5$.\n- Merge the cluster $\\{A,B,E\\}$ with the cluster $\\{C,D\\}$ at height $8$.\n\nUsing the original matrix and the given UPGMA dendrogram:\n- Compute the cophenetic correlation coefficient between the vector of all unordered-pair original distances and the corresponding vector of cophenetic distances implied by the dendrogram.\n- Also determine which unordered pair(s) of taxa have the largest absolute distortion, defined as $|d(i,j)-c(i,j)|$, where $d(i,j)$ is the original distance and $c(i,j)$ is the cophenetic distance.\n\nReport only the cophenetic correlation coefficient, rounded to four significant figures. No units are required for the reported value.", "solution": "To compute the cophenetic correlation coefficient, we first need to create two vectors: one containing the original dissimilarities, $\\mathbf{d}$, and another containing the cophenetic distances, $\\mathbf{c}$, derived from the dendrogram. The cophenetic distance $c(i,j)$ between two taxa is the height of their lowest common ancestor in the tree.\n\nFrom the given merge sequence:\n- $A$ and $B$ merge at height 2, so $c(A,B) = 2$.\n- $C$ and $D$ merge at height 3, so $c(C,D) = 3$.\n- $\\{A,B\\}$ and $E$ merge at height 5, so $c(A,E) = 5$ and $c(B,E) = 5$.\n- $\\{A,B,E\\}$ and $\\{C,D\\}$ merge at height 8. This is the root, so all remaining pairs have this cophenetic distance: $c(A,C) = c(A,D) = c(B,C) = c(B,D) = c(C,E) = c(D,E) = 8$.\n\nWe now list the original distances and cophenetic distances for all $\\binom{5}{2}=10$ pairs:\n- Original distances $\\mathbf{d} = (2, 9, 8, 4, 7, 8, 6, 3, 7, 9)$\n- Cophenetic distances $\\mathbf{c} = (2, 8, 8, 5, 8, 8, 5, 3, 8, 8)$\n\nThe cophenetic correlation coefficient is the Pearson correlation between $\\mathbf{d}$ and $\\mathbf{c}$.\nThe formula for Pearson correlation $\\rho$ is:\n$$ \\rho = \\frac{\\sum_{i=1}^{N} (d_i - \\bar{d})(c_i - \\bar{c})}{\\sqrt{\\sum_{i=1}^{N} (d_i - \\bar{d})^2 \\sum_{i=1}^{N} (c_i - \\bar{c})^2}} $$\nFirst, we calculate the means:\n$$ \\bar{d} = \\frac{2+9+8+4+7+8+6+3+7+9}{10} = \\frac{63}{10} = 6.3 $$\n$$ \\bar{c} = \\frac{2+8+8+5+8+8+5+3+8+8}{10} = \\frac{63}{10} = 6.3 $$\nNext, we calculate the terms for the formula:\n- Covariance term (numerator): $\\sum (d_i - \\bar{d})(c_i - \\bar{c}) = 50.1$\n- Sum of squares for $\\mathbf{d}$: $\\sum (d_i - \\bar{d})^2 = 56.1$\n- Sum of squares for $\\mathbf{c}$: $\\sum (c_i - \\bar{c})^2 = 50.1$\n\nSubstituting these values:\n$$ \\rho = \\frac{50.1}{\\sqrt{56.1 \\times 50.1}} = \\frac{50.1}{\\sqrt{2810.61}} \\approx \\frac{50.1}{53.0151855} \\approx 0.945012... $$\nRounding to four significant figures, the cophenetic correlation coefficient is $0.9450$.", "answer": "$$\n\\boxed{0.9450}\n$$", "id": "2439035"}, {"introduction": "The choice of linkage method is one of the most critical decisions in hierarchical clustering, as different methods can produce vastly different results. This problem moves beyond simple calculation to a deeper, theoretical analysis of how various linkage criteria behave under specific conditions [@problem_id:3114193]. By investigating which methods are robust to the addition of a duplicate data point, you will uncover fundamental mathematical properties that distinguish methods like single, complete, and Ward's linkage, equipping you to make more informed modeling choices.", "problem": "Consider a finite set of points $X = \\{x_1, x_2, \\dots, x_n\\} \\subset \\mathbb{R}^p$ with a metric $d$ given by the standard Euclidean distance. Hierarchical agglomerative clustering is performed using one of the following linkage criteria between two nonempty disjoint clusters $A$ and $B$: single linkage, complete linkage, average linkage (Unweighted Pair Group Method using Arithmetic Mean (UPGMA)), centroid linkage, and Ward’s linkage. A dendrogram is built by repeatedly merging the pair of clusters with the smallest inter-cluster dissimilarity according to the chosen linkage criterion. Let $X' = X \\cup \\{x_{k'}\\}$ be the dataset obtained by adding an exact duplicate $x_{k'}$ of an existing point $x_k$, so $x_{k'} = x_k$ and $d(x_k, x_{k'}) = 0$. Assume that whenever multiple pairs have equal dissimilarity, the algorithm uses a deterministic tie-breaking rule that preserves the relative order of merges among the original points in $X$.\n\nDefine “robust to duplicates” for a linkage criterion to mean the following: for any $X$ and any index $k \\in \\{1,\\dots,n\\}$, the dendrogram built on $X'$ differs from the dendrogram built on $X$ only by the insertion of a single merge at height $0$ that fuses $x_k$ with $x_{k'}$, and, after that, the merge order among the original $n$ points and all nonzero merge heights are identical to those obtained from $X$.\n\nWhich of the following sets of linkage criteria are robust to duplicates under this definition?\n\nA. Single linkage, complete linkage, and average linkage (UPGMA)\n\nB. Single linkage and complete linkage only\n\nC. Average linkage (UPGMA) and Ward’s linkage\n\nD. Ward’s linkage and centroid linkage only\n\nE. All five listed linkage criteria are robust to duplicates", "solution": "The problem asks which linkage criteria are \"robust to duplicates.\" A criterion is robust if adding a duplicate point $x_{k'}$ for an existing point $x_k$ only results in a new merge at height 0 between $x_k$ and $x_{k'}$, without altering the rest of the dendrogram's structure or merge heights for the original points.\n\nLet's analyze each linkage method. The first step in clustering $X'$ will always be to merge $x_k$ and $x_{k'}$ into a new cluster $C_k^* = \\{x_k, x_{k'}\\}$ at height $d(x_k, x_{k'}) = 0$. For the rest of the dendrogram to remain unchanged, the dissimilarity between $C_k^*$ and any other cluster $C_j$ (where $C_j \\subset X \\setminus \\{x_k\\}$) must be identical to the dissimilarity between the original singleton cluster $\\{x_k\\}$ and $C_j$.\n\n1.  **Single Linkage**: $d_{\\text{single}}(A,B) = \\min_{a \\in A, b \\in B} d(a,b)$.\n    For our duplicate cluster $C_k^* = \\{x_k, x_{k'}\\}$ and another cluster $C_j$:\n    $d_{\\text{single}}(C_k^*, C_j) = \\min(\\min_{y \\in C_j} d(x_k, y), \\min_{y \\in C_j} d(x_{k'}, y))$.\n    Since $x_k = x_{k'}$, this simplifies to $\\min_{y \\in C_j} d(x_k, y) = d_{\\text{single}}(\\{x_k\\}, C_j)$.\n    This property holds for all subsequent merges. Thus, single linkage is **robust**.\n\n2.  **Complete Linkage**: $d_{\\text{complete}}(A,B) = \\max_{a \\in A, b \\in B} d(a,b)$.\n    Similar to single linkage:\n    $d_{\\text{complete}}(C_k^*, C_j) = \\max(\\max_{y \\in C_j} d(x_k, y), \\max_{y \\in C_j} d(x_{k'}, y))$.\n    Since $x_k = x_{k'}$, this is $\\max_{y \\in C_j} d(x_k, y) = d_{\\text{complete}}(\\{x_k\\}, C_j)$.\n    Thus, complete linkage is **robust**.\n\n3.  **Average Linkage (UPGMA)**: $d_{\\text{avg}}(A,B) = \\frac{1}{|A||B|} \\sum_{a \\in A, b \\in B} d(a,b)$.\n    For $C_k^*$ (with $|C_k^*|=2$) and $C_j$:\n    $d_{\\text{avg}}(C_k^*, C_j) = \\frac{1}{2|C_j|} \\left( \\sum_{y \\in C_j} d(x_k, y) + \\sum_{y \\in C_j} d(x_{k'}, y) \\right)$.\n    Since $d(x_k, y) = d(x_{k'}, y)$, this becomes $\\frac{1}{2|C_j|} \\left( 2 \\sum_{y \\in C_j} d(x_k, y) \\right) = \\frac{1}{1 \\cdot |C_j|} \\sum_{y \\in C_j} d(x_k, y) = d_{\\text{avg}}(\\{x_k\\}, C_j)$.\n    Thus, average linkage is **robust**.\n\n4.  **Centroid Linkage**: $d_{\\text{centroid}}(A,B) = d(\\mu_A, \\mu_B)^2$, where $\\mu_A$ is the centroid of cluster $A$.\n    The centroid of $C_k^*$ is $\\mu_{C_k^*} = (x_k + x_{k'})/2 = x_k$. The centroid of $\\{x_k\\}$ is also $x_k$. So initially, distances are preserved. However, if $C_k^*$ is merged with another cluster $C_j$, the new centroid is $\\mu_{C_k^* \\cup C_j} = \\frac{2\\mu_{C_k^*} + |C_j|\\mu_{C_j}}{2+|C_j|} = \\frac{2x_k + |C_j|\\mu_{C_j}}{2+|C_j|}$. This is different from the centroid formed when merging $\\{x_k\\}$ with $C_j$: $\\mu_{\\{x_k\\} \\cup C_j} = \\frac{x_k + |C_j|\\mu_{C_j}}{1+|C_j|}$. Because the centroid positions diverge, subsequent merge decisions will be different. Thus, centroid linkage is **not robust**.\n\n5.  **Ward’s Linkage**: $d_{\\text{ward}}(A,B) = \\frac{|A||B|}{|A|+|B|} d(\\mu_A, \\mu_B)^2$.\n    Let's compare the dissimilarity between $C_k^*$ and $C_j$ versus $\\{x_k\\}$ and $C_j$.\n    $d_{\\text{ward}}(C_k^*, C_j) = \\frac{2|C_j|}{2+|C_j|} d(x_k, \\mu_{C_j})^2$.\n    $d_{\\text{ward}}(\\{x_k\\}, C_j) = \\frac{1|C_j|}{1+|C_j|} d(x_k, \\mu_{C_j})^2$.\n    Since $\\frac{2}{2+|C_j|} \\neq \\frac{1}{1+|C_j|}$, the dissimilarities are not the same. Thus, Ward's linkage is **not robust**.\n\nThe robust linkage criteria are single, complete, and average linkage (UPGMA). This corresponds to option A.", "answer": "$$\\boxed{A}$$", "id": "3114193"}]}