{"hands_on_practices": [{"introduction": "随着可穿戴健康设备的普及，一个关键问题随之而来：我们如何信任它们的测量数据？在将新设备的数据用于临床决策之前，我们必须将其与可靠的“金标准”进行严格比较。这项练习 [@problem_id:4955177] 将向您介绍 Bland-Altman 方法，这是一种基础的统计工具，用于量化两种测量技术之间的一致性并评估其临床可接受性。", "problem": "一个远程医疗项目评估了一款腕戴式可穿戴设备的心率读数，并将其与临床级心电图（ECG）的同步测量值进行比较。对于 $n=12$ 名静息状态下的成年人，可穿戴设备的心率（单位：次/分钟，$\\mathrm{bpm}$）和ECG心率（单位：$\\mathrm{bpm}$）被记录为配对测量值：\n$$(\\text{可穿戴设备}, \\text{ECG}) = (65, 62),\\ (74, 75),\\ (93, 88),\\ (66, 70),\\ (95, 95),\\ (82, 80),\\ (74, 76),\\ (88, 84),\\ (69, 72),\\ (91, 90),\\ (77, 78),\\ (83, 83)。$$\n假设测量误差（可穿戴设备读数减去ECG读数）在受试者中近似服从正态分布，并应用 Bland–Altman 方法来量化一致性。从用于临床验证中测量误差评估的基本统计学原理出发，计算：\n- 平均偏差（定义为可穿戴设备读数与ECG读数之差的平均值），以及\n- 95%双侧一致性界限。\n\n然后，使用以下为数字健康领域的静息心率监测预定义的阈值来解读临床可接受性：如果平均偏差的绝对值小于或等于 $1\\,\\mathrm{bpm}$，并且95%双侧一致性界限位于零点周围的 $\\pm 5\\,\\mathrm{bpm}$ 范围内，则该可穿戴设备被认为是临床可接受的。\n\n以行向量的形式报告您的最终数值结果，顺序为 $[\\text{平均偏差},\\ \\text{一致性下限},\\ \\text{一致性上限}]$。将您的答案四舍五入到三位有效数字。所有中间量和最终量均以 $\\mathrm{bpm}$ 为单位表示，但不要在最终的方框向量中包含单位。", "solution": "该问题要求应用 Bland–Altman 方法来评估一款可穿戴设备和一台临床级ECG在心率测量上的一致性。该分析基于一组 $n=12$ 的配对测量值。此方法的核心在于计算两种测量技术之间差异的平均值和标准差。\n\n首先，我们为 $i=1, \\dots, 12$ 中的每一位受试者定义差异 $d_i$，即为可穿戴设备的测量值减去ECG的测量值。\n设配对测量值为 $(W_i, E_i)$。则 $d_i = W_i - E_i$。计算出的差异如下：\n$d_1 = 65 - 62 = 3$\n$d_2 = 74 - 75 = -1$\n$d_3 = 93 - 88 = 5$\n$d_4 = 66 - 70 = -4$\n$d_5 = 95 - 95 = 0$\n$d_6 = 82 - 80 = 2$\n$d_7 = 74 - 76 = -2$\n$d_8 = 88 - 84 = 4$\n$d_9 = 69 - 72 = -3$\n$d_{10} = 91 - 90 = 1$\n$d_{11} = 77 - 78 = -1$\n$d_{12} = 83 - 83 = 0$\n\n差异集合为 $\\{3, -1, 5, -4, 0, 2, -2, 4, -3, 1, -1, 0\\}$。\n\n第一个要计算的量是平均偏差，即这些差异的样本均值，记为 $\\bar{d}$。\n$$\n\\bar{d} = \\frac{1}{n} \\sum_{i=1}^{n} d_i\n$$\n差异的总和是：\n$$\n\\sum_{i=1}^{12} d_i = 3 + (-1) + 5 + (-4) + 0 + 2 + (-2) + 4 + (-3) + 1 + (-1) + 0 = 4\n$$\n因此，平均偏差为：\n$$\n\\bar{d} = \\frac{4}{12} = \\frac{1}{3} \\approx 0.3333... \\ \\mathrm{bpm}\n$$\n\n接下来，我们计算差异的样本标准差 $s_d$。样本标准差的公式是：\n$$\ns_d = \\sqrt{\\frac{1}{n-1} \\sum_{i=1}^{n} (d_i - \\bar{d})^2}\n$$\n为了计算它，我们可以使用计算公式 $\\sum_{i=1}^{n} (d_i - \\bar{d})^2 = \\sum_{i=1}^{n} d_i^2 - \\frac{(\\sum_{i=1}^{n} d_i)^2}{n}$。\n首先，我们求差异的平方和：\n$$\n\\sum_{i=1}^{12} d_i^2 = 3^2 + (-1)^2 + 5^2 + (-4)^2 + 0^2 + 2^2 + (-2)^2 + 4^2 + (-3)^2 + 1^2 + (-1)^2 + 0^2\n$$\n$$\n\\sum_{i=1}^{12} d_i^2 = 9 + 1 + 25 + 16 + 0 + 4 + 4 + 16 + 9 + 1 + 1 + 0 = 86\n$$\n现在我们可以计算离差平方和：\n$$\n\\sum_{i=1}^{12} (d_i - \\bar{d})^2 = 86 - \\frac{4^2}{12} = 86 - \\frac{16}{12} = 86 - \\frac{4}{3} = \\frac{258 - 4}{3} = \\frac{254}{3}\n$$\n样本方差 $s_d^2$ 为：\n$$\ns_d^2 = \\frac{1}{12-1} \\left( \\frac{254}{3} \\right) = \\frac{254}{33}\n$$\n样本标准差为：\n$$\ns_d = \\sqrt{\\frac{254}{33}} \\approx 2.7743... \\ \\mathrm{bpm}\n$$\n\n95%双侧一致性界限（LOA）被定义用于确定一个区间，预计未来95%的测量差异会落入此区间内。假设差异服从正态分布，这个区间可以从样本数据中估计为 $\\bar{d} \\pm 1.96 s_d$。值1.96是对应于标准正态分布中心95%的z分数。\n$$\n\\text{LOA} = \\bar{d} \\pm 1.96 s_d\n$$\n一致性区间的半宽度为：\n$$\n1.96 s_d = 1.96 \\times \\sqrt{\\frac{254}{33}} \\approx 1.96 \\times 2.7743... \\approx 5.4377... \\ \\mathrm{bpm}\n$$\n一致性下限（LLA）为：\n$$\n\\text{LLA} = \\bar{d} - 1.96 s_d \\approx \\frac{1}{3} - 5.4377... \\approx 0.3333... - 5.4377... \\approx -5.1044... \\ \\mathrm{bpm}\n$$\n一致性上限（ULA）为：\n$$\n\\text{ULA} = \\bar{d} + 1.96 s_d \\approx \\frac{1}{3} + 5.4377... \\approx 0.3333... + 5.4377... \\approx 5.7710... \\ \\mathrm{bpm}\n$$\n问题要求将最终数值结果四舍五入到三位有效数字。\n平均偏差 $= 0.333 \\ \\mathrm{bpm}$。\n一致性下限 $= -5.10 \\ \\mathrm{bpm}$。\n一致性上限 $= 5.77 \\ \\mathrm{bpm}$。\n\n最后，我们根据预定义的阈值解读临床可接受性。\n1. 平均偏差的绝对值：$|\\bar{d}| \\approx |0.333| = 0.333 \\ \\mathrm{bpm}$。由于 $0.333 \\le 1$，此标准得到满足。系统偏差在临床上是可接受的。\n2. 95%一致性界限：该区间约为 $[-5.10, 5.77]$。标准要求该区间位于零点周围的 $\\pm 5 \\ \\mathrm{bpm}$ 范围内，即 $[-5, 5]$ 内。计算出的一致性下限 ($-5.10$) 低于 $-5$，且一致性上限 ($5.77$) 高于 $5$。因此，此标准未得到满足。\n\n该可穿戴设备显示出可接受的小系统误差（偏差），但其随机误差（变异性）过大，根据指定标准，不能被认为是临床可接受的。\n\n最终需报告的数值是平均偏差、一致性下限和一致性上限，并四舍五入到三位有效数字。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.333  -5.10  5.77\n\\end{pmatrix}\n}\n$$", "id": "4955177"}, {"introduction": "一个预测模型可能很准确，但它在临床上真的有用吗？这个问题是负责任地在医学中应用人工智能的核心。决策曲线分析（Decision Curve Analysis, DCA）是一种现代技术，通过权衡临床决策的利弊来评估模型的效用。在此练习 [@problem_id:4955199] 中，您将应用DCA来确定一个风险预测模型在一系列临床情境下，是否能带来净获益。", "problem": "一个远程医疗服务使用监督分类模型来为每次远程咨询估计患者真正需要当天紧急当面评估的概率。该风险估计用于在估计风险超过一个阈值时，决定是否推荐进行当面评估。给定一个包含 $N=30$ 次远程医疗咨询的队列，其模型预测风险为 $\\{p_i\\}_{i=1}^{30}$，二元结果为 $\\{y_i\\}_{i=1}^{30}$，其中 $y_i=1$ 表示患者确实需要当天紧急当面评估，而 $y_i=0$ 表示患者不需要。数据对 $(p_i,y_i)$ 如下：\n$(0.45,1)$, $(0.42,1)$, $(0.38,1)$, $(0.35,1)$, $(0.33,1)$, $(0.31,0)$, $(0.29,1)$, $(0.28,0)$, $(0.27,0)$, $(0.25,1)$, $(0.24,0)$, $(0.23,0)$, $(0.22,1)$, $(0.21,0)$, $(0.19,1)$, $(0.18,0)$, $(0.17,0)$, $(0.16,0)$, $(0.15,0)$, $(0.14,0)$, $(0.13,0)$, $(0.12,0)$, $(0.11,0)$, $(0.10,0)$, $(0.09,0)$, $(0.08,0)$, $(0.07,0)$, $(0.06,0)$, $(0.05,0)$, $(0.03,0)$.\n\n采纳决策规则：“推荐当面评估”，当且仅当 $p_i \\ge t$，其中 $t$ 是风险阈值。使用混淆矩阵计数的基本定义和决策曲线分析（DCA）中的净收益构造，并从风险阈值下收益与危害权衡的第一性原理出发，执行以下操作：\n\n1. 对于阈值 $t \\in \\{0.1,\\,0.2,\\,0.3\\}$，计算模型在每个 $t$ 处的净收益。\n2. 通过在指定阈值范围内将模型的净收益与“全部干预”和“全部不干预”策略进行比较，从概念上构建相应的决策曲线。\n3. 解释在每个阈值下，相对于“全部干预”和“全部不干预”策略，该模型是否提供临床效用。\n\n将模型在 $t \\in \\{0.1,\\,0.2,\\,0.3\\}$ 处的最终数值净收益以“每100名患者的收益单位”表示，并将每个值四舍五入到四位有效数字。在你的最终方框答案中不要包含单位。", "solution": "### 第1步：提取已知信息\n- 远程医疗咨询总数：$N=30$。\n- 模型预测的风险和二元结果：一组30个数据对 $(p_i, y_i)$，其中 $p_i$ 是预测风险，$y_i$ 是真实结果。\n- 结果定义：如果患者需要当天紧急当面评估，则 $y_i=1$，否则 $y_i=0$。\n- 数据对如下：\n$(0.45,1)$, $(0.42,1)$, $(0.38,1)$, $(0.35,1)$, $(0.33,1)$, $(0.31,0)$, $(0.29,1)$, $(0.28,0)$, $(0.27,0)$, $(0.25,1)$, $(0.24,0)$, $(0.23,0)$, $(0.22,1)$, $(0.21,0)$, $(0.19,1)$, $(0.18,0)$, $(0.17,0)$, $(0.16,0)$, $(0.15,0)$, $(0.14,0)$, $(0.13,0)$, $(0.12,0)$, $(0.11,0)$, $(0.10,0)$, $(0.09,0)$, $(0.08,0)$, $(0.07,0)$, $(0.06,0)$, $(0.05,0)$, $(0.03,0)$.\n- 决策规则：当且仅当 $p_i \\ge t$ 时推荐当面评估，其中 $t$ 是风险阈值。\n- 分析阈值：$t \\in \\{0.1, 0.2, 0.3\\}$。\n- 要求输出：\n    1. 计算模型在每个阈值 $t$ 处的净收益。\n    2. 从概念上构建决策曲线。\n    3. 解释模型相对于“全部干预”和“全部不干预”策略的临床效用。\n    4. 将最终净收益以“每100名患者的收益单位”表示，并四舍五入到四位有效数字。\n\n### 第2步：使用提取的已知信息进行验证\n对问题进行验证。\n\n- **科学依据**：该问题基于决策曲线分析（DCA），这是一种成熟且广泛用于评估预测模型和诊断测试临床效用的方法。监督学习、混淆矩阵计数（真阳性、假阳性）和净收益等概念是生物统计学和医学信息学中的标准概念。该设置在科学上是合理的。\n- **适定性**：该问题提供了一个完整的数据集和一组清晰、明确的任务。所需的量在DCA框架内有明确的定义。可以通过直接计算确定唯一的解。\n- **客观性**：问题陈述是定量的，没有主观、有偏见或基于观点的语言。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解答。\n\n### 解答推导\n\n#### 决策曲线分析（DCA）的基本原理\n决策曲线分析建立在这样一个原则之上：预测模型的价值取决于正确识别阳性病例（真阳性，TP）的收益与错误地将阴性病例识别为阳性（假阳性，FP）的危害之间的权衡。决策者（如临床医生）在一个内隐或外显的风险阈值 $t$ 下操作。该阈值表示决策者会选择进行干预（在本例中为推荐当面评估）的事件发生的最低概率。\n\n净收益（NB）是通过量化这种权衡来构建的。干预的收益在真阳性病例中实现。干预的危害（例如，成本、患者焦虑、不必要的资源使用）在假阳性病例中产生。在给定的阈值 $t$ 下，一个假阳性的危害相对于一个真阳性的收益的权重由该阈值下事件的优势（odds）给出，即 $\\frac{t}{1-t}$。这个比率是危害与收益之间的“交换率”。\n\n对于一个大小为 $N$ 的群体，净收益定义为真阳性总数减去加权的假阳性总数，然后全部按群体大小进行缩放：\n$$\n\\text{NB}(t) = \\frac{\\text{TP}(t)}{N} - \\frac{\\text{FP}(t)}{N} \\left(\\frac{t}{1-t}\\right)\n$$\n其中 $\\text{TP}(t)$ 和 $\\text{FP}(t)$ 分别是当决策阈值为 $t$ 时的真阳性和假阳性数量。\n\n#### 参考策略\n模型的效用是通过将其净收益与两种默认策略的净收益进行比较来评估的：\n1.  **全部不干预**：无论风险如何，从不推荐当面评估。在这种情况下，$\\text{TP} = 0$ 且 $\\text{FP} = 0$。净收益始终为零。\n    $$\n    \\text{NB}_{\\text{none}}(t) = 0\n    $$\n2.  **全部干预**：为所有患者推荐当面评估。在这里，所有患有该状况的患者都是真阳性，所有没有该状况的患者都是假阳性。设 $P$ 为患有该状况的患者总数（阳性结果），$N_{neg}$ 为没有该状况的患者总数。\n    $$\n    \\text{NB}_{\\text{all}}(t) = \\frac{P}{N} - \\frac{N_{neg}}{N} \\left(\\frac{t}{1-t}\\right)\n    $$\n\n#### 数据分析和计数\n首先，我们确定在 $N=30$ 名患者的队列中，阳性（$P$）和阴性（$N_{neg}$）病例的总数。通过对提供的数据进行计数：\n-   $y_i=1$ 的患者数量为 $P=9$。\n-   $y_i=0$ 的患者数量为 $N_{neg} = 30 - 9 = 21$。\n该队列中状况的患病率为 $\\frac{P}{N} = \\frac{9}{30} = 0.3$。\n\n现在我们计算模型在每个指定阈值 $t$ 下的混淆矩阵计数（$\\text{TP}$ 和 $\\text{FP}$）。\n\n**1. 对阈值 $t=0.1$ 的分析**\n如果患者的预测风险 $p_i \\ge 0.1$，则推荐进行评估。\n-   **真阳性 ($\\text{TP}(0.1)$)**：$y_i=1$ 且 $p_i \\ge 0.1$ 的患者。\n    所有9名 $y_i=1$ 患者的风险为 $\\{0.45, 0.42, 0.38, 0.35, 0.33, 0.29, 0.25, 0.22, 0.19\\}$，这些风险都 $\\ge 0.1$。因此，$\\text{TP}(0.1) = 9$。\n-   **假阳性 ($\\text{FP}(0.1)$)**：$y_i=0$ 且 $p_i \\ge 0.1$ 的患者。\n    $y_i=0$ 的患者中风险 $\\ge 0.1$ 的风险值为 $\\{0.31, 0.28, 0.27, 0.24, 0.23, 0.21, 0.18, 0.17, 0.16, 0.15, 0.14, 0.13, 0.12, 0.11, 0.10\\}$。计数得出 $\\text{FP}(0.1) = 15$。\n-   **模型的净收益**：\n    $$\n    \\text{NB}_{\\text{model}}(0.1) = \\frac{9}{30} - \\frac{15}{30} \\left(\\frac{0.1}{1-0.1}\\right) = 0.3 - 0.5 \\left(\\frac{0.1}{0.9}\\right) = 0.3 - 0.5 \\left(\\frac{1}{9}\\right) = \\frac{2.7 - 0.5}{9} = \\frac{2.2}{9} \\approx 0.24444\n    $$\n\n**2. 对阈值 $t=0.2$ 的分析**\n如果患者的预测风险 $p_i \\ge 0.2$，则推荐进行评估。\n-   **真阳性 ($\\text{TP}(0.2)$)**：$y_i=1$ 且 $p_i \\ge 0.2$ 的患者。\n    风险为 $p_i=0.19$ 的阳性病例现在被排除。因此，$\\text{TP}(0.2) = 8$。\n-   **假阳性 ($\\text{FP}(0.2)$)**：$y_i=0$ 且 $p_i \\ge 0.2$ 的患者。\n    $y_i=0$ 的患者中风险 $\\ge 0.2$ 的风险值为 $\\{0.31, 0.28, 0.27, 0.24, 0.23, 0.21\\}$。这得出 $\\text{FP}(0.2) = 6$。\n-   **模型的净收益**：\n    $$\n    \\text{NB}_{\\text{model}}(0.2) = \\frac{8}{30} - \\frac{6}{30} \\left(\\frac{0.2}{1-0.2}\\right) = \\frac{8}{30} - \\frac{6}{30} \\left(\\frac{0.2}{0.8}\\right) = \\frac{1}{30} \\left(8 - 6 \\times \\frac{1}{4}\\right) = \\frac{1}{30} (8 - 1.5) = \\frac{6.5}{30} = \\frac{13}{60} \\approx 0.21667\n    $$\n\n**3. 对阈值 $t=0.3$ 的分析**\n如果患者的预测风险 $p_i \\ge 0.3$，则推荐进行评估。\n-   **真阳性 ($\\text{TP}(0.3)$)**：$y_i=1$ 且 $p_i \\ge 0.3$ 的患者。\n    风险 $\\ge 0.3$ 的阳性病例的风险值为 $\\{0.45, 0.42, 0.38, 0.35, 0.33\\}$。因此，$\\text{TP}(0.3) = 5$。\n-   **假阳性 ($\\text{FP}(0.3)$)**：$y_i=0$ 且 $p_i \\ge 0.3$ 的患者。\n    风险 $\\ge 0.3$ 的阴性病例只有一个，其风险为 $0.31$。因此，$\\text{FP}(0.3) = 1$。\n-   **模型的净收益**：\n    $$\n    \\text{NB}_{\\text{model}}(0.3) = \\frac{5}{30} - \\frac{1}{30} \\left(\\frac{0.3}{1-0.3}\\right) = \\frac{5}{30} - \\frac{1}{30} \\left(\\frac{0.3}{0.7}\\right) = \\frac{1}{30} \\left(5 - \\frac{3}{7}\\right) = \\frac{1}{30} \\left(\\frac{35-3}{7}\\right) = \\frac{32}{210} = \\frac{16}{105} \\approx 0.15238\n    $$\n\n#### 决策曲线和临床效用解释\n\n为了解释临床效用，我们将模型的净收益与“全部干预”和“全部不干预”策略在每个阈值下的净收益进行比较。\n-   对于所有 $t$，$\\text{NB}_{\\text{none}}(t) = 0$。\n-   $\\text{NB}_{\\text{all}}(t) = \\frac{9}{30} - \\frac{21}{30} \\left(\\frac{t}{1-t}\\right) = 0.3 - 0.7 \\left(\\frac{t}{1-t}\\right)$。\n    -   $\\text{NB}_{\\text{all}}(0.1) = 0.3 - 0.7(\\frac{0.1}{0.9}) = 0.3 - \\frac{0.7}{9} \\approx 0.3 - 0.07778 = 0.22222$\n    -   $\\text{NB}_{\\text{all}}(0.2) = 0.3 - 0.7(\\frac{0.2}{0.8}) = 0.3 - 0.7(0.25) = 0.3 - 0.175 = 0.125$\n    -   $\\text{NB}_{\\text{all}}(0.3) = 0.3 - 0.7(\\frac{0.3}{0.7}) = 0.3 - 0.3 = 0$\n\n**概念性决策曲线及解释：**\n\n决策曲线绘制了净收益（y轴）相对于风险阈值 $t$（x轴）的图。我们可以将我们对三个阈值的发现总结如下：\n\n| 阈值 ($t$) | $\\text{NB}_{\\text{model}}(t)$ | $\\text{NB}_{\\text{all}}(t)$ | $\\text{NB}_{\\text{none}}(t)$ |\n|:---------------:|:-------------------------:|:----------------------:|:-----------------------:|\n| $0.1$           | $\\approx 0.244$         | $\\approx 0.222$      | $0$                     |\n| $0.2$           | $\\approx 0.217$         | $0.125$                | $0$                     |\n| $0.3$           | $\\approx 0.152$         | $0$                    | $0$                     |\n\n-   在阈值 $t=0.1$ 处：$\\text{NB}_{\\text{model}}(0.1) > \\text{NB}_{\\text{all}}(0.1) > \\text{NB}_{\\text{none}}(0.1)$。模型提供了最高的净收益。这意味着，对于一个决策者来说，如果他认为为9个不需要当面就诊的患者放弃就诊，其价值等同于确保1个确实需要的患者获得就诊（即，优势比为1:9，对应于 $t=0.1$），那么使用该模型是最佳策略。\n-   在阈值 $t=0.2$ 处：$\\text{NB}_{\\text{model}}(0.2) > \\text{NB}_{\\text{all}}(0.2) > \\text{NB}_{\\text{none}}(0.2)$。模型的优越性更加明显。一个阈值为20%（愿意为每4次必要的就诊接受1次不必要的就诊）的决策者，通过使用模型比推荐所有人都就诊或都不就诊获得更多收益。\n-   在阈值 $t=0.3$ 处：$\\text{NB}_{\\text{model}}(0.3) > \\text{NB}_{\\text{all}}(0.3) = \\text{NB}_{\\text{none}}(0.3)$。在这个与样本患病率相匹配的阈值下，“全部干预”策略相比“全部不干预”策略没有提供任何收益。然而，该模型提供了显著的正净收益，使其明显成为最有价值的策略。\n\n从概念上讲，模型的决策曲线将是连接点 $(0.1, 0.244)$、$(0.2, 0.217)$ 和 $(0.3, 0.152)$ 的一条线。这条曲线始终位于“全部干预”策略的线和“全部不干预”策略在 $y=0$ 处的水平线上方。这表明该模型在这一系列风险阈值上具有临床效用。\n\n#### 最终答案计算\n问题要求以每100名患者的单位表示模型的净收益，并四舍五入到四位有效数字。这需要将每个患者的NB值乘以100。\n\n-   对于 $t=0.1$：$\\text{NB}_{\\text{model}} \\times 100 = 0.24444... \\times 100 = 24.444... \\approx 24.44$\n-   对于 $t=0.2$：$\\text{NB}_{\\text{model}} \\times 100 = 0.21666... \\times 100 = 21.666... \\approx 21.67$\n-   对于 $t=0.3$：$\\text{NB}_{\\text{model}} \\times 100 = 0.15238... \\times 100 = 15.238... \\approx 15.24$\n\n这三个值代表最终答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} 24.44  21.67  15.24 \\end{pmatrix}}\n$$", "id": "4955199"}]}