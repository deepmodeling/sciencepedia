{"hands_on_practices": [{"introduction": "为了在医学成像和临床分析中进行精确定量，我们必须将“前”、“上”等描述性术语转化为数学坐标系。这项实践练习 [@problem_id:4969445] 将帮助您建立这种基础联系，通过使用医学成像中常见的RAS（右-前-上）坐标系，将解剖学语言精确地翻译为矢量。", "problem": "一个医学影像数据集使用右-前-上 (RAS) 坐标约定，其中 $x$轴指向患者的右侧 ($\\hat{R}$)，$y$轴指向患者的前方 ($\\hat{A}$)，$z$轴指向患者的上方 ($\\hat{S}$)。假设这些坐标轴构成一个标准正交基。在解剖学术语中，“左”对应于患者右侧的相反方向。\n\n从标准正交基和标准解剖方位术语的核心定义出发，将“前”、“上”和“左”映射到它们在RAS基中的各自单位方向。然后，根据复合方向形容词（例如，“anterosuperolateral”，即前上外侧）表示每个包含的方向贡献相等，而未提及的方向没有贡献的原则，构建表示“前上外侧”方向的向量，并将其归一化为单位长度。\n\n将您的最终答案表示为单行向量 $\\begin{pmatrix} R  A  S \\end{pmatrix}$，给出沿 $\\hat{R}$、$\\hat{A}$ 和 $\\hat{S}$ 的分量，以精确形式表示。不要四舍五入。", "solution": "该问题要求在右-前-上 (RAS) 坐标系中构建一个表示“前上外侧”方向的归一化向量。对问题陈述的验证证实了其科学性、适定性和客观性，从而可以进行严谨的求解。\n\n首先，我们建立由RAS坐标系定义的标准正交基向量的数学表示。设 $\\hat{R}$、$\\hat{A}$ 和 $\\hat{S}$ 分别是对应于右、前、上方向的单位向量。我们可以将它们与标准笛卡尔基向量 $\\hat{i}$、$\\hat{j}$ 和 $\\hat{k}$ 相关联：\n$$\n\\hat{R} \\equiv \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad \\hat{A} \\equiv \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad \\hat{S} \\equiv \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n正如问题所述，这些向量构成一个标准正交集：$\\hat{R} \\cdot \\hat{A} = 0$、$\\hat{R} \\cdot \\hat{S} = 0$、$\\hat{A} \\cdot \\hat{S} = 0$ 且 $|\\hat{R}| = |\\hat{A}| = |\\hat{S}| = 1$。\n\n接下来，我们将指定的解剖学术语映射到该基中的相应单位向量。\n1.  **前 (Anterior)**：问题指出，$y$轴指向患者的前方。因此，前方向的单位向量是 $\\vec{v}_{\\text{anterior}} = \\hat{A}$。\n    $$\n    \\vec{v}_{\\text{anterior}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n    $$\n2.  **上 (Superior)**：问题指出，$z$轴指向患者的上方。因此，上方向的单位向量是 $\\vec{v}_{\\text{superior}} = \\hat{S}$。\n    $$\n    \\vec{v}_{\\text{superior}} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n    $$\n3.  **左 (Left)**：问题将“左”定义为与患者右侧相反的方向。右侧方向由 $\\hat{R}$ 给出。因此，相反方向是 $-\\hat{R}$。左方向的单位向量是 $\\vec{v}_{\\text{left}} = -\\hat{R}$。\n    $$\n    \\vec{v}_{\\text{left}} = -\\hat{R} = \\begin{pmatrix} -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n    $$\n\n问题要求表示“前上外侧”方向的向量。这是一个由“前”、“上”和“外侧”组成的复合术语。在标准解剖学术语中，“外侧”表示远离身体中线的方向。在RAS系统的背景下，这对应于由$\\hat{R}$向量（内-外侧轴）定义的轴。方向可以是右或左。考虑到问题明确要求映射术语“左”而不是“右”（这是一个主基向量），在问题自身的框架内，最合乎逻辑和一致的解释是，这个复合术语中的“外侧”指的是“左”方向。\n\n现在我们构建“前上外侧”方向的未归一化向量，记为 $\\vec{V}$。问题指出，一个复合方向由每个包含的方向做出相等贡献。这意味着 $\\vec{V}$ 是构成方向（前、上、左）的单位向量的向量和。\n$$\n\\vec{V} = \\vec{v}_{\\text{anterior}} + \\vec{v}_{\\text{superior}} + \\vec{v}_{\\text{left}}\n$$\n代入这些向量的分量形式：\n$$\n\\vec{V} = \\hat{A} + \\hat{S} + (-\\hat{R}) = -\\hat{R} + \\hat{A} + \\hat{S}\n$$\n$$\n\\vec{V} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ 1 \\\\ 1 \\end{pmatrix}\n$$\n这个向量 $\\vec{V}$ 在 $(\\hat{R}, \\hat{A}, \\hat{S})$ 基中的分量为 $(-1, 1, 1)$。\n\n最后，我们必须将此向量归一化为单位长度。$\\vec{V}$ 的大小由欧几里得范数给出：\n$$\n|\\vec{V}| = \\sqrt{(-1)^2 + 1^2 + 1^2} = \\sqrt{1 + 1 + 1} = \\sqrt{3}\n$$\n归一化单位向量 $\\hat{u}$ 通过将 $\\vec{V}$ 除以其大小 $|\\vec{V}|$ 得到：\n$$\n\\hat{u} = \\frac{\\vec{V}}{|\\vec{V}|} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} -1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -\\frac{1}{\\sqrt{3}} \\\\ \\frac{1}{\\sqrt{3}} \\\\ \\frac{1}{\\sqrt{3}} \\end{pmatrix}\n$$\n为了方便表示，我们将分母有理化：\n$$\n\\hat{u} = \\begin{pmatrix} -\\frac{\\sqrt{3}}{3} \\\\ \\frac{\\sqrt{3}}{3} \\\\ \\frac{\\sqrt{3}}{3} \\end{pmatrix}\n$$\n该向量表示为RAS基中的“前上外侧”方向的单位向量。沿 $\\hat{R}$、$\\hat{A}$ 和 $\\hat{S}$ 轴的分量分别为 $-\\frac{\\sqrt{3}}{3}$、$\\frac{\\sqrt{3}}{3}$ 和 $\\frac{\\sqrt{3}}{3}$。最终答案按要求表示为行向量。", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{\\sqrt{3}}{3}  \\frac{\\sqrt{3}}{3}  \\frac{\\sqrt{3}}{3} \\end{pmatrix}}\n$$", "id": "4969445"}, {"introduction": "在临床实践中，病人并非总是处于标准的解剖学姿势。这个练习 [@problem_id:4969460] 建立在前一练习的基础上，探讨如何通过旋转矩阵来数学化地描述仰卧（supine）和俯卧（prone）等常见临床体位。这对于正确解读不同病人方位的医学图像和规划治疗方案至关重要。", "problem": "在某医学影像实验室中，患者朝向采用右-前-上 (RAS) 坐标系约定进行编码，其中基于患者的标准正交基向量表示为 $\\hat{\\mathbf{r}}$ (右)、$\\hat{\\mathbf{a}}$ (前) 和 $\\hat{\\mathbf{s}}$ (上)。考虑一个固定的实验室（世界）坐标系，其标准正交基向量为 $\\hat{\\mathbf{x}}_{w}$ (东)、$\\hat{\\mathbf{y}}_{w}$ (北) 和 $\\hat{\\mathbf{z}}_{w}$ (上)。在标准解剖位置下，患者面向 $\\hat{\\mathbf{y}}_{w}$，右侧指向 $\\hat{\\mathbf{x}}_{w}$，头部（上）指向 $\\hat{\\mathbf{z}}_{w}$，因此 $\\hat{\\mathbf{r}}=\\hat{\\mathbf{x}}_{w}$、$\\hat{\\mathbf{a}}=\\hat{\\mathbf{y}}_{w}$ 和 $\\hat{\\mathbf{s}}=\\hat{\\mathbf{z}}_{w}$ 的等价关系成立。临床仰卧位定义为仰卧且面部朝上；临床俯卧位定义为俯卧且面部朝下。假设患者通过三维空间中的刚体旋转在这些位置之间转换，该旋转由旋转矩阵 $R \\in SO(3)$ 建模，其中 $SO(3)$ 是特殊正交旋转群。围绕患者的右轴 $\\hat{\\mathbf{r}}$ 使用右手定则确定旋转方向，所有角度均以弧度表示。\n\n仅从解剖位置、仰卧位和俯卧位朝向的核心定义，以及 $SO(3)$ 中刚体旋转的标准性质出发，进行以下推理：\n- 确定当从解剖位置转换到仰卧位以及从解剖位置转换到俯卧位时，RAS基向量相对于世界坐标系的符号变化，方法是确定每次旋转后 $\\hat{\\mathbf{r}}$、$\\hat{\\mathbf{a}}$ 和 $\\hat{\\mathbf{s}}$ 如何与 $\\hat{\\mathbf{x}}_{w}$、$\\hat{\\mathbf{y}}_{w}$ 和 $\\hat{\\mathbf{z}}_{w}$ 对齐。\n- 在世界坐标系中构建显式的旋转矩阵 $R_{\\text{supine}}$ 和 $R_{\\text{prone}}$，以实现这些转换，这些转换是分别绕 $\\hat{\\mathbf{r}}$ 轴旋转角度 $\\theta_{\\text{supine}}$ 和 $\\theta_{\\text{prone}}$ 的旋转。\n- 计算将仰卧位朝向映射到俯卧位朝向的净旋转 $R_{\\text{net}}=R_{\\text{prone}}\\,R_{\\text{supine}}^{-1}$。\n- 从 $R_{\\text{net}}$ 计算其迹 $\\operatorname{tr}(R_{\\text{net}})$。\n\n你的最终答案必须是等于 $\\operatorname{tr}(R_{\\text{net}})$ 的单个实数值。无需四舍五入。在最终方框答案中不要标明单位。", "solution": "首先验证问题以确保其自洽、有科学依据且提法明确。\n\n### 第1步：提取已知条件\n- 患者坐标系：右-前-上 (RAS)，具有标准正交基向量 $\\hat{\\mathbf{r}}$、$\\hat{\\mathbf{a}}$、$\\hat{\\mathbf{s}}$。这是一个右手坐标系，因此 $\\hat{\\mathbf{r}} \\times \\hat{\\mathbf{a}} = \\hat{\\mathbf{s}}$。\n- 世界坐标系：固定的实验室坐标系，具有标准正交基向量 $\\hat{\\mathbf{x}}_{w}$ (东)、$\\hat{\\mathbf{y}}_{w}$ (北) 和 $\\hat{\\mathbf{z}}_{w}$ (上)。这是一个右手坐标系，$\\hat{\\mathbf{x}}_{w} \\times \\hat{\\mathbf{y}}_{w} = \\hat{\\mathbf{z}}_{w}$。\n- 解剖位置：患者坐标系与世界坐标系对齐：$\\hat{\\mathbf{r}}=\\hat{\\mathbf{x}}_{w}$、$\\hat{\\mathbf{a}}=\\hat{\\mathbf{y}}_{w}$、$\\hat{\\mathbf{s}}=\\hat{\\mathbf{z}}_{w}$。\n- 临床仰卧位：患者仰卧，面部朝上。\n- 临床俯卧位：患者俯卧，面部朝下。\n- 转换是围绕患者右轴 $\\hat{\\mathbf{r}}$ 的刚体旋转 $R \\in SO(3)$。\n- 使用右手定则确定旋转方向。角度以弧度为单位。\n\n### 第2步：使用提取的已知条件进行验证\n该问题是良定的。它使用了医学影像学的标准术语（RAS、仰卧、俯卧）以及线性代数和运动学的既定原理（旋转矩阵、$SO(3)$、坐标系）。仰卧位和俯卧位的物理描述，结合旋转发生于患者 $\\hat{\\mathbf{r}}$ 轴的约束条件，允许明确的数学解释。该问题在科学上是合理的、客观的，并包含足够的信息来推导出唯一解。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n\n设世界坐标系的基向量由 $\\mathbb{R}^3$ 中的标准基表示：$\\hat{\\mathbf{x}}_{w} = (1, 0, 0)^T$、$\\hat{\\mathbf{y}}_{w} = (0, 1, 0)^T$ 和 $\\hat{\\mathbf{z}}_{w} = (0, 0, 1)^T$。\n\n在标准解剖位置下，患者的RAS基向量与世界坐标系对齐：\n$\\hat{\\mathbf{r}}_{\\text{anat}} = \\hat{\\mathbf{x}}_{w} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}$\n$\\hat{\\mathbf{a}}_{\\text{anat}} = \\hat{\\mathbf{y}}_{w} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}$\n$\\hat{\\mathbf{s}}_{\\text{anat}} = \\hat{\\mathbf{z}}_{w} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$\n\n向仰卧位和俯卧位的转换是从该解剖位置围绕患者的右轴 $\\hat{\\mathbf{r}}$ 进行的旋转。在解剖位置，该轴为 $\\hat{\\mathbf{r}}_{\\text{anat}} = \\hat{\\mathbf{x}}_{w}$。绕 $\\hat{\\mathbf{x}}_{w}$ 轴旋转角度 $\\theta$ 的旋转由以下矩阵给出：\n$$R_x(\\theta) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\theta  -\\sin\\theta \\\\ 0  \\sin\\theta  \\cos\\theta \\end{pmatrix}$$\n该矩阵作用于初始（解剖）基向量，以产生旋转后位置的新基向量。\n\n**1. 确定朝向和旋转矩阵**\n\n**仰卧位：**\n患者“仰卧，面部朝上”。在解剖位置，前方（$\\hat{\\mathbf{a}}_{\\text{anat}}$）是北方（$\\hat{\\mathbf{y}}_{w}$），上方（$\\hat{\\mathbf{s}}_{\\text{anat}}$）是向上（$\\hat{\\mathbf{z}}_{w}$）。为了通过绕东西向（$\\hat{\\mathbf{r}}$）轴旋转变为仰卧位，患者向后倾斜。前方（“面部”）从北方旋转至向上。\n因此，新的前向向量 $\\hat{\\mathbf{a}}_{\\text{sup}}$ 必须与世界坐标系的“上”向量 $\\hat{\\mathbf{z}}_{w}$ 对齐。\n设旋转为 $R_{\\text{supine}} = R_x(\\theta_{\\text{supine}})$。新的前向向量由 $\\hat{\\mathbf{a}}_{\\text{sup}} = R_{\\text{supine}}\\hat{\\mathbf{a}}_{\\text{anat}}$ 给出。\n$$\\hat{\\mathbf{a}}_{\\text{sup}} = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos\\theta_{\\text{supine}}  -\\sin\\theta_{\\text{supine}} \\\\ 0  \\sin\\theta_{\\text{supine}}  \\cos\\theta_{\\text{supine}} \\end{pmatrix} \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\cos\\theta_{\\text{supine}} \\\\ \\sin\\theta_{\\text{supine}} \\end{pmatrix}$$\n我们要求 $\\hat{\\mathbf{a}}_{\\text{sup}} = \\hat{\\mathbf{z}}_{w} = (0, 0, 1)^T$。这意味着 $\\cos\\theta_{\\text{supine}} = 0$ 和 $\\sin\\theta_{\\text{supine}} = 1$。主角是 $\\theta_{\\text{supine}} = \\frac{\\pi}{2}$ 弧度。这对应于绕 $\\hat{\\mathbf{x}}_{w}$ 轴逆时针旋转 $90^\\circ$。\n\n仰卧位转换的旋转矩阵是：\n$$R_{\\text{supine}} = R_x\\left(\\frac{\\pi}{2}\\right) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos(\\frac{\\pi}{2})  -\\sin(\\frac{\\pi}{2}) \\\\ 0  \\sin(\\frac{\\pi}{2})  \\cos(\\frac{\\pi}{2}) \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  0  -1 \\\\ 0  1  0 \\end{pmatrix}$$\n仰卧位下的RAS向量是：\n- $\\hat{\\mathbf{r}}_{\\text{sup}} = R_{\\text{supine}}\\hat{\\mathbf{r}}_{\\text{anat}} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\hat{\\mathbf{x}}_{w}$\n- $\\hat{\\mathbf{a}}_{\\text{sup}} = R_{\\text{supine}}\\hat{\\mathbf{a}}_{\\text{anat}} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\hat{\\mathbf{z}}_{w}$\n- $\\hat{\\mathbf{s}}_{\\text{sup}} = R_{\\text{supine}}\\hat{\\mathbf{s}}_{\\text{anat}} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\end{pmatrix} = -\\hat{\\mathbf{y}}_{w}$\n\n_从解剖位置到仰卧位的对齐_：$\\hat{\\mathbf{r}}$ 不变，$\\hat{\\mathbf{a}}$ 从 $\\hat{\\mathbf{y}}_{w}$ 映射到 $\\hat{\\mathbf{z}}_{w}$，$\\hat{\\mathbf{s}}$ 从 $\\hat{\\mathbf{z}}_{w}$ 映射到 $-\\hat{\\mathbf{y}}_{w}$。\n\n**俯卧位：**\n患者“俯卧，面部朝下”。前方（“腹部”或“面部”）现在指向下方。世界坐标系的“下”方向是 $-\\hat{\\mathbf{z}}_{w}$。\n新的前向向量 $\\hat{\\mathbf{a}}_{\\text{pro}}$ 必须与 $-\\hat{\\mathbf{z}}_{w}$ 对齐。\n设旋转为 $R_{\\text{prone}} = R_x(\\theta_{\\text{prone}})$。\n$$\\hat{\\mathbf{a}}_{\\text{pro}} = R_x(\\theta_{\\text{prone}})\\hat{\\mathbf{a}}_{\\text{anat}} = \\begin{pmatrix} 0 \\\\ \\cos\\theta_{\\text{prone}} \\\\ \\sin\\theta_{\\text{prone}} \\end{pmatrix}$$\n我们要求 $\\hat{\\mathbf{a}}_{\\text{pro}} = -\\hat{\\mathbf{z}}_{w} = (0, 0, -1)^T$。这意味着 $\\cos\\theta_{\\text{prone}} = 0$ 和 $\\sin\\theta_{\\text{prone}} = -1$。主角是 $\\theta_{\\text{prone}} = -\\frac{\\pi}{2}$ 弧度。这对应于绕 $\\hat{\\mathbf{x}}_{w}$ 轴顺时针旋转 $90^\\circ$。\n\n俯卧位转换的旋转矩阵是：\n$$R_{\\text{prone}} = R_x\\left(-\\frac{\\pi}{2}\\right) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\cos(-\\frac{\\pi}{2})  -\\sin(-\\frac{\\pi}{2}) \\\\ 0  \\sin(-\\frac{\\pi}{2})  \\cos(-\\frac{\\pi}{2}) \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\\\ 0  -1  0 \\end{pmatrix}$$\n俯卧位下的RAS向量是：\n- $\\hat{\\mathbf{r}}_{\\text{pro}} = R_{\\text{prone}}\\hat{\\mathbf{r}}_{\\text{anat}} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\hat{\\mathbf{x}}_{w}$\n- $\\hat{\\mathbf{a}}_{\\text{pro}} = R_{\\text{prone}}\\hat{\\mathbf{a}}_{\\text{anat}} = \\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix} = -\\hat{\\mathbf{z}}_{w}$\n- $\\hat{\\mathbf{s}}_{\\text{pro}} = R_{\\text{prone}}\\hat{\\mathbf{s}}_{\\text{anat}} = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\hat{\\mathbf{y}}_{w}$\n\n_从解剖位置到俯卧位的对齐_：$\\hat{\\mathbf{r}}$ 不变，$\\hat{\\mathbf{a}}$ 从 $\\hat{\\mathbf{y}}_{w}$ 映射到 $-\\hat{\\mathbf{z}}_{w}$，$\\hat{\\mathbf{s}}$ 从 $\\hat{\\mathbf{z}}_{w}$ 映射到 $\\hat{\\mathbf{y}}_{w}$。\n\n**2. 计算净旋转**\n\n将仰卧位朝向映射到俯卧位朝向的净旋转 $R_{\\text{net}}$ 将仰卧位基变换为俯卧位基。如果 $M_{\\text{sup}}$ 和 $M_{\\text{pro}}$ 是以基向量为列的矩阵，我们有 $M_{\\text{sup}} = R_{\\text{supine}}$ 和 $M_{\\text{pro}} = R_{\\text{prone}}$ (因为解剖基是单位矩阵)。变换由 $M_{\\text{pro}} = R_{\\text{net}} M_{\\text{sup}}$ 给出。\n$$R_{\\text{prone}} = R_{\\text{net}} R_{\\text{supine}}$$\n求解 $R_{\\text{net}}$ 可得 $R_{\\text{net}} = R_{\\text{prone}} R_{\\text{supine}}^{-1}$。\n对于旋转矩阵 $R \\in SO(3)$，其逆等于其转置，$R^{-1} = R^T$。\n$$R_{\\text{supine}}^{-1} = R_{\\text{supine}}^T = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\\\ 0  -1  0 \\end{pmatrix}$$\n现在，我们计算乘积：\n$$R_{\\text{net}} = R_{\\text{prone}} R_{\\text{supine}}^{-1} = \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\\\ 0  -1  0 \\end{pmatrix} \\begin{pmatrix} 1  0  0 \\\\ 0  0  1 \\\\ 0  -1  0 \\end{pmatrix}$$\n$$R_{\\text{net}} = \\begin{pmatrix} 1(1)+0(0)+0(0)   1(0)+0(0)+0(-1)   1(0)+0(1)+0(0) \\\\ 0(1)+0(0)+1(0)   0(0)+0(0)+1(-1)   0(0)+0(1)+1(0) \\\\ 0(1)+(-1)(0)+0(0)   0(0)+(-1)(0)+0(-1)   0(0)+(-1)(1)+0(0) \\end{pmatrix}$$\n$$R_{\\text{net}} = \\begin{pmatrix} 1   0   0 \\\\ 0   -1   0 \\\\ 0   0   -1 \\end{pmatrix}$$\n得到的这个矩阵对应于绕 $\\hat{\\mathbf{x}}_{w}$ 轴旋转角度 $\\pi$ 弧度 ($180^\\circ$) 的旋转，这是从仰卧位（向后倾斜 $\\pi/2$）到俯卧位（向前倾斜 $\\pi/2$）的旋转。总旋转角是 $(-\\pi/2) - (\\pi/2) = -\\pi$ 绕 $\\hat{\\mathbf{r}}$ 轴。\n$R_x(-\\pi) = \\begin{pmatrix} 1   0   0 \\\\ 0   \\cos(-\\pi)   -\\sin(-\\pi) \\\\ 0   \\sin(-\\pi)   \\cos(-\\pi) \\end{pmatrix} = \\begin{pmatrix} 1   0   0 \\\\ 0   -1   0 \\\\ 0   0   -1 \\end{pmatrix}$，与我们的结果相符。\n\n**3. 计算迹**\n\n方阵的迹是其主对角线上元素的和。\n$$\\operatorname{tr}(R_{\\text{net}}) = \\operatorname{tr}\\begin{pmatrix} 1   0   0 \\\\ 0   -1   0 \\\\ 0   0   -1 \\end{pmatrix} = 1 + (-1) + (-1)$$\n$$\\operatorname{tr}(R_{\\text{net}}) = 1 - 1 - 1 = -1$$\n绕某个轴旋转角度 $\\alpha$ 的三维旋转的迹由 $1 + 2\\cos\\alpha$ 给出。对于 $\\alpha = -\\pi$，迹是 $1 + 2\\cos(-\\pi) = 1 + 2(-1) = -1$，这证实了计算结果。", "answer": "$$\\boxed{-1}$$", "id": "4969460"}, {"introduction": "我们将静态和全局的概念扩展到动态运动分析中。这项实践 [@problem_id:4969424] 深入探讨了一个现代生物力学的应用：利用可穿戴传感器数据来量化和分类复杂的关节运动，如踝内翻和膝内翻。它展示了解剖方位和矢量代数的原理如何被用于在临床和研究环境中分析人体运动。", "problem": "您将获得从佩戴在受试者右大腿、右小腿和右足上的可穿戴惯性测量单元（IMU）获得的三维方向信息，这些单元被刚性地固定在身体上。请使用解剖方向和矢量代数的核心定义，推导并实现一套标准，仅基于在全局坐标系中测量的单位方向矢量，来区分踝内翻或外翻与膝内翻或外翻。\n\n基础。使用以下解剖学和数学定义作为您推导的起点。解剖平面和轴：全局坐标系为右手坐标系，前后轴沿 $+\\hat{\\mathbf{x}}$（前），左右轴沿 $+\\hat{\\mathbf{y}}$（受试者的左侧，对于右侧肢体是内侧），上下轴沿 $+\\hat{\\mathbf{z}}$（上）。额状面是由 $\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$ 构成的平面，与 $\\hat{\\mathbf{x}}$ 正交。踝内翻对应于足底面（法向量）向内侧方向倾斜（对于右侧肢体，朝向 $+\\hat{\\mathbf{y}}$）；踝外翻对应于向外侧方向傾斜（对于右侧肢体，朝向 $-\\hat{\\mathbf{y}}$）。膝内翻对应于在额状面内，小腿远端相对于大腿近端向内侧偏离（对于右侧肢体，朝向 $+\\hat{\\mathbf{y}}$）；膝外翻对应于向外侧偏离（对于右侧肢体，朝向 $-\\hat{\\mathbf{y}}$）。矢量代数：矢量 $\\mathbf{v}$ 在单位法向量为 $\\hat{\\mathbf{n}}$ 的平面上的投影是 $\\mathbf{v}_{\\perp} = \\mathbf{v} - (\\mathbf{v} \\cdot \\hat{\\mathbf{n}})\\hat{\\mathbf{n}}$。两个非零矢量 $\\mathbf{a}$ 和 $\\mathbf{b}$ 之间的夹角 $\\theta$ 满足 $\\cos\\theta = \\dfrac{\\mathbf{a}\\cdot\\mathbf{b}}{\\|\\mathbf{a}\\|\\|\\mathbf{b}\\|}$，并且在一个已知平面内的带符号角可以通过该平面的法向量使用标量三重积来定向。\n\n任务。在一个程序中推导并实现以下计算：\n\n1) 踝内翻或外翻角。设 $\\hat{\\mathbf{p}}$ 为全局坐标系中足底面的单位法向量。首先将 $\\hat{\\mathbf{p}}$ 投影到额状面（法向量为 $+\\hat{\\mathbf{x}}$），然后计算一个围绕 $+\\hat{\\mathbf{x}}$ 的带符号角，当 $\\hat{\\mathbf{p}}$ 向 $+\\hat{\\mathbf{y}}$ 倾斜时（右侧肢体为内翻），该角为正；当它向 $-\\hat{\\mathbf{y}}$ 倾斜时（外翻），该角为负，从而计算出 $\\hat{\\mathbf{p}}$ 相对于 $+\\hat{\\mathbf{z}}$ 的带符号额状面倾斜角。此角度以度为单位表示。\n\n2) 膝内翻或外翻角。设 $\\hat{\\mathbf{z}}_{\\text{thigh}}$ 和 $\\hat{\\mathbf{z}}_{\\text{shank}}$ 分别为全局坐标系中表示大腿和小腿上方向（长轴）的单位矢量。通过将两个矢量都投影到额状面（法向量为 $+\\hat{\\mathbf{x}}$），然后确定围绕 $+\\hat{\\mathbf{x}}$ 的从 $\\hat{\\mathbf{z}}_{\\text{thigh}}$ 到 $\\hat{\\mathbf{z}}_{\\text{shank}}$ 的带符号角。当小腿向 $+\\hat{\\mathbf{y}}$ 偏离时（右侧肢体为内翻），符号为正；当它向 $-\\hat{\\mathbf{y}}$ 偏离时（右侧肢体为外翻），符号为负。此角度以度为单位表示。\n\n3) 使用阈值进行分类。使用一个以度为单位的额状面角度阈值 $\\tau$，将每个带符号角 $\\theta$ 分类如下：如果 $|\\theta|  \\tau$，则类别为中性，编码为 $0$；否则，类别由符号决定，踝内翻或膝内翻编码为 $+1$，踝外翻或膝外翻编码为 $-1$。使用 $\\tau=2.0$ 度。角度必须四舍五入到三位小数。\n\n输入和测试套件。您的程序必须硬编码并使用以下四个测试用例，每个用例包含全局坐标系中的三个单位矢量：足底法向量 $\\hat{\\mathbf{p}}$、大腿长轴 $\\hat{\\mathbf{z}}_{\\text{thigh}}$ 和小腿长轴 $\\hat{\\mathbf{z}}_{\\text{shank}}$。这些用例的构建旨在覆盖一个典型情况、相反的运动、一个仅矢状面运动（边缘情况）以及一个处于分类阈值的边界情况。所有矢量都以笛卡尔三元组 $(x,y,z)$ 的形式给出。\n\n- 案例 $1$（踝内翻和膝内翻，均在额状面内）：\n  $\\hat{\\mathbf{p}} = (\\,0.0\\,,\\,0.1736481777\\,,\\,0.9848077530\\,)$，$\\hat{\\mathbf{z}}_{\\text{thigh}} = (\\,0.0\\,,\\,0.0\\,,\\,1.0\\,)$，$\\hat{\\mathbf{z}}_{\\text{shank}} = (\\,0.0\\,,\\,0.0871557427\\,,\\,0.9961946981\\,)$。\n\n- 案例 $2$（踝外翻和膝外翻，均在额状面内）：\n  $\\hat{\\mathbf{p}} = (\\,0.0\\,,\\,-0.2079116908\\,,\\,0.9781476007\\,)$，$\\hat{\\mathbf{z}}_{\\text{thigh}} = (\\,0.0\\,,\\,0.0\\,,\\,1.0\\,)$，$\\hat{\\mathbf{z}}_{\\text{shank}} = (\\,0.0\\,,\\,-0.1218693434\\,,\\,0.9925461516\\,)$。\n\n- 案例 $3$（仅矢状面膝关节屈曲和踝关节背屈；两者在额状面均为中性）：\n  $\\hat{\\mathbf{p}} = (\\,-0.2588190451\\,,\\,0.0\\,,\\,0.9659258263\\,)$，$\\hat{\\mathbf{z}}_{\\text{thigh}} = (\\,0.0\\,,\\,0.0\\,,\\,1.0\\,)$，$\\hat{\\mathbf{z}}_{\\text{shank}} = (\\,0.5\\,,\\,0.0\\,,\\,0.8660254038\\,)$。\n\n- 案例 $4$（踝关节和膝关节均在额状面内处于阈值 $\\tau=2.0$ 度的边界情况）：\n  $\\hat{\\mathbf{p}} = (\\,0.0\\,,\\,0.0348994967\\,,\\,0.9993908270\\,)$，$\\hat{\\mathbf{z}}_{\\text{thigh}} = (\\,0.0\\,,\\,0.0\\,,\\,1.0\\,)$，$\\hat{\\mathbf{z}}_{\\text{shank}} = (\\,0.0\\,,\\,0.0348994967\\,,\\,0.9993908270\\,)$。\n\n角度单位和四舍五入。所有角度内部必须以弧度计算，但以度表示，并四舍五入到三位小数。分类阈值 $\\tau$ 以度为单位，分类规则使用严格不等式 $|\\theta|  \\tau$ 来判断中性；与 $\\tau$ 相等不属于中性。\n\n要求的最终输出格式。对于每个测试用例，输出一个包含四个条目的列表：踝关节分类代码（整数）、膝关节分类代码（整数）、带符号的踝关节角度（以度为单位，浮点数，四舍五入到三位小数）和带符号的膝关节角度（以度为单位，浮点数，四舍五入到三位小数）。将每个用例的列表聚合到一个单一列表中，并以以下格式精确打印一行：\n[case1_list,case2_list,case3_list,case4_list]\n例如，一个有效的行看起来像 [ [a,b,c,d], [e,f,g,h], ... ]，但没有任何附加文本。您的程序应该生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个用例列表包含四个逗号分隔的值。", "solution": "问题陈述被评估为**有效**。它在科学上基于生物力学和矢量代数的原理，问题设定良好，包含所有必要的定义和数据，并以客观、正式的语言表述。其中没有矛盾、歧义或不合理的假设。\n\n问题的核心是根据方向矢量计算两个具有临床意义的角度——踝内翻/外翻角和膝内翻/外翻角，然后对这些运动进行分类。这需要系统地应用矢量数学。推导过程如下。\n\n首先，我们建立一个数学框架来计算指定平面内的带符号角。问题将所有额状面计算定义为相对于全局额状面，即由 $\\hat{\\mathbf{y}}$ 和 $\\hat{\\mathbf{z}}$ 轴张成的平面。该平面的单位法向量是 $\\hat{\\mathbf{n}} = \\hat{\\mathbf{x}} = (1, 0, 0)$。\n\n一个矢量 $\\mathbf{v} = (v_x, v_y, v_z)$ 使用公式 $\\mathbf{v}_{\\perp} = \\mathbf{v} - (\\mathbf{v} \\cdot \\hat{\\mathbf{n}})\\hat{\\mathbf{n}}$ 投影到额状面上。当 $\\hat{\\mathbf{n}} = \\hat{\\mathbf{x}}$ 时，公式变为：\n$$ \\mathbf{v}_{\\perp} = (v_x, v_y, v_z) - ((v_x, v_y, v_z) \\cdot (1, 0, 0)) (1, 0, 0) $$\n$$ \\mathbf{v}_{\\perp} = (v_x, v_y, v_z) - v_x (1, 0, 0) = (0, v_y, v_z) $$\n这证实了任何矢量在全局额状面上的投影是一个新矢量，其分量就是原始矢量的 $y$ 和 $z$ 分量。\n\n这样一个投影矢量 $(0, v_y, v_z)$ 在 $y-z$ 平面内的带符号角是从正 $\\hat{\\mathbf{z}}$ 轴开始测量的，正角表示朝正 $\\hat{\\mathbf{y}}$ 轴的旋转。这个角度 $\\phi$ 可以使用双参数反正切函数 $\\text{atan2}$ 来计算。在一个坐标系中，如果第一个参数是“类y”坐标，第二个参数是“类x”坐标，则函数为 $\\text{atan2}(y, x)$。对于我们的 $y-z$ 平面，角度从 $z$ 轴测量，这对应于 $\\phi = \\text{atan2}(v_y, v_z)$。该函数能正确处理所有象限，并提供一个弧度值，通常在 $(-\\pi, \\pi]$ 范围内。\n\n**1. 踝内翻/外翻角 ($\\theta_{\\text{ankle}}$)**\n\n踝关节角定义为足底面法向量 $\\hat{\\mathbf{p}}$ 相对于全局上方向 $+\\hat{\\mathbf{z}}$ 的带符号额状面倾斜角。\n\n设足底法向量为 $\\hat{\\mathbf{p}} = (p_x, p_y, p_z)$。它在额状面上的投影产生一个在 $y-z$ 平面上分量为 $(p_y, p_z)$ 的矢量。参考方向是 $\\hat{\\mathbf{z}} = (0,0,1)$，它完全位于额状面内，分量为 $(0, 1)$。\n\n参考矢量 $\\hat{\\mathbf{z}}$ 的角度是 $\\alpha_{\\text{ref}} = \\text{atan2}(0, 1) = 0$。\n投影后的足部矢量的角度是 $\\alpha_{\\text{foot}} = \\text{atan2}(p_y, p_z)$。\n\n踝关节角是足部矢量相对于参考矢量的角度，即 $\\alpha_{\\text{foot}}$。\n$$ \\theta_{\\text{ankle}} = \\text{atan2}(p_y, p_z) $$\n如果 $p_y > 0$（向 $+\\hat{\\mathbf{y}}$，即内侧倾斜），此角为正，对应于内翻；如果 $p_y  0$（向 $-\\hat{\\mathbf{y}}$，即外侧倾斜），此角为负，对应于外翻。这与问题的符号约定相符。\n\n**2. 膝内翻/外翻角 ($\\theta_{\\text{knee}}$)**\n\n膝关节角是从大腿长轴 $\\hat{\\mathbf{z}}_{\\text{thigh}}$ 到小腿长轴 $\\hat{\\mathbf{z}}_{\\text{shank}}$ 的带符号额状面角。\n\n设大腿矢量为 $\\hat{\\mathbf{z}}_{\\text{thigh}} = (z_{tx}, z_{ty}, z_{tz})$，小腿矢量为 $\\hat{\\mathbf{z}}_{\\text{shank}} = (z_{sx}, z_{sy}, z_{sz})$。我们将两者都投影到额状面，分别得到 $y-z$ 分量为 $(z_{ty}, z_{tz})$ 和 $(z_{sy}, z_{sz})$ 的矢量。\n\n投影后的大腿矢量相对于全局 $\\hat{\\mathbf{z}}$ 轴的角度是：\n$$ \\alpha_{\\text{thigh}} = \\text{atan2}(z_{ty}, z_{tz}) $$\n投影后的小腿矢量相对于全局 $\\hat{\\mathbf{z}}$ 轴的角度是：\n$$ \\alpha_{\\text{shank}} = \\text{atan2}(z_{sy}, z_{sz}) $$\n膝关节角是从大腿矢量到小腿矢量的角度，计算为它们各自角度的差值：\n$$ \\theta_{\\text{knee}} = \\alpha_{\\text{shank}} - \\alpha_{\\text{thigh}} $$\n结果必须归一化到区间 $(-\\pi, \\pi]$ 内，以处理角度跨越 $\\pm\\pi$ 边界的情况，尽管对于典型的生物力学数据来说这种情况不常见。这种归一化的公式是 $\\theta_{\\text{wrapped}} = (\\theta + \\pi) \\pmod{2\\pi} - \\pi$。\n符号约定为内翻（小腿向内侧，即 $+\\hat{\\mathbf{y}}$ 方向偏离）时为正，外翻（小腿向外侧，即 $-\\hat{\\mathbf{y}}$ 方向偏离）时为负，此公式能正确产生该结果。对于完全垂直的大腿，$\\alpha_{\\text{thigh}} = 0$，膝关节角仅由小腿的方向决定。\n\n**3. 分类**\n\n每个角度 $\\theta$（以度为单位）的分类基于一个阈值 $\\tau = 2.0$ 度。规则规定如下：\n- 如果 $|\\theta|  \\tau$，则类别为中性，编码为 $0$。\n- 如果 $\\theta \\ge \\tau$，则类别为内翻/膝内翻，编码为 $+1$。\n- 如果 $\\theta \\le -\\tau$，则类别为外翻/膝外翻，编码为 $-1$。\n此逻辑正确处理了 $|\\theta| = \\tau$ 的边界情况，将其分类为非中性。\n\n所有角度均以弧度计算，然后通过乘以 $\\frac{180}{\\pi}$ 转换为度，最后四舍五入到三位小数以供输出。推导出的公式按要求直接在 Python 程序中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the biomechanical orientation problem for a given set of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Ankle inversion and knee varus\n        {\n            \"p_vec\": (0.0, 0.1736481777, 0.9848077530),\n            \"z_thigh\": (0.0, 0.0, 1.0),\n            \"z_shank\": (0.0, 0.0871557427, 0.9961946981),\n        },\n        # Case 2: Ankle eversion and knee valgus\n        {\n            \"p_vec\": (0.0, -0.2079116908, 0.9781476007),\n            \"z_thigh\": (0.0, 0.0, 1.0),\n            \"z_shank\": (0.0, -0.1218693434, 0.9925461516),\n        },\n        # Case 3: Sagittal-plane motion only\n        {\n            \"p_vec\": (-0.2588190451, 0.0, 0.9659258263),\n            \"z_thigh\": (0.0, 0.0, 1.0),\n            \"z_shank\": (0.5, 0.0, 0.8660254038),\n        },\n        # Case 4: Boundary case at the threshold\n        {\n            \"p_vec\": (0.0, 0.0348994967, 0.9993908270),\n            \"z_thigh\": (0.0, 0.0, 1.0),\n            \"z_shank\": (0.0, 0.0348994967, 0.9993908270),\n        },\n    ]\n\n    # Classification threshold in degrees\n    tau = 2.0\n\n    def classify_angle(angle_deg, threshold):\n        \"\"\"Classifies an angle based on the given threshold.\"\"\"\n        if abs(angle_deg)  threshold:\n            return 0\n        elif angle_deg >= threshold:\n            return 1\n        else:  # angle_deg = -threshold\n            return -1\n\n    results = []\n    for case in test_cases:\n        p_vec = case[\"p_vec\"]\n        z_thigh = case[\"z_thigh\"]\n        z_shank = case[\"z_shank\"]\n\n        # 1. Ankle Inversion/Eversion Angle\n        # The projection onto the frontal plane (normal x-axis) means we only\n        # consider the y and z components. The angle is from the z-axis to the\n        # projected vector in the y-z plane.\n        # atan2(y, z) gives the angle from the positive z-axis towards the positive y-axis.\n        ankle_angle_rad = np.arctan2(p_vec[1], p_vec[2])\n        ankle_angle_deg = np.degrees(ankle_angle_rad)\n\n        # 2. Knee Varus/Valgus Angle\n        # This is the signed angle from the projected thigh vector to the projected\n        # shank vector in the frontal plane.\n        thigh_angle_rad = np.arctan2(z_thigh[1], z_thigh[2])\n        shank_angle_rad = np.arctan2(z_shank[1], z_shank[2])\n        \n        knee_angle_rad = shank_angle_rad - thigh_angle_rad\n        # Normalize the angle to the range (-pi, pi] in case of wrapping around\n        knee_angle_rad = (knee_angle_rad + np.pi) % (2 * np.pi) - np.pi\n        knee_angle_deg = np.degrees(knee_angle_rad)\n\n        # 3. Classification\n        ankle_class = classify_angle(ankle_angle_deg, tau)\n        knee_class = classify_angle(knee_angle_deg, tau)\n\n        # Round angles to three decimal places for output\n        rounded_ankle_angle = round(ankle_angle_deg, 3)\n        rounded_knee_angle = round(knee_angle_deg, 3)\n\n        results.append([\n            ankle_class,\n            knee_class,\n            rounded_ankle_angle,\n            rounded_knee_angle\n        ])\n\n    # Final print statement in the exact required format.\n    # The string representation of a list of lists is desired.\n    # Using map(str,...) and join generates a string representation.\n    print(f\"[{','.join(map(str, results))}]\".replace(\" \", \"\"))\n\nsolve()\n```", "id": "4969424"}]}