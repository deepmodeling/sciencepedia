{"hands_on_practices": [{"introduction": "在医疗法律实践中，从业者的良心拒绝对病人的影响是核心关切之一。本练习探讨一个关键问题：当病人获得治疗的机会稍纵即逝时，医疗服务提供者的良心自由与不伤害病人的基本护理责任之间应如何平衡？通过分析这个时间紧迫的场景，您将学会如何在具体案件中界定良心拒绝权的合理边界。[@problem_id:4476758]", "problem": "一个农村司法管辖区承认医疗服务提供者享有有限的良心拒服权：提供者可以基于良心理由拒绝参与合法的医疗服务，但他们仍负有不造成可预见伤害的一般注意义务，并且不得阻碍患者及时获得合法的医疗服务。在该司法管辖区，当地唯一备有的紧急避孕药是左炔诺孕酮紧急避孕药（EC），其获准在无保护性交后$72$小时内使用，超过$72$小时后药效会显著降低。药剂师P有反对EC的书面良心拒服记录。一天晚上，患者R在无保护性交后$68$小时前来要求购买EC。P拒绝配发EC，并拒绝提供关于替代来源的信息或联系任何值班服务，声称R可以在早上尝试去另一家药店。下一家药店要再过$10$小时才开门。R直到性交后$81$小时才得以获得EC；她后来怀孕并对P提起过失诉讼。假设交通选择有限，P知道或理应知道时间以及当地的服务可用性，并且如果P采取了合理的措施避免延误，EC更有可能在$72$小时窗口期内被获得并服用。\n\n在这一时间敏感、机会稍纵即逝的情况下，哪项陈述最能反映良心拒服权的合法范围以及可能的责任分析？\n\nA. 良心拒服权的范围是绝对的；提供者没有告知、转介或考虑时间敏感性的义务，无论后果如何，都不能因拒绝参与而承担过失责任。\n\nB. 良心拒服权受到不阻碍和合理协助义务的限制；P至少必须立即披露其反对意见，提供准确、及时的信息和有效的转介或其他合理措施，以保障R获取有时限服务的权利，并且，如果不存在及时的替代方案且延误可能导致重大伤害或丧失合法权益，则应采取合理步骤，其中可能包括不顾反对意见配发药物；如果案件事实能够证明存在义务、违反义务、因果关系和损害，则该不作为可构成过失。\n\nC. 因为该服务具有时间敏感性，患者自主权总是优先于良心；在所有此类情况下，即使有及时的替代方案，法律也要求P配发EC，良心拒服权在紧急或急迫的医疗服务中没有地位。\n\nD. 良心拒服者的义务仅由患者明确的紧急声明触发；如果R没有明确说明$72$小时的窗口期即将关闭，P可以默然拒绝，没有任何告知或转介的义务，并且不能被追究责任。\n\nE. 责任完全取决于雇主政策；如果药店允许良心拒服而不要求转介，即使R失去了获得合法医疗服务的稍纵即逝的机会，P也不能在过失诉讼中承担责任。", "solution": "分析始于医疗法中关于注意义务和良心拒服权的基本法律原则。过失的核心要素是义务、违反义务、因果关系和损害。医疗服务提供者有义务以处于类似情况下的合理专业人士的谨慎和技能行事，并避免造成可预见的伤害。良心拒服权在得到承认的情况下，是一种有限的自由利益，必须与患者获得合法医疗服务的权利相平衡。广为接受的限制包括：及时披露反对意见、避免阻碍、提供及时有效的信息和转介，以及在紧急情况下或延误会造成重大伤害或丧失合法权益风险时，采取合理措施防止该伤害，如果不存在及时的替代途径，这可能包括提供该服务。这些限制基于相称性原则（平衡相互竞争的权利）、不伤害原则（do no harm）以及对患者自主权和获得服务的尊重。\n\n将这些原则应用于时间敏感、稍纵即逝的机会，例如获准在性交后$72$小时内使用的左炔诺孕酮紧急避孕药（EC），有效治疗的窗口是稍纵即逝的：延迟超过$72$小时会显著降低药效。如果提供者知道或应该知道，拒绝提供服务且不协助患者及时获得替代服务，将可预见地导致患者错过有效窗口期，那么提供者的注意义务要求其采取合理措施以避免该损失。这些措施至少包括立即披露反对意见、提供关于时间限制和替代方案的准确信息，以及进行有效转介或协调以确保患者能及时获得服务。在没有及时替代方案且延误可能导致重大伤害或丧失合法权益的情况下，该义务可能延伸至不顾反对意见而提供服务，因为当患者的损失在其他情况下不可避免时，相称性演算的平衡点会发生变化。\n\n因果关系根据“若无”测试及相关理论进行评估：若无提供者的违约行为，损害是否会发生？在此场景中，P在$68$小时拒绝且未进行转介；下一家药店在$10$小时后才开门，这意味着若无干预，R将超过$72$小时的门槛。案情规定，如果P采取了合理的措施避免延误，EC更有可能在$72$小时内被获得并服用。因此，在这些假设下，因果关系成立。损害可以界定为非意愿怀孕本身，或者在某些司法管辖区，界定为机会的丧失或稍纵即逝的法律或医疗利益的丧失。因此，如果义务和违反义务的行为得以确立，则过失责任是可能的。\n\n逐项分析选项：\n\nA. 该选项主张反对权是绝对的，没有告知或转介的义务，且无论后果如何均无责任。这与限定良心拒服权的基本平衡原则和相称性原则相矛盾，也与避免可预见伤害的注意义务相悖。特别是在时间敏感的情况下，不阻碍和协助的义务是广为认可的。因此，此项不正确。\n\nB. 该选项抓住了良心拒服权的有限性质：提供者必须披露反对意见、不阻碍、并提供有效的转介和合理措施以保障有时限的服务获取；在没有及时的替代方案且延误可能导致重大伤害或丧失合法权益风险时，合理步骤可能包括不顾反对意见而提供服务。它还正确地将过失与案件事实中确立义务、违反义务、因果关系和损害联系起来。这与上述原则以及所呈现的情景相符。因此，此项正确。\n\nC. 该选项假定在所有时间敏感的情况下都有绝对的履行义务，即使有及时的替代方案。这夸大了对良心拒服权的限制；如果存在合理、及时的替代方案，且提供者履行了披露和协助的义务，法律通常不要求在每个紧急情况下都必须履行。履行的要求是视情况而定的，并且在没有及时替代方案且可合理预见会发生严重伤害时才被触发。因此，此项不正确。\n\nD. 该选项声称义务仅在患者明确声明紧急情况时才产生。注意义务是基于提供者知道或理应知道的情况。在此，P知道或理应知道时间（$68$小时）、$72$小时的许可窗口期以及当地可用性（下一家药店在$10$小时后开门）。义务并非仅仅取决于患者的明确声明；客观的可预见性就足够了。因此，此项不正确。\n\nE. 该选项指出责任完全取决于雇主政策。过失责任源于违反法定义务，而不仅仅是内部政策；虽然政策可能为注意义务的标准提供参考，但它们不能取代法律。宽容的雇主政策不能使提供者免于因违反导致可预见伤害（包括丧失获得合法医疗服务的稍纵即逝的机会）的法定义务而承担责任。因此，此项不正确。", "answer": "$$\\boxed{B}$$", "id": "4476758"}, {"introduction": "评估医疗服务提供者所声称的信仰是否真诚，是处理良心拒绝请求时的一个核心挑战。本练习引入了一种定量方法来应对这一挑战，它通过一个假设场景，展示了决策机构如何运用贝叶斯推理系统性地权衡多方证据。这项练习旨在揭示，诸如“清晰且有说服力的证据”等法律证明标准，可以如何被构建为一个结构化的分析框架。[@problem_id:4476774]", "problem": "一家医院的资格认证委员会必须评估一名医生因良心反对而拒绝参与某项法律允许的医疗程序的真实性。该司法管辖区的法律框架要求，当反对的真实性根据“清晰且有说服力的证据”（Clear and Convincing Evidence, CCE）标准得以确立时，必须予以通融。该标准通常操作化为约 $0.75$ 的概率阈值。供参考，“证据优势”（Preponderance of the Evidence, PoE）的阈值约为 $0.50$，“排除合理怀疑”（Beyond a Reasonable Doubt, BRD）的阈值约为 $0.90$。这些标准是原则性指针，而非计算规则。\n\n委员会采用基于概率论和证明责任核心原则的循证审查方法。医生的真实性用事件 $S$ 表示，其不真实性用 $\\neg S$ 表示。该机构过往良心反对案例的历史审计数据（经内部审查验证）得出一个中性的基线先验概率 $p_0 = \\Pr(S) = 0.58$。\n\n在当前案例中，委员会观察到四个独立的指标，每个指标在先前的研究中都已得到验证，具有以下条件概率：\n- 指标 $E_1$ (有记录的、与所声称的信念一致的长期实践): $\\Pr(E_1 \\mid S) = 0.82$, $\\Pr(E_1 \\mid \\neg S) = 0.31$。\n- 指标 $E_2$ (请求模式看似出于便利驱动): $\\Pr(E_2 \\mid S) = 0.40$, $\\Pr(E_2 \\mid \\neg S) = 0.65$。\n- 指标 $E_3$ (不同时间书面陈述的一致性): $\\Pr(E_3 \\mid S) = 0.90$, $\\Pr(E_3 \\mid \\neg S) = 0.50$。\n- 指标 $E_4$ (愿意接受不利的雇佣后果): $\\Pr(E_4 \\mid S) = 0.70$, $\\Pr(E_4 \\mid \\neg S) = 0.25$。\n\n假设 $E_1$、$E_2$、$E_3$ 和 $E_4$ 在给定 $S$ 和给定 $\\neg S$ 的条件下是条件独立的。仅使用概率论的基本规则和证据聚合方法，计算后验概率 $\\Pr(S \\mid E_1, E_2, E_3, E_4)$。\n\n将最终数值答案四舍五入至四位有效数字，并以不带单位的小数形式表示。", "solution": "任务是从先验概率 $\\Pr(S) = p_0$ 出发，整合条件独立的证据，以计算 $\\Pr(S \\mid E_1, E_2, E_3, E_4)$。基本依据如下：\n- 法律证明标准被解释为概率阈值（“证据优势”(PoE) $\\approx 0.50$，“清晰且有说服力的证据”(CCE) $\\approx 0.75$，“排除合理怀疑”(BRD) $\\approx 0.90$），这些标准为所需的置信水平提供了背景，但本身并非计算规则。\n- 来自概率论（贝叶斯定理）的、经过充分检验的公式，及其用于独立证据聚合的优势比形式。\n\n将真实性的优势比定义为 $O(S) = \\dfrac{\\Pr(S)}{1 - \\Pr(S)}$。对于独立的指标，后验优势比通过与似然比（也称为贝叶斯因子）相乘进行更新，其中每个指标 $E_i$ 的似然比为\n$$\n\\text{LR}_i = \\dfrac{\\Pr(E_i \\mid S)}{\\Pr(E_i \\mid \\neg S)}.\n$$\n于是，\n$$\nO\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right) = O(S) \\times \\prod_{i=1}^{4} \\text{LR}_i,\n$$\n并且后验概率通过以下公式计算得出：\n$$\n\\Pr\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right) = \\dfrac{O\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right)}{1 + O\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right)}.\n$$\n\n逐一计算每个组成部分。\n\n1. 先验优势比：\n$$\np_0 = 0.58 \\quad \\Rightarrow \\quad O(S) = \\dfrac{0.58}{1 - 0.58} = \\dfrac{0.58}{0.42} = \\dfrac{58}{42} = \\dfrac{29}{21}.\n$$\n\n2. 似然比：\n- 对于 $E_1$：\n$$\n\\text{LR}_1 = \\dfrac{0.82}{0.31} = \\dfrac{82}{31}.\n$$\n- 对于 $E_2$：\n$$\n\\text{LR}_2 = \\dfrac{0.40}{0.65} = \\dfrac{40}{65} = \\dfrac{8}{13}.\n$$\n- 对于 $E_3$：\n$$\n\\text{LR}_3 = \\dfrac{0.90}{0.50} = \\dfrac{9}{5}.\n$$\n- 对于 $E_4$：\n$$\n\\text{LR}_4 = \\dfrac{0.70}{0.25} = \\dfrac{14}{5}.\n$$\n\n3. 聚合似然比：\n$$\n\\prod_{i=1}^{4} \\text{LR}_i = \\left(\\dfrac{82}{31}\\right)\\left(\\dfrac{8}{13}\\right)\\left(\\dfrac{9}{5}\\right)\\left(\\dfrac{14}{5}\\right) = \\dfrac{82 \\times 8 \\times 9 \\times 14}{31 \\times 13 \\times 5 \\times 5}.\n$$\n计算分子和分母：\n$$\n82 \\times 8 = 656,\\quad 656 \\times 9 = 5904,\\quad 5904 \\times 14 = 82656,\n$$\n$$\n31 \\times 13 = 403,\\quad 403 \\times 5 = 2015,\\quad 2015 \\times 5 = 10075.\n$$\n因此，\n$$\n\\prod_{i=1}^{4} \\text{LR}_i = \\dfrac{82656}{10075}.\n$$\n\n4. 后验优势比：\n$$\nO\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right) = \\left(\\dfrac{29}{21}\\right)\\left(\\dfrac{82656}{10075}\\right) = \\dfrac{29 \\times 82656}{21 \\times 10075} = \\dfrac{2397024}{211575}.\n$$\n\n5. 后验概率：\n使用优势比到概率的转换公式，\n$$\n\\Pr\\!\\left(S \\mid E_1, E_2, E_3, E_4\\right) = \\dfrac{\\dfrac{2397024}{211575}}{1 + \\dfrac{2397024}{211575}} = \\dfrac{2397024}{211575 + 2397024} = \\dfrac{2397024}{2608599}.\n$$\n为简化起见，将分子和分母同时除以 $3$（两者均可被 $3$ 整除）：\n$$\n\\dfrac{2397024}{2608599} = \\dfrac{799008}{869533}.\n$$\n现在计算其小数近似值：\n$$\n\\dfrac{799008}{869533} \\approx 0.918893\\ldots\n$$\n四舍五入到四位有效数字：\n$$\n0.9189.\n$$\n\n从解释的角度看，计算出的后验概率超过了 $0.75$ 的“清晰且有说服力的证据”的典型阈值，甚至接近 $0.90$ 的“排除合理怀疑”的参考标准，但题目要求输出的是后验概率本身的数值。\n\n因此，所求值为 $0.9189$（四舍五入到四位有效数字）。", "answer": "$$\\boxed{0.9189}$$", "id": "4476774"}, {"introduction": "良心拒绝的法律和伦理影响，不仅局限于个体医患之间，更延伸至整个社区的医疗服务可及性。本章的最终练习要求您从系统层面思考，通过构建一个定量模型来评估多个地区的良心拒绝行为对病人整体就医机会的累积影响。这项实践将个体提供者的行为与公共卫生政策联系起来，检验一个医疗系统在面临良心拒绝时，是否仍能有效履行其不遗弃病人的核心承诺。[@problem_id:4476741]", "problem": "一个司法管辖区允许医疗服务提供者对某项合法的临床服务行使良心拒絕（CO）。其指导性法律原则以服务的连续性和不阻碍获取服务为基础，要求良心拒絕不得对患者造成不当负担。此处将其形式化为每个地区都必须达到或超过一个最低可及性阈值。您的任务是使用以下基本基础，设计并实现一个定量模型，以测试多个地区对该原则的遵守情况。\n\n基本基础和核心定义：\n- 服务的连续性要求患者能够及时获得合法的医疗服务，而不会因良心拒絕而产生不合理的延误或旅行负担。这可以通过一个最低可及性阈值 $A_{\\text{min}}$ 来操作化，即每个地区 $i$ 的可及性比例必须大于或等于 $A_{\\text{min}}$。\n- 可及性被定义为患者在最大旅行时间阈值 $T$ 内，从有可用容量的非拒绝服务的提供者那里获得合法服务的能力。\n- 转诊遵从度体现了拒绝服务的提供者通过将患者引导至非拒绝服务的提供者来确保持续性的法律责任。设 $Q_i$ 表示在地区 $i$ 遇到拒绝服务者的患者获得有效转诊的概率。\n- 地区 $i$ 的服务提供者容量为 $C_i$，其中拒绝服务者的比例为 $O_i \\in [0,1]$，非拒绝服务者的比例为 $(1 - O_i)$。非拒绝服务者的容量为 $C_i (1 - O_i)$。\n- 地区 $i$ 的患者需求为 $D_i$。\n- 地区间的旅行时间由一个矩阵 $M$ 给出，其条目 $M_{ij}$ 以分钟为单位。如果 $M_{ij} \\leq T$，则来自地区 $i$ 的患者可以到达地区 $j$ ，其中 $T$ 以分钟为单位指定。\n\n从基础推导出的建模假设：\n- 患者最初按服务提供者比例在其所在地区联系服务提供者。因此，在地区 $i$ 最初联系非拒绝服务者的预期患者数量为 $D_i (1 - O_i)$，受限于非拒绝服务者容量 $C_i (1 - O_i)$。\n- 在其所在地区未被本地非拒绝服务者服务的患者，要么是遇到了拒绝服务者，要么是超出了本地非拒绝服务者的容量。这些患者中的一部分（比例为 $Q_i$）被有效转诊至旅行时间阈值 $T$ 内可达的非拒绝服务者容量池。\n- 被转诊的患者被分配到可达的非拒绝服务者容量中，且不超过其容量。分配是确定性的：对于每个源地区 $i$，按 $M_{ij}$ 递增的顺序（若有平局则按索引）将患者分配到目标地区 $j$。\n- 地区 $i$ 的可及性比例是获得服务的患者总数（本地服务加上通过转诊服务）除以 $D_i$。\n\n任务：\n1. 以算法形式推导如何为每个地区 $i$ 计算：\n   - 本地非拒绝服务者容量 $C_i (1 - O_i)$。\n   - 本地服务的患者数 $S_i^{\\text{local}} = \\min\\!\\left(D_i (1 - O_i),\\, C_i (1 - O_i)\\right)$。\n   - 剩余非拒绝服务者容量 $K_i = C_i (1 - O_i) - S_i^{\\text{local}}$。\n   - 剩余需求 $R_i = D_i - S_i^{\\text{local}}$。\n   - 转诊需求 $R_i^{\\text{ref}} = R_i \\, Q_i$。\n   - 从地区 $i$ 到可达地区 $j$（其中 $M_{ij} \\leq T$）的转诊分配，不超过剩余容量 $K_j$，使用上述确定性贪心排序。\n   - 可及性比例 $A_i = \\dfrac{S_i^{\\text{local}} + S_i^{\\text{ref}}}{D_i}$，其中 $S_i^{\\text{ref}}$ 是从 $R_i^{\\text{ref}}$ 分配出去的总量。\n2. 确定管辖区的合规性（布尔值）：所有地区 $i$ 均满足 $A_i \\geq A_{\\text{min}}$。\n3. 将算法实现为一个完整的、可运行的程序。所有旅行时间 $M_{ij}$ 和阈值 $T$ 都必须以分钟为单位处理。程序必须处理下方的测试套件，并输出一行结果，其中包含每个测试用例的合规性结果，格式为方括号内以逗号分隔的列表（例如，`[True,False,True]`）。不得打印任何其他文本。\n\n测试套件（所有旅行时间以分钟为单位，所有概率和比例以小数表示）：\n- 测试用例 1（一般理想路径，本地和邻近地区容量充足，转诊遵从度高）：\n  - 地区数 $N = 3$。\n  - 需求 $D = [\\,100,\\,80,\\,60\\,]$。\n  - 容量 $C = [\\,120,\\,90,\\,70\\,]$。\n  - 拒绝服务者比例 $O = [\\,0.2,\\,0.25,\\,0.1\\,]$。\n  - 转诊遵从度 $Q = [\\,0.9,\\,0.85,\\,0.95\\,]$。\n  - 旅行时间矩阵\n    $$\n    M = \\begin{bmatrix}\n    0  30  60\\\\\n    30  0  30\\\\\n    60  30  0\n    \\end{bmatrix}\n    $$\n  - 旅行阈值 $T = 45$。\n  - 最低可及性阈值 $A_{\\text{min}} = 0.9$。\n- 测试用例 2（边界情况：所有服务提供者均拒绝服务，非拒绝服务者容量为零）：\n  - 地区数 $N = 2$。\n  - 需求 $D = [\\,50,\\,50\\,]$。\n  - 容量 $C = [\\,50,\\,50\\,]$。\n  - 拒绝服务者比例 $O = [\\,1.0,\\,1.0\\,]$。\n  - 转诊遵从度 $Q = [\\,1.0,\\,1.0\\,]$。\n  - 旅行时间矩阵\n    $$\n    M = \\begin{bmatrix}\n    0  20\\\\\n    20  0\n    \\end{bmatrix}\n    $$\n  - 旅行阈值 $T = 20$。\n  - 最低可及性阈值 $A_{\\text{min}} = 0.5$。\n- 测试用例 3（边缘情况：旅行阈值为零，仅计算本地非拒绝服务者容量）：\n  - 地区数 $N = 2$。\n  - 需求 $D = [\\,40,\\,40\\,]$。\n  - 容量 $C = [\\,30,\\,30\\,]$。\n  - 拒绝服务者比例 $O = [\\,0.4,\\,0.3\\,]$。\n  - 转诊遵从度 $Q = [\\,1.0,\\,1.0\\,]$。\n  - 旅行时间矩阵\n    $$\n    M = \\begin{bmatrix}\n    0  10\\\\\n    10  0\n    \\end{bmatrix}\n    $$\n  - 旅行阈值 $T = 0$。\n  - 最低可及性阈值 $A_{\\text{min}} = 0.6$。\n- 测试用例 4（邻近地区辅助可及性：邻近地区容量充足，转诊遵从度高）：\n  - 地区数 $N = 3$。\n  - 需求 $D = [\\,80,\\,90,\\,70\\,]$。\n  - 容量 $C = [\\,100,\\,130,\\,120\\,]$。\n  - 拒绝服务者比例 $O = [\\,0.4,\\,0.2,\\,0.4\\,]$。\n  - 转诊遵从度 $Q = [\\,0.9,\\,0.9,\\,0.9\\,]$。\n  - 旅行时间矩阵\n    $$\n    M = \\begin{bmatrix}\n    0  30  60\\\\\n    30  0  30\\\\\n    60  30  0\n    \\end{bmatrix}\n    $$\n  - 旅行阈值 $T = 60$。\n  - 最低可及性阈值 $A_{\\text{min}} = 0.85$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号内以逗号分隔的列表（例如，`[True,False,True,True]`）。每个元素都是一个布尔值，表示对应测试用例的管辖区是否合规（即所有地区都达到或超过 $A_{\\text{min}}$）。", "solution": "问题陈述提出了一个定义明确的定量建模任务。它在科学上是有根据的，是应用一组指定规则的正式练习，在数学上是一致的、客观的，并包含足够的信息，可以在对迭代处理的标准解释下推导出唯一解。因此，该问题被认为是有效的。\n\n问题的核心是为跨多个地区的患者获取临床服务进行建模，其中考虑了服务提供者的良心拒絕、患者需求、服务提供者容量和患者旅行。最终目标是确定整个管辖系统是否在所有地区都遵守了最低可及性阈值 $A_{\\text{min}}$。\n\n解决方案是通过对每个地区 $i$（从 $i=0$ 到 $N-1$，$N$ 是地区数量）执行一系列计算来得出的。该模型可以概念化为三个不同阶段：（1）计算本地服务以及产生的剩余需求和容量，（2）将被转诊的患者分配到可达地区内的可用容量，以及（3）最终计算可及性比例和合规性裁决。\n\n**阶段 1：本地服务计算**\n\n对于每个地区 $i$，我们首先确定本地需求在多大程度上由本地非拒绝服务的提供者满足。\n\n1.  **非拒绝服务者容量 ($C_i^{\\text{non-obj}}$)**：地区 $i$ 的总容量为 $C_i$，拒绝服务者的比例为 $O_i$。因此，非拒绝服务提供者的容量为：\n    $$C_i^{\\text{non-obj}} = C_i (1 - O_i)$$\n\n2.  **本地服务的患者数 ($S_i^{\\text{local}}$)**：地区 $i$ 的患者最初在本地寻求服务。针对非拒绝服务提供者的需求与其份额成正比，产生的预期需求为 $D_i (1 - O_i)$。实际服务的患者数量受限于可用的非拒绝服务者容量。因此，本地服务的患者数为：\n    $$S_i^{\\text{local}} = \\min(D_i (1 - O_i), C_i^{\\text{non-obj}})$$\n\n3.  **剩余非拒绝服务者容量 ($K_i$)**：在服务本地需求后，地区 $i$ 中非拒绝服务提供者的剩余容量为：\n    $$K_i = C_i^{\\text{non-obj}} - S_i^{\\text{local}}$$\n    此剩余容量可用于服务来自任何地区（包括地区 $i$ 本身）的转诊患者。\n\n4.  **剩余需求 ($R_i$)**：初始需求 $D_i$ 中未在本地得到服务的部分构成了剩余需求：\n    $$R_i = D_i - S_i^{\\text{local}}$$\n\n5.  **转诊需求 ($R_i^{\\text{ref}}$)**：构成剩余需求 $R_i$ 的患者中，有一部分（比例为 $Q_i$）被有效转诊到别处寻求服务。这就得出了将通过转诊寻求服务的地区 $i$ 的总需求：\n    $$R_i^{\\text{ref}} = R_i \\cdot Q_i$$\n\n对所有地区执行这些计算，得出本地服务患者数 $S^{\\text{local}}$、剩余容量 $K$ 和转诊需求 $R^{\\text{ref}}$ 的初始值。\n\n**阶段 2：转诊分配算法**\n\n此阶段将每个源地区的转诊需求分配给可达目标地区的剩余容量。问题陈述此分配应“对每个源地区 $i$”进行。这意味着一个顺序过程。我们采用标准的计算解释，即按索引递增的顺序处理源地区，$i = 0, 1, 2, \\dots, N-1$。剩余容量 $K_j$ 是共享资源，较早的源地区分配所造成的消耗会影响其对后续源地区的可用性。\n\n对于每个源地区 $i$（从 $0$ 到 $N-1$）：\n\n1.  初始化地区 $i$ 通过转诊获得服务的患者总数 $S_i^{\\text{ref}}$ 为 $0$。设待分配的需求为 $d_{i, \\text{alloc}} = R_i^{\\text{ref}}$。\n2.  确定可达目标地区集合 $J_i = \\{j \\mid M_{ij} \\leq T\\}$，其中 $M_{ij}$ 是从地区 $i$ 到地区 $j$ 的旅行时间，$T$ 是最大旅行时间阈值。请注意，一个地区总是可以从自身到达，因为 $M_{ii}=0$。\n3.  根据指定的确定性规则对地区 $j \\in J_i$ 进行排序：主要按旅行时间 $M_{ij}$ 递增，其次按地区索引 $j$ 递增以解决平局。\n4.  遍历排序后的目标地区列表 $j$：\n    a. 可分配给地区 $j$ 的需求量受其当前剩余容量 $K_j$ 和源地区 $i$ 待分配的剩余需求 $d_{i, \\text{alloc}}$ 的限制。分配量为 $\\Delta = \\min(d_{i, \\text{alloc}}, K_j)$。\n    b. 更新状态：\n       - 源地区 $i$ 的总转诊患者数增加：$S_i^{\\text{ref}} \\leftarrow S_i^{\\text{ref}} + \\Delta$。\n       - 源地区 $i$ 的剩余转诊需求减少：$d_{i, \\text{alloc}} \\leftarrow d_{i, \\text{alloc}} - \\Delta$。\n       - 目标地区 $j$ 的剩余容量被消耗：$K_j \\leftarrow K_j - \\Delta$。\n    c. 如果 $d_{i, \\text{alloc}}$ 变为 $0$，则源地区 $i$ 的转诊需求已完全满足（或无法进一步满足），我们可以继续处理下一个源地区 $i+1$。\n\n这个贪心分配过程持续进行，直到所有源地区的转诊需求都已在逐渐减少的剩余容量池中完成分配。\n\n**阶段 3：管辖区合规性裁决**\n\n分配阶段完成后，我们计算每个地区的最终可及性比例并检查合规性。\n\n1.  **总服务患者数 ($S_i^{\\text{total}}$)**：对于每个地区 $i$，总服务患者数是本地服务和通过转诊服务的患者之和。\n    $$S_i^{\\text{total}} = S_i^{\\text{local}} + S_i^{\\text{ref}}$$\n\n2.  **可及性比例 ($A_i$)**：可及性比例是总服务患者数与初始需求的比率。如果 $D_i > 0$，则为\n    $$A_i = \\frac{S_i^{\\text{total}}}{D_i}$$\n    如果 $D_i = 0$，则需求完全满足，因此我们可以定义 $A_i=1$。\n\n3.  **合规性检查**：管辖区合规当且仅当每个地区都达到或超过最低可及性阈值 $A_{\\text{min}}$。这是一个布尔条件：\n    $$\\text{Compliance} = \\bigwedge_{i=0}^{N-1} (A_i \\geq A_{\\text{min}})$$\n    对所有地区的这个逻辑与运算得出给定测试用例的最终布尔结果。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the compliance model on a suite of test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        {\n            \"D\": np.array([100, 80, 60]),\n            \"C\": np.array([120, 90, 70]),\n            \"O\": np.array([0.2, 0.25, 0.1]),\n            \"Q\": np.array([0.9, 0.85, 0.95]),\n            \"M\": np.array([[0, 30, 60], [30, 0, 30], [60, 30, 0]]),\n            \"T\": 45,\n            \"A_min\": 0.9,\n        },\n        # Test case 2\n        {\n            \"D\": np.array([50, 50]),\n            \"C\": np.array([50, 50]),\n            \"O\": np.array([1.0, 1.0]),\n            \"Q\": np.array([1.0, 1.0]),\n            \"M\": np.array([[0, 20], [20, 0]]),\n            \"T\": 20,\n            \"A_min\": 0.5,\n        },\n        # Test case 3\n        {\n            \"D\": np.array([40, 40]),\n            \"C\": np.array([30, 30]),\n            \"O\": np.array([0.4, 0.3]),\n            \"Q\": np.array([1.0, 1.0]),\n            \"M\": np.array([[0, 10], [10, 0]]),\n            \"T\": 0,\n            \"A_min\": 0.6,\n        },\n        # Test case 4\n        {\n            \"D\": np.array([80, 90, 70]),\n            \"C\": np.array([100, 130, 120]),\n            \"O\": np.array([0.4, 0.2, 0.4]),\n            \"Q\": np.array([0.9, 0.9, 0.9]),\n            \"M\": np.array([[0, 30, 60], [30, 0, 30], [60, 30, 0]]),\n            \"T\": 60,\n            \"A_min\": 0.85,\n        },\n    ]\n\n    results = [check_compliance(case) for case in test_cases]\n    \n    # Format the final output as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef check_compliance(case):\n    \"\"\"\n    Calculates jurisdictional compliance for a single test case.\n    \n    Args:\n        case (dict): A dictionary containing all parameters for a test case.\n        \n    Returns:\n        bool: True if compliant, False otherwise.\n    \"\"\"\n    D = case[\"D\"]\n    C = case[\"C\"]\n    O = case[\"O\"]\n    Q = case[\"Q\"]\n    M = case[\"M\"]\n    T = case[\"T\"]\n    A_min = case[\"A_min\"]\n    \n    num_regions = len(D)\n\n    # Phase 1: Local Service Calculation\n    C_non_obj = C * (1 - O)\n    demand_to_non_obj = D * (1 - O)\n    \n    S_local = np.minimum(demand_to_non_obj, C_non_obj)\n    \n    K = C_non_obj - S_local\n    R = D - S_local\n    R_ref = R * Q\n    \n    S_ref = np.zeros(num_regions)\n\n    # Phase 2: Referral Allocation Algorithm\n    # Process source regions sequentially by index\n    for i in range(num_regions):\n        demand_to_allocate = R_ref[i]\n        \n        if demand_to_allocate == 0:\n            continue\n            \n        # Identify and sort reachable destination regions\n        reachable_regions = []\n        for j in range(num_regions):\n            if M[i, j] = T:\n                # Store (travel_time, region_index) for sorting\n                reachable_regions.append((M[i, j], j))\n        \n        # Sort by travel time, then by index for ties\n        reachable_regions.sort()\n        \n        # Allocate referred demand greedily\n        for _, j in reachable_regions:\n            if demand_to_allocate == 0:\n                break\n            \n            can_allocate = min(demand_to_allocate, K[j])\n            \n            if can_allocate > 0:\n                S_ref[i] += can_allocate\n                K[j] -= can_allocate\n                demand_to_allocate -= can_allocate\n\n    # Phase 3: Jurisdictional Compliance Verdict\n    S_total = S_local + S_ref\n    \n    A = np.zeros(num_regions)\n    # Use np.divide to handle D[i] == 0 safely\n    np.divide(S_total, D, out=A, where=D!=0)\n    A[D==0] = 1.0 # If demand is zero, access is 100%\n\n    is_compliant = np.all(A >= A_min)\n    \n    return is_compliant\n\nsolve()\n```", "id": "4476741"}]}