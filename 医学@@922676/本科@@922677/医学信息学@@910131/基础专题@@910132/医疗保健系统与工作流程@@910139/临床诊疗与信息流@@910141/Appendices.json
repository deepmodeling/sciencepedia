{"hands_on_practices": [{"introduction": "临床诊疗的核心是信息驱动的推理过程。医生根据病史、体征和新的检查结果不断更新对病情的判断。贝叶斯定理为这一认知过程提供了严谨的数学框架，使我们能够量化新证据（如诊断测试结果）如何改变我们对疾病可能性的评估。这个练习 [@problem_id:4859155] 将指导你完成一个基础但至关重要的计算：在已知测试前概率、敏感性和特异性的情况下，如何计算阳性结果后的后验概率，这是理解和评估诊断信息流价值的基本功。", "problem": "在一次门诊临床诊疗中，临床医生考虑为一种疑似疾病安排一项二元诊断测试。此次诊疗中的信息流从基于病史和检查的初始判断，发展到观察测试结果后的更新判断。设测试前概率为 $0.3$。该测试的灵敏度为 $0.8$，特异性为 $0.9$。仅使用灵敏度、特异性、概率、几率和 Bayes’ 定理的基本定义，确定患者在测试结果为阳性后的疾病后验概率。请将最终答案表示为 $0$ 到 $1$ 之间的小数，并四舍五入到四位有效数字。", "solution": "该问题是有效的，因为它具有科学依据、问题明确、客观，并包含使用既定的概率论原理得出唯一解所需的所有必要信息。\n\n任务是计算在给定测试结果为阳性的情况下，患者患有该疾病的后验概率。这是 Bayes' 定理的一个经典应用。我们首先正式定义事件和给定的概率。\n\n设 $D$ 为患者患有该疾病的事件。\n设 $D^c$ 为患者未患该疾病的事件。\n设 $T^+$ 为诊断测试结果为阳性的事件。\n设 $T^-$ 为诊断测试结果为阴性的事件。\n\n根据问题陈述，我们得到以下信息：\n1.  疾病的测试前概率为 $P(D) = 0.3$。\n2.  测试的灵敏度是指在患者患有该疾病的情况下测试结果为阳性的概率。用我们的符号表示，即为 $P(T^+ | D) = 0.8$。\n3.  测试的特异性是指在患者未患该疾病的情况下测试结果为阴性的概率。用我们的符号表示，即为 $P(T^- | D^c) = 0.9$。\n\n我们的目标是求出在测试结果为阳性时患病的后验概率，记为 $P(D | T^+)$。\n\n根据 Bayes' 定理，条件概率 $P(D | T^+)$ 可以表示为：\n$$\nP(D | T^+) = \\frac{P(T^+ | D) P(D)}{P(T^+)}\n$$\n\n分子中包含了已知的项：$P(T^+ | D) = 0.8$ 和 $P(D) = 0.3$。分母 $P(T^+)$ 是获得阳性测试结果的总概率。这可以用全概率公式计算，该公式指出，一个事件的概率可以通过将其在一组互斥且完备的事件上的条件概率相加来求得。在本例中，这组事件是 $\\{D, D^c\\}$。\n$$\nP(T^+) = P(T^+ | D) P(D) + P(T^+ | D^c) P(D^c)\n$$\n\n为了计算 $P(T^+)$，我们需要确定 $P(D^c)$ 和 $P(T^+ | D^c)$ 的值。\n\n未患病的概率 $P(D^c)$ 是患病概率 $P(D)$ 的补集：\n$$\nP(D^c) = 1 - P(D) = 1 - 0.3 = 0.7\n$$\n\n概率 $P(T^+ | D^c)$ 是指在患者未患病的情况下测试结果为阳性的概率。这是假阳性率。它是特异性 $P(T^- | D^c)$ 的补集：\n$$\nP(T^+ | D^c) = 1 - P(T^- | D^c) = 1 - 0.9 = 0.1\n$$\n\n现在我们可以计算阳性测试的总概率 $P(T^+)$：\n$$\nP(T^+) = (P(T^+ | D) \\times P(D)) + (P(T^+ | D^c) \\times P(D^c))\n$$\n代入已知值：\n$$\nP(T^+) = (0.8 \\times 0.3) + (0.1 \\times 0.7)\n$$\n$$\nP(T^+) = 0.24 + 0.07 = 0.31\n$$\n\n在确定了所有部分之后，我们现在可以将它们代回 Bayes' 定理，以求出后验概率 $P(D | T^+)$：\n$$\nP(D | T^+) = \\frac{P(T^+ | D) P(D)}{P(T^+)} = \\frac{0.8 \\times 0.3}{0.31}\n$$\n$$\nP(D | T^+) = \\frac{0.24}{0.31}\n$$\n\n为了得到最终的数值答案，我们进行除法运算：\n$$\nP(D | T^+) \\approx 0.774193548...\n$$\n\n问题要求答案以小数形式表示，并四舍五入到四位有效数字。\n$$\nP(D | T^+) \\approx 0.7742\n$$\n这就是患者在收到阳性测试结果后患有该疾病的后验概率。", "answer": "$$\n\\boxed{0.7742}\n$$", "id": "4859155"}, {"introduction": "单个诊疗环节的推理固然重要，但现代医疗信息系统的威力在于实现跨系统、跨机构的数据流动和整合。为了让临床信息能够被不同系统可靠地共享、汇总和计算分析，它必须被转换成标准化的格式。本练习 [@problem_id:4859159] 深入探讨了这一关键任务：如何将一个原始的临床测量值（如血糖）映射为一个语义互操作的 FHIR (Fast Healthcare Interoperability Resources) 资源，并正确使用 LOINC 等标准术语进行编码，从而确保数据在信息高速公路上的“通用语言”地位。", "problem": "您正在实现一个映射函数，该函数将临床诊疗中获得的血糖测量值编码为符合快速医疗保健互操作性资源 (Fast Healthcare Interoperability Resources, FHIR) Observation 的语义互操作表示。您的推导和设计基础必须包含以下原则和定义：逻辑观察标识符名称和代码 (Logical Observation Identifiers Names and Codes, LOINC) 作为观察类型的标准化词汇表的作用，统一计量单位代码 (Uniform Code for Units of Measure, UCUM) 用于单位，以及 FHIR Observation 资源的语义，该语义要求 code 用于传达观察概念，valueQuantity 用于传达测量值和单位。此外，您必须使用摩尔质量的物理定义在物质的量浓度和质量浓度之间进行转换。具体来说，令 $M$ 表示 D-Glucose 的摩尔质量，为 $M = 180.15588$ 克/摩尔。物质的量浓度（单位：毫摩尔/升）与质量浓度（单位：毫克/分升）之间的单位转换源自基本单位关系。\n\n设计一个算法，针对临床诊疗中收集的每次血糖观察，给定一组输入：\n- 一个数值测量值 $v$，\n- 一个单位字符串 $u$（可能的值见下方的测试套件），\n- 一个标本描述 $s$（例如，毛细血管血、静脉血浆），\n- 一个司法管辖区 $j$（美国或非美国），\n\n生成以下输出：\n- 一个以毫克/分升 (mg/dL) 表示的规范血糖数值，四舍五入到 $3$ 位小数，\n- 所选 LOINC 代码的数字标识符，通过从 LOINC 标识符中移除连字符编码为整数（例如，LOINC $2339\\text{-}0$ 变为整数 $23390$），\n- 所选 FHIR Profile 的数字标识符：当 $j$ 表示美国时，使用 $1$ 代表 HL7 FHIR United States Core Observation Laboratory Profile；否则，使用 $2$ 代表 HL7 FHIR International Patient Summary (IPS) Observation results profile。\n\n您的算法必须遵守基于上述原则的这些规则：\n1. 单位规范化为 UCUM：\n   - 将等于“毫克/分升”的任何文本变体的 $u$ 解释为 UCUM mg/dL，并保持数值 $v$ 在 mg/dL 中不变。\n   - 将等于“毫克/升”的 $u$ 解释为 UCUM mg/L，并通过乘以 $0.1$ 转换为 mg/dL，使得 $v_{\\mathrm{mg/dL}} = 0.1 \\cdot v_{\\mathrm{mg/L}}$。\n   - 将等于“毫摩尔/升”的 $u$ 解释为 UCUM mmol/L，并使用摩尔质量定义转换为 mg/dL：$$v_{\\mathrm{mg/dL}} = \\frac{M}{10} \\cdot v_{\\mathrm{mmol/L}}.$$ 此处 $M = 180.15588$ 克/摩尔，因子 $10$ 来自 $1\\,\\mathrm{L} = 10\\,\\mathrm{dL}$ 以及毫摩尔和毫克的定义。\n   - 将等于“微摩尔/升”的 $u$ 解释为 UCUM $\\mu$mol/L，首先通过除以 $1000$ 转换为 mmol/L，然后按上述步骤进行，使得 $$v_{\\mathrm{mg/dL}} = \\frac{M}{10} \\cdot \\left(\\frac{v_{\\mu\\mathrm{mol}/\\mathrm{L}}}{1000}\\right)$$。\n2. 根据观察语义和标本选择 LOINC 代码：\n   - 如果 $s$ 表示血清或血浆标本，选择 LOINC $2345\\text{-}7$ (Glucose [Mass/volume] in Serum or Plasma)，编码为整数 $23457$。\n   - 否则，如果 $s$ 表示血液标本（包括毛细血管血），则：\n     - 如果单位是基于质量的（mg/dL 或 mg/L），选择 LOINC $2339\\text{-}0$ (Glucose [Mass/volume] in Blood)，编码为整数 $23390$。\n     - 如果单位是基于物质的量的（mmol/L 或 $\\mu$mol/L），选择 LOINC $15074\\text{-}8$ (Glucose [Moles/volume] in Blood)，编码为整数 $150748$。\n3. 选择 FHIR Profile 以确保司法管辖区级别的语义互操作性：\n   - 如果 $j$ 是美国，使用 HL7 FHIR United States Core Observation Laboratory profile，编码为 $1$。\n   - 否则，使用 HL7 FHIR International Patient Summary (IPS) Observation results profile，编码为 $2$。\n\n您的程序必须实现上述算法并为以下测试套件生成结果。每个测试用例是一个元组 $(v, u, s, j)$：\n\n- 测试用例 A (正常路径，毛细血管血，基于质量，美国)：$(108, \\text{\"mg/dL\"}, \\text{\"capillary blood\"}, \\text{\"US\"})$。预期：质量归一化无转换，LOINC $2339\\text{-}0$，美国 Profile。\n- 测试用例 B (基于物质的量，血液，非美国)：$(5.6, \\text{\"mmol/L\"}, \\text{\"capillary blood\"}, \\text{\"EU\"})$。预期：使用 $M = 180.15588$ 从 mmol/L 转换为 mg/dL，LOINC $15074\\text{-}8$，IPS Profile。\n- 测试用例 C (血清/血浆，基于质量，输入为 mg/L，美国)：$(900, \\text{\"mg/L\"}, \\text{\"venous plasma\"}, \\text{\"US\"})$。预期：从 mg/L 转换为 mg/dL，LOINC $2345\\text{-}7$，美国 Profile。\n- 测试用例 D (基于物质的量，单位为微摩尔/升，血液，非美国)：$(5600, \\text{\"umol/L\"}, \\text{\"blood\"}, \\text{\"EU\"})$。预期：从 $\\mu$mol/L 转换为 mmol/L 再转换为 mg/dL，LOINC $15074\\text{-}8$，IPS Profile。\n- 测试用例 E (基于质量，单位为 mg/dL 的文本变体，血液，美国)：$(65, \\text{\"mg per dl\"}, \\text{\"blood\"}, \\text{\"US\"})$。预期：归一化为 mg/dL 无数值变化，LOINC $2339\\text{-}0$，美国 Profile。\n\n您的程序应输出一行，包含一个结果列表，每个测试用例一个结果，其中每个结果是按 [canonical_value_mg_per_dL, loinc_code_integer, profile_id_integer] 顺序排列的包含三个数字的列表。规范值必须以 mg/dL 表示并四舍五入到 $3$ 位小数。最后一行必须以 Python 风格的列表的列表的精确格式打印，并用逗号分隔，例如：[[$a_1$, $b_1$, $c_1$],[$a_2$, $b_2$, $c_2$],...]。", "solution": "将临床血糖测量值映射到语义互操作的快速医疗保健互操作性资源 (Fast Healthcare Interoperability Resources, FHIR) Observation 资源的问题是有效的。它在科学上基于医疗信息学和化学的既定标准，问题提出得很好，具有清晰的输入和确定性规则，并且其表述是客观的。解决方案需要设计一个算法来协调三个不同但相关的任务：单位规范化、概念编码和司法管辖区画像分析。该算法的设计基于语义互操作性的核心原则，特别是使用逻辑观察标识符名称和代码 (Logical Observation Identifiers Names and Codes, LOINC) 表示观察概念，使用统一计量单位代码 (Uniform Code for Units of Measure, UCUM) 表示定量值，以及使用 FHIR 标准来结构化数据。\n\n该算法被设计为三个逻辑步骤，反映了问题陈述的要求。\n\n**步骤 1：规范值和单位规范化**\n\n第一步是将由值 $v$ 和单位字符串 $u$ 组成的输入测量值转换为规范表示。问题指定此规范形式为质量浓度单位毫克/分升 ($\\mathrm{mg/dL}$) 的数值，并四舍五入到 $3$ 位小数。这种规范化对于标准化数据比较和解释至关重要，遵循了 UCUM 对任何给定数量采用单一、明确表示的理念。\n\n转换逻辑取决于输入单位 $u$：\n- 如果输入单位 $u$ 是毫克/分升（例如，`mg/dL`, `mg per dl`）的文本变体，则不需要进行数值转换。值 $v$ 已经是以目标单位表示的。算法将此分类为基于质量的单位。\n- 如果输入单位是毫克/升 ($\\mathrm{mg/L}$)，则使用关系 $1\\,\\mathrm{L} = 10\\,\\mathrm{dL}$ 将其转换为 $\\mathrm{mg/dL}$。这给出了转换公式：\n$$v_{\\mathrm{mg/dL}} = v_{\\mathrm{mg/L}} \\times \\frac{1\\,\\mathrm{L}}{10\\,\\mathrm{dL}} = 0.1 \\cdot v_{\\mathrm{mg/L}}$$\n这也是一个基于质量的单位。\n- 如果输入单位是物质的量浓度，特别是毫摩尔/升 ($\\mathrm{mmol/L}$)，转换为质量浓度需要 D-Glucose 的摩尔质量，给定为 $M = 180.15588$ 克/摩尔。推导过程如下：\n$$v \\left[\\frac{\\mathrm{mmol}}{\\mathrm{L}}\\right] = v \\left[\\frac{10^{-3}\\,\\mathrm{mol}}{\\mathrm{L}}\\right]$$\n乘以摩尔质量 $M$ 将摩尔转换为克：\n$$v \\times M \\left[\\frac{10^{-3}\\,\\mathrm{g}}{\\mathrm{L}}\\right] = v \\times M \\left[\\frac{\\mathrm{mg}}{\\mathrm{L}}\\right]$$\n最后，将升转换为分升：\n$$v_{\\mathrm{mg/dL}} = \\frac{v_{\\mathrm{mmol/L}} \\times M}{10}$$\n算法正确地应用了这个公式：$v_{\\mathrm{mg/dL}} = \\frac{M}{10} \\cdot v_{\\mathrm{mmol/L}}$。这被分类为基于物质的量的单位。\n- 如果输入单位是微摩尔/升 ($\\mathrm{\\mu mol/L}$)，首先通过除以 $1000$ 将其转换为 $\\mathrm{mmol/L}$，然后应用与上面相同的转换：\n$$v_{\\mathrm{mg/dL}} = \\frac{M}{10} \\cdot \\left(\\frac{v_{\\mu\\mathrm{mol}/\\mathrm{L}}}{1000}\\right)$$\n这也是一个基于物质的量的单位。\n\n计算出的规范值随后四舍五入到 $3$ 位小数。保留一个标志，指示原始单位是基于质量还是基于物质的量，以供下一步使用。\n\n**步骤 2：LOINC 代码选择**\n\n第二步是选择适当的 LOINC 代码。LOINC 为识别医学实验室观察提供了一个通用标准。一个 LOINC 代码精确定义了分析物（Glucose）、测量的属性（例如，质量浓度、摩尔浓度）和标本类型（例如，血液、血清、血浆）。算法选择代码的逻辑直接实现了这种语义结构。\n\n- 如果标本描述 $s$ 表明是血清或血浆（例如，“venous plasma”），分析物系统是血清或血浆。所需的 LOINC 代码是 $2345\\text{-}7$（“Glucose [Mass/volume] in Serum or Plasma”），这考虑了所有值最终都被规范化为质量浓度的事实。这被编码为整数 $23457$。\n- 如果标本 $s$ 是血液（例如，“capillary blood”、“blood”），代码的选择取决于在步骤 1 中确定的原始测量属性。\n    - 如果原始单位是基于质量的（$\\mathrm{mg/dL}$ 或 $\\mathrm{mg/L}$），则属性是质量浓度。正确的 LOINC 代码是 $2339\\text{-}0$（“Glucose [Mass/volume] in Blood”），编码为 $23390$。\n    - 如果原始单位是基于物质的量的（$\\mathrm{mmol/L}$ 或 $\\mathrm{\\mu mol/L}$），则属性是摩尔浓度。正确的 LOINC 代码是 $15074\\text{-}8$（“Glucose [Moles/volume] in Blood”），编码为 $150748$。这正确地保留了测量的原始语义意图，即使值本身已被规范化为 $\\mathrm{mg/dL}$。在一个完整的 FHIR Observation 中，`valueQuantity` 将持有规范化后的值，而 `code` ($15074\\text{-}8$) 则表示原始测量是摩尔浓度的。\n\n**步骤 3：FHIR Profile 选择**\n\n最后一步是选择一个司法管辖区 Profile 标识符。FHIR Profile 使基础 FHIR 资源适应特定环境，例如国家医疗保健系统，从而增强在该领域内的互操作性。\n- 如果司法管辖区 $j$ 是美国（“US”），算法选择 HL7 FHIR United States Core Observation Laboratory profile，编码为整数 $1$。\n- 对于任何其他司法管辖区，它选择 HL7 FHIR International Patient Summary (IPS) Observation results profile，这是一个更广泛的国际标准。这被编码为整数 $2$。\n\n这三个步骤被集成到一个单一函数中，该函数处理每个输入观察元组 $(v, u, s, j)$ 并生成所需的三元素输出列表，确保符合指定的 informatics 标准和科学原则。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to process a list of test cases and print the results.\n    \"\"\"\n    \n    # Per the problem, M is the molar mass of D-Glucose in grams per mole.\n    M = 180.15588\n\n    # The test suite provided in the problem statement.\n    test_cases = [\n        # (v, u, s, j)\n        (108, \"mg/dL\", \"capillary blood\", \"US\"),\n        (5.6, \"mmol/L\", \"capillary blood\", \"EU\"),\n        (900, \"mg/L\", \"venous plasma\", \"US\"),\n        (5600, \"umol/L\", \"blood\", \"EU\"),\n        (65, \"mg per dl\", \"blood\", \"US\"),\n    ]\n\n    results = []\n    for v, u, s, j in test_cases:\n        result = process_observation(v, u, s, j, M)\n        results.append(result)\n\n    # The final print statement must produce the exact specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef process_observation(v, u, s, j, M):\n    \"\"\"\n    Applies the algorithm to a single blood glucose observation.\n\n    Args:\n        v (numeric): The measurement value.\n        u (str): The unit string.\n        s (str): The specimen description.\n        j (str): The jurisdiction code.\n        M (float): The molar mass of D-Glucose.\n\n    Returns:\n        list: A list containing [canonical_value_mg_per_dL, loinc_code_integer, profile_id_integer].\n    \"\"\"\n\n    # --- Rule 1: Unit normalization to UCUM and value conversion ---\n    # Normalize unit string for robust matching.\n    u_norm = u.lower().replace(\" \", \"\").replace(\"per\", \"/\")\n    \n    is_mass_based = False\n    canonical_value = 0.0\n\n    if u_norm in [\"mg/dl\"]:\n        canonical_value = float(v)\n        is_mass_based = True\n    elif u_norm == \"mg/l\":\n        # Convert mg/L to mg/dL: v_mg_per_dL = 0.1 * v_mg_per_L\n        canonical_value = 0.1 * v\n        is_mass_based = True\n    elif u_norm == \"mmol/l\":\n        # Convert mmol/L to mg/dL: v_mg_per_dL = (M / 10) * v_mmol_per_L\n        canonical_value = (M / 10.0) * v\n        is_mass_based = False\n    elif u_norm == \"umol/l\":\n        # Convert umol/L to mg/dL\n        canonical_value = (M / 10.0) * (v / 1000.0)\n        is_mass_based = False\n    \n    # Round the final canonical value to 3 decimal places.\n    canonical_value = round(canonical_value, 3)\n\n    # --- Rule 2: LOINC code selection from observation semantics ---\n    s_norm = s.lower()\n    loinc_code = 0\n\n    if \"serum\" in s_norm or \"plasma\" in s_norm:\n        # For serum or plasma, use LOINC 2345-7\n        loinc_code = 23457\n    elif \"blood\" in s_norm:\n        if is_mass_based:\n            # For blood with mass-based unit, use LOINC 2339-0\n            loinc_code = 23390\n        else: # Amount-of-substance-based\n            # For blood with mole-based unit, use LOINC 15074-8\n            loinc_code = 150748\n            \n    # --- Rule 3: FHIR profile selection based on jurisdiction ---\n    profile_id = 0\n    if j.upper() == \"US\":\n        # United States jurisdiction uses US Core profile\n        profile_id = 1\n    else:\n        # Other jurisdictions use IPS profile\n        profile_id = 2\n        \n    return [canonical_value, loinc_code, profile_id]\n\n# Execute the solver\nsolve()\n```", "id": "4859159"}, {"introduction": "在拥有标准化、可计算的数据后，我们便可以构建自动化的临床决策支持（CDS）系统来辅助医生，优化信息流，并改善诊疗质量。然而，设计一个有效的 CDS 系统并非易事，必须仔细权衡其利弊。本练习 [@problem_id:4859214] 聚焦于一个真实世界中的挑战：设计一个 CDS 警报系统。你将通过构建一个基于效用的数学模型，来显式地平衡捕获真阳性病例的收益与由假阳性导致的“警报疲劳”等负面效应，从而学习如何设计更智能、更高效的临床信息干预措施。", "problem": "一位医生在临床诊疗过程中使用带有临床决策支持 (CDS) 警报的电子健康记录 (EHR) 系统。每个警报由一个连续风险评分 $X$ 触发，该评分是在开具药物处方之前根据结构化数据计算得出的。令 $D \\in \\{0,1\\}$ 表示患者是否确实患有某种使得警报具有临床益处 ($D=1$) 的疾病，或者没有 ($D=0$)，其患病率为 $\\pi = \\mathbb{P}(D=1)$。在给定 $D$ 的条件下，风险评分被建模为等方差的高斯分布：$X \\mid D=0 \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2})$ 和 $X \\mid D=1 \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2})$，其中 $\\mu_{1} > \\mu_{0}$ 和 $\\sigma > 0$ 是已知的。CDS 系统当且仅当 $X \\ge t$ 时发出警报，其中 $t$ 是一个可调阈值。\n\n定义灵敏度 $\\text{Se}(t) = \\mathbb{P}(X \\ge t \\mid D=1)$ 和特异度 $\\text{Sp}(t) = \\mathbb{P}(X  t \\mid D=0)$，并令假阳性率 (FPR) 为 $\\text{FPR}(t) = 1 - \\text{Sp}(t)$。将警报疲劳建模为因高假阳性警报率而导致的临床医生响应概率下降：具体来说，假设临床医生对任何警报的响应概率为一固定值 $r \\in (0,1]$，该概率概括了环境中历史上高 $\\text{FPR}$ 导致的响应度的长期下降。对于每次临床诊疗，为四种可能的结果分配效用如下：真阳性效用 $u_{TP}  0$，假阳性效用 $u_{FP}  0$，假阴性效用 $u_{FN}  0$，以及真阴性效用 $u_{TN} = 0$。假设警报带来的益处或害处仅在临床医生响应时才会实现，因此当 $D=1$ 时响应产生 $u_{TP}$ 的效用，当 $D=0$ 时产生 $u_{FP}$ 的效用。如果警报未被采纳（即未发出，或发出但未被响应），且 $D=1$，则该次诊疗产生 $u_{FN}$ 的效用。\n\n仅使用灵敏度、特异度、贝叶斯后验概率和期望效用的核心定义，执行以下操作：\n\n1. 将每次诊疗的期望净效用 $J(t)$ 构建为 $t$, $\\pi$, $\\text{Se}(t)$, $\\text{Sp}(t)$, $u_{TP}$, $u_{FP}$, $u_{FN}$ 和 $r$ 的函数，该函数捕捉了在上述假设下灵敏度、特异度和临床医生效用之间的权衡。\n\n2. 从第一性原理出发，通过在给定的评分实现值 $x$ 下比较发出警报与不发出警报的期望效用，推导出最大化期望效用的最优决策规则，并证明该规则导出了一个关于似然比 $\\Lambda(x) = \\frac{f_{X \\mid D=1}(x)}{f_{X \\mid D=0}(x)}$ 的阈值，其中 $f_{X \\mid D}$ 是上文指定的高斯密度函数。\n\n3. 将此决策规则特化到等方差高斯模型，以获得最优警报阈值 $t^{*}$ 关于 $\\mu_{0}$, $\\mu_{1}$, $\\sigma$, $\\pi$, $u_{TP}$, $u_{FP}$ 和 $u_{FN}$ 的闭式表达式。你的最终答案必须是 $t^{*}$ 的单个解析表达式。不需要数值近似。", "solution": "临床效用公式是通过对混淆矩阵的各种结果计算期望值得出的，其权重取决于这些结果的发生频率以及警报行动是否被实现（被响应）。根据定义，对于阈值 $t$，灵敏度和特异度分别是 $\\text{Se}(t) = \\mathbb{P}(X \\ge t \\mid D=1)$ 和 $\\text{Sp}(t) = \\mathbb{P}(X  t \\mid D=0)$。假阳性率为 $\\text{FPR}(t) = 1 - \\text{Sp}(t)$。在所述假设下，只有当临床医生响应时，警报才会产生效用。如果发出警报，它以概率 $r$ 被响应；否则，以概率 $1-r$ 它不产生任何效果。当 $D=1$ 时，一个未被采纳的警报导致的后果与没有警报相同，即假阴性效用 $u_{FN}$；当 $D=0$ 时，未被采纳的警报等同于效用为 $u_{TN}=0$ 的真阴性。\n\n第1部分：每次诊疗的期望净效用 $J(t)$ 可以通过对疾病状态和警报结果求和来构建。当 $X \\ge t$ 时发出警报；给定 $D=1$，这发生的概率是 $\\text{Se}(t)$；给定 $D=0$，发生的概率是 $\\text{FPR}(t) = 1 - \\text{Sp}(t)$。如果警报被发出并被响应，当 $D=1$ 时效用为 $u_{TP}$，当 $D=0$ 时效用为 $u_{FP}$。如果警报未发出或发出但未被响应，那么当 $D=1$ 时效用为 $u_{FN}$，当 $D=0$ 时效用为 $u_{TN}=0$。因此，\n\n$$\nJ(t) = r[\\pi \\text{Se}(t) u_{TP} + (1-\\pi)(1-\\text{Sp}(t)) u_{FP}] + \\pi(1 - r \\cdot \\text{Se}(t)) u_{FN}.\n$$\n\n这个目标函数明确地权衡了灵敏度 $\\text{Se}(t)$、特异度 $\\text{Sp}(t)$ 和临床医生效用参数 $(u_{TP},u_{FP},u_{FN})$，并受警报疲劳响应因子 $r$ 的调节。\n\n第2部分：为了从第一性原理推导最优决策规则，考虑一个特定的观测分数值 $x$，并比较以 $x$ 为条件下发出警报与不发出警报的期望效用。令 $a_{1}$ 表示“警报”行动，$a_{0}$ 表示“不警报”行动。根据对疾病状态和响应概率的全期望定律：\n\n- 对于行动 $a_{1}$，警报被发出。临床医生以概率 $r$ 响应，以概率 $1-r$ 不响应。给定 $x$ 的条件期望效用是\n\n$$\nU(a_{1}\\mid x) \\;=\\; r\\left[u_{TP}\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{FP}\\,\\mathbb{P}(D=0\\mid x)\\right] \\;+\\; (1-r)\\left[u_{FN}\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{TN}\\,\\mathbb{P}(D=0\\mid x)\\right].\n$$\n\n在 $u_{TN}=0$ 的情况下，这简化为\n\n$$\nU(a_{1}\\mid x) \\;=\\; r\\left[u_{TP}\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{FP}\\,\\mathbb{P}(D=0\\mid x)\\right] \\;+\\; (1-r)\\,u_{FN}\\,\\mathbb{P}(D=1\\mid x).\n$$\n\n\n- 对于行动 $a_{0}$，没有发出警报，也不可能做出响应。条件期望效用是\n\n$$\nU(a_{0}\\mid x) \\;=\\; u_{FN}\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{TN}\\,\\mathbb{P}(D=0\\mid x) \\;=\\; u_{FN}\\,\\mathbb{P}(D=1\\mid x).\n$$\n\n\n效用差异 $\\Delta U(x) = U(a_{1}\\mid x) - U(a_{0}\\mid x)$ 决定了最优行动：\n\n$$\n\\Delta U(x) \\;=\\; r\\left[u_{TP}\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{FP}\\,\\mathbb{P}(D=0\\mid x)\\right] \\;+\\; (1-r)\\,u_{FN}\\,\\mathbb{P}(D=1\\mid x) \\;-\\; u_{FN}\\,\\mathbb{P}(D=1\\mid x).\n$$\n\n简化包含 $u_{FN}$ 的项得到\n\n$$\n\\Delta U(x) \\;=\\; r\\left[(u_{TP}-u_{FN})\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{FP}\\,\\mathbb{P}(D=0\\mid x)\\right].\n$$\n\n因为 $r \\in (0,1]$，$r$ 是严格为正的，并且不影响 $\\Delta U(x)$ 的符号。因此，最优决策是当且仅当以下条件成立时发出警报：\n\n$$\n(u_{TP}-u_{FN})\\,\\mathbb{P}(D=1\\mid x) \\;+\\; u_{FP}\\,\\mathbb{P}(D=0\\mid x) \\;\\ge\\; 0.\n$$\n\n令 $p(x) = \\mathbb{P}(D=1\\mid x)$，则 $\\mathbb{P}(D=0\\mid x) = 1 - p(x)$。那么\n\n$$\n(u_{TP}-u_{FN}-u_{FP})\\,p(x) \\;\\ge\\; -\\,u_{FP},\n$$\n\n这就得出了一个后验概率阈值\n\n$$\np(x) \\;\\ge\\; \\tau_{p}, \\quad \\text{where} \\quad \\tau_{p} \\;=\\; \\frac{-\\,u_{FP}}{\\,u_{TP}-u_{FN}-u_{FP}\\,}.\n$$\n\n使用贝叶斯法则，用似然比 $\\Lambda(x) = \\frac{f_{X\\mid D=1}(x)}{f_{X\\mid D=0}(x)}$ 和先验概率 $\\pi$ 表示的后验概率为\n\n$$\np(x) \\;=\\; \\frac{\\pi\\,\\Lambda(x)}{\\pi\\,\\Lambda(x) + (1-\\pi)}.\n$$\n\n将其代入 $p(x) \\ge \\tau_{p}$ 并解出 $\\Lambda(x)$，得出似然比阈值\n\n$$\n\\Lambda(x) \\;\\ge\\; \\tau_{\\Lambda}, \\quad \\text{where} \\quad \\tau_{\\Lambda} \\;=\\; \\frac{\\,\\tau_{p}\\,(1-\\pi)\\,}{\\,\\pi\\,(1-\\tau_{p})\\,}.\n$$\n\n在代入 $\\tau_{p}$ 并简化代数运算后，可以得到如下紧凑形式\n\n$$\n\\tau_{\\Lambda} \\;=\\; \\frac{(-u_{FP})(1-\\pi)}{\\pi\\,(u_{TP}-u_{FN})}.\n$$\n\n\n第3部分：对于等方差高斯模型，类条件密度函数为\n\n$$\nf_{X\\mid D=0}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\,\\frac{(x-\\mu_{0})^{2}}{2\\sigma^{2}}\\right), \\quad\nf_{X\\mid D=1}(x) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\,\\frac{(x-\\mu_{1})^{2}}{2\\sigma^{2}}\\right).\n$$\n\n对数似然比为\n\n$$\n\\ln \\Lambda(x) \\;=\\; \\ln \\frac{f_{X\\mid D=1}(x)}{f_{X\\mid D=0}(x)} \\;=\\; -\\,\\frac{(x-\\mu_{1})^{2} - (x-\\mu_{0})^{2}}{2\\sigma^{2}} \\;=\\; \\frac{\\mu_{1}-\\mu_{0}}{\\sigma^{2}}\\,x \\;-\\; \\frac{\\mu_{1}^{2} - \\mu_{0}^{2}}{2\\sigma^{2}}.\n$$\n\n最优阈值 $t^{*}$ 满足 $\\ln \\Lambda(t^{*}) = \\ln \\tau_{\\Lambda}$，因此\n\n$$\n\\frac{\\mu_{1}-\\mu_{0}}{\\sigma^{2}}\\,t^{*} \\;-\\; \\frac{\\mu_{1}^{2} - \\mu_{0}^{2}}{2\\sigma^{2}} \\;=\\; \\ln \\tau_{\\Lambda}.\n$$\n\n解出 $t^{*}$ 得到\n\n$$\nt^{*} \\;=\\; \\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\,\\ln \\tau_{\\Lambda} \\;+\\; \\frac{\\mu_{1}^{2} - \\mu_{0}^{2}}{2(\\mu_{1}-\\mu_{0})}.\n$$\n\n使用 $\\mu_{1}^{2} - \\mu_{0}^{2} = (\\mu_{1}-\\mu_{0})(\\mu_{1}+\\mu_{0})$，这简化为\n\n$$\nt^{*} \\;=\\; \\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\,\\ln \\!\\left(\\frac{(-u_{FP})(1-\\pi)}{\\pi\\,(u_{TP}-u_{FN})}\\right) \\;+\\; \\frac{\\mu_{1}+\\mu_{0}}{2}.\n$$\n\n这个闭式解 $t^{*}$ 通过高斯分离度 $(\\mu_{1}-\\mu_{0})/\\sigma$ 权衡了灵敏度和特异度，并通过对数项包含了临床医生效用和患病率。在所述模型中，响应概率 $r$ 是警报疲劳的一个固定概括值，$r$ 会缩放所实现的期望效用 $J(t)$，但会从最优决策边界本身中消去；如果 $r$ 被建模为通过假阳性率直接依赖于阈值的函数，那么最优的 $t^{*}$ 通常会发生变化，并且不会有相同的闭式解。", "answer": "$$\\boxed{\\frac{\\sigma^{2}}{\\mu_{1}-\\mu_{0}}\\,\\ln\\!\\left(\\frac{(-u_{FP})(1-\\pi)}{\\pi\\,(u_{TP}-u_{FN})}\\right) \\;+\\; \\frac{\\mu_{1}+\\mu_{0}}{2}}$$", "id": "4859214"}]}