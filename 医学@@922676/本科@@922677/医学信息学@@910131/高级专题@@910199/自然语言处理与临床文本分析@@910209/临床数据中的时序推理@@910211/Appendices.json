{"hands_on_practices": [{"introduction": "在处理临床数据时，准确计算时间间隔是一项基本任务。然而，像夏令时（DST）转换这样的本地时钟行为会引入歧义，可能导致持续时间计算错误和数据汇总不准确。本练习[@problem_id:4858960]通过一个跨越DST回拨转换的药物输注场景，强调了为所有时间计算使用单调、明确的时间标准（如协调世界时UTC）的重要性，并训练您识别因忽略时区信息而产生的重复计数风险。", "problem": "一名患者正在接受连续静脉药物输注，其记录保存在电子健康记录中，使用了遵循国际标准化组织（ISO）8601标准的、带有明确时区偏移量的时间戳。输注开始于美国东部时区的夏令时（DST）回拨日，此时区偏移量从东部夏令时（EDT，协调世界时（UTC）偏移量为$-4$）过渡到东部标准时间（EST，UTC偏移量为$-5$）。记录的开始时间戳为 $2024$-$11$-$03$ $01{:}30{:}00$，偏移量为 $-04{:}00$；记录的结束时间戳为 $2024$-$11$-$03$ $02{:}45{:}00$，偏移量为 $-05{:}00$。假设从记录的开始到结束，输注是真正连续且无中断的。\n\n根据时间戳由本地时钟时间和相对于协调世界时（UTC）的时区偏移量组成的定义，并考虑到夏令时回拨转换会重复本地时间从 $01{:}00$ 到 $01{:}59$ 的这一小时，请确定以下内容：\n\n1. 通过将两个时间戳正确地规范化为UTC，计算以分钟为单位的输注真实持续时间。\n2. 在此次输注期间，如果一种朴素的聚合方法仅根据本地时钟标签（例如，小时中的分钟）对分钟级的给药记录进行分箱而忽略时区偏移量，那么会被重复计算的本地时钟分钟数。\n\n将两个量均以分钟表示。将您的最终答案表示为行矩阵 $\\left(\\Delta t_{\\text{true}}, m_{\\text{double}}\\right)$，其中 $\\Delta t_{\\text{true}}$ 是真实持续时间，$m_{\\text{double}}$ 是重复计算的分钟数。请提供精确的整数值，无需四舍五入。", "solution": "问题陈述已经过评估，被认为是有效的。它在科学上基于计时原理，特别是ISO 8601标准和夏令时（DST）的机制。该问题提法恰当，为得出唯一且有意义的解提供了所有必要信息。语言客观而精确。\n\n该问题要求计算与跨越夏令时回拨转换的连续药物输注相关的两个量：真实持续时间，以及被朴素聚合方法重复计算的本地时钟分钟数。\n\n**1. 计算真实持续时间 ($\\Delta t_{\\text{true}}$)**\n\n两个事件之间的真实持续时间与本地时区及其惯例无关。它必须在一个统一的、绝对的时间框架内计算，而协调世界时（UTC）就是这个标准。\n\n给定的时间戳是：\n开始时间戳，$T_{start}$：$2024$-$11$-$03$ $01{:}30{:}00$，偏移量为 $-04{:}00$。这是东部夏令时（EDT）。\n结束时间戳，$T_{end}$：$2024$-$11$-$03$ $02{:}45{:}00$，偏移量为 $-05{:}00$。这是东部标准时间（EST）。\n\n从带偏移量的本地时间转换为UTC的公式为：\n$$T_{UTC} = T_{local} - \\text{offset}$$\n\n首先，我们将开始时间戳转换为UTC。\n本地开始时间是 $T_{start, local} = 01{:}30{:}00$。\n偏移量是 $-04{:}00$ 小时。\n$$T_{start, UTC} = 01{:}30{:}00 - (-04{:}00{:}00) = 01{:}30{:}00 + 04{:}00{:}00 = 05{:}30{:}00 \\text{ UTC}$$\n\n接下来，我们将结束时间戳转换为UTC。\n本地结束时间是 $T_{end, local} = 02{:}45{:}00$。\n偏移量是 $-05{:}00$ 小时。\n$$T_{end, UTC} = 02{:}45{:}00 - (-05{:}00{:}00) = 02{:}45{:}00 + 05{:}00{:}00 = 07{:}45{:}00 \\text{ UTC}$$\n\n真实持续时间 $\\Delta t_{\\text{true}}$ 是UTC结束时间与开始时间之差。\n$$\\Delta t_{\\text{true}} = T_{end, UTC} - T_{start, UTC}$$\n$$\\Delta t_{\\text{true}} = (07 \\text{ 小时}, 45 \\text{ 分钟}) - (05 \\text{ 小时}, 30 \\text{ 分钟})$$\n$$\\Delta t_{\\text{true}} = (7-5) \\text{ 小时} + (45-30) \\text{ 分钟} = 2 \\text{ 小时} + 15 \\text{ 分钟}$$\n要将此持续时间完全以分钟表示：\n$$\\Delta t_{\\text{true}} = (2 \\times 60) \\text{ 分钟} + 15 \\text{ 分钟} = 120 + 15 = 135 \\text{ 分钟}$$\n\n**2. 计算重复计算的分钟数 ($m_{\\text{double}}$)**\n\n在指定日期的夏令时回拨中，本地时钟会重复从 $01{:}00{:}00$ 到 $01{:}59{:}59$ 的这一小时。\n这一小时的第一次出现是在EDT（偏移量为$-04{:}00$）中。我们称之为“EDT时段”。在UTC中，此时间间隔为：\n`01:00:00-04:00` 到 `01:59:59-04:00` $\\implies$ `05:00:00 UTC` 到 `05:59:59 UTC`。\n\n这一小时的第二次出现是在EST（偏移量为$-05{:}00$）中。我们称之为“EST时段”。在UTC中，此时间间隔为：\n`01:00:00-05:00` 到 `01:59:59-05:00` $\\implies$ `06:00:00 UTC` 到 `06:59:59 UTC`。\n\n忽略偏移量的朴素聚合方法会重复计算在输注期间同时出现在EDT时段和EST时段的任何本地分钟标签（例如 `01:45`）。我们必须确定在每个时段中，`01:xx` 这一小时的哪些分钟标签被输注所覆盖。\n\n输注从 $T_{start, UTC} = 05{:}30{:}00$ UTC 持续到 $T_{end, UTC} = 07{:}45{:}00$ UTC。\n\n对于EDT时段（`05:00:00` 到 `05:59:59` UTC）：\n输注从 `05:30:00` UTC 开始，并持续到该时段结束的 `05:59:59` UTC。\n输注覆盖了从 `01:30` EDT 到 `01:59` EDT 的本地时间标签。设 $S_1$ 为此期间小时内分钟数的整数集合。\n$$S_1 = \\{ m \\in \\mathbb{Z} \\mid 30 \\le m \\le 59 \\}$$\n\n对于EST时段（`06:00:00` 到 `06:59:59` UTC）：\n输注从 `05:30:00` UTC 持续到 `07:45:00` UTC。这个时间间隔完全包含了EST时段。\n因此，在第二个时段的整个持续时间内，输注都处于活动状态，覆盖了从 `01:00` EST 到 `01:59` EST 的所有本地时间标签。设 $S_2$ 为此期间小时内分钟数的整数集合。\n$$S_2 = \\{ m \\in \\mathbb{Z} \\mid 0 \\le m \\le 59 \\}$$\n\n重复计算的分钟标签集合 $S_{double}$ 是指在输注期间同时出现在两个时段中的本地分钟标签集合。这对应于集合 $S_1$ 和 $S_2$ 的交集。\n$$S_{double} = S_1 \\cap S_2 = \\{ m \\in \\mathbb{Z} \\mid 30 \\le m \\le 59 \\} \\cap \\{ m \\in \\mathbb{Z} \\mid 0 \\le m \\le 59 \\}$$\n$$S_{double} = \\{ m \\in \\mathbb{Z} \\mid 30 \\le m \\le 59 \\}$$\n\n重复计算的分钟数 $m_{\\text{double}}$ 是该集合的基数。\n$$m_{\\text{double}} = |S_{double}| = 59 - 30 + 1 = 30$$\n\n这两个量是 $\\Delta t_{\\text{true}} = 135$ 分钟和 $m_{\\text{double}} = 30$ 分钟。最终答案应表示为行矩阵 $(\\Delta t_{\\text{true}}, m_{\\text{double}})$。", "answer": "$$\\boxed{\\begin{pmatrix} 135  30 \\end{pmatrix}}$$", "id": "4858960"}, {"introduction": "在临床环境中，事件通常不是瞬间发生的，而是持续一段时间，并且其记录时间可能存在不确定性。为了分析临床工作流程或验证安全规则，我们需要一种形式化的方法来推理这些不确定时间区间之间的关系。本练习[@problem_id:4858941]介绍了Allen's Interval Algebra，这是一个强大的逻辑框架，用于系统地描述和分析具有不确定端点的时间区间之间所有可能的关系，这对于构建可靠的临床决策支持系统至关重要。", "problem": "一家医院使用电子健康记录（EHR）事件日志来研究三个临床时间区间之间的时间关系：抗生素医嘱处理、首次给药起始窗口和血培养采集。时间以分钟为单位记录，相对于医生开具医嘱的时间，该时间点被作为基准时间 $t=0$。由于设备时钟偏差和记录延迟，每个记录的端点都存在有界的时间不确定性。\n\n这些时间区间定义如下。\n\n1. 抗生素医嘱处理区间 $O$：记录的开始时间为 $0$ 分钟，记录的结束时间（药房审核完成）为 $12$ 分钟。每个端点可能与其记录值相差最多 $\\pm 2$ 分钟。因此，真实端点满足 $s_{O} \\in [-2, 2]$ 和 $e_{O} \\in [10, 14]$，且 $s_{O} \\le e_{O}$。\n\n2. 给药起始窗口 $A$：护理记录显示准备工作开始于 $8$ 分钟，输液开始于 $11$ 分钟。每个端点可能相差最多 $\\pm 1$ 分钟。因此，$s_{A} \\in [7, 9]$ 和 $e_{A} \\in [10, 12]$，且 $s_{A} \\le e_{A}$。\n\n3. 血培养采集区间 $C$：记录的采集开始时间为 $5$ 分钟，结束时间为 $8$ 分钟，端点不确定性为 $\\pm 1$ 分钟。因此，$s_{C} \\in [4, 6]$ 和 $e_{C} \\in [7, 9]$，且 $s_{C} \\le e_{C}$。\n\nAllen 区间代数 (AIA) 定义了两个闭区间 $X=[x_{s}, x_{e}]$ 和 $Y=[y_{s}, y_{e}]$（其中 $x_s  x_e$ 和 $y_s  y_e$）之间的 $13$ 种基本关系，这些关系由端点不等式来表征：before (之前，$x_e  y_s$)、meets (相遇，$x_e = y_s$)、overlaps (重叠，$x_s  y_s  x_e  y_e$)、finished by (被完成，$x_s  y_s$ 且 $x_e = y_e$)、contains (包含，$x_s  y_s$ 且 $x_e > y_e$)、starts (开始，$x_s = y_s$ 且 $x_e  y_e$)、equals (相等，$x_s = y_s$ 且 $x_e = y_e$)、started by (被开始，$x_s = y_s$ 且 $x_e > y_e$)、during (之中，$x_s > y_s$ 且 $x_e  y_e$)、finishes (完成，$x_s > y_s$ 且 $x_e = y_e$)、overlapped by (被重叠，$y_s  x_s  y_e  x_e$)、met by (被相遇，$x_s = y_e$) 和 after (之后，$x_s > y_e$)。\n\n在本问题中，“一致” (consistent) 是指，对于两个区间，在其指定的不确定性边界内，存在至少一种真实端点的选择，使得给定的 Allen 关系的定义不等式得以满足。\n\n用于标记矛盾的临床规则：\n- 规则 R1：给药不得在医嘱审核完成前开始，这要求 $e_{O} \\le s_{A}$。用 AIA 术语来说，$O$ 和 $A$ 之间只接受 “before” 或 “meets” 关系。\n- 规则 R2：血培养应在抗生素开始使用前采集，这要求 $e_{C} \\le s_{A}$。用 AIA 术语来说，$C$ 和 $A$ 之间只接受 “before” 或 “meets” 关系。\n\n任务：\n- 确定与每个有序区间对 $(O,A)$、$(O,C)$ 和 $(C,A)$ 的不确定性边界相一致的所有 AIA 基本关系集合 $R_{OA}$、$R_{OC}$ 和 $R_{CA}$。\n- 通过将 $R_{OA}$ 和 $R_{CA}$ 分别与规则 R1 和 R2 进行比较来识别矛盾。矛盾是指 $R_{OA}$ 中任何非 “before” 或 “meets” 的基本关系，以及 $R_{CA}$ 中任何非 “before” 或 “meets” 的基本关系。\n- 令 $K$ 为在 $(O,A)$ 和 $(C,A)$ 中识别出的矛盾基本关系的总数。\n\n计算 $K$。请用实数表示最终答案。无需四舍五入。", "solution": "用户要求我解决一个涉及使用 Allen 区间代数进行时间推理来验证临床工作流程的问题。我将首先验证问题陈述，如果问题有效，则继续进行解答。\n\n### 步骤 1：提取已知信息\n- **基准时间：**医生开具医嘱的时间为 $t=0$ 分钟。\n- **区间 $O$ (抗生素医嘱处理)：**\n  - 记录的开始时间：$0$ 分钟。记录的结束时间：$12$ 分钟。\n  - 不确定性：每个端点 $\\pm 2$ 分钟。\n  - 真实开始端点 $s_O \\in [0-2, 0+2] = [-2, 2]$。\n  - 真实结束端点 $e_O \\in [12-2, 12+2] = [10, 14]$。\n  - 约束条件：$s_O \\leq e_O$。\n\n- **区间 $A$ (给药起始窗口)：**\n  - 记录的开始时间：$8$ 分钟。记录的结束时间：$11$ 分钟。\n  - 不确定性：每个端点 $\\pm 1$ 分钟。\n  - 真实开始端点 $s_A \\in [8-1, 8+1] = [7, 9]$。\n  - 真实结束端点 $e_A \\in [11-1, 11+1] = [10, 12]$。\n  - 约束条件：$s_A \\leq e_A$。\n\n- **区间 $C$ (血培养采集)：**\n  - 记录的开始时间：$5$ 分钟。记录的结束时间：$8$ 分钟。\n  - 不确定性：每个端点 $\\pm 1$ 分钟。\n  - 真实开始端点 $s_C \\in [5-1, 5+1] = [4, 6]$。\n  - 真实结束端点 $e_C \\in [8-1, 8+1] = [7, 9]$。\n  - 约束条件：$s_C \\leq e_C$。\n\n- **Allen 区间代数 (AIA)：** 定义了 13 种基本关系：before, meets, overlaps, finished by, contains, starts, equals, started by, during, finishes, overlapped by, met by, after。问题指定区间 $X = [x_s, x_e]$ 必须满足 $x_s  x_e$。\n\n- **“一致”的定义：** 对于一对区间，如果在其指定的不确定性边界内，存在至少一种对两个区间的真实端点的选择，使得该关系的定义不等式得以满足，则该 AIA 关系是一致的。\n\n- **用于判断矛盾的临床规则：**\n  - **规则 R1：** 对于区间对 $(O, A)$，关系必须是 “before” ($e_O  s_A$) 或 “meets” ($e_O = s_A$)。任何其他一致关系都是矛盾的。\n  - **规则 R2：** 对于区间对 $(C, A)$，关系必须是 “before” ($e_C  s_A$) 或 “meets” ($e_C = s_A$)。任何其他一致关系都是矛盾的。\n\n- **任务：**\n  1. 确定所有一致的 AIA 基本关系集合 $R_{OA}$、$R_{OC}$ 和 $R_{CA}$。\n  2. 基于规则 R1 和 R2 识别矛盾关系。\n  3. 计算 $K$，即矛盾关系的总数。\n\n### 步骤 2：使用提取的已知信息进行验证\n1.  **科学基础：** 该问题基于医学信息学，特别是临床数据中的时间推理，这是一个成熟的子领域。Allen 区间代数是此类推理的标准形式化方法。该场景是现实的。根据此标准，该问题有效。\n2.  **定义良好：** 所有必要的数据（区间、不确定性）、定义（一致性、AIA 关系）和规则都已提供。目标清晰明确。该问题定义良好。\n3.  **客观性：** 语言精确，没有主观陈述。该问题是客观的。\n4.  **自洽与一致性：** 问题提供了所有所需信息。我们来验证区间定义的内部一致性。\n    - 区间 $O$：$s_O \\in [-2, 2]$ 且 $e_O \\in [10, 14]$。由于 $\\max(s_O) = 2  \\min(e_O) = 10$，条件 $s_O  e_O$ 始终满足。\n    - 区间 $A$：$s_A \\in [7, 9]$ 且 $e_A \\in [10, 12]$。由于 $\\max(s_A) = 9  \\min(e_A) = 10$，条件 $s_A  e_A$ 始终满足。\n    - 区间 $C$：$s_C \\in [4, 6]$ 且 $e_C \\in [7, 9]$。由于 $\\max(s_C) = 6  \\min(e_C) = 7$，条件 $s_C  e_C$ 始终满足。\n    问题设置是一致的。\n\n### 步骤 3：结论与行动\n该问题有效。我将继续进行完整解答。\n\n解决方案要求确定每个区间对 $(O,A)$、$(O,C)$ 和 $(C,A)$ 的所有一致的 Allen 区间代数 (AIA) 关系集，然后根据给定的临床规则计算矛盾的数量。如果存在两个区间在其不确定性边界内的一个有效实现满足某个 AIA 关系，则该关系是一致的。\n\n**1. 确定区间对 $(O, A)$ 的一致关系集 $R_{OA}$**\n\n区间为 $O = [s_O, e_O]$，其中 $s_O \\in [-2, 2]$ 和 $e_O \\in [10, 14]$；区间为 $A = [s_A, e_A]$，其中 $s_A \\in [7, 9]$ 和 $e_A \\in [10, 12]$。\n\n我们分析 $O$ 和 $A$ 端点之间的可能关系：\n- $s_O$ 与 $s_A$ 的关系：$\\max(s_O) = 2$ 且 $\\min(s_A) = 7$。由于 $2  7$，我们总是有 $s_O  s_A$。\n- $e_O$ 与 $s_A$ 的关系：$\\min(e_O) = 10$ 且 $\\max(s_A) = 9$。由于 $10 > 9$，我们总是有 $e_O > s_A$。\n- $e_O$ 与 $e_A$ 的关系：$e_O$ 的区间是 $[10, 14]$，$e_A$ 的区间是 $[10, 12]$。这些区间重叠。\n  - 可能存在 $e_O  e_A$。例如，$e_O = 10.5$ 且 $e_A = 11.5$。\n  - 可能存在 $e_O = e_A$。例如，$e_O = e_A = 11$。\n  - 可能存在 $e_O > e_A$。例如，$e_O = 13$ 且 $e_A = 11$。\n\n综合这些发现，我们知道对于任何有效实现，都有 $s_O  s_A  e_O$。必须考虑 $e_A$ 与其他端点的关系来确定 AIA 关系。\n- 如果 $e_O  e_A$：我们有 $s_O  s_A  e_O  e_A$。这种配置对应于 `overlaps` 关系。此关系是一致的。\n- 如果 $e_O = e_A$：我们有 $s_O  s_A$ 和 $e_O = e_A$。这种配置对应于 `finished by` 关系。此关系是一致的。\n- 如果 $e_O > e_A$：我们有 $s_O  s_A$ 和 $e_O > e_A$。鉴于 $s_A  e_A$ 始终成立，完整的顺序是 $s_O  s_A  e_A  e_O$。这对应于 `contains` 关系。此关系是一致的。\n\n任何其他关系都将违反已确立的事实 $s_O  s_A$ 或 $s_A  e_O$。例如，`before` ($e_O  s_A$) 是不可能的。\n因此，$(O, A)$ 的一致关系集是 $R_{OA} = \\{\\text{overlaps, finished by, contains}\\}$。\n\n**2. 确定区间对 $(O, C)$ 的一致关系集 $R_{OC}$**\n\n区间为 $O = [s_O, e_O]$，其中 $s_O \\in [-2, 2]$ 和 $e_O \\in [10, 14]$；区间为 $C = [s_C, e_C]$，其中 $s_C \\in [4, 6]$ 和 $e_C \\in [7, 9]$。\n\n我们分析端点之间的关系：\n- $s_O$ 与 $s_C$ 的关系：$\\max(s_O) = 2$ 且 $\\min(s_C) = 4$。由于 $2  4$，我们总是有 $s_O  s_C$。\n- $e_O$ 与 $e_C$ 的关系：$\\min(e_O) = 10$ 且 $\\max(e_C) = 9$。由于 $10 > 9$，我们总是有 $e_O > e_C$。\n\n对于任何有效的端点选择，条件 $s_O  s_C$ 和 $e_O > e_C$ 总是满足的。这些是 `contains` 关系（$O$ 包含 $C$）的定义不等式。没有其他关系是可能的。\n因此，$(O, C)$ 的一致关系集是 $R_{OC} = \\{\\text{contains}\\}$。\n\n**3. 确定区间对 $(C, A)$ 的一致关系集 $R_{CA}$**\n\n区间为 $C = [s_C, e_C]$，其中 $s_C \\in [4, 6]$ 和 $e_C \\in [7, 9]$；区间为 $A = [s_A, e_A]$，其中 $s_A \\in [7, 9]$ 和 $e_A \\in [10, 12]$。\n\n我们分析端点之间的关系：\n- $s_C$ 与 $s_A$ 的关系：$\\max(s_C) = 6$ 且 $\\min(s_A) = 7$。由于 $6  7$，我们总是有 $s_C  s_A$。\n- $e_C$ 与 $e_A$ 的关系：$\\max(e_C) = 9$ 且 $\\min(e_A) = 10$。由于 $9  10$，我们总是有 $e_C  e_A$。\n- $e_C$ 与 $s_A$ 的关系：$e_C$ 的区间是 $[7, 9]$，$s_A$ 的区间是 $[7, 9]$。这两个区间是相同的。\n  - 可能存在 $e_C  s_A$。例如，$e_C = 7.5$ 且 $s_A = 8.5$。\n  - 可能存在 $e_C = s_A$。例如，$e_C = s_A = 8$。\n  - 可能存在 $e_C > s_A$。例如，$e_C = 8.5$ 且 $s_A = 7.5$。\n\n我们分析可能产生的 AIA 关系：\n- 如果 $e_C  s_A$：这是 `before` 关系（$C$ 在 $A$ 之前）的定义。这是一致的。\n- 如果 $e_C = s_A$：这是 `meets` 关系（$C$ 与 $A$ 相遇）的定义。这是一致的。\n- 如果 $e_C > s_A$：我们有已确立的条件 $s_C  s_A$ 和 $e_C  e_A$。将它们结合起来，得到 $s_C  s_A  e_C  e_A$。这是 `overlaps` 关系的定义。这是一致的。\n\n任何其他关系都将与已确立的事实 $s_C  s_A$ 或 $e_C  e_A$ 相矛盾。\n因此，一致关系集是 $R_{CA} = \\{\\text{before, meets, overlaps}\\}$。\n\n**4. 识别矛盾并计算 $K$**\n\n- **对于 $(O, A)$ 的规则 R1：** 可接受的关系是 `before` 或 `meets`。一致关系集是 $R_{OA} = \\{\\text{overlaps, finished by, contains}\\}$。这些关系都不在可接受的集合中。因此，这三个一致关系都是矛盾的。该区间对的矛盾关系数量为 $3$。\n\n- **对于 $(C, A)$ 的规则 R2：** 可接受的关系是 `before` 或 `meets`。一致关系集是 $R_{CA} = \\{\\text{before, meets, overlaps}\\}$。关系 `before` 和 `meets` 是可接受的。关系 `overlaps` 则不可接受。因此，该区间对有一个矛盾关系。该区间对的矛盾关系数量为 $1$。\n\n- **总矛盾数 $K$：** 矛盾关系的总数是两个规则中矛盾数量的总和。\n$$K = 3 + 1 = 4$$\n矛盾基本关系的总数为 $4$。", "answer": "$$\\boxed{4}$$", "id": "4858941"}, {"introduction": "时间推理的最终目标之一是准确评估干预措施（如治疗）的效果。然而，在分析随时间变化的暴露因素时，一种常见的、微妙的错误称为“不朽时间偏倚”（immortal time bias），它可能导致对治疗效果的严重误判。通过亲手计算和比较正确的（时间依赖的）和错误的（简单的“曾经暴露”）风险比[@problem_id:4858944]，您将深刻理解为何严谨的时间依赖性分析在临床研究中至关重要，以及如何避免得出虚假的疗效结论。", "problem": "一项医学信息学领域的队列研究调查了一种时间依赖性治疗对临床结局瞬时风险的影响。该分析必须尊重治疗开始和结局发生的时间顺序。设瞬时风险函数定义为 $\\lambda(t) = \\lim_{\\Delta t \\to 0} \\frac{\\Pr(t \\leq T  t + \\Delta t \\mid T \\geq t)}{\\Delta t}$，其中 $T$ 是事件时间。在观察到的人时段内风险呈分段恒定的假设下，风险比（HR）可以通过在相应暴露状态下的事件计数与累积人时的比率进行一致性估计（这一近似方法由泊松过程中事件以恒定速率发生的性质所支持）。\n\n一个包含 $6$ 名患者的示例队列从 $t=0$ 天入组开始观察，直至发生临床结局或在 $t=100$ 天时发生管理性删失，以先发生者为准。治疗开始时间、结局时间和删失情况如下（时间单位：天）：\n- 患者 $1$：在 $t=30$ 时开始治疗；在 $t=70$ 时发生结局。\n- 患者 $2$：在 $t=10$ 时开始治疗；在 $t=20$ 时发生结局。\n- 患者 $3$：在 $t=50$ 时开始治疗；在 $t=100$ 时因无结局而被删失。\n- 患者 $4$：从未接受治疗；在 $t=40$ 时发生结局。\n- 患者 $5$：从未接受治疗；在 $t=90$ 时发生结局。\n- 患者 $6$：在 $t=80$ 时开始治疗；在 $t=85$ 时发生结局。\n\n将暴露状态定义为治疗开始前为未暴露，从治疗开始那一刻起为暴露；从未接受治疗的患者在整个随访期间保持未暴露状态。计算两种风险比估计值：\n1. 时间依赖性风险比，其定义是根据人时和事件发生时的实际暴露状态进行分类。\n2. 朴素的曾经暴露风险比，其定义是将任何曾经开始治疗的患者的所有人时和事件从 $t=0$ 到事件发生或删失均归类为暴露，并将从未接受治疗的患者的所有人时和事件归类为未暴露。\n\n然后，计算由朴素的曾经暴露编码引入的风险比的相对偏倚，定义为\n$$B_{\\text{rel}} = \\frac{\\widehat{\\mathrm{HR}}_{\\text{naive}} - \\widehat{\\mathrm{HR}}_{\\text{time-dep}}}{\\widehat{\\mathrm{HR}}_{\\text{time-dep}}}.$$\n以四位有效数字的小数形式给出 $B_{\\text{rel}}$ 的最终值，不带单位。", "solution": "该问题要求从一个小规模队列研究中计算风险比（HR）的两种不同估计值，然后计算这两种估计值之间的相对偏倚。风险比是暴露组的风险率与未暴露组的风险率之比，即 $\\mathrm{HR} = \\frac{\\lambda_1}{\\lambda_0}$。在分段恒定风险的假设下，风险率 $\\lambda$ 可以估计为事件数 $E$ 除以总风险人时 $PT$。因此，风险比的估计值由下式给出：\n$$ \\widehat{\\mathrm{HR}} = \\frac{\\hat{\\lambda}_1}{\\hat{\\lambda}_0} = \\frac{E_1 / PT_1}{E_0 / PT_0} $$\n其中下标 $1$ 表示暴露组，下标 $0$ 表示未暴露组。\n\n首先，我们将计算时间依赖性风险比 $\\widehat{\\mathrm{HR}}_{\\text{time-dep}}$，该方法正确地考虑了暴露状态随时间的变化。其次，我们将计算朴素的曾经暴露风险比 $\\widehat{\\mathrm{HR}}_{\\text{naive}}$，该方法错误地将任何曾经接受治疗的个体在整个随访期间都归类为暴露。\n\n### 1. 计算时间依赖性风险比 ($\\widehat{\\mathrm{HR}}_{\\text{time-dep}}$)\n\n在此分析中，人时在治疗开始前被归类为未暴露，从治疗开始那一刻起被归类为暴露。我们将分析每位患者，以划分他们的随访时间和事件状态。\n\n- **患者 1**：随访时间从 $t=0$ 到 $t=70$ 天。治疗时间点为 $t=30$。\n  - 未暴露人时 ($PT_0$)：$30 - 0 = 30$ 天。\n  - 暴露人时 ($PT_1$)：$70 - 30 = 40$ 天。\n  - 结局在 $t=70$ 时发生，此时患者处于暴露状态。这为暴露组贡献了 $1$ 个事件 ($E_1$）。\n\n- **患者 2**：随访时间从 $t=0$ 到 $t=20$ 天。治疗时间点为 $t=10$。\n  - 未暴露人时 ($PT_0$)：$10 - 0 = 10$ 天。\n  - 暴露人时 ($PT_1$)：$20 - 10 = 10$ 天。\n  - 结局在 $t=20$ 时发生，此时患者处于暴露状态。这为暴露组贡献了 $1$ 个事件 ($E_1$）。\n\n- **患者 3**：随访时间从 $t=0$ 到 $t=100$ 天（删失）。治疗时间点为 $t=50$。\n  - 未暴露人时 ($PT_0$)：$50 - 0 = 50$ 天。\n  - 暴露人时 ($PT_1$)：$100 - 50 = 50$ 天。\n  - 没有发生结局。\n\n- **患者 4**：随访时间从 $t=0$ 到 $t=40$ 天。从未接受治疗。\n  - 未暴露人时 ($PT_0$)：$40 - 0 = 40$ 天。\n  - 暴露人时 ($PT_1$)：$0$ 天。\n  - 结局在 $t=40$ 时发生，此时患者处于未暴露状态。这为未暴露组贡献了 $1$ 个事件 ($E_0$）。\n\n- **患者 5**：随访时间从 $t=0$ 到 $t=90$ 天。从未接受治疗。\n  - 未暴露人时 ($PT_0$)：$90 - 0 = 90$ 天。\n  - 暴露人时 ($PT_1$)：$0$ 天。\n  - 结局在 $t=90$ 时发生，此时患者处于未暴露状态。这为未暴露组贡献了 $1$ 个事件 ($E_0$）。\n\n- **患者 6**：随访时间从 $t=0$ 到 $t=85$ 天。治疗时间点为 $t=80$。\n  - 未暴露人时 ($PT_0$)：$80 - 0 = 80$ 天。\n  - 暴露人时 ($PT_1$)：$85 - 80 = 5$ 天。\n  - 结局在 $t=85$ 时发生，此时患者处于暴露状态。这为暴露组贡献了 $1$ 个事件 ($E_1$）。\n\n现在，我们汇总这些贡献，以获得各组的总事件数和总人时：\n- 未暴露组的总事件数：$E_0 = 1 (\\text{患者 4}) + 1 (\\text{患者 5}) = 2$。\n- 未暴露组的总人时：$PT_0 = 30 + 10 + 50 + 40 + 90 + 80 = 300$ 天。\n- 暴露组的总事件数：$E_1 = 1 (\\text{患者 1}) + 1 (\\text{患者 2}) + 1 (\\text{患者 6}) = 3$。\n- 暴露组的总人时：$PT_1 = 40 + 10 + 50 + 5 = 105$ 天。\n\n时间依赖性风险比的估计值为：\n$$ \\widehat{\\mathrm{HR}}_{\\text{time-dep}} = \\frac{E_1 / PT_1}{E_0 / PT_0} = \\frac{3 / 105}{2 / 300} = \\frac{3}{105} \\times \\frac{300}{2} = \\frac{900}{210} = \\frac{90}{21} = \\frac{30}{7} $$\n\n### 2. 计算朴素的曾经暴露风险比 ($\\widehat{\\mathrm{HR}}_{\\text{naive}}$)\n\n在这种朴素的分析中，患者在 $t=0$ 时被分为两个固定的组。曾经接受治疗的患者（患者 $1, 2, 3, 6$）构成“暴露”组，他们的整个随访时间都计为暴露人时。从未接受治疗的患者（患者 $4, 5$）构成“未暴露”组。\n\n- **未暴露组（患者 4, 5）**：\n  - 事件 ($E_0^{\\text{naive}}$)：患者 $4$ 和患者 $5$ 的结局发生在未暴露期间，所以 $E_0^{\\text{naive}} = 1+1=2$。\n  - 人时 ($PT_0^{\\text{naive}}$)：患者 $4$ 和 $5$ 的总随访时间。$PT_0^{\\text{naive}} = 40 + 90 = 130$ 天。\n\n- **暴露组（患者 1, 2, 3, 6）**：\n  - 事件 ($E_1^{\\text{naive}}$)：患者 $1, 2, 6$ 的结局都计为暴露事件。所以，$E_1^{\\text{naive}} = 1+1+1=3$。\n  - 人时 ($PT_1^{\\text{naive}}$)：患者 $1, 2, 3, 6$ 的总随访时间。$PT_1^{\\text{naive}} = 70 (\\text{患者1}) + 20 (\\text{患者2}) + 100 (\\text{患者3}) + 85 (\\text{患者6}) = 275$ 天。\n\n朴素的风险比估计值为：\n$$ \\widehat{\\mathrm{HR}}_{\\text{naive}} = \\frac{E_1^{\\text{naive}} / PT_1^{\\text{naive}}}{E_0^{\\text{naive}} / PT_0^{\\text{naive}}} = \\frac{3 / 275}{2 / 130} = \\frac{3}{275} \\times \\frac{130}{2} = \\frac{390}{550} = \\frac{39}{55} $$\n这种朴素的方法引入了永生时间偏倚，因为它将最终接受治疗的个体在未暴露期间的人时错误地归类为暴露人时，这人为地夸大了分母 $PT_1^{\\text{naive}}$，并压低了暴露组的估计风险。\n\n### 3. 计算相对偏倚 ($B_{\\text{rel}}$)\n\n相对偏倚定义为：\n$$ B_{\\text{rel}} = \\frac{\\widehat{\\mathrm{HR}}_{\\text{naive}} - \\widehat{\\mathrm{HR}}_{\\text{time-dep}}}{\\widehat{\\mathrm{HR}}_{\\text{time-dep}}} $$\n代入计算出的值：\n$$ B_{\\text{rel}} = \\frac{\\frac{39}{55} - \\frac{30}{7}}{\\frac{30}{7}} = \\frac{\\widehat{\\mathrm{HR}}_{\\text{naive}}}{\\widehat{\\mathrm{HR}}_{\\text{time-dep}}} - 1 $$\n首先，我们计算风险比估计值的比率：\n$$ \\frac{\\widehat{\\mathrm{HR}}_{\\text{naive}}}{\\widehat{\\mathrm{HR}}_{\\text{time-dep}}} = \\frac{39/55}{30/7} = \\frac{39}{55} \\times \\frac{7}{30} = \\frac{273}{1650} $$\n我们可以通过注意到 $39 = 3 \\times 13$ 和 $30 = 3 \\times 10$ 来简化这个分数：\n$$ \\frac{13 \\times 7}{55 \\times 10} = \\frac{91}{550} $$\n现在，我们计算偏倚：\n$$ B_{\\text{rel}} = \\frac{91}{550} - 1 = \\frac{91 - 550}{550} = -\\frac{459}{550} $$\n为了以要求的格式提供答案，我们将此分数转换为小数：\n$$ B_{\\text{rel}} = -\\frac{459}{550} \\approx -0.83454545... $$\n四舍五入到四位有效数字，我们得到 $-0.8345$。这个巨大的负偏倚说明了朴素分类法引入的严重分析错误，在本例中，它错误地将效应的方向从有害（$\\widehat{\\mathrm{HR}}_{\\text{time-dep}} \\approx 4.29$）逆转为看似有保护作用的（$\\widehat{\\mathrm{HR}}_{\\text{naive}} \\approx 0.71$）。", "answer": "$$\\boxed{-0.8345}$$", "id": "4858944"}]}