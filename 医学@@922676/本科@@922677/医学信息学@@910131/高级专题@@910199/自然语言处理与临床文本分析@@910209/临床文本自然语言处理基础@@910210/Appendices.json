{"hands_on_practices": [{"introduction": "将文本分割成句子后，我们常常需要衡量特定术语在文档中的重要性。术语频率-逆文档频率（TF-IDF）是信息检索领域的一项基本技术，它通过数值权重来评估一个词对一篇文档的重要性。通过这个练习，您将亲手计算TF-IDF值，并用它来对临床文档进行排序，从而掌握这一核心概念的实际应用。[@problem_id:4841475]", "problem": "一个临床搜索模块正在开发中，用于索引医院的病程记录，以便查询与呼吸系统疾病相关的术语。考虑一个由 $N$ 篇临床文档组成的语料库，其中 $N=5$，临床术语 $t=$ \"pneumonia\"（肺炎）在按文档标识符 $d=1,2,3,4,5$ 排序的文档中出现的原始计数由向量 $\\left[2,0,1,0,1\\right]$ 给出。术语“pneumonia”（肺炎）至少出现一次的文档数量，也称为文档频率，为 $\\mathrm{df}=3$。从自然语言处理的信息检索中词频和逆文档频率的基本定义出发，将词频视为原始计数 $c(t,d)$，并将逆文档频率定义为语料库大小与文档频率之比的自然对数。使用标准的乘法词频-逆文档频率（TF-IDF）加权方案，计算每个文档的TF-IDF值，并按TF-IDF值从高到低对文档进行排序。最后，确定所有 $N$ 个文档的TF-IDF值之和，并用一个单一的封闭形式解析表达式来表示您的最终答案。仅报告总和；无需四舍五入，也不应包含单位。", "solution": "该问题已根据所需标准进行了验证。\n\n**步骤1：提取已知条件**\n-   一个由 $N$ 篇临床文档组成的语料库，其中 $N=5$。\n-   一个临床术语，$t=$ \"pneumonia\"（肺炎）。\n-   术语 $t$ 在文档 $d=1,2,3,4,5$ 中的原始计数由向量 $\\begin{pmatrix} 2  0  1  0  1 \\end{pmatrix}$ 给出。\n-   该术语的文档频率 $\\mathrm{df}$ 给出为 $\\mathrm{df}=3$。\n-   词频 $\\mathrm{tf}(t,d)$ 的定义是原始计数 $c(t,d)$。\n-   逆文档频率 $\\mathrm{idf}(t)$ 的定义是语料库大小与文档频率之比的自然对数，即 $\\mathrm{idf}(t) = \\ln\\left(\\frac{N}{\\mathrm{df}}\\right)$。\n-   加权方案是标准的乘法词频-逆文档频率（TF-IDF），即 $\\mathrm{tfidf}(t,d) = \\mathrm{tf}(t,d) \\times \\mathrm{idf}(t)$。\n-   最终目标是计算所有 $N$ 个文档的TF-IDF值之和。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题很好地基于自然语言处理（NLP）和信息检索（IR）的基本原理，这些是医学信息学的核心组成部分。词频-逆文档频率（TF-IDF）是一种标准的、成熟的统计度量，用于评估一个词在文集或语料库中的一个文档中的重要性。所提供的TF（作为原始计数）和IDF（使用自然对数）的定义是常用且有效的公式。\n-   **适定性与一致性**：该问题是适定的，为得到唯一解提供了所有必要的数据和定义。已知条件是内部一致的。原始计数向量 $\\begin{pmatrix} 2  0  1  0  1 \\end{pmatrix}$ 表明术语“pneumonia”（肺炎）出现在文档 $1$、$3$ 和 $5$ 中。这意味着该术语出现在 $3$ 个文档中。这与给定的文档频率 $\\mathrm{df}=3$ 相符。\n-   **客观性**：该问题以客观、精确的语言陈述，没有任何主观或基于意见的主张。\n-   **完整性与可行性**：该问题是自包含的，不需要任何外部信息。该场景是临床文本处理中一个简化但现实的应用。\n\n**步骤3：结论与行动**\n该问题被视为有效。将推导解决方案。\n\n**解决方案推导**\n\n该问题要求计算术语 $t=$ \"pneumonia\"（肺炎）在包含 $N=5$ 个文档的语料库中所有文档的 TF-IDF 分数之和。\n\n首先，我们计算术语 $t$ 的逆文档频率（IDF）。问题将IDF定义为：\n$$\n\\mathrm{idf}(t) = \\ln\\left(\\frac{N}{\\mathrm{df}}\\right)\n$$\n我们已知文档总数 $N=5$ 和术语的文档频率 $\\mathrm{df}=3$。将这些值代入公式：\n$$\n\\mathrm{idf}(t) = \\ln\\left(\\frac{5}{3}\\right)\n$$\n对于语料库中的所有文档，术语 $t$ 的这个值是恒定的。\n\n接下来，我们计算术语 $t$ 在每个文档 $d$ 中的词频（TF）。问题指出词频应被视为原始计数 $c(t,d)$。针对文档 $d=1,2,3,4,5$ 的原始计数以向量形式提供：\n-   $c(t,1) = 2$\n-   $c(t,2) = 0$\n-   $c(t,3) = 1$\n-   $c(t,4) = 0$\n-   $c(t,5) = 1$\n因此，每个文档的TF值为 $\\mathrm{tf}(t,1)=2$，$\\mathrm{tf}(t,2)=0$，$\\mathrm{tf}(t,3)=1$，$\\mathrm{tf}(t,4)=0$ 和 $\\mathrm{tf}(t,5)=1$。\n\n现在，我们使用乘法定义 $\\mathrm{tfidf}(t,d) = \\mathrm{tf}(t,d) \\times \\mathrm{idf}(t)$ 来计算每个文档的TF-IDF分数。\n-   对于文档 $d=1$：$\\mathrm{tfidf}(t,1) = \\mathrm{tf}(t,1) \\times \\mathrm{idf}(t) = 2 \\times \\ln\\left(\\frac{5}{3}\\right) = 2 \\ln\\left(\\frac{5}{3}\\right)$\n-   对于文档 $d=2$：$\\mathrm{tfidf}(t,2) = \\mathrm{tf}(t,2) \\times \\mathrm{idf}(t) = 0 \\times \\ln\\left(\\frac{5}{3}\\right) = 0$\n-   对于文档 $d=3$：$\\mathrm{tfidf}(t,3) = \\mathrm{tf}(t,3) \\times \\mathrm{idf}(t) = 1 \\times \\ln\\left(\\frac{5}{3}\\right) = \\ln\\left(\\frac{5}{3}\\right)$\n-   对于文档 $d=4$：$\\mathrm{tfidf}(t,4) = \\mathrm{tf}(t,4) \\times \\mathrm{idf}(t) = 0 \\times \\ln\\left(\\frac{5}{3}\\right) = 0$\n-   对于文档 $d=5$：$\\mathrm{tfidf}(t,5) = \\mathrm{tf}(t,5) \\times \\mathrm{idf}(t) = 1 \\times \\ln\\left(\\frac{5}{3}\\right) = \\ln\\left(\\frac{5}{3}\\right)$\n\n问题还要求按TF-IDF值从高到低对文档进行排序。由于 $\\frac{5}{3}  1$，所以 $\\ln(\\frac{5}{3})  0$。因此，排名由原始计数的大小决定：\n-   排名 1：文档 $1$ (TF-IDF = $2 \\ln(\\frac{5}{3})$)\n-   排名 2 (并列)：文档 $3$ 和文档 $5$ (TF-IDF = $\\ln(\\frac{5}{3})$)\n-   排名 3 (并列)：文档 $2$ 和文档 $4$ (TF-IDF = $0$)\n排名为 $d_1  (d_3=d_5)  (d_2=d_4)$。\n\n最后，我们必须确定所有 $N$ 个文档的TF-IDF值之和。设此和为 $S$。\n$$\nS = \\sum_{d=1}^{5} \\mathrm{tfidf}(t,d)\n$$\n$$\nS = \\mathrm{tfidf}(t,1) + \\mathrm{tfidf}(t,2) + \\mathrm{tfidf}(t,3) + \\mathrm{tfidf}(t,4) + \\mathrm{tfidf}(t,5)\n$$\n代入计算出的值：\n$$\nS = 2 \\ln\\left(\\frac{5}{3}\\right) + 0 + \\ln\\left(\\frac{5}{3}\\right) + 0 + \\ln\\left(\\frac{5}{3}\\right)\n$$\n我们可以提出常数项 $\\mathrm{idf}(t) = \\ln(\\frac{5}{3})$：\n$$\nS = \\left(2 + 0 + 1 + 0 + 1\\right) \\ln\\left(\\frac{5}{3}\\right)\n$$\n系数之和（即原始计数）为 $2+0+1+0+1 = 4$。\n因此，总和为：\n$$\nS = 4 \\ln\\left(\\frac{5}{3}\\right)\n$$\n这就是所要求的总和的封闭形式解析表达式。", "answer": "$$\\boxed{4 \\ln\\left(\\frac{5}{3}\\right)}$$", "id": "4841475"}, {"introduction": "临床自然语言处理的一个主要目标是从非结构化文本中提取结构化信息，如疾病和症状。评估这些命名实体识别（NER）模型的性能至关重要。本练习将引导您区分两种关键的评估指标——词元级（token-level）和实体跨度级（span-level）$F_1$分数，揭示为何选择合适的评估方法对理解模型表现至关重要。[@problem_id:4841429]", "problem": "在一个被分词为 $10$ 个词元的单句上评估一个临床命名实体识别系统：$\\text{Patient}$ $(1)$, $\\text{has}$ $(2)$, $\\text{chest}$ $(3)$, $\\text{pain}$ $(4)$, $\\text{and}$ $(5)$, $\\text{shortness}$ $(6)$, $\\text{of}$ $(7)$, $\\text{breath}$ $(8)$, $\\text{denies}$ $(9)$, $\\text{fever}$ $(10)$。黄金标签对临床问题实体类型使用 Begin–Inside–Outside (BIO) 标注方案，其中 $\\text{B-P}$ 表示问题范围的开始，$\\text{I-P}$ 表示问题范围的内部，$\\text{O}$ 表示任何问题范围之外的词元。词元的黄金 BIO 标签如下：\n$(1)\\ \\text{O},\\ (2)\\ \\text{O},\\ (3)\\ \\text{B-P},\\ (4)\\ \\text{I-P},\\ (5)\\ \\text{O},\\ (6)\\ \\text{B-P},\\ (7)\\ \\text{I-P},\\ (8)\\ \\text{I-P},\\ (9)\\ \\text{O},\\ (10)\\ \\text{B-P}$。\n系统的预测 BIO 标签如下：\n$(1)\\ \\text{B-P},\\ (2)\\ \\text{I-P},\\ (3)\\ \\text{B-P},\\ (4)\\ \\text{I-P},\\ (5)\\ \\text{O},\\ (6)\\ \\text{B-P},\\ (7)\\ \\text{I-P},\\ (8)\\ \\text{O},\\ (9)\\ \\text{O},\\ (10)\\ \\text{B-P}$。\n\n假设遵循以下基于标准信息检索定义的评估约定：\n- 词元级评估将 BIO 标签分配视为每个词元的单标签多分类决策，词元级 $F_{1}$-分数是针对所有 $10$ 个词元的所有 BIO 类别的词元级精确率和词元级召回率的微观平均调和平均值。\n- 范围级评估将每个连续的问题范围视为一个单元，一个预测的范围当且仅当其边界和实体类型与一个黄金范围完全匹配时才被计为正确。范围级 $F_{1}$-分数是根据此句中所有范围的范围级精确率和范围级召回率计算的。\n\n已知有 $7$ 个词元的预测 BIO 标签与黄金标签完全匹配，而只有 $2$ 个预测范围与黄金范围完全匹配。仅以上述定义为基础，计算：\n- 针对 $10$ 个词元的词元级微观平均 $F_{1}$-分数，以及\n- 针对预测范围和黄金范围的范围级完全匹配 $F_{1}$-分数。\n\n将两个 $F_{1}$-分数四舍五入到四位有效数字。以不带单位的小数形式表示最终答案。", "solution": "经评估，该问题是有效的。它在科学上基于自然语言处理评估的原则，问题提法良好，数据充分且一致，并以客观的语言表述。提供的摘要统计数据（“有 $7$ 个词元的预测 BIO 标签与黄金标签完全匹配”和“只有 $2$ 个预测范围与黄金范围完全匹配”）与原始数据一致，证实了问题陈述的自洽性。因此，我们可以着手进行解答。\n\n问题要求计算两个不同的指标：词元级微观平均 $F_{1}$-分数和范围级完全匹配 $F_{1}$-分数。我们将依次处理每一个。\n\n### 第 1 部分：词元级微观平均 $F_{1}$-分数\n\n评估是在词元级别进行的，其中 $N=10$ 个词元中的每一个都被分配一个来自集合 $\\{\\text{B-P, I-P, O}\\}$ 的单一 BIO 标签。这是一个单标签多分类任务。词元级 $F_{1}$-分数被定义为精确率和召回率的微观平均调和平均值。\n\n在微观平均中，我们在计算指标之前，对每个类别的真正例 ($TP$)、假正例 ($FP$) 和假负例 ($FN$) 进行求和。令类别集合为 $C = \\{\\text{B-P, I-P, O}\\}$。\n微观平均精确率 ($P_{micro}$) 由下式给出：\n$$ P_{micro} = \\frac{\\sum_{c \\in C} TP_c}{\\sum_{c \\in C} (TP_c + FP_c)} $$\n微观平均召回率 ($R_{micro}$) 由下式给出：\n$$ R_{micro} = \\frac{\\sum_{c \\in C} TP_c}{\\sum_{c \\in C} (TP_c + FN_c)} $$\n\n对于一个在固定数量项目（词元）上的单标签分类任务，预测的总数等于真实标签的总数，也就是词元的总数 $N$。\n$P_{micro}$ 的分母 $\\sum_{c \\in C} (TP_c + FP_c)$ 代表系统做出的预测总数，即 $N=10$。\n$R_{micro}$ 的分母 $\\sum_{c \\in C} (TP_c + FN_c)$ 代表黄金标准标签的总数，同样是 $N=10$。\n分子 $\\sum_{c \\in C} TP_c$ 是所有类别中被正确分类的词元之和。这也就是预测标签与黄金标签相匹配的词元总数。\n\n问题陈述明确给出了这个数字：“有 $7$ 个词元的预测 BIO 标签与黄金标签完全匹配”。\n令 $N_{correct} = 7$ 为正确分类的词元数， $N_{total} = 10$ 为总词元数。\n\n因此，我们有：\n$$ P_{micro} = \\frac{N_{correct}}{N_{total}} = \\frac{7}{10} = 0.7 $$\n$$ R_{micro} = \\frac{N_{correct}}{N_{total}} = \\frac{7}{10} = 0.7 $$\n\n对于任何每个项目只被分配一个标签的多分类问题，微观平均精确率、召回率和 $F_{1}$-分数都等于总体准确率。\n词元级微观平均 $F_{1}$-分数 ($F_{1,token}$) 是 $P_{micro}$ 和 $R_{micro}$ 的调和平均值：\n$$ F_{1,token} = 2 \\times \\frac{P_{micro} \\times R_{micro}}{P_{micro} + R_{micro}} $$\n由于 $P_{micro} = R_{micro}$，我们有 $F_{1,token} = P_{micro} = R_{micro}$。\n$$ F_{1,token} = 0.7 $$\n按要求四舍五入到四位有效数字，我们得到 $0.7000$。\n\n### 第 2 部分：范围级完全匹配 $F_{1}$-分数\n\n对于范围级评估，我们首先从黄金标签和预测的 BIO 标签中识别出连续的问题范围。一个范围是一个以 `B-P` 标签开始，后跟零个或多个 `I-P` 标签的词元序列。\n\n**黄金范围（真实情况）：**\n黄金标签为：O, O, B-P, I-P, O, B-P, I-P, I-P, O, B-P。\n- `chest pain`：词元 $3$ (`B-P`) 和 $4$ (`I-P`)。\n- `shortness of breath`：词元 $6$ (`B-P`)、$7$ (`I-P`) 和 $8$ (`I-P`)。\n- `fever`：词元 $10$ (`B-P`)。\n所以，有 $3$ 个黄金范围。令 $N_{gold} = 3$。\n\n**预测范围（系统输出）：**\n预测标签为：B-P, I-P, B-P, I-P, O, B-P, I-P, O, O, B-P。\n- `Patient has`：词元 $1$ (`B-P`) 和 $2$ (`I-P`)。\n- `chest pain`：词元 $3$ (`B-P`) 和 $4$ (`I-P`)。\n- `shortness of`：词元 $6$ (`B-P`) 和 $7$ (`I-P`)。\n- `fever`：词元 $10$ (`B-P`)。\n所以，有 $4$ 个预测范围。令 $N_{predicted} = 4$。\n\n现在我们计算范围的真正例 ($TP$)、假正例 ($FP$) 和假负例 ($FN$) 的数量。如果一个预测范围在边界和实体类型上都与一个黄金范围完全匹配，则它是一个真正例。\n\n- **真正例 ($TP$)**：与黄金范围完全匹配的预测范围的数量。\n  - 预测的 `chest pain` (词元 $3$-$4$) 与黄金的 `chest pain` (词元 $3$-$4$) 匹配。这是一个 $TP$。\n  - 预测的 `fever` (词元 $10$) 与黄金的 `fever` (词元 $10$) 匹配。这是第二个 $TP$。\n  - 另外两个预测范围没有与任何黄金范围完全匹配。\n  - 因此，$TP = 2$。这与问题陈述一致：“有 $2$ 个预测范围与黄金范围完全匹配”。\n\n- **假正例 ($FP$)**：不是真正例的预测范围的数量。\n  - $FP = N_{predicted} - TP = 4 - 2 = 2$。\n  - 假正例范围是 `Patient has` (词元 $1$-$2$) 和 `shortness of` (词元 $6$-$7$)。\n\n- **假负例 ($FN$)**：未被任何预测范围匹配的黄金范围的数量。\n  - $FN = N_{gold} - TP = 3 - 2 = 1$。\n  - 假负例范围是 `shortness of breath` (词元 $6$-$8$)。系统的预测 `shortness of` (词元 6-7) 是一个部分匹配，但在完全匹配标准下，它不被算作正确预测，该黄金范围被认为是漏掉的。\n\n有了这些值，我们可以计算范围级精确率 ($P_{span}$) 和召回率 ($R_{span}$)。\n$$ P_{span} = \\frac{TP}{TP + FP} = \\frac{2}{2 + 2} = \\frac{2}{4} = \\frac{1}{2} = 0.5 $$\n$$ R_{span} = \\frac{TP}{TP + FN} = \\frac{2}{2 + 1} = \\frac{2}{3} $$\n\n范围级 $F_{1}$-分数 ($F_{1,span}$) 是 $P_{span}$ 和 $R_{span}$ 的调和平均值：\n$$ F_{1,span} = 2 \\times \\frac{P_{span} \\times R_{span}}{P_{span} + R_{span}} = 2 \\times \\frac{\\frac{1}{2} \\times \\frac{2}{3}}{\\frac{1}{2} + \\frac{2}{3}} $$\n$$ F_{1,span} = 2 \\times \\frac{\\frac{1}{3}}{\\frac{3}{6} + \\frac{4}{6}} = 2 \\times \\frac{\\frac{1}{3}}{\\frac{7}{6}} = 2 \\times \\frac{1}{3} \\times \\frac{6}{7} = \\frac{4}{7} $$\n为了将其表示为四舍五入到四位有效数字的小数：\n$$ F_{1,span} = \\frac{4}{7} \\approx 0.57142857... $$\n四舍五入后得到 $0.5714$。\n\n计算出的两个值为：\n- 词元级微观平均 $F_{1}$-分数：$0.7000$\n- 范围级完全匹配 $F_{1}$-分数：$0.5714$", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.7000  0.5714 \\end{pmatrix} } $$", "id": "4841429"}]}