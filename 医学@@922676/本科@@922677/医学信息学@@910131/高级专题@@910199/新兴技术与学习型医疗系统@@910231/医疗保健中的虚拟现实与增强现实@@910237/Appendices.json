{"hands_on_practices": [{"introduction": "在增强现实（AR）手术引导中，第一步是根据术前医学扫描（如CT或MRI）创建精确的解剖结构三维模型。然而，我们如何量化这个自动生成的模型与真实解剖结构的匹配程度呢？本练习将引导你使用基本的集合论概念来计算评估分割精度的关键指标，例如戴斯系数（Dice coefficient）。理解并计算这些指标对于确保AR系统在临床应用中的安全性和可靠性至关重要。[@problem_id:4863080]", "problem": "一个增强现实（AR）手术引导系统将分割后的解剖结构——左肾包膜——叠加到实时腹腔镜视频上，以辅助外科医生在肾部分切除术中保持安全边界。在医学信息学流程中，分割掩码被表示为体素的二元集合。设预测的AR分割掩码为集合 $P$，金标准掩码（由放射科专家根据术前计算机断层扫描手动勾画）为集合 $G$。对于一个特定病例，通过体积分析观察到以下情况：\n- 预测掩码包含 $|P| = 110{,}000$ 个体素。\n- 金标准掩码包含 $|G| = 120{,}000$ 个体素。\n- 交集包含 $|P \\cap G| = 100{,}000$ 个体素。\n\n使用用于分割的二元分类计数的基本集合论定义，其中真阳性是重叠的体素，假阳性是预测中但不在金标准中的体素，假阴性是金标准中但未被预测的体素，计算该叠加的以下分割性能指标：\n- Dice系数，\n- Jaccard指数，\n- 精确率，\n- 召回率。\n\n将每个指标表示为 $0$ 到 $1$ 之间的无单位小数，并将结果四舍五入至四位有效数字。在最终答案中，按以下顺序报告您的四个指标：Dice、Jaccard、精确率、召回率。此外，在您的推理过程中，从核心定义出发，而不是使用快捷公式或预先记忆的结果，来解释这些值对于AR叠加安全性和可用性的临床相关性。", "solution": "在尝试解答之前，对问题进行验证。\n\n### 第1步：提取已知条件\n- 预测的AR分割掩码是集合 $P$。\n- 金标准掩码是集合 $G$。\n- 预测掩码的大小为 $|P| = 110,000$ 个体素。\n- 金标准掩码的大小为 $|G| = 120,000$ 个体素。\n- 两个掩码交集的大小为 $|P \\cap G| = 100,000$ 个体素。\n- 分类计数的定义：\n  - 真阳性 ($TP$)：重叠的体素。\n  - 假阳性 ($FP$)：预测中但不在金标准中的体素。\n  - 假阴性 ($FN$)：金标准中但未被预测的体素。\n- 要求计算：Dice系数、Jaccard指数、精确率和召回率。\n- 输出格式：保留四位有效数字的小数，按Dice、Jaccard、精确率、召回率的顺序报告。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。它利用了集合论中标准的、形式化定义的感念，并将其应用于医学图像分析领域，这是医学信息学的核心组成部分。所提供的数据内部一致；交集的大小 $|P \\cap G| = 100,000$ 正确地小于或等于单个集合的大小 $|P| = 110,000$ 和 $|G| = 120,000$。该问题是完整的，因为它提供了计算所需指标的所有必要数据。对于解剖亚结构的高分辨率医学扫描，体素计数是符合实际的。问题没有歧义、矛盾或违反科学原理之处。\n\n### 第3步：结论与行动\n问题有效。将提供解答。\n\n### 解答推导\n\n该问题要求基于集合论原理计算分割掩码的四个性能指标。我们首先使用给定的集合 $P$（预测）和 $G$（金标准）来形式化定义真阳性（$TP$）、假阳性（$FP$）和假阴性（$FN$）。\n\n**真阳性**（$TP$）是正确识别为肾包膜一部分的体素。这些是同时存在于预测掩码 $P$ 和金标准掩码 $G$ 中的体素。因此，真阳性的数量是这两个集合交集的基数。\n$$TP = |P \\cap G|$$\n使用给定数据，我们有：\n$$TP = 100,000$$\n\n**假阳性**（$FP$）是错误识别为肾包膜一部分的体素。这些是存在于预测掩码 $P$ 中但不在金标准掩码 $G$ 中的体素。这对应于集合差 $P \\setminus G$。假阳性的数量是该集合差的基数，可以计算为：\n$$FP = |P \\setminus G| = |P| - |P \\cap G|$$\n代入给定值：\n$$FP = 110,000 - 100,000 = 10,000$$\n\n**假阴性**（$FN$）是属于肾包膜但被分割算法漏掉的体素。这些是存在于金标准掩码 $G$ 中但不在预测掩码 $P$ 中的体素。这对应于集合差 $G \\setminus P$。假阴性的数量是该集合差的基数：\n$$FN = |G \\setminus P| = |G| - |P \\cap G|$$\n代入给定值：\n$$FN = 120,000 - 100,000 = 20,000$$\n\n在确定了这些基本量之后，我们现在可以定义和计算每个所需的指标。\n\n**1. Dice系数（Sørensen–Dice指数）**\nDice系数是衡量两个集合空间重叠度的指标。它定义为交集大小的两倍除以两个集合大小之和。\n$$Dice = \\frac{2 |P \\cap G|}{|P| + |G|}$$\n用 $TP$、$FP$ 和 $FN$ 表示，我们可以表达 $|P| = TP + FP$ 和 $|G| = TP + FN$。代入可得：\n$$Dice = \\frac{2 TP}{(TP + FP) + (TP + FN)} = \\frac{2 TP}{2 TP + FP + FN}$$\n使用给定的基数：\n$$Dice = \\frac{2 \\times 100,000}{110,000 + 120,000} = \\frac{200,000}{230,000} = \\frac{20}{23}$$\n作为小数，四舍五入到四位有效数字：\n$$Dice \\approx 0.869565... \\approx 0.8696$$\n\n**2. Jaccard指数（交并比, IoU）**\nJaccard指数是另一个衡量集合相似性的指标，定义为交集的大小除以并集的大小。\n$$Jaccard = \\frac{|P \\cap G|}{|P \\cup G|}$$\n并集的基数由容斥原理给出：$|P \\cup G| = |P| + |G| - |P \\cap G|$。\n用 $TP$、$FP$ 和 $FN$ 表示，并集 $|P \\cup G|$ 代表在至少一个掩码中被标记的所有体素，即 $TP + FP + FN$。\n$$Jaccard = \\frac{TP}{TP + FP + FN}$$\n使用计算出的值：\n$$Jaccard = \\frac{100,000}{100,000 + 10,000 + 20,000} = \\frac{100,000}{130,000} = \\frac{10}{13}$$\n作为小数，四舍五入到四位有效数字：\n$$Jaccard \\approx 0.769230... \\approx 0.7692$$\n\n**3. 精确率（阳性预测值）**\n精确率回答了这样一个问题：“在系统预测为目标组织的所有体素中，有多大比例确实是目标组织？” 它是真阳性与预测为阳性的总数之比。预测为阳性的总数是预测集的大小 $|P|$。\n$$Precision = \\frac{TP}{|P|} = \\frac{TP}{TP + FP}$$\n使用计算出的值：\n$$Precision = \\frac{100,000}{110,000} = \\frac{10}{11}$$\n作为小数，四舍五入到四位有效数字：\n$$Precision \\approx 0.909090... \\approx 0.9091$$\n\n**4. 召回率（灵敏度，真阳性率）**\n召回率回答了这样一个问题：“在所有真实的目标组织体素中，系统正确识别了多大比例？” 它是真阳性与实际为阳性的总数之比。实际为阳性的总数是金标准集的大小 $|G|$。\n$$Recall = \\frac{TP}{|G|} = \\frac{TP}{TP + FN}$$\n使用计算出的值：\n$$Recall = \\frac{100,000}{120,000} = \\frac{10}{12} = \\frac{5}{6}$$\n作为小数，四舍五入到四位有效数字：\n$$Recall \\approx 0.833333... \\approx 0.8333$$\n\n### 指标的临床相关性\n\n- **Dice ($0.8696$) 和 Jaccard ($0.7692$):** 这些指标给出了叠加层几何精度的整体概念。约 $0.87$ 的Dice分数表明空间重叠度良好至优秀。对于AR手术引导系统而言，这对于外科医生的信任度和可用性至关重要。低分则意味着叠加层形状不佳或未对齐，使其变得无用甚至危险。\n- **精确率 ($0.9091$):** 这是一个关键的安全性指标。高精确率意味着AR叠加的假阳性率较低（$FP=10,000$）。当系统高亮显示一个区域时，外科医生可以有信心（本例中为$90.91\\%$）它确实是目标组织。这最大限度地减少了对可能被错误包含在叠加层中的健康非目标结构造成医源性损伤的风险。\n- **召回率 ($0.8333$):** 该指标与叠加层的完整性有关。$0.8333$ 的召回率意味着系统成功识别了$83.33\\%$的真实肾包膜，但漏掉了$16.67\\%$（$FN=20,000$个体素）。对于肾部分切除术，其关键目标是最大限度地保留健康的肾组织，因此这些假阴性非常重要。依赖于叠加层的外科医生可能会在叠加层缺失的区域误以为有安全边界，从而比预期更靠近实际肾脏进行切割。这可能会损害手术的肾单位保留目标。\n\n总之，该AR系统相当精确，降低了切出目标区域外的风险，但其召回率表明它并非完全完整，从而产生了切除位置过分靠近真实边界的风险。高Dice系数表明它总体上是一个非常有用的引导工具，但外科医生必须意识到它可能无法完全代表解剖结构的全部范围。", "answer": "$$\n\\boxed{\\begin{pmatrix} 0.8696 & 0.7692 & 0.9091 & 0.8333 \\end{pmatrix}}\n$$", "id": "4863080"}, {"introduction": "拥有精确的虚拟模型后，下一个关键挑战是将其与系统摄像头所见的真实世界（例如，手术台上的病人）精确对齐或“配准”。本练习介绍了“重投影误差”这一计算机视觉中的基本概念，它是量化这种虚实对齐精度的黄金标准。通过计算该误差，我们可以验证AR引导系统的可靠性，确保虚拟叠加信息能够真正地为外科医生提供可信的指导。[@problem_id:4863100]", "problem": "一个用于增强现实（AR）叠加显示的手术导航系统，依赖于一个已标定的单目相机来配准附着在患者身上的基准标记。在一个验证步骤中，给定相机外参位姿估计和相机内参，并收集了检测到的基准点的二维图像坐标。假设采用无镜头畸变的标准针孔相机模型，计算所有对应点的均方根（RMS）重投影误差。\n\n使用以下数据：\n\n- 相机内参（单位：像素）：$f_x = 1200$, $f_y = 1200$, $c_x = 640$, $c_y = 360$。\n- 相机位姿（从世界坐标到相机坐标的旋转和平移）：\n$$\nR = \\begin{pmatrix}\n0 & -1 & 0 \\\\\n1 & \\phantom{-}0 & 0 \\\\\n0 & \\phantom{-}0 & 1\n\\end{pmatrix}, \\quad\nt = \\begin{pmatrix}\n0.02 \\\\\n-0.01 \\\\\n0.50\n\\end{pmatrix} \\text{ meters.}\n$$\n- 基准三维世界点（单位：米）：\n$\\mathbf{X}_1 = (0.10, 0.00, 0.00)$,\n$\\mathbf{X}_2 = (0.00, 0.10, 0.00)$,\n$\\mathbf{X}_3 = (-0.10, 0.00, 0.00)$,\n$\\mathbf{X}_4 = (0.00, -0.10, 0.00)$。\n- 检测到的二维图像坐标（单位：像素）：\n$\\mathbf{u}_1^{\\text{meas}} = (690, 575)$,\n$\\mathbf{u}_2^{\\text{meas}} = (447, 338)$,\n$\\mathbf{u}_3^{\\text{meas}} = (685, 100)$,\n$\\mathbf{u}_4^{\\text{meas}} = (931, 334)$。\n\n采用基于标准相机几何的以下定义。通过 $\\mathbf{X}_c = R \\mathbf{X}_w + t$ 将每个三维世界点 $\\mathbf{X}_w$ 变换到相机坐标。然后使用归一化坐标 $(x_n, y_n) = (X_c/Z_c, Y_c/Z_c)$ 和像素坐标 $(u, v) = (f_x x_n + c_x, f_y y_n + c_y)$ 投影到图像平面。对于每个对应点，将重投影误差定义为投影像素坐标与测量像素坐标之间的欧几里得距离（以像素为单位）。$N$ 个对应点的均方根重投影误差是欧几里得距离平方的均值的平方根。\n\n使用以上数据计算均方根重投影误差。以像素为单位表示最终答案，并将答案四舍五入到四位有效数字。", "solution": "首先根据既定标准对问题进行验证。\n\n### 步骤1：提取已知条件\n\n- 相机内参（单位：像素）：$f_x = 1200$, $f_y = 1200$, $c_x = 640$, $c_y = 360$。\n- 相机位姿（从世界坐标到相机坐标的旋转和平移）：\n$$\nR = \\begin{pmatrix}\n0 & -1 & 0 \\\\\n1 & \\phantom{-}0 & 0 \\\\\n0 & \\phantom{-}0 & 1\n\\end{pmatrix}, \\quad\nt = \\begin{pmatrix}\n0.02 \\\\\n-0.01 \\\\\n0.50\n\\end{pmatrix} \\text{ meters.}\n$$\n- 基准三维世界点（单位：米）：\n$\\mathbf{X}_1 = (0.10, 0.00, 0.00)$,\n$\\mathbf{X}_2 = (0.00, 0.10, 0.00)$,\n$\\mathbf{X}_3 = (-0.10, 0.00, 0.00)$,\n$\\mathbf{X}_4 = (0.00, -0.10, 0.00)$。\n- 检测到的二维图像坐标（单位：像素）：\n$\\mathbf{u}_1^{\\text{meas}} = (690, 575)$,\n$\\mathbf{u}_2^{\\text{meas}} = (447, 338)$,\n$\\mathbf{u}_3^{\\text{meas}} = (685, 100)$,\n$\\mathbf{u}_4^{\\text{meas}} = (931, 334)$。\n- 定义：\n  - 世界坐标到相机坐标的变换：$\\mathbf{X}_c = R \\mathbf{X}_w + t$。\n  - 投影到归一化图像坐标：$(x_n, y_n) = (X_c/Z_c, Y_c/Z_c)$。\n  - 投影到像素坐标：$(u, v) = (f_x x_n + c_x, f_y y_n + c_y)$。\n  - 重投影误差：投影坐标与测量坐标之间的欧几里得距离。\n  - 均方根重投影误差：$E_{RMS} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} ||\\mathbf{u}_i^{\\text{proj}} - \\mathbf{u}_i^{\\text{meas}}||^2}$。\n\n### 步骤2：使用提取的已知条件进行验证\n\n- **科学依据**：该问题基于标准针孔相机模型，这是计算机视觉和摄影测量学中一个基本且广泛使用的原理。变换和投影方程是正确的，并且是该领域的标准。所提供的相机内参、位姿和点坐标在物理上是合理的。基于增强现实的手术导航是医学信息学中一个有效且重要的应用领域。\n- **适定性**：该问题提供了一套完整的数据和一套清晰、明确的指令来计算一个单一的数值。所有变量都已定义，目标是明确的。存在唯一解，并且可以通过遵循指定的步骤来确定。\n- **客观性**：问题以精确、定量和无偏见的语言陈述。没有主观或基于观点的陈述。\n\n该问题没有表现出验证标准中列出的任何缺陷（例如，科学上不健全、不完整、模糊不清）。\n\n### 步骤3：结论与行动\n\n问题陈述有效。将提供完整的解决方案。\n\n均方根（RMS）重投影误差的计算方法是：使用给定的相机模型和外参将每个三维世界点投影到图像平面上，然后将这些投影坐标与测量的坐标进行比较。\n\n对于每个世界点 $\\mathbf{X}_w = (X_w, Y_w, Z_w)^T$，投影过程包括两个步骤：\n1.  使用旋转矩阵 $R$ 和平移向量 $t$ 将点从世界坐标变换到相机坐标 $\\mathbf{X}_c = (X_c, Y_c, Z_c)^T$：\n    $$ \\mathbf{X}_c = R \\mathbf{X}_w + t $$\n2.  使用相机内参 $f_x, f_y, c_x, c_y$ 将点从相机坐标投影到像素坐标 $\\mathbf{u}^{\\text{proj}} = (u, v)^T$：\n    $$ u = f_x \\frac{X_c}{Z_c} + c_x $$\n    $$ v = f_y \\frac{Y_c}{Z_c} + c_y $$\n\n第 $i$ 个点的重投影误差平方是投影点 $\\mathbf{u}_i^{\\text{proj}} = (u_i, v_i)^T$ 和测量点 $\\mathbf{u}_i^{\\text{meas}} = (u_i^{\\text{meas}}, v_i^{\\text{meas}})^T$ 之间的欧几里得距离的平方：\n$$ e_i^2 = ||\\mathbf{u}_i^{\\text{proj}} - \\mathbf{u}_i^{\\text{meas}}||^2 = (u_i - u_i^{\\text{meas}})^2 + (v_i - v_i^{\\text{meas}})^2 $$\n\n$N$ 个点的均方根重投影误差为：\n$$ E_{\\text{RMS}} = \\sqrt{\\frac{1}{N} \\sum_{i=1}^{N} e_i^2} $$\n\n我们现在对 $N=4$ 个基准点中的每一个应用此过程。\n\n**点 1：** $\\mathbf{X}_1 = (0.10, 0.00, 0.00)^T$\n- 相机坐标：\n$$ \\mathbf{X}_{c,1} = \\begin{pmatrix} 0 & -1 & 0 \\\\ 1 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0.10 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0.10 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ 0.09 \\\\ 0.50 \\end{pmatrix} $$\n- 投影像素坐标：\n$u_1 = 1200 \\times \\frac{0.02}{0.50} + 640 = 1200 \\times 0.04 + 640 = 48 + 640 = 688$\n$v_1 = 1200 \\times \\frac{0.09}{0.50} + 360 = 1200 \\times 0.18 + 360 = 216 + 360 = 576$\n因此，$\\mathbf{u}_1^{\\text{proj}} = (688, 576)$。\n- 误差平方：$\\mathbf{u}_1^{\\text{meas}} = (690, 575)$\n$e_1^2 = (688 - 690)^2 + (576 - 575)^2 = (-2)^2 + 1^2 = 4 + 1 = 5$\n\n**点 2：** $\\mathbf{X}_2 = (0.00, 0.10, 0.00)^T$\n- 相机坐标：\n$$ \\mathbf{X}_{c,2} = \\begin{pmatrix} 0 & -1 & 0 \\\\ 1 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0.00 \\\\ 0.10 \\\\ 0.00 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} -0.10 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} -0.08 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} $$\n- 投影像素坐标：\n$u_2 = 1200 \\times \\frac{-0.08}{0.50} + 640 = 1200 \\times (-0.16) + 640 = -192 + 640 = 448$\n$v_2 = 1200 \\times \\frac{-0.01}{0.50} + 360 = 1200 \\times (-0.02) + 360 = -24 + 360 = 336$\n因此，$\\mathbf{u}_2^{\\text{proj}} = (448, 336)$。\n- 误差平方：$\\mathbf{u}_2^{\\text{meas}} = (447, 338)$\n$e_2^2 = (448 - 447)^2 + (336 - 338)^2 = 1^2 + (-2)^2 = 1 + 4 = 5$\n\n**点 3：** $\\mathbf{X}_3 = (-0.10, 0.00, 0.00)^T$\n- 相机坐标：\n$$ \\mathbf{X}_{c,3} = \\begin{pmatrix} 0 & -1 & 0 \\\\ 1 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} -0.10 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -0.10 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0.02 \\\\ -0.11 \\\\ 0.50 \\end{pmatrix} $$\n- 投影像素坐标：\n$u_3 = 1200 \\times \\frac{0.02}{0.50} + 640 = 1200 \\times 0.04 + 640 = 48 + 640 = 688$\n$v_3 = 1200 \\times \\frac{-0.11}{0.50} + 360 = 1200 \\times (-0.22) + 360 = -264 + 360 = 96$\n因此，$\\mathbf{u}_3^{\\text{proj}} = (688, 96)$。\n- 误差平方：$\\mathbf{u}_3^{\\text{meas}} = (685, 100)$\n$e_3^2 = (688 - 685)^2 + (96 - 100)^2 = 3^2 + (-4)^2 = 9 + 16 = 25$\n\n**点 4：** $\\mathbf{X}_4 = (0.00, -0.10, 0.00)^T$\n- 相机坐标：\n$$ \\mathbf{X}_{c,4} = \\begin{pmatrix} 0 & -1 & 0 \\\\ 1 & 0 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 0.00 \\\\ -0.10 \\\\ 0.00 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0.10 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0.02 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} = \\begin{pmatrix} 0.12 \\\\ -0.01 \\\\ 0.50 \\end{pmatrix} $$\n- 投影像素坐标：\n$u_4 = 1200 \\times \\frac{0.12}{0.50} + 640 = 1200 \\times 0.24 + 640 = 288 + 640 = 928$\n$v_4 = 1200 \\times \\frac{-0.01}{0.50} + 360 = 1200 \\times (-0.02) + 360 = -24 + 360 = 336$\n因此，$\\mathbf{u}_4^{\\text{proj}} = (928, 336)$。\n- 误差平方：$\\mathbf{u}_4^{\\text{meas}} = (931, 334)$\n$e_4^2 = (928 - 931)^2 + (336 - 334)^2 = (-3)^2 + 2^2 = 9 + 4 = 13$\n\n最后，我们计算均方根重投影误差：\n- 误差平方和：\n$$ \\sum_{i=1}^{4} e_i^2 = e_1^2 + e_2^2 + e_3^2 + e_4^2 = 5 + 5 + 25 + 13 = 48 $$\n- 均方误差 (MSE)：\n$$ \\text{MSE} = \\frac{1}{4} \\sum_{i=1}^{4} e_i^2 = \\frac{48}{4} = 12 $$\n- 均方根 (RMS) 误差：\n$$ E_{\\text{RMS}} = \\sqrt{\\text{MSE}} = \\sqrt{12} $$\n为了提供数值答案，我们计算其值并四舍五入到四位有效数字。\n$$ E_{\\text{RMS}} = \\sqrt{12} \\approx 3.4641016... $$\n四舍五入到四位有效数字得到 $3.464$。单位是像素。", "answer": "$$\\boxed{3.464}$$", "id": "4863100"}, {"introduction": "为了在VR/AR中获得舒适且有效的体验，尤其是在像外科手术这样的高风险环境中，低延迟至关重要。“从运动到光子”（motion-to-photon）的延迟过高会导致眩晕和手眼协调性下降。每个系统都必须在显示器刷新率规定的严格“时间预算”内完成一帧的所有计算和渲染任务。本练习模拟了对VR渲染管线的分析，帮助你理解如何计算总延迟，并判断系统是否满足实时性要求，从而避免画面卡顿或抖动。[@problem_id:4863084]", "problem": "一家医院部署了一套虚拟现实手术训练系统，用于教授内窥镜手术。为了最大限度地减少模拟器引起的不适并保持稳定的手眼协调，该系统的目标显示刷新率为 $90\\,\\text{Hz}$，其“从运动到光子”管线由严格串行且无重叠的阶段组成：头戴式显示器惯性传感器读数、头部姿态跟踪更新、场景渲染和显示扫描输出。假设采用单缓冲垂直同步，因此每一帧必须在帧周期内完成所有阶段，以避免错过下一个垂直消隐期。对于一个典型帧，测得的各阶段延迟为：传感器读数 $2\\,\\text{ms}$，跟踪更新 $3\\,\\text{ms}$，渲染 $4\\,\\text{ms}$，以及显示扫描输出 $7\\,\\text{ms}$。\n\n根据定义，帧时间预算等于显示周期 $T$（对于刷新频率 $f$，有 $T = 1/f$），并且“从运动到光子”管线时间是串行阶段延迟的总和，请计算有符号余量\n$$\nS \\equiv T_{\\text{ms}} - L_{\\text{pipeline}},\n$$\n其中 $T_{\\text{ms}}$ 是以毫秒为单位的帧时间预算，$L_{\\text{pipeline}}$ 是以毫秒为单位的总管线延迟。$S$ 的负值意味着管线超出了帧预算，并且需要异步重投影来掩盖此次超时。\n\n提供 $S$ 的值（单位为 $\\text{ms}$），四舍五入到四位有效数字。最终结果以毫秒为单位的实数形式表示。最终答案中不要包含任何解释性文字。", "solution": "首先根据所需标准对问题进行验证。\n\n**步骤 1：提取已知条件**\n- 显示刷新频率: $f = 90\\,\\text{Hz}$\n- 管线阶段是严格串行的。\n- 传感器读数延迟: $L_{\\text{sensor}} = 2\\,\\text{ms}$\n- 跟踪更新延迟: $L_{\\text{tracking}} = 3\\,\\text{ms}$\n- 渲染延迟: $L_{\\text{rendering}} = 4\\,\\text{ms}$\n- 显示扫描输出延迟: $L_{\\text{scanout}} = 7\\,\\text{ms}$\n- 帧时间预算定义: $T = \\frac{1}{f}$\n- 总管线延迟定义: $L_{\\text{pipeline}}$ 是串行阶段延迟的总和。\n- 有符号余量定义: $S \\equiv T_{\\text{ms}} - L_{\\text{pipeline}}$\n- $T_{\\text{ms}}$ 是以毫秒为单位的帧时间预算。\n- $L_{\\text{pipeline}}$ 是以毫秒为单位的总管线延迟。\n- 要求输出: $S$ 的值，单位为 $\\text{ms}$，四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，因为它涉及虚拟现实工程和计算机图形学中的标准概念（刷新率、从运动到光子延迟、帧预算）。所提供的值对于现代VR系统是符合实际的。问题定义明确，为得到唯一解提供了所有必要信息和清晰的定义。语言客观而精确。问题是自洽的、一致的，并且没有违反任何科学或数学原理。\n\n**步骤 3：结论与行动**\n问题有效。将提供解答。\n\n任务是计算VR系统渲染管线的有符号余量 $S$。该值定义为帧时间预算 $T_{\\text{ms}}$ 与总管线延迟 $L_{\\text{pipeline}}$ 之间的差值。\n\n首先，我们计算总管线延迟 $L_{\\text{pipeline}}$。问题陈述管线各阶段是严格串行的，因此它们的延迟相加。各阶段的给定延迟为 $2\\,\\text{ms}$（传感器）、$3\\,\\text{ms}$（跟踪）、$4\\,\\text{ms}$（渲染）和 $7\\,\\text{ms}$（扫描输出）。\n总延迟是这些单独延迟的总和：\n$$\nL_{\\text{pipeline}} = 2\\,\\text{ms} + 3\\,\\text{ms} + 4\\,\\text{ms} + 7\\,\\text{ms}\n$$\n$$\nL_{\\text{pipeline}} = 16\\,\\text{ms}\n$$\n\n接下来，我们计算帧时间预算 $T_{\\text{ms}}$。该预算是与显示器刷新频率 $f$ 相对应的周期。给定频率为 $f = 90\\,\\text{Hz}$。帧周期 $T$ 是频率的倒数：\n$$\nT = \\frac{1}{f} = \\frac{1}{90\\,\\text{Hz}} = \\frac{1}{90}\\,\\text{s}\n$$\n问题要求该时间以毫秒为单位。我们使用换算关系 $1\\,\\text{s} = 1000\\,\\text{ms}$：\n$$\nT_{\\text{ms}} = \\left(\\frac{1}{90}\\right)\\,\\text{s} \\times \\left(\\frac{1000\\,\\text{ms}}{1\\,\\text{s}}\\right) = \\frac{1000}{90}\\,\\text{ms} = \\frac{100}{9}\\,\\text{ms}\n$$\n\n最后，我们使用给定的定义计算有符号余量 $S$：\n$$\nS = T_{\\text{ms}} - L_{\\text{pipeline}}\n$$\n代入计算出的值：\n$$\nS = \\frac{100}{9}\\,\\text{ms} - 16\\,\\text{ms}\n$$\n为了进行减法，我们通分：\n$$\nS = \\left(\\frac{100}{9} - \\frac{16 \\times 9}{9}\\right)\\,\\text{ms} = \\left(\\frac{100 - 144}{9}\\right)\\,\\text{ms} = -\\frac{44}{9}\\,\\text{ms}\n$$\n问题要求答案为实数，并四舍五入到四位有效数字。我们进行除法运算：\n$$\nS = -\\frac{44}{9} \\approx -4.8888... \\,\\text{ms}\n$$\n将此值四舍五入到四位有效数字得到：\n$$\nS \\approx -4.889\\,\\text{ms}\n$$\n负号表示完成管线所需的时间（$16\\,\\text{ms}$）大于单帧预算中可用的时间（约 $11.11\\,\\text{ms}$），从而导致了时间赤字。", "answer": "$$\\boxed{-4.889}$$", "id": "4863084"}]}