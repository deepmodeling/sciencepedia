{"hands_on_practices": [{"introduction": "要解决算法偏见，第一步是学会如何量化它。本练习将指导你完成一项基本任务：基于一个脓毒症预测模型的假设场景，计算三种关键的群体公平性指标。通过这个实践 [@problem_id:4824186]，你将掌握如何从混淆矩阵中推导出人口统计均等、机会均等和预测均等这些指标，并理解它们如何从不同角度捕捉模型的公平性表现。", "problem": "一家医院部署了一种二元分类算法，用于预测$24$小时内脓毒症的发作。该分类器输出一个风险评分，通过设定阈值来产生阳性或阴性预测。考虑两个人口群体 $G_1$ 和 $G_2$，在不同阈值下，其真实的脓毒症患病率是固定的。在每个阈值 $\\tau$ 下，该算法根据真正例 (TP)、假正例 (FP)、真反例 (TN) 和假反例 (FN) 的计数，为每个群体生成如下的混淆矩阵。\n\n在阈值 $\\tau_1$下：\n- 群体 $G_1$：$TP=300$, $FP=120$, $TN=480$, $FN=100$。\n- 群体 $G_2$：$TP=180$, $FP=90$, $TN=810$, $FN=120$。\n\n在阈值 $\\tau_2$下：\n- 群体 $G_1$：$TP=240$, $FP=72$, $TN=528$, $FN=160$。\n- 群体 $G_2$：$TP=135$, $FP=54$, $TN=846$, $FN=165$。\n\n使用选择率（预测为阳性的比例，$(TP+FP)/(\\text{total})$）、真正例率（TPR，灵敏度）$TP/P$（其中$P$为实际阳性数量）、假正例率（FPR）$FP/N$（其中$N$为实际阴性数量）以及阳性预测值（PPV）$TP/(TP+FP)$的正式定义，计算每个阈值下的以下公平性差异指标：\n- 人口统计均等差异（DP difference）：$G_1$ 和 $G_2$ 之间选择率的绝对差值。\n- 均等化赔率差异（EO difference）：$G_1$ 和 $G_2$ 之间 TPR 和 FPR 绝对差值中的较大者。\n- 预测均等差异（PPV difference）：$G_1$ 和 $G_2$ 之间 PPV 的绝对差值。\n\n然后，根据您的计算值，通过比较 $\\tau_1$ 和 $\\tau_2$ 处的数值大小，解释哪个阈值对每种差异的贡献最大。\n\n将所有计算出的差异四舍五入到四位有效数字。将最终数值结果表示为单行矩阵，顺序为 $(\\text{DP at }\\tau_1,\\ \\text{EO at }\\tau_1,\\ \\text{PPV at }\\tau_1,\\ \\text{DP at }\\tau_2,\\ \\text{EO at }\\tau_2,\\ \\text{PPV at }\\tau_2)$。", "solution": "问题陈述经评估有效。它在算法公平性这一成熟领域有科学依据，数学上是适定的，并为分析提供了一套完整、一致且客观的数据和定义。“不同阈值下固定的真实脓毒症患病率”这一核心假设可由所提供的数据验证。对于群体 $G_1$，在阈值 $\\tau_1$ 下，实际阳性数量为 $P_1 = 300+100 = 400$，实际阴性数量为 $N_1 = 120+480 = 600$。在阈值 $\\tau_2$ 下，这些值为 $P_1 = 240+160 = 400$ 和 $N_1 = 72+528 = 600$。对于群体 $G_2$，在 $\\tau_1$ 下，$P_2 = 180+120 = 300$，$N_2 = 90+810 = 900$。在 $\\tau_2$ 下，$P_2 = 135+165 = 300$，$N_2 = 54+846 = 900$。每个群体内的阳性和阴性数量在不同阈值下是恒定的，这证实了问题陈述的内部一致性。我们现在可以开始求解。\n\n该问题要求计算和比较两个人口群体 $G_1$ 和 $G_2$ 在两个不同的分类器阈值 $\\tau_1$ 和 $\\tau_2$ 下的三种公平性差异指标。这些指标是人口统计均等差异、均等化赔率差异和预测均等差异。\n\n首先，我们计算每个群体在每个阈值下的必要性能统计数据。设 $P$ 表示实际阳性总数 ($P=TP+FN$)，$N$ 表示实际阴性总数 ($N=TN+FP$)，$T$ 表示总人口规模 ($T=P+N$)。\n\n**在阈值 $\\tau_1$ 下的分析**\n\n对于群体 $G_1$：\n- 已知：$TP_{1,\\tau_1}=300$, $FP_{1,\\tau_1}=120$, $TN_{1,\\tau_1}=480$, $FN_{1,\\tau_1}=100$。\n- 总人口：$T_{1,\\tau_1} = 300+120+480+100 = 1000$。\n- 实际阳性：$P_1 = 300+100 = 400$。\n- 实际阴性：$N_1 = 120+480 = 600$。\n- 选择率 ($SR$)：$SR_{1,\\tau_1} = \\frac{TP_{1,\\tau_1} + FP_{1,\\tau_1}}{T_{1,\\tau_1}} = \\frac{300+120}{1000} = \\frac{420}{1000} = 0.42$。\n- 真正例率 ($TPR$)：$TPR_{1,\\tau_1} = \\frac{TP_{1,\\tau_1}}{P_1} = \\frac{300}{400} = 0.75$。\n- 假正例率 ($FPR$)：$FPR_{1,\\tau_1} = \\frac{FP_{1,\\tau_1}}{N_1} = \\frac{120}{600} = 0.20$。\n- 阳性预测值 ($PPV$)：$PPV_{1,\\tau_1} = \\frac{TP_{1,\\tau_1}}{TP_{1,\\tau_1}+FP_{1,\\tau_1}} = \\frac{300}{300+120} = \\frac{300}{420} = \\frac{5}{7}$。\n\n对于群体 $G_2$：\n- 已知：$TP_{2,\\tau_1}=180$, $FP_{2,\\tau_1}=90$, $TN_{2,\\tau_1}=810$, $FN_{2,\\tau_1}=120$。\n- 总人口：$T_{2,\\tau_1} = 180+90+810+120 = 1200$。\n- 实际阳性：$P_2 = 180+120 = 300$。\n- 实际阴性：$N_2 = 90+810 = 900$。\n- 选择率 ($SR$)：$SR_{2,\\tau_1} = \\frac{TP_{2,\\tau_1} + FP_{2,\\tau_1}}{T_{2,\\tau_1}} = \\frac{180+90}{1200} = \\frac{270}{1200} = 0.225$。\n- 真正例率 ($TPR$)：$TPR_{2,\\tau_1} = \\frac{TP_{2,\\tau_1}}{P_2} = \\frac{180}{300} = 0.60$。\n- 假正例率 ($FPR$)：$FPR_{2,\\tau_1} = \\frac{FP_{2,\\tau_1}}{N_2} = \\frac{90}{900} = 0.10$。\n- 阳性预测值 ($PPV$)：$PPV_{2,\\tau_1} = \\frac{TP_{2,\\tau_1}}{TP_{2,\\tau_1}+FP_{2,\\tau_1}} = \\frac{180}{180+90} = \\frac{180}{270} = \\frac{2}{3}$。\n\n$\\tau_1$ 下的差异指标：\n- DP 差异：$|\\Delta SR|_{\\tau_1} = |SR_{1,\\tau_1} - SR_{2,\\tau_1}| = |0.42 - 0.225| = 0.195$。四舍五入到四位有效数字为 $0.1950$。\n- EO 差异：$\\max(|\\Delta TPR|_{\\tau_1}, |\\Delta FPR|_{\\tau_1}) = \\max(|0.75 - 0.60|, |0.20 - 0.10|) = \\max(0.15, 0.10) = 0.15$。四舍五入到四位有效数字为 $0.1500$。\n- PPV 差异：$|\\Delta PPV|_{\\tau_1} = |PPV_{1,\\tau_1} - PPV_{2,\\tau_1}| = |\\frac{5}{7} - \\frac{2}{3}| = |\\frac{15-14}{21}| = \\frac{1}{21} \\approx 0.047619$。四舍五入到四位有效数字为 $0.04762$。\n\n**在阈值 $\\tau_2$ 下的分析**\n\n对于群体 $G_1$：\n- 已知：$TP_{1,\\tau_2}=240$, $FP_{1,\\tau_2}=72$, $TN_{1,\\tau_2}=528$, $FN_{1,\\tau_2}=160$。\n- $P_1 = 400$, $N_1=600$, $T_{1,\\tau_2}=1000$。\n- 选择率 ($SR$)：$SR_{1,\\tau_2} = \\frac{240+72}{1000} = \\frac{312}{1000} = 0.312$。\n- 真正例率 ($TPR$)：$TPR_{1,\\tau_2} = \\frac{240}{400} = 0.60$。\n- 假正例率 ($FPR$)：$FPR_{1,\\tau_2} = \\frac{72}{600} = 0.12$。\n- 阳性预测值 ($PPV$)：$PPV_{1,\\tau_2} = \\frac{240}{240+72} = \\frac{240}{312} = \\frac{10}{13}$。\n\n对于群体 $G_2$：\n- 已知：$TP_{2,\\tau_2}=135$, $FP_{2,\\tau_2}=54$, $TN_{2,\\tau_2}=846$, $FN_{2,\\tau_2}=165$。\n- $P_2 = 300$, $N_2=900$, $T_{2,\\tau_2}=1200$。\n- 选择率 ($SR$)：$SR_{2,\\tau_2} = \\frac{135+54}{1200} = \\frac{189}{1200} = 0.1575$。\n- 真正例率 ($TPR$)：$TPR_{2,\\tau_2} = \\frac{135}{300} = 0.45$。\n- 假正例率 ($FPR$)：$FPR_{2,\\tau_2} = \\frac{54}{900} = 0.06$。\n- 阳性预测值 ($PPV$)：$PPV_{2,\\tau_2} = \\frac{135}{135+54} = \\frac{135}{189} = \\frac{5}{7}$。\n\n$\\tau_2$ 下的差异指标：\n- DP 差异：$|\\Delta SR|_{\\tau_2} = |SR_{1,\\tau_2} - SR_{2,\\tau_2}| = |0.312 - 0.1575| = 0.1545$。这已经是四位有效数字。\n- EO 差异：$\\max(|\\Delta TPR|_{\\tau_2}, |\\Delta FPR|_{\\tau_2}) = \\max(|0.60 - 0.45|, |0.12 - 0.06|) = \\max(0.15, 0.06) = 0.15$。四舍五入到四位有效数字为 $0.1500$。\n- PPV 差异：$|\\Delta PPV|_{\\tau_2} = |PPV_{1,\\tau_2} - PPV_{2,\\tau_2}| = |\\frac{10}{13} - \\frac{5}{7}| = |\\frac{70-65}{91}| = \\frac{5}{91} \\approx 0.054945$。四舍五入到四位有效数字为 $0.05495$。\n\n**解释与比较**\n\n- **人口统计均等 (DP) 差异**：在 $\\tau_1$ 下，DP 差异为 $0.1950$。在 $\\tau_2$ 下，为 $0.1545$。由于 $0.1950  0.1545$，阈值 $\\tau_1$ 对选择率的差异贡献最大。这表明在更宽松的阈值 $\\tau_1$ 下，两组之间阳性预测的总体比例更加不平衡。\n\n- **均等化赔率 (EO) 差异**：在 $\\tau_1$ 和 $\\tau_2$ 下，EO 差异均为 $0.1500$。在这两种情况下，这个最大差异都源于真正例率的差异 ($|\\Delta TPR| = 0.15$)，而非假正例率。就此指标而言，没有哪个阈值明显更好或更差；它们都表现出相同水平的差异。\n\n- **预测均等 (PPV) 差异**：在 $\\tau_1$ 下，PPV 差异为 $0.04762$。在 $\\tau_2$ 下，为 $0.05495$。由于 $0.05495  0.04762$，阈值 $\\tau_2$ 对阳性预测值的差异贡献最大。这意味着在更严格的阈值 $\\tau_2$ 下，对于收到阳性预测的患者实际患有脓毒症的概率，两组之间的差异更大。\n\n最终结果按要求汇编成一个单行矩阵。\n这些值为：\n$\\tau_1$ 下的 DP: $0.1950$\n$\\tau_1$ 下的 EO: $0.1500$\n$\\tau_1$ 下的 PPV: $0.04762$\n$\\tau_2$ 下的 DP: $0.1545$\n$\\tau_2$ 下的 EO: $0.1500$\n$\\tau_2$ 下的 PPV: $0.05495$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1950  0.1500  0.04762  0.1545  0.1500  0.05495\n\\end{pmatrix}\n}\n$$", "id": "4824186"}, {"introduction": "当我们面对多个患者群体时，如何综合评估模型的整体公平性呢？简单的指标聚合可能会掩盖重要信息。这个练习 [@problem_id:4824189] 旨在探讨宏平均 (macro-averaging) 和微平均 (micro-averaging) 两种聚合方法的差异及其对公平性评估的影响。通过计算和比较，你将深入理解不同规模的子群体如何影响最终的公平性结论，这对于在现实世界中处理不均衡数据至关重要。", "problem": "一个医院系统部署了一个二元分类器来触发早期败血症警报。该系统的性能在三个互斥的患者群体（$A$、$B$ 和 $C$）中进行了公平性审计。审计的重点是均等机会率，其定义为真正率 (TPR)，其中真正率 (TPR) 为 $TPR = \\frac{\\text{真正例 (TP)}}{\\text{真正例 (TP)} + \\text{假负例 (FN)}}$。系统记录了为期一个月的以下混淆矩阵计数：\n\n- 组 $A$：$TP = 160$, $FN = 40$, $FP = 90$, $TN = 510$；总样本量 $800$，其中实际正例 $200$，实际负例 $600$。\n- 组 $B$：$TP = 54$, $FN = 36$, $FP = 18$, $TN = 42$；总样本量 $150$，其中实际正例 $90$，实际负例 $60$。\n- 组 $C$：$TP = 18$, $FN = 12$, $FP = 2$, $TN = 18$；总样本量 $50$，其中实际正例 $30$，实际负例 $20$。\n\n考虑两种用于汇总各组均等机会率的标准聚合方案：宏平均和微平均。宏平均定义为各组特定比率的算术平均值。微平均的定义是首先将各组的计数汇集起来，然后基于汇集后的计数计算比率。令 $\\Delta$ 表示宏平均均等机会率与微平均均等机会率之间的带符号差值，\n$$\n\\Delta = \\text{宏平均 TPR} - \\text{微平均 TPR}。\n$$\n仅使用所提供的计数计算 $\\Delta$。在您的推理中，请解释相对的组规模如何影响聚合过程，以及寻求各组间 TPR 均等的公平性均等约束。将 $\\Delta$ 的最终数值答案四舍五入到四位有效数字。无需单位。", "solution": "对问题陈述进行验证。\n\n**步骤 1：提取已知条件**\n-   患者群体：$A$, $B$, $C$ (互斥)。\n-   公平性指标：均等机会率，定义为真正率 (TPR)。\n-   TPR 定义：$TPR = \\frac{\\text{真正例 (TP)}}{\\text{真正例 (TP)} + \\text{假负例 (FN)}}$。\n-   混淆矩阵计数：\n    -   组 $A$：$TP_A = 160$, $FN_A = 40$, $FP_A = 90$, $TN_A = 510$。\n    -   组 $B$：$TP_B = 54$, $FN_B = 36$, $FP_B = 18$, $TN_B = 42$。\n    -   组 $C$：$TP_C = 18$, $FN_C = 12$, $FP_C = 2$, $TN_C = 18$。\n-   聚合定义：\n    -   宏平均：各组特定比率的算术平均值。\n    -   微平均：基于汇集后的计数计算比率。\n-   待计算量：$\\Delta = \\text{宏平均 TPR} - \\text{微平均 TPR}$。\n-   最终指令：将 $\\Delta$ 的数值答案四舍五入到四位有效数字。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，采用了机器学习公平性和模型评估领域的标准、明确定义的指标（TPR、宏/微平均）。所提供的数据是完整的且内部一致；对于每个组，TP、FN、FP 和 TN 的总和等于给定的总样本量，TP 和 FN 的总和等于给定的实际正例数。该问题是适定的，所有必要信息和清晰的定义导向一个唯一的、可计算的解。语言客观而精确。\n\n**步骤 3：结论与行动**\n问题有效。现在开始求解过程。\n\n核心任务是计算宏平均和微平均的真正率 (TPR)，并求出它们的差值 $\\Delta$。\n\n首先，我们单独计算每个组的 TPR。组 $i$ 的 TPR 由以下公式给出：\n$$\nTPR_i = \\frac{TP_i}{TP_i + FN_i}\n$$\n其中 $TP_i$ 是组 $i$ 的真正例数，$FN_i$ 是组 $i$ 的假负例数。分母 $TP_i + FN_i$ 代表组 $i$ 中的实际正例总数。\n\n对于组 $A$：\n$$\nTPR_A = \\frac{TP_A}{TP_A + FN_A} = \\frac{160}{160 + 40} = \\frac{160}{200} = 0.8\n$$\n\n对于组 $B$：\n$$\nTPR_B = \\frac{TP_B}{TP_B + FN_B} = \\frac{54}{54 + 36} = \\frac{54}{90} = 0.6\n$$\n\n对于组 $C$：\n$$\nTPR_C = \\frac{TP_C}{TP_C + FN_C} = \\frac{18}{18 + 12} = \\frac{18}{30} = 0.6\n$$\n\n接下来，我们计算宏平均 TPR。宏平均计算各个组 TPR 的简单算术平均值。它给予每个组的性能相同的权重，而不管组的大小。\n$$\n\\text{宏平均 TPR} = \\frac{TPR_A + TPR_B + TPR_C}{3} = \\frac{0.8 + 0.6 + 0.6}{3} = \\frac{2.0}{3}\n$$\n\n现在，我们计算微平均 TPR。微平均在计算指标前，先将所有组的计数聚合起来。这给予每个独立观察（在此案例中是每个阳性患者病例）相同的权重。\n我们首先汇集所有组的真正例和假负例：\n$$\nTP_{\\text{total}} = TP_A + TP_B + TP_C = 160 + 54 + 18 = 232\n$$\n$$\nFN_{\\text{total}} = FN_A + FN_B + FN_C = 40 + 36 + 12 = 88\n$$\n然后使用这些汇集后的计数来计算微平均 TPR：\n$$\n\\text{微平均 TPR} = \\frac{TP_{\\text{total}}}{TP_{\\text{total}} + FN_{\\text{total}}} = \\frac{232}{232 + 88} = \\frac{232}{320}\n$$\n化简分数：\n$$\n\\frac{232}{320} = \\frac{116}{160} = \\frac{58}{80} = \\frac{29}{40} = 0.725\n$$\n\n最后，我们计算 $\\Delta$，即宏平均 TPR 与微平均 TPR 之间的带符号差值。\n$$\n\\Delta = \\text{宏平均 TPR} - \\text{微平均 TPR} = \\frac{2}{3} - \\frac{29}{40}\n$$\n为了进行分数减法，我们找到一个公分母，即 $120$：\n$$\n\\Delta = \\frac{2 \\times 40}{3 \\times 40} - \\frac{29 \\times 3}{40 \\times 3} = \\frac{80}{120} - \\frac{87}{120} = -\\frac{7}{120}\n$$\n将此分数转换为小数：\n$$\n\\Delta = -7 \\div 120 \\approx -0.058333...\n$$\n问题要求将结果四舍五入到四位有效数字。前四位有效数字是 $5$、$8$、$3$ 和 $3$。第五位有效数字是 $3$，小于 $5$，因此我们不向上取整。\n$$\n\\Delta \\approx -0.05833\n$$\n\n**结果解读**\n均等机会率的公平性约束要求所有组的 TPR 相等。在本例中，我们观察到差异：$TPR_A = 0.8$，而 $TPR_B = TPR_C = 0.6$。分类器对组 $A$ 的表现更好。\n\n宏平均与微平均之间的差值 $\\Delta$ 提供了有用的信息。宏平均将每个组视为一个单一实体，因此最终得分是各组性能的平均值 ($\\frac{0.8+0.6+0.6}{3} \\approx 0.667$)。微平均则根据每个组中“正例”类别的个体数量来加权性能。组 $A$ 的正例数是 $200$，组 $B$ 是 $90$，组 $C$ 是 $30$。拥有最高 TPR ($0.8$) 的组 $A$ 同时拥有最多的正例（总共 $320$ 例中的 $200$ 例）。因此，微平均值严重偏向组 $A$ 的较高性能，导致其值 ($0.725$) 高于宏平均值。\n\n$\\Delta$ 为负值这一事实表明宏平均小于微平均。这揭示了拥有最多正例的群体（组 $A$）也是分类器性能表现最好的群体。如果最大的群体性能最差，那么 $\\Delta$ 将为正值。因此，$\\Delta$ 的符号和大小可以作为性能差异与子群体规模如何相关的指标。", "answer": "$$\n\\boxed{-0.05833}\n$$", "id": "4824189"}, {"introduction": "仅仅衡量偏见是不够的，我们还需要知道如何去修正它。本练习将从分析转向实践，指导你应用一种常见的偏见缓解技术——后处理。在这个假设场景中 [@problem_id:4824199]，你将学习如何通过为不同群体设置特定的决策阈值来主动实施“均等化赔率” (equalized odds) 这一公平性标准。这个过程清晰地展示了如何从技术上干预，以提升算法的公正性。", "problem": "一家医院部署了一个风险评分模型，该模型输出一个连续的风险评分 $R \\in [0,1]$，用于在两个敏感群体 $A \\in \\{0,1\\}$ 中预测 $Y \\in \\{0,1\\}$（其中 $Y=1$ 表示真阳性状况）。您的任务是通过为决策规则选择特定群体的阈值 $\\tau_{a}$ 来对模型进行后处理，该决策规则预测 $\\hat{Y}=1$ 当且仅当 $R \\ge \\tau_{a}$，以强制实现均等化赔率。均等化赔率要求真阳性率和假阳性率在不同群体之间相等。\n\n给定以下通过累积分布函数 (CDF) $F_{a,y}(r) = \\Pr(R \\le r \\mid A=a, Y=y)$ 表示的风险评分的科学校准条件分布：\n\n- 对于群体 $A=0$：\n  - 阳性 $Y=1$：$F_{0,1}(r) = r$，对于 $r \\in [0,1]$。\n  - 阴性 $Y=0$：$F_{0,0}(r) = r$，对于 $r \\in [0,1]$。\n\n- 对于群体 $A=1$：\n  - 阳性 $Y=1$：$F_{1,1}(r) = r$，对于 $r \\in [0,1]$。\n  - 阴性 $Y=0$：$F_{1,0}(r) = 0$，对于 $r  0.2$；$F_{1,0}(r) = \\dfrac{r - 0.2}{0.7}$，对于 $r \\in [0.2, 0.9]$；以及 $F_{1,0}(r) = 1$，对于 $r \\ge 0.9$。\n\n假设 $\\Pr(A=0)=0.6$，$\\Pr(A=1)=0.4$，$\\Pr(Y=1 \\mid A=0)=0.3$，以及 $\\Pr(Y=1 \\mid A=1)=0.2$。同时假设由于连续性，在恰好 $R=\\tau_{a}$ 处的平局概率为零，因此可以忽略。\n\n仅使用真阳性率和假阳性率的第一性原理定义以及提供的累积分布函数，确定强制实现均等化赔率的阈值 $\\tau_{0}$ 和 $\\tau_{1}$。然后计算在这些阈值下，后处理分类器的最终总体准确率 $\\Pr(\\hat{Y}=Y)$。\n\n将您的最终答案表示为单个精确分数（不要四舍五入，也不要使用百分号）。", "solution": "### 步骤 1：提取已知信息\n问题提供了以下数据和定义：\n- 风险评分 $R \\in [0,1]$。\n- 二元结果 $Y \\in \\{0,1\\}$，其中 $Y=1$ 是阳性状况。\n- 敏感属性 $A \\in \\{0,1\\}$。\n- 决策规则：$\\hat{Y}=1$ 当且仅当 $R \\ge \\tau_{a}$，其中 $\\tau_a$ 是特定群体的阈值。\n- 均等化赔率的约束：真阳性率 (TPR) 和假阳性率 (FPR) 在群体 $A=0$ 和 $A=1$ 之间必须相等。\n- 累积分布函数 (CDF) $F_{a,y}(r) = \\Pr(R \\le r \\mid A=a, Y=y)$：\n  - 对于群体 $A=0$：\n    - 阳性 ($Y=1$): $F_{0,1}(r) = r$，对于 $r \\in [0,1]$。\n    - 阴性 ($Y=0$): $F_{0,0}(r) = r$，对于 $r \\in [0,1]$。\n  - 对于群体 $A=1$：\n    - 阳性 ($Y=1$): $F_{1,1}(r) = r$，对于 $r \\in [0,1]$。\n    - 阴性 ($Y=0$): $F_{1,0}(r)$ 是一个分段函数：\n      $$ F_{1,0}(r) = \\begin{cases} 0  \\text{for } r  0.2 \\\\ \\frac{r - 0.2}{0.7}  \\text{for } r \\in [0.2, 0.9] \\\\ 1  \\text{for } r \\ge 0.9 \\end{cases} $$\n- 先验概率：\n  - $\\Pr(A=0) = 0.6$\n  - $\\Pr(A=1) = 0.4$\n  - $\\Pr(Y=1 \\mid A=0) = 0.3$\n  - $\\Pr(Y=1 \\mid A=1) = 0.2$\n- 在阈值处的平局概率为零，$\\Pr(R=\\tau_a)=0$。\n\n### 步骤 2：使用提取的已知信息进行验证\n问题具有科学依据，使用了机器学习公平性领域的标准概念（风险评分、阈值、均等化赔率）。所提供的累积分布函数在数学上是良定义的，并且给出了所有必要的概率。问题是自包含的、一致的且适定的。它要求根据明确的标准确定阈值，并计算一个标准的性能指标（准确率）。没有明显的违反科学原理、逻辑不一致或含糊不清之处。该问题被认为是有效的。\n\n### 步骤 3：形式化 TPR 和 FPR\n群体 $a$ 的真阳性率 (TPR) 是在状况存在的情况下，做出正确阳性预测的概率。\n$$ TPR_a = \\Pr(\\hat{Y}=1 \\mid A=a, Y=1) = \\Pr(R \\ge \\tau_a \\mid A=a, Y=1) $$\n由于风险评分 $R$ 是一个连续变量，$\\Pr(R \\ge \\tau_a) = 1 - \\Pr(R  \\tau_a) = 1 - \\Pr(R \\le \\tau_a)$。因此，我们可以使用给定的累积分布函数来表示 TPR：\n$$ TPR_a = 1 - F_{a,1}(\\tau_a) $$\n群体 $a$ 的假阳性率 (FPR) 是在状况不存在的情况下，做出错误阳性预测的概率。\n$$ FPR_a = \\Pr(\\hat{Y}=1 \\mid A=a, Y=0) = \\Pr(R \\ge \\tau_a \\mid A=a, Y=0) = 1 - F_{a,0}(\\tau_a) $$\n\n### 步骤 4：应用均等化赔率约束\n均等化赔率要求 TPR 和 FPR 在不同群体之间都相等：\n1. $TPR_0 = TPR_1$\n2. $FPR_0 = FPR_1$\n\n使用步骤 3 中的定义，我们为阈值 $\\tau_0$ 和 $\\tau_1$ 建立一个方程组。\n由 $TPR_0 = TPR_1$：\n$$ 1 - F_{0,1}(\\tau_0) = 1 - F_{1,1}(\\tau_1) \\implies F_{0,1}(\\tau_0) = F_{1,1}(\\tau_1) $$\n代入给定的 CDF，$F_{0,1}(r) = r$ 和 $F_{1,1}(r) = r$：\n$$ \\tau_0 = \\tau_1 $$\n这表明，为了满足 TPR 相等的条件，两个群体的阈值必须相同。我们用 $\\tau$ 表示这个公共阈值，因此 $\\tau = \\tau_0 = \\tau_1$。\n\n现在，我们使用第二个条件，$FPR_0 = FPR_1$：\n$$ 1 - F_{0,0}(\\tau_0) = 1 - F_{1,0}(\\tau_1) \\implies F_{0,0}(\\tau_0) = F_{1,0}(\\tau_1) $$\n代入公共阈值 $\\tau$ 和给定的 CDF，$F_{0,0}(r) = r$ 以及分段函数 $F_{1,0}(r)$：\n$$ \\tau = F_{1,0}(\\tau) $$\n我们必须使用 $F_{1,0}(\\tau)$ 的分段定义来解这个关于 $\\tau \\in [0,1]$ 的方程。\n\n情况 1：$\\tau  0.2$。方程为 $\\tau = 0$。这是在此范围内的有效解。\n\n情况 2：$\\tau \\in [0.2, 0.9]$。方程为 $\\tau = \\frac{\\tau - 0.2}{0.7}$。\n$$ 0.7\\tau = \\tau - 0.2 $$\n$$ 0.2 = 0.3\\tau $$\n$$ \\tau = \\frac{0.2}{0.3} = \\frac{2}{3} $$\n值 $\\tau = 2/3 \\approx 0.667$ 位于区间 $[0.2, 0.9]$ 内，因此这是一个有效的解。\n\n情况 3：$\\tau \\ge 0.9$。方程为 $\\tau = 1$。这是在此范围内的有效解。\n\n我们得到了公共阈值 $\\tau$ 的三个可能值：$0$、$2/3$ 和 $1$。解 $\\tau=0$（对所有样本预测 $\\hat{Y}=1$）和 $\\tau=1$（对所有样本预测 $\\hat{Y}=0$，因为 $R \\in [0,1]$ 是连续的）是分类器不区分数据的平凡解。产生非常数预测器的非平凡解是 $\\tau = 2/3$。我们采用这个解，这是此类问题的标准做法。\n因此，所选的阈值为 $\\tau_0 = 2/3$ 和 $\\tau_1 = 2/3$。\n\n### 步骤 5：计算总体准确率\n总体准确率是 $\\Pr(\\hat{Y}=Y)$。我们可以使用全概率公式，对所有子群体求和来计算。\n$$ \\text{Accuracy} = \\Pr(\\hat{Y}=Y) = \\sum_{a \\in \\{0,1\\}} \\sum_{y \\in \\{0,1\\}} \\Pr(\\hat{Y}=Y, A=a, Y=y) $$\n这可以展开为：\n$$ \\text{Accuracy} = \\sum_{a \\in \\{0,1\\}} \\sum_{y \\in \\{0,1\\}} \\Pr(\\hat{Y}=Y \\mid A=a, Y=y) \\Pr(A=a, Y=y) $$\n各项是：\n- $\\Pr(\\hat{Y}=1 \\mid A=a, Y=1) = TPR_a$\n- $\\Pr(\\hat{Y}=0 \\mid A=a, Y=0) = TNR_a = 1-FPR_a$\n\n首先，我们计算联合概率 $\\Pr(A=a, Y=y) = \\Pr(Y=y \\mid A=a)\\Pr(A=a)$。\n- $\\Pr(A=0, Y=1) = \\Pr(Y=1|A=0)\\Pr(A=0) = 0.3 \\times 0.6 = 0.18 = \\frac{18}{100} = \\frac{9}{50}$\n- $\\Pr(A=0, Y=0) = (1-0.3) \\times 0.6 = 0.7 \\times 0.6 = 0.42 = \\frac{42}{100} = \\frac{21}{50}$\n- $\\Pr(A=1, Y=1) = \\Pr(Y=1|A=1)\\Pr(A=1) = 0.2 \\times 0.4 = 0.08 = \\frac{8}{100} = \\frac{2}{25}$\n- $\\Pr(A=1, Y=0) = (1-0.2) \\times 0.4 = 0.8 \\times 0.4 = 0.32 = \\frac{32}{100} = \\frac{8}{25}$\n\n接下来，我们计算在 $\\tau = 2/3$ 时每个群体的 TPR 和 TNR。\n对于群体 $A=0$：\n- $TPR_0 = 1 - F_{0,1}(\\tau_0) = 1 - F_{0,1}(2/3) = 1 - 2/3 = 1/3$。\n- $FPR_0 = 1 - F_{0,0}(\\tau_0) = 1 - F_{0,0}(2/3) = 1 - 2/3 = 1/3$。\n- $TNR_0 = 1 - FPR_0 = 1 - 1/3 = 2/3$。\n\n对于群体 $A=1$：\n- $TPR_1 = 1 - F_{1,1}(\\tau_1) = 1 - F_{1,1}(2/3) = 1 - 2/3 = 1/3$。\n- $FPR_1 = 1 - F_{1,0}(\\tau_1) = 1 - F_{1,0}(2/3) = 1 - \\frac{2/3 - 0.2}{0.7} = 1 - \\frac{2/3 - 1/5}{7/10} = 1 - \\frac{(10-3)/15}{7/10} = 1 - \\frac{7/15}{7/10} = 1 - \\frac{7}{15} \\times \\frac{10}{7} = 1 - \\frac{10}{15} = 1 - 2/3 = 1/3$。\n- $TNR_1 = 1 - FPR_1 = 1 - 1/3 = 2/3$。\n\n现在，我们计算总体准确率：\n$$ \\text{Accuracy} = \\Pr(A=0, Y=1)TPR_0 + \\Pr(A=0, Y=0)TNR_0 + \\Pr(A=1, Y=1)TPR_1 + \\Pr(A=1, Y=0)TNR_1 $$\n代入数值：\n$$ \\text{Accuracy} = \\left(\\frac{9}{50}\\right)\\left(\\frac{1}{3}\\right) + \\left(\\frac{21}{50}\\right)\\left(\\frac{2}{3}\\right) + \\left(\\frac{2}{25}\\right)\\left(\\frac{1}{3}\\right) + \\left(\\frac{8}{25}\\right)\\left(\\frac{2}{3}\\right) $$\n$$ \\text{Accuracy} = \\frac{9}{150} + \\frac{42}{150} + \\frac{2}{75} + \\frac{16}{75} $$\n为了合并分数，我们使用公分母 $150$：\n$$ \\text{Accuracy} = \\frac{9}{150} + \\frac{42}{150} + \\frac{2 \\times 2}{75 \\times 2} + \\frac{16 \\times 2}{75 \\times 2} $$\n$$ \\text{Accuracy} = \\frac{9}{150} + \\frac{42}{150} + \\frac{4}{150} + \\frac{32}{150} $$\n$$ \\text{Accuracy} = \\frac{9 + 42 + 4 + 32}{150} = \\frac{87}{150} $$\n最后，我们将分子和分母除以它们的最大公约数 $3$ 来简化分数：\n$$ \\text{Accuracy} = \\frac{87 \\div 3}{150 \\div 3} = \\frac{29}{50} $$\n这个分数已是最简形式，因为 $29$ 是一个质数。", "answer": "$$\\boxed{\\frac{29}{50}}$$", "id": "4824199"}]}