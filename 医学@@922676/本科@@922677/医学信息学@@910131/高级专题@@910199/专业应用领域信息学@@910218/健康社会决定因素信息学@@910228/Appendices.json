{"hands_on_practices": [{"introduction": "健康相关的社会决定因素 (SDOH) 数据通常隐藏在非结构化的临床笔记中，自然语言处理 (NLP) 是提取这些信息的关键技术。然而，为了确保这些提取数据的可靠性，我们必须严格评估 NLP 工具的性能。本练习将指导您使用混淆矩阵中的基本计数，计算评估分类模型性能的核心指标，包括灵敏度、特异性、阳性预测值和 F1 分数，这些是评估任何信息提取或分类任务的基石技能 [@problem_id:4855893]。", "problem": "一个医疗系统部署了一个自然语言处理（NLP）管道，用于从临床笔记中提取一种健康的社会决定因素（SDOH）——具体来说是“住房不稳定”——的存在情况。人工标注员创建了一个包含 $3{,}000$ 份去标识化笔记的参考标准语料库。在该语料库中，有 $1{,}200$ 份笔记的真实情况被记录为“存在住房不稳定”，有 $1{,}800$ 份笔记被记录为“不存在住房不稳定”。与参考标准进行基准测试时，该NLP提取器的输出产生以下混淆矩阵计数：真阳性 $TP = 936$，假阳性 $FP = 144$，假阴性 $FN = 264$，以及真阴性 $TN = 1{,}656$。\n\n仅使用混淆矩阵中事件计数的基本定义及其引出的条件率概念，计算该提取器的以下性能指标：敏感度、特异度、阳性预测值（PPV）和 F1 分数。将每个指标表示为闭区间 $[0,1]$ 内的一个小数。将每个值四舍五入到四位有效数字。以单行矩阵的形式提供您的最终答案，顺序为 $(\\text{sensitivity}, \\text{specificity}, \\text{PPV}, \\text{F1 score})$，不带单位，也不带百分号。", "solution": "该问题陈述已经过验证，被认为是合理的。它是自洽的，科学上基于分类模型的统计学和性能评估原则，并且内部一致。计算所需的所有数据均已提供，并且在算术上是一致的。\n\n“存在住房不稳定”的情况对应于阳性类别，“不存在住房不稳定”的情况对应于阴性类别。所提供的混淆矩阵计数如下：\n- 真阳性（$TP$）：被正确识别为阳性的案例数。$TP = 936$。\n- 假阳性（$FP$）：被错误识别为阳性的案例数。$FP = 144$。\n- 假阴性（$FN$）：被错误识别为阴性的案例数。$FN = 264$。\n- 真阴性（$TN$）：被正确识别为阴性的案例数。$TN = 1{,}656$。\n\n根据这些基本计数，我们可以验证参考标准语料库中实际阳性和阴性实例的总数。\n- 实际阳性总数（$P$）：$P = TP + FN = 936 + 264 = 1{,}200$。这与给定值相符。\n- 实际阴性总数（$N$）：$N = TN + FP = 1{,}656 + 144 = 1{,}800$。这与给定值相符。\n- 总实例数：$P + N = 1{,}200 + 1{,}800 = 3{,}000$。这也与语料库的总大小相符。\n\n性能指标计算如下：\n\n1.  **敏感度（召回率或真阳性率）**：此指标衡量被提取器正确识别的实际阳性样本的比例。其定义为真阳性数与实际阳性总数之比。\n    $$ \\text{Sensitivity} = \\frac{TP}{TP + FN} $$\n    代入给定值：\n    $$ \\text{Sensitivity} = \\frac{936}{936 + 264} = \\frac{936}{1{,}200} = 0.78 $$\n    四舍五入到四位有效数字，我们得到 $0.7800$。\n\n2.  **特异度（真阴性率）**：此指标衡量被正确识别的实际阴性样本的比例。其定义为真阴性数与实际阴性总数之比。\n    $$ \\text{Specificity} = \\frac{TN}{TN + FP} $$\n    代入给定值：\n    $$ \\text{Specificity} = \\frac{1{,}656}{1{,}656 + 144} = \\frac{1{,}656}{1{,}800} = 0.92 $$\n    四舍五入到四位有效数字，我们得到 $0.9200$。\n\n3.  **阳性预测值（PPV 或精确率）**：此指标衡量实际上正确的阳性预测的比例。其定义为真阳性数与预测阳性总数之比。\n    $$ \\text{PPV} = \\frac{TP}{TP + FP} $$\n    代入给定值：\n    $$ \\text{PPV} = \\frac{936}{936 + 144} = \\frac{936}{1{,}080} \\approx 0.86666... $$\n    四舍五入到四位有效数字，我们得到 $0.8667$。\n\n4.  **F1 分数**：此指标是精确率（PPV）和召回率（敏感度）的调和平均数。它提供了一个平衡这两方面考量的单一分数。其公式为：\n    $$ \\text{F1 Score} = 2 \\times \\frac{\\text{PPV} \\times \\text{Sensitivity}}{\\text{PPV} + \\text{Sensitivity}} $$\n    或者，它可以直接从混淆矩阵计数中计算：\n    $$ \\text{F1 Score} = \\frac{2TP}{2TP + FP + FN} $$\n    使用此直接公式：\n    $$ \\text{F1 Score} = \\frac{2 \\times 936}{(2 \\times 936) + 144 + 264} = \\frac{1{,}872}{1{,}872 + 408} = \\frac{1{,}872}{2{,}280} \\approx 0.82105... $$\n    四舍五入到四位有效数字，我们得到 $0.8211$。\n\n计算出的值（四舍五入到四位有效数字）为：敏感度 = $0.7800$，特异度 = $0.9200$，PPV = $0.8667$，F1 分数 = $0.8211$。这些将以指定的矩阵格式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.7800  0.9200  0.8667  0.8211\n\\end{pmatrix}\n}\n$$", "id": "4855893"}, {"introduction": "健康信息学的一个核心目标是揭示社会因素对健康结果的因果影响，而不仅仅是观察相关性，因为后者可能受到混杂因素的严重影响。因果推断中的“后门准则”为识别和调整混杂变量提供了理论依据，使我们能够估计真实的因果效应。本练习将带您实践如何应用标准化方法，基于分层数据计算经调整的平均因果风险差异，从而将抽象的因果图理论转化为具体的量化结果 [@problem_id:4855871]。", "problem": "一个医疗系统整合了电子健康记录 (EHR) 数据与健康的社会决定因素 (SDOH) 指标，以研究在心力衰竭出院后，居住在社区剥夺指数 (NDI) 高的地区对$30$天内再入院率的影响。设二元暴露为 $A \\in \\{0,1\\}$，其中 $A=1$ 表示居住在高 NDI 的普查区，而 $A=0$ 表示居住在低 NDI 的普查区。设二元结局为 $Y \\in \\{0,1\\}$，其中 $Y=1$ 表示$30$天内再入院。考虑由健康信息学流程收集的两个测量协变量：临床严重程度 $S \\in \\{0,1\\}$，其中 $S=1$ 表示高严重程度，$S=0$ 表示低严重程度；以及收入类别 $I \\in \\{0,1\\}$，其中 $I=1$ 表示低收入，$I=0$ 表示中等或高收入。定义 $Z=(S,I)$，其支持集为四个分层 $z_{1}=(1,1)$、 $z_{2}=(1,0)$、 $z_{3}=(0,1)$ 和 $z_{4}=(0,0)$。\n\n此情景下的一个因果有向无环图 (DAG) 包含箭头 $Z \\to A$、$Z \\to Y$ 和 $A \\to Y$。研究人员已验证，所测量的协变量集 $Z$ 阻断了 DAG 中 $A$ 和 $Y$ 之间的所有后门路径。假设因果推断和医学信息学数据整合中的标准可识别性条件成立：条件可交换性 $Y^{a} \\perp A \\mid Z$ (对于 $a \\in \\{0,1\\}$)，一致性 $Y=Y^{A}$，以及正性 $\\Pr(A=a \\mid Z=z)>0$ (对于所有满足 $\\Pr(Z=z)>0$ 的分层 $z$) 。\n\n从集成数据仓库中，为每个分层 $z_k$ 估计了以下量值：\n- 对于 $z_{1}=(S=1,I=1)$：$\\Pr(Y=1 \\mid A=1,Z=z_{1})=0.30$、$\\Pr(Y=1 \\mid A=0,Z=z_{1})=0.24$ 和 $\\Pr(Z=z_{1})=0.20$。\n- 对于 $z_{2}=(S=1,I=0)$：$\\Pr(Y=1 \\mid A=1,Z=z_{2})=0.25$、$\\Pr(Y=1 \\mid A=0,Z=z_{2})=0.22$ 和 $\\Pr(Z=z_{2})=0.25$。\n- 对于 $z_{3}=(S=0,I=1)$：$\\Pr(Y=1 \\mid A=1,Z=z_{3})=0.15$、$\\Pr(Y=1 \\mid A=0,Z=z_{3})=0.12$ 和 $\\Pr(Z=z_{3})=0.30$。\n- 对于 $z_{4}=(S=0,I=0)$：$\\Pr(Y=1 \\mid A=1,Z=z_{4})=0.10$、$\\Pr(Y=1 \\mid A=0,Z=z_{4})=0.08$ 和 $\\Pr(Z=z_{4})=0.25$。\n\n使用后门准则和因果效应的基本定义，计算 $A=1$ 与 $A=0$ 对 $Y$ 的调整后的平均因果风险差，表示为干预风险之差。将最终答案以无单位小数形式给出，并四舍五入到四位有效数字。", "solution": "目标是计算暴露 $A$ 对结局 $Y$ 的平均因果风险差 (ACRD)。暴露 $A$ 代表居住在社区剥夺指数 (NDI) 高 ($A=1$) 与低 ($A=0$) 的地区。结局 $Y$ 是$30$天内再入院 ($Y=1$) 与否 (无再入院，$Y=0$)。协变量集为 $Z=(S,I)$，其中 $S$ 是临床严重程度，$I$ 是收入类别。\n\n目标因果估计量是平均因果风险差，定义为在暴露与无暴露条件下，预期潜在结局（或干预风险）之差：\n$$\n\\text{ACRD} = E[Y^1] - E[Y^0]\n$$\n其中 $Y^a$ 是当个体的暴露水平被设定为 $a \\in \\{0,1\\}$ 时的潜在结局。由于 $Y$ 是一个二元变量，期望值等同于事件的概率，因此我们可以将其写为：\n$$\n\\text{ACRD} = \\Pr(Y^1=1) - \\Pr(Y^0=1)\n$$\n问题陈述了必要的可识别性条件是成立的。具体来说，协变量集 $Z$足以控制混杂，因为它阻断了 $A$ 和 $Y$ 之间的所有后门路径。这由条件可交换性假设 $Y^a \\perp A \\mid Z$ 正式表达。连同一致性 ($Y=Y^A$) 和正性 ($\\Pr(A=a \\mid Z=z) > 0$)，这使我们能够使用后门调整公式（也称为标准化或 g-公式）从观测数据中识别出干预风险 $\\Pr(Y^a=1)$。\n\n干预风险 $\\Pr(Y^a=1)$ 的公式是通过对混杂变量 $Z$ 的分布进行标准化给出的：\n$$\n\\Pr(Y^a=1) = \\sum_{z} \\Pr(Y=1 \\mid A=a, Z=z) \\Pr(Z=z)\n$$\n求和是针对 $Z$ 的所有可能分层。在这个问题中，我们有四个分层：$z_{1}=(1,1)$、 $z_{2}=(1,0)$、 $z_{3}=(0,1)$ 和 $z_{4}=(0,0)$。问题提供了所有必要的量值：分层特定的结局条件概率 $\\Pr(Y=1 \\mid A=a, Z=z_k)$，以及每个分层的边际概率 $\\Pr(Z=z_k)$。\n\n首先，我们通过设定 $a=1$ 来计算暴露下的干预风险 $\\Pr(Y^1=1)$：\n$$\n\\Pr(Y^1=1) = \\sum_{k=1}^{4} \\Pr(Y=1 \\mid A=1, Z=z_k) \\Pr(Z=z_k)\n$$\n代入每个分层所提供的值：\n- 对于 $z_{1}$：$\\Pr(Y=1 \\mid A=1, Z=z_{1}) = 0.30$ 且 $\\Pr(Z=z_{1}) = 0.20$。\n- 对于 $z_{2}$：$\\Pr(Y=1 \\mid A=1, Z=z_{2}) = 0.25$ 且 $\\Pr(Z=z_{2}) = 0.25$。\n- 对于 $z_{3}$：$\\Pr(Y=1 \\mid A=1, Z=z_{3}) = 0.15$ 且 $\\Pr(Z=z_{3}) = 0.30$。\n- 对于 $z_{4}$：$\\Pr(Y=1 \\mid A=1, Z=z_{4}) = 0.10$ 且 $\\Pr(Z=z_{4}) = 0.25$。\n\n计算过程如下：\n$$\n\\Pr(Y^1=1) = (0.30)(0.20) + (0.25)(0.25) + (0.15)(0.30) + (0.10)(0.25)\n$$\n$$\n\\Pr(Y^1=1) = 0.0600 + 0.0625 + 0.0450 + 0.0250 = 0.1925\n$$\n该值表示在调整了临床严重程度和收入后，如果人群中所有人都居住在高 NDI 地区，其30天再入院风险。\n\n接下来，我们通过设定 $a=0$ 来计算无暴露下的干预风险 $\\Pr(Y^0=1)$：\n$$\n\\Pr(Y^0=1) = \\sum_{k=1}^{4} \\Pr(Y=1 \\mid A=0, Z=z_k) \\Pr(Z=z_k)\n$$\n代入每个分层所提供的值：\n- 对于 $z_{1}$：$\\Pr(Y=1 \\mid A=0, Z=z_{1}) = 0.24$ 且 $\\Pr(Z=z_{1}) = 0.20$。\n- 对于 $z_{2}$：$\\Pr(Y=1 \\mid A=0, Z=z_{2}) = 0.22$ 且 $\\Pr(Z=z_{2}) = 0.25$。\n- 对于 $z_{3}$：$\\Pr(Y=1 \\mid A=0, Z=z_{3}) = 0.12$ 且 $\\Pr(Z=z_{3}) = 0.30$。\n- 对于 $z_{4}$：$\\Pr(Y=1 \\mid A=0, Z=z_{4}) = 0.08$ 且 $\\Pr(Z=z_{4}) = 0.25$。\n\n计算过程如下：\n$$\n\\Pr(Y^0=1) = (0.24)(0.20) + (0.22)(0.25) + (0.12)(0.30) + (0.08)(0.25)\n$$\n$$\n\\Pr(Y^0=1) = 0.0480 + 0.0550 + 0.0360 + 0.0200 = 0.1590\n$$\n该值表示在调整了临床严重程度和收入后，如果人群中所有人都居住在低 NDI 地区，其30天再入院风险。\n\n最后，我们通过从暴露下的干预风险中减去无暴露下的干预风险来计算平均因果风险差：\n$$\n\\text{ACRD} = \\Pr(Y^1=1) - \\Pr(Y^0=1) = 0.1925 - 0.1590 = 0.0335\n$$\n问题要求最终答案四舍五入到四位有效数字。计算出的值 $0.0335$ 有三位有效数字。为了用四位有效数字表示，我们在末尾添加一个零，这在这种情况下是有效的。\n$$\n\\text{ACRD} = 0.03350\n$$\n这个结果表明，在考虑了临床严重程度和收入水平的混杂因素后，居住在高 NDI 地区会使$30$天内再入院的绝对风险因果性地增加 $3.350$ 个百分点。", "answer": "$$\\boxed{0.03350}$$", "id": "4855871"}, {"introduction": "随着算法在医疗决策（如资源分配和风险预警）中的应用日益广泛，确保其公平性、避免加剧现有健康不平等至关重要。差异性影响比率等量化指标为我们提供了一种审计算法是否存在偏见的有力工具。本练习通过一个实际场景，指导您计算差异性影响比率及其置信区间，并应用“$0.8$ 法则”进行判断，这是在实践中评估和解决算法公平性问题的关键一步 [@problem_id:4855851]。", "problem": "一个医院系统在其电子健康记录 (EHR) 中部署了一个风险评分模型，以优先对高血压护理管理进行主动干预。为了评估与一项关键的健康社会决定因素（社区社会经济地位）相关的算法公平性，患者通过一个二元组群指标 $G$ 被划分，其中 $G=1$ 表示居住在低收入、高剥夺地区（通过地区剥夺指数测量），而 $G=0$ 表示居住在高收入、低剥夺地区。令 $\\hat{Y}=1$ 表示模型将患者标记为需要干预。差异性影响比率定义为 $\\text{DI}=\\frac{P(\\hat{Y}=1\\mid G=1)}{P(\\hat{Y}=1\\mid G=0)}$。$0.8$ 规则通常用作一种实用的公平性检查：低于 $0.8$ 的 $\\text{DI}$ 值表明可能存在对 $G=1$ 群体的不利差异性影响。\n\n根据一个月的 EHR 日志，观察到以下计数：\n- 在 $G=1$ 组中：有 $n_1=400$ 名患者，其中 $x_1=88$ 人被标记（$\\hat{Y}=1$）。\n- 在 $G=0$ 组中：有 $n_0=500$ 名患者，其中 $x_0=150$ 人被标记（$\\hat{Y}=1$）。\n\n使用概率的频率定义，构建组群阳性标记率和差异性影响比率的点估计。然后，在由样本比例的中心极限定理和应用于对数转换比率的德尔塔方法证明的大样本假设下，为 $\\text{DI}$ 推导一个置信水平为 $0.95$ 的双侧置信区间。通过评估 $0.8$ 是否位于推导出的区间内来检验 $0.8$ 规则，并解释结果。\n\n请提供 $\\text{DI}$ 的 $0.95$ 置信区间的下限作为您的最终数值答案。将您的最终数值答案四舍五入到三位有效数字。将最终答案表示为无单位的小数。", "solution": "所述问题具有科学依据，表述清晰，并包含进行完整统计分析所需的所有信息。样本量足以支持按要求使用大样本近似。因此，该问题是有效的，我们可以继续进行求解。\n\n设 $p_1 = P(\\hat{Y}=1 \\mid G=1)$ 是来自低收入群体（$G=1$）的患者被标记为需要干预的概率，设 $p_0 = P(\\hat{Y}=1 \\mid G=0)$ 是来自高收入群体（$G=0$）的相应概率。差异性影响比率定义为 $\\text{DI} = \\frac{p_1}{p_0}$。\n\n问题提供了以下数据：\n对于 $G=1$ 组：样本量 $n_1 = 400$，被标记数 $x_1 = 88$。\n对于 $G=0$ 组：样本量 $n_0 = 500$，被标记数 $x_0 = 150$。\n\n首先，我们使用概率的频率定义计算组群阳性标记率的点估计。二项分布比例 $p$ 的最大似然估计是样本比例 $\\hat{p} = \\frac{x}{n}$。\n$p_1$ 的点估计为：\n$$ \\hat{p}_1 = \\frac{x_1}{n_1} = \\frac{88}{400} = 0.22 $$\n$p_0$ 的点估计为：\n$$ \\hat{p}_0 = \\frac{x_0}{n_0} = \\frac{150}{500} = 0.30 $$\n差异性影响比率的点估计 $\\widehat{\\text{DI}}$ 是这些估计比例的比值：\n$$ \\widehat{\\text{DI}} = \\frac{\\hat{p}_1}{\\hat{p}_0} = \\frac{0.22}{0.30} = \\frac{11}{15} \\approx 0.7333 $$\n\n为了构建 $\\text{DI}$ 的置信区间，我们使用指定的方法：将德尔塔方法应用于对数转换后的比率。这种方法是首选的，因为 $\\ln(\\widehat{\\text{DI}})$ 的分布通常比 $\\widehat{\\text{DI}}$ 的分布更对称，更接近正态分布。\n设 $\\theta = \\ln(\\text{DI}) = \\ln(p_1) - \\ln(p_0)$。$\\theta$ 的估计量是 $\\hat{\\theta} = \\ln(\\widehat{\\text{DI}}) = \\ln(\\hat{p}_1) - \\ln(\\hat{p}_0)$。\n\n在大样本假设下，样本比例 $\\hat{p}_1$ 和 $\\hat{p}_0$ 近似服从正态分布。由于这两个组代表独立样本，$\\hat{\\theta}$ 的方差是其各项方差之和：\n$$ \\text{Var}(\\hat{\\theta}) = \\text{Var}(\\ln(\\hat{p}_1)) + \\text{Var}(\\ln(\\hat{p}_0)) $$\n我们使用德尔塔方法来求随机变量函数的方差。对于函数 $f(X)$，$\\text{Var}(f(X)) \\approx [f'(E[X])]^2\\text{Var}(X)$。这里，$f(p) = \\ln(p)$，所以 $f'(p) = \\frac{1}{p}$。样本比例 $\\hat{p}$ 的方差是 $\\text{Var}(\\hat{p}) = \\frac{p(1-p)}{n}$。\n应用此方法，我们得到：\n$$ \\text{Var}(\\ln(\\hat{p})) \\approx \\left(\\frac{1}{p}\\right)^2 \\frac{p(1-p)}{n} = \\frac{1-p}{np} $$\n因此，$\\hat{\\theta}$ 的方差近似为：\n$$ \\text{Var}(\\hat{\\theta}) \\approx \\frac{1-p_1}{n_1 p_1} + \\frac{1-p_0}{n_0 p_0} $$\n我们通过用样本比例替代真实比例来估计此方差，这给出了 $\\hat{\\theta}$ 的标准误差的平方：\n$$ \\widehat{\\text{SE}}(\\hat{\\theta})^2 = \\frac{1-\\hat{p}_1}{n_1 \\hat{p}_1} + \\frac{1-\\hat{p}_0}{n_0 \\hat{p}_0} = \\frac{1-\\hat{p}_1}{x_1} + \\frac{1-\\hat{p}_0}{x_0} $$\n代入数值：\n$$ \\widehat{\\text{SE}}(\\hat{\\theta})^2 = \\frac{1-0.22}{88} + \\frac{1-0.30}{150} = \\frac{0.78}{88} + \\frac{0.70}{150} $$\n$$ \\widehat{\\text{SE}}(\\hat{\\theta})^2 \\approx 0.00886363... + 0.00466666... = 0.0135303... $$\n标准误差是该值的平方根：\n$$ \\widehat{\\text{SE}}(\\hat{\\theta}) = \\sqrt{0.0135303...} \\approx 0.11632 $$\n$\\theta$ 的点估计为：\n$$ \\hat{\\theta} = \\ln(\\widehat{\\text{DI}}) = \\ln\\left(\\frac{11}{15}\\right) \\approx -0.30945 $$\n在置信水平 $1-\\alpha = 0.95$ 下，$\\theta$ 的双侧置信区间由 $\\hat{\\theta} \\pm z_{\\alpha/2} \\widehat{\\text{SE}}(\\hat{\\theta})$ 给出。对于 $\\alpha=0.05$，临界值为 $z_{0.025} = 1.96$。\n误差范围是 $E = 1.96 \\times 0.11632 \\approx 0.22799$。\n$\\theta = \\ln(\\text{DI})$ 的 $95\\%$ 置信区间为：\n$$ [-0.30945 - 0.22799, -0.30945 + 0.22799] = [-0.53744, -0.08146] $$\n为了获得 $\\text{DI}$ 的置信区间，我们对 $\\theta$ 区间的端点取指数：\n$$ \\text{CI}_{\\text{DI}} = [\\exp(-0.53744), \\exp(-0.08146)] \\approx [0.58428, 0.92176] $$\n四舍五入到三位有效数字，$\\text{DI}$ 的 $95\\%$ 置信区间为 $[0.584, 0.922]$。\n\n最后的步骤是检验 $0.8$ 规则并提供下限。\n$0.8$ 规则表明，如果 $\\text{DI}  0.8$，则可能存在差异性影响。我们的点估计 $\\widehat{\\text{DI}} \\approx 0.733$，低于 $0.8$ 的阈值。然而，阈值 $0.8$ 包含在 $95\\%$ 置信区间 $[0.584, 0.922]$ 内。这意味着我们无法以 $95\\%$ 的置信度断定真实的差异性影响比率小于 $0.8$。在 $\\alpha=0.05$ 的水平上，观察到的与 $0.8$ 阈值的差异不具有统计显著性。数据与真实的 $\\text{DI}$ 可能低于或高于 $0.8$ 的情况相符。\n\n问题要求提供 $\\text{DI}$ 的 $0.95$ 置信区间的下限，并四舍五入到三位有效数字。\n计算出的下限约为 $0.58428$。四舍五入到三位有效数字得到 $0.584$。", "answer": "$$\\boxed{0.584}$$", "id": "4855851"}]}