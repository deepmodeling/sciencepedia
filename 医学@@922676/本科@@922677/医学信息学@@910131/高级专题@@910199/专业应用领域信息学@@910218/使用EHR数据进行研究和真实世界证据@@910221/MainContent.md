## 引言
电子健康记录（EHR）数据的日益普及为医学研究带来了前所未有的机遇，它使得生成能够反映日常临床实践的真实世界证据（RWE）成为可能。然而，利用这些主要为临床护理而非研究目的收集的数据，面临着数据质量、异质性和内在偏倚等重大挑战。将这些原始的“真实世界数据”转化为可靠的科学证据，需要研究者掌握一套严谨的方法论和核心原则。

本文旨在为驾驭这一复杂领域提供一份全面的指南。我们将通过三个章节系统性地展开论述。首先，在**“原则与机制”**一章中，我们将深入探讨真实世界数据的本质，阐明数据质量、标准化和溯源的关键原则，并剖析因果推断中面临的核心挑战与偏倚类型。接着，在**“应用与跨学科交叉”**一章中，我们将展示这些原则在实践中的具体应用，涵盖从监管级别的RWE生成、比较效果研究中的高级方法，到药物警戒和卫生政策评估等多个领域。最后，**“动手实践”**部分将提供具体的练习，帮助读者巩固对偏倚校正和表型开发等关键技能的理解。通过这一结构化的学习路径，读者将能掌握负责任地利用EHR数据进行科学研究所需的核心能力，为最终改善患者健康福祉做出贡献。

## 原则与机制

利用电子健康记录 (EHR) 数据进行研究，以生成真实世界证据 (RWE)，这一过程为医学科学开辟了新的前沿。然而，这些数据源于为临床护理而非研究目的而设计的复杂系统，其本身也带来了独特的挑战。为了有效利用这些数据，研究人员必须掌握一套核心原则和机制，涵盖数据本身的性质、确保推断有效性的方法论严谨性，以及指导其实践的伦理框架。本章将系统地阐述这些基本原则，为后续章节中更高级的应用奠定基础。

### 真实世界数据的性质

从根本上说，理解 RWE 的第一步是认识到其数据来源——真实世界数据 (RWD)——与传统临床试验（尤其是随机对照试验，RCT）中收集的数据存在本质区别。

#### 内部效度与外部效度的权衡

RCT 长期以来被视为临床研究的“金标准”，其核心优势在于通过**随机化**过程实现高度的**内部效度**。随机化旨在确保治疗组与[对照组](@entry_id:188599)之间，在所有已测量和未测量的预后因素上达到均衡，从而使研究人员能够以较高的置信度分离出治疗的因果效应。然而，为了维持这种严格的控制，RCT 通常会设定严格的纳入和排除标准，导致其研究人群高度同质化，可能无法代表在日常临床实践中接受治疗的、更多样化和复杂的患者群体。这限制了 RCT 结果向更广泛目标人群推广的能力，即其**外部效度**可能较弱。

相比之下，RWE 源自于在常规医疗环境中收集的数据，例如疾病登记、行政医保理赔数据以及 EHR。这些数据反映了在真实世界条件下接受治疗的异质性人群，包括那些通常被排除在 RCT 之外的患者（如老年人、孕妇或患有多种合并症的患者）。因此，基于 RWD 的研究通常具有更强的外部效度。然而，这种优势的代价是内部效度的显著降低。在 RWD 中，治疗决策并非随机分配，而是基于临床指征、患者偏好和医生判断，这导致了系统的**混杂（confounding）**。因此，从 RWD 中识别因果效应需要依赖强有力的、且通常无法被完全检验的统计学假设，例如“无未测量混杂”假设。此外，由于数据并非为研究而收集，其质量、完整性和一致性也可能存在问题 [@problem_id:4744803]。

#### 数据的主要用途与次级用途

EHR 数据的挑战源于其“双重身份”：**主要用途**和**次级用途**之间的张力。数据的主要用途是指在医疗服务过程中，为支持单个患者的临床决策而进行的[数据采集](@entry_id:273490)和使用。例如，临床医生在 EHR 中查看患者的最新实验室结果，以决定是否需要调整药物剂量。

**次级用途**则是指将这些为临床护理收集的相同数据，重新用于研究、质量评估、[公共卫生监测](@entry_id:170581)或政策分析。我们本课程的重点——利用 EHR 生成 RWE——正是数据次级用途的一个典型范例。

这种区别至关重要，因为它影响着我们如何评估研究的有效性。在研究的语境下，我们关注三个核心的效度概念 [@problem_id:4853677]：

1.  **建构效度 (Construct Validity)**：指一项操作性测量（例如，一个基于 EHR 数据的算法）在多大程度上真正捕捉到了其意图测量的理论构念（例如，“糖尿病控制良好”的真实生理状态）。
2.  **内部效度 (Internal Validity)**：关注研究是否能够产生无偏的因果效应估计。它旨在回答：观察到的关联是真实的因果关系，还是由混杂、选择偏倚或信息偏倚等因素造成的假象？
3.  **外部效度 (External Validity)**：关注研究结果能否推广到研究样本之外的其他人群、环境或时间。

当一个基于 EHR 的测量工具（如一个用于识别糖尿病控制不佳患者的算法）同时用于主要和次级用途时，对这三种效度的威胁表现出显著差异。在主要用途（即临床决策支持）中，当算法标记出一位患者时，临床医生可以结合其他信息来源、与患者交谈并运用专业判断来验证该标记。这个“人在回路中”的过程可以在一定程度上缓解因数据不准确或算法错误导致的**建构效度**问题。此时，**内部效度**作为评估群体因果推断的概念，并不直接适用，因为目标是为个体做出最佳决策。

然而，在次级用途（即回顾性研究）中，研究人员必须将算法输出的标记作为静态数据点。算法的任何系统性错误，如由于计费驱动的编码实践、院外医疗数据的缺失或自然语言处理的偏差，都会成为测量误差，从而直接威胁研究的**建构效度**和**内部效度**。同样，由于研究通常在单一医疗系统中进行，其独特的患者群体和护理模式会威胁到研究结果的**外部效度** [@problem_id:4853677]。

### RWD 的基石：数据质量、标准化与溯源

在利用 RWD 进行任何有意义的分析之前，我们必须深入审视数据的基本属性。这包括评估其质量、理解其标准化方式，并追踪其来源和处理过程。

#### 数据质量的维度

EHR 数据本质上是临床和管理流程的副产品，因此其质量可能参差不齐。评估[数据质量](@entry_id:185007)需要一个多维度的框架。以下是几个关键维度，通过一个研究降压药疗效的假设场景中的例子来说明 [@problem_id:4862778]：

*   **完整性 (Completeness)**：指在数据集中，针对特定用例所需的必填数据元素的可用程度。例如，在一个降压研究中，如果 $25\%$ 的访视记录缺少了关键的混杂因素——吸烟状况信息，这就构成了一个严重的完整性问题。

*   **准确性 (Accuracy)**：指记录值与真实临床状态的接近程度。例如，某患者的收缩压在说话时被记录为 $160$ mmHg，几分钟后在标准规程下重测为 $138$ mmHg。考虑到测量技术对结果的影响，后者可能更接近真实值，因此准确性更高。第一个读数中由于测量条件不当引入的误差属于**测量误差**，它发生在数据生成阶段。

*   **一致性 (Consistency)**：指数据在不同记录或系统间遵循统一格式、单位和值集的程度。例如，血清钾的浓度在一条记录中记为 $5.8$ “mmol/L”，在另一条中记为 $5.8$ “mEq/L”。尽管对于钾离子这两个单位在数值上是等价的，但表示方式的不统一构成了[数据一致性](@entry_id:748190)问题，可能导致数据处理流程出错。

*   **时效性 (Timeliness)**：反映数据记录时间与真实事件时间的贴近程度，以及数据对于特定用途是否足够“新鲜”。例如，一份降压药医嘱在上午 $10:00$ 开立，但给药记录却在当天下午 $17:00$。这个 $7$ 小时的延迟对于旨在评估护理流程效率的研究而言，是一个关键的时效性发现。

*   **合理性 (Plausibility)**：指数据值基于已知的生理学和护理流程知识，其本身或与其他数据组合的临床合理性。例如，一条成人记录显示身高为 $180$ cm，体重却为 $12$ kg，这在生物学上是不可能的，违反了合理性，表明存在严重的数据录入错误。

区分**测量误差**和**编码误差**也至关重要。前者源于数据生成过程（如设备校准、患者状态），而后者发生在数据抽象、映射或录入阶段。例如，临床记录中明确记载为 1 型糖尿病，但在录入国际疾病分类 (ICD) 编码时却错误地使用了 2 型糖尿病的编码，这是一个典型的**编码误差** [@problem_id:4862778]。

#### [数据标准化](@entry_id:147200)：通用语言

为了在不同机构、不同 EHR 系统之间汇总和比较数据，必须将本地的、异质的数据映射到标准的**受控词表 (controlled vocabularies)** 和**分类系统 (classifications)**。这些标准为临床概念提供了“通用语言”。

*   **SNOMED CT (Systematized Nomenclature of Medicine—Clinical Terms)**：是一个全面的临床**术语集**，其本质是一个**本体 (ontology)**。它覆盖了问题、发现、操作、身体结构等广泛的临床概念，并具有支持多重继承（即一个概念可以有多个父概念）的复杂层级结构和形式化的逻辑定义。其高粒度特性使其非常适合用于构建**可计算表型**（computable phenotypes）和进行自然语言处理。

*   **ICD-10-CM (International Classification of Diseases, 10th Revision, Clinical Modification)**：是一个**分类系统**，主要用于诊断编码，为疾病统计和医保计费而优化。其结构是单层级的（每个编码仅属于一个章节），粒度较粗，缺乏 SNOMED CT 的语义丰富性。

*   **LOINC (Logical Observation Identifiers Names and Codes)**：是实验室检验和临床观察的**标识符**标准。它为“问题”（如“血清葡萄糖水平”）提供唯一编码，但不包含“答案”（即具体的检验结果值）。这使得研究人员能够跨机构协调和汇总来自不同实验室的检验数据。

*   **RxNorm**：是美国的标准化**药物词表**。它通过对药物的有效成分、强度和剂型进行建模，将不同的药物产品（如品牌药、仿制药和特定包装）联系起来，为药物流行病学研究中的暴露分类提供了基础。

理解这些标准之间的区别至关重要：SNOMED CT 是一个用于深度临床表征的丰富[本体](@entry_id:264049)，而 ICD-10-CM 是一个用于管理目的的较粗粒度的分类系统；LOINC 标准化了检验的“问题”，而 RxNorm 标准化了药物的概念 [@problem_id:4862773]。

#### 通用数据模型与[数据溯源](@entry_id:175012)

为了实现大规模的[网络分析](@entry_id:139553)，研究人员不仅需要标准化的词表，还需要标准化的[数据结构](@entry_id:262134)。

*   **OMOP 通用数据模型 (OMOP Common Data Model, CDM)**：是一个专为观察性研究设计的[关系型数据库](@entry_id:275066)模式。它定义了一套标准的表格（如 `PERSON`、`CONDITION_OCCURRENCE`、`DRUG_EXPOSURE`）和字段，并强制要求将源数据映射到前述的标准词表。其目标是实现**分析[互操作性](@entry_id:750761)**：让同一套分析代码能够在不同机构的、已转换为 OMOP 格式的数据库上运行，并产生可比较的结果 [@problem_id:4862777]。

*   **FHIR (Fast Healthcare Interoperability Resources)**：是一个用于医疗数据交换的标准。它定义了一系列称为“资源”（如 `Patient`, `Observation`）的信息单元，通常通过应用程序接口 (API) 进行实时交换。FHIR 的主要目标是**交换[互操作性](@entry_id:750761)**，即确保系统间能够顺畅地传递和解析信息，其设计更侧重于支持临床工作流程而非大规模的回顾性分析。

最后，所有数据分析的有效性和可信度都依赖于**[数据溯源](@entry_id:175012) (data provenance)** 和**数据血缘 (data lineage)**。[数据溯源](@entry_id:175012)是指关于数据来源、采集背景和所有转换过程的完整[元数据](@entry_id:275500)记录。数据血缘则是这一过程中从原始输入到最终分析输出的详细处理步骤链。如果这些[元数据](@entry_id:275500)缺失——例如，一个研究中心在某个时间点悄悄地改变了其计算血压平均值的方法，或者更新了 ICD 编码的映射逻辑而未作记录——那么数据的含义就会在分析师不知情的情况下发生改变。这会导致模型假设（如[平稳性](@entry_id:143776)）被违反，从而破坏**推断有效性**。此外，由于其他研究团队无法根据原始数据重现分析数据集，研究结果的**[可复现性](@entry_id:151299) (reproducibility)** 也将无从谈起 [@problem_id:4862752]。

### 因果推断的核心挑战

从 RWD 中得出因果结论是 RWE 的最终目标之一，但也是最大的挑战。流行病学的基本原则为我们提供了一个识别和理解潜在偏倚的框架。

#### 三大偏倚类型

在观察性研究中，有三种主要的偏倚威胁着内部效度，它们在 EHR 研究中有着独特的表现形式 [@problem_id:4862759]：

1.  **混杂 (Confounding)**：当一个外部变量（混杂因素）既与暴露相关，又与结局相关时，就会发生混杂。在 EHR 研究中，一个典型的例子是**适应症混杂 (confounding by indication)**，即导致医生开具某种药物的疾病本身也是导致不良结局的风险因素。例如，一个未被测量的严重合并症 $Z$ 既增加了患者接受某种药物 $X$ 的可能性，又独立地增加了发生结局 $Y$ 的风险（$X \leftarrow Z \rightarrow Y$），这将导致对 $X$ 与 $Y$ 之间关联的估计产生偏倚。

2.  **选择偏倚 (Selection Bias)**：当研究人群的选择方式与暴露和结局均相关时，就会发生选择偏倚。在 EHR 研究中，这通常与**医疗服务寻求行为 (care-seeking behavior)** 有关。例如，如果一项研究仅纳入在过去一年内至少有一次就诊记录的患者，而暴露（如某种症状）和结局（如另一种疾病）都会增加患者就诊的可能性，那么这种限制就会在暴露和结局之间引入虚假的关联。这在因果图中被称为“对撞机偏倚”(collider bias)，因为就诊记录是一个受暴露和结局共同影响的[对撞机](@entry_id:192770)。

3.  **信息偏倚 (Information Bias)**：指在测量或分类暴露、结局或协变量时存在的系统性误差。
    *   **编码实践的变化**：例如，在研究期间，ICD 编码指南的更新或针对特定患者群体（如接受某药物治疗的患者）的文档改进计划，都可能导致结局的记录方式发生系统性变化，从而引入偏倚。
    *   **差异性测量 (Differential Measurement)**：当测量的强度或频率因暴露状态而异时，就会发生这种情况。例如，如果服用某种药物 $X$ 会触发常规的实验室监测，而未服药者很少接受该检测，那么在服药组中发现由该实验室结果定义的结局 $Y$ 的概率就会被人为地提高。这也被称为**监测偏倚 (surveillance bias)**。

#### 深入探讨特定偏倚

**结局的非差异性误分类**：信息偏倚的一种常见形式是**误分类 (misclassification)**。当结局变量 $Y$ 的测量存在误差时，我们观察到的是一个不完美的版本 $Y^{*}$。如果这种测量误差的概率（即敏感度和特异度）在暴露组和非暴露组之间是相同的，则称之为**非差异性误分类 (nondifferential misclassification)**。一个普遍的结论是，对于一个[二分类](@entry_id:142257)结局，非差异性误分类通常会导致效应估计值向**无效值**（对于风险比或优势比，即 $1.0$）偏倚，也称为**衰减 (attenuation)**。

例如，假设某暴露 $E$ 对结局 $Y$ 的真实风险比 ($RR$) 为 $3.0$。如果用于识别 $Y$ 的算法具有不完美的、但在各组间恒定的敏感度（如 $0.80$）和特异度（如 $0.90$），通过数学推导可以证明，使用该算法得出的观察风险比 $RR_{obs}$ 将会小于 $3.0$，更接近 $1.0$。这表明，即使测量误差是随机的（非差异的），它也会系统性地低估真实的效应大小 [@problem_id:4862756]。如果误分类是**差异性的**（即敏感度或特异度因暴露状态而异），则偏倚的方向和大小将变得不可预测。

**不朽时间偏倚 (Immortal Time Bias)**：这是选择偏倚的一种特殊且[隐蔽](@entry_id:196364)的形式，在药物流行病学研究中尤其常见。当研究者根据暴露发生后的信息来定义暴露组时，就可能引入这种偏倚。一个典型的错误做法是：将研究队列中在某个时间窗口内（如出院后 $30$ 天内）使用了某种药物的患者定义为“暴露组”，并将其全部随访时间从研究开始（如出院日）计入暴露组的风险时间。

这种设计的缺陷在于，要成为“暴露者”，患者必须在未使用药物的情况下“存活”到他们实际用药的那一天。这段从研究开始到实际用药之间的时间段，被错误地归入“暴露组”的风险时间。然而，在这段时间内，患者按定义是不可能死亡或发生结局的——否则他们就没有机会用药并被分入暴露组了。这段“保证存活”的时间就是所谓的**不朽时间 (immortal time)**。

这种错误的风险时间归因会人为地稀释暴露组的事件发生率（因为分母被人为夸大，而分子却没有相应增加），从而产生一种药物具有保护作用的假象。例如，在一个真实效应为空（即药物无效）的场景中，这种偏倚可能导致计算出的风险比显著小于 $1.0$，错误地指向药物有益 [@problem_id:4862763]。正确的分析方法应将暴露视为一个随时间变化的变量，将患者在用药前的风险时间归为“未暴露”。

#### 缺失数据的挑战

EHR 数据中的缺失值并非偶然，其缺失模式本身就蕴含着信息。统计学上，[缺失数据机制](@entry_id:173251)被分为三类 [@problem_id:4862807]：

1.  **[完全随机缺失](@entry_id:170286) (Missing Completely At Random, MCAR)**：当数据的缺失与任何已观察或未观察的数据都无关时，称之为 MCAR。这是一种理想但罕见的情况。

2.  **[随机缺失](@entry_id:168632) (Missing At Random, MAR)**：当数据的缺失可以完全由已观察到的其他变量来解释时，称之为 MAR。即在给定观察数据后，缺失与该数据本身的未观察值无关。例如，血压值的缺失主要取决于就诊类型（一个已观察变量）——远程医疗访视通常不测量血压，而线下访视则会测量。如果就诊类型是唯一决定血压是否被测量的因素，那么血压的缺失就是 MAR。

3.  **[非随机缺失](@entry_id:163489) (Missing Not At Random, MNAR)**：当数据的缺失与该数据本身的未观察值相关时，即使在控制了所有已观察变量之后，这种相关性依然存在，则称之为 MNAR。这在 EHR 数据中非常普遍。例如，临床医生通常会基于对患者病情的“怀疑”（这是一种未记录在 EHR 中的潜在因素）来决定是否开具某项实验室检查（如[糖化血红蛋白](@entry_id:150571) A1c）。如果患者的真实血糖水平越高，医生越可能怀疑并开具检查，那么糖化血红蛋白的缺失就与其自身的潜在值有关，这便是 MNAR。

在同一个 EHR 数据集里，不同的变量可能遵循不同的缺失机制。例如，血压可能是 MAR，而实验室结果可能是 MNAR。这种**机制的异质性**要求研究人员在处理[缺失数据](@entry_id:271026)时，必须仔细考虑其背后的临床工作流程，并选择合适的统计方法（如[多重插补](@entry_id:177416)或[敏感性分析](@entry_id:147555)）来应对。

### 伦理与法规框架

最后，所有使用人类数据的研究，无论其形式如何，都必须在一个健全的伦理和法规框架内进行。

使用 EHR 数据进行研究同样受到**贝尔蒙特报告 (Belmont Report)** 中确立的三项基本伦理原则的约束 [@problem_id:4862817]：

1.  **尊重个人 (Respect for Persons)**：该原则要求将个体视为自主的代理人，并为自主能力受损者提供保护。在研究中，这主要通过**知情同意 (informed consent)** 来实现。然而，对于涉及数万名患者的大规模回顾性 EHR 研究，逐一获取知情同意通常是**不切实际的 (impracticable)**。在这种情况下，美国的**通用规则 (Common Rule)** 和 **HIPAA 隐私规则**允许**机构审查委员会 (Institutional Review Board, IRB)** 批准**豁免知情同意 (waiver of informed consent)**，前提是研究风险极小，豁免不会对受试者的权利和福祉产生不利影响，且不豁免则研究无法进行。对于纯粹的回顾性数据分析，这一路径是适当的。但如果研究计划包括对患者进行**重新联系**（例如，进行一项新的调查），那么获取知情同意通常是必要的，因为联系的可行性本身就削弱了“不切实际”这一豁免理由。

2.  **有利 (Beneficence)**：该原则要求研究者最大化潜在的益处并最小化可能的风险。在 EHR 研究中，益处是产生能够改善未来患者护理的新知识。风险主要是信息泄露导致的隐私和机密性风险。因此，研究者有义务实施强大的技术（如安全计算环境）、管理（如[访问控制](@entry_id:746212)和审计）和法律（如数据使用协议）保障措施，以确保风险-收益平衡对受试者有利。

3.  **公正 (Justice)**：该原则关注研究的负担和惠益的公平分配。这意味着研究对象的选择必须是公平的。在 EHR 研究中，公正原则要求我们避免仅仅为了方便而排除某些人群。例如，以“地址不稳定、随访困难”为由排除无证移民群体，是一种不公正的做法，因为它使一个本已脆弱的群体无法从研究的潜在益处中获益。相反，为了确保研究结果对少数族裔群体同样适用，从而解决潜在的健康不平等问题，而对其进行**[过采样](@entry_id:270705) (oversampling)**，则是公正原则的积极体现。

总之，从 RWD 到 RWE 的旅程充满了方法学上的陷阱和伦理上的考量。只有通过严格遵循[数据质量](@entry_id:185007)、因果推断和伦理审查的原则，我们才能充分利用 EHR 数据的巨大潜力，以可靠和负责任的方式推进医学知识。