{"hands_on_practices": [{"introduction": "理论是实践的基石。在数据库领域，结构化查询语言 (SQL) 是关系代数这一理论模型的强大实践。理解两者之间的联系与区别，特别是集合语义（理论）与多重集语义（SQL 默认）的差异，对于编写精确无误的查询至关重要。本练习 [@problem_id:4845746] 将指导你将一个关系代数表达式转换为等效的 SQL 查询，并计算结果，从而加深你对选择、投影和去重等核心操作的理解。", "problem": "一家医院维护一个实验室观察关系 $\\text{Observation}(\\text{obs\\_id}, \\text{pid}, \\text{loinc\\_code}, \\text{value}, \\text{effective\\_time})$，其中 $\\text{obs\\_id}$ 是主键，$\\text{pid}$ 是引用患者主数据的患者标识符（PID）。逻辑观察标识符名称和编码（Logical Observation Identifiers Names and Codes, LOINC）对实验室检验使用标准化代码；LOINC 代码 $\\text{'718-7'}$ 代表血液血红蛋白检测。该数据管理系统基于结构化查询语言（SQL），默认使用包语义，除非明确要求消除重复项。\n\n请仅使用关系代数选择和投影的核心定义，以及集合与包语义的概念：\n- 推导关系代数表达式，该表达式返回在 $\\text{Observation}$ 中至少有一条血红蛋白观察记录的唯一患者标识符集合。\n- 写出一个返回相同标识符集合的等效 SQL 查询，并通过引用选择、投影和消除重复项的语义来证明它们的等效性。\n\n对于 $\\text{Observation}$ 关系的一个特定摘录，假设 $\\text{loinc\\_code} = \\text{'718-7'}$ 的行在患者中的分布如下：\n- $\\text{$450$}$ 名患者恰好有 $\\text{$1$}$ 条这样的行。\n- $\\text{$380$}$ 名患者恰好有 $\\text{$2$}$ 条这样的行。\n- $\\text{$250$}$ 名患者恰好有 $\\text{$3$}$ 条这样的行。\n- $\\text{$20$}$ 名患者恰好有 $\\text{$4$}$ 条这样的行。\n- $\\text{$100$}$ 名患者恰好有 $\\text{$5$}$ 条这样的行。\n\n假设除了上述描述的患者外，没有其他患者的 $\\text{loinc\\_code} = \\text{'718-7'}$，并且任何系统级别的重复都已反映在上述计数中。在这些条件下，计算你的 SQL 查询返回的唯一患者标识符的数量。将你的最终数值答案表示为整数。", "solution": "我们从关系模型的核心定义开始：\n\n- 选择（Selection）：对于一个关系 $R$ 和一个谓词 $\\theta$，选择算子 $\\sigma_{\\theta}(R)$ 返回 $R$ 中满足 $\\theta$ 的元组子集。它保留 $R$ 的所有属性，同时筛选行。\n- 投影（Projection）：对于一个关系 $R$ 和一个属性列表 $A$，投影算子 $\\pi_{A}(R)$ 返回限制在属性 $A$ 上的元组集合，由于关系代数使用集合语义，因此会消除重复的元组。\n\n在 SQL（结构化查询语言）中，没有 $\\text{DISTINCT}$ 的查询会返回一个行的包（多重集），可能包含重复项。添加 $\\text{DISTINCT}$ 会强制消除重复项，使结果与关系代数投影中的集合语义保持一致。\n\n任务1：推导关系代数表达式。我们想要获得至少有一条血红蛋白观察记录的唯一患者标识符集合。设血红蛋白代码为 $\\text{'718-7'}$。我们首先使用选择操作选出血红蛋白的行，然后投影出患者标识符属性：\n$$\n\\pi_{\\text{pid}}\\big(\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}(\\text{Observation})\\big).\n$$\n根据定义，$\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}(\\text{Observation})$ 将关系筛选出 LOINC 代码等于 $\\text{'718-7'}$ 的行，然后 $\\pi_{\\text{pid}}(\\cdot)$ 提取患者标识符并移除重复项，从而得到一个唯一的 PID 集合。\n\n任务2：写出等效的 SQL 查询并证明其等效性。与之对应的 SQL 查询通过 $\\text{WHERE}$ 子句模拟选择操作，并通过 $\\text{DISTINCT}$ 关键字模拟带消除重复项功能的投影操作，该查询是：\n$\\text{SELECT DISTINCT pid FROM Observation WHERE loinc\\_code = '718-7';}$\n这个查询与关系代数表达式一致，因为：\n- $\\text{WHERE}$ 子句 $\\text{loinc\\_code = '718-7'}$ 是选择操作 $\\sigma_{\\text{loinc\\_code}=\\text{'718-7'}}$ 的 SQL 实现。\n- $\\text{SELECT DISTINCT pid}$ 是带消除重复项功能的投影操作 $\\pi_{\\text{pid}}$ 的 SQL 实现。如果没有 $\\text{DISTINCT}$，SQL 将返回一个包，对于有多个血红蛋白观察记录的患者，可能会重复其 $\\text{pid}$ 值；使用 $\\text{DISTINCT}$ 时，重复项被移除以返回一个集合，这与关系代数的语义相匹配。\n\n任务3：计算返回的唯一患者标识符的数量。设 $x_{k}$ 表示在 $\\text{Observation}$ 中恰好有 $k$ 行满足 $\\text{loinc\\_code}=\\text{'718-7'}$ 的患者数量。查询返回的唯一患者数量是至少有一条此类记录的患者总数，即 $x_{k}$ 的总和：\n$$\n\\text{distinct\\_patients} \\;=\\; \\sum_{k \\ge 1} x_{k}.\n$$\n根据问题数据：\n- $x_{1} = 450$,\n- $x_{2} = 380$,\n- $x_{3} = 250$,\n- $x_{4} = 20$,\n- $x_{5} = 100$.\n\n因此，\n$$\n\\text{distinct\\_patients} \\;=\\; 450 + 380 + 250 + 20 + 100 \\;=\\; 1{,}200.\n$$\n无需四舍五入，因为在给定假设下，这是一个精确的整数计数。这个值与底层表的包语义（每个患者可以有多行）以及关系代数中的投影或 SQL 中的 $\\text{DISTINCT}$ 所强制执行的集合语义是一致的：无论每个患者有多少条血红蛋白记录行，每个符合条件的患者都只向结果集贡献一个标识符。", "answer": "$$\\boxed{1200}$$", "id": "4845746"}, {"introduction": "在处理真实的健康数据时，我们不可避免地会遇到数据缺失的情况，在数据库中通常表示为 NULL。将 NULL 错误地理解为零或任何特定值，都可能导致严重的分析偏差和错误的临床结论。此练习 [@problem_id:4845761] 旨在揭示正确处理 NULL 值的极端重要性，通过对比一种天真（但错误）的方法和一种逻辑严谨的方法，让你亲身体验三值逻辑在确保查询准确性中的关键作用。", "problem": "一家医院维护着一张门诊血压记录表，包含 `patient_id`、`encounter_id`、`systolic_mmHg` 和 `diastolic_mmHg` 这几列。`systolic_mmHg` 和 `diastolic_mmHg` 的值可能缺失，在结构化查询语言 (SQL) 中表示为 `NULL`。给定以下一组数据行，每行描述一次就诊记录。对于每行，其属性以有序元组 (`patient_id`, `encounter_id`, `systolic_mmHg`, `diastolic_mmHg`) 的形式展示。数值的单位是毫米汞柱，其值要么是一个非负整数，要么是 `NULL`。\n\n- (A01, E001, $142$, $88$)\n- (A01, E002, NULL, $91$)\n- (B07, E003, $138$, NULL)\n- (B07, E004, NULL, NULL)\n- (C12, E005, $129$, $79$)\n- (C12, E006, $170$, NULL)\n- (D22, E007, NULL, $85$)\n- (D22, E008, NULL, $95$)\n- (E31, E009, $200$, $110$)\n- (E31, E010, $139$, $90$)\n- (F45, E011, $100$, NULL)\n- (F45, E012, $140$, $89$)\n\n在此背景下，用于识别正常血压就诊记录的临床规则是：收缩压严格小于 $140$ 且舒张压严格小于 $90$。在 SQL 中，`NULL` 参与三值逻辑运算，只有当 `WHERE` 子句中的谓词求值结果为真 (true) 时，该行才会被选中。函数 $\\mathrm{COALESCE}$ 返回其参数中第一个非 `NULL` 的值。\n\n一位分析师提出了一种朴素的正常血压查询方法，该方法在应用临床阈值之前，使用 $\\mathrm{COALESCE}$ 将缺失的数值替换为 $0$。另一位分析师则认为，正确的查询必须以一种尊重三值逻辑的方式实现临床规则，不为缺失数据捏造生理数值，并通过应用适当的筛选条件来避免错误分类。\n\n从上述核心定义出发，通过对 SQL 三值逻辑和 $\\mathrm{COALESCE}$ 行为的推理，推导出在存在 `NULL` 值的情况下，SQL `WHERE` 子句应该用来识别正常血压就诊记录的逻辑正确谓词。然后，确定在数据集中，有多少条就诊记录会被朴素的“将缺失值替换为 $0$”的方法错误地标记为正常血压，但不会被正确的方法标记为正常血压。\n\n将你的最终答案以单个整数形式报告。不需要四舍五入。报告的答案中不要包含任何单位。", "solution": "该问题要求对两种不同的结构化查询语言 (SQL) 谓词公式进行严谨分析，这两种公式用于从一个包含缺失值（表示为 `NULL`）的数据集中识别正常血压的患者就诊记录。目标是量化与逻辑正确的方法相比，朴素方法错误分类的就诊记录数量。\n\n首先，我们必须在 SQL 的三值逻辑框架内，正式定义临床规则以及两种提议的谓词的行为。\n\n正常血压就诊记录的临床规则定义为：收缩压严格小于 $140$ mmHg 且舒张压严格小于 $90$ mmHg。设 $S$ 代表 `systolic_mmHg`，$D$ 代表 `diastolic_mmHg`。该条件是一个逻辑合取：\n$$ (S  140) \\land (D  90) $$\n\n在 SQL 中，任何涉及 `NULL` 值的比较（例如 `NULL  140` 或 `138  NULL`）的求值结果不是 `TRUE` 或 `FALSE`，而是第三个逻辑值 `UNKNOWN`。逻辑 `AND` 运算符与 `UNKNOWN` 的运算规则如下：\n- `TRUE AND UNKNOWN` 的求值结果为 `UNKNOWN`。\n- `FALSE AND UNKNOWN` 的求值结果为 `FALSE`。\n- `UNKNOWN AND UNKNOWN` 的求值结果为 `UNKNOWN`。\n\nSQL 的 `WHERE` 子句通过只包含那些指定谓词求值结果为 `TRUE` 的行来筛选结果集。谓词求值结果为 `FALSE` 或 `UNKNOWN` 的行则被排除。\n\n现在我们来分析这两种方法：\n\n**1. 正确的谓词**\n一个逻辑上合理的临床规则实现必须尊重在信息不完整时无法做出明确分类的原则。将该规则直接翻译成 SQL 谓词即可实现这一点：\n$$ \\text{Predicate}_{\\text{Correct}}: \\quad \\text{systolic\\_mmHg}  140 \\text{ AND } \\text{diastolic\\_mmHg}  90 $$\n为了使该谓词的求值结果为 `TRUE`，`systolic_mmHg` 和 `diastolic_mmHg` 都必须非 `NULL`，并且必须满足各自的不等式。如果其中任何一个值为 `NULL`，其对应的比较结果将是 `UNKNOWN`。除非另一个比较的结果明确为 `FALSE`（这将使整个合取式的结果为 `FALSE`），否则该谓词的求值结果将是 `UNKNOWN`，该行将被正确地从正常血压就诊记录的集合中排除。这种方法不会捏造数据，并遵守了缺失信息的语义。\n\n**2. 朴素的谓词**\n朴素的方法首先使用 `COALESCE` 函数将 `NULL` 值替换为 $0$，然后应用比较运算：\n$$ \\text{Predicate}_{\\text{Naive}}: \\quad \\mathrm{COALESCE}(\\text{systolic\\_mmHg}, 0)  140 \\text{ AND } \\mathrm{COALESCE}(\\text{diastolic\\_mmHg}, 0)  90 $$\n这个谓词在科学上是不合理的，因为它为缺失数据赋予了一个不符合生理学的值（$0$ mmHg）。由于 `COALESCE` 总是返回一个非 `NULL` 值（在本例中，是原始测量值或 $0$），这个谓词的求值结果将永远是 `TRUE` 或 `FALSE`，绝不会是 `UNKNOWN`。当数据缺失时，这种强制的二分法会导致错误分类。\n\n**目标**\n任务是找出 `Predicate_Naive` 求值结果为 `TRUE`，而 `Predicate_Correct` 的求值结果不为 `TRUE`（即，求值结果为 `FALSE` 或 `UNKNOWN`）的就诊记录数量。\n\n我们现在将系统地用这两个谓词来评估所有 $12$ 条就诊记录。\n\n设 $P_C$ 为正确谓词的求值结果，$P_N$ 为朴素谓词的求值结果。\n\n- **就诊记录 E001:** ($142$, $88$)\n  - $P_C$: $(142  140) \\land (88  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(142, 0)  140) \\land (\\mathrm{COALESCE}(88, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E002:** (NULL, $91$)\n  - $P_C$: $(\\text{NULL}  140) \\land (91  90) \\rightarrow \\text{UNKNOWN} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(91, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E003:** ($138$, NULL)\n  - $P_C$: $(138  140) \\land (\\text{NULL}  90) \\rightarrow \\text{TRUE} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(138, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 朴素方法错误地将此就诊记录标记为正常血压。\n\n- **就诊记录 E004:** (NULL, NULL)\n  - $P_C$: $(\\text{NULL}  140) \\land (\\text{NULL}  90) \\rightarrow \\text{UNKNOWN} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 朴素方法错误地将此就诊记录标记为正常血压。\n\n- **就诊记录 E005:** ($129$, $79$)\n  - $P_C$: $(129  140) \\land (79  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - $P_N$: $(\\mathrm{COALESCE}(129, 0)  140) \\land (\\mathrm{COALESCE}(79, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - 无错误分类。\n\n- **就诊记录 E006:** ($170$, NULL)\n  - $P_C$: $(170  140) \\land (\\text{NULL}  90) \\rightarrow \\text{FALSE} \\land \\text{UNKNOWN} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(170, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E007:** (NULL, $85$)\n  - $P_C$: $(\\text{NULL}  140) \\land (85  90) \\rightarrow \\text{UNKNOWN} \\land \\text{TRUE} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(85, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 朴素方法错误地将此就诊记录标记为正常血压。\n\n- **就诊记录 E008:** (NULL, $95$)\n  - $P_C$: $(\\text{NULL}  140) \\land (95  90) \\rightarrow \\text{UNKNOWN} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(\\text{NULL}, 0)  140) \\land (\\mathrm{COALESCE}(95, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E009:** ($200$, $110$)\n  - $P_C$: $(200  140) \\land (110  90) \\rightarrow \\text{FALSE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(200, 0)  140) \\land (\\mathrm{COALESCE}(110, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E010:** ($139$, $90$)\n  - $P_C$: $(139  140) \\land (90  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(139, 0)  140) \\land (\\mathrm{COALESCE}(90, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{FALSE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n- **就诊记录 E011:** ($100$, NULL)\n  - $P_C$: $(100  140) \\land (\\text{NULL}  90) \\rightarrow \\text{TRUE} \\land \\text{UNKNOWN} \\rightarrow \\text{UNKNOWN}$\n  - $P_N$: $(\\mathrm{COALESCE}(100, 0)  140) \\land (\\mathrm{COALESCE}(\\text{NULL}, 0)  90) \\rightarrow \\text{TRUE} \\land \\text{TRUE} \\rightarrow \\text{TRUE}$\n  - **错误分类：** 朴素方法错误地将此就诊记录标记为正常血压。\n\n- **就诊记录 E012:** ($140$, $89$)\n  - $P_C$: $(140  140) \\land (89  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - $P_N$: $(\\mathrm{COALESCE}(140, 0)  140) \\land (\\mathrm{COALESCE}(89, 0)  90) \\rightarrow \\text{FALSE} \\land \\text{TRUE} \\rightarrow \\text{FALSE}$\n  - 无错误分类。\n\n错误分类发生在就诊记录 E003、E004、E007 和 E011。在所有这些情况下，正确的谓词求值结果为 `UNKNOWN`（因此该行未被选中），而朴素的谓词求值结果为 `TRUE`（该行被错误选中）。这样被错误标记的就诊记录总数为 $4$。", "answer": "$$\\boxed{4}$$", "id": "4845761"}, {"introduction": "在临床研究和医疗实践中，一项核心任务是从庞大的数据集中筛选出符合特定标准的目标患者群体，即构建“队列”。这个过程通常涉及将多个复杂的纳入和排除标准通过集合运算（如交集、并集和差集）精确地组合起来。本练习 [@problem_id:4845783] 提供了一个微型患者数据集和一套临床规则，让你手动模拟队列构建过程，从而掌握将复杂的临床问题转化为精确数据库逻辑的核心技能。", "problem": "一个卫生系统维护着两个核心关系表：诊断表（Diagnosis）和观察表（Observation），这两个表遵循关系代数中的集合语义。在集合语义下，并集、交集和差集运算会移除重复项，并对唯一的元组集合进行操作。在队列构建中，成员资格是基于患者级别的：如果存在至少一行满足给定谓词的合格记录，则该患者被包含在一个集合中。设国际疾病分类第十次修订版（ICD-10）编码代表诊断概念，糖化血红蛋白（HbA1c）是记录在观察表中的一项实验室观察值。假设两个表都可能包含每个患者随时间变化的多行记录，并且患者标识符是唯一且稳定的。下面所有的集合运算都是在唯一的患者标识符集合上定义的。\n\n给定以下从诊断表和观察表中提取的数据。每条记录列出了患者标识符、概念（ICD-10 编码或 HbA1c）以及从一个共同基准点开始计算的研究日索引（以整天计）。天数为整数。\n\n诊断记录：\n- P01：第 $30$ 天，E11.9；第 $15$ 天，E10.9；第 $40$ 天，I10。\n- P02：第 $25$ 天，E11.65；第 $60$ 天，J45.909。\n- P03：第 $5$ 天，E11.9；第 $110$ 天，E11.9；第 $45$ 天，E78.5。\n- P04：第 $80$ 天，E11.9。\n- P05：第 $50$ 天，E10.9。\n- P06：第 $95$ 天，E11.65。\n- P07：第 $70$ 天，I10。\n- P08：第 $35$ 天，E11.9；第 $90$ 天，E11.9。\n- P09：第 $150$ 天，E11.9；第 $180$ 天，E10.9。\n- P10：第 $20$ 天，E11.9。\n- P11：第 $55$ 天，E78.5。\n- P12：第 $15$ 天，E11.9。\n\n观察记录（糖化血红蛋白值，以小数表示）：\n- P01：第 $50$ 天，HbA1c $8.2$；第 $90$ 天，HbA1c $7.6$。\n- P02：第 $30$ 天，HbA1c $8.5$。\n- P03：第 $50$ 天，HbA1c $7.4$；第 $115$ 天，HbA1c $7.6$。\n- P04：第 $85$ 天，HbA1c $8.1$；第 $130$ 天，HbA1c $8.0$。\n- P05：第 $55$ 天，HbA1c $9.0$。\n- P06：第 $100$ 天，HbA1c $7.5$；第 $140$ 天，HbA1c $7.8$。\n- P07：第 $10$ 天，HbA1c $8.3$；第 $25$ 天，HbA1c $8.6$。\n- P08：第 $40$ 天，HbA1c $7.2$；第 $92$ 天，HbA1c $7.6$。\n- P09：第 $160$ 天，HbA1c $8.4$；第 $100$ 天，HbA1c $7.7$。\n- P10：第 $50$ 天，HbA1c $7.0$；第 $75$ 天，HbA1c $8.1$。\n- P11：第 $60$ 天，HbA1c $8.2$。\n- P12：第 $16$ 天，HbA1c $7.6$；第 $22$ 天，HbA1c $7.6$。\n\n使用诊断和观察谓词以及研究日窗口定义以下患者级别集合：\n- 集合 $\\mathcal{A}$：至少有一次 $2$ 型糖尿病诊断（定义为 ICD-10 编码在 $\\{\\text{E11.9}, \\text{E11.65}\\}$ 中）的患者，诊断日期在闭区间 $[10, 100]$ 内。\n- 集合 $\\mathcal{B}$：至少有一次 HbA1c 值 $\\geq 8.0$ 的患者，记录日期在闭区间 $[20, 120]$ 内。\n- 集合 $\\mathcal{C}$（排除集）：有任何 $1$ 型糖尿病诊断（定义为形式为 $\\text{E10.*}$ 的 ICD-10 编码，例如 E10.9）的患者，诊断日期在闭区间 $[0, 200]$ 内。\n- 集合 $\\mathcal{D}$：在闭区间 $[20, 150]$ 内的两个不同日期有至少两次 HbA1c 值 $\\geq 7.5$ 的患者。\n\n最终队列由集合表达式定义\n$$\n\\mathcal{S} \\;=\\; \\big(\\,(\\mathcal{A} \\cap \\mathcal{B}) \\,\\cup\\, \\mathcal{D}\\,\\big)\\; \\setminus\\; \\mathcal{C},\n$$\n其中每个集合的成员资格是基于患者级别的（一个患者在任何集合中最多出现一次），并且所有运算符都使用集合语义。\n\n计算 $\\mathcal{S}$ 中唯一患者的数量。以整数形式表示您的答案。", "solution": "首先对用户提供的问题进行严格的验证过程。\n\n### 步骤 1：提取已知条件\n- **数据源 1（诊断）：** 一组包含患者标识符、ICD-10 编码和研究日的记录。\n  - $P_{01}$：第 $30$ 天，E11.9；第 $15$ 天，E10.9；第 $40$ 天，I10。\n  - $P_{02}$：第 $25$ 天，E11.65；第 $60$ 天，J45.909。\n  - $P_{03}$：第 $5$ 天，E11.9；第 $110$ 天，E11.9；第 $45$ 天，E78.5。\n  - $P_{04}$：第 $80$ 天，E11.9。\n  - $P_{05}$：第 $50$ 天，E10.9。\n  - $P_{06}$：第 $95$ 天，E11.65。\n  - $P_{07}$：第 $70$ 天，I10。\n  - $P_{08}$：第 $35$ 天，E11.9；第 $90$ 天，E11.9。\n  - $P_{09}$：第 $150$ 天，E11.9；第 $180$ 天，E10.9。\n  - $P_{10}$：第 $20$ 天，E11.9。\n  - $P_{11}$：第 $55$ 天，E78.5。\n  - $P_{12}$：第 $15$ 天，E11.9。\n- **数据源 2（观察）：** 一组包含患者标识符、观察类型（HbA1c）、值和研究日的记录。\n  - $P_{01}$：第 $50$ 天，HbA1c $8.2$；第 $90$ 天，HbA1c $7.6$。\n  - $P_{02}$：第 $30$ 天，HbA1c $8.5$。\n  - $P_{03}$：第 $50$ 天，HbA1c $7.4$；第 $115$ 天，HbA1c $7.6$。\n  - $P_{04}$：第 $85$ 天，HbA1c $8.1$；第 $130$ 天，HbA1c $8.0$。\n  - $P_{05}$：第 $55$ 天，HbA1c $9.0$。\n  - $P_{06}$：第 $100$ 天，HbA1c $7.5$；第 $140$ 天，HbA1c $7.8$。\n  - $P_{07}$：第 $10$ 天，HbA1c $8.3$；第 $25$ 天，HbA1c $8.6$。\n  - $P_{08}$：第 $40$ 天，HbA1c $7.2$；第 $92$ 天，HbA1c $7.6$。\n  - $P_{09}$：第 $160$ 天，HbA1c $8.4$；第 $100$ 天，HbA1c $7.7$。\n  - $P_{10}$：第 $50$ 天，HbA1c $7.0$；第 $75$ 天，HbA1c $8.1$。\n  - $P_{11}$：第 $60$ 天，HbA1c $8.2$。\n  - $P_{12}$：第 $16$ 天，HbA1c $7.6$；第 $22$ 天，HbA1c $7.6$。\n- **集合定义：**\n  - 集合 $\\mathcal{A}$：$\\geq 1$ 次 $2$ 型糖尿病诊断（$\\text{ICD-10} \\in \\{\\text{E11.9}, \\text{E11.65}\\}$）且日期 $d \\in [10, 100]$ 的患者。\n  - 集合 $\\mathcal{B}$：$\\geq 1$ 次 HbA1c 值 $v \\geq 8.0$ 且日期 $d \\in [20, 120]$ 的患者。\n  - 集合 $\\mathcal{C}$：任何 $1$ 型糖尿病诊断（$\\text{ICD-10}$ 形式为 $\\text{E10.*}$）且日期 $d \\in [0, 200]$ 的患者。\n  - 集合 $\\mathcal{D}$：$\\geq 2$ 次 HbA1c 值 $v \\geq 7.5$ 且日期在两个不同日期 $d_{1}, d_{2}$（其中 $d_{1}, d_{2} \\in [20, 150]$ 且 $d_1 \\neq d_2$）的患者。\n- **最终集合表达式：** $\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C}$。\n- **目标：** 计算 $|\\mathcal{S}|$，即最终集合 $\\mathcal{S}$ 中的唯一患者数量。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，使用了医学信息学（ICD-10 编码、HbA1c 实验室值、队列定义）和数学（集合论）的标准概念。定义精确无歧义。所提供的数据是自包含的，足以执行所需的计算。该问题是适定问题，会得出一个唯一的整数解。不存在科学、逻辑或事实上的缺陷。\n\n### 步骤 3：结论与行动\n该问题被判定为**有效**。将提供完整的解决方案。\n\n### 解题过程\n通过根据提供的数据和定义构建四个集合（$\\mathcal{A}、\\mathcal{B}、\\mathcal{C}、\\mathcal{D}$），然后应用指定的集合运算来找到最终队列 $\\mathcal{S}$，从而得出解。\n\n**1. 构建集合 $\\mathcal{A}$**\n集合 $\\mathcal{A}$ 包括在闭区间 $[10, 100]$ 内的某一天，至少有一次诊断编码来自 $\\{\\text{E11.9}, \\text{E11.65}\\}$ 的患者。\n- $P_{01}$：第 $30$ 天 E11.9。是 ($30 \\in [10, 100]$)。\n- $P_{02}$：第 $25$ 天 E11.65。是 ($25 \\in [10, 100]$)。\n- $P_{03}$：第 $5$ 天 E11.9（过早），第 $110$ 天 E11.9（过晚）。否。\n- $P_{04}$：第 $80$ 天 E11.9。是 ($80 \\in [10, 100]$)。\n- $P_{05}$：E10.9 不是此集合的有效编码。否。\n- $P_{06}$：第 $95$ 天 E11.65。是 ($95 \\in [10, 100]$)。\n- $P_{07}$：I10 不是有效编码。否。\n- $P_{08}$：第 $35$ 天和第 $90$ 天 E11.9。是 ($35, 90 \\in [10, 100]$)。\n- $P_{09}$：第 $150$ 天 E11.9（过晚）。否。\n- $P_{10}$：第 $20$ 天 E11.9。是 ($20 \\in [10, 100]$)。\n- $P_{11}$：E78.5 不是有效编码。否。\n- $P_{12}$：第 $15$ 天 E11.9。是 ($15 \\in [10, 100]$)。\n因此，患者集合为 $\\mathcal{A} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{08}, P_{10}, P_{12}\\}$。\n\n**2. 构建集合 $\\mathcal{B}$**\n集合 $\\mathcal{B}$ 包括在 $[20, 120]$ 内的某一天，至少有一次 HbA1c 值 $\\geq 8.0$ 的患者。\n- $P_{01}$：第 $50$ 天为 $8.2$。是 ($8.2 \\geq 8.0$ 且 $50 \\in [20, 120]$)。\n- $P_{02}$：第 $30$ 天为 $8.5$。是 ($8.5 \\geq 8.0$ 且 $30 \\in [20, 120]$)。\n- $P_{03}$：值 $7.4, 7.6$ 均 $ 8.0$。否。\n- $P_{04}$：第 $85$ 天为 $8.1$。是 ($8.1 \\geq 8.0$ 且 $85 \\in [20, 120]$)。\n- $P_{05}$：第 $55$ 天为 $9.0$。是 ($9.0 \\geq 8.0$ 且 $55 \\in [20, 120]$)。\n- $P_{06}$：值 $7.5, 7.8$ 均 $ 8.0$。否。\n- $P_{07}$：第 $10$ 天为 $8.3$（过早）；第 $25$ 天为 $8.6$。是 ($8.6 \\geq 8.0$ 且 $25 \\in [20, 120]$)。\n- $P_{08}$：值 $7.2, 7.6$ 均 $ 8.0$。否。\n- $P_{09}$：第 $160$ 天为 $8.4$（过晚）；第 $100$ 天为 $7.7$（值过低）。否。\n- $P_{10}$：第 $75$ 天为 $8.1$。是 ($8.1 \\geq 8.0$ 且 $75 \\in [20, 120]$)。\n- $P_{11}$：第 $60$ 天为 $8.2$。是 ($8.2 \\geq 8.0$ 且 $60 \\in [20, 120]$)。\n- $P_{12}$：值为 $7.6  8.0$。否。\n因此，患者集合为 $\\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{05}, P_{07}, P_{10}, P_{11}\\}$。\n\n**3. 构建集合 $\\mathcal{C}$**\n集合 $\\mathcal{C}$ 是一个排除集，包含在 $[0, 200]$ 内的某一天，有任何以 'E10' 开头的诊断编码的患者。\n- $P_{01}$：第 $15$ 天 E10.9。是 ($15 \\in [0, 200]$)。\n- $P_{05}$：第 $50$ 天 E10.9。是 ($50 \\in [0, 200]$)。\n- $P_{09}$：第 $180$ 天 E10.9。是 ($180 \\in [0, 200]$)。\n所有其他患者没有匹配 E10.* 的诊断编码。\n因此，患者集合为 $\\mathcal{C} = \\{P_{01}, P_{05}, P_{09}\\}$。\n\n**4. 构建集合 $\\mathcal{D}$**\n集合 $\\mathcal{D}$ 包括在 $[20, 150]$ 内的两个不同日期，至少有两次 HbA1c 值 $\\geq 7.5$ 的患者。\n- $P_{01}$：第 $50$ 天为 $8.2$，第 $90$ 天为 $7.6$。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{02}$：只有一条记录。否。\n- $P_{03}$：第 $115$ 天为 $7.6$。只有一条合格记录（$7.4  7.5$）。否。\n- $P_{04}$：第 $85$ 天为 $8.1$，第 $130$ 天为 $8.0$。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{05}$：只有一条记录。否。\n- $P_{06}$：第 $100$ 天为 $7.5$，第 $140$ 天为 $7.8$。是（在 $[20, 150]$ 内的不同日期有两个值 $\\geq 7.5$）。\n- $P_{07}$：第 $25$ 天为 $8.6$。只有一条合格记录（第 $10$ 天超出范围）。否。\n- $P_{08}$：第 $92$ 天为 $7.6$。只有一条合格记录（$7.2  7.5$）。否。\n- $P_{09}$：第 $100$ 天为 $7.7$。只有一条合格记录（第 $160$ 天超出范围）。否。\n- $P_{10}$：第 $75$ 天为 $8.1$。只有一条合格记录（$7.0  7.5$）。否。\n- $P_{11}$：只有一条记录。否。\n- $P_{12}$：第 $22$ 天为 $7.6$。只有一条合格记录（第 $16$ 天超出范围）。否。\n因此，患者集合为 $\\mathcal{D} = \\{P_{01}, P_{04}, P_{06}\\}$。\n\n**5. 计算最终集合 $\\mathcal{S}$**\n最终队列 $\\mathcal{S}$ 是通过表达式 $\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C}$ 计算得出的。\n首先，计算交集 $\\mathcal{A} \\cap \\mathcal{B}$：\n$\\mathcal{A} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{08}, P_{10}, P_{12}\\}$\n$\\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{05}, P_{07}, P_{10}, P_{11}\\}$\n$\\mathcal{A} \\cap \\mathcal{B} = \\{P_{01}, P_{02}, P_{04}, P_{10}\\}$\n\n接下来，计算结果与 $\\mathcal{D}$ 的并集：\n$(\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D} = \\{P_{01}, P_{02}, P_{04}, P_{10}\\} \\cup \\{P_{01}, P_{04}, P_{06}\\}$\n$(\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{10}\\}$\n\n最后，计算与排除集 $\\mathcal{C}$ 的差集：\n$\\mathcal{S} = ((\\mathcal{A} \\cap \\mathcal{B}) \\cup \\mathcal{D}) \\setminus \\mathcal{C} = \\{P_{01}, P_{02}, P_{04}, P_{06}, P_{10}\\} \\setminus \\{P_{01}, P_{05}, P_{09}\\}$\n患者 $P_{01}$ 存在于被减去的集合中，因此被移除。患者 $P_{05}$ 和 $P_{09}$ 不在中间集合中，因此它们在 $\\mathcal{C}$ 中的存在对结果没有影响。\n$\\mathcal{S} = \\{P_{02}, P_{04}, P_{06}, P_{10}\\}$\n\n最终集合 $\\mathcal{S}$ 中的唯一患者数量是该集合的基数，即 $|\\mathcal{S}|$。\n$|\\mathcal{S}| = |\\{P_{02}, P_{04}, P_{06}, P_{10}\\}| = 4$。\n最终答案是 $4$。", "answer": "$$\\boxed{4}$$", "id": "4845783"}]}