{"hands_on_practices": [{"introduction": "临床数据仓库的核心价值在于整合患者的纵向数据，以追踪其健康状况随时间的变化。然而，如何准确记录患者信息的变化（例如保险计划的变更）是一个关键挑战。本练习将介绍一种名为“缓变维度（SCD）第二类”的标准数据仓库技术，它通过保存历史版本来解决此问题。你将通过一个具体案例，学习如何处理真实世界中常见的、因数据采集缺陷导致的有效期重叠问题 [@problem_id:4826408]。", "problem": "一个临床数据仓库（CDW）维护着一个用于支付方保险覆盖的第二类慢速变化维度（SCD Type 2）。每行代表患者保险属性的一个版本，其业务生效有效期由一个半开区间 $\\left[\\text{effective\\_start}, \\text{effective\\_end}\\right)$ 捕捉，其中 $\\text{effective\\_end}$ 可能是开放式的。该临床数据仓库强制执行自然键的同质性，并致力于每个自然键的业务有效区间不重叠，但现实世界的数据采集缺陷可能会引入重叠的区间，这必须在“as-of”（截至特定时间）查询期间进行协调。\n\n您可以假定的基本事实：\n- 在SCD Type 2中，业务有效区间被建模为 $\\left[\\text{effective\\_start}, \\text{effective\\_end}\\right)$，意味着 $\\text{effective\\_start} \\leq t  \\text{effective\\_end}$ 表示在时间 $t$ 有效。\n- 开放式有效期由 $\\text{effective\\_end} = +\\infty$ 表示。\n- “as-of”操作符返回在时间 $t$ 业务有效的那唯一一行。\n\n考虑一个自然键为 $k = 98765$ 的患者。该维度包含以下行（每个项目符号代表一行）：\n- 代理键 $s = 101$，版本 $v = 1$，$\\text{effective\\_start} = 2023\\text{-}01\\text{-}01$，$\\text{effective\\_end} = 2023\\text{-}12\\text{-}31$，计划名称“Medicaid”，计划代码 $3$，$\\text{etl\\_load\\_ts} = 2023\\text{-}01\\text{-}02\\ \\text{T}\\ 04{:}00$。\n- 代理键 $s = 102$，版本 $v = 2$，$\\text{effective\\_start} = 2024\\text{-}01\\text{-}01$，$\\text{effective\\_end} = +\\infty$，计划名称“Commercial A”，计划代码 $1$，$\\text{etl\\_load\\_ts} = 2024\\text{-}01\\text{-}02\\ \\text{T}\\ 05{:}00$。\n- 代理键 $s = 135$，版本 $v = 3$，$\\text{effective\\_start} = 2024\\text{-}03\\text{-}15$，$\\text{effective\\_end} = +\\infty$，计划名称“Commercial A”，计划代码 $1$，$\\text{etl\\_load\\_ts} = 2024\\text{-}03\\text{-}16\\ \\text{T}\\ 05{:}52$。\n\n设“as-of”时间为 $t = 2024\\text{-}06\\text{-}15$。将请求的输出定义为一个单一整数代码 $c^{\\ast}$，它等于在时间 $t$ 生效的患者保险的计划代码。如果在时间 $t$ 没有有效的行，则定义 $c^{\\ast} = 0$。\n\n任务：\n- 仅使用上述SCD Type 2基础语义，确定在 $t = 2024\\text{-}06\\text{-}15$ 时的 $c^{\\ast}$。\n- 在您的推理中，明确论证如何以一种有原则的、确定性的、基于SCD Type 2语义和数据治理的方式处理重叠区间，并证明您的方法对该数据产生唯一的 $c^{\\ast}$。\n\n以单个整数形式提供 $c^{\\ast}$ 的最终值。无需四舍五入，也无需单位。", "solution": "该问题被认为是有效的。这是一个在数据仓库和医学信息学领域内定义明确的问题。它科学地基于慢速变化维度（SCD）的既定原则，内部一致，并包含推导出唯一确定性解决方案所需的信息。核心任务是通过应用标准的数据治理原则来解决一个模糊性问题——业务有效时间区间的重叠，这是该领域中一个常见而实际的挑战。\n\n该问题要求在特定的“as-of”时间 $t = 2024\\text{-}06\\text{-}15$ 时，确定自然键为 $k = 98765$ 的患者的正确保险计划代码，记为 $c^{\\ast}$。每条记录的业务有效性由半开区间 $[\\text{effective\\_start}, \\text{effective\\_end})$ 定义。如果满足条件 $\\text{effective\\_start} \\leq t  \\text{effective\\_end}$，则记录在时间 $t$ 被视为有效。\n\n我们获得了自然键为 $k = 98765$ 的患者的三条记录：\n\\begin{enumerate}\n    \\item 第1行：代理键 $s_1 = 101$，版本 $v_1 = 1$。区间 $[\\text{start}_1, \\text{end}_1) = [2023\\text{-}01\\text{-}01, 2023\\text{-}12\\text{-}31)$。计划代码 $c_1 = 3$。ETL时间戳 $\\text{ts}_1 = 2023\\text{-}01\\text{-}02\\ \\text{T}\\ 04{:}00$。\n    \\item 第2行：代理键 $s_2 = 102$，版本 $v_2 = 2$。区间 $[\\text{start}_2, \\text{end}_2) = [2024\\text{-}01\\text{-}01, +\\infty)$。计划代码 $c_2 = 1$。ETL时间戳 $\\text{ts}_2 = 2024\\text{-}01\\text{-}02\\ \\text{T}\\ 05{:}00$。\n    \\item 第3行：代理键 $s_3 = 135$，版本 $v_3 = 3$。区间 $[\\text{start}_3, \\text{end}_3) = [2024\\text{-}03\\text{-}15, +\\infty)$。计划代码 $c_3 = 1$。ETL时间戳 $\\text{ts}_3 = 2024\\text{-}03\\text{-}16\\ \\text{T}\\ 05{:}52$。\n\\end{enumerate}\n\n第一步是识别在“as-of”时间 $t = 2024\\text{-}06\\text{-}15$ 有效的行集合 $R_{\\text{valid}}$。我们对每一行测试其有效性条件。\n\n对于第1行：\n区间为 $[2023\\text{-}01\\text{-}01, 2023\\text{-}12\\text{-}31)$。条件是 $2023\\text{-}01\\text{-}01 \\leq 2024\\text{-}06\\text{-}15  2023\\text{-}12\\text{-}31$。此条件为假，因为 $2024\\text{-}06\\text{-}15$ 不小于 $2023\\text{-}12\\text{-}31$。因此，第1行在时间 $t$ 无效。\n\n对于第2行：\n区间为 $[2024\\text{-}01\\text{-}01, +\\infty)$。条件是 $2024\\text{-}01\\text{-}01 \\leq 2024\\text{-}06\\text{-}15  +\\infty$。此条件为真。因此，第2行是时间 $t$ 有效记录的候选者。\n\n对于第3行：\n区间为 $[2024\\text{-}03\\text{-}15, +\\infty)$。条件是 $2024\\text{-}03\\text{-}15 \\leq 2024\\text{-}06\\text{-}15  +\\infty$。此条件为真。因此，第3行也是时间 $t$ 有效记录的候选者。\n\n我们已经为“as-of”时间 $t$ 识别出两个有效行，$R_{\\text{valid}} = \\{\\text{第2行}, \\text{第3行}\\}$。这产生了一个冲突，因为“as-of”操作符的定义是返回*唯一*的一行。问题陈述预见到了这一点，指出“数据采集缺陷可能会引入重叠的区间，这必须进行协调”。需要一个有原则的、确定性的解决方案。\n\n在数据仓库和数据治理中，当由于数据质量问题导致多条记录声称在同一业务时间有效时，通过选择代表最新或最权威信息的记录来解决冲突。ETL加载时间戳 $\\text{etl\\_load\\_ts}$ 为此解决方案提供了必要的元数据。它记录了信息被采集到仓库中的系统时间。较晚的时间戳表示较新的信息，这被假定为取代任何较早的、冲突的信息。这种“最后写入者获胜”的策略是维护数据完整性的一项标准原则。\n\n因此，从候选集合 $R_{\\text{valid}}$ 中选择唯一有效行 $r^{\\ast}$ 的确定性规则是选择具有最大 $\\text{etl\\_load\\_ts}$ 的那一行。形式上，$r^{\\ast} = \\arg\\max_{r_i \\in R_{\\text{valid}}}(\\text{ts}_i)$。\n\n让我们将此规则应用于两个候选行：\n\\begin{itemize}\n    \\item 第2行：$\\text{ts}_2 = 2024\\text{-}01\\text{-}02\\ \\text{T}\\ 05{:}00$\n    \\item 第3行：$\\text{ts}_3 = 2024\\text{-}03\\text{-}16\\ \\text{T}\\ 05{:}52$\n\\end{itemize}\n比较时间戳，我们发现 $\\text{ts}_3  \\text{ts}_2$。这意味着第3行中的信息是在第2行信息之后加载到临床数据仓库的。因此，在它们的有效区间重叠的时期，第3行是权威记录。其他元数据，如版本号（$v_3  v_2$）和代理键（$s_3  s_2$）与此结论一致，但 `etl_load_ts` 是最直接和最可靠的仲裁者。\n\n唯一确定的有效行是第3行。问题要求从此行中获取计划代码 $c^{\\ast}$。第3行的计划代码给出为 $c_3 = 1$。\n\n因此，在时间 $t = 2024\\text{-}06\\text{-}15$ 生效的患者保险计划代码是 $1$。如果未找到有效行，根据问题定义，答案将是 $c^{\\ast} = 0$，但此处情况并非如此。", "answer": "$$\n\\boxed{1}\n$$", "id": "4826408"}, {"introduction": "一个数据仓库的价值最终取决于其数据的质量。为了系统性地评估和提升数据可信度，我们需要量化数据质量。本练习将引导你使用一个综合评分框架，该框架整合了几个关键的数据质量维度：完整性、一致性和合理性。通过计算加权平均分，你将学习到一种将抽象的数据质量概念转化为具体、可操作指标的实用方法 [@problem_id:4826434]。", "problem": "一家大型教学医院维护着一个临床数据仓库（CDW），该仓库整合了来自多个临床领域的数据。该医院的数据治理委员会每月使用三个规范化指标对每个领域的数据质量进行评估：完整性、一致性和合理性。完整性定义为所需数据元素存在的比例，一致性是遵守模式和编码标准的值的比例，合理性是落在临床可信范围内的值的比例。每个指标的评分都在单位区间 $[0,1]$ 内。\n\n假设委员会已确定，在本月中，特定领域的指标评分为：完整性 $C=0.92$，一致性 $F=0.97$，合理性 $P=0.99$。委员会进一步为这些指标指定了相对重要性权重：完整性权重 $w_C=0.5$，一致性权重 $w_F=0.3$，合理性权重 $w_P=0.2$。这些权重被解释为总和为 $1$ 的非负权衡系数。\n\n从适用于医学信息学评估的基础多属性度量原则出发——即综合数据质量得分应满足 (i) 关于 $[0,1]$ 上指标得分的规范化和凸性，(ii) 每个指标的单调性，以及 (iii) 跨指标的加性无关性——推导出与这些原则一致的综合数据质量得分的一般函数形式，然后计算上述领域该得分的值。将最终结果表示为小数。将您的答案四舍五入到四位有效数字。", "solution": "目标是为完整性、一致性和合理性这三个指标推导出一个综合数据质量得分。每个指标都规范化到单位区间 $[0,1]$，其相对重要性权重 $w_C$、$w_F$ 和 $w_P$ 为非负数且总和为 $1$。\n\n我们从医学信息学质量评估中广泛接受的多属性度量和效用理论的基础出发：\n\n1. 关于 $[0,1]$ 上指标得分的规范化和凸性：如果每个指标 $X \\in \\{C,F,P\\}$ 的得分都在 $[0,1]$ 区间内，并且复合函数 $Q(C,F,P)$ 旨在产生一个规范化得分，那么 $Q$ 应将 $[0,1]^3$ 映射到 $[0,1]$，并尊重同等偏好配置的凸组合。这启发我们采用一种函数形式，即各组成部分得分的凸组合，以确保综合得分保持在 $[0,1]$ 内。\n\n2. 每个指标的单调性：如果任何单个指标在其他指标保持不变的情况下有所改善，则整体数据质量不应下降。形式上，对于每个 $X \\in \\{C,F,P\\}$，$Q$ 关于 $X$ 应是非递减的。具有非负系数的线性形式满足此属性。\n\n3. 加性无关性：指标之间的权衡不依赖于其他指标的水平，因此对混合的偏好可以加性表示。在加性无关性（以及适当的连续性和可解性条件）下，标准的多属性效用理论产生一种加性形式，其中综合得分是单个属性贡献的加权和，权重为反映相对重要性的常数。\n\n根据这些原则，在 $[0,1]$ 上规范化且权重总和为 $1$ 的条件下，唯一（在正仿射缩放和规范化范围内）一致的综合得分是加权算术平均值：\n$$\nQ(C,F,P) = w_C\\,C + w_F\\,F + w_P\\,P,\n$$\n其中 $w_C \\ge 0$，$w_F \\ge 0$，$w_P \\ge 0$，且 $w_C + w_F + w_P = 1$。\n\n我们已知 $C=0.92$，$F=0.97$，$P=0.99$ 以及 $w_C=0.5$，$w_F=0.3$，$w_P=0.2$。代入推导出的公式：\n$$\nQ = (0.5)(0.92) + (0.3)(0.97) + (0.2)(0.99).\n$$\n逐项计算：\n- $(0.5)(0.92) = 0.46$，\n- $(0.3)(0.97) = 0.291$，\n- $(0.2)(0.99) = 0.198$。\n\n求和：\n$$\nQ = 0.46 + 0.291 + 0.198 = 0.949.\n$$\n\n为满足四位有效数字的四舍五入要求，我们将 $0.949$ 表示为四位有效数字 $0.9490$。结果是 $[0,1]$ 内的一个无量纲小数。", "answer": "$$\\boxed{0.9490}$$", "id": "4826434"}, {"introduction": "在利用临床数据进行研究或分析时，保护患者隐私是不可逾越的底线。即使移除了姓名等直接标识符，数据仍可能通过“准标识符”（如年龄、性别和邮政编码）被重新识别。本练习将介绍一种重要的隐私保护技术——$k$-匿名化，它要求每条记录都无法与少于 $k$ 个的个体区分开来。你将通过分析一个假设的数据集，亲手计算并判断其是否满足给定的隐私保护标准 [@problem_id:4826387]。", "problem": "临床数据仓库 (CDW) 聚合了来自多个临床系统的患者级别数据。在一个为二次使用而构建的去标识化提取中，数据管理员将准标识符集 $\\{\\text{age}, \\text{sex}, \\text{three-digit ZIP code}\\}$ 作为形成等价类的属性。根据定义，$k$-匿名性要求每条记录的等价类（在这些准标识符下）至少包含 $k$ 条记录。考虑一个包含 $100{,}000$ 条记录的 CDW 提取，在这些准标识符下被划分为 $500$ 个等价类。等价类大小的直方图如下：$320$ 个类的大小为 $220$，$150$ 个类的大小为 $196$，$20$ 个类的大小为 $8$，以及 $10$ 个类的大小为 $4$。仅使用 $k$-匿名性和等价类的核心定义，首先从第一性原理出发，描述哪些记录在 $k=10$ 时违反了 $k$-匿名性，并解释原因。然后，将 $R(k)$ 定义为数据集中属于未能满足 $k$-匿名性的等价类的记录总数，并为给定的直方图计算 $R(10)$。请用一个整数表示你的最终答案。", "solution": "该问题要求分析一个数据集对 $k$-匿名性原则的遵守情况。我们首先建立基本定义。\n\n等价类是一组记录的集合，这些记录在一组被称为准标识符的已定义属性上是无法区分的。在本题中，准标识符集被指定为 $\\{\\text{age}, \\text{sex}, \\text{three-digit ZIP code}\\}$。单个等价类中的所有记录在这三个属性上具有相同的值。\n\n$k$-匿名性原则指出，如果数据集中的每条记录都属于一个包含至少 $k$ 条记录的等价类，那么该数据集是 $k$-匿名的。设 $s$ 表示任意一个等价类的大小（即记录数）。为了使数据集满足 $k$-匿名性，条件 $s \\ge k$ 必须对数据集中的所有等价类成立。\n\n如果一条记录所在的等价类的大小 $s$ 小于 $k$，那么该记录就违反了 $k$-匿名性。题目指定了 $k=10$。因此，任何属于大小 $s  10$ 的等价类的记录都被认为违反了 $10$-匿名性。这些记录更容易被再识别，因为它们只能关联到一小群个体。\n\n题目提供了一个包含总共 $N=100,000$ 条记录的数据集的等价类大小直方图，该数据集被划分为 $500$ 个类：\n1. 有 $n_1 = 320$ 个类，大小为 $s_1 = 220$。\n2. 有 $n_2 = 150$ 个类，大小为 $s_2 = 196$。\n3. 有 $n_3 = 20$ 个类，大小为 $s_3 = 8$。\n4. 有 $n_4 = 10$ 个类，大小为 $s_4 = 4$。\n\n我们现在必须通过将每个类的大小 $s_i$ 与要求的最小大小 $k=10$ 进行比较，来描述哪些记录违反了 $10$-匿名性。\n\n对于第一组类，大小为 $s_1 = 220$。由于 $220 \\ge 10$，这 $320$ 个类满足 $10$-匿名性标准。这些类中的记录没有违规。\n\n对于第二组类，大小为 $s_2 = 196$。由于 $196 \\ge 10$，这 $150$ 个类也满足 $10$-匿名性标准。这些类中的记录没有违规。\n\n对于第三组类，大小为 $s_3 = 8$。由于 $8  10$，这 $20$ 个类未能满足 $10$-匿名性标准。因此，所有属于这些类的记录都违反了 $10$-匿名性。\n\n对于第四组类，大小为 $s_4 = 4$。由于 $4  10$，这 $10$ 个类也未能满足 $10$-匿名性标准。所有属于这些类的记录都违反了 $10$-匿名性。\n\n题目将 $R(k)$ 定义为数据集中属于未能满足 $k$-匿名性的等价类的记录总数。根据我们的分析，未能满足 $10$-匿名性的类是那些大小为 $s_3=8$ 和 $s_4=4$ 的类。为了计算 $R(10)$，我们必须将所有这些违规类中的记录数相加。\n\n大小为 $s_3=8$ 的 $n_3 = 20$ 个类中的记录总数为：\n$$N_{\\text{violating}, 1} = n_3 \\times s_3 = 20 \\times 8 = 160$$\n\n大小为 $s_4=4$ 的 $n_4 = 10$ 个类中的记录总数为：\n$$N_{\\text{violating}, 2} = n_4 \\times s_4 = 10 \\times 4 = 40$$\n\n违反 $10$-匿名性的记录总数 $R(10)$ 是所有违规类中记录的总和：\n$$R(10) = N_{\\text{violating}, 1} + N_{\\text{violating}, 2} = 160 + 40 = 200$$\n\n因此，数据集中总共有 $200$ 条记录属于大小小于 $10$ 的等价类。", "answer": "$$\n\\boxed{200}\n$$", "id": "4826387"}]}