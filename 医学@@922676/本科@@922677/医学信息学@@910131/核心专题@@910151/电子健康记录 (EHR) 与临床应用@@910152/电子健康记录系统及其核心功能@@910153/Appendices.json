{"hands_on_practices": [{"introduction": "电子健康记录（EHR）系统汇集了来自不同来源的数据，这常常导致单位和格式的不一致。在将这些数据用于临床决策或分析之前，必须对其进行标准化。本实践练习将演示一项基本的数据规范化任务：在不同单位之间转换实验室检测值，这是确保数据质量和实现可靠分析的关键一步。[@problem_id:4837180]", "problem": "一家医院的电子健康记录 (EHR) 系统遵循 Health Level Seven International (HL7) 接口，整合来自多个来源的实验室数据。为了进行下游分析，所有葡萄糖浓度必须归一化到相同的单位。现给定来自某位患者EHR的四个血浆葡萄糖观测值，其中三个值的单位是毫克/分升，一个值的单位是毫摩尔/升：\n$95 \\ \\mathrm{mg/dL}$, $110 \\ \\mathrm{mg/dL}$, $82 \\ \\mathrm{mg/dL}$，以及 $5.2 \\ \\mathrm{mmol/L}$。\n使用D-葡萄糖 $\\mathrm{C}_{6}\\mathrm{H}_{12}\\mathrm{O}_{6}$ 的分子量 $M_{\\mathrm{glucose}} = 180.1559 \\ \\mathrm{g/mol}$，从第一性原理推导从毫克/分升到毫摩尔/升的转换关系，并应用该关系将所有值归一化为毫摩尔/升。然后计算归一化后葡萄糖浓度的平均值。从质量浓度 (单位 $\\mathrm{g/L}$)、摩尔浓度 (单位 $\\mathrm{mol/L}$) 的定义，以及毫克与克、分升与升之间的基本单位关系开始。作为推导的一部分，请论证为何通过常数线性缩放来归一化单位不会改变下游分析中使用的无量纲离散度指标。仅报告归一化后平均值的数值。将您的答案四舍五入至四位有效数字。最终平均值以 $\\mathrm{mmol/L}$ 为单位表示。", "solution": "目标是将所有观测值转换为毫摩尔/升，然后计算平均值。转换关系必须从定义中推导出来。\n\n基本定义和单位关系：\n1. 以克/升为单位的质量浓度为 $c_{m} = \\frac{m}{V}$，其中 $m$ 的单位是 $\\mathrm{g}$，$V$ 的单位是 $\\mathrm{L}$。\n2. 以摩尔/升为单位的摩尔浓度为 $c_{n} = \\frac{n}{V}$，其中 $n$ 的单位是 $\\mathrm{mol}$，它通过摩尔质量 $M$ (单位 $\\mathrm{g/mol}$) 与质量浓度相关联，关系为 $c_{n} = \\frac{c_{m}}{M}$，因为 $n = \\frac{m}{M}$。\n3. 基本单位换算：$1 \\ \\mathrm{mg} = 10^{-3} \\ \\mathrm{g}$ 且 $1 \\ \\mathrm{dL} = 10^{-1} \\ \\mathrm{L}$。\n\n推导从 $\\mathrm{mg/dL}$ 到 $\\mathrm{mmol/L}$ 的转换关系：\n设一个葡萄糖测量值为 $x \\ \\mathrm{mg/dL}$。将其转换为克/升：\n$$\nx \\ \\mathrm{mg/dL} = x \\times \\frac{10^{-3} \\ \\mathrm{g}}{10^{-1} \\ \\mathrm{L}} = x \\times 10^{-2} \\ \\mathrm{g/L}.\n$$\n然后使用摩尔质量 $M_{\\mathrm{glucose}}$ 将其转换为摩尔/升：\n$$\nc_{n} = \\frac{x \\times 10^{-2} \\ \\mathrm{g/L}}{M_{\\mathrm{glucose}} \\ \\mathrm{g/mol}} = \\frac{10^{-2} x}{M_{\\mathrm{glucose}}} \\ \\mathrm{mol/L}.\n$$\n最后，通过乘以 $10^{3}$ 将其转换为毫摩尔/升：\n$$\nc_{\\mathrm{mmol/L}} = \\left( \\frac{10^{-2} x}{M_{\\mathrm{glucose}}} \\right) \\times 10^{3} = \\frac{10 x}{M_{\\mathrm{glucose}}}.\n$$\n因此，对于葡萄糖，从 $\\mathrm{mg/dL}$ 转换为 $\\mathrm{mmol/L}$ 的转换因子是 $\\frac{10}{M_{\\mathrm{glucose}}}$。\n\n将此转换应用于三个 $\\mathrm{mg/dL}$ 观测值（$95$, $110$, $82$），保持 $\\mathrm{mmol/L}$ 观测值（$5.2$）不变：\n$$\n95 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 95}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L},\n$$\n$$\n110 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 110}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L},\n$$\n$$\n82 \\ \\mathrm{mg/dL} \\mapsto \\frac{10 \\times 82}{M_{\\mathrm{glucose}}} \\ \\mathrm{mmol/L}.\n$$\n以 $\\mathrm{mmol/L}$ 为单位的归一化平均值为\n$$\n\\bar{c} = \\frac{1}{4} \\left( \\frac{10 \\times 95}{M_{\\mathrm{glucose}}} + \\frac{10 \\times 110}{M_{\\mathrm{glucose}}} + \\frac{10 \\times 82}{M_{\\mathrm{glucose}}} + 5.2 \\right).\n$$\n合并符号项：\n$$\n\\bar{c} = \\frac{1}{4} \\left( \\frac{10 \\times (95 + 110 + 82)}{M_{\\mathrm{glucose}}} + 5.2 \\right) = \\frac{1}{4} \\left( \\frac{10 \\times 287}{M_{\\mathrm{glucose}}} + 5.2 \\right).\n$$\n现在代入 $M_{\\mathrm{glucose}} = 180.1559 \\ \\mathrm{g/mol}$ 并进行数值计算：\n$$\n\\frac{10}{M_{\\mathrm{glucose}}} = \\frac{10}{180.1559} \\approx 0.0555075,\n$$\n因此三个转换后的值为\n$$\n95 \\mapsto 95 \\times 0.0555075 \\approx 5.2732125,\n$$\n$$\n110 \\mapsto 110 \\times 0.0555075 \\approx 6.105825,\n$$\n$$\n82 \\mapsto 82 \\times 0.0555075 \\approx 4.551615.\n$$\n与现有的 $5.2 \\ \\mathrm{mmol/L}$ 值相加：\n$$\n5.2732125 + 6.105825 + 4.551615 + 5.2 = 21.1306525.\n$$\n计算平均值：\n$$\n\\bar{c} = \\frac{21.1306525}{4} \\approx 5.282663125 \\ \\mathrm{mmol/L}.\n$$\n按要求四舍五入至四位有效数字：\n$$\n\\bar{c} \\approx 5.283 \\ \\mathrm{mmol/L}.\n$$\n\n关于单位归一化对下游分析影响的论证：\n设原始测量值集合（所有单位一致）为 $\\{ x_{i} \\}$，其均值为 $\\mu$，标准差为 $\\sigma$。线性单位转换将同一个正常数缩放因子 $a$ 应用于所有观测值，得到 $\\{ y_{i} \\}$，其中 $y_{i} = a x_{i}$。那么均值转换为 $\\mu_{y} = a \\mu$，标准差转换为 $\\sigma_{y} = a \\sigma$。变异系数为 $\\mathrm{CV} = \\frac{\\sigma}{\\mu}$，因此在缩放变换下，\n$$\n\\mathrm{CV}_{y} = \\frac{\\sigma_{y}}{\\mu_{y}} = \\frac{a \\sigma}{a \\mu} = \\frac{\\sigma}{\\mu} = \\mathrm{CV}.\n$$\n因此，诸如变异系数之类的无量纲离散度指标在线性单位转换下保持不变，这证明了一致的单位归一化不会扭曲此类下游分析的结果。", "answer": "$$\\boxed{5.283}$$", "id": "4837180"}, {"introduction": "现代EHR系统的一个核心功能是提供临床决策支持（CDS），以指导临床实践并提高患者安全性。本练习将带您从头开始设计一个复杂的CDS规则，该规则根据患者的肾功能调整药物剂量。您将从基本的药代动力学原理推导出该逻辑，并了解如何将其形式化以便在EHR系统中实施。[@problem_id:4837222]", "problem": "您正在为电子健康记录（EHR）设计一个临床决策支持计算，用于确定经肾脏清除药物的剂量调整。请使用以下基础药代动力学原理和临床信息学约束作为您推导和算法设计的起点（除这些基础原理外，请勿假定任何快捷公式）：\n\n- 清除率可加性：总清除率等于肾清除率和非肾清除率之和，即 $CL_{\\text{total}} = CL_{\\text{r}} + CL_{\\text{nr}}$。\n- 治疗窗内的线性药代动力学：对于固定剂量，暴露量（以浓度-时间曲线下面积衡量）与总清除率成反比，即 $AUC \\propto \\dfrac{\\text{Dose}}{CL_{\\text{total}}}$。\n- 正常肾功能的固定基线参考：存在一个正常的参考估算肾小球滤过率 (eGFR) $e_{\\text{norm}}$，用于进行比较。\n- 肾脏消除的比例性假设：肾清除率与当前估算肾小球滤过率与正常参考值之比呈线性关系，而非肾清除率不受肾功能影响。\n- 临床决策支持策略约束：EHR 不应仅因肾功能高于正常值而将医嘱剂量增加到基线剂量之上；系统只允许自动进行剂量下调。\n\n定义和输入：\n- 设 $e$ 为当前估算的肾小球滤过率，单位为 $\\text{mL}\\cdot\\text{min}^{-1}\\cdot (1.73\\ \\text{m}^2)^{-1}$。所有 $e$ 的输入均使用此单位。\n- 设 $e_{\\text{norm}}$ 为正常参考估算肾小球滤过率，单位与 $e$ 相同。\n- 设 $f_{\\text{r}}$ 为药物基线总清除率中经肾脏清除部分所占的比例，表示为 $[0,1]$ 区间内的小数。\n- 设 $m_{\\text{floor}}$ 为最低安全剂量乘数的临床下限值，表示为 $[0,1]$ 区间内的小数。\n- 设 $e_{\\text{contra}}$ 为估算肾小球滤过率的禁忌阈值，当 $e  e_{\\text{contra}}$ 时，无论其他因素如何，该药物都应被视为禁忌。此值的单位与 $e$ 相同。\n\n您的任务：\n1) 根据上述基础原理和定义，推导出一个表达式，用于计算当肾功能从 $e_{\\text{norm}}$ 变为 $e$ 时，为维持与基线剂量相等的暴露量所需的剂量调整乘数因子。请执行临床决策支持策略约束，即 EHR 不应建议任何高于基线剂量的剂量增加。\n2) 指定一个布尔规则，用于在估算肾小球滤过率过低或计算出的剂量乘数低于最低安全剂量乘数下限时，将药物标记为禁忌。同时，指定一个布尔值，用于指示是否需要进行剂量调整。\n3) 在临床质量语言 (CQL) 中提供您的决策逻辑的形式化表示，引用快速医疗保健互操作性资源 (FHIR) 工件，确保您的逻辑能够识别最近的相关估算肾小球滤过率“观察”（Observation）记录，并将上述规则应用于活动的“药物请求”（MedicationRequest）。此形式化表示是推理过程的一部分，应在您的解决方案报告中呈现，而非由程序生成。\n4) 实现一个程序，该程序针对一组给定的患者-药物场景测试套件，为每个案例计算：\n   - 最终的剂量乘数（四舍五入到四位小数，无单位），\n   - 一个指示是否需要调整的布尔值，\n   - 一个指示药物是否为禁忌的布尔值。\n   该决策必须是通用的，并且除了您推导所隐含的算术和逻辑运算外，不依赖于任何特定的编程语言。\n\n单位和四舍五入：\n- 所有估算肾小球滤过率值 $e$ 和 $e_{\\text{norm}}$ 的单位均为 $\\text{mL}\\cdot\\text{min}^{-1}\\cdot (1.73\\ \\text{m}^2)^{-1}$。\n- 分数 $f_{\\text{r}}$ 和 $m_{\\text{floor}}$ 是 $[0,1]$ 区间内的小数。\n- 最终的剂量乘数必须四舍五入到四位小数。\n\n测试套件：\n每个测试用例是一个元组 $\\left(e, e_{\\text{norm}}, f_{\\text{r}}, m_{\\text{floor}}, e_{\\text{contra}}\\right)$：\n- 案例 $1$：$\\left(60, 120, 0.5, 0.3, 10\\right)$\n- 案例 $2$：$\\left(15, 120, 0.0, 0.2, 10\\right)$\n- 案例 $3$：$\\left(30, 120, 1.0, 0.2, 10\\right)$\n- 案例 $4$：$\\left(5, 120, 0.8, 0.2, 10\\right)$\n- 案例 $5$：$\\left(140, 120, 0.6, 0.3, 10\\right)$\n- 案例 $6$：$\\left(12, 120, 0.95, 0.3, 10\\right)$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素按顺序对应一个测试用例，并且本身是一个形式为 $\\left[\\text{剂量乘数}, \\text{需要调整}, \\text{禁忌}\\right]$ 的三元列表。\n- 例如，一行输出如 $[[0.7500,True,False],[1.0000,False,False],\\dots]$，其中浮点数四舍五入到四位小数，布尔值按所示方式大写。", "solution": "该问题以既定的药代动力学原理为科学基础，其提法恰当，数据充分且一致，表述客观。因此，该问题被认定为有效，并于下文提供正式解决方案。\n\n该解决方案分四个部分展开：1) 从第一性原理推导剂量调整因子；2) 确定用于临床标记的布尔逻辑；3) 在临床质量语言 (CQL) 中对逻辑进行形式化；4) 开发计算算法。\n\n**1. 剂量调整乘数的推导**\n\n目标是找到一个剂量调整乘数 $m$，当患者的肾功能（以估算肾小球滤过率 $e$ 表示）偏离正常参考值 $e_{\\text{norm}}$ 时，该乘数能够维持恒定的药物暴露量（曲线下面积，AUC）。\n\n根据线性药代动力学原理，暴露量由下式给出：\n$$AUC = \\frac{\\text{Dose}}{CL_{\\text{total}}}$$\n为了在患者当前状态和正常参考状态之间维持恒定的暴露量 ($AUC_{\\text{current}} = AUC_{\\text{norm}}$)，以下关系必须成立：\n$$\\frac{D_{\\text{current}}}{CL_{\\text{total, current}}} = \\frac{D_{\\text{norm}}}{CL_{\\text{total, norm}}}$$\n剂量调整乘数 $m$ 是调整后剂量与正常剂量之比，即 $m = \\frac{D_{\\text{current}}}{D_{\\text{norm}}}$。重新整理该方程可得：\n$$m = \\frac{D_{\\text{current}}}{D_{\\text{norm}}} = \\frac{CL_{\\text{total, current}}}{CL_{\\text{total, norm}}}$$\n因此，该乘数是患者当前总清除率与正常总清除率之比。我们现在必须推导这个比率的表达式。\n\n总清除率是肾清除率 ($CL_r$) 和非肾清除率 ($CL_{nr}$) 的和：$CL_{\\text{total}} = CL_r + CL_{nr}$。\n在基线（正常肾功能）时，我们有 $CL_{\\text{total, norm}} = CL_{\\text{r, norm}} + CL_{\\text{nr}}$。\n肾清除率分数 $f_r$ 在基线时定义为：\n$$f_r = \\frac{CL_{\\text{r, norm}}}{CL_{\\text{total, norm}}}$$\n这使我们能够用基线总清除率来表示基线清除率的各组成部分：\n$$CL_{\\text{r, norm}} = f_r \\cdot CL_{\\text{total, norm}}$$\n$$CL_{\\text{nr}} = (1 - f_r) \\cdot CL_{\\text{total, norm}}$$\n问题指出，非肾清除率 $CL_{\\text{nr}}$ 不受肾功能影响。比例性假设指出，肾清除率与 eGFR 比率呈线性关系：\n$$CL_{\\text{r, current}} = CL_{\\text{r, norm}} \\cdot \\left(\\frac{e}{e_{\\text{norm}}}\\right)$$\n代入 $CL_{\\text{r, norm}}$ 的表达式：\n$$CL_{\\text{r, current}} = \\left(f_r \\cdot CL_{\\text{total, norm}}\\right) \\cdot \\left(\\frac{e}{e_{\\text{norm}}}\\right)$$\n患者当前的总清除率是当前肾清除率与恒定非肾清除率之和：\n$$CL_{\\text{total, current}} = CL_{\\text{r, current}} + CL_{\\text{nr}}$$\n$$CL_{\\text{total, current}} = \\left(f_r \\cdot CL_{\\text{total, norm}} \\cdot \\frac{e}{e_{\\text{norm}}}\\right) + \\left((1 - f_r) \\cdot CL_{\\text{total, norm}}\\right)$$\n提取公因子 $CL_{\\text{total, norm}}$ 得：\n$$CL_{\\text{total, current}} = CL_{\\text{total, norm}} \\left( f_r \\frac{e}{e_{\\text{norm}}} + 1 - f_r \\right)$$\n现在，我们可以通过将此式代入比率 $m = \\frac{CL_{\\text{total, current}}}{CL_{\\text{total, norm}}}$ 来计算乘数 $m$：\n$$m_{\\text{raw}} = 1 - f_r + f_r \\frac{e}{e_{\\text{norm}}}$$\n这个表达式 $m_{\\text{raw}}$ 代表原始调整因子。临床策略约束规定，如果肾功能优于正常水平（即 $e  e_{\\text{norm}}$），则不应增加剂量。这意味着乘数必须以 $1$ 为上限。\n因此，最终计算出的乘数 $m_{\\text{calc}}$ 为：\n$$m_{\\text{calc}} = \\min\\left(1, m_{\\text{raw}}\\right) = \\min\\left(1, 1 - f_r + f_r \\frac{e}{e_{\\text{norm}}}\\right)$$\n\n**2. 布尔逻辑规则的规范**\n\n需要两个布尔标记：一个用于指示禁忌，另一个用于指示是否需要调整。\n\n**禁忌规则 (`contraindicated`):** 如果患者的 eGFR 低于禁忌阈值 ($e_{\\text{contra}}$) 或计算出的剂量乘数 ($m_{\\text{calc}}$) 低于指定的最低安全剂量乘数下限 ($m_{\\text{floor}}$)，则该药物为禁忌。\n$$\\text{contraindicated} = (e  e_{\\text{contra}}) \\lor (m_{\\text{calc}}  m_{\\text{floor}})$$\n\n**需要调整规则 (`adjust_needed`):** 如果最终计算出的剂量乘数不同于默认乘数 $1$，则认为需要进行剂量调整。由于我们的策略将乘数上限设为 $1$，因此只有在剂量减少时才需要调整。\n$$\\text{adjust\\_needed} = (m_{\\text{calc}}  1.0)$$\n\n**3. 在临床质量语言 (CQL) 中的形式化表示**\n\n推导出的逻辑可以在 CQL 中进行形式化表示，以便集成到基于 FHIR 的 EHR 系统中。以下 CQL 代码片段定义了将应用于患者记录的逻辑。\n\n```cql\nlibrary RenalDoseAdjustment version '1.0.0'\nusing FHIR version '4.0.1'\ninclude FHIRHelpers version '4.0.1'\n\ncontext Patient\n\n// Parameters for the specific drug and CDS rule\nparameter \"Normal eGFR\" Decimal default 120.0\nparameter \"Renal Clearance Fraction\" Decimal\nparameter \"Minimum Dose Multiplier Floor\" Decimal\nparameter \"eGFR Contraindication Threshold\" Decimal\n\n// LOINC code for eGFR/1.73 sq m based on serum creatinine\ndefine \"EGFR_LOINC\": Code { code: '33914-3', system: 'http://loinc.org' }\n\n// Retrieve the most recent eGFR observation for the patient\ndefine \"Most Recent eGFR Observation\":\n  First(\n    [Observation: \"EGFR_LOINC\"] O\n      where O.status in { 'final', 'amended', 'corrected' }\n      and O.value is not null\n      sort by effective.to-dateTime() desc\n  )\n\n// Extract the numerical value of the eGFR\ndefine \"Patient eGFR Value\":\n  (\"Most Recent eGFR Observation\".value as Quantity).value\n\n// 1. Derivation of the dose adjustment factor\ndefine \"Raw Dose Multiplier\":\n  (1.0 - \"Renal Clearance Fraction\") + \"Renal Clearance Fraction\" * (\"Patient eGFR Value\" / \"Normal eGFR\")\n\ndefine \"Calculated Dose Multiplier\":\n  if \"Raw Dose Multiplier\"  1.0 then 1.0 else \"Raw Dose Multiplier\"\n\n// 2. Specification of boolean rules\ndefine \"Is Contraindicated\":\n  \"Patient eGFR Value\"  \"eGFR Contraindication Threshold\"\n    or \"Calculated Dose Multiplier\"  \"Minimum Dose Multiplier Floor\"\n\ndefine \"Is Adjustment Needed\":\n  \"Calculated Dose Multiplier\"  1.0\n\n// Final output structure for the CDS logic\ndefine \"Dose Adjustment Recommendation\":\n  Tuple {\n    finalDoseMultiplier: \"Calculated Dose Multiplier\",\n    adjustmentNeeded: \"Is Adjustment Needed\",\n    contraindicated: \"Is Contraindicated\"\n  }\n```\n\n**4. 计算算法摘要**\n\n对于每个测试用例元组 $(e, e_{\\text{norm}}, f_r, m_{\\text{floor}}, e_{\\text{contra}})$：\n1.  计算原始剂量乘数：$m_{\\text{raw}} \\leftarrow 1 - f_r + f_r \\cdot (e / e_{\\text{norm}})$。\n2.  应用无增加策略：$m_{\\text{calc}} \\leftarrow \\min(1.0, m_{\\text{raw}})$。\n3.  评估禁忌规则：$\\text{contraindicated} \\leftarrow (e  e_{\\text{contra}}) \\lor (m_{\\text{calc}}  m_{\\text{floor}})$。\n4.  评估调整规则：$\\text{adjust\\_needed} \\leftarrow (m_{\\text{calc}}  1.0)$。\n5.  为便于报告，将最终乘数四舍五入到四位小数：$m_{\\text{final}} \\leftarrow \\text{round}(m_{\\text{calc}}, 4)$。\n6.  组装最终结果元组：$[m_{\\text{final}}, \\text{adjust\\_needed}, \\text{contraindicated}]$。\n\n此算法在最终答案中提供的 Python 程序中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes dose adjustment recommendations based on pharmacokinetic principles.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (e, e_norm, f_r, m_floor, e_contra)\n    test_cases = [\n        (60, 120, 0.5, 0.3, 10),\n        (15, 120, 0.0, 0.2, 10),\n        (30, 120, 1.0, 0.2, 10),\n        (5, 120, 0.8, 0.2, 10),\n        (140, 120, 0.6, 0.3, 10),\n        (12, 120, 0.95, 0.3, 10),\n    ]\n\n    results_for_print = []\n    \n    for case in test_cases:\n        e, e_norm, f_r, m_floor, e_contra = case\n\n        # 1. Calculate the raw dose multiplier\n        # m_raw = (1 - f_r) + f_r * (e / e_norm)\n        # This simplifies to the ratio of current total clearance to normal total clearance.\n        m_raw = 1 - f_r + f_r * (e / e_norm)\n\n        # 2. Apply the clinical decision support policy constraint: no dose increase\n        m_calc = min(1.0, m_raw)\n\n        # 3. Evaluate the boolean rule for contraindication\n        # Contraindicated if eGfr is too low OR the multiplier is below the safe floor.\n        is_contraindicated = (e  e_contra) or (m_calc  m_floor)\n\n        # 4. Evaluate the boolean rule for whether an adjustment is needed\n        # An adjustment is needed if the final multiplier is less than 1.0.\n        is_adjustment_needed = m_calc  1.0\n\n        # Assemble the result for this case according to the required output types\n        # The dose multiplier must be rounded to four decimal places.\n        dose_multiplier_final = m_calc\n        \n        # Format the individual result list into the specified string format\n        # [dose_multiplier, adjust_needed, contraindicated]\n        # Using an f-string with .4f ensures the float has exactly four decimal places.\n        case_result_str = (\n            f\"[{dose_multiplier_final:.4f},\"\n            f\"{is_adjustment_needed},\"\n            f\"{is_contraindicated}]\"\n        )\n        results_for_print.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The final output is a string representation of a list of lists.\n    # Example: [[0.7500,True,False],[1.0000,False,False],...]\n    print(f\"[{','.join(results_for_print)}]\")\n\nsolve()\n```", "id": "4837222"}, {"introduction": "EHR数据是医学研究的宝贵资源，但其使用受到严格的隐私保护要求的制约。数据脱敏技术对于在保护患者机密性的同时保持数据效用至关重要。本练习模拟了一个脱敏流程，并介绍了$k$-匿名性的概念，让您能够将一个正式的隐私度量标准应用于数据集。[@problem_id:4837190]", "problem": "电子健康记录 (EHR) 去标识化流程必须提供隐私保护，以在基于队列的分析中保留数据效用。考虑一个来自单一城市卫生系统的 $16$ 条住院就诊记录的数据集，其目标是针对一组指定的准标识符实现 $k$-匿名性。该流程将通过令牌化转换直接标识符，通过泛化转换准标识符，然后应用单遍抑制策略。使用下文的定义和规则来计算所达到的 $k$-匿名性。\n\n基本基础：\n- 准标识符是一组属性，当它们组合在一起时，可以区分个体，但其本身不是直接标识符。如果由所选准标识符集引发的每个等价类至少包含 $k$ 条记录，则该数据集相对于该准标识符集是 $k$-匿名的。\n- 令牌化是一种映射，它用不可逆的令牌替换直接标识符，同时保留引用完整性。\n- 泛化是一种根据预先指定的函数将特定值映射到更广泛类别的映射，以降低可识别性。\n\n流程设计：\n- 直接标识符：病历号和姓名通过令牌化函数 $T$ 映射为随机令牌。具体来说，如果一个直接标识符属性是 $x$，则 $T(x)$ 是一个随机分配的令牌，对于每个不同的 $x$ 都是唯一的，并且没有可逆的解码方法。\n- 准标识符：年龄（以年为单位）$a$，性别 $s \\in \\{\\text{F}, \\text{M}\\}$，三位数邮政编码前缀 $z_{3}$，入院日历季度 $q \\in \\{Q_{1}, Q_{2}, Q_{3}, Q_{4}\\}$，以及来自《国际疾病分类第十次修订本》(ICD$-$10) 的诊断章节 $d$。\n- 泛化函数：\n  - 年龄：$g_{\\text{age}}(a)$ 映射到闭合的十年区间 $[10\\lfloor a/10 \\rfloor,\\,10\\lfloor a/10 \\rfloor + 9]$。\n  - 邮政编码：$g_{\\text{zip}}(z)$ 将一个五位数编码映射为其三位数前缀 $z_{3}$；在此数据集中，所有记录共享 $z_{3} = z_{021}$。\n  - 入院日期：$g_{\\text{date}}(m)$ 将月份索引 $m \\in \\{1,2,\\dots,12\\}$ 映射到季度 $q = Q_{\\lceil m/3 \\rceil}$。\n  - 诊断：$g_{\\text{dx}}$ 将一个 ICD-10 编码映射到其章节（例如，$\\text{A}$, $\\text{C}$, $\\text{E}$, $\\text{G}$, $\\text{I}$, $\\text{J}$, $\\text{L}$），用 $d$ 表示。\n\n抑制策略（单遍）：\n- 应用 $T$ 和所有 $g$ 函数后，计算由元组 $(g_{\\text{age}}(a), s, z_{3}, q, d)$ 引发的等价类及其频率。\n- 对于频率严格小于 $3$ 的任何等价类，通过将该类中所有记录的诊断章节 $d$ 替换为特殊符号 $\\star$ 来对其进行抑制。\n- 使用元组 $(g_{\\text{age}}(a), s, z_{3}, q, d')$ 重新计算等价类，其中 $d' \\in \\{\\text{A}, \\text{C}, \\text{E}, \\text{G}, \\text{I}, \\text{J}, \\text{L}, \\star\\}$ 是抑制后的诊断标记。不应用进一步的抑制迭代。\n\n数据集（已用泛化的准标识符表示）：\n- 记录 $1$–$4$：$([30,39], \\text{F}, z_{021}, Q_{1}, \\text{E})$。\n- 记录 $5$–$7$：$([30,39], \\text{F}, z_{021}, Q_{1}, \\text{I})$。\n- 记录 $8$–$9$：$([30,39], \\text{F}, z_{021}, Q_{1}, \\text{C})$。\n- 记录 $10$：$([30,39], \\text{F}, z_{021}, Q_{1}, \\text{G})$。\n- 记录 $11$–$13$：$([40,49], \\text{M}, z_{021}, Q_{2}, \\text{J})$。\n- 记录 $14$：$([40,49], \\text{M}, z_{021}, Q_{2}, \\text{A})$。\n- 记录 $15$–$16$：$([40,49], \\text{M}, z_{021}, Q_{2}, \\text{L})$。\n\n任务：\n- 完全按照指定的方式应用该流程，计算抑制后的最终等价类频率，并确定数据集相对于抑制后的准标识符 $(g_{\\text{age}}(a), s, z_{3}, q, d')$ 所达到的 $k$-匿名性。\n- 将最终答案表示为单个整数。无需四舍五入。", "solution": "该问题陈述被认为是有效的，因为它科学地基于数据隐私原则（$k$-匿名性），问题设定良好，有明确的目标和确定性规则，并且语言客观。它是自包含、一致的，并要求将指定的算法应用于给定的数据集，这是计算科学中的标准程序。\n\n任务是确定一个包含 $16$ 条记录的数据集在应用特定的去标识化流程后所达到的 $k$-匿名性。该流程涉及准标识符 (QI) 的泛化和单遍抑制策略。最终的 $k$-匿名性是后处理数据集中任何等价类的最小大小。\n\n抑制前的准标识符是年龄组 $g_{\\text{age}}(a)$、性别 $s$、邮政编码前缀 $z_{3}$、入院季度 $q$ 和诊断章节 $d$。一个等价类由这些值的唯一元组定义。所提供的数据集已经过泛化处理。\n\n首先，我们根据元组 $(g_{\\text{age}}(a), s, z_{3}, q, d)$ 识别初始等价类及其频率。\n\n该数据集包含 $16$ 条记录，这些记录被划分为以下初始等价类：\n1.  年龄组 $[30,39]$，性别 F，邮政编码 $z_{021}$，季度 $Q_1$，诊断 E：\n    类 $C_1 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{E})$\n    频率：$|C_1| = 4$（来自记录 $1$–$4$）。\n2.  年龄组 $[30,39]$，性别 F，邮政编码 $z_{021}$，季度 $Q_1$，诊断 I：\n    类 $C_2 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{I})$\n    频率：$|C_2| = 3$（来自记录 $5$–$7$）。\n3.  年龄组 $[30,39]$，性别 F，邮政编码 $z_{021}$，季度 $Q_1$，诊断 C：\n    类 $C_3 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{C})$\n    频率：$|C_3| = 2$（来自记录 $8$–$9$）。\n4.  年龄组 $[30,39]$，性别 F，邮政编码 $z_{021}$，季度 $Q_1$，诊断 G：\n    类 $C_4 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{G})$\n    频率：$|C_4| = 1$（来自记录 $10$）。\n5.  年龄组 $[40,49]$，性别 M，邮政编码 $z_{021}$，季度 $Q_2$，诊断 J：\n    类 $C_5 = ([40,49], \\text{M}, z_{021}, Q_{2}, \\text{J})$\n    频率：$|C_5| = 3$（来自记录 $11$–$13$）。\n6.  年龄组 $[40,49]$，性别 M，邮政编码 $z_{021}$，季度 $Q_2$，诊断 A：\n    类 $C_6 = ([40,49], \\text{M}, z_{021}, Q_{2}, \\text{A})$\n    频率：$|C_6| = 1$（来自记录 $14$）。\n7.  年龄组 $[40,49]$，性别 M，邮政编码 $z_{021}$，季度 $Q_2$，诊断 L：\n    类 $C_7 = ([40,49], \\text{M}, z_{021}, Q_{2}, \\text{L})$\n    频率：$|C_7| = 2$（来自记录 $15$–$16$）。\n\n总记录数为 $|C_1|+|C_2|+|C_3|+|C_4|+|C_5|+|C_6|+|C_7| = 4+3+2+1+3+1+2 = 16$，这与问题陈述一致。\n\n接下来，我们应用单遍抑制策略。该策略规定，对于频率严格小于 $3$ 的任何等价类，其诊断章节 $d$ 将被替换为特殊符号 $\\star$。\n\n我们对每个类评估此条件：\n-   $|C_1| = 4$，不小于 $3$。该类中的记录保持不变。\n-   $|C_2| = 3$，不小于 $3$。该类中的记录保持不变。\n-   $|C_3| = 2$，小于 $3$。这 $2$ 条记录的诊断章节被抑制：\n    $([30,39], \\text{F}, z_{021}, Q_{1}, \\text{C}) \\rightarrow ([30,39], \\text{F}, z_{021}, Q_{1}, \\star)$。\n-   $|C_4| = 1$，小于 $3$。这 $1$ 条记录的诊断章节被抑制：\n    $([30,39], \\text{F}, z_{021}, Q_{1}, \\text{G}) \\rightarrow ([30,39], \\text{F}, z_{021}, Q_{1}, \\star)$。\n-   $|C_5| = 3$，不小于 $3$。该类中的记录保持不变。\n-   $|C_6| = 1$，小于 $3$。这 $1$ 条记录的诊断章节被抑制：\n    $([40,49], \\text{M}, z_{021}, Q_{2}, \\text{A}) \\rightarrow ([40,49], \\text{M}, z_{021}, Q_{2}, \\star)$。\n-   $|C_7| = 2$，小于 $3$。这 $2$ 条记录的诊断章节被抑制：\n    $([40,49], \\text{M}, z_{021}, Q_{2}, \\text{L}) \\rightarrow ([40,49], \\text{M}, z_{021}, Q_{2}, \\star)$。\n\n在此抑制步骤之后，我们根据新的准标识符元组 $(g_{\\text{age}}(a), s, z_{3}, q, d')$ 重新计算等价类，其中 $d'$ 是抑制后的诊断标记。\n\n未受抑制影响的类保持原样：\n-   类 $C'_1 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{E})$，频率为 $|C'_1| = 4$。\n-   类 $C'_2 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\text{I})$，频率为 $|C'_2| = 3$。\n-   类 $C'_3 = ([40,49], \\text{M}, z_{021}, Q_{2}, \\text{J})$，频率为 $|C'_3| = 3$。\n\n被抑制的记录现在被重新分组。\n-   来自 $C_3$ 的 $2$ 条记录和来自 $C_4$ 的 $1$ 条记录都被转换为具有 QI 元组 $([30,39], \\text{F}, z_{021}, Q_{1}, \\star)$。这些记录现在形成一个新的等价类。\n    类 $C'_4 = ([30,39], \\text{F}, z_{021}, Q_{1}, \\star)$。\n    其频率是合并到其中的原始类的频率之和：$|C'_4| = |C_3| + |C_4| = 2 + 1 = 3$。\n-   类似地，来自 $C_6$ 的 $1$ 条记录和来自 $C_7$ 的 $2$ 条记录被转换为具有 QI 元组 $([40,49], \\text{M}, z_{021}, Q_{2}, \\star)$。这些记录形成另一个新的等价类。\n    类 $C'_5 = ([40,49], \\text{M}, z_{021}, Q_{2}, \\star)$。\n    其频率为 $|C'_5| = |C_6| + |C_7| = 1 + 2 = 3$。\n\n最终的等价类集合及其频率如下：\n-   $|C'_1| = 4$\n-   $|C'_2| = 3$\n-   $|C'_3| = 3$\n-   $|C'_4| = 3$\n-   $|C'_5| = 3$\n\n总记录数为 $4+3+3+3+3 = 16$，这证实了记录的守恒。\n\n数据集所达到的 $k$-匿名性被定义为所有最终等价类中的最小频率。我们必须在频率集合 $\\{4, 3, 3, 3, 3\\}$ 中找到最小值。\n$k = \\min(\\{4, 3, 3, 3, 3\\}) = 3$。\n\n因此，在应用去标识化流程后，数据集达到了 $3$-匿名性。", "answer": "$$\\boxed{3}$$", "id": "4837190"}]}