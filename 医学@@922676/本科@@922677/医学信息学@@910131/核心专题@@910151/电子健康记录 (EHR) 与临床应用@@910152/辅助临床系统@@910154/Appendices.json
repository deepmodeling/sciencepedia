{"hands_on_practices": [{"introduction": "临床辅助系统，尤其是在放射科，会产生海量数据。对于任何医学信息学家来说，一项基本技能是准确预测影像检查的存储需求。本练习将指导您计算 CT 和 MR 检查在 PACS 中的存储足迹，将临床采集参数与技术基础设施需求直接联系起来。[@problem_id:4822799]", "problem": "一家医院运营着辅助临床系统，包括检验信息系统 (LIS)、放射学信息系统 (RIS) 和医学影像存档与通信系统 (PACS)。PACS 存储从计算机断层扫描 (CT) 和磁共振 (MR) 成像设备接收的医学数字成像与通信 (DICOM) 图像。使用以下科学既定基础：\n\n- 数字图像由一个矩形像素矩阵组成，每个像素分配有固定的位数。未压缩的像素数据大小由 $(\\text{行数}) \\times (\\text{列数}) \\times (\\text{分配位数})/8$ 字节给出。\n- 对于多层采集，重建层数是覆盖长度除以重建间隔所得值向上取整的最小整数，即 $\\lceil L / \\Delta \\rceil$，其中 $L$ 是覆盖长度，$\\Delta$ 是重建间隔（对于CT）或层厚加间隙（对于MR重建连续层面时）。\n- 在无损压缩中，仅像素数据被压缩。DICOM 头文件元数据不被压缩。如果像素数据以因子 $s$ 进行压缩，则压缩后的像素数据大小是未压缩的像素数据大小除以 $s$。\n- 每个实例的 PACS 存储足迹等于压缩后的像素数据大小加上未压缩的 DICOM 头文件大小。\n\n一项 CT 胸腹盆腔检查和一项 MR 脑部动态检查的配置如下。\n\nCT 检查参数：\n- 纵向覆盖长度 $L_{\\mathrm{CT}} = 1100~\\mathrm{mm}$。\n- 重建间隔 $\\Delta_{\\mathrm{CT}} = 0.8~\\mathrm{mm}$。\n- 期相 $P_{\\mathrm{CT}} = 3$（动脉期、静脉期、延迟期），每个期相使用 $K_{\\mathrm{CT}} = 2$ 种重建核心（软组织和肺）进行重建。\n- 除了轴位重建外，还采集了两幅定位像。\n- 每个实例的矩阵：$512 \\times 512$ 像素，$\\text{分配位数} = 16$。\n- 每个实例的 DICOM 头文件大小 $H = 4096$ 字节。\n- 应用于像素数据的无损压缩因子 $s_{\\mathrm{CT}} = 2.0$。\n\nMR 检查参数：\n- 脑部覆盖长度 $L_{\\mathrm{MR}} = 144~\\mathrm{mm}$，层厚 $\\Delta_{\\mathrm{MR}} = 3~\\mathrm{mm}$，无层间距。\n- 回波 $E_{\\mathrm{MR}} = 2$，动态时间点 $T_{\\mathrm{MR}} = 60$。\n- 每个实例的矩阵：$256 \\times 256$ 像素，$\\text{分配位数} = 16$。\n- 每个实例的 DICOM 头文件大小 $H = 4096$ 字节（与CT相同）。\n- 应用于像素数据的无损压缩因子 $s_{\\mathrm{MR}} = 1.5$。\n\n假设每个期相的 CT 重建层数等于 $\\left\\lceil L_{\\mathrm{CT}} / \\Delta_{\\mathrm{CT}} \\right\\rceil$，MR 的层数等于 $\\left\\lceil L_{\\mathrm{MR}} / \\Delta_{\\mathrm{MR}} \\right\\rceil$。MR 实例数等于层数 $\\times$ 回波 $\\times$ 时间点。对于 CT，轴位实例数等于层数 $\\times$ 期相 $\\times$ 重建核心，再加上两个定位像实例。使用上述基本依据，推导出两项检查合并后的总 PACS 存储足迹。以千兆字节 (GB) 为单位表示您的最终答案，其中 $1~\\mathrm{GB} = 10^{9}$ 字节，并将最终答案四舍五入到四位有效数字。", "solution": "问题陈述已经过验证，并被认为是合理的。它具有科学依据，提法得当，客观，并包含推导唯一解所需的所有必要信息。我们可以开始计算。\n\n目标是计算一台计算机断层扫描 (CT) 检查和一台磁共振 (MR) 检查在医学影像存档与通信系统 (PACS) 上的总存储足迹。总足迹是各项检查足迹的总和。\n\n设 $F_{\\mathrm{total}}$ 是以字节为单位的总存储足迹。我们有：\n$$F_{\\mathrm{total}} = F_{\\mathrm{total, CT}} + F_{\\mathrm{total, MR}}$$\n其中 $F_{\\mathrm{total, CT}}$ 和 $F_{\\mathrm{total, MR}}$ 分别是 CT 和 MR 检查的存储足迹。\n\n首先，我们计算 CT 检查的存储足迹。\n给定的 CT 检查参数如下：\n-   纵向覆盖长度：$L_{\\mathrm{CT}} = 1100~\\mathrm{mm}$\n-   重建间隔：$\\Delta_{\\mathrm{CT}} = 0.8~\\mathrm{mm}$\n-   期相：$P_{\\mathrm{CT}} = 3$\n-   重建核心：$K_{\\mathrm{CT}} = 2$\n-   定位像：$N_{\\mathrm{scout}} = 2$\n-   矩阵维度：$N_{\\mathrm{rows}} = 512$, $N_{\\mathrm{cols}} = 512$\n-   每像素分配位数：$B_{\\mathrm{CT}} = 16$\n-   每个实例的 DICOM 头文件大小：$H = 4096$ 字节\n-   无损压缩因子：$s_{\\mathrm{CT}} = 2.0$\n\n每个期相的重建轴位层数由下式给出：\n$$N_{\\mathrm{slices, CT}} = \\lceil \\frac{L_{\\mathrm{CT}}}{\\Delta_{\\mathrm{CT}}} \\rceil = \\lceil \\frac{1100}{0.8} \\rceil = \\lceil 1375 \\rceil = 1375$$\n轴位实例总数是层数、期相和重建核心的乘积：\n$$N_{\\mathrm{axial, CT}} = N_{\\mathrm{slices, CT}} \\times P_{\\mathrm{CT}} \\times K_{\\mathrm{CT}} = 1375 \\times 3 \\times 2 = 8250$$\nCT 检查的实例总数是轴位实例和定位像的和：\n$$N_{\\mathrm{inst, CT}} = N_{\\mathrm{axial, CT}} + N_{\\mathrm{scout}} = 8250 + 2 = 8252$$\n接下来，我们计算单个 CT 实例的存储大小。未压缩的像素数据大小 $S_{\\mathrm{unc, CT}}$ 为：\n$$S_{\\mathrm{unc, CT}} = \\frac{N_{\\mathrm{rows}} \\times N_{\\mathrm{cols}} \\times B_{\\mathrm{CT}}}{8} = \\frac{512 \\times 512 \\times 16}{8} = 524288~\\text{字节}$$\n压缩后的像素数据大小 $S_{\\mathrm{comp, CT}}$ 是通过应用压缩因子得到的：\n$$S_{\\mathrm{comp, CT}} = \\frac{S_{\\mathrm{unc, CT}}}{s_{\\mathrm{CT}}} = \\frac{524288}{2.0} = 262144~\\text{字节}$$\n每个 CT 实例的足迹 $F_{\\mathrm{inst, CT}}$ 是压缩后像素数据大小和 DICOM 头文件大小的和：\n$$F_{\\mathrm{inst, CT}} = S_{\\mathrm{comp, CT}} + H = 262144 + 4096 = 266240~\\text{字节}$$\nCT 检查的总存储足迹是实例数与每个实例足迹的乘积：\n$$F_{\\mathrm{total, CT}} = N_{\\mathrm{inst, CT}} \\times F_{\\mathrm{inst, CT}} = 8252 \\times 266240 = 2197178880~\\text{字节}$$\n\n其次，我们计算 MR 检查的存储足迹。\n给定的 MR 检查参数如下：\n-   脑部覆盖长度：$L_{\\mathrm{MR}} = 144~\\mathrm{mm}$\n-   层厚：$3~\\mathrm{mm}$\n-   层间距：$0~\\mathrm{mm}$，所以 $\\Delta_{\\mathrm{MR}} = 3~\\mathrm{mm}$\n-   回波：$E_{\\mathrm{MR}} = 2$\n-   动态时间点：$T_{\\mathrm{MR}} = 60$\n-   矩阵维度：$N_{\\mathrm{rows}} = 256$, $N_{\\mathrm{cols}} = 256$\n-   每像素分配位数：$B_{\\mathrm{MR}} = 16$\n-   每个实例的 DICOM 头文件大小：$H = 4096$ 字节\n-   无损压缩因子：$s_{\\mathrm{MR}} = 1.5$\n\n重建的层数是：\n$$N_{\\mathrm{slices, MR}} = \\lceil \\frac{L_{\\mathrm{MR}}}{\\Delta_{\\mathrm{MR}}} \\rceil = \\lceil \\frac{144}{3} \\rceil = \\lceil 48 \\rceil = 48$$\nMR 检查的实例总数是层数、回波和时间点的乘积：\n$$N_{\\mathrm{inst, MR}} = N_{\\mathrm{slices, MR}} \\times E_{\\mathrm{MR}} \\times T_{\\mathrm{MR}} = 48 \\times 2 \\times 60 = 5760$$\n接下来，我们计算单个 MR 实例的存储大小。未压缩的像素数据大小 $S_{\\mathrm{unc, MR}}$ 为：\n$$S_{\\mathrm{unc, MR}} = \\frac{N_{\\mathrm{rows}} \\times N_{\\mathrm{cols}} \\times B_{\\mathrm{MR}}}{8} = \\frac{256 \\times 256 \\times 16}{8} = 131072~\\text{字节}$$\n压缩后的像素数据大小 $S_{\\mathrm{comp, MR}}$ 为：\n$$S_{\\mathrm{comp, MR}} = \\frac{S_{\\mathrm{unc, MR}}}{s_{\\mathrm{MR}}} = \\frac{131072}{1.5}$$\n每个 MR 实例的足迹 $F_{\\mathrm{inst, MR}}$ 为：\n$$F_{\\mathrm{inst, MR}} = S_{\\mathrm{comp, MR}} + H = \\frac{131072}{1.5} + 4096$$\nMR 检查的总存储足迹为：\n$$F_{\\mathrm{total, MR}} = N_{\\mathrm{inst, MR}} \\times F_{\\mathrm{inst, MR}} = 5760 \\times \\left( \\frac{131072}{1.5} + 4096 \\right)$$\n$$F_{\\mathrm{total, MR}} = \\frac{5760}{1.5} \\times 131072 + 5760 \\times 4096 = 3840 \\times 131072 + 23592960$$\n$$F_{\\mathrm{total, MR}} = 503316480 + 23592960 = 526909440~\\text{字节}$$\n\n最后，我们将两次检查的足迹相加，得到总和：\n$$F_{\\mathrm{total}} = F_{\\mathrm{total, CT}} + F_{\\mathrm{total, MR}} = 2197178880 + 526909440 = 2724088320~\\text{字节}$$\n问题要求答案以千兆字节 (GB) 为单位，其中 $1~\\mathrm{GB} = 10^9$ 字节。\n$$F_{\\mathrm{total, GB}} = \\frac{2724088320}{10^9} = 2.72408832~\\mathrm{GB}$$\n四舍五入到四位有效数字，我们得到 $2.724~\\mathrm{GB}$。", "answer": "$$\\boxed{2.724}$$", "id": "4822799"}, {"introduction": "在繁忙的临床环境中，数据完整性可能会受到影响，从而导致“检查拆分”等问题，即单次检查在 PACS 中被分割成多个记录。本练习的核心不是计算，而是批判性思维和系统设计。您将评估几种用于整合这些数据碎片的算法，学习如何根据 DICOM 等既定标准，优先保证数据完整性、标准一致性和临床可用性。[@problem_id:4822786]", "problem": "一家医院的医学影像存档与通信系统 (PACS) 从多个成像设备网关接收医学数字成像和通信 (DICOM) 对象。由于网络延迟和工作流程的可变性，一个逻辑上的放射学检查可能会被多次部分导入，从而创建两个 PACS 检查记录，每个记录都包含该检查的序列和实例的不相交子集。这通常被称为“拆分研究问题”。您需要选择一种最佳方法，该方法既能在操作层面上定义“拆分研究问题”，又能指定一种和解算法，在检测到同一逻辑检查的多个部分导入时，将它们合并为单个 PACS 检查，同时保留放射科医生观察到的预期序列和实例顺序，且不损坏标识符。\n\n假设以下基本事实和约束条件有效：\n- 在 DICOM 中，检查实例唯一标识符 (StudyInstanceUID) 唯一标识一项检查；序列实例唯一标识符 (SeriesInstanceUID) 唯一标识一个序列；服务-对象对实例唯一标识符 (SOPInstanceUID) 唯一标识一个实例。\n- 检查号 (Accession Number) 是放射学信息系统 (RIS) 通常提供的订单标识符。\n- 序列号 (SeriesNumber) 和实例号 (InstanceNumber) 是成像设备提供的序数字段。\n- PACS 不得破坏 DICOM 的唯一性语义；特别是，它不得更改接收到的对象上已有的 UID。\n- 用户界面应呈现稳定的排序，尽可能反映采集的时间顺序。\n\n考虑一个案例，在 $30$ 分钟内同一患者的两次部分导入到达。部分导入 $\\mathcal{A}$ 包含 SeriesInstanceUID 为 $\\{s_1, s_2\\}$ 的序列，部分导入 $\\mathcal{B}$ 包含 $\\{s_2, s_3\\}$ 的序列；两个集合都带有相同的 StudyInstanceUID $u_{\\text{study}}$，但由于竞争条件，每个部分导入都被索引到不同的 PACS 检查记录中。在 $s_2$ 中的一些实例在两次导入中重复出现，且具有相同的 SOPInstanceUID。所有序列都存在 SeriesNumber，但有两个序列共享相同的 SeriesNumber，因为重复使用了某个成像设备协议。一些实例缺少或具有重复的 InstanceNumber 值。大多数实例都存在采集时间 (AcquisitionTime)；当缺失时，则存在内容时间 (ContentTime)。对于横断面图像，存在影像位置（患者）(Image Position (Patient))。\n\n哪个选项最佳地定义了“拆分研究问题”，并提出了一个安全的、符合标准的和解算法，该算法能将部分导入合并为单个 PACS 检查，并保留呈现给用户的序列和实例顺序？\n\nA. 将“拆分研究”定义为“具有相同检查号 (Accession Number) 的两个检查”，然后通过合并所有具有匹配 PatientID 和 Accession Number 的 PACS 检查来进行和解，将所有 StudyInstanceUID、SeriesInstanceUID 和 SOPInstanceUID 重写为一个新的规范集，以使标识符保持一致。呈现合并后的检查时，序列按 SeriesDescription 的字母顺序排序，实例按文件到达时间排序。\n\nB. 将“拆分研究”定义为“包含共享相同 StudyInstanceUID 的对象的多个 PACS 检查记录”，然后通过以下方式进行和解：\n   - 为共享的 StudyInstanceUID 选择一个主检查记录，并将序列和实例的索引条目移动到该记录中，而不修改接收到的 DICOM 对象。\n   - 通过 SOPInstanceUID 相等性对实例进行去重。\n   - 按 SeriesInstanceUID 分组形成序列；通过按 SeriesNumber 升序排序来保留序列顺序，使用最早的 SeriesDate/SeriesTime，然后是 SeriesInstanceUID 的字典顺序作为确定性的平局打破规则；在序列内部通过按 InstanceNumber 升序排序来保留实例顺序，使用 AcquisitionTime，然后是 ContentTime，再然后是几何键（如 Image Position (Patient)），最后是 SOPInstanceUID 的字典顺序作为平局打破规则。\n   - 使用有文档记录的信任策略（例如，优先选择最近接收的完整头信息）解决属性冲突（例如，PatientName、StudyDate），记录审计追踪，并在可用时参考 RIS 的数据，所有这些操作都不得更改 UID。\n   - 将 Accession Number 视为用于检测和监控的辅助信号，而不是 UID 的替代品。\n\nC. 将“拆分研究”定义为“同一 PatientID 在 $24$ 小时内的任意两次导入”，然后通过延迟呈现直到 $24$ 小时超时结束，以使所有数据到达，再通过使用像素相似度（像素数据和 ImageOrientationPatient 的哈希值）对图像进行聚类来重建检查，并忽略 DICOM UID 以避免头信息不一致。序列按质心切片法线排序，实例按像素哈希值排序。\n\nD. 将“拆分研究”定义为“患者在同一日历日采集的所有检查”，然后通过将它们合并到单个记录中，并将 SeriesNumber 从 $1$ 到 $N$ 顺序重新编号以实现整洁的顺序来进行和解。更新所有图像上的 InstanceNumber，使其在合并后的检查中全局唯一，并将这些更改写回到 DICOM 对象中以确保未来的一致性。\n\nE. 将“拆分研究”定义为“同一患者在同一 Accession Number 下的多个 RIS 订单”，然后通过创建一个新的 StudyInstanceUID 来代表所有相关图像的并集，并将所有 SeriesInstanceUID 映射到新值，以确保按 Modality 和 AcquisitionTime 的单调排序来进行和解。优先将 RIS 元数据作为基准真相，取代接收到的图像中任何不同的 DICOM 头信息值。\n\n选择唯一的最佳选项。", "solution": "用户希望我扮演一位严谨的 STEM 教授，来验证并解决一个关于医学影像存档与通信系统 (PACS) 中“拆分研究”问题的问题。\n\n### 问题验证\n\n首先，我必须验证所提供的问题陈述。\n\n#### 步骤 1：提取已知条件\n-   **问题背景**：一个医学影像存档与通信系统 (PACS) 接收医学数字成像和通信 (DICOM) 对象。\n-   **核心问题**：一个逻辑上的放射学检查被分部分导入，创建了多个 PACS 检查记录。这被称为“拆分研究问题”。\n-   **目标**：定义拆分研究问题，并指定一个和解算法来将部分导入合并为单个检查。\n-   **和解要求**：\n    1.  保留预期的序列和实例顺序。\n    2.  不损坏标识符。\n-   **基本事实与约束**：\n    1.  DICOM 中的唯一标识符 (UID)：\n        -   `StudyInstanceUID` 用于检查。\n        -   `SeriesInstanceUID` 用于序列。\n        -   `SOPInstanceUID` 用于实例。\n    2.  `Accession Number`：来自放射学信息系统 (RIS) 的一个标识符。\n    3.  `SeriesNumber` 和 `InstanceNumber`：来自成像设备的序数字段。\n    4.  **关键约束**：PACS **不得**更改接收到的对象上已有的 UID。\n    5.  **UI 要求**：用户界面必须呈现稳定的排序，理想情况下反映采集的时间顺序。\n-   **具体场景**：\n    -   两次部分导入 $\\mathcal{A}$ 和 $\\mathcal{B}$ 在 $30$ 分钟内为同一患者到达。\n    -   两次导入共享相同的 `StudyInstanceUID`，$u_{\\text{study}}$。\n    -   导入 $\\mathcal{A}$ 包含序列 $\\{s_1, s_2\\}$；导入 $\\mathcal{B}$ 包含序列 $\\{s_2, s_3\\}$。\n    -   每次导入被索引到单独的 PACS 检查记录中。\n    -   在重叠的序列 $s_2$ 中，存在具有相同 `SOPInstanceUID` 的重复实例。\n    -   数据质量问题：\n        -   `SeriesNumber` 不是唯一的（两个序列共享相同的编号）。\n        -   `InstanceNumber` 值缺失或重复。\n        -   `AcquisitionTime` 大多存在；`ContentTime` 是备用选项。\n        -   `Image Position (Patient)` 存在于横断面图像中。\n\n#### 步骤 2：使用提取的已知条件进行验证\n1.  **科学依据**：该问题牢固地植根于医学信息学的技术标准和操作现实。DICOM 术语（`StudyInstanceUID`、`SOPInstanceUID`、`Accession Number` 等）的使用是准确的。所描述的场景——由网络或工作流程问题导致的拆分研究，以及来自成像设备的元数据不完善——是 PACS 管理中一个典型而现实的挑战。整个前提在科学和技术上都是合理的。\n2.  **问题定义良好**：这个问题定义得很好。它清晰地定义了一个场景，建立了严格的约束条件（例如，UID 的不可变性），并要求根据这些标准评估几种建议的解决方案。通过将选项与规定要求进行严格比较，可以确定一个“最佳”方法。\n3.  **客观性**：语言是技术性的、精确的，并且没有主观性。约束条件为评估选项提供了一个客观的框架。\n\n问题陈述没有任何缺陷。这是医学信息学领域一个有效的、结构良好的问题。\n\n#### 步骤 3：结论与行动\n问题是**有效的**。我将继续进行解答。\n\n### 解答推导\n\n目标是找到定义和解决拆分研究问题的最佳方法，同时遵守给定的约束。一个正确的解决方案必须满足以下原则：\n\n1.  **正确的定义**：在 DICOM 中，“逻辑研究”的基本标识符是 `StudyInstanceUID`。因此，拆分研究被正确地定义为两个或多个 PACS 内部记录包含共享相同 `StudyInstanceUID` 的 DICOM 对象。其他标识符如 `Accession Number` 或患者人口统计信息是辅助性的，并且对于此特定目的而言不太可靠。\n2.  **数据完整性与不可变性**：UID 不得更改的约束是绝对的。DICOM UID 保证全局唯一性，是数据可追溯性的基石。任何为现有数据创建新 UID 或重写它们的算法都是不合规且具有破坏性的。和解必须是一个非破坏性操作，通常在 PACS 的数据库/索引层面进行，保持原始 DICOM 对象不受影响。\n3.  **去重**：由于同一个实例可能被多次接收，因此需要一个去重机制。DICOM 实例的唯一标识符是其 `SOPInstanceUID`。因此，必须通过比较 `SOPInstanceUID` 来执行去重。\n4.  **稳健的排序**：用户界面必须以具有临床意义的顺序（通常是按时间顺序）呈现序列和实例。鉴于 `SeriesNumber` 和 `InstanceNumber` 据说不可靠（不唯一、缺失），一个稳健的排序算法必须将它们用作主键，但要采用一个确定性的、多层次的平局打破策略。逻辑上的平局打破规则包括时间标签（`AcquisitionTime`、`ContentTime`）、几何标签（用于空间排序的 `Image Position (Patient)`），以及最后，作为最终稳定排序键的唯一标识符本身（`SeriesInstanceUID`、`SOPInstanceUID`）。\n5.  **元数据冲突解决**：当合并来自两个部分导入的研究级信息时，描述性元数据（如 `PatientName`、`StudyDate`）可能会出现冲突。一个健全的系统会有一个预定义的、可审计的策略来解决这些冲突（例如，优先选择最新的数据，优先选择来自 RIS 的数据）。\n\n基于这些原则，我现在将评估每个选项。\n\n### 逐项分析\n\n**A. 将“拆分研究”定义为“具有相同检查号 (Accession Number) 的两个检查”，然后通过合并所有具有匹配 PatientID 和 Accession Number 的 PACS 检查来进行和解，将所有 StudyInstanceUID、SeriesInstanceUID 和 SOPInstanceUID 重写为一个新的规范集，以使标识符保持一致。呈现合并后的检查时，序列按 SeriesDescription 的字母顺序排序，实例按文件到达时间排序。**\n-   **定义**：不正确。使用 `Accession Number` 作为主键是脆弱的。`Accession Number` 不保证唯一，并且可以手动输入，导致错误。这可能导致不同检查的错误合并。正确的键是 `StudyInstanceUID`。\n-   **和解**：违反了一个关键约束。它提议**重写所有 UID**，这被问题陈述明确禁止（“不得更改已有的 UID”）。这是一种破坏性行为，破坏了 DICOM 合规性和数据完整性。\n-   **排序**：不充分。按 `SeriesDescription`（一个自由文本字段）排序是非确定性的，并且没有临床意义。按文件到达时间排序不能反映放射科医生所要求的采集时间顺序。\n-   **结论**：**不正确**。\n\n**B. 将“拆分研究”定义为“包含共享相同 StudyInstanceUID 的对象的多个 PACS 检查记录”，然后通过以下方式进行和解：...**\n-   **定义**：正确。这是对拆分 DICOM 研究的精确、符合标准的定义。\n-   **和解**：所提出的算法非常出色，并遵守了所有约束。\n    -   *合并*：它正确地提议将*索引条目*移动到一个主记录中，这是一个非破坏性的数据库操作，保持了底层的 DICOM 对象及其 UID 不变。\n    -   *去重*：正确地使用 `SOPInstanceUID` 相等性进行去重。\n    -   *排序*：为序列和实例提出了一个全面而稳健的多级排序逻辑，使用主键（`SeriesNumber`、`InstanceNumber`）和一系列确定性的平局打破规则（`AcquisitionTime`、`ContentTime`、几何键，最后是 UID 的字典顺序）。这直接解决了问题中提到的数据质量问题，并满足了 UI 要求。\n    -   *冲突解决*：包括一个健全的、带审计的元数据冲突处理策略，这是一个设计良好的系统的标志。\n    -   *Accession Number 的作用*：正确地将 `Accession Number` 识别为用于监控的有用辅助标识符，但不是合并操作的主键。\n-   **结论**：**正确**。该选项以一种安全、符合标准且稳健的解决方案全面地解决了问题。\n\n**C. 将“拆分研究”定义为“同一 PatientID 在 $24$ 小时内的任意两次导入”，然后通过延迟呈现直到 $24$ 小时超时结束，以使所有数据到达，再通过使用像素相似度（像素数据和 ImageOrientationPatient 的哈希值）对图像进行聚类来重建检查，并忽略 DICOM UID 以避免头信息不一致。序列按质心切片法线排序，实例按像素哈希值排序。**\n-   **定义**：不正确且危险。一个患者在 24 小时内可以有多个不同的检查。这个定义将导致不相关的临床检查被错误地合并。\n-   **和解**：根本上有缺陷。延迟 24 小时查看图像在临床上是不可接受的。提议**忽略 DICOM UID** 是对 DICOM 标准和数据管理常识的公然违反。基于像素的聚类方法计算成本高昂，容易出错，并且在有可靠 UID 可用时完全没有必要。\n-   **排序**：排序方法过于复杂，可能无法产生临床上直观的顺序。\n-   **结论**：**不正确**。\n\n**D. 将“拆分研究”定义为“患者在同一日历日采集的所有检查”，然后通过将它们合并到单个记录中，并将 SeriesNumber 从 $1$ 到 $N$ 顺序重新编号以实现整洁的顺序来进行和解。更新所有图像上的 InstanceNumber，使其在合并后的检查中全局唯一，并将这些更改写回到 DICOM 对象中以确保未来的一致性。**\n-   **定义**：不正确。与选项 C 一样，这个定义会错误地合并在同一天执行的不同检查。\n-   **和解**：有问题。它提议**将更改写回到 DICOM 对象中**。修改原始源数据（`SeriesNumber`、`InstanceNumber`）是一种有风险的做法，会损害数据来源的可靠性。虽然不如更改 UID 严重，但与选项 B 中的非破坏性索引方法相比，这是一个较差的方法。此外，它通过合并不同的检查来解决错误的问题。\n-   **结论**：**不正确**。\n\n**E. 将“拆分研究”定义为“同一患者在同一 Accession Number 下的多个 RIS 订单”，然后通过创建一个新的 StudyInstanceUID 来代表所有相关图像的并集，并将所有 SeriesInstanceUID 映射到新值，以确保按 Modality 和 AcquisitionTime 的单调排序来进行和解。优先将 RIS 元数据作为基准真相，取代接收到的图像中任何不同的 DICOM 头信息值。**\n-   **定义**：不正确。依赖于非唯一的 `Accession Number` 和 RIS 逻辑，而不是决定性的 `StudyInstanceUID`。\n-   **和解**：以最严重的方式违反了一个关键约束。它明确要求**创建一个新的 `StudyInstanceUID`** 并**将 `SeriesInstanceUIDs` 映射到新值**。这直接与“不得更改接收到的对象上已有的 UID”规则相矛盾。此行为破坏了数据的原始身份。\n-   **结论**：**不正确**。\n\n结论：选项 B 是唯一一个为问题提供了正确定义，并提出了一种安全、有效且完全符合 DICOM 标准和问题明确约束的和解策略的选项。", "answer": "$$\\boxed{B}$$", "id": "4822786"}, {"introduction": "一个稳健的 PACS 不仅要正确存储数据，还必须高效地接收数据，避免产生延迟临床诊疗的瓶颈。这个高级练习将向您介绍排队论，这是一个用于建模和分析系统性能的强大数学框架。通过应用 M/M/c 排队模型，您将计算到达 PACS 的检查的预期等待时间，为系统优化和容量规划提供定量依据。[@problem_id:4822802]", "problem": "一家医院的影像归档和通信系统 (PACS) 接收从放射学信息系统 (RIS) 协调、并带有源自检验信息系统 (LIS) 的患者标识符的医学数字成像和通信 (DICOM) 影像检查。为防止接收瓶颈，PACS 使用 $c$ 个相同的网络路由器，这些路由器运行先到先服务 (FCFS) 队列，在存储前接收并验证入站的影像检查。\n\n假设使用以下基本模型来为 PACS 接收子系统建模：\n- 影像检查的到达形成一个泊松过程，其速率为 $\\lambda$ (单位时间内的影像检查数)。\n- 每个路由器提供独立且服从指数分布的服务时间，其速率为 $\\mu$ (单位时间内每个路由器的影像检查数)。\n- 系统在稳态下运行，满足 $\\lambda  c \\mu$。\n\n将该接收子系统建模为 $M/M/c$ 排队模型。仅从上述定义和 $M/M/c$ 模型的稳态生灭平衡出发，推导队列中期望等待时间 $W_q$ 的闭式解析表达式，该表达式是 $\\lambda$、$\\mu$ 和 $c$ 的函数。然后，针对 $\\lambda = 12$ 影像检查/分钟，$\\mu = 5$ 影像检查/分钟/路由器，以及 $c = 3$ 个路由器的科学实际配置，计算 $W_q$ 的值。将 $W_q$ 的最终数值以秒为单位表示，并四舍五入到四位有效数字。", "solution": "本题要求推导 $M/M/c$ 排队系统中队列的期望等待时间 $W_q$，然后对一组特定参数进行数值计算。推导过程必须从基本的稳态生灭平衡方程出发。\n\n该系统被建模为 $M/M/c$ 排队模型，其到达率为 $\\lambda$，每个服务台的服务率为 $\\mu$，共有 $c$ 个相同的服务台。系统处于稳态，这要求满足稳定性条件 $\\lambda  c\\mu$。\n\n设 $P_n$ 为系统中有 $n$ 个影像检查（顾客）的稳态概率，其中 $n = 0, 1, 2, \\dots$。系统的状态是存在的影像检查数量。\n\n该生灭过程的速率特征如下：\n- 到达率（生率）是恒定的，与状态 $n$ 无关：对于所有 $n \\ge 0$，$\\lambda_n = \\lambda$。\n- 服务率（灭率）取决于忙碌的服务台数量。如果系统中有 $n$ 个影像检查，则有 $\\min(n, c)$ 个服务台处于忙碌状态。由于每个服务台的工作速率为 $\\mu$，总服务率为 $\\mu_n = \\min(n, c)\\mu$。\n  - 对于 $1 \\le n  c$，$\\mu_n = n\\mu$。\n  - 对于 $n \\ge c$，$\\mu_n = c\\mu$。\n\n稳态平衡方程表达了这样一个原理：对于每个状态 $n$，进入状态 $n$ 的速率等于离开状态 $n$ 的速率。\n对于状态 $n=0$：\n$\\lambda P_0 = \\mu_1 P_1 \\implies \\lambda P_0 = \\mu P_1$\n对于状态 $1 \\le n  c$：\n$(\\lambda + n\\mu)P_n = \\lambda P_{n-1} + (n+1)\\mu P_{n+1}$\n对于状态 $n \\ge c$：\n$(\\lambda + c\\mu)P_n = \\lambda P_{n-1} + c\\mu P_{n+1}$\n\n通过考虑相邻状态之间的流量，可以简化这些方程，得到细致平衡方程：\n$\\lambda P_{n-1} = \\mu_n P_n$ for $n \\ge 1$。\n\n由此，我们可以用 $P_0$ 来表示 $P_n$：\n对于 $1 \\le n \\le c$：\n$P_n = \\frac{\\lambda}{\\mu_n} P_{n-1} = \\frac{\\lambda}{n\\mu} P_{n-1}$。\n展开这个递推关系，我们得到：\n$P_n = \\frac{\\lambda^n}{n!\\mu^n} P_0 = \\frac{(\\lambda/\\mu)^n}{n!} P_0$。\n\n对于 $n > c$：\n$P_n = \\frac{\\lambda}{\\mu_n} P_{n-1} = \\frac{\\lambda}{c\\mu} P_{n-1}$。\n设服务台利用率为 $\\rho = \\frac{\\lambda}{c\\mu}$。稳定性条件是 $\\rho  1$。\n对于 $n > c$，$P_n = \\rho^{n-c} P_c$。\n将此关系展开回溯到状态 $c$：\n$P_n = \\rho^{n-c} \\frac{(\\lambda/\\mu)^c}{c!} P_0$。\n\n为了求出 $P_0$，我们使用归一化条件 $\\sum_{n=0}^{\\infty} P_n = 1$：\n$$1 = \\sum_{n=0}^{c-1} P_n + \\sum_{n=c}^{\\infty} P_n$$\n$$1 = P_0 \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + P_0 \\sum_{n=c}^{\\infty} \\frac{(\\lambda/\\mu)^c}{c!} \\rho^{n-c}$$\n令 $k = n-c$：\n$$\\sum_{n=c}^{\\infty} \\rho^{n-c} = \\sum_{k=0}^{\\infty} \\rho^k = \\frac{1}{1-\\rho}$$\n这个几何级数收敛，因为 $\\rho  1$。将其代回：\n$$1 = P_0 \\left[ \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + \\frac{(\\lambda/\\mu)^c}{c!} \\frac{1}{1-\\rho} \\right]$$\n因此，$P_0$ 由下式给出：\n$$P_0 = \\left[ \\sum_{n=0}^{c-1} \\frac{(\\lambda/\\mu)^n}{n!} + \\frac{(\\lambda/\\mu)^c}{c! (1 - \\lambda/(c\\mu))} \\right]^{-1}$$\n\n一个到达的影像检查当且仅当所有 $c$ 个服务台都忙碌时才必须等待。这个事件的概率，通常称为爱尔兰C公式 $C(r,c)$，其中 $r=\\lambda/\\mu$，为：\n$$P(\\text{排队}) = \\sum_{n=c}^{\\infty} P_n = P_c \\sum_{k=0}^{\\infty} \\rho^k = \\frac{P_c}{1-\\rho} = P_0 \\frac{(\\lambda/\\mu)^c}{c!(1-\\rho)}$$\n\n队列中的期望等待时间 $W_q$ 可以通过对到达时是否需要排队进行条件分析来求得。\n$W_q = P(\\text{排队}) \\cdot E[W_q | \\text{必须排队}] + P(\\text{不排队}) \\cdot 0$。\n假定一个到达的影像检查必须排队，它会发现系统中已有 $n \\ge c$ 个影像检查。由于指数服务时间的无记忆性，任何正在进行的服务其剩余服务时间仍然服从速率为 $\\mu$ 的指数分布。$c$ 个忙碌服务台的总服务率为 $c\\mu$。因此，到下一次服务完成的时间服从速率为 $c\\mu$ 的指数分布。\n设当一个到达发生时，如果该到达必须排队，队列中的影像检查数量为 $N_q$。在 $n \\ge c$ 的条件下，到达时发现队列中有 $k$ 个影像检查（总共 $n=c+k$ 个）的概率是 $\\frac{P_{c+k}}{P(\\text{排队})} = \\frac{P_c \\rho^k}{P_c/(1-\\rho)} = (1-\\rho)\\rho^k$。这是一个几何分布，其均值为 $E[N_q] = \\frac{\\rho}{1-\\rho}$。\n一个到达的影像检查必须等待其前面的 $N_q$ 个影像检查被服务，再加上当前正在被即将空闲的服务台服务的那个影像检查。等等，这个思路略有偏差。到达的影像检查必须等待 $c$ 个服务台完成 $N_q+1$ 次服务。每次服务完成的期望时间是 $1/(c\\mu)$。因此，条件等待时间是：\n$E[W_q | \\text{必须排队}] = E[N_q+1] \\cdot \\frac{1}{c\\mu} = (E[N_q]+1) \\frac{1}{c\\mu} = \\left(\\frac{\\rho}{1-\\rho} + 1\\right) \\frac{1}{c\\mu} = \\frac{1}{1-\\rho} \\frac{1}{c\\mu} = \\frac{1}{c\\mu - c\\mu\\rho} = \\frac{1}{c\\mu - \\lambda}$。\n这个结果非常简洁：那些必须排队的顾客的期望等待时间是系统超额服务能力的倒数。\n\n队列中的无条件期望等待时间则是：\n$$W_q = P(\\text{排队}) \\cdot \\frac{1}{c\\mu - \\lambda}$$\n代入 $P(\\text{排队})$ 的表达式：\n$$W_q = \\frac{1}{c\\mu - \\lambda} \\left( P_0 \\frac{(\\lambda/\\mu)^c}{c!(1 - \\lambda/(c\\mu))} \\right)$$\n其中 $P_0$ 如上所示。这就是 $W_q$ 的闭式解析表达式。\n\n现在我们为给定的参数计算 $W_q$：\n- $\\lambda = 12$ 影像检查/分钟\n- $\\mu = 5$ 影像检查/分钟/路由器\n- $c = 3$ 个路由器\n\n首先，我们计算无量纲参数：\n- 到达强度，$r = \\frac{\\lambda}{\\mu} = \\frac{12}{5} = 2.4$。\n- 服务台利用率，$\\rho = \\frac{\\lambda}{c\\mu} = \\frac{12}{3 \\times 5} = \\frac{12}{15} = 0.8$。\n稳定性条件 $\\rho  1$ 得到满足。\n\n接下来，我们计算 $P_0^{-1}$ 的各个组成部分：\n求和项：\n$$\\sum_{n=0}^{c-1} \\frac{r^n}{n!} = \\sum_{n=0}^{2} \\frac{(2.4)^n}{n!} = \\frac{(2.4)^0}{0!} + \\frac{(2.4)^1}{1!} + \\frac{(2.4)^2}{2!} = 1 + 2.4 + \\frac{5.76}{2} = 1 + 2.4 + 2.88 = 6.28$$\n排队项：\n$$\\frac{r^c}{c!(1-\\rho)} = \\frac{(2.4)^3}{3!(1-0.8)} = \\frac{13.824}{6 \\times 0.2} = \\frac{13.824}{1.2} = 11.52$$\n现在我们求 $P_0$：\n$$P_0 = (6.28 + 11.52)^{-1} = (17.80)^{-1}$$\n\n接下来，我们计算排队概率 $P(\\text{排队})$：\n$$P(\\text{排队}) = P_0 \\times \\frac{r^c}{c!(1-\\rho)} = \\frac{1}{17.80} \\times 11.52 = \\frac{11.52}{17.80} \\approx 0.647191$$\n\n最后，我们计算以分钟为单位的 $W_q$：\n$$W_q = \\frac{P(\\text{排队})}{c\\mu - \\lambda} = \\frac{11.52 / 17.80}{3 \\times 5 - 12} = \\frac{11.52 / 17.80}{3} = \\frac{11.52}{53.4} \\approx 0.215730337 \\text{ 分钟}$$\n\n题目要求答案以秒为单位，并四舍五入到四位有效数字。\n$$W_q \\text{ (以秒计)} = 0.215730337 \\text{ 分钟} \\times 60 \\frac{\\text{秒}}{\\text{分钟}} \\approx 12.94382022 \\text{ 秒}$$\n四舍五入到四位有效数字，我们得到 $12.94$。", "answer": "$$\\boxed{12.94}$$", "id": "4822802"}]}