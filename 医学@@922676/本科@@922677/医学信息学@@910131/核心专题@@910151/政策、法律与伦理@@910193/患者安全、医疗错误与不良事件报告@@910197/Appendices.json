{"hands_on_practices": [{"introduction": "在患者安全领域，一个核心挑战是不良事件报告不足。任何单一的报告系统，无论是自愿报告还是自动触发，都无法捕获所有发生的事件。本练习介绍了一种强大的统计方法——捕获-再捕获分析 [@problem_id:4852033]，通过比较两个独立来源的数据来估计不良事件的总数。掌握此方法能帮助我们超越观察到的数据，更准确地评估患者安全问题的真实规模。", "problem": "一家三级医院使用两个独立的不良事件报告来源进行患者安全监测：一个是电子健康记录（EHR）内基于规则的触发工具，另一个是自愿性事件报告系统。在一个季度内，触发工具记录了 $n_1 = 120$ 起不良事件，而事件报告系统记录了 $n_2 = 150$ 起不良事件。经过数据去重后，发现有 $m = 60$ 起事件同时出现在两个来源中。\n\n假设该季度内的不良事件构成一个封闭总体，所有事件的可捕获性相等，且来源之间相互独立，即一个事件被两个来源同时捕获的概率等于它被每个来源单独捕获的概率之积。基于这些假设，并从捕获概率和计数的定义出发，推导用于估计该季度不良事件总数的双源捕获-再捕获估计量，并使用给定数据计算其数值。\n\n将漏报率定义为两个来源都遗漏的不良事件占估计总数的比例，即在估计的不良事件总数中，任何一个来源都未观察到的事件所占的比例。计算给定数据的漏报率。\n\n将最终的漏报率以小数形式表示，并四舍五入至四位有效数字。", "solution": "问题陈述经评估有效。它基于已确立的统计方法——捕获-再捕获分析，具有科学依据。该方法是流行病学和生态学等领域的标准技术，其在不良事件报告中的应用是医学信息学中一个公认的用例。问题提法恰当，提供了所有必要的数据（$n_1, n_2, m$）和明确的假设（封闭总体、可捕获性相等、来源独立），足以推导出唯一且有意义的解。其语言客观，数据内部一致。\n\n设 $N$ 代表该季度内封闭总体中不良事件的真实总数。这是待估计的未知量。\n设 $n_1$ 为第一个来源（EHR触发工具）捕获的事件数，因此 $n_1 = 120$。\n设 $n_2$ 为第二个来源（自愿性事件报告系统）捕获的事件数，因此 $n_2 = 150$。\n设 $m$ 为两个来源都捕获的事件数，因此 $m = 60$。\n\n设 $p_1$ 为某个不良事件被来源1捕获的概率。\n设 $p_2$ 为某个不良事件被来源2捕获的概率。\n可捕获性相等的假设意味着对于所有事件，$p_1$ 和 $p_2$ 都是常数。\n\n每个来源捕获的事件数可以与总总体大小 $N$ 和捕获概率相关联。捕获事件的期望数量为：\n$$E[n_1] = Np_1$$\n$$E[n_2] = Np_2$$\n\n来源独立性的假设指出，一个事件被两个来源同时捕获的概率是单个捕获概率的乘积，即 $p_1 p_2$。因此，被两个来源都捕获的事件的期望数量为：\n$$E[m] = N p_1 p_2$$\n\n我们可以使用矩估计法来推导 $N$ 的估计量。根据以上方程，我们可以将 $p_1$ 和 $p_2$ 表示为：\n$$p_1 = \\frac{E[n_1]}{N} \\quad \\text{和} \\quad p_2 = \\frac{E[n_2]}{N}$$\n将这些代入 $E[m]$ 的方程中：\n$$E[m] = N \\left( \\frac{E[n_1]}{N} \\right) \\left( \\frac{E[n_2]}{N} \\right) = \\frac{E[n_1] E[n_2]}{N}$$\n重新整理以求解 $N$，我们得到：\n$$N = \\frac{E[n_1] E[n_2]}{E[m]}$$\n通过用观察到的样本计数（$n_1$, $n_2$ 和 $m$）替换期望值，我们得到 $N$ 的双源捕获-再捕获估计量，记作 $\\hat{N}$：\n$$\\hat{N} = \\frac{n_1 n_2}{m}$$\n这也被称为 Lincoln-Petersen 估计量。\n\n现在，我们使用提供的数据计算 $\\hat{N}$ 的数值：\n$$\\hat{N} = \\frac{120 \\times 150}{60} = \\frac{18000}{60} = 300$$\n估计的不良事件总数为 $300$。\n\n接下来，我们需要计算漏报率，它被定义为两个来源都遗漏的不良事件占估计总数的比例。这对应于一个事件被来源1和来源2同时遗漏的概率。\n一个事件被来源1遗漏的概率是 $(1 - p_1)$。\n一个事件被来源2遗漏的概率是 $(1 - p_2)$。\n根据独立性假设，被两个来源都遗漏的概率是这些单个概率的乘积：\n$$P(\\text{missed by both}) = (1 - p_1)(1 - p_2)$$\n这个量就是漏报率，我们记作 $f_U$。我们通过代入 $p_1$ 和 $p_2$ 的估计量来估计它。\n\n我们可以从数据中估计 $p_1$ 和 $p_2$。第二个样本（$n_2$）中也被第一个来源捕获的事件（$m$）的比例提供了 $p_1$ 的一个估计。\n$$\\hat{p}_1 = \\frac{m}{n_2}$$\n类似地，第一个样本（$n_1$）中也被第二个来源捕获的事件（$m$）的比例提供了 $p_2$ 的一个估计。\n$$\\hat{p}_2 = \\frac{m}{n_1}$$\n将这些估计量代入漏报率的表达式中，得到我们的估计量 $\\hat{f}_U$：\n$$\\hat{f}_U = (1 - \\hat{p}_1)(1 - \\hat{p}_2) = \\left(1 - \\frac{m}{n_2}\\right)\\left(1 - \\frac{m}{n_1}\\right)$$\n使用给定的数值：\n$$\\hat{p}_1 = \\frac{60}{150} = \\frac{2}{5} = 0.4$$\n$$\\hat{p}_2 = \\frac{60}{120} = \\frac{1}{2} = 0.5$$\n现在我们计算漏报率：\n$$\\hat{f}_U = (1 - 0.4)(1 - 0.5) = (0.6)(0.5) = 0.3$$\n\n或者，我们可以计算两个来源都遗漏的事件数量。观察到的独立事件总数为 $n_1 + n_2 - m = 120 + 150 - 60 = 210$。\n估计的未观察到的事件数 $U$ 是估计总数减去观察到的总数：\n$$U = \\hat{N} - (n_1 + n_2 - m) = 300 - 210 = 90$$\n那么，漏报率就是未观察到的事件数与估计总数的比率：\n$$\\hat{f}_U = \\frac{U}{\\hat{N}} = \\frac{90}{300} = 0.3$$\n两种方法得出了相同的结果。问题要求答案以小数形式表示，并四舍五入至四位有效数字。数值 $0.3$ 表示为四位有效数字是 $0.3000$。", "answer": "$$\\boxed{0.3000}$$", "id": "4852033"}, {"introduction": "为了克服报告不足的问题，医疗信息学利用自然语言处理等技术自动从电子健康记录中筛选潜在的不良事件。然而，我们如何评估这些自动化工具的性能？本练习 [@problem_id:4852083] 让你亲手计算两个核心评价指标：灵敏度（sensitivity）和特异性（specificity）。通过这个计算，你将理解在“不漏报”和“不误报”之间权衡的现实挑战，这是开发和部署任何临床监控工具的基础。", "problem": "一家医院部署了一个简单的基于关键词的规则系统，用于在电子健康记录 (EHR) 笔记中标记提及特定药物相关不良事件的情况。在一个包含 $500$ 份笔记的测试集中，独立裁决（黄金标准）确定了 $50$ 份真正包含该不良事件的笔记。分类器将 $65$ 份笔记标记为阳性；在这些被标记的笔记中，$45$ 份是真阳性，$20$ 份是假阳性。仅使用相对于黄金标准的灵敏度和特异性的标准定义，计算该分类器的这两个指标。将每个指标表示为最简分数。以行矩阵 $\\begin{pmatrix}\\text{sensitivity}  \\text{specificity}\\end{pmatrix}$ 的形式给出您的最终答案。无需四舍五入。然后，用一到两句话解释，如果在自然语言处理 (NLP) 中增加临床否定词处理，主要纠正诸如“无 X 的证据”和“否认有 X”之类的短语，而不改变对肯定事件的识别，预计这些指标会如何变化。您的解释不影响您提交的数值答案。", "solution": "该问题陈述清晰且有效。它为一个标准的二元分类评估任务提供了一套独立且一致的数据。所有必要的数据点都已提供，并且它们内部是一致的。灵敏度和特异性的概念是统计学和医学信息学中基础、客观且有科学依据的指标。\n\n为了解决这个问题，我们首先建立混淆矩阵的各个组成部分。设 $N$ 为笔记总数，$P$ 为存在该状况的笔记数（真实例），$N_{neg}$ 为不存在该状况的笔记数（真实阴性例）。\n\n根据给定条件：\n笔记总数，$N = 500$。\n真正发生不良事件的笔记总数，$P = 50$。\n因此，没有发生不良事件的笔记总数为 $N_{neg} = N - P = 500 - 50 = 450$。\n\n分类器的性能描述如下：\n被标记为阳性的笔记总数（预测阳性）= $65$。\n其中，被正确标记的笔记数，即真阳性（$TP$），为 $TP = 45$。\n被错误标记的笔记数，即假阳性（$FP$），为 $FP = 20$。\n我们可以验证数据的一致性：$TP + FP = 45 + 20 = 65$，这与被标记为阳性的笔记总数相符。\n\n现在我们可以确定混淆矩阵的其余两个组成部分：\n假阴性（$FN$）是指那些确实包含不良事件但未被分类器标记的笔记。这是总真实例与真阳性之间的差值。\n$$FN = P - TP = 50 - 45 = 5$$\n\n真阴性（$TN$）是指那些不包含不良事件且被分类器正确地未标记的笔记。这是总非事件笔记与假阳性之间的差值。\n$$TN = N_{neg} - FP = 450 - 20 = 430$$\n\n我们可以将这些值总结在一个列联表中：\n\\begin{array}{c|c|c|c}\n   \\text{实际阳性}  \\text{实际阴性}  \\text{总计} \\\\\n\\hline\n\\text{预测阳性}  TP = 45  FP = 20  65 \\\\\n\\hline\n\\text{预测阴性}  FN = 5  TN = 430  435 \\\\\n\\hline\n\\text{总计}  50  450  500 \\\\\n\\end{array}\n\n现在，我们使用它们的标准定义来计算灵敏度和特异性。\n\n灵敏度，也称为真阳性率（$TPR$），是被正确识别的实际阳性样本的比例。公式为：\n$$\\text{Sensitivity} = \\frac{TP}{TP + FN}$$\n代入我们找到的值：\n$$\\text{Sensitivity} = \\frac{45}{45 + 5} = \\frac{45}{50}$$\n将此分数化为最简形式：\n$$\\text{Sensitivity} = \\frac{9 \\times 5}{10 \\times 5} = \\frac{9}{10}$$\n\n特异性，也称为真阴性率（$TNR$），是被正确识别的实际阴性样本的比例。公式为：\n$$\\text{Specificity} = \\frac{TN}{TN + FP}$$\n代入我们找到的值：\n$$\\text{Specificity} = \\frac{430}{430 + 20} = \\frac{430}{450}$$\n通过将分子和分母都除以 $10$ 来将此分数化为最简形式：\n$$\\text{Specificity} = \\frac{43}{45}$$\n数字 $43$ 是一个质数，所以这个分数不能再化简了。\n\n最终答案应表示为行矩阵 $\\begin{pmatrix}\\text{sensitivity}  \\text{specificity}\\end{pmatrix}$。\n$$\\begin{pmatrix} \\frac{9}{10}  \\frac{43}{45} \\end{pmatrix}$$\n\n关于最后的解释性问题：增加用于否定词处理的 NLP 将主要通过识别事件的否定性提及来纠正假阳性，从而增加真阴性的数量。这一变化预计会提高分类器的特异性，而其灵敏度保持不变，因为真阳性和假阴性的数量不会受到影响。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{9}{10}  \\frac{43}{45} \\end{pmatrix}}$$", "id": "4852083"}, {"introduction": "建立了不良事件的识别和评估方法后，下一个关键步骤是随时间推移进行持续监控，以发现变化的趋势。指数加权移动平均（EWMA）是一种强大的统计过程控制工具，它能有效地区分数据中的随机波动和代表安全水平变化的真实信号。通过这个练习 [@problem_id:4852115]，你将学会如何应用 EWMA 来跟踪患者安全指标，从而实现对微小但持久变化的灵敏检测，为安全预警和干预效果评估提供依据。", "problem": "一家三级医院在统计过程控制 (SPC) 中使用指数加权移动平均 (EWMA) 监测来追踪电子事件报告系统中记录的每日药物不良事件的比例。连续四天观测到的每日比例为 $x_{1}=0.02$、$x_{2}=0.03$、$x_{3}=0.05$ 和 $x_{4}=0.04$（每个值都表示为每例事件的小数比例）。EWMA 基线值初始化为 $\\hat{z}_{0}=0.02$。平滑参数为 $\\lambda=0.2$。\n\n从 EWMA 的基本定义出发——即 EWMA 是过去观测值的加权平均，其权重随时间呈几何级数衰减，并且分配给过去观测值和基线的总权重之和必须为 1——推导出 EWMA 统计量满足的递归形式，然后计算第 $t=4$ 天的 EWMA 值。\n\n通过将几何权重衰减与对近期变化的敏感性联系起来，解释为什么 EWMA 监测适用于患者安全（小偏移）检测，然后使用推导出的递归公式，在给定 $\\lambda=0.2$、$\\hat{z}_{0}=0.02$ 以及 $x_{1}=0.02$、$x_{2}=0.03$、$x_{3}=0.05$、$x_{4}=0.04$ 的条件下，求得 $\\hat{z}_{4}$。将 $\\hat{z}_{4}$ 的最终答案表示为小数，不要四舍五入。", "solution": "首先对问题陈述的科学合理性、自洽性和清晰度进行验证。\n\n**步骤 1：提取给定条件**\n- **过程**：对每日药物不良事件比例进行指数加权移动平均 (EWMA) 监测。\n- **观测值**：每日比例 $x_{1}=0.02$、$x_{2}=0.03$、$x_{3}=0.05$ 和 $x_{4}=0.04$。\n- **初始条件**：第 $t=0$ 天的 EWMA 基线值为 $\\hat{z}_{0}=0.02$。\n- **平滑参数**：$\\lambda=0.2$。\n- **任务 1**：从 EWMA 的基本定义（总权重为 1 的几何加权平均）推导出其统计量的递归形式。\n- **任务 2**：解释 EWMA 为何适用于检测患者安全数据中的小偏移。\n- **任务 3**：计算第 $t=4$ 天的 EWMA 值，记为 $\\hat{z}_{4}$。\n- **$\\hat{z}_{4}$ 的输出格式**：不进行四舍五入的小数。\n\n**步骤 2：使用提取的给定条件进行验证**\n- **科学依据**：该问题具有科学依据。EWMA 是统计过程控制 (SPC) 中的标准技术，其在医疗保健领域（医学信息学的子领域）中用于监测不良事件是一个成熟且有效的用例。使用 EWMA 进行小偏移检测是该方法的核心特征。\n- **适定性**：该问题是适定的。它提供了唯一确定 $\\hat{z}_{4}$ 值所需的所有数据（$\\hat{z}_{0}$、$\\lambda$ 和时间序列数据 $x_t$）。推导、解释和计算这几项任务清晰明确，并能导出一个确定的结果。\n- **客观性**：该问题以客观、定量的术语陈述，没有主观或模糊的语言。\n\n**步骤 3：结论与行动**\n该问题是有效的，因为它具有科学依据、适定性和客观性。没有矛盾、信息缺失或违反科学原则之处。可以开始求解过程。\n\n**第 1 部分：递归形式的推导**\n\nEWMA 统计量 $\\hat{z}_t$ 在时间 $t$ 的基本定义是所有过去观测值（$x_1, x_2, \\dots, x_t$）和初始基线值 $\\hat{z}_0$ 的加权平均。观测值的权重向过去呈几何级数衰减。对于过去 $k$ 个周期的观测值 $x_{t-k}$，其权重与 $(1-\\lambda)^k$ 成正比。最新的观测值 $x_t$ 的权重为 $\\lambda$。\n\n具体来说，EWMA 统计量在时间 $t$ 的展开形式为：\n$$ \\hat{z}_{t} = \\lambda x_{t} + \\lambda(1-\\lambda)x_{t-1} + \\lambda(1-\\lambda)^{2}x_{t-2} + \\dots + \\lambda(1-\\lambda)^{t-1}x_{1} + (1-\\lambda)^{t}\\hat{z}_{0} $$\n这可以写成：\n$$ \\hat{z}_{t} = \\left( \\sum_{k=0}^{t-1} \\lambda(1-\\lambda)^{k}x_{t-k} \\right) + (1-\\lambda)^{t}\\hat{z}_{0} $$\n问题陈述总权重之和必须为 $1$。观测值权重之和是一个有限几何级数：\n$$ \\sum_{k=0}^{t-1} \\lambda(1-\\lambda)^{k} = \\lambda \\sum_{k=0}^{t-1} (1-\\lambda)^{k} = \\lambda \\left( \\frac{1 - (1-\\lambda)^{t}}{1 - (1-\\lambda)} \\right) = \\lambda \\left( \\frac{1 - (1-\\lambda)^{t}}{\\lambda} \\right) = 1 - (1-\\lambda)^{t} $$\n总权重是观测值权重之和加上初始值 $\\hat{z}_0$ 的权重 $(1-\\lambda)^t$。\n总权重 $= [1 - (1-\\lambda)^{t}] + (1-\\lambda)^{t} = 1$。条件得到满足。\n\n为了推导递归形式，我们从 $\\hat{z}_t$ 的定义开始：\n$$ \\hat{z}_{t} = \\lambda x_{t} + \\lambda(1-\\lambda)x_{t-1} + \\lambda(1-\\lambda)^{2}x_{t-2} + \\dots + (1-\\lambda)^{t}\\hat{z}_{0} $$\n我们可以从除第一项外的所有项中提出因子 $(1-\\lambda)$：\n$$ \\hat{z}_{t} = \\lambda x_{t} + (1-\\lambda) \\left[ \\lambda x_{t-1} + \\lambda(1-\\lambda)x_{t-2} + \\dots + (1-\\lambda)^{t-1}\\hat{z}_{0} \\right] $$\n根据定义，括号内的表达式是时间 $t-1$ 的 EWMA 统计量，即 $\\hat{z}_{t-1}$。\n$$ \\hat{z}_{t-1} = \\lambda x_{t-1} + \\lambda(1-\\lambda)x_{t-2} + \\dots + \\lambda(1-\\lambda)^{t-2}x_1 + (1-\\lambda)^{t-1}\\hat{z}_{0} $$\n将此代入 $\\hat{z}_t$ 的方程，得到递归形式：\n$$ \\hat{z}_{t} = \\lambda x_{t} + (1-\\lambda)\\hat{z}_{t-1} $$\n这是 EWMA 的标准递归公式。\n\n**第 2 部分：关于其适用于患者安全监测的解释**\n\nEWMA 特别适用于检测过程均值中微小而持续的偏移，这通常是患者安全监测中关注的模式。不良事件的突然大幅飙升很容易通过简单的图表检测到，但一个微小而持续的增长——可能由于某个不易察觉的系统性问题——则可能被忽略。EWMA 的机制非常适合这种情况，主要有两个原因：\n\n$1$. **惯性与平滑**：递归公式 $\\hat{z}_{t} = \\lambda x_{t} + (1-\\lambda)\\hat{z}_{t-1}$ 表明，当前的 EWMA 值是最新数据点 $x_t$ 和前一个 EWMA 值 $\\hat{z}_{t-1}$ 的加权平均。参数 $\\lambda$ ($0  \\lambda \\le 1$) 控制着这种平衡。对于小偏移检测，通常选择一个较小的 $\\lambda$ (例如 $\\lambda \\in [0.1, 0.3]$)。这给予历史分量 $\\hat{z}_{t-1}$ 更大的权重 ($1-\\lambda$)，而给予当前观测值 $x_t$ 较小的权重 ($\\lambda$)。这一特性提供了惯性，平滑了数据中的随机波动或噪声。一个孤立的、随机的不良事件高比例值不会导致 $\\hat{z}_t$ 的急剧跳跃，从而防止了假警报。\n\n$2$. **对持续偏移的敏感性**：过程中包含在 $\\hat{z}_{t-1}$ 里的“记忆”，使得 EWMA 对微小但持续的偏移敏感。虽然单个新数据点 $x_t$ 的影响有限（按 $\\lambda$ 缩放），但如果潜在的过程均值向上偏移，连续的 $x_t$ 值将倾向于高于历史平均水平。每个新的较高值都会将 EWMA 统计量 $\\hat{z}_t$ 略微向上拉。经过几个时间周期，这种累积效应将导致 $\\hat{z}_t$ 显著偏离其基线，最终越过控制限并发出变化信号。这与标准的休哈特图 (Shewhart chart) 形成对比，休哈特图只考虑当前数据点且没有记忆，这使得它在检测那些不会将任何单点推出其宽控制限的小偏移时效率较低。\n\n权重的几何衰减确保了最近的数据具有最大的影响力，使系统能够适应新情况，而过去数据的聚合影响则提供了可靠检测患者安全指标中细微但有意义的变化所需的稳定性和记忆。\n\n**第 3 部分：$\\hat{z}_{4}$ 的计算**\n\n我们使用推导出的递归公式 $\\hat{z}_{t} = \\lambda x_{t} + (1-\\lambda)\\hat{z}_{t-1}$ 以及给定的值：\n- 初始值：$\\hat{z}_{0}=0.02$\n- 平滑参数：$\\lambda=0.2$，这意味着 $1-\\lambda=0.8$。\n- 数据点：$x_{1}=0.02$, $x_{2}=0.03$, $x_{3}=0.05$, $x_{4}=0.04$。\n\n**逐步计算：**\n\n- **在 $t=1$ 时：**\n$$ \\hat{z}_{1} = \\lambda x_{1} + (1-\\lambda)\\hat{z}_{0} = (0.2)(0.02) + (0.8)(0.02) = 0.004 + 0.016 = 0.02 $$\n\n- **在 $t=2$ 时：**\n$$ \\hat{z}_{2} = \\lambda x_{2} + (1-\\lambda)\\hat{z}_{1} = (0.2)(0.03) + (0.8)(0.02) = 0.006 + 0.016 = 0.022 $$\n\n- **在 $t=3$ 时：**\n$$ \\hat{z}_{3} = \\lambda x_{3} + (1-\\lambda)\\hat{z}_{2} = (0.2)(0.05) + (0.8)(0.022) = 0.01 + 0.0176 = 0.0276 $$\n\n- **在 $t=4$ 时：**\n$$ \\hat{z}_{4} = \\lambda x_{4} + (1-\\lambda)\\hat{z}_{3} = (0.2)(0.04) + (0.8)(0.0276) = 0.008 + 0.02208 = 0.03008 $$\n\n第 $t=4$ 天的 EWMA 统计量的值是 $0.03008$。", "answer": "$$\n\\boxed{0.03008}\n$$", "id": "4852115"}]}