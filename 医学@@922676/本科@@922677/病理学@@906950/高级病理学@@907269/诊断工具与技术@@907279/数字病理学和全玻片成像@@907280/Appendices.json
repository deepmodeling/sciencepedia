{"hands_on_practices": [{"introduction": "全视野数字图像的质量源于扫描仪的光学系统和传感器。本练习将探讨数字病理学的一个核心问题：我们如何确保扫描仪能够忠实地捕捉到显微镜物镜所能分辨的所有细节？通过应用奈奎斯特-香农采样定理，您将把扫描仪的物理参数（如数值孔径 $NA$ 和传感器像素大小）与数字分辨率的基本极限联系起来，这对于评估数字病理系统的诊断适用性至关重要。", "problem": "数字病理学中的全玻片成像扫描仪使用一台无限远校正的明场显微镜。一个标记为$40\\times$的物镜被设计用于与焦距为$f_t=200\\,\\text{mm}$的标准管镜配合使用，以实现其标称放大倍率。相机的传感器像素间距为$s=6.5\\,\\mu\\text{m}$。照明是宽带的，为进行性能评估，使用绿色光谱分量$\\lambda=550\\,\\text{nm}$，物镜的数值孔径为$NA=0.75$。从放大倍率定义为像尺寸与物尺寸之比、无限远显微镜中$40\\times$标签的含义、采样定理以及非相干光学传递函数的截止频率出发，推导出样本平面的微米/像素值$p_{\\text{spec}}$，并使用采样定理确定采样是否满足给定$\\lambda$和$NA$的奈奎斯特要求。报告一个由过采样因子定义的采样充分性的单一标量总结\n$$R=\\frac{\\lambda}{4\\,NA\\,p_{\\text{spec}}},$$\n其中$R\\geq 1$表示符合要求。将最终的$R$四舍五入到四位有效数字。将$R$表示为无单位的纯数。", "solution": "目标是计算样本平面的微米/像素值，并通过过采样因子评估是否符合奈奎斯特要求。\n\n首先，在无限远校正显微镜中，物镜的标称放大倍率$M_{\\text{obj}}$是为标准管镜定义的。对于一个标准的$40\\times$系统，从样本到传感器的总横向放大倍率 $M$ 为$40$。\n$$M=40.$$\n\n样本平面的像素尺寸（MPP）$p_{\\text{spec}}$是传感器像素间距$s$经总放大倍率$M$缩小的结果：\n$$p_{\\text{spec}}=\\frac{s}{M}.$$\n代入$s=6.5\\,\\mu\\text{m}$和$M=40$，\n$$p_{\\text{spec}}=\\frac{6.5\\,\\mu\\text{m}}{40}=0.1625\\,\\mu\\text{m}.$$\n\n接下来，为了评估采样充分性，我们应用奈奎斯特-香农采样定理。对于非相干明场成像，光学传递函数（OTF）的截止空间频率为：\n$$f_c=\\frac{2\\,NA}{\\lambda},$$\n这是光学系统能传输的最高空间频率。以像素间距$p_{\\text{spec}}$进行采样对应的采样频率为$f_s=1/p_{\\text{spec}}$。奈奎斯特要求采样频率至少是最高信号频率的两倍，即$f_s\\geq 2 f_c$。代入表达式可得：\n$$\\frac{1}{p_{\\text{spec}}}\\geq 2\\left(\\frac{2\\,NA}{\\lambda}\\right)\\quad\\Rightarrow\\quad p_{\\text{spec}}\\leq\\frac{\\lambda}{4\\,NA}.$$\n问题中定义的过采样因子$R$正是用来衡量这一关系的：\n$$R=\\frac{\\lambda}{4\\,NA\\,p_{\\text{spec}}}.$$\n如果$R\\geq 1$，则采样符合奈奎斯特要求；如果$R  1$，则不符合。\n\n现在代入给定值进行计算，统一单位。设$\\lambda=550\\,\\text{nm}=0.55\\,\\mu\\text{m}$，$NA=0.75$，以及$p_{\\text{spec}}=0.1625\\,\\mu\\text{m}$。\n$$R=\\frac{0.55\\,\\mu\\text{m}}{4\\times 0.75\\times 0.1625\\,\\mu\\text{m}}=\\frac{0.55}{3\\times 0.1625}=\\frac{0.55}{0.4875}.$$\n计算该比值：\n$$R \\approx 1.128205128.$$\n\n因此，样本平面的微米/像素值为$p_{\\text{spec}}=0.1625\\,\\mu\\text{m}$，过采样因子为$R\\approx 1.128205128$。因为$R > 1$，所以对于给定的$\\lambda$和$NA$条件，采样满足奈奎斯特要求。将最终的$R$四舍五入到四位有效数字，得到：\n$$R\\approx 1.128.$$", "answer": "$$\\boxed{1.128}$$", "id": "4356907"}, {"introduction": "在进行任何定量分析之前，必须对原始的WSI数据进行预处理，其中关键的第一步是区分组织区域和载玻片的空白背景。这个练习不仅仅是陈述一个操作步骤，而是通过利用比尔-朗伯定律和统计期望的基本原理，来揭示为何这一步骤如此重要。通过从第一性原理推导包含背景像素所引入的偏差，您将深刻理解为何背景掩膜是确保染色定量分析准确性的必要前提。", "problem": "一台全玻片成像（WSI）扫描仪在入射光强度为 $I_{0}$ 的稳定光源下，采集一张经苏木精和伊红（HE）染色的玻片。每个红-绿-蓝（RGB）通道中的像素强度使用比尔-朗伯定律转换为光密度（OD），此处定义为 $OD = -\\ln\\!\\left(I/I_{0}\\right)$，其中 $I$ 是单个像素测得的透射光强度，$\\ln$ 表示自然对数。经过标准的颜色反卷积后，将每个像素的标量苏木精OD通道视为一个随机变量。\n\n假设玻片包含视觉上可区分的两类像素：\n- 组织像素，其苏木精OD由一个均值为 $\\mu_{t}$、方差有限的随机变量 $X_{t}$ 建模。\n- 背景像素（玻璃或空白区域），其苏木精OD由一个均值为 $\\mu_{b}$、方差有限的随机变量 $X_{b}$ 建模。对于背景，$I \\approx I_{0}$，因此 $\\mu_{b}$ 很小且接近于 $0$。\n\n在实践中，如果不执行背景掩膜，染色均值的估计量会使用所有像素，导致组织和背景的混合。设背景像素的比例为 $p \\in (0,1)$，则组织像素的比例为 $1-p$。仅使用基本定义（比尔-朗伯定律、期望和混合模型），通过推导因包含背景像素而引入的苏木精OD均值估计偏差，来证明在归一化之前进行背景掩膜的必要性。具体来说，从第一性原理出发，推导偏差 $\\Delta \\mu = \\hat{\\mu} - \\mu_{t}$ 的解析表达式，其中 $\\hat{\\mu}$ 是在没有掩膜的情况下对所有像素计算的样本均值的大样本极限。\n\n然后，在 $p = 0.65$、$\\mu_{t} = 0.48$（OD单位）和 $\\mu_{b} = 0.02$（OD单位）的情况下，对此偏差进行数值计算。将最终数值结果四舍五入到四位有效数字。将最终答案表示为光密度（OD）值（无量纲）。", "solution": "问题的目标是推导在计算中未排除背景像素时，对苏木精光密度（OD）均值估计所产生的偏差。该偏差定义为 $\\Delta \\mu = \\hat{\\mu} - \\mu_{t}$。\n\n首先，我们形式化估计量 $\\hat{\\mu}$。根据大数定律，对所有像素计算的样本均值的大样本极限收敛于代表从整张玻片中随机抽取一个像素的OD值的随机变量的期望值。设这个随机变量为 $X$。\n\n玻片由组织像素和背景像素两个群体混合而成。一个随机选择的像素是组织像素的概率为 $1-p$，是背景像素的概率为 $p$。因此，随机变量 $X$ 服从一个双组分混合分布。我们可以使用全期望公式来计算其期望 $\\hat{\\mu} = E[X]$：\n$$\n\\hat{\\mu} = E[X] = P(\\text{组织}) \\cdot E[X | \\text{像素是组织}] + P(\\text{背景}) \\cdot E[X | \\text{像素是背景}]\n$$\n根据问题定义，我们有 $P(\\text{组织}) = 1-p$，$P(\\text{背景}) = p$，$E[X | \\text{像素是组织}] = \\mu_t$，以及 $E[X | \\text{像素是背景}] = \\mu_b$。\n将这些值代入：\n$$\n\\hat{\\mu} = (1-p)\\mu_{t} + p\\mu_{b}\n$$\n这个表达式代表了在整个图像上（包括组织和背景）计算的平均OD值。偏差 $\\Delta \\mu$ 是这个混合均值与组织像素的真实均值 $\\mu_{t}$ 之间的差。\n$$\n\\Delta \\mu = \\hat{\\mu} - \\mu_{t} = \\left( (1-p)\\mu_{t} + p\\mu_{b} \\right) - \\mu_{t}\n$$\n展开并简化表达式：\n$$\n\\Delta \\mu = \\mu_{t} - p\\mu_{t} + p\\mu_{b} - \\mu_{t} = p\\mu_{b} - p\\mu_{t}\n$$\n因此，偏差的解析表达式为：\n$$\n\\Delta \\mu = p(\\mu_{b} - \\mu_{t})\n$$\n这个结果从理论上证明了背景掩膜的必要性。因为组织吸收染料而背景基本透明，所以 $\\mu_t  \\mu_b$，这意味着偏差 $\\Delta \\mu$ 是负值。包含背景像素会导致对组织真实OD均值的系统性低估。\n\n最后，代入给定的数值进行计算：$p = 0.65$，$\\mu_{t} = 0.48$ 和 $\\mu_{b} = 0.02$。\n$$\n\\Delta \\mu = 0.65 \\times (0.02 - 0.48) = 0.65 \\times (-0.46) = -0.299\n$$\n根据要求，将结果四舍五入到四位有效数字，得到 $-0.2990$。", "answer": "$$\\boxed{-0.2990}$$", "id": "4356898"}, {"introduction": "即使在分离出组织区域后，WSI中通常仍含有笔迹或碎屑等伪影，这些会干扰自动分析算法。本练习将介绍一种常见的伪影移除策略：基于颜色和大小等简单的图像特征构建一个分类器。您将应用统计模型来设计决策规则，并使用灵敏度和特异性等关键指标来评估其性能，这为理解图像清理的挑战以及在计算病理学中开发和评估分类算法提供了实践入门。", "problem": "一个组织样本已通过全切片成像（WSI）技术进行数字化，生成了一幅大图像，其中既包含真实的组织成分（非伪影），也包含两种常见的伪影：记号笔墨迹和碎屑。为了在进行下游分析之前抑制这些伪影，通过结合一个基于颜色的滤波器和一个连通分量大小阈值来构建一个二值伪影掩模。对于从低分辨率组织掩模中提取的每个连通分量，定义两个特征：归一化蓝色色度 $b$（无量纲，由红-绿-蓝通道计算得出）和分量面积 $a$（单位为 $\\mu\\mathrm{m}^{2}$）。考虑以下决策规则：如果 $b  C$ 或 $a  S$，则将一个分量分类为“伪影”，否则分类为“非伪影”。假设在每个类别（伪影与非伪影）中：(i) $b$ 和 $a$ 是独立的，并且 (ii) 由于扫描仪和染色的变异性，每个特征都可以很好地用正态分布来近似。\n\n通过对大量已标注连通分量的经验性表征，得出以下类条件特征分布：\n- 对于伪影（汇总了记号笔墨迹和碎屑），$b \\sim \\mathcal{N}(\\mu_{bA},\\sigma_{b}^{2})$，其中 $\\mu_{bA} = 0.70$ 且 $\\sigma_{b} = 0.08$；并且 $a \\sim \\mathcal{N}(\\mu_{aA},\\sigma_{a}^{2})$，其中 $\\mu_{aA} = 120$ 且 $\\sigma_{a} = 40$（所有面积单位均为 $\\mu\\mathrm{m}^{2}$）。\n- 对于非伪影（真实组织成分），$b \\sim \\mathcal{N}(\\mu_{bN},\\sigma_{b}^{2})$，其中 $\\mu_{bN} = 0.50$ 且 $\\sigma_{b} = 0.08$ 相同；并且 $a \\sim \\mathcal{N}(\\mu_{aN},\\sigma_{a}^{2})$，其中 $\\mu_{aN} = 200$ 且 $\\sigma_{a} = 40$ 相同。\n\n仅从灵敏度（真阳性率）、特异性（真阴性率）、同一类别内 $b$ 和 $a$ 的独立性以及正态分布的累积分布函数等基本定义出发，推导出此“伪影”检测器的期望灵敏度和特异性，使其成为阈值 $C$ 和 $S$ 的函数。然后，在 $C = 0.62$ 和 $S = 160$（$S$ 的单位为 $\\mu\\mathrm{m}^{2}$）的条件下计算这些值，以获得约登指数 $J$，其定义为灵敏度加特异性减1。将最终的 $J$ 值表示为小数，并将最终答案四舍五入到四位有效数字。$J$ 不需要单位。", "solution": "该问题要求我们推导一个二元分类器的灵敏度和特异性，并计算其约登指数 $J$。分类规则为：如果一个连通分量的蓝色色度 $b > C$ 或其面积 $a  S$，则将其分类为“伪影”。\n\n设 $A$ 表示分量为真实伪影（阳性类别），$N$ 表示分量为真实非伪影（阴性类别）。分类器判定为“伪影”的决策事件为 $D \\equiv (b > C) \\lor (a  S)$。\n\n**1. 灵敏度（真阳性率, TPR）**\n灵敏度是真实伪影被正确分类的概率：$\\text{灵敏度} = P(D | A) = P((b > C) \\lor (a  S) | A)$。\n使用补集事件 $\\neg D \\equiv (b \\le C) \\land (a \\ge S)$ 更易于计算。\n$$\n\\text{灵敏度} = 1 - P(\\neg D | A) = 1 - P((b \\le C) \\land (a \\ge S) | A)\n$$\n由于在类别 $A$ 内特征 $b$ 和 $a$ 独立，我们得到：\n$$\n\\text{灵敏度} = 1 - P(b \\le C | A) \\cdot P(a \\ge S | A)\n$$\n\n**2. 特异性（真阴性率, TNR）**\n特异性是真实非伪影被正确分类为“非伪影”的概率：$\\text{特异性} = P(\\neg D | N) = P((b \\le C) \\land (a \\ge S) | N)$。\n由于在类别 $N$ 内特征独立：\n$$\n\\text{特异性} = P(b \\le C | N) \\cdot P(a \\ge S | N)\n$$\n\n**3. 使用正态CDF计算概率**\n设 $\\Phi(z)$ 为标准正态分布 $\\mathcal{N}(0, 1)$ 的累积分布函数（CDF）。\n对于灵敏度：\n- $P(b \\le C | A) = \\Phi\\left(\\frac{C - \\mu_{bA}}{\\sigma_b}\\right)$\n- $P(a \\ge S | A) = 1 - P(a  S | A) = 1 - \\Phi\\left(\\frac{S - \\mu_{aA}}{\\sigma_a}\\right) = \\Phi\\left(\\frac{\\mu_{aA} - S}{\\sigma_a}\\right)$\n对于特异性：\n- $P(b \\le C | N) = \\Phi\\left(\\frac{C - \\mu_{bN}}{\\sigma_b}\\right)$\n- $P(a \\ge S | N) = \\Phi\\left(\\frac{\\mu_{aN} - S}{\\sigma_a}\\right)$\n\n**4. 代入数值计算**\n给定参数：$C=0.62$, $S=160$, $\\mu_{bA}=0.70$, $\\sigma_b=0.08$, $\\mu_{aA}=120$, $\\sigma_a=40$, $\\mu_{bN}=0.50$, $\\mu_{aN}=200$。\n\n计算灵敏度所需的z-score：\n$z_{bA} = \\frac{0.62 - 0.70}{0.08} = -1.0$\n$z_{aA} = \\frac{120 - 160}{40} = -1.0$\n$\\text{灵敏度} = 1 - [\\Phi(-1) \\cdot \\Phi(-1)] \\approx 1 - (0.158655)^2 \\approx 1 - 0.025171 = 0.974829$\n\n计算特异性所需的z-score：\n$z_{bN} = \\frac{0.62 - 0.50}{0.08} = 1.5$\n$z_{aN} = \\frac{200 - 160}{40} = 1.0$\n$\\text{特异性} = \\Phi(1.5) \\cdot \\Phi(1) \\approx 0.933193 \\times 0.841345 \\approx 0.785160$\n\n**5. 计算约登指数 J**\n$J = \\text{灵敏度} + \\text{特异性} - 1$\n$J \\approx 0.974829 + 0.785160 - 1 = 0.759989$\n\n将结果四舍五入到四位有效数字，得到 $J \\approx 0.7600$。", "answer": "$$\\boxed{0.7600}$$", "id": "4356834"}]}