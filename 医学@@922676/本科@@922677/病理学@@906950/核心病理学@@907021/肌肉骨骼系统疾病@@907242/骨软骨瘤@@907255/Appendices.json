{"hands_on_practices": [{"introduction": "影像学特征，如软骨帽厚度，是评估骨软骨瘤恶性转化的关键指标，但它并非绝对准确。为了量化诊断测试的真实价值，我们必须运用生物统计学工具。本练习将通过一个具体案例，指导你使用贝叶斯定理计算阳性预测值（$PPV$），帮助你理解当一个诊断测试结果为阳性时，患者确实患有该疾病的实际概率是多少 [@problem_id:4417202]。", "problem": "一项针对成人骨软骨瘤的影像病理学相关性研究，使用磁共振成像（MRI）来评估其向继发性软骨肉瘤的恶性转化。定义一项诊断试验为阳性，如果软骨帽厚度大于 $2$ 厘米。在一个转诊的成人队列中，该试验的敏感性为 $Se=0.85$，特异性为 $Sp=0.90$，恶性转化的患病率为 $P=0.05$。使用敏感性、特异性、患病率和贝叶斯定理的标准定义，计算阳性预测值 $PPV$，其定义为在试验结果为阳性的条件下，病灶为恶性的概率。将最终答案以小数形式表示，并四舍五入至四位有效数字。不要使用百分号。", "solution": "在尝试解答之前，对问题进行验证。\n\n### 步骤 1：提取已知条件\n- 如果软骨帽厚度大于 $2$ 厘米，诊断试验为阳性。\n- 敏感性：$Se = 0.85$\n- 特异性：$Sp = 0.90$\n- 恶性转化的患病率：$P = 0.05$\n- 任务：计算阳性预测值 $PPV$。\n- 最终答案格式：小数，四舍五入至四位有效数字。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据指定标准对问题进行评估。\n- **科学依据**：该问题使用了流行病学和生物统计学中的既定概念，即敏感性、特异性、患病率和阳性预测值。这些概念被应用于一个医学上真实的情景：对骨软骨瘤进行放射学评估以判断其恶性转化，其中软骨帽厚度是一个公认的诊断标准。所提供的 $Se$、$Sp$ 和 $P$ 的数值在临床背景下是合理的。该问题具有科学合理性。\n- **适定性**：该问题为计算所要求的量 ($PPV$) 提供了所有必要的数据 ($Se$、$Sp$、$P$)。这些变量之间的关系由贝叶斯定理决定，这保证了存在唯一、稳定且有意义的解。\n- **客观性**：该问题使用精确、明确和客观的语言陈述。\n- **结论**：该问题未违反任何无效标准。它是自洽、一致且有科学依据的。\n\n### 步骤 3：判定与操作\n该问题被判定为 **有效**。将推导完整的解答过程。\n\n### 解题推导\n设 $M$ 表示病灶为恶性（存在疾病）的事件，设 $B$ 表示病灶为良性（不存在疾病）的事件。设 $T^+$ 表示阳性测试结果，设 $T^-$ 表示阴性测试结果。\n\n所提供的信息可以正式地表示为概率：\n恶性转化的患病率是疾病的先验概率，$P(M)$。\n$$P(M) = 0.05$$\n病灶为良性的概率是其为恶性的补集。\n$$P(B) = 1 - P(M) = 1 - 0.05 = 0.95$$\n敏感性是在存在疾病的情况下，测试结果为阳性的概率。\n$$Se = P(T^+ | M) = 0.85$$\n特异性是在不存在疾病的情况下，测试结果为阴性的概率。\n$$Sp = P(T^- | B) = 0.90$$\n\n目标是计算阳性预测值 ($PPV$)，即在测试结果为阳性的条件下，病灶为恶性的概率。这是条件概率 $P(M | T^+)$。\n\n根据贝叶斯定理，$PPV$ 由以下公式给出：\n$$PPV = P(M | T^+) = \\frac{P(T^+ | M) P(M)}{P(T^+)}$$\n\n分母 $P(T^+)$ 是测试结果为阳性的总概率。这可以使用全概率公式计算，对可能出现阳性测试的两种互斥情况求和：真阳性（病灶为恶性且测试为阳性）和假阳性（病灶为良性且测试为阳性）。\n$$P(T^+) = P(T^+ \\cap M) + P(T^+ \\cap B)$$\n使用条件概率的定义，$P(A \\cap C) = P(A|C)P(C)$，可将其展开为：\n$$P(T^+) = P(T^+ | M) P(M) + P(T^+ | B) P(B)$$\n\n项 $P(T^+|B)$ 是假阳性率。它是特异性 $Sp = P(T^-|B)$ 的补集，因为在给定条件下（不存在疾病），测试结果只能是阳性或阴性。\n$$P(T^+ | B) = 1 - P(T^- | B) = 1 - Sp$$\n代入给定的特异性值：\n$$P(T^+ | B) = 1 - 0.90 = 0.10$$\n\n现在，我们可以计算 $P(T^+)$ 的值：\n$$P(T^+) = (P(T^+ | M) \\times P(M)) + (P(T^+ | B) \\times P(B))$$\n$$P(T^+) = (0.85 \\times 0.05) + (0.10 \\times 0.95)$$\n$$P(T^+) = 0.0425 + 0.095$$\n$$P(T^+) = 0.1375$$\n\n最后，将已知值代回贝叶斯定理的 $PPV$ 公式中：\n$$PPV = P(M | T^+) = \\frac{P(T^+ | M) P(M)}{P(T^+)}$$\n$$PPV = \\frac{0.85 \\times 0.05}{0.1375}$$\n$$PPV = \\frac{0.0425}{0.1375}$$\n$$PPV \\approx 0.30909090...$$\n\n问题要求答案四舍五入至四位有效数字。\n$$PPV \\approx 0.3091$$", "answer": "$$\\boxed{0.3091}$$", "id": "4417202"}, {"introduction": "医学中的所有测量，包括MRI对软骨帽厚度的测量，都存在固有的不确定性或误差。当测量值接近诊断阈值时，这种误差可能会导致错误的分类（假阳性或假阴性）。本练习将指导你构建一个计算模型，以量化测量误差对诊断决策的影响，从而更深入地理解诊断测试在临界值附近的可靠性 [@problem_id:4417136]。", "problem": "您的任务是设计一个程序，用以量化磁共振成像（MRI）在测量骨软骨瘤软骨帽厚度时的误差如何影响基于阈值的决策。在病理学中，如果骨软骨瘤的软骨帽厚度超过某一特定阈值，则怀疑其有向软骨肉瘤恶性转化的可能。对于成人，常用的阈值是 $2.0$ 厘米；对于儿童，常用的阈值是 $3.0$ 厘米。本问题中所有厚度量均以厘米为单位，并以小数值表示（而非百分比）。不涉及任何角度量。\n\n请使用以下基本模型：\n- 测量模型：测量值 $M$ 等于真实值 $T$ 加上一个误差 $E$，记为 $M = T + E$。\n- 测量误差 $E$ 被建模为一个均值为 $0$、标准差为 $\\sigma$ 的正态（高斯）随机变量，记为 $E \\sim \\mathcal{N}(0,\\sigma^{2})$。\n- 在本问题中，使用 $\\sigma = 0.2$ 厘米。\n- 决策规则是基于阈值的：如果测量厚度 $M$ 超过阈值 $\\tau$，则分类为“可疑”（阳性）；否则分类为“不可疑”（阴性）。形式上，如果 $M > \\tau$，则测量分类为阳性，否则为阴性。\n- 真实情况分类由真实值 $T$ 使用相同的阈值规则确定：如果 $T > \\tau$，则真实情况为阳性，否则为阴性。\n\n基于这些基本原理，请推导以下表达式：\n1. 在给定真实值为 $T = t$ 和阈值为 $\\tau$ 的条件下，测量结果为阳性的概率，记为 $\\mathbb{P}(\\text{测量为阳性} \\mid T = t, \\tau)$。\n2. 真实值为 $T = t$、阈值为 $\\tau$ 的病例的假阳性概率，定义为测量分类为阳性而真实情况分类为阴性的概率。\n3. 真实值为 $T = t$、阈值为 $\\tau$ 的病例的假阴性概率，定义为测量分类为阴性而真实情况分类为阳性的概率。\n\n您的程序应实现这些推导出的表达式，并对以下测试用例集进行评估（所有厚度和阈值单位均为厘米）：\n- 案例A（成人，接近但低于阈值）：$t = 1.8$，$\\tau = 2.0$。\n- 案例B（成人，恰好在阈值上）：$t = 2.0$，$\\tau = 2.0$。\n- 案例C（成人，高于阈值）：$t = 2.5$，$\\tau = 2.0$。\n- 案例D（儿童，接近但低于阈值）：$t = 2.9$，$\\tau = 3.0$。\n- 案例E（儿童，高于阈值）：$t = 3.4$，$\\tau = 3.0$。\n\n对于每个案例，您的程序必须输出一个包含三个小数值的列表：\n- 测量为阳性的概率 $\\mathbb{P}(\\text{测量为阳性} \\mid T = t, \\tau)$。\n- 假阳性概率（使用由 $T$ 和 $\\tau$ 决定的真实情况）。\n- 假阴性概率（使用由 $T$ 和 $\\tau$ 决定的真实情况）。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，列表中的每个元素本身是对应案例的三个值所组成的列表，顺序为 A、B、C、D、E。例如，正确格式的输出应如下所示：\n$[\\,[p_{A},fp_{A},fn_{A}],\\,[p_{B},fp_{B},fn_{B}],\\ldots\\ ]$\n所有数值答案必须表示为无单位的十进制浮点数（通过建模隐含单位为厘米），而不是百分比。不使用角度，因此没有角度单位的要求。", "solution": "用户提供的问题已经过分析，并被确定为有效。该问题具有科学依据，提法明确，客观，并包含推导唯一且有意义的解决方案所需的所有必要信息。因此，我们可以继续进行推导和实现。\n\n这个问题的核心是量化一个临床决策中的不确定性，该决策基于一个受随机误差影响的测量值。我们已知一个测量模型、一个误差分布和一个决策规则。我们的任务是推导特定结果和分类错误的概率。\n\n设 $T$ 为软骨帽的真实厚度，$M$ 为测量厚度。所有量的单位均为厘米。它们之间的关系由以下模型给出：\n$$\nM = T + E\n$$\n其中 $E$ 是测量误差。误差 $E$ 被建模为一个服从均值为 $0$、标准差为 $\\sigma$ 的正态（高斯）分布的随机变量。这被记为 $E \\sim \\mathcal{N}(0, \\sigma^2)$。在本问题中，给定 $\\sigma = 0.2$ 厘米。\n\n对于真实厚度为已知值 $T=t$ 的特定情况，测量厚度 $M$ 成为一个随机变量。其分布由模型推导得出：\n$$\nM = t + E\n$$\n由于 $E \\sim \\mathcal{N}(0, \\sigma^2)$，且 $t$ 是一个常数，所以 $M$ 也服从正态分布。$M$ 的均值为 $\\mathbb{E}[M] = \\mathbb{E}[t+E] = t + \\mathbb{E}[E] = t+0 = t$。$M$ 的方差为 $\\text{Var}(M) = \\text{Var}(t+E) = \\text{Var}(E) = \\sigma^2$。\n因此，在给定真实值为 $t$ 的情况下，测量值的分布为：\n$$\nM \\sim \\mathcal{N}(t, \\sigma^2)\n$$\n\n决策规则基于阈值 $\\tau$。如果厚度超过 $\\tau$，则分类为“可疑”（阳性），否则为“不可疑”（阴性）。\n- 如果 $M > \\tau$，测量分类为阳性。\n- 如果 $T > \\tau$，真实情况分类为阳性。\n\n我们现在将为给定的真实值 $T=t$ 和阈值 $\\tau$ 推导所需的三个概率的表达式。\n\n1.  **测量为阳性的概率, $\\mathbb{P}(\\text{测量为阳性} \\mid T = t, \\tau)$**\n    这是在真实值为 $t$ 的条件下，测量值 $M$ 超过阈值 $\\tau$ 的概率。\n    $$\n    \\mathbb{P}(\\text{测量为阳性} \\mid T = t, \\tau) = \\mathbb{P}(M > \\tau)\n    $$\n    为了计算这个概率，我们将随机变量 $M$ 标准化。我们定义一个标准正态变量 $Z = \\frac{M - t}{\\sigma}$，其中 $Z \\sim \\mathcal{N}(0, 1)$。\n    不等式 $M > \\tau$ 可以用 $Z$ 重写为：\n    $$\n    M - t > \\tau - t \\implies \\frac{M - t}{\\sigma} > \\frac{\\tau - t}{\\sigma} \\implies Z > \\frac{\\tau - t}{\\sigma}\n    $$\n    然后，该概率可以用标准正态分布的累积分布函数 (CDF) $\\Phi(z) = \\mathbb{P}(Z \\le z)$ 来表示。$Z$ 超过一个值的概率由生存函数 (SF) 给出，即 $1 - \\Phi(z)$。\n    $$\n    \\mathbb{P}(\\text{测量为阳性}) = \\mathbb{P}\\left(Z > \\frac{\\tau - t}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{\\tau - t}{\\sigma}\\right)\n    $$\n\n2.  **假阳性概率**\n    当测量分类为阳性（$M > \\tau$）但真实情况分类为阴性（$T \\le \\tau$）时，就会发生假阳性。\n    我们是针对一个特定的真实值 $T=t$ 来计算这个概率的。\n    - 如果真实情况是阳性（即 $t > \\tau$），根据定义，不可能出现假阳性。在这种情况下，假阳性概率为 $0$。\n    - 如果真实情况是阴性（即 $t \\le \\tau$），那么当测量结果为阳性（$M > \\tau$）时，就会发生假阳性。这个事件的概率正是我们上面计算的测量为阳性的概率。\n    因此，假阳性概率 $P_{FP}$ 为：\n    $$\n    P_{FP}(t, \\tau) = \\begin{cases} \\mathbb{P}(M > \\tau) = 1 - \\Phi\\left(\\frac{\\tau - t}{\\sigma}\\right)  \\text{若 } t \\le \\tau \\\\ 0  \\text{若 } t > \\tau \\end{cases}\n    $$\n\n3.  **假阴性概率**\n    当测量分类为阴性（$M \\le \\tau$）但真实情况分类为阳性（$T > \\tau$）时，就会发生假阴性。\n    同样，我们考虑特定的真实值 $T=t$。\n    - 如果真实情况是阴性（即 $t \\le \\tau$），则不可能发生假阴性。假阴性概率为 $0$。\n    - 如果真实情况是阳性（即 $t > \\tau$），那么当测量结果为阴性（$M \\le \\tau$）时，就会发生假阴性。这种情况的概率是 $\\mathbb{P}(M \\le \\tau)$。\n    使用与之前相同的标准化方法：\n    $$\n    \\mathbb{P}(M \\le \\tau) = \\mathbb{P}\\left(Z \\le \\frac{\\tau - t}{\\sigma}\\right) = \\Phi\\left(\\frac{\\tau - t}{\\sigma}\\right)\n    $$\n    因此，假阴性概率 $P_{FN}$ 为：\n    $$\n    P_{FN}(t, \\tau) = \\begin{cases} \\mathbb{P}(M \\le \\tau) = \\Phi\\left(\\frac{\\tau - t}{\\sigma}\\right)  \\text{若 } t > \\tau \\\\ 0  \\text{若 } t \\le \\tau \\end{cases}\n    $$\n\n这些推导出的公式在提供的 Python 程序中得以实现。该程序使用了 `scipy.stats.norm` 库，其中 `norm.sf` 对应于生存函数 $1-\\Phi$，`norm.cdf` 对应于累积分布函数 $\\Phi$。`loc` 参数代表均值（$t$），`scale` 参数代表标准差（$\\sigma$）。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Calculates probabilities related to MRI measurement error for osteochondroma\n    cartilage cap thickness.\n    \"\"\"\n\n    # Define the constant standard deviation of the measurement error.\n    # All units are in centimeters.\n    sigma = 0.2\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (true_thickness_t, threshold_tau).\n    test_cases = [\n        # Case A (adult, near-below threshold)\n        (1.8, 2.0),\n        # Case B (adult, boundary at threshold)\n        (2.0, 2.0),\n        # Case C (adult, above threshold)\n        (2.5, 2.0),\n        # Case D (child, near-below threshold)\n        (2.9, 3.0),\n        # Case E (child, above threshold)\n        (3.4, 3.0),\n    ]\n\n    def calculate_metrics(t, tau, sigma_val):\n        \"\"\"\n        Calculates the required probabilities for a single case.\n\n        The measurement M is modeled as a normal random variable M ~ N(t, sigma^2).\n\n        Args:\n            t (float): The true thickness.\n            tau (float): The decision threshold.\n            sigma_val (float): The standard deviation of the measurement error.\n\n        Returns:\n            list: A list containing:\n                  - Probability of measured positive.\n                  - False positive probability.\n                  - False negative probability.\n        \"\"\"\n        # P(measured positive) = P(M > tau)\n        # We use the survival function (1 - CDF) of the normal distribution.\n        # The distribution of M is N(loc=t, scale=sigma_val).\n        p_positive = norm.sf(tau, loc=t, scale=sigma_val)\n\n        # P(measured negative) = P(M = tau)\n        # We use the cumulative distribution function (CDF).\n        p_negative = norm.cdf(tau, loc=t, scale=sigma_val)\n\n        # Determine the ground truth classification.\n        # Ground truth is positive if t > tau.\n        is_true_positive = t > tau\n\n        # A false positive occurs when the measurement is positive (M > tau)\n        # but the ground truth is negative (t = tau).\n        # This can only happen if the ground truth is negative.\n        fp_prob = p_positive if not is_true_positive else 0.0\n\n        # A false negative occurs when the measurement is negative (M = tau)\n        # but the ground truth is positive (t > tau).\n        # This can only happen if the ground truth is positive.\n        fn_prob = p_negative if is_true_positive else 0.0\n\n        return [p_positive, fp_prob, fn_prob]\n\n    results = []\n    for t_case, tau_case in test_cases:\n        # Calculate the three metrics for the current test case.\n        metrics = calculate_metrics(t_case, tau_case, sigma)\n        results.append(metrics)\n\n    # Format the final output string as specified.\n    # Each inner list is converted to a string with comma-separated values,\n    # and these strings are then joined by commas.\n    # Example: \"[[val1,val2],[val3,val4]]\"\n    inner_results_str = [f\"[{','.join(map(str, res))}]\" for res in results]\n    final_output_str = f\"[{','.join(inner_results_str)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output_str)\n\nsolve()\n```", "id": "4417136"}]}