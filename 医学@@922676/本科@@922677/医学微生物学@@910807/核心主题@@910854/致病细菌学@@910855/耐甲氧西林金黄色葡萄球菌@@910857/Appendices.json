{"hands_on_practices": [{"introduction": "在临床微生物学中，最低抑菌浓度（Minimal Inhibitory Concentration, MIC）是指导抗生素治疗的基石。然而，原始的MIC数值本身并不能直接告诉我们治疗是否会成功；它必须根据既定的临床折点进行解释。本练习将引导你完成一项核心的实验室任务：将一组耐甲氧西林金黄色葡萄球菌（MRSA）分离株对万古霉素的MIC测量值，根据临床和实验室标准协会（CLSI）的指南进行分类，并计算敏感菌株的比例。这项实践旨在强化你将原始实验数据转化为具有临床意义的分类的能力，这是微生物学家的一项基本技能。[@problem_id:4651851]", "problem": "一个临床微生物实验室正在对耐甲氧西林金黄色葡萄球菌（MRSA）血流分离株进行监测。该实验室使用标准化的肉汤微量稀释法测定万古霉素的最低抑菌浓度（MIC）。请使用以下基本原则和公认事实作为您推理的基础：\n\n- 最低抑菌浓度（MIC）的定义是，在标准化条件下，能够抑制微生物可见生长的最低抗菌药物浓度。\n- 根据临床和实验室标准协会（CLSI）对金黄色葡萄球菌的折点标准，万古霉素的敏感性类别按MIC划分如下：\n  - 敏感：$\\leq 2 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n  - 中介：$4\\text{–}8 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n  - 耐药：$\\geq 16 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n\n一组MRSA分离株测得的万古霉素MIC值（单位：$\\mu\\mathrm{g}/\\mathrm{mL}$）如下：$0.5$、$1$、$2$、$4$、$8$、$1$、$2$、$16$、$0.25$、$2$、$4$、$1$、$32$、$2$、$8$、$1$、$0.5$。\n\n从MIC的定义和上述CLSI折点框架出发，对每个分离株进行敏感性分类，然后计算被归类为敏感的分离株所占的小数比例。将您的最终答案表示为四舍五入到四位有效数字的小数。答案中不要使用百分号。", "solution": "在尝试求解之前，将首先验证问题陈述的科学合理性、自我一致性和清晰度。\n\n### 问题验证\n\n**步骤1：提取已知信息**\n\n问题陈述中提供了以下信息：\n-   **最低抑菌浓度（MIC）的定义：**“在标准化条件下，能够抑制微生物可见生长的最低抗菌药物浓度。”\n-   **临床和实验室标准协会（CLSI）关于*Staphylococcus aureus*和万古霉素的折点：**\n    -   敏感：MIC $\\leq 2 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n    -   中介：MIC $4\\text{–}8 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n    -   耐药：MIC $\\geq 16 \\, \\mu\\mathrm{g}/\\mathrm{mL}$\n-   **测得的万古霉素MIC值集合（单位：$\\mu\\mathrm{g}/\\mathrm{mL}$）：**$\\{0.5, 1, 2, 4, 8, 1, 2, 16, 0.25, 2, 4, 1, 32, 2, 8, 1, 0.5\\}$\n-   **任务：**对每个分离株进行分类，并计算被归类为敏感的分离株所占的小数比例，结果保留四位有效数字。\n\n**步骤2：使用提取的已知信息进行验证**\n\n根据验证标准对问题进行评估：\n1.  **科学依据：**该问题基于临床微生物学的既定原则。MIC的定义以及CLSI关于万古霉素和*S. aureus*的折点是标准的、事实正确的，并在临床实践中广泛使用。MRSA监测的场景是微生物实验室的一项常规且关键的职能。该问题具有科学合理性。\n2.  **适定性：**所有必要的数据（MIC集合）和分类规则（CLSI折点）均已提供。目标明确陈述：计算敏感分离株的比例。可以确定唯一的解。该问题是适定的。\n3.  **客观性：**该问题以精确、定量和无偏见的术语陈述。它依赖于标准定义和数据，而非主观论断。该问题是客观的。\n4.  **完整性和一致性：**数据和定义是完整的且内部一致。折点中没有未定义的区域，不会对给定的数据点造成歧义。\n5.  **现实性：**所提供的MIC值对于临床*S. aureus*分离株群体是合理的，反映了典型的敏感性分布。\n\n**步骤3：结论与行动**\n\n该问题被确定为**有效**。它具有科学合理性、适定性，并包含进行求解所需的所有必要信息。\n\n### 解答\n\n目标是根据提供的最低抑菌浓度（MIC）值，确定被分类为对万古霉素敏感的耐甲氧西林*金黄色葡萄球菌*（MRSA）分离株所占的小数比例。\n\n首先，我们确定数据集中的分离株总数。提供的MIC值集合为：\n$$ M = \\{0.5, 1, 2, 4, 8, 1, 2, 16, 0.25, 2, 4, 1, 32, 2, 8, 1, 0.5\\} $$\n通过计算该集合中的元素数量，我们得到分离株的总数 $N_{total}$。\n$$ N_{total} = 17 $$\n\n接下来，我们必须识别出被归类为敏感的分离株。根据提供的CLSI折点，如果一个分离株的万古霉素MIC小于或等于 $2 \\, \\mu\\mathrm{g}/\\mathrm{mL}$，则其为敏感。用数学方式表示，此条件为：\n$$ \\text{MIC} \\leq 2 \\, \\mu\\mathrm{g}/\\mathrm{mL} $$\n\n现在，我们根据此标准系统地评估集合 $M$ 中的每个MIC值，以计算敏感分离株的数量，记为 $N_{susceptible}$。\n\n1.  MIC = $0.5$：$0.5 \\leq 2$，因此是敏感的。\n2.  MIC = $1$：$1 \\leq 2$，因此是敏感的。\n3.  MIC = $2$：$2 \\leq 2$，因此是敏感的。\n4.  MIC = $4$：$4  2$，不是敏感的（中介）。\n5.  MIC = $8$：$8  2$，不是敏感的（中介）。\n6.  MIC = $1$：$1 \\leq 2$，因此是敏感的。\n7.  MIC = $2$：$2 \\leq 2$，因此是敏感的。\n8.  MIC = $16$：$16  2$，不是敏感的（耐药）。\n9.  MIC = $0.25$：$0.25 \\leq 2$，因此是敏感的。\n10. MIC = $2$：$2 \\leq 2$，因此是敏感的。\n11. MIC = $4$：$4  2$，不是敏感的（中介）。\n12. MIC = $1$：$1 \\leq 2$，因此是敏感的。\n13. MIC = $32$：$32  2$，不是敏感的（耐药）。\n14. MIC = $2$：$2 \\leq 2$，因此是敏感的。\n15. MIC = $8$：$8  2$，不是敏感的（中介）。\n16. MIC = $1$：$1 \\leq 2$，因此是敏感的。\n17. MIC = $0.5$：$0.5 \\leq 2$，因此是敏感的。\n\n将符合敏感性标准的分离株数量相加：\n$$ N_{susceptible} = 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 = 11 $$\n共有 $11$ 个敏感分离株。\n\n敏感分离株所占的小数比例 $f_{susceptible}$ 是敏感分离株数量与分离株总数之比。\n$$ f_{susceptible} = \\frac{N_{susceptible}}{N_{total}} $$\n代入计数值：\n$$ f_{susceptible} = \\frac{11}{17} $$\n\n为了以要求的格式提供答案，我们必须计算该分数的十进制值，并将其四舍五入到四位有效数字。\n$$ \\frac{11}{17} \\approx 0.6470588235... $$\n前四位有效数字是 $6$、$4$、$7$ 和 $0$。第五位有效数字是 $5$。根据标准四舍五入规则，如果要舍弃的第一位数字是 $5$ 或更大，则保留的最后一位数字加一。因此，数字 $0$ 向上取整为 $1$。\n\n最终四舍五入到四位有效数字的小数比例为 $0.6471$。", "answer": "$$\\boxed{0.6471}$$", "id": "4651851"}, {"introduction": "“敏感”或“耐药”的二元分类有时会掩盖重要的临床细节。本练习探讨了“MIC漂移”这一现象，即MRSA对万古霉素的MIC值在“敏感”范围内逐渐升高，但这可能与治疗失败风险增加相关。通过构建一个结合药代动力学/药效动力学（PK/PD）原理的计算模型，你将量化这种微小变化如何显著影响临床治疗失败的概率。这项前沿的实践将实验室测量值（如 $AUC_{24}/MIC$ 比值）与真实的患者治疗结果联系起来，展示了超越简单分类的定量分析在现代临床决策中的重要性。[@problem_id:4651801]", "problem": "一个实验室观察到，耐甲氧西林金黄色葡萄球菌 (methicillin-resistant Staphylococcus aureus, MRSA) 分离株对万古霉素的最低抑菌浓度 (Minimum Inhibitory Concentration, MIC) 值逐渐升高，但仍处于临床敏感范围内。这种现象通常被称为万古霉素MIC漂移 (vancomycin MIC creep)，引发了对治疗失败率上升的担忧。请构建一个计算模型，以量化在固定剂量下，敏感范围内的 MIC 变化如何影响临床失败的预期概率。\n\n请使用以下基本依据和假设，除此处所述之外，不引入任何简化方法：\n- 最低抑菌浓度 (MIC) 是指能够抑制细菌可见生长的最低抗生素浓度；对于万古霉素作用于 MRSA，MIC 的单位是毫克/升 ($\\text{mg/L}$)。\n- 万古霉素治疗 MRSA 菌血症的药代动力学/药效动力学 (pharmacokinetic/pharmacodynamic) 原理是，疗效与 24 小时浓度-时间曲线下面积与 MIC 的比值（记为 $AUC_{24}/MIC$）是否超过目标阈值 $R_{target}$ 相关。在本问题中，取 $R_{target} = 400$。\n- 患者的药物暴露量，量化为 24 小时浓度-时间曲线下面积 $AUC_{24}$（单位 $\\text{mg}\\cdot\\text{h/L}$），在个体间存在差异，并建模为对数正态分布。具体来说，令 $\\ln(AUC_{24}) \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其中 $\\mu$ 和 $\\sigma$ 分别是自然对数尺度上的均值和标准差。\n- 对于一个 MIC 值为 $m$ 的给定分离株，当 $AUC_{24}/m \\ge R_{target}$（等价于 $AUC_{24} \\ge R_{target} \\cdot m$）时，即为药效动力学靶点达标。\n- 临床失败风险建模为两个组成部分之和：一个基础失败概率 $p_0$（即使在药效动力学靶点达标时也持续存在），以及一个与药效动力学靶点未达标概率成正比增加的增量失败概率。设比例常数为 $\\alpha$。单个分离株的总失败概率被限制在区间 $[0,1]$ 内。\n\n你的程序必须对下面列出的每个测试用例，计算队列水平的预期临床失败概率，该概率为所提供 MIC 值列表中各个失败概率的简单算术平均值，并假设每个 MIC 值代表一个同等频率的分离株。将每个最终的队列水平预期失败概率表示为四舍五入到 $4$ 位小数的浮点数。数值输出不应附带任何物理单位。\n\n测试套件（每个用例指定了 $(\\mu, \\sigma, R_{target}, p_0, \\alpha, \\text{MIC 列表})$）：\n- 用例 $1$（常规顺利路径，中等变异性，较低的 MIC 分布）：$(\\mu=\\ln(500), \\sigma=0.4, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[0.5, 0.75, 1.0, 1.0])$。\n- 用例 $2$（MIC 漂移场景，相同暴露量但 MIC 值上移）：$(\\mu=\\ln(500), \\sigma=0.4, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[1.0, 1.5, 2.0, 2.0])$。\n- 用例 $3$（高暴露量下，处于敏感 MIC 上限的边界条件）：$(\\mu=\\ln(650), \\sigma=0.3, R_{target}=400, p_0=0.10, \\alpha=0.5, \\text{MICs}=[2.0, 2.0, 2.0, 2.0])$。\n- 用例 $4$（暴露量不佳且变异性较高的边缘情况）：$(\\mu=\\ln(380), \\sigma=0.5, R_{target}=400, p_0=0.20, \\alpha=0.8, \\text{MICs}=[1.0, 1.5, 2.0])$。\n- 用例 $5$（使用双峰 MIC 分布的变异性压力测试）：$(\\mu=\\ln(500), \\sigma=0.8, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[0.5, 2.0])$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来并以逗号分隔的结果列表（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3]$）。每个条目对应一个测试用例，按从用例 $1$ 到用例 $5$ 的顺序排列，四舍五入到 $4$ 位小数，不打印任何额外文本。", "solution": "对问题陈述进行验证。\n\n### 步骤1：提取已知条件\n- **模型：** 一个计算模型，用于量化最低抑菌浓度 (MIC) 的变化如何影响临床失败概率。\n- **MIC：** 单位为毫克/升 ($\\text{mg/L}$)。\n- **PK/PD 靶点：** 24小时浓度-时间曲线下面积与 MIC 的比值 $AUC_{24}/MIC$ 必须大于或等于一个目标阈值 $R_{target}$。\n- **目标值：** $R_{target} = 400$。\n- **暴露量分布：** $AUC_{24}$ 呈对数正态分布。具体来说，$\\ln(AUC_{24}) \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其中 $\\mu$ 和 $\\sigma$ 分别是自然对数尺度上的均值和标准差。\n- **靶点达标条件：** 对于一个 MIC 为 $m$ 的分离株，达标条件为 $AUC_{24}/m \\ge R_{target}$，或 $AUC_{24} \\ge R_{target} \\cdot m$。\n- **临床失败模型：** 总失败概率是基础概率 $p_0$ 与一个和靶点未达标概率成正比的增量概率之和。比例常数为 $\\alpha$。总概率被限制在区间 $[0, 1]$ 内。\n- **计算任务：** 计算队列水平的预期临床失败概率，定义为给定 MIC 列表中各个失败概率的算术平均值。\n- **输出格式：** 四舍五入到 $4$ 位小数的浮点数。\n- **测试用例：**\n  - 用例 $1$：$(\\mu=\\ln(500), \\sigma=0.4, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[0.5, 0.75, 1.0, 1.0])$。\n  - 用例 $2$：$(\\mu=\\ln(500), \\sigma=0.4, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[1.0, 1.5, 2.0, 2.0])$。\n  - 用例 $3$：$(\\mu=\\ln(650), \\sigma=0.3, R_{target}=400, p_0=0.10, \\alpha=0.5, \\text{MICs}=[2.0, 2.0, 2.0, 2.0])$。\n  - 用例 $4$：$(\\mu=\\ln(380), \\sigma=0.5, R_{target}=400, p_0=0.20, \\alpha=0.8, \\text{MICs}=[1.0, 1.5, 2.0])$。\n  - 用例 $5$：$(\\mu=\\ln(500), \\sigma=0.8, R_{target}=400, p_0=0.15, \\alpha=0.7, \\text{MICs}=[0.5, 2.0])$。\n\n### 步骤2：使用提取的已知条件进行验证\n这个问题在科学上基于既定的药代动力学/药效动力学 (PK/PD) 原理，特别是使用 $AUC_{24}/MIC$ 比值作为万古霉素疗效的预测指标，以及患者群体中 PK 参数的对数正态分布。临床失败模型对于此类分析是一个合理的简化。问题定义明确，提供了所有必要的参数和一个清晰、无歧义的目标。所有数据和常数（$R_{target}=400$、MIC 值等）都是现实的，并且在临床相关范围内。问题是客观、完整且内部一致的。\n\n### 步骤3：结论与行动\n问题有效。以下是推理的解决方案。\n\n问题的核心是计算队列水平的预期临床失败概率 $P_{\\text{cohort}}$。这是针对所提供列表中的每个 MIC 值 $m$ 的单个临床失败概率 $P(\\text{failure}|m)$ 的算术平均值。\n\n首先，我们为具有给定 MIC $m$ 的单个分离株定义临床失败概率模型。根据问题陈述，该模型为：\n$$\nP(\\text{failure}|m) = \\min(1, p_0 + \\alpha \\cdot P(\\text{non-attainment}|m))\n$$\n其中 $p_0$ 是基础失败概率，$\\alpha$ 是比例常数，$P(\\text{non-attainment}|m)$ 是 MIC 为 $m$ 的分离株药效动力学靶点未达标的概率。\n\n接下来，我们必须推导 $P(\\text{non-attainment}|m)$ 的表达式。靶点达标的条件是 $AUC_{24}/m \\ge R_{target}$。因此，当以下情况发生时，即为未达标：\n$$\n\\frac{AUC_{24}}{m}  R_{target}\n$$\n这个不等式可以重新整理，以分离出患者特异性药代动力学参数 $AUC_{24}$：\n$$\nAUC_{24}  R_{target} \\cdot m\n$$\n我们已知 $AUC_{24}$ 服从对数正态分布，这意味着它的自然对数 $\\ln(AUC_{24})$ 服从正态分布。令 $X = \\ln(AUC_{24})$，因此 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$。为了利用这个分布信息，我们对不等式两边取自然对数：\n$$\n\\ln(AUC_{24})  \\ln(R_{target} \\cdot m)\n$$\n因此，未达标的概率是随机变量 $X$ 小于值 $\\ln(R_{target} \\cdot m)$ 的概率：\n$$\nP(\\text{non-attainment}|m) = P(X  \\ln(R_{target} \\cdot m))\n$$\n为了计算这个概率，我们使用变换 $Z = \\frac{X - \\mu}{\\sigma}$ 将正态随机变量 $X$ 标准化为标准正态随机变量 $Z \\sim \\mathcal{N}(0, 1)$。将此应用于我们的不等式得到：\n$$\n\\frac{X - \\mu}{\\sigma}  \\frac{\\ln(R_{target} \\cdot m) - \\mu}{\\sigma}\n$$\n因此，未达标的概率可以用标准正态分布的累积分布函数 (CDF) 表示，记为 $\\Phi(\\cdot)$：\n$$\nP(\\text{non-attainment}|m) = P\\left(Z  \\frac{\\ln(R_{target} \\cdot m) - \\mu}{\\sigma}\\right) = \\Phi\\left(\\frac{\\ln(R_{target} \\cdot m) - \\mu}{\\sigma}\\right)\n$$\n这个值可以使用标准统计库进行数值计算。\n\n最后，对于一个包含 $N$ 个分离株且 MIC 列表为 $\\{m_1, m_2, \\ldots, m_N\\}$ 的队列，队列水平的预期临床失败概率 $P_{\\text{cohort}}$ 是各个概率的算术平均值：\n$$\nP_{\\text{cohort}} = \\frac{1}{N} \\sum_{i=1}^{N} P(\\text{failure}|m_i)\n$$\n推导到此结束。每个测试用例的计算过程如下：\n$1$. 对于列表中的每个 MIC 值 $m_i$，计算 z-score：$z_i = \\frac{\\ln(R_{target} \\cdot m_i) - \\mu}{\\sigma}$。\n$2$. 对于每个 $z_i$，计算未达标概率：$P(\\text{non-attainment}|m_i) = \\Phi(z_i)$。\n$3$. 计算单个失败概率：$P(\\text{failure}|m_i) = \\min(1, p_0 + \\alpha \\cdot \\Phi(z_i))$。\n$4$. 计算这些单个概率的平均值，以得到队列水平的失败概率。\n$5$. 将最终结果四舍五入到 $4$ 位小数。\n\n此过程将对所有提供的测试用例实施。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes cohort-level expected clinical failure probability based on a\n    pharmacokinetic/pharmacodynamic model for vancomycin against MRSA.\n    \"\"\"\n    # Test suite from the problem statement.\n    # Format: (mu_base_val, sigma, r_target, p0, alpha, mics_list)\n    # mu_base_val is the value inside ln(), e.g., 500 for mu=ln(500).\n    test_cases = [\n        (500, 0.4, 400, 0.15, 0.7, [0.5, 0.75, 1.0, 1.0]),\n        (500, 0.4, 400, 0.15, 0.7, [1.0, 1.5, 2.0, 2.0]),\n        (650, 0.3, 400, 0.10, 0.5, [2.0, 2.0, 2.0, 2.0]),\n        (380, 0.5, 400, 0.20, 0.8, [1.0, 1.5, 2.0]),\n        (500, 0.8, 400, 0.15, 0.7, [0.5, 2.0])\n    ]\n\n    results = []\n    for case in test_cases:\n        mu_base_val, sigma, r_target, p0, alpha, mics = case\n        \n        # The mean of the log-transformed AUC_24 distribution\n        mu = np.log(mu_base_val)\n        \n        individual_failure_probs = []\n        for mic in mics:\n            # Calculate the log of the AUC target threshold for a given MIC\n            # Target is AUC_24 = R_target * MIC\n            # Non-attainment is ln(AUC_24)  ln(R_target * MIC)\n            ln_target_auc = np.log(r_target * mic)\n            \n            # Standardize the variable to find the probability from the standard normal CDF\n            z_score = (ln_target_auc - mu) / sigma\n            \n            # Probability of non-attainment is the CDF of the z-score\n            p_non_attainment = norm.cdf(z_score)\n            \n            # Calculate the total failure probability for this individual MIC\n            # The probability is capped at 1.0\n            p_fail_individual = min(1.0, p0 + alpha * p_non_attainment)\n            \n            individual_failure_probs.append(p_fail_individual)\n            \n        # The cohort-level failure probability is the arithmetic mean\n        cohort_fail_prob = np.mean(individual_failure_probs)\n        \n        # Round to 4 decimal places as required\n        results.append(round(cohort_fail_prob, 4))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4651801"}, {"introduction": "将视角从单个患者扩展到整个医疗环境，是理解和控制MRSA传播的关键。本练习将指导你构建一个代理人基模型（Agent-Based Model, ABM），这是一种强大的现代流行病学工具，用于模拟MRSA在医院病房内的传播动态。你将通过编程实现患者与医护人员之间的互动规则，并探索不同干预措施（例如调整医护人员与患者的比例）对控制MRSA定植率的效果。这项实践不仅能加深你对感染控制原理的理解，还能让你体验计算建模在制定公共卫生策略中的应用。[@problem_id:4651791]", "problem": "您需要为一个医院单一病房内耐甲氧西林金黄色葡萄球菌（MRSA）的传播实现一个离散时间的基于智能体的模型。该模型包括患者和医护人员（HCWs），其中患者可以处于两种状态之一（易感或定植），而医护人员可以处于短暂污染或清洁状态。模拟以每日为时间步长推进，并在每一天内通过离散的患者-医护人员接触事件进行。所有数学实体必须按如下方式解释。\n\n使用以下基本且经过充分检验的事实来构建模型：\n- 金黄色葡萄球菌（包括耐甲氧西林菌株）的传播通过直接接触发生，医护人员的手是主要的传播媒介。手部卫生降低了在不同患者接触之间手部保持污染的概率。\n- 在质量作用近似中，接触次数可以建模为泊松过程。离散时间马尔可夫转移捕捉了个体层面的定植和去定植动态。\n\n请精确实现以下模型规则：\n1. 病房组成和状态：\n   - 有 $P$ 名患者和 $S$ 名医护人员（HCWs）。\n   - 每位患者在任何时候要么是易感状态，要么是定植状态。\n   - 每位医护人员可以处于短暂污染或清洁状态；污染状态在每天开始时重置为清洁状态。\n\n2. 接触：\n   - 对于每一天和每位医护人员，独立地从均值为每天 $r$ 次接触的泊松分布中抽取当天的患者接触次数 $C$。\n   - 对于 $C$ 次接触中的每一次，从 $P$ 名患者中均匀随机地选择一名患者。\n   - 在每次接触之前，医护人员以概率 $h$ 独立地执行手部卫生。如果执行，该医护人员立即变为清洁状态。\n   - 接触顺序和接触内的传播：\n     - 如果在接触时医护人员处于污染状态且患者处于易感状态，则该患者在该次接触中以概率 $\\beta_{ps}$ 变为定植状态。\n     - 之后，如果在接触时患者处于定植状态，则该医护人员由于该次接触而以概率 $\\beta_{sp}$ 变为污染状态。\n   - 对于每次接触事件，这两个传播方向按此顺序进行评估。\n   - 在每天开始时，所有医护人员都是清洁的（未被污染）。\n\n3. 去定植：\n   - 在每天结束时，每位定植的患者独立地以概率 $\\delta$ 去定植，变为易感状态。\n\n4. 初始化：\n   - 在第 $t=0$ 天，从 $P$ 名患者中均匀随机地选择恰好 $I_0$ 名患者初始化为定植状态。所有医护人员开始时都是清洁状态。\n\n5. 模拟时域和输出：\n   - 模拟上述动态 $T$ 天。第 $T$ 天结束时的定植率定义为在第 $T$ 天结束时定植患者的比例，即定植患者数除以 $P$，以小数形式表示（而非百分比）。\n   - 由于模型是随机的，每个测试用例使用指定的伪随机数生成器种子以确保确定性输出。每个测试用例使用一个种子，应用于该用例内的所有随机抽取。\n\n科学真实性约束：\n- 概率参数必须满足 $0 \\le \\beta_{ps} \\le 1$、$0 \\le \\beta_{sp} \\le 1$、$0 \\le h \\le 1$ 和 $0 \\le \\delta \\le 1$。\n- 泊松接触模型是流行病学基于智能体的模型中用于接触次数的经过充分检验的选择。\n- 接触内传播事件的顺序反映了手部卫生在接触前影响污染状态，而定植的患者可以在接触期间污染一名清洁的医护人员。\n\n您的程序不得接受外部输入，并且必须评估以下测试套件。对于每个测试用例，按规定运行一次模拟，并返回第 $T$ 天的定植率，四舍五入到三位小数。输出必须按顺序作为单个列表报告。测试套件如下：\n\n- 案例 1（基线）：\n  - $P = 20$, $S = 5$, $r = 12$, $\\beta_{sp} = 0.20$, $\\beta_{ps} = 0.10$, $h = 0.40$, $\\delta = 0.05$, $T = 30$, $I_0 = 2$, 种子 $= 17$。\n\n- 案例 2（较低的医护-患者比）：\n  - $P = 20$, $S = 2$, $r = 12$, $\\beta_{sp} = 0.20$, $\\beta_{ps} = 0.10$, $h = 0.40$, $\\delta = 0.05$, $T = 30$, $I_0 = 2$, 种子 $= 23$。\n\n- 案例 3（较高的医护-患者比）：\n  - $P = 20$, $S = 10$, $r = 12$, $\\beta_{sp} = 0.20$, $\\beta_{ps} = 0.10$, $h = 0.40$, $\\delta = 0.05$, $T = 30$, $I_0 = 2$, 种子 $= 31$。\n\n- 案例 4（完美手部卫生边界情况）：\n  - $P = 20$, $S = 5$, $r = 12$, $\\beta_{sp} = 0.20$, $\\beta_{ps} = 0.10$, $h = 1.00$, $\\delta = 0.05$, $T = 30$, $I_0 = 2$, 种子 $= 41$。\n\n- 案例 5（无初始定植边界情况）：\n  - $P = 20$, $S = 10$, $r = 12$, $\\beta_{sp} = 0.20$, $\\beta_{ps} = 0.10$, $h = 0.40$, $\\delta = 0.05$, $T = 30$, $I_0 = 0$, 种子 $= 53$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 `[0.123,0.456,0.789,0.012,0.345]`。\n- 列表中的每个条目必须是相应测试用例在第 $T$ 天的定植率，以小数形式表示（而非百分比），并四舍五入到三位小数。", "solution": "用户提供的问题陈述已经过分析，并被确定为**有效**。它具有科学依据，是良定的，并为医院病房内耐甲氧西林*金黄色葡萄球菌*（MRSA）传播的离散时间基于智能体的模拟提供了完整、无歧义的规范。为每个测试用例提供了所有必要的参数、初始条件和程序规则，并且使用指定的伪随机数生成器种子确保了每次模拟都有一个唯一的、确定性的和可验证的结果。该模型结构符合数学流行病学中的既定原则。\n\n该解决方案涉及根据患者和医护人员（HCW）状态、接触动态、传播概率和去定植的规则，实现指定的基于智能体的模型（ABM）。模拟运行指定的持续时间，并计算最终的定植率。\n\n模型构建如下：\n\n**1. 状态表示**\n系统由 $P$ 名患者和 $S$ 名医护人员组成。\n- 患者群体的状态由一个大小为 $P$ 的一维数组表示。每个元素对应一名患者，如果患者被定植，则值为 $1$，如果易感，则值为 $0$。\n- 医护人员群体的状态由一个大小为 $S$ 的一维数组表示。每个元素对应一名医护人员，如果其手部被短暂污染，则值为 $1$，如果清洁，则值为 $0$。\n\n**2. 初始化（在时间 $t=0$）**\n- 对于每次模拟，使用特定的种子初始化伪随机数生成器（RNG），以确保可复现性。\n- 患者状态数组初始化为全零（全部易感）。然后，均匀随机地选择 $I_0$ 名不同的患者，并将其状态设置为 $1$（定植）。\n- 医护人员状态数组初始化为全零，因为所有医护人员开始时手部都是清洁的。\n\n**3. 模拟时间步进**\n模拟以离散的每日时间步长进行，从第 $1$ 天到第 $T$ 天。单日内的事件按特定顺序执行。\n\n**4. 每日事件序列**\n对于模拟时域 $\\{1, 2, ..., T\\}$ 中的每一天：\n\n**步骤 4.1：每日开始**\n- 所有 $S$ 名医护人员的状态重置为清洁。这反映了手部污染的短暂性，它不会持续过夜。医护人员状态数组重置为全零。\n\n**步骤 4.2：接触与传播阶段**\n该阶段模拟当天所有的患者-医护人员互动。模拟独立地遍历 $S$ 名医护人员中的每一位。对于每位医护人员：\n- 该医护人员当天的患者接触次数 $C$ 从均值为 $r$ 的泊松分布中抽取。在计算上，$C \\sim \\text{Poisson}(r)$。\n- 执行一个循环 $C$ 次，每次对应一次接触。对于 $C$ 次接触中的每一次：\n    - **手部卫生**：从均匀分布 $\\mathcal{U}(0, 1)$ 中抽取一个随机数 $u_h$。如果 $u_h  h$，医护人员执行手部卫生，其污染状态设置为 $0$（清洁）。\n    - **患者选择**：通过从 $\\{0, 1, ..., P-1\\}$ 中均匀随机抽取一个索引来选择一个患者进行接触。\n    - **传播事件**：两个潜在的传播事件按指定顺序依次发生。\n        1. **医护人员到患者的传播**：如果医护人员被污染（状态为 $1$）且所选患者易感（状态为 $0$），则以概率 $\\beta_{ps}$ 发生传播。抽取一个随机数 $u_{ps} \\sim \\mathcal{U}(0, 1)$；如果 $u_{ps}  \\beta_{ps}$，则患者的状态更新为 $1$（定植）。\n        2. **患者到医护人员的传播**：上一步之后，如果所选患者被定植（状态为 $1$），医护人员的手可能会被污染。请注意，此处使用的患者状态是其当前状态，可能刚刚在上一个传播步骤中更新过。向医护人员手部的传播以概率 $\\beta_{sp}$ 发生。抽取一个随机数 $u_{sp} \\sim \\mathcal{U}(0, 1)$；如果 $u_{sp}  \\beta_{sp}$，则医护人员的状态更新为 $1$（污染）。这个新状态将带到该医护人员在同一天内的下一次接触中，除非执行了手部卫生。\n\n**步骤 4.3：每日结束 - 去定植**\n- 在当天所有医护人员的所有接触都模拟完毕后，每个定植的患者都有机会自发清除定植。\n- 算法识别所有状态为 $1$ 的患者。对于这些定植的患者中的每一位，抽取一个随机数 $u_{\\delta} \\sim \\mathcal{U}(0, 1)$。如果 $u_{\\delta}  \\delta$，则该患者的状态重置为 $0$（易感）。\n\n**5. 最终输出计算**\n- 在所有 $T$ 天的模拟循环完成后，从最终的患者状态数组中计算出定植患者的总数 $I_T$。\n- 定植率计算为定植患者的比例：\n$$ \\text{Prevalence} = \\frac{I_T}{P} $$\n- 然后将该值按要求四舍五入到三位小数。\n\n这整个过程，从初始化到最终计算，对所提供的五个测试用例中的每一个都重复进行，使用它们各自的参数集。", "answer": "```python\nimport numpy as np\n\ndef run_simulation(P, S, r, beta_sp, beta_ps, h, delta, T, I0, seed):\n    \"\"\"\n    Runs a single instance of the MRSA transmission simulation.\n\n    Args:\n        P (int): Number of patients.\n        S (int): Number of healthcare workers (HCWs).\n        r (float): Mean number of contacts per HCW per day.\n        beta_sp (float): Transmission probability from colonized patient to susceptible HCW.\n        beta_ps (float): Transmission probability from contaminated HCW to susceptible patient.\n        h (float): Probability of hand hygiene before a contact.\n        delta (float): Daily probability of spontaneous decolonization for a patient.\n        T (int): Number of days to simulate.\n        I0 (int): Initial number of colonized patients.\n        seed (int): Seed for the pseudorandom number generator.\n\n    Returns:\n        float: Colonization prevalence at the end of day T.\n    \"\"\"\n    # 1. Initialization\n    rng = np.random.default_rng(seed)\n    \n    # Patient states: 0 = susceptible, 1 = colonized\n    patient_states = np.zeros(P, dtype=np.int8)\n    if I0  0:\n        initial_colonized_indices = rng.choice(P, size=I0, replace=False)\n        patient_states[initial_colonized_indices] = 1\n\n    # 2. Simulation Loop (Time Stepping)\n    for day in range(T):\n        # 2.1 Start of Day: HCW states reset to clean\n        # HCW states: 0 = clean, 1 = contaminated\n        hcw_states = np.zeros(S, dtype=np.int8)\n\n        # 2.2 Contact and Transmission Phase\n        for s_idx in range(S):\n            # Draw number of contacts for this HCW for the day\n            num_contacts = rng.poisson(r)\n            \n            for _ in range(num_contacts):\n                # 2.2.1 Hand Hygiene\n                if rng.random()  h:\n                    hcw_states[s_idx] = 0  # HCW becomes clean\n                \n                # 2.2.2 Patient Selection\n                p_idx = rng.integers(0, P)\n\n                # 2.2.3 Transmission Events (in order)\n                # a) HCW-to-Patient Transmission\n                if hcw_states[s_idx] == 1 and patient_states[p_idx] == 0:\n                    if rng.random()  beta_ps:\n                        patient_states[p_idx] = 1 # Patient becomes colonized\n                \n                # b) Patient-to-HCW Transmission\n                # This check uses the patient's state *at the time of contact*, which may\n                # have just been updated in the step above.\n                if patient_states[p_idx] == 1:\n                    if rng.random()  beta_sp:\n                        hcw_states[s_idx] = 1 # HCW becomes contaminated\n\n        # 2.3 End of Day: Decolonization\n        colonized_indices_today = np.where(patient_states == 1)[0]\n        for p_idx in colonized_indices_today:\n            if rng.random()  delta:\n                patient_states[p_idx] = 0 # Patient becomes susceptible\n    \n    # 3. Final Calculation\n    final_colonized_count = np.sum(patient_states)\n    prevalence = final_colonized_count / P\n    \n    return prevalence\n\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (baseline)\n        {\"P\": 20, \"S\": 5, \"r\": 12, \"beta_sp\": 0.20, \"beta_ps\": 0.10, \"h\": 0.40, \"delta\": 0.05, \"T\": 30, \"I0\": 2, \"seed\": 17},\n        # Case 2 (lower staff-to-patient ratio)\n        {\"P\": 20, \"S\": 2, \"r\": 12, \"beta_sp\": 0.20, \"beta_ps\": 0.10, \"h\": 0.40, \"delta\": 0.05, \"T\": 30, \"I0\": 2, \"seed\": 23},\n        # Case 3 (higher staff-to-patient ratio)\n        {\"P\": 20, \"S\": 10, \"r\": 12, \"beta_sp\": 0.20, \"beta_ps\": 0.10, \"h\": 0.40, \"delta\": 0.05, \"T\": 30, \"I0\": 2, \"seed\": 31},\n        # Case 4 (perfect hand hygiene edge case)\n        {\"P\": 20, \"S\": 5, \"r\": 12, \"beta_sp\": 0.20, \"beta_ps\": 0.10, \"h\": 1.00, \"delta\": 0.05, \"T\": 30, \"I0\": 2, \"seed\": 41},\n        # Case 5 (no initial colonization edge case)\n        {\"P\": 20, \"S\": 10, \"r\": 12, \"beta_sp\": 0.20, \"beta_ps\": 0.10, \"h\": 0.40, \"delta\": 0.05, \"T\": 30, \"I0\": 0, \"seed\": 53},\n    ]\n\n    results = []\n    for params in test_cases:\n        prevalence = run_simulation(**params)\n        results.append(prevalence)\n\n    # Format the final output as specified\n    # e.g., [0.123,0.456,0.789,0.012,0.345]\n    formatted_results = [f'{res:.3f}' for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# Execute the solver\nsolve()\n```", "id": "4651791"}]}