{"hands_on_practices": [{"introduction": "本练习将经典的社会科学模型——理性选择理论——应用于理解个人为何在传统医疗与生物医学之间做出选择。通过将文化观念量化为“道德可接受性”等因素，我们可以构建一个能够预测求医行为的效用函数。这项练习旨在锻炼你应用概率论来模拟复杂人类决策的能力，揭示文化价值观在健康选择中的作用。[@problem_id:4971360]", "problem": "一位社区健康研究员正在使用理性选择理论，为患者在文化约束下如何在生物医学护理和传统护理之间做出选择进行建模。对于每位患者和每种模式 $k \\in \\{\\text{生物医学}, \\text{传统}\\}$，定义效用\n$$\nU_k \\;=\\; \\alpha E_k \\;-\\; \\beta C_k \\;+\\; \\gamma M_k,\n$$\n其中 $E_k$ 是感知功效（范围为 $[0,1]$），$C_k$ 是以当地货币单位计价的自付费用，$M_k$ 是道德可接受度（范围为 $[0,1]$），其值源自一个经过验证的文化价值观工具。参数 $\\alpha$、$\\beta$ 和 $\\gamma$ 是严格为正的权重，分别量化了患者对感知功效的重视程度、对成本的负价值以及对道德可接受度的重视程度，均以效用单位衡量。假设每位患者都选择效用更高的模式。\n\n假设在某个有深厚祖先治疗传统的地区，对于患者群体，以下基于经验的关于六个决定因素的分布假设成立，并且所有六个随机变量都是相互独立的：\n- 生物医学护理的感知功效：$E_{\\text{biomedical}} \\sim \\mathcal{N}(\\mu_{E_b}, \\sigma_{E_b}^2)$，其中 $\\mu_{E_b} = 0.72$，$\\sigma_{E_b} = 0.15$。\n- 传统护理的感知功效：$E_{\\text{traditional}} \\sim \\mathcal{N}(\\mu_{E_t}, \\sigma_{E_t}^2)$，其中 $\\mu_{E_t} = 0.56$，$\\sigma_{E_t} = 0.20$。\n- 生物医学护理的道德可接受度：$M_{\\text{biomedical}} \\sim \\mathcal{N}(\\mu_{M_b}, \\sigma_{M_b}^2)$，其中 $\\mu_{M_b} = 0.41$，$\\sigma_{M_b} = 0.25$。\n- 传统护理的道德可接受度：$M_{\\text{traditional}} \\sim \\mathcal{N}(\\mu_{M_t}, \\sigma_{M_t}^2)$，其中 $\\mu_{M_t} = 0.80$，$\\sigma_{M_t} = 0.15$。\n- 生物医学护理的自付费用：$C_{\\text{biomedical}} \\sim \\mathcal{N}(\\mu_{C_b}, \\sigma_{C_b}^2)$，其中 $\\mu_{C_b} = 22$，$\\sigma_{C_b} = 10$。\n- 传统护理的自付费用：$C_{\\text{traditional}} \\sim \\mathcal{N}(\\mu_{C_t}, \\sigma_{C_t}^2)$，其中 $\\mu_{C_t} = 7$，$\\sigma_{C_t} = 3$。\n\n在该地区，经文化因素校准的效用权重估计为 $\\alpha = 10$ 效用单位/功效点，$\\beta = 0.05$ 效用单位/货币单位，$\\gamma = 8$ 效用单位/道德可接受度点。\n\n任务：\n- 从定义和理性选择原则（选择效用更高的方案）出发，推导出选择生物医学护理而非传统护理的决策条件。该条件应为一个不等式，其中包含一个单一随机变量，这个随机变量是感知功效、成本和道德可接受度差异的线性组合。\n- 仅使用独立正态分布变量和与差的已知性质，推导出该决策变量的分布，并计算该地区随机选择的一位患者选择生物医学护理的概率。\n\n将最终概率以 $0$ 到 $1$ 之间的小数形式报告，四舍五入到四位有效数字。不要使用百分号。概率无需物理单位。", "solution": "该问题被认为是有效的，因为它在科学上基于理性选择理论和概率论，问题设定完整且一致，表述清晰，并用客观语言表达。在定量社会科学建模中，使用正态分布来建模有界变量是一种常见且可接受的理想化方法，并且在定义范围之外的概率质量足够小，不会使此类练习的问题前提失效。\n\n任务是计算一位随机选择的患者选择生物医学护理而非传统护理的概率。根据理性选择原则，患者会选择效用更高的模式。设生物医学护理的效用为 $U_b$，传统护理的效用为 $U_t$。患者选择生物医学护理当且仅当 $U_b > U_t$。\n\n每种模式 $k \\in \\{\\text{生物医学}, \\text{传统}\\}$ 的效用由以下方程给出：\n$$\nU_k = \\alpha E_k - \\beta C_k + \\gamma M_k\n$$\n其中 $E_k$ 是感知功效，$C_k$ 是自付费用，$M_k$ 是道德可接受度。参数 $\\alpha$、$\\beta$ 和 $\\gamma$ 是正权重。\n\n为了分析该选择，我们定义一个决策变量 $D$ 作为效用之差：\n$$\nD = U_b - U_t\n$$\n选择生物医学护理的条件 $U_b > U_t$ 变为 $D > 0$。\n\n代入 $U_b$ 和 $U_t$ 的表达式，我们可以将 $D$ 写成基础随机变量的线性组合：\n$$\nD = (\\alpha E_b - \\beta C_b + \\gamma M_b) - (\\alpha E_t - \\beta C_t + \\gamma M_t)\n$$\n重新整理各项，我们按权重参数将其分组：\n$$\nD = \\alpha(E_b - E_t) - \\beta(C_b - C_t) + \\gamma(M_b - M_t)\n$$\n此表达式将决策变量表示为功效、成本和道德可接受度差异的线性组合，完成了任务的第一部分。\n\n问题陈述，所有六个随机变量（$E_b, E_t, C_b, C_t, M_b, M_t$）都是相互独立且服从正态分布的。正态分布的一个基本性质是，独立正态随机变量的任何线性组合也是一个正态随机变量。因此，决策变量 $D$ 服从正态分布，即 $D \\sim \\mathcal{N}(\\mu_D, \\sigma_D^2)$。我们需要确定其均值 $\\mu_D$ 和方差 $\\sigma_D^2$。\n\n$D$ 的均值可以使用期望算子的线性性质求得：\n$$\n\\mu_D = E[D] = E[\\alpha(E_b - E_t) - \\beta(C_b - C_t) + \\gamma(M_b - M_t)]\n$$\n$$\n\\mu_D = \\alpha(E[E_b] - E[E_t]) - \\beta(E[C_b] - E[C_t]) + \\gamma(E[M_b] - E[M_t])\n$$\n代入给定的均值：\n$$\n\\mu_D = \\alpha(\\mu_{E_b} - \\mu_{E_t}) - \\beta(\\mu_{C_b} - \\mu_{C_t}) + \\gamma(\\mu_{M_b} - \\mu_{M_t})\n$$\n$D$ 的方差可以通过独立随机变量线性组合的方差性质求得。对于独立变量 $X$ 和 $Y$ 以及常数 $a$ 和 $b$，$\\text{Var}(aX+bY) = a^2\\text{Var}(X) + b^2\\text{Var}(Y)$。\n$$\n\\sigma_D^2 = \\text{Var}(D) = \\text{Var}(\\alpha E_b - \\alpha E_t - \\beta C_b + \\beta C_t + \\gamma M_b - \\gamma M_t)\n$$\n由于独立性，和的方差等于方差的和：\n$$\n\\sigma_D^2 = \\alpha^2 \\text{Var}(E_b) + (-\\alpha)^2 \\text{Var}(E_t) + (-\\beta)^2 \\text{Var}(C_b) + \\beta^2 \\text{Var}(C_t) + \\gamma^2 \\text{Var}(M_b) + (-\\gamma)^2 \\text{Var}(M_t)\n$$\n$$\n\\sigma_D^2 = \\alpha^2(\\sigma_{E_b}^2 + \\sigma_{E_t}^2) + \\beta^2(\\sigma_{C_b}^2 + \\sigma_{C_t}^2) + \\gamma^2(\\sigma_{M_b}^2 + \\sigma_{M_t}^2)\n$$\n现在，我们代入给定的数值：\n参数：$\\alpha = 10$，$\\beta = 0.05$，$\\gamma = 8$。\n均值：$\\mu_{E_b} = 0.72$，$\\mu_{E_t} = 0.56$，$\\mu_{C_b} = 22$，$\\mu_{C_t} = 7$，$\\mu_{M_b} = 0.41$，$\\mu_{M_t} = 0.80$。\n标准差：$\\sigma_{E_b} = 0.15$，$\\sigma_{E_t} = 0.20$，$\\sigma_{C_b} = 10$，$\\sigma_{C_t} = 3$，$\\sigma_{M_b} = 0.25$，$\\sigma_{M_t} = 0.15$。\n方差：$\\sigma_{E_b}^2 = 0.15^2 = 0.0225$，$\\sigma_{E_t}^2 = 0.20^2 = 0.04$，$\\sigma_{C_b}^2 = 10^2 = 100$，$\\sigma_{C_t}^2 = 3^2 = 9$，$\\sigma_{M_b}^2 = 0.25^2 = 0.0625$，$\\sigma_{M_t}^2 = 0.15^2 = 0.0225$。\n\n计算均值 $\\mu_D$：\n$$\n\\mu_D = 10(0.72 - 0.56) - 0.05(22 - 7) + 8(0.41 - 0.80)\n$$\n$$\n\\mu_D = 10(0.16) - 0.05(15) + 8(-0.39)\n$$\n$$\n\\mu_D = 1.6 - 0.75 - 3.12 = -2.27\n$$\n计算方差 $\\sigma_D^2$：\n$$\n\\sigma_D^2 = 10^2(0.15^2 + 0.20^2) + 0.05^2(10^2 + 3^2) + 8^2(0.25^2 + 0.15^2)\n$$\n$$\n\\sigma_D^2 = 100(0.0225 + 0.04) + 0.0025(100 + 9) + 64(0.0625 + 0.0225)\n$$\n$$\n\\sigma_D^2 = 100(0.0625) + 0.0025(109) + 64(0.085)\n$$\n$$\n\\sigma_D^2 = 6.25 + 0.2725 + 5.44 = 11.9625\n$$\n因此，决策变量的分布为 $D \\sim \\mathcal{N}(-2.27, 11.9625)$。标准差为 $\\sigma_D = \\sqrt{11.9625}$。\n\n患者选择生物医学护理的概率是 $P(D>0)$。我们通过定义一个标准正态变量 $Z = \\frac{D - \\mu_D}{\\sigma_D} \\sim \\mathcal{N}(0, 1)$ 来对这个概率进行标准化。\n不等式 $D > 0$ 等价于 $D - \\mu_D > -\\mu_D$，并进一步等价于 $\\frac{D - \\mu_D}{\\sigma_D} > \\frac{-\\mu_D}{\\sigma_D}$。\n因此，我们需要计算 $P(Z > -\\frac{\\mu_D}{\\sigma_D})$。\n设 $\\Phi(z)$ 为标准正态分布的累积分布函数（CDF），即 $\\Phi(z) = P(Z \\le z)$。那么 $P(Z>z) = 1 - \\Phi(z)$。\nCDF 的参数是：\n$$\n-\\frac{\\mu_D}{\\sigma_D} = -\\frac{-2.27}{\\sqrt{11.9625}} \\approx \\frac{2.27}{3.45868} \\approx 0.65633\n$$\n所以概率为：\n$$\nP(D>0) = P(Z > 0.65633) = 1 - P(Z \\le 0.65633) = 1 - \\Phi(0.65633)\n$$\n使用标准正态分布表或计算器，$\\Phi(0.65633) \\approx 0.744167$。\n$$\nP(D>0) \\approx 1 - 0.744167 = 0.255833\n$$\n将最终结果四舍五入到四位有效数字，我们得到 $0.2558$。", "answer": "$$\\boxed{0.2558}$$", "id": "4971360"}, {"introduction": "诸如污名之类的文化因素会对人口健康产生真实且可衡量的影响，特别是在慢性病管理中。本练习将引导你使用一个关键的流行病学概念——人群归因分数（$PAF$），来量化由污名化所导致的治疗依从性不佳的额外健康负担。通过计算，你将理解污名化的流行程度如何影响其在不同文化背景下的总体公共卫生后果。[@problem_id:4971534]", "problem": "一位研究人员正在评估对人类免疫缺陷病毒（HIV）的污名化态度的文化流行程度如何影响抗逆转录病毒疗法的依从性。在两种文化背景中，假设污名对不依从性的因果效应是不变的，依从性的测量是一致的，并且在基础研究中已充分控制了混杂因素。\n\n给你以下经过实证支持的量：\n- 比较经历HIV相关污名的个体与未经历污名的个体，其不依从性的比值比（OR）为 $\\text{OR} = 1.8$。\n- 在未经历污名的个体中，不依从性的基线概率为 $p_{0} = 0.28$。\n\n考虑两种在HIV感染者中污名化态度流行程度不同的文化情景：\n- 情景H（高污名文化）：暴露流行率为 $p_{e,H} = 0.65$。\n- 情景L（较低污名文化）：暴露流行率为 $p_{e,L} = 0.30$。\n\n从比数、比值比和人群归因分数（PAF）的基本定义出发，按以下步骤进行：\n1. 使用比数和比值比的定义，用 $\\text{OR}$ 和 $p_{0}$ 来表示暴露组的不依从性风险 $p_{1}$。\n2. 使用 $p_{1}$ 和 $p_{0}$，求出有污名与无污名相比的不依从性相对风险 $\\text{RR}$。\n3. 根据定义 $PAF = \\dfrac{\\text{实际人群中的风险} - \\text{如果消除暴露后的风险}}{\\text{实际人群中的风险}}$，推导在暴露流行率为 $p_{e}$ 的人群中人群归因分数（PAF）的表达式，假设消除暴露会使暴露组的风险等于非暴露组的风险。\n4. 计算情景H的 $PAF_{H}$ 和情景L的 $PAF_{L}$。\n5. 以小数形式报告单个标量 $\\Delta = PAF_{H} - PAF_{L}$。\n\n将您的最终答案 $\\Delta$ 四舍五入到四位有效数字。不需要单位，并以小数形式表示结果（不要使用百分号）。", "solution": "该问题首先需要进行科学和逻辑一致性的验证。\n\n### 第1步：提取已知条件\n问题提供了以下量和条件：\n- 不依从性的比值比（污名 vs. 无污名）：$\\text{OR} = 1.8$。\n- 不依从性的基线概率（非暴露组风险）：$p_{0} = 0.28$。\n- 情景H（高污名文化）中的暴露（污名）流行率：$p_{e,H} = 0.65$。\n- 情景L（较低污名文化）中的暴露（污名）流行率：$p_{e,L} = 0.30$。\n- 假设：污名的因果效应是不变的，测量是一致的，并且混杂因素已得到控制。\n- 人群归因分数（PAF）的定义：$\\text{PAF} = \\dfrac{\\text{实际人群中的风险} - \\text{如果消除暴露后的风险}}{\\text{实际人群中的风险}}$。\n\n### 第2步：使用提取的已知条件进行验证\n根据验证标准对问题进行评估：\n- **科学依据**：该问题使用了流行病学和生物统计学中标准的、明确定义的度量（比值比、相对风险、人群归因分数），并基于一个现实的公共卫生情景。所提供的数值是合理的。\n- **适定性**：该问题是适定的。它提供了所有必要的数据和定义，可以通过一系列逻辑计算得出一个唯一的解。所述的假设（不变性、一致的测量、无混杂）对于确保问题是自足且可解的是至关重要的。\n- **客观性**：语言精确且无偏见。它根据所提供的数据提出了一个定量问题。\n\n问题陈述没有科学上的不健全、信息缺失或歧义。这是一个应用流行病学原理的标准练习。\n\n### 结论\n问题是有效的。可以构建一个分步解答。\n\n### 解题推导\n\n解题过程遵循问题陈述中概述的五个步骤。\n\n#### 1. 用 $\\text{OR}$ 和 $p_{0}$ 表示暴露组风险 $p_{1}$。\n概率为 $p$ 的事件的比数定义为 $\\text{odds} = \\frac{p}{1-p}$。\n非暴露组（无污名）的不依从性比数为 $\\text{odds}_{0} = \\frac{p_{0}}{1-p_{0}}$。\n暴露组（有污名）的不依从性比数为 $\\text{odds}_{1} = \\frac{p_{1}}{1-p_{1}}$。\n比值比（$\\text{OR}$）是这些比数的比率：\n$$ \\text{OR} = \\frac{\\text{odds}_{1}}{\\text{odds}_{0}} $$\n根据这个定义，我们可以将 $\\text{odds}_{1}$ 表示为：\n$$ \\text{odds}_{1} = \\text{OR} \\times \\text{odds}_{0} = \\text{OR} \\times \\frac{p_{0}}{1-p_{0}} $$\n现在，我们从 $\\text{odds}_{1}$ 的定义中求解 $p_{1}$：\n$$ \\frac{p_{1}}{1-p_{1}} = \\text{OR} \\times \\frac{p_{0}}{1-p_{0}} $$\n为简化起见，令 $K = \\text{OR} \\times \\frac{p_{0}}{1-p_{0}}$。则 $\\frac{p_{1}}{1-p_{1}} = K$。\n求解 $p_{1}$：\n$p_{1} = K(1-p_{1}) = K - Kp_{1}$\n$p_{1} + Kp_{1} = K$\n$p_{1}(1+K) = K$\n$p_{1} = \\frac{K}{1+K}$\n将 $K$ 的表达式代回，得到 $p_{1}$ 的所需表达式：\n$$ p_{1} = \\frac{\\text{OR} \\frac{p_{0}}{1-p_{0}}}{1 + \\text{OR} \\frac{p_{0}}{1-p_{0}}} $$\n\n#### 2. 求相对风险 $\\text{RR}$。\n首先，我们使用给定的数据 $\\text{OR} = 1.8$ 和 $p_{0} = 0.28$ 计算 $p_{1}$ 的数值。\n非暴露组的比数为：\n$$ \\text{odds}_{0} = \\frac{0.28}{1 - 0.28} = \\frac{0.28}{0.72} = \\frac{28}{72} = \\frac{7}{18} $$\n暴露组的比数为：\n$$ \\text{odds}_{1} = \\text{OR} \\times \\text{odds}_{0} = 1.8 \\times \\frac{7}{18} = \\frac{18}{10} \\times \\frac{7}{18} = \\frac{7}{10} = 0.7 $$\n现在，我们从 $\\text{odds}_{1}$ 求出 $p_{1}$：\n$$ p_{1} = \\frac{\\text{odds}_{1}}{1 + \\text{odds}_{1}} = \\frac{0.7}{1 + 0.7} = \\frac{0.7}{1.7} = \\frac{7}{17} $$\n相对风险（$\\text{RR}$）是暴露组风险与非暴露组风险的比率：\n$$ \\text{RR} = \\frac{p_{1}}{p_{0}} = \\frac{7/17}{0.28} = \\frac{7/17}{28/100} = \\frac{7}{17} \\times \\frac{100}{28} = \\frac{1}{17} \\times \\frac{100}{4} = \\frac{25}{17} $$\n\n#### 3. 推导人群归因分数（PAF）的表达式。\n问题将PAF定义为：\n$$ \\text{PAF} = \\frac{\\text{实际人群中的风险} - \\text{如果消除暴露后的风险}}{\\text{实际人群中的风险}} $$\n在暴露流行率为 $p_{e}$ 的实际人群中，风险是结果的总概率。这是暴露组（$p_{1}$）和非暴露组（$p_{0}$）分层风险的加权平均值：\n$$ \\text{risk}_{\\text{total}} = p_{1} p_{e} + p_{0}(1 - p_{e}) $$\n如果消除暴露后的风险是整个人群如果都未暴露时会有的风险水平，即 $p_0$。\n$$ \\text{risk}_{\\text{counterfactual}} = p_{0} $$\n将这些代入PAF的定义中：\n$$ \\text{PAF} = \\frac{(p_{1} p_{e} + p_{0}(1 - p_{e})) - p_{0}}{p_{1} p_{e} + p_{0}(1 - p_{e})} $$\n简化分子：\n$$ (p_{1} p_{e} + p_{0} - p_{0} p_{e}) - p_{0} = p_{1} p_{e} - p_{0} p_{e} = p_{e}(p_{1} - p_{0}) $$\n所以，PAF的表达式为：\n$$ \\text{PAF} = \\frac{p_{e}(p_{1} - p_{0})}{p_{1} p_{e} + p_{0}(1 - p_{e})} $$\n一个更常见的形式，称为Levin公式，是通过将分子和分母同除以 $p_{0}$ 并使用 $\\text{RR} = p_1/p_0$ 推导出来的：\n$$ \\text{PAF} = \\frac{p_{e}(\\frac{p_{1}}{p_{0}} - 1)}{\\frac{p_{1}}{p_{0}} p_{e} + (1 - p_{e})} = \\frac{p_{e}(\\text{RR} - 1)}{\\text{RR} p_{e} + 1 - p_{e}} = \\frac{p_{e}(\\text{RR} - 1)}{1 + p_{e}(\\text{RR} - 1)} $$\n\n#### 4. 计算 $PAF_{H}$ 和 $PAF_{L}$。\n我们使用推导出的PAF公式，其中 $\\text{RR} = \\frac{25}{17}$。$\\text{RR} - 1$ 项为：\n$$ \\text{RR} - 1 = \\frac{25}{17} - 1 = \\frac{25-17}{17} = \\frac{8}{17} $$\n对于情景H（高污名），$p_{e,H} = 0.65$：\n$$ \\text{PAF}_{H} = \\frac{p_{e,H}(\\text{RR} - 1)}{1 + p_{e,H}(\\text{RR} - 1)} = \\frac{0.65 \\times \\frac{8}{17}}{1 + 0.65 \\times \\frac{8}{17}} = \\frac{\\frac{13}{20} \\times \\frac{8}{17}}{1 + \\frac{13}{20} \\times \\frac{8}{17}} = \\frac{\\frac{26}{85}}{1 + \\frac{26}{85}} = \\frac{26/85}{111/85} = \\frac{26}{111} $$\n对于情景L（较低污名），$p_{e,L} = 0.30$：\n$$ \\text{PAF}_{L} = \\frac{p_{e,L}(\\text{RR} - 1)}{1 + p_{e,L}(\\text{RR} - 1)} = \\frac{0.30 \\times \\frac{8}{17}}{1 + 0.30 \\times \\frac{8}{17}} = \\frac{\\frac{3}{10} \\times \\frac{8}{17}}{1 + \\frac{3}{10} \\times \\frac{8}{17}} = \\frac{\\frac{12}{85}}{1 + \\frac{12}{85}} = \\frac{12/85}{97/85} = \\frac{12}{97} $$\n\n#### 5. 报告标量 $\\Delta = PAF_{H} - PAF_{L}$。\n我们计算两个PAF值之间的差。\n$$ \\Delta = \\text{PAF}_{H} - \\text{PAF}_{L} = \\frac{26}{111} - \\frac{12}{97} $$\n为了求出数值，我们使用小数近似值：\n$$ \\text{PAF}_{H} \\approx 0.23423423... $$\n$$ \\text{PAF}_{L} \\approx 0.12371134... $$\n$$ \\Delta \\approx 0.23423423 - 0.12371134 = 0.11052289... $$\n将结果四舍五入到四位有效数字，得到：\n$$ \\Delta \\approx 0.1105 $$", "answer": "$$\\boxed{0.1105}$$", "id": "4971534"}, {"introduction": "个人在医疗系统中的求医过程往往是一个受文化、成本和经验共同影响的决策序列。本练习将介绍马尔可夫链，这是一个用以分析此类序列数据的强大模型。通过对求医路径的分析，你将学会如何从真实数据中估计在不同类型医疗（例如从传统疗法转向生物医学）之间转换的概率，并对不同文化区域的行为模式进行比较。[@problem_id:4971537]", "problem": "一个开发者获得了两个地区就医事件序列。每个序列记录了个人在单次患病期间使用的有序就医模式。状态空间是离散的，由三个确切的状态组成：传统医疗 (TR)、生物医疗 (BM) 和家庭/自我护理 (HS)。假设在一次患病期间，这些状态之间的转换生成过程是一阶马尔可夫链。开发者必须估计转移矩阵并计算比较统计数据，以捕捉两个地区在从传统医疗 (TR) 转换到生物医疗 (BM) 的概率上的差异，分析需基于马尔可夫链原理和带拉普拉斯平滑的最大似然估计。\n\n建模任务的定义和假设：\n- 状态空间为 $S = \\{\\text{TR}, \\text{BM}, \\text{HS}\\}$。\n- 一阶马尔可夫链具有以下性质：对于状态 $X_t \\in S$，对所有 $i,j \\in S$ 都有 $P(X_{t+1} = j \\mid X_t = i, X_{t-1}, \\dots) = P(X_{t+1} = j \\mid X_t = i)$。\n- 转移矩阵为 $P \\in \\mathbb{R}^{3 \\times 3}$，其中每个元素 $P_{ij}$ 等于 $P(X_{t+1} = j \\mid X_t = i)$。\n- 通过计算序列中从状态 $i$ 到状态 $j$ 的观测到的连续状态对的转换次数 $n_{ij}$ 来估计转换。使用参数为 $\\alpha > 0$ 的拉普拉斯平滑，使得对于每一行 $i$：\n$$\n\\hat{P}_{ij} = \\frac{n_{ij} + \\alpha}{\\sum_{k \\in S} (n_{ik} + \\alpha)}.\n$$\n- 主要关注的量是在一步之内从传统医疗转换到生物医疗的概率，即 $p_{\\text{TR}\\to\\text{BM}} = \\hat{P}_{\\text{TR},\\text{BM}}$。\n- 为量化转换中的区域差异，计算区域 $A$ 和区域 $B$ 之间的对数优势比（log-odds ratio）：\n$$\n\\text{LOR} = \\log\\left(\\frac{\\frac{p_A}{1 - p_A}}{\\frac{p_B}{1 - p_B}}\\right),\n$$\n其中 $p_A$ 和 $p_B$ 分别表示区域 $A$ 和区域 $B$ 的 $\\hat{P}_{\\text{TR},\\text{BM}}$ 值。\n- 为了捕捉传统医疗之后护理流程的更广泛差异，计算从区域 $A$ 的TR行分布到区域 $B$ 的TR行分布的Kullback–Leibler散度 (KLD)：\n$$\nD_{\\text{KL}}\\big(\\hat{P}_A(\\text{TR}, \\cdot) \\,\\|\\, \\hat{P}_B(\\text{TR}, \\cdot)\\big) = \\sum_{j \\in S} \\hat{P}_{A,\\text{TR},j} \\log\\left(\\frac{\\hat{P}_{A,\\text{TR},j}}{\\hat{P}_{B,\\text{TR},j}}\\right).\n$$\n- 定义一个转换中文化显著差异的二元指标为 $|\\;p_A - p_B\\;| > \\delta$，其中 $\\delta$ 是开发者指定的阈值。\n\n所有概率和散度必须以小数表示。不允许使用百分号。\n\n您的程序必须实现以上内容，并为以下测试套件生成结果。每个测试用例包括区域 $A$ 和区域 $B$ 的序列、一个拉普拉斯平滑参数 $\\alpha$ 和一个用于二元指标的阈值 $\\delta$。\n\n测试套件：\n- 测试用例 $1$ (一般情况)：\n    - 区域 $A$ 序列：\n        - $\\left[\\text{TR}, \\text{BM}, \\text{BM}, \\text{HS}, \\text{BM}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{BM}, \\text{HS}\\right]$\n        - $\\left[\\text{BM}, \\text{HS}, \\text{TR}, \\text{BM}, \\text{BM}\\right]$\n        - $\\left[\\text{TR}, \\text{HS}, \\text{TR}, \\text{BM}\\right]$\n    - 区域 $B$ 序列：\n        - $\\left[\\text{TR}, \\text{HS}, \\text{HS}, \\text{TR}, \\text{HS}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{HS}, \\text{HS}\\right]$\n        - $\\left[\\text{TR}, \\text{HS}, \\text{TR}, \\text{HS}\\right]$\n        - $\\left[\\text{HS}, \\text{HS}, \\text{TR}, \\text{HS}\\right]$\n    - $\\alpha = 0.5$, $\\delta = 0.1$。\n- 测试用例 $2$ (边缘情况：在一个区域中观测到零次 $\\text{TR}\\to\\text{BM}$ 转换，通过平滑处理)：\n    - 区域 $A$ 序列：\n        - $\\left[\\text{TR}, \\text{HS}, \\text{HS}, \\text{TR}, \\text{HS}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{HS}, \\text{HS}\\right]$\n        - $\\left[\\text{TR}, \\text{HS}, \\text{TR}, \\text{HS}\\right]$\n    - 区域 $B$ 序列：\n        - $\\left[\\text{TR}, \\text{BM}, \\text{HS}, \\text{TR}, \\text{BM}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{BM}, \\text{HS}, \\text{BM}\\right]$\n        - $\\left[\\text{BM}, \\text{TR}, \\text{BM}, \\text{BM}\\right]$\n    - $\\alpha = 0.2$, $\\delta = 0.2$。\n- 测试用例 $3$ (平衡情况：具有可比的转换模式)：\n    - 区域 $A$ 序列：\n        - $\\left[\\text{TR}, \\text{BM}, \\text{HS}, \\text{TR}, \\text{BM}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{HS}, \\text{BM}, \\text{HS}\\right]$\n        - $\\left[\\text{BM}, \\text{HS}, \\text{TR}, \\text{BM}, \\text{HS}\\right]$\n    - 区域 $B$ 序列：\n        - $\\left[\\text{TR}, \\text{BM}, \\text{HS}, \\text{TR}, \\text{BM}\\right]$\n        - $\\left[\\text{HS}, \\text{TR}, \\text{BM}, \\text{HS}, \\text{TR}\\right]$\n        - $\\left[\\text{BM}, \\text{HS}, \\text{TR}, \\text{HS}, \\text{BM}\\right]$\n    - $\\alpha = 0.5$, $\\delta = 0.05$。\n\n对于每个测试用例，计算并返回列表 $[p_A, p_B, \\text{LOR}, D_{\\text{KL}}, \\text{significant}]$，其中 $p_A$ 和 $p_B$ 分别是区域 $A$ 和区域 $B$ 的 $\\hat{P}_{\\text{TR},\\text{BM}}$ 值，$\\text{LOR}$ 是对数优势比，$D_{\\text{KL}}$ 是从区域 $A$ 到区域 $B$ 的传统医疗行的Kullback–Leibler散度，而 $\\text{significant}$ 是使用阈值 $\\delta$ 计算出的布尔值。将所有浮点输出四舍五入到 $6$ 位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，列表中的每个元素本身是对应一个测试用例的列表，例如 $[[r_1],[r_2],[r_3]]$，不含任何额外文本。", "solution": "该问题要求对两个地区的就医行为进行统计比较，这些行为被建模为一阶马尔可夫链。解决方案涉及从序列数据中估计转移概率，应用拉普拉斯平滑，然后计算几个比较指标。该过程基于马尔可夫链的最大似然估计 (MLE) 和信息论的原理。\n\n首先，我们将问题形式化。就医模式的状态空间由 $S = \\{\\text{TR}, \\text{BM}, \\text{HS}\\}$ 给出。为方便计算，我们将这些状态映射到整数索引：$\\text{TR} \\to 0$, $\\text{BM} \\to 1$, $\\text{HS} \\to 2$。该过程被假设为一阶马尔可夫链，意味着转移到下一个状态的概率仅取决于当前状态。转移概率被编码在一个 $3 \\times 3$ 的矩阵 $P$ 中，其中 $P_{ij} = P(X_{t+1}=j \\mid X_t=i)$。\n\n任务的核心是从提供的事件序列中估计每个区域的转移矩阵。对此的标准方法是最大似然估计。$P_{ij}$ 的最大似然估计值 (MLE) 就是从状态 $i$ 到状态 $j$ 的观测转换次数（记为 $n_{ij}$）与从状态 $i$ 出发的所有观测转换总次数（$\\sum_{k \\in S} n_{ik}$）的比率。\n$$\nP_{ij}^{\\text{MLE}} = \\frac{n_{ij}}{\\sum_{k \\in S} n_{ik}}\n$$\n然而，当数据中未观测到某些转换时（即 $n_{ij} = 0$），这种估计可能会产生问题，导致零概率。在计算涉及对数和除法的对数优势比或Kullback-Leibler散度时，这尤其成为一个问题。\n\n为了解决这个问题，题目指定使用拉普拉斯平滑（或加一平滑，推广到任意伪计数 $\\alpha > 0$）。该技术为每个转换计数添加一个小的正常数 $\\alpha$。平滑后的概率估计值 $\\hat{P}_{ij}$ 由下式给出：\n$$\n\\hat{P}_{ij} = \\frac{n_{ij} + \\alpha}{\\sum_{k \\in S} (n_{ik} + \\alpha)} = \\frac{n_{ij} + \\alpha}{\\left(\\sum_{k \\in S} n_{ik}\\right) + |S|\\alpha}\n$$\n其中 $|S|$ 是状态空间的大小，本例中为 $3$。这确保了所有估计的转移概率都是正数。\n\n每个测试用例的算法流程如下：\n\n1.  **计数转换**：对于每个区域（$A$ 和 $B$），我们遍历所有提供的序列。对于序列中的每一对连续状态 $(X_t, X_{t+1})$，我们在一个 $3 \\times 3$ 的计数矩阵中增加计数 $n_{ij}$，其中 $i$ 是 $X_t$ 的索引，$j$ 是 $X_{t+1}$ 的索引。\n\n2.  **估计转移概率**：使用区域 $A$ ($N_A$) 和区域 $B$ ($N_B$) 的计数矩阵以及给定的平滑参数 $\\alpha$，我们计算平滑后的转移概率矩阵 $\\hat{P}_A$ 和 $\\hat{P}_B$。对于计数矩阵 $N$ 中的每一行 $i$，$\\hat{P}$ 中相应的概率行计算如下：\n    - 首先，创建一个平滑计数矩阵 $N'_{ij} = N_{ij} + \\alpha$。\n    - 然后，对每一行 $i$，计算行和 $R_i = \\sum_{j \\in S} N'_{ij}$。\n    - 最后，概率为 $\\hat{P}_{ij} = N'_{ij} / R_i$。\n\n3.  **提取主要概率**：我们关注的量是从传统医疗转换到生物医疗的概率 $p_{\\text{TR}\\to\\text{BM}} = \\hat{P}_{\\text{TR},\\text{BM}}$。我们为两个区域提取这些值：$p_A = \\hat{P}_{A,01}$ 和 $p_B = \\hat{P}_{B,01}$。\n\n4.  **计算比较统计量**：\n    *   **对数优势比 (LOR)**：这衡量了在区域 $A$ 与区域 $B$ 中发生 TR$\\to$BM 转换的相对优势。对于概率为 $p$ 的区域，其优势为 $p/(1-p)$。LOR 为：\n        $$\n        \\text{LOR} = \\log\\left(\\frac{p_A / (1 - p_A)}{p_B / (1 - p_B)}\\right)\n        $$\n        正的 LOR 表示区域 $A$ 的优势更高，负的 LOR 表示区域 $B$ 的优势更高，而 LOR 为 $0$ 表示优势相等。\n    *   **Kullback–Leibler散度 (KLD)**：这衡量了当一个人将信念从区域 $B$ 的概率分布修正为区域 $A$ 的概率分布时获得的信息增益，特别是针对源自“传统”状态的转换。它量化了 $\\hat{P}_A$ 的TR行与 $\\hat{P}_B$ 的TR行之间的差异程度。设 $\\hat{P}_{A,\\text{TR}}$ 和 $\\hat{P}_{B,\\text{TR}}$ 分别是各自矩阵中TR行的概率向量。KLD 为：\n        $$\n        D_{\\text{KL}}\\big(\\hat{P}_{A,\\text{TR}} \\,\\|\\, \\hat{P}_{B,\\text{TR}}\\big) = \\sum_{j \\in S} \\hat{P}_{A,\\text{TR},j} \\log\\left(\\frac{\\hat{P}_{A,\\text{TR},j}}{\\hat{P}_{B,\\text{TR},j}}\\right)\n        $$\n        KLD 总是非负的，且当且仅当两个分布相同时为零。我们利用 `scipy.stats.entropy` 进行稳健的计算。\n\n5.  **确定显著性**：基于一个简单的阈值 $\\delta$ 计算文化显著差异的二元指标。如果主要概率的绝对差超过 $\\delta$，则认为差异是显著的：\n    $$\n    \\text{significant} = |\\;p_A - p_B\\;| > \\delta\n    $$\n    这将是一个布尔值（`True` 或 `False`）。\n\n6.  **格式化输出**：为每个测试用例收集五个计算值 $[p_A, p_B, \\text{LOR}, D_{\\text{KL}}, \\text{significant}]$。所有浮点数都四舍五入到 $6$ 位小数。最终输出是这些结果的聚合列表，按指定格式进行格式化。\n\n这种综合方法使用既定的、适用于分析离散序列数据的统计和信息论方法，对就医动态进行了多方面的比较。", "answer": "```python\nimport numpy as np\nfrom scipy.stats import entropy\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    \n    test_cases = [\n        {\n            \"seq_A\": [\n                ['TR', 'BM', 'BM', 'HS', 'BM'],\n                ['HS', 'TR', 'BM', 'HS'],\n                ['BM', 'HS', 'TR', 'BM', 'BM'],\n                ['TR', 'HS', 'TR', 'BM']\n            ],\n            \"seq_B\": [\n                ['TR', 'HS', 'HS', 'TR', 'HS'],\n                ['HS', 'TR', 'HS', 'HS'],\n                ['TR', 'HS', 'TR', 'HS'],\n                ['HS', 'HS', 'TR', 'HS']\n            ],\n            \"alpha\": 0.5,\n            \"delta\": 0.1\n        },\n        {\n            \"seq_A\": [\n                ['TR', 'HS', 'HS', 'TR', 'HS'],\n                ['HS', 'TR', 'HS', 'HS'],\n                ['TR', 'HS', 'TR', 'HS']\n            ],\n            \"seq_B\": [\n                ['TR', 'BM', 'HS', 'TR', 'BM'],\n                ['HS', 'TR', 'BM', 'HS', 'BM'],\n                ['BM', 'TR', 'BM', 'BM']\n            ],\n            \"alpha\": 0.2,\n            \"delta\": 0.2\n        },\n        {\n            \"seq_A\": [\n                ['TR', 'BM', 'HS', 'TR', 'BM'],\n                ['HS', 'TR', 'HS', 'BM', 'HS'],\n                ['BM', 'HS', 'TR', 'BM', 'HS']\n            ],\n            \"seq_B\": [\n                ['TR', 'BM', 'HS', 'TR', 'BM'],\n                ['HS', 'TR', 'BM', 'HS', 'TR'],\n                ['BM', 'HS', 'TR', 'HS', 'BM']\n            ],\n            \"alpha\": 0.5,\n            \"delta\": 0.05\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = process_case(case[\"seq_A\"], case[\"seq_B\"], case[\"alpha\"], case[\"delta\"])\n        results.append(result)\n\n    # Custom string formatting to match output requirements (no spaces)\n    def format_list(lst):\n        # Format elements: round floats, bools as is\n        formatted_elements = []\n        for item in lst:\n            if isinstance(item, float):\n                formatted_elements.append(f\"{item:.6f}\")\n            else:\n                formatted_elements.append(str(item))\n        return '[' + ','.join(formatted_elements) + ']'\n    \n    # Python's bool `True` and `False` are standard and accepted.\n    final_output_str = '[' + ','.join(format_list(r) for r in results) + ']'\n    print(final_output_str)\n\ndef process_case(seq_A, seq_B, alpha, delta):\n    \"\"\"\n    Processes a single test case: counts transitions, computes probabilities,\n    and calculates comparative statistics.\n    \"\"\"\n    state_map = {'TR': 0, 'BM': 1, 'HS': 2}\n    num_states = len(state_map)\n    tr_index = state_map['TR']\n    bm_index = state_map['BM']\n\n    def count_transitions(sequences):\n        counts = np.zeros((num_states, num_states), dtype=np.float64)\n        for seq in sequences:\n            for i in range(len(seq) - 1):\n                from_state_idx = state_map[seq[i]]\n                to_state_idx = state_map[seq[i+1]]\n                counts[from_state_idx, to_state_idx] += 1\n        return counts\n\n    def get_probs(counts, alpha):\n        smoothed_counts = counts + alpha\n        row_sums = smoothed_counts.sum(axis=1, keepdims=True)\n        # If a row in counts was all zeros, row_sum will be num_states * alpha, avoiding division by zero.\n        with np.errstate(divide='ignore', invalid='ignore'):\n            probs = np.divide(smoothed_counts, row_sums, out=np.zeros_like(smoothed_counts), where=row_sums!=0)\n        \n        # For any rows that had no transitions, the probability should be uniform due to smoothing.\n        zero_transition_rows = np.where(counts.sum(axis=1) == 0)[0]\n        if len(zero_transition_rows) > 0:\n            probs[zero_transition_rows, :] = 1.0 / num_states\n            \n        return probs\n\n    # Process Region A\n    counts_A = count_transitions(seq_A)\n    probs_A = get_probs(counts_A, alpha)\n    p_A = probs_A[tr_index, bm_index]\n\n    # Process Region B\n    counts_B = count_transitions(seq_B)\n    probs_B = get_probs(counts_B, alpha)\n    p_B = probs_B[tr_index, bm_index]\n\n    # Calculate LOR\n    # Laplace smoothing with alpha > 0 ensures p_A and p_B are in (0, 1)\n    odds_A = p_A / (1 - p_A)\n    odds_B = p_B / (1 - p_B)\n    lor = np.log(odds_A / odds_B)\n\n    # Calculate KLD\n    tr_row_A = probs_A[tr_index, :]\n    tr_row_B = probs_B[tr_index, :]\n    # scipy.stats.entropy computes KLD if qk is provided\n    # The distributions are guaranteed to be valid (sum to 1, non-negative)\n    # Smoothing ensures no zero probabilities in the 'qk' distribution\n    kld = entropy(pk=tr_row_A, qk=tr_row_B)\n\n    # Determine significance\n    significant = abs(p_A - p_B) > delta\n\n    return [p_A, p_B, lor, kld, significant]\n\nsolve()\n```", "id": "4971537"}]}