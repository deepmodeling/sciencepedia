{"hands_on_practices": [{"introduction": "要掌握质量调整生命年（QALY）的概念，最好的方法就是从其最基本的计算开始。这个练习将带您计算一个在不同健康状态下度过一段时间的患者所累积的QALY。通过这个过程，您将直观地理解QALY作为“效用-时间”曲线下面积的本质，这是所有更复杂分析的基础。[@problem_id:5053286]", "problem": "在一项关于新型心力衰竭疗法的转化医学研究中，单个患者在固定随访期内的健康相关生命质量轨迹由瞬时效用函数 $u(t)$ 建模，其中 $t$ 是以年为单位的时间，$u(t) \\in [0,1]$ 反映了在时间 $t$ 的健康状态值。根据定义，在时间区间 $[0,T]$ 内累积的总质量调整生命年 (QALYs) 是瞬时效用函数的时间积分，即 $u(t)$ 在 $[0,T]$ 上关于时间的积分。在为期 $T$ 年的随访期内，患者经历了两个临床稳定阶段：从基线到时间 $t_1$ 的较高效应阶段，以及此后的较低效应阶段（由于一次非致命性不良事件）。假设 $u(t)$ 是分段常数函数，当 $t \\in [0,t_1]$ 时，$u(t)=u_1$；当 $t \\in (t_1,T]$ 时，$u(t)=u_2$。取 $u_1=0.82$，$u_2=0.68$，$t_1=9$ 个月，以及 $T=2$ 年。从总 QALYs 在 $[0,T]$ 上的积分定义出发，推导该分段常数轨迹的总 QALYs 表达式，然后计算其数值。从曲线下面积的角度，结合时间加权的健康状态来解释结果。以 QALYs 为单位表示最终结果，并将您的数值答案四舍五入到四位有效数字。", "solution": "在尝试解答之前，对问题陈述进行验证。\n\n**第一步：提取已知条件**\n- 瞬时效用函数：$u(t)$，其中 $t$ 是以年为单位的时间，$u(t) \\in [0,1]$。\n- 在 $[0,T]$ 上的总质量调整生命年 (QALYs) 定义：$u(t)$ 从 $0$ 到 $T$ 的时间积分。\n- $u(t)$ 的模型：分段常数函数。\n- 第一阶段的效用：当 $t \\in [0,t_1]$ 时，$u(t)=u_1$。\n- 第二阶段的效用：当 $t \\in (t_1,T]$ 时，$u(t)=u_2$。\n- $u_1$ 的值：$0.82$。\n- $u_2$ 的值：$0.68$。\n- 转换时间：$t_1 = 9$ 个月。\n- 总时间跨度：$T=2$ 年。\n- 任务要求：推导总 QALYs 的表达式，计算其数值，解释结果，并将最终答案四舍五入到四位有效数字。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据**：该问题具有科学依据。将 QALYs 定义为随时间变化的效用函数的积分，是健康经济学和结果研究的基石，这些领域对转化医学至关重要。使用分段常数函数来模拟健康状态随时间的变化是一种标准且有效的简化方法。\n- **适定性**：该问题是适定的。它提供了清晰的定义、$u(t)$ 的特定函数形式以及计算唯一解所需的所有参数。\n- **客观性**：问题以精确、客观的语言陈述，没有主观性论断。\n- **完整性与一致性**：问题是自洽的。所有必需的数据（$u_1$、$u_2$、$t_1$、$T$）都已提供。没有矛盾之处。$t_1$（月）和 $T$（年）的单位不同，需要进行转换，这是解决物理和工程问题的标准步骤，并非不一致。\n- **现实性**：对于患有慢性病并经历不良事件的患者来说，该情景和数值是现实的。\n- **结构**：问题结构清晰，能够导出一个唯一的、有意义的解。\n\n**第三步：结论与行动**\n问题被判定为**有效**。将提供完整解答。\n\n**解题推导**\n\n总质量调整生命年 (QALYs)，记作 $Q$，定义为瞬时效用函数 $u(t)$ 在指定时间区间 $[0, T]$ 上的积分。\n$$ Q = \\int_{0}^{T} u(t) \\, dt $$\n效用函数 $u(t)$ 是一个分段常数函数：\n$$\nu(t) =\n\\begin{cases}\nu_1  \\text{对于 } 0 \\le t \\le t_1 \\\\\nu_2  \\text{对于 } t_1  t \\le T\n\\end{cases}\n$$\n其中 $u_1$ 和 $u_2$ 是常数。为了计算该积分，我们必须在不连续点 $t_1$ 处将其拆分：\n$$ Q = \\int_{0}^{t_1} u(t) \\, dt + \\int_{t_1}^{T} u(t) \\, dt $$\n将 $u(t)$ 的常数值代入各自的区间，得到：\n$$ Q = \\int_{0}^{t_1} u_1 \\, dt + \\int_{t_1}^{T} u_2 \\, dt $$\n由于 $u_1$ 和 $u_2$ 是相对于积分变量 $t$ 的常数，它们可以从积分中提出：\n$$ Q = u_1 \\int_{0}^{t_1} dt + u_2 \\int_{t_1}^{T} dt $$\n进行积分计算得出：\n$$ Q = u_1 [t]_{0}^{t_1} + u_2 [t]_{t_1}^{T} $$\n$$ Q = u_1 (t_1 - 0) + u_2 (T - t_1) $$\n这就得出了该分段常数轨迹的总 QALYs 的最终推导表达式：\n$$ Q = u_1 t_1 + u_2 (T - t_1) $$\n**解释**\n该表达式有一个清晰的几何解释，即效用函数 $u(t)$ 从 $t=0$ 到 $t=T$ 的曲线下面积。它是两个矩形面积之和：\n1.  第一个矩形的高度为 $u_1$，宽度为 $t_1$。其面积为 $u_1 t_1$，代表在第一个较高效应阶段累积的 QALYs。\n2.  第二个矩形的高度为 $u_2$，宽度为 $(T - t_1)$。其面积为 $u_2(T - t_1)$，代表在第二个较低效应阶段累积的 QALYs。\n因此，总 QALYs 是每种健康状态的效用值之和，每个效用值都按处于该状态的持续时间进行加权。这就是评估“时间加权的健康状态”的精髓所在。\n\n**数值计算**\n给定的参数值为：\n- $u_1 = 0.82$\n- $u_2 = 0.68$\n- $T = 2$ 年\n- $t_1 = 9$ 个月\n\n为保持一致性，所有时间变量必须使用相同单位。我们将 $t_1$ 从月转换为年。由于一年有 $12$ 个月：\n$$ t_1 = 9 \\, \\text{个月} \\times \\frac{1 \\, \\text{年}}{12 \\, \\text{个月}} = \\frac{9}{12} \\, \\text{年} = 0.75 \\, \\text{年} $$\n现在，我们将这些数值代入推导出的 $Q$ 表达式中：\n$$ Q = (0.82)(0.75) + (0.68)(2 - 0.75) $$\n首先，计算第二阶段的持续时间：\n$$ T - t_1 = 2 - 0.75 = 1.25 \\, \\text{年} $$\n将此结果代回 $Q$ 的方程中：\n$$ Q = (0.82)(0.75) + (0.68)(1.25) $$\n现在，我们计算乘积：\n$$ (0.82)(0.75) = 0.615 $$\n$$ (0.68)(1.25) = 0.85 $$\n最后，将两部分相加，求得总 QALYs：\n$$ Q = 0.615 + 0.85 = 1.465 $$\n问题要求将数值答案四舍五入到四位有效数字。计算出的值 $1.465$ 已经包含四位有效数字（$1$、$4$、$6$、$5$）。因此，无需进一步四舍五入。\n\n该患者在为期 $2$ 年的随访期内累积的总 QALYs 为 $1.465$。", "answer": "$$\n\\boxed{1.465}\n$$", "id": "5053286"}, {"introduction": "在真实世界的医疗决策中，我们常常需要在不同治疗方案之间进行权衡，这些方案在生存获益和生活质量上各有优劣。本练习将向您展示如何运用QALY来量化这种权衡，它引入了生存概率和时间贴现这两个关键概念。通过比较一种能延长生命但会暂时降低生活质量的新疗法与标准疗法，您将学会如何进行更全面的终生健康产出评估。[@problem_id:5053251]", "problem": "一种针对慢性、危及生命的疾病的新疗法可以降低死亡率，但在诱导期会暂时降低与健康相关的生活质量。假设每种策略下的死亡时间呈指数分布，风险恒定，并且健康流量以恒定的年利率连续贴现。与健康相关的生活质量（HRQoL）被建模为区间 $\\left[0,1\\right]$ 上的一个效用权重，该权重仅在存活时累积。\n\n在标准护理下：\n- 死亡风险为每年 $\\lambda_{0} = 0.15$。\n- 存活期间，效用恒定为 $u_{0} = 0.80$。\n\n在新疗法下：\n- 死亡风险为每年 $\\lambda_{1} = 0.12$（始终适用）。\n- 在最初的 $\\tau = 0.5$ 年（诱导期），存活期间的效用为 $u_{1} = 0.60$。\n- 在时间 $\\tau$ 之后，存活期间的效用恢复到 $u_{0} = 0.80$。\n\n对未来健康采用连续贴现，年贴现率为 $r = 0.03$。仅使用基本定义和经过充分检验的事实，计算采用新疗法与标准护理相比的净质量调整生命年（QALY）效应，并对所有未来健康流量进行一致的贴现。\n\n用QALY表示你的最终结果，并将答案四舍五入到四位有效数字。", "solution": "该问题被评估为有效。它在科学上基于健康经济学和生存分析的原理，问题提出得当，提供了所有必要的参数，并且其表述是客观的。该问题自成体系，内部一致，并需要基于标准数学方法进行可验证的计算。\n\n主要目标是计算新疗法与标准护理相比的净质量调整生命年（QALY）效应。这需要计算每种策略的预期总贴现QALY，然后求出其差值。\n\n预期总贴现QALY的通用公式由一生中贴现效用的积分给出，该积分按在每个时间点存活的概率加权。设 $S(t)$ 为生存函数（在时间 $t$ 存活的概率），$u(t)$ 为时间 $t$ 的健康效用函数，$r$ 为连续年贴现率。总QALY，$Q$，为：\n$$\nQ = \\int_{0}^{\\infty} S(t) u(t) e^{-rt} dt\n$$\n问题指出，两种策略的死亡时间均服从具有恒定风险率 $\\lambda$ 的指数分布。指数分布的生存函数为 $S(t) = e^{-\\lambda t}$。\n\n首先，我们计算标准护理策略的QALY，记为 $Q_0$。\n对于标准护理：\n- 死亡风险为每年 $\\lambda_0 = 0.15$。\n- 生存函数为 $S_0(t) = e^{-\\lambda_0 t} = e^{-0.15t}$。\n- 效用恒定，$u_0 = 0.80$。\n- 贴现率为每年 $r = 0.03$。\n\n将这些代入通用公式：\n$$\nQ_0 = \\int_{0}^{\\infty} (e^{-\\lambda_0 t}) (u_0) (e^{-rt}) dt\n$$\n$$\nQ_0 = u_0 \\int_{0}^{\\infty} e^{-(\\lambda_0 + r)t} dt\n$$\n该积分为标准指数积分：\n$$\n\\int_{0}^{\\infty} e^{-kt} dt = \\left[ -\\frac{1}{k} e^{-kt} \\right]_{0}^{\\infty} = 0 - \\left(-\\frac{1}{k}\\right) = \\frac{1}{k}\n$$\n将此结果应用于 $k = \\lambda_0 + r$：\n$$\nQ_0 = \\frac{u_0}{\\lambda_0 + r}\n$$\n\n接下来，我们计算新疗法的QALY，记为 $Q_1$。\n对于新疗法：\n- 死亡风险为每年 $\\lambda_1 = 0.12$。\n- 生存函数为 $S_1(t) = e^{-\\lambda_1 t} = e^{-0.12t}$。\n- 效用是分段的：当 $0 \\le t \\le \\tau$ 时，$u_1 = 0.60$；当 $t > \\tau$ 时，$u_0 = 0.80$，其中 $\\tau = 0.5$ 年。\n- 贴现率为每年 $r = 0.03$。\n\n由于效用函数是分段的，$Q_1$ 的积分必须分成与两个时间区间对应的两部分：\n$$\nQ_1 = \\int_{0}^{\\tau} S_1(t) u_1 e^{-rt} dt + \\int_{\\tau}^{\\infty} S_1(t) u_0 e^{-rt} dt\n$$\n代入生存函数 $S_1(t)$：\n$$\nQ_1 = u_1 \\int_{0}^{\\tau} e^{-(\\lambda_1 + r)t} dt + u_0 \\int_{\\tau}^{\\infty} e^{-(\\lambda_1 + r)t} dt\n$$\n让我们用 $k = \\lambda_1 + r$ 分别计算每个积分。\n第一个积分是：\n$$\n\\int_{0}^{\\tau} e^{-kt} dt = \\left[ -\\frac{1}{k} e^{-kt} \\right]_{0}^{\\tau} = -\\frac{1}{k} (e^{-k\\tau} - 1) = \\frac{1 - e^{-k\\tau}}{k}\n$$\n第二个积分是：\n$$\n\\int_{\\tau}^{\\infty} e^{-kt} dt = \\left[ -\\frac{1}{k} e^{-kt} \\right]_{\\tau}^{\\infty} = 0 - \\left(-\\frac{1}{k} e^{-k\\tau}\\right) = \\frac{e^{-k\\tau}}{k}\n$$\n结合这些结果求 $Q_1$：\n$$\nQ_1 = u_1 \\left( \\frac{1 - e^{-(\\lambda_1 + r)\\tau}}{\\lambda_1 + r} \\right) + u_0 \\left( \\frac{e^{-(\\lambda_1 + r)\\tau}}{\\lambda_1 + r} \\right)\n$$\n这可以通过合并公分母上的项来简化：\n$$\nQ_1 = \\frac{u_1 - u_1 e^{-(\\lambda_1 + r)\\tau} + u_0 e^{-(\\lambda_1 + r)\\tau}}{\\lambda_1 + r}\n$$\n$$\nQ_1 = \\frac{u_1 + (u_0 - u_1) e^{-(\\lambda_1 + r)\\tau}}{\\lambda_1 + r}\n$$\n\n净QALY效应 $\\Delta Q$ 是新疗法和标准护理的QALY之差：\n$$\n\\Delta Q = Q_1 - Q_0 = \\frac{u_1 + (u_0 - u_1) e^{-(\\lambda_1 + r)\\tau}}{\\lambda_1 + r} - \\frac{u_0}{\\lambda_0 + r}\n$$\n现在，我们代入给定的数值：\n- $\\lambda_0 = 0.15$\n- $\\lambda_1 = 0.12$\n- $u_0 = 0.80$\n- $u_1 = 0.60$\n- $\\tau = 0.5$\n- $r = 0.03$\n\n首先，计算 $Q_0$：\n$$\nQ_0 = \\frac{0.80}{0.15 + 0.03} = \\frac{0.80}{0.18} \\approx 4.4444... \\text{ QALYs}\n$$\n接下来，计算 $Q_1$。指数中的组合率为 $\\lambda_1 + r = 0.12 + 0.03 = 0.15$。\n$$\nQ_1 = \\frac{0.60 + (0.80 - 0.60) \\exp(-(0.15) \\times 0.5)}{0.15}\n$$\n$$\nQ_1 = \\frac{0.60 + 0.20 \\exp(-0.075)}{0.15}\n$$\n使用计算器计算指数项，$\\exp(-0.075) \\approx 0.92774349$。\n$$\nQ_1 \\approx \\frac{0.60 + 0.20 \\times 0.92774349}{0.15}\n$$\n$$\nQ_1 \\approx \\frac{0.60 + 0.185548698}{0.15}\n$$\n$$\nQ_1 \\approx \\frac{0.785548698}{0.15} \\approx 5.23699132 \\text{ QALYs}\n$$\n最后，计算净效应 $\\Delta Q$：\n$$\n\\Delta Q = Q_1 - Q_0 \\approx 5.23699132 - 4.44444444\n$$\n$$\n\\Delta Q \\approx 0.79254688\n$$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $7$、$9$、$2$ 和 $5$。第五位有效数字是 $4$，小于 $5$，因此我们不进位。\n$$\n\\Delta Q \\approx 0.7925\n$$\n正的结果表明，尽管生活质量在初期有所下降，但由于死亡率较低，新疗法与标准护理相比，在一生中提供了约 $0.7925$ QALYs 的净收益。", "answer": "$$\n\\boxed{0.7925}\n$$", "id": "5053251"}, {"introduction": "当疾病进程复杂且涉及多个阶段时，简单的计算便不足以评估长期健康结果。本练习将指导您构建一个离散时间马尔可夫模型，这是卫生经济学评估中的核心工具。通过模拟一个队列在不同健康状态（如“健康”、“患病”、“死亡”）之间的动态演变，您将亲身体验如何将效用、状态转移和贴现等概念整合到一个强大的框架中，以计算长期的QALY总和。[@problem_id:4995247]", "problem": "您的任务是在全球健康决策分析的背景下，实现一个离散时间队列马尔可夫模型，以计算折扣质量调整生命年 (QALYs)。请严格从基本定义开始：一个质量调整生命年 (QALY) 是健康相关生命质量权重在个体生存轨迹上的时间积分，而卫生经济学中的折扣则应用一个恒定的年率，使得未来健康的价值低于当前健康的价值。在队列马尔可夫模型中，个体在任何给定时间都处于若干相互排斥的健康状态之一，并且在等长周期内状态之间转移的概率是时间同质的。“死亡”是一个吸收态。使用半周期校正来近似每个周期内的连续时间累积。\n\n您的程序必须：\n- 将队列表示为各状态上的概率分布。\n- 使用提供的状态转移矩阵，将该分布按周期向前传播。\n- 使用半周期校正计算每个周期中的 QALY 累积：通过平均周期开始和结束时的健康效用流，乘以以年为单位的周期长度，并在周期中点对该累积进行折扣。跨周期求和以获得指定期程内的总折扣 QALYs。\n- 将每个情景的结果四舍五入到小数点后 $3$ 位，并以年为单位报告答案。\n\n需遵循的起始定义（请勿使用未从这些定义推导出的快捷公式）：\n- QALY 定义为健康效用对时间的积分，其中效用值在区间 $[0,1]$ 内，并乘以生存时间，$1$ 对应完全健康，$0$ 对应死亡。\n- 恒定率折扣应用一个取决于年折扣率和健康效应发生时间的因子。\n- 时间同质马尔可夫链通过每周期与一个固定的转移矩阵相乘来演化状态占据概率向量。\n\n您的程序必须以一种普遍适用的、纯数学的方式实现该算法。下面提供的所有数值必须完全按照给定值使用。所有最终输出都以年为单位表示。本任务不涉及角度。所给出的率是小数形式（例如，百分之三为 $0.03$），而不是百分比。\n\n测试套件：\n对于以下每个情景，使用半周期校正计算总折扣 QALYs，并以年为单位输出一个四舍五入到小数点后 $3$ 位的小数。\n\n情景 A（理想路径：三状态模型，年度周期）：\n- 状态：健康 $H$、患病 $S$、死亡 $D$（吸收态）。\n- 转移矩阵 $T_A = \\begin{pmatrix} 0.88  0.08  0.04 \\\\ 0.10  0.80  0.10 \\\\ 0.00  0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_A = \\begin{pmatrix} 0.92 \\\\ 0.65 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,A} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_A = 0.03$。\n- 周期长度 $\\Delta_A = 1.0$ 年。\n- 期程 $Y_A = 10.0$ 年。\n\n情景 B（边界条件：零折扣）：\n- 状态和转移与情景 A 相同。\n- 效用权重 $u_B = u_A$。\n- 初始分布 $p_{0,B} = p_{0,A}$。\n- 年折扣率 $r_B = 0.00$。\n- 周期长度 $\\Delta_B = 1.0$ 年。\n- 期程 $Y_B = 10.0$ 年。\n\n情景 C（边缘案例：半年周期，更快进展）：\n- 状态：稳定 $St$、进展 $Pr$、死亡 $D$（吸收态）。\n- 转移矩阵 $T_C = \\begin{pmatrix} 0.70  0.25  0.05 \\\\ 0.00  0.85  0.15 \\\\ 0.00  0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_C = \\begin{pmatrix} 0.80 \\\\ 0.50 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,C} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_C = 0.03$。\n- 周期长度 $\\Delta_C = 0.5$ 年。\n- 期程 $Y_C = 3.0$ 年。\n\n情景 D（边缘案例：期程内无死亡）：\n- 状态：良好 $W$、死亡 $D$（吸收态）。\n- 转移矩阵 $T_D = \\begin{pmatrix} 1.00  0.00 \\\\ 0.00  1.00 \\end{pmatrix}$。\n- 效用权重 $u_D = \\begin{pmatrix} 0.95 \\\\ 0.00 \\end{pmatrix}$。\n- 初始分布 $p_{0,D} = \\begin{pmatrix} 1.00 \\\\ 0.00 \\end{pmatrix}$。\n- 年折扣率 $r_D = 0.03$。\n- 周期长度 $\\Delta_D = 1.0$ 年。\n- 期程 $Y_D = 10.0$ 年。\n\n情景 E（边缘案例：高折扣率）：\n- 状态和转移与情景 A 相同。\n- 效用权重 $u_E = u_A$。\n- 初始分布 $p_{0,E} = p_{0,A}$。\n- 年折扣率 $r_E = 0.10$。\n- 周期长度 $\\Delta_E = 1.0$ 年。\n- 期程 $Y_E = 10.0$ 年。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含按 $A,B,C,D,E$ 顺序排列的结果，形式为方括号括起来的逗号分隔列表。每个元素都是一个以年为单位、四舍五入到小数点后 $3$ 位的小数。例如，一个有效的输出格式是 $\\left[ x_A, x_B, x_C, x_D, x_E \\right]$，其中每个 $x_\\cdot$ 都四舍五入到小数点后 $3$ 位并以年为单位表示。", "solution": "该问题要求使用离散时间队列马尔可夫模型计算总折扣质量调整生命年 (QALYs)。解决方案源于所指定马尔可夫过程、健康效用和经济折扣的基本原理。\n\n队列马尔可夫模型描述了一组个体在一系列离散时间间隔（或称周期）内，经历一个有限的、相互排斥的健康状态集合的演进过程。\n\n设状态集合为 $S = \\{s_1, s_2, \\dots, s_m\\}$，其中 $m$ 是状态的数量。在周期 $k$（其中 $k=0, 1, 2, \\dots$）开始时，队列在每个状态中的比例由一个状态概率行向量 $\\boldsymbol{p}_k = [p_{k,1}, p_{k,2}, \\dots, p_{k,m}]$ 表示，其中 $\\sum_{i=1}^{m} p_{k,i} = 1$。\n\n该模型是时间同质的，意味着在每个周期内状态之间转移的概率是恒定的。这些概率包含在一个 $m \\times m$ 的转移矩阵 $T$ 中，其中元素 $T_{ij}$ 是在单个周期内从状态 $s_i$ 移动到状态 $s_j$ 的概率。状态向量根据以下方程演化：\n$$\n\\boldsymbol{p}_{k+1} = \\boldsymbol{p}_k T\n$$\n周期 $k$ 时的状态向量可以通过初始状态向量 $\\boldsymbol{p}_0$ 计算得出：\n$$\n\\boldsymbol{p}_k = \\boldsymbol{p}_0 T^k\n$$\n其中 $T^k$ 是矩阵 $T$ 的 $k$ 次幂。\n\n每个健康状态 $s_i$ 都与一个健康相关生命质量权重（或称效用）$u_i$ 相关联，其中 $u_i \\in [0, 1]$。这些权重被收集到一个列向量 $\\boldsymbol{u} = [u_1, u_2, \\dots, u_m]^T$ 中。在周期 $k$ 开始时，队列的总期望效用是状态向量和效用向量的点积：\n$$\nU_k = \\boldsymbol{p}_k \\cdot \\boldsymbol{u} = \\sum_{i=1}^{m} p_{k,i} u_i\n$$\n问题指定使用半周期校正来近似离散周期内的 QALYs 连续累积。在一个周期内累积的 QALYs 基于该周期开始和结束时的平均效用。对于周期 $k$，其时间范围从 $t_k = k\\Delta$ 到 $t_{k+1} = (k+1)\\Delta$（其中 $\\Delta$ 是以年为单位的周期长度），开始时的期望效用是 $U_k$，结束时是 $U_{k+1} = \\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u}$。\n\n周期 $k$ 内的平均效用为：\n$$\n\\bar{U}_k = \\frac{U_k + U_{k+1}}{2}\n$$\n在周期 $k$ 内累积的未折扣 QALYs 是这个平均效用乘以周期持续时间：\n$$\nQ_{k, \\text{undiscounted}} = \\bar{U}_k \\Delta = \\left( \\frac{U_k + U_{k+1}}{2} \\right) \\Delta\n$$\n未来的健康产出比当前的价值要低。这通过使用年折扣率 $r$ 来建模。在时间 $t$ 获得的健康效益会以 $(1+r)^{-t}$ 的因子进行折扣。问题指定，在一个周期内累积的 QALYs 应被视为发生在周期的中点进行折扣。周期 $k$ 的中点时间为 $t_{k, \\text{mid}} = k\\Delta + \\frac{\\Delta}{2} = (k+0.5)\\Delta$。\n\n因此，周期 $k$ 的折扣因子为：\n$$\nd_k = \\frac{1}{(1+r)^{t_{k, \\text{mid}}}} = (1+r)^{-(k+0.5)\\Delta}\n$$\n周期 $k$ 的折扣 QALYs 是未折扣 QALYs 与折扣因子的乘积：\n$$\nQ_{k, \\text{discounted}} = Q_{k, \\text{undiscounted}} \\times d_k = \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + (\\boldsymbol{p}_{k+1} \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta}\n$$\n在 $Y$ 年的期程内，总折扣 QALYs 是每个周期的折扣 QALYs 之和。总周期数为 $N = Y/\\Delta$。求和从周期 $k=0$ 到 $k=N-1$：\n$$\nQ_{\\text{total}} = \\sum_{k=0}^{N-1} Q_{k, \\text{discounted}}\n$$\n代入完整表达式，我们得到用于计算的最终公式：\n$$\nQ_{\\text{total}} = \\sum_{k=0}^{N-1} \\left[ \\left( \\frac{(\\boldsymbol{p}_k \\cdot \\boldsymbol{u}) + ((\\boldsymbol{p}_k T) \\cdot \\boldsymbol{u})}{2} \\right) \\Delta (1+r)^{-(k+0.5)\\Delta} \\right]\n$$\n该公式通过遍历每个周期来实现：更新状态概率向量，计算周期开始和结束时的效用，应用半周期校正和折扣，并累加结果。每个情景的最终值都四舍五入到小数点后 3 位。\n\n算法如下：\n1.  对于给定情景，确定参数：转移矩阵 $T$、效用向量 $\\boldsymbol{u}$、初始状态向量 $\\boldsymbol{p}_0$、年折扣率 $r$、周期长度 $\\Delta$ 和期程 $Y$。\n2.  计算周期数 $N = Y/\\Delta$。\n3.  初始化总折扣 QALYs，$Q_{\\text{total}} = 0$。\n4.  初始化当前状态向量 $\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_0$。\n5.  对 $k$ 从 $0$ 到 $N-1$ 进行循环：\n    a. 计算下一个周期开始时的状态向量：$\\boldsymbol{p}_{\\text{next}} = \\boldsymbol{p}_{\\text{current}} T$。\n    b. 计算当前周期开始时的效用：$U_{\\text{current}} = \\boldsymbol{p}_{\\text{current}} \\cdot \\boldsymbol{u}$。\n    c. 计算当前周期结束时的效用：$U_{\\text{next}} = \\boldsymbol{p}_{\\text{next}} \\cdot \\boldsymbol{u}$。\n    d. 计算周期的平均效用：$\\bar{U} = (U_{\\text{current}} + U_{\\text{next}}) / 2$。\n    e. 计算周期中点时间：$t_{\\text{mid}} = (k + 0.5)\\Delta$。\n    f. 计算折扣因子：$d = (1+r)^{-t_{\\text{mid}}}$。\n    g. 计算该周期的折扣 QALYs 并加到总数上：$Q_{\\text{total}} = Q_{\\text{total}} + \\bar{U} \\Delta d$。\n    h. 更新状态向量以用于下一次迭代：$\\boldsymbol{p}_{\\text{current}} = \\boldsymbol{p}_{\\text{next}}$。\n6.  循环结束后，将 $Q_{\\text{total}}$ 四舍五入到小数点后 3 位。\n将此程序应用于所提供的所有五个情景。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_discounted_qalys(T, u, p0, r, delta, Y):\n    \"\"\"\n    Computes discounted Quality-Adjusted Life Years (QALYs) using a cohort Markov model.\n\n    Args:\n        T (np.ndarray): The state transition probability matrix.\n        u (np.ndarray): The utility vector for the states.\n        p0 (np.ndarray): The initial state probability distribution vector.\n        r (float): The annual discount rate.\n        delta (float): The length of each cycle in years.\n        Y (float): The total time horizon in years.\n\n    Returns:\n        float: The total discounted QALYs.\n    \"\"\"\n    # Ensure all inputs are numpy arrays for consistent matrix operations\n    T = np.asarray(T, dtype=float)\n    u = np.asarray(u, dtype=float)\n    p0 = np.asarray(p0, dtype=float)\n\n    # Calculate the number of cycles\n    num_cycles = int(Y / delta)\n\n    total_discounted_qaly = 0.0\n    p_current = p0\n\n    for k in range(num_cycles):\n        # State vector at the end of the cycle\n        p_next = p_current @ T\n\n        # Utility at the start and end of the cycle\n        utility_current = p_current @ u\n        utility_next = p_next @ u\n        \n        # Average utility over the cycle (half-cycle correction)\n        avg_utility = (utility_current + utility_next) / 2.0\n\n        # Undiscounted QALYs for the cycle\n        qaly_k_undiscounted = avg_utility * delta\n\n        # Time at the midpoint of the cycle for discounting\n        mid_cycle_time = (k + 0.5) * delta\n\n        # Discount factor for the cycle\n        discount_factor = 1.0 / ((1.0 + r) ** mid_cycle_time)\n        \n        # Discounted QALYs for the cycle\n        qaly_k_discounted = qaly_k_undiscounted * discount_factor\n        \n        # Add to the total\n        total_discounted_qaly += qaly_k_discounted\n\n        # Update the state vector for the next iteration\n        p_current = p_next\n        \n    return total_discounted_qaly\n\ndef solve():\n    \"\"\"\n    Defines test cases, computes QALYs for each, and prints the results.\n    \"\"\"\n    # Scenario A\n    T_A = [[0.88, 0.08, 0.04], [0.10, 0.80, 0.10], [0.00, 0.00, 1.00]]\n    u_A = [0.92, 0.65, 0.00]\n    p0_A = [1.00, 0.00, 0.00]\n    r_A = 0.03\n    delta_A = 1.0\n    Y_A = 10.0\n\n    # Scenario B\n    T_B = T_A\n    u_B = u_A\n    p0_B = p0_A\n    r_B = 0.00\n    delta_B = 1.0\n    Y_B = 10.0\n\n    # Scenario C\n    T_C = [[0.70, 0.25, 0.05], [0.00, 0.85, 0.15], [0.00, 0.00, 1.00]]\n    u_C = [0.80, 0.50, 0.00]\n    p0_C = [1.00, 0.00, 0.00]\n    r_C = 0.03\n    delta_C = 0.5\n    Y_C = 3.0\n\n    # Scenario D\n    T_D = [[1.00, 0.00], [0.00, 1.00]]\n    u_D = [0.95, 0.00]\n    p0_D = [1.00, 0.00]\n    r_D = 0.03\n    delta_D = 1.0\n    Y_D = 10.0\n\n    # Scenario E\n    T_E = T_A\n    u_E = u_A\n    p0_E = p0_A\n    r_E = 0.10\n    delta_E = 1.0\n    Y_E = 10.0\n\n    test_cases = [\n        (T_A, u_A, p0_A, r_A, delta_A, Y_A),\n        (T_B, u_B, p0_B, r_B, delta_B, Y_B),\n        (T_C, u_C, p0_C, r_C, delta_C, Y_C),\n        (T_D, u_D, p0_D, r_D, delta_D, Y_D),\n        (T_E, u_E, p0_E, r_E, delta_E, Y_E),\n    ]\n\n    results = []\n    for case in test_cases:\n        T, u, p0, r, delta, Y = case\n        result = compute_discounted_qalys(T, u, p0, r, delta, Y)\n        results.append(result)\n\n    # Format the final output string as a list of numbers rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "4995247"}]}