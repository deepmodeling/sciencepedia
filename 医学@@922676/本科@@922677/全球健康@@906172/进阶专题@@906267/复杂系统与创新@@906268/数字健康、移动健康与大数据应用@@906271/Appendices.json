{"hands_on_practices": [{"introduction": "在推广一项移动健康（mHealth）干预措施前，我们必须确保评估研究有足够大的样本量来检测出有意义的效果。本练习将指导您为一个在数字健康领域常见的整群随机对照试验（cluster RCT）计算样本量，并特别考虑由组内相关系数（intracluster correlation coefficient, $\\rho$）引起的统计复杂性。掌握这一技能是设计可信研究的关键。[@problem_id:4973577]", "problem": "某卫生部正在一个中等收入国家评估一款用于基层医疗诊所高血压管理的移动健康（mHealth）决策支持应用程序。他们计划进行一项双臂、平行、整群随机对照试验（RCT），每臂的诊所数量相等，且群组大小相等。主要结局是收缩压的变化（以毫米汞柱为单位），被建模为连续变量。在每个诊所内部，由于共享的医疗服务提供者和局部工作流程，个体结局呈正相关；这种相关性由组内相关系数（ICC）捕获，记为 $\\rho$。\n\n假设以下基本前提：\n- 同一诊所内的个体具有相同的边际方差 $\\sigma^{2}$ 和成对协方差 $\\rho \\sigma^{2}$；不同诊所的结局是独立的。\n- 臂间均值差异采用双侧正态近似检验，显著性水平为 $\\alpha$，功效为 $1 - \\beta$。\n- 令 $m$ 表示每个诊所的个体数量，$J$ 表示每臂的诊所数量。令 $\\delta$ 为待检测的臂间均值真实差异。\n\n任务：\n1. 从相关随机变量之和的方差定义以及两样本均值差检验的正态近似出发，推导每臂所需诊所数量 $J$ 的样本量公式，该公式是关于 $\\sigma^{2}$、$\\rho$、$m$、$\\delta$、$\\alpha$ 和 $\\beta$ 的函数。您的推导必须明确展示组内相关系数如何通过聚类引起的设计效应来增大方差。\n2. 使用推导出的公式，根据以下针对此mHealth评估的科学合理参数，计算每臂所需的诊所数量：\n   - 双侧显著性水平 $\\alpha = 0.05$，功效 $1 - \\beta = 0.9$，\n   - 标准差 $\\sigma = 12$，\n   - 组内相关系数 $\\rho = 0.02$，\n   - 相等的群组大小 $m = 35$，\n   - 目标均值差异 $\\delta = 4$。\n将所需的 $J$ 报告为大于或等于计算值的最小整数。在方框中提供最终答案，为一个没有单位的数字。", "solution": "我们将臂 $a \\in \\{T, C\\}$ 中诊所（群组）$j$ 内个体 $i$ 的结局建模为 $Y_{a, j i}$，其中 $\\mathbb{E}[Y_{a, j i}] = \\mu_{a}$ 且 $\\operatorname{Var}(Y_{a, j i}) = \\sigma^{2}$。对于同一诊所 $j$ 中的任意两个不同个体 $i \\neq i'$，我们假设 $\\operatorname{Cov}(Y_{a, j i}, Y_{a, j i'}) = \\rho \\sigma^{2}$，而对于不同诊所中的个体，协方差为 $0$。设每臂有 $J$ 个诊所，每个诊所有 $m$ 个个体，因此每臂的样本量为 $n = J m$ 个个体。\n\n将臂均值定义为\n$$\n\\bar{Y}_{a} = \\frac{1}{J m} \\sum_{j=1}^{J} \\sum_{i=1}^{m} Y_{a, j i}.\n$$\n我们首先推导聚类情况下 $\\operatorname{Var}(\\bar{Y}_{a})$。使用和的方差公式，\n$$\n\\operatorname{Var}\\!\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} Y_{a, j i}\\right)\n= \\sum_{j=1}^{J} \\left[ \\sum_{i=1}^{m} \\operatorname{Var}(Y_{a, j i}) + \\sum_{\\substack{i, i' = 1 \\\\ i \\neq i'}}^{m} \\operatorname{Cov}(Y_{a, j i}, Y_{a, j i'}) \\right].\n$$\n在每个诊所 $j$ 内部，有 $m$ 个方差项 $\\sigma^{2}$ 和 $m(m-1)$ 个成对协方差项 $\\rho \\sigma^{2}$。因此，\n$$\n\\operatorname{Var}\\!\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} Y_{a, j i}\\right)\n= \\sum_{j=1}^{J} \\left[ m \\sigma^{2} + m (m-1) \\rho \\sigma^{2} \\right]\n= J m \\sigma^{2} \\left[ 1 + (m-1) \\rho \\right].\n$$\n除以 $(J m)^{2}$ 得到臂均值的方差，\n$$\n\\operatorname{Var}(\\bar{Y}_{a}) = \\frac{\\sigma^{2} \\left[ 1 + (m-1) \\rho \\right]}{J m}.\n$$\n臂均值之差 $\\bar{Y}_{T} - \\bar{Y}_{C}$ 的方差为\n$$\n\\operatorname{Var}(\\bar{Y}_{T} - \\bar{Y}_{C})\n= \\operatorname{Var}(\\bar{Y}_{T}) + \\operatorname{Var}(\\bar{Y}_{C})\n= \\frac{2 \\sigma^{2} \\left[ 1 + (m-1) \\rho \\right]}{J m},\n$$\n利用了臂间的独立性。\n\n对于显著性水平为 $\\alpha$、功效为 $1 - \\beta$ 的双侧检验，正态近似要求可检测差异 $\\delta$ 满足\n$$\n\\delta = \\left( z_{1 - \\alpha/2} + z_{1 - \\beta} \\right) \\sqrt{ \\operatorname{Var}(\\bar{Y}_{T} - \\bar{Y}_{C}) },\n$$\n其中 $z_{p}$ 是标准正态分布的第 $p$ 个分位数。代入方差，\n$$\n\\delta = \\left( z_{1 - \\alpha/2} + z_{1 - \\beta} \\right) \\sqrt{ \\frac{2 \\sigma^{2} \\left[ 1 + (m-1) \\rho \\right]}{J m} }.\n$$\n求解 $J$，\n$$\nJ = \\frac{2 \\sigma^{2} \\left[ 1 + (m-1) \\rho \\right] \\left( z_{1 - \\alpha/2} + z_{1 - \\beta} \\right)^{2} }{ m \\, \\delta^{2} }.\n$$\n这个表达式揭示了经典的设计效应\n$$\n\\text{Design effect} = 1 + (m-1) \\rho,\n$$\n它将相对于个体随机化时的方差进行了放大。等价地，可以写作 $J = \\left( \\text{DE} \\times n_{\\text{indiv, per arm}} \\right) / m$，其中 $n_{\\text{indiv, per arm}} = \\frac{2 \\sigma^{2} \\left( z_{1 - \\alpha/2} + z_{1 - \\beta} \\right)^{2}}{\\delta^{2}}$ 是个体随机化下每臂的样本量，且 $\\text{DE} = 1 + (m-1)\\rho$。\n\n我们现在根据给定的参数计算 $J$。对于 $\\alpha = 0.05$ (双侧) 和 $1 - \\beta = 0.9$，我们有 $z_{1 - \\alpha/2} = z_{0.975} \\approx 1.96$ 和 $z_{1 - \\beta} = z_{0.9} \\approx 1.2816$。令 $\\sigma = 12$ 所以 $\\sigma^{2} = 144$，$\\rho = 0.02$，$m = 35$，以及 $\\delta = 4$ 所以 $\\delta^{2} = 16$。\n\n计算设计效应：\n$$\n\\text{DE} = 1 + (m-1)\\rho = 1 + 34 \\times 0.02 = 1 + 0.68 = 1.68.\n$$\n计算分位数之和及其平方：\n$$\nz_{1 - \\alpha/2} + z_{1 - \\beta} \\approx 1.96 + 1.2816 = 3.2416, \\quad (3.2416)^{2} \\approx 10.50797056.\n$$\n代入公式：\n$$\nJ = \\frac{2 \\cdot 144 \\cdot 1.68 \\cdot 10.50797056}{35 \\cdot 16}.\n$$\n首先，计算不含 $m$ 和 $\\delta^{2}$ 的分子因子：\n$$\n2 \\cdot 144 \\cdot 10.50797056 = 288 \\cdot 10.50797056 \\approx 3026.293533,\n$$\n然后乘以 $\\text{DE} = 1.68$：\n$$\n3026.293533 \\times 1.68 \\approx 5084.179138.\n$$\n除以 $m \\delta^{2} = 35 \\cdot 16 = 560$：\n$$\nJ \\approx \\frac{5084.179138}{560} \\approx 9.079.\n$$\n每臂所需的诊所数量是大于或等于 $9.079$ 的最小整数，即 $10$。", "answer": "$$\\boxed{10}$$", "id": "4973577"}, {"introduction": "数字健康研究常常依赖于整合来自多个来源的数据，例如将手机应用数据与国家疾病登记系统的数据进行关联，而这个过程很容易出错。本练习将向您展示这些关联错误如何系统性地影响像疾病患病率这样的重要指标，并要求您推导并应用一个偏差校正公式。对于任何处理真实世界数据的数据分析师来说，这是一项至关重要的技能。[@problem_id:4973560]", "problem": "一个针对中低收入国家的移动健康 (mHealth) 高血压监测项目，正在将应用收集的数据与国家慢性病登记系统 (CDR) 进行整合，以获得经过验证的高血压诊断。该项目使用确定性规则将应用用户与CDR进行链接，分析师将链接后的登记系统诊断作为观察到的疾病状态。如果某个应用用户未找到登记系统链接，分析师将其疾病状态填补为非高血压。在一项验证子研究中，链接性能被描述如下：在确实有经登记系统确认的高血压诊断的应用用户中，链接返回正确匹配的概率为 $s$；在确实没有经登记系统确认的高血压诊断的应用用户中，链接通过错误匹配而错误地分配了高血压状态的概率为 $f$。假设当一个真实的非高血压用户发生错误匹配时，其被分配为高血压状态的概率为 $f$；否则，该用户仍被标记为非高血压。设应用用户中的真实高血压患病率为 $p = \\mathbb{P}(D=1)$，其中 $D \\in \\{0,1\\}$ 表示经登记系统确认的真实高血压状态，并设链接和填补后的观察状态为 $Y \\in \\{0,1\\}$。\n\n在包含 $N = 50{,}000$ 名应用用户的完整分析数据集中，分析师观察到在链接和填补后有 $3{,}600$ 名用户被标记为高血压，因此观察到的患病率为 $p_{\\text{obs}} = 3{,}600/50{,}000$。该验证子研究估计，当链接算法应用于此人群时，$s = 0.85$ 且 $f = 0.01$。\n\n仅使用核心概率定义（例如全概率公式）以及上面给出的灵敏度 $s$ 和错误匹配率 $f$ 的定义，执行以下操作：\n\n1. 通过用 $p$、$s$ 和 $f$ 表示 $\\mathbb{P}(Y=1)$，来形式化说明链接误差如何传播到观察到的患病率中。\n2. 用观察到的患病率 $p_{\\text{obs}}$、链接灵敏度 $s$ 和错误匹配率 $f$ 推导出真实患病率 $p$ 的解析性偏差校正表达式。\n3. 使用提供的数值 $p_{\\text{obs}} = 3{,}600/50{,}000$、$s = 0.85$ 和 $f = 0.01$ 计算偏差校正后的患病率。\n\n将最终校正后的患病率表示为小数比例，并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求推导并应用一个偏差校正公式，用于根据具有已知错误分类概率的数据集来估计疾病患病率。首先对问题陈述的正确性和可解性进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n-   $D \\in \\{0, 1\\}$: 经登记系统确认的真实高血压状态，其中 $D=1$ 表示患有高血压。\n-   $Y \\in \\{0, 1\\}$: 链接和填补后的观察状态，其中 $Y=1$ 表示观察到患有高血压。\n-   $p = \\mathbb{P}(D=1)$: 应用用户中的真实高血压患病率。\n-   $s = \\mathbb{P}(\\text{linkage returns correct match} | D=1) = 0.85$: 对于真实患有高血压的用户，正确匹配的概率。\n-   $f = \\mathbb{P}(\\text{linkage erroneously assigns a hypertensive status via a false match} | D=0) = 0.01$: 对于真实非高血压的用户，因错误匹配导致被分类为高血压的概率。\n-   填补规则：如果未找到登记系统链接，则状态被填补为非高血压 ($Y=0$)。\n-   用户总数：$N = 50,000$。\n-   观察到的高血压用户数：$3,600$。\n-   观察到的患病率：$p_{\\text{obs}} = \\frac{3,600}{50,000}$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n该问题具有科学依据，描述了一个标准的流行病学挑战，即在使用记录链接进行患病率估计时校正错误分类偏差。链接灵敏度 ($s$) 和错误匹配率 ($f$) 的定义与测量误差文献中的定义一致。\n-   对于一个真实患有高血压的用户 ($D=1$)，正确匹配会导致 $Y=1$。这种情况发生的概率为 $s$。如果未找到正确匹配（概率为 $1-s$），则没有建立链接，状态被填补为 $Y=0$。因此，$\\mathbb{P}(Y=1 | D=1) = s$。\n-   对于一个真实非高血压的用户 ($D=0$)，以概率 $f$ 发生错误地分配高血压状态的事件，导致 $Y=1$。如果没有发生此类错误（概率为 $1-f$），则未找到链接，状态被填补为 $Y=0$。因此，$\\mathbb{P}(Y=1 | D=0) = f$。\n\n该问题是适定的，有足够的信息来推导出唯一解。提供的数值（$s=0.85$，$f=0.01$ 和观察到的计数）是现实的。不存在矛盾、歧义或违反科学原则的情况。\n\n**步骤3：结论与行动**\n\n问题有效。将继续进行求解过程。\n\n### 解答\n\n解答按照问题陈述的要求分为三个部分呈现。\n\n**第1部分：形式化观察到的患病率与真实患病率之间的关系**\n\n我们希望将观察到的患病率 $\\mathbb{P}(Y=1)$ 表示为真实患病率 $p$ 以及链接误差参数 $s$ 和 $f$ 的函数。我们使用全概率公式，并以真实疾病状态 $D$ 为条件。\n\n应用用户的全集被划分为两个不相交的集合：真实患有高血压的用户 ($D=1$) 和非高血压的用户 ($D=0$)。这些状态的概率为：\n$$\n\\mathbb{P}(D=1) = p\n$$\n$$\n\\mathbb{P}(D=0) = 1 - p\n$$\n\n被观察为高血压的概率 $\\mathbb{P}(Y=1)$ 可以写成：\n$$\n\\mathbb{P}(Y=1) = \\mathbb{P}(Y=1 | D=1)\\mathbb{P}(D=1) + \\mathbb{P}(Y=1 | D=0)\\mathbb{P}(D=0)\n$$\n\n从问题验证中，我们确定了被观察为高血压的条件概率：\n-   在真实高血压状态下被观察为高血压的概率是链接/填补过程的灵敏度，即给定的 $s$。\n    $$\n    \\mathbb{P}(Y=1 | D=1) = s\n    $$\n-   在真实非高血压状态下被观察为高血压的概率是假阳性率，即给定的 $f$。\n    $$\n    \\mathbb{P}(Y=1 | D=0) = f\n    $$\n\n将这些项代入全概率公式方程，得到观察患病率的表达式，我们将其记为 $p_{\\text{obs}}$：\n$$\np_{\\text{obs}} = \\mathbb{P}(Y=1) = s \\cdot p + f \\cdot (1-p)\n$$\n这个公式显示了链接误差（由 $s$ 和 $f$ 代表）如何系统性地偏倚观察到的患病率。\n\n**第2部分：推导真实患病率 $p$ 的偏差校正表达式**\n\n现在我们重新整理第1部分中推导出的表达式，以求解用观察到的患病率 $p_{\\text{obs}}$ 以及参数 $s$ 和 $f$ 表示的真实患病率 $p$。\n\n从以下方程开始：\n$$\np_{\\text{obs}} = sp + f(1-p)\n$$\n我们展开项 $f$：\n$$\np_{\\text{obs}} = sp + f - fp\n$$\n接下来，我们分离出含有 $p$ 的项：\n$$\np_{\\text{obs}} - f = sp - fp\n$$\n从右侧提取因子 $p$：\n$$\np_{\\text{obs}} - f = p(s - f)\n$$\n假设 $s \\neq f$，这对于给定的值（$s=0.85$ 和 $f=0.01$）是成立的，并且是分类具有信息量的一个必要条件，我们可以除以 $(s-f)$ 来求解 $p$：\n$$\np = \\frac{p_{\\text{obs}} - f}{s - f}\n$$\n这就是真实患病率 $p$ 的解析性偏差校正表达式。\n\n**第3部分：计算偏差校正后的患病率**\n\n首先，我们根据给定数据计算观察到的患病率 $p_{\\text{obs}}$ 的数值：\n$$\np_{\\text{obs}} = \\frac{3,600}{50,000} = \\frac{36}{500} = \\frac{72}{1,000} = 0.072\n$$\n其他给定的值为 $s=0.85$ 和 $f=0.01$。\n\n现在，我们将这些数值代入第2部分推导出的偏差校正公式中：\n$$\np = \\frac{0.072 - 0.01}{0.85 - 0.01}\n$$\n对分子和分母进行减法运算：\n$$\np = \\frac{0.062}{0.84}\n$$\n现在我们进行除法运算：\n$$\np = \\frac{62}{840} = \\frac{31}{420} \\approx 0.0738095238...\n$$\n问题要求最终答案四舍五入到四位有效数字。第一位有效数字是$7$。前四位有效数字是$7$、$3$、$8$和$0$。第五位有效数字是$9$。由于$9 \\geq 5$，我们将第四位有效数字（$0$）向上舍入为$1$。\n\n因此，计算出的偏差校正后的患病率，四舍五入到四位有效数字后，为$0.07381$。", "answer": "$$\\boxed{0.07381}$$", "id": "4973560"}, {"introduction": "一个预测模型只有在能够指导我们做出更好决策时才真正有用。本练习将探讨如何为一个风险评分模型设定最佳的决策阈值，以在正确识别高风险患者（真阳性）的收益与误报（假阳性）的成本之间取得平衡。您将运用决策曲线分析的框架，学习如何将临床的偏好和优先级转化为一个具体的、可操作的阈值。[@problem_id:4973582]", "problem": "一款移动健康（mHealth）应用程序在智能手机上部署了一个二元风险模型，该模型基于可穿戴传感器数据，在$7$天的时间窗口内对患者进行急性事件的分诊。该模型为事件输出一个经过校准的对数几率分数$z \\in \\mathbb{R}$，其中越大的$z$表示越高的风险。人群中该事件的流行率为$\\pi$，并且由于该事件罕见，开发者面临类别不平衡的问题。\n\n为了在模型开发过程中解决不平衡问题，团队考虑使用带类别权重的加权经验风险。在部署时，一位临床利益相关者通过决策曲线指定一种决策分析偏好：根据一个阈值概率$p_{t}$，对阳性预测采取行动会产生净收益，该净收益在假阳性与真阳性之间进行权衡，其定义为\n$$\n\\mathrm{NB}(p_{t}; \\text{policy}) \\equiv \\frac{\\mathrm{TP}}{N} - \\frac{p_{t}}{1-p_{t}} \\cdot \\frac{\\mathrm{FP}}{N},\n$$\n其中$N$是队列大小，$\\mathrm{TP}$是真阳性数量，$\\mathrm{FP}$是假阳性数量。假设模型分数的概率校准是完美的，并且决策者预先固定了$p_{t}$。\n\n假设在真实类别$Y \\in \\{0,1\\}$的条件下，部署的分数$z$服从等方差的高斯分布，\n$$\nz \\mid (Y=1) \\sim \\mathcal{N}(\\mu_{1}, \\sigma^{2}) \\quad \\text{and} \\quad z \\mid (Y=0) \\sim \\mathcal{N}(\\mu_{0}, \\sigma^{2}),\n$$\n且$\\mu_{1} > \\mu_{0}$。设分诊策略为对$z$的确定性阈值：当且仅当$z \\ge z_{\\ast}$时，预测为阳性。\n\n任务：\n1. 从期望损失和贝叶斯决策理论的定义出发，通过加权错分成本来形式化类别不平衡的处理方法，并证明在所有阈值$z_{\\ast}$上最大化$\\mathrm{NB}(p_{t}; z_{\\ast})$等价于最小化一个期望成本，其中假阴性成本等于$1$，假阳性成本等于$w \\equiv \\frac{p_{t}}{1-p_{t}}$。从第一性原理出发，推导最优似然比阈值，并用$\\mu_{0}$、$\\mu_{1}$、$\\sigma^{2}$、$\\pi$和$p_{t}$表示$z$上对应的最优阈值。\n2. 对于一次部署，人群流行率为$\\pi = 0.04$，利益相关者设定$p_{t} = 0.1$，分数分布的参数为$\\mu_{1} = 1.2$、$\\mu_{0} = -0.3$和$\\sigma = 0.9$，计算在指定的决策偏好下使净收益最大化的最优分数阈值$z_{\\ast}$。\n\n将您最终的$z_{\\ast}$数值答案四舍五入至四位有效数字。无需单位。", "solution": "用户提供的问题经验证是合理且定义明确的。它基于标准的统计决策理论及其在医学诊断中的应用，这是数字健康领域的核心课题。所有必要信息都已提供，问题内部一致。任务定义清晰，并能导出一个唯一且有意义的解。\n\n### 第1部分：最优阈值的推导\n\n第一个任务是形式化最大化净收益$\\mathrm{NB}(p_{t})$与最小化加权期望错分成本之间的等价关系，然后推导最优决策阈值$z_{\\ast}$。\n\n设$Y \\in \\{0, 1\\}$为真实类别标签，其中$Y=1$表示事件发生，$Y=0$表示事件未发生。人群中事件的流行率为$P(Y=1) = \\pi$。决策策略是如果分数$z$超过阈值$z_{\\ast}$，则预测事件发生。\n\n净收益定义为：\n$$\n\\mathrm{NB}(p_{t}; z_{\\ast}) \\equiv \\frac{\\mathrm{TP}(z_{\\ast})}{N} - \\frac{p_{t}}{1-p_{t}} \\cdot \\frac{\\mathrm{FP}(z_{\\ast})}{N}\n$$\n其中$N$是个体总数，$\\mathrm{TP}(z_{\\ast})$是在给定阈值$z_{\\ast}$下的真阳性数量，$\\mathrm{FP}(z_{\\ast})$是假阳性数量。\n\n我们可以用真阳性率（$\\mathrm{TPR}$）和假阳性率（$\\mathrm{FPR}$）来表示$\\mathrm{TP}(z_{\\ast})$和$\\mathrm{FP}(z_{\\ast})$：\n$\\mathrm{TP}(z_{\\ast}) = N \\cdot \\pi \\cdot \\mathrm{TPR}(z_{\\ast})$，其中$\\mathrm{TPR}(z_{\\ast}) = P(z \\ge z_{\\ast} \\mid Y=1)$。\n$\\mathrm{FP}(z_{\\ast}) = N \\cdot (1-\\pi) \\cdot \\mathrm{FPR}(z_{\\ast})$，其中$\\mathrm{FPR}(z_{\\ast}) = P(z \\ge z_{\\ast} \\mid Y=0)$。\n\n将这些代入$\\mathrm{NB}$方程得到：\n$$\n\\mathrm{NB}(p_{t}; z_{\\ast}) = \\frac{N \\pi \\mathrm{TPR}(z_{\\ast})}{N} - \\frac{p_{t}}{1-p_{t}} \\frac{N (1-\\pi) \\mathrm{FPR}(z_{\\ast})}{N} = \\pi \\mathrm{TPR}(z_{\\ast}) - \\frac{p_{t}}{1-p_{t}} (1-\\pi) \\mathrm{FPR}(z_{\\ast})\n$$\n\n现在，考虑一个决策规则的期望错分成本（或风险）。设$C_{FN}$为假阴性（当$Y=1$时预测为$0$）的成本，设$C_{FP}$为假阳性（当$Y=0$时预测为$1$）的成本。真阳性和真阴性的成本假定为$0$。期望成本$E[\\text{Cost}]$为：\n$$\nE[\\text{Cost}(z_{\\ast})] = C_{FP} P(\\text{predict } 1, Y=0) + C_{FN} P(\\text{predict } 0, Y=1)\n$$\n使用条件概率：\n$$\nE[\\text{Cost}(z_{\\ast})] = C_{FP} P(z \\ge z_{\\ast} \\mid Y=0) P(Y=0) + C_{FN} P(z  z_{\\ast} \\mid Y=1) P(Y=1)\n$$\n设FNR为假阴性率，$\\mathrm{FNR}(z_{\\ast}) = P(z  z_{\\ast} \\mid Y=1) = 1 - \\mathrm{TPR}(z_{\\ast})$。\n期望成本为：\n$$\nE[\\text{Cost}(z_{\\ast})] = C_{FP} (1-\\pi) \\mathrm{FPR}(z_{\\ast}) + C_{FN} \\pi \\mathrm{FNR}(z_{\\ast})\n$$\n$$\nE[\\text{Cost}(z_{\\ast})] = C_{FP} (1-\\pi) \\mathrm{FPR}(z_{\\ast}) + C_{FN} \\pi (1 - \\mathrm{TPR}(z_{\\ast}))\n$$\n问题要求证明与$C_{FN}=1$和$C_{FP} = w \\equiv \\frac{p_{t}}{1-p_{t}}$的等价性。代入这些成本：\n$$\nE[\\text{Cost}(z_{\\ast})] = \\frac{p_{t}}{1-p_{t}} (1-\\pi) \\mathrm{FPR}(z_{\\ast}) + 1 \\cdot \\pi (1 - \\mathrm{TPR}(z_{\\ast}))\n$$\n$$\nE[\\text{Cost}(z_{\\ast})] = \\pi - \\left( \\pi \\mathrm{TPR}(z_{\\ast}) - \\frac{p_{t}}{1-p_{t}} (1-\\pi) \\mathrm{FPR}(z_{\\ast}) \\right)\n$$\n$$\nE[\\text{Cost}(z_{\\ast})] = \\pi - \\mathrm{NB}(p_{t}; z_{\\ast})\n$$\n由于$\\pi$是相对于阈值$z_{\\ast}$选择的常数，最小化期望成本$E[\\text{Cost}(z_{\\ast})]$等价于最大化净收益$\\mathrm{NB}(p_{t}; z_{\\ast})$。这就建立了所要求的等价关系。\n\n接下来，我们从第一性原理推导最优阈值$z_{\\ast}$。根据贝叶斯决策理论，最优规则是选择使后验期望成本最小化的类别。对于任何给定的分数$z$，如果我们预测类别1的期望成本小于预测类别0的期望成本，我们就预测为类别1。\n\n$\\text{Cost}(\\text{predict } 1 \\mid z) = 0 \\cdot P(Y=1 \\mid z) + C_{FP} \\cdot P(Y=0 \\mid z) = C_{FP} P(Y=0 \\mid z)$\n$\\text{Cost}(\\text{predict } 0 \\mid z) = C_{FN} \\cdot P(Y=1 \\mid z) + 0 \\cdot P(Y=0 \\mid z) = C_{FN} P(Y=1 \\mid z)$\n\n如果$\\text{Cost}(\\text{predict } 1 \\mid z)  \\text{Cost}(\\text{predict } 0 \\mid z)$，则预测为类别1：\n$$\nC_{FP} P(Y=0 \\mid z)  C_{FN} P(Y=1 \\mid z)\n$$\n使用贝叶斯法则，$P(Y=k \\mid z) = \\frac{p(z \\mid Y=k) P(Y=k)}{p(z)}$，上式变为：\n$$\nC_{FP} p(z \\mid Y=0) (1-\\pi)  C_{FN} p(z \\mid Y=1) \\pi\n$$\n整理后得到似然比检验：如果满足以下条件，则预测为类别1\n$$\n\\frac{p(z \\mid Y=1)}{p(z \\mid Y=0)} > \\frac{C_{FP} (1-\\pi)}{C_{FN} \\pi}\n$$\n最优阈值$z_{\\ast}$在等式成立处取得。代入$C_{FN}=1$和$C_{FP} = \\frac{p_{t}}{1-p_{t}}$：\n$$\n\\frac{p(z_{\\ast} \\mid Y=1)}{p(z_{\\ast} \\mid Y=0)} = \\frac{\\frac{p_{t}}{1-p_{t}} (1-\\pi)}{1 \\cdot \\pi} = \\frac{p_t}{1-p_t} \\frac{1-\\pi}{\\pi}\n$$\n问题陈述，分数$z$的类条件分布是等方差的高斯分布：\n$p(z \\mid Y=1) = \\mathcal{N}(\\mu_1, \\sigma^2)$ 且 $p(z \\mid Y=0) = \\mathcal{N}(\\mu_0, \\sigma^2)$。似然比为：\n$$\n\\frac{p(z \\mid Y=1)}{p(z \\mid Y=0)} = \\frac{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(z-\\mu_1)^2}{2\\sigma^2}\\right)}{\\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(z-\\mu_0)^2}{2\\sigma^2}\\right)} = \\exp\\left(\\frac{(z-\\mu_0)^2 - (z-\\mu_1)^2}{2\\sigma^2}\\right)\n$$\n指数部分简化为：\n$(z^2 - 2z\\mu_0 + \\mu_0^2) - (z^2 - 2z\\mu_1 + \\mu_1^2) = 2z(\\mu_1 - \\mu_0) - (\\mu_1^2 - \\mu_0^2) = (\\mu_1 - \\mu_0)(2z - (\\mu_1 + \\mu_0))$。\n对阈值方程两边取自然对数：\n$$\n\\ln\\left( \\frac{p(z_{\\ast} \\mid Y=1)}{p(z_{\\ast} \\mid Y=0)} \\right) = \\frac{(\\mu_1 - \\mu_0)(2z_{\\ast} - (\\mu_1 + \\mu_0))}{2\\sigma^2} = \\ln\\left(\\frac{p_t}{1-p_t} \\frac{1-\\pi}{\\pi}\\right)\n$$\n我们求解$z_{\\ast}$：\n$$\n2z_{\\ast} - (\\mu_1 + \\mu_0) = \\frac{2\\sigma^2}{\\mu_1 - \\mu_0} \\ln\\left(\\frac{p_t(1-\\pi)}{\\pi(1-p_t)}\\right)\n$$\n$$\n2z_{\\ast} = (\\mu_1 + \\mu_0) + \\frac{2\\sigma^2}{\\mu_1 - \\mu_0} \\left[ \\ln\\left(\\frac{p_t}{1-p_t}\\right) - \\ln\\left(\\frac{\\pi}{1-\\pi}\\right) \\right]\n$$\n$$\nz_{\\ast} = \\frac{\\mu_0 + \\mu_1}{2} + \\frac{\\sigma^2}{\\mu_1 - \\mu_0} \\left[ \\ln\\left(\\frac{p_t}{1-p_t}\\right) - \\ln\\left(\\frac{\\pi}{1-\\pi}\\right) \\right]\n$$\n这就是用给定参数表示的分数$z$的最优阈值。\n\n### 第2部分：数值计算\n\n第二个任务是根据具体参数计算$z_{\\ast}$的值：$\\pi = 0.04$, $p_t = 0.1$, $\\mu_1 = 1.2$, $\\mu_0 = -0.3$, and $\\sigma = 0.9$。\n\n首先，我们计算$z_{\\ast}$公式的各个组成部分：\n$\\mu_0 + \\mu_1 = -0.3 + 1.2 = 0.9$\n$\\mu_1 - \\mu_0 = 1.2 - (-0.3) = 1.5$\n$\\sigma^2 = (0.9)^2 = 0.81$\n中点项为 $\\frac{\\mu_0 + \\mu_1}{2} = \\frac{0.9}{2} = 0.45$。\n\n接下来，我们计算对数项：\n决策阈值$p_t$的几率为 $\\frac{p_t}{1-p_t} = \\frac{0.1}{1-0.1} = \\frac{0.1}{0.9} = \\frac{1}{9}$。\n流行率$\\pi$的几率为 $\\frac{\\pi}{1-\\pi} = \\frac{0.04}{1-0.04} = \\frac{0.04}{0.96} = \\frac{4}{96} = \\frac{1}{24}$。\n\n对数几率的差为：\n$$\n\\ln\\left(\\frac{p_t}{1-p_t}\\right) - \\ln\\left(\\frac{\\pi}{1-\\pi}\\right) = \\ln\\left(\\frac{1}{9}\\right) - \\ln\\left(\\frac{1}{24}\\right) = \\ln\\left(\\frac{1/9}{1/24}\\right) = \\ln\\left(\\frac{24}{9}\\right) = \\ln\\left(\\frac{8}{3}\\right)\n$$\n\n现在，我们计算调整项：\n$$\n\\frac{\\sigma^2}{\\mu_1 - \\mu_0} \\ln\\left(\\frac{8}{3}\\right) = \\frac{0.81}{1.5} \\ln\\left(\\frac{8}{3}\\right) = 0.54 \\ln\\left(\\frac{8}{3}\\right)\n$$\n使用$\\ln(8/3) \\approx 0.98082925$的值：\n$$\n0.54 \\times 0.98082925 \\approx 0.529647795\n$$\n\n最后，我们合并这些项以求得$z_{\\ast}$：\n$$\nz_{\\ast} = 0.45 + 0.529647795 = 0.979647795\n$$\n问题要求答案保留四位有效数字。\n$$\nz_{\\ast} \\approx 0.9796\n$$", "answer": "$$\n\\boxed{0.9796}\n$$", "id": "4973582"}]}