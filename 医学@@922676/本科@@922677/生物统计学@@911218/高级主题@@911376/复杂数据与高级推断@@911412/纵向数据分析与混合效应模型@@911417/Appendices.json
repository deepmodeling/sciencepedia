{"hands_on_practices": [{"introduction": "混合效应模型的核心优势在于其能够将总变异分解为不同来源。此练习将引导您从最基本的随机截距模型出发，运用第一性原理推导出组内（within-subject）和组间（between-subject）的变异，从而深刻理解模型如何捕捉数据的相关性结构。通过完成这个推导，您将掌握总方差和组内相关系数（Intraclass Correlation Coefficient, ICC）的计算，这是理解和解释任何混合模型结果的基础。[@problem_id:4924237]", "problem": "一项生物统计学研究在 $t \\in \\{1,\\dots,T\\}$ 的访视时间点，对由 $i \\in \\{1,\\dots,N\\}$ 索引的受试者重复测量一种稳定的生物标志物（例如，基线血清白蛋白）。为了捕捉受试者间的异质性和受试者内的测量噪声，考虑以下用于纵向结果的随机截距线性混合效应模型（Linear Mixed-Effects Model (LMM)）：\n$$\ny_{it} \\;=\\; \\beta_0 \\;+\\; b_i \\;+\\; \\epsilon_{it},\n$$\n其中 $\\beta_0$ 是一个固定截距，$b_i$ 是一个受试者特定的随机效应，且 $b_i \\sim N(0,\\sigma_b^2)$，$\\epsilon_{it}$ 是受试者内的误差，且 $\\epsilon_{it} \\sim N(0,\\sigma^2)$。假设 $\\{b_i\\}$ 在不同受试者之间是独立的，$\\{\\epsilon_{it}\\}$ 在不同受试者和不同时间点之间是独立的，并且对于所有的 $i$ 和 $t$，$b_i$ 和 $\\epsilon_{it}$ 是独立的。\n\n仅使用核心概率定义以及独立随机变量之和的方差、协方差和相关性性质，推导当 $t \\neq s$ 时 $\\operatorname{Var}(y_{it})$ 和 $\\operatorname{Corr}(y_{it}, y_{is})$ 的表达式。用 $\\sigma_b^2$ 和 $\\sigma^2$ 的符号形式表示您的最终答案。无需四舍五入。", "solution": "用户提供了一个问题陈述，要求推导一个随机截距线性混合效应模型中结果的方差和相关性。\n\n首先，对问题陈述进行验证。\n\n**第一步：提取已知条件**\n- 纵向结果 $y_{it}$ 的模型是：\n$$\ny_{it} \\;=\\; \\beta_0 \\;+\\; b_i \\;+\\; \\epsilon_{it}\n$$\n- $i \\in \\{1,\\dots,N\\}$ 索引受试者。\n- $t \\in \\{1,\\dots,T\\}$ 索引访视时间点。\n- $\\beta_0$ 是一个固定截距（一个常数）。\n- $b_i$ 是一个受试者特定的随机效应，其分布为 $b_i \\sim N(0,\\sigma_b^2)$。\n- $\\epsilon_{it}$ 是受试者内的误差，其分布为 $\\epsilon_{it} \\sim N(0,\\sigma^2)$。\n- 独立性假设：\n  1. $\\{b_i\\}$ 在不同受试者 $i$ 之间是独立的。\n  2. $\\{\\epsilon_{it}\\}$ 在不同受试者 $i$ 和不同时间点 $t$ 之间是独立的。\n  3. 对于所有的 $i$ 和 $t$，$b_i$ 和 $\\epsilon_{it}$ 是独立的。\n- 任务是推导当 $t \\neq s$ 时 $\\operatorname{Var}(y_{it})$ 和 $\\operatorname{Corr}(y_{it}, y_{is})$ 的表达式。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题基于一个标准的随机截距线性混合效应模型，这是生物统计学中分析纵向数据的基本工具。该模型及其假设是标准的且科学合理的。\n- **适定性：** 该问题是适定的。它清晰地定义了模型、其参数以及分布假设。它要求推导可以从所提供信息中唯一导出的特定量（$\\operatorname{Var}(y_{it})$ 和 $\\operatorname{Corr}(y_{it}, y_{is})$）。\n- **客观性：** 该问题使用精确、客观的数学和统计语言陈述，没有任何主观性或歧义。\n- 该问题不违反任何无效性标准。它是一个完整、一致且可形式化的统计问题。\n\n**第三步：结论与行动**\n该问题有效。现在开始推导解答。\n\n**$\\operatorname{Var}(y_{it})$ 的推导**\n\n结果 $y_{it}$ 的方差定义为 $\\operatorname{Var}(y_{it})$。我们将 $y_{it}$ 的模型定义代入：\n$$\n\\operatorname{Var}(y_{it}) = \\operatorname{Var}(\\beta_0 + b_i + \\epsilon_{it})\n$$\n常数的方差为零，所以 $\\operatorname{Var}(\\beta_0) = 0$。给随机变量加上一个常数不会改变其方差。因此，\n$$\n\\operatorname{Var}(y_{it}) = \\operatorname{Var}(b_i + \\epsilon_{it})\n$$\n方差的一个核心性质是，对于两个独立的随机变量 $X$ 和 $Y$，$\\operatorname{Var}(X+Y) = \\operatorname{Var}(X) + \\operatorname{Var}(Y)$。问题陈述指明随机截距 $b_i$ 和误差项 $\\epsilon_{it}$ 是独立的。因此，我们可以写出：\n$$\n\\operatorname{Var}(y_{it}) = \\operatorname{Var}(b_i) + \\operatorname{Var}(\\epsilon_{it})\n$$\n根据问题陈述，我们已知 $b_i$ 和 $\\epsilon_{it}$ 的方差：\n$$\n\\operatorname{Var}(b_i) = \\sigma_b^2\n$$\n$$\n\\operatorname{Var}(\\epsilon_{it}) = \\sigma^2\n$$\n将这些代入 $\\operatorname{Var}(y_{it})$ 的表达式，得到：\n$$\n\\operatorname{Var}(y_{it}) = \\sigma_b^2 + \\sigma^2\n$$\n该表达式表示一个观测值的总方差，它是受试者间方差（$\\sigma_b^2$）和受试者内方差（$\\sigma^2$）之和。\n\n**当 $t \\neq s$ 时 $\\operatorname{Corr}(y_{it}, y_{is})$ 的推导**\n\n两个随机变量 $X$ 和 $Y$ 之间的相关性定义为：\n$$\n\\operatorname{Corr}(X, Y) = \\frac{\\operatorname{Cov}(X, Y)}{\\sqrt{\\operatorname{Var}(X)\\operatorname{Var}(Y)}}\n$$\n在我们的例子中，我们需要求出在两个不同时间点 $t$ 和 $s$（其中 $t \\neq s$）对同一受试者 $i$ 进行的两次测量 $y_{it}$ 和 $y_{is}$ 之间的相关性。\n$$\n\\operatorname{Corr}(y_{it}, y_{is}) = \\frac{\\operatorname{Cov}(y_{it}, y_{is})}{\\sqrt{\\operatorname{Var}(y_{it})\\operatorname{Var}(y_{is})}}\n$$\n首先，我们推导分子中的协方差项 $\\operatorname{Cov}(y_{it}, y_{is})$。我们代入模型定义：\n$$\n\\operatorname{Cov}(y_{it}, y_{is}) = \\operatorname{Cov}(\\beta_0 + b_i + \\epsilon_{it}, \\; \\beta_0 + b_i + \\epsilon_{is})\n$$\n利用协方差的双线性性质，并知道常数与任何随机变量的协方差为零，我们可以展开此表达式：\n$$\n\\operatorname{Cov}(y_{it}, y_{is}) = \\operatorname{Cov}(b_i, b_i) + \\operatorname{Cov}(b_i, \\epsilon_{is}) + \\operatorname{Cov}(\\epsilon_{it}, b_i) + \\operatorname{Cov}(\\epsilon_{it}, \\epsilon_{is})\n$$\n我们根据给定的假设来计算每一项：\n1.  $\\operatorname{Cov}(b_i, b_i) = \\operatorname{Var}(b_i) = \\sigma_b^2$。\n2.  $\\operatorname{Cov}(b_i, \\epsilon_{is})$：问题陈述指出，对于所有的 $t'$，$b_i$ 都与 $\\epsilon_{it'}$ 独立。由于 $s$ 是一个特定的时间点，$b_i$ 和 $\\epsilon_{is}$ 是独立的。独立随机变量的协方差为零。因此，$\\operatorname{Cov}(b_i, \\epsilon_{is}) = 0$。\n3.  $\\operatorname{Cov}(\\epsilon_{it}, b_i)$：同样，由于独立性，此项为零。\n4.  $\\operatorname{Cov}(\\epsilon_{it}, \\epsilon_{is})$：问题陈述指出，误差项 $\\{\\epsilon_{it'}\\}$ 在不同时间点之间是独立的。由于 $t \\neq s$，随机变量 $\\epsilon_{it}$ 和 $\\epsilon_{is}$ 是独立的。因此它们的协方差为零。\n\n将这些结果代回协方差表达式：\n$$\n\\operatorname{Cov}(y_{it}, y_{is}) = \\sigma_b^2 + 0 + 0 + 0 = \\sigma_b^2\n$$\n同一受试者在不同时间点的两次测量之间的协方差等于受试者间方差。这是因为 $y_{it}$ 和 $y_{is}$ 之间的共享成分是受试者特定的随机截距 $b_i$。\n\n接下来，我们计算相关性公式的分母。我们已经推导出 $\\operatorname{Var}(y_{it}) = \\sigma_b^2 + \\sigma^2$。$y_{is}$ 的方差可以通过相同的逻辑得出：\n$$\n\\operatorname{Var}(y_{is}) = \\operatorname{Var}(\\beta_0 + b_i + \\epsilon_{is}) = \\operatorname{Var}(b_i) + \\operatorname{Var}(\\epsilon_{is}) = \\sigma_b^2 + \\sigma^2\n$$\n所以，分母是：\n$$\n\\sqrt{\\operatorname{Var}(y_{it})\\operatorname{Var}(y_{is})} = \\sqrt{(\\sigma_b^2 + \\sigma^2)(\\sigma_b^2 + \\sigma^2)} = \\sigma_b^2 + \\sigma^2\n$$\n最后，我们组合出相关性表达式：\n$$\n\\operatorname{Corr}(y_{it}, y_{is}) = \\frac{\\sigma_b^2}{\\sigma_b^2 + \\sigma^2}\n$$\n这个量是组内相关系数（ICC）。它表示总方差中可归因于受试者间变异的比例。", "answer": "$$\n\\boxed{\\operatorname{Var}(y_{it}) = \\sigma_b^2 + \\sigma^2, \\quad \\operatorname{Corr}(y_{it}, y_{is}) = \\frac{\\sigma_b^2}{\\sigma_b^2 + \\sigma^2}}\n$$", "id": "4924237"}, {"introduction": "在理论学习之后，下一步是学习如何将一个实际的研究设计转化为模型所需的数学形式。本练习提供了一个具体场景，要求您为包含基线和时依协变量的随机截距和斜率模型构建固定效应和随机效应的设计矩阵（分别为 $X$ 和 $Z$）。通过对协变量进行中心化和分解等操作，您将亲身体验如何通过严谨的编码来避免共线性问题，并确保模型参数的可解释性，这是连接理论与数据分析实践的关键一步。[@problem_id:4924264]", "problem": "一项队列研究跟踪三名参与者，每名参与者在三个等距时间点进行测量，时间指数为 $t \\in \\{0,1,2\\}$。连续响应 $y_{it}$（参与者 $i$ 在时间点 $t$ 的响应）使用带有随机截距和时间随机斜率的线性混合效应（LME）模型进行建模。模型包含一个基线协变量（参与者的基线年龄）和一个时变协变量（体重）。\n\n数据：\n- 参与者：$i \\in \\{1,2,3\\}$；每位参与者的时间点：$t \\in \\{0,1,2\\}$。\n- 时间（单位：年）：$t = 0, 1, 2$。\n- 基线年龄（单位：年）：参与者 1：$48$，参与者 2：$55$，参与者 3：$62$。\n- 各时间点的体重（单位：公斤）：\n  - 参与者 1：在 $t=(0,1,2)$ 时为 $(78, 83, 85)$。\n  - 参与者 2：在 $t=(0,1,2)$ 时为 $(74, 78, 79)$。\n  - 参与者 3：在 $t=(0,1,2)$ 时为 $(73, 74, 78)$。\n\n你需要为一个随机截距和随机斜率模型构建固定效应设计矩阵 $X$ 和随机效应设计矩阵 $Z$，并通过原则性编码避免不必要的共線性。仅使用基本定义来证明你的编码选择是合理的。具体而言：\n- 将时间在研究中点处中心化，即使用 $t_{c} = t - 1$。\n- 将时变协变量 $w_{it}$（体重）分解为参与者内部分量和参与者间分量，分解方式为 $w_{it} = \\big(w_{it} - \\bar{w}_{i}\\big) + \\big(\\bar{w}_{i} - \\bar{w}\\big)$，其中 $\\bar{w}_{i}$ 是参与者特定时间内观测值的均值，$\\bar{w}$ 是所有参与者的 $\\bar{w}_{i}$ 值的总均值。\n- 将基线年龄按样本均值中心化。\n\n设固定效应部分包括一个截距、中心化的时间 $t_{c}$、中心化的基线年龄、参与者内部的体重分量以及参与者之间的体重分量。设随机效应部分包括每个参与者的随机截距和关于 $t_{c}$ 的随机斜率。\n\n相应地构建 $X$ 和 $Z$。然后，使用你构建的 $X$ 计算 $X^{\\top}X$ 的行列式。提供精确的整数值，无需四舍五入。", "solution": "用户要求我验证问题陈述的有效性，如果有效，则为一个指定的线性混合效应（LME）模型构建固定效应和随机效应设计矩阵，并计算 $X^{\\top}X$ 的行列式。\n\n### 步骤 1：提取已知条件\n- **模型类型**：带有随机截距和时间随机斜率的线性混合效应（LME）模型。\n- **参与者**：$i \\in \\{1, 2, 3\\}$。\n- **时间点**：$t \\in \\{0, 1, 2\\}$，等距。\n- **响应**：$y_{it}$ 是参与者 $i$ 在时间点 $t$ 的连续响应。\n- **基线协变量**：基线年龄。\n  - 参与者 1：$48$ 岁。\n  - 参与者 2：$55$ 岁。\n  - 参与者 3：$62$ 岁。\n- **时变协变量**：体重，$w_{it}$。\n  - 参与者 1：在 $t=(0,1,2)$ 时为 $(78, 83, 85)$ 公斤。\n  - 参与者 2：在 $t=(0,1,2)$ 时为 $(74, 78, 79)$ 公斤。\n  - 参与者 3：在 $t=(0,1,2)$ 时为 $(73, 74, 78)$ 公斤。\n- **固定效应的编码说明**：\n  - 模型包含一个固定截距。\n  - 时间在研究中点处中心化：$t_c = t - 1$。\n  - 基线年龄按样本均值中心化。\n  - 体重 ($w_{it}$) 被分解为两个分量：\n    1. 参与者内：$w_{it} - \\bar{w}_{i}$，其中 $\\bar{w}_{i}$ 是参与者 $i$ 的平均体重。\n    2. 参与者间：$\\bar{w}_{i} - \\bar{w}$，其中 $\\bar{w}$ 是所有 $\\bar{w}_{i}$ 值的总均值。\n- **随机效应的编码说明**：\n  - 每个参与者的随机截距。\n  - 每个参与者关于中心化时间 ($t_c$) 的随机斜率。\n- **任务**：\n  1. 构建固定效应设计矩阵 $X$。\n  2. 构建随机效应设计矩阵 $Z$。\n  3. 计算 $X^{\\top}X$ 的行列式。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学性**：该问题描述了一个标准 LME 模型的设置，这是生物统计学中分析纵向数据时无处不在的基础工具。中心化和协变量分解的使用是提高模型稳定性和可解释性的既定最佳实践。所有方面都与已建立的统计理论一致。\n- **良态性**：构建矩阵 $X$ 和 $Z$ 的指令精确且明确。所提供的数据完整且足以执行所需计算。求解 $X^{\\top}X$ 的行列式是一项明确定义的数学运算，将产生唯一答案。\n- **客观性**：问题以精确、技术性的语言陈述，不含主观性或意见。\n- **缺陷总结**：\n  - 科学或事实不准确：无。\n  - 不可形式化或不相关：无。该问题与生物统计学直接相关且可形式化。\n  - 不完整或矛盾的设置：无。\n  - 不切实际或不可行：无。\n  - 病态或结构不良：无。\n  - 伪深刻、琐碎或同义反复：无。\n  - 超出科学可验证范围：无。\n\n### 步骤 3：结论与行动\n问题有效。我将继续进行完整解答。\n\nLME 模型指定为 $Y = X\\beta + Zb + \\epsilon$，其中 $X$ 是固定效应设计矩阵，$Z$ 是随机效应设计矩阵。我们必须根据提供的数据和编码规则构建这些矩阵。数据按参与者排序，在每个参与者内部按时间排序。共有 $N=9$ 个观测值（3 名参与者 × 3 个时间点）。\n\n首先，我们计算必要的派生协变量。\n\n1.  **中心化时间 ($t_c$)**：\n    对于 $t \\in \\{0, 1, 2\\}$，中心化时间为 $t_c = t - 1$。对于每个参与者，此向量为 $(-1, 0, 1)$。\n\n2.  **中心化基线年龄**：\n    平均基线年龄为 $\\bar{\\text{age}} = \\frac{48 + 55 + 62}{3} = \\frac{165}{3} = 55$ 岁。\n    参与者 1, 2, 3 的中心化年龄为：\n    - 参与者 1：$48 - 55 = -7$\n    - 参与者 2：$55 - 55 = 0$\n    - 参与者 3：$62 - 55 = 7$\n    对于来自同一参与者的所有观测，该值是恒定的。\n\n3.  **分解的体重协变量 ($w_{it}$)**：\n    - **参与者特定平均体重 ($\\bar{w}_i$)**：\n      - $\\bar{w}_1 = \\frac{78 + 83 + 85}{3} = \\frac{246}{3} = 82$ 公斤。\n      - $\\bar{w}_2 = \\frac{74 + 78 + 79}{3} = \\frac{231}{3} = 77$ 公斤。\n      - $\\bar{w}_3 = \\frac{73 + 74 + 78}{3} = \\frac{225}{3} = 75$ 公斤。\n    - **平均体重的总均值 ($\\bar{w}$)**：\n      - $\\bar{w} = \\frac{82 + 77 + 75}{3} = \\frac{234}{3} = 78$ 公斤。\n    - **参与者间分量 ($\\bar{w}_i - \\bar{w}$)**：\n      - 参与者 1：$82 - 78 = 4$。\n      - 参与者 2：$77 - 78 = -1$。\n      - 参与者 3：$75 - 78 = -3$。\n    - **参与者内分量 ($w_{it} - \\bar{w}_i$)**：\n      - 参与者 1：$(78-82, 83-82, 85-82) = (-4, 1, 3)$。\n      - 参与者 2：$(74-77, 78-77, 79-77) = (-3, 1, 2)$。\n      - 参与者 3：$(73-75, 74-75, 78-75) = (-2, -1, 3)$。\n\n现在，我们构建设计矩阵。\n\n**固定效应设计矩阵 ($X$)**\n$X$ 的列对应于固定效应：$(1)$ 截距，$(2)$ 中心化时间 $t_c$，$(3)$ 中心化年龄，$(4)$ 参与者内体重，和 $(5)$ 参与者间体重。矩阵 $X$ 是一个 $9 \\times 5$ 的矩阵。\n$$\nX =\n\\begin{pmatrix}\n1  -1  -7  -4  4 \\\\\n1  0  -7  1  4 \\\\\n1  1  -7  3  4 \\\\\n1  -1  0  -3  -1 \\\\\n1  0  0  1  -1 \\\\\n1  1  0  2  -1 \\\\\n1  -1  7  -2  -3 \\\\\n1  0  7  -1  -3 \\\\\n1  1  7  3  -3\n\\end{pmatrix}\n$$\n\n**随机效应设计矩阵 ($Z$)**\n随机效应是每个 3 名参与者的随机截距和关于 $t_c$ 的随机斜率。$Z$ 是一个大小为 $9 \\times (3 \\times 2) = 9 \\times 6$ 的块对角矩阵。每个块 $Z_i$ 是一个 $3 \\times 2$ 的矩阵，用于参与者 $i$，列为截距和 $t_c$。\n$$\nZ_1 = Z_2 = Z_3 = \\begin{pmatrix} 1  -1 \\\\ 1  0 \\\\ 1  1 \\end{pmatrix}\n$$\n所以，完整的矩阵 $Z$ 是：\n$$\nZ =\n\\begin{pmatrix}\nZ_1  0  0 \\\\\n0  Z_2  0 \\\\\n0  0  Z_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n1  -1  0  0  0  0 \\\\\n1  0  0  0  0  0 \\\\\n1  1  0  0  0  0 \\\\\n0  0  1  -1  0  0 \\\\\n0  0  1  0  0  0 \\\\\n0  0  1  1  0  0 \\\\\n0  0  0  0  1  -1 \\\\\n0  0  0  0  1  0 \\\\\n0  0  0  0  1  1\n\\end{pmatrix}\n$$\n\n**计算 $X^{\\top}X$ 的行列式**\n我们首先计算 $5 \\times 5$ 矩阵 $X^{\\top}X$。第 $(j,k)$ 个元素是 $X$ 的第 $j$ 列和第 $k$ 列的点积。设各列为 $x_1, x_2, x_3, x_4, x_5$。\n由于中心化，许多交叉乘积项为零。例如，$\\sum_i \\sum_t t_{cit} = 0$, $\\sum_i \\sum_t (\\text{age}_i-\\overline{\\text{age}}) = 0$, $\\sum_i \\sum_t (w_{it}-\\bar{w}_i) = 0$, 以及 $\\sum_i \\sum_t (\\bar{w}_i-\\bar{w}) = 0$。这种正交性意味着截距列 $x_1$ 与任何其他列的点积为 $0$。\n类似地，按块正交的协变量之间的点积为零（例如，$x_2^\\top x_3=0, x_2^\\top x_5=0, x_3^\\top x_4=0, x_4^\\top x_5=0$）。\n非零点积是：\n- $x_1^\\top x_1 = \\sum 1^2 = 9$。\n- $x_2^\\top x_2 = \\sum t_c^2 = 3 \\times ((-1)^2 + 0^2 + 1^2) = 3 \\times 2 = 6$。\n- $x_3^\\top x_3 = \\sum (\\text{age}_c)^2 = 3 \\times (-7)^2 + 3 \\times 0^2 + 3 \\times 7^2 = 3 \\times 49 + 0 + 3 \\times 49 = 294$。\n- $x_4^\\top x_4 = \\sum (w_{it} - \\bar{w}_i)^2 = [(-4)^2+1^2+3^2] + [(-3)^2+1^2+2^2] + [(-2)^2+(-1)^2+3^2] = 26 + 14 + 14 = 54$。\n- $x_5^\\top x_5 = \\sum (\\bar{w}_i - \\bar{w})^2 = 3 \\times 4^2 + 3 \\times (-1)^2 + 3 \\times (-3)^2 = 3 \\times 16 + 3 \\times 1 + 3 \\times 9 = 48 + 3 + 27 = 78$。\n- $x_2^\\top x_4 = \\sum t_c (w_{it}-\\bar{w}_i) = [(-1)(-4)+0(1)+1(3)] + [(-1)(-3)+0(1)+1(2)] + [(-1)(-2)+0(-1)+1(3)] = 7+5+5 = 17$。\n- $x_3^\\top x_5 = \\sum (\\text{age}_c)(\\bar{w}_i-\\bar{w}) = [3(-7)(4)]+[3(0)(-1)]+[3(7)(-3)] = -84 + 0 - 63 = -147$。\n\n所以，矩阵 $X^{\\top}X$ 是：\n$$\nX^{\\top}X =\n\\begin{pmatrix}\n9  0  0  0  0 \\\\\n0  6  0  17  0 \\\\\n0  0  294  0  -147 \\\\\n0  17  0  54  0 \\\\\n0  0  -147  0  78\n\\end{pmatrix}\n$$\n这个矩阵可以通过同时交换行和列来重新排列成一个块对角矩阵，而不会改变其行列式。\n$$\n\\begin{pmatrix}\n9  0  0  0  0 \\\\\n0  6  17  0  0 \\\\\n0  17  54  0  0 \\\\\n0  0  0  294  -147 \\\\\n0  0  0  -147  78\n\\end{pmatrix}\n$$\n行列式是对角块行列式的乘积。\n- 块 1: $\\det( [9] ) = 9$。\n- 块 2: $\\det \\begin{pmatrix} 6  17 \\\\ 17  54 \\end{pmatrix} = (6)(54) - (17)(17) = 324 - 289 = 35$。\n- 块 3: $\\det \\begin{pmatrix} 294  -147 \\\\ -147  78 \\end{pmatrix}$。注意 $294 = 2 \\times 147$。\n  $$\n  \\det \\begin{pmatrix} 2 \\times 147  -1 \\times 147 \\\\ -147  78 \\end{pmatrix} = (147)(1) \\det \\begin{pmatrix} 2  -1 \\\\ -147  78 \\end{pmatrix} = 147 \\times (2 \\times 78 - (-1) \\times (-147)) = 147 \\times (156 - 147) = 147 \\times 9 = 1323.\n  $$\n\n最后，我们计算 $X^{\\top}X$ 的总行列式：\n$$\n\\det(X^{\\top}X) = 9 \\times 35 \\times 1323 = 315 \\times 1323\n$$\n$$\n315 \\times 1323 = 416745\n$$", "answer": "$$ \\boxed{416745} $$", "id": "4924264"}, {"introduction": "混合效应模型最强大的应用之一是进行个性化预测。本练习旨在展示如何利用模型和一个受试者已有的观测数据，来预测其未来的结果。您将计算随机效应的最佳线性无偏预测（Best Linear Unbiased Predictor, BLUP），并据此得出该受试者在未来特定时间点的预测值。这个过程不仅巩固了您对模型结构的理解，也揭示了混合模型在临床预测和个性化医疗等前沿领域中的巨大价值。[@problem_id:4924243]", "problem": "一项队列研究随时间追踪个体在对数尺度上的一个生物标志物。对于一个固定个体 $i$，假设在时间 $t_{i1} = 0$，$t_{i2} = 1$ 和 $t_{i3} = 3$ 时，其在对数尺度上的数据（无量纲）分别为 $y_{i1} = 10.2$，$y_{i2} = 11.1$ 和 $y_{i3} = 12.9$。分析使用了一个带有随机截距和随机时间斜率的线性混合效应模型（LME）：\n$$\ny_{ij} = \\beta_0 + \\beta_1 t_{ij} + b_{0i} + b_{1i} t_{ij} + \\varepsilon_{ij},\n$$\n其中 $\\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix} \\sim \\mathcal{N}\\!\\left(\\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}, G\\right)$，$\\varepsilon_{ij} \\stackrel{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0,\\sigma^2)$，并且随机效应和残差在观测间独立且相互独立。您可以将以下参数值视为已知：$\\beta_0 = 10.0$，$\\beta_1 = 0.9$，\n$$\nG = \\begin{pmatrix} 0.09  0.015 \\\\ 0.015  0.01 \\end{pmatrix}, \\quad \\sigma^2 = 0.04,\n$$\n且对于受试者 $i$ 的三个过去观测值，$R_i = \\sigma^2 I_{3}$。\n\n仅使用分层高斯模型结构和多元正态分布的条件化标准结果，完成以下任务：\n\n1. 从第一性原理出发，推导在给定过去的数据向量 $y_i = (y_{i1}, y_{i2}, y_{i3})^{\\top}$ 和固定参数 $(\\beta_0,\\beta_1,G,\\sigma^2)$ 的条件下，特定个体随机效应 $\\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix}$ 的条件分布表达式。\n2. 使用第1部分的结果，计算该受试者在新的时间点 $t^* = 2$ 的未来结果 $y_{i,t^*}$ 的条件预测（条件均值）。将您的最终数值答案报告为四位有效数字。不需要物理单位。\n3. 给出一个关于 $y_{i,t^*}$ 的双侧 $(1 - \\alpha)$ 预测区间的公式，该公式应包含随机效应协方差 $G$ 和残差协方差 $R_i$ 的贡献。您的公式应明确说明 $G$ 和 $R_i$ 如何进入预测方差。不要计算数值区间；仅提供以模型分量、$t^*$ 和 $\\alpha$ 表示的解析公式。", "solution": "所提出的问题是线性混合效应模型和多元正态分布理论的一个标准应用。该问题具有科学依据，提法恰当，客观且内部一致。所有必要的参数和数据均已提供。协方差矩阵 $G$ 是对称的，其对角线元素为 $0.09 > 0$ 和 $0.01 > 0$，其行列式为 $\\det(G) = (0.09)(0.01) - (0.015)^2 = 0.0009 - 0.000225 = 0.000675 > 0$，这证实了它是一个正定矩阵，因此是一个有效的协方差矩阵。残差方差 $\\sigma^2 = 0.04$ 也是正的。因此，该问题是有效的，我将继续进行解答。\n\n对于受试者 $i$ 的线性混合效应模型可以写成矩阵形式：\n$$\ny_i = X_i\\beta + Z_ib_i + \\varepsilon_i\n$$\n其中 $y_i$ 是受试者 $i$ 的 $n_i \\times 1$ 观测向量，$X_i$ 是固定效应的 $n_i \\times p$ 设计矩阵，$\\beta$ 是 $p \\times 1$ 固定效应向量，$Z_i$ 是随机效应的 $n_i \\times q$ 设计矩阵，$b_i$ 是 $q \\times 1$ 随机效应向量，$\\varepsilon_i$ 是 $n_i \\times 1$ 残差向量。\n\n根据问题陈述，我们有：\n-   受试者 $i$ 的数据包含 $n_i=3$ 个观测值。结果向量为 $y_i = \\begin{pmatrix} 10.2 \\\\ 11.1 \\\\ 12.9 \\end{pmatrix}$。\n-   测量时间为 $t_{i1} = 0$, $t_{i2} = 1$ 和 $t_{i3} = 3$。\n-   模型包含一个固定截距和一个固定的时间斜率，因此 $\\beta = \\begin{pmatrix} \\beta_0 \\\\ \\beta_1 \\end{pmatrix}$。对应的设计矩阵是 $X_i = \\begin{pmatrix} 1  t_{i1} \\\\ 1  t_{i2} \\\\ 1  t_{i3} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  3 \\end{pmatrix}$。\n-   模型包含一个随机截距和一个随机的时间斜率，因此 $b_i = \\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix}$。对应的设计矩阵是 $Z_i = \\begin{pmatrix} 1  t_{i1} \\\\ 1  t_{i2} \\\\ 1  t_{i3} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  3 \\end{pmatrix}$。\n-   分布由 $b_i \\sim \\mathcal{N}(0, G)$ 和 $\\varepsilon_i \\sim \\mathcal{N}(0, R_i)$ 给出，其中 $G = \\begin{pmatrix} 0.09  0.015 \\\\ 0.015  0.01 \\end{pmatrix}$ 且 $R_i = \\sigma^2 I_3 = 0.04 I_3$。\n\n### 第1部分：随机效应的条件分布\n\n为了找到给定 $y_i$ 时 $b_i$ 的条件分布，我们使用多元正态分布的性质。我们首先建立 $b_i$ 和 $y_i$ 的联合分布。\n模型可以重写为 $y_i - X_i\\beta = Z_ib_i + \\varepsilon_i$。\n我们来考虑随机向量 $b_i$ 和 $y_i$ 的联合分布。\n$b_i$ 的均值为 $E[b_i] = 0$。\n$y_i$ 的均值为 $E[y_i] = E[X_i\\beta + Z_ib_i + \\varepsilon_i] = X_i\\beta + Z_iE[b_i] + E[\\varepsilon_i] = X_i\\beta$。\n$b_i$ 的方差为 $\\text{Var}(b_i) = G$。\n$y_i$ 的方差为 $\\text{Var}(y_i) = \\text{Var}(X_i\\beta + Z_ib_i + \\varepsilon_i) = \\text{Var}(Z_ib_i + \\varepsilon_i)$。由于 $b_i$ 和 $\\varepsilon_i$ 是独立的，所以方差为 $\\text{Var}(Z_ib_i) + \\text{Var}(\\varepsilon_i) = Z_i\\text{Var}(b_i)Z_i^\\top + R_i = Z_iGZ_i^\\top + R_i$。我们用 $V_i$ 表示这个矩阵。\n$b_i$ 和 $y_i$ 之间的协方差为 $\\text{Cov}(b_i, y_i) = \\text{Cov}(b_i, X_i\\beta + Z_ib_i + \\varepsilon_i) = \\text{Cov}(b_i, Z_ib_i) = \\text{Var}(b_i)Z_i^\\top = GZ_i^\\top$。\n所以，联合分布为：\n$$\n\\begin{pmatrix} b_i \\\\ y_i \\end{pmatrix} \\sim \\mathcal{N}\\left( \\begin{pmatrix} 0 \\\\ X_i\\beta \\end{pmatrix}, \\begin{pmatrix} G  GZ_i^\\top \\\\ Z_iG  V_i \\end{pmatrix} \\right)\n$$\n使用多元正态设定中条件分布的标准公式，给定 $y_i$ 时 $b_i$ 的条件分布也是正态的，$b_i | y_i \\sim \\mathcal{N}(\\mu_{b|y}, \\Sigma_{b|y})$，其中：\n-   条件均值：$E[b_i|y_i] = E[b_i] + \\text{Cov}(b_i, y_i) \\text{Var}(y_i)^{-1} (y_i - E[y_i]) = 0 + GZ_i^\\top V_i^{-1} (y_i - X_i\\beta)$。这也被称为随机效应的最佳线性无偏预测（BLUP），记为 $\\hat{b}_i$。\n-   条件方差：$\\text{Var}(b_i|y_i) = \\text{Var}(b_i) - \\text{Cov}(b_i, y_i) \\text{Var}(y_i)^{-1} \\text{Cov}(y_i, b_i) = G - GZ_i^\\top V_i^{-1} Z_iG$。\n\n所以，给定 $y_i$ 时 $\\begin{pmatrix} b_{0i} \\\\ b_{1i} \\end{pmatrix}$ 的条件分布为\n$$\n\\mathcal{N}\\left( GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}(y_i - X_i\\beta), \\quad G - GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}Z_iG \\right)\n$$\n\n### 第2部分：未来结果的条件预测\n\n目标是计算在时间 $t^*=2$ 的一个新观测值的条件预测 $E[y_{i,t^*} | y_i]$。这个新观测值的模型是：\n$$\ny_{i,t^*} = \\beta_0 + \\beta_1 t^* + b_{0i} + b_{1i} t^* + \\varepsilon_{i,t^*} = x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top b_i + \\varepsilon_{i,t^*}\n$$\n其中 $x_{i,t^*} = z_{i,t^*} = \\begin{pmatrix} 1 \\\\ t^* \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix}$。\n条件期望为：\n$$\nE[y_{i,t^*} | y_i] = E[x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top b_i + \\varepsilon_{i,t^*} | y_i]\n$$\n根据期望的线性性质，并注意到 $x_{i,t^*}^\\top\\beta$ 是一个固定量：\n$$\nE[y_{i,t^*} | y_i] = x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top E[b_i | y_i] + E[\\varepsilon_{i,t^*} | y_i]\n$$\n未来的误差 $\\varepsilon_{i,t^*}$ 与过去的数据 $y_i$ 独立，因此 $E[\\varepsilon_{i,t^*} | y_i] = E[\\varepsilon_{i,t^*}] = 0$。\n因此，预测值为 $\\hat{y}_{i,t^*} = x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top \\hat{b}_i$，其中 $\\hat{b}_i = E[b_i | y_i]$ 是在第1部分中推导出的条件均值。\n\n我们现在计算这个值。\n首先，基于固定效应的残差向量：\n$$\ny_i - X_i\\beta = \\begin{pmatrix} 10.2 \\\\ 11.1 \\\\ 12.9 \\end{pmatrix} - \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} 10.0 \\\\ 0.9 \\end{pmatrix} = \\begin{pmatrix} 10.2 \\\\ 11.1 \\\\ 12.9 \\end{pmatrix} - \\begin{pmatrix} 10.0 \\\\ 10.9 \\\\ 12.7 \\end{pmatrix} = \\begin{pmatrix} 0.2 \\\\ 0.2 \\\\ 0.2 \\end{pmatrix}\n$$\n接下来，我们计算 $V_i = Z_iGZ_i^\\top + R_i$：\n$$\nZ_iG = \\begin{pmatrix} 1  0 \\\\ 1  1 \\\\ 1  3 \\end{pmatrix} \\begin{pmatrix} 0.09  0.015 \\\\ 0.015  0.01 \\end{pmatrix} = \\begin{pmatrix} 0.09  0.015 \\\\ 0.105  0.025 \\\\ 0.135  0.045 \\end{pmatrix}\n$$\n$$\nZ_iGZ_i^\\top = \\begin{pmatrix} 0.09  0.015 \\\\ 0.105  0.025 \\\\ 0.135  0.045 \\end{pmatrix} \\begin{pmatrix} 1  1  1 \\\\ 0  1  3 \\end{pmatrix} = \\begin{pmatrix} 0.09  0.105  0.135 \\\\ 0.105  0.130  0.180 \\\\ 0.135  0.180  0.270 \\end{pmatrix}\n$$\n$$\nV_i = Z_iGZ_i^\\top + R_i = \\begin{pmatrix} 0.09  0.105  0.135 \\\\ 0.105  0.130  0.180 \\\\ 0.135  0.180  0.270 \\end{pmatrix} + \\begin{pmatrix} 0.04  0  0 \\\\ 0  0.04  0 \\\\ 0  0  0.04 \\end{pmatrix} = \\begin{pmatrix} 0.13  0.105  0.135 \\\\ 0.105  0.170  0.180 \\\\ 0.135  0.180  0.310 \\end{pmatrix}\n$$\n需要求 $V_i$ 的逆矩阵。计算得出：\n$$\nV_i^{-1} \\approx \\begin{pmatrix} 16.55791  -6.72920  -3.30343 \\\\ -6.72920  18.00571  -7.52447 \\\\ -3.30343  -7.52447  9.03344 \\end{pmatrix}\n$$\n现在我们计算 $\\hat{b}_i = GZ_i^\\top V_i^{-1} (y_i - X_i\\beta)$：\n$$\nV_i^{-1}(y_i - X_i\\beta) \\approx \\begin{pmatrix} 16.55791  -6.72920  -3.30343 \\\\ -6.72920  18.00571  -7.52447 \\\\ -3.30343  -7.52447  9.03344 \\end{pmatrix} \\begin{pmatrix} 0.2 \\\\ 0.2 \\\\ 0.2 \\end{pmatrix} = 0.2 \\begin{pmatrix} 6.52528 \\\\ 3.75204 \\\\ -1.79446 \\end{pmatrix} = \\begin{pmatrix} 1.305056 \\\\ 0.750408 \\\\ -0.358892 \\end{pmatrix}\n$$\n并且 $GZ_i^\\top = (Z_iG)^\\top = \\begin{pmatrix} 0.09  0.105  0.135 \\\\ 0.015  0.025  0.045 \\end{pmatrix}$。\n$$\n\\hat{b}_i = \\begin{pmatrix} 0.09  0.105  0.135 \\\\ 0.015  0.025  0.045 \\end{pmatrix} \\begin{pmatrix} 1.305056 \\\\ 0.750408 \\\\ -0.358892 \\end{pmatrix} \\approx \\begin{pmatrix} 0.117455 + 0.078793 - 0.048450 \\\\ 0.019576 + 0.018760 - 0.016150 \\end{pmatrix} = \\begin{pmatrix} 0.147798 \\\\ 0.022186 \\end{pmatrix}\n$$\n最后，我们计算 $t^*=2$ 时的预测值：\n$$\n\\hat{y}_{i,2} = x_{i,2}^\\top\\beta + z_{i,2}^\\top \\hat{b}_i = \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 10.0 \\\\ 0.9 \\end{pmatrix} + \\begin{pmatrix} 1  2 \\end{pmatrix} \\begin{pmatrix} 0.147798 \\\\ 0.022186 \\end{pmatrix}\n$$\n$$\n\\hat{y}_{i,2} = (10.0 + 1.8) + (0.147798 + 2 \\times 0.022186) = 11.8 + (0.147798 + 0.044372) = 11.8 + 0.19217 = 11.99217\n$$\n四舍五入到四位有效数字，预测值为 $11.99$。\n\n### 第3部分：预测区间公式\n\n$y_{i,t^*}$ 的一个双侧 $(1-\\alpha)$ 预测区间由 $\\hat{y}_{i,t^*} \\pm z_{1-\\alpha/2} \\sqrt{\\text{Var}(y_{i,t^*} - \\hat{y}_{i,t^*})}$ 给出，其中 $z_{1-\\alpha/2}$ 是标准正态分布 $\\mathcal{N}(0,1)$ 的 $(1-\\alpha/2)$-分位数。平方根下的项是预测误差方差。\n预测误差为：\n$$\ny_{i,t^*} - \\hat{y}_{i,t^*} = (x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top b_i + \\varepsilon_{i,t^*}) - (x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top \\hat{b}_i) = z_{i,t^*}^\\top (b_i - \\hat{b}_i) + \\varepsilon_{i,t^*}\n$$\n预测误差的方差是 $\\text{Var}(y_{i,t^*} - \\hat{y}_{i,t^*})$。误差项 $\\varepsilon_{i,t^*}$ 独立于过去的数据 $y_i$，因此也独立于 $\\hat{b}_i=E[b_i|y_i]$。根据模型假设，它也独立于 $b_i$。因此：\n$$\n\\text{Var}(y_{i,t^*} - \\hat{y}_{i,t^*}) = \\text{Var}(z_{i,t^*}^\\top (b_i - \\hat{b}_i)) + \\text{Var}(\\varepsilon_{i,t^*}) = z_{i,t^*}^\\top \\text{Var}(b_i - \\hat{b}_i) z_{i,t^*} + \\sigma^2\n$$\n预测随机效应的误差方差 $\\text{Var}(b_i - \\hat{b}_i)$，等于随机效应的后验方差 $\\text{Var}(b_i|y_i)$，这已在第1部分中推导得出。这是因为在线性高斯模型中，$\\text{Var}(b_i|y_i)$ 不是 $y_i$ 的函数。\n$$\n\\text{Var}(b_i|y_i) = G - GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}Z_iG\n$$\n因此，预测误差方差为：\n$$\n\\text{Var}(y_{i,t^*} - \\hat{y}_{i,t^*}) = z_{i,t^*}^\\top \\left[ G - GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}Z_iG \\right] z_{i,t^*} + \\sigma^2\n$$\n第一项代表预测特定个体轨迹的不确定性（即关于 $b_i$ 的不确定性），这取决于先验随机效应协方差 $G$ 和残差协方差 $R_i$（通过逆矩阵项）。第二项 $\\sigma^2$（$R_i$ 的一个对角元素）是一个新测量值的不确定性。\n$(1-\\alpha)$ 预测区间的完整公式是：\n$$\n\\hat{y}_{i,t^*} \\pm z_{1-\\frac{\\alpha}{2}} \\sqrt{ z_{i,t^*}^\\top \\left( G - GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}Z_iG \\right) z_{i,t^*} + \\sigma^2 }\n$$\n其中 $\\hat{y}_{i,t^*} = x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top GZ_i^\\top(Z_iGZ_i^\\top + R_i)^{-1}(y_i - X_i\\beta)$。", "answer": "$$\n\\boxed{\n\\begin{array}{l}\n\\text{1. } \\mathcal{N}\\left(GZ_i^\\top V_i^{-1}(y_i - X_i\\beta), G - GZ_i^\\top V_i^{-1}Z_iG\\right) \\text{, where } V_i = Z_iGZ_i^\\top + R_i \\\\\n\\text{2. } 11.99 \\\\\n\\text{3. } x_{i,t^*}^\\top\\beta + z_{i,t^*}^\\top GZ_i^\\top V_i^{-1}(y_i - X_i\\beta) \\pm z_{1-\\frac{\\alpha}{2}} \\sqrt{z_{i,t^*}^\\top (G - GZ_i^\\top V_i^{-1}Z_iG) z_{i,t^*} + \\sigma^2}\n\\end{array}\n}\n$$", "id": "4924243"}]}