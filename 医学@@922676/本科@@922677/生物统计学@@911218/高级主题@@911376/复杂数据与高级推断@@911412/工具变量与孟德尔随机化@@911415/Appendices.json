{"hands_on_practices": [{"introduction": "Wald估计量是进入工具变量分析最直观的切入点。它巧妙地将因果效应框定为工具-结局关联与工具-暴露关联的比值。本练习将引导你使用汇总数据直接计算Wald估计值——这是孟德尔随机化中的常见情景，从而巩固IV方法如何校正混杂因素的核心逻辑。[@problem_id:4966574]", "problem": "一名研究者进行了一项单样本孟德尔随机化（MR）研究，旨在使用一个二元遗传变异 $Z \\in \\{0,1\\}$ 作为工具变量（IV），来估计连续暴露变量 $X$ 对连续结局变量 $Y$ 的因果效应。遗传变异 $Z$ 的编码方式为：$Z=1$ 表示效应等位基因的携带者，$Z=0$ 表示非携带者。假设在基础人群中，以下标准IV假设成立：工具变量相关性（$Z$ 与 $X$ 相关）、工具变量独立性（$Z$ 与所有未测量的 $X$ 和 $Y$ 的混杂因素无关）以及排他性限制（$Z$ 对 $Y$ 的影响仅通过 $X$ 发挥作用，没有直接路径）。同时假设单调性（不存在 $Z$ 的增加会导致 $X$ 减少的个体），因此，估计量对应于依从者中的局部平均处理效应。$X$ 和 $Y$ 都在标准化的对数尺度上测量（无量纲），因此任何因果效应都是无量纲的。\n\n给定按 $Z$ 分层的 $X$ 和 $Y$ 的样本均值：\n$$\\bar{Y}_{1}=6,\\quad \\bar{Y}_{0}=4,\\quad \\bar{X}_{1}=3,\\quad \\bar{X}_{0}=2.$$\n仅使用所述假设和因果效应及工具变量的基本定义，推导出一个依赖于按 $Z$ 分组的均值差异的 $X$ 对 $Y$ 的因果效应估计量，并根据所提供的数据计算其数值 $\\hat{\\beta}_{W}$。在所述IV假设和单调性条件下，说明该估计值作为因果效应的解释。提供精确的数值，不要四舍五入。", "solution": "该问题要求在孟德尔随机化（MR）的背景下，使用二元遗传变异 $Z$ 作为工具变量（IV），推导并计算连续暴露变量 $X$ 对连续结局变量 $Y$ 的因果效应的估计量。所提供的数据包括按工具变量 $Z$ 分层的 $X$ 和 $Y$ 的样本均值。\n\n令 $\\beta_{XY}$ 表示 $X$ 对 $Y$ 的因果效应。观察性研究的核心挑战是，由于未测量的混杂因素，对 $Y$ 和 $X$ 进行简单回归可能会得到 $\\beta_{XY}$ 的有偏估计。一个工具变量 $Z$ 允许在一系列假设下识别该因果效应。标准的IV假设如下：\n1.  **相关性**：$Z$ 与 $X$ 相关。形式上，$\\text{Cov}(Z, X) \\neq 0$。\n2.  **独立性（可交换性）**：$Z$ 与任何影响 $X$ 和 $Y$ 的未测量混杂因素 $U$ 独立。形式上，$\\text{Cov}(Z, U) = 0$。\n3.  **排他性限制**：$Z$ 仅通过其对 $X$ 的影响来影响 $Y$。不存在从 $Z$ 到 $Y$ 的直接因果路径。\n\n我们来考虑这些因果关系。工具变量 $Z$ 对结局变量 $Y$ 的总效应可以分解为 $Z$ 对暴露变量 $X$ 的效应，继而是 $X$ 对 $Y$ 的效应。这是排他性限制假设的一个推论。\n\n在一个简化的线性框架中，我们可以如下表示这些关系。工具变量 $Z$ 对暴露变量 $X$ 的效应由以 $Z$ 为条件的 $X$ 的期望值之差给出。我们将 $Z$ 对 $X$ 的群体平均效应表示为 $\\Delta_X$。\n$$ \\Delta_X = E[X | Z=1] - E[X | Z=0] $$\n类似地，工具变量 $Z$ 对结局变量 $Y$ 的效应由以 $Z$ 为条件的 $Y$ 的期望值之差给出。我们将这个群体平均效应表示为 $\\Delta_Y$。\n$$ \\Delta_Y = E[Y | Z=1] - E[Y | Z=0] $$\n排他性限制假设意味着 $Z$ 对 $Y$ 的全部效应都是通过 $X$ 介导的。因此，总效应 $\\Delta_Y$ 可以表示为 $Z$ 对 $X$ 的效应与 $X$ 对 $Y$ 的因果效应的乘积，我们将其表示为 $\\beta_{XY}$。\n$$ \\Delta_Y = \\beta_{XY} \\times \\Delta_X $$\n这个关系是IV估计量的基础。相关性假设确保了 $\\Delta_X \\neq 0$，这是求解 $\\beta_{XY}$ 所必需的。独立性假设确保了 $Z$ 和 $Y$ 之间的关系不受混杂因素影响，从而使 $\\Delta_Y$ 成为 $Z$ 对 $Y$ 总效应的有效度量。\n\n从上面的方程中，我们可以通过代数运算分离出因果效应 $\\beta_{XY}$：\n$$ \\beta_{XY} = \\frac{\\Delta_Y}{\\Delta_X} = \\frac{E[Y | Z=1] - E[Y | Z=0]}{E[X | Z=1] - E[X | Z=0]} $$\n这个比率是在IV假设下因果效应的理论表达式。在实际研究中，我们无法获知真实的群体期望（$E[\\cdot]$）。取而代之的是，我们有样本估计值。我们可以通过用样本均值替代群体期望来构建 $\\beta_{XY}$ 的估计量。这种基于均值差异比率的IV估计量的特定形式被称为Wald估计量。\n\n令 $\\bar{Y}_{z}$ 和 $\\bar{X}_{z}$ 分别为工具变量取值为 $z \\in \\{0, 1\\}$ 的组中 $Y$ 和 $X$ 的样本均值。$\\beta_{XY}$ 的估计量，即问题中表示的 $\\hat{\\beta}_{W}$，由以下公式给出：\n$$ \\hat{\\beta}_{W} = \\frac{\\bar{Y}_{1} - \\bar{Y}_{0}}{\\bar{X}_{1} - \\bar{X}_{0}} $$\n在IV假设成立的条件下，该估计量是因果效应 $\\beta_{XY}$ 的一致估计量。\n\n我们已知以下样本均值：\n- $\\bar{Y}_{1} = 6$（效应等位基因携带者组，$Z=1$，的平均结局）\n- $\\bar{Y}_{0} = 4$（非携带者组，$Z=0$，的平均结局）\n- $\\bar{X}_{1} = 3$（携带者组，$Z=1$，的平均暴露）\n- $\\bar{X}_{0} = 2$（非携带者组，$Z=0$，的平均暴露）\n\n首先，我们可以计算结局变量 $Y$ 的均值差异的样本估计值：\n$$ \\Delta\\bar{Y} = \\bar{Y}_{1} - \\bar{Y}_{0} = 6 - 4 = 2 $$\n接下来，我们计算暴露变量 $X$ 的均值差异的样本估计值：\n$$ \\Delta\\bar{X} = \\bar{X}_{1} - \\bar{X}_{0} = 3 - 2 = 1 $$\n$\\Delta\\bar{X}$ 的非零值（$1 \\neq 0$）为工具变量相关性假设的成立提供了来自样本的经验证据。\n\n现在，我们可以计算Wald估计量 $\\hat{\\beta}_{W}$ 的数值：\n$$ \\hat{\\beta}_{W} = \\frac{\\Delta\\bar{Y}}{\\Delta\\bar{X}} = \\frac{2}{1} = 2 $$\n\n问题还要求对该估计值进行解释。加上单调性假设（即工具变量 $Z$ 不会使任何个体的暴露变量 $X$ 降低），该估计量提供了局部平均处理效应（LATE）的估计。LATE 是指在“依从者”这个亚群中，暴露对结局的平均因果效应。在此背景下，依从者是指其暴露水平 $X$ 受遗传变异 $Z$ 影响且方向符合预期的个体（即，如果他们是效应等位基因的携带者，$Z=1$，他们的 $X$ 值会比他们是非携带者，$Z=0$ 时更高）。因此，$\\hat{\\beta}_{W} = 2$ 被解释为：对于那些其暴露水平对遗传工具变量 $Z$ 敏感的个体，暴露变量 $X$ 每增加1个单位，对结局变量 $Y$ 的平均因果效应的估计值为2。由于 $X$ 和 $Y$ 采用标准化的对数尺度，这对应于在依从者中，对数转换的暴露每增加1个单位，对数转换的结局增加2个单位。", "answer": "$$\n\\boxed{2}\n$$", "id": "4966574"}, {"introduction": "虽然Wald估计量非常适用于单个工具变量，但现实世界中的孟德尔随机化研究通常会利用多个遗传变异来增强统计功效。这需要一种更通用的方法：两阶段最小二乘法（2SLS）。本练习将通过其矩阵代数形式，逐步引导你完成2SLS的计算过程，展示如何整合来自多个工具变量的信息以获得单一的因果效应估计，从而揭开其神秘面纱。[@problem_id:4916902]", "problem": "一项孟德尔随机化（MR）的队列研究使用两个独立的遗传变异作为工具变量，以估计一个连续暴露对一个连续结局的因果效应。设工具变量矩阵 $Z \\in \\mathbb{R}^{4 \\times 2}$ 收集了4个个体中两个单核苷酸多态性（SNPs）的基因型指标，暴露向量 $X \\in \\mathbb{R}^{4 \\times 1}$ 给出了生物标志物水平，结局向量 $Y \\in \\mathbb{R}^{4 \\times 1}$ 给出了疾病严重程度评分。假设所有变量都已进行均值中心化，因此模型设计中不包含截距项。\n\n观测到的数据如下：\n$$\nZ=\\begin{pmatrix}\n1  0 \\\\\n0  1 \\\\\n1  0 \\\\\n0  1\n\\end{pmatrix},\\quad\nX=\\begin{pmatrix}\n2 \\\\\n5 \\\\\n4 \\\\\n7\n\\end{pmatrix},\\quad\nY=\\begin{pmatrix}\n3 \\\\\n10 \\\\\n6 \\\\\n13\n\\end{pmatrix}.\n$$\n\n从工具变量框架和到工具变量空间的投影矩阵的定义出发，计算因果效应的两阶段最小二乘（2SLS）估计量。该估计量可理解为将工具变量处理后的暴露对结局进行回归所得的斜率。使用由 $P_{Z}=Z(Z^{\\top}Z)^{-1}Z^{\\top}$ 定义的投影矩阵 $P_{Z}$ 来获得工具变量处理后的暴露，然后继续计算最终的估计量。将你的最终答案表示为一个精确的分数。无需四舍五入。", "solution": "两阶段最小二乘（2SLS）估计旨在通过使用工具变量来解决内生性问题。该过程分为两个阶段：\n1.  **第一阶段**：将内生暴露变量 $X$ 对工具变量 $Z$ 进行回归，得到 $X$ 的预测值 $\\hat{X}$。这个 $\\hat{X}$ 是 $X$ 中可以由外生工具变量解释的部分。从几何上看，这是将向量 $X$ 投影到由 $Z$ 的列向量张成的子空间上。投影矩阵为 $P_{Z}=Z(Z^{\\top}Z)^{-1}Z^{\\top}$，因此 $\\hat{X} = P_Z X$。\n2.  **第二阶段**：将结局变量 $Y$ 对第一阶段得到的预测值 $\\hat{X}$ 进行回归。由于变量已经均值中心化，这个回归的斜率就是2SLS估计量 $\\hat{\\beta}_{2SLS}$。\n\n现在我们根据提供的数据进行计算。\n首先，计算投影矩阵 $P_Z$ 所需的 $Z^{\\top}Z$ 及其逆矩阵：\n$$\nZ^{\\top}Z = \\begin{pmatrix} 1  0  1  0 \\\\ 0  1  0  1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 2  0 \\\\ 0  2 \\end{pmatrix}\n$$\n$$\n(Z^{\\top}Z)^{-1} = \\begin{pmatrix} 2  0 \\\\ 0  2 \\end{pmatrix}^{-1} = \\begin{pmatrix} 1/2  0 \\\\ 0  1/2 \\end{pmatrix}\n$$\n接下来，我们计算第一阶段的预测暴露值 $\\hat{X}$。我们可以直接计算回归系数 $\\hat{\\pi} = (Z^\\top Z)^{-1}Z^\\top X$ 然后得到 $\\hat{X} = Z\\hat{\\pi}$，或者使用投影矩阵。根据题目要求，我们计算投影后的 $\\hat{X}$:\n$$\n\\hat{X} = Z(Z^\\top Z)^{-1}Z^\\top X = Z \\begin{pmatrix} 1/2  0 \\\\ 0  1/2 \\end{pmatrix} \\begin{pmatrix} 1  0  1  0 \\\\ 0  1  0  1 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 5 \\\\ 4 \\\\ 7 \\end{pmatrix}\n$$\n$$\n\\hat{X} = Z \\begin{pmatrix} 1/2  0 \\\\ 0  1/2 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 12 \\end{pmatrix} = Z \\begin{pmatrix} 3 \\\\ 6 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  1 \\\\ 1  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 6 \\end{pmatrix} = \\begin{pmatrix} 3 \\\\ 6 \\\\ 3 \\\\ 6 \\end{pmatrix}\n$$\n然后，在第二阶段中，我们将 $Y$ 对 $\\hat{X}$ 进行回归。对于无截距的简单回归，2SLS估计量由以下公式给出：\n$$\n\\hat{\\beta}_{2SLS} = (\\hat{X}^{\\top}\\hat{X})^{-1}(\\hat{X}^{\\top}Y) = \\frac{\\hat{X}^{\\top}Y}{\\hat{X}^{\\top}\\hat{X}}\n$$\n我们计算分子和分母：\n$$\n\\hat{X}^{\\top}Y = \\begin{pmatrix} 3  6  3  6 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 10 \\\\ 6 \\\\ 13 \\end{pmatrix} = 3 \\cdot 3 + 6 \\cdot 10 + 3 \\cdot 6 + 6 \\cdot 13 = 9 + 60 + 18 + 78 = 165\n$$\n$$\n\\hat{X}^{\\top}\\hat{X} = \\begin{pmatrix} 3  6  3  6 \\end{pmatrix} \\begin{pmatrix} 3 \\\\ 6 \\\\ 3 \\\\ 6 \\end{pmatrix} = 3^2 + 6^2 + 3^2 + 6^2 = 9 + 36 + 9 + 36 = 90\n$$\n最后，计算2SLS估计量：\n$$\n\\hat{\\beta}_{2SLS} = \\frac{165}{90} = \\frac{11}{6}\n$$", "answer": "$$\n\\boxed{\\frac{11}{6}}\n$$", "id": "4916902"}, {"introduction": "获得因果效应估计值只是成功的一半；我们还必须验证所用工具的质量。在IV分析中，最关键的诊断步骤是评估我们工具变量的“强度”，因为弱工具变量可能导致严重偏倚的结果。本练习将介绍第一阶段F统计量——衡量工具强度的标准指标，并演示如何计算它，以及如何结合潜在偏倚来解释其数值。[@problem_id:4916953]", "problem": "考虑一项孟德尔随机化 (MR) 研究，其中单个遗传变异 $Z$ 被用作暴露 $X$ 的工具变量 (IV)。假设对于个体 $i = 1, \\dots, n$，存在第一阶段线性模型 $X_{i} = \\pi Z_{i} + V_{i}$，其中 $X$ 和 $Z$ 都已经过均值中心化处理，因此不需要截距项。您将从普通最小二乘法和经典平方和分解的基本定义出发，推导用于检验原假设 $H_{0}: \\pi = 0$ 的第一阶段F统计量。\n\n数据集摘要如下：\n- 样本量 $n = 1000$。\n- $\\sum_{i=1}^{n} Z_{i}^{2} = 1000$。\n- $\\sum_{i=1}^{n} X_{i}^{2} = 1000$。\n- $\\sum_{i=1}^{n} Z_{i} X_{i} = 210$。\n\n从最小二乘估计量和残差平方和的定义开始，推导在这个单回归变量、无截距的回归模型中用于检验 $H_{0}: \\pi = 0$ 的第一阶段F统计量，并解释它如何反映工具变量的强度，以及它与两阶段最小二乘估计量相对于普通最小二乘估计量的近似偏差之间的关系。\n\n使用提供的数据集摘要计算F统计量的数值，并将最终答案四舍五入至四位有效数字。无需单位。", "solution": "第一阶段F统计量用于检验工具变量与内生暴露变量之间关联的强度，即检验IV的“相关性”假设。对于无截距的简单线性回归模型 $X_{i} = \\pi Z_{i} + V_{i}$，我们需要检验原假设 $H_{0}: \\pi = 0$。\n\nF统计量定义为回归均方 (MSR) 与误差均方 (MSE) 的比值。对于只有一个预测变量的回归，其形式为：\n$$ F = \\frac{\\text{ESS}/1}{\\text{RSS}/(n-1)} $$\n其中，ESS是解释平方和 (Explained Sum of Squares)，RSS是残差平方和 (Residual Sum of Squares)，$n$是样本量。\n\n首先，我们求出系数 $\\pi$ 的普通最小二乘 (OLS) 估计量 $\\hat{\\pi}$：\n$$ \\hat{\\pi} = \\frac{\\sum_{i=1}^{n} X_{i}Z_{i}}{\\sum_{i=1}^{n} Z_{i}^{2}} $$\nESS是模型所解释的变异，等于预测值的平方和：\n$$ \\text{ESS} = \\sum_{i=1}^{n} (\\hat{\\pi}Z_i)^2 = \\hat{\\pi}^2 \\sum_{i=1}^{n} Z_{i}^{2} = \\left(\\frac{\\sum X_{i}Z_{i}}{\\sum Z_{i}^{2}}\\right)^2 \\sum Z_{i}^{2} = \\frac{(\\sum X_{i}Z_{i})^2}{\\sum Z_{i}^{2}} $$\n总平方和 (TSS) 为 $\\sum X_{i}^{2}$ (因为 $X$ 已中心化)。RSS是模型未解释的变异：\n$$ \\text{RSS} = \\text{TSS} - \\text{ESS} = \\sum X_{i}^{2} - \\frac{(\\sum X_{i}Z_{i})^2}{\\sum Z_{i}^{2}} $$\n将ESS和RSS代入F统计量的公式：\n$$ F = \\frac{\\frac{(\\sum X_{i}Z_{i})^2}{\\sum Z_{i}^{2}} \\cdot (n-1)}{\\sum X_{i}^{2} - \\frac{(\\sum X_{i}Z_{i})^2}{\\sum Z_{i}^{2}}} = \\frac{(n-1) (\\sum X_{i}Z_{i})^2}{(\\sum X_{i}^{2})(\\sum Z_{i}^{2}) - (\\sum X_{i}Z_{i})^2} $$\nF统计量越大，拒绝 $H_0$ 的证据越强，表明工具变量越强。弱工具变量 (通常经验法则是 $F  10$) 会导致2SLS估计量存在严重的有限样本偏倚，使其趋向于有偏的OLS估计量。近似关系表明，2SLS的偏倚与 $1/F$ 成正比，因此高F值是保证MR分析可靠性的关键。\n\n现在，我们代入给定的数据进行计算：\n$n=1000$, $\\sum Z_{i}^{2} = 1000$, $\\sum X_{i}^{2} = 1000$, $\\sum Z_{i} X_{i} = 210$。\n$$ F = \\frac{(1000-1) (210)^2}{(1000)(1000) - (210)^2} = \\frac{999 \\times 44100}{1000000 - 44100} = \\frac{44055900}{955900} \\approx 46.08829 $$\n将结果四舍五入至四位有效数字，得到 $46.09$。这个F值远大于10，表明该遗传变异是一个强工具变量。", "answer": "$$\n\\boxed{46.09}\n$$", "id": "4916953"}]}