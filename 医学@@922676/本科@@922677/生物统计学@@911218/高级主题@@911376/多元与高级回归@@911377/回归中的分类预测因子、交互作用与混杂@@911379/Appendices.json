{"hands_on_practices": [{"introduction": "在回归模型中表示分类预测变量时，我们面临多种编码方案的选择，例如处理编码（treatment coding）和效应编码（effect coding）。这个练习 ([@problem_id:4899207]) 将通过一个具体的数值例子让你亲手验证一个核心原则：尽管不同的编码方案会产生不同数值和解释的回归系数，但模型的整体拟合优度（如 $R^2$）和预测值是保持不变的。这有助于你理解，编码的选择主要影响系数的解释，而非模型的预测能力。", "problem": "一个具有 $K=3$ 个水平的分类预测变量的单因素线性回归模型，通过包含截距项的普通最小二乘法 (OLS) 进行拟合。考虑以下包含 $n=6$ 个独立观测值的数据集，每个观测值恰好属于分类预测变量的三个水平 $L_{1}$、$L_{2}$、$L_{3}$ 中的一个：\n- 观测值 $1$：$y_{1}=4$，水平 $L_{1}$\n- 观测值 $2$：$y_{2}=6$，水平 $L_{1}$\n- 观测值 $3$：$y_{3}=8$，水平 $L_{2}$\n- 观测值 $4$：$y_{4}=10$，水平 $L_{2}$\n- 观测值 $5$：$y_{5}=5$，水平 $L_{3}$\n- 观测值 $6$：$y_{6}=3$，水平 $L_{3}$\n\n从线性模型、最小二乘投影和决定系数的核心定义出发。使用三种不同的满秩编码方案（始终包含截距项）对该因素进行编码，并对每种方案，通过 OLS 拟合模型 $y_{i}=\\boldsymbol{x}_{i}^{\\top}\\boldsymbol{\\beta}+\\varepsilon_{i}$：\n1. 处理（虚拟）编码，以 $L_{1}$ 为参考水平。使用回归量 $\\{1,D_{2},D_{3}\\}$，其中如果观测值属于水平 $L_{k}$，则 $D_{k}=1$，否则为 $0$。\n2. 效应（和为零）编码，使用回归量 $\\{1,E_{1},E_{2}\\}$，由各水平的编码定义：\n   - $L_{1}$：$(E_{1},E_{2})=(-1,-1)$，\n   - $L_{2}$：$(E_{1},E_{2})=(1,0)$，\n   - $L_{3}$：$(E_{1},E_{2})=(0,1)$。\n3. Helmert 编码，使用回归量 $\\{1,H_{1},H_{2}\\}$，由各水平的编码定义：\n   - $L_{1}$：$(H_{1},H_{2})=(-1,-1)$，\n   - $L_{2}$：$(H_{1},H_{2})=(1,-1)$，\n   - $L_{3}$：$(H_{1},H_{2})=(0,2)$。\n\n对每种编码：\n- 计算 OLS 系数向量 $\\boldsymbol{\\beta}$。\n- 计算每个观测值 $i\\in\\{1,\\dots,6\\}$ 的拟合值 $\\hat{y}_{i}$。\n- 计算决定系数（R-squared），其定义为 $R^{2}=1-\\mathrm{SSE}/\\mathrm{SST}$，其中 $\\mathrm{SSE}=\\sum_{i=1}^{n}(y_{i}-\\hat{y}_{i})^{2}$ 且 $\\mathrm{SST}=\\sum_{i=1}^{n}(y_{i}-\\bar{y})^{2}$，$\\bar{y}=\\frac{1}{n}\\sum_{i=1}^{n}y_{i}$。\n\n从第一性原理出发，解释为什么尽管各个系数的解释和数值不同，但拟合值和 $R^{2}$ 在这些满秩编码下保持不变。\n\n报告该数据集的 $R^{2}$ 的通用数值作为最终答案。将答案四舍五入到四位有效数字。", "solution": "该问题要求在三种不同的参数化下分析一个单因素线性模型。我们将首先提供拟合值和 $R^2$ 不变性的理论论证，然后对特定数据集进行计算。\n\n**不变性的理论论证**\n\n一般线性模型以矩阵形式表示为 $\\mathbf{y} = \\mathbf{X}\\boldsymbol{\\beta} + \\boldsymbol{\\varepsilon}$，其中 $\\mathbf{y}$ 是 $n \\times 1$ 的响应向量，$\\mathbf{X}$ 是 $n \\times p$ 的设计矩阵，$\\boldsymbol{\\beta}$ 是 $p \\times 1$ 的系数向量，$\\boldsymbol{\\varepsilon}$ 是误差向量。假设 $\\mathbf{X}$ 具有满列秩，则 $\\boldsymbol{\\beta}$ 的普通最小二乘 (OLS) 估计量由 $\\hat{\\boldsymbol{\\beta}} = (\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{y}$ 给出。\n\n拟合值向量 $\\hat{\\mathbf{y}}$ 由下式给出：\n$$ \\hat{\\mathbf{y}} = \\mathbf{X}\\hat{\\boldsymbol{\\beta}} = \\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}\\mathbf{y} $$\n这可以写成 $\\hat{\\mathbf{y}} = \\mathbf{P}\\mathbf{y}$，其中矩阵 $\\mathbf{P} = \\mathbf{X}(\\mathbf{X}^{\\top}\\mathbf{X})^{-1}\\mathbf{X}^{\\top}$ 是投影矩阵。几何上，$\\hat{\\mathbf{y}}$ 是数据向量 $\\mathbf{y}$ 到设计矩阵列空间 $C(\\mathbf{X})$ 上的正交投影。投影矩阵 $\\mathbf{P}$ 由子空间 $C(\\mathbf{X})$ 唯一确定，而不由该子空间的特定基向量（列）的选择决定。\n\n在这个问题中，我们有一个具有 $K=3$ 个水平的单分类因子。任何包含截距项的满秩参数化都要求设计矩阵 $\\mathbf{X}$ 有 $p=3$ 列。设 $\\mathbf{X}_A$ 和 $\\mathbf{X}_B$ 是对应于不同编码方案（例如，处理编码和效应编码）的两个这样的设计矩阵。这两个矩阵都被构造为张成同一个子空间：即在 $K$ 个水平中的每个水平内都为常数的向量所构成的子空间。该子空间的维度为 $K=3$。因为 $\\mathbf{X}_A$ 和 $\\mathbf{X}_B$ 都是秩为 $K$ 的 $n \\times K$ 矩阵，它们的列构成了这个相同的 $K$ 维子空间的一个基。这意味着它们的列空间是相同的：$C(\\mathbf{X}_A) = C(\\mathbf{X}_B)$。\n\n由于列空间相同，所以到这个空间上的投影矩阵 $\\mathbf{P}$ 对于两种编码也是相同的。因此，拟合值向量 $\\hat{\\mathbf{y}} = \\mathbf{P}\\mathbf{y}$ 必须对于满秩编码方案的选择是不变的。\n\n这种不变性直接延伸到残差平方和（$\\mathrm{SSE}$）和决定系数（$R^2$）：\n- $\\mathrm{SSE} = \\sum_{i=1}^{n}(y_i - \\hat{y}_i)^2 = ||\\mathbf{y} - \\hat{\\mathbf{y}}||^2$。由于 $\\mathbf{y}$ 是固定的且 $\\hat{\\mathbf{y}}$ 是不变的，因此 $\\mathrm{SSE}$ 是不变的。\n- 总平方和 $\\mathrm{SST} = \\sum_{i=1}^{n}(y_i - \\bar{y})^2$ 仅取决于响应数据 $\\mathbf{y}$，因此无论模型如何都是恒定的。\n- 因此，决定系数 $R^2 = 1 - \\mathrm{SSE}/\\mathrm{SST}$ 在这些不同的编码方案下也必须是不变的。\n\n对于任何单向方差分析模型，OLS 投影产生的拟合值等于组均值。我们首先求出这些值，因为它们将是通用的拟合值集合。\n数据为 $y = (4, 6, 8, 10, 5, 3)$。水平为 $(L_1, L_1, L_2, L_2, L_3, L_3)$。\n- 水平 $L_1$ 的均值：$\\bar{y}_1 = \\frac{4+6}{2} = 5$。\n- 水平 $L_2$ 的均值：$\\bar{y}_2 = \\frac{8+10}{2} = 9$。\n- 水平 $L_3$ 的均值：$\\bar{y}_3 = \\frac{5+3}{2} = 4$。\n所有方案的拟合值向量都将是 $\\hat{\\mathbf{y}} = (5, 5, 9, 9, 4, 4)^{\\top}$。\n\n**$R^2$ 的计算**\n\n首先，我们计算总均值 $\\bar{y}$：\n$$ \\bar{y} = \\frac{1}{6}(4+6+8+10+5+3) = \\frac{36}{6} = 6 $$\n接下来，我们计算总平方和（$\\mathrm{SST}$）：\n$$ \\mathrm{SST} = \\sum_{i=1}^{6}(y_i - \\bar{y})^2 = (4-6)^2 + (6-6)^2 + (8-6)^2 + (10-6)^2 + (5-6)^2 + (3-6)^2 $$\n$$ \\mathrm{SST} = (-2)^2 + 0^2 + 2^2 + 4^2 + (-1)^2 + (-3)^2 = 4 + 0 + 4 + 16 + 1 + 9 = 34 $$\n使用不变的拟合值 $\\hat{\\mathbf{y}} = (5, 5, 9, 9, 4, 4)^{\\top}$，我们计算残差平方和（$\\mathrm{SSE}$）：\n$$ \\mathrm{SSE} = \\sum_{i=1}^{6}(y_i - \\hat{y}_i)^2 = (4-5)^2 + (6-5)^2 + (8-9)^2 + (10-9)^2 + (5-4)^2 + (3-4)^2 $$\n$$ \\mathrm{SSE} = (-1)^2 + 1^2 + (-1)^2 + 1^2 + 1^2 + (-1)^2 = 1+1+1+1+1+1 = 6 $$\n最后，我们计算决定系数 $R^2$：\n$$ R^2 = 1 - \\frac{\\mathrm{SSE}}{\\mathrm{SST}} = 1 - \\frac{6}{34} = 1 - \\frac{3}{17} = \\frac{14}{17} $$\n\n现在，我们按要求演示每种编码方案的计算。响应向量为 $\\mathbf{y} = (4, 6, 8, 10, 5, 3)^{\\top}$。\n\n**1. 以 $L_1$ 为参考的处理（虚拟）编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 D_{i2} + \\beta_2 D_{i3} + \\varepsilon_i$。设计矩阵 $\\mathbf{X}_D$ 为：\n$$ \\mathbf{X}_D = \\begin{pmatrix} 1  0  0 \\\\ 1  0  0 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} $$\n我们计算 $\\mathbf{X}_D^{\\top}\\mathbf{X}_D$ 和 $\\mathbf{X}_D^{\\top}\\mathbf{y}$：\n$$ \\mathbf{X}_D^{\\top}\\mathbf{X}_D = \\begin{pmatrix} 6  2  2 \\\\ 2  2  0 \\\\ 2  0  2 \\end{pmatrix}, \\quad \\mathbf{X}_D^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 18 \\\\ 8 \\end{pmatrix} $$\n$\\mathbf{X}_D^{\\top}\\mathbf{X}_D$ 的逆矩阵是：\n$$ (\\mathbf{X}_D^{\\top}\\mathbf{X}_D)^{-1} = \\frac{1}{8}\\begin{pmatrix} 4  -4  -4 \\\\ -4  8  4 \\\\ -4  4  8 \\end{pmatrix} = \\begin{pmatrix} 1/2  -1/2  -1/2 \\\\ -1/2  1  1/2 \\\\ -1/2  1/2  1 \\end{pmatrix} $$\nOLS 系数为：\n$$ \\hat{\\boldsymbol{\\beta}}_D = (\\mathbf{X}_D^{\\top}\\mathbf{X}_D)^{-1}\\mathbf{X}_D^{\\top}\\mathbf{y} = \\begin{pmatrix} 1/2  -1/2  -1/2 \\\\ -1/2  1  1/2 \\\\ -1/2  1/2  1 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 18 \\\\ 8 \\end{pmatrix} = \\begin{pmatrix} 18 - 9 - 4 \\\\ -18 + 18 + 4 \\\\ -18 + 9 + 8 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 4 \\\\ -1 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_D = \\mathbf{X}_D\\hat{\\boldsymbol{\\beta}}_D$：\n$$ \\hat{\\mathbf{y}}_D = \\begin{pmatrix} 1  0  0 \\\\ 1  0  0 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} \\begin{pmatrix} 5 \\\\ 4 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 5+4 \\\\ 5+4 \\\\ 5-1 \\\\ 5-1 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n这些确实是组均值。\n\n**2. 效应（和为零）编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 E_{i1} + \\beta_2 E_{i2} + \\varepsilon_i$。设计矩阵 $\\mathbf{X}_E$ 为：\n$$ \\mathbf{X}_E = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} $$\n我们计算 $\\mathbf{X}_E^{\\top}\\mathbf{X}_E$ 和 $\\mathbf{X}_E^{\\top}\\mathbf{y}$：\n$$ \\mathbf{X}_E^{\\top}\\mathbf{X}_E = \\begin{pmatrix} 6  0  0 \\\\ 0  4  2 \\\\ 0  2  4 \\end{pmatrix}, \\quad \\mathbf{X}_E^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 8 \\\\ -2 \\end{pmatrix} $$\n逆矩阵为 $(\\mathbf{X}_E^{\\top}\\mathbf{X}_E)^{-1} = \\frac{1}{72}\\begin{pmatrix} 12  0  0 \\\\ 0  24  -12 \\\\ 0  -12  24 \\end{pmatrix} = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/3  -1/6 \\\\ 0  -1/6  1/3 \\end{pmatrix}$。\nOLS 系数为：\n$$ \\hat{\\boldsymbol{\\beta}}_E = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/3  -1/6 \\\\ 0  -1/6  1/3 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 8 \\\\ -2 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 8/3 + 2/6 \\\\ -8/6 - 2/3 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 3 \\\\ -2 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_E = \\mathbf{X}_E\\hat{\\boldsymbol{\\beta}}_E$：\n$$ \\hat{\\mathbf{y}}_E = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  0 \\\\ 1  1  0 \\\\ 1  0  1 \\\\ 1  0  1 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 3 \\\\ -2 \\end{pmatrix} = \\begin{pmatrix} 6 - 3 + 2 \\\\ 6 - 3 + 2 \\\\ 6 + 3 + 0 \\\\ 6 + 3 + 0 \\\\ 6 + 0 - 2 \\\\ 6 + 0 - 2 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n拟合值与前一种情况相同。\n\n**3. Helmert 编码**\n\n模型是 $y_i = \\beta_0 + \\beta_1 H_{i1} + \\beta_2 H_{i2} + \\varepsilon_i$。设计矩阵为 $\\mathbf{X}_H$：\n$$ \\mathbf{X}_H = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  -1 \\\\ 1  1  -1 \\\\ 1  0  2 \\\\ 1  0  2 \\end{pmatrix} $$\n对应于对比 $H_1$ 和 $H_2$ 的列彼此正交，并且也与截距列正交。因此，$\\mathbf{X}_H^{\\top}\\mathbf{X}_H$ 是一个对角矩阵。\n$$ \\mathbf{X}_H^{\\top}\\mathbf{X}_H = \\begin{pmatrix} 6  0  0 \\\\ 0  4  0 \\\\ 0  0  12 \\end{pmatrix}, \\quad \\mathbf{X}_H^{\\top}\\mathbf{y} = \\begin{pmatrix} 36 \\\\ 8 \\\\ -12 \\end{pmatrix} $$\n逆矩阵很简单：$(\\mathbf{X}_H^{\\top}\\mathbf{X}_H)^{-1} = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/12 \\end{pmatrix}$。\nOLS 系数为：\n$$ \\hat{\\boldsymbol{\\beta}}_H = \\begin{pmatrix} 1/6  0  0 \\\\ 0  1/4  0 \\\\ 0  0  1/12 \\end{pmatrix} \\begin{pmatrix} 36 \\\\ 8 \\\\ -12 \\end{pmatrix} = \\begin{pmatrix} 6 \\\\ 2 \\\\ -1 \\end{pmatrix} $$\n拟合值为 $\\hat{\\mathbf{y}}_H = \\mathbf{X}_H\\hat{\\boldsymbol{\\beta}}_H$：\n$$ \\hat{\\mathbf{y}}_H = \\begin{pmatrix} 1  -1  -1 \\\\ 1  -1  -1 \\\\ 1  1  -1 \\\\ 1  1  -1 \\\\ 1  0  2 \\\\ 1  0  2 \\end{pmatrix} \\begin{pmatrix} 6 \\\\ 2 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 6-2+1 \\\\ 6-2+1 \\\\ 6+2+1 \\\\ 6+2+1 \\\\ 6-2 \\\\ 6-2 \\end{pmatrix} = \\begin{pmatrix} 5 \\\\ 5 \\\\ 9 \\\\ 9 \\\\ 4 \\\\ 4 \\end{pmatrix} $$\n拟合值再次相同。\n\n如演示所示，虽然系数向量 $\\hat{\\boldsymbol{\\beta}}_D$、$\\hat{\\boldsymbol{\\beta}}_E$ 和 $\\hat{\\boldsymbol{\\beta}}_H$ 在数值上不同且有不同的解释，但它们都产生相同的拟合值向量 $\\hat{\\mathbf{y}}$。这证实了理论原理，即 $\\mathbf{y}$ 在模型列空间上的投影对于该空间的基的选择是不变的。由于 $\\hat{\\mathbf{y}}$ 是不变的，$\\mathrm{SSE}$ 和 $R^2$ 也是不变的。\n\n$R^2$ 的最终数值是 $\\frac{14}{17} \\approx 0.8235294...$。四舍五入到四位有效数字，结果是 $0.8235$。", "answer": "$$ \\boxed{0.8235} $$", "id": "4899207"}, {"introduction": "当一个分类变量或其交互作用在模型中由多个系数表示时，我们如何评估其整体显著性？简单地查看单个系数的p值是不够的。这个练习 ([@problem_id:4899236]) 旨在让你掌握一种关键的统计方法——多变量沃尔德检验（multivariate Wald test），用于联合检验一组交互项系数是否同时为零。通过构建对比矩阵并计算检验统计量，你将学会如何严谨地评估效应修饰（effect modification）的存在。", "problem": "一项随机流行病学研究旨在探讨二元治疗指标 $A \\in \\{0,1\\}$ 与二元临床结局 $Y \\in \\{0,1\\}$ 之间的关联是否因具有 $J=4$ 个水平 $\\{B_{1},B_{2},B_{3},B_{4}\\}$ 的分类生物标志物 $B$ 的水平而异，同时校正了连续混杂因素 $C$。使用对 $B$ 的参考单元格编码（以 $B_{1}$ 为参考水平）拟合了一个带有 logit 联接的逻辑广义线性模型 (GLM)，并包含了 $A$ 和 $B$ 之间的一阶交互作用。模型为\n$$\n\\log\\left(\\frac{\\Pr(Y=1 \\mid A,B,C)}{1-\\Pr(Y=1 \\mid A,B,C)}\\right)\n=\n\\beta_{0}+\\beta_{A}A+\\beta_{B_{2}}\\mathbf{1}(B=B_{2})+\\beta_{B_{3}}\\mathbf{1}(B=B_{3})+\\beta_{B_{4}}\\mathbf{1}(B=B_{4})\n+\\beta_{AB_{2}}\\,A\\,\\mathbf{1}(B=B_{2})+\\beta_{AB_{3}}\\,A\\,\\mathbf{1}(B=B_{3})+\\beta_{AB_{4}}\\,A\\,\\mathbf{1}(B=B_{4})\n+\\beta_{C}C.\n$$\n设回归系数向量的顺序为\n$$\n\\boldsymbol{\\beta}=\n\\begin{pmatrix}\n\\beta_{0}  \\beta_{A}  \\beta_{B_{2}}  \\beta_{B_{3}}  \\beta_{B_{4}}  \\beta_{AB_{2}}  \\beta_{AB_{3}}  \\beta_{AB_{4}}  \\beta_{C}\n\\end{pmatrix}^{\\top}.\n$$\n你有兴趣在对数优势比尺度上检验 $A$ 和 $B$ 之间是否存在任何交互作用。建立所有交互项均为零的原假设。然后，使用基于最大似然估计 (MLE) 的沃尔德检验，构建一个适当的对比矩阵，以联合检验这些交互项，其自由度等于 $J-1$。\n\n从拟合的模型中，得到的估计交互作用系数及其估计的协方差矩阵为：\n$$\n\\widehat{\\boldsymbol{\\beta}}_{AB}=\n\\begin{pmatrix}\n\\widehat{\\beta}_{AB_{2}} \\\\\n\\widehat{\\beta}_{AB_{3}} \\\\\n\\widehat{\\beta}_{AB_{4}}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0.42 \\\\\n-0.18 \\\\\n0.30\n\\end{pmatrix},\n\\qquad\n\\widehat{\\boldsymbol{\\Sigma}}_{AB}=\n\\begin{pmatrix}\n0.040  0.005  -0.004 \\\\\n0.005  0.050  0.006 \\\\\n-0.004  0.006  0.045\n\\end{pmatrix}.\n$$\n使用大样本沃尔德检验计算交互作用的检验统计量，选择的对比应针对这三个交互作用系数。明确指定相对于上述 $\\boldsymbol{\\beta}$ 顺序的对比矩阵，然后计算沃尔德检验统计量\n$$\nW=(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}})^{\\top}\\left[\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}\\right]^{-1}(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}),\n$$\n注意 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 是对应于交互项的子矩阵 $\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}$。指出自由度并报告 $W$ 的值。\n\n将 $W$ 的最终数值答案四舍五入到四位有效数字。你提供的最终答案必须仅为沃尔德统计量 $W$，不带单位。", "solution": "问题要求对治疗 $A$ 和分类生物标志物 $B$ 之间的交互作用进行联合检验。指定的逻辑回归模型包含了这些交互作用的项。\n\n首先，我们建立原假设。$A$ 和 $B$ 之间的交互作用由系数 $\\beta_{AB_{j}}$（对于 $j=2, 3, 4$）捕获。由于使用了参考单元格编码方案，参考水平的交互项 $\\beta_{AB_{1}}$ 在结构上为零。因此，无交互作用的原假设是所有非冗余的交互作用系数同时为零。\n$$ H_{0}: \\beta_{AB_{2}} = 0, \\beta_{AB_{3}} = 0, \\beta_{AB_{4}} = 0. $$\n这可以写成矩阵形式 $\\mathbf{C}\\boldsymbol{\\beta} = \\mathbf{0}$，其中 $\\mathbf{C}$ 是一个对比矩阵，$\\boldsymbol{\\beta}$ 是所有模型系数的向量。\n\n完整的系数向量 $\\boldsymbol{\\beta}$ 是一个 $9 \\times 1$ 的向量，其顺序为：\n$$ \\boldsymbol{\\beta} = \\begin{pmatrix} \\beta_{0}  \\beta_{A}  \\beta_{B_{2}}  \\beta_{B_{3}}  \\beta_{B_{4}}  \\beta_{AB_{2}}  \\beta_{AB_{3}}  \\beta_{AB_{4}}  \\beta_{C} \\end{pmatrix}^{\\top} $$\n我们感兴趣的系数 $\\beta_{AB_{2}}$、$\\beta_{AB_{3}}$ 和 $\\beta_{AB_{4}}$ 是该向量的第 6、第 7 和第 8 个元素。为了检验这三个系数为零的原假设，我们构建一个 $3 \\times 9$ 的对比矩阵 $\\mathbf{C}$，其中每一行选择其中一个系数。\n$$ \\mathbf{C} = \\begin{pmatrix} 0  0  0  0  0  1  0  0  0 \\\\ 0  0  0  0  0  0  1  0  0 \\\\ 0  0  0  0  0  0  0  1  0 \\end{pmatrix} $$\n该检验的自由度等于 $\\mathbf{C}$ 中的行数，也就是联合检验的参数数量。在这里，生物标志物 $B$ 有 $J=4$ 个水平，所以有 $J-1=3$ 个交互项。自由度为 3。\n\n大样本沃尔德检验统计量由以下公式给出：\n$$ W = (\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}})^{\\top}\\left[\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}\\right]^{-1}(\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}) $$\n根据我们对 $\\mathbf{C}$ 的定义：\n- 项 $\\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}}$ 提取了估计的交互作用系数：\n$$ \\mathbf{C}\\,\\widehat{\\boldsymbol{\\beta}} = \\begin{pmatrix} \\widehat{\\beta}_{AB_{2}} \\\\ \\widehat{\\beta}_{AB_{3}} \\\\ \\widehat{\\beta}_{AB_{4}} \\end{pmatrix} = \\widehat{\\boldsymbol{\\beta}}_{AB} = \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n- 项 $\\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top}$ 提取了与这些交互作用系数相对应的完整协方差矩阵的子矩阵。该子矩阵在问题中已作为 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 给出：\n$$ \\mathbf{C}\\,\\widehat{\\operatorname{Var}}(\\widehat{\\boldsymbol{\\beta}})\\,\\mathbf{C}^{\\top} = \\widehat{\\boldsymbol{\\Sigma}}_{AB} = \\begin{pmatrix} 0.040  0.005  -0.004 \\\\ 0.005  0.050  0.006 \\\\ -0.004  0.006  0.045 \\end{pmatrix} $$\n因此，沃尔德统计量的计算简化为：\n$$ W = \\widehat{\\boldsymbol{\\beta}}_{AB}^{\\top} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} \\widehat{\\boldsymbol{\\beta}}_{AB} $$\n我们必须首先计算 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 的逆矩阵。$\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 的行列式是：\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.040(0.050 \\times 0.045 - 0.006 \\times 0.006) - 0.005(0.005 \\times 0.045 - 0.006 \\times (-0.004)) + (-0.004)(0.005 \\times 0.006 - 0.050 \\times (-0.004)) $$\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.040(0.002214) - 0.005(0.000249) - 0.004(0.000230) $$\n$$ \\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = 0.00008856 - 0.000001245 - 0.00000092 = 0.000086395 $$\n伴随矩阵 $\\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB})$ 是代数余子式矩阵的转置。由于 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}$ 是对称的，其代数余子式矩阵也是对称的，因此等于伴随矩阵。\n$$ \\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB}) = \\begin{pmatrix} 0.002214  -0.000249  0.000230 \\\\ -0.000249  0.001784  -0.000260 \\\\ 0.000230  -0.000260  0.001975 \\end{pmatrix} $$\n逆矩阵为 $\\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} = \\frac{1}{\\det(\\widehat{\\boldsymbol{\\Sigma}}_{AB})} \\operatorname{adj}(\\widehat{\\boldsymbol{\\Sigma}}_{AB})$：\n$$ \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} = \\frac{1}{0.000086395} \\begin{pmatrix} 0.002214  -0.000249  0.000230 \\\\ -0.000249  0.001784  -0.000260 \\\\ 0.000230  -0.000260  0.001975 \\end{pmatrix} \\approx \\begin{pmatrix} 25.6263  -2.8821  2.6622 \\\\ -2.8821  20.6493  -3.0094 \\\\ 2.6622  -3.0094  22.8601 \\end{pmatrix} $$\n现在我们计算 $W$ 的二次型：\n$$ W = \\begin{pmatrix} 0.42  -0.18  0.30 \\end{pmatrix} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1} \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n首先，我们计算乘积 $\\widehat{\\boldsymbol{\\beta}}_{AB}^{\\top} \\widehat{\\boldsymbol{\\Sigma}}_{AB}^{-1}$：\n$$ \\begin{pmatrix} 0.42  -0.18  0.30 \\end{pmatrix} \\begin{pmatrix} 25.6263  -2.8821  2.6622 \\\\ -2.8821  20.6493  -3.0094 \\\\ 2.6622  -3.0094  22.8601 \\end{pmatrix} $$\n这给出一个行向量：\n$$ \\approx \\begin{pmatrix} (10.7630 + 0.5188 + 0.7987)  (-1.2105 - 3.7169 - 0.9028)  (1.1181 + 0.5417 + 6.8580) \\end{pmatrix} $$\n$$ \\approx \\begin{pmatrix} 12.0805  -5.8302  8.5178 \\end{pmatrix} $$\n最后，我们将此行向量乘以 $\\widehat{\\boldsymbol{\\beta}}_{AB}$：\n$$ W \\approx \\begin{pmatrix} 12.0805  -5.8302  8.5178 \\end{pmatrix} \\begin{pmatrix} 0.42 \\\\ -0.18 \\\\ 0.30 \\end{pmatrix} $$\n$$ W \\approx 12.0805 \\times 0.42 + (-5.8302) \\times (-0.18) + 8.5178 \\times 0.30 $$\n$$ W \\approx 5.07381 + 1.04944 + 2.55534 = 8.67859 $$\n在原假设下，$W$ 服从自由度为 3 的卡方分布。该统计量的计算值约为 $8.67859$。\n四舍五入到四位有效数字，我们得到 $W = 8.679$。", "answer": "$$\n\\boxed{8.679}\n$$", "id": "4899236"}, {"introduction": "检验交互作用的统计显著性只是第一步，理解其交互作用的模式和量级同样重要。对数几率回归等模型默认检验的是乘性尺度（multiplicative scale）上的交互作用，但在公共卫生领域，我们往往更关心加性尺度（additive scale）上的交互作用。本练习 ([@problem_id:4899240]) 引导你计算“交互作用相对超额风险”（RERI），这是一个衡量偏离加性效应程度的指标，并在此过程中结合了标准化方法来校正混杂因素的影响。", "problem": "一项前瞻性队列研究调查了两种二元暴露，$A \\in \\{0,1\\}$ 和 $B \\in \\{0,1\\}$，对为期1年的疾病结局 $Y \\in \\{0,1\\}$ 风险的联合效应。年龄，记为 $C \\in \\{0,1\\}$，是一个潜在的混杂因素，其中 $C=0$ 表示年轻参与者，$C=1$ 表示年长参与者。用于推断的目标人群具有 $P(C=0)=0.7$ 和 $P(C=1)=0.3$ 的分布。在 $C$ 的分层中，观察到的 $(A,B)$ 的风险如下（风险是以 $C$ 和 $(A,B)$ 为条件的）：\n- 对于 $C=0$：$R_{00}^{(0)}=0.02$, $R_{10}^{(0)}=0.03$, $R_{01}^{(0)}=0.04$, $R_{11}^{(0)}=0.08$。\n- 对于 $C=1$：$R_{00}^{(1)}=0.08$, $R_{10}^{(1)}=0.12$, $R_{01}^{(1)}=0.16$, $R_{11}^{(1)}=0.30$。\n\n这里，$R_{ab}^{(c)}$ 表示 $P(Y=1 \\mid A=a, B=b, C=c)$，并且类别 $(A,B)=(0,0)$ 是参照组。\n\n任务：\n1. 用文字说明，在风险和风险差方面，以 $(A,B)=(0,0)$ 为参照，$A$ 和 $B$ 在相加尺度上没有交互作用意味着什么。\n2. 从这个定义出发，推导一个用于量化在风险差尺度上对相加性的偏离，但使用相对于 $(A,B)=(0,0)$ 的风险比来表示的估计量。将此估计量命名为交互作用所致相对超额风险（RERI）。\n3. 通过对 $C$ 的目标人群分布进行标准化来校正 $C$ 带来的混杂，计算 $A$ 和 $B$ 的交互作用所致相对超额风险（RERI）的数值。\n\n将您的最终数值答案四舍五入到四位有效数字，并以无单位的纯数字形式表示。", "solution": "令 $R_{ab}$ 表示暴露状态为 $A=a$ 和 $B=b$ 的个体患病的风险，即 $P(Y=1)$。相对于未暴露的参照组 $(0,0)$，暴露概况为 $(a,b)$ 的风险差（RD）是 $RD_{ab} = R_{ab} - R_{00}$。\n\n任务1：无相加交互作用的定义。\n在相加尺度上没有交互作用意味着，同时暴露于 $A$ 和 $B$ 的超额风险等于单独考虑每种暴露的超额风险之和。相对于未暴露组，仅暴露于 $A$ 的超额风险是风险差 $RD_{10} = R_{10} - R_{00}$。同样，仅暴露于 $B$ 的超额风险是 $RD_{01} = R_{01} - R_{00}$。如果效应是纯相加的，则联合暴露的预测超额风险将是这些单个超额风险之和，即 $RD_{10} + RD_{01}$。观察到的联合暴露的超额风险是 $RD_{11} = R_{11} - R_{00}$。因此，无相加交互作用的条件是观察到的联合超额风险等于单个超额风险之和：\n$$\nRD_{11} = RD_{10} + RD_{01}\n$$\n代入风险差的定义，此条件变为：\n$$\n(R_{11} - R_{00}) = (R_{10} - R_{00}) + (R_{01} - R_{00})\n$$\n\n任务2：交互作用所致相对超额风险（RERI）的推导。\n对相加性的偏离，或相加尺度上的交互作用反差（$I_{add}$），是观察到的联合超额风险与单个超额风险之和的差值：\n$$\nI_{add} = RD_{11} - (RD_{10} + RD_{01})\n$$\n代入风险，我们得到：\n$$\nI_{add} = (R_{11} - R_{00}) - (R_{10} - R_{00}) - (R_{01} - R_{00}) = R_{11} - R_{10} - R_{01} + R_{00}\n$$\n$I_{add}=0$ 的值表示没有相加交互作用。为了使用风险比（RR）以相对项来表示这种偏离，我们首先定义相对于基线风险 $R_{00}$ 的风险比：\n$$\nRR_{10} = \\frac{R_{10}}{R_{00}}, \\quad RR_{01} = \\frac{R_{01}}{R_{00}}, \\quad RR_{11} = \\frac{R_{11}}{R_{00}}\n$$\n问题要求一个使用这些风险比来量化对相加性的偏离的估计量。创建相对度量的一个自然方法是将交互作用反差 $I_{add}$ 按基线风险 $R_{00}$ 进行缩放。将 $I_{add}$ 的表达式除以 $R_{00}$（假设 $R_{00} > 0$）得到称为交互作用所致相对超额风险（RERI）的估计量：\n$$\n\\text{RERI} = \\frac{I_{add}}{R_{00}} = \\frac{R_{11} - R_{10} - R_{01} + R_{00}}{R_{00}}\n$$\n分离各项可得：\n$$\n\\text{RERI} = \\frac{R_{11}}{R_{00}} - \\frac{R_{10}}{R_{00}} - \\frac{R_{01}}{R_{00}} + \\frac{R_{00}}{R_{00}}\n$$\n代入风险比的定义，我们得到所需的表达式：\n$$\n\\text{RERI} = RR_{11} - RR_{10} - RR_{01} + 1\n$$\n这个估计量也可以解释为联合暴露的超额风险比（$ERR_{11} = RR_{11} - 1$）减去单个暴露的超额风险比之和（$ERR_{10} = RR_{10} - 1$ 和 $ERR_{01} = RR_{01} - 1$）：\n$$\n\\text{RERI} = (RR_{11} - 1) - [(RR_{10} - 1) + (RR_{01} - 1)] = RR_{11} - RR_{10} - RR_{01} + 1\n$$\n\n任务3：标准化RERI的计算。\n为了校正 $C$ 带来的混杂，我们首先计算每个暴露组 $(A=a, B=b)$ 的标准化风险，记为 $R_{ab}^{S}$。标准化是通过对特定分层的风险 $R_{ab}^{(c)}$ 取加权平均来执行的，其中权重是目标人群中混杂因素 $C$ 的比例 $P(C=c)$。\n给定 $P(C=0)=0.7$ 和 $P(C=1)=0.3$。标准化风险的公式是：\n$$\nR_{ab}^{S} = R_{ab}^{(0)} P(C=0) + R_{ab}^{(1)} P(C=1)\n$$\n我们计算四个所需的标准化风险：\n- 对于 $(A,B)=(0,0)$:\n$$\nR_{00}^{S} = (0.02)(0.7) + (0.08)(0.3) = 0.014 + 0.024 = 0.038\n$$\n- 对于 $(A,B)=(1,0)$:\n$$\nR_{10}^{S} = (0.03)(0.7) + (0.12)(0.3) = 0.021 + 0.036 = 0.057\n$$\n- 对于 $(A,B)=(0,1)$:\n$$\nR_{01}^{S} = (0.04)(0.7) + (0.16)(0.3) = 0.028 + 0.048 = 0.076\n$$\n- 对于 $(A,B)=(1,1)$:\n$$\nR_{11}^{S} = (0.08)(0.7) + (0.30)(0.3) = 0.056 + 0.090 = 0.146\n$$\n接下来，我们使用标准化风险计算标准化的风险比（$RR^S$），以 $R_{00}^{S}$ 作为参照：\n$$\nRR_{10}^{S} = \\frac{R_{10}^{S}}{R_{00}^{S}} = \\frac{0.057}{0.038} = 1.5\n$$\n$$\nRR_{01}^{S} = \\frac{R_{01}^{S}}{R_{00}^{S}} = \\frac{0.076}{0.038} = 2.0\n$$\n$$\nRR_{11}^{S} = \\frac{R_{11}^{S}}{R_{00}^{S}} = \\frac{0.146}{0.038} = \\frac{146}{38} = \\frac{73}{19}\n$$\n最后，我们使用任务2中推导的公式计算标准化的RERI：\n$$\n\\text{RERI} = RR_{11}^{S} - RR_{10}^{S} - RR_{01}^{S} + 1\n$$\n$$\n\\text{RERI} = \\frac{73}{19} - 1.5 - 2.0 + 1 = \\frac{73}{19} - 2.5\n$$\n为了计算数值：\n$$\n\\text{RERI} = \\frac{73}{19} - \\frac{5}{2} = \\frac{2 \\times 73 - 5 \\times 19}{38} = \\frac{146 - 95}{38} = \\frac{51}{38}\n$$\n作为小数，这大约是 $1.342105...$。四舍五入到四位有效数字得到 $1.342$。", "answer": "$$\\boxed{1.342}$$", "id": "4899240"}]}