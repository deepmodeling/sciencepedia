## 引言
在生物统计学及相关领域的定量研究中，[回归模型](@entry_id:163386)是探索变量间关系、进行预测和推断因果的核心工具。然而，当模型中包含非数值型的预测变量，或者当变量间的关系并非简单的线性相加时，分析的复杂性便显著增加。研究者常常面临三大挑战：如何将治疗组别、基因型等**[分类预测变量](@entry_id:636655)**科学地纳入模型？如何识别并量化一个因素（如药物）的效果在不同人群（如不同性别）中存在差异的现象，即**[交互作用](@entry_id:164533)**？以及如何避免**混杂**变量（如年龄、疾病严重程度）对我们关心的暴露-结局关系造成误导性结论？对这些问题的处理不当，是导致研究结论偏颇甚至错误的关键原因之一。

本文旨在系统性地解决这些挑战，为读者提供一个关于在回归模型中处理[分类预测变量](@entry_id:636655)、[交互作用](@entry_id:164533)与混杂的全面指南。我们将通过三个循序渐进的章节，帮助您建立从理论到实践的完整知识体系：
-   第一章 **“原理与机制”** 将深入统计学的第一性原理，阐明[指示变量](@entry_id:266428)编码的数学基础，剖析[交互作用](@entry_id:164533)如何改变系数的解释，并通过辛普森悖论等经典例子揭示混杂的本质。
-   第二章 **“应用与跨学科联系”** 将理论付诸实践，通过来自流行病学、临床试验、遗传学等领域的真实案例，展示如何在不同类型的回归模型（如逻辑回归、Cox回归）中应用这些概念来控制混杂和检验效应修饰。
-   第三章 **“动手实践”** 则提供了一系列精心设计的问题，旨在通过实际计算和方法应用，巩固您对编码方案、[交互作用](@entry_id:164533)检验和效应量化等关键技能的掌握。

通过学习本文，您不仅将学会具体的操作技术，更将深刻理解这些统计方法背后的逻辑和假设，从而在未来的研究中做出更严谨、更具洞察力的分析。

## 原理与机制

本章旨在深入探讨回归模型中处理[分类预测变量](@entry_id:636655)的核心原理与机制。我们将从如何在数学上表示分类信息入手，进而阐述两个在生物统计学中至关重要的概念——**[交互作用](@entry_id:164533)（效应修饰）**与**混杂**。最后，我们将讨论在应用调整策略时可能遇到的一些高级且微妙的问题。本章的目标是不仅提供操作指南，更要建立对这些方法背后统计与因果原理的深刻理解。

### 在[回归模型](@entry_id:163386)中表示分类信息

在生物医学研究中，我们经常遇到非数值型的预测变量，例如治疗组别（A组、B组、C组）、基因型（野生型、杂合突变型、纯合突变型）或疾病严重程度（轻度、中度、重度）。这些**[分类预测变量](@entry_id:636655) (categorical predictors)** 无法直接以其标签形式纳入标准的回归方程。解决方案是将这些分类信息转化为一组数值变量，其中最常用和最基础的方法是**[指示变量](@entry_id:266428)编码 (indicator variable coding)**，也常被称为**[虚拟变量](@entry_id:138900)编码 (dummy variable coding)**。

该方法的核心思想是：对于一个具有 $K$ 个水平（或组别）的[分类变量](@entry_id:637195)，我们选择其中一个水平作为**参照水平 (reference level)** 或基线组，然后为其余的 $K-1$ 个水平分别创建一个二元指示变量。[指示变量](@entry_id:266428) $D_k$ 的取值为1（如果观测属于第 $k$ 组）或0（否则）。

为了从第一性原理理解这一点，我们考虑一个简单的[单因素方差分析](@entry_id:163873) (one-way [ANOVA](@entry_id:275547)) 场景，其中研究人员比较四种不同治疗手段对某一生物标志物浓度的影响 [@problem_id:4899253]。设 $Y_{kj}$ 为第 $k$ 组（$k \in \{1, 2, 3, 4\}$）第 $j$ 个受试者的观测值。我们可以将此[ANOVA](@entry_id:275547)模型表述为一个线性回归模型。如果我们选择第1组作为参照组，模型可以写为：
$$
Y_{kj} = \beta_0 + \beta_2 D_{k2} + \beta_3 D_{k3} + \beta_4 D_{k4} + \varepsilon_{kj}
$$
其中 $D_{k2} = \mathbf{1}\{k=2\}$, $D_{k3} = \mathbf{1}\{k=3\}$, $D_{k4} = \mathbf{1}\{k=4\}$ 是[指示函数](@entry_id:186820)。

通过最小化残差平方和（即普通最小二乘法，OLS），可以推导出这些系数的估计值与各组样本均值 $(\bar{Y}_1, \bar{Y}_2, \bar{Y}_3, \bar{Y}_4)$ 之间的精确关系。推导过程表明 [@problem_id:4899253]：
- **截距项的估计值** $\hat{\beta}_0$ 恰好是参照组的样本均值：$\hat{\beta}_0 = \bar{Y}_1$。
- **[指示变量](@entry_id:266428)的[系数估计](@entry_id:175952)值** $\hat{\beta}_k$ (对于 $k=2,3,4$) 则是第 $k$ 组的样本均值与参照组样本均值之差：$\hat{\beta}_k = \bar{Y}_k - \bar{Y}_1$。

这一结果揭示了[指示变量](@entry_id:266428)编码的本质：它将一个关于组别均值的模型，重新[参数化](@entry_id:265163)为一个关于“基线”和“与基线的差异”的模型。截距项 $\beta_0$ 代表了参照组的期望响应，而每个系数 $\beta_k$ 则代表了从参照组转换到第 $k$ 组时，期望响应的变化量。

当模型中还包含一个连续协变量 $X$ 时（例如年龄），这种解释框架依然成立，但解释变得更加精确 [@problem_id:4899204]。考虑一个包含5个水平的分类基因型 $G$ 和一个连续协变量 $X$ 的模型：
$$
Y = \beta_0 + \sum_{k=2}^{5} \beta_k D_k + \beta_X X + \varepsilon
$$
其中 $G=1$ 是参照组。在这种**[协方差分析 (ANCOVA)](@entry_id:166285)** 的设定下，系数的解释变为：
- $\beta_0$: 当 $X=0$ 时，参照组 ($G=1$) 的期望响应 $E[Y \mid G=1, X=0]$。
- $\beta_k$ ($k \in \{2,3,4,5\}$): **在调整了协变量 $X$ 之后**，第 $k$ 组与参照组之间期望响应的差异，即 $E[Y \mid G=k, X=x] - E[Y \mid G=1, X=x]$。这个差异对于任何给定的 $x$ 值都是恒定的。
- $\beta_X$: 协变量 $X$ 的**共同斜率**，表示在任何基因型组内，$X$ 每增加一个单位，期望响应 $E[Y]$ 的变化量。

重要的是要认识到，$\beta_k$ 代表的是**调整后的效应**，而非简单的未调整均值之差 $E[Y \mid G=k] - E[Y \mid G=1]$。只有当 $X$ 与 $Y$ 无关，或者 $X$ 在所有基因型组中的分布完全相同时，调整后效应才与未调整效应相等。在观察性研究中，我们引入协变量进行调整，正是因为我们通常不期望这些条件成立。

### [交互作用](@entry_id:164533)建模：当效应不再恒定

前面的模型隐含了一个强假设：连续协变量 $X$ 的效应（斜率 $\beta_X$）在所有分类组别中是相同的，并且分类变量的效应（各组间的差异）不随 $X$ 的值而改变。当这一假设不成立时，即一个预测变量的效应依赖于另一个预测变量的水平时，我们就称之为存在**[交互作用](@entry_id:164533) (interaction)** 或**效应修饰 (effect modification)**。

在[统计模型](@entry_id:755400)中，[交互作用](@entry_id:164533)通过引入预测变量的**乘积项**来表示。例如，在一个研究治疗 $A$（$A=1$ 为治疗组, $A=0$ 为[对照组](@entry_id:188599)）对结局 $Y$ 的影响，同时考虑一个具有三个水平（如，B1=非吸烟者，B2=既往吸烟者，B3=当前吸烟者）的效应修饰因子 $B$ 的模型中，我们可以建立如下带有[交互作用](@entry_id:164533)的模型（以B1为参照组）：
$$
Y = \beta_0 + \beta_A A + \beta_{B2} D_{B2} + \beta_{B3} D_{B3} + \beta_{AB2} (A \cdot D_{B2}) + \beta_{AB3} (A \cdot D_{B3}) + \varepsilon
$$
引入交互项彻底改变了对模型中“主效应”系数的解释：

- **主效应系数是条件效应**：在交互模型中，$\beta_A$ 不再是治疗 $A$ 的平均效应。它现在代表**当交互变量处于其参照水平时**（即对于非吸烟者，$D_{B2}=0, D_{B3}=0$），治疗 $A$ 的效应 [@problem_id:4899181]。具体来说，$\beta_A = E[Y \mid A=1, B=\text{B1}] - E[Y \mid A=0, B=\text{B1}]$。

- **交互项系数是效应的差异**：交互项系数 $\beta_{ABk}$ 量化了效应的修饰程度。它代表了治疗 $A$ 的效应在第 $k$ 组与参照组之间的**差异**。这种解释结构常被称为“**差中差 (difference-in-differences)**” [@problem_id:4899221]。例如，$\beta_{AB2}$ 等于“既往吸烟者中的治疗效应”减去“非吸烟者中的治疗效应”：
$$
\beta_{AB2} = \left( E[Y|A=1,B=B2] - E[Y|A=0,B=B2] \right) - \left( E[Y|A=1,B=B1] - E[Y|A=0,B=B1] \right)
$$

- **计算特定层内的效应**：要获得非参照组（例如，当前吸烟者，B3组）中治疗 $A$ 的效应，我们必须将主效应和相应的[交互效应](@entry_id:164533)系数结合起来。对于B3组，治疗 $A$ 的效应是 $\beta_A + \beta_{AB3}$ [@problem_id:4899181]。

例如，在一项关于降压治疗的临床试验中，假设我们得到以下拟合系数：$\beta_A = -5.6$ (治疗A对非吸烟者的效应)，$\beta_{AC} = 2.1$ (治疗A对当前吸烟者的效应与对非吸烟者效应的差异)。那么，治疗 $A$ 对于当前吸烟者的效应（血压变化）估计为 $\Delta_A(\text{current}) = \beta_A + \beta_{AC} = -5.6 + 2.1 = -3.5$ mmHg。

一个核心要点是，模型的预测是唯一的，但系数的解释依赖于参照组的选择。改变参照组会改变所有系数的值，但这仅仅是对同一组潜在关系的重新[参数化](@entry_id:265163)，并不会改变任何特定个体（即具有特定 $A$ 和 $B$ 值组合的个体）的预测结果 $Y$ [@problem_id:4899185]。例如，在一个研究血压与吸烟状况（从不吸烟、既往吸烟、当前吸烟）和年龄之间关系的模型中，我们可以选择“从不吸烟者”为基线，也可以选择“当前吸烟者”为基线。两种模型会得到完全不同的系数集，但对于一个55岁的当前吸烟者，两种模型计算出的预测血压值将完全相同。

### 混杂的挑战与调整的作用

在观察性研究中，我们面临的一个核心挑战是**混杂 (confounding)**。当一个与暴露（如治疗）和结局（如疾病）都有关联的第三个变量（**混杂因子**）扭曲了我们观察到的暴露-结局关联时，混杂就发生了。混杂因子的存在会引入一条非因果的“后门路径 (backdoor path)”，导致观察到的关联并不反映真实的因果效应。

**一个鲜明的例证：[辛普森悖论](@entry_id:136589) (Simpson's Paradox)**

[辛普森悖论](@entry_id:136589)是理解混杂威力的一个经典例子。它指的是在数据分组时表现出的一种趋势，在数据合并后却表现出相反的趋势。

考虑一项评估某种新疗法 $A$ 对死亡率 $Y$ 影响的研究 [@problem_id:4899252]。研究中还有一个重要的基线变量——疾病严重程度 $C$（$C=0$为低严重度，$C=1$为高严重度）。数据如下：
- 对于低严重度组 ($C=0$): 接受治疗的50人中有1人死亡（死亡率2%），未接受治疗的450人中有15人死亡（死亡率3.3%）。在该组中，治疗似乎是**保护性**的（比值比 $OR \approx 0.59$）。
- 对于高严重度组 ($C=1$): 接受治疗的450人中有45人死亡（死亡率10%），未接受治疗的50人中有15人死亡（死亡率30%）。在该组中，治疗似乎也是**保护性**的，且效果更强（$OR \approx 0.26$）。

然而，如果我们忽略疾病严重程度，将两组数据合并：
- 接受治疗的总人数为 $50+450=500$，死亡人数为 $1+45=46$（总死亡率9.2%）。
- 未接受治疗的总人数为 $450+50=500$，死亡人数为 $15+15=30$（总死亡率6.0%）。

在合并后的数据中，治疗组的死亡率高于未治疗组，表明治疗是**有害**的（边际比值比 $OR \approx 1.59$）。

这种关联的逆转就是[辛普森悖论](@entry_id:136589)。其根源在于 $C$ 是一个混杂因子：
1.  **$C$ 与结局 $Y$ 相关**：高严重度患者的死亡率（30%）远高于低严重度患者（3.3%）。
2.  **$C$ 与暴露 $A$ 相关**：高严重度患者更倾向于接受治疗（90%的患者接受了治疗），而低严重度患者则较少接受治疗（10%）。这种现象被称为“**适应症混杂 (confounding by indication)**”。

由于病情更重的患者（他们本身死亡风险就高）更可能接受治疗，合并分析错误地将这种高风险归咎于治疗本身。层内（条件）关联（$OR \lt 1$）更接近真实的因果效应，而边际关联（$OR \gt 1$）是由于混杂而产生的虚假关联。

为了处理混杂，我们必须在分析中对混杂因子进行**调整 (adjustment)**。在回归模型中，这意味着将混杂因子作为协变量纳入模型。通过将 $C$ 加入到关于 $Y$ 对 $A$ 的[回归模型](@entry_id:163386)中，我们实际上是在估计在 $C$ 的每个水平内 $A$ 的效应，从而阻断了由 $C$ 造成的 $A \leftarrow C \rightarrow Y$ 这条非因果后门路径。

### [交互作用](@entry_id:164533)与调整的高级主题

虽然调整是控制混杂的关键工具，但其应用和解释需要细致的考量。以下是一些更深层次的主题。

#### Logistic回归中的[交互作用](@entry_id:164533)：相加尺度与相乘尺度

当结局是二元变量时（如存活/死亡），Logistic回归是最常用的模型。它在**对数优势 (log-odds)** 尺度上是线性的。这导致其[交互作用](@entry_id:164533)的解释与[线性模型](@entry_id:178302)有所不同。Logistic回归模型中的[交互作用](@entry_id:164533)意味着效应在**优势比 (Odds Ratio, OR)** 尺度上是非[乘性](@entry_id:187940)的 [@problem_id:4899248]。

考虑一个包含两个二元暴露 $E_1$ 和 $E_2$ 的模型：
$$
\ln\left(\frac{P(Y=1)}{1-P(Y=1)}\right) = \beta_0 + \beta_1 E_1 + \beta_2 E_2 + \beta_3 (E_1 E_2)
$$
- 如果没有[交互作用](@entry_id:164533)（$\beta_3=0$），则暴露于 $E_1$ 和 $E_2$ 的联合效应在优势比尺度上是**相乘**的：$OR_{11} = OR_{10} \times OR_{01}$，其中 $OR_{ij}$ 是与 $(E_1=i, E_2=j)$ 组相比于基线组 $(0,0)$ 的优势比。
- 交互项系数 $\beta_3$ 的指数化 $\exp(\beta_3)$ 度量了对这个[乘性](@entry_id:187940)关系的偏离程度。具体来说，它是优势比的优势比：$\exp(\beta_3) = \frac{OR_{E_1|E_2=1}}{OR_{E_1|E_2=0}}$。

一个至关重要的区别是**[统计交互作用](@entry_id:169402)的[尺度依赖性](@entry_id:197044)** [@problem_id:4899244]。公共卫生决策者可能更关心风险的**相加性**，即通过**风险差 (Risk Difference, RD)** 来衡量的效应。一个在优势比尺度上是乘性的效应（即无[统计交互作用](@entry_id:169402)，$\beta_3=0$），在风险差尺度上通常不可能是相加的（反之亦然），这是因为从对数优势到概率（风险）的转换是非线性的（即logit函数）。因此，在Logistic回归中发现显著的[交互作用](@entry_id:164533)（$\beta_3 \neq 0$）表明存在**[乘性](@entry_id:187940)[交互作用](@entry_id:164533)**，但这并不直接等同于在公共卫生意义上更直观的**加性[交互作用](@entry_id:164533)**。要直接评估加性[交互作用](@entry_id:164533)，需要使用不同的模型，例如线性[二项模型](@entry_id:275034)（identity-link binomial model）。

#### 调整的精妙之处：混杂、中介与不可坍缩性

决定是否以及如何进行调整，需要对变量之间的因果关系有清晰的理解。

- **混杂 vs. 不可坍缩性 (Non-collapsibility)**：在线性模型中，如果一个协变量 $Z$ 与暴露 $X$ 无关，那么调整或不调整 $Z$ 不会改变 $X$ 的系数。然而，对于优势比而言，这一性质不成立。即使 $Z$ 与 $X$ 完全独立（即 $Z$ 不是混杂因子），只要 $Z$ 与结局 $Y$ 相关，边际OR（忽略 $Z$）通常也会不同于条件OR（调整 $Z$）[@problem_id:4899219]。这个数学特性被称为**优势比的不可坍缩性**。这意味着，在Logistic回归中，观察到粗略OR与调整后OR不同，这本身并**不**是混杂存在的确凿证据。它可能仅仅是OR这种度量的数学特性所致。

- **过度调整偏倚：中介变量的情况**：调整并非总是好事。如果我们错误地调整了一个位于暴露和结局之间因果路径上的变量——即**中介变量 (mediator)**，可能会导致**过度调整偏倚 (overadjustment bias)** [@problem_id:4899184]。考虑因果路径 $A \to M \to Y$，其中暴露 $A$ 通过影响中介变量 $M$ 来影响结局 $Y$。如果我们想估计 $A$ 对 $Y$ 的**总效应**（包括通过 $M$ 的间接效应），那么在回归模型中调整 $M$ 会人为地“阻断”这条间接路径。结果，模型估计出的 $A$ 的系数将仅反映其**直接效应**（不经过 $M$ 的那部分效应），这会低估 $A$ 的总效应。

- **调整代理混杂因子**：在实践中，真正的混杂因子 $U$（如“健康动机”）可能无法测量。但我们有时可以测量它的一个**代理 (proxy)** 变量 $C$（如“社区健康参与指数”），它受 $U$ 的影响。在这种情况下，调整代理变量 $C$ 通常是减少混杂偏倚的有效策略 [@problem_id:4899230]。然而，除非 $C$ 是 $U$ 的完美测量（即 $C$ 与 $U$ 之间存在确定性的一一对应关系），否则调整 $C$ 通常只能**部分**阻断由 $U$ 造成的后门路径。这意味着偏倚会被减小，但一般不会被完全消除。使用有向无环图 (DAGs) 和[d-分离](@entry_id:748152) (d-separation) 的形式化语言，可以精确地分析这类复杂情况下的偏倚方向和大小。

总之，在回归模型中处理分类变量、[交互作用](@entry_id:164533)和混杂，不仅需要技术上的熟练，更需要对潜在的[因果结构](@entry_id:159914)和所选[统计模型](@entry_id:755400)的数学特性有深刻的洞察力。明智的分析者必须超越机械的“调整”，根据具体的研究问题和背景知识来指导其建模策略。