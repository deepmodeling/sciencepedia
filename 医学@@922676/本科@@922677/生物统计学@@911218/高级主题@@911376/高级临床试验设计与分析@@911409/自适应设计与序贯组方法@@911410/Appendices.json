{"hands_on_practices": [{"introduction": "群组贯序试验的核心挑战是在进行多次分析的同时，不增加总体 I 型错误率。Alpha 消耗函数（alpha-spending functions）提供了一个优雅的解决方案，它将总显著性水平 $\\alpha$ 分配到各个期中分析中。这个练习题 [@problem_id:4892107] 提供了一个基础练习，让您应用一个常见的线性消耗函数来计算在试验的特定时间点已经“消耗”了多少总 $\\alpha$ 值，这是设置停止界值的关键。", "problem": "一项单侧成组序贯临床试验旨在检验一种治疗效果，计划总I类错误水平为$\\alpha$，在累积信息时间$t \\in [0,1]$内进行$K=4$次期中分析。该设计使用一个$\\alpha$消耗函数，定义为一个非递减函数$\\alpha(t)$，其中$\\alpha(0)=0$且$\\alpha(1)=\\alpha$，用以控制在各次分析中出现假阳性的累积概率。假设该设计指定了线性消耗函数$\\alpha(t)=\\alpha t$。第三次分析发生在信息分数为$t_3=0.75$时。\n\n计算到第3次分析时已累积消耗的总I类错误$\\alpha$的比例。请用小数表示你的答案，无需四舍五入。用一两句话解释这个比例对于第3次分析时提前终止的可能性与之前的分析相比意味着什么，但最终答案只报告数值比例。", "solution": "根据线性消耗函数 $\\alpha(t) = \\alpha t$ 的定义，在第3次分析时，信息时间为 $t_3 = 0.75$。将此值代入函数，我们得到在该时间点累积消耗的I类错误量为 $\\alpha(0.75) = \\alpha \\times 0.75$。因此，已累积消耗的总I类错误 $\\alpha$ 的比例是 $\\frac{0.75\\alpha}{\\alpha} = 0.75$。", "answer": "$$\n\\boxed{0.75}\n$$", "id": "4892107"}, {"introduction": "在了解了如何控制错误之后，我们可以关注使用群组贯序设计的主要动机：效率。能够因成功或无效而提前终止试验，可以节省大量时间、资源，并使更少的受试者暴露于可能较差的治疗之下。这个练习题 [@problem_id:4892080] 将指导您计算期望样本量（Expected Sample Size），这是一个量化效率提升的关键指标，也是评估和比较不同试验设计的基础。", "problem": "一项双臂随机临床试验采用成组序贯设计，包含一次期中分析和一次期末分析，旨在比较一种新疗法与对照组。主要终点近似服从正态分布，且各组间方差相等。在第 $k$ 次分析时的标准化检验统计量记为 $Z_k$。假设成组序贯统计量服从经典联合正态模型：根据中心极限定理 (CLT)，对于在第 $k$ 次分析时累积的信息分数 $t_k \\in (0,1]$，在真实标准化治疗效应为 $\\theta$ 的情况下，该统计量满足 $Z_k \\sim \\mathcal{N}(\\theta \\sqrt{t_k}, 1)$，其中 $\\mathcal{N}(\\mu,\\sigma^2)$ 表示均值为 $\\mu$、方差为 $\\sigma^2$ 的正态分布。\n\n该设计流程如下：\n- 计划的最大总样本量为 $n_{\\max} = 240$ 名受试者。\n- 期中分析在纳入 $n_1 = 120$ 名受试者后进行，因此信息分数为 $t_1 = n_1 / n_{\\max}$。\n- 在期中分析时采用双侧有效性中止规则：如果 $|Z_1| \\ge c_1$（其中 $c_1 = 2.0$），则因有效性而提前中止试验。如果未达到期中止规则，试验将继续进行，直至达到最大样本量 $n_{\\max}$ 进行期末分析。\n\n根据第一性原理，用分析指数的中止分布来定义此成组序贯设计的期望样本量，并推导期望样本量作为真实效应 $\\theta$、期中界值 $c_1$ 和计划的最大样本量 $n_{\\max}$ 的函数的解析表达式。然后，使用上述设计参数，计算当 $\\theta = 0.3$ 时的期望样本量。在适当之处使用标准正态累积分布函数 $\\Phi(\\cdot)$。将最终的期望样本量四舍五入至 4 位有效数字。以“受试者”为单位表示答案。", "solution": "该问题提法明确，在生物统计学原理上有科学依据，且包含足够的信息以得到唯一解。因此，该问题被认为是有效的。\n\n成组序贯设计的期望样本量，记为 $E[N|\\theta]$，取决于真实的治疗效应 $\\theta$。样本量 $N$ 是一个离散随机变量，在本例中可以取两个可能的值：如果试验在期中分析时中止，则为 $n_1$；如果试验继续到期末分析，则为 $n_{\\max}$。\n\n离散随机变量的期望值的定义是变量的每个可能值与其对应概率的乘积之和。因此，期望样本量由下式给出：\n$$\nE[N|\\theta] = n_1 \\cdot P(N=n_1 | \\theta) + n_{\\max} \\cdot P(N=n_{\\max} | \\theta)\n$$\n如果满足中止条件 $|Z_1| \\ge c_1$，试验将在期中分析时中止。在这种情况下，样本量为 $N=n_1$。该事件的概率为 $P(N=n_1 | \\theta) = P(|Z_1| \\ge c_1 | \\theta)$。\n如果未满足中止条件，即 $|Z_1|  c_1$，试验将继续到期末分析，样本量为 $N=n_{\\max}$。继续试验的概率为 $P(N=n_{\\max} | \\theta) = P(|Z_1|  c_1 | \\theta)$。\n\n由于这是第一阶段仅有的两种结果，其概率之和为 1：\n$$\nP(|Z_1|  c_1 | \\theta) = 1 - P(|Z_1| \\ge c_1 | \\theta)\n$$\n让我们将在期中分析时中止的概率记为 $p_1(\\theta) = P(|Z_1| \\ge c_1 | \\theta)$。期望样本量的表达式可以重写为：\n$$\nE[N|\\theta] = n_1 \\cdot p_1(\\theta) + n_{\\max} \\cdot (1 - p_1(\\theta))\n$$\n整理各项，我们得到一个更便于计算的形式：\n$$\nE[N|\\theta] = n_1 p_1(\\theta) + n_{\\max} - n_{\\max} p_1(\\theta) = n_{\\max} - (n_{\\max} - n_1)p_1(\\theta)\n$$\n下一步是推导中止概率 $p_1(\\theta)$ 的解析表达式。问题陈述，期中分析时的检验统计量 $Z_1$ 服从正态分布 $Z_1 \\sim \\mathcal{N}(\\theta\\sqrt{t_1}, 1)$，其中 $t_1$ 是第一阶段的信息分数。中止概率为：\n$$\np_1(\\theta) = P(|Z_1| \\ge c_1 | \\theta) = P(Z_1 \\ge c_1 \\text{ or } Z_1 \\le -c_1 | \\theta)\n$$\n这两个事件是互斥的，因此我们可以将它们的概率相加：\n$$\np_1(\\theta) = P(Z_1 \\ge c_1 | \\theta) + P(Z_1 \\le -c_1 | \\theta)\n$$\n为计算这些概率，我们对随机变量 $Z_1$ 进行标准化。设 $W$ 为一个标准正态随机变量，$W \\sim \\mathcal{N}(0, 1)$。那么 $Z_1$ 可以表示为 $Z_1 = W + \\theta\\sqrt{t_1}$。\n第一项是：\n$$\nP(Z_1 \\ge c_1) = P(W + \\theta\\sqrt{t_1} \\ge c_1) = P(W \\ge c_1 - \\theta\\sqrt{t_1})\n$$\n使用标准正态分布的累积分布函数 (CDF) $\\Phi(x) = P(W \\le x)$，我们有 $P(W \\ge a) = 1 - P(W  a) = 1 - \\Phi(a)$。因此：\n$$\nP(Z_1 \\ge c_1) = 1 - \\Phi(c_1 - \\theta\\sqrt{t_1})\n$$\n第二项是：\n$$\nP(Z_1 \\le -c_1) = P(W + \\theta\\sqrt{t_1} \\le -c_1) = P(W \\le -c_1 - \\theta\\sqrt{t_1}) = \\Phi(-c_1 - \\theta\\sqrt{t_1})\n$$\n综合这两项，中止概率为：\n$$\np_1(\\theta) = 1 - \\Phi(c_1 - \\theta\\sqrt{t_1}) + \\Phi(-c_1 - \\theta\\sqrt{t_1})\n$$\n使用恒等式 $\\Phi(-x) = 1 - \\Phi(x)$，这意味着 $1 - \\Phi(x) = \\Phi(-x)$，我们可以将第一项重写为：\n$$\n1 - \\Phi(c_1 - \\theta\\sqrt{t_1}) = \\Phi(-(c_1 - \\theta\\sqrt{t_1})) = \\Phi(\\theta\\sqrt{t_1} - c_1)\n$$\n这给出了中止概率的最终表达式：\n$$\np_1(\\theta) = \\Phi(\\theta\\sqrt{t_1} - c_1) + \\Phi(-c_1 - \\theta\\sqrt{t_1})\n$$\n信息分数 $t_1$ 定义为 $t_1 = n_1 / n_{\\max}$。将此式和 $p_1(\\theta)$ 的表达式代入 $E[N|\\theta]$ 的方程，我们得到所需的解析表达式：\n$$\nE[N|\\theta] = n_{\\max} - (n_{\\max} - n_1) \\left[ \\Phi\\left(\\theta\\sqrt{\\frac{n_1}{n_{\\max}}} - c_1\\right) + \\Phi\\left(-c_1 - \\theta\\sqrt{\\frac{n_1}{n_{\\max}}}\\right) \\right]\n$$\n现在，我们使用给定的参数计算该表达式的值：\n- 最大样本量: $n_{\\max} = 240$\n- 期中样本量: $n_1 = 120$\n- 期中止界值: $c_1 = 2.0$\n- 真实标准化效应: $\\theta = 0.3$\n\n首先，我们计算信息分数 $t_1$：\n$$\nt_1 = \\frac{n_1}{n_{\\max}} = \\frac{120}{240} = 0.5\n$$\n接下来，我们计算 $Z_1$ 的均值，即 $\\mu_1 = \\theta\\sqrt{t_1}$：\n$$\n\\mu_1 = 0.3 \\sqrt{0.5} = 0.3 \\times \\frac{1}{\\sqrt{2}} \\approx 0.212132\n$$\n现在我们为中止概率 $p_1(\\theta=0.3)$ 计算 $\\Phi$ 函数的自变量：\n$$\n\\theta\\sqrt{t_1} - c_1 \\approx 0.212132 - 2.0 = -1.787868\n$$\n$$\n-c_1 - \\theta\\sqrt{t_1} \\approx -2.0 - 0.212132 = -2.212132\n$$\n中止概率为：\n$$\np_1(0.3) = \\Phi(-1.787868) + \\Phi(-2.212132)\n$$\n使用标准统计表或软件查询标准正态累积分布函数：\n$$\n\\Phi(-1.787868) \\approx 0.036894\n$$\n$$\n\\Phi(-2.212132) \\approx 0.013481\n$$\n$$\np_1(0.3) \\approx 0.036894 + 0.013481 = 0.050375\n$$\n最后，我们计算期望样本量：\n$$\nE[N | \\theta=0.3] = n_{\\max} - (n_{\\max} - n_1) p_1(0.3)\n$$\n$$\nE[N | \\theta=0.3] \\approx 240 - (240 - 120) \\times 0.050375\n$$\n$$\nE[N | \\theta=0.3] \\approx 240 - 120 \\times 0.050375\n$$\n$$\nE[N | \\theta=0.3] \\approx 240 - 6.045\n$$\n$$\nE[N | \\theta=0.3] \\approx 233.955\n$$\n题目要求将答案四舍五入到 4 位有效数字。\n$$\n233.955 \\approx 234.0\n$$\n期望样本量约为 $234.0$ 名受试者。", "answer": "$$\\boxed{234.0}$$", "id": "4892080"}, {"introduction": "在许多领域（如肿瘤学），临床试验是“事件驱动”的，这意味着分析是在发生特定数量的事件（如疾病进展或死亡）后进行，而不仅仅是在招募了一定数量的患者后。这增加了一层现实世界的复杂性，因为这些分析的时间点取决于事件累积的速度。本题 [@problem_id:4892079] 提供了对这一过程进行建模的实践经验，以预测期中分析的日历时间，这是试验规划和管理的一项关键技能。", "problem": "一个生物统计学团队正在计划一项事件驱动的组序贯试验，该试验将使用对数秩检验（logrank test）比较两种疗法在时间-事件终点上的效果。该试验采用组序贯设计，在累积事件数达到 $d = (75, 150, 225, 300)$ 时进行四次期中分析，其中 $D = 300$ 是最终的目标总事件数。期中分析是由跨越这些事件阈值触发的，而不是由日历时间触发。\n\n为了规划期中分析的日历时间，该团队将累积事件过程建模为一个非齐次泊松过程，其瞬时事件强度 $\\lambda(t)$（事件数/月）是自首位患者随机化以来的日历时间 $t$（以月为单位）的函数。由于预期的启动和爬坡阶段，预期的事件累积速率是分段恒定的：\n$$\n\\lambda(t) = \n\\begin{cases}\n0,   0 \\leq t  3, \\\\\n6,   3 \\leq t  9, \\\\\n15,  9 \\leq t  15, \\\\\n25,  t \\geq 15.\n\\end{cases}\n$$\n使用此模型，到时间 $t$ 为止的预期累积事件数是累积强度函数 $\\Lambda(t) = \\int_{0}^{t} \\lambda(u)\\,du$。定义 $t_i$ 为第 $i$ 次分析发生的日历时间，它由方程 $\\Lambda(t_i) = d_i$（其中 $i = 1, 2, 3, 4$）确定。\n\n计算预期发生分析的日历时间向量 $t_i$。利用 $\\Lambda(t)$ 和 $\\lambda(t)$ 的结构，解释事件累积延迟如何影响事件驱动的组序贯试验中期中分析的时间安排。\n\n将每个 $t_i$ 四舍五入到三位有效数字。时间以月为单位表示。", "solution": "该问题要求计算一项事件驱动的组序贯试验中四次期中分析的预期日历时间。这些时间记为 $t_i$，由预期累积事件数达到特定阈值 $d_i$ 的时刻决定。事件累积过程被建模为一个具有给定的分段瞬时事件强度 $\\lambda(t)$ 的非齐次泊松过程。\n\n首先，我们必须确定累积强度函数 $\\Lambda(t)$，它表示到日历时间 $t$ 为止的预期事件数。这可以通过对瞬时强度 $\\lambda(t)$ 从 $0$ 到 $t$ 积分得到。给定的强度函数为：\n$$\n\\lambda(u) = \n\\begin{cases}\n0,   0 \\leq u  3 \\\\\n6,   3 \\leq u  9 \\\\\n15,  9 \\leq u  15 \\\\\n25,  u \\geq 15.\n\\end{cases}\n$$\n我们对 $t$ 的每个区间计算 $\\Lambda(t) = \\int_{0}^{t} \\lambda(u)\\,du$。\n\n对于 $0 \\leq t  3$：\n$$ \\Lambda(t) = \\int_{0}^{t} 0 \\, du = 0 $$\n\n对于 $3 \\leq t  9$：\n$$ \\Lambda(t) = \\int_{0}^{3} 0 \\, du + \\int_{3}^{t} 6 \\, du = 0 + [6u]_{3}^{t} = 6t - 18 $$\n在边界 $t=9$ 处，累积事件数为 $\\Lambda(9) = 6(9) - 18 = 54 - 18 = 36$。\n\n对于 $9 \\leq t  15$：\n$$ \\Lambda(t) = \\Lambda(9) + \\int_{9}^{t} 15 \\, du = 36 + [15u]_{9}^{t} = 36 + 15t - 15(9) = 36 + 15t - 135 = 15t - 99 $$\n在边界 $t=15$ 处，累积事件数为 $\\Lambda(15) = 15(15) - 99 = 225 - 99 = 126$。\n\n对于 $t \\geq 15$：\n$$ \\Lambda(t) = \\Lambda(15) + \\int_{15}^{t} 25 \\, du = 126 + [25u]_{15}^{t} = 126 + 25t - 25(15) = 126 + 25t - 375 = 25t - 249 $$\n\n因此，完整的分段累积强度函数为：\n$$\n\\Lambda(t) = \n\\begin{cases}\n0,  0 \\leq t  3 \\\\\n6t - 18,  3 \\leq t  9 \\\\\n15t - 99,  9 \\leq t  15 \\\\\n25t - 249,  t \\geq 15.\n\\end{cases}\n$$\n期中分析的时间 $t_i$ 是通过求解目标事件数 $d = (75, 150, 225, 300)$ 的方程 $\\Lambda(t_i) = d_i$ 得到的。\n\n为求 $t_1$，我们令 $\\Lambda(t_1) = d_1 = 75$。我们检查区间：\n由于 $\\Lambda(9) = 36$ 且 $\\Lambda(15) = 126$，条件 $36  75  126$ 意味着 $t_1$ 必须位于区间 $[9, 15)$ 内。我们使用 $\\Lambda(t)$ 在此区间的相应公式：\n$$ 15t_1 - 99 = 75 $$\n$$ 15t_1 = 174 $$\n$$ t_1 = \\frac{174}{15} = 11.6 $$\n四舍五入到三位有效数字， $t_1 = 11.6$ 个月。\n\n为求 $t_2$，我们令 $\\Lambda(t_2) = d_2 = 150$。\n由于 $\\Lambda(15) = 126$，且 $150 > 126$，$t_2$ 必须位于区间 $t \\geq 15$ 内。我们使用此区间的公式：\n$$ 25t_2 - 249 = 150 $$\n$$ 25t_2 = 399 $$\n$$ t_2 = \\frac{399}{25} = 15.96 $$\n四舍五入到三位有效数字， $t_2 = 16.0$ 个月。\n\n为求 $t_3$，我们令 $\\Lambda(t_3) = d_3 = 225$。\n由于 $225 > 126$，$t_3$ 也位于区间 $t \\geq 15$ 内：\n$$ 25t_3 - 249 = 225 $$\n$$ 25t_3 = 474 $$\n$$ t_3 = \\frac{474}{25} = 18.96 $$\n四舍五入到三位有效数字， $t_3 = 19.0$ 个月。\n\n为求 $t_4$，我们令 $\\Lambda(t_4) = d_4 = 300$。\n由于 $300 > 126$，$t_4$ 也位于区间 $t \\geq 15$ 内：\n$$ 25t_4 - 249 = 300 $$\n$$ 25t_4 = 549 $$\n$$ t_4 = \\frac{549}{25} = 21.96 $$\n四舍五入到三位有效数字， $t_4 = 22.0$ 个月。\n\n日历时间向量为 $(11.6, 16.0, 19.0, 22.0)$ 个月。\n\n关于事件累积延迟的影响，$\\lambda(t)$ 和 $\\Lambda(t)$ 的结构提供了清晰的解释。在事件驱动的试验中，分析的日历时间 $t_i$ 由累积强度函数的反函数确定，即 $t_i = \\Lambda^{-1}(d_i)$。根据定义，函数 $\\Lambda(t)$ 是事件速率 $\\lambda(t)$ 的积分。微积分基本定理指出 $\\frac{d}{dt}\\Lambda(t) = \\lambda(t)$，这意味着瞬时事件速率是累积事件曲线的斜率。\n\n所提供的 $\\lambda(t)$ 明确地对累积延迟进行了建模：\n1. 启动延迟：对于 $t \\in [0, 3)$，$\\lambda(t) = 0$。这导致在此期间 $\\Lambda(t) = 0$。事件累积的“时钟”直到 $t=3$ 个月时才开始计时，直接延迟了所有后续的里程碑。\n2. 爬坡阶段：对于 $t \\in [3, 9)$ 和 $t \\in [9, 15)$，速率 $\\lambda(t) = 6$ 和 $\\lambda(t) = 15$ 低于最终的稳态速率 $\\lambda(t) = 25$。\n\n任何 $\\lambda(t)$ 较低的时期都对应于 $\\Lambda(t)$ 曲线上斜率较平缓的一段。当斜率平缓时，要达到指定的累积事件增量（$\\Lambda(t)$ 图上的垂直上升），需要更长的日历时间（水平跨度）。因此，初始的零速率期和随后的较慢速率的爬坡阶段会拉长试验的时间线。如果事件累积速率从一开始（$t=0$）就是恒定的 $\\lambda(t) = 25$，那么达到任何事件数 $d_i$ 的时间将是 $t_i = d_i/25$，这会显著缩短时间。例如，第一次分析（$d_1=75$）预计将在 $t_1=3$ 个月时进行，而不是计算出的 $11.6$ 个月。因此，由 $\\lambda(t)$ 结构所建模的累积延迟，直接并定量地决定了达到试验中基于事件的终点所需的更长日历时间。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n11.6  16.0  19.0  22.0\n\\end{pmatrix}\n}\n$$", "id": "4892079"}]}