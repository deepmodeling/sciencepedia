{"hands_on_practices": [{"introduction": "广义线性模型（GLM）的拟合通常依赖于最大似然估计（MLE），即找到使对数似然函数最大化的参数。牛顿-拉夫逊等数值优化算法是实现这一目标的核心工具，而这些算法需要对数似然函数的梯度（Score）向量和海森（Hessian）矩阵。本练习 [@problem_id:4914224] 将引导您从第一性原理出发，为经典的逻辑斯蒂回归模型推导这些关键的组成部分，从而巩固您对GLM估计过程背后数学机理的理解。", "problem": "一项生物统计学研究记录了血样中特定生物标志物存在的二元结果。对于每个受试者 $i$（其中 $i \\in \\{1,\\dots,n\\}$），结果 $Y_{i} \\in \\{0,1\\}$ 表示生物标志物的不存在或存在，单个连续协变量 $X_{i} \\in \\mathbb{R}$ 记录了标准化的暴露得分。假设受试者是独立的，并且在给定 $X_{i}$ 的条件下，$Y_{i}$ 服从均值为 $\\mu_{i} = \\mathbb{E}(Y_{i} \\mid X_{i})$ 的伯努利模型。考虑一个广义线性模型 (GLM)，它使用伯努利分布的典则 logit 联接，因此联接函数满足 $\\ln\\!\\big(\\mu_{i}/(1-\\mu_{i})\\big) = \\beta_{0} + \\beta_{1} X_{i}$，其中 $\\beta = (\\beta_{0},\\beta_{1})^{\\top}$ 是一个包含截距和单个斜率的未知参数向量。仅从独立性假设、伯努利概率质量函数和典则联接的定义出发，推导以下量作为 $\\beta$ 和观测数据 $\\{(y_{i},x_{i})\\}_{i=1}^{n}$ 的显式函数：\n\n1. 对数似然 $\\ell(\\beta)$。\n2. 梯度（得分）向量 $\\nabla \\ell(\\beta)$。\n3. 海森矩阵 $\\nabla^{2} \\ell(\\beta)$。\n\n使用关于 $i$ 的求和以及 $\\beta$ 和数据的初等函数来表示每个量。您的最终表达式必须仅依赖于 $\\beta_{0}$、$\\beta_{1}$、$\\{x_{i}\\}_{i=1}^{n}$ 和 $\\{y_{i}\\}_{i=1}^{n}$，不得引入任何未定义的简写。最终答案应将这三个推导出的表达式作为一个单一的解析表达式一起呈现。不需要进行数值计算，也无需四舍五入。", "solution": "该问题陈述是广义线性模型 (GLM) 在二元数据背景下的一个标准推导练习，并已被验证为科学上可靠、适定、客观和完整的。没有任何缺陷。我们接下来推导对数似然、其梯度及其海森矩阵。\n\n该模型是为 $n$ 个独立受试者指定的，索引为 $i=1, \\dots, n$。对于每个受试者，我们有一个二元结果 $Y_i \\in \\{0, 1\\}$ 和一个连续协变量 $X_i \\in \\mathbb{R}$。\n在给定 $X_i=x_i$ 的条件下，$Y_i$ 的条件分布是均值为 $\\mu_i = \\mathbb{E}(Y_i \\mid X_i)$ 的伯努利分布。单个观测值 $y_i$ 的概率质量函数 (PMF) 为：\n$$ P(Y_i = y_i \\mid X_i=x_i) = \\mu_i^{y_i} (1-\\mu_i)^{1-y_i} $$\n该模型使用 logit 联接函数，它将均值 $\\mu_i$ 与线性预测量 $\\eta_i$ 联系起来：\n$$ \\eta_i = \\ln\\left(\\frac{\\mu_i}{1-\\mu_i}\\right) = \\beta_0 + \\beta_1 x_i $$\n其中 $\\beta = (\\beta_0, \\beta_1)^\\top$ 是参数向量。\n\n为了用 $\\beta$ 表示似然，我们必须首先将 $\\mu_i$ 表示为 $\\eta_i$ 的函数。对 logit 联接函数求逆可得：\n$$ \\frac{\\mu_i}{1-\\mu_i} = \\exp(\\eta_i) \\implies \\mu_i = \\exp(\\eta_i) - \\mu_i \\exp(\\eta_i) \\implies \\mu_i(1+\\exp(\\eta_i)) = \\exp(\\eta_i) $$\n$$ \\mu_i = \\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = \\frac{1}{1+\\exp(-\\eta_i)} $$\n此外，我们求出 $1-\\mu_i$ 的表达式：\n$$ 1 - \\mu_i = 1 - \\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = \\frac{1+\\exp(\\eta_i)-\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = \\frac{1}{1+\\exp(\\eta_i)} $$\n\n在将 $\\mu_i$ 用 $\\eta_i = \\beta_0 + \\beta_1 x_i$ 定义后，我们现在可以推导所需的量。观测数据表示为 $\\{(y_i, x_i)\\}_{i=1}^n$。\n\n**1. 对数似然函数 $\\ell(\\beta)$**\n\n由于受试者的独立性，总似然 $L(\\beta)$ 是各个概率的乘积：\n$$ L(\\beta) = \\prod_{i=1}^n P(Y_i=y_i \\mid X_i=x_i) = \\prod_{i=1}^n \\mu_i^{y_i} (1-\\mu_i)^{1-y_i} $$\n对数似然 $\\ell(\\beta)$ 是 $L(\\beta)$ 的自然对数：\n$$ \\ell(\\beta) = \\ln(L(\\beta)) = \\sum_{i=1}^n \\ln(\\mu_i^{y_i} (1-\\mu_i)^{1-y_i}) = \\sum_{i=1}^n \\left[ y_i \\ln(\\mu_i) + (1-y_i)\\ln(1-\\mu_i) \\right] $$\n使用 $\\ln(\\mu_i) = \\ln(\\exp(\\eta_i)) - \\ln(1+\\exp(\\eta_i)) = \\eta_i - \\ln(1+\\exp(\\eta_i))$ 和 $\\ln(1-\\mu_i) = -\\ln(1+\\exp(\\eta_i))$，我们将它们代入 $\\ell(\\beta)$ 的表达式中：\n$$ \\ell(\\beta) = \\sum_{i=1}^n \\left[ y_i (\\eta_i - \\ln(1+\\exp(\\eta_i))) + (1-y_i)(-\\ln(1+\\exp(\\eta_i))) \\right] $$\n$$ \\ell(\\beta) = \\sum_{i=1}^n \\left[ y_i \\eta_i - y_i \\ln(1+\\exp(\\eta_i)) - \\ln(1+\\exp(\\eta_i)) + y_i \\ln(1+\\exp(\\eta_i)) \\right] $$\n$$ \\ell(\\beta) = \\sum_{i=1}^n \\left[ y_i \\eta_i - \\ln(1+\\exp(\\eta_i)) \\right] $$\n代入 $\\eta_i = \\beta_0 + \\beta_1 x_i$：\n$$ \\ell(\\beta) = \\sum_{i=1}^{n} \\left[ y_{i}(\\beta_{0} + \\beta_{1}x_{i}) - \\ln(1 + \\exp(\\beta_{0} + \\beta_{1}x_{i})) \\right] $$\n\n**2. 梯度（得分）向量 $\\nabla \\ell(\\beta)$**\n\n梯度向量包含 $\\ell(\\beta)$ 对 $\\beta_0$ 和 $\\beta_1$ 的偏导数。让我们计算关于泛型参数 $\\beta_j$ 的偏导数，其中 $j \\in \\{0, 1\\}$。\n使用链式法则，$\\frac{\\partial \\ell}{\\partial \\beta_j} = \\sum_{i=1}^n \\frac{\\partial \\ell_i}{\\partial \\eta_i} \\frac{\\partial \\eta_i}{\\partial \\beta_j}$，其中 $\\ell_i$ 是对数似然和中的第 $i$ 项。\n$$ \\frac{\\partial \\ell_i}{\\partial \\eta_i} = \\frac{\\partial}{\\partial \\eta_i} \\left[ y_i \\eta_i - \\ln(1+\\exp(\\eta_i)) \\right] = y_i - \\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)} = y_i - \\mu_i $$\n线性预测量的导数为 $\\frac{\\partial \\eta_i}{\\partial \\beta_0} = 1$ 和 $\\frac{\\partial \\eta_i}{\\partial \\beta_1} = x_i$。\n\n对于 $\\beta_0$：\n$$ \\frac{\\partial \\ell}{\\partial \\beta_0} = \\sum_{i=1}^n (y_i - \\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_0} = \\sum_{i=1}^n (y_i - \\mu_i) \\cdot 1 = \\sum_{i=1}^{n} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) $$\n对于 $\\beta_1$：\n$$ \\frac{\\partial \\ell}{\\partial \\beta_1} = \\sum_{i=1}^n (y_i - \\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_1} = \\sum_{i=1}^n (y_i - \\mu_i) x_i = \\sum_{i=1}^{n} x_{i} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) $$\n梯度向量是：\n$$ \\nabla \\ell(\\beta) = \\begin{pmatrix} \\frac{\\partial \\ell}{\\partial \\beta_0} \\\\ \\frac{\\partial \\ell}{\\partial \\beta_1} \\end{pmatrix} = \\begin{pmatrix} \\sum_{i=1}^{n} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) \\\\ \\sum_{i=1}^{n} x_{i} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) \\end{pmatrix} $$\n\n**3. 海森矩阵 $\\nabla^2 \\ell(\\beta)$**\n\n海森矩阵由二阶偏导数组成。我们计算 $\\frac{\\partial^2 \\ell}{\\partial \\beta_j \\partial \\beta_k}$，其中 $j,k \\in \\{0, 1\\}$。\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_j \\partial \\beta_k} = \\frac{\\partial}{\\partial \\beta_k} \\left( \\frac{\\partial \\ell}{\\partial \\beta_j} \\right) = \\frac{\\partial}{\\partial \\beta_k} \\sum_{i=1}^n (y_i - \\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_j} = \\sum_{i=1}^n \\left( -\\frac{\\partial \\mu_i}{\\partial \\beta_k} \\right) \\frac{\\partial \\eta_i}{\\partial \\beta_j} $$\n我们需要 $\\mu_i$ 对 $\\beta_k$ 的导数：\n$$ \\frac{\\partial \\mu_i}{\\partial \\beta_k} = \\frac{\\partial \\mu_i}{\\partial \\eta_i} \\frac{\\partial \\eta_i}{\\partial \\beta_k} $$\n导数 $\\frac{\\partial \\mu_i}{\\partial \\eta_i}$ 是：\n$$ \\frac{\\partial \\mu_i}{\\partial \\eta_i} = \\frac{\\partial}{\\partial \\eta_i}\\left(\\frac{\\exp(\\eta_i)}{1+\\exp(\\eta_i)}\\right) = \\frac{\\exp(\\eta_i)(1+\\exp(\\eta_i)) - \\exp(\\eta_i)\\exp(\\eta_i)}{(1+\\exp(\\eta_i))^2} = \\frac{\\exp(\\eta_i)}{(1+\\exp(\\eta_i))^2} $$\n这可以写成 $\\mu_i (1-\\mu_i)$。因此，$\\frac{\\partial \\mu_i}{\\partial \\beta_k} = \\mu_i(1-\\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_k}$。\n将此代入二阶导数表达式中：\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_j \\partial \\beta_k} = - \\sum_{i=1}^n \\left(\\mu_i (1-\\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_k}\\right) \\frac{\\partial \\eta_i}{\\partial \\beta_j} = - \\sum_{i=1}^n \\mu_i (1-\\mu_i) \\frac{\\partial \\eta_i}{\\partial \\beta_j} \\frac{\\partial \\eta_i}{\\partial \\beta_k} $$\n令 $x_{i0}=1$ 和 $x_{i1}=x_i$，所以 $\\frac{\\partial \\eta_i}{\\partial \\beta_j} = x_{ij}$。\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_j \\partial \\beta_k} = - \\sum_{i=1}^n x_{ij} x_{ik} \\mu_i(1-\\mu_i) $$\n其中 $\\mu_i(1-\\mu_i) = \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}}$。\n\n海森矩阵的四个元素是：\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_0^2} = - \\sum_{i=1}^n (1)^2 \\mu_i(1-\\mu_i) = -\\sum_{i=1}^{n} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} $$\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_0 \\partial \\beta_1} = \\frac{\\partial^2 \\ell}{\\partial \\beta_1 \\partial \\beta_0} = - \\sum_{i=1}^n (1)(x_i) \\mu_i(1-\\mu_i) = -\\sum_{i=1}^{n} x_{i} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} $$\n$$ \\frac{\\partial^2 \\ell}{\\partial \\beta_1^2} = - \\sum_{i=1}^n (x_i)^2 \\mu_i(1-\\mu_i) = -\\sum_{i=1}^{n} x_{i}^{2} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} $$\n因此，海森矩阵是：\n$$ \\nabla^2 \\ell(\\beta) = \\begin{pmatrix} -\\sum_{i=1}^{n} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}}  -\\sum_{i=1}^{n} x_{i} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} \\\\ -\\sum_{i=1}^{n} x_{i} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}}  -\\sum_{i=1}^{n} x_{i}^{2} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} \\end{pmatrix} $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sum_{i=1}^{n} \\left[ y_{i}(\\beta_{0} + \\beta_{1}x_{i}) - \\ln(1 + \\exp(\\beta_{0} + \\beta_{1}x_{i})) \\right] \\\\\n\\begin{pmatrix} \\sum_{i=1}^{n} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) \\\\ \\sum_{i=1}^{n} x_{i} \\left( y_{i} - \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{1+\\exp(\\beta_{0}+\\beta_{1}x_{i})} \\right) \\end{pmatrix} \\\\\n\\begin{pmatrix} -\\sum_{i=1}^{n} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}}  -\\sum_{i=1}^{n} x_{i} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} \\\\ -\\sum_{i=1}^{n} x_{i} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}}  -\\sum_{i=1}^{n} x_{i}^{2} \\frac{\\exp(\\beta_{0}+\\beta_{1}x_{i})}{(1+\\exp(\\beta_{0}+\\beta_{1}x_{i}))^{2}} \\end{pmatrix}\n\\end{pmatrix}\n}\n$$", "id": "4914224"}, {"introduction": "模型拟合完成后，下一步是利用它进行预测和结果解释。在用于分析率数据的泊松回归中，模型估计的是事件发生率 $\\lambda_i$，当结合暴露量 $t_i$（例如“人年”）时，可以得到预期的事件计数 $\\mu_i$。此实践练习 [@problem_id:4914209] 演示了如何将泊松GLM的估计系数 $\\hat{\\beta}$ 转化为生物统计学场景中具体且可解释的量，例如发病率和预期事件数，并突出了偏移量（offset）在率模型中的重要作用。", "problem": "一项生物统计学的队列研究测量了三个地点的某种状况的发病计数，暴露量以人年为单位记录。这些计数使用泊松广义线性模型（GLM）进行建模，其中地点 $i$ 的响应是计数 $Y_i$，假定其服从均值为 $E(Y_i)=\\mu_i$ 的泊松分布。该模型使用自然对数连接函数，并通过一个偏移量来整合暴露量，使得线性预测变量在协变量和暴露量上是可加的。\n\n协变量向量为 $x_i=\\begin{pmatrix}1  a_i  z_i\\end{pmatrix}^{\\top}$，其中 $a_i$ 是相对于50岁基线的年龄偏差（以十年为单位），$z_i$ 是表示是否接受治疗的二元指示变量。假设该GLM已被拟合，并得到估计的系数向量 $\\hat{\\beta}=\\begin{pmatrix}-3.2  0.4  0.6\\end{pmatrix}^{\\top}$。对于三个地点，观测到的协变量和暴露量如下：\n- 地点 $1$：$x_1=\\begin{pmatrix}1  1.0  0\\end{pmatrix}^{\\top}$，暴露量 $t_1=180$ 人年。\n- 地点 $2$：$x_2=\\begin{pmatrix}1  -0.5  1\\end{pmatrix}^{\\top}$，暴露量 $t_2=320$ 人年。\n- 地点 $3$：$x_3=\\begin{pmatrix}1  2.0  1\\end{pmatrix}^{\\top}$，暴露量 $t_3=140$ 人年。\n\n从泊松分布和带有对数连接函数及暴露偏移量的GLM框架的核心定义出发，推导用 $x_i$、$t_i$ 和 $\\hat{\\beta}$ 表示的拟合发病率 $\\hat{\\lambda}_i$ 和期望计数 $\\hat{\\mu}_i$ 的表达式。然后，使用上述值计算 $i=1,2,3$ 时 $\\hat{\\lambda}_i$ 和 $\\hat{\\mu}_i$ 的数值，并验证率和计数的单位是一致的。将所有数值结果四舍五入至四位有效数字。将最终答案表示为按顺序包含 $\\hat{\\lambda}_1$、$\\hat{\\lambda}_2$、$\\hat{\\lambda}_3$、$\\hat{\\mu}_1$、$\\hat{\\mu}_2$、$\\hat{\\mu}_3$ 的单行矩阵。最终矩阵中不应包含任何单位。", "solution": "该问题是有效的，因为它在科学上基于标准的生物统计建模，问题陈述清晰并包含了所有必要信息，且表述客观。我们可以着手求解。\n\n该问题描述了一个用于处理地点 $i$（其中 $i \\in \\{1, 2, 3\\}$）的计数数据 $Y_i$ 的泊松广义线性模型（GLM）。GLM的核心组成部分如下：\n$1$. **随机部分** 指定了响应变量的概率分布。此处，计数 $Y_i$ 假定服从均值为 $\\mu_i$ 的泊松分布：\n$$Y_i \\sim \\text{Poisson}(\\mu_i)$$\n期望值为 $E[Y_i] = \\mu_i$。\n\n$2$. **系统部分** 是线性预测变量 $\\eta_i$，它是协变量 $x_i$ 和系数 $\\beta$ 的线性组合：\n$$\\eta_i = x_i^{\\top}\\beta$$\n\n$3$. **连接函数** $g$ 将响应的期望值 $\\mu_i$ 与线性预测变量 $\\eta_i$ 联系起来。问题中说明了使用自然对数连接函数，$g(\\cdot) = \\ln(\\cdot)$。此外，模型将暴露量 $t_i$（以人年为单位）作为偏移量纳入。在泊松GLM中，这通过对率 $\\lambda_i = \\mu_i / t_i$ 建模来形式化。连接函数应用于均值，因此模型方程为：\n$$g(\\mu_i) = \\eta_i + \\text{offset}_i$$\n对于对数连接和对数暴露量偏移，这变为：\n$$\\ln(\\mu_i) = x_i^{\\top}\\beta + \\ln(t_i)$$\n这种结构等价于直接对发病率 $\\lambda_i$ 的对数进行建模。为证明这一点，我们代入 $\\mu_i = \\lambda_i t_i$：\n$$\\ln(\\lambda_i t_i) = x_i^{\\top}\\beta + \\ln(t_i)$$\n利用对数的性质 $\\ln(a b) = \\ln(a) + \\ln(b)$，我们得到：\n$$\\ln(\\lambda_i) + \\ln(t_i) = x_i^{\\top}\\beta + \\ln(t_i)$$\n$$\\ln(\\lambda_i) = x_i^{\\top}\\beta$$\n这证实了该模型是针对对数发病率的。\n\n问题给出了估计的系数向量 $\\hat{\\beta}$。我们用它来求拟合值。地点 $i$ 的拟合线性预测变量是 $\\hat{\\eta}_i = x_i^{\\top}\\hat{\\beta}$。\n\n拟合发病率 $\\hat{\\lambda}_i$ 的表达式通过对对数率的拟合模型取指数得到：\n$$\\ln(\\hat{\\lambda}_i) = x_i^{\\top}\\hat{\\beta}$$\n$$\\hat{\\lambda}_i = \\exp(x_i^{\\top}\\hat{\\beta})$$\n$\\hat{\\lambda}_i$ 的单位是 事件/人年，由暴露量 $t_i$ 的单位决定。\n\n拟合期望计数 $\\hat{\\mu}_i$ 的表达式从关系式 $\\hat{\\mu}_i = \\hat{\\lambda}_i t_i$ 推导得出：\n$$\\hat{\\mu}_i = t_i \\hat{\\lambda}_i = t_i \\exp(x_i^{\\top}\\hat{\\beta})$$\n单位是一致的：$\\hat{\\mu}_i$（一个无量纲的计数）是 $t_i$（人年）和 $\\hat{\\lambda}_i$（事件/人年）的乘积。\n\n给定的数据是：\n- 估计的系数向量：$\\hat{\\beta}=\\begin{pmatrix}-3.2  0.4  0.6\\end{pmatrix}^{\\top}$。\n- 地点 $1$：$x_1=\\begin{pmatrix}1  1.0  0\\end{pmatrix}^{\\top}$，$t_1=180$ 人年。\n- 地点 $2$：$x_2=\\begin{pmatrix}1  -0.5  1\\end{pmatrix}^{\\top}$，$t_2=320$ 人年。\n- 地点 $3$：$x_3=\\begin{pmatrix}1  2.0  1\\end{pmatrix}^{\\top}$，$t_3=140$ 人年。\n\n现在我们为每个地点计算数值。\n\n**对于地点 1：**\n线性预测变量为：\n$$\\hat{\\eta}_1 = x_1^{\\top}\\hat{\\beta} = (1)(-3.2) + (1.0)(0.4) + (0)(0.6) = -3.2 + 0.4 = -2.8$$\n拟合的发病率为：\n$$\\hat{\\lambda}_1 = \\exp(-2.8) \\approx 0.06081006$$\n四舍五入至四位有效数字，$\\hat{\\lambda}_1 = 0.06081$。\n拟合的期望计数为：\n$$\\hat{\\mu}_1 = t_1 \\hat{\\lambda}_1 = 180 \\times \\exp(-2.8) \\approx 10.94581$$\n四舍五入至四位有效数字，$\\hat{\\mu}_1 = 10.95$。\n\n**对于地点 2：**\n线性预测变量为：\n$$\\hat{\\eta}_2 = x_2^{\\top}\\hat{\\beta} = (1)(-3.2) + (-0.5)(0.4) + (1)(0.6) = -3.2 - 0.2 + 0.6 = -2.8$$\n拟合的发病率为：\n$$\\hat{\\lambda}_2 = \\exp(-2.8) \\approx 0.06081006$$\n四舍五入至四位有效数字，$\\hat{\\lambda}_2 = 0.06081$。\n拟合的期望计数为：\n$$\\hat{\\mu}_2 = t_2 \\hat{\\lambda}_2 = 320 \\times \\exp(-2.8) \\approx 19.45922$$\n四舍五入至四位有效数字，$\\hat{\\mu}_2 = 19.46$。\n\n**对于地点 3：**\n线性预测变量为：\n$$\\hat{\\eta}_3 = x_3^{\\top}\\hat{\\beta} = (1)(-3.2) + (2.0)(0.4) + (1)(0.6) = -3.2 + 0.8 + 0.6 = -1.8$$\n拟合的发病率为：\n$$\\hat{\\lambda}_3 = \\exp(-1.8) \\approx 0.16529888$$\n四舍五入至四位有效数字，$\\hat{\\lambda}_3 = 0.1653$。\n拟合的期望计数为：\n$$\\hat{\\mu}_3 = t_3 \\hat{\\lambda}_3 = 140 \\times \\exp(-1.8) \\approx 23.14184$$\n四舍五入至四位有效数字，$\\hat{\\mu}_3 = 23.14$。\n\n最终结果，四舍五入至四位有效数字，为：\n$\\hat{\\lambda}_1 = 0.06081$\n$\\hat{\\lambda}_2 = 0.06081$\n$\\hat{\\lambda}_3 = 0.1653$\n$\\hat{\\mu}_1 = 10.95$\n$\\hat{\\mu}_2 = 19.46$\n$\\hat{\\mu}_3 = 23.14$\n\n按要求将这些结果合并为一个单行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.06081  0.06081  0.1653  10.95  19.46  23.14\n\\end{pmatrix}\n}\n$$", "id": "4914209"}, {"introduction": "正确设定广义线性模型是进行有效统计推断的基石，其中一个常见的混淆点在于偏移量（offset）的正确使用。本练习 [@problem_id:4914184] 旨在挑战您批判性地思考二项分布模型中的“试验次数”与泊松分布模型中的“暴露量”有何本质区别。通过解决这个概念性问题，您将理解为何在二项模型中简单地将试验次数的对数 $\\ln(m_i)$ 作为偏移量是不恰当的，从而加深您对不同GLM理论基础的认识。", "problem": "一项生物统计学研究汇总了多个临床试验点的结果。对于具有协变量向量 $\\mathbf{x}_i \\in \\mathbb{R}^p$ 的试验点 $i$，有 $m_i$ 个个体接受了检测，其中 $y_i$ 个体检测结果为阳性，这里 $Y_i \\sim \\text{Binomial}(m_i,p_i)$ 且 $p_i \\in (0,1)$ 是该试验点特有的阳性概率。一位分析师建议拟合一个具有 logit 链接的广义线性模型（GLM），并在线性预测器中包含 $\\log m_i$ 作为偏移量（offset），以“调整组别大小”。\n\n使用广义线性模型（GLM）框架的第一性原理——即一个GLM指定 (i) 来自正则指数族的响应分布，(ii) 一个系统分量 $\\eta_i=\\mathbf{x}_i^\\top \\beta + o_i$（其中 $o_i$ 是已知偏移量），以及 (iii) 一个链接函数 $g$ 使得 $g(\\mu_i)=\\eta_i$（其中 $\\mu_i=E(Y_i)$）——来确定在二项 logit 模型中添加 $\\log m_i$ 作为偏移量是否合适。通过对比泊松对数线性模型中暴露（exposure）的角色和二项模型中试验次数的角色来证明你的推理，从以下定义出发：\n- 对于泊松计数：$Y_i \\sim \\text{Poisson}(\\mu_i)$，当 $\\mu_i=t_i \\lambda_i$ 且 $t_i$ 是已知暴露时，有 $\\log \\mu_i=\\mathbf{x}_i^\\top \\beta + \\log t_i$，以及\n- 对于分组二项结果：$Y_i \\sim \\text{Binomial}(m_i,p_i)$，其典则链接为 $g(p_i)=\\log\\{p_i/(1-p_i)\\}$。\n\n选择唯一一个最佳选项，该选项既解释了为什么在二项 logit 模型中包含 $\\log m_i$ 作为偏移量是不合适的，又正确地指明了在这种情况下如何对分组二项结果进行建模。\n\nA. 在对计数 $y_i$ 的逻辑斯谛回归中包含 $\\log m_i$ 作为偏移量，这样模型估计的是期望计数 $\\mu_i=m_i p_i$ 的对数几率，即 $\\text{logit}(\\mu_i)=\\mathbf{x}_i^\\top \\beta + \\log m_i$，从而恰当地调整了不同组别的大小。\n\nB. 建立模型 $Y_i \\sim \\text{Binomial}(m_i,p_i)$ 并通过 $\\text{logit}(p_i)=\\mathbf{x}_i^\\top \\beta$ 来链接概率，在二项模型中不使用任何偏移量；可以通过使用双列响应 $\\text{cbind}(y_i, m_i-y_i)$ 或通过对比例 $y_i/m_i$ 使用二项权重 $m_i$ 进行回归来实现。$\\log m_i$ 这一项仅在泊松对数线性模型中是合适的偏移量，其中 $\\mu_i=t_i \\lambda_i$ 且 $\\log \\mu_i=\\log t_i + \\mathbf{x}_i^\\top \\beta$。\n\nC. 取变换后的响应 $\\log(y_i/m_i)$ 并拟合一个具有恒等链接的高斯线性模型，同时添加 $\\log m_i$ 作为偏移量以稳定不同 $m_i$ 的试验点之间的方差。\n\nD. 对 $y_i$ 拟合一个带有偏移量 $\\log m_i$ 的泊松回归来为事件率 $\\lambda_i$ 建模，这对于任何 $p_i \\in (0,1)$ 都完全等同于二项 logit 模型，因此证明了在二项设置中使用偏移量方法的合理性。", "solution": "用户希望在广义线性模型（GLM）框架内对一个提议的统计模型进行批判性评估。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n-   一项研究汇总了多个临床试验点的数据，以 $i$ 为索引。\n-   对于试验点 $i$，协变量向量为 $\\mathbf{x}_i \\in \\mathbb{R}^p$。\n-   在试验点 $i$，有 $m_i$ 个个体接受了检测，其中 $y_i$ 个体检测结果为阳性。\n-   阳性检测数 $Y_i$ 被建模为一个服从二项分布的随机变量：$Y_i \\sim \\text{Binomial}(m_i, p_i)$。\n-   试验点特有的阳性概率为 $p_i \\in (0,1)$。\n-   一位分析师建议使用一个具有 logit 链接的 GLM，并在线性预测器中包含 $\\log m_i$ 作为偏移量。\n-   任务是确定此提议是否合适，并通过对比泊松模型中暴露的角色和二项模型中试验次数的角色来证明答案。\n-   为泊松模型提供的定义是：$Y_i \\sim \\text{Poisson}(\\mu_i)$，其均值 $\\mu_i$ 的模型为 $\\log \\mu_i=\\mathbf{x}_i^\\top \\beta + \\log t_i$，该模型源自 $\\mu_i=t_i \\lambda_i$，其中 $t_i$ 是已知的暴露。\n-   为分组二项模型提供的定义是：$Y_i \\sim \\text{Binomial}(m_i, p_i)$，其典则链接函数为 logit，即 $g(p_i)=\\log\\{p_i/(1-p_i)\\}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题设定在广义线性模型的成熟数学和统计框架内。二项分布和泊松分布、logit 和 log 链接以及偏移量的概念在生物统计学中都是标准的。该问题在科学上和事实上都是合理的。\n-   **问题明确**：该问题定义明确。它要求基于 GLM 的第一性原理来评估一个特定的建模选择（在二项 logit 模型中使用 $\\log m_i$ 作为偏移量）。可以从这些原理中得出一个唯一且正确的结论。\n-   **客观性**：该问题使用了精确、客观和标准的统计术语。没有歧义或主观性语言。\n\n**步骤 3：结论和行动**\n问题陈述是有效的。这是一个关于正确应用 GLM 理论的、定义明确且有科学依据的问题。开始进行求解。\n\n### 从第一性原理推导\n\n广义线性模型（GLM）由三个部分定义：\n1.  **随机分量**：响应变量 $Y_i$ 的概率分布，必须是指数族的一员。\n2.  **系统分量**：一个线性预测器 $\\eta_i$，是协变量的线性组合。其一般形式为 $\\eta_i = \\mathbf{x}_i^\\top \\beta + o_i$，其中 $o_i$ 是一个已知的偏移量。\n3.  **链接函数**：一个单调可微的函数 $g$，它将响应的期望值 $\\mu_i = E(Y_i)$ 与线性预测器关联起来：$g(\\mu_i) = \\eta_i$。\n\n让我们分析问题中提到的两种情况：泊松模型和二项模型。\n\n**情况 1：泊松对数线性模型**\n对于泊松模型，响应 $Y_i$ 代表事件的计数。\n-   **随机分量**：$Y_i \\sim \\text{Poisson}(\\mu_i)$。\n-   期望值为 $E(Y_i) = \\mu_i$。\n-   在许多应用中，我们感兴趣的是对某个已知的“暴露”时期或体积 $t_i$ 内的事件*率* $\\lambda_i$ 进行建模。期望计数就是率乘以暴露：$\\mu_i = t_i \\lambda_i$。\n-   泊松分布的典则链接函数是对数链接，$g(\\mu_i) = \\log(\\mu_i)$。\n-   系统分量对率的对数进行建模：$\\log(\\lambda_i) = \\mathbf{x}_i^\\top \\beta$。\n-   通过链接函数将这些元素组合起来：\n    $$ g(\\mu_i) = \\log(\\mu_i) = \\log(t_i \\lambda_i) = \\log(t_i) + \\log(\\lambda_i) $$\n    代入率的对数模型，我们得到线性预测器：\n    $$ \\eta_i = \\mathbf{x}_i^\\top \\beta + \\log(t_i) $$\n-   这与形式 $\\eta_i = \\mathbf{x}_i^\\top \\beta + o_i$ 相匹配，其中偏移量 $o_i$ 是 $\\log(t_i)$。在这里，偏移量是模型的一个关键部分，它允许我们在考虑变化的暴露 $t_i$ 的同时对率 $\\lambda_i$ 进行建模。偏移量的系数固定为1。\n\n**情况 2：二项 Logit 线性模型**\n这里，响应 $Y_i$ 是 $m_i$ 次“试验”中“成功”的次数。\n-   **随机分量**：$Y_i \\sim \\text{Binomial}(m_i, p_i)$。我们希望建模的参数是成功概率 $p_i$。\n-   计数的期望值为 $E(Y_i) = m_i p_i$。\n-   与泊松情况不同，二项分布的 GLM 框架是对潜在的概率参数 $p_i$ 进行建模，而不是期望计数 $m_i p_i$。将响应视为比例 $Y_i/m_i$ 更为自然，其期望为 $E(Y_i / m_i) = p_i$。链接函数应用于此期望值。\n-   二项分布的典则链接函数是 logit 链接：$g(p_i) = \\log \\left(\\frac{p_i}{1-p_i}\\right)$。\n-   系统分量是协变量的线性函数：$\\eta_i = \\mathbf{x}_i^\\top \\beta$。\n-   将这些组合起来，得到分组数据的标准逻辑斯谛回归模型：\n    $$ \\log \\left(\\frac{p_i}{1-p_i}\\right) = \\mathbf{x}_i^\\top \\beta $$\n-   试验次数 $m_i$ 不是线性预测器的一部分。它的作用是定义随机分量的分布。具体来说，它决定了观测的精度：比例 $Y_i/m_i$ 的方差是 $\\text{Var}(Y_i/m_i) = \\frac{p_i(1-p_i)}{m_i}$。在 GLM 的最大似然估计算法中，$m_i$ 充当权重，表明来自较大 $m_i$ 的试验点的比例信息更丰富，应给予更大的权重。\n\n**评估分析师的提议**\n分析师建议在二项 logit 模型中包含 $\\log m_i$ 作为偏移量。这将意味着：\n$$ \\log \\left(\\frac{p_i}{1-p_i}\\right) = \\mathbf{x}_i^\\top \\beta + \\log m_i $$\n这个模型在结构上是不正确的。它意味着阳性检测的对数几率直接取决于在该试验点检测的人数，这在概念上是有缺陷的。对于给定的协变量集 $\\mathbf{x}_i$，增加样本量 $m_i$ 不应系统性地改变潜在的总体概率 $p_i$。试验次数 $m_i$ 是试验点 $i$ 的研究设计特征，而不是影响个体检测阳性概率的属性。分析师错误地将二项模型中试验次数（$m_i$）的角色与泊松模型中暴露（$t_i$）的角色混为一谈。因此，包含 $\\log m_i$ 作为偏移量是不合适的。\n\n### 逐项分析选项\n\n**A. 在对计数 $y_i$ 的逻辑斯谛回归中包含 $\\log m_i$ 作为偏移量，这样模型估计的是期望计数 $\\mu_i=m_i p_i$ 的对数几率，即 $\\text{logit}(\\mu_i)=\\mathbf{x}_i^\\top \\beta + \\log m_i$，从而恰当地调整了不同组别的大小。**\n这个提议在数学上是无效的。logit 函数 $\\text{logit}(z) = \\log(z/(1-z))$ 的定义域是 $z \\in (0,1)$。期望计数 $\\mu_i = m_i p_i$ 不是一个概率，通常不会在区间 $(0,1)$ 内。对于任何 $m_i > 1$ 的试验点，$\\mu_i$ 都有可能大于1，此时 $\\text{logit}(\\mu_i)$ 未定义。\n**结论**：不正确。\n\n**B. 建立模型 $Y_i \\sim \\text{Binomial}(m_i,p_i)$ 并通过 $\\text{logit}(p_i)=\\mathbf{x}_i^\\top \\beta$ 来链接概率，在二项模型中不使用任何偏移量；可以通过使用双列响应 $\\text{cbind}(y_i, m_i-y_i)$ 或通过对比例 $y_i/m_i$ 使用二项权重 $m_i$ 进行回归来实现。$\\log m_i$ 这一项仅在泊松对数线性模型中是合适的偏移量，其中 $\\mu_i=t_i \\lambda_i$ 且 $\\log \\mu_i=\\log t_i + \\mathbf{x}_i^\\top \\beta$。**\n该选项正确描述了用于分组二项数据的标准且合适的 GLM：模型为 $\\text{logit}(p_i) = \\mathbf{x}_i^\\top \\beta$，没有偏移量。它正确描述了实现此模型的两种常用方法。关键是，它还通过指出偏移量结构 $\\log m_i$（或更一般地，$\\log t_i$）适用于泊松对数线性模型而非二项 logit 模型，从而正确地指出了混淆的根源。该选项完全回答了问题。\n**结论**：正确。\n\n**C. 取变换后的响应 $\\log(y_i/m_i)$ 并拟合一个具有恒等链接的高斯线性模型，同时添加 $\\log m_i$ 作为偏移量以稳定不同 $m_i$ 的试验点之间的方差。**\n这描述了一种放弃了二项数据 GLM 框架的替代建模方法。比例的对数变换存在问题（例如，当 $y_i=0$ 时未定义），并且假设变换后的变量服从高斯分布通常是一个糟糕的近似。此外，在模型 $E[\\log(y_i/m_i)] = \\mathbf{x}_i^\\top \\beta + \\log m_i$ 中添加 $\\log m_i$ 作为偏移量没有理论依据。偏移量影响均值结构，而方差稳定是通过变换本身或使用权重来实现的；声称偏移量可以‘稳定方差’是一种混淆。\n**结论**：不正确。\n\n**D. 对 $y_i$ 拟合一个带有偏移量 $\\log m_i$ 的泊松回归来为事件率 $\\lambda_i$ 建模，这对于任何 $p_i \\in (0,1)$ 都完全等同于二项 logit 模型，因此证明了在二项设置中使用偏移量方法的合理性。**\n此选项建议用泊松分布来近似二项分布。虽然有时会这样做（特别是当 $p_i$ 很小时），但声称该模型‘完全等同于二项 logit 模型’是错误的。带有偏移量 $\\log m_i$ 的泊松模型是一个对数线性模型，即 $\\log(E[Y_i]/m_i) = \\mathbf{x}_i^\\top \\beta$，这意味着 $\\log(p_i) \\approx \\mathbf{x}_i^\\top \\beta$。而二项 logit 模型是 $\\text{logit}(p_i) = \\mathbf{x}_i^\\top \\beta$。由于 $\\log(p_i) \\neq \\log(p_i/(1-p_i))$，这两个模型是不等价的。此外，它们的方差结构也不同：$\\text{Var}_{\\text{Bin}}(Y_i) = m_i p_i(1-p_i) \\le m_i p_i = \\text{Var}_{\\text{Pois}}(Y_i)$。这种等价性并不精确，也无法证明在真实的二项模型中使用偏移量的合理性。\n**结论**：不正确。", "answer": "$$\\boxed{B}$$", "id": "4914184"}]}