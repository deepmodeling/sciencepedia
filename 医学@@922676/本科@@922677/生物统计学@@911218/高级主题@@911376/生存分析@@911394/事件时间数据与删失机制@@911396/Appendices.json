{"hands_on_practices": [{"introduction": "理论需要通过实践来巩固。让我们从生存分析中最基本也是最重要的非参数方法——Kaplan-Meier估计量开始。这个练习将指导你如何处理右删失数据，通过一步步构建风险集和计算条件生存概率，最终得到生存曲线的估计值[@problem_id:4962132]。这不仅是计算，更是理解生存数据结构和“乘积极限”思想的绝佳机会。", "problem": "一个包含 $12$ 名患者的临床队列从研究入组开始接受随访，直至发生疾病事件或管理性右删失。假设为独立、非信息性右删失，并且当一个事件和一个删失具有相同的记录时间时，为了风险集的计算，事件被认为发生在删失之前。时间以月为单位。每位患者的观测数据以有序对 $(\\text{时间}, \\text{指示符})$ 的形式给出，其中 $\\text{指示符}=1$ 表示观测到事件，$\\text{指示符}=0$ 表示右删失：\n- 受试者 $1$：$(3, 1)$\n- 受试者 $2$：$(4, 0)$\n- 受试者 $3$：$(4, 1)$\n- 受试者 $4$：$(5, 1)$\n- 受试者 $5$：$(6, 0)$\n- 受试者 $6$：$(7, 1)$\n- 受试者 $7$：$(7, 0)$\n- 受试者 $8$：$(8, 1)$\n- 受试者 $9$：$(9, 1)$\n- 受试者 $10$：$(11, 0)$\n- 受试者 $11$：$(12, 1)$\n- 受试者 $12$：$(12, 0)$\n\n从适用于事件发生时间数据的第一性原理出发，包括生存函数 $S(t)=\\Pr(T>t)$ 的定义以及在右删失情况下于不同观测事件时间点的条件事件概率概念，通过将其表示为对不同观测事件时间的乘积来构建 $S(t)$ 的非参数乘积极限估计量。在您的构建中，请精确定义在每个不同事件时间点用于计算事件数和风险人数的符号。\n\n然后，使用您构建的估计量，计算上述数据在 $t=10$ 个月时的估计生存概率。将您的最终数值答案四舍五入到四位有效数字，并以小数形式表示。", "solution": "该问题是有效的，因为它在科学上基于生物统计学的原理，特别是生存分析，其提法得当，具有完整且一致的数据和假设，并以客观、正式的语言表述。因此，我们可以开始解题。\n\n该问题要求构建生存函数 $S(t)$ 的乘积极限估计量，并将其应用于给定数据集，以求出在 $t=10$ 个月时的估计生存概率。\n\n首先，我们从第一性原理构建估计量。生存函数 $S(t)$ 定义为真实事件时间（一个随机变量 $T$）大于某个特定时间 $t$ 的概率：\n$$S(t) = \\Pr(T > t)$$\n设在队列中观测到的不同有序事件时间为 $t_{(1)} < t_{(2)} < \\dots < t_{(k)}$。生存函数可以表示为在这些事件时间定义的区间上的条件概率的乘积。对于任何满足 $t_{(j)} \\le t < t_{(j+1)}$ 的时间 $t$，存活超过 $t$ 的概率与存活超过 $t_{(j)}$ 的概率相同。这可以写成：\n$$S(t) = \\Pr(T > t_{(j)}) = \\Pr(T > t_{(1)}) \\times \\Pr(T > t_{(2)} | T > t_{(1)}) \\times \\dots \\times \\Pr(T > t_{(j)} | T > t_{(j-1)})$$\n使用乘积符号，并定义 $t_{(0)} = 0$，我们有：\n$$S(t) = \\prod_{i: t_{(i)} \\le t} \\Pr(T > t_{(i)} | T > t_{(i-1)})$$\n在非信息性删失的假设下，我们可以从观测数据中估计每个条件概率项。让我们为每个不同的事件时间 $t_{(i)}$ 定义以下量：\n-   $n_i$：在时间 $t_{(i)}$ 之前即刻面临事件风险的个体数量。这构成了风险集。这些是所有观测时间（事件或删失）大于或等于 $t_{(i)}$ 的受试者。\n-   $d_i$：在时间 $t_{(i)}$ 发生事件的个体数量。\n\n在一个受试者存活至时间 $t_{(i)}$ 的条件下，在该时间点发生事件的条件概率，可以通过在 $t_{(i)}$ 时发生事件的风险人群比例来估计：\n$$\\widehat{\\Pr}(T = t_{(i)} | T \\ge t_{(i)}) = \\frac{d_i}{n_i}$$\n因此，在存活至时间 $t_{(i)}$ 的条件下，存活超过该时间的条件概率估计为：\n$$\\widehat{\\Pr}(T > t_{(i)} | T \\ge t_{(i)}) = 1 - \\frac{d_i}{n_i}$$\n由于在 $t_{(i-1)}$ 和 $t_{(i)}$ 之间没有事件发生，$\\Pr(T > t_{(i)} | T > t_{(i-1)})$ 等价于 $\\Pr(T > t_{(i)} | T \\ge t_{(i)})$。将这个估计值代入 $S(t)$ 的乘积表达式，得到乘积极限估计量，也称为 Kaplan-Meier 估计量，$\\hat{S}(t)$：\n$$\\hat{S}(t) = \\prod_{i: t_{(i)} \\le t} \\left(1 - \\frac{d_i}{n_i}\\right)$$\n按照惯例，对于 $t < t_{(1)}$，$\\hat{S}(t) = 1$。\n\n接下来，我们将此估计量应用于所提供的数据以计算 $\\hat{S}(10)$。我们必须首先确定在每个不同事件时间点的 $n_i$ 和 $d_i$ 的值。受试者总数为 $N=12$。\n事件或删失的有序时间是：$3(1), 4(0), 4(1), 5(1), 6(0), 7(1), 7(0), 8(1), 9(1), 11(0), 12(1), 12(0)$。\n不同的事件时间是 $3, 4, 5, 7, 8, 9, 12$。我们需要计算 $\\hat{S}(10)$，因此我们考虑所有小于或等于 $10$ 的事件时间 $t_{(i)}$。这些是 $t_{(1)}=3, t_{(2)}=4, t_{(3)}=5, t_{(4)}=7, t_{(5)}=8, t_{(6)}=9$。\n\n我们构建一个生命表来组织计算。对于事件和删失时间相同的结的处理规则是，被删失的受试者被包含在该时间的风险集中。\n\n-   在 $t_{(1)} = 3$ 时：\n    风险受试者数量为全部 $12$ 名受试者，所以 $n_1 = 12$。\n    一名受试者发生事件，所以 $d_1 = 1$。\n    生存因子为 $1 - \\frac{d_1}{n_1} = 1 - \\frac{1}{12} = \\frac{11}{12}$。\n\n-   在 $t_{(2)} = 4$ 时：\n    在 $t=3$ 时一名受试者发生事件。风险受试者数量为 $12 - 1 = 11$，所以 $n_2 = 11$。（在 $t=4$ 被删失的受试者 $2$ 包含在该风险集中）。\n    一名受试者发生事件，所以 $d_2 = 1$。\n    生存因子为 $1 - \\frac{d_2}{n_2} = 1 - \\frac{1}{11} = \\frac{10}{11}$。\n\n-   在 $t_{(3)} = 5$ 时：\n    在 $t=4$ 时，一名受试者发生事件，一名被删失。风险受试者数量为 $11 - 2 = 9$，所以 $n_3 = 9$。\n    一名受试者发生事件，所以 $d_3 = 1$。\n    生存因子为 $1 - \\frac{d_3}{n_3} = 1 - \\frac{1}{9} = \\frac{8}{9}$。\n\n-   在 $t_{(4)} = 7$ 时：\n    在 $t=5$ 时，一名受试者发生事件。在 $t=6$ 时，一名被删失。风险受试者数量为 $9 - 2 = 7$，所以 $n_4 = 7$。（在 $t=7$ 被删失的受试者 $7$ 包含在内）。\n    一名受试者发生事件，所以 $d_4 = 1$。\n    生存因子为 $1 - \\frac{d_4}{n_4} = 1 - \\frac{1}{7} = \\frac{6}{7}$。\n\n-   在 $t_{(5)} = 8$ 时：\n    在 $t=7$ 时，一名受试者发生事件，一名被删失。风险受试者数量为 $7 - 2 = 5$，所以 $n_5 = 5$。\n    一名受试者发生事件，所以 $d_5 = 1$。\n    生存因子为 $1 - \\frac{d_5}{n_5} = 1 - \\frac{1}{5} = \\frac{4}{5}$。\n\n-   在 $t_{(6)} = 9$ 时：\n    在 $t=8$ 时，一名受试者发生事件。风险受试者数量为 $5 - 1 = 4$，所以 $n_6 = 4$。\n    一名受试者发生事件，所以 $d_6 = 1$。\n    生存因子为 $1 - \\frac{d_6}{n_6} = 1 - \\frac{1}{4} = \\frac{3}{4}$。\n\n下一个事件时间是 $t=12$，大于 $10$。因此，生存概率估计值 $\\hat{S}(10)$ 是直到并包括 $t=9$ 的所有事件时间的生存因子的乘积。\n$$\\hat{S}(10) = \\prod_{i=1}^{6} \\left(1 - \\frac{d_i}{n_i}\\right)$$\n$$\\hat{S}(10) = \\left(\\frac{11}{12}\\right) \\times \\left(\\frac{10}{11}\\right) \\times \\left(\\frac{8}{9}\\right) \\times \\left(\\frac{6}{7}\\right) \\times \\left(\\frac{4}{5}\\right) \\times \\left(\\frac{3}{4}\\right)$$\n我们可以通过约去项来简化这个乘积：\n$$\\hat{S}(10) = \\frac{11 \\times 10 \\times 8 \\times 6 \\times 4 \\times 3}{12 \\times 11 \\times 9 \\times 7 \\times 5 \\times 4}$$\n约去 $11$ 和 $4$：\n$$\\hat{S}(10) = \\frac{10 \\times 8 \\times 6 \\times 3}{12 \\times 9 \\times 7 \\times 5}$$\n分解各项以进一步简化：\n$$\\hat{S}(10) = \\frac{(2 \\times 5) \\times 8 \\times 6 \\times 3}{(2 \\times 6) \\times (3 \\times 3) \\times 7 \\times 5}$$\n约去 $(2 \\times 5 \\times 6 \\times 3)$：\n$$\\hat{S}(10) = \\frac{8}{3 \\times 7} = \\frac{8}{21}$$\n为了提供数值答案，我们将分数转换为小数，并按要求四舍五入到四位有效数字。\n$$\\frac{8}{21} \\approx 0.38095238...$$\n四舍五入到四位有效数字得到 $0.3810$。", "answer": "$$\\boxed{0.3810}$$", "id": "4962132"}, {"introduction": "在现实世界的临床研究中，我们常常面临“竞争风险”的复杂情况，即一种事件的发生会阻止我们观察到感兴趣的事件。简单地将竞争性事件视为常规的删失处理，会系统性地高估我们关心的事件的发生风险，导致错误的结论。这个练习将通过解析推导，让你亲手量化这种错误方法所带来的偏倚，从而深刻理解竞争风险模型的必要性[@problem_id:4962185]。", "problem": "一个队列的个体从基线开始被随访，以评估在存在竞争事件（其他原因导致的死亡，$k=2$）的情况下，发生特定疾病死亡（$k=1$）的时间。假设事件遵循竞争风险结构，其特定原因风险率为常数：特定疾病的风险率为 $\\lambda_{1}(t)=\\lambda_{1}$，其他原因的风险率为 $\\lambda_{2}(t)=\\lambda_{2}$，其中 $\\lambda_{1} > 0$ 和 $\\lambda_{2} > 0$ 均为正常数。假设没有失访和行政删失；只有竞争事件会阻止特定疾病事件的发生。独立性和非信息性删失的假设适用于任何与失败类型无关的删失情况，但在这里，竞争事件排除了我们感兴趣的事件。\n\n根据定义，原因 $k$ 的累积发生率函数 (CIF)，记为 $F_{k}(t)$，是在时间 $t$ 前因原因 $k$ 发生失败的概率。考虑一种常见但错误的做法，即在使用 Kaplan-Meier (KM) 估计量估计原因 $k=1$ 的风险时，将竞争事件 ($k=2$) 视为独立的右删失。在这种错误的做法下，估计量所针对的是在移除了竞争事件后的净风险。\n\n从风险率、生存率和特定原因失败概率随时间变化的核心定义出发，推导在时间 $t$ 的偏差的解析表达式。该偏差定义为不正确的基于 KM 的估计（将竞争事件视为独立删失）与原因 $k=1$ 的真实累积发生率函数之间的差异。然后，对 $\\lambda_{1}=0.05$ (每年)，$\\lambda_{2}=0.10$ (每年) 和 $t=5$ (年) 的情况，数值计算这个偏差。将最终数值结果表示为十进制概率，并四舍五入到四位有效数字。", "solution": "该问题要求我们推导在存在竞争风险的情况下，因错误使用基于 Kaplan-Meier (KM) 的方法估计事件风险而产生的偏差的解析表达式，然后为一组特定参数计算此偏差。在给定时间 $t$ 的偏差是风险的错误估计值与真实累积发生率函数 (CIF) 之间的差值。\n\n设 $T$ 为首次事件发生的时间，$K$ 为事件类型，其中 $K=1$ 表示特定疾病死亡，$K=2$ 表示其他原因死亡。特定原因风险率被设定为常数：$\\lambda_{1}(t) = \\lambda_{1} > 0$ 和 $\\lambda_{2}(t) = \\lambda_{2} > 0$。\n\n首先，我们推导原因 1 的真实累积发生率函数（记为 $F_{1}(t)$）的表达式。CIF 是在时间 $t$ 前因原因 1 而失败的概率，即 $P(T \\le t, K=1)$。这需要总生存函数 $S(t)$，它是在时间 $t$ 仍未发生任何事件的概率。\n\n总风险率 $\\lambda(t)$ 是各特定原因风险率之和：\n$$ \\lambda(t) = \\lambda_{1}(t) + \\lambda_{2}(t) = \\lambda_{1} + \\lambda_{2} $$\n总生存函数 $S(t)$ 由下式给出：\n$$ S(t) = \\exp\\left(-\\int_{0}^{t} \\lambda(u) \\, du\\right) $$\n由于总风险率是常数，积分很简单：\n$$ S(t) = \\exp\\left(-\\int_{0}^{t} (\\lambda_{1} + \\lambda_{2}) \\, du\\right) = \\exp(-(\\lambda_{1} + \\lambda_{2})t) $$\n原因 $k=1$ 的 CIF，即 $F_{1}(t)$，是其特定原因风险率乘以总生存函数在时间区间 $[0, t]$ 上的积分：\n$$ F_{1}(t) = \\int_{0}^{t} \\lambda_{1}(u) S(u) \\, du $$\n代入 $\\lambda_{1}(u)$ 和 $S(u)$ 的表达式：\n$$ F_{1}(t) = \\int_{0}^{t} \\lambda_{1} \\exp(-(\\lambda_{1} + \\lambda_{2})u) \\, du $$\n$$ F_{1}(t) = \\lambda_{1} \\left[ \\frac{\\exp(-(\\lambda_{1} + \\lambda_{2})u)}{-(\\lambda_{1} + \\lambda_{2})} \\right]_{0}^{t} $$\n$$ F_{1}(t) = \\lambda_{1} \\left( \\frac{\\exp(-(\\lambda_{1} + \\lambda_{2})t)}{-(\\lambda_{1} + \\lambda_{2})} - \\frac{\\exp(0)}{-(\\lambda_{1} + \\lambda_{2})} \\right) $$\n$$ F_{1}(t) = \\frac{\\lambda_{1}}{\\lambda_{1} + \\lambda_{2}} \\left( 1 - \\exp(-(\\lambda_{1} + \\lambda_{2})t) \\right) $$\n这是原因 1 的累积发生率的正确表达式。\n\n接下来，我们推导将竞争事件 ($k=2$) 视为独立右删失所获得的错误风险估计的表达式。在这种错误假设下，Kaplan-Meier 估计量所针对的是原因 1 的*净*生存函数，我们将其记为 $S_{1}^{*}(t)$。该函数描述了一个假设情景下的生存概率，在该情景中，原因 1 是唯一可能发生的事件。此情景的风险率就是 $\\lambda_1(t) = \\lambda_1$。\n$$ S_{1}^{*}(t) = \\exp\\left(-\\int_{0}^{t} \\lambda_{1}(u) \\, du\\right) = \\exp(-\\lambda_{1} t) $$\n相应的累积风险估计值，我们记为 $F_{KM,1}(t)$，是 1 减去这个净生存函数：\n$$ F_{KM,1}(t) = 1 - S_{1}^{*}(t) = 1 - \\exp(-\\lambda_{1} t) $$\n这个量通常被称为净风险。\n\n在时间 $t$ 的偏差的解析表达式是错误估计值与真实 CIF 之间的差值：\n$$ \\text{Bias}(t) = F_{KM,1}(t) - F_{1}(t) $$\n代入推导出的表达式：\n$$ \\text{Bias}(t) = \\left(1 - \\exp(-\\lambda_{1} t)\\right) - \\left(\\frac{\\lambda_{1}}{\\lambda_{1} + \\lambda_{2}} \\left( 1 - \\exp(-(\\lambda_{1} + \\lambda_{2})t) \\right)\\right) $$\n这就是所要求的偏差的解析表达式。\n\n现在，我们对给定的参数 $\\lambda_{1}=0.05$, $\\lambda_{2}=0.10$ 和 $t=5$ 进行数值计算这个偏差。\n\n首先，计算不正确的基于 KM 的估计值 $F_{KM,1}(5)$：\n$$ F_{KM,1}(5) = 1 - \\exp(-\\lambda_{1} t) = 1 - \\exp(-0.05 \\times 5) = 1 - \\exp(-0.25) $$\n接下来，计算真实的 CIF $F_{1}(5)$：\n$$ F_{1}(5) = \\frac{\\lambda_{1}}{\\lambda_{1} + \\lambda_{2}} \\left( 1 - \\exp(-(\\lambda_{1} + \\lambda_{2})t) \\right) $$\n$$ F_{1}(5) = \\frac{0.05}{0.05 + 0.10} \\left( 1 - \\exp(-(0.05 + 0.10) \\times 5) \\right) $$\n$$ F_{1}(5) = \\frac{0.05}{0.15} \\left( 1 - \\exp(-0.15 \\times 5) \\right) = \\frac{1}{3} \\left( 1 - \\exp(-0.75) \\right) $$\n在 $t=5$ 时的偏差是：\n$$ \\text{Bias}(5) = \\left(1 - \\exp(-0.25)\\right) - \\frac{1}{3} \\left(1 - \\exp(-0.75)\\right) $$\n现在我们计算数值：\n$$ \\exp(-0.25) \\approx 0.77880078 $$\n$$ \\exp(-0.75) \\approx 0.47236655 $$\n将这些值代入偏差表达式：\n$$ \\text{Bias}(5) \\approx (1 - 0.77880078) - \\frac{1}{3}(1 - 0.47236655) $$\n$$ \\text{Bias}(5) \\approx 0.22119922 - \\frac{1}{3}(0.52763345) $$\n$$ \\text{Bias}(5) \\approx 0.22119922 - 0.17587782 $$\n$$ \\text{Bias}(5) \\approx 0.04532140 $$\n将结果四舍五入到四位有效数字，我们得到 $0.04532$。", "answer": "$$ \\boxed{0.04532} $$", "id": "4962185"}, {"introduction": "描述生存分布之后，我们通常更关心哪些因素（如治疗方案、患者特征）会影响生存时间。Cox比例风险模型是解决这一问题的最核心工具，它允许我们在不指定基线风险函数具体形式的情况下，估计协变量的效应。这项高级练习将带你推导Cox模型的基石——偏似然函数，领会其如何巧妙地分离协变量效应与未知的基线风险，这是半参数生存分析思想的精髓所在[@problem_id:4962119]。", "problem": "一项队列研究跟踪了 $n$ 个独立的个体，由 $i \\in \\{1,\\dots,n\\}$ 索引，每个个体在基线时记录了固定的协变量向量 $x_i \\in \\mathbb{R}^{p}$。设真实事件时间为 $T_i$，右删失时间为 $C_i$，观测时间为 $Y_i = \\min\\{T_i, C_i\\}$，事件指示符为 $\\delta_i = \\mathbf{1}\\{T_i \\leq C_i\\}$。假设右删失在给定协变量的情况下是无信息性的，即在以 $x_i$ 为条件时，删失过程独立于失效过程。\n\n假设失效时间遵循 Cox 比例风险模型，即风险函数满足 $h(t \\mid x_i) = h_0(t) \\exp(x_i^{\\top}\\beta)$，其中 $h_0(t)$ 是基线风险函数，$\\beta \\in \\mathbb{R}^{p}$ 是回归系数向量。设不同的观测失效时间为 $t_{(1)} < t_{(2)} < \\dots < t_{(K)}$，且没有重复的失效时间，并将时间 $t$ 时的风险集定义为 $R(t) = \\{i : Y_i \\geq t\\}$。\n\n从风险、生存函数和条件概率的定义出发，并使用无信息删失假设，通过以观测到的失效时间集为条件并消除任何滋扰基线风险项，来推导 $\\beta$ 的偏似然。您的推导必须从第一性原理出发（例如，风险的定义为瞬时失效率以及风险集中条件概率的构建），并清楚地证明导致观测失效的乘积形式的每一步。\n\n提供偏似然 $L(\\beta)$ 的最终解析表达式，用 $\\{x_i, Y_i, \\delta_i\\}_{i=1}^{n}$ 和风险集 $R(t)$ 表示，并表示为一个仅通过协变量依赖于 $\\beta$ 的单一闭式乘积。不需要进行数值计算。最终答案必须以单一数学表达式的形式呈现。", "solution": "用户希望推导 Cox 比例风险模型的偏似然。\n\n### 步骤1：提取已知条件\n-   **研究人群：** 一个由 $n$ 个独立个体组成的队列，由 $i \\in \\{1, \\dots, n\\}$ 索引。\n-   **协变量：** 每个个体 $i$ 的固定基线协变量向量 $x_i \\in \\mathbb{R}^{p}$。\n-   **真实事件时间：** $T_i$。\n-   **右删失时间：** $C_i$。\n-   **观测数据：** 观测时间为 $Y_i = \\min\\{T_i, C_i\\}$，事件指示符为 $\\delta_i = \\mathbf{1}\\{T_i \\leq C_i\\}$，其中 $\\mathbf{1}\\{\\cdot\\}$ 是指示函数。\n-   **删失假设：** 右删失是无信息性的，意味着在给定协变量 $x_i$ 的条件下，删失过程独立于失效过程。\n-   **风险模型：** 失效时间遵循 Cox 比例风险模型，个体 $i$ 的风险函数由 $h(t \\mid x_i) = h_0(t) \\exp(x_i^{\\top}\\beta)$ 给出。此处，$h_0(t)$ 是基线风险函数，$\\beta \\in \\mathbb{R}^{p}$ 是回归系数向量。\n-   **观测到的失效：** 不同的观测失效时间表示为 $t_{(1)} < t_{(2)} < \\dots < t_{(K)}$，并简化假设没有重复的失效时间。\n-   **风险集：** 时间 $t$ 的风险集定义为 $R(t) = \\{i : Y_i \\geq t\\}$，它包括在时间 $t$ 之前仍在观察中（既未失效也未删失）的所有个体。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题根据既定标准进行了审查。\n\n-   **科学基础：** 该问题在根本上是合理的。它描述了生存分析中的一个标准设置，这是生物统计学的一个主要子领域。Cox 比例风险模型、右删失、无信息删失和偏似然都是该领域的基石概念。\n-   **适定性：** 该问题是适定的。它要求在一套标准假设（比例风险、无信息删失、无重复）下推导一个特定的、定义明确的统计量（偏似然）。目标清晰，并且可以获得唯一的解析表达式。\n-   **客观性：** 问题使用精确、客观的数学和统计语言陈述，没有任何主观性或模糊性。\n-   **完整性和一致性：** 问题为推导提供了所有必要的信息。模型、数据结构、假设和定义是完整且相互一致的。“没有重复失效时间”的假设简化了推导，但并未使问题无效；这是该主题教科书处理中的一个常见起点。\n\n### 步骤3：结论和行动\n问题被视为 **有效**。这是生物统计学中一个标准且重要的理论练习。现在将按要求从第一性原理开始推导。\n\n参数向量 $\\beta$ 的偏似然的推导取决于 D.R. Cox 的一个关键见解，该见解涉及重构似然的构造，以消除无穷维滋扰参数，即基线风险 $h_0(t)$。我们不构造观测时间和事件状态的全似然，而是在每个观测到的失效时间点上，基于一系列条件概率来构造一个似然。\n\n从第一性原理出发，风险函数 $h(t \\mid x_i)$ 表示在个体存活到时间 $t$ 的条件下，在时间 $t$ 的瞬时失效率。形式上，对于一个很小的时间间隔 $dt$，我们有：\n$$ P(t \\leq T_i < t+dt \\mid T_i \\geq t, x_i) \\approx h(t \\mid x_i) dt $$\n风险模型由 $h(t \\mid x_i) = h_0(t) \\exp(x_i^{\\top}\\beta)$ 给出。\n\n设 $K$ 个不同的、有序的失效时间为 $t_{(1)} < t_{(2)} < \\dots < t_{(K)}$。设 $i_j$ 是在时间 $t_{(j)}$ 被观测到失效的特定个体的索引。此时的风险集是 $R(t_{(j)}) = \\{k : Y_k \\geq t_{(j)}\\}$。根据定义，个体 $i_j$ 必须在风险集 $R(t_{(j)})$ 中。\n\n偏似然论证的核心是，在每个失效时间 $t_{(j)}$，考虑在给定特定风险集 $R(t_{(j)})$ 以及在该时间点恰好发生一次失效的事实的条件下，观测到个体 $i_j$ 失效的条件概率。\n\n让我们计算在时间 $t_{(j)}$ 发生的第 $j$ 次失效的这个条件概率。我们感兴趣的事件是“个体 $i_j$ 在 $t_{(j)}$ 失效”。条件事件是“在风险集 $R(t_{(j)})$ 的个体中，在时间 $t_{(j)}$ 恰好发生一次失效”。\n\n风险集 $R(t_{(j)})$ 中的任意个体 $k$ 在无穷小区间 $[t_{(j)}, t_{(j)}+dt)$ 内失效的概率约为 $h(t_{(j)} \\mid x_k) dt$。该个体不失效的概率是 $1 - h(t_{(j)} \\mid x_k) dt$。\n\n在该区间内，从风险集 $R(t_{(j)})$ 中恰好有一个个体失效的概率是某个特定个体 $k$ 失效而风险集中所有其他个体不失效的概率之和。假设 $dt$ 足够小，以至于 $(dt)^2$ 及更高阶的项可以忽略不计，这个概率是：\n$$ P(\\text{one failure from } R(t_{(j)})) \\approx \\sum_{k \\in R(t_{(j)})} P(\\text{individual } k \\text{ fails}) = \\sum_{k \\in R(t_{(j)})} h(t_{(j)} \\mid x_k) dt $$\n特定个体 $i_j$ 是那个失效者的概率约为 $h(t_{(j)} \\mid x_{i_j}) dt$。\n\n因此，构成偏似然第 $j$ 项的条件概率是：\n$$ L_j(\\beta) = \\frac{P(\\text{individual } i_j \\text{ fails in } [t_{(j)}, t_{(j)}+dt))}{P(\\text{one failure from } R(t_{(j)}) \\text{ in } [t_{(j)}, t_{(j)}+dt))} \\approx \\frac{h(t_{(j)} \\mid x_{i_j}) dt}{\\sum_{k \\in R(t_{(j)})} h(t_{(j)} \\mid x_k) dt} $$\n项 $dt$ 被消掉了。\n$$ L_j(\\beta) = \\frac{h(t_{(j)} \\mid x_{i_j})}{\\sum_{k \\in R(t_{(j)})} h(t_{(j)} \\mid x_k)} $$\n现在，我们代入 Cox 模型设定 $h(t \\mid x_k) = h_0(t) \\exp(x_k^{\\top}\\beta)$：\n$$ L_j(\\beta) = \\frac{h_0(t_{(j)}) \\exp(x_{i_j}^{\\top}\\beta)}{\\sum_{k \\in R(t_{(j)})} h_0(t_{(j)}) \\exp(x_k^{\\top}\\beta)} $$\n基线风险项 $h_0(t_{(j)})$ 是在时间 $t_{(j)}$ 处于风险中的所有个体的公因子，因此从分子和分母中消去。这是消除滋扰参数的关键步骤。\n$$ L_j(\\beta) = \\frac{\\exp(x_{i_j}^{\\top}\\beta)}{\\sum_{k \\in R(t_{(j)})} \\exp(x_k^{\\top}\\beta)} $$\n这一项仅依赖于参数向量 $\\beta$ 和时间 $t_{(j)}$ 风险集中个体的协变量数据。无信息删失假设对于这一步至关重要，因为它确保了在任何时间 $t$ 风险集的构成相对于未来的失效风险没有偏倚，超出了协变量所能解释的范围。\n\n总偏似然 $L(\\beta)$ 是通过将所有 $K$ 个观测到的失效的这些条件概率项相乘而形成的。其合理性在于，在给定风险集的条件下，将失效事件序列视为一系列条件独立的事件。\n$$ L(\\beta) = \\prod_{j=1}^{K} L_j(\\beta) = \\prod_{j=1}^{K} \\frac{\\exp(x_{i_j}^{\\top}\\beta)}{\\sum_{k \\in R(t_{(j)})} \\exp(x_k^{\\top}\\beta)} $$\n这个表达式是关于观测到的失效事件的乘积。为了用完整数据集 $\\{x_i, Y_i, \\delta_i\\}_{i=1}^{n}$ 来表示它，我们可以将乘积重写为对所有 $n$ 个个体的乘积。事件指示符 $\\delta_i$ 用于仅选择那些被观测到失效的个体。如果个体 $i$ 失效，则 $\\delta_i=1$，其失效时间为 $Y_i$，它对乘积贡献一项。如果他们被删失，则 $\\delta_i=0$，其对乘积的贡献应为 $1$。这可以通过使用 $\\delta_i$ 作为指数来实现：\n$$ L(\\beta) = \\prod_{i=1}^{n} \\left[ \\frac{\\exp(x_i^{\\top}\\beta)}{\\sum_{j \\in R(Y_i)} \\exp(x_j^{\\top}\\beta)} \\right]^{\\delta_i} $$\n在这种最终形式中，乘积是对从 $1$ 到 $n$ 的所有个体 $i$ 进行的。如果 $\\delta_i=0$，括号中的项的 $0$ 次方等于 $1$，因此删失的个体不会改变似然值。如果 $\\delta_i=1$，该项对应于在给定风险集 $R(Y_i)$ 的情况下，个体 $i$ 在其观测到的失效时间 $Y_i$ 失效的条件概率。这就是 $\\beta$ 的偏似然。", "answer": "$$ \\boxed{\\prod_{i=1}^{n} \\left( \\frac{\\exp(x_i^{\\top}\\beta)}{\\sum_{j \\in R(Y_i)} \\exp(x_j^{\\top}\\beta)} \\right)^{\\delta_i}} $$", "id": "4962119"}]}