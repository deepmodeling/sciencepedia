## 引言
在生物统计学、医学研究及众多科学领域中，我们不仅关心事件是否发生，更关心它何时发生。这类数据被称为时间-事件数据（或[生存数据](@entry_id:165675)），对它的分析是理解疾病进展、评估治疗效果和预测风险的核心。然而，由于数据常常存在“删失”（Censoring）——即我们无法完整观察到所有研究对象的事件时间——传统的统计方法（如[线性回归](@entry_id:142318)）在此失效，并可能导致严重错误的结论。本文旨在为读者系统地构建一个[处理时间](@entry_id:196496)-事件数据的完整知识框架，从基本原理到高级应用，再到实践操作。

我们将分三步展开：首先，在“原理与机制”一章中，我们将深入探讨时间-事件数据的数学基础，包括生存函数、风险函数、不同类型的删失机制，以及构建[统计模型](@entry_id:755400)的似然函数。接着，在“应用与跨学科联系”一章中，我们将展示这些理论如何在肿瘤学、公共卫生、社会科学等真实场景中发挥作用，并介绍处理时变协变量、[竞争风险](@entry_id:173277)和信息性删失等复杂问题的扩展模型。最后，“实践练习”部分将提供具体的计算和推导问题，帮助您将理论知识转化为实践技能。通过本次学习，您将能够自信地应对生存分析中的核心挑战，并为更深入的研究打下坚实的基础。

## 原理与机制

在上一章介绍性讨论的基础上，本章将深入探讨时间-事件数据分析的核心原理与机制。我们将系统性地定义基本概念，建立描述事件发生过程的数学框架，并阐明支撑现代生存分析方法的基本假设。

### 时间-事件数据的本质

时间-事件数据，或称[生存数据](@entry_id:165675)，其核心特征不仅在于记录一个时间点，更在于记录一个特定**事件（event）**的发生时间。这个事件可以是任何明确定义的终点，如疾病复发、设备故障或死亡。对每个研究对象 $i$，我们理想中希望观察到其真实的事件发生时间，记为随机变量 $T_i$。然而，在实际研究中，我们往往无法完整地观察到所有对象的 $T_i$。

最常见的情况是，观察可能在事件发生前就因各种原因终止。这个观察终止时间被称为**删失时间（censoring time）**，记为 $C_i$。因此，我们实际观察到的是事件时间和删失时间中的较小者，记为 $Y_i = \min(T_i, C_i)$。同时，我们还需要一个**事件指示符（event indicator）** $\Delta_i$，用以区分观测到的时间是真实事件时间（$\Delta_i=1$，当 $T_i \le C_i$ 时）还是删失时间（$\Delta_i=0$，当 $T_i > C_i$ 时）。因此，时间-事件数据的基本结构单元是观测对 $(Y_i, \Delta_i)$，通常还伴随一组基线协变量 $\mathbf{Z}_i$ [@problem_id:4962156]。

这种[数据结构](@entry_id:262134)带来了传统统计方法难以处理的几个独特挑战。一个自然的问题是：为什么我们不能简单地使用标准[回归模型](@entry_id:163386)（如[普通最小二乘法](@entry_id:137121)，OLS）来分析事件时间？[@problem_id:4962250] 思考一个典型的生物统计学研究场景，其中患者被随访直至发生临床事件或研究结束。该场景揭示了标准方法不适用的三个核心原因：

1.  **删失（Censoring）**：这是最根本的挑战。如果仅分析观测到事件的个体（即 $\Delta_i=1$ 的子集），会引入严重的**选择偏倚（selection bias）**。因为生存时间较长的个体更有可能因研究结束等原因被删失，从而被系统性地排除在分析之外，这通常会导致对生存时间的低估和对协变量效应的错误估计。反之，如果忽略删失指示符 $\Delta_i$，将所有观测时间 $Y_i$ 都当作真实事件时间处理，则会系统性地低估被删失个体的真实生存时间，同样导致结果偏倚。

2.  **非负性（Non-negativity）**：事件发生时间 $T_i$ 必须为非负值，其支撑集为 $[0, \infty)$。而像高斯线性模型所依赖的正态分布，其支撑集为 $(-\infty, \infty)$，这在理论上是不匹配的，可能导致模型预测出无意义的负数时间。

3.  **[偏态分布](@entry_id:175811)（Skewed Distribution）**：经验表明，事件时间数据通常呈现强烈的**右偏（right-skewed）**分布，即大多数事件发生在研究早期，而少数个体会生存很长时间。对称的正态分布显然无法很好地拟合这种数据形态。

这些挑战共同表明，我们需要专门为时间-事件数据设计的[统计模型](@entry_id:755400)，这些模型必须能够正确处理删失信息，并能适应非负且通常为[偏态](@entry_id:178163)的分布特征。

### 不[完全数](@entry_id:636981)据机制的分类

“删失”是“不[完全数](@entry_id:636981)据”的一种形式，但并非唯一形式。精确理解不同类型的不完全信息对于选择正确的分析方法至关重要。我们可以根据对真实事件时间 $T$ 的已知信息，对这些机制进行[系统分类](@entry_id:162603) [@problem_id:4962274]。

-   **[右删失](@entry_id:164686)（Right-Censoring）**：这是最常见的情形。当我们在时间 $C$ 停止观察时，个体仍未发生事件。我们所知的是事件发生在观察结束之后，即 $T > C$。在处理连续时间变量时，由于 $P(T=C)=0$，这等价于 $T \ge C$。

-   **[左删失](@entry_id:169731)（Left-Censoring）**：当我们首次在时间 $L$ 观察个体时，发现事件已经发生。我们只知道事件发生在风险期开始（通常是时间 $0$）到首次观察之间，即 $T \le L$。例如，在研究某种感染的潜伏期时，若首次检测即为阳性，则为[左删失](@entry_id:169731)。

-   **[区间删失](@entry_id:636589)（Interval-Censoring）**：当事件时间无法被精确定位，只能确定其发生在一个时间区间内时，就会出现[区间删失](@entry_id:636589)。例如，如果一个体在时间 $L$ 的检测结果为阴性，而在随后的时间 $R$（$L < R$）检测为阳性，我们便知道事件时间 $T$ 位于区间 $(L, R]$ 内。

区别于删失，**截断（Truncation）**是另一个重要的概念。截断是一种**抽样机制**，它决定了个体是否有资格进入研究样本。

-   **截断（Truncation）**：如果研究只招募那些事件时间 $T$ 落在特定区间的个体，例如，只纳入在 $(a, b]$ 时间窗内发生感染的患者，那么事件时间不在此区间的个体将永远不会出现在数据集中。对于任何一个被纳入研究的个体，我们先验地知道其 $T \in (a, b]$。截断与删失的根本区别在于：删失发生在已入组的个体上，我们拥有其部分信息；而截断则发生在入组之前，不符合条件的个体对我们而言是“不可见”的。特别地，当研究对象的入组时间晚于风险起始时间时，会产生**左截断（left-truncation）**，也称**延迟入组（delayed entry）**。

最后，**缺失（Missingness）**指研究对象已入组，但其事件时间因某种原因完全未被记录，且没有提供任何关于其上下限的信息。这与删失不同，删失至少提供了一个[不等式约束](@entry_id:176084)。

### 描述时间-事件分布的基本量

为了对时间-事件分布进行数学建模，我们需要引入三个核心函数：生存函数、风险函数和[累积风险函数](@entry_id:169734)。

#### 生存函数与[风险函数](@entry_id:166593)

**生存函数（Survival Function）**，记为 $S(t)$，是描述时间-事件分布最直观的方式。它定义为个体生存超过时间 $t$ 的概率：
$S(t) = \mathbb{P}(T > t)$
$S(t)$ 是一个非增函数，其中 $S(0)=1$（在研究开始时所有个体都存活），且当 $t \to \infty$ 时，$S(t) \to 0$。

**[概率密度函数](@entry_id:140610)（Probability Density Function）**，记为 $f(t)$，描述了事件在时间点 $t$ 发生的瞬时概率。对于连续时间变量，$f(t) = -\frac{d}{dt}S(t)$。

然而，在许多生物和工程应用中，我们更关心的是“风险”。**[风险函数](@entry_id:166593)（Hazard Function）**，又称瞬时风险率（instantaneous hazard rate），记为 $\lambda(t)$ 或 $h(t)$，是生存分析的中心概念。它定义为在时间点 $t$ 仍然存活的个体，在下一个极小时间间隔内发生事件的[瞬时速率](@entry_id:182981) [@problem_id:4962102] [@problem_id:4962101]：
$\lambda(t) = \lim_{\Delta t \to 0} \frac{\mathbb{P}(t \le T < t+\Delta t \mid T \ge t)}{\Delta t}$
[风险函数](@entry_id:166593)衡量的是在给定生存至时间 $t$ 的条件下，事件发生的“紧迫性”。与生存概率不同，[风险率](@entry_id:266388)是一个速率，其取值范围是 $[0, \infty)$。

这三个函数之间存在着明确的数学关系。根据[条件概率](@entry_id:151013)的定义，我们可以推导出 [@problem_id:4962102]：
$\lambda(t) = \frac{f(t)}{S(t)}$
这个关系式直观地说明了瞬时[风险率](@entry_id:266388)等于事件的[概率密度](@entry_id:143866)除以在该时刻仍然存活的概率。

#### [累积风险函数](@entry_id:169734)

将风险函数随时间进行积分，我们得到**[累积风险函数](@entry_id:169734)（Cumulative Hazard Function）**，记为 $\Lambda(t)$：
$\Lambda(t) = \int_{0}^{t} \lambda(u) du$
[累积风险函数](@entry_id:169734)衡量的是到时间 $t$ 为止累积的总风险。它与生存函数之间有一个至关重要的关系。将 $\lambda(t) = -d/dt \ln S(t)$ [@problem_id:4962102] 的关系式两边积分，可得 [@problem_id:4962104]：
$\Lambda(t) = -\ln(S(t))$
反过来，我们也可以从[累积风险函数](@entry_id:169734)得到生存函数：
$S(t) = \exp(-\Lambda(t))$
这个关系是生存分析的基石。它意味着，如果我们能够对风险函数 $\lambda(t)$ 或[累积风险函数](@entry_id:169734) $\Lambda(t)$ 建立模型，我们就能完全确定生存函数 $S(t)$ 的形态。这为通过对风险建模来推断生存概率提供了理论依据。

### [删失数据](@entry_id:173222)的似然函数与独立删失假设

构建了描述事件时间分布的数学工具后，下一步是建立[统计推断](@entry_id:172747)的框架，即[似然函数](@entry_id:141927)。

#### [删失数据](@entry_id:173222)的[似然函数](@entry_id:141927)

似然函数是观察到当前数据集的概率，被视为模型参数的函数。对于包含右[删失数据](@entry_id:173222)的时间-事件分析，似然函数的构建必须同时利用来自事件观测和删失观测的信息 [@problem_id:4962156] [@problem_id:4962250]。

对于单个观测对象 $i$ 的数据 $(Y_i, \Delta_i)$，其对总似然的贡献分为两种情况：

1.  **事件发生 ($\Delta_i=1$)**：此时观测时间 $Y_i$ 是真实的事件时间 $T_i$。其似然贡献是事件恰好发生在时间 $Y_i$ 的[概率密度](@entry_id:143866)，即 $f(Y_i)$。

2.  **[右删失](@entry_id:164686) ($\Delta_i=0$)**：此时我们只知道真实事件时间 $T_i$ 大于观测时间 $Y_i$。其似然贡献是生存超过时间 $Y_i$ 的概率，即 $S(Y_i) = \mathbb{P}(T > Y_i)$。

将这两种情况合并，单个观测的似然贡献可以统一写为：
$L_i \propto [f(Y_i)]^{\Delta_i} [S(Y_i)]^{1-\Delta_i}$

利用[风险函数](@entry_id:166593)与生存函数的关系 $f(t) = \lambda(t)S(t)$，上述似然贡献也可以等价地用风险函数表示 [@problem_id:4962156]：
$L_i \propto [\lambda(Y_i)S(Y_i)]^{\Delta_i} [S(Y_i)]^{1-\Delta_i} = [\lambda(Y_i)]^{\Delta_i} S(Y_i) = [\lambda(Y_i)]^{\Delta_i} \exp\left(-\int_0^{Y_i} \lambda(u)du\right)$

对于整个样本，总似然函数是所有独立个体似然贡献的乘积：
$L(\theta) = \prod_{i=1}^{n} [f(Y_i \mid \mathbf{Z}_i; \theta)]^{\Delta_i} [S(Y_i \mid \mathbf{Z}_i; \theta)]^{1-\Delta_i}$
其中 $\theta$ 代表模型参数。这个似然函数形式正确地处理了右[删失数据](@entry_id:173222)，是所有参数和半参数生存[模型推断](@entry_id:636556)的基础。

#### 独立删失假设

上述似然函数的构建依赖于一个至关重要的假设：**独立删失（Independent Censoring）**，或称**非信息性删失（Non-informative Censoring）**。

通俗地讲，这个假设意味着删失机制与事件过程无关。也就是说，一个体在某个时间点被删失，并不提供关于其未来事件风险的任何额外信息。例如，研究因行政原因（如研究预定结束日期到达）而终止是典型的非信息性删失。相反，如果一个患者因为病情急剧恶化而被医生决定移出试验，这种删失就携带了关于其极高事件风险的信息，属于**信息性删失（Informative Censoring）**。

在包含协变量 $\mathbf{Z}$ 的情况下，独立删失的正式定义是：在给定协变量 $\mathbf{Z}$ 的条件下，事件时间 $T$ 与删失时间 $C$ 相互独立，记为 $T \perp C \mid \mathbf{Z}$ [@problem_id:4962247]。

这个假设的直接后果是**似然函数的可分解性** [@problem_id:4962167]。在 $T \perp C \mid \mathbf{Z}$ 成立时，关于事件时间模型参数 $\theta$ 和删失时间模型参数 $\phi$ 的[联合似然](@entry_id:750952)函数可以分解为两个独立部分的乘积：$L(\theta, \phi) = L_T(\theta) \times L_C(\phi)$。这意味着我们可以通过最大化仅与事件相关的部分 $L_T(\theta)$ 来估计我们感兴趣的参数 $\theta$，而无需对删失过程进行建模。这极大地简化了分析。

反之，如果删失是信息性的（$T \not\perp C \mid \mathbf{Z}$），[似然函数](@entry_id:141927)将无法分解，忽略删失过程会导致对 $\theta$ 的估计产生严重偏倚。在这种情况下，必须采用更高级的分析方法，如**删失概率逆权加权（IPCW）**或**联合模型（Joint Modeling）**，来同时对事件和删失[过程建模](@entry_id:183557) [@problem_id:4962167]。

从风险集的角度看，独立删失假设确保了在任意时间 $t$ 存活的个体中，那些恰好在该时间点被删失的个体，其未来的事件风险与那些继续被观察的个体是相同的（在控制了协变量后）。这保证了我们通过观察风险集中的事件发生率来估计真实风险率的有效性 [@problem_id:4962247] [@problem_id:4962247]。

### 时间-事件数据的建模

在上述原理的基础上，我们可以构建模型来分析协变量与事件时间的关系。

#### 风险集

几乎所有生存分析的非参数和半[参数估计](@entry_id:139349)方法都依赖于**风险集（Risk Set）**的概念。在任意时间点 $t$，风险集 $\mathcal{R}(t)$ 被定义为在时间 $t$ 之前（just prior to $t$）仍处于观察中且尚未发生事件的个体集合。这个集合是计算瞬时事件率的分母。

在处理延迟入组（左截断）时，风险集的定义需要特别精确。如果个体 $i$ 的入组时间为 $L_i$，观测结束时间为 $R_i = \min(T_i, C_i)$，那么风险集 $\mathcal{R}(t)$ 包含那些在时间 $t$ 之前已经入组（$L_i < t$）并且观察持续到至少时间 $t$（$R_i \ge t$）的个体。即：
$\mathcal{R}(t) = \{i: L_i < t \le R_i\}$
例如，考虑一个包含4名受试者的研究 [@problem_id:4962248]：
-   受试者1：$L_1=0$, $R_1=7$ (事件)
-   受试者2：$L_2=3$, $R_2=6$ (删失)
-   受试者3：$L_3=5$, $R_3=9$ (事件)
-   受试者4：$L_4=1$, $R_4=5$ (删失)

在时间 $t=5$，受试者3尚未入组（$L_3=5 \not< 5$），因此被排除。受试者1、2、4均满足 $L_i < 5 \le R_i$。所以 $\mathcal{R}(5) = \{1, 2, 4\}$。
在时间 $t=6$，受试者4已经退出观察（$R_4=5 \not\ge 6$），被排除。受试者1、2、3均满足 $L_i < 6 \le R_i$。所以 $\mathcal{R}(6) = \{1, 2, 3\}$。

#### 模型示例：[Cox比例风险模型](@entry_id:174252)

**[Cox比例风险模型](@entry_id:174252)（Cox Proportional Hazards Model）**是生存分析领域应用最广泛的模型。它是一个[半参数模型](@entry_id:200031)，直接对[风险函数](@entry_id:166593)进行建模 [@problem_id:4962101]：
$\lambda(t \mid \mathbf{Z}) = \lambda_0(t) \exp(\boldsymbol{\beta}^\top \mathbf{Z})$
这个模型包含两个部分：
-   $\lambda_0(t)$：**基线[风险函数](@entry_id:166593)（baseline hazard function）**，这是一个形式未定的非负函数，代表了当所有协变量 $\mathbf{Z}$ 均为0时个体的[风险函数](@entry_id:166593)。
-   $\exp(\boldsymbol{\beta}^\top \mathbf{Z})$：协变量的效应部分，其中 $\boldsymbol{\beta}$ 是需要估计的[回归系数](@entry_id:634860)向量。

该模型的“[比例风险](@entry_id:166780)”特性体现在，任意两个具有不同协变量向量 $\mathbf{Z}_1$ 和 $\mathbf{Z}_2$ 的个体，其[风险函数](@entry_id:166593)之比为：
$\frac{\lambda(t \mid \mathbf{Z}_2)}{\lambda(t \mid \mathbf{Z}_1)} = \frac{\lambda_0(t) \exp(\boldsymbol{\beta}^\top \mathbf{Z}_2)}{\lambda_0(t) \exp(\boldsymbol{\beta}^\top \mathbf{Z}_1)} = \exp(\boldsymbol{\beta}^\top (\mathbf{Z}_2 - \mathbf{Z}_1))$
这个比值不随时间 $t$ 变化，是一个常数。这正是“比例风险”的含义。

参数 $\exp(\beta_j)$ 的解释非常直观。它是在保持其他协变量不变的情况下，协变量 $Z_j$ 每增加一个单位，所对应的**风险比（Hazard Ratio, HR）**。例如，如果 $\exp(\beta_j) = 2$，则意味着 $Z_j$ 每增加一个单位，个体在任何时间点发生事件的瞬时风险都会变为原来的两倍。Cox模型的参数 $\boldsymbol{\beta}$ 通常通过最大化**偏似然函数（partial likelihood）**来估计，该方法巧妙地利用了风险集信息，而无需对基线风险 $\lambda_0(t)$ 进行估计。

### 扩展：[竞争风险](@entry_id:173277)

在许多研究中，个体可能经历多种不同类型的事件，且任何一种事件的发生都会妨碍其他事件的发生。这种情况被称为**[竞争风险](@entry_id:173277)（Competing Risks）**。例如，在对老年患者的研究中，心血管死亡和癌症死亡就是两种竞争性事件。

在[竞争风险](@entry_id:173277)框架下，我们不仅关心事件发生的时间 $T$，还关心事件的类型 $K$。此时，分析目标通常分为两种：病因学推断和绝对风险预测，这分别对应两种不同的风险建模方法 [@problem_id:4962141]。

#### 特定原因风险

**特定原因[风险函数](@entry_id:166593)（Cause-Specific Hazard Function）**，记为 $\lambda_k(t)$，定义为在时间 $t$ 仍未发生任何事件的个体，在下一瞬间发生第 $k$ 类事件的瞬时速率：
$\lambda_k(t) = \lim_{\Delta t \to 0} \frac{\mathbb{P}(t \le T < t+\Delta t, K=k \mid T \ge t)}{\Delta t}$
在对 $\lambda_k(t)$ 进行建模时，来自其他原因的事件（竞争事件）通常被当作右删失处理。这种方法的风险集只包含所有存活的个体。特定原因风险是研究协变量与特定事件类型生物学机制之间关系（**病因学推断, etiologic questions**）的恰当工具。

#### 子分布风险

为了预测个体在存在[竞争风险](@entry_id:173277)的情况下，发生某特定类型事件的**绝对概率（absolute risk）**，我们需要引入**累积发生率函数（Cumulative Incidence Function, CIF）**，记为 $F_k(t) = \mathbb{P}(T \le t, K=k)$。

**子分布[风险函数](@entry_id:166593)（Subdistribution Hazard Function）**，记为 $\tilde{\lambda}_k(t)$，是为直接对 CIF 建模而设计的。它被定义为：
$\tilde{\lambda}_k(t) = \frac{d/dt F_k(t)}{1 - F_k(t)}$
从这个定义可以看出，其风险集的分母是 $1-F_k(t) = \mathbb{P}(T > t \cup (T \le t, K \neq k))$。这意味着，用于子分布风险建模的风险集不仅包括那些仍然存活的个体，还**包括那些已经发生了竞争事件的个体**。虽然这个风险集在生物学上不直观，但它在数学上提供了一条直接连接协变量效应和累积发生率（即绝对风险）的路径，因此是**预测（prediction）**任务的理想工具。

总之，特定原因风险关注“为什么会发生”，而子分布风险关注“会不会发生以及多大概率发生”。在[竞争风险分析](@entry_id:634319)中，根据研究问题的性质（病因学 vs. 预测）选择合适的风险模型至关重要。