## 引言
在生物统计学和临床研究中，准确评估和总结患者的生存结局至关重要。虽然完整的生存曲线提供了最详尽的信息，但我们常常需要一个简洁的指标来概括群体的中心生存趋势，以便于沟通和比较。[中位生存时间](@entry_id:634182)，即50%的个体发生特定事件（如死亡或疾病复发）的时间点，正是这样一个核心统计量。然而，由于存在数据删失（如患者失访或研究结束时仍存活），简单计算[中位数](@entry_id:264877)的方法不再适用，这构成了生存分析中的一个基本挑战。

本文旨在系统性地阐释[中位生存时间](@entry_id:634182)的估计方法及其在现代数据分析中的应用。通过阅读本文，你将深入理解从基本原理到复杂应用的完整知识体系。

- **第一章：原理与机制** 将深入探讨[中位生存时间](@entry_id:634182)的定义，重点讲解处理[删失数据](@entry_id:173222)的黄金标准——Kaplan-Meier（KM）方法。你将学会如何一步步构建KM生存曲线，并从中准确估计[中位生存时间](@entry_id:634182)。此外，本章还将讨论估计中的常见挑战，如[中位数](@entry_id:264877)无法达到时的处理策略，并介绍限制性平均生存时间（RMST）等重要的替代方案。

- **第二章：应用与跨学科联系** 将展示这些理论在真实世界中的强大生命力。我们将探索[中位生存时间](@entry_id:634182)在临床风险分层、疗效比较中的核心作用，并讨论如何解读完整的生存曲线以应对非比例风险等复杂情况。本章还将触及竞争风险等高级主题，并阐明KM估计如何与Cox[回归模型](@entry_id:163386)乃至[机器学习算法](@entry_id:751585)（如随机生存森林）无缝整合。

- **第三章：动手实践** 将理论付诸实践。通过一系列精心设计的练习，你将亲手计算[中位生存时间](@entry_id:634182)，处理特殊情况，并探索如何量化估计的不确定性，从而巩固和深化所学知识。

## 原理与机制

在生存分析中，我们关注的核心是事件发生的时间。虽然完整的生存曲线本身提供了最全面的信息，但在临床交流和统计报告中，使用单一的概括性统计量来总结生存体验的中心趋势通常是必要且有用的。**[中位生存时间](@entry_id:634182)** (median survival time) 就是这样一个关键的度量指标，它标志着群体中 50% 的[个体发生](@entry_id:164036)事件的时间点。本章将深入探讨[中位生存时间](@entry_id:634182)的定义、估计方法、相关的统计推断，以及在实践中遇到的挑战和替代方案。

### [中位生存时间](@entry_id:634182)的定义

从直觉上看，[中位生存时间](@entry_id:634182)是指生存概率降至一半的时刻。设 $T$ 为一个表示事件发生时间的非负随机变量，其**生存函数** (survival function) $S(t)$ 定义为个体生存时间超过 $t$ 的概率，即 $S(t) = \Pr(T > t)$。对于一个连续且严格递减的生存函数，[中位生存时间](@entry_id:634182) $t_m$ 是方程 $S(t_m) = 0.5$ 的唯一解。

然而，在实际数据分析中，我们通常使用非参数方法（如 [Kaplan-Meier](@entry_id:169317) 方法）来估计生存函数。由此产生的估计生存函数 $\hat{S}(t)$ 是一个阶梯函数，它在事件发生的时间点上跳跃，而在事件之间保持平坦。对于这样的[阶梯函数](@entry_id:159192)，可能不存在任何时间 $t$ 使得 $\hat{S}(t)$ 恰好等于 $0.5$。因此，我们需要一个更严谨且普遍适用的定义。

在生物统计学中，[中位生存时间](@entry_id:634182)的标准定义是：**使估计的生存概率首次小于或等于 $0.5$ 的最早时间点**。用数学语言来说，[中位生存时间](@entry_id:634182) $t_m$ 定义为集合 $\{t : \hat{S}(t) \le 0.5\}$ 的[下确界](@entry_id:140118) (infimum)：

$$
t_m = \inf\{t : \hat{S}(t) \le 0.5\}
$$

这个定义确保了即使生存曲线在 $0.5$ 处有一个平台期，或者直接从高于 $0.5$ 跳到低于 $0.5$，[中位生存时间](@entry_id:634182)总能被唯一地确定为一个具体的数值 [@problem_id:4806029]。这个定义也等价于事件时间分布的下 $0.5$-分位数，即 $t_m = \inf\{t : F(t) \ge 0.5\}$，其中 $F(t) = 1 - S(t)$ 是[累积分布函数](@entry_id:143135)。

### 非参数估计：[Kaplan-Meier](@entry_id:169317) 方法

在处理包含**[右删失](@entry_id:164686)** (right-censoring) 的数据时，Kaplan-Meier (KM) 估计量是估计生存函数的标准非参数方法。[右删失](@entry_id:164686)指的是我们知道某个体的事件尚未在某个时间点之前发生，但不知道其确切的事件时间（例如，研究结束时患者仍然存活）。KM 方法通过在每个事件时间点更新生存概率来正确地利用来自事件和删失观测的信息。

KM 估计量 $\hat{S}(t)$ 的计算公式为**乘积限** (product-limit) 形式：
$$
\hat{S}(t) = \prod_{j: t_{(j)} \le t} \left(1 - \frac{d_j}{n_j}\right)
$$
其中 $t_{(j)}$ 是第 $j$ 个不同的事件时间，$d_j$ 是在时间 $t_{(j)}$ 发生的事件数，$n_j$ 是在时间 $t_{(j)}$ 之前处于**风险集** (at risk) 中的个体数量（即存活且未被删失的个体）。

#### 计算步骤与实例

为了阐明[中位生存时间](@entry_id:634182)的计算过程，让我们来看一个材料科学研究的实例 [@problem_id:1949188]。研究人员测试了 10 个聚合物复合材料试样的[疲劳寿命](@entry_id:182388)（单位：千次循环），数据如下（时间，状态），其中“失败”表示事件，“删失”表示观测终止：
(35, 失败), (51, 失败), (58, 删失), (66, 失败), (75, 删失), (89, 失败), (94, 删失), (105, 失败), (120, 失败), (140, 删失)。

我们可以构建一个[生命表](@entry_id:154706)来逐步计算 KM 生存曲线：

1.  在时间 $t=0$ 时，所有 $10$ 个试样都处于风险中，$\hat{S}(t)=1$。
2.  在第一个事件时间 $t=35$：风险集数量 $n_1=10$，事件数 $d_1=1$。
    $\hat{S}(35) = 1 \times (1 - \frac{1}{10}) = 0.9$。对于 $t \in [35, 51)$，$\hat{S}(t)=0.9$。
3.  在第二个事件时间 $t=51$：风险集数量 $n_2=9$，事件数 $d_2=1$。
    $\hat{S}(51) = 0.9 \times (1 - \frac{1}{9}) = 0.9 \times \frac{8}{9} = 0.8$。对于 $t \in [51, 66)$，$\hat{S}(t)=0.8$。注意，在 $t=58$ 发生的删失不改变生存函数的值，但它会将风险集人数减少到 $8$。
4.  在第三个事件时间 $t=66$：此时的风险集数量为 $n_3 = 10 - 2(\text{失败}) - 1(\text{删失}) = 7$，事件数 $d_3=1$。
    $\hat{S}(66) = 0.8 \times (1 - \frac{1}{7}) = 0.8 \times \frac{6}{7} \approx 0.686$。对于 $t \in [66, 89)$，$\hat{S}(t) \approx 0.686$。
5.  在第四个事件时间 $t=89$：在 $t=75$ 处又有一次删失。风险集数量为 $n_4=5$，事件数 $d_4=1$。
    $\hat{S}(89) = 0.686 \times (1 - \frac{1}{5}) \approx 0.549$。对于 $t \in [89, 105)$，$\hat{S}(t) \approx 0.549$。
6.  在第五个事件时间 $t=105$：在 $t=94$ 处又有一次删失。风险集数量为 $n_5=3$，事件数 $d_5=1$。
    $\hat{S}(105) = 0.549 \times (1 - \frac{1}{3}) \approx 0.366$。

现在，我们应用[中位生存时间](@entry_id:634182)的定义：寻找使 $\hat{S}(t) \le 0.5$ 的最小时间 $t$。
在 $t=89$ 时，$\hat{S}(89) \approx 0.549 > 0.5$。
在 $t=105$ 时，$\hat{S}(105) \approx 0.366 \le 0.5$。
因此，生存曲线首次降至 $0.5$ 或以下的时间点是 $105$。该样本的[中位生存时间](@entry_id:634182)估计为 $105$ 千次循环。

#### 常见的错误方法

理解正确方法的一个有效途径是识别并避免常见错误 [@problem_id:4926811] [@problem_id:4911091]。
- **错误1：忽略删失数据**。一种天真的方法是简单地计算所有观察到事件的时间的[中位数](@entry_id:264877)。这种方法会系统性地低估生存时间，因为它错误地将删失信息丢弃了。
- **错误2：线性插值**。另一种错误是在生存曲线跨越 $0.5$ 的两个事件时间点之间进行线性插值。KM 曲线是一个阶梯函数，其内在的非连续性必须得到尊重。[中位数](@entry_id:264877)对应于导致曲线穿越 $0.5$ 阈值的那个**事件时间**，而不是一个插值点。
- **错误3：使用朴素比例**。认为[中位生存时间](@entry_id:634182)是样本中恰好 50% 的个体发生事件的时间点。这种想法忽略了删失个体所携带的“生存时间大于其删失时间”的重要信息。

### 估计中的挑战与特殊情况

#### 无法达到的中位数 (Unreached Median)

在许多生存分析研究中，特别是在事件发生率较低或随访时间较短的情况下，可能会出现一个特殊情况：**KM 生存曲线在整个观测期间始终保持在 $0.5$ 以上** [@problem_id:4806010]。例如，如果研究结束时，$\hat{S}(t)$ 的最[终值](@entry_id:141018)是 $0.6$，那么集合 $\{t: \hat{S}(t) \le 0.5\}$ 就是一个[空集](@entry_id:261946)。根据定义，[中位数](@entry_id:264877)在这种情况下是无法从数据中估计出来的，或者说是“无法达到” (not reached)。

这是一个由数据本身的信息局限性导致的问题，而非方法的失败。在这种情况下，正确的报告策略至关重要：
1.  **诚实报告**：明确声明“[中位生存时间](@entry_id:634182)无法达到”。
2.  **提供置信下限**：虽然点估计无法获得，但通常可以计算[中位数](@entry_id:264877)的一个单侧[置信区间](@entry_id:138194)，例如报告“有 95% 的[置信度](@entry_id:267904)认为，[中位生存时间](@entry_id:634182)大于最长的随访时间 $t_{max}$”。
3.  **补充其他指标**：由于中位数信息缺失，应提供其他稳健且可估计的汇总统计量来描述生存体验。最常用的补充指标包括**里程碑生存率** (milestone survival)，即在某个特定时间点（如 1 年、5 年）的生存概率 $\hat{S}(\tau)$，以及**限制性平均生存时间** (Restricted Mean Survival Time, RMST)。

#### 生存曲线的尾部问题

与“无法达到的中位数”密切相关的是 KM 曲线的尾部行为 [@problem_id:4989542]。如果数据中最后一个观测是一个删失事件，那么在该时间点之后，风险集中将不再有任何个体。KM 曲线将在最后一次事件发生后保持水平，永远不会下降到 $0$。

这意味着，仅凭数据，我们无法得知分布的“尾部”是什么样子——这个现象被称为**尾部不可识别性** (tail non-identifiability)。因此，任何依赖于对整个生存分布积分的量，例如完整的**平均生存时间** $E[T] = \int_0^\infty S(t) dt$，在没有引入额外参数模型假设（即对尾部行为进行建模）的情况下是无法非参数地估计的。

### 替代方案：限制性平均生存时间 (RMST)

鉴于[中位生存时间](@entry_id:634182)可能无法估计以及平均生存时间对尾部行为的敏感性，**限制性平均生存时间** (Restricted Mean Survival Time, **RMST**) 作为一种越来越受欢迎的替代和补充指标应运而生 [@problem_id:4836425]。

RMST 的定义是在一个预先设定的时间截点 $\tau$ 内的平均生存时间。其正式定义为：
$$
\mathrm{RMST}(\tau) = E[\min(T, \tau)] = \int_0^\tau S(t) dt
$$
这个值在图形上等于生存曲线下方从 $0$ 到 $\tau$ 的面积 [@problem_id:4926829]。其解释是“在最初的 $\tau$ 时间单位内，群体平均存活的时间”。

RMST 具有几个显著的优点：
- **总是可估计**：只要 $\tau$ 选在观测时间范围内，$\mathrm{RMST}(\tau)$ 总是可以通过对 KM 曲线下的面积进行数值积分来估计，即使中位数无法达到。
- **稳健性**：它不依赖于对曲线尾部的不可靠估计或模型假设。
- **信息更全面**：与只关注 $S(t)=0.5$ 这个单一时间点的[中位数](@entry_id:264877)不同，RMST 整合了在整个 $[0, \tau]$ 区间内的生存信息。这在生存[曲线交叉](@entry_id:189391)（即非[比例风险](@entry_id:166780)）的情况下尤其有用，因为[中位数](@entry_id:264877)可能会掩盖重要的早期或晚期治疗效益差异。

选择一个临床上有意义的 $\tau$ 是应用 RMST 的关键步骤，它应该在研究设计阶段预先指定。

| 特征 | [中位生存时间](@entry_id:634182) | 限制性平均生存时间 (RMST) |
| :--- | :--- | :--- |
| **定义** | $S(t)=0.5$ 的时间点 | $[0, \tau]$ 区间内生存曲线下的面积 |
| **解释** | 50%的[个体发生](@entry_id:164036)事件的时间 | 在 $\tau$ 时间内平均的无事件生存时间 |
| **单位** | 时间（例如，月） | 时间（例如，月） |
| **对删失的敏感性** | 如果事件率低，可能无法估计 | 只要 $\tau$ 在观测范围内，总是可估计 |
| **对曲线形状的敏感性** | 只关注曲线的中心点 | 整合了 $[0, \tau]$ 内的全部曲线信息 |
| **适用场景** | 风险大致成比例，快速总结 | 风险非比例（[曲线交叉](@entry_id:189391)），中位数无法达到时 |

### [量化不确定性](@entry_id:272064)：[中位数的置信区间](@entry_id:636606)

获得[中位生存时间](@entry_id:634182)的点估计后，下一步是量化其抽样不确定性。**Brookmeyer-Crowley 方法**是构造中位数[置信区间](@entry_id:138194)的标准方法 [@problem_id:4826339]。

该方法的核心思想是**反转生存函数 $S(t)$ 的逐点评分[置信区间](@entry_id:138194)**。简而言之，[中位数](@entry_id:264877)的 $95\%$ [置信区间](@entry_id:138194)包含了所有这样的时间点 $t$，在这些时间点上，$S(t)$ 的 $95\%$ [置信区间](@entry_id:138194)包含了 $0.5$。

设 $[L(t), U(t)]$ 是 $S(t)$ 的 $95\%$ [置信区间](@entry_id:138194)，则[中位数](@entry_id:264877)的 $95\%$ [置信区间](@entry_id:138194) $[t_L, t_U]$ 是：
$$
t_L = \inf\{t : U(t) \le 0.5\} \quad \text{and} \quad t_U = \sup\{t : L(t) \ge 0.5\}
$$
为了构造 $[L(t), U(t)]$，我们需要 $\hat{S}(t)$ 的方差估计，这通常通过 **Greenwood 公式**得到。为了提高[置信区间](@entry_id:138194)的性能（特别是当生存概率接近 $0$ 或 $1$ 时），通常会在一个变换后的尺度上构造区间，然后反变换回来。**对数-[对数变换](@entry_id:267035)** (log-log transformation) $g(s) = \ln(-\ln(s))$ 是一种常用的变换。

使用这种变换， $S(t)$ 的[置信区间](@entry_id:138194)上下限为：
$$
L(t) = [\hat{S}(t)]^{\exp(z_{\alpha/2} \hat{\sigma}_g(t))} \quad \text{and} \quad U(t) = [\hat{S}(t)]^{\exp(-z_{\alpha/2} \hat{\sigma}_g(t))}
$$
其中 $z_{\alpha/2}$ 是[标准正态分布](@entry_id:184509)的分位数（对于 $95\%$ 置信度，为 $1.96$），而 $\hat{\sigma}_g(t)$ 是在对数-对数尺度上 $\hat{S}(t)$ 的[标准误](@entry_id:635378)，其计算依赖于 Greenwood 方差。

这个方法的有效性依赖于两个关键假设：
1.  **非信息性删失 (Non-informative censoring)**：删失的发生与个体的预后无关。
2.  **大样本**：该方法基于[正态近似](@entry_id:261668)，因此需要足够大的样本量来保证其准确性。对于小样本，[置信区间](@entry_id:138194)的实际覆盖率可能与名义水平（如 $95\%$）有所偏差。

### 备选方案：[参数化](@entry_id:265163)估计

到目前为止，我们讨论的都是[非参数方法](@entry_id:138925)，它们不对生存时间的潜在分布做任何假设。另一种方法是**[参数化建模](@entry_id:192148)**，即假定生存时间服从某个特定的概率分布，如指数分布、Weibull 分布或对数正态分布。

以 **Weibull 分布**为例 [@problem_id:4911082]。其生存函数为 $S(t) = \exp(-(\frac{t}{\lambda})^k)$，其中 $\lambda$ 是[尺度参数](@entry_id:268705)，$k$ 是[形状参数](@entry_id:270600)。我们可以为删失数据构建一个似然函数，然后通过**[最大似然估计](@entry_id:142509)** (Maximum Likelihood Estimation, MLE) 来估计参数 $\hat{\lambda}$ 和 $\hat{k}$。

一旦获得参数估计，我们就可以直接从模型中导出[中位生存时间](@entry_id:634182)。对于 Weibull 分布，令 $S(t_m) = 0.5$ 可解得：
$$
t_m = \lambda (\ln(2))^{1/k}
$$
将参数的 MLE 值代入即可得到[中位生存时间](@entry_id:634182)的估计值 $\hat{t}_m$。

[参数化](@entry_id:265163)方法的优点在于，如果所选模型正确，它通常比非参数方法更有效（即提供更精确的估计和更窄的[置信区间](@entry_id:138194)）。然而，其最大的风险在于**模型误设** (model misspecification)：如果真实的数据分布与所假定的模型不符，那么估计结果可能会有严重的偏倚。相比之下，[Kaplan-Meier](@entry_id:169317) 方法因其不对分布形式做假设而更加稳健。在实际应用中，方法的选择取决于研究目标、先验知识和对数据分布的探索性分析。