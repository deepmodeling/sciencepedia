{"hands_on_practices": [{"introduction": "生存分析的核心在于处理删失数据并估计生存概率。本练习将带您动手实践最基本也最重要的方法之一：生命表法（或称精算方法）。通过处理一个关于工业灯泡可靠性的假设数据集 [@problem_id:1925049]，您将学习如何逐步构建生命表，计算区间内的条件生存概率，并最终得到累积生存函数。这项实践将为您奠定坚实的基础，让您掌握如何从分组的、包含删失的原始数据中提取有价值的生存信息，并估计中位生存时间等关键指标。", "problem": "一家工程公司正在对一款新型号的工业灯泡进行可靠性研究。一批250个灯泡被投入测试，并在每周末记录其状态。如果灯泡烧坏，其寿命被视为“失效”；如果因失效以外的原因（例如，意外破损或为其他实验而移除）而从研究中撤出，则其寿命被视为“删失”。该研究进行了五周，并收集了以下数据：\n\n- **第1周（区间 [0, 1) 周）：** 10个失效，5个删失。\n- **第2周（区间 [1, 2) 周）：** 25个失效，3个删失。\n- **第3周（区间 [2, 3) 周）：** 40个失效，2个删失。\n- **第4周（区间 [3, 4) 周）：** 55个失效，0个删失。\n- **第5周（区间 [4, 5) 周）：** 30个失效，1个删失。\n\n为了处理删失数据，假设删失的灯泡在其被撤出的区间内平均承担了一半时间的风险。使用寿命表法和线性插值，估计这些灯泡的中位生存时间。\n\n最终答案以周为单位表示，并四舍五入到三位有效数字。", "solution": "目标是找到中位生存时间，即生存函数 $S(t)$ 等于0.5时的时间 $t_m$。我们将首先使用寿命表法构建一个寿命表来估计生存函数 $S(t)$，然后使用线性插值法找到 $t_m$。\n\n寿命表的计算是逐个区间进行的。对于每个从时间 $t_i$ 开始到 $t_{i+1}$ 结束的区间 $i$：\n- $n_i$：在区间 $i$ 开始时处于风险中的项目数。\n- $d_i$：在区间 $i$ 内的失效（事件）数。\n- $c_i$：在区间 $i$ 内的删失项目数。\n- $n'_i$：在区间 $i$ 内的有效风险项目数。鉴于删失平均发生在区间中点的假设，其计算公式为 $n'_i = n_i - \\frac{c_i}{2}$。\n- $q_i$：在区间 $i$ 内的条件失效概率，计算公式为 $q_i = \\frac{d_i}{n'_i}$。\n- $p_i$：通过区间 $i$ 的条件生存概率，计算公式为 $p_i = 1 - q_i$。\n- $S(t_{i+1})$：生存到区间 $i$ 结束的累积概率。这是所有先前条件生存概率的乘积：$S(t_{i+1}) = S(t_i) \\times p_i$。我们从 $S(t_0) = S(0) = 1$ 开始。\n\n让我们根据提供的数据填充寿命表。\n\n**区间 1: [0, 1) 周**\n- 期初风险数，$n_0 = 250$。\n- 失效数，$d_0 = 10$。\n- 删失数，$c_0 = 5$。\n- 有效风险数，$n'_0 = 250 - \\frac{5}{2} = 247.5$。\n- 条件失效概率，$q_0 = \\frac{10}{247.5}$。\n- 条件生存概率，$p_0 = 1 - \\frac{10}{247.5} = \\frac{237.5}{247.5}$。\n- 在 $t=1$ 时的累积生存率，$S(1) = S(0) \\times p_0 = 1 \\times \\frac{237.5}{247.5} \\approx 0.959596$。\n\n**区间 2: [1, 2) 周**\n- 期初风险数，$n_1 = n_0 - d_0 - c_0 = 250 - 10 - 5 = 235$。\n- 失效数，$d_1 = 25$。\n- 删失数，$c_1 = 3$。\n- 有效风险数，$n'_1 = 235 - \\frac{3}{2} = 233.5$。\n- 条件失效概率，$q_1 = \\frac{25}{233.5}$。\n- 条件生存概率，$p_1 = 1 - \\frac{25}{233.5} = \\frac{208.5}{233.5}$。\n- 在 $t=2$ 时的累积生存率，$S(2) = S(1) \\times p_1 = \\left(\\frac{237.5}{247.5}\\right) \\times \\left(\\frac{208.5}{233.5}\\right) \\approx 0.857790$。\n\n**区间 3: [2, 3) 周**\n- 期初风险数，$n_2 = n_1 - d_1 - c_1 = 235 - 25 - 3 = 207$。\n- 失效数，$d_2 = 40$。\n- 删失数，$c_2 = 2$。\n- 有效风险数，$n'_2 = 207 - \\frac{2}{2} = 206$。\n- 条件失效概率，$q_2 = \\frac{40}{206} = \\frac{20}{103}$。\n- 条件生存概率，$p_2 = 1 - \\frac{20}{103} = \\frac{83}{103}$。\n- 在 $t=3$ 时的累积生存率，$S(3) = S(2) \\times p_2 \\approx 0.857790 \\times \\frac{83}{103} \\approx 0.691143$。\n\n**区间 4: [3, 4) 周**\n- 期初风险数，$n_3 = n_2 - d_2 - c_2 = 207 - 40 - 2 = 165$。\n- 失效数，$d_3 = 55$。\n- 删失数，$c_3 = 0$。\n- 有效风险数，$n'_3 = 165 - \\frac{0}{2} = 165$。\n- 条件失效概率，$q_3 = \\frac{55}{165} = \\frac{1}{3}$。\n- 条件生存概率，$p_3 = 1 - \\frac{1}{3} = \\frac{2}{3}$。\n- 在 $t=4$ 时的累积生存率，$S(4) = S(3) \\times p_3 \\approx 0.691143 \\times \\frac{2}{3} \\approx 0.460762$。\n\n我们现在已经确定 $S(3) \\approx 0.691143$ 且 $S(4)  0.5$，中位生存时间 $t_m$ 位于区间 $[3, 4)$ 内。\n\n我们使用线性插值法来估计 $t_m$。线性插值的公式是：\n$t_m = t_j + w_j \\left( \\frac{S(t_j) - 0.5}{S(t_j) - S(t_{j+1})} \\right)$\n其中：\n- $t_j$ 是中位区间的起始时间，所以 $t_j = 3$ 周。\n- $w_j$ 是中位区间的宽度，所以 $w_j = 4 - 3 = 1$ 周。\n- $S(t_j)$ 是区间开始时的生存概率，$S(3) \\approx 0.691143$。\n- $S(t_{j+1})$ 是区间结束时的生存概率，$S(4) \\approx 0.460762$。\n\n代入数值：\n$t_m = 3 + 1 \\times \\left( \\frac{0.691143 - 0.5}{0.691143 - 0.460762} \\right)$\n$t_m = 3 + \\frac{0.191143}{0.230381}$\n$t_m \\approx 3 + 0.82968$\n$t_m \\approx 3.82968$\n\n题目要求答案四舍五入到三位有效数字。\n$t_m \\approx 3.83$ 周。", "answer": "$$\\boxed{3.83}$$", "id": "1925049"}, {"introduction": "在掌握了从数据直接估计生存曲线的非参数方法后，我们常常会转向参数模型，假设事件时间遵循特定的概率分布。这种方法能让我们进行更深入的推断。本练习 [@problem_id:1925111] 引导您进入参数生存分析的世界，要求您为遵循瑞利（Rayleigh）分布的生存数据推导参数的极大似然估计（MLE）。您将学习如何为包含精确事件时间和右删失观测的数据构建似然函数，这是处理复杂数据结构时统计推断的基石。", "problem": "对一种新型电子元件进行可靠性研究。总共有 $n$ 个元件被置于寿命测试中。对于每个元件 $i$（其中 $i = 1, \\dots, n$），观测值由一对数据 $(t_i, \\delta_i)$ 组成。这里，$t_i$ 是以小时为单位的观测时间。事件指示符 $\\delta_i$ 定义为：如果元件在时间 $t_i$ 失效，则 $\\delta_i = 1$；如果在研究终止时元件仍在时间 $t_i$ 正常工作（一个右删失观测值），则 $\\delta_i = 0$。\n\n假设元件的寿命 $T$ 服从瑞利分布，其概率密度函数（PDF）由下式给出\n$$f(t; \\sigma) = \\frac{t}{\\sigma^2} \\exp\\left(-\\frac{t^2}{2\\sigma^2}\\right)$$\n其中 $t > 0$ 且参数 $\\sigma > 0$。\n\n基于这组 $n$ 个观测值 $\\{ (t_i, \\delta_i) \\}_{i=1}^n$，确定参数 $\\sigma^2$ 的最大似然估计量（MLE）。您的答案应该是一个以观测数据 $t_i$ 和 $\\delta_i$ 表示的解析表达式。", "solution": "对于右删失寿命数据，在密度为 $f(t;\\sigma)$、生存函数为 $S(t;\\sigma)$ 的参数模型下，似然函数为\n$$\nL(\\sigma)=\\prod_{i=1}^{n}\\left[f(t_{i};\\sigma)\\right]^{\\delta_{i}}\\left[S(t_{i};\\sigma)\\right]^{1-\\delta_{i}}.\n$$\n对于瑞利模型，其\n$$\nf(t;\\sigma)=\\frac{t}{\\sigma^{2}}\\exp\\left(-\\frac{t^{2}}{2\\sigma^{2}}\\right),\\quad t>0,\n$$\n生存函数为\n$$\nS(t;\\sigma)=\\exp\\left(-\\frac{t^{2}}{2\\sigma^{2}}\\right),\n$$\n因为 $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\left[-\\exp\\left(-\\frac{t^{2}}{2\\sigma^{2}}\\right)\\right]=\\frac{t}{\\sigma^{2}}\\exp\\left(-\\frac{t^{2}}{2\\sigma^{2}}\\right)=f(t;\\sigma)$。\n\n因此，似然函数变为\n$$\nL(\\sigma)=\\prod_{i=1}^{n}\\left(\\frac{t_{i}}{\\sigma^{2}}\\exp\\left(-\\frac{t_{i}^{2}}{2\\sigma^{2}}\\right)\\right)^{\\delta_{i}}\\left(\\exp\\left(-\\frac{t_{i}^{2}}{2\\sigma^{2}}\\right)\\right)^{1-\\delta_{i}}\n=\\left(\\prod_{i=1}^{n}t_{i}^{\\delta_{i}}\\right)\\sigma^{-2\\sum_{i=1}^{n}\\delta_{i}}\\exp\\left(-\\frac{1}{2\\sigma^{2}}\\sum_{i=1}^{n}t_{i}^{2}\\right).\n$$\n令 $\\theta=\\sigma^{2}$，并记 $d=\\sum_{i=1}^{n}\\delta_{i}$ 和 $S_{2}=\\sum_{i=1}^{n}t_{i}^{2}$。关于 $\\theta$ 的对数似然函数为\n$$\n\\ell(\\theta)=-d\\ln\\theta+\\sum_{i=1}^{n}\\delta_{i}\\ln t_{i}-\\frac{S_{2}}{2\\theta}.\n$$\n求导并令其为零，\n$$\n\\frac{\\partial\\ell}{\\partial\\theta}=-\\frac{d}{\\theta}+\\frac{S_{2}}{2\\theta^{2}}=0\n\\;\\;\\Longrightarrow\\;\\; -d\\theta+\\frac{S_{2}}{2}=0\n\\;\\;\\Longrightarrow\\;\\; \\hat{\\theta}=\\frac{S_{2}}{2d}=\\frac{\\sum_{i=1}^{n}t_{i}^{2}}{2\\sum_{i=1}^{n}\\delta_{i}}.\n$$\n二阶导数为\n$$\n\\frac{\\partial^{2}\\ell}{\\partial\\theta^{2}}=\\frac{d}{\\theta^{2}}-\\frac{S_{2}}{\\theta^{3}},\n$$\n当 $d>0$ 时，其在 $\\hat{\\theta}$ 处的值等于 $-\\frac{d}{\\hat{\\theta}^{2}}  0$，这证实了该点为最大值点。如果 $d=0$，则似然函数关于 $\\theta$ 是非递减的，不存在有限的最大似然估计量。因此，在至少有一次观测到失效的情况下，$\\sigma^{2}$ 的最大似然估计量为\n$$\n\\hat{\\sigma}^{2}=\\frac{\\sum_{i=1}^{n}t_{i}^{2}}{2\\sum_{i=1}^{n}\\delta_{i}}.\n$$", "answer": "$$\\boxed{\\frac{\\sum_{i=1}^{n} t_{i}^{2}}{2 \\sum_{i=1}^{n} \\delta_{i}}}$$", "id": "1925111"}, {"introduction": "任何统计估计都离不开对其不确定性的量化。仅仅给出一个点估计（如中位生存时间）是不够的，我们还需要知道这个估计的可靠程度。本练习 [@problem_id:1925069] 介绍了一种强大而现代的方法——非参数自助法（bootstrap）——来解决这个问题。通过分析一个给定的自助抽样结果集，您将使用百分位法来构建中位生存时间的置信区间，从而为您的估计提供一个合理的范围。这项实践将让您体会到计算密集型方法在现代统计学中评估估计量不确定性方面的重要作用。", "problem": "一个城市的水务管理部门正在评估一种特定型号高容量水泵的可靠性。一项研究对10台水泵的样本进行了为期8年的跟踪调查。对于每台水泵，记录的数据是一个数据对$(T, \\delta)$，其中$T$是以年为单位的时间（指故障时间或研究结束时的时间），$\\delta$是一个状态指示符（$\\delta=1$表示发生故障，$\\delta=0$表示在研究结束时仍在运行）。数据集为：\n(1.9, 1), (2.8, 1), (3.1, 1), (4.2, 1), (5.5, 1), (6.9, 1), (7.8, 1), (8.0, 0), (8.0, 0), (8.0, 0)。\n\n为了量化估计的中位寿命的不确定性，研究人员执行了一个非参数自助法程序。通过对原始的10个数据对进行有放回重抽样，总共生成了`B = 39`个自助法样本。对于每个自助法样本，都估计了中位寿命（在许多情况下，由于自助法样本也包含删失数据，因此使用了Kaplan-Meier估计量）。得到的39个中位寿命估计值按升序排列如下：\n\n`[3.1, 4.2, 4.2, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 5.5, 6.9, 6.9, 6.9, 6.9, 6.9, 6.9, 6.9, 6.9, 6.9, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 7.8, 8.0, 8.0, 8.0]`\n\n使用自助法百分位数法，确定水泵中位寿命的95%置信区间。以一对值的形式表示你的答案，这两个值分别代表区间的下限和上限，单位为年。将你的最终答案四舍五入到两位有效数字。", "solution": "我们得到了$B=39$个中位寿命的自助法复制，并已按升序排列。使用自助法百分位数法构建置信水平为$1-\\alpha=0.95$（因此$\\alpha=0.05$）的双侧置信区间，其端点是自助法分布在概率$p_{\\ell}=\\alpha/2=0.025$和$p_{u}=1-\\alpha/2=0.975$处的经验分位数。\n\n将排序后的自助法统计量表示为$x_{(1)} \\leq x_{(2)} \\leq \\dots \\leq x_{(B)}$，百分位数法使用基于$(B+1)p$并根据最近秩规则计算的顺序统计量索引，即\n$$\nk_{\\ell}=\\lceil (B+1)p_{\\ell} \\rceil,\\quad k_{u}=\\lceil (B+1)p_{u} \\rceil.\n$$\n代入$B=39$，我们得到$B+1=40$，所以\n$$\nk_{\\ell}=\\lceil 40 \\cdot 0.025 \\rceil=\\lceil 1 \\rceil=1,\\qquad\nk_{u}=\\lceil 40 \\cdot 0.975 \\rceil=\\lceil 39 \\rceil=39.\n$$\n因此，$95\\%$的自助法百分位置信区间由所提供的排序列表中的第一个和第三十九个顺序统计量给出。从列表中读出，$x_{(1)}=3.1$和$x_{(39)}=8.0$。四舍五入到两位有效数字后，值保持不变。\n\n因此，水泵中位寿命的$95\\%$置信区间为$(3.1, 8.0)$年。", "answer": "$$\\boxed{\\begin{pmatrix} 3.1  8.0 \\end{pmatrix}}$$", "id": "1925069"}]}