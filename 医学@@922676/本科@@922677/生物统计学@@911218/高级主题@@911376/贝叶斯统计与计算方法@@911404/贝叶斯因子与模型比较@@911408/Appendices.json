{"hands_on_practices": [{"introduction": "理解贝叶斯因子的最好方法莫过于从头推导一个。这个练习将引导你完成一个最基本也最常见场景下的推导：检验正态分布的均值。通过这个练习，你将从第一性原理出发，亲手计算零假设和备择假设下的边缘似然，为理解更复杂的应用打下坚实的基础。[@problem_id:4896235]", "problem": "一个临床实验室测量了 $n$ 名独立同分布 (i.i.d.) 患者的连续生物标志物，并将观测值建模为 $y_{1},\\dots,y_{n} \\sim \\mathcal{N}(\\mu,\\sigma^{2})$，其中方差 $\\sigma^{2}$ 已知。科学问题是总体均值水平是否恰好为零。考虑点零假设 $H_{0}:\\mu=0$ 与备择假设 $H_{1}:\\mu \\sim \\mathcal{N}(0,\\tau^{2})$ 之间的模型比较，其中 $\\tau^{2}$ 是一个指定的先验方差，反映了在 $H_{1}$ 下合理的效应量。使用贝叶斯因子 (BF) 作为边际似然比的定义，从第一性原理出发，推导支持 $H_{1}$ 相对于 $H_{0}$ 的贝叶斯因子（记为 $BF_{10}$）。推导需从已知方差的正态模型的似然函数以及每个假设下的边际似然定义开始，并在 $H_{1}$ 下对参数执行所需的积分。将您的最终答案表示为仅包含样本均值 $\\bar{y}$、样本量 $n$、已知方差 $\\sigma^{2}$ 和先验方差 $\\tau^{2}$ 的简化单一闭式表达式。除这四个量外，不要引入任何其他统计量。最终答案必须是单一的解析表达式，无需进行数值计算或四舍五入。", "solution": "根据指定标准对所述问题进行形式化分析和验证。\n\n**步骤 1：提取已知条件**\n- 数据：$y_{1}, \\dots, y_{n}$ 是独立同分布 (i.i.d.) 的观测值。\n- 数据生成模型：$y_i \\sim \\mathcal{N}(\\mu, \\sigma^2)$，对于 $i=1, \\dots, n$。\n- 已知参数：方差 $\\sigma^2$ 是已知的。\n- 零假设 $H_0$：参数 $\\mu$ 固定为特定值，$\\mu=0$。\n- 备择假设 $H_1$：参数 $\\mu$ 是一个从先验分布中抽取的随机变量，$\\mu \\sim \\mathcal{N}(0, \\tau^2)$。\n- 已知超参数：先验方差 $\\tau^2$ 是指定的。\n- 目标：推导支持 $H_1$ 相对于 $H_0$ 的贝叶斯因子，记为 $BF_{10}$。推导必须从第一性原理出发。\n- 要求最终表达式以样本均值 $\\bar{y}$、样本量 $n$、已知方差 $\\sigma^2$ 和先验方差 $\\tau^2$ 表示。\n\n**步骤 2：使用提取的已知条件进行验证**\n对问题的有效性进行评估：\n- **科学依据：** 该问题是贝叶斯模型比较中的一个经典基础练习。对均值参数使用正态似然和共轭正态先验是一种标准的教科书案例（常被称为“贝叶斯 Z 检验”）。这是统计学及其应用（包括生物统计学）中一种成熟的方法。不存在科学或事实上的不健全之处。\n- **适定性：** 该问题在数学上是适定的。所有必要信息（似然函数、包括 $H_1$ 的先验在内的假设，以及已知常数）都已提供，足以推导出贝叶斯因子。存在唯一的解析解。\n- **客观性：** 该问题使用精确、形式化且无偏见的数学语言陈述。\n\n**步骤 3：结论与行动**\n该问题被认为是**有效的**。它在科学上是健全的、适定的、客观的，并包含了完整推导所需的所有信息。现在将开始求解过程。\n\n**贝叶斯因子的推导**\n\n贝叶斯因子 $BF_{10}$ 定义为数据 $y = (y_1, \\dots, y_n)$ 在假设 $H_1$ 下的边际似然与在假设 $H_0$ 下的边际似然之比：\n$$\nBF_{10} = \\frac{p(y|H_1)}{p(y|H_0)}\n$$\n根据充分性原则，贝叶斯因子可以使用参数 $\\mu$ 的充分统计量来计算。对于已知方差 $\\sigma^2$ 的正态分布，样本均值 $\\bar{y} = \\frac{1}{n}\\sum_{i=1}^n y_i$ 是 $\\mu$ 的一个充分统计量。给定 $\\mu$ 时，$\\bar{y}$ 的抽样分布为：\n$$\n\\bar{y} | \\mu, \\sigma^2 \\sim \\mathcal{N}\\left(\\mu, \\frac{\\sigma^2}{n}\\right)\n$$\n因此，我们将贝叶斯因子计算为充分统计量 $\\bar{y}$ 的边际似然之比：\n$$\nBF_{10} = \\frac{p(\\bar{y}|H_1)}{p(\\bar{y}|H_0)}\n$$\n\n**1. $H_0$ 下的边际似然**\n\n在零假设 $H_0$ 下，均值 $\\mu$ 固定为 $0$。因此，$\\bar{y}$ 的抽样分布为：\n$$\n\\bar{y} | H_0 \\sim \\mathcal{N}\\left(0, \\frac{\\sigma^2}{n}\\right)\n$$\n在 $H_0$ 下，$\\bar{y}$ 在观测样本均值处的概率密度函数 (PDF) 为：\n$$\np(\\bar{y}|H_0) = \\frac{1}{\\sqrt{2\\pi(\\sigma^2/n)}} \\exp\\left(-\\frac{\\bar{y}^2}{2(\\sigma^2/n)}\\right) = \\sqrt{\\frac{n}{2\\pi\\sigma^2}} \\exp\\left(-\\frac{n\\bar{y}^2}{2\\sigma^2}\\right)\n$$\n\n**2. $H_1$ 下的边际似然**\n\n在备择假设 $H_1$ 下，参数 $\\mu$ 不是固定的，而是被视为一个具有指定先验分布的随机变量，$\\mu \\sim \\mathcal{N}(0, \\tau^2)$。$\\bar{y}$ 的模型是分层的：\n$$\n\\text{第一层 (抽样分布): } \\bar{y}|\\mu \\sim \\mathcal{N}\\left(\\mu, \\frac{\\sigma^2}{n}\\right)\n$$\n$$\n\\text{第二层 (先验分布): } \\mu \\sim \\mathcal{N}(0, \\tau^2)\n$$\n为求得边际似然 $p(\\bar{y}|H_1)$，我们将 $\\bar{y}$ 和 $\\mu$ 的联合分布对所有可能的 $\\mu$ 值进行积分：\n$$\np(\\bar{y}|H_1) = \\int_{-\\infty}^{\\infty} p(\\bar{y}|\\mu) p(\\mu|H_1) d\\mu\n$$\n这等价于求 $\\bar{y}$ 的边际分布。对于这个分层正态模型，$\\bar{y}$ 的边际分布也是正态的。我们可以使用全期望定律和全方差定律来找到其参数。\n\n$\\bar{y}$ 的边际均值为：\n$$\nE[\\bar{y}|H_1] = E[E[\\bar{y}|\\mu]] = E[\\mu] = 0\n$$\n$\\bar{y}$ 的边际方差为：\n$$\n\\text{Var}(\\bar{y}|H_1) = E[\\text{Var}(\\bar{y}|\\mu)] + \\text{Var}(E[\\bar{y}|\\mu]) = E\\left[\\frac{\\sigma^2}{n}\\right] + \\text{Var}(\\mu) = \\frac{\\sigma^2}{n} + \\tau^2\n$$\n因此，在 $H_1$ 下 $\\bar{y}$ 的边际分布为：\n$$\n\\bar{y}|H_1 \\sim \\mathcal{N}\\left(0, \\frac{\\sigma^2}{n} + \\tau^2\\right)\n$$\n在 $H_1$ 下 $\\bar{y}$ 的概率密度函数为：\n$$\np(\\bar{y}|H_1) = \\frac{1}{\\sqrt{2\\pi\\left(\\frac{\\sigma^2}{n} + \\tau^2\\right)}} \\exp\\left(-\\frac{\\bar{y}^2}{2\\left(\\frac{\\sigma^2}{n} + \\tau^2\\right)}\\right)\n$$\n\n**3. 组合贝叶斯因子**\n\n现在，我们计算比率 $BF_{10} = p(\\bar{y}|H_1) / p(\\bar{y}|H_0)$：\n$$\nBF_{10} = \\frac{\\frac{1}{\\sqrt{2\\pi\\left(\\frac{\\sigma^2}{n} + \\tau^2\\right)}} \\exp\\left(-\\frac{\\bar{y}^2}{2\\left(\\frac{\\sigma^2}{n} + \\tau^2\\right)}\\right)}{\\frac{1}{\\sqrt{2\\pi\\left(\\frac{\\sigma^2}{n}\\right)}} \\exp\\left(-\\frac{\\bar{y}^2}{2\\left(\\frac{\\sigma^2}{n}\\right)}\\right)}\n$$\n我们可以将该比率分为两部分：归一化常数的比率和指数项的比率。\n\n常数比率：\n$$\n\\frac{\\sqrt{2\\pi(\\sigma^2/n)}}{\\sqrt{2\\pi(\\sigma^2/n + \\tau^2)}} = \\sqrt{\\frac{\\sigma^2/n}{\\sigma^2/n + \\tau^2}} = \\sqrt{\\frac{\\sigma^2/n}{(\\sigma^2 + n\\tau^2)/n}} = \\sqrt{\\frac{\\sigma^2}{\\sigma^2 + n\\tau^2}}\n$$\n该项也可以写作 $(\\frac{\\sigma^2}{\\sigma^2 + n\\tau^2})^{1/2}$。\n\n指数项比率：\n$$\n\\frac{\\exp\\left(-\\frac{\\bar{y}^2}{2(\\sigma^2/n + \\tau^2)}\\right)}{\\exp\\left(-\\frac{\\bar{y}^2}{2(\\sigma^2/n)}\\right)} = \\exp\\left(\\frac{\\bar{y}^2}{2(\\sigma^2/n)} - \\frac{\\bar{y}^2}{2(\\sigma^2/n + \\tau^2)}\\right)\n$$\n我们来简化指数部分：\n$$\n\\frac{\\bar{y}^2}{2}\\left[\\frac{1}{\\sigma^2/n} - \\frac{1}{\\sigma^2/n + \\tau^2}\\right] = \\frac{\\bar{y}^2}{2}\\left[\\frac{(\\sigma^2/n + \\tau^2) - (\\sigma^2/n)}{(\\sigma^2/n)(\\sigma^2/n + \\tau^2)}\\right]\n$$\n$$\n= \\frac{\\bar{y}^2}{2}\\left[\\frac{\\tau^2}{(\\sigma^2/n)((\\sigma^2 + n\\tau^2)/n)}\\right] = \\frac{\\bar{y}^2}{2}\\left[\\frac{\\tau^2}{\\sigma^2(\\sigma^2 + n\\tau^2)/n^2}\\right] = \\frac{n^2 \\bar{y}^2 \\tau^2}{2\\sigma^2(\\sigma^2 + n\\tau^2)}\n$$\n将两部分结合起来，得到贝叶斯因子的最终表达式：\n$$\nBF_{10} = \\left(\\frac{\\sigma^2}{\\sigma^2 + n\\tau^2}\\right)^{1/2} \\exp\\left(\\frac{n^2 \\bar{y}^2 \\tau^2}{2\\sigma^2 (\\sigma^2 + n\\tau^2)}\\right)\n$$\n该表达式由所要求的量 $\\bar{y}$、$n$、$\\sigma^2$ 和 $\\tau^2$ 表示。", "answer": "$$\n\\boxed{\\left(\\frac{\\sigma^2}{\\sigma^2 + n\\tau^2}\\right)^{1/2} \\exp\\left(\\frac{n^2 \\bar{y}^2 \\tau^2}{2\\sigma^2 (\\sigma^2 + n\\tau^2)}\\right)}\n$$", "id": "4896235"}, {"introduction": "掌握了基本计算之后，我们来探讨一个关键的思辨性问题：贝叶斯因子与我们熟悉的$p$值有何异同？这个被称为“林德利悖论”的思想实验，揭示了两种证据度量方式的根本区别，尤其是在“大数据”时代。这个练习将挑战你对统计显著性和证据强度的直觉，促使你更深刻地思考统计结果的解释。[@problem_id:4896239]", "problem": "一项生物统计学研究在一个大型队列中测量一个连续的生物标志物。设 $y_{1},\\dots,y_{n}$ 为独立同分布的观测值，其模型为 $y_{i}\\sim \\mathcal{N}(\\mu,\\sigma^{2})$，其中 $\\sigma^{2}$ 通过分析验证已知。考虑检验点原假设 $H_{0}:\\mu=0$ 与复合备择假设 $H_{1}:\\mu\\neq 0$，在 $H_{1}$ 下的先验分布为 $\\mu\\sim \\mathcal{N}(0,\\tau^{2})$，其中 $\\tau^{2}0$ 是一个固定的常数，不依赖于 $n$。将支持 $H_{1}$ 相对于 $H_{0}$ 的贝叶斯因子 (BF) 定义为 $BF_{10}=\\dfrac{m_{1}(\\bar{y})}{m_{0}(\\bar{y})}$，其中 $m_{j}(\\bar{y})$ 表示在假设 $H_{j}$ 下样本均值 $\\bar{y}$ 的边际似然。并将 $z$ 检验的双侧 $p$ 值定义为 $p=2\\left(1-\\Phi(|z_{n}|)\\right)$，其中 $\\Phi(\\cdot)$ 是标准正态分布的累积分布函数，且 $z_{n}=\\sqrt{n}\\,\\bar{y}/\\sigma$。假设在一个“扩散先验”机制下，$\\tau^{2}$ 是一个相对于 $\\sigma^{2}$ 较大的固定常数，并考虑一个由 $n$ 索引的研究序列，使得标准化的检验统计量对所有 $n\\geq 1$ 都固定在一个预设值 $z_{n}=z_{0}$（这意味着 $\\bar{y}$ 随着 $n$ 的增长而缩小）。仅从上述给出的正态抽样模型、贝叶斯因子和 $z$ 检验 $p$ 值的定义出发，推导 $BF_{10}$ 关于 $z_{0}$、$n$、$\\sigma$ 和 $\\tau$ 的精确表达式，对其进行简化，然后取其在 $n\\to\\infty$ 时的极限。同时，确定与此固定 $z_{0}$ 相对应的双侧 $z$ 检验 $p$ 值。请将您的最终答案表示为 $1\\times 2$ 的行向量 $\\left[\\lim_{n\\to\\infty} BF_{10},\\; p\\right]$。不需要数值近似；请使用 $\\Phi(\\cdot)$ 以闭合形式写出 $p$ 值。", "solution": "首先验证问题，以确保其科学性、良定性和客观性。\n\n### 第 1 步：提取已知条件\n-   **数据模型**：$y_{1}, \\dots, y_{n}$ 是来自正态分布的独立同分布 (i.i.d.) 观测值，$y_{i} \\sim \\mathcal{N}(\\mu, \\sigma^{2})$。\n-   **已知参数**：方差 $\\sigma^{2}$ 已知。\n-   **假设**：\n    -   原假设 $H_{0}: \\mu=0$。\n    -   备择假设 $H_{1}: \\mu \\neq 0$。\n-   **先验分布**：在 $H_{1}$ 下，$\\mu$ 的先验分布为 $\\mu \\sim \\mathcal{N}(0, \\tau^{2})$，其中 $\\tau^{2} > 0$ 是一个不依赖于 $n$ 的固定常数。\n-   **贝叶斯因子定义**：支持 $H_{1}$ 相对于 $H_{0}$ 的贝叶斯因子是 $BF_{10} = \\dfrac{m_{1}(\\bar{y})}{m_{0}(\\bar{y})}$，其中 $m_{j}(\\bar{y})$ 是在假设 $H_{j}$ 下样本均值 $\\bar{y}$ 的边际似然。\n-   **检验统计量定义**：$z$ 检验统计量是 $z_{n} = \\sqrt{n}\\,\\bar{y}/\\sigma$。\n-   **p 值定义**：双侧 $p$ 值是 $p=2\\left(1-\\Phi(|z_{n}|)\\right)$，其中 $\\Phi(\\cdot)$ 是标准正态分布的累积分布函数 (CDF)。\n-   **渐近条件**：分析考虑一个研究序列，其中检验统计量对所有 $n \\geq 1$ 都固定在一个值 $z_{n} = z_{0}$。\n\n### 第 2 步：使用提取的已知条件进行验证\n问题陈述在科学上是合理的，它基于统计推断的基本原理，特别是贝叶斯和频率学派的假设检验。模型、先验和检验的定义在生物统计学中是标准的。问题是良定的，提供了执行所要求的推导所需的所有必要信息。条件 $z_{n}=z_{0}$ 是一个理论构造，用于检验贝叶斯因子的渐近性质及其与 $p$ 值的关系，这是一个被称为 Jeffreys-Lindley 悖论的经典设置。这并不代表物理上的不可能，而是要研究的一个特定的数学极限。问题的语言是客观和明确的。它不是不完整的、矛盾的或琐碎的。\n\n### 第 3 步：结论和行动\n问题是有效的。将提供一个完整的解答。\n\n### 解答的推导\n\n第一步是推导在每个假设下样本均值 $\\bar{y}$ 的边际似然。给定数据 $y_{i} \\sim \\mathcal{N}(\\mu, \\sigma^{2})$，样本均值 $\\bar{y} = \\frac{1}{n}\\sum_{i=1}^{n} y_{i}$ 的抽样分布为 $\\bar{y}|\\mu \\sim \\mathcal{N}(\\mu, \\sigma^{2}/n)$。\n\n**$H_{0}$ 下的边际似然**\n在原假设 $H_{0}: \\mu=0$ 下，$\\bar{y}$ 的分布由抽样模型直接指定，其中 $\\mu$ 设为 0：\n$$\n\\bar{y}|H_{0} \\sim \\mathcal{N}(0, \\sigma^{2}/n)\n$$\n在 $H_{0}$ 下的边际似然，记为 $m_{0}(\\bar{y})$，是在观测到的 $\\bar{y}$ 处评估的该分布的概率密度函数 (PDF)：\n$$\nm_{0}(\\bar{y}) = \\frac{1}{\\sqrt{2\\pi(\\sigma^{2}/n)}} \\exp\\left(-\\frac{\\bar{y}^{2}}{2(\\sigma^{2}/n)}\\right) = \\frac{\\sqrt{n}}{\\sqrt{2\\pi}\\sigma} \\exp\\left(-\\frac{n\\bar{y}^{2}}{2\\sigma^{2}}\\right)\n$$\n\n**$H_{1}$ 下的边际似然**\n在备择假设 $H_{1}$ 下，参数 $\\mu$ 被视为一个随机变量，其先验分布为 $\\mu \\sim \\mathcal{N}(0, \\tau^{2})$。边际似然 $m_{1}(\\bar{y})$ 是通过将似然 $p(\\bar{y}|\\mu)$ 和先验 $p(\\mu|H_{1})$ 的乘积对所有可能的 $\\mu$ 值进行积分得到的：\n$$\nm_{1}(\\bar{y}) = \\int_{-\\infty}^{\\infty} p(\\bar{y}|\\mu) p(\\mu|H_{1}) \\, d\\mu\n$$\n这是两个正态分布的标准卷积。我们有：\n-   似然：$\\bar{y}|\\mu \\sim \\mathcal{N}(\\mu, \\sigma^{2}/n)$\n-   先验：$\\mu \\sim \\mathcal{N}(0, \\tau^{2})$\n得到的 $\\bar{y}$ 的边际分布也是正态的。边际分布的均值为 $E[\\bar{y}] = E[E[\\bar{y}|\\mu]] = E[\\mu] = 0$。方差为 $Var(\\bar{y}) = Var(E[\\bar{y}|\\mu]) + E[Var(\\bar{y}|\\mu)] = Var(\\mu) + E[\\sigma^{2}/n] = \\tau^{2} + \\sigma^{2}/n$。\n因此，在 $H_{1}$ 下 $\\bar{y}$ 的边际分布为：\n$$\n\\bar{y}|H_{1} \\sim \\mathcal{N}(0, \\tau^{2} + \\sigma^{2}/n)\n$$\n在 $H_{1}$ 下的边际似然是该分布的 PDF：\n$$\nm_{1}(\\bar{y}) = \\frac{1}{\\sqrt{2\\pi(\\tau^{2} + \\sigma^{2}/n)}} \\exp\\left(-\\frac{\\bar{y}^{2}}{2(\\tau^{2} + \\sigma^{2}/n)}\\right)\n$$\n\n**贝叶斯因子 $BF_{10}$ 的推导**\n支持 $H_{1}$ 相对于 $H_{0}$ 的贝叶斯因子是边际似然的比率：\n$$\nBF_{10} = \\frac{m_{1}(\\bar{y})}{m_{0}(\\bar{y})} = \\frac{\\frac{1}{\\sqrt{2\\pi(\\tau^{2} + \\sigma^{2}/n)}} \\exp\\left(-\\frac{\\bar{y}^{2}}{2(\\tau^{2} + \\sigma^{2}/n)}\\right)}{\\frac{1}{\\sqrt{2\\pi(\\sigma^{2}/n)}} \\exp\\left(-\\frac{n\\bar{y}^{2}}{2\\sigma^{2}}\\right)}\n$$\n简化归一化常数的比率：\n$$\n\\frac{\\sqrt{2\\pi(\\sigma^{2}/n)}}{\\sqrt{2\\pi(\\tau^{2} + \\sigma^{2}/n)}} = \\sqrt{\\frac{\\sigma^{2}/n}{\\tau^{2} + \\sigma^{2}/n}} = \\sqrt{\\frac{\\sigma^{2}}{n\\tau^{2} + \\sigma^{2}}}\n$$\n现在，代入固定的检验统计量值 $z_{n}=z_{0}$。根据定义 $z_{n} = \\sqrt{n}\\bar{y}/\\sigma$，我们有 $\\bar{y} = z_{0}\\sigma/\\sqrt{n}$。将此代入指数项中：\n分子的指数是：\n$$\n-\\frac{(z_{0}\\sigma/\\sqrt{n})^{2}}{2(\\tau^{2} + \\sigma^{2}/n)} = -\\frac{z_{0}^{2}\\sigma^{2}/n}{2(\\frac{n\\tau^{2}+\\sigma^{2}}{n})} = -\\frac{z_{0}^{2}\\sigma^{2}}{2(n\\tau^{2}+\\sigma^{2})}\n$$\n分母的指数是：\n$$\n-\\frac{n(z_{0}\\sigma/\\sqrt{n})^{2}}{2\\sigma^{2}} = -\\frac{n(z_{0}^{2}\\sigma^{2}/n)}{2\\sigma^{2}} = -\\frac{z_{0}^{2}}{2}\n$$\n最终 $BF_{10}$ 表达式的指数项是两者的差：\n$$\n-\\frac{z_{0}^{2}\\sigma^{2}}{2(n\\tau^{2}+\\sigma^{2})} - \\left(-\\frac{z_{0}^{2}}{2}\\right) = \\frac{z_{0}^{2}}{2} \\left(1 - \\frac{\\sigma^{2}}{n\\tau^{2}+\\sigma^{2}}\\right) = \\frac{z_{0}^{2}}{2} \\left(\\frac{n\\tau^{2}+\\sigma^{2}-\\sigma^{2}}{n\\tau^{2}+\\sigma^{2}}\\right) = \\frac{z_{0}^{2} n\\tau^{2}}{2(n\\tau^{2}+\\sigma^{2})}\n$$\n结合前置因子和指数项，得到 $BF_{10}$ 的精确表达式：\n$$\nBF_{10} = \\sqrt{\\frac{\\sigma^{2}}{n\\tau^{2} + \\sigma^{2}}} \\exp\\left(\\frac{z_{0}^{2} n\\tau^{2}}{2(n\\tau^{2}+\\sigma^{2})}\\right)\n$$\n\n**当 $n \\to \\infty$ 时贝叶斯因子的极限**\n我们现在取该表达式在 $n \\to \\infty$ 时的极限。让我们分别分析前置因子和指数项。\n前置因子的极限：\n$$\n\\lim_{n\\to\\infty} \\sqrt{\\frac{\\sigma^{2}}{n\\tau^{2} + \\sigma^{2}}} = \\lim_{n\\to\\infty} \\sqrt{\\frac{\\sigma^{2}/n}{\\tau^{2} + \\sigma^{2}/n}} = \\sqrt{\\frac{0}{\\tau^{2} + 0}} = 0\n$$\n因为 $\\tau^{2} > 0$。\n指数函数参数的极限：\n$$\n\\lim_{n\\to\\infty} \\frac{z_{0}^{2} n\\tau^{2}}{2(n\\tau^{2}+\\sigma^{2})} = \\lim_{n\\to\\infty} \\frac{z_{0}^{2} \\tau^{2}}{2(\\tau^{2}+\\sigma^{2}/n)} = \\frac{z_{0}^{2} \\tau^{2}}{2(\\tau^{2}+0)} = \\frac{z_{0}^{2}}{2}\n$$\n因此，指数项的极限是 $\\exp\\left(\\frac{z_{0}^{2}}{2}\\right)$，这是一个有限常数。\n贝叶斯因子的总极限是这些极限的乘积：\n$$\n\\lim_{n\\to\\infty} BF_{10} = \\left(\\lim_{n\\to\\infty} \\sqrt{\\frac{\\sigma^{2}}{n\\tau^{2} + \\sigma^{2}}}\\right) \\times \\left(\\lim_{n\\to\\infty} \\exp\\left(\\frac{z_{0}^{2} n\\tau^{2}}{2(n\\tau^{2}+\\sigma^{2})}\\right)\\right) = 0 \\times \\exp\\left(\\frac{z_{0}^{2}}{2}\\right) = 0\n$$\n\n**p 值的确定**\n双侧 $p$ 值定义为 $p=2\\left(1-\\Phi(|z_{n}|)\\right)$。问题陈述，对于所考虑的研究序列，检验统计量被固定在一个常数值 $z_{n}=z_{0}$。因此，$p$ 值对于所有 $n$ 也是恒定的：\n$$\np = 2\\left(1 - \\Phi(|z_{0}|)\\right)\n$$\n这个表达式不依赖于 $n$，因此当 $n \\to \\infty$ 时其值保持不变。\n\n最终结果是由贝叶斯因子的极限和相应的固定 $p$ 值组成的数对。\n这展示了 Jeffreys-Lindley 悖论：对于根据频率学派 $p$ 值（即固定的 $z_{0}$）确定的、针对 $H_{0}$ 的固定证据水平，随着样本量 $n$ 的增加，支持备择假设 $H_{1}$ 的贝叶斯证据趋近于零。换言之，贝叶斯因子压倒性地支持原假设 $H_{0}$。", "answer": "$$\n\\boxed{\\begin{bmatrix} 0  2(1 - \\Phi(|z_{0}|)) \\end{bmatrix}}\n$$", "id": "4896239"}, {"introduction": "从理论转向实际应用，本练习将展示如何使用贝叶斯因子来做出具体的建模决策。通过比较一个标准的正态误差模型和一个稳健的重尾学生$t$分布误差模型，我们可以量化证据，判断数据中是否存在或多大程度上存在离群值的影响。这个练习体现了贝叶斯因子在模型比较中的强大功能，其应用远不止于简单的参数假设检验。[@problem_id:4896241]", "problem": "给定一个由独立观测值组成的序列，该序列由一个仅含截距项的单参数回归模型建模。您将比较两种关于残差的误差模型，并计算贝叶斯因子，以评估使用重尾误差时模型对异常值的稳健性。\n\n基本定义与设置：\n- 对于观测值 $y_1,\\dots,y_n$，考虑回归模型 $y_i = \\beta + \\varepsilon_i$，其中 $\\beta$ 服从一个正则高斯先验 $\\beta \\sim \\mathcal{N}(0,\\tau^2)$，$\\tau^2$ 为已知固定值。\n- 模型 $\\mathcal{M}_0$（正态误差）：$\\varepsilon_i \\overset{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0,\\sigma^2)$，其中尺度参数 $\\sigma^2$ 已知。\n- 模型 $\\mathcal{M}_1$（学生t分布误差）：$\\varepsilon_i \\overset{\\text{i.i.d.}}{\\sim} t_\\nu(0,s)$，其中自由度 $\\nu$ 和尺度参数 $s$ 已知。\n- 模型 $\\mathcal{M}_1$ 相对于 $\\mathcal{M}_0$ 的贝叶斯因子定义为 $BF_{10} = \\dfrac{p(\\mathbf{y}\\mid \\mathcal{M}_1)}{p(\\mathbf{y}\\mid \\mathcal{M}_0)}$，其中在模型 $\\mathcal{M}$ 下对 $\\beta$ 进行积分得到的边际似然为\n$$\np(\\mathbf{y}\\mid \\mathcal{M}) = \\int_{-\\infty}^{\\infty} \\left[\\prod_{i=1}^n f(y_i\\mid \\beta, \\mathcal{M})\\right] \\, p(\\beta) \\, d\\beta,\n$$\n其中 $f(\\cdot\\mid \\beta,\\mathcal{M})$ 是由 $\\beta$ 平移的、特定于模型的误差密度，$p(\\beta)$ 是 $\\beta$ 的先验密度。\n\n您的任务：\n- 对于每个指定的测试用例，仅使用上述基本定义计算贝叶斯因子的自然对数 $\\log BF_{10}$。所有超参数均为已知固定值。\n- 在所有 $\\log BF_{10}$ 的计算中使用以 $e$ 为底的对数，并将最终结果四舍五入到小数点后六位。\n\n测试套件：\n对于以下每个用例，使用所提供的数据 $\\mathbf{y}$ 和超参数 $(\\sigma,s,\\nu,\\tau)$。\n- 用例 A（无异常值，中等尾部）：$\\mathbf{y} = [0.20,-0.11,0.38,-0.27,0.05,0.02,-0.18,0.31,-0.44,0.19]$, $\\sigma=1$, $s=1$, $\\nu=5$, $\\tau=10$.\n- 用例 B（一个大异常值）：$\\mathbf{y} = [0.20,-0.11,0.38,-0.27,0.05,0.02,-0.18,0.31,-0.44,0.19,8.00]$, $\\sigma=1$, $s=1$, $\\nu=5$, $\\tau=10$.\n- 用例 C（两个符号相反的极端异常值）：$\\mathbf{y} = [-0.20,0.10,0.30,-0.10,6.50,-7.00,0.20,0.00]$, $\\sigma=1$, $s=1$, $\\nu=3$, $\\tau=10$.\n- 用例 D（小样本，学生t分布接近正态分布）：$\\mathbf{y} = [0.50,-0.40,0.20]$, $\\sigma=1$, $s=1$, $\\nu=100$, $\\tau=10$.\n- 用例 E（重尾，极端异常值）：$\\mathbf{y} = [-0.10,0.00,0.10,10.00]$, $\\sigma=1$, $s=1$, $\\nu=1$, $\\tau=10$.\n\n要求与输出格式：\n- 您的程序必须为每个用例计算 $\\log BF_{10}$（作为一个实数），并将结果汇总到一行输出中，形式为用方括号括起来的逗号分隔列表。\n- 最终打印的行必须严格遵循 $[\\ell_A,\\ell_B,\\ell_C,\\ell_D,\\ell_E]$ 的格式，其中每个 $\\ell_{\\cdot}$ 是对应​​用例的 $\\log BF_{10}$ 值，四舍五入到小数点后六位。\n- 本问题不涉及物理单位。不使用角度。不使用百分比。所有输出必须是实数。", "solution": "目标是计算贝叶斯因子的自然对数 $\\log BF_{10}$，用于比较学生t分布误差模型（$\\mathcal{M}_1$）和正态误差模型（$\\mathcal{M}_0$）。贝叶斯因子是它们各自边际似然的比率，因此其对数是它们对数边际似然的差：\n$$ \\log BF_{10} = \\log p(\\mathbf{y} | \\mathcal{M}_1) - \\log p(\\mathbf{y} | \\mathcal{M}_0) $$\n我们将推导每个对数边际似然的表达式。\n\n**模型 $\\mathcal{M}_0$（正态误差）的对数边际似然**\n\n该模型定义为 $y_i = \\beta + \\varepsilon_i$，其中截距的先验为 $\\beta \\sim \\mathcal{N}(0, \\tau^2)$，误差为 $\\varepsilon_i \\overset{\\text{i.i.d.}}{\\sim} \\mathcal{N}(0, \\sigma^2)$。这是一个标准的分层高斯模型。通过对隐参数 $\\beta$ 进行积分，可以得到观测向量 $\\mathbf{y} = (y_1, \\dots, y_n)^T$ 的边际分布，该分布是一个多元正态分布，$\\mathbf{y} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_y, \\Sigma_y)$。\n\n边际均值向量为 $\\boldsymbol{\\mu}_y = \\mathbf{0}$，因为 $E[y_i] = E[\\beta] + E[\\varepsilon_i] = 0 + 0 = 0$。\n边际协方差矩阵 $\\Sigma_y$ 的元素为：\n- 方差：$Var(y_i) = Var(\\beta + \\varepsilon_i) = Var(\\beta) + Var(\\varepsilon_i) = \\tau^2 + \\sigma^2$（因为 $\\beta$ 和 $\\varepsilon_i$ 是独立的）。\n- 协方差（$i \\neq j$）：$Cov(y_i, y_j) = Cov(\\beta + \\varepsilon_i, \\beta + \\varepsilon_j) = Var(\\beta) = \\tau^2$（因为 $\\varepsilon_i$ 和 $\\varepsilon_j$ 是独立的）。\n\n因此，协方差矩阵为 $\\Sigma_y = \\sigma^2 I_n + \\tau^2 J_n$，其中 $I_n$ 是 $n \\times n$ 的单位矩阵，$J_n$ 是 $n \\times n$ 的全1矩阵。\n\n对数边际似然是在观测数据向量 $\\mathbf{y}$ 处评估的该多元正态分布的对数密度：\n$$ \\log p(\\mathbf{y} | \\mathcal{M}_0) = -\\frac{n}{2}\\log(2\\pi) - \\frac{1}{2}\\log|\\Sigma_y| - \\frac{1}{2}\\mathbf{y}^T \\Sigma_y^{-1} \\mathbf{y} $$\n对于 $\\Sigma_y$ 的特定结构，其行列式和逆矩阵有众所周知的形式：\n- 行列式：$|\\Sigma_y| = (\\sigma^2)^{n-1}(\\sigma^2 + n\\tau^2)$。\n- 逆矩阵（通过 Sherman-Morrison-Woodbury 公式）：$\\Sigma_y^{-1} = \\frac{1}{\\sigma^2}I_n - \\frac{\\tau^2}{\\sigma^2(\\sigma^2+n\\tau^2)}J_n$。\n\n将这些代入对数似然表达式中，二次型 $\\mathbf{y}^T \\Sigma_y^{-1} \\mathbf{y}$ 可简化为：\n$$ \\mathbf{y}^T \\Sigma_y^{-1} \\mathbf{y} = \\frac{1}{\\sigma^2}\\mathbf{y}^T I_n \\mathbf{y} - \\frac{\\tau^2}{\\sigma^2(\\sigma^2+n\\tau^2)}\\mathbf{y}^T J_n \\mathbf{y} = \\frac{1}{\\sigma^2}\\sum_{i=1}^n y_i^2 - \\frac{\\tau^2 (\\sum_{i=1}^n y_i)^2}{\\sigma^2(\\sigma^2+n\\tau^2)} $$\n这为 $\\log p(\\mathbf{y} | \\mathcal{M}_0)$ 提供了一个完整的解析公式，可以直接从数据 $\\mathbf{y}$ 和超参数 $\\sigma$、$\\tau$ 计算得出。\n\n**模型 $\\mathcal{M}_1$（学生t分布误差）的对数边际似然**\n\n对于此模型，误差为 $\\varepsilon_i \\overset{\\text{i.i.d.}}{\\sim} t_\\nu(0, s)$。在给定 $\\beta$ 的条件下，单个观测值 $y_i$ 的概率密度函数（PDF）由位置-尺度学生t分布的密度给出：\n$$ f(y_i|\\beta, \\mathcal{M}_1) = \\frac{\\Gamma\\left(\\frac{\\nu+1}{2}\\right)}{s\\sqrt{\\nu\\pi}\\Gamma\\left(\\frac{\\nu}{2}\\right)} \\left(1 + \\frac{(y_i-\\beta)^2}{\\nu s^2}\\right)^{-\\frac{\\nu+1}{2}} $$\n完整似然是乘积 $L_1(\\beta) = \\prod_{i=1}^n f(y_i|\\beta, \\mathcal{M}_1)$，而 $\\beta$ 的先验不变：$p(\\beta) = \\mathcal{N}(\\beta|0, \\tau^2)$。边际似然是它们的乘积对 $\\beta$ 的积分：\n$$ p(\\mathbf{y} | \\mathcal{M}_1) = \\int_{-\\infty}^{\\infty} \\left[\\prod_{i=1}^n f(y_i|\\beta, \\mathcal{M}_1)\\right] \\, p(\\beta) \\, d\\beta $$\n该积分没有通用的闭式解析解。必须使用数值方法进行计算。我们采用一维数值积分法来完成此任务。\n\n为保持数值稳定性，特别是当被积函数变得非常小时，我们处理其对数。令对数被积函数为 $g(\\beta) = \\log(L_1(\\beta)p(\\beta))$。\n$$ g(\\beta) = \\left( \\sum_{i=1}^n \\log f(y_i|\\beta, \\mathcal{M}_1) \\right) + \\log p(\\beta) $$\n边际似然为 $p(\\mathbf{y} | \\mathcal{M}_1) = \\int_{-\\infty}^{\\infty} \\exp(g(\\beta)) d\\beta$。一个稳健的数值评估过程如下：\n1. 找到使 $g(\\beta)$ 最大化的值 $\\hat{\\beta}$。令这个最大值为 $g_{max} = g(\\hat{\\beta})$。这可以通过数值最小化 $-g(\\beta)$ 来实现。\n2. 将积分重写为：\n$$ p(\\mathbf{y} | \\mathcal{M}_1) = \\exp(g_{max}) \\int_{-\\infty}^{\\infty} \\exp(g(\\beta) - g_{max}) d\\beta $$\n3. 相应的对数边际似然为：\n$$ \\log p(\\mathbf{y} | \\mathcal{M}_1) = g_{max} + \\log\\left( \\int_{-\\infty}^{\\infty} \\exp(g(\\beta) - g_{max}) \\, d\\beta \\right) $$\n被积函数 $\\exp(g(\\beta) - g_{max})$ 的性状良好，其最大值为1，这可以防止浮点数下溢。该积分使用标准求积算法计算。\n\n最终的对数贝叶斯因子通过从学生t分布模型的对数边际似然中减去正态模型的对数边际似然来计算。正值表示有证据支持重尾的学生t分布模型，表明对于给定数据集，对异常值的稳健性是有益的。", "answer": "```python\nimport numpy as np\nfrom scipy import stats\nfrom scipy.special import gammaln\nfrom scipy.integrate import quad\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Computes the log Bayes factor for comparing a Student's t error model\n    against a Normal error model for a series of test cases.\n    \"\"\"\n\n    def log_marginal_likelihood_normal(y: np.ndarray, sigma: float, tau: float) - float:\n        \"\"\"\n        Computes the log marginal likelihood for the Normal error model analytically.\n        y_i | beta ~ N(beta, sigma^2)\n        beta ~ N(0, tau^2)\n        \"\"\"\n        n = len(y)\n        sigma2 = sigma**2\n        tau2 = tau**2\n        \n        sum_y = np.sum(y)\n        sum_y_sq = np.sum(y**2)\n        \n        # Log-determinant of the marginal covariance matrix Sigma_y\n        log_det_Sigma_y = (n - 1) * np.log(sigma2) + np.log(sigma2 + n * tau2)\n        \n        # Quadratic form y^T * Sigma_y^-1 * y\n        quad_form = (1 / sigma2) * sum_y_sq - (tau2 * sum_y**2) / (sigma2 * (sigma2 + n * tau2))\n        \n        # Log marginal likelihood, which is the log-pdf of y ~ MVN(0, Sigma_y)\n        log_p_y = -0.5 * n * np.log(2 * np.pi) - 0.5 * log_det_Sigma_y - 0.5 * quad_form\n        \n        return log_p_y\n\n    def log_marginal_likelihood_student_t(y: np.ndarray, s: float, nu: float, tau: float) - float:\n        \"\"\"\n        Computes the log marginal likelihood for the Student's t error model\n        using robust numerical integration.\n        y_i | beta ~ t_nu(loc=beta, scale=s)\n        beta ~ N(0, tau^2)\n        \"\"\"\n        n = len(y)\n        s2 = s**2\n        tau2 = tau**2\n\n        # Constant part of the log student-t pdf\n        log_t_const = gammaln((nu + 1) / 2) - gammaln(nu / 2) - 0.5 * np.log(nu * np.pi) - np.log(s)\n\n        def log_integrand(beta: float) - float:\n            # Log-likelihood term (sum over observations)\n            log_lik_t = n * log_t_const - ((nu + 1) / 2) * np.sum(np.log(1 + (y - beta)**2 / (nu * s2)))\n            \n            # Log-prior term for beta\n            log_prior_beta = -0.5 * np.log(2 * np.pi * tau2) - beta**2 / (2 * tau2)\n            \n            return log_lik_t + log_prior_beta\n\n        # To find the maximum of the log-integrand for numerical stability,\n        # we minimize its negative.\n        # Use a reasonable bound for optimization based on data range and prior width.\n        y_mean = np.mean(y) if n  0 else 0\n        y_std = np.std(y) if n  1 else 1\n        opt_bounds = [y_mean - 5 * y_std - 3 * tau, y_mean + 5 * y_std + 3 * tau]\n        \n        # Find mode of the posterior (maximum of log_integrand)\n        res = minimize_scalar(lambda b: -log_integrand(b), bounds=opt_bounds, method='bounded')\n        g_max = -res.fun\n        \n        # Define the scaled integrand for robust numerical integration\n        def scaled_integrand(beta: float) - float:\n            return np.exp(log_integrand(beta) - g_max)\n\n        # Perform numerical integration\n        integral_val, _ = quad(scaled_integrand, -np.inf, np.inf)\n        \n        # Combine terms for the final log marginal likelihood\n        log_p_y = g_max + np.log(integral_val)\n        \n        return log_p_y\n\n    test_cases = [\n        {'id': 'A', 'y': np.array([0.20,-0.11,0.38,-0.27,0.05,0.02,-0.18,0.31,-0.44,0.19]), 'sigma': 1, 's': 1, 'nu': 5, 'tau': 10},\n        {'id': 'B', 'y': np.array([0.20,-0.11,0.38,-0.27,0.05,0.02,-0.18,0.31,-0.44,0.19,8.00]), 'sigma': 1, 's': 1, 'nu': 5, 'tau': 10},\n        {'id': 'C', 'y': np.array([-0.20,0.10,0.30,-0.10,6.50,-7.00,0.20,0.00]), 'sigma': 1, 's': 1, 'nu': 3, 'tau': 10},\n        {'id': 'D', 'y': np.array([0.50,-0.40,0.20]), 'sigma': 1, 's': 1, 'nu': 100, 'tau': 10},\n        {'id': 'E', 'y': np.array([-0.10,0.00,0.10,10.00]), 'sigma': 1, 's': 1, 'nu': 1, 'tau': 10},\n    ]\n\n    results = []\n    for case in test_cases:\n        y_data = case['y']\n        sigma_val = case['sigma']\n        s_val = case['s']\n        nu_val = case['nu']\n        tau_val = case['tau']\n\n        log_ml0 = log_marginal_likelihood_normal(y=y_data, sigma=sigma_val, tau=tau_val)\n        log_ml1 = log_marginal_likelihood_student_t(y=y_data, s=s_val, nu=nu_val, tau=tau_val)\n        \n        log_bf10 = log_ml1 - log_ml0\n        results.append(f\"{log_bf10:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4896241"}]}