{"hands_on_practices": [{"introduction": "我们将从贝叶斯推断中最基础的情景开始：推断正态分布的均值。这个练习使用正态似然和正态先验的组合，这是一个经典的“共轭”模型，它允许我们精确地推导出后验分布，从而清晰地展示先验知识如何与数据在数学上结合。通过从第一性原理出发完成这个推导和计算（[@problem_id:4896865]），你将掌握贝叶斯更新机制的核心，为更复杂的模型打下坚实的基础。", "problem": "一项临床试验研究一种新的生活方式干预对平均收缩压变化的影响。设 $\\{Y_{i}\\}_{i=1}^{n}$ 表示观测到的变化（单位为 $\\mathrm{mmHg}$），建模为来自未知均值 $\\mu$ 和已知方差 $\\sigma^{2}$ 的高斯（正态）分布的独立同分布样本。$\\mu$ 的先验分布是均值为 $\\mu_{0}$、方差为 $\\tau_{0}^{2}$ 的高斯分布。你观测到 $n$ 个独立测量值，其样本均值为 $\\bar{Y}$。\n\n仅使用似然、先验和贝叶斯定理的定义，从第一性原理出发，推导在已知方差 $\\sigma^{2}$ 的高斯似然和高斯先验下，$\\mu$ 的后验分布。然后，使用得到的后验分布，计算 $\\mu$ 的 $95\\%$ 等尾可信区间。\n\n使用以下数值，适用时单位均为 $\\mathrm{mmHg}$：$n = 15$，$\\sigma^{2} = 36$，$\\mu_{0} = 5$，$\\tau_{0}^{2} = 100$，以及 $\\bar{Y} = 3.2$。最终的可信区间端点以 $\\mathrm{mmHg}$ 为单位表示。将你的数值答案四舍五入到四位有效数字。\n\n在你的最终数值答案中，将可信区间的下限和上限报告为单行矩阵。", "solution": "该问题要求在给定高斯先验的情况下，为高斯似然的均值参数 $\\mu$ 推导后验分布，然后计算 $\\mu$ 的 $95\\%$ 可信区间。\n\n### 问题验证\n**第一步：提取已知条件**\n-   数据模型：$Y_i \\sim N(\\mu, \\sigma^2)$，$i=1, ..., n$，其中 $Y_i$ 是独立同分布的。\n-   似然：未知均值 $\\mu$ 和已知方差 $\\sigma^2$ 的高斯分布。\n-   先验：$\\mu$ 的先验分布是高斯分布，$\\mu \\sim N(\\mu_0, \\tau_0^2)$。\n-   观测值：大小为 $n$ 的样本，其样本均值为 $\\bar{Y}$。\n-   数值：\n    -   样本大小，$n = 15$。\n    -   已知数据方差，$\\sigma^2 = 36$。\n    -   先验均值，$\\mu_0 = 5$。\n    -   先验方差，$\\tau_0^2 = 100$。\n    -   样本均值，$\\bar{Y} = 3.2$。\n-   任务：\n    1.  从第一性原理推导 $\\mu$ 的后验分布。\n    2.  计算 $\\mu$ 的 $95\\%$ 等尾可信区间。\n    3.  将数值区间端点四舍五入到四位有效数字。\n\n**第二步：使用提取的已知条件进行验证**\n-   **科学依据**：该问题使用标准的共轭先验模型（高斯-高斯），这是贝叶斯统计学（特别是在生物统计学中）中一个基础且广泛使用的技术。该模型在科学上和数学上都是合理的。\n-   **适定性**：该问题是适定的。给定指定的共轭先验和似然，后验分布存在唯一的解析解。由此后验分布，可以确定唯一的可信区间。\n-   **客观性**：问题以精确、客观和数学化的语言陈述，没有歧义或主观论断。\n-   **完整性和一致性**：推导后验和计算可信区间所需的所有必要参数（$n$, $\\bar{Y}$, $\\sigma^2$, $\\mu_0$, $\\tau_0^2$）均已提供。设置中没有矛盾之处。\n-   **现实性**：关于血压的临床试验背景和给定的数值都是合理的。\n\n**第三步：结论与行动**\n该问题有效。现在开始解题过程。\n\n### 后验分布的推导\n\n推导从贝叶斯定理开始，该定理指出后验分布与似然和先验分布的乘积成正比。\n$$\np(\\mu | \\mathbf{Y}) \\propto p(\\mathbf{Y} | \\mu) p(\\mu)\n$$\n这里，$\\mathbf{Y} = \\{Y_1, \\dots, Y_n\\}$ 表示观测数据。\n\n**1. 似然函数**\n观测值 $Y_i$ 是来自 $N(\\mu, \\sigma^2)$ 分布的独立同分布样本。其联合概率密度函数（即似然函数）为：\n$$\np(\\mathbf{Y} | \\mu) = \\prod_{i=1}^{n} \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{(Y_i - \\mu)^2}{2\\sigma^2}\\right)\n$$\n对于已知方差 $\\sigma^2$ 的高斯分布，样本均值 $\\bar{Y} = \\frac{1}{n}\\sum_{i=1}^n Y_i$ 是 $\\mu$ 的一个充分统计量。样本均值的分布为 $\\bar{Y} \\sim N(\\mu, \\sigma^2/n)$。因此，我们可以使用 $\\bar{Y}$ 的似然来代替完整数据 $\\mathbf{Y}$ 的似然，这简化了计算，且不会损失关于 $\\mu$ 的信息。\n给定 $\\bar{Y}$ 时，$\\mu$ 的似然函数为：\n$$\nL(\\mu | \\bar{Y}) = p(\\bar{Y} | \\mu) = \\frac{1}{\\sqrt{2\\pi(\\sigma^2/n)}} \\exp\\left(-\\frac{(\\bar{Y} - \\mu)^2}{2(\\sigma^2/n)}\\right)\n$$\n作为 $\\mu$ 的函数，它正比于：\n$$\nL(\\mu | \\bar{Y}) \\propto \\exp\\left(-\\frac{n(\\mu - \\bar{Y})^2}{2\\sigma^2}\\right)\n$$\n\n**2. 先验分布**\n问题陈述了 $\\mu$ 的一个高斯先验：$\\mu \\sim N(\\mu_0, \\tau_0^2)$。其概率密度函数为：\n$$\np(\\mu) = \\frac{1}{\\sqrt{2\\pi\\tau_0^2}} \\exp\\left(-\\frac{(\\mu - \\mu_0)^2}{2\\tau_0^2}\\right)\n$$\n成比例地，\n$$\np(\\mu) \\propto \\exp\\left(-\\frac{(\\mu - \\mu_0)^2}{2\\tau_0^2}\\right)\n$$\n\n**3. 后验分布**\n使用贝叶斯定理，后验分布 $p(\\mu | \\bar{Y})$ 正比于似然与先验的乘积：\n$$\np(\\mu | \\bar{Y}) \\propto \\exp\\left(-\\frac{n(\\mu - \\bar{Y})^2}{2\\sigma^2}\\right) \\exp\\left(-\\frac{(\\mu - \\mu_0)^2}{2\\tau_0^2}\\right)\n$$\n$$\np(\\mu | \\bar{Y}) \\propto \\exp\\left[-\\frac{1}{2}\\left(\\frac{n(\\mu - \\bar{Y})^2}{\\sigma^2} + \\frac{(\\mu - \\mu_0)^2}{\\tau_0^2}\\right)\\right]\n$$\n为了确定该分布的形式，我们展开指数中的项，并对 $\\mu$ 进行配方。忽略因子 $-1/2$，指数部分为：\n$$\n\\frac{n}{\\sigma^2}(\\mu^2 - 2\\mu\\bar{Y} + \\bar{Y}^2) + \\frac{1}{\\tau_0^2}(\\mu^2 - 2\\mu\\mu_0 + \\mu_0^2)\n$$\n根据 $\\mu$ 的幂次收集项：\n$$\n\\mu^2\\left(\\frac{n}{\\sigma^2} + \\frac{1}{\\tau_0^2}\\right) - 2\\mu\\left(\\frac{n\\bar{Y}}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2}\\right) + \\left(\\frac{n\\bar{Y}^2}{\\sigma^2} + \\frac{\\mu_0^2}{\\tau_0^2}\\right)\n$$\n不含 $\\mu$ 的项可以被吸收到比例常数中。后验分布是一个高斯分布，$p(\\mu | \\bar{Y}) \\sim N(\\mu_1, \\tau_1^2)$，其密度正比于 $\\exp\\left(-\\frac{(\\mu-\\mu_1)^2}{2\\tau_1^2}\\right)$。这种形式的指数部分是：\n$$\n-\\frac{1}{2\\tau_1^2}(\\mu^2 - 2\\mu\\mu_1 + \\mu_1^2) = -\\frac{1}{2}\\left[\\frac{1}{\\tau_1^2}\\mu^2 - \\frac{2\\mu_1}{\\tau_1^2}\\mu + \\frac{\\mu_1^2}{\\tau_1^2}\\right]\n$$\n通过比较 $\\mu^2$ 和 $\\mu$ 项的系数，我们可以找到后验参数 $\\mu_1$ 和 $\\tau_1^2$。\n比较 $\\mu^2$ 的系数：\n$$\n\\frac{1}{\\tau_1^2} = \\frac{n}{\\sigma^2} + \\frac{1}{\\tau_0^2}\n$$\n这表明后验精度（$1/\\tau_1^2$）是数据精度（$n/\\sigma^2$）和先验精度（$1/\\tau_0^2$）之和。\n比较 $\\mu$ 的系数：\n$$\n\\frac{\\mu_1}{\\tau_1^2} = \\frac{n\\bar{Y}}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2}\n$$\n求解后验均值 $\\mu_1$：\n$$\n\\mu_1 = \\tau_1^2 \\left(\\frac{n\\bar{Y}}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2}\\right) = \\frac{\\frac{n\\bar{Y}}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2}}{\\frac{n}{\\sigma^2} + \\frac{1}{\\tau_0^2}}\n$$\n因此，$\\mu$ 的后验分布是一个高斯分布，$p(\\mu|\\mathbf{Y}) \\sim N(\\mu_1, \\tau_1^2)$，其参数如上推导。\n\n### 后验参数的计算\n现在，我们代入给定的数值：$n = 15$，$\\sigma^2 = 36$，$\\mu_0 = 5$，$\\tau_0^2 = 100$，以及 $\\bar{Y} = 3.2$。\n\n首先，我们计算后验精度和方差：\n$$\n\\frac{1}{\\tau_1^2} = \\frac{15}{36} + \\frac{1}{100} = \\frac{5}{12} + \\frac{1}{100} = \\frac{125}{300} + \\frac{3}{300} = \\frac{128}{300} = \\frac{32}{75}\n$$\n后验方差为：\n$$\n\\tau_1^2 = \\frac{75}{32} = 2.34375\n$$\n接下来，我们计算后验均值：\n$$\n\\mu_1 = \\tau_1^2 \\left( \\frac{n\\bar{Y}}{\\sigma^2} + \\frac{\\mu_0}{\\tau_0^2} \\right) = \\frac{75}{32} \\left( \\frac{15 \\times 3.2}{36} + \\frac{5}{100} \\right)\n$$\n$$\n\\mu_1 = \\frac{75}{32} \\left( \\frac{48}{36} + \\frac{1}{20} \\right) = \\frac{75}{32} \\left( \\frac{4}{3} + \\frac{1}{20} \\right)\n$$\n$$\n\\mu_1 = \\frac{75}{32} \\left( \\frac{80 + 3}{60} \\right) = \\frac{75}{32} \\left( \\frac{83}{60} \\right) = \\frac{5 \\times 15}{32} \\frac{83}{4 \\times 15} = \\frac{5 \\times 83}{128} = \\frac{415}{128}\n$$\n$$\n\\mu_1 = 3.2421875\n$$\n所以，后验分布是 $\\mu|\\mathbf{Y} \\sim N(3.2421875, 2.34375)$。\n\n### 95% 可信区间的计算\n对于一个服从正态分布的参数 $\\mu \\sim N(\\mu_1, \\tau_1^2)$，其 $95\\%$ 等尾可信区间由 $[\\mu_1 - z_{0.975} \\tau_1, \\mu_1 + z_{0.975} \\tau_1]$ 给出，其中 $\\tau_1 = \\sqrt{\\tau_1^2}$ 是后验标准差，$z_{0.975}$ 是标准正态分布的第 $97.5$ 百分位数。\n\n$z_{0.975}$ 的值约为 $1.959964$。\n后验标准差为：\n$$\n\\tau_1 = \\sqrt{\\tau_1^2} = \\sqrt{\\frac{75}{32}} \\approx 1.5309311\n$$\n区间的误差范围是：\n$$\nw = z_{0.975} \\tau_1 \\approx 1.959964 \\times 1.5309311 \\approx 3.000570\n$$\n可信区间的下限是：\n$$\nL = \\mu_1 - w \\approx 3.2421875 - 3.000570 = 0.2416175\n$$\n可信区间的上限是：\n$$\nU = \\mu_1 + w \\approx 3.2421875 + 3.000570 = 6.2427575\n$$\n按要求将这些值四舍五入到四位有效数字：\n下限：$0.2416$\n上限：$6.243$\n\n收缩压平均变化量 $\\mu$ 的 $95\\%$ 可信区间约为 $[0.2416, 6.243]$ $\\mathrm{mmHg}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.2416  6.243\n\\end{pmatrix}\n}\n$$", "id": "4896865"}, {"introduction": "从连续测量转向二元结果（例如，成功/失败，患病/未患病）是生物统计学中的常见情况。本练习使用二项分布似然和贝塔先验，这是另一个经典的共轭模型组合。此练习的重点不仅在于计算，更在于探索选择不同先验（特别是当样本量较小时）的实际影响，并通过编程将贝叶斯可信区间与频率学派的置信区间进行比较（[@problem_id:4896696]），从而加深对两种统计思想差异的理解。", "problem": "一项研究关注一种罕见疾病，该疾病在小队列中具有二元结果。设 $X$ 表示在 $n$ 个独立个体中观测到的病例数，其中 $X \\sim \\mathrm{Binomial}(n, \\theta)$，$\\theta \\in (0,1)$ 是未知的疾病概率。从二项似然 $\\mathcal{L}(\\theta \\mid x,n) \\propto \\theta^{x} (1-\\theta)^{n-x}$ 的基本形式和Beta先验共轭性出发，使用以下定义构建区间估计并编写程序进行比较：\n\n1. 使用Beta先验的贝叶斯方法：Beta先验 $\\mathrm{Beta}(a,b)$ 与二项似然是共轭的，产生的后验分布为 $\\theta \\mid x,n \\sim \\mathrm{Beta}(a + x, b + n - x)$。水平为 $1-\\alpha$ 的等尾贝叶斯可信区间由后验分位数 $q_{\\alpha/2}$ 和 $q_{1-\\alpha/2}$ 定义，满足 $\\mathbb{P}(\\theta \\le q_{\\alpha/2} \\mid x,n) = \\alpha/2$ 和 $\\mathbb{P}(\\theta \\le q_{1-\\alpha/2} \\mid x,n) = 1-\\alpha/2$。\n\n2. 通过反演得到的精确频率学派方法：水平为 $1-\\alpha$ 的精确Clopper–Pearson (CP)区间是通过反演二项检验得到的，定义为在水平 $\\alpha$ 下的双边精确检验中不会被拒绝的所有 $\\theta$ 值的集合。这种反演可以用Beta累积分布函数来表示以计算区间端点，并且需要在边界 $x=0$ 和 $x=n$ 处进行仔细处理。\n\n实现一个程序，对下面测试套件中的每个测试用例 $(n,x)$，计算：\n- $\\theta$ 的 $1-\\alpha$ 精确Clopper–Pearson区间。\n- 在三种先验下，$\\theta$ 的 $1-\\alpha$ 等尾贝叶斯可信区间：\n  - 先验 J (Jeffreys)：$\\mathrm{Beta}(a,b)$，其中 $(a,b)=(0.5,0.5)$。\n  - 先验 U (Uniform)：$\\mathrm{Beta}(a,b)$，其中 $(a,b)=(1,1)$。\n  - 先验 R (倾向于罕见事件的弱信息)：$\\mathrm{Beta}(a,b)$，其中 $(a,b)=(0.5,9.5)$。\n\n使用 $\\alpha = 0.05$（因此名义水平为 $1-\\alpha = 0.95$）。对于每个测试用例，输出一个列表，其中包含整数 $n$ 和 $x$，后跟四个区间的下端点和上端点，顺序固定为：CP、J、U、R。每个区间端点必须四舍五入到 $6$ 位小数，并以小数形式表示（无百分号）。程序的最终输出必须是单行，包含这些按测试用例排列的列表的列表，用逗号分隔并用方括号括起来。\n\n测试套件：\n- 用例 A (正常路径，观测到罕见事件)：$(n,x) = (20,1)$。\n- 用例 B (边界，没有事件发生)：$(n,x) = (5,0)$。\n- 用例 C (边界，所有事件都发生)：$(n,x) = (10,10)$。\n- 用例 D (小样本，有几个事件发生)：$(n,x) = (8,2)$。\n- 用例 E (罕见且 $n$ 较大，没有事件发生)：$(n,x) = (50,0)$。\n- 用例 F (边界，中等 $n$ 且没有事件发生)：$(n,x) = (20,0)$。\n\n您的程序应生成单行输出，其中包含结果，格式为用方括号括起来的逗号分隔列表，其中每个元素本身就是一个列表，顺序如下：\n$[n, x, \\mathrm{CP\\_lower}, \\mathrm{CP\\_upper}, \\mathrm{J\\_lower}, \\mathrm{J\\_upper}, \\mathrm{U\\_lower}, \\mathrm{U\\_upper}, \\mathrm{R\\_lower}, \\mathrm{R\\_upper}]$。\n\n所有数值答案必须是四舍五入到 $6$ 位小数的小数形式。不涉及物理单位。不涉及角度。不得使用百分比；概率必须是 $(0,1)$ 范围内的小数。", "solution": "该问题要求基于在 $n$ 次试验中观测到 $x$ 次成功，计算二项比例 $\\theta$ 的频率学派和贝叶斯区间估计。我们已知二项似然的函数形式 $\\mathcal{L}(\\theta \\mid x,n) \\propto \\theta^{x} (1-\\theta)^{n-x}$，以及从Beta后验分布推导出的精确Clopper-Pearson置信区间和等尾贝叶斯可信区间的定义。名义置信/可信水平指定为 $1-\\alpha = 0.95$，对应于 $\\alpha = 0.05$。\n\n分析过程是为所要求的四个区间中的每一个推导计算公式：Clopper-Pearson (CP) 区间，以及分别对应于Jeffreys (J)、均匀 (U) 和倾向于罕见事件 (R) 先验的三个贝叶斯可信区间。\n\n### 贝叶斯可信区间\n\n贝叶斯框架将参数 $\\theta$ 的先验分布与观测数据的似然相结合，形成后验分布，该后验分布代表了我们对 $\\theta$ 的更新信念。问题指定使用Beta先验，$\\theta \\sim \\mathrm{Beta}(a,b)$。Beta分布是二项似然的共轭先验，这意味着后验分布也是Beta分布。\n\n给定先验 $\\theta \\sim \\mathrm{Beta}(a,b)$ 和数据 $X=x$，$\\theta$ 的后验分布为：\n$$ \\theta \\mid x, n \\sim \\mathrm{Beta}(a' = a + x, b' = b + n - x) $$\n\n一个 $(1-\\alpha)$ 等尾可信区间由该后验分布的 $\\alpha/2$ 和 $1-\\alpha/2$ 分位数定义。设 $F^{-1}_{\\mathrm{Beta}(a',b')}$ 表示 $\\mathrm{Beta}(a', b')$ 分布的百分点函数 (PPF)，或累积分布函数 (CDF) 的逆函数。区间端点 $[\\theta_L, \\theta_U]$ 为：\n$$ \\theta_L = F^{-1}_{\\mathrm{Beta}(a',b')}(\\alpha/2) $$\n$$ \\theta_U = F^{-1}_{\\mathrm{Beta}(a',b')}(1-\\alpha/2) $$\n\n我们将此通用公式应用于指定的三个先验，其中 $\\alpha = 0.05$。\n\n1.  **先验 J (Jeffreys)**：$\\mathrm{Beta}(0.5, 0.5)$。这是一种常见的无信息先验。\n    - 后验分布：$\\theta \\mid x,n \\sim \\mathrm{Beta}(x + 0.5, n - x + 0.5)$。\n    - 区间端点是此分布的 $0.025$ 和 $0.975$ 分位数。\n\n2.  **先验 U (Uniform)**：$\\mathrm{Beta}(1, 1)$。这对应于 $\\theta$ 在 $(0,1)$ 上的均匀先验，表示对 $\\theta$ 的任何特定值最初没有偏好。\n    - 后验分布：$\\theta \\mid x,n \\sim \\mathrm{Beta}(x + 1, n - x + 1)$。\n    - 区间端点是此分布的 $0.025$ 和 $0.975$ 分位数。\n\n3.  **先验 R (倾向于罕见事件)**：$\\mathrm{Beta}(0.5, 9.5)$。这是一种弱信息先验，它将更多的先验概率赋予较小的 $\\theta$ 值，适用于认为事件是罕见的情况。先验均值为 $0.5 / (0.5+9.5) = 0.05$。\n    - 后验分布：$\\theta \\mid x,n \\sim \\mathrm{Beta}(x + 0.5, n - x + 9.5)$。\n    - 区间端点是此分布的 $0.025$ 和 $0.975$ 分位数。\n\n### 频率学派Clopper-Pearson (CP)区间\n\nClopper-Pearson区间是一个“精确”置信区间，通过反演关于二项比例 $\\theta$ 的双边检验来构建。区间 $[\\theta_L, \\theta_U]$ 包含所有使得原假设 $H_0: \\theta = \\theta_0$ 在显著性水平 $\\alpha$ 下不被拒绝的 $\\theta_0$ 值。\n\n下界 $\\theta_L$ 由以下方程定义：\n$$ \\mathbb{P}(X \\ge x \\mid \\theta = \\theta_L) = \\sum_{k=x}^{n} \\binom{n}{k} \\theta_L^k (1-\\theta_L)^{n-k} = \\alpha/2 $$\n\n上界 $\\theta_U$ 由以下方程定义：\n$$ \\mathbb{P}(X \\le x \\mid \\theta = \\theta_U) = \\sum_{k=0}^{x} \\binom{n}{k} \\theta_U^k (1-\\theta_U)^{n-k} = \\alpha/2 $$\n\n这些方程可以通过一个著名的恒等式求解 $\\theta_L$ 和 $\\theta_U$，该恒等式将二项分布的尾部概率与Beta分布的CDF联系起来。\n下界 $\\theta_L$ 是满足第一个方程的值，它等价于 $\\mathrm{Beta}(x, n - x + 1)$ 分布的 $\\alpha/2$ 分位数。\n上界 $\\theta_U$ 是满足第二个方程的值，它等价于 $\\mathrm{Beta}(x + 1, n - x)$ 分布的 $1-\\alpha/2$ 分位数。\n\n因此，端点计算如下：\n$$ \\theta_L = F^{-1}_{\\mathrm{Beta}(x, n-x+1)}(\\alpha/2) $$\n$$ \\theta_U = F^{-1}_{\\mathrm{Beta}(x+1, n-x)}(1-\\alpha/2) $$\n\n边界情况需要特别注意：\n-   如果 $x=0$，下界方程变为 $\\mathbb{P}(X \\ge 0 \\mid \\theta_L) = 1 = \\alpha/2$，对于 $\\theta_L \\in (0,1)$ 没有解。按照惯例，并为了保持覆盖率，下界设为 $\\theta_L = 0$。上界的公式仍然有效：$\\theta_U = F^{-1}_{\\mathrm{Beta}(1, n)}(1-\\alpha/2)$。\n-   如果 $x=n$，上界方程变为 $\\mathbb{P}(X \\le n \\mid \\theta_U) = 1 = \\alpha/2$，同样没有解。上界设为 $\\theta_U = 1$。下界的公式仍然有效：$\\theta_L = F^{-1}_{\\mathrm{Beta}(n, 1)}(\\alpha/2)$。\n\n这些公式为实现提供了基础。Beta分布分位数的所需计算是使用数值库完成的。对于每个测试用例 $(n,x)$，我们计算四个区间的下界和上界，并按指定格式进行格式化。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import beta\n\ndef solve():\n    \"\"\"\n    Computes Clopper-Pearson and Bayesian credible intervals for a binomial proportion\n    for a given set of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        (20, 1),   # Case A\n        (5, 0),    # Case B\n        (10, 10),  # Case C\n        (8, 2),    # Case D\n        (50, 0),   # Case E\n        (20, 0)    # Case F\n    ]\n\n    alpha = 0.05\n    results = []\n\n    for n, x in test_cases:\n        # --- 1. Clopper-Pearson (CP) Interval ---\n        # Special handling for boundary cases as scipy.stats.beta.ppf requires\n        # shape parameters a, b > 0.\n        if x == 0:\n            cp_lower = 0.0\n        else:\n            cp_lower = beta.ppf(alpha / 2, x, n - x + 1)\n        \n        if x == n:\n            cp_upper = 1.0\n        else:\n            cp_upper = beta.ppf(1 - alpha / 2, x + 1, n - x)\n\n        # --- 2. Bayesian Credible Intervals ---\n        \n        # Prior J (Jeffreys): Beta(0.5, 0.5)\n        a_j, b_j = 0.5, 0.5\n        post_a_j = a_j + x\n        post_b_j = b_j + n - x\n        j_lower = beta.ppf(alpha / 2, post_a_j, post_b_j)\n        j_upper = beta.ppf(1 - alpha / 2, post_a_j, post_b_j)\n\n        # Prior U (Uniform): Beta(1, 1)\n        a_u, b_u = 1.0, 1.0\n        post_a_u = a_u + x\n        post_b_u = b_u + n - x\n        u_lower = beta.ppf(alpha / 2, post_a_u, post_b_u)\n        u_upper = beta.ppf(1 - alpha / 2, post_a_u, post_b_u)\n\n        # Prior R (Rare-leaning): Beta(0.5, 9.5)\n        a_r, b_r = 0.5, 9.5\n        post_a_r = a_r + x\n        post_b_r = b_r + n - x\n        r_lower = beta.ppf(alpha / 2, post_a_r, post_b_r)\n        r_upper = beta.ppf(1 - alpha / 2, post_a_r, post_b_r)\n\n        # Assemble the list for the current test case, with rounding\n        case_result = [\n            n, x,\n            round(cp_lower, 6), round(cp_upper, 6),\n            round(j_lower, 6), round(j_upper, 6),\n            round(u_lower, 6), round(u_upper, 6),\n            round(r_lower, 6), round(r_upper, 6)\n        ]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # The format required is a list of lists, printed as a string.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "4896696"}, {"introduction": "现实世界中的生物统计学问题常常涉及同时估计多个未知参数。最后一个练习将我们带入多维领域，通过一个双变量正态模型来探索联合推断。这个练习的核心目标是理解如何同时表达多个参数的不确定性（即联合可信区域），以及这与单独考察每个参数（即边际可信区间）有何根本不同（[@problem_id:4896890]）。掌握这种区别对于在多变量分析中做出正确解释至关重要，并能帮助你避免常见的统计误解。", "problem": "一位生物统计学家使用贝叶斯共轭分析对两个连续生物标志物的联合均值（表示为参数向量 $\\boldsymbol{\\theta} = (\\theta_{1}, \\theta_{2})^{\\top}$）进行建模，该分析采用多元正态先验和多元正态似然。具体来说，先验为 $\\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{0}, \\boldsymbol{\\Lambda}_{0})$，其中 $\\boldsymbol{\\mu}_{0} = (0, 0)^{\\top}$ 且\n$$\n\\boldsymbol{\\Lambda}_{0} = \\begin{pmatrix}\n2  0.4 \\\\\n0.4  2\n\\end{pmatrix},\n$$\n数据为 $n = 20$ 个独立观测值 $\\boldsymbol{y}_{i} \\in \\mathbb{R}^{2}$，其抽样模型为 $\\boldsymbol{y}_{i} \\mid \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\theta}, \\boldsymbol{\\Sigma})$，其中\n$$\n\\boldsymbol{\\Sigma} = \\begin{pmatrix}\n1.0  0.6 \\\\\n0.6  1.5\n\\end{pmatrix}.\n$$\n观测到的样本均值为\n$$\n\\bar{\\boldsymbol{y}} = \\begin{pmatrix} 1.2 \\\\ -0.7 \\end{pmatrix}.\n$$\n使用第一性原理的贝叶斯推断，推导后验分布 $\\boldsymbol{\\theta} \\mid \\text{data}$ 并用它来：\n- 构建椭圆形式的 $0.95$ 联合可信区域\n$$\n\\left\\{ \\boldsymbol{\\theta} : (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n})^{\\top} \\boldsymbol{\\Lambda}_{n}^{-1} (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n}) \\leq c \\right\\},\n$$\n其中 $\\boldsymbol{\\mu}_{n}$ 和 $\\boldsymbol{\\Lambda}_{n}$ 分别表示后验均值和后验协方差矩阵。确定唯一的 $c$ 值，使得该区域的后验概率为 $0.95$。\n- 计算 $\\theta_{1}$ 和 $\\theta_{2}$ 的 $0.95$ 边际可信区间，并利用多元正态分布的几何和概率定律解释，为什么由这些边际区间形成的轴对齐矩形的联合后验概率严格小于 $0.95$（除非后验相关性为 $\\pm 1$），以及这如何依赖于后验相关性。\n\n只提供 $c$ 的单个数值。将您的答案四舍五入到四位有效数字。", "solution": "用户希望我解决一个贝叶斯推断问题。\n\n### 第一步：提取已知条件\n-   **模型参数**：$\\boldsymbol{\\theta} = (\\theta_{1}, \\theta_{2})^{\\top}$\n-   **先验分布**：$\\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{0}, \\boldsymbol{\\Lambda}_{0})$\n-   **先验均值**：$\\boldsymbol{\\mu}_{0} = (0, 0)^{\\top}$\n-   **先验协方差**：$\\boldsymbol{\\Lambda}_{0} = \\begin{pmatrix} 2  0.4 \\\\ 0.4  2 \\end{pmatrix}$\n-   **样本大小**：$n = 20$ 个独立观测值 $\\boldsymbol{y}_{i} \\in \\mathbb{R}^{2}$\n-   **抽样模型（似然）**：$\\boldsymbol{y}_{i} \\mid \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\theta}, \\boldsymbol{\\Sigma})$\n-   **已知协方差**：$\\boldsymbol{\\Sigma} = \\begin{pmatrix} 1.0  0.6 \\\\ 0.6  1.5 \\end{pmatrix}$\n-   **观测样本均值**：$\\bar{\\boldsymbol{y}} = \\begin{pmatrix} 1.2 \\\\ -0.7 \\end{pmatrix}$\n-   **任务1**：推导后验分布 $\\boldsymbol{\\theta} \\mid \\text{data}$。\n-   **任务2**：找到 $0.95$ 联合可信区域 $(\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n})^{\\top} \\boldsymbol{\\Lambda}_{n}^{-1} (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n}) \\leq c$ 的 $c$ 值。\n-   **任务3**：计算 $\\theta_1$ 和 $\\theta_2$ 的 $0.95$ 边际可信区间，并解释联合概率和边际概率之间的关系。\n-   **要求输出**：$c$ 的单个数值，四舍五入到四位有效数字。\n\n### 第二步：使用提取的已知条件进行验证\n这个问题在科学上和数学上都是合理的。它描述了多元正态模型的标准共轭贝叶斯分析，这是生物统计学中的一个基本课题。先验和似然的协方差矩阵 $\\boldsymbol{\\Lambda}_{0}$ 和 $\\boldsymbol{\\Sigma}$ 必须是正定的。\n-   对于先验协方差 $\\boldsymbol{\\Lambda}_{0}$：对角元素为正，行列式为 $\\det(\\boldsymbol{\\Lambda}_{0}) = (2)(2) - (0.4)(0.4) = 4 - 0.16 = 3.84 > 0$。因此，$\\boldsymbol{\\Lambda}_{0}$ 是正定的。\n-   对于似然协方差 $\\boldsymbol{\\Sigma}$：对角元素为正，行列式为 $\\det(\\boldsymbol{\\Sigma}) = (1.0)(1.5) - (0.6)(0.6) = 1.5 - 0.36 = 1.14 > 0$。因此，$\\boldsymbol{\\Sigma}$ 是正定的。\n\n这个问题是适定的，所有必要信息都已提供。样本均值 $\\bar{\\boldsymbol{y}}$ 是给定数据下 $\\boldsymbol{\\theta}$ 的充分统计量，所以不需要单个数据点 $\\boldsymbol{y}_i$。这个问题是客观的，没有矛盾，并且直接关系到贝叶斯推断这一特定主题。它并非微不足道，因为它需要结合贝叶斯更新和多元正态分布性质的知识。\n\n### 第三步：结论和行动\n这个问题是有效的。将提供完整的解决方案。\n\n这个问题要求推导后验分布，确定 $0.95$ 联合可信区域的常数 $c$，并对边际可信区间进行解释。\n\n首先，我们推导参数向量 $\\boldsymbol{\\theta}$ 的后验分布。该模型是一个多元正态-正态共轭模型。\n先验分布给定为 $\\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{0}, \\boldsymbol{\\Lambda}_{0})$。其概率密度函数正比于：\n$$ p(\\boldsymbol{\\theta}) \\propto \\exp\\left(-\\frac{1}{2}(\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{0})^{\\top} \\boldsymbol{\\Lambda}_{0}^{-1} (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{0})\\right) $$\n数据包含 $n=20$ 个独立同分布的观测值 $\\boldsymbol{y}_{i} \\sim \\mathcal{N}(\\boldsymbol{\\theta}, \\boldsymbol{\\Sigma})$。整个数据集的似然函数是 $L(\\boldsymbol{\\theta}; \\boldsymbol{y}_1, ..., \\boldsymbol{y}_n) = \\prod_{i=1}^n p(\\boldsymbol{y}_i | \\boldsymbol{\\theta})$。对于这个模型，样本均值 $\\bar{\\boldsymbol{y}} = \\frac{1}{n} \\sum_{i=1}^n \\boldsymbol{y}_i$ 是 $\\boldsymbol{\\theta}$ 的一个充分统计量。样本均值的分布是 $\\bar{\\boldsymbol{y}} \\mid \\boldsymbol{\\theta} \\sim \\mathcal{N}(\\boldsymbol{\\theta}, \\frac{1}{n}\\boldsymbol{\\Sigma})$。因此，作为 $\\boldsymbol{\\theta}$ 的函数，似然函数正比于 $\\bar{\\boldsymbol{y}}$ 的概率密度：\n$$ L(\\boldsymbol{\\theta}; \\bar{\\boldsymbol{y}}) \\propto p(\\bar{\\boldsymbol{y}} \\mid \\boldsymbol{\\theta}) \\propto \\exp\\left(-\\frac{1}{2}(\\bar{\\boldsymbol{y}} - \\boldsymbol{\\theta})^{\\top} \\left(\\frac{1}{n}\\boldsymbol{\\Sigma}\\right)^{-1} (\\bar{\\boldsymbol{y}} - \\boldsymbol{\\theta})\\right) = \\exp\\left(-\\frac{n}{2}(\\boldsymbol{\\theta} - \\bar{\\boldsymbol{y}})^{\\top} \\boldsymbol{\\Sigma}^{-1} (\\boldsymbol{\\theta} - \\bar{\\boldsymbol{y}})\\right) $$\n根据贝叶斯定理，后验密度正比于似然函数和先验密度的乘积：\n$$ p(\\boldsymbol{\\theta} \\mid \\text{data}) \\propto L(\\boldsymbol{\\theta}; \\bar{\\boldsymbol{y}}) p(\\boldsymbol{\\theta}) $$\n后验密度的指数是似然函数和先验函数指数的和。由于两者都是 $\\boldsymbol{\\theta}$ 的二次型，它们的和也是 $\\boldsymbol{\\theta}$ 的二次型。这意味着后验分布也是一个多元正态分布，记为 $\\boldsymbol{\\theta} \\mid \\text{data} \\sim \\mathcal{N}(\\boldsymbol{\\mu}_{n}, \\boldsymbol{\\Lambda}_{n})$。后验精度矩阵 $\\boldsymbol{\\Lambda}_{n}^{-1}$ 是先验精度矩阵 $\\boldsymbol{\\Lambda}_{0}^{-1}$ 和数据精度矩阵 $n\\boldsymbol{\\Sigma}^{-1}$ 的和：\n$$ \\boldsymbol{\\Lambda}_{n}^{-1} = \\boldsymbol{\\Lambda}_{0}^{-1} + n\\boldsymbol{\\Sigma}^{-1} $$\n后验均值 $\\boldsymbol{\\mu}_{n}$ 是先验均值 $\\boldsymbol{\\mu}_0$ 和样本均值 $\\bar{\\boldsymbol{y}}$ 的精度加权平均值：\n$$ \\boldsymbol{\\mu}_{n} = \\boldsymbol{\\Lambda}_{n}(\\boldsymbol{\\Lambda}_{0}^{-1}\\boldsymbol{\\mu}_{0} + n\\boldsymbol{\\Sigma}^{-1}\\bar{\\boldsymbol{y}}) $$\n因此，我们已正式确定后验分布是一个二元正态分布。\n\n这个问题要求确定定义 $0.95$ 联合可信区域的 $c$ 值：\n$$ \\left\\{ \\boldsymbol{\\theta} : (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n})^{\\top} \\boldsymbol{\\Lambda}_{n}^{-1} (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n}) \\leq c \\right\\} $$\n令 $Q = (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n})^{\\top} \\boldsymbol{\\Lambda}_{n}^{-1} (\\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n})$。这是一个二次型。由于 $\\boldsymbol{\\theta}$ 的后验分布是 $\\mathcal{N}(\\boldsymbol{\\mu}_{n}, \\boldsymbol{\\Lambda}_{n})$，随机向量 $\\boldsymbol{z} = \\boldsymbol{\\theta} - \\boldsymbol{\\mu}_{n}$ 服从一个中心化的正态分布，即 $\\boldsymbol{z} \\sim \\mathcal{N}(\\boldsymbol{0}, \\boldsymbol{\\Lambda}_{n})$。\n在多元统计学中，这是一个标准结果：如果一个 $p$ 维随机向量 $\\boldsymbol{z}$ 的分布为 $\\mathcal{N}(\\boldsymbol{0}, \\boldsymbol{C})$，那么二次型 $\\boldsymbol{z}^{\\top}\\boldsymbol{C}^{-1}\\boldsymbol{z}$ 服从自由度为 $p$ 的卡方分布，记作 $\\chi^2_p$。\n在这个问题中，参数向量 $\\boldsymbol{\\theta}$ 是 $p=2$ 维的。因此，二次型 $Q$ 服从自由度为 $2$ 的卡方分布：\n$$ Q \\sim \\chi^2_2 $$\n我们需要找到 $c$ 的值，使得该区域的后验概率为 $0.95$，这意味着我们需要 $P(Q \\leq c) = 0.95$。这个 $c$ 是 $\\chi^2_2$ 分布的第 $95$ 个百分位数。\n\n$\\chi^2_2$ 分布是一个特例，等价于速率参数 $\\lambda = 1/2$ 的指数分布。对于 $x \\geq 0$，其概率密度函数为 $f(x) = \\frac{1}{2}\\exp(-x/2)$，累积分布函数为 $F(x) = 1 - \\exp(-x/2)$。\n我们设 $F(c) = 0.95$：\n$$ 1 - \\exp(-c/2) = 0.95 $$\n$$ \\exp(-c/2) = 1 - 0.95 = 0.05 $$\n两边取自然对数：\n$$ -c/2 = \\ln(0.05) $$\n$$ c = -2 \\ln(0.05) = -2 \\ln\\left(\\frac{1}{20}\\right) = 2 \\ln(20) $$\n这个 $c$ 值不依赖于 $\\boldsymbol{\\mu}_n$ 或 $\\boldsymbol{\\Lambda}_n$ 的具体值，只依赖于 $\\boldsymbol{\\theta}$ 的维数和所要求的概率水平。\n\n问题的第二部分要求解释为什么由 $\\theta_1$ 和 $\\theta_2$ 的 $0.95$ 边际可信区间构成的矩形区域的联合概率小于 $0.95$。设 $I_1$ 和 $I_2$ 分别是 $\\theta_1$ 和 $\\theta_2$ 的 $0.95$ 边际可信区间。根据定义，$P(\\theta_1 \\in I_1) = 0.95$ 且 $P(\\theta_2 \\in I_2) = 0.95$。矩形区域是 $R = I_1 \\times I_2$。该区域的概率是 $P(\\boldsymbol{\\theta} \\in R) = P(\\theta_1 \\in I_1 \\text{ 且 } \\theta_2 \\in I_2)$。\n设 $A$ 是事件 $\\{\\theta_1 \\in I_1\\}$，$B$ 是事件 $\\{\\theta_2 \\in I_2\\}$。我们想解释为什么 $P(A \\cap B)  0.95$。\n我们可以写出 $P(A) = P(A \\cap B) + P(A \\cap B^c)$。\n所以，$P(A \\cap B) = P(A) - P(A \\cap B^c) = 0.95 - P(A \\cap B^c)$，其中 $B^c$ 是事件 $\\{\\theta_2 \\notin I_2\\}$。\n对应于 $A \\cap B^c$ 的区域是 $\\{ \\boldsymbol{\\theta} : \\theta_1 \\in I_1 \\text{ 且 } \\theta_2 \\notin I_2 \\}$。这个区域在 $\\mathbb{R}^2$ 平面中具有非零面积。对于一个非退化的二元正态分布（即后验相关性 $|\\rho_n|  1$），后验概率密度在任何地方都严格为正。因此，任何具有非零面积的区域都必须有严格为正的概率。\n由此得出 $P(A \\cap B^c) > 0$。因此，$P(A \\cap B) = 0.95 - P(A \\cap B^c)  0.95$。\n这个不等式是严格的，除非 $|\\rho_n|=1$。在完全相关（$|\\rho_n|=1$）的极限情况下，二元分布退化，所有概率质量都位于一条直线上。在这种情况下，事件 $\\theta_1 \\in I_1$ 变得与事件 $\\theta_2 \\in I_2$ 相同（对于适当缩放的区间），这意味着 $A=B$，因此 $P(A \\cap B^c) = P(\\emptyset) = 0$，导致 $P(A \\cap B) = P(A) = 0.95$。\n联合概率 $P(A \\cap B)$ 依赖于后验相关性 $\\rho_n$。当 $\\rho_n=0$（独立）时，它最低，此时 $P(A \\cap B) = P(A)P(B) = 0.95^2 = 0.9025$。随着 $|\\rho_n|$ 增加到 $1$，$P(A \\cap B)$ 增加，在极限处达到 $0.95$。\n\n最后，我们计算 c 的数值。\n$$ c = 2 \\ln(20) $$\n使用计算器，$\\ln(20) \\approx 2.99573227$。\n$$ c \\approx 2 \\times 2.99573227 = 5.99146454 $$\n四舍五入到四位有效数字，我们得到 $c = 5.991$。", "answer": "$$\n\\boxed{5.991}\n$$", "id": "4896890"}]}