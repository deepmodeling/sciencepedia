{"hands_on_practices": [{"introduction": "聚类分析的基础是距离度量，但像欧几里得距离这样“一刀切”的方法在处理特殊数据类型时可能会产生误导。在生物学研究中，我们经常遇到计数数据（例如RNA测序数据），其方差与均值相关。这个练习 [@problem_id:4900189] 将指导你从泊松统计模型中推导出一个相异性度量，展示一个有原则的、基于模型的方法如何为计数数据的聚类提供更稳健的基础。", "problem": "一位生物统计学家正在对一个小型RNA测序实验中具有零膨胀计数数据的样本进行聚类分析。实验包含 $3$ 个样本，标记为 $A$、$B$ 和 $C$，以及 $4$ 个基因，标记为 $g_1, g_2, g_3, g_4$。观测到的计数值（按 $(g_1,g_2,g_3,g_4)$ 的顺序）如下：\n- 样本 $A$: $(0, 3, 12, 0)$\n- 样本 $B$: $(1, 0, 7, 2)$\n- 样本 $C$: $(0, 1, 15, 0)$\n\n假设基因之间相互独立，且所有样本的测序深度相同。为了基于泊松模型定义两个样本之间的相异性，请按以下步骤操作。对于给定的基因 $g$ 和一对样本 $(i,j)$，其观测计数值为 $x_{gi}$ 和 $x_{gj}$，考虑泊松概率质量函数以及偏差（deviance）的定义，即饱和模型下的最大对数似然与两个泊松均值相等（即 $\\lambda_{gi}=\\lambda_{gj}=\\mu_g$）的约束模型下的最大对数似然之差的两倍。从这些基本定义出发，推导出每个基因对偏差的贡献，并由此推导出两个样本间基于偏差的总相异性，即所有基因贡献的总和。使用自然对数，并采纳惯例 $0 \\ln(0/\\mu_g)=0$ 以及当 $x_{gi}=x_{gj}=0$ 时基因对偏差的贡献为 $0$。不要引入任何额外的伪计数。\n\n使用您推导的表达式，计算三对样本 $(A,B)$、$(A,C)$ 和 $(B,C)$ 的成对基于偏差的相异性，然后计算这三个成对相异性的平均值。将您的最终平均值四舍五入到四位有效数字。最终数字不带单位。\n\n根据您的推导，简要论证为什么这种基于偏差的相异性比原始计数的欧几里得距离更能稳健地处理计数数据固有的均值-方差关系。", "solution": "首先验证问题，以确保其科学上合理、定义明确、客观且完整。\n\n### 步骤 1：提取已知条件\n-   样本数量：$3$，标记为 $A, B, C$。\n-   基因数量：$4$，标记为 $g_1, g_2, g_3, g_4$。\n-   观测计数值（按 $(g_1, g_2, g_3, g_4)$ 顺序）：\n    -   样本 $A$: $(0, 3, 12, 0)$\n    -   样本 $B$: $(1, 0, 7, 2)$\n    -   样本 $C$: $(0, 1, 15, 0)$\n-   模型：泊松概率质量函数。\n-   假设：基因相互独立，各样本测序深度相等。\n-   相异性定义：偏差（Deviance），定义为 $D = 2 \\times (\\text{饱和模型的最大对数似然} - \\text{约束模型的最大对数似然})$。\n-   样本 $i$ 和 $j$ 之间相异性的约束：对于给定的基因 $g$，泊松均值相等，即 $\\lambda_{gi} = \\lambda_{gj} = \\mu_g$。\n-   对数：自然对数，$\\ln$。\n-   惯例：$0 \\ln(0/\\mu_g) = 0$；如果 $x_{gi}=x_{gj}=0$，则贡献为 $0$。\n-   不使用伪计数。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上是合理的，它使用了生物统计学中分析计数数据的标准统计建模原理（泊松分布、似然、偏差）。该问题定义明确，提供了推导唯一解所需的所有数据、假设和定义。术语客观而精确。问题是完整的且内部一致的。计算是可行的。\n\n### 步骤 3：结论与行动\n此问题是**有效的**。将推导并给出解答。\n\n### 基于偏差的相异性的推导\n\n我们考虑单个基因 $g$ 和一对样本 $(i, j)$，其观测计数值为 $x_{gi}$ 和 $x_{gj}$。对于一个均值参数为 $\\lambda$ 的观测值 $x$，其泊松概率质量函数为 $P(x; \\lambda) = \\frac{\\exp(-\\lambda)\\lambda^x}{x!}$。对数似然为 $\\ell(\\lambda; x) = \\ln(P(x; \\lambda)) = x \\ln(\\lambda) - \\lambda - \\ln(x!)$。\n\n**1. 饱和模型的对数似然：**\n在饱和模型中，每个观测值都有其自身的参数。对于观测对 $(x_{gi}, x_{gj})$，参数为 $\\lambda_{gi}$ 和 $\\lambda_{gj}$。由于独立性假设，总对数似然是各个对数似然之和：\n$$L_{sat}(\\lambda_{gi}, \\lambda_{gj}) = \\ell(\\lambda_{gi}; x_{gi}) + \\ell(\\lambda_{gj}; x_{gj}) = (x_{gi} \\ln \\lambda_{gi} - \\lambda_{gi} - \\ln(x_{gi}!)) + (x_{gj} \\ln \\lambda_{gj} - \\lambda_{gj} - \\ln(x_{gj}!))$$\n通过将偏导数设为零，可以找到参数的最大似然估计（MLE）：\n$\\frac{\\partial L_{sat}}{\\partial \\lambda_{gi}} = \\frac{x_{gi}}{\\lambda_{gi}} - 1 = 0 \\implies \\hat{\\lambda}_{gi}^{\\text{sat}} = x_{gi}$\n$\\frac{\\partial L_{sat}}{\\partial \\lambda_{gj}} = \\frac{x_{gj}}{\\lambda_{gj}} - 1 = 0 \\implies \\hat{\\lambda}_{gj}^{\\text{sat}} = x_{gj}$\n将这些最大似然估计值代回，得到饱和模型的最大化对数似然 $\\ell_{sat}$：\n$$\\ell_{sat} = (x_{gi} \\ln x_{gi} - x_{gi} - \\ln(x_{gi}!)) + (x_{gj} \\ln x_{gj} - x_{gj} - \\ln(x_{gj}!))$$\n这里我们使用惯例，当 $x=0$ 时，$x \\ln x = 0$。\n\n**2. 约束模型的对数似然：**\n在约束模型中，我们施加原假设，即均值相等：$\\lambda_{gi} = \\lambda_{gj} = \\mu_g$。对数似然为：\n$$L_{con}(\\mu_g) = (x_{gi} \\ln \\mu_g - \\mu_g - \\ln(x_{gi}!)) + (x_{gj} \\ln \\mu_g - \\mu_g - \\ln(x_{gj}!))$$\n$$L_{con}(\\mu_g) = (x_{gi} + x_{gj}) \\ln \\mu_g - 2\\mu_g - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n$\\mu_g$ 的最大似然估计为：\n$\\frac{\\partial L_{con}}{\\partial \\mu_g} = \\frac{x_{gi} + x_{gj}}{\\mu_g} - 2 = 0 \\implies \\hat{\\mu}_g = \\frac{x_{gi} + x_{gj}}{2}$\n将其代回，得到约束模型的最大化对数似然 $\\ell_{con}$：\n$$\\ell_{con} = (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - 2\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n$$\\ell_{con} = (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - (x_{gi} + x_{gj}) - \\ln(x_{gi}!) - \\ln(x_{gj}!)$$\n\n**3. 单个基因的偏差贡献：**\n基因 $g$ 的偏差贡献，记为 $d_g(i,j)$，是最大化对数似然之差的两倍：\n$$d_g(i,j) = 2 (\\ell_{sat} - \\ell_{con})$$\n$$d_g(i,j) = 2 \\left[ (x_{gi} \\ln x_{gi} - x_{gi} + x_{gj} \\ln x_{gj} - x_{gj}) - \\left( (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) - (x_{gi} + x_{gj}) \\right) \\right]$$\n包含 $-x_{gi}$ 和 $-x_{gj}$ 的项相互抵消：\n$$d_g(i,j) = 2 \\left[ x_{gi} \\ln x_{gi} + x_{gj} \\ln x_{gj} - (x_{gi} + x_{gj}) \\ln\\left(\\frac{x_{gi} + x_{gj}}{2}\\right) \\right]$$\n使用对数性质重新整理各项：\n$$d_g(i,j) = 2 \\left[ x_{gi} \\ln\\left(\\frac{x_{gi}}{(x_{gi} + x_{gj})/2}\\right) + x_{gj} \\ln\\left(\\frac{x_{gj}}{(x_{gi} + x_{gj})/2}\\right) \\right]$$\n这是单个基因偏差贡献的通用公式。如果 $x_{gi} = x_{gj} = 0$，则表达式为 $0$。如果其中一个计数值为零（例如，$x_{gi}=0, x_{gj}>0$），设 $\\mu_g = x_{gj}/2$。根据 $0 \\ln(0/\\mu_g)=0$ 的惯例，第一项的贡献为 $0$。总贡献为 $d_g(i,j) = 2 \\left[ x_{gj} \\ln\\left(\\frac{x_{gj}}{x_{gj}/2}\\right) \\right] = 2 x_{gj} \\ln(2)$。\n\n### 成对相异性的计算\n总相异性 $D_{ij}$ 是单个基因偏差的总和：$D_{ij} = \\sum_{g=1}^{4} d_g(i, j)$。\n数据：$A=(0, 3, 12, 0)$，$B=(1, 0, 7, 2)$，$C=(0, 1, 15, 0)$。\n\n**相异性 $D_{AB}$：**\n- $g_1$: $(x_{g1,A}, x_{g1,B}) = (0, 1)$。$d_1 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_2$: $(x_{g2,A}, x_{g2,B}) = (3, 0)$。$d_2 = 2 \\times 3 \\times \\ln(2) = 6\\ln(2)$。\n- $g_3$: $(x_{g3,A}, x_{g3,B}) = (12, 7)$。均值 $\\hat{\\mu}_{g3} = (12+7)/2 = 9.5$。\n$d_3 = 2 \\left[ 12 \\ln\\left(\\frac{12}{9.5}\\right) + 7 \\ln\\left(\\frac{7}{9.5}\\right) \\right]$。\n- $g_4$: $(x_{g4,A}, x_{g4,B}) = (0, 2)$。$d_4 = 2 \\times 2 \\times \\ln(2) = 4\\ln(2)$。\n$D_{AB} = 2\\ln(2) + 6\\ln(2) + d_3 + 4\\ln(2) = 12\\ln(2) + 2 \\left[ 12 \\ln\\left(\\frac{12}{9.5}\\right) + 7 \\ln\\left(\\frac{7}{9.5}\\right) \\right]$\n$D_{AB} \\approx 12(0.69315) + 2 [12(0.23363) + 7(-0.30538)] = 8.3178 + 2[2.80356 - 2.13766] = 8.3178 + 1.3318 = 9.6496$。\n\n**相异性 $D_{AC}$：**\n- $g_1$: $(x_{g1,A}, x_{g1,C}) = (0, 0)$。$d_1 = 0$。\n- $g_2$: $(x_{g2,A}, x_{g2,C}) = (3, 1)$。均值 $\\hat{\\mu}_{g2} = (3+1)/2 = 2$。\n$d_2 = 2 \\left[ 3 \\ln\\left(\\frac{3}{2}\\right) + 1 \\ln\\left(\\frac{1}{2}\\right) \\right] = 6\\ln(1.5) - 2\\ln(2)$。\n- $g_3$: $(x_{g3,A}, x_{g3,C}) = (12, 15)$。均值 $\\hat{\\mu}_{g3} = (12+15)/2 = 13.5$。\n$d_3 = 2 \\left[ 12 \\ln\\left(\\frac{12}{13.5}\\right) + 15 \\ln\\left(\\frac{15}{13.5}\\right) \\right]$。\n- $g_4$: $(x_{g4,A}, x_{g4,C}) = (0, 0)$。$d_4 = 0$。\n$D_{AC} = d_2 + d_3 = (6\\ln(1.5) - 2\\ln(2)) + 2 \\left[ 12 \\ln\\left(\\frac{12}{13.5}\\right) + 15 \\ln\\left(\\frac{15}{13.5}\\right) \\right]$\n$D_{AC} \\approx (6(0.40547) - 2(0.69315)) + 2 [12(-0.11778) + 15(0.10536)] = (2.43282 - 1.3863) + 2[-1.41336 + 1.5804] = 1.04652 + 0.33408 = 1.3806$。\n\n**相异性 $D_{BC}$：**\n- $g_1$: $(x_{g1,B}, x_{g1,C}) = (1, 0)$。$d_1 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_2$: $(x_{g2,B}, x_{g2,C}) = (0, 1)$。$d_2 = 2 \\times 1 \\times \\ln(2) = 2\\ln(2)$。\n- $g_3$: $(x_{g3,B}, x_{g3,C}) = (7, 15)$。均值 $\\hat{\\mu}_{g3} = (7+15)/2 = 11$。\n$d_3 = 2 \\left[ 7 \\ln\\left(\\frac{7}{11}\\right) + 15 \\ln\\left(\\frac{15}{11}\\right) \\right]$。\n- $g_4$: $(x_{g4,B}, x_{g4,C}) = (2, 0)$。$d_4 = 2 \\times 2 \\times \\ln(2) = 4\\ln(2)$。\n$D_{BC} = 2\\ln(2) + 2\\ln(2) + d_3 + 4\\ln(2) = 8\\ln(2) + 2 \\left[ 7 \\ln\\left(\\frac{7}{11}\\right) + 15 \\ln\\left(\\frac{15}{11}\\right) \\right]$\n$D_{BC} \\approx 8(0.69315) + 2 [7(-0.45199) + 15(0.31015)] = 5.5452 + 2[-3.16393 + 4.65225] = 5.5452 + 2.97664 = 8.5218$。\n\n### 最终平均值计算\n三个成对相异性为 $D_{AB} \\approx 9.6496$，$D_{AC} \\approx 1.3806$ 和 $D_{BC} \\approx 8.5218$。\n平均相异性为：\n$$\\text{Average} = \\frac{D_{AB} + D_{AC} + D_{BC}}{3} = \\frac{9.6496 + 1.3806 + 8.5218}{3} = \\frac{19.5520}{3} \\approx 6.51733...$$\n四舍五入到四位有效数字，平均值为 $6.517$。\n\n### 稳健性论证\n基于根本的统计学原因，基于偏差的相异性比欧几里得距离更能稳健地处理计数数据的均值-方差关系。\n1.  **基于模型的基础**：偏差直接从泊松模型的对数似然推导而来。这意味着它内在地考虑了泊松分布数据的统计特性，最显著的是方差等于均值的性质（$\\text{Var}(X) = \\text{E}[X] = \\lambda$）。\n2.  **方差稳定化**：欧几里得距离对计数的原始数值大小很敏感。计数从 $10$ 到 $15$ 的差异（为 $5$）与从 $100$ 到 $105$ 的差异（同样为 $5$）对距离平方的贡献是相同的。然而，在泊松框架下，均值为 $100$ 的方差远大于均值为 $10$ 的方差。因此，对于较大的计数值，一个 $5$ 的差异不那么显著。偏差公式包含 $x \\ln(x/\\mu)$ 形式的项，它在相对于均值的对数尺度上评估差异。这种变换有效地稳定了方差，为整个表达水平范围内的差异赋予了更合适的权重。它正确地评估出，从 $0$ 变为 $3$（如样本 A 与 B 的基因 $g_2$）比从 $7$ 变为 $12$（如基因 $g_3$）更能作为差异的显著证据，这一点反映在它们各自的偏差贡献上（$6\\ln(2) \\approx 4.16$ 对比 $\\approx 1.33$），而这与欧几里得距离平方得出的结论（$3^2=9$ 对比 $5^2=25$）正好相反。\n3.  **证据度量**：偏差本质上是一个统计检验量（与似然比检验相关），它量化了反对“两个样本对于给定基因具有相同平均表达水平”这一原假设的证据强度。欧几里得距离则是一个纯粹的几何度量，缺乏这种统计解释，因此无法洞察潜在的数据生成过程。\n\n总而言之，基于偏差的相异性提供了一种有统计学原理支持的距离度量，能够恰当地处理计数数据固有的异方差性（即方差非恒定）。", "answer": "$$\n\\boxed{6.517}\n$$", "id": "4900189"}, {"introduction": "除了选择正确的度量标准，理解所选算法的内部机制也至关重要。例如，流行的k-均值算法因其最小化平方误差和的目标而对异常值极其敏感。本练习 [@problem_id:4900186] 设计了一个思想实验，你将确定一个异常值导致k-均值算法失效的确切“临界点”，从而突显出算法稳健性的关键重要性。", "problem": "一位生物统计学研究者正在分析一个在 $n=11$ 名受试者中测量的单变量基因表达生物标志物。由于批次效应（batch artifact），一名受试者表现出极端值。为清晰起见，忽略测量噪声，数据包含两个具有生物学意义的组和一个离群值，具体来说是 $n_{1}=5$ 名值为 $0$ 的受试者，$n_{2}=5$ 名值为 $10$ 的受试者，以及一个值为 $L>10$ 的离群值。目标是使用平方欧几里得距离将这些受试者聚类成 $k=2$ 个组。具有生物学意义的划分是，值为 $0$ 的受试者构成一个簇，值为 $10$ 的受试者构成另一个簇，而离群值则通过稳健的程序来处理。\n\n$k$-均值目标函数的定义是与簇均值的平方偏差之和；形式上，对于一个划分 $\\{C_{1},C_{2}\\}$，其簇均值分别为 $m_{1}$ 和 $m_{2}$，目标函数为 $\\sum_{x\\in C_{1}}(x-m_{1})^{2}+\\sum_{x\\in C_{2}}(x-m_{2})^{2}$。考虑数据集的两种可能的划分：\n- 划分I（生物学上正确的组）：将值为 $0$ 的受试者聚为一个簇，值为 $10$ 的受试者聚为另一个簇，并将离群值分配给其均值更接近 $L$ 的簇。\n- 划分II（对抗性的离群值隔离）：将离群值单独置于一个簇中，并将两个生物学组合并到另一个簇中。\n\n使用第一性原理和目标函数定义，推导出临界离群值大小 $L^{\\ast}$，使得对于所有 $L>L^{\\ast}$，标准 $k$-均值目标函数在所有 $k=2$ 划分上的全局最小值是划分II而不是划分I。然后，解释为什么一个修剪比例为 $\\alpha=\\frac{1}{11}$ 的 $\\alpha$-修剪 $k$-均值过程（该过程在计算簇均值之前，会丢弃具有最大平方残差的 $\\alpha$ 比例的观测值）对于任何 $L>L^{\\ast}$ 都能恢复生物学上正确的两组结构。\n\n将您的最终答案表示为 $L^{\\ast}$ 的精确值。不要四舍五入。", "solution": "相关的基础是 $k$-均值目标函数的定义，即与簇均值的平方偏差之和。我们将比较两种候选划分的目标函数值，并确定对于离群值大小 $L$ 的哪些值，哪种划分会产生更小的目标函数值。\n\n我们将数据集表示为 $D=\\{0,0,0,0,0,10,10,10,10,10,L\\}$，其中有 $n_{1}=5$ 个值为 $0$ 的观测值，$n_{2}=5$ 个值为 $10$ 的观测值，以及一个值为 $L>10$ 的离群值。我们使用 $k=2$ 个簇和平方欧几里得距离。\n\n划分I将值为 $0$ 的受试者放入一个簇，将值为 $10$ 的受试者放入另一个簇。由于 $L>10$，离群值比 $0$ 更接近 $10$，因此，为了比较目标函数值，很自然地考虑将 $L$ 分配给最初中心在 $10$ 附近的簇。在这种划分下：\n- 簇 $C_{1}$ 包含五个值为 $0$ 的受试者，因此其均值为 $m_{1}=0$，其簇内平方和为 $\\sum_{x\\in C_{1}}(x-m_{1})^{2}=0$。\n- 簇 $C_{2}$ 包含五个值为 $10$ 的受试者和离群值 $L$，因此其均值为\n$$\nm_{2}=\\frac{10\\cdot n_{2}+L}{n_{2}+1}=\\frac{50+L}{6}.\n$$\n$C_{2}$ 中的平方偏差和是\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=n_{2}\\,(10-m_{2})^{2}+(L-m_{2})^{2}.\n$$\n我们明确地计算偏差。首先，\n$$\n10-m_{2}=10-\\frac{50+L}{6}=\\frac{60-(50+L)}{6}=\\frac{10-L}{6},\n$$\n其次，\n$$\nL-m_{2}=L-\\frac{50+L}{6}=\\frac{6L-(50+L)}{6}=\\frac{5L-50}{6}=\\frac{5(L-10)}{6}.\n$$\n因此，\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=5\\left(\\frac{10-L}{6}\\right)^{2}+\\left(\\frac{5(L-10)}{6}\\right)^{2}\n=\\frac{5(10-L)^{2}}{36}+\\frac{25(L-10)^{2}}{36}\n=\\frac{30(L-10)^{2}}{36}=\\frac{5}{6}(L-10)^{2}.\n$$\n因此，划分I的总 $k$-均值目标函数为\n$$\n\\text{SSE}_{\\text{I}}=0+\\frac{5}{6}(L-10)^{2}=\\frac{5}{6}(L-10)^{2}.\n$$\n\n划分II将离群值单独隔离到一个簇中，并将两个生物学组合并到另一个簇中。在这种划分下：\n- 簇 $C_{1}$ 只包含离群值，其均值为 $m_{1}=L$，簇内平方和为 $0$。\n- 簇 $C_{2}$ 包含五个值为 $0$ 的受试者和五个值为 $10$ 的受试者。其均值为\n$$\nm_{2}=\\frac{0\\cdot n_{1}+10\\cdot n_{2}}{n_{1}+n_{2}}=\\frac{50}{10}=5.\n$$\n$C_{2}$ 中的平方偏差和是\n$$\n\\sum_{x\\in C_{2}}(x-m_{2})^{2}=5\\,(0-5)^{2}+5\\,(10-5)^{2}=5\\cdot 25+5\\cdot 25=250.\n$$\n因此，划分II的总目标函数为\n$$\n\\text{SSE}_{\\text{II}}=0+250=250.\n$$\n\n我们确定临界离群值大小 $L^{\\ast}$，此时两种划分的目标函数值相等：\n$$\n\\text{SSE}_{\\text{I}}=\\text{SSE}_{\\text{II}}\n\\quad\\Longleftrightarrow\\quad\n\\frac{5}{6}(L-10)^{2}=250.\n$$\n求解 $L$：\n$$\n(L-10)^{2}=250\\cdot\\frac{6}{5}=50\\cdot 6=300,\n$$\n所以\n$$\nL-10=\\sqrt{300}=10\\sqrt{3}.\n$$\n由于我们考虑的是 $L>10$，相关的解是\n$$\nL^{\\ast}=10+10\\sqrt{3}.\n$$\n对于任何 $L>L^{\\ast}$，我们有 $\\text{SSE}_{\\text{I}}>\\text{SSE}_{\\text{II}}$，因此标准 $k$-均值目标函数在 $k=2$ 时的全局最小值是划分II，它隔离了离群值并合并了两个生物学组，从而未能恢复生物学上正确的簇。\n\n最后，考虑修剪比例为 $\\alpha=\\frac{1}{11}$ 的 $\\alpha$-修剪 $k$-均值过程。在 $\\alpha=\\frac{1}{11}$ 的水平上进行修剪，会恰好丢弃一个（因为 $n=11$）相对于当前质心具有最大平方残差的观测值。对于 $L>10$，离群值是两种候选划分中距离任一质心最远的点，因此是将要被修剪的唯一一个点。修剪掉 $L$ 后，剩余的数据集包含五个值为 $0$ 和五个值为 $10$ 的受试者。将这个修剪后的数据集划分为 $k=2$ 个簇的最优 $k$-均值划分，其均值为 $0$ 和 $10$，簇内离散度为零，从而恢复了生物学上正确的聚类，而无论 $L$ 的值是否大于 $L^{\\ast}$。这表明，即使在标准 $k$-均值因离群值而失败的对抗性情况下，稳健的修剪方法也能恢复正确的簇。\n\n精确的临界离群值大小是 $L^{\\ast}=10+10\\sqrt{3}$。", "answer": "$$\\boxed{10+10\\sqrt{3}}$$", "id": "4900186"}, {"introduction": "聚类分析中的一个常见任务是比较对同一数据的两种不同聚类划分，但简单地计算一致配对的百分比可能会因纯粹的偶然性而产生误导。为了进行严格的比较，我们必须使用一个能够校正这种随机一致性的指标。本练习 [@problem_id:4900171] 将引导你推导和计算调整兰德指数（ARI），这是一个标准工具，它提供了一种基于统计学原理的方法来衡量两种聚类结果之间的相似性。", "problem": "一个生物统计学团队正在评估从相同$n$名患者的转录组和蛋白质组学谱中获得的两种患者亚型无监督聚类之间的一致性。设划分$\\mathcal{U}$有$r$个簇，划分$\\mathcal{V}$有$s$个簇。对于每对$(i,j)$，令$n_{ij}$表示同时在$\\mathcal{U}$的簇$i$和$\\mathcal{V}$的簇$j$中的患者数量。令行和为$a_{i}=\\sum_{j=1}^{s} n_{ij}$，列和为$b_{j}=\\sum_{i=1}^{r} n_{ij}$，因此$\\sum_{i=1}^{r} a_{i}=\\sum_{j=1}^{s} b_{j}=n$。该生物统计学团队使用调整兰德指数（ARI）来比较$\\mathcal{U}$和$\\mathcal{V}$。ARI是通过对兰德指数（RI）进行偶然一致性校正而定义的，而RI是两个划分达成一致的患者对所占的比例。该调整是相对于一个保持了$\\{a_{i}\\}$和$\\{b_{j}\\}$的广义超几何模型。\n\n从兰德指数作为一致对比例的定义出发，仅使用关于患者对的基本组合推理，完成以下任务：\n\n1) 仅使用上面给出的定义，推导出调整兰德指数关于$\\{n_{ij}\\}$、$\\{a_{i}\\}$、$\\{b_{j}\\}$和$\\binom{\\cdot}{2}$的闭式表达式，不引入任何新的定义。\n\n2) 在保持$\\{a_{i}\\}$和$\\{b_{j}\\}$的广义超几何随机标签模型下，使用第一性原理计算未调整的一致对计数的期望值，并解释为什么在此模型下调整兰德指数的期望值为$0$。\n\n3) 考虑$n=12$名患者，标签为$\\{\\,1,2,3,4,5,6,7,8,9,10,11,12\\,\\}$。转录组聚类$\\mathcal{U}$有$r=3$个亚型：\n- $U_{1}=\\{\\,1,2,3,4,5\\,\\}$，\n- $U_{2}=\\{\\,6,7,8,9\\,\\}$，\n- $U_{3}=\\{\\,10,11,12\\,\\}$。\n\n蛋白质组聚类$\\mathcal{V}$有$s=3$个亚型：\n- $V_{1}=\\{\\,1,2,6,7\\,\\}$，\n- $V_{2}=\\{\\,3,4,8,9,10\\,\\}$，\n- $V_{3}=\\{\\,5,11,12\\,\\}$。\n\n计算$\\mathcal{U}$和$\\mathcal{V}$之间的调整兰德指数。将您的答案四舍五入到四位有效数字。不需要单位。", "solution": "评估问题陈述的有效性。\n\n### 步骤1：提取已知条件\n-   $n$：患者总数。\n-   $\\mathcal{U}$：将$n$名患者划分为$r$个簇$\\{U_1, \\dots, U_r\\}$。\n-   $\\mathcal{V}$：将$n$名患者划分为$s$个簇$\\{V_1, \\dots, V_s\\}$。\n-   $n_{ij}$：在$\\mathcal{U}$的簇$i$和$\\mathcal{V}$的簇$j$中的患者数量，即$n_{ij} = |U_i \\cap V_j|$。\n-   $a_i$：$\\mathcal{U}$中簇$i$的大小，$a_i = \\sum_{j=1}^{s} n_{ij}$。\n-   $b_j$：$\\mathcal{V}$中簇$j$的大小，$b_j = \\sum_{i=1}^{r} n_{ij}$。\n-   $\\sum_{i=1}^{r} a_{i}=\\sum_{j=1}^{s} b_{j}=n$。\n-   兰德指数（RI）：两个划分达成一致的患者对的比例。\n-   调整兰德指数（ARI）：在广义超几何模型下，对RI进行偶然一致性校正，该模型保持边际和$\\{a_{i}\\}$和$\\{b_{j}\\}$。\n-   任务1：推导ARI的闭式表达式。\n-   任务2：在指定模型下，计算未调整的一致对计数的期望值，并解释为什么$E[\\text{ARI}]=0$。\n-   任务3：对于一个$n=12$且给定划分$\\mathcal{U}$和$\\mathcal{V}$的具体案例，计算ARI并四舍五入到四位有效数字。\n    -   $n=12$。\n    -   $U_1=\\{\\,1,2,3,4,5\\,\\}$，$U_2=\\{\\,6,7,8,9\\,\\}$，$U_3=\\{\\,10,11,12\\,\\}$。\n    -   $V_1=\\{\\,1,2,6,7\\,\\}$，$V_2=\\{\\,3,4,8,9,10\\,\\}$，$V_3=\\{\\,5,11,12\\,\\}$。\n\n### 步骤2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于聚类分析这一成熟的统计学领域。兰德指数、调整兰德指数和广义超几何零模型是该领域中的标准、明确定义的概​​念。这是生物统计学中的一个典型问题。\n-   **定义明确**：该问题定义明确。它要求基于清晰和标准的定义进行推导和计算。所有必要的信息都已提供。存在唯一且有意义的解。\n-   **客观性**：该问题以精确、客观的数学语言陈述，没有主观性或歧义。\n\n### 步骤3：结论与行动\n问题有效。将提供完整解答。\n\n### 解\n\n解答分为所要求的三个任务。\n\n#### 1) 调整兰德指数（ARI）的推导\n\n患者的不同配对总数为$\\binom{n}{2}$。兰德指数（RI）是这些配对中“一致”的配对所占的比例。一个一致对是指一对患者，他们在两个划分中或者被分在同一个簇，或者被分在不同的簇。我们可以根据列联表$(n_{ij})$将所有配对分为四种类型：\n1.  在$\\mathcal{U}$中属同一簇且在$\\mathcal{V}$中也属同一簇的配对。这类配对的数量为$N_{11} = \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$。\n2.  在$\\mathcal{U}$中属同一簇但在$\\mathcal{V}$中属不同簇的配对。这类配对的数量为$N_{10}$。\n3.  在$\\mathcal{U}$中属不同簇但在$\\mathcal{V}$中属同一簇的配对。这类配对的数量为$N_{01}$。\n4.  在$\\mathcal{U}$和$\\mathcal{V}$中都属不同簇的配对。这类配对的数量为$N_{00}$。\n\n在$\\mathcal{U}$中属同一簇的配对总数为$S_U = \\sum_{i=1}^{r} \\binom{a_i}{2}$。在$\\mathcal{V}$中属同一簇的配对总数为$S_V = \\sum_{j=1}^{s} \\binom{b_j}{2}$。\n由此，我们可以表示$N_{10}$和$N_{01}$：\n$N_{10} = S_U - N_{11} = \\sum_{i=1}^{r} \\binom{a_i}{2} - \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$\n$N_{01} = S_V - N_{11} = \\sum_{j=1}^{s} \\binom{b_j}{2} - \\sum_{i=1}^{r} \\sum_{j=1}^{s} \\binom{n_{ij}}{2}$\n\n配对总数为$\\binom{n}{2} = N_{11} + N_{10} + N_{01} + N_{00}$。\n一致对的数量为$A = N_{11} + N_{00}$。我们可以通过减法求得$N_{00}$：\n$N_{00} = \\binom{n}{2} - N_{11} - N_{10} - N_{01} = \\binom{n}{2} - N_{11} - (S_U - N_{11}) - (S_V - N_{11}) = \\binom{n}{2} - S_U - S_V + N_{11}$。\n所以，一致对的总数为：\n$A = N_{11} + N_{00} = N_{11} + \\left( \\binom{n}{2} - S_U - S_V + N_{11} \\right) = \\binom{n}{2} - S_U - S_V + 2N_{11}$。\n兰德指数为$RI = A / \\binom{n}{2}$。\n\n调整兰德指数的定义形式为$\\text{ARI} = \\frac{\\text{指数} - E[\\text{指数}]}{\\text{最大指数} - E[\\text{指数}]}$。“指数”的一个常见选择是在两个划分中都处于同一簇的配对计数$N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2}$。\n在广义超几何模型下，给定固定的边际计数$\\{a_i\\}$和$\\{b_j\\}$，划分$\\mathcal{U}$和$\\mathcal{V}$被假定为独立的。随机选择的一对患者在$\\mathcal{U}$中处于同一簇的概率为$p_U = S_U / \\binom{n}{2}$。随机一对在$\\mathcal{V}$中处于同一簇的概率为$p_V = S_V / \\binom{n}{2}$。由于独立性，随机一对在两者中都处于同一簇的概率为$p_U p_V$。\n这类配对的期望数量$E[N_{11}]$是总配对数乘以该概率：\n$E[N_{11}] = \\binom{n}{2} \\times p_U \\times p_V = \\binom{n}{2} \\frac{S_U}{\\binom{n}{2}} \\frac{S_V}{\\binom{n}{2}} = \\frac{S_U S_V}{\\binom{n}{2}}$。\n$E\\left[\\sum_{i,j}\\binom{n_{ij}}{2}\\right] = \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}$。\n\n“最大指数”是指数可能的最大值，这在最大一致性时发生。这取决于边际$\\{a_i\\}$和$\\{b_j\\}$。该值不是唯一的，但$\\frac{1}{2}(S_U + S_V)$被用作一个代表值，即当一个划分是另一个的细化时，$N_{11}$可能的最大值的平均值。\n因此，ARI为：\n$$ \\text{ARI} = \\frac{N_{11} - E[N_{11}]}{\\frac{1}{2}(S_U + S_V) - E[N_{11}]} $$\n代入$N_{11}$、$S_U$、$S_V$和$E[N_{11}]$的表达式，得到闭式表达式：\n$$ \\text{ARI} = \\frac{\\sum_{i,j}\\binom{n_{ij}}{2} - \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}}{\\frac{1}{2}\\left(\\sum_i\\binom{a_i}{2} + \\sum_j\\binom{b_j}{2}\\right) - \\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}} $$\n\n#### 2) 一致对计数和ARI的期望值\n\n未调整的一致对计数为$A = \\binom{n}{2} - S_U - S_V + 2N_{11}$。\n在随机标签模型下，边际，因此$S_U$和$S_V$是固定的。我们必须找到$A$的期望。利用期望的线性性：\n$E[A] = E\\left[ \\binom{n}{2} - S_U - S_V + 2N_{11} \\right] = \\binom{n}{2} - S_U - S_V + 2E[N_{11}]$。\n代入前面的结果：\n$E[A] = \\binom{n}{2} - \\sum_i\\binom{a_i}{2} - \\sum_j\\binom{b_j}{2} + 2\\frac{\\left(\\sum_i\\binom{a_i}{2}\\right) \\left(\\sum_j\\binom{b_j}{2}\\right)}{\\binom{n}{2}}$。\n\n调整兰德指数被构造成在零模型下期望值为$0$。令指数为随机变量$X = N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2}$。ARI公式的分母$D = \\frac{1}{2}(S_U + S_V) - E[X]$是一个常数，因为边际是固定的。ARI是随机变量$Y = \\frac{X - E[X]}{D}$。\n为了求其期望：\n$E[\\text{ARI}] = E[Y] = E\\left[ \\frac{X - E[X]}{D} \\right]$。\n由于$D$和$E[X]$是常数，我们可以写成：\n$E[\\text{ARI}] = \\frac{1}{D} E[X - E[X]] = \\frac{1}{D} (E[X] - E[E[X]])$。\n常数的期望是常数本身，所以$E[E[X]] = E[X]$。\n因此，$E[\\text{ARI}] = \\frac{1}{D} (E[X] - E[X]) = 0$。\n调整过程从分子中的观测值减去指数的期望值，通过这种构造，使得在零假设下，分子的分布以及整个指数的分布都以0为中心。\n\n#### 3) 针对具体案例的计算\n\n给定$n=12$。\n划分为：\n$\\mathcal{U}: U_1=\\{\\,1,2,3,4,5\\,\\}$，$U_2=\\{\\,6,7,8,9\\,\\}$，$U_3=\\{\\,10,11,12\\,\\}$。\n簇的大小为$a_1=5$，$a_2=4$，$a_3=3$。\n$\\mathcal{V}: V_1=\\{\\,1,2,6,7\\,\\}$，$V_2=\\{\\,3,4,8,9,10\\,\\}$，$V_3=\\{\\,5,11,12\\,\\}$。\n簇的大小为$b_1=4$，$b_2=5$，$b_3=3$。\n\n首先，我们构建计数$n_{ij} = |U_i \\cap V_j|$的列联表：\n$n_{11} = |U_1 \\cap V_1| = |\\{\\,1,2\\,\\}| = 2$\n$n_{12} = |U_1 \\cap V_2| = |\\{\\,3,4\\,\\}| = 2$\n$n_{13} = |U_1 \\cap V_3| = |\\{\\,5\\,\\}| = 1$\n$n_{21} = |U_2 \\cap V_1| = |\\{\\,6,7\\,\\}| = 2$\n$n_{22} = |U_2 \\cap V_2| = |\\{\\,8,9\\,\\}| = 2$\n$n_{23} = |U_2 \\cap V_3| = |\\emptyset| = 0$\n$n_{31} = |U_3 \\cap V_1| = |\\emptyset| = 0$\n$n_{32} = |U_3 \\cap V_2| = |\\{\\,10\\,\\}| = 1$\n$n_{33} = |U_3 \\cap V_3| = |\\{\\,11,12\\,\\}| = 2$\n列联表为：\n$$(n_{ij}) = \\begin{pmatrix} 2  2  1 \\\\ 2  2  0 \\\\ 0  1  2 \\end{pmatrix}$$\n\n现在我们计算ARI公式的各项：\n1.  指数：$N_{11} = \\sum_{i,j}\\binom{n_{ij}}{2} = \\binom{2}{2}+\\binom{2}{2}+\\binom{1}{2}+\\binom{2}{2}+\\binom{2}{2}+\\binom{0}{2}+\\binom{0}{2}+\\binom{1}{2}+\\binom{2}{2}$\n    $N_{11} = 1 + 1 + 0 + 1 + 1 + 0 + 0 + 0 + 1 = 5$。\n2.  $\\mathcal{U}$的配对和：$S_U = \\sum_i\\binom{a_i}{2} = \\binom{5}{2} + \\binom{4}{2} + \\binom{3}{2} = 10 + 6 + 3 = 19$。\n3.  $\\mathcal{V}$的配对和：$S_V = \\sum_j\\binom{b_j}{2} = \\binom{4}{2} + \\binom{5}{2} + \\binom{3}{2} = 6 + 10 + 3 = 19$。\n4.  总配对数：$\\binom{n}{2} = \\binom{12}{2} = \\frac{12 \\times 11}{2} = 66$。\n\n现在，我们计算ARI公式的各组成部分：\n-   期望指数：$E[N_{11}] = \\frac{S_U S_V}{\\binom{n}{2}} = \\frac{19 \\times 19}{66} = \\frac{361}{66}$。\n-   最大指数项：$\\frac{1}{2}(S_U + S_V) = \\frac{1}{2}(19+19) = 19$。\n\n最后，我们计算ARI：\n$$ \\text{ARI} = \\frac{N_{11} - E[N_{11}]}{\\frac{1}{2}(S_U + S_V) - E[N_{11}]} = \\frac{5 - \\frac{361}{66}}{19 - \\frac{361}{66}} $$\n$$ \\text{ARI} = \\frac{\\frac{5 \\times 66 - 361}{66}}{\\frac{19 \\times 66 - 361}{66}} = \\frac{330 - 361}{1254 - 361} = \\frac{-31}{893} $$\n作为小数，这是$\\frac{-31}{893} \\approx -0.0347144456...$。\n四舍五入到四位有效数字得到$-0.03471$。", "answer": "$$\\boxed{-0.03471}$$", "id": "4900171"}]}