{"hands_on_practices": [{"introduction": "本练习 [@problem_id:4895499] 探讨了当抽样违反独立性假设时的直接后果。二项模型的独立性假设在实践中等同于有放回抽样，但当从有限总体中进行无放回抽样时，这一假设便不再成立。通过推导此场景下样本比例的方差，你将量化这种偏差，并发现有限总体校正（FPC）因子，从而理解朴素的二项模型何时会高估真实变异性。", "problem": "一个大小为 $N$ 的有限总体包含具有二元疾病状态的个体，其中真实疾病患病率为 $p$。一位研究者进行了一次大小为 $n$ 的无放回简单随机抽样，以使用样本比例 $\\hat{p}$ 来估计患病率。该研究者随后进行推断，假设数据来自成功概率为 $p$ 的独立同分布伯努利试验（二项模型），忽略了有限总体。从二项模型和超几何模型的基本定义及其经过充分检验的分布性质出发，推导在无放回抽样下 $\\hat{p}$ 的方差与在二项模型下 $\\hat{p}$ 的方差之比的表达式。然后，当 $N=1000$，$n=200$ 且 $p=0.1$ 时，计算这个比率，并简要解释当抽样分数不可忽略时，这个比率对朴素二项方差的偏差方向意味着什么。将最终数值答案四舍五入至四位有效数字。将 $p$ 表示为小数。", "solution": "用户希望我解决以下问题：\n一个大小为 $N$ 的有限总体包含具有二元疾病状态的个体，其中真实疾病患病率为 $p$。一位研究者进行了一次大小为 $n$ 的无放回简单随机抽样，以使用样本比例 $\\hat{p}$ 来估计患病率。该研究者随后进行推断，假设数据来自成功概率为 $p$ 的独立同分布伯努利试验（二项模型），忽略了有限总体。从二项模型和超几何模型的基本定义及其经过充分检验的分布性质出发，推导在无放回抽样下 $\\hat{p}$ 的方差与在二项模型下 $\\hat{p}$ 的方差之比的表达式。然后，当 $N=1000$，$n=200$ 且 $p=0.1$ 时，计算这个比率，并简要解释当抽样分数不可忽略时，这个比率对朴素二项方差的偏差方向意味着什么。将最终数值答案四舍五入至四位有效数字。将 $p$ 表示为小数。\n\n### 第1步：提取已知条件\n- 总体大小: $N$\n- 真实疾病患病率: $p$\n- 抽样方法：无放回简单随机抽样\n- 样本大小: $n$\n- 患病率估计量：样本比例, $\\hat{p}$\n- 用于推断的错误假设：二项模型（独立同分布伯努利试验）\n- 任务1：推导比率 $\\frac{\\text{Var}_{\\text{without replacement}}(\\hat{p})}{\\text{Var}_{\\text{binomial}}(\\hat{p})}$。\n- 任务2：当 $N=1000$，$n=200$ 且 $p=0.1$ 时，计算这个比率。\n- 任务3：解释该比率对偏差的影响。\n- 任务4：将最终数值计算结果四舍五入至四位有效数字。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，提法明确且客观。这是抽样理论中的一个标准问题，比较了超几何抽样（无放回抽样）下样本比例的方差与二项抽样（有放回抽样，或从无限总体中抽样）下样本比例的方差。所有必要的变量都已定义，任务清晰。该问题不违反任何无效性标准。\n\n### 第3步：结论与行动\n问题有效。将提供完整解答。\n\n### 解答推导\n\n样本比例 $\\hat{p}$ 定义为样本中患病个体的数量（称之为 $Y$）除以样本大小 $n$。因此，$\\hat{p} = \\frac{Y}{n}$。$\\hat{p}$ 的方差为 $\\text{Var}(\\hat{p}) = \\text{Var}\\left(\\frac{Y}{n}\\right) = \\frac{1}{n^2}\\text{Var}(Y)$。我们需要在两种不同的抽样模型下求出 $\\text{Var}(Y)$。\n\n**1. （错误的）二项模型下的方差**\n二项模型假设 $n$ 次抽取是独立同分布（i.i.d.）的伯努利试验。这种情况对应于从有限总体中有放回地抽样，或从无限总体中抽样。设 $X_i$ 为指示变量，表示样本中第 $i$ 个个体患病，其中 $i=1, 2, \\dots, n$。\n在此模型下，每个 $X_i$ 是成功概率为 $p$ 的伯努利随机变量。\n$$ E[X_i] = p $$\n$$ \\text{Var}(X_i) = E[X_i^2] - (E[X_i])^2 = p - p^2 = p(1-p) $$\n样本中患病个体的总数为 $Y_{\\text{binom}} = \\sum_{i=1}^{n} X_i$。由于假设 $X_i$ 是独立的，所以和的方差是方差的和：\n$$ \\text{Var}(Y_{\\text{binom}}) = \\text{Var}\\left(\\sum_{i=1}^{n} X_i\\right) = \\sum_{i=1}^{n} \\text{Var}(X_i) = n p (1-p) $$\n因此，二项模型下样本比例的方差为：\n$$ \\text{Var}_{\\text{binom}}(\\hat{p}) = \\frac{1}{n^2} \\text{Var}(Y_{\\text{binom}}) = \\frac{n p (1-p)}{n^2} = \\frac{p(1-p)}{n} $$\n\n**2. 无放回抽样下的方差（正确模型）**\n实际上，样本是从大小为 $N$ 的有限总体中无放回地抽取的。这意味着各次试验不是独立的。计数 $Y$ 的正确模型是超几何分布。我们可以使用指示变量从基本原理推导出方差，这不需要预先知道超几何分布的完整方差公式。\n设 $X_i$ 为第 $i$ 次抽取得到患病个体的指示变量。\n任何单次抽样成功的概率是 $p$，所以 $E[X_i] = p$。\n任何单个指示变量的方差是 $\\text{Var}(X_i) = p(1-p)$。这与二项模型的情况相同。\n总计数为 $Y_{\\text{hyper}} = \\sum_{i=1}^{n} X_i$。这个和的方差是：\n$$ \\text{Var}(Y_{\\text{hyper}}) = \\text{Var}\\left(\\sum_{i=1}^{n} X_i\\right) = \\sum_{i=1}^{n} \\text{Var}(X_i) + \\sum_{i \\neq j} \\text{Cov}(X_i, X_j) $$\n有 $n$ 个方差项和 $n(n-1)$ 个协方差项。我们需要求出两次不同抽取之间的协方差，即 $i \\neq j$ 时的 $\\text{Cov}(X_i, X_j)$。\n$$ \\text{Cov}(X_i, X_j) = E[X_i X_j] - E[X_i]E[X_j] $$\n我们有 $E[X_i] = p$ 和 $E[X_j] = p$。项 $E[X_i X_j]$ 是第 $i$ 次抽取和第 $j$ 次抽取都成功的概率，即 $P(X_i=1 \\text{ and } X_j=1)$。\n$$ P(X_i=1 \\text{ and } X_j=1) = P(X_i=1) \\times P(X_j=1 | X_i=1) $$\n总体中患病个体的数量是 $Np$。在抽取一个个体患病后（对于 $X_i=1$），在大小为 $N-1$ 的总体中还剩下 $Np-1$ 个患病个体。\n因此，$P(X_j=1 | X_i=1) = \\frac{Np-1}{N-1}$。\n$$ E[X_i X_j] = p \\left( \\frac{Np-1}{N-1} \\right) $$\n现在，我们可以计算协方差：\n$$ \\text{Cov}(X_i, X_j) = p \\left( \\frac{Np-1}{N-1} \\right) - p^2 = \\frac{p(Np-1) - p^2(N-1)}{N-1} = \\frac{Np^2 - p - Np^2 + p^2}{N-1} = \\frac{p^2-p}{N-1} = -\\frac{p(1-p)}{N-1} $$\n负协方差反映了这样一个事实：抽取一个患病个体会降低剩余个体中患病个体的比例，从而使得再次抽到患病个体的可能性变小。\n现在，我们将其代入和的方差公式中：\n$$ \\text{Var}(Y_{\\text{hyper}}) = n \\cdot p(1-p) + n(n-1) \\left( -\\frac{p(1-p)}{N-1} \\right) $$\n提出公因式 $n p(1-p)$：\n$$ \\text{Var}(Y_{\\text{hyper}}) = n p(1-p) \\left( 1 - \\frac{n-1}{N-1} \\right) = n p(1-p) \\left( \\frac{N-1 - (n-1)}{N-1} \\right) = n p(1-p) \\left( \\frac{N-n}{N-1} \\right) $$\n无放回抽样下样本比例的方差是：\n$$ \\text{Var}_{\\text{hyper}}(\\hat{p}) = \\frac{1}{n^2} \\text{Var}(Y_{\\text{hyper}}) = \\frac{1}{n^2} \\left( n p(1-p) \\frac{N-n}{N-1} \\right) = \\frac{p(1-p)}{n} \\left( \\frac{N-n}{N-1} \\right) $$\n\n**3. 方差之比**\n我们需要求的是在无放回抽样下的 $\\hat{p}$ 的方差（真实方差）与在二项模型下的方差（朴素方差）之比。\n$$ \\text{Ratio} = \\frac{\\text{Var}_{\\text{hyper}}(\\hat{p})}{\\text{Var}_{\\text{binom}}(\\hat{p})} = \\frac{\\frac{p(1-p)}{n} \\left( \\frac{N-n}{N-1} \\right)}{\\frac{p(1-p)}{n}} $$\n化简表达式，我们得到：\n$$ \\text{Ratio} = \\frac{N-n}{N-1} $$\n这个项被称为有限总体校正（FPC）因子。注意，这个比率与患病率 $p$ 无关。\n\n**4. 计算比率**\n给定 $N=1000$ 和 $n=200$。计算此值不需要 $p=0.1$。\n$$ \\text{Ratio} = \\frac{1000 - 200}{1000 - 1} = \\frac{800}{999} $$\n现在，我们计算数值并四舍五入到四位有效数字：\n$$ \\frac{800}{999} \\approx 0.800800800... $$\n四舍五入到四位有效数字，比率为 $0.8008$。\n\n**5. 结果解释**\n对于任何样本大小 $n1$，比率 $\\frac{N-n}{N-1}$ 都小于1。在本例中，该比率约为 $0.8008$。这意味着样本比例的真实方差（在无放回抽样下）大约是使用朴素二项模型计算的方差的 $80.08\\%$。\n这意味着二项模型由于假设独立性，高估了真实的抽样变异性。数量 $\\frac{p(1-p)}{n}$ 作为 $\\hat{p}$ 真实方差的估计量是向上偏倚的。偏差的方向是正向的。\n当抽样分数 $f = n/N$ 不可忽略时（此处为 $f = 200/1000 = 0.2$），这种高估可能相当大。使用二项方差进行推断（例如，构建置信区间或进行假设检验）将导致置信区间比必要的更宽，检验的功效更低（即更保守，具有更高的II型错误率），而如果使用正确的、较小的方差则不会如此。", "answer": "$$\\boxed{0.8008}$$", "id": "4895499"}, {"introduction": "除了抽样方案，研究设计本身也常常导致独立性假设失效。本练习 [@problem_id:4895450] 将带你分析整群随机试验，其中同一“集群”内个体的结果往往比不同集群的个体更相似，从而引入了正相关性。你将通过推导方差膨胀因子（或称设计效应），来精确量化这种相关性对估计精度的影响，这是正确分析整群数据和进行样本量计算的关键一步。", "problem": "一项整群随机疫苗效力研究招募了 $J$ 个群组，每个群组大小相等，为 $m$，并记录每位参与者在随访期内是否被感染（$1$）或未被感染（$0$）。令 $X_{ij}$ 表示群组 $j$ 中参与者 $i$ 的伯努利结果，并令 $p$ 表示共同的边际感染概率。二项模型假设试验是独立同分布的伯努利试验，共同成功概率为 $p$，这意味着 $X_{ij}$ 是独立的，其方差为 $\\operatorname{Var}(X_{ij}) = p(1-p)$，且对于所有 $(i,j) \\neq (i',j')$，协方差为 $\\operatorname{Cov}(X_{ij}, X_{i'j'}) = 0$。然而，在整群试验中，同一群组内的结果是相关的。假设在每个群组内，结果具有一个共同的成对相关性，等于组内相关系数（ICC），记为 $\\rho$，并且来自不同群组的结果是独立的。\n\n仅使用方差和协方差的定义以及上述结构，推导在整群抽样下总体样本比例 $\\hat{p}$ 的方差，并将其表示为以下形式\n$$\n\\operatorname{Var}(\\hat{p}) = \\frac{p(1-p)}{n} \\times D,\n$$\n其中 $n = J m$ 是总样本量，$D$ 是由整群抽样引起的乘性方差膨胀因子。然后定义有效样本量 $n_{\\text{eff}}$，使得\n$$\n\\operatorname{Var}(\\hat{p}) = \\frac{p(1-p)}{n_{\\text{eff}}},\n$$\n并用此通过将 $n$ 替换为 $n_{\\text{eff}}$ 来调整 $p$ 的双侧 $95\\%$ 正态近似（Wald）置信区间。\n\n现在考虑以下实现的数据：有 $J = 30$ 个群组，共同的群组大小为 $m = 10$，组内相关系数为 $\\rho = 0.05$，观察到的总感染数为 $x = 120$。基于 $n_{\\text{eff}}$ 计算 $p$ 的双侧 $95\\%$ Wald 置信区间的调整后半宽度 $E$。将你的最终答案表示为小数，并四舍五入到四位有效数字。", "solution": "该问题陈述清晰，具有科学依据，并提供了一套完整且一致的定义和数据。整群随机试验、组内相关系数、方差膨胀因子和有效样本量等概念在生物统计学中是标准概念。因此，该问题被认为是有效的，并将提供解答。\n\n总体样本比例 $\\hat{p}$ 定义为总事件数（感染数）除以总样本量 $n$。\n$$ \\hat{p} = \\frac{1}{n} \\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij} $$\n其中 $n = Jm$ 是参与者总数，$J$ 是群组数，$m$ 是每个群组的大小。变量 $X_{ij}$ 是群组 $j$ 中参与者 $i$ 的伯努利结果。\n\n样本比例 $\\hat{p}$ 的方差由下式给出：\n$$ \\operatorname{Var}(\\hat{p}) = \\operatorname{Var}\\left(\\frac{1}{n} \\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij}\\right) = \\frac{1}{n^2} \\operatorname{Var}\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij}\\right) $$\n随机变量之和的方差是它们所有成对协方差的总和：\n$$ \\operatorname{Var}\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij}\\right) = \\sum_{j=1}^{J} \\sum_{i=1}^{m} \\sum_{j'=1}^{J} \\sum_{i'=1}^{m} \\operatorname{Cov}(X_{ij}, X_{i'j'}) $$\n根据问题的相关性结构，我们可以通过考虑索引对 $(i,j)$ 和 $(i',j')$ 的三种不同情况来分解这个和。\n1.  索引相同：$j=j'$ 且 $i=i'$。在这种情况下，协方差是变量本身的方差：$\\operatorname{Cov}(X_{ij}, X_{ij}) = \\operatorname{Var}(X_{ij}) = p(1-p)$，其中 $p$ 是边际概率。和中有 $n=Jm$ 个这样的项。\n2.  个体不同，但在同一群组内：$j=j'$ 且 $i \\neq i'$。问题陈述，结果具有一个共同的成对相关性，等于组内相关系数 $\\rho$。协方差为 $\\operatorname{Cov}(X_{ij}, X_{i'j}) = \\operatorname{Corr}(X_{ij}, X_{i'j})\\sqrt{\\operatorname{Var}(X_{ij})\\operatorname{Var}(X_{i'j})} = \\rho\\sqrt{p(1-p)p(1-p)} = \\rho p(1-p)$。在 $J$ 个群组中的每一个群组内，有 $m$ 个个体，因此有 $m(m-1)$ 个不同个体的有序对。所有群组中此类对的总数为 $Jm(m-1)$。\n3.  个体在不同群组中：$j \\neq j'$。问题陈述，来自不同群组的结果是独立的，所以它们的协方差为零：$\\operatorname{Cov}(X_{ij}, X_{i'j'}) = 0$。\n\n将所有情况的协方差项相加，得到总和的方差：\n$$ \\operatorname{Var}\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij}\\right) = \\underbrace{Jm \\cdot p(1-p)}_{\\text{情况1：方差}} + \\underbrace{Jm(m-1) \\cdot \\rho p(1-p)}_{\\text{情况2：组内协方差}} + \\underbrace{0}_{\\text{情况3：组间协方差}} $$\n提出公因式 $Jmp(1-p)$ 得：\n$$ \\operatorname{Var}\\left(\\sum_{j=1}^{J} \\sum_{i=1}^{m} X_{ij}\\right) = Jmp(1-p) [1 + (m-1)\\rho] $$\n将此代回 $\\operatorname{Var}(\\hat{p})$ 的表达式中：\n$$ \\operatorname{Var}(\\hat{p}) = \\frac{1}{(Jm)^2} \\left( Jmp(1-p) [1 + (m-1)\\rho] \\right) = \\frac{p(1-p)}{Jm} [1 + (m-1)\\rho] $$\n使用总样本量 $n=Jm$，我们得到整群抽样下的方差：\n$$ \\operatorname{Var}(\\hat{p}) = \\frac{p(1-p)}{n} [1 + (m-1)\\rho] $$\n通过将此结果与指定形式 $\\operatorname{Var}(\\hat{p}) = \\frac{p(1-p)}{n} \\times D$ 进行比较，我们可以确定乘性方差膨胀因子 $D$ 为：\n$$ D = 1 + (m-1)\\rho $$\n这个因子也被称为设计效应（DEFF）。\n\n接下来，我们定义有效样本量 $n_{\\text{eff}}$，使得方差的形式与来自大小为 $n_{\\text{eff}}$ 的简单随机样本的方差相同：\n$$ \\operatorname{Var}(\\hat{p}) = \\frac{p(1-p)}{n_{\\text{eff}}} $$\n将其与我们推导出的方差表达式相等：\n$$ \\frac{p(1-p)}{n_{\\text{eff}}} = \\frac{p(1-p)}{n} [1 + (m-1)\\rho] $$\n假设 $p \\in (0,1)$，我们可以消去两边的 $p(1-p)$ 项，并解出 $n_{\\text{eff}}$：\n$$ n_{\\text{eff}} = \\frac{n}{1 + (m-1)\\rho} = \\frac{n}{D} $$\n$p$ 的调整后双侧 $95\\%$ Wald 置信区间由 $\\hat{p} \\pm E$ 给出，其中 $E$ 是半宽度。我们使用 $\\hat{p}$ 的估计方差，该方差通过用 $\\hat{p}$ 替代 $p$ 并使用 $n_{\\text{eff}}$ 获得。半宽度 $E$ 是：\n$$ E = z_{0.025} \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n_{\\text{eff}}}} $$\n其中 $z_{0.025}$ 是标准正态分布的上 $0.025$ 分位数，我们使用值 $1.96$。\n\n我们给出的数据如下：$J=30$，$m=10$，$\\rho=0.05$，以及总感染数 $x = 120$。\n首先，我们计算总样本量 $n$ 和样本比例 $\\hat{p}$：\n$$ n = Jm = 30 \\times 10 = 300 $$\n$$ \\hat{p} = \\frac{x}{n} = \\frac{120}{300} = 0.4 $$\n接下来，我们计算方差膨胀因子 $D$：\n$$ D = 1 + (m-1)\\rho = 1 + (10-1)(0.05) = 1 + 9 \\times 0.05 = 1 + 0.45 = 1.45 $$\n使用 $D$，我们求出有效样本量 $n_{\\text{eff}}$：\n$$ n_{\\text{eff}} = \\frac{n}{D} = \\frac{300}{1.45} $$\n现在我们可以计算调整后的半宽度 $E$：\n$$ E = 1.96 \\sqrt{\\frac{\\hat{p}(1-\\hat{p})}{n_{\\text{eff}}}} = 1.96 \\sqrt{\\frac{0.4(1-0.4)}{300/1.45}} $$\n$$ E = 1.96 \\sqrt{\\frac{0.24 \\times 1.45}{300}} = 1.96 \\sqrt{\\frac{0.348}{300}} = 1.96 \\sqrt{0.00116} $$\n进行最后的计算：\n$$ E \\approx 1.96 \\times 0.03405877... \\approx 0.06675519... $$\n将结果四舍五入到四位有效数字，得到 $0.06676$。", "answer": "$$\\boxed{0.06676}$$", "id": "4895450"}, {"introduction": "本练习 [@problem_id:4895480] 将挑战另一个核心假设：成功概率 $p$ 的恒定性，这在存在生物异质性的场景中尤其重要。我们将使用一个分层的贝塔-二项模型，其中每个观测单元的成功概率 $p$ 本身被视为一个随机变量。通过推导该模型的性质，你将揭示底层概率的异质性如何导致数据呈现“过度离散”，并理解其与内部相关性之间的深刻联系。", "problem": "一位生物统计学家正在评估一项微生物定植队列研究中，从每个个体收集的重复二元结果。标准二项模型假设，对于给定个体，$n \\in \\mathbb{N}$ 次试验是在固定成功概率 $p \\in (0,1)$ 下的条件独立同分布的伯努利 (Bernoulli) 结果，因此 $n$ 次试验中的总成功次数 $X$ 将服从二项分布。在实践中，生物异质性可能会违反固定 $p$ 值的假设：在个体内部，由于未观测到的因素，潜在的成功概率 $p$ 可能会随天变化，从而在试验之间引发正相关。为捕捉此现象，考虑分层模型，其中参数 $\\alpha0$ 和 $\\beta0$ 下 $p \\sim \\mathrm{Beta}(\\alpha,\\beta)$，且 $X \\mid p \\sim \\mathrm{Binomial}(n,p)$。\n\n从基本定义和定律（二项模型假设、给定 $p$ 的条件独立性、全期望定律和全方差定律）出发，推导所得贝塔-二项分布的边际均值 $\\mathbb{E}[X]$ 和边际方差 $\\mathrm{Var}(X)$ 关于 $n$、$\\alpha$ 和 $\\beta$ 的封闭式表达式。然后，将该模型的组内相关系数 (ICC) $\\rho$ 定义为同一个体内两个不同试验指标之间的相关性，并仅用 $\\alpha$ 和 $\\beta$ 表示 $\\rho$。\n\n将您的最终表达式以包含 $\\mathbb{E}[X]$、$\\mathrm{Var}(X)$ 和 $\\rho$ 的单个解析行向量形式给出。无需进行数值近似或四舍五入。", "solution": "该问题定义明确，并在概率论和生物统计学中有坚实的科学基础。我们的任务是推导贝塔-二项模型的边际均值、边际方差和组内相关性。该模型被分层指定如下：\n$$X \\mid p \\sim \\mathrm{Binomial}(n, p)$$\n$$p \\sim \\mathrm{Beta}(\\alpha, \\beta)$$\n其中 $n \\in \\mathbb{N}$ 是试验次数，$\\alpha  0$、$\\beta  0$ 是成功概率 $p$ 的贝塔先验分布的参数。\n\n首先，我们回顾构成分布的矩。\n对于二项分布，$X$ 在给定 $p$ 下的条件均值和方差为：\n$$\\mathbb{E}[X \\mid p] = np$$\n$$\\mathrm{Var}(X \\mid p) = np(1-p)$$\n对于贝塔分布，当 $p \\in (0,1)$ 时，其概率密度函数为 $f(p; \\alpha, \\beta) = \\frac{p^{\\alpha-1}(1-p)^{\\beta-1}}{B(\\alpha, \\beta)}$，其中 $B(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha)\\Gamma(\\beta)}{\\Gamma(\\alpha+\\beta)}$ 是贝塔函数。$p$ 的前两个原点矩是：\n$$\\mathbb{E}[p] = \\frac{\\alpha}{\\alpha+\\beta}$$\n$$\\mathbb{E}[p^2] = \\frac{\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)}$$\n由此，$p$ 的方差为：\n$$\\mathrm{Var}(p) = \\mathbb{E}[p^2] - (\\mathbb{E}[p])^2 = \\frac{\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)} - \\left(\\frac{\\alpha}{\\alpha+\\beta}\\right)^2 = \\frac{\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n\n在确定了这些性质之后，我们可以推导 $X$ 的边际矩。\n\n**边际均值 $\\mathbb{E}[X]$**\n我们使用全期望定律：$\\mathbb{E}[X] = \\mathbb{E}[\\mathbb{E}[X \\mid p]]$。\n代入 $X$ 的条件均值：\n$$\\mathbb{E}[X] = \\mathbb{E}[np] = n\\mathbb{E}[p]$$\n使用贝塔分布的均值：\n$$\\mathbb{E}[X] = n \\frac{\\alpha}{\\alpha+\\beta}$$\n\n**边际方差 $\\mathrm{Var}(X)$**\n我们使用全方差定律：$\\mathrm{Var}(X) = \\mathbb{E}[\\mathrm{Var}(X \\mid p)] + \\mathrm{Var}(\\mathbb{E}[X \\mid p])$。我们分别计算每一项。\n\n第一项：$\\mathbb{E}[\\mathrm{Var}(X \\mid p)]$\n$$\\mathrm{Var}(X \\mid p) = np(1-p) = np - np^2$$\n对 $p$ 取期望：\n$$\\mathbb{E}[\\mathrm{Var}(X \\mid p)] = \\mathbb{E}[np - np^2] = n\\mathbb{E}[p] - n\\mathbb{E}[p^2]$$\n代入贝塔分布的前两个矩：\n$$\\mathbb{E}[\\mathrm{Var}(X \\mid p)] = n\\frac{\\alpha}{\\alpha+\\beta} - n\\frac{\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)}$$\n$$= \\frac{n\\alpha(\\alpha+\\beta+1) - n\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)} = \\frac{n\\alpha(\\alpha+\\beta+1 - \\alpha - 1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)} = \\frac{n\\alpha\\beta}{(\\alpha+\\beta)(\\alpha+\\beta+1)}$$\n\n第二项：$\\mathrm{Var}(\\mathbb{E}[X \\mid p])$\n$$\\mathbb{E}[X \\mid p] = np$$\n方差是关于 $p$ 计算的：\n$$\\mathrm{Var}(\\mathbb{E}[X \\mid p]) = \\mathrm{Var}(np) = n^2\\mathrm{Var}(p)$$\n代入贝塔分布的方差：\n$$\\mathrm{Var}(\\mathbb{E}[X \\mid p]) = n^2 \\frac{\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n\n现在，我们将两项相加得到 $\\mathrm{Var}(X)$：\n$$\\mathrm{Var}(X) = \\frac{n\\alpha\\beta}{(\\alpha+\\beta)(\\alpha+\\beta+1)} + \\frac{n^2\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n为简化，我们找到公分母并提出公因子：\n$$\\mathrm{Var}(X) = \\frac{n\\alpha\\beta(\\alpha+\\beta) + n^2\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)} = \\frac{n\\alpha\\beta((\\alpha+\\beta) + n)}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n$$\\mathrm{Var}(X) = \\frac{n\\alpha\\beta(n+\\alpha+\\beta)}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n\n**组内相关系数 (ICC) $\\rho$**\nICC，$\\rho$，定义为两个不同试验指标之间的相关性。设 $Y_i$ 为第 $i$ 次试验的伯努利指标，其中 $i=1, \\dots, n$，使得 $X = \\sum_{i=1}^n Y_i$。给定 $p$，各次试验是独立的，因此对所有 $i$ 都有 $Y_i \\mid p \\sim \\mathrm{Bernoulli}(p)$。\nICC 是 $\\rho = \\mathrm{Corr}(Y_i, Y_j)$，其中 $i \\neq j$。根据定义：\n$$\\rho = \\frac{\\mathrm{Cov}(Y_i, Y_j)}{\\sqrt{\\mathrm{Var}(Y_i)\\mathrm{Var}(Y_j)}}$$\n由于各次试验是同分布的（可交换的），$\\mathrm{Var}(Y_i) = \\mathrm{Var}(Y_j)$，所以分母就是 $\\mathrm{Var}(Y_i)$。\n\n首先，我们求边际方差 $\\mathrm{Var}(Y_i)$。$Y_i$ 的边际均值是：\n$$\\mathbb{E}[Y_i] = \\mathbb{E}[\\mathbb{E}[Y_i \\mid p]] = \\mathbb{E}[p] = \\frac{\\alpha}{\\alpha+\\beta}$$\n由于 $Y_i$ 是一个伯努利随机变量（边际上，它取值为 $0$ 或 $1$），其方差为：\n$$\\mathrm{Var}(Y_i) = \\mathbb{E}[Y_i](1-\\mathbb{E}[Y_i]) = \\frac{\\alpha}{\\alpha+\\beta} \\left(1-\\frac{\\alpha}{\\alpha+\\beta}\\right) = \\frac{\\alpha\\beta}{(\\alpha+\\beta)^2}$$\n\n接下来，我们求 $i \\neq j$ 时的协方差 $\\mathrm{Cov}(Y_i, Y_j)$：\n$$\\mathrm{Cov}(Y_i, Y_j) = \\mathbb{E}[Y_i Y_j] - \\mathbb{E}[Y_i]\\mathbb{E}[Y_j]$$\n我们已知 $\\mathbb{E}[Y_i] = \\mathbb{E}[Y_j] = \\frac{\\alpha}{\\alpha+\\beta}$。我们需要求 $\\mathbb{E}[Y_i Y_j]$。使用全期望定律：\n$$\\mathbb{E}[Y_i Y_j] = \\mathbb{E}[\\mathbb{E}[Y_i Y_j \\mid p]]$$\n给定 $p$，试验 $Y_i$ 和 $Y_j$ 是独立的。因此：\n$$\\mathbb{E}[Y_i Y_j \\mid p] = \\mathbb{E}[Y_i \\mid p]\\mathbb{E}[Y_j \\mid p] = p \\cdot p = p^2$$\n因此，\n$$\\mathbb{E}[Y_i Y_j] = \\mathbb{E}[p^2] = \\frac{\\alpha(\\alpha+1)}{(\\alpha+\\beta)(\\alpha+\\beta+1)}$$\n现在，我们可以计算协方差：\n$$\\mathrm{Cov}(Y_i, Y_j) = \\mathbb{E}[p^2] - (\\mathbb{E}[p])^2 = \\mathrm{Var}(p) = \\frac{\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$$\n\n最后，我们将协方差除以方差来计算 $\\rho$：\n$$\\rho = \\frac{\\mathrm{Cov}(Y_i, Y_j)}{\\mathrm{Var}(Y_i)} = \\frac{\\frac{\\alpha\\beta}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}}{\\frac{\\alpha\\beta}{(\\alpha+\\beta)^2}} = \\frac{1}{\\alpha+\\beta+1}$$\n$\\rho$ 的这个表达式仅依赖于 $\\alpha$ 和 $\\beta$，符合要求。它表示单次观测的总方差中，可归因于潜在成功概率 $p$ 的方差的比例。\n\n最终结果是 $\\mathbb{E}[X] = \\frac{n\\alpha}{\\alpha+\\beta}$、$\\mathrm{Var}(X) = \\frac{n\\alpha\\beta(n+\\alpha+\\beta)}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}$ 和 $\\rho = \\frac{1}{\\alpha+\\beta+1}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{n\\alpha}{\\alpha+\\beta}  \\frac{n\\alpha\\beta(n+\\alpha+\\beta)}{(\\alpha+\\beta)^2(\\alpha+\\beta+1)}  \\frac{1}{\\alpha+\\beta+1}\n\\end{pmatrix}\n}\n$$", "id": "4895480"}]}