{"hands_on_practices": [{"introduction": "假设检验是生物统计学的基石，而 $t$ 检验是其中最经典和常用的工具之一。本练习将带你深入剖析一个配对 $t$ 检验的完整流程，从建立零假设和备择假设，到选择检验统计量并推导其零分布。通过这个实践，你不仅将掌握计算步骤，更将深刻理解双侧 $p$ 值的概念意义及其在更普适的非对称分布下的推广，从而夯实参数假设检验的理论基础。[@problem_id:4954547]", "problem": "一项随机交叉研究评估了一种新的饮食干预是否会改变成年人空腹低密度脂蛋白胆固醇水平。对于每位参与者，记录其在干预期和对照期间的空腹低密度脂蛋白胆固醇的差异。假设配对差异是独立的，并服从方差未知的正态分布。给定样本量 $n = 27$，样本均值差异 $\\bar{d} = 10$ (单位：mg/dL)，以及样本标准差 $s = 10\\sqrt{\\frac{27}{26}}$ (单位：mg/dL)。\n\n从生物统计学中假设检验的核心定义出发，按以下步骤进行：定义双侧均值差异检验的原假设和备择假设；指定一个适用于正态性下方差未知的检验统计量，并证明其零分布；根据给定的样本统计数据计算检验统计量的观测值；说明双侧 $p$ 值的概念性含义以及如何根据零分布计算它；并阐明当所选检验统计量的零分布不对称（即，不关于零对称）时，“双侧性”的定义如何推广。\n\n最后，将此研究的双侧 $p$ 值表示为正则化不完全贝塔函数 $I_{x}(a,b)$ 的单一精确闭式解析表达式，并代入所有数值参数。无需进行数值计算。你的最终答案必须是唯一的解析表达式，不带单位。", "solution": "首先对问题陈述进行验证。\n\n### 第1步：提取已知条件\n-   研究类型：随机交叉研究。\n-   测量指标：每位参与者在干预期和对照期间的空腹低密度脂蛋白胆固醇差异。\n-   假设：配对差异是独立的，并服从方差未知的正态分布。\n-   样本量：$n = 27$。\n-   样本均值差异：$\\bar{d} = 10$ mg/dL。\n-   样本标准差：$s = 10\\sqrt{\\frac{27}{26}}$ mg/dL。\n-   任务1：定义双侧均值差异检验的原假设和备择假设。\n-   任务2：指定一个适用于正态性下方差未知的检验统计量，并证明其零分布。\n-   任务3：计算检验统计量的观测值。\n-   任务4：说明双侧 $p$ 值的概念性含义以及如何根据零分布计算它。\n-   任务5：阐明当所选检验统计量的零分布不对称时，“双侧性”的定义如何推广。\n-   任务6：将双侧 $p$ 值表示为正则化不完全贝塔函数 $I_{x}(a,b)$ 的单一精确闭式解析表达式。\n\n### 第2步：使用提取的已知条件进行验证\n该问题具有科学依据，在现实情境（胆固醇的交叉试验）中采用了标准的生物统计学方法（配对t检验）。该问题提法得当，提供了执行所要求的假设检验并推导相关量所需的所有必要数据（$n$, $\\bar{d}$, $s$）和假设（正态性，独立性）。其语言客观、精确。数据是自洽且一致的；$s$ 的具体形式在数学上是有效的，并且似乎是为了简化检验统计量的计算而设计的，这并不会使问题无效，反而使其成为一个结构良好的学术练习。该问题并非提法不当、微不足道或无法验证。它直接考察了假设检验的基础知识。\n\n### 第3步：结论与行动\n问题有效。将提供完整的解答。\n\n***\n\n解答过程按照问题陈述中概述的各项任务进行。\n\n**1. 原假设与备择假设**\n\n假设检验始于构建两个相互竞争的假设。设 $\\mu_d$ 代表空腹低密度脂蛋白胆固醇配对差异的真实总体均值，其中差异计算为（干预）-（对照）。\n\n-   **原假设 ($H_0$)** 是关于无效果的陈述。它假定新的饮食干预对平均胆固醇水平没有影响，即真实均值差异为零。\n    $$H_0: \\mu_d = 0$$\n-   对于双侧检验，**备择假设 ($H_A$)** 是关于有效果的陈述。它假定干预确实有影响，导致真实均值差异不为零，但未指明变化的方向。\n    $$H_A: \\mu_d \\neq 0$$\n\n**2. 检验统计量与零分布**\n\n问题陈述配对差异样本来自一个方差未知的正态分布。样本量为 $n = 27$。对于检验来自方差未知的正态分布总体的均值假设，适用的检验统计量是单样本学生t统计量。\n\n该统计量定义为：\n$$T = \\frac{\\bar{d} - \\mu_{d,0}}{S_E}$$\n其中 $\\bar{d}$ 是样本均值差异，$\\mu_{d,0}$ 是在 $H_0$ 下假设的总体均值差异，$S_E$ 是样本均值的标准误。标准误计算为 $S_E = \\frac{s}{\\sqrt{n}}$，其中 $s$ 是样本标准差，$n$ 是样本量。\n\n在原假设 ($H_0: \\mu_d = 0$) 下，该统计量变为：\n$$T = \\frac{\\bar{d}}{s / \\sqrt{n}}$$\n根据学生t分布的定义，该统计量 $T$ 服从自由度为 $\\nu = n-1$ 的t分布。对于本研究，自由度为 $\\nu = 27 - 1 = 26$。该分布是适用的，因为它考虑了通过样本数据估计总体方差所引入的额外不确定性。\n\n**3. 检验统计量的观测值**\n\n使用给定的样本统计数据，我们计算检验统计量的观测值，记为 $t_{obs}$。\n-   样本量：$n = 27$。\n-   样本均值差异：$\\bar{d} = 10$。\n-   样本标准差：$s = 10\\sqrt{\\frac{27}{26}}$。\n\n首先，我们计算均值的标准误：\n$$S_E = \\frac{s}{\\sqrt{n}} = \\frac{10\\sqrt{\\frac{27}{26}}}{\\sqrt{27}} = \\frac{10 \\cdot \\frac{\\sqrt{27}}{\\sqrt{26}}}{\\sqrt{27}} = \\frac{10}{\\sqrt{26}}$$\n现在，我们计算观测到的t统计量：\n$$t_{obs} = \\frac{\\bar{d}}{S_E} = \\frac{10}{10/\\sqrt{26}} = \\sqrt{26}$$\n\n**4. 双侧 $p$ 值的概念性含义与计算**\n\n从概念上讲，**$p$ 值**是在原假设为真的前提下，观测到至少与实际观测到的检验统计量一样极端或更极端的检验统计量的概率。“极端”的定义由备择假设决定。\n\n对于**双侧检验**，“极端”意味着在任一方向（正向或负向）上远离零分布的中心。t分布的中心是 $0$。因此，双侧 $p$ 值是在零分布 ($T \\sim t_{26}$) 下，检验统计量的绝对值大于或等于观测到的检验统计量的绝对值 ($|t_{obs}|$) 的概率。\n$$p\\text{-value} = P(|T| \\ge |t_{obs}| \\mid H_0)$$\n由于t分布关于 $0$ 对称，这个概率可以通过计算单侧尾部的概率再乘以2来得到：\n$$p\\text{-value} = P(T \\ge |t_{obs}|) + P(T \\le -|t_{obs}|) = 2 \\times P(T \\ge |t_{obs}|)$$\n对于本研究，当 $t_{obs} = \\sqrt{26}$ 时，$p$ 值为 $2 \\times P(T \\ge \\sqrt{26})$，其中 $T \\sim t_{26}$。\n\n**5. “双侧性”到不对称分布的推广**\n\n对于零分布关于 $0$ 对称（例如，正态分布、t分布）的检验统计量，“等尾”法 ($2 \\times P(T \\ge |t_{obs}|)$) 是明确的。然而，对于不对称的零分布（例如，卡方分布、F分布），“双侧性”的概念没有统一的定义。核心原则保持不变：$p$ 值是所有至少与观测结果一样不可能发生的事件的概率之和。\n\n最有原则的推广是**概率密度法**。设 $f(x)$ 是在原假设下检验统计量 $X$ 的概率密度函数 (PDF)，并设 $x_{obs}$ 是观测值。比 $x_{obs}$ “一样或更极端”的结果集合定义为所有概率密度小于或等于观测值处密度的 $x$ 值的集合，即 $\\{x \\mid f(x) \\le f(x_{obs})\\}$。 $p$ 值是 PDF 在此集合上的积分：\n$$p\\text{-value} = \\int_{\\{x \\mid f(x) \\le f(x_{obs})\\}} f(x) \\, dx$$\n对于单峰分布，这个集合通常由两个不相交的尾部组成，从而保留了检验的“双侧”性质。这个定义确保了任何具有相等或更小发生概率的结果都对 $p$ 值有贡献。\n\n**6. 使用正则化不完全贝塔函数的 $p$ 值表达式**\n\n最后的任务是将双侧 $p$ 值，$p = 2 \\times P(T \\ge \\sqrt{26})$ 其中 $T \\sim t_{26}$，用正则化不完全贝塔函数 $I_{x}(a,b)$ 表示。\n\n自由度为 $\\nu$ 的学生t分布的累积分布函数 (CDF)，对于一个正值 $t$，与 $I_{x}(a,b)$ 通过以下公式相关联：\n$$P(T_\\nu \\le t) = 1 - \\frac{1}{2} I_{z}\\left(\\frac{\\nu}{2}, \\frac{1}{2}\\right)$$\n其中 $z = \\frac{\\nu}{\\nu + t^2}$。\n\n因此，上尾概率为：\n$$P(T_\\nu \\ge t) = 1 - P(T_\\nu  t) = 1 - P(T_\\nu \\le t) = 1 - \\left(1 - \\frac{1}{2} I_{z}\\left(\\frac{\\nu}{2}, \\frac{1}{2}\\right)\\right) = \\frac{1}{2} I_{z}\\left(\\frac{\\nu}{2}, \\frac{1}{2}\\right)$$\n双侧 $p$ 值是此尾部概率的两倍：\n$$p = 2 \\times P(T_\\nu \\ge t) = 2 \\times \\left(\\frac{1}{2} I_{z}\\left(\\frac{\\nu}{2}, \\frac{1}{2}\\right)\\right) = I_{z}\\left(\\frac{\\nu}{2}, \\frac{1}{2}\\right)$$\n我们代入此问题中的具体数值：\n-   自由度：$\\nu = 26$。\n-   观测统计量：$t_{obs} = \\sqrt{26}$。\n-   贝塔函数的参数：$a = \\frac{\\nu}{2} = \\frac{26}{2} = 13$ 和 $b = \\frac{1}{2}$。\n-   贝塔函数的自变量：$z = \\frac{\\nu}{\\nu + t_{obs}^2} = \\frac{26}{26 + (\\sqrt{26})^2} = \\frac{26}{26 + 26} = \\frac{26}{52} = \\frac{1}{2}$。\n\n将这些值代入 $p$ 值的表达式中，得到最终的解析形式。\n$$p = I_{\\frac{1}{2}}\\left(13, \\frac{1}{2}\\right)$$", "answer": "$$\\boxed{I_{\\frac{1}{2}}\\left(13, \\frac{1}{2}\\right)}$$", "id": "4954547"}, {"introduction": "当我们无法确定数据是否满足正态分布等参数化假设时，应该怎么办？随机化检验（或称置换检验）提供了一种强大且无需分布假设的替代方法。此方法的美妙之处在于，其有效性直接源于实验设计本身的随机分配机制。在这个动手编程练习中，你将学习“尖锐零假设”的概念，并通过模拟随机分配来构建检验统计量的零分布，亲身体验如何从数据和设计中直接获得统计推断的依据。[@problem_id:4954539]", "problem": "给定一个完全随机设计的随机试验：$n$名参与者中，恰好有$m$名被分配到处理组，其余$n-m$名被分配到对照组。在“无处理效应”的尖锐零假设下，每位参与者在处理条件下的结果等于其在对照条件下的结果。任务是实现并执行一个随机化检验，该检验利用已知的分配机制来生成均值差异的零分布，然后计算双边$p$值。\n\n起点和核心定义：\n- 试验有$n$个单元，索引为$i \\in \\{1,\\dots,n\\}$，具有观测结果$Y_i$和二元分配指示符$Z_i \\in \\{0,1\\}$，其中$Z_i=1$表示处理。\n- “无处理效应”的尖锐零假设陈述为：对所有$i$，都有$Y_i(1)=Y_i(0)$。这意味着在零假设下，观测结果$Y_i$对于重新分配是不变的。\n- 在完全随机设计中，分配机制通过从$\\binom{n}{m}$个可能的、恰好包含$m$个1的二元分配向量$\\mathbf{Z}$中均匀随机地选择一个来分配处理标签。\n- 检验统计量是均值差异，\n$$\nT(\\mathbf{Z}, \\mathbf{Y}) \\;=\\; \\overline{Y}_{\\text{treated}} - \\overline{Y}_{\\text{control}} \\;=\\; \\frac{1}{m}\\sum_{i:Z_i=1}Y_i \\;-\\; \\frac{1}{n-m}\\sum_{i:Z_i=0}Y_i.\n$$\n- 在零假设下，$T(\\mathbf{Z}, \\mathbf{Y})$的随机化分布是通过从分配机制中枚举（或抽样）分配向量$\\mathbf{Z}'$，并使用固定的观测结果$\\mathbf{Y}$来计算$T(\\mathbf{Z}', \\mathbf{Y})$而生成的。\n- 双边$p$值是在零分布下观测到至少与观测到的检验统计量一样极端的检验统计量的尾部概率，计算为满足$\\left|T(\\mathbf{Z}', \\mathbf{Y})\\right| \\ge \\left|T(\\mathbf{Z}, \\mathbf{Y})\\right|$的分配所占的比例。为确保蒙特卡洛近似的有效性，请使用加一调整：如果使用了$B$次零分布抽样，则报告$\\frac{c+1}{B+1}$，其中$c$是其极端程度至少与观测统计量相当的抽样次数。\n\n实现假设检验的以下步骤：\n1. 陈述假设：$H_0$（尖锐零假设）对$H_1$（存在至少一个单元满足$Y_i(1)\\ne Y_i(0)$）。\n2. 选择上文定义的检验统计量$T(\\mathbf{Z}, \\mathbf{Y})$。\n3. 当精确枚举在计算上不可行时，通过对所有$\\binom{n}{m}$种分配进行精确枚举或对$B$种分配进行蒙特卡洛抽样，使用分配机制来构建$T$的零分布。\n4. 使用零分布计算双边$p$值，并在使用抽样时应用加一调整。\n5. 将$p$值报告为小数（而非百分比）。不涉及物理单位。\n\n你的程序必须实现此过程，并将其应用于下面的测试套件。对于每种情况，生成双边随机化检验的$p$值。如果指定了精确枚举，则枚举完全随机设计中的所有分配；如果指定了蒙特卡洛抽样，则使用提供的$B$和随机种子。\n\n测试套件：\n- 情况1（精确，小$n$）：\n  - $Y = [5.1, 4.9, 5.0, 5.3, 5.2, 5.4]$\n  - $Z = [1, 1, 1, 0, 0, 0]$\n  - 方法：精确\n- 情况2（蒙特卡洛，大$n$）：\n  - $Y = [10.2, 9.8, 10.0, 9.5, 10.4, 9.7, 10.3, 9.6, 10.1, 9.9, 8.8, 9.0, 9.2, 8.9, 9.1, 8.7, 9.3, 8.6, 9.4, 8.5]$\n  - $Z = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]$\n  - 方法：蒙特卡洛抽样，使用$B=20000$次抽样和种子$123$\n- 情况3（精确，零差异边界）：\n  - $Y = [1.0, 2.0, 1.0, 2.0]$\n  - $Z = [1, 0, 0, 1]$\n  - 方法：精确\n- 情况4（精确，非均衡分配）：\n  - $Y = [12.0, 10.0, 11.0, 9.0, 8.0, 13.0, 7.0]$\n  - $Z = [1, 1, 0, 0, 0, 0, 0]$\n  - 方法：精确\n- 情况5（精确，强效应）：\n  - $Y = [20.0, 21.0, 19.0, 22.0, 5.0, 6.0, 7.0, 4.0]$\n  - $Z = [1, 1, 1, 1, 0, 0, 0, 0]$\n  - 方法：精确\n\n输出规范：\n- 为每种情况计算双边随机化检验的$p$值。\n- 将每个$p$值表示为小数，并四舍五入到$6$位小数。\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如[$p_1, p_2, p_3, p_4, p_5$]，其中$p_j$表示按上文所列顺序的第$j$种情况的$p$值。", "solution": "该问题要求在完全随机试验中，为检验“无处理效应”的尖锐零假设，实现一个随机化检验以计算双边$p$值。解决方案涉及定义统计框架、计算观测到的检验统计量、在指定的分配机制下生成该统计量的零分布，并最终计算$p$值。\n\n### 基于原则的设计\n\n**1. 假设与形式化设置**\n\n实验设置包含$n$个单元，我们为其观测一个结果向量$\\mathbf{Y} = (Y_1, \\dots, Y_n)$和一个处理分配向量$\\mathbf{Z} = (Z_1, \\dots, Z_n)$。如果单元$i$在处理组中，分配指示符$Z_i$为$1$，如果在对照组中则为$0$。在一个有$m$个处理单元的完全随机设计中，分配向量$\\mathbf{Z}$是从所有长度为$n$且恰好包含$m$个1的二元向量集合中随机抽取的。此类分配的总数为$\\binom{n}{m}$。\n\n潜在结果框架为每个单元$i$定义了两个结果：$Y_i(1)$，即接受处理时的结果，以及$Y_i(0)$，即未接受处理时的结果。观测到的结果是$Y_i = Z_i Y_i(1) + (1-Z_i)Y_i(0)$。\n\n待检验的假设是：\n- **零假设 ($H_0$)**：“无处理效应”的尖锐零假设，该假设陈述为：对于每个单元$i$，处理均无效果。形式上，即$H_0: Y_i(1) = Y_i(0)$，对所有$i \\in \\{1, \\dots, n\\}$成立。\n- **备择假设 ($H_1$)**：尖锐零假设的否定，该假设断定：至少存在一个单元$i$，处理对其有效果。形式上，即$H_1: \\exists i \\text{ 使得 } Y_i(1) \\neq Y_i(0)$。\n\n尖锐零假设的一个关键推论是，观测结果$Y_i$是固定的，并且无论处理分配如何都会保持不变。也就是说，在$H_0$下，$Y_i = Y_i(1) = Y_i(0)$。这种不变性使我们可以在评估不同假设性分配的效果时，将向量$\\mathbf{Y}$视为一组固定的数字。\n\n**2. 检验统计量**\n\n所选的检验统计量是处理组和对照组之间平均结果的差异：\n$$\nT(\\mathbf{Z}, \\mathbf{Y}) = \\overline{Y}_{\\text{treated}} - \\overline{Y}_{\\text{control}} = \\frac{\\sum_{i:Z_i=1} Y_i}{m} - \\frac{\\sum_{i:Z_i=0} Y_i}{n-m}\n$$\n其中$m = \\sum_{i=1}^n Z_i$是处理单元的数量，$n-m$是对照单元的数量。我们首先使用每个测试用例中提供的数据，计算该统计量的观测值$T_{\\text{obs}} = T(\\mathbf{Z}_{\\text{obs}}, \\mathbf{Y}_{\\text{obs}})$。\n\n**3. 零分布的构建**\n\n随机化检验的核心逻辑是在零假设下生成检验统计量$T$的分布。由于$H_0$意味着结果$\\mathbf{Y}$是固定的，唯一的随机性来源是分配向量$\\mathbf{Z}$。因此，零分布由所有可能通过分配机制实现的分配向量$\\mathbf{Z}'$所对应的$T(\\mathbf{Z}', \\mathbf{Y})$值组成。\n\n根据问题规定，有两种方法可以构建此分布：\n\n- **精确枚举**：如果可能分配的数量$\\binom{n}{m}$在计算上是可处理的，我们可以枚举所有这些分配。对于每个可能的分配向量$\\mathbf{Z}'$，我们计算相应的统计量$T' = T(\\mathbf{Z}', \\mathbf{Y})$。所有这些$T'$值的集合$\\{T'\\}$构成了精确的零分布。这涉及从$n$个索引中生成所有$m$个索引的组合，以代表处理组。\n\n- **蒙特卡洛抽样**：当$\\binom{n}{m}$太大而无法完全枚举时，我们通过从所有可能的分配集合中抽取大量的（$B$个）随机分配$\\mathbf{Z}'_1, \\mathbf{Z}'_2, \\dots, \\mathbf{Z}'_B$来近似零分布。对于每次抽样$\\mathbf{Z}'_j$，我们计算统计量$T'_j = T(\\mathbf{Z}'_j, \\mathbf{Y})$。这$B$个统计量的经验分布可作为真实零分布的近似。随机分配是通过获取观测到的分配向量$\\mathbf{Z}_{\\text{obs}}$并随机排列其元素来生成的。使用随机种子可确保可复现性。\n\n**4. P值计算**\n\n双边$p$值是在零假设下，观测到一个至少与实际观测到的检验统计量一样极端的检验统计量的概率。“极端”是通过绝对值来衡量的。\n\n对于**精确方法**，$p$值是零分布中其检验统计量在量级上至少与观测统计量一样大的分配所占的比例：\n$$\np = \\frac{\\left| \\{ \\mathbf{Z}' : |T(\\mathbf{Z}', \\mathbf{Y})| \\ge |T_{\\text{obs}}| \\} \\right|}{\\binom{n}{m}}\n$$\n其中$|\\cdot|$表示集合的基数。\n\n对于**蒙特卡洛方法**，$p$值是使用$B$个模拟统计量来估计的。我们计算模拟统计量至少与观测统计量一样极端的模拟次数$c$：$c = \\sum_{j=1}^B \\mathbb{I}(|T'_j| \\ge |T_{\\text{obs}}|)$，其中$\\mathbb{I}(\\cdot)$是指示函数。问题指定使用加一调整（或连续性校正），以避免报告$p$值为$0$，并改善统计特性，特别是对于较小的$B$：\n$$\np = \\frac{c+1}{B+1}\n$$\n\n整个过程在一个Python函数中实现，该函数将观测数据和过程参数作为输入，并返回按规定四舍五入的计算出的$p$值。", "answer": "```python\nimport numpy as np\nimport itertools\n\ndef compute_statistic(Y, Z):\n    \"\"\"\n    Computes the difference in means between treated and control groups.\n    Y: array of observed outcomes.\n    Z: binary assignment vector (1=treatment, 0=control).\n    \"\"\"\n    m = np.sum(Z)\n    n = len(Y)\n    \n    # The problem constraints ensure that m > 0 and n-m > 0.\n    mean_treated = np.sum(Y * Z) / m\n    mean_control = np.sum(Y * (1 - Z)) / (n - m)\n    \n    return mean_treated - mean_control\n\ndef calculate_p_value(Y, Z_obs, method, B=None, seed=None):\n    \"\"\"\n    Calculates the randomization test p-value for the sharp null hypothesis.\n    \"\"\"\n    n = len(Y)\n    m = int(np.sum(Z_obs))\n    \n    t_obs = compute_statistic(Y, Z_obs)\n    abs_t_obs = np.abs(t_obs)\n\n    if method == 'exact':\n        indices = np.arange(n)\n        null_stats = []\n        \n        # Generate all combinations of m indices for the treatment group\n        for treat_indices in itertools.combinations(indices, m):\n            Z_prime = np.zeros(n, dtype=int)\n            Z_prime[list(treat_indices)] = 1\n            t_prime = compute_statistic(Y, Z_prime)\n            null_stats.append(t_prime)\n            \n        null_stats = np.array(null_stats)\n        # To handle potential floating point inaccuracies, a small tolerance is used.\n        # abs_t_obs - 1e-9 ensures that values equal to abs_t_obs are included.\n        count_extreme = np.sum(np.abs(null_stats) >= abs_t_obs - 1e-9)\n        p_value = count_extreme / len(null_stats)\n        \n    elif method == 'Monte Carlo':\n        # Legacy random number generation for reproducibility as per common practice\n        # when a simple seed is specified.\n        np.random.seed(seed)\n        count_extreme = 0\n        \n        for _ in range(B):\n            # A new random assignment is a random permutation of the observed one.\n            Z_prime = np.random.permutation(Z_obs)\n            t_prime = compute_statistic(Y, Z_prime)\n            if np.abs(t_prime) >= abs_t_obs - 1e-9:\n                count_extreme += 1\n        \n        p_value = (count_extreme + 1) / (B + 1)\n        \n    return p_value\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (exact, small n)\n        {'Y': np.array([5.1, 4.9, 5.0, 5.3, 5.2, 5.4]),\n         'Z': np.array([1, 1, 1, 0, 0, 0]),\n         'method': 'exact', 'B': None, 'seed': None},\n        # Case 2 (Monte Carlo, larger n)\n        {'Y': np.array([10.2, 9.8, 10.0, 9.5, 10.4, 9.7, 10.3, 9.6, 10.1, 9.9,\n                        8.8, 9.0, 9.2, 8.9, 9.1, 8.7, 9.3, 8.6, 9.4, 8.5]),\n         'Z': np.array([1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),\n         'method': 'Monte Carlo', 'B': 20000, 'seed': 123},\n        # Case 3 (exact, zero difference boundary)\n        {'Y': np.array([1.0, 2.0, 1.0, 2.0]),\n         'Z': np.array([1, 0, 0, 1]),\n         'method': 'exact', 'B': None, 'seed': None},\n        # Case 4 (exact, unbalanced allocation)\n        {'Y': np.array([12.0, 10.0, 11.0, 9.0, 8.0, 13.0, 7.0]),\n         'Z': np.array([1, 1, 0, 0, 0, 0, 0]),\n         'method': 'exact', 'B': None, 'seed': None},\n        # Case 5 (exact, strong effect)\n        {'Y': np.array([20.0, 21.0, 19.0, 22.0, 5.0, 6.0, 7.0, 4.0]),\n         'Z': np.array([1, 1, 1, 1, 0, 0, 0, 0]),\n         'method': 'exact', 'B': None, 'seed': None}\n    ]\n\n    results = []\n    for case in test_cases:\n        p_value = calculate_p_value(case['Y'], case['Z'], case['method'], case['B'], case['seed'])\n        results.append(f\"{p_value:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "4954539"}, {"introduction": "在现代临床试验或基因组学研究中，我们常常需要同时评估多种疗效指标或检验数千个基因的表达差异，这带来了“多重检验”的挑战。如果对每个检验都使用传统的显著性水平（如 $\\alpha=0.05$），假阳性发现的累积概率将急剧膨胀，可能导致错误的科学结论。本练习将引导你应对这一关键问题，学习如何应用 Holm 程序来控制总体错误率（FWER），并正确解释调整后的 $p$ 值，这是确保多终点研究结论稳健性的核心技能。[@problem_id:4954555]", "problem": "一项随机、平行分组的临床试验通过多个共同主要终点评估一种新疗法相对于标准疗法的总体临床获益。共有 $5$ 个终点：C反应蛋白降低、疼痛评分降低、$6$分钟步行距离增加、疾病活动指数降低以及医生总体评估改善。对于每个终点，都进行了一项有效的双侧假设检验，以比较新疗法与标准疗法，得出了以下未经调整的 $p$ 值：C反应蛋白降低 $p=0.048$，疼痛评分降低 $p=0.004$，$6$分钟步行距离 $p=0.041$，疾病活动指数 $p=0.013$，医生总体评估 $p=0.22$。科学目标是在这 $5$ 个检验中将族状检验误差率 (Family-Wise Error Rate, FWER) 控制在 $\\alpha=0.05$ 的水平。\n\n基于核心定义，使用假设检验的步骤，按如下方式进行：\n- 明确陈述每个终点的原假设和备择假设，即无治疗效应与有治疗效应。\n- 确定所控制的相关错误率，并论证在多终点的背景下进行多重性调整的必要性。\n- 定性描述Holm贯序拒绝法的决策框架，并相应地对给定的未经调整的 $p$ 值进行排序。\n- 计算$6$分钟步行距离终点的Holm调整后 $p$ 值，确保遵守调整后 $p$ 值的单调性。\n- 用文字解释，在控制 FWER 的同时，这个调整后的 $p$ 值在 $\\alpha=0.05$ 的水平下对$6$分钟步行距离终点意味着什么（就拒绝或不拒绝其原假设而言）。\n\n仅报告$6$分钟步行距离终点的Holm调整后 $p$ 值，四舍五入到四位有效数字。报告的数字中不应包含任何单位。", "solution": "该问题呈现了一个源于生物统计学的有效情景，涉及对一个具有多终点的临床试验的分析。该问题具有科学依据、提法明确且客观。所有必要的数据都已提供，任务是应用一种标准的统计程序，即Holm-Bonferroni方法，来控制族状检验误差率 (FWER)。\n\n问题陈述要求进行一个包含多个步骤的结构化分析，下文将系统地遵循这些步骤。\n\n**1. 原假设和备择假设**\n\n对于一项在 $m=5$ 个终点上比较新疗法与标准疗法的临床试验，我们为每个终点建立一对假设。设索引 $i$ 代表 $5$ 个终点中的每一个。原假设 $H_{0,i}$ 假定新疗法与标准疗法之间没有效果差异。备择假设 $H_{A,i}$ 假定存在差异。\n\n-   $H_{0,i}$：对于终点 $i$ 没有治疗效应。（例如，新疗法组在6分钟步行距离上的真实平均变化等于标准疗法组的真实平均变化）。\n-   $H_{A,i}$：对于终点 $i$ 存在治疗效应。（例如，新疗法组在6分钟步行距离上的真实平均变化不等于标准疗法组的真实平均变化）。这是一个双侧备择假设，这是标准做法，除非有强有力的理由预先指定了方向性效应。\n\n此表述适用于所有五个终点：C反应蛋白、疼痛评分、6分钟步行距离、疾病活动指数和医生总体评估。\n\n**2. 族状检验误差率 (FWER) 与多重性调整的必要性**\n\n族状检验误差率 (FWER) 是在一系列假设检验中犯至少一次I类错误（假阳性，即拒绝一个真实的原假设）的概率。当同时检验多个假设时，如果每个检验都简单地以名义显著性水平 $\\alpha$ 进行评估，那么犯至少一次此类错误的概率会膨胀。\n\n如果我们进行 $m$ 个独立的检验，每个检验的显著性水平均为 $\\alpha$，且所有 $m$ 个原假设都为真，那么正确不拒绝单个原假设的概率是 $1 - \\alpha$。正确不拒绝所有 $m$ 个原假设的概率是 $(1 - \\alpha)^m$。因此，FWER由下式给出：\n\n$$ \\text{FWER} = 1 - (1 - \\alpha)^m $$\n\n在本问题中，有 $m=5$ 个终点，期望的控制水平为 $\\alpha = 0.05$，未经调整的 FWER 将是：\n\n$$ \\text{FWER} = 1 - (1 - 0.05)^5 = 1 - (0.95)^5 \\approx 1 - 0.77378 \\approx 0.2262 $$\n\n这个约 $22.6\\%$ 的 FWER 显著高于可接受的 $5\\%$ 的水平。为了将假阳性结论的总概率维持在所期望的 $\\alpha=0.05$ 或以下，需要一个多重性调整程序。Holm-Bonferroni方法就是一种旨在控制FWER的程序。\n\n**3. Holm贯序拒绝法与p值的排序**\n\nHolm方法是一种提供FWER强控制的降阶(step-down)程序。它比经典的Bonferroni校正一致更优（功效更强）。该程序的操作步骤如下：\n\n1.  将 $m$ 个未经调整的 $p$ 值从小到大排序：$p_{(1)} \\le p_{(2)} \\le \\dots \\le p_{(m)}$。设 $H_{0,(j)}$ 是与第 $j$ 个排序的 $p$ 值 $p_{(j)}$ 相对应的原假设。\n2.  从最小的 $p$ 值 $p_{(1)}$ 开始。将其与校正后的显著性水平 $\\frac{\\alpha}{m}$ 进行比较。如果 $p_{(1)} \\le \\frac{\\alpha}{m}$，则拒绝 $H_{0,(1)}$ 并进入下一步。否则，不拒绝 $H_{0,(1)}$ 及所有后续的原假设，并停止检验。\n3.  顺序进行。对于每一步 $j=2, \\dots, m$，如果在上一步中拒绝了假设 $H_{0,(j-1)}$，则将 $p_{(j)}$ 与校正后的显著性水平 $\\frac{\\alpha}{m - j + 1}$ 进行比较。如果 $p_{(j)} \\le \\frac{\\alpha}{m - j + 1}$，则拒绝 $H_{0,(j)}$ 并继续。否则，不拒绝 $H_{0,(j)}$ 及所有后续的假设 ($H_{0,(j+1)}, \\dots, H_{0,(m)}$)，并停止检验。\n\n给定的未经调整的 $p$ 值如下：\n-   C反应蛋白: $p=0.048$\n-   疼痛评分: $p=0.004$\n-   6分钟步行距离: $p=0.041$\n-   疾病活动指数: $p=0.013$\n-   医生总体评估: $p=0.22$\n\n对这 $m=5$ 个p值进行排序：\n-   $p_{(1)} = 0.004$ (疼痛评分)\n-   $p_{(2)} = 0.013$ (疾病活动指数)\n-   $p_{(3)} = 0.041$ (6分钟步行距离)\n-   $p_{(4)} = 0.048$ (C反应蛋白)\n-   $p_{(5)} = 0.22$ (医生总体评估)\n\n**4. Holm调整后p值的计算**\n\n第 $j$ 个排序假设的Holm调整后 $p$ 值，记为 $\\tilde{p}_{\\text{Holm},(j)}$，其计算结果被强制为单调不减。中间调整值的公式为 $\\tilde{p}_{(j)}' = (m-j+1)p_{(j)}$。最终的调整后 $p$ 值则是这些中间值的累积最大值。\n\n$$ \\tilde{p}_{\\text{Holm},(j)} = \\max_{k=1,\\dots,j} \\{ (m-k+1)p_{(k)} \\} $$\n或者，这可以递归地表示为：\n$$ \\tilde{p}_{\\text{Holm},(j)} = \\max( \\tilde{p}_{\\text{Holm},(j-1)}, (m-j+1)p_{(j)} ) $$\n其中 $\\tilde{p}_{\\text{Holm},(0)} = 0$。\n\n我们需要计算“6分钟步行距离”终点的调整后 $p$ 值，它对应于第三个排序的原始 $p$ 值，$p_{(3)} = 0.041$。\n\n-   对于 $j=1$：$p_{(1)} = 0.004$。\n    $$ \\tilde{p}_{\\text{Holm},(1)} = (5-1+1)p_{(1)} = 5 \\times 0.004 = 0.020 $$\n\n-   对于 $j=2$：$p_{(2)} = 0.013$。\n    $$ \\tilde{p}_{\\text{Holm},(2)} = \\max(\\tilde{p}_{\\text{Holm},(1)}, (5-2+1)p_{(2)}) = \\max(0.020, 4 \\times 0.013) = \\max(0.020, 0.052) = 0.052 $$\n\n-   对于 $j=3$：$p_{(3)} = 0.041$。这是目标值。\n    $$ \\tilde{p}_{\\text{Holm},(3)} = \\max(\\tilde{p}_{\\text{Holm},(2)}, (5-3+1)p_{(3)}) = \\max(0.052, 3 \\times 0.041) = \\max(0.052, 0.123) = 0.123 $$\n\n6分钟步行距离终点的Holm调整后 $p$ 值为 $0.123$。问题要求四舍五入到四位有效数字，即 $0.1230$。\n\n**5. 调整后p值的解释**\n\n计算得出的6分钟步行距离终点的Holm调整后 $p$ 值为 $\\tilde{p}_{\\text{walk}} = 0.1230$。决策规则是将此调整后 $p$ 值与预先设定的族状显著性水平 $\\alpha=0.05$ 进行比较。\n\n由于 $\\tilde{p}_{\\text{walk}} = 0.1230 > \\alpha = 0.05$，我们不拒绝该终点 ($H_{0,(3)}$) 的原假设。\n\n在实践中，这意味着，在为控制全部五个共同主要终点检验的假阳性总概率在 $5\\%$ 而进行校正后，6分钟步行距离的观测结果（其未经调整的 $p$ 值为 $0.041$）在统计学上并不显著。没有足够的证据可以断定新疗法对6分钟步行距离有影响。根据Holm程序，疼痛评分的原假设被拒绝（调整后p值 $0.020 \\le 0.05$），但疾病活动指数的原假设不被拒绝（调整后p值 $0.052 > 0.05$），此时程序停止，因此所有后续假设（包括6分钟步行距离）也不被拒绝。一个调整后的p值是该假设能被拒绝的最小FWER水平 $\\alpha$。由于 $0.1230 > 0.05$，我们不拒绝该假设。", "answer": "$$\n\\boxed{0.1230}\n$$", "id": "4954555"}]}